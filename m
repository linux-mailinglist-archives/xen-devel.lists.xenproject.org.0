Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 7AA6CEA307
	for <lists+xen-devel@lfdr.de>; Wed, 30 Oct 2019 19:09:30 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iPsNG-0003Tv-Io; Wed, 30 Oct 2019 18:07:14 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=Jdra=YX=citrix.com=anthony.perard@srs-us1.protection.inumbo.net>)
 id 1iPsNF-0003Td-Ha
 for xen-devel@lists.xenproject.org; Wed, 30 Oct 2019 18:07:13 +0000
X-Inumbo-ID: 160f8466-fb40-11e9-9534-12813bfff9fa
Received: from esa2.hc3370-68.iphmx.com (unknown [216.71.145.153])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 160f8466-fb40-11e9-9534-12813bfff9fa;
 Wed, 30 Oct 2019 18:07:08 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1572458828;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=iii6ZHxeKitPwoiHj/npNpmeKfkpaTv/pdgbQ14SFVs=;
 b=RH5/GOObpZslyWnax10sRS5+P2PIWxEMASIZqybPHUWvBQPCk1XKnmP3
 9bJdHABoIt2wP2vQwAXVFeXfqsTYsJcr+QPeJLM5X9gBIx1ywBEQZnC4u
 EM8u3mg/p2XUOB8t/wp/frxlhMPMHGPkF7A0afhKY31XeKjqDRaET9SZV s=;
Authentication-Results: esa2.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=anthony.perard@citrix.com;
 spf=Pass smtp.mailfrom=anthony.perard@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa2.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 anthony.perard@citrix.com) identity=pra;
 client-ip=162.221.158.21; receiver=esa2.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="anthony.perard@citrix.com";
 x-conformance=sidf_compatible
Received-SPF: Pass (esa2.hc3370-68.iphmx.com: domain of
 anthony.perard@citrix.com designates 162.221.158.21 as
 permitted sender) identity=mailfrom;
 client-ip=162.221.158.21; receiver=esa2.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="anthony.perard@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83
 ip4:168.245.78.127 ~all"
Received-SPF: None (esa2.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa2.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: Wdtmq/q+D+BFZQeXVSNdmL4zxOFbyk6bRhLSppfdvrQAep85mFdR/DEnn51XHBfwNcUEu1onW+
 pRZJAmez9wULxTOuqzq8jmpeBHvOZ0fhAcK9GQ1cHOOVEeugm092nzllVFKosLm7OZ7rTYApPJ
 mTdyFp06Cifvl4GPzLT8zsMM4Abtu7ka7B+iN5kulgwsVq3ShLRY5/7ZS5nm2ohETgbAVIWTtZ
 SLCCNe6YVA0yFdx4TerOPh/qpRSP91M4UsWzVsb7pK/RFzZXl9zc3wmeWfoilSLDxJHcMXdwvT
 6Eg=
X-SBRS: 2.7
X-MesageID: 7637910
X-Ironport-Server: esa2.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.68,248,1569297600"; 
   d="scan'208";a="7637910"
From: Anthony PERARD <anthony.perard@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Wed, 30 Oct 2019 18:07:03 +0000
Message-ID: <20191030180704.261320-6-anthony.perard@citrix.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191030180704.261320-1-anthony.perard@citrix.com>
References: <20191030180704.261320-1-anthony.perard@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [XEN PATCH for-4.13 v2 5/6] libxl: libxl__ev_qmp_send
 now takes an egc
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Anthony PERARD <anthony.perard@citrix.com>,
 =?UTF-8?q?J=C3=BCrgen=20Gro=C3=9F?= <jgross@suse.com>, Ian
 Jackson <ian.jackson@eu.citrix.com>, Wei Liu <wl@xen.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

Tm8gZnVuY3Rpb25uYWwgY2hhbmdlcy4KClNpZ25lZC1vZmYtYnk6IEFudGhvbnkgUEVSQVJEIDxh
bnRob255LnBlcmFyZEBjaXRyaXguY29tPgpBY2tlZC1ieTogSWFuIEphY2tzb24gPGlhbi5qYWNr
c29uQGV1LmNpdHJpeC5jb20+Ci0tLQogdG9vbHMvbGlieGwvbGlieGxfZGlzay5jICAgICAgICB8
ICA2ICsrKy0tLQogdG9vbHMvbGlieGwvbGlieGxfZG0uYyAgICAgICAgICB8ICA4ICsrKystLS0t
CiB0b29scy9saWJ4bC9saWJ4bF9kb21fc2F2ZS5jICAgIHwgIDIgKy0KIHRvb2xzL2xpYnhsL2xp
YnhsX2RvbV9zdXNwZW5kLmMgfCAgMiArLQogdG9vbHMvbGlieGwvbGlieGxfZG9tYWluLmMgICAg
ICB8ICA4ICsrKystLS0tCiB0b29scy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5oICAgIHwgIDIgKy0K
IHRvb2xzL2xpYnhsL2xpYnhsX3BjaS5jICAgICAgICAgfCAgOCArKysrLS0tLQogdG9vbHMvbGli
eGwvbGlieGxfcW1wLmMgICAgICAgICB8IDEwICsrKysrLS0tLS0KIHRvb2xzL2xpYnhsL2xpYnhs
X3VzYi5jICAgICAgICAgfCAyOCArKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tCiA5IGZpbGVz
IGNoYW5nZWQsIDM5IGluc2VydGlvbnMoKyksIDM1IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBh
L3Rvb2xzL2xpYnhsL2xpYnhsX2Rpc2suYyBiL3Rvb2xzL2xpYnhsL2xpYnhsX2Rpc2suYwppbmRl
eCA3N2FlM2E1OWJmYjYuLjY0YTY2OTE0MjQwYSAxMDA2NDQKLS0tIGEvdG9vbHMvbGlieGwvbGli
eGxfZGlzay5jCisrKyBiL3Rvb2xzL2xpYnhsL2xpYnhsX2Rpc2suYwpAQCAtNzc2LDcgKzc3Niw3
IEBAIHN0YXRpYyB2b2lkIGNkcm9tX2luc2VydF9sb2NrX2FjcXVpcmVkKGxpYnhsX19lZ2MgKmVn
YywKIAogICAgICAgICBRTVBfUEFSQU1FVEVSU19TUFJJTlRGKCZhcmdzLCAiZGV2aWNlIiwgImlk
ZS0laSIsIGRldmlkKTsKICAgICAgICAgY2lzLT5xbXAuY2FsbGJhY2sgPSBjZHJvbV9pbnNlcnRf
ZWplY3RlZDsKLSAgICAgICAgcmMgPSBsaWJ4bF9fZXZfcW1wX3NlbmQoZ2MsICZjaXMtPnFtcCwg
ImVqZWN0IiwgYXJncyk7CisgICAgICAgIHJjID0gbGlieGxfX2V2X3FtcF9zZW5kKGVnYywgJmNp
cy0+cW1wLCAiZWplY3QiLCBhcmdzKTsKICAgICAgICAgaWYgKHJjKSBnb3RvIG91dDsKICAgICB9
IGVsc2UgewogICAgICAgICBjZHJvbV9pbnNlcnRfZWplY3RlZChlZ2MsICZjaXMtPnFtcCwgTlVM
TCwgMCk7IC8qIG11c3QgYmUgbGFzdCAqLwpAQCAtODg0LDcgKzg4NCw3IEBAIHN0YXRpYyB2b2lk
IGNkcm9tX2luc2VydF9lamVjdGVkKGxpYnhsX19lZ2MgKmVnYywKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBsaWJ4bF9kaXNrX2Zvcm1hdF90b19zdHJpbmcoZGlzay0+Zm9ybWF0KSwK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNrLT5wZGV2X3BhdGgpOwogICAgICAg
ICBxbXAtPmNhbGxiYWNrID0gY2Ryb21faW5zZXJ0X2FkZGZkX2NiOwotICAgICAgICByYyA9IGxp
YnhsX19ldl9xbXBfc2VuZChnYywgcW1wLCAiYWRkLWZkIiwgYXJncyk7CisgICAgICAgIHJjID0g
bGlieGxfX2V2X3FtcF9zZW5kKGVnYywgcW1wLCAiYWRkLWZkIiwgYXJncyk7CiAgICAgICAgIGlm
IChyYykgZ290byBvdXQ7CiAgICAgICAgIGhhc19jYWxsYmFjayA9IHRydWU7CiAgICAgfSBlbHNl
IHsKQEAgLTkzOCw3ICs5MzgsNyBAQCBzdGF0aWMgdm9pZCBjZHJvbV9pbnNlcnRfYWRkZmRfY2Io
bGlieGxfX2VnYyAqZWdjLAogICAgIGxpYnhsX19xbXBfcGFyYW1fYWRkX3N0cmluZyhnYywgJmFy
Z3MsICJhcmciLAogICAgICAgICBsaWJ4bF9fcWVtdV9kaXNrX2Zvcm1hdF9zdHJpbmcoZGlzay0+
Zm9ybWF0KSk7CiAgICAgcW1wLT5jYWxsYmFjayA9IGNkcm9tX2luc2VydF9pbnNlcnRlZDsKLSAg
ICByYyA9IGxpYnhsX19ldl9xbXBfc2VuZChnYywgcW1wLCAiY2hhbmdlIiwgYXJncyk7CisgICAg
cmMgPSBsaWJ4bF9fZXZfcW1wX3NlbmQoZWdjLCBxbXAsICJjaGFuZ2UiLCBhcmdzKTsKIG91dDoK
ICAgICBpZiAocmMpCiAgICAgICAgIGNkcm9tX2luc2VydF9kb25lKGVnYywgY2lzLCByYyk7IC8q
IG11c3QgYmUgbGFzdCAqLwpkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGlieGxfZG0uYyBiL3Rv
b2xzL2xpYnhsL2xpYnhsX2RtLmMKaW5kZXggN2U1MmYwOTczMTcyLi5lYmZlOThlYmMyMzcgMTAw
NjQ0Ci0tLSBhL3Rvb2xzL2xpYnhsL2xpYnhsX2RtLmMKKysrIGIvdG9vbHMvbGlieGwvbGlieGxf
ZG0uYwpAQCAtMjY0OSw3ICsyNjQ5LDcgQEAgdm9pZCBsaWJ4bF9fc3Bhd25fbG9jYWxfZG0obGli
eGxfX2VnYyAqZWdjLCBsaWJ4bF9fZG1fc3Bhd25fc3RhdGUgKmRtc3MpCiAgICAgICAgIGRtc3Mt
PnFtcC5jYWxsYmFjayA9IGRldmljZV9tb2RlbF9xbXBfY2I7CiAgICAgICAgIGRtc3MtPnFtcC5k
b21pZCA9IGRvbWlkOwogICAgICAgICBkbXNzLT5xbXAucGF5bG9hZF9mZCA9IC0xOwotICAgICAg
ICByYyA9IGxpYnhsX19ldl9xbXBfc2VuZChnYywgJmRtc3MtPnFtcCwgInF1ZXJ5LXN0YXR1cyIs
IE5VTEwpOworICAgICAgICByYyA9IGxpYnhsX19ldl9xbXBfc2VuZChlZ2MsICZkbXNzLT5xbXAs
ICJxdWVyeS1zdGF0dXMiLCBOVUxMKTsKICAgICAgICAgaWYgKHJjKSBnb3RvIG91dF9jbG9zZTsK
ICAgICB9CiAKQEAgLTI4MDcsNyArMjgwNyw3IEBAIHN0YXRpYyB2b2lkIGRldmljZV9tb2RlbF9z
cGF3bl9vdXRjb21lKGxpYnhsX19lZ2MgKmVnYywKICAgICAgICAgZG1zcy0+cW1wLmRvbWlkID0g
ZG1zcy0+Z3Vlc3RfZG9taWQ7CiAgICAgICAgIGRtc3MtPnFtcC5wYXlsb2FkX2ZkID0gLTE7CiAg
ICAgICAgIGRtc3MtPnFtcC5jYWxsYmFjayA9IGRldmljZV9tb2RlbF9wb3N0Y29uZmlnX2NoYXJk
ZXY7Ci0gICAgICAgIHJjID0gbGlieGxfX2V2X3FtcF9zZW5kKGdjLCAmZG1zcy0+cW1wLCAicXVl
cnktY2hhcmRldiIsIE5VTEwpOworICAgICAgICByYyA9IGxpYnhsX19ldl9xbXBfc2VuZChlZ2Ms
ICZkbXNzLT5xbXAsICJxdWVyeS1jaGFyZGV2IiwgTlVMTCk7CiAgICAgICAgIGlmIChyYykgZ290
byBvdXQ7CiAgICAgICAgIHJldHVybjsKICAgICB9CkBAIC0yODc5LDcgKzI4NzksNyBAQCBzdGF0
aWMgdm9pZCBkZXZpY2VfbW9kZWxfcG9zdGNvbmZpZ19jaGFyZGV2KGxpYnhsX19lZ2MgKmVnYywK
ICAgICB9CiAKICAgICBxbXAtPmNhbGxiYWNrID0gZGV2aWNlX21vZGVsX3Bvc3Rjb25maWdfdm5j
OwotICAgIHJjID0gbGlieGxfX2V2X3FtcF9zZW5kKGdjLCBxbXAsICJxdWVyeS12bmMiLCBOVUxM
KTsKKyAgICByYyA9IGxpYnhsX19ldl9xbXBfc2VuZChlZ2MsIHFtcCwgInF1ZXJ5LXZuYyIsIE5V
TEwpOwogICAgIGlmIChyYykgZ290byBvdXQ7CiAgICAgcmV0dXJuOwogCkBAIC0yOTM5LDcgKzI5
MzksNyBAQCBzdGF0aWMgdm9pZCBkZXZpY2VfbW9kZWxfcG9zdGNvbmZpZ192bmMobGlieGxfX2Vn
YyAqZWdjLAogICAgIGlmICh2bmMgJiYgdm5jLT5wYXNzd2QpIHsKICAgICAgICAgcW1wLT5jYWxs
YmFjayA9IGRldmljZV9tb2RlbF9wb3N0Y29uZmlnX3ZuY19wYXNzd2Q7CiAgICAgICAgIGxpYnhs
X19xbXBfcGFyYW1fYWRkX3N0cmluZyhnYywgJmFyZ3MsICJwYXNzd29yZCIsIHZuYy0+cGFzc3dk
KTsKLSAgICAgICAgcmMgPSBsaWJ4bF9fZXZfcW1wX3NlbmQoZ2MsIHFtcCwgImNoYW5nZS12bmMt
cGFzc3dvcmQiLCBhcmdzKTsKKyAgICAgICAgcmMgPSBsaWJ4bF9fZXZfcW1wX3NlbmQoZWdjLCBx
bXAsICJjaGFuZ2Utdm5jLXBhc3N3b3JkIiwgYXJncyk7CiAgICAgICAgIGlmIChyYykgZ290byBv
dXQ7CiAgICAgICAgIHJldHVybjsKICAgICB9CmRpZmYgLS1naXQgYS90b29scy9saWJ4bC9saWJ4
bF9kb21fc2F2ZS5jIGIvdG9vbHMvbGlieGwvbGlieGxfZG9tX3NhdmUuYwppbmRleCBlNzBhYTE1
ODU5NzYuLjY1NjEwZTYwNTVhNyAxMDA2NDQKLS0tIGEvdG9vbHMvbGlieGwvbGlieGxfZG9tX3Nh
dmUuYworKysgYi90b29scy9saWJ4bC9saWJ4bF9kb21fc2F2ZS5jCkBAIC0yMjYsNyArMjI2LDcg
QEAgc3RhdGljIHZvaWQgZG9tYWluX3N1c3BlbmRfc3dpdGNoX3FlbXVfeGVuX2xvZ2RpcnR5CiAg
ICAgcW1wLT5wYXlsb2FkX2ZkID0gLTE7CiAgICAgcW1wLT5jYWxsYmFjayA9IHN3aXRjaF9xZW11
X3hlbl9sb2dkaXJ0eV9kb25lOwogICAgIGxpYnhsX19xbXBfcGFyYW1fYWRkX2Jvb2woZ2MsICZh
cmdzLCAiZW5hYmxlIiwgZW5hYmxlKTsKLSAgICByYyA9IGxpYnhsX19ldl9xbXBfc2VuZChnYywg
cW1wLCAieGVuLXNldC1nbG9iYWwtZGlydHktbG9nIiwgYXJncyk7CisgICAgcmMgPSBsaWJ4bF9f
ZXZfcW1wX3NlbmQoZWdjLCBxbXAsICJ4ZW4tc2V0LWdsb2JhbC1kaXJ0eS1sb2ciLCBhcmdzKTsK
ICAgICBpZiAocmMpIGdvdG8gb3V0OwogCiAgICAgcmV0dXJuOwpkaWZmIC0tZ2l0IGEvdG9vbHMv
bGlieGwvbGlieGxfZG9tX3N1c3BlbmQuYyBiL3Rvb2xzL2xpYnhsL2xpYnhsX2RvbV9zdXNwZW5k
LmMKaW5kZXggMjQ4ZGJjMzNlMzg0Li45NDBhYzMzNGY0YjEgMTAwNjQ0Ci0tLSBhL3Rvb2xzL2xp
YnhsL2xpYnhsX2RvbV9zdXNwZW5kLmMKKysrIGIvdG9vbHMvbGlieGwvbGlieGxfZG9tX3N1c3Bl
bmQuYwpAQCAtNTQ1LDcgKzU0NSw3IEBAIHZvaWQgbGlieGxfX2RtX3Jlc3VtZShsaWJ4bF9fZWdj
ICplZ2MsCiAgICAgICAgIHFtcC0+ZG9taWQgPSBkb21pZDsKICAgICAgICAgcW1wLT5jYWxsYmFj
ayA9IGRtX3Jlc3VtZV9xbXBfZG9uZTsKICAgICAgICAgcW1wLT5wYXlsb2FkX2ZkID0gLTE7Ci0g
ICAgICAgIHJjID0gbGlieGxfX2V2X3FtcF9zZW5kKGdjLCBxbXAsICJjb250IiwgTlVMTCk7Cisg
ICAgICAgIHJjID0gbGlieGxfX2V2X3FtcF9zZW5kKGVnYywgcW1wLCAiY29udCIsIE5VTEwpOwog
ICAgICAgICBpZiAocmMpIGdvdG8gb3V0OwogICAgICAgICBicmVhazsKICAgICBkZWZhdWx0Ogpk
aWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGlieGxfZG9tYWluLmMgYi90b29scy9saWJ4bC9saWJ4
bF9kb21haW4uYwppbmRleCA4NGViZmNjZWI4M2UuLjcyM2FkM2JmOGVkYiAxMDA2NDQKLS0tIGEv
dG9vbHMvbGlieGwvbGlieGxfZG9tYWluLmMKKysrIGIvdG9vbHMvbGlieGwvbGlieGxfZG9tYWlu
LmMKQEAgLTE2MDAsNyArMTYwMCw3IEBAIGludCBsaWJ4bF9zZXRfdmNwdW9ubGluZShsaWJ4bF9j
dHggKmN0eCwgdWludDMyX3QgZG9taWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBMSUJYTF9RTVBfQ01EX1RJTUVPVVQgKiAxMDAwKTsKICAgICAgICAgICAg
IGlmIChyYykgZ290byBvdXQ7CiAgICAgICAgICAgICBxbXAtPmNhbGxiYWNrID0gc2V0X3ZjcHVv
bmxpbmVfcW1wX2NwdXNfcXVlcmllZDsKLSAgICAgICAgICAgIHJjID0gbGlieGxfX2V2X3FtcF9z
ZW5kKGdjLCBxbXAsICJxdWVyeS1jcHVzIiwgTlVMTCk7CisgICAgICAgICAgICByYyA9IGxpYnhs
X19ldl9xbXBfc2VuZChlZ2MsIHFtcCwgInF1ZXJ5LWNwdXMiLCBOVUxMKTsKICAgICAgICAgICAg
IGlmIChyYykgZ290byBvdXQ7CiAgICAgICAgICAgICByZXR1cm4gQU9fSU5QUk9HUkVTUzsKICAg
ICAgICAgZGVmYXVsdDoKQEAgLTE2NjYsNyArMTY2Niw3IEBAIHN0YXRpYyB2b2lkIHNldF92Y3B1
b25saW5lX3FtcF9hZGRfY3B1KGxpYnhsX19lZ2MgKmVnYywKICAgICAgICAgaWYgKGxpYnhsX2Jp
dG1hcF90ZXN0KG1hcCwgc3Zvcy0+aW5kZXgpKSB7CiAgICAgICAgICAgICBxbXAtPmNhbGxiYWNr
ID0gc2V0X3ZjcHVvbmxpbmVfcW1wX2FkZF9jcHU7CiAgICAgICAgICAgICBsaWJ4bF9fcW1wX3Bh
cmFtX2FkZF9pbnRlZ2VyKGdjLCAmYXJncywgImlkIiwgc3Zvcy0+aW5kZXgpOwotICAgICAgICAg
ICAgcmMgPSBsaWJ4bF9fZXZfcW1wX3NlbmQoZ2MsIHFtcCwgImNwdS1hZGQiLCBhcmdzKTsKKyAg
ICAgICAgICAgIHJjID0gbGlieGxfX2V2X3FtcF9zZW5kKGVnYywgcW1wLCAiY3B1LWFkZCIsIGFy
Z3MpOwogICAgICAgICAgICAgaWYgKHJjKSBnb3RvIG91dDsKICAgICAgICAgICAgIHJldHVybjsK
ICAgICAgICAgfQpAQCAtMTc0MCw3ICsxNzQwLDcgQEAgc3RhdGljIHZvaWQgZG9tYWluX3MzX3Jl
c3VtZShsaWJ4bF9fYW8gKmFvLCBsaWJ4bF9fZWdjICplZ2MsIGludCBkb21pZCkKICAgICAgICAg
ICAgIH0KICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICBjYXNlIExJQlhMX0RFVklDRV9NT0RF
TF9WRVJTSU9OX1FFTVVfWEVOOgotICAgICAgICAgICAgcmMgPSBsaWJ4bF9fZXZfcW1wX3NlbmQo
Z2MsIHFtcCwgInN5c3RlbV93YWtldXAiLCBOVUxMKTsKKyAgICAgICAgICAgIHJjID0gbGlieGxf
X2V2X3FtcF9zZW5kKGVnYywgcW1wLCAic3lzdGVtX3dha2V1cCIsIE5VTEwpOwogICAgICAgICAg
ICAgaWYgKHJjKSBnb3RvIG91dDsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgZGVmYXVs
dDoKQEAgLTE5NTgsNyArMTk1OCw3IEBAIHN0YXRpYyB2b2lkIHJldHJpZXZlX2RvbWFpbl9jb25m
aWd1cmF0aW9uX2xvY2tfYWNxdWlyZWQoCiAgICAgICAgIGxpYnhsX2JpdG1hcF9hbGxvYyhDVFgs
ICZyZGNzLT5xZW11dV9jcHVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZF9jb25maWct
PmJfaW5mby5tYXhfdmNwdXMpOwogICAgICAgICByZGNzLT5xbXAuY2FsbGJhY2sgPSByZXRyaWV2
ZV9kb21haW5fY29uZmlndXJhdGlvbl9jcHVfcXVlcmllZDsKLSAgICAgICAgcmMgPSBsaWJ4bF9f
ZXZfcW1wX3NlbmQoZ2MsICZyZGNzLT5xbXAsICJxdWVyeS1jcHVzIiwgTlVMTCk7CisgICAgICAg
IHJjID0gbGlieGxfX2V2X3FtcF9zZW5kKGVnYywgJnJkY3MtPnFtcCwgInF1ZXJ5LWNwdXMiLCBO
VUxMKTsKICAgICAgICAgaWYgKHJjKSBnb3RvIG91dDsKICAgICAgICAgaGFzX2NhbGxiYWNrID0g
dHJ1ZTsKICAgICB9CmRpZmYgLS1naXQgYS90b29scy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5oIGIv
dG9vbHMvbGlieGwvbGlieGxfaW50ZXJuYWwuaAppbmRleCA5Yjg0ZGRkZDNiN2QuLmY5NTg5NWVh
ZTE3ZCAxMDA2NDQKLS0tIGEvdG9vbHMvbGlieGwvbGlieGxfaW50ZXJuYWwuaAorKysgYi90b29s
cy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5oCkBAIC00NzIsNyArNDcyLDcgQEAgdHlwZWRlZiB2b2lk
IGxpYnhsX19ldl9xbXBfY2FsbGJhY2sobGlieGxfX2VnYyAqZWdjLCBsaWJ4bF9fZXZfcW1wICpl
diwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCByYyk7CiAKIF9oaWRk
ZW4gdm9pZCBsaWJ4bF9fZXZfcW1wX2luaXQobGlieGxfX2V2X3FtcCAqZXYpOwotX2hpZGRlbiBp
bnQgbGlieGxfX2V2X3FtcF9zZW5kKGxpYnhsX19nYyAqZ2MsIGxpYnhsX19ldl9xbXAgKmV2LAor
X2hpZGRlbiBpbnQgbGlieGxfX2V2X3FtcF9zZW5kKGxpYnhsX19lZ2MgKmVnYywgbGlieGxfX2V2
X3FtcCAqZXYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hhciAqY21k
LCBsaWJ4bF9fanNvbl9vYmplY3QgKmFyZ3MpOwogX2hpZGRlbiB2b2lkIGxpYnhsX19ldl9xbXBf
ZGlzcG9zZShsaWJ4bF9fZ2MgKmdjLCBsaWJ4bF9fZXZfcW1wICpldik7CiAKZGlmZiAtLWdpdCBh
L3Rvb2xzL2xpYnhsL2xpYnhsX3BjaS5jIGIvdG9vbHMvbGlieGwvbGlieGxfcGNpLmMKaW5kZXgg
YjU0NDRkMTU1MjNhLi4wZGM0YTgzZTE2NmQgMTAwNjQ0Ci0tLSBhL3Rvb2xzL2xpYnhsL2xpYnhs
X3BjaS5jCisrKyBiL3Rvb2xzL2xpYnhsL2xpYnhsX3BjaS5jCkBAIC0xMTYzLDcgKzExNjMsNyBA
QCBzdGF0aWMgdm9pZCBwY2lfYWRkX3FtcF9kZXZpY2VfYWRkKGxpYnhsX19lZ2MgKmVnYywgcGNp
X2FkZF9zdGF0ZSAqcGFzKQogICAgIHFtcC0+ZG9taWQgPSBkb21pZDsKICAgICBxbXAtPnBheWxv
YWRfZmQgPSAtMTsKICAgICBxbXAtPmNhbGxiYWNrID0gcGNpX2FkZF9xbXBfZGV2aWNlX2FkZF9j
YjsKLSAgICByYyA9IGxpYnhsX19ldl9xbXBfc2VuZChnYywgcW1wLCAiZGV2aWNlX2FkZCIsIGFy
Z3MpOworICAgIHJjID0gbGlieGxfX2V2X3FtcF9zZW5kKGVnYywgcW1wLCAiZGV2aWNlX2FkZCIs
IGFyZ3MpOwogICAgIGlmIChyYykgZ290byBvdXQ7CiAgICAgcmV0dXJuOwogCkBAIC0xMTgyLDcg
KzExODIsNyBAQCBzdGF0aWMgdm9pZCBwY2lfYWRkX3FtcF9kZXZpY2VfYWRkX2NiKGxpYnhsX19l
Z2MgKmVnYywKICAgICBpZiAocmMpIGdvdG8gb3V0OwogCiAgICAgcW1wLT5jYWxsYmFjayA9IHBj
aV9hZGRfcW1wX3F1ZXJ5X3BjaV9jYjsKLSAgICByYyA9IGxpYnhsX19ldl9xbXBfc2VuZChnYywg
cW1wLCAicXVlcnktcGNpIiwgTlVMTCk7CisgICAgcmMgPSBsaWJ4bF9fZXZfcW1wX3NlbmQoZWdj
LCBxbXAsICJxdWVyeS1wY2kiLCBOVUxMKTsKICAgICBpZiAocmMpIGdvdG8gb3V0OwogICAgIHJl
dHVybjsKIApAQCAtMTk5Nyw3ICsxOTk3LDcgQEAgc3RhdGljIHZvaWQgcGNpX3JlbW92ZV9xbXBf
ZGV2aWNlX2RlbChsaWJ4bF9fZWdjICplZ2MsCiAgICAgUU1QX1BBUkFNRVRFUlNfU1BSSU5URigm
YXJncywgImlkIiwgUENJX1BUX1FERVZfSUQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBw
Y2lkZXYtPmJ1cywgcGNpZGV2LT5kZXYsIHBjaWRldi0+ZnVuYyk7CiAgICAgcHJzLT5xbXAuY2Fs
bGJhY2sgPSBwY2lfcmVtb3ZlX3FtcF9kZXZpY2VfZGVsX2NiOwotICAgIHJjID0gbGlieGxfX2V2
X3FtcF9zZW5kKGdjLCAmcHJzLT5xbXAsICJkZXZpY2VfZGVsIiwgYXJncyk7CisgICAgcmMgPSBs
aWJ4bF9fZXZfcW1wX3NlbmQoZWdjLCAmcHJzLT5xbXAsICJkZXZpY2VfZGVsIiwgYXJncyk7CiAg
ICAgaWYgKHJjKSBnb3RvIG91dDsKICAgICByZXR1cm47CiAKQEAgLTIwMzYsNyArMjAzNiw3IEBA
IHN0YXRpYyB2b2lkIHBjaV9yZW1vdmVfcW1wX3JldHJ5X3RpbWVyX2NiKGxpYnhsX19lZ2MgKmVn
YywgbGlieGxfX2V2X3RpbWUgKmV2LAogICAgIHBjaV9yZW1vdmVfc3RhdGUgKnBycyA9IENPTlRB
SU5FUl9PRihldiwgKnBycywgcmV0cnlfdGltZXIpOwogCiAgICAgcHJzLT5xbXAuY2FsbGJhY2sg
PSBwY2lfcmVtb3ZlX3FtcF9xdWVyeV9jYjsKLSAgICByYyA9IGxpYnhsX19ldl9xbXBfc2VuZChn
YywgJnBycy0+cW1wLCAicXVlcnktcGNpIiwgTlVMTCk7CisgICAgcmMgPSBsaWJ4bF9fZXZfcW1w
X3NlbmQoZWdjLCAmcHJzLT5xbXAsICJxdWVyeS1wY2kiLCBOVUxMKTsKICAgICBpZiAocmMpIGdv
dG8gb3V0OwogICAgIHJldHVybjsKIApkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGlieGxfcW1w
LmMgYi90b29scy9saWJ4bC9saWJ4bF9xbXAuYwppbmRleCA5YWFiYWQ3NGZhYmQuLmYwZTBiNTBi
ZDFjNSAxMDA2NDQKLS0tIGEvdG9vbHMvbGlieGwvbGlieGxfcW1wLmMKKysrIGIvdG9vbHMvbGli
eGwvbGlieGxfcW1wLmMKQEAgLTkyNCw3ICs5MjQsNyBAQCBpbnQgbGlieGxfcWVtdV9tb25pdG9y
X2NvbW1hbmQobGlieGxfY3R4ICpjdHgsIHVpbnQzMl90IGRvbWlkLAogICAgIHFtY3MtPnFtcC5j
YWxsYmFjayA9IHFlbXVfbW9uaXRvcl9jb21tYW5kX2RvbmU7CiAgICAgcW1jcy0+b3V0cHV0ID0g
b3V0cHV0OwogICAgIGxpYnhsX19xbXBfcGFyYW1fYWRkX3N0cmluZyhnYywgJmFyZ3MsICJjb21t
YW5kLWxpbmUiLCBjb21tYW5kX2xpbmUpOwotICAgIHJjID0gbGlieGxfX2V2X3FtcF9zZW5kKGdj
LCAmcW1jcy0+cW1wLCAiaHVtYW4tbW9uaXRvci1jb21tYW5kIiwgYXJncyk7CisgICAgcmMgPSBs
aWJ4bF9fZXZfcW1wX3NlbmQoZWdjLCAmcW1jcy0+cW1wLCAiaHVtYW4tbW9uaXRvci1jb21tYW5k
IiwgYXJncyk7CiBvdXQ6CiAgICAgaWYgKHJjKSByZXR1cm4gQU9fQ1JFQVRFX0ZBSUwocmMpOwog
ICAgIHJldHVybiBBT19JTlBST0dSRVNTOwpAQCAtOTc4LDcgKzk3OCw3IEBAIHZvaWQgbGlieGxf
X3FtcF9zdXNwZW5kX3NhdmUobGlieGxfX2VnYyAqZWdjLAogICAgIGV2LT5jYWxsYmFjayA9IGRt
X3N0b3BwZWQ7CiAgICAgZXYtPnBheWxvYWRfZmQgPSAtMTsKIAotICAgIHJjID0gbGlieGxfX2V2
X3FtcF9zZW5kKGdjLCBldiwgInN0b3AiLCBOVUxMKTsKKyAgICByYyA9IGxpYnhsX19ldl9xbXBf
c2VuZChlZ2MsIGV2LCAic3RvcCIsIE5VTEwpOwogICAgIGlmIChyYykKICAgICAgICAgZ290byBl
cnJvcjsKIApAQCAtMTAwNyw3ICsxMDA3LDcgQEAgc3RhdGljIHZvaWQgZG1fc3RvcHBlZChsaWJ4
bF9fZWdjICplZ2MsIGxpYnhsX19ldl9xbXAgKmV2LAogICAgIH0KIAogICAgIGV2LT5jYWxsYmFj
ayA9IGRtX3N0YXRlX2ZkX3JlYWR5OwotICAgIHJjID0gbGlieGxfX2V2X3FtcF9zZW5kKGdjLCBl
diwgImFkZC1mZCIsIE5VTEwpOworICAgIHJjID0gbGlieGxfX2V2X3FtcF9zZW5kKGVnYywgZXYs
ICJhZGQtZmQiLCBOVUxMKTsKICAgICBpZiAocmMpCiAgICAgICAgIGdvdG8gZXJyb3I7CiAKQEAg
LTEwNTIsNyArMTA1Miw3IEBAIHN0YXRpYyB2b2lkIGRtX3N0YXRlX2ZkX3JlYWR5KGxpYnhsX19l
Z2MgKmVnYywgbGlieGxfX2V2X3FtcCAqZXYsCiAgICAgaWYgKHFtcF9ldl9xZW11X2NvbXBhcmVf
dmVyc2lvbihldiwgMiwgMTEsIDApID49IDApCiAgICAgICAgIGxpYnhsX19xbXBfcGFyYW1fYWRk
X2Jvb2woZ2MsICZhcmdzLCAibGl2ZSIsIGRzcHMtPmxpdmUpOwogICAgIFFNUF9QQVJBTUVURVJT
X1NQUklOVEYoJmFyZ3MsICJmaWxlbmFtZSIsICIvZGV2L2Zkc2V0LyVkIiwgZmRzZXQpOwotICAg
IHJjID0gbGlieGxfX2V2X3FtcF9zZW5kKGdjLCBldiwgInhlbi1zYXZlLWRldmljZXMtc3RhdGUi
LCBhcmdzKTsKKyAgICByYyA9IGxpYnhsX19ldl9xbXBfc2VuZChlZ2MsIGV2LCAieGVuLXNhdmUt
ZGV2aWNlcy1zdGF0ZSIsIGFyZ3MpOwogICAgIGlmIChyYykKICAgICAgICAgZ290byBlcnJvcjsK
IApAQCAtMTc4MSw3ICsxNzgxLDcgQEAgdm9pZCBsaWJ4bF9fZXZfcW1wX2luaXQobGlieGxfX2V2
X3FtcCAqZXYpCiAgICAgZXYtPnFlbXVfdmVyc2lvbi5taWNybyA9IC0xOwogfQogCi1pbnQgbGli
eGxfX2V2X3FtcF9zZW5kKGxpYnhsX19nYyAqdW51c2VkX2djLCBsaWJ4bF9fZXZfcW1wICpldiwK
K2ludCBsaWJ4bF9fZXZfcW1wX3NlbmQobGlieGxfX2VnYyAqZWdjLCBsaWJ4bF9fZXZfcW1wICpl
diwKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hhciAqY21kLCBsaWJ4bF9fanNvbl9v
YmplY3QgKmFyZ3MpCiAgICAgLyogZGlzY29ubmVjdGVkIC0+IGNvbm5lY3RpbmcKICAgICAgKiBj
b25uZWN0ZWQgLT4gd2FpdGluZ19yZXBseSAod2l0aCBtc2cgc2V0KQpkaWZmIC0tZ2l0IGEvdG9v
bHMvbGlieGwvbGlieGxfdXNiLmMgYi90b29scy9saWJ4bC9saWJ4bF91c2IuYwppbmRleCAxZmM3
Y2NmNDFmODYuLmRhNWUzNzA4ZTZjZiAxMDA2NDQKLS0tIGEvdG9vbHMvbGlieGwvbGlieGxfdXNi
LmMKKysrIGIvdG9vbHMvbGlieGwvbGlieGxfdXNiLmMKQEAgLTM0OSw5ICszNDksMTAgQEAgc3Rh
dGljIGNoYXIgKnB2dXNiX2dldF9kZXZpY2VfdHlwZShsaWJ4bF91c2JjdHJsX3R5cGUgdHlwZSkK
ICAqIC0gdXNiLWVoY2kgICAgICAgKHZlcnNpb249MiksIGFsd2F5cyA2IHBvcnRzCiAgKiAtIG5l
Yy11c2IteGhjaSAgICh2ZXJzaW9uPTMpLCB1cCB0byAxNSBwb3J0cwogICovCi1zdGF0aWMgaW50
IGxpYnhsX19kZXZpY2VfdXNiY3RybF9hZGRfaHZtKGxpYnhsX19nYyAqZ2MsIGxpYnhsX19ldl9x
bXAgKnFtcCwKK3N0YXRpYyBpbnQgbGlieGxfX2RldmljZV91c2JjdHJsX2FkZF9odm0obGlieGxf
X2VnYyAqZWdjLCBsaWJ4bF9fZXZfcW1wICpxbXAsCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGxpYnhsX2RldmljZV91c2JjdHJsICp1c2JjdHJsKQogeworICAgIEVH
Q19HQzsKICAgICBsaWJ4bF9fanNvbl9vYmplY3QgKnFtcF9hcmdzID0gTlVMTDsKIAogICAgIHN3
aXRjaCAodXNiY3RybC0+dmVyc2lvbikgewpAQCAtMzc4LDI2ICszNzksMjggQEAgc3RhdGljIGlu
dCBsaWJ4bF9fZGV2aWNlX3VzYmN0cmxfYWRkX2h2bShsaWJ4bF9fZ2MgKmdjLCBsaWJ4bF9fZXZf
cW1wICpxbXAsCiAgICAgbGlieGxfX3FtcF9wYXJhbV9hZGRfc3RyaW5nKGdjLCAmcW1wX2FyZ3Ms
ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdDU1BSSU5URigieGVudXNi
LSVkIiwgdXNiY3RybC0+ZGV2aWQpKTsKIAotICAgIHJldHVybiBsaWJ4bF9fZXZfcW1wX3NlbmQo
Z2MsIHFtcCwgImRldmljZV9hZGQiLCBxbXBfYXJncyk7CisgICAgcmV0dXJuIGxpYnhsX19ldl9x
bXBfc2VuZChlZ2MsIHFtcCwgImRldmljZV9hZGQiLCBxbXBfYXJncyk7CiB9CiAKIC8qIFNlbmQg
cW1wIGNvbW1hbmRzIHRvIGRlbGV0ZSBhIHVzYiBjb250cm9sbGVyIGluIHFlbXUuICAqLwotc3Rh
dGljIGludCBsaWJ4bF9fZGV2aWNlX3VzYmN0cmxfZGVsX2h2bShsaWJ4bF9fZ2MgKmdjLAorc3Rh
dGljIGludCBsaWJ4bF9fZGV2aWNlX3VzYmN0cmxfZGVsX2h2bShsaWJ4bF9fZWdjICplZ2MsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnhsX19ldl9xbXAgKnFt
cCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IGRldmlkKQog
eworICAgIEVHQ19HQzsKICAgICBsaWJ4bF9fanNvbl9vYmplY3QgKnFtcF9hcmdzID0gTlVMTDsK
IAogICAgIGxpYnhsX19xbXBfcGFyYW1fYWRkX3N0cmluZyhnYywgJnFtcF9hcmdzLAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAiaWQiLCBHQ1NQUklOVEYoInhlbnVzYi0lZCIsIGRl
dmlkKSk7CiAKLSAgICByZXR1cm4gbGlieGxfX2V2X3FtcF9zZW5kKGdjLCBxbXAsICJkZXZpY2Vf
ZGVsIiwgcW1wX2FyZ3MpOworICAgIHJldHVybiBsaWJ4bF9fZXZfcW1wX3NlbmQoZWdjLCBxbXAs
ICJkZXZpY2VfZGVsIiwgcW1wX2FyZ3MpOwogfQogCiAvKiBTZW5kIHFtcCBjb21tYW5kcyB0byBj
cmVhdGUgYSB1c2IgZGV2aWNlIGluIHFlbXUuICovCi1zdGF0aWMgaW50IGxpYnhsX19kZXZpY2Vf
dXNiZGV2X2FkZF9odm0obGlieGxfX2djICpnYywgbGlieGxfX2V2X3FtcCAqcW1wLAorc3RhdGlj
IGludCBsaWJ4bF9fZGV2aWNlX3VzYmRldl9hZGRfaHZtKGxpYnhsX19lZ2MgKmVnYywgbGlieGxf
X2V2X3FtcCAqcW1wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxp
YnhsX2RldmljZV91c2JkZXYgKnVzYmRldikKIHsKKyAgICBFR0NfR0M7CiAgICAgbGlieGxfX2pz
b25fb2JqZWN0ICpxbXBfYXJncyA9IE5VTEw7CiAKICAgICBsaWJ4bF9fcW1wX3BhcmFtX2FkZF9z
dHJpbmcoZ2MsICZxbXBfYXJncywgImlkIiwKQEAgLTQxMywyMCArNDE2LDIxIEBAIHN0YXRpYyBp
bnQgbGlieGxfX2RldmljZV91c2JkZXZfYWRkX2h2bShsaWJ4bF9fZ2MgKmdjLCBsaWJ4bF9fZXZf
cW1wICpxbXAsCiAgICAgbGlieGxfX3FtcF9wYXJhbV9hZGRfc3RyaW5nKGdjLCAmcW1wX2FyZ3Ms
ICJob3N0YWRkciIsCiAgICAgICAgIEdDU1BSSU5URigiJWQiLCB1c2JkZXYtPnUuaG9zdGRldi5o
b3N0YWRkcikpOwogCi0gICAgcmV0dXJuIGxpYnhsX19ldl9xbXBfc2VuZChnYywgcW1wLCAiZGV2
aWNlX2FkZCIsIHFtcF9hcmdzKTsKKyAgICByZXR1cm4gbGlieGxfX2V2X3FtcF9zZW5kKGVnYywg
cW1wLCAiZGV2aWNlX2FkZCIsIHFtcF9hcmdzKTsKIH0KIAogLyogU2VuZCBxbXAgY29tbWFuZHMg
dG8gZGVsZXRlIGEgdXNiIGRldmljZSBpbiBxZW11LiAqLwotc3RhdGljIGludCBsaWJ4bF9fZGV2
aWNlX3VzYmRldl9kZWxfaHZtKGxpYnhsX19nYyAqZ2MsIGxpYnhsX19ldl9xbXAgKnFtcCwKK3N0
YXRpYyBpbnQgbGlieGxfX2RldmljZV91c2JkZXZfZGVsX2h2bShsaWJ4bF9fZWdjICplZ2MsIGxp
YnhsX19ldl9xbXAgKnFtcCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBsaWJ4bF9kZXZpY2VfdXNiZGV2ICp1c2JkZXYpCiB7CisgICAgRUdDX0dDOwogICAgIGxpYnhs
X19qc29uX29iamVjdCAqcW1wX2FyZ3MgPSBOVUxMOwogCiAgICAgbGlieGxfX3FtcF9wYXJhbV9h
ZGRfc3RyaW5nKGdjLCAmcW1wX2FyZ3MsICJpZCIsCiAgICAgICAgIEdDU1BSSU5URigieGVudXNi
LSVkLSVkIiwgdXNiZGV2LT51Lmhvc3RkZXYuaG9zdGJ1cywKICAgICAgICAgICAgICAgICAgIHVz
YmRldi0+dS5ob3N0ZGV2Lmhvc3RhZGRyKSk7CiAKLSAgICByZXR1cm4gbGlieGxfX2V2X3FtcF9z
ZW5kKGdjLCBxbXAsICJkZXZpY2VfZGVsIiwgcW1wX2FyZ3MpOworICAgIHJldHVybiBsaWJ4bF9f
ZXZfcW1wX3NlbmQoZWdjLCBxbXAsICJkZXZpY2VfZGVsIiwgcW1wX2FyZ3MpOwogfQogCiBzdGF0
aWMgTElCWExfREVGSU5FX1VQREFURV9ERVZJRCh1c2JjdHJsKQpAQCAtNDkwLDcgKzQ5NCw3IEBA
IHN0YXRpYyB2b2lkIGxpYnhsX19kZXZpY2VfdXNiY3RybF9hZGQobGlieGxfX2VnYyAqZWdjLCB1
aW50MzJfdCBkb21pZCwKICAgICAgICAgcW1wLT5kb21pZCA9IGRvbWlkOwogICAgICAgICBxbXAt
PnBheWxvYWRfZmQgPSAtMTsKICAgICAgICAgcW1wLT5jYWxsYmFjayA9IGRldmljZV91c2JjdHJs
X2FkZF9xbXBfY2I7Ci0gICAgICAgIHJjID0gbGlieGxfX2RldmljZV91c2JjdHJsX2FkZF9odm0o
Z2MsIHFtcCwgdXNiY3RybCk7CisgICAgICAgIHJjID0gbGlieGxfX2RldmljZV91c2JjdHJsX2Fk
ZF9odm0oZWdjLCBxbXAsIHVzYmN0cmwpOwogICAgICAgICBpZiAocmMpIGdvdG8gb3V0cm07CiAg
ICAgICAgIHJldHVybjsKICAgICB9CkBAIC02NDcsNyArNjUxLDcgQEAgc3RhdGljIHZvaWQgZGV2
aWNlX3VzYmN0cmxfdXNiZGV2c19yZW1vdmVkKGxpYnhsX19lZ2MgKmVnYywKICAgICAgICAgcW1w
LT5kb21pZCA9IGFvZGV2LT5kZXYtPmRvbWlkOwogICAgICAgICBxbXAtPmNhbGxiYWNrID0gZGV2
aWNlX3VzYmN0cmxfcmVtb3ZlX3FtcF9jYjsKICAgICAgICAgcW1wLT5wYXlsb2FkX2ZkID0gLTE7
Ci0gICAgICAgIHJjID0gbGlieGxfX2RldmljZV91c2JjdHJsX2RlbF9odm0oZ2MsIHFtcCwgYW9k
ZXYtPmRldi0+ZGV2aWQpOworICAgICAgICByYyA9IGxpYnhsX19kZXZpY2VfdXNiY3RybF9kZWxf
aHZtKGVnYywgcW1wLCBhb2Rldi0+ZGV2LT5kZXZpZCk7CiAgICAgICAgIGlmIChyYykgZ290byBv
dXQ7CiAgICAgICAgIHJldHVybjsKICAgICB9CkBAIC0xNzk3LDcgKzE4MDEsNyBAQCBzdGF0aWMg
dm9pZCBsaWJ4bF9fZGV2aWNlX3VzYmRldl9hZGQobGlieGxfX2VnYyAqZWdjLCB1aW50MzJfdCBk
b21pZCwKICAgICAgICAgYW9kZXYtPnFtcC5kb21pZCA9IGRvbWlkOwogICAgICAgICBhb2Rldi0+
cW1wLmNhbGxiYWNrID0gZGV2aWNlX3VzYmRldl9hZGRfcW1wX2NiOwogICAgICAgICBhb2Rldi0+
cW1wLnBheWxvYWRfZmQgPSAtMTsKLSAgICAgICAgcmMgPSBsaWJ4bF9fZGV2aWNlX3VzYmRldl9h
ZGRfaHZtKGdjLCAmYW9kZXYtPnFtcCwgdXNiZGV2KTsKKyAgICAgICAgcmMgPSBsaWJ4bF9fZGV2
aWNlX3VzYmRldl9hZGRfaHZtKGVnYywgJmFvZGV2LT5xbXAsIHVzYmRldik7CiAgICAgICAgIGlm
IChyYykgewogICAgICAgICAgICAgbGlieGxfX2RldmljZV91c2JkZXZfcmVtb3ZlX3hlbnN0b3Jl
KGdjLCBkb21pZCwgdXNiZGV2LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgTElCWExfVVNCQ1RSTF9UWVBFX0RFVklDRU1PREVMKTsKQEAgLTE5NzksNyArMTk4
Myw3IEBAIHN0YXRpYyB2b2lkIGxpYnhsX19kZXZpY2VfdXNiZGV2X3JlbW92ZShsaWJ4bF9fZWdj
ICplZ2MsIHVpbnQzMl90IGRvbWlkLAogICAgICAgICBhb2Rldi0+cW1wLmRvbWlkID0gZG9taWQ7
CiAgICAgICAgIGFvZGV2LT5xbXAuY2FsbGJhY2sgPSBkZXZpY2VfdXNiZGV2X3JlbW92ZV9xbXBf
Y2I7CiAgICAgICAgIGFvZGV2LT5xbXAucGF5bG9hZF9mZCA9IC0xOwotICAgICAgICByYyA9IGxp
YnhsX19kZXZpY2VfdXNiZGV2X2RlbF9odm0oZ2MsICZhb2Rldi0+cW1wLCB1c2JkZXYpOworICAg
ICAgICByYyA9IGxpYnhsX19kZXZpY2VfdXNiZGV2X2RlbF9odm0oZWdjLCAmYW9kZXYtPnFtcCwg
dXNiZGV2KTsKICAgICAgICAgaWYgKHJjKSB7CiAgICAgICAgICAgICBsaWJ4bF9fZGV2aWNlX3Vz
YmRldl9hZGRfeGVuc3RvcmUoZ2MsIGRvbWlkLCB1c2JkZXYsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgTElCWExfVVNCQ1RSTF9UWVBFX0RFVklDRU1PREVM
LAotLSAKQW50aG9ueSBQRVJBUkQKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5w
cm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8v
eGVuLWRldmVs

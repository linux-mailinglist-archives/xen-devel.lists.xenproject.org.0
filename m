Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id A2D152C466
	for <lists+xen-devel@lfdr.de>; Tue, 28 May 2019 12:36:07 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hVZQR-0005Hk-Em; Tue, 28 May 2019 10:33:47 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=31/0=T4=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1hVZQ9-0004k2-UF
 for xen-devel@lists.xenproject.org; Tue, 28 May 2019 10:33:30 +0000
X-Inumbo-ID: 03eaf24c-8134-11e9-90be-4fbaebcdd3ad
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 03eaf24c-8134-11e9-90be-4fbaebcdd3ad;
 Tue, 28 May 2019 10:33:22 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id F2511AE4D;
 Tue, 28 May 2019 10:33:19 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Tue, 28 May 2019 12:32:26 +0200
Message-Id: <20190528103313.1343-14-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190528103313.1343-1-jgross@suse.com>
References: <20190528103313.1343-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH 13/60] xen/sched: move some per-vcpu items to
 struct sched_unit
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Meng Xu <mengxu@cis.upenn.edu>,
 Jan Beulich <jbeulich@suse.com>, Dario Faggioli <dfaggioli@suse.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

QWZmaW5pdGllcyBhcmUgc2NoZWR1bGVyIHNwZWNpZmljIGF0dHJpYnV0ZXMsIHRoZXkgc2hvdWxk
IGJlIHBlcgpzY2hlZHVsaW5nIHVuaXQuIFNvIG1vdmUgYWxsIGFmZmluaXR5IHJlbGF0ZWQgZmll
bGRzIGluIHN0cnVjdCB2Y3B1CnRvIHN0cnVjdCBzY2hlZF91bml0LiBXaGlsZSBhdCBpdCBzd2l0
Y2ggYWZmaW5pdHkgcmVsYXRlZCBmdW5jdGlvbnMgaW4Kc2NoZWQtaWYuaCB0byB1c2UgYSBwb2lu
dGVyIHRvIHNjaGVkX3VuaXQgaW5zdGVhZCB0byB2Y3B1IGFzIHBhcmFtZXRlci4KCnZjcHUtPmxh
c3RfcnVuX3RpbWUgaXMgcHJpbWFyaWx5IHVzZWQgYnkgc2NoZWRfY3JlZGl0LCBzbyBtb3ZlIGl0
IHRvCnN0cnVjdCBzY2hlZF91bml0LCB0b28uCgpTaWduZWQtb2ZmLWJ5OiBKdWVyZ2VuIEdyb3Nz
IDxqZ3Jvc3NAc3VzZS5jb20+Ci0tLQogeGVuL2FyY2gveDg2L3B2L2VtdWwtcHJpdi1vcC5jIHwg
ICAxICsKIHhlbi9hcmNoL3g4Ni9wdi90cmFwcy5jICAgICAgICB8ICAgNSArLQogeGVuL2FyY2gv
eDg2L3RyYXBzLmMgICAgICAgICAgIHwgICA5ICsrLS0KIHhlbi9jb21tb24vZG9tYWluLmMgICAg
ICAgICAgICB8ICAxOSArKy0tLS0tCiB4ZW4vY29tbW9uL2RvbWN0bC5jICAgICAgICAgICAgfCAg
MTMgKysrLS0KIHhlbi9jb21tb24va2V5aGFuZGxlci5jICAgICAgICB8ICAgNCArLQogeGVuL2Nv
bW1vbi9zY2hlZF9jcmVkaXQuYyAgICAgIHwgIDIwICsrKystLS0tCiB4ZW4vY29tbW9uL3NjaGVk
X2NyZWRpdDIuYyAgICAgfCAgNDIgKysrKysrKystLS0tLS0tLQogeGVuL2NvbW1vbi9zY2hlZF9u
dWxsLmMgICAgICAgIHwgIDE2ICsrKy0tLQogeGVuL2NvbW1vbi9zY2hlZF9ydC5jICAgICAgICAg
IHwgICA5ICsrLS0KIHhlbi9jb21tb24vc2NoZWR1bGUuYyAgICAgICAgICB8IDExMCArKysrKysr
KysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLQogeGVuL2NvbW1vbi93YWl0LmMgICAg
ICAgICAgICAgIHwgICA0ICstCiB4ZW4vaW5jbHVkZS94ZW4vc2NoZWQtaWYuaCAgICAgfCAgMTcg
KysrKy0tLQogeGVuL2luY2x1ZGUveGVuL3NjaGVkLmggICAgICAgIHwgIDM2ICsrKysrKystLS0t
LS0tCiAxNCBmaWxlcyBjaGFuZ2VkLCAxNjMgaW5zZXJ0aW9ucygrKSwgMTQyIGRlbGV0aW9ucygt
KQoKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9wdi9lbXVsLXByaXYtb3AuYyBiL3hlbi9hcmNo
L3g4Ni9wdi9lbXVsLXByaXYtb3AuYwppbmRleCBiMjBkNzljN2EzLi5hN2EyNGEyMDUzIDEwMDY0
NAotLS0gYS94ZW4vYXJjaC94ODYvcHYvZW11bC1wcml2LW9wLmMKKysrIGIveGVuL2FyY2gveDg2
L3B2L2VtdWwtcHJpdi1vcC5jCkBAIC0yMyw2ICsyMyw3IEBACiAjaW5jbHVkZSA8eGVuL2V2ZW50
Lmg+CiAjaW5jbHVkZSA8eGVuL2d1ZXN0X2FjY2Vzcy5oPgogI2luY2x1ZGUgPHhlbi9pb2NhcC5o
PgorI2luY2x1ZGUgPHhlbi9zY2hlZC5oPgogI2luY2x1ZGUgPHhlbi9zcGlubG9jay5oPgogI2lu
Y2x1ZGUgPHhlbi90cmFjZS5oPgogCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvcHYvdHJhcHMu
YyBiL3hlbi9hcmNoL3g4Ni9wdi90cmFwcy5jCmluZGV4IDE3NDA3ODRmZjIuLjQxOWFiYzNkOTUg
MTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9wdi90cmFwcy5jCisrKyBiL3hlbi9hcmNoL3g4Ni9w
di90cmFwcy5jCkBAIC0yMiw2ICsyMiw3IEBACiAjaW5jbHVkZSA8eGVuL2V2ZW50Lmg+CiAjaW5j
bHVkZSA8eGVuL2h5cGVyY2FsbC5oPgogI2luY2x1ZGUgPHhlbi9saWIuaD4KKyNpbmNsdWRlIDx4
ZW4vc2NoZWQuaD4KICNpbmNsdWRlIDx4ZW4vdHJhY2UuaD4KICNpbmNsdWRlIDx4ZW4vc29mdGly
cS5oPgogCkBAIC0xNTUsOCArMTU2LDggQEAgc3RhdGljIHZvaWQgbm1pX21jZV9zb2Z0aXJxKHZv
aWQpCiAgICAgICogU2V0IHRoZSB0bXAgdmFsdWUgdW5jb25kaXRpb25hbGx5LCBzbyB0aGF0IHRo
ZSBjaGVjayBpbiB0aGUgaXJldAogICAgICAqIGh5cGVyY2FsbCB3b3Jrcy4KICAgICAgKi8KLSAg
ICBjcHVtYXNrX2NvcHkoc3QtPnZjcHUtPmNwdV9oYXJkX2FmZmluaXR5X3RtcCwKLSAgICAgICAg
ICAgICAgICAgc3QtPnZjcHUtPmNwdV9oYXJkX2FmZmluaXR5KTsKKyAgICBjcHVtYXNrX2NvcHko
c3QtPnZjcHUtPnNjaGVkX3VuaXQtPmNwdV9oYXJkX2FmZmluaXR5X3RtcCwKKyAgICAgICAgICAg
ICAgICAgc3QtPnZjcHUtPnNjaGVkX3VuaXQtPmNwdV9oYXJkX2FmZmluaXR5KTsKIAogICAgIGlm
ICggKGNwdSAhPSBzdC0+cHJvY2Vzc29yKSB8fAogICAgICAgICAgKHN0LT5wcm9jZXNzb3IgIT0g
c3QtPnZjcHUtPnByb2Nlc3NvcikgKQpkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L3RyYXBzLmMg
Yi94ZW4vYXJjaC94ODYvdHJhcHMuYwppbmRleCAwNWRkYzM5YmZlLi5jM2IzOWQ2Mjk2IDEwMDY0
NAotLS0gYS94ZW4vYXJjaC94ODYvdHJhcHMuYworKysgYi94ZW4vYXJjaC94ODYvdHJhcHMuYwpA
QCAtMTU5NCwxNiArMTU5NCwxNyBAQCBzdGF0aWMgdm9pZCBwY2lfc2Vycl9zb2Z0aXJxKHZvaWQp
CiB2b2lkIGFzeW5jX2V4Y2VwdGlvbl9jbGVhbnVwKHN0cnVjdCB2Y3B1ICpjdXJyKQogewogICAg
IGludCB0cmFwOworICAgIHN0cnVjdCBzY2hlZF91bml0ICp1bml0ID0gY3Vyci0+c2NoZWRfdW5p
dDsKIAogICAgIGlmICggIWN1cnItPmFzeW5jX2V4Y2VwdGlvbl9tYXNrICkKICAgICAgICAgcmV0
dXJuOwogCiAgICAgLyogUmVzdG9yZSBhZmZpbml0eS4gICovCi0gICAgaWYgKCAhY3B1bWFza19l
bXB0eShjdXJyLT5jcHVfaGFyZF9hZmZpbml0eV90bXApICYmCi0gICAgICAgICAhY3B1bWFza19l
cXVhbChjdXJyLT5jcHVfaGFyZF9hZmZpbml0eV90bXAsIGN1cnItPmNwdV9oYXJkX2FmZmluaXR5
KSApCisgICAgaWYgKCAhY3B1bWFza19lbXB0eSh1bml0LT5jcHVfaGFyZF9hZmZpbml0eV90bXAp
ICYmCisgICAgICAgICAhY3B1bWFza19lcXVhbCh1bml0LT5jcHVfaGFyZF9hZmZpbml0eV90bXAs
IHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5KSApCiAgICAgewotICAgICAgICB2Y3B1X3NldF9oYXJk
X2FmZmluaXR5KGN1cnIsIGN1cnItPmNwdV9oYXJkX2FmZmluaXR5X3RtcCk7Ci0gICAgICAgIGNw
dW1hc2tfY2xlYXIoY3Vyci0+Y3B1X2hhcmRfYWZmaW5pdHlfdG1wKTsKKyAgICAgICAgdmNwdV9z
ZXRfaGFyZF9hZmZpbml0eShjdXJyLCB1bml0LT5jcHVfaGFyZF9hZmZpbml0eV90bXApOworICAg
ICAgICBjcHVtYXNrX2NsZWFyKHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5X3RtcCk7CiAgICAgfQog
CiAgICAgaWYgKCAhKGN1cnItPmFzeW5jX2V4Y2VwdGlvbl9tYXNrICYgKGN1cnItPmFzeW5jX2V4
Y2VwdGlvbl9tYXNrIC0gMSkpICkKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vZG9tYWluLmMgYi94
ZW4vY29tbW9uL2RvbWFpbi5jCmluZGV4IDkwYzY2MDc5ZjkuLmMyMDBlOTAyNGYgMTAwNjQ0Ci0t
LSBhL3hlbi9jb21tb24vZG9tYWluLmMKKysrIGIveGVuL2NvbW1vbi9kb21haW4uYwpAQCAtMTI1
LDExICsxMjUsNiBAQCBzdGF0aWMgdm9pZCB2Y3B1X2luZm9fcmVzZXQoc3RydWN0IHZjcHUgKnYp
CiAKIHN0YXRpYyB2b2lkIHZjcHVfZGVzdHJveShzdHJ1Y3QgdmNwdSAqdikKIHsKLSAgICBmcmVl
X2NwdW1hc2tfdmFyKHYtPmNwdV9oYXJkX2FmZmluaXR5KTsKLSAgICBmcmVlX2NwdW1hc2tfdmFy
KHYtPmNwdV9oYXJkX2FmZmluaXR5X3RtcCk7Ci0gICAgZnJlZV9jcHVtYXNrX3Zhcih2LT5jcHVf
aGFyZF9hZmZpbml0eV9zYXZlZCk7Ci0gICAgZnJlZV9jcHVtYXNrX3Zhcih2LT5jcHVfc29mdF9h
ZmZpbml0eSk7Ci0KICAgICBmcmVlX3ZjcHVfc3RydWN0KHYpOwogfQogCkBAIC0xNTMsMTIgKzE0
OCw2IEBAIHN0cnVjdCB2Y3B1ICp2Y3B1X2NyZWF0ZSgKIAogICAgIGdyYW50X3RhYmxlX2luaXRf
dmNwdSh2KTsKIAotICAgIGlmICggIXphbGxvY19jcHVtYXNrX3Zhcigmdi0+Y3B1X2hhcmRfYWZm
aW5pdHkpIHx8Ci0gICAgICAgICAhemFsbG9jX2NwdW1hc2tfdmFyKCZ2LT5jcHVfaGFyZF9hZmZp
bml0eV90bXApIHx8Ci0gICAgICAgICAhemFsbG9jX2NwdW1hc2tfdmFyKCZ2LT5jcHVfaGFyZF9h
ZmZpbml0eV9zYXZlZCkgfHwKLSAgICAgICAgICF6YWxsb2NfY3B1bWFza192YXIoJnYtPmNwdV9z
b2Z0X2FmZmluaXR5KSApCi0gICAgICAgIGdvdG8gZmFpbDsKLQogICAgIGlmICggaXNfaWRsZV9k
b21haW4oZCkgKQogICAgIHsKICAgICAgICAgdi0+cnVuc3RhdGUuc3RhdGUgPSBSVU5TVEFURV9y
dW5uaW5nOwpAQCAtMTk4LDcgKzE4Nyw2IEBAIHN0cnVjdCB2Y3B1ICp2Y3B1X2NyZWF0ZSgKICAg
ICBzY2hlZF9kZXN0cm95X3ZjcHUodik7CiAgZmFpbF93cToKICAgICBkZXN0cm95X3dhaXRxdWV1
ZV92Y3B1KHYpOwotIGZhaWw6CiAgICAgdmNwdV9kZXN0cm95KHYpOwogCiAgICAgcmV0dXJuIE5V
TEw7CkBAIC01NTcsOSArNTQ1LDEwIEBAIHZvaWQgZG9tYWluX3VwZGF0ZV9ub2RlX2FmZmluaXR5
KHN0cnVjdCBkb21haW4gKmQpCiAgICAgICAgICAqLwogICAgICAgICBmb3JfZWFjaF92Y3B1ICgg
ZCwgdiApCiAgICAgICAgIHsKLSAgICAgICAgICAgIGNwdW1hc2tfb3IoZG9tX2NwdW1hc2ssIGRv
bV9jcHVtYXNrLCB2LT5jcHVfaGFyZF9hZmZpbml0eSk7CisgICAgICAgICAgICBjcHVtYXNrX29y
KGRvbV9jcHVtYXNrLCBkb21fY3B1bWFzaywKKyAgICAgICAgICAgICAgICAgICAgICAgdi0+c2No
ZWRfdW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHkpOwogICAgICAgICAgICAgY3B1bWFza19vcihkb21f
Y3B1bWFza19zb2Z0LCBkb21fY3B1bWFza19zb2Z0LAotICAgICAgICAgICAgICAgICAgICAgICB2
LT5jcHVfc29mdF9hZmZpbml0eSk7CisgICAgICAgICAgICAgICAgICAgICAgIHYtPnNjaGVkX3Vu
aXQtPmNwdV9zb2Z0X2FmZmluaXR5KTsKICAgICAgICAgfQogICAgICAgICAvKiBGaWx0ZXIgb3V0
IG5vbi1vbmxpbmUgY3B1cyAqLwogICAgICAgICBjcHVtYXNrX2FuZChkb21fY3B1bWFzaywgZG9t
X2NwdW1hc2ssIG9ubGluZSk7CkBAIC0xMjI2LDcgKzEyMTUsNyBAQCBpbnQgdmNwdV9yZXNldChz
dHJ1Y3QgdmNwdSAqdikKICAgICB2LT5hc3luY19leGNlcHRpb25fbWFzayA9IDA7CiAgICAgbWVt
c2V0KHYtPmFzeW5jX2V4Y2VwdGlvbl9zdGF0ZSwgMCwgc2l6ZW9mKHYtPmFzeW5jX2V4Y2VwdGlv
bl9zdGF0ZSkpOwogI2VuZGlmCi0gICAgY3B1bWFza19jbGVhcih2LT5jcHVfaGFyZF9hZmZpbml0
eV90bXApOworICAgIGNwdW1hc2tfY2xlYXIodi0+c2NoZWRfdW5pdC0+Y3B1X2hhcmRfYWZmaW5p
dHlfdG1wKTsKICAgICBjbGVhcl9iaXQoX1ZQRl9ibG9ja2VkLCAmdi0+cGF1c2VfZmxhZ3MpOwog
ICAgIGNsZWFyX2JpdChfVlBGX2luX3Jlc2V0LCAmdi0+cGF1c2VfZmxhZ3MpOwogCmRpZmYgLS1n
aXQgYS94ZW4vY29tbW9uL2RvbWN0bC5jIGIveGVuL2NvbW1vbi9kb21jdGwuYwppbmRleCBiYWRl
OWE2M2IxLi5iYzk4NmQxMzFkIDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL2RvbWN0bC5jCisrKyBi
L3hlbi9jb21tb24vZG9tY3RsLmMKQEAgLTYxNCw2ICs2MTQsNyBAQCBsb25nIGRvX2RvbWN0bChY
RU5fR1VFU1RfSEFORExFX1BBUkFNKHhlbl9kb21jdGxfdCkgdV9kb21jdGwpCiAgICAgY2FzZSBY
RU5fRE9NQ1RMX2dldHZjcHVhZmZpbml0eToKICAgICB7CiAgICAgICAgIHN0cnVjdCB2Y3B1ICp2
OworICAgICAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdDsKICAgICAgICAgc3RydWN0IHhlbl9k
b21jdGxfdmNwdWFmZmluaXR5ICp2Y3B1YWZmID0gJm9wLT51LnZjcHVhZmZpbml0eTsKIAogICAg
ICAgICByZXQgPSAtRUlOVkFMOwpAQCAtNjI0LDYgKzYyNSw3IEBAIGxvbmcgZG9fZG9tY3RsKFhF
Tl9HVUVTVF9IQU5ETEVfUEFSQU0oeGVuX2RvbWN0bF90KSB1X2RvbWN0bCkKICAgICAgICAgaWYg
KCAodiA9IGQtPnZjcHVbdmNwdWFmZi0+dmNwdV0pID09IE5VTEwgKQogICAgICAgICAgICAgYnJl
YWs7CiAKKyAgICAgICAgdW5pdCA9IHYtPnNjaGVkX3VuaXQ7CiAgICAgICAgIHJldCA9IC1FSU5W
QUw7CiAgICAgICAgIGlmICggdmNwdWFmZmluaXR5X3BhcmFtc19pbnZhbGlkKHZjcHVhZmYpICkK
ICAgICAgICAgICAgIGJyZWFrOwpAQCAtNjQzLDcgKzY0NSw3IEBAIGxvbmcgZG9fZG9tY3RsKFhF
Tl9HVUVTVF9IQU5ETEVfUEFSQU0oeGVuX2RvbWN0bF90KSB1X2RvbWN0bCkKICAgICAgICAgICAg
ICAgICByZXQgPSAtRU5PTUVNOwogICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg
fQotICAgICAgICAgICAgY3B1bWFza19jb3B5KG9sZF9hZmZpbml0eSwgdi0+Y3B1X2hhcmRfYWZm
aW5pdHkpOworICAgICAgICAgICAgY3B1bWFza19jb3B5KG9sZF9hZmZpbml0eSwgdW5pdC0+Y3B1
X2hhcmRfYWZmaW5pdHkpOwogCiAgICAgICAgICAgICBpZiAoICFhbGxvY19jcHVtYXNrX3Zhcigm
bmV3X2FmZmluaXR5KSApCiAgICAgICAgICAgICB7CkBAIC02NzYsNyArNjc4LDcgQEAgbG9uZyBk
b19kb21jdGwoWEVOX0dVRVNUX0hBTkRMRV9QQVJBTSh4ZW5fZG9tY3RsX3QpIHVfZG9tY3RsKQog
ICAgICAgICAgICAgICAgICAqIEZvciBoYXJkIGFmZmluaXR5LCB3aGF0IHdlIHJldHVybiBpcyB0
aGUgaW50ZXJzZWN0aW9uIG9mCiAgICAgICAgICAgICAgICAgICogY3B1cG9vbCdzIG9ubGluZSBt
YXNrIGFuZCB0aGUgbmV3IGhhcmQgYWZmaW5pdHkuCiAgICAgICAgICAgICAgICAgICovCi0gICAg
ICAgICAgICAgICAgY3B1bWFza19hbmQobmV3X2FmZmluaXR5LCBvbmxpbmUsIHYtPmNwdV9oYXJk
X2FmZmluaXR5KTsKKyAgICAgICAgICAgICAgICBjcHVtYXNrX2FuZChuZXdfYWZmaW5pdHksIG9u
bGluZSwgdW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHkpOwogICAgICAgICAgICAgICAgIHJldCA9IGNw
dW1hc2tfdG9feGVuY3RsX2JpdG1hcCgmdmNwdWFmZi0+Y3B1bWFwX2hhcmQsCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld19hZmZpbml0eSk7CiAgICAg
ICAgICAgICB9CkBAIC03MDUsNyArNzA3LDggQEAgbG9uZyBkb19kb21jdGwoWEVOX0dVRVNUX0hB
TkRMRV9QQVJBTSh4ZW5fZG9tY3RsX3QpIHVfZG9tY3RsKQogICAgICAgICAgICAgICAgICAqIGhh
cmQgYWZmaW5pdHkuCiAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgY3B1bWFz
a19hbmQobmV3X2FmZmluaXR5LCBuZXdfYWZmaW5pdHksIG9ubGluZSk7Ci0gICAgICAgICAgICAg
ICAgY3B1bWFza19hbmQobmV3X2FmZmluaXR5LCBuZXdfYWZmaW5pdHksIHYtPmNwdV9oYXJkX2Fm
ZmluaXR5KTsKKyAgICAgICAgICAgICAgICBjcHVtYXNrX2FuZChuZXdfYWZmaW5pdHksIG5ld19h
ZmZpbml0eSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bml0LT5jcHVfaGFyZF9hZmZp
bml0eSk7CiAgICAgICAgICAgICAgICAgcmV0ID0gY3B1bWFza190b194ZW5jdGxfYml0bWFwKCZ2
Y3B1YWZmLT5jcHVtYXBfc29mdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgbmV3X2FmZmluaXR5KTsKICAgICAgICAgICAgIH0KQEAgLTcxOCwxMCArNzIx
LDEwIEBAIGxvbmcgZG9fZG9tY3RsKFhFTl9HVUVTVF9IQU5ETEVfUEFSQU0oeGVuX2RvbWN0bF90
KSB1X2RvbWN0bCkKICAgICAgICAgewogICAgICAgICAgICAgaWYgKCB2Y3B1YWZmLT5mbGFncyAm
IFhFTl9WQ1BVQUZGSU5JVFlfSEFSRCApCiAgICAgICAgICAgICAgICAgcmV0ID0gY3B1bWFza190
b194ZW5jdGxfYml0bWFwKCZ2Y3B1YWZmLT5jcHVtYXBfaGFyZCwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi0+Y3B1X2hhcmRfYWZmaW5pdHkpOworICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bml0LT5jcHVfaGFy
ZF9hZmZpbml0eSk7CiAgICAgICAgICAgICBpZiAoIHZjcHVhZmYtPmZsYWdzICYgWEVOX1ZDUFVB
RkZJTklUWV9TT0ZUICkKICAgICAgICAgICAgICAgICByZXQgPSBjcHVtYXNrX3RvX3hlbmN0bF9i
aXRtYXAoJnZjcHVhZmYtPmNwdW1hcF9zb2Z0LAotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICB2LT5jcHVfc29mdF9hZmZpbml0eSk7CisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuaXQtPmNwdV9zb2Z0X2FmZmluaXR5
KTsKICAgICAgICAgfQogICAgICAgICBicmVhazsKICAgICB9CmRpZmYgLS1naXQgYS94ZW4vY29t
bW9uL2tleWhhbmRsZXIuYyBiL3hlbi9jb21tb24va2V5aGFuZGxlci5jCmluZGV4IDRmNGE2NjBi
MGMuLjE3MjlmNzNhZjAgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24va2V5aGFuZGxlci5jCisrKyBi
L3hlbi9jb21tb24va2V5aGFuZGxlci5jCkBAIC0zMTIsOCArMzEyLDggQEAgc3RhdGljIHZvaWQg
ZHVtcF9kb21haW5zKHVuc2lnbmVkIGNoYXIga2V5KQogICAgICAgICAgICAgICAgIHByaW50aygi
ZGlydHlfY3B1PSV1Iiwgdi0+ZGlydHlfY3B1KTsKICAgICAgICAgICAgIHByaW50aygiXG4iKTsK
ICAgICAgICAgICAgIHByaW50aygiICAgIGNwdV9oYXJkX2FmZmluaXR5PXslKnBibH0gY3B1X3Nv
ZnRfYWZmaW5pdHk9eyUqcGJsfVxuIiwKLSAgICAgICAgICAgICAgICAgICBucl9jcHVfaWRzLCBj
cHVtYXNrX2JpdHModi0+Y3B1X2hhcmRfYWZmaW5pdHkpLAotICAgICAgICAgICAgICAgICAgIG5y
X2NwdV9pZHMsIGNwdW1hc2tfYml0cyh2LT5jcHVfc29mdF9hZmZpbml0eSkpOworICAgICAgICAg
ICAgICAgICAgIG5yX2NwdV9pZHMsIGNwdW1hc2tfYml0cyh2LT5zY2hlZF91bml0LT5jcHVfaGFy
ZF9hZmZpbml0eSksCisgICAgICAgICAgICAgICAgICAgbnJfY3B1X2lkcywgY3B1bWFza19iaXRz
KHYtPnNjaGVkX3VuaXQtPmNwdV9zb2Z0X2FmZmluaXR5KSk7CiAgICAgICAgICAgICBwcmludGso
IiAgICBwYXVzZV9jb3VudD0lZCBwYXVzZV9mbGFncz0lbHhcbiIsCiAgICAgICAgICAgICAgICAg
ICAgYXRvbWljX3JlYWQoJnYtPnBhdXNlX2NvdW50KSwgdi0+cGF1c2VfZmxhZ3MpOwogICAgICAg
ICAgICAgYXJjaF9kdW1wX3ZjcHVfaW5mbyh2KTsKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vc2No
ZWRfY3JlZGl0LmMgYi94ZW4vY29tbW9uL3NjaGVkX2NyZWRpdC5jCmluZGV4IDc0Yzg1ZGYzMzQu
LmZmYWMyZjRiYmIgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0LmMKKysrIGIv
eGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQuYwpAQCAtMzUwLDYgKzM1MCw3IEBAIERFRklORV9QRVJf
Q1BVKHVuc2lnbmVkIGludCwgbGFzdF90aWNrbGVfY3B1KTsKIHN0YXRpYyBpbmxpbmUgdm9pZCBf
X3J1bnFfdGlja2xlKHN0cnVjdCBjc2NoZWRfdW5pdCAqbmV3KQogewogICAgIHVuc2lnbmVkIGlu
dCBjcHUgPSBuZXctPnZjcHUtPnByb2Nlc3NvcjsKKyAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5p
dCA9IG5ldy0+dmNwdS0+c2NoZWRfdW5pdDsKICAgICBzdHJ1Y3QgY3NjaGVkX3VuaXQgKiBjb25z
dCBjdXIgPSBDU0NIRURfVU5JVChjdXJyX29uX2NwdShjcHUpKTsKICAgICBzdHJ1Y3QgY3NjaGVk
X3ByaXZhdGUgKnBydiA9IENTQ0hFRF9QUklWKHBlcl9jcHUoc2NoZWR1bGVyLCBjcHUpKTsKICAg
ICBjcHVtYXNrX3QgbWFzaywgaWRsZV9tYXNrLCAqb25saW5lOwpAQCAtMzc1LDcgKzM3Niw3IEBA
IHN0YXRpYyBpbmxpbmUgdm9pZCBfX3J1bnFfdGlja2xlKHN0cnVjdCBjc2NoZWRfdW5pdCAqbmV3
KQogICAgIGlmICggdW5saWtlbHkodGVzdF9iaXQoQ1NDSEVEX0ZMQUdfVkNQVV9QSU5ORUQsICZu
ZXctPmZsYWdzKSAmJgogICAgICAgICAgICAgICAgICAgY3B1bWFza190ZXN0X2NwdShjcHUsICZp
ZGxlX21hc2spKSApCiAgICAgewotICAgICAgICBBU1NFUlQoY3B1bWFza19jeWNsZShjcHUsIG5l
dy0+dmNwdS0+Y3B1X2hhcmRfYWZmaW5pdHkpID09IGNwdSk7CisgICAgICAgIEFTU0VSVChjcHVt
YXNrX2N5Y2xlKGNwdSwgdW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHkpID09IGNwdSk7CiAgICAgICAg
IFNDSEVEX1NUQVRfQ1JBTksodGlja2xlZF9pZGxlX2NwdV9leGNsKTsKICAgICAgICAgX19jcHVt
YXNrX3NldF9jcHUoY3B1LCAmbWFzayk7CiAgICAgICAgIGdvdG8gdGlja2xlOwpAQCAtNDEwLDEx
ICs0MTEsMTEgQEAgc3RhdGljIGlubGluZSB2b2lkIF9fcnVucV90aWNrbGUoc3RydWN0IGNzY2hl
ZF91bml0ICpuZXcpCiAgICAgICAgICAgICBpbnQgbmV3X2lkbGVyc19lbXB0eTsKIAogICAgICAg
ICAgICAgaWYgKCBiYWxhbmNlX3N0ZXAgPT0gQkFMQU5DRV9TT0ZUX0FGRklOSVRZCi0gICAgICAg
ICAgICAgICAgICYmICFoYXNfc29mdF9hZmZpbml0eShuZXctPnZjcHUpICkKKyAgICAgICAgICAg
ICAgICAgJiYgIWhhc19zb2Z0X2FmZmluaXR5KHVuaXQpICkKICAgICAgICAgICAgICAgICBjb250
aW51ZTsKIAogICAgICAgICAgICAgLyogQXJlIHRoZXJlIGlkbGVycyBzdWl0YWJsZSBmb3IgbmV3
IChmb3IgdGhpcyBiYWxhbmNlIHN0ZXApPyAqLwotICAgICAgICAgICAgYWZmaW5pdHlfYmFsYW5j
ZV9jcHVtYXNrKG5ldy0+dmNwdSwgYmFsYW5jZV9zdGVwLAorICAgICAgICAgICAgYWZmaW5pdHlf
YmFsYW5jZV9jcHVtYXNrKHVuaXQsIGJhbGFuY2Vfc3RlcCwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSkpOwogICAgICAgICAgICAg
Y3B1bWFza19hbmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLAogICAgICAgICAgICAgICAgICAg
ICAgICAgY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCAmaWRsZV9tYXNrKTsKQEAgLTQ0Myw4ICs0
NDQsNyBAQCBzdGF0aWMgaW5saW5lIHZvaWQgX19ydW5xX3RpY2tsZShzdHJ1Y3QgY3NjaGVkX3Vu
aXQgKm5ldykKICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgaWYgKCBuZXdfaWRsZXJzX2Vt
cHR5ICYmIG5ldy0+cHJpID4gY3VyLT5wcmkgKQogICAgICAgICAgICAgewotICAgICAgICAgICAg
ICAgIGlmICggY3B1bWFza19pbnRlcnNlY3RzKGN1ci0+dmNwdS0+Y3B1X2hhcmRfYWZmaW5pdHks
Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJmlkbGVfbWFzaykgKQor
ICAgICAgICAgICAgICAgIGlmICggY3B1bWFza19pbnRlcnNlY3RzKHVuaXQtPmNwdV9oYXJkX2Fm
ZmluaXR5LCAmaWRsZV9tYXNrKSApCiAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAg
ICAgICBTQ0hFRF9WQ1BVX1NUQVRfQ1JBTksoY3VyLCBraWNrZWRfYXdheSk7CiAgICAgICAgICAg
ICAgICAgICAgIFNDSEVEX1ZDUFVfU1RBVF9DUkFOSyhjdXIsIG1pZ3JhdGVfcik7CkBAIC02OTUs
NyArNjk1LDcgQEAgc3RhdGljIGlubGluZSBib29sCiBfX2NzY2hlZF92Y3B1X2lzX2NhY2hlX2hv
dChjb25zdCBzdHJ1Y3QgY3NjaGVkX3ByaXZhdGUgKnBydiwgc3RydWN0IHZjcHUgKnYpCiB7CiAg
ICAgYm9vbCBob3QgPSBwcnYtPnZjcHVfbWlncl9kZWxheSAmJgotICAgICAgICAgICAgICAgKE5P
VygpIC0gdi0+bGFzdF9ydW5fdGltZSkgPCBwcnYtPnZjcHVfbWlncl9kZWxheTsKKyAgICAgICAg
ICAgICAgIChOT1coKSAtIHYtPnNjaGVkX3VuaXQtPmxhc3RfcnVuX3RpbWUpIDwgcHJ2LT52Y3B1
X21pZ3JfZGVsYXk7CiAKICAgICBpZiAoIGhvdCApCiAgICAgICAgIFNDSEVEX1NUQVRfQ1JBTkso
dmNwdV9ob3QpOwpAQCAtNzMzLDcgKzczMyw3IEBAIF9jc2NoZWRfY3B1X3BpY2soY29uc3Qgc3Ry
dWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgdmNwdSAqdmMsIGJvb2xfdCBjb21taXQpCiAKICAg
ICBmb3JfZWFjaF9hZmZpbml0eV9iYWxhbmNlX3N0ZXAoIGJhbGFuY2Vfc3RlcCApCiAgICAgewot
ICAgICAgICBhZmZpbml0eV9iYWxhbmNlX2NwdW1hc2sodmMsIGJhbGFuY2Vfc3RlcCwgY3B1cyk7
CisgICAgICAgIGFmZmluaXR5X2JhbGFuY2VfY3B1bWFzayh2Yy0+c2NoZWRfdW5pdCwgYmFsYW5j
ZV9zdGVwLCBjcHVzKTsKICAgICAgICAgY3B1bWFza19hbmQoY3B1cywgb25saW5lLCBjcHVzKTsK
ICAgICAgICAgLyoKICAgICAgICAgICogV2Ugd2FudCB0byBwaWNrIHVwIGEgcGNwdSBhbW9uZyB0
aGUgb25lcyB0aGF0IGFyZSBvbmxpbmUgYW5kCkBAIC03NTIsNyArNzUyLDcgQEAgX2NzY2hlZF9j
cHVfcGljayhjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCB2Y3B1ICp2YywgYm9v
bF90IGNvbW1pdCkKICAgICAgICAgICogYmFsYW5jaW5nIHN0ZXAgYWxsIHRvZ2V0aGVyLgogICAg
ICAgICAgKi8KICAgICAgICAgaWYgKCBiYWxhbmNlX3N0ZXAgPT0gQkFMQU5DRV9TT0ZUX0FGRklO
SVRZICYmCi0gICAgICAgICAgICAgKCFoYXNfc29mdF9hZmZpbml0eSh2YykgfHwgY3B1bWFza19l
bXB0eShjcHVzKSkgKQorICAgICAgICAgICAgICghaGFzX3NvZnRfYWZmaW5pdHkodmMtPnNjaGVk
X3VuaXQpIHx8IGNwdW1hc2tfZW1wdHkoY3B1cykpICkKICAgICAgICAgICAgIGNvbnRpbnVlOwog
CiAgICAgICAgIC8qIElmIHByZXNlbnQsIHByZWZlciB2YydzIGN1cnJlbnQgcHJvY2Vzc29yICov
CkBAIC0xNjUyLDEwICsxNjUyLDEwIEBAIGNzY2hlZF9ydW5xX3N0ZWFsKGludCBwZWVyX2NwdSwg
aW50IGNwdSwgaW50IHByaSwgaW50IGJhbGFuY2Vfc3RlcCkKICAgICAgICAgICogb3IgY291bnRl
ci4KICAgICAgICAgICovCiAgICAgICAgIGlmICggdmMtPmlzX3J1bm5pbmcgfHwgKGJhbGFuY2Vf
c3RlcCA9PSBCQUxBTkNFX1NPRlRfQUZGSU5JVFkgJiYKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIWhhc19zb2Z0X2FmZmluaXR5KHZjKSkgKQorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAhaGFzX3NvZnRfYWZmaW5pdHkodmMtPnNjaGVkX3VuaXQpKSApCiAgICAgICAg
ICAgICBjb250aW51ZTsKIAotICAgICAgICBhZmZpbml0eV9iYWxhbmNlX2NwdW1hc2sodmMsIGJh
bGFuY2Vfc3RlcCwgY3B1bWFza19zY3JhdGNoKTsKKyAgICAgICAgYWZmaW5pdHlfYmFsYW5jZV9j
cHVtYXNrKHZjLT5zY2hlZF91bml0LCBiYWxhbmNlX3N0ZXAsIGNwdW1hc2tfc2NyYXRjaCk7CiAg
ICAgICAgIGlmICggX19jc2NoZWRfdmNwdV9pc19taWdyYXRlYWJsZShwcnYsIHZjLCBjcHUsIGNw
dW1hc2tfc2NyYXRjaCkgKQogICAgICAgICB7CiAgICAgICAgICAgICAvKiBXZSBnb3QgYSBjYW5k
aWRhdGUuIEdyYWIgaXQhICovCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3NjaGVkX2NyZWRpdDIu
YyBiL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0Mi5jCmluZGV4IDU2MmU3M2Q5OWUuLmRhYmQ1NjM2
ZjUgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0Mi5jCisrKyBiL3hlbi9jb21t
b24vc2NoZWRfY3JlZGl0Mi5jCkBAIC02OTksMTAgKzY5OSwxMCBAQCBzdGF0aWMgaW50IGdldF9m
YWxsYmFja19jcHUoc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQogICAgIHsKICAgICAgICAgaW50
IGNwdSA9IHYtPnByb2Nlc3NvcjsKIAotICAgICAgICBpZiAoIGJzID09IEJBTEFOQ0VfU09GVF9B
RkZJTklUWSAmJiAhaGFzX3NvZnRfYWZmaW5pdHkodikgKQorICAgICAgICBpZiAoIGJzID09IEJB
TEFOQ0VfU09GVF9BRkZJTklUWSAmJiAhaGFzX3NvZnRfYWZmaW5pdHkodi0+c2NoZWRfdW5pdCkg
KQogICAgICAgICAgICAgY29udGludWU7CiAKLSAgICAgICAgYWZmaW5pdHlfYmFsYW5jZV9jcHVt
YXNrKHYsIGJzLCBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSkpOworICAgICAgICBhZmZpbml0eV9i
YWxhbmNlX2NwdW1hc2sodi0+c2NoZWRfdW5pdCwgYnMsIGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1
KSk7CiAgICAgICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwgY3B1bWFz
a19zY3JhdGNoX2NwdShjcHUpLAogICAgICAgICAgICAgICAgICAgICBjcHVwb29sX2RvbWFpbl9j
cHVtYXNrKHYtPmRvbWFpbikpOwogCkBAIC0xMzkwLDEwICsxMzkwLDEwIEBAIHN0YXRpYyBzX3Rp
bWVfdCB0aWNrbGVfc2NvcmUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzX3RpbWVfdCBu
b3csCiAgICAgICovCiAgICAgaWYgKCBzY29yZSA+IDAgKQogICAgIHsKLSAgICAgICAgaWYgKCBj
cHVtYXNrX3Rlc3RfY3B1KGNwdSwgbmV3LT52Y3B1LT5jcHVfc29mdF9hZmZpbml0eSkgKQorICAg
ICAgICBpZiAoIGNwdW1hc2tfdGVzdF9jcHUoY3B1LCBuZXctPnZjcHUtPnNjaGVkX3VuaXQtPmNw
dV9zb2Z0X2FmZmluaXR5KSApCiAgICAgICAgICAgICBzY29yZSArPSBDU0NIRUQyX0NSRURJVF9J
TklUOwogCi0gICAgICAgIGlmICggIWNwdW1hc2tfdGVzdF9jcHUoY3B1LCBjdXItPnZjcHUtPmNw
dV9zb2Z0X2FmZmluaXR5KSApCisgICAgICAgIGlmICggIWNwdW1hc2tfdGVzdF9jcHUoY3B1LCBj
dXItPnZjcHUtPnNjaGVkX3VuaXQtPmNwdV9zb2Z0X2FmZmluaXR5KSApCiAgICAgICAgICAgICBz
Y29yZSArPSBDU0NIRUQyX0NSRURJVF9JTklUOwogICAgIH0KIApAQCAtMTQzNiw2ICsxNDM2LDcg
QEAgcnVucV90aWNrbGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgY3NjaGVk
Ml91bml0ICpuZXcsIHNfdGltZV90IG5vdykKIHsKICAgICBpbnQgaSwgaXBpZCA9IC0xOwogICAg
IHNfdGltZV90IG1heCA9IDA7CisgICAgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQgPSBuZXctPnZj
cHUtPnNjaGVkX3VuaXQ7CiAgICAgdW5zaWduZWQgaW50IGJzLCBjcHUgPSBuZXctPnZjcHUtPnBy
b2Nlc3NvcjsKICAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQgPSBjMnJxZChv
cHMsIGNwdSk7CiAgICAgY3B1bWFza190ICpvbmxpbmUgPSBjcHVwb29sX2RvbWFpbl9jcHVtYXNr
KG5ldy0+dmNwdS0+ZG9tYWluKTsKQEAgLTE0NzMsNyArMTQ3NCw3IEBAIHJ1bnFfdGlja2xlKGNv
bnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IGNzY2hlZDJfdW5pdCAqbmV3LCBzX3Rp
bWVfdCBub3cpCiAgICAgICAgICAgICAgICAgICBjcHVtYXNrX3Rlc3RfY3B1KGNwdSwgJnJxZC0+
aWRsZSkgJiYKICAgICAgICAgICAgICAgICAgICFjcHVtYXNrX3Rlc3RfY3B1KGNwdSwgJnJxZC0+
dGlja2xlZCkpICkKICAgICB7Ci0gICAgICAgIEFTU0VSVChjcHVtYXNrX2N5Y2xlKGNwdSwgbmV3
LT52Y3B1LT5jcHVfaGFyZF9hZmZpbml0eSkgPT0gY3B1KTsKKyAgICAgICAgQVNTRVJUKGNwdW1h
c2tfY3ljbGUoY3B1LCB1bml0LT5jcHVfaGFyZF9hZmZpbml0eSkgPT0gY3B1KTsKICAgICAgICAg
U0NIRURfU1RBVF9DUkFOSyh0aWNrbGVkX2lkbGVfY3B1X2V4Y2wpOwogICAgICAgICBpcGlkID0g
Y3B1OwogICAgICAgICBnb3RvIHRpY2tsZTsKQEAgLTE0ODIsMTAgKzE0ODMsMTAgQEAgcnVucV90
aWNrbGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgY3NjaGVkMl91bml0ICpu
ZXcsIHNfdGltZV90IG5vdykKICAgICBmb3JfZWFjaF9hZmZpbml0eV9iYWxhbmNlX3N0ZXAoIGJz
ICkKICAgICB7CiAgICAgICAgIC8qIEp1c3Qgc2tpcCBmaXJzdCBzdGVwLCBpZiB3ZSBkb24ndCBo
YXZlIGEgc29mdCBhZmZpbml0eSAqLwotICAgICAgICBpZiAoIGJzID09IEJBTEFOQ0VfU09GVF9B
RkZJTklUWSAmJiAhaGFzX3NvZnRfYWZmaW5pdHkobmV3LT52Y3B1KSApCisgICAgICAgIGlmICgg
YnMgPT0gQkFMQU5DRV9TT0ZUX0FGRklOSVRZICYmICFoYXNfc29mdF9hZmZpbml0eSh1bml0KSAp
CiAgICAgICAgICAgICBjb250aW51ZTsKIAotICAgICAgICBhZmZpbml0eV9iYWxhbmNlX2NwdW1h
c2sobmV3LT52Y3B1LCBicywgY3B1bWFza19zY3JhdGNoX2NwdShjcHUpKTsKKyAgICAgICAgYWZm
aW5pdHlfYmFsYW5jZV9jcHVtYXNrKHVuaXQsIGJzLCBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSkp
OwogCiAgICAgICAgIC8qCiAgICAgICAgICAqIEZpcnN0IG9mIGFsbCwgY29uc2lkZXIgaWRsZSBj
cHVzLCBjaGVja2luZyBpZiB3ZSBjYW4ganVzdApAQCAtMTU1Nyw3ICsxNTU4LDcgQEAgcnVucV90
aWNrbGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgY3NjaGVkMl91bml0ICpu
ZXcsIHNfdGltZV90IG5vdykKICAgICAgICAgICAgIGlwaWQgPSBjcHU7CiAKICAgICAgICAgICAg
IC8qIElmIHRoaXMgaXMgaW4gbmV3J3Mgc29mdCBhZmZpbml0eSwganVzdCB0YWtlIGl0ICovCi0g
ICAgICAgICAgICBpZiAoIGNwdW1hc2tfdGVzdF9jcHUoY3B1LCBuZXctPnZjcHUtPmNwdV9zb2Z0
X2FmZmluaXR5KSApCisgICAgICAgICAgICBpZiAoIGNwdW1hc2tfdGVzdF9jcHUoY3B1LCB1bml0
LT5jcHVfc29mdF9hZmZpbml0eSkgKQogICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIFND
SEVEX1NUQVRfQ1JBTksodGlja2xlZF9idXN5X2NwdSk7CiAgICAgICAgICAgICAgICAgZ290byB0
aWNrbGU7CkBAIC0yMjQzLDcgKzIyNDQsNyBAQCBjc2NoZWQyX3Jlc19waWNrKGNvbnN0IHN0cnVj
dCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiAgICAgICAgIGdvdG8g
b3V0OwogICAgIH0KIAotICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwg
dmMtPmNwdV9oYXJkX2FmZmluaXR5LAorICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9j
cHUoY3B1KSwgdW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHksCiAgICAgICAgICAgICAgICAgY3B1cG9v
bF9kb21haW5fY3B1bWFzayh2Yy0+ZG9tYWluKSk7CiAKICAgICAvKgpAQCAtMjI4OCw3ICsyMjg5
LDcgQEAgY3NjaGVkMl9yZXNfcGljayhjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVj
dCBzY2hlZF91bml0ICp1bml0KQogICAgICAqCiAgICAgICogRmluZCBib3RoIHJ1bnF1ZXVlcyBp
biBvbmUgcGFzcy4KICAgICAgKi8KLSAgICBoYXNfc29mdCA9IGhhc19zb2Z0X2FmZmluaXR5KHZj
KTsKKyAgICBoYXNfc29mdCA9IGhhc19zb2Z0X2FmZmluaXR5KHVuaXQpOwogICAgIGZvcl9lYWNo
X2NwdShpLCAmcHJ2LT5hY3RpdmVfcXVldWVzKQogICAgIHsKICAgICAgICAgc3RydWN0IGNzY2hl
ZDJfcnVucXVldWVfZGF0YSAqcnFkOwpAQCAtMjMzNSw3ICsyMzM2LDcgQEAgY3NjaGVkMl9yZXNf
cGljayhjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0
KQogICAgICAgICAgICAgY3B1bWFza190IG1hc2s7CiAKICAgICAgICAgICAgIGNwdW1hc2tfYW5k
KCZtYXNrLCBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksICZycWQtPmFjdGl2ZSk7Ci0gICAgICAg
ICAgICBpZiAoIGNwdW1hc2tfaW50ZXJzZWN0cygmbWFzaywgc3ZjLT52Y3B1LT5jcHVfc29mdF9h
ZmZpbml0eSkgKQorICAgICAgICAgICAgaWYgKCBjcHVtYXNrX2ludGVyc2VjdHMoJm1hc2ssIHVu
aXQtPmNwdV9zb2Z0X2FmZmluaXR5KSApCiAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAg
bWluX3NfYXZnbG9hZCA9IHJxZF9hdmdsb2FkOwogICAgICAgICAgICAgICAgIG1pbl9zX3JxaSA9
IGk7CkBAIC0yMzU3LDkgKzIzNTgsOSBAQCBjc2NoZWQyX3Jlc19waWNrKGNvbnN0IHN0cnVjdCBz
Y2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiAgICAgICAgICAqIE5vdGUg
dGhhdCwgdG8gb2J0YWluIHRoZSBzb2Z0LWFmZmluaXR5IG1hc2ssIHdlICJqdXN0IiBwdXQgd2hh
dCB3ZQogICAgICAgICAgKiBoYXZlIGluIGNwdW1hc2tfc2NyYXRjaCBpbiAmJiB3aXRoIHZjLT5j
cHVfc29mdF9hZmZpbml0eS4gVGhpcyBpcwogICAgICAgICAgKiBvayBiZWNhdXNlOgotICAgICAg
ICAgKiAtIHdlIGtub3cgdGhhdCB2Yy0+Y3B1X2hhcmRfYWZmaW5pdHkgYW5kIHZjLT5jcHVfc29m
dF9hZmZpbml0eSBoYXZlCisgICAgICAgICAqIC0gd2Uga25vdyB0aGF0IHVuaXQtPmNwdV9oYXJk
X2FmZmluaXR5IGFuZCAtPmNwdV9zb2Z0X2FmZmluaXR5IGhhdmUKICAgICAgICAgICogICBhIG5v
bi1lbXB0eSBpbnRlcnNlY3Rpb24gKGJlY2F1c2UgaGFzX3NvZnQgaXMgdHJ1ZSk7Ci0gICAgICAg
ICAqIC0gd2UgaGF2ZSB2Yy0+Y3B1X2hhcmRfYWZmaW5pdHkgJiBjcHVwb29sX2RvbWFpbl9jcHVt
YXNrKCkgYWxyZWFkeQorICAgICAgICAgKiAtIHdlIGhhdmUgdW5pdC0+Y3B1X2hhcmRfYWZmaW5p
dHkgJiBjcHVwb29sX2RvbWFpbl9jcHVtYXNrKCkgYWxyZWFkeQogICAgICAgICAgKiAgIGluIGNw
dW1hc2tfc2NyYXRjaCwgd2UgZG8gc2F2ZSBhIGxvdCBkb2luZyBsaWtlIHRoaXMuCiAgICAgICAg
ICAqCiAgICAgICAgICAqIEl0J3Mga2luZCBvZiBsaWtlIG9wZW4gY29kaW5nIGFmZmluaXR5X2Jh
bGFuY2VfY3B1bWFzaygpIGJ1dCwgaW4KQEAgLTIzNjcsNyArMjM2OCw3IEBAIGNzY2hlZDJfcmVz
X3BpY2soY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5p
dCkKICAgICAgICAgICogY3B1bWFzayBvcGVyYXRpb25zLgogICAgICAgICAgKi8KICAgICAgICAg
Y3B1bWFza19hbmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCBjcHVtYXNrX3NjcmF0Y2hfY3B1
KGNwdSksCi0gICAgICAgICAgICAgICAgICAgIHZjLT5jcHVfc29mdF9hZmZpbml0eSk7CisgICAg
ICAgICAgICAgICAgICAgIHVuaXQtPmNwdV9zb2Z0X2FmZmluaXR5KTsKICAgICAgICAgY3B1bWFz
a19hbmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSks
CiAgICAgICAgICAgICAgICAgICAgICZwcnYtPnJxZFttaW5fc19ycWldLmFjdGl2ZSk7CiAgICAg
fQpAQCAtMjQ3NSw2ICsyNDc2LDcgQEAgc3RhdGljIHZvaWQgbWlncmF0ZShjb25zdCBzdHJ1Y3Qg
c2NoZWR1bGVyICpvcHMsCiAgICAgICAgICAgICAgICAgICAgIHNfdGltZV90IG5vdykKIHsKICAg
ICBpbnQgY3B1ID0gc3ZjLT52Y3B1LT5wcm9jZXNzb3I7CisgICAgc3RydWN0IHNjaGVkX3VuaXQg
KnVuaXQgPSBzdmMtPnZjcHUtPnNjaGVkX3VuaXQ7CiAKICAgICBpZiAoIHVubGlrZWx5KHRiX2lu
aXRfZG9uZSkgKQogICAgIHsKQEAgLTI1MTIsNyArMjUxNCw3IEBAIHN0YXRpYyB2b2lkIG1pZ3Jh
dGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAgICAgICB9CiAgICAgICAgIF9ydW5x
X2RlYXNzaWduKHN2Yyk7CiAKLSAgICAgICAgY3B1bWFza19hbmQoY3B1bWFza19zY3JhdGNoX2Nw
dShjcHUpLCBzdmMtPnZjcHUtPmNwdV9oYXJkX2FmZmluaXR5LAorICAgICAgICBjcHVtYXNrX2Fu
ZChjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksIHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5LAogICAg
ICAgICAgICAgICAgICAgICBjcHVwb29sX2RvbWFpbl9jcHVtYXNrKHN2Yy0+dmNwdS0+ZG9tYWlu
KSk7CiAgICAgICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwgY3B1bWFz
a19zY3JhdGNoX2NwdShjcHUpLAogICAgICAgICAgICAgICAgICAgICAmdHJxZC0+YWN0aXZlKTsK
QEAgLTI1NDYsNyArMjU0OCw3IEBAIHN0YXRpYyBib29sIHZjcHVfaXNfbWlncmF0ZWFibGUoc3Ry
dWN0IGNzY2hlZDJfdW5pdCAqc3ZjLAogICAgIHN0cnVjdCB2Y3B1ICp2ID0gc3ZjLT52Y3B1Owog
ICAgIGludCBjcHUgPSBzdmMtPnZjcHUtPnByb2Nlc3NvcjsKIAotICAgIGNwdW1hc2tfYW5kKGNw
dW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwgdi0+Y3B1X2hhcmRfYWZmaW5pdHksCisgICAgY3B1bWFz
a19hbmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCB2LT5zY2hlZF91bml0LT5jcHVfaGFyZF9h
ZmZpbml0eSwKICAgICAgICAgICAgICAgICBjcHVwb29sX2RvbWFpbl9jcHVtYXNrKHYtPmRvbWFp
bikpOwogCiAgICAgcmV0dXJuICEoc3ZjLT5mbGFncyAmIENTRkxBR19ydW5xX21pZ3JhdGVfcmVx
dWVzdCkgJiYKQEAgLTI3ODAsNyArMjc4Miw3IEBAIGNzY2hlZDJfdW5pdF9taWdyYXRlKAogCiAg
ICAgLyogSWYgaGVyZSwgbmV3X2NwdSBtdXN0IGJlIGEgdmFsaWQgQ3JlZGl0MiBwQ1BVLCBhbmQg
aW4gb3VyIGFmZmluaXR5LiAqLwogICAgIEFTU0VSVChjcHVtYXNrX3Rlc3RfY3B1KG5ld19jcHUs
ICZjc2NoZWQyX3ByaXYob3BzKS0+aW5pdGlhbGl6ZWQpKTsKLSAgICBBU1NFUlQoY3B1bWFza190
ZXN0X2NwdShuZXdfY3B1LCB2Yy0+Y3B1X2hhcmRfYWZmaW5pdHkpKTsKKyAgICBBU1NFUlQoY3B1
bWFza190ZXN0X2NwdShuZXdfY3B1LCB1bml0LT5jcHVfaGFyZF9hZmZpbml0eSkpOwogCiAgICAg
dHJxZCA9IGMycnFkKG9wcywgbmV3X2NwdSk7CiAKQEAgLTMzMjAsOSArMzMyMiw5IEBAIHJ1bnFf
Y2FuZGlkYXRlKHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCwKICAgICB9CiAKICAg
ICAvKiBJZiBzY3VyciBoYXMgYSBzb2Z0LWFmZmluaXR5LCBsZXQncyBjaGVjayB3aGV0aGVyIGNw
dSBpcyBwYXJ0IG9mIGl0ICovCi0gICAgaWYgKCBoYXNfc29mdF9hZmZpbml0eShzY3Vyci0+dmNw
dSkgKQorICAgIGlmICggaGFzX3NvZnRfYWZmaW5pdHkoc2N1cnItPnZjcHUtPnNjaGVkX3VuaXQp
ICkKICAgICB7Ci0gICAgICAgIGFmZmluaXR5X2JhbGFuY2VfY3B1bWFzayhzY3Vyci0+dmNwdSwg
QkFMQU5DRV9TT0ZUX0FGRklOSVRZLAorICAgICAgICBhZmZpbml0eV9iYWxhbmNlX2NwdW1hc2so
c2N1cnItPnZjcHUtPnNjaGVkX3VuaXQsIEJBTEFOQ0VfU09GVF9BRkZJTklUWSwKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGNwdW1hc2tfc2NyYXRjaCk7CiAgICAgICAgIGlmICgg
dW5saWtlbHkoIWNwdW1hc2tfdGVzdF9jcHUoY3B1LCBjcHVtYXNrX3NjcmF0Y2gpKSApCiAgICAg
ICAgIHsKQEAgLTMzNzcsNyArMzM3OSw3IEBAIHJ1bnFfY2FuZGlkYXRlKHN0cnVjdCBjc2NoZWQy
X3J1bnF1ZXVlX2RhdGEgKnJxZCwKICAgICAgICAgfQogCiAgICAgICAgIC8qIE9ubHkgY29uc2lk
ZXIgdmNwdXMgdGhhdCBhcmUgYWxsb3dlZCB0byBydW4gb24gdGhpcyBwcm9jZXNzb3IuICovCi0g
ICAgICAgIGlmICggIWNwdW1hc2tfdGVzdF9jcHUoY3B1LCBzdmMtPnZjcHUtPmNwdV9oYXJkX2Fm
ZmluaXR5KSApCisgICAgICAgIGlmICggIWNwdW1hc2tfdGVzdF9jcHUoY3B1LCBzdmMtPnZjcHUt
PnNjaGVkX3VuaXQtPmNwdV9oYXJkX2FmZmluaXR5KSApCiAgICAgICAgIHsKICAgICAgICAgICAg
ICgqc2tpcHBlZCkrKzsKICAgICAgICAgICAgIGNvbnRpbnVlOwpkaWZmIC0tZ2l0IGEveGVuL2Nv
bW1vbi9zY2hlZF9udWxsLmMgYi94ZW4vY29tbW9uL3NjaGVkX251bGwuYwppbmRleCBlZTNhOGNm
MDY0Li41NmIwMDU1YTQyIDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL3NjaGVkX251bGwuYworKysg
Yi94ZW4vY29tbW9uL3NjaGVkX251bGwuYwpAQCAtMTIzLDcgKzEyMyw4IEBAIHN0YXRpYyBpbmxp
bmUgc3RydWN0IG51bGxfdW5pdCAqbnVsbF91bml0KGNvbnN0IHN0cnVjdCBzY2hlZF91bml0ICp1
bml0KQogc3RhdGljIGlubGluZSBib29sIHZjcHVfY2hlY2tfYWZmaW5pdHkoc3RydWN0IHZjcHUg
KnYsIHVuc2lnbmVkIGludCBjcHUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICB1bnNpZ25lZCBpbnQgYmFsYW5jZV9zdGVwKQogewotICAgIGFmZmluaXR5X2JhbGFuY2Vf
Y3B1bWFzayh2LCBiYWxhbmNlX3N0ZXAsIGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSk7CisgICAg
YWZmaW5pdHlfYmFsYW5jZV9jcHVtYXNrKHYtPnNjaGVkX3VuaXQsIGJhbGFuY2Vfc3RlcCwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgY3B1bWFza19zY3JhdGNoX2NwdShjcHUpKTsKICAg
ICBjcHVtYXNrX2FuZChjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksIGNwdW1hc2tfc2NyYXRjaF9j
cHUoY3B1KSwKICAgICAgICAgICAgICAgICBjcHVwb29sX2RvbWFpbl9jcHVtYXNrKHYtPmRvbWFp
bikpOwogCkBAIC0yODEsMTAgKzI4MiwxMCBAQCBwaWNrX3JlcyhzdHJ1Y3QgbnVsbF9wcml2YXRl
ICpwcnYsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogCiAgICAgZm9yX2VhY2hfYWZmaW5pdHlf
YmFsYW5jZV9zdGVwKCBicyApCiAgICAgewotICAgICAgICBpZiAoIGJzID09IEJBTEFOQ0VfU09G
VF9BRkZJTklUWSAmJiAhaGFzX3NvZnRfYWZmaW5pdHkodikgKQorICAgICAgICBpZiAoIGJzID09
IEJBTEFOQ0VfU09GVF9BRkZJTklUWSAmJiAhaGFzX3NvZnRfYWZmaW5pdHkodW5pdCkgKQogICAg
ICAgICAgICAgY29udGludWU7CiAKLSAgICAgICAgYWZmaW5pdHlfYmFsYW5jZV9jcHVtYXNrKHYs
IGJzLCBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSkpOworICAgICAgICBhZmZpbml0eV9iYWxhbmNl
X2NwdW1hc2sodW5pdCwgYnMsIGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSk7CiAgICAgICAgIGNw
dW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwgY3B1bWFza19zY3JhdGNoX2NwdShj
cHUpLCBjcHVzKTsKIAogICAgICAgICAvKgpAQCAtMzIxLDcgKzMyMiw3IEBAIHBpY2tfcmVzKHN0
cnVjdCBudWxsX3ByaXZhdGUgKnBydiwgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiAgICAgICog
YXMgd2Ugd2lsbCBhY3R1YWxseSBhc3NpZ24gdGhlIHZDUFUgdG8gdGhlIHBDUFUgd2UgcmV0dXJu
IGZyb20gaGVyZSwKICAgICAgKiBvbmx5IGlmIHRoZSBwQ1BVIGlzIGZyZWUuCiAgICAgICovCi0g
ICAgY3B1bWFza19hbmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCBjcHVzLCB2LT5jcHVfaGFy
ZF9hZmZpbml0eSk7CisgICAgY3B1bWFza19hbmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCBj
cHVzLCB1bml0LT5jcHVfaGFyZF9hZmZpbml0eSk7CiAgICAgbmV3X2NwdSA9IGNwdW1hc2tfYW55
KGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSk7CiAKICBvdXQ6CkBAIC00MzAsNyArNDMxLDcgQEAg
c3RhdGljIHZvaWQgbnVsbF91bml0X2luc2VydChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMs
CiAKICAgICBsb2NrID0gdW5pdF9zY2hlZHVsZV9sb2NrKHVuaXQpOwogCi0gICAgY3B1bWFza19h
bmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCB2LT5jcHVfaGFyZF9hZmZpbml0eSwKKyAgICBj
cHVtYXNrX2FuZChjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksIHVuaXQtPmNwdV9oYXJkX2FmZmlu
aXR5LAogICAgICAgICAgICAgICAgIGNwdXBvb2xfZG9tYWluX2NwdW1hc2sodi0+ZG9tYWluKSk7
CiAKICAgICAvKiBJZiB0aGUgcENQVSBpcyBmcmVlLCB3ZSBhc3NpZ24gdiB0byBpdCAqLwpAQCAt
NDg4LDcgKzQ4OSw4IEBAIHN0YXRpYyB2b2lkIF92Y3B1X3JlbW92ZShzdHJ1Y3QgbnVsbF9wcml2
YXRlICpwcnYsIHN0cnVjdCB2Y3B1ICp2KQogICAgIHsKICAgICAgICAgbGlzdF9mb3JfZWFjaF9l
bnRyeSggd3ZjLCAmcHJ2LT53YWl0cSwgd2FpdHFfZWxlbSApCiAgICAgICAgIHsKLSAgICAgICAg
ICAgIGlmICggYnMgPT0gQkFMQU5DRV9TT0ZUX0FGRklOSVRZICYmICFoYXNfc29mdF9hZmZpbml0
eSh3dmMtPnZjcHUpICkKKyAgICAgICAgICAgIGlmICggYnMgPT0gQkFMQU5DRV9TT0ZUX0FGRklO
SVRZICYmCisgICAgICAgICAgICAgICAgICFoYXNfc29mdF9hZmZpbml0eSh3dmMtPnZjcHUtPnNj
aGVkX3VuaXQpICkKICAgICAgICAgICAgICAgICBjb250aW51ZTsKIAogICAgICAgICAgICAgaWYg
KCB2Y3B1X2NoZWNrX2FmZmluaXR5KHd2Yy0+dmNwdSwgY3B1LCBicykgKQpAQCAtNzY3LDcgKzc2
OSw3IEBAIHN0YXRpYyBzdHJ1Y3QgdGFza19zbGljZSBudWxsX3NjaGVkdWxlKGNvbnN0IHN0cnVj
dCBzY2hlZHVsZXIgKm9wcywKICAgICAgICAgICAgIGxpc3RfZm9yX2VhY2hfZW50cnkoIHd2Yywg
JnBydi0+d2FpdHEsIHdhaXRxX2VsZW0gKQogICAgICAgICAgICAgewogICAgICAgICAgICAgICAg
IGlmICggYnMgPT0gQkFMQU5DRV9TT0ZUX0FGRklOSVRZICYmCi0gICAgICAgICAgICAgICAgICAg
ICAhaGFzX3NvZnRfYWZmaW5pdHkod3ZjLT52Y3B1KSApCisgICAgICAgICAgICAgICAgICAgICAh
aGFzX3NvZnRfYWZmaW5pdHkod3ZjLT52Y3B1LT5zY2hlZF91bml0KSApCiAgICAgICAgICAgICAg
ICAgICAgIGNvbnRpbnVlOwogCiAgICAgICAgICAgICAgICAgaWYgKCB2Y3B1X2NoZWNrX2FmZmlu
aXR5KHd2Yy0+dmNwdSwgY3B1LCBicykgKQpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZF9y
dC5jIGIveGVuL2NvbW1vbi9zY2hlZF9ydC5jCmluZGV4IGNkNzM3MTMxYTMuLmQ2NDBkODdiNDMg
MTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWRfcnQuYworKysgYi94ZW4vY29tbW9uL3NjaGVk
X3J0LmMKQEAgLTMyNyw3ICszMjcsNyBAQCBydF9kdW1wX3ZjcHUoY29uc3Qgc3RydWN0IHNjaGVk
dWxlciAqb3BzLCBjb25zdCBzdHJ1Y3QgcnRfdW5pdCAqc3ZjKQogICAgIG1hc2sgPSBjcHVtYXNr
X3NjcmF0Y2hfY3B1KHN2Yy0+dmNwdS0+cHJvY2Vzc29yKTsKIAogICAgIGNwdXBvb2xfbWFzayA9
IGNwdXBvb2xfZG9tYWluX2NwdW1hc2soc3ZjLT52Y3B1LT5kb21haW4pOwotICAgIGNwdW1hc2tf
YW5kKG1hc2ssIGNwdXBvb2xfbWFzaywgc3ZjLT52Y3B1LT5jcHVfaGFyZF9hZmZpbml0eSk7Cisg
ICAgY3B1bWFza19hbmQobWFzaywgY3B1cG9vbF9tYXNrLCBzdmMtPnZjcHUtPnNjaGVkX3VuaXQt
PmNwdV9oYXJkX2FmZmluaXR5KTsKICAgICBwcmludGsoIlslNWQuJS0ydV0gY3B1ICV1LCAoJSJQ
Uklfc3RpbWUiLCAlIlBSSV9zdGltZSIpLCIKICAgICAgICAgICAgIiBjdXJfYj0lIlBSSV9zdGlt
ZSIgY3VyX2Q9JSJQUklfc3RpbWUiIGxhc3Rfc3RhcnQ9JSJQUklfc3RpbWUiXG4iCiAgICAgICAg
ICAgICIgXHRcdCBwcmlvcml0eV9sZXZlbD0lZCBoYXNfZXh0cmF0aW1lPSVkXG4iCkBAIC02NDUs
NyArNjQ1LDcgQEAgcnRfcmVzX3BpY2soY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1
Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKICAgICBpbnQgY3B1OwogCiAgICAgb25saW5lID0gY3B1cG9v
bF9kb21haW5fY3B1bWFzayh2Yy0+ZG9tYWluKTsKLSAgICBjcHVtYXNrX2FuZCgmY3B1cywgb25s
aW5lLCB2Yy0+Y3B1X2hhcmRfYWZmaW5pdHkpOworICAgIGNwdW1hc2tfYW5kKCZjcHVzLCBvbmxp
bmUsIHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5KTsKIAogICAgIGNwdSA9IGNwdW1hc2tfdGVzdF9j
cHUodmMtPnByb2Nlc3NvciwgJmNwdXMpCiAgICAgICAgICAgICA/IHZjLT5wcm9jZXNzb3IKQEAg
LTEwMjMsNyArMTAyMyw4IEBAIHJ1bnFfcGljayhjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMs
IGNvbnN0IGNwdW1hc2tfdCAqbWFzaykKIAogICAgICAgICAvKiBtYXNrIGNwdV9oYXJkX2FmZmlu
aXR5ICYgY3B1cG9vbCAmIG1hc2sgKi8KICAgICAgICAgb25saW5lID0gY3B1cG9vbF9kb21haW5f
Y3B1bWFzayhpdGVyX3N2Yy0+dmNwdS0+ZG9tYWluKTsKLSAgICAgICAgY3B1bWFza19hbmQoJmNw
dV9jb21tb24sIG9ubGluZSwgaXRlcl9zdmMtPnZjcHUtPmNwdV9oYXJkX2FmZmluaXR5KTsKKyAg
ICAgICAgY3B1bWFza19hbmQoJmNwdV9jb21tb24sIG9ubGluZSwKKyAgICAgICAgICAgICAgICAg
ICAgaXRlcl9zdmMtPnZjcHUtPnNjaGVkX3VuaXQtPmNwdV9oYXJkX2FmZmluaXR5KTsKICAgICAg
ICAgY3B1bWFza19hbmQoJmNwdV9jb21tb24sIG1hc2ssICZjcHVfY29tbW9uKTsKICAgICAgICAg
aWYgKCBjcHVtYXNrX2VtcHR5KCZjcHVfY29tbW9uKSApCiAgICAgICAgICAgICBjb250aW51ZTsK
QEAgLTExOTIsNyArMTE5Myw3IEBAIHJ1bnFfdGlja2xlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIg
Km9wcywgc3RydWN0IHJ0X3VuaXQgKm5ldykKICAgICAgICAgcmV0dXJuOwogCiAgICAgb25saW5l
ID0gY3B1cG9vbF9kb21haW5fY3B1bWFzayhuZXctPnZjcHUtPmRvbWFpbik7Ci0gICAgY3B1bWFz
a19hbmQoJm5vdF90aWNrbGVkLCBvbmxpbmUsIG5ldy0+dmNwdS0+Y3B1X2hhcmRfYWZmaW5pdHkp
OworICAgIGNwdW1hc2tfYW5kKCZub3RfdGlja2xlZCwgb25saW5lLCBuZXctPnZjcHUtPnNjaGVk
X3VuaXQtPmNwdV9oYXJkX2FmZmluaXR5KTsKICAgICBjcHVtYXNrX2FuZG5vdCgmbm90X3RpY2ts
ZWQsICZub3RfdGlja2xlZCwgJnBydi0+dGlja2xlZCk7CiAKICAgICAvKgpkaWZmIC0tZ2l0IGEv
eGVuL2NvbW1vbi9zY2hlZHVsZS5jIGIveGVuL2NvbW1vbi9zY2hlZHVsZS5jCmluZGV4IDEzMjFj
ODYxMTEuLjIxMmMxZTYzN2YgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWR1bGUuYworKysg
Yi94ZW4vY29tbW9uL3NjaGVkdWxlLmMKQEAgLTI3MCw2ICsyNzAsMTIgQEAgc3RhdGljIHZvaWQg
c2NoZWRfZnJlZV91bml0KHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogICAgIH0KIAogICAgIHVu
aXQtPnZjcHUtPnNjaGVkX3VuaXQgPSBOVUxMOworCisgICAgZnJlZV9jcHVtYXNrX3Zhcih1bml0
LT5jcHVfaGFyZF9hZmZpbml0eSk7CisgICAgZnJlZV9jcHVtYXNrX3Zhcih1bml0LT5jcHVfaGFy
ZF9hZmZpbml0eV90bXApOworICAgIGZyZWVfY3B1bWFza192YXIodW5pdC0+Y3B1X2hhcmRfYWZm
aW5pdHlfc2F2ZWQpOworICAgIGZyZWVfY3B1bWFza192YXIodW5pdC0+Y3B1X3NvZnRfYWZmaW5p
dHkpOworCiAgICAgeGZyZWUodW5pdCk7CiB9CiAKQEAgLTI5Myw3ICsyOTksMTcgQEAgc3RhdGlj
IHN0cnVjdCBzY2hlZF91bml0ICpzY2hlZF9hbGxvY191bml0KHN0cnVjdCB2Y3B1ICp2KQogICAg
IHVuaXQtPm5leHRfaW5fbGlzdCA9ICpwcmV2X3VuaXQ7CiAgICAgKnByZXZfdW5pdCA9IHVuaXQ7
CiAKKyAgICBpZiAoICF6YWxsb2NfY3B1bWFza192YXIoJnVuaXQtPmNwdV9oYXJkX2FmZmluaXR5
KSB8fAorICAgICAgICAgIXphbGxvY19jcHVtYXNrX3ZhcigmdW5pdC0+Y3B1X2hhcmRfYWZmaW5p
dHlfdG1wKSB8fAorICAgICAgICAgIXphbGxvY19jcHVtYXNrX3ZhcigmdW5pdC0+Y3B1X2hhcmRf
YWZmaW5pdHlfc2F2ZWQpIHx8CisgICAgICAgICAhemFsbG9jX2NwdW1hc2tfdmFyKCZ1bml0LT5j
cHVfc29mdF9hZmZpbml0eSkgKQorICAgICAgICBnb3RvIGZhaWw7CisKICAgICByZXR1cm4gdW5p
dDsKKworIGZhaWw6CisgICAgc2NoZWRfZnJlZV91bml0KHVuaXQpOworICAgIHJldHVybiBOVUxM
OwogfQogCiBpbnQgc2NoZWRfaW5pdF92Y3B1KHN0cnVjdCB2Y3B1ICp2LCB1bnNpZ25lZCBpbnQg
cHJvY2Vzc29yKQpAQCAtMzYzLDcgKzM3OSw3IEBAIGludCBzY2hlZF9tb3ZlX2RvbWFpbihzdHJ1
Y3QgZG9tYWluICpkLCBzdHJ1Y3QgY3B1cG9vbCAqYykKIAogICAgIGZvcl9lYWNoX3ZjcHUgKCBk
LCB2ICkKICAgICB7Ci0gICAgICAgIGlmICggdi0+YWZmaW5pdHlfYnJva2VuICkKKyAgICAgICAg
aWYgKCB2LT5zY2hlZF91bml0LT5hZmZpbml0eV9icm9rZW4gKQogICAgICAgICAgICAgcmV0dXJu
IC1FQlVTWTsKICAgICB9CiAKQEAgLTY4Miw3ICs2OTgsNyBAQCBzdGF0aWMgdm9pZCB2Y3B1X21p
Z3JhdGVfZmluaXNoKHN0cnVjdCB2Y3B1ICp2KQogICAgICAgICAgICAgICovCiAgICAgICAgICAg
ICBpZiAoIHBpY2tfY2FsbGVkICYmCiAgICAgICAgICAgICAgICAgIChuZXdfbG9jayA9PSBnZXRf
c2NoZWRfcmVzKG5ld19jcHUpLT5zY2hlZHVsZV9sb2NrKSAmJgotICAgICAgICAgICAgICAgICBj
cHVtYXNrX3Rlc3RfY3B1KG5ld19jcHUsIHYtPmNwdV9oYXJkX2FmZmluaXR5KSAmJgorICAgICAg
ICAgICAgICAgICBjcHVtYXNrX3Rlc3RfY3B1KG5ld19jcHUsIHYtPnNjaGVkX3VuaXQtPmNwdV9o
YXJkX2FmZmluaXR5KSAmJgogICAgICAgICAgICAgICAgICBjcHVtYXNrX3Rlc3RfY3B1KG5ld19j
cHUsIHYtPmRvbWFpbi0+Y3B1cG9vbC0+Y3B1X3ZhbGlkKSApCiAgICAgICAgICAgICAgICAgYnJl
YWs7CiAKQEAgLTc1OCw2ICs3NzQsNyBAQCB2b2lkIHJlc3RvcmVfdmNwdV9hZmZpbml0eShzdHJ1
Y3QgZG9tYWluICpkKQogICAgIHsKICAgICAgICAgc3BpbmxvY2tfdCAqbG9jazsKICAgICAgICAg
dW5zaWduZWQgaW50IG9sZF9jcHUgPSB2LT5wcm9jZXNzb3I7CisgICAgICAgIHN0cnVjdCBzY2hl
ZF91bml0ICp1bml0ID0gdi0+c2NoZWRfdW5pdDsKIAogICAgICAgICBBU1NFUlQoIXZjcHVfcnVu
bmFibGUodikpOwogCkBAIC03NjksMTUgKzc4NiwxNSBAQCB2b2lkIHJlc3RvcmVfdmNwdV9hZmZp
bml0eShzdHJ1Y3QgZG9tYWluICpkKQogICAgICAgICAgKiBzZXQgdi0+cHJvY2Vzc29yIG9mIGVh
Y2ggb2YgdGhlaXIgdkNQVXMgdG8gc29tZXRoaW5nIHRoYXQgd2lsbAogICAgICAgICAgKiBtYWtl
IHNlbnNlIGZvciB0aGUgc2NoZWR1bGVyIG9mIHRoZSBjcHVwb29sIGluIHdoaWNoIHRoZXkgYXJl
IGluLgogICAgICAgICAgKi8KLSAgICAgICAgY3B1bWFza19hbmQoY3B1bWFza19zY3JhdGNoX2Nw
dShjcHUpLCB2LT5jcHVfaGFyZF9hZmZpbml0eSwKKyAgICAgICAgY3B1bWFza19hbmQoY3B1bWFz
a19zY3JhdGNoX2NwdShjcHUpLCB1bml0LT5jcHVfaGFyZF9hZmZpbml0eSwKICAgICAgICAgICAg
ICAgICAgICAgY3B1cG9vbF9kb21haW5fY3B1bWFzayhkKSk7CiAgICAgICAgIGlmICggY3B1bWFz
a19lbXB0eShjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSkpICkKICAgICAgICAgewotICAgICAgICAg
ICAgaWYgKCB2LT5hZmZpbml0eV9icm9rZW4gKQorICAgICAgICAgICAgaWYgKCB1bml0LT5hZmZp
bml0eV9icm9rZW4gKQogICAgICAgICAgICAgewotICAgICAgICAgICAgICAgIHNjaGVkX3NldF9h
ZmZpbml0eSh2LCB2LT5jcHVfaGFyZF9hZmZpbml0eV9zYXZlZCwgTlVMTCk7Ci0gICAgICAgICAg
ICAgICAgdi0+YWZmaW5pdHlfYnJva2VuID0gMDsKLSAgICAgICAgICAgICAgICBjcHVtYXNrX2Fu
ZChjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksIHYtPmNwdV9oYXJkX2FmZmluaXR5LAorICAgICAg
ICAgICAgICAgIHNjaGVkX3NldF9hZmZpbml0eSh2LCB1bml0LT5jcHVfaGFyZF9hZmZpbml0eV9z
YXZlZCwgTlVMTCk7CisgICAgICAgICAgICAgICAgdW5pdC0+YWZmaW5pdHlfYnJva2VuID0gMDsK
KyAgICAgICAgICAgICAgICBjcHVtYXNrX2FuZChjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksIHVu
aXQtPmNwdV9oYXJkX2FmZmluaXR5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNwdXBv
b2xfZG9tYWluX2NwdW1hc2soZCkpOwogICAgICAgICAgICAgfQogCkBAIC03ODUsMTggKzgwMiwx
NyBAQCB2b2lkIHJlc3RvcmVfdmNwdV9hZmZpbml0eShzdHJ1Y3QgZG9tYWluICpkKQogICAgICAg
ICAgICAgewogICAgICAgICAgICAgICAgIHByaW50ayhYRU5MT0dfREVCVUcgIkJyZWFraW5nIGFm
ZmluaXR5IGZvciAlcHZcbiIsIHYpOwogICAgICAgICAgICAgICAgIHNjaGVkX3NldF9hZmZpbml0
eSh2LCAmY3B1bWFza19hbGwsIE5VTEwpOwotICAgICAgICAgICAgICAgIGNwdW1hc2tfYW5kKGNw
dW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwgdi0+Y3B1X2hhcmRfYWZmaW5pdHksCisgICAgICAgICAg
ICAgICAgY3B1bWFza19hbmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCB1bml0LT5jcHVfaGFy
ZF9hZmZpbml0eSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcHVwb29sX2RvbWFpbl9j
cHVtYXNrKGQpKTsKICAgICAgICAgICAgIH0KICAgICAgICAgfQogCiAgICAgICAgIHYtPnByb2Nl
c3NvciA9IGNwdW1hc2tfYW55KGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSk7Ci0gICAgICAgIHYt
PnNjaGVkX3VuaXQtPnJlcyA9IGdldF9zY2hlZF9yZXModi0+cHJvY2Vzc29yKTsKKyAgICAgICAg
dW5pdC0+cmVzID0gZ2V0X3NjaGVkX3Jlcyh2LT5wcm9jZXNzb3IpOwogCi0gICAgICAgIGxvY2sg
PSB1bml0X3NjaGVkdWxlX2xvY2tfaXJxKHYtPnNjaGVkX3VuaXQpOwotICAgICAgICB2LT5zY2hl
ZF91bml0LT5yZXMgPSBzY2hlZF9waWNrX3Jlc291cmNlKHZjcHVfc2NoZWR1bGVyKHYpLAotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYtPnNjaGVkX3Vu
aXQpOwotICAgICAgICB2LT5wcm9jZXNzb3IgPSB2LT5zY2hlZF91bml0LT5yZXMtPnByb2Nlc3Nv
cjsKKyAgICAgICAgbG9jayA9IHVuaXRfc2NoZWR1bGVfbG9ja19pcnEodW5pdCk7CisgICAgICAg
IHVuaXQtPnJlcyA9IHNjaGVkX3BpY2tfcmVzb3VyY2UodmNwdV9zY2hlZHVsZXIodiksIHVuaXQp
OworICAgICAgICB2LT5wcm9jZXNzb3IgPSB1bml0LT5yZXMtPnByb2Nlc3NvcjsKICAgICAgICAg
c3Bpbl91bmxvY2tfaXJxKGxvY2spOwogCiAgICAgICAgIGlmICggb2xkX2NwdSAhPSB2LT5wcm9j
ZXNzb3IgKQpAQCAtODI4LDE2ICs4NDQsMTcgQEAgaW50IGNwdV9kaXNhYmxlX3NjaGVkdWxlcih1
bnNpZ25lZCBpbnQgY3B1KQogICAgICAgICBmb3JfZWFjaF92Y3B1ICggZCwgdiApCiAgICAgICAg
IHsKICAgICAgICAgICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7Ci0gICAgICAgICAgICBzcGlubG9j
a190ICpsb2NrID0gdW5pdF9zY2hlZHVsZV9sb2NrX2lycXNhdmUodi0+c2NoZWRfdW5pdCwgJmZs
YWdzKTsKKyAgICAgICAgICAgIHN0cnVjdCBzY2hlZF91bml0ICp1bml0ID0gdi0+c2NoZWRfdW5p
dDsKKyAgICAgICAgICAgIHNwaW5sb2NrX3QgKmxvY2sgPSB1bml0X3NjaGVkdWxlX2xvY2tfaXJx
c2F2ZSh1bml0LCAmZmxhZ3MpOwogCi0gICAgICAgICAgICBjcHVtYXNrX2FuZCgmb25saW5lX2Fm
ZmluaXR5LCB2LT5jcHVfaGFyZF9hZmZpbml0eSwgYy0+Y3B1X3ZhbGlkKTsKKyAgICAgICAgICAg
IGNwdW1hc2tfYW5kKCZvbmxpbmVfYWZmaW5pdHksIHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5LCBj
LT5jcHVfdmFsaWQpOwogICAgICAgICAgICAgaWYgKCBjcHVtYXNrX2VtcHR5KCZvbmxpbmVfYWZm
aW5pdHkpICYmCi0gICAgICAgICAgICAgICAgIGNwdW1hc2tfdGVzdF9jcHUoY3B1LCB2LT5jcHVf
aGFyZF9hZmZpbml0eSkgKQorICAgICAgICAgICAgICAgICBjcHVtYXNrX3Rlc3RfY3B1KGNwdSwg
dW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHkpICkKICAgICAgICAgICAgIHsKLSAgICAgICAgICAgICAg
ICBpZiAoIHYtPmFmZmluaXR5X2Jyb2tlbiApCisgICAgICAgICAgICAgICAgaWYgKCB1bml0LT5h
ZmZpbml0eV9icm9rZW4gKQogICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAg
LyogVGhlIHZjcHUgaXMgdGVtcG9yYXJpbHkgcGlubmVkLCBjYW4ndCBtb3ZlIGl0LiAqLwotICAg
ICAgICAgICAgICAgICAgICB1bml0X3NjaGVkdWxlX3VubG9ja19pcnFyZXN0b3JlKGxvY2ssIGZs
YWdzLCB2LT5zY2hlZF91bml0KTsKKyAgICAgICAgICAgICAgICAgICAgdW5pdF9zY2hlZHVsZV91
bmxvY2tfaXJxcmVzdG9yZShsb2NrLCBmbGFncywgdW5pdCk7CiAgICAgICAgICAgICAgICAgICAg
IHJldCA9IC1FQUREUklOVVNFOwogICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg
ICAgICAgICB9CkBAIC04NTAsNyArODY3LDcgQEAgaW50IGNwdV9kaXNhYmxlX3NjaGVkdWxlcih1
bnNpZ25lZCBpbnQgY3B1KQogICAgICAgICAgICAgaWYgKCB2LT5wcm9jZXNzb3IgIT0gY3B1ICkK
ICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAvKiBUaGUgdmNwdSBpcyBub3Qgb24gdGhp
cyBjcHUsIHNvIHdlIGNhbiBtb3ZlIG9uLiAqLwotICAgICAgICAgICAgICAgIHVuaXRfc2NoZWR1
bGVfdW5sb2NrX2lycXJlc3RvcmUobG9jaywgZmxhZ3MsIHYtPnNjaGVkX3VuaXQpOworICAgICAg
ICAgICAgICAgIHVuaXRfc2NoZWR1bGVfdW5sb2NrX2lycXJlc3RvcmUobG9jaywgZmxhZ3MsIHVu
aXQpOwogICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgfQogCkBAIC04NjMs
NyArODgwLDcgQEAgaW50IGNwdV9kaXNhYmxlX3NjaGVkdWxlcih1bnNpZ25lZCBpbnQgY3B1KQog
ICAgICAgICAgICAgICogICAgdGhpbmdzIHdvdWxkIGhhdmUgZmFpbGVkIGJlZm9yZSBnZXR0aW5n
IGluIGhlcmUuCiAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgIHZjcHVfbWlncmF0ZV9zdGFy
dCh2KTsKLSAgICAgICAgICAgIHVuaXRfc2NoZWR1bGVfdW5sb2NrX2lycXJlc3RvcmUobG9jaywg
ZmxhZ3MsIHYtPnNjaGVkX3VuaXQpOworICAgICAgICAgICAgdW5pdF9zY2hlZHVsZV91bmxvY2tf
aXJxcmVzdG9yZShsb2NrLCBmbGFncywgdW5pdCk7CiAKICAgICAgICAgICAgIHZjcHVfbWlncmF0
ZV9maW5pc2godik7CiAKQEAgLTg5Miw3ICs5MDksNyBAQCBzdGF0aWMgaW50IGNwdV9kaXNhYmxl
X3NjaGVkdWxlcl9jaGVjayh1bnNpZ25lZCBpbnQgY3B1KQogCiAgICAgZm9yX2VhY2hfZG9tYWlu
X2luX2NwdXBvb2wgKCBkLCBjICkKICAgICAgICAgZm9yX2VhY2hfdmNwdSAoIGQsIHYgKQotICAg
ICAgICAgICAgaWYgKCB2LT5hZmZpbml0eV9icm9rZW4gKQorICAgICAgICAgICAgaWYgKCB2LT5z
Y2hlZF91bml0LT5hZmZpbml0eV9icm9rZW4gKQogICAgICAgICAgICAgICAgIHJldHVybiAtRUFE
RFJJTlVTRTsKIAogICAgIHJldHVybiAwOwpAQCAtOTA4LDI4ICs5MjUsMzEgQEAgc3RhdGljIGlu
dCBjcHVfZGlzYWJsZV9zY2hlZHVsZXJfY2hlY2sodW5zaWduZWQgaW50IGNwdSkKIHZvaWQgc2No
ZWRfc2V0X2FmZmluaXR5KAogICAgIHN0cnVjdCB2Y3B1ICp2LCBjb25zdCBjcHVtYXNrX3QgKmhh
cmQsIGNvbnN0IGNwdW1hc2tfdCAqc29mdCkKIHsKLSAgICBzY2hlZF9hZGp1c3RfYWZmaW5pdHko
ZG9tX3NjaGVkdWxlcih2LT5kb21haW4pLCB2LT5zY2hlZF91bml0LCBoYXJkLCBzb2Z0KTsKKyAg
ICBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCA9IHYtPnNjaGVkX3VuaXQ7CisKKyAgICBzY2hlZF9h
ZGp1c3RfYWZmaW5pdHkoZG9tX3NjaGVkdWxlcih2LT5kb21haW4pLCB1bml0LCBoYXJkLCBzb2Z0
KTsKIAogICAgIGlmICggaGFyZCApCi0gICAgICAgIGNwdW1hc2tfY29weSh2LT5jcHVfaGFyZF9h
ZmZpbml0eSwgaGFyZCk7CisgICAgICAgIGNwdW1hc2tfY29weSh1bml0LT5jcHVfaGFyZF9hZmZp
bml0eSwgaGFyZCk7CiAgICAgaWYgKCBzb2Z0ICkKLSAgICAgICAgY3B1bWFza19jb3B5KHYtPmNw
dV9zb2Z0X2FmZmluaXR5LCBzb2Z0KTsKKyAgICAgICAgY3B1bWFza19jb3B5KHVuaXQtPmNwdV9z
b2Z0X2FmZmluaXR5LCBzb2Z0KTsKIAotICAgIHYtPnNvZnRfYWZmX2VmZmVjdGl2ZSA9ICFjcHVt
YXNrX3N1YnNldCh2LT5jcHVfaGFyZF9hZmZpbml0eSwKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgdi0+Y3B1X3NvZnRfYWZmaW5pdHkpICYmCi0gICAgICAgICAg
ICAgICAgICAgICAgICAgICAgY3B1bWFza19pbnRlcnNlY3RzKHYtPmNwdV9zb2Z0X2FmZmluaXR5
LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2LT5jcHVf
aGFyZF9hZmZpbml0eSk7CisgICAgdW5pdC0+c29mdF9hZmZfZWZmZWN0aXZlID0gIWNwdW1hc2tf
c3Vic2V0KHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5LAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICB1bml0LT5jcHVfc29mdF9hZmZpbml0eSkgJiYKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBjcHVtYXNrX2ludGVyc2VjdHModW5pdC0+Y3B1X3Nv
ZnRfYWZmaW5pdHksCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5KTsKIH0KIAogc3RhdGljIGludCB2Y3B1X3Nl
dF9hZmZpbml0eSgKICAgICBzdHJ1Y3QgdmNwdSAqdiwgY29uc3QgY3B1bWFza190ICphZmZpbml0
eSwgY29uc3QgY3B1bWFza190ICp3aGljaCkKIHsKKyAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5p
dCA9IHYtPnNjaGVkX3VuaXQ7CiAgICAgc3BpbmxvY2tfdCAqbG9jazsKICAgICBpbnQgcmV0ID0g
MDsKIAotICAgIGxvY2sgPSB1bml0X3NjaGVkdWxlX2xvY2tfaXJxKHYtPnNjaGVkX3VuaXQpOwor
ICAgIGxvY2sgPSB1bml0X3NjaGVkdWxlX2xvY2tfaXJxKHVuaXQpOwogCi0gICAgaWYgKCB2LT5h
ZmZpbml0eV9icm9rZW4gKQorICAgIGlmICggdW5pdC0+YWZmaW5pdHlfYnJva2VuICkKICAgICAg
ICAgcmV0ID0gLUVCVVNZOwogICAgIGVsc2UKICAgICB7CkBAIC05MzcsMTkgKzk1NywxOSBAQCBz
dGF0aWMgaW50IHZjcHVfc2V0X2FmZmluaXR5KAogICAgICAgICAgKiBUZWxsIHRoZSBzY2hlZHVs
ZXIgd2UgY2hhbmdlcyBzb21ldGhpbmcgYWJvdXQgYWZmaW5pdHksCiAgICAgICAgICAqIGFuZCBh
c2sgdG8gcmUtZXZhbHVhdGUgdmNwdSBwbGFjZW1lbnQuCiAgICAgICAgICAqLwotICAgICAgICBp
ZiAoIHdoaWNoID09IHYtPmNwdV9oYXJkX2FmZmluaXR5ICkKKyAgICAgICAgaWYgKCB3aGljaCA9
PSB1bml0LT5jcHVfaGFyZF9hZmZpbml0eSApCiAgICAgICAgIHsKICAgICAgICAgICAgIHNjaGVk
X3NldF9hZmZpbml0eSh2LCBhZmZpbml0eSwgTlVMTCk7CiAgICAgICAgIH0KICAgICAgICAgZWxz
ZQogICAgICAgICB7Ci0gICAgICAgICAgICBBU1NFUlQod2hpY2ggPT0gdi0+Y3B1X3NvZnRfYWZm
aW5pdHkpOworICAgICAgICAgICAgQVNTRVJUKHdoaWNoID09IHVuaXQtPmNwdV9zb2Z0X2FmZmlu
aXR5KTsKICAgICAgICAgICAgIHNjaGVkX3NldF9hZmZpbml0eSh2LCBOVUxMLCBhZmZpbml0eSk7
CiAgICAgICAgIH0KICAgICAgICAgdmNwdV9taWdyYXRlX3N0YXJ0KHYpOwogICAgIH0KIAotICAg
IHVuaXRfc2NoZWR1bGVfdW5sb2NrX2lycShsb2NrLCB2LT5zY2hlZF91bml0KTsKKyAgICB1bml0
X3NjaGVkdWxlX3VubG9ja19pcnEobG9jaywgdW5pdCk7CiAKICAgICBkb21haW5fdXBkYXRlX25v
ZGVfYWZmaW5pdHkodi0+ZG9tYWluKTsKIApAQCAtOTY4LDEyICs5ODgsMTIgQEAgaW50IHZjcHVf
c2V0X2hhcmRfYWZmaW5pdHkoc3RydWN0IHZjcHUgKnYsIGNvbnN0IGNwdW1hc2tfdCAqYWZmaW5p
dHkpCiAgICAgaWYgKCBjcHVtYXNrX2VtcHR5KCZvbmxpbmVfYWZmaW5pdHkpICkKICAgICAgICAg
cmV0dXJuIC1FSU5WQUw7CiAKLSAgICByZXR1cm4gdmNwdV9zZXRfYWZmaW5pdHkodiwgYWZmaW5p
dHksIHYtPmNwdV9oYXJkX2FmZmluaXR5KTsKKyAgICByZXR1cm4gdmNwdV9zZXRfYWZmaW5pdHko
diwgYWZmaW5pdHksIHYtPnNjaGVkX3VuaXQtPmNwdV9oYXJkX2FmZmluaXR5KTsKIH0KIAogaW50
IHZjcHVfc2V0X3NvZnRfYWZmaW5pdHkoc3RydWN0IHZjcHUgKnYsIGNvbnN0IGNwdW1hc2tfdCAq
YWZmaW5pdHkpCiB7Ci0gICAgcmV0dXJuIHZjcHVfc2V0X2FmZmluaXR5KHYsIGFmZmluaXR5LCB2
LT5jcHVfc29mdF9hZmZpbml0eSk7CisgICAgcmV0dXJuIHZjcHVfc2V0X2FmZmluaXR5KHYsIGFm
ZmluaXR5LCB2LT5zY2hlZF91bml0LT5jcHVfc29mdF9hZmZpbml0eSk7CiB9CiAKIC8qIEJsb2Nr
IHRoZSBjdXJyZW50bHktZXhlY3V0aW5nIGRvbWFpbiB1bnRpbCBhIHBlcnRpbmVudCBldmVudCBv
Y2N1cnMuICovCkBAIC0xMTY3LDI4ICsxMTg3LDMwIEBAIHZvaWQgd2F0Y2hkb2dfZG9tYWluX2Rl
c3Ryb3koc3RydWN0IGRvbWFpbiAqZCkKIAogaW50IHZjcHVfcGluX292ZXJyaWRlKHN0cnVjdCB2
Y3B1ICp2LCBpbnQgY3B1KQogeworICAgIHN0cnVjdCBzY2hlZF91bml0ICp1bml0ID0gdi0+c2No
ZWRfdW5pdDsKICAgICBzcGlubG9ja190ICpsb2NrOwogICAgIGludCByZXQgPSAtRUlOVkFMOwog
Ci0gICAgbG9jayA9IHVuaXRfc2NoZWR1bGVfbG9ja19pcnEodi0+c2NoZWRfdW5pdCk7CisgICAg
bG9jayA9IHVuaXRfc2NoZWR1bGVfbG9ja19pcnEodW5pdCk7CiAKICAgICBpZiAoIGNwdSA8IDAg
KQogICAgIHsKLSAgICAgICAgaWYgKCB2LT5hZmZpbml0eV9icm9rZW4gKQorICAgICAgICBpZiAo
IHVuaXQtPmFmZmluaXR5X2Jyb2tlbiApCiAgICAgICAgIHsKLSAgICAgICAgICAgIHNjaGVkX3Nl
dF9hZmZpbml0eSh2LCB2LT5jcHVfaGFyZF9hZmZpbml0eV9zYXZlZCwgTlVMTCk7Ci0gICAgICAg
ICAgICB2LT5hZmZpbml0eV9icm9rZW4gPSAwOworICAgICAgICAgICAgc2NoZWRfc2V0X2FmZmlu
aXR5KHYsIHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5X3NhdmVkLCBOVUxMKTsKKyAgICAgICAgICAg
IHVuaXQtPmFmZmluaXR5X2Jyb2tlbiA9IDA7CiAgICAgICAgICAgICByZXQgPSAwOwogICAgICAg
ICB9CiAgICAgfQogICAgIGVsc2UgaWYgKCBjcHUgPCBucl9jcHVfaWRzICkKICAgICB7Ci0gICAg
ICAgIGlmICggdi0+YWZmaW5pdHlfYnJva2VuICkKKyAgICAgICAgaWYgKCB1bml0LT5hZmZpbml0
eV9icm9rZW4gKQogICAgICAgICAgICAgcmV0ID0gLUVCVVNZOwogICAgICAgICBlbHNlIGlmICgg
Y3B1bWFza190ZXN0X2NwdShjcHUsIFZDUFUyT05MSU5FKHYpKSApCiAgICAgICAgIHsKLSAgICAg
ICAgICAgIGNwdW1hc2tfY29weSh2LT5jcHVfaGFyZF9hZmZpbml0eV9zYXZlZCwgdi0+Y3B1X2hh
cmRfYWZmaW5pdHkpOwotICAgICAgICAgICAgdi0+YWZmaW5pdHlfYnJva2VuID0gMTsKKyAgICAg
ICAgICAgIGNwdW1hc2tfY29weSh1bml0LT5jcHVfaGFyZF9hZmZpbml0eV9zYXZlZCwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICB1bml0LT5jcHVfaGFyZF9hZmZpbml0eSk7CisgICAgICAgICAg
ICB1bml0LT5hZmZpbml0eV9icm9rZW4gPSAxOwogICAgICAgICAgICAgc2NoZWRfc2V0X2FmZmlu
aXR5KHYsIGNwdW1hc2tfb2YoY3B1KSwgTlVMTCk7CiAgICAgICAgICAgICByZXQgPSAwOwogICAg
ICAgICB9CkBAIC0xMTk3LDcgKzEyMTksNyBAQCBpbnQgdmNwdV9waW5fb3ZlcnJpZGUoc3RydWN0
IHZjcHUgKnYsIGludCBjcHUpCiAgICAgaWYgKCByZXQgPT0gMCApCiAgICAgICAgIHZjcHVfbWln
cmF0ZV9zdGFydCh2KTsKIAotICAgIHVuaXRfc2NoZWR1bGVfdW5sb2NrX2lycShsb2NrLCB2LT5z
Y2hlZF91bml0KTsKKyAgICB1bml0X3NjaGVkdWxlX3VubG9ja19pcnEobG9jaywgdW5pdCk7CiAK
ICAgICBkb21haW5fdXBkYXRlX25vZGVfYWZmaW5pdHkodi0+ZG9tYWluKTsKIApAQCAtMTU0OSw3
ICsxNTcxLDcgQEAgc3RhdGljIHZvaWQgc2NoZWR1bGUodm9pZCkKICAgICAgICAgKChwcmV2LT5w
YXVzZV9mbGFncyAmIFZQRl9ibG9ja2VkKSA/IFJVTlNUQVRFX2Jsb2NrZWQgOgogICAgICAgICAg
KHZjcHVfcnVubmFibGUocHJldikgPyBSVU5TVEFURV9ydW5uYWJsZSA6IFJVTlNUQVRFX29mZmxp
bmUpKSwKICAgICAgICAgbm93KTsKLSAgICBwcmV2LT5sYXN0X3J1bl90aW1lID0gbm93OworICAg
IHByZXYtPnNjaGVkX3VuaXQtPmxhc3RfcnVuX3RpbWUgPSBub3c7CiAKICAgICBBU1NFUlQobmV4
dC0+cnVuc3RhdGUuc3RhdGUgIT0gUlVOU1RBVEVfcnVubmluZyk7CiAgICAgdmNwdV9ydW5zdGF0
ZV9jaGFuZ2UobmV4dCwgUlVOU1RBVEVfcnVubmluZywgbm93KTsKZGlmZiAtLWdpdCBhL3hlbi9j
b21tb24vd2FpdC5jIGIveGVuL2NvbW1vbi93YWl0LmMKaW5kZXggNGY4MzBhMTRlOC4uMzdlOWUw
ZDAxNiAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi93YWl0LmMKKysrIGIveGVuL2NvbW1vbi93YWl0
LmMKQEAgLTEzMiw3ICsxMzIsNyBAQCBzdGF0aWMgdm9pZCBfX3ByZXBhcmVfdG9fd2FpdChzdHJ1
Y3Qgd2FpdHF1ZXVlX3ZjcHUgKndxdikKIAogICAgIC8qIFNhdmUgY3VycmVudCBWQ1BVIGFmZmlu
aXR5OyBmb3JjZSB3YWtldXAgb24gKnRoaXMqIENQVSBvbmx5LiAqLwogICAgIHdxdi0+d2FrZXVw
X2NwdSA9IHNtcF9wcm9jZXNzb3JfaWQoKTsKLSAgICBjcHVtYXNrX2NvcHkoJndxdi0+c2F2ZWRf
YWZmaW5pdHksIGN1cnItPmNwdV9oYXJkX2FmZmluaXR5KTsKKyAgICBjcHVtYXNrX2NvcHkoJndx
di0+c2F2ZWRfYWZmaW5pdHksIGN1cnItPnNjaGVkX3VuaXQtPmNwdV9oYXJkX2FmZmluaXR5KTsK
ICAgICBpZiAoIHZjcHVfc2V0X2hhcmRfYWZmaW5pdHkoY3VyciwgY3B1bWFza19vZih3cXYtPndh
a2V1cF9jcHUpKSApCiAgICAgewogICAgICAgICBnZHByaW50ayhYRU5MT0dfRVJSLCAiVW5hYmxl
IHRvIHNldCB2Y3B1IGFmZmluaXR5XG4iKTsKQEAgLTE5OSw3ICsxOTksNyBAQCB2b2lkIGNoZWNr
X3dha2V1cF9mcm9tX3dhaXQodm9pZCkKICAgICB7CiAgICAgICAgIC8qIFJlLXNldCBWQ1BVIGFm
ZmluaXR5IGFuZCByZS1lbnRlciB0aGUgc2NoZWR1bGVyLiAqLwogICAgICAgICBzdHJ1Y3QgdmNw
dSAqY3VyciA9IGN1cnJlbnQ7Ci0gICAgICAgIGNwdW1hc2tfY29weSgmd3F2LT5zYXZlZF9hZmZp
bml0eSwgY3Vyci0+Y3B1X2hhcmRfYWZmaW5pdHkpOworICAgICAgICBjcHVtYXNrX2NvcHkoJndx
di0+c2F2ZWRfYWZmaW5pdHksIGN1cnItPnNjaGVkX3VuaXQtPmNwdV9oYXJkX2FmZmluaXR5KTsK
ICAgICAgICAgaWYgKCB2Y3B1X3NldF9oYXJkX2FmZmluaXR5KGN1cnIsIGNwdW1hc2tfb2Yod3F2
LT53YWtldXBfY3B1KSkgKQogICAgICAgICB7CiAgICAgICAgICAgICBnZHByaW50ayhYRU5MT0df
RVJSLCAiVW5hYmxlIHRvIHNldCB2Y3B1IGFmZmluaXR5XG4iKTsKZGlmZiAtLWdpdCBhL3hlbi9p
bmNsdWRlL3hlbi9zY2hlZC1pZi5oIGIveGVuL2luY2x1ZGUveGVuL3NjaGVkLWlmLmgKaW5kZXgg
MjBlMzZlYTM5Yi4uMTdjMDFhYmMyNSAxMDA2NDQKLS0tIGEveGVuL2luY2x1ZGUveGVuL3NjaGVk
LWlmLmgKKysrIGIveGVuL2luY2x1ZGUveGVuL3NjaGVkLWlmLmgKQEAgLTQzOCwxMSArNDM4LDEx
IEBAIHN0YXRpYyBpbmxpbmUgY3B1bWFza190KiBjcHVwb29sX2RvbWFpbl9jcHVtYXNrKHN0cnVj
dCBkb21haW4gKmQpCiAgKiAqIFRoZSBoYXJkIGFmZmluaXR5IGlzIG5vdCBhIHN1YnNldCBvZiBz
b2Z0IGFmZmluaXR5CiAgKiAqIFRoZXJlIGlzIGFuIG92ZXJsYXAgYmV0d2VlbiB0aGUgc29mdCBh
bmQgaGFyZCBhZmZpbml0eSBtYXNrcwogICovCi1zdGF0aWMgaW5saW5lIGludCBoYXNfc29mdF9h
ZmZpbml0eShjb25zdCBzdHJ1Y3QgdmNwdSAqdikKK3N0YXRpYyBpbmxpbmUgaW50IGhhc19zb2Z0
X2FmZmluaXR5KGNvbnN0IHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogewotICAgIHJldHVybiB2
LT5zb2Z0X2FmZl9lZmZlY3RpdmUgJiYKLSAgICAgICAgICAgIWNwdW1hc2tfc3Vic2V0KGNwdXBv
b2xfZG9tYWluX2NwdW1hc2sodi0+ZG9tYWluKSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
IHYtPmNwdV9zb2Z0X2FmZmluaXR5KTsKKyAgICByZXR1cm4gdW5pdC0+c29mdF9hZmZfZWZmZWN0
aXZlICYmCisgICAgICAgICAgICFjcHVtYXNrX3N1YnNldChjcHVwb29sX2RvbWFpbl9jcHVtYXNr
KHVuaXQtPnZjcHUtPmRvbWFpbiksCisgICAgICAgICAgICAgICAgICAgICAgICAgICB1bml0LT5j
cHVfc29mdF9hZmZpbml0eSk7CiB9CiAKIC8qCkBAIC00NTIsMTcgKzQ1MiwxOCBAQCBzdGF0aWMg
aW5saW5lIGludCBoYXNfc29mdF9hZmZpbml0eShjb25zdCBzdHJ1Y3QgdmNwdSAqdikKICAqIHRv
IGF2b2lkIHJ1bm5pbmcgYSB2Y3B1IHdoZXJlIGl0IHdvdWxkIGxpa2UsIGJ1dCBpcyBub3QgYWxs
b3dlZCB0byEKICAqLwogc3RhdGljIGlubGluZSB2b2lkCi1hZmZpbml0eV9iYWxhbmNlX2NwdW1h
c2soY29uc3Qgc3RydWN0IHZjcHUgKnYsIGludCBzdGVwLCBjcHVtYXNrX3QgKm1hc2spCithZmZp
bml0eV9iYWxhbmNlX2NwdW1hc2soY29uc3Qgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQsIGludCBz
dGVwLAorICAgICAgICAgICAgICAgICAgICAgICAgIGNwdW1hc2tfdCAqbWFzaykKIHsKICAgICBp
ZiAoIHN0ZXAgPT0gQkFMQU5DRV9TT0ZUX0FGRklOSVRZICkKICAgICB7Ci0gICAgICAgIGNwdW1h
c2tfYW5kKG1hc2ssIHYtPmNwdV9zb2Z0X2FmZmluaXR5LCB2LT5jcHVfaGFyZF9hZmZpbml0eSk7
CisgICAgICAgIGNwdW1hc2tfYW5kKG1hc2ssIHVuaXQtPmNwdV9zb2Z0X2FmZmluaXR5LCB1bml0
LT5jcHVfaGFyZF9hZmZpbml0eSk7CiAKICAgICAgICAgaWYgKCB1bmxpa2VseShjcHVtYXNrX2Vt
cHR5KG1hc2spKSApCi0gICAgICAgICAgICBjcHVtYXNrX2NvcHkobWFzaywgdi0+Y3B1X2hhcmRf
YWZmaW5pdHkpOworICAgICAgICAgICAgY3B1bWFza19jb3B5KG1hc2ssIHVuaXQtPmNwdV9oYXJk
X2FmZmluaXR5KTsKICAgICB9CiAgICAgZWxzZSAvKiBzdGVwID09IEJBTEFOQ0VfSEFSRF9BRkZJ
TklUWSAqLwotICAgICAgICBjcHVtYXNrX2NvcHkobWFzaywgdi0+Y3B1X2hhcmRfYWZmaW5pdHkp
OworICAgICAgICBjcHVtYXNrX2NvcHkobWFzaywgdW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHkpOwog
fQogCiAjZW5kaWYgLyogX19YRU5fU0NIRURfSUZfSF9fICovCmRpZmYgLS1naXQgYS94ZW4vaW5j
bHVkZS94ZW4vc2NoZWQuaCBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCmluZGV4IGVlMzE2Y2Rk
ZDcuLjEzYzk5YTkxOTQgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCisrKyBi
L3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCkBAIC0xNzUsOSArMTc1LDYgQEAgc3RydWN0IHZjcHUK
ICAgICB9IHJ1bnN0YXRlX2d1ZXN0OyAvKiBndWVzdCBhZGRyZXNzICovCiAjZW5kaWYKIAotICAg
IC8qIGxhc3QgdGltZSB3aGVuIHZDUFUgaXMgc2NoZWR1bGVkIG91dCAqLwotICAgIHVpbnQ2NF90
IGxhc3RfcnVuX3RpbWU7Ci0KICAgICAvKiBIYXMgdGhlIEZQVSBiZWVuIGluaXRpYWxpc2VkPyAq
LwogICAgIGJvb2wgICAgICAgICAgICAgZnB1X2luaXRpYWxpc2VkOwogICAgIC8qIEhhcyB0aGUg
RlBVIGJlZW4gdXNlZCBzaW5jZSBpdCB3YXMgbGFzdCBzYXZlZD8gKi8KQEAgLTIwMyw4ICsyMDAs
NiBAQCBzdHJ1Y3QgdmNwdQogICAgIGJvb2wgICAgICAgICAgICAgZGVmZXJfc2h1dGRvd247CiAg
ICAgLyogVkNQVSBpcyBwYXVzZWQgZm9sbG93aW5nIHNodXRkb3duIHJlcXVlc3QgKGQtPmlzX3No
dXR0aW5nX2Rvd24pPyAqLwogICAgIGJvb2wgICAgICAgICAgICAgcGF1c2VkX2Zvcl9zaHV0ZG93
bjsKLSAgICAvKiBWQ1BVIG5lZWQgYWZmaW5pdHkgcmVzdG9yZWQgKi8KLSAgICBib29sICAgICAg
ICAgICAgIGFmZmluaXR5X2Jyb2tlbjsKIAogICAgIC8qIEEgaHlwZXJjYWxsIGhhcyBiZWVuIHBy
ZWVtcHRlZC4gKi8KICAgICBib29sICAgICAgICAgICAgIGhjYWxsX3ByZWVtcHRlZDsKQEAgLTIx
Myw5ICsyMDgsNiBAQCBzdHJ1Y3QgdmNwdQogICAgIGJvb2wgICAgICAgICAgICAgaGNhbGxfY29t
cGF0OwogI2VuZGlmCiAKLSAgICAvKiBEb2VzIHNvZnQgYWZmaW5pdHkgYWN0dWFsbHkgcGxheSBh
IHJvbGUgKGdpdmVuIGhhcmQgYWZmaW5pdHkpPyAqLwotICAgIGJvb2wgICAgICAgICAgICAgc29m
dF9hZmZfZWZmZWN0aXZlOwotCiAgICAgLyogVGhlIENQVSwgaWYgYW55LCB3aGljaCBpcyBob2xk
aW5nIG9udG8gdGhpcyBWQ1BVJ3Mgc3RhdGUuICovCiAjZGVmaW5lIFZDUFVfQ1BVX0NMRUFOICh+
MHUpCiAgICAgdW5zaWduZWQgaW50ICAgICBkaXJ0eV9jcHU7CkBAIC0yNDcsMTYgKzIzOSw2IEBA
IHN0cnVjdCB2Y3B1CiAgICAgZXZ0Y2huX3BvcnRfdCAgICB2aXJxX3RvX2V2dGNobltOUl9WSVJR
U107CiAgICAgc3BpbmxvY2tfdCAgICAgICB2aXJxX2xvY2s7CiAKLSAgICAvKiBCaXRtYXNrIG9m
IENQVXMgb24gd2hpY2ggdGhpcyBWQ1BVIG1heSBydW4uICovCi0gICAgY3B1bWFza192YXJfdCAg
ICBjcHVfaGFyZF9hZmZpbml0eTsKLSAgICAvKiBVc2VkIHRvIGNoYW5nZSBhZmZpbml0eSB0ZW1w
b3JhcmlseS4gKi8KLSAgICBjcHVtYXNrX3Zhcl90ICAgIGNwdV9oYXJkX2FmZmluaXR5X3RtcDsK
LSAgICAvKiBVc2VkIHRvIHJlc3RvcmUgYWZmaW5pdHkgYWNyb3NzIFMzLiAqLwotICAgIGNwdW1h
c2tfdmFyX3QgICAgY3B1X2hhcmRfYWZmaW5pdHlfc2F2ZWQ7Ci0KLSAgICAvKiBCaXRtYXNrIG9m
IENQVXMgb24gd2hpY2ggdGhpcyBWQ1BVIHByZWZlcnMgdG8gcnVuLiAqLwotICAgIGNwdW1hc2tf
dmFyX3QgICAgY3B1X3NvZnRfYWZmaW5pdHk7Ci0KICAgICAvKiBUYXNrbGV0IGZvciBjb250aW51
ZV9oeXBlcmNhbGxfb25fY3B1KCkuICovCiAgICAgc3RydWN0IHRhc2tsZXQgICBjb250aW51ZV9o
eXBlcmNhbGxfdGFza2xldDsKIApAQCAtMjgzLDYgKzI2NSwyMiBAQCBzdHJ1Y3Qgc2NoZWRfdW5p
dCB7CiAgICAgdm9pZCAgICAgICAgICAgICAgICAgICpwcml2OyAgICAgIC8qIHNjaGVkdWxlciBw
cml2YXRlIGRhdGEgKi8KICAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCAgICAgKm5leHRfaW5fbGlzdDsK
ICAgICBzdHJ1Y3Qgc2NoZWRfcmVzb3VyY2UgKnJlczsKKworICAgIC8qIExhc3QgdGltZSB3aGVu
IHVuaXQgaGFzIGJlZW4gc2NoZWR1bGVkIG91dC4gKi8KKyAgICB1aW50NjRfdCAgICAgICAgICAg
ICAgIGxhc3RfcnVuX3RpbWU7CisKKyAgICAvKiBJdGVtIG5lZWRzIGFmZmluaXR5IHJlc3RvcmVk
LiAqLworICAgIGJvb2wgICAgICAgICAgICAgICAgICAgYWZmaW5pdHlfYnJva2VuOworICAgIC8q
IERvZXMgc29mdCBhZmZpbml0eSBhY3R1YWxseSBwbGF5IGEgcm9sZSAoZ2l2ZW4gaGFyZCBhZmZp
bml0eSk/ICovCisgICAgYm9vbCAgICAgICAgICAgICAgICAgICBzb2Z0X2FmZl9lZmZlY3RpdmU7
CisgICAgLyogQml0bWFzayBvZiBDUFVzIG9uIHdoaWNoIHRoaXMgVkNQVSBtYXkgcnVuLiAqLwor
ICAgIGNwdW1hc2tfdmFyX3QgICAgICAgICAgY3B1X2hhcmRfYWZmaW5pdHk7CisgICAgLyogVXNl
ZCB0byBjaGFuZ2UgYWZmaW5pdHkgdGVtcG9yYXJpbHkuICovCisgICAgY3B1bWFza192YXJfdCAg
ICAgICAgICBjcHVfaGFyZF9hZmZpbml0eV90bXA7CisgICAgLyogVXNlZCB0byByZXN0b3JlIGFm
ZmluaXR5IGFjcm9zcyBTMy4gKi8KKyAgICBjcHVtYXNrX3Zhcl90ICAgICAgICAgIGNwdV9oYXJk
X2FmZmluaXR5X3NhdmVkOworICAgIC8qIEJpdG1hc2sgb2YgQ1BVcyBvbiB3aGljaCB0aGlzIFZD
UFUgcHJlZmVycyB0byBydW4uICovCisgICAgY3B1bWFza192YXJfdCAgICAgICAgICBjcHVfc29m
dF9hZmZpbml0eTsKIH07CiAKICNkZWZpbmUgZm9yX2VhY2hfc2NoZWRfdW5pdChkLCBlKSAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXApAQCAtOTgwLDcgKzk3OCw3IEBA
IHN0YXRpYyBpbmxpbmUgYm9vbCBpc19odm1fdmNwdShjb25zdCBzdHJ1Y3QgdmNwdSAqdikKIHN0
YXRpYyBpbmxpbmUgYm9vbCBpc19od2RvbV9waW5uZWRfdmNwdShjb25zdCBzdHJ1Y3QgdmNwdSAq
dikKIHsKICAgICByZXR1cm4gKGlzX2hhcmR3YXJlX2RvbWFpbih2LT5kb21haW4pICYmCi0gICAg
ICAgICAgICBjcHVtYXNrX3dlaWdodCh2LT5jcHVfaGFyZF9hZmZpbml0eSkgPT0gMSk7CisgICAg
ICAgICAgICBjcHVtYXNrX3dlaWdodCh2LT5zY2hlZF91bml0LT5jcHVfaGFyZF9hZmZpbml0eSkg
PT0gMSk7CiB9CiAKICNpZmRlZiBDT05GSUdfSEFTX1BBU1NUSFJPVUdICi0tIAoyLjE2LjQKCgpf
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwg
bWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3Rz
LnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

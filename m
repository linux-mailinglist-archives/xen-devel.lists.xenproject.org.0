Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id B3971ADB43
	for <lists+xen-devel@lfdr.de>; Mon,  9 Sep 2019 16:34:32 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i7Khq-0001Sv-Q9; Mon, 09 Sep 2019 14:31:50 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=m/oR=XE=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1i7Kho-0001Rt-TN
 for xen-devel@lists.xenproject.org; Mon, 09 Sep 2019 14:31:48 +0000
X-Inumbo-ID: 8804fb50-d30e-11e9-ac0d-12813bfff9fa
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 8804fb50-d30e-11e9-ac0d-12813bfff9fa;
 Mon, 09 Sep 2019 14:31:38 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 47B9BB668;
 Mon,  9 Sep 2019 14:31:37 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Mon,  9 Sep 2019 16:31:30 +0200
Message-Id: <20190909143134.15379-2-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190909143134.15379-1-jgross@suse.com>
References: <20190909143134.15379-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v4 1/5] xen/spinlocks: in debug builds store cpu
 holding the lock
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

QWRkIHRoZSBjcHUgY3VycmVudGx5IGhvbGRpbmcgdGhlIGxvY2sgdG8gc3RydWN0IGxvY2tfZGVi
dWcuIFRoaXMgbWFrZXMKYW5hbHlzaXMgb2YgbG9ja2luZyBlcnJvcnMgZWFzaWVyIGFuZCBpdCBj
YW4gYmUgdGVzdGVkIHdoZXRoZXIgdGhlCmNvcnJlY3QgY3B1IGlzIHJlbGVhc2luZyBhIGxvY2sg
YWdhaW4uCgpTaWduZWQtb2ZmLWJ5OiBKdWVyZ2VuIEdyb3NzIDxqZ3Jvc3NAc3VzZS5jb20+Ci0t
LQpWMjoKLSBhZGp1c3QgdHlwZXMgKEphbiBCZXVsaWNoKQpWNDoKLSBhZGQgZGVmaW5lIGZvciBi
aXRmaWVsZCBzaXplIHRvIHN0b3JlIGNwdSBudW1iZXIgKEphbiBCZXVsaWNoKQotIG1ha2UgcGFk
ZGluZyBmaWVsZCB1bm5hbWVkIChKYW4gQmV1bGljaCkKLS0tCiB4ZW4vY29tbW9uL3NwaW5sb2Nr
LmMgICAgICB8IDMzICsrKysrKysrKysrKysrKysrKysrKysrKysrLS0tLS0tLQogeGVuL2luY2x1
ZGUveGVuL3NwaW5sb2NrLmggfCAyOCArKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tCiAyIGZp
bGVzIGNoYW5nZWQsIDQ1IGluc2VydGlvbnMoKyksIDE2IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdp
dCBhL3hlbi9jb21tb24vc3BpbmxvY2suYyBiL3hlbi9jb21tb24vc3BpbmxvY2suYwppbmRleCA2
YmM1MmQ3MGMwLi4xYmUxYjVlYmU2IDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL3NwaW5sb2NrLmMK
KysrIGIveGVuL2NvbW1vbi9zcGlubG9jay5jCkBAIC0xMyw5ICsxMyw5IEBACiAKIHN0YXRpYyBh
dG9taWNfdCBzcGluX2RlYnVnIF9fcmVhZF9tb3N0bHkgPSBBVE9NSUNfSU5JVCgwKTsKIAotc3Rh
dGljIHZvaWQgY2hlY2tfbG9jayhzdHJ1Y3QgbG9ja19kZWJ1ZyAqZGVidWcpCitzdGF0aWMgdm9p
ZCBjaGVja19sb2NrKHVuaW9uIGxvY2tfZGVidWcgKmRlYnVnKQogewotICAgIGludCBpcnFfc2Fm
ZSA9ICFsb2NhbF9pcnFfaXNfZW5hYmxlZCgpOworICAgIGJvb2wgaXJxX3NhZmUgPSAhbG9jYWxf
aXJxX2lzX2VuYWJsZWQoKTsKIAogICAgIGlmICggdW5saWtlbHkoYXRvbWljX3JlYWQoJnNwaW5f
ZGVidWcpIDw9IDApICkKICAgICAgICAgcmV0dXJuOwpAQCAtNDMsMTggKzQzLDIxIEBAIHN0YXRp
YyB2b2lkIGNoZWNrX2xvY2soc3RydWN0IGxvY2tfZGVidWcgKmRlYnVnKQogICAgICAqLwogICAg
IGlmICggdW5saWtlbHkoZGVidWctPmlycV9zYWZlICE9IGlycV9zYWZlKSApCiAgICAgewotICAg
ICAgICBpbnQgc2VlbiA9IGNtcHhjaGcoJmRlYnVnLT5pcnFfc2FmZSwgLTEsIGlycV9zYWZlKTsK
KyAgICAgICAgdW5pb24gbG9ja19kZWJ1ZyBzZWVuLCBuZXcgPSB7IDAgfTsKIAotICAgICAgICBp
ZiAoIHNlZW4gPT0gIWlycV9zYWZlICkKKyAgICAgICAgbmV3LmlycV9zYWZlID0gaXJxX3NhZmU7
CisgICAgICAgIHNlZW4udmFsID0gY21weGNoZygmZGVidWctPnZhbCwgTE9DS19ERUJVR19JTklU
VkFMLCBuZXcudmFsKTsKKworICAgICAgICBpZiAoICFzZWVuLnVuc2VlbiAmJiBzZWVuLmlycV9z
YWZlID09ICFpcnFfc2FmZSApCiAgICAgICAgIHsKICAgICAgICAgICAgIHByaW50aygiQ0hFQ0tM
T0NLIEZBSUxVUkU6IHByZXYgaXJxc2FmZTogJWQsIGN1cnIgaXJxc2FmZSAlZFxuIiwKLSAgICAg
ICAgICAgICAgICAgICBzZWVuLCBpcnFfc2FmZSk7CisgICAgICAgICAgICAgICAgICAgc2Vlbi5p
cnFfc2FmZSwgaXJxX3NhZmUpOwogICAgICAgICAgICAgQlVHKCk7CiAgICAgICAgIH0KICAgICB9
CiB9CiAKLXN0YXRpYyB2b2lkIGNoZWNrX2JhcnJpZXIoc3RydWN0IGxvY2tfZGVidWcgKmRlYnVn
KQorc3RhdGljIHZvaWQgY2hlY2tfYmFycmllcih1bmlvbiBsb2NrX2RlYnVnICpkZWJ1ZykKIHsK
ICAgICBpZiAoIHVubGlrZWx5KGF0b21pY19yZWFkKCZzcGluX2RlYnVnKSA8PSAwKSApCiAgICAg
ICAgIHJldHVybjsKQEAgLTcwLDcgKzczLDE4IEBAIHN0YXRpYyB2b2lkIGNoZWNrX2JhcnJpZXIo
c3RydWN0IGxvY2tfZGVidWcgKmRlYnVnKQogICAgICAqIEhvd2V2ZXIsIGlmIHdlIHNwaW4gb24g
YW4gSVJRLXVuc2FmZSBsb2NrIHdpdGggSVJRcyBkaXNhYmxlZCB0aGVuIHRoYXQKICAgICAgKiBp
cyBjbGVhcmx5IHdyb25nLCBmb3IgdGhlIHNhbWUgcmVhc29uIG91dGxpbmVkIGluIGNoZWNrX2xv
Y2soKSBhYm92ZS4KICAgICAgKi8KLSAgICBCVUdfT04oIWxvY2FsX2lycV9pc19lbmFibGVkKCkg
JiYgKGRlYnVnLT5pcnFfc2FmZSA9PSAwKSk7CisgICAgQlVHX09OKCFsb2NhbF9pcnFfaXNfZW5h
YmxlZCgpICYmICFkZWJ1Zy0+aXJxX3NhZmUpOworfQorCitzdGF0aWMgdm9pZCBnb3RfbG9jayh1
bmlvbiBsb2NrX2RlYnVnICpkZWJ1ZykKK3sKKyAgICBkZWJ1Zy0+Y3B1ID0gc21wX3Byb2Nlc3Nv
cl9pZCgpOworfQorCitzdGF0aWMgdm9pZCByZWxfbG9jayh1bmlvbiBsb2NrX2RlYnVnICpkZWJ1
ZykKK3sKKyAgICBBU1NFUlQoZGVidWctPmNwdSA9PSBzbXBfcHJvY2Vzc29yX2lkKCkpOworICAg
IGRlYnVnLT5jcHUgPSBTUElOTE9DS19OT19DUFU7CiB9CiAKIHZvaWQgc3Bpbl9kZWJ1Z19lbmFi
bGUodm9pZCkKQEAgLTg3LDYgKzEwMSw4IEBAIHZvaWQgc3Bpbl9kZWJ1Z19kaXNhYmxlKHZvaWQp
CiAKICNkZWZpbmUgY2hlY2tfbG9jayhsKSAoKHZvaWQpMCkKICNkZWZpbmUgY2hlY2tfYmFycmll
cihsKSAoKHZvaWQpMCkKKyNkZWZpbmUgZ290X2xvY2sobCkgKCh2b2lkKTApCisjZGVmaW5lIHJl
bF9sb2NrKGwpICgodm9pZCkwKQogCiAjZW5kaWYKIApAQCAtMTUwLDYgKzE2Niw3IEBAIHZvaWQg
aW5saW5lIF9zcGluX2xvY2tfY2Ioc3BpbmxvY2tfdCAqbG9jaywgdm9pZCAoKmNiKSh2b2lkICop
LCB2b2lkICpkYXRhKQogICAgICAgICAgICAgY2IoZGF0YSk7CiAgICAgICAgIGFyY2hfbG9ja19y
ZWxheCgpOwogICAgIH0KKyAgICBnb3RfbG9jaygmbG9jay0+ZGVidWcpOwogICAgIExPQ0tfUFJP
RklMRV9HT1Q7CiAgICAgcHJlZW1wdF9kaXNhYmxlKCk7CiAgICAgYXJjaF9sb2NrX2FjcXVpcmVf
YmFycmllcigpOwpAQCAtMTgxLDYgKzE5OCw3IEBAIHZvaWQgX3NwaW5fdW5sb2NrKHNwaW5sb2Nr
X3QgKmxvY2spCiAgICAgYXJjaF9sb2NrX3JlbGVhc2VfYmFycmllcigpOwogICAgIHByZWVtcHRf
ZW5hYmxlKCk7CiAgICAgTE9DS19QUk9GSUxFX1JFTDsKKyAgICByZWxfbG9jaygmbG9jay0+ZGVi
dWcpOwogICAgIGFkZF9zaXplZCgmbG9jay0+dGlja2V0cy5oZWFkLCAxKTsKICAgICBhcmNoX2xv
Y2tfc2lnbmFsKCk7CiB9CkBAIC0yMjQsNiArMjQyLDcgQEAgaW50IF9zcGluX3RyeWxvY2soc3Bp
bmxvY2tfdCAqbG9jaykKICAgICBpZiAoIGNtcHhjaGcoJmxvY2stPnRpY2tldHMuaGVhZF90YWls
LAogICAgICAgICAgICAgICAgICBvbGQuaGVhZF90YWlsLCBuZXcuaGVhZF90YWlsKSAhPSBvbGQu
aGVhZF90YWlsICkKICAgICAgICAgcmV0dXJuIDA7CisgICAgZ290X2xvY2soJmxvY2stPmRlYnVn
KTsKICNpZmRlZiBDT05GSUdfTE9DS19QUk9GSUxFCiAgICAgaWYgKGxvY2stPnByb2ZpbGUpCiAg
ICAgICAgIGxvY2stPnByb2ZpbGUtPnRpbWVfbG9ja2VkID0gTk9XKCk7CmRpZmYgLS1naXQgYS94
ZW4vaW5jbHVkZS94ZW4vc3BpbmxvY2suaCBiL3hlbi9pbmNsdWRlL3hlbi9zcGlubG9jay5oCmlu
ZGV4IDJjNzQxNWUyM2EuLjI0NDA1Mzg2YTcgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL3hlbi9z
cGlubG9jay5oCisrKyBiL3hlbi9pbmNsdWRlL3hlbi9zcGlubG9jay5oCkBAIC01LDE1ICs1LDI0
IEBACiAjaW5jbHVkZSA8YXNtL3NwaW5sb2NrLmg+CiAjaW5jbHVkZSA8YXNtL3R5cGVzLmg+CiAK
KyNkZWZpbmUgU1BJTkxPQ0tfQ1BVX0JJVFMgIDEyCisKICNpZm5kZWYgTkRFQlVHCi1zdHJ1Y3Qg
bG9ja19kZWJ1ZyB7Ci0gICAgczE2IGlycV9zYWZlOyAvKiArMTogSVJRLXNhZmU7IDA6IG5vdCBJ
UlEtc2FmZTsgLTE6IGRvbid0IGtub3cgeWV0ICovCit1bmlvbiBsb2NrX2RlYnVnIHsKKyAgICB1
aW50MTZfdCB2YWw7CisjZGVmaW5lIExPQ0tfREVCVUdfSU5JVFZBTCAweGZmZmYKKyAgICBzdHJ1
Y3QgeworICAgICAgICB1aW50MTZfdCBjcHU6U1BJTkxPQ0tfQ1BVX0JJVFM7CisgICAgICAgIHVp
bnQxNl90IDooMTQgLSBTUElOTE9DS19DUFVfQklUUyk7CisgICAgICAgIGJvb2wgaXJxX3NhZmU6
MTsKKyAgICAgICAgYm9vbCB1bnNlZW46MTsKKyAgICB9OwogfTsKLSNkZWZpbmUgX0xPQ0tfREVC
VUcgeyAtMSB9CisjZGVmaW5lIF9MT0NLX0RFQlVHIHsgTE9DS19ERUJVR19JTklUVkFMIH0KIHZv
aWQgc3Bpbl9kZWJ1Z19lbmFibGUodm9pZCk7CiB2b2lkIHNwaW5fZGVidWdfZGlzYWJsZSh2b2lk
KTsKICNlbHNlCi1zdHJ1Y3QgbG9ja19kZWJ1ZyB7IH07Cit1bmlvbiBsb2NrX2RlYnVnIHsgfTsK
ICNkZWZpbmUgX0xPQ0tfREVCVUcgeyB9CiAjZGVmaW5lIHNwaW5fZGVidWdfZW5hYmxlKCkgKCh2
b2lkKTApCiAjZGVmaW5lIHNwaW5fZGVidWdfZGlzYWJsZSgpICgodm9pZCkwKQpAQCAtMTM4LDEx
ICsxNDcsMTIgQEAgdHlwZWRlZiB1bmlvbiB7CiAKIHR5cGVkZWYgc3RydWN0IHNwaW5sb2NrIHsK
ICAgICBzcGlubG9ja190aWNrZXRzX3QgdGlja2V0czsKLSAgICB1MTYgcmVjdXJzZV9jcHU6MTI7
Ci0jZGVmaW5lIFNQSU5MT0NLX05PX0NQVSAweGZmZnUKLSAgICB1MTYgcmVjdXJzZV9jbnQ6NDsK
LSNkZWZpbmUgU1BJTkxPQ0tfTUFYX1JFQ1VSU0UgMHhmdQotICAgIHN0cnVjdCBsb2NrX2RlYnVn
IGRlYnVnOworICAgIHUxNiByZWN1cnNlX2NwdTpTUElOTE9DS19DUFVfQklUUzsKKyNkZWZpbmUg
U1BJTkxPQ0tfTk9fQ1BVICAgICAgICAoKDF1IDw8IFNQSU5MT0NLX0NQVV9CSVRTKSAtIDEpCisj
ZGVmaW5lIFNQSU5MT0NLX1JFQ1VSU0VfQklUUyAgKDE2IC0gU1BJTkxPQ0tfQ1BVX0JJVFMpCisg
ICAgdTE2IHJlY3Vyc2VfY250OlNQSU5MT0NLX1JFQ1VSU0VfQklUUzsKKyNkZWZpbmUgU1BJTkxP
Q0tfTUFYX1JFQ1VSU0UgICAoKDF1IDw8IFNQSU5MT0NLX1JFQ1VSU0VfQklUUykgLSAxKQorICAg
IHVuaW9uIGxvY2tfZGVidWcgZGVidWc7CiAjaWZkZWYgQ09ORklHX0xPQ0tfUFJPRklMRQogICAg
IHN0cnVjdCBsb2NrX3Byb2ZpbGUgKnByb2ZpbGU7CiAjZW5kaWYKLS0gCjIuMTYuNAoKCl9fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWls
aW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVu
cHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

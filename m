Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id E66906E726
	for <lists+xen-devel@lfdr.de>; Fri, 19 Jul 2019 16:10:01 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hoTXy-0006y6-7n; Fri, 19 Jul 2019 14:07:42 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=RcFV=VQ=citrix.com=roger.pau@srs-us1.protection.inumbo.net>)
 id 1hoTXx-0006xn-2h
 for xen-devel@lists.xenproject.org; Fri, 19 Jul 2019 14:07:41 +0000
X-Inumbo-ID: 90329251-aa2e-11e9-8980-bc764e045a96
Received: from esa1.hc3370-68.iphmx.com (unknown [216.71.145.142])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 90329251-aa2e-11e9-8980-bc764e045a96;
 Fri, 19 Jul 2019 14:07:37 +0000 (UTC)
Authentication-Results: esa1.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=roger.pau@citrix.com;
 spf=Pass smtp.mailfrom=roger.pau@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa1.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 roger.pau@citrix.com) identity=pra; client-ip=162.221.158.21;
 receiver=esa1.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="roger.pau@citrix.com"; x-conformance=sidf_compatible
Received-SPF: Pass (esa1.hc3370-68.iphmx.com: domain of
 roger.pau@citrix.com designates 162.221.158.21 as permitted
 sender) identity=mailfrom; client-ip=162.221.158.21;
 receiver=esa1.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="roger.pau@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83 ~all"
Received-SPF: None (esa1.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa1.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: CDg8hExWR2drmCbDriqf/72ocExX8wk7XcxQbeEfTdayYMI5aP/mVZtFpfPJl5ELVn5spUjxor
 OXuNCtVea9C3Tptm2aW/8VkX3BSAsy9Dx6vR7YnpvLad+ydl1texaSxyH6YbHfOfLZpdrZbzHO
 J73lmTnFh2qKXzFoHZ9Ggbkh20YoNVn4YgCRPiBop5lFKRfApneGFPI6et9ixXiRcdGQ9RBhXQ
 UPTUlme1jB43KgBGYTeDUANbaowO0KbfXFeuJYKMzuZ2pnO9F7RI+KjFpWsRJKjj6RZh9T1PK6
 Sy0=
X-SBRS: 2.7
X-MesageID: 3219934
X-Ironport-Server: esa1.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.64,282,1559534400"; 
   d="scan'208";a="3219934"
From: Roger Pau Monne <roger.pau@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Fri, 19 Jul 2019 16:07:20 +0200
Message-ID: <20190719140724.69596-3-roger.pau@citrix.com>
X-Mailer: git-send-email 2.20.1 (Apple Git-117)
In-Reply-To: <20190719140724.69596-1-roger.pau@citrix.com>
References: <20190719140724.69596-1-roger.pau@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v4 2/6] pci: switch pci_conf_read16 to use
 pci_sbdf_t
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Kevin Tian <kevin.tian@intel.com>,
 Stefano Stabellini <sstabellini@kernel.org>,
 Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>, Andrew
 Cooper <andrew.cooper3@citrix.com>, Ian Jackson <ian.jackson@eu.citrix.com>,
 Tim Deegan <tim@xen.org>, Julien Grall <julien.grall@arm.com>,
 Jan Beulich <jbeulich@suse.com>, Brian Woods <brian.woods@amd.com>,
 Roger Pau Monne <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhpcyByZWR1Y2VzIHRoZSBudW1iZXIgb2YgcGFyYW1ldGVycyBvZiB0aGUgZnVuY3Rpb24gdG8g
dHdvLCBhbmQKc2ltcGxpZmllcyBzb21lIG9mIHRoZSBjYWxsaW5nIHNpdGVzLgoKU2lnbmVkLW9m
Zi1ieTogUm9nZXIgUGF1IE1vbm7DqSA8cm9nZXIucGF1QGNpdHJpeC5jb20+ClJldmlld2VkLWJ5
OiBKYW4gQmV1bGljaCA8amJldWxpY2hAc3VzZS5jb20+CkFja2VkLWJ5OiBCcmlhbiBXb29kcyA8
YnJpYW4ud29vZHNAYW1kLmNvbT4KUmV2aWV3ZWQtYnk6IEtldmluIFRpYW4gPGtldmluLnRpYW5A
aW50ZWwuY29tPgotLS0KQ2M6IEphbiBCZXVsaWNoIDxqYmV1bGljaEBzdXNlLmNvbT4KQ2M6IEFu
ZHJldyBDb29wZXIgPGFuZHJldy5jb29wZXIzQGNpdHJpeC5jb20+CkNjOiBXZWkgTGl1IDx3bEB4
ZW4ub3JnPgpDYzogR2VvcmdlIER1bmxhcCA8R2VvcmdlLkR1bmxhcEBldS5jaXRyaXguY29tPgpD
YzogSWFuIEphY2tzb24gPGlhbi5qYWNrc29uQGV1LmNpdHJpeC5jb20+CkNjOiBKdWxpZW4gR3Jh
bGwgPGp1bGllbi5ncmFsbEBhcm0uY29tPgpDYzogS29ucmFkIFJ6ZXN6dXRlayBXaWxrIDxrb25y
YWQud2lsa0BvcmFjbGUuY29tPgpDYzogU3RlZmFubyBTdGFiZWxsaW5pIDxzc3RhYmVsbGluaUBr
ZXJuZWwub3JnPgpDYzogVGltIERlZWdhbiA8dGltQHhlbi5vcmc+CkNjOiBTdXJhdmVlIFN1dGhp
a3VscGFuaXQgPHN1cmF2ZWUuc3V0aGlrdWxwYW5pdEBhbWQuY29tPgpDYzogQnJpYW4gV29vZHMg
PGJyaWFuLndvb2RzQGFtZC5jb20+CkNjOiBLZXZpbiBUaWFuIDxrZXZpbi50aWFuQGludGVsLmNv
bT4KLS0tCkNoYW5nZXMgc2luY2UgdjM6CiAtIENvbnZlcnQgb25lIG1pc3NpbmcgdTE2IHRvIHVp
bnQxNl90LgotLS0KIHhlbi9hcmNoL3g4Ni9kbWlfc2Nhbi5jICAgICAgICAgICAgICAgICAgfCAg
NiArLQogeGVuL2FyY2gveDg2L21zaS5jICAgICAgICAgICAgICAgICAgICAgICB8IDczICsrKysr
KysrKystLS0tLS0tLS0tLS0tLQogeGVuL2FyY2gveDg2L3g4Nl82NC9tbWNvbmZpZy1zaGFyZWQu
YyAgICB8ICAyICstCiB4ZW4vYXJjaC94ODYveDg2XzY0L3BjaS5jICAgICAgICAgICAgICAgIHwg
MjcgKysrKy0tLS0tCiB4ZW4vZHJpdmVycy9jaGFyL2VoY2ktZGJncC5jICAgICAgICAgICAgIHwg
IDUgKy0KIHhlbi9kcml2ZXJzL2NoYXIvbnMxNjU1MC5jICAgICAgICAgICAgICAgfCAxNiArKysr
LS0KIHhlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9pb21tdV9pbml0LmMgfCAgMyArLQogeGVu
L2RyaXZlcnMvcGFzc3Rocm91Z2gvYXRzLmggICAgICAgICAgICB8ICA0ICstCiB4ZW4vZHJpdmVy
cy9wYXNzdGhyb3VnaC9wY2kuYyAgICAgICAgICAgIHwgNDAgKysrKystLS0tLS0tLQogeGVuL2Ry
aXZlcnMvcGFzc3Rocm91Z2gvdnRkL3F1aXJrcy5jICAgICB8ICA5ICsrLQogeGVuL2RyaXZlcnMv
cGFzc3Rocm91Z2gveDg2L2F0cy5jICAgICAgICB8ICA5ICstLQogeGVuL2RyaXZlcnMvcGNpL3Bj
aS5jICAgICAgICAgICAgICAgICAgICB8ICA0ICstCiB4ZW4vZHJpdmVycy92aWRlby92Z2EuYyAg
ICAgICAgICAgICAgICAgIHwgIDggKy0tCiB4ZW4vZHJpdmVycy92cGNpL2hlYWRlci5jICAgICAg
ICAgICAgICAgIHwgMTEgKystLQogeGVuL2RyaXZlcnMvdnBjaS9tc2kuYyAgICAgICAgICAgICAg
ICAgICB8ICAzICstCiB4ZW4vZHJpdmVycy92cGNpL21zaXguYyAgICAgICAgICAgICAgICAgIHwg
IDMgKy0KIHhlbi9kcml2ZXJzL3ZwY2kvdnBjaS5jICAgICAgICAgICAgICAgICAgfCAxMSArKy0t
CiB4ZW4vaW5jbHVkZS94ZW4vcGNpLmggICAgICAgICAgICAgICAgICAgIHwgIDQgKy0KIDE4IGZp
bGVzIGNoYW5nZWQsIDk5IGluc2VydGlvbnMoKyksIDEzOSBkZWxldGlvbnMoLSkKCmRpZmYgLS1n
aXQgYS94ZW4vYXJjaC94ODYvZG1pX3NjYW4uYyBiL3hlbi9hcmNoL3g4Ni9kbWlfc2Nhbi5jCmlu
ZGV4IGZjZGYyZDM5NTIuLjMxY2FhZDEzM2UgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9kbWlf
c2Nhbi5jCisrKyBiL3hlbi9hcmNoL3g4Ni9kbWlfc2Nhbi5jCkBAIC00NjksMTUgKzQ2OSwxNSBA
QCBzdGF0aWMgaW50IF9faW5pdCBpY2gxMF9iaW9zX3F1aXJrKHN0cnVjdCBkbWlfc3lzdGVtX2lk
ICpkKQogewogICAgIHUzMiBwb3J0LCBzbWljdGw7CiAKLSAgICBpZiAoIHBjaV9jb25mX3JlYWQx
NigwLCAwLCAweDFmLCAwLCBQQ0lfVkVORE9SX0lEKSAhPSAweDgwODYgKQorICAgIGlmICggcGNp
X2NvbmZfcmVhZDE2KFBDSV9TQkRGKDAsIDAsIDB4MWYsIDApLCBQQ0lfVkVORE9SX0lEKSAhPSAw
eDgwODYgKQogICAgICAgICByZXR1cm4gMDsKIAotICAgIHN3aXRjaCAoIHBjaV9jb25mX3JlYWQx
NigwLCAwLCAweDFmLCAwLCBQQ0lfREVWSUNFX0lEKSApIHsKKyAgICBzd2l0Y2ggKCBwY2lfY29u
Zl9yZWFkMTYoUENJX1NCREYoMCwgMCwgMHgxZiwgMCksIFBDSV9ERVZJQ0VfSUQpICkgewogICAg
IGNhc2UgMHgzYTE0OgogICAgIGNhc2UgMHgzYTE2OgogICAgIGNhc2UgMHgzYTE4OgogICAgIGNh
c2UgMHgzYTFhOgotICAgICAgICBwb3J0ID0gKHBjaV9jb25mX3JlYWQxNigwLCAwLCAweDFmLCAw
LCAweDQwKSAmIDB4ZmY4MCkgKyAweDMwOworICAgICAgICBwb3J0ID0gKHBjaV9jb25mX3JlYWQx
NihQQ0lfU0JERigwLCAwLCAweDFmLCAwKSwgMHg0MCkgJiAweGZmODApICsgMHgzMDsKICAgICAg
ICAgc21pY3RsID0gaW5sKHBvcnQpOwogICAgICAgICAvKiB0dXJuIG9mZiBMRUdBQ1lfVVNCeywy
fV9FTiBpZiBlbmFibGVkICovCiAgICAgICAgIGlmICggc21pY3RsICYgMHgyMDAwOCApCmRpZmYg
LS1naXQgYS94ZW4vYXJjaC94ODYvbXNpLmMgYi94ZW4vYXJjaC94ODYvbXNpLmMKaW5kZXggZWQ4
Yjg5Y2MwZi4uN2RmOWRkYWNmZiAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L21zaS5jCisrKyBi
L3hlbi9hcmNoL3g4Ni9tc2kuYwpAQCAtMTI0LDI5ICsxMjQsMjAgQEAgc3RhdGljIHZvaWQgbXNp
eF9wdXRfZml4bWFwKHN0cnVjdCBhcmNoX21zaXggKm1zaXgsIGludCBpZHgpCiAKIHN0YXRpYyBi
b29sIG1lbW9yeV9kZWNvZGVkKGNvbnN0IHN0cnVjdCBwY2lfZGV2ICpkZXYpCiB7Ci0gICAgdTgg
YnVzLCBzbG90LCBmdW5jOworICAgIHBjaV9zYmRmX3Qgc2JkZiA9IGRldi0+c2JkZjsKIAotICAg
IGlmICggIWRldi0+aW5mby5pc192aXJ0Zm4gKQotICAgIHsKLSAgICAgICAgYnVzID0gZGV2LT5i
dXM7Ci0gICAgICAgIHNsb3QgPSBQQ0lfU0xPVChkZXYtPmRldmZuKTsKLSAgICAgICAgZnVuYyA9
IFBDSV9GVU5DKGRldi0+ZGV2Zm4pOwotICAgIH0KLSAgICBlbHNlCisgICAgaWYgKCBkZXYtPmlu
Zm8uaXNfdmlydGZuICkKICAgICB7Ci0gICAgICAgIGJ1cyA9IGRldi0+aW5mby5waHlzZm4uYnVz
OwotICAgICAgICBzbG90ID0gUENJX1NMT1QoZGV2LT5pbmZvLnBoeXNmbi5kZXZmbik7Ci0gICAg
ICAgIGZ1bmMgPSBQQ0lfRlVOQyhkZXYtPmluZm8ucGh5c2ZuLmRldmZuKTsKKyAgICAgICAgc2Jk
Zi5idXMgPSBkZXYtPmluZm8ucGh5c2ZuLmJ1czsKKyAgICAgICAgc2JkZi5kZXZmbiA9IGRldi0+
aW5mby5waHlzZm4uZGV2Zm47CiAgICAgfQogCi0gICAgcmV0dXJuICEhKHBjaV9jb25mX3JlYWQx
NihkZXYtPnNlZywgYnVzLCBzbG90LCBmdW5jLCBQQ0lfQ09NTUFORCkgJgotICAgICAgICAgICAg
ICBQQ0lfQ09NTUFORF9NRU1PUlkpOworICAgIHJldHVybiBwY2lfY29uZl9yZWFkMTYoc2JkZiwg
UENJX0NPTU1BTkQpICYgUENJX0NPTU1BTkRfTUVNT1JZOwogfQogCiBzdGF0aWMgYm9vbCBtc2l4
X21lbW9yeV9kZWNvZGVkKGNvbnN0IHN0cnVjdCBwY2lfZGV2ICpkZXYsIHVuc2lnbmVkIGludCBw
b3MpCiB7Ci0gICAgdTE2IGNvbnRyb2wgPSBwY2lfY29uZl9yZWFkMTYoZGV2LT5zZWcsIGRldi0+
YnVzLCBQQ0lfU0xPVChkZXYtPmRldmZuKSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBQQ0lfRlVOQyhkZXYtPmRldmZuKSwgbXNpeF9jb250cm9sX3JlZyhwb3MpKTsKKyAgICB1
aW50MTZfdCBjb250cm9sID0gcGNpX2NvbmZfcmVhZDE2KGRldi0+c2JkZiwgbXNpeF9jb250cm9s
X3JlZyhwb3MpKTsKIAogICAgIGlmICggIShjb250cm9sICYgUENJX01TSVhfRkxBR1NfRU5BQkxF
KSApCiAgICAgICAgIHJldHVybiBmYWxzZTsKQEAgLTIxMSwxNCArMjAyLDEyIEBAIHN0YXRpYyBi
b29sIHJlYWRfbXNpX21zZyhzdHJ1Y3QgbXNpX2Rlc2MgKmVudHJ5LCBzdHJ1Y3QgbXNpX21zZyAq
bXNnKQogICAgICAgICB7CiAgICAgICAgICAgICBtc2ctPmFkZHJlc3NfaGkgPSBwY2lfY29uZl9y
ZWFkMzIoc2VnLCBidXMsIHNsb3QsIGZ1bmMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgbXNpX3VwcGVyX2FkZHJlc3NfcmVnKHBvcykpOwotICAgICAgICAg
ICAgZGF0YSA9IHBjaV9jb25mX3JlYWQxNihzZWcsIGJ1cywgc2xvdCwgZnVuYywKLSAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNpX2RhdGFfcmVnKHBvcywgMSkpOworICAgICAg
ICAgICAgZGF0YSA9IHBjaV9jb25mX3JlYWQxNihkZXYtPnNiZGYsIG1zaV9kYXRhX3JlZyhwb3Ms
IDEpKTsKICAgICAgICAgfQogICAgICAgICBlbHNlCiAgICAgICAgIHsKICAgICAgICAgICAgIG1z
Zy0+YWRkcmVzc19oaSA9IDA7Ci0gICAgICAgICAgICBkYXRhID0gcGNpX2NvbmZfcmVhZDE2KHNl
ZywgYnVzLCBzbG90LCBmdW5jLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBt
c2lfZGF0YV9yZWcocG9zLCAwKSk7CisgICAgICAgICAgICBkYXRhID0gcGNpX2NvbmZfcmVhZDE2
KGRldi0+c2JkZiwgbXNpX2RhdGFfcmVnKHBvcywgMCkpOwogICAgICAgICB9CiAgICAgICAgIG1z
Zy0+ZGF0YSA9IGRhdGE7CiAgICAgICAgIGJyZWFrOwpAQCAtMzM3LDcgKzMyNiw4IEBAIHZvaWQg
c2V0X21zaV9hZmZpbml0eShzdHJ1Y3QgaXJxX2Rlc2MgKmRlc2MsIGNvbnN0IGNwdW1hc2tfdCAq
bWFzaykKIAogdm9pZCBfX21zaV9zZXRfZW5hYmxlKHUxNiBzZWcsIHU4IGJ1cywgdTggc2xvdCwg
dTggZnVuYywgaW50IHBvcywgaW50IGVuYWJsZSkKIHsKLSAgICB1MTYgY29udHJvbCA9IHBjaV9j
b25mX3JlYWQxNihzZWcsIGJ1cywgc2xvdCwgZnVuYywgcG9zICsgUENJX01TSV9GTEFHUyk7Cisg
ICAgdWludDE2X3QgY29udHJvbCA9IHBjaV9jb25mX3JlYWQxNihQQ0lfU0JERihzZWcsIGJ1cywg
c2xvdCwgZnVuYyksCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3Mg
KyBQQ0lfTVNJX0ZMQUdTKTsKIAogICAgIGNvbnRyb2wgJj0gflBDSV9NU0lfRkxBR1NfRU5BQkxF
OwogICAgIGlmICggZW5hYmxlICkKQEAgLTM2OSw3ICszNTksNyBAQCBzdGF0aWMgdm9pZCBtc2l4
X3NldF9lbmFibGUoc3RydWN0IHBjaV9kZXYgKmRldiwgaW50IGVuYWJsZSkKICAgICBwb3MgPSBw
Y2lfZmluZF9jYXBfb2Zmc2V0KHNlZywgYnVzLCBzbG90LCBmdW5jLCBQQ0lfQ0FQX0lEX01TSVgp
OwogICAgIGlmICggcG9zICkKICAgICB7Ci0gICAgICAgIGNvbnRyb2wgPSBwY2lfY29uZl9yZWFk
MTYoc2VnLCBidXMsIHNsb3QsIGZ1bmMsIG1zaXhfY29udHJvbF9yZWcocG9zKSk7CisgICAgICAg
IGNvbnRyb2wgPSBwY2lfY29uZl9yZWFkMTYoZGV2LT5zYmRmLCBtc2l4X2NvbnRyb2xfcmVnKHBv
cykpOwogICAgICAgICBjb250cm9sICY9IH5QQ0lfTVNJWF9GTEFHU19FTkFCTEU7CiAgICAgICAg
IGlmICggZW5hYmxlICkKICAgICAgICAgICAgIGNvbnRyb2wgfD0gUENJX01TSVhfRkxBR1NfRU5B
QkxFOwpAQCAtNDE0LDcgKzQwNCw3IEBAIHN0YXRpYyBib29sIG1zaV9zZXRfbWFza19iaXQoc3Ry
dWN0IGlycV9kZXNjICpkZXNjLCBib29sIGhvc3QsIGJvb2wgZ3Vlc3QpCiAgICAgICAgIGJyZWFr
OwogICAgIGNhc2UgUENJX0NBUF9JRF9NU0lYOgogICAgICAgICBtYXNrYWxsID0gcGRldi0+bXNp
eC0+aG9zdF9tYXNrYWxsOwotICAgICAgICBjb250cm9sID0gcGNpX2NvbmZfcmVhZDE2KHNlZywg
YnVzLCBzbG90LCBmdW5jLAorICAgICAgICBjb250cm9sID0gcGNpX2NvbmZfcmVhZDE2KHBkZXYt
PnNiZGYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNpeF9jb250cm9sX3Jl
ZyhlbnRyeS0+bXNpX2F0dHJpYi5wb3MpKTsKICAgICAgICAgaWYgKCB1bmxpa2VseSghKGNvbnRy
b2wgJiBQQ0lfTVNJWF9GTEFHU19FTkFCTEUpKSApCiAgICAgICAgIHsKQEAgLTU5NCw4ICs1ODQs
NyBAQCBpbnQgc2V0dXBfbXNpX2lycShzdHJ1Y3QgaXJxX2Rlc2MgKmRlc2MsIHN0cnVjdCBtc2lf
ZGVzYyAqbXNpZGVzYykKIAogICAgIGlmICggbXNpZGVzYy0+bXNpX2F0dHJpYi50eXBlID09IFBD
SV9DQVBfSURfTVNJWCApCiAgICAgewotICAgICAgICBjb250cm9sID0gcGNpX2NvbmZfcmVhZDE2
KHBkZXYtPnNlZywgcGRldi0+YnVzLCBQQ0lfU0xPVChwZGV2LT5kZXZmbiksCi0gICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgUENJX0ZVTkMocGRldi0+ZGV2Zm4pLCBjcG9zKTsKKyAg
ICAgICAgY29udHJvbCA9IHBjaV9jb25mX3JlYWQxNihwZGV2LT5zYmRmLCBjcG9zKTsKICAgICAg
ICAgaWYgKCAhKGNvbnRyb2wgJiBQQ0lfTVNJWF9GTEFHU19FTkFCTEUpICkKICAgICAgICAgICAg
IHBjaV9jb25mX3dyaXRlMTYocGRldi0+c2VnLCBwZGV2LT5idXMsIFBDSV9TTE9UKHBkZXYtPmRl
dmZuKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX0ZVTkMocGRldi0+ZGV2Zm4p
LCBjcG9zLApAQCAtNjk4LDcgKzY4Nyw3IEBAIHN0YXRpYyBpbnQgbXNpX2NhcGFiaWxpdHlfaW5p
dChzdHJ1Y3QgcGNpX2RldiAqZGV2LAogICAgIHBvcyA9IHBjaV9maW5kX2NhcF9vZmZzZXQoc2Vn
LCBidXMsIHNsb3QsIGZ1bmMsIFBDSV9DQVBfSURfTVNJKTsKICAgICBpZiAoICFwb3MgKQogICAg
ICAgICByZXR1cm4gLUVOT0RFVjsKLSAgICBjb250cm9sID0gcGNpX2NvbmZfcmVhZDE2KHNlZywg
YnVzLCBzbG90LCBmdW5jLCBtc2lfY29udHJvbF9yZWcocG9zKSk7CisgICAgY29udHJvbCA9IHBj
aV9jb25mX3JlYWQxNihkZXYtPnNiZGYsIG1zaV9jb250cm9sX3JlZyhwb3MpKTsKICAgICBtYXh2
ZWMgPSBtdWx0aV9tc2lfY2FwYWJsZShjb250cm9sKTsKICAgICBpZiAoIG52ZWMgPiBtYXh2ZWMg
KQogICAgICAgICByZXR1cm4gbWF4dmVjOwpAQCAtNzY5LDEzICs3NTgsMTQgQEAgc3RhdGljIHU2
NCByZWFkX3BjaV9tZW1fYmFyKHUxNiBzZWcsIHU4IGJ1cywgdTggc2xvdCwgdTggZnVuYywgdTgg
YmlyLCBpbnQgdmYpCiAgICAgICAgIHVuc2lnbmVkIGludCBwb3MgPSBwY2lfZmluZF9leHRfY2Fw
YWJpbGl0eShzZWcsIGJ1cywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIFBDSV9ERVZGTihzbG90LCBmdW5jKSwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9FWFRfQ0FQX0lEX1NSSU9WKTsKLSAg
ICAgICAgdTE2IGN0cmwgPSBwY2lfY29uZl9yZWFkMTYoc2VnLCBidXMsIHNsb3QsIGZ1bmMsIHBv
cyArIFBDSV9TUklPVl9DVFJMKTsKLSAgICAgICAgdTE2IG51bV92ZiA9IHBjaV9jb25mX3JlYWQx
NihzZWcsIGJ1cywgc2xvdCwgZnVuYywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBwb3MgKyBQQ0lfU1JJT1ZfTlVNX1ZGKTsKLSAgICAgICAgdTE2IG9mZnNldCA9IHBjaV9j
b25mX3JlYWQxNihzZWcsIGJ1cywgc2xvdCwgZnVuYywKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBwb3MgKyBQQ0lfU1JJT1ZfVkZfT0ZGU0VUKTsKLSAgICAgICAgdTE2IHN0
cmlkZSA9IHBjaV9jb25mX3JlYWQxNihzZWcsIGJ1cywgc2xvdCwgZnVuYywKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBwb3MgKyBQQ0lfU1JJT1ZfVkZfU1RSSURFKTsKKyAg
ICAgICAgdWludDE2X3QgY3RybCA9IHBjaV9jb25mX3JlYWQxNihQQ0lfU0JERihzZWcsIGJ1cywg
c2xvdCwgZnVuYyksCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9z
ICsgUENJX1NSSU9WX0NUUkwpOworICAgICAgICB1aW50MTZfdCBudW1fdmYgPSBwY2lfY29uZl9y
ZWFkMTYoUENJX1NCREYoc2VnLCBidXMsIHNsb3QsIGZ1bmMpLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgcG9zICsgUENJX1NSSU9WX05VTV9WRik7CisgICAgICAg
IHVpbnQxNl90IG9mZnNldCA9IHBjaV9jb25mX3JlYWQxNihQQ0lfU0JERihzZWcsIGJ1cywgc2xv
dCwgZnVuYyksCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3Mg
KyBQQ0lfU1JJT1ZfVkZfT0ZGU0VUKTsKKyAgICAgICAgdWludDE2X3Qgc3RyaWRlID0gcGNpX2Nv
bmZfcmVhZDE2KFBDSV9TQkRGKHNlZywgYnVzLCBzbG90LCBmdW5jKSwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvcyArIFBDSV9TUklPVl9WRl9TVFJJREUpOwog
CiAgICAgICAgIGlmICggIXBkZXYgfHwgIXBvcyB8fAogICAgICAgICAgICAgICEoY3RybCAmIFBD
SV9TUklPVl9DVFJMX1ZGRSkgfHwKQEAgLTg2NCw3ICs4NTQsNyBAQCBzdGF0aWMgaW50IG1zaXhf
Y2FwYWJpbGl0eV9pbml0KHN0cnVjdCBwY2lfZGV2ICpkZXYsCiAKICAgICBBU1NFUlQocGNpZGV2
c19sb2NrZWQoKSk7CiAKLSAgICBjb250cm9sID0gcGNpX2NvbmZfcmVhZDE2KHNlZywgYnVzLCBz
bG90LCBmdW5jLCBtc2l4X2NvbnRyb2xfcmVnKHBvcykpOworICAgIGNvbnRyb2wgPSBwY2lfY29u
Zl9yZWFkMTYoZGV2LT5zYmRmLCBtc2l4X2NvbnRyb2xfcmVnKHBvcykpOwogICAgIC8qCiAgICAg
ICogRW5zdXJlIE1TSS1YIGludGVycnVwdHMgYXJlIG1hc2tlZCBkdXJpbmcgc2V0dXAuIFNvbWUg
ZGV2aWNlcyByZXF1aXJlCiAgICAgICogTVNJLVggdG8gYmUgZW5hYmxlZCBiZWZvcmUgd2UgY2Fu
IHRvdWNoIHRoZSBNU0ktWCByZWdpc3RlcnMuIFdlIG5lZWQKQEAgLTExMzEsOCArMTEyMSw3IEBA
IHN0YXRpYyBpbnQgX19wY2lfZW5hYmxlX21zaXgoc3RydWN0IG1zaV9pbmZvICptc2ksIHN0cnVj
dCBtc2lfZGVzYyAqKmRlc2MpCiAgICAgaWYgKCAhcGRldiB8fCAhcG9zICkKICAgICAgICAgcmV0
dXJuIC1FTk9ERVY7CiAKLSAgICBjb250cm9sID0gcGNpX2NvbmZfcmVhZDE2KG1zaS0+c2VnLCBt
c2ktPmJ1cywgc2xvdCwgZnVuYywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1zaXhf
Y29udHJvbF9yZWcocG9zKSk7CisgICAgY29udHJvbCA9IHBjaV9jb25mX3JlYWQxNihwZGV2LT5z
YmRmLCBtc2l4X2NvbnRyb2xfcmVnKHBvcykpOwogICAgIG5yX2VudHJpZXMgPSBtdWx0aV9tc2l4
X2NhcGFibGUoY29udHJvbCk7CiAgICAgaWYgKCBtc2ktPmVudHJ5X25yID49IG5yX2VudHJpZXMg
KQogICAgICAgICByZXR1cm4gLUVJTlZBTDsKQEAgLTExNzgsNyArMTE2Nyw3IEBAIHN0YXRpYyB2
b2lkIF9fcGNpX2Rpc2FibGVfbXNpeChzdHJ1Y3QgbXNpX2Rlc2MgKmVudHJ5KQogICAgIHU4IGZ1
bmMgPSBQQ0lfRlVOQyhkZXYtPmRldmZuKTsKICAgICB1bnNpZ25lZCBpbnQgcG9zID0gcGNpX2Zp
bmRfY2FwX29mZnNldChzZWcsIGJ1cywgc2xvdCwgZnVuYywKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBQQ0lfQ0FQX0lEX01TSVgpOwotICAgIHUxNiBjb250cm9s
ID0gcGNpX2NvbmZfcmVhZDE2KHNlZywgYnVzLCBzbG90LCBmdW5jLAorICAgIHUxNiBjb250cm9s
ID0gcGNpX2NvbmZfcmVhZDE2KGRldi0+c2JkZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBtc2l4X2NvbnRyb2xfcmVnKGVudHJ5LT5tc2lfYXR0cmliLnBvcykpOwogICAgIGJv
b2wgbWFza2FsbCA9IGRldi0+bXNpeC0+aG9zdF9tYXNrYWxsOwogCkBAIC0xMjM2LDggKzEyMjUs
OCBAQCBpbnQgcGNpX3ByZXBhcmVfbXNpeCh1MTYgc2VnLCB1OCBidXMsIHU4IGRldmZuLCBib29s
IG9mZikKICAgICB9CiAgICAgZWxzZQogICAgIHsKLSAgICAgICAgdTE2IGNvbnRyb2wgPSBwY2lf
Y29uZl9yZWFkMTYoc2VnLCBidXMsIHNsb3QsIGZ1bmMsCi0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIG1zaXhfY29udHJvbF9yZWcocG9zKSk7CisgICAgICAgIHVpbnQxNl90
IGNvbnRyb2wgPSBwY2lfY29uZl9yZWFkMTYoUENJX1NCREYzKHNlZywgYnVzLCBkZXZmbiksCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNpeF9jb250cm9sX3Jl
Zyhwb3MpKTsKIAogICAgICAgICByYyA9IG1zaXhfY2FwYWJpbGl0eV9pbml0KHBkZXYsIHBvcywg
TlVMTCwgTlVMTCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtdWx0aV9tc2l4
X2NhcGFibGUoY29udHJvbCkpOwpAQCAtMTMzOSw3ICsxMzI4LDcgQEAgaW50IHBjaV9tc2lfY29u
Zl93cml0ZV9pbnRlcmNlcHQoc3RydWN0IHBjaV9kZXYgKnBkZXYsIHVuc2lnbmVkIGludCByZWcs
CiAgICAgICAgIGlmICggcmVnIDwgZW50cnktPm1zaS5tcG9zIHx8IHJlZyA+PSBlbnRyeS0+bXNp
Lm1wb3MgKyA0IHx8IHNpemUgIT0gNCApCiAgICAgICAgICAgICByZXR1cm4gLUVBQ0NFUzsKIAot
ICAgICAgICBjbnRsID0gcGNpX2NvbmZfcmVhZDE2KHNlZywgYnVzLCBzbG90LCBmdW5jLCBtc2lf
Y29udHJvbF9yZWcocG9zKSk7CisgICAgICAgIGNudGwgPSBwY2lfY29uZl9yZWFkMTYocGRldi0+
c2JkZiwgbXNpX2NvbnRyb2xfcmVnKHBvcykpOwogICAgICAgICB1bnVzZWQgPSB+KHVpbnQzMl90
KTAgPj4gKDMyIC0gbXVsdGlfbXNpX2NhcGFibGUoY250bCkpOwogICAgICAgICBmb3IgKCBwb3Mg
PSAwOyBwb3MgPCBudmVjOyArK3BvcywgKytlbnRyeSApCiAgICAgICAgIHsKQEAgLTE0MTUsOCAr
MTQwNCw3IEBAIGludCBwY2lfcmVzdG9yZV9tc2lfc3RhdGUoc3RydWN0IHBjaV9kZXYgKnBkZXYp
CiAgICAgICAgIH0KICAgICAgICAgZWxzZSBpZiAoICF0eXBlICYmIGVudHJ5LT5tc2lfYXR0cmli
LnR5cGUgPT0gUENJX0NBUF9JRF9NU0lYICkKICAgICAgICAgewotICAgICAgICAgICAgY29udHJv
bCA9IHBjaV9jb25mX3JlYWQxNihwZGV2LT5zZWcsIHBkZXYtPmJ1cywgc2xvdCwgZnVuYywKLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNpeF9jb250cm9sX3JlZyhwb3Mp
KTsKKyAgICAgICAgICAgIGNvbnRyb2wgPSBwY2lfY29uZl9yZWFkMTYocGRldi0+c2JkZiwgbXNp
eF9jb250cm9sX3JlZyhwb3MpKTsKICAgICAgICAgICAgIHBjaV9jb25mX3dyaXRlMTYocGRldi0+
c2VnLCBwZGV2LT5idXMsIHNsb3QsIGZ1bmMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IG1zaXhfY29udHJvbF9yZWcocG9zKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29u
dHJvbCB8IChQQ0lfTVNJWF9GTEFHU19FTkFCTEUgfApAQCAtMTQ1OCw4ICsxNDQ2LDcgQEAgaW50
IHBjaV9yZXN0b3JlX21zaV9zdGF0ZShzdHJ1Y3QgcGNpX2RldiAqcGRldikKICAgICAgICAgewog
ICAgICAgICAgICAgdW5zaWduZWQgaW50IGNwb3MgPSBtc2lfY29udHJvbF9yZWcocG9zKTsKIAot
ICAgICAgICAgICAgY29udHJvbCA9IHBjaV9jb25mX3JlYWQxNihwZGV2LT5zZWcsIHBkZXYtPmJ1
cywgc2xvdCwgZnVuYywgY3BvcykgJgotICAgICAgICAgICAgICAgICAgICAgIH5QQ0lfTVNJX0ZM
QUdTX1FTSVpFOworICAgICAgICAgICAgY29udHJvbCA9IHBjaV9jb25mX3JlYWQxNihwZGV2LT5z
YmRmLCBjcG9zKSAmIH5QQ0lfTVNJX0ZMQUdTX1FTSVpFOwogICAgICAgICAgICAgbXVsdGlfbXNp
X2VuYWJsZShjb250cm9sLCBlbnRyeS0+bXNpLm52ZWMpOwogICAgICAgICAgICAgcGNpX2NvbmZf
d3JpdGUxNihwZGV2LT5zZWcsIHBkZXYtPmJ1cywgc2xvdCwgZnVuYywgY3BvcywgY29udHJvbCk7
CiAKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni94ODZfNjQvbW1jb25maWctc2hhcmVkLmMgYi94
ZW4vYXJjaC94ODYveDg2XzY0L21tY29uZmlnLXNoYXJlZC5jCmluZGV4IDllMWM4MWRjZDIuLjlk
MWRiNTkwZDkgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni94ODZfNjQvbW1jb25maWctc2hhcmVk
LmMKKysrIGIveGVuL2FyY2gveDg2L3g4Nl82NC9tbWNvbmZpZy1zaGFyZWQuYwpAQCAtNjQsNyAr
NjQsNyBAQCBjdXN0b21fcGFyYW0oIm1tY2ZnIiwgcGFyc2VfbW1jZmcpOwogc3RhdGljIGNvbnN0
IGNoYXIgX19pbml0ICpwY2lfbW1jZmdfZTc1MjAodm9pZCkKIHsKICAgICB1MzIgd2luOwotICAg
IHdpbiA9IHBjaV9jb25mX3JlYWQxNigwLCAwLCAwLCAwLCAweGNlKTsKKyAgICB3aW4gPSBwY2lf
Y29uZl9yZWFkMTYoUENJX1NCREYoMCwgMCwgMCwgMCksIDB4Y2UpOwogCiAgICAgd2luID0gd2lu
ICYgMHhmMDAwOwogICAgIGlmKHdpbiA9PSAweDAwMDAgfHwgd2luID09IDB4ZjAwMCkKZGlmZiAt
LWdpdCBhL3hlbi9hcmNoL3g4Ni94ODZfNjQvcGNpLmMgYi94ZW4vYXJjaC94ODYveDg2XzY0L3Bj
aS5jCmluZGV4IGI3MDM4M2ZiMDMuLmZlMzZiNjBjNTAgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4
Ni94ODZfNjQvcGNpLmMKKysrIGIveGVuL2FyY2gveDg2L3g4Nl82NC9wY2kuYwpAQCAtMjQsMjgg
KzI0LDIzIEBAIHVpbnQ4X3QgcGNpX2NvbmZfcmVhZDgocGNpX3NiZGZfdCBzYmRmLCB1bnNpZ25l
ZCBpbnQgcmVnKQogICAgIHJldHVybiBwY2lfY29uZl9yZWFkKFBDSV9DT05GX0FERFJFU1Moc2Jk
ZiwgcmVnKSwgcmVnICYgMywgMSk7CiB9CiAKLSN1bmRlZiBQQ0lfQ09ORl9BRERSRVNTCi0jZGVm
aW5lIFBDSV9DT05GX0FERFJFU1MoYnVzLCBkZXYsIGZ1bmMsIHJlZykgXAotICAgICgweDgwMDAw
MDAwIHwgKGJ1cyA8PCAxNikgfCAoZGV2IDw8IDExKSB8IChmdW5jIDw8IDgpIHwgKHJlZyAmIH4z
KSkKLQotdWludDE2X3QgcGNpX2NvbmZfcmVhZDE2KAotICAgIHVuc2lnbmVkIGludCBzZWcsIHVu
c2lnbmVkIGludCBidXMsIHVuc2lnbmVkIGludCBkZXYsIHVuc2lnbmVkIGludCBmdW5jLAotICAg
IHVuc2lnbmVkIGludCByZWcpCit1aW50MTZfdCBwY2lfY29uZl9yZWFkMTYocGNpX3NiZGZfdCBz
YmRmLCB1bnNpZ25lZCBpbnQgcmVnKQogewotICAgIHUzMiB2YWx1ZTsKLQotICAgIGlmICggc2Vn
IHx8IHJlZyA+IDI1NSApCisgICAgaWYgKCBzYmRmLnNlZyB8fCByZWcgPiAyNTUgKQogICAgIHsK
LSAgICAgICAgcGNpX21tY2ZnX3JlYWQoc2VnLCBidXMsIFBDSV9ERVZGTihkZXYsIGZ1bmMpLCBy
ZWcsIDIsICZ2YWx1ZSk7CisgICAgICAgIHVpbnQzMl90IHZhbHVlOworCisgICAgICAgIHBjaV9t
bWNmZ19yZWFkKHNiZGYuc2VnLCBzYmRmLmJ1cywgc2JkZi5kZXZmbiwgcmVnLCAyLCAmdmFsdWUp
OwogICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgfQotICAgIGVsc2UKLSAgICB7Ci0gICAgICAg
IEJVR19PTigoYnVzID4gMjU1KSB8fCAoZGV2ID4gMzEpIHx8IChmdW5jID4gNykpOwotICAgICAg
ICByZXR1cm4gcGNpX2NvbmZfcmVhZChQQ0lfQ09ORl9BRERSRVNTKGJ1cywgZGV2LCBmdW5jLCBy
ZWcpLCByZWcgJiAyLCAyKTsKLSAgICB9CisKKyAgICByZXR1cm4gcGNpX2NvbmZfcmVhZChQQ0lf
Q09ORl9BRERSRVNTKHNiZGYsIHJlZyksIHJlZyAmIDIsIDIpOwogfQogCisjdW5kZWYgUENJX0NP
TkZfQUREUkVTUworI2RlZmluZSBQQ0lfQ09ORl9BRERSRVNTKGJ1cywgZGV2LCBmdW5jLCByZWcp
IFwKKyAgICAoMHg4MDAwMDAwMCB8IChidXMgPDwgMTYpIHwgKGRldiA8PCAxMSkgfCAoZnVuYyA8
PCA4KSB8IChyZWcgJiB+MykpCisKIHVpbnQzMl90IHBjaV9jb25mX3JlYWQzMigKICAgICB1bnNp
Z25lZCBpbnQgc2VnLCB1bnNpZ25lZCBpbnQgYnVzLCB1bnNpZ25lZCBpbnQgZGV2LCB1bnNpZ25l
ZCBpbnQgZnVuYywKICAgICB1bnNpZ25lZCBpbnQgcmVnKQpkaWZmIC0tZ2l0IGEveGVuL2RyaXZl
cnMvY2hhci9laGNpLWRiZ3AuYyBiL3hlbi9kcml2ZXJzL2NoYXIvZWhjaS1kYmdwLmMKaW5kZXgg
NzFmMGFhYTZhYy4uNjQyNThkYTJkYyAxMDA2NDQKLS0tIGEveGVuL2RyaXZlcnMvY2hhci9laGNp
LWRiZ3AuYworKysgYi94ZW4vZHJpdmVycy9jaGFyL2VoY2ktZGJncC5jCkBAIC0xMDE2LDcgKzEw
MTYsNyBAQCBzdGF0aWMgdm9pZCBudmlkaWFfc2V0X2RlYnVnX3BvcnQoc3RydWN0IGVoY2lfZGJn
cCAqZGJncCwgdW5zaWduZWQgaW50IHBvcnQpCiAKIHN0YXRpYyB2b2lkIF9faW5pdCBkZXRlY3Rf
c2V0X2RlYnVnX3BvcnQoc3RydWN0IGVoY2lfZGJncCAqZGJncCkKIHsKLSAgICBpZiAoIHBjaV9j
b25mX3JlYWQxNigwLCBkYmdwLT5idXMsIGRiZ3AtPnNsb3QsIGRiZ3AtPmZ1bmMsCisgICAgaWYg
KCBwY2lfY29uZl9yZWFkMTYoUENJX1NCREYoMCwgZGJncC0+YnVzLCBkYmdwLT5zbG90LCBkYmdw
LT5mdW5jKSwKICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lfVkVORE9SX0lEKSA9PSAweDEw
ZGUgKQogICAgIHsKICAgICAgICAgZGJncF9wcmludGsoInVzaW5nIG52aWRpYSBzZXRfZGVidWdf
cG9ydFxuIik7CkBAIC0xNDE2LDcgKzE0MTYsOCBAQCBzdGF0aWMgdm9pZCBlaGNpX2RiZ3Bfc3Vz
cGVuZChzdHJ1Y3Qgc2VyaWFsX3BvcnQgKnBvcnQpCiAgICAgc3RvcF90aW1lcigmZGJncC0+dGlt
ZXIpOwogICAgIGRiZ3AtPnRpbWVyLmV4cGlyZXMgPSAwOwogCi0gICAgZGJncC0+cGNpX2NyID0g
cGNpX2NvbmZfcmVhZDE2KDAsIGRiZ3AtPmJ1cywgZGJncC0+c2xvdCwgZGJncC0+ZnVuYywKKyAg
ICBkYmdwLT5wY2lfY3IgPSBwY2lfY29uZl9yZWFkMTYoUENJX1NCREYoMCwgZGJncC0+YnVzLCBk
YmdwLT5zbG90LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBk
YmdwLT5mdW5jKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX0NPTU1B
TkQpOwogCiAgICAgZGJncC0+c3RhdGUgPSBkYmdwX3Vuc2FmZTsKZGlmZiAtLWdpdCBhL3hlbi9k
cml2ZXJzL2NoYXIvbnMxNjU1MC5jIGIveGVuL2RyaXZlcnMvY2hhci9uczE2NTUwLmMKaW5kZXgg
NTQ3MjcwZDBlMS4uOTljMTI1NGNhYyAxMDA2NDQKLS0tIGEveGVuL2RyaXZlcnMvY2hhci9uczE2
NTUwLmMKKysrIGIveGVuL2RyaXZlcnMvY2hhci9uczE2NTUwLmMKQEAgLTg0Niw4ICs4NDYsOCBA
QCBzdGF0aWMgdm9pZCBuczE2NTUwX3N1c3BlbmQoc3RydWN0IHNlcmlhbF9wb3J0ICpwb3J0KQog
CiAjaWZkZWYgQ09ORklHX0hBU19QQ0kKICAgICBpZiAoIHVhcnQtPmJhciApCi0gICAgICAgdWFy
dC0+Y3IgPSBwY2lfY29uZl9yZWFkMTYoMCwgdWFydC0+cHNfYmRmWzBdLCB1YXJ0LT5wc19iZGZb
MV0sCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWFydC0+cHNfYmRmWzJdLCBQ
Q0lfQ09NTUFORCk7CisgICAgICAgdWFydC0+Y3IgPSBwY2lfY29uZl9yZWFkMTYoUENJX1NCREYo
MCwgdWFydC0+cHNfYmRmWzBdLCB1YXJ0LT5wc19iZGZbMV0sCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgdWFydC0+cHNfYmRmWzJdKSwgUENJX0NPTU1BTkQpOwogI2VuZGlmCiB9
CiAKQEAgLTEwNjQsMTAgKzEwNjQsMTIgQEAgcGNpX3VhcnRfY29uZmlnKHN0cnVjdCBuczE2NTUw
ICp1YXJ0LCBib29sX3Qgc2tpcF9hbXQsIHVuc2lnbmVkIGludCBpZHgpCiAgICAgICAgICAgICAg
ICAgdTY0IHNpemUgPSAwOwogICAgICAgICAgICAgICAgIGNvbnN0IHN0cnVjdCBuczE2NTUwX2Nv
bmZpZ19wYXJhbSAqcGFyYW0gPSB1YXJ0X3BhcmFtOwogCi0gICAgICAgICAgICAgICAgbmV4dGYg
PSAoZiB8fCAocGNpX2NvbmZfcmVhZDE2KDAsIGIsIGQsIGYsIFBDSV9IRUFERVJfVFlQRSkgJgor
ICAgICAgICAgICAgICAgIG5leHRmID0gKGYgfHwgKHBjaV9jb25mX3JlYWQxNihQQ0lfU0JERigw
LCBiLCBkLCBmKSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgUENJX0hFQURFUl9UWVBFKSAmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMHg4
MCkpID8gZiArIDEgOiA4OwogCi0gICAgICAgICAgICAgICAgc3dpdGNoICggcGNpX2NvbmZfcmVh
ZDE2KDAsIGIsIGQsIGYsIFBDSV9DTEFTU19ERVZJQ0UpICkKKyAgICAgICAgICAgICAgICBzd2l0
Y2ggKCBwY2lfY29uZl9yZWFkMTYoUENJX1NCREYoMCwgYiwgZCwgZiksCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9DTEFTU19ERVZJQ0UpICkKICAgICAgICAg
ICAgICAgICB7CiAgICAgICAgICAgICAgICAgY2FzZSAweDA3MDA6IC8qIHNpbmdsZSBwb3J0IHNl
cmlhbCAqLwogICAgICAgICAgICAgICAgIGNhc2UgMHgwNzAyOiAvKiBtdWx0aSBwb3J0IHNlcmlh
bCAqLwpAQCAtMTA4NCw4ICsxMDg2LDEwIEBAIHBjaV91YXJ0X2NvbmZpZyhzdHJ1Y3QgbnMxNjU1
MCAqdWFydCwgYm9vbF90IHNraXBfYW10LCB1bnNpZ25lZCBpbnQgaWR4KQogICAgICAgICAgICAg
ICAgIC8qIENoZWNrIGZvciBwYXJhbXMgaW4gdWFydF9jb25maWcgbG9va3VwIHRhYmxlICovCiAg
ICAgICAgICAgICAgICAgZm9yICggaSA9IDA7IGkgPCBBUlJBWV9TSVpFKHVhcnRfY29uZmlnKTsg
aSsrICkKICAgICAgICAgICAgICAgICB7Ci0gICAgICAgICAgICAgICAgICAgIHUxNiB2ZW5kb3Ig
PSBwY2lfY29uZl9yZWFkMTYoMCwgYiwgZCwgZiwgUENJX1ZFTkRPUl9JRCk7Ci0gICAgICAgICAg
ICAgICAgICAgIHUxNiBkZXZpY2UgPSBwY2lfY29uZl9yZWFkMTYoMCwgYiwgZCwgZiwgUENJX0RF
VklDRV9JRCk7CisgICAgICAgICAgICAgICAgICAgIHUxNiB2ZW5kb3IgPSBwY2lfY29uZl9yZWFk
MTYoUENJX1NCREYoMCwgYiwgZCwgZiksCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgUENJX1ZFTkRPUl9JRCk7CisgICAgICAgICAgICAgICAgICAgIHUx
NiBkZXZpY2UgPSBwY2lfY29uZl9yZWFkMTYoUENJX1NCREYoMCwgYiwgZCwgZiksCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX0RFVklDRV9JRCk7
CiAKICAgICAgICAgICAgICAgICAgICAgaWYgKCB1YXJ0X2NvbmZpZ1tpXS52ZW5kb3JfaWQgPT0g
dmVuZG9yICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgdWFydF9jb25maWdbaV0uZGV2X2lk
ID09IGRldmljZSApCmRpZmYgLS1naXQgYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9t
bXVfaW5pdC5jIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL2lvbW11X2luaXQuYwppbmRl
eCA5NDNlMWMzOTNlLi40YzdlMDY1ZmUwIDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhy
b3VnaC9hbWQvaW9tbXVfaW5pdC5jCisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9p
b21tdV9pbml0LmMKQEAgLTc5OSw4ICs3OTksNyBAQCBzdGF0aWMgYm9vbF90IF9faW5pdCBzZXRf
aW9tbXVfaW50ZXJydXB0X2hhbmRsZXIoc3RydWN0IGFtZF9pb21tdSAqaW9tbXUpCiAgICAgICAg
ICAgICAgICAgICAgICAgICBQQ0lfU0xPVChpb21tdS0+YmRmKSwgUENJX0ZVTkMoaW9tbXUtPmJk
ZikpOwogICAgICAgICByZXR1cm4gMDsKICAgICB9Ci0gICAgY29udHJvbCA9IHBjaV9jb25mX3Jl
YWQxNihpb21tdS0+c2VnLCBQQ0lfQlVTKGlvbW11LT5iZGYpLAotICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgUENJX1NMT1QoaW9tbXUtPmJkZiksIFBDSV9GVU5DKGlvbW11LT5iZGYpLAor
ICAgIGNvbnRyb2wgPSBwY2lfY29uZl9yZWFkMTYoUENJX1NCREYyKGlvbW11LT5zZWcsIGlvbW11
LT5iZGYpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW9tbXUtPm1zaS5tc2lfYXR0
cmliLnBvcyArIFBDSV9NU0lfRkxBR1MpOwogICAgIGlvbW11LT5tc2kubXNpLm52ZWMgPSAxOwog
ICAgIGlmICggaXNfbWFza19iaXRfc3VwcG9ydChjb250cm9sKSApCmRpZmYgLS1naXQgYS94ZW4v
ZHJpdmVycy9wYXNzdGhyb3VnaC9hdHMuaCBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2F0cy5o
CmluZGV4IGJlZTEzOTExYzAuLjIyYWUyMDliMzcgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL3Bh
c3N0aHJvdWdoL2F0cy5oCisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2F0cy5oCkBAIC0z
NSw4ICszNSw4IEBAIHN0YXRpYyBpbmxpbmUgaW50IHBjaV9hdHNfZW5hYmxlZChpbnQgc2VnLCBp
bnQgYnVzLCBpbnQgZGV2Zm4pCiAgICAgcG9zID0gcGNpX2ZpbmRfZXh0X2NhcGFiaWxpdHkoc2Vn
LCBidXMsIGRldmZuLCBQQ0lfRVhUX0NBUF9JRF9BVFMpOwogICAgIEJVR19PTighcG9zKTsKIAot
ICAgIHZhbHVlID0gcGNpX2NvbmZfcmVhZDE2KHNlZywgYnVzLCBQQ0lfU0xPVChkZXZmbiksIFBD
SV9GVU5DKGRldmZuKSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3MgKyBBVFNfUkVH
X0NUTCk7CisgICAgdmFsdWUgPSBwY2lfY29uZl9yZWFkMTYoUENJX1NCREYzKHNlZywgYnVzLCBk
ZXZmbiksIHBvcyArIEFUU19SRUdfQ1RMKTsKKwogICAgIHJldHVybiB2YWx1ZSAmIEFUU19FTkFC
TEU7CiB9CiAKZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3BjaS5jIGIveGVu
L2RyaXZlcnMvcGFzc3Rocm91Z2gvcGNpLmMKaW5kZXggMzQwZTk1Nzk1NC4uNmJjNWI5NjgyYiAx
MDA2NDQKLS0tIGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvcGNpLmMKKysrIGIveGVuL2RyaXZl
cnMvcGFzc3Rocm91Z2gvcGNpLmMKQEAgLTI0NiwxMSArMjQ2LDExIEBAIHN0YXRpYyB2b2lkIGNo
ZWNrX3BkZXYoY29uc3Qgc3RydWN0IHBjaV9kZXYgKnBkZXYpCiAKICAgICBpZiAoIGNvbW1hbmRf
bWFzayApCiAgICAgewotICAgICAgICB2YWwgPSBwY2lfY29uZl9yZWFkMTYoc2VnLCBidXMsIGRl
diwgZnVuYywgUENJX0NPTU1BTkQpOworICAgICAgICB2YWwgPSBwY2lfY29uZl9yZWFkMTYocGRl
di0+c2JkZiwgUENJX0NPTU1BTkQpOwogICAgICAgICBpZiAoIHZhbCAmIGNvbW1hbmRfbWFzayAp
CiAgICAgICAgICAgICBwY2lfY29uZl93cml0ZTE2KHNlZywgYnVzLCBkZXYsIGZ1bmMsIFBDSV9D
T01NQU5ELAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWwgJiB+Y29tbWFuZF9tYXNr
KTsKLSAgICAgICAgdmFsID0gcGNpX2NvbmZfcmVhZDE2KHNlZywgYnVzLCBkZXYsIGZ1bmMsIFBD
SV9TVEFUVVMpOworICAgICAgICB2YWwgPSBwY2lfY29uZl9yZWFkMTYocGRldi0+c2JkZiwgUENJ
X1NUQVRVUyk7CiAgICAgICAgIGlmICggdmFsICYgUENJX1NUQVRVU19DSEVDSyApCiAgICAgICAg
IHsKICAgICAgICAgICAgIHByaW50ayhYRU5MT0dfSU5GTyAiJTA0eDolMDJ4OiUwMnguJXUgc3Rh
dHVzICUwNHggLT4gJTA0eFxuIiwKQEAgLTI2NSwxMSArMjY1LDExIEBAIHN0YXRpYyB2b2lkIGNo
ZWNrX3BkZXYoY29uc3Qgc3RydWN0IHBjaV9kZXYgKnBkZXYpCiAgICAgY2FzZSBQQ0lfSEVBREVS
X1RZUEVfQlJJREdFOgogICAgICAgICBpZiAoICFicmlkZ2VfY3RsX21hc2sgKQogICAgICAgICAg
ICAgYnJlYWs7Ci0gICAgICAgIHZhbCA9IHBjaV9jb25mX3JlYWQxNihzZWcsIGJ1cywgZGV2LCBm
dW5jLCBQQ0lfQlJJREdFX0NPTlRST0wpOworICAgICAgICB2YWwgPSBwY2lfY29uZl9yZWFkMTYo
cGRldi0+c2JkZiwgUENJX0JSSURHRV9DT05UUk9MKTsKICAgICAgICAgaWYgKCB2YWwgJiBicmlk
Z2VfY3RsX21hc2sgKQogICAgICAgICAgICAgcGNpX2NvbmZfd3JpdGUxNihzZWcsIGJ1cywgZGV2
LCBmdW5jLCBQQ0lfQlJJREdFX0NPTlRST0wsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHZhbCAmIH5icmlkZ2VfY3RsX21hc2spOwotICAgICAgICB2YWwgPSBwY2lfY29uZl9yZWFkMTYo
c2VnLCBidXMsIGRldiwgZnVuYywgUENJX1NFQ19TVEFUVVMpOworICAgICAgICB2YWwgPSBwY2lf
Y29uZl9yZWFkMTYocGRldi0+c2JkZiwgUENJX1NFQ19TVEFUVVMpOwogICAgICAgICBpZiAoIHZh
bCAmIFBDSV9TVEFUVVNfQ0hFQ0sgKQogICAgICAgICB7CiAgICAgICAgICAgICBwcmludGsoWEVO
TE9HX0lORk8KQEAgLTI4OSwxMiArMjg5LDggQEAgc3RhdGljIHZvaWQgY2hlY2tfcGRldihjb25z
dCBzdHJ1Y3QgcGNpX2RldiAqcGRldikKIAogc3RhdGljIHZvaWQgYXBwbHlfcXVpcmtzKHN0cnVj
dCBwY2lfZGV2ICpwZGV2KQogewotICAgIHVpbnQxNl90IHZlbmRvciA9IHBjaV9jb25mX3JlYWQx
NihwZGV2LT5zZWcsIHBkZXYtPmJ1cywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgUENJX1NMT1QocGRldi0+ZGV2Zm4pLAotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBQQ0lfRlVOQyhwZGV2LT5kZXZmbiksIFBDSV9WRU5ET1JfSUQpOwotICAgIHVp
bnQxNl90IGRldmljZSA9IHBjaV9jb25mX3JlYWQxNihwZGV2LT5zZWcsIHBkZXYtPmJ1cywKLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX1NMT1QocGRldi0+ZGV2Zm4p
LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lfRlVOQyhwZGV2LT5k
ZXZmbiksIFBDSV9ERVZJQ0VfSUQpOworICAgIHVpbnQxNl90IHZlbmRvciA9IHBjaV9jb25mX3Jl
YWQxNihwZGV2LT5zYmRmLCBQQ0lfVkVORE9SX0lEKTsKKyAgICB1aW50MTZfdCBkZXZpY2UgPSBw
Y2lfY29uZl9yZWFkMTYocGRldi0+c2JkZiwgUENJX0RFVklDRV9JRCk7CiAgICAgc3RhdGljIGNv
bnN0IHN0cnVjdCB7CiAgICAgICAgIHVpbnQxNl90IHZlbmRvciwgZGV2aWNlOwogICAgIH0gaWdu
b3JlX2JhcnNbXSA9IHsKQEAgLTM4Nyw4ICszODMsNyBAQCBzdGF0aWMgc3RydWN0IHBjaV9kZXYg
KmFsbG9jX3BkZXYoc3RydWN0IHBjaV9zZWcgKnBzZWcsIHU4IGJ1cywgdTggZGV2Zm4pCiAgICAg
ICAgICAgICBwb3MgPSBwY2lfZmluZF9jYXBfb2Zmc2V0KHBzZWctPm5yLCBidXMsIFBDSV9TTE9U
KGRldmZuKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX0ZVTkMo
ZGV2Zm4pLCBQQ0lfQ0FQX0lEX0VYUCk7CiAgICAgICAgICAgICBCVUdfT04oIXBvcyk7Ci0gICAg
ICAgICAgICBjYXAgPSBwY2lfY29uZl9yZWFkMTYocHNlZy0+bnIsIGJ1cywgUENJX1NMT1QoZGV2
Zm4pLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9GVU5DKGRldmZuKSwg
cG9zICsgUENJX0VYUF9ERVZDQVApOworICAgICAgICAgICAgY2FwID0gcGNpX2NvbmZfcmVhZDE2
KHBkZXYtPnNiZGYsIHBvcyArIFBDSV9FWFBfREVWQ0FQKTsKICAgICAgICAgICAgIGlmICggY2Fw
ICYgUENJX0VYUF9ERVZDQVBfUEhBTlRPTSApCiAgICAgICAgICAgICB7CiAgICAgICAgICAgICAg
ICAgcGRldi0+cGhhbnRvbV9zdHJpZGUgPSA4ID4+IE1BU0tfRVhUUihjYXAsCkBAIC02MTEsOCAr
NjA2LDggQEAgc3RhdGljIHZvaWQgcGNpX2VuYWJsZV9hY3Moc3RydWN0IHBjaV9kZXYgKnBkZXYp
CiAgICAgaWYgKCFwb3MpCiAgICAgICAgIHJldHVybjsKIAotICAgIGNhcCA9IHBjaV9jb25mX3Jl
YWQxNihzZWcsIGJ1cywgZGV2LCBmdW5jLCBwb3MgKyBQQ0lfQUNTX0NBUCk7Ci0gICAgY3RybCA9
IHBjaV9jb25mX3JlYWQxNihzZWcsIGJ1cywgZGV2LCBmdW5jLCBwb3MgKyBQQ0lfQUNTX0NUUkwp
OworICAgIGNhcCA9IHBjaV9jb25mX3JlYWQxNihwZGV2LT5zYmRmLCBwb3MgKyBQQ0lfQUNTX0NB
UCk7CisgICAgY3RybCA9IHBjaV9jb25mX3JlYWQxNihwZGV2LT5zYmRmLCBwb3MgKyBQQ0lfQUNT
X0NUUkwpOwogCiAgICAgLyogU291cmNlIFZhbGlkYXRpb24gKi8KICAgICBjdHJsIHw9IChjYXAg
JiBQQ0lfQUNTX1NWKTsKQEAgLTc0Myw3ICs3MzgsNyBAQCBpbnQgcGNpX2FkZF9kZXZpY2UodTE2
IHNlZywgdTggYnVzLCB1OCBkZXZmbiwKICAgICB7CiAgICAgICAgIHVuc2lnbmVkIGludCBwb3Mg
PSBwY2lfZmluZF9leHRfY2FwYWJpbGl0eShzZWcsIGJ1cywgZGV2Zm4sCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lfRVhUX0NBUF9JRF9TUklP
Vik7Ci0gICAgICAgIHUxNiBjdHJsID0gcGNpX2NvbmZfcmVhZDE2KHNlZywgYnVzLCBzbG90LCBm
dW5jLCBwb3MgKyBQQ0lfU1JJT1ZfQ1RSTCk7CisgICAgICAgIHVpbnQxNl90IGN0cmwgPSBwY2lf
Y29uZl9yZWFkMTYocGRldi0+c2JkZiwgcG9zICsgUENJX1NSSU9WX0NUUkwpOwogCiAgICAgICAg
IGlmICggIXBvcyApCiAgICAgICAgICAgICAvKiBOb3RoaW5nICovOwpAQCAtOTM3LDEzICs5MzIs
MTMgQEAgZW51bSBwZGV2X3R5cGUgcGRldl90eXBlKHUxNiBzZWcsIHU4IGJ1cywgdTggZGV2Zm4p
CiAgICAgdTggZCA9IFBDSV9TTE9UKGRldmZuKSwgZiA9IFBDSV9GVU5DKGRldmZuKTsKICAgICBp
bnQgcG9zID0gcGNpX2ZpbmRfY2FwX29mZnNldChzZWcsIGJ1cywgZCwgZiwgUENJX0NBUF9JRF9F
WFApOwogCi0gICAgY2xhc3NfZGV2aWNlID0gcGNpX2NvbmZfcmVhZDE2KHNlZywgYnVzLCBkLCBm
LCBQQ0lfQ0xBU1NfREVWSUNFKTsKKyAgICBjbGFzc19kZXZpY2UgPSBwY2lfY29uZl9yZWFkMTYo
UENJX1NCREYoc2VnLCBidXMsIGQsIGYpLCBQQ0lfQ0xBU1NfREVWSUNFKTsKICAgICBzd2l0Y2gg
KCBjbGFzc19kZXZpY2UgKQogICAgIHsKICAgICBjYXNlIFBDSV9DTEFTU19CUklER0VfUENJOgog
ICAgICAgICBpZiAoICFwb3MgKQogICAgICAgICAgICAgcmV0dXJuIERFVl9UWVBFX0xFR0FDWV9Q
Q0lfQlJJREdFOwotICAgICAgICBjcmVnID0gcGNpX2NvbmZfcmVhZDE2KHNlZywgYnVzLCBkLCBm
LCBwb3MgKyBQQ0lfRVhQX0ZMQUdTKTsKKyAgICAgICAgY3JlZyA9IHBjaV9jb25mX3JlYWQxNihQ
Q0lfU0JERihzZWcsIGJ1cywgZCwgZiksIHBvcyArIFBDSV9FWFBfRkxBR1MpOwogICAgICAgICBz
d2l0Y2ggKCAoY3JlZyAmIFBDSV9FWFBfRkxBR1NfVFlQRSkgPj4gNCApCiAgICAgICAgIHsKICAg
ICAgICAgY2FzZSBQQ0lfRVhQX1RZUEVfUENJX0JSSURHRToKQEAgLTEwNDAsOCArMTAzNSw3IEBA
IHZvaWQgcGNpX2NoZWNrX2Rpc2FibGVfZGV2aWNlKHUxNiBzZWcsIHU4IGJ1cywgdTggZGV2Zm4p
CiAgICAgLyogVGVsbCB0aGUgZGV2aWNlIHRvIHN0b3AgRE1BaW5nOyB3ZSBjYW4ndCByZWx5IG9u
IHRoZSBndWVzdCB0bwogICAgICAqIGNvbnRyb2wgaXQgZm9yIHVzLiAqLwogICAgIGRldmZuID0g
cGRldi0+ZGV2Zm47Ci0gICAgY3dvcmQgPSBwY2lfY29uZl9yZWFkMTYoc2VnLCBidXMsIFBDSV9T
TE9UKGRldmZuKSwgUENJX0ZVTkMoZGV2Zm4pLAotICAgICAgICAgICAgICAgICAgICAgICAgICAg
IFBDSV9DT01NQU5EKTsKKyAgICBjd29yZCA9IHBjaV9jb25mX3JlYWQxNihwZGV2LT5zYmRmLCBQ
Q0lfQ09NTUFORCk7CiAgICAgcGNpX2NvbmZfd3JpdGUxNihzZWcsIGJ1cywgUENJX1NMT1QoZGV2
Zm4pLCBQQ0lfRlVOQyhkZXZmbiksCiAgICAgICAgICAgICAgICAgICAgICBQQ0lfQ09NTUFORCwg
Y3dvcmQgJiB+UENJX0NPTU1BTkRfTUFTVEVSKTsKIH0KQEAgLTEyMDksMTAgKzEyMDMsNyBAQCBz
dGF0aWMgYm9vbF90IGhlc3RfbWF0Y2hfdHlwZShjb25zdCBzdHJ1Y3QgYWNwaV9oZXN0X2hlYWRl
ciAqaGVzdF9oZHIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
UENJX1NMT1QocGRldi0+ZGV2Zm4pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIFBDSV9GVU5DKHBkZXYtPmRldmZuKSwKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBQQ0lfQ0FQX0lEX0VYUCk7Ci0gICAgdTggcGNpZSA9IE1BU0tf
RVhUUihwY2lfY29uZl9yZWFkMTYocGRldi0+c2VnLCBwZGV2LT5idXMsCi0gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX1NMT1QocGRldi0+ZGV2Zm4pLAotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9GVU5DKHBkZXYtPmRldmZuKSwK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3MgKyBQQ0lfRVhQX0ZM
QUdTKSwKKyAgICB1OCBwY2llID0gTUFTS19FWFRSKHBjaV9jb25mX3JlYWQxNihwZGV2LT5zYmRm
LCBwb3MgKyBQQ0lfRVhQX0ZMQUdTKSwKICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9FWFBf
RkxBR1NfVFlQRSk7CiAKICAgICBzd2l0Y2ggKCBoZXN0X2hkci0+dHlwZSApCkBAIC0xMjIyLDgg
KzEyMTMsNyBAQCBzdGF0aWMgYm9vbF90IGhlc3RfbWF0Y2hfdHlwZShjb25zdCBzdHJ1Y3QgYWNw
aV9oZXN0X2hlYWRlciAqaGVzdF9oZHIsCiAgICAgY2FzZSBBQ1BJX0hFU1RfVFlQRV9BRVJfRU5E
UE9JTlQ6CiAgICAgICAgIHJldHVybiBwY2llID09IFBDSV9FWFBfVFlQRV9FTkRQT0lOVDsKICAg
ICBjYXNlIEFDUElfSEVTVF9UWVBFX0FFUl9CUklER0U6Ci0gICAgICAgIHJldHVybiBwY2lfY29u
Zl9yZWFkMTYocGRldi0+c2VnLCBwZGV2LT5idXMsIFBDSV9TTE9UKHBkZXYtPmRldmZuKSwKLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lfRlVOQyhwZGV2LT5kZXZmbiksIFBDSV9D
TEFTU19ERVZJQ0UpID09CisgICAgICAgIHJldHVybiBwY2lfY29uZl9yZWFkMTYocGRldi0+c2Jk
ZiwgUENJX0NMQVNTX0RFVklDRSkgPT0KICAgICAgICAgICAgICAgIFBDSV9DTEFTU19CUklER0Vf
UENJOwogICAgIH0KIApkaWZmIC0tZ2l0IGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvdnRkL3F1
aXJrcy5jIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvdnRkL3F1aXJrcy5jCmluZGV4IGZmNzNi
MGU3ZjQuLjQ3NTk3Yzk2MDAgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0
ZC9xdWlya3MuYworKysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC92dGQvcXVpcmtzLmMKQEAg
LTc0LDcgKzc0LDcgQEAgaW50IGlzX2lnZF92dF9lbmFibGVkX3F1aXJrKHZvaWQpCiAgICAgICAg
IHJldHVybiAxOwogCiAgICAgLyogaW50ZWdyYXRlZCBncmFwaGljcyBvbiBJbnRlbCBwbGF0Zm9y
bXMgaXMgbG9jYXRlZCBhdCAwOjIuMCAqLwotICAgIGdnYyA9IHBjaV9jb25mX3JlYWQxNigwLCAw
LCBJR0RfREVWLCAwLCBHR0MpOworICAgIGdnYyA9IHBjaV9jb25mX3JlYWQxNihQQ0lfU0JERigw
LCAwLCBJR0RfREVWLCAwKSwgR0dDKTsKICAgICByZXR1cm4gKCBnZ2MgJiBHR0NfTUVNT1JZX1ZU
X0VOQUJMRUQgPyAxIDogMCApOwogfQogCkBAIC04OCw3ICs4OCw3IEBAIHN0YXRpYyB2b2lkIF9f
aW5pdCBjYW50aWdhX2IzX2VycmF0YV9pbml0KHZvaWQpCiAgICAgdTE2IHZpZDsKICAgICB1OCBk
aWRfaGksIHJpZDsKIAotICAgIHZpZCA9IHBjaV9jb25mX3JlYWQxNigwLCAwLCBJR0RfREVWLCAw
LCAwKTsKKyAgICB2aWQgPSBwY2lfY29uZl9yZWFkMTYoUENJX1NCREYoMCwgMCwgSUdEX0RFViwg
MCksIDApOwogICAgIGlmICggdmlkICE9IDB4ODA4NiApCiAgICAgICAgIHJldHVybjsKIApAQCAt
NDI0LDExICs0MjQsMTAgQEAgdm9pZCBwY2lfdnRkX3F1aXJrKGNvbnN0IHN0cnVjdCBwY2lfZGV2
ICpwZGV2KQogICAgIHBhZGRyX3QgcGE7CiAgICAgY29uc3QgY2hhciAqYWN0aW9uOwogCi0gICAg
aWYgKCBwY2lfY29uZl9yZWFkMTYoc2VnLCBidXMsIGRldiwgZnVuYywgUENJX1ZFTkRPUl9JRCkg
IT0KLSAgICAgICAgIFBDSV9WRU5ET1JfSURfSU5URUwgKQorICAgIGlmICggcGNpX2NvbmZfcmVh
ZDE2KHBkZXYtPnNiZGYsIFBDSV9WRU5ET1JfSUQpICE9IFBDSV9WRU5ET1JfSURfSU5URUwgKQog
ICAgICAgICByZXR1cm47CiAKLSAgICBzd2l0Y2ggKCBwY2lfY29uZl9yZWFkMTYoc2VnLCBidXMs
IGRldiwgZnVuYywgUENJX0RFVklDRV9JRCkgKQorICAgIHN3aXRjaCAoIHBjaV9jb25mX3JlYWQx
NihwZGV2LT5zYmRmLCBQQ0lfREVWSUNFX0lEKSApCiAgICAgewogICAgIC8qCiAgICAgICogTWFz
ayByZXBvcnRpbmcgSW50ZWwgVlQtZCBmYXVsdHMgdG8gSU9IIGNvcmUgbG9naWM6CmRpZmYgLS1n
aXQgYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC94ODYvYXRzLmMgYi94ZW4vZHJpdmVycy9wYXNz
dGhyb3VnaC94ODYvYXRzLmMKaW5kZXggNTljMTYzNDU5YS4uY2IwMjJjNTk4YSAxMDA2NDQKLS0t
IGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gveDg2L2F0cy5jCisrKyBiL3hlbi9kcml2ZXJzL3Bh
c3N0aHJvdWdoL3g4Ni9hdHMuYwpAQCAtMzQsOCArMzQsNyBAQCBpbnQgZW5hYmxlX2F0c19kZXZp
Y2Uoc3RydWN0IHBjaV9kZXYgKnBkZXYsIHN0cnVjdCBsaXN0X2hlYWQgKmF0c19saXN0KQogICAg
ICAgICBkcHJpbnRrKFhFTkxPR19JTkZPLCAiJTA0eDolMDJ4OiUwMnguJXU6IEFUUyBjYXBhYmls
aXR5IGZvdW5kXG4iLAogICAgICAgICAgICAgICAgIHNlZywgYnVzLCBQQ0lfU0xPVChkZXZmbiks
IFBDSV9GVU5DKGRldmZuKSk7CiAKLSAgICB2YWx1ZSA9IHBjaV9jb25mX3JlYWQxNihzZWcsIGJ1
cywgUENJX1NMT1QoZGV2Zm4pLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9GVU5D
KGRldmZuKSwgcG9zICsgQVRTX1JFR19DVEwpOworICAgIHZhbHVlID0gcGNpX2NvbmZfcmVhZDE2
KHBkZXYtPnNiZGYsIHBvcyArIEFUU19SRUdfQ1RMKTsKICAgICBpZiAoIHZhbHVlICYgQVRTX0VO
QUJMRSApCiAgICAgewogICAgICAgICBzdHJ1Y3QgcGNpX2RldiAqb3RoZXI7CkBAIC01OCw4ICs1
Nyw3IEBAIGludCBlbmFibGVfYXRzX2RldmljZShzdHJ1Y3QgcGNpX2RldiAqcGRldiwgc3RydWN0
IGxpc3RfaGVhZCAqYXRzX2xpc3QpCiAgICAgaWYgKCBwb3MgKQogICAgIHsKICAgICAgICAgcGRl
di0+YXRzLmNhcF9wb3MgPSBwb3M7Ci0gICAgICAgIHZhbHVlID0gcGNpX2NvbmZfcmVhZDE2KHNl
ZywgYnVzLCBQQ0lfU0xPVChkZXZmbiksCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IFBDSV9GVU5DKGRldmZuKSwgcG9zICsgQVRTX1JFR19DQVApOworICAgICAgICB2YWx1ZSA9IHBj
aV9jb25mX3JlYWQxNihwZGV2LT5zYmRmLCBwb3MgKyBBVFNfUkVHX0NBUCk7CiAgICAgICAgIHBk
ZXYtPmF0cy5xdWV1ZV9kZXB0aCA9IHZhbHVlICYgQVRTX1FVRVVFX0RFUFRIX01BU0sgPzoKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQVRTX1FVRVVFX0RFUFRIX01BU0sgKyAxOwog
ICAgICAgICBsaXN0X2FkZCgmcGRldi0+YXRzLmxpc3QsIGF0c19saXN0KTsKQEAgLTgxLDggKzc5
LDcgQEAgdm9pZCBkaXNhYmxlX2F0c19kZXZpY2Uoc3RydWN0IHBjaV9kZXYgKnBkZXYpCiAKICAg
ICBCVUdfT04oIXBkZXYtPmF0cy5jYXBfcG9zKTsKIAotICAgIHZhbHVlID0gcGNpX2NvbmZfcmVh
ZDE2KHNlZywgYnVzLCBQQ0lfU0xPVChkZXZmbiksIFBDSV9GVU5DKGRldmZuKSwKLSAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBwZGV2LT5hdHMuY2FwX3BvcyArIEFUU19SRUdfQ1RMKTsKKyAg
ICB2YWx1ZSA9IHBjaV9jb25mX3JlYWQxNihwZGV2LT5zYmRmLCBwZGV2LT5hdHMuY2FwX3BvcyAr
IEFUU19SRUdfQ1RMKTsKICAgICB2YWx1ZSAmPSB+QVRTX0VOQUJMRTsKICAgICBwY2lfY29uZl93
cml0ZTE2KHNlZywgYnVzLCBQQ0lfU0xPVChkZXZmbiksIFBDSV9GVU5DKGRldmZuKSwKICAgICAg
ICAgICAgICAgICAgICAgIHBkZXYtPmF0cy5jYXBfcG9zICsgQVRTX1JFR19DVEwsIHZhbHVlKTsK
ZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL3BjaS9wY2kuYyBiL3hlbi9kcml2ZXJzL3BjaS9wY2ku
YwppbmRleCBlM2Y4ODNmYzVjLi41ZTVlMGYwNTM4IDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy9w
Y2kvcGNpLmMKKysrIGIveGVuL2RyaXZlcnMvcGNpL3BjaS5jCkBAIC0xNSw3ICsxNSw3IEBAIGlu
dCBwY2lfZmluZF9jYXBfb2Zmc2V0KHUxNiBzZWcsIHU4IGJ1cywgdTggZGV2LCB1OCBmdW5jLCB1
OCBjYXApCiAgICAgdTggcG9zID0gUENJX0NBUEFCSUxJVFlfTElTVDsKICAgICB1MTYgc3RhdHVz
OwogCi0gICAgc3RhdHVzID0gcGNpX2NvbmZfcmVhZDE2KHNlZywgYnVzLCBkZXYsIGZ1bmMsIFBD
SV9TVEFUVVMpOworICAgIHN0YXR1cyA9IHBjaV9jb25mX3JlYWQxNihQQ0lfU0JERihzZWcsIGJ1
cywgZGV2LCBmdW5jKSwgUENJX1NUQVRVUyk7CiAgICAgaWYgKCAoc3RhdHVzICYgUENJX1NUQVRV
U19DQVBfTElTVCkgPT0gMCApCiAgICAgICAgIHJldHVybiAwOwogCkBAIC0xMjAsNyArMTIwLDcg
QEAgdm9pZCBwY2lfaW50eChjb25zdCBzdHJ1Y3QgcGNpX2RldiAqcGRldiwgYm9vbCBlbmFibGUp
CiAgICAgdWludDhfdCBidXMgPSBwZGV2LT5idXM7CiAgICAgdWludDhfdCBzbG90ID0gUENJX1NM
T1QocGRldi0+ZGV2Zm4pOwogICAgIHVpbnQ4X3QgZnVuYyA9IFBDSV9GVU5DKHBkZXYtPmRldmZu
KTsKLSAgICB1aW50MTZfdCBjbWQgPSBwY2lfY29uZl9yZWFkMTYoc2VnLCBidXMsIHNsb3QsIGZ1
bmMsIFBDSV9DT01NQU5EKTsKKyAgICB1aW50MTZfdCBjbWQgPSBwY2lfY29uZl9yZWFkMTYocGRl
di0+c2JkZiwgUENJX0NPTU1BTkQpOwogCiAgICAgaWYgKCBlbmFibGUgKQogICAgICAgICBjbWQg
Jj0gflBDSV9DT01NQU5EX0lOVFhfRElTQUJMRTsKZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL3Zp
ZGVvL3ZnYS5jIGIveGVuL2RyaXZlcnMvdmlkZW8vdmdhLmMKaW5kZXggNzg1MzNhZDBiMS4uNDU0
NDU3YWRlOCAxMDA2NDQKLS0tIGEveGVuL2RyaXZlcnMvdmlkZW8vdmdhLmMKKysrIGIveGVuL2Ry
aXZlcnMvdmlkZW8vdmdhLmMKQEAgLTEyMSwxMCArMTIxLDkgQEAgdm9pZCBfX2luaXQgdmlkZW9f
ZW5kYm9vdCh2b2lkKQogICAgICAgICAgICAgICAgIHBjaWRldnNfdW5sb2NrKCk7CiAKICAgICAg
ICAgICAgICAgICBpZiAoICFwZGV2IHx8Ci0gICAgICAgICAgICAgICAgICAgICBwY2lfY29uZl9y
ZWFkMTYoMCwgYnVzLCBQQ0lfU0xPVChkZXZmbiksIFBDSV9GVU5DKGRldmZuKSwKKyAgICAgICAg
ICAgICAgICAgICAgIHBjaV9jb25mX3JlYWQxNihQQ0lfU0JERjMoMCwgYnVzLCBkZXZmbiksCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX0NMQVNTX0RFVklDRSkgIT0g
MHgwMzAwIHx8Ci0gICAgICAgICAgICAgICAgICAgICAhKHBjaV9jb25mX3JlYWQxNigwLCBidXMs
IFBDSV9TTE9UKGRldmZuKSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IFBDSV9GVU5DKGRldmZuKSwgUENJX0NPTU1BTkQpICYKKyAgICAgICAgICAgICAgICAgICAgICEo
cGNpX2NvbmZfcmVhZDE2KFBDSV9TQkRGMygwLCBidXMsIGRldmZuKSwgUENJX0NPTU1BTkQpICYK
ICAgICAgICAgICAgICAgICAgICAgICAgKFBDSV9DT01NQU5EX0lPIHwgUENJX0NPTU1BTkRfTUVN
T1JZKSkgKQogICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKIApAQCAtMTQxLDggKzE0MCw3
IEBAIHZvaWQgX19pbml0IHZpZGVvX2VuZGJvb3Qodm9pZCkKICAgICAgICAgICAgICAgICAgICAg
ICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgUENJX0hFQURFUl9UWVBFX0JSSURH
RToKICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgUENJX0hFQURFUl9UWVBFX0NBUkRCVVM6
Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBwY2lfY29uZl9yZWFkMTYoMCwgYiwg
UENJX1NMT1QoZGYpLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIFBDSV9GVU5DKGRmKSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHBj
aV9jb25mX3JlYWQxNihQQ0lfU0JERjMoMCwgYiwgZGYpLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9CUklER0VfQ09OVFJPTCkgJgogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX0JSSURHRV9DVExfVkdBICkKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CmRpZmYgLS1naXQgYS94ZW4vZHJpdmVy
cy92cGNpL2hlYWRlci5jIGIveGVuL2RyaXZlcnMvdnBjaS9oZWFkZXIuYwppbmRleCA1NjRjN2I2
YTdkLi4wYjE3NmI0OTBhIDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy92cGNpL2hlYWRlci5jCisr
KyBiL3hlbi9kcml2ZXJzL3ZwY2kvaGVhZGVyLmMKQEAgLTMzNiw4ICszMzYsNyBAQCBzdGF0aWMg
dm9pZCBjbWRfd3JpdGUoY29uc3Qgc3RydWN0IHBjaV9kZXYgKnBkZXYsIHVuc2lnbmVkIGludCBy
ZWcsCiAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgY21kLCB2b2lkICpkYXRhKQogewog
ICAgIHVpbnQ4X3Qgc2xvdCA9IFBDSV9TTE9UKHBkZXYtPmRldmZuKSwgZnVuYyA9IFBDSV9GVU5D
KHBkZXYtPmRldmZuKTsKLSAgICB1aW50MTZfdCBjdXJyZW50X2NtZCA9IHBjaV9jb25mX3JlYWQx
NihwZGV2LT5zZWcsIHBkZXYtPmJ1cywgc2xvdCwgZnVuYywKLSAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICByZWcpOworICAgIHVpbnQxNl90IGN1cnJlbnRfY21kID0g
cGNpX2NvbmZfcmVhZDE2KHBkZXYtPnNiZGYsIHJlZyk7CiAKICAgICAvKgogICAgICAqIExldCBE
b20wIHBsYXkgd2l0aCBhbGwgdGhlIGJpdHMgZGlyZWN0bHkgZXhjZXB0IGZvciB0aGUgbWVtb3J5
CkBAIC0zNzEsOCArMzcwLDcgQEAgc3RhdGljIHZvaWQgYmFyX3dyaXRlKGNvbnN0IHN0cnVjdCBw
Y2lfZGV2ICpwZGV2LCB1bnNpZ25lZCBpbnQgcmVnLAogICAgIGVsc2UKICAgICAgICAgdmFsICY9
IFBDSV9CQVNFX0FERFJFU1NfTUVNX01BU0s7CiAKLSAgICBpZiAoIHBjaV9jb25mX3JlYWQxNihw
ZGV2LT5zZWcsIHBkZXYtPmJ1cywgc2xvdCwgZnVuYywgUENJX0NPTU1BTkQpICYKLSAgICAgICAg
IFBDSV9DT01NQU5EX01FTU9SWSApCisgICAgaWYgKCBwY2lfY29uZl9yZWFkMTYocGRldi0+c2Jk
ZiwgUENJX0NPTU1BTkQpICYgUENJX0NPTU1BTkRfTUVNT1JZICkKICAgICB7CiAgICAgICAgIC8q
IElmIHRoZSB2YWx1ZSB3cml0dGVuIGlzIHRoZSBjdXJyZW50IG9uZSBhdm9pZCBwcmludGluZyBh
IHdhcm5pbmcuICovCiAgICAgICAgIGlmICggdmFsICE9ICh1aW50MzJfdCkoYmFyLT5hZGRyID4+
IChoaSA/IDMyIDogMCkpICkKQEAgLTQwOSw4ICs0MDcsNyBAQCBzdGF0aWMgdm9pZCByb21fd3Jp
dGUoY29uc3Qgc3RydWN0IHBjaV9kZXYgKnBkZXYsIHVuc2lnbmVkIGludCByZWcsCiAgICAgc3Ry
dWN0IHZwY2lfaGVhZGVyICpoZWFkZXIgPSAmcGRldi0+dnBjaS0+aGVhZGVyOwogICAgIHN0cnVj
dCB2cGNpX2JhciAqcm9tID0gZGF0YTsKICAgICB1aW50OF90IHNsb3QgPSBQQ0lfU0xPVChwZGV2
LT5kZXZmbiksIGZ1bmMgPSBQQ0lfRlVOQyhwZGV2LT5kZXZmbik7Ci0gICAgdWludDE2X3QgY21k
ID0gcGNpX2NvbmZfcmVhZDE2KHBkZXYtPnNlZywgcGRldi0+YnVzLCBzbG90LCBmdW5jLAotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lfQ09NTUFORCk7CisgICAgdWludDE2
X3QgY21kID0gcGNpX2NvbmZfcmVhZDE2KHBkZXYtPnNiZGYsIFBDSV9DT01NQU5EKTsKICAgICBi
b29sIG5ld19lbmFibGVkID0gdmFsICYgUENJX1JPTV9BRERSRVNTX0VOQUJMRTsKIAogICAgIGlm
ICggKGNtZCAmIFBDSV9DT01NQU5EX01FTU9SWSkgJiYgaGVhZGVyLT5yb21fZW5hYmxlZCAmJiBu
ZXdfZW5hYmxlZCApCkBAIC00ODksNyArNDg2LDcgQEAgc3RhdGljIGludCBpbml0X2JhcnMoc3Ry
dWN0IHBjaV9kZXYgKnBkZXYpCiAgICAgICAgIHJldHVybiAwOwogCiAgICAgLyogRGlzYWJsZSBt
ZW1vcnkgZGVjb2RpbmcgYmVmb3JlIHNpemluZy4gKi8KLSAgICBjbWQgPSBwY2lfY29uZl9yZWFk
MTYocGRldi0+c2VnLCBwZGV2LT5idXMsIHNsb3QsIGZ1bmMsIFBDSV9DT01NQU5EKTsKKyAgICBj
bWQgPSBwY2lfY29uZl9yZWFkMTYocGRldi0+c2JkZiwgUENJX0NPTU1BTkQpOwogICAgIGlmICgg
Y21kICYgUENJX0NPTU1BTkRfTUVNT1JZICkKICAgICAgICAgcGNpX2NvbmZfd3JpdGUxNihwZGV2
LT5zZWcsIHBkZXYtPmJ1cywgc2xvdCwgZnVuYywgUENJX0NPTU1BTkQsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgY21kICYgflBDSV9DT01NQU5EX01FTU9SWSk7CmRpZmYgLS1naXQgYS94ZW4v
ZHJpdmVycy92cGNpL21zaS5jIGIveGVuL2RyaXZlcnMvdnBjaS9tc2kuYwppbmRleCBjNGUxZDJh
NDExLi44ZmU4OWZjOTEyIDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy92cGNpL21zaS5jCisrKyBi
L3hlbi9kcml2ZXJzL3ZwY2kvbXNpLmMKQEAgLTIxMSw4ICsyMTEsNyBAQCBzdGF0aWMgaW50IGlu
aXRfbXNpKHN0cnVjdCBwY2lfZGV2ICpwZGV2KQogICAgICAgICByZXR1cm4gcmV0OwogCiAgICAg
LyogR2V0IHRoZSBtYXhpbXVtIG51bWJlciBvZiB2ZWN0b3JzIHRoZSBkZXZpY2Ugc3VwcG9ydHMu
ICovCi0gICAgY29udHJvbCA9IHBjaV9jb25mX3JlYWQxNihwZGV2LT5zZWcsIHBkZXYtPmJ1cywg
c2xvdCwgZnVuYywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1zaV9jb250cm9sX3Jl
Zyhwb3MpKTsKKyAgICBjb250cm9sID0gcGNpX2NvbmZfcmVhZDE2KHBkZXYtPnNiZGYsIG1zaV9j
b250cm9sX3JlZyhwb3MpKTsKIAogICAgIC8qCiAgICAgICogRklYTUU6IEkndmUgb25seSBiZWVu
IGFibGUgdG8gdGVzdCB0aGlzIGNvZGUgd2l0aCBkZXZpY2VzIHVzaW5nIGEgc2luZ2xlCmRpZmYg
LS1naXQgYS94ZW4vZHJpdmVycy92cGNpL21zaXguYyBiL3hlbi9kcml2ZXJzL3ZwY2kvbXNpeC5j
CmluZGV4IGFmM2ZmYTA4N2QuLjhlNmNkMDcwZDAgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL3Zw
Y2kvbXNpeC5jCisrKyBiL3hlbi9kcml2ZXJzL3ZwY2kvbXNpeC5jCkBAIC00NTcsOCArNDU3LDcg
QEAgc3RhdGljIGludCBpbml0X21zaXgoc3RydWN0IHBjaV9kZXYgKnBkZXYpCiAgICAgaWYgKCAh
bXNpeF9vZmZzZXQgKQogICAgICAgICByZXR1cm4gMDsKIAotICAgIGNvbnRyb2wgPSBwY2lfY29u
Zl9yZWFkMTYocGRldi0+c2VnLCBwZGV2LT5idXMsIHNsb3QsIGZ1bmMsCi0gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBtc2l4X2NvbnRyb2xfcmVnKG1zaXhfb2Zmc2V0KSk7CisgICAgY29u
dHJvbCA9IHBjaV9jb25mX3JlYWQxNihwZGV2LT5zYmRmLCBtc2l4X2NvbnRyb2xfcmVnKG1zaXhf
b2Zmc2V0KSk7CiAKICAgICBtYXhfZW50cmllcyA9IG1zaXhfdGFibGVfc2l6ZShjb250cm9sKTsK
IApkaWZmIC0tZ2l0IGEveGVuL2RyaXZlcnMvdnBjaS92cGNpLmMgYi94ZW4vZHJpdmVycy92cGNp
L3ZwY2kuYwppbmRleCBjNDAzMDMzM2E1Li4xYTRjMmVlNGYxIDEwMDY0NAotLS0gYS94ZW4vZHJp
dmVycy92cGNpL3ZwY2kuYworKysgYi94ZW4vZHJpdmVycy92cGNpL3ZwY2kuYwpAQCAtMTE0LDgg
KzExNCw3IEBAIHN0YXRpYyB2b2lkIHZwY2lfaWdub3JlZF93cml0ZShjb25zdCBzdHJ1Y3QgcGNp
X2RldiAqcGRldiwgdW5zaWduZWQgaW50IHJlZywKIHVpbnQzMl90IHZwY2lfaHdfcmVhZDE2KGNv
bnN0IHN0cnVjdCBwY2lfZGV2ICpwZGV2LCB1bnNpZ25lZCBpbnQgcmVnLAogICAgICAgICAgICAg
ICAgICAgICAgICAgdm9pZCAqZGF0YSkKIHsKLSAgICByZXR1cm4gcGNpX2NvbmZfcmVhZDE2KHBk
ZXYtPnNlZywgcGRldi0+YnVzLCBQQ0lfU0xPVChwZGV2LT5kZXZmbiksCi0gICAgICAgICAgICAg
ICAgICAgICAgICAgICBQQ0lfRlVOQyhwZGV2LT5kZXZmbiksIHJlZyk7CisgICAgcmV0dXJuIHBj
aV9jb25mX3JlYWQxNihwZGV2LT5zYmRmLCByZWcpOwogfQogCiB1aW50MzJfdCB2cGNpX2h3X3Jl
YWQzMihjb25zdCBzdHJ1Y3QgcGNpX2RldiAqcGRldiwgdW5zaWduZWQgaW50IHJlZywKQEAgLTIy
MywxOSArMjIyLDE3IEBAIHN0YXRpYyB1aW50MzJfdCB2cGNpX3JlYWRfaHcocGNpX3NiZGZfdCBz
YmRmLCB1bnNpZ25lZCBpbnQgcmVnLAogICAgICAgICBpZiAoIHJlZyAmIDEgKQogICAgICAgICB7
CiAgICAgICAgICAgICBkYXRhID0gcGNpX2NvbmZfcmVhZDgoc2JkZiwgcmVnKTsKLSAgICAgICAg
ICAgIGRhdGEgfD0gcGNpX2NvbmZfcmVhZDE2KHNiZGYuc2VnLCBzYmRmLmJ1cywgc2JkZi5kZXYs
IHNiZGYuZm4sCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWcgKyAxKSA8
PCA4OworICAgICAgICAgICAgZGF0YSB8PSBwY2lfY29uZl9yZWFkMTYoc2JkZiwgcmVnICsgMSkg
PDwgODsKICAgICAgICAgfQogICAgICAgICBlbHNlCiAgICAgICAgIHsKLSAgICAgICAgICAgIGRh
dGEgPSBwY2lfY29uZl9yZWFkMTYoc2JkZi5zZWcsIHNiZGYuYnVzLCBzYmRmLmRldiwgc2JkZi5m
biwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnKTsKKyAgICAgICAgICAg
IGRhdGEgPSBwY2lfY29uZl9yZWFkMTYoc2JkZiwgcmVnKTsKICAgICAgICAgICAgIGRhdGEgfD0g
cGNpX2NvbmZfcmVhZDgoc2JkZiwgcmVnICsgMikgPDwgMTY7CiAgICAgICAgIH0KICAgICAgICAg
YnJlYWs7CiAKICAgICBjYXNlIDI6Ci0gICAgICAgIGRhdGEgPSBwY2lfY29uZl9yZWFkMTYoc2Jk
Zi5zZWcsIHNiZGYuYnVzLCBzYmRmLmRldiwgc2JkZi5mbiwgcmVnKTsKKyAgICAgICAgZGF0YSA9
IHBjaV9jb25mX3JlYWQxNihzYmRmLCByZWcpOwogICAgICAgICBicmVhazsKIAogICAgIGNhc2Ug
MToKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL3hlbi9wY2kuaCBiL3hlbi9pbmNsdWRlL3hlbi9w
Y2kuaAppbmRleCA0MDhjZDFjYjY3Li4yODQ3YThlNmFmIDEwMDY0NAotLS0gYS94ZW4vaW5jbHVk
ZS94ZW4vcGNpLmgKKysrIGIveGVuL2luY2x1ZGUveGVuL3BjaS5oCkBAIC0xNzMsOSArMTczLDcg
QEAgc3RydWN0IHBjaV9kZXYgKnBjaV9nZXRfcGRldl9ieV9kb21haW4oY29uc3Qgc3RydWN0IGRv
bWFpbiAqLCBpbnQgc2VnLAogdm9pZCBwY2lfY2hlY2tfZGlzYWJsZV9kZXZpY2UodTE2IHNlZywg
dTggYnVzLCB1OCBkZXZmbik7CiAKIHVpbnQ4X3QgcGNpX2NvbmZfcmVhZDgocGNpX3NiZGZfdCBz
YmRmLCB1bnNpZ25lZCBpbnQgcmVnKTsKLXVpbnQxNl90IHBjaV9jb25mX3JlYWQxNigKLSAgICB1
bnNpZ25lZCBpbnQgc2VnLCB1bnNpZ25lZCBpbnQgYnVzLCB1bnNpZ25lZCBpbnQgZGV2LCB1bnNp
Z25lZCBpbnQgZnVuYywKLSAgICB1bnNpZ25lZCBpbnQgcmVnKTsKK3VpbnQxNl90IHBjaV9jb25m
X3JlYWQxNihwY2lfc2JkZl90IHNiZGYsIHVuc2lnbmVkIGludCByZWcpOwogdWludDMyX3QgcGNp
X2NvbmZfcmVhZDMyKAogICAgIHVuc2lnbmVkIGludCBzZWcsIHVuc2lnbmVkIGludCBidXMsIHVu
c2lnbmVkIGludCBkZXYsIHVuc2lnbmVkIGludCBmdW5jLAogICAgIHVuc2lnbmVkIGludCByZWcp
OwotLSAKMi4yMC4xIChBcHBsZSBHaXQtMTE3KQoKCl9fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxp
c3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9s
aXN0aW5mby94ZW4tZGV2ZWw=

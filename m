Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id F0A78C1AF3
	for <lists+xen-devel@lfdr.de>; Mon, 30 Sep 2019 07:24:52 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iEo8M-00027h-1U; Mon, 30 Sep 2019 05:22:06 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=hbFO=XZ=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1iEo8K-00026s-B8
 for xen-devel@lists.xenproject.org; Mon, 30 Sep 2019 05:22:04 +0000
X-Inumbo-ID: 302df988-e342-11e9-8628-bc764e2007e4
Received: from mx1.suse.de (unknown [195.135.220.15])
 by localhost (Halon) with ESMTPS
 id 302df988-e342-11e9-8628-bc764e2007e4;
 Mon, 30 Sep 2019 05:21:43 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 114CDB089;
 Mon, 30 Sep 2019 05:21:41 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Mon, 30 Sep 2019 07:21:24 +0200
Message-Id: <20190930052135.11257-9-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190930052135.11257-1-jgross@suse.com>
References: <20190930052135.11257-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v5 08/19] xen/sched: make vcpu_wake() and
 vcpu_sleep() core scheduling aware
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Tim Deegan <tim@xen.org>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Dario Faggioli <dfaggioli@suse.com>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

dmNwdV93YWtlKCkgYW5kIHZjcHVfc2xlZXAoKSBuZWVkIHRvIGJlIG1hZGUgY29yZSBzY2hlZHVs
aW5nIGF3YXJlOgp0aGV5IG1pZ2h0IG5lZWQgdG8gc3dpdGNoIGEgc2luZ2xlIHZjcHUgb2YgYW4g
YWxyZWFkeSBzY2hlZHVsZWQgdW5pdApiZXR3ZWVuIHJ1bm5pbmcgYW5kIG5vdCBydW5uaW5nLgoK
RXNwZWNpYWxseSB3aGVuIHZjcHVfc2xlZXAoKSBmb3IgYSB2Y3B1IGlzIGJlaW5nIGNhbGxlZCBi
eSBhIHZjcHUgb2YKdGhlIHNhbWUgc2NoZWR1bGluZyB1bml0IHNwZWNpYWwgY2FyZSBtdXN0IGJl
IHRha2VuIGluIG9yZGVyIHRvIGF2b2lkCmEgZGVhZGxvY2s6IHRoZSB2Y3B1IHRvIGJlIHB1dCBh
c2xlZXAgbXVzdCBiZSBmb3JjZWQgdGhyb3VnaCBhCmNvbnRleHQgc3dpdGNoIHdpdGhvdXQgZG9p
bmcgc28gZm9yIHRoZSBjYWxsaW5nIHZjcHUuIEZvciB0aGlzCnB1cnBvc2UgYWRkIGEgdmNwdSBm
bGFnIGhhbmRsZWQgaW4gc2NoZWRfc2xhdmUoKSBhbmQgaW4Kc2NoZWRfd2FpdF9yZW5kZXp2b3Vz
X2luKCkgYWxsb3dpbmcgYSB2Y3B1IG9mIHRoZSBjdXJyZW50bHkgcnVubmluZwp1bml0IHRvIHN3
aXRjaCBzdGF0ZSBhdCBhIGhpZ2hlciBwcmlvcml0eSB0aGFuIGEgbm9ybWFsIHNjaGVkdWxlCmV2
ZW50LgoKVXNlIHRoZSBzYW1lIG1lY2hhbmlzbSB3aGVuIHdha2luZyB1cCBhIHZjcHUgb2YgYSBj
dXJyZW50bHkgYWN0aXZlCnVuaXQuCgpXaGlsZSBhdCBpdCBtYWtlIHZjcHVfc2xlZXBfbm9zeW5j
X2xvY2tlZCgpIHN0YXRpYyBhcyBpdCBpcyB1c2VkIGluCnNjaGVkdWxlLmMgb25seS4KClNpZ25l
ZC1vZmYtYnk6IEp1ZXJnZW4gR3Jvc3MgPGpncm9zc0BzdXNlLmNvbT4KLS0tClJGQyBWMjogYWRk
IHZjcHVfc2xlZXAoKSBoYW5kbGluZyBhbmQgZm9yY2VfY29udGV4dF9zd2l0Y2ggZmxhZwpWMjog
Zml4IHJ1bnN0YXRlIGNoYW5nZSBpbiBzY2hlZF9mb3JjZV9jb250ZXh0X3N3aXRjaCgpClY0Ogot
IHVzZSB1bml0X3NjaGVkdWxlcigpIHdoZXJlIGFwcHJvcHJpYXRlIChKYW4gQmV1bGljaCkKLSBt
YWtlIGNwdSBwYXJhbWV0ZXIgdW5zaWduZWQgaW50IChKYW4gQmV1bGljaCkKLSBjb21tZW50cyAo
SmFuIEJldWxpY2gpCi0gdXNlIHRydWUgaW5zdGVhZCAxIGZvciBzZXR0aW5nIGJvb2wgKEphbiBC
ZXVsaWNoKQotIGNvbnN0IHBhcmFtZXRlciAoSmFuIEJldWxpY2gpClY1OgotIGFkZCBjb21tZW50
cyAoRGFyaW8gRmFnZ2lvbGkpCi0tLQogeGVuL2NvbW1vbi9zY2hlZHVsZS5jICAgICAgfCAxMzQg
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKy0tCiB4ZW4vaW5jbHVk
ZS94ZW4vc2NoZWQtaWYuaCB8ICAgOSArKy0KIHhlbi9pbmNsdWRlL3hlbi9zY2hlZC5oICAgIHwg
ICAyICsKIDMgZmlsZXMgY2hhbmdlZCwgMTM2IGluc2VydGlvbnMoKyksIDkgZGVsZXRpb25zKC0p
CgpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZHVsZS5jIGIveGVuL2NvbW1vbi9zY2hlZHVs
ZS5jCmluZGV4IGI0YzRiMDRlYmUuLjk0NDJiZTFjODMgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24v
c2NoZWR1bGUuYworKysgYi94ZW4vY29tbW9uL3NjaGVkdWxlLmMKQEAgLTc1MSw4ICs3NTEsMTAg
QEAgdm9pZCBzY2hlZF9kZXN0cm95X2RvbWFpbihzdHJ1Y3QgZG9tYWluICpkKQogICAgIH0KIH0K
IAotdm9pZCB2Y3B1X3NsZWVwX25vc3luY19sb2NrZWQoc3RydWN0IHZjcHUgKnYpCitzdGF0aWMg
dm9pZCB2Y3B1X3NsZWVwX25vc3luY19sb2NrZWQoc3RydWN0IHZjcHUgKnYpCiB7CisgICAgc3Ry
dWN0IHNjaGVkX3VuaXQgKnVuaXQgPSB2LT5zY2hlZF91bml0OworCiAgICAgQVNTRVJUKHNwaW5f
aXNfbG9ja2VkKGdldF9zY2hlZF9yZXModi0+cHJvY2Vzc29yKS0+c2NoZWR1bGVfbG9jaykpOwog
CiAgICAgaWYgKCBsaWtlbHkoIXZjcHVfcnVubmFibGUodikpICkKQEAgLTc2MCw3ICs3NjIsMTUg
QEAgdm9pZCB2Y3B1X3NsZWVwX25vc3luY19sb2NrZWQoc3RydWN0IHZjcHUgKnYpCiAgICAgICAg
IGlmICggdi0+cnVuc3RhdGUuc3RhdGUgPT0gUlVOU1RBVEVfcnVubmFibGUgKQogICAgICAgICAg
ICAgdmNwdV9ydW5zdGF0ZV9jaGFuZ2UodiwgUlVOU1RBVEVfb2ZmbGluZSwgTk9XKCkpOwogCi0g
ICAgICAgIHNjaGVkX3NsZWVwKHZjcHVfc2NoZWR1bGVyKHYpLCB2LT5zY2hlZF91bml0KTsKKyAg
ICAgICAgLyogT25seSBwdXQgdW5pdCB0byBzbGVlcCBpbiBjYXNlIGFsbCB2Y3B1cyBhcmUgbm90
IHJ1bm5hYmxlLiAqLworICAgICAgICBpZiAoIGxpa2VseSghdW5pdF9ydW5uYWJsZSh1bml0KSkg
KQorICAgICAgICAgICAgc2NoZWRfc2xlZXAodW5pdF9zY2hlZHVsZXIodW5pdCksIHVuaXQpOwor
ICAgICAgICBlbHNlIGlmICggdW5pdF9ydW5uaW5nKHVuaXQpID4gMSAmJiB2LT5pc19ydW5uaW5n
ICYmCisgICAgICAgICAgICAgICAgICAhdi0+Zm9yY2VfY29udGV4dF9zd2l0Y2ggKQorICAgICAg
ICB7CisgICAgICAgICAgICB2LT5mb3JjZV9jb250ZXh0X3N3aXRjaCA9IHRydWU7CisgICAgICAg
ICAgICBjcHVfcmFpc2Vfc29mdGlycSh2LT5wcm9jZXNzb3IsIFNDSEVEX1NMQVZFX1NPRlRJUlEp
OworICAgICAgICB9CiAgICAgfQogfQogCkBAIC03OTIsMTYgKzgwMiwyNyBAQCB2b2lkIHZjcHVf
d2FrZShzdHJ1Y3QgdmNwdSAqdikKIHsKICAgICB1bnNpZ25lZCBsb25nIGZsYWdzOwogICAgIHNw
aW5sb2NrX3QgKmxvY2s7CisgICAgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQgPSB2LT5zY2hlZF91
bml0OwogCiAgICAgVFJBQ0VfMkQoVFJDX1NDSEVEX1dBS0UsIHYtPmRvbWFpbi0+ZG9tYWluX2lk
LCB2LT52Y3B1X2lkKTsKIAotICAgIGxvY2sgPSB1bml0X3NjaGVkdWxlX2xvY2tfaXJxc2F2ZSh2
LT5zY2hlZF91bml0LCAmZmxhZ3MpOworICAgIGxvY2sgPSB1bml0X3NjaGVkdWxlX2xvY2tfaXJx
c2F2ZSh1bml0LCAmZmxhZ3MpOwogCiAgICAgaWYgKCBsaWtlbHkodmNwdV9ydW5uYWJsZSh2KSkg
KQogICAgIHsKICAgICAgICAgaWYgKCB2LT5ydW5zdGF0ZS5zdGF0ZSA+PSBSVU5TVEFURV9ibG9j
a2VkICkKICAgICAgICAgICAgIHZjcHVfcnVuc3RhdGVfY2hhbmdlKHYsIFJVTlNUQVRFX3J1bm5h
YmxlLCBOT1coKSk7Ci0gICAgICAgIHNjaGVkX3dha2UodmNwdV9zY2hlZHVsZXIodiksIHYtPnNj
aGVkX3VuaXQpOworICAgICAgICAvKgorICAgICAgICAgKiBDYWxsIHNjaGVkX3dha2UoKSB1bmNv
bmRpdGlvbmFsbHksIGV2ZW4gaWYgdW5pdCBpcyBydW5uaW5nIGFscmVhZHkuCisgICAgICAgICAq
IFdlIG1pZ2h0IGhhdmUgbm90IGJlZW4gZGUtc2NoZWR1bGVkIGFmdGVyIHZjcHVfc2xlZXBfbm9z
eW5jX2xvY2tlZCgpCisgICAgICAgICAqIGFuZCBhcmUgbm93IHRvIGJlIHdva2VuIHVwIGFnYWlu
LgorICAgICAgICAgKi8KKyAgICAgICAgc2NoZWRfd2FrZSh1bml0X3NjaGVkdWxlcih1bml0KSwg
dW5pdCk7CisgICAgICAgIGlmICggdW5pdC0+aXNfcnVubmluZyAmJiAhdi0+aXNfcnVubmluZyAm
JiAhdi0+Zm9yY2VfY29udGV4dF9zd2l0Y2ggKQorICAgICAgICB7CisgICAgICAgICAgICB2LT5m
b3JjZV9jb250ZXh0X3N3aXRjaCA9IHRydWU7CisgICAgICAgICAgICBjcHVfcmFpc2Vfc29mdGly
cSh2LT5wcm9jZXNzb3IsIFNDSEVEX1NMQVZFX1NPRlRJUlEpOworICAgICAgICB9CiAgICAgfQog
ICAgIGVsc2UgaWYgKCAhKHYtPnBhdXNlX2ZsYWdzICYgVlBGX2Jsb2NrZWQpICkKICAgICB7CkBA
IC04MDksNyArODMwLDcgQEAgdm9pZCB2Y3B1X3dha2Uoc3RydWN0IHZjcHUgKnYpCiAgICAgICAg
ICAgICB2Y3B1X3J1bnN0YXRlX2NoYW5nZSh2LCBSVU5TVEFURV9vZmZsaW5lLCBOT1coKSk7CiAg
ICAgfQogCi0gICAgdW5pdF9zY2hlZHVsZV91bmxvY2tfaXJxcmVzdG9yZShsb2NrLCBmbGFncywg
di0+c2NoZWRfdW5pdCk7CisgICAgdW5pdF9zY2hlZHVsZV91bmxvY2tfaXJxcmVzdG9yZShsb2Nr
LCBmbGFncywgdW5pdCk7CiB9CiAKIHZvaWQgdmNwdV91bmJsb2NrKHN0cnVjdCB2Y3B1ICp2KQpA
QCAtMjAyNyw2ICsyMDQ4LDY1IEBAIHN0YXRpYyB2b2lkIHNjaGVkX2NvbnRleHRfc3dpdGNoKHN0
cnVjdCB2Y3B1ICp2cHJldiwgc3RydWN0IHZjcHUgKnZuZXh0LAogICAgIGNvbnRleHRfc3dpdGNo
KHZwcmV2LCB2bmV4dCk7CiB9CiAKKy8qCisgKiBGb3JjZSBhIGNvbnRleHQgc3dpdGNoIG9mIGEg
c2luZ2xlIHZjcHUgb2YgYW4gdW5pdC4KKyAqIE1pZ2h0IGJlIGNhbGxlZCBlaXRoZXIgaWYgYSB2
Y3B1IG9mIGFuIGFscmVhZHkgcnVubmluZyB1bml0IGlzIHdva2VuIHVwCisgKiBvciBpZiBhIHZj
cHUgb2YgYSBydW5uaW5nIHVuaXQgaXMgcHV0IGFzbGVlcCB3aXRoIG90aGVyIHZjcHVzIG9mIHRo
ZSBzYW1lCisgKiB1bml0IHN0aWxsIHJ1bm5pbmcuCisgKiBSZXR1cm5zIGVpdGhlciBOVUxMIGlm
IHYgaXMgYWxyZWFkeSBpbiB0aGUgY29ycmVjdCBzdGF0ZSBvciB0aGUgdmNwdSB0bworICogcnVu
IG5leHQuCisgKi8KK3N0YXRpYyBzdHJ1Y3QgdmNwdSAqc2NoZWRfZm9yY2VfY29udGV4dF9zd2l0
Y2goc3RydWN0IHZjcHUgKnZwcmV2LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBzdHJ1Y3QgdmNwdSAqdiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IGNwdSwgc190aW1lX3Qgbm93KQorewor
ICAgIHYtPmZvcmNlX2NvbnRleHRfc3dpdGNoID0gZmFsc2U7CisKKyAgICBpZiAoIHZjcHVfcnVu
bmFibGUodikgPT0gdi0+aXNfcnVubmluZyApCisgICAgICAgIHJldHVybiBOVUxMOworCisgICAg
aWYgKCB2Y3B1X3J1bm5hYmxlKHYpICkKKyAgICB7CisgICAgICAgIGlmICggaXNfaWRsZV92Y3B1
KHZwcmV2KSApCisgICAgICAgIHsKKyAgICAgICAgICAgIHZjcHVfcnVuc3RhdGVfY2hhbmdlKHZw
cmV2LCBSVU5TVEFURV9ydW5uYWJsZSwgbm93KTsKKyAgICAgICAgICAgIHZwcmV2LT5zY2hlZF91
bml0ID0gZ2V0X3NjaGVkX3JlcyhjcHUpLT5zY2hlZF91bml0X2lkbGU7CisgICAgICAgIH0KKyAg
ICAgICAgdmNwdV9ydW5zdGF0ZV9jaGFuZ2UodiwgUlVOU1RBVEVfcnVubmluZywgbm93KTsKKyAg
ICB9CisgICAgZWxzZQorICAgIHsKKyAgICAgICAgLyogTWFrZSBzdXJlIG5vdCB0byBzd2l0Y2gg
bGFzdCB2Y3B1IG9mIGFuIHVuaXQgYXdheS4gKi8KKyAgICAgICAgaWYgKCB1bml0X3J1bm5pbmco
di0+c2NoZWRfdW5pdCkgPT0gMSApCisgICAgICAgICAgICByZXR1cm4gTlVMTDsKKworICAgICAg
ICB2LT5uZXdfc3RhdGUgPSB2Y3B1X3J1bnN0YXRlX2Jsb2NrZWQodik7CisgICAgICAgIHZjcHVf
cnVuc3RhdGVfY2hhbmdlKHYsIHYtPm5ld19zdGF0ZSwgbm93KTsKKyAgICAgICAgdiA9IHNjaGVk
X3VuaXQydmNwdV9jcHUodnByZXYtPnNjaGVkX3VuaXQsIGNwdSk7CisgICAgICAgIGlmICggdiAh
PSB2cHJldiApCisgICAgICAgIHsKKyAgICAgICAgICAgIGlmICggaXNfaWRsZV92Y3B1KHZwcmV2
KSApCisgICAgICAgICAgICB7CisgICAgICAgICAgICAgICAgdmNwdV9ydW5zdGF0ZV9jaGFuZ2Uo
dnByZXYsIFJVTlNUQVRFX3J1bm5hYmxlLCBub3cpOworICAgICAgICAgICAgICAgIHZwcmV2LT5z
Y2hlZF91bml0ID0gZ2V0X3NjaGVkX3JlcyhjcHUpLT5zY2hlZF91bml0X2lkbGU7CisgICAgICAg
ICAgICB9CisgICAgICAgICAgICBlbHNlCisgICAgICAgICAgICB7CisgICAgICAgICAgICAgICAg
di0+c2NoZWRfdW5pdCA9IHZwcmV2LT5zY2hlZF91bml0OworICAgICAgICAgICAgICAgIHZjcHVf
cnVuc3RhdGVfY2hhbmdlKHYsIFJVTlNUQVRFX3J1bm5pbmcsIG5vdyk7CisgICAgICAgICAgICB9
CisgICAgICAgIH0KKyAgICB9CisKKyAgICAvKiBUaGlzIHZjcHUgd2lsbCBiZSBzd2l0Y2hlZCB0
by4gKi8KKyAgICB2LT5pc19ydW5uaW5nID0gdHJ1ZTsKKworICAgIC8qIE1ha2Ugc3VyZSBub3Qg
dG8gbG9vc2UgYW5vdGhlciBzbGF2ZSBjYWxsLiAqLworICAgIHJhaXNlX3NvZnRpcnEoU0NIRURf
U0xBVkVfU09GVElSUSk7CisKKyAgICByZXR1cm4gdjsKK30KKwogLyoKICAqIFJlbmRlenZvdXMg
YmVmb3JlIHRha2luZyBhIHNjaGVkdWxpbmcgZGVjaXNpb24uCiAgKiBDYWxsZWQgd2l0aCBzY2hl
ZHVsZSBsb2NrIGhlbGQsIHNvIGFsbCBhY2Nlc3NlcyB0byB0aGUgcmVuZGV6dm91cyBjb3VudGVy
CkBAIC0yMDQyLDYgKzIxMjIsNyBAQCBzdGF0aWMgc3RydWN0IHNjaGVkX3VuaXQgKnNjaGVkX3dh
aXRfcmVuZGV6dm91c19pbihzdHJ1Y3Qgc2NoZWRfdW5pdCAqcHJldiwKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNfdGltZV90IG5vdykKIHsKICAg
ICBzdHJ1Y3Qgc2NoZWRfdW5pdCAqbmV4dDsKKyAgICBzdHJ1Y3QgdmNwdSAqdjsKIAogICAgIGlm
ICggIS0tcHJldi0+cmVuZGV6dm91c19pbl9jbnQgKQogICAgIHsKQEAgLTIwNTAsOCArMjEzMSwy
OCBAQCBzdGF0aWMgc3RydWN0IHNjaGVkX3VuaXQgKnNjaGVkX3dhaXRfcmVuZGV6dm91c19pbihz
dHJ1Y3Qgc2NoZWRfdW5pdCAqcHJldiwKICAgICAgICAgcmV0dXJuIG5leHQ7CiAgICAgfQogCisg
ICAgdiA9IHVuaXQydmNwdV9jcHUocHJldiwgY3B1KTsKICAgICB3aGlsZSAoIHByZXYtPnJlbmRl
enZvdXNfaW5fY250ICkKICAgICB7CisgICAgICAgIGlmICggdiAmJiB2LT5mb3JjZV9jb250ZXh0
X3N3aXRjaCApCisgICAgICAgIHsKKyAgICAgICAgICAgIHN0cnVjdCB2Y3B1ICp2cHJldiA9IGN1
cnJlbnQ7CisKKyAgICAgICAgICAgIHYgPSBzY2hlZF9mb3JjZV9jb250ZXh0X3N3aXRjaCh2cHJl
diwgdiwgY3B1LCBub3cpOworCisgICAgICAgICAgICBpZiAoIHYgKQorICAgICAgICAgICAgewor
ICAgICAgICAgICAgICAgIC8qIFdlJ2xsIGNvbWUgYmFjayBhbm90aGVyIHRpbWUsIHNvIGFkanVz
dCByZW5kZXp2b3VzX2luX2NudC4gKi8KKyAgICAgICAgICAgICAgICBwcmV2LT5yZW5kZXp2b3Vz
X2luX2NudCsrOworICAgICAgICAgICAgICAgIGF0b21pY19zZXQoJnByZXYtPnJlbmRlenZvdXNf
b3V0X2NudCwgMCk7CisKKyAgICAgICAgICAgICAgICBwY3B1X3NjaGVkdWxlX3VubG9ja19pcnEo
KmxvY2ssIGNwdSk7CisKKyAgICAgICAgICAgICAgICBzY2hlZF9jb250ZXh0X3N3aXRjaCh2cHJl
diwgdiwgZmFsc2UsIG5vdyk7CisgICAgICAgICAgICB9CisKKyAgICAgICAgICAgIHYgPSB1bml0
MnZjcHVfY3B1KHByZXYsIGNwdSk7CisgICAgICAgIH0KICAgICAgICAgLyoKICAgICAgICAgICog
Q29taW5nIGZyb20gaWRsZSBtaWdodCBuZWVkIHRvIGRvIHRhc2tsZXQgd29yay4KICAgICAgICAg
ICogSW4gb3JkZXIgdG8gYXZvaWQgZGVhZGxvY2tzIHdlIGNhbid0IGRvIHRoYXQgaGVyZSwgYnV0
IGhhdmUgdG8KQEAgLTIwODYsMTAgKzIxODcsMTEgQEAgc3RhdGljIHN0cnVjdCBzY2hlZF91bml0
ICpzY2hlZF93YWl0X3JlbmRlenZvdXNfaW4oc3RydWN0IHNjaGVkX3VuaXQgKnByZXYsCiAKIHN0
YXRpYyB2b2lkIHNjaGVkX3NsYXZlKHZvaWQpCiB7Ci0gICAgc3RydWN0IHZjcHUgICAgICAgICAg
KnZwcmV2ID0gY3VycmVudDsKKyAgICBzdHJ1Y3QgdmNwdSAgICAgICAgICAqdiwgKnZwcmV2ID0g
Y3VycmVudDsKICAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCAgICAqcHJldiA9IHZwcmV2LT5zY2hlZF91
bml0LCAqbmV4dDsKICAgICBzX3RpbWVfdCAgICAgICAgICAgICAgbm93OwogICAgIHNwaW5sb2Nr
X3QgICAgICAgICAgICpsb2NrOworICAgIGJvb2wgICAgICAgICAgICAgICAgICBkb19zb2Z0aXJx
ID0gZmFsc2U7CiAgICAgdW5zaWduZWQgaW50ICAgICAgICAgIGNwdSA9IHNtcF9wcm9jZXNzb3Jf
aWQoKTsKIAogICAgIEFTU0VSVF9OT1RfSU5fQVRPTUlDKCk7CkBAIC0yMDk4LDkgKzIyMDAsMjkg
QEAgc3RhdGljIHZvaWQgc2NoZWRfc2xhdmUodm9pZCkKIAogICAgIG5vdyA9IE5PVygpOwogCisg
ICAgdiA9IHVuaXQydmNwdV9jcHUocHJldiwgY3B1KTsKKyAgICBpZiAoIHYgJiYgdi0+Zm9yY2Vf
Y29udGV4dF9zd2l0Y2ggKQorICAgIHsKKyAgICAgICAgdiA9IHNjaGVkX2ZvcmNlX2NvbnRleHRf
c3dpdGNoKHZwcmV2LCB2LCBjcHUsIG5vdyk7CisKKyAgICAgICAgaWYgKCB2ICkKKyAgICAgICAg
eworICAgICAgICAgICAgcGNwdV9zY2hlZHVsZV91bmxvY2tfaXJxKGxvY2ssIGNwdSk7CisKKyAg
ICAgICAgICAgIHNjaGVkX2NvbnRleHRfc3dpdGNoKHZwcmV2LCB2LCBmYWxzZSwgbm93KTsKKyAg
ICAgICAgfQorCisgICAgICAgIGRvX3NvZnRpcnEgPSB0cnVlOworICAgIH0KKwogICAgIGlmICgg
IXByZXYtPnJlbmRlenZvdXNfaW5fY250ICkKICAgICB7CiAgICAgICAgIHBjcHVfc2NoZWR1bGVf
dW5sb2NrX2lycShsb2NrLCBjcHUpOworCisgICAgICAgIC8qIENoZWNrIGZvciBmYWlsZWQgZm9y
Y2VkIGNvbnRleHQgc3dpdGNoLiAqLworICAgICAgICBpZiAoIGRvX3NvZnRpcnEgKQorICAgICAg
ICAgICAgcmFpc2Vfc29mdGlycShTQ0hFRFVMRV9TT0ZUSVJRKTsKKwogICAgICAgICByZXR1cm47
CiAgICAgfQogCmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQtaWYuaCBiL3hlbi9p
bmNsdWRlL3hlbi9zY2hlZC1pZi5oCmluZGV4IDQxYTEwODNhMDguLjAyMWMxZDdjMmMgMTAwNjQ0
Ci0tLSBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5oCisrKyBiL3hlbi9pbmNsdWRlL3hlbi9z
Y2hlZC1pZi5oCkBAIC0xMDIsNiArMTAyLDExIEBAIHN0YXRpYyBpbmxpbmUgYm9vbCB1bml0X3J1
bm5hYmxlKGNvbnN0IHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogICAgIHJldHVybiBmYWxzZTsK
IH0KIAorc3RhdGljIGlubGluZSBpbnQgdmNwdV9ydW5zdGF0ZV9ibG9ja2VkKGNvbnN0IHN0cnVj
dCB2Y3B1ICp2KQoreworICAgIHJldHVybiAodi0+cGF1c2VfZmxhZ3MgJiBWUEZfYmxvY2tlZCkg
PyBSVU5TVEFURV9ibG9ja2VkIDogUlVOU1RBVEVfb2ZmbGluZTsKK30KKwogLyoKICAqIFJldHVy
bnMgd2hldGhlciBhIHNjaGVkX3VuaXQgaXMgcnVubmFibGUgYW5kIHNldHMgbmV3X3N0YXRlIGZv
ciBlYWNoIG9mIGl0cwogICogdmNwdXMuIEl0IGlzIG1hbmRhdG9yeSB0byBkZXRlcm1pbmUgdGhl
IG5ldyBydW5zdGF0ZSBmb3IgYWxsIHZjcHVzIG9mIGEgdW5pdApAQCAtMTIxLDkgKzEyNiw3IEBA
IHN0YXRpYyBpbmxpbmUgYm9vbCB1bml0X3J1bm5hYmxlX3N0YXRlKGNvbnN0IHN0cnVjdCBzY2hl
ZF91bml0ICp1bml0KQogICAgIHsKICAgICAgICAgcnVubmFibGUgPSB2Y3B1X3J1bm5hYmxlKHYp
OwogCi0gICAgICAgIHYtPm5ld19zdGF0ZSA9IHJ1bm5hYmxlID8gUlVOU1RBVEVfcnVubmluZwot
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6ICh2LT5wYXVzZV9mbGFncyAmIFZQRl9i
bG9ja2VkKQotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gUlVOU1RBVEVfYmxv
Y2tlZCA6IFJVTlNUQVRFX29mZmxpbmU7CisgICAgICAgIHYtPm5ld19zdGF0ZSA9IHJ1bm5hYmxl
ID8gUlVOU1RBVEVfcnVubmluZyA6IHZjcHVfcnVuc3RhdGVfYmxvY2tlZCh2KTsKIAogICAgICAg
ICBpZiAoIHJ1bm5hYmxlICkKICAgICAgICAgICAgIHJldCA9IHRydWU7CmRpZmYgLS1naXQgYS94
ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaCBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCmluZGV4IGNl
NDMyOWRiNzIuLmY5NzMwMzY2OGEgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5o
CisrKyBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCkBAIC0xODYsNiArMTg2LDggQEAgc3RydWN0
IHZjcHUKICAgICBib29sICAgICAgICAgICAgIGlzX3J1bm5pbmc7CiAgICAgLyogVkNQVSBzaG91
bGQgd2FrZSBmYXN0IChkbyBub3QgZGVlcCBzbGVlcCB0aGUgQ1BVKS4gKi8KICAgICBib29sICAg
ICAgICAgICAgIGlzX3VyZ2VudDsKKyAgICAvKiBWQ1BVIG11c3QgY29udGV4dF9zd2l0Y2ggd2l0
aG91dCBzY2hlZHVsaW5nIHVuaXQuICovCisgICAgYm9vbCAgICAgICAgICAgICBmb3JjZV9jb250
ZXh0X3N3aXRjaDsKIAogI2lmZGVmIFZDUFVfVFJBUF9MQVNUCiAjZGVmaW5lIFZDUFVfVFJBUF9O
T05FICAgIDAKLS0gCjIuMTYuNAoKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnBy
b2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94
ZW4tZGV2ZWw=

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id F1E6CBFF97
	for <lists+xen-devel@lfdr.de>; Fri, 27 Sep 2019 09:04:13 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iDkG5-0003dW-7B; Fri, 27 Sep 2019 07:01:41 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=Rbpq=XW=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1iDkG4-0003cb-6W
 for xen-devel@lists.xenproject.org; Fri, 27 Sep 2019 07:01:40 +0000
X-Inumbo-ID: 8fce4c00-e0f4-11e9-966c-12813bfff9fa
Received: from mx1.suse.de (unknown [195.135.220.15])
 by localhost (Halon) with ESMTPS
 id 8fce4c00-e0f4-11e9-966c-12813bfff9fa;
 Fri, 27 Sep 2019 07:01:02 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id BDD76B171;
 Fri, 27 Sep 2019 07:00:59 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Fri, 27 Sep 2019 09:00:18 +0200
Message-Id: <20190927070050.12405-15-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190927070050.12405-1-jgross@suse.com>
References: <20190927070050.12405-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v4 14/46] xen/sched: make null scheduler vcpu
 agnostic.
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Dario Faggioli <dfaggioli@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

U3dpdGNoIG51bGwgc2NoZWR1bGVyIGNvbXBsZXRlbHkgZnJvbSB2Y3B1IHRvIHNjaGVkX3VuaXQg
dXNhZ2UuCgpTaWduZWQtb2ZmLWJ5OiBKdWVyZ2VuIEdyb3NzIDxqZ3Jvc3NAc3VzZS5jb20+ClJl
dmlld2VkLWJ5OiBEYXJpbyBGYWdnaW9saSA8ZGZhZ2dpb2xpQHN1c2UuY29tPgotLS0KVjQ6Ci0g
SXRlbSAtPiB1bml0IChEYXJpbyBGYWdnaW9saSkKLS0tCiB4ZW4vY29tbW9uL3NjaGVkX251bGwu
YyB8IDMzMyArKysrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0K
IDEgZmlsZSBjaGFuZ2VkLCAxNjUgaW5zZXJ0aW9ucygrKSwgMTY4IGRlbGV0aW9ucygtKQoKZGlm
ZiAtLWdpdCBhL3hlbi9jb21tb24vc2NoZWRfbnVsbC5jIGIveGVuL2NvbW1vbi9zY2hlZF9udWxs
LmMKaW5kZXggM2U2ZjlmNzJlMi4uNGM5ZWVkODFhZSAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9z
Y2hlZF9udWxsLmMKKysrIGIveGVuL2NvbW1vbi9zY2hlZF9udWxsLmMKQEAgLTE4LDEwICsxOCwx
MCBAQAogCiAvKgogICogVGhlICdudWxsJyBzY2hlZHVsZXIgYWx3YXlzIGNob29zZSB0byBydW4s
IG9uIGVhY2ggcENQVSwgZWl0aGVyIG5vdGhpbmcKLSAqIChpLmUuLCB0aGUgcENQVSBzdGF5cyBp
ZGxlKSBvciBhbHdheXMgdGhlIHNhbWUgdkNQVS4KKyAqIChpLmUuLCB0aGUgcENQVSBzdGF5cyBp
ZGxlKSBvciBhbHdheXMgdGhlIHNhbWUgdW5pdC4KICAqCiAgKiBJdCBpcyBhaW1lZCBhdCBzdXBw
b3J0aW5nIHN0YXRpYyBzY2VuYXJpb3MsIHdoZXJlIHRoZXJlIGFsd2F5cyBhcmUKLSAqIGxlc3Mg
dkNQVXMgdGhhbiBwQ1BVcyAoYW5kIHRoZSB2Q1BVcyBkb24ndCBuZWVkIHRvIG1vdmUgYW1vbmcg
cENQVXMKKyAqIGxlc3MgdW5pdHMgdGhhbiBwQ1BVcyAoYW5kIHRoZSB1bml0cyBkb24ndCBuZWVk
IHRvIG1vdmUgYW1vbmcgcENQVXMKICAqIGZvciBhbnkgcmVhc29uKSB3aXRoIHRoZSBsZWFzdCBw
b3NzaWJsZSBvdmVyaGVhZC4KICAqCiAgKiBUeXBpY2FsIHVzZWNhc2UgYXJlIGVtYmVkZGVkIGFw
cGxpY2F0aW9ucywgYnV0IGFsc28gSFBDLCBlc3BlY2lhbGx5CkBAIC0zNyw4ICszNyw4IEBACiAg
KiBudWxsIHRyYWNpbmcgZXZlbnRzLiBDaGVjayBpbmNsdWRlL3B1YmxpYy90cmFjZS5oIGZvciBt
b3JlIGRldGFpbHMuCiAgKi8KICNkZWZpbmUgVFJDX1NOVUxMX1BJQ0tFRF9DUFUgICAgVFJDX1ND
SEVEX0NMQVNTX0VWVChTTlVMTCwgMSkKLSNkZWZpbmUgVFJDX1NOVUxMX1ZDUFVfQVNTSUdOICAg
VFJDX1NDSEVEX0NMQVNTX0VWVChTTlVMTCwgMikKLSNkZWZpbmUgVFJDX1NOVUxMX1ZDUFVfREVB
U1NJR04gVFJDX1NDSEVEX0NMQVNTX0VWVChTTlVMTCwgMykKKyNkZWZpbmUgVFJDX1NOVUxMX1VO
SVRfQVNTSUdOICAgVFJDX1NDSEVEX0NMQVNTX0VWVChTTlVMTCwgMikKKyNkZWZpbmUgVFJDX1NO
VUxMX1VOSVRfREVBU1NJR04gVFJDX1NDSEVEX0NMQVNTX0VWVChTTlVMTCwgMykKICNkZWZpbmUg
VFJDX1NOVUxMX01JR1JBVEUgICAgICAgVFJDX1NDSEVEX0NMQVNTX0VWVChTTlVMTCwgNCkKICNk
ZWZpbmUgVFJDX1NOVUxMX1NDSEVEVUxFICAgICAgVFJDX1NDSEVEX0NMQVNTX0VWVChTTlVMTCwg
NSkKICNkZWZpbmUgVFJDX1NOVUxMX1RBU0tMRVQgICAgICAgVFJDX1NDSEVEX0NMQVNTX0VWVChT
TlVMTCwgNikKQEAgLTQ3LDEzICs0NywxMyBAQAogICogTG9ja2luZzoKICAqIC0gU2NoZWR1bGVy
LWxvY2sgKGEuay5hLiBydW5xdWV1ZSBsb2NrKToKICAqICArIGlzIHBlci1wQ1BVOwotICogICsg
c2VyaWFsaXplcyBhc3NpZ25tZW50IGFuZCBkZWFzc2lnbm1lbnQgb2YgdkNQVXMgdG8gYSBwQ1BV
LgorICogICsgc2VyaWFsaXplcyBhc3NpZ25tZW50IGFuZCBkZWFzc2lnbm1lbnQgb2YgdW5pdHMg
dG8gYSBwQ1BVLgogICogLSBQcml2YXRlIGRhdGEgbG9jayAoYS5rLmEuIHByaXZhdGUgc2NoZWR1
bGVyIGxvY2spOgogICogICsgaXMgc2NoZWR1bGVyLXdpZGU7CiAgKiAgKyBzZXJpYWxpemVzIGFj
Y2Vzc2VzIHRvIHRoZSBsaXN0IG9mIGRvbWFpbnMgaW4gdGhpcyBzY2hlZHVsZXIuCiAgKiAtIFdh
aXRxdWV1ZSBsb2NrOgogICogICsgaXMgc2NoZWR1bGVyLXdpZGU7Ci0gKiAgKyBzZXJpYWxpemUg
YWNjZXNzZXMgdG8gdGhlIGxpc3Qgb2YgdkNQVXMgd2FpdGluZyB0byBiZSBhc3NpZ25lZAorICog
ICsgc2VyaWFsaXplIGFjY2Vzc2VzIHRvIHRoZSBsaXN0IG9mIHVuaXRzIHdhaXRpbmcgdG8gYmUg
YXNzaWduZWQKICAqICAgIHRvIHBDUFVzLgogICoKICAqIE9yZGVyaW5nIGlzOiBwcml2YXRlIGxv
Y2ssIHJ1bnF1ZXVlIGxvY2ssIHdhaXRxdWV1ZSBsb2NrLiBPciwgT1RPSCwKQEAgLTc3LDI1ICs3
NywyNSBAQAogc3RydWN0IG51bGxfcHJpdmF0ZSB7CiAgICAgc3BpbmxvY2tfdCBsb2NrOyAgICAg
ICAgLyogc2NoZWR1bGVyIGxvY2s7IG5lc3RzIGluc2lkZSBjcHVwb29sX2xvY2sgKi8KICAgICBz
dHJ1Y3QgbGlzdF9oZWFkIG5kb207ICAvKiBEb21haW5zIG9mIHRoaXMgc2NoZWR1bGVyICAgICAg
ICAgICAgICAgICAqLwotICAgIHN0cnVjdCBsaXN0X2hlYWQgd2FpdHE7IC8qIHZDUFVzIG5vdCBh
c3NpZ25lZCB0byBhbnkgcENQVSAgICAgICAgICAgICovCisgICAgc3RydWN0IGxpc3RfaGVhZCB3
YWl0cTsgLyogdW5pdHMgbm90IGFzc2lnbmVkIHRvIGFueSBwQ1BVICAgICAgICAgICAgKi8KICAg
ICBzcGlubG9ja190IHdhaXRxX2xvY2s7ICAvKiBzZXJpYWxpemVzIHdhaXRxOyBuZXN0cyBpbnNp
ZGUgcnVucSBsb2NrcyAqLwotICAgIGNwdW1hc2tfdCBjcHVzX2ZyZWU7ICAgIC8qIENQVXMgd2l0
aG91dCBhIHZDUFUgYXNzb2NpYXRlZCB0byB0aGVtICAgICovCisgICAgY3B1bWFza190IGNwdXNf
ZnJlZTsgICAgLyogQ1BVcyB3aXRob3V0IGEgdW5pdCBhc3NvY2lhdGVkIHRvIHRoZW0gICAgKi8K
IH07CiAKIC8qCiAgKiBQaHlzaWNhbCBDUFUKICAqLwogc3RydWN0IG51bGxfcGNwdSB7Ci0gICAg
c3RydWN0IHZjcHUgKnZjcHU7CisgICAgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQ7CiB9OwogREVG
SU5FX1BFUl9DUFUoc3RydWN0IG51bGxfcGNwdSwgbnBjKTsKIAogLyoKLSAqIFZpcnR1YWwgQ1BV
CisgKiBTY2hlZHVsZSB1bml0CiAgKi8KIHN0cnVjdCBudWxsX3VuaXQgewogICAgIHN0cnVjdCBs
aXN0X2hlYWQgd2FpdHFfZWxlbTsKLSAgICBzdHJ1Y3QgdmNwdSAqdmNwdTsKKyAgICBzdHJ1Y3Qg
c2NoZWRfdW5pdCAqdW5pdDsKIH07CiAKIC8qCkBAIC0xMTksMTMgKzExOSwxMyBAQCBzdGF0aWMg
aW5saW5lIHN0cnVjdCBudWxsX3VuaXQgKm51bGxfdW5pdChjb25zdCBzdHJ1Y3Qgc2NoZWRfdW5p
dCAqdW5pdCkKICAgICByZXR1cm4gdW5pdC0+cHJpdjsKIH0KIAotc3RhdGljIGlubGluZSBib29s
IHZjcHVfY2hlY2tfYWZmaW5pdHkoc3RydWN0IHZjcHUgKnYsIHVuc2lnbmVkIGludCBjcHUsCitz
dGF0aWMgaW5saW5lIGJvb2wgdW5pdF9jaGVja19hZmZpbml0eShzdHJ1Y3Qgc2NoZWRfdW5pdCAq
dW5pdCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGlu
dCBjcHUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBp
bnQgYmFsYW5jZV9zdGVwKQogewotICAgIGFmZmluaXR5X2JhbGFuY2VfY3B1bWFzayh2LT5zY2hl
ZF91bml0LCBiYWxhbmNlX3N0ZXAsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNwdW1h
c2tfc2NyYXRjaF9jcHUoY3B1KSk7CisgICAgYWZmaW5pdHlfYmFsYW5jZV9jcHVtYXNrKHVuaXQs
IGJhbGFuY2Vfc3RlcCwgY3B1bWFza19zY3JhdGNoX2NwdShjcHUpKTsKICAgICBjcHVtYXNrX2Fu
ZChjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksIGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwKLSAg
ICAgICAgICAgICAgICBjcHVwb29sX2RvbWFpbl9jcHVtYXNrKHYtPmRvbWFpbikpOworICAgICAg
ICAgICAgICAgIGNwdXBvb2xfZG9tYWluX2NwdW1hc2sodW5pdC0+ZG9tYWluKSk7CiAKICAgICBy
ZXR1cm4gY3B1bWFza190ZXN0X2NwdShjcHUsIGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSk7CiB9
CkBAIC0xNjAsOSArMTYwLDkgQEAgc3RhdGljIHZvaWQgbnVsbF9kZWluaXQoc3RydWN0IHNjaGVk
dWxlciAqb3BzKQogCiBzdGF0aWMgdm9pZCBpbml0X3BkYXRhKHN0cnVjdCBudWxsX3ByaXZhdGUg
KnBydiwgdW5zaWduZWQgaW50IGNwdSkKIHsKLSAgICAvKiBNYXJrIHRoZSBwQ1BVIGFzIGZyZWUs
IGFuZCB3aXRoIG5vIHZDUFUgYXNzaWduZWQgKi8KKyAgICAvKiBNYXJrIHRoZSBwQ1BVIGFzIGZy
ZWUsIGFuZCB3aXRoIG5vIHVuaXQgYXNzaWduZWQgKi8KICAgICBjcHVtYXNrX3NldF9jcHUoY3B1
LCAmcHJ2LT5jcHVzX2ZyZWUpOwotICAgIHBlcl9jcHUobnBjLCBjcHUpLnZjcHUgPSBOVUxMOwor
ICAgIHBlcl9jcHUobnBjLCBjcHUpLnVuaXQgPSBOVUxMOwogfQogCiBzdGF0aWMgdm9pZCBudWxs
X2luaXRfcGRhdGEoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCB2b2lkICpwZGF0YSwgaW50
IGNwdSkKQEAgLTE4MywxMyArMTgzLDEyIEBAIHN0YXRpYyB2b2lkIG51bGxfZGVpbml0X3BkYXRh
KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgdm9pZCAqcGNwdSwgaW50IGNwdSkKICAgICBB
U1NFUlQoIXBjcHUpOwogCiAgICAgY3B1bWFza19jbGVhcl9jcHUoY3B1LCAmcHJ2LT5jcHVzX2Zy
ZWUpOwotICAgIHBlcl9jcHUobnBjLCBjcHUpLnZjcHUgPSBOVUxMOworICAgIHBlcl9jcHUobnBj
LCBjcHUpLnVuaXQgPSBOVUxMOwogfQogCiBzdGF0aWMgdm9pZCAqbnVsbF9hbGxvY191ZGF0YShj
b25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCwgdm9pZCAqZGQpCiB7Ci0gICAgc3RydWN0IHZjcHUg
KnYgPSB1bml0LT52Y3B1X2xpc3Q7CiAgICAgc3RydWN0IG51bGxfdW5pdCAqbnZjOwogCiAgICAg
bnZjID0geHphbGxvYyhzdHJ1Y3QgbnVsbF91bml0KTsKQEAgLTE5Nyw3ICsxOTYsNyBAQCBzdGF0
aWMgdm9pZCAqbnVsbF9hbGxvY191ZGF0YShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAg
ICAgICAgIHJldHVybiBOVUxMOwogCiAgICAgSU5JVF9MSVNUX0hFQUQoJm52Yy0+d2FpdHFfZWxl
bSk7Ci0gICAgbnZjLT52Y3B1ID0gdjsKKyAgICBudmMtPnVuaXQgPSB1bml0OwogCiAgICAgU0NI
RURfU1RBVF9DUkFOSyh1bml0X2FsbG9jKTsKIApAQCAtMjQ5LDE1ICsyNDgsMTUgQEAgc3RhdGlj
IHZvaWQgbnVsbF9mcmVlX2RvbWRhdGEoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCB2b2lk
ICpkYXRhKQogfQogCiAvKgotICogdkNQVSB0byBwQ1BVIGFzc2lnbm1lbnQgYW5kIHBsYWNlbWVu
dC4gVGhpcyBfb25seV8gaGFwcGVuczoKKyAqIHVuaXQgdG8gcENQVSBhc3NpZ25tZW50IGFuZCBw
bGFjZW1lbnQuIFRoaXMgX29ubHlfIGhhcHBlbnM6CiAgKiAgLSBvbiBpbnNlcnQsCiAgKiAgLSBv
biBtaWdyYXRlLgogICoKLSAqIEluc2VydCBvY2N1cnMgd2hlbiBhIHZDUFUgam9pbnMgdGhpcyBz
Y2hlZHVsZXIgZm9yIHRoZSBmaXJzdCB0aW1lCisgKiBJbnNlcnQgb2NjdXJzIHdoZW4gYSB1bml0
IGpvaW5zIHRoaXMgc2NoZWR1bGVyIGZvciB0aGUgZmlyc3QgdGltZQogICogKGUuZy4sIHdoZW4g
dGhlIGRvbWFpbiBpdCdzIHBhcnQgb2YgaXMgbW92ZWQgdG8gdGhlIHNjaGVkdWxlcidzCiAgKiBj
cHVwb29sKS4KICAqCi0gKiBNaWdyYXRpb24gbWF5IGJlIG5lY2Vzc2FyeSBpZiBhIHBDUFUgKHdp
dGggYSB2Q1BVIGFzc2lnbmVkIHRvIGl0KQorICogTWlncmF0aW9uIG1heSBiZSBuZWNlc3Nhcnkg
aWYgYSBwQ1BVICh3aXRoIGEgdW5pdCBhc3NpZ25lZCB0byBpdCkKICAqIGlzIHJlbW92ZWQgZnJv
bSB0aGUgc2NoZWR1bGVyJ3MgY3B1cG9vbC4KICAqCiAgKiBTbyB0aGlzIGlzIG5vdCBwYXJ0IG9m
IGFueSBob3QgcGF0aC4KQEAgLTI2Niw5ICsyNjUsOCBAQCBzdGF0aWMgc3RydWN0IHNjaGVkX3Jl
c291cmNlICoKIHBpY2tfcmVzKHN0cnVjdCBudWxsX3ByaXZhdGUgKnBydiwgY29uc3Qgc3RydWN0
IHNjaGVkX3VuaXQgKnVuaXQpCiB7CiAgICAgdW5zaWduZWQgaW50IGJzOwotICAgIHN0cnVjdCB2
Y3B1ICp2ID0gdW5pdC0+dmNwdV9saXN0OwotICAgIHVuc2lnbmVkIGludCBjcHUgPSB2LT5wcm9j
ZXNzb3IsIG5ld19jcHU7Ci0gICAgY3B1bWFza190ICpjcHVzID0gY3B1cG9vbF9kb21haW5fY3B1
bWFzayh2LT5kb21haW4pOworICAgIHVuc2lnbmVkIGludCBjcHUgPSBzY2hlZF91bml0X21hc3Rl
cih1bml0KSwgbmV3X2NwdTsKKyAgICBjcHVtYXNrX3QgKmNwdXMgPSBjcHVwb29sX2RvbWFpbl9j
cHVtYXNrKHVuaXQtPmRvbWFpbik7CiAKICAgICBBU1NFUlQoc3Bpbl9pc19sb2NrZWQoZ2V0X3Nj
aGVkX3JlcyhjcHUpLT5zY2hlZHVsZV9sb2NrKSk7CiAKQEAgLTI4MywxMSArMjgxLDEyIEBAIHBp
Y2tfcmVzKHN0cnVjdCBudWxsX3ByaXZhdGUgKnBydiwgY29uc3Qgc3RydWN0IHNjaGVkX3VuaXQg
KnVuaXQpCiAgICAgICAgIC8qCiAgICAgICAgICAqIElmIG91ciBwcm9jZXNzb3IgaXMgZnJlZSwg
b3Igd2UgYXJlIGFzc2lnbmVkIHRvIGl0LCBhbmQgaXQgaXMgYWxzbwogICAgICAgICAgKiBzdGls
bCB2YWxpZCBhbmQgcGFydCBvZiBvdXIgYWZmaW5pdHksIGp1c3QgZ28gZm9yIGl0LgotICAgICAg
ICAgKiAoTm90ZSB0aGF0IHdlIG1heSBjYWxsIHZjcHVfY2hlY2tfYWZmaW5pdHkoKSwgYnV0IHdl
IGRlbGliZXJhdGVseQorICAgICAgICAgKiAoTm90ZSB0aGF0IHdlIG1heSBjYWxsIHVuaXRfY2hl
Y2tfYWZmaW5pdHkoKSwgYnV0IHdlIGRlbGliZXJhdGVseQogICAgICAgICAgKiBkb24ndCwgc28g
d2UgZ2V0IHRvIGtlZXAgaW4gdGhlIHNjcmF0Y2ggY3B1bWFzayB3aGF0IHdlIGhhdmUganVzdAog
ICAgICAgICAgKiBwdXQgaW4gaXQuKQogICAgICAgICAgKi8KLSAgICAgICAgaWYgKCBsaWtlbHko
KHBlcl9jcHUobnBjLCBjcHUpLnZjcHUgPT0gTlVMTCB8fCBwZXJfY3B1KG5wYywgY3B1KS52Y3B1
ID09IHYpCisgICAgICAgIGlmICggbGlrZWx5KChwZXJfY3B1KG5wYywgY3B1KS51bml0ID09IE5V
TEwgfHwKKyAgICAgICAgICAgICAgICAgICAgIHBlcl9jcHUobnBjLCBjcHUpLnVuaXQgPT0gdW5p
dCkKICAgICAgICAgICAgICAgICAgICAgJiYgY3B1bWFza190ZXN0X2NwdShjcHUsIGNwdW1hc2tf
c2NyYXRjaF9jcHUoY3B1KSkpICkKICAgICAgICAgewogICAgICAgICAgICAgbmV3X2NwdSA9IGNw
dTsKQEAgLTMwNSwxMyArMzA0LDEzIEBAIHBpY2tfcmVzKHN0cnVjdCBudWxsX3ByaXZhdGUgKnBy
diwgY29uc3Qgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiAKICAgICAvKgogICAgICAqIElmIHdl
IGRpZG4ndCBmaW5kIGFueSBmcmVlIHBDUFUsIGp1c3QgcGljayBhbnkgdmFsaWQgcGNwdSwgZXZl
biBpZgotICAgICAqIGl0IGhhcyBhbm90aGVyIHZDUFUgYXNzaWduZWQuIFRoaXMgd2lsbCBoYXBw
ZW4gZHVyaW5nIHNodXRkb3duIGFuZAorICAgICAqIGl0IGhhcyBhbm90aGVyIHVuaXQgYXNzaWdu
ZWQuIFRoaXMgd2lsbCBoYXBwZW4gZHVyaW5nIHNodXRkb3duIGFuZAogICAgICAqIHN1c3BlbmQv
cmVzdW1lLCBidXQgaXQgbWF5IGFsc28gaGFwcGVuIGR1cmluZyAibm9ybWFsIG9wZXJhdGlvbiIs
IGlmCiAgICAgICogYWxsIHRoZSBwQ1BVcyBhcmUgYnVzeS4KICAgICAgKgogICAgICAqIEluIGZh
Y3QsIHRoZXJlIG11c3QgYWx3YXlzIGJlIHNvbWV0aGluZyBzYW5lIGluIHYtPnByb2Nlc3Nvciwg
b3IKICAgICAgKiB1bml0X3NjaGVkdWxlX2xvY2soKSBhbmQgZnJpZW5kcyB3b24ndCB3b3JrLiBU
aGlzIGlzIG5vdCBhIHByb2JsZW0sCi0gICAgICogYXMgd2Ugd2lsbCBhY3R1YWxseSBhc3NpZ24g
dGhlIHZDUFUgdG8gdGhlIHBDUFUgd2UgcmV0dXJuIGZyb20gaGVyZSwKKyAgICAgKiBhcyB3ZSB3
aWxsIGFjdHVhbGx5IGFzc2lnbiB0aGUgdW5pdCB0byB0aGUgcENQVSB3ZSByZXR1cm4gZnJvbSBo
ZXJlLAogICAgICAqIG9ubHkgaWYgdGhlIHBDUFUgaXMgZnJlZS4KICAgICAgKi8KICAgICBjcHVt
YXNrX2FuZChjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksIGNwdXMsIHVuaXQtPmNwdV9oYXJkX2Fm
ZmluaXR5KTsKQEAgLTMyMSwxMSArMzIwLDExIEBAIHBpY2tfcmVzKHN0cnVjdCBudWxsX3ByaXZh
dGUgKnBydiwgY29uc3Qgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiAgICAgaWYgKCB1bmxpa2Vs
eSh0Yl9pbml0X2RvbmUpICkKICAgICB7CiAgICAgICAgIHN0cnVjdCB7Ci0gICAgICAgICAgICB1
aW50MTZfdCB2Y3B1LCBkb207CisgICAgICAgICAgICB1aW50MTZfdCB1bml0LCBkb207CiAgICAg
ICAgICAgICB1aW50MzJfdCBuZXdfY3B1OwogICAgICAgICB9IGQ7Ci0gICAgICAgIGQuZG9tID0g
di0+ZG9tYWluLT5kb21haW5faWQ7Ci0gICAgICAgIGQudmNwdSA9IHYtPnZjcHVfaWQ7CisgICAg
ICAgIGQuZG9tID0gdW5pdC0+ZG9tYWluLT5kb21haW5faWQ7CisgICAgICAgIGQudW5pdCA9IHVu
aXQtPnVuaXRfaWQ7CiAgICAgICAgIGQubmV3X2NwdSA9IG5ld19jcHU7CiAgICAgICAgIF9fdHJh
Y2VfdmFyKFRSQ19TTlVMTF9QSUNLRURfQ1BVLCAxLCBzaXplb2YoZCksICZkKTsKICAgICB9CkBA
IC0zMzMsNjQgKzMzMiw2NCBAQCBwaWNrX3JlcyhzdHJ1Y3QgbnVsbF9wcml2YXRlICpwcnYsIGNv
bnN0IHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogICAgIHJldHVybiBnZXRfc2NoZWRfcmVzKG5l
d19jcHUpOwogfQogCi1zdGF0aWMgdm9pZCB2Y3B1X2Fzc2lnbihzdHJ1Y3QgbnVsbF9wcml2YXRl
ICpwcnYsIHN0cnVjdCB2Y3B1ICp2LAorc3RhdGljIHZvaWQgdW5pdF9hc3NpZ24oc3RydWN0IG51
bGxfcHJpdmF0ZSAqcHJ2LCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCwKICAgICAgICAgICAgICAg
ICAgICAgICAgIHVuc2lnbmVkIGludCBjcHUpCiB7Ci0gICAgQVNTRVJUKGlzX3ZjcHVfb25saW5l
KHYpKTsKKyAgICBBU1NFUlQoaXNfdW5pdF9vbmxpbmUodW5pdCkpOwogCi0gICAgcGVyX2NwdShu
cGMsIGNwdSkudmNwdSA9IHY7Ci0gICAgdi0+cHJvY2Vzc29yID0gY3B1OwotICAgIHYtPnNjaGVk
X3VuaXQtPnJlcyA9IGdldF9zY2hlZF9yZXMoY3B1KTsKKyAgICBwZXJfY3B1KG5wYywgY3B1KS51
bml0ID0gdW5pdDsKKyAgICBzY2hlZF9zZXRfcmVzKHVuaXQsIGdldF9zY2hlZF9yZXMoY3B1KSk7
CiAgICAgY3B1bWFza19jbGVhcl9jcHUoY3B1LCAmcHJ2LT5jcHVzX2ZyZWUpOwogCi0gICAgZHBy
aW50ayhYRU5MT0dfR19JTkZPLCAiJWQgPC0tICVwdlxuIiwgY3B1LCB2KTsKKyAgICBkcHJpbnRr
KFhFTkxPR19HX0lORk8sICIlZCA8LS0gJXBkdiVkXG4iLCBjcHUsIHVuaXQtPmRvbWFpbiwgdW5p
dC0+dW5pdF9pZCk7CiAKICAgICBpZiAoIHVubGlrZWx5KHRiX2luaXRfZG9uZSkgKQogICAgIHsK
ICAgICAgICAgc3RydWN0IHsKLSAgICAgICAgICAgIHVpbnQxNl90IHZjcHUsIGRvbTsKKyAgICAg
ICAgICAgIHVpbnQxNl90IHVuaXQsIGRvbTsKICAgICAgICAgICAgIHVpbnQzMl90IGNwdTsKICAg
ICAgICAgfSBkOwotICAgICAgICBkLmRvbSA9IHYtPmRvbWFpbi0+ZG9tYWluX2lkOwotICAgICAg
ICBkLnZjcHUgPSB2LT52Y3B1X2lkOworICAgICAgICBkLmRvbSA9IHVuaXQtPmRvbWFpbi0+ZG9t
YWluX2lkOworICAgICAgICBkLnVuaXQgPSB1bml0LT51bml0X2lkOwogICAgICAgICBkLmNwdSA9
IGNwdTsKLSAgICAgICAgX190cmFjZV92YXIoVFJDX1NOVUxMX1ZDUFVfQVNTSUdOLCAxLCBzaXpl
b2YoZCksICZkKTsKKyAgICAgICAgX190cmFjZV92YXIoVFJDX1NOVUxMX1VOSVRfQVNTSUdOLCAx
LCBzaXplb2YoZCksICZkKTsKICAgICB9CiB9CiAKIC8qIFJldHVybnMgdHJ1ZSBpZiBhIGNwdSB3
YXMgdGlja2xlZCAqLwotc3RhdGljIGJvb2wgdmNwdV9kZWFzc2lnbihzdHJ1Y3QgbnVsbF9wcml2
YXRlICpwcnYsIHN0cnVjdCB2Y3B1ICp2KQorc3RhdGljIGJvb2wgdW5pdF9kZWFzc2lnbihzdHJ1
Y3QgbnVsbF9wcml2YXRlICpwcnYsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogewogICAgIHVu
c2lnbmVkIGludCBiczsKLSAgICB1bnNpZ25lZCBpbnQgY3B1ID0gdi0+cHJvY2Vzc29yOworICAg
IHVuc2lnbmVkIGludCBjcHUgPSBzY2hlZF91bml0X21hc3Rlcih1bml0KTsKICAgICBzdHJ1Y3Qg
bnVsbF91bml0ICp3dmM7CiAKLSAgICBBU1NFUlQobGlzdF9lbXB0eSgmbnVsbF91bml0KHYtPnNj
aGVkX3VuaXQpLT53YWl0cV9lbGVtKSk7Ci0gICAgQVNTRVJUKHBlcl9jcHUobnBjLCB2LT5wcm9j
ZXNzb3IpLnZjcHUgPT0gdik7Ci0gICAgQVNTRVJUKCFjcHVtYXNrX3Rlc3RfY3B1KHYtPnByb2Nl
c3NvciwgJnBydi0+Y3B1c19mcmVlKSk7CisgICAgQVNTRVJUKGxpc3RfZW1wdHkoJm51bGxfdW5p
dCh1bml0KS0+d2FpdHFfZWxlbSkpOworICAgIEFTU0VSVChwZXJfY3B1KG5wYywgY3B1KS51bml0
ID09IHVuaXQpOworICAgIEFTU0VSVCghY3B1bWFza190ZXN0X2NwdShjcHUsICZwcnYtPmNwdXNf
ZnJlZSkpOwogCi0gICAgcGVyX2NwdShucGMsIGNwdSkudmNwdSA9IE5VTEw7CisgICAgcGVyX2Nw
dShucGMsIGNwdSkudW5pdCA9IE5VTEw7CiAgICAgY3B1bWFza19zZXRfY3B1KGNwdSwgJnBydi0+
Y3B1c19mcmVlKTsKIAotICAgIGRwcmludGsoWEVOTE9HX0dfSU5GTywgIiVkIDwtLSBOVUxMICgl
cHYpXG4iLCBjcHUsIHYpOworICAgIGRwcmludGsoWEVOTE9HX0dfSU5GTywgIiVkIDwtLSBOVUxM
ICglcGR2JWQpXG4iLCBjcHUsIHVuaXQtPmRvbWFpbiwKKyAgICAgICAgICAgIHVuaXQtPnVuaXRf
aWQpOwogCiAgICAgaWYgKCB1bmxpa2VseSh0Yl9pbml0X2RvbmUpICkKICAgICB7CiAgICAgICAg
IHN0cnVjdCB7Ci0gICAgICAgICAgICB1aW50MTZfdCB2Y3B1LCBkb207CisgICAgICAgICAgICB1
aW50MTZfdCB1bml0LCBkb207CiAgICAgICAgICAgICB1aW50MzJfdCBjcHU7CiAgICAgICAgIH0g
ZDsKLSAgICAgICAgZC5kb20gPSB2LT5kb21haW4tPmRvbWFpbl9pZDsKLSAgICAgICAgZC52Y3B1
ID0gdi0+dmNwdV9pZDsKKyAgICAgICAgZC5kb20gPSB1bml0LT5kb21haW4tPmRvbWFpbl9pZDsK
KyAgICAgICAgZC51bml0ID0gdW5pdC0+dW5pdF9pZDsKICAgICAgICAgZC5jcHUgPSBjcHU7Ci0g
ICAgICAgIF9fdHJhY2VfdmFyKFRSQ19TTlVMTF9WQ1BVX0RFQVNTSUdOLCAxLCBzaXplb2YoZCks
ICZkKTsKKyAgICAgICAgX190cmFjZV92YXIoVFJDX1NOVUxMX1VOSVRfREVBU1NJR04sIDEsIHNp
emVvZihkKSwgJmQpOwogICAgIH0KIAogICAgIHNwaW5fbG9jaygmcHJ2LT53YWl0cV9sb2NrKTsK
IAogICAgIC8qCi0gICAgICogSWYgdiBpcyBhc3NpZ25lZCB0byBhIHBDUFUsIGxldCdzIHNlZSBp
ZiB0aGVyZSBpcyBzb21lb25lIHdhaXRpbmcsCi0gICAgICogc3VpdGFibGUgdG8gYmUgYXNzaWdu
ZWQgdG8gaXQgKHByaW9yaXRpemluZyB2Y3B1cyB0aGF0IGhhdmUKKyAgICAgKiBJZiB1bml0IGlz
IGFzc2lnbmVkIHRvIGEgcENQVSwgbGV0J3Mgc2VlIGlmIHRoZXJlIGlzIHNvbWVvbmUgd2FpdGlu
ZywKKyAgICAgKiBzdWl0YWJsZSB0byBiZSBhc3NpZ25lZCB0byBpdCAocHJpb3JpdGl6aW5nIHVu
aXRzIHRoYXQgaGF2ZQogICAgICAqIHNvZnQtYWZmaW5pdHkgd2l0aCBjcHUpLgogICAgICAqLwog
ICAgIGZvcl9lYWNoX2FmZmluaXR5X2JhbGFuY2Vfc3RlcCggYnMgKQpAQCAtMzk4LDEzICszOTcs
MTMgQEAgc3RhdGljIGJvb2wgdmNwdV9kZWFzc2lnbihzdHJ1Y3QgbnVsbF9wcml2YXRlICpwcnYs
IHN0cnVjdCB2Y3B1ICp2KQogICAgICAgICBsaXN0X2Zvcl9lYWNoX2VudHJ5KCB3dmMsICZwcnYt
PndhaXRxLCB3YWl0cV9lbGVtICkKICAgICAgICAgewogICAgICAgICAgICAgaWYgKCBicyA9PSBC
QUxBTkNFX1NPRlRfQUZGSU5JVFkgJiYKLSAgICAgICAgICAgICAgICAgIWhhc19zb2Z0X2FmZmlu
aXR5KHd2Yy0+dmNwdS0+c2NoZWRfdW5pdCkgKQorICAgICAgICAgICAgICAgICAhaGFzX3NvZnRf
YWZmaW5pdHkod3ZjLT51bml0KSApCiAgICAgICAgICAgICAgICAgY29udGludWU7CiAKLSAgICAg
ICAgICAgIGlmICggdmNwdV9jaGVja19hZmZpbml0eSh3dmMtPnZjcHUsIGNwdSwgYnMpICkKKyAg
ICAgICAgICAgIGlmICggdW5pdF9jaGVja19hZmZpbml0eSh3dmMtPnVuaXQsIGNwdSwgYnMpICkK
ICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICBsaXN0X2RlbF9pbml0KCZ3dmMtPndhaXRx
X2VsZW0pOwotICAgICAgICAgICAgICAgIHZjcHVfYXNzaWduKHBydiwgd3ZjLT52Y3B1LCBjcHUp
OworICAgICAgICAgICAgICAgIHVuaXRfYXNzaWduKHBydiwgd3ZjLT51bml0LCBjcHUpOwogICAg
ICAgICAgICAgICAgIGNwdV9yYWlzZV9zb2Z0aXJxKGNwdSwgU0NIRURVTEVfU09GVElSUSk7CiAg
ICAgICAgICAgICAgICAgc3Bpbl91bmxvY2soJnBydi0+d2FpdHFfbG9jayk7CiAgICAgICAgICAg
ICAgICAgcmV0dXJuIHRydWU7CkBAIC00MjUsOSArNDI0LDkgQEAgc3RhdGljIHNwaW5sb2NrX3Qg
Km51bGxfc3dpdGNoX3NjaGVkKHN0cnVjdCBzY2hlZHVsZXIgKm5ld19vcHMsCiAgICAgc3RydWN0
IG51bGxfcHJpdmF0ZSAqcHJ2ID0gbnVsbF9wcml2KG5ld19vcHMpOwogICAgIHN0cnVjdCBudWxs
X3VuaXQgKm52YyA9IHZkYXRhOwogCi0gICAgQVNTRVJUKG52YyAmJiBpc19pZGxlX3ZjcHUobnZj
LT52Y3B1KSk7CisgICAgQVNTRVJUKG52YyAmJiBpc19pZGxlX3VuaXQobnZjLT51bml0KSk7CiAK
LSAgICBpZGxlX3ZjcHVbY3B1XS0+c2NoZWRfdW5pdC0+cHJpdiA9IHZkYXRhOworICAgIHNjaGVk
X2lkbGVfdW5pdChjcHUpLT5wcml2ID0gdmRhdGE7CiAKICAgICAvKgogICAgICAqIFdlIGFyZSBo
b2xkaW5nIHRoZSBydW5xdWV1ZSBsb2NrIGFscmVhZHkgKGl0J3MgYmVlbiB0YWtlbiBpbgpAQCAt
NDQ0LDQxICs0NDMsNDAgQEAgc3RhdGljIHNwaW5sb2NrX3QgKm51bGxfc3dpdGNoX3NjaGVkKHN0
cnVjdCBzY2hlZHVsZXIgKm5ld19vcHMsCiBzdGF0aWMgdm9pZCBudWxsX3VuaXRfaW5zZXJ0KGNv
bnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
c3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiB7Ci0gICAgc3RydWN0IHZjcHUgKnYgPSB1bml0LT52
Y3B1X2xpc3Q7CiAgICAgc3RydWN0IG51bGxfcHJpdmF0ZSAqcHJ2ID0gbnVsbF9wcml2KG9wcyk7
CiAgICAgc3RydWN0IG51bGxfdW5pdCAqbnZjID0gbnVsbF91bml0KHVuaXQpOwogICAgIHVuc2ln
bmVkIGludCBjcHU7CiAgICAgc3BpbmxvY2tfdCAqbG9jazsKIAotICAgIEFTU0VSVCghaXNfaWRs
ZV92Y3B1KHYpKTsKKyAgICBBU1NFUlQoIWlzX2lkbGVfdW5pdCh1bml0KSk7CiAKICAgICBsb2Nr
ID0gdW5pdF9zY2hlZHVsZV9sb2NrX2lycSh1bml0KTsKIAotICAgIGlmICggdW5saWtlbHkoIWlz
X3ZjcHVfb25saW5lKHYpKSApCisgICAgaWYgKCB1bmxpa2VseSghaXNfdW5pdF9vbmxpbmUodW5p
dCkpICkKICAgICB7CiAgICAgICAgIHVuaXRfc2NoZWR1bGVfdW5sb2NrX2lycShsb2NrLCB1bml0
KTsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIAogIHJldHJ5OgotICAgIHVuaXQtPnJlcyA9IHBp
Y2tfcmVzKHBydiwgdW5pdCk7Ci0gICAgY3B1ID0gdi0+cHJvY2Vzc29yID0gdW5pdC0+cmVzLT5t
YXN0ZXJfY3B1OworICAgIHNjaGVkX3NldF9yZXModW5pdCwgcGlja19yZXMocHJ2LCB1bml0KSk7
CisgICAgY3B1ID0gc2NoZWRfdW5pdF9tYXN0ZXIodW5pdCk7CiAKICAgICBzcGluX3VubG9jayhs
b2NrKTsKIAogICAgIGxvY2sgPSB1bml0X3NjaGVkdWxlX2xvY2sodW5pdCk7CiAKICAgICBjcHVt
YXNrX2FuZChjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksIHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5
LAotICAgICAgICAgICAgICAgIGNwdXBvb2xfZG9tYWluX2NwdW1hc2sodi0+ZG9tYWluKSk7Cisg
ICAgICAgICAgICAgICAgY3B1cG9vbF9kb21haW5fY3B1bWFzayh1bml0LT5kb21haW4pKTsKIAot
ICAgIC8qIElmIHRoZSBwQ1BVIGlzIGZyZWUsIHdlIGFzc2lnbiB2IHRvIGl0ICovCi0gICAgaWYg
KCBsaWtlbHkocGVyX2NwdShucGMsIGNwdSkudmNwdSA9PSBOVUxMKSApCisgICAgLyogSWYgdGhl
IHBDUFUgaXMgZnJlZSwgd2UgYXNzaWduIHVuaXQgdG8gaXQgKi8KKyAgICBpZiAoIGxpa2VseShw
ZXJfY3B1KG5wYywgY3B1KS51bml0ID09IE5VTEwpICkKICAgICB7CiAgICAgICAgIC8qCiAgICAg
ICAgICAqIEluc2VydCBpcyBmb2xsb3dlZCBieSB2Y3B1X3dha2UoKSwgc28gdGhlcmUncyBubyBu
ZWVkIHRvIHBva2UKICAgICAgICAgICogdGhlIHBjcHUgd2l0aCB0aGUgU0NIRURVTEVfU09GVElS
USwgYXMgd2FrZSB3aWxsIGRvIHRoYXQuCiAgICAgICAgICAqLwotICAgICAgICB2Y3B1X2Fzc2ln
bihwcnYsIHYsIGNwdSk7CisgICAgICAgIHVuaXRfYXNzaWduKHBydiwgdW5pdCwgY3B1KTsKICAg
ICB9CiAgICAgZWxzZSBpZiAoIGNwdW1hc2tfaW50ZXJzZWN0cygmcHJ2LT5jcHVzX2ZyZWUsIGNw
dW1hc2tfc2NyYXRjaF9jcHUoY3B1KSkgKQogICAgIHsKQEAgLTQ5Nyw3ICs0OTUsOCBAQCBzdGF0
aWMgdm9pZCBudWxsX3VuaXRfaW5zZXJ0KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKICAg
ICAgICAgICovCiAgICAgICAgIHNwaW5fbG9jaygmcHJ2LT53YWl0cV9sb2NrKTsKICAgICAgICAg
bGlzdF9hZGRfdGFpbCgmbnZjLT53YWl0cV9lbGVtLCAmcHJ2LT53YWl0cSk7Ci0gICAgICAgIGRw
cmludGsoWEVOTE9HX0dfV0FSTklORywgIldBUk5JTkc6ICVwdiBub3QgYXNzaWduZWQgdG8gYW55
IENQVSFcbiIsIHYpOworICAgICAgICBkcHJpbnRrKFhFTkxPR19HX1dBUk5JTkcsICJXQVJOSU5H
OiAlcGR2JWQgbm90IGFzc2lnbmVkIHRvIGFueSBDUFUhXG4iLAorICAgICAgICAgICAgICAgIHVu
aXQtPmRvbWFpbiwgdW5pdC0+dW5pdF9pZCk7CiAgICAgICAgIHNwaW5fdW5sb2NrKCZwcnYtPndh
aXRxX2xvY2spOwogICAgIH0KICAgICBzcGluX3VubG9ja19pcnEobG9jayk7CkBAIC01MDgsMjQg
KzUwNywyMyBAQCBzdGF0aWMgdm9pZCBudWxsX3VuaXRfaW5zZXJ0KGNvbnN0IHN0cnVjdCBzY2hl
ZHVsZXIgKm9wcywKIHN0YXRpYyB2b2lkIG51bGxfdW5pdF9yZW1vdmUoY29uc3Qgc3RydWN0IHNj
aGVkdWxlciAqb3BzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3Qgc2NoZWRf
dW5pdCAqdW5pdCkKIHsKLSAgICBzdHJ1Y3QgdmNwdSAqdiA9IHVuaXQtPnZjcHVfbGlzdDsKICAg
ICBzdHJ1Y3QgbnVsbF9wcml2YXRlICpwcnYgPSBudWxsX3ByaXYob3BzKTsKICAgICBzdHJ1Y3Qg
bnVsbF91bml0ICpudmMgPSBudWxsX3VuaXQodW5pdCk7CiAgICAgc3BpbmxvY2tfdCAqbG9jazsK
IAotICAgIEFTU0VSVCghaXNfaWRsZV92Y3B1KHYpKTsKKyAgICBBU1NFUlQoIWlzX2lkbGVfdW5p
dCh1bml0KSk7CiAKICAgICBsb2NrID0gdW5pdF9zY2hlZHVsZV9sb2NrX2lycSh1bml0KTsKIAot
ICAgIC8qIElmIG9mZmxpbmUsIHRoZSB2Y3B1IHNob3VsZG4ndCBiZSBhc3NpZ25lZCwgbm9yIGlu
IHRoZSB3YWl0cXVldWUgKi8KLSAgICBpZiAoIHVubGlrZWx5KCFpc192Y3B1X29ubGluZSh2KSkg
KQorICAgIC8qIElmIG9mZmxpbmUsIHRoZSB1bml0IHNob3VsZG4ndCBiZSBhc3NpZ25lZCwgbm9y
IGluIHRoZSB3YWl0cXVldWUgKi8KKyAgICBpZiAoIHVubGlrZWx5KCFpc191bml0X29ubGluZSh1
bml0KSkgKQogICAgIHsKLSAgICAgICAgQVNTRVJUKHBlcl9jcHUobnBjLCB2LT5wcm9jZXNzb3Ip
LnZjcHUgIT0gdik7CisgICAgICAgIEFTU0VSVChwZXJfY3B1KG5wYywgc2NoZWRfdW5pdF9tYXN0
ZXIodW5pdCkpLnVuaXQgIT0gdW5pdCk7CiAgICAgICAgIEFTU0VSVChsaXN0X2VtcHR5KCZudmMt
PndhaXRxX2VsZW0pKTsKICAgICAgICAgZ290byBvdXQ7CiAgICAgfQogCi0gICAgLyogSWYgdiBp
cyBpbiB3YWl0cXVldWUsIGp1c3QgZ2V0IGl0IG91dCBvZiB0aGVyZSBhbmQgYmFpbCAqLworICAg
IC8qIElmIHVuaXQgaXMgaW4gd2FpdHF1ZXVlLCBqdXN0IGdldCBpdCBvdXQgb2YgdGhlcmUgYW5k
IGJhaWwgKi8KICAgICBpZiAoIHVubGlrZWx5KCFsaXN0X2VtcHR5KCZudmMtPndhaXRxX2VsZW0p
KSApCiAgICAgewogICAgICAgICBzcGluX2xvY2soJnBydi0+d2FpdHFfbG9jayk7CkBAIC01MzUs
NyArNTMzLDcgQEAgc3RhdGljIHZvaWQgbnVsbF91bml0X3JlbW92ZShjb25zdCBzdHJ1Y3Qgc2No
ZWR1bGVyICpvcHMsCiAgICAgICAgIGdvdG8gb3V0OwogICAgIH0KIAotICAgIHZjcHVfZGVhc3Np
Z24ocHJ2LCB2KTsKKyAgICB1bml0X2RlYXNzaWduKHBydiwgdW5pdCk7CiAKICBvdXQ6CiAgICAg
dW5pdF9zY2hlZHVsZV91bmxvY2tfaXJxKGxvY2ssIHVuaXQpOwpAQCAtNTQ2LDE0ICs1NDQsMTMg
QEAgc3RhdGljIHZvaWQgbnVsbF91bml0X3JlbW92ZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpv
cHMsCiBzdGF0aWMgdm9pZCBudWxsX3VuaXRfd2FrZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpv
cHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkK
IHsKLSAgICBzdHJ1Y3QgdmNwdSAqdiA9IHVuaXQtPnZjcHVfbGlzdDsKICAgICBzdHJ1Y3QgbnVs
bF9wcml2YXRlICpwcnYgPSBudWxsX3ByaXYob3BzKTsKICAgICBzdHJ1Y3QgbnVsbF91bml0ICpu
dmMgPSBudWxsX3VuaXQodW5pdCk7Ci0gICAgdW5zaWduZWQgaW50IGNwdSA9IHYtPnByb2Nlc3Nv
cjsKKyAgICB1bnNpZ25lZCBpbnQgY3B1ID0gc2NoZWRfdW5pdF9tYXN0ZXIodW5pdCk7CiAKLSAg
ICBBU1NFUlQoIWlzX2lkbGVfdmNwdSh2KSk7CisgICAgQVNTRVJUKCFpc19pZGxlX3VuaXQodW5p
dCkpOwogCi0gICAgaWYgKCB1bmxpa2VseShjdXJyX29uX2NwdShjcHUpID09IHVuaXQpICkKKyAg
ICBpZiAoIHVubGlrZWx5KGN1cnJfb25fY3B1KHNjaGVkX3VuaXRfbWFzdGVyKHVuaXQpKSA9PSB1
bml0KSApCiAgICAgewogICAgICAgICBTQ0hFRF9TVEFUX0NSQU5LKHVuaXRfd2FrZV9ydW5uaW5n
KTsKICAgICAgICAgcmV0dXJuOwpAQCAtNTY2LDMzICs1NjMsMzMgQEAgc3RhdGljIHZvaWQgbnVs
bF91bml0X3dha2UoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAgICAgICByZXR1cm47
CiAgICAgfQogCi0gICAgaWYgKCBsaWtlbHkodmNwdV9ydW5uYWJsZSh2KSkgKQorICAgIGlmICgg
bGlrZWx5KHVuaXRfcnVubmFibGUodW5pdCkpICkKICAgICAgICAgU0NIRURfU1RBVF9DUkFOSyh1
bml0X3dha2VfcnVubmFibGUpOwogICAgIGVsc2UKICAgICAgICAgU0NIRURfU1RBVF9DUkFOSyh1
bml0X3dha2Vfbm90X3J1bm5hYmxlKTsKIAogICAgIC8qCi0gICAgICogSWYgYSB2Y3B1IGlzIG5l
aXRoZXIgb24gYSBwQ1BVIG5vciBpbiB0aGUgd2FpdHF1ZXVlLCBpdCBtZWFucyBpdCB3YXMKKyAg
ICAgKiBJZiBhIHVuaXQgaXMgbmVpdGhlciBvbiBhIHBDUFUgbm9yIGluIHRoZSB3YWl0cXVldWUs
IGl0IG1lYW5zIGl0IHdhcwogICAgICAqIG9mZmxpbmUsIGFuZCB0aGF0IGl0IGlzIG5vdyBjb21p
bmcgYmFjayBiZWluZyBvbmxpbmUuCiAgICAgICovCi0gICAgaWYgKCB1bmxpa2VseShwZXJfY3B1
KG5wYywgY3B1KS52Y3B1ICE9IHYgJiYgbGlzdF9lbXB0eSgmbnZjLT53YWl0cV9lbGVtKSkgKQor
ICAgIGlmICggdW5saWtlbHkocGVyX2NwdShucGMsIGNwdSkudW5pdCAhPSB1bml0ICYmIGxpc3Rf
ZW1wdHkoJm52Yy0+d2FpdHFfZWxlbSkpICkKICAgICB7CiAgICAgICAgIHNwaW5fbG9jaygmcHJ2
LT53YWl0cV9sb2NrKTsKICAgICAgICAgbGlzdF9hZGRfdGFpbCgmbnZjLT53YWl0cV9lbGVtLCAm
cHJ2LT53YWl0cSk7CiAgICAgICAgIHNwaW5fdW5sb2NrKCZwcnYtPndhaXRxX2xvY2spOwogCiAg
ICAgICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwgdW5pdC0+Y3B1X2hh
cmRfYWZmaW5pdHksCi0gICAgICAgICAgICAgICAgICAgIGNwdXBvb2xfZG9tYWluX2NwdW1hc2so
di0+ZG9tYWluKSk7CisgICAgICAgICAgICAgICAgICAgIGNwdXBvb2xfZG9tYWluX2NwdW1hc2so
dW5pdC0+ZG9tYWluKSk7CiAKICAgICAgICAgaWYgKCAhY3B1bWFza19pbnRlcnNlY3RzKCZwcnYt
PmNwdXNfZnJlZSwgY3B1bWFza19zY3JhdGNoX2NwdShjcHUpKSApCiAgICAgICAgIHsKICAgICAg
ICAgICAgIGRwcmludGsoWEVOTE9HX0dfV0FSTklORywgIldBUk5JTkc6IGQlZHYlZCBub3QgYXNz
aWduZWQgdG8gYW55IENQVSFcbiIsCi0gICAgICAgICAgICAgICAgICAgIHYtPmRvbWFpbi0+ZG9t
YWluX2lkLCB2LT52Y3B1X2lkKTsKKyAgICAgICAgICAgICAgICAgICAgdW5pdC0+ZG9tYWluLT5k
b21haW5faWQsIHVuaXQtPnVuaXRfaWQpOwogICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9
CiAKICAgICAgICAgLyoKLSAgICAgICAgICogTm93IHdlIHdvdWxkIHdhbnQgdG8gYXNzaWduIHRo
ZSB2Y3B1IHRvIGNwdSwgYnV0IHdlIGNhbid0LCBiZWNhdXNlCisgICAgICAgICAqIE5vdyB3ZSB3
b3VsZCB3YW50IHRvIGFzc2lnbiB0aGUgdW5pdCB0byBjcHUsIGJ1dCB3ZSBjYW4ndCwgYmVjYXVz
ZQogICAgICAgICAgKiB3ZSBkb24ndCBoYXZlIHRoZSBsb2NrLiBTbywgbGV0J3MgZG8gdGhlIGZv
bGxvd2luZzoKICAgICAgICAgICogLSB0cnkgdG8gcmVtb3ZlIGNwdSBmcm9tIHRoZSBsaXN0IG9m
IGZyZWUgY3B1cywgdG8gYXZvaWQgcmFjZXMgd2l0aAogICAgICAgICAgKiAgIG90aGVyIG9ubGlu
aW5nLCBpbnNlcnRpbmcgb3IgbWlncmF0aW5nIG9wZXJhdGlvbnM7CkBAIC02MTMsMjUgKzYxMCwy
NCBAQCBzdGF0aWMgdm9pZCBudWxsX3VuaXRfd2FrZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpv
cHMsCiAgICAgICAgIH0KICAgICB9CiAKLSAgICAvKiBOb3RlIHRoYXQgd2UgZ2V0IGhlcmUgb25s
eSBmb3IgdkNQVXMgYXNzaWduZWQgdG8gYSBwQ1BVICovCi0gICAgY3B1X3JhaXNlX3NvZnRpcnEo
di0+cHJvY2Vzc29yLCBTQ0hFRFVMRV9TT0ZUSVJRKTsKKyAgICAvKiBOb3RlIHRoYXQgd2UgZ2V0
IGhlcmUgb25seSBmb3IgdW5pdHMgYXNzaWduZWQgdG8gYSBwQ1BVICovCisgICAgY3B1X3JhaXNl
X3NvZnRpcnEoc2NoZWRfdW5pdF9tYXN0ZXIodW5pdCksIFNDSEVEVUxFX1NPRlRJUlEpOwogfQog
CiBzdGF0aWMgdm9pZCBudWxsX3VuaXRfc2xlZXAoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3Bz
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQog
ewotICAgIHN0cnVjdCB2Y3B1ICp2ID0gdW5pdC0+dmNwdV9saXN0OwogICAgIHN0cnVjdCBudWxs
X3ByaXZhdGUgKnBydiA9IG51bGxfcHJpdihvcHMpOwotICAgIHVuc2lnbmVkIGludCBjcHUgPSB2
LT5wcm9jZXNzb3I7CisgICAgdW5zaWduZWQgaW50IGNwdSA9IHNjaGVkX3VuaXRfbWFzdGVyKHVu
aXQpOwogICAgIGJvb2wgdGlja2xlZCA9IGZhbHNlOwogCi0gICAgQVNTRVJUKCFpc19pZGxlX3Zj
cHUodikpOworICAgIEFTU0VSVCghaXNfaWRsZV91bml0KHVuaXQpKTsKIAotICAgIC8qIAotICAg
ICAqIENoZWNrIGlmIHRoZSB2Y3B1IGlzIGluIHRoZSBwcm9jZXNzIG9mIGJlaW5nIG9mZmxpbmVk
LiBpZiB5ZXMsCisgICAgLyoKKyAgICAgKiBDaGVjayBpZiB0aGUgdW5pdCBpcyBpbiB0aGUgcHJv
Y2VzcyBvZiBiZWluZyBvZmZsaW5lZC4gSWYgeWVzLAogICAgICAqIHdlIG5lZWQgdG8gcmVtb3Zl
IGl0IGZyb20gZWl0aGVyIGl0cyBwQ1BVIG9yIHRoZSB3YWl0cXVldWUuCiAgICAgICovCi0gICAg
aWYgKCB1bmxpa2VseSghaXNfdmNwdV9vbmxpbmUodikpICkKKyAgICBpZiAoIHVubGlrZWx5KCFp
c191bml0X29ubGluZSh1bml0KSkgKQogICAgIHsKICAgICAgICAgc3RydWN0IG51bGxfdW5pdCAq
bnZjID0gbnVsbF91bml0KHVuaXQpOwogCkBAIC02NDEsMTEgKzYzNywxMSBAQCBzdGF0aWMgdm9p
ZCBudWxsX3VuaXRfc2xlZXAoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAgICAgICAg
ICAgbGlzdF9kZWxfaW5pdCgmbnZjLT53YWl0cV9lbGVtKTsKICAgICAgICAgICAgIHNwaW5fdW5s
b2NrKCZwcnYtPndhaXRxX2xvY2spOwogICAgICAgICB9Ci0gICAgICAgIGVsc2UgaWYgKCBwZXJf
Y3B1KG5wYywgY3B1KS52Y3B1ID09IHYgKQotICAgICAgICAgICAgdGlja2xlZCA9IHZjcHVfZGVh
c3NpZ24ocHJ2LCB2KTsKKyAgICAgICAgZWxzZSBpZiAoIHBlcl9jcHUobnBjLCBjcHUpLnVuaXQg
PT0gdW5pdCApCisgICAgICAgICAgICB0aWNrbGVkID0gdW5pdF9kZWFzc2lnbihwcnYsIHVuaXQp
OwogICAgIH0KIAotICAgIC8qIElmIHYgaXMgbm90IGFzc2lnbmVkIHRvIGEgcENQVSwgb3IgaXMg
bm90IHJ1bm5pbmcsIG5vIG5lZWQgdG8gYm90aGVyICovCisgICAgLyogSWYgdW5pdCBpcyBub3Qg
YXNzaWduZWQgdG8gYSBwQ1BVLCBvciBpcyBub3QgcnVubmluZywgbm8gbmVlZCB0byBib3RoZXIg
Ki8KICAgICBpZiAoIGxpa2VseSghdGlja2xlZCAmJiBjdXJyX29uX2NwdShjcHUpID09IHVuaXQp
ICkKICAgICAgICAgY3B1X3JhaXNlX3NvZnRpcnEoY3B1LCBTQ0hFRFVMRV9TT0ZUSVJRKTsKIApA
QCAtNjU1LDQyICs2NTEsNDEgQEAgc3RhdGljIHZvaWQgbnVsbF91bml0X3NsZWVwKGNvbnN0IHN0
cnVjdCBzY2hlZHVsZXIgKm9wcywKIHN0YXRpYyBzdHJ1Y3Qgc2NoZWRfcmVzb3VyY2UgKgogbnVs
bF9yZXNfcGljayhjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGNvbnN0IHN0cnVjdCBzY2hl
ZF91bml0ICp1bml0KQogewotICAgIEFTU0VSVCghaXNfaWRsZV92Y3B1KHVuaXQtPnZjcHVfbGlz
dCkpOworICAgIEFTU0VSVCghaXNfaWRsZV91bml0KHVuaXQpKTsKICAgICByZXR1cm4gcGlja19y
ZXMobnVsbF9wcml2KG9wcyksIHVuaXQpOwogfQogCiBzdGF0aWMgdm9pZCBudWxsX3VuaXRfbWln
cmF0ZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCwgdW5zaWduZWQgaW50IG5ld19jcHUpCiB7
Ci0gICAgc3RydWN0IHZjcHUgKnYgPSB1bml0LT52Y3B1X2xpc3Q7CiAgICAgc3RydWN0IG51bGxf
cHJpdmF0ZSAqcHJ2ID0gbnVsbF9wcml2KG9wcyk7CiAgICAgc3RydWN0IG51bGxfdW5pdCAqbnZj
ID0gbnVsbF91bml0KHVuaXQpOwogCi0gICAgQVNTRVJUKCFpc19pZGxlX3ZjcHUodikpOworICAg
IEFTU0VSVCghaXNfaWRsZV91bml0KHVuaXQpKTsKIAotICAgIGlmICggdi0+cHJvY2Vzc29yID09
IG5ld19jcHUgKQorICAgIGlmICggc2NoZWRfdW5pdF9tYXN0ZXIodW5pdCkgPT0gbmV3X2NwdSAp
CiAgICAgICAgIHJldHVybjsKIAogICAgIGlmICggdW5saWtlbHkodGJfaW5pdF9kb25lKSApCiAg
ICAgewogICAgICAgICBzdHJ1Y3QgewotICAgICAgICAgICAgdWludDE2X3QgdmNwdSwgZG9tOwor
ICAgICAgICAgICAgdWludDE2X3QgdW5pdCwgZG9tOwogICAgICAgICAgICAgdWludDE2X3QgY3B1
LCBuZXdfY3B1OwogICAgICAgICB9IGQ7Ci0gICAgICAgIGQuZG9tID0gdi0+ZG9tYWluLT5kb21h
aW5faWQ7Ci0gICAgICAgIGQudmNwdSA9IHYtPnZjcHVfaWQ7Ci0gICAgICAgIGQuY3B1ID0gdi0+
cHJvY2Vzc29yOworICAgICAgICBkLmRvbSA9IHVuaXQtPmRvbWFpbi0+ZG9tYWluX2lkOworICAg
ICAgICBkLnVuaXQgPSB1bml0LT51bml0X2lkOworICAgICAgICBkLmNwdSA9IHNjaGVkX3VuaXRf
bWFzdGVyKHVuaXQpOwogICAgICAgICBkLm5ld19jcHUgPSBuZXdfY3B1OwogICAgICAgICBfX3Ry
YWNlX3ZhcihUUkNfU05VTExfTUlHUkFURSwgMSwgc2l6ZW9mKGQpLCAmZCk7CiAgICAgfQogCiAg
ICAgLyoKLSAgICAgKiBJZiB2IGlzIGFzc2lnbmVkIHRvIGEgcENQVSwgdGhlbiBzdWNoIHBDUFUg
YmVjb21lcyBmcmVlLCBhbmQgd2UKKyAgICAgKiBJZiB1bml0IGlzIGFzc2lnbmVkIHRvIGEgcENQ
VSwgdGhlbiBzdWNoIHBDUFUgYmVjb21lcyBmcmVlLCBhbmQgd2UKICAgICAgKiBzaG91bGQgbG9v
ayBpbiB0aGUgd2FpdHF1ZXVlIGlmIGFueW9uZSBlbHNlIGNhbiBiZSBhc3NpZ25lZCB0byBpdC4K
ICAgICAgKi8KLSAgICBpZiAoIGxpa2VseShwZXJfY3B1KG5wYywgdi0+cHJvY2Vzc29yKS52Y3B1
ID09IHYpICkKKyAgICBpZiAoIGxpa2VseShwZXJfY3B1KG5wYywgc2NoZWRfdW5pdF9tYXN0ZXIo
dW5pdCkpLnVuaXQgPT0gdW5pdCkgKQogICAgIHsKLSAgICAgICAgdmNwdV9kZWFzc2lnbihwcnYs
IHYpOworICAgICAgICB1bml0X2RlYXNzaWduKHBydiwgdW5pdCk7CiAgICAgICAgIFNDSEVEX1NU
QVRfQ1JBTksobWlncmF0ZV9ydW5uaW5nKTsKICAgICB9CiAgICAgZWxzZSBpZiAoICFsaXN0X2Vt
cHR5KCZudmMtPndhaXRxX2VsZW0pICkKQEAgLTY5OSwxMyArNjk0LDEzIEBAIHN0YXRpYyB2b2lk
IG51bGxfdW5pdF9taWdyYXRlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKICAgICBTQ0hF
RF9TVEFUX0NSQU5LKG1pZ3JhdGVkKTsKIAogICAgIC8qCi0gICAgICogSWYgYSB2Y3B1IGlzIChn
b2luZykgb2ZmbGluZSwgd2Ugd2FudCBpdCB0byBiZSBuZWl0aGVyIGFzc2lnbmVkCisgICAgICog
SWYgYSB1bml0IGlzIChnb2luZykgb2ZmbGluZSwgd2Ugd2FudCBpdCB0byBiZSBuZWl0aGVyIGFz
c2lnbmVkCiAgICAgICogdG8gYSBwQ1BVLCBub3IgaW4gdGhlIHdhaXRxdWV1ZS4KICAgICAgKgog
ICAgICAqIElmIGl0IHdhcyBvbiBhIGNwdSwgd2UndmUgcmVtb3ZlZCBpdCBmcm9tIHRoZXJlIGFi
b3ZlLiBJZiBpdCBpcwogICAgICAqIGluIHRoZSB3YWl0cXVldWUsIHdlIHJlbW92ZSBpdCBmcm9t
IHRoZXJlIG5vdy4gQW5kIHRoZW4gd2UgYmFpbC4KICAgICAgKi8KLSAgICBpZiAoIHVubGlrZWx5
KCFpc192Y3B1X29ubGluZSh2KSkgKQorICAgIGlmICggdW5saWtlbHkoIWlzX3VuaXRfb25saW5l
KHVuaXQpKSApCiAgICAgewogICAgICAgICBzcGluX2xvY2soJnBydi0+d2FpdHFfbG9jayk7CiAg
ICAgICAgIGxpc3RfZGVsX2luaXQoJm52Yy0+d2FpdHFfZWxlbSk7CkBAIC03MTQsMzIgKzcwOSwz
NCBAQCBzdGF0aWMgdm9pZCBudWxsX3VuaXRfbWlncmF0ZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVy
ICpvcHMsCiAgICAgfQogCiAgICAgLyoKLSAgICAgKiBMZXQncyBub3cgY29uc2lkZXIgbmV3X2Nw
dSwgd2hpY2ggaXMgd2hlcmUgdiBpcyBiZWluZyBzZW50LiBJdCBjYW4gYmUKLSAgICAgKiBlaXRo
ZXIgZnJlZSwgb3IgaGF2ZSBhIHZDUFUgYWxyZWFkeSBhc3NpZ25lZCB0byBpdC4KKyAgICAgKiBM
ZXQncyBub3cgY29uc2lkZXIgbmV3X2NwdSwgd2hpY2ggaXMgd2hlcmUgdW5pdCBpcyBiZWluZyBz
ZW50LiBJdCBjYW4gYmUKKyAgICAgKiBlaXRoZXIgZnJlZSwgb3IgaGF2ZSBhIHVuaXQgYWxyZWFk
eSBhc3NpZ25lZCB0byBpdC4KICAgICAgKgotICAgICAqIEluIHRoZSBmb3JtZXIgY2FzZSwgd2Ug
c2hvdWxkIGFzc2lnbiB2IHRvIGl0LCBhbmQgdHJ5IHRvIGdldCBpdCB0byBydW4sCisgICAgICog
SW4gdGhlIGZvcm1lciBjYXNlIHdlIHNob3VsZCBhc3NpZ24gdW5pdCB0byBpdCwgYW5kIHRyeSB0
byBnZXQgaXQgdG8gcnVuLAogICAgICAqIGlmIHBvc3NpYmxlLCBhY2NvcmRpbmcgdG8gYWZmaW5p
dHkuCiAgICAgICoKLSAgICAgKiBJbiBsYXR0ZXIsIGFsbCB3ZSBjYW4gZG8gaXMgdG8gcGFyayB2
IGluIHRoZSB3YWl0cXVldWUuCisgICAgICogSW4gbGF0dGVyLCBhbGwgd2UgY2FuIGRvIGlzIHRv
IHBhcmsgdW5pdCBpbiB0aGUgd2FpdHF1ZXVlLgogICAgICAqLwotICAgIGlmICggcGVyX2NwdShu
cGMsIG5ld19jcHUpLnZjcHUgPT0gTlVMTCAmJgotICAgICAgICAgdmNwdV9jaGVja19hZmZpbml0
eSh2LCBuZXdfY3B1LCBCQUxBTkNFX0hBUkRfQUZGSU5JVFkpICkKKyAgICBpZiAoIHBlcl9jcHUo
bnBjLCBuZXdfY3B1KS51bml0ID09IE5VTEwgJiYKKyAgICAgICAgIHVuaXRfY2hlY2tfYWZmaW5p
dHkodW5pdCwgbmV3X2NwdSwgQkFMQU5DRV9IQVJEX0FGRklOSVRZKSApCiAgICAgewotICAgICAg
ICAvKiB2IG1pZ2h0IGhhdmUgYmVlbiBpbiB0aGUgd2FpdHF1ZXVlLCBzbyByZW1vdmUgaXQgKi8K
KyAgICAgICAgLyogdW5pdCBtaWdodCBoYXZlIGJlZW4gaW4gdGhlIHdhaXRxdWV1ZSwgc28gcmVt
b3ZlIGl0ICovCiAgICAgICAgIHNwaW5fbG9jaygmcHJ2LT53YWl0cV9sb2NrKTsKICAgICAgICAg
bGlzdF9kZWxfaW5pdCgmbnZjLT53YWl0cV9lbGVtKTsKICAgICAgICAgc3Bpbl91bmxvY2soJnBy
di0+d2FpdHFfbG9jayk7CiAKLSAgICAgICAgdmNwdV9hc3NpZ24ocHJ2LCB2LCBuZXdfY3B1KTsK
KyAgICAgICAgdW5pdF9hc3NpZ24ocHJ2LCB1bml0LCBuZXdfY3B1KTsKICAgICB9CiAgICAgZWxz
ZQogICAgIHsKLSAgICAgICAgLyogUHV0IHYgaW4gdGhlIHdhaXRxdWV1ZSwgaWYgaXQgd2Fzbid0
IHRoZXJlIGFscmVhZHkgKi8KKyAgICAgICAgLyogUHV0IHVuaXQgaW4gdGhlIHdhaXRxdWV1ZSwg
aWYgaXQgd2Fzbid0IHRoZXJlIGFscmVhZHkgKi8KICAgICAgICAgc3Bpbl9sb2NrKCZwcnYtPndh
aXRxX2xvY2spOwogICAgICAgICBpZiAoIGxpc3RfZW1wdHkoJm52Yy0+d2FpdHFfZWxlbSkgKQog
ICAgICAgICB7CiAgICAgICAgICAgICBsaXN0X2FkZF90YWlsKCZudmMtPndhaXRxX2VsZW0sICZw
cnYtPndhaXRxKTsKLSAgICAgICAgICAgIGRwcmludGsoWEVOTE9HX0dfV0FSTklORywgIldBUk5J
Tkc6ICVwdiBub3QgYXNzaWduZWQgdG8gYW55IENQVSFcbiIsIHYpOworICAgICAgICAgICAgZHBy
aW50ayhYRU5MT0dfR19XQVJOSU5HLAorICAgICAgICAgICAgICAgICAgICAiV0FSTklORzogJXBk
diVkIG5vdCBhc3NpZ25lZCB0byBhbnkgQ1BVIVxuIiwgdW5pdC0+ZG9tYWluLAorICAgICAgICAg
ICAgICAgICAgICB1bml0LT51bml0X2lkKTsKICAgICAgICAgfQogICAgICAgICBzcGluX3VubG9j
aygmcHJ2LT53YWl0cV9sb2NrKTsKICAgICB9CkBAIC03NTMsMzUgKzc1MCwzNCBAQCBzdGF0aWMg
dm9pZCBudWxsX3VuaXRfbWlncmF0ZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAgICAg
ICogYnkgdGhpcywgd2lsbCBiZSBmaXhlZC11cCBkdXJpbmcgcmVzdW1lLgogICAgICAqLwogIG91
dDoKLSAgICB2LT5wcm9jZXNzb3IgPSBuZXdfY3B1OwotICAgIHVuaXQtPnJlcyA9IGdldF9zY2hl
ZF9yZXMobmV3X2NwdSk7CisgICAgc2NoZWRfc2V0X3Jlcyh1bml0LCBnZXRfc2NoZWRfcmVzKG5l
d19jcHUpKTsKIH0KIAogI2lmbmRlZiBOREVCVUcKLXN0YXRpYyBpbmxpbmUgdm9pZCBudWxsX3Zj
cHVfY2hlY2soc3RydWN0IHZjcHUgKnYpCitzdGF0aWMgaW5saW5lIHZvaWQgbnVsbF91bml0X2No
ZWNrKHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogewotICAgIHN0cnVjdCBudWxsX3VuaXQgKiBj
b25zdCBudmMgPSBudWxsX3VuaXQodi0+c2NoZWRfdW5pdCk7Ci0gICAgc3RydWN0IG51bGxfZG9t
ICogY29uc3QgbmRvbSA9IHYtPmRvbWFpbi0+c2NoZWRfcHJpdjsKKyAgICBzdHJ1Y3QgbnVsbF91
bml0ICogY29uc3QgbnZjID0gbnVsbF91bml0KHVuaXQpOworICAgIHN0cnVjdCBudWxsX2RvbSAq
IGNvbnN0IG5kb20gPSB1bml0LT5kb21haW4tPnNjaGVkX3ByaXY7CiAKLSAgICBCVUdfT04obnZj
LT52Y3B1ICE9IHYpOworICAgIEJVR19PTihudmMtPnVuaXQgIT0gdW5pdCk7CiAKICAgICBpZiAo
IG5kb20gKQotICAgICAgICBCVUdfT04oaXNfaWRsZV92Y3B1KHYpKTsKKyAgICAgICAgQlVHX09O
KGlzX2lkbGVfdW5pdCh1bml0KSk7CiAgICAgZWxzZQotICAgICAgICBCVUdfT04oIWlzX2lkbGVf
dmNwdSh2KSk7CisgICAgICAgIEJVR19PTighaXNfaWRsZV91bml0KHVuaXQpKTsKIAogICAgIFND
SEVEX1NUQVRfQ1JBTksodW5pdF9jaGVjayk7CiB9Ci0jZGVmaW5lIE5VTExfVkNQVV9DSEVDSyh2
KSAgKG51bGxfdmNwdV9jaGVjayh2KSkKKyNkZWZpbmUgTlVMTF9VTklUX0NIRUNLKHVuaXQpICAo
bnVsbF91bml0X2NoZWNrKHVuaXQpKQogI2Vsc2UKLSNkZWZpbmUgTlVMTF9WQ1BVX0NIRUNLKHYp
CisjZGVmaW5lIE5VTExfVU5JVF9DSEVDSyh1bml0KQogI2VuZGlmCiAKIAogLyoKICAqIFRoZSBt
b3N0IHNpbXBsZSBzY2hlZHVsaW5nIGZ1bmN0aW9uIG9mIGFsbCB0aW1lcyEgV2UgZWl0aGVyIHJl
dHVybjoKLSAqICAtIHRoZSB2Q1BVIGFzc2lnbmVkIHRvIHRoZSBwQ1BVLCBpZiB0aGVyZSdzIG9u
ZSBhbmQgaXQgY2FuIHJ1bjsKLSAqICAtIHRoZSBpZGxlIHZDUFUsIG90aGVyd2lzZS4KKyAqICAt
IHRoZSB1bml0IGFzc2lnbmVkIHRvIHRoZSBwQ1BVLCBpZiB0aGVyZSdzIG9uZSBhbmQgaXQgY2Fu
IHJ1bjsKKyAqICAtIHRoZSBpZGxlIHVuaXQsIG90aGVyd2lzZS4KICAqLwogc3RhdGljIHN0cnVj
dCB0YXNrX3NsaWNlIG51bGxfc2NoZWR1bGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc190aW1lX3Qgbm93LApAQCAt
Nzk0LDI0ICs3OTAsMjQgQEAgc3RhdGljIHN0cnVjdCB0YXNrX3NsaWNlIG51bGxfc2NoZWR1bGUo
Y29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAgIHN0cnVjdCB0YXNrX3NsaWNlIHJldDsK
IAogICAgIFNDSEVEX1NUQVRfQ1JBTksoc2NoZWR1bGUpOwotICAgIE5VTExfVkNQVV9DSEVDSyhj
dXJyZW50KTsKKyAgICBOVUxMX1VOSVRfQ0hFQ0soY3VycmVudC0+c2NoZWRfdW5pdCk7CiAKICAg
ICBpZiAoIHVubGlrZWx5KHRiX2luaXRfZG9uZSkgKQogICAgIHsKICAgICAgICAgc3RydWN0IHsK
ICAgICAgICAgICAgIHVpbnQxNl90IHRhc2tsZXQsIGNwdTsKLSAgICAgICAgICAgIGludDE2X3Qg
dmNwdSwgZG9tOworICAgICAgICAgICAgaW50MTZfdCB1bml0LCBkb207CiAgICAgICAgIH0gZDsK
ICAgICAgICAgZC5jcHUgPSBjcHU7CiAgICAgICAgIGQudGFza2xldCA9IHRhc2tsZXRfd29ya19z
Y2hlZHVsZWQ7Ci0gICAgICAgIGlmICggcGVyX2NwdShucGMsIGNwdSkudmNwdSA9PSBOVUxMICkK
KyAgICAgICAgaWYgKCBwZXJfY3B1KG5wYywgY3B1KS51bml0ID09IE5VTEwgKQogICAgICAgICB7
Ci0gICAgICAgICAgICBkLnZjcHUgPSBkLmRvbSA9IC0xOworICAgICAgICAgICAgZC51bml0ID0g
ZC5kb20gPSAtMTsKICAgICAgICAgfQogICAgICAgICBlbHNlCiAgICAgICAgIHsKLSAgICAgICAg
ICAgIGQudmNwdSA9IHBlcl9jcHUobnBjLCBjcHUpLnZjcHUtPnZjcHVfaWQ7Ci0gICAgICAgICAg
ICBkLmRvbSA9IHBlcl9jcHUobnBjLCBjcHUpLnZjcHUtPmRvbWFpbi0+ZG9tYWluX2lkOworICAg
ICAgICAgICAgZC51bml0ID0gcGVyX2NwdShucGMsIGNwdSkudW5pdC0+dW5pdF9pZDsKKyAgICAg
ICAgICAgIGQuZG9tID0gcGVyX2NwdShucGMsIGNwdSkudW5pdC0+ZG9tYWluLT5kb21haW5faWQ7
CiAgICAgICAgIH0KICAgICAgICAgX190cmFjZV92YXIoVFJDX1NOVUxMX1NDSEVEVUxFLCAxLCBz
aXplb2YoZCksICZkKTsKICAgICB9CkBAIC04MTksMTYgKzgxNSwxNiBAQCBzdGF0aWMgc3RydWN0
IHRhc2tfc2xpY2UgbnVsbF9zY2hlZHVsZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAg
ICAgaWYgKCB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkICkKICAgICB7CiAgICAgICAgIHRyYWNlX3Zh
cihUUkNfU05VTExfVEFTS0xFVCwgMSwgMCwgTlVMTCk7Ci0gICAgICAgIHJldC50YXNrID0gaWRs
ZV92Y3B1W2NwdV0tPnNjaGVkX3VuaXQ7CisgICAgICAgIHJldC50YXNrID0gc2NoZWRfaWRsZV91
bml0KGNwdSk7CiAgICAgfQogICAgIGVsc2UKLSAgICAgICAgcmV0LnRhc2sgPSBwZXJfY3B1KG5w
YywgY3B1KS52Y3B1LT5zY2hlZF91bml0OworICAgICAgICByZXQudGFzayA9IHBlcl9jcHUobnBj
LCBjcHUpLnVuaXQ7CiAgICAgcmV0Lm1pZ3JhdGVkID0gMDsKICAgICByZXQudGltZSA9IC0xOwog
CiAgICAgLyoKICAgICAgKiBXZSBtYXkgYmUgbmV3IGluIHRoZSBjcHVwb29sLCBvciBqdXN0IGNv
bWluZyBiYWNrIG9ubGluZS4gSW4gd2hpY2gKLSAgICAgKiBjYXNlLCB0aGVyZSBtYXkgYmUgdkNQ
VXMgaW4gdGhlIHdhaXRxdWV1ZSB0aGF0IHdlIGNhbiBhc3NpZ24gdG8gdXMKKyAgICAgKiBjYXNl
LCB0aGVyZSBtYXkgYmUgdW5pdHMgaW4gdGhlIHdhaXRxdWV1ZSB0aGF0IHdlIGNhbiBhc3NpZ24g
dG8gdXMKICAgICAgKiBhbmQgcnVuLgogICAgICAqLwogICAgIGlmICggdW5saWtlbHkocmV0LnRh
c2sgPT0gTlVMTCkgKQpAQCAtODM5LDEwICs4MzUsMTAgQEAgc3RhdGljIHN0cnVjdCB0YXNrX3Ns
aWNlIG51bGxfc2NoZWR1bGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAgICAgICAg
ICAgZ290byB1bmxvY2s7CiAKICAgICAgICAgLyoKLSAgICAgICAgICogV2Ugc2NhbiB0aGUgd2Fp
dHF1ZXVlIHR3aWNlLCBmb3IgcHJpb3JpdGl6aW5nIHZjcHVzIHRoYXQgaGF2ZQorICAgICAgICAg
KiBXZSBzY2FuIHRoZSB3YWl0cXVldWUgdHdpY2UsIGZvciBwcmlvcml0aXppbmcgdW5pdHMgdGhh
dCBoYXZlCiAgICAgICAgICAqIHNvZnQtYWZmaW5pdHkgd2l0aCBjcHUuIFRoaXMgbWF5IGxvb2sg
bGlrZSBzb21ldGhpbmcgZXhwZW5zaXZlIHRvCi0gICAgICAgICAqIGRvIGhlcmUgaW4gbnVsbF9z
Y2hlZHVsZSgpLCBidXQgaXQncyBhY3R1YWxseSBmaW5lLCBiZWNldXNlIHdlIGRvCi0gICAgICAg
ICAqIGl0IG9ubHkgaW4gY2FzZXMgd2hlcmUgYSBwY3B1IGhhcyBubyB2Y3B1IGFzc29jaWF0ZWQg
KGUuZy4sIGFzCisgICAgICAgICAqIGRvIGhlcmUgaW4gbnVsbF9zY2hlZHVsZSgpLCBidXQgaXQn
cyBhY3R1YWxseSBmaW5lLCBiZWNhdXNlIHdlIGRvCisgICAgICAgICAqIGl0IG9ubHkgaW4gY2Fz
ZXMgd2hlcmUgYSBwY3B1IGhhcyBubyB1bml0IGFzc29jaWF0ZWQgKGUuZy4sIGFzCiAgICAgICAg
ICAqIHNhaWQgYWJvdmUsIHRoZSBjcHUgaGFzIGp1c3Qgam9pbmVkIGEgY3B1cG9vbCkuCiAgICAg
ICAgICAqLwogICAgICAgICBmb3JfZWFjaF9hZmZpbml0eV9iYWxhbmNlX3N0ZXAoIGJzICkKQEAg
LTg1MCwxNCArODQ2LDE0IEBAIHN0YXRpYyBzdHJ1Y3QgdGFza19zbGljZSBudWxsX3NjaGVkdWxl
KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKICAgICAgICAgICAgIGxpc3RfZm9yX2VhY2hf
ZW50cnkoIHd2YywgJnBydi0+d2FpdHEsIHdhaXRxX2VsZW0gKQogICAgICAgICAgICAgewogICAg
ICAgICAgICAgICAgIGlmICggYnMgPT0gQkFMQU5DRV9TT0ZUX0FGRklOSVRZICYmCi0gICAgICAg
ICAgICAgICAgICAgICAhaGFzX3NvZnRfYWZmaW5pdHkod3ZjLT52Y3B1LT5zY2hlZF91bml0KSAp
CisgICAgICAgICAgICAgICAgICAgICAhaGFzX3NvZnRfYWZmaW5pdHkod3ZjLT51bml0KSApCiAg
ICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogCi0gICAgICAgICAgICAgICAgaWYgKCB2Y3B1
X2NoZWNrX2FmZmluaXR5KHd2Yy0+dmNwdSwgY3B1LCBicykgKQorICAgICAgICAgICAgICAgIGlm
ICggdW5pdF9jaGVja19hZmZpbml0eSh3dmMtPnVuaXQsIGNwdSwgYnMpICkKICAgICAgICAgICAg
ICAgICB7Ci0gICAgICAgICAgICAgICAgICAgIHZjcHVfYXNzaWduKHBydiwgd3ZjLT52Y3B1LCBj
cHUpOworICAgICAgICAgICAgICAgICAgICB1bml0X2Fzc2lnbihwcnYsIHd2Yy0+dW5pdCwgY3B1
KTsKICAgICAgICAgICAgICAgICAgICAgbGlzdF9kZWxfaW5pdCgmd3ZjLT53YWl0cV9lbGVtKTsK
LSAgICAgICAgICAgICAgICAgICAgcmV0LnRhc2sgPSB3dmMtPnZjcHUtPnNjaGVkX3VuaXQ7Cisg
ICAgICAgICAgICAgICAgICAgIHJldC50YXNrID0gd3ZjLT51bml0OwogICAgICAgICAgICAgICAg
ICAgICBnb3RvIHVubG9jazsKICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICB9CkBAIC04
NzAsMTcgKzg2NiwxNyBAQCBzdGF0aWMgc3RydWN0IHRhc2tfc2xpY2UgbnVsbF9zY2hlZHVsZShj
b25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAgICAgfQogCiAgICAgaWYgKCB1bmxpa2VseShy
ZXQudGFzayA9PSBOVUxMIHx8ICF1bml0X3J1bm5hYmxlKHJldC50YXNrKSkgKQotICAgICAgICBy
ZXQudGFzayA9IGlkbGVfdmNwdVtjcHVdLT5zY2hlZF91bml0OworICAgICAgICByZXQudGFzayA9
IHNjaGVkX2lkbGVfdW5pdChjcHUpOwogCi0gICAgTlVMTF9WQ1BVX0NIRUNLKHJldC50YXNrLT52
Y3B1X2xpc3QpOworICAgIE5VTExfVU5JVF9DSEVDSyhyZXQudGFzayk7CiAgICAgcmV0dXJuIHJl
dDsKIH0KIAotc3RhdGljIGlubGluZSB2b2lkIGR1bXBfdmNwdShzdHJ1Y3QgbnVsbF9wcml2YXRl
ICpwcnYsIHN0cnVjdCBudWxsX3VuaXQgKm52YykKK3N0YXRpYyBpbmxpbmUgdm9pZCBkdW1wX3Vu
aXQoc3RydWN0IG51bGxfcHJpdmF0ZSAqcHJ2LCBzdHJ1Y3QgbnVsbF91bml0ICpudmMpCiB7Ci0g
ICAgcHJpbnRrKCJbJWkuJWldIHBjcHU9JWQiLCBudmMtPnZjcHUtPmRvbWFpbi0+ZG9tYWluX2lk
LAotICAgICAgICAgICAgbnZjLT52Y3B1LT52Y3B1X2lkLCBsaXN0X2VtcHR5KCZudmMtPndhaXRx
X2VsZW0pID8KLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnZjLT52Y3B1LT5wcm9j
ZXNzb3IgOiAtMSk7CisgICAgcHJpbnRrKCJbJWkuJWldIHBjcHU9JWQiLCBudmMtPnVuaXQtPmRv
bWFpbi0+ZG9tYWluX2lkLAorICAgICAgICAgICAgbnZjLT51bml0LT51bml0X2lkLCBsaXN0X2Vt
cHR5KCZudmMtPndhaXRxX2VsZW0pID8KKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
c2NoZWRfdW5pdF9tYXN0ZXIobnZjLT51bml0KSA6IC0xKTsKIH0KIAogc3RhdGljIHZvaWQgbnVs
bF9kdW1wX3BjcHUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBpbnQgY3B1KQpAQCAtODk1
LDE2ICs4OTEsMTcgQEAgc3RhdGljIHZvaWQgbnVsbF9kdW1wX3BjcHUoY29uc3Qgc3RydWN0IHNj
aGVkdWxlciAqb3BzLCBpbnQgY3B1KQogICAgIHByaW50aygiQ1BVWyUwMmRdIHNpYmxpbmc9JSpw
YiwgY29yZT0lKnBiIiwKICAgICAgICAgICAgY3B1LCBDUFVNQVNLX1BSKHBlcl9jcHUoY3B1X3Np
YmxpbmdfbWFzaywgY3B1KSksCiAgICAgICAgICAgIENQVU1BU0tfUFIocGVyX2NwdShjcHVfY29y
ZV9tYXNrLCBjcHUpKSk7Ci0gICAgaWYgKCBwZXJfY3B1KG5wYywgY3B1KS52Y3B1ICE9IE5VTEwg
KQotICAgICAgICBwcmludGsoIiwgdmNwdT0lcHYiLCBwZXJfY3B1KG5wYywgY3B1KS52Y3B1KTsK
KyAgICBpZiAoIHBlcl9jcHUobnBjLCBjcHUpLnVuaXQgIT0gTlVMTCApCisgICAgICAgIHByaW50
aygiLCB1bml0PSVwZHYlZCIsIHBlcl9jcHUobnBjLCBjcHUpLnVuaXQtPmRvbWFpbiwKKyAgICAg
ICAgICAgICAgIHBlcl9jcHUobnBjLCBjcHUpLnVuaXQtPnVuaXRfaWQpOwogICAgIHByaW50aygi
XG4iKTsKIAotICAgIC8qIGN1cnJlbnQgVkNQVSAobm90aGluZyB0byBzYXkgaWYgdGhhdCdzIHRo
ZSBpZGxlIHZjcHUpICovCisgICAgLyogY3VycmVudCB1bml0IChub3RoaW5nIHRvIHNheSBpZiB0
aGF0J3MgdGhlIGlkbGUgdW5pdCkgKi8KICAgICBudmMgPSBudWxsX3VuaXQoY3Vycl9vbl9jcHUo
Y3B1KSk7Ci0gICAgaWYgKCBudmMgJiYgIWlzX2lkbGVfdmNwdShudmMtPnZjcHUpICkKKyAgICBp
ZiAoIG52YyAmJiAhaXNfaWRsZV91bml0KG52Yy0+dW5pdCkgKQogICAgIHsKICAgICAgICAgcHJp
bnRrKCJcdHJ1bjogIik7Ci0gICAgICAgIGR1bXBfdmNwdShwcnYsIG52Yyk7CisgICAgICAgIGR1
bXBfdW5pdChwcnYsIG52Yyk7CiAgICAgICAgIHByaW50aygiXG4iKTsKICAgICB9CiAKQEAgLTky
NywyMyArOTI0LDIzIEBAIHN0YXRpYyB2b2lkIG51bGxfZHVtcChjb25zdCBzdHJ1Y3Qgc2NoZWR1
bGVyICpvcHMpCiAgICAgbGlzdF9mb3JfZWFjaCggaXRlciwgJnBydi0+bmRvbSApCiAgICAgewog
ICAgICAgICBzdHJ1Y3QgbnVsbF9kb20gKm5kb207Ci0gICAgICAgIHN0cnVjdCB2Y3B1ICp2Owor
ICAgICAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdDsKIAogICAgICAgICBuZG9tID0gbGlzdF9l
bnRyeShpdGVyLCBzdHJ1Y3QgbnVsbF9kb20sIG5kb21fZWxlbSk7CiAKICAgICAgICAgcHJpbnRr
KCJcdERvbWFpbjogJWRcbiIsIG5kb20tPmRvbS0+ZG9tYWluX2lkKTsKLSAgICAgICAgZm9yX2Vh
Y2hfdmNwdSggbmRvbS0+ZG9tLCB2ICkKKyAgICAgICAgZm9yX2VhY2hfc2NoZWRfdW5pdCggbmRv
bS0+ZG9tLCB1bml0ICkKICAgICAgICAgewotICAgICAgICAgICAgc3RydWN0IG51bGxfdW5pdCAq
IGNvbnN0IG52YyA9IG51bGxfdW5pdCh2LT5zY2hlZF91bml0KTsKKyAgICAgICAgICAgIHN0cnVj
dCBudWxsX3VuaXQgKiBjb25zdCBudmMgPSBudWxsX3VuaXQodW5pdCk7CiAgICAgICAgICAgICBz
cGlubG9ja190ICpsb2NrOwogCi0gICAgICAgICAgICBsb2NrID0gdW5pdF9zY2hlZHVsZV9sb2Nr
KG52Yy0+dmNwdS0+c2NoZWRfdW5pdCk7CisgICAgICAgICAgICBsb2NrID0gdW5pdF9zY2hlZHVs
ZV9sb2NrKHVuaXQpOwogCiAgICAgICAgICAgICBwcmludGsoIlx0JTNkOiAiLCArK2xvb3ApOwot
ICAgICAgICAgICAgZHVtcF92Y3B1KHBydiwgbnZjKTsKKyAgICAgICAgICAgIGR1bXBfdW5pdChw
cnYsIG52Yyk7CiAgICAgICAgICAgICBwcmludGsoIlxuIik7CiAKLSAgICAgICAgICAgIHVuaXRf
c2NoZWR1bGVfdW5sb2NrKGxvY2ssIG52Yy0+dmNwdS0+c2NoZWRfdW5pdCk7CisgICAgICAgICAg
ICB1bml0X3NjaGVkdWxlX3VubG9jayhsb2NrLCB1bml0KTsKICAgICAgICAgfQogICAgIH0KIApA
QCAtOTU4LDcgKzk1NSw3IEBAIHN0YXRpYyB2b2lkIG51bGxfZHVtcChjb25zdCBzdHJ1Y3Qgc2No
ZWR1bGVyICpvcHMpCiAgICAgICAgICAgICBwcmludGsoIiwgIik7CiAgICAgICAgIGlmICggbG9v
cCAlIDI0ID09IDAgKQogICAgICAgICAgICAgcHJpbnRrKCJcblx0Iik7Ci0gICAgICAgIHByaW50
aygiJXB2IiwgbnZjLT52Y3B1KTsKKyAgICAgICAgcHJpbnRrKCIlcGR2JWQiLCBudmMtPnVuaXQt
PmRvbWFpbiwgbnZjLT51bml0LT51bml0X2lkKTsKICAgICB9CiAgICAgcHJpbnRrKCJcbiIpOwog
ICAgIHNwaW5fdW5sb2NrKCZwcnYtPndhaXRxX2xvY2spOwotLSAKMi4xNi40CgoKX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcg
bGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9q
ZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

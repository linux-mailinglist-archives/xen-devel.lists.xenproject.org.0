Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 84A6CB0FF7
	for <lists+xen-devel@lfdr.de>; Thu, 12 Sep 2019 15:30:56 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i8P9D-0005tF-Hh; Thu, 12 Sep 2019 13:28:31 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=Pap2=XH=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1i8P9B-0005sV-Jt
 for xen-devel@lists.xenproject.org; Thu, 12 Sep 2019 13:28:29 +0000
X-Inumbo-ID: 2e3ebc1e-d561-11e9-9599-12813bfff9fa
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 2e3ebc1e-d561-11e9-9599-12813bfff9fa;
 Thu, 12 Sep 2019 13:28:18 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 4F802B64B;
 Thu, 12 Sep 2019 13:28:17 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Thu, 12 Sep 2019 15:28:09 +0200
Message-Id: <20190912132813.6509-2-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190912132813.6509-1-jgross@suse.com>
References: <20190912132813.6509-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v5 1/5] xen/spinlocks: in debug builds store cpu
 holding the lock
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

QWRkIHRoZSBjcHUgY3VycmVudGx5IGhvbGRpbmcgdGhlIGxvY2sgdG8gc3RydWN0IGxvY2tfZGVi
dWcuIFRoaXMgbWFrZXMKYW5hbHlzaXMgb2YgbG9ja2luZyBlcnJvcnMgZWFzaWVyIGFuZCBpdCBj
YW4gYmUgdGVzdGVkIHdoZXRoZXIgdGhlCmNvcnJlY3QgY3B1IGlzIHJlbGVhc2luZyBhIGxvY2sg
YWdhaW4uCgpTaWduZWQtb2ZmLWJ5OiBKdWVyZ2VuIEdyb3NzIDxqZ3Jvc3NAc3VzZS5jb20+Ci0t
LQpWMjoKLSBhZGp1c3QgdHlwZXMgKEphbiBCZXVsaWNoKQpWNDoKLSBhZGQgZGVmaW5lIGZvciBi
aXRmaWVsZCBzaXplIHRvIHN0b3JlIGNwdSBudW1iZXIgKEphbiBCZXVsaWNoKQotIG1ha2UgcGFk
ZGluZyBmaWVsZCB1bm5hbWVkIChKYW4gQmV1bGljaCkKVjU6Ci0gYWRkIEJVSUxEX0JVR19PTigp
cyB0byB2ZXJpZnkgYml0ZmllbGRzIGRvbid0IGhhdmUgc2l6ZSAwIChKYW4gQmV1bGljaCkKLS0t
CiB4ZW4vY29tbW9uL3NwaW5sb2NrLmMgICAgICB8IDM2ICsrKysrKysrKysrKysrKysrKysrKysr
KysrKysrLS0tLS0tLQogeGVuL2luY2x1ZGUveGVuL3NwaW5sb2NrLmggfCAyOSArKysrKysrKysr
KysrKysrKysrKy0tLS0tLS0tLQogMiBmaWxlcyBjaGFuZ2VkLCA0OSBpbnNlcnRpb25zKCspLCAx
NiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3NwaW5sb2NrLmMgYi94ZW4v
Y29tbW9uL3NwaW5sb2NrLmMKaW5kZXggNmJjNTJkNzBjMC4uNmJiMTcwOTg4MSAxMDA2NDQKLS0t
IGEveGVuL2NvbW1vbi9zcGlubG9jay5jCisrKyBiL3hlbi9jb21tb24vc3BpbmxvY2suYwpAQCAt
MTMsOSArMTMsMTEgQEAKIAogc3RhdGljIGF0b21pY190IHNwaW5fZGVidWcgX19yZWFkX21vc3Rs
eSA9IEFUT01JQ19JTklUKDApOwogCi1zdGF0aWMgdm9pZCBjaGVja19sb2NrKHN0cnVjdCBsb2Nr
X2RlYnVnICpkZWJ1ZykKK3N0YXRpYyB2b2lkIGNoZWNrX2xvY2sodW5pb24gbG9ja19kZWJ1ZyAq
ZGVidWcpCiB7Ci0gICAgaW50IGlycV9zYWZlID0gIWxvY2FsX2lycV9pc19lbmFibGVkKCk7Cisg
ICAgYm9vbCBpcnFfc2FmZSA9ICFsb2NhbF9pcnFfaXNfZW5hYmxlZCgpOworCisgICAgQlVJTERf
QlVHX09OKExPQ0tfREVCVUdfUEFEX0JJVFMgPD0gMCk7CiAKICAgICBpZiAoIHVubGlrZWx5KGF0
b21pY19yZWFkKCZzcGluX2RlYnVnKSA8PSAwKSApCiAgICAgICAgIHJldHVybjsKQEAgLTQzLDE4
ICs0NSwyMSBAQCBzdGF0aWMgdm9pZCBjaGVja19sb2NrKHN0cnVjdCBsb2NrX2RlYnVnICpkZWJ1
ZykKICAgICAgKi8KICAgICBpZiAoIHVubGlrZWx5KGRlYnVnLT5pcnFfc2FmZSAhPSBpcnFfc2Fm
ZSkgKQogICAgIHsKLSAgICAgICAgaW50IHNlZW4gPSBjbXB4Y2hnKCZkZWJ1Zy0+aXJxX3NhZmUs
IC0xLCBpcnFfc2FmZSk7CisgICAgICAgIHVuaW9uIGxvY2tfZGVidWcgc2VlbiwgbmV3ID0geyAw
IH07CisKKyAgICAgICAgbmV3LmlycV9zYWZlID0gaXJxX3NhZmU7CisgICAgICAgIHNlZW4udmFs
ID0gY21weGNoZygmZGVidWctPnZhbCwgTE9DS19ERUJVR19JTklUVkFMLCBuZXcudmFsKTsKIAot
ICAgICAgICBpZiAoIHNlZW4gPT0gIWlycV9zYWZlICkKKyAgICAgICAgaWYgKCAhc2Vlbi51bnNl
ZW4gJiYgc2Vlbi5pcnFfc2FmZSA9PSAhaXJxX3NhZmUgKQogICAgICAgICB7CiAgICAgICAgICAg
ICBwcmludGsoIkNIRUNLTE9DSyBGQUlMVVJFOiBwcmV2IGlycXNhZmU6ICVkLCBjdXJyIGlycXNh
ZmUgJWRcbiIsCi0gICAgICAgICAgICAgICAgICAgc2VlbiwgaXJxX3NhZmUpOworICAgICAgICAg
ICAgICAgICAgIHNlZW4uaXJxX3NhZmUsIGlycV9zYWZlKTsKICAgICAgICAgICAgIEJVRygpOwog
ICAgICAgICB9CiAgICAgfQogfQogCi1zdGF0aWMgdm9pZCBjaGVja19iYXJyaWVyKHN0cnVjdCBs
b2NrX2RlYnVnICpkZWJ1ZykKK3N0YXRpYyB2b2lkIGNoZWNrX2JhcnJpZXIodW5pb24gbG9ja19k
ZWJ1ZyAqZGVidWcpCiB7CiAgICAgaWYgKCB1bmxpa2VseShhdG9taWNfcmVhZCgmc3Bpbl9kZWJ1
ZykgPD0gMCkgKQogICAgICAgICByZXR1cm47CkBAIC03MCw3ICs3NSwxOCBAQCBzdGF0aWMgdm9p
ZCBjaGVja19iYXJyaWVyKHN0cnVjdCBsb2NrX2RlYnVnICpkZWJ1ZykKICAgICAgKiBIb3dldmVy
LCBpZiB3ZSBzcGluIG9uIGFuIElSUS11bnNhZmUgbG9jayB3aXRoIElSUXMgZGlzYWJsZWQgdGhl
biB0aGF0CiAgICAgICogaXMgY2xlYXJseSB3cm9uZywgZm9yIHRoZSBzYW1lIHJlYXNvbiBvdXRs
aW5lZCBpbiBjaGVja19sb2NrKCkgYWJvdmUuCiAgICAgICovCi0gICAgQlVHX09OKCFsb2NhbF9p
cnFfaXNfZW5hYmxlZCgpICYmIChkZWJ1Zy0+aXJxX3NhZmUgPT0gMCkpOworICAgIEJVR19PTigh
bG9jYWxfaXJxX2lzX2VuYWJsZWQoKSAmJiAhZGVidWctPmlycV9zYWZlKTsKK30KKworc3RhdGlj
IHZvaWQgZ290X2xvY2sodW5pb24gbG9ja19kZWJ1ZyAqZGVidWcpCit7CisgICAgZGVidWctPmNw
dSA9IHNtcF9wcm9jZXNzb3JfaWQoKTsKK30KKworc3RhdGljIHZvaWQgcmVsX2xvY2sodW5pb24g
bG9ja19kZWJ1ZyAqZGVidWcpCit7CisgICAgQVNTRVJUKGRlYnVnLT5jcHUgPT0gc21wX3Byb2Nl
c3Nvcl9pZCgpKTsKKyAgICBkZWJ1Zy0+Y3B1ID0gU1BJTkxPQ0tfTk9fQ1BVOwogfQogCiB2b2lk
IHNwaW5fZGVidWdfZW5hYmxlKHZvaWQpCkBAIC04Nyw2ICsxMDMsOCBAQCB2b2lkIHNwaW5fZGVi
dWdfZGlzYWJsZSh2b2lkKQogCiAjZGVmaW5lIGNoZWNrX2xvY2sobCkgKCh2b2lkKTApCiAjZGVm
aW5lIGNoZWNrX2JhcnJpZXIobCkgKCh2b2lkKTApCisjZGVmaW5lIGdvdF9sb2NrKGwpICgodm9p
ZCkwKQorI2RlZmluZSByZWxfbG9jayhsKSAoKHZvaWQpMCkKIAogI2VuZGlmCiAKQEAgLTE1MCw2
ICsxNjgsNyBAQCB2b2lkIGlubGluZSBfc3Bpbl9sb2NrX2NiKHNwaW5sb2NrX3QgKmxvY2ssIHZv
aWQgKCpjYikodm9pZCAqKSwgdm9pZCAqZGF0YSkKICAgICAgICAgICAgIGNiKGRhdGEpOwogICAg
ICAgICBhcmNoX2xvY2tfcmVsYXgoKTsKICAgICB9CisgICAgZ290X2xvY2soJmxvY2stPmRlYnVn
KTsKICAgICBMT0NLX1BST0ZJTEVfR09UOwogICAgIHByZWVtcHRfZGlzYWJsZSgpOwogICAgIGFy
Y2hfbG9ja19hY3F1aXJlX2JhcnJpZXIoKTsKQEAgLTE4MSw2ICsyMDAsNyBAQCB2b2lkIF9zcGlu
X3VubG9jayhzcGlubG9ja190ICpsb2NrKQogICAgIGFyY2hfbG9ja19yZWxlYXNlX2JhcnJpZXIo
KTsKICAgICBwcmVlbXB0X2VuYWJsZSgpOwogICAgIExPQ0tfUFJPRklMRV9SRUw7CisgICAgcmVs
X2xvY2soJmxvY2stPmRlYnVnKTsKICAgICBhZGRfc2l6ZWQoJmxvY2stPnRpY2tldHMuaGVhZCwg
MSk7CiAgICAgYXJjaF9sb2NrX3NpZ25hbCgpOwogfQpAQCAtMjI0LDYgKzI0NCw3IEBAIGludCBf
c3Bpbl90cnlsb2NrKHNwaW5sb2NrX3QgKmxvY2spCiAgICAgaWYgKCBjbXB4Y2hnKCZsb2NrLT50
aWNrZXRzLmhlYWRfdGFpbCwKICAgICAgICAgICAgICAgICAgb2xkLmhlYWRfdGFpbCwgbmV3Lmhl
YWRfdGFpbCkgIT0gb2xkLmhlYWRfdGFpbCApCiAgICAgICAgIHJldHVybiAwOworICAgIGdvdF9s
b2NrKCZsb2NrLT5kZWJ1Zyk7CiAjaWZkZWYgQ09ORklHX0xPQ0tfUFJPRklMRQogICAgIGlmIChs
b2NrLT5wcm9maWxlKQogICAgICAgICBsb2NrLT5wcm9maWxlLT50aW1lX2xvY2tlZCA9IE5PVygp
OwpAQCAtMjY3LDYgKzI4OCw3IEBAIGludCBfc3Bpbl90cnlsb2NrX3JlY3Vyc2l2ZShzcGlubG9j
a190ICpsb2NrKQogCiAgICAgLyogRG9uJ3QgYWxsb3cgb3ZlcmZsb3cgb2YgcmVjdXJzZV9jcHUg
ZmllbGQuICovCiAgICAgQlVJTERfQlVHX09OKE5SX0NQVVMgPiBTUElOTE9DS19OT19DUFUpOwor
ICAgIEJVSUxEX0JVR19PTihTUElOTE9DS19SRUNVUlNFX0JJVFMgPD0gMCk7CiAKICAgICBjaGVj
a19sb2NrKCZsb2NrLT5kZWJ1Zyk7CiAKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL3hlbi9zcGlu
bG9jay5oIGIveGVuL2luY2x1ZGUveGVuL3NwaW5sb2NrLmgKaW5kZXggMmM3NDE1ZTIzYS4uZGYz
NzU1MGYwMiAxMDA2NDQKLS0tIGEveGVuL2luY2x1ZGUveGVuL3NwaW5sb2NrLmgKKysrIGIveGVu
L2luY2x1ZGUveGVuL3NwaW5sb2NrLmgKQEAgLTUsMTUgKzUsMjUgQEAKICNpbmNsdWRlIDxhc20v
c3BpbmxvY2suaD4KICNpbmNsdWRlIDxhc20vdHlwZXMuaD4KIAorI2RlZmluZSBTUElOTE9DS19D
UFVfQklUUyAgMTIKKwogI2lmbmRlZiBOREVCVUcKLXN0cnVjdCBsb2NrX2RlYnVnIHsKLSAgICBz
MTYgaXJxX3NhZmU7IC8qICsxOiBJUlEtc2FmZTsgMDogbm90IElSUS1zYWZlOyAtMTogZG9uJ3Qg
a25vdyB5ZXQgKi8KK3VuaW9uIGxvY2tfZGVidWcgeworICAgIHVpbnQxNl90IHZhbDsKKyNkZWZp
bmUgTE9DS19ERUJVR19JTklUVkFMIDB4ZmZmZgorICAgIHN0cnVjdCB7CisgICAgICAgIHVpbnQx
Nl90IGNwdTpTUElOTE9DS19DUFVfQklUUzsKKyNkZWZpbmUgTE9DS19ERUJVR19QQURfQklUUyAo
MTQgLSBTUElOTE9DS19DUFVfQklUUykKKyAgICAgICAgdWludDE2X3QgOkxPQ0tfREVCVUdfUEFE
X0JJVFM7CisgICAgICAgIGJvb2wgaXJxX3NhZmU6MTsKKyAgICAgICAgYm9vbCB1bnNlZW46MTsK
KyAgICB9OwogfTsKLSNkZWZpbmUgX0xPQ0tfREVCVUcgeyAtMSB9CisjZGVmaW5lIF9MT0NLX0RF
QlVHIHsgTE9DS19ERUJVR19JTklUVkFMIH0KIHZvaWQgc3Bpbl9kZWJ1Z19lbmFibGUodm9pZCk7
CiB2b2lkIHNwaW5fZGVidWdfZGlzYWJsZSh2b2lkKTsKICNlbHNlCi1zdHJ1Y3QgbG9ja19kZWJ1
ZyB7IH07Cit1bmlvbiBsb2NrX2RlYnVnIHsgfTsKICNkZWZpbmUgX0xPQ0tfREVCVUcgeyB9CiAj
ZGVmaW5lIHNwaW5fZGVidWdfZW5hYmxlKCkgKCh2b2lkKTApCiAjZGVmaW5lIHNwaW5fZGVidWdf
ZGlzYWJsZSgpICgodm9pZCkwKQpAQCAtMTM4LDExICsxNDgsMTIgQEAgdHlwZWRlZiB1bmlvbiB7
CiAKIHR5cGVkZWYgc3RydWN0IHNwaW5sb2NrIHsKICAgICBzcGlubG9ja190aWNrZXRzX3QgdGlj
a2V0czsKLSAgICB1MTYgcmVjdXJzZV9jcHU6MTI7Ci0jZGVmaW5lIFNQSU5MT0NLX05PX0NQVSAw
eGZmZnUKLSAgICB1MTYgcmVjdXJzZV9jbnQ6NDsKLSNkZWZpbmUgU1BJTkxPQ0tfTUFYX1JFQ1VS
U0UgMHhmdQotICAgIHN0cnVjdCBsb2NrX2RlYnVnIGRlYnVnOworICAgIHUxNiByZWN1cnNlX2Nw
dTpTUElOTE9DS19DUFVfQklUUzsKKyNkZWZpbmUgU1BJTkxPQ0tfTk9fQ1BVICAgICAgICAoKDF1
IDw8IFNQSU5MT0NLX0NQVV9CSVRTKSAtIDEpCisjZGVmaW5lIFNQSU5MT0NLX1JFQ1VSU0VfQklU
UyAgKDE2IC0gU1BJTkxPQ0tfQ1BVX0JJVFMpCisgICAgdTE2IHJlY3Vyc2VfY250OlNQSU5MT0NL
X1JFQ1VSU0VfQklUUzsKKyNkZWZpbmUgU1BJTkxPQ0tfTUFYX1JFQ1VSU0UgICAoKDF1IDw8IFNQ
SU5MT0NLX1JFQ1VSU0VfQklUUykgLSAxKQorICAgIHVuaW9uIGxvY2tfZGVidWcgZGVidWc7CiAj
aWZkZWYgQ09ORklHX0xPQ0tfUFJPRklMRQogICAgIHN0cnVjdCBsb2NrX3Byb2ZpbGUgKnByb2Zp
bGU7CiAjZW5kaWYKLS0gCjIuMTYuNAoKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhl
bnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5m
by94ZW4tZGV2ZWw=

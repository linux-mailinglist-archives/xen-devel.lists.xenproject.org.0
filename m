Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id AF478134620
	for <lists+xen-devel@lfdr.de>; Wed,  8 Jan 2020 16:25:56 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1ipDBQ-0004Qz-3V; Wed, 08 Jan 2020 15:23:44 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=Mkji=25=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1ipDBP-0004QZ-4M
 for xen-devel@lists.xenproject.org; Wed, 08 Jan 2020 15:23:43 +0000
X-Inumbo-ID: d5d27440-322a-11ea-b82c-12813bfff9fa
Received: from mx2.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id d5d27440-322a-11ea-b82c-12813bfff9fa;
 Wed, 08 Jan 2020 15:23:35 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx2.suse.de (Postfix) with ESMTP id 8E522B1E9;
 Wed,  8 Jan 2020 15:23:32 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Wed,  8 Jan 2020 16:23:26 +0100
Message-Id: <20200108152328.27194-8-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20200108152328.27194-1-jgross@suse.com>
References: <20200108152328.27194-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v2 7/9] xen/sched: switch scheduling to bool
 where appropriate
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Julien Grall <julien@xen.org>,
 Wei Liu <wl@xen.org>, Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Dario Faggioli <dfaggioli@suse.com>,
 Josh Whitehead <josh.whitehead@dornerworks.com>,
 Meng Xu <mengxu@cis.upenn.edu>, Jan Beulich <jbeulich@suse.com>,
 Stewart Hildebrand <stewart.hildebrand@dornerworks.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

U2NoZWR1bGluZyBjb2RlIGhhcyBzZXZlcmFsIHBsYWNlcyB1c2luZyBpbnQgb3IgYm9vbF90IGlu
c3RlYWQgb2YgYm9vbC4KU3dpdGNoIHRob3NlLgoKU2lnbmVkLW9mZi1ieTogSnVlcmdlbiBHcm9z
cyA8amdyb3NzQHN1c2UuY29tPgotLS0KVjI6Ci0gcmVuYW1lIGJvb2wgInBvcyIgdG8gImZpcnN0
IiAoRGFyaW8gRmFnZ2lvbGkpCi0tLQogeGVuL2NvbW1vbi9zY2hlZC9hcmluYzY1My5jIHwgIDgg
KysrKy0tLS0KIHhlbi9jb21tb24vc2NoZWQvY29yZS5jICAgICB8IDE0ICsrKysrKystLS0tLS0t
CiB4ZW4vY29tbW9uL3NjaGVkL2NwdXBvb2wuYyAgfCAxMCArKysrKy0tLS0tCiB4ZW4vY29tbW9u
L3NjaGVkL2NyZWRpdC5jICAgfCAxMiArKysrKystLS0tLS0KIHhlbi9jb21tb24vc2NoZWQvcHJp
dmF0ZS5oICB8ICAyICstCiB4ZW4vY29tbW9uL3NjaGVkL3J0LmMgICAgICAgfCAxOCArKysrKysr
KystLS0tLS0tLS0KIHhlbi9pbmNsdWRlL3hlbi9zY2hlZC5oICAgICB8ICA2ICsrKy0tLQogNyBm
aWxlcyBjaGFuZ2VkLCAzNSBpbnNlcnRpb25zKCspLCAzNSBkZWxldGlvbnMoLSkKCmRpZmYgLS1n
aXQgYS94ZW4vY29tbW9uL3NjaGVkL2FyaW5jNjUzLmMgYi94ZW4vY29tbW9uL3NjaGVkL2FyaW5j
NjUzLmMKaW5kZXggODg5NWQ5MmI1ZS4uYmNlODAyMWUzZiAxMDA2NDQKLS0tIGEveGVuL2NvbW1v
bi9zY2hlZC9hcmluYzY1My5jCisrKyBiL3hlbi9jb21tb24vc2NoZWQvYXJpbmM2NTMuYwpAQCAt
NzUsNyArNzUsNyBAQCB0eXBlZGVmIHN0cnVjdCBhcmluYzY1M191bml0X3MKICAgICAgKiBhcmlu
YzY1M191bml0X3QgcG9pbnRlci4gKi8KICAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCAqIHVuaXQ7CiAg
ICAgLyogYXdha2UgaG9sZHMgd2hldGhlciB0aGUgVU5JVCBoYXMgYmVlbiB3b2tlbiB3aXRoIHZj
cHVfd2FrZSgpICovCi0gICAgYm9vbF90ICAgICAgICAgICAgICBhd2FrZTsKKyAgICBib29sICAg
ICAgICAgICAgICAgIGF3YWtlOwogICAgIC8qIGxpc3QgaG9sZHMgdGhlIGxpbmtlZCBsaXN0IGlu
Zm9ybWF0aW9uIGZvciB0aGUgbGlzdCB0aGlzIFVOSVQKICAgICAgKiBpcyBzdG9yZWQgaW4gKi8K
ICAgICBzdHJ1Y3QgbGlzdF9oZWFkICAgIGxpc3Q7CkBAIC00MjcsNyArNDI3LDcgQEAgYTY1M3Nj
aGVkX2FsbG9jX3VkYXRhKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVk
X3VuaXQgKnVuaXQsCiAgICAgICogd2lsbCBtYXJrIHRoZSBVTklUIGF3YWtlLgogICAgICAqLwog
ICAgIHN2Yy0+dW5pdCA9IHVuaXQ7Ci0gICAgc3ZjLT5hd2FrZSA9IDA7CisgICAgc3ZjLT5hd2Fr
ZSA9IGZhbHNlOwogICAgIGlmICggIWlzX2lkbGVfdW5pdCh1bml0KSApCiAgICAgICAgIGxpc3Rf
YWRkKCZzdmMtPmxpc3QsICZTQ0hFRF9QUklWKG9wcyktPnVuaXRfbGlzdCk7CiAgICAgdXBkYXRl
X3NjaGVkdWxlX3VuaXRzKG9wcyk7CkBAIC00NzMsNyArNDczLDcgQEAgc3RhdGljIHZvaWQKIGE2
NTNzY2hlZF91bml0X3NsZWVwKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNj
aGVkX3VuaXQgKnVuaXQpCiB7CiAgICAgaWYgKCBBVU5JVCh1bml0KSAhPSBOVUxMICkKLSAgICAg
ICAgQVVOSVQodW5pdCktPmF3YWtlID0gMDsKKyAgICAgICAgQVVOSVQodW5pdCktPmF3YWtlID0g
ZmFsc2U7CiAKICAgICAvKgogICAgICAqIElmIHRoZSBVTklUIGJlaW5nIHB1dCB0byBzbGVlcCBp
cyB0aGUgc2FtZSBvbmUgdGhhdCBpcyBjdXJyZW50bHkKQEAgLTQ5Myw3ICs0OTMsNyBAQCBzdGF0
aWMgdm9pZAogYTY1M3NjaGVkX3VuaXRfd2FrZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMs
IHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogewogICAgIGlmICggQVVOSVQodW5pdCkgIT0gTlVM
TCApCi0gICAgICAgIEFVTklUKHVuaXQpLT5hd2FrZSA9IDE7CisgICAgICAgIEFVTklUKHVuaXQp
LT5hd2FrZSA9IHRydWU7CiAKICAgICBjcHVfcmFpc2Vfc29mdGlycShzY2hlZF91bml0X21hc3Rl
cih1bml0KSwgU0NIRURVTEVfU09GVElSUSk7CiB9CmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3Nj
aGVkL2NvcmUuYyBiL3hlbi9jb21tb24vc2NoZWQvY29yZS5jCmluZGV4IDQxNTNkMTEwYmUuLjg5
NmY4MmY0ZDIgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWQvY29yZS5jCisrKyBiL3hlbi9j
b21tb24vc2NoZWQvY29yZS5jCkBAIC01Myw3ICs1Myw3IEBAIHN0cmluZ19wYXJhbSgic2NoZWQi
LCBvcHRfc2NoZWQpOwogICogc2NoZWR1bGVyIHdpbGwgZ2l2ZSBwcmVmZXJyZW5jZSB0byBwYXJ0
aWFsbHkgaWRsZSBwYWNrYWdlIGNvbXBhcmVkIHRvCiAgKiB0aGUgZnVsbCBpZGxlIHBhY2thZ2Us
IHdoZW4gcGlja2luZyBwQ1BVIHRvIHNjaGVkdWxlIHZDUFUuCiAgKi8KLWJvb2xfdCBzY2hlZF9z
bXRfcG93ZXJfc2F2aW5ncyA9IDA7Citib29sIHNjaGVkX3NtdF9wb3dlcl9zYXZpbmdzOwogYm9v
bGVhbl9wYXJhbSgic2NoZWRfc210X3Bvd2VyX3NhdmluZ3MiLCBzY2hlZF9zbXRfcG93ZXJfc2F2
aW5ncyk7CiAKIC8qIERlZmF1bHQgc2NoZWR1bGluZyByYXRlIGxpbWl0OiAxbXMKQEAgLTU3NCw3
ICs1NzQsNyBAQCBpbnQgc2NoZWRfaW5pdF92Y3B1KHN0cnVjdCB2Y3B1ICp2KQogICAgIHsKICAg
ICAgICAgZ2V0X3NjaGVkX3Jlcyh2LT5wcm9jZXNzb3IpLT5jdXJyID0gdW5pdDsKICAgICAgICAg
Z2V0X3NjaGVkX3Jlcyh2LT5wcm9jZXNzb3IpLT5zY2hlZF91bml0X2lkbGUgPSB1bml0OwotICAg
ICAgICB2LT5pc19ydW5uaW5nID0gMTsKKyAgICAgICAgdi0+aXNfcnVubmluZyA9IHRydWU7CiAg
ICAgICAgIHVuaXQtPmlzX3J1bm5pbmcgPSB0cnVlOwogICAgICAgICB1bml0LT5zdGF0ZV9lbnRy
eV90aW1lID0gTk9XKCk7CiAgICAgfQpAQCAtOTgzLDcgKzk4Myw3IEBAIHN0YXRpYyB2b2lkIHNj
aGVkX3VuaXRfbWlncmF0ZV9maW5pc2goc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiAgICAgdW5z
aWduZWQgbG9uZyBmbGFnczsKICAgICB1bnNpZ25lZCBpbnQgb2xkX2NwdSwgbmV3X2NwdTsKICAg
ICBzcGlubG9ja190ICpvbGRfbG9jaywgKm5ld19sb2NrOwotICAgIGJvb2xfdCBwaWNrX2NhbGxl
ZCA9IDA7CisgICAgYm9vbCBwaWNrX2NhbGxlZCA9IGZhbHNlOwogICAgIHN0cnVjdCB2Y3B1ICp2
OwogCiAgICAgLyoKQEAgLTEwMjksNyArMTAyOSw3IEBAIHN0YXRpYyB2b2lkIHNjaGVkX3VuaXRf
bWlncmF0ZV9maW5pc2goc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiAgICAgICAgICAgICBpZiAo
IChuZXdfbG9jayA9PSBnZXRfc2NoZWRfcmVzKG5ld19jcHUpLT5zY2hlZHVsZV9sb2NrKSAmJgog
ICAgICAgICAgICAgICAgICBjcHVtYXNrX3Rlc3RfY3B1KG5ld19jcHUsIHVuaXQtPmRvbWFpbi0+
Y3B1cG9vbC0+Y3B1X3ZhbGlkKSApCiAgICAgICAgICAgICAgICAgYnJlYWs7Ci0gICAgICAgICAg
ICBwaWNrX2NhbGxlZCA9IDE7CisgICAgICAgICAgICBwaWNrX2NhbGxlZCA9IHRydWU7CiAgICAg
ICAgIH0KICAgICAgICAgZWxzZQogICAgICAgICB7CkBAIC0xMDM3LDcgKzEwMzcsNyBAQCBzdGF0
aWMgdm9pZCBzY2hlZF91bml0X21pZ3JhdGVfZmluaXNoKHN0cnVjdCBzY2hlZF91bml0ICp1bml0
KQogICAgICAgICAgICAgICogV2UgZG8gbm90IGhvbGQgdGhlIHNjaGVkdWxlciBsb2NrIGFwcHJv
cHJpYXRlIGZvciB0aGlzIHZDUFUuCiAgICAgICAgICAgICAgKiBUaHVzIHdlIGNhbm5vdCBzZWxl
Y3QgYSBuZXcgQ1BVIG9uIHRoaXMgaXRlcmF0aW9uLiBUcnkgYWdhaW4uCiAgICAgICAgICAgICAg
Ki8KLSAgICAgICAgICAgIHBpY2tfY2FsbGVkID0gMDsKKyAgICAgICAgICAgIHBpY2tfY2FsbGVk
ID0gZmFsc2U7CiAgICAgICAgIH0KIAogICAgICAgICBzY2hlZF9zcGluX3VubG9ja19kb3VibGUo
b2xkX2xvY2ssIG5ld19sb2NrLCBmbGFncyk7CkBAIC0yMTQ4LDcgKzIxNDgsNyBAQCBzdGF0aWMg
dm9pZCBzY2hlZF9zd2l0Y2hfdW5pdHMoc3RydWN0IHNjaGVkX3Jlc291cmNlICpzciwKICAgICAg
ICAgICAgIHZjcHVfcnVuc3RhdGVfY2hhbmdlKHZuZXh0LCB2bmV4dC0+bmV3X3N0YXRlLCBub3cp
OwogICAgICAgICB9CiAKLSAgICAgICAgdm5leHQtPmlzX3J1bm5pbmcgPSAxOworICAgICAgICB2
bmV4dC0+aXNfcnVubmluZyA9IHRydWU7CiAKICAgICAgICAgaWYgKCBpc19pZGxlX3ZjcHUodm5l
eHQpICkKICAgICAgICAgICAgIHZuZXh0LT5zY2hlZF91bml0ID0gbmV4dDsKQEAgLTIyMTksNyAr
MjIxOSw3IEBAIHN0YXRpYyB2b2lkIHZjcHVfY29udGV4dF9zYXZlZChzdHJ1Y3QgdmNwdSAqdnBy
ZXYsIHN0cnVjdCB2Y3B1ICp2bmV4dCkKICAgICBzbXBfd21iKCk7CiAKICAgICBpZiAoIHZwcmV2
ICE9IHZuZXh0ICkKLSAgICAgICAgdnByZXYtPmlzX3J1bm5pbmcgPSAwOworICAgICAgICB2cHJl
di0+aXNfcnVubmluZyA9IGZhbHNlOwogfQogCiBzdGF0aWMgdm9pZCB1bml0X2NvbnRleHRfc2F2
ZWQoc3RydWN0IHNjaGVkX3Jlc291cmNlICpzcikKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vc2No
ZWQvY3B1cG9vbC5jIGIveGVuL2NvbW1vbi9zY2hlZC9jcHVwb29sLmMKaW5kZXggN2IzMWFiMGQ2
MS4uYzEzOTZjZmZmNCAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9zY2hlZC9jcHVwb29sLmMKKysr
IGIveGVuL2NvbW1vbi9zY2hlZC9jcHVwb29sLmMKQEAgLTE1NCw3ICsxNTQsNyBAQCBzdGF0aWMg
c3RydWN0IGNwdXBvb2wgKmFsbG9jX2NwdXBvb2xfc3RydWN0KHZvaWQpCiAgKiB0aGUgc2VhcmNo
ZWQgaWQgaXMgcmV0dXJuZWQKICAqIHJldHVybnMgTlVMTCBpZiBub3QgZm91bmQuCiAgKi8KLXN0
YXRpYyBzdHJ1Y3QgY3B1cG9vbCAqX19jcHVwb29sX2ZpbmRfYnlfaWQoaW50IGlkLCBpbnQgZXhh
Y3QpCitzdGF0aWMgc3RydWN0IGNwdXBvb2wgKl9fY3B1cG9vbF9maW5kX2J5X2lkKGludCBpZCwg
Ym9vbCBleGFjdCkKIHsKICAgICBzdHJ1Y3QgY3B1cG9vbCAqKnE7CiAKQEAgLTE2OSwxMCArMTY5
LDEwIEBAIHN0YXRpYyBzdHJ1Y3QgY3B1cG9vbCAqX19jcHVwb29sX2ZpbmRfYnlfaWQoaW50IGlk
LCBpbnQgZXhhY3QpCiAKIHN0YXRpYyBzdHJ1Y3QgY3B1cG9vbCAqY3B1cG9vbF9maW5kX2J5X2lk
KGludCBwb29saWQpCiB7Ci0gICAgcmV0dXJuIF9fY3B1cG9vbF9maW5kX2J5X2lkKHBvb2xpZCwg
MSk7CisgICAgcmV0dXJuIF9fY3B1cG9vbF9maW5kX2J5X2lkKHBvb2xpZCwgdHJ1ZSk7CiB9CiAK
LXN0YXRpYyBzdHJ1Y3QgY3B1cG9vbCAqX19jcHVwb29sX2dldF9ieV9pZChpbnQgcG9vbGlkLCBp
bnQgZXhhY3QpCitzdGF0aWMgc3RydWN0IGNwdXBvb2wgKl9fY3B1cG9vbF9nZXRfYnlfaWQoaW50
IHBvb2xpZCwgYm9vbCBleGFjdCkKIHsKICAgICBzdHJ1Y3QgY3B1cG9vbCAqYzsKICAgICBzcGlu
X2xvY2soJmNwdXBvb2xfbG9jayk7CkBAIC0xODUsMTIgKzE4NSwxMiBAQCBzdGF0aWMgc3RydWN0
IGNwdXBvb2wgKl9fY3B1cG9vbF9nZXRfYnlfaWQoaW50IHBvb2xpZCwgaW50IGV4YWN0KQogCiBz
dHJ1Y3QgY3B1cG9vbCAqY3B1cG9vbF9nZXRfYnlfaWQoaW50IHBvb2xpZCkKIHsKLSAgICByZXR1
cm4gX19jcHVwb29sX2dldF9ieV9pZChwb29saWQsIDEpOworICAgIHJldHVybiBfX2NwdXBvb2xf
Z2V0X2J5X2lkKHBvb2xpZCwgdHJ1ZSk7CiB9CiAKIHN0YXRpYyBzdHJ1Y3QgY3B1cG9vbCAqY3B1
cG9vbF9nZXRfbmV4dF9ieV9pZChpbnQgcG9vbGlkKQogewotICAgIHJldHVybiBfX2NwdXBvb2xf
Z2V0X2J5X2lkKHBvb2xpZCwgMCk7CisgICAgcmV0dXJuIF9fY3B1cG9vbF9nZXRfYnlfaWQocG9v
bGlkLCBmYWxzZSk7CiB9CiAKIHZvaWQgY3B1cG9vbF9wdXQoc3RydWN0IGNwdXBvb2wgKnBvb2wp
CmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3NjaGVkL2NyZWRpdC5jIGIveGVuL2NvbW1vbi9zY2hl
ZC9jcmVkaXQuYwppbmRleCA2YjA0ZjhmNzFjLi5hNzVlZmJkNDNkIDEwMDY0NAotLS0gYS94ZW4v
Y29tbW9uL3NjaGVkL2NyZWRpdC5jCisrKyBiL3hlbi9jb21tb24vc2NoZWQvY3JlZGl0LmMKQEAg
LTI0NSw3ICsyNDUsNyBAQCBfX3J1bnFfZWxlbShzdHJ1Y3QgbGlzdF9oZWFkICplbGVtKQogfQog
CiAvKiBJcyB0aGUgZmlyc3QgZWxlbWVudCBvZiBjcHUncyBydW5xIChpZiBhbnkpIGNwdSdzIGlk
bGUgdW5pdD8gKi8KLXN0YXRpYyBpbmxpbmUgYm9vbF90IGlzX3J1bnFfaWRsZSh1bnNpZ25lZCBp
bnQgY3B1KQorc3RhdGljIGlubGluZSBib29sIGlzX3J1bnFfaWRsZSh1bnNpZ25lZCBpbnQgY3B1
KQogewogICAgIC8qCiAgICAgICogV2UncmUgcGVla2luZyBhdCBjcHUncyBydW5xLCB3ZSBtdXN0
IGhvbGQgdGhlIHByb3BlciBsb2NrLgpAQCAtMzQ0LDcgKzM0NCw3IEBAIHN0YXRpYyB2b2lkIGJ1
cm5fY3JlZGl0cyhzdHJ1Y3QgY3NjaGVkX3VuaXQgKnN2Yywgc190aW1lX3Qgbm93KQogICAgIHN2
Yy0+c3RhcnRfdGltZSArPSAoY3JlZGl0cyAqIE1JTExJU0VDUygxKSkgLyBDU0NIRURfQ1JFRElU
U19QRVJfTVNFQzsKIH0KIAotc3RhdGljIGJvb2xfdCBfX3JlYWRfbW9zdGx5IG9wdF90aWNrbGVf
b25lX2lkbGUgPSAxOworc3RhdGljIGJvb2wgX19yZWFkX21vc3RseSBvcHRfdGlja2xlX29uZV9p
ZGxlID0gdHJ1ZTsKIGJvb2xlYW5fcGFyYW0oInRpY2tsZV9vbmVfaWRsZV9jcHUiLCBvcHRfdGlj
a2xlX29uZV9pZGxlKTsKIAogREVGSU5FX1BFUl9DUFUodW5zaWduZWQgaW50LCBsYXN0X3RpY2ts
ZV9jcHUpOwpAQCAtNzE5LDcgKzcxOSw3IEBAIF9fY3NjaGVkX3VuaXRfaXNfbWlncmF0ZWFibGUo
Y29uc3Qgc3RydWN0IGNzY2hlZF9wcml2YXRlICpwcnYsCiAKIHN0YXRpYyBpbnQKIF9jc2NoZWRf
Y3B1X3BpY2soY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBjb25zdCBzdHJ1Y3Qgc2NoZWRf
dW5pdCAqdW5pdCwKLSAgICAgICAgICAgICAgICAgYm9vbF90IGNvbW1pdCkKKyAgICAgICAgICAg
ICAgICAgYm9vbCBjb21taXQpCiB7CiAgICAgaW50IGNwdSA9IHNjaGVkX3VuaXRfbWFzdGVyKHVu
aXQpOwogICAgIC8qIFdlIG11c3QgYWx3YXlzIHVzZSBjcHUncyBzY3JhdGNoIHNwYWNlICovCkBA
IC04NzEsNyArODcxLDcgQEAgY3NjaGVkX3Jlc19waWNrKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIg
Km9wcywgY29uc3Qgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiAgICAgICogZ2V0IGJvb3N0ZWQs
IHdoaWNoIHdlIGRvbid0IGRlc2VydmUgYXMgd2UgYXJlICJvbmx5IiBtaWdyYXRpbmcuCiAgICAg
ICovCiAgICAgc2V0X2JpdChDU0NIRURfRkxBR19VTklUX01JR1JBVElORywgJnN2Yy0+ZmxhZ3Mp
OwotICAgIHJldHVybiBnZXRfc2NoZWRfcmVzKF9jc2NoZWRfY3B1X3BpY2sob3BzLCB1bml0LCAx
KSk7CisgICAgcmV0dXJuIGdldF9zY2hlZF9yZXMoX2NzY2hlZF9jcHVfcGljayhvcHMsIHVuaXQs
IHRydWUpKTsKIH0KIAogc3RhdGljIGlubGluZSB2b2lkCkBAIC05NzUsNyArOTc1LDcgQEAgY3Nj
aGVkX3VuaXRfYWNjdChzdHJ1Y3QgY3NjaGVkX3ByaXZhdGUgKnBydiwgdW5zaWduZWQgaW50IGNw
dSkKICAgICAgICAgICogbWlncmF0aW5nIGl0IHRvIHJ1biBlbHNld2hlcmUgKHNlZSBtdWx0aS1j
b3JlIGFuZCBtdWx0aS10aHJlYWQKICAgICAgICAgICogc3VwcG9ydCBpbiBjc2NoZWRfcmVzX3Bp
Y2soKSkuCiAgICAgICAgICAqLwotICAgICAgICBuZXdfY3B1ID0gX2NzY2hlZF9jcHVfcGljayhv
cHMsIGN1cnJ1bml0LCAwKTsKKyAgICAgICAgbmV3X2NwdSA9IF9jc2NoZWRfY3B1X3BpY2sob3Bz
LCBjdXJydW5pdCwgZmFsc2UpOwogCiAgICAgICAgIHVuaXRfc2NoZWR1bGVfdW5sb2NrX2lycXJl
c3RvcmUobG9jaywgZmxhZ3MsIGN1cnJ1bml0KTsKIApAQCAtMTEwOCw3ICsxMTA4LDcgQEAgc3Rh
dGljIHZvaWQKIGNzY2hlZF91bml0X3dha2UoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBz
dHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIHsKICAgICBzdHJ1Y3QgY3NjaGVkX3VuaXQgKiBjb25z
dCBzdmMgPSBDU0NIRURfVU5JVCh1bml0KTsKLSAgICBib29sX3QgbWlncmF0aW5nOworICAgIGJv
b2wgbWlncmF0aW5nOwogCiAgICAgQlVHX09OKCBpc19pZGxlX3VuaXQodW5pdCkgKTsKIApkaWZm
IC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZC9wcml2YXRlLmggYi94ZW4vY29tbW9uL3NjaGVkL3By
aXZhdGUuaAppbmRleCBlZGNlMzU0ZGM3Li45ZDBkYjc1Y2JiIDEwMDY0NAotLS0gYS94ZW4vY29t
bW9uL3NjaGVkL3ByaXZhdGUuaAorKysgYi94ZW4vY29tbW9uL3NjaGVkL3ByaXZhdGUuaApAQCAt
NTg5LDcgKzU4OSw3IEBAIHVuc2lnbmVkIGludCBjcHVwb29sX2dldF9ncmFudWxhcml0eShjb25z
dCBzdHJ1Y3QgY3B1cG9vbCAqYyk7CiAgKiAqIFRoZSBoYXJkIGFmZmluaXR5IGlzIG5vdCBhIHN1
YnNldCBvZiBzb2Z0IGFmZmluaXR5CiAgKiAqIFRoZXJlIGlzIGFuIG92ZXJsYXAgYmV0d2VlbiB0
aGUgc29mdCBhbmQgaGFyZCBhZmZpbml0eSBtYXNrcwogICovCi1zdGF0aWMgaW5saW5lIGludCBo
YXNfc29mdF9hZmZpbml0eShjb25zdCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKK3N0YXRpYyBp
bmxpbmUgYm9vbCBoYXNfc29mdF9hZmZpbml0eShjb25zdCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5p
dCkKIHsKICAgICByZXR1cm4gdW5pdC0+c29mdF9hZmZfZWZmZWN0aXZlICYmCiAgICAgICAgICAg
ICFjcHVtYXNrX3N1YnNldChjcHVwb29sX2RvbWFpbl9tYXN0ZXJfY3B1bWFzayh1bml0LT5kb21h
aW4pLApkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZC9ydC5jIGIveGVuL2NvbW1vbi9zY2hl
ZC9ydC5jCmluZGV4IGQyNmY3N2Y1NTQuLjZkYzRiNmE2ZTUgMTAwNjQ0Ci0tLSBhL3hlbi9jb21t
b24vc2NoZWQvcnQuYworKysgYi94ZW4vY29tbW9uL3NjaGVkL3J0LmMKQEAgLTQ5MCwxMyArNDkw
LDEzIEBAIHJ0X3VwZGF0ZV9kZWFkbGluZShzX3RpbWVfdCBub3csIHN0cnVjdCBydF91bml0ICpz
dmMpCiBzdGF0aWMgaW5saW5lIGJvb2wKIGRlYWRsaW5lX3F1ZXVlX3JlbW92ZShzdHJ1Y3QgbGlz
dF9oZWFkICpxdWV1ZSwgc3RydWN0IGxpc3RfaGVhZCAqZWxlbSkKIHsKLSAgICBpbnQgcG9zID0g
MDsKKyAgICBib29sIGZpcnN0ID0gZmFsc2U7CiAKICAgICBpZiAoIHF1ZXVlLT5uZXh0ICE9IGVs
ZW0gKQotICAgICAgICBwb3MgPSAxOworICAgICAgICBmaXJzdCA9IHRydWU7CiAKICAgICBsaXN0
X2RlbF9pbml0KGVsZW0pOwotICAgIHJldHVybiAhcG9zOworICAgIHJldHVybiAhZmlyc3Q7CiB9
CiAKIHN0YXRpYyBpbmxpbmUgYm9vbApAQCAtNTA1LDE3ICs1MDUsMTcgQEAgZGVhZGxpbmVfcXVl
dWVfaW5zZXJ0KHN0cnVjdCBydF91bml0ICogKCpxZWxlbSkoc3RydWN0IGxpc3RfaGVhZCAqKSwK
ICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgbGlzdF9oZWFkICpxdWV1ZSkKIHsKICAgICBz
dHJ1Y3QgbGlzdF9oZWFkICppdGVyOwotICAgIGludCBwb3MgPSAwOworICAgIGJvb2wgZmlyc3Qg
PSB0cnVlOwogCiAgICAgbGlzdF9mb3JfZWFjaCAoIGl0ZXIsIHF1ZXVlICkKICAgICB7CiAgICAg
ICAgIHN0cnVjdCBydF91bml0ICogaXRlcl9zdmMgPSAoKnFlbGVtKShpdGVyKTsKICAgICAgICAg
aWYgKCBjb21wYXJlX3VuaXRfcHJpb3JpdHkoc3ZjLCBpdGVyX3N2YykgPiAwICkKICAgICAgICAg
ICAgIGJyZWFrOwotICAgICAgICBwb3MrKzsKKyAgICAgICAgZmlyc3QgPSBmYWxzZTsKICAgICB9
CiAgICAgbGlzdF9hZGRfdGFpbChlbGVtLCBpdGVyKTsKLSAgICByZXR1cm4gIXBvczsKKyAgICBy
ZXR1cm4gZmlyc3Q7CiB9CiAjZGVmaW5lIGRlYWRsaW5lX3J1bnFfaW5zZXJ0KC4uLikgXAogICBk
ZWFkbGluZV9xdWV1ZV9pbnNlcnQoJnFfZWxlbSwgIyNfX1ZBX0FSR1NfXykKQEAgLTYwNSw3ICs2
MDUsNyBAQCByZXBscV9yZWluc2VydChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVj
dCBydF91bml0ICpzdmMpCiB7CiAgICAgc3RydWN0IGxpc3RfaGVhZCAqcmVwbHEgPSBydF9yZXBs
cShvcHMpOwogICAgIHN0cnVjdCBydF91bml0ICpyZWFybV9zdmMgPSBzdmM7Ci0gICAgYm9vbF90
IHJlYXJtID0gMDsKKyAgICBib29sIHJlYXJtID0gZmFsc2U7CiAKICAgICBBU1NFUlQoIHVuaXRf
b25fcmVwbHEoc3ZjKSApOwogCkBAIC02MjIsNyArNjIyLDcgQEAgcmVwbHFfcmVpbnNlcnQoY29u
c3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgcnRfdW5pdCAqc3ZjKQogICAgIHsKICAg
ICAgICAgZGVhZGxpbmVfcmVwbHFfaW5zZXJ0KHN2YywgJnN2Yy0+cmVwbHFfZWxlbSwgcmVwbHEp
OwogICAgICAgICByZWFybV9zdmMgPSByZXBscV9lbGVtKHJlcGxxLT5uZXh0KTsKLSAgICAgICAg
cmVhcm0gPSAxOworICAgICAgICByZWFybSA9IHRydWU7CiAgICAgfQogICAgIGVsc2UKICAgICAg
ICAgcmVhcm0gPSBkZWFkbGluZV9yZXBscV9pbnNlcnQoc3ZjLCAmc3ZjLT5yZXBscV9lbGVtLCBy
ZXBscSk7CkBAIC0xMjc5LDcgKzEyNzksNyBAQCBydF91bml0X3dha2UoY29uc3Qgc3RydWN0IHNj
aGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIHsKICAgICBzdHJ1Y3QgcnRf
dW5pdCAqIGNvbnN0IHN2YyA9IHJ0X3VuaXQodW5pdCk7CiAgICAgc190aW1lX3Qgbm93OwotICAg
IGJvb2xfdCBtaXNzZWQ7CisgICAgYm9vbCBtaXNzZWQ7CiAKICAgICBCVUdfT04oIGlzX2lkbGVf
dW5pdCh1bml0KSApOwogCmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaCBiL3hl
bi9pbmNsdWRlL3hlbi9zY2hlZC5oCmluZGV4IGI0YzJlNGY3YzIuLmQ4ZTk2MTA5NWYgMTAwNjQ0
Ci0tLSBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCisrKyBiL3hlbi9pbmNsdWRlL3hlbi9zY2hl
ZC5oCkBAIC01NjAsMTggKzU2MCwxOCBAQCBzdGF0aWMgaW5saW5lIGJvb2wgaXNfc3lzdGVtX2Rv
bWFpbihjb25zdCBzdHJ1Y3QgZG9tYWluICpkKQogICogVXNlIHRoaXMgd2hlbiB5b3UgZG9uJ3Qg
aGF2ZSBhbiBleGlzdGluZyByZWZlcmVuY2UgdG8gQGQuIEl0IHJldHVybnMKICAqIEZBTFNFIGlm
IEBkIGlzIGJlaW5nIGRlc3Ryb3llZC4KICAqLwotc3RhdGljIGFsd2F5c19pbmxpbmUgaW50IGdl
dF9kb21haW4oc3RydWN0IGRvbWFpbiAqZCkKK3N0YXRpYyBhbHdheXNfaW5saW5lIGJvb2wgZ2V0
X2RvbWFpbihzdHJ1Y3QgZG9tYWluICpkKQogewogICAgIGludCBvbGQsIHNlZW4gPSBhdG9taWNf
cmVhZCgmZC0+cmVmY250KTsKICAgICBkbwogICAgIHsKICAgICAgICAgb2xkID0gc2VlbjsKICAg
ICAgICAgaWYgKCB1bmxpa2VseShvbGQgJiBET01BSU5fREVTVFJPWUVEKSApCi0gICAgICAgICAg
ICByZXR1cm4gMDsKKyAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgc2VlbiA9IGF0
b21pY19jbXB4Y2hnKCZkLT5yZWZjbnQsIG9sZCwgb2xkICsgMSk7CiAgICAgfQogICAgIHdoaWxl
ICggdW5saWtlbHkoc2VlbiAhPSBvbGQpICk7Ci0gICAgcmV0dXJuIDE7CisgICAgcmV0dXJuIHRy
dWU7CiB9CiAKIC8qCi0tIAoyLjE2LjQKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54
ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGlu
Zm8veGVuLWRldmVs

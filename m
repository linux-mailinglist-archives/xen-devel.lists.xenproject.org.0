Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 9590D14CF59
	for <lists+xen-devel@lfdr.de>; Wed, 29 Jan 2020 18:13:22 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iwqrg-0006KY-Mx; Wed, 29 Jan 2020 17:10:56 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=xIWx=3S=amazon.co.uk=prvs=2906e62af=pdurrant@srs-us1.protection.inumbo.net>)
 id 1iwqrf-0006KP-3i
 for xen-devel@lists.xenproject.org; Wed, 29 Jan 2020 17:10:55 +0000
X-Inumbo-ID: 4ecc7432-42ba-11ea-a933-bc764e2007e4
Received: from smtp-fw-9102.amazon.com (unknown [207.171.184.29])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 4ecc7432-42ba-11ea-a933-bc764e2007e4;
 Wed, 29 Jan 2020 17:10:54 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amazon.com; i=@amazon.com; q=dns/txt; s=amazon201209;
 t=1580317855; x=1611853855;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=8c5ERSVSHTbXYDRSfW5NraYwBUPt1wDLT2y/xF2VfsI=;
 b=nAc9lp/xB6lms8OMOhEFoCAPlriEZCp9MOF+dNySG27upuOoe0fJDaRm
 vG0tbu7q6Gw05hI8mkA9RSi/NviNHd04MIp3nWfpZ6QdPU1kPRwd3bul7
 ngR4a2qMzusf8hIbfCMcZ5KCKELKC4Est+KgiddGTBKKx4lSR7A5oOAtk 0=;
IronPort-SDR: 4rN7P5YIcOcShi60KgezKryEltXx4dyjakZwQ3OSrqbE99hyF6tuJgbcItPw8YxJqgoWikimjp
 npxvEF6+lUBg==
X-IronPort-AV: E=Sophos;i="5.70,378,1574121600"; d="scan'208";a="21841749"
Received: from sea32-co-svc-lb4-vlan3.sea.corp.amazon.com (HELO
 email-inbound-relay-2c-6f38efd9.us-west-2.amazon.com) ([10.47.23.38])
 by smtp-border-fw-out-9102.sea19.amazon.com with ESMTP;
 29 Jan 2020 17:10:43 +0000
Received: from EX13MTAUEA002.ant.amazon.com
 (pdx4-ws-svc-p6-lb7-vlan3.pdx.amazon.com [10.170.41.166])
 by email-inbound-relay-2c-6f38efd9.us-west-2.amazon.com (Postfix) with ESMTPS
 id 949C4A23FE; Wed, 29 Jan 2020 17:10:42 +0000 (UTC)
Received: from EX13D32EUC002.ant.amazon.com (10.43.164.94) by
 EX13MTAUEA002.ant.amazon.com (10.43.61.77) with Microsoft SMTP Server (TLS)
 id 15.0.1236.3; Wed, 29 Jan 2020 17:10:42 +0000
Received: from EX13MTAUWB001.ant.amazon.com (10.43.161.207) by
 EX13D32EUC002.ant.amazon.com (10.43.164.94) with Microsoft SMTP Server (TLS)
 id 15.0.1367.3; Wed, 29 Jan 2020 17:10:41 +0000
Received: from u2f063a87eabd5f.cbg10.amazon.com (10.125.106.135) by
 mail-relay.amazon.com (10.43.161.249) with Microsoft SMTP Server id
 15.0.1367.3 via Frontend Transport; Wed, 29 Jan 2020 17:10:37 +0000
From: Paul Durrant <pdurrant@amazon.com>
To: <xen-devel@lists.xenproject.org>
Date: Wed, 29 Jan 2020 17:10:29 +0000
Message-ID: <20200129171030.1341-3-pdurrant@amazon.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20200129171030.1341-1-pdurrant@amazon.com>
References: <20200129171030.1341-1-pdurrant@amazon.com>
MIME-Version: 1.0
Precedence: Bulk
Subject: [Xen-devel] [PATCH v7 2/3] mm: make pages allocated with
 MEMF_no_refcount safe to assign
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Stefano Stabellini <sstabellini@kernel.org>, Julien Grall <julien@xen.org>,
 Wei Liu <wl@xen.org>, Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>, Paul Durrant <pdurrant@amazon.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>,
 Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

Q3VycmVudGx5IGl0IGlzIHVuc2FmZSB0byBhc3NpZ24gYSBkb21oZWFwIHBhZ2UgYWxsb2NhdGVk
IHdpdGgKTUVNRl9ub19yZWZjb3VudCB0byBhIGRvbWFpbiBiZWNhdXNlIHRoZSBkb21haW4ndCAn
dG90X3BhZ2VzJyB3aWxsIG5vdApiZSBpbmNyZW1lbnRlZCwgYnV0IHdpbGwgYmUgZGVjcmVtZW50
IHdoZW4gdGhlIHBhZ2UgaXMgZnJlZWQgKHNpbmNlCmZyZWVfZG9taGVhcF9wYWdlcygpIGhhcyBu
byB3YXkgb2YgdGVsbGluZyB0aGF0IHRoZSBpbmNyZW1lbnQgd2FzIHNraXBwZWQpLgoKVGhpcyBw
YXRjaCBhbGxvY2F0ZXMgYSBuZXcgJ2NvdW50X2luZm8nIGJpdCBmb3IgYSBQR0NfZXh0cmEgZmxh
Zwp3aGljaCBpcyB0aGVuIHVzZWQgdG8gbWFyayBwYWdlcyB3aGVuIGFsbG9jX2RvbWhlYXBfcGFn
ZXMoKSBpcyBjYWxsZWQKd2l0aCBNRU1GX25vX3JlZmNvdW50LiBUaGUgTUVNRl9ub19yZWZjb3Vu
dCBpcyAqbm90KiBwYXNzZWQgdGhyb3VnaCB0bwphc3NpZ25fcGFnZXMoKSBiZWNhdXNlIGl0IHN0
aWxsIG5lZWRzIHRvIGNhbGwgZG9tYWluX2FkanVzdF90b3RfcGFnZXMoKSB0bwptYWtlIHN1cmUg
dGhlIGRvbWFpbiBpcyBhcHByb3ByaWF0ZWx5IHJlZmVyZW5jZWQuIGFzc2lnbl9wYWdlcygpIGlz
CmFjY29yZGluZ2x5IG1vZGlmaWVkIHRvIGFjY291bnQgcGFnZXMgbWFya2VkIHdpdGggUEdDX2V4
dHJhIHRvIGFuCidleHRyYV9wYWdlcycgY291bnRlciwgd2hpY2ggaXMgdGhlbiBzdWJ0cmFjdGVk
IGZyb20gJ3RvdF9wYWdlcycgYmVmb3JlIGl0CmlzIGNoZWNrZWQgYWdhaW5zdCAnbWF4X3BhZ2Vz
JywgdGh1cyBhdm9pZGluZyBvdmVyLWFsbG9jYXRpb24gZXJyb3JzLgoKTk9URTogc3RlYWxfcGFn
ZSgpIGlzIGFsc28gbW9kaWZpZWQgdG8gZGVjcmVtZW50IGV4dHJhX3BhZ2VzIGluIHRoZSBjYXNl
IG9mCiAgICAgIGEgUEdDX2V4dHJhIHBhZ2UgYmVpbmcgc3RvbGVuIGZyb20gYSBkb21haW4uCiAg
ICAgIEFsc28sIHdoaWxzdCBhZGRpbmcgdGhlIGV4dHJhX3BhZ2VzIGNvdW50ZXIgaW50byBzdHJ1
Y3QgZG9tYWluLCBtYWtlCiAgICAgIHNvbWUgY29zbWV0aWMgZml4ZXMgdG8gY29tbWVudHMgZm9y
IG5laWdoYm91cmluZyBmaWVsZHMuCgpTaWduZWQtb2ZmLWJ5OiBQYXVsIER1cnJhbnQgPHBkdXJy
YW50QGFtYXpvbi5jb20+Ci0tLQpDYzogQW5kcmV3IENvb3BlciA8YW5kcmV3LmNvb3BlcjNAY2l0
cml4LmNvbT4KQ2M6IEdlb3JnZSBEdW5sYXAgPEdlb3JnZS5EdW5sYXBAZXUuY2l0cml4LmNvbT4K
Q2M6IElhbiBKYWNrc29uIDxpYW4uamFja3NvbkBldS5jaXRyaXguY29tPgpDYzogSmFuIEJldWxp
Y2ggPGpiZXVsaWNoQHN1c2UuY29tPgpDYzogSnVsaWVuIEdyYWxsIDxqdWxpZW5AeGVuLm9yZz4K
Q2M6IEtvbnJhZCBSemVzenV0ZWsgV2lsayA8a29ucmFkLndpbGtAb3JhY2xlLmNvbT4KQ2M6IFN0
ZWZhbm8gU3RhYmVsbGluaSA8c3N0YWJlbGxpbmlAa2VybmVsLm9yZz4KQ2M6IFdlaSBMaXUgPHds
QHhlbi5vcmc+CkNjOiBWb2xvZHlteXIgQmFiY2h1ayA8Vm9sb2R5bXlyX0JhYmNodWtAZXBhbS5j
b20+CkNjOiAiUm9nZXIgUGF1IE1vbm7DqSIgPHJvZ2VyLnBhdUBjaXRyaXguY29tPgoKdjc6CiAt
IHMvUEdDX25vX3JlZmNvdW50L1BHQ19leHRyYS9nCiAtIFJlLXdvcmsgYWxsb2NhdGlvbiB0byBh
Y2NvdW50IGZvciAnZXh0cmEnIHBhZ2VzLCBhbHNvIG1ha2luZyBpdAogICBzYWZlIHRvIGFzc2ln
biBQR0NfZXh0cmEgcGFnZXMgcG9zdC1hbGxvY2F0aW9uCgp2NjoKIC0gQWRkIGFuIGV4dHJhIEFT
U0VSVCBpbnRvIGFzc2lnbl9wYWdlcygpIHRoYXQgUEdDX25vX3JlZmNvdW50IGlzIG5vdAogICBz
ZXQgaWYgTUVNRl9ub19yZWZjb3VudCBpcyBjbGVhcgogLSBBU1NFUlQgdGhhdCBjb3VudF9pbmZv
IGlzIDAgaW4gYWxsb2NfZG9taGVhcF9wYWdlcygpIGFuZCBzZXQgdG8KICAgUEdDX25vX3JlZmNv
dW50IHJhdGhlciB0aGFuIE9SaW5nCgp2NToKIC0gTWFrZSBzdXJlIFBHQ19ub19yZWZjb3VudCBp
cyBzZXQgYmVmb3JlIGFzc2lnbl9wYWdlcygpIGlzIGNhbGxlZAogLSBEb24ndCBib3RoZXIgdG8g
Y2xlYXIgUEdDX25vX3JlZmNvdW50IGluIGZyZWVfZG9taGVhcF9wYWdlcygpIGFuZAogICBkcm9w
IEFTU0VSVCBpbiBmcmVlX2hlYXBfcGFnZXMoKQogLSBEb24ndCBsYXRjaCBjb3VudF9pbmZvIGlu
IGZyZWVfaGVhcF9wYWdlcygpCgp2NDoKIC0gTmV3IGluIHY0Ci0tLQogeGVuL2FyY2gveDg2L21t
LmMgICAgICAgIHwgIDUgKysrKwogeGVuL2NvbW1vbi9wYWdlX2FsbG9jLmMgIHwgNDkgKysrKysr
KysrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLQogeGVuL2luY2x1ZGUvYXNtLWFybS9t
bS5oIHwgIDUgKysrLQogeGVuL2luY2x1ZGUvYXNtLXg4Ni9tbS5oIHwgIDcgKysrKy0tCiB4ZW4v
aW5jbHVkZS94ZW4vc2NoZWQuaCAgfCAxOCArKysrKysrKy0tLS0tLS0KIDUgZmlsZXMgY2hhbmdl
ZCwgNjAgaW5zZXJ0aW9ucygrKSwgMjQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEveGVuL2Fy
Y2gveDg2L21tLmMgYi94ZW4vYXJjaC94ODYvbW0uYwppbmRleCBmNTBjMDY1YWYzLi41YjA0ZGI4
YzIxIDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYvbW0uYworKysgYi94ZW4vYXJjaC94ODYvbW0u
YwpAQCAtNDI2Niw2ICs0MjY2LDExIEBAIGludCBzdGVhbF9wYWdlKAogICAgIHBhZ2VfbGlzdF9k
ZWwocGFnZSwgJmQtPnBhZ2VfbGlzdCk7CiAKICAgICAvKiBVbmxpbmsgZnJvbSBvcmlnaW5hbCBv
d25lci4gKi8KKyAgICBpZiAoIHBhZ2UtPmNvdW50X2luZm8gJiBQR0NfZXh0cmEgKQorICAgIHsK
KyAgICAgICAgQVNTRVJUKGQtPmV4dHJhX3BhZ2VzKTsKKyAgICAgICAgZC0+ZXh0cmFfcGFnZXMt
LTsKKyAgICB9CiAgICAgaWYgKCAhKG1lbWZsYWdzICYgTUVNRl9ub19yZWZjb3VudCkgJiYgIWRv
bWFpbl9hZGp1c3RfdG90X3BhZ2VzKGQsIC0xKSApCiAgICAgICAgIGRyb3BfZG9tX3JlZiA9IHRy
dWU7CiAKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vcGFnZV9hbGxvYy5jIGIveGVuL2NvbW1vbi9w
YWdlX2FsbG9jLmMKaW5kZXggOTE5YTI3MDU4Ny4uYTJkNjlmMjIyYSAxMDA2NDQKLS0tIGEveGVu
L2NvbW1vbi9wYWdlX2FsbG9jLmMKKysrIGIveGVuL2NvbW1vbi9wYWdlX2FsbG9jLmMKQEAgLTIy
NTYsNiArMjI1Niw3IEBAIGludCBhc3NpZ25fcGFnZXMoCiB7CiAgICAgaW50IHJjID0gMDsKICAg
ICB1bnNpZ25lZCBsb25nIGk7CisgICAgdW5zaWduZWQgaW50IGV4dHJhX3BhZ2VzID0gMDsKIAog
ICAgIHNwaW5fbG9jaygmZC0+cGFnZV9hbGxvY19sb2NrKTsKIApAQCAtMjI2NywxMyArMjI2OCwx
OSBAQCBpbnQgYXNzaWduX3BhZ2VzKAogICAgICAgICBnb3RvIG91dDsKICAgICB9CiAKKyAgICBm
b3IgKCBpID0gMDsgaSA8ICgxIDw8IG9yZGVyKTsgaSsrICkKKyAgICAgICAgaWYgKCBwZ1tpXS5j
b3VudF9pbmZvICYgUEdDX2V4dHJhICkKKyAgICAgICAgICAgIGV4dHJhX3BhZ2VzKys7CisKICAg
ICBpZiAoICEobWVtZmxhZ3MgJiBNRU1GX25vX3JlZmNvdW50KSApCiAgICAgewotICAgICAgICBp
ZiAoIHVubGlrZWx5KChkLT50b3RfcGFnZXMgKyAoMSA8PCBvcmRlcikpID4gZC0+bWF4X3BhZ2Vz
KSApCisgICAgICAgIHVuc2lnbmVkIGludCBtYXhfcGFnZXMgPSBkLT5tYXhfcGFnZXMgLSBkLT5l
eHRyYV9wYWdlcyAtIGV4dHJhX3BhZ2VzOworCisgICAgICAgIGlmICggdW5saWtlbHkoKGQtPnRv
dF9wYWdlcyArICgxIDw8IG9yZGVyKSkgPiBtYXhfcGFnZXMpICkKICAgICAgICAgewogICAgICAg
ICAgICAgZ3ByaW50ayhYRU5MT0dfSU5GTywgIk92ZXItYWxsb2NhdGlvbiBmb3IgZG9tYWluICV1
OiAiCiAgICAgICAgICAgICAgICAgICAgICIldSA+ICV1XG4iLCBkLT5kb21haW5faWQsCi0gICAg
ICAgICAgICAgICAgICAgIGQtPnRvdF9wYWdlcyArICgxIDw8IG9yZGVyKSwgZC0+bWF4X3BhZ2Vz
KTsKKyAgICAgICAgICAgICAgICAgICAgZC0+dG90X3BhZ2VzICsgKDEgPDwgb3JkZXIpLCBtYXhf
cGFnZXMpOwogICAgICAgICAgICAgcmMgPSAtRTJCSUc7CiAgICAgICAgICAgICBnb3RvIG91dDsK
ICAgICAgICAgfQpAQCAtMjI4MiwxMyArMjI4OSwxNyBAQCBpbnQgYXNzaWduX3BhZ2VzKAogICAg
ICAgICAgICAgZ2V0X2tub3duYWxpdmVfZG9tYWluKGQpOwogICAgIH0KIAorICAgIGQtPmV4dHJh
X3BhZ2VzICs9IGV4dHJhX3BhZ2VzOwogICAgIGZvciAoIGkgPSAwOyBpIDwgKDEgPDwgb3JkZXIp
OyBpKysgKQogICAgIHsKKyAgICAgICAgdW5zaWduZWQgbG9uZyBjb3VudF9pbmZvID0gcGdbaV0u
Y291bnRfaW5mbzsKKwogICAgICAgICBBU1NFUlQocGFnZV9nZXRfb3duZXIoJnBnW2ldKSA9PSBO
VUxMKTsKLSAgICAgICAgQVNTRVJUKCFwZ1tpXS5jb3VudF9pbmZvKTsKKyAgICAgICAgQVNTRVJU
KCEoY291bnRfaW5mbyAmIH5QR0NfZXh0cmEpKTsKICAgICAgICAgcGFnZV9zZXRfb3duZXIoJnBn
W2ldLCBkKTsKICAgICAgICAgc21wX3dtYigpOyAvKiBEb21haW4gcG9pbnRlciBtdXN0IGJlIHZp
c2libGUgYmVmb3JlIHVwZGF0aW5nIHJlZmNudC4gKi8KLSAgICAgICAgcGdbaV0uY291bnRfaW5m
byA9IFBHQ19hbGxvY2F0ZWQgfCAxOworICAgICAgICBjb3VudF9pbmZvICY9IFBHQ19leHRyYTsK
KyAgICAgICAgcGdbaV0uY291bnRfaW5mbyA9IGNvdW50X2luZm8gfCBQR0NfYWxsb2NhdGVkIHwg
MTsKICAgICAgICAgcGFnZV9saXN0X2FkZF90YWlsKCZwZ1tpXSwgJmQtPnBhZ2VfbGlzdCk7CiAg
ICAgfQogCkBAIC0yMzE0LDExICsyMzI1LDYgQEAgc3RydWN0IHBhZ2VfaW5mbyAqYWxsb2NfZG9t
aGVhcF9wYWdlcygKIAogICAgIGlmICggbWVtZmxhZ3MgJiBNRU1GX25vX293bmVyICkKICAgICAg
ICAgbWVtZmxhZ3MgfD0gTUVNRl9ub19yZWZjb3VudDsKLSAgICBlbHNlIGlmICggKG1lbWZsYWdz
ICYgTUVNRl9ub19yZWZjb3VudCkgJiYgZCApCi0gICAgewotICAgICAgICBBU1NFUlQoIShtZW1m
bGFncyAmIE1FTUZfbm9fcmVmY291bnQpKTsKLSAgICAgICAgcmV0dXJuIE5VTEw7Ci0gICAgfQog
CiAgICAgaWYgKCAhZG1hX2JpdHNpemUgKQogICAgICAgICBtZW1mbGFncyAmPSB+TUVNRl9ub19k
bWE7CkBAIC0yMzMxLDExICsyMzM3LDIzIEBAIHN0cnVjdCBwYWdlX2luZm8gKmFsbG9jX2RvbWhl
YXBfcGFnZXMoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVtZmxhZ3MsIGQp
KSA9PSBOVUxMKSkgKQogICAgICAgICAgcmV0dXJuIE5VTEw7CiAKLSAgICBpZiAoIGQgJiYgISht
ZW1mbGFncyAmIE1FTUZfbm9fb3duZXIpICYmCi0gICAgICAgICBhc3NpZ25fcGFnZXMoZCwgcGcs
IG9yZGVyLCBtZW1mbGFncykgKQorICAgIGlmICggZCAmJiAhKG1lbWZsYWdzICYgTUVNRl9ub19v
d25lcikgKQogICAgIHsKLSAgICAgICAgZnJlZV9oZWFwX3BhZ2VzKHBnLCBvcmRlciwgbWVtZmxh
Z3MgJiBNRU1GX25vX3NjcnViKTsKLSAgICAgICAgcmV0dXJuIE5VTEw7CisgICAgICAgIGlmICgg
bWVtZmxhZ3MgJiBNRU1GX25vX3JlZmNvdW50ICkKKyAgICAgICAgeworICAgICAgICAgICAgdW5z
aWduZWQgbG9uZyBpOworCisgICAgICAgICAgICBmb3IgKCBpID0gMDsgaSA8ICgxdWwgPDwgb3Jk
ZXIpOyBpKysgKQorICAgICAgICAgICAgeworICAgICAgICAgICAgICAgIEFTU0VSVCghcGdbaV0u
Y291bnRfaW5mbyk7CisgICAgICAgICAgICAgICAgcGdbaV0uY291bnRfaW5mbyA9IFBHQ19leHRy
YTsKKyAgICAgICAgICAgIH0KKyAgICAgICAgfQorICAgICAgICBpZiAoIGFzc2lnbl9wYWdlcyhk
LCBwZywgb3JkZXIsIG1lbWZsYWdzICYgfk1FTUZfbm9fcmVmY291bnQpICkKKyAgICAgICAgewor
ICAgICAgICAgICAgZnJlZV9oZWFwX3BhZ2VzKHBnLCBvcmRlciwgbWVtZmxhZ3MgJiBNRU1GX25v
X3NjcnViKTsKKyAgICAgICAgICAgIHJldHVybiBOVUxMOworICAgICAgICB9CiAgICAgfQogCiAg
ICAgcmV0dXJuIHBnOwpAQCAtMjM4Myw2ICsyNDAxLDExIEBAIHZvaWQgZnJlZV9kb21oZWFwX3Bh
Z2VzKHN0cnVjdCBwYWdlX2luZm8gKnBnLCB1bnNpZ25lZCBpbnQgb3JkZXIpCiAgICAgICAgICAg
ICAgICAgICAgIEJVRygpOwogICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICBhcmNo
X2ZyZWVfaGVhcF9wYWdlKGQsICZwZ1tpXSk7CisgICAgICAgICAgICAgICAgaWYgKCBwZ1tpXS5j
b3VudF9pbmZvICYgUEdDX2V4dHJhICkKKyAgICAgICAgICAgICAgICB7CisgICAgICAgICAgICAg
ICAgICAgIEFTU0VSVChkLT5leHRyYV9wYWdlcyk7CisgICAgICAgICAgICAgICAgICAgIGQtPmV4
dHJhX3BhZ2VzLS07CisgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgfQogCiAgICAgICAg
ICAgICBkcm9wX2RvbV9yZWYgPSAhZG9tYWluX2FkanVzdF90b3RfcGFnZXMoZCwgLSgxIDw8IG9y
ZGVyKSk7CmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS9hc20tYXJtL21tLmggYi94ZW4vaW5jbHVk
ZS9hc20tYXJtL21tLmgKaW5kZXggMzMzZWZkM2E2MC4uN2RmOTEyODBiYyAxMDA2NDQKLS0tIGEv
eGVuL2luY2x1ZGUvYXNtLWFybS9tbS5oCisrKyBiL3hlbi9pbmNsdWRlL2FzbS1hcm0vbW0uaApA
QCAtMTE5LDkgKzExOSwxMiBAQCBzdHJ1Y3QgcGFnZV9pbmZvCiAjZGVmaW5lIFBHQ19zdGF0ZV9v
ZmZsaW5lZCBQR19tYXNrKDIsIDkpCiAjZGVmaW5lIFBHQ19zdGF0ZV9mcmVlICAgIFBHX21hc2so
MywgOSkKICNkZWZpbmUgcGFnZV9zdGF0ZV9pcyhwZywgc3QpICgoKHBnKS0+Y291bnRfaW5mbyZQ
R0Nfc3RhdGUpID09IFBHQ19zdGF0ZV8jI3N0KQorLyogUGFnZSBpcyBub3QgcmVmZXJlbmNlIGNv
dW50ZWQgKi8KKyNkZWZpbmUgX1BHQ19leHRyYSAgICAgICAgUEdfc2hpZnQoMTApCisjZGVmaW5l
IFBHQ19leHRyYSAgICAgICAgIFBHX21hc2soMSwgMTApCiAKIC8qIENvdW50IG9mIHJlZmVyZW5j
ZXMgdG8gdGhpcyBmcmFtZS4gKi8KLSNkZWZpbmUgUEdDX2NvdW50X3dpZHRoICAgUEdfc2hpZnQo
OSkKKyNkZWZpbmUgUEdDX2NvdW50X3dpZHRoICAgUEdfc2hpZnQoMTApCiAjZGVmaW5lIFBHQ19j
b3VudF9tYXNrICAgICgoMVVMPDxQR0NfY291bnRfd2lkdGgpLTEpCiAKIC8qCmRpZmYgLS1naXQg
YS94ZW4vaW5jbHVkZS9hc20teDg2L21tLmggYi94ZW4vaW5jbHVkZS9hc20teDg2L21tLmgKaW5k
ZXggMmNhODg4MmFkMC4uMDZkNjRkNDk0ZCAxMDA2NDQKLS0tIGEveGVuL2luY2x1ZGUvYXNtLXg4
Ni9tbS5oCisrKyBiL3hlbi9pbmNsdWRlL2FzbS14ODYvbW0uaApAQCAtNzcsOSArNzcsMTIgQEAK
ICNkZWZpbmUgUEdDX3N0YXRlX29mZmxpbmVkIFBHX21hc2soMiwgOSkKICNkZWZpbmUgUEdDX3N0
YXRlX2ZyZWUgICAgUEdfbWFzaygzLCA5KQogI2RlZmluZSBwYWdlX3N0YXRlX2lzKHBnLCBzdCkg
KCgocGcpLT5jb3VudF9pbmZvJlBHQ19zdGF0ZSkgPT0gUEdDX3N0YXRlXyMjc3QpCisvKiBQYWdl
IGlzIG5vdCByZWZlcmVuY2UgY291bnRlZCAqLworI2RlZmluZSBfUEdDX2V4dHJhICAgICAgICBQ
R19zaGlmdCgxMCkKKyNkZWZpbmUgUEdDX2V4dHJhICAgICAgICAgUEdfbWFzaygxLCAxMCkKIAot
IC8qIENvdW50IG9mIHJlZmVyZW5jZXMgdG8gdGhpcyBmcmFtZS4gKi8KLSNkZWZpbmUgUEdDX2Nv
dW50X3dpZHRoICAgUEdfc2hpZnQoOSkKKy8qIENvdW50IG9mIHJlZmVyZW5jZXMgdG8gdGhpcyBm
cmFtZS4gKi8KKyNkZWZpbmUgUEdDX2NvdW50X3dpZHRoICAgUEdfc2hpZnQoMTApCiAjZGVmaW5l
IFBHQ19jb3VudF9tYXNrICAgICgoMVVMPDxQR0NfY291bnRfd2lkdGgpLTEpCiAKIC8qCmRpZmYg
LS1naXQgYS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaCBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5o
CmluZGV4IDdjNWM0MzcyNDcuLjc2M2ZjZDU2YTQgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL3hl
bi9zY2hlZC5oCisrKyBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCkBAIC0zNjEsMTUgKzM2MSwx
NyBAQCBzdHJ1Y3QgZG9tYWluCiAKICAgICBzcGlubG9ja190ICAgICAgIGRvbWFpbl9sb2NrOwog
Ci0gICAgc3BpbmxvY2tfdCAgICAgICBwYWdlX2FsbG9jX2xvY2s7IC8qIHByb3RlY3RzIGFsbCB0
aGUgZm9sbG93aW5nIGZpZWxkcyAgKi8KLSAgICBzdHJ1Y3QgcGFnZV9saXN0X2hlYWQgcGFnZV9s
aXN0OyAgLyogbGlua2VkIGxpc3QgKi8KKyAgICBzcGlubG9ja190ICAgICAgIHBhZ2VfYWxsb2Nf
bG9jazsgICAvKiBwcm90ZWN0cyBhbGwgdGhlIGZvbGxvd2luZyBmaWVsZHMgKi8KKyAgICBzdHJ1
Y3QgcGFnZV9saXN0X2hlYWQgcGFnZV9saXN0OyAgICAvKiBsaW5rZWQgbGlzdCAqLwogICAgIHN0
cnVjdCBwYWdlX2xpc3RfaGVhZCB4ZW5wYWdlX2xpc3Q7IC8qIGxpbmtlZCBsaXN0IChzaXplIHhl
bmhlYXBfcGFnZXMpICovCi0gICAgdW5zaWduZWQgaW50ICAgICB0b3RfcGFnZXM7ICAgICAgIC8q
IG51bWJlciBvZiBwYWdlcyBjdXJyZW50bHkgcG9zc2VzZWQgKi8KLSAgICB1bnNpZ25lZCBpbnQg
ICAgIHhlbmhlYXBfcGFnZXM7ICAgLyogIyBwYWdlcyBhbGxvY2F0ZWQgZnJvbSBYZW4gaGVhcCAg
ICAqLwotICAgIHVuc2lnbmVkIGludCAgICAgb3V0c3RhbmRpbmdfcGFnZXM7IC8qIHBhZ2VzIGNs
YWltZWQgYnV0IG5vdCBwb3NzZXNzZWQgICovCi0gICAgdW5zaWduZWQgaW50ICAgICBtYXhfcGFn
ZXM7ICAgICAgIC8qIG1heGltdW0gdmFsdWUgZm9yIHRvdF9wYWdlcyAgICAgICAgKi8KLSAgICBh
dG9taWNfdCAgICAgICAgIHNocl9wYWdlczsgICAgICAgLyogbnVtYmVyIG9mIHNoYXJlZCBwYWdl
cyAgICAgICAgICAgICAqLwotICAgIGF0b21pY190ICAgICAgICAgcGFnZWRfcGFnZXM7ICAgICAv
KiBudW1iZXIgb2YgcGFnZWQtb3V0IHBhZ2VzICAgICAgICAgICovCisgICAgdW5zaWduZWQgaW50
ICAgICB0b3RfcGFnZXM7ICAgICAgICAgLyogbnVtYmVyIG9mIHBhZ2VzIGN1cnJlbnRseSBwb3Nz
ZXNlZCAqLworICAgIHVuc2lnbmVkIGludCAgICAgeGVuaGVhcF9wYWdlczsgICAgIC8qIG51bWJl
ciBvZiBwYWdlcyBmcm9tIFhlbiBoZWFwICovCisgICAgdW5zaWduZWQgaW50ICAgICBvdXRzdGFu
ZGluZ19wYWdlczsgLyogcGFnZXMgY2xhaW1lZCBidXQgbm90IHBvc3Nlc3NlZCAqLworICAgIHVu
c2lnbmVkIGludCAgICAgZXh0cmFfcGFnZXM7ICAgICAgIC8qIGV4dHJhIHBhZ2VzIG5vdCBsaW1p
dGVkIGJ5IG1heF9wYWdlcyAqLworICAgIHVuc2lnbmVkIGludCAgICAgbWF4X3BhZ2VzOyAgICAg
ICAgIC8qIG1heGltdW0gdmFsdWUgZm9yIHRvdF9wYWdlcyBtaW51cyAqLworICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIGV4dHJhX3BhZ2VzICovCisgICAgYXRvbWlj
X3QgICAgICAgICBzaHJfcGFnZXM7ICAgICAgICAgLyogbnVtYmVyIG9mIHNoYXJlZCBwYWdlcyAq
LworICAgIGF0b21pY190ICAgICAgICAgcGFnZWRfcGFnZXM7ICAgICAgIC8qIG51bWJlciBvZiBw
YWdlZC1vdXQgcGFnZXMgKi8KIAogICAgIC8qIFNjaGVkdWxpbmcuICovCiAgICAgdm9pZCAgICAg
ICAgICAgICpzY2hlZF9wcml2OyAgICAvKiBzY2hlZHVsZXItc3BlY2lmaWMgZGF0YSAqLwotLSAK
Mi4yMC4xCgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18K
WGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0
cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

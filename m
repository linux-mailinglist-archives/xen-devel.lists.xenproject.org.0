Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 7F53DBFF93
	for <lists+xen-devel@lfdr.de>; Fri, 27 Sep 2019 09:04:02 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iDkGJ-0003yT-6B; Fri, 27 Sep 2019 07:01:55 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=Rbpq=XW=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1iDkGG-0003vK-Pv
 for xen-devel@lists.xenproject.org; Fri, 27 Sep 2019 07:01:52 +0000
X-Inumbo-ID: 91f3ca12-e0f4-11e9-bf31-bc764e2007e4
Received: from mx1.suse.de (unknown [195.135.220.15])
 by localhost (Halon) with ESMTPS
 id 91f3ca12-e0f4-11e9-bf31-bc764e2007e4;
 Fri, 27 Sep 2019 07:01:04 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 075EBACEF;
 Fri, 27 Sep 2019 07:01:01 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Fri, 27 Sep 2019 09:00:25 +0200
Message-Id: <20190927070050.12405-22-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190927070050.12405-1-jgross@suse.com>
References: <20190927070050.12405-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v4 21/46] xen/sched: use sched_resource cpu
 instead smp_processor_id in schedulers
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Tim Deegan <tim@xen.org>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>,
 Robert VanVossen <robert.vanvossen@dornerworks.com>,
 Dario Faggioli <dfaggioli@suse.com>, Julien Grall <julien.grall@arm.com>,
 Josh Whitehead <josh.whitehead@dornerworks.com>,
 Meng Xu <mengxu@cis.upenn.edu>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

RXNwZWNpYWxseSBpbiB0aGUgZG9fc2NoZWR1bGUoKSBmdW5jdGlvbnMgb2YgdGhlIGRpZmZlcmVu
dCBzY2hlZHVsZXJzCnVzaW5nIHNtcF9wcm9jZXNzb3JfaWQoKSBmb3IgdGhlIGxvY2FsIGNwdSBu
dW1iZXIgaXMgY29ycmVjdCBvbmx5IGlmCnRoZSBzY2hlZF91bml0IGlzIGEgc2luZ2xlIHZjcHUu
IEFzIHNvb24gYXMgbGFyZ2VyIHNjaGVkX3VuaXRzIGFyZQp1c2VkIG1vc3QgdXNlcyBzaG91bGQg
YmUgcmVwbGFjZWQgYnkgdGhlIG1hc3Rlcl9jcHUgbnVtYmVyIG9mIHRoZSBsb2NhbApzY2hlZF9y
ZXNvdXJjZSBpbnN0ZWFkLgoKQWRkIGEgaGVscGVyIHRvIGdldCB0aGF0IHNjaGVkX3Jlc291cmNl
IG1hc3Rlcl9jcHUgYW5kIG1vZGlmeSB0aGUKc2NoZWR1bGVycyB0byB1c2UgaXQgaW4gYSBjb3Jy
ZWN0IHdheS4KClNpZ25lZC1vZmYtYnk6IEp1ZXJnZW4gR3Jvc3MgPGpncm9zc0BzdXNlLmNvbT4K
UmV2aWV3ZWQtYnk6IERhcmlvIEZhZ2dpb2xpIDxkZmFnZ2lvbGlAc3VzZS5jb20+Ci0tLQpWMzoK
LSBzdHlsZSBjb3JyZWN0aW9uIChKYW4gQmV1bGljaCkKLSByZW5hbWUgY3B1IHRvIGN1cl9jcHUg
d2hlbiBpbnRyb2R1Y2luZyBzY2hlZF9jcHUgaW4gc2FtZSBmdW5jdGlvbgogIChKYW4gQmV1bGlj
aCkKLSB1bmRvIGNoYW5nZSBpbiBzY2hlZF9pZGxlX3NjaGVkdWxlKCkgKEphbiBCZXVsaWNoKQpW
NDoKLSBzaW1wbGlmeSB0ZXN0IGZvciBjb3JyZWN0IGNwdSAoSmFuIEJldWxpY2gpCi0tLQogeGVu
L2NvbW1vbi9zY2hlZF9hcmluYzY1My5jIHwgIDIgKy0KIHhlbi9jb21tb24vc2NoZWRfY3JlZGl0
LmMgICB8IDIzICsrKysrKysrKystLS0tLS0tLS0KIHhlbi9jb21tb24vc2NoZWRfY3JlZGl0Mi5j
ICB8IDU1ICsrKysrKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogeGVu
L2NvbW1vbi9zY2hlZF9udWxsLmMgICAgIHwgMjUgKysrKysrKysrKystLS0tLS0tLS0tCiB4ZW4v
Y29tbW9uL3NjaGVkX3J0LmMgICAgICAgfCAxOSArKysrKysrKy0tLS0tLS0tCiB4ZW4vaW5jbHVk
ZS94ZW4vc2NoZWQtaWYuaCAgfCAgNSArKysrKwogNiBmaWxlcyBjaGFuZ2VkLCA2OSBpbnNlcnRp
b25zKCspLCA2MCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3NjaGVkX2Fy
aW5jNjUzLmMgYi94ZW4vY29tbW9uL3NjaGVkX2FyaW5jNjUzLmMKaW5kZXggZjA0ZDljOWNiMS4u
MmJjMTg3YzkyYiAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9zY2hlZF9hcmluYzY1My5jCisrKyBi
L3hlbi9jb21tb24vc2NoZWRfYXJpbmM2NTMuYwpAQCAtNTE5LDcgKzUxOSw3IEBAIGE2NTNzY2hl
ZF9kb19zY2hlZHVsZSgKICAgICBzdGF0aWMgdW5zaWduZWQgaW50IHNjaGVkX2luZGV4ID0gMDsK
ICAgICBzdGF0aWMgc190aW1lX3QgbmV4dF9zd2l0Y2hfdGltZTsKICAgICBhNjUzc2NoZWRfcHJp
dl90ICpzY2hlZF9wcml2ID0gU0NIRURfUFJJVihvcHMpOwotICAgIGNvbnN0IHVuc2lnbmVkIGlu
dCBjcHUgPSBzbXBfcHJvY2Vzc29yX2lkKCk7CisgICAgY29uc3QgdW5zaWduZWQgaW50IGNwdSA9
IHNjaGVkX2dldF9yZXNvdXJjZV9jcHUoc21wX3Byb2Nlc3Nvcl9pZCgpKTsKICAgICB1bnNpZ25l
ZCBsb25nIGZsYWdzOwogCiAgICAgc3Bpbl9sb2NrX2lycXNhdmUoJnNjaGVkX3ByaXYtPmxvY2ss
IGZsYWdzKTsKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0LmMgYi94ZW4vY29t
bW9uL3NjaGVkX2NyZWRpdC5jCmluZGV4IDIxYzNhMDMzYjkuLjdmNmJhMzU3NjYgMTAwNjQ0Ci0t
LSBhL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0LmMKKysrIGIveGVuL2NvbW1vbi9zY2hlZF9jcmVk
aXQuYwpAQCAtMTY4NCw3ICsxNjg0LDcgQEAgY3NjaGVkX2xvYWRfYmFsYW5jZShzdHJ1Y3QgY3Nj
aGVkX3ByaXZhdGUgKnBydiwgaW50IGNwdSwKICAgICBpbnQgcGVlcl9jcHUsIGZpcnN0X2NwdSwg
cGVlcl9ub2RlLCBic3RlcDsKICAgICBpbnQgbm9kZSA9IGNwdV90b19ub2RlKGNwdSk7CiAKLSAg
ICBCVUdfT04oIGNwdSAhPSBzY2hlZF91bml0X21hc3RlcihzbmV4dC0+dW5pdCkgKTsKKyAgICBC
VUdfT04oZ2V0X3NjaGVkX3JlcyhjcHUpICE9IHNuZXh0LT51bml0LT5yZXMpOwogICAgIG9ubGlu
ZSA9IGNwdXBvb2xfb25saW5lX2NwdW1hc2soYyk7CiAKICAgICAvKgpAQCAtMTgyNSw4ICsxODI1
LDkgQEAgc3RhdGljIHN0cnVjdCB0YXNrX3NsaWNlCiBjc2NoZWRfc2NoZWR1bGUoCiAgICAgY29u
c3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzX3RpbWVfdCBub3csIGJvb2xfdCB0YXNrbGV0X3dv
cmtfc2NoZWR1bGVkKQogewotICAgIGNvbnN0IGludCBjcHUgPSBzbXBfcHJvY2Vzc29yX2lkKCk7
Ci0gICAgc3RydWN0IGxpc3RfaGVhZCAqIGNvbnN0IHJ1bnEgPSBSVU5RKGNwdSk7CisgICAgY29u
c3QgdW5zaWduZWQgaW50IGN1cl9jcHUgPSBzbXBfcHJvY2Vzc29yX2lkKCk7CisgICAgY29uc3Qg
dW5zaWduZWQgaW50IHNjaGVkX2NwdSA9IHNjaGVkX2dldF9yZXNvdXJjZV9jcHUoY3VyX2NwdSk7
CisgICAgc3RydWN0IGxpc3RfaGVhZCAqIGNvbnN0IHJ1bnEgPSBSVU5RKHNjaGVkX2NwdSk7CiAg
ICAgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQgPSBjdXJyZW50LT5zY2hlZF91bml0OwogICAgIHN0
cnVjdCBjc2NoZWRfdW5pdCAqIGNvbnN0IHNjdXJyID0gQ1NDSEVEX1VOSVQodW5pdCk7CiAgICAg
c3RydWN0IGNzY2hlZF9wcml2YXRlICpwcnYgPSBDU0NIRURfUFJJVihvcHMpOwpAQCAtMTg0Nyw3
ICsxODQ4LDcgQEAgY3NjaGVkX3NjaGVkdWxlKAogICAgICAgICBzdHJ1Y3QgewogICAgICAgICAg
ICAgdW5zaWduZWQgY3B1OjE2LCB0YXNrbGV0OjgsIGlkbGU6ODsKICAgICAgICAgfSBkOwotICAg
ICAgICBkLmNwdSA9IGNwdTsKKyAgICAgICAgZC5jcHUgPSBjdXJfY3B1OwogICAgICAgICBkLnRh
c2tsZXQgPSB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkOwogICAgICAgICBkLmlkbGUgPSBpc19pZGxl
X3VuaXQodW5pdCk7CiAgICAgICAgIF9fdHJhY2VfdmFyKFRSQ19DU0NIRURfU0NIRURVTEUsIDEs
IHNpemVvZihkKSwKQEAgLTE5MzcsNyArMTkzOCw3IEBAIGNzY2hlZF9zY2hlZHVsZSgKICAgICB7
CiAgICAgICAgIEJVR19PTiggaXNfaWRsZV91bml0KHVuaXQpIHx8IGxpc3RfZW1wdHkocnVucSkg
KTsKICAgICAgICAgLyogQ3VycmVudCBoYXMgYmxvY2tlZC4gVXBkYXRlIHRoZSBydW5uYWJsZSBj
b3VudGVyIGZvciB0aGlzIGNwdS4gKi8KLSAgICAgICAgZGVjX25yX3J1bm5hYmxlKGNwdSk7Cisg
ICAgICAgIGRlY19ucl9ydW5uYWJsZShzY2hlZF9jcHUpOwogICAgIH0KIAogICAgIHNuZXh0ID0g
X19ydW5xX2VsZW0ocnVucS0+bmV4dCk7CkBAIC0xOTQ3LDcgKzE5NDgsNyBAQCBjc2NoZWRfc2No
ZWR1bGUoCiAgICAgaWYgKCB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkICkKICAgICB7CiAgICAgICAg
IFRSQUNFXzBEKFRSQ19DU0NIRURfU0NIRURfVEFTS0xFVCk7Ci0gICAgICAgIHNuZXh0ID0gQ1ND
SEVEX1VOSVQoc2NoZWRfaWRsZV91bml0KGNwdSkpOworICAgICAgICBzbmV4dCA9IENTQ0hFRF9V
TklUKHNjaGVkX2lkbGVfdW5pdChzY2hlZF9jcHUpKTsKICAgICAgICAgc25leHQtPnByaSA9IENT
Q0hFRF9QUklfVFNfQk9PU1Q7CiAgICAgfQogCkBAIC0xOTY3LDcgKzE5NjgsNyBAQCBjc2NoZWRf
c2NoZWR1bGUoCiAgICAgaWYgKCBzbmV4dC0+cHJpID4gQ1NDSEVEX1BSSV9UU19PVkVSICkKICAg
ICAgICAgX19ydW5xX3JlbW92ZShzbmV4dCk7CiAgICAgZWxzZQotICAgICAgICBzbmV4dCA9IGNz
Y2hlZF9sb2FkX2JhbGFuY2UocHJ2LCBjcHUsIHNuZXh0LCAmcmV0Lm1pZ3JhdGVkKTsKKyAgICAg
ICAgc25leHQgPSBjc2NoZWRfbG9hZF9iYWxhbmNlKHBydiwgc2NoZWRfY3B1LCBzbmV4dCwgJnJl
dC5taWdyYXRlZCk7CiAKICAgICAvKgogICAgICAqIFVwZGF0ZSBpZGxlcnMgbWFzayBpZiBuZWNl
c3NhcnkuIFdoZW4gd2UncmUgaWRsaW5nLCBvdGhlciBDUFVzCkBAIC0xOTc1LDEyICsxOTc2LDEy
IEBAIGNzY2hlZF9zY2hlZHVsZSgKICAgICAgKi8KICAgICBpZiAoICF0YXNrbGV0X3dvcmtfc2No
ZWR1bGVkICYmIHNuZXh0LT5wcmkgPT0gQ1NDSEVEX1BSSV9JRExFICkKICAgICB7Ci0gICAgICAg
IGlmICggIWNwdW1hc2tfdGVzdF9jcHUoY3B1LCBwcnYtPmlkbGVycykgKQotICAgICAgICAgICAg
Y3B1bWFza19zZXRfY3B1KGNwdSwgcHJ2LT5pZGxlcnMpOworICAgICAgICBpZiAoICFjcHVtYXNr
X3Rlc3RfY3B1KHNjaGVkX2NwdSwgcHJ2LT5pZGxlcnMpICkKKyAgICAgICAgICAgIGNwdW1hc2tf
c2V0X2NwdShzY2hlZF9jcHUsIHBydi0+aWRsZXJzKTsKICAgICB9Ci0gICAgZWxzZSBpZiAoIGNw
dW1hc2tfdGVzdF9jcHUoY3B1LCBwcnYtPmlkbGVycykgKQorICAgIGVsc2UgaWYgKCBjcHVtYXNr
X3Rlc3RfY3B1KHNjaGVkX2NwdSwgcHJ2LT5pZGxlcnMpICkKICAgICB7Ci0gICAgICAgIGNwdW1h
c2tfY2xlYXJfY3B1KGNwdSwgcHJ2LT5pZGxlcnMpOworICAgICAgICBjcHVtYXNrX2NsZWFyX2Nw
dShzY2hlZF9jcHUsIHBydi0+aWRsZXJzKTsKICAgICB9CiAKICAgICBpZiAoICFpc19pZGxlX3Vu
aXQoc25leHQtPnVuaXQpICkKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0Mi5j
IGIveGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQyLmMKaW5kZXggM2VlNzYzMjNkZi4uYzRjNmM2OWEw
ZSAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQyLmMKKysrIGIveGVuL2NvbW1v
bi9zY2hlZF9jcmVkaXQyLmMKQEAgLTM0NTAsNyArMzQ1MCw4IEBAIHN0YXRpYyBzdHJ1Y3QgdGFz
a19zbGljZQogY3NjaGVkMl9zY2hlZHVsZSgKICAgICBjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpv
cHMsIHNfdGltZV90IG5vdywgYm9vbCB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkKQogewotICAgIGNv
bnN0IGludCBjcHUgPSBzbXBfcHJvY2Vzc29yX2lkKCk7CisgICAgY29uc3QgdW5zaWduZWQgaW50
IGN1cl9jcHUgPSBzbXBfcHJvY2Vzc29yX2lkKCk7CisgICAgY29uc3QgdW5zaWduZWQgaW50IHNj
aGVkX2NwdSA9IHNjaGVkX2dldF9yZXNvdXJjZV9jcHUoY3VyX2NwdSk7CiAgICAgc3RydWN0IGNz
Y2hlZDJfcnVucXVldWVfZGF0YSAqcnFkOwogICAgIHN0cnVjdCBzY2hlZF91bml0ICpjdXJydW5p
dCA9IGN1cnJlbnQtPnNjaGVkX3VuaXQ7CiAgICAgc3RydWN0IGNzY2hlZDJfdW5pdCAqIGNvbnN0
IHNjdXJyID0gY3NjaGVkMl91bml0KGN1cnJ1bml0KTsKQEAgLTM0NjIsMjIgKzM0NjMsMjIgQEAg
Y3NjaGVkMl9zY2hlZHVsZSgKICAgICBTQ0hFRF9TVEFUX0NSQU5LKHNjaGVkdWxlKTsKICAgICBD
U0NIRUQyX1VOSVRfQ0hFQ0soY3VycnVuaXQpOwogCi0gICAgQlVHX09OKCFjcHVtYXNrX3Rlc3Rf
Y3B1KGNwdSwgJmNzY2hlZDJfcHJpdihvcHMpLT5pbml0aWFsaXplZCkpOworICAgIEJVR19PTigh
Y3B1bWFza190ZXN0X2NwdShzY2hlZF9jcHUsICZjc2NoZWQyX3ByaXYob3BzKS0+aW5pdGlhbGl6
ZWQpKTsKIAotICAgIHJxZCA9IGMycnFkKG9wcywgY3B1KTsKLSAgICBCVUdfT04oIWNwdW1hc2tf
dGVzdF9jcHUoY3B1LCAmcnFkLT5hY3RpdmUpKTsKKyAgICBycWQgPSBjMnJxZChvcHMsIHNjaGVk
X2NwdSk7CisgICAgQlVHX09OKCFjcHVtYXNrX3Rlc3RfY3B1KHNjaGVkX2NwdSwgJnJxZC0+YWN0
aXZlKSk7CiAKLSAgICBBU1NFUlQoc3Bpbl9pc19sb2NrZWQoZ2V0X3NjaGVkX3JlcyhjcHUpLT5z
Y2hlZHVsZV9sb2NrKSk7CisgICAgQVNTRVJUKHNwaW5faXNfbG9ja2VkKGdldF9zY2hlZF9yZXMo
c2NoZWRfY3B1KS0+c2NoZWR1bGVfbG9jaykpOwogCiAgICAgQlVHX09OKCFpc19pZGxlX3VuaXQo
Y3VycnVuaXQpICYmIHNjdXJyLT5ycWQgIT0gcnFkKTsKIAogICAgIC8qIENsZWFyICJ0aWNrbGVk
IiBiaXQgbm93IHRoYXQgd2UndmUgYmVlbiBzY2hlZHVsZWQgKi8KLSAgICB0aWNrbGVkID0gY3B1
bWFza190ZXN0X2NwdShjcHUsICZycWQtPnRpY2tsZWQpOworICAgIHRpY2tsZWQgPSBjcHVtYXNr
X3Rlc3RfY3B1KHNjaGVkX2NwdSwgJnJxZC0+dGlja2xlZCk7CiAgICAgaWYgKCB0aWNrbGVkICkK
ICAgICB7Ci0gICAgICAgIF9fY3B1bWFza19jbGVhcl9jcHUoY3B1LCAmcnFkLT50aWNrbGVkKTsK
KyAgICAgICAgX19jcHVtYXNrX2NsZWFyX2NwdShzY2hlZF9jcHUsICZycWQtPnRpY2tsZWQpOwog
ICAgICAgICBjcHVtYXNrX2FuZG5vdChjcHVtYXNrX3NjcmF0Y2gsICZycWQtPmlkbGUsICZycWQt
PnRpY2tsZWQpOwotICAgICAgICBzbXRfaWRsZV9tYXNrX3NldChjcHUsIGNwdW1hc2tfc2NyYXRj
aCwgJnJxZC0+c210X2lkbGUpOworICAgICAgICBzbXRfaWRsZV9tYXNrX3NldChzY2hlZF9jcHUs
IGNwdW1hc2tfc2NyYXRjaCwgJnJxZC0+c210X2lkbGUpOwogICAgIH0KIAogICAgIGlmICggdW5s
aWtlbHkodGJfaW5pdF9kb25lKSApCkBAIC0zNDg2LDExICszNDg3LDExIEBAIGNzY2hlZDJfc2No
ZWR1bGUoCiAgICAgICAgICAgICB1bnNpZ25lZCBjcHU6MTYsIHJxX2lkOjE2OwogICAgICAgICAg
ICAgdW5zaWduZWQgdGFza2xldDo4LCBpZGxlOjgsIHNtdF9pZGxlOjgsIHRpY2tsZWQ6ODsKICAg
ICAgICAgfSBkOwotICAgICAgICBkLmNwdSA9IGNwdTsKLSAgICAgICAgZC5ycV9pZCA9IGMycihj
cHUpOworICAgICAgICBkLmNwdSA9IGN1cl9jcHU7CisgICAgICAgIGQucnFfaWQgPSBjMnIoc2No
ZWRfY3B1KTsKICAgICAgICAgZC50YXNrbGV0ID0gdGFza2xldF93b3JrX3NjaGVkdWxlZDsKICAg
ICAgICAgZC5pZGxlID0gaXNfaWRsZV91bml0KGN1cnJ1bml0KTsKLSAgICAgICAgZC5zbXRfaWRs
ZSA9IGNwdW1hc2tfdGVzdF9jcHUoY3B1LCAmcnFkLT5zbXRfaWRsZSk7CisgICAgICAgIGQuc210
X2lkbGUgPSBjcHVtYXNrX3Rlc3RfY3B1KHNjaGVkX2NwdSwgJnJxZC0+c210X2lkbGUpOwogICAg
ICAgICBkLnRpY2tsZWQgPSB0aWNrbGVkOwogICAgICAgICBfX3RyYWNlX3ZhcihUUkNfQ1NDSEVE
Ml9TQ0hFRFVMRSwgMSwKICAgICAgICAgICAgICAgICAgICAgc2l6ZW9mKGQpLApAQCAtMzUzMCwx
MCArMzUzMSwxMCBAQCBjc2NoZWQyX3NjaGVkdWxlKAogICAgIHsKICAgICAgICAgX19jbGVhcl9i
aXQoX19DU0ZMQUdfdW5pdF95aWVsZCwgJnNjdXJyLT5mbGFncyk7CiAgICAgICAgIHRyYWNlX3Zh
cihUUkNfQ1NDSEVEMl9TQ0hFRF9UQVNLTEVULCAxLCAwLCBOVUxMKTsKLSAgICAgICAgc25leHQg
PSBjc2NoZWQyX3VuaXQoc2NoZWRfaWRsZV91bml0KGNwdSkpOworICAgICAgICBzbmV4dCA9IGNz
Y2hlZDJfdW5pdChzY2hlZF9pZGxlX3VuaXQoc2NoZWRfY3B1KSk7CiAgICAgfQogICAgIGVsc2UK
LSAgICAgICAgc25leHQgPSBydW5xX2NhbmRpZGF0ZShycWQsIHNjdXJyLCBjcHUsIG5vdywgJnNr
aXBwZWRfdW5pdHMpOworICAgICAgICBzbmV4dCA9IHJ1bnFfY2FuZGlkYXRlKHJxZCwgc2N1cnIs
IHNjaGVkX2NwdSwgbm93LCAmc2tpcHBlZF91bml0cyk7CiAKICAgICAvKiBJZiBzd2l0Y2hpbmcg
ZnJvbSBhIG5vbi1pZGxlIHJ1bm5hYmxlIHVuaXQsIHB1dCBpdAogICAgICAqIGJhY2sgb24gdGhl
IHJ1bnF1ZXVlLiAqLwpAQCAtMzU1OCwxMCArMzU1OSwxMCBAQCBjc2NoZWQyX3NjaGVkdWxlKAog
ICAgICAgICB9CiAKICAgICAgICAgLyogQ2xlYXIgdGhlIGlkbGUgbWFzayBpZiBuZWNlc3Nhcnkg
Ki8KLSAgICAgICAgaWYgKCBjcHVtYXNrX3Rlc3RfY3B1KGNwdSwgJnJxZC0+aWRsZSkgKQorICAg
ICAgICBpZiAoIGNwdW1hc2tfdGVzdF9jcHUoc2NoZWRfY3B1LCAmcnFkLT5pZGxlKSApCiAgICAg
ICAgIHsKLSAgICAgICAgICAgIF9fY3B1bWFza19jbGVhcl9jcHUoY3B1LCAmcnFkLT5pZGxlKTsK
LSAgICAgICAgICAgIHNtdF9pZGxlX21hc2tfY2xlYXIoY3B1LCAmcnFkLT5zbXRfaWRsZSk7Cisg
ICAgICAgICAgICBfX2NwdW1hc2tfY2xlYXJfY3B1KHNjaGVkX2NwdSwgJnJxZC0+aWRsZSk7Cisg
ICAgICAgICAgICBzbXRfaWRsZV9tYXNrX2NsZWFyKHNjaGVkX2NwdSwgJnJxZC0+c210X2lkbGUp
OwogICAgICAgICB9CiAKICAgICAgICAgLyoKQEAgLTM1ODAsMTggKzM1ODEsMTggQEAgY3NjaGVk
Ml9zY2hlZHVsZSgKICAgICAgICAgICovCiAgICAgICAgIGlmICggc2tpcHBlZF91bml0cyA9PSAw
ICYmIHNuZXh0LT5jcmVkaXQgPD0gQ1NDSEVEMl9DUkVESVRfUkVTRVQgKQogICAgICAgICB7Ci0g
ICAgICAgICAgICByZXNldF9jcmVkaXQob3BzLCBjcHUsIG5vdywgc25leHQpOwotICAgICAgICAg
ICAgYmFsYW5jZV9sb2FkKG9wcywgY3B1LCBub3cpOworICAgICAgICAgICAgcmVzZXRfY3JlZGl0
KG9wcywgc2NoZWRfY3B1LCBub3csIHNuZXh0KTsKKyAgICAgICAgICAgIGJhbGFuY2VfbG9hZChv
cHMsIHNjaGVkX2NwdSwgbm93KTsKICAgICAgICAgfQogCiAgICAgICAgIHNuZXh0LT5zdGFydF90
aW1lID0gbm93OwogICAgICAgICBzbmV4dC0+dGlja2xlZF9jcHUgPSAtMTsKIAogICAgICAgICAv
KiBTYWZlIGJlY2F1c2UgbG9jayBmb3Igb2xkIHByb2Nlc3NvciBpcyBoZWxkICovCi0gICAgICAg
IGlmICggc2NoZWRfdW5pdF9tYXN0ZXIoc25leHQtPnVuaXQpICE9IGNwdSApCisgICAgICAgIGlm
ICggc2NoZWRfdW5pdF9tYXN0ZXIoc25leHQtPnVuaXQpICE9IHNjaGVkX2NwdSApCiAgICAgICAg
IHsKICAgICAgICAgICAgIHNuZXh0LT5jcmVkaXQgKz0gQ1NDSEVEMl9NSUdSQVRFX0NPTVBFTlNB
VElPTjsKLSAgICAgICAgICAgIHNjaGVkX3NldF9yZXMoc25leHQtPnVuaXQsIGdldF9zY2hlZF9y
ZXMoY3B1KSk7CisgICAgICAgICAgICBzY2hlZF9zZXRfcmVzKHNuZXh0LT51bml0LCBnZXRfc2No
ZWRfcmVzKHNjaGVkX2NwdSkpOwogICAgICAgICAgICAgU0NIRURfU1RBVF9DUkFOSyhtaWdyYXRl
ZCk7CiAgICAgICAgICAgICByZXQubWlncmF0ZWQgPSAxOwogICAgICAgICB9CkBAIC0zNjA0LDE3
ICszNjA1LDE3IEBAIGNzY2hlZDJfc2NoZWR1bGUoCiAgICAgICAgICAqLwogICAgICAgICBpZiAo
IHRhc2tsZXRfd29ya19zY2hlZHVsZWQgKQogICAgICAgICB7Ci0gICAgICAgICAgICBpZiAoIGNw
dW1hc2tfdGVzdF9jcHUoY3B1LCAmcnFkLT5pZGxlKSApCisgICAgICAgICAgICBpZiAoIGNwdW1h
c2tfdGVzdF9jcHUoc2NoZWRfY3B1LCAmcnFkLT5pZGxlKSApCiAgICAgICAgICAgICB7Ci0gICAg
ICAgICAgICAgICAgX19jcHVtYXNrX2NsZWFyX2NwdShjcHUsICZycWQtPmlkbGUpOwotICAgICAg
ICAgICAgICAgIHNtdF9pZGxlX21hc2tfY2xlYXIoY3B1LCAmcnFkLT5zbXRfaWRsZSk7CisgICAg
ICAgICAgICAgICAgX19jcHVtYXNrX2NsZWFyX2NwdShzY2hlZF9jcHUsICZycWQtPmlkbGUpOwor
ICAgICAgICAgICAgICAgIHNtdF9pZGxlX21hc2tfY2xlYXIoc2NoZWRfY3B1LCAmcnFkLT5zbXRf
aWRsZSk7CiAgICAgICAgICAgICB9CiAgICAgICAgIH0KLSAgICAgICAgZWxzZSBpZiAoICFjcHVt
YXNrX3Rlc3RfY3B1KGNwdSwgJnJxZC0+aWRsZSkgKQorICAgICAgICBlbHNlIGlmICggIWNwdW1h
c2tfdGVzdF9jcHUoc2NoZWRfY3B1LCAmcnFkLT5pZGxlKSApCiAgICAgICAgIHsKLSAgICAgICAg
ICAgIF9fY3B1bWFza19zZXRfY3B1KGNwdSwgJnJxZC0+aWRsZSk7CisgICAgICAgICAgICBfX2Nw
dW1hc2tfc2V0X2NwdShzY2hlZF9jcHUsICZycWQtPmlkbGUpOwogICAgICAgICAgICAgY3B1bWFz
a19hbmRub3QoY3B1bWFza19zY3JhdGNoLCAmcnFkLT5pZGxlLCAmcnFkLT50aWNrbGVkKTsKLSAg
ICAgICAgICAgIHNtdF9pZGxlX21hc2tfc2V0KGNwdSwgY3B1bWFza19zY3JhdGNoLCAmcnFkLT5z
bXRfaWRsZSk7CisgICAgICAgICAgICBzbXRfaWRsZV9tYXNrX3NldChzY2hlZF9jcHUsIGNwdW1h
c2tfc2NyYXRjaCwgJnJxZC0+c210X2lkbGUpOwogICAgICAgICB9CiAgICAgICAgIC8qIE1ha2Ug
c3VyZSBhdmdsb2FkIGdldHMgdXBkYXRlZCBwZXJpb2RpY2FsbHkgZXZlbgogICAgICAgICAgKiBp
ZiB0aGVyZSdzIG5vIGFjdGl2aXR5ICovCkBAIC0zNjI0LDcgKzM2MjUsNyBAQCBjc2NoZWQyX3Nj
aGVkdWxlKAogICAgIC8qCiAgICAgICogUmV0dXJuIHRhc2sgdG8gcnVuIG5leHQuLi4KICAgICAg
Ki8KLSAgICByZXQudGltZSA9IGNzY2hlZDJfcnVudGltZShvcHMsIGNwdSwgc25leHQsIG5vdyk7
CisgICAgcmV0LnRpbWUgPSBjc2NoZWQyX3J1bnRpbWUob3BzLCBzY2hlZF9jcHUsIHNuZXh0LCBu
b3cpOwogICAgIHJldC50YXNrID0gc25leHQtPnVuaXQ7CiAKICAgICBDU0NIRUQyX1VOSVRfQ0hF
Q0socmV0LnRhc2spOwpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZF9udWxsLmMgYi94ZW4v
Y29tbW9uL3NjaGVkX251bGwuYwppbmRleCA0YzllZWQ4MWFlLi41MWVkYzNkYmI5IDEwMDY0NAot
LS0gYS94ZW4vY29tbW9uL3NjaGVkX251bGwuYworKysgYi94ZW4vY29tbW9uL3NjaGVkX251bGwu
YwpAQCAtNzg0LDcgKzc4NCw4IEBAIHN0YXRpYyBzdHJ1Y3QgdGFza19zbGljZSBudWxsX3NjaGVk
dWxlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGJvb2xfdCB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkKQogewogICAgIHVu
c2lnbmVkIGludCBiczsKLSAgICBjb25zdCB1bnNpZ25lZCBpbnQgY3B1ID0gc21wX3Byb2Nlc3Nv
cl9pZCgpOworICAgIGNvbnN0IHVuc2lnbmVkIGludCBjdXJfY3B1ID0gc21wX3Byb2Nlc3Nvcl9p
ZCgpOworICAgIGNvbnN0IHVuc2lnbmVkIGludCBzY2hlZF9jcHUgPSBzY2hlZF9nZXRfcmVzb3Vy
Y2VfY3B1KGN1cl9jcHUpOwogICAgIHN0cnVjdCBudWxsX3ByaXZhdGUgKnBydiA9IG51bGxfcHJp
dihvcHMpOwogICAgIHN0cnVjdCBudWxsX3VuaXQgKnd2YzsKICAgICBzdHJ1Y3QgdGFza19zbGlj
ZSByZXQ7CkBAIC03OTgsMTYgKzc5OSwxNiBAQCBzdGF0aWMgc3RydWN0IHRhc2tfc2xpY2UgbnVs
bF9zY2hlZHVsZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAgICAgICAgICAgICB1aW50
MTZfdCB0YXNrbGV0LCBjcHU7CiAgICAgICAgICAgICBpbnQxNl90IHVuaXQsIGRvbTsKICAgICAg
ICAgfSBkOwotICAgICAgICBkLmNwdSA9IGNwdTsKKyAgICAgICAgZC5jcHUgPSBjdXJfY3B1Owog
ICAgICAgICBkLnRhc2tsZXQgPSB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkOwotICAgICAgICBpZiAo
IHBlcl9jcHUobnBjLCBjcHUpLnVuaXQgPT0gTlVMTCApCisgICAgICAgIGlmICggcGVyX2NwdShu
cGMsIHNjaGVkX2NwdSkudW5pdCA9PSBOVUxMICkKICAgICAgICAgewogICAgICAgICAgICAgZC51
bml0ID0gZC5kb20gPSAtMTsKICAgICAgICAgfQogICAgICAgICBlbHNlCiAgICAgICAgIHsKLSAg
ICAgICAgICAgIGQudW5pdCA9IHBlcl9jcHUobnBjLCBjcHUpLnVuaXQtPnVuaXRfaWQ7Ci0gICAg
ICAgICAgICBkLmRvbSA9IHBlcl9jcHUobnBjLCBjcHUpLnVuaXQtPmRvbWFpbi0+ZG9tYWluX2lk
OworICAgICAgICAgICAgZC51bml0ID0gcGVyX2NwdShucGMsIHNjaGVkX2NwdSkudW5pdC0+dW5p
dF9pZDsKKyAgICAgICAgICAgIGQuZG9tID0gcGVyX2NwdShucGMsIHNjaGVkX2NwdSkudW5pdC0+
ZG9tYWluLT5kb21haW5faWQ7CiAgICAgICAgIH0KICAgICAgICAgX190cmFjZV92YXIoVFJDX1NO
VUxMX1NDSEVEVUxFLCAxLCBzaXplb2YoZCksICZkKTsKICAgICB9CkBAIC04MTUsMTAgKzgxNiwx
MCBAQCBzdGF0aWMgc3RydWN0IHRhc2tfc2xpY2UgbnVsbF9zY2hlZHVsZShjb25zdCBzdHJ1Y3Qg
c2NoZWR1bGVyICpvcHMsCiAgICAgaWYgKCB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkICkKICAgICB7
CiAgICAgICAgIHRyYWNlX3ZhcihUUkNfU05VTExfVEFTS0xFVCwgMSwgMCwgTlVMTCk7Ci0gICAg
ICAgIHJldC50YXNrID0gc2NoZWRfaWRsZV91bml0KGNwdSk7CisgICAgICAgIHJldC50YXNrID0g
c2NoZWRfaWRsZV91bml0KHNjaGVkX2NwdSk7CiAgICAgfQogICAgIGVsc2UKLSAgICAgICAgcmV0
LnRhc2sgPSBwZXJfY3B1KG5wYywgY3B1KS51bml0OworICAgICAgICByZXQudGFzayA9IHBlcl9j
cHUobnBjLCBzY2hlZF9jcHUpLnVuaXQ7CiAgICAgcmV0Lm1pZ3JhdGVkID0gMDsKICAgICByZXQu
dGltZSA9IC0xOwogCkBAIC04NDksOSArODUwLDkgQEAgc3RhdGljIHN0cnVjdCB0YXNrX3NsaWNl
IG51bGxfc2NoZWR1bGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAgICAgICAgICAg
ICAgICAgICAgIWhhc19zb2Z0X2FmZmluaXR5KHd2Yy0+dW5pdCkgKQogICAgICAgICAgICAgICAg
ICAgICBjb250aW51ZTsKIAotICAgICAgICAgICAgICAgIGlmICggdW5pdF9jaGVja19hZmZpbml0
eSh3dmMtPnVuaXQsIGNwdSwgYnMpICkKKyAgICAgICAgICAgICAgICBpZiAoIHVuaXRfY2hlY2tf
YWZmaW5pdHkod3ZjLT51bml0LCBzY2hlZF9jcHUsIGJzKSApCiAgICAgICAgICAgICAgICAgewot
ICAgICAgICAgICAgICAgICAgICB1bml0X2Fzc2lnbihwcnYsIHd2Yy0+dW5pdCwgY3B1KTsKKyAg
ICAgICAgICAgICAgICAgICAgdW5pdF9hc3NpZ24ocHJ2LCB3dmMtPnVuaXQsIHNjaGVkX2NwdSk7
CiAgICAgICAgICAgICAgICAgICAgIGxpc3RfZGVsX2luaXQoJnd2Yy0+d2FpdHFfZWxlbSk7CiAg
ICAgICAgICAgICAgICAgICAgIHJldC50YXNrID0gd3ZjLT51bml0OwogICAgICAgICAgICAgICAg
ICAgICBnb3RvIHVubG9jazsKQEAgLTg2MSwxMiArODYyLDEyIEBAIHN0YXRpYyBzdHJ1Y3QgdGFz
a19zbGljZSBudWxsX3NjaGVkdWxlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKICB1bmxv
Y2s6CiAgICAgICAgIHNwaW5fdW5sb2NrKCZwcnYtPndhaXRxX2xvY2spOwogCi0gICAgICAgIGlm
ICggcmV0LnRhc2sgPT0gTlVMTCAmJiAhY3B1bWFza190ZXN0X2NwdShjcHUsICZwcnYtPmNwdXNf
ZnJlZSkgKQotICAgICAgICAgICAgY3B1bWFza19zZXRfY3B1KGNwdSwgJnBydi0+Y3B1c19mcmVl
KTsKKyAgICAgICAgaWYgKCByZXQudGFzayA9PSBOVUxMICYmICFjcHVtYXNrX3Rlc3RfY3B1KHNj
aGVkX2NwdSwgJnBydi0+Y3B1c19mcmVlKSApCisgICAgICAgICAgICBjcHVtYXNrX3NldF9jcHUo
c2NoZWRfY3B1LCAmcHJ2LT5jcHVzX2ZyZWUpOwogICAgIH0KIAogICAgIGlmICggdW5saWtlbHko
cmV0LnRhc2sgPT0gTlVMTCB8fCAhdW5pdF9ydW5uYWJsZShyZXQudGFzaykpICkKLSAgICAgICAg
cmV0LnRhc2sgPSBzY2hlZF9pZGxlX3VuaXQoY3B1KTsKKyAgICAgICAgcmV0LnRhc2sgPSBzY2hl
ZF9pZGxlX3VuaXQoc2NoZWRfY3B1KTsKIAogICAgIE5VTExfVU5JVF9DSEVDSyhyZXQudGFzayk7
CiAgICAgcmV0dXJuIHJldDsKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vc2NoZWRfcnQuYyBiL3hl
bi9jb21tb24vc2NoZWRfcnQuYwppbmRleCAzZTg4NTJjMzQ4Li4xNTEzNTNiOWEwIDEwMDY0NAot
LS0gYS94ZW4vY29tbW9uL3NjaGVkX3J0LmMKKysrIGIveGVuL2NvbW1vbi9zY2hlZF9ydC5jCkBA
IC0xMDU2LDcgKzEwNTYsOCBAQCBydW5xX3BpY2soY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3Bz
LCBjb25zdCBjcHVtYXNrX3QgKm1hc2spCiBzdGF0aWMgc3RydWN0IHRhc2tfc2xpY2UKIHJ0X3Nj
aGVkdWxlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc190aW1lX3Qgbm93LCBib29sX3Qg
dGFza2xldF93b3JrX3NjaGVkdWxlZCkKIHsKLSAgICBjb25zdCBpbnQgY3B1ID0gc21wX3Byb2Nl
c3Nvcl9pZCgpOworICAgIGNvbnN0IHVuc2lnbmVkIGludCBjdXJfY3B1ID0gc21wX3Byb2Nlc3Nv
cl9pZCgpOworICAgIGNvbnN0IHVuc2lnbmVkIGludCBzY2hlZF9jcHUgPSBzY2hlZF9nZXRfcmVz
b3VyY2VfY3B1KGN1cl9jcHUpOwogICAgIHN0cnVjdCBydF9wcml2YXRlICpwcnYgPSBydF9wcml2
KG9wcyk7CiAgICAgc3RydWN0IHJ0X3VuaXQgKmNvbnN0IHNjdXJyID0gcnRfdW5pdChjdXJyZW50
LT5zY2hlZF91bml0KTsKICAgICBzdHJ1Y3QgcnRfdW5pdCAqc25leHQgPSBOVUxMOwpAQCAtMTA2
OCw5ICsxMDY5LDkgQEAgcnRfc2NoZWR1bGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBz
X3RpbWVfdCBub3csIGJvb2xfdCB0YXNrbGV0X3dvcmtfc2NoZWQKICAgICAgICAgc3RydWN0IF9f
cGFja2VkIHsKICAgICAgICAgICAgIHVuc2lnbmVkIGNwdToxNiwgdGFza2xldDo4LCB0aWNrbGVk
OjQsIGlkbGU6NDsKICAgICAgICAgfSBkOwotICAgICAgICBkLmNwdSA9IGNwdTsKKyAgICAgICAg
ZC5jcHUgPSBjdXJfY3B1OwogICAgICAgICBkLnRhc2tsZXQgPSB0YXNrbGV0X3dvcmtfc2NoZWR1
bGVkOwotICAgICAgICBkLnRpY2tsZWQgPSBjcHVtYXNrX3Rlc3RfY3B1KGNwdSwgJnBydi0+dGlj
a2xlZCk7CisgICAgICAgIGQudGlja2xlZCA9IGNwdW1hc2tfdGVzdF9jcHUoc2NoZWRfY3B1LCAm
cHJ2LT50aWNrbGVkKTsKICAgICAgICAgZC5pZGxlID0gaXNfaWRsZV91bml0KGN1cnJ1bml0KTsK
ICAgICAgICAgdHJhY2VfdmFyKFRSQ19SVERTX1NDSEVEVUxFLCAxLAogICAgICAgICAgICAgICAg
ICAgc2l6ZW9mKGQpLApAQCAtMTA3OCw3ICsxMDc5LDcgQEAgcnRfc2NoZWR1bGUoY29uc3Qgc3Ry
dWN0IHNjaGVkdWxlciAqb3BzLCBzX3RpbWVfdCBub3csIGJvb2xfdCB0YXNrbGV0X3dvcmtfc2No
ZWQKICAgICB9CiAKICAgICAvKiBjbGVhciB0aWNrZWQgYml0IG5vdyB0aGF0IHdlJ3ZlIGJlZW4g
c2NoZWR1bGVkICovCi0gICAgY3B1bWFza19jbGVhcl9jcHUoY3B1LCAmcHJ2LT50aWNrbGVkKTsK
KyAgICBjcHVtYXNrX2NsZWFyX2NwdShzY2hlZF9jcHUsICZwcnYtPnRpY2tsZWQpOwogCiAgICAg
LyogYnVybl9idWRnZXQgd291bGQgcmV0dXJuIGZvciBJRExFIFVOSVQgKi8KICAgICBidXJuX2J1
ZGdldChvcHMsIHNjdXJyLCBub3cpOwpAQCAtMTA4NiwxMyArMTA4NywxMyBAQCBydF9zY2hlZHVs
ZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHNfdGltZV90IG5vdywgYm9vbF90IHRhc2ts
ZXRfd29ya19zY2hlZAogICAgIGlmICggdGFza2xldF93b3JrX3NjaGVkdWxlZCApCiAgICAgewog
ICAgICAgICB0cmFjZV92YXIoVFJDX1JURFNfU0NIRURfVEFTS0xFVCwgMSwgMCwgIE5VTEwpOwot
ICAgICAgICBzbmV4dCA9IHJ0X3VuaXQoc2NoZWRfaWRsZV91bml0KGNwdSkpOworICAgICAgICBz
bmV4dCA9IHJ0X3VuaXQoc2NoZWRfaWRsZV91bml0KHNjaGVkX2NwdSkpOwogICAgIH0KICAgICBl
bHNlCiAgICAgewotICAgICAgICBzbmV4dCA9IHJ1bnFfcGljayhvcHMsIGNwdW1hc2tfb2YoY3B1
KSk7CisgICAgICAgIHNuZXh0ID0gcnVucV9waWNrKG9wcywgY3B1bWFza19vZihzY2hlZF9jcHUp
KTsKICAgICAgICAgaWYgKCBzbmV4dCA9PSBOVUxMICkKLSAgICAgICAgICAgIHNuZXh0ID0gcnRf
dW5pdChzY2hlZF9pZGxlX3VuaXQoY3B1KSk7CisgICAgICAgICAgICBzbmV4dCA9IHJ0X3VuaXQo
c2NoZWRfaWRsZV91bml0KHNjaGVkX2NwdSkpOwogCiAgICAgICAgIC8qIGlmIHNjdXJyIGhhcyBo
aWdoZXIgcHJpb3JpdHkgYW5kIGJ1ZGdldCwgc3RpbGwgcGljayBzY3VyciAqLwogICAgICAgICBp
ZiAoICFpc19pZGxlX3VuaXQoY3VycnVuaXQpICYmCkBAIC0xMTE3LDkgKzExMTgsOSBAQCBydF9z
Y2hlZHVsZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHNfdGltZV90IG5vdywgYm9vbF90
IHRhc2tsZXRfd29ya19zY2hlZAogICAgICAgICAgICAgcV9yZW1vdmUoc25leHQpOwogICAgICAg
ICAgICAgX19zZXRfYml0KF9fUlREU19zY2hlZHVsZWQsICZzbmV4dC0+ZmxhZ3MpOwogICAgICAg
ICB9Ci0gICAgICAgIGlmICggc2NoZWRfdW5pdF9tYXN0ZXIoc25leHQtPnVuaXQpICE9IGNwdSAp
CisgICAgICAgIGlmICggc2NoZWRfdW5pdF9tYXN0ZXIoc25leHQtPnVuaXQpICE9IHNjaGVkX2Nw
dSApCiAgICAgICAgIHsKLSAgICAgICAgICAgIHNjaGVkX3NldF9yZXMoc25leHQtPnVuaXQsIGdl
dF9zY2hlZF9yZXMoY3B1KSk7CisgICAgICAgICAgICBzY2hlZF9zZXRfcmVzKHNuZXh0LT51bml0
LCBnZXRfc2NoZWRfcmVzKHNjaGVkX2NwdSkpOwogICAgICAgICAgICAgcmV0Lm1pZ3JhdGVkID0g
MTsKICAgICAgICAgfQogICAgICAgICByZXQudGltZSA9IHNuZXh0LT5jdXJfYnVkZ2V0OyAvKiBp
bnZva2UgdGhlIHNjaGVkdWxlciBuZXh0IHRpbWUgKi8KZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRl
L3hlbi9zY2hlZC1pZi5oIGIveGVuL2luY2x1ZGUveGVuL3NjaGVkLWlmLmgKaW5kZXggNDc5N2Jh
M2YyYi4uZDdmYWQwY2JjYyAxMDA2NDQKLS0tIGEveGVuL2luY2x1ZGUveGVuL3NjaGVkLWlmLmgK
KysrIGIveGVuL2luY2x1ZGUveGVuL3NjaGVkLWlmLmgKQEAgLTE1MCw2ICsxNTAsMTEgQEAgc3Rh
dGljIGlubGluZSBzdHJ1Y3Qgc2NoZWRfdW5pdCAqc2NoZWRfaWRsZV91bml0KHVuc2lnbmVkIGlu
dCBjcHUpCiAgICAgcmV0dXJuIGlkbGVfdmNwdVtjcHVdLT5zY2hlZF91bml0OwogfQogCitzdGF0
aWMgaW5saW5lIHVuc2lnbmVkIGludCBzY2hlZF9nZXRfcmVzb3VyY2VfY3B1KHVuc2lnbmVkIGlu
dCBjcHUpCit7CisgICAgcmV0dXJuIGdldF9zY2hlZF9yZXMoY3B1KS0+bWFzdGVyX2NwdTsKK30K
KwogLyoKICAqIFNjcmF0Y2ggc3BhY2UsIGZvciBhdm9pZGluZyBoYXZpbmcgdG9vIG1hbnkgY3B1
bWFza190IG9uIHRoZSBzdGFjay4KICAqIFdpdGhpbiBlYWNoIHNjaGVkdWxlciwgd2hlbiB1c2lu
ZyB0aGUgc2NyYXRjaCBtYXNrIG9mIG9uZSBwQ1BVOgotLSAKMi4xNi40CgoKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlz
dApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0
Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id EBC6D34B97
	for <lists+xen-devel@lfdr.de>; Tue,  4 Jun 2019 17:07:20 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hYAyF-0000rR-Ik; Tue, 04 Jun 2019 15:03:27 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=8ILU=UD=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1hYAyE-0000rM-G4
 for xen-devel@lists.xenproject.org; Tue, 04 Jun 2019 15:03:26 +0000
X-Inumbo-ID: e674a727-86d9-11e9-8980-bc764e045a96
Received: from prv1-mh.provo.novell.com (unknown [137.65.248.33])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id e674a727-86d9-11e9-8980-bc764e045a96;
 Tue, 04 Jun 2019 15:03:24 +0000 (UTC)
Received: from INET-PRV1-MTA by prv1-mh.provo.novell.com
 with Novell_GroupWise; Tue, 04 Jun 2019 09:03:23 -0600
Message-Id: <5CF6883802000078002352A1@prv1-mh.provo.novell.com>
X-Mailer: Novell GroupWise Internet Agent 18.1.1 
Date: Tue, 04 Jun 2019 09:03:20 -0600
From: "Jan Beulich" <JBeulich@suse.com>
To: "Chao Gao" <chao.gao@intel.com>
References: <1558945891-3015-1-git-send-email-chao.gao@intel.com>
 <1558945891-3015-4-git-send-email-chao.gao@intel.com>
In-Reply-To: <1558945891-3015-4-git-send-email-chao.gao@intel.com>
Mime-Version: 1.0
Content-Disposition: inline
Subject: Re: [Xen-devel] [PATCH v7 03/10] microcode: introduce a global
 cache of ucode patch
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Sergey Dyasli <sergey.dyasli@citrix.com>, Ashok Raj <ashok.raj@intel.com>,
 WeiLiu <wl@xen.org>, Andrew Cooper <andrew.cooper3@citrix.com>,
 xen-devel <xen-devel@lists.xenproject.org>,
 Roger Pau Monne <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

Pj4+IE9uIDI3LjA1LjE5IGF0IDEwOjMxLCA8Y2hhby5nYW9AaW50ZWwuY29tPiB3cm90ZToKPiAr
Ym9vbCBtaWNyb2NvZGVfdXBkYXRlX2NhY2hlKHN0cnVjdCBtaWNyb2NvZGVfcGF0Y2ggKnBhdGNo
KQo+ICt7Cj4gKwo+ICsgICAgQVNTRVJUKHNwaW5faXNfbG9ja2VkKCZtaWNyb2NvZGVfbXV0ZXgp
KTsKPiArCj4gKyAgICBpZiAoICFtaWNyb2NvZGVfb3BzLT5tYXRjaF9jcHUocGF0Y2gpICkKPiAr
ICAgICAgICByZXR1cm4gZmFsc2U7Cj4gKwo+ICsgICAgaWYgKCAhbWljcm9jb2RlX2NhY2hlICkK
PiArICAgICAgICBtaWNyb2NvZGVfY2FjaGUgPSBwYXRjaDsKPiArICAgIGVsc2UgaWYgKCBtaWNy
b2NvZGVfb3BzLT5jb21wYXJlX3BhdGNoKHBhdGNoLCBtaWNyb2NvZGVfY2FjaGUpID09Cj4gKyAg
ICAgICAgICAgICAgICAgIE5FV19VQ09ERSApCj4gKyAgICB7Cj4gKyAgICAgICAgbWljcm9jb2Rl
X29wcy0+ZnJlZV9wYXRjaChtaWNyb2NvZGVfY2FjaGUpOwo+ICsgICAgICAgIG1pY3JvY29kZV9j
YWNoZSA9IHBhdGNoOwo+ICsgICAgfQoKSG1tLCBva2F5LCB0aGUgd2F5IHlvdSBkbyB0aGluZ3Mg
aGVyZSB0aHJlZSBlbnVtZXJhdGlvbiB2YWx1ZXMKbWF5IGluZGVlZCBiZSBzdWZmaWNpZW50LiAi
b2xkIiBtYXkganVzdCBiZSBhIGxpdHRsZSBtaXNsZWFkaW5nIHRoZW4uCihBcyB0byBteSByZXNw
ZWN0aXZlIGNvbW1lbnQgb24gdGhlIHByZXZpb3VzIHBhdGNoLikKCj4gK3N0YXRpYyBzdHJ1Y3Qg
bWljcm9jb2RlX3BhdGNoICphbGxvY19taWNyb2NvZGVfcGF0Y2goCj4gKyAgICBjb25zdCBzdHJ1
Y3QgbWljcm9jb2RlX2FtZCAqbWNfYW1kKQo+ICt7Cj4gKyAgICBzdHJ1Y3QgbWljcm9jb2RlX3Bh
dGNoICptaWNyb2NvZGVfcGF0Y2ggPSB4bWFsbG9jKHN0cnVjdCBtaWNyb2NvZGVfcGF0Y2gpOwo+
ICsgICAgc3RydWN0IG1pY3JvY29kZV9hbWQgKmNhY2hlID0geG1hbGxvYyhzdHJ1Y3QgbWljcm9j
b2RlX2FtZCk7Cj4gKyAgICB2b2lkICptcGIgPSB4bWFsbG9jX2J5dGVzKG1jX2FtZC0+bXBiX3Np
emUpOwo+ICsgICAgc3RydWN0IGVxdWl2X2NwdV9lbnRyeSAqZXF1aXZfY3B1X3RhYmxlID0KPiAr
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4bWFsbG9jX2J5dGVzKG1jX2FtZC0+ZXF1
aXZfY3B1X3RhYmxlX3NpemUpOwo+ICsKPiArICAgIGlmICggIW1pY3JvY29kZV9wYXRjaCB8fCAh
Y2FjaGUgfHwgIW1wYiB8fCAhZXF1aXZfY3B1X3RhYmxlICkKPiArICAgIHsKPiArICAgICAgICB4
ZnJlZShtaWNyb2NvZGVfcGF0Y2gpOwo+ICsgICAgICAgIHhmcmVlKGNhY2hlKTsKPiArICAgICAg
ICB4ZnJlZShtcGIpOwo+ICsgICAgICAgIHhmcmVlKGVxdWl2X2NwdV90YWJsZSk7Cj4gKyAgICAg
ICAgcHJpbnRrKFhFTkxPR19FUlIgIm1pY3JvY29kZTogQ2FuIG5vdCBhbGxvY2F0ZSBtZW1vcnlc
biIpOwoKSSdtIG5vdCBjb252aW5jZWQgdGhpcyBuZWVkcyBsb2dnaW5nLgoKPiArICAgICAgICBy
ZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKPiArICAgIH0KPiArCj4gKyAgICBjYWNoZS0+ZXF1aXZf
Y3B1X3RhYmxlID0gZXF1aXZfY3B1X3RhYmxlOwo+ICsgICAgY2FjaGUtPm1wYiA9IG1wYjsKPiAr
ICAgIG1lbWNweShjYWNoZS0+ZXF1aXZfY3B1X3RhYmxlLCBtY19hbWQtPmVxdWl2X2NwdV90YWJs
ZSwKCldoeSBub3QgdXNlIHRoZSBsb2NhbCB2YXJpYWJsZSBoZXJlIGFuZCAuLi4KCj4gKyAgICAg
ICAgICAgbWNfYW1kLT5lcXVpdl9jcHVfdGFibGVfc2l6ZSk7Cj4gKyAgICBtZW1jcHkoY2FjaGUt
Pm1wYiwgbWNfYW1kLT5tcGIsIG1jX2FtZC0+bXBiX3NpemUpOwoKaGVyZT8gTGVzcyBzb3VyY2Ug
Y29kZSBhbmQgcHJlc3VtYWJseSBhbHNvIHNsaWdodGx5IGxlc3MgYmluYXJ5CmNvZGUuIEluIGZh
Y3QgSSB3b25kZXIgaWYgeW91IHdvdWxkbid0IGJldHRlciBtZW1jcHkoKSBmaXJzdAphbnl3YXks
IGFuZCBvbmx5IHRoZW4gc3RvcmUgdGhlIHZhbHVlcyBpbnRvIHRoZSBmaWVsZHMuIEl0IHdvbid0
Cm1hdHRlciBtdWNoIHdpdGggdGhlIGdsb2JhbCBsb2NrIGhlbGQsIGJ1dCBpdCdzIGdlbmVyYWxs
eSBnb29kCnByYWN0aWNlIHRvIGRvIHRoaW5ncyBpbiBhbiBvcmRlciB0aGF0IHdvbid0IHJpc2sg
dG8gY29uZnVzZQpoeXBvdGhldGljYWwgY29uc3VtZXJzIG9mIHRoZSBkYXRhLgoKPiArc3RhdGlj
IHZvaWQgZnJlZV9wYXRjaChzdHJ1Y3QgbWljcm9jb2RlX3BhdGNoICptaWNyb2NvZGVfcGF0Y2gp
Cj4gK3sKPiArICAgIHN0cnVjdCBtaWNyb2NvZGVfYW1kICptY19hbWQgPSBtaWNyb2NvZGVfcGF0
Y2gtPm1jX2FtZDsKPiArCj4gKyAgICB4ZnJlZShtY19hbWQtPmVxdWl2X2NwdV90YWJsZSk7Cj4g
KyAgICB4ZnJlZShtY19hbWQtPm1wYik7Cj4gKyAgICB4ZnJlZShtY19hbWQpOwo+ICsgICAgeGZy
ZWUobWljcm9jb2RlX3BhdGNoKTsKCkkgdGhpbmsgSSBzYWlkIHNvIGJlZm9yZTogRnJlZWluZyBv
ZiB0aGUgZ2VuZXJpYyB3cmFwcGVyIHN0cnVjdAp3b3VsZCBwcm9iYWJseSBiZXR0ZXIgYmUgcGxh
Y2VkIGluIGdlbmVyaWMgY29kZS4KCj4gQEAgLTQ5Nyw3ICs1NTgsMjAgQEAgc3RhdGljIGludCBj
cHVfcmVxdWVzdF9taWNyb2NvZGUodW5zaWduZWQgaW50IGNwdSwgY29uc3Qgdm9pZCAqYnVmLAo+
ICAgICAgd2hpbGUgKCAoZXJyb3IgPSBnZXRfdWNvZGVfZnJvbV9idWZmZXJfYW1kKG1jX2FtZCwg
YnVmLCBidWZzaXplLAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICZvZmZzZXQpKSA9PSAwICkKPiAgICAgIHsKPiAtICAgICAgICBpZiAoIG1pY3JvY29k
ZV9maXRzKG1jX2FtZCwgY3B1KSApCj4gKyAgICAgICAgc3RydWN0IG1pY3JvY29kZV9wYXRjaCAq
bmV3X3BhdGNoID0gYWxsb2NfbWljcm9jb2RlX3BhdGNoKG1jX2FtZCk7Cj4gKwo+ICsgICAgICAg
IGlmICggSVNfRVJSKG5ld19wYXRjaCkgKQo+ICsgICAgICAgIHsKPiArICAgICAgICAgICAgZXJy
b3IgPSBQVFJfRVJSKG5ld19wYXRjaCk7Cj4gKyAgICAgICAgICAgIGJyZWFrOwo+ICsgICAgICAg
IH0KPiArCj4gKyAgICAgICAgaWYgKCBtYXRjaF9jcHUobmV3X3BhdGNoKSApCj4gKyAgICAgICAg
ICAgIG1pY3JvY29kZV91cGRhdGVfY2FjaGUobmV3X3BhdGNoKTsKPiArICAgICAgICBlbHNlCj4g
KyAgICAgICAgICAgIGZyZWVfcGF0Y2gobmV3X3BhdGNoKTsKCldoeSBkbyB5b3UgcmUtZG8gd2hh
dCBtaWNyb2NvZGVfdXBkYXRlX2NhY2hlKCkgYWxyZWFkeSBkb2VzPwpJdCBjYWxscyAtPm1hdGNo
X2NwdSgpIGFuZCAtPmZyZWVfcGF0Y2goKSBhbGwgYnkgaXRzZWxmLiBJdCBsb29rcyBhcwppZiBp
dCB3b3VsZCBuZWVkIHRvIGdhaW4gb25lIG1vcmUgLT5mcmVlX3BhdGNoKCkgaW52b2NhdGlvbiB0
aG91Z2guCgooVGhlc2UgbGFzdCB0d28gY29tbWVudHMgYXBwbHkgdG8gdGhlIHJlc3BlY3RpdmUg
SW50ZWwgY29kZSBhcwp3ZWxsIHRoZW4uKQoKPiBAQCAtMjc3LDYgKzMxOSw3IEBAIHN0YXRpYyBp
bnQgZ2V0X21hdGNoaW5nX21pY3JvY29kZShjb25zdCB2b2lkICptYywgdW5zaWduZWQgaW50IGNw
dSkKPiAgICAgIG1lbWNweShuZXdfbWMsIG1jLCB0b3RhbF9zaXplKTsKPiAgICAgIHhmcmVlKHVj
aS0+bWMubWNfaW50ZWwpOwo+ICAgICAgdWNpLT5tYy5tY19pbnRlbCA9IG5ld19tYzsKPiArCj4g
ICAgICByZXR1cm4gMTsKPiAgfQo+ICAKClN0cmF5IGNvc21ldGljcz8KCj4gQEAgLTMwOSwxOSAr
MzU2LDE5IEBAIHN0YXRpYyBpbnQgYXBwbHlfbWljcm9jb2RlKHVuc2lnbmVkIGludCBjcHUpCj4g
ICAgICB2YWxbMV0gPSAodWludDMyX3QpKG1zcl9jb250ZW50ID4+IDMyKTsKPiAgCj4gICAgICBz
cGluX3VubG9ja19pcnFyZXN0b3JlKCZtaWNyb2NvZGVfdXBkYXRlX2xvY2ssIGZsYWdzKTsKPiAt
ICAgIGlmICggdmFsWzFdICE9IHVjaS0+bWMubWNfaW50ZWwtPmhkci5yZXYgKQo+ICsgICAgaWYg
KCB2YWxbMV0gIT0gbWNfaW50ZWwtPmhkci5yZXYgKQo+ICAgICAgewo+ICAgICAgICAgIHByaW50
ayhLRVJOX0VSUiAibWljcm9jb2RlOiBDUFUlZCB1cGRhdGUgZnJvbSByZXZpc2lvbiAiCj4gICAg
ICAgICAgICAgICAgICIlI3ggdG8gJSN4IGZhaWxlZC4gUmVzdWx0aW5nIHJldmlzaW9uIGlzICUj
eC5cbiIsIGNwdV9udW0sCj4gLSAgICAgICAgICAgICAgIHVjaS0+Y3B1X3NpZy5yZXYsIHVjaS0+
bWMubWNfaW50ZWwtPmhkci5yZXYsIHZhbFsxXSk7Cj4gKyAgICAgICAgICAgICAgIHVjaS0+Y3B1
X3NpZy5yZXYsIG1jX2ludGVsLT5oZHIucmV2LCB2YWxbMV0pOwo+ICAgICAgICAgIHJldHVybiAt
RUlPOwo+ICAgICAgfQo+ICAgICAgcHJpbnRrKEtFUk5fSU5GTyAibWljcm9jb2RlOiBDUFUlZCB1
cGRhdGVkIGZyb20gcmV2aXNpb24gIgo+ICAgICAgICAgICAgICIlI3ggdG8gJSN4LCBkYXRlID0g
JTA0eC0lMDJ4LSUwMnggXG4iLAo+ICAgICAgICAgICAgIGNwdV9udW0sIHVjaS0+Y3B1X3NpZy5y
ZXYsIHZhbFsxXSwKPiAtICAgICAgICAgICB1Y2ktPm1jLm1jX2ludGVsLT5oZHIueWVhciwKPiAt
ICAgICAgICAgICB1Y2ktPm1jLm1jX2ludGVsLT5oZHIubW9udGgsCj4gLSAgICAgICAgICAgdWNp
LT5tYy5tY19pbnRlbC0+aGRyLmRheSk7Cj4gKyAgICAgICAgICAgbWNfaW50ZWwtPmhkci55ZWFy
LAo+ICsgICAgICAgICAgIG1jX2ludGVsLT5oZHIubW9udGgsCj4gKyAgICAgICAgICAgbWNfaW50
ZWwtPmhkci5kYXkpOwoKVGhlIHRocmVlIGFyZ3VtZW50cyBub3cgbG9vayB0byBhbGwgZml0IG9u
IGEgc2luZ2xlIGxpbmUuCgpKYW4KCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5w
cm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8v
eGVuLWRldmVs

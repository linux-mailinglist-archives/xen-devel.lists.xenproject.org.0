Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id A4C4813B7E0
	for <lists+xen-devel@lfdr.de>; Wed, 15 Jan 2020 03:42:51 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1irYbW-0004qC-4X; Wed, 15 Jan 2020 02:40:22 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=8TLv=3E=invisiblethingslab.com=marmarek@srs-us1.protection.inumbo.net>)
 id 1irYbU-0004pz-6a
 for xen-devel@lists.xenproject.org; Wed, 15 Jan 2020 02:40:20 +0000
X-Inumbo-ID: 5d6c7670-3740-11ea-84ba-12813bfff9fa
Received: from out2-smtp.messagingengine.com (unknown [66.111.4.26])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 5d6c7670-3740-11ea-84ba-12813bfff9fa;
 Wed, 15 Jan 2020 02:40:17 +0000 (UTC)
Received: from compute7.internal (compute7.nyi.internal [10.202.2.47])
 by mailout.nyi.internal (Postfix) with ESMTP id 41B1D221B6;
 Tue, 14 Jan 2020 21:40:17 -0500 (EST)
Received: from mailfrontend2 ([10.202.2.163])
 by compute7.internal (MEProxy); Tue, 14 Jan 2020 21:40:17 -0500
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=
 messagingengine.com; h=cc:content-transfer-encoding:content-type
 :date:from:in-reply-to:message-id:mime-version:references
 :subject:to:x-me-proxy:x-me-proxy:x-me-sender:x-me-sender
 :x-sasl-enc; s=fm1; bh=U2eTgmeN4K1ApHfEWQLVF3yo1h3QRz6FO7zSDZvWU
 xw=; b=RhRZ+Ys9OlK6uTjBnV5wnQFulGD4sinNmmxNpAUgNnguRsVBACbS0EIKl
 03dXvIRekArANPbpk4nUFZFXHlNTwaIgnzMU27mvv3YPWT/gWaZdDlzjHLbFO/j+
 Xg7tg5vsXJSPfHpS6Mc/DO+tcMNKOoVjn1oXu4cfBJ+DVMZCtH44CzFcH0PmLWn7
 c67GZpijXTbVvopQ5hEnaFlF1MwWea7ncDmZ3tz7S36x6/gxtmBQO3EoPVDfVU17
 dz+8lHaH6bQMjuv0FBfdXt6KnZ3Bh5WgzzFzPPW1Uhgp+zgxkDxXC5N80fla2EfP
 M3dzn9XkRpWF62jkz/9WYvzNm38Nw==
X-ME-Sender: <xms:kXseXo_okuPtaJCCPCCm9313xGE-q0cZwo8TYKqmkNIjLjgShWuLtA>
X-ME-Proxy-Cause: gggruggvucftvghtrhhoucdtuddrgedugedrtddvgdegkecutefuodetggdotefrodftvf
 curfhrohhfihhlvgemucfhrghsthforghilhdpqfgfvfdpuffrtefokffrpgfnqfghnecu
 uegrihhlohhuthemuceftddtnecusecvtfgvtghiphhivghnthhsucdlqddutddtmdenuc
 fjughrpefhvffufffkofgjfhggtgfgsehtkeertdertdejnecuhfhrohhmpeforghrvghk
 ucforghrtgiihihkohifshhkihdqifpkrhgvtghkihcuoehmrghrmhgrrhgvkhesihhnvh
 hishhisghlvghthhhinhhgshhlrggsrdgtohhmqeenucfkphepledurdeihedrfeegrdef
 feenucfrrghrrghmpehmrghilhhfrhhomhepmhgrrhhmrghrvghksehinhhvihhsihgslh
 gvthhhihhnghhslhgrsgdrtghomhenucevlhhushhtvghrufhiiigvpedt
X-ME-Proxy: <xmx:kXseXjyAxngo-J301XNYCfjyRGfmcEg513NxClC_87-4RC5tBNakVg>
 <xmx:kXseXopZKF8IhjVXt9oJXcUjiWVHwPX38uQb9OPSg21YHseJ5HV2qA>
 <xmx:kXseXkqT2tQu4jGRgxFCxwMTeEhXvEefR7lTcqR6J57c-3SEn51W_Q>
 <xmx:kXseXjBKlkruji1h5nPKwFgoGXtLjSjUgTrp6VTO_q8QmPgS4vckzg>
Received: from localhost.localdomain (ip5b412221.dynamic.kabel-deutschland.de
 [91.65.34.33])
 by mail.messagingengine.com (Postfix) with ESMTPA id 1B9B030607B4;
 Tue, 14 Jan 2020 21:40:16 -0500 (EST)
From: =?UTF-8?q?Marek=20Marczykowski-G=C3=B3recki?=
 <marmarek@invisiblethingslab.com>
To: xen-devel@lists.xenproject.org
Date: Wed, 15 Jan 2020 03:39:44 +0100
Message-Id: <27770209c1e2984cda8b9893ed6313fb2bdf30a6.1579055705.git-series.marmarek@invisiblethingslab.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <cover.f819645cd9f5cf7a6f692f9661cfb4e670a2cd08.1579055705.git-series.marmarek@invisiblethingslab.com>
References: <cover.f819645cd9f5cf7a6f692f9661cfb4e670a2cd08.1579055705.git-series.marmarek@invisiblethingslab.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v4 05/16] libxl: Handle Linux stubdomain
 specific QEMU options.
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Wei Liu <wl@xen.org>, Ian Jackson <ian.jackson@eu.citrix.com>,
 =?UTF-8?q?Marek=20Marczykowski-G=C3=B3recki?=
 <marmarek@invisiblethingslab.com>, Simon Gaiser <simon@invisiblethingslab.com>,
 Anthony PERARD <anthony.perard@citrix.com>, Eric Shelton <eshelton@pobox.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

RnJvbTogRXJpYyBTaGVsdG9uIDxlc2hlbHRvbkBwb2JveC5jb20+CgpUaGlzIHBhdGNoIGNyZWF0
ZXMgYW4gYXBwcm9wcmlhdGUgY29tbWFuZCBsaW5lIGZvciB0aGUgUUVNVSBpbnN0YW5jZQpydW5u
aW5nIGluIGEgTGludXgtYmFzZWQgc3R1YmRvbWFpbi4KCk5PVEU6IGEgbnVtYmVyIG9mIGl0ZW1z
IGFyZSBub3QgY3VycmVudGx5IGltcGxlbWVudGVkIGZvciBMaW51eC1iYXNlZApzdHViZG9tYWlu
cywgc3VjaCBhczoKLSBzYXZlL3Jlc3RvcmUKLSBRTVAgc29ja2V0Ci0gZ3JhcGhpY3Mgb3V0cHV0
IChlLmcuLCBWTkMpCgpTaWduZWQtb2ZmLWJ5OiBFcmljIFNoZWx0b24gPGVzaGVsdG9uQHBvYm94
LmNvbT4KClNpbW9uOgogKiBmaXggZGlzayBwYXRoCiAqIGZpeCBjZHJvbSBwYXRoIGFuZCAiZm9y
bWF0IgogKiBwYXNzIGRvd25zY3JpcHQgZm9yIG5ldHdvcmsgaW50ZXJmYWNlcwoKU2lnbmVkLW9m
Zi1ieTogU2ltb24gR2Fpc2VyIDxzaW1vbkBpbnZpc2libGV0aGluZ3NsYWIuY29tPgpbZHJvcCBR
dWJlcy1zcGVjaWZpYyBwYXJ0c10KU2lnbmVkLW9mZi1ieTogTWFyZWsgTWFyY3p5a293c2tpLUfD
s3JlY2tpIDxtYXJtYXJla0BpbnZpc2libGV0aGluZ3NsYWIuY29tPgotLS0KQ2hhbmdlcyBpbiB2
MjoKIC0gZml4IHNlcmlhbCBzcGVjaWZpZWQgd2l0aCBzZXJpYWw9WyAuLi4gXSBzeW50YXgKIC0g
ZXJyb3Igb3V0IG9uIG11bHRpcGxlIGNvbnNvbGVzIChpbmNvbXBhdGlibGUgd2l0aCBzdHViZG9t
KQogLSBkcm9wIGVycm9uZW91cyBjaHVuayBhYm91dCBjZHJvbQpDaGFuZ2VzIGluIHYzOgogLSBj
aGFuZ2UgdG8gdXNlIGxpYnhsX19zdHViZG9tYWluX2lzX2xpbnV4IGluc3RlYWQgb2YKICAgYl9p
bmZvLT5zdHViZG9tYWluX3ZlcnNpb24KIC0gZHJvcCBsaWJ4bF9fc3R1YmRvbWFpbl92ZXJzaW9u
X3J1bm5pbmcsIHByZWZlcgogICBsaWJ4bF9fc3R1YmRvbWFpbl9pc19saW51eF9ydW5uaW5nIGlu
dHJvZHVjZWQgYnkgcHJldmlvdXMgcGF0Y2gKIC0gZHJvcCBpZnVwL2lmZG93biBzY3JpcHQgLSBz
dHViZG9tYWluIHdpbGwgaGFuZGxlIHRoYXQgd2l0aCBxZW11CiAgIGV2ZW50cyBpdHNlbGYKIC0g
c2xpZ2h0bHkgc2ltcGxpZnkgLXNlcmlhbCBhcmd1bWVudAogLSBhZGQgc3VwcG9ydCBmb3IgbXVs
dGlwbGUgc2VyaWFsIGNvbnNvbGVzLCBkbyBub3QgaWdub3JlCiAgIGJfaW5mby51LnNlcmlhbChf
bGlzdCkKIC0gYWRkIGVycm9yIGNoZWNraW5nIGZvciBtb3JlIHRoYW4gMjYgZW11bGF0ZWQgZGlz
a3MgKCIvZGV2L3h2ZCVjIgogICBmb3JtYXQgc3RyaW5nKQotLS0KIHRvb2xzL2xpYnhsL2xpYnhs
X2NyZWF0ZS5jICAgfCAgMzYgKysrKysrKy0KIHRvb2xzL2xpYnhsL2xpYnhsX2RtLmMgICAgICAg
fCAxOTAgKysrKysrKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tCiB0b29scy9saWJ4bC9s
aWJ4bF9pbnRlcm5hbC5oIHwgICAxICstCiB0b29scy9saWJ4bC9saWJ4bF9tZW0uYyAgICAgIHwg
ICA2ICstCiB0b29scy9saWJ4bC9saWJ4bF90eXBlcy5pZGwgIHwgICAzICstCiA1IGZpbGVzIGNo
YW5nZWQsIDE3NSBpbnNlcnRpb25zKCspLCA2MSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS90
b29scy9saWJ4bC9saWJ4bF9jcmVhdGUuYyBiL3Rvb2xzL2xpYnhsL2xpYnhsX2NyZWF0ZS5jCmlu
ZGV4IDE0MmI5NjAuLmE2ZDQwYjcgMTAwNjQ0Ci0tLSBhL3Rvb2xzL2xpYnhsL2xpYnhsX2NyZWF0
ZS5jCisrKyBiL3Rvb2xzL2xpYnhsL2xpYnhsX2NyZWF0ZS5jCkBAIC0xNjksNiArMTY5LDMxIEBA
IGludCBsaWJ4bF9fZG9tYWluX2J1aWxkX2luZm9fc2V0ZGVmYXVsdChsaWJ4bF9fZ2MgKmdjLAog
ICAgICAgICB9CiAgICAgfQogCisgICAgaWYgKGJfaW5mby0+dHlwZSA9PSBMSUJYTF9ET01BSU5f
VFlQRV9IVk0gJiYKKyAgICAgICAgbGlieGxfZGVmYm9vbF92YWwoYl9pbmZvLT5kZXZpY2VfbW9k
ZWxfc3R1YmRvbWFpbikpIHsKKyAgICAgICAgaWYgKCFiX2luZm8tPnN0dWJkb21haW5fa2VybmVs
KSB7CisgICAgICAgICAgICBzd2l0Y2ggKGJfaW5mby0+ZGV2aWNlX21vZGVsX3ZlcnNpb24pIHsK
KyAgICAgICAgICAgICAgICBjYXNlIExJQlhMX0RFVklDRV9NT0RFTF9WRVJTSU9OX1FFTVVfWEVO
X1RSQURJVElPTkFMOgorICAgICAgICAgICAgICAgICAgICBiX2luZm8tPnN0dWJkb21haW5fa2Vy
bmVsID0KKyAgICAgICAgICAgICAgICAgICAgICAgIGxpYnhsX19hYnNfcGF0aChOT0dDLCAiaW9l
bXUtc3R1YmRvbS5neiIsIGxpYnhsX194ZW5maXJtd2FyZWRpcl9wYXRoKCkpOworICAgICAgICAg
ICAgICAgICAgICBiX2luZm8tPnN0dWJkb21haW5fcmFtZGlzayA9IE5VTEw7CisgICAgICAgICAg
ICAgICAgICAgIGJyZWFrOworICAgICAgICAgICAgICAgIGNhc2UgTElCWExfREVWSUNFX01PREVM
X1ZFUlNJT05fUUVNVV9YRU46CisgICAgICAgICAgICAgICAgICAgIGJfaW5mby0+c3R1YmRvbWFp
bl9rZXJuZWwgPQorICAgICAgICAgICAgICAgICAgICAgICAgbGlieGxfX2Fic19wYXRoKE5PR0Ms
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzdHViZG9tLWxpbnV4LWtlcm5lbCIs
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnhsX194ZW5maXJtd2FyZWRpcl9w
YXRoKCkpOworICAgICAgICAgICAgICAgICAgICBiX2luZm8tPnN0dWJkb21haW5fcmFtZGlzayA9
CisgICAgICAgICAgICAgICAgICAgICAgICBsaWJ4bF9fYWJzX3BhdGgoTk9HQywKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgInN0dWJkb20tbGludXgtcm9vdGZzIiwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgbGlieGxfX3hlbmZpcm13YXJlZGlyX3BhdGgoKSk7Cisg
ICAgICAgICAgICAgICAgICAgIGJyZWFrOworICAgICAgICAgICAgICAgIGRlZmF1bHQ6CisgICAg
ICAgICAgICAgICAgICAgIGFib3J0KCk7CisgICAgICAgICAgICB9CisgICAgICAgIH0KKyAgICB9
CisKICAgICBpZiAoIWJfaW5mby0+bWF4X3ZjcHVzKQogICAgICAgICBiX2luZm8tPm1heF92Y3B1
cyA9IDE7CiAgICAgaWYgKCFiX2luZm8tPmF2YWlsX3ZjcHVzLnNpemUpIHsKQEAgLTIwNCw2ICsy
MjksMTcgQEAgaW50IGxpYnhsX19kb21haW5fYnVpbGRfaW5mb19zZXRkZWZhdWx0KGxpYnhsX19n
YyAqZ2MsCiAgICAgaWYgKGJfaW5mby0+dGFyZ2V0X21lbWtiID09IExJQlhMX01FTUtCX0RFRkFV
TFQpCiAgICAgICAgIGJfaW5mby0+dGFyZ2V0X21lbWtiID0gYl9pbmZvLT5tYXhfbWVta2I7CiAK
KyAgICBpZiAoYl9pbmZvLT5zdHViZG9tYWluX21lbWtiID09IExJQlhMX01FTUtCX0RFRkFVTFQp
IHsKKyAgICAgICAgaWYgKGxpYnhsX2RlZmJvb2xfdmFsKGJfaW5mby0+ZGV2aWNlX21vZGVsX3N0
dWJkb21haW4pKSB7CisgICAgICAgICAgICBpZiAobGlieGxfX3N0dWJkb21haW5faXNfbGludXgo
Yl9pbmZvKSkKKyAgICAgICAgICAgICAgICBiX2luZm8tPnN0dWJkb21haW5fbWVta2IgPSBMSUJY
TF9MSU5VWF9TVFVCRE9NX01FTSAqIDEwMjQ7CisgICAgICAgICAgICBlbHNlCisgICAgICAgICAg
ICAgICAgYl9pbmZvLT5zdHViZG9tYWluX21lbWtiID0gMjggKiAxMDI0OyAvLyBNaW5pT1MKKyAg
ICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgIGJfaW5mby0+c3R1YmRvbWFpbl9tZW1rYiA9IDA7
IC8vIG5vIHN0dWJkb21haW4KKyAgICAgICAgfQorICAgIH0KKwogICAgIGxpYnhsX2RlZmJvb2xf
c2V0ZGVmYXVsdCgmYl9pbmZvLT5jbGFpbV9tb2RlLCBmYWxzZSk7CiAKICAgICBsaWJ4bF9kZWZi
b29sX3NldGRlZmF1bHQoJmJfaW5mby0+bG9jYWx0aW1lLCBmYWxzZSk7CmRpZmYgLS1naXQgYS90
b29scy9saWJ4bC9saWJ4bF9kbS5jIGIvdG9vbHMvbGlieGwvbGlieGxfZG0uYwppbmRleCA1NThj
YjQxLi45MjZkOTYzIDEwMDY0NAotLS0gYS90b29scy9saWJ4bC9saWJ4bF9kbS5jCisrKyBiL3Rv
b2xzL2xpYnhsL2xpYnhsX2RtLmMKQEAgLTExNzIsNiArMTE3Miw3IEBAIHN0YXRpYyBpbnQgbGli
eGxfX2J1aWxkX2RldmljZV9tb2RlbF9hcmdzX25ldyhsaWJ4bF9fZ2MgKmdjLAogICAgIGludCBp
LCBjb25uZWN0aW9uLCBkZXZpZDsKICAgICB1aW50NjRfdCByYW1fc2l6ZTsKICAgICBjb25zdCBj
aGFyICpwYXRoLCAqY2hhcmRldjsKKyAgICBib29sIGlzX3N0dWJkb20gPSBsaWJ4bF9kZWZib29s
X3ZhbChiX2luZm8tPmRldmljZV9tb2RlbF9zdHViZG9tYWluKTsKIAogICAgIGRtX2FyZ3MgPSBm
bGV4YXJyYXlfbWFrZShnYywgMTYsIDEpOwogICAgIGRtX2VudnMgPSBmbGV4YXJyYXlfbWFrZShn
YywgMTYsIDEpOwpAQCAtMTE4MiwzOCArMTE4Myw0MSBAQCBzdGF0aWMgaW50IGxpYnhsX19idWls
ZF9kZXZpY2VfbW9kZWxfYXJnc19uZXcobGlieGxfX2djICpnYywKICAgICAgICAgICAgICAgICAg
ICAgICAiLXhlbi1kb21pZCIsCiAgICAgICAgICAgICAgICAgICAgICAgR0NTUFJJTlRGKCIlZCIs
IGd1ZXN0X2RvbWlkKSwgTlVMTCk7CiAKLSAgICBmbGV4YXJyYXlfYXBwZW5kKGRtX2FyZ3MsICIt
Y2hhcmRldiIpOwotICAgIGlmIChzdGF0ZS0+ZG1fbW9uaXRvcl9mZCA+PSAwKSB7Ci0gICAgICAg
IGZsZXhhcnJheV9hcHBlbmQoZG1fYXJncywKLSAgICAgICAgICAgIEdDU1BSSU5URigic29ja2V0
LGlkPWxpYnhsLWNtZCxmZD0lZCxzZXJ2ZXIsbm93YWl0IiwKLSAgICAgICAgICAgICAgICAgICAg
ICBzdGF0ZS0+ZG1fbW9uaXRvcl9mZCkpOworICAgIC8qIFRoZXJlIGlzIGN1cnJlbnRseSBubyB3
YXkgdG8gYWNjZXNzIHRoZSBRTVAgc29ja2V0IGluIHRoZSBzdHViZG9tICovCisgICAgaWYgKCFp
c19zdHViZG9tKSB7CisgICAgICAgIGZsZXhhcnJheV9hcHBlbmQoZG1fYXJncywgIi1jaGFyZGV2
Iik7CisgICAgICAgIGlmIChzdGF0ZS0+ZG1fbW9uaXRvcl9mZCA+PSAwKSB7CisgICAgICAgICAg
ICBmbGV4YXJyYXlfYXBwZW5kKGRtX2FyZ3MsCisgICAgICAgICAgICAgICAgR0NTUFJJTlRGKCJz
b2NrZXQsaWQ9bGlieGwtY21kLGZkPSVkLHNlcnZlcixub3dhaXQiLAorICAgICAgICAgICAgICAg
ICAgICAgICAgICBzdGF0ZS0+ZG1fbW9uaXRvcl9mZCkpOwogCi0gICAgICAgIC8qCi0gICAgICAg
ICAqIFN0YXJ0IFFFTVUgd2l0aCBpdHMgIkNQVSIgcGF1c2VkLCBpdCB3aWxsIG5vdCBzdGFydCBh
bnkgZW11bGF0aW9uCi0gICAgICAgICAqIHVudGlsIHRoZSBRTVAgY29tbWFuZCAiY29udCIgaXMg
dXNlZC4gVGhpcyBhbHNvIHByZXZlbnQgUUVNVSBmcm9tCi0gICAgICAgICAqIHdyaXRpbmcgInJ1
bm5pbmciIHRvIHRoZSAic3RhdGUiIHhlbnN0b3JlIG5vZGUgc28gd2Ugb25seSB1c2UgdGhpcwot
ICAgICAgICAgKiBmbGFnIHdoZW4gd2UgaGF2ZSB0aGUgUU1QIGJhc2VkIHN0YXJ0dXAgbm90aWZp
Y2F0aW9uLgotICAgICAgICAgKiAqLwotICAgICAgICBmbGV4YXJyYXlfYXBwZW5kKGRtX2FyZ3Ms
ICItUyIpOwotICAgIH0gZWxzZSB7Ci0gICAgICAgIGZsZXhhcnJheV9hcHBlbmQoZG1fYXJncywK
LSAgICAgICAgICAgICAgICAgICAgICAgICBHQ1NQUklOVEYoInNvY2tldCxpZD1saWJ4bC1jbWQs
IgotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicGF0aD0lcyxzZXJ2ZXIsbm93
YWl0IiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlieGxfX3FlbXVfcW1w
X3BhdGgoZ2MsIGd1ZXN0X2RvbWlkKSkpOwotICAgIH0KKyAgICAgICAgICAgIC8qCisgICAgICAg
ICAgICAgKiBTdGFydCBRRU1VIHdpdGggaXRzICJDUFUiIHBhdXNlZCwgaXQgd2lsbCBub3Qgc3Rh
cnQgYW55IGVtdWxhdGlvbgorICAgICAgICAgICAgICogdW50aWwgdGhlIFFNUCBjb21tYW5kICJj
b250IiBpcyB1c2VkLiBUaGlzIGFsc28gcHJldmVudCBRRU1VIGZyb20KKyAgICAgICAgICAgICAq
IHdyaXRpbmcgInJ1bm5pbmciIHRvIHRoZSAic3RhdGUiIHhlbnN0b3JlIG5vZGUgc28gd2Ugb25s
eSB1c2UgdGhpcworICAgICAgICAgICAgICogZmxhZyB3aGVuIHdlIGhhdmUgdGhlIFFNUCBiYXNl
ZCBzdGFydHVwIG5vdGlmaWNhdGlvbi4KKyAgICAgICAgICAgICAqICovCisgICAgICAgICAgICBm
bGV4YXJyYXlfYXBwZW5kKGRtX2FyZ3MsICItUyIpOworICAgICAgICB9IGVsc2UgeworICAgICAg
ICAgICAgZmxleGFycmF5X2FwcGVuZChkbV9hcmdzLAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBHQ1NQUklOVEYoInNvY2tldCxpZD1saWJ4bC1jbWQsIgorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgInBhdGg9JXMsc2VydmVyLG5vd2FpdCIsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ4bF9fcWVtdV9xbXBfcGF0aChnYywgZ3Vl
c3RfZG9taWQpKSk7CisgICAgICAgIH0KIAotICAgIGZsZXhhcnJheV9hcHBlbmQoZG1fYXJncywg
Ii1uby1zaHV0ZG93biIpOwotICAgIGZsZXhhcnJheV9hcHBlbmQoZG1fYXJncywgIi1tb24iKTsK
LSAgICBmbGV4YXJyYXlfYXBwZW5kKGRtX2FyZ3MsICJjaGFyZGV2PWxpYnhsLWNtZCxtb2RlPWNv
bnRyb2wiKTsKKyAgICAgICAgZmxleGFycmF5X2FwcGVuZChkbV9hcmdzLCAiLW5vLXNodXRkb3du
Iik7CisgICAgICAgIGZsZXhhcnJheV9hcHBlbmQoZG1fYXJncywgIi1tb24iKTsKKyAgICAgICAg
ZmxleGFycmF5X2FwcGVuZChkbV9hcmdzLCAiY2hhcmRldj1saWJ4bC1jbWQsbW9kZT1jb250cm9s
Iik7CiAKLSAgICBmbGV4YXJyYXlfYXBwZW5kKGRtX2FyZ3MsICItY2hhcmRldiIpOwotICAgIGZs
ZXhhcnJheV9hcHBlbmQoZG1fYXJncywKLSAgICAgICAgICAgICAgICAgICAgIEdDU1BSSU5URigi
c29ja2V0LGlkPWxpYnhlbnN0YXQtY21kLCIKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICJwYXRoPSVzL3FtcC1saWJ4ZW5zdGF0LSVkLHNlcnZlcixub3dhaXQiLAotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlieGxfX3J1bl9kaXJfcGF0aCgpLCBndWVz
dF9kb21pZCkpOworICAgICAgICBmbGV4YXJyYXlfYXBwZW5kKGRtX2FyZ3MsICItY2hhcmRldiIp
OworICAgICAgICBmbGV4YXJyYXlfYXBwZW5kKGRtX2FyZ3MsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgR0NTUFJJTlRGKCJzb2NrZXQsaWQ9bGlieGVuc3RhdC1jbWQsIgorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwYXRoPSVzL3FtcC1saWJ4ZW5zdGF0LSVkLHNl
cnZlcixub3dhaXQiLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxp
YnhsX19ydW5fZGlyX3BhdGgoKSwgZ3Vlc3RfZG9taWQpKTsKIAotICAgIGZsZXhhcnJheV9hcHBl
bmQoZG1fYXJncywgIi1tb24iKTsKLSAgICBmbGV4YXJyYXlfYXBwZW5kKGRtX2FyZ3MsICJjaGFy
ZGV2PWxpYnhlbnN0YXQtY21kLG1vZGU9Y29udHJvbCIpOworICAgICAgICBmbGV4YXJyYXlfYXBw
ZW5kKGRtX2FyZ3MsICItbW9uIik7CisgICAgICAgIGZsZXhhcnJheV9hcHBlbmQoZG1fYXJncywg
ImNoYXJkZXY9bGlieGVuc3RhdC1jbWQsbW9kZT1jb250cm9sIik7CisgICAgfQogCiAgICAgZm9y
IChpID0gMDsgaSA8IGd1ZXN0X2NvbmZpZy0+bnVtX2NoYW5uZWxzOyBpKyspIHsKICAgICAgICAg
Y29ubmVjdGlvbiA9IGd1ZXN0X2NvbmZpZy0+Y2hhbm5lbHNbaV0uY29ubmVjdGlvbjsKQEAgLTEy
NTcsNyArMTI2MSw3IEBAIHN0YXRpYyBpbnQgbGlieGxfX2J1aWxkX2RldmljZV9tb2RlbF9hcmdz
X25ldyhsaWJ4bF9fZ2MgKmdjLAogICAgICAgICBmbGV4YXJyYXlfdmFwcGVuZChkbV9hcmdzLCAi
LW5hbWUiLCBjX2luZm8tPm5hbWUsIE5VTEwpOwogICAgIH0KIAotICAgIGlmICh2bmMpIHsKKyAg
ICBpZiAodm5jICYmICFpc19zdHViZG9tKSB7CiAgICAgICAgIGNoYXIgKnZuY2FyZyA9IE5VTEw7
CiAKICAgICAgICAgZmxleGFycmF5X2FwcGVuZChkbV9hcmdzLCAiLXZuYyIpOwpAQCAtMTI5Niw3
ICsxMzAwLDcgQEAgc3RhdGljIGludCBsaWJ4bF9fYnVpbGRfZGV2aWNlX21vZGVsX2FyZ3NfbmV3
KGxpYnhsX19nYyAqZ2MsCiAgICAgICAgIH0KIAogICAgICAgICBmbGV4YXJyYXlfYXBwZW5kKGRt
X2FyZ3MsIHZuY2FyZyk7Ci0gICAgfSBlbHNlCisgICAgfSBlbHNlIGlmICghaXNfc3R1YmRvbSkK
ICAgICAgICAgLyoKICAgICAgICAgICogRW5zdXJlIHRoYXQgYnkgZGVmYXVsdCBubyB2bmMgc2Vy
dmVyIGlzIGNyZWF0ZWQuCiAgICAgICAgICAqLwpAQCAtMTMwOCw3ICsxMzEyLDcgQEAgc3RhdGlj
IGludCBsaWJ4bF9fYnVpbGRfZGV2aWNlX21vZGVsX2FyZ3NfbmV3KGxpYnhsX19nYyAqZ2MsCiAg
ICAgICovCiAgICAgZmxleGFycmF5X2FwcGVuZF9wYWlyKGRtX2FyZ3MsICItZGlzcGxheSIsICJu
b25lIik7CiAKLSAgICBpZiAoc2RsKSB7CisgICAgaWYgKHNkbCAmJiAhaXNfc3R1YmRvbSkgewog
ICAgICAgICBmbGV4YXJyYXlfYXBwZW5kKGRtX2FyZ3MsICItc2RsIik7CiAgICAgICAgIGlmIChz
ZGwtPmRpc3BsYXkpCiAgICAgICAgICAgICBmbGV4YXJyYXlfYXBwZW5kX3BhaXIoZG1fZW52cywg
IkRJU1BMQVkiLCBzZGwtPmRpc3BsYXkpOwpAQCAtMTM1MCwxOCArMTM1NCwzNCBAQCBzdGF0aWMg
aW50IGxpYnhsX19idWlsZF9kZXZpY2VfbW9kZWxfYXJnc19uZXcobGlieGxfX2djICpnYywKICAg
ICAgICAgICAgIHsKICAgICAgICAgICAgICAgICBMT0dEKEVSUk9SLCBndWVzdF9kb21pZCwgIkJv
dGggc2VyaWFsIGFuZCBzZXJpYWxfbGlzdCBzZXQiKTsKICAgICAgICAgICAgICAgICByZXR1cm4g
RVJST1JfSU5WQUw7Ci0gICAgICAgICAgICB9Ci0gICAgICAgICAgICBpZiAoYl9pbmZvLT51Lmh2
bS5zZXJpYWwpIHsKLSAgICAgICAgICAgICAgICBmbGV4YXJyYXlfdmFwcGVuZChkbV9hcmdzLAot
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICItc2VyaWFsIiwgYl9pbmZvLT51Lmh2
bS5zZXJpYWwsIE5VTEwpOwotICAgICAgICAgICAgfSBlbHNlIGlmIChiX2luZm8tPnUuaHZtLnNl
cmlhbF9saXN0KSB7Ci0gICAgICAgICAgICAgICAgY2hhciAqKnA7Ci0gICAgICAgICAgICAgICAg
Zm9yIChwID0gYl9pbmZvLT51Lmh2bS5zZXJpYWxfbGlzdDsKLSAgICAgICAgICAgICAgICAgICAg
ICpwOwotICAgICAgICAgICAgICAgICAgICAgcCsrKSB7Ci0gICAgICAgICAgICAgICAgICAgIGZs
ZXhhcnJheV92YXBwZW5kKGRtX2FyZ3MsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICItc2VyaWFsIiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
KnAsIE5VTEwpOworICAgICAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgICAgICBpZiAoYl9p
bmZvLT51Lmh2bS5zZXJpYWwpIHsKKyAgICAgICAgICAgICAgICAgICAgaWYgKGlzX3N0dWJkb20p
IHsKKyAgICAgICAgICAgICAgICAgICAgICAgIC8qIHNlZSBzcGF3bl9zdHViX2xhdW5jaF9kbSgp
IGZvciBjb25uZWN0aW5nIFNUVUJET01fQ09OU09MRV9TRVJJQUwgKi8KKyAgICAgICAgICAgICAg
ICAgICAgICAgIGZsZXhhcnJheV92YXBwZW5kKGRtX2FyZ3MsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAiLXNlcmlhbCIsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBHQ1NQUklOVEYoIi9kZXYvaHZjJWQiLCBTVFVCRE9NX0NPTlNP
TEVfU0VSSUFMKSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5V
TEwpOworICAgICAgICAgICAgICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAgICAgICAgICAg
ICAgZmxleGFycmF5X3ZhcHBlbmQoZG1fYXJncywKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICItc2VyaWFsIiwgYl9pbmZvLT51Lmh2bS5zZXJpYWwsIE5VTEwpOwor
ICAgICAgICAgICAgICAgICAgICB9CisgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChiX2luZm8t
PnUuaHZtLnNlcmlhbF9saXN0KSB7CisgICAgICAgICAgICAgICAgICAgIGNoYXIgKipwOworICAg
ICAgICAgICAgICAgICAgICAvKiBzZWUgc3Bhd25fc3R1Yl9sYXVuY2hfZG0oKSBmb3IgY29ubmVj
dGluZyBTVFVCRE9NX0NPTlNPTEVfU0VSSUFMICovCisgICAgICAgICAgICAgICAgICAgIGZvciAo
cCA9IGJfaW5mby0+dS5odm0uc2VyaWFsX2xpc3QsIGkgPSAwOworICAgICAgICAgICAgICAgICAg
ICAgICAgICpwOworICAgICAgICAgICAgICAgICAgICAgICAgIHArKywgaSsrKSB7CisgICAgICAg
ICAgICAgICAgICAgICAgICBpZiAoaXNfc3R1YmRvbSkKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBmbGV4YXJyYXlfdmFwcGVuZChkbV9hcmdzLAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICItc2VyaWFsIiwKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBHQ1NQUklOVEYoIi9kZXYvaHZjJWQiLCBTVFVCRE9NX0NP
TlNPTEVfU0VSSUFMICsgaSksCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgTlVMTCk7CisgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgZmxleGFycmF5X3ZhcHBlbmQoZG1fYXJncywKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLXNlcmlhbCIsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKnAsIE5VTEwpOworICAgICAgICAg
ICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgfQogICAgICAgICB9
CkBAIC0xMzcwLDcgKzEzOTAsNyBAQCBzdGF0aWMgaW50IGxpYnhsX19idWlsZF9kZXZpY2VfbW9k
ZWxfYXJnc19uZXcobGlieGxfX2djICpnYywKICAgICAgICAgICAgIGZsZXhhcnJheV9hcHBlbmQo
ZG1fYXJncywgIi1ub2dyYXBoaWMiKTsKICAgICAgICAgfQogCi0gICAgICAgIGlmIChsaWJ4bF9k
ZWZib29sX3ZhbChiX2luZm8tPnUuaHZtLnNwaWNlLmVuYWJsZSkpIHsKKyAgICAgICAgaWYgKGxp
YnhsX2RlZmJvb2xfdmFsKGJfaW5mby0+dS5odm0uc3BpY2UuZW5hYmxlKSAmJiAhaXNfc3R1YmRv
bSkgewogICAgICAgICAgICAgY29uc3QgbGlieGxfc3BpY2VfaW5mbyAqc3BpY2UgPSAmYl9pbmZv
LT51Lmh2bS5zcGljZTsKICAgICAgICAgICAgIGNoYXIgKnNwaWNlb3B0aW9ucyA9IGRtX3NwaWNl
X29wdGlvbnMoZ2MsIHNwaWNlKTsKICAgICAgICAgICAgIGlmICghc3BpY2VvcHRpb25zKQpAQCAt
MTc5Nyw3ICsxODE3LDkgQEAgc3RhdGljIGludCBsaWJ4bF9fYnVpbGRfZGV2aWNlX21vZGVsX2Fy
Z3NfbmV3KGxpYnhsX19nYyAqZ2MsCiAgICAgICAgICAgICAgKiBJZiBxZW11IGlzbid0IGRvaW5n
IHRoZSBpbnRlcnByZXRpbmcsIHRoZSBwYXJhbWV0ZXIgaXMKICAgICAgICAgICAgICAqIGFsd2F5
cyByYXcKICAgICAgICAgICAgICAqLwotICAgICAgICAgICAgaWYgKGRpc2tzW2ldLmJhY2tlbmQg
PT0gTElCWExfRElTS19CQUNLRU5EX1FESVNLKQorICAgICAgICAgICAgaWYgKGxpYnhsX2RlZmJv
b2xfdmFsKGJfaW5mby0+ZGV2aWNlX21vZGVsX3N0dWJkb21haW4pKQorICAgICAgICAgICAgICAg
IGZvcm1hdCA9ICJob3N0X2RldmljZSI7CisgICAgICAgICAgICBlbHNlIGlmIChkaXNrc1tpXS5i
YWNrZW5kID09IExJQlhMX0RJU0tfQkFDS0VORF9RRElTSykKICAgICAgICAgICAgICAgICBmb3Jt
YXQgPSBsaWJ4bF9fcWVtdV9kaXNrX2Zvcm1hdF9zdHJpbmcoZGlza3NbaV0uZm9ybWF0KTsKICAg
ICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICBmb3JtYXQgPSBsaWJ4bF9fcWVtdV9kaXNr
X2Zvcm1hdF9zdHJpbmcoTElCWExfRElTS19GT1JNQVRfUkFXKTsKQEAgLTE4MDgsNiArMTgzMCwx
NiBAQCBzdGF0aWMgaW50IGxpYnhsX19idWlsZF9kZXZpY2VfbW9kZWxfYXJnc19uZXcobGlieGxf
X2djICpnYywKICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNrc1tpXS52ZGV2KTsKICAgICAg
ICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgfQorICAgICAgICAgICAg
fSBlbHNlIGlmIChsaWJ4bF9kZWZib29sX3ZhbChiX2luZm8tPmRldmljZV9tb2RlbF9zdHViZG9t
YWluKSkgeworICAgICAgICAgICAgICAgIGlmIChkaXNrID4gJ3onIC0gJ2EnKSB7CisgICAgICAg
ICAgICAgICAgICAgIExPR0QoV0FSTiwgZ3Vlc3RfZG9taWQsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIkVtdWxhdGlvbiBvZiBvbmx5IGZpcnN0ICVkIGRpc2tzIGlzIHN1cHBvcnRlZCB3
aXRoIHFlbXUteGVuIGluIHN0dWJkb21haW4uXG4iCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIkRpc2sgJWQgd2lsbCBiZSBhdmFpbGFibGUgdmlhIFBWIGRyaXZlcnMgYnV0IG5vdCBhcyBh
biBlbXVsYXRlZCBkaXNrLiIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3onIC0gJ2En
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2spOworICAgICAgICAgICAgICAgICAg
ICBjb250aW51ZTsKKyAgICAgICAgICAgICAgICB9CisgICAgICAgICAgICAgICAgdGFyZ2V0X3Bh
dGggPSBHQ1NQUklOVEYoIi9kZXYveHZkJWMiLCAnYScgKyBkaXNrKTsKICAgICAgICAgICAgIH0g
ZWxzZSB7CiAgICAgICAgICAgICAgICAgaWYgKGZvcm1hdCA9PSBOVUxMKSB7CiAgICAgICAgICAg
ICAgICAgICAgIExPR0QoV0FSTiwgZ3Vlc3RfZG9taWQsCkBAIC0xOTQ4LDcgKzE5ODAsNyBAQCBz
dGF0aWMgaW50IGxpYnhsX19idWlsZF9kZXZpY2VfbW9kZWxfYXJncyhsaWJ4bF9fZ2MgKmdjLAog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYXIgKioqYXJncywgY2hh
ciAqKiplbnZzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0
IGxpYnhsX19kb21haW5fYnVpbGRfc3RhdGUgKnN0YXRlLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGludCAqZG1fc3RhdGVfZmQpCi0vKiBkbV9zdGF0ZV9mZCBtYXkg
YmUgTlVMTCBpZmYgY2FsbGVyIGtub3dzIHdlIGFyZSB1c2luZyBvbGQgc3R1YmRvbQorLyogZG1f
c3RhdGVfZmQgbWF5IGJlIE5VTEwgaWZmIGNhbGxlciBrbm93cyB3ZSBhcmUgdXNpbmcgc3R1YmRv
bQogICogYW5kIHRoZXJlZm9yZSB3aWxsIGJlIHBhc3NpbmcgYSBmaWxlbmFtZSByYXRoZXIgdGhh
biBhIGZkLiAqLwogewogICAgIHN3aXRjaCAoZ3Vlc3RfY29uZmlnLT5iX2luZm8uZGV2aWNlX21v
ZGVsX3ZlcnNpb24pIHsKQEAgLTE5NTgsOCArMTk5MCwxMCBAQCBzdGF0aWMgaW50IGxpYnhsX19i
dWlsZF9kZXZpY2VfbW9kZWxfYXJncyhsaWJ4bF9fZ2MgKmdjLAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzLCBlbnZzLAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZSk7CiAgICAgY2FzZSBM
SUJYTF9ERVZJQ0VfTU9ERUxfVkVSU0lPTl9RRU1VX1hFTjoKLSAgICAgICAgYXNzZXJ0KGRtX3N0
YXRlX2ZkICE9IE5VTEwpOwotICAgICAgICBhc3NlcnQoKmRtX3N0YXRlX2ZkIDwgMCk7CisgICAg
ICAgIGlmICghbGlieGxfZGVmYm9vbF92YWwoZ3Vlc3RfY29uZmlnLT5iX2luZm8uZGV2aWNlX21v
ZGVsX3N0dWJkb21haW4pKSB7CisgICAgICAgICAgICBhc3NlcnQoZG1fc3RhdGVfZmQgIT0gTlVM
TCk7CisgICAgICAgICAgICBhc3NlcnQoKmRtX3N0YXRlX2ZkIDwgMCk7CisJfQogICAgICAgICBy
ZXR1cm4gbGlieGxfX2J1aWxkX2RldmljZV9tb2RlbF9hcmdzX25ldyhnYywgZG0sCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGd1ZXN0X2RvbWlkLCBn
dWVzdF9jb25maWcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGFyZ3MsIGVudnMsCkBAIC0yMDY0LDYgKzIwOTgsMTYgQEAgcmV0cnlfdHJhbnNhY3Rp
b246CiAgICAgcmV0dXJuIDA7CiB9CiAKK3N0YXRpYyBpbnQgbGlieGxfX3N0b3JlX2xpYnhsX2Vu
dHJ5KGxpYnhsX19nYyAqZ2MsIHVpbnQzMl90IGRvbWlkLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgY29uc3QgY2hhciAqbmFtZSwgY29uc3QgY2hhciAqdmFsdWUpCit7Cisg
ICAgY2hhciAqcGF0aCA9IE5VTEw7CisKKyAgICBwYXRoID0gbGlieGxfX3hzX2xpYnhsX3BhdGgo
Z2MsIGRvbWlkKTsKKyAgICBwYXRoID0gbGlieGxfX3NwcmludGYoZ2MsICIlcy8lcyIsIHBhdGgs
IG5hbWUpOworICAgIHJldHVybiBsaWJ4bF9feHNfcHJpbnRmKGdjLCBYQlRfTlVMTCwgcGF0aCwg
IiVzIiwgdmFsdWUpOworfQorCiBzdGF0aWMgdm9pZCBkbXNzX2luaXQobGlieGxfX2RtX3NwYXdu
X3N0YXRlICpkbXNzKQogewogICAgIGxpYnhsX19ldl9xbXBfaW5pdCgmZG1zcy0+cW1wKTsKQEAg
LTIxMjIsMTAgKzIxNjYsMTQgQEAgdm9pZCBsaWJ4bF9fc3Bhd25fc3R1Yl9kbShsaWJ4bF9fZWdj
ICplZ2MsIGxpYnhsX19zdHViX2RtX3NwYXduX3N0YXRlICpzZHNzKQogICAgIGRtc3NfaW5pdCgm
c2Rzcy0+cHZxZW11KTsKICAgICBsaWJ4bF9feHN3YWl0X2luaXQoJnNkc3MtPnhzd2FpdCk7CiAK
LSAgICBpZiAoZ3Vlc3RfY29uZmlnLT5iX2luZm8uZGV2aWNlX21vZGVsX3ZlcnNpb24gIT0KLSAg
ICAgICAgTElCWExfREVWSUNFX01PREVMX1ZFUlNJT05fUUVNVV9YRU5fVFJBRElUSU9OQUwpIHsK
LSAgICAgICAgcmV0ID0gRVJST1JfSU5WQUw7Ci0gICAgICAgIGdvdG8gb3V0OworICAgIGFzc2Vy
dChsaWJ4bF9kZWZib29sX3ZhbChndWVzdF9jb25maWctPmJfaW5mby5kZXZpY2VfbW9kZWxfc3R1
YmRvbWFpbikpOworCisgICAgaWYgKGxpYnhsX19zdHViZG9tYWluX2lzX2xpbnV4KCZndWVzdF9j
b25maWctPmJfaW5mbykpIHsKKyAgICAgICAgaWYgKGRfc3RhdGUtPnNhdmVkX3N0YXRlKSB7Cisg
ICAgICAgICAgICBMT0coRVJST1IsICJTYXZlL1Jlc3RvcmUgbm90IHN1cHBvcnRlZCB5ZXQgd2l0
aCBMaW51eCBTdHViZG9tLiIpOworICAgICAgICAgICAgcmV0ID0gLTE7CisgICAgICAgICAgICBn
b3RvIG91dDsKKyAgICAgICAgfQogICAgIH0KIAogICAgIHNkc3MtPnB2cWVtdS5ndWVzdF9kb21p
ZCA9IDA7CkBAIC0yMTQ3LDggKzIxOTUsOCBAQCB2b2lkIGxpYnhsX19zcGF3bl9zdHViX2RtKGxp
YnhsX19lZ2MgKmVnYywgbGlieGxfX3N0dWJfZG1fc3Bhd25fc3RhdGUgKnNkc3MpCiAKICAgICBk
bV9jb25maWctPmJfaW5mby5zaGFkb3dfbWVta2IgPSAwOwogICAgIGRtX2NvbmZpZy0+Yl9pbmZv
Lm1heF92Y3B1cyA9IDE7Ci0gICAgZG1fY29uZmlnLT5iX2luZm8ubWF4X21lbWtiID0gMjggKiAx
MDI0ICsKLSAgICAgICAgZ3Vlc3RfY29uZmlnLT5iX2luZm8udmlkZW9fbWVta2I7CisgICAgZG1f
Y29uZmlnLT5iX2luZm8ubWF4X21lbWtiID0gZ3Vlc3RfY29uZmlnLT5iX2luZm8uc3R1YmRvbWFp
bl9tZW1rYjsKKyAgICBkbV9jb25maWctPmJfaW5mby5tYXhfbWVta2IgKz0gZ3Vlc3RfY29uZmln
LT5iX2luZm8udmlkZW9fbWVta2I7CiAgICAgZG1fY29uZmlnLT5iX2luZm8udGFyZ2V0X21lbWti
ID0gZG1fY29uZmlnLT5iX2luZm8ubWF4X21lbWtiOwogCiAgICAgZG1fY29uZmlnLT5iX2luZm8u
bWF4X2dyYW50X2ZyYW1lcyA9IGd1ZXN0X2NvbmZpZy0+Yl9pbmZvLm1heF9ncmFudF9mcmFtZXM7
CkBAIC0yMTg3LDEwICsyMjM1LDggQEAgdm9pZCBsaWJ4bF9fc3Bhd25fc3R1Yl9kbShsaWJ4bF9f
ZWdjICplZ2MsIGxpYnhsX19zdHViX2RtX3NwYXduX3N0YXRlICpzZHNzKQogICAgICAgICBkbV9j
b25maWctPm51bV92a2JzID0gMTsKICAgICB9CiAKLSAgICBzdHViZG9tX3N0YXRlLT5wdl9rZXJu
ZWwucGF0aAotICAgICAgICA9IGxpYnhsX19hYnNfcGF0aChnYywgImlvZW11LXN0dWJkb20uZ3oi
LCBsaWJ4bF9feGVuZmlybXdhcmVkaXJfcGF0aCgpKTsKLSAgICBzdHViZG9tX3N0YXRlLT5wdl9j
bWRsaW5lID0gR0NTUFJJTlRGKCIgLWQgJWQiLCBndWVzdF9kb21pZCk7Ci0gICAgc3R1YmRvbV9z
dGF0ZS0+cHZfcmFtZGlzay5wYXRoID0gIiI7CisgICAgc3R1YmRvbV9zdGF0ZS0+cHZfa2VybmVs
LnBhdGggPSBndWVzdF9jb25maWctPmJfaW5mby5zdHViZG9tYWluX2tlcm5lbDsKKyAgICBzdHVi
ZG9tX3N0YXRlLT5wdl9yYW1kaXNrLnBhdGggPSBndWVzdF9jb25maWctPmJfaW5mby5zdHViZG9t
YWluX3JhbWRpc2s7CiAKICAgICAvKiBmaXhtZTogdGhpcyBmdW5jdGlvbiBjYW4gbGVhayB0aGUg
c3R1YmRvbSBpZiBpdCBmYWlscyAqLwogICAgIHJldCA9IGxpYnhsX19kb21haW5fbWFrZShnYywg
ZG1fY29uZmlnLCBzdHViZG9tX3N0YXRlLApAQCAtMjIxMCw2ICsyMjU2LDggQEAgdm9pZCBsaWJ4
bF9fc3Bhd25fc3R1Yl9kbShsaWJ4bF9fZWdjICplZ2MsIGxpYnhsX19zdHViX2RtX3NwYXduX3N0
YXRlICpzZHNzKQogICAgICAgICBnb3RvIG91dDsKICAgICB9CiAKKyAgICBsaWJ4bF9fc3RvcmVf
bGlieGxfZW50cnkoZ2MsIGd1ZXN0X2RvbWlkLCAiZG0tdmVyc2lvbiIsCisgICAgICAgIGxpYnhs
X2RldmljZV9tb2RlbF92ZXJzaW9uX3RvX3N0cmluZyhkbV9jb25maWctPmJfaW5mby5kZXZpY2Vf
bW9kZWxfdmVyc2lvbikpOwogICAgIGxpYnhsX193cml0ZV9zdHViX2RtYXJncyhnYywgZG1fZG9t
aWQsIGd1ZXN0X2RvbWlkLCBhcmdzKTsKICAgICBsaWJ4bF9feHNfcHJpbnRmKGdjLCBYQlRfTlVM
TCwKICAgICAgICAgICAgICAgICAgICAgIEdDU1BSSU5URigiJXMvaW1hZ2UvZGV2aWNlLW1vZGVs
LWRvbWlkIiwKQEAgLTIyMTksNiArMjI2NywxNSBAQCB2b2lkIGxpYnhsX19zcGF3bl9zdHViX2Rt
KGxpYnhsX19lZ2MgKmVnYywgbGlieGxfX3N0dWJfZG1fc3Bhd25fc3RhdGUgKnNkc3MpCiAgICAg
ICAgICAgICAgICAgICAgICBHQ1NQUklOVEYoIiVzL3RhcmdldCIsCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgbGlieGxfX3hzX2dldF9kb21wYXRoKGdjLCBkbV9kb21pZCkpLAogICAg
ICAgICAgICAgICAgICAgICAgIiVkIiwgZ3Vlc3RfZG9taWQpOworICAgIGlmIChndWVzdF9jb25m
aWctPmJfaW5mby5kZXZpY2VfbW9kZWxfdmVyc2lvbiA9PSBMSUJYTF9ERVZJQ0VfTU9ERUxfVkVS
U0lPTl9RRU1VX1hFTikgeworICAgICAgICAvKiBxZW11LXhlbiBpcyB1c2VkIGFzIGEgZG0gaW4g
dGhlIHN0dWJkb21haW4sIHNvIHdlIHNldCB0aGUgYmlvcworICAgICAgICAgKiBhY2Nyb2Rpbmcg
dG8gdGhpcyAqLworICAgICAgICBsaWJ4bF9feHNfcHJpbnRmKGdjLCBYQlRfTlVMTCwKKyAgICAg
ICAgICAgICAgICAgICAgICAgIGxpYnhsX19zcHJpbnRmKGdjLCAiJXMvaHZtbG9hZGVyL2Jpb3Mi
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlieGxfX3hzX2dldF9k
b21wYXRoKGdjLCBndWVzdF9kb21pZCkpLAorICAgICAgICAgICAgICAgICAgICAgICAgIiVzIiwK
KyAgICAgICAgICAgICAgICAgICAgICAgIGxpYnhsX2Jpb3NfdHlwZV90b19zdHJpbmcoZ3Vlc3Rf
Y29uZmlnLT5iX2luZm8udS5odm0uYmlvcykpOworICAgIH0KICAgICByZXQgPSB4Y19kb21haW5f
c2V0X3RhcmdldChjdHgtPnhjaCwgZG1fZG9taWQsIGd1ZXN0X2RvbWlkKTsKICAgICBpZiAocmV0
PDApIHsKICAgICAgICAgTE9HRUQoRVJST1IsIGd1ZXN0X2RvbWlkLCAic2V0dGluZyB0YXJnZXQg
ZG9tYWluICVkIC0+ICVkIiwKQEAgLTIzMDAsNiArMjM1NywxMSBAQCBzdGF0aWMgdm9pZCBzcGF3
bl9zdHViX2xhdW5jaF9kbShsaWJ4bF9fZWdjICplZ2MsCiAKICAgICBpZiAoZ3Vlc3RfY29uZmln
LT5iX2luZm8udS5odm0uc2VyaWFsKQogICAgICAgICBudW1fY29uc29sZSsrOworICAgIGVsc2Ug
aWYgKGd1ZXN0X2NvbmZpZy0+Yl9pbmZvLnUuaHZtLnNlcmlhbF9saXN0KSB7CisgICAgICAgIGNo
YXIgKipzZXJpYWwgPSBndWVzdF9jb25maWctPmJfaW5mby51Lmh2bS5zZXJpYWxfbGlzdDsKKyAg
ICAgICAgd2hpbGUgKCooc2VyaWFsKyspKQorICAgICAgICAgICAgbnVtX2NvbnNvbGUrKzsKKyAg
ICB9CiAKICAgICBjb25zb2xlID0gbGlieGxfX2NhbGxvYyhnYywgbnVtX2NvbnNvbGUsIHNpemVv
ZihsaWJ4bF9fZGV2aWNlX2NvbnNvbGUpKTsKIApAQCAtMjMzMyw4ICsyMzk1LDE4IEBAIHN0YXRp
YyB2b2lkIHNwYXduX3N0dWJfbGF1bmNoX2RtKGxpYnhsX19lZ2MgKmVnYywKICAgICAgICAgICAg
ICAgICAgICAgY29uc29sZVtpXS5vdXRwdXQgPQogICAgICAgICAgICAgICAgICAgICAgICAgR0NT
UFJJTlRGKCJwaXBlOiVzIiwgZF9zdGF0ZS0+c2F2ZWRfc3RhdGUpOwogICAgICAgICAgICAgICAg
IGJyZWFrOworICAgICAgICAgICAgY2FzZSBTVFVCRE9NX0NPTlNPTEVfU0VSSUFMOgorICAgICAg
ICAgICAgICAgIGlmIChndWVzdF9jb25maWctPmJfaW5mby51Lmh2bS5zZXJpYWwpIHsKKyAgICAg
ICAgICAgICAgICAgICAgY29uc29sZVtpXS5vdXRwdXQgPSBndWVzdF9jb25maWctPmJfaW5mby51
Lmh2bS5zZXJpYWw7CisgICAgICAgICAgICAgICAgICAgIGJyZWFrOworICAgICAgICAgICAgICAg
IH0KKyAgICAgICAgICAgICAgICAvKiBmYWxsLXRocm91Z2ggKi8KICAgICAgICAgICAgIGRlZmF1
bHQ6Ci0gICAgICAgICAgICAgICAgY29uc29sZVtpXS5vdXRwdXQgPSAicHR5IjsKKyAgICAgICAg
ICAgICAgICAvKiBTZXJpYWxfbGlzdCBpcyBzZXQsIGFzIG90aGVyd2lzZSBudW1fY29uc29sZXMg
d291bGQgYmUKKyAgICAgICAgICAgICAgICAgKiBzbWFsbGVyIGFuZCBjb25zb2xlcyAwLTIgYXJl
IGhhbmRsZWQgYWJvdmUuICovCisgICAgICAgICAgICAgICAgYXNzZXJ0KGd1ZXN0X2NvbmZpZy0+
Yl9pbmZvLnUuaHZtLnNlcmlhbF9saXN0KTsKKyAgICAgICAgICAgICAgICBjb25zb2xlW2ldLm91
dHB1dCA9IGd1ZXN0X2NvbmZpZy0+Yl9pbmZvLnUuaHZtLnNlcmlhbF9saXN0WworICAgICAgICAg
ICAgICAgICAgICBpLVNUVUJET01fQ09OU09MRV9TRVJJQUxdOwogICAgICAgICAgICAgICAgIGJy
ZWFrOwogICAgICAgICB9CiAgICAgfQpkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGlieGxfaW50
ZXJuYWwuaCBiL3Rvb2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmgKaW5kZXggY2MzY2YyNi4uMmI0
YTFjYyAxMDA2NDQKLS0tIGEvdG9vbHMvbGlieGwvbGlieGxfaW50ZXJuYWwuaAorKysgYi90b29s
cy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5oCkBAIC0xMTksNiArMTE5LDcgQEAKICNkZWZpbmUgU1RV
QkRPTV9DT05TT0xFX1JFU1RPUkUgMgogI2RlZmluZSBTVFVCRE9NX0NPTlNPTEVfU0VSSUFMIDMK
ICNkZWZpbmUgU1RVQkRPTV9TUEVDSUFMX0NPTlNPTEVTIDMKKyNkZWZpbmUgTElCWExfTElOVVhf
U1RVQkRPTV9NRU0gMTI4CiAjZGVmaW5lIFRBUF9ERVZJQ0VfU1VGRklYICItZW11IgogI2RlZmlu
ZSBET01JRF9YU19QQVRIICJkb21pZCIKICNkZWZpbmUgSU5WQUxJRF9ET01JRCB+MApkaWZmIC0t
Z2l0IGEvdG9vbHMvbGlieGwvbGlieGxfbWVtLmMgYi90b29scy9saWJ4bC9saWJ4bF9tZW0uYwpp
bmRleCA3YzAxZmFjLi42NTk1N2E0IDEwMDY0NAotLS0gYS90b29scy9saWJ4bC9saWJ4bF9tZW0u
YworKysgYi90b29scy9saWJ4bC9saWJ4bF9tZW0uYwpAQCAtNDU5LDggKzQ1OSwxMCBAQCBpbnQg
bGlieGxfX2RvbWFpbl9uZWVkX21lbW9yeV9jYWxjdWxhdGUobGlieGxfX2djICpnYywKICAgICBj
YXNlIExJQlhMX0RPTUFJTl9UWVBFX1BWSDoKICAgICBjYXNlIExJQlhMX0RPTUFJTl9UWVBFX0hW
TToKICAgICAgICAgKm5lZWRfbWVta2IgKz0gTElCWExfSFZNX0VYVFJBX01FTU9SWTsKLSAgICAg
ICAgaWYgKGxpYnhsX2RlZmJvb2xfdmFsKGJfaW5mby0+ZGV2aWNlX21vZGVsX3N0dWJkb21haW4p
KQotICAgICAgICAgICAgKm5lZWRfbWVta2IgKz0gMzIgKiAxMDI0OworICAgICAgICBpZiAobGli
eGxfZGVmYm9vbF92YWwoYl9pbmZvLT5kZXZpY2VfbW9kZWxfc3R1YmRvbWFpbikpIHsKKyAgICAg
ICAgICAgICpuZWVkX21lbWtiICs9IGJfaW5mby0+c3R1YmRvbWFpbl9tZW1rYjsKKyAgICAgICAg
ICAgICpuZWVkX21lbWtiICs9IGJfaW5mby0+dmlkZW9fbWVta2I7CisgICAgICAgIH0KICAgICAg
ICAgYnJlYWs7CiAgICAgY2FzZSBMSUJYTF9ET01BSU5fVFlQRV9QVjoKICAgICAgICAgKm5lZWRf
bWVta2IgKz0gTElCWExfUFZfRVhUUkFfTUVNT1JZOwpkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwv
bGlieGxfdHlwZXMuaWRsIGIvdG9vbHMvbGlieGwvbGlieGxfdHlwZXMuaWRsCmluZGV4IDc5MjE5
NTAuLjAxMTY3NmYgMTAwNjQ0Ci0tLSBhL3Rvb2xzL2xpYnhsL2xpYnhsX3R5cGVzLmlkbAorKysg
Yi90b29scy9saWJ4bC9saWJ4bF90eXBlcy5pZGwKQEAgLTUxNiw2ICs1MTYsOSBAQCBsaWJ4bF9k
b21haW5fYnVpbGRfaW5mbyA9IFN0cnVjdCgiZG9tYWluX2J1aWxkX2luZm8iLFsKICAgICAKICAg
ICAoImRldmljZV9tb2RlbF92ZXJzaW9uIiwgbGlieGxfZGV2aWNlX21vZGVsX3ZlcnNpb24pLAog
ICAgICgiZGV2aWNlX21vZGVsX3N0dWJkb21haW4iLCBsaWJ4bF9kZWZib29sKSwKKyAgICAoInN0
dWJkb21haW5fbWVta2IiLCAgIE1lbUtCKSwKKyAgICAoInN0dWJkb21haW5fa2VybmVsIiwgIHN0
cmluZyksCisgICAgKCJzdHViZG9tYWluX3JhbWRpc2siLCBzdHJpbmcpLAogICAgICMgaWYgeW91
IHNldCBkZXZpY2VfbW9kZWwgeW91IG11c3Qgc2V0IGRldmljZV9tb2RlbF92ZXJzaW9uIHRvbwog
ICAgICgiZGV2aWNlX21vZGVsIiwgICAgIHN0cmluZyksCiAgICAgKCJkZXZpY2VfbW9kZWxfc3Np
ZHJlZiIsIHVpbnQzMiksCi0tIApnaXQtc2VyaWVzIDAuOS4xCgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1k
ZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21h
aWxtYW4vbGlzdGluZm8veGVuLWRldmVs

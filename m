Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 1A651274343
	for <lists+xen-devel@lfdr.de>; Tue, 22 Sep 2020 15:37:50 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.92)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1kKiUJ-0001nj-A1; Tue, 22 Sep 2020 13:37:43 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.92) (envelope-from
 <SRS0=pzSo=C7=xenbits.xen.org=iwj@srs-us1.protection.inumbo.net>)
 id 1kKiUH-0001gf-7s
 for xen-devel@lists.xen.org; Tue, 22 Sep 2020 13:37:41 +0000
X-Inumbo-ID: 3dd34aa5-cfdb-481b-a354-6bc891271e7b
Received: from mail.xenproject.org (unknown [104.130.215.37])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 3dd34aa5-cfdb-481b-a354-6bc891271e7b;
 Tue, 22 Sep 2020 13:37:20 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed; d=xen.org;
 s=20200302mail; h=Date:Message-Id:Subject:CC:From:To:MIME-Version:
 Content-Transfer-Encoding:Content-Type;
 bh=gP0z4GQKK0DBHV6xyPcPidrYqBmgOn41Y/H4SIQLckQ=; b=WndxGrN3ol1mkZMe0bSzdnzY0r
 CwrtKOTJuuJ/MHXJhk3uL+IXYj/vGvv8nLHHmGVkKdIFh8ujODGDErxHSO5r3v07cdyoN87RjxqIX
 MocXkTiXXlsqHCQjQMTzUyINuesRpBzwIxSzej63QwE88duF1rcHpF2w8m7Xte+iX3To=;
Received: from xenbits.xenproject.org ([104.239.192.120])
 by mail.xenproject.org with esmtp (Exim 4.92)
 (envelope-from <iwj@xenbits.xen.org>)
 id 1kKiTr-0006p5-L8; Tue, 22 Sep 2020 13:37:15 +0000
Received: from iwj by xenbits.xenproject.org with local (Exim 4.92)
 (envelope-from <iwj@xenbits.xen.org>)
 id 1kKiTr-0002Ip-K6; Tue, 22 Sep 2020 13:37:15 +0000
Content-Type: multipart/mixed; boundary="=separator"; charset="utf-8"
Content-Transfer-Encoding: binary
MIME-Version: 1.0
X-Mailer: MIME-tools 5.509 (Entity 5.509)
To: xen-announce@lists.xen.org, xen-devel@lists.xen.org,
 xen-users@lists.xen.org, oss-security@lists.openwall.com
From: Xen.org security team <security@xen.org>
CC: Xen.org security team <security-team-members@xen.org>
Subject: Xen Security Advisory 336 v3 (CVE-2020-25604) - race when
 migrating timers between x86 HVM vCPU-s
Message-Id: <E1kKiTr-0002Ip-K6@xenbits.xenproject.org>
Date: Tue, 22 Sep 2020 13:37:15 +0000
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

--=separator
Content-Type: text/plain; charset="utf-8"
Content-Disposition: inline
Content-Transfer-Encoding: 7bit

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

            Xen Security Advisory CVE-2020-25604 / XSA-336
                               version 3

           race when migrating timers between x86 HVM vCPU-s

UPDATES IN VERSION 3
====================

Public release.

ISSUE DESCRIPTION
=================

When migrating timers of x86 HVM guests between its vCPU-s, the locking
model used allows for a second vCPU of the same guest also operating on
the timers to release a lock that it didn't acquire.

IMPACT
======

The most likely effect of the issue is a hang or crash of the
hypervisor, i.e. a Denial of Service (DoS).

VULNERABLE SYSTEMS
==================

All versions of Xen are affected.

Only x86 systems are vulnerable.  Arm systems are not vulnerable.

Only x86 HVM guests can leverage the vulnerability.  x86 PV and PVH
cannot leverage the vulnerability.

Only guests with more than one vCPU can exploit the vulnerability.

MITIGATION
==========

Running only PV and PVH guests will avoid the vulnerability.

CREDITS
=======

This issue was discovered by Igor Druzhinin of Citrix.

RESOLUTION
==========

Applying the appropriate attached patch resolves this issue.

Note that patches for released versions are generally prepared to
apply to the stable branches, and may not apply cleanly to the most
recent release tarball.  Downstreams are encouraged to update to the
tip of the stable branch before applying these patches.

xsa336.patch           Xen 4.12 - xen-unstable
xsa336-4.11.patch      Xen 4.10 - 4.11

$ sha256sum xsa336*
6cb13a54c2b0fcb6948a1c4045095da4e43aad262a1dd8993ea2a3bd90d4c72d  xsa336.meta
ecb59876fb92cfe0916ed5f3227a30efe038224c1f6ec36bc3706c4e2214552c  xsa336.patch
c0c7983bfd70eb54277af9fddfcc3cc95bbd745d92d9ffb71d5b32281c437510  xsa336-4.11.patch
$

DEPLOYMENT DURING EMBARGO
=========================

Deployment of the patches and/or mitigations described above (or
others which are substantially similar) is permitted during the
embargo, even on public-facing systems with untrusted guest users and
administrators.

But: Distribution of updated software is prohibited (except to other
members of the predisclosure list).

Predisclosure list members who wish to deploy significantly different
patches and/or mitigations, please contact the Xen Project Security
Team.

(Note: this during-embargo deployment notice is retained in
post-embargo publicly released Xen Project advisories, even though it
is then no longer applicable.  This is to enable the community to have
oversight of the Xen Project Security Team's decisionmaking.)

For more information about permissible uses of embargoed information,
consult the Xen Project community's agreed Security Policy:
  http://www.xenproject.org/security-policy.html
-----BEGIN PGP SIGNATURE-----

iQFABAEBCAAqFiEEI+MiLBRfRHX6gGCng/4UyVfoK9kFAl9p/eYMHHBncEB4ZW4u
b3JnAAoJEIP+FMlX6CvZe28H/3oTZLe4eVhykU7a+BbN7ENJ2WMYsj0VM5wUiQyK
ZrY3CnbO0ne6h0BeAgSNG1XRP9QvwJLOIm6gZkqoNCWyJK2IbCO/mlF4czBlpUBR
FtM2wJz4FLzkiYMozk8TOZk6pCW6gaqxNiYr2L/3ijh2PQCMwnte/u+T3mZAAWxB
nJbVnwux26nvRY/5XBZ7cZ/Qxi1DKed2cyf2A9oZ/AmGIMBT2r6SZ+arf+d4jHRG
yQok+7gdXr1lOL/pPZZWepHtbPJMrrYxQZN/zKGt20c9ksBLiOyyQxTO4tegLx7N
PxRgzy+DgY+xqYFA68xpM6jJxfWYmHpjAtbYtQoPvyPsIag=
=0Kkw
-----END PGP SIGNATURE-----

--=separator
Content-Type: application/octet-stream; name="xsa336.meta"
Content-Disposition: attachment; filename="xsa336.meta"
Content-Transfer-Encoding: base64

ewogICJYU0EiOiAzMzYsCiAgIlN1cHBvcnRlZFZlcnNpb25zIjogWwogICAg
Im1hc3RlciIsCiAgICAiNC4xNCIsCiAgICAiNC4xMyIsCiAgICAiNC4xMiIs
CiAgICAiNC4xMSIsCiAgICAiNC4xMCIKICBdLAogICJUcmVlcyI6IFsKICAg
ICJ4ZW4iCiAgXSwKICAiUmVjaXBlcyI6IHsKICAgICI0LjEwIjogewogICAg
ICAiUmVjaXBlcyI6IHsKICAgICAgICAieGVuIjogewogICAgICAgICAgIlN0
YWJsZVJlZiI6ICI5M2JlOTQzZTdkNzU5MDE1YmQ1ZGI0MWE0OGY2ZGNlNThl
NTgwZDVhIiwKICAgICAgICAgICJQcmVyZXFzIjogW10sCiAgICAgICAgICAi
UGF0Y2hlcyI6IFsKICAgICAgICAgICAgInhzYTMzNi00LjExLnBhdGNoIgog
ICAgICAgICAgXQogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgICI0LjEx
IjogewogICAgICAiUmVjaXBlcyI6IHsKICAgICAgICAieGVuIjogewogICAg
ICAgICAgIlN0YWJsZVJlZiI6ICJkZGFhY2NiYmFiNmIxOWJmMjFlZDJjMDk3
ZjMwNTVhM2MyNTQ0YzhkIiwKICAgICAgICAgICJQcmVyZXFzIjogWwogICAg
ICAgICAgICAzMzMKICAgICAgICAgIF0sCiAgICAgICAgICAiUGF0Y2hlcyI6
IFsKICAgICAgICAgICAgInhzYTMzNi00LjExLnBhdGNoIgogICAgICAgICAg
XQogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgICI0LjEyIjogewogICAg
ICAiUmVjaXBlcyI6IHsKICAgICAgICAieGVuIjogewogICAgICAgICAgIlN0
YWJsZVJlZiI6ICIxMzM2Y2ExNzc0MjQ3MWZjNGE1OTg3OWFlMmY2MzdhNTk1
MzBhOTMzIiwKICAgICAgICAgICJQcmVyZXFzIjogWwogICAgICAgICAgICAz
MzMsCiAgICAgICAgICAgIDMzNAogICAgICAgICAgXSwKICAgICAgICAgICJQ
YXRjaGVzIjogWwogICAgICAgICAgICAieHNhMzM2LnBhdGNoIgogICAgICAg
ICAgXQogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgICI0LjEzIjogewog
ICAgICAiUmVjaXBlcyI6IHsKICAgICAgICAieGVuIjogewogICAgICAgICAg
IlN0YWJsZVJlZiI6ICI5YjM2N2IyYjBiNzE0ZjNmZmI2OWVkNmJlMGExMThl
OGQzZWFjMDdmIiwKICAgICAgICAgICJQcmVyZXFzIjogWwogICAgICAgICAg
ICAzMzMsCiAgICAgICAgICAgIDMzNAogICAgICAgICAgXSwKICAgICAgICAg
ICJQYXRjaGVzIjogWwogICAgICAgICAgICAieHNhMzM2LnBhdGNoIgogICAg
ICAgICAgXQogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgICI0LjE0Ijog
ewogICAgICAiUmVjaXBlcyI6IHsKICAgICAgICAieGVuIjogewogICAgICAg
ICAgIlN0YWJsZVJlZiI6ICJjM2EwZmMyMmFmOTBlZjI4ZTY4YjExNmM2YTQ5
ZDljZWM1N2Y3MWNmIiwKICAgICAgICAgICJQcmVyZXFzIjogWwogICAgICAg
ICAgICAzMzMsCiAgICAgICAgICAgIDMzNAogICAgICAgICAgXSwKICAgICAg
ICAgICJQYXRjaGVzIjogWwogICAgICAgICAgICAieHNhMzM2LnBhdGNoIgog
ICAgICAgICAgXQogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgICJtYXN0
ZXIiOiB7CiAgICAgICJSZWNpcGVzIjogewogICAgICAgICJ4ZW4iOiB7CiAg
ICAgICAgICAiU3RhYmxlUmVmIjogImIxMTkxMDA4MmQ5MGJiMTU5N2Y2Njc5
NTI0ZWI3MjZhMzMzMDY2NzIiLAogICAgICAgICAgIlByZXJlcXMiOiBbCiAg
ICAgICAgICAgIDMzMywKICAgICAgICAgICAgMzM0CiAgICAgICAgICBdLAog
ICAgICAgICAgIlBhdGNoZXMiOiBbCiAgICAgICAgICAgICJ4c2EzMzYucGF0
Y2giCiAgICAgICAgICBdCiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQp9

--=separator
Content-Type: application/octet-stream; name="xsa336.patch"
Content-Disposition: attachment; filename="xsa336.patch"
Content-Transfer-Encoding: base64

RnJvbTogUm9nZXIgUGF1IE1vbm7DqSA8cm9nZXIucGF1QGNpdHJpeC5jb20+
ClN1YmplY3Q6IHg4Ni92cHQ6IGZpeCByYWNlIHdoZW4gbWlncmF0aW5nIHRp
bWVycyBiZXR3ZWVuIHZDUFVzCgpUaGUgY3VycmVudCB2UFQgY29kZSB3aWxs
IG1pZ3JhdGUgdGhlIGVtdWxhdGVkIHRpbWVycyBiZXR3ZWVuIHZDUFVzCihj
aGFuZ2UgdGhlIHB0LT52Y3B1IGZpZWxkKSB3aGlsZSBqdXN0IGhvbGRpbmcg
dGhlIGRlc3RpbmF0aW9uIGxvY2ssCmVpdGhlciBmcm9tIGNyZWF0ZV9wZXJp
b2RpY190aW1lIG9yIHB0X2FkanVzdF9nbG9iYWxfdmNwdV90YXJnZXQgaWYK
dGhlIGdsb2JhbCB0YXJnZXQgaXMgYWRqdXN0ZWQuIENoYW5naW5nIHRoZSBw
ZXJpb2RpY190aW1lciB2Q1BVIGZpZWxkCmluIHRoaXMgd2F5IGNyZWF0ZXMg
YSByYWNlIHdoZXJlIGEgdGhpcmQgcGFydHkgY291bGQgZ3JhYiB0aGUgbG9j
ayBpbgp0aGUgdW5sb2NrZWQgcmVnaW9uIG9mIHB0X2FkanVzdF9nbG9iYWxf
dmNwdV90YXJnZXQgKG9yIGJlZm9yZQpjcmVhdGVfcGVyaW9kaWNfdGltZSBw
ZXJmb3JtcyB0aGUgdmNwdSBjaGFuZ2UpIGFuZCB0aGVuIHJlbGVhc2UgdGhl
CmxvY2sgZnJvbSBhIGRpZmZlcmVudCB2Q1BVLCBjcmVhdGluZyBhIGxvY2tp
bmcgaW1iYWxhbmNlLgoKSW50cm9kdWNlIGEgcGVyLWRvbWFpbiByd2xvY2sg
aW4gb3JkZXIgdG8gcHJvdGVjdCBwZXJpb2RpY190aW1lCm1pZ3JhdGlvbiBi
ZXR3ZWVuIHZDUFUgbGlzdHMuIFRha2luZyB0aGUgbG9jayBpbiByZWFkIG1v
ZGUgcHJldmVudHMKYW55IHRpbWVyIGZyb20gYmVpbmcgbWlncmF0ZWQgdG8g
YSBkaWZmZXJlbnQgdkNQVSwgd2hpbGUgdGFraW5nIGl0IGluCndyaXRlIG1v
ZGUgYWxsb3dzIHBlcmZvcm1pbmcgbWlncmF0aW9uIG9mIHRpbWVycyBhY3Jv
c3MgdkNQVXMuIFRoZQpwZXItdmNwdSBsb2NrcyBhcmUgc3RpbGwgdXNlZCB0
byBwcm90ZWN0IGFsbCB0aGUgb3RoZXIgZmllbGRzIGZyb20gdGhlCnBlcmlv
ZGljX3RpbWVyIHN0cnVjdC4KCk5vdGUgdGhhdCBzdWNoIG1pZ3JhdGlvbiBz
aG91bGRuJ3QgaGFwcGVuIGZyZXF1ZW50bHksIGFuZCBoZW5jZQp0aGVyZSdz
IG5vIHBlcmZvcm1hbmNlIGRyb3AgYXMgYSByZXN1bHQgb2Ygc3VjaCBsb2Nr
aW5nLgoKVGhpcyBpcyBYU0EtMzM2LgoKUmVwb3J0ZWQtYnk6IElnb3IgRHJ1
emhpbmluIDxpZ29yLmRydXpoaW5pbkBjaXRyaXguY29tPgpUZXN0ZWQtYnk6
IElnb3IgRHJ1emhpbmluIDxpZ29yLmRydXpoaW5pbkBjaXRyaXguY29tPgpT
aWduZWQtb2ZmLWJ5OiBSb2dlciBQYXUgTW9ubsOpIDxyb2dlci5wYXVAY2l0
cml4LmNvbT4KUmV2aWV3ZWQtYnk6IEphbiBCZXVsaWNoIDxqYmV1bGljaEBz
dXNlLmNvbT4KLS0tCkNoYW5nZXMgc2luY2UgdjI6CiAtIFJlLW9yZGVyIHB0
X2FkanVzdF92Y3B1IHRvIHJlbW92ZSBvbmUgaWYuCiAtIEZpeCBwdF9sb2Nr
IHRvIG5vdCBjYWxsIHB0X3ZjcHVfbG9jaywgYXMgd2UgbWlnaHQgZW5kIHVw
IHVzaW5nIGEKICAgc3RhbGUgdmFsdWUgb2YgcHQtPnZjcHUgd2hlbiB0YWtp
bmcgdGhlIHBlci12Y3B1IGxvY2suCgpDaGFuZ2VzIHNpbmNlIHYxOgogLSBV
c2UgYSBwZXItZG9tYWluIHJ3bG9jayB0byBwcm90ZWN0IHRpbWVyIHZDUFUg
bWlncmF0aW9uLgoKLS0tIGEveGVuL2FyY2gveDg2L2h2bS9odm0uYworKysg
Yi94ZW4vYXJjaC94ODYvaHZtL2h2bS5jCkBAIC02NTgsNiArNjU4LDggQEAg
aW50IGh2bV9kb21haW5faW5pdGlhbGlzZShzdHJ1Y3QgZG9tYWluCiAgICAg
LyogbmVlZCBsaW5rIHRvIGNvbnRhaW5pbmcgZG9tYWluICovCiAgICAgZC0+
YXJjaC5odm0ucGxfdGltZS0+ZG9tYWluID0gZDsKIAorICAgIHJ3bG9ja19p
bml0KCZkLT5hcmNoLmh2bS5wbF90aW1lLT5wdF9taWdyYXRlKTsKKwogICAg
IC8qIFNldCB0aGUgZGVmYXVsdCBJTyBCaXRtYXAuICovCiAgICAgaWYgKCBp
c19oYXJkd2FyZV9kb21haW4oZCkgKQogICAgIHsKLS0tIGEveGVuL2FyY2gv
eDg2L2h2bS92cHQuYworKysgYi94ZW4vYXJjaC94ODYvaHZtL3ZwdC5jCkBA
IC0xNTMsMjMgKzE1MywzMiBAQCBzdGF0aWMgaW50IHB0X2lycV9tYXNrZWQo
c3RydWN0IHBlcmlvZGljCiAgICAgcmV0dXJuIDE7CiB9CiAKLXN0YXRpYyB2
b2lkIHB0X2xvY2soc3RydWN0IHBlcmlvZGljX3RpbWUgKnB0KQorc3RhdGlj
IHZvaWQgcHRfdmNwdV9sb2NrKHN0cnVjdCB2Y3B1ICp2KQogewotICAgIHN0
cnVjdCB2Y3B1ICp2OworICAgIHJlYWRfbG9jaygmdi0+ZG9tYWluLT5hcmNo
Lmh2bS5wbF90aW1lLT5wdF9taWdyYXRlKTsKKyAgICBzcGluX2xvY2soJnYt
PmFyY2guaHZtLnRtX2xvY2spOworfQogCi0gICAgZm9yICggOyA7ICkKLSAg
ICB7Ci0gICAgICAgIHYgPSBwdC0+dmNwdTsKLSAgICAgICAgc3Bpbl9sb2Nr
KCZ2LT5hcmNoLmh2bS50bV9sb2NrKTsKLSAgICAgICAgaWYgKCBsaWtlbHko
cHQtPnZjcHUgPT0gdikgKQotICAgICAgICAgICAgYnJlYWs7Ci0gICAgICAg
IHNwaW5fdW5sb2NrKCZ2LT5hcmNoLmh2bS50bV9sb2NrKTsKLSAgICB9Citz
dGF0aWMgdm9pZCBwdF92Y3B1X3VubG9jayhzdHJ1Y3QgdmNwdSAqdikKK3sK
KyAgICBzcGluX3VubG9jaygmdi0+YXJjaC5odm0udG1fbG9jayk7CisgICAg
cmVhZF91bmxvY2soJnYtPmRvbWFpbi0+YXJjaC5odm0ucGxfdGltZS0+cHRf
bWlncmF0ZSk7Cit9CisKK3N0YXRpYyB2b2lkIHB0X2xvY2soc3RydWN0IHBl
cmlvZGljX3RpbWUgKnB0KQoreworICAgIC8qCisgICAgICogV2UgY2Fubm90
IHVzZSBwdF92Y3B1X2xvY2sgaGVyZSwgYmVjYXVzZSB3ZSBuZWVkIHRvIGFj
cXVpcmUgdGhlCisgICAgICogcGVyLWRvbWFpbiBsb2NrIGZpcnN0IGFuZCB0
aGVuIChyZS0pZmV0Y2ggdGhlIHZhbHVlIG9mIHB0LT52Y3B1LCBvcgorICAg
ICAqIGVsc2Ugd2UgbWlnaHQgYmUgdXNpbmcgYSBzdGFsZSB2YWx1ZSBvZiBw
dC0+dmNwdS4KKyAgICAgKi8KKyAgICByZWFkX2xvY2soJnB0LT52Y3B1LT5k
b21haW4tPmFyY2guaHZtLnBsX3RpbWUtPnB0X21pZ3JhdGUpOworICAgIHNw
aW5fbG9jaygmcHQtPnZjcHUtPmFyY2guaHZtLnRtX2xvY2spOwogfQogCiBz
dGF0aWMgdm9pZCBwdF91bmxvY2soc3RydWN0IHBlcmlvZGljX3RpbWUgKnB0
KQogewotICAgIHNwaW5fdW5sb2NrKCZwdC0+dmNwdS0+YXJjaC5odm0udG1f
bG9jayk7CisgICAgcHRfdmNwdV91bmxvY2socHQtPnZjcHUpOwogfQogCiBz
dGF0aWMgdm9pZCBwdF9wcm9jZXNzX21pc3NlZF90aWNrcyhzdHJ1Y3QgcGVy
aW9kaWNfdGltZSAqcHQpCkBAIC0yMTksNyArMjI4LDcgQEAgdm9pZCBwdF9z
YXZlX3RpbWVyKHN0cnVjdCB2Y3B1ICp2KQogICAgIGlmICggdi0+cGF1c2Vf
ZmxhZ3MgJiBWUEZfYmxvY2tlZCApCiAgICAgICAgIHJldHVybjsKIAotICAg
IHNwaW5fbG9jaygmdi0+YXJjaC5odm0udG1fbG9jayk7CisgICAgcHRfdmNw
dV9sb2NrKHYpOwogCiAgICAgbGlzdF9mb3JfZWFjaF9lbnRyeSAoIHB0LCBo
ZWFkLCBsaXN0ICkKICAgICAgICAgaWYgKCAhcHQtPmRvX25vdF9mcmVlemUg
KQpAQCAtMjI3LDcgKzIzNiw3IEBAIHZvaWQgcHRfc2F2ZV90aW1lcihzdHJ1
Y3QgdmNwdSAqdikKIAogICAgIHB0X2ZyZWV6ZV90aW1lKHYpOwogCi0gICAg
c3Bpbl91bmxvY2soJnYtPmFyY2guaHZtLnRtX2xvY2spOworICAgIHB0X3Zj
cHVfdW5sb2NrKHYpOwogfQogCiB2b2lkIHB0X3Jlc3RvcmVfdGltZXIoc3Ry
dWN0IHZjcHUgKnYpCkBAIC0yMzUsNyArMjQ0LDcgQEAgdm9pZCBwdF9yZXN0
b3JlX3RpbWVyKHN0cnVjdCB2Y3B1ICp2KQogICAgIHN0cnVjdCBsaXN0X2hl
YWQgKmhlYWQgPSAmdi0+YXJjaC5odm0udG1fbGlzdDsKICAgICBzdHJ1Y3Qg
cGVyaW9kaWNfdGltZSAqcHQ7CiAKLSAgICBzcGluX2xvY2soJnYtPmFyY2gu
aHZtLnRtX2xvY2spOworICAgIHB0X3ZjcHVfbG9jayh2KTsKIAogICAgIGxp
c3RfZm9yX2VhY2hfZW50cnkgKCBwdCwgaGVhZCwgbGlzdCApCiAgICAgewpA
QCAtMjQ4LDcgKzI1Nyw3IEBAIHZvaWQgcHRfcmVzdG9yZV90aW1lcihzdHJ1
Y3QgdmNwdSAqdikKIAogICAgIHB0X3RoYXdfdGltZSh2KTsKIAotICAgIHNw
aW5fdW5sb2NrKCZ2LT5hcmNoLmh2bS50bV9sb2NrKTsKKyAgICBwdF92Y3B1
X3VubG9jayh2KTsKIH0KIAogc3RhdGljIHZvaWQgcHRfdGltZXJfZm4odm9p
ZCAqZGF0YSkKQEAgLTMwOSw3ICszMTgsNyBAQCBpbnQgcHRfdXBkYXRlX2ly
cShzdHJ1Y3QgdmNwdSAqdikKICAgICBpbnQgaXJxLCBwdF92ZWN0b3IgPSAt
MTsKICAgICBib29sIGxldmVsOwogCi0gICAgc3Bpbl9sb2NrKCZ2LT5hcmNo
Lmh2bS50bV9sb2NrKTsKKyAgICBwdF92Y3B1X2xvY2sodik7CiAKICAgICBl
YXJsaWVzdF9wdCA9IE5VTEw7CiAgICAgbWF4X2xhZyA9IC0xVUxMOwpAQCAt
MzM5LDcgKzM0OCw3IEBAIGludCBwdF91cGRhdGVfaXJxKHN0cnVjdCB2Y3B1
ICp2KQogCiAgICAgaWYgKCBlYXJsaWVzdF9wdCA9PSBOVUxMICkKICAgICB7
Ci0gICAgICAgIHNwaW5fdW5sb2NrKCZ2LT5hcmNoLmh2bS50bV9sb2NrKTsK
KyAgICAgICAgcHRfdmNwdV91bmxvY2sodik7CiAgICAgICAgIHJldHVybiAt
MTsKICAgICB9CiAKQEAgLTM0Nyw3ICszNTYsNyBAQCBpbnQgcHRfdXBkYXRl
X2lycShzdHJ1Y3QgdmNwdSAqdikKICAgICBpcnEgPSBlYXJsaWVzdF9wdC0+
aXJxOwogICAgIGxldmVsID0gZWFybGllc3RfcHQtPmxldmVsOwogCi0gICAg
c3Bpbl91bmxvY2soJnYtPmFyY2guaHZtLnRtX2xvY2spOworICAgIHB0X3Zj
cHVfdW5sb2NrKHYpOwogCiAgICAgc3dpdGNoICggZWFybGllc3RfcHQtPnNv
dXJjZSApCiAgICAgewpAQCAtMzk0LDcgKzQwMyw3IEBAIGludCBwdF91cGRh
dGVfaXJxKHN0cnVjdCB2Y3B1ICp2KQogICAgICAgICAgICAgICAgIHRpbWVf
Y2IgKmNiID0gTlVMTDsKICAgICAgICAgICAgICAgICB2b2lkICpjYl9wcml2
OwogCi0gICAgICAgICAgICAgICAgc3Bpbl9sb2NrKCZ2LT5hcmNoLmh2bS50
bV9sb2NrKTsKKyAgICAgICAgICAgICAgICBwdF92Y3B1X2xvY2sodik7CiAg
ICAgICAgICAgICAgICAgLyogTWFrZSBzdXJlIHRoZSB0aW1lciBpcyBzdGls
bCBvbiB0aGUgbGlzdC4gKi8KICAgICAgICAgICAgICAgICBsaXN0X2Zvcl9l
YWNoX2VudHJ5ICggcHQsICZ2LT5hcmNoLmh2bS50bV9saXN0LCBsaXN0ICkK
ICAgICAgICAgICAgICAgICAgICAgaWYgKCBwdCA9PSBlYXJsaWVzdF9wdCAp
CkBAIC00MDQsNyArNDEzLDcgQEAgaW50IHB0X3VwZGF0ZV9pcnEoc3RydWN0
IHZjcHUgKnYpCiAgICAgICAgICAgICAgICAgICAgICAgICBjYl9wcml2ID0g
cHQtPnByaXY7CiAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg
ICAgICAgICAgICAgICAgICAgfQotICAgICAgICAgICAgICAgIHNwaW5fdW5s
b2NrKCZ2LT5hcmNoLmh2bS50bV9sb2NrKTsKKyAgICAgICAgICAgICAgICBw
dF92Y3B1X3VubG9jayh2KTsKIAogICAgICAgICAgICAgICAgIGlmICggY2Ig
IT0gTlVMTCApCiAgICAgICAgICAgICAgICAgICAgIGNiKHYsIGNiX3ByaXYp
OwpAQCAtNDQxLDEyICs0NTAsMTIgQEAgdm9pZCBwdF9pbnRyX3Bvc3Qoc3Ry
dWN0IHZjcHUgKnYsIHN0cnVjdAogICAgIGlmICggaW50YWNrLnNvdXJjZSA9
PSBodm1faW50c3JjX3ZlY3RvciApCiAgICAgICAgIHJldHVybjsKIAotICAg
IHNwaW5fbG9jaygmdi0+YXJjaC5odm0udG1fbG9jayk7CisgICAgcHRfdmNw
dV9sb2NrKHYpOwogCiAgICAgcHQgPSBpc19wdF9pcnEodiwgaW50YWNrKTsK
ICAgICBpZiAoIHB0ID09IE5VTEwgKQogICAgIHsKLSAgICAgICAgc3Bpbl91
bmxvY2soJnYtPmFyY2guaHZtLnRtX2xvY2spOworICAgICAgICBwdF92Y3B1
X3VubG9jayh2KTsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApAQCAtNDU1
LDcgKzQ2NCw3IEBAIHZvaWQgcHRfaW50cl9wb3N0KHN0cnVjdCB2Y3B1ICp2
LCBzdHJ1Y3QKICAgICBjYiA9IHB0LT5jYjsKICAgICBjYl9wcml2ID0gcHQt
PnByaXY7CiAKLSAgICBzcGluX3VubG9jaygmdi0+YXJjaC5odm0udG1fbG9j
ayk7CisgICAgcHRfdmNwdV91bmxvY2sodik7CiAKICAgICBpZiAoIGNiICE9
IE5VTEwgKQogICAgICAgICBjYih2LCBjYl9wcml2KTsKQEAgLTQ2NiwxMiAr
NDc1LDEyIEBAIHZvaWQgcHRfbWlncmF0ZShzdHJ1Y3QgdmNwdSAqdikKICAg
ICBzdHJ1Y3QgbGlzdF9oZWFkICpoZWFkID0gJnYtPmFyY2guaHZtLnRtX2xp
c3Q7CiAgICAgc3RydWN0IHBlcmlvZGljX3RpbWUgKnB0OwogCi0gICAgc3Bp
bl9sb2NrKCZ2LT5hcmNoLmh2bS50bV9sb2NrKTsKKyAgICBwdF92Y3B1X2xv
Y2sodik7CiAKICAgICBsaXN0X2Zvcl9lYWNoX2VudHJ5ICggcHQsIGhlYWQs
IGxpc3QgKQogICAgICAgICBtaWdyYXRlX3RpbWVyKCZwdC0+dGltZXIsIHYt
PnByb2Nlc3Nvcik7CiAKLSAgICBzcGluX3VubG9jaygmdi0+YXJjaC5odm0u
dG1fbG9jayk7CisgICAgcHRfdmNwdV91bmxvY2sodik7CiB9CiAKIHZvaWQg
Y3JlYXRlX3BlcmlvZGljX3RpbWUoCkBAIC00OTAsNyArNDk5LDcgQEAgdm9p
ZCBjcmVhdGVfcGVyaW9kaWNfdGltZSgKIAogICAgIGRlc3Ryb3lfcGVyaW9k
aWNfdGltZShwdCk7CiAKLSAgICBzcGluX2xvY2soJnYtPmFyY2guaHZtLnRt
X2xvY2spOworICAgIHdyaXRlX2xvY2soJnYtPmRvbWFpbi0+YXJjaC5odm0u
cGxfdGltZS0+cHRfbWlncmF0ZSk7CiAKICAgICBwdC0+cGVuZGluZ19pbnRy
X25yID0gMDsKICAgICBwdC0+ZG9fbm90X2ZyZWV6ZSA9IDA7CkBAIC01NDAs
NyArNTQ5LDcgQEAgdm9pZCBjcmVhdGVfcGVyaW9kaWNfdGltZSgKICAgICBp
bml0X3RpbWVyKCZwdC0+dGltZXIsIHB0X3RpbWVyX2ZuLCBwdCwgdi0+cHJv
Y2Vzc29yKTsKICAgICBzZXRfdGltZXIoJnB0LT50aW1lciwgcHQtPnNjaGVk
dWxlZCk7CiAKLSAgICBzcGluX3VubG9jaygmdi0+YXJjaC5odm0udG1fbG9j
ayk7CisgICAgd3JpdGVfdW5sb2NrKCZ2LT5kb21haW4tPmFyY2guaHZtLnBs
X3RpbWUtPnB0X21pZ3JhdGUpOwogfQogCiB2b2lkIGRlc3Ryb3lfcGVyaW9k
aWNfdGltZShzdHJ1Y3QgcGVyaW9kaWNfdGltZSAqcHQpCkBAIC01NjUsMzAg
KzU3NCwyMCBAQCB2b2lkIGRlc3Ryb3lfcGVyaW9kaWNfdGltZShzdHJ1Y3Qg
cGVyaW9kCiAKIHN0YXRpYyB2b2lkIHB0X2FkanVzdF92Y3B1KHN0cnVjdCBw
ZXJpb2RpY190aW1lICpwdCwgc3RydWN0IHZjcHUgKnYpCiB7Ci0gICAgaW50
IG9uX2xpc3Q7Ci0KICAgICBBU1NFUlQocHQtPnNvdXJjZSA9PSBQVFNSQ19p
c2EgfHwgcHQtPnNvdXJjZSA9PSBQVFNSQ19pb2FwaWMpOwogCiAgICAgaWYg
KCBwdC0+dmNwdSA9PSBOVUxMICkKICAgICAgICAgcmV0dXJuOwogCi0gICAg
cHRfbG9jayhwdCk7Ci0gICAgb25fbGlzdCA9IHB0LT5vbl9saXN0OwotICAg
IGlmICggcHQtPm9uX2xpc3QgKQotICAgICAgICBsaXN0X2RlbCgmcHQtPmxp
c3QpOwotICAgIHB0LT5vbl9saXN0ID0gMDsKLSAgICBwdF91bmxvY2socHQp
OwotCi0gICAgc3Bpbl9sb2NrKCZ2LT5hcmNoLmh2bS50bV9sb2NrKTsKKyAg
ICB3cml0ZV9sb2NrKCZwdC0+dmNwdS0+ZG9tYWluLT5hcmNoLmh2bS5wbF90
aW1lLT5wdF9taWdyYXRlKTsKICAgICBwdC0+dmNwdSA9IHY7Ci0gICAgaWYg
KCBvbl9saXN0ICkKKyAgICBpZiAoIHB0LT5vbl9saXN0ICkKICAgICB7Ci0g
ICAgICAgIHB0LT5vbl9saXN0ID0gMTsKKyAgICAgICAgbGlzdF9kZWwoJnB0
LT5saXN0KTsKICAgICAgICAgbGlzdF9hZGQoJnB0LT5saXN0LCAmdi0+YXJj
aC5odm0udG1fbGlzdCk7Ci0KICAgICAgICAgbWlncmF0ZV90aW1lcigmcHQt
PnRpbWVyLCB2LT5wcm9jZXNzb3IpOwogICAgIH0KLSAgICBzcGluX3VubG9j
aygmdi0+YXJjaC5odm0udG1fbG9jayk7CisgICAgd3JpdGVfdW5sb2NrKCZw
dC0+dmNwdS0+ZG9tYWluLT5hcmNoLmh2bS5wbF90aW1lLT5wdF9taWdyYXRl
KTsKIH0KIAogdm9pZCBwdF9hZGp1c3RfZ2xvYmFsX3ZjcHVfdGFyZ2V0KHN0
cnVjdCB2Y3B1ICp2KQotLS0gYS94ZW4vaW5jbHVkZS9hc20teDg2L2h2bS92
cHQuaAorKysgYi94ZW4vaW5jbHVkZS9hc20teDg2L2h2bS92cHQuaApAQCAt
MTI4LDYgKzEyOCwxMyBAQCBzdHJ1Y3QgcGxfdGltZSB7ICAgIC8qIHBsYXRm
b3JtIHRpbWUgKi8KICAgICBzdHJ1Y3QgUlRDU3RhdGUgIHZydGM7CiAgICAg
c3RydWN0IEhQRVRTdGF0ZSB2aHBldDsKICAgICBzdHJ1Y3QgUE1UU3RhdGUg
IHZwbXQ7CisgICAgLyoKKyAgICAgKiByd2xvY2sgdG8gcHJldmVudCBwZXJp
b2RpY190aW1lIHZDUFUgbWlncmF0aW9uLiBUYWtlIHRoZSBsb2NrIGluIHJl
YWQKKyAgICAgKiBtb2RlIGluIG9yZGVyIHRvIHByZXZlbnQgdGhlIHZjcHUg
ZmllbGQgb2YgcGVyaW9kaWNfdGltZSBmcm9tIGNoYW5naW5nLgorICAgICAq
IExvY2sgbXVzdCBiZSB0YWtlbiBpbiB3cml0ZSBtb2RlIHdoZW4gY2hhbmdl
cyB0byB0aGUgdmNwdSBmaWVsZCBhcmUKKyAgICAgKiBwZXJmb3JtZWQsIGFz
IGl0IGFsbG93cyBleGNsdXNpdmUgYWNjZXNzIHRvIGFsbCB0aGUgdGltZXJz
IG9mIGEgZG9tYWluLgorICAgICAqLworICAgIHJ3bG9ja190IHB0X21pZ3Jh
dGU7CiAgICAgLyogZ3Vlc3RfdGltZSA9IFhlbiBzeXMgdGltZSArIHN0aW1l
X29mZnNldCAqLwogICAgIGludDY0X3Qgc3RpbWVfb2Zmc2V0OwogICAgIC8q
IEVuc3VyZXMgbW9ub3RvbmljaXR5IGluIGFwcHJvcHJpYXRlIHRpbWVyIG1v
ZGVzLiAqLwo=

--=separator
Content-Type: application/octet-stream; name="xsa336-4.11.patch"
Content-Disposition: attachment; filename="xsa336-4.11.patch"
Content-Transfer-Encoding: base64

RnJvbTogUm9nZXIgUGF1IE1vbm7DqSA8cm9nZXIucGF1QGNpdHJpeC5jb20+
ClN1YmplY3Q6IHg4Ni92cHQ6IGZpeCByYWNlIHdoZW4gbWlncmF0aW5nIHRp
bWVycyBiZXR3ZWVuIHZDUFVzCgpUaGUgY3VycmVudCB2UFQgY29kZSB3aWxs
IG1pZ3JhdGUgdGhlIGVtdWxhdGVkIHRpbWVycyBiZXR3ZWVuIHZDUFVzCihj
aGFuZ2UgdGhlIHB0LT52Y3B1IGZpZWxkKSB3aGlsZSBqdXN0IGhvbGRpbmcg
dGhlIGRlc3RpbmF0aW9uIGxvY2ssCmVpdGhlciBmcm9tIGNyZWF0ZV9wZXJp
b2RpY190aW1lIG9yIHB0X2FkanVzdF9nbG9iYWxfdmNwdV90YXJnZXQgaWYK
dGhlIGdsb2JhbCB0YXJnZXQgaXMgYWRqdXN0ZWQuIENoYW5naW5nIHRoZSBw
ZXJpb2RpY190aW1lciB2Q1BVIGZpZWxkCmluIHRoaXMgd2F5IGNyZWF0ZXMg
YSByYWNlIHdoZXJlIGEgdGhpcmQgcGFydHkgY291bGQgZ3JhYiB0aGUgbG9j
ayBpbgp0aGUgdW5sb2NrZWQgcmVnaW9uIG9mIHB0X2FkanVzdF9nbG9iYWxf
dmNwdV90YXJnZXQgKG9yIGJlZm9yZQpjcmVhdGVfcGVyaW9kaWNfdGltZSBw
ZXJmb3JtcyB0aGUgdmNwdSBjaGFuZ2UpIGFuZCB0aGVuIHJlbGVhc2UgdGhl
CmxvY2sgZnJvbSBhIGRpZmZlcmVudCB2Q1BVLCBjcmVhdGluZyBhIGxvY2tp
bmcgaW1iYWxhbmNlLgoKSW50cm9kdWNlIGEgcGVyLWRvbWFpbiByd2xvY2sg
aW4gb3JkZXIgdG8gcHJvdGVjdCBwZXJpb2RpY190aW1lCm1pZ3JhdGlvbiBi
ZXR3ZWVuIHZDUFUgbGlzdHMuIFRha2luZyB0aGUgbG9jayBpbiByZWFkIG1v
ZGUgcHJldmVudHMKYW55IHRpbWVyIGZyb20gYmVpbmcgbWlncmF0ZWQgdG8g
YSBkaWZmZXJlbnQgdkNQVSwgd2hpbGUgdGFraW5nIGl0IGluCndyaXRlIG1v
ZGUgYWxsb3dzIHBlcmZvcm1pbmcgbWlncmF0aW9uIG9mIHRpbWVycyBhY3Jv
c3MgdkNQVXMuIFRoZQpwZXItdmNwdSBsb2NrcyBhcmUgc3RpbGwgdXNlZCB0
byBwcm90ZWN0IGFsbCB0aGUgb3RoZXIgZmllbGRzIGZyb20gdGhlCnBlcmlv
ZGljX3RpbWVyIHN0cnVjdC4KCk5vdGUgdGhhdCBzdWNoIG1pZ3JhdGlvbiBz
aG91bGRuJ3QgaGFwcGVuIGZyZXF1ZW50bHksIGFuZCBoZW5jZQp0aGVyZSdz
IG5vIHBlcmZvcm1hbmNlIGRyb3AgYXMgYSByZXN1bHQgb2Ygc3VjaCBsb2Nr
aW5nLgoKVGhpcyBpcyBYU0EtMzM2LgoKUmVwb3J0ZWQtYnk6IElnb3IgRHJ1
emhpbmluIDxpZ29yLmRydXpoaW5pbkBjaXRyaXguY29tPgpUZXN0ZWQtYnk6
IElnb3IgRHJ1emhpbmluIDxpZ29yLmRydXpoaW5pbkBjaXRyaXguY29tPgpT
aWduZWQtb2ZmLWJ5OiBSb2dlciBQYXUgTW9ubsOpIDxyb2dlci5wYXVAY2l0
cml4LmNvbT4KUmV2aWV3ZWQtYnk6IEphbiBCZXVsaWNoIDxqYmV1bGljaEBz
dXNlLmNvbT4KCi0tLSBhL3hlbi9hcmNoL3g4Ni9odm0vaHZtLmMKKysrIGIv
eGVuL2FyY2gveDg2L2h2bS9odm0uYwpAQCAtNjI3LDYgKzYyNyw4IEBAIGlu
dCBodm1fZG9tYWluX2luaXRpYWxpc2Uoc3RydWN0IGRvbWFpbgogICAgIC8q
IG5lZWQgbGluayB0byBjb250YWluaW5nIGRvbWFpbiAqLwogICAgIGQtPmFy
Y2guaHZtX2RvbWFpbi5wbF90aW1lLT5kb21haW4gPSBkOwogCisgICAgcnds
b2NrX2luaXQoJmQtPmFyY2guaHZtX2RvbWFpbi5wbF90aW1lLT5wdF9taWdy
YXRlKTsKKwogICAgIC8qIFNldCB0aGUgZGVmYXVsdCBJTyBCaXRtYXAuICov
CiAgICAgaWYgKCBpc19oYXJkd2FyZV9kb21haW4oZCkgKQogICAgIHsKLS0t
IGEveGVuL2FyY2gveDg2L2h2bS92cHQuYworKysgYi94ZW4vYXJjaC94ODYv
aHZtL3ZwdC5jCkBAIC0xNTIsMjMgKzE1MiwzMiBAQCBzdGF0aWMgaW50IHB0
X2lycV9tYXNrZWQoc3RydWN0IHBlcmlvZGljCiAgICAgcmV0dXJuIDE7CiB9
CiAKLXN0YXRpYyB2b2lkIHB0X2xvY2soc3RydWN0IHBlcmlvZGljX3RpbWUg
KnB0KQorc3RhdGljIHZvaWQgcHRfdmNwdV9sb2NrKHN0cnVjdCB2Y3B1ICp2
KQogewotICAgIHN0cnVjdCB2Y3B1ICp2OworICAgIHJlYWRfbG9jaygmdi0+
ZG9tYWluLT5hcmNoLmh2bV9kb21haW4ucGxfdGltZS0+cHRfbWlncmF0ZSk7
CisgICAgc3Bpbl9sb2NrKCZ2LT5hcmNoLmh2bV92Y3B1LnRtX2xvY2spOwor
fQogCi0gICAgZm9yICggOyA7ICkKLSAgICB7Ci0gICAgICAgIHYgPSBwdC0+
dmNwdTsKLSAgICAgICAgc3Bpbl9sb2NrKCZ2LT5hcmNoLmh2bV92Y3B1LnRt
X2xvY2spOwotICAgICAgICBpZiAoIGxpa2VseShwdC0+dmNwdSA9PSB2KSAp
Ci0gICAgICAgICAgICBicmVhazsKLSAgICAgICAgc3Bpbl91bmxvY2soJnYt
PmFyY2guaHZtX3ZjcHUudG1fbG9jayk7Ci0gICAgfQorc3RhdGljIHZvaWQg
cHRfdmNwdV91bmxvY2soc3RydWN0IHZjcHUgKnYpCit7CisgICAgc3Bpbl91
bmxvY2soJnYtPmFyY2guaHZtX3ZjcHUudG1fbG9jayk7CisgICAgcmVhZF91
bmxvY2soJnYtPmRvbWFpbi0+YXJjaC5odm1fZG9tYWluLnBsX3RpbWUtPnB0
X21pZ3JhdGUpOworfQorCitzdGF0aWMgdm9pZCBwdF9sb2NrKHN0cnVjdCBw
ZXJpb2RpY190aW1lICpwdCkKK3sKKyAgICAvKgorICAgICAqIFdlIGNhbm5v
dCB1c2UgcHRfdmNwdV9sb2NrIGhlcmUsIGJlY2F1c2Ugd2UgbmVlZCB0byBh
Y3F1aXJlIHRoZQorICAgICAqIHBlci1kb21haW4gbG9jayBmaXJzdCBhbmQg
dGhlbiAocmUtKWZldGNoIHRoZSB2YWx1ZSBvZiBwdC0+dmNwdSwgb3IKKyAg
ICAgKiBlbHNlIHdlIG1pZ2h0IGJlIHVzaW5nIGEgc3RhbGUgdmFsdWUgb2Yg
cHQtPnZjcHUuCisgICAgICovCisgICAgcmVhZF9sb2NrKCZwdC0+dmNwdS0+
ZG9tYWluLT5hcmNoLmh2bV9kb21haW4ucGxfdGltZS0+cHRfbWlncmF0ZSk7
CisgICAgc3Bpbl9sb2NrKCZwdC0+dmNwdS0+YXJjaC5odm1fdmNwdS50bV9s
b2NrKTsKIH0KIAogc3RhdGljIHZvaWQgcHRfdW5sb2NrKHN0cnVjdCBwZXJp
b2RpY190aW1lICpwdCkKIHsKLSAgICBzcGluX3VubG9jaygmcHQtPnZjcHUt
PmFyY2guaHZtX3ZjcHUudG1fbG9jayk7CisgICAgcHRfdmNwdV91bmxvY2so
cHQtPnZjcHUpOwogfQogCiBzdGF0aWMgdm9pZCBwdF9wcm9jZXNzX21pc3Nl
ZF90aWNrcyhzdHJ1Y3QgcGVyaW9kaWNfdGltZSAqcHQpCkBAIC0yMTgsNyAr
MjI3LDcgQEAgdm9pZCBwdF9zYXZlX3RpbWVyKHN0cnVjdCB2Y3B1ICp2KQog
ICAgIGlmICggdi0+cGF1c2VfZmxhZ3MgJiBWUEZfYmxvY2tlZCApCiAgICAg
ICAgIHJldHVybjsKIAotICAgIHNwaW5fbG9jaygmdi0+YXJjaC5odm1fdmNw
dS50bV9sb2NrKTsKKyAgICBwdF92Y3B1X2xvY2sodik7CiAKICAgICBsaXN0
X2Zvcl9lYWNoX2VudHJ5ICggcHQsIGhlYWQsIGxpc3QgKQogICAgICAgICBp
ZiAoICFwdC0+ZG9fbm90X2ZyZWV6ZSApCkBAIC0yMjYsNyArMjM1LDcgQEAg
dm9pZCBwdF9zYXZlX3RpbWVyKHN0cnVjdCB2Y3B1ICp2KQogCiAgICAgcHRf
ZnJlZXplX3RpbWUodik7CiAKLSAgICBzcGluX3VubG9jaygmdi0+YXJjaC5o
dm1fdmNwdS50bV9sb2NrKTsKKyAgICBwdF92Y3B1X3VubG9jayh2KTsKIH0K
IAogdm9pZCBwdF9yZXN0b3JlX3RpbWVyKHN0cnVjdCB2Y3B1ICp2KQpAQCAt
MjM0LDcgKzI0Myw3IEBAIHZvaWQgcHRfcmVzdG9yZV90aW1lcihzdHJ1Y3Qg
dmNwdSAqdikKICAgICBzdHJ1Y3QgbGlzdF9oZWFkICpoZWFkID0gJnYtPmFy
Y2guaHZtX3ZjcHUudG1fbGlzdDsKICAgICBzdHJ1Y3QgcGVyaW9kaWNfdGlt
ZSAqcHQ7CiAKLSAgICBzcGluX2xvY2soJnYtPmFyY2guaHZtX3ZjcHUudG1f
bG9jayk7CisgICAgcHRfdmNwdV9sb2NrKHYpOwogCiAgICAgbGlzdF9mb3Jf
ZWFjaF9lbnRyeSAoIHB0LCBoZWFkLCBsaXN0ICkKICAgICB7CkBAIC0yNDcs
NyArMjU2LDcgQEAgdm9pZCBwdF9yZXN0b3JlX3RpbWVyKHN0cnVjdCB2Y3B1
ICp2KQogCiAgICAgcHRfdGhhd190aW1lKHYpOwogCi0gICAgc3Bpbl91bmxv
Y2soJnYtPmFyY2guaHZtX3ZjcHUudG1fbG9jayk7CisgICAgcHRfdmNwdV91
bmxvY2sodik7CiB9CiAKIHN0YXRpYyB2b2lkIHB0X3RpbWVyX2ZuKHZvaWQg
KmRhdGEpCkBAIC0yNzIsNyArMjgxLDcgQEAgaW50IHB0X3VwZGF0ZV9pcnEo
c3RydWN0IHZjcHUgKnYpCiAgICAgdWludDY0X3QgbWF4X2xhZzsKICAgICBp
bnQgaXJxLCBwdF92ZWN0b3IgPSAtMTsKIAotICAgIHNwaW5fbG9jaygmdi0+
YXJjaC5odm1fdmNwdS50bV9sb2NrKTsKKyAgICBwdF92Y3B1X2xvY2sodik7
CiAKICAgICBlYXJsaWVzdF9wdCA9IE5VTEw7CiAgICAgbWF4X2xhZyA9IC0x
VUxMOwpAQCAtMzAwLDE0ICszMDksMTQgQEAgaW50IHB0X3VwZGF0ZV9pcnEo
c3RydWN0IHZjcHUgKnYpCiAKICAgICBpZiAoIGVhcmxpZXN0X3B0ID09IE5V
TEwgKQogICAgIHsKLSAgICAgICAgc3Bpbl91bmxvY2soJnYtPmFyY2guaHZt
X3ZjcHUudG1fbG9jayk7CisgICAgICAgIHB0X3ZjcHVfdW5sb2NrKHYpOwog
ICAgICAgICByZXR1cm4gLTE7CiAgICAgfQogCiAgICAgZWFybGllc3RfcHQt
PmlycV9pc3N1ZWQgPSAxOwogICAgIGlycSA9IGVhcmxpZXN0X3B0LT5pcnE7
CiAKLSAgICBzcGluX3VubG9jaygmdi0+YXJjaC5odm1fdmNwdS50bV9sb2Nr
KTsKKyAgICBwdF92Y3B1X3VubG9jayh2KTsKIAogICAgIHN3aXRjaCAoIGVh
cmxpZXN0X3B0LT5zb3VyY2UgKQogICAgIHsKQEAgLTM3NywxMiArMzg2LDEy
IEBAIHZvaWQgcHRfaW50cl9wb3N0KHN0cnVjdCB2Y3B1ICp2LCBzdHJ1Y3QK
ICAgICBpZiAoIGludGFjay5zb3VyY2UgPT0gaHZtX2ludHNyY192ZWN0b3Ig
KQogICAgICAgICByZXR1cm47CiAKLSAgICBzcGluX2xvY2soJnYtPmFyY2gu
aHZtX3ZjcHUudG1fbG9jayk7CisgICAgcHRfdmNwdV9sb2NrKHYpOwogCiAg
ICAgcHQgPSBpc19wdF9pcnEodiwgaW50YWNrKTsKICAgICBpZiAoIHB0ID09
IE5VTEwgKQogICAgIHsKLSAgICAgICAgc3Bpbl91bmxvY2soJnYtPmFyY2gu
aHZtX3ZjcHUudG1fbG9jayk7CisgICAgICAgIHB0X3ZjcHVfdW5sb2NrKHYp
OwogICAgICAgICByZXR1cm47CiAgICAgfQogCkBAIC00MjEsNyArNDMwLDcg
QEAgdm9pZCBwdF9pbnRyX3Bvc3Qoc3RydWN0IHZjcHUgKnYsIHN0cnVjdAog
ICAgIGNiID0gcHQtPmNiOwogICAgIGNiX3ByaXYgPSBwdC0+cHJpdjsKIAot
ICAgIHNwaW5fdW5sb2NrKCZ2LT5hcmNoLmh2bV92Y3B1LnRtX2xvY2spOwor
ICAgIHB0X3ZjcHVfdW5sb2NrKHYpOwogCiAgICAgaWYgKCBjYiAhPSBOVUxM
ICkKICAgICAgICAgY2IodiwgY2JfcHJpdik7CkBAIC00MzIsMTIgKzQ0MSwx
MiBAQCB2b2lkIHB0X21pZ3JhdGUoc3RydWN0IHZjcHUgKnYpCiAgICAgc3Ry
dWN0IGxpc3RfaGVhZCAqaGVhZCA9ICZ2LT5hcmNoLmh2bV92Y3B1LnRtX2xp
c3Q7CiAgICAgc3RydWN0IHBlcmlvZGljX3RpbWUgKnB0OwogCi0gICAgc3Bp
bl9sb2NrKCZ2LT5hcmNoLmh2bV92Y3B1LnRtX2xvY2spOworICAgIHB0X3Zj
cHVfbG9jayh2KTsKIAogICAgIGxpc3RfZm9yX2VhY2hfZW50cnkgKCBwdCwg
aGVhZCwgbGlzdCApCiAgICAgICAgIG1pZ3JhdGVfdGltZXIoJnB0LT50aW1l
ciwgdi0+cHJvY2Vzc29yKTsKIAotICAgIHNwaW5fdW5sb2NrKCZ2LT5hcmNo
Lmh2bV92Y3B1LnRtX2xvY2spOworICAgIHB0X3ZjcHVfdW5sb2NrKHYpOwog
fQogCiB2b2lkIGNyZWF0ZV9wZXJpb2RpY190aW1lKApAQCAtNDU1LDcgKzQ2
NCw3IEBAIHZvaWQgY3JlYXRlX3BlcmlvZGljX3RpbWUoCiAKICAgICBkZXN0
cm95X3BlcmlvZGljX3RpbWUocHQpOwogCi0gICAgc3Bpbl9sb2NrKCZ2LT5h
cmNoLmh2bV92Y3B1LnRtX2xvY2spOworICAgIHdyaXRlX2xvY2soJnYtPmRv
bWFpbi0+YXJjaC5odm1fZG9tYWluLnBsX3RpbWUtPnB0X21pZ3JhdGUpOwog
CiAgICAgcHQtPnBlbmRpbmdfaW50cl9uciA9IDA7CiAgICAgcHQtPmRvX25v
dF9mcmVlemUgPSAwOwpAQCAtNTA0LDcgKzUxMyw3IEBAIHZvaWQgY3JlYXRl
X3BlcmlvZGljX3RpbWUoCiAgICAgaW5pdF90aW1lcigmcHQtPnRpbWVyLCBw
dF90aW1lcl9mbiwgcHQsIHYtPnByb2Nlc3Nvcik7CiAgICAgc2V0X3RpbWVy
KCZwdC0+dGltZXIsIHB0LT5zY2hlZHVsZWQpOwogCi0gICAgc3Bpbl91bmxv
Y2soJnYtPmFyY2guaHZtX3ZjcHUudG1fbG9jayk7CisgICAgd3JpdGVfdW5s
b2NrKCZ2LT5kb21haW4tPmFyY2guaHZtX2RvbWFpbi5wbF90aW1lLT5wdF9t
aWdyYXRlKTsKIH0KIAogdm9pZCBkZXN0cm95X3BlcmlvZGljX3RpbWUoc3Ry
dWN0IHBlcmlvZGljX3RpbWUgKnB0KQpAQCAtNTI5LDMwICs1MzgsMjAgQEAg
dm9pZCBkZXN0cm95X3BlcmlvZGljX3RpbWUoc3RydWN0IHBlcmlvZAogCiBz
dGF0aWMgdm9pZCBwdF9hZGp1c3RfdmNwdShzdHJ1Y3QgcGVyaW9kaWNfdGlt
ZSAqcHQsIHN0cnVjdCB2Y3B1ICp2KQogewotICAgIGludCBvbl9saXN0Owot
CiAgICAgQVNTRVJUKHB0LT5zb3VyY2UgPT0gUFRTUkNfaXNhIHx8IHB0LT5z
b3VyY2UgPT0gUFRTUkNfaW9hcGljKTsKIAogICAgIGlmICggcHQtPnZjcHUg
PT0gTlVMTCApCiAgICAgICAgIHJldHVybjsKIAotICAgIHB0X2xvY2socHQp
OwotICAgIG9uX2xpc3QgPSBwdC0+b25fbGlzdDsKLSAgICBpZiAoIHB0LT5v
bl9saXN0ICkKLSAgICAgICAgbGlzdF9kZWwoJnB0LT5saXN0KTsKLSAgICBw
dC0+b25fbGlzdCA9IDA7Ci0gICAgcHRfdW5sb2NrKHB0KTsKLQotICAgIHNw
aW5fbG9jaygmdi0+YXJjaC5odm1fdmNwdS50bV9sb2NrKTsKKyAgICB3cml0
ZV9sb2NrKCZwdC0+dmNwdS0+ZG9tYWluLT5hcmNoLmh2bV9kb21haW4ucGxf
dGltZS0+cHRfbWlncmF0ZSk7CiAgICAgcHQtPnZjcHUgPSB2OwotICAgIGlm
ICggb25fbGlzdCApCisgICAgaWYgKCBwdC0+b25fbGlzdCApCiAgICAgewot
ICAgICAgICBwdC0+b25fbGlzdCA9IDE7CisgICAgICAgIGxpc3RfZGVsKCZw
dC0+bGlzdCk7CiAgICAgICAgIGxpc3RfYWRkKCZwdC0+bGlzdCwgJnYtPmFy
Y2guaHZtX3ZjcHUudG1fbGlzdCk7Ci0KICAgICAgICAgbWlncmF0ZV90aW1l
cigmcHQtPnRpbWVyLCB2LT5wcm9jZXNzb3IpOwogICAgIH0KLSAgICBzcGlu
X3VubG9jaygmdi0+YXJjaC5odm1fdmNwdS50bV9sb2NrKTsKKyAgICB3cml0
ZV91bmxvY2soJnB0LT52Y3B1LT5kb21haW4tPmFyY2guaHZtX2RvbWFpbi5w
bF90aW1lLT5wdF9taWdyYXRlKTsKIH0KIAogdm9pZCBwdF9hZGp1c3RfZ2xv
YmFsX3ZjcHVfdGFyZ2V0KHN0cnVjdCB2Y3B1ICp2KQotLS0gYS94ZW4vaW5j
bHVkZS9hc20teDg2L2h2bS92cHQuaAorKysgYi94ZW4vaW5jbHVkZS9hc20t
eDg2L2h2bS92cHQuaApAQCAtMTMzLDYgKzEzMywxMyBAQCBzdHJ1Y3QgcGxf
dGltZSB7ICAgIC8qIHBsYXRmb3JtIHRpbWUgKi8KICAgICBzdHJ1Y3QgUlRD
U3RhdGUgIHZydGM7CiAgICAgc3RydWN0IEhQRVRTdGF0ZSB2aHBldDsKICAg
ICBzdHJ1Y3QgUE1UU3RhdGUgIHZwbXQ7CisgICAgLyoKKyAgICAgKiByd2xv
Y2sgdG8gcHJldmVudCBwZXJpb2RpY190aW1lIHZDUFUgbWlncmF0aW9uLiBU
YWtlIHRoZSBsb2NrIGluIHJlYWQKKyAgICAgKiBtb2RlIGluIG9yZGVyIHRv
IHByZXZlbnQgdGhlIHZjcHUgZmllbGQgb2YgcGVyaW9kaWNfdGltZSBmcm9t
IGNoYW5naW5nLgorICAgICAqIExvY2sgbXVzdCBiZSB0YWtlbiBpbiB3cml0
ZSBtb2RlIHdoZW4gY2hhbmdlcyB0byB0aGUgdmNwdSBmaWVsZCBhcmUKKyAg
ICAgKiBwZXJmb3JtZWQsIGFzIGl0IGFsbG93cyBleGNsdXNpdmUgYWNjZXNz
IHRvIGFsbCB0aGUgdGltZXJzIG9mIGEgZG9tYWluLgorICAgICAqLworICAg
IHJ3bG9ja190IHB0X21pZ3JhdGU7CiAgICAgLyogZ3Vlc3RfdGltZSA9IFhl
biBzeXMgdGltZSArIHN0aW1lX29mZnNldCAqLwogICAgIGludDY0X3Qgc3Rp
bWVfb2Zmc2V0OwogICAgIC8qIEVuc3VyZXMgbW9ub3RvbmljaXR5IGluIGFw
cHJvcHJpYXRlIHRpbWVyIG1vZGVzLiAqLwo=

--=separator--


Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id E6F0DC01B2
	for <lists+xen-devel@lfdr.de>; Fri, 27 Sep 2019 11:03:53 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iDm7b-0005Rm-Iw; Fri, 27 Sep 2019 09:01:03 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=Rbpq=XW=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1iDm7a-0005QC-CQ
 for xen-devel@lists.xenproject.org; Fri, 27 Sep 2019 09:01:02 +0000
X-Inumbo-ID: 4e7256a8-e105-11e9-bf31-bc764e2007e4
Received: from mx1.suse.de (unknown [195.135.220.15])
 by localhost (Halon) with ESMTPS
 id 4e7256a8-e105-11e9-bf31-bc764e2007e4;
 Fri, 27 Sep 2019 09:00:52 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 86561AFCC;
 Fri, 27 Sep 2019 09:00:51 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Fri, 27 Sep 2019 11:00:46 +0200
Message-Id: <20190927090048.28872-5-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190927090048.28872-1-jgross@suse.com>
References: <20190927090048.28872-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v1 4/6] tools: add xenfs tool
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

QWRkIHRoZSB4ZW5mcyB0b29sIGZvciBhY2Nlc3NpbmcgdGhlIGh5cGVydmlzb3IgZmlsZXN5c3Rl
bS4KClNpZ25lZC1vZmYtYnk6IEp1ZXJnZW4gR3Jvc3MgPGpncm9zc0BzdXNlLmNvbT4KLS0tClYx
OgotIHJlbmFtZSB0byB4ZW5oeXBmcwotIGRvbid0IHVzZSAiLS0iIGZvciBzdWJjb21tYW5kcwot
IGFkZCB3cml0ZSBzdXBwb3J0Ci0tLQogLmdpdGlnbm9yZSAgICAgICAgICAgIHwgICAxICsKIHRv
b2xzL21pc2MvTWFrZWZpbGUgICB8ICAgNiArKysKIHRvb2xzL21pc2MveGVuaHlwZnMuYyB8IDEy
MCArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwogMyBm
aWxlcyBjaGFuZ2VkLCAxMjcgaW5zZXJ0aW9ucygrKQogY3JlYXRlIG1vZGUgMTAwNjQ0IHRvb2xz
L21pc2MveGVuaHlwZnMuYwoKZGlmZiAtLWdpdCBhLy5naXRpZ25vcmUgYi8uZ2l0aWdub3JlCmlu
ZGV4IDNhZGEwYzRmMGIuLjk1NGMxZGEyY2IgMTAwNjQ0Ci0tLSBhLy5naXRpZ25vcmUKKysrIGIv
LmdpdGlnbm9yZQpAQCAtMzcwLDYgKzM3MCw3IEBAIHRvb2xzL2xpYnhsL3Rlc3RfdGltZWRlcmVn
CiB0b29scy9saWJ4bC90ZXN0X2ZkZGVyZWdyYWNlCiB0b29scy9maXJtd2FyZS9ldGhlcmJvb3Qv
ZWItcm9tcy5oCiB0b29scy9maXJtd2FyZS9ldGhlcmJvb3QvZ3B4ZS1naXQtc25hcHNob3QudGFy
Lmd6Cit0b29scy9taXNjL3hlbmh5cGZzCiB0b29scy9taXNjL3hlbndhdGNoZG9nZAogdG9vbHMv
bWlzYy94ZW4taHZtY3Jhc2gKIHRvb2xzL21pc2MveGVuLWxvd21lbWQKZGlmZiAtLWdpdCBhL3Rv
b2xzL21pc2MvTWFrZWZpbGUgYi90b29scy9taXNjL01ha2VmaWxlCmluZGV4IDYzOTQ3YmZhZGMu
LjlmZGIxMzU5N2YgMTAwNjQ0Ci0tLSBhL3Rvb2xzL21pc2MvTWFrZWZpbGUKKysrIGIvdG9vbHMv
bWlzYy9NYWtlZmlsZQpAQCAtMjQsNiArMjQsNyBAQCBJTlNUQUxMX1NCSU4tJChDT05GSUdfWDg2
KSAgICAgKz0geGVuLWxvd21lbWQKIElOU1RBTExfU0JJTi0kKENPTkZJR19YODYpICAgICArPSB4
ZW4tbWZuZHVtcAogSU5TVEFMTF9TQklOLSQoQ09ORklHX1g4NikgICAgICs9IHhlbi11Y29kZQog
SU5TVEFMTF9TQklOICAgICAgICAgICAgICAgICAgICs9IHhlbmNvdgorSU5TVEFMTF9TQklOICAg
ICAgICAgICAgICAgICAgICs9IHhlbmh5cGZzCiBJTlNUQUxMX1NCSU4gICAgICAgICAgICAgICAg
ICAgKz0geGVubG9ja3Byb2YKIElOU1RBTExfU0JJTiAgICAgICAgICAgICAgICAgICArPSB4ZW5w
ZXJmCiBJTlNUQUxMX1NCSU4gICAgICAgICAgICAgICAgICAgKz0geGVucG0KQEAgLTg2LDYgKzg3
LDkgQEAgeGVucGVyZjogeGVucGVyZi5vCiB4ZW5wbTogeGVucG0ubwogCSQoQ0MpICQoTERGTEFH
UykgLW8gJEAgJDwgJChMRExJQlNfbGlieGVuY3RybCkgJChBUFBFTkRfTERGTEFHUykKIAoreGVu
aHlwZnM6IHhlbmh5cGZzLm8KKwkkKENDKSAkKExERkxBR1MpIC1vICRAICQ8ICQoTERMSUJTX2xp
Ynhlbmh5cGZzKSAkKEFQUEVORF9MREZMQUdTKQorCiB4ZW5sb2NrcHJvZjogeGVubG9ja3Byb2Yu
bwogCSQoQ0MpICQoTERGTEFHUykgLW8gJEAgJDwgJChMRExJQlNfbGlieGVuY3RybCkgJChBUFBF
TkRfTERGTEFHUykKIApAQCAtOTQsNiArOTgsOCBAQCB4ZW4taHB0b29sLm86IENGTEFHUyArPSAt
SSQoWEVOX1JPT1QpL3Rvb2xzL2xpYnhjICQoQ0ZMQUdTX2xpYnhlbmNhbGwpCiB4ZW4taHB0b29s
OiB4ZW4taHB0b29sLm8KIAkkKENDKSAkKExERkxBR1MpIC1vICRAICQ8ICQoTERMSUJTX2xpYnhl
bmV2dGNobikgJChMRExJQlNfbGlieGVuY3RybCkgJChMRExJQlNfbGlieGVuZ3Vlc3QpICQoTERM
SUJTX2xpYnhlbnN0b3JlKSAkKEFQUEVORF9MREZMQUdTKQogCit4ZW5oeXBmcy5vOiBDRkxBR1Mg
Kz0gJChDRkxBR1NfbGlieGVuaHlwZnMpCisKICMgeGVuLW1mbmR1bXAgaW5jb3JyZWN0bHkgdXNl
cyBsaWJ4YyBpbnRlcm5hbHMKIHhlbi1tZm5kdW1wLm86IENGTEFHUyArPSAtSSQoWEVOX1JPT1Qp
L3Rvb2xzL2xpYnhjICQoQ0ZMQUdTX2xpYnhlbmNhbGwpCiB4ZW4tbWZuZHVtcDogeGVuLW1mbmR1
bXAubwpkaWZmIC0tZ2l0IGEvdG9vbHMvbWlzYy94ZW5oeXBmcy5jIGIvdG9vbHMvbWlzYy94ZW5o
eXBmcy5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAuLjQwMDRiZTU3YmMK
LS0tIC9kZXYvbnVsbAorKysgYi90b29scy9taXNjL3hlbmh5cGZzLmMKQEAgLTAsMCArMSwxMjAg
QEAKKyNkZWZpbmUgX0dOVV9TT1VSQ0UKKyNpbmNsdWRlIDxzdGRpby5oPgorI2luY2x1ZGUgPHN0
ZGxpYi5oPgorI2luY2x1ZGUgPHN0cmluZy5oPgorI2luY2x1ZGUgPHhlbmh5cGZzLmg+CisKK3N0
YXRpYyBzdHJ1Y3QgeGVuaHlwZnNfaGFuZGxlICpoZGw7CisKK3N0YXRpYyBpbnQgeGVuaHlwZnNf
Y2F0KGNoYXIgKnBhdGgpCit7CisgICAgaW50IHJldCA9IDA7CisgICAgY2hhciAqcmVzdWx0Owor
CisgICAgcmVzdWx0ID0geGVuaHlwZnNfcmVhZChoZGwsIHBhdGgpOworICAgIGlmICghcmVzdWx0
KSB7CisgICAgICAgIHBlcnJvcigiY291bGQgbm90IHJlYWQiKTsKKyAgICAgICAgcmV0ID0gMzsK
KyAgICB9IGVsc2UgeworICAgICAgICBwcmludGYoIiVzXG4iLCByZXN1bHQpOworICAgICAgICBm
cmVlKHJlc3VsdCk7CisgICAgfQorCisgICAgcmV0dXJuIHJldDsKK30KKworc3RhdGljIGludCB4
ZW5oeXBmc193cihjaGFyICpwYXRoLCBjaGFyICp2YWwpCit7CisgICAgaW50IHJldDsKKworICAg
IHJldCA9IHhlbmh5cGZzX3dyaXRlKGhkbCwgcGF0aCwgdmFsKTsKKyAgICBpZiAocmV0KSB7Cisg
ICAgICAgIHBlcnJvcigiY291bGQgbm90IHdyaXRlIik7CisgICAgICAgIHJldCA9IDM7CisgICAg
fQorCisgICAgcmV0dXJuIHJldDsKK30KKworc3RhdGljIGludCB4ZW5oeXBmc19scyhjaGFyICpw
YXRoKQoreworICAgIHN0cnVjdCB4ZW5oeXBmc19kaXJlbnQgKmVudDsKKyAgICB1bnNpZ25lZCBp
bnQgbiwgaTsKKyAgICBpbnQgcmV0ID0gMDsKKworICAgIGVudCA9IHhlbmh5cGZzX3JlYWRkaXIo
aGRsLCBwYXRoLCAmbik7CisgICAgaWYgKCFlbnQpIHsKKyAgICAgICAgcGVycm9yKCJjb3VsZCBu
b3QgcmVhZCBkaXIiKTsKKyAgICAgICAgcmV0ID0gMzsKKyAgICB9IGVsc2UgeworICAgICAgICBm
b3IgKGkgPSAwOyBpIDwgbjsgaSsrKQorICAgICAgICAgICAgcHJpbnRmKCIlYyAlc1xuIiwgZW50
W2ldLmlzX2RpciA/ICdkJyA6ICctJywgZW50W2ldLm5hbWUpOworCisgICAgICAgIGZyZWUoZW50
KTsKKyAgICB9CisKKyAgICByZXR1cm4gcmV0OworfQorCitzdGF0aWMgaW50IHhlbmh5cGZzX3Ry
ZWVfc3ViKGNoYXIgKnBhdGgsIHVuc2lnbmVkIGludCBkZXB0aCkKK3sKKyAgICBzdHJ1Y3QgeGVu
aHlwZnNfZGlyZW50ICplbnQ7CisgICAgdW5zaWduZWQgaW50IG4sIGk7CisgICAgaW50IHJldCA9
IDA7CisgICAgY2hhciAqcDsKKworICAgIGVudCA9IHhlbmh5cGZzX3JlYWRkaXIoaGRsLCBwYXRo
LCAmbik7CisgICAgaWYgKCFlbnQpCisgICAgICAgIHJldHVybiAxOworCisgICAgZm9yIChpID0g
MDsgaSA8IG47IGkrKykgeworICAgICAgICBwcmludGYoIiUqcyVzJXNcbiIsIGRlcHRoICogMiwg
IiIsIGVudFtpXS5uYW1lLAorICAgICAgICAgICAgICAgZW50W2ldLmlzX2RpciA/ICIvIiA6ICIi
KTsKKyAgICAgICAgaWYgKGVudFtpXS5pc19kaXIpIHsKKyAgICAgICAgICAgIGFzcHJpbnRmKCZw
LCAiJXMlcyVzIiwgcGF0aCwgKGRlcHRoID09IDEpID8gIiIgOiAiLyIsIGVudFtpXS5uYW1lKTsK
KyAgICAgICAgICAgIGlmICh4ZW5oeXBmc190cmVlX3N1YihwLCBkZXB0aCArIDEpKQorICAgICAg
ICAgICAgICAgIHJldCA9IDE7CisgICAgICAgIH0KKyAgICB9CisKKyAgICBmcmVlKGVudCk7CisK
KyAgICByZXR1cm4gcmV0OworfQorCitzdGF0aWMgaW50IHhlbmh5cGZzX3RyZWUodm9pZCkKK3sK
KyAgICBwcmludGYoIi9cbiIpOworCisgICAgcmV0dXJuIHhlbmh5cGZzX3RyZWVfc3ViKCIvIiwg
MSk7Cit9CisKK2ludCBtYWluKGludCBhcmdjLCBjaGFyICphcmd2W10pCit7CisgICAgaW50IHJl
dDsKKworICAgIGhkbCA9IHhlbmh5cGZzX29wZW4oTlVMTCwgMCk7CisKKyAgICBpZiAoIWhkbCkg
eworICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIkNvdWxkIG5vdCBvcGVuIGxpYnhlbmh5cGZzXG4i
KTsKKyAgICAgICAgcmV0ID0gMjsKKyAgICB9IGVsc2UgaWYgKGFyZ2MgPT0gMyAmJiAhc3RyY21w
KGFyZ3ZbMV0sICJjYXQiKSkKKyAgICAgICAgcmV0ID0geGVuaHlwZnNfY2F0KGFyZ3ZbMl0pOwor
ICAgIGVsc2UgaWYgKGFyZ2MgPT0gMyAmJiAhc3RyY21wKGFyZ3ZbMV0sICJscyIpKQorICAgICAg
ICByZXQgPSB4ZW5oeXBmc19scyhhcmd2WzJdKTsKKyAgICBlbHNlIGlmIChhcmdjID09IDQgJiYg
IXN0cmNtcChhcmd2WzFdLCAid3JpdGUiKSkKKyAgICAgICAgcmV0ID0geGVuaHlwZnNfd3IoYXJn
dlsyXSwgYXJndlszXSk7CisgICAgZWxzZSBpZiAoYXJnYyA9PSAyICYmICFzdHJjbXAoYXJndlsx
XSwgInRyZWUiKSkKKyAgICAgICAgcmV0ID0geGVuaHlwZnNfdHJlZSgpOworICAgIGVsc2Ugewor
ICAgICAgICBmcHJpbnRmKHN0ZGVyciwgInVzYWdlOiB4ZW5oeXBmcyBscyA8cGF0aD5cbiIpOwor
ICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIiAgICAgICB4ZW5oeXBmcyBjYXQgPHBhdGg+XG4iKTsK
KyAgICAgICAgZnByaW50ZihzdGRlcnIsICIgICAgICAgeGVuaHlwZnMgd3JpdGUgPHBhdGg+IDx2
YWw+XG4iKTsKKyAgICAgICAgZnByaW50ZihzdGRlcnIsICIgICAgICAgeGVuaHlwZnMgdHJlZVxu
Iik7CisgICAgICAgIHJldCA9IDE7CisgICAgfQorCisgICAgeGVuaHlwZnNfY2xvc2UoaGRsKTsK
KworICAgIHJldHVybiByZXQ7Cit9Ci0tIAoyLjE2LjQKCgpfX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZl
bEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxt
YW4vbGlzdGluZm8veGVuLWRldmVs

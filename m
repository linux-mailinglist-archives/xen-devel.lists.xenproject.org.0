Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 71AE2B2617
	for <lists+xen-devel@lfdr.de>; Fri, 13 Sep 2019 21:31:19 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i8rFF-00071Y-Qc; Fri, 13 Sep 2019 19:28:37 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=bj/4=XI=citrix.com=andrew.cooper3@srs-us1.protection.inumbo.net>)
 id 1i8rFE-00070h-5g
 for xen-devel@lists.xenproject.org; Fri, 13 Sep 2019 19:28:36 +0000
X-Inumbo-ID: 9f7b5828-d65c-11e9-95b9-12813bfff9fa
Received: from esa5.hc3370-68.iphmx.com (unknown [216.71.155.168])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 9f7b5828-d65c-11e9-95b9-12813bfff9fa;
 Fri, 13 Sep 2019 19:28:11 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1568402891;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=CtZxoswxLwoE+1p95337s4yOXkbz5afQCx5L8jaPq0w=;
 b=AWD5Ie0jbWvbw8LvWkeas11LLQ+Nrmz2UFz73Fn8d4ET7y5RGwnpbrJo
 LEHppAaxf7jt6I5zl+bPCfGpj7AK5OoYo3ICdv06E+Fpj9eaknF025Xfi
 S9f7uinNQ/GBFDLKABwb6oahE9fV1v2m2hscxsInql1xt9ik2BXe4/doH c=;
Authentication-Results: esa5.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=andrew.cooper3@citrix.com;
 spf=Pass smtp.mailfrom=Andrew.Cooper3@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa5.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 andrew.cooper3@citrix.com) identity=pra;
 client-ip=162.221.158.21; receiver=esa5.hc3370-68.iphmx.com;
 envelope-from="Andrew.Cooper3@citrix.com";
 x-sender="andrew.cooper3@citrix.com";
 x-conformance=sidf_compatible
Received-SPF: Pass (esa5.hc3370-68.iphmx.com: domain of
 Andrew.Cooper3@citrix.com designates 162.221.158.21 as
 permitted sender) identity=mailfrom;
 client-ip=162.221.158.21; receiver=esa5.hc3370-68.iphmx.com;
 envelope-from="Andrew.Cooper3@citrix.com";
 x-sender="Andrew.Cooper3@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83 ~all"
Received-SPF: None (esa5.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa5.hc3370-68.iphmx.com;
 envelope-from="Andrew.Cooper3@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: a9xk/ubCjVitqvdxJ56BwgL6U+c7/Fq4N3FRgqRIMfwdWah5b2lwGWcYpl6UvlHFb6KPgDCG5B
 IfRa39EALdirFHu64sYmIdno5PESWX1kdR/g9SuxfryA2uXNrTBgVhpiJQ/PsJB5JU1JRXSxu4
 x4a6PI/F4aOxNaZHXVCK9t/sFtBqxqgbT1ThvKdlEaMojZmy7qgVDCcn/ALbxY3UxlcHcWmkbn
 6rYeOE+ovZQvAVJIDdQnZRtCkOhpfFJfiih5pjT2BWUq3EEhNI6b3HBrHMgSLjvEhcffJL/NRp
 GsI=
X-SBRS: 2.7
X-MesageID: 5754529
X-Ironport-Server: esa5.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.64,501,1559534400"; 
   d="scan'208";a="5754529"
From: Andrew Cooper <andrew.cooper3@citrix.com>
To: Xen-devel <xen-devel@lists.xenproject.org>
Date: Fri, 13 Sep 2019 20:27:53 +0100
Message-ID: <20190913192759.10795-5-andrew.cooper3@citrix.com>
X-Mailer: git-send-email 2.11.0
In-Reply-To: <20190913192759.10795-1-andrew.cooper3@citrix.com>
References: <20190913192759.10795-1-andrew.cooper3@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v2 04/10] x86/cpuid: Split
 update_domain_cpuid_info() in half
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>, Wei Liu <wl@xen.org>,
 Jan Beulich <JBeulich@suse.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

dXBkYXRlX2RvbWFpbl9jcHVpZF9pbmZvKCkgY3VycmVudGx5IHNlcnZlcyB0d28gcHVycG9zZXMu
ICBGaXJzdCB0byBtZXJnZSBuZXcKQ1BVSUQgZGF0YSBmcm9tIHRoZSB0b29sc3RhY2ssIGFuZCBz
ZWNvbmQsIHRvIHBlcmZvcm0gYW55IG5lY2Vzc2FyeSB1cGRhdGluZwpvZiBkZXJpdmVkIGRvbWFp
bi92Y3B1IHNldHRpbmdzLgoKVGhlIGZpcnN0IHBhcnQgb2YgdGhpcyBpcyBnb2luZyB0byBiZSBz
dXBlcnNlZGVkIGJ5IGEgbmV3IGFuZCBzdWJzdGFudGlhbGx5Cm1vcmUgZWZmaWNpZW50IGh5cGVy
Y2FsbC4KCkNhcnZlIHRoZSBzZWNvbmQgcGFydCBvdXQgaW50byBhIG5ldyBkb21haW5fY3B1X3Bv
bGljeV9jaGFuZ2VkKCkgaGVscGVyLCBhbmQKY2FsbCB0aGlzIGZyb20gdGhlIHJlbWFpbnMgb2Yg
dXBkYXRlX2RvbWFpbl9jcHVpZF9pbmZvKCkuCgpUaGlzIGRvZXMgZHJvcCB0aGUgY2FsbF9wb2xp
Y3lfY2hhbmdlZCwgYnV0IHdpdGggdGhlIG5ldyBoeXBlcmNhbGwgaW4gcGxhY2UsCnRoZSBjb21t
b24gY2FzZSB3aWxsIGJlIGEgc2luZ2xlIGNhbGwgcGVyIGRvbWFpbi4gIERyb3BwaW5nIHRoZSBv
cHRpbWlzYXRpb24KaGVyZSBhbGxvd3MgZm9yIGEgY2xlYW5lciBzZXQgb2YgZm9sbG93aW5nIGNo
YW5nZXMuCgpTaWduZWQtb2ZmLWJ5OiBBbmRyZXcgQ29vcGVyIDxhbmRyZXcuY29vcGVyM0BjaXRy
aXguY29tPgpSZXZpZXdlZC1ieTogSmFuIEJldWxpY2ggPGpiZXVsaWNoQHN1c2UuY29tPgotLS0K
Q0M6IEphbiBCZXVsaWNoIDxKQmV1bGljaEBzdXNlLmNvbT4KQ0M6IFdlaSBMaXUgPHdsQHhlbi5v
cmc+CkNDOiBSb2dlciBQYXUgTW9ubsOpIDxyb2dlci5wYXVAY2l0cml4LmNvbT4KCnYyOgogKiBE
cm9wIGR1cGxpY2F0ZSAnaHlwZXJjYWxsJyBpbiBjb21taXQgbWVzc2FnZQogKiBGaXggZm9yX2Vh
Y2hfdmNwdSAoKSBzdHlsZQotLS0KIHhlbi9hcmNoL3g4Ni9kb21jdGwuYyB8IDI0NSArKysrKysr
KysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogMSBmaWxlIGNoYW5n
ZWQsIDk5IGluc2VydGlvbnMoKyksIDE0NiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS94ZW4v
YXJjaC94ODYvZG9tY3RsLmMgYi94ZW4vYXJjaC94ODYvZG9tY3RsLmMKaW5kZXggYTc0NDY5NmM2
Yi4uNDhmY2NmMmY3YiAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L2RvbWN0bC5jCisrKyBiL3hl
bi9hcmNoL3g4Ni9kb21jdGwuYwpAQCAtNDYsMTAxICs0NiwxNCBAQCBzdGF0aWMgaW50IGdkYnN4
X2d1ZXN0X21lbV9pbyhkb21pZF90IGRvbWlkLCBzdHJ1Y3QgeGVuX2RvbWN0bF9nZGJzeF9tZW1p
byAqaW9wKQogICAgIHJldHVybiBpb3AtPnJlbWFpbiA/IC1FRkFVTFQgOiAwOwogfQogCi1zdGF0
aWMgaW50IHVwZGF0ZV9kb21haW5fY3B1aWRfaW5mbyhzdHJ1Y3QgZG9tYWluICpkLAotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RydWN0IHhlbl9kb21jdGxfY3B1
aWQgKmN0bCkKK3N0YXRpYyB2b2lkIGRvbWFpbl9jcHVfcG9saWN5X2NoYW5nZWQoc3RydWN0IGRv
bWFpbiAqZCkKIHsKLSAgICBzdHJ1Y3QgY3B1aWRfcG9saWN5ICpwID0gZC0+YXJjaC5jcHVpZDsK
LSAgICBjb25zdCBzdHJ1Y3QgY3B1aWRfbGVhZiBsZWFmID0geyBjdGwtPmVheCwgY3RsLT5lYngs
IGN0bC0+ZWN4LCBjdGwtPmVkeCB9OwotICAgIGludCBvbGRfdmVuZG9yID0gcC0+eDg2X3ZlbmRv
cjsKLSAgICB1bnNpZ25lZCBpbnQgb2xkXzdkMCA9IHAtPmZlYXQucmF3WzBdLmQsIG9sZF9lOGIg
PSBwLT5leHRkLnJhd1s4XS5iOwotICAgIGJvb2wgY2FsbF9wb2xpY3lfY2hhbmdlZCA9IGZhbHNl
OyAvKiBBdm9pZCBmb3JfZWFjaF92Y3B1KCkgdW5uZWNlc3NhcmlseSAqLwotCi0gICAgLyoKLSAg
ICAgKiBTa2lwIHVwZGF0ZSBmb3IgbGVhdmVzIHdlIGRvbid0IGNhcmUgYWJvdXQsIHRvIGF2b2lk
IHRoZSBvdmVyaGVhZCBvZgotICAgICAqIHJlY2FsY3VsYXRlX2NwdWlkX3BvbGljeSgpLgotICAg
ICAqLwotICAgIHN3aXRjaCAoIGN0bC0+aW5wdXRbMF0gKQotICAgIHsKLSAgICBjYXNlIDB4MDAw
MDAwMDAgLi4uIEFSUkFZX1NJWkUocC0+YmFzaWMucmF3KSAtIDE6Ci0gICAgICAgIGlmICggY3Rs
LT5pbnB1dFswXSA9PSA0ICYmCi0gICAgICAgICAgICAgY3RsLT5pbnB1dFsxXSA+PSBBUlJBWV9T
SVpFKHAtPmNhY2hlLnJhdykgKQotICAgICAgICAgICAgcmV0dXJuIDA7Ci0KLSAgICAgICAgaWYg
KCBjdGwtPmlucHV0WzBdID09IDcgJiYKLSAgICAgICAgICAgICBjdGwtPmlucHV0WzFdID49IEFS
UkFZX1NJWkUocC0+ZmVhdC5yYXcpICkKLSAgICAgICAgICAgIHJldHVybiAwOwotCi0gICAgICAg
IGlmICggY3RsLT5pbnB1dFswXSA9PSAweGIgJiYKLSAgICAgICAgICAgICBjdGwtPmlucHV0WzFd
ID49IEFSUkFZX1NJWkUocC0+dG9wby5yYXcpICkKLSAgICAgICAgICAgIHJldHVybiAwOwotCi0g
ICAgICAgIEJVSUxEX0JVR19PTihBUlJBWV9TSVpFKHAtPnhzdGF0ZS5yYXcpIDwgMik7Ci0gICAg
ICAgIGlmICggY3RsLT5pbnB1dFswXSA9PSBYU1RBVEVfQ1BVSUQgJiYKLSAgICAgICAgICAgICBj
dGwtPmlucHV0WzFdICE9IDEgKSAvKiBFdmVyeXRoaW5nIGVsc2UgYXV0b21hdGljYWxseSBjYWxj
dWxhdGVkLiAqLwotICAgICAgICAgICAgcmV0dXJuIDA7Ci0gICAgICAgIGJyZWFrOwotCi0gICAg
Y2FzZSAweDQwMDAwMDAwOiBjYXNlIDB4NDAwMDAxMDA6Ci0gICAgICAgIC8qIE9ubHkgY2FyZSBh
Ym91dCB0aGUgbWF4X2xlYWYgbGltaXQuICovCi0KLSAgICBjYXNlIDB4ODAwMDAwMDAgLi4uIDB4
ODAwMDAwMDAgKyBBUlJBWV9TSVpFKHAtPmV4dGQucmF3KSAtIDE6Ci0gICAgICAgIGJyZWFrOwot
Ci0gICAgZGVmYXVsdDoKLSAgICAgICAgcmV0dXJuIDA7Ci0gICAgfQotCi0gICAgLyogSW5zZXJ0
IGN0bCBkYXRhIGludG8gY3B1aWRfcG9saWN5LiAqLwotICAgIHN3aXRjaCAoIGN0bC0+aW5wdXRb
MF0gKQotICAgIHsKLSAgICBjYXNlIDB4MDAwMDAwMDAgLi4uIEFSUkFZX1NJWkUocC0+YmFzaWMu
cmF3KSAtIDE6Ci0gICAgICAgIHN3aXRjaCAoIGN0bC0+aW5wdXRbMF0gKQotICAgICAgICB7Ci0g
ICAgICAgIGNhc2UgNDoKLSAgICAgICAgICAgIHAtPmNhY2hlLnJhd1tjdGwtPmlucHV0WzFdXSA9
IGxlYWY7Ci0gICAgICAgICAgICBicmVhazsKLQotICAgICAgICBjYXNlIDc6Ci0gICAgICAgICAg
ICBwLT5mZWF0LnJhd1tjdGwtPmlucHV0WzFdXSA9IGxlYWY7Ci0gICAgICAgICAgICBicmVhazsK
LQotICAgICAgICBjYXNlIDB4YjoKLSAgICAgICAgICAgIHAtPnRvcG8ucmF3W2N0bC0+aW5wdXRb
MV1dID0gbGVhZjsKLSAgICAgICAgICAgIGJyZWFrOwotCi0gICAgICAgIGNhc2UgWFNUQVRFX0NQ
VUlEOgotICAgICAgICAgICAgcC0+eHN0YXRlLnJhd1tjdGwtPmlucHV0WzFdXSA9IGxlYWY7Ci0g
ICAgICAgICAgICBicmVhazsKLQotICAgICAgICBkZWZhdWx0OgotICAgICAgICAgICAgcC0+YmFz
aWMucmF3W2N0bC0+aW5wdXRbMF1dID0gbGVhZjsKLSAgICAgICAgICAgIGJyZWFrOwotICAgICAg
ICB9Ci0gICAgICAgIGJyZWFrOwotCi0gICAgY2FzZSAweDQwMDAwMDAwOgotICAgICAgICBwLT5o
dl9saW1pdCA9IGN0bC0+ZWF4OwotICAgICAgICBicmVhazsKKyAgICBjb25zdCBzdHJ1Y3QgY3B1
aWRfcG9saWN5ICpwID0gZC0+YXJjaC5jcHVpZDsKKyAgICBzdHJ1Y3QgdmNwdSAqdjsKIAotICAg
IGNhc2UgMHg0MDAwMDEwMDoKLSAgICAgICAgcC0+aHYyX2xpbWl0ID0gY3RsLT5lYXg7Ci0gICAg
ICAgIGJyZWFrOwotCi0gICAgY2FzZSAweDgwMDAwMDAwIC4uLiAweDgwMDAwMDAwICsgQVJSQVlf
U0laRShwLT5leHRkLnJhdykgLSAxOgotICAgICAgICBwLT5leHRkLnJhd1tjdGwtPmlucHV0WzBd
IC0gMHg4MDAwMDAwMF0gPSBsZWFmOwotICAgICAgICBicmVhazsKLSAgICB9Ci0KLSAgICByZWNh
bGN1bGF0ZV9jcHVpZF9wb2xpY3koZCk7Ci0KLSAgICBzd2l0Y2ggKCBjdGwtPmlucHV0WzBdICkK
KyAgICBpZiAoIGlzX3B2X2RvbWFpbihkKSApCiAgICAgewotICAgIGNhc2UgMDoKLSAgICAgICAg
Y2FsbF9wb2xpY3lfY2hhbmdlZCA9IChwLT54ODZfdmVuZG9yICE9IG9sZF92ZW5kb3IpOwotICAg
ICAgICBicmVhazsKLQotICAgIGNhc2UgMToKLSAgICAgICAgaWYgKCBpc19wdl9kb21haW4oZCkg
JiYgKChsZXZlbGxpbmdfY2FwcyAmIExDQVBfMWNkKSA9PSBMQ0FQXzFjZCkgKQorICAgICAgICBp
ZiAoICgobGV2ZWxsaW5nX2NhcHMgJiBMQ0FQXzFjZCkgPT0gTENBUF8xY2QpICkKICAgICAgICAg
ewogICAgICAgICAgICAgdWludDY0X3QgbWFzayA9IGNwdWlkbWFza19kZWZhdWx0cy5fMWNkOwog
ICAgICAgICAgICAgdWludDMyX3QgZWN4ID0gcC0+YmFzaWMuXzFjOwpAQCAtMTk3LDI1ICsxMTAs
MTggQEAgc3RhdGljIGludCB1cGRhdGVfZG9tYWluX2NwdWlkX2luZm8oc3RydWN0IGRvbWFpbiAq
ZCwKIAogICAgICAgICAgICAgZC0+YXJjaC5wdi5jcHVpZG1hc2tzLT5fMWNkID0gbWFzazsKICAg
ICAgICAgfQotICAgICAgICBicmVhazsKIAotICAgIGNhc2UgNjoKLSAgICAgICAgaWYgKCBpc19w
dl9kb21haW4oZCkgJiYgKChsZXZlbGxpbmdfY2FwcyAmIExDQVBfNmMpID09IExDQVBfNmMpICkK
KyAgICAgICAgaWYgKCAoKGxldmVsbGluZ19jYXBzICYgTENBUF82YykgPT0gTENBUF82YykgKQog
ICAgICAgICB7CiAgICAgICAgICAgICB1aW50NjRfdCBtYXNrID0gY3B1aWRtYXNrX2RlZmF1bHRz
Ll82YzsKIAogICAgICAgICAgICAgaWYgKCBib290X2NwdV9kYXRhLng4Nl92ZW5kb3IgPT0gWDg2
X1ZFTkRPUl9BTUQgKQotICAgICAgICAgICAgICAgIG1hc2sgJj0gKH4wVUxMIDw8IDMyKSB8IGN0
bC0+ZWN4OworICAgICAgICAgICAgICAgIG1hc2sgJj0gKH4wVUxMIDw8IDMyKSB8IHAtPmJhc2lj
LnJhd1s2XS5jOwogCiAgICAgICAgICAgICBkLT5hcmNoLnB2LmNwdWlkbWFza3MtPl82YyA9IG1h
c2s7CiAgICAgICAgIH0KLSAgICAgICAgYnJlYWs7Ci0KLSAgICBjYXNlIDc6Ci0gICAgICAgIGlm
ICggY3RsLT5pbnB1dFsxXSAhPSAwICkKLSAgICAgICAgICAgIGJyZWFrOwogCi0gICAgICAgIGlm
ICggaXNfcHZfZG9tYWluKGQpICYmICgobGV2ZWxsaW5nX2NhcHMgJiBMQ0FQXzdhYjApID09IExD
QVBfN2FiMCkgKQorICAgICAgICBpZiAoICgobGV2ZWxsaW5nX2NhcHMgJiBMQ0FQXzdhYjApID09
IExDQVBfN2FiMCkgKQogICAgICAgICB7CiAgICAgICAgICAgICB1aW50NjRfdCBtYXNrID0gY3B1
aWRtYXNrX2RlZmF1bHRzLl83YWIwOwogCkBAIC0yMzIsMzUgKzEzOCw3IEBAIHN0YXRpYyBpbnQg
dXBkYXRlX2RvbWFpbl9jcHVpZF9pbmZvKHN0cnVjdCBkb21haW4gKmQsCiAgICAgICAgICAgICBk
LT5hcmNoLnB2LmNwdWlkbWFza3MtPl83YWIwID0gbWFzazsKICAgICAgICAgfQogCi0gICAgICAg
IC8qCi0gICAgICAgICAqIElmIHRoZSBJQlJTL0lCUEIgcG9saWN5IGhhcyBjaGFuZ2VkLCB3ZSBu
ZWVkIHRvIHJlY2FsY3VsYXRlIHRoZSBNU1IKLSAgICAgICAgICogaW50ZXJjZXB0aW9uIGJpdG1h
cHMuCi0gICAgICAgICAqLwotICAgICAgICBjYWxsX3BvbGljeV9jaGFuZ2VkID0gKGlzX2h2bV9k
b21haW4oZCkgJiYKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKG9sZF83ZDAgXiBw
LT5mZWF0LnJhd1swXS5kKSAmCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjcHVm
ZWF0X21hc2soWDg2X0ZFQVRVUkVfSUJSU0IpIHwKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGNwdWZlYXRfbWFzayhYODZfRkVBVFVSRV9MMURfRkxVU0gpKSkpOwotICAgICAgICBi
cmVhazsKLQotICAgIGNhc2UgMHhhOgotICAgICAgICBpZiAoIGJvb3RfY3B1X2RhdGEueDg2X3Zl
bmRvciAhPSBYODZfVkVORE9SX0lOVEVMICkKLSAgICAgICAgICAgIGJyZWFrOwotCi0gICAgICAg
IC8qIElmIFBNVSB2ZXJzaW9uIGlzIHplcm8gdGhlbiB0aGUgZ3Vlc3QgZG9lc24ndCBoYXZlIFZQ
TVUgKi8KLSAgICAgICAgaWYgKCBwLT5iYXNpYy5wbXVfdmVyc2lvbiA9PSAwICkKLSAgICAgICAg
ewotICAgICAgICAgICAgc3RydWN0IHZjcHUgKnY7Ci0KLSAgICAgICAgICAgIGZvcl9lYWNoX3Zj
cHUgKCBkLCB2ICkKLSAgICAgICAgICAgICAgICB2cG11X2Rlc3Ryb3kodik7Ci0gICAgICAgIH0K
LSAgICAgICAgYnJlYWs7Ci0KLSAgICBjYXNlIDB4ZDoKLSAgICAgICAgaWYgKCBjdGwtPmlucHV0
WzFdICE9IDEgKQotICAgICAgICAgICAgYnJlYWs7Ci0KLSAgICAgICAgaWYgKCBpc19wdl9kb21h
aW4oZCkgJiYgKChsZXZlbGxpbmdfY2FwcyAmIExDQVBfRGExKSA9PSBMQ0FQX0RhMSkgKQorICAg
ICAgICBpZiAoICgobGV2ZWxsaW5nX2NhcHMgJiBMQ0FQX0RhMSkgPT0gTENBUF9EYTEpICkKICAg
ICAgICAgewogICAgICAgICAgICAgdWludDY0X3QgbWFzayA9IGNwdWlkbWFza19kZWZhdWx0cy5E
YTE7CiAgICAgICAgICAgICB1aW50MzJfdCBlYXggPSBwLT54c3RhdGUuRGExOwpAQCAtMjcwLDEw
ICsxNDgsOCBAQCBzdGF0aWMgaW50IHVwZGF0ZV9kb21haW5fY3B1aWRfaW5mbyhzdHJ1Y3QgZG9t
YWluICpkLAogCiAgICAgICAgICAgICBkLT5hcmNoLnB2LmNwdWlkbWFza3MtPkRhMSA9IG1hc2s7
CiAgICAgICAgIH0KLSAgICAgICAgYnJlYWs7CiAKLSAgICBjYXNlIDB4ODAwMDAwMDE6Ci0gICAg
ICAgIGlmICggaXNfcHZfZG9tYWluKGQpICYmICgobGV2ZWxsaW5nX2NhcHMgJiBMQ0FQX2UxY2Qp
ID09IExDQVBfZTFjZCkgKQorICAgICAgICBpZiAoICgobGV2ZWxsaW5nX2NhcHMgJiBMQ0FQX2Ux
Y2QpID09IExDQVBfZTFjZCkgKQogICAgICAgICB7CiAgICAgICAgICAgICB1aW50NjRfdCBtYXNr
ID0gY3B1aWRtYXNrX2RlZmF1bHRzLmUxY2Q7CiAgICAgICAgICAgICB1aW50MzJfdCBlY3ggPSBw
LT5leHRkLmUxYzsKQEAgLTMxNywyNyArMTkzLDEwNCBAQCBzdGF0aWMgaW50IHVwZGF0ZV9kb21h
aW5fY3B1aWRfaW5mbyhzdHJ1Y3QgZG9tYWluICpkLAogCiAgICAgICAgICAgICBkLT5hcmNoLnB2
LmNwdWlkbWFza3MtPmUxY2QgPSBtYXNrOwogICAgICAgICB9CisgICAgfQorCisgICAgZm9yX2Vh
Y2hfdmNwdSAoIGQsIHYgKQorICAgIHsKKyAgICAgICAgY3B1aWRfcG9saWN5X3VwZGF0ZWQodik7
CisKKyAgICAgICAgLyogSWYgUE1VIHZlcnNpb24gaXMgemVybyB0aGVuIHRoZSBndWVzdCBkb2Vz
bid0IGhhdmUgVlBNVSAqLworICAgICAgICBpZiAoIGJvb3RfY3B1X2RhdGEueDg2X3ZlbmRvciA9
PSBYODZfVkVORE9SX0lOVEVMICYmCisgICAgICAgICAgICAgcC0+YmFzaWMucG11X3ZlcnNpb24g
PT0gMCApCisgICAgICAgICAgICB2cG11X2Rlc3Ryb3kodik7CisgICAgfQorfQorCitzdGF0aWMg
aW50IHVwZGF0ZV9kb21haW5fY3B1aWRfaW5mbyhzdHJ1Y3QgZG9tYWluICpkLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RydWN0IHhlbl9kb21jdGxfY3B1aWQg
KmN0bCkKK3sKKyAgICBzdHJ1Y3QgY3B1aWRfcG9saWN5ICpwID0gZC0+YXJjaC5jcHVpZDsKKyAg
ICBjb25zdCBzdHJ1Y3QgY3B1aWRfbGVhZiBsZWFmID0geyBjdGwtPmVheCwgY3RsLT5lYngsIGN0
bC0+ZWN4LCBjdGwtPmVkeCB9OworCisgICAgLyoKKyAgICAgKiBTa2lwIHVwZGF0ZSBmb3IgbGVh
dmVzIHdlIGRvbid0IGNhcmUgYWJvdXQsIHRvIGF2b2lkIHRoZSBvdmVyaGVhZCBvZgorICAgICAq
IHJlY2FsY3VsYXRlX2NwdWlkX3BvbGljeSgpLgorICAgICAqLworICAgIHN3aXRjaCAoIGN0bC0+
aW5wdXRbMF0gKQorICAgIHsKKyAgICBjYXNlIDB4MDAwMDAwMDAgLi4uIEFSUkFZX1NJWkUocC0+
YmFzaWMucmF3KSAtIDE6CisgICAgICAgIGlmICggY3RsLT5pbnB1dFswXSA9PSA0ICYmCisgICAg
ICAgICAgICAgY3RsLT5pbnB1dFsxXSA+PSBBUlJBWV9TSVpFKHAtPmNhY2hlLnJhdykgKQorICAg
ICAgICAgICAgcmV0dXJuIDA7CisKKyAgICAgICAgaWYgKCBjdGwtPmlucHV0WzBdID09IDcgJiYK
KyAgICAgICAgICAgICBjdGwtPmlucHV0WzFdID49IEFSUkFZX1NJWkUocC0+ZmVhdC5yYXcpICkK
KyAgICAgICAgICAgIHJldHVybiAwOworCisgICAgICAgIGlmICggY3RsLT5pbnB1dFswXSA9PSAw
eGIgJiYKKyAgICAgICAgICAgICBjdGwtPmlucHV0WzFdID49IEFSUkFZX1NJWkUocC0+dG9wby5y
YXcpICkKKyAgICAgICAgICAgIHJldHVybiAwOworCisgICAgICAgIEJVSUxEX0JVR19PTihBUlJB
WV9TSVpFKHAtPnhzdGF0ZS5yYXcpIDwgMik7CisgICAgICAgIGlmICggY3RsLT5pbnB1dFswXSA9
PSBYU1RBVEVfQ1BVSUQgJiYKKyAgICAgICAgICAgICBjdGwtPmlucHV0WzFdICE9IDEgKSAvKiBF
dmVyeXRoaW5nIGVsc2UgYXV0b21hdGljYWxseSBjYWxjdWxhdGVkLiAqLworICAgICAgICAgICAg
cmV0dXJuIDA7CiAgICAgICAgIGJyZWFrOwogCi0gICAgY2FzZSAweDgwMDAwMDA4OgotICAgICAg
ICAvKgotICAgICAgICAgKiBJZiB0aGUgSUJQQiBwb2xpY3kgaGFzIGNoYW5nZWQsIHdlIG5lZWQg
dG8gcmVjYWxjdWxhdGUgdGhlIE1TUgotICAgICAgICAgKiBpbnRlcmNlcHRpb24gYml0bWFwcy4K
LSAgICAgICAgICovCi0gICAgICAgIGNhbGxfcG9saWN5X2NoYW5nZWQgPSAoaXNfaHZtX2RvbWFp
bihkKSAmJgotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgob2xkX2U4YiBeIHAtPmV4
dGQucmF3WzhdLmIpICYKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3B1ZmVhdF9t
YXNrKFg4Nl9GRUFUVVJFX0lCUEIpKSk7CisgICAgY2FzZSAweDQwMDAwMDAwOiBjYXNlIDB4NDAw
MDAxMDA6CisgICAgICAgIC8qIE9ubHkgY2FyZSBhYm91dCB0aGUgbWF4X2xlYWYgbGltaXQuICov
CisKKyAgICBjYXNlIDB4ODAwMDAwMDAgLi4uIDB4ODAwMDAwMDAgKyBBUlJBWV9TSVpFKHAtPmV4
dGQucmF3KSAtIDE6CiAgICAgICAgIGJyZWFrOworCisgICAgZGVmYXVsdDoKKyAgICAgICAgcmV0
dXJuIDA7CiAgICAgfQogCi0gICAgaWYgKCBjYWxsX3BvbGljeV9jaGFuZ2VkICkKKyAgICAvKiBJ
bnNlcnQgY3RsIGRhdGEgaW50byBjcHVpZF9wb2xpY3kuICovCisgICAgc3dpdGNoICggY3RsLT5p
bnB1dFswXSApCiAgICAgewotICAgICAgICBzdHJ1Y3QgdmNwdSAqdjsKKyAgICBjYXNlIDB4MDAw
MDAwMDAgLi4uIEFSUkFZX1NJWkUocC0+YmFzaWMucmF3KSAtIDE6CisgICAgICAgIHN3aXRjaCAo
IGN0bC0+aW5wdXRbMF0gKQorICAgICAgICB7CisgICAgICAgIGNhc2UgNDoKKyAgICAgICAgICAg
IHAtPmNhY2hlLnJhd1tjdGwtPmlucHV0WzFdXSA9IGxlYWY7CisgICAgICAgICAgICBicmVhazsK
KworICAgICAgICBjYXNlIDc6CisgICAgICAgICAgICBwLT5mZWF0LnJhd1tjdGwtPmlucHV0WzFd
XSA9IGxlYWY7CisgICAgICAgICAgICBicmVhazsKKworICAgICAgICBjYXNlIDB4YjoKKyAgICAg
ICAgICAgIHAtPnRvcG8ucmF3W2N0bC0+aW5wdXRbMV1dID0gbGVhZjsKKyAgICAgICAgICAgIGJy
ZWFrOwogCi0gICAgICAgIGZvcl9lYWNoX3ZjcHUoIGQsIHYgKQotICAgICAgICAgICAgY3B1aWRf
cG9saWN5X3VwZGF0ZWQodik7CisgICAgICAgIGNhc2UgWFNUQVRFX0NQVUlEOgorICAgICAgICAg
ICAgcC0+eHN0YXRlLnJhd1tjdGwtPmlucHV0WzFdXSA9IGxlYWY7CisgICAgICAgICAgICBicmVh
azsKKworICAgICAgICBkZWZhdWx0OgorICAgICAgICAgICAgcC0+YmFzaWMucmF3W2N0bC0+aW5w
dXRbMF1dID0gbGVhZjsKKyAgICAgICAgICAgIGJyZWFrOworICAgICAgICB9CisgICAgICAgIGJy
ZWFrOworCisgICAgY2FzZSAweDQwMDAwMDAwOgorICAgICAgICBwLT5odl9saW1pdCA9IGN0bC0+
ZWF4OworICAgICAgICBicmVhazsKKworICAgIGNhc2UgMHg0MDAwMDEwMDoKKyAgICAgICAgcC0+
aHYyX2xpbWl0ID0gY3RsLT5lYXg7CisgICAgICAgIGJyZWFrOworCisgICAgY2FzZSAweDgwMDAw
MDAwIC4uLiAweDgwMDAwMDAwICsgQVJSQVlfU0laRShwLT5leHRkLnJhdykgLSAxOgorICAgICAg
ICBwLT5leHRkLnJhd1tjdGwtPmlucHV0WzBdIC0gMHg4MDAwMDAwMF0gPSBsZWFmOworICAgICAg
ICBicmVhazsKICAgICB9CiAKKyAgICByZWNhbGN1bGF0ZV9jcHVpZF9wb2xpY3koZCk7CisgICAg
ZG9tYWluX2NwdV9wb2xpY3lfY2hhbmdlZChkKTsKKwogICAgIHJldHVybiAwOwogfQogCi0tIAoy
LjExLjAKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpY
ZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRw
czovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

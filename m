Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 33E14144C2
	for <lists+xen-devel@lfdr.de>; Mon,  6 May 2019 08:59:53 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hNXYi-000281-64; Mon, 06 May 2019 06:57:08 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=XZcu=TG=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1hNXYe-00020R-7P
 for xen-devel@lists.xenproject.org; Mon, 06 May 2019 06:57:04 +0000
X-Inumbo-ID: 22036e9a-6fcc-11e9-9b2a-97130b85c37c
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 22036e9a-6fcc-11e9-9b2a-97130b85c37c;
 Mon, 06 May 2019 06:56:55 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id CCF94AED6;
 Mon,  6 May 2019 06:56:51 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Mon,  6 May 2019 08:56:10 +0200
Message-Id: <20190506065644.7415-12-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190506065644.7415-1-jgross@suse.com>
References: <20190506065644.7415-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH RFC V2 11/45] xen/sched: move some per-vcpu
 items to struct sched_item
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wei.liu2@citrix.com>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Meng Xu <mengxu@cis.upenn.edu>,
 Jan Beulich <jbeulich@suse.com>, Dario Faggioli <dfaggioli@suse.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

QWZmaW5pdGllcyBhcmUgc2NoZWR1bGVyIHNwZWNpZmljIGF0dHJpYnV0ZXMsIHRoZXkgc2hvdWxk
IGJlIHBlcgpzY2hlZHVsaW5nIGl0ZW0uIFNvIG1vdmUgYWxsIGFmZmluaXR5IHJlbGF0ZWQgZmll
bGRzIGluIHN0cnVjdCB2Y3B1CnRvIHN0cnVjdCBzY2hlZF9pdGVtLiBXaGlsZSBhdCBpdCBzd2l0
Y2ggYWZmaW5pdHkgcmVsYXRlZCBmdW5jdGlvbnMgaW4Kc2NoZWQtaWYuaCB0byB1c2UgYSBwb2lu
dGVyIHRvIHNjaGVkX2l0ZW0gaW5zdGVhZCB0byB2Y3B1IGFzIHBhcmFtZXRlci4KCnZjcHUtPmxh
c3RfcnVuX3RpbWUgaXMgcHJpbWFyaWx5IHVzZWQgYnkgc2NoZWRfY3JlZGl0LCBzbyBtb3ZlIGl0
IHRvCnN0cnVjdCBzY2hlZF9pdGVtLCB0b28uCgpTaWduZWQtb2ZmLWJ5OiBKdWVyZ2VuIEdyb3Nz
IDxqZ3Jvc3NAc3VzZS5jb20+Ci0tLQogeGVuL2FyY2gveDg2L3B2L2VtdWwtcHJpdi1vcC5jIHwg
ICAxICsKIHhlbi9hcmNoL3g4Ni9wdi90cmFwcy5jICAgICAgICB8ICAgNSArLQogeGVuL2FyY2gv
eDg2L3RyYXBzLmMgICAgICAgICAgIHwgICA5ICsrLS0KIHhlbi9jb21tb24vZG9tYWluLmMgICAg
ICAgICAgICB8ICAxOSArKy0tLS0tCiB4ZW4vY29tbW9uL2RvbWN0bC5jICAgICAgICAgICAgfCAg
MTMgKysrLS0KIHhlbi9jb21tb24va2V5aGFuZGxlci5jICAgICAgICB8ICAgNCArLQogeGVuL2Nv
bW1vbi9zY2hlZF9jcmVkaXQuYyAgICAgIHwgIDIwICsrKystLS0tCiB4ZW4vY29tbW9uL3NjaGVk
X2NyZWRpdDIuYyAgICAgfCAgNDIgKysrKysrKystLS0tLS0tLQogeGVuL2NvbW1vbi9zY2hlZF9u
dWxsLmMgICAgICAgIHwgIDE2ICsrKy0tLQogeGVuL2NvbW1vbi9zY2hlZF9ydC5jICAgICAgICAg
IHwgICA5ICsrLS0KIHhlbi9jb21tb24vc2NoZWR1bGUuYyAgICAgICAgICB8IDExMCArKysrKysr
KysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLQogeGVuL2NvbW1vbi93YWl0LmMgICAg
ICAgICAgICAgIHwgICA0ICstCiB4ZW4vaW5jbHVkZS94ZW4vc2NoZWQtaWYuaCAgICAgfCAgMTcg
KysrKy0tLQogeGVuL2luY2x1ZGUveGVuL3NjaGVkLmggICAgICAgIHwgIDM2ICsrKysrKystLS0t
LS0tCiAxNCBmaWxlcyBjaGFuZ2VkLCAxNjMgaW5zZXJ0aW9ucygrKSwgMTQyIGRlbGV0aW9ucygt
KQoKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9wdi9lbXVsLXByaXYtb3AuYyBiL3hlbi9hcmNo
L3g4Ni9wdi9lbXVsLXByaXYtb3AuYwppbmRleCBhZjc0ZjUwZGM4Li43MDMwZTgwNzhhIDEwMDY0
NAotLS0gYS94ZW4vYXJjaC94ODYvcHYvZW11bC1wcml2LW9wLmMKKysrIGIveGVuL2FyY2gveDg2
L3B2L2VtdWwtcHJpdi1vcC5jCkBAIC0yMyw2ICsyMyw3IEBACiAjaW5jbHVkZSA8eGVuL2V2ZW50
Lmg+CiAjaW5jbHVkZSA8eGVuL2d1ZXN0X2FjY2Vzcy5oPgogI2luY2x1ZGUgPHhlbi9pb2NhcC5o
PgorI2luY2x1ZGUgPHhlbi9zY2hlZC5oPgogI2luY2x1ZGUgPHhlbi9zcGlubG9jay5oPgogI2lu
Y2x1ZGUgPHhlbi90cmFjZS5oPgogCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvcHYvdHJhcHMu
YyBiL3hlbi9hcmNoL3g4Ni9wdi90cmFwcy5jCmluZGV4IDE3NDA3ODRmZjIuLmUyYTM4N2M3YzUg
MTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9wdi90cmFwcy5jCisrKyBiL3hlbi9hcmNoL3g4Ni9w
di90cmFwcy5jCkBAIC0yMiw2ICsyMiw3IEBACiAjaW5jbHVkZSA8eGVuL2V2ZW50Lmg+CiAjaW5j
bHVkZSA8eGVuL2h5cGVyY2FsbC5oPgogI2luY2x1ZGUgPHhlbi9saWIuaD4KKyNpbmNsdWRlIDx4
ZW4vc2NoZWQuaD4KICNpbmNsdWRlIDx4ZW4vdHJhY2UuaD4KICNpbmNsdWRlIDx4ZW4vc29mdGly
cS5oPgogCkBAIC0xNTUsOCArMTU2LDggQEAgc3RhdGljIHZvaWQgbm1pX21jZV9zb2Z0aXJxKHZv
aWQpCiAgICAgICogU2V0IHRoZSB0bXAgdmFsdWUgdW5jb25kaXRpb25hbGx5LCBzbyB0aGF0IHRo
ZSBjaGVjayBpbiB0aGUgaXJldAogICAgICAqIGh5cGVyY2FsbCB3b3Jrcy4KICAgICAgKi8KLSAg
ICBjcHVtYXNrX2NvcHkoc3QtPnZjcHUtPmNwdV9oYXJkX2FmZmluaXR5X3RtcCwKLSAgICAgICAg
ICAgICAgICAgc3QtPnZjcHUtPmNwdV9oYXJkX2FmZmluaXR5KTsKKyAgICBjcHVtYXNrX2NvcHko
c3QtPnZjcHUtPnNjaGVkX2l0ZW0tPmNwdV9oYXJkX2FmZmluaXR5X3RtcCwKKyAgICAgICAgICAg
ICAgICAgc3QtPnZjcHUtPnNjaGVkX2l0ZW0tPmNwdV9oYXJkX2FmZmluaXR5KTsKIAogICAgIGlm
ICggKGNwdSAhPSBzdC0+cHJvY2Vzc29yKSB8fAogICAgICAgICAgKHN0LT5wcm9jZXNzb3IgIT0g
c3QtPnZjcHUtPnByb2Nlc3NvcikgKQpkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L3RyYXBzLmMg
Yi94ZW4vYXJjaC94ODYvdHJhcHMuYwppbmRleCAwNWRkYzM5YmZlLi5mZjczY2QwZTI5IDEwMDY0
NAotLS0gYS94ZW4vYXJjaC94ODYvdHJhcHMuYworKysgYi94ZW4vYXJjaC94ODYvdHJhcHMuYwpA
QCAtMTU5NCwxNiArMTU5NCwxNyBAQCBzdGF0aWMgdm9pZCBwY2lfc2Vycl9zb2Z0aXJxKHZvaWQp
CiB2b2lkIGFzeW5jX2V4Y2VwdGlvbl9jbGVhbnVwKHN0cnVjdCB2Y3B1ICpjdXJyKQogewogICAg
IGludCB0cmFwOworICAgIHN0cnVjdCBzY2hlZF9pdGVtICppdGVtID0gY3Vyci0+c2NoZWRfaXRl
bTsKIAogICAgIGlmICggIWN1cnItPmFzeW5jX2V4Y2VwdGlvbl9tYXNrICkKICAgICAgICAgcmV0
dXJuOwogCiAgICAgLyogUmVzdG9yZSBhZmZpbml0eS4gICovCi0gICAgaWYgKCAhY3B1bWFza19l
bXB0eShjdXJyLT5jcHVfaGFyZF9hZmZpbml0eV90bXApICYmCi0gICAgICAgICAhY3B1bWFza19l
cXVhbChjdXJyLT5jcHVfaGFyZF9hZmZpbml0eV90bXAsIGN1cnItPmNwdV9oYXJkX2FmZmluaXR5
KSApCisgICAgaWYgKCAhY3B1bWFza19lbXB0eShpdGVtLT5jcHVfaGFyZF9hZmZpbml0eV90bXAp
ICYmCisgICAgICAgICAhY3B1bWFza19lcXVhbChpdGVtLT5jcHVfaGFyZF9hZmZpbml0eV90bXAs
IGl0ZW0tPmNwdV9oYXJkX2FmZmluaXR5KSApCiAgICAgewotICAgICAgICB2Y3B1X3NldF9oYXJk
X2FmZmluaXR5KGN1cnIsIGN1cnItPmNwdV9oYXJkX2FmZmluaXR5X3RtcCk7Ci0gICAgICAgIGNw
dW1hc2tfY2xlYXIoY3Vyci0+Y3B1X2hhcmRfYWZmaW5pdHlfdG1wKTsKKyAgICAgICAgdmNwdV9z
ZXRfaGFyZF9hZmZpbml0eShjdXJyLCBpdGVtLT5jcHVfaGFyZF9hZmZpbml0eV90bXApOworICAg
ICAgICBjcHVtYXNrX2NsZWFyKGl0ZW0tPmNwdV9oYXJkX2FmZmluaXR5X3RtcCk7CiAgICAgfQog
CiAgICAgaWYgKCAhKGN1cnItPmFzeW5jX2V4Y2VwdGlvbl9tYXNrICYgKGN1cnItPmFzeW5jX2V4
Y2VwdGlvbl9tYXNrIC0gMSkpICkKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vZG9tYWluLmMgYi94
ZW4vY29tbW9uL2RvbWFpbi5jCmluZGV4IDg4YmJlOTg0YmMuLjFjMGFiZGE2NmYgMTAwNjQ0Ci0t
LSBhL3hlbi9jb21tb24vZG9tYWluLmMKKysrIGIveGVuL2NvbW1vbi9kb21haW4uYwpAQCAtMTI2
LDExICsxMjYsNiBAQCBzdGF0aWMgdm9pZCB2Y3B1X2luZm9fcmVzZXQoc3RydWN0IHZjcHUgKnYp
CiAKIHN0YXRpYyB2b2lkIHZjcHVfZGVzdHJveShzdHJ1Y3QgdmNwdSAqdikKIHsKLSAgICBmcmVl
X2NwdW1hc2tfdmFyKHYtPmNwdV9oYXJkX2FmZmluaXR5KTsKLSAgICBmcmVlX2NwdW1hc2tfdmFy
KHYtPmNwdV9oYXJkX2FmZmluaXR5X3RtcCk7Ci0gICAgZnJlZV9jcHVtYXNrX3Zhcih2LT5jcHVf
aGFyZF9hZmZpbml0eV9zYXZlZCk7Ci0gICAgZnJlZV9jcHVtYXNrX3Zhcih2LT5jcHVfc29mdF9h
ZmZpbml0eSk7Ci0KICAgICBmcmVlX3ZjcHVfc3RydWN0KHYpOwogfQogCkBAIC0xNTQsMTIgKzE0
OSw2IEBAIHN0cnVjdCB2Y3B1ICp2Y3B1X2NyZWF0ZSgKIAogICAgIGdyYW50X3RhYmxlX2luaXRf
dmNwdSh2KTsKIAotICAgIGlmICggIXphbGxvY19jcHVtYXNrX3Zhcigmdi0+Y3B1X2hhcmRfYWZm
aW5pdHkpIHx8Ci0gICAgICAgICAhemFsbG9jX2NwdW1hc2tfdmFyKCZ2LT5jcHVfaGFyZF9hZmZp
bml0eV90bXApIHx8Ci0gICAgICAgICAhemFsbG9jX2NwdW1hc2tfdmFyKCZ2LT5jcHVfaGFyZF9h
ZmZpbml0eV9zYXZlZCkgfHwKLSAgICAgICAgICF6YWxsb2NfY3B1bWFza192YXIoJnYtPmNwdV9z
b2Z0X2FmZmluaXR5KSApCi0gICAgICAgIGdvdG8gZmFpbDsKLQogICAgIGlmICggaXNfaWRsZV9k
b21haW4oZCkgKQogICAgIHsKICAgICAgICAgdi0+cnVuc3RhdGUuc3RhdGUgPSBSVU5TVEFURV9y
dW5uaW5nOwpAQCAtMTk5LDcgKzE4OCw2IEBAIHN0cnVjdCB2Y3B1ICp2Y3B1X2NyZWF0ZSgKICAg
ICBzY2hlZF9kZXN0cm95X3ZjcHUodik7CiAgZmFpbF93cToKICAgICBkZXN0cm95X3dhaXRxdWV1
ZV92Y3B1KHYpOwotIGZhaWw6CiAgICAgdmNwdV9kZXN0cm95KHYpOwogCiAgICAgcmV0dXJuIE5V
TEw7CkBAIC01NTgsOSArNTQ2LDEwIEBAIHZvaWQgZG9tYWluX3VwZGF0ZV9ub2RlX2FmZmluaXR5
KHN0cnVjdCBkb21haW4gKmQpCiAgICAgICAgICAqLwogICAgICAgICBmb3JfZWFjaF92Y3B1ICgg
ZCwgdiApCiAgICAgICAgIHsKLSAgICAgICAgICAgIGNwdW1hc2tfb3IoZG9tX2NwdW1hc2ssIGRv
bV9jcHVtYXNrLCB2LT5jcHVfaGFyZF9hZmZpbml0eSk7CisgICAgICAgICAgICBjcHVtYXNrX29y
KGRvbV9jcHVtYXNrLCBkb21fY3B1bWFzaywKKyAgICAgICAgICAgICAgICAgICAgICAgdi0+c2No
ZWRfaXRlbS0+Y3B1X2hhcmRfYWZmaW5pdHkpOwogICAgICAgICAgICAgY3B1bWFza19vcihkb21f
Y3B1bWFza19zb2Z0LCBkb21fY3B1bWFza19zb2Z0LAotICAgICAgICAgICAgICAgICAgICAgICB2
LT5jcHVfc29mdF9hZmZpbml0eSk7CisgICAgICAgICAgICAgICAgICAgICAgIHYtPnNjaGVkX2l0
ZW0tPmNwdV9zb2Z0X2FmZmluaXR5KTsKICAgICAgICAgfQogICAgICAgICAvKiBGaWx0ZXIgb3V0
IG5vbi1vbmxpbmUgY3B1cyAqLwogICAgICAgICBjcHVtYXNrX2FuZChkb21fY3B1bWFzaywgZG9t
X2NwdW1hc2ssIG9ubGluZSk7CkBAIC0xMjI5LDcgKzEyMTgsNyBAQCBpbnQgdmNwdV9yZXNldChz
dHJ1Y3QgdmNwdSAqdikKICAgICB2LT5hc3luY19leGNlcHRpb25fbWFzayA9IDA7CiAgICAgbWVt
c2V0KHYtPmFzeW5jX2V4Y2VwdGlvbl9zdGF0ZSwgMCwgc2l6ZW9mKHYtPmFzeW5jX2V4Y2VwdGlv
bl9zdGF0ZSkpOwogI2VuZGlmCi0gICAgY3B1bWFza19jbGVhcih2LT5jcHVfaGFyZF9hZmZpbml0
eV90bXApOworICAgIGNwdW1hc2tfY2xlYXIodi0+c2NoZWRfaXRlbS0+Y3B1X2hhcmRfYWZmaW5p
dHlfdG1wKTsKICAgICBjbGVhcl9iaXQoX1ZQRl9ibG9ja2VkLCAmdi0+cGF1c2VfZmxhZ3MpOwog
ICAgIGNsZWFyX2JpdChfVlBGX2luX3Jlc2V0LCAmdi0+cGF1c2VfZmxhZ3MpOwogCmRpZmYgLS1n
aXQgYS94ZW4vY29tbW9uL2RvbWN0bC5jIGIveGVuL2NvbW1vbi9kb21jdGwuYwppbmRleCBiYWRl
OWE2M2IxLi44NDY0NzEzZDJiIDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL2RvbWN0bC5jCisrKyBi
L3hlbi9jb21tb24vZG9tY3RsLmMKQEAgLTYxNCw2ICs2MTQsNyBAQCBsb25nIGRvX2RvbWN0bChY
RU5fR1VFU1RfSEFORExFX1BBUkFNKHhlbl9kb21jdGxfdCkgdV9kb21jdGwpCiAgICAgY2FzZSBY
RU5fRE9NQ1RMX2dldHZjcHVhZmZpbml0eToKICAgICB7CiAgICAgICAgIHN0cnVjdCB2Y3B1ICp2
OworICAgICAgICBzdHJ1Y3Qgc2NoZWRfaXRlbSAqaXRlbTsKICAgICAgICAgc3RydWN0IHhlbl9k
b21jdGxfdmNwdWFmZmluaXR5ICp2Y3B1YWZmID0gJm9wLT51LnZjcHVhZmZpbml0eTsKIAogICAg
ICAgICByZXQgPSAtRUlOVkFMOwpAQCAtNjI0LDYgKzYyNSw3IEBAIGxvbmcgZG9fZG9tY3RsKFhF
Tl9HVUVTVF9IQU5ETEVfUEFSQU0oeGVuX2RvbWN0bF90KSB1X2RvbWN0bCkKICAgICAgICAgaWYg
KCAodiA9IGQtPnZjcHVbdmNwdWFmZi0+dmNwdV0pID09IE5VTEwgKQogICAgICAgICAgICAgYnJl
YWs7CiAKKyAgICAgICAgaXRlbSA9IHYtPnNjaGVkX2l0ZW07CiAgICAgICAgIHJldCA9IC1FSU5W
QUw7CiAgICAgICAgIGlmICggdmNwdWFmZmluaXR5X3BhcmFtc19pbnZhbGlkKHZjcHVhZmYpICkK
ICAgICAgICAgICAgIGJyZWFrOwpAQCAtNjQzLDcgKzY0NSw3IEBAIGxvbmcgZG9fZG9tY3RsKFhF
Tl9HVUVTVF9IQU5ETEVfUEFSQU0oeGVuX2RvbWN0bF90KSB1X2RvbWN0bCkKICAgICAgICAgICAg
ICAgICByZXQgPSAtRU5PTUVNOwogICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg
fQotICAgICAgICAgICAgY3B1bWFza19jb3B5KG9sZF9hZmZpbml0eSwgdi0+Y3B1X2hhcmRfYWZm
aW5pdHkpOworICAgICAgICAgICAgY3B1bWFza19jb3B5KG9sZF9hZmZpbml0eSwgaXRlbS0+Y3B1
X2hhcmRfYWZmaW5pdHkpOwogCiAgICAgICAgICAgICBpZiAoICFhbGxvY19jcHVtYXNrX3Zhcigm
bmV3X2FmZmluaXR5KSApCiAgICAgICAgICAgICB7CkBAIC02NzYsNyArNjc4LDcgQEAgbG9uZyBk
b19kb21jdGwoWEVOX0dVRVNUX0hBTkRMRV9QQVJBTSh4ZW5fZG9tY3RsX3QpIHVfZG9tY3RsKQog
ICAgICAgICAgICAgICAgICAqIEZvciBoYXJkIGFmZmluaXR5LCB3aGF0IHdlIHJldHVybiBpcyB0
aGUgaW50ZXJzZWN0aW9uIG9mCiAgICAgICAgICAgICAgICAgICogY3B1cG9vbCdzIG9ubGluZSBt
YXNrIGFuZCB0aGUgbmV3IGhhcmQgYWZmaW5pdHkuCiAgICAgICAgICAgICAgICAgICovCi0gICAg
ICAgICAgICAgICAgY3B1bWFza19hbmQobmV3X2FmZmluaXR5LCBvbmxpbmUsIHYtPmNwdV9oYXJk
X2FmZmluaXR5KTsKKyAgICAgICAgICAgICAgICBjcHVtYXNrX2FuZChuZXdfYWZmaW5pdHksIG9u
bGluZSwgaXRlbS0+Y3B1X2hhcmRfYWZmaW5pdHkpOwogICAgICAgICAgICAgICAgIHJldCA9IGNw
dW1hc2tfdG9feGVuY3RsX2JpdG1hcCgmdmNwdWFmZi0+Y3B1bWFwX2hhcmQsCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld19hZmZpbml0eSk7CiAgICAg
ICAgICAgICB9CkBAIC03MDUsNyArNzA3LDggQEAgbG9uZyBkb19kb21jdGwoWEVOX0dVRVNUX0hB
TkRMRV9QQVJBTSh4ZW5fZG9tY3RsX3QpIHVfZG9tY3RsKQogICAgICAgICAgICAgICAgICAqIGhh
cmQgYWZmaW5pdHkuCiAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgY3B1bWFz
a19hbmQobmV3X2FmZmluaXR5LCBuZXdfYWZmaW5pdHksIG9ubGluZSk7Ci0gICAgICAgICAgICAg
ICAgY3B1bWFza19hbmQobmV3X2FmZmluaXR5LCBuZXdfYWZmaW5pdHksIHYtPmNwdV9oYXJkX2Fm
ZmluaXR5KTsKKyAgICAgICAgICAgICAgICBjcHVtYXNrX2FuZChuZXdfYWZmaW5pdHksIG5ld19h
ZmZpbml0eSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLT5jcHVfaGFyZF9hZmZp
bml0eSk7CiAgICAgICAgICAgICAgICAgcmV0ID0gY3B1bWFza190b194ZW5jdGxfYml0bWFwKCZ2
Y3B1YWZmLT5jcHVtYXBfc29mdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgbmV3X2FmZmluaXR5KTsKICAgICAgICAgICAgIH0KQEAgLTcxOCwxMCArNzIx
LDEwIEBAIGxvbmcgZG9fZG9tY3RsKFhFTl9HVUVTVF9IQU5ETEVfUEFSQU0oeGVuX2RvbWN0bF90
KSB1X2RvbWN0bCkKICAgICAgICAgewogICAgICAgICAgICAgaWYgKCB2Y3B1YWZmLT5mbGFncyAm
IFhFTl9WQ1BVQUZGSU5JVFlfSEFSRCApCiAgICAgICAgICAgICAgICAgcmV0ID0gY3B1bWFza190
b194ZW5jdGxfYml0bWFwKCZ2Y3B1YWZmLT5jcHVtYXBfaGFyZCwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi0+Y3B1X2hhcmRfYWZmaW5pdHkpOworICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLT5jcHVfaGFy
ZF9hZmZpbml0eSk7CiAgICAgICAgICAgICBpZiAoIHZjcHVhZmYtPmZsYWdzICYgWEVOX1ZDUFVB
RkZJTklUWV9TT0ZUICkKICAgICAgICAgICAgICAgICByZXQgPSBjcHVtYXNrX3RvX3hlbmN0bF9i
aXRtYXAoJnZjcHVhZmYtPmNwdW1hcF9zb2Z0LAotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICB2LT5jcHVfc29mdF9hZmZpbml0eSk7CisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0tPmNwdV9zb2Z0X2FmZmluaXR5
KTsKICAgICAgICAgfQogICAgICAgICBicmVhazsKICAgICB9CmRpZmYgLS1naXQgYS94ZW4vY29t
bW9uL2tleWhhbmRsZXIuYyBiL3hlbi9jb21tb24va2V5aGFuZGxlci5jCmluZGV4IDRmNGE2NjBi
MGMuLmQ3NjA3ZTM5YWEgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24va2V5aGFuZGxlci5jCisrKyBi
L3hlbi9jb21tb24va2V5aGFuZGxlci5jCkBAIC0zMTIsOCArMzEyLDggQEAgc3RhdGljIHZvaWQg
ZHVtcF9kb21haW5zKHVuc2lnbmVkIGNoYXIga2V5KQogICAgICAgICAgICAgICAgIHByaW50aygi
ZGlydHlfY3B1PSV1Iiwgdi0+ZGlydHlfY3B1KTsKICAgICAgICAgICAgIHByaW50aygiXG4iKTsK
ICAgICAgICAgICAgIHByaW50aygiICAgIGNwdV9oYXJkX2FmZmluaXR5PXslKnBibH0gY3B1X3Nv
ZnRfYWZmaW5pdHk9eyUqcGJsfVxuIiwKLSAgICAgICAgICAgICAgICAgICBucl9jcHVfaWRzLCBj
cHVtYXNrX2JpdHModi0+Y3B1X2hhcmRfYWZmaW5pdHkpLAotICAgICAgICAgICAgICAgICAgIG5y
X2NwdV9pZHMsIGNwdW1hc2tfYml0cyh2LT5jcHVfc29mdF9hZmZpbml0eSkpOworICAgICAgICAg
ICAgICAgICAgIG5yX2NwdV9pZHMsIGNwdW1hc2tfYml0cyh2LT5zY2hlZF9pdGVtLT5jcHVfaGFy
ZF9hZmZpbml0eSksCisgICAgICAgICAgICAgICAgICAgbnJfY3B1X2lkcywgY3B1bWFza19iaXRz
KHYtPnNjaGVkX2l0ZW0tPmNwdV9zb2Z0X2FmZmluaXR5KSk7CiAgICAgICAgICAgICBwcmludGso
IiAgICBwYXVzZV9jb3VudD0lZCBwYXVzZV9mbGFncz0lbHhcbiIsCiAgICAgICAgICAgICAgICAg
ICAgYXRvbWljX3JlYWQoJnYtPnBhdXNlX2NvdW50KSwgdi0+cGF1c2VfZmxhZ3MpOwogICAgICAg
ICAgICAgYXJjaF9kdW1wX3ZjcHVfaW5mbyh2KTsKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vc2No
ZWRfY3JlZGl0LmMgYi94ZW4vY29tbW9uL3NjaGVkX2NyZWRpdC5jCmluZGV4IGRlNGZhY2UyYmMu
LjllN2M4NDliOTQgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0LmMKKysrIGIv
eGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQuYwpAQCAtMzUwLDYgKzM1MCw3IEBAIERFRklORV9QRVJf
Q1BVKHVuc2lnbmVkIGludCwgbGFzdF90aWNrbGVfY3B1KTsKIHN0YXRpYyBpbmxpbmUgdm9pZCBf
X3J1bnFfdGlja2xlKHN0cnVjdCBjc2NoZWRfaXRlbSAqbmV3KQogewogICAgIHVuc2lnbmVkIGlu
dCBjcHUgPSBuZXctPnZjcHUtPnByb2Nlc3NvcjsKKyAgICBzdHJ1Y3Qgc2NoZWRfaXRlbSAqaXRl
bSA9IG5ldy0+dmNwdS0+c2NoZWRfaXRlbTsKICAgICBzdHJ1Y3QgY3NjaGVkX2l0ZW0gKiBjb25z
dCBjdXIgPSBDU0NIRURfSVRFTShjdXJyX29uX2NwdShjcHUpKTsKICAgICBzdHJ1Y3QgY3NjaGVk
X3ByaXZhdGUgKnBydiA9IENTQ0hFRF9QUklWKHBlcl9jcHUoc2NoZWR1bGVyLCBjcHUpKTsKICAg
ICBjcHVtYXNrX3QgbWFzaywgaWRsZV9tYXNrLCAqb25saW5lOwpAQCAtMzc1LDcgKzM3Niw3IEBA
IHN0YXRpYyBpbmxpbmUgdm9pZCBfX3J1bnFfdGlja2xlKHN0cnVjdCBjc2NoZWRfaXRlbSAqbmV3
KQogICAgIGlmICggdW5saWtlbHkodGVzdF9iaXQoQ1NDSEVEX0ZMQUdfVkNQVV9QSU5ORUQsICZu
ZXctPmZsYWdzKSAmJgogICAgICAgICAgICAgICAgICAgY3B1bWFza190ZXN0X2NwdShjcHUsICZp
ZGxlX21hc2spKSApCiAgICAgewotICAgICAgICBBU1NFUlQoY3B1bWFza19jeWNsZShjcHUsIG5l
dy0+dmNwdS0+Y3B1X2hhcmRfYWZmaW5pdHkpID09IGNwdSk7CisgICAgICAgIEFTU0VSVChjcHVt
YXNrX2N5Y2xlKGNwdSwgaXRlbS0+Y3B1X2hhcmRfYWZmaW5pdHkpID09IGNwdSk7CiAgICAgICAg
IFNDSEVEX1NUQVRfQ1JBTksodGlja2xlZF9pZGxlX2NwdV9leGNsKTsKICAgICAgICAgX19jcHVt
YXNrX3NldF9jcHUoY3B1LCAmbWFzayk7CiAgICAgICAgIGdvdG8gdGlja2xlOwpAQCAtNDEwLDEx
ICs0MTEsMTEgQEAgc3RhdGljIGlubGluZSB2b2lkIF9fcnVucV90aWNrbGUoc3RydWN0IGNzY2hl
ZF9pdGVtICpuZXcpCiAgICAgICAgICAgICBpbnQgbmV3X2lkbGVyc19lbXB0eTsKIAogICAgICAg
ICAgICAgaWYgKCBiYWxhbmNlX3N0ZXAgPT0gQkFMQU5DRV9TT0ZUX0FGRklOSVRZCi0gICAgICAg
ICAgICAgICAgICYmICFoYXNfc29mdF9hZmZpbml0eShuZXctPnZjcHUpICkKKyAgICAgICAgICAg
ICAgICAgJiYgIWhhc19zb2Z0X2FmZmluaXR5KGl0ZW0pICkKICAgICAgICAgICAgICAgICBjb250
aW51ZTsKIAogICAgICAgICAgICAgLyogQXJlIHRoZXJlIGlkbGVycyBzdWl0YWJsZSBmb3IgbmV3
IChmb3IgdGhpcyBiYWxhbmNlIHN0ZXApPyAqLwotICAgICAgICAgICAgYWZmaW5pdHlfYmFsYW5j
ZV9jcHVtYXNrKG5ldy0+dmNwdSwgYmFsYW5jZV9zdGVwLAorICAgICAgICAgICAgYWZmaW5pdHlf
YmFsYW5jZV9jcHVtYXNrKGl0ZW0sIGJhbGFuY2Vfc3RlcCwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSkpOwogICAgICAgICAgICAg
Y3B1bWFza19hbmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLAogICAgICAgICAgICAgICAgICAg
ICAgICAgY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCAmaWRsZV9tYXNrKTsKQEAgLTQ0Myw4ICs0
NDQsNyBAQCBzdGF0aWMgaW5saW5lIHZvaWQgX19ydW5xX3RpY2tsZShzdHJ1Y3QgY3NjaGVkX2l0
ZW0gKm5ldykKICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgaWYgKCBuZXdfaWRsZXJzX2Vt
cHR5ICYmIG5ldy0+cHJpID4gY3VyLT5wcmkgKQogICAgICAgICAgICAgewotICAgICAgICAgICAg
ICAgIGlmICggY3B1bWFza19pbnRlcnNlY3RzKGN1ci0+dmNwdS0+Y3B1X2hhcmRfYWZmaW5pdHks
Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJmlkbGVfbWFzaykgKQor
ICAgICAgICAgICAgICAgIGlmICggY3B1bWFza19pbnRlcnNlY3RzKGl0ZW0tPmNwdV9oYXJkX2Fm
ZmluaXR5LCAmaWRsZV9tYXNrKSApCiAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAg
ICAgICBTQ0hFRF9WQ1BVX1NUQVRfQ1JBTksoY3VyLCBraWNrZWRfYXdheSk7CiAgICAgICAgICAg
ICAgICAgICAgIFNDSEVEX1ZDUFVfU1RBVF9DUkFOSyhjdXIsIG1pZ3JhdGVfcik7CkBAIC03MDQs
NyArNzA0LDcgQEAgc3RhdGljIGlubGluZSBib29sCiBfX2NzY2hlZF92Y3B1X2lzX2NhY2hlX2hv
dChjb25zdCBzdHJ1Y3QgY3NjaGVkX3ByaXZhdGUgKnBydiwgc3RydWN0IHZjcHUgKnYpCiB7CiAg
ICAgYm9vbCBob3QgPSBwcnYtPnZjcHVfbWlncl9kZWxheSAmJgotICAgICAgICAgICAgICAgKE5P
VygpIC0gdi0+bGFzdF9ydW5fdGltZSkgPCBwcnYtPnZjcHVfbWlncl9kZWxheTsKKyAgICAgICAg
ICAgICAgIChOT1coKSAtIHYtPnNjaGVkX2l0ZW0tPmxhc3RfcnVuX3RpbWUpIDwgcHJ2LT52Y3B1
X21pZ3JfZGVsYXk7CiAKICAgICBpZiAoIGhvdCApCiAgICAgICAgIFNDSEVEX1NUQVRfQ1JBTkso
dmNwdV9ob3QpOwpAQCAtNzQyLDcgKzc0Miw3IEBAIF9jc2NoZWRfY3B1X3BpY2soY29uc3Qgc3Ry
dWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgdmNwdSAqdmMsIGJvb2xfdCBjb21taXQpCiAKICAg
ICBmb3JfZWFjaF9hZmZpbml0eV9iYWxhbmNlX3N0ZXAoIGJhbGFuY2Vfc3RlcCApCiAgICAgewot
ICAgICAgICBhZmZpbml0eV9iYWxhbmNlX2NwdW1hc2sodmMsIGJhbGFuY2Vfc3RlcCwgY3B1cyk7
CisgICAgICAgIGFmZmluaXR5X2JhbGFuY2VfY3B1bWFzayh2Yy0+c2NoZWRfaXRlbSwgYmFsYW5j
ZV9zdGVwLCBjcHVzKTsKICAgICAgICAgY3B1bWFza19hbmQoY3B1cywgb25saW5lLCBjcHVzKTsK
ICAgICAgICAgLyoKICAgICAgICAgICogV2Ugd2FudCB0byBwaWNrIHVwIGEgcGNwdSBhbW9uZyB0
aGUgb25lcyB0aGF0IGFyZSBvbmxpbmUgYW5kCkBAIC03NjEsNyArNzYxLDcgQEAgX2NzY2hlZF9j
cHVfcGljayhjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCB2Y3B1ICp2YywgYm9v
bF90IGNvbW1pdCkKICAgICAgICAgICogYmFsYW5jaW5nIHN0ZXAgYWxsIHRvZ2V0aGVyLgogICAg
ICAgICAgKi8KICAgICAgICAgaWYgKCBiYWxhbmNlX3N0ZXAgPT0gQkFMQU5DRV9TT0ZUX0FGRklO
SVRZICYmCi0gICAgICAgICAgICAgKCFoYXNfc29mdF9hZmZpbml0eSh2YykgfHwgY3B1bWFza19l
bXB0eShjcHVzKSkgKQorICAgICAgICAgICAgICghaGFzX3NvZnRfYWZmaW5pdHkodmMtPnNjaGVk
X2l0ZW0pIHx8IGNwdW1hc2tfZW1wdHkoY3B1cykpICkKICAgICAgICAgICAgIGNvbnRpbnVlOwog
CiAgICAgICAgIC8qIElmIHByZXNlbnQsIHByZWZlciB2YydzIGN1cnJlbnQgcHJvY2Vzc29yICov
CkBAIC0xNjYwLDEwICsxNjYwLDEwIEBAIGNzY2hlZF9ydW5xX3N0ZWFsKGludCBwZWVyX2NwdSwg
aW50IGNwdSwgaW50IHByaSwgaW50IGJhbGFuY2Vfc3RlcCkKICAgICAgICAgICogb3IgY291bnRl
ci4KICAgICAgICAgICovCiAgICAgICAgIGlmICggdmMtPmlzX3J1bm5pbmcgfHwgKGJhbGFuY2Vf
c3RlcCA9PSBCQUxBTkNFX1NPRlRfQUZGSU5JVFkgJiYKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIWhhc19zb2Z0X2FmZmluaXR5KHZjKSkgKQorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAhaGFzX3NvZnRfYWZmaW5pdHkodmMtPnNjaGVkX2l0ZW0pKSApCiAgICAgICAg
ICAgICBjb250aW51ZTsKIAotICAgICAgICBhZmZpbml0eV9iYWxhbmNlX2NwdW1hc2sodmMsIGJh
bGFuY2Vfc3RlcCwgY3B1bWFza19zY3JhdGNoKTsKKyAgICAgICAgYWZmaW5pdHlfYmFsYW5jZV9j
cHVtYXNrKHZjLT5zY2hlZF9pdGVtLCBiYWxhbmNlX3N0ZXAsIGNwdW1hc2tfc2NyYXRjaCk7CiAg
ICAgICAgIGlmICggX19jc2NoZWRfdmNwdV9pc19taWdyYXRlYWJsZShwcnYsIHZjLCBjcHUsIGNw
dW1hc2tfc2NyYXRjaCkgKQogICAgICAgICB7CiAgICAgICAgICAgICAvKiBXZSBnb3QgYSBjYW5k
aWRhdGUuIEdyYWIgaXQhICovCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3NjaGVkX2NyZWRpdDIu
YyBiL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0Mi5jCmluZGV4IDYxMDYyOTNiM2YuLjVjMTc5NGRi
NjEgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0Mi5jCisrKyBiL3hlbi9jb21t
b24vc2NoZWRfY3JlZGl0Mi5jCkBAIC02OTksMTAgKzY5OSwxMCBAQCBzdGF0aWMgaW50IGdldF9m
YWxsYmFja19jcHUoc3RydWN0IGNzY2hlZDJfaXRlbSAqc3ZjKQogICAgIHsKICAgICAgICAgaW50
IGNwdSA9IHYtPnByb2Nlc3NvcjsKIAotICAgICAgICBpZiAoIGJzID09IEJBTEFOQ0VfU09GVF9B
RkZJTklUWSAmJiAhaGFzX3NvZnRfYWZmaW5pdHkodikgKQorICAgICAgICBpZiAoIGJzID09IEJB
TEFOQ0VfU09GVF9BRkZJTklUWSAmJiAhaGFzX3NvZnRfYWZmaW5pdHkodi0+c2NoZWRfaXRlbSkg
KQogICAgICAgICAgICAgY29udGludWU7CiAKLSAgICAgICAgYWZmaW5pdHlfYmFsYW5jZV9jcHVt
YXNrKHYsIGJzLCBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSkpOworICAgICAgICBhZmZpbml0eV9i
YWxhbmNlX2NwdW1hc2sodi0+c2NoZWRfaXRlbSwgYnMsIGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1
KSk7CiAgICAgICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwgY3B1bWFz
a19zY3JhdGNoX2NwdShjcHUpLAogICAgICAgICAgICAgICAgICAgICBjcHVwb29sX2RvbWFpbl9j
cHVtYXNrKHYtPmRvbWFpbikpOwogCkBAIC0xMzkwLDEwICsxMzkwLDEwIEBAIHN0YXRpYyBzX3Rp
bWVfdCB0aWNrbGVfc2NvcmUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzX3RpbWVfdCBu
b3csCiAgICAgICovCiAgICAgaWYgKCBzY29yZSA+IDAgKQogICAgIHsKLSAgICAgICAgaWYgKCBj
cHVtYXNrX3Rlc3RfY3B1KGNwdSwgbmV3LT52Y3B1LT5jcHVfc29mdF9hZmZpbml0eSkgKQorICAg
ICAgICBpZiAoIGNwdW1hc2tfdGVzdF9jcHUoY3B1LCBuZXctPnZjcHUtPnNjaGVkX2l0ZW0tPmNw
dV9zb2Z0X2FmZmluaXR5KSApCiAgICAgICAgICAgICBzY29yZSArPSBDU0NIRUQyX0NSRURJVF9J
TklUOwogCi0gICAgICAgIGlmICggIWNwdW1hc2tfdGVzdF9jcHUoY3B1LCBjdXItPnZjcHUtPmNw
dV9zb2Z0X2FmZmluaXR5KSApCisgICAgICAgIGlmICggIWNwdW1hc2tfdGVzdF9jcHUoY3B1LCBj
dXItPnZjcHUtPnNjaGVkX2l0ZW0tPmNwdV9zb2Z0X2FmZmluaXR5KSApCiAgICAgICAgICAgICBz
Y29yZSArPSBDU0NIRUQyX0NSRURJVF9JTklUOwogICAgIH0KIApAQCAtMTQzNiw2ICsxNDM2LDcg
QEAgcnVucV90aWNrbGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgY3NjaGVk
Ml9pdGVtICpuZXcsIHNfdGltZV90IG5vdykKIHsKICAgICBpbnQgaSwgaXBpZCA9IC0xOwogICAg
IHNfdGltZV90IG1heCA9IDA7CisgICAgc3RydWN0IHNjaGVkX2l0ZW0gKml0ZW0gPSBuZXctPnZj
cHUtPnNjaGVkX2l0ZW07CiAgICAgdW5zaWduZWQgaW50IGJzLCBjcHUgPSBuZXctPnZjcHUtPnBy
b2Nlc3NvcjsKICAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQgPSBjMnJxZChv
cHMsIGNwdSk7CiAgICAgY3B1bWFza190ICpvbmxpbmUgPSBjcHVwb29sX2RvbWFpbl9jcHVtYXNr
KG5ldy0+dmNwdS0+ZG9tYWluKTsKQEAgLTE0NzMsNyArMTQ3NCw3IEBAIHJ1bnFfdGlja2xlKGNv
bnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IGNzY2hlZDJfaXRlbSAqbmV3LCBzX3Rp
bWVfdCBub3cpCiAgICAgICAgICAgICAgICAgICBjcHVtYXNrX3Rlc3RfY3B1KGNwdSwgJnJxZC0+
aWRsZSkgJiYKICAgICAgICAgICAgICAgICAgICFjcHVtYXNrX3Rlc3RfY3B1KGNwdSwgJnJxZC0+
dGlja2xlZCkpICkKICAgICB7Ci0gICAgICAgIEFTU0VSVChjcHVtYXNrX2N5Y2xlKGNwdSwgbmV3
LT52Y3B1LT5jcHVfaGFyZF9hZmZpbml0eSkgPT0gY3B1KTsKKyAgICAgICAgQVNTRVJUKGNwdW1h
c2tfY3ljbGUoY3B1LCBpdGVtLT5jcHVfaGFyZF9hZmZpbml0eSkgPT0gY3B1KTsKICAgICAgICAg
U0NIRURfU1RBVF9DUkFOSyh0aWNrbGVkX2lkbGVfY3B1X2V4Y2wpOwogICAgICAgICBpcGlkID0g
Y3B1OwogICAgICAgICBnb3RvIHRpY2tsZTsKQEAgLTE0ODIsMTAgKzE0ODMsMTAgQEAgcnVucV90
aWNrbGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgY3NjaGVkMl9pdGVtICpu
ZXcsIHNfdGltZV90IG5vdykKICAgICBmb3JfZWFjaF9hZmZpbml0eV9iYWxhbmNlX3N0ZXAoIGJz
ICkKICAgICB7CiAgICAgICAgIC8qIEp1c3Qgc2tpcCBmaXJzdCBzdGVwLCBpZiB3ZSBkb24ndCBo
YXZlIGEgc29mdCBhZmZpbml0eSAqLwotICAgICAgICBpZiAoIGJzID09IEJBTEFOQ0VfU09GVF9B
RkZJTklUWSAmJiAhaGFzX3NvZnRfYWZmaW5pdHkobmV3LT52Y3B1KSApCisgICAgICAgIGlmICgg
YnMgPT0gQkFMQU5DRV9TT0ZUX0FGRklOSVRZICYmICFoYXNfc29mdF9hZmZpbml0eShpdGVtKSAp
CiAgICAgICAgICAgICBjb250aW51ZTsKIAotICAgICAgICBhZmZpbml0eV9iYWxhbmNlX2NwdW1h
c2sobmV3LT52Y3B1LCBicywgY3B1bWFza19zY3JhdGNoX2NwdShjcHUpKTsKKyAgICAgICAgYWZm
aW5pdHlfYmFsYW5jZV9jcHVtYXNrKGl0ZW0sIGJzLCBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSkp
OwogCiAgICAgICAgIC8qCiAgICAgICAgICAqIEZpcnN0IG9mIGFsbCwgY29uc2lkZXIgaWRsZSBj
cHVzLCBjaGVja2luZyBpZiB3ZSBjYW4ganVzdApAQCAtMTU1Nyw3ICsxNTU4LDcgQEAgcnVucV90
aWNrbGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgY3NjaGVkMl9pdGVtICpu
ZXcsIHNfdGltZV90IG5vdykKICAgICAgICAgICAgIGlwaWQgPSBjcHU7CiAKICAgICAgICAgICAg
IC8qIElmIHRoaXMgaXMgaW4gbmV3J3Mgc29mdCBhZmZpbml0eSwganVzdCB0YWtlIGl0ICovCi0g
ICAgICAgICAgICBpZiAoIGNwdW1hc2tfdGVzdF9jcHUoY3B1LCBuZXctPnZjcHUtPmNwdV9zb2Z0
X2FmZmluaXR5KSApCisgICAgICAgICAgICBpZiAoIGNwdW1hc2tfdGVzdF9jcHUoY3B1LCBpdGVt
LT5jcHVfc29mdF9hZmZpbml0eSkgKQogICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIFND
SEVEX1NUQVRfQ1JBTksodGlja2xlZF9idXN5X2NwdSk7CiAgICAgICAgICAgICAgICAgZ290byB0
aWNrbGU7CkBAIC0yMjQzLDcgKzIyNDQsNyBAQCBjc2NoZWQyX3Jlc19waWNrKGNvbnN0IHN0cnVj
dCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX2l0ZW0gKml0ZW0pCiAgICAgICAgIGdvdG8g
b3V0OwogICAgIH0KIAotICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwg
dmMtPmNwdV9oYXJkX2FmZmluaXR5LAorICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9j
cHUoY3B1KSwgaXRlbS0+Y3B1X2hhcmRfYWZmaW5pdHksCiAgICAgICAgICAgICAgICAgY3B1cG9v
bF9kb21haW5fY3B1bWFzayh2Yy0+ZG9tYWluKSk7CiAKICAgICAvKgpAQCAtMjI4OCw3ICsyMjg5
LDcgQEAgY3NjaGVkMl9yZXNfcGljayhjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVj
dCBzY2hlZF9pdGVtICppdGVtKQogICAgICAqCiAgICAgICogRmluZCBib3RoIHJ1bnF1ZXVlcyBp
biBvbmUgcGFzcy4KICAgICAgKi8KLSAgICBoYXNfc29mdCA9IGhhc19zb2Z0X2FmZmluaXR5KHZj
KTsKKyAgICBoYXNfc29mdCA9IGhhc19zb2Z0X2FmZmluaXR5KGl0ZW0pOwogICAgIGZvcl9lYWNo
X2NwdShpLCAmcHJ2LT5hY3RpdmVfcXVldWVzKQogICAgIHsKICAgICAgICAgc3RydWN0IGNzY2hl
ZDJfcnVucXVldWVfZGF0YSAqcnFkOwpAQCAtMjMzNSw3ICsyMzM2LDcgQEAgY3NjaGVkMl9yZXNf
cGljayhjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF9pdGVtICppdGVt
KQogICAgICAgICAgICAgY3B1bWFza190IG1hc2s7CiAKICAgICAgICAgICAgIGNwdW1hc2tfYW5k
KCZtYXNrLCBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksICZycWQtPmFjdGl2ZSk7Ci0gICAgICAg
ICAgICBpZiAoIGNwdW1hc2tfaW50ZXJzZWN0cygmbWFzaywgc3ZjLT52Y3B1LT5jcHVfc29mdF9h
ZmZpbml0eSkgKQorICAgICAgICAgICAgaWYgKCBjcHVtYXNrX2ludGVyc2VjdHMoJm1hc2ssIGl0
ZW0tPmNwdV9zb2Z0X2FmZmluaXR5KSApCiAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAg
bWluX3NfYXZnbG9hZCA9IHJxZF9hdmdsb2FkOwogICAgICAgICAgICAgICAgIG1pbl9zX3JxaSA9
IGk7CkBAIC0yMzU3LDkgKzIzNTgsOSBAQCBjc2NoZWQyX3Jlc19waWNrKGNvbnN0IHN0cnVjdCBz
Y2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX2l0ZW0gKml0ZW0pCiAgICAgICAgICAqIE5vdGUg
dGhhdCwgdG8gb2J0YWluIHRoZSBzb2Z0LWFmZmluaXR5IG1hc2ssIHdlICJqdXN0IiBwdXQgd2hh
dCB3ZQogICAgICAgICAgKiBoYXZlIGluIGNwdW1hc2tfc2NyYXRjaCBpbiAmJiB3aXRoIHZjLT5j
cHVfc29mdF9hZmZpbml0eS4gVGhpcyBpcwogICAgICAgICAgKiBvayBiZWNhdXNlOgotICAgICAg
ICAgKiAtIHdlIGtub3cgdGhhdCB2Yy0+Y3B1X2hhcmRfYWZmaW5pdHkgYW5kIHZjLT5jcHVfc29m
dF9hZmZpbml0eSBoYXZlCisgICAgICAgICAqIC0gd2Uga25vdyB0aGF0IGl0ZW0tPmNwdV9oYXJk
X2FmZmluaXR5IGFuZCAtPmNwdV9zb2Z0X2FmZmluaXR5IGhhdmUKICAgICAgICAgICogICBhIG5v
bi1lbXB0eSBpbnRlcnNlY3Rpb24gKGJlY2F1c2UgaGFzX3NvZnQgaXMgdHJ1ZSk7Ci0gICAgICAg
ICAqIC0gd2UgaGF2ZSB2Yy0+Y3B1X2hhcmRfYWZmaW5pdHkgJiBjcHVwb29sX2RvbWFpbl9jcHVt
YXNrKCkgYWxyZWFkeQorICAgICAgICAgKiAtIHdlIGhhdmUgaXRlbS0+Y3B1X2hhcmRfYWZmaW5p
dHkgJiBjcHVwb29sX2RvbWFpbl9jcHVtYXNrKCkgYWxyZWFkeQogICAgICAgICAgKiAgIGluIGNw
dW1hc2tfc2NyYXRjaCwgd2UgZG8gc2F2ZSBhIGxvdCBkb2luZyBsaWtlIHRoaXMuCiAgICAgICAg
ICAqCiAgICAgICAgICAqIEl0J3Mga2luZCBvZiBsaWtlIG9wZW4gY29kaW5nIGFmZmluaXR5X2Jh
bGFuY2VfY3B1bWFzaygpIGJ1dCwgaW4KQEAgLTIzNjcsNyArMjM2OCw3IEBAIGNzY2hlZDJfcmVz
X3BpY2soY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfaXRlbSAqaXRl
bSkKICAgICAgICAgICogY3B1bWFzayBvcGVyYXRpb25zLgogICAgICAgICAgKi8KICAgICAgICAg
Y3B1bWFza19hbmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCBjcHVtYXNrX3NjcmF0Y2hfY3B1
KGNwdSksCi0gICAgICAgICAgICAgICAgICAgIHZjLT5jcHVfc29mdF9hZmZpbml0eSk7CisgICAg
ICAgICAgICAgICAgICAgIGl0ZW0tPmNwdV9zb2Z0X2FmZmluaXR5KTsKICAgICAgICAgY3B1bWFz
a19hbmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSks
CiAgICAgICAgICAgICAgICAgICAgICZwcnYtPnJxZFttaW5fc19ycWldLmFjdGl2ZSk7CiAgICAg
fQpAQCAtMjQ3NSw2ICsyNDc2LDcgQEAgc3RhdGljIHZvaWQgbWlncmF0ZShjb25zdCBzdHJ1Y3Qg
c2NoZWR1bGVyICpvcHMsCiAgICAgICAgICAgICAgICAgICAgIHNfdGltZV90IG5vdykKIHsKICAg
ICBpbnQgY3B1ID0gc3ZjLT52Y3B1LT5wcm9jZXNzb3I7CisgICAgc3RydWN0IHNjaGVkX2l0ZW0g
Kml0ZW0gPSBzdmMtPnZjcHUtPnNjaGVkX2l0ZW07CiAKICAgICBpZiAoIHVubGlrZWx5KHRiX2lu
aXRfZG9uZSkgKQogICAgIHsKQEAgLTI1MTIsNyArMjUxNCw3IEBAIHN0YXRpYyB2b2lkIG1pZ3Jh
dGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAgICAgICB9CiAgICAgICAgIF9ydW5x
X2RlYXNzaWduKHN2Yyk7CiAKLSAgICAgICAgY3B1bWFza19hbmQoY3B1bWFza19zY3JhdGNoX2Nw
dShjcHUpLCBzdmMtPnZjcHUtPmNwdV9oYXJkX2FmZmluaXR5LAorICAgICAgICBjcHVtYXNrX2Fu
ZChjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksIGl0ZW0tPmNwdV9oYXJkX2FmZmluaXR5LAogICAg
ICAgICAgICAgICAgICAgICBjcHVwb29sX2RvbWFpbl9jcHVtYXNrKHN2Yy0+dmNwdS0+ZG9tYWlu
KSk7CiAgICAgICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwgY3B1bWFz
a19zY3JhdGNoX2NwdShjcHUpLAogICAgICAgICAgICAgICAgICAgICAmdHJxZC0+YWN0aXZlKTsK
QEAgLTI1NDYsNyArMjU0OCw3IEBAIHN0YXRpYyBib29sIHZjcHVfaXNfbWlncmF0ZWFibGUoc3Ry
dWN0IGNzY2hlZDJfaXRlbSAqc3ZjLAogICAgIHN0cnVjdCB2Y3B1ICp2ID0gc3ZjLT52Y3B1Owog
ICAgIGludCBjcHUgPSBzdmMtPnZjcHUtPnByb2Nlc3NvcjsKIAotICAgIGNwdW1hc2tfYW5kKGNw
dW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwgdi0+Y3B1X2hhcmRfYWZmaW5pdHksCisgICAgY3B1bWFz
a19hbmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCB2LT5zY2hlZF9pdGVtLT5jcHVfaGFyZF9h
ZmZpbml0eSwKICAgICAgICAgICAgICAgICBjcHVwb29sX2RvbWFpbl9jcHVtYXNrKHYtPmRvbWFp
bikpOwogCiAgICAgcmV0dXJuICEoc3ZjLT5mbGFncyAmIENTRkxBR19ydW5xX21pZ3JhdGVfcmVx
dWVzdCkgJiYKQEAgLTI3ODAsNyArMjc4Miw3IEBAIGNzY2hlZDJfaXRlbV9taWdyYXRlKAogCiAg
ICAgLyogSWYgaGVyZSwgbmV3X2NwdSBtdXN0IGJlIGEgdmFsaWQgQ3JlZGl0MiBwQ1BVLCBhbmQg
aW4gb3VyIGFmZmluaXR5LiAqLwogICAgIEFTU0VSVChjcHVtYXNrX3Rlc3RfY3B1KG5ld19jcHUs
ICZjc2NoZWQyX3ByaXYob3BzKS0+aW5pdGlhbGl6ZWQpKTsKLSAgICBBU1NFUlQoY3B1bWFza190
ZXN0X2NwdShuZXdfY3B1LCB2Yy0+Y3B1X2hhcmRfYWZmaW5pdHkpKTsKKyAgICBBU1NFUlQoY3B1
bWFza190ZXN0X2NwdShuZXdfY3B1LCBpdGVtLT5jcHVfaGFyZF9hZmZpbml0eSkpOwogCiAgICAg
dHJxZCA9IGMycnFkKG9wcywgbmV3X2NwdSk7CiAKQEAgLTMzMjAsOSArMzMyMiw5IEBAIHJ1bnFf
Y2FuZGlkYXRlKHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCwKICAgICB9CiAKICAg
ICAvKiBJZiBzY3VyciBoYXMgYSBzb2Z0LWFmZmluaXR5LCBsZXQncyBjaGVjayB3aGV0aGVyIGNw
dSBpcyBwYXJ0IG9mIGl0ICovCi0gICAgaWYgKCBoYXNfc29mdF9hZmZpbml0eShzY3Vyci0+dmNw
dSkgKQorICAgIGlmICggaGFzX3NvZnRfYWZmaW5pdHkoc2N1cnItPnZjcHUtPnNjaGVkX2l0ZW0p
ICkKICAgICB7Ci0gICAgICAgIGFmZmluaXR5X2JhbGFuY2VfY3B1bWFzayhzY3Vyci0+dmNwdSwg
QkFMQU5DRV9TT0ZUX0FGRklOSVRZLAorICAgICAgICBhZmZpbml0eV9iYWxhbmNlX2NwdW1hc2so
c2N1cnItPnZjcHUtPnNjaGVkX2l0ZW0sIEJBTEFOQ0VfU09GVF9BRkZJTklUWSwKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGNwdW1hc2tfc2NyYXRjaCk7CiAgICAgICAgIGlmICgg
dW5saWtlbHkoIWNwdW1hc2tfdGVzdF9jcHUoY3B1LCBjcHVtYXNrX3NjcmF0Y2gpKSApCiAgICAg
ICAgIHsKQEAgLTMzNzcsNyArMzM3OSw3IEBAIHJ1bnFfY2FuZGlkYXRlKHN0cnVjdCBjc2NoZWQy
X3J1bnF1ZXVlX2RhdGEgKnJxZCwKICAgICAgICAgfQogCiAgICAgICAgIC8qIE9ubHkgY29uc2lk
ZXIgdmNwdXMgdGhhdCBhcmUgYWxsb3dlZCB0byBydW4gb24gdGhpcyBwcm9jZXNzb3IuICovCi0g
ICAgICAgIGlmICggIWNwdW1hc2tfdGVzdF9jcHUoY3B1LCBzdmMtPnZjcHUtPmNwdV9oYXJkX2Fm
ZmluaXR5KSApCisgICAgICAgIGlmICggIWNwdW1hc2tfdGVzdF9jcHUoY3B1LCBzdmMtPnZjcHUt
PnNjaGVkX2l0ZW0tPmNwdV9oYXJkX2FmZmluaXR5KSApCiAgICAgICAgIHsKICAgICAgICAgICAg
ICgqc2tpcHBlZCkrKzsKICAgICAgICAgICAgIGNvbnRpbnVlOwpkaWZmIC0tZ2l0IGEveGVuL2Nv
bW1vbi9zY2hlZF9udWxsLmMgYi94ZW4vY29tbW9uL3NjaGVkX251bGwuYwppbmRleCA2MjA5MjVl
OGNlLi5jNDVhZjlmOGVlIDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL3NjaGVkX251bGwuYworKysg
Yi94ZW4vY29tbW9uL3NjaGVkX251bGwuYwpAQCAtMTIzLDcgKzEyMyw4IEBAIHN0YXRpYyBpbmxp
bmUgc3RydWN0IG51bGxfaXRlbSAqbnVsbF9pdGVtKGNvbnN0IHN0cnVjdCBzY2hlZF9pdGVtICpp
dGVtKQogc3RhdGljIGlubGluZSBib29sIHZjcHVfY2hlY2tfYWZmaW5pdHkoc3RydWN0IHZjcHUg
KnYsIHVuc2lnbmVkIGludCBjcHUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICB1bnNpZ25lZCBpbnQgYmFsYW5jZV9zdGVwKQogewotICAgIGFmZmluaXR5X2JhbGFuY2Vf
Y3B1bWFzayh2LCBiYWxhbmNlX3N0ZXAsIGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSk7CisgICAg
YWZmaW5pdHlfYmFsYW5jZV9jcHVtYXNrKHYtPnNjaGVkX2l0ZW0sIGJhbGFuY2Vfc3RlcCwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgY3B1bWFza19zY3JhdGNoX2NwdShjcHUpKTsKICAg
ICBjcHVtYXNrX2FuZChjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksIGNwdW1hc2tfc2NyYXRjaF9j
cHUoY3B1KSwKICAgICAgICAgICAgICAgICBjcHVwb29sX2RvbWFpbl9jcHVtYXNrKHYtPmRvbWFp
bikpOwogCkBAIC0yODEsMTAgKzI4MiwxMCBAQCBwaWNrX3JlcyhzdHJ1Y3QgbnVsbF9wcml2YXRl
ICpwcnYsIHN0cnVjdCBzY2hlZF9pdGVtICppdGVtKQogCiAgICAgZm9yX2VhY2hfYWZmaW5pdHlf
YmFsYW5jZV9zdGVwKCBicyApCiAgICAgewotICAgICAgICBpZiAoIGJzID09IEJBTEFOQ0VfU09G
VF9BRkZJTklUWSAmJiAhaGFzX3NvZnRfYWZmaW5pdHkodikgKQorICAgICAgICBpZiAoIGJzID09
IEJBTEFOQ0VfU09GVF9BRkZJTklUWSAmJiAhaGFzX3NvZnRfYWZmaW5pdHkoaXRlbSkgKQogICAg
ICAgICAgICAgY29udGludWU7CiAKLSAgICAgICAgYWZmaW5pdHlfYmFsYW5jZV9jcHVtYXNrKHYs
IGJzLCBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSkpOworICAgICAgICBhZmZpbml0eV9iYWxhbmNl
X2NwdW1hc2soaXRlbSwgYnMsIGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSk7CiAgICAgICAgIGNw
dW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwgY3B1bWFza19zY3JhdGNoX2NwdShj
cHUpLCBjcHVzKTsKIAogICAgICAgICAvKgpAQCAtMzIxLDcgKzMyMiw3IEBAIHBpY2tfcmVzKHN0
cnVjdCBudWxsX3ByaXZhdGUgKnBydiwgc3RydWN0IHNjaGVkX2l0ZW0gKml0ZW0pCiAgICAgICog
YXMgd2Ugd2lsbCBhY3R1YWxseSBhc3NpZ24gdGhlIHZDUFUgdG8gdGhlIHBDUFUgd2UgcmV0dXJu
IGZyb20gaGVyZSwKICAgICAgKiBvbmx5IGlmIHRoZSBwQ1BVIGlzIGZyZWUuCiAgICAgICovCi0g
ICAgY3B1bWFza19hbmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCBjcHVzLCB2LT5jcHVfaGFy
ZF9hZmZpbml0eSk7CisgICAgY3B1bWFza19hbmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCBj
cHVzLCBpdGVtLT5jcHVfaGFyZF9hZmZpbml0eSk7CiAgICAgbmV3X2NwdSA9IGNwdW1hc2tfYW55
KGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSk7CiAKICBvdXQ6CkBAIC00MzgsNyArNDM5LDcgQEAg
c3RhdGljIHZvaWQgbnVsbF9pdGVtX2luc2VydChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMs
CiAKICAgICBsb2NrID0gaXRlbV9zY2hlZHVsZV9sb2NrKGl0ZW0pOwogCi0gICAgY3B1bWFza19h
bmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCB2LT5jcHVfaGFyZF9hZmZpbml0eSwKKyAgICBj
cHVtYXNrX2FuZChjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksIGl0ZW0tPmNwdV9oYXJkX2FmZmlu
aXR5LAogICAgICAgICAgICAgICAgIGNwdXBvb2xfZG9tYWluX2NwdW1hc2sodi0+ZG9tYWluKSk7
CiAKICAgICAvKiBJZiB0aGUgcENQVSBpcyBmcmVlLCB3ZSBhc3NpZ24gdiB0byBpdCAqLwpAQCAt
NDk2LDcgKzQ5Nyw4IEBAIHN0YXRpYyB2b2lkIF92Y3B1X3JlbW92ZShzdHJ1Y3QgbnVsbF9wcml2
YXRlICpwcnYsIHN0cnVjdCB2Y3B1ICp2KQogICAgIHsKICAgICAgICAgbGlzdF9mb3JfZWFjaF9l
bnRyeSggd3ZjLCAmcHJ2LT53YWl0cSwgd2FpdHFfZWxlbSApCiAgICAgICAgIHsKLSAgICAgICAg
ICAgIGlmICggYnMgPT0gQkFMQU5DRV9TT0ZUX0FGRklOSVRZICYmICFoYXNfc29mdF9hZmZpbml0
eSh3dmMtPnZjcHUpICkKKyAgICAgICAgICAgIGlmICggYnMgPT0gQkFMQU5DRV9TT0ZUX0FGRklO
SVRZICYmCisgICAgICAgICAgICAgICAgICFoYXNfc29mdF9hZmZpbml0eSh3dmMtPnZjcHUtPnNj
aGVkX2l0ZW0pICkKICAgICAgICAgICAgICAgICBjb250aW51ZTsKIAogICAgICAgICAgICAgaWYg
KCB2Y3B1X2NoZWNrX2FmZmluaXR5KHd2Yy0+dmNwdSwgY3B1LCBicykgKQpAQCAtNzc1LDcgKzc3
Nyw3IEBAIHN0YXRpYyBzdHJ1Y3QgdGFza19zbGljZSBudWxsX3NjaGVkdWxlKGNvbnN0IHN0cnVj
dCBzY2hlZHVsZXIgKm9wcywKICAgICAgICAgICAgIGxpc3RfZm9yX2VhY2hfZW50cnkoIHd2Yywg
JnBydi0+d2FpdHEsIHdhaXRxX2VsZW0gKQogICAgICAgICAgICAgewogICAgICAgICAgICAgICAg
IGlmICggYnMgPT0gQkFMQU5DRV9TT0ZUX0FGRklOSVRZICYmCi0gICAgICAgICAgICAgICAgICAg
ICAhaGFzX3NvZnRfYWZmaW5pdHkod3ZjLT52Y3B1KSApCisgICAgICAgICAgICAgICAgICAgICAh
aGFzX3NvZnRfYWZmaW5pdHkod3ZjLT52Y3B1LT5zY2hlZF9pdGVtKSApCiAgICAgICAgICAgICAg
ICAgICAgIGNvbnRpbnVlOwogCiAgICAgICAgICAgICAgICAgaWYgKCB2Y3B1X2NoZWNrX2FmZmlu
aXR5KHd2Yy0+dmNwdSwgY3B1LCBicykgKQpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZF9y
dC5jIGIveGVuL2NvbW1vbi9zY2hlZF9ydC5jCmluZGV4IGE2MDRhMGQ1YTYuLjU4NTYwZDA4NmIg
MTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWRfcnQuYworKysgYi94ZW4vY29tbW9uL3NjaGVk
X3J0LmMKQEAgLTMyNyw3ICszMjcsNyBAQCBydF9kdW1wX3ZjcHUoY29uc3Qgc3RydWN0IHNjaGVk
dWxlciAqb3BzLCBjb25zdCBzdHJ1Y3QgcnRfaXRlbSAqc3ZjKQogICAgIG1hc2sgPSBjcHVtYXNr
X3NjcmF0Y2hfY3B1KHN2Yy0+dmNwdS0+cHJvY2Vzc29yKTsKIAogICAgIGNwdXBvb2xfbWFzayA9
IGNwdXBvb2xfZG9tYWluX2NwdW1hc2soc3ZjLT52Y3B1LT5kb21haW4pOwotICAgIGNwdW1hc2tf
YW5kKG1hc2ssIGNwdXBvb2xfbWFzaywgc3ZjLT52Y3B1LT5jcHVfaGFyZF9hZmZpbml0eSk7Cisg
ICAgY3B1bWFza19hbmQobWFzaywgY3B1cG9vbF9tYXNrLCBzdmMtPnZjcHUtPnNjaGVkX2l0ZW0t
PmNwdV9oYXJkX2FmZmluaXR5KTsKICAgICBwcmludGsoIlslNWQuJS0ydV0gY3B1ICV1LCAoJSJQ
Uklfc3RpbWUiLCAlIlBSSV9zdGltZSIpLCIKICAgICAgICAgICAgIiBjdXJfYj0lIlBSSV9zdGlt
ZSIgY3VyX2Q9JSJQUklfc3RpbWUiIGxhc3Rfc3RhcnQ9JSJQUklfc3RpbWUiXG4iCiAgICAgICAg
ICAgICIgXHRcdCBwcmlvcml0eV9sZXZlbD0lZCBoYXNfZXh0cmF0aW1lPSVkXG4iCkBAIC02NDUs
NyArNjQ1LDcgQEAgcnRfcmVzX3BpY2soY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1
Y3Qgc2NoZWRfaXRlbSAqaXRlbSkKICAgICBpbnQgY3B1OwogCiAgICAgb25saW5lID0gY3B1cG9v
bF9kb21haW5fY3B1bWFzayh2Yy0+ZG9tYWluKTsKLSAgICBjcHVtYXNrX2FuZCgmY3B1cywgb25s
aW5lLCB2Yy0+Y3B1X2hhcmRfYWZmaW5pdHkpOworICAgIGNwdW1hc2tfYW5kKCZjcHVzLCBvbmxp
bmUsIGl0ZW0tPmNwdV9oYXJkX2FmZmluaXR5KTsKIAogICAgIGNwdSA9IGNwdW1hc2tfdGVzdF9j
cHUodmMtPnByb2Nlc3NvciwgJmNwdXMpCiAgICAgICAgICAgICA/IHZjLT5wcm9jZXNzb3IKQEAg
LTEwMzAsNyArMTAzMCw4IEBAIHJ1bnFfcGljayhjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMs
IGNvbnN0IGNwdW1hc2tfdCAqbWFzaykKIAogICAgICAgICAvKiBtYXNrIGNwdV9oYXJkX2FmZmlu
aXR5ICYgY3B1cG9vbCAmIG1hc2sgKi8KICAgICAgICAgb25saW5lID0gY3B1cG9vbF9kb21haW5f
Y3B1bWFzayhpdGVyX3N2Yy0+dmNwdS0+ZG9tYWluKTsKLSAgICAgICAgY3B1bWFza19hbmQoJmNw
dV9jb21tb24sIG9ubGluZSwgaXRlcl9zdmMtPnZjcHUtPmNwdV9oYXJkX2FmZmluaXR5KTsKKyAg
ICAgICAgY3B1bWFza19hbmQoJmNwdV9jb21tb24sIG9ubGluZSwKKyAgICAgICAgICAgICAgICAg
ICAgaXRlcl9zdmMtPnZjcHUtPnNjaGVkX2l0ZW0tPmNwdV9oYXJkX2FmZmluaXR5KTsKICAgICAg
ICAgY3B1bWFza19hbmQoJmNwdV9jb21tb24sIG1hc2ssICZjcHVfY29tbW9uKTsKICAgICAgICAg
aWYgKCBjcHVtYXNrX2VtcHR5KCZjcHVfY29tbW9uKSApCiAgICAgICAgICAgICBjb250aW51ZTsK
QEAgLTExOTksNyArMTIwMCw3IEBAIHJ1bnFfdGlja2xlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIg
Km9wcywgc3RydWN0IHJ0X2l0ZW0gKm5ldykKICAgICAgICAgcmV0dXJuOwogCiAgICAgb25saW5l
ID0gY3B1cG9vbF9kb21haW5fY3B1bWFzayhuZXctPnZjcHUtPmRvbWFpbik7Ci0gICAgY3B1bWFz
a19hbmQoJm5vdF90aWNrbGVkLCBvbmxpbmUsIG5ldy0+dmNwdS0+Y3B1X2hhcmRfYWZmaW5pdHkp
OworICAgIGNwdW1hc2tfYW5kKCZub3RfdGlja2xlZCwgb25saW5lLCBuZXctPnZjcHUtPnNjaGVk
X2l0ZW0tPmNwdV9oYXJkX2FmZmluaXR5KTsKICAgICBjcHVtYXNrX2FuZG5vdCgmbm90X3RpY2ts
ZWQsICZub3RfdGlja2xlZCwgJnBydi0+dGlja2xlZCk7CiAKICAgICAvKgpkaWZmIC0tZ2l0IGEv
eGVuL2NvbW1vbi9zY2hlZHVsZS5jIGIveGVuL2NvbW1vbi9zY2hlZHVsZS5jCmluZGV4IDQ2NGUz
NThmNzAuLmY0ODUwYTU3ZjYgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWR1bGUuYworKysg
Yi94ZW4vY29tbW9uL3NjaGVkdWxlLmMKQEAgLTI3MCw2ICsyNzAsMTIgQEAgc3RhdGljIHZvaWQg
c2NoZWRfZnJlZV9pdGVtKHN0cnVjdCBzY2hlZF9pdGVtICppdGVtKQogICAgIH0KIAogICAgIGl0
ZW0tPnZjcHUtPnNjaGVkX2l0ZW0gPSBOVUxMOworCisgICAgZnJlZV9jcHVtYXNrX3ZhcihpdGVt
LT5jcHVfaGFyZF9hZmZpbml0eSk7CisgICAgZnJlZV9jcHVtYXNrX3ZhcihpdGVtLT5jcHVfaGFy
ZF9hZmZpbml0eV90bXApOworICAgIGZyZWVfY3B1bWFza192YXIoaXRlbS0+Y3B1X2hhcmRfYWZm
aW5pdHlfc2F2ZWQpOworICAgIGZyZWVfY3B1bWFza192YXIoaXRlbS0+Y3B1X3NvZnRfYWZmaW5p
dHkpOworCiAgICAgeGZyZWUoaXRlbSk7CiB9CiAKQEAgLTI5Myw3ICsyOTksMTcgQEAgc3RhdGlj
IHN0cnVjdCBzY2hlZF9pdGVtICpzY2hlZF9hbGxvY19pdGVtKHN0cnVjdCB2Y3B1ICp2KQogICAg
IGl0ZW0tPm5leHRfaW5fbGlzdCA9ICpwcmV2X2l0ZW07CiAgICAgKnByZXZfaXRlbSA9IGl0ZW07
CiAKKyAgICBpZiAoICF6YWxsb2NfY3B1bWFza192YXIoJml0ZW0tPmNwdV9oYXJkX2FmZmluaXR5
KSB8fAorICAgICAgICAgIXphbGxvY19jcHVtYXNrX3ZhcigmaXRlbS0+Y3B1X2hhcmRfYWZmaW5p
dHlfdG1wKSB8fAorICAgICAgICAgIXphbGxvY19jcHVtYXNrX3ZhcigmaXRlbS0+Y3B1X2hhcmRf
YWZmaW5pdHlfc2F2ZWQpIHx8CisgICAgICAgICAhemFsbG9jX2NwdW1hc2tfdmFyKCZpdGVtLT5j
cHVfc29mdF9hZmZpbml0eSkgKQorICAgICAgICBnb3RvIGZhaWw7CisKICAgICByZXR1cm4gaXRl
bTsKKworIGZhaWw6CisgICAgc2NoZWRfZnJlZV9pdGVtKGl0ZW0pOworICAgIHJldHVybiBOVUxM
OwogfQogCiBpbnQgc2NoZWRfaW5pdF92Y3B1KHN0cnVjdCB2Y3B1ICp2LCB1bnNpZ25lZCBpbnQg
cHJvY2Vzc29yKQpAQCAtMzYzLDcgKzM3OSw3IEBAIGludCBzY2hlZF9tb3ZlX2RvbWFpbihzdHJ1
Y3QgZG9tYWluICpkLCBzdHJ1Y3QgY3B1cG9vbCAqYykKIAogICAgIGZvcl9lYWNoX3ZjcHUgKCBk
LCB2ICkKICAgICB7Ci0gICAgICAgIGlmICggdi0+YWZmaW5pdHlfYnJva2VuICkKKyAgICAgICAg
aWYgKCB2LT5zY2hlZF9pdGVtLT5hZmZpbml0eV9icm9rZW4gKQogICAgICAgICAgICAgcmV0dXJu
IC1FQlVTWTsKICAgICB9CiAKQEAgLTY4Miw3ICs2OTgsNyBAQCBzdGF0aWMgdm9pZCB2Y3B1X21p
Z3JhdGVfZmluaXNoKHN0cnVjdCB2Y3B1ICp2KQogICAgICAgICAgICAgICovCiAgICAgICAgICAg
ICBpZiAoIHBpY2tfY2FsbGVkICYmCiAgICAgICAgICAgICAgICAgIChuZXdfbG9jayA9PSBwZXJf
Y3B1KHNjaGVkX3JlcywgbmV3X2NwdSktPnNjaGVkdWxlX2xvY2spICYmCi0gICAgICAgICAgICAg
ICAgIGNwdW1hc2tfdGVzdF9jcHUobmV3X2NwdSwgdi0+Y3B1X2hhcmRfYWZmaW5pdHkpICYmCisg
ICAgICAgICAgICAgICAgIGNwdW1hc2tfdGVzdF9jcHUobmV3X2NwdSwgdi0+c2NoZWRfaXRlbS0+
Y3B1X2hhcmRfYWZmaW5pdHkpICYmCiAgICAgICAgICAgICAgICAgIGNwdW1hc2tfdGVzdF9jcHUo
bmV3X2NwdSwgdi0+ZG9tYWluLT5jcHVwb29sLT5jcHVfdmFsaWQpICkKICAgICAgICAgICAgICAg
ICBicmVhazsKIApAQCAtNzU4LDYgKzc3NCw3IEBAIHZvaWQgcmVzdG9yZV92Y3B1X2FmZmluaXR5
KHN0cnVjdCBkb21haW4gKmQpCiAgICAgewogICAgICAgICBzcGlubG9ja190ICpsb2NrOwogICAg
ICAgICB1bnNpZ25lZCBpbnQgb2xkX2NwdSA9IHYtPnByb2Nlc3NvcjsKKyAgICAgICAgc3RydWN0
IHNjaGVkX2l0ZW0gKml0ZW0gPSB2LT5zY2hlZF9pdGVtOwogCiAgICAgICAgIEFTU0VSVCghdmNw
dV9ydW5uYWJsZSh2KSk7CiAKQEAgLTc2OSwxNSArNzg2LDE1IEBAIHZvaWQgcmVzdG9yZV92Y3B1
X2FmZmluaXR5KHN0cnVjdCBkb21haW4gKmQpCiAgICAgICAgICAqIHNldCB2LT5wcm9jZXNzb3Ig
b2YgZWFjaCBvZiB0aGVpciB2Q1BVcyB0byBzb21ldGhpbmcgdGhhdCB3aWxsCiAgICAgICAgICAq
IG1ha2Ugc2Vuc2UgZm9yIHRoZSBzY2hlZHVsZXIgb2YgdGhlIGNwdXBvb2wgaW4gd2hpY2ggdGhl
eSBhcmUgaW4uCiAgICAgICAgICAqLwotICAgICAgICBjcHVtYXNrX2FuZChjcHVtYXNrX3NjcmF0
Y2hfY3B1KGNwdSksIHYtPmNwdV9oYXJkX2FmZmluaXR5LAorICAgICAgICBjcHVtYXNrX2FuZChj
cHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksIGl0ZW0tPmNwdV9oYXJkX2FmZmluaXR5LAogICAgICAg
ICAgICAgICAgICAgICBjcHVwb29sX2RvbWFpbl9jcHVtYXNrKGQpKTsKICAgICAgICAgaWYgKCBj
cHVtYXNrX2VtcHR5KGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSkgKQogICAgICAgICB7Ci0gICAg
ICAgICAgICBpZiAoIHYtPmFmZmluaXR5X2Jyb2tlbiApCisgICAgICAgICAgICBpZiAoIGl0ZW0t
PmFmZmluaXR5X2Jyb2tlbiApCiAgICAgICAgICAgICB7Ci0gICAgICAgICAgICAgICAgc2NoZWRf
c2V0X2FmZmluaXR5KHYsIHYtPmNwdV9oYXJkX2FmZmluaXR5X3NhdmVkLCBOVUxMKTsKLSAgICAg
ICAgICAgICAgICB2LT5hZmZpbml0eV9icm9rZW4gPSAwOwotICAgICAgICAgICAgICAgIGNwdW1h
c2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwgdi0+Y3B1X2hhcmRfYWZmaW5pdHksCisg
ICAgICAgICAgICAgICAgc2NoZWRfc2V0X2FmZmluaXR5KHYsIGl0ZW0tPmNwdV9oYXJkX2FmZmlu
aXR5X3NhdmVkLCBOVUxMKTsKKyAgICAgICAgICAgICAgICBpdGVtLT5hZmZpbml0eV9icm9rZW4g
PSAwOworICAgICAgICAgICAgICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1
KSwgaXRlbS0+Y3B1X2hhcmRfYWZmaW5pdHksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
Y3B1cG9vbF9kb21haW5fY3B1bWFzayhkKSk7CiAgICAgICAgICAgICB9CiAKQEAgLTc4NSwxOCAr
ODAyLDE3IEBAIHZvaWQgcmVzdG9yZV92Y3B1X2FmZmluaXR5KHN0cnVjdCBkb21haW4gKmQpCiAg
ICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgcHJpbnRrKFhFTkxPR19ERUJVRyAiQnJlYWtp
bmcgYWZmaW5pdHkgZm9yICVwdlxuIiwgdik7CiAgICAgICAgICAgICAgICAgc2NoZWRfc2V0X2Fm
ZmluaXR5KHYsICZjcHVtYXNrX2FsbCwgTlVMTCk7Ci0gICAgICAgICAgICAgICAgY3B1bWFza19h
bmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCB2LT5jcHVfaGFyZF9hZmZpbml0eSwKKyAgICAg
ICAgICAgICAgICBjcHVtYXNrX2FuZChjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksIGl0ZW0tPmNw
dV9oYXJkX2FmZmluaXR5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNwdXBvb2xfZG9t
YWluX2NwdW1hc2soZCkpOwogICAgICAgICAgICAgfQogICAgICAgICB9CiAKICAgICAgICAgdi0+
cHJvY2Vzc29yID0gY3B1bWFza19hbnkoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpKTsKLSAgICAg
ICAgdi0+c2NoZWRfaXRlbS0+cmVzID0gcGVyX2NwdShzY2hlZF9yZXMsIHYtPnByb2Nlc3Nvcik7
CisgICAgICAgIGl0ZW0tPnJlcyA9IHBlcl9jcHUoc2NoZWRfcmVzLCB2LT5wcm9jZXNzb3IpOwog
Ci0gICAgICAgIGxvY2sgPSBpdGVtX3NjaGVkdWxlX2xvY2tfaXJxKHYtPnNjaGVkX2l0ZW0pOwot
ICAgICAgICB2LT5zY2hlZF9pdGVtLT5yZXMgPSBzY2hlZF9waWNrX3Jlc291cmNlKHZjcHVfc2No
ZWR1bGVyKHYpLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHYtPnNjaGVkX2l0ZW0pOwotICAgICAgICB2LT5wcm9jZXNzb3IgPSB2LT5zY2hlZF9pdGVt
LT5yZXMtPnByb2Nlc3NvcjsKKyAgICAgICAgbG9jayA9IGl0ZW1fc2NoZWR1bGVfbG9ja19pcnEo
aXRlbSk7CisgICAgICAgIGl0ZW0tPnJlcyA9IHNjaGVkX3BpY2tfcmVzb3VyY2UodmNwdV9zY2hl
ZHVsZXIodiksIGl0ZW0pOworICAgICAgICB2LT5wcm9jZXNzb3IgPSBpdGVtLT5yZXMtPnByb2Nl
c3NvcjsKICAgICAgICAgc3Bpbl91bmxvY2tfaXJxKGxvY2spOwogCiAgICAgICAgIGlmICggb2xk
X2NwdSAhPSB2LT5wcm9jZXNzb3IgKQpAQCAtODI4LDE2ICs4NDQsMTcgQEAgaW50IGNwdV9kaXNh
YmxlX3NjaGVkdWxlcih1bnNpZ25lZCBpbnQgY3B1KQogICAgICAgICBmb3JfZWFjaF92Y3B1ICgg
ZCwgdiApCiAgICAgICAgIHsKICAgICAgICAgICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7Ci0gICAg
ICAgICAgICBzcGlubG9ja190ICpsb2NrID0gaXRlbV9zY2hlZHVsZV9sb2NrX2lycXNhdmUodi0+
c2NoZWRfaXRlbSwgJmZsYWdzKTsKKyAgICAgICAgICAgIHN0cnVjdCBzY2hlZF9pdGVtICppdGVt
ID0gdi0+c2NoZWRfaXRlbTsKKyAgICAgICAgICAgIHNwaW5sb2NrX3QgKmxvY2sgPSBpdGVtX3Nj
aGVkdWxlX2xvY2tfaXJxc2F2ZShpdGVtLCAmZmxhZ3MpOwogCi0gICAgICAgICAgICBjcHVtYXNr
X2FuZCgmb25saW5lX2FmZmluaXR5LCB2LT5jcHVfaGFyZF9hZmZpbml0eSwgYy0+Y3B1X3ZhbGlk
KTsKKyAgICAgICAgICAgIGNwdW1hc2tfYW5kKCZvbmxpbmVfYWZmaW5pdHksIGl0ZW0tPmNwdV9o
YXJkX2FmZmluaXR5LCBjLT5jcHVfdmFsaWQpOwogICAgICAgICAgICAgaWYgKCBjcHVtYXNrX2Vt
cHR5KCZvbmxpbmVfYWZmaW5pdHkpICYmCi0gICAgICAgICAgICAgICAgIGNwdW1hc2tfdGVzdF9j
cHUoY3B1LCB2LT5jcHVfaGFyZF9hZmZpbml0eSkgKQorICAgICAgICAgICAgICAgICBjcHVtYXNr
X3Rlc3RfY3B1KGNwdSwgaXRlbS0+Y3B1X2hhcmRfYWZmaW5pdHkpICkKICAgICAgICAgICAgIHsK
LSAgICAgICAgICAgICAgICBpZiAoIHYtPmFmZmluaXR5X2Jyb2tlbiApCisgICAgICAgICAgICAg
ICAgaWYgKCBpdGVtLT5hZmZpbml0eV9icm9rZW4gKQogICAgICAgICAgICAgICAgIHsKICAgICAg
ICAgICAgICAgICAgICAgLyogVGhlIHZjcHUgaXMgdGVtcG9yYXJpbHkgcGlubmVkLCBjYW4ndCBt
b3ZlIGl0LiAqLwotICAgICAgICAgICAgICAgICAgICBpdGVtX3NjaGVkdWxlX3VubG9ja19pcnFy
ZXN0b3JlKGxvY2ssIGZsYWdzLCB2LT5zY2hlZF9pdGVtKTsKKyAgICAgICAgICAgICAgICAgICAg
aXRlbV9zY2hlZHVsZV91bmxvY2tfaXJxcmVzdG9yZShsb2NrLCBmbGFncywgaXRlbSk7CiAgICAg
ICAgICAgICAgICAgICAgIHJldCA9IC1FQUREUklOVVNFOwogICAgICAgICAgICAgICAgICAgICBi
cmVhazsKICAgICAgICAgICAgICAgICB9CkBAIC04NTAsNyArODY3LDcgQEAgaW50IGNwdV9kaXNh
YmxlX3NjaGVkdWxlcih1bnNpZ25lZCBpbnQgY3B1KQogICAgICAgICAgICAgaWYgKCB2LT5wcm9j
ZXNzb3IgIT0gY3B1ICkKICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAvKiBUaGUgdmNw
dSBpcyBub3Qgb24gdGhpcyBjcHUsIHNvIHdlIGNhbiBtb3ZlIG9uLiAqLwotICAgICAgICAgICAg
ICAgIGl0ZW1fc2NoZWR1bGVfdW5sb2NrX2lycXJlc3RvcmUobG9jaywgZmxhZ3MsIHYtPnNjaGVk
X2l0ZW0pOworICAgICAgICAgICAgICAgIGl0ZW1fc2NoZWR1bGVfdW5sb2NrX2lycXJlc3RvcmUo
bG9jaywgZmxhZ3MsIGl0ZW0pOwogICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAg
ICAgfQogCkBAIC04NjMsNyArODgwLDcgQEAgaW50IGNwdV9kaXNhYmxlX3NjaGVkdWxlcih1bnNp
Z25lZCBpbnQgY3B1KQogICAgICAgICAgICAgICogICAgdGhpbmdzIHdvdWxkIGhhdmUgZmFpbGVk
IGJlZm9yZSBnZXR0aW5nIGluIGhlcmUuCiAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgIHZj
cHVfbWlncmF0ZV9zdGFydCh2KTsKLSAgICAgICAgICAgIGl0ZW1fc2NoZWR1bGVfdW5sb2NrX2ly
cXJlc3RvcmUobG9jaywgZmxhZ3MsIHYtPnNjaGVkX2l0ZW0pOworICAgICAgICAgICAgaXRlbV9z
Y2hlZHVsZV91bmxvY2tfaXJxcmVzdG9yZShsb2NrLCBmbGFncywgaXRlbSk7CiAKICAgICAgICAg
ICAgIHZjcHVfbWlncmF0ZV9maW5pc2godik7CiAKQEAgLTg5Miw3ICs5MDksNyBAQCBzdGF0aWMg
aW50IGNwdV9kaXNhYmxlX3NjaGVkdWxlcl9jaGVjayh1bnNpZ25lZCBpbnQgY3B1KQogCiAgICAg
Zm9yX2VhY2hfZG9tYWluX2luX2NwdXBvb2wgKCBkLCBjICkKICAgICAgICAgZm9yX2VhY2hfdmNw
dSAoIGQsIHYgKQotICAgICAgICAgICAgaWYgKCB2LT5hZmZpbml0eV9icm9rZW4gKQorICAgICAg
ICAgICAgaWYgKCB2LT5zY2hlZF9pdGVtLT5hZmZpbml0eV9icm9rZW4gKQogICAgICAgICAgICAg
ICAgIHJldHVybiAtRUFERFJJTlVTRTsKIAogICAgIHJldHVybiAwOwpAQCAtOTA4LDI4ICs5MjUs
MzEgQEAgc3RhdGljIGludCBjcHVfZGlzYWJsZV9zY2hlZHVsZXJfY2hlY2sodW5zaWduZWQgaW50
IGNwdSkKIHZvaWQgc2NoZWRfc2V0X2FmZmluaXR5KAogICAgIHN0cnVjdCB2Y3B1ICp2LCBjb25z
dCBjcHVtYXNrX3QgKmhhcmQsIGNvbnN0IGNwdW1hc2tfdCAqc29mdCkKIHsKLSAgICBzY2hlZF9h
ZGp1c3RfYWZmaW5pdHkoZG9tX3NjaGVkdWxlcih2LT5kb21haW4pLCB2LT5zY2hlZF9pdGVtLCBo
YXJkLCBzb2Z0KTsKKyAgICBzdHJ1Y3Qgc2NoZWRfaXRlbSAqaXRlbSA9IHYtPnNjaGVkX2l0ZW07
CisKKyAgICBzY2hlZF9hZGp1c3RfYWZmaW5pdHkoZG9tX3NjaGVkdWxlcih2LT5kb21haW4pLCBp
dGVtLCBoYXJkLCBzb2Z0KTsKIAogICAgIGlmICggaGFyZCApCi0gICAgICAgIGNwdW1hc2tfY29w
eSh2LT5jcHVfaGFyZF9hZmZpbml0eSwgaGFyZCk7CisgICAgICAgIGNwdW1hc2tfY29weShpdGVt
LT5jcHVfaGFyZF9hZmZpbml0eSwgaGFyZCk7CiAgICAgaWYgKCBzb2Z0ICkKLSAgICAgICAgY3B1
bWFza19jb3B5KHYtPmNwdV9zb2Z0X2FmZmluaXR5LCBzb2Z0KTsKKyAgICAgICAgY3B1bWFza19j
b3B5KGl0ZW0tPmNwdV9zb2Z0X2FmZmluaXR5LCBzb2Z0KTsKIAotICAgIHYtPnNvZnRfYWZmX2Vm
ZmVjdGl2ZSA9ICFjcHVtYXNrX3N1YnNldCh2LT5jcHVfaGFyZF9hZmZpbml0eSwKLSAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi0+Y3B1X3NvZnRfYWZmaW5pdHkp
ICYmCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3B1bWFza19pbnRlcnNlY3RzKHYtPmNw
dV9zb2Z0X2FmZmluaXR5LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICB2LT5jcHVfaGFyZF9hZmZpbml0eSk7CisgICAgaXRlbS0+c29mdF9hZmZfZWZmZWN0
aXZlID0gIWNwdW1hc2tfc3Vic2V0KGl0ZW0tPmNwdV9oYXJkX2FmZmluaXR5LAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLT5jcHVfc29mdF9hZmZp
bml0eSkgJiYKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcHVtYXNrX2ludGVyc2Vj
dHMoaXRlbS0+Y3B1X3NvZnRfYWZmaW5pdHksCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGl0ZW0tPmNwdV9oYXJkX2FmZmluaXR5KTsKIH0KIAogc3Rh
dGljIGludCB2Y3B1X3NldF9hZmZpbml0eSgKICAgICBzdHJ1Y3QgdmNwdSAqdiwgY29uc3QgY3B1
bWFza190ICphZmZpbml0eSwgY29uc3QgY3B1bWFza190ICp3aGljaCkKIHsKKyAgICBzdHJ1Y3Qg
c2NoZWRfaXRlbSAqaXRlbSA9IHYtPnNjaGVkX2l0ZW07CiAgICAgc3BpbmxvY2tfdCAqbG9jazsK
ICAgICBpbnQgcmV0ID0gMDsKIAotICAgIGxvY2sgPSBpdGVtX3NjaGVkdWxlX2xvY2tfaXJxKHYt
PnNjaGVkX2l0ZW0pOworICAgIGxvY2sgPSBpdGVtX3NjaGVkdWxlX2xvY2tfaXJxKGl0ZW0pOwog
Ci0gICAgaWYgKCB2LT5hZmZpbml0eV9icm9rZW4gKQorICAgIGlmICggaXRlbS0+YWZmaW5pdHlf
YnJva2VuICkKICAgICAgICAgcmV0ID0gLUVCVVNZOwogICAgIGVsc2UKICAgICB7CkBAIC05Mzcs
MTkgKzk1NywxOSBAQCBzdGF0aWMgaW50IHZjcHVfc2V0X2FmZmluaXR5KAogICAgICAgICAgKiBU
ZWxsIHRoZSBzY2hlZHVsZXIgd2UgY2hhbmdlcyBzb21ldGhpbmcgYWJvdXQgYWZmaW5pdHksCiAg
ICAgICAgICAqIGFuZCBhc2sgdG8gcmUtZXZhbHVhdGUgdmNwdSBwbGFjZW1lbnQuCiAgICAgICAg
ICAqLwotICAgICAgICBpZiAoIHdoaWNoID09IHYtPmNwdV9oYXJkX2FmZmluaXR5ICkKKyAgICAg
ICAgaWYgKCB3aGljaCA9PSBpdGVtLT5jcHVfaGFyZF9hZmZpbml0eSApCiAgICAgICAgIHsKICAg
ICAgICAgICAgIHNjaGVkX3NldF9hZmZpbml0eSh2LCBhZmZpbml0eSwgTlVMTCk7CiAgICAgICAg
IH0KICAgICAgICAgZWxzZQogICAgICAgICB7Ci0gICAgICAgICAgICBBU1NFUlQod2hpY2ggPT0g
di0+Y3B1X3NvZnRfYWZmaW5pdHkpOworICAgICAgICAgICAgQVNTRVJUKHdoaWNoID09IGl0ZW0t
PmNwdV9zb2Z0X2FmZmluaXR5KTsKICAgICAgICAgICAgIHNjaGVkX3NldF9hZmZpbml0eSh2LCBO
VUxMLCBhZmZpbml0eSk7CiAgICAgICAgIH0KICAgICAgICAgdmNwdV9taWdyYXRlX3N0YXJ0KHYp
OwogICAgIH0KIAotICAgIGl0ZW1fc2NoZWR1bGVfdW5sb2NrX2lycShsb2NrLCB2LT5zY2hlZF9p
dGVtKTsKKyAgICBpdGVtX3NjaGVkdWxlX3VubG9ja19pcnEobG9jaywgaXRlbSk7CiAKICAgICBk
b21haW5fdXBkYXRlX25vZGVfYWZmaW5pdHkodi0+ZG9tYWluKTsKIApAQCAtOTY4LDEyICs5ODgs
MTIgQEAgaW50IHZjcHVfc2V0X2hhcmRfYWZmaW5pdHkoc3RydWN0IHZjcHUgKnYsIGNvbnN0IGNw
dW1hc2tfdCAqYWZmaW5pdHkpCiAgICAgaWYgKCBjcHVtYXNrX2VtcHR5KCZvbmxpbmVfYWZmaW5p
dHkpICkKICAgICAgICAgcmV0dXJuIC1FSU5WQUw7CiAKLSAgICByZXR1cm4gdmNwdV9zZXRfYWZm
aW5pdHkodiwgYWZmaW5pdHksIHYtPmNwdV9oYXJkX2FmZmluaXR5KTsKKyAgICByZXR1cm4gdmNw
dV9zZXRfYWZmaW5pdHkodiwgYWZmaW5pdHksIHYtPnNjaGVkX2l0ZW0tPmNwdV9oYXJkX2FmZmlu
aXR5KTsKIH0KIAogaW50IHZjcHVfc2V0X3NvZnRfYWZmaW5pdHkoc3RydWN0IHZjcHUgKnYsIGNv
bnN0IGNwdW1hc2tfdCAqYWZmaW5pdHkpCiB7Ci0gICAgcmV0dXJuIHZjcHVfc2V0X2FmZmluaXR5
KHYsIGFmZmluaXR5LCB2LT5jcHVfc29mdF9hZmZpbml0eSk7CisgICAgcmV0dXJuIHZjcHVfc2V0
X2FmZmluaXR5KHYsIGFmZmluaXR5LCB2LT5zY2hlZF9pdGVtLT5jcHVfc29mdF9hZmZpbml0eSk7
CiB9CiAKIC8qIEJsb2NrIHRoZSBjdXJyZW50bHktZXhlY3V0aW5nIGRvbWFpbiB1bnRpbCBhIHBl
cnRpbmVudCBldmVudCBvY2N1cnMuICovCkBAIC0xMTY3LDI4ICsxMTg3LDMwIEBAIHZvaWQgd2F0
Y2hkb2dfZG9tYWluX2Rlc3Ryb3koc3RydWN0IGRvbWFpbiAqZCkKIAogaW50IHZjcHVfcGluX292
ZXJyaWRlKHN0cnVjdCB2Y3B1ICp2LCBpbnQgY3B1KQogeworICAgIHN0cnVjdCBzY2hlZF9pdGVt
ICppdGVtID0gdi0+c2NoZWRfaXRlbTsKICAgICBzcGlubG9ja190ICpsb2NrOwogICAgIGludCBy
ZXQgPSAtRUlOVkFMOwogCi0gICAgbG9jayA9IGl0ZW1fc2NoZWR1bGVfbG9ja19pcnEodi0+c2No
ZWRfaXRlbSk7CisgICAgbG9jayA9IGl0ZW1fc2NoZWR1bGVfbG9ja19pcnEoaXRlbSk7CiAKICAg
ICBpZiAoIGNwdSA8IDAgKQogICAgIHsKLSAgICAgICAgaWYgKCB2LT5hZmZpbml0eV9icm9rZW4g
KQorICAgICAgICBpZiAoIGl0ZW0tPmFmZmluaXR5X2Jyb2tlbiApCiAgICAgICAgIHsKLSAgICAg
ICAgICAgIHNjaGVkX3NldF9hZmZpbml0eSh2LCB2LT5jcHVfaGFyZF9hZmZpbml0eV9zYXZlZCwg
TlVMTCk7Ci0gICAgICAgICAgICB2LT5hZmZpbml0eV9icm9rZW4gPSAwOworICAgICAgICAgICAg
c2NoZWRfc2V0X2FmZmluaXR5KHYsIGl0ZW0tPmNwdV9oYXJkX2FmZmluaXR5X3NhdmVkLCBOVUxM
KTsKKyAgICAgICAgICAgIGl0ZW0tPmFmZmluaXR5X2Jyb2tlbiA9IDA7CiAgICAgICAgICAgICBy
ZXQgPSAwOwogICAgICAgICB9CiAgICAgfQogICAgIGVsc2UgaWYgKCBjcHUgPCBucl9jcHVfaWRz
ICkKICAgICB7Ci0gICAgICAgIGlmICggdi0+YWZmaW5pdHlfYnJva2VuICkKKyAgICAgICAgaWYg
KCBpdGVtLT5hZmZpbml0eV9icm9rZW4gKQogICAgICAgICAgICAgcmV0ID0gLUVCVVNZOwogICAg
ICAgICBlbHNlIGlmICggY3B1bWFza190ZXN0X2NwdShjcHUsIFZDUFUyT05MSU5FKHYpKSApCiAg
ICAgICAgIHsKLSAgICAgICAgICAgIGNwdW1hc2tfY29weSh2LT5jcHVfaGFyZF9hZmZpbml0eV9z
YXZlZCwgdi0+Y3B1X2hhcmRfYWZmaW5pdHkpOwotICAgICAgICAgICAgdi0+YWZmaW5pdHlfYnJv
a2VuID0gMTsKKyAgICAgICAgICAgIGNwdW1hc2tfY29weShpdGVtLT5jcHVfaGFyZF9hZmZpbml0
eV9zYXZlZCwKKyAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLT5jcHVfaGFyZF9hZmZpbml0
eSk7CisgICAgICAgICAgICBpdGVtLT5hZmZpbml0eV9icm9rZW4gPSAxOwogICAgICAgICAgICAg
c2NoZWRfc2V0X2FmZmluaXR5KHYsIGNwdW1hc2tfb2YoY3B1KSwgTlVMTCk7CiAgICAgICAgICAg
ICByZXQgPSAwOwogICAgICAgICB9CkBAIC0xMTk3LDcgKzEyMTksNyBAQCBpbnQgdmNwdV9waW5f
b3ZlcnJpZGUoc3RydWN0IHZjcHUgKnYsIGludCBjcHUpCiAgICAgaWYgKCByZXQgPT0gMCApCiAg
ICAgICAgIHZjcHVfbWlncmF0ZV9zdGFydCh2KTsKIAotICAgIGl0ZW1fc2NoZWR1bGVfdW5sb2Nr
X2lycShsb2NrLCB2LT5zY2hlZF9pdGVtKTsKKyAgICBpdGVtX3NjaGVkdWxlX3VubG9ja19pcnEo
bG9jaywgaXRlbSk7CiAKICAgICBkb21haW5fdXBkYXRlX25vZGVfYWZmaW5pdHkodi0+ZG9tYWlu
KTsKIApAQCAtMTU0OSw3ICsxNTcxLDcgQEAgc3RhdGljIHZvaWQgc2NoZWR1bGUodm9pZCkKICAg
ICAgICAgKChwcmV2LT5wYXVzZV9mbGFncyAmIFZQRl9ibG9ja2VkKSA/IFJVTlNUQVRFX2Jsb2Nr
ZWQgOgogICAgICAgICAgKHZjcHVfcnVubmFibGUocHJldikgPyBSVU5TVEFURV9ydW5uYWJsZSA6
IFJVTlNUQVRFX29mZmxpbmUpKSwKICAgICAgICAgbm93KTsKLSAgICBwcmV2LT5sYXN0X3J1bl90
aW1lID0gbm93OworICAgIHByZXYtPnNjaGVkX2l0ZW0tPmxhc3RfcnVuX3RpbWUgPSBub3c7CiAK
ICAgICBBU1NFUlQobmV4dC0+cnVuc3RhdGUuc3RhdGUgIT0gUlVOU1RBVEVfcnVubmluZyk7CiAg
ICAgdmNwdV9ydW5zdGF0ZV9jaGFuZ2UobmV4dCwgUlVOU1RBVEVfcnVubmluZywgbm93KTsKZGlm
ZiAtLWdpdCBhL3hlbi9jb21tb24vd2FpdC5jIGIveGVuL2NvbW1vbi93YWl0LmMKaW5kZXggNGY4
MzBhMTRlOC4uNDdmMTc5MjhjNCAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi93YWl0LmMKKysrIGIv
eGVuL2NvbW1vbi93YWl0LmMKQEAgLTEzMiw3ICsxMzIsNyBAQCBzdGF0aWMgdm9pZCBfX3ByZXBh
cmVfdG9fd2FpdChzdHJ1Y3Qgd2FpdHF1ZXVlX3ZjcHUgKndxdikKIAogICAgIC8qIFNhdmUgY3Vy
cmVudCBWQ1BVIGFmZmluaXR5OyBmb3JjZSB3YWtldXAgb24gKnRoaXMqIENQVSBvbmx5LiAqLwog
ICAgIHdxdi0+d2FrZXVwX2NwdSA9IHNtcF9wcm9jZXNzb3JfaWQoKTsKLSAgICBjcHVtYXNrX2Nv
cHkoJndxdi0+c2F2ZWRfYWZmaW5pdHksIGN1cnItPmNwdV9oYXJkX2FmZmluaXR5KTsKKyAgICBj
cHVtYXNrX2NvcHkoJndxdi0+c2F2ZWRfYWZmaW5pdHksIGN1cnItPnNjaGVkX2l0ZW0tPmNwdV9o
YXJkX2FmZmluaXR5KTsKICAgICBpZiAoIHZjcHVfc2V0X2hhcmRfYWZmaW5pdHkoY3VyciwgY3B1
bWFza19vZih3cXYtPndha2V1cF9jcHUpKSApCiAgICAgewogICAgICAgICBnZHByaW50ayhYRU5M
T0dfRVJSLCAiVW5hYmxlIHRvIHNldCB2Y3B1IGFmZmluaXR5XG4iKTsKQEAgLTE5OSw3ICsxOTks
NyBAQCB2b2lkIGNoZWNrX3dha2V1cF9mcm9tX3dhaXQodm9pZCkKICAgICB7CiAgICAgICAgIC8q
IFJlLXNldCBWQ1BVIGFmZmluaXR5IGFuZCByZS1lbnRlciB0aGUgc2NoZWR1bGVyLiAqLwogICAg
ICAgICBzdHJ1Y3QgdmNwdSAqY3VyciA9IGN1cnJlbnQ7Ci0gICAgICAgIGNwdW1hc2tfY29weSgm
d3F2LT5zYXZlZF9hZmZpbml0eSwgY3Vyci0+Y3B1X2hhcmRfYWZmaW5pdHkpOworICAgICAgICBj
cHVtYXNrX2NvcHkoJndxdi0+c2F2ZWRfYWZmaW5pdHksIGN1cnItPnNjaGVkX2l0ZW0tPmNwdV9o
YXJkX2FmZmluaXR5KTsKICAgICAgICAgaWYgKCB2Y3B1X3NldF9oYXJkX2FmZmluaXR5KGN1cnIs
IGNwdW1hc2tfb2Yod3F2LT53YWtldXBfY3B1KSkgKQogICAgICAgICB7CiAgICAgICAgICAgICBn
ZHByaW50ayhYRU5MT0dfRVJSLCAiVW5hYmxlIHRvIHNldCB2Y3B1IGFmZmluaXR5XG4iKTsKZGlm
ZiAtLWdpdCBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5oIGIveGVuL2luY2x1ZGUveGVuL3Nj
aGVkLWlmLmgKaW5kZXggMTdmMWVlODg4Ny4uNWUwMjRkY2ViMCAxMDA2NDQKLS0tIGEveGVuL2lu
Y2x1ZGUveGVuL3NjaGVkLWlmLmgKKysrIGIveGVuL2luY2x1ZGUveGVuL3NjaGVkLWlmLmgKQEAg
LTQ2MywxMSArNDYzLDExIEBAIHN0YXRpYyBpbmxpbmUgY3B1bWFza190KiBjcHVwb29sX2RvbWFp
bl9jcHVtYXNrKHN0cnVjdCBkb21haW4gKmQpCiAgKiAqIFRoZSBoYXJkIGFmZmluaXR5IGlzIG5v
dCBhIHN1YnNldCBvZiBzb2Z0IGFmZmluaXR5CiAgKiAqIFRoZXJlIGlzIGFuIG92ZXJsYXAgYmV0
d2VlbiB0aGUgc29mdCBhbmQgaGFyZCBhZmZpbml0eSBtYXNrcwogICovCi1zdGF0aWMgaW5saW5l
IGludCBoYXNfc29mdF9hZmZpbml0eShjb25zdCBzdHJ1Y3QgdmNwdSAqdikKK3N0YXRpYyBpbmxp
bmUgaW50IGhhc19zb2Z0X2FmZmluaXR5KGNvbnN0IHN0cnVjdCBzY2hlZF9pdGVtICppdGVtKQog
ewotICAgIHJldHVybiB2LT5zb2Z0X2FmZl9lZmZlY3RpdmUgJiYKLSAgICAgICAgICAgIWNwdW1h
c2tfc3Vic2V0KGNwdXBvb2xfZG9tYWluX2NwdW1hc2sodi0+ZG9tYWluKSwKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHYtPmNwdV9zb2Z0X2FmZmluaXR5KTsKKyAgICByZXR1cm4gaXRlbS0+
c29mdF9hZmZfZWZmZWN0aXZlICYmCisgICAgICAgICAgICFjcHVtYXNrX3N1YnNldChjcHVwb29s
X2RvbWFpbl9jcHVtYXNrKGl0ZW0tPnZjcHUtPmRvbWFpbiksCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICBpdGVtLT5jcHVfc29mdF9hZmZpbml0eSk7CiB9CiAKIC8qCkBAIC00NzcsMTcgKzQ3
NywxOCBAQCBzdGF0aWMgaW5saW5lIGludCBoYXNfc29mdF9hZmZpbml0eShjb25zdCBzdHJ1Y3Qg
dmNwdSAqdikKICAqIHRvIGF2b2lkIHJ1bm5pbmcgYSB2Y3B1IHdoZXJlIGl0IHdvdWxkIGxpa2Us
IGJ1dCBpcyBub3QgYWxsb3dlZCB0byEKICAqLwogc3RhdGljIGlubGluZSB2b2lkCi1hZmZpbml0
eV9iYWxhbmNlX2NwdW1hc2soY29uc3Qgc3RydWN0IHZjcHUgKnYsIGludCBzdGVwLCBjcHVtYXNr
X3QgKm1hc2spCithZmZpbml0eV9iYWxhbmNlX2NwdW1hc2soY29uc3Qgc3RydWN0IHNjaGVkX2l0
ZW0gKml0ZW0sIGludCBzdGVwLAorICAgICAgICAgICAgICAgICAgICAgICAgIGNwdW1hc2tfdCAq
bWFzaykKIHsKICAgICBpZiAoIHN0ZXAgPT0gQkFMQU5DRV9TT0ZUX0FGRklOSVRZICkKICAgICB7
Ci0gICAgICAgIGNwdW1hc2tfYW5kKG1hc2ssIHYtPmNwdV9zb2Z0X2FmZmluaXR5LCB2LT5jcHVf
aGFyZF9hZmZpbml0eSk7CisgICAgICAgIGNwdW1hc2tfYW5kKG1hc2ssIGl0ZW0tPmNwdV9zb2Z0
X2FmZmluaXR5LCBpdGVtLT5jcHVfaGFyZF9hZmZpbml0eSk7CiAKICAgICAgICAgaWYgKCB1bmxp
a2VseShjcHVtYXNrX2VtcHR5KG1hc2spKSApCi0gICAgICAgICAgICBjcHVtYXNrX2NvcHkobWFz
aywgdi0+Y3B1X2hhcmRfYWZmaW5pdHkpOworICAgICAgICAgICAgY3B1bWFza19jb3B5KG1hc2ss
IGl0ZW0tPmNwdV9oYXJkX2FmZmluaXR5KTsKICAgICB9CiAgICAgZWxzZSAvKiBzdGVwID09IEJB
TEFOQ0VfSEFSRF9BRkZJTklUWSAqLwotICAgICAgICBjcHVtYXNrX2NvcHkobWFzaywgdi0+Y3B1
X2hhcmRfYWZmaW5pdHkpOworICAgICAgICBjcHVtYXNrX2NvcHkobWFzaywgaXRlbS0+Y3B1X2hh
cmRfYWZmaW5pdHkpOwogfQogCiAjZW5kaWYgLyogX19YRU5fU0NIRURfSUZfSF9fICovCmRpZmYg
LS1naXQgYS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaCBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5o
CmluZGV4IGFhNGZmMjVmNzYuLmI0M2Y1ZjM2NjIgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL3hl
bi9zY2hlZC5oCisrKyBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCkBAIC0xNzUsOSArMTc1LDYg
QEAgc3RydWN0IHZjcHUKICAgICB9IHJ1bnN0YXRlX2d1ZXN0OyAvKiBndWVzdCBhZGRyZXNzICov
CiAjZW5kaWYKIAotICAgIC8qIGxhc3QgdGltZSB3aGVuIHZDUFUgaXMgc2NoZWR1bGVkIG91dCAq
LwotICAgIHVpbnQ2NF90IGxhc3RfcnVuX3RpbWU7Ci0KICAgICAvKiBIYXMgdGhlIEZQVSBiZWVu
IGluaXRpYWxpc2VkPyAqLwogICAgIGJvb2wgICAgICAgICAgICAgZnB1X2luaXRpYWxpc2VkOwog
ICAgIC8qIEhhcyB0aGUgRlBVIGJlZW4gdXNlZCBzaW5jZSBpdCB3YXMgbGFzdCBzYXZlZD8gKi8K
QEAgLTIwMyw4ICsyMDAsNiBAQCBzdHJ1Y3QgdmNwdQogICAgIGJvb2wgICAgICAgICAgICAgZGVm
ZXJfc2h1dGRvd247CiAgICAgLyogVkNQVSBpcyBwYXVzZWQgZm9sbG93aW5nIHNodXRkb3duIHJl
cXVlc3QgKGQtPmlzX3NodXR0aW5nX2Rvd24pPyAqLwogICAgIGJvb2wgICAgICAgICAgICAgcGF1
c2VkX2Zvcl9zaHV0ZG93bjsKLSAgICAvKiBWQ1BVIG5lZWQgYWZmaW5pdHkgcmVzdG9yZWQgKi8K
LSAgICBib29sICAgICAgICAgICAgIGFmZmluaXR5X2Jyb2tlbjsKIAogICAgIC8qIEEgaHlwZXJj
YWxsIGhhcyBiZWVuIHByZWVtcHRlZC4gKi8KICAgICBib29sICAgICAgICAgICAgIGhjYWxsX3By
ZWVtcHRlZDsKQEAgLTIxMyw5ICsyMDgsNiBAQCBzdHJ1Y3QgdmNwdQogICAgIGJvb2wgICAgICAg
ICAgICAgaGNhbGxfY29tcGF0OwogI2VuZGlmCiAKLSAgICAvKiBEb2VzIHNvZnQgYWZmaW5pdHkg
YWN0dWFsbHkgcGxheSBhIHJvbGUgKGdpdmVuIGhhcmQgYWZmaW5pdHkpPyAqLwotICAgIGJvb2wg
ICAgICAgICAgICAgc29mdF9hZmZfZWZmZWN0aXZlOwotCiAgICAgLyogVGhlIENQVSwgaWYgYW55
LCB3aGljaCBpcyBob2xkaW5nIG9udG8gdGhpcyBWQ1BVJ3Mgc3RhdGUuICovCiAjZGVmaW5lIFZD
UFVfQ1BVX0NMRUFOICh+MHUpCiAgICAgdW5zaWduZWQgaW50ICAgICBkaXJ0eV9jcHU7CkBAIC0y
NDcsMTYgKzIzOSw2IEBAIHN0cnVjdCB2Y3B1CiAgICAgZXZ0Y2huX3BvcnRfdCAgICB2aXJxX3Rv
X2V2dGNobltOUl9WSVJRU107CiAgICAgc3BpbmxvY2tfdCAgICAgICB2aXJxX2xvY2s7CiAKLSAg
ICAvKiBCaXRtYXNrIG9mIENQVXMgb24gd2hpY2ggdGhpcyBWQ1BVIG1heSBydW4uICovCi0gICAg
Y3B1bWFza192YXJfdCAgICBjcHVfaGFyZF9hZmZpbml0eTsKLSAgICAvKiBVc2VkIHRvIGNoYW5n
ZSBhZmZpbml0eSB0ZW1wb3JhcmlseS4gKi8KLSAgICBjcHVtYXNrX3Zhcl90ICAgIGNwdV9oYXJk
X2FmZmluaXR5X3RtcDsKLSAgICAvKiBVc2VkIHRvIHJlc3RvcmUgYWZmaW5pdHkgYWNyb3NzIFMz
LiAqLwotICAgIGNwdW1hc2tfdmFyX3QgICAgY3B1X2hhcmRfYWZmaW5pdHlfc2F2ZWQ7Ci0KLSAg
ICAvKiBCaXRtYXNrIG9mIENQVXMgb24gd2hpY2ggdGhpcyBWQ1BVIHByZWZlcnMgdG8gcnVuLiAq
LwotICAgIGNwdW1hc2tfdmFyX3QgICAgY3B1X3NvZnRfYWZmaW5pdHk7Ci0KICAgICAvKiBUYXNr
bGV0IGZvciBjb250aW51ZV9oeXBlcmNhbGxfb25fY3B1KCkuICovCiAgICAgc3RydWN0IHRhc2ts
ZXQgICBjb250aW51ZV9oeXBlcmNhbGxfdGFza2xldDsKIApAQCAtMjgzLDYgKzI2NSwyMiBAQCBz
dHJ1Y3Qgc2NoZWRfaXRlbSB7CiAgICAgdm9pZCAgICAgICAgICAgICAgICAgICpwcml2OyAgICAg
IC8qIHNjaGVkdWxlciBwcml2YXRlIGRhdGEgKi8KICAgICBzdHJ1Y3Qgc2NoZWRfaXRlbSAgICAg
Km5leHRfaW5fbGlzdDsKICAgICBzdHJ1Y3Qgc2NoZWRfcmVzb3VyY2UgKnJlczsKKworICAgIC8q
IExhc3QgdGltZSB3aGVuIGl0ZW0gaGFzIGJlZW4gc2NoZWR1bGVkIG91dC4gKi8KKyAgICB1aW50
NjRfdCAgICAgICAgICAgICAgIGxhc3RfcnVuX3RpbWU7CisKKyAgICAvKiBJdGVtIG5lZWRzIGFm
ZmluaXR5IHJlc3RvcmVkLiAqLworICAgIGJvb2wgICAgICAgICAgICAgICAgICAgYWZmaW5pdHlf
YnJva2VuOworICAgIC8qIERvZXMgc29mdCBhZmZpbml0eSBhY3R1YWxseSBwbGF5IGEgcm9sZSAo
Z2l2ZW4gaGFyZCBhZmZpbml0eSk/ICovCisgICAgYm9vbCAgICAgICAgICAgICAgICAgICBzb2Z0
X2FmZl9lZmZlY3RpdmU7CisgICAgLyogQml0bWFzayBvZiBDUFVzIG9uIHdoaWNoIHRoaXMgVkNQ
VSBtYXkgcnVuLiAqLworICAgIGNwdW1hc2tfdmFyX3QgICAgICAgICAgY3B1X2hhcmRfYWZmaW5p
dHk7CisgICAgLyogVXNlZCB0byBjaGFuZ2UgYWZmaW5pdHkgdGVtcG9yYXJpbHkuICovCisgICAg
Y3B1bWFza192YXJfdCAgICAgICAgICBjcHVfaGFyZF9hZmZpbml0eV90bXA7CisgICAgLyogVXNl
ZCB0byByZXN0b3JlIGFmZmluaXR5IGFjcm9zcyBTMy4gKi8KKyAgICBjcHVtYXNrX3Zhcl90ICAg
ICAgICAgIGNwdV9oYXJkX2FmZmluaXR5X3NhdmVkOworICAgIC8qIEJpdG1hc2sgb2YgQ1BVcyBv
biB3aGljaCB0aGlzIFZDUFUgcHJlZmVycyB0byBydW4uICovCisgICAgY3B1bWFza192YXJfdCAg
ICAgICAgICBjcHVfc29mdF9hZmZpbml0eTsKIH07CiAKICNkZWZpbmUgZm9yX2VhY2hfc2NoZWRf
aXRlbShkLCBlKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXApAQCAt
OTgyLDcgKzk4MCw3IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBpc19odm1fdmNwdShjb25zdCBzdHJ1
Y3QgdmNwdSAqdikKIHN0YXRpYyBpbmxpbmUgYm9vbCBpc19od2RvbV9waW5uZWRfdmNwdShjb25z
dCBzdHJ1Y3QgdmNwdSAqdikKIHsKICAgICByZXR1cm4gKGlzX2hhcmR3YXJlX2RvbWFpbih2LT5k
b21haW4pICYmCi0gICAgICAgICAgICBjcHVtYXNrX3dlaWdodCh2LT5jcHVfaGFyZF9hZmZpbml0
eSkgPT0gMSk7CisgICAgICAgICAgICBjcHVtYXNrX3dlaWdodCh2LT5zY2hlZF9pdGVtLT5jcHVf
aGFyZF9hZmZpbml0eSkgPT0gMSk7CiB9CiAKICNpZmRlZiBDT05GSUdfSEFTX1BBU1NUSFJPVUdI
Ci0tIAoyLjE2LjQKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9y
ZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

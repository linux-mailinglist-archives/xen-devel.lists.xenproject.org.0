Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id A78B2BFFAA
	for <lists+xen-devel@lfdr.de>; Fri, 27 Sep 2019 09:05:03 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iDkFk-0003H1-5d; Fri, 27 Sep 2019 07:01:20 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=Rbpq=XW=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1iDkFh-0003FC-Pq
 for xen-devel@lists.xenproject.org; Fri, 27 Sep 2019 07:01:17 +0000
X-Inumbo-ID: 8fcccac2-e0f4-11e9-bf31-bc764e2007e4
Received: from mx1.suse.de (unknown [195.135.220.15])
 by localhost (Halon) with ESMTPS
 id 8fcccac2-e0f4-11e9-bf31-bc764e2007e4;
 Fri, 27 Sep 2019 07:01:00 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 93BD0AFF6;
 Fri, 27 Sep 2019 07:00:57 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Fri, 27 Sep 2019 09:00:14 +0200
Message-Id: <20190927070050.12405-11-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190927070050.12405-1-jgross@suse.com>
References: <20190927070050.12405-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v4 10/46] xen/sched: add scheduler helpers
 hiding vcpu
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Tim Deegan <tim@xen.org>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Dario Faggioli <dfaggioli@suse.com>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

QWRkIHRoZSBmb2xsb3dpbmcgaGVscGVycyB1c2luZyBhIHNjaGVkX3VuaXQgYXMgaW5wdXQgaW5z
dGVhZCBvZiBhCnZjcHU6CgotIGlzX2lkbGVfdW5pdCgpIHNpbWlsYXIgdG8gaXNfaWRsZV92Y3B1
KCkKLSBpc191bml0X29ubGluZSgpIHNpbWlsYXIgdG8gaXNfdmNwdV9vbmxpbmUoKSAocmV0dXJu
cyB0cnVlIHdoZW4gYW55CiAgb2YgaXRzIHZjcHVzIGlzIG9ubGluZSkKLSB1bml0X3J1bm5hYmxl
KCkgbGlrZSB2Y3B1X3J1bm5hYmxlKCkgKHJldHVybnMgdHJ1ZSBpZiBhbnkgb2YgaXRzCiAgdmNw
dXMgaXMgcnVubmFibGUpCi0gc2NoZWRfc2V0X3JlcygpIHRvIHNldCB0aGUgY3VycmVudCBzY2hl
ZHVsaW5nIHJlc291cmNlIG9mIGEgdW5pdAotIHNjaGVkX3VuaXRfY3B1KCkgdG8gZ2V0IHRoZSBj
dXJyZW50IHByb2Nlc3NvciBvZiBhIHVuaXQgKHJldHVybnMKICB0aGUgbWFzdGVyX2NwdSBvZiB0
aGUgc2NoZWR1bGluZyByZXNvdXJjZSBvZiBhIHVuaXQpCi0gc2NoZWRfe3NldHxjbGVhcn1fcGF1
c2VfZmxhZ3NbX2F0b21pY10oKSB0byBtb2RpZnkgcGF1c2VfZmxhZ3Mgb2YgdGhlCiAgYXNzb2Np
YXRlZCB2Y3B1KHMpIChtb2RpZmllcyB0aGUgcGF1c2VfZmxhZ3Mgb2YgYWxsIHZjcHVzIG9mIHRo
ZQogIHVuaXQpCi0gc2NoZWRfaWRsZV91bml0KCkgdG8gZ2V0IHRoZSBzY2hlZF91bml0IHBvaW50
ZXIgb2YgdGhlIGlkbGUgdmNwdSBvZiBhCiAgc3BlY2lmaWMgcGh5c2ljYWwgY3B1CgpTaWduZWQt
b2ZmLWJ5OiBKdWVyZ2VuIEdyb3NzIDxqZ3Jvc3NAc3VzZS5jb20+Ci0tLQpWMzoKLSBtYWtlIHVu
aXQgcGFyYW1ldGVyIG9mIHNjaGVkX3VuaXRfY3B1KCkgY29uc3QKVjQ6Ci0gbG9vcCBvdmVyIHZj
cHVzIGluIGhlbHBlcnMgd2hlcmUgYXBwcm9wcmlhdGUgKEphbiBCZXVsaWNoKQotIGFkZCBzb21l
IGNvbW1lbnRzIHJlZ2FyZGluZyBzZW1hbnRpY3MgKEphbiBCZXVsaWNoKQotIHJlbmFtZSBzY2hl
ZF91bml0X2NwdSgpIHRvIHNjaGVkX3VuaXRfbWFzdGVyKCkgKEphbiBCZXVsaWNoKQotLS0KIHhl
bi9jb21tb24vc2NoZWRfY3JlZGl0LmMgIHwgIDMgKy0KIHhlbi9jb21tb24vc2NoZWR1bGUuYyAg
ICAgIHwgMjEgKysrKystLS0tLS0KIHhlbi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5oIHwgOTIgKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKystLQogMyBmaWxlcyBjaGFu
Z2VkLCA5OSBpbnNlcnRpb25zKCspLCAxNyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS94ZW4v
Y29tbW9uL3NjaGVkX2NyZWRpdC5jIGIveGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQuYwppbmRleCBj
YjdiOWM1ZDkxLi41NmU0N2Q1ZTU0IDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL3NjaGVkX2NyZWRp
dC5jCisrKyBiL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0LmMKQEAgLTE2NjAsOCArMTY2MCw3IEBA
IGNzY2hlZF9ydW5xX3N0ZWFsKGludCBwZWVyX2NwdSwgaW50IGNwdSwgaW50IHByaSwgaW50IGJh
bGFuY2Vfc3RlcCkKICAgICAgICAgICAgIFNDSEVEX1NUQVRfQ1JBTksobWlncmF0ZV9xdWV1ZWQp
OwogICAgICAgICAgICAgV0FSTl9PTih2Yy0+aXNfdXJnZW50KTsKICAgICAgICAgICAgIHJ1bnFf
cmVtb3ZlKHNwZWVyKTsKLSAgICAgICAgICAgIHZjLT5wcm9jZXNzb3IgPSBjcHU7Ci0gICAgICAg
ICAgICB2Yy0+c2NoZWRfdW5pdC0+cmVzID0gZ2V0X3NjaGVkX3JlcyhjcHUpOworICAgICAgICAg
ICAgc2NoZWRfc2V0X3Jlcyh2Yy0+c2NoZWRfdW5pdCwgZ2V0X3NjaGVkX3JlcyhjcHUpKTsKICAg
ICAgICAgICAgIC8qCiAgICAgICAgICAgICAgKiBzcGVlciB3aWxsIHN0YXJ0IGV4ZWN1dGluZyBk
aXJlY3RseSBvbiBjcHUsIHdpdGhvdXQgaGF2aW5nIHRvCiAgICAgICAgICAgICAgKiBnbyB0aHJv
dWdoIHJ1bnFfaW5zZXJ0KCkuIFNvIHdlIG11c3QgdXBkYXRlIHRoZSBydW5uYWJsZSBjb3VudApk
aWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZHVsZS5jIGIveGVuL2NvbW1vbi9zY2hlZHVsZS5j
CmluZGV4IDc0N2RmYzBlYWIuLjZkMjdjMmY0YTUgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2No
ZWR1bGUuYworKysgYi94ZW4vY29tbW9uL3NjaGVkdWxlLmMKQEAgLTg0LDcgKzg0LDcgQEAgc3Rh
dGljIHNwaW5sb2NrX3QgKgogc2NoZWRfaWRsZV9zd2l0Y2hfc2NoZWQoc3RydWN0IHNjaGVkdWxl
ciAqbmV3X29wcywgdW5zaWduZWQgaW50IGNwdSwKICAgICAgICAgICAgICAgICAgICAgICAgIHZv
aWQgKnBkYXRhLCB2b2lkICp2ZGF0YSkKIHsKLSAgICBpZGxlX3ZjcHVbY3B1XS0+c2NoZWRfdW5p
dC0+cHJpdiA9IE5VTEw7CisgICAgc2NoZWRfaWRsZV91bml0KGNwdSktPnByaXYgPSBOVUxMOwog
CiAgICAgcmV0dXJuICZzY2hlZF9mcmVlX2NwdV9sb2NrOwogfQpAQCAtMzc3LDEyICszNzcsMTEg
QEAgaW50IHNjaGVkX2luaXRfdmNwdShzdHJ1Y3QgdmNwdSAqdiwgdW5zaWduZWQgaW50IHByb2Nl
c3NvcikKICAgICBzdHJ1Y3QgZG9tYWluICpkID0gdi0+ZG9tYWluOwogICAgIHN0cnVjdCBzY2hl
ZF91bml0ICp1bml0OwogCi0gICAgdi0+cHJvY2Vzc29yID0gcHJvY2Vzc29yOwotCiAgICAgaWYg
KCAodW5pdCA9IHNjaGVkX2FsbG9jX3VuaXQodikpID09IE5VTEwgKQogICAgICAgICByZXR1cm4g
MTsKIAotICAgIHVuaXQtPnJlcyA9IGdldF9zY2hlZF9yZXMocHJvY2Vzc29yKTsKKyAgICBzY2hl
ZF9zZXRfcmVzKHVuaXQsIGdldF9zY2hlZF9yZXMocHJvY2Vzc29yKSk7CisKICAgICAvKiBJbml0
aWFsaXNlIHRoZSBwZXItdmNwdSB0aW1lcnMuICovCiAgICAgc3Bpbl9sb2NrX2luaXQoJnYtPnBl
cmlvZGljX3RpbWVyX2xvY2spOwogICAgIGluaXRfdGltZXIoJnYtPnBlcmlvZGljX3RpbWVyLCB2
Y3B1X3BlcmlvZGljX3RpbWVyX2ZuLApAQCAtNDk3LDggKzQ5Niw3IEBAIGludCBzY2hlZF9tb3Zl
X2RvbWFpbihzdHJ1Y3QgZG9tYWluICpkLCBzdHJ1Y3QgY3B1cG9vbCAqYykKIAogICAgICAgICBz
Y2hlZF9zZXRfYWZmaW5pdHkodiwgJmNwdW1hc2tfYWxsLCAmY3B1bWFza19hbGwpOwogCi0gICAg
ICAgIHYtPnByb2Nlc3NvciA9IG5ld19wOwotICAgICAgICB2LT5zY2hlZF91bml0LT5yZXMgPSBn
ZXRfc2NoZWRfcmVzKG5ld19wKTsKKyAgICAgICAgc2NoZWRfc2V0X3Jlcyh2LT5zY2hlZF91bml0
LCBnZXRfc2NoZWRfcmVzKG5ld19wKSk7CiAgICAgICAgIC8qCiAgICAgICAgICAqIFdpdGggdi0+
cHJvY2Vzc29yIG1vZGlmaWVkIHdlIG11c3Qgbm90CiAgICAgICAgICAqIC0gbWFrZSBhbnkgZnVy
dGhlciBjaGFuZ2VzIGFzc3VtaW5nIHdlIGhvbGQgdGhlIHNjaGVkdWxlciBsb2NrLApAQCAtODE4
LDggKzgxNiw5IEBAIHZvaWQgcmVzdG9yZV92Y3B1X2FmZmluaXR5KHN0cnVjdCBkb21haW4gKmQp
CiAgICAgICAgIHNwaW5sb2NrX3QgKmxvY2s7CiAgICAgICAgIHVuc2lnbmVkIGludCBvbGRfY3B1
ID0gdi0+cHJvY2Vzc29yOwogICAgICAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCA9IHYtPnNj
aGVkX3VuaXQ7CisgICAgICAgIHN0cnVjdCBzY2hlZF9yZXNvdXJjZSAqcmVzOwogCi0gICAgICAg
IEFTU0VSVCghdmNwdV9ydW5uYWJsZSh2KSk7CisgICAgICAgIEFTU0VSVCghdW5pdF9ydW5uYWJs
ZSh1bml0KSk7CiAKICAgICAgICAgLyoKICAgICAgICAgICogUmUtYXNzaWduIHRoZSBpbml0aWFs
IHByb2Nlc3NvciBhcyBhZnRlciByZXN1bWUgd2UgaGF2ZSBubwpAQCAtODUyLDE1ICs4NTEsMTUg
QEAgdm9pZCByZXN0b3JlX3ZjcHVfYWZmaW5pdHkoc3RydWN0IGRvbWFpbiAqZCkKICAgICAgICAg
ICAgIH0KICAgICAgICAgfQogCi0gICAgICAgIHYtPnByb2Nlc3NvciA9IGNwdW1hc2tfYW55KGNw
dW1hc2tfc2NyYXRjaF9jcHUoY3B1KSk7Ci0gICAgICAgIHVuaXQtPnJlcyA9IGdldF9zY2hlZF9y
ZXModi0+cHJvY2Vzc29yKTsKKyAgICAgICAgcmVzID0gZ2V0X3NjaGVkX3JlcyhjcHVtYXNrX2Fu
eShjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSkpKTsKKyAgICAgICAgc2NoZWRfc2V0X3Jlcyh1bml0
LCByZXMpOwogCiAgICAgICAgIHNwaW5fdW5sb2NrX2lycShsb2NrKTsKIAogICAgICAgICAvKiB2
LT5wcm9jZXNzb3IgbWlnaHQgaGF2ZSBjaGFuZ2VkLCBzbyByZWFjcXVpcmUgdGhlIGxvY2suICov
CiAgICAgICAgIGxvY2sgPSB1bml0X3NjaGVkdWxlX2xvY2tfaXJxKHVuaXQpOwotICAgICAgICB1
bml0LT5yZXMgPSBzY2hlZF9waWNrX3Jlc291cmNlKHZjcHVfc2NoZWR1bGVyKHYpLCB1bml0KTsK
LSAgICAgICAgdi0+cHJvY2Vzc29yID0gdW5pdC0+cmVzLT5tYXN0ZXJfY3B1OworICAgICAgICBy
ZXMgPSBzY2hlZF9waWNrX3Jlc291cmNlKHZjcHVfc2NoZWR1bGVyKHYpLCB1bml0KTsKKyAgICAg
ICAgc2NoZWRfc2V0X3Jlcyh1bml0LCByZXMpOwogICAgICAgICBzcGluX3VubG9ja19pcnEobG9j
ayk7CiAKICAgICAgICAgaWYgKCBvbGRfY3B1ICE9IHYtPnByb2Nlc3NvciApCmRpZmYgLS1naXQg
YS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQtaWYuaCBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5o
CmluZGV4IDZlNWQ4MTNkNmMuLjA1ODdhOGQzZDIgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL3hl
bi9zY2hlZC1pZi5oCisrKyBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5oCkBAIC02Myw2ICs2
Myw5MyBAQCBzdGF0aWMgaW5saW5lIHN0cnVjdCBzY2hlZF91bml0ICpjdXJyX29uX2NwdSh1bnNp
Z25lZCBpbnQgY3B1KQogICAgIHJldHVybiBnZXRfc2NoZWRfcmVzKGNwdSktPmN1cnI7CiB9CiAK
K3N0YXRpYyBpbmxpbmUgYm9vbCBpc19pZGxlX3VuaXQoY29uc3Qgc3RydWN0IHNjaGVkX3VuaXQg
KnVuaXQpCit7CisgICAgcmV0dXJuIGlzX2lkbGVfdmNwdSh1bml0LT52Y3B1X2xpc3QpOworfQor
CisvKiBSZXR1cm5zIHRydWUgaWYgYXQgbGVhc3Qgb25lIHZjcHUgb2YgdGhlIHVuaXQgaXMgb25s
aW5lLiAqLworc3RhdGljIGlubGluZSBib29sIGlzX3VuaXRfb25saW5lKGNvbnN0IHN0cnVjdCBz
Y2hlZF91bml0ICp1bml0KQoreworICAgIGNvbnN0IHN0cnVjdCB2Y3B1ICp2OworCisgICAgZm9y
X2VhY2hfc2NoZWRfdW5pdF92Y3B1ICggdW5pdCwgdiApCisgICAgICAgIGlmICggaXNfdmNwdV9v
bmxpbmUodikgKQorICAgICAgICAgICAgcmV0dXJuIHRydWU7CisKKyAgICByZXR1cm4gZmFsc2U7
Cit9CisKKy8qIFJldHVybnMgdHJ1ZSBpZiBhdCBsZWFzdCBvbmUgdmNwdSBvZiB0aGUgdW5pdCBp
cyBydW5uYWJsZS4gKi8KK3N0YXRpYyBpbmxpbmUgYm9vbCB1bml0X3J1bm5hYmxlKGNvbnN0IHN0
cnVjdCBzY2hlZF91bml0ICp1bml0KQoreworICAgIGNvbnN0IHN0cnVjdCB2Y3B1ICp2OworCisg
ICAgZm9yX2VhY2hfc2NoZWRfdW5pdF92Y3B1ICggdW5pdCwgdiApCisgICAgICAgIGlmICggdmNw
dV9ydW5uYWJsZSh2KSApCisgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKKworICAgIHJldHVybiBm
YWxzZTsKK30KKworc3RhdGljIGlubGluZSB2b2lkIHNjaGVkX3NldF9yZXMoc3RydWN0IHNjaGVk
X3VuaXQgKnVuaXQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3Qgc2No
ZWRfcmVzb3VyY2UgKnJlcykKK3sKKyAgICB1bml0LT52Y3B1X2xpc3QtPnByb2Nlc3NvciA9IHJl
cy0+bWFzdGVyX2NwdTsKKyAgICB1bml0LT5yZXMgPSByZXM7Cit9CisKKy8qIFJldHVybiBtYXN0
ZXIgY3B1IG9mIHRoZSBzY2hlZHVsaW5nIHJlc291cmNlIHRoZSB1bml0IGlzIGFzc2lnbmVkIHRv
LiAqLworc3RhdGljIGlubGluZSB1bnNpZ25lZCBpbnQgc2NoZWRfdW5pdF9tYXN0ZXIoY29uc3Qg
c3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCit7CisgICAgcmV0dXJuIHVuaXQtPnJlcy0+bWFzdGVy
X2NwdTsKK30KKworLyogU2V0IGEgYml0IGluIHBhdXNlX2ZsYWdzIG9mIGFsbCB2Y3B1cyBvZiBh
IHVuaXQuICovCitzdGF0aWMgaW5saW5lIHZvaWQgc2NoZWRfc2V0X3BhdXNlX2ZsYWdzKHN0cnVj
dCBzY2hlZF91bml0ICp1bml0LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICB1bnNpZ25lZCBpbnQgYml0KQoreworICAgIHN0cnVjdCB2Y3B1ICp2OworCisgICAgZm9y
X2VhY2hfc2NoZWRfdW5pdF92Y3B1ICggdW5pdCwgdiApCisgICAgICAgIF9fc2V0X2JpdChiaXQs
ICZ2LT5wYXVzZV9mbGFncyk7Cit9CisKKy8qIENsZWFyIGEgYml0IGluIHBhdXNlX2ZsYWdzIG9m
IGFsbCB2Y3B1cyBvZiBhIHVuaXQuICovCitzdGF0aWMgaW5saW5lIHZvaWQgc2NoZWRfY2xlYXJf
cGF1c2VfZmxhZ3Moc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IGJpdCkKK3sKKyAgICBzdHJ1Y3Qg
dmNwdSAqdjsKKworICAgIGZvcl9lYWNoX3NjaGVkX3VuaXRfdmNwdSAoIHVuaXQsIHYgKQorICAg
ICAgICBfX2NsZWFyX2JpdChiaXQsICZ2LT5wYXVzZV9mbGFncyk7Cit9CisKKy8qIFNldCBhIGJp
dCBpbiBwYXVzZV9mbGFncyBvZiBhbGwgdmNwdXMgb2YgYSB1bml0IHZpYSBhdG9taWMgdXBkYXRl
cy4gKi8KK3N0YXRpYyBpbmxpbmUgdm9pZCBzY2hlZF9zZXRfcGF1c2VfZmxhZ3NfYXRvbWljKHN0
cnVjdCBzY2hlZF91bml0ICp1bml0LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IGJpdCkKK3sKKyAgICBzdHJ1Y3QgdmNwdSAqdjsK
KworICAgIGZvcl9lYWNoX3NjaGVkX3VuaXRfdmNwdSAoIHVuaXQsIHYgKQorICAgICAgICBzZXRf
Yml0KGJpdCwgJnYtPnBhdXNlX2ZsYWdzKTsKK30KKworLyogQ2xlYXIgYSBiaXQgaW4gcGF1c2Vf
ZmxhZ3Mgb2YgYWxsIHZjcHVzIG9mIGEgdW5pdCB2aWEgYXRvbWljIHVwZGF0ZXMuICovCitzdGF0
aWMgaW5saW5lIHZvaWQgc2NoZWRfY2xlYXJfcGF1c2VfZmxhZ3NfYXRvbWljKHN0cnVjdCBzY2hl
ZF91bml0ICp1bml0LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICB1bnNpZ25lZCBpbnQgYml0KQoreworICAgIHN0cnVjdCB2Y3B1ICp2OworCisgICAg
Zm9yX2VhY2hfc2NoZWRfdW5pdF92Y3B1ICggdW5pdCwgdiApCisgICAgICAgIGNsZWFyX2JpdChi
aXQsICZ2LT5wYXVzZV9mbGFncyk7Cit9CisKK3N0YXRpYyBpbmxpbmUgc3RydWN0IHNjaGVkX3Vu
aXQgKnNjaGVkX2lkbGVfdW5pdCh1bnNpZ25lZCBpbnQgY3B1KQoreworICAgIHJldHVybiBpZGxl
X3ZjcHVbY3B1XS0+c2NoZWRfdW5pdDsKK30KKwogLyoKICAqIFNjcmF0Y2ggc3BhY2UsIGZvciBh
dm9pZGluZyBoYXZpbmcgdG9vIG1hbnkgY3B1bWFza190IG9uIHRoZSBzdGFjay4KICAqIFdpdGhp
biBlYWNoIHNjaGVkdWxlciwgd2hlbiB1c2luZyB0aGUgc2NyYXRjaCBtYXNrIG9mIG9uZSBwQ1BV
OgpAQCAtMzQ5LDEwICs0MzYsNyBAQCBzdGF0aWMgaW5saW5lIHZvaWQgc2NoZWRfbWlncmF0ZShj
b25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpzLAogICAgIGlmICggcy0+bWlncmF0ZSApCiAgICAgICAg
IHMtPm1pZ3JhdGUocywgdW5pdCwgY3B1KTsKICAgICBlbHNlCi0gICAgewotICAgICAgICB1bml0
LT52Y3B1X2xpc3QtPnByb2Nlc3NvciA9IGNwdTsKLSAgICAgICAgdW5pdC0+cmVzID0gZ2V0X3Nj
aGVkX3JlcyhjcHUpOwotICAgIH0KKyAgICAgICAgc2NoZWRfc2V0X3Jlcyh1bml0LCBnZXRfc2No
ZWRfcmVzKGNwdSkpOwogfQogCiBzdGF0aWMgaW5saW5lIHN0cnVjdCBzY2hlZF9yZXNvdXJjZSAq
c2NoZWRfcGlja19yZXNvdXJjZSgKLS0gCjIuMTYuNAoKCl9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVs
QGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1h
bi9saXN0aW5mby94ZW4tZGV2ZWw=

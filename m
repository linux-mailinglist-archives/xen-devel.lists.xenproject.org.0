Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id BC7281773DA
	for <lists+xen-devel@lfdr.de>; Tue,  3 Mar 2020 11:19:30 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1j94c9-0000nr-6S; Tue, 03 Mar 2020 10:17:25 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=TLdZ=4U=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1j94c7-0000nh-4P
 for xen-devel@lists.xenproject.org; Tue, 03 Mar 2020 10:17:23 +0000
X-Inumbo-ID: 2b35a06e-5d38-11ea-a0dd-12813bfff9fa
Received: from mx2.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 2b35a06e-5d38-11ea-a0dd-12813bfff9fa;
 Tue, 03 Mar 2020 10:17:21 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx2.suse.de (Postfix) with ESMTP id A2B0AACB8;
 Tue,  3 Mar 2020 10:17:20 +0000 (UTC)
From: Jan Beulich <jbeulich@suse.com>
To: "xen-devel@lists.xenproject.org" <xen-devel@lists.xenproject.org>
References: <1e1ccd2a-526c-631b-7889-35f993b2005e@suse.com>
Message-ID: <b9aa8053-b35b-1d0f-8303-abc39e1ae17d@suse.com>
Date: Tue, 3 Mar 2020 11:17:20 +0100
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:68.0) Gecko/20100101
 Thunderbird/68.5.0
MIME-Version: 1.0
In-Reply-To: <1e1ccd2a-526c-631b-7889-35f993b2005e@suse.com>
Content-Language: en-US
Subject: [Xen-devel] [PATCH v5 2/4] x86/HVM: implement memory read caching
 for insn emulation
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Kevin Tian <kevin.tian@intel.com>, Wei Liu <wl@xen.org>,
 Paul Durrant <paul@xen.org>, Andrew Cooper <andrew.cooper3@citrix.com>,
 Jun Nakajima <jun.nakajima@intel.com>,
 =?UTF-8?Q?Roger_Pau_Monn=c3=a9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

RW11bGF0aW9uIHJlcXVpcmluZyBkZXZpY2UgbW9kZWwgYXNzaXN0YW5jZSB1c2VzIGEgZm9ybSBv
ZiBpbnN0cnVjdGlvbgpyZS1leGVjdXRpb24sIGFzc3VtaW5nIHRoYXQgdGhlIHNlY29uZCAoYW5k
IGFueSBmdXJ0aGVyKSBwYXNzIHRha2VzCmV4YWN0bHkgdGhlIHNhbWUgcGF0aC4gVGhpcyBpcyBh
IHZhbGlkIGFzc3VtcHRpb24gYXMgZmFyIGFzIHVzZSBvZiBDUFUKcmVnaXN0ZXJzIGdvZXMgKGFz
IHRob3NlIGNhbid0IGNoYW5nZSB3aXRob3V0IGFueSBvdGhlciBpbnN0cnVjdGlvbgpleGVjdXRp
bmcgaW4gYmV0d2VlbiBbMV0pLCBidXQgaXMgd3JvbmcgZm9yIG1lbW9yeSBhY2Nlc3Nlcy4gSW4K
cGFydGljdWxhciBpdCBoYXMgYmVlbiBvYnNlcnZlZCB0aGF0IFdpbmRvd3MgbWlnaHQgcGFnZSBv
dXQgYnVmZmVycwp1bmRlcm5lYXRoIGFuIGluc3RydWN0aW9uIGN1cnJlbnRseSB1bmRlciBlbXVs
YXRpb24gKGhpdHRpbmcgYmV0d2VlbiB0d28KcGFzc2VzKS4gSWYgdGhlIGZpcnN0IHBhc3MgcmVh
ZCBhIG1lbW9yeSBvcGVyYW5kIHN1Y2Nlc3NmdWxseSwgYW55CnN1YnNlcXVlbnQgcGFzcyBuZWVk
cyB0byBnZXQgdG8gc2VlIHRoZSBleGFjdCBzYW1lIHZhbHVlLgoKSW50cm9kdWNlIGEgY2FjaGUg
dG8gbWFrZSBzdXJlIGFib3ZlIGRlc2NyaWJlZCBhc3N1bXB0aW9uIGhvbGRzLiBUaGlzCmlzIGEg
dmVyeSBzaW1wbGlzdGljIGltcGxlbWVudGF0aW9uIGZvciBub3c6IE9ubHkgZXhhY3QgbWF0Y2hl
cyBhcmUKc2F0aXNmaWVkIChubyBvdmVybGFwcyBvciBwYXJ0aWFsIHJlYWRzIG9yIGFueXRoaW5n
KTsgdGhpcyBpcyBzdWZmaWNpZW50CmZvciB0aGUgaW1tZWRpYXRlIHB1cnBvc2Ugb2YgbWFraW5n
IHJlLWV4ZWN1dGlvbiBhbiBleGFjdCByZXBsYXkuIFRoZQpjYWNoZSBhbHNvIHdvbid0IGJlIHVz
ZWQganVzdCB5ZXQgZm9yIGd1ZXN0IHBhZ2Ugd2Fsa3M7IHRoYXQnbGwgYmUgdGhlCnN1YmplY3Qg
b2YgYSBzdWJzZXF1ZW50IGNoYW5nZS4KCldpdGggdGhlIGNhY2hlIGJlaW5nIGdlbmVyYWxseSB0
cmFuc3BhcmVudCB0byB1cHBlciBsYXllcnMsIGJ1dCB3aXRoIGl0CmhhdmluZyBsaW1pdGVkIGNh
cGFjaXR5IHlldCBiZWluZyByZXF1aXJlZCBmb3IgY29ycmVjdG5lc3MsIGNlcnRhaW4KdXNlcnMg
b2YgaHZtX2NvcHlfZnJvbV9ndWVzdF8qKCkgbmVlZCB0byBkaXNhYmxlIGNhY2hpbmcgdGVtcG9y
YXJpbHksCndpdGhvdXQgaW52YWxpZGF0aW5nIHRoZSBjYWNoZS4gTm90ZSB0aGF0IHRoZSBhZGp1
c3RtZW50cyBoZXJlIHRvCmh2bV9oeXBlcmNhbGwoKSBhbmQgaHZtX3Rhc2tfc3dpdGNoKCkgYXJl
IGJlbmlnbiBhdCB0aGlzIHBvaW50OyB0aGV5J2xsCmJlY29tZSByZWxldmFudCBvbmNlIHdlIHN0
YXJ0IHRvIGJlIGFibGUgdG8gZW11bGF0ZSByZXNwZWN0aXZlIGluc25zCnRocm91Z2ggdGhlIG1h
aW4gZW11bGF0b3IgKGFuZCBtb3JlIGNoYW5nZXMgd2lsbCB0aGVuIGxpa2VseSBiZSBuZWVkZWQK
dG8gbmVzdGVkIGNvZGUpLgoKQXMgdG8gdGhlIGFjdHVhbCBkYXRhIHBhZ2UgaW4gYSBwcm9ibGFt
dGljIHNjZW5hcmlvLCB0aGVyZSBhcmUgYSBjb3VwbGUKb2YgYXNwZWN0cyB0byB0YWtlIGludG8g
Y29uc2lkZXJhdGlvbjoKLSBXZSBtdXN0IGJlIHRhbGtpbmcgYWJvdXQgYW4gaW5zbiBhY2Nlc3Np
bmcgdHdvIGxvY2F0aW9ucyAodHdvIG1lbW9yeQogIG9uZXMsIG9uZSBvZiB3aGljaCBpcyBNTUlP
LCBvciBhIG1lbW9yeSBhbmQgYW4gSS9PIG9uZSkuCi0gSWYgdGhlIG5vbiBJL08gLyBNTUlPIHNp
ZGUgaXMgYmVpbmcgcmVhZCwgdGhlIHJlLXJlYWQgKGlmIGl0IG9jY3VycyBhdAogIGFsbCkgaXMg
aGF2aW5nIGl0cyByZXN1bHQgZGlzY2FyZGVkLCBieSB0YWtpbmcgdGhlIHNob3J0Y3V0IHRocm91
Z2gKICB0aGUgZmlyc3Qgc3dpdGNoKCkncyBTVEFURV9JT1JFU1BfUkVBRFkgY2FzZSBpbiBodm1l
bXVsX2RvX2lvKCkuIE5vdGUKICBob3csIGFtb25nIGFsbCB0aGUgcmUtaXNzdWUgc2FuaXR5IGNo
ZWNrcyB0aGVyZSwgd2UgYXZvaWQgY29tcGFyaW5nCiAgdGhlIGFjdHVhbCBkYXRhLgotIElmIHRo
ZSBub24gSS9PIC8gTU1JTyBzaWRlIGlzIGJlaW5nIHdyaXR0ZW4sIGl0IGlzIHRoZSBPU2VzCiAg
cmVzcG9uc2liaWxpdHkgdG8gYXZvaWQgYWN0dWFsbHkgbW92aW5nIHBhZ2UgY29udGVudHMgdG8g
ZGlzayB3aGlsZQogIHRoZXJlIG1pZ2h0IHN0aWxsIGJlIGEgd3JpdGUgYWNjZXNzIGluIGZsaWdo
dCAtIHRoaXMgaXMgbm8gZGlmZmVyZW50CiAgaW4gYmVoYXZpb3IgZnJvbSBiYXJlIGhhcmR3YXJl
LgotIFJlYWQtbW9kaWZ5LXdyaXRlIGFjY2Vzc2VzIGFyZSwgYXMgYWx3YXlzLCBjb21wbGljYXRl
ZCwgYW5kIHdoaWxlIHdlCiAgZGVhbCB3aXRoIHRoZW0gYmV0dGVyIG5vd2FkYXlzIHRoYW4gd2Ug
ZGlkIGluIHRoZSBwYXN0LCB3ZSdyZSBzdGlsbAogIG5vdCBxdWl0ZSB0aGVyZSB0byBndWFyYW50
ZWUgaGFyZHdhcmUgbGlrZSBiZWhhdmlvciBpbiBhbGwgY2FzZXMKICBhbnl3YXkuIE5vdGhpbmcg
aXMgZ2V0dGluZyB3b3JzZSBieSB0aGUgY2hhbmdlcyBtYWRlIGhlcmUsIGFmYWljdC4KCkluIF9f
aHZtX2NvcHkoKSBhbHNvIHJlZHVjZSBwJ3Mgc2NvcGUgYW5kIGNoYW5nZSBpdHMgdHlwZSB0byB2
b2lkICouCgpbMV0gT3RoZXIgdGhhbiBvbiBhY3R1YWwgaGFyZHdhcmUsIGFjdGlvbnMgbGlrZQog
ICAgWEVOX0RPTUNUTF9zZXRodm1jb250ZXh0LCBYRU5fRE9NQ1RMX3NldHZjcHVjb250ZXh0LAog
ICAgVkNQVU9QX2luaXRpYWxpc2UsIElOSVQsIG9yIFNJUEkgaXNzdWVkIGFnYWluc3QgdGhlIHZD
UFUgY2FuIG9jY3VyCiAgICB3aGlsZSB0aGUgdkNQVSBpcyBibG9ja2VkIHdhaXRpbmcgZm9yIGEg
ZGV2aWNlIG1vZGVsIHRvIHJldHVybiBkYXRhLgogICAgSW4gc3VjaCBjYXNlcyBlbXVsYXRpb24g
bm93IGdldHMgY2FuY2VsZWQsIHRob3VnaCwgYW5kIGhlbmNlIHJlLQogICAgZXhlY3V0aW9uIGNv
cnJlY3RuZXNzIGlzIHVuYWZmZWN0ZWQuCgpTaWduZWQtb2ZmLWJ5OiBKYW4gQmV1bGljaCA8amJl
dWxpY2hAc3VzZS5jb20+Ci0tLQpUQkQ6IEluIHByaW5jaXBsZSB0aGUgY2FjaGluZyBoZXJlIHlp
ZWxkcyB1bm5lY2Vzc2FyeSB0aGUgb25lIHVzZWQgZm9yCiAgICAgaW5zbiBieXRlcyAodmlvLT5t
bWlvX2luc257LF9ieXRlc30uIEhvd2V2ZXIsIHRvIHNlZWQgdGhlIGNhY2hlCiAgICAgd2l0aCB0
aGUgZGF0YSBTVk0gbWF5IGhhdmUgbWFkZSBhdmFpbGFibGUsIHdlJ2QgaGF2ZSB0byBhbHNvIGtu
b3cKICAgICB0aGUgY29ycmVzcG9uZGluZyBHUEEuIEl0J3Mgbm90IHNhZmUsIGhvd2V2ZXIsIHRv
IHJlLXdhbGsgdGhlIHBhZ2UKICAgICB0YWJsZXMgdG8gZmluZCBvdXQsIGFzIHRoZSBwYWdlIHRh
YmxlcyBtYXkgaGF2ZSBjaGFuZ2VkIGluIHRoZQogICAgIG1lYW50aW1lLiBUaGVyZWZvcmUgSSBn
dWVzcyB3ZSBuZWVkIHRvIGtlZXAgdGhlIGR1cGxpY2F0ZQogICAgIGZ1bmN0aW9uYWxpdHkgZm9y
IG5vdy4gQSBwb3NzaWJsZSBzb2x1dGlvbiB0byB0aGlzIGNvdWxkIGJlIHRvIHVzZQogICAgIGEg
cGh5c2ljYWwtYWRkcmVzcy1iYXNlZCBjYWNoZSBmb3IgcGFnZSB0YWJsZSBhY2Nlc3NlcyAoYW5k
IGxvb2tpbmcKICAgICBmb3J3YXJkIGFsc28gZS5nLiBTVk0vVk1YIGluc24gZW11bGF0aW9uKSwg
YW5kIGEgbGluZWFyLWFkZHJlc3MtCiAgICAgYmFzZWQgb25lIGZvciBhbGwgb3RoZXIgcmVhZHMu
Ci0tLQp2NTogUmUtYXJyYW5nZSBiaXRmaWVsZC4gVXNlIGRvbWFpbl9jcmFzaCgpIGluIGh2bWVt
dWxfd3JpdGVfY2FjaGUoKS4KICAgIE1vdmUgaHZtZW11bF97cmVhZCx3cml0ZX1fY2FjaGUoKSBz
dHVicyB0byBsYXRlciBwYXRjaC4gQWxzbyBhZGp1c3QKICAgIGh2bWVtdWxfY2FuY2VsKCkuIEFk
ZCAvIGV4dGVuZCBjb21tZW50cy4gUmUtYmFzZS4KdjQ6IFJlLXdyaXRlIGZvciBjYWNoZSB0byBi
ZWNvbWUgdHJhbnNwYXJlbnQgdG8gY2FsbGVycy4KdjM6IEFkZCB0ZXh0IGFib3V0IHRoZSBhY3R1
YWwgZGF0YSBwYWdlIHRvIHRoZSBkZXNjcmlwdGlvbi4KdjI6IFJlLWJhc2UuCgotLS0gYS94ZW4v
YXJjaC94ODYvaHZtL2VtdWxhdGUuYworKysgYi94ZW4vYXJjaC94ODYvaHZtL2VtdWxhdGUuYwpA
QCAtMjgsNiArMjgsMTkgQEAKICNpbmNsdWRlIDxhc20vaW9jYXAuaD4KICNpbmNsdWRlIDxhc20v
dm1fZXZlbnQuaD4KIAorc3RydWN0IGh2bWVtdWxfY2FjaGUKK3sKKyAgICAvKiBUaGUgY2FjaGUg
aXMgZGlzYWJsZWQgYXMgbG9uZyBhcyBudW1fZW50cyA+IG1heF9lbnRzLiAqLworICAgIHVuc2ln
bmVkIGludCBudW1fZW50czsKKyAgICB1bnNpZ25lZCBpbnQgbWF4X2VudHM7CisgICAgc3RydWN0
IHsKKyAgICAgICAgcGFkZHJfdCBncGE6UEFERFJfQklUUzsKKyAgICAgICAgdW5zaWduZWQgaW50
IDpCSVRTX1BFUl9MT05HIC0gUEFERFJfQklUUyAtIDg7CisgICAgICAgIHVuc2lnbmVkIGludCBz
aXplOjg7CisgICAgICAgIHVuc2lnbmVkIGxvbmcgZGF0YTsKKyAgICB9IGVudHNbXTsKK307CisK
IHN0YXRpYyB2b2lkIGh2bXRyYWNlX2lvX2Fzc2lzdChjb25zdCBpb3JlcV90ICpwKQogewogICAg
IHVuc2lnbmVkIGludCBzaXplLCBldmVudDsKQEAgLTEzNiw2ICsxNDksOCBAQCB2b2lkIGh2bWVt
dWxfY2FuY2VsKHN0cnVjdCB2Y3B1ICp2KQogICAgIHZpby0+bW1pb19hY2Nlc3MgPSAoc3RydWN0
IG5wZmVjKXt9OwogICAgIHZpby0+bW1pb19yZXRyeSA9IGZhbHNlOwogICAgIHZpby0+ZzJtX2lv
cG9ydCA9IE5VTEw7CisKKyAgICBodm1lbXVsX2NhY2hlX2Rpc2FibGUodik7CiB9CiAKIHN0YXRp
YyBpbnQgaHZtZW11bF9kb19pbygKQEAgLTE4ODMsMTIgKzE4OTgsMTcgQEAgc3RhdGljIGludCBo
dm1lbXVsX3JlcF9tb3ZzKAogICAgICAgICByYyA9IEhWTVRSQU5TX29rYXk7CiAgICAgfQogICAg
IGVsc2UKKyAgICB7CisgICAgICAgIHVuc2lnbmVkIGludCB0b2tlbiA9IGh2bWVtdWxfY2FjaGVf
ZGlzYWJsZShjdXJyKTsKKwogICAgICAgICAvKgogICAgICAgICAgKiBXZSBkbyBhIG1vZGljdW0g
b2YgY2hlY2tpbmcgaGVyZSwganVzdCBmb3IgcGFyYW5vaWEncyBzYWtlIGFuZCB0bwogICAgICAg
ICAgKiBkZWZpbml0ZWx5IGF2b2lkIGNvcHlpbmcgYW4gdW5pdGlhbGlzZWQgYnVmZmVyIGludG8g
Z3Vlc3QgYWRkcmVzcwogICAgICAgICAgKiBzcGFjZS4KICAgICAgICAgICovCiAgICAgICAgIHJj
ID0gaHZtX2NvcHlfZnJvbV9ndWVzdF9waHlzKGJ1Ziwgc2dwYSwgYnl0ZXMpOworICAgICAgICBo
dm1lbXVsX2NhY2hlX3Jlc3RvcmUoY3VyciwgdG9rZW4pOworICAgIH0KIAogICAgIGlmICggcmMg
PT0gSFZNVFJBTlNfb2theSApCiAgICAgICAgIHJjID0gaHZtX2NvcHlfdG9fZ3Vlc3RfcGh5cyhk
Z3BhLCBidWYsIGJ5dGVzLCBjdXJyKTsKQEAgLTI1NTEsNiArMjU3MSwxOSBAQCBzdGF0aWMgaW50
IF9odm1fZW11bGF0ZV9vbmUoc3RydWN0IGh2bV9lCiAgICAgc3RydWN0IGh2bV92Y3B1X2lvICp2
aW8gPSAmY3Vyci0+YXJjaC5odm0uaHZtX2lvOwogICAgIGludCByYzsKIAorICAgIC8qCisgICAg
ICogRW5hYmxlIGNhY2hpbmcgaWYgaXQncyBjdXJyZW50bHkgZGlzYWJsZWQsIGJ1dCBsZWF2ZSB0
aGUgY2FjaGUKKyAgICAgKiB1bnRvdWNoZWQgaWYgaXQncyBhbHJlYWR5IGVuYWJsZWQsIGZvciBy
ZS1leGVjdXRpb24gdG8gY29uc3VtZQorICAgICAqIGVudHJpZXMgcG9wdWxhdGVkIGJ5IGFuIGVh
cmxpZXIgcGFzcy4KKyAgICAgKi8KKyAgICBpZiAoIHZpby0+Y2FjaGUtPm51bV9lbnRzID4gdmlv
LT5jYWNoZS0+bWF4X2VudHMgKQorICAgIHsKKyAgICAgICAgQVNTRVJUKHZpby0+aW9fcmVxLnN0
YXRlID09IFNUQVRFX0lPUkVRX05PTkUpOworICAgICAgICB2aW8tPmNhY2hlLT5udW1fZW50cyA9
IDA7CisgICAgfQorICAgIGVsc2UKKyAgICAgICAgQVNTRVJUKHZpby0+aW9fcmVxLnN0YXRlID09
IFNUQVRFX0lPUkVTUF9SRUFEWSk7CisKICAgICBodm1fZW11bGF0ZV9pbml0X3Blcl9pbnNuKGh2
bWVtdWxfY3R4dCwgdmlvLT5tbWlvX2luc24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICB2aW8tPm1taW9faW5zbl9ieXRlcyk7CiAKQEAgLTI1NjQsNiArMjU5Nyw3IEBAIHN0YXRpYyBp
bnQgX2h2bV9lbXVsYXRlX29uZShzdHJ1Y3QgaHZtX2UKICAgICB7CiAgICAgICAgIHZpby0+bW1p
b19jYWNoZV9jb3VudCA9IDA7CiAgICAgICAgIHZpby0+bW1pb19pbnNuX2J5dGVzID0gMDsKKyAg
ICAgICAgaHZtZW11bF9jYWNoZV9kaXNhYmxlKGN1cnIpOwogICAgIH0KICAgICBlbHNlCiAgICAg
ewpAQCAtMjg1Niw2ICsyODkwLDEyMyBAQCB2b2lkIGh2bV9kdW1wX2VtdWxhdGlvbl9zdGF0ZShj
b25zdCBjaGFyCiAgICAgICAgICAgIGh2bWVtdWxfY3R4dC0+aW5zbl9idWYpOwogfQogCitpbnQg
aHZtZW11bF9jYWNoZV9pbml0KHN0cnVjdCB2Y3B1ICp2KQoreworICAgIC8qCisgICAgICogTm8g
aW5zbiBjYW4gYWNjZXNzIG1vcmUgdGhhbiAxNiBpbmRlcGVuZGVudCBsaW5lYXIgYWRkcmVzc2Vz
IChBVlg1MTJGCisgICAgICogc2NhdHRlcnMvZ2F0aGVycyBiZWluZyB0aGUgd29yc3QpLiBFYWNo
IHN1Y2ggbGluZWFyIHJhbmdlIGNhbiBzcGFuIGEKKyAgICAgKiBwYWdlIGJvdW5kYXJ5LCBpLmUu
IG1heSByZXF1aXJlIHR3byBwYWdlIHdhbGtzLiBBY2NvdW50IGZvciBlYWNoIGluc24KKyAgICAg
KiBieXRlIGluZGl2aWR1YWxseSwgZm9yIHNpbXBsaWNpdHkuCisgICAgICovCisgICAgY29uc3Qg
dW5zaWduZWQgaW50IG5lbnRzID0gKENPTkZJR19QQUdJTkdfTEVWRUxTICsgMSkgKgorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIChNQVhfSU5TVF9MRU4gKyAxNiAqIDIpOworICAgIHN0
cnVjdCBodm1lbXVsX2NhY2hlICpjYWNoZSA9IHhtYWxsb2NfZmxleF9zdHJ1Y3Qoc3RydWN0IGh2
bWVtdWxfY2FjaGUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBlbnRzLCBuZW50cyk7CisKKyAgICBpZiAoICFjYWNoZSApCisgICAgICAgIHJl
dHVybiAtRU5PTUVNOworCisgICAgLyogQ2FjaGUgaXMgZGlzYWJsZWQgaW5pdGlhbGx5LiAqLwor
ICAgIGNhY2hlLT5udW1fZW50cyA9IG5lbnRzICsgMTsKKyAgICBjYWNoZS0+bWF4X2VudHMgPSBu
ZW50czsKKworICAgIHYtPmFyY2guaHZtLmh2bV9pby5jYWNoZSA9IGNhY2hlOworCisgICAgcmV0
dXJuIDA7Cit9CisKK3Vuc2lnbmVkIGludCBodm1lbXVsX2NhY2hlX2Rpc2FibGUoc3RydWN0IHZj
cHUgKnYpCit7CisgICAgc3RydWN0IGh2bWVtdWxfY2FjaGUgKmNhY2hlID0gdi0+YXJjaC5odm0u
aHZtX2lvLmNhY2hlOworICAgIHVuc2lnbmVkIGludCB0b2tlbiA9IGNhY2hlLT5udW1fZW50czsK
KworICAgIGNhY2hlLT5udW1fZW50cyA9IGNhY2hlLT5tYXhfZW50cyArIDE7CisKKyAgICByZXR1
cm4gdG9rZW47Cit9CisKK3ZvaWQgaHZtZW11bF9jYWNoZV9yZXN0b3JlKHN0cnVjdCB2Y3B1ICp2
LCB1bnNpZ25lZCBpbnQgdG9rZW4pCit7CisgICAgc3RydWN0IGh2bWVtdWxfY2FjaGUgKmNhY2hl
ID0gdi0+YXJjaC5odm0uaHZtX2lvLmNhY2hlOworCisgICAgQVNTRVJUKGNhY2hlLT5udW1fZW50
cyA+IGNhY2hlLT5tYXhfZW50cyk7CisgICAgY2FjaGUtPm51bV9lbnRzID0gdG9rZW47Cit9CisK
K2Jvb2wgaHZtZW11bF9yZWFkX2NhY2hlKGNvbnN0IHN0cnVjdCB2Y3B1ICp2LCBwYWRkcl90IGdw
YSwKKyAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgKmJ1ZmZlciwgdW5zaWduZWQgaW50IHNp
emUpCit7CisgICAgY29uc3Qgc3RydWN0IGh2bWVtdWxfY2FjaGUgKmNhY2hlID0gdi0+YXJjaC5o
dm0uaHZtX2lvLmNhY2hlOworICAgIHVuc2lnbmVkIGludCBpOworCisgICAgLyogQ2FjaGUgdW5h
dmFpbGFibGU/ICovCisgICAgaWYgKCBjYWNoZS0+bnVtX2VudHMgPiBjYWNoZS0+bWF4X2VudHMg
KQorICAgICAgICByZXR1cm4gZmFsc2U7CisKKyAgICB3aGlsZSAoIHNpemUgPiBzaXplb2YoY2Fj
aGUtPmVudHMtPmRhdGEpICkKKyAgICB7CisgICAgICAgIGkgPSBncGEgJiAoc2l6ZW9mKGNhY2hl
LT5lbnRzLT5kYXRhKSAtIDEpCisgICAgICAgICAgICA/IC1ncGEgJiAoc2l6ZW9mKGNhY2hlLT5l
bnRzLT5kYXRhKSAtIDEpCisgICAgICAgICAgICA6IHNpemVvZihjYWNoZS0+ZW50cy0+ZGF0YSk7
CisgICAgICAgIGlmICggIWh2bWVtdWxfcmVhZF9jYWNoZSh2LCBncGEsIGJ1ZmZlciwgaSkgKQor
ICAgICAgICAgICAgcmV0dXJuIGZhbHNlOworICAgICAgICBncGEgKz0gaTsKKyAgICAgICAgYnVm
ZmVyICs9IGk7CisgICAgICAgIHNpemUgLT0gaTsKKyAgICB9CisKKyAgICBmb3IgKCBpID0gMDsg
aSA8IGNhY2hlLT5udW1fZW50czsgKytpICkKKyAgICAgICAgaWYgKCBjYWNoZS0+ZW50c1tpXS5n
cGEgPT0gZ3BhICYmIGNhY2hlLT5lbnRzW2ldLnNpemUgPT0gc2l6ZSApCisgICAgICAgIHsKKyAg
ICAgICAgICAgIG1lbWNweShidWZmZXIsICZjYWNoZS0+ZW50c1tpXS5kYXRhLCBzaXplKTsKKyAg
ICAgICAgICAgIHJldHVybiB0cnVlOworICAgICAgICB9CisKKyAgICByZXR1cm4gZmFsc2U7Cit9
CisKK3ZvaWQgaHZtZW11bF93cml0ZV9jYWNoZShjb25zdCBzdHJ1Y3QgdmNwdSAqdiwgcGFkZHJf
dCBncGEsCisgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgdm9pZCAqYnVmZmVyLCB1bnNp
Z25lZCBpbnQgc2l6ZSkKK3sKKyAgICBzdHJ1Y3QgaHZtZW11bF9jYWNoZSAqY2FjaGUgPSB2LT5h
cmNoLmh2bS5odm1faW8uY2FjaGU7CisgICAgdW5zaWduZWQgaW50IGk7CisKKyAgICAvKiBDYWNo
ZSB1bmF2YWlsYWJsZT8gKi8KKyAgICBpZiAoIGNhY2hlLT5udW1fZW50cyA+IGNhY2hlLT5tYXhf
ZW50cyApCisgICAgICAgIHJldHVybjsKKworICAgIHdoaWxlICggc2l6ZSA+IHNpemVvZihjYWNo
ZS0+ZW50cy0+ZGF0YSkgKQorICAgIHsKKyAgICAgICAgaSA9IGdwYSAmIChzaXplb2YoY2FjaGUt
PmVudHMtPmRhdGEpIC0gMSkKKyAgICAgICAgICAgID8gLWdwYSAmIChzaXplb2YoY2FjaGUtPmVu
dHMtPmRhdGEpIC0gMSkKKyAgICAgICAgICAgIDogc2l6ZW9mKGNhY2hlLT5lbnRzLT5kYXRhKTsK
KyAgICAgICAgaHZtZW11bF93cml0ZV9jYWNoZSh2LCBncGEsIGJ1ZmZlciwgaSk7CisgICAgICAg
IGdwYSArPSBpOworICAgICAgICBidWZmZXIgKz0gaTsKKyAgICAgICAgc2l6ZSAtPSBpOworICAg
IH0KKworICAgIGZvciAoIGkgPSAwOyBpIDwgY2FjaGUtPm51bV9lbnRzOyArK2kgKQorICAgICAg
ICBpZiAoIGNhY2hlLT5lbnRzW2ldLmdwYSA9PSBncGEgJiYgY2FjaGUtPmVudHNbaV0uc2l6ZSA9
PSBzaXplICkKKyAgICAgICAgeworICAgICAgICAgICAgbWVtY3B5KCZjYWNoZS0+ZW50c1tpXS5k
YXRhLCBidWZmZXIsIHNpemUpOworICAgICAgICAgICAgcmV0dXJuOworICAgICAgICB9CisKKyAg
ICBpZiAoIHVubGlrZWx5KGkgPj0gY2FjaGUtPm1heF9lbnRzKSApCisgICAgeworICAgICAgICBk
b21haW5fY3Jhc2godi0+ZG9tYWluKTsKKyAgICAgICAgcmV0dXJuOworICAgIH0KKworICAgIGNh
Y2hlLT5lbnRzW2ldLmdwYSAgPSBncGE7CisgICAgY2FjaGUtPmVudHNbaV0uc2l6ZSA9IHNpemU7
CisKKyAgICBtZW1jcHkoJmNhY2hlLT5lbnRzW2ldLmRhdGEsIGJ1ZmZlciwgc2l6ZSk7CisKKyAg
ICBjYWNoZS0+bnVtX2VudHMgPSBpICsgMTsKK30KKwogLyoKICAqIExvY2FsIHZhcmlhYmxlczoK
ICAqIG1vZGU6IEMKLS0tIGEveGVuL2FyY2gveDg2L2h2bS9odm0uYworKysgYi94ZW4vYXJjaC94
ODYvaHZtL2h2bS5jCkBAIC03MjYsNiArNzI2LDggQEAgaW50IGh2bV9kb21haW5faW5pdGlhbGlz
ZShzdHJ1Y3QgZG9tYWluCiAvKiBUaGlzIGZ1bmN0aW9uIGFuZCBhbGwgaXRzIGRlc2NlbmRhbnRz
IG5lZWQgdG8gYmUgdG8gYmUgaWRlbXBvdGVudC4gKi8KIHZvaWQgaHZtX2RvbWFpbl9yZWxpbnF1
aXNoX3Jlc291cmNlcyhzdHJ1Y3QgZG9tYWluICpkKQogeworICAgIHN0cnVjdCB2Y3B1ICp2Owor
CiAgICAgaWYgKCBodm1fZnVuY3MuZG9tYWluX3JlbGlucXVpc2hfcmVzb3VyY2VzICkKICAgICAg
ICAgYWx0ZXJuYXRpdmVfdmNhbGwoaHZtX2Z1bmNzLmRvbWFpbl9yZWxpbnF1aXNoX3Jlc291cmNl
cywgZCk7CiAKQEAgLTc0Miw2ICs3NDQsOSBAQCB2b2lkIGh2bV9kb21haW5fcmVsaW5xdWlzaF9y
ZXNvdXJjZXMoc3RyCiAgICAgcnRjX2RlaW5pdChkKTsKICAgICBwbXRpbWVyX2RlaW5pdChkKTsK
ICAgICBocGV0X2RlaW5pdChkKTsKKworICAgIGZvcl9lYWNoX3ZjcHUgKCBkLCB2ICkKKyAgICAg
ICAgaHZtZW11bF9jYWNoZV9kZXN0cm95KHYpOwogfQogCiB2b2lkIGh2bV9kb21haW5fZGVzdHJv
eShzdHJ1Y3QgZG9tYWluICpkKQpAQCAtMTU0OSw2ICsxNTU0LDEwIEBAIGludCBodm1fdmNwdV9p
bml0aWFsaXNlKHN0cnVjdCB2Y3B1ICp2KQogCiAgICAgdi0+YXJjaC5odm0uaW5qZWN0X2V2ZW50
LnZlY3RvciA9IEhWTV9FVkVOVF9WRUNUT1JfVU5TRVQ7CiAKKyAgICByYyA9IGh2bWVtdWxfY2Fj
aGVfaW5pdCh2KTsKKyAgICBpZiAoIHJjICkKKyAgICAgICAgZ290byBmYWlsNDsKKwogICAgIHJj
ID0gc2V0dXBfY29tcGF0X2FyZ194bGF0KHYpOyAvKiB0ZWFyZG93bjogZnJlZV9jb21wYXRfYXJn
X3hsYXQoKSAqLwogICAgIGlmICggcmMgIT0gMCApCiAgICAgICAgIGdvdG8gZmFpbDQ7CkBAIC0x
NTg0LDYgKzE1OTMsNyBAQCBpbnQgaHZtX3ZjcHVfaW5pdGlhbGlzZShzdHJ1Y3QgdmNwdSAqdikK
ICBmYWlsNToKICAgICBmcmVlX2NvbXBhdF9hcmdfeGxhdCh2KTsKICBmYWlsNDoKKyAgICBodm1l
bXVsX2NhY2hlX2Rlc3Ryb3kodik7CiAgICAgaHZtX2Z1bmNzLnZjcHVfZGVzdHJveSh2KTsKICBm
YWlsMzoKICAgICB2bGFwaWNfZGVzdHJveSh2KTsKQEAgLTI5NDUsNiArMjk1NSw3IEBAIHZvaWQg
aHZtX3Rhc2tfc3dpdGNoKAogICAgIHVuc2lnbmVkIGludCBlZmxhZ3MsIG5ld19jcGw7CiAgICAg
cGFnZWZhdWx0X2luZm9fdCBwZmluZm87CiAgICAgaW50IGV4bl9yYWlzZWQsIHJjOworICAgIHVu
c2lnbmVkIGludCB0b2tlbiA9IGh2bWVtdWxfY2FjaGVfZGlzYWJsZSh2KTsKICAgICBzdHJ1Y3Qg
dHNzMzIgdHNzOwogCiAgICAgaHZtX2dldF9zZWdtZW50X3JlZ2lzdGVyKHYsIHg4Nl9zZWdfZ2R0
ciwgJmdkdCk7CkBAIC0zMTUyLDYgKzMxNjMsOCBAQCB2b2lkIGh2bV90YXNrX3N3aXRjaCgKICBv
dXQ6CiAgICAgaHZtX3VubWFwX2VudHJ5KG9wdHNzX2Rlc2MpOwogICAgIGh2bV91bm1hcF9lbnRy
eShucHRzc19kZXNjKTsKKworICAgIGh2bWVtdWxfY2FjaGVfcmVzdG9yZSh2LCB0b2tlbik7CiB9
CiAKIGVudW0gaHZtX3RyYW5zbGF0aW9uX3Jlc3VsdCBodm1fdHJhbnNsYXRlX2dldF9wYWdlKApA
QCAtMzI0Miw3ICszMjU1LDYgQEAgc3RhdGljIGVudW0gaHZtX3RyYW5zbGF0aW9uX3Jlc3VsdCBf
X2h2bQogICAgIGdmbl90IGdmbjsKICAgICBzdHJ1Y3QgcGFnZV9pbmZvICpwYWdlOwogICAgIHAy
bV90eXBlX3QgcDJtdDsKLSAgICBjaGFyICpwOwogICAgIGludCBjb3VudCwgdG9kbyA9IHNpemU7
CiAKICAgICBBU1NFUlQoaXNfaHZtX3ZjcHUodikpOwpAQCAtMzI5MCwxMSArMzMwMiwxNyBAQCBz
dGF0aWMgZW51bSBodm1fdHJhbnNsYXRpb25fcmVzdWx0IF9faHZtCiAgICAgICAgICAgICByZXR1
cm4gSFZNVFJBTlNfbmVlZF9yZXRyeTsKICAgICAgICAgfQogCi0gICAgICAgIHAgPSBfX21hcF9k
b21haW5fcGFnZShwYWdlKSArIHBnb2ZmOwotCi0gICAgICAgIGlmICggZmxhZ3MgJiBIVk1DT1BZ
X3RvX2d1ZXN0ICkKKyAgICAgICAgaWYgKCAoZmxhZ3MgJiBIVk1DT1BZX3RvX2d1ZXN0KSB8fAor
ICAgICAgICAgICAgICFodm1lbXVsX3JlYWRfY2FjaGUodiwgZ2ZuX3RvX2dhZGRyKGdmbikgfCBw
Z29mZiwgYnVmLCBjb3VudCkgKQogICAgICAgICB7Ci0gICAgICAgICAgICBpZiAoIHAybV9pc19k
aXNjYXJkX3dyaXRlKHAybXQpICkKKyAgICAgICAgICAgIHZvaWQgKnAgPSBfX21hcF9kb21haW5f
cGFnZShwYWdlKSArIHBnb2ZmOworCisgICAgICAgICAgICBpZiAoICEoZmxhZ3MgJiBIVk1DT1BZ
X3RvX2d1ZXN0KSApCisgICAgICAgICAgICB7CisgICAgICAgICAgICAgICAgbWVtY3B5KGJ1Ziwg
cCwgY291bnQpOworICAgICAgICAgICAgICAgIGh2bWVtdWxfd3JpdGVfY2FjaGUodiwgZ2ZuX3Rv
X2dhZGRyKGdmbikgfCBwZ29mZiwgYnVmLCBjb3VudCk7CisgICAgICAgICAgICB9CisgICAgICAg
ICAgICBlbHNlIGlmICggcDJtX2lzX2Rpc2NhcmRfd3JpdGUocDJtdCkgKQogICAgICAgICAgICAg
ewogICAgICAgICAgICAgICAgIHN0YXRpYyB1bnNpZ25lZCBsb25nIGxhc3RwYWdlOwogCkBAIC0z
MzExLDEzICszMzI5LDkgQEAgc3RhdGljIGVudW0gaHZtX3RyYW5zbGF0aW9uX3Jlc3VsdCBfX2h2
bQogICAgICAgICAgICAgICAgICAgICBtZW1zZXQocCwgMCwgY291bnQpOwogICAgICAgICAgICAg
ICAgIHBhZ2luZ19tYXJrX3Bmbl9kaXJ0eSh2LT5kb21haW4sIF9wZm4oZ2ZuX3goZ2ZuKSkpOwog
ICAgICAgICAgICAgfQotICAgICAgICB9Ci0gICAgICAgIGVsc2UKLSAgICAgICAgewotICAgICAg
ICAgICAgbWVtY3B5KGJ1ZiwgcCwgY291bnQpOwotICAgICAgICB9CiAKLSAgICAgICAgdW5tYXBf
ZG9tYWluX3BhZ2UocCk7CisgICAgICAgICAgICB1bm1hcF9kb21haW5fcGFnZShwKTsKKyAgICAg
ICAgfQogCiAgICAgICAgIGFkZHIgKz0gY291bnQ7CiAgICAgICAgIGlmICggYnVmICkKLS0tIGEv
eGVuL2FyY2gveDg2L2h2bS9oeXBlcmNhbGwuYworKysgYi94ZW4vYXJjaC94ODYvaHZtL2h5cGVy
Y2FsbC5jCkBAIC0yMiw2ICsyMiw3IEBACiAjaW5jbHVkZSA8eGVuL2h5cGVyY2FsbC5oPgogI2lu
Y2x1ZGUgPHhlbi9ub3NwZWMuaD4KIAorI2luY2x1ZGUgPGFzbS9odm0vZW11bGF0ZS5oPgogI2lu
Y2x1ZGUgPGFzbS9odm0vc3VwcG9ydC5oPgogCiBzdGF0aWMgbG9uZyBodm1fbWVtb3J5X29wKGlu
dCBjbWQsIFhFTl9HVUVTVF9IQU5ETEVfUEFSQU0odm9pZCkgYXJnKQpAQCAtMTU5LDYgKzE2MCw3
IEBAIGludCBodm1faHlwZXJjYWxsKHN0cnVjdCBjcHVfdXNlcl9yZWdzICoKICAgICBzdHJ1Y3Qg
ZG9tYWluICpjdXJyZCA9IGN1cnItPmRvbWFpbjsKICAgICBpbnQgbW9kZSA9IGh2bV9ndWVzdF94
ODZfbW9kZShjdXJyKTsKICAgICB1bnNpZ25lZCBsb25nIGVheCA9IHJlZ3MtPmVheDsKKyAgICB1
bnNpZ25lZCBpbnQgdG9rZW47CiAKICAgICBzd2l0Y2ggKCBtb2RlICkKICAgICB7CkBAIC0xODMs
NyArMTg1LDE4IEBAIGludCBodm1faHlwZXJjYWxsKHN0cnVjdCBjcHVfdXNlcl9yZWdzICoKICAg
ICB9CiAKICAgICBpZiAoIChlYXggJiAweDgwMDAwMDAwKSAmJiBpc192aXJpZGlhbl9kb21haW4o
Y3VycmQpICkKLSAgICAgICAgcmV0dXJuIHZpcmlkaWFuX2h5cGVyY2FsbChyZWdzKTsKKyAgICB7
CisgICAgICAgIGludCByZXQ7CisKKyAgICAgICAgLyogU2VlIGNvbW1lbnQgYmVsb3cuICovCisg
ICAgICAgIHRva2VuID0gaHZtZW11bF9jYWNoZV9kaXNhYmxlKGN1cnIpOworCisgICAgICAgIHJl
dCA9IHZpcmlkaWFuX2h5cGVyY2FsbChyZWdzKTsKKworICAgICAgICBodm1lbXVsX2NhY2hlX3Jl
c3RvcmUoY3VyciwgdG9rZW4pOworCisgICAgICAgIHJldHVybiByZXQ7CisgICAgfQogCiAgICAg
QlVJTERfQlVHX09OKEFSUkFZX1NJWkUoaHZtX2h5cGVyY2FsbF90YWJsZSkgPgogICAgICAgICAg
ICAgICAgICBBUlJBWV9TSVpFKGh5cGVyY2FsbF9hcmdzX3RhYmxlKSk7CkBAIC0yMDIsNiArMjE1
LDEyIEBAIGludCBodm1faHlwZXJjYWxsKHN0cnVjdCBjcHVfdXNlcl9yZWdzICoKICAgICAgICAg
cmV0dXJuIEhWTV9IQ0FMTF9jb21wbGV0ZWQ7CiAgICAgfQogCisgICAgLyoKKyAgICAgKiBDYWNo
aW5nIGlzIGludGVuZGVkIGZvciBpbnN0cnVjdGlvbiBlbXVsYXRpb24gb25seS4gRGlzYWJsZSBp
dAorICAgICAqIGZvciBhbnkgYWNjZXNzZXMgYnkgaHlwZXJjYWxsIGFyZ3VtZW50IGNvcHktaW4g
LyBjb3B5LW91dC4KKyAgICAgKi8KKyAgICB0b2tlbiA9IGh2bWVtdWxfY2FjaGVfZGlzYWJsZShj
dXJyKTsKKwogICAgIGN1cnItPmhjYWxsX3ByZWVtcHRlZCA9IGZhbHNlOwogCiAgICAgaWYgKCBt
b2RlID09IDggKQpAQCAtMjk1LDYgKzMxNCw4IEBAIGludCBodm1faHlwZXJjYWxsKHN0cnVjdCBj
cHVfdXNlcl9yZWdzICoKICNlbmRpZgogICAgIH0KIAorICAgIGh2bWVtdWxfY2FjaGVfcmVzdG9y
ZShjdXJyLCB0b2tlbik7CisKICAgICBIVk1fREJHX0xPRyhEQkdfTEVWRUxfSENBTEwsICJoY2Fs
bCVsdSAtPiAlbHgiLCBlYXgsIHJlZ3MtPnJheCk7CiAKICAgICBpZiAoIGN1cnItPmhjYWxsX3By
ZWVtcHRlZCApCi0tLSBhL3hlbi9hcmNoL3g4Ni9odm0vaW50ZXJjZXB0LmMKKysrIGIveGVuL2Fy
Y2gveDg2L2h2bS9pbnRlcmNlcHQuYwpAQCAtMjAsNiArMjAsNyBAQAogI2luY2x1ZGUgPHhlbi90
eXBlcy5oPgogI2luY2x1ZGUgPHhlbi9zY2hlZC5oPgogI2luY2x1ZGUgPGFzbS9yZWdzLmg+Cisj
aW5jbHVkZSA8YXNtL2h2bS9lbXVsYXRlLmg+CiAjaW5jbHVkZSA8YXNtL2h2bS9odm0uaD4KICNp
bmNsdWRlIDxhc20vaHZtL3N1cHBvcnQuaD4KICNpbmNsdWRlIDxhc20vaHZtL2RvbWFpbi5oPgpA
QCAtMTYzLDYgKzE2NCw5IEBAIGludCBodm1fcHJvY2Vzc19pb19pbnRlcmNlcHQoY29uc3Qgc3Ry
dWMKICAgICAgICAgewogICAgICAgICAgICAgaWYgKCBwLT5kYXRhX2lzX3B0ciApCiAgICAgICAg
ICAgICB7CisgICAgICAgICAgICAgICAgc3RydWN0IHZjcHUgKmN1cnIgPSBjdXJyZW50OworICAg
ICAgICAgICAgICAgIHVuc2lnbmVkIGludCB0b2tlbiA9IGh2bWVtdWxfY2FjaGVfZGlzYWJsZShj
dXJyKTsKKwogICAgICAgICAgICAgICAgIGRhdGEgPSAwOwogICAgICAgICAgICAgICAgIHN3aXRj
aCAoIGh2bV9jb3B5X2Zyb21fZ3Vlc3RfcGh5cygmZGF0YSwgcC0+ZGF0YSArIHN0ZXAgKiBpLAog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwLT5zaXpl
KSApCkBAIC0xNzksOSArMTgzLDExIEBAIGludCBodm1fcHJvY2Vzc19pb19pbnRlcmNlcHQoY29u
c3Qgc3RydWMKICAgICAgICAgICAgICAgICAgICAgQVNTRVJUX1VOUkVBQ0hBQkxFKCk7CiAgICAg
ICAgICAgICAgICAgICAgIC8qIGZhbGwgdGhyb3VnaCAqLwogICAgICAgICAgICAgICAgIGRlZmF1
bHQ6Ci0gICAgICAgICAgICAgICAgICAgIGRvbWFpbl9jcmFzaChjdXJyZW50LT5kb21haW4pOwor
ICAgICAgICAgICAgICAgICAgICBkb21haW5fY3Jhc2goY3Vyci0+ZG9tYWluKTsKICAgICAgICAg
ICAgICAgICAgICAgcmV0dXJuIFg4NkVNVUxfVU5IQU5ETEVBQkxFOwogICAgICAgICAgICAgICAg
IH0KKworICAgICAgICAgICAgICAgIGh2bWVtdWxfY2FjaGVfcmVzdG9yZShjdXJyLCB0b2tlbik7
CiAgICAgICAgICAgICB9CiAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgZGF0YSA9
IHAtPmRhdGE7Ci0tLSBhL3hlbi9hcmNoL3g4Ni9odm0vc3ZtL3N2bS5jCisrKyBiL3hlbi9hcmNo
L3g4Ni9odm0vc3ZtL3N2bS5jCkBAIC0xMDQwLDYgKzEwNDAsOCBAQCB2b2lkIHN2bV92bWVudGVy
X2hlbHBlcihjb25zdCBzdHJ1Y3QgY3B1CiAgICAgc3RydWN0IHZjcHUgKmN1cnIgPSBjdXJyZW50
OwogICAgIHN0cnVjdCB2bWNiX3N0cnVjdCAqdm1jYiA9IGN1cnItPmFyY2guaHZtLnN2bS52bWNi
OwogCisgICAgQVNTRVJUKGh2bWVtdWxfY2FjaGVfZGlzYWJsZWQoY3VycikpOworCiAgICAgc3Zt
X2FzaWRfaGFuZGxlX3ZtcnVuKCk7CiAKICAgICBpZiAoIHVubGlrZWx5KHRiX2luaXRfZG9uZSkg
KQotLS0gYS94ZW4vYXJjaC94ODYvaHZtL3Ztc2kuYworKysgYi94ZW4vYXJjaC94ODYvaHZtL3Zt
c2kuYwpAQCAtMzUsNiArMzUsNyBAQAogI2luY2x1ZGUgPHhlbi9pcnEuaD4KICNpbmNsdWRlIDx4
ZW4vdnBjaS5oPgogI2luY2x1ZGUgPHB1YmxpYy9odm0vaW9yZXEuaD4KKyNpbmNsdWRlIDxhc20v
aHZtL2VtdWxhdGUuaD4KICNpbmNsdWRlIDxhc20vaHZtL2lvLmg+CiAjaW5jbHVkZSA8YXNtL2h2
bS92cGljLmg+CiAjaW5jbHVkZSA8YXNtL2h2bS92bGFwaWMuaD4KQEAgLTYwNyw2ICs2MDgsNyBA
QCB2b2lkIG1zaXhfd3JpdGVfY29tcGxldGlvbihzdHJ1Y3QgdmNwdSAqCiAgICAgaWYgKCAhY3Ry
bF9hZGRyZXNzICYmIHNub29wX2FkZHIgJiYKICAgICAgICAgIHYtPmFyY2guaHZtLmh2bV9pby5t
c2l4X3Nub29wX2dwYSApCiAgICAgeworICAgICAgICB1bnNpZ25lZCBpbnQgdG9rZW4gPSBodm1l
bXVsX2NhY2hlX2Rpc2FibGUodik7CiAgICAgICAgIGNvbnN0IHN0cnVjdCBtc2lfZGVzYyAqZGVz
YzsKICAgICAgICAgdWludDMyX3QgZGF0YTsKIApAQCAtNjIxLDYgKzYyMyw4IEBAIHZvaWQgbXNp
eF93cml0ZV9jb21wbGV0aW9uKHN0cnVjdCB2Y3B1ICoKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgc2l6ZW9mKGRhdGEpKSA9PSBIVk1UUkFOU19va2F5ICYmCiAgICAgICAg
ICAgICAgIShkYXRhICYgUENJX01TSVhfVkVDVE9SX0JJVE1BU0spICkKICAgICAgICAgICAgIGN0
cmxfYWRkcmVzcyA9IHNub29wX2FkZHI7CisKKyAgICAgICAgaHZtZW11bF9jYWNoZV9yZXN0b3Jl
KHYsIHRva2VuKTsKICAgICB9CiAKICAgICBpZiAoICFjdHJsX2FkZHJlc3MgKQotLS0gYS94ZW4v
YXJjaC94ODYvaHZtL3ZteC92bXguYworKysgYi94ZW4vYXJjaC94ODYvaHZtL3ZteC92bXguYwpA
QCAtNDM2Miw2ICs0MzYyLDggQEAgYm9vbCB2bXhfdm1lbnRlcl9oZWxwZXIoY29uc3Qgc3RydWN0
IGNwdQogICAgIHN0cnVjdCBodm1fdmNwdV9hc2lkICpwX2FzaWQ7CiAgICAgYm9vbF90IG5lZWRf
Zmx1c2g7CiAKKyAgICBBU1NFUlQoaHZtZW11bF9jYWNoZV9kaXNhYmxlZChjdXJyKSk7CisKICAg
ICAvKiBTaGFkb3cgRVBUUCBjYW4ndCBiZSB1cGRhdGVkIGhlcmUgYmVjYXVzZSBpcnFzIGFyZSBk
aXNhYmxlZCAqLwogICAgICBpZiAoIG5lc3RlZGh2bV92Y3B1X2luX2d1ZXN0bW9kZShjdXJyKSAm
JiB2Y3B1X25lc3RlZGh2bShjdXJyKS5zdGFsZV9ucDJtICkKICAgICAgICAgIHJldHVybiBmYWxz
ZTsKLS0tIGEveGVuL2luY2x1ZGUvYXNtLXg4Ni9odm0vZW11bGF0ZS5oCisrKyBiL3hlbi9pbmNs
dWRlL2FzbS14ODYvaHZtL2VtdWxhdGUuaApAQCAtMTMsNiArMTMsNyBAQAogI2RlZmluZSBfX0FT
TV9YODZfSFZNX0VNVUxBVEVfSF9fCiAKICNpbmNsdWRlIDx4ZW4vZXJyLmg+CisjaW5jbHVkZSA8
eGVuL3NjaGVkLmg+CiAjaW5jbHVkZSA8YXNtL2h2bS9odm0uaD4KICNpbmNsdWRlIDxhc20veDg2
X2VtdWxhdGUuaD4KIApAQCAtOTcsNiArOTgsMzkgQEAgaW50IGh2bWVtdWxfZG9fcGlvX2J1ZmZl
cih1aW50MTZfdCBwb3J0LAogICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50OF90IGRpciwK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqYnVmZmVyKTsKIAorI2lmZGVmIENPTkZJ
R19IVk0KKy8qCisgKiBUaGUgY2FjaGUgY29udHJvbGxlZCBieSB0aGUgZnVuY3Rpb25zIGJlbG93
IGlzIG5vdCBsaWtlIGFuIG9yZGluYXJ5IENQVQorICogY2FjaGUsIGkuZS4gYWltaW5nIHRvIGhl
bHAgcGVyZm9ybWFuY2UsIGJ1dCBhICJzZWNyZXQgc3RvcmUiIHdoaWNoIGlzCisgKiBuZWVkZWQg
Zm9yIGNvcnJlY3RuZXNzLiAgVGhlIGlzc3VlIGl0IGhlbHBzIGFkZHJlc3NpbmcgaXMgdGhlIG5l
ZWQgZm9yCisgKiByZS1leGVjdXRpb24gb2YgYW4gaW5zbiAoYWZ0ZXIgZGF0YSB3YXMgcHJvdmlk
ZWQgYnkgYSBkZXZpY2UgbW9kZWwpIHRvCisgKiBvYnNlcnZlIHRoZSBleGFjdCBzYW1lIG1lbW9y
eSBzdGF0ZSwgaS5lLiB0byBzcGVjaWZpY2FsbHkgbm90IG9ic2VydmUgYW55CisgKiB1cGRhdGVz
IHdoaWNoIG1heSBoYXZlIG9jY3VycmVkIGluIHRoZSBtZWFudGltZSBieSBvdGhlciBhZ2VudHMu
CisgKiBUaGVyZWZvcmUgdGhpcyBjYWNoZSBnZXRzCisgKiAtIGVuYWJsZWQgd2hlbiBlbXVsYXRp
b24gb2YgYW4gaW5zbiBzdGFydHMsCisgKiAtIGRpc2FibGVkIGFjcm9zcyBwcm9jZXNzaW5nIHNl
Y29uZGFyeSB0aGluZ3MgbGlrZSBhIGh5cGVyY2FsbCByZXN1bHRpbmcKKyAqICAgZnJvbSBpbnNu
IGVtdWxhdGlvbiwKKyAqIC0gZGlzYWJsZWQgYWdhaW4gd2hlbiBhbiBlbXVsYXRlZCBpbnNuIGlz
IGtub3duIHRvIG5vdCByZXF1aXJlIGFueQorICogICBmdXJ0aGVyIHJlLWV4ZWN1dGlvbi4KKyAq
LworaW50IF9fbXVzdF9jaGVjayBodm1lbXVsX2NhY2hlX2luaXQoc3RydWN0IHZjcHUgKnYpOwor
c3RhdGljIGlubGluZSB2b2lkIGh2bWVtdWxfY2FjaGVfZGVzdHJveShzdHJ1Y3QgdmNwdSAqdikK
K3sKKyAgICBYRlJFRSh2LT5hcmNoLmh2bS5odm1faW8uY2FjaGUpOworfQorYm9vbCBodm1lbXVs
X3JlYWRfY2FjaGUoY29uc3Qgc3RydWN0IHZjcHUgKiwgcGFkZHJfdCBncGEsCisgICAgICAgICAg
ICAgICAgICAgICAgICB2b2lkICpidWZmZXIsIHVuc2lnbmVkIGludCBzaXplKTsKK3ZvaWQgaHZt
ZW11bF93cml0ZV9jYWNoZShjb25zdCBzdHJ1Y3QgdmNwdSAqLCBwYWRkcl90IGdwYSwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICBjb25zdCB2b2lkICpidWZmZXIsIHVuc2lnbmVkIGludCBzaXpl
KTsKK3Vuc2lnbmVkIGludCBodm1lbXVsX2NhY2hlX2Rpc2FibGUoc3RydWN0IHZjcHUgKik7Cit2
b2lkIGh2bWVtdWxfY2FjaGVfcmVzdG9yZShzdHJ1Y3QgdmNwdSAqLCB1bnNpZ25lZCBpbnQgdG9r
ZW4pOworLyogRm9yIHVzZSBpbiBBU1NFUlQoKXMgb25seTogKi8KK3N0YXRpYyBpbmxpbmUgYm9v
bCBodm1lbXVsX2NhY2hlX2Rpc2FibGVkKHN0cnVjdCB2Y3B1ICp2KQoreworICAgIHJldHVybiBo
dm1lbXVsX2NhY2hlX2Rpc2FibGUodikgPT0gaHZtZW11bF9jYWNoZV9kaXNhYmxlKHYpOworfQor
I2VuZGlmCisKIHZvaWQgaHZtX2R1bXBfZW11bGF0aW9uX3N0YXRlKGNvbnN0IGNoYXIgKmxvZ2x2
bCwgY29uc3QgY2hhciAqcHJlZml4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ry
dWN0IGh2bV9lbXVsYXRlX2N0eHQgKmh2bWVtdWxfY3R4dCwgaW50IHJjKTsKIAotLS0gYS94ZW4v
aW5jbHVkZS9hc20teDg2L2h2bS92Y3B1LmgKKysrIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9odm0v
dmNwdS5oCkBAIC03Nyw2ICs3Nyw4IEBAIHN0cnVjdCBodm1fdmNwdV9pbyB7CiAgICAgLyogRm9y
IHJldHJpZXMgd2Ugc2hvdWxkbid0IHJlLWZldGNoIHRoZSBpbnN0cnVjdGlvbi4gKi8KICAgICB1
bnNpZ25lZCBpbnQgbW1pb19pbnNuX2J5dGVzOwogICAgIHVuc2lnbmVkIGNoYXIgbW1pb19pbnNu
WzE2XTsKKyAgICBzdHJ1Y3QgaHZtZW11bF9jYWNoZSAqY2FjaGU7CisKICAgICAvKgogICAgICAq
IEZvciBzdHJpbmcgaW5zdHJ1Y3Rpb24gZW11bGF0aW9uIHdlIG5lZWQgdG8gYmUgYWJsZSB0byBz
aWduYWwgYQogICAgICAqIG5lY2Vzc2FyeSByZXRyeSB0aHJvdWdoIG90aGVyIHRoYW4gZnVuY3Rp
b24gcmV0dXJuIGNvZGVzLgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVj
dC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1k
ZXZlbA==

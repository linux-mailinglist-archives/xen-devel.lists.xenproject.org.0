Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 4E9D145AA0
	for <lists+xen-devel@lfdr.de>; Fri, 14 Jun 2019 12:40:41 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hbjb4-0002ly-J4; Fri, 14 Jun 2019 10:38:14 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=Y8Mf=UN=citrix.com=anthony.perard@srs-us1.protection.inumbo.net>)
 id 1hbjb2-0002kw-R9
 for xen-devel@lists.xenproject.org; Fri, 14 Jun 2019 10:38:12 +0000
X-Inumbo-ID: 816b857d-8e90-11e9-8980-bc764e045a96
Received: from esa5.hc3370-68.iphmx.com (unknown [216.71.155.168])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 816b857d-8e90-11e9-8980-bc764e045a96;
 Fri, 14 Jun 2019 10:38:10 +0000 (UTC)
Authentication-Results: esa5.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=anthony.perard@citrix.com;
 spf=Pass smtp.mailfrom=anthony.perard@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa5.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 anthony.perard@citrix.com) identity=pra;
 client-ip=162.221.158.21; receiver=esa5.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="anthony.perard@citrix.com";
 x-conformance=sidf_compatible
Received-SPF: Pass (esa5.hc3370-68.iphmx.com: domain of
 anthony.perard@citrix.com designates 162.221.158.21 as
 permitted sender) identity=mailfrom;
 client-ip=162.221.158.21; receiver=esa5.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="anthony.perard@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83 ~all"
Received-SPF: None (esa5.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa5.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: getYCXxD9POOaAOyC7G8S26zWJPs1CS8PJv96E8vEJWX7G38aNH7BdxzavYrRHX2cNcZ6mWyO8
 j8Bi5I+tyLdukLL4/iURnhfbJAhOux2/WaQOimmEFZpF4ELNk0fgdowRjK7D1KmEMJ4BC9SXBF
 7s+zOyWcflfg7683A7pLRI+KIC+hWW7vkeDYAbq1hmSe4fQE0m9UcZ9unm38aFCOdz8RpMdrO6
 5KHdOVnxcdIXfhm90oCql0hKgNWakCMzmUs5zJlT4CXiKyhtbBGnRvALwZsKXM4Ay13n3Ny19F
 vuo=
X-SBRS: 2.7
X-MesageID: 1722752
X-Ironport-Server: esa5.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.63,373,1557201600"; 
   d="scan'208";a="1722752"
From: Anthony PERARD <anthony.perard@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Fri, 14 Jun 2019 11:37:55 +0100
Message-ID: <20190614103801.22619-4-anthony.perard@citrix.com>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190614103801.22619-1-anthony.perard@citrix.com>
References: <20190614103801.22619-1-anthony.perard@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v2 3/9] libxl_internal: Introduce libxl__ev_lock
 for devices hotplug via QMP
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Anthony PERARD <anthony.perard@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Wei Liu <wl@xen.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhlIGN1cnJlbnQgbG9jayBgZG9tYWluX3VzZXJkYXRhX2xvY2snIGNhbid0IGJlIHVzZWQgd2hl
biBtb2RpZmljYXRpb24KdG8gYSBndWVzdCBpcyBkb25lIGJ5IHNlbmRpbmcgY29tbWFuZCB0byBR
RU1VLCB0aGlzIGlzIGEgc2xvdyBwcm9jZXNzCmFuZCByZXF1aXJlcyB0byBjYWxsIENUWF9VTkxP
Q0ssIHdoaWNoIGlzIG5vdCBwb3NzaWJsZSB3aGlsZSBob2xkaW5nCnRoZSBgZG9tYWluX3VzZXJk
YXRhX2xvY2snLgoKVG8gcmVzb2x2ZSB0aGlzIGlzc3VlLCB3ZSBjcmVhdGUgYSBuZXcgbG9jayB3
aGljaCBjYW4gdGFrZSBvdmVyIHBhcnQKb2YgdGhlIGpvYiBvZiB0aGUganNvbl9sb2NrLgoKVGhp
cyBsb2NrIGlzIG91dHNpZGUgQ1RYX0xPQ0sgaW4gdGhlIGxvY2sgaGllcmFyY2h5LgpsaWJ4bF9f
ZXZfbG9ja19nZXQgd2lsbCBoYXZlIENUWF9VTkxPQ0sgYmVmb3JlIHRyeWluZyB0byBncmFiIHRo
ZQpldl9sb2NrLiBUaGUgY2FsbGJhY2sgaXMgdXNlZCB0byBub3RpZnkgd2hlbiB0aGUgZXZfbG9j
ayBoYXZlIGJlZW4KYWNxdWlyZWQuCgpTaWduZWQtb2ZmLWJ5OiBBbnRob255IFBFUkFSRCA8YW50
aG9ueS5wZXJhcmRAY2l0cml4LmNvbT4KLS0tCgpOb3RlczoKICAgIFNob3VsZCBsaWJ4bF9fZXZf
dW5sb2NrKCkga2lsbCB0aGUgY2hpbGQ/CiAgICAKICAgIFRoYXQgd291bGQgbWVhbiB0aGF0IHdl
IHdvdWxkIG5lZWQgdG8gaGFuZGxlIHRoZSBjYXNlIHdoZXJlIHRoZSBwcm9jZXNzCiAgICB0cnlp
bmcgdG8gZ3JhYiB0aGUgbG9jayBnb3QgaW1wYXRpZW50IGFuZCBkZWNpZGVkIHRoYXQgaXQgd2Fz
IHRha2luZyB0b28KICAgIGxvbmcuCiAgICAKICAgIHYyOgogICAgLSBuZXcgcGF0Y2gsIHRvIHJl
cGxhY2UgMiBwYXRjaAogICAgICBpbXBsZW1lbnQgYSBkaWZmZXJlbnQgbG9jawoKIHRvb2xzL2xp
YnhsL2xpYnhsX2ludGVybmFsLmMgfCAxNzQgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysKIHRvb2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmggfCAgNzYgKysrKysrKysrKysrKyst
CiAyIGZpbGVzIGNoYW5nZWQsIDI0NiBpbnNlcnRpb25zKCspLCA0IGRlbGV0aW9ucygtKQoKZGlm
ZiAtLWdpdCBhL3Rvb2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmMgYi90b29scy9saWJ4bC9saWJ4
bF9pbnRlcm5hbC5jCmluZGV4IGY0OTJkYWU1ZmYuLjM5MDZhMDUxMmQgMTAwNjQ0Ci0tLSBhL3Rv
b2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmMKKysrIGIvdG9vbHMvbGlieGwvbGlieGxfaW50ZXJu
YWwuYwpAQCAtNTc1LDYgKzU3NSwxODAgQEAgdm9pZCBsaWJ4bF9fdXBkYXRlX2RvbWFpbl9jb25m
aWd1cmF0aW9uKGxpYnhsX19nYyAqZ2MsCiAgICAgZHN0LT5iX2luZm8udmlkZW9fbWVta2IgPSBz
cmMtPmJfaW5mby52aWRlb19tZW1rYjsKIH0KIAordm9pZCBsaWJ4bF9fZXZfbG9ja19pbml0KGxp
YnhsX19ldl9sb2NrICpsb2NrKQoreworICAgIGxpYnhsX19ldl9jaGlsZF9pbml0KCZsb2NrLT5j
aGlsZCk7CisgICAgbG9jay0+cGF0aCA9IE5VTEw7CisgICAgbG9jay0+ZmQgPSAtMTsKKyAgICBs
b2NrLT5oZWxkID0gZmFsc2U7Cit9CisKK3N0YXRpYyB2b2lkIGV2X2xvY2tfcHJlcGFyZV9mb3Jr
KGxpYnhsX19lZ2MgKmVnYywgbGlieGxfX2V2X2xvY2sgKmxvY2spOworc3RhdGljIHZvaWQgZXZf
bG9ja19jaGlsZF9jYWxsYmFjayhsaWJ4bF9fZWdjICplZ2MsIGxpYnhsX19ldl9jaGlsZCAqY2hp
bGQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpZF90IHBpZCwgaW50IHN0
YXR1cyk7CisKK3ZvaWQgbGlieGxfX2V2X2xvY2tfZ2V0KGxpYnhsX19lZ2MgKmVnYywgbGlieGxf
X2V2X2xvY2sgKmxvY2spCit7CisgICAgU1RBVEVfQU9fR0MobG9jay0+YW8pOworICAgIGNvbnN0
IGNoYXIgKmxvY2tmaWxlOworCisgICAgbG9ja2ZpbGUgPSBsaWJ4bF9fdXNlcmRhdGFfcGF0aChn
YywgbG9jay0+ZG9taWQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibGli
eGwtZGV2aWNlLWNoYW5nZXMtbG9jayIsICJsIik7CisgICAgaWYgKCFsb2NrZmlsZSkgZ290byBv
dXQ7CisgICAgbG9jay0+cGF0aCA9IGxpYnhsX19zdHJkdXAoTk9HQywgbG9ja2ZpbGUpOworCisg
ICAgZXZfbG9ja19wcmVwYXJlX2ZvcmsoZWdjLCBsb2NrKTsKKyAgICByZXR1cm47CitvdXQ6Cisg
ICAgbG9jay0+Y2FsbGJhY2soZWdjLCBsb2NrLCBFUlJPUl9MT0NLX0ZBSUwpOworfQorCitzdGF0
aWMgdm9pZCBldl9sb2NrX3ByZXBhcmVfZm9yayhsaWJ4bF9fZWdjICplZ2MsIGxpYnhsX19ldl9s
b2NrICpsb2NrKQoreworICAgIFNUQVRFX0FPX0dDKGxvY2stPmFvKTsKKyAgICBwaWRfdCBwaWQ7
CisgICAgaW50IGZkOworCisgICAgLyogQ29udmVuaWVuY2UgYWxpYXNlcyAqLworICAgIGxpYnhs
X2RvbWlkIGRvbWlkID0gbG9jay0+ZG9taWQ7CisgICAgY29uc3QgY2hhciAqbG9ja2ZpbGUgPSBs
b2NrLT5wYXRoOworCisgICAgbG9jay0+ZmQgPSBvcGVuKGxvY2tmaWxlLCBPX1JEV1J8T19DUkVB
VCwgMDY2Nik7CisgICAgaWYgKGxvY2stPmZkIDwgMCkgeworICAgICAgICBMT0dFRChFUlJPUiwg
ZG9taWQsICJjYW5ub3Qgb3BlbiBsb2NrZmlsZSAlcyIsIGxvY2tmaWxlKTsKKyAgICAgICAgZ290
byBvdXQ7CisgICAgfQorICAgIGZkID0gbG9jay0+ZmQ7CisKKyAgICBwaWQgPSBsaWJ4bF9fZXZf
Y2hpbGRfZm9yayhnYywgJmxvY2stPmNoaWxkLCBldl9sb2NrX2NoaWxkX2NhbGxiYWNrKTsKKyAg
ICBpZiAocGlkIDwgMCkKKyAgICAgICAgZ290byBvdXQ7CisgICAgaWYgKCFwaWQpIHsKKyAgICAg
ICAgLyogY2hpbGQgKi8KKyAgICAgICAgaW50IGV4aXRfdmFsID0gMDsKKworICAgICAgICAvKiBM
b2NrIHRoZSBmaWxlIGluIGV4Y2x1c2l2ZSBtb2RlLCB3YWl0IGluZGVmaW5pdGVseSB0bworICAg
ICAgICAgKiBhY3F1aXJlIHRoZSBsb2NrICovCisgICAgICAgIHdoaWxlIChmbG9jayhmZCwgTE9D
S19FWCkpIHsKKyAgICAgICAgICAgIHN3aXRjaCAoZXJybm8pIHsKKyAgICAgICAgICAgIGNhc2Ug
RUlOVFI6CisgICAgICAgICAgICAgICAgLyogU2lnbmFsIHJlY2VpdmVkLCByZXRyeSAqLworICAg
ICAgICAgICAgICAgIGNvbnRpbnVlOworICAgICAgICAgICAgZGVmYXVsdDoKKyAgICAgICAgICAg
ICAgICAvKiBBbGwgb3RoZXIgZXJybm86IEVCQURGLCBFSU5WQUwsIEVOT0xDSywgRVdPVUxEQkxP
Q0sgKi8KKyAgICAgICAgICAgICAgICBMT0dFRChFUlJPUiwgZG9taWQsCisgICAgICAgICAgICAg
ICAgICAgICAgInVuZXhwZWN0ZWQgZXJyb3Igd2hpbGUgdHJ5aW5nIHRvIGxvY2sgJXMsIGZkPSVk
LCBlcnJubz0lZCIsCisgICAgICAgICAgICAgICAgICAgICAgbG9ja2ZpbGUsIGZkLCBlcnJubyk7
CisgICAgICAgICAgICAgICAgZXhpdF92YWwgPSAxOworICAgICAgICAgICAgICAgIGJyZWFrOwor
ICAgICAgICAgICAgfQorICAgICAgICB9CisgICAgICAgIF9leGl0KGV4aXRfdmFsKTsKKyAgICB9
CisKKyAgICAvKiBOb3cgdGhhdCB0aGUgY2hpbGQgaGFzIHRoZSBmZCwgc2V0IGNsb2V4ZWMgaW4g
dGhlIHBhcmVudCB0byBwcmV2ZW50CisgICAgICogbW9yZSBsZWFrYWdlIHRoYW4gbmVjZXNzYXJ5
ICovCisgICAgbGlieGxfZmRfc2V0X2Nsb2V4ZWMoQ1RYLCBmZCwgMSk7CisgICAgcmV0dXJuOwor
b3V0OgorICAgIGxpYnhsX19ldl91bmxvY2soZ2MsIGxvY2spOworICAgIGxvY2stPmNhbGxiYWNr
KGVnYywgbG9jaywgRVJST1JfTE9DS19GQUlMKTsKK30KKworc3RhdGljIHZvaWQgZXZfbG9ja19j
aGlsZF9jYWxsYmFjayhsaWJ4bF9fZWdjICplZ2MsIGxpYnhsX19ldl9jaGlsZCAqY2hpbGQsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpZF90IHBpZCwgaW50IHN0YXR1cykK
K3sKKyAgICBFR0NfR0M7CisgICAgbGlieGxfX2V2X2xvY2sgKmxvY2sgPSBDT05UQUlORVJfT0Yo
Y2hpbGQsICpsb2NrLCBjaGlsZCk7CisgICAgc3RydWN0IHN0YXQgc3RhYiwgZnN0YWI7CisgICAg
aW50IHJjID0gRVJST1JfTE9DS19GQUlMOworCisgICAgLyogQ29udmVuaWVuY2UgYWxpYXNlcyAq
LworICAgIGludCBmZCA9IGxvY2stPmZkOworICAgIGNvbnN0IGNoYXIgKmxvY2tmaWxlID0gbG9j
ay0+cGF0aDsKKyAgICBsaWJ4bF9kb21pZCBkb21pZCA9IGxvY2stPmRvbWlkOworCisgICAgaWYg
KHN0YXR1cykgeworICAgICAgICBsaWJ4bF9yZXBvcnRfY2hpbGRfZXhpdHN0YXR1cyhDVFgsIFhU
TF9FUlJPUiwgImZsb2NrIGNoaWxkIiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgcGlkLCBzdGF0dXMpOworICAgICAgICBnb3RvIG91dDsKKyAgICB9CisKKyAgICBpZiAo
ZnN0YXQoZmQsICZmc3RhYikpIHsKKyAgICAgICAgTE9HRUQoRVJST1IsIGRvbWlkLCAiY2Fubm90
IGZzdGF0ICVzLCBmZD0lZCIsIGxvY2tmaWxlLCBmZCk7CisgICAgICAgIGdvdG8gb3V0OworICAg
IH0KKyAgICBpZiAoc3RhdChsb2NrZmlsZSwgJnN0YWIpKSB7CisgICAgICAgIGlmIChlcnJubyAh
PSBFTk9FTlQpIHsKKyAgICAgICAgICAgIExPR0VEKEVSUk9SLCBkb21pZCwgImNhbm5vdCBzdGF0
ICVzIiwgbG9ja2ZpbGUpOworICAgICAgICAgICAgZ290byBvdXQ7CisgICAgICAgIH0KKyAgICB9
IGVsc2UgeworICAgICAgICBpZiAoc3RhYi5zdF9kZXYgPT0gZnN0YWIuc3RfZGV2ICYmIHN0YWIu
c3RfaW5vID09IGZzdGFiLnN0X2lubykgeworICAgICAgICAgICAgLyogV2UgaGVsZCB0aGUgbG9j
ayAqLworICAgICAgICAgICAgbG9jay0+aGVsZCA9IHRydWU7CisgICAgICAgICAgICByYyA9IDA7
CisgICAgICAgICAgICBnb3RvIG91dDsKKyAgICAgICAgfQorICAgIH0KKworICAgIC8qIFdlIGRp
ZG4ndCBncmFiIHRoZSBsb2NrLCBsZXQncyB0cnkgYWdhaW4gKi8KKyAgICBmbG9jayhsb2NrLT5m
ZCwgTE9DS19VTik7CisgICAgY2xvc2UobG9jay0+ZmQpOworICAgIGxvY2stPmZkID0gLTE7Cisg
ICAgZXZfbG9ja19wcmVwYXJlX2ZvcmsoZWdjLCBsb2NrKTsKKyAgICByZXR1cm47CisKK291dDoK
KyAgICBpZiAobG9jay0+aGVsZCkgeworICAgICAgICAvKiBDaGVjayB0aGUgZG9tYWluIGlzIHN0
aWxsIHRoZXJlLCBpZiBub3Qgd2Ugc2hvdWxkIHJlbGVhc2UgdGhlCisgICAgICAgICAqIGxvY2sg
YW5kIGNsZWFuIHVwLiAgKi8KKyAgICAgICAgaWYgKGxpYnhsX2RvbWFpbl9pbmZvKENUWCwgTlVM
TCwgZG9taWQpKQorICAgICAgICAgICAgcmMgPSBFUlJPUl9MT0NLX0ZBSUw7CisgICAgfQorICAg
IGlmIChyYykgeworICAgICAgICBMT0dEKEVSUk9SLCBkb21pZCwgIkZhaWxlZCB0byBncmFiIHFt
cC1sb2NrIik7CisgICAgICAgIGxpYnhsX19ldl91bmxvY2soZ2MsIGxvY2spOworICAgIH0KKyAg
ICBsb2NrLT5jYWxsYmFjayhlZ2MsIGxvY2ssIHJjKTsKK30KKwordm9pZCBsaWJ4bF9fZXZfdW5s
b2NrKGxpYnhsX19nYyAqZ2MsIGxpYnhsX19ldl9sb2NrICpsb2NrKQoreworICAgIGludCByOwor
CisgICAgYXNzZXJ0KCFsaWJ4bF9fZXZfY2hpbGRfaW51c2UoJmxvY2stPmNoaWxkKSk7CisKKyAg
ICAvKiBJdCdzIGltcG9ydGFudCB0byB1bmxpbmsgdGhlIGZpbGUgYmVmb3JlIHJlbGVhc2luZyB0
aGUgbG9jayB0byBhdm9pZAorICAgICAqIHRoZSBmb2xsb3dpbmcgcmFjZSAoaWYgdW5sb2NrL2Ns
b3NlIGJlZm9yZSB1bmxpbmspOgorICAgICAqCisgICAgICogICBQMSBMT0NLICAgICAgICAgICAg
ICAgICAgICAgICAgIFAyIFVOTE9DSworICAgICAqICAgZmQxID0gb3Blbihsb2NrZmlsZSkKKyAg
ICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5sb2NrKGZkMikKKyAgICAg
KiAgIGZsb2NrKGZkMSkKKyAgICAgKiAgIGZzdGF0IGFuZCBzdGF0IGNoZWNrIHN1Y2Nlc3MKKyAg
ICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5saW5rKGxvY2tmaWxlKQor
ICAgICAqICAgcmV0dXJuIGxvY2sKKyAgICAgKgorICAgICAqIEluIGFib3ZlIGNhc2UgUDEgdGhp
bmtzIGl0IGhhcyBnb3QgaG9sZCBvZiB0aGUgbG9jayBidXQKKyAgICAgKiBhY3R1YWxseSBsb2Nr
IGlzIHJlbGVhc2VkIGJ5IFAyIChsb2NrZmlsZSB1bmxpbmtlZCkuCisgICAgICovCisgICAgaWYg
KGxvY2stPnBhdGggJiYgbG9jay0+aGVsZCkKKyAgICAgICAgdW5saW5rKGxvY2stPnBhdGgpOwor
CisgICAgaWYgKGxvY2stPmZkID49IDApIHsKKyAgICAgICAgLyogV2UgbmVlZCB0byBjYWxsIHVu
bG9jayBhcyB0aGUgZmQgbWF5IGhhdmUgbGVha2VkIGludG8gb3RoZXIKKyAgICAgICAgICogcHJv
Y2Vzc2VzICovCisgICAgICAgIHIgPSBmbG9jayhsb2NrLT5mZCwgTE9DS19VTik7CisgICAgICAg
IGlmIChyKQorICAgICAgICAgICAgTE9HRUQoRVJST1IsIGxvY2stPmRvbWlkLCAiZmFpbGVkIHRv
IHVubG9jayBmZD0lZCwgcGF0aD0lcyIsCisgICAgICAgICAgICAgICAgICBsb2NrLT5mZCwgbG9j
ay0+cGF0aCk7CisgICAgICAgIGNsb3NlKGxvY2stPmZkKTsKKyAgICB9CisgICAgZnJlZShsb2Nr
LT5wYXRoKTsKKyAgICBsaWJ4bF9fZXZfbG9ja19pbml0KGxvY2spOworfQorCiAvKgogICogTG9j
YWwgdmFyaWFibGVzOgogICogbW9kZTogQwpkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGlieGxf
aW50ZXJuYWwuaCBiL3Rvb2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmgKaW5kZXggY2E3MjA2YWFh
Yy4uMmMyNDc2YjU1YiAxMDA2NDQKLS0tIGEvdG9vbHMvbGlieGwvbGlieGxfaW50ZXJuYWwuaAor
KysgYi90b29scy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5oCkBAIC0xOTQsNiArMTk0LDcgQEAgdHlw
ZWRlZiBzdHJ1Y3QgbGlieGxfX29zZXZlbnRfaG9va19uZXh1cyBsaWJ4bF9fb3NldmVudF9ob29r
X25leHVzOwogdHlwZWRlZiBzdHJ1Y3QgbGlieGxfX29zZXZlbnRfaG9va19uZXhpIGxpYnhsX19v
c2V2ZW50X2hvb2tfbmV4aTsKIHR5cGVkZWYgc3RydWN0IGxpYnhsX19qc29uX29iamVjdCBsaWJ4
bF9fanNvbl9vYmplY3Q7CiB0eXBlZGVmIHN0cnVjdCBsaWJ4bF9fY2FyZWZkIGxpYnhsX19jYXJl
ZmQ7Cit0eXBlZGVmIHN0cnVjdCBsaWJ4bF9fZXZfbG9jayBsaWJ4bF9fZXZfbG9jazsKIAogdHlw
ZWRlZiBzdHJ1Y3QgbGlieGxfX2RvbWFpbl9jcmVhdGVfc3RhdGUgbGlieGxfX2RvbWFpbl9jcmVh
dGVfc3RhdGU7CiB0eXBlZGVmIHZvaWQgbGlieGxfX2RvbWFpbl9jcmVhdGVfY2Ioc3RydWN0IGxp
YnhsX19lZ2MgKmVnYywKQEAgLTI3MjMsMTEgKzI3MjQsMTEgQEAgc3RydWN0IGxpYnhsX19tdWx0
aWRldiB7CiAgKiBkZXZpY2UgaW5mb3JtYXRpb24sIGluIEpTT04gZmlsZXMsIHNvIHRoYXQgd2Ug
Y2FuIHVzZSB0aGlzIEpTT04KICAqIGZpbGUgYXMgYSB0ZW1wbGF0ZSB0byByZWNvbnN0cnVjdCBk
b21haW4gY29uZmlndXJhdGlvbi4KICAqCi0gKiBJbiBlc3NlbnNlIHRoZXJlIGFyZSBub3cgdHdv
IHZpZXdzIG9mIGRldmljZSBzdGF0ZSwgb25lIGlzIHhlbnN0b3JlLAotICogdGhlIG90aGVyIGlz
IEpTT04gZmlsZS4gV2UgdXNlIHhlbnN0b3JlIGFzIHByaW1hcnkgcmVmZXJlbmNlLgorICogSW4g
ZXNzZW5zZSB0aGVyZSBhcmUgbm93IHR3byB2aWV3cyBvZiBkZXZpY2Ugc3RhdGUsIG9uZSBpcyB0
aGUKKyAqIHByaW1hcnkgY29uZmlnICh4ZW5zdG9yZSBvciBRRU1VKSwgdGhlIG90aGVyIGlzIEpT
T04gZmlsZS4KICAqCi0gKiBIZXJlIHdlIG1haW50YWluIG9uZSBpbnZhcmlhbnQ6IGV2ZXJ5IGRl
dmljZSBpbiB4ZW5zdG9yZSBtdXN0IGhhdmUKLSAqIGFuIGVudHJ5IGluIEpTT04gZmlsZS4KKyAq
IEhlcmUgd2UgbWFpbnRhaW4gb25lIGludmFyaWFudDogZXZlcnkgZGV2aWNlIGluIHRoZSBwcmlt
YXJ5IGNvbmZpZworICogbXVzdCBoYXZlIGFuIGVudHJ5IGluIEpTT04gZmlsZS4KICAqCiAgKiBB
bGwgZGV2aWNlIGhvdHBsdWcgcm91dGluZXMgc2hvdWxkIGNvbXBseSB0byBmb2xsb3dpbmcgcGF0
dGVybjoKICAqICAgbG9jayBqc29uIGNvbmZpZyAoanNvbl9sb2NrKQpAQCAtMjc0Miw2ICsyNzQz
LDI0IEBAIHN0cnVjdCBsaWJ4bF9fbXVsdGlkZXYgewogICogICAgICAgZW5kIGZvciBsb29wCiAg
KiAgIHVubG9jayBqc29uIGNvbmZpZwogICoKKyAqIE9yIGluIGNhc2UgUUVNVSBpcyB0aGUgcHJp
bWFyeSBjb25maWcsIHRoaXMgcGF0dGVybiBjYW4gYmUgdXNlOgorICogICBxbXBfbG9jayAobGli
eGxfX2V2X2xvY2spCisgKiAgICAgIGxvY2sganNvbiBjb25maWcgKGpzb25fbG9jaykKKyAqICAg
ICAgICAgIHJlYWQganNvbiBjb25maWcKKyAqICAgICAgICAgIHVwZGF0ZSBpbi1tZW1vcnkganNv
biBjb25maWcgd2l0aCBuZXcgZW50cnksIHJlcGxhY2luZworICogICAgICAgICAgICAgYW55IHN0
YWxlIGVudHJ5CisgKiAgICAgIHVubG9jayBqc29uIGNvbmZpZworICogICAgICBhcHBseSBuZXcg
Y29uZmlnIHRvIHByaW1hcnkgY29uZmlnCisgKiAgICAgIGxvY2sganNvbiBjb25maWcgKGpzb25f
bG9jaykKKyAqICAgICAgICAgIHJlYWQganNvbiBjb25maWcKKyAqICAgICAgICAgIHVwZGF0ZSBp
bi1tZW1vcnkganNvbiBjb25maWcgd2l0aCBuZXcgZW50cnksIHJlcGxhY2luZworICogICAgICAg
ICAgICAgYW55IHN0YWxlIGVudHJ5CisgKiAgICAgICAgICB3cml0ZSBpbi1tZW1vcnkganNvbiBj
b25maWcgdG8gZGlzaworICogICAgICB1bmxvY2sganNvbiBjb25maWcKKyAqICAgdW5sb2NrIHFt
cF9sb2NrCisgKiAgIChDVFhfTE9DSyBjYW4gYmUgYWNxdWlyZWQgYW5kIHJlbGVhc2VkIHNldmVy
YWwgdGltZSB3aGlsZSBob2xkaW5nIHRoZQorICogICAgcW1wX2xvY2spCisgKgogICogRGV2aWNl
IHJlbW92YWwgcm91dGluZXMgYXJlIG5vdCB0b3VjaGVkLgogICoKICAqIEhlcmUgaXMgdGhlIHBy
b29mIHRoYXQgd2UgYWx3YXlzIG1haW50YWluIHRoYXQgaW52YXJpYW50IGFuZCB3ZQpAQCAtNDYw
MCw2ICs0NjE5LDU1IEBAIHN0YXRpYyBpbmxpbmUgY29uc3QgY2hhciAqbGlieGxfX3FlbXVfcW1w
X3BhdGgobGlieGxfX2djICpnYywgaW50IGRvbWlkKQogewogICAgIHJldHVybiBHQ1NQUklOVEYo
IiVzL3FtcC1saWJ4bC0lZCIsIGxpYnhsX19ydW5fZGlyX3BhdGgoKSwgZG9taWQpOwogfQorCisv
KgorICogTG9jayBmb3IgZGV2aWNlIGhvdHBsdWcsIHFtcF9sb2NrLgorICoKKyAqIGxpYnhsX19l
dl9sb2NrIGltcGxlbWVudCBhIGxvY2sgdGhhdCBpcyBvdXRzaWRlIG9mIENUWF9MT0NLIGluIHRo
ZQorICogbG9jayBoaWVyYXJjaHkuIEl0IGNhbiBiZSB1c2VkIHdoZW4gb25lIHdhbnQgdG8gbWFr
ZSBRTVAgY2FsbHMgdG8gUUVNVSwKKyAqIHdoaWNoIG1heSB0YWtlIGEgc2lnbmlmaWNhbnQgYW1v
dW50IHRpbWUuCisgKiBJdCBpcyB0byBiZSBhY3F1aXJlZCBieSBhbiBhbyBldmVudCBjYWxsYmFj
ay4KKyAqCisgKiBJdCBpcyB0byBiZSBhY3F1aXJlZCB3aGVuIGFkZGluZy9yZW1vdmluZyBkZXZp
Y2VzIG9yIG1ha2luZyBjaGFuZ2VzCisgKiB0byB0aGVtIHdoZW4gdGhpcyBpcyBhIHNsb3cgb3Bl
cmF0aW9uIGFuZCBqc29uX2xvY2sgaXNuJ3QgYXBwcm9wcmlhdGUuCisgKgorICogUG9zc2libGUg
c3RhdGVzIG9mIGxpYnhsX19ldl9sb2NrOgorICogICBVbmRlZmluZWQKKyAqICAgIE1pZ2h0IGNv
bnRhaW4gYW55dGhpbmcuCisgKiAgSWRsZQorICogICAgU3RydWN0IGNvbnRlbnRzIGFyZSBkZWZp
bmVkIGVub3VnaCB0byBwYXNzIHRvIGFueQorICogICAgbGlieGxfX2V2X2xvY2tfKiBmdW5jdGlv
bi4KKyAqICAgIFRoZSBzdHJ1Y3QgZG9lcyBub3QgY29udGFpbiByZWZlcmVuY2VzIHRvIGFueSBh
bGxvY2F0ZWQgcHJpdmF0ZQorICogICAgcmVzb3VyY2VzIHNvIGNhbiBiZSB0aHJvd24gYXdheS4K
KyAqICBBY3RpdmUKKyAqICAgIFdhaXRpbmcgdG8gZ2V0IGEgbG9jay4KKyAqICAgIE5lZWRzIHRv
IHdhaXQgdW50aWwgdGhlIGNhbGxiYWNrIGlzIGNhbGxlZC4KKyAqICBMb2NrQWNxdWlyZWQKKyAq
ICAgIGxpYnhsX19ldl91bmxvY2sgd2lsbCBuZWVkIHRvIGJlIGNhbGxlZCB0byByZWxlYXNlIHRo
ZSBsb2NrIGFuZCB0aGUKKyAqICAgIHJlc291cmNlcyBvZiBsaWJ4bF9fZXZfbG9jay4KKyAqCisg
KiAgbGlieGxfX2V2X2xvY2tfaW5pdDogVW5kZWZpbmVkL0lkbGUgLT4gSWRsZQorICogIGxpYnhs
X19ldl9sb2NrX2dldDogIElkbGUgLT4gQWN0aXZlCisgKiAgICAgIE1heSBjYWxsIGNhbGxiYWNr
IHN5bmNocm9ub3VzbHkuCisgKiAgbGlieGxfX2V2X3VubG9jazogICAgTG9ja0FjcXVpcmVkL0lk
bGUgLT4gSWRsZQorICogIGNhbGxiYWNrOiAgICAgV2hlbiBjYWxsZWQ6IEFjdGl2ZSAtPiBMb2Nr
QWNxdWlyZWQgKG9uIGVycm9yOiBJZGxlKQorICogICAgVGhlIGNhbGxiYWNrIGlzIG9ubHkgY2Fs
bGVkIG9uY2UuCisgKi8KK3N0cnVjdCBsaWJ4bF9fZXZfbG9jayB7CisgICAgLyogZmlsbGVkIGJ5
IHVzZXIgKi8KKyAgICBsaWJ4bF9fYW8gKmFvOworICAgIGxpYnhsX2RvbWlkIGRvbWlkOworICAg
IHZvaWQgKCpjYWxsYmFjaykobGlieGxfX2VnYyAqLCBsaWJ4bF9fZXZfbG9jayAqLCBpbnQgcmMp
OworICAgIC8qIHByaXZhdGUgdG8gbGlieGxfX2V2X2xvY2sqICovCisgICAgbGlieGxfX2V2X2No
aWxkIGNoaWxkOworICAgIGNoYXIgKnBhdGg7IC8qIHBhdGggb2YgdGhlIGxvY2sgZmlsZSBpdHNl
bGYgKi8KKyAgICBpbnQgZmQ7CisgICAgYm9vbCBoZWxkOworfTsKK19oaWRkZW4gdm9pZCBsaWJ4
bF9fZXZfbG9ja19pbml0KGxpYnhsX19ldl9sb2NrICopOworX2hpZGRlbiB2b2lkIGxpYnhsX19l
dl9sb2NrX2dldChsaWJ4bF9fZWdjICosIGxpYnhsX19ldl9sb2NrICopOworX2hpZGRlbiB2b2lk
IGxpYnhsX19ldl91bmxvY2sobGlieGxfX2djICosIGxpYnhsX19ldl9sb2NrICopOworCiAjZW5k
aWYKIAogLyoKLS0gCkFudGhvbnkgUEVSQVJECgoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlz
dHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xp
c3RpbmZvL3hlbi1kZXZlbA==

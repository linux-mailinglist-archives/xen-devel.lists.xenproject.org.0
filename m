Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 2B2E4BFFBD
	for <lists+xen-devel@lfdr.de>; Fri, 27 Sep 2019 09:05:53 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iDkGf-0004cP-BJ; Fri, 27 Sep 2019 07:02:17 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=Rbpq=XW=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1iDkGd-0004ZU-5T
 for xen-devel@lists.xenproject.org; Fri, 27 Sep 2019 07:02:15 +0000
X-Inumbo-ID: 92d1405f-e0f4-11e9-966c-12813bfff9fa
Received: from mx1.suse.de (unknown [195.135.220.15])
 by localhost (Halon) with ESMTPS
 id 92d1405f-e0f4-11e9-966c-12813bfff9fa;
 Fri, 27 Sep 2019 07:01:07 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 12726B17E;
 Fri, 27 Sep 2019 07:01:04 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Fri, 27 Sep 2019 09:00:35 +0200
Message-Id: <20190927070050.12405-32-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190927070050.12405-1-jgross@suse.com>
References: <20190927070050.12405-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v4 31/46] xen/sched: modify
 cpupool_domain_cpumask() to be an unit mask
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Tim Deegan <tim@xen.org>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>,
 Robert VanVossen <robert.vanvossen@dornerworks.com>,
 Dario Faggioli <dfaggioli@suse.com>, Julien Grall <julien.grall@arm.com>,
 Josh Whitehead <josh.whitehead@dornerworks.com>,
 Meng Xu <mengxu@cis.upenn.edu>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

Y3B1cG9vbF9kb21haW5fY3B1bWFzaygpIGlzIHVzZWQgYnkgc2NoZWR1bGluZyB0byBzZWxlY3Qg
Y3B1cyBvciB0bwppdGVyYXRlIG92ZXIgY3B1cy4gSW4gb3JkZXIgdG8gc3VwcG9ydCBzY2hlZHVs
aW5nIHVuaXRzIHNwYW5uaW5nCm11bHRpcGxlIGNwdXMgcmVuYW1lIGNwdXBvb2xfZG9tYWluX2Nw
dW1hc2soKSB0bwpjcHVwb29sX2RvbWFpbl9tYXN0ZXJfY3B1bWFzaygpIGFuZCBsZXQgaXQgcmV0
dXJuIGEgY3B1bWFzayB3aXRoIG9ubHkKb25lIGJpdCBzZXQgcGVyIHNjaGVkdWxpbmcgcmVzb3Vy
Y2UuCgpTaWduZWQtb2ZmLWJ5OiBKdWVyZ2VuIEdyb3NzIDxqZ3Jvc3NAc3VzZS5jb20+Ci0tLQpW
NDoKLSByZW5hbWUgdG8gY3B1cG9vbF9kb21haW5fbWFzdGVyX2NwdW1hc2soKSAoSmFuIEJldWxp
Y2gpCi0gY2hlY2sgcmV0dXJuIHZhbHVlIG9mIHphbGxvY19jcHVtYXNrX3ZhcigpIChKYW4gQmV1
bGljaCkKLS0tCiB4ZW4vY29tbW9uL2NwdXBvb2wuYyAgICAgICAgfCAyNyArKysrKysrKysrKysr
KysrKystLS0tLS0tLS0KIHhlbi9jb21tb24vZG9tYWluLmMgICAgICAgICB8ICAyICstCiB4ZW4v
Y29tbW9uL2RvbWN0bC5jICAgICAgICAgfCAgMiArLQogeGVuL2NvbW1vbi9zY2hlZF9hcmluYzY1
My5jIHwgIDIgKy0KIHhlbi9jb21tb24vc2NoZWRfY3JlZGl0LmMgICB8ICA0ICsrLS0KIHhlbi9j
b21tb24vc2NoZWRfY3JlZGl0Mi5jICB8IDIyICsrKysrKysrKysrLS0tLS0tLS0tLS0KIHhlbi9j
b21tb24vc2NoZWRfbnVsbC5jICAgICB8ICA4ICsrKystLS0tCiB4ZW4vY29tbW9uL3NjaGVkX3J0
LmMgICAgICAgfCAgOCArKysrLS0tLQogeGVuL2NvbW1vbi9zY2hlZHVsZS5jICAgICAgIHwgMTMg
KysrKysrKy0tLS0tLQogeGVuL2luY2x1ZGUveGVuL3NjaGVkLWlmLmggIHwgIDkgKysrKysrLS0t
CiAxMCBmaWxlcyBjaGFuZ2VkLCA1NSBpbnNlcnRpb25zKCspLCA0MiBkZWxldGlvbnMoLSkKCmRp
ZmYgLS1naXQgYS94ZW4vY29tbW9uL2NwdXBvb2wuYyBiL3hlbi9jb21tb24vY3B1cG9vbC5jCmlu
ZGV4IGZkMzAwNDA5MjIuLjQ0MWEyNmYxNmMgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vY3B1cG9v
bC5jCisrKyBiL3hlbi9jb21tb24vY3B1cG9vbC5jCkBAIC0zNiwyNiArMzYsMzMgQEAgc3RhdGlj
IERFRklORV9TUElOTE9DSyhjcHVwb29sX2xvY2spOwogCiBERUZJTkVfUEVSX0NQVShzdHJ1Y3Qg
Y3B1cG9vbCAqLCBjcHVwb29sKTsKIAorc3RhdGljIHZvaWQgZnJlZV9jcHVwb29sX3N0cnVjdChz
dHJ1Y3QgY3B1cG9vbCAqYykKK3sKKyAgICBpZiAoIGMgKQorICAgIHsKKyAgICAgICAgZnJlZV9j
cHVtYXNrX3ZhcihjLT5yZXNfdmFsaWQpOworICAgICAgICBmcmVlX2NwdW1hc2tfdmFyKGMtPmNw
dV92YWxpZCk7CisgICAgfQorICAgIHhmcmVlKGMpOworfQorCiBzdGF0aWMgc3RydWN0IGNwdXBv
b2wgKmFsbG9jX2NwdXBvb2xfc3RydWN0KHZvaWQpCiB7CiAgICAgc3RydWN0IGNwdXBvb2wgKmMg
PSB4emFsbG9jKHN0cnVjdCBjcHVwb29sKTsKIAotICAgIGlmICggIWMgfHwgIXphbGxvY19jcHVt
YXNrX3ZhcigmYy0+Y3B1X3ZhbGlkKSApCisgICAgaWYgKCAhYyApCisgICAgICAgIHJldHVybiBO
VUxMOworCisgICAgaWYgKCAhemFsbG9jX2NwdW1hc2tfdmFyKCZjLT5jcHVfdmFsaWQpIHx8Cisg
ICAgICAgICAhemFsbG9jX2NwdW1hc2tfdmFyKCZjLT5yZXNfdmFsaWQpICkKICAgICB7Ci0gICAg
ICAgIHhmcmVlKGMpOworICAgICAgICBmcmVlX2NwdXBvb2xfc3RydWN0KGMpOwogICAgICAgICBj
ID0gTlVMTDsKICAgICB9CiAKICAgICByZXR1cm4gYzsKIH0KIAotc3RhdGljIHZvaWQgZnJlZV9j
cHVwb29sX3N0cnVjdChzdHJ1Y3QgY3B1cG9vbCAqYykKLXsKLSAgICBpZiAoIGMgKQotICAgICAg
ICBmcmVlX2NwdW1hc2tfdmFyKGMtPmNwdV92YWxpZCk7Ci0gICAgeGZyZWUoYyk7Ci19Ci0KIC8q
CiAgKiBmaW5kIGEgY3B1cG9vbCBieSBpdCdzIGlkLiB0byBiZSBjYWxsZWQgd2l0aCBjcHVwb29s
IGxvY2sgaGVsZAogICogaWYgZXhhY3QgaXMgbm90IHNwZWNpZmllZCwgdGhlIGZpcnN0IGNwdXBv
b2wgd2l0aCBhbiBpZCBsYXJnZXIgb3IgZXF1YWwgdG8KQEAgLTI2OSw2ICsyNzYsNyBAQCBzdGF0
aWMgaW50IGNwdXBvb2xfYXNzaWduX2NwdV9sb2NrZWQoc3RydWN0IGNwdXBvb2wgKmMsIHVuc2ln
bmVkIGludCBjcHUpCiAgICAgICAgIGNwdXBvb2xfY3B1X21vdmluZyA9IE5VTEw7CiAgICAgfQog
ICAgIGNwdW1hc2tfc2V0X2NwdShjcHUsIGMtPmNwdV92YWxpZCk7CisgICAgY3B1bWFza19hbmQo
Yy0+cmVzX3ZhbGlkLCBjLT5jcHVfdmFsaWQsIHNjaGVkX3Jlc19tYXNrKTsKIAogICAgIHJjdV9y
ZWFkX2xvY2soJmRvbWxpc3RfcmVhZF9sb2NrKTsKICAgICBmb3JfZWFjaF9kb21haW5faW5fY3B1
cG9vbChkLCBjKQpAQCAtMzYxLDYgKzM2OSw3IEBAIHN0YXRpYyBpbnQgY3B1cG9vbF91bmFzc2ln
bl9jcHVfc3RhcnQoc3RydWN0IGNwdXBvb2wgKmMsIHVuc2lnbmVkIGludCBjcHUpCiAgICAgYXRv
bWljX2luYygmYy0+cmVmY250KTsKICAgICBjcHVwb29sX2NwdV9tb3ZpbmcgPSBjOwogICAgIGNw
dW1hc2tfY2xlYXJfY3B1KGNwdSwgYy0+Y3B1X3ZhbGlkKTsKKyAgICBjcHVtYXNrX2FuZChjLT5y
ZXNfdmFsaWQsIGMtPmNwdV92YWxpZCwgc2NoZWRfcmVzX21hc2spOwogCiBvdXQ6CiAgICAgc3Bp
bl91bmxvY2soJmNwdXBvb2xfbG9jayk7CmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL2RvbWFpbi5j
IGIveGVuL2NvbW1vbi9kb21haW4uYwppbmRleCBlYTEyMjUzNjdkLi4wOTc5MmYwZGI4IDEwMDY0
NAotLS0gYS94ZW4vY29tbW9uL2RvbWFpbi5jCisrKyBiL3hlbi9jb21tb24vZG9tYWluLmMKQEAg
LTU4NCw3ICs1ODQsNyBAQCB2b2lkIGRvbWFpbl91cGRhdGVfbm9kZV9hZmZpbml0eShzdHJ1Y3Qg
ZG9tYWluICpkKQogICAgICAgICByZXR1cm47CiAgICAgfQogCi0gICAgb25saW5lID0gY3B1cG9v
bF9kb21haW5fY3B1bWFzayhkKTsKKyAgICBvbmxpbmUgPSBjcHVwb29sX2RvbWFpbl9tYXN0ZXJf
Y3B1bWFzayhkKTsKIAogICAgIHNwaW5fbG9jaygmZC0+bm9kZV9hZmZpbml0eV9sb2NrKTsKIApk
aWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9kb21jdGwuYyBiL3hlbi9jb21tb24vZG9tY3RsLmMKaW5k
ZXggOGE2OTRlMGQzNy4uZDU5N2EwOWY5OCAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9kb21jdGwu
YworKysgYi94ZW4vY29tbW9uL2RvbWN0bC5jCkBAIC02MTksNyArNjE5LDcgQEAgbG9uZyBkb19k
b21jdGwoWEVOX0dVRVNUX0hBTkRMRV9QQVJBTSh4ZW5fZG9tY3RsX3QpIHVfZG9tY3RsKQogICAg
ICAgICBpZiAoIG9wLT5jbWQgPT0gWEVOX0RPTUNUTF9zZXR2Y3B1YWZmaW5pdHkgKQogICAgICAg
ICB7CiAgICAgICAgICAgICBjcHVtYXNrX3Zhcl90IG5ld19hZmZpbml0eSwgb2xkX2FmZmluaXR5
OwotICAgICAgICAgICAgY3B1bWFza190ICpvbmxpbmUgPSBjcHVwb29sX2RvbWFpbl9jcHVtYXNr
KHYtPmRvbWFpbik7CisgICAgICAgICAgICBjcHVtYXNrX3QgKm9ubGluZSA9IGNwdXBvb2xfZG9t
YWluX21hc3Rlcl9jcHVtYXNrKHYtPmRvbWFpbik7CiAKICAgICAgICAgICAgIC8qCiAgICAgICAg
ICAgICAgKiBXZSB3YW50IHRvIGJlIGFibGUgdG8gcmVzdG9yZSBoYXJkIGFmZmluaXR5IGlmIHdl
IGFyZSB0cnlpbmcKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vc2NoZWRfYXJpbmM2NTMuYyBiL3hl
bi9jb21tb24vc2NoZWRfYXJpbmM2NTMuYwppbmRleCBkZDU4NzZlYWNkLi40NWMwNWM2Y2Q5IDEw
MDY0NAotLS0gYS94ZW4vY29tbW9uL3NjaGVkX2FyaW5jNjUzLmMKKysrIGIveGVuL2NvbW1vbi9z
Y2hlZF9hcmluYzY1My5jCkBAIC02MTQsNyArNjE0LDcgQEAgYTY1M3NjaGVkX3BpY2tfcmVzb3Vy
Y2UoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAgICAqIElmIHByZXNlbnQsIHByZWZl
ciB1bml0J3MgY3VycmVudCBwcm9jZXNzb3IsIGVsc2UKICAgICAgKiBqdXN0IGZpbmQgdGhlIGZp
cnN0IHZhbGlkIHVuaXQuCiAgICAgICovCi0gICAgb25saW5lID0gY3B1cG9vbF9kb21haW5fY3B1
bWFzayh1bml0LT5kb21haW4pOworICAgIG9ubGluZSA9IGNwdXBvb2xfZG9tYWluX21hc3Rlcl9j
cHVtYXNrKHVuaXQtPmRvbWFpbik7CiAKICAgICBjcHUgPSBjcHVtYXNrX2ZpcnN0KG9ubGluZSk7
CiAKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0LmMgYi94ZW4vY29tbW9uL3Nj
aGVkX2NyZWRpdC5jCmluZGV4IDAwYmVhYzNlYTQuLmE2ZGZmOGVjNjIgMTAwNjQ0Ci0tLSBhL3hl
bi9jb21tb24vc2NoZWRfY3JlZGl0LmMKKysrIGIveGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQuYwpA
QCAtMzYxLDcgKzM2MSw3IEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBfX3J1bnFfdGlja2xlKHN0cnVj
dCBjc2NoZWRfdW5pdCAqbmV3KQogICAgIEFTU0VSVChjdXIpOwogICAgIGNwdW1hc2tfY2xlYXIo
Jm1hc2spOwogCi0gICAgb25saW5lID0gY3B1cG9vbF9kb21haW5fY3B1bWFzayhuZXctPnNkb20t
PmRvbSk7CisgICAgb25saW5lID0gY3B1cG9vbF9kb21haW5fbWFzdGVyX2NwdW1hc2sobmV3LT5z
ZG9tLT5kb20pOwogICAgIGNwdW1hc2tfYW5kKCZpZGxlX21hc2ssIHBydi0+aWRsZXJzLCBvbmxp
bmUpOwogICAgIGlkbGVyc19lbXB0eSA9IGNwdW1hc2tfZW1wdHkoJmlkbGVfbWFzayk7CiAKQEAg
LTcyNCw3ICs3MjQsNyBAQCBfY3NjaGVkX2NwdV9waWNrKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIg
Km9wcywgY29uc3Qgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQsCiAgICAgLyogV2UgbXVzdCBhbHdh
eXMgdXNlIGNwdSdzIHNjcmF0Y2ggc3BhY2UgKi8KICAgICBjcHVtYXNrX3QgKmNwdXMgPSBjcHVt
YXNrX3NjcmF0Y2hfY3B1KGNwdSk7CiAgICAgY3B1bWFza190IGlkbGVyczsKLSAgICBjcHVtYXNr
X3QgKm9ubGluZSA9IGNwdXBvb2xfZG9tYWluX2NwdW1hc2sodW5pdC0+ZG9tYWluKTsKKyAgICBj
cHVtYXNrX3QgKm9ubGluZSA9IGNwdXBvb2xfZG9tYWluX21hc3Rlcl9jcHVtYXNrKHVuaXQtPmRv
bWFpbik7CiAgICAgc3RydWN0IGNzY2hlZF9wY3B1ICpzcGMgPSBOVUxMOwogICAgIGludCBiYWxh
bmNlX3N0ZXA7CiAKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0Mi5jIGIveGVu
L2NvbW1vbi9zY2hlZF9jcmVkaXQyLmMKaW5kZXggMGUyOWU1NmQ1YS4uZDUxZGYwNTg4NyAxMDA2
NDQKLS0tIGEveGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQyLmMKKysrIGIveGVuL2NvbW1vbi9zY2hl
ZF9jcmVkaXQyLmMKQEAgLTcwNSw3ICs3MDUsNyBAQCBzdGF0aWMgaW50IGdldF9mYWxsYmFja19j
cHUoc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQogCiAgICAgICAgIGFmZmluaXR5X2JhbGFuY2Vf
Y3B1bWFzayh1bml0LCBicywgY3B1bWFza19zY3JhdGNoX2NwdShjcHUpKTsKICAgICAgICAgY3B1
bWFza19hbmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNw
dSksCi0gICAgICAgICAgICAgICAgICAgIGNwdXBvb2xfZG9tYWluX2NwdW1hc2sodW5pdC0+ZG9t
YWluKSk7CisgICAgICAgICAgICAgICAgICAgIGNwdXBvb2xfZG9tYWluX21hc3Rlcl9jcHVtYXNr
KHVuaXQtPmRvbWFpbikpOwogCiAgICAgICAgIC8qCiAgICAgICAgICAqIFRoaXMgaXMgY2FzZXMg
MSBvciAzIChkZXBlbmRpbmcgb24gYnMpOiBpZiBwcm9jZXNzb3IgaXMgKHN0aWxsKQpAQCAtMTQ0
MCw3ICsxNDQwLDcgQEAgcnVucV90aWNrbGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBz
dHJ1Y3QgY3NjaGVkMl91bml0ICpuZXcsIHNfdGltZV90IG5vdykKICAgICBzdHJ1Y3Qgc2NoZWRf
dW5pdCAqdW5pdCA9IG5ldy0+dW5pdDsKICAgICB1bnNpZ25lZCBpbnQgYnMsIGNwdSA9IHNjaGVk
X3VuaXRfbWFzdGVyKHVuaXQpOwogICAgIHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJx
ZCA9IGMycnFkKG9wcywgY3B1KTsKLSAgICBjcHVtYXNrX3QgKm9ubGluZSA9IGNwdXBvb2xfZG9t
YWluX2NwdW1hc2sodW5pdC0+ZG9tYWluKTsKKyAgICBjcHVtYXNrX3QgKm9ubGluZSA9IGNwdXBv
b2xfZG9tYWluX21hc3Rlcl9jcHVtYXNrKHVuaXQtPmRvbWFpbik7CiAgICAgY3B1bWFza190IG1h
c2s7CiAKICAgICBBU1NFUlQobmV3LT5ycWQgPT0gcnFkKTsKQEAgLTIyNDMsNyArMjI0Myw3IEBA
IGNzY2hlZDJfcmVzX3BpY2soY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBjb25zdCBzdHJ1
Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKICAgICB9CiAKICAgICBjcHVtYXNrX2FuZChjcHVtYXNrX3Nj
cmF0Y2hfY3B1KGNwdSksIHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5LAotICAgICAgICAgICAgICAg
IGNwdXBvb2xfZG9tYWluX2NwdW1hc2sodW5pdC0+ZG9tYWluKSk7CisgICAgICAgICAgICAgICAg
Y3B1cG9vbF9kb21haW5fbWFzdGVyX2NwdW1hc2sodW5pdC0+ZG9tYWluKSk7CiAKICAgICAvKgog
ICAgICAqIEZpcnN0IGNoZWNrIHRvIHNlZSBpZiB3ZSdyZSBoZXJlIGJlY2F1c2Ugc29tZW9uZSBl
bHNlIHN1Z2dlc3RlZCBhIHBsYWNlCkBAIC0yMzU4LDggKzIzNTgsOCBAQCBjc2NoZWQyX3Jlc19w
aWNrKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgY29uc3Qgc3RydWN0IHNjaGVkX3VuaXQg
KnVuaXQpCiAgICAgICAgICAqIG9rIGJlY2F1c2U6CiAgICAgICAgICAqIC0gd2Uga25vdyB0aGF0
IHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5IGFuZCAtPmNwdV9zb2Z0X2FmZmluaXR5IGhhdmUKICAg
ICAgICAgICogICBhIG5vbi1lbXB0eSBpbnRlcnNlY3Rpb24gKGJlY2F1c2UgaGFzX3NvZnQgaXMg
dHJ1ZSk7Ci0gICAgICAgICAqIC0gd2UgaGF2ZSB1bml0LT5jcHVfaGFyZF9hZmZpbml0eSAmIGNw
dXBvb2xfZG9tYWluX2NwdW1hc2soKSBhbHJlYWR5Ci0gICAgICAgICAqICAgaW4gY3B1bWFza19z
Y3JhdGNoLCB3ZSBkbyBzYXZlIGEgbG90IGRvaW5nIGxpa2UgdGhpcy4KKyAgICAgICAgICogLSB3
ZSBoYXZlIHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5ICYgY3B1cG9vbF9kb21haW5fbWFzdGVyX2Nw
dW1hc2soKQorICAgICAgICAgKiAgIGFscmVhZHkgaW4gY3B1bWFza19zY3JhdGNoLCB3ZSBkbyBz
YXZlIGEgbG90IGRvaW5nIGxpa2UgdGhpcy4KICAgICAgICAgICoKICAgICAgICAgICogSXQncyBr
aW5kIG9mIGxpa2Ugb3BlbiBjb2RpbmcgYWZmaW5pdHlfYmFsYW5jZV9jcHVtYXNrKCkgYnV0LCBp
bgogICAgICAgICAgKiB0aGlzIHNwZWNpZmljIGNhc2UsIGNhbGxpbmcgdGhhdCB3b3VsZCBtZWFu
IGEgbG90IG9mICh1bm5lY2Vzc2FyeSkKQEAgLTIzNzgsNyArMjM3OCw3IEBAIGNzY2hlZDJfcmVz
X3BpY2soY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBjb25zdCBzdHJ1Y3Qgc2NoZWRfdW5p
dCAqdW5pdCkKICAgICAgICAgICogYWZmaW5pdHksIHNvIGdvIGZvciBpdC4KICAgICAgICAgICoK
ICAgICAgICAgICogY3B1bWFza19zY3JhdGNoIGFscmVhZHkgaGFzIHVuaXQtPmNwdV9oYXJkX2Fm
ZmluaXR5ICYKLSAgICAgICAgICogY3B1cG9vbF9kb21haW5fY3B1bWFzaygpIGluIGl0LCBzbyBp
dCdzIGVub3VnaCB0aGF0IHdlIGZpbHRlcgorICAgICAgICAgKiBjcHVwb29sX2RvbWFpbl9tYXN0
ZXJfY3B1bWFzaygpIGluIGl0LCBzbyBpdCdzIGVub3VnaCB0aGF0IHdlIGZpbHRlcgogICAgICAg
ICAgKiB3aXRoIHRoZSBjcHVzIG9mIHRoZSBydW5xLgogICAgICAgICAgKi8KICAgICAgICAgY3B1
bWFza19hbmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNw
dSksCkBAIC0yNTEzLDcgKzI1MTMsNyBAQCBzdGF0aWMgdm9pZCBtaWdyYXRlKGNvbnN0IHN0cnVj
dCBzY2hlZHVsZXIgKm9wcywKICAgICAgICAgX3J1bnFfZGVhc3NpZ24oc3ZjKTsKIAogICAgICAg
ICBjcHVtYXNrX2FuZChjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksIHVuaXQtPmNwdV9oYXJkX2Fm
ZmluaXR5LAotICAgICAgICAgICAgICAgICAgICBjcHVwb29sX2RvbWFpbl9jcHVtYXNrKHVuaXQt
PmRvbWFpbikpOworICAgICAgICAgICAgICAgICAgICBjcHVwb29sX2RvbWFpbl9tYXN0ZXJfY3B1
bWFzayh1bml0LT5kb21haW4pKTsKICAgICAgICAgY3B1bWFza19hbmQoY3B1bWFza19zY3JhdGNo
X2NwdShjcHUpLCBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksCiAgICAgICAgICAgICAgICAgICAg
ICZ0cnFkLT5hY3RpdmUpOwogICAgICAgICBzY2hlZF9zZXRfcmVzKHVuaXQsCkBAIC0yNTQ3LDcg
KzI1NDcsNyBAQCBzdGF0aWMgYm9vbCB1bml0X2lzX21pZ3JhdGVhYmxlKHN0cnVjdCBjc2NoZWQy
X3VuaXQgKnN2YywKICAgICBpbnQgY3B1ID0gc2NoZWRfdW5pdF9tYXN0ZXIodW5pdCk7CiAKICAg
ICBjcHVtYXNrX2FuZChjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksIHVuaXQtPmNwdV9oYXJkX2Fm
ZmluaXR5LAotICAgICAgICAgICAgICAgIGNwdXBvb2xfZG9tYWluX2NwdW1hc2sodW5pdC0+ZG9t
YWluKSk7CisgICAgICAgICAgICAgICAgY3B1cG9vbF9kb21haW5fbWFzdGVyX2NwdW1hc2sodW5p
dC0+ZG9tYWluKSk7CiAKICAgICByZXR1cm4gIShzdmMtPmZsYWdzICYgQ1NGTEFHX3J1bnFfbWln
cmF0ZV9yZXF1ZXN0KSAmJgogICAgICAgICAgICBjcHVtYXNrX2ludGVyc2VjdHMoY3B1bWFza19z
Y3JhdGNoX2NwdShjcHUpLCAmcnFkLT5hY3RpdmUpOwpAQCAtMjc2Myw3ICsyNzYzLDcgQEAgY3Nj
aGVkMl91bml0X21pZ3JhdGUoCiAgICAgICogdi0+cHJvY2Vzc29yIHdpbGwgYmUgY2hvc2VuLCBh
bmQgZHVyaW5nIGFjdHVhbCBkb21haW4gdW5wYXVzZSB0aGF0CiAgICAgICogdGhlIHVuaXQgd2ls
bCBiZSBhc3NpZ25lZCB0byBhbmQgYWRkZWQgdG8gdGhlIHByb3BlciBydW5xdWV1ZS4KICAgICAg
Ki8KLSAgICBpZiAoIHVubGlrZWx5KCFjcHVtYXNrX3Rlc3RfY3B1KG5ld19jcHUsIGNwdXBvb2xf
ZG9tYWluX2NwdW1hc2soZCkpKSApCisgICAgaWYgKCB1bmxpa2VseSghY3B1bWFza190ZXN0X2Nw
dShuZXdfY3B1LCBjcHVwb29sX2RvbWFpbl9tYXN0ZXJfY3B1bWFzayhkKSkpICkKICAgICB7CiAg
ICAgICAgIEFTU0VSVChzeXN0ZW1fc3RhdGUgPT0gU1lTX1NUQVRFX3N1c3BlbmQpOwogICAgICAg
ICBpZiAoIHVuaXRfb25fcnVucShzdmMpICkKQEAgLTMwNjksNyArMzA2OSw3IEBAIGNzY2hlZDJf
YWxsb2NfZG9tZGF0YShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBkb21haW4g
KmRvbSkKICAgICBzZG9tLT5ucl91bml0cyA9IDA7CiAKICAgICBpbml0X3RpbWVyKCZzZG9tLT5y
ZXBsX3RpbWVyLCByZXBsZW5pc2hfZG9tYWluX2J1ZGdldCwgc2RvbSwKLSAgICAgICAgICAgICAg
IGNwdW1hc2tfYW55KGNwdXBvb2xfZG9tYWluX2NwdW1hc2soZG9tKSkpOworICAgICAgICAgICAg
ICAgY3B1bWFza19hbnkoY3B1cG9vbF9kb21haW5fbWFzdGVyX2NwdW1hc2soZG9tKSkpOwogICAg
IHNwaW5fbG9ja19pbml0KCZzZG9tLT5idWRnZXRfbG9jayk7CiAgICAgSU5JVF9MSVNUX0hFQUQo
JnNkb20tPnBhcmtlZF91bml0cyk7CiAKQEAgLTMzMTcsNyArMzMxNyw3IEBAIHJ1bnFfY2FuZGlk
YXRlKHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCwKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGNwdW1hc2tfc2NyYXRjaCk7CiAgICAgICAgIGlmICggdW5saWtlbHko
IWNwdW1hc2tfdGVzdF9jcHUoY3B1LCBjcHVtYXNrX3NjcmF0Y2gpKSApCiAgICAgICAgIHsKLSAg
ICAgICAgICAgIGNwdW1hc2tfdCAqb25saW5lID0gY3B1cG9vbF9kb21haW5fY3B1bWFzayhzY3Vy
ci0+dW5pdC0+ZG9tYWluKTsKKyAgICAgICAgICAgIGNwdW1hc2tfdCAqb25saW5lID0gY3B1cG9v
bF9kb21haW5fbWFzdGVyX2NwdW1hc2soc2N1cnItPnVuaXQtPmRvbWFpbik7CiAKICAgICAgICAg
ICAgIC8qIE9rLCBpcyBhbnkgb2YgdGhlIHBjcHVzIGluIHNjdXJyIHNvZnQtYWZmaW5pdHkgaWRs
ZT8gKi8KICAgICAgICAgICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaCwgY3B1bWFza19z
Y3JhdGNoLCAmcnFkLT5pZGxlKTsKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vc2NoZWRfbnVsbC5j
IGIveGVuL2NvbW1vbi9zY2hlZF9udWxsLmMKaW5kZXggM2RkZTFkY2QwMC4uMjUyNTQ2NGE3YyAx
MDA2NDQKLS0tIGEveGVuL2NvbW1vbi9zY2hlZF9udWxsLmMKKysrIGIveGVuL2NvbW1vbi9zY2hl
ZF9udWxsLmMKQEAgLTEyNSw3ICsxMjUsNyBAQCBzdGF0aWMgaW5saW5lIGJvb2wgdW5pdF9jaGVj
a19hZmZpbml0eShzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCwKIHsKICAgICBhZmZpbml0eV9iYWxh
bmNlX2NwdW1hc2sodW5pdCwgYmFsYW5jZV9zdGVwLCBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSkp
OwogICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwgY3B1bWFza19zY3Jh
dGNoX2NwdShjcHUpLAotICAgICAgICAgICAgICAgIGNwdXBvb2xfZG9tYWluX2NwdW1hc2sodW5p
dC0+ZG9tYWluKSk7CisgICAgICAgICAgICAgICAgY3B1cG9vbF9kb21haW5fbWFzdGVyX2NwdW1h
c2sodW5pdC0+ZG9tYWluKSk7CiAKICAgICByZXR1cm4gY3B1bWFza190ZXN0X2NwdShjcHUsIGNw
dW1hc2tfc2NyYXRjaF9jcHUoY3B1KSk7CiB9CkBAIC0yNjYsNyArMjY2LDcgQEAgcGlja19yZXMo
c3RydWN0IG51bGxfcHJpdmF0ZSAqcHJ2LCBjb25zdCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkK
IHsKICAgICB1bnNpZ25lZCBpbnQgYnM7CiAgICAgdW5zaWduZWQgaW50IGNwdSA9IHNjaGVkX3Vu
aXRfbWFzdGVyKHVuaXQpLCBuZXdfY3B1OwotICAgIGNwdW1hc2tfdCAqY3B1cyA9IGNwdXBvb2xf
ZG9tYWluX2NwdW1hc2sodW5pdC0+ZG9tYWluKTsKKyAgICBjcHVtYXNrX3QgKmNwdXMgPSBjcHVw
b29sX2RvbWFpbl9tYXN0ZXJfY3B1bWFzayh1bml0LT5kb21haW4pOwogCiAgICAgQVNTRVJUKHNw
aW5faXNfbG9ja2VkKGdldF9zY2hlZF9yZXMoY3B1KS0+c2NoZWR1bGVfbG9jaykpOwogCkBAIC00
NjcsNyArNDY3LDcgQEAgc3RhdGljIHZvaWQgbnVsbF91bml0X2luc2VydChjb25zdCBzdHJ1Y3Qg
c2NoZWR1bGVyICpvcHMsCiAgICAgbG9jayA9IHVuaXRfc2NoZWR1bGVfbG9jayh1bml0KTsKIAog
ICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwgdW5pdC0+Y3B1X2hhcmRf
YWZmaW5pdHksCi0gICAgICAgICAgICAgICAgY3B1cG9vbF9kb21haW5fY3B1bWFzayh1bml0LT5k
b21haW4pKTsKKyAgICAgICAgICAgICAgICBjcHVwb29sX2RvbWFpbl9tYXN0ZXJfY3B1bWFzayh1
bml0LT5kb21haW4pKTsKIAogICAgIC8qIElmIHRoZSBwQ1BVIGlzIGZyZWUsIHdlIGFzc2lnbiB1
bml0IHRvIGl0ICovCiAgICAgaWYgKCBsaWtlbHkocGVyX2NwdShucGMsIGNwdSkudW5pdCA9PSBO
VUxMKSApCkBAIC01NzksNyArNTc5LDcgQEAgc3RhdGljIHZvaWQgbnVsbF91bml0X3dha2UoY29u
c3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAgICAgICBzcGluX3VubG9jaygmcHJ2LT53YWl0
cV9sb2NrKTsKIAogICAgICAgICBjcHVtYXNrX2FuZChjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSks
IHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5LAotICAgICAgICAgICAgICAgICAgICBjcHVwb29sX2Rv
bWFpbl9jcHVtYXNrKHVuaXQtPmRvbWFpbikpOworICAgICAgICAgICAgICAgICAgICBjcHVwb29s
X2RvbWFpbl9tYXN0ZXJfY3B1bWFzayh1bml0LT5kb21haW4pKTsKIAogICAgICAgICBpZiAoICFj
cHVtYXNrX2ludGVyc2VjdHMoJnBydi0+Y3B1c19mcmVlLCBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNw
dSkpICkKICAgICAgICAgewpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZF9ydC5jIGIveGVu
L2NvbW1vbi9zY2hlZF9ydC5jCmluZGV4IGZkODgyZjJjYTQuLmQyMWM0MTZjYWUgMTAwNjQ0Ci0t
LSBhL3hlbi9jb21tb24vc2NoZWRfcnQuYworKysgYi94ZW4vY29tbW9uL3NjaGVkX3J0LmMKQEAg
LTMyNiw3ICszMjYsNyBAQCBydF9kdW1wX3VuaXQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3Bz
LCBjb25zdCBzdHJ1Y3QgcnRfdW5pdCAqc3ZjKQogICAgICAqLwogICAgIG1hc2sgPSBjcHVtYXNr
X3NjcmF0Y2hfY3B1KHNjaGVkX3VuaXRfbWFzdGVyKHN2Yy0+dW5pdCkpOwogCi0gICAgY3B1cG9v
bF9tYXNrID0gY3B1cG9vbF9kb21haW5fY3B1bWFzayhzdmMtPnVuaXQtPmRvbWFpbik7CisgICAg
Y3B1cG9vbF9tYXNrID0gY3B1cG9vbF9kb21haW5fbWFzdGVyX2NwdW1hc2soc3ZjLT51bml0LT5k
b21haW4pOwogICAgIGNwdW1hc2tfYW5kKG1hc2ssIGNwdXBvb2xfbWFzaywgc3ZjLT51bml0LT5j
cHVfaGFyZF9hZmZpbml0eSk7CiAgICAgcHJpbnRrKCJbJTVkLiUtMnVdIGNwdSAldSwgKCUiUFJJ
X3N0aW1lIiwgJSJQUklfc3RpbWUiKSwiCiAgICAgICAgICAgICIgY3VyX2I9JSJQUklfc3RpbWUi
IGN1cl9kPSUiUFJJX3N0aW1lIiBsYXN0X3N0YXJ0PSUiUFJJX3N0aW1lIlxuIgpAQCAtNjQyLDcg
KzY0Miw3IEBAIHJ0X3Jlc19waWNrKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgY29uc3Qg
c3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiAgICAgY3B1bWFza190ICpvbmxpbmU7CiAgICAgaW50
IGNwdTsKIAotICAgIG9ubGluZSA9IGNwdXBvb2xfZG9tYWluX2NwdW1hc2sodW5pdC0+ZG9tYWlu
KTsKKyAgICBvbmxpbmUgPSBjcHVwb29sX2RvbWFpbl9tYXN0ZXJfY3B1bWFzayh1bml0LT5kb21h
aW4pOwogICAgIGNwdW1hc2tfYW5kKCZjcHVzLCBvbmxpbmUsIHVuaXQtPmNwdV9oYXJkX2FmZmlu
aXR5KTsKIAogICAgIGNwdSA9IGNwdW1hc2tfdGVzdF9jcHUoc2NoZWRfdW5pdF9tYXN0ZXIodW5p
dCksICZjcHVzKQpAQCAtMTAxNiw3ICsxMDE2LDcgQEAgcnVucV9waWNrKGNvbnN0IHN0cnVjdCBz
Y2hlZHVsZXIgKm9wcywgY29uc3QgY3B1bWFza190ICptYXNrKQogICAgICAgICBpdGVyX3N2YyA9
IHFfZWxlbShpdGVyKTsKIAogICAgICAgICAvKiBtYXNrIGNwdV9oYXJkX2FmZmluaXR5ICYgY3B1
cG9vbCAmIG1hc2sgKi8KLSAgICAgICAgb25saW5lID0gY3B1cG9vbF9kb21haW5fY3B1bWFzayhp
dGVyX3N2Yy0+dW5pdC0+ZG9tYWluKTsKKyAgICAgICAgb25saW5lID0gY3B1cG9vbF9kb21haW5f
bWFzdGVyX2NwdW1hc2soaXRlcl9zdmMtPnVuaXQtPmRvbWFpbik7CiAgICAgICAgIGNwdW1hc2tf
YW5kKCZjcHVfY29tbW9uLCBvbmxpbmUsIGl0ZXJfc3ZjLT51bml0LT5jcHVfaGFyZF9hZmZpbml0
eSk7CiAgICAgICAgIGNwdW1hc2tfYW5kKCZjcHVfY29tbW9uLCBtYXNrLCAmY3B1X2NvbW1vbik7
CiAgICAgICAgIGlmICggY3B1bWFza19lbXB0eSgmY3B1X2NvbW1vbikgKQpAQCAtMTE5MSw3ICsx
MTkxLDcgQEAgcnVucV90aWNrbGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qg
cnRfdW5pdCAqbmV3KQogICAgIGlmICggbmV3ID09IE5VTEwgfHwgaXNfaWRsZV91bml0KG5ldy0+
dW5pdCkgKQogICAgICAgICByZXR1cm47CiAKLSAgICBvbmxpbmUgPSBjcHVwb29sX2RvbWFpbl9j
cHVtYXNrKG5ldy0+dW5pdC0+ZG9tYWluKTsKKyAgICBvbmxpbmUgPSBjcHVwb29sX2RvbWFpbl9t
YXN0ZXJfY3B1bWFzayhuZXctPnVuaXQtPmRvbWFpbik7CiAgICAgY3B1bWFza19hbmQoJm5vdF90
aWNrbGVkLCBvbmxpbmUsIG5ldy0+dW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHkpOwogICAgIGNwdW1h
c2tfYW5kbm90KCZub3RfdGlja2xlZCwgJm5vdF90aWNrbGVkLCAmcHJ2LT50aWNrbGVkKTsKIApk
aWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZHVsZS5jIGIveGVuL2NvbW1vbi9zY2hlZHVsZS5j
CmluZGV4IGZhM2Q4ODkzOGEuLmFlNWM4MDdjNmEgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2No
ZWR1bGUuYworKysgYi94ZW4vY29tbW9uL3NjaGVkdWxlLmMKQEAgLTYxLDYgKzYxLDcgQEAgaW50
ZWdlcl9wYXJhbSgic2NoZWRfcmF0ZWxpbWl0X3VzIiwgc2NoZWRfcmF0ZWxpbWl0X3VzKTsKIAog
LyogTnVtYmVyIG9mIHZjcHVzIHBlciBzdHJ1Y3Qgc2NoZWRfdW5pdC4gKi8KIHN0YXRpYyB1bnNp
Z25lZCBpbnQgX19yZWFkX21vc3RseSBzY2hlZF9ncmFudWxhcml0eSA9IDE7Citjb25zdCBjcHVt
YXNrX3QgKnNjaGVkX3Jlc19tYXNrID0gJmNwdW1hc2tfYWxsOwogCiAvKiBDb21tb24gbG9jayBm
b3IgZnJlZSBjcHVzLiAqLwogc3RhdGljIERFRklORV9TUElOTE9DSyhzY2hlZF9mcmVlX2NwdV9s
b2NrKTsKQEAgLTE4Niw3ICsxODcsNyBAQCBzdGF0aWMgaW5saW5lIHN0cnVjdCBzY2hlZHVsZXIg
KnZjcHVfc2NoZWR1bGVyKGNvbnN0IHN0cnVjdCB2Y3B1ICp2KQogewogICAgIHJldHVybiB1bml0
X3NjaGVkdWxlcih2LT5zY2hlZF91bml0KTsKIH0KLSNkZWZpbmUgVkNQVTJPTkxJTkUoX3YpIGNw
dXBvb2xfZG9tYWluX2NwdW1hc2soKF92KS0+ZG9tYWluKQorI2RlZmluZSBWQ1BVMk9OTElORShf
dikgY3B1cG9vbF9kb21haW5fbWFzdGVyX2NwdW1hc2soKF92KS0+ZG9tYWluKQogCiBzdGF0aWMg
aW5saW5lIHZvaWQgdHJhY2VfcnVuc3RhdGVfY2hhbmdlKHN0cnVjdCB2Y3B1ICp2LCBpbnQgbmV3
X3N0YXRlKQogewpAQCAtNDIzLDkgKzQyNCw5IEBAIHN0YXRpYyB1bnNpZ25lZCBpbnQgc2NoZWRf
c2VsZWN0X2luaXRpYWxfY3B1KGNvbnN0IHN0cnVjdCB2Y3B1ICp2KQogICAgIGNwdW1hc2tfY2xl
YXIoY3B1cyk7CiAgICAgZm9yX2VhY2hfbm9kZV9tYXNrICggbm9kZSwgZC0+bm9kZV9hZmZpbml0
eSApCiAgICAgICAgIGNwdW1hc2tfb3IoY3B1cywgY3B1cywgJm5vZGVfdG9fY3B1bWFzayhub2Rl
KSk7Ci0gICAgY3B1bWFza19hbmQoY3B1cywgY3B1cywgY3B1cG9vbF9kb21haW5fY3B1bWFzayhk
KSk7CisgICAgY3B1bWFza19hbmQoY3B1cywgY3B1cywgZC0+Y3B1cG9vbC0+Y3B1X3ZhbGlkKTsK
ICAgICBpZiAoIGNwdW1hc2tfZW1wdHkoY3B1cykgKQotICAgICAgICBjcHVtYXNrX2NvcHkoY3B1
cywgY3B1cG9vbF9kb21haW5fY3B1bWFzayhkKSk7CisgICAgICAgIGNwdW1hc2tfY29weShjcHVz
LCBkLT5jcHVwb29sLT5jcHVfdmFsaWQpOwogCiAgICAgaWYgKCB2LT52Y3B1X2lkID09IDAgKQog
ICAgICAgICBjcHVfcmV0ID0gY3B1bWFza19maXJzdChjcHVzKTsKQEAgLTk3MSw3ICs5NzIsNyBA
QCB2b2lkIHJlc3RvcmVfdmNwdV9hZmZpbml0eShzdHJ1Y3QgZG9tYWluICpkKQogICAgICAgICBs
b2NrID0gdW5pdF9zY2hlZHVsZV9sb2NrX2lycSh1bml0KTsKIAogICAgICAgICBjcHVtYXNrX2Fu
ZChjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksIHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5LAotICAg
ICAgICAgICAgICAgICAgICBjcHVwb29sX2RvbWFpbl9jcHVtYXNrKGQpKTsKKyAgICAgICAgICAg
ICAgICAgICAgY3B1cG9vbF9kb21haW5fbWFzdGVyX2NwdW1hc2soZCkpOwogICAgICAgICBpZiAo
IGNwdW1hc2tfZW1wdHkoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpKSApCiAgICAgICAgIHsKICAg
ICAgICAgICAgIGlmICggc2NoZWRfY2hlY2tfYWZmaW5pdHlfYnJva2VuKHVuaXQpICkKQEAgLTk3
OSw3ICs5ODAsNyBAQCB2b2lkIHJlc3RvcmVfdmNwdV9hZmZpbml0eShzdHJ1Y3QgZG9tYWluICpk
KQogICAgICAgICAgICAgICAgIHNjaGVkX3NldF9hZmZpbml0eSh1bml0LCB1bml0LT5jcHVfaGFy
ZF9hZmZpbml0eV9zYXZlZCwgTlVMTCk7CiAgICAgICAgICAgICAgICAgc2NoZWRfcmVzZXRfYWZm
aW5pdHlfYnJva2VuKHVuaXQpOwogICAgICAgICAgICAgICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tf
c2NyYXRjaF9jcHUoY3B1KSwgdW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHksCi0gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgY3B1cG9vbF9kb21haW5fY3B1bWFzayhkKSk7CisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgY3B1cG9vbF9kb21haW5fbWFzdGVyX2NwdW1hc2soZCkpOwogICAgICAg
ICAgICAgfQogCiAgICAgICAgICAgICBpZiAoIGNwdW1hc2tfZW1wdHkoY3B1bWFza19zY3JhdGNo
X2NwdShjcHUpKSApCkBAIC05ODksNyArOTkwLDcgQEAgdm9pZCByZXN0b3JlX3ZjcHVfYWZmaW5p
dHkoc3RydWN0IGRvbWFpbiAqZCkKICAgICAgICAgICAgICAgICAgICAgICAgdW5pdC0+dmNwdV9s
aXN0KTsKICAgICAgICAgICAgICAgICBzY2hlZF9zZXRfYWZmaW5pdHkodW5pdCwgJmNwdW1hc2tf
YWxsLCBOVUxMKTsKICAgICAgICAgICAgICAgICBjcHVtYXNrX2FuZChjcHVtYXNrX3NjcmF0Y2hf
Y3B1KGNwdSksIHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5LAotICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGNwdXBvb2xfZG9tYWluX2NwdW1hc2soZCkpOworICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGNwdXBvb2xfZG9tYWluX21hc3Rlcl9jcHVtYXNrKGQpKTsKICAgICAgICAgICAgIH0K
ICAgICAgICAgfQogCmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQtaWYuaCBiL3hl
bi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5oCmluZGV4IDk4M2YyZWNlODMuLjFiMjk2YjE1MGYgMTAw
NjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5oCisrKyBiL3hlbi9pbmNsdWRlL3hl
bi9zY2hlZC1pZi5oCkBAIC0yMiw2ICsyMiw4IEBAIGV4dGVybiBjcHVtYXNrX3QgY3B1cG9vbF9m
cmVlX2NwdXM7CiAjZGVmaW5lIFNDSEVEX0RFRkFVTFRfUkFURUxJTUlUX1VTIDEwMDAKIGV4dGVy
biBpbnQgc2NoZWRfcmF0ZWxpbWl0X3VzOwogCisvKiBTY2hlZHVsaW5nIHJlc291cmNlIG1hc2su
ICovCitleHRlcm4gY29uc3QgY3B1bWFza190ICpzY2hlZF9yZXNfbWFzazsKIAogLyoKICAqIElu
IG9yZGVyIHRvIGFsbG93IGEgc2NoZWR1bGVyIHRvIHJlbWFwIHRoZSBsb2NrLT5jcHUgbWFwcGlu
ZywKQEAgLTUzNSw2ICs1MzcsNyBAQCBzdHJ1Y3QgY3B1cG9vbAogICAgIGludCAgICAgICAgICAg
ICAgY3B1cG9vbF9pZDsKICAgICB1bnNpZ25lZCBpbnQgICAgIG5fZG9tOwogICAgIGNwdW1hc2tf
dmFyX3QgICAgY3B1X3ZhbGlkOyAgICAgIC8qIGFsbCBjcHVzIGFzc2lnbmVkIHRvIHBvb2wgKi8K
KyAgICBjcHVtYXNrX3Zhcl90ICAgIHJlc192YWxpZDsgICAgICAvKiBhbGwgc2NoZWR1bGluZyBy
ZXNvdXJjZXMgb2YgcG9vbCAqLwogICAgIHN0cnVjdCBjcHVwb29sICAgKm5leHQ7CiAgICAgc3Ry
dWN0IHNjaGVkdWxlciAqc2NoZWQ7CiAgICAgYXRvbWljX3QgICAgICAgICByZWZjbnQ7CkBAIC01
NDMsMTQgKzU0NiwxNCBAQCBzdHJ1Y3QgY3B1cG9vbAogI2RlZmluZSBjcHVwb29sX29ubGluZV9j
cHVtYXNrKF9wb29sKSBcCiAgICAgKCgoX3Bvb2wpID09IE5VTEwpID8gJmNwdV9vbmxpbmVfbWFw
IDogKF9wb29sKS0+Y3B1X3ZhbGlkKQogCi1zdGF0aWMgaW5saW5lIGNwdW1hc2tfdCAqY3B1cG9v
bF9kb21haW5fY3B1bWFzayhjb25zdCBzdHJ1Y3QgZG9tYWluICpkKQorc3RhdGljIGlubGluZSBj
cHVtYXNrX3QgKmNwdXBvb2xfZG9tYWluX21hc3Rlcl9jcHVtYXNrKGNvbnN0IHN0cnVjdCBkb21h
aW4gKmQpCiB7CiAgICAgLyoKICAgICAgKiBkLT5jcHVwb29sIGlzIE5VTEwgb25seSBmb3IgdGhl
IGlkbGUgZG9tYWluLCBhbmQgbm8gb25lIHNob3VsZAogICAgICAqIGJlIGludGVyZXN0ZWQgaW4g
Y2FsbGluZyB0aGlzIGZvciB0aGUgaWRsZSBkb21haW4uCiAgICAgICovCiAgICAgQVNTRVJUKGQt
PmNwdXBvb2wgIT0gTlVMTCk7Ci0gICAgcmV0dXJuIGQtPmNwdXBvb2wtPmNwdV92YWxpZDsKKyAg
ICByZXR1cm4gZC0+Y3B1cG9vbC0+cmVzX3ZhbGlkOwogfQogCiAvKgpAQCAtNTkwLDcgKzU5Myw3
IEBAIHN0YXRpYyBpbmxpbmUgY3B1bWFza190ICpjcHVwb29sX2RvbWFpbl9jcHVtYXNrKGNvbnN0
IHN0cnVjdCBkb21haW4gKmQpCiBzdGF0aWMgaW5saW5lIGludCBoYXNfc29mdF9hZmZpbml0eShj
b25zdCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIHsKICAgICByZXR1cm4gdW5pdC0+c29mdF9h
ZmZfZWZmZWN0aXZlICYmCi0gICAgICAgICAgICFjcHVtYXNrX3N1YnNldChjcHVwb29sX2RvbWFp
bl9jcHVtYXNrKHVuaXQtPmRvbWFpbiksCisgICAgICAgICAgICFjcHVtYXNrX3N1YnNldChjcHVw
b29sX2RvbWFpbl9tYXN0ZXJfY3B1bWFzayh1bml0LT5kb21haW4pLAogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgdW5pdC0+Y3B1X3NvZnRfYWZmaW5pdHkpOwogfQogCi0tIAoyLjE2LjQKCgpf
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwg
bWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3Rz
LnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

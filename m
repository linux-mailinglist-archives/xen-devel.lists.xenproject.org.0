Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id D9AEDB2BF6
	for <lists+xen-devel@lfdr.de>; Sat, 14 Sep 2019 17:42:36 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i9A7f-0001K7-Fb; Sat, 14 Sep 2019 15:38:03 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=mwje=XJ=invisiblethingslab.com=marmarek@srs-us1.protection.inumbo.net>)
 id 1i9A7e-0001Jj-1t
 for xen-devel@lists.xenproject.org; Sat, 14 Sep 2019 15:38:02 +0000
X-Inumbo-ID: 985981ce-d705-11e9-b299-bc764e2007e4
Received: from new1-smtp.messagingengine.com (unknown [66.111.4.221])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 985981ce-d705-11e9-b299-bc764e2007e4;
 Sat, 14 Sep 2019 15:37:44 +0000 (UTC)
Received: from compute7.internal (compute7.nyi.internal [10.202.2.47])
 by mailnew.nyi.internal (Postfix) with ESMTP id 2D9041EAE;
 Sat, 14 Sep 2019 11:37:44 -0400 (EDT)
Received: from mailfrontend2 ([10.202.2.163])
 by compute7.internal (MEProxy); Sat, 14 Sep 2019 11:37:44 -0400
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=
 messagingengine.com; h=cc:content-transfer-encoding:content-type
 :date:from:in-reply-to:message-id:mime-version:references
 :subject:to:x-me-proxy:x-me-proxy:x-me-sender:x-me-sender
 :x-sasl-enc; s=fm3; bh=IqjJKi8sEkYKfuLRYu5vrZb4va1MlV3tXCWlHooTS
 Wc=; b=AB/ZDhIG3IjbpQzWJ6XQ3F0A7esrjvf9YHuHFJ2m/WXZGhI1r4POWLra/
 GK9syDY+WKu1bFdCM1rUTjbrlCE7SWkOHxqQZ5K0TOAGIUxxSGkQyQL2sgS/h94/
 qxTbXyhVe7WVibLuNEd50uorX+kUWIgmC5oB6Qdcrbt0JUQwTR55GWJrNNoFOTnR
 6X/aGdSY9oYK6NCyWLzkAh7bMn/SvUc5m11ZAjGVpf6aMwmebXSiMFUEVikDKaoP
 8LdIW9f32IzONa5hirhEbxrIYlgfddisN8+aTMoxMRwaCwJ1IvHnevVLNS4k02EB
 3DvJnxf91tqAr+bGxpqT5CNeSHVWw==
X-ME-Sender: <xms:Rwl9XQtDMSIv5rR330L6c0xCxWQEOnafEbfmrDMeXaIi9bjglMsyAQ>
X-ME-Proxy-Cause: gggruggvucftvghtrhhoucdtuddrgedufedrtdelgdeludcutefuodetggdotefrodftvf
 curfhrohhfihhlvgemucfhrghsthforghilhdpqfgfvfdpuffrtefokffrpgfnqfghnecu
 uegrihhlohhuthemuceftddtnecusecvtfgvtghiphhivghnthhsucdlqddutddtmdenuc
 fjughrpefhvffufffkofgjfhggtgfgsehtkeertdertdejnecuhfhrohhmpeforghrvghk
 ucforghrtgiihihkohifshhkihdqifpkrhgvtghkihcuoehmrghrmhgrrhgvkhesihhnvh
 hishhisghlvghthhhinhhgshhlrggsrdgtohhmqeenucffohhmrghinhepghhithhhuhgs
 rdgtohhmnecukfhppeeluddrieehrdefgedrfeefnecurfgrrhgrmhepmhgrihhlfhhroh
 hmpehmrghrmhgrrhgvkhesihhnvhhishhisghlvghthhhinhhgshhlrggsrdgtohhmnecu
 vehluhhsthgvrhfuihiivgeptd
X-ME-Proxy: <xmx:SAl9Xb_1w0gxPcPsw-WuCZNaV0zlA69RrTNqIpRuRYfxrvKX-8C0nQ>
 <xmx:SAl9XXR7a9aysF_r1Uq7cXGW7ktZgi8xD5mpc3bnwl_FepQN_aM9Yg>
 <xmx:SAl9XdVbGSZWj5e9Uv4Kh4NitBN2V6xx-zL8kbH_JOSA1HhDXnUfMg>
 <xmx:SAl9XQk6SXpIGYgPRsAc9qc6Rwc6psbCC_C11Y7p9nEEFNhAJBzlbg>
Received: from localhost.localdomain (ip5b412221.dynamic.kabel-deutschland.de
 [91.65.34.33])
 by mail.messagingengine.com (Postfix) with ESMTPA id 1FAFDD6005B;
 Sat, 14 Sep 2019 11:37:42 -0400 (EDT)
From: =?UTF-8?q?Marek=20Marczykowski-G=C3=B3recki?=
 <marmarek@invisiblethingslab.com>
To: xen-devel@lists.xenproject.org
Date: Sat, 14 Sep 2019 17:37:19 +0200
Message-Id: <effa11149efc3138b482b840d72bd435241f9fbf.1568475323.git-series.marmarek@invisiblethingslab.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <cover.4c97023e719e059ea99137f2cadea319eb87495d.1568475323.git-series.marmarek@invisiblethingslab.com>
References: <cover.4c97023e719e059ea99137f2cadea319eb87495d.1568475323.git-series.marmarek@invisiblethingslab.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v6 4/6] xen/x86: Allow stubdom access to irq
 created for msi.
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Kevin Tian <kevin.tian@intel.com>,
 Stefano Stabellini <sstabellini@kernel.org>,
 Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>,
 =?UTF-8?q?Marek=20Marczykowski-G=C3=B3recki?=
 <marmarek@invisiblethingslab.com>, Tim Deegan <tim@xen.org>,
 Simon Gaiser <simon@invisiblethingslab.com>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>,
 Brian Woods <brian.woods@amd.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

U3R1YmRvbWFpbnMgbmVlZCB0byBiZSBnaXZlbiBzdWZmaWNpZW50IHByaXZpbGVnZSBvdmVyIHRo
ZSBndWVzdCB3aGljaCBpdApwcm92aWRlcyBlbXVsYXRpb24gZm9yIGluIG9yZGVyIGZvciBQQ0kg
cGFzc3Rocm91Z2ggdG8gd29yayBjb3JyZWN0bHkuCldoZW4gYSBIVk0gZG9tYWluIHRyeSB0byBl
bmFibGUgTVNJLCBRRU1VIGluIHN0dWJkb21haW4gY2FsbHMKUEhZU0RFVk9QX21hcF9waXJxLCBi
dXQgbGF0ZXIgaXQgbmVlZHMgdG8gY2FsbCBYRU5fRE9NQ1RMX2JpbmRfcHRfaXJxIGFzCnBhcnQg
b2YgeGNfZG9tYWluX3VwZGF0ZV9tc2lfaXJxLiBBbGxvdyBmb3IgdGhhdCBhcyBwYXJ0IG9mClBI
WVNERVZPUF9tYXBfcGlycS4KClRoaXMgaXMgbm90IG5lZWRlZCBmb3IgUENJIElOVHgsIGJlY2F1
c2UgSVJRIGluIHRoYXQgY2FzZSBpcyBrbm93bgpiZWZvcmVoYW5kIGFuZCB0aGUgc3R1YmRvbWFp
biBpcyBnaXZlbiBwZXJtaXNzaW9ucyBvdmVyIHRoaXMgSVJRIGJ5CmxpYnhsX19kZXZpY2VfcGNp
X2FkZCAodGhlcmUncyBhIGRvX3BjaV9hZGQgYWdhaW5zdCB0aGUgc3R1YmRvbWFpbikuCgpjcmVh
dGVfaXJxKCkgYWxyZWFkeSBncmFudCBJUlEgYWNjZXNzIHRvIGhhcmR3YXJlX2RvbWFpbiwgd2l0
aAphc3N1bXB0aW9uIHRoZSBkZXZpY2UgbW9kZWwgKHNvbWV0aGluZyBtYW5hZ2luZyB0aGlzIElS
USkgbGl2ZXMgdGhlcmUuCk1vZGlmeSBjcmVhdGVfaXJxKCkgdG8gdGFrZSBhZGRpdGlvbmFsIHBh
cmFtZXRlciBwb2ludGluZyBhdCBkZXZpY2UKbW9kZWwgZG9tYWluIC0gd2hpY2ggbWF5IGJlIGRv
bTAgb3Igc3R1YmRvbWFpbi4gIFNhdmUgSUQgb2YgdGhlIGRvbWFpbgpnaXZlbiBwZXJtaXNzaW9u
LCB0byByZXZva2UgaXQgaW4gZGVzdHJveV9pcnEoKSAtIGVhc2llciBhbmQgY2xlYW5lcgp0aGFu
IHJlcGxheWluZyBsb2dpYyBvZiBjcmVhdGVfaXJxKCkgcGFyYW1ldGVyLiBVc2UgZG9taWQgaW5z
dGVhZCBvZgphY3R1YWwgcmVmZXJlbmNlIHRvIHRoZSBkb21haW4sIGJlY2F1c2UgaXQgbWlnaHQg
Z2V0IGRlc3Ryb3llZCBiZWZvcmUKZGVzdHJveWluZyBJUlEgKHN0dWJkb21haW4gaXMgZGVzdHJv
eWVkIGJlZm9yZSBpdHMgdGFyZ2V0IGRvbWFpbikuIEFuZAppdCBpcyBub3QgYW4gaXNzdWUsIGJl
Y2F1c2UgSVJRIHBlcm1pc3Npb25zIGxpdmUgd2l0aGluIGRvbWFpbgpzdHJ1Y3R1cmUsIHNvIGRl
c3Ryb3lpbmcgYSBkb21haW4gYWxzbyBpbXBsaWNpdGx5IHJldm9rZSB0aGUgcGVybWlzc2lvbi4K
UG90ZW50aWFsIGRvbWlkIHJldXNlIGlzIGRldGVjdGVkIGJ5IGJ5IGNoZWNraW5nIGlmIHRoYXQg
ZG9tYWluIGRvZXMKaGF2ZSBwZXJtaXNzaW9uIG92ZXIgdGhlIElSUSBiZWluZyBkZXN0cm95ZWQu
CgpUaGVuLCBhZGp1c3QgYWxsIGNhbGxlcnMgdG8gcHJvdmlkZSB0aGUgcGFyYW1ldGVyLiBJbiBj
YXNlIG9mIGNhbGxzIG5vdApyZWxhdGVkIHRvIHN0dWJkb21haW4taW5pdGlhdGVkIGFsbG9jYXRp
b25zLCBnaXZlIGl0IGVpdGhlcgpoYXJkd2FyZV9kb21haW4gKHNvIHRoZSBiZWhhdmlvciBpcyB1
bmNoYW5nZWQgdGhlcmUpLCBvciBOVUxMIGZvcgppbnRlcnJ1cHRzIHVzZWQgYnkgWGVuIGludGVy
bmFsbHkuCgpJbnNwaXJlZCBieSBodHRwczovL2dpdGh1Yi5jb20vT3BlblhUL3hlbmNsaWVudC1v
ZS9ibG9iLzVlMGU3MzA0YTVhM2M3NWVmMDEyNDBhMWUzNjczNjY1YjJhYWYwNWUvcmVjaXBlcy1l
eHRlbmRlZC94ZW4vZmlsZXMvc3R1YmRvbWFpbi1tc2ktaXJxLWFjY2Vzcy5wYXRjaCBieSBFcmlj
IENoYW51ZGV0IDxjaGFudWRldGVAYWluZm9zZWMuY29tPi4KClNpZ25lZC1vZmYtYnk6IFNpbW9u
IEdhaXNlciA8c2ltb25AaW52aXNpYmxldGhpbmdzbGFiLmNvbT4KU2lnbmVkLW9mZi1ieTogTWFy
ZWsgTWFyY3p5a293c2tpLUfDs3JlY2tpIDxtYXJtYXJla0BpbnZpc2libGV0aGluZ3NsYWIuY29t
PgotLS0KQ2hhbmdlcyBpbiB2MzoKIC0gZXh0ZW5kIGNvbW1pdCBtZXNzYWdlCkNoYW5nZXMgaW4g
djQ6CiAtIGFkZCBtaXNzaW5nIGRlc3Ryb3lfaXJxIG9uIGVycm9yIHBhdGgKQ2hhbmdlcyBpbiB2
NToKIC0gbW92ZSBpcnFfe2dyYW50LHJldm9rZX1fYWNjZXNzKCkgdG8ge2NyZWF0ZSxkZXN0cm95
fV9pcnEoKSwgd2hpY2gKICAgYmFzaWNhbGx5IG1ha2UgaXQgYSBkaWZmZXJlbnQgcGF0Y2gKIC0g
YWRkIGdldF9kbV9kb21haW4oKSBoZWxwZXIKIC0gZG8gbm90IGdpdmUgaGFyZHdhcmVfZG9tYWlu
IHBlcm1pc3Npb24gb3ZlciBJUlFzIHVzZWQgaW4gWGVuCiAgIGludGVybmFsbHkKIC0gcmVuYW1l
IGNyZWF0ZV9pcnEgYXJndW1lbnQgdG8ganVzdCAnZCcsIHRvIGF2b2lkIGNvbmZ1c2lvbgogICB3
aGVuIGl0J3MgY2FsbGVkIGJ5IGhhcmR3YXJlIGRvbWFpbgogLSB2ZXJpZnkgdGhhdCBkZXZpY2Ug
aXMgZGUtYXNzaWduZWQgYmVmb3JlIHBjaV9yZW1vdmVfZGV2aWNlIGNhbGwKIC0gc2F2ZSBJRCBv
ZiBkb21haW4gZ2l2ZW4gcGVybWlzc2lvbiBpbiBjcmVhdGVfaXJxKCksIHRvIHJldm9rZSBpdCBp
bgogZGVzdHJveV9pcnEoKQogLSBkcm9wIGRvbWFpbiBwYXJhbWV0ZXIgZnJvbSBkZXN0cm95X2ly
cSgpIGFuZCBtc2lfZnJlZV9pcnEoKQogLSBkbyBub3QgZ2l2ZSBoYXJkd2FyZSBkb21haW4gcGVy
bWlzc2lvbiBvdmVyIElSUSBjcmVhdGVkIGluCiBpb21tdV9zZXRfaW50ZXJydXB0KCkKQ2hhbmdl
cyBpbiB2NjoKIC0gZG8gbm90IGdpdmUgcGVybWlzc2lvbiBvdmVyIGhwZXQgaXJxIHRvIGhhcmR3
YXJlX2RvbWFpbgogLSBtb3ZlIGNyZWF0b3JfZG9taWQgdG8gYXJjaF9pcnFfZGVzYwogLSBmaXgg
Y3JlYXRvcl9kb21pZCBpbml0aWFsaXphdGlvbgogLSBhbHdheXMgZ2l2ZSBjdXJyZW50LT5kb21h
aW4gcGVybWlzc2lvbiBpbnN0ZWFkIG9mIHVzaW5nCiBnZXRfZG1fZG9tYWluKCkgaGVscGVyLiBB
bmFseXNpcyBvZiBhbGwgaXRzIHVzZSBjYXNlcyB0ZWxscyB0aGF0IGl0IGlzCiB0aGUgb25seSB2
YWx1ZSBpdCByZXR1cm5zLgogLSBkcm9wIHVucmVsYXRlZCBjaGFuZ2UKLS0tCiB4ZW4vYXJjaC94
ODYvaHBldC5jICAgICAgICAgICAgICAgICAgICAgIHwgIDMgKy0KIHhlbi9hcmNoL3g4Ni9pcnEu
YyAgICAgICAgICAgICAgICAgICAgICAgfCA1MSArKysrKysrKysrKysrKysrKystLS0tLS0tCiB4
ZW4vZHJpdmVycy9jaGFyL25zMTY1NTAuYyAgICAgICAgICAgICAgIHwgIDIgKy0KIHhlbi9kcml2
ZXJzL3Bhc3N0aHJvdWdoL2FtZC9pb21tdV9pbml0LmMgfCAgMiArLQogeGVuL2RyaXZlcnMvcGFz
c3Rocm91Z2gvdnRkL2lvbW11LmMgICAgICB8ICAzICstCiB4ZW4vaW5jbHVkZS9hc20teDg2L2ly
cS5oICAgICAgICAgICAgICAgIHwgIDcgKystCiA2IGZpbGVzIGNoYW5nZWQsIDUwIGluc2VydGlv
bnMoKyksIDE4IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9ocGV0LmMg
Yi94ZW4vYXJjaC94ODYvaHBldC5jCmluZGV4IDRiMDg0ODguLjVlZDQ0MDUgMTAwNjQ0Ci0tLSBh
L3hlbi9hcmNoL3g4Ni9ocGV0LmMKKysrIGIveGVuL2FyY2gveDg2L2hwZXQuYwpAQCAtMTEsNiAr
MTEsNyBAQAogI2luY2x1ZGUgPHhlbi9zb2Z0aXJxLmg+CiAjaW5jbHVkZSA8eGVuL2lycS5oPgog
I2luY2x1ZGUgPHhlbi9udW1hLmg+CisjaW5jbHVkZSA8eGVuL3NjaGVkLmg+CiAjaW5jbHVkZSA8
YXNtL2ZpeG1hcC5oPgogI2luY2x1ZGUgPGFzbS9kaXY2NC5oPgogI2luY2x1ZGUgPGFzbS9ocGV0
Lmg+CkBAIC0zNjgsNyArMzY5LDcgQEAgc3RhdGljIGludCBfX2luaXQgaHBldF9hc3NpZ25faXJx
KHN0cnVjdCBocGV0X2V2ZW50X2NoYW5uZWwgKmNoKQogewogICAgIGludCBpcnE7CiAKLSAgICBp
ZiAoIChpcnEgPSBjcmVhdGVfaXJxKE5VTUFfTk9fTk9ERSkpIDwgMCApCisgICAgaWYgKCAoaXJx
ID0gY3JlYXRlX2lycShOVU1BX05PX05PREUsIE5VTEwpKSA8IDAgKQogICAgICAgICByZXR1cm4g
aXJxOwogCiAgICAgY2gtPm1zaS5pcnEgPSBpcnE7CmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYv
aXJxLmMgYi94ZW4vYXJjaC94ODYvaXJxLmMKaW5kZXggMGVlMzM0Ni4uMGI0YzIwYSAxMDA2NDQK
LS0tIGEveGVuL2FyY2gveDg2L2lycS5jCisrKyBiL3hlbi9hcmNoL3g4Ni9pcnEuYwpAQCAtMjU0
LDcgKzI1NCwxMyBAQCB2b2lkIF9faW5pdCBjbGVhcl9pcnFfdmVjdG9yKGludCBpcnEpCiAvKgog
ICogRHluYW1pYyBpcnEgYWxsb2NhdGUgYW5kIGRlYWxsb2NhdGlvbiBmb3IgTVNJCiAgKi8KLWlu
dCBjcmVhdGVfaXJxKG5vZGVpZF90IG5vZGUpCisKKy8qCisgKiBjcmVhdGVfaXJxIC0gYWxsb2Nh
dGUgaXJxIGZvciBNU0kKKyAqIEBkIGRvbWFpbiB0aGF0IHdpbGwgZ2V0IHBlcm1pc3Npb24gb3Zl
ciB0aGUgYWxsb2NhdGVkIGlycTsgdGhpcyBwZXJtaXNzaW9uCisgKiB3aWxsIGF1dG9tYXRpY2Fs
bHkgYmUgcmV2b2tlZCBvbiBkZXN0cm95X2lycQorICovCitpbnQgY3JlYXRlX2lycShub2RlaWRf
dCBub2RlLCBzdHJ1Y3QgZG9tYWluICpkKQogewogICAgIGludCBpcnEsIHJldDsKICAgICBzdHJ1
Y3QgaXJxX2Rlc2MgKmRlc2M7CkBAIC0yODIsMjMgKzI4OCwzMCBAQCBpbnQgY3JlYXRlX2lycShu
b2RlaWRfdCBub2RlKQogICAgICAgICB9CiAgICAgICAgIHJldCA9IGFzc2lnbl9pcnFfdmVjdG9y
KGlycSwgbWFzayk7CiAgICAgfQorICAgIEFTU0VSVChkZXNjLT5hcmNoLmNyZWF0b3JfZG9taWQg
PT0gRE9NSURfSU5WQUxJRCk7CiAgICAgaWYgKHJldCA8IDApCiAgICAgewogICAgICAgICBkZXNj
LT5hcmNoLnVzZWQgPSBJUlFfVU5VU0VEOwogICAgICAgICBpcnEgPSByZXQ7CiAgICAgfQotICAg
IGVsc2UgaWYgKCBoYXJkd2FyZV9kb21haW4gKQorICAgIGVsc2UgaWYgKCBkICkKICAgICB7Ci0g
ICAgICAgIHJldCA9IGlycV9wZXJtaXRfYWNjZXNzKGhhcmR3YXJlX2RvbWFpbiwgaXJxKTsKKyAg
ICAgICAgQVNTRVJUKGQgPT0gY3VycmVudC0+ZG9tYWluKTsKKyAgICAgICAgcmV0ID0gaXJxX3Bl
cm1pdF9hY2Nlc3MoZCwgaXJxKTsKICAgICAgICAgaWYgKCByZXQgKQogICAgICAgICAgICAgcHJp
bnRrKFhFTkxPR19HX0VSUgotICAgICAgICAgICAgICAgICAgICJDb3VsZCBub3QgZ3JhbnQgRG9t
MCBhY2Nlc3MgdG8gSVJRJWQgKGVycm9yICVkKVxuIiwKLSAgICAgICAgICAgICAgICAgICBpcnEs
IHJldCk7CisgICAgICAgICAgICAgICAgICAgIkNvdWxkIG5vdCBncmFudCBEb20ldSBhY2Nlc3Mg
dG8gSVJRJWQgKGVycm9yICVkKVxuIiwKKyAgICAgICAgICAgICAgICAgICBkLT5kb21haW5faWQs
IGlycSwgcmV0KTsKKyAgICAgICAgZWxzZQorICAgICAgICAgICAgZGVzYy0+YXJjaC5jcmVhdG9y
X2RvbWlkID0gZC0+ZG9tYWluX2lkOwogICAgIH0KIAogICAgIHJldHVybiBpcnE7CiB9CiAKKy8q
CisgKiBkZXN0cm95X2lycSAtIGRlYWxsb2NhdGUgaXJxIGZvciBNU0kKKyAqLwogdm9pZCBkZXN0
cm95X2lycSh1bnNpZ25lZCBpbnQgaXJxKQogewogICAgIHN0cnVjdCBpcnFfZGVzYyAqZGVzYyA9
IGlycV90b19kZXNjKGlycSk7CkBAIC0zMDcsMTQgKzMyMCwyNSBAQCB2b2lkIGRlc3Ryb3lfaXJx
KHVuc2lnbmVkIGludCBpcnEpCiAKICAgICBCVUdfT04oIU1TSV9JUlEoaXJxKSk7CiAKLSAgICBp
ZiAoIGhhcmR3YXJlX2RvbWFpbiApCisgICAgaWYgKCBkZXNjLT5hcmNoLmNyZWF0b3JfZG9taWQg
IT0gRE9NSURfSU5WQUxJRCApCiAgICAgewotICAgICAgICBpbnQgZXJyID0gaXJxX2RlbnlfYWNj
ZXNzKGhhcmR3YXJlX2RvbWFpbiwgaXJxKTsKKyAgICAgICAgc3RydWN0IGRvbWFpbiAqZCA9IGdl
dF9kb21haW5fYnlfaWQoZGVzYy0+YXJjaC5jcmVhdG9yX2RvbWlkKTsKIAotICAgICAgICBpZiAo
IGVyciApCi0gICAgICAgICAgICBwcmludGsoWEVOTE9HX0dfRVJSCi0gICAgICAgICAgICAgICAg
ICAgIkNvdWxkIG5vdCByZXZva2UgRG9tMCBhY2Nlc3MgdG8gSVJRJXUgKGVycm9yICVkKVxuIiwK
LSAgICAgICAgICAgICAgICAgICBpcnEsIGVycik7CisgICAgICAgIGlmICggZCAmJiBpcnFfYWNj
ZXNzX3Blcm1pdHRlZChkLCBpcnEpICkKKyAgICAgICAgeworICAgICAgICAgICAgaW50IGVycjsK
KworICAgICAgICAgICAgZXJyID0gaXJxX2RlbnlfYWNjZXNzKGQsIGlycSk7CisgICAgICAgICAg
ICBpZiAoIGVyciApCisgICAgICAgICAgICAgICAgcHJpbnRrKFhFTkxPR19HX0VSUgorICAgICAg
ICAgICAgICAgICAgICAgICAiQ291bGQgbm90IHJldm9rZSBEb20ldSBhY2Nlc3MgdG8gSVJRJXUg
KGVycm9yICVkKVxuIiwKKyAgICAgICAgICAgICAgICAgICAgICAgZC0+ZG9tYWluX2lkLCBpcnEs
IGVycik7CisgICAgICAgIH0KKworICAgICAgICBpZiAoIGQgKQorICAgICAgICAgICAgcHV0X2Rv
bWFpbihkKTsKKworICAgICAgICBkZXNjLT5hcmNoLmNyZWF0b3JfZG9taWQgPSBET01JRF9JTlZB
TElEOwogICAgIH0KIAogICAgIHNwaW5fbG9ja19pcnFzYXZlKCZkZXNjLT5sb2NrLCBmbGFncyk7
CkBAIC0zODEsNiArNDA1LDcgQEAgaW50IGFyY2hfaW5pdF9vbmVfaXJxX2Rlc2Moc3RydWN0IGly
cV9kZXNjICpkZXNjKQogCiAgICAgZGVzYy0+YXJjaC52ZWN0b3IgPSBJUlFfVkVDVE9SX1VOQVNT
SUdORUQ7CiAgICAgZGVzYy0+YXJjaC5vbGRfdmVjdG9yID0gSVJRX1ZFQ1RPUl9VTkFTU0lHTkVE
OworICAgIGRlc2MtPmFyY2guY3JlYXRvcl9kb21pZCA9IERPTUlEX0lOVkFMSUQ7CiAKICAgICBy
ZXR1cm4gMDsKIH0KQEAgLTIxMzMsNyArMjE1OCw3IEBAIGludCBtYXBfZG9tYWluX3BpcnEoCiAg
ICAgICAgICAgICBzcGluX3VubG9ja19pcnFyZXN0b3JlKCZkZXNjLT5sb2NrLCBmbGFncyk7CiAK
ICAgICAgICAgICAgIGluZm8gPSBOVUxMOwotICAgICAgICAgICAgaXJxID0gY3JlYXRlX2lycShO
VU1BX05PX05PREUpOworICAgICAgICAgICAgaXJxID0gY3JlYXRlX2lycShOVU1BX05PX05PREUs
IGN1cnJlbnQtPmRvbWFpbik7CiAgICAgICAgICAgICByZXQgPSBpcnEgPj0gMCA/IHByZXBhcmVf
ZG9tYWluX2lycV9waXJxKGQsIGlycSwgcGlycSArIG5yLCAmaW5mbykKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIDogaXJxOwogICAgICAgICAgICAgaWYgKCByZXQgPCAwICkKQEAgLTI4MTgs
NyArMjg0Myw3IEBAIGludCBhbGxvY2F0ZV9hbmRfbWFwX21zaV9waXJxKHN0cnVjdCBkb21haW4g
KmQsIGludCBpbmRleCwgaW50ICpwaXJxX3AsCiAgICAgICAgIGlmICggaXJxID09IC0xICkKICAg
ICAgICAgewogICAgIGNhc2UgTUFQX1BJUlFfVFlQRV9NVUxUSV9NU0k6Ci0gICAgICAgICAgICBp
cnEgPSBjcmVhdGVfaXJxKE5VTUFfTk9fTk9ERSk7CisgICAgICAgICAgICBpcnEgPSBjcmVhdGVf
aXJxKE5VTUFfTk9fTk9ERSwgY3VycmVudC0+ZG9tYWluKTsKICAgICAgICAgfQogCiAgICAgICAg
IGlmICggaXJxIDwgbnJfaXJxc19nc2kgfHwgaXJxID49IG5yX2lycXMgKQpkaWZmIC0tZ2l0IGEv
eGVuL2RyaXZlcnMvY2hhci9uczE2NTUwLmMgYi94ZW4vZHJpdmVycy9jaGFyL25zMTY1NTAuYwpp
bmRleCA4NjY3ZGU2Li42NmNjNjgwIDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy9jaGFyL25zMTY1
NTAuYworKysgYi94ZW4vZHJpdmVycy9jaGFyL25zMTY1NTAuYwpAQCAtNzIyLDcgKzcyMiw3IEBA
IHN0YXRpYyB2b2lkIF9faW5pdCBuczE2NTUwX2luaXRfaXJxKHN0cnVjdCBzZXJpYWxfcG9ydCAq
cG9ydCkKICAgICBzdHJ1Y3QgbnMxNjU1MCAqdWFydCA9IHBvcnQtPnVhcnQ7CiAKICAgICBpZiAo
IHVhcnQtPm1zaSApCi0gICAgICAgIHVhcnQtPmlycSA9IGNyZWF0ZV9pcnEoMCk7CisgICAgICAg
IHVhcnQtPmlycSA9IGNyZWF0ZV9pcnEoMCwgTlVMTCk7CiAjZW5kaWYKIH0KIApkaWZmIC0tZ2l0
IGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL2lvbW11X2luaXQuYyBiL3hlbi9kcml2ZXJz
L3Bhc3N0aHJvdWdoL2FtZC9pb21tdV9pbml0LmMKaW5kZXggYmI5ZjMzZS4uOWFmNGI3YyAxMDA2
NDQKLS0tIGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL2lvbW11X2luaXQuYworKysgYi94
ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfaW5pdC5jCkBAIC03NjUsNyArNzY1LDcg
QEAgc3RhdGljIGJvb2xfdCBfX2luaXQgc2V0X2lvbW11X2ludGVycnVwdF9oYW5kbGVyKHN0cnVj
dCBhbWRfaW9tbXUgKmlvbW11KQogewogICAgIGludCBpcnEsIHJldDsKIAotICAgIGlycSA9IGNy
ZWF0ZV9pcnEoTlVNQV9OT19OT0RFKTsKKyAgICBpcnEgPSBjcmVhdGVfaXJxKE5VTUFfTk9fTk9E
RSwgTlVMTCk7CiAgICAgaWYgKCBpcnEgPD0gMCApCiAgICAgewogICAgICAgICBkcHJpbnRrKFhF
TkxPR19FUlIsICJJT01NVTogbm8gaXJxc1xuIik7CmRpZmYgLS1naXQgYS94ZW4vZHJpdmVycy9w
YXNzdGhyb3VnaC92dGQvaW9tbXUuYyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9pb21t
dS5jCmluZGV4IDVkNzIyNzAuLjc0NDBiYWMgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL3Bhc3N0
aHJvdWdoL3Z0ZC9pb21tdS5jCisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9pb21t
dS5jCkBAIC0xMTM4LDcgKzExMzgsOCBAQCBzdGF0aWMgaW50IF9faW5pdCBpb21tdV9zZXRfaW50
ZXJydXB0KHN0cnVjdCBhY3BpX2RyaGRfdW5pdCAqZHJoZCkKICAgICBzdHJ1Y3QgaXJxX2Rlc2Mg
KmRlc2M7CiAKICAgICBpcnEgPSBjcmVhdGVfaXJxKHJoc2EgPyBweG1fdG9fbm9kZShyaHNhLT5w
cm94aW1pdHlfZG9tYWluKQotICAgICAgICAgICAgICAgICAgICAgICAgICA6IE5VTUFfTk9fTk9E
RSk7CisgICAgICAgICAgICAgICAgICAgICAgICAgIDogTlVNQV9OT19OT0RFLAorICAgICAgICAg
ICAgICAgICAgICAgTlVMTCk7CiAgICAgaWYgKCBpcnEgPD0gMCApCiAgICAgewogICAgICAgICBk
cHJpbnRrKFhFTkxPR19FUlIgVlREUFJFRklYLCAiSU9NTVU6IG5vIGlycSBhdmFpbGFibGUhXG4i
KTsKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL2FzbS14ODYvaXJxLmggYi94ZW4vaW5jbHVkZS9h
c20teDg2L2lycS5oCmluZGV4IGJjMGMwYzEuLjdjZjhhMWIgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNs
dWRlL2FzbS14ODYvaXJxLmgKKysrIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9pcnEuaApAQCAtNDUs
NiArNDUsMTEgQEAgc3RydWN0IGFyY2hfaXJxX2Rlc2MgewogICAgICAgICB1bnNpZ25lZCBtb3Zl
X2NsZWFudXBfY291bnQ7CiAgICAgICAgIHU4IG1vdmVfaW5fcHJvZ3Jlc3MgOiAxOwogICAgICAg
ICBzOCB1c2VkOworICAgICAgICAvKgorICAgICAgICAgKiB3ZWFrIHJlZmVyZW5jZSB0byBkb21h
aW4gaGF2aW5nIHBlcm1pc3Npb24gb3ZlciB0aGlzIElSUSAod2hpY2ggY2FuCisgICAgICAgICAq
IGJlIGRpZmZlcmVudCBmcm9tIHRoZSBkb21haW4gYWN0dWFsbHkgaGF2aW50IHRoZSBJUlEgYXNz
aWduZWQpCisgICAgICAgICAqLworICAgICAgICBkb21pZF90IGNyZWF0b3JfZG9taWQ7CiB9Owog
CiAvKiBGb3IgdXNlIHdpdGggaXJxX2Rlc2MuYXJjaC51c2VkICovCkBAIC0xNjEsNyArMTY2LDcg
QEAgaW50ICBpbml0X2lycV9kYXRhKHZvaWQpOwogdm9pZCBjbGVhcl9pcnFfdmVjdG9yKGludCBp
cnEpOwogCiBpbnQgaXJxX3RvX3ZlY3RvcihpbnQgaXJxKTsKLWludCBjcmVhdGVfaXJxKG5vZGVp
ZF90IG5vZGUpOworaW50IGNyZWF0ZV9pcnEobm9kZWlkX3Qgbm9kZSwgc3RydWN0IGRvbWFpbiAq
ZCk7CiB2b2lkIGRlc3Ryb3lfaXJxKHVuc2lnbmVkIGludCBpcnEpOwogaW50IGFzc2lnbl9pcnFf
dmVjdG9yKGludCBpcnEsIGNvbnN0IGNwdW1hc2tfdCAqKTsKIAotLSAKZ2l0LXNlcmllcyAwLjku
MQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRl
dmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9s
aXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

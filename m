Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id B44BD179FB
	for <lists+xen-devel@lfdr.de>; Wed,  8 May 2019 15:10:56 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hOMJt-0006Ze-Bz; Wed, 08 May 2019 13:09:13 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=RDkG=TI=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1hOMJr-0006ZR-S6
 for xen-devel@lists.xenproject.org; Wed, 08 May 2019 13:09:11 +0000
X-Inumbo-ID: 780beacb-7192-11e9-843c-bc764e045a96
Received: from prv1-mh.provo.novell.com (unknown [137.65.248.33])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 780beacb-7192-11e9-843c-bc764e045a96;
 Wed, 08 May 2019 13:09:10 +0000 (UTC)
Received: from INET-PRV1-MTA by prv1-mh.provo.novell.com
 with Novell_GroupWise; Wed, 08 May 2019 07:09:10 -0600
Message-Id: <5CD2D4F4020000780022CD3A@prv1-mh.provo.novell.com>
X-Mailer: Novell GroupWise Internet Agent 18.1.0 
Date: Wed, 08 May 2019 07:09:08 -0600
From: "Jan Beulich" <JBeulich@suse.com>
To: "xen-devel" <xen-devel@lists.xenproject.org>
References: <5CC6DD090200007800229E80@prv1-mh.provo.novell.com>
 <5CD2D2C8020000780022CCF2@prv1-mh.provo.novell.com>
In-Reply-To: <5CD2D2C8020000780022CCF2@prv1-mh.provo.novell.com>
Mime-Version: 1.0
Content-Disposition: inline
Subject: [Xen-devel] [PATCH v2 05/12] x86/IRQ: desc->affinity should
 strictly represent the requested value
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>, Wei Liu <wei.liu2@citrix.com>,
 Roger Pau Monne <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

ZGVzYy0+YXJjaC5jcHVfbWFzayByZWZsZWN0cyB0aGUgYWN0dWFsIHNldCBvZiB0YXJnZXQgQ1BV
cy4gRG9uJ3QgZXZlcgpmaWRkbGUgd2l0aCBkZXNjLT5hZmZpbml0eSBpdHNlbGYsIGV4Y2VwdCB0
byBzdG9yZSBjYWxsZXIgcmVxdWVzdGVkCnZhbHVlcy4gTm90ZSB0aGF0IGFzc2lnbl9pcnFfdmVj
dG9yKCkgbm93IHRha2VzIGEgTlVMTCBpbmNvbWluZyBDUFUgbWFzawp0byBtZWFuICJhbGwgQ1BV
cyIgbm93LCByYXRoZXIgdGhhbiBqdXN0ICJhbGwgY3VycmVudGx5IG9ubGluZSBDUFVzIi4KVGhp
cyB3YXkgbm8gZnVydGhlciBhZmZpbml0eSBhZGp1c3RtZW50IGlzIG5lZWRlZCBhZnRlciBvbmxp
bmluZyBmdXJ0aGVyCkNQVXMuCgpUaGlzIHJlbmRlcnMgYm90aCBzZXRfbmF0aXZlX2lycV9pbmZv
KCkgdXNlcyAod2hpY2ggd2VyZW4ndCB1c2luZyBwcm9wZXIKbG9ja2luZyBhbnl3YXkpIHJlZHVu
ZGFudCAtIGRyb3AgdGhlIGZ1bmN0aW9uIGFsdG9nZXRoZXIuCgpTaWduZWQtb2ZmLWJ5OiBKYW4g
QmV1bGljaCA8amJldWxpY2hAc3VzZS5jb20+ClJldmlld2VkLWJ5OiBSb2dlciBQYXUgTW9ubsOp
IDxyb2dlci5wYXVAY2l0cml4LmNvbT4KCi0tLSBhL3hlbi9hcmNoL3g4Ni9pb19hcGljLmMKKysr
IGIveGVuL2FyY2gveDg2L2lvX2FwaWMuYwpAQCAtMTA0Miw3ICsxMDQyLDYgQEAgc3RhdGljIHZv
aWQgX19pbml0IHNldHVwX0lPX0FQSUNfaXJxcyh2bwogICAgICAgICAgICAgU0VUX0RFU1QoZW50
cnksIGxvZ2ljYWwsIGNwdV9tYXNrX3RvX2FwaWNpZChUQVJHRVRfQ1BVUykpOwogICAgICAgICAg
ICAgc3Bpbl9sb2NrX2lycXNhdmUoJmlvYXBpY19sb2NrLCBmbGFncyk7CiAgICAgICAgICAgICBf
X2lvYXBpY193cml0ZV9lbnRyeShhcGljLCBwaW4sIDAsIGVudHJ5KTsKLSAgICAgICAgICAgIHNl
dF9uYXRpdmVfaXJxX2luZm8oaXJxLCBUQVJHRVRfQ1BVUyk7CiAgICAgICAgICAgICBzcGluX3Vu
bG9ja19pcnFyZXN0b3JlKCZpb2FwaWNfbG9jaywgZmxhZ3MpOwogICAgICAgICB9CiAgICAgfQpA
QCAtMjI1MSw3ICsyMjUwLDYgQEAgaW50IGlvX2FwaWNfc2V0X3BjaV9yb3V0aW5nIChpbnQgaW9h
cGljLAogCiAgICAgc3Bpbl9sb2NrX2lycXNhdmUoJmlvYXBpY19sb2NrLCBmbGFncyk7CiAgICAg
X19pb2FwaWNfd3JpdGVfZW50cnkoaW9hcGljLCBwaW4sIDAsIGVudHJ5KTsKLSAgICBzZXRfbmF0
aXZlX2lycV9pbmZvKGlycSwgVEFSR0VUX0NQVVMpOwogICAgIHNwaW5fdW5sb2NrKCZpb2FwaWNf
bG9jayk7CiAKICAgICBzcGluX2xvY2soJmRlc2MtPmxvY2spOwotLS0gYS94ZW4vYXJjaC94ODYv
aXJxLmMKKysrIGIveGVuL2FyY2gveDg2L2lycS5jCkBAIC01ODIsMTEgKzU4MiwxNiBAQCBpbnQg
YXNzaWduX2lycV92ZWN0b3IoaW50IGlycSwgY29uc3QgY3B1CiAKICAgICBzcGluX2xvY2tfaXJx
c2F2ZSgmdmVjdG9yX2xvY2ssIGZsYWdzKTsKICAgICByZXQgPSBfX2Fzc2lnbl9pcnFfdmVjdG9y
KGlycSwgZGVzYywgbWFzayA/OiBUQVJHRVRfQ1BVUyk7Ci0gICAgaWYgKCFyZXQpIHsKKyAgICBp
ZiAoICFyZXQgKQorICAgIHsKICAgICAgICAgcmV0ID0gZGVzYy0+YXJjaC52ZWN0b3I7Ci0gICAg
ICAgIGNwdW1hc2tfY29weShkZXNjLT5hZmZpbml0eSwgZGVzYy0+YXJjaC5jcHVfbWFzayk7Cisg
ICAgICAgIGlmICggbWFzayApCisgICAgICAgICAgICBjcHVtYXNrX2NvcHkoZGVzYy0+YWZmaW5p
dHksIG1hc2spOworICAgICAgICBlbHNlCisgICAgICAgICAgICBjcHVtYXNrX3NldGFsbChkZXNj
LT5hZmZpbml0eSk7CiAgICAgfQogICAgIHNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnZlY3Rvcl9s
b2NrLCBmbGFncyk7CisKICAgICByZXR1cm4gcmV0OwogfQogCkBAIC0yMzI4LDkgKzIzMzMsMTAg
QEAgc3RhdGljIHZvaWQgZHVtcF9pcnFzKHVuc2lnbmVkIGNoYXIga2V5KQogCiAgICAgICAgIHNw
aW5fbG9ja19pcnFzYXZlKCZkZXNjLT5sb2NrLCBmbGFncyk7CiAKLSAgICAgICAgcHJpbnRrKCIg
ICBJUlE6JTRkIGFmZjolKnBiIHZlYzolMDJ4ICUtMTVzIHN0YXR1cz0lMDN4ICIsCi0gICAgICAg
ICAgICAgICBpcnEsIG5yX2NwdV9pZHMsIGNwdW1hc2tfYml0cyhkZXNjLT5hZmZpbml0eSksIGRl
c2MtPmFyY2gudmVjdG9yLAotICAgICAgICAgICAgICAgZGVzYy0+aGFuZGxlci0+dHlwZW5hbWUs
IGRlc2MtPnN0YXR1cyk7CisgICAgICAgIHByaW50aygiICAgSVJROiU0ZCBhZmY6JSpwYi8lKnBi
IHZlYzolMDJ4ICUtMTVzIHN0YXR1cz0lMDN4ICIsCisgICAgICAgICAgICAgICBpcnEsIG5yX2Nw
dV9pZHMsIGNwdW1hc2tfYml0cyhkZXNjLT5hZmZpbml0eSksCisgICAgICAgICAgICAgICBucl9j
cHVfaWRzLCBjcHVtYXNrX2JpdHMoZGVzYy0+YXJjaC5jcHVfbWFzayksCisgICAgICAgICAgICAg
ICBkZXNjLT5hcmNoLnZlY3RvciwgZGVzYy0+aGFuZGxlci0+dHlwZW5hbWUsIGRlc2MtPnN0YXR1
cyk7CiAKICAgICAgICAgaWYgKCBzc2lkICkKICAgICAgICAgICAgIHByaW50aygiWj0lLTI1cyAi
LCBzc2lkKTsKQEAgLTI0MTgsOCArMjQyNCw3IEBAIHZvaWQgZml4dXBfaXJxcyhjb25zdCBjcHVt
YXNrX3QgKm1hc2ssIGIKICAgICAgICAgICAgICAgICByZWxlYXNlX29sZF92ZWMoZGVzYyk7CiAg
ICAgICAgIH0KIAotICAgICAgICBjcHVtYXNrX2NvcHkoJmFmZmluaXR5LCBkZXNjLT5hZmZpbml0
eSk7Ci0gICAgICAgIGlmICggIWRlc2MtPmFjdGlvbiB8fCBjcHVtYXNrX3N1YnNldCgmYWZmaW5p
dHksIG1hc2spICkKKyAgICAgICAgaWYgKCAhZGVzYy0+YWN0aW9uIHx8IGNwdW1hc2tfc3Vic2V0
KGRlc2MtPmFmZmluaXR5LCBtYXNrKSApCiAgICAgICAgIHsKICAgICAgICAgICAgIHNwaW5fdW5s
b2NrKCZkZXNjLT5sb2NrKTsKICAgICAgICAgICAgIGNvbnRpbnVlOwpAQCAtMjQ1MiwxMiArMjQ1
NywxMyBAQCB2b2lkIGZpeHVwX2lycXMoY29uc3QgY3B1bWFza190ICptYXNrLCBiCiAgICAgICAg
ICAgICBkZXNjLT5hcmNoLm1vdmVfaW5fcHJvZ3Jlc3MgPSAwOwogICAgICAgICB9CiAKLSAgICAg
ICAgY3B1bWFza19hbmQoJmFmZmluaXR5LCAmYWZmaW5pdHksIG1hc2spOwotICAgICAgICBpZiAo
IGNwdW1hc2tfZW1wdHkoJmFmZmluaXR5KSApCisgICAgICAgIGlmICggIWNwdW1hc2tfaW50ZXJz
ZWN0cyhtYXNrLCBkZXNjLT5hZmZpbml0eSkgKQogICAgICAgICB7CiAgICAgICAgICAgICBicmVh
a19hZmZpbml0eSA9IHRydWU7Ci0gICAgICAgICAgICBjcHVtYXNrX2NvcHkoJmFmZmluaXR5LCBt
YXNrKTsKKyAgICAgICAgICAgIGNwdW1hc2tfc2V0YWxsKCZhZmZpbml0eSk7CiAgICAgICAgIH0K
KyAgICAgICAgZWxzZQorICAgICAgICAgICAgY3B1bWFza19jb3B5KCZhZmZpbml0eSwgZGVzYy0+
YWZmaW5pdHkpOwogCiAgICAgICAgIGlmICggZGVzYy0+aGFuZGxlci0+ZGlzYWJsZSApCiAgICAg
ICAgICAgICBkZXNjLT5oYW5kbGVyLT5kaXNhYmxlKGRlc2MpOwotLS0gYS94ZW4vaW5jbHVkZS94
ZW4vaXJxLmgKKysrIGIveGVuL2luY2x1ZGUveGVuL2lycS5oCkBAIC0xNjIsMTEgKzE2Miw2IEBA
IGV4dGVybiBpcnFfZGVzY190ICpkb21haW5fc3Bpbl9sb2NrX2lycV8KIGV4dGVybiBpcnFfZGVz
Y190ICpwaXJxX3NwaW5fbG9ja19pcnFfZGVzYygKICAgICBjb25zdCBzdHJ1Y3QgcGlycSAqLCB1
bnNpZ25lZCBsb25nICpwZmxhZ3MpOwogCi1zdGF0aWMgaW5saW5lIHZvaWQgc2V0X25hdGl2ZV9p
cnFfaW5mbyh1bnNpZ25lZCBpbnQgaXJxLCBjb25zdCBjcHVtYXNrX3QgKm1hc2spCi17Ci0gICAg
Y3B1bWFza19jb3B5KGlycV90b19kZXNjKGlycSktPmFmZmluaXR5LCBtYXNrKTsKLX0KLQogdW5z
aWduZWQgaW50IHNldF9kZXNjX2FmZmluaXR5KHN0cnVjdCBpcnFfZGVzYyAqLCBjb25zdCBjcHVt
YXNrX3QgKik7CiAKICNpZm5kZWYgYXJjaF9od2RvbV9pcnFzCgoKCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhl
bi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3Jn
L21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

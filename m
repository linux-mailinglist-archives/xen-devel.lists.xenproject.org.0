Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 4A9B3AD5A8
	for <lists+xen-devel@lfdr.de>; Mon,  9 Sep 2019 11:27:53 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i7FvG-0005Bm-PH; Mon, 09 Sep 2019 09:25:22 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=m/oR=XE=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1i7FvF-0005BR-4H
 for xen-devel@lists.xenproject.org; Mon, 09 Sep 2019 09:25:21 +0000
X-Inumbo-ID: b8513ac4-d2e3-11e9-ac09-12813bfff9fa
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id b8513ac4-d2e3-11e9-ac09-12813bfff9fa;
 Mon, 09 Sep 2019 09:25:10 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id DC04DAF65;
 Mon,  9 Sep 2019 09:25:09 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Mon,  9 Sep 2019 11:25:03 +0200
Message-Id: <20190909092506.24792-3-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190909092506.24792-1-jgross@suse.com>
References: <20190909092506.24792-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v7 2/5] xen: move debugtrace coding to
 common/debugtrace.c
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SW5zdGVhZCBvZiBsaXZpbmcgaW4gZHJpdmVycy9jaGFyL2NvbnNvbGUuYyBtb3ZlIHRoZSBkZWJ1
Z3RyYWNlCnJlbGF0ZWQgY29kaW5nIHRvIGEgbmV3IGZpbGUgY29tbW9uL2RlYnVndHJhY2UuYwoK
Tm8gZnVuY3Rpb25hbCBjaGFuZ2UsIGNvZGUgbW92ZW1lbnQgb25seS4KClNpZ25lZC1vZmYtYnk6
IEp1ZXJnZW4gR3Jvc3MgPGpncm9zc0BzdXNlLmNvbT4KQWNrZWQtYnk6IEphbiBCZXVsaWNoIDxq
YmV1bGljaEBzdXNlLmNvbT4KLS0tCiB4ZW4vY29tbW9uL01ha2VmaWxlICAgICAgICB8ICAgMSAr
CiB4ZW4vY29tbW9uL2RlYnVndHJhY2UuYyAgICB8IDE4MCArKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysKIHhlbi9kcml2ZXJzL2NoYXIvY29uc29sZS5jIHwgMTc4
ICstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAzIGZpbGVzIGNo
YW5nZWQsIDE4MiBpbnNlcnRpb25zKCspLCAxNzcgZGVsZXRpb25zKC0pCiBjcmVhdGUgbW9kZSAx
MDA2NDQgeGVuL2NvbW1vbi9kZWJ1Z3RyYWNlLmMKCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL01h
a2VmaWxlIGIveGVuL2NvbW1vbi9NYWtlZmlsZQppbmRleCBlZGRkYTVkYWE2Li42MmIzNGU2OWU5
IDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL01ha2VmaWxlCisrKyBiL3hlbi9jb21tb24vTWFrZWZp
bGUKQEAgLTQsNiArNCw3IEBAIG9iai15ICs9IGJzZWFyY2gubwogb2JqLSQoQ09ORklHX0NPUkVf
UEFSS0lORykgKz0gY29yZV9wYXJraW5nLm8KIG9iai15ICs9IGNwdS5vCiBvYmoteSArPSBjcHVw
b29sLm8KK29iai0kKENPTkZJR19ERUJVR19UUkFDRSkgKz0gZGVidWd0cmFjZS5vCiBvYmotJChD
T05GSUdfSEFTX0RFVklDRV9UUkVFKSArPSBkZXZpY2VfdHJlZS5vCiBvYmoteSArPSBkb21jdGwu
bwogb2JqLXkgKz0gZG9tYWluLm8KZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vZGVidWd0cmFjZS5j
IGIveGVuL2NvbW1vbi9kZWJ1Z3RyYWNlLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAw
MDAwMDAwMC4uOTNjZGRkYjYxYwotLS0gL2Rldi9udWxsCisrKyBiL3hlbi9jb21tb24vZGVidWd0
cmFjZS5jCkBAIC0wLDAgKzEsMTgwIEBACisvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCisgKiBkZWJ1
Z3RyYWNlLmMKKyAqCisgKiBEZWJ1Z3RyYWNlIGZvciBYZW4KKyAqLworCisKKyNpbmNsdWRlIDx4
ZW4vY29uc29sZS5oPgorI2luY2x1ZGUgPHhlbi9pbml0Lmg+CisjaW5jbHVkZSA8eGVuL2tleWhh
bmRsZXIuaD4KKyNpbmNsdWRlIDx4ZW4vbGliLmg+CisjaW5jbHVkZSA8eGVuL21tLmg+CisjaW5j
bHVkZSA8eGVuL3NlcmlhbC5oPgorI2luY2x1ZGUgPHhlbi9zcGlubG9jay5oPgorI2luY2x1ZGUg
PHhlbi93YXRjaGRvZy5oPgorCisvKiBTZW5kIG91dHB1dCBkaXJlY3QgdG8gY29uc29sZSwgb3Ig
YnVmZmVyIGl0PyAqLworc3RhdGljIHZvbGF0aWxlIGludCBkZWJ1Z3RyYWNlX3NlbmRfdG9fY29u
c29sZTsKKworc3RhdGljIGNoYXIgICAgICAgICpkZWJ1Z3RyYWNlX2J1ZjsgLyogRGVidWctdHJh
Y2UgYnVmZmVyICovCitzdGF0aWMgdW5zaWduZWQgaW50IGRlYnVndHJhY2VfcHJkOyAvKiBQcm9k
dWNlciBpbmRleCAgICAgKi8KK3N0YXRpYyB1bnNpZ25lZCBpbnQgZGVidWd0cmFjZV9raWxvYnl0
ZXMgPSAxMjgsIGRlYnVndHJhY2VfYnl0ZXM7CitzdGF0aWMgdW5zaWduZWQgaW50IGRlYnVndHJh
Y2VfdXNlZDsKK3N0YXRpYyBib29sIGRlYnVndHJhY2VfYnVmX2VtcHR5ID0gdHJ1ZTsKK3N0YXRp
YyBERUZJTkVfU1BJTkxPQ0soZGVidWd0cmFjZV9sb2NrKTsKK2ludGVnZXJfcGFyYW0oImRlYnVn
dHJhY2UiLCBkZWJ1Z3RyYWNlX2tpbG9ieXRlcyk7CisKK3N0YXRpYyB2b2lkIGRlYnVndHJhY2Vf
ZHVtcF93b3JrZXIodm9pZCkKK3sKKyAgICBpZiAoIChkZWJ1Z3RyYWNlX2J5dGVzID09IDApIHx8
ICFkZWJ1Z3RyYWNlX3VzZWQgKQorICAgICAgICByZXR1cm47CisKKyAgICBwcmludGsoImRlYnVn
dHJhY2VfZHVtcCgpIHN0YXJ0aW5nXG4iKTsKKworICAgIC8qIFByaW50IG9sZGVzdCBwb3J0aW9u
IG9mIHRoZSByaW5nLiAqLworICAgIGlmICggZGVidWd0cmFjZV9idWZbZGVidWd0cmFjZV9wcmRd
ICE9ICdcMCcgKQorICAgICAgICBjb25zb2xlX3NlcmlhbF9wdXRzKCZkZWJ1Z3RyYWNlX2J1Zltk
ZWJ1Z3RyYWNlX3ByZF0sCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVidWd0cmFjZV9i
eXRlcyAtIGRlYnVndHJhY2VfcHJkKTsKKworICAgIC8qIFByaW50IHlvdW5nZXN0IHBvcnRpb24g
b2YgdGhlIHJpbmcuICovCisgICAgZGVidWd0cmFjZV9idWZbZGVidWd0cmFjZV9wcmRdID0gJ1ww
JzsKKyAgICBjb25zb2xlX3NlcmlhbF9wdXRzKCZkZWJ1Z3RyYWNlX2J1ZlswXSwgZGVidWd0cmFj
ZV9wcmQpOworCisgICAgbWVtc2V0KGRlYnVndHJhY2VfYnVmLCAnXDAnLCBkZWJ1Z3RyYWNlX2J5
dGVzKTsKKyAgICBkZWJ1Z3RyYWNlX3ByZCA9IDA7CisgICAgZGVidWd0cmFjZV9idWZfZW1wdHkg
PSB0cnVlOworCisgICAgcHJpbnRrKCJkZWJ1Z3RyYWNlX2R1bXAoKSBmaW5pc2hlZFxuIik7Cit9
CisKK3N0YXRpYyB2b2lkIGRlYnVndHJhY2VfdG9nZ2xlKHZvaWQpCit7CisgICAgdW5zaWduZWQg
bG9uZyBmbGFnczsKKworICAgIHdhdGNoZG9nX2Rpc2FibGUoKTsKKyAgICBzcGluX2xvY2tfaXJx
c2F2ZSgmZGVidWd0cmFjZV9sb2NrLCBmbGFncyk7CisKKyAgICAvKgorICAgICAqIER1bXAgdGhl
IGJ1ZmZlciAqYmVmb3JlKiB0b2dnbGluZywgaW4gY2FzZSB0aGUgYWN0IG9mIGR1bXBpbmcgdGhl
CisgICAgICogYnVmZmVyIGl0c2VsZiBjYXVzZXMgbW9yZSBwcmludGsoKSBpbnZvY2F0aW9ucy4K
KyAgICAgKi8KKyAgICBwcmludGsoImRlYnVndHJhY2VfcHJpbnRrIG5vdyB3cml0aW5nIHRvICVz
LlxuIiwKKyAgICAgICAgICAgIWRlYnVndHJhY2Vfc2VuZF90b19jb25zb2xlID8gImNvbnNvbGUi
OiAiYnVmZmVyIik7CisgICAgaWYgKCAhZGVidWd0cmFjZV9zZW5kX3RvX2NvbnNvbGUgKQorICAg
ICAgICBkZWJ1Z3RyYWNlX2R1bXBfd29ya2VyKCk7CisKKyAgICBkZWJ1Z3RyYWNlX3NlbmRfdG9f
Y29uc29sZSA9ICFkZWJ1Z3RyYWNlX3NlbmRfdG9fY29uc29sZTsKKworICAgIHNwaW5fdW5sb2Nr
X2lycXJlc3RvcmUoJmRlYnVndHJhY2VfbG9jaywgZmxhZ3MpOworICAgIHdhdGNoZG9nX2VuYWJs
ZSgpOworCit9CisKK3ZvaWQgZGVidWd0cmFjZV9kdW1wKHZvaWQpCit7CisgICAgdW5zaWduZWQg
bG9uZyBmbGFnczsKKworICAgIHdhdGNoZG9nX2Rpc2FibGUoKTsKKyAgICBzcGluX2xvY2tfaXJx
c2F2ZSgmZGVidWd0cmFjZV9sb2NrLCBmbGFncyk7CisKKyAgICBkZWJ1Z3RyYWNlX2R1bXBfd29y
a2VyKCk7CisKKyAgICBzcGluX3VubG9ja19pcnFyZXN0b3JlKCZkZWJ1Z3RyYWNlX2xvY2ssIGZs
YWdzKTsKKyAgICB3YXRjaGRvZ19lbmFibGUoKTsKK30KKworc3RhdGljIHZvaWQgZGVidWd0cmFj
ZV9hZGRfdG9fYnVmKGNoYXIgKmJ1ZikKK3sKKyAgICBjaGFyICpwOworCisgICAgZm9yICggcCA9
IGJ1ZjsgKnAgIT0gJ1wwJzsgcCsrICkKKyAgICB7CisgICAgICAgIGRlYnVndHJhY2VfYnVmW2Rl
YnVndHJhY2VfcHJkKytdID0gKnA7CisgICAgICAgIGlmICggZGVidWd0cmFjZV9wcmQgPT0gZGVi
dWd0cmFjZV9ieXRlcyApCisgICAgICAgICAgICBkZWJ1Z3RyYWNlX3ByZCA9IDA7CisgICAgfQor
fQorCit2b2lkIGRlYnVndHJhY2VfcHJpbnRrKGNvbnN0IGNoYXIgKmZtdCwgLi4uKQoreworICAg
IHN0YXRpYyBjaGFyIGJ1ZlsxMDI0XSwgbGFzdF9idWZbMTAyNF07CisgICAgc3RhdGljIHVuc2ln
bmVkIGludCBjb3VudCwgbGFzdF9jb3VudCwgbGFzdF9wcmQ7CisKKyAgICBjaGFyICAgICAgICAg
IGNudGJ1ZlsyNF07CisgICAgdmFfbGlzdCAgICAgICBhcmdzOworICAgIHVuc2lnbmVkIGxvbmcg
ZmxhZ3M7CisgICAgdW5zaWduZWQgaW50IG5yOworCisgICAgaWYgKCBkZWJ1Z3RyYWNlX2J5dGVz
ID09IDAgKQorICAgICAgICByZXR1cm47CisKKyAgICBkZWJ1Z3RyYWNlX3VzZWQgPSAxOworCisg
ICAgc3Bpbl9sb2NrX2lycXNhdmUoJmRlYnVndHJhY2VfbG9jaywgZmxhZ3MpOworCisgICAgdmFf
c3RhcnQoYXJncywgZm10KTsKKyAgICBuciA9IHZzbnByaW50ZihidWYsIHNpemVvZihidWYpLCBm
bXQsIGFyZ3MpOworICAgIHZhX2VuZChhcmdzKTsKKworICAgIGlmICggZGVidWd0cmFjZV9zZW5k
X3RvX2NvbnNvbGUgKQorICAgIHsKKyAgICAgICAgdW5zaWduZWQgaW50IG4gPSBzY25wcmludGYo
Y250YnVmLCBzaXplb2YoY250YnVmKSwgIiV1ICIsICsrY291bnQpOworCisgICAgICAgIGNvbnNv
bGVfc2VyaWFsX3B1dHMoY250YnVmLCBuKTsKKyAgICAgICAgY29uc29sZV9zZXJpYWxfcHV0cyhi
dWYsIG5yKTsKKyAgICB9CisgICAgZWxzZQorICAgIHsKKyAgICAgICAgaWYgKCBkZWJ1Z3RyYWNl
X2J1Zl9lbXB0eSB8fCBzdHJjbXAoYnVmLCBsYXN0X2J1ZikgKQorICAgICAgICB7CisgICAgICAg
ICAgICBkZWJ1Z3RyYWNlX2J1Zl9lbXB0eSA9IGZhbHNlOworICAgICAgICAgICAgbGFzdF9wcmQg
PSBkZWJ1Z3RyYWNlX3ByZDsKKyAgICAgICAgICAgIGxhc3RfY291bnQgPSArK2NvdW50OworICAg
ICAgICAgICAgc2FmZV9zdHJjcHkobGFzdF9idWYsIGJ1Zik7CisgICAgICAgICAgICBzbnByaW50
ZihjbnRidWYsIHNpemVvZihjbnRidWYpLCAiJXUgIiwgY291bnQpOworICAgICAgICB9CisgICAg
ICAgIGVsc2UKKyAgICAgICAgeworICAgICAgICAgICAgZGVidWd0cmFjZV9wcmQgPSBsYXN0X3By
ZDsKKyAgICAgICAgICAgIHNucHJpbnRmKGNudGJ1Ziwgc2l6ZW9mKGNudGJ1ZiksICIldS0ldSAi
LCBsYXN0X2NvdW50LCArK2NvdW50KTsKKyAgICAgICAgfQorICAgICAgICBkZWJ1Z3RyYWNlX2Fk
ZF90b19idWYoY250YnVmKTsKKyAgICAgICAgZGVidWd0cmFjZV9hZGRfdG9fYnVmKGJ1Zik7Cisg
ICAgfQorCisgICAgc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZGVidWd0cmFjZV9sb2NrLCBmbGFn
cyk7Cit9CisKK3N0YXRpYyB2b2lkIGRlYnVndHJhY2Vfa2V5KHVuc2lnbmVkIGNoYXIga2V5KQor
eworICAgIGRlYnVndHJhY2VfdG9nZ2xlKCk7Cit9CisKK3N0YXRpYyBpbnQgX19pbml0IGRlYnVn
dHJhY2VfaW5pdCh2b2lkKQoreworICAgIGludCBvcmRlcjsKKyAgICB1bnNpZ25lZCBpbnQga2J5
dGVzLCBieXRlczsKKworICAgIC8qIFJvdW5kIHNpemUgZG93biB0byBuZXh0IHBvd2VyIG9mIHR3
by4gKi8KKyAgICB3aGlsZSAoIChrYnl0ZXMgPSAoZGVidWd0cmFjZV9raWxvYnl0ZXMgJiAoZGVi
dWd0cmFjZV9raWxvYnl0ZXMtMSkpKSAhPSAwICkKKyAgICAgICAgZGVidWd0cmFjZV9raWxvYnl0
ZXMgPSBrYnl0ZXM7CisKKyAgICBieXRlcyA9IGRlYnVndHJhY2Vfa2lsb2J5dGVzIDw8IDEwOwor
ICAgIGlmICggYnl0ZXMgPT0gMCApCisgICAgICAgIHJldHVybiAwOworCisgICAgb3JkZXIgPSBn
ZXRfb3JkZXJfZnJvbV9ieXRlcyhieXRlcyk7CisgICAgZGVidWd0cmFjZV9idWYgPSBhbGxvY194
ZW5oZWFwX3BhZ2VzKG9yZGVyLCAwKTsKKyAgICBBU1NFUlQoZGVidWd0cmFjZV9idWYgIT0gTlVM
TCk7CisKKyAgICBtZW1zZXQoZGVidWd0cmFjZV9idWYsICdcMCcsIGJ5dGVzKTsKKworICAgIGRl
YnVndHJhY2VfYnl0ZXMgPSBieXRlczsKKworICAgIHJlZ2lzdGVyX2tleWhhbmRsZXIoJ1QnLCBk
ZWJ1Z3RyYWNlX2tleSwKKyAgICAgICAgICAgICAgICAgICAgICAgICJ0b2dnbGUgZGVidWd0cmFj
ZSB0byBjb25zb2xlL2J1ZmZlciIsIDApOworCisgICAgcmV0dXJuIDA7Cit9CitfX2luaXRjYWxs
KGRlYnVndHJhY2VfaW5pdCk7CmRpZmYgLS1naXQgYS94ZW4vZHJpdmVycy9jaGFyL2NvbnNvbGUu
YyBiL3hlbi9kcml2ZXJzL2NoYXIvY29uc29sZS5jCmluZGV4IDM3ODM2MThjMTcuLjdmMjkxOTBl
YWYgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL2NoYXIvY29uc29sZS5jCisrKyBiL3hlbi9kcml2
ZXJzL2NoYXIvY29uc29sZS5jCkBAIC0xMTYwLDE4MyArMTE2MCw3IEBAIGludCBwcmludGtfcmF0
ZWxpbWl0KHZvaWQpCiAKIC8qCiAgKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKgotICogKioqKioqKioqKioqKioqIFNlcmlhbCBj
b25zb2xlIHJpbmcgYnVmZmVyICoqKioqKioqKioqKioqKioqKioKLSAqICoqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCi0gKi8KLQot
I2lmZGVmIENPTkZJR19ERUJVR19UUkFDRQotCi0vKiBTZW5kIG91dHB1dCBkaXJlY3QgdG8gY29u
c29sZSwgb3IgYnVmZmVyIGl0PyAqLwotc3RhdGljIHZvbGF0aWxlIGludCBkZWJ1Z3RyYWNlX3Nl
bmRfdG9fY29uc29sZTsKLQotc3RhdGljIGNoYXIgICAgICAgICpkZWJ1Z3RyYWNlX2J1ZjsgLyog
RGVidWctdHJhY2UgYnVmZmVyICovCi1zdGF0aWMgdW5zaWduZWQgaW50IGRlYnVndHJhY2VfcHJk
OyAvKiBQcm9kdWNlciBpbmRleCAgICAgKi8KLXN0YXRpYyB1bnNpZ25lZCBpbnQgZGVidWd0cmFj
ZV9raWxvYnl0ZXMgPSAxMjgsIGRlYnVndHJhY2VfYnl0ZXM7Ci1zdGF0aWMgdW5zaWduZWQgaW50
IGRlYnVndHJhY2VfdXNlZDsKLXN0YXRpYyBib29sIGRlYnVndHJhY2VfYnVmX2VtcHR5ID0gdHJ1
ZTsKLXN0YXRpYyBERUZJTkVfU1BJTkxPQ0soZGVidWd0cmFjZV9sb2NrKTsKLWludGVnZXJfcGFy
YW0oImRlYnVndHJhY2UiLCBkZWJ1Z3RyYWNlX2tpbG9ieXRlcyk7Ci0KLXN0YXRpYyB2b2lkIGRl
YnVndHJhY2VfZHVtcF93b3JrZXIodm9pZCkKLXsKLSAgICBpZiAoIChkZWJ1Z3RyYWNlX2J5dGVz
ID09IDApIHx8ICFkZWJ1Z3RyYWNlX3VzZWQgKQotICAgICAgICByZXR1cm47Ci0KLSAgICBwcmlu
dGsoImRlYnVndHJhY2VfZHVtcCgpIHN0YXJ0aW5nXG4iKTsKLQotICAgIC8qIFByaW50IG9sZGVz
dCBwb3J0aW9uIG9mIHRoZSByaW5nLiAqLwotICAgIGlmICggZGVidWd0cmFjZV9idWZbZGVidWd0
cmFjZV9wcmRdICE9ICdcMCcgKQotICAgICAgICBjb25zb2xlX3NlcmlhbF9wdXRzKCZkZWJ1Z3Ry
YWNlX2J1ZltkZWJ1Z3RyYWNlX3ByZF0sCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVi
dWd0cmFjZV9ieXRlcyAtIGRlYnVndHJhY2VfcHJkKTsKLQotICAgIC8qIFByaW50IHlvdW5nZXN0
IHBvcnRpb24gb2YgdGhlIHJpbmcuICovCi0gICAgZGVidWd0cmFjZV9idWZbZGVidWd0cmFjZV9w
cmRdID0gJ1wwJzsKLSAgICBjb25zb2xlX3NlcmlhbF9wdXRzKCZkZWJ1Z3RyYWNlX2J1ZlswXSwg
ZGVidWd0cmFjZV9wcmQpOwotCi0gICAgbWVtc2V0KGRlYnVndHJhY2VfYnVmLCAnXDAnLCBkZWJ1
Z3RyYWNlX2J5dGVzKTsKLSAgICBkZWJ1Z3RyYWNlX3ByZCA9IDA7Ci0gICAgZGVidWd0cmFjZV9i
dWZfZW1wdHkgPSB0cnVlOwotCi0gICAgcHJpbnRrKCJkZWJ1Z3RyYWNlX2R1bXAoKSBmaW5pc2hl
ZFxuIik7Ci19Ci0KLXN0YXRpYyB2b2lkIGRlYnVndHJhY2VfdG9nZ2xlKHZvaWQpCi17Ci0gICAg
dW5zaWduZWQgbG9uZyBmbGFnczsKLQotICAgIHdhdGNoZG9nX2Rpc2FibGUoKTsKLSAgICBzcGlu
X2xvY2tfaXJxc2F2ZSgmZGVidWd0cmFjZV9sb2NrLCBmbGFncyk7Ci0KLSAgICAvKgotICAgICAq
IER1bXAgdGhlIGJ1ZmZlciAqYmVmb3JlKiB0b2dnbGluZywgaW4gY2FzZSB0aGUgYWN0IG9mIGR1
bXBpbmcgdGhlCi0gICAgICogYnVmZmVyIGl0c2VsZiBjYXVzZXMgbW9yZSBwcmludGsoKSBpbnZv
Y2F0aW9ucy4KLSAgICAgKi8KLSAgICBwcmludGsoImRlYnVndHJhY2VfcHJpbnRrIG5vdyB3cml0
aW5nIHRvICVzLlxuIiwKLSAgICAgICAgICAgIWRlYnVndHJhY2Vfc2VuZF90b19jb25zb2xlID8g
ImNvbnNvbGUiOiAiYnVmZmVyIik7Ci0gICAgaWYgKCAhZGVidWd0cmFjZV9zZW5kX3RvX2NvbnNv
bGUgKQotICAgICAgICBkZWJ1Z3RyYWNlX2R1bXBfd29ya2VyKCk7Ci0KLSAgICBkZWJ1Z3RyYWNl
X3NlbmRfdG9fY29uc29sZSA9ICFkZWJ1Z3RyYWNlX3NlbmRfdG9fY29uc29sZTsKLQotICAgIHNw
aW5fdW5sb2NrX2lycXJlc3RvcmUoJmRlYnVndHJhY2VfbG9jaywgZmxhZ3MpOwotICAgIHdhdGNo
ZG9nX2VuYWJsZSgpOwotCi19Ci0KLXZvaWQgZGVidWd0cmFjZV9kdW1wKHZvaWQpCi17Ci0gICAg
dW5zaWduZWQgbG9uZyBmbGFnczsKLQotICAgIHdhdGNoZG9nX2Rpc2FibGUoKTsKLSAgICBzcGlu
X2xvY2tfaXJxc2F2ZSgmZGVidWd0cmFjZV9sb2NrLCBmbGFncyk7Ci0KLSAgICBkZWJ1Z3RyYWNl
X2R1bXBfd29ya2VyKCk7Ci0KLSAgICBzcGluX3VubG9ja19pcnFyZXN0b3JlKCZkZWJ1Z3RyYWNl
X2xvY2ssIGZsYWdzKTsKLSAgICB3YXRjaGRvZ19lbmFibGUoKTsKLX0KLQotc3RhdGljIHZvaWQg
ZGVidWd0cmFjZV9hZGRfdG9fYnVmKGNoYXIgKmJ1ZikKLXsKLSAgICBjaGFyICpwOwotCi0gICAg
Zm9yICggcCA9IGJ1ZjsgKnAgIT0gJ1wwJzsgcCsrICkKLSAgICB7Ci0gICAgICAgIGRlYnVndHJh
Y2VfYnVmW2RlYnVndHJhY2VfcHJkKytdID0gKnA7Ci0gICAgICAgIGlmICggZGVidWd0cmFjZV9w
cmQgPT0gZGVidWd0cmFjZV9ieXRlcyApCi0gICAgICAgICAgICBkZWJ1Z3RyYWNlX3ByZCA9IDA7
Ci0gICAgfQotfQotCi12b2lkIGRlYnVndHJhY2VfcHJpbnRrKGNvbnN0IGNoYXIgKmZtdCwgLi4u
KQotewotICAgIHN0YXRpYyBjaGFyIGJ1ZlsxMDI0XSwgbGFzdF9idWZbMTAyNF07Ci0gICAgc3Rh
dGljIHVuc2lnbmVkIGludCBjb3VudCwgbGFzdF9jb3VudCwgbGFzdF9wcmQ7Ci0KLSAgICBjaGFy
ICAgICAgICAgIGNudGJ1ZlsyNF07Ci0gICAgdmFfbGlzdCAgICAgICBhcmdzOwotICAgIHVuc2ln
bmVkIGxvbmcgZmxhZ3M7Ci0gICAgdW5zaWduZWQgaW50IG5yOwotCi0gICAgaWYgKCBkZWJ1Z3Ry
YWNlX2J5dGVzID09IDAgKQotICAgICAgICByZXR1cm47Ci0KLSAgICBkZWJ1Z3RyYWNlX3VzZWQg
PSAxOwotCi0gICAgc3Bpbl9sb2NrX2lycXNhdmUoJmRlYnVndHJhY2VfbG9jaywgZmxhZ3MpOwot
Ci0gICAgdmFfc3RhcnQoYXJncywgZm10KTsKLSAgICBuciA9IHZzY25wcmludGYoYnVmLCBzaXpl
b2YoYnVmKSwgZm10LCBhcmdzKTsKLSAgICB2YV9lbmQoYXJncyk7Ci0KLSAgICBpZiAoIGRlYnVn
dHJhY2Vfc2VuZF90b19jb25zb2xlICkKLSAgICB7Ci0gICAgICAgIHVuc2lnbmVkIGludCBuID0g
c2NucHJpbnRmKGNudGJ1Ziwgc2l6ZW9mKGNudGJ1ZiksICIldSAiLCArK2NvdW50KTsKLQotICAg
ICAgICBjb25zb2xlX3NlcmlhbF9wdXRzKGNudGJ1Ziwgbik7Ci0gICAgICAgIGNvbnNvbGVfc2Vy
aWFsX3B1dHMoYnVmLCBucik7Ci0gICAgfQotICAgIGVsc2UKLSAgICB7Ci0gICAgICAgIGlmICgg
ZGVidWd0cmFjZV9idWZfZW1wdHkgfHwgc3RyY21wKGJ1ZiwgbGFzdF9idWYpICkKLSAgICAgICAg
ewotICAgICAgICAgICAgZGVidWd0cmFjZV9idWZfZW1wdHkgPSBmYWxzZTsKLSAgICAgICAgICAg
IGxhc3RfcHJkID0gZGVidWd0cmFjZV9wcmQ7Ci0gICAgICAgICAgICBsYXN0X2NvdW50ID0gKytj
b3VudDsKLSAgICAgICAgICAgIHNhZmVfc3RyY3B5KGxhc3RfYnVmLCBidWYpOwotICAgICAgICAg
ICAgc25wcmludGYoY250YnVmLCBzaXplb2YoY250YnVmKSwgIiV1ICIsIGNvdW50KTsKLSAgICAg
ICAgfQotICAgICAgICBlbHNlCi0gICAgICAgIHsKLSAgICAgICAgICAgIGRlYnVndHJhY2VfcHJk
ID0gbGFzdF9wcmQ7Ci0gICAgICAgICAgICBzbnByaW50ZihjbnRidWYsIHNpemVvZihjbnRidWYp
LCAiJXUtJXUgIiwgbGFzdF9jb3VudCwgKytjb3VudCk7Ci0gICAgICAgIH0KLSAgICAgICAgZGVi
dWd0cmFjZV9hZGRfdG9fYnVmKGNudGJ1Zik7Ci0gICAgICAgIGRlYnVndHJhY2VfYWRkX3RvX2J1
ZihidWYpOwotICAgIH0KLQotICAgIHNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmRlYnVndHJhY2Vf
bG9jaywgZmxhZ3MpOwotfQotCi1zdGF0aWMgdm9pZCBkZWJ1Z3RyYWNlX2tleSh1bnNpZ25lZCBj
aGFyIGtleSkKLXsKLSAgICBkZWJ1Z3RyYWNlX3RvZ2dsZSgpOwotfQotCi1zdGF0aWMgaW50IF9f
aW5pdCBkZWJ1Z3RyYWNlX2luaXQodm9pZCkKLXsKLSAgICBpbnQgb3JkZXI7Ci0gICAgdW5zaWdu
ZWQgaW50IGtieXRlcywgYnl0ZXM7Ci0KLSAgICAvKiBSb3VuZCBzaXplIGRvd24gdG8gbmV4dCBw
b3dlciBvZiB0d28uICovCi0gICAgd2hpbGUgKCAoa2J5dGVzID0gKGRlYnVndHJhY2Vfa2lsb2J5
dGVzICYgKGRlYnVndHJhY2Vfa2lsb2J5dGVzLTEpKSkgIT0gMCApCi0gICAgICAgIGRlYnVndHJh
Y2Vfa2lsb2J5dGVzID0ga2J5dGVzOwotCi0gICAgYnl0ZXMgPSBkZWJ1Z3RyYWNlX2tpbG9ieXRl
cyA8PCAxMDsKLSAgICBpZiAoIGJ5dGVzID09IDAgKQotICAgICAgICByZXR1cm4gMDsKLQotICAg
IG9yZGVyID0gZ2V0X29yZGVyX2Zyb21fYnl0ZXMoYnl0ZXMpOwotICAgIGRlYnVndHJhY2VfYnVm
ID0gYWxsb2NfeGVuaGVhcF9wYWdlcyhvcmRlciwgMCk7Ci0gICAgQVNTRVJUKGRlYnVndHJhY2Vf
YnVmICE9IE5VTEwpOwotCi0gICAgbWVtc2V0KGRlYnVndHJhY2VfYnVmLCAnXDAnLCBieXRlcyk7
Ci0KLSAgICBkZWJ1Z3RyYWNlX2J5dGVzID0gYnl0ZXM7Ci0KLSAgICByZWdpc3Rlcl9rZXloYW5k
bGVyKCdUJywgZGVidWd0cmFjZV9rZXksCi0gICAgICAgICAgICAgICAgICAgICAgICAidG9nZ2xl
IGRlYnVndHJhY2UgdG8gY29uc29sZS9idWZmZXIiLCAwKTsKLQotICAgIHJldHVybiAwOwotfQot
X19pbml0Y2FsbChkZWJ1Z3RyYWNlX2luaXQpOwotCi0jZW5kaWYgLyogIUNPTkZJR19ERUJVR19U
UkFDRSAqLwotCi0KLS8qCi0gKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKgotICogKioqKioqKioqKioqKioqIERlYnVnZ2luZy90
cmFjaW5nL2Vycm9yLXJlcG9ydCAqKioqKioqKioqKioqKioKKyAqICoqKioqKioqKioqKioqKioq
KioqKiogRXJyb3ItcmVwb3J0ICoqKioqKioqKioqKioqKioqKioqKioqKioqCiAgKiAqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgog
ICovCiAKLS0gCjIuMTYuNAoKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2pl
Y3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4t
ZGV2ZWw=

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 68CE2B2AA2
	for <lists+xen-devel@lfdr.de>; Sat, 14 Sep 2019 10:56:15 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i93ni-0007Up-Ov; Sat, 14 Sep 2019 08:53:02 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=rDpt=XJ=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1i93nh-0007UO-9L
 for xen-devel@lists.xenproject.org; Sat, 14 Sep 2019 08:53:01 +0000
X-Inumbo-ID: 0d0245b2-d6cd-11e9-b76c-bc764e2007e4
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 0d0245b2-d6cd-11e9-b76c-bc764e2007e4;
 Sat, 14 Sep 2019 08:52:59 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id E8B1EB65D;
 Sat, 14 Sep 2019 08:52:56 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Sat, 14 Sep 2019 10:52:11 +0200
Message-Id: <20190914085251.18816-8-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190914085251.18816-1-jgross@suse.com>
References: <20190914085251.18816-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v3 07/47] xen/sched: move per cpu scheduler
 private data into struct sched_resource
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Tim Deegan <tim@xen.org>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>,
 Robert VanVossen <robert.vanvossen@dornerworks.com>,
 Dario Faggioli <dfaggioli@suse.com>, Julien Grall <julien.grall@arm.com>,
 Josh Whitehead <josh.whitehead@dornerworks.com>,
 Meng Xu <mengxu@cis.upenn.edu>, Jan Beulich <jbeulich@suse.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhpcyBwcmVwYXJlcyBzdXBwb3J0IG9mIGxhcmdlciBzY2hlZHVsaW5nIGdyYW51bGFyaXRpZXMs
IGUuZy4gY29yZQpzY2hlZHVsaW5nLgoKV2hpbGUgYXQgaXQgbW92ZSBzY2hlZF9oYXNfdXJnZW50
X3ZjcHUoKSBmcm9tIGluY2x1ZGUvYXNtLXg4Ni9jcHVpZGxlLmgKaW50byBzY2hlZC5oIHJlbW92
aW5nIHRoZSBuZWVkIGZvciBpbmNsdWRpbmcgc2NoZWQtaWYuaCBpbiBjcHVpZGxlLmguCkZvciB0
aGF0IHB1cnBvc2UgcmVtb2JlIHVyZ2VudF9jb3VudCBmcm9tIHRoZSBzY2hlZHVsZXIgcHJpdmF0
ZSBkYXRhCmFuZCBtYWtlIGl0IGEgcGxhaW4gcGVyY3B1IHZhcmlhYmxlLgoKU2lnbmVkLW9mZi1i
eTogSnVlcmdlbiBHcm9zcyA8amdyb3NzQHN1c2UuY29tPgotLS0KVjE6Ci0gbW92ZSBzY2hlZF9o
YXNfdXJnZW50X3ZjcHUoKQpWMjoKLSBtYWtlIHNjaGVkX2hhc191cmdlbnRfdmNwdSgpIHJldHVy
biBib29sIChKYW4gQmV1bGljaCkKVjM6Ci0gc3BsaXQgb3V0IHJlbW92aW5nIHNjaGVkLWlmLmgg
aW5jbHVkZSBpbiBzb21lIEMgZmlsZXMgKEphbiBCZXVsaWNoKQotIG1ha2UgdXJnZW50X2NvdW50
IGEgcGxhaW4gcGVyY3B1IHZhcmlhYmxlIChKYW4gQmV1bGljaCkKLS0tCiB4ZW4vY29tbW9uL3Nj
aGVkX2FyaW5jNjUzLmMgICB8ICA0ICsrLS0KIHhlbi9jb21tb24vc2NoZWRfY3JlZGl0LmMgICAg
IHwgMTAgKysrKy0tLS0KIHhlbi9jb21tb24vc2NoZWRfY3JlZGl0Mi5jICAgIHwgMjEgKysrKysr
KysrLS0tLS0tLS0KIHhlbi9jb21tb24vc2NoZWRfbnVsbC5jICAgICAgIHwgIDQgKystLQogeGVu
L2NvbW1vbi9zY2hlZF9ydC5jICAgICAgICAgfCAgOSArKystLS0tCiB4ZW4vY29tbW9uL3NjaGVk
dWxlLmMgICAgICAgICB8IDU1ICsrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0t
LS0tLS0KIHhlbi9pbmNsdWRlL2FzbS14ODYvY3B1aWRsZS5oIHwgMTEgLS0tLS0tLS0tCiB4ZW4v
aW5jbHVkZS94ZW4vc2NoZWQtaWYuaCAgICB8IDIzICsrKysrKysrLS0tLS0tLS0tLQogeGVuL2lu
Y2x1ZGUveGVuL3NjaGVkLmggICAgICAgfCAxMSArKysrKysrKysKIDkgZmlsZXMgY2hhbmdlZCwg
NzQgaW5zZXJ0aW9ucygrKSwgNzQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEveGVuL2NvbW1v
bi9zY2hlZF9hcmluYzY1My5jIGIveGVuL2NvbW1vbi9zY2hlZF9hcmluYzY1My5jCmluZGV4IDg1
ODVkOWM0ZmUuLjk4Y2RkN2Y4OTQgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWRfYXJpbmM2
NTMuYworKysgYi94ZW4vY29tbW9uL3NjaGVkX2FyaW5jNjUzLmMKQEAgLTQ3NSw3ICs0NzUsNyBA
QCBhNjUzc2NoZWRfdW5pdF9zbGVlcChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVj
dCBzY2hlZF91bml0ICp1bml0KQogICAgICAqIElmIHRoZSBWQ1BVIGJlaW5nIHB1dCB0byBzbGVl
cCBpcyB0aGUgc2FtZSBvbmUgdGhhdCBpcyBjdXJyZW50bHkKICAgICAgKiBydW5uaW5nLCByYWlz
ZSBhIHNvZnRpcnEgdG8gaW52b2tlIHRoZSBzY2hlZHVsZXIgdG8gc3dpdGNoIGRvbWFpbnMuCiAg
ICAgICovCi0gICAgaWYgKCBwZXJfY3B1KHNjaGVkdWxlX2RhdGEsIHZjLT5wcm9jZXNzb3IpLmN1
cnIgPT0gdW5pdCApCisgICAgaWYgKCBnZXRfc2NoZWRfcmVzKHZjLT5wcm9jZXNzb3IpLT5jdXJy
ID09IHVuaXQgKQogICAgICAgICBjcHVfcmFpc2Vfc29mdGlycSh2Yy0+cHJvY2Vzc29yLCBTQ0hF
RFVMRV9TT0ZUSVJRKTsKIH0KIApAQCAtNjQzLDcgKzY0Myw3IEBAIHN0YXRpYyBzcGlubG9ja190
ICoKIGE2NTNfc3dpdGNoX3NjaGVkKHN0cnVjdCBzY2hlZHVsZXIgKm5ld19vcHMsIHVuc2lnbmVk
IGludCBjcHUsCiAgICAgICAgICAgICAgICAgICB2b2lkICpwZGF0YSwgdm9pZCAqdmRhdGEpCiB7
Ci0gICAgc3RydWN0IHNjaGVkdWxlX2RhdGEgKnNkID0gJnBlcl9jcHUoc2NoZWR1bGVfZGF0YSwg
Y3B1KTsKKyAgICBzdHJ1Y3Qgc2NoZWRfcmVzb3VyY2UgKnNkID0gZ2V0X3NjaGVkX3JlcyhjcHUp
OwogICAgIGFyaW5jNjUzX3ZjcHVfdCAqc3ZjID0gdmRhdGE7CiAKICAgICBBU1NFUlQoIXBkYXRh
ICYmIHN2YyAmJiBpc19pZGxlX3ZjcHUoc3ZjLT52YykpOwpkaWZmIC0tZ2l0IGEveGVuL2NvbW1v
bi9zY2hlZF9jcmVkaXQuYyBiL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0LmMKaW5kZXggYjdkNDRl
ZmM4Yi4uZWU0MmRlNmJjZSAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQuYwor
KysgYi94ZW4vY29tbW9uL3NjaGVkX2NyZWRpdC5jCkBAIC04Miw3ICs4Miw3IEBACiAjZGVmaW5l
IENTQ0hFRF9QUklWKF9vcHMpICAgXAogICAgICgoc3RydWN0IGNzY2hlZF9wcml2YXRlICopKChf
b3BzKS0+c2NoZWRfZGF0YSkpCiAjZGVmaW5lIENTQ0hFRF9QQ1BVKF9jKSAgICAgXAotICAgICgo
c3RydWN0IGNzY2hlZF9wY3B1ICopcGVyX2NwdShzY2hlZHVsZV9kYXRhLCBfYykuc2NoZWRfcHJp
dikKKyAgICAoKHN0cnVjdCBjc2NoZWRfcGNwdSAqKWdldF9zY2hlZF9yZXMoX2MpLT5zY2hlZF9w
cml2KQogI2RlZmluZSBDU0NIRURfVU5JVCh1bml0KSAgICgoc3RydWN0IGNzY2hlZF91bml0ICop
ICh1bml0KS0+cHJpdikKICNkZWZpbmUgQ1NDSEVEX0RPTShfZG9tKSAgICAoKHN0cnVjdCBjc2No
ZWRfZG9tICopIChfZG9tKS0+c2NoZWRfcHJpdikKICNkZWZpbmUgUlVOUShfY3B1KSAgICAgICAg
ICAoJihDU0NIRURfUENQVShfY3B1KS0+cnVucSkpCkBAIC0yNTAsNyArMjUwLDcgQEAgc3RhdGlj
IGlubGluZSBib29sX3QgaXNfcnVucV9pZGxlKHVuc2lnbmVkIGludCBjcHUpCiAgICAgLyoKICAg
ICAgKiBXZSdyZSBwZWVraW5nIGF0IGNwdSdzIHJ1bnEsIHdlIG11c3QgaG9sZCB0aGUgcHJvcGVy
IGxvY2suCiAgICAgICovCi0gICAgQVNTRVJUKHNwaW5faXNfbG9ja2VkKHBlcl9jcHUoc2NoZWR1
bGVfZGF0YSwgY3B1KS5zY2hlZHVsZV9sb2NrKSk7CisgICAgQVNTRVJUKHNwaW5faXNfbG9ja2Vk
KGdldF9zY2hlZF9yZXMoY3B1KS0+c2NoZWR1bGVfbG9jaykpOwogCiAgICAgcmV0dXJuIGxpc3Rf
ZW1wdHkoUlVOUShjcHUpKSB8fAogICAgICAgICAgICBpc19pZGxlX3ZjcHUoX19ydW5xX2VsZW0o
UlVOUShjcHUpLT5uZXh0KS0+dmNwdSk7CkBAIC0yNTksNyArMjU5LDcgQEAgc3RhdGljIGlubGlu
ZSBib29sX3QgaXNfcnVucV9pZGxlKHVuc2lnbmVkIGludCBjcHUpCiBzdGF0aWMgaW5saW5lIHZv
aWQKIGluY19ucl9ydW5uYWJsZSh1bnNpZ25lZCBpbnQgY3B1KQogewotICAgIEFTU0VSVChzcGlu
X2lzX2xvY2tlZChwZXJfY3B1KHNjaGVkdWxlX2RhdGEsIGNwdSkuc2NoZWR1bGVfbG9jaykpOwor
ICAgIEFTU0VSVChzcGluX2lzX2xvY2tlZChnZXRfc2NoZWRfcmVzKGNwdSktPnNjaGVkdWxlX2xv
Y2spKTsKICAgICBDU0NIRURfUENQVShjcHUpLT5ucl9ydW5uYWJsZSsrOwogCiB9CkBAIC0yNjcs
NyArMjY3LDcgQEAgaW5jX25yX3J1bm5hYmxlKHVuc2lnbmVkIGludCBjcHUpCiBzdGF0aWMgaW5s
aW5lIHZvaWQKIGRlY19ucl9ydW5uYWJsZSh1bnNpZ25lZCBpbnQgY3B1KQogewotICAgIEFTU0VS
VChzcGluX2lzX2xvY2tlZChwZXJfY3B1KHNjaGVkdWxlX2RhdGEsIGNwdSkuc2NoZWR1bGVfbG9j
aykpOworICAgIEFTU0VSVChzcGluX2lzX2xvY2tlZChnZXRfc2NoZWRfcmVzKGNwdSktPnNjaGVk
dWxlX2xvY2spKTsKICAgICBBU1NFUlQoQ1NDSEVEX1BDUFUoY3B1KS0+bnJfcnVubmFibGUgPj0g
MSk7CiAgICAgQ1NDSEVEX1BDUFUoY3B1KS0+bnJfcnVubmFibGUtLTsKIH0KQEAgLTYyOCw3ICs2
MjgsNyBAQCBzdGF0aWMgc3BpbmxvY2tfdCAqCiBjc2NoZWRfc3dpdGNoX3NjaGVkKHN0cnVjdCBz
Y2hlZHVsZXIgKm5ld19vcHMsIHVuc2lnbmVkIGludCBjcHUsCiAgICAgICAgICAgICAgICAgICAg
IHZvaWQgKnBkYXRhLCB2b2lkICp2ZGF0YSkKIHsKLSAgICBzdHJ1Y3Qgc2NoZWR1bGVfZGF0YSAq
c2QgPSAmcGVyX2NwdShzY2hlZHVsZV9kYXRhLCBjcHUpOworICAgIHN0cnVjdCBzY2hlZF9yZXNv
dXJjZSAqc2QgPSBnZXRfc2NoZWRfcmVzKGNwdSk7CiAgICAgc3RydWN0IGNzY2hlZF9wcml2YXRl
ICpwcnYgPSBDU0NIRURfUFJJVihuZXdfb3BzKTsKICAgICBzdHJ1Y3QgY3NjaGVkX3VuaXQgKnN2
YyA9IHZkYXRhOwogCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3NjaGVkX2NyZWRpdDIuYyBiL3hl
bi9jb21tb24vc2NoZWRfY3JlZGl0Mi5jCmluZGV4IDQ5ODJmMWVmMzYuLjg0OWYzYTkxNmUgMTAw
NjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0Mi5jCisrKyBiL3hlbi9jb21tb24vc2No
ZWRfY3JlZGl0Mi5jCkBAIC01NjgsNyArNTY4LDcgQEAgc3RhdGljIGlubGluZSBzdHJ1Y3QgY3Nj
aGVkMl9wcml2YXRlICpjc2NoZWQyX3ByaXYoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzKQog
CiBzdGF0aWMgaW5saW5lIHN0cnVjdCBjc2NoZWQyX3BjcHUgKmNzY2hlZDJfcGNwdSh1bnNpZ25l
ZCBpbnQgY3B1KQogewotICAgIHJldHVybiBwZXJfY3B1KHNjaGVkdWxlX2RhdGEsIGNwdSkuc2No
ZWRfcHJpdjsKKyAgICByZXR1cm4gZ2V0X3NjaGVkX3JlcyhjcHUpLT5zY2hlZF9wcml2OwogfQog
CiBzdGF0aWMgaW5saW5lIHN0cnVjdCBjc2NoZWQyX3VuaXQgKmNzY2hlZDJfdW5pdChjb25zdCBz
dHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKQEAgLTEyNzcsNyArMTI3Nyw3IEBAIHJ1bnFfaW5zZXJ0
KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQog
ICAgIHN0cnVjdCBsaXN0X2hlYWQgKiBydW5xID0gJmMycnFkKG9wcywgY3B1KS0+cnVucTsKICAg
ICBpbnQgcG9zID0gMDsKIAotICAgIEFTU0VSVChzcGluX2lzX2xvY2tlZChwZXJfY3B1KHNjaGVk
dWxlX2RhdGEsIGNwdSkuc2NoZWR1bGVfbG9jaykpOworICAgIEFTU0VSVChzcGluX2lzX2xvY2tl
ZChnZXRfc2NoZWRfcmVzKGNwdSktPnNjaGVkdWxlX2xvY2spKTsKIAogICAgIEFTU0VSVCghdmNw
dV9vbl9ydW5xKHN2YykpOwogICAgIEFTU0VSVChjMnIoY3B1KSA9PSBjMnIoc3ZjLT52Y3B1LT5w
cm9jZXNzb3IpKTsKQEAgLTE3OTgsNyArMTc5OCw3IEBAIHN0YXRpYyBib29sIHZjcHVfZ3JhYl9i
dWRnZXQoc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQogICAgIHN0cnVjdCBjc2NoZWQyX2RvbSAq
c2RvbSA9IHN2Yy0+c2RvbTsKICAgICB1bnNpZ25lZCBpbnQgY3B1ID0gc3ZjLT52Y3B1LT5wcm9j
ZXNzb3I7CiAKLSAgICBBU1NFUlQoc3Bpbl9pc19sb2NrZWQocGVyX2NwdShzY2hlZHVsZV9kYXRh
LCBjcHUpLnNjaGVkdWxlX2xvY2spKTsKKyAgICBBU1NFUlQoc3Bpbl9pc19sb2NrZWQoZ2V0X3Nj
aGVkX3JlcyhjcHUpLT5zY2hlZHVsZV9sb2NrKSk7CiAKICAgICBpZiAoIHN2Yy0+YnVkZ2V0ID4g
MCApCiAgICAgICAgIHJldHVybiB0cnVlOwpAQCAtMTg0NSw3ICsxODQ1LDcgQEAgdmNwdV9yZXR1
cm5fYnVkZ2V0KHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2Yywgc3RydWN0IGxpc3RfaGVhZCAqcGFy
a2VkKQogICAgIHN0cnVjdCBjc2NoZWQyX2RvbSAqc2RvbSA9IHN2Yy0+c2RvbTsKICAgICB1bnNp
Z25lZCBpbnQgY3B1ID0gc3ZjLT52Y3B1LT5wcm9jZXNzb3I7CiAKLSAgICBBU1NFUlQoc3Bpbl9p
c19sb2NrZWQocGVyX2NwdShzY2hlZHVsZV9kYXRhLCBjcHUpLnNjaGVkdWxlX2xvY2spKTsKKyAg
ICBBU1NFUlQoc3Bpbl9pc19sb2NrZWQoZ2V0X3NjaGVkX3JlcyhjcHUpLT5zY2hlZHVsZV9sb2Nr
KSk7CiAgICAgQVNTRVJUKGxpc3RfZW1wdHkocGFya2VkKSk7CiAKICAgICAvKiBidWRnZXRfbG9j
ayBuZXN0cyBpbnNpZGUgcnVucXVldWUgbG9jay4gKi8KQEAgLTIxMDIsNyArMjEwMiw3IEBAIGNz
Y2hlZDJfdW5pdF93YWtlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVk
X3VuaXQgKnVuaXQpCiAgICAgdW5zaWduZWQgaW50IGNwdSA9IHZjLT5wcm9jZXNzb3I7CiAgICAg
c190aW1lX3Qgbm93OwogCi0gICAgQVNTRVJUKHNwaW5faXNfbG9ja2VkKHBlcl9jcHUoc2NoZWR1
bGVfZGF0YSwgY3B1KS5zY2hlZHVsZV9sb2NrKSk7CisgICAgQVNTRVJUKHNwaW5faXNfbG9ja2Vk
KGdldF9zY2hlZF9yZXMoY3B1KS0+c2NoZWR1bGVfbG9jaykpOwogCiAgICAgQVNTRVJUKCFpc19p
ZGxlX3ZjcHUodmMpKTsKIApAQCAtMjIzMCw3ICsyMjMwLDcgQEAgY3NjaGVkMl9yZXNfcGljayhj
b25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGNvbnN0IHN0cnVjdCBzY2hlZF91bml0ICp1bml0
KQogICAgICAqIGp1c3QgZ3JhYiB0aGUgcHJ2IGxvY2suICBJbnN0ZWFkLCB3ZSdsbCBoYXZlIHRv
IHRyeWxvY2ssIGFuZAogICAgICAqIGRvIHNvbWV0aGluZyBlbHNlIHJlYXNvbmFibGUgaWYgd2Ug
ZmFpbC4KICAgICAgKi8KLSAgICBBU1NFUlQoc3Bpbl9pc19sb2NrZWQocGVyX2NwdShzY2hlZHVs
ZV9kYXRhLCBjcHUpLnNjaGVkdWxlX2xvY2spKTsKKyAgICBBU1NFUlQoc3Bpbl9pc19sb2NrZWQo
Z2V0X3NjaGVkX3JlcyhjcHUpLT5zY2hlZHVsZV9sb2NrKSk7CiAKICAgICBpZiAoICFyZWFkX3Ry
eWxvY2soJnBydi0+bG9jaykgKQogICAgIHsKQEAgLTI1NzAsNyArMjU3MCw3IEBAIHN0YXRpYyB2
b2lkIGJhbGFuY2VfbG9hZChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGludCBjcHUsIHNf
dGltZV90IG5vdykKICAgICAgKiBvbiBlaXRoZXIgc2lkZSBtYXkgYmUgZW1wdHkpLgogICAgICAq
LwogCi0gICAgQVNTRVJUKHNwaW5faXNfbG9ja2VkKHBlcl9jcHUoc2NoZWR1bGVfZGF0YSwgY3B1
KS5zY2hlZHVsZV9sb2NrKSk7CisgICAgQVNTRVJUKHNwaW5faXNfbG9ja2VkKGdldF9zY2hlZF9y
ZXMoY3B1KS0+c2NoZWR1bGVfbG9jaykpOwogICAgIHN0LmxycWQgPSBjMnJxZChvcHMsIGNwdSk7
CiAKICAgICB1cGRhdGVfcnVucV9sb2FkKG9wcywgc3QubHJxZCwgMCwgbm93KTsKQEAgLTM0NzYs
NyArMzQ3Niw3IEBAIGNzY2hlZDJfc2NoZWR1bGUoCiAgICAgcnFkID0gYzJycWQob3BzLCBjcHUp
OwogICAgIEJVR19PTighY3B1bWFza190ZXN0X2NwdShjcHUsICZycWQtPmFjdGl2ZSkpOwogCi0g
ICAgQVNTRVJUKHNwaW5faXNfbG9ja2VkKHBlcl9jcHUoc2NoZWR1bGVfZGF0YSwgY3B1KS5zY2hl
ZHVsZV9sb2NrKSk7CisgICAgQVNTRVJUKHNwaW5faXNfbG9ja2VkKGdldF9zY2hlZF9yZXMoY3B1
KS0+c2NoZWR1bGVfbG9jaykpOwogCiAgICAgQlVHX09OKCFpc19pZGxlX3ZjcHUoc2N1cnItPnZj
cHUpICYmIHNjdXJyLT5ycWQgIT0gcnFkKTsKIApAQCAtMzg2Nyw3ICszODY3LDcgQEAgY3NjaGVk
Ml9pbml0X3BkYXRhKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgdm9pZCAqcGRhdGEsIGlu
dCBjcHUpCiAKICAgICBycWkgPSBpbml0X3BkYXRhKHBydiwgcGRhdGEsIGNwdSk7CiAgICAgLyog
TW92ZSB0aGUgc2NoZWR1bGVyIGxvY2sgdG8gdGhlIG5ldyBydW5xIGxvY2suICovCi0gICAgcGVy
X2NwdShzY2hlZHVsZV9kYXRhLCBjcHUpLnNjaGVkdWxlX2xvY2sgPSAmcHJ2LT5ycWRbcnFpXS5s
b2NrOworICAgIGdldF9zY2hlZF9yZXMoY3B1KS0+c2NoZWR1bGVfbG9jayA9ICZwcnYtPnJxZFty
cWldLmxvY2s7CiAKICAgICAvKiBfTm90XyBwY3B1X3NjaGVkdWxlX3VubG9jaygpOiBzY2hlZHVs
ZV9sb2NrIG1heSBoYXZlIGNoYW5nZWQhICovCiAgICAgc3Bpbl91bmxvY2sob2xkX2xvY2spOwpA
QCAtMzg4MSw2ICszODgxLDcgQEAgY3NjaGVkMl9zd2l0Y2hfc2NoZWQoc3RydWN0IHNjaGVkdWxl
ciAqbmV3X29wcywgdW5zaWduZWQgaW50IGNwdSwKIHsKICAgICBzdHJ1Y3QgY3NjaGVkMl9wcml2
YXRlICpwcnYgPSBjc2NoZWQyX3ByaXYobmV3X29wcyk7CiAgICAgc3RydWN0IGNzY2hlZDJfdW5p
dCAqc3ZjID0gdmRhdGE7CisgICAgc3RydWN0IHNjaGVkX3Jlc291cmNlICpzZCA9IGdldF9zY2hl
ZF9yZXMoY3B1KTsKICAgICB1bnNpZ25lZCBycWk7CiAKICAgICBBU1NFUlQocGRhdGEgJiYgc3Zj
ICYmIGlzX2lkbGVfdmNwdShzdmMtPnZjcHUpKTsKQEAgLTM5MDYsNyArMzkwNyw3IEBAIGNzY2hl
ZDJfc3dpdGNoX3NjaGVkKHN0cnVjdCBzY2hlZHVsZXIgKm5ld19vcHMsIHVuc2lnbmVkIGludCBj
cHUsCiAgICAgICogdGhpcyBzY2hlZHVsZXIsIGFuZCBzbyBpdCdzIHNhZmUgdG8gaGF2ZSB0YWtl
biBpdCAvYmVmb3JlLyBvdXIKICAgICAgKiBwcml2YXRlIGdsb2JhbCBsb2NrLgogICAgICAqLwot
ICAgIEFTU0VSVChwZXJfY3B1KHNjaGVkdWxlX2RhdGEsIGNwdSkuc2NoZWR1bGVfbG9jayAhPSAm
cHJ2LT5ycWRbcnFpXS5sb2NrKTsKKyAgICBBU1NFUlQoc2QtPnNjaGVkdWxlX2xvY2sgIT0gJnBy
di0+cnFkW3JxaV0ubG9jayk7CiAKICAgICB3cml0ZV91bmxvY2soJnBydi0+bG9jayk7CiAKZGlm
ZiAtLWdpdCBhL3hlbi9jb21tb24vc2NoZWRfbnVsbC5jIGIveGVuL2NvbW1vbi9zY2hlZF9udWxs
LmMKaW5kZXggZDdkMGU3N2NiNS4uZTdiYTU1YzY1MCAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9z
Y2hlZF9udWxsLmMKKysrIGIveGVuL2NvbW1vbi9zY2hlZF9udWxsLmMKQEAgLTI2OSw3ICsyNjks
NyBAQCBwaWNrX3JlcyhzdHJ1Y3QgbnVsbF9wcml2YXRlICpwcnYsIGNvbnN0IHN0cnVjdCBzY2hl
ZF91bml0ICp1bml0KQogICAgIHVuc2lnbmVkIGludCBjcHUgPSB2LT5wcm9jZXNzb3IsIG5ld19j
cHU7CiAgICAgY3B1bWFza190ICpjcHVzID0gY3B1cG9vbF9kb21haW5fY3B1bWFzayh2LT5kb21h
aW4pOwogCi0gICAgQVNTRVJUKHNwaW5faXNfbG9ja2VkKHBlcl9jcHUoc2NoZWR1bGVfZGF0YSwg
Y3B1KS5zY2hlZHVsZV9sb2NrKSk7CisgICAgQVNTRVJUKHNwaW5faXNfbG9ja2VkKGdldF9zY2hl
ZF9yZXMoY3B1KS0+c2NoZWR1bGVfbG9jaykpOwogCiAgICAgZm9yX2VhY2hfYWZmaW5pdHlfYmFs
YW5jZV9zdGVwKCBicyApCiAgICAgewpAQCAtNDE5LDcgKzQxOSw3IEBAIHN0YXRpYyBzcGlubG9j
a190ICpudWxsX3N3aXRjaF9zY2hlZChzdHJ1Y3Qgc2NoZWR1bGVyICpuZXdfb3BzLAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCBjcHUsCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqcGRhdGEsIHZvaWQgKnZkYXRhKQog
ewotICAgIHN0cnVjdCBzY2hlZHVsZV9kYXRhICpzZCA9ICZwZXJfY3B1KHNjaGVkdWxlX2RhdGEs
IGNwdSk7CisgICAgc3RydWN0IHNjaGVkX3Jlc291cmNlICpzZCA9IGdldF9zY2hlZF9yZXMoY3B1
KTsKICAgICBzdHJ1Y3QgbnVsbF9wcml2YXRlICpwcnYgPSBudWxsX3ByaXYobmV3X29wcyk7CiAg
ICAgc3RydWN0IG51bGxfdW5pdCAqbnZjID0gdmRhdGE7CiAKZGlmZiAtLWdpdCBhL3hlbi9jb21t
b24vc2NoZWRfcnQuYyBiL3hlbi9jb21tb24vc2NoZWRfcnQuYwppbmRleCAxMTVlNGRhMjRkLi5m
MzFjN2RjMDJjIDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL3NjaGVkX3J0LmMKKysrIGIveGVuL2Nv
bW1vbi9zY2hlZF9ydC5jCkBAIC03NSw3ICs3NSw3IEBACiAvKgogICogTG9ja2luZzoKICAqIEEg
Z2xvYmFsIHN5c3RlbSBsb2NrIGlzIHVzZWQgdG8gcHJvdGVjdCB0aGUgUnVuUSBhbmQgRGVwbGV0
ZWRRLgotICogVGhlIGdsb2JhbCBsb2NrIGlzIHJlZmVyZW5jZWQgYnkgc2NoZWR1bGVfZGF0YS5z
Y2hlZHVsZV9sb2NrCisgKiBUaGUgZ2xvYmFsIGxvY2sgaXMgcmVmZXJlbmNlZCBieSBzY2hlZF9y
ZXMtPnNjaGVkdWxlX2xvY2sKICAqIGZyb20gYWxsIHBoeXNpY2FsIGNwdXMuCiAgKgogICogVGhl
IGxvY2sgaXMgYWxyZWFkeSBncmFiYmVkIHdoZW4gY2FsbGluZyB3YWtlL3NsZWVwL3NjaGVkdWxl
LyBmdW5jdGlvbnMKQEAgLTE3Niw3ICsxNzYsNyBAQCBzdGF0aWMgdm9pZCByZXBsX3RpbWVyX2hh
bmRsZXIodm9pZCAqZGF0YSk7CiAKIC8qCiAgKiBTeXN0ZW0td2lkZSBwcml2YXRlIGRhdGEsIGlu
Y2x1ZGUgZ2xvYmFsIFJ1blF1ZXVlL0RlcGxldGVkUQotICogR2xvYmFsIGxvY2sgaXMgcmVmZXJl
bmNlZCBieSBzY2hlZHVsZV9kYXRhLnNjaGVkdWxlX2xvY2sgZnJvbSBhbGwKKyAqIEdsb2JhbCBs
b2NrIGlzIHJlZmVyZW5jZWQgYnkgc2NoZWRfcmVzLT5zY2hlZHVsZV9sb2NrIGZyb20gYWxsCiAg
KiBwaHlzaWNhbCBjcHVzLiBJdCBjYW4gYmUgZ3JhYmJlZCB2aWEgdmNwdV9zY2hlZHVsZV9sb2Nr
X2lycSgpCiAgKi8KIHN0cnVjdCBydF9wcml2YXRlIHsKQEAgLTcyMiw3ICs3MjIsNyBAQCBydF9p
bml0X3BkYXRhKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgdm9pZCAqcGRhdGEsIGludCBj
cHUpCiAgICAgfQogCiAgICAgLyogTW92ZSB0aGUgc2NoZWR1bGVyIGxvY2sgdG8gb3VyIGdsb2Jh
bCBydW5xdWV1ZSBsb2NrLiAgKi8KLSAgICBwZXJfY3B1KHNjaGVkdWxlX2RhdGEsIGNwdSkuc2No
ZWR1bGVfbG9jayA9ICZwcnYtPmxvY2s7CisgICAgZ2V0X3NjaGVkX3JlcyhjcHUpLT5zY2hlZHVs
ZV9sb2NrID0gJnBydi0+bG9jazsKIAogICAgIC8qIF9Ob3RfIHBjcHVfc2NoZWR1bGVfdW5sb2Nr
KCk6IHBlcl9jcHUoKS5zY2hlZHVsZV9sb2NrIGNoYW5nZWQhICovCiAgICAgc3Bpbl91bmxvY2tf
aXJxcmVzdG9yZShvbGRfbG9jaywgZmxhZ3MpOwpAQCAtNzM1LDYgKzczNSw3IEBAIHJ0X3N3aXRj
aF9zY2hlZChzdHJ1Y3Qgc2NoZWR1bGVyICpuZXdfb3BzLCB1bnNpZ25lZCBpbnQgY3B1LAogewog
ICAgIHN0cnVjdCBydF9wcml2YXRlICpwcnYgPSBydF9wcml2KG5ld19vcHMpOwogICAgIHN0cnVj
dCBydF91bml0ICpzdmMgPSB2ZGF0YTsKKyAgICBzdHJ1Y3Qgc2NoZWRfcmVzb3VyY2UgKnNkID0g
Z2V0X3NjaGVkX3JlcyhjcHUpOwogCiAgICAgQVNTRVJUKCFwZGF0YSAmJiBzdmMgJiYgaXNfaWRs
ZV92Y3B1KHN2Yy0+dmNwdSkpOwogCkBAIC03NDQsNyArNzQ1LDcgQEAgcnRfc3dpdGNoX3NjaGVk
KHN0cnVjdCBzY2hlZHVsZXIgKm5ld19vcHMsIHVuc2lnbmVkIGludCBjcHUsCiAgICAgICogYW5v
dGhlciBzY2hlZHVsZXIsIGJ1dCB0aGF0IGlzIGhvdyB0aGluZ3MgbmVlZCB0byBiZSwgZm9yCiAg
ICAgICogcHJldmVudGluZyByYWNlcy4KICAgICAgKi8KLSAgICBBU1NFUlQocGVyX2NwdShzY2hl
ZHVsZV9kYXRhLCBjcHUpLnNjaGVkdWxlX2xvY2sgIT0gJnBydi0+bG9jayk7CisgICAgQVNTRVJU
KHNkLT5zY2hlZHVsZV9sb2NrICE9ICZwcnYtPmxvY2spOwogCiAgICAgLyoKICAgICAgKiBJZiB3
ZSBhcmUgdGhlIGFic29sdXRlIGZpcnN0IGNwdSBiZWluZyBzd2l0Y2hlZCB0b3dhcmQgdGhpcwpk
aWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZHVsZS5jIGIveGVuL2NvbW1vbi9zY2hlZHVsZS5j
CmluZGV4IDg2NWM1MGIzNzguLjQyYmNhOGRmNTQgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2No
ZWR1bGUuYworKysgYi94ZW4vY29tbW9uL3NjaGVkdWxlLmMKQEAgLTY1LDEzICs2NSwxNSBAQCBz
dGF0aWMgdm9pZCB2Y3B1X3NpbmdsZXNob3RfdGltZXJfZm4odm9pZCAqZGF0YSk7CiBzdGF0aWMg
dm9pZCBwb2xsX3RpbWVyX2ZuKHZvaWQgKmRhdGEpOwogCiAvKiBUaGlzIGlzIGdsb2JhbCBmb3Ig
bm93IHNvIHRoYXQgcHJpdmF0ZSBpbXBsZW1lbnRhdGlvbnMgY2FuIHJlYWNoIGl0ICovCi1ERUZJ
TkVfUEVSX0NQVShzdHJ1Y3Qgc2NoZWR1bGVfZGF0YSwgc2NoZWR1bGVfZGF0YSk7CiBERUZJTkVf
UEVSX0NQVShzdHJ1Y3Qgc2NoZWR1bGVyICosIHNjaGVkdWxlcik7CiBERUZJTkVfUEVSX0NQVV9S
RUFEX01PU1RMWShzdHJ1Y3Qgc2NoZWRfcmVzb3VyY2UgKiwgc2NoZWRfcmVzKTsKIAogLyogU2Ny
YXRjaCBzcGFjZSBmb3IgY3B1bWFza3MuICovCiBERUZJTkVfUEVSX0NQVShjcHVtYXNrX3QsIGNw
dW1hc2tfc2NyYXRjaCk7CiAKKy8qIEhvdyBtYW55IHVyZ2VudCB2Y3B1cy4gKi8KK0RFRklORV9Q
RVJfQ1BVKGF0b21pY190LCBzY2hlZF91cmdlbnRfY291bnQpOworCiBleHRlcm4gY29uc3Qgc3Ry
dWN0IHNjaGVkdWxlciAqX19zdGFydF9zY2hlZHVsZXJzX2FycmF5W10sICpfX2VuZF9zY2hlZHVs
ZXJzX2FycmF5W107CiAjZGVmaW5lIE5VTV9TQ0hFRFVMRVJTIChfX2VuZF9zY2hlZHVsZXJzX2Fy
cmF5IC0gX19zdGFydF9zY2hlZHVsZXJzX2FycmF5KQogI2RlZmluZSBzY2hlZHVsZXJzIF9fc3Rh
cnRfc2NoZWR1bGVyc19hcnJheQpAQCAtMjEzLDcgKzIxNSw3IEBAIHN0YXRpYyBpbmxpbmUgdm9p
ZCB2Y3B1X3VyZ2VudF9jb3VudF91cGRhdGUoc3RydWN0IHZjcHUgKnYpCiAgICAgICAgICAgICAg
IXRlc3RfYml0KHYtPnZjcHVfaWQsIHYtPmRvbWFpbi0+cG9sbF9tYXNrKSApCiAgICAgICAgIHsK
ICAgICAgICAgICAgIHYtPmlzX3VyZ2VudCA9IDA7Ci0gICAgICAgICAgICBhdG9taWNfZGVjKCZw
ZXJfY3B1KHNjaGVkdWxlX2RhdGEsdi0+cHJvY2Vzc29yKS51cmdlbnRfY291bnQpOworICAgICAg
ICAgICAgYXRvbWljX2RlYygmcGVyX2NwdShzY2hlZF91cmdlbnRfY291bnQsIHYtPnByb2Nlc3Nv
cikpOwogICAgICAgICB9CiAgICAgfQogICAgIGVsc2UKQEAgLTIyMiw3ICsyMjQsNyBAQCBzdGF0
aWMgaW5saW5lIHZvaWQgdmNwdV91cmdlbnRfY291bnRfdXBkYXRlKHN0cnVjdCB2Y3B1ICp2KQog
ICAgICAgICAgICAgIHVubGlrZWx5KHRlc3RfYml0KHYtPnZjcHVfaWQsIHYtPmRvbWFpbi0+cG9s
bF9tYXNrKSkgKQogICAgICAgICB7CiAgICAgICAgICAgICB2LT5pc191cmdlbnQgPSAxOwotICAg
ICAgICAgICAgYXRvbWljX2luYygmcGVyX2NwdShzY2hlZHVsZV9kYXRhLHYtPnByb2Nlc3Nvciku
dXJnZW50X2NvdW50KTsKKyAgICAgICAgICAgIGF0b21pY19pbmMoJnBlcl9jcHUoc2NoZWRfdXJn
ZW50X2NvdW50LCB2LT5wcm9jZXNzb3IpKTsKICAgICAgICAgfQogICAgIH0KIH0KQEAgLTIzMyw3
ICsyMzUsNyBAQCBzdGF0aWMgaW5saW5lIHZvaWQgdmNwdV9ydW5zdGF0ZV9jaGFuZ2UoCiAgICAg
c190aW1lX3QgZGVsdGE7CiAKICAgICBBU1NFUlQodi0+cnVuc3RhdGUuc3RhdGUgIT0gbmV3X3N0
YXRlKTsKLSAgICBBU1NFUlQoc3Bpbl9pc19sb2NrZWQocGVyX2NwdShzY2hlZHVsZV9kYXRhLHYt
PnByb2Nlc3Nvcikuc2NoZWR1bGVfbG9jaykpOworICAgIEFTU0VSVChzcGluX2lzX2xvY2tlZChn
ZXRfc2NoZWRfcmVzKHYtPnByb2Nlc3NvciktPnNjaGVkdWxlX2xvY2spKTsKIAogICAgIHZjcHVf
dXJnZW50X2NvdW50X3VwZGF0ZSh2KTsKIApAQCAtMzkzLDcgKzM5NSw3IEBAIGludCBzY2hlZF9p
bml0X3ZjcHUoc3RydWN0IHZjcHUgKnYsIHVuc2lnbmVkIGludCBwcm9jZXNzb3IpCiAgICAgLyog
SWRsZSBWQ1BVcyBhcmUgc2NoZWR1bGVkIGltbWVkaWF0ZWx5LCBzbyBkb24ndCBwdXQgdGhlbSBp
biBydW5xdWV1ZS4gKi8KICAgICBpZiAoIGlzX2lkbGVfZG9tYWluKGQpICkKICAgICB7Ci0gICAg
ICAgIHBlcl9jcHUoc2NoZWR1bGVfZGF0YSwgdi0+cHJvY2Vzc29yKS5jdXJyID0gdW5pdDsKKyAg
ICAgICAgZ2V0X3NjaGVkX3Jlcyh2LT5wcm9jZXNzb3IpLT5jdXJyID0gdW5pdDsKICAgICAgICAg
di0+aXNfcnVubmluZyA9IDE7CiAgICAgfQogICAgIGVsc2UKQEAgLTUxOCw3ICs1MjAsNyBAQCB2
b2lkIHNjaGVkX2Rlc3Ryb3lfdmNwdShzdHJ1Y3QgdmNwdSAqdikKICAgICBraWxsX3RpbWVyKCZ2
LT5zaW5nbGVzaG90X3RpbWVyKTsKICAgICBraWxsX3RpbWVyKCZ2LT5wb2xsX3RpbWVyKTsKICAg
ICBpZiAoIHRlc3RfYW5kX2NsZWFyX2Jvb2wodi0+aXNfdXJnZW50KSApCi0gICAgICAgIGF0b21p
Y19kZWMoJnBlcl9jcHUoc2NoZWR1bGVfZGF0YSwgdi0+cHJvY2Vzc29yKS51cmdlbnRfY291bnQp
OworICAgICAgICBhdG9taWNfZGVjKCZwZXJfY3B1KHNjaGVkX3VyZ2VudF9jb3VudCwgdi0+cHJv
Y2Vzc29yKSk7CiAgICAgc2NoZWRfcmVtb3ZlX3VuaXQodmNwdV9zY2hlZHVsZXIodiksIHVuaXQp
OwogICAgIHNjaGVkX2ZyZWVfdmRhdGEodmNwdV9zY2hlZHVsZXIodiksIHVuaXQtPnByaXYpOwog
ICAgIHNjaGVkX2ZyZWVfdW5pdCh1bml0KTsKQEAgLTU2NSw3ICs1NjcsNyBAQCB2b2lkIHNjaGVk
X2Rlc3Ryb3lfZG9tYWluKHN0cnVjdCBkb21haW4gKmQpCiAKIHZvaWQgdmNwdV9zbGVlcF9ub3N5
bmNfbG9ja2VkKHN0cnVjdCB2Y3B1ICp2KQogewotICAgIEFTU0VSVChzcGluX2lzX2xvY2tlZChw
ZXJfY3B1KHNjaGVkdWxlX2RhdGEsdi0+cHJvY2Vzc29yKS5zY2hlZHVsZV9sb2NrKSk7CisgICAg
QVNTRVJUKHNwaW5faXNfbG9ja2VkKGdldF9zY2hlZF9yZXModi0+cHJvY2Vzc29yKS0+c2NoZWR1
bGVfbG9jaykpOwogCiAgICAgaWYgKCBsaWtlbHkoIXZjcHVfcnVubmFibGUodikpICkKICAgICB7
CkBAIC02NjAsOCArNjYyLDggQEAgc3RhdGljIHZvaWQgdmNwdV9tb3ZlX2xvY2tlZChzdHJ1Y3Qg
dmNwdSAqdiwgdW5zaWduZWQgaW50IG5ld19jcHUpCiAgICAgICovCiAgICAgaWYgKCB1bmxpa2Vs
eSh2LT5pc191cmdlbnQpICYmIChvbGRfY3B1ICE9IG5ld19jcHUpICkKICAgICB7Ci0gICAgICAg
IGF0b21pY19pbmMoJnBlcl9jcHUoc2NoZWR1bGVfZGF0YSwgbmV3X2NwdSkudXJnZW50X2NvdW50
KTsKLSAgICAgICAgYXRvbWljX2RlYygmcGVyX2NwdShzY2hlZHVsZV9kYXRhLCBvbGRfY3B1KS51
cmdlbnRfY291bnQpOworICAgICAgICBhdG9taWNfaW5jKCZwZXJfY3B1KHNjaGVkX3VyZ2VudF9j
b3VudCwgbmV3X2NwdSkpOworICAgICAgICBhdG9taWNfZGVjKCZwZXJfY3B1KHNjaGVkX3VyZ2Vu
dF9jb3VudCwgb2xkX2NwdSkpOwogICAgIH0KIAogICAgIC8qCkBAIC03MjcsMjAgKzcyOSwyMCBA
QCBzdGF0aWMgdm9pZCB2Y3B1X21pZ3JhdGVfZmluaXNoKHN0cnVjdCB2Y3B1ICp2KQogICAgICAg
ICAgKiBhcmUgbm90IGNvcnJlY3QgYW55IGxvbmdlciBhZnRlciBldmFsdWF0aW5nIG9sZCBhbmQg
bmV3IGNwdSBob2xkaW5nCiAgICAgICAgICAqIHRoZSBsb2Nrcy4KICAgICAgICAgICovCi0gICAg
ICAgIG9sZF9sb2NrID0gcGVyX2NwdShzY2hlZHVsZV9kYXRhLCBvbGRfY3B1KS5zY2hlZHVsZV9s
b2NrOwotICAgICAgICBuZXdfbG9jayA9IHBlcl9jcHUoc2NoZWR1bGVfZGF0YSwgbmV3X2NwdSku
c2NoZWR1bGVfbG9jazsKKyAgICAgICAgb2xkX2xvY2sgPSBnZXRfc2NoZWRfcmVzKG9sZF9jcHUp
LT5zY2hlZHVsZV9sb2NrOworICAgICAgICBuZXdfbG9jayA9IGdldF9zY2hlZF9yZXMobmV3X2Nw
dSktPnNjaGVkdWxlX2xvY2s7CiAKICAgICAgICAgc2NoZWRfc3Bpbl9sb2NrX2RvdWJsZShvbGRf
bG9jaywgbmV3X2xvY2ssICZmbGFncyk7CiAKICAgICAgICAgb2xkX2NwdSA9IHYtPnByb2Nlc3Nv
cjsKLSAgICAgICAgaWYgKCBvbGRfbG9jayA9PSBwZXJfY3B1KHNjaGVkdWxlX2RhdGEsIG9sZF9j
cHUpLnNjaGVkdWxlX2xvY2sgKQorICAgICAgICBpZiAoIG9sZF9sb2NrID09IGdldF9zY2hlZF9y
ZXMob2xkX2NwdSktPnNjaGVkdWxlX2xvY2sgKQogICAgICAgICB7CiAgICAgICAgICAgICAvKgog
ICAgICAgICAgICAgICogSWYgd2Ugc2VsZWN0ZWQgYSBDUFUgb24gdGhlIHByZXZpb3N1IGl0ZXJh
dGlvbiwgY2hlY2sgaWYgaXQKICAgICAgICAgICAgICAqIHJlbWFpbnMgc3VpdGFibGUgZm9yIHJ1
bm5pbmcgdGhpcyB2Q1BVLgogICAgICAgICAgICAgICovCiAgICAgICAgICAgICBpZiAoIHBpY2tf
Y2FsbGVkICYmCi0gICAgICAgICAgICAgICAgIChuZXdfbG9jayA9PSBwZXJfY3B1KHNjaGVkdWxl
X2RhdGEsIG5ld19jcHUpLnNjaGVkdWxlX2xvY2spICYmCisgICAgICAgICAgICAgICAgIChuZXdf
bG9jayA9PSBnZXRfc2NoZWRfcmVzKG5ld19jcHUpLT5zY2hlZHVsZV9sb2NrKSAmJgogICAgICAg
ICAgICAgICAgICBjcHVtYXNrX3Rlc3RfY3B1KG5ld19jcHUsIHYtPmNwdV9oYXJkX2FmZmluaXR5
KSAmJgogICAgICAgICAgICAgICAgICBjcHVtYXNrX3Rlc3RfY3B1KG5ld19jcHUsIHYtPmRvbWFp
bi0+Y3B1cG9vbC0+Y3B1X3ZhbGlkKSApCiAgICAgICAgICAgICAgICAgYnJlYWs7CkBAIC03NDgs
NyArNzUwLDcgQEAgc3RhdGljIHZvaWQgdmNwdV9taWdyYXRlX2ZpbmlzaChzdHJ1Y3QgdmNwdSAq
dikKICAgICAgICAgICAgIC8qIFNlbGVjdCBhIG5ldyBDUFUuICovCiAgICAgICAgICAgICBuZXdf
Y3B1ID0gc2NoZWRfcGlja19yZXNvdXJjZSh2Y3B1X3NjaGVkdWxlcih2KSwKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYtPnNjaGVkX3VuaXQpLT5tYXN0ZXJfY3B1
OwotICAgICAgICAgICAgaWYgKCAobmV3X2xvY2sgPT0gcGVyX2NwdShzY2hlZHVsZV9kYXRhLCBu
ZXdfY3B1KS5zY2hlZHVsZV9sb2NrKSAmJgorICAgICAgICAgICAgaWYgKCAobmV3X2xvY2sgPT0g
Z2V0X3NjaGVkX3JlcyhuZXdfY3B1KS0+c2NoZWR1bGVfbG9jaykgJiYKICAgICAgICAgICAgICAg
ICAgY3B1bWFza190ZXN0X2NwdShuZXdfY3B1LCB2LT5kb21haW4tPmNwdXBvb2wtPmNwdV92YWxp
ZCkgKQogICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgcGlja19jYWxsZWQgPSAx
OwpAQCAtMTU2NSw3ICsxNTY3LDcgQEAgc3RhdGljIHZvaWQgc2NoZWR1bGUodm9pZCkKICAgICBz
dHJ1Y3Qgc2NoZWR1bGVyICAgICAqc2NoZWQ7CiAgICAgdW5zaWduZWQgbG9uZyAgICAgICAgKnRh
c2tsZXRfd29yayA9ICZ0aGlzX2NwdSh0YXNrbGV0X3dvcmtfdG9fZG8pOwogICAgIGJvb2xfdCAg
ICAgICAgICAgICAgICB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkID0gMDsKLSAgICBzdHJ1Y3Qgc2No
ZWR1bGVfZGF0YSAqc2Q7CisgICAgc3RydWN0IHNjaGVkX3Jlc291cmNlICpzZDsKICAgICBzcGlu
bG9ja190ICAgICAgICAgICAqbG9jazsKICAgICBzdHJ1Y3QgdGFza19zbGljZSAgICAgbmV4dF9z
bGljZTsKICAgICBpbnQgY3B1ID0gc21wX3Byb2Nlc3Nvcl9pZCgpOwpAQCAtMTU3NCw3ICsxNTc2
LDcgQEAgc3RhdGljIHZvaWQgc2NoZWR1bGUodm9pZCkKIAogICAgIFNDSEVEX1NUQVRfQ1JBTkso
c2NoZWRfcnVuKTsKIAotICAgIHNkID0gJnRoaXNfY3B1KHNjaGVkdWxlX2RhdGEpOworICAgIHNk
ID0gZ2V0X3NjaGVkX3JlcyhjcHUpOwogCiAgICAgLyogVXBkYXRlIHRhc2tsZXQgc2NoZWR1bGlu
ZyBzdGF0dXMuICovCiAgICAgc3dpdGNoICggKnRhc2tsZXRfd29yayApCkBAIC0xNzE1LDIwICsx
NzE3LDE5IEBAIHN0YXRpYyB2b2lkIHBvbGxfdGltZXJfZm4odm9pZCAqZGF0YSkKIAogc3RhdGlj
IGludCBjcHVfc2NoZWR1bGVfdXAodW5zaWduZWQgaW50IGNwdSkKIHsKLSAgICBzdHJ1Y3Qgc2No
ZWR1bGVfZGF0YSAqc2QgPSAmcGVyX2NwdShzY2hlZHVsZV9kYXRhLCBjcHUpOwotICAgIHN0cnVj
dCBzY2hlZF9yZXNvdXJjZSAqcmVzOworICAgIHN0cnVjdCBzY2hlZF9yZXNvdXJjZSAqc2Q7CiAK
LSAgICByZXMgPSB4emFsbG9jKHN0cnVjdCBzY2hlZF9yZXNvdXJjZSk7Ci0gICAgaWYgKCByZXMg
PT0gTlVMTCApCisgICAgc2QgPSB4emFsbG9jKHN0cnVjdCBzY2hlZF9yZXNvdXJjZSk7CisgICAg
aWYgKCBzZCA9PSBOVUxMICkKICAgICAgICAgcmV0dXJuIC1FTk9NRU07Ci0gICAgcmVzLT5tYXN0
ZXJfY3B1ID0gY3B1OwotICAgIHNldF9zY2hlZF9yZXMoY3B1LCByZXMpOworICAgIHNkLT5tYXN0
ZXJfY3B1ID0gY3B1OworICAgIHNldF9zY2hlZF9yZXMoY3B1LCBzZCk7CiAKICAgICBwZXJfY3B1
KHNjaGVkdWxlciwgY3B1KSA9ICZzY2hlZF9pZGxlX29wczsKICAgICBzcGluX2xvY2tfaW5pdCgm
c2QtPl9sb2NrKTsKICAgICBzZC0+c2NoZWR1bGVfbG9jayA9ICZzY2hlZF9mcmVlX2NwdV9sb2Nr
OwogICAgIGluaXRfdGltZXIoJnNkLT5zX3RpbWVyLCBzX3RpbWVyX2ZuLCBOVUxMLCBjcHUpOwot
ICAgIGF0b21pY19zZXQoJnNkLT51cmdlbnRfY291bnQsIDApOworICAgIGF0b21pY19zZXQoJnBl
cl9jcHUoc2NoZWRfdXJnZW50X2NvdW50LCBjcHUpLCAwKTsKIAogICAgIC8qIEJvb3QgQ1BVIGlz
IGRlYWx0IHdpdGggbGF0ZXIgaW4gc2NoZWR1bGVyX2luaXQoKS4gKi8KICAgICBpZiAoIGNwdSA9
PSAwICkKQEAgLTE3MzcsNyArMTczOCw3IEBAIHN0YXRpYyBpbnQgY3B1X3NjaGVkdWxlX3VwKHVu
c2lnbmVkIGludCBjcHUpCiAgICAgaWYgKCBpZGxlX3ZjcHVbY3B1XSA9PSBOVUxMICkKICAgICAg
ICAgdmNwdV9jcmVhdGUoaWRsZV92Y3B1WzBdLT5kb21haW4sIGNwdSwgY3B1KTsKICAgICBlbHNl
Ci0gICAgICAgIGlkbGVfdmNwdVtjcHVdLT5zY2hlZF91bml0LT5yZXMgPSByZXM7CisgICAgICAg
IGlkbGVfdmNwdVtjcHVdLT5zY2hlZF91bml0LT5yZXMgPSBzZDsKIAogICAgIGlmICggaWRsZV92
Y3B1W2NwdV0gPT0gTlVMTCApCiAgICAgICAgIHJldHVybiAtRU5PTUVNOwpAQCAtMTc1Nyw3ICsx
NzU4LDcgQEAgc3RhdGljIGludCBjcHVfc2NoZWR1bGVfdXAodW5zaWduZWQgaW50IGNwdSkKIAog
c3RhdGljIHZvaWQgY3B1X3NjaGVkdWxlX2Rvd24odW5zaWduZWQgaW50IGNwdSkKIHsKLSAgICBz
dHJ1Y3Qgc2NoZWR1bGVfZGF0YSAqc2QgPSAmcGVyX2NwdShzY2hlZHVsZV9kYXRhLCBjcHUpOwor
ICAgIHN0cnVjdCBzY2hlZF9yZXNvdXJjZSAqc2QgPSBnZXRfc2NoZWRfcmVzKGNwdSk7CiAKICAg
ICBraWxsX3RpbWVyKCZzZC0+c190aW1lcik7CiAKQEAgLTE5MTYsNyArMTkxNyw3IEBAIHZvaWQg
X19pbml0IHNjaGVkdWxlcl9pbml0KHZvaWQpCiAgICAgaWRsZV9kb21haW4tPm1heF92Y3B1cyA9
IG5yX2NwdV9pZHM7CiAgICAgaWYgKCB2Y3B1X2NyZWF0ZShpZGxlX2RvbWFpbiwgMCwgMCkgPT0g
TlVMTCApCiAgICAgICAgIEJVRygpOwotICAgIHRoaXNfY3B1KHNjaGVkdWxlX2RhdGEpLmN1cnIg
PSBpZGxlX3ZjcHVbMF0tPnNjaGVkX3VuaXQ7CisgICAgZ2V0X3NjaGVkX3JlcygwKS0+Y3VyciA9
IGlkbGVfdmNwdVswXS0+c2NoZWRfdW5pdDsKIH0KIAogLyoKQEAgLTE5MzMsNyArMTkzNCw3IEBA
IGludCBzY2hlZHVsZV9jcHVfc3dpdGNoKHVuc2lnbmVkIGludCBjcHUsIHN0cnVjdCBjcHVwb29s
ICpjKQogICAgIHN0cnVjdCBzY2hlZHVsZXIgKm9sZF9vcHMgPSBwZXJfY3B1KHNjaGVkdWxlciwg
Y3B1KTsKICAgICBzdHJ1Y3Qgc2NoZWR1bGVyICpuZXdfb3BzID0gKGMgPT0gTlVMTCkgPyAmc2No
ZWRfaWRsZV9vcHMgOiBjLT5zY2hlZDsKICAgICBzdHJ1Y3QgY3B1cG9vbCAqb2xkX3Bvb2wgPSBw
ZXJfY3B1KGNwdXBvb2wsIGNwdSk7Ci0gICAgc3RydWN0IHNjaGVkdWxlX2RhdGEgKnNkID0gJnBl
cl9jcHUoc2NoZWR1bGVfZGF0YSwgY3B1KTsKKyAgICBzdHJ1Y3Qgc2NoZWRfcmVzb3VyY2UgKnNk
ID0gZ2V0X3NjaGVkX3JlcyhjcHUpOwogICAgIHNwaW5sb2NrX3QgKm9sZF9sb2NrLCAqbmV3X2xv
Y2s7CiAgICAgdW5zaWduZWQgbG9uZyBmbGFnczsKIApkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUv
YXNtLXg4Ni9jcHVpZGxlLmggYi94ZW4vaW5jbHVkZS9hc20teDg2L2NwdWlkbGUuaAppbmRleCA0
ODhmNzA4MzA1Li41ZDdkZmZkMjI4IDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS9hc20teDg2L2Nw
dWlkbGUuaAorKysgYi94ZW4vaW5jbHVkZS9hc20teDg2L2NwdWlkbGUuaApAQCAtNCw3ICs0LDYg
QEAKICNpbmNsdWRlIDx4ZW4vY3B1aWRsZS5oPgogI2luY2x1ZGUgPHhlbi9ub3RpZmllci5oPgog
I2luY2x1ZGUgPHhlbi9zY2hlZC5oPgotI2luY2x1ZGUgPHhlbi9zY2hlZC1pZi5oPgogCiBleHRl
cm4gc3RydWN0IGFjcGlfcHJvY2Vzc29yX3Bvd2VyICpwcm9jZXNzb3JfcG93ZXJzW107CiAKQEAg
LTI3LDE0ICsyNiw0IEBAIHZvaWQgdXBkYXRlX2lkbGVfc3RhdHMoc3RydWN0IGFjcGlfcHJvY2Vz
c29yX3Bvd2VyICosCiB2b2lkIHVwZGF0ZV9sYXN0X2N4X3N0YXQoc3RydWN0IGFjcGlfcHJvY2Vz
c29yX3Bvd2VyICosCiAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGFjcGlfcHJvY2Vz
c29yX2N4ICosIHVpbnQ2NF90KTsKIAotLyoKLSAqIHZjcHUgaXMgdXJnZW50IGlmIHZjcHUgaXMg
cG9sbGluZyBldmVudCBjaGFubmVsCi0gKgotICogaWYgdXJnZW50IHZjcHUgZXhpc3RzLCBDUFUg
c2hvdWxkIG5vdCBlbnRlciBkZWVwIEMgc3RhdGUKLSAqLwotc3RhdGljIGlubGluZSBpbnQgc2No
ZWRfaGFzX3VyZ2VudF92Y3B1KHZvaWQpCi17Ci0gICAgcmV0dXJuIGF0b21pY19yZWFkKCZ0aGlz
X2NwdShzY2hlZHVsZV9kYXRhKS51cmdlbnRfY291bnQpOwotfQotCiAjZW5kaWYgLyogX19YODZf
QVNNX0NQVUlETEVfSF9fICovCmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQtaWYu
aCBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5oCmluZGV4IDZhYThkMTI1YzguLjJiMTUyZDFj
NzUgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5oCisrKyBiL3hlbi9pbmNs
dWRlL3hlbi9zY2hlZC1pZi5oCkBAIC0zMywyMiArMzMsMTkgQEAgZXh0ZXJuIGludCBzY2hlZF9y
YXRlbGltaXRfdXM7CiAgKiBGb3IgY2FjaGUgYmV0dGVybmVzcywga2VlcCB0aGUgYWN0dWFsIGxv
Y2sgaW4gdGhlIHNhbWUgY2FjaGUgYXJlYQogICogYXMgdGhlIHJlc3Qgb2YgdGhlIHN0cnVjdC4g
IEp1c3QgaGF2ZSB0aGUgc2NoZWR1bGVyIHBvaW50IHRvIHRoZQogICogb25lIGl0IHdhbnRzIChU
aGlzIG1heSBiZSB0aGUgb25lIHJpZ2h0IGluIGZyb250IG9mIGl0KS4qLwotc3RydWN0IHNjaGVk
dWxlX2RhdGEgeworc3RydWN0IHNjaGVkX3Jlc291cmNlIHsKICAgICBzcGlubG9ja190ICAgICAg
ICAgKnNjaGVkdWxlX2xvY2ssCiAgICAgICAgICAgICAgICAgICAgICAgIF9sb2NrOwogICAgIHN0
cnVjdCBzY2hlZF91bml0ICAqY3VycjsKICAgICB2b2lkICAgICAgICAgICAgICAgKnNjaGVkX3By
aXY7CiAgICAgc3RydWN0IHRpbWVyICAgICAgICBzX3RpbWVyOyAgICAgICAgLyogc2NoZWR1bGlu
ZyB0aW1lciAgICAgICAgICAgICAgICAqLwotICAgIGF0b21pY190ICAgICAgICAgICAgdXJnZW50
X2NvdW50OyAgIC8qIGhvdyBtYW55IHVyZ2VudCB2Y3B1cyAgICAgICAgICAgKi8KLX07Ci0KLSNk
ZWZpbmUgY3Vycl9vbl9jcHUoYykgICAgKHBlcl9jcHUoc2NoZWR1bGVfZGF0YSwgYykuY3VycikK
IAotc3RydWN0IHNjaGVkX3Jlc291cmNlIHsKLSAgICB1bnNpZ25lZCBpbnQgbWFzdGVyX2NwdTsg
IC8qIENwdSB3aXRoIGxvd2VzdCBpZCBpbiBzY2hlZHVsaW5nIHJlc291cmNlLiAqLworICAgIC8q
IENwdSB3aXRoIGxvd2VzdCBpZCBpbiBzY2hlZHVsaW5nIHJlc291cmNlLiAqLworICAgIHVuc2ln
bmVkIGludCAgICAgICAgbWFzdGVyX2NwdTsKIH07CiAKLURFQ0xBUkVfUEVSX0NQVShzdHJ1Y3Qg
c2NoZWR1bGVfZGF0YSwgc2NoZWR1bGVfZGF0YSk7CisjZGVmaW5lIGN1cnJfb25fY3B1KGMpICAg
IChnZXRfc2NoZWRfcmVzKGMpLT5jdXJyKQorCiBERUNMQVJFX1BFUl9DUFUoc3RydWN0IHNjaGVk
dWxlciAqLCBzY2hlZHVsZXIpOwogREVDTEFSRV9QRVJfQ1BVKHN0cnVjdCBjcHVwb29sICosIGNw
dXBvb2wpOwogREVDTEFSRV9QRVJfQ1BVKHN0cnVjdCBzY2hlZF9yZXNvdXJjZSAqLCBzY2hlZF9y
ZXMpOwpAQCAtNzksNyArNzYsNyBAQCBzdGF0aWMgaW5saW5lIHNwaW5sb2NrX3QgKmtpbmQjI19z
Y2hlZHVsZV9sb2NrIyNpcnEocGFyYW0gRVhUUkFfVFlQRShhcmcpKSBcCiB7IFwKICAgICBmb3Ig
KCA7IDsgKSBcCiAgICAgeyBcCi0gICAgICAgIHNwaW5sb2NrX3QgKmxvY2sgPSBwZXJfY3B1KHNj
aGVkdWxlX2RhdGEsIGNwdSkuc2NoZWR1bGVfbG9jazsgXAorICAgICAgICBzcGlubG9ja190ICps
b2NrID0gZ2V0X3NjaGVkX3JlcyhjcHUpLT5zY2hlZHVsZV9sb2NrOyBcCiAgICAgICAgIC8qIFwK
ICAgICAgICAgICogdi0+cHJvY2Vzc29yIG1heSBjaGFuZ2Ugd2hlbiBncmFiYmluZyB0aGUgbG9j
azsgYnV0IFwKICAgICAgICAgICogcGVyX2NwdSh2LT5wcm9jZXNzb3IpIG1heSBhbHNvIGNoYW5n
ZSwgaWYgY2hhbmdpbmcgY3B1IHBvb2wgXApAQCAtODksNyArODYsNyBAQCBzdGF0aWMgaW5saW5l
IHNwaW5sb2NrX3QgKmtpbmQjI19zY2hlZHVsZV9sb2NrIyNpcnEocGFyYW0gRVhUUkFfVFlQRShh
cmcpKSBcCiAgICAgICAgICAqIGxvY2sgbWF5IGJlIHRoZSBzYW1lOyB0aGlzIHdpbGwgc3VjY2Vl
ZCBpbiB0aGF0IGNhc2UuIFwKICAgICAgICAgICovIFwKICAgICAgICAgc3Bpbl9sb2NrIyNpcnEo
bG9jaywgIyMgYXJnKTsgXAotICAgICAgICBpZiAoIGxpa2VseShsb2NrID09IHBlcl9jcHUoc2No
ZWR1bGVfZGF0YSwgY3B1KS5zY2hlZHVsZV9sb2NrKSApIFwKKyAgICAgICAgaWYgKCBsaWtlbHko
bG9jayA9PSBnZXRfc2NoZWRfcmVzKGNwdSktPnNjaGVkdWxlX2xvY2spICkgXAogICAgICAgICAg
ICAgcmV0dXJuIGxvY2s7IFwKICAgICAgICAgc3Bpbl91bmxvY2sjI2lycShsb2NrLCAjIyBhcmcp
OyBcCiAgICAgfSBcCkBAIC05OSw3ICs5Niw3IEBAIHN0YXRpYyBpbmxpbmUgc3BpbmxvY2tfdCAq
a2luZCMjX3NjaGVkdWxlX2xvY2sjI2lycShwYXJhbSBFWFRSQV9UWVBFKGFyZykpIFwKIHN0YXRp
YyBpbmxpbmUgdm9pZCBraW5kIyNfc2NoZWR1bGVfdW5sb2NrIyNpcnEoc3BpbmxvY2tfdCAqbG9j
ayBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVYVFJB
X1RZUEUoYXJnKSwgcGFyYW0pIFwKIHsgXAotICAgIEFTU0VSVChsb2NrID09IHBlcl9jcHUoc2No
ZWR1bGVfZGF0YSwgY3B1KS5zY2hlZHVsZV9sb2NrKTsgXAorICAgIEFTU0VSVChsb2NrID09IGdl
dF9zY2hlZF9yZXMoY3B1KS0+c2NoZWR1bGVfbG9jayk7IFwKICAgICBzcGluX3VubG9jayMjaXJx
KGxvY2ssICMjIGFyZyk7IFwKIH0KIApAQCAtMTI4LDExICsxMjUsMTEgQEAgc2NoZWRfdW5sb2Nr
KHZjcHUsIGNvbnN0IHN0cnVjdCB2Y3B1ICp2LCB2LT5wcm9jZXNzb3IsIF9pcnFyZXN0b3JlLCBm
bGFncykKIAogc3RhdGljIGlubGluZSBzcGlubG9ja190ICpwY3B1X3NjaGVkdWxlX3RyeWxvY2so
dW5zaWduZWQgaW50IGNwdSkKIHsKLSAgICBzcGlubG9ja190ICpsb2NrID0gcGVyX2NwdShzY2hl
ZHVsZV9kYXRhLCBjcHUpLnNjaGVkdWxlX2xvY2s7CisgICAgc3BpbmxvY2tfdCAqbG9jayA9IGdl
dF9zY2hlZF9yZXMoY3B1KS0+c2NoZWR1bGVfbG9jazsKIAogICAgIGlmICggIXNwaW5fdHJ5bG9j
ayhsb2NrKSApCiAgICAgICAgIHJldHVybiBOVUxMOwotICAgIGlmICggbG9jayA9PSBwZXJfY3B1
KHNjaGVkdWxlX2RhdGEsIGNwdSkuc2NoZWR1bGVfbG9jayApCisgICAgaWYgKCBsb2NrID09IGdl
dF9zY2hlZF9yZXMoY3B1KS0+c2NoZWR1bGVfbG9jayApCiAgICAgICAgIHJldHVybiBsb2NrOwog
ICAgIHNwaW5fdW5sb2NrKGxvY2spOwogICAgIHJldHVybiBOVUxMOwpkaWZmIC0tZ2l0IGEveGVu
L2luY2x1ZGUveGVuL3NjaGVkLmggYi94ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaAppbmRleCA5OTll
NDNlOGNjLi44NzgwODg4NjAzIDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaAor
KysgYi94ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaApAQCAtODgxLDYgKzg4MSwxNyBAQCBzdGF0aWMg
aW5saW5lIHN0cnVjdCB2Y3B1ICpkb21haW5fdmNwdShjb25zdCBzdHJ1Y3QgZG9tYWluICpkLAog
CiB2b2lkIGNwdV9pbml0KHZvaWQpOwogCisvKgorICogdmNwdSBpcyB1cmdlbnQgaWYgdmNwdSBp
cyBwb2xsaW5nIGV2ZW50IGNoYW5uZWwKKyAqCisgKiBpZiB1cmdlbnQgdmNwdSBleGlzdHMsIENQ
VSBzaG91bGQgbm90IGVudGVyIGRlZXAgQyBzdGF0ZQorICovCitERUNMQVJFX1BFUl9DUFUoYXRv
bWljX3QsIHNjaGVkX3VyZ2VudF9jb3VudCk7CitzdGF0aWMgaW5saW5lIGJvb2wgc2NoZWRfaGFz
X3VyZ2VudF92Y3B1KHZvaWQpCit7CisgICAgcmV0dXJuIGF0b21pY19yZWFkKCZ0aGlzX2NwdShz
Y2hlZF91cmdlbnRfY291bnQpKTsKK30KKwogc3RydWN0IHNjaGVkdWxlcjsKIAogc3RydWN0IHNj
aGVkdWxlciAqc2NoZWR1bGVyX2dldF9kZWZhdWx0KHZvaWQpOwotLSAKMi4xNi40CgoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxp
bmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5w
cm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

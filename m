Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 4F9D03348F
	for <lists+xen-devel@lfdr.de>; Mon,  3 Jun 2019 18:07:52 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hXpRk-0002FT-AU; Mon, 03 Jun 2019 16:04:28 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=fnY6=UC=arm.com=julien.grall@srs-us1.protection.inumbo.net>)
 id 1hXpRi-0002Dj-HD
 for xen-devel@lists.xenproject.org; Mon, 03 Jun 2019 16:04:26 +0000
X-Inumbo-ID: 4172eec2-8619-11e9-8980-bc764e045a96
Received: from foss.arm.com (unknown [217.140.101.70])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTP
 id 4172eec2-8619-11e9-8980-bc764e045a96;
 Mon, 03 Jun 2019 16:04:24 +0000 (UTC)
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.72.51.249])
 by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id 16852A78;
 Mon,  3 Jun 2019 09:04:24 -0700 (PDT)
Received: from e108454-lin.cambridge.arm.com (e108454-lin.cambridge.arm.com
 [10.1.196.50])
 by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPSA id D344E3F246;
 Mon,  3 Jun 2019 09:04:21 -0700 (PDT)
From: Julien Grall <julien.grall@arm.com>
To: xen-devel@lists.xenproject.org
Date: Mon,  3 Jun 2019 17:03:49 +0100
Message-Id: <20190603160350.29806-14-julien.grall@arm.com>
X-Mailer: git-send-email 2.11.0
In-Reply-To: <20190603160350.29806-1-julien.grall@arm.com>
References: <20190603160350.29806-1-julien.grall@arm.com>
Subject: [Xen-devel] [PATCH v3 13/14] xen/mm: Convert {s,
 g}et_gpfn_from_mfn() to use typesafe MFN
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Tamas K Lengyel <tamas@tklengyel.com>,
 Jan Beulich <jbeulich@suse.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhlIGZpcnN0IHBhcmFtZXRlciBvZiB7cyxnfWV0X2dwZm5fZnJvbV9tZm4oKSBpcyBhbiBNRk4s
IHNvIGl0IGNhbiBiZQpzd2l0Y2hlZCB0byB1c2UgdGhlIHR5cGVzYWZlLgoKQXQgdGhlIHNhbWUg
dGltZSwgcmVwbGFjZSBncGZuIHdpdGggcGZuIGluIHRoZSBoZWxwZXJzIGFzIHRoZXkgYWxsIGRl
YWwKd2l0aCBQRk4gYW5kIGFsc28gdHVybiB0aGUgbWFjcm9zIHRvIHN0YXRpYyBpbmxpbmUuCgpO
b3RlIHRoYXQgdGhlIHJldHVybiBvZiB0aGUgZ2V0dGVyIGFuZCB0aGUgMm5kIHBhcmFtZXRlciBv
ZiB0aGUgc2V0dGVyCmhhdmUgbm90IGJlZW4gY29udmVydGVkIHRvIHVzZSB0eXBlc2FmZSBQRk4g
YmVjYXVzZSBpdCB3YXMgcmVxdWlyaW5nCm1vcmUgY2hhbmdlcyB0aGFuIGV4cGVjdGVkLgoKU2ln
bmVkLW9mZi1ieTogSnVsaWVuIEdyYWxsIDxqdWxpZW4uZ3JhbGxAYXJtLmNvbT4KQWNrZWQtYnk6
IFRhbWFzIEsgTGVuZ3llbCA8dGFtYXNAdGtsZW5neWVsLmNvbT4KQWNrZWQtYnk6IFN0ZWZhbm8g
U3RhYmVsbGluaSA8c3N0YWJlbGxpbmlAa2VybmVsLm9yZz4KCi0tLQogICAgQ2hhbmdlcyBpbiB2
MzoKICAgICAgICAtIEFkZCBUYW1hcydzIGFja2VkLWJ5IGZvciBtZW1fc2hhcmluZyBiaXRzCiAg
ICAgICAgLSBBZGQgU3RlZmFubydzIGFja2VkLWJ5CiAgICAgICAgLSBGaXggY29kaW5nIHN0eWxl
IGluIHRoZSBkZWNsYXJhdGlvbiBvZiBtZW1fc2hhcmluZ19sb29rdXAoKQotLS0KIHhlbi9hcmNo
L3g4Ni9jcHUvbWNoZWNrL21jYWN0aW9uLmMgfCAgMiArLQogeGVuL2FyY2gveDg2L21tLmMgICAg
ICAgICAgICAgICAgICB8IDE0ICsrKystLS0tCiB4ZW4vYXJjaC94ODYvbW0vbWVtX3NoYXJpbmcu
YyAgICAgIHwgMTkgKysrKystLS0tLS0KIHhlbi9hcmNoL3g4Ni9tbS9wMm0tcG9kLmMgICAgICAg
ICAgfCAgNCArLS0KIHhlbi9hcmNoL3g4Ni9tbS9wMm0tcHQuYyAgICAgICAgICAgfCAzNCArKysr
KysrKysrKy0tLS0tLS0tLQogeGVuL2FyY2gveDg2L21tL3AybS5jICAgICAgICAgICAgICB8IDY2
ICsrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLS0tCiB4ZW4vYXJjaC94ODYvbW0v
cGFnaW5nLmMgICAgICAgICAgIHwgIDQgKy0tCiB4ZW4vYXJjaC94ODYvcHYvZG9tMF9idWlsZC5j
ICAgICAgIHwgIDYgKystLQogeGVuL2FyY2gveDg2L3g4Nl82NC90cmFwcy5jICAgICAgICB8IDQx
ICsrKysrKysrKysrLS0tLS0tLS0tLS0tCiB4ZW4vY29tbW9uL3BhZ2VfYWxsb2MuYyAgICAgICAg
ICAgIHwgIDIgKy0KIHhlbi9pbmNsdWRlL2FzbS1hcm0vbW0uaCAgICAgICAgICAgfCAgMiArLQog
eGVuL2luY2x1ZGUvYXNtLXg4Ni9ncmFudF90YWJsZS5oICB8ICAyICstCiB4ZW4vaW5jbHVkZS9h
c20teDg2L21tLmggICAgICAgICAgIHwgMTYgKysrKystLS0tCiB4ZW4vaW5jbHVkZS9hc20teDg2
L3AybS5oICAgICAgICAgIHwgIDIgKy0KIDE0IGZpbGVzIGNoYW5nZWQsIDExMSBpbnNlcnRpb25z
KCspLCAxMDMgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L2NwdS9tY2hl
Y2svbWNhY3Rpb24uYyBiL3hlbi9hcmNoL3g4Ni9jcHUvbWNoZWNrL21jYWN0aW9uLmMKaW5kZXgg
NjkzMzJmYjg0ZC4uNWU3OGZiNzcwMyAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L2NwdS9tY2hl
Y2svbWNhY3Rpb24uYworKysgYi94ZW4vYXJjaC94ODYvY3B1L21jaGVjay9tY2FjdGlvbi5jCkBA
IC04OSw3ICs4OSw3IEBAIG1jX21lbWVycl9kaGFuZGxlcihzdHJ1Y3QgbWNhX2JpbmZvICpiaW5m
bywKICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICBkID0gZ2V0X2RvbWFpbl9ieV9pZChi
YW5rLT5tY19kb21pZCk7CiAgICAgICAgICAgICAgICAgQVNTRVJUKGQpOwotICAgICAgICAgICAg
ICAgIGdmbiA9IGdldF9ncGZuX2Zyb21fbWZuKChiYW5rLT5tY19hZGRyKSA+PiBQQUdFX1NISUZU
KTsKKyAgICAgICAgICAgICAgICBnZm4gPSBnZXRfcGZuX2Zyb21fbWZuKG1hZGRyX3RvX21mbihi
YW5rLT5tY19hZGRyKSk7CiAKICAgICAgICAgICAgICAgICBpZiAoIHVubW1hcF9icm9rZW5fcGFn
ZShkLCBtZm4sIGdmbikgKQogICAgICAgICAgICAgICAgIHsKZGlmZiAtLWdpdCBhL3hlbi9hcmNo
L3g4Ni9tbS5jIGIveGVuL2FyY2gveDg2L21tLmMKaW5kZXggM2JiMTI3ODJhMS4uODNlMGYwZmI2
YiAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L21tLmMKKysrIGIveGVuL2FyY2gveDg2L21tLmMK
QEAgLTUwMCw3ICs1MDAsNyBAQCB2b2lkIHNoYXJlX3hlbl9wYWdlX3dpdGhfZ3Vlc3Qoc3RydWN0
IHBhZ2VfaW5mbyAqcGFnZSwgc3RydWN0IGRvbWFpbiAqZCwKICAgICBpZiAoIHBhZ2VfZ2V0X293
bmVyKHBhZ2UpID09IGQgKQogICAgICAgICByZXR1cm47CiAKLSAgICBzZXRfZ3Bmbl9mcm9tX21m
bihtZm5feChwYWdlX3RvX21mbihwYWdlKSksIElOVkFMSURfTTJQX0VOVFJZKTsKKyAgICBzZXRf
cGZuX2Zyb21fbWZuKHBhZ2VfdG9fbWZuKHBhZ2UpLCBJTlZBTElEX00yUF9FTlRSWSk7CiAKICAg
ICBzcGluX2xvY2soJmQtPnBhZ2VfYWxsb2NfbG9jayk7CiAKQEAgLTEwNzUsNyArMTA3NSw3IEBA
IGdldF9wYWdlX2Zyb21fbDFlKAogCiAgICAgICAgICAgICBnZHByaW50ayhYRU5MT0dfV0FSTklO
RywgIkVycm9yIHVwZGF0aW5nIG1hcHBpbmdzIGZvciBtZm4gJSIgUFJJX21mbgogICAgICAgICAg
ICAgICAgICAgICAgIiAocGZuICUiIFBSSV9wZm4gIiwgZnJvbSBMMSBlbnRyeSAlIiBQUklwdGUg
IikgZm9yIGQlZFxuIiwKLSAgICAgICAgICAgICAgICAgICAgIG1mbiwgZ2V0X2dwZm5fZnJvbV9t
Zm4obWZuKSwKKyAgICAgICAgICAgICAgICAgICAgIG1mbiwgZ2V0X3Bmbl9mcm9tX21mbihfbWZu
KG1mbikpLAogICAgICAgICAgICAgICAgICAgICAgbDFlX2dldF9pbnRwdGUobDFlKSwgbDFlX293
bmVyLT5kb21haW5faWQpOwogICAgICAgICAgICAgcmV0dXJuIGVycjsKICAgICAgICAgfQpAQCAt
MTA4Niw3ICsxMDg2LDcgQEAgZ2V0X3BhZ2VfZnJvbV9sMWUoCiAgY291bGRfbm90X3BpbjoKICAg
ICBnZHByaW50ayhYRU5MT0dfV0FSTklORywgIkVycm9yIGdldHRpbmcgbWZuICUiIFBSSV9tZm4g
IiAocGZuICUiIFBSSV9wZm4KICAgICAgICAgICAgICAiKSBmcm9tIEwxIGVudHJ5ICUiIFBSSXB0
ZSAiIGZvciBsMWVfb3duZXIgZCVkLCBwZ19vd25lciBkJWRcbiIsCi0gICAgICAgICAgICAgbWZu
LCBnZXRfZ3Bmbl9mcm9tX21mbihtZm4pLAorICAgICAgICAgICAgIG1mbiwgZ2V0X3Bmbl9mcm9t
X21mbihfbWZuKG1mbikpLAogICAgICAgICAgICAgIGwxZV9nZXRfaW50cHRlKGwxZSksIGwxZV9v
d25lci0+ZG9tYWluX2lkLCBwZ19vd25lci0+ZG9tYWluX2lkKTsKICAgICBpZiAoIHJlYWxfcGdf
b3duZXIgIT0gTlVMTCApCiAgICAgICAgIHB1dF9wYWdlKHBhZ2UpOwpAQCAtMjYwMiw3ICsyNjAy
LDcgQEAgc3RhdGljIGludCBhbGxvY19wYWdlX3R5cGUoc3RydWN0IHBhZ2VfaW5mbyAqcGFnZSwg
dW5zaWduZWQgbG9uZyB0eXBlLAogICAgICAgICAgICAgICAgICAiIChwZm4gJSIgUFJJX3BmbiAi
KSBmb3IgdHlwZSAlIiBQUnR5cGVfaW5mbwogICAgICAgICAgICAgICAgICAiOiBjYWY9JTA4bHgg
dGFmPSUiIFBSdHlwZV9pbmZvICJcbiIsCiAgICAgICAgICAgICAgICAgIG1mbl94KHBhZ2VfdG9f
bWZuKHBhZ2UpKSwKLSAgICAgICAgICAgICAgICAgZ2V0X2dwZm5fZnJvbV9tZm4obWZuX3gocGFn
ZV90b19tZm4ocGFnZSkpKSwKKyAgICAgICAgICAgICAgICAgZ2V0X3Bmbl9mcm9tX21mbihwYWdl
X3RvX21mbihwYWdlKSksCiAgICAgICAgICAgICAgICAgIHR5cGUsIHBhZ2UtPmNvdW50X2luZm8s
IHBhZ2UtPnUuaW51c2UudHlwZV9pbmZvKTsKICAgICAgICAgaWYgKCBwYWdlICE9IGN1cnJlbnQt
PmFyY2gub2xkX2d1ZXN0X3RhYmxlICkKICAgICAgICAgICAgIHBhZ2UtPnUuaW51c2UudHlwZV9p
bmZvID0gMDsKQEAgLTI4ODYsNyArMjg4Niw3IEBAIHN0YXRpYyBpbnQgX2dldF9wYWdlX3R5cGUo
c3RydWN0IHBhZ2VfaW5mbyAqcGFnZSwgdW5zaWduZWQgbG9uZyB0eXBlLAogICAgICAgICAgICAg
ICAgICAgICAgIkJhZCB0eXBlIChzYXcgJSIgUFJ0eXBlX2luZm8gIiAhPSBleHAgJSIgUFJ0eXBl
X2luZm8gIikgIgogICAgICAgICAgICAgICAgICAgICAgImZvciBtZm4gJSIgUFJJX21mbiAiIChw
Zm4gJSIgUFJJX3BmbiAiKVxuIiwKICAgICAgICAgICAgICAgICAgICAgIHgsIHR5cGUsIG1mbl94
KHBhZ2VfdG9fbWZuKHBhZ2UpKSwKLSAgICAgICAgICAgICAgICAgICAgIGdldF9ncGZuX2Zyb21f
bWZuKG1mbl94KHBhZ2VfdG9fbWZuKHBhZ2UpKSkpOworICAgICAgICAgICAgICAgICAgICAgZ2V0
X3Bmbl9mcm9tX21mbihwYWdlX3RvX21mbihwYWdlKSkpOwogICAgICAgICAgICAgcmV0dXJuIC1F
SU5WQUw7CiAgICAgICAgIH0KICAgICAgICAgZWxzZSBpZiAoIHVubGlrZWx5KCEoeCAmIFBHVF92
YWxpZGF0ZWQpKSApCkBAIC0zOTk4LDcgKzM5OTgsNyBAQCBsb25nIGRvX21tdV91cGRhdGUoCiAg
ICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICB9CiAKLSAgICAgICAgICAgIHNldF9n
cGZuX2Zyb21fbWZuKG1mbl94KG1mbiksIGdwZm4pOworICAgICAgICAgICAgc2V0X3Bmbl9mcm9t
X21mbihtZm4sIGdwZm4pOwogICAgICAgICAgICAgcGFnaW5nX21hcmtfcGZuX2RpcnR5KHBnX293
bmVyLCBfcGZuKGdwZm4pKTsKIAogICAgICAgICAgICAgcHV0X3BhZ2UocGFnZSk7CkBAIC00NTIy
LDcgKzQ1MjIsNyBAQCBpbnQgeGVubWVtX2FkZF90b19waHlzbWFwX29uZSgKICAgICAgICAgZ290
byBwdXRfYm90aDsKIAogICAgIC8qIFVubWFwIGZyb20gb2xkIGxvY2F0aW9uLCBpZiBhbnkuICov
Ci0gICAgb2xkX2dwZm4gPSBnZXRfZ3Bmbl9mcm9tX21mbihtZm5feChtZm4pKTsKKyAgICBvbGRf
Z3BmbiA9IGdldF9wZm5fZnJvbV9tZm4obWZuKTsKICAgICBBU1NFUlQoIVNIQVJFRF9NMlAob2xk
X2dwZm4pKTsKICAgICBpZiAoIHNwYWNlID09IFhFTk1BUFNQQUNFX2dtZm4gJiYgb2xkX2dwZm4g
IT0gZ2ZuICkKICAgICB7CmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvbW0vbWVtX3NoYXJpbmcu
YyBiL3hlbi9hcmNoL3g4Ni9tbS9tZW1fc2hhcmluZy5jCmluZGV4IGYxNmEzZjUzMjQuLmZjMWZi
NmZlODkgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9tbS9tZW1fc2hhcmluZy5jCisrKyBiL3hl
bi9hcmNoL3g4Ni9tbS9tZW1fc2hhcmluZy5jCkBAIC0zOTEsMTEgKzM5MSwxMiBAQCBzdGF0aWMg
aW5saW5lIHZvaWQgbWVtX3NoYXJpbmdfZ2ZuX2Rlc3Ryb3koc3RydWN0IHBhZ2VfaW5mbyAqcGFn
ZSwKICAgICB4ZnJlZShnZm5faW5mbyk7CiB9CiAKLXN0YXRpYyBzdHJ1Y3QgcGFnZV9pbmZvKiBt
ZW1fc2hhcmluZ19sb29rdXAodW5zaWduZWQgbG9uZyBtZm4pCitzdGF0aWMgc3RydWN0IHBhZ2Vf
aW5mbyAqbWVtX3NoYXJpbmdfbG9va3VwKG1mbl90IG1mbikKIHsKLSAgICBpZiAoIG1mbl92YWxp
ZChfbWZuKG1mbikpICkKKyAgICBpZiAoIG1mbl92YWxpZChtZm4pICkKICAgICB7Ci0gICAgICAg
IHN0cnVjdCBwYWdlX2luZm8qIHBhZ2UgPSBtZm5fdG9fcGFnZShfbWZuKG1mbikpOworICAgICAg
ICBzdHJ1Y3QgcGFnZV9pbmZvKiBwYWdlID0gbWZuX3RvX3BhZ2UobWZuKTsKKwogICAgICAgICBp
ZiAoIHBhZ2VfZ2V0X293bmVyKHBhZ2UpID09IGRvbV9jb3cgKQogICAgICAgICB7CiAgICAgICAg
ICAgICAvKiBDb3VudCBoYXMgdG8gYmUgYXQgbGVhc3QgdHdvLCBiZWNhdXNlIHdlJ3JlIGNhbGxl
ZApAQCAtNDA0LDcgKzQwNSw3IEBAIHN0YXRpYyBzdHJ1Y3QgcGFnZV9pbmZvKiBtZW1fc2hhcmlu
Z19sb29rdXAodW5zaWduZWQgbG9uZyBtZm4pCiAgICAgICAgICAgICB1bnNpZ25lZCBsb25nIHQg
PSByZWFkX2F0b21pYygmcGFnZS0+dS5pbnVzZS50eXBlX2luZm8pOwogICAgICAgICAgICAgQVNT
RVJUKCh0ICYgUEdUX3R5cGVfbWFzaykgPT0gUEdUX3NoYXJlZF9wYWdlKTsKICAgICAgICAgICAg
IEFTU0VSVCgodCAmIFBHVF9jb3VudF9tYXNrKSA+PSAyKTsKLSAgICAgICAgICAgIEFTU0VSVChT
SEFSRURfTTJQKGdldF9ncGZuX2Zyb21fbWZuKG1mbikpKTsKKyAgICAgICAgICAgIEFTU0VSVChT
SEFSRURfTTJQKGdldF9wZm5fZnJvbV9tZm4obWZuKSkpOwogICAgICAgICAgICAgcmV0dXJuIHBh
Z2U7CiAgICAgICAgIH0KICAgICB9CkBAIC00NjQsMTAgKzQ2NSwxMCBAQCBzdGF0aWMgaW50IGF1
ZGl0KHZvaWQpCiAgICAgICAgIH0KIAogICAgICAgICAvKiBDaGVjayB0aGUgbTJwIGVudHJ5ICov
Ci0gICAgICAgIGlmICggIVNIQVJFRF9NMlAoZ2V0X2dwZm5fZnJvbV9tZm4obWZuX3gobWZuKSkp
ICkKKyAgICAgICAgaWYgKCAhU0hBUkVEX00yUChnZXRfcGZuX2Zyb21fbWZuKG1mbikpICkKICAg
ICAgICAgewogICAgICAgICAgICBNRU1fU0hBUklOR19ERUJVRygibWZuICVseCBzaGFyZWQsIGJ1
dCB3cm9uZyBtMnAgZW50cnkgKCVseCkhXG4iLAotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBtZm5feChtZm4pLCBnZXRfZ3Bmbl9mcm9tX21mbihtZm5feChtZm4pKSk7CisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIG1mbl94KG1mbiksIGdldF9wZm5fZnJvbV9tZm4obWZuKSk7CiAg
ICAgICAgICAgIGVycm9ycysrOwogICAgICAgICB9CiAKQEAgLTY5Myw3ICs2OTQsNyBAQCBzdGF0
aWMgaW5saW5lIHN0cnVjdCBwYWdlX2luZm8gKl9fZ3JhYl9zaGFyZWRfcGFnZShtZm5fdCBtZm4p
CiAgICAgaWYgKCAhbWVtX3NoYXJpbmdfcGFnZV9sb2NrKHBnKSApCiAgICAgICAgIHJldHVybiBO
VUxMOwogCi0gICAgaWYgKCBtZW1fc2hhcmluZ19sb29rdXAobWZuX3gobWZuKSkgPT0gTlVMTCAp
CisgICAgaWYgKCBtZW1fc2hhcmluZ19sb29rdXAobWZuKSA9PSBOVUxMICkKICAgICB7CiAgICAg
ICAgIG1lbV9zaGFyaW5nX3BhZ2VfdW5sb2NrKHBnKTsKICAgICAgICAgcmV0dXJuIE5VTEw7CkBA
IC04NzcsNyArODc4LDcgQEAgc3RhdGljIGludCBub21pbmF0ZV9wYWdlKHN0cnVjdCBkb21haW4g
KmQsIGdmbl90IGdmbiwKICAgICBhdG9taWNfaW5jKCZucl9zaGFyZWRfbWZucyk7CiAKICAgICAv
KiBVcGRhdGUgbTJwIGVudHJ5IHRvIFNIQVJFRF9NMlBfRU5UUlkgKi8KLSAgICBzZXRfZ3Bmbl9m
cm9tX21mbihtZm5feChtZm4pLCBTSEFSRURfTTJQX0VOVFJZKTsKKyAgICBzZXRfcGZuX2Zyb21f
bWZuKG1mbiwgU0hBUkVEX00yUF9FTlRSWSk7CiAKICAgICAqcGhhbmRsZSA9IHBhZ2UtPnNoYXJp
bmctPmhhbmRsZTsKICAgICBhdWRpdF9hZGRfbGlzdChwYWdlKTsKQEAgLTEyMjIsNyArMTIyMyw3
IEBAIHByaXZhdGVfcGFnZV9mb3VuZDoKICAgICB9CiAKICAgICAvKiBVcGRhdGUgbTJwIGVudHJ5
ICovCi0gICAgc2V0X2dwZm5fZnJvbV9tZm4obWZuX3gocGFnZV90b19tZm4ocGFnZSkpLCBnZm4p
OworICAgIHNldF9wZm5fZnJvbV9tZm4ocGFnZV90b19tZm4ocGFnZSksIGdmbik7CiAKICAgICAv
KiBOb3cgdGhhdCB0aGUgZ2ZuPC0+bWZuIG1hcCBpcyBwcm9wZXJseSBlc3RhYmxpc2hlZCwKICAg
ICAgKiBtYXJraW5nIGRpcnR5IGlzIGZlYXNpYmxlICovCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94
ODYvbW0vcDJtLXBvZC5jIGIveGVuL2FyY2gveDg2L21tL3AybS1wb2QuYwppbmRleCA0MzEzODYz
MDY2Li45ZTAwMTczOGY0IDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYvbW0vcDJtLXBvZC5jCisr
KyBiL3hlbi9hcmNoL3g4Ni9tbS9wMm0tcG9kLmMKQEAgLTY1Miw3ICs2NTIsNyBAQCBwMm1fcG9k
X2RlY3JlYXNlX3Jlc2VydmF0aW9uKHN0cnVjdCBkb21haW4gKmQsIGdmbl90IGdmbiwgdW5zaWdu
ZWQgaW50IG9yZGVyKQogICAgICAgICAgICAgfQogICAgICAgICAgICAgcDJtX3RsYl9mbHVzaF9z
eW5jKHAybSk7CiAgICAgICAgICAgICBmb3IgKCBqID0gMDsgaiA8IG47ICsraiApCi0gICAgICAg
ICAgICAgICAgc2V0X2dwZm5fZnJvbV9tZm4obWZuX3gobWZuKSwgSU5WQUxJRF9NMlBfRU5UUlkp
OworICAgICAgICAgICAgICAgIHNldF9wZm5fZnJvbV9tZm4obWZuLCBJTlZBTElEX00yUF9FTlRS
WSk7CiAgICAgICAgICAgICBwMm1fcG9kX2NhY2hlX2FkZChwMm0sIHBhZ2UsIGN1cl9vcmRlcik7
CiAKICAgICAgICAgICAgIHN0ZWFsX2Zvcl9jYWNoZSA9ICAoIHAybS0+cG9kLmVudHJ5X2NvdW50
ID4gcDJtLT5wb2QuY291bnQgKTsKQEAgLTEyMDMsNyArMTIwMyw3IEBAIHAybV9wb2RfZGVtYW5k
X3BvcHVsYXRlKHN0cnVjdCBwMm1fZG9tYWluICpwMm0sIGdmbl90IGdmbiwKIAogICAgIGZvcigg
aSA9IDA7IGkgPCAoMVVMIDw8IG9yZGVyKTsgaSsrICkKICAgICB7Ci0gICAgICAgIHNldF9ncGZu
X2Zyb21fbWZuKG1mbl94KG1mbikgKyBpLCBnZm5feChnZm5fYWxpZ25lZCkgKyBpKTsKKyAgICAg
ICAgc2V0X3Bmbl9mcm9tX21mbihtZm5fYWRkKG1mbiwgaSksIGdmbl94KGdmbl9hbGlnbmVkKSAr
IGkpOwogICAgICAgICBwYWdpbmdfbWFya19wZm5fZGlydHkoZCwgX3BmbihnZm5feChnZm5fYWxp
Z25lZCkgKyBpKSk7CiAgICAgfQogCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvbW0vcDJtLXB0
LmMgYi94ZW4vYXJjaC94ODYvbW0vcDJtLXB0LmMKaW5kZXggODRkZGMxODM0Yi4uYTlkOWFkYTRh
MCAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L21tL3AybS1wdC5jCisrKyBiL3hlbi9hcmNoL3g4
Ni9tbS9wMm0tcHQuYwpAQCAtOTkxLDcgKzk5MSw4IEBAIHN0YXRpYyBpbnQgcDJtX3B0X2NoYW5n
ZV9lbnRyeV90eXBlX3JhbmdlKHN0cnVjdCBwMm1fZG9tYWluICpwMm0sCiBsb25nIHAybV9wdF9h
dWRpdF9wMm0oc3RydWN0IHAybV9kb21haW4gKnAybSkKIHsKICAgICB1bnNpZ25lZCBsb25nIGVu
dHJ5X2NvdW50ID0gMCwgcG1iYWQgPSAwOwotICAgIHVuc2lnbmVkIGxvbmcgbWZuLCBnZm4sIG0y
cGZuOworICAgIHVuc2lnbmVkIGxvbmcgZ2ZuLCBtMnBmbjsKKyAgICBtZm5fdCBtZm47CiAKICAg
ICBBU1NFUlQocDJtX2xvY2tlZF9ieV9tZShwMm0pKTsKICAgICBBU1NFUlQocG9kX2xvY2tlZF9i
eV9tZShwMm0pKTsKQEAgLTEwMzAsMTkgKzEwMzEsMjAgQEAgbG9uZyBwMm1fcHRfYXVkaXRfcDJt
KHN0cnVjdCBwMm1fZG9tYWluICpwMm0pCiAgICAgICAgICAgICAgICAgLyogY2hlY2sgZm9yIDFH
QiBzdXBlciBwYWdlICovCiAgICAgICAgICAgICAgICAgaWYgKCBsM2VfZ2V0X2ZsYWdzKGwzZVtp
M10pICYgX1BBR0VfUFNFICkKICAgICAgICAgICAgICAgICB7Ci0gICAgICAgICAgICAgICAgICAg
IG1mbiA9IGwzZV9nZXRfcGZuKGwzZVtpM10pOwotICAgICAgICAgICAgICAgICAgICBBU1NFUlQo
bWZuX3ZhbGlkKF9tZm4obWZuKSkpOworICAgICAgICAgICAgICAgICAgICBtZm4gPSBsM2VfZ2V0
X21mbihsM2VbaTNdKTsKKyAgICAgICAgICAgICAgICAgICAgQVNTRVJUKG1mbl92YWxpZChtZm4p
KTsKICAgICAgICAgICAgICAgICAgICAgLyogd2UgaGF2ZSB0byBjb3ZlciA1MTJ4NTEyIDRLIHBh
Z2VzICovCiAgICAgICAgICAgICAgICAgICAgIGZvciAoIGkyID0gMDsgCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgIGkyIDwgKEwyX1BBR0VUQUJMRV9FTlRSSUVTICogTDFfUEFHRVRBQkxFX0VO
VFJJRVMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICBpMisrKQogICAgICAgICAgICAgICAg
ICAgICB7Ci0gICAgICAgICAgICAgICAgICAgICAgICBtMnBmbiA9IGdldF9ncGZuX2Zyb21fbWZu
KG1mbitpMik7CisgICAgICAgICAgICAgICAgICAgICAgICBtMnBmbiA9IGdldF9wZm5fZnJvbV9t
Zm4obWZuX2FkZChtZm4sIGkyKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIG0ycGZu
ICE9IChnZm4gKyBpMikgKQogICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHBtYmFkKys7Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgUDJN
X1BSSU5USygibWlzbWF0Y2g6IGdmbiAlI2x4IC0+IG1mbiAlI2x4IC0+IGdmbiAlI2x4XG4iLAot
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2ZuICsgaTIsIG1mbiArIGky
LCBtMnBmbik7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgUDJNX1BSSU5USygibWlzbWF0
Y2g6IGdmbiAlI2x4IC0+IG1mbiAlIlBSSV9tZm4iIGdmbiAlI2x4XG4iLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2ZuICsgaTIsIG1mbl94KG1mbl9hZGQobWZuLCBp
MikpLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbTJwZm4pOwogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIEJVRygpOwogICAgICAgICAgICAgICAgICAgICAgICAg
fQogICAgICAgICAgICAgICAgICAgICAgICAgZ2ZuICs9IDEgPDwgKEwzX1BBR0VUQUJMRV9TSElG
VCAtIFBBR0VfU0hJRlQpOwpAQCAtMTA2NiwxNyArMTA2OCwxNyBAQCBsb25nIHAybV9wdF9hdWRp
dF9wMm0oc3RydWN0IHAybV9kb21haW4gKnAybSkKICAgICAgICAgICAgICAgICAgICAgLyogY2hl
Y2sgZm9yIHN1cGVyIHBhZ2UgKi8KICAgICAgICAgICAgICAgICAgICAgaWYgKCBsMmVfZ2V0X2Zs
YWdzKGwyZVtpMl0pICYgX1BBR0VfUFNFICkKICAgICAgICAgICAgICAgICAgICAgewotICAgICAg
ICAgICAgICAgICAgICAgICAgbWZuID0gbDJlX2dldF9wZm4obDJlW2kyXSk7Ci0gICAgICAgICAg
ICAgICAgICAgICAgICBBU1NFUlQobWZuX3ZhbGlkKF9tZm4obWZuKSkpOworICAgICAgICAgICAg
ICAgICAgICAgICAgbWZuID0gbDJlX2dldF9tZm4obDJlW2kyXSk7CisgICAgICAgICAgICAgICAg
ICAgICAgICBBU1NFUlQobWZuX3ZhbGlkKG1mbikpOwogICAgICAgICAgICAgICAgICAgICAgICAg
Zm9yICggaTEgPSAwOyBpMSA8IEwxX1BBR0VUQUJMRV9FTlRSSUVTOyBpMSsrKQogICAgICAgICAg
ICAgICAgICAgICAgICAgewotICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0ycGZuID0gZ2V0
X2dwZm5fZnJvbV9tZm4obWZuK2kxKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBtMnBm
biA9IGdldF9wZm5fZnJvbV9tZm4obWZuX2FkZChtZm4sIGkxKSk7CiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgLyogQWxsb3cgc2hhcmVkIE0yUHMgKi8KICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBpZiAoIChtMnBmbiAhPSAoZ2ZuICsgaTEpKSAmJiAhU0hBUkVEX00yUChtMnBmbikg
KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgcG1iYWQrKzsKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUDJNX1BS
SU5USygibWlzbWF0Y2g6IGdmbiAlI2x4IC0+IG1mbiAlI2x4IgotICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICIgLT4gZ2ZuICUjbHhcbiIsIGdmbitpMSwgbWZuK2kx
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQMk1fUFJJTlRLKCJtaXNtYXRjaDog
Z2ZuICUjbHggLT4gbWZuICUiUFJJX21mbiIgLT4gZ2ZuICUjbHhcbiIsCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2ZuICsgaTEsIG1mbl94KG1mbl9hZGQobWZu
LCBpMSkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0ycGZu
KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQlVHKCk7CiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgfQpAQCAtMTA5OCwxNyArMTEwMCwxNyBAQCBsb25nIHAybV9wdF9hdWRp
dF9wMm0oc3RydWN0IHAybV9kb21haW4gKnAybSkKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgZW50cnlfY291bnQrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51
ZTsKICAgICAgICAgICAgICAgICAgICAgICAgIH0KLSAgICAgICAgICAgICAgICAgICAgICAgIG1m
biA9IGwxZV9nZXRfcGZuKGwxZVtpMV0pOwotICAgICAgICAgICAgICAgICAgICAgICAgQVNTRVJU
KG1mbl92YWxpZChfbWZuKG1mbikpKTsKLSAgICAgICAgICAgICAgICAgICAgICAgIG0ycGZuID0g
Z2V0X2dwZm5fZnJvbV9tZm4obWZuKTsKKyAgICAgICAgICAgICAgICAgICAgICAgIG1mbiA9IGwx
ZV9nZXRfbWZuKGwxZVtpMV0pOworICAgICAgICAgICAgICAgICAgICAgICAgQVNTRVJUKG1mbl92
YWxpZChtZm4pKTsKKyAgICAgICAgICAgICAgICAgICAgICAgIG0ycGZuID0gZ2V0X3Bmbl9mcm9t
X21mbihtZm4pOwogICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBtMnBmbiAhPSBnZm4gJiYK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSAhPSBwMm1fbW1pb19kaXJlY3QgJiYK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIXAybV9pc19ncmFudCh0eXBlKSAmJgogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAhcDJtX2lzX3NoYXJlZCh0eXBlKSApCiAgICAgICAg
ICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG1iYWQrKzsK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgICBQMk1fUFJJTlRLKCJtaXNtYXRjaDogZ2ZuICUj
bHggLT4gbWZuICUjbHgiCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAi
IC0+IGdmbiAlI2x4XG4iLCBnZm4sIG1mbiwgbTJwZm4pOworICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIFAyTV9QUklOVEsoIm1pc21hdGNoOiBnZm4gJSNseCAtPiBtZm4gJSJQUklfbWZuIiAt
PiBnZm4gJSNseFxuIiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdm
biwgbWZuX3gobWZuKSwgbTJwZm4pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJVRygp
OwogICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICB9CmRpZmYg
LS1naXQgYS94ZW4vYXJjaC94ODYvbW0vcDJtLmMgYi94ZW4vYXJjaC94ODYvbW0vcDJtLmMKaW5k
ZXggMjA4YzE5NjY2Ny4uZDJhODc2Yzc2OSAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L21tL3Ay
bS5jCisrKyBiL3hlbi9hcmNoL3g4Ni9tbS9wMm0uYwpAQCAtNzY5LDcgKzc2OSw3IEBAIHZvaWQg
cDJtX2ZpbmFsX3RlYXJkb3duKHN0cnVjdCBkb21haW4gKmQpCiAKIAogc3RhdGljIGludAotcDJt
X3JlbW92ZV9wYWdlKHN0cnVjdCBwMm1fZG9tYWluICpwMm0sIHVuc2lnbmVkIGxvbmcgZ2ZuX2ws
IHVuc2lnbmVkIGxvbmcgbWZuLAorcDJtX3JlbW92ZV9wYWdlKHN0cnVjdCBwMm1fZG9tYWluICpw
Mm0sIHVuc2lnbmVkIGxvbmcgZ2ZuX2wsIG1mbl90IG1mbiwKICAgICAgICAgICAgICAgICB1bnNp
Z25lZCBpbnQgcGFnZV9vcmRlcikKIHsKICAgICB1bnNpZ25lZCBsb25nIGk7CkBAIC03ODMsMTcg
Kzc4MywxNyBAQCBwMm1fcmVtb3ZlX3BhZ2Uoc3RydWN0IHAybV9kb21haW4gKnAybSwgdW5zaWdu
ZWQgbG9uZyBnZm5fbCwgdW5zaWduZWQgbG9uZyBtZm4sCiAgICAgICAgIHJldHVybiAwOwogCiAg
ICAgQVNTRVJUKGdmbl9sb2NrZWRfYnlfbWUocDJtLCBnZm4pKTsKLSAgICBQMk1fREVCVUcoInJl
bW92aW5nIGdmbj0lI2x4IG1mbj0lI2x4XG4iLCBnZm5fbCwgbWZuKTsKKyAgICBQMk1fREVCVUco
InJlbW92aW5nIGdmbj0lI2x4IG1mbj0lIlBSSV9tZm4iXG4iLCBnZm5fbCwgbWZuX3gobWZuKSk7
CiAKLSAgICBpZiAoIG1mbl92YWxpZChfbWZuKG1mbikpICkKKyAgICBpZiAoIG1mbl92YWxpZCht
Zm4pICkKICAgICB7CiAgICAgICAgIGZvciAoIGkgPSAwOyBpIDwgKDFVTCA8PCBwYWdlX29yZGVy
KTsgaSsrICkKICAgICAgICAgewogICAgICAgICAgICAgbWZuX3JldHVybiA9IHAybS0+Z2V0X2Vu
dHJ5KHAybSwgZ2ZuX2FkZChnZm4sIGkpLCAmdCwgJmEsIDAsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgTlVMTCwgTlVMTCk7CiAgICAgICAgICAgICBpZiAoICFwMm1f
aXNfZ3JhbnQodCkgJiYgIXAybV9pc19zaGFyZWQodCkgJiYgIXAybV9pc19mb3JlaWduKHQpICkK
LSAgICAgICAgICAgICAgICBzZXRfZ3Bmbl9mcm9tX21mbihtZm4raSwgSU5WQUxJRF9NMlBfRU5U
UlkpOwotICAgICAgICAgICAgQVNTRVJUKCAhcDJtX2lzX3ZhbGlkKHQpIHx8IG1mbiArIGkgPT0g
bWZuX3gobWZuX3JldHVybikgKTsKKyAgICAgICAgICAgICAgICBzZXRfcGZuX2Zyb21fbWZuKG1m
bl9hZGQobWZuLCBpKSwgSU5WQUxJRF9NMlBfRU5UUlkpOworICAgICAgICAgICAgQVNTRVJUKCAh
cDJtX2lzX3ZhbGlkKHQpIHx8IG1mbl9lcShtZm5fYWRkKG1mbiwgaSksIG1mbl9yZXR1cm4pICk7
CiAgICAgICAgIH0KICAgICB9CiAgICAgcmV0dXJuIHAybV9zZXRfZW50cnkocDJtLCBnZm4sIElO
VkFMSURfTUZOLCBwYWdlX29yZGVyLCBwMm1faW52YWxpZCwKQEAgLTgwNyw3ICs4MDcsNyBAQCBn
dWVzdF9waHlzbWFwX3JlbW92ZV9wYWdlKHN0cnVjdCBkb21haW4gKmQsIGdmbl90IGdmbiwKICAg
ICBzdHJ1Y3QgcDJtX2RvbWFpbiAqcDJtID0gcDJtX2dldF9ob3N0cDJtKGQpOwogICAgIGludCBy
YzsKICAgICBnZm5fbG9jayhwMm0sIGdmbiwgcGFnZV9vcmRlcik7Ci0gICAgcmMgPSBwMm1fcmVt
b3ZlX3BhZ2UocDJtLCBnZm5feChnZm4pLCBtZm5feChtZm4pLCBwYWdlX29yZGVyKTsKKyAgICBy
YyA9IHAybV9yZW1vdmVfcGFnZShwMm0sIGdmbl94KGdmbiksIG1mbiwgcGFnZV9vcmRlcik7CiAg
ICAgZ2ZuX3VubG9jayhwMm0sIGdmbiwgcGFnZV9vcmRlcik7CiAgICAgcmV0dXJuIHJjOwogfQpA
QCAtODQyLDcgKzg0Miw3IEBAIGd1ZXN0X3BoeXNtYXBfYWRkX3BhZ2Uoc3RydWN0IGRvbWFpbiAq
ZCwgZ2ZuX3QgZ2ZuLCBtZm5fdCBtZm4sCiAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg
ICAgcmV0dXJuIC1FSU5WQUw7CiAKLSAgICAgICAgICAgIHNldF9ncGZuX2Zyb21fbWZuKG1mbl94
KG1mbikgKyBpLCBnZm5feChnZm4pICsgaSk7CisgICAgICAgICAgICBzZXRfcGZuX2Zyb21fbWZu
KG1mbl9hZGQobWZuLCBpKSwgZ2ZuX3goZ2ZuKSArIGkpOwogICAgICAgICB9CiAKICAgICAgICAg
cmV0dXJuIDA7CkBAIC05MjQsNyArOTI0LDcgQEAgZ3Vlc3RfcGh5c21hcF9hZGRfZW50cnkoc3Ry
dWN0IGRvbWFpbiAqZCwgZ2ZuX3QgZ2ZuLCBtZm5fdCBtZm4sCiAgICAgICAgIGVsc2UgaWYgKCBw
Mm1faXNfcmFtKG90KSAmJiAhcDJtX2lzX3BhZ2VkKG90KSApCiAgICAgICAgIHsKICAgICAgICAg
ICAgIEFTU0VSVChtZm5fdmFsaWQob21mbikpOwotICAgICAgICAgICAgc2V0X2dwZm5fZnJvbV9t
Zm4obWZuX3gob21mbiksIElOVkFMSURfTTJQX0VOVFJZKTsKKyAgICAgICAgICAgIHNldF9wZm5f
ZnJvbV9tZm4ob21mbiwgSU5WQUxJRF9NMlBfRU5UUlkpOwogICAgICAgICB9CiAgICAgICAgIGVs
c2UgaWYgKCBvdCA9PSBwMm1fcG9wdWxhdGVfb25fZGVtYW5kICkKICAgICAgICAgewpAQCAtOTY3
LDcgKzk2Nyw3IEBAIGd1ZXN0X3BoeXNtYXBfYWRkX2VudHJ5KHN0cnVjdCBkb21haW4gKmQsIGdm
bl90IGdmbiwgbWZuX3QgbWZuLAogICAgICAgICAgICAgICAgIFAyTV9ERUJVRygib2xkIGdmbj0l
I2x4IC0+IG1mbiAlI2x4XG4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICBnZm5feChvZ2Zu
KSAsIG1mbl94KG9tZm4pKTsKICAgICAgICAgICAgICAgICBpZiAoIG1mbl9lcShvbWZuLCBtZm5f
YWRkKG1mbiwgaSkpICkKLSAgICAgICAgICAgICAgICAgICAgcDJtX3JlbW92ZV9wYWdlKHAybSwg
Z2ZuX3gob2dmbiksIG1mbl94KG1mbl9hZGQobWZuLCBpKSksCisgICAgICAgICAgICAgICAgICAg
IHAybV9yZW1vdmVfcGFnZShwMm0sIGdmbl94KG9nZm4pLCBtZm5fYWRkKG1mbiwgaSksCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwKTsKICAgICAgICAgICAgIH0KICAgICAg
ICAgfQpAQCAtOTg0LDggKzk4NCw4IEBAIGd1ZXN0X3BoeXNtYXBfYWRkX2VudHJ5KHN0cnVjdCBk
b21haW4gKmQsIGdmbl90IGdmbiwgbWZuX3QgbWZuLAogICAgICAgICBpZiAoICFwMm1faXNfZ3Jh
bnQodCkgKQogICAgICAgICB7CiAgICAgICAgICAgICBmb3IgKCBpID0gMDsgaSA8ICgxVUwgPDwg
cGFnZV9vcmRlcik7IGkrKyApCi0gICAgICAgICAgICAgICAgc2V0X2dwZm5fZnJvbV9tZm4obWZu
X3gobWZuX2FkZChtZm4sIGkpKSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBn
Zm5feChnZm5fYWRkKGdmbiwgaSkpKTsKKyAgICAgICAgICAgICAgICBzZXRfcGZuX2Zyb21fbWZu
KG1mbl9hZGQobWZuLCBpKSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdmbl94
KGdmbl9hZGQoZ2ZuLCBpKSkpOwogICAgICAgICB9CiAgICAgfQogICAgIGVsc2UKQEAgLTEyODYs
NyArMTI4Niw3IEBAIHN0YXRpYyBpbnQgc2V0X3R5cGVkX3AybV9lbnRyeShzdHJ1Y3QgZG9tYWlu
ICpkLCB1bnNpZ25lZCBsb25nIGdmbl9sLAogICAgICAgICBmb3IgKCBpID0gMDsgaSA8ICgxVUwg
PDwgb3JkZXIpOyArK2kgKQogICAgICAgICB7CiAgICAgICAgICAgICBBU1NFUlQobWZuX3ZhbGlk
KG1mbl9hZGQob21mbiwgaSkpKTsKLSAgICAgICAgICAgIHNldF9ncGZuX2Zyb21fbWZuKG1mbl94
KG9tZm4pICsgaSwgSU5WQUxJRF9NMlBfRU5UUlkpOworICAgICAgICAgICAgc2V0X3Bmbl9mcm9t
X21mbihtZm5fYWRkKG9tZm4sIGkpLCBJTlZBTElEX00yUF9FTlRSWSk7CiAgICAgICAgIH0KICAg
ICB9CiAKQEAgLTE0ODEsNyArMTQ4MSw3IEBAIGludCBzZXRfc2hhcmVkX3AybV9lbnRyeShzdHJ1
Y3QgZG9tYWluICpkLCB1bnNpZ25lZCBsb25nIGdmbl9sLCBtZm5fdCBtZm4pCiAgICAgcGdfdHlw
ZSA9IHJlYWRfYXRvbWljKCYobWZuX3RvX3BhZ2Uob21mbiktPnUuaW51c2UudHlwZV9pbmZvKSk7
CiAgICAgaWYgKCAocGdfdHlwZSAmIFBHVF9jb3VudF9tYXNrKSA9PSAwCiAgICAgICAgICB8fCAo
cGdfdHlwZSAmIFBHVF90eXBlX21hc2spICE9IFBHVF9zaGFyZWRfcGFnZSApCi0gICAgICAgIHNl
dF9ncGZuX2Zyb21fbWZuKG1mbl94KG9tZm4pLCBJTlZBTElEX00yUF9FTlRSWSk7CisgICAgICAg
IHNldF9wZm5fZnJvbV9tZm4ob21mbiwgSU5WQUxJRF9NMlBfRU5UUlkpOwogCiAgICAgUDJNX0RF
QlVHKCJzZXQgc2hhcmVkICVseCAlbHhcbiIsIGdmbl9sLCBtZm5feChtZm4pKTsKICAgICByYyA9
IHAybV9zZXRfZW50cnkocDJtLCBnZm4sIG1mbiwgUEFHRV9PUkRFUl80SywgcDJtX3JhbV9zaGFy
ZWQsCkBAIC0xODM2LDcgKzE4MzYsNyBAQCBpbnQgcDJtX21lbV9wYWdpbmdfcHJlcChzdHJ1Y3Qg
ZG9tYWluICpkLCB1bnNpZ25lZCBsb25nIGdmbl9sLCB1aW50NjRfdCBidWZmZXIpCiAgICAgcmV0
ID0gcDJtX3NldF9lbnRyeShwMm0sIGdmbiwgbWZuLCBQQUdFX09SREVSXzRLLAogICAgICAgICAg
ICAgICAgICAgICAgICAgcGFnaW5nX21vZGVfbG9nX2RpcnR5KGQpID8gcDJtX3JhbV9sb2dkaXJ0
eQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogcDJt
X3JhbV9ydywgYSk7Ci0gICAgc2V0X2dwZm5fZnJvbV9tZm4obWZuX3gobWZuKSwgZ2ZuX2wpOwor
ICAgIHNldF9wZm5fZnJvbV9tZm4obWZuLCBnZm5fbCk7CiAKICAgICBpZiAoICFwYWdlX2V4dGFu
dCApCiAgICAgICAgIGF0b21pY19kZWMoJmQtPnBhZ2VkX3BhZ2VzKTsKQEAgLTE4ODcsNyArMTg4
Nyw3IEBAIHZvaWQgcDJtX21lbV9wYWdpbmdfcmVzdW1lKHN0cnVjdCBkb21haW4gKmQsIHZtX2V2
ZW50X3Jlc3BvbnNlX3QgKnJzcCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
cDJtX3JhbV9ydywgYSk7CiAKICAgICAgICAgICAgIGlmICggIXJjICkKLSAgICAgICAgICAgICAg
ICBzZXRfZ3Bmbl9mcm9tX21mbihtZm5feChtZm4pLCBnZm5feChnZm4pKTsKKyAgICAgICAgICAg
ICAgICBzZXRfcGZuX2Zyb21fbWZuKG1mbiwgZ2ZuX3goZ2ZuKSk7CiAgICAgICAgIH0KICAgICAg
ICAgZ2ZuX3VubG9jayhwMm0sIGdmbiwgMCk7CiAgICAgfQpAQCAtMjY5Myw3ICsyNjkzLDcgQEAg
aW50IHAybV9jaGFuZ2VfYWx0cDJtX2dmbihzdHJ1Y3QgZG9tYWluICpkLCB1bnNpZ25lZCBpbnQg
aWR4LAogICAgIHsKICAgICAgICAgbWZuID0gYXAybS0+Z2V0X2VudHJ5KGFwMm0sIG9sZF9nZm4s
ICZ0LCAmYSwgMCwgTlVMTCwgTlVMTCk7CiAgICAgICAgIGlmICggbWZuX3ZhbGlkKG1mbikgKQot
ICAgICAgICAgICAgcDJtX3JlbW92ZV9wYWdlKGFwMm0sIGdmbl94KG9sZF9nZm4pLCBtZm5feCht
Zm4pLCBQQUdFX09SREVSXzRLKTsKKyAgICAgICAgICAgIHAybV9yZW1vdmVfcGFnZShhcDJtLCBn
Zm5feChvbGRfZ2ZuKSwgbWZuLCBQQUdFX09SREVSXzRLKTsKICAgICAgICAgcmMgPSAwOwogICAg
ICAgICBnb3RvIG91dDsKICAgICB9CkBAIC0yODA3LDggKzI4MDcsOCBAQCB2b2lkIGF1ZGl0X3Ay
bShzdHJ1Y3QgZG9tYWluICpkLAogewogICAgIHN0cnVjdCBwYWdlX2luZm8gKnBhZ2U7CiAgICAg
c3RydWN0IGRvbWFpbiAqb2Q7Ci0gICAgdW5zaWduZWQgbG9uZyBtZm4sIGdmbjsKLSAgICBtZm5f
dCBwMm1mbjsKKyAgICB1bnNpZ25lZCBsb25nIGdmbjsKKyAgICBtZm5fdCBwMm1mbiwgbWZuOwog
ICAgIHVuc2lnbmVkIGxvbmcgb3JwaGFuc19jb3VudCA9IDAsIG1wYmFkID0gMCwgcG1iYWQgPSAw
OwogICAgIHAybV9hY2Nlc3NfdCBwMm1hOwogICAgIHAybV90eXBlX3QgdHlwZTsKQEAgLTI4MzAs
NTMgKzI4MzAsNTMgQEAgdm9pZCBhdWRpdF9wMm0oc3RydWN0IGRvbWFpbiAqZCwKICAgICBzcGlu
X2xvY2soJmQtPnBhZ2VfYWxsb2NfbG9jayk7CiAgICAgcGFnZV9saXN0X2Zvcl9lYWNoICggcGFn
ZSwgJmQtPnBhZ2VfbGlzdCApCiAgICAgewotICAgICAgICBtZm4gPSBtZm5feChwYWdlX3RvX21m
bihwYWdlKSk7CisgICAgICAgIG1mbiA9IHBhZ2VfdG9fbWZuKHBhZ2UpOwogCi0gICAgICAgIFAy
TV9QUklOVEsoImF1ZGl0aW5nIGd1ZXN0IHBhZ2UsIG1mbj0lI2x4XG4iLCBtZm4pOworICAgICAg
ICBQMk1fUFJJTlRLKCJhdWRpdGluZyBndWVzdCBwYWdlLCBtZm49JSJQUklfbWZuIlxuIiwgbWZu
X3gobWZuKSk7CiAKICAgICAgICAgb2QgPSBwYWdlX2dldF9vd25lcihwYWdlKTsKIAogICAgICAg
ICBpZiAoIG9kICE9IGQgKQogICAgICAgICB7Ci0gICAgICAgICAgICBQMk1fUFJJTlRLKCJtZm4g
JSJQUklfbWZuIiBvd25lciAlcGQgIT0gJXBkXG4iLCBtZm4sIG9kLCBkKTsKKyAgICAgICAgICAg
IFAyTV9QUklOVEsoIm1mbiAlIlBSSV9tZm4iIG93bmVyICVwZCAhPSAlcGRcbiIsIG1mbl94KG1m
biksIG9kLCBkKTsKICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICB9CiAKLSAgICAgICAg
Z2ZuID0gZ2V0X2dwZm5fZnJvbV9tZm4obWZuKTsKKyAgICAgICAgZ2ZuID0gZ2V0X3Bmbl9mcm9t
X21mbihtZm4pOwogICAgICAgICBpZiAoIGdmbiA9PSBJTlZBTElEX00yUF9FTlRSWSApCiAgICAg
ICAgIHsKICAgICAgICAgICAgIG9ycGhhbnNfY291bnQrKzsKLSAgICAgICAgICAgIFAyTV9QUklO
VEsoIm9ycGhhbmVkIGd1ZXN0IHBhZ2U6IG1mbj0lI2x4IGhhcyBpbnZhbGlkIGdmblxuIiwKLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgIG1mbik7CisgICAgICAgICAgICBQMk1fUFJJTlRLKCJv
cnBoYW5lZCBndWVzdCBwYWdlOiBtZm49JSJQUklfbWZuIiBoYXMgaW52YWxpZCBnZm5cbiIsCisg
ICAgICAgICAgICAgICAgICAgICAgIG1mbl94KG1mbikpOwogICAgICAgICAgICAgY29udGludWU7
CiAgICAgICAgIH0KIAogICAgICAgICBpZiAoIFNIQVJFRF9NMlAoZ2ZuKSApCiAgICAgICAgIHsK
LSAgICAgICAgICAgIFAyTV9QUklOVEsoInNoYXJlZCBtZm4gKCVseCkgb24gZG9tYWluIHBhZ2Ug
bGlzdCFcbiIsCi0gICAgICAgICAgICAgICAgICAgIG1mbik7CisgICAgICAgICAgICBQMk1fUFJJ
TlRLKCJzaGFyZWQgbWZuICglIlBSSV9tZm4iKSBvbiBkb21haW4gcGFnZSBsaXN0IVxuIiwKKyAg
ICAgICAgICAgICAgICAgICAgICAgbWZuX3gobWZuKSk7CiAgICAgICAgICAgICBjb250aW51ZTsK
ICAgICAgICAgfQogCiAgICAgICAgIHAybWZuID0gZ2V0X2dmbl90eXBlX2FjY2VzcyhwMm0sIGdm
biwgJnR5cGUsICZwMm1hLCAwLCBOVUxMKTsKLSAgICAgICAgaWYgKCBtZm5feChwMm1mbikgIT0g
bWZuICkKKyAgICAgICAgaWYgKCAhbWZuX2VxKHAybWZuLCBtZm4pICkKICAgICAgICAgewogICAg
ICAgICAgICAgbXBiYWQrKzsKLSAgICAgICAgICAgIFAyTV9QUklOVEsoIm1hcCBtaXNtYXRjaCBt
Zm4gJSNseCAtPiBnZm4gJSNseCAtPiBtZm4gJSNseCIKKyAgICAgICAgICAgIFAyTV9QUklOVEso
Im1hcCBtaXNtYXRjaCBtZm4gJSJQUklfbWZuIiAtPiBnZm4gJSNseCAtPiBtZm4gJSJQUklfbWZu
IiIKICAgICAgICAgICAgICAgICAgICAgICAgIiAoLT4gZ2ZuICUjbHgpXG4iLAotICAgICAgICAg
ICAgICAgICAgICAgICBtZm4sIGdmbiwgbWZuX3gocDJtZm4pLAorICAgICAgICAgICAgICAgICAg
ICAgICBtZm5feChtZm4pLCBnZm4sIG1mbl94KHAybWZuKSwKICAgICAgICAgICAgICAgICAgICAg
ICAgKG1mbl92YWxpZChwMm1mbikKLSAgICAgICAgICAgICAgICAgICAgICAgID8gZ2V0X2dwZm5f
ZnJvbV9tZm4obWZuX3gocDJtZm4pKQorICAgICAgICAgICAgICAgICAgICAgICAgPyBnZXRfcGZu
X2Zyb21fbWZuKHAybWZuKQogICAgICAgICAgICAgICAgICAgICAgICAgOiAtMXUpKTsKICAgICAg
ICAgICAgIC8qIFRoaXMgbTJwIGVudHJ5IGlzIHN0YWxlOiB0aGUgZG9tYWluIGhhcyBhbm90aGVy
IGZyYW1lIGluCiAgICAgICAgICAgICAgKiB0aGlzIHBoeXNpY2FsIHNsb3QuICBObyBncmVhdCBk
aXNhc3RlciwgYnV0IGZvciBuZWF0bmVzcywKICAgICAgICAgICAgICAqIGJsb3cgYXdheSB0aGUg
bTJwIGVudHJ5LiAqLwotICAgICAgICAgICAgc2V0X2dwZm5fZnJvbV9tZm4obWZuLCBJTlZBTElE
X00yUF9FTlRSWSk7CisgICAgICAgICAgICBzZXRfcGZuX2Zyb21fbWZuKG1mbiwgSU5WQUxJRF9N
MlBfRU5UUlkpOwogICAgICAgICB9CiAgICAgICAgIF9fcHV0X2dmbihwMm0sIGdmbik7CiAKLSAg
ICAgICAgUDJNX1BSSU5USygiT0s6IG1mbj0lI2x4LCBnZm49JSNseCwgcDJtZm49JSNseFxuIiwK
LSAgICAgICAgICAgICAgICAgICAgICAgbWZuLCBnZm4sIG1mbl94KHAybWZuKSk7CisgICAgICAg
IFAyTV9QUklOVEsoIk9LOiBtZm49JSJQUklfbWZuIiwgZ2ZuPSUjbHgsIHAybWZuPSUiUFJJX21m
biJcbiIsCisgICAgICAgICAgICAgICAgICAgbWZuX3gobWZuKSwgZ2ZuLCBtZm5feChwMm1mbikp
OwogICAgIH0KICAgICBzcGluX3VubG9jaygmZC0+cGFnZV9hbGxvY19sb2NrKTsKIApkaWZmIC0t
Z2l0IGEveGVuL2FyY2gveDg2L21tL3BhZ2luZy5jIGIveGVuL2FyY2gveDg2L21tL3BhZ2luZy5j
CmluZGV4IDAxMTA4OTM2OGEuLjFlZjc3ZTExODIgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9t
bS9wYWdpbmcuYworKysgYi94ZW4vYXJjaC94ODYvbW0vcGFnaW5nLmMKQEAgLTM0NCw3ICszNDQs
NyBAQCB2b2lkIHBhZ2luZ19tYXJrX2RpcnR5KHN0cnVjdCBkb21haW4gKmQsIG1mbl90IGdtZm4p
CiAgICAgICAgIHJldHVybjsKIAogICAgIC8qIFdlIC9yZWFsbHkvIG1lYW4gUEZOIGhlcmUsIGV2
ZW4gZm9yIG5vbi10cmFuc2xhdGVkIGd1ZXN0cy4gKi8KLSAgICBwZm4gPSBfcGZuKGdldF9ncGZu
X2Zyb21fbWZuKG1mbl94KGdtZm4pKSk7CisgICAgcGZuID0gX3BmbihnZXRfcGZuX2Zyb21fbWZu
KGdtZm4pKTsKIAogICAgIHBhZ2luZ19tYXJrX3Bmbl9kaXJ0eShkLCBwZm4pOwogfQpAQCAtMzYy
LDcgKzM2Miw3IEBAIGludCBwYWdpbmdfbWZuX2lzX2RpcnR5KHN0cnVjdCBkb21haW4gKmQsIG1m
bl90IGdtZm4pCiAgICAgQVNTRVJUKHBhZ2luZ19tb2RlX2xvZ19kaXJ0eShkKSk7CiAKICAgICAv
KiBXZSAvcmVhbGx5LyBtZWFuIFBGTiBoZXJlLCBldmVuIGZvciBub24tdHJhbnNsYXRlZCBndWVz
dHMuICovCi0gICAgcGZuID0gX3BmbihnZXRfZ3Bmbl9mcm9tX21mbihtZm5feChnbWZuKSkpOwor
ICAgIHBmbiA9IF9wZm4oZ2V0X3Bmbl9mcm9tX21mbihnbWZuKSk7CiAgICAgLyogSW52YWxpZCBw
YWdlcyBjYW4ndCBiZSBkaXJ0eS4gKi8KICAgICBpZiAoIHVubGlrZWx5KCFWQUxJRF9NMlAocGZu
X3gocGZuKSkpICkKICAgICAgICAgcmV0dXJuIDA7CmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYv
cHYvZG9tMF9idWlsZC5jIGIveGVuL2FyY2gveDg2L3B2L2RvbTBfYnVpbGQuYwppbmRleCAxYmQ1
M2U5YzA4Li4wMGY2OTQ2Y2E3IDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYvcHYvZG9tMF9idWls
ZC5jCisrKyBiL3hlbi9hcmNoL3g4Ni9wdi9kb20wX2J1aWxkLmMKQEAgLTM5LDcgKzM5LDcgQEAg
dm9pZCBfX2luaXQgZG9tMF91cGRhdGVfcGh5c21hcChzdHJ1Y3QgZG9tYWluICpkLCB1bnNpZ25l
ZCBsb25nIHBmbiwKICAgICBlbHNlCiAgICAgICAgICgodW5zaWduZWQgaW50ICopdnBoeXNtYXBf
cylbcGZuXSA9IG1mbjsKIAotICAgIHNldF9ncGZuX2Zyb21fbWZuKG1mbiwgcGZuKTsKKyAgICBz
ZXRfcGZuX2Zyb21fbWZuKF9tZm4obWZuKSwgcGZuKTsKIH0KIAogc3RhdGljIF9faW5pdCB2b2lk
IG1hcmtfcHZfcHRfcGFnZXNfcmRvbmx5KHN0cnVjdCBkb21haW4gKmQsCkBAIC03OTgsOCArNzk4
LDggQEAgaW50IF9faW5pdCBkb20wX2NvbnN0cnVjdF9wdihzdHJ1Y3QgZG9tYWluICpkLAogICAg
IHBhZ2VfbGlzdF9mb3JfZWFjaCAoIHBhZ2UsICZkLT5wYWdlX2xpc3QgKQogICAgIHsKICAgICAg
ICAgbWZuID0gbWZuX3gocGFnZV90b19tZm4ocGFnZSkpOwotICAgICAgICBCVUdfT04oU0hBUkVE
X00yUChnZXRfZ3Bmbl9mcm9tX21mbihtZm4pKSk7Ci0gICAgICAgIGlmICggZ2V0X2dwZm5fZnJv
bV9tZm4obWZuKSA+PSBjb3VudCApCisgICAgICAgIEJVR19PTihTSEFSRURfTTJQKGdldF9wZm5f
ZnJvbV9tZm4oX21mbihtZm4pKSkpOworICAgICAgICBpZiAoIGdldF9wZm5fZnJvbV9tZm4oX21m
bihtZm4pKSA+PSBjb3VudCApCiAgICAgICAgIHsKICAgICAgICAgICAgIEJVR19PTihpc19wdl8z
MmJpdF9kb21haW4oZCkpOwogICAgICAgICAgICAgaWYgKCAhcGFnZS0+dS5pbnVzZS50eXBlX2lu
Zm8gJiYKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni94ODZfNjQvdHJhcHMuYyBiL3hlbi9hcmNo
L3g4Ni94ODZfNjQvdHJhcHMuYwppbmRleCAyM2Q5MzU3NjU3Li5kYmMxMjU1NDc2IDEwMDY0NAot
LS0gYS94ZW4vYXJjaC94ODYveDg2XzY0L3RyYXBzLmMKKysrIGIveGVuL2FyY2gveDg2L3g4Nl82
NC90cmFwcy5jCkBAIC0xODQsNyArMTg0LDggQEAgdm9pZCB2Y3B1X3Nob3dfcmVnaXN0ZXJzKGNv
bnN0IHN0cnVjdCB2Y3B1ICp2KQogCiB2b2lkIHNob3dfcGFnZV93YWxrKHVuc2lnbmVkIGxvbmcg
YWRkcikKIHsKLSAgICB1bnNpZ25lZCBsb25nIHBmbiwgbWZuID0gcmVhZF9jcjMoKSA+PiBQQUdF
X1NISUZUOworICAgIHVuc2lnbmVkIGxvbmcgcGZuOworICAgIG1mbl90IG1mbiA9IG1hZGRyX3Rv
X21mbihyZWFkX2NyMygpKTsKICAgICBsNF9wZ2VudHJ5X3QgbDRlLCAqbDR0OwogICAgIGwzX3Bn
ZW50cnlfdCBsM2UsICpsM3Q7CiAgICAgbDJfcGdlbnRyeV90IGwyZSwgKmwydDsKQEAgLTE5NCw1
MiArMTk1LDUyIEBAIHZvaWQgc2hvd19wYWdlX3dhbGsodW5zaWduZWQgbG9uZyBhZGRyKQogICAg
IGlmICggIWlzX2Nhbm9uaWNhbF9hZGRyZXNzKGFkZHIpICkKICAgICAgICAgcmV0dXJuOwogCi0g
ICAgbDR0ID0gbWFwX2RvbWFpbl9wYWdlKF9tZm4obWZuKSk7CisgICAgbDR0ID0gbWFwX2RvbWFp
bl9wYWdlKG1mbik7CiAgICAgbDRlID0gbDR0W2w0X3RhYmxlX29mZnNldChhZGRyKV07CiAgICAg
dW5tYXBfZG9tYWluX3BhZ2UobDR0KTsKLSAgICBtZm4gPSBsNGVfZ2V0X3BmbihsNGUpOwotICAg
IHBmbiA9IG1mbl92YWxpZChfbWZuKG1mbikpICYmIG1hY2hpbmVfdG9fcGh5c19tYXBwaW5nX3Zh
bGlkID8KLSAgICAgICAgICBnZXRfZ3Bmbl9mcm9tX21mbihtZm4pIDogSU5WQUxJRF9NMlBfRU5U
Ulk7CisgICAgbWZuID0gbDRlX2dldF9tZm4obDRlKTsKKyAgICBwZm4gPSBtZm5fdmFsaWQobWZu
KSAmJiBtYWNoaW5lX3RvX3BoeXNfbWFwcGluZ192YWxpZCA/CisgICAgICAgICAgZ2V0X3Bmbl9m
cm9tX21mbihtZm4pIDogSU5WQUxJRF9NMlBfRU5UUlk7CiAgICAgcHJpbnRrKCIgTDRbMHglMDNs
eF0gPSAlIlBSSXB0ZSIgJTAxNmx4XG4iLAogICAgICAgICAgICBsNF90YWJsZV9vZmZzZXQoYWRk
ciksIGw0ZV9nZXRfaW50cHRlKGw0ZSksIHBmbik7CiAgICAgaWYgKCAhKGw0ZV9nZXRfZmxhZ3Mo
bDRlKSAmIF9QQUdFX1BSRVNFTlQpIHx8Ci0gICAgICAgICAhbWZuX3ZhbGlkKF9tZm4obWZuKSkg
KQorICAgICAgICAgIW1mbl92YWxpZChtZm4pICkKICAgICAgICAgcmV0dXJuOwogCi0gICAgbDN0
ID0gbWFwX2RvbWFpbl9wYWdlKF9tZm4obWZuKSk7CisgICAgbDN0ID0gbWFwX2RvbWFpbl9wYWdl
KG1mbik7CiAgICAgbDNlID0gbDN0W2wzX3RhYmxlX29mZnNldChhZGRyKV07CiAgICAgdW5tYXBf
ZG9tYWluX3BhZ2UobDN0KTsKLSAgICBtZm4gPSBsM2VfZ2V0X3BmbihsM2UpOwotICAgIHBmbiA9
IG1mbl92YWxpZChfbWZuKG1mbikpICYmIG1hY2hpbmVfdG9fcGh5c19tYXBwaW5nX3ZhbGlkID8K
LSAgICAgICAgICBnZXRfZ3Bmbl9mcm9tX21mbihtZm4pIDogSU5WQUxJRF9NMlBfRU5UUlk7Cisg
ICAgbWZuID0gbDNlX2dldF9tZm4obDNlKTsKKyAgICBwZm4gPSBtZm5fdmFsaWQobWZuKSAmJiBt
YWNoaW5lX3RvX3BoeXNfbWFwcGluZ192YWxpZCA/CisgICAgICAgICAgZ2V0X3Bmbl9mcm9tX21m
bihtZm4pIDogSU5WQUxJRF9NMlBfRU5UUlk7CiAgICAgcHJpbnRrKCIgTDNbMHglMDNseF0gPSAl
IlBSSXB0ZSIgJTAxNmx4JXNcbiIsCiAgICAgICAgICAgIGwzX3RhYmxlX29mZnNldChhZGRyKSwg
bDNlX2dldF9pbnRwdGUobDNlKSwgcGZuLAogICAgICAgICAgICAobDNlX2dldF9mbGFncyhsM2Up
ICYgX1BBR0VfUFNFKSA/ICIgKFBTRSkiIDogIiIpOwogICAgIGlmICggIShsM2VfZ2V0X2ZsYWdz
KGwzZSkgJiBfUEFHRV9QUkVTRU5UKSB8fAogICAgICAgICAgKGwzZV9nZXRfZmxhZ3MobDNlKSAm
IF9QQUdFX1BTRSkgfHwKLSAgICAgICAgICFtZm5fdmFsaWQoX21mbihtZm4pKSApCisgICAgICAg
ICAhbWZuX3ZhbGlkKG1mbikgKQogICAgICAgICByZXR1cm47CiAKLSAgICBsMnQgPSBtYXBfZG9t
YWluX3BhZ2UoX21mbihtZm4pKTsKKyAgICBsMnQgPSBtYXBfZG9tYWluX3BhZ2UobWZuKTsKICAg
ICBsMmUgPSBsMnRbbDJfdGFibGVfb2Zmc2V0KGFkZHIpXTsKICAgICB1bm1hcF9kb21haW5fcGFn
ZShsMnQpOwotICAgIG1mbiA9IGwyZV9nZXRfcGZuKGwyZSk7Ci0gICAgcGZuID0gbWZuX3ZhbGlk
KF9tZm4obWZuKSkgJiYgbWFjaGluZV90b19waHlzX21hcHBpbmdfdmFsaWQgPwotICAgICAgICAg
IGdldF9ncGZuX2Zyb21fbWZuKG1mbikgOiBJTlZBTElEX00yUF9FTlRSWTsKKyAgICBtZm4gPSBs
MmVfZ2V0X21mbihsMmUpOworICAgIHBmbiA9IG1mbl92YWxpZChtZm4pICYmIG1hY2hpbmVfdG9f
cGh5c19tYXBwaW5nX3ZhbGlkID8KKyAgICAgICAgICBnZXRfcGZuX2Zyb21fbWZuKG1mbikgOiBJ
TlZBTElEX00yUF9FTlRSWTsKICAgICBwcmludGsoIiBMMlsweCUwM2x4XSA9ICUiUFJJcHRlIiAl
MDE2bHglc1xuIiwKICAgICAgICAgICAgbDJfdGFibGVfb2Zmc2V0KGFkZHIpLCBsMmVfZ2V0X2lu
dHB0ZShsMmUpLCBwZm4sCiAgICAgICAgICAgIChsMmVfZ2V0X2ZsYWdzKGwyZSkgJiBfUEFHRV9Q
U0UpID8gIiAoUFNFKSIgOiAiIik7CiAgICAgaWYgKCAhKGwyZV9nZXRfZmxhZ3MobDJlKSAmIF9Q
QUdFX1BSRVNFTlQpIHx8CiAgICAgICAgICAobDJlX2dldF9mbGFncyhsMmUpICYgX1BBR0VfUFNF
KSB8fAotICAgICAgICAgIW1mbl92YWxpZChfbWZuKG1mbikpICkKKyAgICAgICAgICFtZm5fdmFs
aWQobWZuKSApCiAgICAgICAgIHJldHVybjsKIAotICAgIGwxdCA9IG1hcF9kb21haW5fcGFnZShf
bWZuKG1mbikpOworICAgIGwxdCA9IG1hcF9kb21haW5fcGFnZShtZm4pOwogICAgIGwxZSA9IGwx
dFtsMV90YWJsZV9vZmZzZXQoYWRkcildOwogICAgIHVubWFwX2RvbWFpbl9wYWdlKGwxdCk7Ci0g
ICAgbWZuID0gbDFlX2dldF9wZm4obDFlKTsKLSAgICBwZm4gPSBtZm5fdmFsaWQoX21mbihtZm4p
KSAmJiBtYWNoaW5lX3RvX3BoeXNfbWFwcGluZ192YWxpZCA/Ci0gICAgICAgICAgZ2V0X2dwZm5f
ZnJvbV9tZm4obWZuKSA6IElOVkFMSURfTTJQX0VOVFJZOworICAgIG1mbiA9IGwxZV9nZXRfbWZu
KGwxZSk7CisgICAgcGZuID0gbWZuX3ZhbGlkKG1mbikgJiYgbWFjaGluZV90b19waHlzX21hcHBp
bmdfdmFsaWQgPworICAgICAgICAgIGdldF9wZm5fZnJvbV9tZm4obWZuKSA6IElOVkFMSURfTTJQ
X0VOVFJZOwogICAgIHByaW50aygiIEwxWzB4JTAzbHhdID0gJSJQUklwdGUiICUwMTZseFxuIiwK
ICAgICAgICAgICAgbDFfdGFibGVfb2Zmc2V0KGFkZHIpLCBsMWVfZ2V0X2ludHB0ZShsMWUpLCBw
Zm4pOwogfQpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9wYWdlX2FsbG9jLmMgYi94ZW4vY29tbW9u
L3BhZ2VfYWxsb2MuYwppbmRleCAwNGM5ZGMwYzY1Li40MDBmYTk4MzhjIDEwMDY0NAotLS0gYS94
ZW4vY29tbW9uL3BhZ2VfYWxsb2MuYworKysgYi94ZW4vY29tbW9uL3BhZ2VfYWxsb2MuYwpAQCAt
MTQxNiw3ICsxNDE2LDcgQEAgc3RhdGljIHZvaWQgZnJlZV9oZWFwX3BhZ2VzKAogCiAgICAgICAg
IC8qIFRoaXMgcGFnZSBpcyBub3QgYSBndWVzdCBmcmFtZSBhbnkgbW9yZS4gKi8KICAgICAgICAg
cGFnZV9zZXRfb3duZXIoJnBnW2ldLCBOVUxMKTsgLyogc2V0X2dwZm5fZnJvbV9tZm4gc25vb3Bz
IHBnIG93bmVyICovCi0gICAgICAgIHNldF9ncGZuX2Zyb21fbWZuKG1mbl94KG1mbikgKyBpLCBJ
TlZBTElEX00yUF9FTlRSWSk7CisgICAgICAgIHNldF9wZm5fZnJvbV9tZm4obWZuX2FkZChtZm4s
ICsgaSksIElOVkFMSURfTTJQX0VOVFJZKTsKIAogICAgICAgICBpZiAoIG5lZWRfc2NydWIgKQog
ICAgICAgICB7CmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS9hc20tYXJtL21tLmggYi94ZW4vaW5j
bHVkZS9hc20tYXJtL21tLmgKaW5kZXggYTljYjk4YTZjNy4uM2MwM2JlM2JjYSAxMDA2NDQKLS0t
IGEveGVuL2luY2x1ZGUvYXNtLWFybS9tbS5oCisrKyBiL3hlbi9pbmNsdWRlL2FzbS1hcm0vbW0u
aApAQCAtMzIyLDcgKzMyMiw3IEBAIHN0cnVjdCBwYWdlX2luZm8gKmdldF9wYWdlX2Zyb21fZ3Zh
KHN0cnVjdCB2Y3B1ICp2LCB2YWRkcl90IHZhLAogI2RlZmluZSBTSEFSRURfTTJQKF9lKSAgICAg
ICAgICAgKChfZSkgPT0gU0hBUkVEX00yUF9FTlRSWSkKIAogLyogV2UgZG9uJ3QgaGF2ZSBhIE0y
UCBvbiBBcm0gKi8KLSNkZWZpbmUgc2V0X2dwZm5fZnJvbV9tZm4obWZuLCBwZm4pIGRvIHsgKHZv
aWQpIChtZm4pLCAodm9pZCkocGZuKTsgfSB3aGlsZSAoMCkKK3N0YXRpYyBpbmxpbmUgdm9pZCBz
ZXRfcGZuX2Zyb21fbWZuKG1mbl90IG1mbiwgdW5zaWduZWQgbG9uZyBwZm4pIHt9CiAKIC8qIEFy
Y2gtc3BlY2lmaWMgcG9ydGlvbiBvZiBtZW1vcnlfb3AgaHlwZXJjYWxsLiAqLwogbG9uZyBhcmNo
X21lbW9yeV9vcChpbnQgb3AsIFhFTl9HVUVTVF9IQU5ETEVfUEFSQU0odm9pZCkgYXJnKTsKZGlm
ZiAtLWdpdCBhL3hlbi9pbmNsdWRlL2FzbS14ODYvZ3JhbnRfdGFibGUuaCBiL3hlbi9pbmNsdWRl
L2FzbS14ODYvZ3JhbnRfdGFibGUuaAppbmRleCA2NjEyMjhkZDM5Li5kNzMxYjllNDlmIDEwMDY0
NAotLS0gYS94ZW4vaW5jbHVkZS9hc20teDg2L2dyYW50X3RhYmxlLmgKKysrIGIveGVuL2luY2x1
ZGUvYXNtLXg4Ni9ncmFudF90YWJsZS5oCkBAIC00MSw3ICs0MSw3IEBAIHN0YXRpYyBpbmxpbmUg
aW50IHJlcGxhY2VfZ3JhbnRfaG9zdF9tYXBwaW5nKHVpbnQ2NF90IGFkZHIsIG1mbl90IGZyYW1l
LAogI2RlZmluZSBnbnR0YWJfZ2V0X2ZyYW1lX2dmbihndCwgc3QsIGlkeCkgKHsgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIFwKICAgICBtZm5fdCBtZm5fID0gKHN0KSA/IGdudHRhYl9zdGF0
dXNfbWZuKGd0LCBpZHgpICAgICAgICAgICAgICAgICAgICAgICBcCiAgICAgICAgICAgICAgICAg
ICAgICAgOiBnbnR0YWJfc2hhcmVkX21mbihndCwgaWR4KTsgICAgICAgICAgICAgICAgICAgICAg
XAotICAgIHVuc2lnbmVkIGxvbmcgZ3Bmbl8gPSBnZXRfZ3Bmbl9mcm9tX21mbihtZm5feChtZm5f
KSk7ICAgICAgICAgICAgICAgIFwKKyAgICB1bnNpZ25lZCBsb25nIGdwZm5fID0gZ2V0X3Bmbl9m
cm9tX21mbihtZm5fKTsgICAgICAgICAgICAgICAgICAgICAgICBcCiAgICAgVkFMSURfTTJQKGdw
Zm5fKSA/IF9nZm4oZ3Bmbl8pIDogSU5WQUxJRF9HRk47ICAgICAgICAgICAgICAgICAgICAgICAg
XAogfSkKIApkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUvYXNtLXg4Ni9tbS5oIGIveGVuL2luY2x1
ZGUvYXNtLXg4Ni9tbS5oCmluZGV4IGRjYWU1NTg3NjQuLjRmN2VhZDVlY2MgMTAwNjQ0Ci0tLSBh
L3hlbi9pbmNsdWRlL2FzbS14ODYvbW0uaAorKysgYi94ZW4vaW5jbHVkZS9hc20teDg2L21tLmgK
QEAgLTQ5MiwyMiArNDkyLDI2IEBAIGV4dGVybiBzdHJ1Y3QgZG9tYWluICpkb21feGVuLCAqZG9t
X2lvLCAqZG9tX2NvdzsJLyogZm9yIHZtY29yZWluZm8gKi8KICAqLwogZXh0ZXJuIGJvb2wgbWFj
aGluZV90b19waHlzX21hcHBpbmdfdmFsaWQ7CiAKLXN0YXRpYyBpbmxpbmUgdm9pZCBzZXRfZ3Bm
bl9mcm9tX21mbih1bnNpZ25lZCBsb25nIG1mbiwgdW5zaWduZWQgbG9uZyBwZm4pCitzdGF0aWMg
aW5saW5lIHZvaWQgc2V0X3Bmbl9mcm9tX21mbihtZm5fdCBtZm4sIHVuc2lnbmVkIGxvbmcgcGZu
KQogewotICAgIHN0cnVjdCBkb21haW4gKmQgPSBwYWdlX2dldF9vd25lcihtZm5fdG9fcGFnZShf
bWZuKG1mbikpKTsKKyAgICBjb25zdCB1bnNpZ25lZCBsb25nIG1mbl8gPSBtZm5feChtZm4pOwor
ICAgIHN0cnVjdCBkb21haW4gKmQgPSBwYWdlX2dldF9vd25lcihtZm5fdG9fcGFnZShtZm4pKTsK
ICAgICB1bnNpZ25lZCBsb25nIGVudHJ5ID0gKGQgJiYgKGQgPT0gZG9tX2NvdykpID8gU0hBUkVE
X00yUF9FTlRSWSA6IHBmbjsKIAogICAgIGlmICggIW1hY2hpbmVfdG9fcGh5c19tYXBwaW5nX3Zh
bGlkICkKICAgICAgICAgcmV0dXJuOwogCi0gICAgaWYgKCBtZm4gPCAoUkRXUl9DT01QQVRfTVBU
X1ZJUlRfRU5EIC0gUkRXUl9DT01QQVRfTVBUX1ZJUlRfU1RBUlQpIC8gNCApCi0gICAgICAgIGNv
bXBhdF9tYWNoaW5lX3RvX3BoeXNfbWFwcGluZ1ttZm5dID0gZW50cnk7Ci0gICAgbWFjaGluZV90
b19waHlzX21hcHBpbmdbbWZuXSA9IGVudHJ5OworICAgIGlmICggbWZuXyA8IChSRFdSX0NPTVBB
VF9NUFRfVklSVF9FTkQgLSBSRFdSX0NPTVBBVF9NUFRfVklSVF9TVEFSVCkgLyA0ICkKKyAgICAg
ICAgY29tcGF0X21hY2hpbmVfdG9fcGh5c19tYXBwaW5nW21mbl9dID0gZW50cnk7CisgICAgbWFj
aGluZV90b19waHlzX21hcHBpbmdbbWZuX10gPSBlbnRyeTsKIH0KIAogZXh0ZXJuIHN0cnVjdCBy
YW5nZXNldCAqbW1pb19yb19yYW5nZXM7CiAKLSNkZWZpbmUgZ2V0X2dwZm5fZnJvbV9tZm4obWZu
KSAgICAgIChtYWNoaW5lX3RvX3BoeXNfbWFwcGluZ1sobWZuKV0pCitzdGF0aWMgaW5saW5lIHVu
c2lnbmVkIGxvbmcgZ2V0X3Bmbl9mcm9tX21mbihtZm5fdCBtZm4pCit7CisgICAgcmV0dXJuIG1h
Y2hpbmVfdG9fcGh5c19tYXBwaW5nW21mbl94KG1mbildOworfQogCiAjZGVmaW5lIGNvbXBhdF9w
Zm5fdG9fY3IzKHBmbikgKCgodW5zaWduZWQpKHBmbikgPDwgMTIpIHwgKCh1bnNpZ25lZCkocGZu
KSA+PiAyMCkpCiAjZGVmaW5lIGNvbXBhdF9jcjNfdG9fcGZuKGNyMykgKCgodW5zaWduZWQpKGNy
MykgPj4gMTIpIHwgKCh1bnNpZ25lZCkoY3IzKSA8PCAyMCkpCmRpZmYgLS1naXQgYS94ZW4vaW5j
bHVkZS9hc20teDg2L3AybS5oIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9wMm0uaAppbmRleCAxYTA3
NTU0N2UyLi40YzZlNTgyYTY3IDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS9hc20teDg2L3AybS5o
CisrKyBiL3hlbi9pbmNsdWRlL2FzbS14ODYvcDJtLmgKQEAgLTUwOSw3ICs1MDksNyBAQCBzdGF0
aWMgaW5saW5lIHN0cnVjdCBwYWdlX2luZm8gKmdldF9wYWdlX2Zyb21fZ2ZuKAogc3RhdGljIGlu
bGluZSBnZm5fdCBtZm5fdG9fZ2ZuKGNvbnN0IHN0cnVjdCBkb21haW4gKmQsIG1mbl90IG1mbikK
IHsKICAgICBpZiAoIHBhZ2luZ19tb2RlX3RyYW5zbGF0ZShkKSApCi0gICAgICAgIHJldHVybiBf
Z2ZuKGdldF9ncGZuX2Zyb21fbWZuKG1mbl94KG1mbikpKTsKKyAgICAgICAgcmV0dXJuIF9nZm4o
Z2V0X3Bmbl9mcm9tX21mbihtZm4pKTsKICAgICBlbHNlCiAgICAgICAgIHJldHVybiBfZ2ZuKG1m
bl94KG1mbikpOwogfQotLSAKMi4xMS4wCgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMu
eGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3Rp
bmZvL3hlbi1kZXZlbA==

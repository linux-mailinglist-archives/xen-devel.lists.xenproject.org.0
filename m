Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 7FD95103C9E
	for <lists+xen-devel@lfdr.de>; Wed, 20 Nov 2019 14:53:54 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iXQOY-0005Eq-Ku; Wed, 20 Nov 2019 13:51:46 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=Oy8C=ZM=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1iXQOX-0005El-Tv
 for xen-devel@lists.xenproject.org; Wed, 20 Nov 2019 13:51:45 +0000
X-Inumbo-ID: e2c984fe-0b9c-11ea-a313-12813bfff9fa
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id e2c984fe-0b9c-11ea-a313-12813bfff9fa;
 Wed, 20 Nov 2019 13:51:44 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id D6BBABF13;
 Wed, 20 Nov 2019 13:51:42 +0000 (UTC)
To: Paul Durrant <pdurrant@amazon.com>
References: <20191120120859.1846-1-pdurrant@amazon.com>
From: Jan Beulich <jbeulich@suse.com>
Message-ID: <daac5903-cc73-15e3-5d5a-2a1d9e147301@suse.com>
Date: Wed, 20 Nov 2019 14:51:42 +0100
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:60.0) Gecko/20100101
 Thunderbird/60.9.1
MIME-Version: 1.0
In-Reply-To: <20191120120859.1846-1-pdurrant@amazon.com>
Content-Language: en-US
Subject: Re: [Xen-devel] [PATCH] x86 / iommu: set up a scratch page in the
 quarantine domain
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: xen-devel@lists.xenproject.org, Kevin Tian <kevin.tian@intel.com>,
 =?UTF-8?Q?Roger_Pau_Monn=c3=a9?= <roger.pau@citrix.com>, Wei Liu <wl@xen.org>,
 Andrew Cooper <andrew.cooper3@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

T24gMjAuMTEuMjAxOSAxMzowOCwgUGF1bCBEdXJyYW50IHdyb3RlOgo+IFRoaXMgcGF0Y2ggaW50
cm9kdWNlcyBhIG5ldyBpb21tdV9vcCB0byBmYWNpbGl0YXRlIGEgcGVyLWltcGxlbWVudGF0aW9u
Cj4gcXVhcmFudGluZSBzZXQgdXAsIGFuZCB0aGVuIGZ1cnRoZXIgY29kZSBmb3IgeDg2IGltcGxl
bWVudGF0aW9ucwo+IChhbWQgYW5kIHZ0ZCkgdG8gc2V0IHVwIGEgcmVhZC93cm90ZSBzY3JhdGNo
IHBhZ2UgdG8gc2VydmUgYXMgdGhlIHNvdXJjZS8KPiB0YXJnZXQgZm9yIGFsbCBETUEgd2hpbHN0
IGEgZGV2aWNlIGlzIGFzc2lnbmVkIHRvIGRvbV9pby4KCkEgc2luZ2xlIHBhZ2UgaW4gdGhlIHN5
c3RlbSB3b24ndCBkbywgSSdtIGFmcmFpZC4gSWYgb25lIGd1ZXN0J3MKKHByaW9yKSBkZXZpY2Ug
aXMgcmV0cnlpbmcgcmVhZHMgd2l0aCBkYXRhIGNvbnRhaW5pbmcgc2VjcmV0cyBvZiB0aGF0Cmd1
ZXN0LCBhbm90aGVyIGd1ZXN0J3MgKHByaW9yKSBkZXZpY2UgY291bGQgZW5kIHVwIHdyaXRpbmcg
dGhpcyBkYXRhCnRvIGUuZy4gc3RvcmFnZSB3aGVyZSBhZnRlciBhIGd1ZXN0IHJlc3RhcnQgaXQg
aXMgdGhlbiBhdmFpbGFibGUgdG8KdGhlIHdyb25nIGd1ZXN0LgoKQWxzbyBuaXQ6IHMvd3JvdGUv
d3JpdGUvIC4KCj4gVGhlIHJlYXNvbiBmb3IgZG9pbmcgdGhpcyBpcyB0aGF0IHNvbWUgaGFyZHdh
cmUgbWF5IGNvbnRpbnVlIHRvIHJlLXRyeQo+IERNQSwgZGVzcGl0ZSBGTFIsIGluIHRoZSBldmVu
dCBvZiBhbiBlcnJvci4gSGF2aW5nIGEgc2NyYXRjaCBwYWdlIG1hcHBlZAo+IHdpbGwgYWxsb3cg
cGVuZGluZyBETUEgdG8gZHJhaW4gYW5kIHRodXMgcXVpZXNjZSBzdWNoIGJ1Z2d5IGhhcmR3YXJl
LgoKV2l0aG91dCBhICJzaW5rIiBwYWdlIG1hcHBlZCwgdGhpcyB3b3VsZCByZXN1bHQgaW4gSU9N
TVUgZmF1bHRzIGFpdWkuCldoYXQncyB0aGUgcHJvYmxlbSB3aXRoIGhhdmluZyB0aGVzZSBmYXVs
dHMgc3VyZmFjZSBhbmQgZ2V0IGhhbmRsZWQsCmV2ZW50dWFsbHkgbGVhZGluZyB0byB0aGUgZGV2
aWNlIGdldHRpbmcgYnVzLW1hc3RlcmluZyBkaXNhYmxlZD8gSXMKaXQgdGhhdCBkZXZpY2VzIGNv
bnRpbnVlIERNQWluZyBldmVuIHdoZW4gYnVzLW1hc3RlcmluZyBpcyBvZmY/IElmCnNvLCBpcyBp
dCBldmVuIHNhZmUgdG8gcGFzcyB0aHJvdWdoIGFueSBzdWNoIGRldmljZT8gSW4gYW55IGV2ZW50
CnRoZSBkZXNjcmlwdGlvbiBuZWVkcyB0byBiZSBleHRlbmRlZCBoZXJlLgoKPiBTaWduZWQtb2Zm
LWJ5OiBQYXVsIER1cnJhbnQgPHBkdXJyYW50QGFtYXpvbi5jb20+CgpXaGF0IGFib3V0IEFybT8g
Q2FuIGRldmljZXMgd2hpY2ggQXJtIGFsbG93cyB0byBhc3NpZ24gdG8gZ3Vlc3RzCmFsc28gImJh
YmJsZSIgbGlrZSB0aGlzIGFmdGVyIGRlLWFzc2lnbm1lbnQ/IElmIG5vdCwgdGhpcyBzaG91bGQg
YmUKc2FpZCBpbiB0aGUgZGVzY3JpcHRpb24uIElmIHNvLCBvYnZpb3VzbHkgdGhhdCBzaWRlIHdv
dWxkIGFsc28gd2FudApmaXhpbmcuCgo+IC0tLSBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2Ft
ZC9pb21tdV9tYXAuYwo+ICsrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9pb21tdV9t
YXAuYwo+IEBAIC01NjAsNiArNTYwLDYzIEBAIGludCBhbWRfaW9tbXVfcmVzZXJ2ZV9kb21haW5f
dW5pdHlfbWFwKHN0cnVjdCBkb21haW4gKmRvbWFpbiwKPiAgICAgIHJldHVybiBydDsKPiAgfQo+
ICAKPiAraW50IGFtZF9pb21tdV9xdWFyYW50aW5lX2luaXQoc3RydWN0IGRvbWFpbiAqZCkKCl9f
aW5pdAoKPiArewo+ICsgICAgc3RydWN0IGRvbWFpbl9pb21tdSAqaGQgPSBkb21faW9tbXUoZCk7
Cj4gKyAgICB1bnNpZ25lZCBpbnQgbGV2ZWw7Cj4gKyAgICBzdHJ1Y3QgYW1kX2lvbW11X3B0ZSAq
dGFibGU7Cj4gKwo+ICsgICAgaWYgKCBoZC0+YXJjaC5yb290X3RhYmxlICkKPiArICAgIHsKPiAr
ICAgICAgICBBU1NFUlRfVU5SRUFDSEFCTEUoKTsKPiArICAgICAgICByZXR1cm4gMDsKPiArICAg
IH0KPiArCj4gKyAgICBzcGluX2xvY2soJmhkLT5hcmNoLm1hcHBpbmdfbG9jayk7Cj4gKwo+ICsg
ICAgbGV2ZWwgPSBoZC0+YXJjaC5wYWdpbmdfbW9kZTsKCldpdGggRG9tSU8gYmVpbmcgUFYgaW4g
cHJpbmNpcGxlLCB0aGlzIGlzIGdvaW5nIHRvIGJlIHRoZQpmaXhlZCB2YWx1ZSBQViBkb21haW5z
IGdldCBzZXQsIG1lcmVseSBkZXBlbmRpbmcgb24gUkFNIHNpemUgYXQKYm9vdCB0aW1lIChpLmUu
IG5vdCBhY2NvdW50aW5nIGZvciBtZW1vcnkgaG90cGx1ZykuIFRoaXMgY291bGQKYmUgZWFzaWx5
IHRvbyBsaXR0bGUgZm9yIEhWTSBndWVzdHMsIHdoaWNoIGFyZSBmcmVlIHRvIGV4dGVuZAp0aGVp
ciBHRk4gKGFuZCBoZW5jZSBERk4pIHNwYWNlLiBUaGVyZWZvcmUgSSB0aGluayB5b3UgbmVlZCB0
bwpzZXQgdGhlIG1heGltdW0gcG9zc2libGUgbGV2ZWwgaGVyZS4KCj4gKyAgICBoZC0+YXJjaC5y
b290X3RhYmxlID0gYWxsb2NfYW1kX2lvbW11X3BndGFibGUoKTsKPiArICAgIGlmICggIWhkLT5h
cmNoLnJvb3RfdGFibGUgKQo+ICsgICAgICAgIGdvdG8gb3V0Owo+ICsKPiArICAgIHRhYmxlID0g
X19tYXBfZG9tYWluX3BhZ2UoaGQtPmFyY2gucm9vdF90YWJsZSk7Cj4gKyAgICB3aGlsZSAoIGxl
dmVsICkKPiArICAgIHsKPiArICAgICAgICBzdHJ1Y3QgcGFnZV9pbmZvICpwZzsKPiArICAgICAg
ICB1bnNpZ25lZCBpbnQgaTsKPiArCj4gKyAgICAgICAgLyoKPiArICAgICAgICAgKiBUaGUgcGd0
YWJsZSBhbGxvY2F0b3IgaXMgZmluZSBmb3IgdGhlIGxlYWYgcGFnZSwgYXMgd2VsbCBhcwo+ICsg
ICAgICAgICAqIHBhZ2UgdGFibGUgcGFnZXMuCj4gKyAgICAgICAgICovCj4gKyAgICAgICAgcGcg
PSBhbGxvY19hbWRfaW9tbXVfcGd0YWJsZSgpOwo+ICsgICAgICAgIGlmICggIXBnICkKPiArICAg
ICAgICAgICAgYnJlYWs7Cj4gKwo+ICsgICAgICAgIGZvciAoIGkgPSAwOyBpIDwgUFRFX1BFUl9U
QUJMRV9TSVpFOyBpKysgKQo+ICsgICAgICAgIHsKPiArICAgICAgICAgICAgc3RydWN0IGFtZF9p
b21tdV9wdGUgKnBkZSA9ICZ0YWJsZVtpXTsKPiArCj4gKyAgICAgICAgICAgIHNldF9pb21tdV9w
ZGVfcHJlc2VudChwZGUsIG1mbl94KHBhZ2VfdG9fbWZuKHBnKSksIGxldmVsIC0gMSwKPiArICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRydWUsIHRydWUpOwoKVGhpcyB3b3VsZCBh
bHNvIGJlbmVmaXQgZnJvbSBhIGNvbW1lbnQgaW5kaWNhdGluZyB0aGF0IGl0J3MgZmluZQpmb3Ig
dGhlIGxlYWYgbGV2ZWwgYXMgd2VsbCwgZGVzcGl0ZSB0aGUgInBkZSIgaW4gdGhlIG5hbWUgKGFu
ZAppdHMgc2libGluZyBzZXRfaW9tbXVfcHRlX3ByZXNlbnQoKSBhY3R1YWxseSBleGlzdGluZyku
IE9mIGNvdXJzZQp5b3UgY291bGQgYXMgd2VsbCBleHRlbmQgdGhlIGNvbW1lbnQgYSBmZXcgbGlu
ZXMgdXAuCgpXaGF0IHlvdSBkbyBuZWVkIHRvIGRvIHRob3VnaCBpcyBwcmUtZmlsbCB0aGUgbGVh
ZiBwYWdlIC4uLgoKPiArICAgICAgICB9Cj4gKwo+ICsgICAgICAgIHVubWFwX2RvbWFpbl9wYWdl
KHRhYmxlKTsKPiArICAgICAgICB0YWJsZSA9IF9fbWFwX2RvbWFpbl9wYWdlKHBnKTsKPiArICAg
ICAgICBsZXZlbC0tOwo+ICsgICAgfQoKLi4uIGhlcmUsIHN1Y2ggdGhhdCBwb3NzaWJsZSBsZWZ0
IG92ZXIgc2VjcmV0cyBjYW4ndCBlbmQgdXAKZ2V0dGluZyB3cml0dGVuIHRvIGUuZy4gcGVyc2lz
dGVudCBzdG9yYWdlIG9yIG92ZXIgYSBuZXR3b3JrLgoKPiBAQCAtMjY4Myw5ICsyNjcxLDY4IEBA
IHN0YXRpYyB2b2lkIHZ0ZF9kdW1wX3AybV90YWJsZShzdHJ1Y3QgZG9tYWluICpkKQo+ICAgICAg
dnRkX2R1bXBfcDJtX3RhYmxlX2xldmVsKGhkLT5hcmNoLnBnZF9tYWRkciwgYWdhd190b19sZXZl
bChoZC0+YXJjaC5hZ2F3KSwgMCwgMCk7Cj4gIH0KPiAgCj4gK3N0YXRpYyBpbnQgaW50ZWxfaW9t
bXVfcXVhcmFudGluZV9pbml0KHN0cnVjdCBkb21haW4gKmQpCgpfX2luaXQgYWdhaW4uCgo+ICt7
Cj4gKyAgICBzdHJ1Y3QgZG9tYWluX2lvbW11ICpoZCA9IGRvbV9pb21tdShkKTsKPiArICAgIHN0
cnVjdCBkbWFfcHRlICpwYXJlbnQ7Cj4gKyAgICB1bnNpZ25lZCBpbnQgbGV2ZWwgPSBhZ2F3X3Rv
X2xldmVsKGhkLT5hcmNoLmFnYXcpOwoKT3RoZXIgdGhhbiBmb3IgQU1EIHRoaXMgaXMgbm90IGEg
cHJvYmxlbSBoZXJlLCBhcyBhbGwgZG9tYWlucwooY3VycmVudGx5KSBnZXQgdGhlIHNhbWUgQUdB
Vy4gSSB3b25kZXIgdGhvdWdoIHdoZXRoZXIgcHJlY2F1dGlvbnMKd291bGQgYmUgcG9zc2libGUg
aGVyZSBhZ2FpbnN0IHRoZSAibm9ybWFsIiBkb21haW4gc2V0dGluZyBnZXR0aW5nCmFkanVzdGVk
IHdpdGhvdXQgcmVjYWxsaW5nIHRoZSBuZWVkIHRvIGNvbWUgYmFjayBoZXJlLgoKPiArICAgIGlu
dCByYzsKPiArCj4gKyAgICBpZiAoIGhkLT5hcmNoLnBnZF9tYWRkciApCj4gKyAgICB7Cj4gKyAg
ICAgICAgQVNTRVJUX1VOUkVBQ0hBQkxFKCk7Cj4gKyAgICAgICAgcmV0dXJuIDA7Cj4gKyAgICB9
Cj4gKwo+ICsgICAgc3Bpbl9sb2NrKCZoZC0+YXJjaC5tYXBwaW5nX2xvY2spOwo+ICsKPiArICAg
IGhkLT5hcmNoLnBnZF9tYWRkciA9IGFsbG9jX3BndGFibGVfbWFkZHIoMSwgaGQtPm5vZGUpOwo+
ICsgICAgaWYgKCAhaGQtPmFyY2gucGdkX21hZGRyICkKPiArICAgICAgICBnb3RvIG91dDsKPiAr
Cj4gKyAgICBwYXJlbnQgPSAoc3RydWN0IGRtYV9wdGUgKiltYXBfdnRkX2RvbWFpbl9wYWdlKGhk
LT5hcmNoLnBnZF9tYWRkcik7CgpVbm5lY2Vzc2FyeSBjYXN0OyBmdW5uaWx5IGVub3VnaCB5b3Ug
ZG9uJ3QgaGF2ZSBvbmUgZnVydGhlciBkb3duLgoKPiArICAgIHdoaWxlICggbGV2ZWwgKQo+ICsg
ICAgewo+ICsgICAgICAgIHVpbnQ2NF90IG1hZGRyOwo+ICsgICAgICAgIHVuc2lnbmVkIGludCBv
ZmZzZXQ7Cj4gKwo+ICsgICAgICAgIC8qCj4gKyAgICAgICAgICogVGhlIHBndGFibGUgYWxsb2Nh
dG9yIGlzIGZpbmUgZm9yIHRoZSBsZWFmIHBhZ2UsIGFzIHdlbGwgYXMKPiArICAgICAgICAgKiBw
YWdlIHRhYmxlIHBhZ2VzLgo+ICsgICAgICAgICAqLwo+ICsgICAgICAgIG1hZGRyID0gYWxsb2Nf
cGd0YWJsZV9tYWRkcigxLCBoZC0+bm9kZSk7Cj4gKyAgICAgICAgaWYgKCAhbWFkZHIgKQo+ICsg
ICAgICAgICAgICBicmVhazsKPiArCj4gKyAgICAgICAgZm9yICggb2Zmc2V0ID0gMDsgb2Zmc2V0
IDwgUFRFX05VTTsgb2Zmc2V0KysgKQo+ICsgICAgICAgIHsKPiArICAgICAgICAgICAgc3RydWN0
IGRtYV9wdGUgKnB0ZSA9ICZwYXJlbnRbb2Zmc2V0XTsKPiArCj4gKyAgICAgICAgICAgIGRtYV9z
ZXRfcHRlX2FkZHIoKnB0ZSwgbWFkZHIpOwo+ICsgICAgICAgICAgICBkbWFfc2V0X3B0ZV9yZWFk
YWJsZSgqcHRlKTsKPiArICAgICAgICAgICAgZG1hX3NldF9wdGVfd3JpdGFibGUoKnB0ZSk7Cj4g
KyAgICAgICAgfQo+ICsgICAgICAgIGlvbW11X2ZsdXNoX2NhY2hlX3BhZ2UocGFyZW50LCAxKTsK
PiArCj4gKyAgICAgICAgdW5tYXBfdnRkX2RvbWFpbl9wYWdlKHBhcmVudCk7Cj4gKyAgICAgICAg
cGFyZW50ID0gbWFwX3Z0ZF9kb21haW5fcGFnZShtYWRkcik7Cj4gKyAgICAgICAgbGV2ZWwtLTsK
PiArICAgIH0KClRoZSBsZWFmIHBhZ2Ugd2FudHMgc2NydWJiaW5nIGhlcmUgYXMgd2VsbC4KCkph
bgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRl
dmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9s
aXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id C4526144D9
	for <lists+xen-devel@lfdr.de>; Mon,  6 May 2019 09:00:45 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hNXYd-0001xi-3D; Mon, 06 May 2019 06:57:03 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=XZcu=TG=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1hNXYb-0001wp-NH
 for xen-devel@lists.xenproject.org; Mon, 06 May 2019 06:57:01 +0000
X-Inumbo-ID: 1f18b870-6fcc-11e9-9193-ab607bdbffc7
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 1f18b870-6fcc-11e9-9193-ab607bdbffc7;
 Mon, 06 May 2019 06:56:50 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 6111BAD03;
 Mon,  6 May 2019 06:56:49 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Mon,  6 May 2019 08:56:03 +0200
Message-Id: <20190506065644.7415-5-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190506065644.7415-1-jgross@suse.com>
References: <20190506065644.7415-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH RFC V2 04/45] xen/sched: move per-vcpu scheduler
 private data pointer to sched_item
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Tim Deegan <tim@xen.org>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wei.liu2@citrix.com>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>,
 Robert VanVossen <robert.vanvossen@dornerworks.com>,
 Dario Faggioli <dfaggioli@suse.com>, Julien Grall <julien.grall@arm.com>,
 Josh Whitehead <josh.whitehead@dornerworks.com>,
 Meng Xu <mengxu@cis.upenn.edu>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhpcyBwcmVwYXJlcyBtYWtpbmcgdGhlIGRpZmZlcmVudCBzY2hlZHVsZXJzIHZjcHUgYWdub3N0
aWMuCgpTaWduZWQtb2ZmLWJ5OiBKdWVyZ2VuIEdyb3NzIDxqZ3Jvc3NAc3VzZS5jb20+Ci0tLQog
eGVuL2NvbW1vbi9zY2hlZF9hcmluYzY1My5jIHwgIDQgKystLQogeGVuL2NvbW1vbi9zY2hlZF9j
cmVkaXQuYyAgIHwgIDYgKysrLS0tCiB4ZW4vY29tbW9uL3NjaGVkX2NyZWRpdDIuYyAgfCAxMCAr
KysrKy0tLS0tCiB4ZW4vY29tbW9uL3NjaGVkX251bGwuYyAgICAgfCAgNCArKy0tCiB4ZW4vY29t
bW9uL3NjaGVkX3J0LmMgICAgICAgfCAgNCArKy0tCiB4ZW4vY29tbW9uL3NjaGVkdWxlLmMgICAg
ICAgfCAyNCArKysrKysrKysrKystLS0tLS0tLS0tLS0KIHhlbi9pbmNsdWRlL3hlbi9zY2hlZC5o
ICAgICB8ICAyICstCiA3IGZpbGVzIGNoYW5nZWQsIDI3IGluc2VydGlvbnMoKyksIDI3IGRlbGV0
aW9ucygtKQoKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vc2NoZWRfYXJpbmM2NTMuYyBiL3hlbi9j
b21tb24vc2NoZWRfYXJpbmM2NTMuYwppbmRleCBmZmZlMjMxMTNlLi5mNWFmOGI5NzJkIDEwMDY0
NAotLS0gYS94ZW4vY29tbW9uL3NjaGVkX2FyaW5jNjUzLmMKKysrIGIveGVuL2NvbW1vbi9zY2hl
ZF9hcmluYzY1My5jCkBAIC01Myw3ICs1Myw3IEBACiAgKiBSZXR1cm4gYSBwb2ludGVyIHRvIHRo
ZSBBUklOQyA2NTMtc3BlY2lmaWMgc2NoZWR1bGVyIGRhdGEgaW5mb3JtYXRpb24KICAqIGFzc29j
aWF0ZWQgd2l0aCB0aGUgZ2l2ZW4gVkNQVSAodmMpCiAgKi8KLSNkZWZpbmUgQVZDUFUodmMpICgo
YXJpbmM2NTNfdmNwdV90ICopKHZjKS0+c2NoZWRfcHJpdikKKyNkZWZpbmUgQVZDUFUodmMpICgo
YXJpbmM2NTNfdmNwdV90ICopKHZjKS0+c2NoZWRfaXRlbS0+cHJpdikKIAogLyoqCiAgKiBSZXR1
cm4gdGhlIGdsb2JhbCBzY2hlZHVsZXIgcHJpdmF0ZSBkYXRhIGdpdmVuIHRoZSBzY2hlZHVsZXIg
b3BzIHBvaW50ZXIKQEAgLTY0Nyw3ICs2NDcsNyBAQCBhNjUzX3N3aXRjaF9zY2hlZChzdHJ1Y3Qg
c2NoZWR1bGVyICpuZXdfb3BzLCB1bnNpZ25lZCBpbnQgY3B1LAogCiAgICAgQVNTRVJUKCFwZGF0
YSAmJiBzdmMgJiYgaXNfaWRsZV92Y3B1KHN2Yy0+dmMpKTsKIAotICAgIGlkbGVfdmNwdVtjcHVd
LT5zY2hlZF9wcml2ID0gdmRhdGE7CisgICAgaWRsZV92Y3B1W2NwdV0tPnNjaGVkX2l0ZW0tPnBy
aXYgPSB2ZGF0YTsKIAogICAgIHBlcl9jcHUoc2NoZWR1bGVyLCBjcHUpID0gbmV3X29wczsKICAg
ICBwZXJfY3B1KHNjaGVkdWxlX2RhdGEsIGNwdSkuc2NoZWRfcHJpdiA9IE5VTEw7IC8qIG5vIHBk
YXRhICovCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3NjaGVkX2NyZWRpdC5jIGIveGVuL2NvbW1v
bi9zY2hlZF9jcmVkaXQuYwppbmRleCAzNzM1NDg2YjRjLi5jYjhlMTY3ZmM5IDEwMDY0NAotLS0g
YS94ZW4vY29tbW9uL3NjaGVkX2NyZWRpdC5jCisrKyBiL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0
LmMKQEAgLTgzLDcgKzgzLDcgQEAKICAgICAoKHN0cnVjdCBjc2NoZWRfcHJpdmF0ZSAqKSgoX29w
cyktPnNjaGVkX2RhdGEpKQogI2RlZmluZSBDU0NIRURfUENQVShfYykgICAgIFwKICAgICAoKHN0
cnVjdCBjc2NoZWRfcGNwdSAqKXBlcl9jcHUoc2NoZWR1bGVfZGF0YSwgX2MpLnNjaGVkX3ByaXYp
Ci0jZGVmaW5lIENTQ0hFRF9WQ1BVKF92Y3B1KSAgKChzdHJ1Y3QgY3NjaGVkX3ZjcHUgKikgKF92
Y3B1KS0+c2NoZWRfcHJpdikKKyNkZWZpbmUgQ1NDSEVEX1ZDUFUoX3ZjcHUpICAoKHN0cnVjdCBj
c2NoZWRfdmNwdSAqKSAoX3ZjcHUpLT5zY2hlZF9pdGVtLT5wcml2KQogI2RlZmluZSBDU0NIRURf
RE9NKF9kb20pICAgICgoc3RydWN0IGNzY2hlZF9kb20gKikgKF9kb20pLT5zY2hlZF9wcml2KQog
I2RlZmluZSBSVU5RKF9jcHUpICAgICAgICAgICgmKENTQ0hFRF9QQ1BVKF9jcHUpLT5ydW5xKSkK
IApAQCAtNjQxLDcgKzY0MSw3IEBAIGNzY2hlZF9zd2l0Y2hfc2NoZWQoc3RydWN0IHNjaGVkdWxl
ciAqbmV3X29wcywgdW5zaWduZWQgaW50IGNwdSwKIAogICAgIEFTU0VSVChzdmMgJiYgaXNfaWRs
ZV92Y3B1KHN2Yy0+dmNwdSkpOwogCi0gICAgaWRsZV92Y3B1W2NwdV0tPnNjaGVkX3ByaXYgPSB2
ZGF0YTsKKyAgICBpZGxlX3ZjcHVbY3B1XS0+c2NoZWRfaXRlbS0+cHJpdiA9IHZkYXRhOwogCiAg
ICAgLyoKICAgICAgKiBXZSBhcmUgaG9sZGluZyB0aGUgcnVucXVldWUgbG9jayBhbHJlYWR5IChp
dCdzIGJlZW4gdGFrZW4gaW4KQEAgLTEwMzEsNyArMTAzMSw3IEBAIHN0YXRpYyB2b2lkCiBjc2No
ZWRfaXRlbV9pbnNlcnQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRf
aXRlbSAqaXRlbSkKIHsKICAgICBzdHJ1Y3QgdmNwdSAqdmMgPSBpdGVtLT52Y3B1OwotICAgIHN0
cnVjdCBjc2NoZWRfdmNwdSAqc3ZjID0gdmMtPnNjaGVkX3ByaXY7CisgICAgc3RydWN0IGNzY2hl
ZF92Y3B1ICpzdmMgPSBpdGVtLT5wcml2OwogICAgIHNwaW5sb2NrX3QgKmxvY2s7CiAKICAgICBC
VUdfT04oIGlzX2lkbGVfdmNwdSh2YykgKTsKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vc2NoZWRf
Y3JlZGl0Mi5jIGIveGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQyLmMKaW5kZXggZjQ0Mjg2YzJhNS4u
OWMwNTJjMjRhNyAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQyLmMKKysrIGIv
eGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQyLmMKQEAgLTU3Miw3ICs1NzIsNyBAQCBzdGF0aWMgaW5s
aW5lIHN0cnVjdCBjc2NoZWQyX3BjcHUgKmNzY2hlZDJfcGNwdSh1bnNpZ25lZCBpbnQgY3B1KQog
CiBzdGF0aWMgaW5saW5lIHN0cnVjdCBjc2NoZWQyX3ZjcHUgKmNzY2hlZDJfdmNwdShjb25zdCBz
dHJ1Y3QgdmNwdSAqdikKIHsKLSAgICByZXR1cm4gdi0+c2NoZWRfcHJpdjsKKyAgICByZXR1cm4g
di0+c2NoZWRfaXRlbS0+cHJpdjsKIH0KIAogc3RhdGljIGlubGluZSBzdHJ1Y3QgY3NjaGVkMl9k
b20gKmNzY2hlZDJfZG9tKGNvbnN0IHN0cnVjdCBkb21haW4gKmQpCkBAIC05NzAsNyArOTcwLDcg
QEAgX3J1bnFfYXNzaWduKHN0cnVjdCBjc2NoZWQyX3ZjcHUgKnN2Yywgc3RydWN0IGNzY2hlZDJf
cnVucXVldWVfZGF0YSAqcnFkKQogc3RhdGljIHZvaWQKIHJ1bnFfYXNzaWduKGNvbnN0IHN0cnVj
dCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHZjcHUgKnZjKQogewotICAgIHN0cnVjdCBjc2NoZWQy
X3ZjcHUgKnN2YyA9IHZjLT5zY2hlZF9wcml2OworICAgIHN0cnVjdCBjc2NoZWQyX3ZjcHUgKnN2
YyA9IHZjLT5zY2hlZF9pdGVtLT5wcml2OwogCiAgICAgQVNTRVJUKHN2Yy0+cnFkID09IE5VTEwp
OwogCkBAIC05OTcsNyArOTk3LDcgQEAgX3J1bnFfZGVhc3NpZ24oc3RydWN0IGNzY2hlZDJfdmNw
dSAqc3ZjKQogc3RhdGljIHZvaWQKIHJ1bnFfZGVhc3NpZ24oY29uc3Qgc3RydWN0IHNjaGVkdWxl
ciAqb3BzLCBzdHJ1Y3QgdmNwdSAqdmMpCiB7Ci0gICAgc3RydWN0IGNzY2hlZDJfdmNwdSAqc3Zj
ID0gdmMtPnNjaGVkX3ByaXY7CisgICAgc3RydWN0IGNzY2hlZDJfdmNwdSAqc3ZjID0gdmMtPnNj
aGVkX2l0ZW0tPnByaXY7CiAKICAgICBBU1NFUlQoc3ZjLT5ycWQgPT0gYzJycWQob3BzLCB2Yy0+
cHJvY2Vzc29yKSk7CiAKQEAgLTMxMDgsNyArMzEwOCw3IEBAIHN0YXRpYyB2b2lkCiBjc2NoZWQy
X2l0ZW1faW5zZXJ0KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX2l0
ZW0gKml0ZW0pCiB7CiAgICAgc3RydWN0IHZjcHUgKnZjID0gaXRlbS0+dmNwdTsKLSAgICBzdHJ1
Y3QgY3NjaGVkMl92Y3B1ICpzdmMgPSB2Yy0+c2NoZWRfcHJpdjsKKyAgICBzdHJ1Y3QgY3NjaGVk
Ml92Y3B1ICpzdmMgPSBpdGVtLT5wcml2OwogICAgIHN0cnVjdCBjc2NoZWQyX2RvbSAqIGNvbnN0
IHNkb20gPSBzdmMtPnNkb207CiAgICAgc3BpbmxvY2tfdCAqbG9jazsKIApAQCAtMzg4OCw3ICsz
ODg4LDcgQEAgY3NjaGVkMl9zd2l0Y2hfc2NoZWQoc3RydWN0IHNjaGVkdWxlciAqbmV3X29wcywg
dW5zaWduZWQgaW50IGNwdSwKICAgICBBU1NFUlQoIWxvY2FsX2lycV9pc19lbmFibGVkKCkpOwog
ICAgIHdyaXRlX2xvY2soJnBydi0+bG9jayk7CiAKLSAgICBpZGxlX3ZjcHVbY3B1XS0+c2NoZWRf
cHJpdiA9IHZkYXRhOworICAgIGlkbGVfdmNwdVtjcHVdLT5zY2hlZF9pdGVtLT5wcml2ID0gdmRh
dGE7CiAKICAgICBycWkgPSBpbml0X3BkYXRhKHBydiwgcGRhdGEsIGNwdSk7CiAKZGlmZiAtLWdp
dCBhL3hlbi9jb21tb24vc2NoZWRfbnVsbC5jIGIveGVuL2NvbW1vbi9zY2hlZF9udWxsLmMKaW5k
ZXggN2I1MDhmMzVhNC4uZWI1MWRkYmNjYiAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9zY2hlZF9u
dWxsLmMKKysrIGIveGVuL2NvbW1vbi9zY2hlZF9udWxsLmMKQEAgLTExNyw3ICsxMTcsNyBAQCBz
dGF0aWMgaW5saW5lIHN0cnVjdCBudWxsX3ByaXZhdGUgKm51bGxfcHJpdihjb25zdCBzdHJ1Y3Qg
c2NoZWR1bGVyICpvcHMpCiAKIHN0YXRpYyBpbmxpbmUgc3RydWN0IG51bGxfdmNwdSAqbnVsbF92
Y3B1KGNvbnN0IHN0cnVjdCB2Y3B1ICp2KQogewotICAgIHJldHVybiB2LT5zY2hlZF9wcml2Owor
ICAgIHJldHVybiB2LT5zY2hlZF9pdGVtLT5wcml2OwogfQogCiBzdGF0aWMgaW5saW5lIGJvb2wg
dmNwdV9jaGVja19hZmZpbml0eShzdHJ1Y3QgdmNwdSAqdiwgdW5zaWduZWQgaW50IGNwdSwKQEAg
LTM5MSw3ICszOTEsNyBAQCBzdGF0aWMgdm9pZCBudWxsX3N3aXRjaF9zY2hlZChzdHJ1Y3Qgc2No
ZWR1bGVyICpuZXdfb3BzLCB1bnNpZ25lZCBpbnQgY3B1LAogCiAgICAgQVNTRVJUKG52YyAmJiBp
c19pZGxlX3ZjcHUobnZjLT52Y3B1KSk7CiAKLSAgICBpZGxlX3ZjcHVbY3B1XS0+c2NoZWRfcHJp
diA9IHZkYXRhOworICAgIGlkbGVfdmNwdVtjcHVdLT5zY2hlZF9pdGVtLT5wcml2ID0gdmRhdGE7
CiAKICAgICAvKgogICAgICAqIFdlIGFyZSBob2xkaW5nIHRoZSBydW5xdWV1ZSBsb2NrIGFscmVh
ZHkgKGl0J3MgYmVlbiB0YWtlbiBpbgpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZF9ydC5j
IGIveGVuL2NvbW1vbi9zY2hlZF9ydC5jCmluZGV4IGFiOGZhMDIzMDYuLmM4MzBhYWM5MmYgMTAw
NjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWRfcnQuYworKysgYi94ZW4vY29tbW9uL3NjaGVkX3J0
LmMKQEAgLTIzNSw3ICsyMzUsNyBAQCBzdGF0aWMgaW5saW5lIHN0cnVjdCBydF9wcml2YXRlICpy
dF9wcml2KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcykKIAogc3RhdGljIGlubGluZSBzdHJ1
Y3QgcnRfdmNwdSAqcnRfdmNwdShjb25zdCBzdHJ1Y3QgdmNwdSAqdmNwdSkKIHsKLSAgICByZXR1
cm4gdmNwdS0+c2NoZWRfcHJpdjsKKyAgICByZXR1cm4gdmNwdS0+c2NoZWRfaXRlbS0+cHJpdjsK
IH0KIAogc3RhdGljIGlubGluZSBzdHJ1Y3QgbGlzdF9oZWFkICpydF9ydW5xKGNvbnN0IHN0cnVj
dCBzY2hlZHVsZXIgKm9wcykKQEAgLTc2MSw3ICs3NjEsNyBAQCBydF9zd2l0Y2hfc2NoZWQoc3Ry
dWN0IHNjaGVkdWxlciAqbmV3X29wcywgdW5zaWduZWQgaW50IGNwdSwKICAgICAgICAgZHByaW50
ayhYRU5MT0dfREVCVUcsICJSVERTOiB0aW1lciBpbml0aWFsaXplZCBvbiBjcHUgJXVcbiIsIGNw
dSk7CiAgICAgfQogCi0gICAgaWRsZV92Y3B1W2NwdV0tPnNjaGVkX3ByaXYgPSB2ZGF0YTsKKyAg
ICBpZGxlX3ZjcHVbY3B1XS0+c2NoZWRfaXRlbS0+cHJpdiA9IHZkYXRhOwogICAgIHBlcl9jcHUo
c2NoZWR1bGVyLCBjcHUpID0gbmV3X29wczsKICAgICBwZXJfY3B1KHNjaGVkdWxlX2RhdGEsIGNw
dSkuc2NoZWRfcHJpdiA9IE5VTEw7IC8qIG5vIHBkYXRhICovCiAKZGlmZiAtLWdpdCBhL3hlbi9j
b21tb24vc2NoZWR1bGUuYyBiL3hlbi9jb21tb24vc2NoZWR1bGUuYwppbmRleCAwNzEyODliOWMw
Li43OTVkNTZhNzkzIDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL3NjaGVkdWxlLmMKKysrIGIveGVu
L2NvbW1vbi9zY2hlZHVsZS5jCkBAIC0yNjksOCArMjY5LDggQEAgaW50IHNjaGVkX2luaXRfdmNw
dShzdHJ1Y3QgdmNwdSAqdiwgdW5zaWduZWQgaW50IHByb2Nlc3NvcikKICAgICBpbml0X3RpbWVy
KCZ2LT5wb2xsX3RpbWVyLCBwb2xsX3RpbWVyX2ZuLAogICAgICAgICAgICAgICAgdiwgdi0+cHJv
Y2Vzc29yKTsKIAotICAgIHYtPnNjaGVkX3ByaXYgPSBzY2hlZF9hbGxvY192ZGF0YShkb21fc2No
ZWR1bGVyKGQpLCBpdGVtLCBkLT5zY2hlZF9wcml2KTsKLSAgICBpZiAoIHYtPnNjaGVkX3ByaXYg
PT0gTlVMTCApCisgICAgaXRlbS0+cHJpdiA9IHNjaGVkX2FsbG9jX3ZkYXRhKGRvbV9zY2hlZHVs
ZXIoZCksIGl0ZW0sIGQtPnNjaGVkX3ByaXYpOworICAgIGlmICggaXRlbS0+cHJpdiA9PSBOVUxM
ICkKICAgICB7CiAgICAgICAgIHYtPnNjaGVkX2l0ZW0gPSBOVUxMOwogICAgICAgICB4ZnJlZShp
dGVtKTsKQEAgLTM2NSw3ICszNjUsNyBAQCBpbnQgc2NoZWRfbW92ZV9kb21haW4oc3RydWN0IGRv
bWFpbiAqZCwgc3RydWN0IGNwdXBvb2wgKmMpCiAgICAgewogICAgICAgICBzcGlubG9ja190ICps
b2NrOwogCi0gICAgICAgIHZjcHVkYXRhID0gdi0+c2NoZWRfcHJpdjsKKyAgICAgICAgdmNwdWRh
dGEgPSB2LT5zY2hlZF9pdGVtLT5wcml2OwogCiAgICAgICAgIG1pZ3JhdGVfdGltZXIoJnYtPnBl
cmlvZGljX3RpbWVyLCBuZXdfcCk7CiAgICAgICAgIG1pZ3JhdGVfdGltZXIoJnYtPnNpbmdsZXNo
b3RfdGltZXIsIG5ld19wKTsKQEAgLTM4Myw3ICszODMsNyBAQCBpbnQgc2NoZWRfbW92ZV9kb21h
aW4oc3RydWN0IGRvbWFpbiAqZCwgc3RydWN0IGNwdXBvb2wgKmMpCiAgICAgICAgICAqLwogICAg
ICAgICBzcGluX3VubG9ja19pcnEobG9jayk7CiAKLSAgICAgICAgdi0+c2NoZWRfcHJpdiA9IHZj
cHVfcHJpdlt2LT52Y3B1X2lkXTsKKyAgICAgICAgdi0+c2NoZWRfaXRlbS0+cHJpdiA9IHZjcHVf
cHJpdlt2LT52Y3B1X2lkXTsKICAgICAgICAgaWYgKCAhZC0+aXNfZHlpbmcgKQogICAgICAgICAg
ICAgc2NoZWRfbW92ZV9pcnFzKHYpOwogCkBAIC00MTUsNyArNDE1LDcgQEAgdm9pZCBzY2hlZF9k
ZXN0cm95X3ZjcHUoc3RydWN0IHZjcHUgKnYpCiAgICAgaWYgKCB0ZXN0X2FuZF9jbGVhcl9ib29s
KHYtPmlzX3VyZ2VudCkgKQogICAgICAgICBhdG9taWNfZGVjKCZwZXJfY3B1KHNjaGVkdWxlX2Rh
dGEsIHYtPnByb2Nlc3NvcikudXJnZW50X2NvdW50KTsKICAgICBzY2hlZF9yZW1vdmVfaXRlbSh2
Y3B1X3NjaGVkdWxlcih2KSwgaXRlbSk7Ci0gICAgc2NoZWRfZnJlZV92ZGF0YSh2Y3B1X3NjaGVk
dWxlcih2KSwgdi0+c2NoZWRfcHJpdik7CisgICAgc2NoZWRfZnJlZV92ZGF0YSh2Y3B1X3NjaGVk
dWxlcih2KSwgaXRlbS0+cHJpdik7CiAgICAgeGZyZWUoaXRlbSk7CiAgICAgdi0+c2NoZWRfaXRl
bSA9IE5VTEw7CiB9CkBAIC0xNTkzLDYgKzE1OTMsNyBAQCBzdGF0aWMgaW50IGNwdV9zY2hlZHVs
ZV91cCh1bnNpZ25lZCBpbnQgY3B1KQogICAgIGVsc2UKICAgICB7CiAgICAgICAgIHN0cnVjdCB2
Y3B1ICppZGxlID0gaWRsZV92Y3B1W2NwdV07CisgICAgICAgIHN0cnVjdCBzY2hlZF9pdGVtICpp
dGVtID0gaWRsZS0+c2NoZWRfaXRlbTsKIAogICAgICAgICAvKgogICAgICAgICAgKiBEdXJpbmcg
KEFDUEk/KSBzdXNwZW5kIHRoZSBpZGxlIHZDUFUgZm9yIHRoaXMgcENQVSBpcyBub3QgZnJlZWQs
CkBAIC0xNjA0LDExICsxNjA1LDEwIEBAIHN0YXRpYyBpbnQgY3B1X3NjaGVkdWxlX3VwKHVuc2ln
bmVkIGludCBjcHUpCiAgICAgICAgICAqIHdpdGggYSBkaWZmZXJlbnQgc2NoZWR1bGVyLCBpdCBp
cyBzY2hlZHVsZV9jcHVfc3dpdGNoKCksIGludm9rZWQKICAgICAgICAgICogbGF0ZXIsIHRoYXQg
d2lsbCBzZXQgdGhpbmdzIHVwIGFzIGFwcHJvcHJpYXRlLgogICAgICAgICAgKi8KLSAgICAgICAg
QVNTRVJUKGlkbGUtPnNjaGVkX3ByaXYgPT0gTlVMTCk7CisgICAgICAgIEFTU0VSVChpdGVtLT5w
cml2ID09IE5VTEwpOwogCi0gICAgICAgIGlkbGUtPnNjaGVkX3ByaXYgPSBzY2hlZF9hbGxvY192
ZGF0YSgmb3BzLCBpZGxlLT5zY2hlZF9pdGVtLAotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgaWRsZS0+ZG9tYWluLT5zY2hlZF9wcml2KTsKLSAgICAgICAgaWYg
KCBpZGxlLT5zY2hlZF9wcml2ID09IE5VTEwgKQorICAgICAgICBpdGVtLT5wcml2ID0gc2NoZWRf
YWxsb2NfdmRhdGEoJm9wcywgaXRlbSwgaWRsZS0+ZG9tYWluLT5zY2hlZF9wcml2KTsKKyAgICAg
ICAgaWYgKCBpdGVtLT5wcml2ID09IE5VTEwgKQogICAgICAgICAgICAgcmV0dXJuIC1FTk9NRU07
CiAgICAgfQogICAgIGlmICggaWRsZV92Y3B1W2NwdV0gPT0gTlVMTCApCkBAIC0xNjM0LDkgKzE2
MzQsOSBAQCBzdGF0aWMgdm9pZCBjcHVfc2NoZWR1bGVfZG93bih1bnNpZ25lZCBpbnQgY3B1KQog
ICAgIHN0cnVjdCBzY2hlZHVsZXIgKnNjaGVkID0gcGVyX2NwdShzY2hlZHVsZXIsIGNwdSk7CiAK
ICAgICBzY2hlZF9mcmVlX3BkYXRhKHNjaGVkLCBzZC0+c2NoZWRfcHJpdiwgY3B1KTsKLSAgICBz
Y2hlZF9mcmVlX3ZkYXRhKHNjaGVkLCBpZGxlX3ZjcHVbY3B1XS0+c2NoZWRfcHJpdik7CisgICAg
c2NoZWRfZnJlZV92ZGF0YShzY2hlZCwgaWRsZV92Y3B1W2NwdV0tPnNjaGVkX2l0ZW0tPnByaXYp
OwogCi0gICAgaWRsZV92Y3B1W2NwdV0tPnNjaGVkX3ByaXYgPSBOVUxMOworICAgIGlkbGVfdmNw
dVtjcHVdLT5zY2hlZF9pdGVtLT5wcml2ID0gTlVMTDsKICAgICBzZC0+c2NoZWRfcHJpdiA9IE5V
TEw7CiAKICAgICBraWxsX3RpbWVyKCZzZC0+c190aW1lcik7CkBAIC0xODYxLDcgKzE4NjEsNyBA
QCBpbnQgc2NoZWR1bGVfY3B1X3N3aXRjaCh1bnNpZ25lZCBpbnQgY3B1LCBzdHJ1Y3QgY3B1cG9v
bCAqYykKICAgICAgKi8KICAgICBvbGRfbG9jayA9IHBjcHVfc2NoZWR1bGVfbG9ja19pcnEoY3B1
KTsKIAotICAgIHZwcml2X29sZCA9IGlkbGUtPnNjaGVkX3ByaXY7CisgICAgdnByaXZfb2xkID0g
aWRsZS0+c2NoZWRfaXRlbS0+cHJpdjsKICAgICBwcHJpdl9vbGQgPSBwZXJfY3B1KHNjaGVkdWxl
X2RhdGEsIGNwdSkuc2NoZWRfcHJpdjsKICAgICBzY2hlZF9zd2l0Y2hfc2NoZWQobmV3X29wcywg
Y3B1LCBwcHJpdiwgdnByaXYpOwogCmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQu
aCBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCmluZGV4IDg1ZjkxMTlkNDguLjQ1ODU3YjRkMzUg
MTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCisrKyBiL3hlbi9pbmNsdWRlL3hl
bi9zY2hlZC5oCkBAIC0xNjIsNyArMTYyLDYgQEAgc3RydWN0IHZjcHUKICAgICBzdHJ1Y3QgdGlt
ZXIgICAgIHBvbGxfdGltZXI7ICAgIC8qIHRpbWVvdXQgZm9yIFNDSEVET1BfcG9sbCAqLwogCiAg
ICAgc3RydWN0IHNjaGVkX2l0ZW0gKnNjaGVkX2l0ZW07Ci0gICAgdm9pZCAgICAgICAgICAgICpz
Y2hlZF9wcml2OyAgICAvKiBzY2hlZHVsZXItc3BlY2lmaWMgZGF0YSAqLwogCiAgICAgc3RydWN0
IHZjcHVfcnVuc3RhdGVfaW5mbyBydW5zdGF0ZTsKICNpZm5kZWYgQ09ORklHX0NPTVBBVApAQCAt
Mjc5LDYgKzI3OCw3IEBAIHN0cnVjdCB2Y3B1CiAKIHN0cnVjdCBzY2hlZF9pdGVtIHsKICAgICBz
dHJ1Y3QgdmNwdSAgICAgICAgICAgKnZjcHU7CisgICAgdm9pZCAgICAgICAgICAgICAgICAgICpw
cml2OyAgICAgIC8qIHNjaGVkdWxlciBwcml2YXRlIGRhdGEgKi8KIH07CiAKIC8qIFBlci1kb21h
aW4gbG9jayBjYW4gYmUgcmVjdXJzaXZlbHkgYWNxdWlyZWQgaW4gZmF1bHQgaGFuZGxlcnMuICov
Ci0tIAoyLjE2LjQKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9y
ZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

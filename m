Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id E4D9ABB7EB
	for <lists+xen-devel@lfdr.de>; Mon, 23 Sep 2019 17:30:37 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iCQFs-00041A-3R; Mon, 23 Sep 2019 15:28:00 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=cYas=XS=citrix.com=paul.durrant@srs-us1.protection.inumbo.net>)
 id 1iCQFr-000415-8J
 for xen-devel@lists.xenproject.org; Mon, 23 Sep 2019 15:27:59 +0000
X-Inumbo-ID: b8470192-de16-11e9-a337-bc764e2007e4
Received: from esa3.hc3370-68.iphmx.com (unknown [216.71.145.155])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id b8470192-de16-11e9-a337-bc764e2007e4;
 Mon, 23 Sep 2019 15:27:57 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1569252478;
 h=from:to:cc:subject:date:message-id:references:
 in-reply-to:content-transfer-encoding:mime-version;
 bh=PXjX9jm3ZVAs24l5Eamcg2hq4ZJU/tAF4NfJX5DElnM=;
 b=JzmY/uBn7tH94G+9Eg6PHbQV8dEDETeTCbgU+AcBKN6rWNu1hJkyT3oe
 FIwIyvlOiVDA7vJ6bT/GPxq0xnuqFbJPgycQt4XFff4b6v3kRaN1SHUh0
 WAhQ3j0UNzNtsYTQgbniorGOpFrd5P1WWtYpXm5yNwU5BcBmhVRYyCk7n Y=;
Authentication-Results: esa3.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=Paul.Durrant@citrix.com;
 spf=Pass smtp.mailfrom=Paul.Durrant@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa3.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 Paul.Durrant@citrix.com) identity=pra;
 client-ip=162.221.158.21; receiver=esa3.hc3370-68.iphmx.com;
 envelope-from="Paul.Durrant@citrix.com";
 x-sender="Paul.Durrant@citrix.com"; x-conformance=sidf_compatible
Received-SPF: Pass (esa3.hc3370-68.iphmx.com: domain of
 Paul.Durrant@citrix.com designates 162.221.158.21 as
 permitted sender) identity=mailfrom;
 client-ip=162.221.158.21; receiver=esa3.hc3370-68.iphmx.com;
 envelope-from="Paul.Durrant@citrix.com";
 x-sender="Paul.Durrant@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83 ~all"
Received-SPF: None (esa3.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa3.hc3370-68.iphmx.com;
 envelope-from="Paul.Durrant@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: ngIPzx8s4727xvMa6HMlC9NT7tvrmHepunykXBD59rZxkFW1C/kwFExLZwTh04Mc47ITrImSmO
 LPtEaP0znKjotDZv8i1usnzr3EunBl8PhR3taE/cz84+4Qa+HnAMyahlOXwJJuPQYG2ogqY8dH
 LMkejm9FSwsaiHXHPr1H/aCWanxwEtJVqWT3ryrLWeBX790qd/CBsDGHQJ26dN656SMScm4QFR
 lNrpCNxLz0VUsa0kO6fQmUlBsQCfsmFsjjsn5cNhdvl1y/utwtKRBGPX2yaTavb1CHcUjJgYJr
 j6U=
X-SBRS: 2.7
X-MesageID: 5942045
X-Ironport-Server: esa3.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.64,540,1559534400"; 
   d="scan'208";a="5942045"
From: Paul Durrant <Paul.Durrant@citrix.com>
To: 'Jan Beulich' <jbeulich@suse.com>, "xen-devel@lists.xenproject.org"
 <xen-devel@lists.xenproject.org>
Thread-Topic: [Xen-devel] [PATCH v6 1/8] AMD/IOMMU: don't blindly allocate
 interrupt remapping tables
Thread-Index: AQHVbu1YWxkPJrEqQkWka8jBzdYkyqc5aPjg
Date: Mon, 23 Sep 2019 15:27:53 +0000
Message-ID: <c25bc9bcbbe94644b88586256bf2b8f5@AMSPEX02CL03.citrite.net>
References: <aa62726c-5aa4-8bcd-dc35-61eb8dfeaee3@suse.com>
 <f64deee2-7b5a-3330-997c-87bfc05b0807@suse.com>
In-Reply-To: <f64deee2-7b5a-3330-997c-87bfc05b0807@suse.com>
Accept-Language: en-GB, en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-ms-exchange-transport-fromentityheader: Hosted
MIME-Version: 1.0
Subject: Re: [Xen-devel] [PATCH v6 1/8] AMD/IOMMU: don't blindly allocate
 interrupt remapping tables
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <Andrew.Cooper3@citrix.com>,
 Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

PiAtLS0tLU9yaWdpbmFsIE1lc3NhZ2UtLS0tLQ0KPiBGcm9tOiBYZW4tZGV2ZWwgPHhlbi1kZXZl
bC1ib3VuY2VzQGxpc3RzLnhlbnByb2plY3Qub3JnPiBPbiBCZWhhbGYgT2YgSmFuIEJldWxpY2gN
Cj4gU2VudDogMTkgU2VwdGVtYmVyIDIwMTkgMTQ6MjINCj4gVG86IHhlbi1kZXZlbEBsaXN0cy54
ZW5wcm9qZWN0Lm9yZw0KPiBDYzogQW5kcmV3IENvb3BlciA8QW5kcmV3LkNvb3BlcjNAY2l0cml4
LmNvbT47IFN1cmF2ZWUgU3V0aGlrdWxwYW5pdCA8c3VyYXZlZS5zdXRoaWt1bHBhbml0QGFtZC5j
b20+DQo+IFN1YmplY3Q6IFtYZW4tZGV2ZWxdIFtQQVRDSCB2NiAxLzhdIEFNRC9JT01NVTogZG9u
J3QgYmxpbmRseSBhbGxvY2F0ZSBpbnRlcnJ1cHQgcmVtYXBwaW5nIHRhYmxlcw0KPiANCj4gQUNQ
SSB0YWJsZXMgYXJlIGZyZWUgdG8gbGlzdCBmYXIgbW9yZSBkZXZpY2UgY29vcmRpbmF0ZXMgdGhh
biB0aGVyZSBhcmUNCj4gYWN0dWFsIGRldmljZXMuIEJ5IGRlbGF5aW5nIHRoZSB0YWJsZSBhbGxv
Y2F0aW9ucyBmb3IgbW9zdCBjYXNlcywgYW5kDQo+IGRvaW5nIHRoZW0gb25seSB3aGVuIGFuIGFj
dHVhbCBkZXZpY2UgaXMga25vd24gdG8gYmUgcHJlc2VudCBhdCBhIGdpdmVuDQo+IHBvc2l0aW9u
LCBvdmVyYWxsIG1lbW9yeSB1c2VkIGZvciB0aGUgdGFibGVzIGdvZXMgZG93biBmcm9tIG92ZXIg
NTAwaw0KPiBwYWdlcyB0byBqdXN0IG92ZXIgMWsgKG9uIG15IHN5c3RlbSBoYXZpbmcgc3VjaCBB
Q1BJIHRhYmxlIGNvbnRlbnRzKS4NCj4gDQo+IFRhYmxlcyBjb250aW51ZSB0byBnZXQgYWxsb2Nh
dGVkIHJpZ2h0IGF3YXkgZm9yIHNwZWNpYWwgZW50cmllcw0KPiAoSU8tQVBJQywgSFBFVCkgYXMg
d2VsbCBhcyBmb3IgYWxpYXMgSURzLiBXaGlsZSBpbiB0aGUgZm9ybWVyIGNhc2UNCj4gdGhhdCdz
IHNpbXBseSBiZWNhdXNlIHRoZXJlIG1heSBub3QgYmUgYW55IGRldmljZSBhdCBhIGdpdmVuIHBv
c2l0aW9uLA0KPiBpbiB0aGUgbGF0dGVyIGNhc2UgdGhpcyBpcyB0byBhdm9pZCBoYXZpbmcgdG8g
aW50cm9kdWNlIHJlZi1jb3VudGluZyBvZg0KPiB0YWJsZSB1c2FnZS4NCj4gDQo+IFRoZSBjaGFu
Z2UgaW52b2x2ZXMgaW52b2tpbmcNCj4gaXRlcmF0ZV9pdnJzX21hcHBpbmdzKGFtZF9pb21tdV9z
ZXR1cF9kZXZpY2VfdGFibGUpIGEgc2Vjb25kIHRpbWUsDQo+IGJlY2F1c2UgdGhlIGZ1bmN0aW9u
IG5vdyB3YW50cyB0byBiZSBhYmxlIHRvIGZpbmQgUENJIGRldmljZXMsIHdoaWNoDQo+IGlzbid0
IHBvc3NpYmxlIHlldCB3aGVuIElPTU1VIHNldHVwIGhhcHBlbnMgdmVyeSBlYXJseSBkdXJpbmcg
eDJBUElDDQo+IG1vZGUgc2V0dXAuIEluIHRoaXMgY29udGV4dCBhbWRfaW9tbXVfaW5pdF9pbnRl
cnJ1cHQoKSBnZXRzIHJlbmFtZWQgYXMNCj4gd2VsbC4NCj4gDQo+IFRoZSBsb2dpYyBhZGp1c3Rp
bmcgYSBEVEUncyBpbnRlcnJ1cHQgcmVtYXBwaW5nIGF0dHJpYnV0ZXMgYWxzbyBnZXRzDQo+IGNo
YW5nZWQsIHN1Y2ggdGhhdCB0aGUgbGFjayBvZiBhbiBJUlQgd291bGQgcmVzdWx0IGluIHRhcmdl
dCBhYm9ydGVkDQo+IHJhdGhlciB0aGFuIG5vdCByZW1hcHBlZCBpbnRlcnJ1cHRzIChzaG91bGQg
YW55IG9jY3VyKS4NCj4gDQo+IE5vdGUgdGhhdCBmb3Igbm93IHBoYW50b20gZnVuY3Rpb25zIGdl
dCBzZXBhcmF0ZSBJUlRzIGFsbG9jYXRlZCwgYXMgd2FzDQo+IHRoZSBjYXNlIGJlZm9yZS4NCj4g
DQo+IFNpZ25lZC1vZmYtYnk6IEphbiBCZXVsaWNoIDxqYmV1bGljaEBzdXNlLmNvbT4NCg0KUmV2
aWV3ZWQtYnk6IFBhdWwgRHVycmFudCA8cGF1bC5kdXJyYW50QGNpdHJpeC5jb20+DQoNCj4gLS0t
DQo+IHY2OiBBY3F1aXJlIElPTU1VIGxvY2sgaW4gY29kZSBhZGRlZCB0byBhbWRfaW9tbXVfYWRk
X2RldmljZSgpLiBEcm9wIGENCj4gICAgIHBvaW50bGVzcyB1c2Ugb2YgdGhlIGNvbmRpdGlvbmFs
IG9wZXJhdG9yLg0KPiB2NTogTmV3Lg0KPiAtLS0NCj4gVEJEOiBUaGlzIHJldGFpbnMgcHJpb3Ig
KGJ1dCBzdXNwaWNpb3VzKSBiZWhhdmlvciBvZiBub3QgY2FsbGluZw0KPiAgICAgIGFtZF9pb21t
dV9zZXRfaW50cmVtYXBfdGFibGUoKSBmb3IgImludmFsaWQiIElWUlMgbWFwcGluZyBlbnRyaWVz
Lg0KPiAgICAgIFNpbmNlIERURS5JVj0wIG1lYW5zIHVuLXJlbWFwcGVkIGludGVycnVwdHMsIEkg
d29uZGVyIGlmIHRoaXMgbmVlZHMNCj4gICAgICBjaGFuZ2luZy4NCj4gDQo+IEJhY2twb3J0aW5n
IG5vdGU6IFRoaXMgZGVwZW5kcyBvbiBiNWZiZTgxMTk2ICJpb21tdSAvIHg4NjogbW92ZSBjYWxs
IHRvDQo+IHNjYW5fcGNpX2RldmljZXMoKSBvdXQgb2YgdmVuZG9yIGNvZGUiIQ0KPiANCj4gLS0t
DQo+ICB4ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfYWNwaS5jICAgICAgfCAgIDY1
ICsrKysrKysrKysrKystLS0tLS0tLS0tDQo+ICB4ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQv
aW9tbXVfaW5pdC5jICAgICAgfCAgIDczICsrKysrKysrKysrKysrKysrKysrLS0tLS0tDQo+ICB4
ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfaW50ci5jICAgICAgfCAgICA0IC0NCj4g
IHhlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9pb21tdV9tYXAuYyAgICAgICB8ICAgIDUgKw0K
PiAgeGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL3BjaV9hbWRfaW9tbXUuYyAgIHwgICA0MyAr
KysrKysrKysrKysrKy0NCj4gIHhlbi9pbmNsdWRlL2FzbS14ODYvaHZtL3N2bS9hbWQtaW9tbXUt
cHJvdG8uaCB8ICAgIDINCj4gIDYgZmlsZXMgY2hhbmdlZCwgMTQzIGluc2VydGlvbnMoKyksIDQ5
IGRlbGV0aW9ucygtKQ0KPiANCj4gLS0tIGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL2lv
bW11X2FjcGkuYw0KPiArKysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfYWNw
aS5jDQo+IEBAIC01Myw3ICs1Myw4IEBAIHVuaW9uIGFjcGlfaXZoZF9kZXZpY2Ugew0KPiAgfTsN
Cj4gDQo+ICBzdGF0aWMgdm9pZCBfX2luaXQgYWRkX2l2cnNfbWFwcGluZ19lbnRyeSgNCj4gLSAg
ICB1MTYgYmRmLCB1MTYgYWxpYXNfaWQsIHU4IGZsYWdzLCBzdHJ1Y3QgYW1kX2lvbW11ICppb21t
dSkNCj4gKyAgICB1aW50MTZfdCBiZGYsIHVpbnQxNl90IGFsaWFzX2lkLCB1aW50OF90IGZsYWdz
LCBib29sIGFsbG9jX2lydCwNCj4gKyAgICBzdHJ1Y3QgYW1kX2lvbW11ICppb21tdSkNCj4gIHsN
Cj4gICAgICBzdHJ1Y3QgaXZyc19tYXBwaW5ncyAqaXZyc19tYXBwaW5ncyA9IGdldF9pdnJzX21h
cHBpbmdzKGlvbW11LT5zZWcpOw0KPiANCj4gQEAgLTY5LDI3ICs3MCwzMiBAQCBzdGF0aWMgdm9p
ZCBfX2luaXQgYWRkX2l2cnNfbWFwcGluZ19lbnRyDQo+ICAgICAgaWYgKCBpb21tdS0+YmRmID09
IGJkZiApDQo+ICAgICAgICAgIHJldHVybjsNCj4gDQo+IC0gICAgaWYgKCAhaXZyc19tYXBwaW5n
c1thbGlhc19pZF0uaW50cmVtYXBfdGFibGUgKQ0KPiArICAgIC8qIEFsbG9jYXRlIGludGVycnVw
dCByZW1hcHBpbmcgdGFibGUgaWYgbmVlZGVkLiAqLw0KPiArICAgIGlmICggaW9tbXVfaW50cmVt
YXAgJiYgIWl2cnNfbWFwcGluZ3NbYWxpYXNfaWRdLmludHJlbWFwX3RhYmxlICkNCj4gICAgICB7
DQo+IC0gICAgICAgICAvKiBhbGxvY2F0ZSBwZXItZGV2aWNlIGludGVycnVwdCByZW1hcHBpbmcg
dGFibGUgKi8NCj4gLSAgICAgICAgIGlmICggYW1kX2lvbW11X3BlcmRldl9pbnRyZW1hcCApDQo+
IC0gICAgICAgICAgICAgaXZyc19tYXBwaW5nc1thbGlhc19pZF0uaW50cmVtYXBfdGFibGUgPQ0K
PiAtICAgICAgICAgICAgICAgICBhbWRfaW9tbXVfYWxsb2NfaW50cmVtYXBfdGFibGUoDQo+IC0g
ICAgICAgICAgICAgICAgICAgICBpb21tdSwNCj4gLSAgICAgICAgICAgICAgICAgICAgICZpdnJz
X21hcHBpbmdzW2FsaWFzX2lkXS5pbnRyZW1hcF9pbnVzZSk7DQo+IC0gICAgICAgICBlbHNlDQo+
IC0gICAgICAgICB7DQo+IC0gICAgICAgICAgICAgaWYgKCBzaGFyZWRfaW50cmVtYXBfdGFibGUg
PT0gTlVMTCAgKQ0KPiAtICAgICAgICAgICAgICAgICBzaGFyZWRfaW50cmVtYXBfdGFibGUgPSBh
bWRfaW9tbXVfYWxsb2NfaW50cmVtYXBfdGFibGUoDQo+IC0gICAgICAgICAgICAgICAgICAgICBp
b21tdSwNCj4gLSAgICAgICAgICAgICAgICAgICAgICZzaGFyZWRfaW50cmVtYXBfaW51c2UpOw0K
PiAtICAgICAgICAgICAgIGl2cnNfbWFwcGluZ3NbYWxpYXNfaWRdLmludHJlbWFwX3RhYmxlID0g
c2hhcmVkX2ludHJlbWFwX3RhYmxlOw0KPiAtICAgICAgICAgICAgIGl2cnNfbWFwcGluZ3NbYWxp
YXNfaWRdLmludHJlbWFwX2ludXNlID0gc2hhcmVkX2ludHJlbWFwX2ludXNlOw0KPiAtICAgICAg
ICAgfQ0KPiAtDQo+IC0gICAgICAgICBpZiAoICFpdnJzX21hcHBpbmdzW2FsaWFzX2lkXS5pbnRy
ZW1hcF90YWJsZSApDQo+IC0gICAgICAgICAgICAgcGFuaWMoIk5vIG1lbW9yeSBmb3IgJTA0eDol
MDJ4OiUwMnguJXUncyBJUlRcbiIsIGlvbW11LT5zZWcsDQo+IC0gICAgICAgICAgICAgICAgICAg
UENJX0JVUyhhbGlhc19pZCksIFBDSV9TTE9UKGFsaWFzX2lkKSwgUENJX0ZVTkMoYWxpYXNfaWQp
KTsNCj4gKyAgICAgICAgaWYgKCAhYW1kX2lvbW11X3BlcmRldl9pbnRyZW1hcCApDQo+ICsgICAg
ICAgIHsNCj4gKyAgICAgICAgICAgIGlmICggIXNoYXJlZF9pbnRyZW1hcF90YWJsZSApDQo+ICsg
ICAgICAgICAgICAgICAgc2hhcmVkX2ludHJlbWFwX3RhYmxlID0gYW1kX2lvbW11X2FsbG9jX2lu
dHJlbWFwX3RhYmxlKA0KPiArICAgICAgICAgICAgICAgICAgICBpb21tdSwgJnNoYXJlZF9pbnRy
ZW1hcF9pbnVzZSk7DQo+ICsNCj4gKyAgICAgICAgICAgIGlmICggIXNoYXJlZF9pbnRyZW1hcF90
YWJsZSApDQo+ICsgICAgICAgICAgICAgICAgcGFuaWMoIk5vIG1lbW9yeSBmb3Igc2hhcmVkIElS
VFxuIik7DQo+ICsNCj4gKyAgICAgICAgICAgIGl2cnNfbWFwcGluZ3NbYWxpYXNfaWRdLmludHJl
bWFwX3RhYmxlID0gc2hhcmVkX2ludHJlbWFwX3RhYmxlOw0KPiArICAgICAgICAgICAgaXZyc19t
YXBwaW5nc1thbGlhc19pZF0uaW50cmVtYXBfaW51c2UgPSBzaGFyZWRfaW50cmVtYXBfaW51c2U7
DQo+ICsgICAgICAgIH0NCj4gKyAgICAgICAgZWxzZSBpZiAoIGFsbG9jX2lydCApDQo+ICsgICAg
ICAgIHsNCj4gKyAgICAgICAgICAgIGl2cnNfbWFwcGluZ3NbYWxpYXNfaWRdLmludHJlbWFwX3Rh
YmxlID0NCj4gKyAgICAgICAgICAgICAgICBhbWRfaW9tbXVfYWxsb2NfaW50cmVtYXBfdGFibGUo
DQo+ICsgICAgICAgICAgICAgICAgICAgIGlvbW11LCAmaXZyc19tYXBwaW5nc1thbGlhc19pZF0u
aW50cmVtYXBfaW51c2UpOw0KPiArDQo+ICsgICAgICAgICAgICBpZiAoICFpdnJzX21hcHBpbmdz
W2FsaWFzX2lkXS5pbnRyZW1hcF90YWJsZSApDQo+ICsgICAgICAgICAgICAgICAgcGFuaWMoIk5v
IG1lbW9yeSBmb3IgJTA0eDolMDJ4OiUwMnguJXUncyBJUlRcbiIsDQo+ICsgICAgICAgICAgICAg
ICAgICAgICAgaW9tbXUtPnNlZywgUENJX0JVUyhhbGlhc19pZCksIFBDSV9TTE9UKGFsaWFzX2lk
KSwNCj4gKyAgICAgICAgICAgICAgICAgICAgICBQQ0lfRlVOQyhhbGlhc19pZCkpOw0KPiArICAg
ICAgICB9DQo+ICAgICAgfQ0KPiANCj4gICAgICBpdnJzX21hcHBpbmdzW2FsaWFzX2lkXS52YWxp
ZCA9IHRydWU7DQo+IEBAIC00MzMsNyArNDM5LDggQEAgc3RhdGljIHUxNiBfX2luaXQgcGFyc2Vf
aXZoZF9kZXZpY2Vfc2VsZQ0KPiAgICAgICAgICByZXR1cm4gMDsNCj4gICAgICB9DQo+IA0KPiAt
ICAgIGFkZF9pdnJzX21hcHBpbmdfZW50cnkoYmRmLCBiZGYsIHNlbGVjdC0+aGVhZGVyLmRhdGFf
c2V0dGluZywgaW9tbXUpOw0KPiArICAgIGFkZF9pdnJzX21hcHBpbmdfZW50cnkoYmRmLCBiZGYs
IHNlbGVjdC0+aGVhZGVyLmRhdGFfc2V0dGluZywgZmFsc2UsDQo+ICsgICAgICAgICAgICAgICAg
ICAgICAgICAgICBpb21tdSk7DQo+IA0KPiAgICAgIHJldHVybiBzaXplb2YoKnNlbGVjdCk7DQo+
ICB9DQo+IEBAIC00NzksNyArNDg2LDcgQEAgc3RhdGljIHUxNiBfX2luaXQgcGFyc2VfaXZoZF9k
ZXZpY2VfcmFuZw0KPiANCj4gICAgICBmb3IgKCBiZGYgPSBmaXJzdF9iZGY7IGJkZiA8PSBsYXN0
X2JkZjsgYmRmKysgKQ0KPiAgICAgICAgICBhZGRfaXZyc19tYXBwaW5nX2VudHJ5KGJkZiwgYmRm
LCByYW5nZS0+c3RhcnQuaGVhZGVyLmRhdGFfc2V0dGluZywNCj4gLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBpb21tdSk7DQo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ZmFsc2UsIGlvbW11KTsNCj4gDQo+ICAgICAgcmV0dXJuIGRldl9sZW5ndGg7DQo+ICB9DQo+IEBA
IC01MTMsNyArNTIwLDggQEAgc3RhdGljIHUxNiBfX2luaXQgcGFyc2VfaXZoZF9kZXZpY2VfYWxp
YQ0KPiANCj4gICAgICBBTURfSU9NTVVfREVCVUcoIiBEZXZfSWQgQWxpYXM6ICUjeFxuIiwgYWxp
YXNfaWQpOw0KPiANCj4gLSAgICBhZGRfaXZyc19tYXBwaW5nX2VudHJ5KGJkZiwgYWxpYXNfaWQs
IGFsaWFzLT5oZWFkZXIuZGF0YV9zZXR0aW5nLCBpb21tdSk7DQo+ICsgICAgYWRkX2l2cnNfbWFw
cGluZ19lbnRyeShiZGYsIGFsaWFzX2lkLCBhbGlhcy0+aGVhZGVyLmRhdGFfc2V0dGluZywgdHJ1
ZSwNCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgIGlvbW11KTsNCj4gDQo+ICAgICAgcmV0
dXJuIGRldl9sZW5ndGg7DQo+ICB9DQo+IEBAIC01NjgsNyArNTc2LDcgQEAgc3RhdGljIHUxNiBf
X2luaXQgcGFyc2VfaXZoZF9kZXZpY2VfYWxpYQ0KPiANCj4gICAgICBmb3IgKCBiZGYgPSBmaXJz
dF9iZGY7IGJkZiA8PSBsYXN0X2JkZjsgYmRmKysgKQ0KPiAgICAgICAgICBhZGRfaXZyc19tYXBw
aW5nX2VudHJ5KGJkZiwgYWxpYXNfaWQsIHJhbmdlLT5hbGlhcy5oZWFkZXIuZGF0YV9zZXR0aW5n
LA0KPiAtICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlvbW11KTsNCj4gKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICB0cnVlLCBpb21tdSk7DQo+IA0KPiAgICAgIHJldHVybiBk
ZXZfbGVuZ3RoOw0KPiAgfQ0KPiBAQCAtNTkzLDcgKzYwMSw3IEBAIHN0YXRpYyB1MTYgX19pbml0
IHBhcnNlX2l2aGRfZGV2aWNlX2V4dGUNCj4gICAgICAgICAgcmV0dXJuIDA7DQo+ICAgICAgfQ0K
PiANCj4gLSAgICBhZGRfaXZyc19tYXBwaW5nX2VudHJ5KGJkZiwgYmRmLCBleHQtPmhlYWRlci5k
YXRhX3NldHRpbmcsIGlvbW11KTsNCj4gKyAgICBhZGRfaXZyc19tYXBwaW5nX2VudHJ5KGJkZiwg
YmRmLCBleHQtPmhlYWRlci5kYXRhX3NldHRpbmcsIGZhbHNlLCBpb21tdSk7DQo+IA0KPiAgICAg
IHJldHVybiBkZXZfbGVuZ3RoOw0KPiAgfQ0KPiBAQCAtNjQwLDcgKzY0OCw3IEBAIHN0YXRpYyB1
MTYgX19pbml0IHBhcnNlX2l2aGRfZGV2aWNlX2V4dGUNCj4gDQo+ICAgICAgZm9yICggYmRmID0g
Zmlyc3RfYmRmOyBiZGYgPD0gbGFzdF9iZGY7IGJkZisrICkNCj4gICAgICAgICAgYWRkX2l2cnNf
bWFwcGluZ19lbnRyeShiZGYsIGJkZiwgcmFuZ2UtPmV4dGVuZGVkLmhlYWRlci5kYXRhX3NldHRp
bmcsDQo+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW9tbXUpOw0KPiArICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlLCBpb21tdSk7DQo+IA0KPiAgICAgIHJldHVy
biBkZXZfbGVuZ3RoOw0KPiAgfQ0KPiBAQCAtNzMzLDcgKzc0MSw4IEBAIHN0YXRpYyB1MTYgX19p
bml0IHBhcnNlX2l2aGRfZGV2aWNlX3NwZWMNCj4gICAgICBBTURfSU9NTVVfREVCVUcoIklWSEQg
U3BlY2lhbDogJTA0eDolMDJ4OiUwMnguJXUgdmFyaWV0eSAlI3ggaGFuZGxlICUjeFxuIiwNCj4g
ICAgICAgICAgICAgICAgICAgICAgc2VnLCBQQ0lfQlVTKGJkZiksIFBDSV9TTE9UKGJkZiksIFBD
SV9GVU5DKGJkZiksDQo+ICAgICAgICAgICAgICAgICAgICAgIHNwZWNpYWwtPnZhcmlldHksIHNw
ZWNpYWwtPmhhbmRsZSk7DQo+IC0gICAgYWRkX2l2cnNfbWFwcGluZ19lbnRyeShiZGYsIGJkZiwg
c3BlY2lhbC0+aGVhZGVyLmRhdGFfc2V0dGluZywgaW9tbXUpOw0KPiArICAgIGFkZF9pdnJzX21h
cHBpbmdfZW50cnkoYmRmLCBiZGYsIHNwZWNpYWwtPmhlYWRlci5kYXRhX3NldHRpbmcsIHRydWUs
DQo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICBpb21tdSk7DQo+IA0KPiAgICAgIHN3aXRj
aCAoIHNwZWNpYWwtPnZhcmlldHkgKQ0KPiAgICAgIHsNCj4gLS0tIGEveGVuL2RyaXZlcnMvcGFz
c3Rocm91Z2gvYW1kL2lvbW11X2luaXQuYw0KPiArKysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3Vn
aC9hbWQvaW9tbXVfaW5pdC5jDQo+IEBAIC0zMCw2ICszMCw3IEBADQo+ICAjaW5jbHVkZSA8eGVu
L2RlbGF5Lmg+DQo+IA0KPiAgc3RhdGljIGludCBfX2luaXRkYXRhIG5yX2FtZF9pb21tdXM7DQo+
ICtzdGF0aWMgYm9vbCBfX2luaXRkYXRhIHBjaV9pbml0Ow0KPiANCj4gIHN0YXRpYyB2b2lkIGRv
X2FtZF9pb21tdV9pcnEodW5zaWduZWQgbG9uZyBkYXRhKTsNCj4gIHN0YXRpYyBERUNMQVJFX1NP
RlRJUlFfVEFTS0xFVChhbWRfaW9tbXVfaXJxX3Rhc2tsZXQsIGRvX2FtZF9pb21tdV9pcnEsIDAp
Ow0KPiBAQCAtMTI0NCwxNyArMTI0NSwyMCBAQCBzdGF0aWMgaW50IF9faW5pdCBhbWRfaW9tbXVf
c2V0dXBfZGV2aWNlDQo+IA0KPiAgICAgIEJVR19PTiggKGl2cnNfYmRmX2VudHJpZXMgPT0gMCkg
KTsNCj4gDQo+IC0gICAgLyogYWxsb2NhdGUgJ2RldmljZSB0YWJsZScgb24gYSA0SyBib3VuZGFy
eSAqLw0KPiAtICAgIGRldmljZV90YWJsZS5hbGxvY19zaXplID0gUEFHRV9TSVpFIDw8DQo+IC0g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRfb3JkZXJfZnJvbV9ieXRlcygNCj4gLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBBR0VfQUxJR04oaXZyc19iZGZfZW50cmllcyAq
DQo+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJT01NVV9ERVZfVEFCTEVfRU5UUllf
U0laRSkpOw0KPiAtICAgIGRldmljZV90YWJsZS5lbnRyaWVzID0gZGV2aWNlX3RhYmxlLmFsbG9j
X3NpemUgLw0KPiAtICAgICAgICAgICAgICAgICAgICAgICAgICAgSU9NTVVfREVWX1RBQkxFX0VO
VFJZX1NJWkU7DQo+IC0NCj4gLSAgICBkZXZpY2VfdGFibGUuYnVmZmVyID0gYWxsb2NhdGVfYnVm
ZmVyKGRldmljZV90YWJsZS5hbGxvY19zaXplLA0KPiAtICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIkRldmljZSBUYWJsZSIpOw0KPiAtICAgIGlmICAoIGRldmljZV90
YWJsZS5idWZmZXIgPT0gTlVMTCApDQo+ICsgICAgaWYgKCAhZGV2aWNlX3RhYmxlLmJ1ZmZlciAp
DQo+ICsgICAgew0KPiArICAgICAgICAvKiBhbGxvY2F0ZSAnZGV2aWNlIHRhYmxlJyBvbiBhIDRL
IGJvdW5kYXJ5ICovDQo+ICsgICAgICAgIGRldmljZV90YWJsZS5hbGxvY19zaXplID0gUEFHRV9T
SVpFIDw8DQo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0X29yZGVyX2Zy
b21fYnl0ZXMoDQo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUEFHRV9BTElH
TihpdnJzX2JkZl9lbnRyaWVzICoNCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBJT01NVV9ERVZfVEFCTEVfRU5UUllfU0laRSkpOw0KPiArICAgICAgICBkZXZpY2VfdGFibGUu
ZW50cmllcyA9IGRldmljZV90YWJsZS5hbGxvY19zaXplIC8NCj4gKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBJT01NVV9ERVZfVEFCTEVfRU5UUllfU0laRTsNCj4gKw0KPiArICAgICAg
ICBkZXZpY2VfdGFibGUuYnVmZmVyID0gYWxsb2NhdGVfYnVmZmVyKGRldmljZV90YWJsZS5hbGxv
Y19zaXplLA0KPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICJEZXZpY2UgVGFibGUiKTsNCj4gKyAgICB9DQo+ICsgICAgaWYgKCAhZGV2aWNlX3RhYmxlLmJ1
ZmZlciApDQo+ICAgICAgICAgIHJldHVybiAtRU5PTUVNOw0KPiANCj4gICAgICAvKiBBZGQgZGV2
aWNlIHRhYmxlIGVudHJpZXMgKi8NCj4gQEAgLTEyNjMsMTMgKzEyNjcsNDYgQEAgc3RhdGljIGlu
dCBfX2luaXQgYW1kX2lvbW11X3NldHVwX2RldmljZQ0KPiAgICAgICAgICBpZiAoIGl2cnNfbWFw
cGluZ3NbYmRmXS52YWxpZCApDQo+ICAgICAgICAgIHsNCj4gICAgICAgICAgICAgIHZvaWQgKmR0
ZTsNCj4gKyAgICAgICAgICAgIGNvbnN0IHN0cnVjdCBwY2lfZGV2ICpwZGV2ID0gTlVMTDsNCj4g
DQo+ICAgICAgICAgICAgICAvKiBhZGQgZGV2aWNlIHRhYmxlIGVudHJ5ICovDQo+ICAgICAgICAg
ICAgICBkdGUgPSBkZXZpY2VfdGFibGUuYnVmZmVyICsgKGJkZiAqIElPTU1VX0RFVl9UQUJMRV9F
TlRSWV9TSVpFKTsNCj4gICAgICAgICAgICAgIGlvbW11X2R0ZV9hZGRfZGV2aWNlX2VudHJ5KGR0
ZSwgJml2cnNfbWFwcGluZ3NbYmRmXSk7DQo+IA0KPiArICAgICAgICAgICAgaWYgKCBpb21tdV9p
bnRyZW1hcCAmJg0KPiArICAgICAgICAgICAgICAgICBpdnJzX21hcHBpbmdzW2JkZl0uZHRlX3Jl
cXVlc3Rvcl9pZCA9PSBiZGYgJiYNCj4gKyAgICAgICAgICAgICAgICAgIWl2cnNfbWFwcGluZ3Nb
YmRmXS5pbnRyZW1hcF90YWJsZSApDQo+ICsgICAgICAgICAgICB7DQo+ICsgICAgICAgICAgICAg
ICAgaWYgKCAhcGNpX2luaXQgKQ0KPiArICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCj4g
KyAgICAgICAgICAgICAgICBwY2lkZXZzX2xvY2soKTsNCj4gKyAgICAgICAgICAgICAgICBwZGV2
ID0gcGNpX2dldF9wZGV2KHNlZywgUENJX0JVUyhiZGYpLCBQQ0lfREVWRk4yKGJkZikpOw0KPiAr
ICAgICAgICAgICAgICAgIHBjaWRldnNfdW5sb2NrKCk7DQo+ICsgICAgICAgICAgICB9DQo+ICsN
Cj4gKyAgICAgICAgICAgIGlmICggcGRldiApDQo+ICsgICAgICAgICAgICB7DQo+ICsgICAgICAg
ICAgICAgICAgdW5zaWduZWQgaW50IHJlcV9pZCA9IGJkZjsNCj4gKw0KPiArICAgICAgICAgICAg
ICAgIGRvIHsNCj4gKyAgICAgICAgICAgICAgICAgICAgaXZyc19tYXBwaW5nc1tyZXFfaWRdLmlu
dHJlbWFwX3RhYmxlID0NCj4gKyAgICAgICAgICAgICAgICAgICAgICAgIGFtZF9pb21tdV9hbGxv
Y19pbnRyZW1hcF90YWJsZSgNCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdnJzX21h
cHBpbmdzW2JkZl0uaW9tbXUsDQo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgJml2cnNf
bWFwcGluZ3NbcmVxX2lkXS5pbnRyZW1hcF9pbnVzZSk7DQo+ICsgICAgICAgICAgICAgICAgICAg
IGlmICggIWl2cnNfbWFwcGluZ3NbcmVxX2lkXS5pbnRyZW1hcF90YWJsZSApDQo+ICsgICAgICAg
ICAgICAgICAgICAgICAgICByZXR1cm4gLUVOT01FTTsNCj4gKw0KPiArICAgICAgICAgICAgICAg
ICAgICBpZiAoICFwZGV2LT5waGFudG9tX3N0cmlkZSApDQo+ICsgICAgICAgICAgICAgICAgICAg
ICAgICBicmVhazsNCj4gKyAgICAgICAgICAgICAgICAgICAgcmVxX2lkICs9IHBkZXYtPnBoYW50
b21fc3RyaWRlOw0KPiArICAgICAgICAgICAgICAgIH0gd2hpbGUgKCBQQ0lfU0xPVChyZXFfaWQp
ID09IHBkZXYtPnNiZGYuZGV2ICk7DQo+ICsgICAgICAgICAgICB9DQo+ICsNCj4gICAgICAgICAg
ICAgIGFtZF9pb21tdV9zZXRfaW50cmVtYXBfdGFibGUoDQo+IC0gICAgICAgICAgICAgICAgZHRl
LCB2aXJ0X3RvX21hZGRyKGl2cnNfbWFwcGluZ3NbYmRmXS5pbnRyZW1hcF90YWJsZSksDQo+ICsg
ICAgICAgICAgICAgICAgZHRlLA0KPiArICAgICAgICAgICAgICAgIGl2cnNfbWFwcGluZ3NbYmRm
XS5pbnRyZW1hcF90YWJsZQ0KPiArICAgICAgICAgICAgICAgID8gdmlydF90b19tYWRkcihpdnJz
X21hcHBpbmdzW2JkZl0uaW50cmVtYXBfdGFibGUpDQo+ICsgICAgICAgICAgICAgICAgOiAwLA0K
PiAgICAgICAgICAgICAgICAgIGlvbW11X2ludHJlbWFwKTsNCj4gICAgICAgICAgfQ0KPiAgICAg
IH0NCj4gQEAgLTE0MDIsNyArMTQzOSw4IEBAIGludCBfX2luaXQgYW1kX2lvbW11X2luaXQoYm9v
bCB4dCkNCj4gICAgICBpZiAoIHJjICkNCj4gICAgICAgICAgZ290byBlcnJvcl9vdXQ7DQo+IA0K
PiAtICAgIC8qIGFsbG9jYXRlIGFuZCBpbml0aWFsaXplIGEgZ2xvYmFsIGRldmljZSB0YWJsZSBz
aGFyZWQgYnkgYWxsIGlvbW11cyAqLw0KPiArICAgIC8qIEFsbG9jYXRlIGFuZCBpbml0aWFsaXpl
IGRldmljZSB0YWJsZShzKS4gKi8NCj4gKyAgICBwY2lfaW5pdCA9ICF4dDsNCj4gICAgICByYyA9
IGl0ZXJhdGVfaXZyc19tYXBwaW5ncyhhbWRfaW9tbXVfc2V0dXBfZGV2aWNlX3RhYmxlKTsNCj4g
ICAgICBpZiAoIHJjICkNCj4gICAgICAgICAgZ290byBlcnJvcl9vdXQ7DQo+IEBAIC0xNDIyLDcg
KzE0NjAsNyBAQCBpbnQgX19pbml0IGFtZF9pb21tdV9pbml0KGJvb2wgeHQpDQo+ICAgICAgICAg
IC8qDQo+ICAgICAgICAgICAqIFNldHRpbmcgdXAgb2YgdGhlIElPTU1VIGludGVycnVwdHMgY2Fu
bm90IG9jY3VyIHlldCBhdCB0aGUgKHZlcnkNCj4gICAgICAgICAgICogZWFybHkpIHRpbWUgd2Ug
Z2V0IGhlcmUgd2hlbiBlbmFibGluZyB4MkFQSUMgbW9kZS4gU3VwcHJlc3MgaXQNCj4gLSAgICAg
ICAgICogaGVyZSwgYW5kIGRvIGl0IGV4cGxpY2l0bHkgaW4gYW1kX2lvbW11X2luaXRfaW50ZXJy
dXB0KCkuDQo+ICsgICAgICAgICAqIGhlcmUsIGFuZCBkbyBpdCBleHBsaWNpdGx5IGluIGFtZF9p
b21tdV9pbml0X2xhdGUoKS4NCj4gICAgICAgICAgICovDQo+ICAgICAgICAgIHJjID0gYW1kX2lv
bW11X2luaXRfb25lKGlvbW11LCAheHQpOw0KPiAgICAgICAgICBpZiAoIHJjICkNCj4gQEAgLTE0
MzYsMTEgKzE0NzQsMTYgQEAgZXJyb3Jfb3V0Og0KPiAgICAgIHJldHVybiByYzsNCj4gIH0NCj4g
DQo+IC1pbnQgX19pbml0IGFtZF9pb21tdV9pbml0X2ludGVycnVwdCh2b2lkKQ0KPiAraW50IF9f
aW5pdCBhbWRfaW9tbXVfaW5pdF9sYXRlKHZvaWQpDQo+ICB7DQo+ICAgICAgc3RydWN0IGFtZF9p
b21tdSAqaW9tbXU7DQo+ICAgICAgaW50IHJjID0gMDsNCj4gDQo+ICsgICAgLyogRnVydGhlciBp
bml0aWFsaXplIHRoZSBkZXZpY2UgdGFibGUocykuICovDQo+ICsgICAgcGNpX2luaXQgPSB0cnVl
Ow0KPiArICAgIGlmICggaW9tbXVfaW50cmVtYXAgKQ0KPiArICAgICAgICByYyA9IGl0ZXJhdGVf
aXZyc19tYXBwaW5ncyhhbWRfaW9tbXVfc2V0dXBfZGV2aWNlX3RhYmxlKTsNCj4gKw0KPiAgICAg
IGZvcl9lYWNoX2FtZF9pb21tdSAoIGlvbW11ICkNCj4gICAgICB7DQo+ICAgICAgICAgIHN0cnVj
dCBpcnFfZGVzYyAqZGVzYzsNCj4gLS0tIGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL2lv
bW11X2ludHIuYw0KPiArKysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfaW50
ci5jDQo+IEBAIC03ODksNyArNzg5LDcgQEAgdm9pZCBhbWRfaW9tbXVfcmVhZF9tc2lfZnJvbV9p
cmUoDQo+ICAgICAgfQ0KPiAgfQ0KPiANCj4gLWludCBfX2luaXQgYW1kX2lvbW11X2ZyZWVfaW50
cmVtYXBfdGFibGUoDQo+ICtpbnQgYW1kX2lvbW11X2ZyZWVfaW50cmVtYXBfdGFibGUoDQo+ICAg
ICAgY29uc3Qgc3RydWN0IGFtZF9pb21tdSAqaW9tbXUsIHN0cnVjdCBpdnJzX21hcHBpbmdzICpp
dnJzX21hcHBpbmcpDQo+ICB7DQo+ICAgICAgdm9pZCAqKnRibHA7DQo+IEBAIC04MTQsNyArODE0
LDcgQEAgaW50IF9faW5pdCBhbWRfaW9tbXVfZnJlZV9pbnRyZW1hcF90YWJsZQ0KPiAgICAgIHJl
dHVybiAwOw0KPiAgfQ0KPiANCj4gLXZvaWQgKl9faW5pdCBhbWRfaW9tbXVfYWxsb2NfaW50cmVt
YXBfdGFibGUoDQo+ICt2b2lkICphbWRfaW9tbXVfYWxsb2NfaW50cmVtYXBfdGFibGUoDQo+ICAg
ICAgY29uc3Qgc3RydWN0IGFtZF9pb21tdSAqaW9tbXUsIHVuc2lnbmVkIGxvbmcgKippbnVzZV9t
YXApDQo+ICB7DQo+ICAgICAgdW5zaWduZWQgaW50IG9yZGVyID0gaW50cmVtYXBfdGFibGVfb3Jk
ZXIoaW9tbXUpOw0KPiAtLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfbWFw
LmMNCj4gKysrIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL2lvbW11X21hcC5jDQo+IEBA
IC0xMTYsOCArMTE2LDkgQEAgdm9pZCBfX2luaXQgYW1kX2lvbW11X3NldF9pbnRyZW1hcF90YWJs
ZQ0KPiAgICAgIHN0cnVjdCBhbWRfaW9tbXVfZHRlICpkdGUsIHVpbnQ2NF90IGludHJlbWFwX3B0
ciwgYm9vbCB2YWxpZCkNCj4gIHsNCj4gICAgICBkdGUtPml0X3Jvb3QgPSBpbnRyZW1hcF9wdHIg
Pj4gNjsNCj4gLSAgICBkdGUtPmludF90YWJfbGVuID0gSU9NTVVfSU5UUkVNQVBfT1JERVI7DQo+
IC0gICAgZHRlLT5pbnRfY3RsID0gSU9NTVVfREVWX1RBQkxFX0lOVF9DT05UUk9MX1RSQU5TTEFU
RUQ7DQo+ICsgICAgZHRlLT5pbnRfdGFiX2xlbiA9IGludHJlbWFwX3B0ciA/IElPTU1VX0lOVFJF
TUFQX09SREVSIDogMDsNCj4gKyAgICBkdGUtPmludF9jdGwgPSBpbnRyZW1hcF9wdHIgPyBJT01N
VV9ERVZfVEFCTEVfSU5UX0NPTlRST0xfVFJBTlNMQVRFRA0KPiArICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICA6IElPTU1VX0RFVl9UQUJMRV9JTlRfQ09OVFJPTF9BQk9SVEVEOw0KPiAg
ICAgIGR0ZS0+aWcgPSBmYWxzZTsgLyogdW5tYXBwZWQgaW50ZXJydXB0cyByZXN1bHQgaW4gaS9v
IHBhZ2UgZmF1bHRzICovDQo+ICAgICAgZHRlLT5pdiA9IHZhbGlkOw0KPiAgfQ0KPiAtLS0gYS94
ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvcGNpX2FtZF9pb21tdS5jDQo+ICsrKyBiL3hlbi9k
cml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9wY2lfYW1kX2lvbW11LmMNCj4gQEAgLTE2NCw3ICsxNjQs
NyBAQCBzdGF0aWMgaW50IF9faW5pdCBpb3ZfZGV0ZWN0KHZvaWQpDQo+ICAgICAgaWYgKCAhaW9t
bXVfZW5hYmxlICYmICFpb21tdV9pbnRyZW1hcCApDQo+ICAgICAgICAgIHJldHVybiAwOw0KPiAN
Cj4gLSAgICBpZiAoIChpbml0X2RvbmUgPyBhbWRfaW9tbXVfaW5pdF9pbnRlcnJ1cHQoKQ0KPiAr
ICAgIGlmICggKGluaXRfZG9uZSA/IGFtZF9pb21tdV9pbml0X2xhdGUoKQ0KPiAgICAgICAgICAg
ICAgICAgICAgICA6IGFtZF9pb21tdV9pbml0KGZhbHNlKSkgIT0gMCApDQo+ICAgICAgew0KPiAg
ICAgICAgICBwcmludGsoIkFNRC1WaTogRXJyb3IgaW5pdGlhbGl6YXRpb25cbiIpOw0KPiBAQCAt
NDI4LDYgKzQyOCw3IEBAIHN0YXRpYyBpbnQgYW1kX2lvbW11X2FkZF9kZXZpY2UodTggZGV2Zm4N
Cj4gIHsNCj4gICAgICBzdHJ1Y3QgYW1kX2lvbW11ICppb21tdTsNCj4gICAgICB1MTYgYmRmOw0K
PiArICAgIHN0cnVjdCBpdnJzX21hcHBpbmdzICppdnJzX21hcHBpbmdzOw0KPiANCj4gICAgICBp
ZiAoICFwZGV2LT5kb21haW4gKQ0KPiAgICAgICAgICByZXR1cm4gLUVJTlZBTDsNCj4gQEAgLTQ1
Nyw2ICs0NTgsMzYgQEAgc3RhdGljIGludCBhbWRfaW9tbXVfYWRkX2RldmljZSh1OCBkZXZmbg0K
PiAgICAgICAgICByZXR1cm4gLUVOT0RFVjsNCj4gICAgICB9DQo+IA0KPiArICAgIGl2cnNfbWFw
cGluZ3MgPSBnZXRfaXZyc19tYXBwaW5ncyhwZGV2LT5zZWcpOw0KPiArICAgIGJkZiA9IFBDSV9C
REYyKHBkZXYtPmJ1cywgZGV2Zm4pOw0KPiArICAgIGlmICggIWl2cnNfbWFwcGluZ3MgfHwNCj4g
KyAgICAgICAgICFpdnJzX21hcHBpbmdzW2l2cnNfbWFwcGluZ3NbYmRmXS5kdGVfcmVxdWVzdG9y
X2lkXS52YWxpZCApDQo+ICsgICAgICAgIHJldHVybiAtRVBFUk07DQo+ICsNCj4gKyAgICBpZiAo
IGlvbW11X2ludHJlbWFwICYmDQo+ICsgICAgICAgICBpdnJzX21hcHBpbmdzW2JkZl0uZHRlX3Jl
cXVlc3Rvcl9pZCA9PSBiZGYgJiYNCj4gKyAgICAgICAgICFpdnJzX21hcHBpbmdzW2JkZl0uaW50
cmVtYXBfdGFibGUgKQ0KPiArICAgIHsNCj4gKyAgICAgICAgdW5zaWduZWQgbG9uZyBmbGFnczsN
Cj4gKw0KPiArICAgICAgICBpdnJzX21hcHBpbmdzW2JkZl0uaW50cmVtYXBfdGFibGUgPQ0KPiAr
ICAgICAgICAgICAgYW1kX2lvbW11X2FsbG9jX2ludHJlbWFwX3RhYmxlKA0KPiArICAgICAgICAg
ICAgICAgIGlvbW11LCAmaXZyc19tYXBwaW5nc1tiZGZdLmludHJlbWFwX2ludXNlKTsNCj4gKyAg
ICAgICAgaWYgKCAhaXZyc19tYXBwaW5nc1tiZGZdLmludHJlbWFwX3RhYmxlICkNCj4gKyAgICAg
ICAgICAgIHJldHVybiAtRU5PTUVNOw0KPiArDQo+ICsgICAgICAgIHNwaW5fbG9ja19pcnFzYXZl
KCZpb21tdS0+bG9jaywgZmxhZ3MpOw0KPiArDQo+ICsgICAgICAgIGFtZF9pb21tdV9zZXRfaW50
cmVtYXBfdGFibGUoDQo+ICsgICAgICAgICAgICBpb21tdS0+ZGV2X3RhYmxlLmJ1ZmZlciArIChi
ZGYgKiBJT01NVV9ERVZfVEFCTEVfRU5UUllfU0laRSksDQo+ICsgICAgICAgICAgICB2aXJ0X3Rv
X21hZGRyKGl2cnNfbWFwcGluZ3NbYmRmXS5pbnRyZW1hcF90YWJsZSksDQo+ICsgICAgICAgICAg
ICBpb21tdV9pbnRyZW1hcCk7DQo+ICsNCj4gKyAgICAgICAgYW1kX2lvbW11X2ZsdXNoX2Rldmlj
ZShpb21tdSwgYmRmKTsNCj4gKw0KPiArICAgICAgICBzcGluX3VubG9ja19pcnFyZXN0b3JlKCZp
b21tdS0+bG9jaywgZmxhZ3MpOw0KPiArICAgIH0NCj4gKw0KPiAgICAgIGFtZF9pb21tdV9zZXR1
cF9kb21haW5fZGV2aWNlKHBkZXYtPmRvbWFpbiwgaW9tbXUsIGRldmZuLCBwZGV2KTsNCj4gICAg
ICByZXR1cm4gMDsNCj4gIH0NCj4gQEAgLTQ2NSw2ICs0OTYsOCBAQCBzdGF0aWMgaW50IGFtZF9p
b21tdV9yZW1vdmVfZGV2aWNlKHU4IGRlDQo+ICB7DQo+ICAgICAgc3RydWN0IGFtZF9pb21tdSAq
aW9tbXU7DQo+ICAgICAgdTE2IGJkZjsNCj4gKyAgICBzdHJ1Y3QgaXZyc19tYXBwaW5ncyAqaXZy
c19tYXBwaW5nczsNCj4gKw0KPiAgICAgIGlmICggIXBkZXYtPmRvbWFpbiApDQo+ICAgICAgICAg
IHJldHVybiAtRUlOVkFMOw0KPiANCj4gQEAgLTQ4MCw2ICs1MTMsMTQgQEAgc3RhdGljIGludCBh
bWRfaW9tbXVfcmVtb3ZlX2RldmljZSh1OCBkZQ0KPiAgICAgIH0NCj4gDQo+ICAgICAgYW1kX2lv
bW11X2Rpc2FibGVfZG9tYWluX2RldmljZShwZGV2LT5kb21haW4sIGlvbW11LCBkZXZmbiwgcGRl
dik7DQo+ICsNCj4gKyAgICBpdnJzX21hcHBpbmdzID0gZ2V0X2l2cnNfbWFwcGluZ3MocGRldi0+
c2VnKTsNCj4gKyAgICBiZGYgPSBQQ0lfQkRGMihwZGV2LT5idXMsIGRldmZuKTsNCj4gKyAgICBp
ZiAoIGFtZF9pb21tdV9wZXJkZXZfaW50cmVtYXAgJiYNCj4gKyAgICAgICAgIGl2cnNfbWFwcGlu
Z3NbYmRmXS5kdGVfcmVxdWVzdG9yX2lkID09IGJkZiAmJg0KPiArICAgICAgICAgaXZyc19tYXBw
aW5nc1tiZGZdLmludHJlbWFwX3RhYmxlICkNCj4gKyAgICAgICAgYW1kX2lvbW11X2ZyZWVfaW50
cmVtYXBfdGFibGUoaW9tbXUsICZpdnJzX21hcHBpbmdzW2JkZl0pOw0KPiArDQo+ICAgICAgcmV0
dXJuIDA7DQo+ICB9DQo+IA0KPiAtLS0gYS94ZW4vaW5jbHVkZS9hc20teDg2L2h2bS9zdm0vYW1k
LWlvbW11LXByb3RvLmgNCj4gKysrIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9odm0vc3ZtL2FtZC1p
b21tdS1wcm90by5oDQo+IEBAIC01MCw3ICs1MCw3IEBAIHZvaWQgZ2V0X2lvbW11X2ZlYXR1cmVz
KHN0cnVjdCBhbWRfaW9tbXUNCj4gIC8qIGFtZC1pb21tdS1pbml0IGZ1bmN0aW9ucyAqLw0KPiAg
aW50IGFtZF9pb21tdV9wcmVwYXJlKGJvb2wgeHQpOw0KPiAgaW50IGFtZF9pb21tdV9pbml0KGJv
b2wgeHQpOw0KPiAtaW50IGFtZF9pb21tdV9pbml0X2ludGVycnVwdCh2b2lkKTsNCj4gK2ludCBh
bWRfaW9tbXVfaW5pdF9sYXRlKHZvaWQpOw0KPiAgaW50IGFtZF9pb21tdV91cGRhdGVfaXZyc19t
YXBwaW5nX2FjcGkodm9pZCk7DQo+ICBpbnQgaW92X2FkanVzdF9pcnFfYWZmaW5pdGllcyh2b2lk
KTsNCj4gDQo+IA0KPiANCj4gX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18NCj4gWGVuLWRldmVsIG1haWxpbmcgbGlzdA0KPiBYZW4tZGV2ZWxAbGlzdHMueGVu
cHJvamVjdC5vcmcNCj4gaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3Rp
bmZvL3hlbi1kZXZlbA0KX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5v
cmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZl
bA==

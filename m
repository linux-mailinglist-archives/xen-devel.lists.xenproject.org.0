Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id CB760DC824
	for <lists+xen-devel@lfdr.de>; Fri, 18 Oct 2019 17:10:36 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iLTqv-0005KM-1c; Fri, 18 Oct 2019 15:07:41 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=/MKZ=YL=citrix.com=ian.jackson@srs-us1.protection.inumbo.net>)
 id 1iLTqt-0005JK-IY
 for xen-devel@lists.xenproject.org; Fri, 18 Oct 2019 15:07:39 +0000
X-Inumbo-ID: f0752584-f1b8-11e9-8aca-bc764e2007e4
Received: from esa1.hc3370-68.iphmx.com (unknown [216.71.145.142])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id f0752584-f1b8-11e9-8aca-bc764e2007e4;
 Fri, 18 Oct 2019 15:07:02 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1571411223;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version;
 bh=zJ505CVIc7EboI0NLvSJ4NNuvkfu18tz73mUbyNQaI8=;
 b=gGPyThhrINdGMaqvfqPfsCBeqF16M2jhJSNV26hA2caUEBpdwL6yzGsl
 nM/6LtxVKIP/zklpE9r2B20wrQdUWKjHD5/FvjL/KSMnDDLe+2dGdJTsK
 p8+npoR4u5qekw8NoX0XpghpYeN15s+VR+9PtSX2aofKqc74GZSkdG91m o=;
Authentication-Results: esa1.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=ian.jackson@eu.citrix.com;
 spf=Pass smtp.mailfrom=Ian.Jackson@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa1.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 ian.jackson@eu.citrix.com) identity=pra;
 client-ip=162.221.158.21; receiver=esa1.hc3370-68.iphmx.com;
 envelope-from="Ian.Jackson@citrix.com";
 x-sender="ian.jackson@eu.citrix.com";
 x-conformance=sidf_compatible
Received-SPF: Pass (esa1.hc3370-68.iphmx.com: domain of
 Ian.Jackson@citrix.com designates 162.221.158.21 as permitted
 sender) identity=mailfrom; client-ip=162.221.158.21;
 receiver=esa1.hc3370-68.iphmx.com;
 envelope-from="Ian.Jackson@citrix.com";
 x-sender="Ian.Jackson@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83
 ip4:168.245.78.127 ~all"
Received-SPF: None (esa1.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa1.hc3370-68.iphmx.com;
 envelope-from="Ian.Jackson@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: YyIe/SLmB8rcqjfPEat7MNPBJf47efN80agRPQTKzUbTglpmjnLpv3fRCEweNBR/zDF1FQGUR1
 W426Fk6OSofubklFpvUDPzyS0gMWi/VwuDNaXnYzBYSAHf5qNUhjkCQ68PXq0FJeF/SWjkhcc7
 PGmOSq+2koe0nupFpI/W5QtCR6Sv5y+oYYViVbgheQo+zKJJ7FfcS3qGNXtzd+2VU7y9n6gMtl
 i7D3yMOCt6Rg1nj9/NqcfAOlRCSOaMxO0KuJUfbsFaeNLmb9TiO4f70/NXjOH00gFpZ1dYpsJk
 Js4=
X-SBRS: 2.7
X-MesageID: 7191970
X-Ironport-Server: esa1.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.67,312,1566878400"; 
   d="scan'208";a="7191970"
From: Ian Jackson <ian.jackson@eu.citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Fri, 18 Oct 2019 16:06:53 +0100
Message-ID: <20191018150653.24862-11-ian.jackson@eu.citrix.com>
X-Mailer: git-send-email 2.11.0
In-Reply-To: <20191018150653.24862-1-ian.jackson@eu.citrix.com>
References: <20191018150653.24862-1-ian.jackson@eu.citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [XEN PATCH for-4.13 v5 10/10] libxl/xl: Overhaul
 passthrough setting logic
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Stefano Stabellini <sstabellini@kernel.org>, Julien Grall <julien@xen.org>,
 Andrew Cooper <Andrew.Cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Paul Durrant <pdurrant@gmail.com>,
 Jan Beulich <jbeulich@suse.com>,
 Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

TElCWExfUEFTU1RIUk9VR0hfVU5LTk9XTiAoYWthICJFTkFCTEVEIiBpbiBhbiBlYXJsaWVyIHVu
Y29tbWl0dGVkCnZlcnNpb24gb2YgdGhpcyBjb2RlKSBpcyBkb2luZyBkb3VibGUgZHV0eS4gIFdl
IGFjdHVhbGx5IG5lZWQgYWxsIG9mCnRoZSBmb2xsb3dpbmcgdG8gYmUgc3BlY2lmaWFibGU6CiAg
KiAiZGVmYXVsdCI6IGVuYWJsZSBQVCBpZmYgd2UgaGF2ZSBkZXZpY2VzIHRvCiAgICBwYXNzIHRo
cm91Z2ggc3BlY2lmaWVkIGluIHRoZSBpbml0aWFsIGNvbmZpZyBmaWxlLgogICogImVuYWJsZWQi
IChhbmQgZmFpbCBpZiB0aGUgcGxhdGZvcm0gZG9lc24ndCBzdXBwb3J0IGl0KS4KICAqICJkaXNh
YmxlZCIgKGFuZCByZWplY3QgZnV0dXJlIFBUIGhvdHBsdWcpLgogICogInNoYXJlX3B0Ii8ic3lu
Y19wdCI6IGVuYWJsZSBQVCBhbmQgc2V0IGEgc3BlY2lmaWMgUFQgbW9kZS4KCkRlZmF1bHRpbmcg
YW5kIGVycm9yIGNoZWNraW5nIHNob3VsZCBiZSBkb25lIGluIGxpYnhsLiAgU28sIHdlIG1ha2UK
c2V2ZXJhbCBjaGFuZ2VzIGhlcmUuCgpXZSBpbnRyb2R1Y2UgImVuYWJsZWQiLCBhbmQgcmVuYW1l
ICJ1bmtub3duIiB0byAiZGVmYXVsdCIuCgpXZSBtb3ZlIGFsbCBvZiB0aGUgZXJyb3IgY2hlY2tp
bmcgYW5kIGRlZmF1bHRpbmcgY29kZSBmcm9tIHhsIGludG8KbGlieGwuICBOb3csIGxpYnhsX19k
b21haW5fY29uZmlnX3NldGRlZmF1bHQgaGFzIGFsbCBvZiB0aGUgbmVjZXNzYXJ5CmluZm9ybWF0
aW9uIHRvIGdldCB0aGlzIHJpZ2h0LiAgU28gd2UgY2FuIGRvIGl0IGFsbCB0aGVyZS4gIENob29z
aW5nCnRoZSBzcGVjaWZpYyBtb2RlIGlzIGFyY2gtc3BlY2lmaWMuCgpXZSBjYW4gYWxzbyBhcnJh
bmdlIHRvIGhhdmUgb25seSBvbmUgcGxhY2UgZWFjaCB3aGljaCBjYWxjdWxhdGVzCihpKSB3aGV0
aGVyIHBhc3N0aHJvdWdoIG5lZWRzIHRvIGJlIGVuYWJsZWQgYmVjYXVzZSBwdCBkZXZpY2VzIHdl
cmUKc3BlY2lmaWVkIChpaSkgd2hldGhlciBwdF9zaGFyZSBjYW4gYmUgdXNlZCAoZm9yIGVhY2gg
YXJjaCkuCgp4bCBub3cgb25seSBoYXMgdG8gcGFyc2UgdGhlIGVudW0gaW4gdGhlIHNhbWUgd2F5
IGFzIGl0IHBhcnNlcyBhbGwKb3RoZXIgZW51bXMuCgpUaGlzIGNoYW5nZSBmaXhlcyBhIHJlZ3Jl
c3Npb24gZnJvbSBlYXJsaWVyIDQuMTMtcHJlOiB1bnRpbCByZWNlbnQKY2hhbmdlcywgcGFzc3Ro
cm91Z2ggd2FzIG9ubHkgZW5hYmxlZCBieSBkZWZhdWx0IGlmIHBhc3N0aHJvdWdoCmRldmljZXMg
d2VyZSBzcGVjaWZpZWQuICBXZSByZXN0b3JlIHRoaXMgYmVoYXZpb3VyLgoKU2lnbmVkLW9mZi1i
eTogSWFuIEphY2tzb24gPGlhbi5qYWNrc29uQGV1LmNpdHJpeC5jb20+CkNDOiBTdGVmYW5vIFN0
YWJlbGxpbmkgPHNzdGFiZWxsaW5pQGtlcm5lbC5vcmc+CkNDOiBKdWxpZW4gR3JhbGwgPGp1bGll
bkB4ZW4ub3JnPgpDQzogVm9sb2R5bXlyIEJhYmNodWsgPFZvbG9keW15cl9CYWJjaHVrQGVwYW0u
Y29tPgpDQzogQW5kcmV3IENvb3BlciA8QW5kcmV3LkNvb3BlcjNAY2l0cml4LmNvbT4KQ0M6IFBh
dWwgRHVycmFudCA8cGR1cnJhbnRAZ21haWwuY29tPgpDQzogSmFuIEJldWxpY2ggPGpiZXVsaWNo
QHN1c2UuY29tPgoKLS0tCnY1OiBDaGFuZ2UgInVua25vd24iIHRvICJkZWZhdWx0Ii4gIEluIHRo
ZSBtYW5wYWdlIHRvby4KCnY0OiBGaXggdHJhaWxpbmcgd2hpdGVzcGFjZQogICAgTm8gbG9uZ2Vy
IGNoYW5nZSAidW5rbm93biIgdG8gInVuc3BlY2lmaWVkIi4KCnYzOiBEcm9wIHBhcmFncmFwaCBh
Ym91dCBtYXNraW5nIGFub3RoZXIgb3NzdGVzdCByZWdyZXNzaW9uLAogICAgIGFzIHRoYXQncyBu
b3cgZml4ZWQuCiAgICBEcm9wIHJlZHVuZGFudCAiRVJST1I6IiBpbiB0d28gbG9nIG1lc3NhZ2Vz
LgogICAgQWRkIGEgY29tbWVudCBhYm91dCB0aGUgd2F5ICJlbmFibGVkIiBnZXRzIGNoYW5nZWQg
dG8gYSBzcGVjaWZpYyB2YWx1ZS4KICAgIFNwbGl0IHBhc3N0aHJvdWdoIG1vZGUgZGVmYXVsdGlu
ZyBpbnRvIGFyY2ggc3BlY2lmaWMgZnVuY3Rpb25zLgogICAgT24gQVJNLCBhbHdheXMgY2hvb3Nl
IChhbmQgaW5zaXN0IG9uKSBzaGFyZV9wdC4KICAgIFJlamVjdCBzaGFyZV9wdCBmb3Igbm9uLUhB
UCBndWVzdHMuCiAgICBSZWplY3QgcGFzc3Rocm91Z2ggZm9yIFBWSCBndWVzdHMuCiAgICBBY3R1
YWxseSBkb2N1bWVudCAidW5zcGVjaWZpZWQiIG9wdGlvbiBpbiB4bC5jZmcoNSkKICAgIFJlbmFt
ZSAidW5rbm93biIgdG8gInVuc3BlY2lmaWVkIgoKdjI6IE5ldyBwYXRjaCBpbiB0aGlzIHZlcnNp
b24gb2YgdGhlIHNlcmllcy4KLS0tCiBkb2NzL21hbi94bC5jZmcuNS5wb2QuaW4gICAgfCAgNiAr
KysrCiB0b29scy9saWJ4bC9saWJ4bF9hcmNoLmggICAgfCAgNiArKysrCiB0b29scy9saWJ4bC9s
aWJ4bF9hcm0uYyAgICAgfCAyNCArKysrKysrKysrKysrKysrCiB0b29scy9saWJ4bC9saWJ4bF9j
cmVhdGUuYyAgfCA0MyArKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLQogdG9vbHMvbGlieGwv
bGlieGxfdHlwZXMuaWRsIHwgIDcgKysrLS0KIHRvb2xzL2xpYnhsL2xpYnhsX3g4Ni5jICAgICB8
IDQxICsrKysrKysrKysrKysrKysrKysrKysrKysrKwogdG9vbHMveGwveGxfcGFyc2UuYyAgICAg
ICAgIHwgNjcgKysrKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiA3
IGZpbGVzIGNoYW5nZWQsIDExNiBpbnNlcnRpb25zKCspLCA3OCBkZWxldGlvbnMoLSkKCmRpZmYg
LS1naXQgYS9kb2NzL21hbi94bC5jZmcuNS5wb2QuaW4gYi9kb2NzL21hbi94bC5jZmcuNS5wb2Qu
aW4KaW5kZXggNjRiZWQzMGJjZS4uMjQ1ZDNmOTQ3MiAxMDA2NDQKLS0tIGEvZG9jcy9tYW4veGwu
Y2ZnLjUucG9kLmluCisrKyBiL2RvY3MvbWFuL3hsLmNmZy41LnBvZC5pbgpAQCAtNjYwLDYgKzY2
MCwxMiBAQCBpbiBwcmVmZXJlbmNlLiBIb3dldmVyLCB0aGUgYXZhaWxhYmlsaXR5IG9mIHRoaXMg
b3B0aW9uIGlzIGhhcmR3YXJlCiBzcGVjaWZpYy4gSWYgQjx4bCBpbmZvPiByZXBvcnRzIEI8dmly
dF9jYXBzPiBjb250YWluaW5nCiBCPGlvbW11X2hhcF9wdF9zaGFyZT4gdGhlbiB0aGlzIG9wdGlv
biBtYXkgYmUgdXNlZC4KIAorPWl0ZW0gQjxkZWZhdWx0PgorCitUaGUgZGVmYXVsdCwgd2hpY2gg
Y2hvb3NlcyBiZXR3ZWVuIEI8ZGlzYWJsZWQ+IGFuZCBCPGVuYWJsZWQ+CithY2NvcmRpbmcgdG8g
d2hldGhlciBwYXNzdGhyb3VnaCBkZXZpY2VzIGFyZSBlbmFibGVkIGluIHRoZSBjb25maWcKK2Zp
bGUuCisKID1iYWNrCiAKID1iYWNrCmRpZmYgLS1naXQgYS90b29scy9saWJ4bC9saWJ4bF9hcmNo
LmggYi90b29scy9saWJ4bC9saWJ4bF9hcmNoLmgKaW5kZXggZDYyNDE1OWU1My4uZWU2NjQxYjNl
NiAxMDA2NDQKLS0tIGEvdG9vbHMvbGlieGwvbGlieGxfYXJjaC5oCisrKyBiL3Rvb2xzL2xpYnhs
L2xpYnhsX2FyY2guaApAQCAtNzMsNiArNzMsMTIgQEAgdm9pZCBsaWJ4bF9fYXJjaF9kb21haW5f
YnVpbGRfaW5mb19zZXRkZWZhdWx0KGxpYnhsX19nYyAqZ2MsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlieGxfZG9tYWluX2J1aWxkX2luZm8gKmJfaW5m
byk7CiAKIF9oaWRkZW4KK2ludCBsaWJ4bF9fYXJjaF9wYXNzdGhyb3VnaF9tb2RlX3NldGRlZmF1
bHQobGlieGxfX2djICpnYywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgdWludDMyX3QgZG9taWQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGxpYnhsX2RvbWFpbl9jb25maWcgKmRfY29uZmlnLAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsaWJ4bF9waHlzaW5mbyAqcGh5c2lu
Zm8pOworCitfaGlkZGVuCiBpbnQgbGlieGxfX2FyY2hfZXh0cmFfbWVtb3J5KGxpYnhsX19nYyAq
Z2MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxpYnhsX2RvbWFpbl9idWls
ZF9pbmZvICppbmZvLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50NjRfdCAqb3V0
KTsKZGlmZiAtLWdpdCBhL3Rvb2xzL2xpYnhsL2xpYnhsX2FybS5jIGIvdG9vbHMvbGlieGwvbGli
eGxfYXJtLmMKaW5kZXggYmYzMWI5YjNjYS4uMmYxY2E2OTQzMSAxMDA2NDQKLS0tIGEvdG9vbHMv
bGlieGwvbGlieGxfYXJtLmMKKysrIGIvdG9vbHMvbGlieGwvbGlieGxfYXJtLmMKQEAgLTExOTEs
NiArMTE5MSwzMCBAQCB2b2lkIGxpYnhsX19hcmNoX2RvbWFpbl9idWlsZF9pbmZvX3NldGRlZmF1
bHQobGlieGxfX2djICpnYywKICAgICBsaWJ4bF9kb21haW5fYnVpbGRfaW5mb19pbml0X3R5cGUo
Yl9pbmZvLCBMSUJYTF9ET01BSU5fVFlQRV9QVkgpOwogfQogCitpbnQgbGlieGxfX2FyY2hfcGFz
c3Rocm91Z2hfbW9kZV9zZXRkZWZhdWx0KGxpYnhsX19nYyAqZ2MsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90IGRvbWlkLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ4bF9kb21haW5fY29uZmlnICpkX2Nv
bmZpZywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qg
bGlieGxfcGh5c2luZm8gKnBoeXNpbmZvKQoreworICAgIGludCByYzsKKyAgICBsaWJ4bF9kb21h
aW5fY3JlYXRlX2luZm8gKmNvbnN0IGNfaW5mbyA9ICZkX2NvbmZpZy0+Y19pbmZvOworCisgICAg
aWYgKGNfaW5mby0+cGFzc3Rocm91Z2ggPT0gTElCWExfUEFTU1RIUk9VR0hfRU5BQkxFRCkgewor
ICAgICAgICBjX2luZm8tPnBhc3N0aHJvdWdoID0gTElCWExfUEFTU1RIUk9VR0hfU0hBUkVfUFQ7
CisgICAgfQorCisgICAgaWYgKGNfaW5mby0+cGFzc3Rocm91Z2ggPT0gTElCWExfUEFTU1RIUk9V
R0hfU1lOQ19QVCkgeworICAgICAgICBMT0dEKEVSUk9SLCBkb21pZCwKKyAgICAgICAgICAgICAi
cGFzc3Rocm91Z2g9XCJzeW5jX3B0XCIgbm90IHN1cHBvcnRlZCBvbiBBUk1cbiIpOworICAgICAg
ICByYyA9IEVSUk9SX0lOVkFMOworICAgICAgICBnb3RvIG91dDsKKyAgICB9CisKKyAgICByYyA9
IDA7Cisgb3V0OgorICAgIHJldHVybiByYzsKK30KKwogLyoKICAqIExvY2FsIHZhcmlhYmxlczoK
ICAqIG1vZGU6IEMKZGlmZiAtLWdpdCBhL3Rvb2xzL2xpYnhsL2xpYnhsX2NyZWF0ZS5jIGIvdG9v
bHMvbGlieGwvbGlieGxfY3JlYXRlLmMKaW5kZXggNzg2OWQ1NGIzMi4uZDU5YWMyYWIwNSAxMDA2
NDQKLS0tIGEvdG9vbHMvbGlieGwvbGlieGxfY3JlYXRlLmMKKysrIGIvdG9vbHMvbGlieGwvbGli
eGxfY3JlYXRlLmMKQEAgLTU3LDE4ICs1Nyw2IEBAIGludCBsaWJ4bF9fZG9tYWluX2NyZWF0ZV9p
bmZvX3NldGRlZmF1bHQobGlieGxfX2djICpnYywKICAgICBpZiAoIWNfaW5mby0+c3NpZHJlZikK
ICAgICAgICAgY19pbmZvLT5zc2lkcmVmID0gU0VDSU5JVFNJRF9ET01VOwogCi0gICAgaWYgKGlu
Zm8tPmNhcF9odm1fZGlyZWN0aW8gJiYKLSAgICAgICAgKGNfaW5mby0+cGFzc3Rocm91Z2ggPT0g
TElCWExfUEFTU1RIUk9VR0hfVU5LTk9XTikpIHsKLSAgICAgICAgY19pbmZvLT5wYXNzdGhyb3Vn
aCA9ICgoY19pbmZvLT50eXBlID09IExJQlhMX0RPTUFJTl9UWVBFX1BWKSB8fAotICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICFpbmZvLT5jYXBfaW9tbXVfaGFwX3B0X3NoYXJlKSA/Ci0g
ICAgICAgICAgICBMSUJYTF9QQVNTVEhST1VHSF9TWU5DX1BUIDogTElCWExfUEFTU1RIUk9VR0hf
U0hBUkVfUFQ7Ci0gICAgfSBlbHNlIGlmICghaW5mby0+Y2FwX2h2bV9kaXJlY3RpbykgewotICAg
ICAgICBjX2luZm8tPnBhc3N0aHJvdWdoID0gTElCWExfUEFTU1RIUk9VR0hfRElTQUJMRUQ7Ci0g
ICAgfQotCi0gICAgLyogQW4gZXhwbGljaXQgc2V0dGluZyBzaG91bGQgbm93IGhhdmUgYmVlbiBj
aG9zZW4gKi8KLSAgICBhc3NlcnQoY19pbmZvLT5wYXNzdGhyb3VnaCAhPSBMSUJYTF9QQVNTVEhS
T1VHSF9VTktOT1dOKTsKLQogICAgIHJldHVybiAwOwogfQogCkBAIC01OTEsNyArNTc5LDcgQEAg
aW50IGxpYnhsX19kb21haW5fbWFrZShsaWJ4bF9fZ2MgKmdjLCBsaWJ4bF9kb21haW5fY29uZmln
ICpkX2NvbmZpZywKICAgICAgICAgICAgICAgICBsaWJ4bF9kZWZib29sX3ZhbChpbmZvLT5vb3Mp
ID8gMCA6IFhFTl9ET01DVExfQ0RGX29vc19vZmY7CiAgICAgICAgIH0KIAotICAgICAgICBhc3Nl
cnQoaW5mby0+cGFzc3Rocm91Z2ggIT0gTElCWExfUEFTU1RIUk9VR0hfVU5LTk9XTik7CisgICAg
ICAgIGFzc2VydChpbmZvLT5wYXNzdGhyb3VnaCAhPSBMSUJYTF9QQVNTVEhST1VHSF9ERUZBVUxU
KTsKICAgICAgICAgTE9HKERFVEFJTCwgInBhc3N0aHJvdWdoOiAlcyIsCiAgICAgICAgICAgICBs
aWJ4bF9wYXNzdGhyb3VnaF90b19zdHJpbmcoaW5mby0+cGFzc3Rocm91Z2gpKTsKIApAQCAtOTA4
LDYgKzg5Niw3IEBAIGludCBsaWJ4bF9fZG9tYWluX2NvbmZpZ19zZXRkZWZhdWx0KGxpYnhsX19n
YyAqZ2MsCiAgICAgbGlieGxfY3R4ICpjdHggPSBsaWJ4bF9fZ2Nfb3duZXIoZ2MpOwogICAgIGlu
dCByZXQ7CiAgICAgYm9vbCBwb2RfZW5hYmxlZCA9IGZhbHNlOworICAgIGxpYnhsX2RvbWFpbl9j
cmVhdGVfaW5mbyAqY19pbmZvID0gJmRfY29uZmlnLT5jX2luZm87CiAKICAgICBsaWJ4bF9waHlz
aW5mbyBwaHlzaW5mbzsKICAgICByZXQgPSBsaWJ4bF9nZXRfcGh5c2luZm8oQ1RYLCAmcGh5c2lu
Zm8pOwpAQCAtOTc5LDYgKzk2OCwzNCBAQCBpbnQgbGlieGxfX2RvbWFpbl9jb25maWdfc2V0ZGVm
YXVsdChsaWJ4bF9fZ2MgKmdjLAogICAgICAgICBnb3RvIGVycm9yX291dDsKICAgICB9CiAKKyAg
ICBib29sIG5lZWRfcHQgPSBkX2NvbmZpZy0+bnVtX3BjaWRldnMgfHwgZF9jb25maWctPm51bV9k
dGRldnM7CisgICAgaWYgKGNfaW5mby0+cGFzc3Rocm91Z2ggPT0gTElCWExfUEFTU1RIUk9VR0hf
REVGQVVMVCkgeworICAgICAgICBjX2luZm8tPnBhc3N0aHJvdWdoID0gbmVlZF9wdAorICAgICAg
ICAgICAgPyBMSUJYTF9QQVNTVEhST1VHSF9FTkFCTEVEIDogTElCWExfUEFTU1RIUk9VR0hfRElT
QUJMRUQ7CisgICAgfQorCisgICAgYm9vbCBpb21tdV9lbmFibGVkID0gcGh5c2luZm8uY2FwX2h2
bV9kaXJlY3RpbzsKKyAgICBpZiAoY19pbmZvLT5wYXNzdGhyb3VnaCAhPSBMSUJYTF9QQVNTVEhS
T1VHSF9ESVNBQkxFRCAmJiAhaW9tbXVfZW5hYmxlZCkgeworICAgICAgICBMT0dEKEVSUk9SLCBk
b21pZCwKKyAgICAgICAgICAgICAicGFzc3Rocm91Z2ggbm90IHN1cHBvcnRlZCBvbiB0aGlzIHBs
YXRmb3JtXG4iKTsKKyAgICAgICAgcmV0ID0gRVJST1JfSU5WQUw7CisgICAgICAgIGdvdG8gZXJy
b3Jfb3V0OworICAgIH0KKworICAgIGlmIChjX2luZm8tPnBhc3N0aHJvdWdoID09IExJQlhMX1BB
U1NUSFJPVUdIX0RJU0FCTEVEICYmIG5lZWRfcHQpIHsKKyAgICAgICAgTE9HRChFUlJPUiwgZG9t
aWQsCisgICAgICAgICAgICAgInBhc3N0aHJvdWdoIGRpc2FibGVkIGJ1dCBkZXZpY2VzIGFyZSBz
cGVjaWZpZWQiKTsKKyAgICAgICAgcmV0ID0gRVJST1JfSU5WQUw7CisgICAgICAgIGdvdG8gZXJy
b3Jfb3V0OworICAgIH0KKworICAgIHJldCA9IGxpYnhsX19hcmNoX3Bhc3N0aHJvdWdoX21vZGVf
c2V0ZGVmYXVsdChnYyxkb21pZCxkX2NvbmZpZywmcGh5c2luZm8pOworICAgIGlmIChyZXQpIGdv
dG8gZXJyb3Jfb3V0OworCisgICAgLyogQW4gZXhwbGljaXQgc2V0dGluZyBzaG91bGQgbm93IGhh
dmUgYmVlbiBjaG9zZW4gKi8KKyAgICBhc3NlcnQoY19pbmZvLT5wYXNzdGhyb3VnaCAhPSBMSUJY
TF9QQVNTVEhST1VHSF9ERUZBVUxUKTsKKyAgICBhc3NlcnQoY19pbmZvLT5wYXNzdGhyb3VnaCAh
PSBMSUJYTF9QQVNTVEhST1VHSF9FTkFCTEVEKTsKKwogICAgIC8qIElmIHRhcmdldF9tZW1rYiBp
cyBzbWFsbGVyIHRoYW4gbWF4X21lbWtiLCB0aGUgc3Vic2VxdWVudCBjYWxsCiAgICAgICogdG8g
bGlieGMgd2hlbiBidWlsZGluZyBIVk0gZG9tYWluIHdpbGwgZW5hYmxlIFBvRCBtb2RlLgogICAg
ICAqLwpkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGlieGxfdHlwZXMuaWRsIGIvdG9vbHMvbGli
eGwvbGlieGxfdHlwZXMuaWRsCmluZGV4IDNhYzk0OTRiODAuLjA1NDZkNzg2NWEgMTAwNjQ0Ci0t
LSBhL3Rvb2xzL2xpYnhsL2xpYnhsX3R5cGVzLmlkbAorKysgYi90b29scy9saWJ4bC9saWJ4bF90
eXBlcy5pZGwKQEAgLTI2NCwxMCArMjY0LDExIEBAIGxpYnhsX3ZrYl9iYWNrZW5kID0gRW51bWVy
YXRpb24oInZrYl9iYWNrZW5kIiwgWwogICAgIF0pCiAKIGxpYnhsX3Bhc3N0aHJvdWdoID0gRW51
bWVyYXRpb24oInBhc3N0aHJvdWdoIiwgWwotICAgICgwLCAidW5rbm93biIpLAorICAgICgwLCAi
ZGVmYXVsdCIpLAogICAgICgxLCAiZGlzYWJsZWQiKSwKLSAgICAoMiwgInN5bmNfcHQiKSwKLSAg
ICAoMywgInNoYXJlX3B0IiksCisgICAgKDIsICJlbmFibGVkIiksICMgYmVjb21lcyB7c3luYyxz
aGFyZX1fcHQgb25jZSBkZWZhdWx0cyBhcmUgZXZhbHVhdGVkCisgICAgKDMsICJzeW5jX3B0Iiks
CisgICAgKDQsICJzaGFyZV9wdCIpLAogICAgIF0pCiAKICMKZGlmZiAtLWdpdCBhL3Rvb2xzL2xp
YnhsL2xpYnhsX3g4Ni5jIGIvdG9vbHMvbGlieGwvbGlieGxfeDg2LmMKaW5kZXggYzBmODhhN2Vh
YS4uOGI4MDQ1MzdiYSAxMDA2NDQKLS0tIGEvdG9vbHMvbGlieGwvbGlieGxfeDg2LmMKKysrIGIv
dG9vbHMvbGlieGwvbGlieGxfeDg2LmMKQEAgLTYzMSw2ICs2MzEsNDcgQEAgdm9pZCBsaWJ4bF9f
YXJjaF9kb21haW5fYnVpbGRfaW5mb19zZXRkZWZhdWx0KGxpYnhsX19nYyAqZ2MsCiAgICAgbGli
eGxfZGVmYm9vbF9zZXRkZWZhdWx0KCZiX2luZm8tPmFjcGksIHRydWUpOwogfQogCitpbnQgbGli
eGxfX2FyY2hfcGFzc3Rocm91Z2hfbW9kZV9zZXRkZWZhdWx0KGxpYnhsX19nYyAqZ2MsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90IGRvbWlkLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ4bF9kb21haW5f
Y29uZmlnICpkX2NvbmZpZywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgY29uc3QgbGlieGxfcGh5c2luZm8gKnBoeXNpbmZvKQoreworICAgIGludCByYzsKKyAg
ICBsaWJ4bF9kb21haW5fY3JlYXRlX2luZm8gKmNvbnN0IGNfaW5mbyA9ICZkX2NvbmZpZy0+Y19p
bmZvOworCisgICAgaWYgKGNfaW5mby0+cGFzc3Rocm91Z2ggIT0gTElCWExfUEFTU1RIUk9VR0hf
RElTQUJMRUQgJiYKKyAgICAgICAgY19pbmZvLT50eXBlID09IExJQlhMX0RPTUFJTl9UWVBFX1BW
SCkgeworICAgICAgICBMT0dEKEVSUk9SLCBkb21pZCwKKyAgICAgICAgICAgICAicGFzc3Rocm91
Z2ggbm90IHlldCBzdXBwb3J0ZWQgZm9yIHg4NiBQVkggZ3Vlc3RzXG4iKTsKKyAgICAgICAgcmMg
PSBFUlJPUl9JTlZBTDsKKyAgICAgICAgZ290byBvdXQ7CisgICAgfQorCisgICAgY29uc3QgY2hh
ciAqd2h5bm90X3B0X3NoYXJlID0KKyAgICAgICAgY19pbmZvLT50eXBlID09IExJQlhMX0RPTUFJ
Tl9UWVBFX1BWID8gIm5vdCB2YWxpZCBmb3IgUFYgZG9tYWluIiA6CisgICAgICAgICFwaHlzaW5m
by0+Y2FwX2lvbW11X2hhcF9wdF9zaGFyZSA/ICJub3Qgc3VwcG9ydGVkIG9uIHRoaXMgcGxhdGZv
cm0iIDoKKyAgICAgICAgIWxpYnhsX2RlZmJvb2xfdmFsKGRfY29uZmlnLT5jX2luZm8uaGFwKSA/
Im9ubHkgdmFsaWQgZm9yIEhBUCBndWVzdHMiOgorICAgICAgICBOVUxMOworCisgICAgaWYgKGNf
aW5mby0+cGFzc3Rocm91Z2ggPT0gTElCWExfUEFTU1RIUk9VR0hfRU5BQkxFRCkgeworICAgICAg
ICBjX2luZm8tPnBhc3N0aHJvdWdoID0gd2h5bm90X3B0X3NoYXJlCisgICAgICAgICAgICA/IExJ
QlhMX1BBU1NUSFJPVUdIX1NZTkNfUFQgOiBMSUJYTF9QQVNTVEhST1VHSF9TSEFSRV9QVDsKKyAg
ICB9CisKKyAgICBpZiAoY19pbmZvLT5wYXNzdGhyb3VnaCA9PSBMSUJYTF9QQVNTVEhST1VHSF9T
SEFSRV9QVCAmJiB3aHlub3RfcHRfc2hhcmUpIHsKKyAgICAgICAgTE9HRChFUlJPUiwgZG9taWQs
CisgICAgICAgICAgICAgInBhc3N0aHJvdWdoPVwic2hhcmVfcHRcIiAlc1xuIiwKKyAgICAgICAg
ICAgICB3aHlub3RfcHRfc2hhcmUpOworICAgICAgICByYyA9IEVSUk9SX0lOVkFMOworICAgICAg
ICBnb3RvIG91dDsKKyAgICB9CisKKyAgICByYyA9IDA7Cisgb3V0OgorICAgIHJldHVybiByYzsK
K30KKworCiAvKgogICogTG9jYWwgdmFyaWFibGVzOgogICogbW9kZTogQwpkaWZmIC0tZ2l0IGEv
dG9vbHMveGwveGxfcGFyc2UuYyBiL3Rvb2xzL3hsL3hsX3BhcnNlLmMKaW5kZXggNzk4NzFjMjJk
MC4uMTEyZjhlZTAyNiAxMDA2NDQKLS0tIGEvdG9vbHMveGwveGxfcGFyc2UuYworKysgYi90b29s
cy94bC94bF9wYXJzZS5jCkBAIC0xMjIyLDcgKzEyMjIsNiBAQCB2b2lkIHBhcnNlX2NvbmZpZ19k
YXRhKGNvbnN0IGNoYXIgKmNvbmZpZ19zb3VyY2UsCiAgICAgaW50IHBjaV9zZWl6ZSA9IDA7CiAg
ICAgaW50IGksIGU7CiAgICAgY2hhciAqa2VybmVsX2Jhc2VuYW1lOwotICAgIGJvb2wgaW9tbXVf
ZW5hYmxlZCwgaW9tbXVfaGFwX3B0X3NoYXJlOwogCiAgICAgbGlieGxfZG9tYWluX2NyZWF0ZV9p
bmZvICpjX2luZm8gPSAmZF9jb25maWctPmNfaW5mbzsKICAgICBsaWJ4bF9kb21haW5fYnVpbGRf
aW5mbyAqYl9pbmZvID0gJmRfY29uZmlnLT5iX2luZm87CkBAIC0xMjM0LDggKzEyMzMsNiBAQCB2
b2lkIHBhcnNlX2NvbmZpZ19kYXRhKGNvbnN0IGNoYXIgKmNvbmZpZ19zb3VyY2UsCiAgICAgICAg
IGV4aXQoRVhJVF9GQUlMVVJFKTsKICAgICB9CiAKLSAgICBpb21tdV9lbmFibGVkID0gcGh5c2lu
Zm8uY2FwX2h2bV9kaXJlY3RpbzsKLSAgICBpb21tdV9oYXBfcHRfc2hhcmUgPSBwaHlzaW5mby5j
YXBfaW9tbXVfaGFwX3B0X3NoYXJlOwogICAgIGxpYnhsX3BoeXNpbmZvX2Rpc3Bvc2UoJnBoeXNp
bmZvKTsKIAogICAgIGNvbmZpZz0geGx1X2NmZ19pbml0KHN0ZGVyciwgY29uZmlnX3NvdXJjZSk7
CkBAIC0xNTA5LDY3ICsxNTA2LDEzIEBAIHZvaWQgcGFyc2VfY29uZmlnX2RhdGEoY29uc3QgY2hh
ciAqY29uZmlnX3NvdXJjZSwKICAgICAgICAgfQogICAgIH0KIAotICAgIGlmICh4bHVfY2ZnX2dl
dF9zdHJpbmcoY29uZmlnLCAicGFzc3Rocm91Z2giLCAmYnVmLCAwKSkgewotICAgICAgICBjX2lu
Zm8tPnBhc3N0aHJvdWdoID0KLSAgICAgICAgICAgIChkX2NvbmZpZy0+bnVtX3BjaWRldnMgfHwg
ZF9jb25maWctPm51bV9kdGRldnMpCi0gICAgICAgICAgICA/IExJQlhMX1BBU1NUSFJPVUdIX1VO
S05PV04gOiBMSUJYTF9QQVNTVEhST1VHSF9ESVNBQkxFRDsKLSAgICB9IGVsc2UgewotICAgICAg
ICBpZiAoIXN0cmNhc2VjbXAoImVuYWJsZWQiLCBidWYpKQotICAgICAgICAgICAgY19pbmZvLT5w
YXNzdGhyb3VnaCA9IExJQlhMX1BBU1NUSFJPVUdIX1VOS05PV047Ci0gICAgICAgIGVsc2Ugewot
ICAgICAgICAgICAgbGlieGxfcGFzc3Rocm91Z2ggbzsKLQotICAgICAgICAgICAgZSA9IGxpYnhs
X3Bhc3N0aHJvdWdoX2Zyb21fc3RyaW5nKGJ1ZiwgJm8pOwotICAgICAgICAgICAgaWYgKGUgfHwg
IXN0cmNhc2VjbXAoInVua25vd24iLCBidWYpKSB7Ci0gICAgICAgICAgICAgICAgZnByaW50Zihz
dGRlcnIsCi0gICAgICAgICAgICAgICAgICAgICAgICAiRVJST1I6IHVua25vd24gcGFzc3Rocm91
Z2ggb3B0aW9uICclcydcbiIsCi0gICAgICAgICAgICAgICAgICAgICAgICBidWYpOwotICAgICAg
ICAgICAgICAgIGV4aXQoLUVSUk9SX0ZBSUwpOwotICAgICAgICAgICAgfQotCi0gICAgICAgICAg
ICBjX2luZm8tPnBhc3N0aHJvdWdoID0gbzsKLSAgICAgICAgfQotICAgIH0KLQotICAgIHN3aXRj
aCAoY19pbmZvLT5wYXNzdGhyb3VnaCkgewotICAgIGNhc2UgTElCWExfUEFTU1RIUk9VR0hfVU5L
Tk9XTjoKLSAgICAgICAgLyoKLSAgICAgICAgICogQ2hvb3NlIGEgc3VpdGFibGUgZGVmYXVsdC4g
bGlieGwgd291bGQgYWxzbyBkbyB0aGlzIGJ1dAotICAgICAgICAgKiBjaG9vc2luZyBoZXJlIGFs
bG93cyB0aGUgY29kZSBjYWxjdWxhdGluZyAnaW9tbXVfbWVta2InCi0gICAgICAgICAqIGJlbG93
IG1ha2UgYW4gaW5mb3JtZWQgZGVjaXNpb24uCi0gICAgICAgICAqLwotICAgICAgICBjX2luZm8t
PnBhc3N0aHJvdWdoID0KLSAgICAgICAgICAgIChjX2luZm8tPnR5cGUgPT0gTElCWExfRE9NQUlO
X1RZUEVfUFYpIHx8ICFpb21tdV9oYXBfcHRfc2hhcmUKLSAgICAgICAgICAgID8gTElCWExfUEFT
U1RIUk9VR0hfU1lOQ19QVCA6IExJQlhMX1BBU1NUSFJPVUdIX1NIQVJFX1BUOwotICAgICAgICBi
cmVhazsKLQotICAgIGNhc2UgTElCWExfUEFTU1RIUk9VR0hfRElTQUJMRUQ6Ci0gICAgICAgIGlm
IChkX2NvbmZpZy0+bnVtX3BjaWRldnMgfHwgZF9jb25maWctPm51bV9kdGRldnMpIHsKKyAgICBp
ZiAoIXhsdV9jZmdfZ2V0X3N0cmluZyhjb25maWcsICJwYXNzdGhyb3VnaCIsICZidWYsIDApKSB7
CisgICAgICAgIGlmIChsaWJ4bF9wYXNzdGhyb3VnaF9mcm9tX3N0cmluZyhidWYsICZjX2luZm8t
PnBhc3N0aHJvdWdoKSkgewogICAgICAgICAgICAgZnByaW50ZihzdGRlcnIsCi0gICAgICAgICAg
ICAgICAgICAgICJFUlJPUjogcGFzc3Rocm91Z2ggZGlzYWJsZWQgYnV0IGRldmljZXMgYXJlIHNw
ZWNpZmllZFxuIik7Ci0gICAgICAgICAgICBleGl0KC1FUlJPUl9GQUlMKTsKLSAgICAgICAgfQot
ICAgICAgICBicmVhazsKLSAgICBjYXNlIExJQlhMX1BBU1NUSFJPVUdIX1NIQVJFX1BUOgotICAg
ICAgICBpZiAoY19pbmZvLT50eXBlID09IExJQlhMX0RPTUFJTl9UWVBFX1BWKSB7Ci0gICAgICAg
ICAgICBmcHJpbnRmKHN0ZGVyciwKLSAgICAgICAgICAgICAgICAgICAgIkVSUk9SOiBwYXNzdGhy
b3VnaD1cInNoYXJlX3B0XCIgbm90IHZhbGlkIGZvciBQViBkb21haW5cbiIpOwotICAgICAgICAg
ICAgZXhpdCgtRVJST1JfRkFJTCk7Ci0gICAgICAgIH0gZWxzZSBpZiAoIWlvbW11X2hhcF9wdF9z
aGFyZSkgewotICAgICAgICAgICAgZnByaW50ZihzdGRlcnIsCi0gICAgICAgICAgICAgICAgICAg
ICJFUlJPUjogcGFzc3Rocm91Z2g9XCJzaGFyZV9wdFwiIG5vdCBzdXBwb3J0ZWQgb24gdGhpcyBw
bGF0Zm9ybVxuIik7Ci0gICAgICAgICAgICBleGl0KC1FUlJPUl9GQUlMKTsKKyAgICAgICAgICAg
ICAgICAgICAgIkVSUk9SOiB1bmtub3duIHBhc3N0aHJvdWdoIG9wdGlvbiAnJXMnXG4iLAorICAg
ICAgICAgICAgICAgICAgICBidWYpOworICAgICAgICAgICAgZXhpdCgxKTsKICAgICAgICAgfQot
ICAgICAgICBicmVhazsKLSAgICBjYXNlIExJQlhMX1BBU1NUSFJPVUdIX1NZTkNfUFQ6Ci0gICAg
ICAgIGJyZWFrOwotICAgIH0KLQotICAgIGlmICgoY19pbmZvLT5wYXNzdGhyb3VnaCAhPSBMSUJY
TF9QQVNTVEhST1VHSF9ESVNBQkxFRCkgJiYKLSAgICAgICAgIWlvbW11X2VuYWJsZWQpIHsKLSAg
ICAgICAgZnByaW50ZihzdGRlcnIsCi0gICAgICAgICAgICAgICAgIkVSUk9SOiBwYXNzdGhyb3Vn
aCBub3Qgc3VwcG9ydGVkIG9uIHRoaXMgcGxhdGZvcm1cbiIpOwotICAgICAgICBleGl0KC1FUlJP
Ul9GQUlMKTsKICAgICB9CiAKICAgICBpZiAoIXhsdV9jZmdfZ2V0X2xvbmcoY29uZmlnLCAic2hh
ZG93X21lbW9yeSIsICZsLCAwKSkKLS0gCjIuMTEuMAoKCl9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVs
QGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1h
bi9saXN0aW5mby94ZW4tZGV2ZWw=

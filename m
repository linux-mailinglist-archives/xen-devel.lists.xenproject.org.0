Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 03B5D14DEDB
	for <lists+xen-devel@lfdr.de>; Thu, 30 Jan 2020 17:18:00 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1ixCTX-0005P8-4S; Thu, 30 Jan 2020 16:15:27 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=RwoG=3T=merlin.srs.infradead.org=batv+f9651308fc69d1c188a8+6003+infradead.org+dwmw2@srs-us1.protection.inumbo.net>)
 id 1ixCTV-0005O2-QY
 for xen-devel@lists.xenproject.org; Thu, 30 Jan 2020 16:15:25 +0000
X-Inumbo-ID: 78caeb58-437b-11ea-a933-bc764e2007e4
Received: from merlin.infradead.org (unknown [2001:8b0:10b:1231::1])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 78caeb58-437b-11ea-a933-bc764e2007e4;
 Thu, 30 Jan 2020 16:13:38 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
 d=infradead.org; s=merlin.20170209; h=Sender:Content-Transfer-Encoding:
 MIME-Version:References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:
 Reply-To:Content-Type:Content-ID:Content-Description:Resent-Date:Resent-From:
 Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:List-Id:List-Help:
 List-Unsubscribe:List-Subscribe:List-Post:List-Owner:List-Archive;
 bh=Il/bpITmb6KpASVHrjGn6HaimgeHELl2mWb6bWqwlCo=; b=h9HZ/LhIe1tvrcpCSyBBVpT6Bc
 S8ULnWIUEmGKjEeNkqckCrnXZPNbEza0NmPlyreKAZVLeqP+C3XEGU/6vmHy9egYvdDEtHINCje7k
 d+KSD/7CwD7fbRgLLvzIkYWjfPHtsREX29IHHdJi5Hp/pgrP3OJQORexjkKc1SniY9rfdzxarLRT2
 3y10jaY80FgWK+VTaWs0oCMqjO93y+sShv0YqQHqwnbyCToljBGhCLyZpQ60SALI6uuq1si9pQ6D7
 teEZedP4Sg5NNXK9sYjN8C8b3hLmeD0RzcSW1sVV0UIHCjxeXCzOteZi4HMA6dBrbWlzjX9ckkjbz
 6x2+vgww==;
Received: from i7.infradead.org ([2001:8b0:10b:1:21e:67ff:fecb:7a92])
 by merlin.infradead.org with esmtpsa (Exim 4.92.3 #3 (Red Hat Linux))
 id 1ixCRf-0005Tf-2L; Thu, 30 Jan 2020 16:13:31 +0000
Received: from dwoodhou by i7.infradead.org with local (Exim 4.92 #3 (Red Hat
 Linux)) id 1ixCRe-009kcu-8X; Thu, 30 Jan 2020 16:13:30 +0000
From: David Woodhouse <dwmw2@infradead.org>
To: Xen-devel <xen-devel@lists.xenproject.org>
Date: Thu, 30 Jan 2020 16:13:10 +0000
Message-Id: <20200130161330.2324143-2-dwmw2@infradead.org>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20200130161330.2324143-1-dwmw2@infradead.org>
References: <a92287c03fed310e08ba40063e370038569b94ac.camel@infradead.org>
 <20200130161330.2324143-1-dwmw2@infradead.org>
MIME-Version: 1.0
X-SRS-Rewrite: SMTP reverse-path rewritten from <dwmw2@infradead.org> by
 merlin.infradead.org. See http://www.infradead.org/rpr.html
Subject: [Xen-devel] [RFC PATCH v3 02/22] x86/boot: Reserve live update boot
 memory
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Stefano Stabellini <sstabellini@kernel.org>, Julien Grall <julien@xen.org>,
 Wei Liu <wl@xen.org>, Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>, Varad Gautam <vrd@amazon.de>,
 paul@xen.org, Ian Jackson <ian.jackson@eu.citrix.com>,
 Hongyan Xia <hongyxia@amazon.com>, Amit Shah <aams@amazon.de>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

RnJvbTogRGF2aWQgV29vZGhvdXNlIDxkd213QGFtYXpvbi5jby51az4KCkZvciBsaXZlIHVwZGF0
ZSB0byB3b3JrLCBpdCB3aWxsIG5lZWQgYSByZWdpb24gb2YgbWVtb3J5IHRoYXQgY2FuIGJlCmdp
dmVuIHRvIHRoZSBib290IGFsbG9jYXRvciB3aGlsZSBpdCBwYXJzZXMgdGhlIHN0YXRlIGluZm9y
bWF0aW9uIGZyb20KdGhlIHByZXZpb3VzIFhlbiBhbmQgd29ya3Mgb3V0IHdoaWNoIG9mIHRoZSBv
dGhlciBwYWdlcyBvZiBtZW1vcnkgaXQKY2FuIGNvbnN1bWUuCgpSZXNlcnZlIHRoYXQgbGlrZSB0
aGUgY3Jhc2hkdW1wIHJlZ2lvbiwgYW5kIGFjY2VwdCBpdCBvbiB0aGUgY29tbWFuZApsaW5lLiBV
c2Ugb25seSB0aGF0IHJlZ2lvbiBmb3IgZWFybHkgYm9vdCwgYW5kIHJlZ2lzdGVyIHRoZSByZW1h
aW5pbmcKUkFNIChhbGwgb2YgaXQgZm9yIG5vdywgdW50aWwgdGhlIHJlYWwgbGl2ZSB1cGRhdGUg
aGFwcGVucykgbGF0ZXIuCgpTaWduZWQtb2ZmLWJ5OiBEYXZpZCBXb29kaG91c2UgPGR3bXdAYW1h
em9uLmNvLnVrPgotLS0KIGRvY3MvbWlzYy94ZW4tY29tbWFuZC1saW5lLnBhbmRvYyB8ICAgOSAr
KysKIHhlbi9hcmNoL3g4Ni9zZXR1cC5jICAgICAgICAgICAgICB8IDEyMCArKysrKysrKysrKysr
KysrKysrKysrKysrKysrLS0KIHhlbi9pbmNsdWRlL2FzbS14ODYvY29uZmlnLmggICAgICB8ICAg
MSArCiAzIGZpbGVzIGNoYW5nZWQsIDEyMyBpbnNlcnRpb25zKCspLCA3IGRlbGV0aW9ucygtKQoK
ZGlmZiAtLWdpdCBhL2RvY3MvbWlzYy94ZW4tY29tbWFuZC1saW5lLnBhbmRvYyBiL2RvY3MvbWlz
Yy94ZW4tY29tbWFuZC1saW5lLnBhbmRvYwppbmRleCA1ZWIzYTA3Mjc2Li42MTUyNGYxMDU2IDEw
MDY0NAotLS0gYS9kb2NzL21pc2MveGVuLWNvbW1hbmQtbGluZS5wYW5kb2MKKysrIGIvZG9jcy9t
aXNjL3hlbi1jb21tYW5kLWxpbmUucGFuZG9jCkBAIC0xNDAyLDYgKzE0MDIsMTUgQEAgVGhpcyBv
cHRpb24gaXMgaW50ZW5kZWQgZm9yIGRlYnVnZ2luZyBwdXJwb3NlcyBvbmx5LiAgRW5hYmxlIE1T
Ul9ERUJVR0NUTC5MQlIKIGluIGh5cGVydmlzb3IgY29udGV4dCB0byBiZSBhYmxlIHRvIGR1bXAg
dGhlIExhc3QgSW50ZXJydXB0L0V4Y2VwdGlvbiBUby9Gcm9tCiByZWNvcmQgd2l0aCBvdGhlciBy
ZWdpc3RlcnMuCiAKKyMjIyBsaXZldXBkYXRlCis+IGA9IDxzaXplPltAPG9mZnNldD5dYAorCitT
cGVjaWZ5IHNpemUgYW5kIG9wdGlvbmFsbHkgcGxhY2VtZW50IG9mIHRoZSBib290IG1lbW9yeSBy
ZXNlcnZlZCBmb3IKK1hlbiBsaXZlIHVwZGF0ZS4gVGhlIHNpemUgbXVzdCBiZSBhIG11bHRpcGxl
IG9mIDJNaUIuCisKK0EgdHJhaWxpbmcgYEA8b2Zmc2V0PmAgc3BlY2lmaWVzIHRoZSBleGFjdCBh
ZGRyZXNzIHRoaXMgYXJlYSBzaG91bGQgYmUKK3BsYWNlZCBhdCwgd2hpY2ggbXVzdCBiZSBiZWxv
dyA0R2lCLgorCiAjIyMgbG9nbHZsCiA+IGA9IDxsZXZlbD5bLzxyYXRlLWxpbWl0ZWQgbGV2ZWw+
XWAgd2hlcmUgbGV2ZWwgaXMgYG5vbmUgfCBlcnJvciB8IHdhcm5pbmcgfCBpbmZvIHwgZGVidWcg
fCBhbGxgCiAKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9zZXR1cC5jIGIveGVuL2FyY2gveDg2
L3NldHVwLmMKaW5kZXggMjY3N2YxMjdiOS4uNjNmMDZkNDg1NiAxMDA2NDQKLS0tIGEveGVuL2Fy
Y2gveDg2L3NldHVwLmMKKysrIGIveGVuL2FyY2gveDg2L3NldHVwLmMKQEAgLTY4MSw2ICs2ODEs
NDcgQEAgc3RhdGljIHVuc2lnbmVkIGludCBfX2luaXQgY29weV9iaW9zX2U4MjAoc3RydWN0IGU4
MjBlbnRyeSAqbWFwLCB1bnNpZ25lZCBpbnQgbGkKIC8qIEhvdyBtdWNoIG9mIHRoZSBkaXJlY3Rt
YXAgaXMgcHJlYnVpbHQgYXQgY29tcGlsZSB0aW1lLiAqLwogI2RlZmluZSBQUkVCVUlMVF9NQVBf
TElNSVQgKDEgPDwgTDJfUEFHRVRBQkxFX1NISUZUKQogCit1bnNpZ25lZCBsb25nIGx1X2Jvb3Rt
ZW1fc3RhcnQsIGx1X2Jvb3RtZW1fc2l6ZTsKK3N0YXRpYyB1bnNpZ25lZCBsb25nIGx1X2JyZWFk
Y3J1bWJfcGh5czsKKworc3RhdGljIGludCBfX2luaXQgcGFyc2VfbGl2ZXVwZGF0ZShjb25zdCBj
aGFyICpzdHIpCit7CisgICAgY29uc3QgY2hhciAqY3VyOworCisgICAgbHVfYm9vdG1lbV9zaXpl
ID0gcGFyc2Vfc2l6ZV9hbmRfdW5pdChjdXIgPSBzdHIsICZzdHIpOworICAgIGlmICggIWx1X2Jv
b3RtZW1fc2l6ZSB8fCBjdXIgPT0gc3RyICkKKyAgICAgICAgcmV0dXJuIC1FSU5WQUw7CisKKyAg
ICBpZiAoIGx1X2Jvb3RtZW1fc2l6ZSAmICgoTUIoMikgLSAxKSkgKQorICAgIHsKKyAgICAgICAg
cHJpbnRrKFhFTkxPR19XQVJOSU5HICJMaXZlIHVwZGF0ZSBzaXplIG11c3QgYmUgYSBtdWx0aXBs
ZSBvZiAyTWlCXG4iKTsKKyAgICAgICAgcmV0dXJuIC1FSU5WQUw7CisgICAgfQorCisgICAgaWYg
KCEqc3RyKSB7CisgICAgICAgIHByaW50ayhYRU5MT0dfSU5GTyAiTGl2ZSB1cGRhdGUgc2l6ZSAw
eCVseFxuIiwgbHVfYm9vdG1lbV9zaXplKTsKKyAgICAgICAgcmV0dXJuIDA7CisgICAgfQorCisg
ICAgaWYgKCpzdHIgIT0gJ0AnKQorICAgICAgICByZXR1cm4gLUVJTlZBTDsKKworICAgIGx1X2Jv
b3RtZW1fc3RhcnQgPSBwYXJzZV9zaXplX2FuZF91bml0KGN1ciA9IHN0ciArIDEsICZzdHIpOwor
ICAgIGlmICggIWx1X2Jvb3RtZW1fc3RhcnQgfHwgY3VyID09IHN0ciApCisgICAgICAgIHJldHVy
biAtRUlOVkFMOworCisgICAgcHJpbnRrKFhFTkxPR19JTkZPICJMaXZlIHVwZGF0ZSBhcmVhIDB4
JWx4LTB4JWx4ICgweCVseClcbiIsIGx1X2Jvb3RtZW1fc3RhcnQsCisgICAgICAgICAgIGx1X2Jv
b3RtZW1fc3RhcnQgKyBsdV9ib290bWVtX3NpemUsIGx1X2Jvb3RtZW1fc2l6ZSk7CisKKyAgICAv
KgorICAgICAqIElmIHByZXNlbnQsIHRoZSBicmVhZGNydW1iIGxlYWRpbmcgdG8gdGhlIG1pZ3Jh
dGlvbiBkYXRhIHN0cmVhbSBpcworICAgICAqIGluIHRoZSB2ZXJ5IGJlZ2lubmluZyBvZiB0aGUg
cmVzZXJ2ZWQgYm9vdG1lbSByZWdpb24uCisgICAgICovCisgICAgbHVfYnJlYWRjcnVtYl9waHlz
ID0gbHVfYm9vdG1lbV9zdGFydDsKKyAgICByZXR1cm4gMDsKK30KK2N1c3RvbV9wYXJhbSgibGl2
ZXVwZGF0ZSIsIHBhcnNlX2xpdmV1cGRhdGUpOworCiB2b2lkIF9faW5pdCBub3JldHVybiBfX3N0
YXJ0X3hlbih1bnNpZ25lZCBsb25nIG1iaV9wKQogewogICAgIGNoYXIgKm1lbW1hcF90eXBlID0g
TlVMTDsKQEAgLTY5MCw3ICs3MzEsNyBAQCB2b2lkIF9faW5pdCBub3JldHVybiBfX3N0YXJ0X3hl
bih1bnNpZ25lZCBsb25nIG1iaV9wKQogICAgIG1vZHVsZV90ICptb2Q7CiAgICAgdW5zaWduZWQg
bG9uZyBucl9wYWdlcywgcmF3X21heF9wYWdlLCBtb2R1bGVzX2hlYWRyb29tLCBtb2R1bGVfbWFw
WzFdOwogICAgIGludCBpLCBqLCBlODIwX3dhcm4gPSAwLCBieXRlcyA9IDA7Ci0gICAgYm9vbCBh
Y3BpX2Jvb3RfdGFibGVfaW5pdF9kb25lID0gZmFsc2UsIHJlbG9jYXRlZCA9IGZhbHNlOworICAg
IGJvb2wgYWNwaV9ib290X3RhYmxlX2luaXRfZG9uZSA9IGZhbHNlLCByZWxvY2F0ZWQgPSBmYWxz
ZSwgbHVfcmVzZXJ2ZWQgPSBmYWxzZTsKICAgICBpbnQgcmV0OwogICAgIHN0cnVjdCBuczE2NTUw
X2RlZmF1bHRzIG5zMTY1NTAgPSB7CiAgICAgICAgIC5kYXRhX2JpdHMgPSA4LApAQCAtOTgwLDYg
KzEwMjEsMjIgQEAgdm9pZCBfX2luaXQgbm9yZXR1cm4gX19zdGFydF94ZW4odW5zaWduZWQgbG9u
ZyBtYmlfcCkKICAgICBzZXRfa2V4ZWNfY3Jhc2hfYXJlYV9zaXplKCh1NjQpbnJfcGFnZXMgPDwg
UEFHRV9TSElGVCk7CiAgICAga2V4ZWNfcmVzZXJ2ZV9hcmVhKCZib290X2U4MjApOwogCisgICAg
aWYgKCBsdV9ib290bWVtX3N0YXJ0ICkKKyAgICB7CisgICAgICAgIC8qIFhYOiBDaGVjayBpdCdz
IGluIHVzYWJsZSBtZW1vcnkgZmlyc3QgKi8KKyAgICAgICAgcmVzZXJ2ZV9lODIwX3JhbSgmYm9v
dF9lODIwLCBsdV9ib290bWVtX3N0YXJ0LCBsdV9ib290bWVtX3N0YXJ0ICsgbHVfYm9vdG1lbV9z
aXplKTsKKworICAgICAgICAvKiBTaW5jZSBpdCB3aWxsIGFscmVhZHkgYmUgb3V0IG9mIHRoZSBl
ODIwIG1hcCBieSB0aGUgdGltZSB0aGUgZmlyc3QKKyAgICAgICAgICogbG9vcCBvdmVyIHBoeXNp
Y2FsIG1lbW9yeSwgbWFwIGl0IG1hbnVhbGx5IGFscmVhZHkuICovCisgICAgICAgIHNldF9wZHhf
cmFuZ2UobHVfYm9vdG1lbV9zdGFydCA+PiBQQUdFX1NISUZULAorICAgICAgICAgICAgICAgICAg
ICAgIChsdV9ib290bWVtX3N0YXJ0ICsgbHVfYm9vdG1lbV9zaXplKSA+PiBQQUdFX1NISUZUKTsK
KyAgICAgICAgbWFwX3BhZ2VzX3RvX3hlbigodW5zaWduZWQgbG9uZylfX3ZhKGx1X2Jvb3RtZW1f
c3RhcnQpLAorICAgICAgICAgICAgICAgICAgICAgICAgIG1hZGRyX3RvX21mbihsdV9ib290bWVt
X3N0YXJ0KSwKKyAgICAgICAgICAgICAgICAgICAgICAgICBQRk5fRE9XTihsdV9ib290bWVtX3Np
emUpLCBQQUdFX0hZUEVSVklTT1IpOworCisgICAgICAgIGx1X3Jlc2VydmVkID0gdHJ1ZTsKKyAg
ICB9CisKICAgICBpbml0aWFsX2ltYWdlcyA9IG1vZDsKICAgICBucl9pbml0aWFsX2ltYWdlcyA9
IG1iaS0+bW9kc19jb3VudDsKIApAQCAtMTIwNyw2ICsxMjY0LDE2IEBAIHZvaWQgX19pbml0IG5v
cmV0dXJuIF9fc3RhcnRfeGVuKHVuc2lnbmVkIGxvbmcgbWJpX3ApCiAgICAgICAgICAgICBwcmlu
dGsoIk5ldyBYZW4gaW1hZ2UgYmFzZSBhZGRyZXNzOiAlI2x4XG4iLCB4ZW5fcGh5c19zdGFydCk7
CiAgICAgICAgIH0KIAorICAgICAgICAvKiBJcyB0aGUgcmVnaW9uIHN1aXRhYmxlIGZvciB0aGUg
bGl2ZSB1cGRhdGUgYm9vdG1lbSByZWdpb24/ICovCisgICAgICAgIGlmICggbHVfYm9vdG1lbV9z
aXplICYmICEgbHVfYm9vdG1lbV9zdGFydCAmJiBlIDwgbGltaXQgKQorICAgICAgICB7CisgICAg
ICAgICAgICBlbmQgPSBjb25zaWRlcl9tb2R1bGVzKHMsIGUsIGx1X2Jvb3RtZW1fc2l6ZSwgbW9k
LCBtYmktPm1vZHNfY291bnQgKyByZWxvY2F0ZWQsIC0xKTsKKyAgICAgICAgICAgIGlmICggZW5k
ICkKKyAgICAgICAgICAgIHsKKyAgICAgICAgICAgICAgICBlID0gbHVfYm9vdG1lbV9zdGFydCA9
IGVuZCAtIGx1X2Jvb3RtZW1fc2l6ZTsKKyAgICAgICAgICAgIH0KKyAgICAgICAgfQorCiAgICAg
ICAgIC8qIElzIHRoZSByZWdpb24gc3VpdGFibGUgZm9yIHJlbG9jYXRpbmcgdGhlIG11bHRpYm9v
dCBtb2R1bGVzPyAqLwogICAgICAgICBmb3IgKCBqID0gbWJpLT5tb2RzX2NvdW50IC0gMTsgaiA+
PSAwOyBqLS0gKQogICAgICAgICB7CkBAIC0xMjcwLDYgKzEzMzcsMTUgQEAgdm9pZCBfX2luaXQg
bm9yZXR1cm4gX19zdGFydF94ZW4odW5zaWduZWQgbG9uZyBtYmlfcCkKICAgICBpZiAoICF4ZW5f
cGh5c19zdGFydCApCiAgICAgICAgIHBhbmljKCJOb3QgZW5vdWdoIG1lbW9yeSB0byByZWxvY2F0
ZSBYZW5cbiIpOwogCisgICAgaWYgKCBsdV9ib290bWVtX3N0YXJ0ICkKKyAgICB7CisgICAgICAg
IGlmICggIWx1X3Jlc2VydmVkICkKKyAgICAgICAgICAgIHJlc2VydmVfZTgyMF9yYW0oJmJvb3Rf
ZTgyMCwgbHVfYm9vdG1lbV9zdGFydCwgbHVfYm9vdG1lbV9zdGFydCArIGx1X2Jvb3RtZW1fc2l6
ZSk7CisgICAgICAgIHByaW50aygiTFUgYm9vdG1lbTogMHglbHggLSAweCVseFxuIiwgbHVfYm9v
dG1lbV9zdGFydCwgbHVfYm9vdG1lbV9zdGFydCArIGx1X2Jvb3RtZW1fc2l6ZSk7CisgICAgICAg
IGluaXRfYm9vdF9wYWdlcyhsdV9ib290bWVtX3N0YXJ0LCBsdV9ib290bWVtX3N0YXJ0ICsgbHVf
Ym9vdG1lbV9zaXplKTsKKyAgICAgICAgbHVfcmVzZXJ2ZWQgPSB0cnVlOworICAgIH0KKwogICAg
IC8qIFRoaXMgbmVlZHMgdG8gcmVtYWluIGluIHN5bmMgd2l0aCB4ZW5faW5fcmFuZ2UoKS4gKi8K
ICAgICByZXNlcnZlX2U4MjBfcmFtKCZib290X2U4MjAsIF9fcGEoX3N0ZXh0KSwgX19wYShfXzJN
X3J3ZGF0YV9lbmQpKTsKIApAQCAtMTI4MSw4ICsxMzU3LDggQEAgdm9pZCBfX2luaXQgbm9yZXR1
cm4gX19zdGFydF94ZW4odW5zaWduZWQgbG9uZyBtYmlfcCkKICAgICAgICAgeGVuaGVhcF9tYXhf
bWZuKFBGTl9ET1dOKGhpZ2htZW1fc3RhcnQgLSAxKSk7CiAKICAgICAvKgotICAgICAqIFdhbGsg
ZXZlcnkgUkFNIHJlZ2lvbiBhbmQgbWFwIGl0IGluIGl0cyBlbnRpcmV0eSAob24geDg2LzY0LCBh
dCBsZWFzdCkKLSAgICAgKiBhbmQgbm90aWZ5IGl0IHRvIHRoZSBib290IGFsbG9jYXRvci4KKyAg
ICAgKiBXYWxrIGV2ZXJ5IFJBTSByZWdpb24gYW5kIG1hcCBpdCBpbiBpdHMgZW50aXJldHkgYW5k
ICh1bmxlc3MgaW4KKyAgICAgKiBsaXZlIHVwZGF0ZSBtb2RlKSBub3RpZnkgaXQgdG8gdGhlIGJv
b3QgYWxsb2NhdG9yLgogICAgICAqLwogICAgIGZvciAoIGkgPSAwOyBpIDwgYm9vdF9lODIwLm5y
X21hcDsgaSsrICkKICAgICB7CkBAIC0xMzM1LDYgKzE0MTEsNyBAQCB2b2lkIF9faW5pdCBub3Jl
dHVybiBfX3N0YXJ0X3hlbih1bnNpZ25lZCBsb25nIG1iaV9wKQogICAgICAgICAgICAgICAgIHBy
aW50ayhYRU5MT0dfV0FSTklORyAiSWdub3JpbmcgaW5hY2Nlc3NpYmxlIG1lbW9yeSByYW5nZSIK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiAlMDEzIlBSSXg2NCItJTAx
MyJQUkl4NjQiXG4iLAogICAgICAgICAgICAgICAgICAgICAgICBzLCBlKTsKKyAgICAgICAgICAg
ICAgICByZXNlcnZlX2U4MjBfcmFtKCZib290X2U4MjAsIHMsIGUpOwogICAgICAgICAgICAgICAg
IGNvbnRpbnVlOwogICAgICAgICAgICAgfQogICAgICAgICAgICAgbWFwX2UgPSBlOwpAQCAtMTM0
Miw2ICsxNDE5LDcgQEAgdm9pZCBfX2luaXQgbm9yZXR1cm4gX19zdGFydF94ZW4odW5zaWduZWQg
bG9uZyBtYmlfcCkKICAgICAgICAgICAgIHByaW50ayhYRU5MT0dfV0FSTklORyAiSWdub3Jpbmcg
aW5hY2Nlc3NpYmxlIG1lbW9yeSByYW5nZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAiICUwMTMiUFJJeDY0Ii0lMDEzIlBSSXg2NCJcbiIsCiAgICAgICAgICAgICAgICAgICAg
ZSwgbWFwX2UpOworICAgICAgICAgICAgcmVzZXJ2ZV9lODIwX3JhbSgmYm9vdF9lODIwLCBlLCBt
YXBfZSk7CiAgICAgICAgIH0KIAogICAgICAgICBzZXRfcGR4X3JhbmdlKHMgPj4gUEFHRV9TSElG
VCwgZSA+PiBQQUdFX1NISUZUKTsKQEAgLTEzNTIsNyArMTQzMCw5IEBAIHZvaWQgX19pbml0IG5v
cmV0dXJuIF9fc3RhcnRfeGVuKHVuc2lnbmVkIGxvbmcgbWJpX3ApCiAgICAgICAgICAgICAgICAg
ICAgICAgQVJSQVlfU0laRShsMl9kaXJlY3RtYXApIDw8IEwyX1BBR0VUQUJMRV9TSElGVCk7CiAK
ICAgICAgICAgLyogUGFzcyBtYXBwZWQgbWVtb3J5IHRvIGFsbG9jYXRvciAvYmVmb3JlLyBjcmVh
dGluZyBuZXcgbWFwcGluZ3MuICovCi0gICAgICAgIGluaXRfYm9vdF9wYWdlcyhzLCBtaW4obWFw
X3MsIGUpKTsKKyAgICAgICAgaWYgKCAhbHVfcmVzZXJ2ZWQpCisgICAgICAgICAgICBpbml0X2Jv
b3RfcGFnZXMocywgbWluKG1hcF9zLCBlKSk7CisKICAgICAgICAgcyA9IG1hcF9zOwogICAgICAg
ICBpZiAoIHMgPCBtYXBfZSApCiAgICAgICAgIHsKQEAgLTEzNjAsNyArMTQ0MCw4IEBAIHZvaWQg
X19pbml0IG5vcmV0dXJuIF9fc3RhcnRfeGVuKHVuc2lnbmVkIGxvbmcgbWJpX3ApCiAKICAgICAg
ICAgICAgIG1hcF9zID0gKHMgKyBtYXNrKSAmIH5tYXNrOwogICAgICAgICAgICAgbWFwX2UgJj0g
fm1hc2s7Ci0gICAgICAgICAgICBpbml0X2Jvb3RfcGFnZXMobWFwX3MsIG1hcF9lKTsKKyAgICAg
ICAgICAgIGlmICggIWx1X3Jlc2VydmVkKQorICAgICAgICAgICAgICAgIGluaXRfYm9vdF9wYWdl
cyhtYXBfcywgbWFwX2UpOwogICAgICAgICB9CiAKICAgICAgICAgaWYgKCBtYXBfcyA+IG1hcF9l
ICkKQEAgLTEzNzYsNyArMTQ1Nyw4IEBAIHZvaWQgX19pbml0IG5vcmV0dXJuIF9fc3RhcnRfeGVu
KHVuc2lnbmVkIGxvbmcgbWJpX3ApCiAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgbWFw
X3BhZ2VzX3RvX3hlbigodW5zaWduZWQgbG9uZylfX3ZhKG1hcF9lKSwgbWFkZHJfdG9fbWZuKG1h
cF9lKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBGTl9ET1dOKGVuZCAtIG1h
cF9lKSwgUEFHRV9IWVBFUlZJU09SKTsKLSAgICAgICAgICAgICAgICBpbml0X2Jvb3RfcGFnZXMo
bWFwX2UsIGVuZCk7CisgICAgICAgICAgICAgICAgaWYgKCAhbHVfcmVzZXJ2ZWQpCisgICAgICAg
ICAgICAgICAgICAgIGluaXRfYm9vdF9wYWdlcyhtYXBfZSwgZW5kKTsKICAgICAgICAgICAgICAg
ICBtYXBfZSA9IGVuZDsKICAgICAgICAgICAgIH0KICAgICAgICAgfQpAQCAtMTM5MSw3ICsxNDcz
LDggQEAgdm9pZCBfX2luaXQgbm9yZXR1cm4gX19zdGFydF94ZW4odW5zaWduZWQgbG9uZyBtYmlf
cCkKICAgICAgICAgewogICAgICAgICAgICAgbWFwX3BhZ2VzX3RvX3hlbigodW5zaWduZWQgbG9u
ZylfX3ZhKHMpLCBtYWRkcl90b19tZm4ocyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IFBGTl9ET1dOKG1hcF9zIC0gcyksIFBBR0VfSFlQRVJWSVNPUik7Ci0gICAgICAgICAgICBpbml0
X2Jvb3RfcGFnZXMocywgbWFwX3MpOworICAgICAgICAgICAgaWYgKCAhbHVfcmVzZXJ2ZWQpCisg
ICAgICAgICAgICAgICAgaW5pdF9ib290X3BhZ2VzKHMsIG1hcF9zKTsKICAgICAgICAgfQogICAg
IH0KIApAQCAtMTQ4OSw2ICsxNTcyLDI5IEBAIHZvaWQgX19pbml0IG5vcmV0dXJuIF9fc3RhcnRf
eGVuKHVuc2lnbmVkIGxvbmcgbWJpX3ApCiAKICAgICBudW1hX2luaXRtZW1faW5pdCgwLCByYXdf
bWF4X3BhZ2UpOwogCisgICAgaWYgKCBsdV9ib290bWVtX3N0YXJ0ICkKKyAgICB7CisgICAgICAg
IHVuc2lnbmVkIGxvbmcgbGltaXQgPSB2aXJ0X3RvX21mbihIWVBFUlZJU09SX1ZJUlRfRU5EIC0g
MSk7CisgICAgICAgIHVpbnQ2NF90IG1hc2sgPSBQQUdFX1NJWkUgLSAxOworCisgICAgICAgIGZv
ciAoIGkgPSAwOyBpIDwgYm9vdF9lODIwLm5yX21hcDsgaSsrICkKKyAgICAgICAgeworICAgICAg
ICAgICAgdWludDY0X3QgcywgZTsKKworICAgICAgICAgICAgaWYgKCBib290X2U4MjAubWFwW2ld
LnR5cGUgIT0gRTgyMF9SQU0gKQorICAgICAgICAgICAgICAgIGNvbnRpbnVlOworICAgICAgICAg
ICAgcyA9IChib290X2U4MjAubWFwW2ldLmFkZHIgKyBtYXNrKSAmIH5tYXNrOworICAgICAgICAg
ICAgZSA9IChib290X2U4MjAubWFwW2ldLmFkZHIgKyBib290X2U4MjAubWFwW2ldLnNpemUpICYg
fm1hc2s7CisgICAgICAgICAgICBzID0gbWF4X3QodWludDY0X3QsIHMsIDE8PDIwKTsKKyAgICAg
ICAgICAgIGlmICggUEZOX0RPV04ocykgPiBsaW1pdCApCisgICAgICAgICAgICAgICAgY29udGlu
dWU7CisgICAgICAgICAgICBpZiAoIFBGTl9ET1dOKGUpID4gbGltaXQgKQorICAgICAgICAgICAg
ICAgIGUgPSBwZm5fdG9fcGFkZHIobGltaXQpOworCisgICAgICAgICAgICBpbml0X2Jvb3RfcGFn
ZXMocywgZSk7CisgICAgICAgIH0KKyAgICB9CisKICAgICBpZiAoIG1heF9wYWdlIC0gMSA+IHZp
cnRfdG9fbWZuKEhZUEVSVklTT1JfVklSVF9FTkQgLSAxKSApCiAgICAgewogICAgICAgICB1bnNp
Z25lZCBsb25nIGxpbWl0ID0gdmlydF90b19tZm4oSFlQRVJWSVNPUl9WSVJUX0VORCAtIDEpOwpk
aWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUvYXNtLXg4Ni9jb25maWcuaCBiL3hlbi9pbmNsdWRlL2Fz
bS14ODYvY29uZmlnLmgKaW5kZXggZDBjZmJiNzBhOC4uZDU5ZTUxMDFjMyAxMDA2NDQKLS0tIGEv
eGVuL2luY2x1ZGUvYXNtLXg4Ni9jb25maWcuaAorKysgYi94ZW4vaW5jbHVkZS9hc20teDg2L2Nv
bmZpZy5oCkBAIC0yNzksNiArMjc5LDcgQEAgZXh0ZXJuIHVuc2lnbmVkIGNoYXIgYm9vdF9lZGlk
X2luZm9bMTI4XTsKIAogI2lmbmRlZiBfX0FTU0VNQkxZX18KIGV4dGVybiB1bnNpZ25lZCBsb25n
IHhlbl9waHlzX3N0YXJ0OworZXh0ZXJuIHVuc2lnbmVkIGxvbmcgbHVfYm9vdG1lbV9zdGFydCwg
bHVfYm9vdG1lbV9zaXplOwogI2VuZGlmCiAKIC8qIEdEVC9MRFQgc2hhZG93IG1hcHBpbmcgYXJl
YS4gVGhlIGZpcnN0IHBlci1kb21haW4tbWFwcGluZyBzdWItYXJlYS4gKi8KLS0gCjIuMjEuMAoK
Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZl
bCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlz
dHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 92DF42C481
	for <lists+xen-devel@lfdr.de>; Tue, 28 May 2019 12:37:00 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hVZRM-0007Ht-NL; Tue, 28 May 2019 10:34:44 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=31/0=T4=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1hVZQI-00050k-2W
 for xen-devel@lists.xenproject.org; Tue, 28 May 2019 10:33:38 +0000
X-Inumbo-ID: 0a3a5ca3-8134-11e9-8980-bc764e045a96
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 0a3a5ca3-8134-11e9-8980-bc764e045a96;
 Tue, 28 May 2019 10:33:32 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id CEB6BB0AE;
 Tue, 28 May 2019 10:33:31 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Tue, 28 May 2019 12:33:12 +0200
Message-Id: <20190528103313.1343-60-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190528103313.1343-1-jgross@suse.com>
References: <20190528103313.1343-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH 59/60] xen/sched: support core scheduling for
 moving cpus to/from cpupools
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Tim Deegan <tim@xen.org>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Dario Faggioli <dfaggioli@suse.com>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

V2l0aCBjb3JlIHNjaGVkdWxpbmcgYWN0aXZlIGl0IGlzIG5lY2Vzc2FyeSB0byBtb3ZlIG11bHRp
cGxlIGNwdXMgYXQKdGhlIHNhbWUgdGltZSB0byBvciBmcm9tIGEgY3B1cG9vbCBpbiBvcmRlciB0
byBhdm9pZCBzcGxpdCBzY2hlZHVsaW5nCnJlc291cmNlcyBpbiBiZXR3ZWVuLgoKU2lnbmVkLW9m
Zi1ieTogSnVlcmdlbiBHcm9zcyA8amdyb3NzQHN1c2UuY29tPgotLS0KVjE6IG5ldyBwYXRjaAot
LS0KIHhlbi9jb21tb24vY3B1cG9vbC5jICAgICAgIHwgODcgKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKystLS0tLS0tLS0tLQogeGVuL2NvbW1vbi9zY2hlZHVsZS5jICAgICAgfCAg
MyArLQogeGVuL2luY2x1ZGUveGVuL3NjaGVkLWlmLmggfCAgMSArCiAzIGZpbGVzIGNoYW5nZWQs
IDY4IGluc2VydGlvbnMoKyksIDIzIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3hlbi9jb21t
b24vY3B1cG9vbC5jIGIveGVuL2NvbW1vbi9jcHVwb29sLmMKaW5kZXggZWM4MTEyNDE4Mi4uNGRh
YzdkZWRjYSAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9jcHVwb29sLmMKKysrIGIveGVuL2NvbW1v
bi9jcHVwb29sLmMKQEAgLTI2NSwyMyArMjY1LDMwIEBAIHN0YXRpYyBpbnQgY3B1cG9vbF9hc3Np
Z25fY3B1X2xvY2tlZChzdHJ1Y3QgY3B1cG9vbCAqYywgdW5zaWduZWQgaW50IGNwdSkKIHsKICAg
ICBpbnQgcmV0OwogICAgIHN0cnVjdCBkb21haW4gKmQ7CisgICAgY29uc3QgY3B1bWFza190ICpj
cHVzOworCisgICAgY3B1cyA9IHNjaGVkX2dldF9vcHRfY3B1bWFzayhjLT5vcHRfZ3JhbnVsYXJp
dHksIGNwdSk7CiAKICAgICBpZiAoIChjcHVwb29sX21vdmluZ19jcHUgPT0gY3B1KSAmJiAoYyAh
PSBjcHVwb29sX2NwdV9tb3ZpbmcpICkKICAgICAgICAgcmV0dXJuIC1FQUREUk5PVEFWQUlMOwot
ICAgIHJldCA9IHNjaGVkdWxlX2NwdV9hZGQoY3B1LCBjKTsKKyAgICByZXQgPSBzY2hlZHVsZV9j
cHVfYWRkKGNwdW1hc2tfZmlyc3QoY3B1cyksIGMpOwogICAgIGlmICggcmV0ICkKICAgICAgICAg
cmV0dXJuIHJldDsKIAotICAgIGNwdW1hc2tfY2xlYXJfY3B1KGNwdSwgJmNwdXBvb2xfZnJlZV9j
cHVzKTsKKyAgICByY3VfcmVhZF9sb2NrKCZzY2hlZF9yZXNfcmN1bG9jayk7CisKKyAgICBjcHVt
YXNrX2FuZG5vdCgmY3B1cG9vbF9mcmVlX2NwdXMsICZjcHVwb29sX2ZyZWVfY3B1cywgY3B1cyk7
CiAgICAgaWYgKGNwdXBvb2xfbW92aW5nX2NwdSA9PSBjcHUpCiAgICAgewogICAgICAgICBjcHVw
b29sX21vdmluZ19jcHUgPSAtMTsKICAgICAgICAgY3B1cG9vbF9wdXQoY3B1cG9vbF9jcHVfbW92
aW5nKTsKICAgICAgICAgY3B1cG9vbF9jcHVfbW92aW5nID0gTlVMTDsKICAgICB9Ci0gICAgY3B1
bWFza19zZXRfY3B1KGNwdSwgYy0+Y3B1X3ZhbGlkKTsKKyAgICBjcHVtYXNrX29yKGMtPmNwdV92
YWxpZCwgYy0+Y3B1X3ZhbGlkLCBjcHVzKTsKICAgICBjcHVtYXNrX2FuZChjLT5yZXNfdmFsaWQs
IGMtPmNwdV92YWxpZCwgc2NoZWRfcmVzX21hc2spOwogCisgICAgcmN1X3JlYWRfdW5sb2NrKCZz
Y2hlZF9yZXNfcmN1bG9jayk7CisKICAgICByY3VfcmVhZF9sb2NrKCZkb21saXN0X3JlYWRfbG9j
ayk7CiAgICAgZm9yX2VhY2hfZG9tYWluX2luX2NwdXBvb2woZCwgYykKICAgICB7CkBAIC0yOTUs
NiArMzAyLDcgQEAgc3RhdGljIGludCBjcHVwb29sX2Fzc2lnbl9jcHVfbG9ja2VkKHN0cnVjdCBj
cHVwb29sICpjLCB1bnNpZ25lZCBpbnQgY3B1KQogc3RhdGljIGludCBjcHVwb29sX3VuYXNzaWdu
X2NwdV9lcGlsb2d1ZShzdHJ1Y3QgY3B1cG9vbCAqYykKIHsKICAgICBpbnQgY3B1ID0gY3B1cG9v
bF9tb3ZpbmdfY3B1OworICAgIGNvbnN0IGNwdW1hc2tfdCAqY3B1czsKICAgICBzdHJ1Y3QgZG9t
YWluICpkOwogICAgIGludCByZXQ7CiAKQEAgLTMwNyw3ICszMTUsMTAgQEAgc3RhdGljIGludCBj
cHVwb29sX3VuYXNzaWduX2NwdV9lcGlsb2d1ZShzdHJ1Y3QgY3B1cG9vbCAqYykKICAgICAgKi8K
ICAgICByY3VfcmVhZF9sb2NrKCZkb21saXN0X3JlYWRfbG9jayk7CiAgICAgcmV0ID0gY3B1X2Rp
c2FibGVfc2NoZWR1bGVyKGNwdSk7Ci0gICAgY3B1bWFza19zZXRfY3B1KGNwdSwgJmNwdXBvb2xf
ZnJlZV9jcHVzKTsKKworICAgIHJjdV9yZWFkX2xvY2soJnNjaGVkX3Jlc19yY3Vsb2NrKTsKKyAg
ICBjcHVzID0gZ2V0X3NjaGVkX3JlcyhjcHUpLT5jcHVzOworICAgIGNwdW1hc2tfb3IoJmNwdXBv
b2xfZnJlZV9jcHVzLCAmY3B1cG9vbF9mcmVlX2NwdXMsIGNwdXMpOwogCiAgICAgLyoKICAgICAg
KiBjcHVfZGlzYWJsZV9zY2hlZHVsZXIoKSByZXR1cm5pbmcgYW4gZXJyb3IgZG9lc24ndCByZXF1
aXJlIHJlc2V0dGluZwpAQCAtMzIwLDcgKzMzMSw3IEBAIHN0YXRpYyBpbnQgY3B1cG9vbF91bmFz
c2lnbl9jcHVfZXBpbG9ndWUoc3RydWN0IGNwdXBvb2wgKmMpCiAgICAgewogICAgICAgICByZXQg
PSBzY2hlZHVsZV9jcHVfcm0oY3B1KTsKICAgICAgICAgaWYgKCByZXQgKQotICAgICAgICAgICAg
Y3B1bWFza19jbGVhcl9jcHUoY3B1LCAmY3B1cG9vbF9mcmVlX2NwdXMpOworICAgICAgICAgICAg
Y3B1bWFza19hbmRub3QoJmNwdXBvb2xfZnJlZV9jcHVzLCAmY3B1cG9vbF9mcmVlX2NwdXMsIGNw
dXMpOwogICAgICAgICBlbHNlCiAgICAgICAgIHsKICAgICAgICAgICAgIGNwdXBvb2xfbW92aW5n
X2NwdSA9IC0xOwpAQCAtMzI4LDYgKzMzOSw3IEBAIHN0YXRpYyBpbnQgY3B1cG9vbF91bmFzc2ln
bl9jcHVfZXBpbG9ndWUoc3RydWN0IGNwdXBvb2wgKmMpCiAgICAgICAgICAgICBjcHVwb29sX2Nw
dV9tb3ZpbmcgPSBOVUxMOwogICAgICAgICB9CiAgICAgfQorICAgIHJjdV9yZWFkX3VubG9jaygm
ZG9tbGlzdF9yZWFkX2xvY2spOwogCiAgICAgZm9yX2VhY2hfZG9tYWluX2luX2NwdXBvb2woZCwg
YykKICAgICB7CkBAIC0zNDIsNiArMzU0LDcgQEAgc3RhdGljIGludCBjcHVwb29sX3VuYXNzaWdu
X2NwdV9wcm9sb2d1ZShzdHJ1Y3QgY3B1cG9vbCAqYywgdW5zaWduZWQgaW50IGNwdSkKIHsKICAg
ICBpbnQgcmV0OwogICAgIHN0cnVjdCBkb21haW4gKmQ7CisgICAgY29uc3QgY3B1bWFza190ICpj
cHVzOwogCiAgICAgc3Bpbl9sb2NrKCZjcHVwb29sX2xvY2spOwogICAgIHJldCA9IC1FQUREUk5P
VEFWQUlMOwpAQCAtMzUyLDcgKzM2NSwxMSBAQCBzdGF0aWMgaW50IGNwdXBvb2xfdW5hc3NpZ25f
Y3B1X3Byb2xvZ3VlKHN0cnVjdCBjcHVwb29sICpjLCB1bnNpZ25lZCBpbnQgY3B1KQogICAgIGlm
ICggIWNwdW1hc2tfdGVzdF9jcHUoY3B1LCBjLT5jcHVfdmFsaWQpICYmIChjcHUgIT0gY3B1cG9v
bF9tb3ZpbmdfY3B1KSApCiAgICAgICAgIGdvdG8gb3V0OwogCi0gICAgaWYgKCAoYy0+bl9kb20g
PiAwKSAmJiAoY3B1bWFza193ZWlnaHQoYy0+Y3B1X3ZhbGlkKSA9PSAxKSAmJgorICAgIHJjdV9y
ZWFkX2xvY2soJnNjaGVkX3Jlc19yY3Vsb2NrKTsKKyAgICBjcHVzID0gZ2V0X3NjaGVkX3Jlcyhj
cHUpLT5jcHVzOworCisgICAgaWYgKCAoYy0+bl9kb20gPiAwKSAmJgorICAgICAgICAgKGNwdW1h
c2tfd2VpZ2h0KGMtPmNwdV92YWxpZCkgPT0gY3B1bWFza193ZWlnaHQoY3B1cykpICYmCiAgICAg
ICAgICAoY3B1ICE9IGNwdXBvb2xfbW92aW5nX2NwdSkgKQogICAgIHsKICAgICAgICAgcmN1X3Jl
YWRfbG9jaygmZG9tbGlzdF9yZWFkX2xvY2spOwpAQCAtMzc0LDkgKzM5MSwxMCBAQCBzdGF0aWMg
aW50IGNwdXBvb2xfdW5hc3NpZ25fY3B1X3Byb2xvZ3VlKHN0cnVjdCBjcHVwb29sICpjLCB1bnNp
Z25lZCBpbnQgY3B1KQogICAgIGNwdXBvb2xfbW92aW5nX2NwdSA9IGNwdTsKICAgICBhdG9taWNf
aW5jKCZjLT5yZWZjbnQpOwogICAgIGNwdXBvb2xfY3B1X21vdmluZyA9IGM7Ci0gICAgY3B1bWFz
a19jbGVhcl9jcHUoY3B1LCBjLT5jcHVfdmFsaWQpOworICAgIGNwdW1hc2tfYW5kbm90KGMtPmNw
dV92YWxpZCwgYy0+Y3B1X3ZhbGlkLCBjcHVzKTsKICAgICBjcHVtYXNrX2FuZChjLT5yZXNfdmFs
aWQsIGMtPmNwdV92YWxpZCwgc2NoZWRfcmVzX21hc2spOwogCisgICAgcmN1X3JlYWRfdW5sb2Nr
KCZkb21saXN0X3JlYWRfbG9jayk7CiBvdXQ6CiAgICAgc3Bpbl91bmxvY2soJmNwdXBvb2xfbG9j
ayk7CiAKQEAgLTQyOCwxMiArNDQ2LDEyIEBAIHN0YXRpYyBpbnQgY3B1cG9vbF91bmFzc2lnbl9j
cHUoc3RydWN0IGNwdXBvb2wgKmMsIHVuc2lnbmVkIGludCBjcHUpCiAgICAgICAgIHJldHVybiBy
ZXQ7CiAgICAgfQogCi0gICAgd29ya19jcHUgPSBzbXBfcHJvY2Vzc29yX2lkKCk7CisgICAgd29y
a19jcHUgPSBzY2hlZF9nZXRfcmVzb3VyY2VfY3B1KHNtcF9wcm9jZXNzb3JfaWQoKSk7CiAgICAg
aWYgKCB3b3JrX2NwdSA9PSBjcHUgKQogICAgIHsKICAgICAgICAgd29ya19jcHUgPSBjcHVtYXNr
X2ZpcnN0KGNwdXBvb2wwLT5jcHVfdmFsaWQpOwogICAgICAgICBpZiAoIHdvcmtfY3B1ID09IGNw
dSApCi0gICAgICAgICAgICB3b3JrX2NwdSA9IGNwdW1hc2tfbmV4dChjcHUsIGNwdXBvb2wwLT5j
cHVfdmFsaWQpOworICAgICAgICAgICAgd29ya19jcHUgPSBjcHVtYXNrX2xhc3QoY3B1cG9vbDAt
PmNwdV92YWxpZCk7CiAgICAgfQogICAgIHJldHVybiBjb250aW51ZV9oeXBlcmNhbGxfb25fY3B1
KHdvcmtfY3B1LCBjcHVwb29sX3VuYXNzaWduX2NwdV9oZWxwZXIsIGMpOwogfQpAQCAtNDk5LDYg
KzUxNyw3IEBAIHZvaWQgY3B1cG9vbF9ybV9kb21haW4oc3RydWN0IGRvbWFpbiAqZCkKIHN0YXRp
YyBpbnQgY3B1cG9vbF9jcHVfYWRkKHVuc2lnbmVkIGludCBjcHUpCiB7CiAgICAgaW50IHJldCA9
IDA7CisgICAgY29uc3QgY3B1bWFza190ICpjcHVzOwogCiAgICAgc3Bpbl9sb2NrKCZjcHVwb29s
X2xvY2spOwogICAgIGNwdW1hc2tfY2xlYXJfY3B1KGNwdSwgJmNwdXBvb2xfbG9ja2VkX2NwdXMp
OwpAQCAtNTEyLDcgKzUzMSwxMSBAQCBzdGF0aWMgaW50IGNwdXBvb2xfY3B1X2FkZCh1bnNpZ25l
ZCBpbnQgY3B1KQogICAgICAqLwogICAgIHJjdV9yZWFkX2xvY2soJnNjaGVkX3Jlc19yY3Vsb2Nr
KTsKICAgICBnZXRfc2NoZWRfcmVzKGNwdSktPmNwdXBvb2wgPSBOVUxMOwotICAgIHJldCA9IGNw
dXBvb2xfYXNzaWduX2NwdV9sb2NrZWQoY3B1cG9vbDAsIGNwdSk7CisKKyAgICBjcHVzID0gc2No
ZWRfZ2V0X29wdF9jcHVtYXNrKGNwdXBvb2wwLT5vcHRfZ3JhbnVsYXJpdHksIGNwdSk7CisgICAg
aWYgKCBjcHVtYXNrX3N1YnNldChjcHVzLCAmY3B1cG9vbF9mcmVlX2NwdXMpICkKKyAgICAgICAg
cmV0ID0gY3B1cG9vbF9hc3NpZ25fY3B1X2xvY2tlZChjcHVwb29sMCwgY3B1KTsKKwogICAgIHJj
dV9yZWFkX3VubG9jaygmc2NoZWRfcmVzX3JjdWxvY2spOwogCiAgICAgc3Bpbl91bmxvY2soJmNw
dXBvb2xfbG9jayk7CkBAIC01NDcsMjcgKzU3MCwzMyBAQCBzdGF0aWMgdm9pZCBjcHVwb29sX2Nw
dV9yZW1vdmUodW5zaWduZWQgaW50IGNwdSkKIHN0YXRpYyBpbnQgY3B1cG9vbF9jcHVfcmVtb3Zl
X3Byb2xvZ3VlKHVuc2lnbmVkIGludCBjcHUpCiB7CiAgICAgaW50IHJldCA9IDA7CisgICAgY3B1
bWFza190ICpjcHVzOworICAgIHVuc2lnbmVkIGludCBtYXN0ZXJfY3B1OwogCiAgICAgc3Bpbl9s
b2NrKCZjcHVwb29sX2xvY2spOwogCi0gICAgaWYgKCBjcHVtYXNrX3Rlc3RfY3B1KGNwdSwgJmNw
dXBvb2xfbG9ja2VkX2NwdXMpICkKKyAgICByY3VfcmVhZF9sb2NrKCZzY2hlZF9yZXNfcmN1bG9j
ayk7CisgICAgY3B1cyA9IGdldF9zY2hlZF9yZXMoY3B1KS0+Y3B1czsKKyAgICBtYXN0ZXJfY3B1
ID0gc2NoZWRfZ2V0X3Jlc291cmNlX2NwdShjcHUpOworICAgIGlmICggY3B1bWFza19pbnRlcnNl
Y3RzKGNwdXMsICZjcHVwb29sX2xvY2tlZF9jcHVzKSApCiAgICAgICAgIHJldCA9IC1FQlVTWTsK
ICAgICBlbHNlCiAgICAgICAgIGNwdW1hc2tfc2V0X2NwdShjcHUsICZjcHVwb29sX2xvY2tlZF9j
cHVzKTsKKyAgICByY3VfcmVhZF91bmxvY2soJnNjaGVkX3Jlc19yY3Vsb2NrKTsKIAogICAgIHNw
aW5fdW5sb2NrKCZjcHVwb29sX2xvY2spOwogCiAgICAgaWYgKCByZXQgKQogICAgICAgICByZXR1
cm4gIHJldDsKIAotICAgIGlmICggY3B1bWFza190ZXN0X2NwdShjcHUsIGNwdXBvb2wwLT5jcHVf
dmFsaWQpICkKKyAgICBpZiAoIGNwdW1hc2tfdGVzdF9jcHUobWFzdGVyX2NwdSwgY3B1cG9vbDAt
PmNwdV92YWxpZCkgKQogICAgIHsKICAgICAgICAgLyogQ3B1cG9vbDAgaXMgcG9wdWxhdGVkIG9u
bHkgYWZ0ZXIgYWxsIGNwdXMgYXJlIHVwLiAqLwogICAgICAgICBBU1NFUlQoc3lzdGVtX3N0YXRl
ID09IFNZU19TVEFURV9hY3RpdmUpOwogCi0gICAgICAgIHJldCA9IGNwdXBvb2xfdW5hc3NpZ25f
Y3B1X3Byb2xvZ3VlKGNwdXBvb2wwLCBjcHUpOworICAgICAgICByZXQgPSBjcHVwb29sX3VuYXNz
aWduX2NwdV9wcm9sb2d1ZShjcHVwb29sMCwgbWFzdGVyX2NwdSk7CiAgICAgfQotICAgIGVsc2Ug
aWYgKCAhY3B1bWFza190ZXN0X2NwdShjcHUsICZjcHVwb29sX2ZyZWVfY3B1cykgKQorICAgIGVs
c2UgaWYgKCAhY3B1bWFza190ZXN0X2NwdShtYXN0ZXJfY3B1LCAmY3B1cG9vbF9mcmVlX2NwdXMp
ICkKICAgICAgICAgcmV0ID0gLUVOT0RFVjsKIAogICAgIHJldHVybiByZXQ7CkBAIC02NTcsMjcg
KzY4Niw0MyBAQCBpbnQgY3B1cG9vbF9kb19zeXNjdGwoc3RydWN0IHhlbl9zeXNjdGxfY3B1cG9v
bF9vcCAqb3ApCiAgICAgY2FzZSBYRU5fU1lTQ1RMX0NQVVBPT0xfT1BfQUREQ1BVOgogICAgIHsK
ICAgICAgICAgdW5zaWduZWQgY3B1OworICAgICAgICBjb25zdCBjcHVtYXNrX3QgKmNwdXM7CiAK
ICAgICAgICAgY3B1ID0gb3AtPmNwdTsKICAgICAgICAgY3B1cG9vbF9kcHJpbnRrKCJjcHVwb29s
X2Fzc2lnbl9jcHUocG9vbD0lZCxjcHU9JWQpXG4iLAogICAgICAgICAgICAgICAgICAgICAgICAg
b3AtPmNwdXBvb2xfaWQsIGNwdSk7CisKICAgICAgICAgc3Bpbl9sb2NrKCZjcHVwb29sX2xvY2sp
OworCisgICAgICAgIGMgPSBjcHVwb29sX2ZpbmRfYnlfaWQob3AtPmNwdXBvb2xfaWQpOworICAg
ICAgICByZXQgPSAtRU5PRU5UOworICAgICAgICBpZiAoIGMgPT0gTlVMTCApCisgICAgICAgICAg
ICBnb3RvIGFkZGNwdV9vdXQ7CiAgICAgICAgIGlmICggY3B1ID09IFhFTl9TWVNDVExfQ1BVUE9P
TF9QQVJfQU5ZICkKLSAgICAgICAgICAgIGNwdSA9IGNwdW1hc2tfZmlyc3QoJmNwdXBvb2xfZnJl
ZV9jcHVzKTsKKyAgICAgICAgeworICAgICAgICAgICAgZm9yX2VhY2hfY3B1ICggY3B1LCAmY3B1
cG9vbF9mcmVlX2NwdXMgKQorICAgICAgICAgICAgeworICAgICAgICAgICAgICAgIGNwdXMgPSBz
Y2hlZF9nZXRfb3B0X2NwdW1hc2soYy0+b3B0X2dyYW51bGFyaXR5LCBjcHUpOworICAgICAgICAg
ICAgICAgIGlmICggY3B1bWFza19zdWJzZXQoY3B1cywgJmNwdXBvb2xfZnJlZV9jcHVzKSApCisg
ICAgICAgICAgICAgICAgICAgIGJyZWFrOworICAgICAgICAgICAgfQorICAgICAgICAgICAgcmV0
ID0gLUVOT0RFVjsKKyAgICAgICAgICAgIGlmICggY3B1ID49IG5yX2NwdV9pZHMgKQorICAgICAg
ICAgICAgICAgIGdvdG8gYWRkY3B1X291dDsKKyAgICAgICAgfQogICAgICAgICByZXQgPSAtRUlO
VkFMOwogICAgICAgICBpZiAoIGNwdSA+PSBucl9jcHVfaWRzICkKICAgICAgICAgICAgIGdvdG8g
YWRkY3B1X291dDsKICAgICAgICAgcmV0ID0gLUVOT0RFVjsKLSAgICAgICAgaWYgKCAhY3B1bWFz
a190ZXN0X2NwdShjcHUsICZjcHVwb29sX2ZyZWVfY3B1cykgfHwKLSAgICAgICAgICAgICBjcHVt
YXNrX3Rlc3RfY3B1KGNwdSwgJmNwdXBvb2xfbG9ja2VkX2NwdXMpICkKLSAgICAgICAgICAgIGdv
dG8gYWRkY3B1X291dDsKLSAgICAgICAgYyA9IGNwdXBvb2xfZmluZF9ieV9pZChvcC0+Y3B1cG9v
bF9pZCk7Ci0gICAgICAgIHJldCA9IC1FTk9FTlQ7Ci0gICAgICAgIGlmICggYyA9PSBOVUxMICkK
KyAgICAgICAgY3B1cyA9IHNjaGVkX2dldF9vcHRfY3B1bWFzayhjLT5vcHRfZ3JhbnVsYXJpdHks
IGNwdSk7CisgICAgICAgIGlmICggIWNwdW1hc2tfc3Vic2V0KGNwdXMsICZjcHVwb29sX2ZyZWVf
Y3B1cykgfHwKKyAgICAgICAgICAgICBjcHVtYXNrX2ludGVyc2VjdHMoY3B1cywgJmNwdXBvb2xf
bG9ja2VkX2NwdXMpICkKICAgICAgICAgICAgIGdvdG8gYWRkY3B1X291dDsKICAgICAgICAgcmV0
ID0gY3B1cG9vbF9hc3NpZ25fY3B1X2xvY2tlZChjLCBjcHUpOworCiAgICAgYWRkY3B1X291dDoK
ICAgICAgICAgc3Bpbl91bmxvY2soJmNwdXBvb2xfbG9jayk7CisKICAgICAgICAgY3B1cG9vbF9k
cHJpbnRrKCJjcHVwb29sX2Fzc2lnbl9jcHUocG9vbD0lZCxjcHU9JWQpIHJldCAlZFxuIiwKICAg
ICAgICAgICAgICAgICAgICAgICAgIG9wLT5jcHVwb29sX2lkLCBjcHUsIHJldCk7CiAgICAgfQpk
aWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZHVsZS5jIGIveGVuL2NvbW1vbi9zY2hlZHVsZS5j
CmluZGV4IGI0ZTY1ZTgxYjAuLmZlZDcxYjI2ZDIgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2No
ZWR1bGUuYworKysgYi94ZW4vY29tbW9uL3NjaGVkdWxlLmMKQEAgLTI0NjksOCArMjQ2OSw3IEBA
IHN0YXRpYyBzdHJ1Y3Qgbm90aWZpZXJfYmxvY2sgY3B1X3NjaGVkdWxlX25mYiA9IHsKICAgICAu
bm90aWZpZXJfY2FsbCA9IGNwdV9zY2hlZHVsZV9jYWxsYmFjawogfTsKIAotc3RhdGljIGNvbnN0
IGNwdW1hc2tfdCAqc2NoZWRfZ2V0X29wdF9jcHVtYXNrKGVudW0gc2NoZWRfZ3JhbiBvcHQsCi0g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50
IGNwdSkKK2NvbnN0IGNwdW1hc2tfdCAqc2NoZWRfZ2V0X29wdF9jcHVtYXNrKGVudW0gc2NoZWRf
Z3JhbiBvcHQsIHVuc2lnbmVkIGludCBjcHUpCiB7CiAgICAgY29uc3QgY3B1bWFza190ICptYXNr
OwogCmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQtaWYuaCBiL3hlbi9pbmNsdWRl
L3hlbi9zY2hlZC1pZi5oCmluZGV4IDcxNGQ3OTM4MTUuLmMxMjUyMzYwNjggMTAwNjQ0Ci0tLSBh
L3hlbi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5oCisrKyBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC1p
Zi5oCkBAIC02MTMsNSArNjEzLDYgQEAgYWZmaW5pdHlfYmFsYW5jZV9jcHVtYXNrKGNvbnN0IHN0
cnVjdCBzY2hlZF91bml0ICp1bml0LCBpbnQgc3RlcCwKIH0KIAogdm9pZCBzY2hlZF9ybV9jcHUo
dW5zaWduZWQgaW50IGNwdSk7Citjb25zdCBjcHVtYXNrX3QgKnNjaGVkX2dldF9vcHRfY3B1bWFz
ayhlbnVtIHNjaGVkX2dyYW4gb3B0LCB1bnNpZ25lZCBpbnQgY3B1KTsKIAogI2VuZGlmIC8qIF9f
WEVOX1NDSEVEX0lGX0hfXyAqLwotLSAKMi4xNi40CgoKX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxA
bGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFu
L2xpc3RpbmZvL3hlbi1kZXZlbA==

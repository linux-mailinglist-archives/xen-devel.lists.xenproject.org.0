Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 54437173FD8
	for <lists+xen-devel@lfdr.de>; Fri, 28 Feb 2020 19:43:22 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1j7kZU-0002oy-KC; Fri, 28 Feb 2020 18:41:12 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=6b2x=4Q=intel.com=tamas.lengyel@srs-us1.protection.inumbo.net>)
 id 1j7kZT-0002oe-2p
 for xen-devel@lists.xenproject.org; Fri, 28 Feb 2020 18:41:11 +0000
X-Inumbo-ID: e11db9e8-5a59-11ea-9a00-12813bfff9fa
Received: from mga06.intel.com (unknown [134.134.136.31])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id e11db9e8-5a59-11ea-9a00-12813bfff9fa;
 Fri, 28 Feb 2020 18:41:07 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga005.fm.intel.com ([10.253.24.32])
 by orsmga104.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 28 Feb 2020 10:41:04 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.70,497,1574150400"; d="scan'208";a="437512264"
Received: from tlengyel-mobl2.amr.corp.intel.com (HELO localhost.localdomain)
 ([10.251.159.227])
 by fmsmga005.fm.intel.com with ESMTP; 28 Feb 2020 10:41:03 -0800
From: Tamas K Lengyel <tamas.lengyel@intel.com>
To: xen-devel@lists.xenproject.org
Date: Fri, 28 Feb 2020 10:40:53 -0800
Message-Id: <a23e1bbfd86a6143db3d96e0271739ad120502bd.1582914998.git.tamas.lengyel@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <cover.1582914997.git.tamas.lengyel@intel.com>
References: <cover.1582914997.git.tamas.lengyel@intel.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v11 3/3] xen/tools: VM forking toolstack side
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Anthony PERARD <anthony.perard@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>,
 Tamas K Lengyel <tamas.lengyel@intel.com>, Wei Liu <wl@xen.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

QWRkIG5lY2Vzc2FyeSBiaXRzIHRvIGltcGxlbWVudCAieGwgZm9yay12bSIgY29tbWFuZHMuIFRo
ZSBjb21tYW5kIGFsbG93cyB0aGUKdXNlciB0byBzcGVjaWZ5IGhvdyB0byBsYXVuY2ggdGhlIGRl
dmljZSBtb2RlbCBhbGxvd2luZyBmb3IgYSBsYXRlLWxhdW5jaCBtb2RlbAppbiB3aGljaCB0aGUg
dXNlciBjYW4gZXhlY3V0ZSB0aGUgZm9yayB3aXRob3V0IHRoZSBkZXZpY2UgbW9kZWwgYW5kIGRl
Y2lkZSB0bwpvbmx5IGxhdGVyIGxhdW5jaCBpdC4KClNpZ25lZC1vZmYtYnk6IFRhbWFzIEsgTGVu
Z3llbCA8dGFtYXMubGVuZ3llbEBpbnRlbC5jb20+Ci0tLQogZG9jcy9tYW4veGwuMS5wb2QuaW4g
ICAgICAgICAgfCAgNDQgKysrKysKIHRvb2xzL2xpYnhjL2luY2x1ZGUveGVuY3RybC5oIHwgIDEz
ICsrCiB0b29scy9saWJ4Yy94Y19tZW1zaHIuYyAgICAgICB8ICAyMiArKysKIHRvb2xzL2xpYnhs
L2xpYnhsLmggICAgICAgICAgIHwgIDExICsrCiB0b29scy9saWJ4bC9saWJ4bF9jcmVhdGUuYyAg
ICB8IDM2MSArKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tLS0tCiB0b29scy9saWJ4bC9s
aWJ4bF9kbS5jICAgICAgICB8ICAgMiArLQogdG9vbHMvbGlieGwvbGlieGxfZG9tLmMgICAgICAg
fCAgNDMgKysrLQogdG9vbHMvbGlieGwvbGlieGxfaW50ZXJuYWwuaCAgfCAgIDcgKwogdG9vbHMv
bGlieGwvbGlieGxfdHlwZXMuaWRsICAgfCAgIDEgKwogdG9vbHMvbGlieGwvbGlieGxfeDg2LmMg
ICAgICAgfCAgNDEgKysrKwogdG9vbHMveGwvTWFrZWZpbGUgICAgICAgICAgICAgfCAgIDIgKy0K
IHRvb2xzL3hsL3hsLmggICAgICAgICAgICAgICAgIHwgICA1ICsKIHRvb2xzL3hsL3hsX2NtZHRh
YmxlLmMgICAgICAgIHwgIDE1ICsrCiB0b29scy94bC94bF9mb3Jrdm0uYyAgICAgICAgICB8IDE0
NyArKysrKysrKysrKysrKwogdG9vbHMveGwveGxfdm1jb250cm9sLmMgICAgICAgfCAgMTQgKysK
IDE1IGZpbGVzIGNoYW5nZWQsIDU2MiBpbnNlcnRpb25zKCspLCAxNjYgZGVsZXRpb25zKC0pCiBj
cmVhdGUgbW9kZSAxMDA2NDQgdG9vbHMveGwveGxfZm9ya3ZtLmMKCmRpZmYgLS1naXQgYS9kb2Nz
L21hbi94bC4xLnBvZC5pbiBiL2RvY3MvbWFuL3hsLjEucG9kLmluCmluZGV4IDA5MzM5MjgyZTYu
LjU5YzAzYzY0MjcgMTAwNjQ0Ci0tLSBhL2RvY3MvbWFuL3hsLjEucG9kLmluCisrKyBiL2RvY3Mv
bWFuL3hsLjEucG9kLmluCkBAIC03MDgsNiArNzA4LDUwIEBAIGFib3ZlKS4KIAogPWJhY2sKIAor
PWl0ZW0gQjxmb3JrLXZtPiBbSTxPUFRJT05TPl0gSTxkb21haW4taWQ+CisKK0NyZWF0ZSBhIGZv
cmsgb2YgYSBydW5uaW5nIFZNLiAgVGhlIGRvbWFpbiB3aWxsIGJlIHBhdXNlZCBhZnRlciB0aGUg
b3BlcmF0aW9uCithbmQgcmVtYWlucyBwYXVzZWQgd2hpbGUgZm9ya3Mgb2YgaXQgZXhpc3QuICBF
eHBlcmltZW50YWwgYW5kIHg4NiBvbmx5LgorRm9ya3MgY2FuIG9ubHkgYmUgbWFkZSBvZiBkb21h
aW5zIHdpdGggSEFQIGVuYWJsZWQgYW5kIG9uIEludGVsIGhhcmR3YXJlLiAgVGhlCitwYXJlbnQg
ZG9tYWluIG11c3QgYmUgY3JlYXRlZCB3aXRoIHRoZSB4bCB0b29sc3RhY2sgYW5kIGl0cyBjb25m
aWd1cmF0aW9uIG11c3QKK25vdCBtYW51YWxseSBkZWZpbmUgbWF4X2dyYW50X2ZyYW1lcywgbWF4
X21hcHRyYWNrX2ZyYW1lcyBvciBtYXhfZXZlbnRfY2hhbm5lbHMuCisKK0I8T1BUSU9OUz4KKwor
PW92ZXIgNAorCis9aXRlbSBCPC1wPgorCitMZWF2ZSB0aGUgZm9yayBwYXVzZWQgYWZ0ZXIgY3Jl
YXRpbmcgaXQuCisKKz1pdGVtIEI8LS1sYXVuY2gtZG0+CisKK1NwZWNpZnkgd2hldGhlciB0aGUg
ZGV2aWNlIG1vZGVsIChRRU1VKSBzaG91bGQgYmUgbGF1bmNoZWQgZm9yIHRoZSBmb3JrLiBMYXRl
CitsYXVuY2ggYWxsb3dzIHRvIHN0YXJ0IHRoZSBkZXZpY2UgbW9kZWwgZm9yIGFuIGFscmVhZHkg
cnVubmluZyBmb3JrLgorCis9aXRlbSBCPC1DPgorCitUaGUgY29uZmlnIGZpbGUgdG8gdXNlIHdo
ZW4gbGF1bmNoaW5nIHRoZSBkZXZpY2UgbW9kZWwuICBDdXJyZW50bHkgcmVxdWlyZWQgd2hlbgor
bGF1bmNoaW5nIHRoZSBkZXZpY2UgbW9kZWwuICBNb3N0IGNvbmZpZyBzZXR0aW5ncyBNVVNUIG1h
dGNoIHRoZSBwYXJlbnQgZG9tYWluCitleGFjdGx5LCBvbmx5IGNoYW5nZSBWTSBuYW1lLCBkaXNr
IHBhdGggYW5kIG5ldHdvcmsgY29uZmlndXJhdGlvbnMuCisKKz1pdGVtIEI8LVE+CisKK1RoZSBw
YXRoIHRvIHRoZSBxZW11IHNhdmUgZmlsZSB0byB1c2Ugd2hlbiBsYXVuY2hpbmcgdGhlIGRldmlj
ZSBtb2RlbC4gIEN1cnJlbnRseQorcmVxdWlyZWQgd2hlbiBsYXVuY2hpbmcgdGhlIGRldmljZSBt
b2RlbC4KKworPWl0ZW0gQjwtLWZvcmstcmVzZXQ+CisKK1BlcmZvcm0gYSByZXNldCBvcGVyYXRp
b24gb2YgYW4gYWxyZWFkeSBydW5uaW5nIGZvcmsuICBOb3RlIHRoYXQgcmVzZXR0aW5nIG1heQor
YmUgbGVzcyBwZXJmb3JtYW50IHRoZW4gY3JlYXRpbmcgYSBuZXcgZm9yayBkZXBlbmRpbmcgb24g
aG93IG11Y2ggbWVtb3J5IHRoZQorZm9yayBoYXMgZGVkdXBsaWNhdGVkIGR1cmluZyBpdHMgcnVu
dGltZS4KKworPWl0ZW0gQjwtLW1heC12Y3B1cz4KKworU3BlY2lmeSB0aGUgbWF4LXZjcHVzIG1h
dGNoaW5nIHRoZSBwYXJlbnQgZG9tYWluIHdoZW4gbm90IGxhdW5jaGluZyB0aGUgZG0uCisKKz1i
YWNrCisKID1pdGVtIEI8c2hhcmluZz4gW0k8ZG9tYWluLWlkPl0KIAogRGlzcGxheSB0aGUgbnVt
YmVyIG9mIHNoYXJlZCBwYWdlcyBmb3IgYSBzcGVjaWZpZWQgZG9tYWluLiBJZiBubyBkb21haW4g
aXMKZGlmZiAtLWdpdCBhL3Rvb2xzL2xpYnhjL2luY2x1ZGUveGVuY3RybC5oIGIvdG9vbHMvbGli
eGMvaW5jbHVkZS94ZW5jdHJsLmgKaW5kZXggZmM2ZTU3YTFhMC4uMDBjYjRjZjFmNyAxMDA2NDQK
LS0tIGEvdG9vbHMvbGlieGMvaW5jbHVkZS94ZW5jdHJsLmgKKysrIGIvdG9vbHMvbGlieGMvaW5j
bHVkZS94ZW5jdHJsLmgKQEAgLTIyMjUsNiArMjIyNSwxOSBAQCBpbnQgeGNfbWVtc2hyX3Jhbmdl
X3NoYXJlKHhjX2ludGVyZmFjZSAqeGNoLAogICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50
NjRfdCBmaXJzdF9nZm4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQ2NF90IGxhc3Rf
Z2ZuKTsKIAoraW50IHhjX21lbXNocl9mb3JrKHhjX2ludGVyZmFjZSAqeGNoLAorICAgICAgICAg
ICAgICAgICAgIHVpbnQzMl90IHNvdXJjZV9kb21haW4sCisgICAgICAgICAgICAgICAgICAgdWlu
dDMyX3QgY2xpZW50X2RvbWFpbik7CisKKy8qCisgKiBOb3RlOiB0aGlzIGZ1bmN0aW9uIGlzIG9u
bHkgaW50ZW5kZWQgdG8gYmUgdXNlZCBvbiBzaG9ydC1saXZlZCBmb3JrcyB0aGF0CisgKiBoYXZl
bid0IHlldCBhcXVpcmVkIGEgbG90IG9mIG1lbW9yeS4gSW4gY2FzZSB0aGUgZm9yayBoYXMgYSBs
b3Qgb2YgbWVtb3J5CisgKiBpdCBpcyBsaWtlbHkgbW9yZSBwZXJmb3JtYW50IHRvIGNyZWF0ZSBh
IG5ldyBmb3JrIHdpdGggeGNfbWVtc2hyX2ZvcmsuCisgKgorICogV2l0aCBWTXMgdGhhdCBoYXZl
IGEgbG90IG9mIG1lbW9yeSB0aGlzIGNhbGwgbWF5IGJsb2NrIGZvciBhIGxvbmcgdGltZS4KKyAq
LworaW50IHhjX21lbXNocl9mb3JrX3Jlc2V0KHhjX2ludGVyZmFjZSAqeGNoLCB1aW50MzJfdCBm
b3JrZWRfZG9tYWluKTsKKwogLyogRGVidWcgY2FsbHM6IHJldHVybiB0aGUgbnVtYmVyIG9mIHBh
Z2VzIHJlZmVyZW5jaW5nIHRoZSBzaGFyZWQgZnJhbWUgYmFja2luZwogICogdGhlIGlucHV0IGFy
Z3VtZW50LiBTaG91bGQgYmUgb25lIG9yIGdyZWF0ZXIuCiAgKgpkaWZmIC0tZ2l0IGEvdG9vbHMv
bGlieGMveGNfbWVtc2hyLmMgYi90b29scy9saWJ4Yy94Y19tZW1zaHIuYwppbmRleCA5N2UyZTZh
OGQ5Li5kMGU0ZWUyMjViIDEwMDY0NAotLS0gYS90b29scy9saWJ4Yy94Y19tZW1zaHIuYworKysg
Yi90b29scy9saWJ4Yy94Y19tZW1zaHIuYwpAQCAtMjM5LDYgKzIzOSwyOCBAQCBpbnQgeGNfbWVt
c2hyX2RlYnVnX2dyZWYoeGNfaW50ZXJmYWNlICp4Y2gsCiAgICAgcmV0dXJuIHhjX21lbXNocl9t
ZW1vcCh4Y2gsIGRvbWlkLCAmbXNvKTsKIH0KIAoraW50IHhjX21lbXNocl9mb3JrKHhjX2ludGVy
ZmFjZSAqeGNoLCB1aW50MzJfdCBwZG9taWQsIHVpbnQzMl90IGRvbWlkKQoreworICAgIHhlbl9t
ZW1fc2hhcmluZ19vcF90IG1zbzsKKworICAgIG1lbXNldCgmbXNvLCAwLCBzaXplb2YobXNvKSk7
CisKKyAgICBtc28ub3AgPSBYRU5NRU1fc2hhcmluZ19vcF9mb3JrOworICAgIG1zby51LmZvcmsu
cGFyZW50X2RvbWFpbiA9IHBkb21pZDsKKworICAgIHJldHVybiB4Y19tZW1zaHJfbWVtb3AoeGNo
LCBkb21pZCwgJm1zbyk7Cit9CisKK2ludCB4Y19tZW1zaHJfZm9ya19yZXNldCh4Y19pbnRlcmZh
Y2UgKnhjaCwgdWludDMyX3QgZG9taWQpCit7CisgICAgeGVuX21lbV9zaGFyaW5nX29wX3QgbXNv
OworCisgICAgbWVtc2V0KCZtc28sIDAsIHNpemVvZihtc28pKTsKKyAgICBtc28ub3AgPSBYRU5N
RU1fc2hhcmluZ19vcF9mb3JrX3Jlc2V0OworCisgICAgcmV0dXJuIHhjX21lbXNocl9tZW1vcCh4
Y2gsIGRvbWlkLCAmbXNvKTsKK30KKwogaW50IHhjX21lbXNocl9hdWRpdCh4Y19pbnRlcmZhY2Ug
KnhjaCkKIHsKICAgICB4ZW5fbWVtX3NoYXJpbmdfb3BfdCBtc287CmRpZmYgLS1naXQgYS90b29s
cy9saWJ4bC9saWJ4bC5oIGIvdG9vbHMvbGlieGwvbGlieGwuaAppbmRleCAzNWUxMzQyOGIyLi42
Yjk2OGJkY2I0IDEwMDY0NAotLS0gYS90b29scy9saWJ4bC9saWJ4bC5oCisrKyBiL3Rvb2xzL2xp
YnhsL2xpYnhsLmgKQEAgLTI2NTcsNiArMjY1NywxNyBAQCBpbnQgbGlieGxfcHNyX2dldF9od19p
bmZvKGxpYnhsX2N0eCAqY3R4LCBsaWJ4bF9wc3JfZmVhdF90eXBlIHR5cGUsCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCBsdmwsIHVuc2lnbmVkIGludCAqbnIsCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGxpYnhsX3Bzcl9od19pbmZvICoqaW5mbyk7CiB2b2lkIGxp
YnhsX3Bzcl9od19pbmZvX2xpc3RfZnJlZShsaWJ4bF9wc3JfaHdfaW5mbyAqbGlzdCwgdW5zaWdu
ZWQgaW50IG5yKTsKKworaW50IGxpYnhsX2RvbWFpbl9mb3JrX3ZtKGxpYnhsX2N0eCAqY3R4LCB1
aW50MzJfdCBwZG9taWQsIHVpbnQzMl90IG1heF92Y3B1cywgdWludDMyX3QgKmRvbWlkKQorICAg
ICAgICAgICAgICAgICAgICAgICAgIExJQlhMX0VYVEVSTkFMX0NBTExFUlNfT05MWTsKKworaW50
IGxpYnhsX2RvbWFpbl9mb3JrX2xhdW5jaF9kbShsaWJ4bF9jdHggKmN0eCwgbGlieGxfZG9tYWlu
X2NvbmZpZyAqZF9jb25maWcsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQz
Ml90IGRvbWlkLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsaWJ4bF9h
c3luY3Byb2dyZXNzX2hvdyAqYW9wX2NvbnNvbGVfaG93KQorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBMSUJYTF9FWFRFUk5BTF9DQUxMRVJTX09OTFk7CisKK2ludCBsaWJ4bF9kb21h
aW5fZm9ya19yZXNldChsaWJ4bF9jdHggKmN0eCwgdWludDMyX3QgZG9taWQpCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgTElCWExfRVhURVJOQUxfQ0FMTEVSU19PTkxZOwogI2VuZGlmCiAK
IC8qIG1pc2MgKi8KZGlmZiAtLWdpdCBhL3Rvb2xzL2xpYnhsL2xpYnhsX2NyZWF0ZS5jIGIvdG9v
bHMvbGlieGwvbGlieGxfY3JlYXRlLmMKaW5kZXggY2NjOWU3MDk5MC4uZWJhOGNlNDE5YiAxMDA2
NDQKLS0tIGEvdG9vbHMvbGlieGwvbGlieGxfY3JlYXRlLmMKKysrIGIvdG9vbHMvbGlieGwvbGli
eGxfY3JlYXRlLmMKQEAgLTUzNiwxMiArNTM2LDEyIEBAIG91dDoKICAgICByZXR1cm4gcmV0Owog
fQogCi1pbnQgbGlieGxfX2RvbWFpbl9tYWtlKGxpYnhsX19nYyAqZ2MsIGxpYnhsX2RvbWFpbl9j
b25maWcgKmRfY29uZmlnLAotICAgICAgICAgICAgICAgICAgICAgICBsaWJ4bF9fZG9tYWluX2J1
aWxkX3N0YXRlICpzdGF0ZSwKLSAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgKmRvbWlk
LCBib29sIHNvZnRfcmVzZXQpCitzdGF0aWMgaW50IGxpYnhsX19kb21haW5fbWFrZV94c19lbnRy
aWVzKGxpYnhsX19nYyAqZ2MsIGxpYnhsX2RvbWFpbl9jb25maWcgKmRfY29uZmlnLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ4bF9fZG9tYWluX2J1aWxkX3N0
YXRlICpzdGF0ZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWlu
dDMyX3QgZG9taWQpCiB7CiAgICAgbGlieGxfY3R4ICpjdHggPSBsaWJ4bF9fZ2Nfb3duZXIoZ2Mp
OwotICAgIGludCByZXQsIHJjLCBuYl92bTsKKyAgICBpbnQgcmMsIG5iX3ZtOwogICAgIGNvbnN0
IGNoYXIgKmRvbV90eXBlOwogICAgIGNoYXIgKnV1aWRfc3RyaW5nOwogICAgIGNoYXIgKmRvbV9w
YXRoLCAqdm1fcGF0aCwgKmxpYnhsX3BhdGg7CkBAIC01NTMsOSArNTUzLDYgQEAgaW50IGxpYnhs
X19kb21haW5fbWFrZShsaWJ4bF9fZ2MgKmdjLCBsaWJ4bF9kb21haW5fY29uZmlnICpkX2NvbmZp
ZywKIAogICAgIC8qIGNvbnZlbmllbmNlIGFsaWFzZXMgKi8KICAgICBsaWJ4bF9kb21haW5fY3Jl
YXRlX2luZm8gKmluZm8gPSAmZF9jb25maWctPmNfaW5mbzsKLSAgICBsaWJ4bF9kb21haW5fYnVp
bGRfaW5mbyAqYl9pbmZvID0gJmRfY29uZmlnLT5iX2luZm87Ci0KLSAgICBhc3NlcnQoc29mdF9y
ZXNldCB8fCAqZG9taWQgPT0gSU5WQUxJRF9ET01JRCk7CiAKICAgICB1dWlkX3N0cmluZyA9IGxp
YnhsX191dWlkMnN0cmluZyhnYywgaW5mby0+dXVpZCk7CiAgICAgaWYgKCF1dWlkX3N0cmluZykg
ewpAQCAtNTYzLDEzNyArNTYwLDcgQEAgaW50IGxpYnhsX19kb21haW5fbWFrZShsaWJ4bF9fZ2Mg
KmdjLCBsaWJ4bF9kb21haW5fY29uZmlnICpkX2NvbmZpZywKICAgICAgICAgZ290byBvdXQ7CiAg
ICAgfQogCi0gICAgaWYgKCFzb2Z0X3Jlc2V0KSB7Ci0gICAgICAgIHN0cnVjdCB4ZW5fZG9tY3Rs
X2NyZWF0ZWRvbWFpbiBjcmVhdGUgPSB7Ci0gICAgICAgICAgICAuc3NpZHJlZiA9IGluZm8tPnNz
aWRyZWYsCi0gICAgICAgICAgICAubWF4X3ZjcHVzID0gYl9pbmZvLT5tYXhfdmNwdXMsCi0gICAg
ICAgICAgICAubWF4X2V2dGNobl9wb3J0ID0gYl9pbmZvLT5ldmVudF9jaGFubmVscywKLSAgICAg
ICAgICAgIC5tYXhfZ3JhbnRfZnJhbWVzID0gYl9pbmZvLT5tYXhfZ3JhbnRfZnJhbWVzLAotICAg
ICAgICAgICAgLm1heF9tYXB0cmFja19mcmFtZXMgPSBiX2luZm8tPm1heF9tYXB0cmFja19mcmFt
ZXMsCi0gICAgICAgIH07Ci0KLSAgICAgICAgaWYgKGluZm8tPnR5cGUgIT0gTElCWExfRE9NQUlO
X1RZUEVfUFYpIHsKLSAgICAgICAgICAgIGNyZWF0ZS5mbGFncyB8PSBYRU5fRE9NQ1RMX0NERl9o
dm07Ci0gICAgICAgICAgICBjcmVhdGUuZmxhZ3MgfD0KLSAgICAgICAgICAgICAgICBsaWJ4bF9k
ZWZib29sX3ZhbChpbmZvLT5oYXApID8gWEVOX0RPTUNUTF9DREZfaGFwIDogMDsKLSAgICAgICAg
ICAgIGNyZWF0ZS5mbGFncyB8PQotICAgICAgICAgICAgICAgIGxpYnhsX2RlZmJvb2xfdmFsKGlu
Zm8tPm9vcykgPyAwIDogWEVOX0RPTUNUTF9DREZfb29zX29mZjsKLSAgICAgICAgfQotCi0gICAg
ICAgIGFzc2VydChpbmZvLT5wYXNzdGhyb3VnaCAhPSBMSUJYTF9QQVNTVEhST1VHSF9ERUZBVUxU
KTsKLSAgICAgICAgTE9HKERFVEFJTCwgInBhc3N0aHJvdWdoOiAlcyIsCi0gICAgICAgICAgICBs
aWJ4bF9wYXNzdGhyb3VnaF90b19zdHJpbmcoaW5mby0+cGFzc3Rocm91Z2gpKTsKLQotICAgICAg
ICBpZiAoaW5mby0+cGFzc3Rocm91Z2ggIT0gTElCWExfUEFTU1RIUk9VR0hfRElTQUJMRUQpCi0g
ICAgICAgICAgICBjcmVhdGUuZmxhZ3MgfD0gWEVOX0RPTUNUTF9DREZfaW9tbXU7Ci0KLSAgICAg
ICAgaWYgKGluZm8tPnBhc3N0aHJvdWdoID09IExJQlhMX1BBU1NUSFJPVUdIX1NZTkNfUFQpCi0g
ICAgICAgICAgICBjcmVhdGUuaW9tbXVfb3B0cyB8PSBYRU5fRE9NQ1RMX0lPTU1VX25vX3NoYXJl
cHQ7Ci0KLSAgICAgICAgLyogVWx0aW1hdGVseSwgaGFuZGxlIGlzIGFuIGFycmF5IG9mIDE2IHVp
bnQ4X3QsIHNhbWUgYXMgdXVpZCAqLwotICAgICAgICBsaWJ4bF91dWlkX2NvcHkoY3R4LCAobGli
eGxfdXVpZCAqKSZjcmVhdGUuaGFuZGxlLCAmaW5mby0+dXVpZCk7Ci0KLSAgICAgICAgcmV0ID0g
bGlieGxfX2FyY2hfZG9tYWluX3ByZXBhcmVfY29uZmlnKGdjLCBkX2NvbmZpZywgJmNyZWF0ZSk7
Ci0gICAgICAgIGlmIChyZXQgPCAwKSB7Ci0gICAgICAgICAgICBMT0dFRChFUlJPUiwgKmRvbWlk
LCAiZmFpbCB0byBnZXQgZG9tYWluIGNvbmZpZyIpOwotICAgICAgICAgICAgcmMgPSBFUlJPUl9G
QUlMOwotICAgICAgICAgICAgZ290byBvdXQ7Ci0gICAgICAgIH0KLQotICAgICAgICBmb3IgKDs7
KSB7Ci0gICAgICAgICAgICB1aW50MzJfdCBsb2NhbF9kb21pZDsKLSAgICAgICAgICAgIGJvb2wg
cmVjZW50OwotCi0gICAgICAgICAgICBpZiAoaW5mby0+ZG9taWQgPT0gUkFORE9NX0RPTUlEKSB7
Ci0gICAgICAgICAgICAgICAgdWludDE2X3QgdjsKLQotICAgICAgICAgICAgICAgIHJldCA9IGxp
YnhsX19yYW5kb21fYnl0ZXMoZ2MsICh2b2lkICopJnYsIHNpemVvZih2KSk7Ci0gICAgICAgICAg
ICAgICAgaWYgKHJldCA8IDApCi0gICAgICAgICAgICAgICAgICAgIGJyZWFrOwotCi0gICAgICAg
ICAgICAgICAgdiAmPSBET01JRF9NQVNLOwotICAgICAgICAgICAgICAgIGlmICghbGlieGxfZG9t
aWRfdmFsaWRfZ3Vlc3QodikpCi0gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwotCi0gICAg
ICAgICAgICAgICAgbG9jYWxfZG9taWQgPSB2OwotICAgICAgICAgICAgfSBlbHNlIHsKLSAgICAg
ICAgICAgICAgICBsb2NhbF9kb21pZCA9IGluZm8tPmRvbWlkOyAvKiBNYXkgbm90IGJlIHZhbGlk
ICovCi0gICAgICAgICAgICB9Ci0KLSAgICAgICAgICAgIHJldCA9IHhjX2RvbWFpbl9jcmVhdGUo
Y3R4LT54Y2gsICZsb2NhbF9kb21pZCwgJmNyZWF0ZSk7Ci0gICAgICAgICAgICBpZiAocmV0IDwg
MCkgewotICAgICAgICAgICAgICAgIC8qCi0gICAgICAgICAgICAgICAgICogSWYgd2UgZ2VuZXJh
dGVkIGEgcmFuZG9tIGRvbWlkIGFuZCBjcmVhdGlvbiBmYWlsZWQKLSAgICAgICAgICAgICAgICAg
KiBiZWNhdXNlIHRoYXQgZG9taWQgYWxyZWFkeSBleGlzdHMgdGhlbiBzaW1wbHkgdHJ5Ci0gICAg
ICAgICAgICAgICAgICogYWdhaW4uCi0gICAgICAgICAgICAgICAgICovCi0gICAgICAgICAgICAg
ICAgaWYgKGVycm5vID09IEVFWElTVCAmJiBpbmZvLT5kb21pZCA9PSBSQU5ET01fRE9NSUQpCi0g
ICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwotCi0gICAgICAgICAgICAgICAgTE9HRUQoRVJS
T1IsIGxvY2FsX2RvbWlkLCAiZG9tYWluIGNyZWF0aW9uIGZhaWwiKTsKLSAgICAgICAgICAgICAg
ICByYyA9IEVSUk9SX0ZBSUw7Ci0gICAgICAgICAgICAgICAgZ290byBvdXQ7Ci0gICAgICAgICAg
ICB9Ci0KLSAgICAgICAgICAgIC8qIEEgbmV3IGRvbWFpbiBub3cgZXhpc3RzICovCi0gICAgICAg
ICAgICAqZG9taWQgPSBsb2NhbF9kb21pZDsKLQotICAgICAgICAgICAgcmMgPSBsaWJ4bF9faXNf
ZG9taWRfcmVjZW50KGdjLCBsb2NhbF9kb21pZCwgJnJlY2VudCk7Ci0gICAgICAgICAgICBpZiAo
cmMpCi0gICAgICAgICAgICAgICAgZ290byBvdXQ7Ci0KLSAgICAgICAgICAgIC8qIFRoZSBkb21p
ZCBpcyBub3QgcmVjZW50LCBzbyB3ZSdyZSBkb25lICovCi0gICAgICAgICAgICBpZiAoIXJlY2Vu
dCkKLSAgICAgICAgICAgICAgICBicmVhazsKLQotICAgICAgICAgICAgLyoKLSAgICAgICAgICAg
ICAqIElmIHRoZSBkb21pZCB3YXMgc3BlY2lmaWVkIHRoZW4gdGhlcmUncyBubyBwb2ludCBpbgot
ICAgICAgICAgICAgICogdHJ5aW5nIGFnYWluLgotICAgICAgICAgICAgICovCi0gICAgICAgICAg
ICBpZiAobGlieGxfZG9taWRfdmFsaWRfZ3Vlc3QoaW5mby0+ZG9taWQpKSB7Ci0gICAgICAgICAg
ICAgICAgTE9HRUQoRVJST1IsIGxvY2FsX2RvbWlkLCAiZG9tYWluIGlkIHJlY2VudGx5IHVzZWQi
KTsKLSAgICAgICAgICAgICAgICByYyA9IEVSUk9SX0ZBSUw7Ci0gICAgICAgICAgICAgICAgZ290
byBvdXQ7Ci0gICAgICAgICAgICB9Ci0KLSAgICAgICAgICAgIC8qCi0gICAgICAgICAgICAgKiBU
aGUgZG9tYWluIGlzIHJlY2VudCBhbmQgc28gY2Fubm90IGJlIHVzZWQuIENsZWFyIGRvbWlkCi0g
ICAgICAgICAgICAgKiBoZXJlIHNpbmNlLCBpZiB4Y19kb21haW5fZGVzdHJveSgpIGZhaWxzIGJl
bG93IHRoZXJlIGlzCi0gICAgICAgICAgICAgKiBsaXR0bGUgcG9pbnQgY2FsbGluZyBpdCBhZ2Fp
biBpbiB0aGUgZXJyb3IgcGF0aC4KLSAgICAgICAgICAgICAqLwotICAgICAgICAgICAgKmRvbWlk
ID0gSU5WQUxJRF9ET01JRDsKLQotICAgICAgICAgICAgcmV0ID0geGNfZG9tYWluX2Rlc3Ryb3ko
Y3R4LT54Y2gsIGxvY2FsX2RvbWlkKTsKLSAgICAgICAgICAgIGlmIChyZXQgPCAwKSB7Ci0gICAg
ICAgICAgICAgICAgTE9HRUQoRVJST1IsIGxvY2FsX2RvbWlkLCAiZG9tYWluIGRlc3Ryb3kgZmFp
bCIpOwotICAgICAgICAgICAgICAgIHJjID0gRVJST1JfRkFJTDsKLSAgICAgICAgICAgICAgICBn
b3RvIG91dDsKLSAgICAgICAgICAgIH0KLQotICAgICAgICAgICAgLyogVGhlIGRvbWFpbiB3YXMg
c3VjY2Vzc2Z1bGx5IGRlc3Ryb3llZCwgc28gd2UgY2FuIHRyeSBhZ2FpbiAqLwotICAgICAgICB9
Ci0KLSAgICAgICAgcmMgPSBsaWJ4bF9fYXJjaF9kb21haW5fc2F2ZV9jb25maWcoZ2MsIGRfY29u
ZmlnLCBzdGF0ZSwgJmNyZWF0ZSk7Ci0gICAgICAgIGlmIChyYyA8IDApCi0gICAgICAgICAgICBn
b3RvIG91dDsKLSAgICB9Ci0KLSAgICAvKgotICAgICAqIElmIHNvZnRfcmVzZXQgaXMgc2V0IHRo
ZSB0aGUgZG9taWQgd2lsbCBoYXZlIGJlZW4gdmFsaWQgb24gZW50cnkuCi0gICAgICogSWYgaXQg
d2FzIG5vdCBzZXQgdGhlbiB4Y19kb21haW5fY3JlYXRlKCkgc2hvdWxkIGhhdmUgYXNzaWduZWQg
YQotICAgICAqIHZhbGlkIHZhbHVlLiBFaXRoZXIgd2F5LCBpZiB3ZSByZWFjaCB0aGlzIHBvaW50
LCBkb21pZCBzaG91bGQgYmUKLSAgICAgKiB2YWxpZC4KLSAgICAgKi8KLSAgICBhc3NlcnQobGli
eGxfZG9taWRfdmFsaWRfZ3Vlc3QoKmRvbWlkKSk7Ci0KLSAgICByZXQgPSB4Y19jcHVwb29sX21v
dmVkb21haW4oY3R4LT54Y2gsIGluZm8tPnBvb2xpZCwgKmRvbWlkKTsKLSAgICBpZiAocmV0IDwg
MCkgewotICAgICAgICBMT0dFRChFUlJPUiwgKmRvbWlkLCAiZG9tYWluIG1vdmUgZmFpbCIpOwot
ICAgICAgICByYyA9IEVSUk9SX0ZBSUw7Ci0gICAgICAgIGdvdG8gb3V0OwotICAgIH0KLQotICAg
IGRvbV9wYXRoID0gbGlieGxfX3hzX2dldF9kb21wYXRoKGdjLCAqZG9taWQpOworICAgIGRvbV9w
YXRoID0gbGlieGxfX3hzX2dldF9kb21wYXRoKGdjLCBkb21pZCk7CiAgICAgaWYgKCFkb21fcGF0
aCkgewogICAgICAgICByYyA9IEVSUk9SX0ZBSUw7CiAgICAgICAgIGdvdG8gb3V0OwpAQCAtNzAx
LDEyICs1NjgsMTIgQEAgaW50IGxpYnhsX19kb21haW5fbWFrZShsaWJ4bF9fZ2MgKmdjLCBsaWJ4
bF9kb21haW5fY29uZmlnICpkX2NvbmZpZywKIAogICAgIHZtX3BhdGggPSBHQ1NQUklOVEYoIi92
bS8lcyIsIHV1aWRfc3RyaW5nKTsKICAgICBpZiAoIXZtX3BhdGgpIHsKLSAgICAgICAgTE9HRChF
UlJPUiwgKmRvbWlkLCAiY2Fubm90IGFsbG9jYXRlIGNyZWF0ZSBwYXRocyIpOworICAgICAgICBM
T0dEKEVSUk9SLCBkb21pZCwgImNhbm5vdCBhbGxvY2F0ZSBjcmVhdGUgcGF0aHMiKTsKICAgICAg
ICAgcmMgPSBFUlJPUl9GQUlMOwogICAgICAgICBnb3RvIG91dDsKICAgICB9CiAKLSAgICBsaWJ4
bF9wYXRoID0gbGlieGxfX3hzX2xpYnhsX3BhdGgoZ2MsICpkb21pZCk7CisgICAgbGlieGxfcGF0
aCA9IGxpYnhsX194c19saWJ4bF9wYXRoKGdjLCBkb21pZCk7CiAgICAgaWYgKCFsaWJ4bF9wYXRo
KSB7CiAgICAgICAgIHJjID0gRVJST1JfRkFJTDsKICAgICAgICAgZ290byBvdXQ7CkBAIC03MTcs
MTAgKzU4NCwxMCBAQCBpbnQgbGlieGxfX2RvbWFpbl9tYWtlKGxpYnhsX19nYyAqZ2MsIGxpYnhs
X2RvbWFpbl9jb25maWcgKmRfY29uZmlnLAogCiAgICAgcm9wZXJtWzBdLmlkID0gMDsKICAgICBy
b3Blcm1bMF0ucGVybXMgPSBYU19QRVJNX05PTkU7Ci0gICAgcm9wZXJtWzFdLmlkID0gKmRvbWlk
OworICAgIHJvcGVybVsxXS5pZCA9IGRvbWlkOwogICAgIHJvcGVybVsxXS5wZXJtcyA9IFhTX1BF
Uk1fUkVBRDsKIAotICAgIHJ3cGVybVswXS5pZCA9ICpkb21pZDsKKyAgICByd3Blcm1bMF0uaWQg
PSBkb21pZDsKICAgICByd3Blcm1bMF0ucGVybXMgPSBYU19QRVJNX05PTkU7CiAKIHJldHJ5X3Ry
YW5zYWN0aW9uOgpAQCAtNzM4LDcgKzYwNSw3IEBAIHJldHJ5X3RyYW5zYWN0aW9uOgogICAgICAg
ICAgICAgICAgICAgICBub3Blcm0sIEFSUkFZX1NJWkUobm9wZXJtKSk7CiAKICAgICB4c193cml0
ZShjdHgtPnhzaCwgdCwgR0NTUFJJTlRGKCIlcy92bSIsIGRvbV9wYXRoKSwgdm1fcGF0aCwgc3Ry
bGVuKHZtX3BhdGgpKTsKLSAgICByYyA9IGxpYnhsX19kb21haW5fcmVuYW1lKGdjLCAqZG9taWQs
IDAsIGluZm8tPm5hbWUsIHQpOworICAgIHJjID0gbGlieGxfX2RvbWFpbl9yZW5hbWUoZ2MsIGRv
bWlkLCAwLCBpbmZvLT5uYW1lLCB0KTsKICAgICBpZiAocmMpCiAgICAgICAgIGdvdG8gb3V0Owog
CkBAIC04MTUsNyArNjgyLDcgQEAgcmV0cnlfdHJhbnNhY3Rpb246CiAKICAgICB2bV9saXN0ID0g
bGlieGxfbGlzdF92bShjdHgsICZuYl92bSk7CiAgICAgaWYgKCF2bV9saXN0KSB7Ci0gICAgICAg
IExPR0QoRVJST1IsICpkb21pZCwgImNhbm5vdCBnZXQgbnVtYmVyIG9mIHJ1bm5pbmcgZ3Vlc3Rz
Iik7CisgICAgICAgIExPR0QoRVJST1IsIGRvbWlkLCAiY2Fubm90IGdldCBudW1iZXIgb2YgcnVu
bmluZyBndWVzdHMiKTsKICAgICAgICAgcmMgPSBFUlJPUl9GQUlMOwogICAgICAgICBnb3RvIG91
dDsKICAgICB9CkBAIC04MzksNyArNzA2LDcgQEAgcmV0cnlfdHJhbnNhY3Rpb246CiAgICAgICAg
ICAgICB0ID0gMDsKICAgICAgICAgICAgIGdvdG8gcmV0cnlfdHJhbnNhY3Rpb247CiAgICAgICAg
IH0KLSAgICAgICAgTE9HRUQoRVJST1IsICpkb21pZCwgImRvbWFpbiBjcmVhdGlvbiAiInhlbnN0
b3JlIHRyYW5zYWN0aW9uIGNvbW1pdCBmYWlsZWQiKTsKKyAgICAgICAgTE9HRUQoRVJST1IsIGRv
bWlkLCAiZG9tYWluIGNyZWF0aW9uICIieGVuc3RvcmUgdHJhbnNhY3Rpb24gY29tbWl0IGZhaWxl
ZCIpOwogICAgICAgICByYyA9IEVSUk9SX0ZBSUw7CiAgICAgICAgIGdvdG8gb3V0OwogICAgIH0K
QEAgLTg1MSw2ICs3MTgsMTU1IEBAIHJldHJ5X3RyYW5zYWN0aW9uOgogICAgIHJldHVybiByYzsK
IH0KIAoraW50IGxpYnhsX19kb21haW5fbWFrZShsaWJ4bF9fZ2MgKmdjLCBsaWJ4bF9kb21haW5f
Y29uZmlnICpkX2NvbmZpZywKKyAgICAgICAgICAgICAgICAgICAgICAgbGlieGxfX2RvbWFpbl9i
dWlsZF9zdGF0ZSAqc3RhdGUsCisgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90ICpkb21p
ZCwgYm9vbCBzb2Z0X3Jlc2V0KQoreworICAgIGxpYnhsX2N0eCAqY3R4ID0gbGlieGxfX2djX293
bmVyKGdjKTsKKyAgICBpbnQgcmV0LCByYzsKKworICAgIC8qIGNvbnZlbmllbmNlIGFsaWFzZXMg
Ki8KKyAgICBsaWJ4bF9kb21haW5fY3JlYXRlX2luZm8gKmluZm8gPSAmZF9jb25maWctPmNfaW5m
bzsKKyAgICBsaWJ4bF9kb21haW5fYnVpbGRfaW5mbyAqYl9pbmZvID0gJmRfY29uZmlnLT5iX2lu
Zm87CisKKyAgICBhc3NlcnQoc29mdF9yZXNldCB8fCAqZG9taWQgPT0gSU5WQUxJRF9ET01JRCk7
CisKKyAgICBpZiAoIXNvZnRfcmVzZXQpIHsKKyAgICAgICAgc3RydWN0IHhlbl9kb21jdGxfY3Jl
YXRlZG9tYWluIGNyZWF0ZSA9IHsKKyAgICAgICAgICAgIC5zc2lkcmVmID0gaW5mby0+c3NpZHJl
ZiwKKyAgICAgICAgICAgIC5tYXhfdmNwdXMgPSBiX2luZm8tPm1heF92Y3B1cywKKyAgICAgICAg
ICAgIC5tYXhfZXZ0Y2huX3BvcnQgPSBiX2luZm8tPmV2ZW50X2NoYW5uZWxzLAorICAgICAgICAg
ICAgLm1heF9ncmFudF9mcmFtZXMgPSBiX2luZm8tPm1heF9ncmFudF9mcmFtZXMsCisgICAgICAg
ICAgICAubWF4X21hcHRyYWNrX2ZyYW1lcyA9IGJfaW5mby0+bWF4X21hcHRyYWNrX2ZyYW1lcywK
KyAgICAgICAgfTsKKworICAgICAgICBpZiAoaW5mby0+dHlwZSAhPSBMSUJYTF9ET01BSU5fVFlQ
RV9QVikgeworICAgICAgICAgICAgY3JlYXRlLmZsYWdzIHw9IFhFTl9ET01DVExfQ0RGX2h2bTsK
KyAgICAgICAgICAgIGNyZWF0ZS5mbGFncyB8PQorICAgICAgICAgICAgICAgIGxpYnhsX2RlZmJv
b2xfdmFsKGluZm8tPmhhcCkgPyBYRU5fRE9NQ1RMX0NERl9oYXAgOiAwOworICAgICAgICAgICAg
Y3JlYXRlLmZsYWdzIHw9CisgICAgICAgICAgICAgICAgbGlieGxfZGVmYm9vbF92YWwoaW5mby0+
b29zKSA/IDAgOiBYRU5fRE9NQ1RMX0NERl9vb3Nfb2ZmOworICAgICAgICB9CisKKyAgICAgICAg
YXNzZXJ0KGluZm8tPnBhc3N0aHJvdWdoICE9IExJQlhMX1BBU1NUSFJPVUdIX0RFRkFVTFQpOwor
ICAgICAgICBMT0coREVUQUlMLCAicGFzc3Rocm91Z2g6ICVzIiwKKyAgICAgICAgICAgIGxpYnhs
X3Bhc3N0aHJvdWdoX3RvX3N0cmluZyhpbmZvLT5wYXNzdGhyb3VnaCkpOworCisgICAgICAgIGlm
IChpbmZvLT5wYXNzdGhyb3VnaCAhPSBMSUJYTF9QQVNTVEhST1VHSF9ESVNBQkxFRCkKKyAgICAg
ICAgICAgIGNyZWF0ZS5mbGFncyB8PSBYRU5fRE9NQ1RMX0NERl9pb21tdTsKKworICAgICAgICBp
ZiAoaW5mby0+cGFzc3Rocm91Z2ggPT0gTElCWExfUEFTU1RIUk9VR0hfU1lOQ19QVCkKKyAgICAg
ICAgICAgIGNyZWF0ZS5pb21tdV9vcHRzIHw9IFhFTl9ET01DVExfSU9NTVVfbm9fc2hhcmVwdDsK
KworICAgICAgICAvKiBVbHRpbWF0ZWx5LCBoYW5kbGUgaXMgYW4gYXJyYXkgb2YgMTYgdWludDhf
dCwgc2FtZSBhcyB1dWlkICovCisgICAgICAgIGxpYnhsX3V1aWRfY29weShjdHgsIChsaWJ4bF91
dWlkICopJmNyZWF0ZS5oYW5kbGUsICZpbmZvLT51dWlkKTsKKworICAgICAgICByZXQgPSBsaWJ4
bF9fYXJjaF9kb21haW5fcHJlcGFyZV9jb25maWcoZ2MsIGRfY29uZmlnLCAmY3JlYXRlKTsKKyAg
ICAgICAgaWYgKHJldCA8IDApIHsKKyAgICAgICAgICAgIExPR0VEKEVSUk9SLCAqZG9taWQsICJm
YWlsIHRvIGdldCBkb21haW4gY29uZmlnIik7CisgICAgICAgICAgICByYyA9IEVSUk9SX0ZBSUw7
CisgICAgICAgICAgICBnb3RvIG91dDsKKyAgICAgICAgfQorCisgICAgICAgIGZvciAoOzspIHsK
KyAgICAgICAgICAgIHVpbnQzMl90IGxvY2FsX2RvbWlkOworICAgICAgICAgICAgYm9vbCByZWNl
bnQ7CisKKyAgICAgICAgICAgIGlmIChpbmZvLT5kb21pZCA9PSBSQU5ET01fRE9NSUQpIHsKKyAg
ICAgICAgICAgICAgICB1aW50MTZfdCB2OworCisgICAgICAgICAgICAgICAgcmV0ID0gbGlieGxf
X3JhbmRvbV9ieXRlcyhnYywgKHZvaWQgKikmdiwgc2l6ZW9mKHYpKTsKKyAgICAgICAgICAgICAg
ICBpZiAocmV0IDwgMCkKKyAgICAgICAgICAgICAgICAgICAgYnJlYWs7CisKKyAgICAgICAgICAg
ICAgICB2ICY9IERPTUlEX01BU0s7CisgICAgICAgICAgICAgICAgaWYgKCFsaWJ4bF9kb21pZF92
YWxpZF9ndWVzdCh2KSkKKyAgICAgICAgICAgICAgICAgICAgY29udGludWU7CisKKyAgICAgICAg
ICAgICAgICBsb2NhbF9kb21pZCA9IHY7CisgICAgICAgICAgICB9IGVsc2UgeworICAgICAgICAg
ICAgICAgIGxvY2FsX2RvbWlkID0gaW5mby0+ZG9taWQ7IC8qIE1heSBub3QgYmUgdmFsaWQgKi8K
KyAgICAgICAgICAgIH0KKworICAgICAgICAgICAgcmV0ID0geGNfZG9tYWluX2NyZWF0ZShjdHgt
PnhjaCwgJmxvY2FsX2RvbWlkLCAmY3JlYXRlKTsKKyAgICAgICAgICAgIGlmIChyZXQgPCAwKSB7
CisgICAgICAgICAgICAgICAgLyoKKyAgICAgICAgICAgICAgICAgKiBJZiB3ZSBnZW5lcmF0ZWQg
YSByYW5kb20gZG9taWQgYW5kIGNyZWF0aW9uIGZhaWxlZAorICAgICAgICAgICAgICAgICAqIGJl
Y2F1c2UgdGhhdCBkb21pZCBhbHJlYWR5IGV4aXN0cyB0aGVuIHNpbXBseSB0cnkKKyAgICAgICAg
ICAgICAgICAgKiBhZ2Fpbi4KKyAgICAgICAgICAgICAgICAgKi8KKyAgICAgICAgICAgICAgICBp
ZiAoZXJybm8gPT0gRUVYSVNUICYmIGluZm8tPmRvbWlkID09IFJBTkRPTV9ET01JRCkKKyAgICAg
ICAgICAgICAgICAgICAgY29udGludWU7CisKKyAgICAgICAgICAgICAgICBMT0dFRChFUlJPUiwg
bG9jYWxfZG9taWQsICJkb21haW4gY3JlYXRpb24gZmFpbCIpOworICAgICAgICAgICAgICAgIHJj
ID0gRVJST1JfRkFJTDsKKyAgICAgICAgICAgICAgICBnb3RvIG91dDsKKyAgICAgICAgICAgIH0K
KworICAgICAgICAgICAgLyogQSBuZXcgZG9tYWluIG5vdyBleGlzdHMgKi8KKyAgICAgICAgICAg
ICpkb21pZCA9IGxvY2FsX2RvbWlkOworCisgICAgICAgICAgICByYyA9IGxpYnhsX19pc19kb21p
ZF9yZWNlbnQoZ2MsIGxvY2FsX2RvbWlkLCAmcmVjZW50KTsKKyAgICAgICAgICAgIGlmIChyYykK
KyAgICAgICAgICAgICAgICBnb3RvIG91dDsKKworICAgICAgICAgICAgLyogVGhlIGRvbWlkIGlz
IG5vdCByZWNlbnQsIHNvIHdlJ3JlIGRvbmUgKi8KKyAgICAgICAgICAgIGlmICghcmVjZW50KQor
ICAgICAgICAgICAgICAgIGJyZWFrOworCisgICAgICAgICAgICAvKgorICAgICAgICAgICAgICog
SWYgdGhlIGRvbWlkIHdhcyBzcGVjaWZpZWQgdGhlbiB0aGVyZSdzIG5vIHBvaW50IGluCisgICAg
ICAgICAgICAgKiB0cnlpbmcgYWdhaW4uCisgICAgICAgICAgICAgKi8KKyAgICAgICAgICAgIGlm
IChsaWJ4bF9kb21pZF92YWxpZF9ndWVzdChpbmZvLT5kb21pZCkpIHsKKyAgICAgICAgICAgICAg
ICBMT0dFRChFUlJPUiwgbG9jYWxfZG9taWQsICJkb21haW4gaWQgcmVjZW50bHkgdXNlZCIpOwor
ICAgICAgICAgICAgICAgIHJjID0gRVJST1JfRkFJTDsKKyAgICAgICAgICAgICAgICBnb3RvIG91
dDsKKyAgICAgICAgICAgIH0KKworICAgICAgICAgICAgLyoKKyAgICAgICAgICAgICAqIFRoZSBk
b21haW4gaXMgcmVjZW50IGFuZCBzbyBjYW5ub3QgYmUgdXNlZC4gQ2xlYXIgZG9taWQKKyAgICAg
ICAgICAgICAqIGhlcmUgc2luY2UsIGlmIHhjX2RvbWFpbl9kZXN0cm95KCkgZmFpbHMgYmVsb3cg
dGhlcmUgaXMKKyAgICAgICAgICAgICAqIGxpdHRsZSBwb2ludCBjYWxsaW5nIGl0IGFnYWluIGlu
IHRoZSBlcnJvciBwYXRoLgorICAgICAgICAgICAgICovCisgICAgICAgICAgICAqZG9taWQgPSBJ
TlZBTElEX0RPTUlEOworCisgICAgICAgICAgICByZXQgPSB4Y19kb21haW5fZGVzdHJveShjdHgt
PnhjaCwgbG9jYWxfZG9taWQpOworICAgICAgICAgICAgaWYgKHJldCA8IDApIHsKKyAgICAgICAg
ICAgICAgICBMT0dFRChFUlJPUiwgbG9jYWxfZG9taWQsICJkb21haW4gZGVzdHJveSBmYWlsIik7
CisgICAgICAgICAgICAgICAgcmMgPSBFUlJPUl9GQUlMOworICAgICAgICAgICAgICAgIGdvdG8g
b3V0OworICAgICAgICAgICAgfQorCisgICAgICAgICAgICAvKiBUaGUgZG9tYWluIHdhcyBzdWNj
ZXNzZnVsbHkgZGVzdHJveWVkLCBzbyB3ZSBjYW4gdHJ5IGFnYWluICovCisgICAgICAgIH0KKwor
ICAgICAgICByYyA9IGxpYnhsX19hcmNoX2RvbWFpbl9zYXZlX2NvbmZpZyhnYywgZF9jb25maWcs
IHN0YXRlLCAmY3JlYXRlKTsKKyAgICAgICAgaWYgKHJjIDwgMCkKKyAgICAgICAgICAgIGdvdG8g
b3V0OworICAgIH0KKworICAgIC8qCisgICAgICogSWYgc29mdF9yZXNldCBpcyBzZXQgdGhlIHRo
ZSBkb21pZCB3aWxsIGhhdmUgYmVlbiB2YWxpZCBvbiBlbnRyeS4KKyAgICAgKiBJZiBpdCB3YXMg
bm90IHNldCB0aGVuIHhjX2RvbWFpbl9jcmVhdGUoKSBzaG91bGQgaGF2ZSBhc3NpZ25lZCBhCisg
ICAgICogdmFsaWQgdmFsdWUuIEVpdGhlciB3YXksIGlmIHdlIHJlYWNoIHRoaXMgcG9pbnQsIGRv
bWlkIHNob3VsZCBiZQorICAgICAqIHZhbGlkLgorICAgICAqLworICAgIGFzc2VydChsaWJ4bF9k
b21pZF92YWxpZF9ndWVzdCgqZG9taWQpKTsKKworICAgIHJldCA9IHhjX2NwdXBvb2xfbW92ZWRv
bWFpbihjdHgtPnhjaCwgaW5mby0+cG9vbGlkLCAqZG9taWQpOworICAgIGlmIChyZXQgPCAwKSB7
CisgICAgICAgIExPR0VEKEVSUk9SLCAqZG9taWQsICJkb21haW4gbW92ZSBmYWlsIik7CisgICAg
ICAgIHJjID0gRVJST1JfRkFJTDsKKyAgICAgICAgZ290byBvdXQ7CisgICAgfQorCisgICAgcmMg
PSBsaWJ4bF9fZG9tYWluX21ha2VfeHNfZW50cmllcyhnYywgZF9jb25maWcsIHN0YXRlLCAqZG9t
aWQpOworCitvdXQ6CisgICAgcmV0dXJuIHJjOworfQorCiBzdGF0aWMgaW50IHN0b3JlX2xpYnhs
X2VudHJ5KGxpYnhsX19nYyAqZ2MsIHVpbnQzMl90IGRvbWlkLAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBsaWJ4bF9kb21haW5fYnVpbGRfaW5mbyAqYl9pbmZvKQogewpAQCAtMTE3Miwx
NiArMTE4OCwzMiBAQCBzdGF0aWMgdm9pZCBpbml0aWF0ZV9kb21haW5fY3JlYXRlKGxpYnhsX19l
Z2MgKmVnYywKICAgICByZXQgPSBsaWJ4bF9fZG9tYWluX2NvbmZpZ19zZXRkZWZhdWx0KGdjLGRf
Y29uZmlnLGRvbWlkKTsKICAgICBpZiAocmV0KSBnb3RvIGVycm9yX291dDsKIAotICAgIHJldCA9
IGxpYnhsX19kb21haW5fbWFrZShnYywgZF9jb25maWcsICZkY3MtPmJ1aWxkX3N0YXRlLCAmZG9t
aWQsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRjcy0+c29mdF9yZXNldCk7Ci0gICAg
aWYgKHJldCkgewotICAgICAgICBMT0dEKEVSUk9SLCBkb21pZCwgImNhbm5vdCBtYWtlIGRvbWFp
bjogJWQiLCByZXQpOworICAgIGlmICggIWRfY29uZmlnLT5kbV9yZXN0b3JlX2ZpbGUgKQorICAg
IHsKKyAgICAgICAgcmV0ID0gbGlieGxfX2RvbWFpbl9tYWtlKGdjLCBkX2NvbmZpZywgJmRjcy0+
YnVpbGRfc3RhdGUsICZkb21pZCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRj
cy0+c29mdF9yZXNldCk7CiAgICAgICAgIGRjcy0+Z3Vlc3RfZG9taWQgPSBkb21pZDsKKworICAg
ICAgICBpZiAocmV0KSB7CisgICAgICAgICAgICBMT0dEKEVSUk9SLCBkb21pZCwgImNhbm5vdCBt
YWtlIGRvbWFpbjogJWQiLCByZXQpOworICAgICAgICAgICAgcmV0ID0gRVJST1JfRkFJTDsKKyAg
ICAgICAgICAgIGdvdG8gZXJyb3Jfb3V0OworICAgICAgICB9CisgICAgfSBlbHNlIGlmICggZGNz
LT5ndWVzdF9kb21pZCAhPSBJTlZBTElEX0RPTUlEICkgeworICAgICAgICBkb21pZCA9IGRjcy0+
Z3Vlc3RfZG9taWQ7CisKKyAgICAgICAgcmV0ID0gbGlieGxfX2RvbWFpbl9tYWtlX3hzX2VudHJp
ZXMoZ2MsIGRfY29uZmlnLCAmZGNzLT5idWlsZF9zdGF0ZSwgZG9taWQpOworICAgICAgICBpZiAo
cmV0KSB7CisgICAgICAgICAgICBMT0dEKEVSUk9SLCBkb21pZCwgImNhbm5vdCBtYWtlIGRvbWFp
bjogJWQiLCByZXQpOworICAgICAgICAgICAgcmV0ID0gRVJST1JfRkFJTDsKKyAgICAgICAgICAg
IGdvdG8gZXJyb3Jfb3V0OworICAgICAgICB9CisgICAgfSBlbHNlIHsKKyAgICAgICAgTE9HRChF
UlJPUiwgZG9taWQsICJjYW5ub3QgbWFrZSBkb21haW4iKTsKICAgICAgICAgcmV0ID0gRVJST1Jf
RkFJTDsKICAgICAgICAgZ290byBlcnJvcl9vdXQ7CiAgICAgfQogCi0gICAgZGNzLT5ndWVzdF9k
b21pZCA9IGRvbWlkOwogICAgIGRjcy0+c2Rzcy5kbS5ndWVzdF9kb21pZCA9IDA7IC8qIG1lYW5z
IHdlIGhhdmVuJ3Qgc3Bhd25lZCAqLwogCiAgICAgLyogcG9zdC00LjEzIHRvZG86IG1vdmUgdGhl
c2UgbmV4dCBiaXRzIG9mIGRlZmF1bHRpbmcgdG8KQEAgLTEyMTcsNyArMTI0OSw3IEBAIHN0YXRp
YyB2b2lkIGluaXRpYXRlX2RvbWFpbl9jcmVhdGUobGlieGxfX2VnYyAqZWdjLAogICAgIGlmIChy
ZXQpCiAgICAgICAgIGdvdG8gZXJyb3Jfb3V0OwogCi0gICAgaWYgKHJlc3RvcmVfZmQgPj0gMCB8
fCBkY3MtPnNvZnRfcmVzZXQpIHsKKyAgICBpZiAocmVzdG9yZV9mZCA+PSAwIHx8IGRjcy0+c29m
dF9yZXNldCB8fCBkX2NvbmZpZy0+ZG1fcmVzdG9yZV9maWxlKSB7CiAgICAgICAgIExPR0QoREVC
VUcsIGRvbWlkLCAicmVzdG9yaW5nLCBub3QgcnVubmluZyBib290bG9hZGVyIik7CiAgICAgICAg
IGRvbWNyZWF0ZV9ib290bG9hZGVyX2RvbmUoZWdjLCAmZGNzLT5ibCwgMCk7CiAgICAgfSBlbHNl
ICB7CkBAIC0xMjkzLDcgKzEzMjUsMTYgQEAgc3RhdGljIHZvaWQgZG9tY3JlYXRlX2Jvb3Rsb2Fk
ZXJfZG9uZShsaWJ4bF9fZWdjICplZ2MsCiAgICAgZGNzLT5zZHNzLmRtLmNhbGxiYWNrID0gZG9t
Y3JlYXRlX2Rldm1vZGVsX3N0YXJ0ZWQ7CiAgICAgZGNzLT5zZHNzLmNhbGxiYWNrID0gZG9tY3Jl
YXRlX2Rldm1vZGVsX3N0YXJ0ZWQ7CiAKLSAgICBpZiAocmVzdG9yZV9mZCA8IDAgJiYgIWRjcy0+
c29mdF9yZXNldCkgeworICAgIGlmIChyZXN0b3JlX2ZkIDwgMCAmJiAhZGNzLT5zb2Z0X3Jlc2V0
ICYmICFkX2NvbmZpZy0+ZG1fcmVzdG9yZV9maWxlKSB7CisgICAgICAgIHJjID0gbGlieGxfX2Rv
bWFpbl9idWlsZChnYywgZF9jb25maWcsIGRvbWlkLCBzdGF0ZSk7CisgICAgICAgIGRvbWNyZWF0
ZV9yZWJ1aWxkX2RvbmUoZWdjLCBkY3MsIHJjKTsKKyAgICAgICAgcmV0dXJuOworICAgIH0KKwor
ICAgIGlmICggZF9jb25maWctPmRtX3Jlc3RvcmVfZmlsZSApIHsKKyAgICAgICAgZGNzLT5zcnMu
ZGNzID0gZGNzOworICAgICAgICBkY3MtPnNycy5hbyA9IGFvOworICAgICAgICBzdGF0ZS0+Zm9y
a2VkX3ZtID0gdHJ1ZTsKICAgICAgICAgcmMgPSBsaWJ4bF9fZG9tYWluX2J1aWxkKGdjLCBkX2Nv
bmZpZywgZG9taWQsIHN0YXRlKTsKICAgICAgICAgZG9tY3JlYXRlX3JlYnVpbGRfZG9uZShlZ2Ms
IGRjcywgcmMpOwogICAgICAgICByZXR1cm47CkBAIC0xNDkxLDYgKzE1MzIsNyBAQCBzdGF0aWMg
dm9pZCBkb21jcmVhdGVfcmVidWlsZF9kb25lKGxpYnhsX19lZ2MgKmVnYywKICAgICAvKiBjb252
ZW5pZW5jZSBhbGlhc2VzICovCiAgICAgY29uc3QgdWludDMyX3QgZG9taWQgPSBkY3MtPmd1ZXN0
X2RvbWlkOwogICAgIGxpYnhsX2RvbWFpbl9jb25maWcgKmNvbnN0IGRfY29uZmlnID0gZGNzLT5n
dWVzdF9jb25maWc7CisgICAgbGlieGxfX2RvbWFpbl9idWlsZF9zdGF0ZSAqY29uc3Qgc3RhdGUg
PSAmZGNzLT5idWlsZF9zdGF0ZTsKIAogICAgIGlmIChyZXQpIHsKICAgICAgICAgTE9HRChFUlJP
UiwgZG9taWQsICJjYW5ub3QgKHJlLSlidWlsZCBkb21haW46ICVkIiwgcmV0KTsKQEAgLTE0OTgs
NiArMTU0MCw5IEBAIHN0YXRpYyB2b2lkIGRvbWNyZWF0ZV9yZWJ1aWxkX2RvbmUobGlieGxfX2Vn
YyAqZWdjLAogICAgICAgICBnb3RvIGVycm9yX291dDsKICAgICB9CiAKKyAgICBpZiAoIGRfY29u
ZmlnLT5kbV9yZXN0b3JlX2ZpbGUgKQorICAgICAgICBzdGF0ZS0+c2F2ZWRfc3RhdGUgPSBHQ1NQ
UklOVEYoIiVzIiwgZF9jb25maWctPmRtX3Jlc3RvcmVfZmlsZSk7CisKICAgICBzdG9yZV9saWJ4
bF9lbnRyeShnYywgZG9taWQsICZkX2NvbmZpZy0+Yl9pbmZvKTsKIAogICAgIGxpYnhsX19tdWx0
aWRldl9iZWdpbihhbywgJmRjcy0+bXVsdGlkZXYpOwpAQCAtMTg4Niw3ICsxOTMxLDcgQEAgc3Rh
dGljIHZvaWQgZG9tYWluX2NyZWF0ZV9jYihsaWJ4bF9fZWdjICplZ2MsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGxpYnhsX19kb21haW5fY3JlYXRlX3N0YXRlICpkY3MsCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGludCByYywgdWludDMyX3QgZG9taWQpOwogCi1zdGF0aWMg
aW50IGRvX2RvbWFpbl9jcmVhdGUobGlieGxfY3R4ICpjdHgsIGxpYnhsX2RvbWFpbl9jb25maWcg
KmRfY29uZmlnLAoraW50IGxpYnhsX19kb19kb21haW5fY3JlYXRlKGxpYnhsX2N0eCAqY3R4LCBs
aWJ4bF9kb21haW5fY29uZmlnICpkX2NvbmZpZywKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICB1aW50MzJfdCAqZG9taWQsIGludCByZXN0b3JlX2ZkLCBpbnQgc2VuZF9iYWNrX2ZkLAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxpYnhsX2RvbWFpbl9yZXN0b3JlX3BhcmFt
cyAqcGFyYW1zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxpYnhsX2FzeW5j
b3BfaG93ICphb19ob3csCkBAIC0xODk5LDYgKzE5NDQsOCBAQCBzdGF0aWMgaW50IGRvX2RvbWFp
bl9jcmVhdGUobGlieGxfY3R4ICpjdHgsIGxpYnhsX2RvbWFpbl9jb25maWcgKmRfY29uZmlnLAog
ICAgIEdDTkVXKGNkY3MpOwogICAgIGNkY3MtPmRjcy5hbyA9IGFvOwogICAgIGNkY3MtPmRjcy5n
dWVzdF9jb25maWcgPSBkX2NvbmZpZzsKKyAgICBjZGNzLT5kY3MuZ3Vlc3RfZG9taWQgPSAqZG9t
aWQ7CisKICAgICBsaWJ4bF9kb21haW5fY29uZmlnX2luaXQoJmNkY3MtPmRjcy5ndWVzdF9jb25m
aWdfc2F2ZWQpOwogICAgIGxpYnhsX2RvbWFpbl9jb25maWdfY29weShjdHgsICZjZGNzLT5kY3Mu
Z3Vlc3RfY29uZmlnX3NhdmVkLCBkX2NvbmZpZyk7CiAgICAgY2Rjcy0+ZGNzLnJlc3RvcmVfZmQg
PSBjZGNzLT5kY3MubGlieGNfZmQgPSByZXN0b3JlX2ZkOwpAQCAtMjE0Myw4ICsyMTkwLDggQEAg
aW50IGxpYnhsX2RvbWFpbl9jcmVhdGVfbmV3KGxpYnhsX2N0eCAqY3R4LCBsaWJ4bF9kb21haW5f
Y29uZmlnICpkX2NvbmZpZywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsaWJ4
bF9hc3luY3Byb2dyZXNzX2hvdyAqYW9wX2NvbnNvbGVfaG93KQogewogICAgIHVuc2V0X2Rpc2tf
Y29sb19yZXN0b3JlKGRfY29uZmlnKTsKLSAgICByZXR1cm4gZG9fZG9tYWluX2NyZWF0ZShjdHgs
IGRfY29uZmlnLCBkb21pZCwgLTEsIC0xLCBOVUxMLAotICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGFvX2hvdywgYW9wX2NvbnNvbGVfaG93KTsKKyAgICByZXR1cm4gbGlieGxfX2RvX2RvbWFp
bl9jcmVhdGUoY3R4LCBkX2NvbmZpZywgZG9taWQsIC0xLCAtMSwgTlVMTCwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBhb19ob3csIGFvcF9jb25zb2xlX2hvdyk7CiB9CiAKIGlu
dCBsaWJ4bF9kb21haW5fY3JlYXRlX3Jlc3RvcmUobGlieGxfY3R4ICpjdHgsIGxpYnhsX2RvbWFp
bl9jb25maWcgKmRfY29uZmlnLApAQCAtMjE2MCw4ICsyMjA3LDggQEAgaW50IGxpYnhsX2RvbWFp
bl9jcmVhdGVfcmVzdG9yZShsaWJ4bF9jdHggKmN0eCwgbGlieGxfZG9tYWluX2NvbmZpZyAqZF9j
b25maWcsCiAgICAgICAgIHVuc2V0X2Rpc2tfY29sb19yZXN0b3JlKGRfY29uZmlnKTsKICAgICB9
CiAKLSAgICByZXR1cm4gZG9fZG9tYWluX2NyZWF0ZShjdHgsIGRfY29uZmlnLCBkb21pZCwgcmVz
dG9yZV9mZCwgc2VuZF9iYWNrX2ZkLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFt
cywgYW9faG93LCBhb3BfY29uc29sZV9ob3cpOworICAgIHJldHVybiBsaWJ4bF9fZG9fZG9tYWlu
X2NyZWF0ZShjdHgsIGRfY29uZmlnLCBkb21pZCwgcmVzdG9yZV9mZCwgc2VuZF9iYWNrX2ZkLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXMsIGFvX2hvdywgYW9wX2Nv
bnNvbGVfaG93KTsKIH0KIAogaW50IGxpYnhsX2RvbWFpbl9zb2Z0X3Jlc2V0KGxpYnhsX2N0eCAq
Y3R4LApkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGlieGxfZG0uYyBiL3Rvb2xzL2xpYnhsL2xp
YnhsX2RtLmMKaW5kZXggZjQwMDdiYmU1MC4uYjYxNWYxZmM4OCAxMDA2NDQKLS0tIGEvdG9vbHMv
bGlieGwvbGlieGxfZG0uYworKysgYi90b29scy9saWJ4bC9saWJ4bF9kbS5jCkBAIC0yODAzLDcg
KzI4MDMsNyBAQCBzdGF0aWMgdm9pZCBkZXZpY2VfbW9kZWxfc3Bhd25fb3V0Y29tZShsaWJ4bF9f
ZWdjICplZ2MsCiAKICAgICBsaWJ4bF9fZG9tYWluX2J1aWxkX3N0YXRlICpzdGF0ZSA9IGRtc3Mt
PmJ1aWxkX3N0YXRlOwogCi0gICAgaWYgKHN0YXRlLT5zYXZlZF9zdGF0ZSkgeworICAgIGlmIChz
dGF0ZS0+c2F2ZWRfc3RhdGUgJiYgIXN0YXRlLT5mb3JrZWRfdm0pIHsKICAgICAgICAgcmV0MiA9
IHVubGluayhzdGF0ZS0+c2F2ZWRfc3RhdGUpOwogICAgICAgICBpZiAocmV0MikgewogICAgICAg
ICAgICAgTE9HRUQoRVJST1IsIGRtc3MtPmd1ZXN0X2RvbWlkLCAiJXM6IGZhaWxlZCB0byByZW1v
dmUgZGV2aWNlLW1vZGVsIHN0YXRlICVzIiwKZGlmZiAtLWdpdCBhL3Rvb2xzL2xpYnhsL2xpYnhs
X2RvbS5jIGIvdG9vbHMvbGlieGwvbGlieGxfZG9tLmMKaW5kZXggNzFjYjU3ODkyMy4uM2JjNzEx
N2I5OSAxMDA2NDQKLS0tIGEvdG9vbHMvbGlieGwvbGlieGxfZG9tLmMKKysrIGIvdG9vbHMvbGli
eGwvbGlieGxfZG9tLmMKQEAgLTI0OSw5ICsyNDksMTIgQEAgaW50IGxpYnhsX19idWlsZF9wcmUo
bGlieGxfX2djICpnYywgdWludDMyX3QgZG9taWQsCiAgICAgbGlieGxfZG9tYWluX2J1aWxkX2lu
Zm8gKmNvbnN0IGluZm8gPSAmZF9jb25maWctPmJfaW5mbzsKICAgICBsaWJ4bF9jdHggKmN0eCA9
IGxpYnhsX19nY19vd25lcihnYyk7CiAgICAgY2hhciAqeHNfZG9taWQsICpjb25fZG9taWQ7Ci0g
ICAgaW50IHJjOworICAgIGludCByYyA9IDA7CiAgICAgdWludDY0X3Qgc2l6ZTsKIAorICAgIGlm
ICggc3RhdGUtPmZvcmtlZF92bSApCisgICAgICAgIGdvdG8gc2tpcF9mb3JrOworCiAgICAgaWYg
KHhjX2RvbWFpbl9tYXhfdmNwdXMoY3R4LT54Y2gsIGRvbWlkLCBpbmZvLT5tYXhfdmNwdXMpICE9
IDApIHsKICAgICAgICAgTE9HKEVSUk9SLCAiQ291bGRuJ3Qgc2V0IG1heCB2Y3B1IGNvdW50Iik7
CiAgICAgICAgIHJldHVybiBFUlJPUl9GQUlMOwpAQCAtMzYyLDcgKzM2NSw2IEBAIGludCBsaWJ4
bF9fYnVpbGRfcHJlKGxpYnhsX19nYyAqZ2MsIHVpbnQzMl90IGRvbWlkLAogICAgICAgICB9CiAg
ICAgfQogCi0KICAgICByYyA9IGxpYnhsX19hcmNoX2V4dHJhX21lbW9yeShnYywgaW5mbywgJnNp
emUpOwogICAgIGlmIChyYyA8IDApIHsKICAgICAgICAgTE9HRShFUlJPUiwgIkNvdWxkbid0IGdl
dCBhcmNoIGV4dHJhIGNvbnN0YW50IG1lbW9yeSBzaXplIik7CkBAIC0zNzQsNiArMzc2LDExIEBA
IGludCBsaWJ4bF9fYnVpbGRfcHJlKGxpYnhsX19nYyAqZ2MsIHVpbnQzMl90IGRvbWlkLAogICAg
ICAgICByZXR1cm4gRVJST1JfRkFJTDsKICAgICB9CiAKKyAgICByYyA9IGxpYnhsX19hcmNoX2Rv
bWFpbl9jcmVhdGUoZ2MsIGRfY29uZmlnLCBkb21pZCk7CisgICAgaWYgKCByYyApCisgICAgICAg
IGdvdG8gb3V0OworCitza2lwX2Zvcms6CiAgICAgeHNfZG9taWQgPSB4c19yZWFkKGN0eC0+eHNo
LCBYQlRfTlVMTCwgIi90b29sL3hlbnN0b3JlZC9kb21pZCIsIE5VTEwpOwogICAgIHN0YXRlLT5z
dG9yZV9kb21pZCA9IHhzX2RvbWlkID8gYXRvaSh4c19kb21pZCkgOiAwOwogICAgIGZyZWUoeHNf
ZG9taWQpOwpAQCAtMzg1LDggKzM5Miw3IEBAIGludCBsaWJ4bF9fYnVpbGRfcHJlKGxpYnhsX19n
YyAqZ2MsIHVpbnQzMl90IGRvbWlkLAogICAgIHN0YXRlLT5zdG9yZV9wb3J0ID0geGNfZXZ0Y2hu
X2FsbG9jX3VuYm91bmQoY3R4LT54Y2gsIGRvbWlkLCBzdGF0ZS0+c3RvcmVfZG9taWQpOwogICAg
IHN0YXRlLT5jb25zb2xlX3BvcnQgPSB4Y19ldnRjaG5fYWxsb2NfdW5ib3VuZChjdHgtPnhjaCwg
ZG9taWQsIHN0YXRlLT5jb25zb2xlX2RvbWlkKTsKIAotICAgIHJjID0gbGlieGxfX2FyY2hfZG9t
YWluX2NyZWF0ZShnYywgZF9jb25maWcsIGRvbWlkKTsKLQorb3V0OgogICAgIHJldHVybiByYzsK
IH0KIApAQCAtNDQ0LDYgKzQ1MCw5IEBAIGludCBsaWJ4bF9fYnVpbGRfcG9zdChsaWJ4bF9fZ2Mg
KmdjLCB1aW50MzJfdCBkb21pZCwKICAgICBjaGFyICoqZW50czsKICAgICBpbnQgaSwgcmM7CiAK
KyAgICBpZiAoIHN0YXRlLT5mb3JrZWRfdm0gKQorICAgICAgICBnb3RvIHNraXBfZm9yazsKKwog
ICAgIGlmIChpbmZvLT5udW1fdm51bWFfbm9kZXMgJiYgIWluZm8tPm51bV92Y3B1X3NvZnRfYWZm
aW5pdHkpIHsKICAgICAgICAgcmMgPSBzZXRfdm51bWFfYWZmaW5pdHkoZ2MsIGRvbWlkLCBpbmZv
KTsKICAgICAgICAgaWYgKHJjKQpAQCAtNDY2LDYgKzQ3NSw3IEBAIGludCBsaWJ4bF9fYnVpbGRf
cG9zdChsaWJ4bF9fZ2MgKmdjLCB1aW50MzJfdCBkb21pZCwKICAgICAgICAgfQogICAgIH0KIAor
c2tpcF9mb3JrOgogICAgIGVudHMgPSBsaWJ4bF9fY2FsbG9jKGdjLCAxMiArIChpbmZvLT5tYXhf
dmNwdXMgKiAyKSArIDIsIHNpemVvZihjaGFyICopKTsKICAgICBlbnRzWzBdID0gIm1lbW9yeS9z
dGF0aWMtbWF4IjsKICAgICBlbnRzWzFdID0gR0NTUFJJTlRGKCIlIlBSSWQ2NCwgaW5mby0+bWF4
X21lbWtiKTsKQEAgLTcyOCwxNCArNzM4LDE2IEBAIHN0YXRpYyBpbnQgaHZtX2J1aWxkX3NldF9w
YXJhbXMoeGNfaW50ZXJmYWNlICpoYW5kbGUsIHVpbnQzMl90IGRvbWlkLAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBsaWJ4bF9kb21haW5fYnVpbGRfaW5mbyAqaW5mbywKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IHN0b3JlX2V2dGNobiwgdW5zaWduZWQgbG9u
ZyAqc3RvcmVfbWZuLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgY29uc29s
ZV9ldnRjaG4sIHVuc2lnbmVkIGxvbmcgKmNvbnNvbGVfbWZuLAotICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBkb21pZF90IHN0b3JlX2RvbWlkLCBkb21pZF90IGNvbnNvbGVfZG9taWQp
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvbWlkX3Qgc3RvcmVfZG9taWQsIGRv
bWlkX3QgY29uc29sZV9kb21pZCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9v
bCBmb3JrZWRfdm0pCiB7CiAgICAgc3RydWN0IGh2bV9pbmZvX3RhYmxlICp2YV9odm07CiAgICAg
dWludDhfdCAqdmFfbWFwLCBzdW07CiAgICAgdWludDY0X3Qgc3RyX21mbiwgY29uc19tZm47CiAg
ICAgaW50IGk7CiAKLSAgICBpZiAoaW5mby0+dHlwZSA9PSBMSUJYTF9ET01BSU5fVFlQRV9IVk0p
IHsKKyAgICBpZiAoIGluZm8tPnR5cGUgPT0gTElCWExfRE9NQUlOX1RZUEVfSFZNICYmICFmb3Jr
ZWRfdm0gKQorICAgIHsKICAgICAgICAgdmFfbWFwID0geGNfbWFwX2ZvcmVpZ25fcmFuZ2UoaGFu
ZGxlLCBkb21pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWENfUEFH
RV9TSVpFLCBQUk9UX1JFQUQgfCBQUk9UX1dSSVRFLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBIVk1fSU5GT19QRk4pOwpAQCAtMTA1MSw2ICsxMDYzLDIzIEBAIGludCBs
aWJ4bF9fYnVpbGRfaHZtKGxpYnhsX19nYyAqZ2MsIHVpbnQzMl90IGRvbWlkLAogICAgIHN0cnVj
dCB4Y19kb21faW1hZ2UgKmRvbSA9IE5VTEw7CiAgICAgYm9vbCBkZXZpY2VfbW9kZWwgPSBpbmZv
LT50eXBlID09IExJQlhMX0RPTUFJTl9UWVBFX0hWTSA/IHRydWUgOiBmYWxzZTsKIAorICAgIGlm
ICggc3RhdGUtPmZvcmtlZF92bSApCisgICAgeworICAgICAgICByYyA9IGh2bV9idWlsZF9zZXRf
cGFyYW1zKGN0eC0+eGNoLCBkb21pZCwgaW5mbywgc3RhdGUtPnN0b3JlX3BvcnQsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgJnN0YXRlLT5zdG9yZV9tZm4sIHN0YXRlLT5jb25z
b2xlX3BvcnQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJnN0YXRlLT5jb25z
b2xlX21mbiwgc3RhdGUtPnN0b3JlX2RvbWlkLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHN0YXRlLT5jb25zb2xlX2RvbWlkLCBzdGF0ZS0+Zm9ya2VkX3ZtKTsKKworICAgICAg
ICBpZiAoIHJjICkKKyAgICAgICAgICAgIHJldHVybiByYzsKKworICAgICAgICByZXR1cm4geGNf
ZG9tX2dudHRhYl9zZWVkKGN0eC0+eGNoLCBkb21pZCwgdHJ1ZSwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBzdGF0ZS0+Y29uc29sZV9tZm4sCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgc3RhdGUtPnN0b3JlX21mbiwKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBzdGF0ZS0+Y29uc29sZV9kb21pZCwKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBzdGF0ZS0+c3RvcmVfZG9taWQpOworICAgIH0KKwogICAgIHhjX2RvbV9sb2dp
bml0KGN0eC0+eGNoKTsKIAogICAgIC8qCkBAIC0xMTc1LDcgKzEyMDQsNyBAQCBpbnQgbGlieGxf
X2J1aWxkX2h2bShsaWJ4bF9fZ2MgKmdjLCB1aW50MzJfdCBkb21pZCwKICAgICByYyA9IGh2bV9i
dWlsZF9zZXRfcGFyYW1zKGN0eC0+eGNoLCBkb21pZCwgaW5mbywgc3RhdGUtPnN0b3JlX3BvcnQs
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJnN0YXRlLT5zdG9yZV9tZm4sIHN0YXRl
LT5jb25zb2xlX3BvcnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJnN0YXRlLT5j
b25zb2xlX21mbiwgc3RhdGUtPnN0b3JlX2RvbWlkLAotICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHN0YXRlLT5jb25zb2xlX2RvbWlkKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBzdGF0ZS0+Y29uc29sZV9kb21pZCwgZmFsc2UpOwogICAgIGlmIChyYyAhPSAwKSB7CiAg
ICAgICAgIExPRyhFUlJPUiwgImh2bSBidWlsZCBzZXQgcGFyYW1zIGZhaWxlZCIpOwogICAgICAg
ICBnb3RvIG91dDsKZGlmZiAtLWdpdCBhL3Rvb2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmggYi90
b29scy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5oCmluZGV4IDQ4OTE3MjJhNmIuLmNhYTk4MWYyZmUg
MTAwNjQ0Ci0tLSBhL3Rvb2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmgKKysrIGIvdG9vbHMvbGli
eGwvbGlieGxfaW50ZXJuYWwuaApAQCAtMTM3NCw2ICsxMzc0LDcgQEAgdHlwZWRlZiBzdHJ1Y3Qg
ewogCiAgICAgY2hhciAqc2F2ZWRfc3RhdGU7CiAgICAgaW50IGRtX21vbml0b3JfZmQ7CisgICAg
Ym9vbCBmb3JrZWRfdm07CiAKICAgICBsaWJ4bF9fZmlsZV9yZWZlcmVuY2UgcHZfa2VybmVsOwog
ICAgIGxpYnhsX19maWxlX3JlZmVyZW5jZSBwdl9yYW1kaXNrOwpAQCAtNDgxNSw2ICs0ODE2LDEy
IEBAIF9oaWRkZW4gaW50IGxpYnhsX19kb21haW5fcHZjb250cm9sKGxpYnhsX19lZ2MgKmVnYywK
IC8qIENoZWNrIHdoZXRoZXIgYSBkb21pZCBpcyByZWNlbnQgKi8KIGludCBsaWJ4bF9faXNfZG9t
aWRfcmVjZW50KGxpYnhsX19nYyAqZ2MsIHVpbnQzMl90IGRvbWlkLCBib29sICpyZWNlbnQpOwog
CitfaGlkZGVuIGludCBsaWJ4bF9fZG9fZG9tYWluX2NyZWF0ZShsaWJ4bF9jdHggKmN0eCwgbGli
eGxfZG9tYWluX2NvbmZpZyAqZF9jb25maWcsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICB1aW50MzJfdCAqZG9taWQsIGludCByZXN0b3JlX2ZkLCBpbnQgc2VuZF9iYWNrX2Zk
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGlieGxfZG9tYWlu
X3Jlc3RvcmVfcGFyYW1zICpwYXJhbXMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBjb25zdCBsaWJ4bF9hc3luY29wX2hvdyAqYW9faG93LAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgY29uc3QgbGlieGxfYXN5bmNwcm9ncmVzc19ob3cgKmFvcF9jb25z
b2xlX2hvdyk7CisKICNlbmRpZgogCiAvKgpkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGlieGxf
dHlwZXMuaWRsIGIvdG9vbHMvbGlieGwvbGlieGxfdHlwZXMuaWRsCmluZGV4IGQwZDQzMTYxNGYu
LjU1YzI4MmIxY2QgMTAwNjQ0Ci0tLSBhL3Rvb2xzL2xpYnhsL2xpYnhsX3R5cGVzLmlkbAorKysg
Yi90b29scy9saWJ4bC9saWJ4bF90eXBlcy5pZGwKQEAgLTk1Nyw2ICs5NTcsNyBAQCBsaWJ4bF9k
b21haW5fY29uZmlnID0gU3RydWN0KCJkb21haW5fY29uZmlnIiwgWwogICAgICgib25fd2F0Y2hk
b2ciLCBsaWJ4bF9hY3Rpb25fb25fc2h1dGRvd24pLAogICAgICgib25fY3Jhc2giLCBsaWJ4bF9h
Y3Rpb25fb25fc2h1dGRvd24pLAogICAgICgib25fc29mdF9yZXNldCIsIGxpYnhsX2FjdGlvbl9v
bl9zaHV0ZG93biksCisgICAgKCJkbV9yZXN0b3JlX2ZpbGUiLCBzdHJpbmcsIHsnY29uc3QnOiBU
cnVlfSksCiAgICAgXSwgZGlyPURJUl9JTikKIAogbGlieGxfZGlza2luZm8gPSBTdHJ1Y3QoImRp
c2tpbmZvIiwgWwpkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGlieGxfeDg2LmMgYi90b29scy9s
aWJ4bC9saWJ4bF94ODYuYwppbmRleCBmOGJjODI4ZTYyLi5mNDMxMjQxMWZjIDEwMDY0NAotLS0g
YS90b29scy9saWJ4bC9saWJ4bF94ODYuYworKysgYi90b29scy9saWJ4bC9saWJ4bF94ODYuYwpA
QCAtMiw2ICsyLDcgQEAKICNpbmNsdWRlICJsaWJ4bF9hcmNoLmgiCiAKICNpbmNsdWRlIDx4Y19k
b20uaD4KKyNpbmNsdWRlIDx4ZW4teHNtL2ZsYXNrL2ZsYXNrLmg+CiAKIGludCBsaWJ4bF9fYXJj
aF9kb21haW5fcHJlcGFyZV9jb25maWcobGlieGxfX2djICpnYywKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgbGlieGxfZG9tYWluX2NvbmZpZyAqZF9jb25maWcsCkBAIC04
NDIsNiArODQzLDQ2IEBAIGludCBsaWJ4bF9fYXJjaF9wYXNzdGhyb3VnaF9tb2RlX3NldGRlZmF1
bHQobGlieGxfX2djICpnYywKICAgICByZXR1cm4gcmM7CiB9CiAKKy8qCisgKiBUaGUgcGFyZW50
IGRvbWFpbiBpcyBleHBlY3RlZCB0byBiZSBjcmVhdGVkIHdpdGggZGVmYXVsdCBzZXR0aW5ncyBm
b3IKKyAqIC0gbWF4X2V2dGNoX3BvcnQKKyAqIC0gbWF4X2dyYW50X2ZyYW1lcworICogLSBtYXhf
bWFwdHJhY2tfZnJhbWVzCisgKi8KK2ludCBsaWJ4bF9kb21haW5fZm9ya192bShsaWJ4bF9jdHgg
KmN0eCwgdWludDMyX3QgcGRvbWlkLCB1aW50MzJfdCBtYXhfdmNwdXMsIHVpbnQzMl90ICpkb21p
ZCkKK3sKKyAgICBpbnQgcmM7CisgICAgc3RydWN0IHhlbl9kb21jdGxfY3JlYXRlZG9tYWluIGNy
ZWF0ZSA9IHswfTsKKyAgICBjcmVhdGUuZmxhZ3MgfD0gWEVOX0RPTUNUTF9DREZfaHZtOworICAg
IGNyZWF0ZS5mbGFncyB8PSBYRU5fRE9NQ1RMX0NERl9oYXA7CisgICAgY3JlYXRlLmZsYWdzIHw9
IFhFTl9ET01DVExfQ0RGX29vc19vZmY7CisgICAgY3JlYXRlLmFyY2guZW11bGF0aW9uX2ZsYWdz
ID0gKFhFTl9YODZfRU1VX0FMTCAmIH5YRU5fWDg2X0VNVV9WUENJKTsKKyAgICBjcmVhdGUuc3Np
ZHJlZiA9IFNFQ0lOSVRTSURfRE9NVTsKKyAgICBjcmVhdGUubWF4X3ZjcHVzID0gbWF4X3ZjcHVz
OworICAgIGNyZWF0ZS5tYXhfZXZ0Y2huX3BvcnQgPSAxMDIzOworICAgIGNyZWF0ZS5tYXhfZ3Jh
bnRfZnJhbWVzID0gTElCWExfTUFYX0dSQU5UX0ZSQU1FU19ERUZBVUxUOworICAgIGNyZWF0ZS5t
YXhfbWFwdHJhY2tfZnJhbWVzID0gTElCWExfTUFYX01BUFRSQUNLX0ZSQU1FU19ERUZBVUxUOwor
CisgICAgaWYgKCAocmMgPSB4Y19kb21haW5fY3JlYXRlKGN0eC0+eGNoLCBkb21pZCwgJmNyZWF0
ZSkpICkKKyAgICAgICAgcmV0dXJuIHJjOworCisgICAgaWYgKCAocmMgPSB4Y19tZW1zaHJfZm9y
ayhjdHgtPnhjaCwgcGRvbWlkLCAqZG9taWQpKSApCisgICAgICAgIHhjX2RvbWFpbl9kZXN0cm95
KGN0eC0+eGNoLCAqZG9taWQpOworCisgICAgcmV0dXJuIHJjOworfQorCitpbnQgbGlieGxfZG9t
YWluX2ZvcmtfbGF1bmNoX2RtKGxpYnhsX2N0eCAqY3R4LCBsaWJ4bF9kb21haW5fY29uZmlnICpk
X2NvbmZpZywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgZG9taWQs
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxpYnhsX2FzeW5jcHJvZ3Jl
c3NfaG93ICphb3BfY29uc29sZV9ob3cpCit7CisgICAgcmV0dXJuIGxpYnhsX19kb19kb21haW5f
Y3JlYXRlKGN0eCwgZF9jb25maWcsICZkb21pZCwgLTEsIC0xLCAwLCAwLCBhb3BfY29uc29sZV9o
b3cpOworfQorCitpbnQgbGlieGxfZG9tYWluX2ZvcmtfcmVzZXQobGlieGxfY3R4ICpjdHgsIHVp
bnQzMl90IGRvbWlkKQoreworICAgIHJldHVybiB4Y19tZW1zaHJfZm9ya19yZXNldChjdHgtPnhj
aCwgZG9taWQpOworfQogCiAvKgogICogTG9jYWwgdmFyaWFibGVzOgpkaWZmIC0tZ2l0IGEvdG9v
bHMveGwvTWFrZWZpbGUgYi90b29scy94bC9NYWtlZmlsZQppbmRleCBhZjQ5MTJlNjdhLi4wNzMy
MjIyMzNiIDEwMDY0NAotLS0gYS90b29scy94bC9NYWtlZmlsZQorKysgYi90b29scy94bC9NYWtl
ZmlsZQpAQCAtMTUsNyArMTUsNyBAQCBMREZMQUdTICs9ICQoUFRIUkVBRF9MREZMQUdTKQogQ0ZM
QUdTX1hMICs9ICQoQ0ZMQUdTX2xpYnhlbmxpZ2h0KQogQ0ZMQUdTX1hMICs9IC1Xc2hhZG93CiAK
LVhMX09CSlMtJChDT05GSUdfWDg2KSA9IHhsX3Bzci5vCitYTF9PQkpTLSQoQ09ORklHX1g4Nikg
PSB4bF9wc3IubyB4bF9mb3Jrdm0ubwogWExfT0JKUyA9IHhsLm8geGxfY21kdGFibGUubyB4bF9z
eHAubyB4bF91dGlscy5vICQoWExfT0JKUy15KQogWExfT0JKUyArPSB4bF9wYXJzZS5vIHhsX2Nw
dXBvb2wubyB4bF9mbGFzay5vCiBYTF9PQkpTICs9IHhsX3Z0cG0ubyB4bF9ibG9jay5vIHhsX25p
Yy5vIHhsX3VzYi5vCmRpZmYgLS1naXQgYS90b29scy94bC94bC5oIGIvdG9vbHMveGwveGwuaApp
bmRleCAwNjU2OWM2YzRhLi4xMTA1YzM0YjE1IDEwMDY0NAotLS0gYS90b29scy94bC94bC5oCisr
KyBiL3Rvb2xzL3hsL3hsLmgKQEAgLTMxLDYgKzMxLDcgQEAgc3RydWN0IGNtZF9zcGVjIHsKIH07
CiAKIHN0cnVjdCBkb21haW5fY3JlYXRlIHsKKyAgICB1aW50MzJfdCBkZG9taWQ7IC8qIGZvcmsg
bGF1bmNoIGRtIGZvciB0aGlzIGRvbWlkICovCiAgICAgaW50IGRlYnVnOwogICAgIGludCBkYWVt
b25pemU7CiAgICAgaW50IG1vbml0b3I7IC8qIGhhbmRsZSBndWVzdCByZWJvb3RzIGV0YyAqLwpA
QCAtNDUsNiArNDYsNyBAQCBzdHJ1Y3QgZG9tYWluX2NyZWF0ZSB7CiAgICAgY29uc3QgY2hhciAq
Y29uZmlnX2ZpbGU7CiAgICAgY2hhciAqZXh0cmFfY29uZmlnOyAvKiBleHRyYSBjb25maWcgc3Ry
aW5nICovCiAgICAgY29uc3QgY2hhciAqcmVzdG9yZV9maWxlOworICAgIGNvbnN0IGNoYXIgKmRt
X3Jlc3RvcmVfZmlsZTsKICAgICBjaGFyICpjb2xvX3Byb3h5X3NjcmlwdDsKICAgICBib29sIHVz
ZXJzcGFjZV9jb2xvX3Byb3h5OwogICAgIGludCBtaWdyYXRlX2ZkOyAvKiAtMSBtZWFucyBub25l
ICovCkBAIC0xMjgsNiArMTMwLDggQEAgaW50IG1haW5fcGNpYXNzaWduYWJsZV9yZW1vdmUoaW50
IGFyZ2MsIGNoYXIgKiphcmd2KTsKIGludCBtYWluX3BjaWFzc2lnbmFibGVfbGlzdChpbnQgYXJn
YywgY2hhciAqKmFyZ3YpOwogI2lmbmRlZiBMSUJYTF9IQVZFX05PX1NVU1BFTkRfUkVTVU1FCiBp
bnQgbWFpbl9yZXN0b3JlKGludCBhcmdjLCBjaGFyICoqYXJndik7CitpbnQgbWFpbl9mb3JrX2xh
dW5jaF9kbShpbnQgYXJnYywgY2hhciAqKmFyZ3YpOworaW50IG1haW5fZm9ya19yZXNldChpbnQg
YXJnYywgY2hhciAqKmFyZ3YpOwogaW50IG1haW5fbWlncmF0ZV9yZWNlaXZlKGludCBhcmdjLCBj
aGFyICoqYXJndik7CiBpbnQgbWFpbl9zYXZlKGludCBhcmdjLCBjaGFyICoqYXJndik7CiBpbnQg
bWFpbl9taWdyYXRlKGludCBhcmdjLCBjaGFyICoqYXJndik7CkBAIC0yMTIsNiArMjE2LDcgQEAg
aW50IG1haW5fcHNyX2NhdF9jYm1fc2V0KGludCBhcmdjLCBjaGFyICoqYXJndik7CiBpbnQgbWFp
bl9wc3JfY2F0X3Nob3coaW50IGFyZ2MsIGNoYXIgKiphcmd2KTsKIGludCBtYWluX3Bzcl9tYmFf
c2V0KGludCBhcmdjLCBjaGFyICoqYXJndik7CiBpbnQgbWFpbl9wc3JfbWJhX3Nob3coaW50IGFy
Z2MsIGNoYXIgKiphcmd2KTsKK2ludCBtYWluX2Zvcmtfdm0oaW50IGFyZ2MsIGNoYXIgKiphcmd2
KTsKICNlbmRpZgogaW50IG1haW5fcWVtdV9tb25pdG9yX2NvbW1hbmQoaW50IGFyZ2MsIGNoYXIg
Kiphcmd2KTsKIApkaWZmIC0tZ2l0IGEvdG9vbHMveGwveGxfY21kdGFibGUuYyBiL3Rvb2xzL3hs
L3hsX2NtZHRhYmxlLmMKaW5kZXggMDgzMzUzOTRlNS4uZWY2MzRhYmYzMiAxMDA2NDQKLS0tIGEv
dG9vbHMveGwveGxfY21kdGFibGUuYworKysgYi90b29scy94bC94bF9jbWR0YWJsZS5jCkBAIC0x
ODcsNiArMTg3LDIxIEBAIHN0cnVjdCBjbWRfc3BlYyBjbWRfdGFibGVbXSA9IHsKICAgICAgICJS
ZXN0b3JlIGEgZG9tYWluIGZyb20gYSBzYXZlZCBzdGF0ZSIsCiAgICAgICAiLSBmb3IgaW50ZXJu
YWwgdXNlIG9ubHkiLAogICAgIH0sCisjaWYgZGVmaW5lZChfX2kzODZfXykgfHwgZGVmaW5lZChf
X3g4Nl82NF9fKQorICAgIHsgImZvcmstdm0iLAorICAgICAgJm1haW5fZm9ya192bSwgMCwgMSwK
KyAgICAgICJGb3JrIGEgZG9tYWluIGZyb20gdGhlIHJ1bm5pbmcgcGFyZW50IGRvbWlkLiBFeHBl
cmltZW50YWwuIE1vc3QgY29uZmlnIHNldHRpbmdzIG11c3QgbWF0Y2ggcGFyZW50LiIsCisgICAg
ICAiW29wdGlvbnNdIDxEb21pZD4iLAorICAgICAgIi1oICAgICAgICAgICAgICAgICAgICAgICAg
ICAgUHJpbnQgdGhpcyBoZWxwLlxuIgorICAgICAgIi1DIDxjb25maWc+ICAgICAgICAgICAgICAg
ICAgVXNlIGNvbmZpZyBmaWxlIGZvciBWTSBmb3JrLlxuIgorICAgICAgIi1RIDxxZW11LXNhdmUt
ZmlsZT4gICAgICAgICAgVXNlIHFlbXUgc2F2ZSBmaWxlIGZvciBWTSBmb3JrLlxuIgorICAgICAg
Ii0tbGF1bmNoLWRtIDx5ZXN8bm98bGF0ZT4gICAgTGF1bmNoIGRldmljZSBtb2RlbCAoUUVNVSkg
Zm9yIFZNIGZvcmsuXG4iCisgICAgICAiLS1mb3JrLXJlc2V0ICAgICAgICAgICAgICAgICBSZXNl
dCBWTSBmb3JrLlxuIgorICAgICAgIi0tbWF4LXZjcHVzICAgICAgICAgICAgICAgICAgU3BlY2lm
eSBtYXgtdmNwdXMgbWF0Y2hpbmcgdGhlIHBhcmVudCBkb21haW4gd2hlbiBub3QgbGF1bmNoaW5n
IGRtXG4iCisgICAgICAiLXAgICAgICAgICAgICAgICAgICAgICAgICAgICBEbyBub3QgdW5wYXVz
ZSBmb3JrIFZNIGFmdGVyIG9wZXJhdGlvbi5cbiIKKyAgICAgICItZCAgICAgICAgICAgICAgICAg
ICAgICAgICAgIEVuYWJsZSBkZWJ1ZyBtZXNzYWdlcy5cbiIKKyAgICB9LAorI2VuZGlmCiAjZW5k
aWYKICAgICB7ICJkdW1wLWNvcmUiLAogICAgICAgJm1haW5fZHVtcF9jb3JlLCAwLCAxLApkaWZm
IC0tZ2l0IGEvdG9vbHMveGwveGxfZm9ya3ZtLmMgYi90b29scy94bC94bF9mb3Jrdm0uYwpuZXcg
ZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwLi5hN2VlNWI0NzcxCi0tLSAvZGV2L251
bGwKKysrIGIvdG9vbHMveGwveGxfZm9ya3ZtLmMKQEAgLTAsMCArMSwxNDcgQEAKKy8qCisgKiBD
b3B5cmlnaHQgMjAyMCBJbnRlbCBDb3Jwb3JhdGlvbgorICoKKyAqIFRoaXMgcHJvZ3JhbSBpcyBm
cmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5CisgKiBp
dCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5z
ZSBhcyBwdWJsaXNoZWQKKyAqIGJ5IHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IHZlcnNp
b24gMi4xIG9ubHkuIHdpdGggdGhlIHNwZWNpYWwKKyAqIGV4Y2VwdGlvbiBvbiBsaW5raW5nIGRl
c2NyaWJlZCBpbiBmaWxlIExJQ0VOU0UuCisgKgorICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1
dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCisgKiBidXQgV0lUSE9VVCBB
TlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgorICogTUVS
Q0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRo
ZQorICogR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMu
CisgKi8KKworI2luY2x1ZGUgPGZjbnRsLmg+CisjaW5jbHVkZSA8aW50dHlwZXMuaD4KKyNpbmNs
dWRlIDxzdGRsaWIuaD4KKyNpbmNsdWRlIDxzeXMvc3RhdC5oPgorI2luY2x1ZGUgPHN5cy90eXBl
cy5oPgorI2luY2x1ZGUgPHN5cy91dHNuYW1lLmg+CisjaW5jbHVkZSA8dGltZS5oPgorI2luY2x1
ZGUgPHVuaXN0ZC5oPgorCisjaW5jbHVkZSA8bGlieGwuaD4KKyNpbmNsdWRlIDxsaWJ4bF91dGls
cy5oPgorI2luY2x1ZGUgPGxpYnhsdXRpbC5oPgorCisjaW5jbHVkZSAieGwuaCIKKyNpbmNsdWRl
ICJ4bF91dGlscy5oIgorI2luY2x1ZGUgInhsX3BhcnNlLmgiCisKK2ludCBtYWluX2Zvcmtfdm0o
aW50IGFyZ2MsIGNoYXIgKiphcmd2KQoreworICAgIGludCByYywgZGVidWcgPSAwOworICAgIHVp
bnQzMl90IGRvbWlkX2luID0gSU5WQUxJRF9ET01JRCwgZG9taWRfb3V0ID0gSU5WQUxJRF9ET01J
RDsKKyAgICBpbnQgbGF1bmNoX2RtID0gMTsKKyAgICBib29sIHJlc2V0ID0gMDsKKyAgICBib29s
IHBhdXNlID0gMDsKKyAgICBjb25zdCBjaGFyICpjb25maWdfZmlsZSA9IE5VTEw7CisgICAgY29u
c3QgY2hhciAqZG1fcmVzdG9yZV9maWxlID0gTlVMTDsKKyAgICB1aW50MzJfdCBtYXhfdmNwdXMg
PSAwOworCisgICAgaW50IG9wdDsKKyAgICBzdGF0aWMgc3RydWN0IG9wdGlvbiBvcHRzW10gPSB7
CisgICAgICAgIHsibGF1bmNoLWRtIiwgMSwgMCwgJ2wnfSwKKyAgICAgICAgeyJmb3JrLXJlc2V0
IiwgMCwgMCwgJ3InfSwKKyAgICAgICAgeyJtYXgtdmNwdXMiLCAxLCAwLCAnbSd9LAorICAgICAg
ICBDT01NT05fTE9OR19PUFRTCisgICAgfTsKKworICAgIFNXSVRDSF9GT1JFQUNIX09QVChvcHQs
ICJwaGRDOlE6bDpybTpOOkQ6QjpWOiIsIG9wdHMsICJmb3JrLXZtIiwgMSkgeworICAgIGNhc2Ug
J2QnOgorICAgICAgICBkZWJ1ZyA9IDE7CisgICAgICAgIGJyZWFrOworICAgIGNhc2UgJ3AnOgor
ICAgICAgICBwYXVzZSA9IDE7CisgICAgICAgIGJyZWFrOworICAgIGNhc2UgJ20nOgorICAgICAg
ICBtYXhfdmNwdXMgPSBhdG9pKG9wdGFyZyk7CisgICAgICAgIGJyZWFrOworICAgIGNhc2UgJ0Mn
OgorICAgICAgICBjb25maWdfZmlsZSA9IG9wdGFyZzsKKyAgICAgICAgYnJlYWs7CisgICAgY2Fz
ZSAnUSc6CisgICAgICAgIGRtX3Jlc3RvcmVfZmlsZSA9IG9wdGFyZzsKKyAgICAgICAgYnJlYWs7
CisgICAgY2FzZSAnbCc6CisgICAgICAgIGlmICggIXN0cmNtcChvcHRhcmcsICJubyIpICkKKyAg
ICAgICAgICAgIGxhdW5jaF9kbSA9IDA7CisgICAgICAgIGlmICggIXN0cmNtcChvcHRhcmcsICJ5
ZXMiKSApCisgICAgICAgICAgICBsYXVuY2hfZG0gPSAxOworICAgICAgICBpZiAoICFzdHJjbXAo
b3B0YXJnLCAibGF0ZSIpICkKKyAgICAgICAgICAgIGxhdW5jaF9kbSA9IDI7CisgICAgICAgIGJy
ZWFrOworICAgIGNhc2UgJ3InOgorICAgICAgICByZXNldCA9IDE7CisgICAgICAgIGJyZWFrOwor
ICAgIGNhc2UgJ04nOiAvKiBmYWxsLXRocm91Z2ggKi8KKyAgICBjYXNlICdEJzogLyogZmFsbC10
aHJvdWdoICovCisgICAgY2FzZSAnQic6IC8qIGZhbGwtdGhyb3VnaCAqLworICAgIGNhc2UgJ1Yn
OgorICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIlVuaW1wbGVtZW50ZWQgb3B0aW9uKHMpXG4iKTsK
KyAgICAgICAgcmV0dXJuIEVYSVRfRkFJTFVSRTsKKyAgICB9CisKKyAgICBpZiAoYXJnYy1vcHRp
bmQgPT0gMSkgeworICAgICAgICBkb21pZF9pbiA9IGF0b2koYXJndltvcHRpbmRdKTsKKyAgICB9
IGVsc2UgeworICAgICAgICBoZWxwKCJmb3JrLXZtIik7CisgICAgICAgIHJldHVybiBFWElUX0ZB
SUxVUkU7CisgICAgfQorCisgICAgaWYgKGxhdW5jaF9kbSAmJiAoIWNvbmZpZ19maWxlIHx8ICFk
bV9yZXN0b3JlX2ZpbGUpKSB7CisgICAgICAgIGZwcmludGYoc3RkZXJyLCAiQ3VycmVudGx5IHlv
dSBtdXN0IHByb3ZpZGUgYm90aCAtQyBhbmQgLVEgb3B0aW9uc1xuIik7CisgICAgICAgIHJldHVy
biBFWElUX0ZBSUxVUkU7CisgICAgfQorCisgICAgaWYgKHJlc2V0KSB7CisgICAgICAgIGRvbWlk
X291dCA9IGRvbWlkX2luOworICAgICAgICBpZiAobGlieGxfZG9tYWluX2ZvcmtfcmVzZXQoY3R4
LCBkb21pZF9pbikgPT0gRVhJVF9GQUlMVVJFKQorICAgICAgICAgICAgcmV0dXJuIEVYSVRfRkFJ
TFVSRTsKKyAgICB9CisKKyAgICBpZiAobGF1bmNoX2RtID09IDIgfHwgcmVzZXQpIHsKKyAgICAg
ICAgZG9taWRfb3V0ID0gZG9taWRfaW47CisgICAgICAgIHJjID0gRVhJVF9TVUNDRVNTOworICAg
IH0gZWxzZSB7CisgICAgICAgIGlmICggIW1heF92Y3B1cyApCisgICAgICAgIHsKKyAgICAgICAg
ICAgIGZwcmludGYoc3RkZXJyLCAiQ3VycmVudGx5IHlvdSBtdXN0IHBhcmVudCdzIG1heF92Y3B1
IGZvciB0aGlzIG9wdGlvblxuIik7CisgICAgICAgICAgICByZXR1cm4gRVhJVF9GQUlMVVJFOwor
ICAgICAgICB9CisKKyAgICAgICAgcmMgPSBsaWJ4bF9kb21haW5fZm9ya192bShjdHgsIGRvbWlk
X2luLCBtYXhfdmNwdXMsICZkb21pZF9vdXQpOworICAgIH0KKworICAgIGlmIChyYyA9PSBFWElU
X1NVQ0NFU1MpIHsKKyAgICAgICAgaWYgKCBsYXVuY2hfZG0gKSB7CisgICAgICAgICAgICBzdHJ1
Y3QgZG9tYWluX2NyZWF0ZSBkb21faW5mbzsKKyAgICAgICAgICAgIG1lbXNldCgmZG9tX2luZm8s
IDAsIHNpemVvZihkb21faW5mbykpOworICAgICAgICAgICAgZG9tX2luZm8uZGRvbWlkID0gZG9t
aWRfb3V0OworICAgICAgICAgICAgZG9tX2luZm8uZG1fcmVzdG9yZV9maWxlID0gZG1fcmVzdG9y
ZV9maWxlOworICAgICAgICAgICAgZG9tX2luZm8uZGVidWcgPSBkZWJ1ZzsKKyAgICAgICAgICAg
IGRvbV9pbmZvLnBhdXNlZCA9IHBhdXNlOworICAgICAgICAgICAgZG9tX2luZm8uY29uZmlnX2Zp
bGUgPSBjb25maWdfZmlsZTsKKyAgICAgICAgICAgIGRvbV9pbmZvLm1pZ3JhdGVfZmQgPSAtMTsK
KyAgICAgICAgICAgIGRvbV9pbmZvLnNlbmRfYmFja19mZCA9IC0xOworICAgICAgICAgICAgcmMg
PSBjcmVhdGVfZG9tYWluKCZkb21faW5mbykgPCAwID8gRVhJVF9GQUlMVVJFIDogRVhJVF9TVUND
RVNTOworICAgICAgICB9IGVsc2UgaWYgKCAhcGF1c2UgKQorICAgICAgICAgICAgcmMgPSBsaWJ4
bF9kb21haW5fdW5wYXVzZShjdHgsIGRvbWlkX291dCwgTlVMTCk7CisgICAgfQorCisgICAgaWYg
KHJjID09IEVYSVRfU1VDQ0VTUykKKyAgICAgICAgZnByaW50ZihzdGRlcnIsICJmb3JrLXZtIGNv
bW1hbmQgc3VjY2Vzc2Z1bGx5IHJldHVybmVkIGRvbWlkOiAldVxuIiwgZG9taWRfb3V0KTsKKyAg
ICBlbHNlIGlmICggZG9taWRfb3V0ICE9IElOVkFMSURfRE9NSUQgKQorICAgICAgICBsaWJ4bF9k
b21haW5fZGVzdHJveShjdHgsIGRvbWlkX291dCwgMCk7CisKKyAgICByZXR1cm4gcmM7Cit9CisK
Ky8qCisgKiBMb2NhbCB2YXJpYWJsZXM6CisgKiBtb2RlOiBDCisgKiBjLWJhc2ljLW9mZnNldDog
NAorICogaW5kZW50LXRhYnMtbW9kZTogbmlsCisgKiBFbmQ6CisgKi8KZGlmZiAtLWdpdCBhL3Rv
b2xzL3hsL3hsX3ZtY29udHJvbC5jIGIvdG9vbHMveGwveGxfdm1jb250cm9sLmMKaW5kZXggMmUy
ZDQyNzQ5Mi4uNzgyZmJiYzI0YiAxMDA2NDQKLS0tIGEvdG9vbHMveGwveGxfdm1jb250cm9sLmMK
KysrIGIvdG9vbHMveGwveGxfdm1jb250cm9sLmMKQEAgLTY3Niw2ICs2NzYsMTIgQEAgaW50IGNy
ZWF0ZV9kb21haW4oc3RydWN0IGRvbWFpbl9jcmVhdGUgKmRvbV9pbmZvKQogCiAgICAgaW50IHJl
c3RvcmluZyA9IChyZXN0b3JlX2ZpbGUgfHwgKG1pZ3JhdGVfZmQgPj0gMCkpOwogCisjaWYgZGVm
aW5lZChfX2kzODZfXykgfHwgZGVmaW5lZChfX3g4Nl82NF9fKQorICAgIC8qIFZNIGZvcmtpbmcg
Ki8KKyAgICB1aW50MzJfdCBkZG9taWQgPSBkb21faW5mby0+ZGRvbWlkOyAvLyBsYXVuY2ggZG0g
Zm9yIHRoaXMgZG9tYWluIGlmZiBzZXQKKyAgICBjb25zdCBjaGFyICpkbV9yZXN0b3JlX2ZpbGUg
PSBkb21faW5mby0+ZG1fcmVzdG9yZV9maWxlOworI2VuZGlmCisKICAgICBsaWJ4bF9kb21haW5f
Y29uZmlnX2luaXQoJmRfY29uZmlnKTsKIAogICAgIGlmIChyZXN0b3JpbmcpIHsKQEAgLTkyNiw2
ICs5MzIsMTQgQEAgc3RhcnQ6CiAgICAgICAgICAqIHJlc3RvcmUvbWlncmF0ZS1yZWNlaXZlIGl0
IGFnYWluLgogICAgICAgICAgKi8KICAgICAgICAgcmVzdG9yaW5nID0gMDsKKyNpZiBkZWZpbmVk
KF9faTM4Nl9fKSB8fCBkZWZpbmVkKF9feDg2XzY0X18pCisgICAgfSBlbHNlIGlmICggZGRvbWlk
ICkgeworICAgICAgICBkX2NvbmZpZy5kbV9yZXN0b3JlX2ZpbGUgPSBkbV9yZXN0b3JlX2ZpbGU7
CisgICAgICAgIHJldCA9IGxpYnhsX2RvbWFpbl9mb3JrX2xhdW5jaF9kbShjdHgsICZkX2NvbmZp
ZywgZGRvbWlkLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0
b2Nvbm5lY3RfY29uc29sZV9ob3cpOworICAgICAgICBkb21pZCA9IGRkb21pZDsKKyAgICAgICAg
ZGRvbWlkID0gSU5WQUxJRF9ET01JRDsKKyNlbmRpZgogICAgIH0gZWxzZSBpZiAoZG9taWRfc29m
dF9yZXNldCAhPSBJTlZBTElEX0RPTUlEKSB7CiAgICAgICAgIC8qIERvIHNvZnQgcmVzZXQuICov
CiAgICAgICAgIHJldCA9IGxpYnhsX2RvbWFpbl9zb2Z0X3Jlc2V0KGN0eCwgJmRfY29uZmlnLCBk
b21pZF9zb2Z0X3Jlc2V0LAotLSAKMi4yMC4xCgoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlz
dHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xp
c3RpbmZvL3hlbi1kZXZlbA==

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id C2AC7A15D6
	for <lists+xen-devel@lfdr.de>; Thu, 29 Aug 2019 12:23:06 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i3HWx-0003gC-Er; Thu, 29 Aug 2019 10:19:51 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=c8TN=WZ=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1i3HWv-0003fP-N9
 for xen-devel@lists.xenproject.org; Thu, 29 Aug 2019 10:19:49 +0000
X-Inumbo-ID: 7b82d4da-ca46-11e9-ae64-12813bfff9fa
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 7b82d4da-ca46-11e9-ae64-12813bfff9fa;
 Thu, 29 Aug 2019 10:19:29 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id B7826AF58;
 Thu, 29 Aug 2019 10:19:27 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Thu, 29 Aug 2019 12:18:45 +0200
Message-Id: <20190829101846.21369-5-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190829101846.21369-1-jgross@suse.com>
References: <20190829101846.21369-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v3 4/5] xen: modify lock profiling interface
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VG9kYXkgYWRkaW5nIGxvY2tzIGxvY2F0ZWQgaW4gYSBzdHJ1Y3QgdG8gbG9jayBwcm9maWxpbmcg
cmVxdWlyZXMgYQp1bmlxdWUgdHlwZSBpbmRleCBmb3IgZWFjaCBzdHJ1Y3R1cmUuIFRoaXMgbWFr
ZXMgaXQgaGFyZCB0byBhZGQgYW55Cm5ldyBzdHJ1Y3R1cmUgYXMgdGhlIHJlbGF0ZWQgc3lzY3Rs
IGludGVyZmFjZSBuZWVkcyB0byBiZSBjaGFuZ2VkLCB0b28uCgpJbnN0ZWFkIG9mIHVzaW5nIGFu
IGluZGV4IHRoZSBhbHJlYWR5IGV4aXN0aW5nIHN0cnVjdCBuYW1lIHNwZWNpZmllZAppbiBsb2Nr
X3Byb2ZpbGVfcmVnaXN0ZXJfc3RydWN0KCkgY2FuIGJlIHVzZWQgYXMgYW4gaWRlbnRpZmllciBp
bnN0ZWFkLgoKTW9kaWZ5IHRoZSBzeXNjdGwgaW50ZXJmYWNlIHRvIHVzZSB0aGUgc3RydWN0IG5h
bWUgaW5zdGVhZCBvZiB0aGUgdHlwZQppbmRleCBhbmQgYWRhcHQgdGhlIHJlbGF0ZWQgY29kaW5n
IGFjY29yZGluZ2x5LiBJbnN0ZWFkIG9mIGFuIGFycmF5IG9mCnN0cnVjdCBhbmNob3JzIGZvciBs
b2NrIHByb2ZpbGluZyB3ZSBub3cgdXNlIGEgbGlua2VkIGxpc3QgZm9yIHRoYXQKcHVycG9zZS4g
VXNlIHRoZSBzcGVjaWFsIGlkeCB2YWx1ZSAtMSBmb3IgY2FzZXMgd2hlcmUgdGhlIGlkeCBpc24n
dApyZWxldmFudCAoZ2xvYmFsIGxvY2tzKSBhbmQgc2hvdWxkbid0IGJlIHByaW50ZWQuCgpJbmNy
ZW1lbnQgdGhlIHN5c2N0bC5oIGludGVyZmFjZSB2ZXJzaW9uIGFzIGFuIGludGVyZmFjZSBpcyBi
ZWluZwptb2RpZmllZC4KCkFkZCB0aGUgbWlzc2luZyBzZXR0aW5nIG9mIHByb2ZpbGluZyB0aW1l
IHRvIHhjX2xvY2twcm9mX3F1ZXJ5KCkuCgpBZGQgZnJlZWluZyBlbGVtZW50IGRhdGEgd2hlbiBk
ZXJlZ2lzdGVyaW5nIGEgc3RydWN0dXJlLgoKU2lnbmVkLW9mZi1ieTogSnVlcmdlbiBHcm9zcyA8
amdyb3NzQHN1c2UuY29tPgotLS0KVjI6Ci0gYWRkIGNvbW1lbnQgYWJvdXQgbWVtb3J5IGFsbG9j
YXRpb24gbmVlZHMgKEphbiBCZXVsaWNoKQotIGNoZWNrIHN1Y2Nlc3Mgb2YgbWVtb3J5IGFsbG9j
YXRpb24gKEphbiBCZXVsaWNoKQotLS0KIHRvb2xzL2xpYnhjL3hjX21pc2MuYyAgICAgICB8ICAx
ICsKIHRvb2xzL21pc2MveGVubG9ja3Byb2YuYyAgICB8IDE3ICsrLS0tLS0tCiB4ZW4vY29tbW9u
L2RvbWFpbi5jICAgICAgICAgfCAgNCArLQogeGVuL2NvbW1vbi9zcGlubG9jay5jICAgICAgIHwg
OTUgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tCiB4ZW4vaW5j
bHVkZS9wdWJsaWMvc3lzY3RsLmggfCAxMSArKy0tLS0KIHhlbi9pbmNsdWRlL3hlbi9zcGlubG9j
ay5oICB8IDI5ICsrKysrKysrLS0tLS0tCiA2IGZpbGVzIGNoYW5nZWQsIDk1IGluc2VydGlvbnMo
KyksIDYyIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3Rvb2xzL2xpYnhjL3hjX21pc2MuYyBi
L3Rvb2xzL2xpYnhjL3hjX21pc2MuYwppbmRleCA4ZTYwYjZlOWYwLi4yMjcwOGYxYjFmIDEwMDY0
NAotLS0gYS90b29scy9saWJ4Yy94Y19taXNjLmMKKysrIGIvdG9vbHMvbGlieGMveGNfbWlzYy5j
CkBAIC01MzMsNiArNTMzLDcgQEAgaW50IHhjX2xvY2twcm9mX3F1ZXJ5KHhjX2ludGVyZmFjZSAq
eGNoLAogICAgIHJjID0gZG9fc3lzY3RsKHhjaCwgJnN5c2N0bCk7CiAKICAgICAqbl9lbGVtcyA9
IHN5c2N0bC51LmxvY2twcm9mX29wLm5yX2VsZW07CisgICAgKnRpbWUgPSBzeXNjdGwudS5sb2Nr
cHJvZl9vcC50aW1lOwogCiAgICAgcmV0dXJuIHJjOwogfQpkaWZmIC0tZ2l0IGEvdG9vbHMvbWlz
Yy94ZW5sb2NrcHJvZi5jIGIvdG9vbHMvbWlzYy94ZW5sb2NrcHJvZi5jCmluZGV4IDExZjQzYTM1
ZTMuLmM2YWEzZmU4NDEgMTAwNjQ0Ci0tLSBhL3Rvb2xzL21pc2MveGVubG9ja3Byb2YuYworKysg
Yi90b29scy9taXNjL3hlbmxvY2twcm9mLmMKQEAgLTg4LDE5ICs4OCwxMCBAQCBpbnQgbWFpbihp
bnQgYXJnYywgY2hhciAqYXJndltdKQogICAgIHNiID0gMDsKICAgICBmb3IgKCBqID0gMDsgaiA8
IGk7IGorKyApCiAgICAgewotICAgICAgICBzd2l0Y2ggKCBkYXRhW2pdLnR5cGUgKQotICAgICAg
ICB7Ci0gICAgICAgIGNhc2UgTE9DS1BST0ZfVFlQRV9HTE9CQUw6Ci0gICAgICAgICAgICBzcHJp
bnRmKG5hbWUsICJnbG9iYWwgbG9jayAlcyIsIGRhdGFbal0ubmFtZSk7Ci0gICAgICAgICAgICBi
cmVhazsKLSAgICAgICAgY2FzZSBMT0NLUFJPRl9UWVBFX1BFUkRPTToKLSAgICAgICAgICAgIHNw
cmludGYobmFtZSwgImRvbWFpbiAlZCBsb2NrICVzIiwgZGF0YVtqXS5pZHgsIGRhdGFbal0ubmFt
ZSk7Ci0gICAgICAgICAgICBicmVhazsKLSAgICAgICAgZGVmYXVsdDoKLSAgICAgICAgICAgIHNw
cmludGYobmFtZSwgInVua25vd24gdHlwZSglZCkgJWQgbG9jayAlcyIsIGRhdGFbal0udHlwZSwK
LSAgICAgICAgICAgICAgICAgICAgZGF0YVtqXS5pZHgsIGRhdGFbal0ubmFtZSk7Ci0gICAgICAg
ICAgICBicmVhazsKLSAgICAgICAgfQorICAgICAgICBpZiAoIGRhdGFbal0uaWR4ID09IExPQ0tQ
Uk9GX0lEWF9OT05FICkKKyAgICAgICAgICAgIHNwcmludGYobmFtZSwgIiVzICVzIiwgZGF0YVtq
XS50eXBlLCBkYXRhW2pdLm5hbWUpOworICAgICAgICBlbHNlCisgICAgICAgICAgICBzcHJpbnRm
KG5hbWUsICIlcyAlZCAlcyIsIGRhdGFbal0udHlwZSwgZGF0YVtqXS5pZHgsIGRhdGFbal0ubmFt
ZSk7CiAgICAgICAgIGwgPSAoZG91YmxlKShkYXRhW2pdLmxvY2tfdGltZSkgLyAxRSswOTsKICAg
ICAgICAgYiA9IChkb3VibGUpKGRhdGFbal0uYmxvY2tfdGltZSkgLyAxRSswOTsKICAgICAgICAg
c2wgKz0gbDsKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vZG9tYWluLmMgYi94ZW4vY29tbW9uL2Rv
bWFpbi5jCmluZGV4IDFmN2E0NDlmMTQuLjg0NzQ5YTI4YzggMTAwNjQ0Ci0tLSBhL3hlbi9jb21t
b24vZG9tYWluLmMKKysrIGIveGVuL2NvbW1vbi9kb21haW4uYwpAQCAtMjkwLDcgKzI5MCw3IEBA
IHN0YXRpYyB2b2lkIF9kb21haW5fZGVzdHJveShzdHJ1Y3QgZG9tYWluICpkKQogCiAgICAgeHNt
X2ZyZWVfc2VjdXJpdHlfZG9tYWluKGQpOwogCi0gICAgbG9ja19wcm9maWxlX2RlcmVnaXN0ZXJf
c3RydWN0KExPQ0tQUk9GX1RZUEVfUEVSRE9NLCBkKTsKKyAgICBsb2NrX3Byb2ZpbGVfZGVyZWdp
c3Rlcl9zdHJ1Y3QoZCwgIkRvbWFpbiIpOwogCiAgICAgZnJlZV9kb21haW5fc3RydWN0KGQpOwog
fQpAQCAtMzY5LDcgKzM2OSw3IEBAIHN0cnVjdCBkb21haW4gKmRvbWFpbl9jcmVhdGUoZG9taWRf
dCBkb21pZCwKICAgICAgICAgZC0+bWF4X3ZjcHVzID0gY29uZmlnLT5tYXhfdmNwdXM7CiAgICAg
fQogCi0gICAgbG9ja19wcm9maWxlX3JlZ2lzdGVyX3N0cnVjdChMT0NLUFJPRl9UWVBFX1BFUkRP
TSwgZCwgZG9taWQsICJEb21haW4iKTsKKyAgICBsb2NrX3Byb2ZpbGVfcmVnaXN0ZXJfc3RydWN0
KGQsIGRvbWlkLCAiRG9tYWluIik7CiAKICAgICBpZiAoIChlcnIgPSB4c21fYWxsb2Nfc2VjdXJp
dHlfZG9tYWluKGQpKSAhPSAwICkKICAgICAgICAgZ290byBmYWlsOwpkaWZmIC0tZ2l0IGEveGVu
L2NvbW1vbi9zcGlubG9jay5jIGIveGVuL2NvbW1vbi9zcGlubG9jay5jCmluZGV4IGM0ZjcwNmM2
MjcuLmNiZGU4OTZhZTYgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc3BpbmxvY2suYworKysgYi94
ZW4vY29tbW9uL3NwaW5sb2NrLmMKQEAgLTMzMCw0MiArMzMwLDQzIEBAIHZvaWQgX3NwaW5fdW5s
b2NrX3JlY3Vyc2l2ZShzcGlubG9ja190ICpsb2NrKQogI2lmZGVmIENPTkZJR19ERUJVR19MT0NL
X1BST0ZJTEUKIAogc3RydWN0IGxvY2tfcHJvZmlsZV9hbmMgeworICAgIHN0cnVjdCBsb2NrX3By
b2ZpbGVfYW5jICAgKm5leHQ7ICAgICAvKiBuZXh0IHR5cGUgKi8KICAgICBzdHJ1Y3QgbG9ja19w
cm9maWxlX3FoZWFkICpoZWFkX3E7ICAgLyogZmlyc3QgaGVhZCBvZiB0aGlzIHR5cGUgKi8KLSAg
ICBjaGFyICAgICAgICAgICAgICAgICAgICAgICpuYW1lOyAgICAgLyogZGVzY3JpcHRpdmUgc3Ry
aW5nIGZvciBwcmludCAqLworICAgIGNvbnN0IGNoYXIgICAgICAgICAgICAgICAgKm5hbWU7ICAg
ICAvKiBkZXNjcmlwdGl2ZSBzdHJpbmcgZm9yIHByaW50ICovCiB9OwogCiB0eXBlZGVmIHZvaWQg
bG9ja19wcm9maWxlX3N1YmZ1bmMoCi0gICAgc3RydWN0IGxvY2tfcHJvZmlsZSAqLCBpbnQzMl90
LCBpbnQzMl90LCB2b2lkICopOworICAgIHN0cnVjdCBsb2NrX3Byb2ZpbGUgKiwgY29uc3QgY2hh
ciAqLCBpbnQzMl90LCB2b2lkICopOwogCiBleHRlcm4gc3RydWN0IGxvY2tfcHJvZmlsZSAqX19s
b2NrX3Byb2ZpbGVfc3RhcnQ7CiBleHRlcm4gc3RydWN0IGxvY2tfcHJvZmlsZSAqX19sb2NrX3By
b2ZpbGVfZW5kOwogCiBzdGF0aWMgc190aW1lX3QgbG9ja19wcm9maWxlX3N0YXJ0Owotc3RhdGlj
IHN0cnVjdCBsb2NrX3Byb2ZpbGVfYW5jIGxvY2tfcHJvZmlsZV9hbmNzW0xPQ0tQUk9GX1RZUEVf
Tl07CitzdGF0aWMgc3RydWN0IGxvY2tfcHJvZmlsZV9hbmMgKmxvY2tfcHJvZmlsZV9hbmNzOwog
c3RhdGljIHN0cnVjdCBsb2NrX3Byb2ZpbGVfcWhlYWQgbG9ja19wcm9maWxlX2dsYl9xOwogc3Rh
dGljIHNwaW5sb2NrX3QgbG9ja19wcm9maWxlX2xvY2sgPSBTUElOX0xPQ0tfVU5MT0NLRUQ7CiAK
IHN0YXRpYyB2b2lkIHNwaW5sb2NrX3Byb2ZpbGVfaXRlcmF0ZShsb2NrX3Byb2ZpbGVfc3ViZnVu
YyAqc3ViLCB2b2lkICpwYXIpCiB7Ci0gICAgaW50IGk7CisgICAgc3RydWN0IGxvY2tfcHJvZmls
ZV9hbmMgKmFuYzsKICAgICBzdHJ1Y3QgbG9ja19wcm9maWxlX3FoZWFkICpocTsKICAgICBzdHJ1
Y3QgbG9ja19wcm9maWxlICplcTsKIAogICAgIHNwaW5fbG9jaygmbG9ja19wcm9maWxlX2xvY2sp
OwotICAgIGZvciAoIGkgPSAwOyBpIDwgTE9DS1BST0ZfVFlQRV9OOyBpKysgKQotICAgICAgICBm
b3IgKCBocSA9IGxvY2tfcHJvZmlsZV9hbmNzW2ldLmhlYWRfcTsgaHE7IGhxID0gaHEtPmhlYWRf
cSApCisgICAgZm9yICggYW5jID0gbG9ja19wcm9maWxlX2FuY3M7IGFuYzsgYW5jID0gYW5jLT5u
ZXh0ICkKKyAgICAgICAgZm9yICggaHEgPSBhbmMtPmhlYWRfcTsgaHE7IGhxID0gaHEtPmhlYWRf
cSApCiAgICAgICAgICAgICBmb3IgKCBlcSA9IGhxLT5lbGVtX3E7IGVxOyBlcSA9IGVxLT5uZXh0
ICkKLSAgICAgICAgICAgICAgICBzdWIoZXEsIGksIGhxLT5pZHgsIHBhcik7CisgICAgICAgICAg
ICAgICAgc3ViKGVxLCBhbmMtPm5hbWUsIGhxLT5pZHgsIHBhcik7CiAgICAgc3Bpbl91bmxvY2so
JmxvY2tfcHJvZmlsZV9sb2NrKTsKIH0KIAogc3RhdGljIHZvaWQgc3BpbmxvY2tfcHJvZmlsZV9w
cmludF9lbGVtKHN0cnVjdCBsb2NrX3Byb2ZpbGUgKmRhdGEsCi0gICAgaW50MzJfdCB0eXBlLCBp
bnQzMl90IGlkeCwgdm9pZCAqcGFyKQorICAgIGNvbnN0IGNoYXIgKnR5cGUsIGludDMyX3QgaWR4
LCB2b2lkICpwYXIpCiB7CiAgICAgc3RydWN0IHNwaW5sb2NrICpsb2NrID0gZGF0YS0+bG9jazsK
IAotICAgIHByaW50aygiJXMgIiwgbG9ja19wcm9maWxlX2FuY3NbdHlwZV0ubmFtZSk7Ci0gICAg
aWYgKCB0eXBlICE9IExPQ0tQUk9GX1RZUEVfR0xPQkFMICkKKyAgICBwcmludGsoIiVzICIsIHR5
cGUpOworICAgIGlmICggaWR4ICE9IExPQ0tQUk9GX0lEWF9OT05FICkKICAgICAgICAgcHJpbnRr
KCIlZCAiLCBpZHgpOwogICAgIHByaW50aygiJXM6IGFkZHI9JXAsIGxvY2t2YWw9JTA4eCwgIiwg
ZGF0YS0+bmFtZSwgbG9jaywKICAgICAgICAgICAgbG9jay0+dGlja2V0cy5oZWFkX3RhaWwpOwpA
QCAtMzg5LDcgKzM5MCw3IEBAIHZvaWQgc3BpbmxvY2tfcHJvZmlsZV9wcmludGFsbCh1bnNpZ25l
ZCBjaGFyIGtleSkKIH0KIAogc3RhdGljIHZvaWQgc3BpbmxvY2tfcHJvZmlsZV9yZXNldF9lbGVt
KHN0cnVjdCBsb2NrX3Byb2ZpbGUgKmRhdGEsCi0gICAgaW50MzJfdCB0eXBlLCBpbnQzMl90IGlk
eCwgdm9pZCAqcGFyKQorICAgIGNvbnN0IGNoYXIgKnR5cGUsIGludDMyX3QgaWR4LCB2b2lkICpw
YXIpCiB7CiAgICAgZGF0YS0+bG9ja19jbnQgPSAwOwogICAgIGRhdGEtPmJsb2NrX2NudCA9IDA7
CkBAIC00MTMsNyArNDE0LDcgQEAgdHlwZWRlZiBzdHJ1Y3QgewogfSBzcGlubG9ja19wcm9maWxl
X3Vjb3B5X3Q7CiAKIHN0YXRpYyB2b2lkIHNwaW5sb2NrX3Byb2ZpbGVfdWNvcHlfZWxlbShzdHJ1
Y3QgbG9ja19wcm9maWxlICpkYXRhLAotICAgIGludDMyX3QgdHlwZSwgaW50MzJfdCBpZHgsIHZv
aWQgKnBhcikKKyAgICBjb25zdCBjaGFyICp0eXBlLCBpbnQzMl90IGlkeCwgdm9pZCAqcGFyKQog
ewogICAgIHNwaW5sb2NrX3Byb2ZpbGVfdWNvcHlfdCAqcCA9IHBhcjsKICAgICBzdHJ1Y3QgeGVu
X3N5c2N0bF9sb2NrcHJvZl9kYXRhIGVsZW07CkBAIC00MjQsNyArNDI1LDcgQEAgc3RhdGljIHZv
aWQgc3BpbmxvY2tfcHJvZmlsZV91Y29weV9lbGVtKHN0cnVjdCBsb2NrX3Byb2ZpbGUgKmRhdGEs
CiAgICAgaWYgKCBwLT5wYy0+bnJfZWxlbSA8IHAtPnBjLT5tYXhfZWxlbSApCiAgICAgewogICAg
ICAgICBzYWZlX3N0cmNweShlbGVtLm5hbWUsIGRhdGEtPm5hbWUpOwotICAgICAgICBlbGVtLnR5
cGUgPSB0eXBlOworICAgICAgICBzYWZlX3N0cmNweShlbGVtLnR5cGUsIHR5cGUpOwogICAgICAg
ICBlbGVtLmlkeCA9IGlkeDsKICAgICAgICAgZWxlbS5sb2NrX2NudCA9IGRhdGEtPmxvY2tfY250
OwogICAgICAgICBlbGVtLmJsb2NrX2NudCA9IGRhdGEtPmJsb2NrX2NudDsKQEAgLTQ2NSwzMSAr
NDY2LDcwIEBAIGludCBzcGlubG9ja19wcm9maWxlX2NvbnRyb2woc3RydWN0IHhlbl9zeXNjdGxf
bG9ja3Byb2Zfb3AgKnBjKQogICAgIHJldHVybiByYzsKIH0KIAotdm9pZCBfbG9ja19wcm9maWxl
X3JlZ2lzdGVyX3N0cnVjdCgKLSAgICBpbnQzMl90IHR5cGUsIHN0cnVjdCBsb2NrX3Byb2ZpbGVf
cWhlYWQgKnFoZWFkLCBpbnQzMl90IGlkeCwgY2hhciAqbmFtZSkKK3N0YXRpYyBzdHJ1Y3QgbG9j
a19wcm9maWxlX2FuYyAqZmluZF9wcm9mX2FuYyhjb25zdCBjaGFyICpuYW1lKQogewotICAgIHFo
ZWFkLT5pZHggPSBpZHg7CisgICAgc3RydWN0IGxvY2tfcHJvZmlsZV9hbmMgKmFuYzsKKworICAg
IGZvciAoIGFuYyA9IGxvY2tfcHJvZmlsZV9hbmNzOyBhbmM7IGFuYyA9IGFuYy0+bmV4dCApCisg
ICAgICAgIGlmICggIXN0cmNtcChhbmMtPm5hbWUsIG5hbWUpICkKKyAgICAgICAgICAgIHJldHVy
biBhbmM7CisgICAgcmV0dXJuIE5VTEw7Cit9CisKK3ZvaWQgX2xvY2tfcHJvZmlsZV9yZWdpc3Rl
cl9zdHJ1Y3Qoc3RydWN0IGxvY2tfcHJvZmlsZV9xaGVhZCAqcWhlYWQsCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGludDMyX3QgaWR4LCBjb25zdCBjaGFyICpuYW1lKQorewor
ICAgIHN0cnVjdCBsb2NrX3Byb2ZpbGVfYW5jICphbmM7CisKICAgICBzcGluX2xvY2soJmxvY2tf
cHJvZmlsZV9sb2NrKTsKLSAgICBxaGVhZC0+aGVhZF9xID0gbG9ja19wcm9maWxlX2FuY3NbdHlw
ZV0uaGVhZF9xOwotICAgIGxvY2tfcHJvZmlsZV9hbmNzW3R5cGVdLmhlYWRfcSA9IHFoZWFkOwot
ICAgIGxvY2tfcHJvZmlsZV9hbmNzW3R5cGVdLm5hbWUgPSBuYW1lOworCisgICAgYW5jID0gZmlu
ZF9wcm9mX2FuYyhuYW1lKTsKKyAgICBpZiAoICFhbmMgKQorICAgIHsKKyAgICAgICAgYW5jID0g
eHphbGxvYyhzdHJ1Y3QgbG9ja19wcm9maWxlX2FuYyk7CisgICAgICAgIGlmICggIWFuYyApCisg
ICAgICAgICAgICBnb3RvIG91dDsKKyAgICAgICAgYW5jLT5uYW1lID0gbmFtZTsKKyAgICAgICAg
YW5jLT5uZXh0ID0gbG9ja19wcm9maWxlX2FuY3M7CisgICAgICAgIGxvY2tfcHJvZmlsZV9hbmNz
ID0gYW5jOworICAgIH0KKworICAgIHFoZWFkLT5pZHggPSBpZHg7CisgICAgcWhlYWQtPmhlYWRf
cSA9IGFuYy0+aGVhZF9xOworICAgIGFuYy0+aGVhZF9xID0gcWhlYWQ7CisKKyBvdXQ6CiAgICAg
c3Bpbl91bmxvY2soJmxvY2tfcHJvZmlsZV9sb2NrKTsKIH0KIAotdm9pZCBfbG9ja19wcm9maWxl
X2RlcmVnaXN0ZXJfc3RydWN0KAotICAgIGludDMyX3QgdHlwZSwgc3RydWN0IGxvY2tfcHJvZmls
ZV9xaGVhZCAqcWhlYWQpCit2b2lkIF9sb2NrX3Byb2ZpbGVfZGVyZWdpc3Rlcl9zdHJ1Y3Qoc3Ry
dWN0IGxvY2tfcHJvZmlsZV9xaGVhZCAqcWhlYWQsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgY29uc3QgY2hhciAqbmFtZSkKIHsKKyAgICBzdHJ1Y3QgbG9ja19wcm9maWxl
X2FuYyAqYW5jOwogICAgIHN0cnVjdCBsb2NrX3Byb2ZpbGVfcWhlYWQgKipxOworICAgIHN0cnVj
dCBsb2NrX3Byb2ZpbGUgKmVsZW07CiAKICAgICBzcGluX2xvY2soJmxvY2tfcHJvZmlsZV9sb2Nr
KTsKLSAgICBmb3IgKCBxID0gJmxvY2tfcHJvZmlsZV9hbmNzW3R5cGVdLmhlYWRfcTsgKnE7IHEg
PSAmKCpxKS0+aGVhZF9xICkKKworICAgIGFuYyA9IGZpbmRfcHJvZl9hbmMobmFtZSk7CisgICAg
aWYgKCBhbmMgKQogICAgIHsKLSAgICAgICAgaWYgKCAqcSA9PSBxaGVhZCApCisgICAgICAgIGZv
ciAoIHEgPSAmYW5jLT5oZWFkX3E7ICpxOyBxID0gJigqcSktPmhlYWRfcSApCiAgICAgICAgIHsK
LSAgICAgICAgICAgICpxID0gcWhlYWQtPmhlYWRfcTsKLSAgICAgICAgICAgIGJyZWFrOworICAg
ICAgICAgICAgaWYgKCAqcSA9PSBxaGVhZCApCisgICAgICAgICAgICB7CisgICAgICAgICAgICAg
ICAgKnEgPSBxaGVhZC0+aGVhZF9xOworICAgICAgICAgICAgICAgIHdoaWxlICggcWhlYWQtPmVs
ZW1fcSApCisgICAgICAgICAgICAgICAgeworICAgICAgICAgICAgICAgICAgICBlbGVtID0gcWhl
YWQtPmVsZW1fcTsKKyAgICAgICAgICAgICAgICAgICAgcWhlYWQtPmVsZW1fcSA9IGVsZW0tPm5l
eHQ7CisgICAgICAgICAgICAgICAgICAgIHhmcmVlKGVsZW0pOworICAgICAgICAgICAgICAgIH0K
KyAgICAgICAgICAgICAgICBicmVhazsKKyAgICAgICAgICAgIH0KICAgICAgICAgfQogICAgIH0K
KwogICAgIHNwaW5fdW5sb2NrKCZsb2NrX3Byb2ZpbGVfbG9jayk7CiB9CiAKQEAgLTUwNCw5ICs1
NDQsOCBAQCBzdGF0aWMgaW50IF9faW5pdCBsb2NrX3Byb2ZfaW5pdCh2b2lkKQogICAgICAgICAo
KnEpLT5sb2NrLT5wcm9maWxlID0gKnE7CiAgICAgfQogCi0gICAgX2xvY2tfcHJvZmlsZV9yZWdp
c3Rlcl9zdHJ1Y3QoCi0gICAgICAgIExPQ0tQUk9GX1RZUEVfR0xPQkFMLCAmbG9ja19wcm9maWxl
X2dsYl9xLAotICAgICAgICAwLCAiR2xvYmFsIGxvY2siKTsKKyAgICBfbG9ja19wcm9maWxlX3Jl
Z2lzdGVyX3N0cnVjdCgmbG9ja19wcm9maWxlX2dsYl9xLCBMT0NLUFJPRl9JRFhfTk9ORSwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiR2xvYmFsIik7CiAKICAgICByZXR1cm4g
MDsKIH0KZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL3B1YmxpYy9zeXNjdGwuaCBiL3hlbi9pbmNs
dWRlL3B1YmxpYy9zeXNjdGwuaAppbmRleCA5MWM0OGRjYWUwLi5mYWZjZTY0ZjAyIDEwMDY0NAot
LS0gYS94ZW4vaW5jbHVkZS9wdWJsaWMvc3lzY3RsLmgKKysrIGIveGVuL2luY2x1ZGUvcHVibGlj
L3N5c2N0bC5oCkBAIC0zNSw3ICszNSw3IEBACiAjaW5jbHVkZSAiZG9tY3RsLmgiCiAjaW5jbHVk
ZSAicGh5c2Rldi5oIgogCi0jZGVmaW5lIFhFTl9TWVNDVExfSU5URVJGQUNFX1ZFUlNJT04gMHgw
MDAwMDAxMgorI2RlZmluZSBYRU5fU1lTQ1RMX0lOVEVSRkFDRV9WRVJTSU9OIDB4MDAwMDAwMTMK
IAogLyoKICAqIFJlYWQgY29uc29sZSBjb250ZW50IGZyb20gWGVuIGJ1ZmZlciByaW5nLgpAQCAt
NDMzLDE0ICs0MzMsMTEgQEAgc3RydWN0IHhlbl9zeXNjdGxfcGFnZV9vZmZsaW5lX29wIHsKIC8q
IFN1Yi1vcGVyYXRpb25zOiAqLwogI2RlZmluZSBYRU5fU1lTQ1RMX0xPQ0tQUk9GX3Jlc2V0IDEg
ICAvKiBSZXNldCBhbGwgcHJvZmlsZSBkYXRhIHRvIHplcm8uICovCiAjZGVmaW5lIFhFTl9TWVND
VExfTE9DS1BST0ZfcXVlcnkgMiAgIC8qIEdldCBsb2NrIHByb2ZpbGUgaW5mb3JtYXRpb24uICov
Ci0vKiBSZWNvcmQtdHlwZTogKi8KLSNkZWZpbmUgTE9DS1BST0ZfVFlQRV9HTE9CQUwgICAgICAw
ICAgLyogZ2xvYmFsIGxvY2ssIGlkeCBtZWFuaW5nbGVzcyAqLwotI2RlZmluZSBMT0NLUFJPRl9U
WVBFX1BFUkRPTSAgICAgIDEgICAvKiBwZXItZG9tYWluIGxvY2ssIGlkeCBpcyBkb21pZCAqLwot
I2RlZmluZSBMT0NLUFJPRl9UWVBFX04gICAgICAgICAgIDIgICAvKiBudW1iZXIgb2YgdHlwZXMg
Ki8KIHN0cnVjdCB4ZW5fc3lzY3RsX2xvY2twcm9mX2RhdGEgewotICAgIGNoYXIgICAgIG5hbWVb
NDBdOyAgICAgLyogbG9jayBuYW1lIChtYXkgaW5jbHVkZSB1cCB0byAyICVkIHNwZWNpZmllcnMp
ICovCi0gICAgaW50MzJfdCAgdHlwZTsgICAgICAgICAvKiBMT0NLUFJPRl9UWVBFXz8/PyAqLwor
ICAgIGNoYXIgICAgIG5hbWVbNDBdOyAgICAgLyogbG9jayBuYW1lICovCisgICAgY2hhciAgICAg
dHlwZVsyMF07ICAgICAvKiBlLmcuICJkb21haW4iICovCiAgICAgaW50MzJfdCAgaWR4OyAgICAg
ICAgICAvKiBpbmRleCAoZS5nLiBkb21haW4gaWQpICovCisjZGVmaW5lIExPQ0tQUk9GX0lEWF9O
T05FICAtMQogICAgIHVpbnQ2NF9hbGlnbmVkX3QgbG9ja19jbnQ7ICAgICAvKiAjIG9mIGxvY2tp
bmcgc3VjY2VlZGVkICovCiAgICAgdWludDY0X2FsaWduZWRfdCBibG9ja19jbnQ7ICAgIC8qICMg
b2Ygd2FpdCBmb3IgbG9jayAqLwogICAgIHVpbnQ2NF9hbGlnbmVkX3QgbG9ja190aW1lOyAgICAv
KiBuc2VjcyBsb2NrIGhlbGQgKi8KZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL3hlbi9zcGlubG9j
ay5oIGIveGVuL2luY2x1ZGUveGVuL3NwaW5sb2NrLmgKaW5kZXggYTdjMTk2N2VjNy4uZGVjYWRk
ZDlmYyAxMDA2NDQKLS0tIGEveGVuL2luY2x1ZGUveGVuL3NwaW5sb2NrLmgKKysrIGIveGVuL2lu
Y2x1ZGUveGVuL3NwaW5sb2NrLmgKQEAgLTUwLDE5ICs1MCwyNCBAQCB1bmlvbiBsb2NrX2RlYnVn
IHsgfTsKIAogICAgICAgd2l0aCBwdHIgYmVpbmcgdGhlIG1haW4gc3RydWN0dXJlIHBvaW50ZXIg
YW5kIGxvY2sgdGhlIHNwaW5sb2NrIGZpZWxkCiAKKyAgICAgIEl0IHNob3VsZCBiZSBub3RlZCB0
aGF0IHRoaXMgd2lsbCBuZWVkIHRvIGFsbG9jYXRlIG1lbW9yeSwgc28gaW50ZXJydXB0cworICAg
ICAgbXVzdCBiZSBlbmFibGVkLgorCiAgICAgLSBlYWNoIHN0cnVjdHVyZSBoYXMgdG8gYmUgYWRk
ZWQgdG8gcHJvZmlsaW5nIHdpdGgKIAotICAgICAgbG9ja19wcm9maWxlX3JlZ2lzdGVyX3N0cnVj
dCh0eXBlLCBwdHIsIGlkeCwgcHJpbnQpOworICAgICAgbG9ja19wcm9maWxlX3JlZ2lzdGVyX3N0
cnVjdChwdHIsIGlkeCwgcHJpbnQpOwogCiAgICAgICB3aXRoOgotICAgICAgICB0eXBlOiAgc29t
ZXRoaW5nIGxpa2UgTE9DS1BST0ZfVFlQRV9QRVJET00KICAgICAgICAgcHRyOiAgIHBvaW50ZXIg
dG8gdGhlIHN0cnVjdHVyZQogICAgICAgICBpZHg6ICAgaW5kZXggb2YgdGhhdCBzdHJ1Y3R1cmUs
IGUuZy4gZG9taWQKICAgICAgICAgcHJpbnQ6IGRlc2NyaXB0aXZlIHN0cmluZyBsaWtlICJkb21h
aW4iCiAKKyAgICAgIEl0IHNob3VsZCBiZSBub3RlZCB0aGF0IHRoaXMgd2lsbCBtaWdodCBuZWVk
IHRvIGFsbG9jYXRlIG1lbW9yeSwgc28KKyAgICAgIGludGVycnVwdHMgbXVzdCBiZSBlbmFibGVk
LgorCiAgICAgLSByZW1vdmluZyBvZiBhIHN0cnVjdHVyZSBpcyBkb25lIHZpYQogCi0gICAgICBs
b2NrX3Byb2ZpbGVfZGVyZWdpc3Rlcl9zdHJ1Y3QodHlwZSwgcHRyKTsKKyAgICAgIGxvY2tfcHJv
ZmlsZV9kZXJlZ2lzdGVyX3N0cnVjdChwdHIsIHByaW50KTsKICovCiAKIHN0cnVjdCBzcGlubG9j
azsKQEAgLTEwOCwxNCArMTEzLDE0IEBAIHN0cnVjdCBsb2NrX3Byb2ZpbGVfcWhlYWQgewogICAg
ICAgICAocyktPnByb2ZpbGVfaGVhZC5lbGVtX3EgPSBwcm9mOyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgXAogICAgIH0gd2hpbGUoMCkKIAotdm9pZCBfbG9ja19wcm9maWxl
X3JlZ2lzdGVyX3N0cnVjdCgKLSAgICBpbnQzMl90LCBzdHJ1Y3QgbG9ja19wcm9maWxlX3FoZWFk
ICosIGludDMyX3QsIGNoYXIgKik7Ci12b2lkIF9sb2NrX3Byb2ZpbGVfZGVyZWdpc3Rlcl9zdHJ1
Y3QoaW50MzJfdCwgc3RydWN0IGxvY2tfcHJvZmlsZV9xaGVhZCAqKTsKK3ZvaWQgX2xvY2tfcHJv
ZmlsZV9yZWdpc3Rlcl9zdHJ1Y3Qoc3RydWN0IGxvY2tfcHJvZmlsZV9xaGVhZCAqLCBpbnQzMl90
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGFyICopOwordm9p
ZCBfbG9ja19wcm9maWxlX2RlcmVnaXN0ZXJfc3RydWN0KHN0cnVjdCBsb2NrX3Byb2ZpbGVfcWhl
YWQgKiwgY29uc3QgY2hhciAqKTsKIAotI2RlZmluZSBsb2NrX3Byb2ZpbGVfcmVnaXN0ZXJfc3Ry
dWN0KHR5cGUsIHB0ciwgaWR4LCBwcmludCkgICAgICAgICAgICAgICAgICAgXAotICAgIF9sb2Nr
X3Byb2ZpbGVfcmVnaXN0ZXJfc3RydWN0KHR5cGUsICYoKHB0ciktPnByb2ZpbGVfaGVhZCksIGlk
eCwgcHJpbnQpCi0jZGVmaW5lIGxvY2tfcHJvZmlsZV9kZXJlZ2lzdGVyX3N0cnVjdCh0eXBlLCBw
dHIpICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCi0gICAgX2xvY2tfcHJvZmlsZV9kZXJl
Z2lzdGVyX3N0cnVjdCh0eXBlLCAmKChwdHIpLT5wcm9maWxlX2hlYWQpKQorI2RlZmluZSBsb2Nr
X3Byb2ZpbGVfcmVnaXN0ZXJfc3RydWN0KHB0ciwgaWR4LCBwcmludCkgICAgICAgICAgICAgICAg
ICAgICAgICAgXAorICAgIF9sb2NrX3Byb2ZpbGVfcmVnaXN0ZXJfc3RydWN0KCYoKHB0ciktPnBy
b2ZpbGVfaGVhZCksIGlkeCwgcHJpbnQpCisjZGVmaW5lIGxvY2tfcHJvZmlsZV9kZXJlZ2lzdGVy
X3N0cnVjdChwdHIsIHByaW50KSAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCisgICAgX2xv
Y2tfcHJvZmlsZV9kZXJlZ2lzdGVyX3N0cnVjdCgmKChwdHIpLT5wcm9maWxlX2hlYWQpLCBwcmlu
dCkKIAogZXh0ZXJuIGludCBzcGlubG9ja19wcm9maWxlX2NvbnRyb2woc3RydWN0IHhlbl9zeXNj
dGxfbG9ja3Byb2Zfb3AgKnBjKTsKIGV4dGVybiB2b2lkIHNwaW5sb2NrX3Byb2ZpbGVfcHJpbnRh
bGwodW5zaWduZWQgY2hhciBrZXkpOwpAQCAtMTI5LDggKzEzNCw4IEBAIHN0cnVjdCBsb2NrX3By
b2ZpbGVfcWhlYWQgeyB9OwogI2RlZmluZSBERUZJTkVfU1BJTkxPQ0sobCkgc3BpbmxvY2tfdCBs
ID0gU1BJTl9MT0NLX1VOTE9DS0VECiAKICNkZWZpbmUgc3Bpbl9sb2NrX2luaXRfcHJvZihzLCBs
KSBzcGluX2xvY2tfaW5pdCgmKChzKS0+bCkpCi0jZGVmaW5lIGxvY2tfcHJvZmlsZV9yZWdpc3Rl
cl9zdHJ1Y3QodHlwZSwgcHRyLCBpZHgsIHByaW50KQotI2RlZmluZSBsb2NrX3Byb2ZpbGVfZGVy
ZWdpc3Rlcl9zdHJ1Y3QodHlwZSwgcHRyKQorI2RlZmluZSBsb2NrX3Byb2ZpbGVfcmVnaXN0ZXJf
c3RydWN0KHB0ciwgaWR4LCBwcmludCkKKyNkZWZpbmUgbG9ja19wcm9maWxlX2RlcmVnaXN0ZXJf
c3RydWN0KHB0ciwgcHJpbnQpCiAjZGVmaW5lIHNwaW5sb2NrX3Byb2ZpbGVfcHJpbnRhbGwoa2V5
KQogCiAjZW5kaWYKLS0gCjIuMTYuNAoKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhl
bnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5m
by94ZW4tZGV2ZWw=

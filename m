Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 19140871F8
	for <lists+xen-devel@lfdr.de>; Fri,  9 Aug 2019 08:10:12 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hvy4D-0006eH-FX; Fri, 09 Aug 2019 06:07:57 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=yG4W=WF=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1hvy4C-0006dX-4B
 for xen-devel@lists.xenproject.org; Fri, 09 Aug 2019 06:07:56 +0000
X-Inumbo-ID: 045452fc-ba6c-11e9-bb68-83c39d6ce56b
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 045452fc-ba6c-11e9-bb68-83c39d6ce56b;
 Fri, 09 Aug 2019 06:07:50 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id CB197B077;
 Fri,  9 Aug 2019 06:07:48 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Fri,  9 Aug 2019 08:07:40 +0200
Message-Id: <20190809060744.8985-2-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190809060744.8985-1-jgross@suse.com>
References: <20190809060744.8985-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v2 1/5] xen/spinlocks: in debug builds store cpu
 holding the lock
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

QWRkIHRoZSBjcHUgY3VycmVudGx5IGhvbGRpbmcgdGhlIGxvY2sgdG8gc3RydWN0IGxvY2tfZGVi
dWcuIFRoaXMgbWFrZXMKYW5hbHlzaXMgb2YgbG9ja2luZyBlcnJvcnMgZWFzaWVyIGFuZCBpdCBj
YW4gYmUgdGVzdGVkIHdoZXRoZXIgdGhlCmNvcnJlY3QgY3B1IGlzIHJlbGVhc2luZyBhIGxvY2sg
YWdhaW4uCgpTaWduZWQtb2ZmLWJ5OiBKdWVyZ2VuIEdyb3NzIDxqZ3Jvc3NAc3VzZS5jb20+Ci0t
LQpWMjogYWRqdXN0IHR5cGVzIChKYW4gQmV1bGljaCkKLS0tCiB4ZW4vY29tbW9uL3NwaW5sb2Nr
LmMgICAgICB8IDMzICsrKysrKysrKysrKysrKysrKysrKysrKysrLS0tLS0tLQogeGVuL2luY2x1
ZGUveGVuL3NwaW5sb2NrLmggfCAxNyArKysrKysrKysrKystLS0tLQogMiBmaWxlcyBjaGFuZ2Vk
LCAzOCBpbnNlcnRpb25zKCspLCAxMiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS94ZW4vY29t
bW9uL3NwaW5sb2NrLmMgYi94ZW4vY29tbW9uL3NwaW5sb2NrLmMKaW5kZXggNmJjNTJkNzBjMC4u
MWJlMWI1ZWJlNiAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9zcGlubG9jay5jCisrKyBiL3hlbi9j
b21tb24vc3BpbmxvY2suYwpAQCAtMTMsOSArMTMsOSBAQAogCiBzdGF0aWMgYXRvbWljX3Qgc3Bp
bl9kZWJ1ZyBfX3JlYWRfbW9zdGx5ID0gQVRPTUlDX0lOSVQoMCk7CiAKLXN0YXRpYyB2b2lkIGNo
ZWNrX2xvY2soc3RydWN0IGxvY2tfZGVidWcgKmRlYnVnKQorc3RhdGljIHZvaWQgY2hlY2tfbG9j
ayh1bmlvbiBsb2NrX2RlYnVnICpkZWJ1ZykKIHsKLSAgICBpbnQgaXJxX3NhZmUgPSAhbG9jYWxf
aXJxX2lzX2VuYWJsZWQoKTsKKyAgICBib29sIGlycV9zYWZlID0gIWxvY2FsX2lycV9pc19lbmFi
bGVkKCk7CiAKICAgICBpZiAoIHVubGlrZWx5KGF0b21pY19yZWFkKCZzcGluX2RlYnVnKSA8PSAw
KSApCiAgICAgICAgIHJldHVybjsKQEAgLTQzLDE4ICs0MywyMSBAQCBzdGF0aWMgdm9pZCBjaGVj
a19sb2NrKHN0cnVjdCBsb2NrX2RlYnVnICpkZWJ1ZykKICAgICAgKi8KICAgICBpZiAoIHVubGlr
ZWx5KGRlYnVnLT5pcnFfc2FmZSAhPSBpcnFfc2FmZSkgKQogICAgIHsKLSAgICAgICAgaW50IHNl
ZW4gPSBjbXB4Y2hnKCZkZWJ1Zy0+aXJxX3NhZmUsIC0xLCBpcnFfc2FmZSk7CisgICAgICAgIHVu
aW9uIGxvY2tfZGVidWcgc2VlbiwgbmV3ID0geyAwIH07CiAKLSAgICAgICAgaWYgKCBzZWVuID09
ICFpcnFfc2FmZSApCisgICAgICAgIG5ldy5pcnFfc2FmZSA9IGlycV9zYWZlOworICAgICAgICBz
ZWVuLnZhbCA9IGNtcHhjaGcoJmRlYnVnLT52YWwsIExPQ0tfREVCVUdfSU5JVFZBTCwgbmV3LnZh
bCk7CisKKyAgICAgICAgaWYgKCAhc2Vlbi51bnNlZW4gJiYgc2Vlbi5pcnFfc2FmZSA9PSAhaXJx
X3NhZmUgKQogICAgICAgICB7CiAgICAgICAgICAgICBwcmludGsoIkNIRUNLTE9DSyBGQUlMVVJF
OiBwcmV2IGlycXNhZmU6ICVkLCBjdXJyIGlycXNhZmUgJWRcbiIsCi0gICAgICAgICAgICAgICAg
ICAgc2VlbiwgaXJxX3NhZmUpOworICAgICAgICAgICAgICAgICAgIHNlZW4uaXJxX3NhZmUsIGly
cV9zYWZlKTsKICAgICAgICAgICAgIEJVRygpOwogICAgICAgICB9CiAgICAgfQogfQogCi1zdGF0
aWMgdm9pZCBjaGVja19iYXJyaWVyKHN0cnVjdCBsb2NrX2RlYnVnICpkZWJ1ZykKK3N0YXRpYyB2
b2lkIGNoZWNrX2JhcnJpZXIodW5pb24gbG9ja19kZWJ1ZyAqZGVidWcpCiB7CiAgICAgaWYgKCB1
bmxpa2VseShhdG9taWNfcmVhZCgmc3Bpbl9kZWJ1ZykgPD0gMCkgKQogICAgICAgICByZXR1cm47
CkBAIC03MCw3ICs3MywxOCBAQCBzdGF0aWMgdm9pZCBjaGVja19iYXJyaWVyKHN0cnVjdCBsb2Nr
X2RlYnVnICpkZWJ1ZykKICAgICAgKiBIb3dldmVyLCBpZiB3ZSBzcGluIG9uIGFuIElSUS11bnNh
ZmUgbG9jayB3aXRoIElSUXMgZGlzYWJsZWQgdGhlbiB0aGF0CiAgICAgICogaXMgY2xlYXJseSB3
cm9uZywgZm9yIHRoZSBzYW1lIHJlYXNvbiBvdXRsaW5lZCBpbiBjaGVja19sb2NrKCkgYWJvdmUu
CiAgICAgICovCi0gICAgQlVHX09OKCFsb2NhbF9pcnFfaXNfZW5hYmxlZCgpICYmIChkZWJ1Zy0+
aXJxX3NhZmUgPT0gMCkpOworICAgIEJVR19PTighbG9jYWxfaXJxX2lzX2VuYWJsZWQoKSAmJiAh
ZGVidWctPmlycV9zYWZlKTsKK30KKworc3RhdGljIHZvaWQgZ290X2xvY2sodW5pb24gbG9ja19k
ZWJ1ZyAqZGVidWcpCit7CisgICAgZGVidWctPmNwdSA9IHNtcF9wcm9jZXNzb3JfaWQoKTsKK30K
Kworc3RhdGljIHZvaWQgcmVsX2xvY2sodW5pb24gbG9ja19kZWJ1ZyAqZGVidWcpCit7CisgICAg
QVNTRVJUKGRlYnVnLT5jcHUgPT0gc21wX3Byb2Nlc3Nvcl9pZCgpKTsKKyAgICBkZWJ1Zy0+Y3B1
ID0gU1BJTkxPQ0tfTk9fQ1BVOwogfQogCiB2b2lkIHNwaW5fZGVidWdfZW5hYmxlKHZvaWQpCkBA
IC04Nyw2ICsxMDEsOCBAQCB2b2lkIHNwaW5fZGVidWdfZGlzYWJsZSh2b2lkKQogCiAjZGVmaW5l
IGNoZWNrX2xvY2sobCkgKCh2b2lkKTApCiAjZGVmaW5lIGNoZWNrX2JhcnJpZXIobCkgKCh2b2lk
KTApCisjZGVmaW5lIGdvdF9sb2NrKGwpICgodm9pZCkwKQorI2RlZmluZSByZWxfbG9jayhsKSAo
KHZvaWQpMCkKIAogI2VuZGlmCiAKQEAgLTE1MCw2ICsxNjYsNyBAQCB2b2lkIGlubGluZSBfc3Bp
bl9sb2NrX2NiKHNwaW5sb2NrX3QgKmxvY2ssIHZvaWQgKCpjYikodm9pZCAqKSwgdm9pZCAqZGF0
YSkKICAgICAgICAgICAgIGNiKGRhdGEpOwogICAgICAgICBhcmNoX2xvY2tfcmVsYXgoKTsKICAg
ICB9CisgICAgZ290X2xvY2soJmxvY2stPmRlYnVnKTsKICAgICBMT0NLX1BST0ZJTEVfR09UOwog
ICAgIHByZWVtcHRfZGlzYWJsZSgpOwogICAgIGFyY2hfbG9ja19hY3F1aXJlX2JhcnJpZXIoKTsK
QEAgLTE4MSw2ICsxOTgsNyBAQCB2b2lkIF9zcGluX3VubG9jayhzcGlubG9ja190ICpsb2NrKQog
ICAgIGFyY2hfbG9ja19yZWxlYXNlX2JhcnJpZXIoKTsKICAgICBwcmVlbXB0X2VuYWJsZSgpOwog
ICAgIExPQ0tfUFJPRklMRV9SRUw7CisgICAgcmVsX2xvY2soJmxvY2stPmRlYnVnKTsKICAgICBh
ZGRfc2l6ZWQoJmxvY2stPnRpY2tldHMuaGVhZCwgMSk7CiAgICAgYXJjaF9sb2NrX3NpZ25hbCgp
OwogfQpAQCAtMjI0LDYgKzI0Miw3IEBAIGludCBfc3Bpbl90cnlsb2NrKHNwaW5sb2NrX3QgKmxv
Y2spCiAgICAgaWYgKCBjbXB4Y2hnKCZsb2NrLT50aWNrZXRzLmhlYWRfdGFpbCwKICAgICAgICAg
ICAgICAgICAgb2xkLmhlYWRfdGFpbCwgbmV3LmhlYWRfdGFpbCkgIT0gb2xkLmhlYWRfdGFpbCAp
CiAgICAgICAgIHJldHVybiAwOworICAgIGdvdF9sb2NrKCZsb2NrLT5kZWJ1Zyk7CiAjaWZkZWYg
Q09ORklHX0xPQ0tfUFJPRklMRQogICAgIGlmIChsb2NrLT5wcm9maWxlKQogICAgICAgICBsb2Nr
LT5wcm9maWxlLT50aW1lX2xvY2tlZCA9IE5PVygpOwpkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUv
eGVuL3NwaW5sb2NrLmggYi94ZW4vaW5jbHVkZS94ZW4vc3BpbmxvY2suaAppbmRleCBhODExYjcz
YmYzLi45N2I2MjAwYmY1IDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS94ZW4vc3BpbmxvY2suaAor
KysgYi94ZW4vaW5jbHVkZS94ZW4vc3BpbmxvY2suaApAQCAtNywxNCArNywyMSBAQAogI2luY2x1
ZGUgPHhlbi9wZXJjcHUuaD4KIAogI2lmbmRlZiBOREVCVUcKLXN0cnVjdCBsb2NrX2RlYnVnIHsK
LSAgICBzMTYgaXJxX3NhZmU7IC8qICsxOiBJUlEtc2FmZTsgMDogbm90IElSUS1zYWZlOyAtMTog
ZG9uJ3Qga25vdyB5ZXQgKi8KK3VuaW9uIGxvY2tfZGVidWcgeworICAgIHVpbnQxNl90IHZhbDsK
KyNkZWZpbmUgTE9DS19ERUJVR19JTklUVkFMIDB4ZmZmZgorICAgIHN0cnVjdCB7CisgICAgICAg
IHVpbnQxNl90IGNwdToxMjsKKyAgICAgICAgdWludDE2X3QgcGFkOjI7CisgICAgICAgIGJvb2wg
aXJxX3NhZmU6MTsKKyAgICAgICAgYm9vbCB1bnNlZW46MTsKKyAgICB9OwogfTsKLSNkZWZpbmUg
X0xPQ0tfREVCVUcgeyAtMSB9CisjZGVmaW5lIF9MT0NLX0RFQlVHIHsgTE9DS19ERUJVR19JTklU
VkFMIH0KIHZvaWQgc3Bpbl9kZWJ1Z19lbmFibGUodm9pZCk7CiB2b2lkIHNwaW5fZGVidWdfZGlz
YWJsZSh2b2lkKTsKICNlbHNlCi1zdHJ1Y3QgbG9ja19kZWJ1ZyB7IH07Cit1bmlvbiBsb2NrX2Rl
YnVnIHsgfTsKICNkZWZpbmUgX0xPQ0tfREVCVUcgeyB9CiAjZGVmaW5lIHNwaW5fZGVidWdfZW5h
YmxlKCkgKCh2b2lkKTApCiAjZGVmaW5lIHNwaW5fZGVidWdfZGlzYWJsZSgpICgodm9pZCkwKQpA
QCAtMTQzLDcgKzE1MCw3IEBAIHR5cGVkZWYgc3RydWN0IHNwaW5sb2NrIHsKICNkZWZpbmUgU1BJ
TkxPQ0tfTk9fQ1BVIDB4ZmZmdQogICAgIHUxNiByZWN1cnNlX2NudDo0OwogI2RlZmluZSBTUElO
TE9DS19NQVhfUkVDVVJTRSAweGZ1Ci0gICAgc3RydWN0IGxvY2tfZGVidWcgZGVidWc7CisgICAg
dW5pb24gbG9ja19kZWJ1ZyBkZWJ1ZzsKICNpZmRlZiBDT05GSUdfTE9DS19QUk9GSUxFCiAgICAg
c3RydWN0IGxvY2tfcHJvZmlsZSAqcHJvZmlsZTsKICNlbmRpZgotLSAKMi4xNi40CgoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxp
bmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5w
cm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

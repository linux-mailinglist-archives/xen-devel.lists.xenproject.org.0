Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id BA8D8129803
	for <lists+xen-devel@lfdr.de>; Mon, 23 Dec 2019 16:21:36 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1ijPT9-0006LW-1U; Mon, 23 Dec 2019 15:18:03 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=o8ed=2N=gmail.com=rosbrookn@srs-us1.protection.inumbo.net>)
 id 1ijPT7-0006L9-H9
 for xen-devel@lists.xenproject.org; Mon, 23 Dec 2019 15:18:01 +0000
X-Inumbo-ID: 61fc91f8-2597-11ea-88e7-bc764e2007e4
Received: from mail-qk1-x735.google.com (unknown [2607:f8b0:4864:20::735])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 61fc91f8-2597-11ea-88e7-bc764e2007e4;
 Mon, 23 Dec 2019 15:17:50 +0000 (UTC)
Received: by mail-qk1-x735.google.com with SMTP id j9so14147210qkk.1
 for <xen-devel@lists.xenproject.org>; Mon, 23 Dec 2019 07:17:50 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :in-reply-to:references;
 bh=7RvqR+8RmCVrc5ss1vsqFIrpOywrRiZJTYQb8T+T+c0=;
 b=kzH123YkoHsccstYOcr2Dgk0pz7WpDIc+Up2PGBKnMVFwrgPHB0GY9cCnBSMQXZcSi
 wZ8TugaOc2zYbeG4bZ2APSnpw2IUe8jqJHI/x2QIbToMDOZ+8WI/aQ0U47Taq+HZte0B
 8EcUqO/lSYBQEQkzor4PZkea0pyZfTagOxmau1i+8WFt+IW8cF8/ddEV3OeOucMnNXBt
 G82SxSniubkFo8Vh3a5nFNwgaCKoSOyMYGzq0T53C5tepeneacTGtVPP4/vcDBIj2OLw
 Xm4LR6nMchEfi+pnqiLiYXUYqrmNe9Upe679bhIm91M/77GdjbtFawZ1VsCfuzNikgKd
 95ew==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:in-reply-to:references;
 bh=7RvqR+8RmCVrc5ss1vsqFIrpOywrRiZJTYQb8T+T+c0=;
 b=bYvprpCjRJl42H5ZpUSlOfksB7o60RB7yRbD8N/fLJtG9dReL03cuYd35QQkGSkgZd
 IPDMvFISSiijx9zFlXruMIuDyzh9kr4ljwSRNG9lyHvAA7DnH6eGzpf+LntbzEXlne3+
 yosLO4l4ttIKLEcEcOAeGV4FqGnK5xl2rjrgozyAi0nTXgOPHPoAO3XBRo8KNqzESqUD
 1VVM/DJyiNXtx9Sg3xx9hUNYOUq9Wwwj7G8eg+N03dMXzVKwU/sI7PKivb7LcEz6tYcv
 XayBMd78+Qck3b4Kfh9V1uWnkoGn629OqxWWtmeNVVXU5E9krb/qDx2RiTgiBIrcHUiS
 4aRA==
X-Gm-Message-State: APjAAAWdNB6osNskwRkC9VKTpIx0L6JbsQrVzfRDTpFW4S0IPJTfT/Wv
 bz72LwfNX53f9KtFbWPaOGYdwURx
X-Google-Smtp-Source: APXvYqyLu++Cb4wasE9eesQsafB6ZSV7hg+a8xQTFsbyRH/GzxT7GLI0qUL0wUvoAA8H/lQ5co4MCw==
X-Received: by 2002:a37:9fc9:: with SMTP id
 i192mr25652605qke.364.1577114269449; 
 Mon, 23 Dec 2019 07:17:49 -0800 (PST)
Received: from four.lan (cpe-67-241-56-252.twcny.res.rr.com. [67.241.56.252])
 by smtp.gmail.com with ESMTPSA id
 u15sm5823907qku.67.2019.12.23.07.17.48
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Mon, 23 Dec 2019 07:17:48 -0800 (PST)
From: Nick Rosbrook <rosbrookn@gmail.com>
X-Google-Original-From: Nick Rosbrook <rosbrookn@ainfosec.com>
To: xen-devel@lists.xenproject.org
Date: Mon, 23 Dec 2019 10:17:04 -0500
Message-Id: <76a6287109680626e816c9f2d8f0a7666fef8ee9.1577111872.git.rosbrookn@ainfosec.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <cover.1577111872.git.rosbrookn@ainfosec.com>
References: <cover.1577111872.git.rosbrookn@ainfosec.com>
In-Reply-To: <cover.1577111872.git.rosbrookn@ainfosec.com>
References: <cover.1577111872.git.rosbrookn@ainfosec.com>
Subject: [Xen-devel] [PATCH v4 3/6] golang/xenlight: implement keyed union
 Go to C marshaling
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Nick Rosbrook <rosbrookn@ainfosec.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, kerriganb@ainfosec.com,
 George Dunlap <george.dunlap@citrix.com>, Wei Liu <wl@xen.org>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

U2luY2UgdGhlIEMgdW5pb24gY2Fubm90IGJlIGRpcmVjdGx5IHBvcHVsYXRlZCwgcG9wdWxhdGUg
dGhlIGZpZWxkcyBvZiB0aGUKY29ycmVzcG9uZGluZyBDIHN0cnVjdCBkZWZpbmVkIGluIHRoZSBj
Z28gcHJlYW1ibGUsIGFuZCB0aGVuIGNvcHkgdGhhdApzdHJ1Y3QgYXMgYnl0ZXMgaW50byB0aGUg
Ynl0ZSBzbGljZSB0aGF0IEdvIHVzZXMgYXMgdGhlIHVuaW9uLgoKU2lnbmVkLW9mZi1ieTogTmlj
ayBSb3Nicm9vayA8cm9zYnJvb2tuQGFpbmZvc2VjLmNvbT4KLS0tCiB0b29scy9nb2xhbmcveGVu
bGlnaHQvZ2VuZ290eXBlcy5weSAgfCAgNzcgKysrKysrLQogdG9vbHMvZ29sYW5nL3hlbmxpZ2h0
L2hlbHBlcnMuZ2VuLmdvIHwgMzI1ICsrKysrKysrKysrKysrKysrKysrKysrKysrKwogMiBmaWxl
cyBjaGFuZ2VkLCA0MDAgaW5zZXJ0aW9ucygrKSwgMiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQg
YS90b29scy9nb2xhbmcveGVubGlnaHQvZ2VuZ290eXBlcy5weSBiL3Rvb2xzL2dvbGFuZy94ZW5s
aWdodC9nZW5nb3R5cGVzLnB5CmluZGV4IDlkNWY4MzAwYTIuLmIzNzdmZDlhMjUgMTAwNjQ0Ci0t
LSBhL3Rvb2xzL2dvbGFuZy94ZW5saWdodC9nZW5nb3R5cGVzLnB5CisrKyBiL3Rvb2xzL2dvbGFu
Zy94ZW5saWdodC9nZW5nb3R5cGVzLnB5CkBAIC01MDIsOCArNTAyLDcgQEAgZGVmIHhlbmxpZ2h0
X2dvbGFuZ19kZWZpbmVfdG9fQyh0eSA9IE5vbmUsIHR5cGVuYW1lID0gTm9uZSwgbmVzdGVkID0g
RmFsc2UpOgogICAgICAgICAgICAgcyArPSB4ZW5saWdodF9nb2xhbmdfZGVmaW5lX3RvX0MoZi50
eXBlLCB0eXBlbmFtZT1mLm5hbWUsIG5lc3RlZD1UcnVlKQogCiAgICAgICAgIGVsaWYgaXNpbnN0
YW5jZShmLnR5cGUsIGlkbC5LZXllZFVuaW9uKToKLSAgICAgICAgICAgICMgVE9ETwotICAgICAg
ICAgICAgcGFzcworICAgICAgICAgICAgcyArPSB4ZW5saWdodF9nb2xhbmdfdW5pb25fdG9fQyhm
LnR5cGUsIGYubmFtZSwgdHkudHlwZW5hbWUsIHR5LmRpc3Bvc2VfZm4pCiAKICAgICAgICAgZWxz
ZToKICAgICAgICAgICAgIHJhaXNlIEV4Y2VwdGlvbigndHlwZSB7fSBub3Qgc3VwcG9ydGVkJy5m
b3JtYXQoZi50eXBlKSkKQEAgLTUxNCw2ICs1MTMsODAgQEAgZGVmIHhlbmxpZ2h0X2dvbGFuZ19k
ZWZpbmVfdG9fQyh0eSA9IE5vbmUsIHR5cGVuYW1lID0gTm9uZSwgbmVzdGVkID0gRmFsc2UpOgog
CiAgICAgcmV0dXJuIHMKIAorZGVmIHhlbmxpZ2h0X2dvbGFuZ191bmlvbl90b19DKHR5ID0gTm9u
ZSwgdW5pb25fbmFtZSA9ICcnLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVj
dF9uYW1lID0gJycsIGRpc3Bvc2VfZm4gPSAnJyk6CisgICAga2V5bmFtZSAgID0gdHkua2V5dmFy
Lm5hbWUKKyAgICBnb2tleW5hbWUgPSB4ZW5saWdodF9nb2xhbmdfZm10X25hbWUoa2V5bmFtZSkK
KyAgICBrZXl0eXBlICAgPSB0eS5rZXl2YXIudHlwZS50eXBlbmFtZQorICAgIGdva2V5dHlwZSA9
IHhlbmxpZ2h0X2dvbGFuZ19mbXRfbmFtZShrZXl0eXBlKQorCisgICAgaW50ZXJmYWNlX25hbWUg
PSAne31fe31fdW5pb24nLmZvcm1hdChzdHJ1Y3RfbmFtZSwga2V5bmFtZSkKKyAgICBpbnRlcmZh
Y2VfbmFtZSA9IHhlbmxpZ2h0X2dvbGFuZ19mbXRfbmFtZShpbnRlcmZhY2VfbmFtZSwgZXhwb3J0
ZWQ9RmFsc2UpCisKKyAgICBjZ29fa2V5bmFtZSA9IGtleW5hbWUKKyAgICBpZiBjZ29fa2V5bmFt
ZSBpbiBnb19rZXl3b3JkczoKKyAgICAgICAgY2dvX2tleW5hbWUgPSAnXycgKyBjZ29fa2V5bmFt
ZQorCisKKyAgICBzID0gJ3hjLnt9ID0gQy57fSh4Lnt9KVxuJy5mb3JtYXQoY2dvX2tleW5hbWUs
a2V5dHlwZSxnb2tleW5hbWUpCisgICAgcyArPSAnc3dpdGNoIHgue317e1xuJy5mb3JtYXQoZ29r
ZXluYW1lKQorCisgICAgIyBDcmVhdGUgc3dpdGNoIHN0YXRlbWVudCB0byBkZXRlcm1pbmUgaG93
IHRvIHBvcHVsYXRlIHRoZSBDIHVuaW9uLgorICAgIGZvciBmIGluIHR5LmZpZWxkczoKKyAgICAg
ICAga2V5X3ZhbCA9ICd7fV97fScuZm9ybWF0KGtleXR5cGUsIGYubmFtZSkKKyAgICAgICAga2V5
X3ZhbCA9IHhlbmxpZ2h0X2dvbGFuZ19mbXRfbmFtZShrZXlfdmFsKQorICAgICAgICBpZiBmLnR5
cGUgaXMgTm9uZToKKyAgICAgICAgICAgIGNvbnRpbnVlCisKKyAgICAgICAgcyArPSAnY2FzZSB7
fTpcbicuZm9ybWF0KGtleV92YWwpCisgICAgICAgIGNnb3R5cGUgPSAne31fe31fdW5pb25fe30n
LmZvcm1hdChzdHJ1Y3RfbmFtZSxrZXluYW1lLGYubmFtZSkKKyAgICAgICAgZ290eXBlICA9IHhl
bmxpZ2h0X2dvbGFuZ19mbXRfbmFtZShjZ290eXBlKQorICAgICAgICBnb25hbWUgID0gJ3t9X3t9
Jy5mb3JtYXQoa2V5bmFtZSxmLm5hbWUpCisgICAgICAgIGdvbmFtZSAgPSB4ZW5saWdodF9nb2xh
bmdfZm10X25hbWUoZ29uYW1lLGV4cG9ydGVkPUZhbHNlKQorCisgICAgICAgIGZpZWxkX25hbWUg
PSB4ZW5saWdodF9nb2xhbmdfZm10X25hbWUoJ3t9X3VuaW9uJy5mb3JtYXQoa2V5bmFtZSkpCisg
ICAgICAgIHMgKz0gJ3RtcCwgb2sgOj0geC57fS4oe30pXG4nLmZvcm1hdChmaWVsZF9uYW1lLGdv
dHlwZSkKKyAgICAgICAgcyArPSAnaWYgIW9rIHtcbicKKyAgICAgICAgcyArPSAnQy57fSgmeGMp
XG4nLmZvcm1hdChkaXNwb3NlX2ZuKQorICAgICAgICBzICs9ICdyZXR1cm4geGMsZXJyb3JzLk5l
dygid3JvbmcgdHlwZSBmb3IgdW5pb24ga2V5IHt9IilcbicuZm9ybWF0KGtleW5hbWUpCisgICAg
ICAgIHMgKz0gJ31cbicKKworICAgICAgICBzICs9ICd2YXIge30gQy57fVxuJy5mb3JtYXQoZi5u
YW1lLGNnb3R5cGUpCisgICAgICAgIGZvciB1ZiBpbiBmLnR5cGUuZmllbGRzOgorICAgICAgICAg
ICAgZ290eXBlbmFtZSA9IHhlbmxpZ2h0X2dvbGFuZ19mbXRfbmFtZSh1Zi50eXBlLnR5cGVuYW1l
KQorICAgICAgICAgICAgY3R5cGVuYW1lICA9IHVmLnR5cGUudHlwZW5hbWUKKyAgICAgICAgICAg
IGdvZm5hbWUgICAgPSB4ZW5saWdodF9nb2xhbmdfZm10X25hbWUodWYubmFtZSkKKworICAgICAg
ICAgICAgaXNfY2FzdGFibGUgPSAodWYudHlwZS5qc29uX3BhcnNlX3R5cGUgPT0gJ0pTT05fSU5U
RUdFUicgb3IKKyAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzaW5zdGFuY2UodWYudHlwZSwg
aWRsLkVudW1lcmF0aW9uKSBvcgorICAgICAgICAgICAgICAgICAgICAgICAgICAgZ290eXBlbmFt
ZSBpbiBnb19idWlsdGluX3R5cGVzKQorCisgICAgICAgICAgICBpZiBub3QgaXNfY2FzdGFibGU6
CisgICAgICAgICAgICAgICAgcyArPSAne30ue30sIGVyciA9IHRtcC57fS50b0MoKVxuJy5mb3Jt
YXQoZi5uYW1lLHVmLm5hbWUsZ29mbmFtZSkKKyAgICAgICAgICAgICAgICBzICs9ICdpZiBlcnIg
IT0gbmlsIHtcbicKKyAgICAgICAgICAgICAgICBzICs9ICdDLnt9KCZ4YylcbicuZm9ybWF0KGRp
c3Bvc2VfZm4pCisgICAgICAgICAgICAgICAgcyArPSAncmV0dXJuIHhjLGVyciBcbn1cbicKKwor
ICAgICAgICAgICAgZWxpZiBnb3R5cGVuYW1lID09ICdzdHJpbmcnOgorICAgICAgICAgICAgICAg
IHMgKz0gJ3t9Lnt9ID0gQy5DU3RyaW5nKHRtcC57fSlcbicuZm9ybWF0KGYubmFtZSx1Zi5uYW1l
LGdvZm5hbWUpCisKKyAgICAgICAgICAgIGVsc2U6CisgICAgICAgICAgICAgICAgcyArPSAne30u
e30gPSBDLnt9KHRtcC57fSlcbicuZm9ybWF0KGYubmFtZSx1Zi5uYW1lLGN0eXBlbmFtZSxnb2Zu
YW1lKQorCisgICAgICAgICMgVGhlIHVuaW9uIGlzIHN0aWxsIHJlcHJlc2VudGVkIGFzIEdvIFtd
Ynl0ZS4KKyAgICAgICAgcyArPSAne31CeXRlcyA6PSBDLkdvQnl0ZXModW5zYWZlLlBvaW50ZXIo
Jnt9KSxDLnNpemVvZl97fSlcbicuZm9ybWF0KGYubmFtZSwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGYubmFtZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNnb3R5cGUpCisgICAgICAgIHMgKz0gJ2Nv
cHkoeGMue31bOl0se31CeXRlcylcbicuZm9ybWF0KHVuaW9uX25hbWUsZi5uYW1lKQorCisgICAg
IyBFbmQgc3dpdGNoIHN0YXRlbWVudAorICAgIHMgKz0gJ2RlZmF1bHQ6XG4nCisgICAgZXJyX3N0
cmluZyA9ICciaW52YWxpZCB1bmlvbiBrZXkgXCcldlwnIiwgeC57fScuZm9ybWF0KGdva2V5bmFt
ZSkKKyAgICBzICs9ICdyZXR1cm4geGMsIGZtdC5FcnJvcmYoe30pJy5mb3JtYXQoZXJyX3N0cmlu
ZykKKyAgICBzICs9ICd9XG4nCisKKyAgICByZXR1cm4gcworCiBkZWYgeGVubGlnaHRfZ29sYW5n
X2ZtdF9uYW1lKG5hbWUsIGV4cG9ydGVkID0gVHJ1ZSk6CiAgICAgIiIiCiAgICAgVGFrZSBhIGdp
dmVuIHR5cGUgbmFtZSBhbmQgcmV0dXJuIGFuCmRpZmYgLS1naXQgYS90b29scy9nb2xhbmcveGVu
bGlnaHQvaGVscGVycy5nZW4uZ28gYi90b29scy9nb2xhbmcveGVubGlnaHQvaGVscGVycy5nZW4u
Z28KaW5kZXggYmU4MGQ2YzcxOC4uMTU1NDhmOWQ2ZSAxMDA2NDQKLS0tIGEvdG9vbHMvZ29sYW5n
L3hlbmxpZ2h0L2hlbHBlcnMuZ2VuLmdvCisrKyBiL3Rvb2xzL2dvbGFuZy94ZW5saWdodC9oZWxw
ZXJzLmdlbi5nbwpAQCAtMzI2LDYgKzMyNiwyMSBAQCBmdW5jICh4ICpDaGFubmVsaW5mbykgdG9D
KCkgKHhjIEMubGlieGxfY2hhbm5lbGluZm8sIGVyciBlcnJvcikgewogCXhjLnN0YXRlID0gQy5p
bnQoeC5TdGF0ZSkKIAl4Yy5ldnRjaCA9IEMuaW50KHguRXZ0Y2gpCiAJeGMucnJlZiA9IEMuaW50
KHguUnJlZikKKwl4Yy5jb25uZWN0aW9uID0gQy5saWJ4bF9jaGFubmVsX2Nvbm5lY3Rpb24oeC5D
b25uZWN0aW9uKQorCXN3aXRjaCB4LkNvbm5lY3Rpb24geworCWNhc2UgQ2hhbm5lbENvbm5lY3Rp
b25QdHk6CisJCXRtcCwgb2sgOj0geC5Db25uZWN0aW9uVW5pb24uKENoYW5uZWxpbmZvQ29ubmVj
dGlvblVuaW9uUHR5KQorCQlpZiAhb2sgeworCQkJQy5saWJ4bF9jaGFubmVsaW5mb19kaXNwb3Nl
KCZ4YykKKwkJCXJldHVybiB4YywgZXJyb3JzLk5ldygid3JvbmcgdHlwZSBmb3IgdW5pb24ga2V5
IGNvbm5lY3Rpb24iKQorCQl9CisJCXZhciBwdHkgQy5saWJ4bF9jaGFubmVsaW5mb19jb25uZWN0
aW9uX3VuaW9uX3B0eQorCQlwdHkucGF0aCA9IEMuQ1N0cmluZyh0bXAuUGF0aCkKKwkJcHR5Qnl0
ZXMgOj0gQy5Hb0J5dGVzKHVuc2FmZS5Qb2ludGVyKCZwdHkpLCBDLnNpemVvZl9saWJ4bF9jaGFu
bmVsaW5mb19jb25uZWN0aW9uX3VuaW9uX3B0eSkKKwkJY29weSh4Yy51WzpdLCBwdHlCeXRlcykK
KwlkZWZhdWx0OgorCQlyZXR1cm4geGMsIGZtdC5FcnJvcmYoImludmFsaWQgdW5pb24ga2V5ICcl
diciLCB4LkNvbm5lY3Rpb24pCisJfQogCXJldHVybiB4YywgbmlsCiB9CiAKQEAgLTEwMTksNiAr
MTAzNCwyMTYgQEAgZnVuYyAoeCAqRG9tYWluQnVpbGRJbmZvKSB0b0MoKSAoeGMgQy5saWJ4bF9k
b21haW5fYnVpbGRfaW5mbywgZXJyIGVycm9yKSB7CiAJCXJldHVybiB4YywgZXJyCiAJfQogCXhj
LnRlZSA9IEMubGlieGxfdGVlX3R5cGUoeC5UZWUpCisJeGMuX3R5cGUgPSBDLmxpYnhsX2RvbWFp
bl90eXBlKHguVHlwZSkKKwlzd2l0Y2ggeC5UeXBlIHsKKwljYXNlIERvbWFpblR5cGVIdm06CisJ
CXRtcCwgb2sgOj0geC5UeXBlVW5pb24uKERvbWFpbkJ1aWxkSW5mb1R5cGVVbmlvbkh2bSkKKwkJ
aWYgIW9rIHsKKwkJCUMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fZGlzcG9zZSgmeGMpCisJCQly
ZXR1cm4geGMsIGVycm9ycy5OZXcoIndyb25nIHR5cGUgZm9yIHVuaW9uIGtleSB0eXBlIikKKwkJ
fQorCQl2YXIgaHZtIEMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fdHlwZV91bmlvbl9odm0KKwkJ
aHZtLmZpcm13YXJlID0gQy5DU3RyaW5nKHRtcC5GaXJtd2FyZSkKKwkJaHZtLmJpb3MgPSBDLmxp
YnhsX2Jpb3NfdHlwZSh0bXAuQmlvcykKKwkJaHZtLnBhZSwgZXJyID0gdG1wLlBhZS50b0MoKQor
CQlpZiBlcnIgIT0gbmlsIHsKKwkJCUMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fZGlzcG9zZSgm
eGMpCisJCQlyZXR1cm4geGMsIGVycgorCQl9CisJCWh2bS5hcGljLCBlcnIgPSB0bXAuQXBpYy50
b0MoKQorCQlpZiBlcnIgIT0gbmlsIHsKKwkJCUMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fZGlz
cG9zZSgmeGMpCisJCQlyZXR1cm4geGMsIGVycgorCQl9CisJCWh2bS5hY3BpLCBlcnIgPSB0bXAu
QWNwaS50b0MoKQorCQlpZiBlcnIgIT0gbmlsIHsKKwkJCUMubGlieGxfZG9tYWluX2J1aWxkX2lu
Zm9fZGlzcG9zZSgmeGMpCisJCQlyZXR1cm4geGMsIGVycgorCQl9CisJCWh2bS5hY3BpX3MzLCBl
cnIgPSB0bXAuQWNwaVMzLnRvQygpCisJCWlmIGVyciAhPSBuaWwgeworCQkJQy5saWJ4bF9kb21h
aW5fYnVpbGRfaW5mb19kaXNwb3NlKCZ4YykKKwkJCXJldHVybiB4YywgZXJyCisJCX0KKwkJaHZt
LmFjcGlfczQsIGVyciA9IHRtcC5BY3BpUzQudG9DKCkKKwkJaWYgZXJyICE9IG5pbCB7CisJCQlD
LmxpYnhsX2RvbWFpbl9idWlsZF9pbmZvX2Rpc3Bvc2UoJnhjKQorCQkJcmV0dXJuIHhjLCBlcnIK
KwkJfQorCQlodm0uYWNwaV9sYXB0b3Bfc2xhdGUsIGVyciA9IHRtcC5BY3BpTGFwdG9wU2xhdGUu
dG9DKCkKKwkJaWYgZXJyICE9IG5pbCB7CisJCQlDLmxpYnhsX2RvbWFpbl9idWlsZF9pbmZvX2Rp
c3Bvc2UoJnhjKQorCQkJcmV0dXJuIHhjLCBlcnIKKwkJfQorCQlodm0ubngsIGVyciA9IHRtcC5O
eC50b0MoKQorCQlpZiBlcnIgIT0gbmlsIHsKKwkJCUMubGlieGxfZG9tYWluX2J1aWxkX2luZm9f
ZGlzcG9zZSgmeGMpCisJCQlyZXR1cm4geGMsIGVycgorCQl9CisJCWh2bS52aXJpZGlhbiwgZXJy
ID0gdG1wLlZpcmlkaWFuLnRvQygpCisJCWlmIGVyciAhPSBuaWwgeworCQkJQy5saWJ4bF9kb21h
aW5fYnVpbGRfaW5mb19kaXNwb3NlKCZ4YykKKwkJCXJldHVybiB4YywgZXJyCisJCX0KKwkJaHZt
LnZpcmlkaWFuX2VuYWJsZSwgZXJyID0gdG1wLlZpcmlkaWFuRW5hYmxlLnRvQygpCisJCWlmIGVy
ciAhPSBuaWwgeworCQkJQy5saWJ4bF9kb21haW5fYnVpbGRfaW5mb19kaXNwb3NlKCZ4YykKKwkJ
CXJldHVybiB4YywgZXJyCisJCX0KKwkJaHZtLnZpcmlkaWFuX2Rpc2FibGUsIGVyciA9IHRtcC5W
aXJpZGlhbkRpc2FibGUudG9DKCkKKwkJaWYgZXJyICE9IG5pbCB7CisJCQlDLmxpYnhsX2RvbWFp
bl9idWlsZF9pbmZvX2Rpc3Bvc2UoJnhjKQorCQkJcmV0dXJuIHhjLCBlcnIKKwkJfQorCQlodm0u
dGltZW9mZnNldCA9IEMuQ1N0cmluZyh0bXAuVGltZW9mZnNldCkKKwkJaHZtLmhwZXQsIGVyciA9
IHRtcC5IcGV0LnRvQygpCisJCWlmIGVyciAhPSBuaWwgeworCQkJQy5saWJ4bF9kb21haW5fYnVp
bGRfaW5mb19kaXNwb3NlKCZ4YykKKwkJCXJldHVybiB4YywgZXJyCisJCX0KKwkJaHZtLnZwdF9h
bGlnbiwgZXJyID0gdG1wLlZwdEFsaWduLnRvQygpCisJCWlmIGVyciAhPSBuaWwgeworCQkJQy5s
aWJ4bF9kb21haW5fYnVpbGRfaW5mb19kaXNwb3NlKCZ4YykKKwkJCXJldHVybiB4YywgZXJyCisJ
CX0KKwkJaHZtLm1taW9faG9sZV9tZW1rYiA9IEMudWludDY0X3QodG1wLk1taW9Ib2xlTWVta2Ip
CisJCWh2bS50aW1lcl9tb2RlID0gQy5saWJ4bF90aW1lcl9tb2RlKHRtcC5UaW1lck1vZGUpCisJ
CWh2bS5uZXN0ZWRfaHZtLCBlcnIgPSB0bXAuTmVzdGVkSHZtLnRvQygpCisJCWlmIGVyciAhPSBu
aWwgeworCQkJQy5saWJ4bF9kb21haW5fYnVpbGRfaW5mb19kaXNwb3NlKCZ4YykKKwkJCXJldHVy
biB4YywgZXJyCisJCX0KKwkJaHZtLmFsdHAybSwgZXJyID0gdG1wLkFsdHAyTS50b0MoKQorCQlp
ZiBlcnIgIT0gbmlsIHsKKwkJCUMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fZGlzcG9zZSgmeGMp
CisJCQlyZXR1cm4geGMsIGVycgorCQl9CisJCWh2bS5zeXN0ZW1fZmlybXdhcmUgPSBDLkNTdHJp
bmcodG1wLlN5c3RlbUZpcm13YXJlKQorCQlodm0uc21iaW9zX2Zpcm13YXJlID0gQy5DU3RyaW5n
KHRtcC5TbWJpb3NGaXJtd2FyZSkKKwkJaHZtLmFjcGlfZmlybXdhcmUgPSBDLkNTdHJpbmcodG1w
LkFjcGlGaXJtd2FyZSkKKwkJaHZtLmhkdHlwZSA9IEMubGlieGxfaGR0eXBlKHRtcC5IZHR5cGUp
CisJCWh2bS5ub2dyYXBoaWMsIGVyciA9IHRtcC5Ob2dyYXBoaWMudG9DKCkKKwkJaWYgZXJyICE9
IG5pbCB7CisJCQlDLmxpYnhsX2RvbWFpbl9idWlsZF9pbmZvX2Rpc3Bvc2UoJnhjKQorCQkJcmV0
dXJuIHhjLCBlcnIKKwkJfQorCQlodm0udmdhLCBlcnIgPSB0bXAuVmdhLnRvQygpCisJCWlmIGVy
ciAhPSBuaWwgeworCQkJQy5saWJ4bF9kb21haW5fYnVpbGRfaW5mb19kaXNwb3NlKCZ4YykKKwkJ
CXJldHVybiB4YywgZXJyCisJCX0KKwkJaHZtLnZuYywgZXJyID0gdG1wLlZuYy50b0MoKQorCQlp
ZiBlcnIgIT0gbmlsIHsKKwkJCUMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fZGlzcG9zZSgmeGMp
CisJCQlyZXR1cm4geGMsIGVycgorCQl9CisJCWh2bS5rZXltYXAgPSBDLkNTdHJpbmcodG1wLktl
eW1hcCkKKwkJaHZtLnNkbCwgZXJyID0gdG1wLlNkbC50b0MoKQorCQlpZiBlcnIgIT0gbmlsIHsK
KwkJCUMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fZGlzcG9zZSgmeGMpCisJCQlyZXR1cm4geGMs
IGVycgorCQl9CisJCWh2bS5zcGljZSwgZXJyID0gdG1wLlNwaWNlLnRvQygpCisJCWlmIGVyciAh
PSBuaWwgeworCQkJQy5saWJ4bF9kb21haW5fYnVpbGRfaW5mb19kaXNwb3NlKCZ4YykKKwkJCXJl
dHVybiB4YywgZXJyCisJCX0KKwkJaHZtLmdmeF9wYXNzdGhydSwgZXJyID0gdG1wLkdmeFBhc3N0
aHJ1LnRvQygpCisJCWlmIGVyciAhPSBuaWwgeworCQkJQy5saWJ4bF9kb21haW5fYnVpbGRfaW5m
b19kaXNwb3NlKCZ4YykKKwkJCXJldHVybiB4YywgZXJyCisJCX0KKwkJaHZtLmdmeF9wYXNzdGhy
dV9raW5kID0gQy5saWJ4bF9nZnhfcGFzc3RocnVfa2luZCh0bXAuR2Z4UGFzc3RocnVLaW5kKQor
CQlodm0uc2VyaWFsID0gQy5DU3RyaW5nKHRtcC5TZXJpYWwpCisJCWh2bS5ib290ID0gQy5DU3Ry
aW5nKHRtcC5Cb290KQorCQlodm0udXNiLCBlcnIgPSB0bXAuVXNiLnRvQygpCisJCWlmIGVyciAh
PSBuaWwgeworCQkJQy5saWJ4bF9kb21haW5fYnVpbGRfaW5mb19kaXNwb3NlKCZ4YykKKwkJCXJl
dHVybiB4YywgZXJyCisJCX0KKwkJaHZtLnVzYnZlcnNpb24gPSBDLmludCh0bXAuVXNidmVyc2lv
bikKKwkJaHZtLnVzYmRldmljZSA9IEMuQ1N0cmluZyh0bXAuVXNiZGV2aWNlKQorCQlodm0udmti
X2RldmljZSwgZXJyID0gdG1wLlZrYkRldmljZS50b0MoKQorCQlpZiBlcnIgIT0gbmlsIHsKKwkJ
CUMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fZGlzcG9zZSgmeGMpCisJCQlyZXR1cm4geGMsIGVy
cgorCQl9CisJCWh2bS5zb3VuZGh3ID0gQy5DU3RyaW5nKHRtcC5Tb3VuZGh3KQorCQlodm0ueGVu
X3BsYXRmb3JtX3BjaSwgZXJyID0gdG1wLlhlblBsYXRmb3JtUGNpLnRvQygpCisJCWlmIGVyciAh
PSBuaWwgeworCQkJQy5saWJ4bF9kb21haW5fYnVpbGRfaW5mb19kaXNwb3NlKCZ4YykKKwkJCXJl
dHVybiB4YywgZXJyCisJCX0KKwkJaHZtLnVzYmRldmljZV9saXN0LCBlcnIgPSB0bXAuVXNiZGV2
aWNlTGlzdC50b0MoKQorCQlpZiBlcnIgIT0gbmlsIHsKKwkJCUMubGlieGxfZG9tYWluX2J1aWxk
X2luZm9fZGlzcG9zZSgmeGMpCisJCQlyZXR1cm4geGMsIGVycgorCQl9CisJCWh2bS52ZW5kb3Jf
ZGV2aWNlID0gQy5saWJ4bF92ZW5kb3JfZGV2aWNlKHRtcC5WZW5kb3JEZXZpY2UpCisJCWh2bS5t
c192bV9nZW5pZCwgZXJyID0gdG1wLk1zVm1HZW5pZC50b0MoKQorCQlpZiBlcnIgIT0gbmlsIHsK
KwkJCUMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fZGlzcG9zZSgmeGMpCisJCQlyZXR1cm4geGMs
IGVycgorCQl9CisJCWh2bS5zZXJpYWxfbGlzdCwgZXJyID0gdG1wLlNlcmlhbExpc3QudG9DKCkK
KwkJaWYgZXJyICE9IG5pbCB7CisJCQlDLmxpYnhsX2RvbWFpbl9idWlsZF9pbmZvX2Rpc3Bvc2Uo
JnhjKQorCQkJcmV0dXJuIHhjLCBlcnIKKwkJfQorCQlodm0ucmRtLCBlcnIgPSB0bXAuUmRtLnRv
QygpCisJCWlmIGVyciAhPSBuaWwgeworCQkJQy5saWJ4bF9kb21haW5fYnVpbGRfaW5mb19kaXNw
b3NlKCZ4YykKKwkJCXJldHVybiB4YywgZXJyCisJCX0KKwkJaHZtLnJkbV9tZW1fYm91bmRhcnlf
bWVta2IgPSBDLnVpbnQ2NF90KHRtcC5SZG1NZW1Cb3VuZGFyeU1lbWtiKQorCQlodm0ubWNhX2Nh
cHMgPSBDLnVpbnQ2NF90KHRtcC5NY2FDYXBzKQorCQlodm1CeXRlcyA6PSBDLkdvQnl0ZXModW5z
YWZlLlBvaW50ZXIoJmh2bSksIEMuc2l6ZW9mX2xpYnhsX2RvbWFpbl9idWlsZF9pbmZvX3R5cGVf
dW5pb25faHZtKQorCQljb3B5KHhjLnVbOl0sIGh2bUJ5dGVzKQorCWNhc2UgRG9tYWluVHlwZVB2
OgorCQl0bXAsIG9rIDo9IHguVHlwZVVuaW9uLihEb21haW5CdWlsZEluZm9UeXBlVW5pb25QdikK
KwkJaWYgIW9rIHsKKwkJCUMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fZGlzcG9zZSgmeGMpCisJ
CQlyZXR1cm4geGMsIGVycm9ycy5OZXcoIndyb25nIHR5cGUgZm9yIHVuaW9uIGtleSB0eXBlIikK
KwkJfQorCQl2YXIgcHYgQy5saWJ4bF9kb21haW5fYnVpbGRfaW5mb190eXBlX3VuaW9uX3B2CisJ
CXB2Lmtlcm5lbCA9IEMuQ1N0cmluZyh0bXAuS2VybmVsKQorCQlwdi5zbGFja19tZW1rYiA9IEMu
dWludDY0X3QodG1wLlNsYWNrTWVta2IpCisJCXB2LmJvb3Rsb2FkZXIgPSBDLkNTdHJpbmcodG1w
LkJvb3Rsb2FkZXIpCisJCXB2LmJvb3Rsb2FkZXJfYXJncywgZXJyID0gdG1wLkJvb3Rsb2FkZXJB
cmdzLnRvQygpCisJCWlmIGVyciAhPSBuaWwgeworCQkJQy5saWJ4bF9kb21haW5fYnVpbGRfaW5m
b19kaXNwb3NlKCZ4YykKKwkJCXJldHVybiB4YywgZXJyCisJCX0KKwkJcHYuY21kbGluZSA9IEMu
Q1N0cmluZyh0bXAuQ21kbGluZSkKKwkJcHYucmFtZGlzayA9IEMuQ1N0cmluZyh0bXAuUmFtZGlz
aykKKwkJcHYuZmVhdHVyZXMgPSBDLkNTdHJpbmcodG1wLkZlYXR1cmVzKQorCQlwdi5lODIwX2hv
c3QsIGVyciA9IHRtcC5FODIwSG9zdC50b0MoKQorCQlpZiBlcnIgIT0gbmlsIHsKKwkJCUMubGli
eGxfZG9tYWluX2J1aWxkX2luZm9fZGlzcG9zZSgmeGMpCisJCQlyZXR1cm4geGMsIGVycgorCQl9
CisJCXB2Qnl0ZXMgOj0gQy5Hb0J5dGVzKHVuc2FmZS5Qb2ludGVyKCZwdiksIEMuc2l6ZW9mX2xp
YnhsX2RvbWFpbl9idWlsZF9pbmZvX3R5cGVfdW5pb25fcHYpCisJCWNvcHkoeGMudVs6XSwgcHZC
eXRlcykKKwljYXNlIERvbWFpblR5cGVQdmg6CisJCXRtcCwgb2sgOj0geC5UeXBlVW5pb24uKERv
bWFpbkJ1aWxkSW5mb1R5cGVVbmlvblB2aCkKKwkJaWYgIW9rIHsKKwkJCUMubGlieGxfZG9tYWlu
X2J1aWxkX2luZm9fZGlzcG9zZSgmeGMpCisJCQlyZXR1cm4geGMsIGVycm9ycy5OZXcoIndyb25n
IHR5cGUgZm9yIHVuaW9uIGtleSB0eXBlIikKKwkJfQorCQl2YXIgcHZoIEMubGlieGxfZG9tYWlu
X2J1aWxkX2luZm9fdHlwZV91bmlvbl9wdmgKKwkJcHZoLnB2c2hpbSwgZXJyID0gdG1wLlB2c2hp
bS50b0MoKQorCQlpZiBlcnIgIT0gbmlsIHsKKwkJCUMubGlieGxfZG9tYWluX2J1aWxkX2luZm9f
ZGlzcG9zZSgmeGMpCisJCQlyZXR1cm4geGMsIGVycgorCQl9CisJCXB2aC5wdnNoaW1fcGF0aCA9
IEMuQ1N0cmluZyh0bXAuUHZzaGltUGF0aCkKKwkJcHZoLnB2c2hpbV9jbWRsaW5lID0gQy5DU3Ry
aW5nKHRtcC5QdnNoaW1DbWRsaW5lKQorCQlwdmgucHZzaGltX2V4dHJhID0gQy5DU3RyaW5nKHRt
cC5QdnNoaW1FeHRyYSkKKwkJcHZoQnl0ZXMgOj0gQy5Hb0J5dGVzKHVuc2FmZS5Qb2ludGVyKCZw
dmgpLCBDLnNpemVvZl9saWJ4bF9kb21haW5fYnVpbGRfaW5mb190eXBlX3VuaW9uX3B2aCkKKwkJ
Y29weSh4Yy51WzpdLCBwdmhCeXRlcykKKwlkZWZhdWx0OgorCQlyZXR1cm4geGMsIGZtdC5FcnJv
cmYoImludmFsaWQgdW5pb24ga2V5ICcldiciLCB4LlR5cGUpCisJfQogCXhjLmFyY2hfYXJtLmdp
Y192ZXJzaW9uID0gQy5saWJ4bF9naWNfdmVyc2lvbih4LkFyY2hBcm0uR2ljVmVyc2lvbikKIAl4
Yy5hcmNoX2FybS52dWFydCA9IEMubGlieGxfdnVhcnRfdHlwZSh4LkFyY2hBcm0uVnVhcnQpCiAJ
eGMuYWx0cDJtID0gQy5saWJ4bF9hbHRwMm1fbW9kZSh4LkFsdHAyTSkKQEAgLTE0MTAsNiArMTYz
NSwyMiBAQCBmdW5jICh4ICpEZXZpY2VVc2JkZXYpIHRvQygpICh4YyBDLmxpYnhsX2RldmljZV91
c2JkZXYsIGVyciBlcnJvcikgewogCUMubGlieGxfZGV2aWNlX3VzYmRldl9pbml0KCZ4YykKIAl4
Yy5jdHJsID0gQy5saWJ4bF9kZXZpZCh4LkN0cmwpCiAJeGMucG9ydCA9IEMuaW50KHguUG9ydCkK
Kwl4Yy5fdHlwZSA9IEMubGlieGxfdXNiZGV2X3R5cGUoeC5UeXBlKQorCXN3aXRjaCB4LlR5cGUg
eworCWNhc2UgVXNiZGV2VHlwZUhvc3RkZXY6CisJCXRtcCwgb2sgOj0geC5UeXBlVW5pb24uKERl
dmljZVVzYmRldlR5cGVVbmlvbkhvc3RkZXYpCisJCWlmICFvayB7CisJCQlDLmxpYnhsX2Rldmlj
ZV91c2JkZXZfZGlzcG9zZSgmeGMpCisJCQlyZXR1cm4geGMsIGVycm9ycy5OZXcoIndyb25nIHR5
cGUgZm9yIHVuaW9uIGtleSB0eXBlIikKKwkJfQorCQl2YXIgaG9zdGRldiBDLmxpYnhsX2Rldmlj
ZV91c2JkZXZfdHlwZV91bmlvbl9ob3N0ZGV2CisJCWhvc3RkZXYuaG9zdGJ1cyA9IEMudWludDhf
dCh0bXAuSG9zdGJ1cykKKwkJaG9zdGRldi5ob3N0YWRkciA9IEMudWludDhfdCh0bXAuSG9zdGFk
ZHIpCisJCWhvc3RkZXZCeXRlcyA6PSBDLkdvQnl0ZXModW5zYWZlLlBvaW50ZXIoJmhvc3RkZXYp
LCBDLnNpemVvZl9saWJ4bF9kZXZpY2VfdXNiZGV2X3R5cGVfdW5pb25faG9zdGRldikKKwkJY29w
eSh4Yy51WzpdLCBob3N0ZGV2Qnl0ZXMpCisJZGVmYXVsdDoKKwkJcmV0dXJuIHhjLCBmbXQuRXJy
b3JmKCJpbnZhbGlkIHVuaW9uIGtleSAnJXYnIiwgeC5UeXBlKQorCX0KIAlyZXR1cm4geGMsIG5p
bAogfQogCkBAIC0xNTIzLDYgKzE3NjQsMjEgQEAgZnVuYyAoeCAqRGV2aWNlQ2hhbm5lbCkgdG9D
KCkgKHhjIEMubGlieGxfZGV2aWNlX2NoYW5uZWwsIGVyciBlcnJvcikgewogCXhjLmJhY2tlbmRf
ZG9tbmFtZSA9IEMuQ1N0cmluZyh4LkJhY2tlbmREb21uYW1lKQogCXhjLmRldmlkID0gQy5saWJ4
bF9kZXZpZCh4LkRldmlkKQogCXhjLm5hbWUgPSBDLkNTdHJpbmcoeC5OYW1lKQorCXhjLmNvbm5l
Y3Rpb24gPSBDLmxpYnhsX2NoYW5uZWxfY29ubmVjdGlvbih4LkNvbm5lY3Rpb24pCisJc3dpdGNo
IHguQ29ubmVjdGlvbiB7CisJY2FzZSBDaGFubmVsQ29ubmVjdGlvblNvY2tldDoKKwkJdG1wLCBv
ayA6PSB4LkNvbm5lY3Rpb25Vbmlvbi4oRGV2aWNlQ2hhbm5lbENvbm5lY3Rpb25VbmlvblNvY2tl
dCkKKwkJaWYgIW9rIHsKKwkJCUMubGlieGxfZGV2aWNlX2NoYW5uZWxfZGlzcG9zZSgmeGMpCisJ
CQlyZXR1cm4geGMsIGVycm9ycy5OZXcoIndyb25nIHR5cGUgZm9yIHVuaW9uIGtleSBjb25uZWN0
aW9uIikKKwkJfQorCQl2YXIgc29ja2V0IEMubGlieGxfZGV2aWNlX2NoYW5uZWxfY29ubmVjdGlv
bl91bmlvbl9zb2NrZXQKKwkJc29ja2V0LnBhdGggPSBDLkNTdHJpbmcodG1wLlBhdGgpCisJCXNv
Y2tldEJ5dGVzIDo9IEMuR29CeXRlcyh1bnNhZmUuUG9pbnRlcigmc29ja2V0KSwgQy5zaXplb2Zf
bGlieGxfZGV2aWNlX2NoYW5uZWxfY29ubmVjdGlvbl91bmlvbl9zb2NrZXQpCisJCWNvcHkoeGMu
dVs6XSwgc29ja2V0Qnl0ZXMpCisJZGVmYXVsdDoKKwkJcmV0dXJuIHhjLCBmbXQuRXJyb3JmKCJp
bnZhbGlkIHVuaW9uIGtleSAnJXYnIiwgeC5Db25uZWN0aW9uKQorCX0KIAlyZXR1cm4geGMsIG5p
bAogfQogCkBAIC0yNDMzLDYgKzI2ODksNDYgQEAgZnVuYyAoeCAqRXZlbnQpIHRvQygpICh4YyBD
LmxpYnhsX2V2ZW50LCBlcnIgZXJyb3IpIHsKIAkJcmV0dXJuIHhjLCBlcnIKIAl9CiAJeGMuZm9y
X3VzZXIgPSBDLnVpbnQ2NF90KHguRm9yVXNlcikKKwl4Yy5fdHlwZSA9IEMubGlieGxfZXZlbnRf
dHlwZSh4LlR5cGUpCisJc3dpdGNoIHguVHlwZSB7CisJY2FzZSBFdmVudFR5cGVEb21haW5TaHV0
ZG93bjoKKwkJdG1wLCBvayA6PSB4LlR5cGVVbmlvbi4oRXZlbnRUeXBlVW5pb25Eb21haW5TaHV0
ZG93bikKKwkJaWYgIW9rIHsKKwkJCUMubGlieGxfZXZlbnRfZGlzcG9zZSgmeGMpCisJCQlyZXR1
cm4geGMsIGVycm9ycy5OZXcoIndyb25nIHR5cGUgZm9yIHVuaW9uIGtleSB0eXBlIikKKwkJfQor
CQl2YXIgZG9tYWluX3NodXRkb3duIEMubGlieGxfZXZlbnRfdHlwZV91bmlvbl9kb21haW5fc2h1
dGRvd24KKwkJZG9tYWluX3NodXRkb3duLnNodXRkb3duX3JlYXNvbiA9IEMudWludDhfdCh0bXAu
U2h1dGRvd25SZWFzb24pCisJCWRvbWFpbl9zaHV0ZG93bkJ5dGVzIDo9IEMuR29CeXRlcyh1bnNh
ZmUuUG9pbnRlcigmZG9tYWluX3NodXRkb3duKSwgQy5zaXplb2ZfbGlieGxfZXZlbnRfdHlwZV91
bmlvbl9kb21haW5fc2h1dGRvd24pCisJCWNvcHkoeGMudVs6XSwgZG9tYWluX3NodXRkb3duQnl0
ZXMpCisJY2FzZSBFdmVudFR5cGVEaXNrRWplY3Q6CisJCXRtcCwgb2sgOj0geC5UeXBlVW5pb24u
KEV2ZW50VHlwZVVuaW9uRGlza0VqZWN0KQorCQlpZiAhb2sgeworCQkJQy5saWJ4bF9ldmVudF9k
aXNwb3NlKCZ4YykKKwkJCXJldHVybiB4YywgZXJyb3JzLk5ldygid3JvbmcgdHlwZSBmb3IgdW5p
b24ga2V5IHR5cGUiKQorCQl9CisJCXZhciBkaXNrX2VqZWN0IEMubGlieGxfZXZlbnRfdHlwZV91
bmlvbl9kaXNrX2VqZWN0CisJCWRpc2tfZWplY3QudmRldiA9IEMuQ1N0cmluZyh0bXAuVmRldikK
KwkJZGlza19lamVjdC5kaXNrLCBlcnIgPSB0bXAuRGlzay50b0MoKQorCQlpZiBlcnIgIT0gbmls
IHsKKwkJCUMubGlieGxfZXZlbnRfZGlzcG9zZSgmeGMpCisJCQlyZXR1cm4geGMsIGVycgorCQl9
CisJCWRpc2tfZWplY3RCeXRlcyA6PSBDLkdvQnl0ZXModW5zYWZlLlBvaW50ZXIoJmRpc2tfZWpl
Y3QpLCBDLnNpemVvZl9saWJ4bF9ldmVudF90eXBlX3VuaW9uX2Rpc2tfZWplY3QpCisJCWNvcHko
eGMudVs6XSwgZGlza19lamVjdEJ5dGVzKQorCWNhc2UgRXZlbnRUeXBlT3BlcmF0aW9uQ29tcGxl
dGU6CisJCXRtcCwgb2sgOj0geC5UeXBlVW5pb24uKEV2ZW50VHlwZVVuaW9uT3BlcmF0aW9uQ29t
cGxldGUpCisJCWlmICFvayB7CisJCQlDLmxpYnhsX2V2ZW50X2Rpc3Bvc2UoJnhjKQorCQkJcmV0
dXJuIHhjLCBlcnJvcnMuTmV3KCJ3cm9uZyB0eXBlIGZvciB1bmlvbiBrZXkgdHlwZSIpCisJCX0K
KwkJdmFyIG9wZXJhdGlvbl9jb21wbGV0ZSBDLmxpYnhsX2V2ZW50X3R5cGVfdW5pb25fb3BlcmF0
aW9uX2NvbXBsZXRlCisJCW9wZXJhdGlvbl9jb21wbGV0ZS5yYyA9IEMuaW50KHRtcC5SYykKKwkJ
b3BlcmF0aW9uX2NvbXBsZXRlQnl0ZXMgOj0gQy5Hb0J5dGVzKHVuc2FmZS5Qb2ludGVyKCZvcGVy
YXRpb25fY29tcGxldGUpLCBDLnNpemVvZl9saWJ4bF9ldmVudF90eXBlX3VuaW9uX29wZXJhdGlv
bl9jb21wbGV0ZSkKKwkJY29weSh4Yy51WzpdLCBvcGVyYXRpb25fY29tcGxldGVCeXRlcykKKwlk
ZWZhdWx0OgorCQlyZXR1cm4geGMsIGZtdC5FcnJvcmYoImludmFsaWQgdW5pb24ga2V5ICcldici
LCB4LlR5cGUpCisJfQogCXJldHVybiB4YywgbmlsCiB9CiAKQEAgLTI1MDQsNSArMjgwMCwzNCBA
QCBmdW5jICh4ICpQc3JId0luZm9UeXBlVW5pb25NYmEpIGZyb21DKHhjICpDLmxpYnhsX3Bzcl9o
d19pbmZvKSBlcnJvciB7CiBmdW5jICh4ICpQc3JId0luZm8pIHRvQygpICh4YyBDLmxpYnhsX3Bz
cl9od19pbmZvLCBlcnIgZXJyb3IpIHsKIAlDLmxpYnhsX3Bzcl9od19pbmZvX2luaXQoJnhjKQog
CXhjLmlkID0gQy51aW50MzJfdCh4LklkKQorCXhjLl90eXBlID0gQy5saWJ4bF9wc3JfZmVhdF90
eXBlKHguVHlwZSkKKwlzd2l0Y2ggeC5UeXBlIHsKKwljYXNlIFBzckZlYXRUeXBlQ2F0OgorCQl0
bXAsIG9rIDo9IHguVHlwZVVuaW9uLihQc3JId0luZm9UeXBlVW5pb25DYXQpCisJCWlmICFvayB7
CisJCQlDLmxpYnhsX3Bzcl9od19pbmZvX2Rpc3Bvc2UoJnhjKQorCQkJcmV0dXJuIHhjLCBlcnJv
cnMuTmV3KCJ3cm9uZyB0eXBlIGZvciB1bmlvbiBrZXkgdHlwZSIpCisJCX0KKwkJdmFyIGNhdCBD
LmxpYnhsX3Bzcl9od19pbmZvX3R5cGVfdW5pb25fY2F0CisJCWNhdC5jb3NfbWF4ID0gQy51aW50
MzJfdCh0bXAuQ29zTWF4KQorCQljYXQuY2JtX2xlbiA9IEMudWludDMyX3QodG1wLkNibUxlbikK
KwkJY2F0LmNkcF9lbmFibGVkID0gQy5ib29sKHRtcC5DZHBFbmFibGVkKQorCQljYXRCeXRlcyA6
PSBDLkdvQnl0ZXModW5zYWZlLlBvaW50ZXIoJmNhdCksIEMuc2l6ZW9mX2xpYnhsX3Bzcl9od19p
bmZvX3R5cGVfdW5pb25fY2F0KQorCQljb3B5KHhjLnVbOl0sIGNhdEJ5dGVzKQorCWNhc2UgUHNy
RmVhdFR5cGVNYmE6CisJCXRtcCwgb2sgOj0geC5UeXBlVW5pb24uKFBzckh3SW5mb1R5cGVVbmlv
bk1iYSkKKwkJaWYgIW9rIHsKKwkJCUMubGlieGxfcHNyX2h3X2luZm9fZGlzcG9zZSgmeGMpCisJ
CQlyZXR1cm4geGMsIGVycm9ycy5OZXcoIndyb25nIHR5cGUgZm9yIHVuaW9uIGtleSB0eXBlIikK
KwkJfQorCQl2YXIgbWJhIEMubGlieGxfcHNyX2h3X2luZm9fdHlwZV91bmlvbl9tYmEKKwkJbWJh
LmNvc19tYXggPSBDLnVpbnQzMl90KHRtcC5Db3NNYXgpCisJCW1iYS50aHJ0bF9tYXggPSBDLnVp
bnQzMl90KHRtcC5UaHJ0bE1heCkKKwkJbWJhLmxpbmVhciA9IEMuYm9vbCh0bXAuTGluZWFyKQor
CQltYmFCeXRlcyA6PSBDLkdvQnl0ZXModW5zYWZlLlBvaW50ZXIoJm1iYSksIEMuc2l6ZW9mX2xp
YnhsX3Bzcl9od19pbmZvX3R5cGVfdW5pb25fbWJhKQorCQljb3B5KHhjLnVbOl0sIG1iYUJ5dGVz
KQorCWRlZmF1bHQ6CisJCXJldHVybiB4YywgZm10LkVycm9yZigiaW52YWxpZCB1bmlvbiBrZXkg
JyV2JyIsIHguVHlwZSkKKwl9CiAJcmV0dXJuIHhjLCBuaWwKIH0KLS0gCjIuMTcuMQoKCl9fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWls
aW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVu
cHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

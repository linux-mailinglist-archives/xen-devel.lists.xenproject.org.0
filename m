Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id D778FB2611
	for <lists+xen-devel@lfdr.de>; Fri, 13 Sep 2019 21:30:38 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i8rF0-0006s4-Es; Fri, 13 Sep 2019 19:28:22 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=bj/4=XI=citrix.com=andrew.cooper3@srs-us1.protection.inumbo.net>)
 id 1i8rEz-0006rZ-5i
 for xen-devel@lists.xenproject.org; Fri, 13 Sep 2019 19:28:21 +0000
X-Inumbo-ID: 9daa6548-d65c-11e9-95b9-12813bfff9fa
Received: from esa2.hc3370-68.iphmx.com (unknown [216.71.145.153])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 9daa6548-d65c-11e9-95b9-12813bfff9fa;
 Fri, 13 Sep 2019 19:28:08 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1568402889;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=HPF2LqOFEVPBHPCbJpDnIFpAC0MfHtcMA3F3skg4t6U=;
 b=bNRNC1G3gDmGzzBZik3z+bWGy7ZghUl0KV4kbG5KBTjKvttKEemjXNnQ
 X9LNT7kyUB5TYuKdGVvqM/nbH+9gKOSk1oueqg+YzfVfJELNXEnN5qQu2
 l9ARMkG0nhUGZH2SWGikW+JcsApS/CffEQIalsagkFkWk3QXD08bKvVs/ U=;
Authentication-Results: esa2.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=andrew.cooper3@citrix.com;
 spf=Pass smtp.mailfrom=Andrew.Cooper3@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa2.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 andrew.cooper3@citrix.com) identity=pra;
 client-ip=162.221.158.21; receiver=esa2.hc3370-68.iphmx.com;
 envelope-from="Andrew.Cooper3@citrix.com";
 x-sender="andrew.cooper3@citrix.com";
 x-conformance=sidf_compatible
Received-SPF: Pass (esa2.hc3370-68.iphmx.com: domain of
 Andrew.Cooper3@citrix.com designates 162.221.158.21 as
 permitted sender) identity=mailfrom;
 client-ip=162.221.158.21; receiver=esa2.hc3370-68.iphmx.com;
 envelope-from="Andrew.Cooper3@citrix.com";
 x-sender="Andrew.Cooper3@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83 ~all"
Received-SPF: None (esa2.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa2.hc3370-68.iphmx.com;
 envelope-from="Andrew.Cooper3@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: 3WF5f3IlZDLHGpkjaR7RMetW4HrMeXAnygIYs2ngfocPAsSOIS3Goj7Epnr7V1jlJYcZPBDCDB
 Hw/wzb87qzVILfynjnjRJQaV3UmqsaICQD0awVJ/4EsukRd4tgnWqBV+uVC/WKMtnq+YHFes4R
 legQUtK/iLBJzFLCoAe1zw+ZuX4Sqmx0U3X/x8cGZkoXedSzS/3ndKn5RtL6RNsT8fKxa2Gz3l
 Z3HH88t6gaAxkYnJsr9dqMNQtI4H2P6S/nLsVy/jcxB1p1goFmFNnZmeZD4amCwUMful6OP4cQ
 hPk=
X-SBRS: 2.7
X-MesageID: 5553062
X-Ironport-Server: esa2.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.64,501,1559534400"; 
   d="scan'208";a="5553062"
From: Andrew Cooper <andrew.cooper3@citrix.com>
To: Xen-devel <xen-devel@lists.xenproject.org>
Date: Fri, 13 Sep 2019 20:27:57 +0100
Message-ID: <20190913192759.10795-9-andrew.cooper3@citrix.com>
X-Mailer: git-send-email 2.11.0
In-Reply-To: <20190913192759.10795-1-andrew.cooper3@citrix.com>
References: <20190913192759.10795-1-andrew.cooper3@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v2 08/10] tools/libxc: Rework
 xc_cpuid_apply_policy() to use {get, set}_cpu_policy()
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <Ian.Jackson@citrix.com>, Wei Liu <wl@xen.org>,
 Jan Beulich <JBeulich@suse.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhlIHB1cnBvc2Ugb2YgdGhpcyBjaGFuZ2UgaXMgdG8gc3RvcCB1c2luZyB4Y19jcHVpZF9kb19k
b21jdGwoKSwgYW5kIHRvIHN0b3AKYmFzaW5nIGRlY2lzaW9ucyBvbiBhIGxvY2FsIENQVUlEIGlu
c3RydWN0aW9uLiAgVGhpcyBpcyBub3QgYSBjb3JyZWN0IG9yCmFwcHJvcHJpYXRlIHdheSB0byBj
b25zdHJ1Y3QgcG9saWN5IGluZm9ybWF0aW9uIGZvciBvdGhlciBkb21haW5zLgoKVGhlIG92ZXJ3
aGVsbWluZyBtYWpvcml0eSBvZiB0aGlzIGxvZ2ljIGlzIHJlZHVuZGFudCB3aXRoIHRoZSBwb2xp
Y3kgbG9naWMgaW4KWGVuLCBidXQgaGFzIGEgaGFiaXQgb2YgYmVjb21pbmcgc3RhbGUgKGUuZy4g
Yy9zIDk3ZTRlYmRjZDc2IHJlc3VsdGluZyBpbiB0aGUKQ1BVSUQuN1sxXS5lYXggbm90IGJlaW5n
IG9mZmVyZWQgdG8gZ3Vlc3RzIGV2ZW4gd2hlbiBYZW4gaXMgaGFwcHkgd2l0aCB0aGUKY29udGVu
dCkuCgpUaGVyZSBhcmUgYSBmZXcgc3VidGxlIHNpZGUgZWZmZWN0cyB3aGljaCBuZWVkIHRvIHJl
bWFpbiBpbiBwbGFjZS4gIEEKc3VjY2Vzc2Z1bCBjYWxsIHRvIHhjX2NwdWlkX2FwcGx5X3BvbGlj
eSgpIG11c3QgcmVzdWx0IGluIGEgY2FsbCB0bwp4Y19zZXRfZG9tYWluX2NwdV9wb2xpY3koKSBi
ZWNhdXNlIHRoYXQgaXMgY3VycmVudGx5IHRoZSBvbmx5IHdheSB0aGUKSVRTQy9WTVgvU1ZNIGJp
dHMgYmVjb21lIHJlZmxlY3RlZCBpbiB0aGUgZ3Vlc3RzIENQVUlEIHZpZXcuICBGdXR1cmUgY2xl
YW51cAp3aWxsIHJlbW92ZSB0aGlzIHNpZGUgZWZmZWN0LgoKVGhlIHRvcG9sb2d5IHR3ZWFrcyBh
cmUgbG9jYWwgdG8gbGlieGMuICBFeHRlbmQgc3RydWN0IGNwdWlkX3BvbGljeSB3aXRoCmVub3Vn
aCBuYW1lZCBmaWVsZHMgdG8gZXhwcmVzcyB0aGUgbG9naWMsIGJ1dCBrZWVwIGl0IGlkZW50aWNh
bCB0byBiZWZvcmUuCkZpeGluZyB0b3BvbG9neSByZXByZXNlbnRhdGlvbiBpcyBhbm90aGVyIGZ1
dHVyZSBhcmVhIG9mIHdvcmsuCgpObyAoZXhwZWN0ZWQpIGNoYW5nZSBpbiBiZWhhdmlvdXIuCgpT
aWduZWQtb2ZmLWJ5OiBBbmRyZXcgQ29vcGVyIDxhbmRyZXcuY29vcGVyM0BjaXRyaXguY29tPgot
LS0KQ0M6IEphbiBCZXVsaWNoIDxKQmV1bGljaEBzdXNlLmNvbT4KQ0M6IFdlaSBMaXUgPHdsQHhl
bi5vcmc+CkNDOiBSb2dlciBQYXUgTW9ubsOpIDxyb2dlci5wYXVAY2l0cml4LmNvbT4KQ0M6IElh
biBKYWNrc29uIDxJYW4uSmFja3NvbkBjaXRyaXguY29tPgoKVGhlIHJlcG9zaXRpb25pbmcgb2Yg
eGNfY3B1aWRfYXBwbHlfcG9saWN5KCkgcmVsYXRpdmUgdG8geGNfY3B1aWRfc2V0KCkgaXMKc2lt
cGx5IHRvIG1ha2UgdGhlIGRpZmYgcmVhZGFibGUuICBJdCBpcyBjb21wbGV0ZWx5IGlsbGVnaWJs
ZSBvdGhlcndpc2UuCgp2MjoKICogUmV3b3JkIHRoZSBjb21taXQgbWVzc2FnZSB0byBkcm9wIEFW
WDUxMl9CRjE2CiAqIEluaXRpYWxpc2UgaG9zdF9mZWF0dXJlc2V0W10ganVzdCBpbiBjYXNlLgot
LS0KIHRvb2xzL2xpYnhjL3hjX2NwdWlkX3g4Ni5jICAgICAgfCA3OTggKysrKysrKysrKy0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogeGVuL2luY2x1ZGUveGVuL2xpYi94ODYvY3B1aWQu
aCB8ICAxMSArLQogMiBmaWxlcyBjaGFuZ2VkLCAxOTcgaW5zZXJ0aW9ucygrKSwgNjEyIGRlbGV0
aW9ucygtKQoKZGlmZiAtLWdpdCBhL3Rvb2xzL2xpYnhjL3hjX2NwdWlkX3g4Ni5jIGIvdG9vbHMv
bGlieGMveGNfY3B1aWRfeDg2LmMKaW5kZXggNzdmOTZhNGVhNi4uOGU5M2E2MDk3OCAxMDA2NDQK
LS0tIGEvdG9vbHMvbGlieGMveGNfY3B1aWRfeDg2LmMKKysrIGIvdG9vbHMvbGlieGMveGNfY3B1
aWRfeDg2LmMKQEAgLTM0LDE4ICszNCwxMyBAQCBlbnVtIHsKIAogI2luY2x1ZGUgPHhlbi9hc20v
eDg2LXZlbmRvcnMuaD4KIAotI2luY2x1ZGUgPHhlbi9saWIveDg2L2NwdWlkLmg+Ci0jaW5jbHVk
ZSA8eGVuL2xpYi94ODYvbXNyLmg+CisjaW5jbHVkZSA8eGVuL2xpYi94ODYvY3B1LXBvbGljeS5o
PgogCiAjZGVmaW5lIGJpdG1hc2tvZihpZHgpICAgICAgKDF1IDw8ICgoaWR4KSAmIDMxKSkKICNk
ZWZpbmUgZmVhdHVyZXdvcmRfb2YoaWR4KSAoKGlkeCkgPj4gNSkKICNkZWZpbmUgY2xlYXJfZmVh
dHVyZShpZHgsIGRzdCkgKChkc3QpICY9IH5iaXRtYXNrb2YoaWR4KSkKICNkZWZpbmUgc2V0X2Zl
YXR1cmUoaWR4LCBkc3QpICAgKChkc3QpIHw9ICBiaXRtYXNrb2YoaWR4KSkKIAotI2RlZmluZSBE
RUZfTUFYX0JBU0UgMHgwMDAwMDAwZHUKLSNkZWZpbmUgREVGX01BWF9JTlRFTEVYVCAgMHg4MDAw
MDAwOHUKLSNkZWZpbmUgREVGX01BWF9BTURFWFQgICAgMHg4MDAwMDAxY3UKLQogaW50IHhjX2dl
dF9jcHVfbGV2ZWxsaW5nX2NhcHMoeGNfaW50ZXJmYWNlICp4Y2gsIHVpbnQzMl90ICpjYXBzKQog
ewogICAgIERFQ0xBUkVfU1lTQ1RMOwpAQCAtMjc1LDYwOSArMjcwLDYgQEAgaW50IHhjX3NldF9k
b21haW5fY3B1X3BvbGljeSh4Y19pbnRlcmZhY2UgKnhjaCwgdWludDMyX3QgZG9taWQsCiAgICAg
cmV0dXJuIHJldDsKIH0KIAotc3RydWN0IGNwdWlkX2RvbWFpbl9pbmZvCi17Ci0gICAgdW5zaWdu
ZWQgaW50IHZlbmRvcjsgLyogWDg2X1ZFTkRPUl8qICovCi0KLSAgICBib29sIGh2bTsKLSAgICB1
aW50NjRfdCB4ZmVhdHVyZV9tYXNrOwotCi0gICAgLyoKLSAgICAgKiBDYXJlZnVsIHdpdGggZmVh
dHVyZXNldCBsZW5ndGhzLgotICAgICAqCi0gICAgICogQ29kZSBpbiB0aGlzIGZpbGUgcmVxdWly
ZXMgZmVhdHVyZXNldCB0byBoYXZlIGF0IGxlYXN0Ci0gICAgICogeGNfZ2V0X2NwdV9mZWF0dXJl
c2V0X3NpemUoKSBlbnRyaWVzLiAgVGhpcyBpcyBhIGxpYnhjIGNvbXBpbGV0aW1lCi0gICAgICog
Y29uc3RhbnQuCi0gICAgICoKLSAgICAgKiBUaGUgZmVhdHVyZXNldCBsZW5ndGggdXNlZCBieSB0
aGUgaHlwZXJ2aXNvciBtYXkgYmUgZGlmZmVyZW50LiAgSWYgdGhlCi0gICAgICogaHlwZXJ2aXNv
ciB2ZXJzaW9uIGlzIGxvbmdlciwgWEVOX1NZU0NUTF9nZXRfY3B1X2ZlYXR1cmVzZXQgd2lsbCBm
YWlsCi0gICAgICogd2l0aCAtRU5PQlVGUywgYW5kIGxpYnhjIHJlYWxseSBkb2VzIG5lZWQgcmVi
dWlsZGluZy4gIElmIHRoZQotICAgICAqIGh5cGVydmlzb3IgdmVyc2lvbiBpcyBzaG9ydGVyLCBp
dCBpcyBzYWZlIHRvIHplcm8tZXh0ZW5kLgotICAgICAqLwotICAgIHVpbnQzMl90ICpmZWF0dXJl
c2V0OwotICAgIHVuc2lnbmVkIGludCBucl9mZWF0dXJlczsKLQotICAgIC8qIFBWLW9ubHkgaW5m
b3JtYXRpb24uICovCi0gICAgYm9vbCBwdjY0OwotCi0gICAgLyogSFZNLW9ubHkgaW5mb3JtYXRp
b24uICovCi0gICAgYm9vbCBwYWU7Ci0gICAgYm9vbCBuZXN0ZWRodm07Ci19OwotCi1zdGF0aWMg
dm9pZCBjcHVpZChjb25zdCB1bnNpZ25lZCBpbnQgKmlucHV0LCB1bnNpZ25lZCBpbnQgKnJlZ3Mp
Ci17Ci0gICAgdW5zaWduZWQgaW50IGNvdW50ID0gKGlucHV0WzFdID09IFhFTl9DUFVJRF9JTlBV
VF9VTlVTRUQpID8gMCA6IGlucHV0WzFdOwotI2lmZGVmIF9faTM4Nl9fCi0gICAgLyogVXNlIHRo
ZSBzdGFjayB0byBhdm9pZCByZWcgY29uc3RyYWludCBmYWlsdXJlcyB3aXRoIHNvbWUgZ2NjIGZs
YWdzICovCi0gICAgYXNtICgKLSAgICAgICAgInB1c2ggJSVlYng7IHB1c2ggJSVlZHhcblx0Igot
ICAgICAgICAiY3B1aWRcblx0IgotICAgICAgICAibW92ICUlZWJ4LDQoJTQpXG5cdCIKLSAgICAg
ICAgIm1vdiAlJWVkeCwxMiglNClcblx0IgotICAgICAgICAicG9wICUlZWR4OyBwb3AgJSVlYnhc
blx0IgotICAgICAgICA6ICI9YSIgKHJlZ3NbMF0pLCAiPWMiIChyZWdzWzJdKQotICAgICAgICA6
ICIwIiAoaW5wdXRbMF0pLCAiMSIgKGNvdW50KSwgIlMiIChyZWdzKQotICAgICAgICA6ICJtZW1v
cnkiICk7Ci0jZWxzZQotICAgIGFzbSAoCi0gICAgICAgICJjcHVpZCIKLSAgICAgICAgOiAiPWEi
IChyZWdzWzBdKSwgIj1iIiAocmVnc1sxXSksICI9YyIgKHJlZ3NbMl0pLCAiPWQiIChyZWdzWzNd
KQotICAgICAgICA6ICIwIiAoaW5wdXRbMF0pLCAiMiIgKGNvdW50KSApOwotI2VuZGlmCi19Ci0K
LXN0YXRpYyBpbnQgZ2V0X2NwdWlkX2RvbWFpbl9pbmZvKHhjX2ludGVyZmFjZSAqeGNoLCB1aW50
MzJfdCBkb21pZCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBjcHVp
ZF9kb21haW5faW5mbyAqaW5mbywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNv
bnN0IHVpbnQzMl90ICpmZWF0dXJlc2V0LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgdW5zaWduZWQgaW50IG5yX2ZlYXR1cmVzKQotewotICAgIHN0cnVjdCB4ZW5fZG9tY3RsIGRv
bWN0bCA9IHt9OwotICAgIHhjX2RvbWluZm9fdCBkaTsKLSAgICB1bnNpZ25lZCBpbnQgaW5bMl0g
PSB7IDAsIH4wVSB9LCByZWdzWzRdOwotICAgIHVuc2lnbmVkIGludCBpLCBob3N0X25yX2ZlYXR1
cmVzID0geGNfZ2V0X2NwdV9mZWF0dXJlc2V0X3NpemUoKTsKLSAgICBpbnQgcmM7Ci0KLSAgICBj
cHVpZChpbiwgcmVncyk7Ci0gICAgaW5mby0+dmVuZG9yID0geDg2X2NwdWlkX2xvb2t1cF92ZW5k
b3IocmVnc1sxXSwgcmVnc1syXSwgcmVnc1szXSk7Ci0KLSAgICBpZiAoIHhjX2RvbWFpbl9nZXRp
bmZvKHhjaCwgZG9taWQsIDEsICZkaSkgIT0gMSB8fAotICAgICAgICAgZGkuZG9taWQgIT0gZG9t
aWQgKQotICAgICAgICByZXR1cm4gLUVTUkNIOwotCi0gICAgaW5mby0+aHZtID0gZGkuaHZtOwot
Ci0gICAgaW5mby0+ZmVhdHVyZXNldCA9IGNhbGxvYyhob3N0X25yX2ZlYXR1cmVzLCBzaXplb2Yo
KmluZm8tPmZlYXR1cmVzZXQpKTsKLSAgICBpZiAoICFpbmZvLT5mZWF0dXJlc2V0ICkKLSAgICAg
ICAgcmV0dXJuIC1FTk9NRU07Ci0KLSAgICBpbmZvLT5ucl9mZWF0dXJlcyA9IGhvc3RfbnJfZmVh
dHVyZXM7Ci0KLSAgICBpZiAoIGZlYXR1cmVzZXQgKQotICAgIHsKLSAgICAgICAgLyoKLSAgICAg
ICAgICogVGhlIHVzZXIgc3VwcGxpZWQgZmVhdHVyZXNldCBtYXkgYmUgc2hvcnRlciBvciBsb25n
ZXIgdGhhbgotICAgICAgICAgKiBob3N0X25yX2ZlYXR1cmVzLiAgU2hvcnRlciBpcyBmaW5lLCBh
bmQgd2Ugd2lsbCB6ZXJvLWV4dGVuZC4KLSAgICAgICAgICogTG9uZ2VyIGlzIGZpbmUsIHNvIGxv
bmcgYXMgaXQgb25seSBwYWRkZWQgd2l0aCB6ZXJvcy4KLSAgICAgICAgICovCi0gICAgICAgIHVu
c2lnbmVkIGludCBmc2xlbiA9IG1pbihob3N0X25yX2ZlYXR1cmVzLCBucl9mZWF0dXJlcyk7Ci0K
LSAgICAgICAgbWVtY3B5KGluZm8tPmZlYXR1cmVzZXQsIGZlYXR1cmVzZXQsCi0gICAgICAgICAg
ICAgICBmc2xlbiAqIHNpemVvZigqaW5mby0+ZmVhdHVyZXNldCkpOwotCi0gICAgICAgIC8qIENo
ZWNrIGZvciB0cnVuY2F0ZWQgc2V0IGJpdHMuICovCi0gICAgICAgIGZvciAoIGkgPSBmc2xlbjsg
aSA8IG5yX2ZlYXR1cmVzOyArK2kgKQotICAgICAgICAgICAgaWYgKCBmZWF0dXJlc2V0W2ldICE9
IDAgKQotICAgICAgICAgICAgICAgIHJldHVybiAtRU9QTk9UU1VQUDsKLSAgICB9Ci0gICAgZWxz
ZQotICAgIHsKLSAgICAgICAgcmMgPSB4Y19nZXRfY3B1X2ZlYXR1cmVzZXQoeGNoLCAoaW5mby0+
aHZtCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gWEVOX1NZU0NU
TF9jcHVfZmVhdHVyZXNldF9odm0KLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgOiBYRU5fU1lTQ1RMX2NwdV9mZWF0dXJlc2V0X3B2KSwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgJmhvc3RfbnJfZmVhdHVyZXMsIGluZm8tPmZlYXR1cmVzZXQpOwot
ICAgICAgICBpZiAoIHJjICkKLSAgICAgICAgICAgIHJldHVybiAtZXJybm87Ci0gICAgfQotCi0g
ICAgLyogR2V0IHhzdGF0ZSBpbmZvcm1hdGlvbi4gKi8KLSAgICBkb21jdGwuY21kID0gWEVOX0RP
TUNUTF9nZXR2Y3B1ZXh0c3RhdGU7Ci0gICAgZG9tY3RsLmRvbWFpbiA9IGRvbWlkOwotICAgIHJj
ID0gZG9fZG9tY3RsKHhjaCwgJmRvbWN0bCk7Ci0gICAgaWYgKCByYyApCi0gICAgICAgIHJldHVy
biAtZXJybm87Ci0KLSAgICBpbmZvLT54ZmVhdHVyZV9tYXNrID0gZG9tY3RsLnUudmNwdWV4dHN0
YXRlLnhmZWF0dXJlX21hc2s7Ci0KLSAgICBpZiAoIGRpLmh2bSApCi0gICAgewotICAgICAgICB1
aW50NjRfdCB2YWw7Ci0KLSAgICAgICAgcmMgPSB4Y19odm1fcGFyYW1fZ2V0KHhjaCwgZG9taWQs
IEhWTV9QQVJBTV9QQUVfRU5BQkxFRCwgJnZhbCk7Ci0gICAgICAgIGlmICggcmMgKQotICAgICAg
ICAgICAgcmV0dXJuIC1lcnJubzsKLQotICAgICAgICBpbmZvLT5wYWUgPSAhIXZhbDsKLQotICAg
ICAgICByYyA9IHhjX2h2bV9wYXJhbV9nZXQoeGNoLCBkb21pZCwgSFZNX1BBUkFNX05FU1RFREhW
TSwgJnZhbCk7Ci0gICAgICAgIGlmICggcmMgKQotICAgICAgICAgICAgcmV0dXJuIC1lcnJubzsK
LQotICAgICAgICBpbmZvLT5uZXN0ZWRodm0gPSAhIXZhbDsKLSAgICB9Ci0gICAgZWxzZQotICAg
IHsKLSAgICAgICAgdW5zaWduZWQgaW50IHdpZHRoOwotCi0gICAgICAgIHJjID0geGNfZG9tYWlu
X2dldF9ndWVzdF93aWR0aCh4Y2gsIGRvbWlkLCAmd2lkdGgpOwotICAgICAgICBpZiAoIHJjICkK
LSAgICAgICAgICAgIHJldHVybiAtZXJybm87Ci0KLSAgICAgICAgaW5mby0+cHY2NCA9ICh3aWR0
aCA9PSA4KTsKLSAgICB9Ci0KLSAgICByZXR1cm4gMDsKLX0KLQotc3RhdGljIHZvaWQgZnJlZV9j
cHVpZF9kb21haW5faW5mbyhzdHJ1Y3QgY3B1aWRfZG9tYWluX2luZm8gKmluZm8pCi17Ci0gICAg
ZnJlZShpbmZvLT5mZWF0dXJlc2V0KTsKLX0KLQotc3RhdGljIHZvaWQgYW1kX3hjX2NwdWlkX3Bv
bGljeShjb25zdCBzdHJ1Y3QgY3B1aWRfZG9tYWluX2luZm8gKmluZm8sCi0gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGNvbnN0IHVuc2lnbmVkIGludCAqaW5wdXQsIHVuc2lnbmVkIGlu
dCAqcmVncykKLXsKLSAgICBzd2l0Y2ggKCBpbnB1dFswXSApCi0gICAgewotICAgIGNhc2UgMHgw
MDAwMDAwMjoKLSAgICBjYXNlIDB4MDAwMDAwMDQ6Ci0gICAgICAgIHJlZ3NbMF0gPSByZWdzWzFd
ID0gcmVnc1syXSA9IDA7Ci0gICAgICAgIGJyZWFrOwotCi0gICAgY2FzZSAweDgwMDAwMDAwOgot
ICAgICAgICBpZiAoIHJlZ3NbMF0gPiBERUZfTUFYX0FNREVYVCApCi0gICAgICAgICAgICByZWdz
WzBdID0gREVGX01BWF9BTURFWFQ7Ci0gICAgICAgIGJyZWFrOwotCi0gICAgY2FzZSAweDgwMDAw
MDA4OgotICAgICAgICAvKgotICAgICAgICAgKiBFQ1hbMTU6MTJdIGlzIEFwaWNJZENvcmVTaXpl
OiBFQ1hbNzowXSBpcyBOdW1iZXJPZkNvcmVzIChtaW51cyBvbmUpLgotICAgICAgICAgKiBVcGRh
dGUgdG8gcmVmbGVjdCB2TEFQSUNfSUQgPSB2Q1BVX0lEICogMi4KLSAgICAgICAgICovCi0gICAg
ICAgIHJlZ3NbMl0gPSAoKHJlZ3NbMl0gKyAoMXUgPDwgMTIpKSAmIDB4ZjAwMHUpIHwKLSAgICAg
ICAgICAgICAgICAgICgocmVnc1syXSAmIDB4ZmZ1KSA8PCAxKSB8IDF1OwotICAgICAgICBicmVh
azsKLQotICAgIGNhc2UgMHg4MDAwMDAwYTogewotICAgICAgICBpZiAoICFpbmZvLT5uZXN0ZWRo
dm0gKQotICAgICAgICB7Ci0gICAgICAgICAgICByZWdzWzBdID0gcmVnc1sxXSA9IHJlZ3NbMl0g
PSByZWdzWzNdID0gMDsKLSAgICAgICAgICAgIGJyZWFrOwotICAgICAgICB9Ci0KLSNkZWZpbmUg
U1ZNX0ZFQVRVUkVfTlBUICAgICAgICAgICAgMHgwMDAwMDAwMSAvKiBOZXN0ZWQgcGFnZSB0YWJs
ZSBzdXBwb3J0ICovCi0jZGVmaW5lIFNWTV9GRUFUVVJFX0xCUlYgICAgICAgICAgIDB4MDAwMDAw
MDIgLyogTEJSIHZpcnR1YWxpemF0aW9uIHN1cHBvcnQgKi8KLSNkZWZpbmUgU1ZNX0ZFQVRVUkVf
U1ZNTCAgICAgICAgICAgMHgwMDAwMDAwNCAvKiBTVk0gbG9ja2luZyBNU1Igc3VwcG9ydCAqLwot
I2RlZmluZSBTVk1fRkVBVFVSRV9OUklQUyAgICAgICAgICAweDAwMDAwMDA4IC8qIE5leHQgUklQ
IHNhdmUgb24gVk1FWElUICovCi0jZGVmaW5lIFNWTV9GRUFUVVJFX1RTQ1JBVEVNU1IgICAgIDB4
MDAwMDAwMTAgLyogVFNDIHJhdGlvIE1TUiBzdXBwb3J0ICovCi0jZGVmaW5lIFNWTV9GRUFUVVJF
X1ZNQ0JDTEVBTiAgICAgIDB4MDAwMDAwMjAgLyogVk1DQiBjbGVhbiBiaXRzIHN1cHBvcnQgKi8K
LSNkZWZpbmUgU1ZNX0ZFQVRVUkVfRkxVU0hCWUFTSUQgICAgMHgwMDAwMDA0MCAvKiBUTEIgZmx1
c2ggYnkgQVNJRCBzdXBwb3J0ICovCi0jZGVmaW5lIFNWTV9GRUFUVVJFX0RFQ09ERUFTU0lTVFMg
IDB4MDAwMDAwODAgLyogRGVjb2RlIGFzc2lzdHMgc3VwcG9ydCAqLwotI2RlZmluZSBTVk1fRkVB
VFVSRV9QQVVTRUZJTFRFUiAgICAweDAwMDAwNDAwIC8qIFBhdXNlIGludGVyY2VwdCBmaWx0ZXIg
Ki8KLQotICAgICAgICAvKiBQYXNzIDE6IE9ubHkgcGFzc3Rocm91Z2ggU1ZNIGZlYXR1cmVzIHdo
aWNoIGFyZQotICAgICAgICAgKiBhdmFpbGFibGUgaW4gaHcgYW5kIHdoaWNoIGFyZSBpbXBsZW1l
bnRlZAotICAgICAgICAgKi8KLSAgICAgICAgcmVnc1szXSAmPSAoU1ZNX0ZFQVRVUkVfTlBUIHwg
U1ZNX0ZFQVRVUkVfTEJSViB8IFwKLSAgICAgICAgICAgIFNWTV9GRUFUVVJFX05SSVBTIHwgU1ZN
X0ZFQVRVUkVfUEFVU0VGSUxURVIgfCBcCi0gICAgICAgICAgICBTVk1fRkVBVFVSRV9ERUNPREVB
U1NJU1RTKTsKLQotICAgICAgICAvKiBQYXNzIDI6IEFsd2F5cyBlbmFibGUgU1ZNIGZlYXR1cmVz
IHdoaWNoIGFyZSBlbXVsYXRlZCAqLwotICAgICAgICByZWdzWzNdIHw9IFNWTV9GRUFUVVJFX1ZN
Q0JDTEVBTiB8IFNWTV9GRUFUVVJFX1RTQ1JBVEVNU1I7Ci0gICAgICAgIGJyZWFrOwotICAgIH0K
LQotICAgIH0KLX0KLQotc3RhdGljIHZvaWQgaW50ZWxfeGNfY3B1aWRfcG9saWN5KGNvbnN0IHN0
cnVjdCBjcHVpZF9kb21haW5faW5mbyAqaW5mbywKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBjb25zdCB1bnNpZ25lZCBpbnQgKmlucHV0LCB1bnNpZ25lZCBpbnQgKnJlZ3MpCi17
Ci0gICAgc3dpdGNoICggaW5wdXRbMF0gKQotICAgIHsKLSAgICBjYXNlIDB4MDAwMDAwMDQ6Ci0g
ICAgICAgIC8qCi0gICAgICAgICAqIEVBWFszMToyNl0gaXMgTWF4aW11bSBDb3JlcyBQZXIgUGFj
a2FnZSAobWludXMgb25lKS4KLSAgICAgICAgICogVXBkYXRlIHRvIHJlZmxlY3QgdkxBUElDX0lE
ID0gdkNQVV9JRCAqIDIuCi0gICAgICAgICAqLwotICAgICAgICByZWdzWzBdID0gKCgocmVnc1sw
XSAmIDB4N2MwMDAwMDB1KSA8PCAxKSB8IDB4MDQwMDAwMDB1IHwKLSAgICAgICAgICAgICAgICAg
ICAocmVnc1swXSAmIDB4M2ZmdSkpOwotICAgICAgICByZWdzWzNdICY9IDB4M2ZmdTsKLSAgICAg
ICAgYnJlYWs7Ci0KLSAgICBjYXNlIDB4ODAwMDAwMDA6Ci0gICAgICAgIGlmICggcmVnc1swXSA+
IERFRl9NQVhfSU5URUxFWFQgKQotICAgICAgICAgICAgcmVnc1swXSA9IERFRl9NQVhfSU5URUxF
WFQ7Ci0gICAgICAgIGJyZWFrOwotCi0gICAgY2FzZSAweDgwMDAwMDA1OgotICAgICAgICByZWdz
WzBdID0gcmVnc1sxXSA9IHJlZ3NbMl0gPSAwOwotICAgICAgICBicmVhazsKLQotICAgIGNhc2Ug
MHg4MDAwMDAwODoKLSAgICAgICAgLyogTWFzayBBTUQgTnVtYmVyIG9mIENvcmVzIGluZm9ybWF0
aW9uLiAqLwotICAgICAgICByZWdzWzJdID0gMDsKLSAgICAgICAgYnJlYWs7Ci0gICAgfQotfQot
Ci1zdGF0aWMgdm9pZCB4Y19jcHVpZF9odm1fcG9saWN5KGNvbnN0IHN0cnVjdCBjcHVpZF9kb21h
aW5faW5mbyAqaW5mbywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdW5z
aWduZWQgaW50ICppbnB1dCwgdW5zaWduZWQgaW50ICpyZWdzKQotewotICAgIHN3aXRjaCAoIGlu
cHV0WzBdICkKLSAgICB7Ci0gICAgY2FzZSAweDAwMDAwMDAwOgotICAgICAgICBpZiAoIHJlZ3Nb
MF0gPiBERUZfTUFYX0JBU0UgKQotICAgICAgICAgICAgcmVnc1swXSA9IERFRl9NQVhfQkFTRTsK
LSAgICAgICAgYnJlYWs7Ci0KLSAgICBjYXNlIDB4MDAwMDAwMDE6Ci0gICAgICAgIC8qCi0gICAg
ICAgICAqIEVCWFsyMzoxNl0gaXMgTWF4aW11bSBMb2dpY2FsIFByb2Nlc3NvcnMgUGVyIFBhY2th
Z2UuCi0gICAgICAgICAqIFVwZGF0ZSB0byByZWZsZWN0IHZMQVBJQ19JRCA9IHZDUFVfSUQgKiAy
LgotICAgICAgICAgKi8KLSAgICAgICAgcmVnc1sxXSA9IChyZWdzWzFdICYgMHgwMDAwZmZmZnUp
IHwgKChyZWdzWzFdICYgMHgwMDdmMDAwMHUpIDw8IDEpOwotCi0gICAgICAgIHJlZ3NbMl0gPSBp
bmZvLT5mZWF0dXJlc2V0W2ZlYXR1cmV3b3JkX29mKFg4Nl9GRUFUVVJFX1NTRTMpXTsKLSAgICAg
ICAgcmVnc1szXSA9IChpbmZvLT5mZWF0dXJlc2V0W2ZlYXR1cmV3b3JkX29mKFg4Nl9GRUFUVVJF
X0ZQVSldIHwKLSAgICAgICAgICAgICAgICAgICBiaXRtYXNrb2YoWDg2X0ZFQVRVUkVfSFRUKSk7
Ci0gICAgICAgIGJyZWFrOwotCi0gICAgY2FzZSAweDAwMDAwMDA3OiAvKiBJbnRlbC1kZWZpbmVk
IENQVSBmZWF0dXJlcyAqLwotICAgICAgICBpZiAoIGlucHV0WzFdID09IDAgKQotICAgICAgICB7
Ci0gICAgICAgICAgICByZWdzWzFdID0gaW5mby0+ZmVhdHVyZXNldFtmZWF0dXJld29yZF9vZihY
ODZfRkVBVFVSRV9GU0dTQkFTRSldOwotICAgICAgICAgICAgcmVnc1syXSA9IGluZm8tPmZlYXR1
cmVzZXRbZmVhdHVyZXdvcmRfb2YoWDg2X0ZFQVRVUkVfUFJFRkVUQ0hXVDEpXTsKLSAgICAgICAg
ICAgIHJlZ3NbM10gPSBpbmZvLT5mZWF0dXJlc2V0W2ZlYXR1cmV3b3JkX29mKFg4Nl9GRUFUVVJF
X0FWWDUxMl80Vk5OSVcpXTsKLSAgICAgICAgfQotICAgICAgICBlbHNlCi0gICAgICAgIHsKLSAg
ICAgICAgICAgIHJlZ3NbMV0gPSAwOwotICAgICAgICAgICAgcmVnc1syXSA9IDA7Ci0gICAgICAg
ICAgICByZWdzWzNdID0gMDsKLSAgICAgICAgfQotICAgICAgICByZWdzWzBdID0gMDsKLSAgICAg
ICAgYnJlYWs7Ci0KLSAgICBjYXNlIDB4MDAwMDAwMGQ6IC8qIFhlbiBhdXRvbWF0aWNhbGx5IGNh
bGN1bGF0ZXMgYWxtb3N0IGV2ZXJ5dGhpbmcuICovCi0gICAgICAgIGlmICggaW5wdXRbMV0gPT0g
MSApCi0gICAgICAgICAgICByZWdzWzBdID0gaW5mby0+ZmVhdHVyZXNldFtmZWF0dXJld29yZF9v
ZihYODZfRkVBVFVSRV9YU0FWRU9QVCldOwotICAgICAgICBlbHNlCi0gICAgICAgICAgICByZWdz
WzBdID0gMDsKLSAgICAgICAgcmVnc1sxXSA9IHJlZ3NbMl0gPSByZWdzWzNdID0gMDsKLSAgICAg
ICAgYnJlYWs7Ci0KLSAgICBjYXNlIDB4ODAwMDAwMDA6Ci0gICAgICAgIC8qIFBhc3N0aHJvdWdo
IHRvIGNwdSB2ZW5kb3Igc3BlY2lmaWMgZnVuY3Rpb25zICovCi0gICAgICAgIGJyZWFrOwotCi0g
ICAgY2FzZSAweDgwMDAwMDAxOgotICAgICAgICByZWdzWzJdID0gKGluZm8tPmZlYXR1cmVzZXRb
ZmVhdHVyZXdvcmRfb2YoWDg2X0ZFQVRVUkVfTEFIRl9MTSldICYKLSAgICAgICAgICAgICAgICAg
ICB+Yml0bWFza29mKFg4Nl9GRUFUVVJFX0NNUF9MRUdBQ1kpKTsKLSAgICAgICAgcmVnc1szXSA9
IGluZm8tPmZlYXR1cmVzZXRbZmVhdHVyZXdvcmRfb2YoWDg2X0ZFQVRVUkVfU1lTQ0FMTCldOwot
ICAgICAgICBicmVhazsKLQotICAgIGNhc2UgMHg4MDAwMDAwNzoKLSAgICAgICAgLyoKLSAgICAg
ICAgICogS2VlcCBvbmx5IFRTQ0ludmFyaWFudC4gVGhpcyBtYXkgYmUgY2xlYXJlZCBieSB0aGUg
aHlwZXJ2aXNvcgotICAgICAgICAgKiBkZXBlbmRpbmcgb24gZ3Vlc3QgVFNDIGFuZCBtaWdyYXRp
b24gc2V0dGluZ3MuCi0gICAgICAgICAqLwotICAgICAgICByZWdzWzBdID0gcmVnc1sxXSA9IHJl
Z3NbMl0gPSAwOwotICAgICAgICByZWdzWzNdICY9IDF1PDw4OwotICAgICAgICBicmVhazsKLQot
ICAgIGNhc2UgMHg4MDAwMDAwODoKLSAgICAgICAgcmVnc1swXSAmPSAweDAwMDBmZmZmdTsKLSAg
ICAgICAgcmVnc1sxXSA9IGluZm8tPmZlYXR1cmVzZXRbZmVhdHVyZXdvcmRfb2YoWDg2X0ZFQVRV
UkVfQ0xaRVJPKV07Ci0gICAgICAgIC8qIHJlZ3NbMl0gaGFuZGxlZCBpbiB0aGUgcGVyLXZlbmRv
ciBsb2dpYy4gKi8KLSAgICAgICAgcmVnc1szXSA9IDA7Ci0gICAgICAgIGJyZWFrOwotCi0gICAg
Y2FzZSAweDAwMDAwMDAyOiAvKiBJbnRlbCBjYWNoZSBpbmZvIChkdW1wZWQgYnkgQU1EIHBvbGlj
eSkgKi8KLSAgICBjYXNlIDB4MDAwMDAwMDQ6IC8qIEludGVsIGNhY2hlIGluZm8gKGR1bXBlZCBi
eSBBTUQgcG9saWN5KSAqLwotICAgIGNhc2UgMHgwMDAwMDAwYTogLyogQXJjaGl0ZWN0dXJhbCBQ
ZXJmb3JtYW5jZSBNb25pdG9yIEZlYXR1cmVzICovCi0gICAgY2FzZSAweDgwMDAwMDAyOiAvKiBQ
cm9jZXNzb3IgbmFtZSBzdHJpbmcgKi8KLSAgICBjYXNlIDB4ODAwMDAwMDM6IC8qIC4uLiBjb250
aW51ZWQgICAgICAgICAqLwotICAgIGNhc2UgMHg4MDAwMDAwNDogLyogLi4uIGNvbnRpbnVlZCAg
ICAgICAgICovCi0gICAgY2FzZSAweDgwMDAwMDA1OiAvKiBBTUQgTDEgY2FjaGUvVExCIGluZm8g
KGR1bXBlZCBieSBJbnRlbCBwb2xpY3kpICovCi0gICAgY2FzZSAweDgwMDAwMDA2OiAvKiBBTUQg
TDIvMyBjYWNoZS9UTEIgaW5mbyA7IEludGVsIEwyIGNhY2hlIGZlYXR1cmVzICovCi0gICAgY2Fz
ZSAweDgwMDAwMDBhOiAvKiBBTUQgU1ZNIGZlYXR1cmUgYml0cyAqLwotICAgIGNhc2UgMHg4MDAw
MDAxOTogLyogQU1EIDFHIFRMQiAqLwotICAgIGNhc2UgMHg4MDAwMDAxYTogLyogQU1EIHBlcmYg
aGludHMgKi8KLSAgICBjYXNlIDB4ODAwMDAwMWM6IC8qIEFNRCBsaWdodHdlaWdodCBwcm9maWxp
bmcgKi8KLSAgICAgICAgYnJlYWs7Ci0KLSAgICBkZWZhdWx0OgotICAgICAgICByZWdzWzBdID0g
cmVnc1sxXSA9IHJlZ3NbMl0gPSByZWdzWzNdID0gMDsKLSAgICAgICAgYnJlYWs7Ci0gICAgfQot
Ci0gICAgaWYgKCBpbmZvLT52ZW5kb3IgJiAoWDg2X1ZFTkRPUl9BTUQgfCBYODZfVkVORE9SX0hZ
R09OKSApCi0gICAgICAgIGFtZF94Y19jcHVpZF9wb2xpY3koaW5mbywgaW5wdXQsIHJlZ3MpOwot
ICAgIGVsc2UKLSAgICAgICAgaW50ZWxfeGNfY3B1aWRfcG9saWN5KGluZm8sIGlucHV0LCByZWdz
KTsKLX0KLQotc3RhdGljIHZvaWQgeGNfY3B1aWRfcHZfcG9saWN5KGNvbnN0IHN0cnVjdCBjcHVp
ZF9kb21haW5faW5mbyAqaW5mbywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25z
dCB1bnNpZ25lZCBpbnQgKmlucHV0LCB1bnNpZ25lZCBpbnQgKnJlZ3MpCi17Ci0gICAgc3dpdGNo
ICggaW5wdXRbMF0gKQotICAgIHsKLSAgICBjYXNlIDB4MDAwMDAwMDA6Ci0gICAgICAgIGlmICgg
cmVnc1swXSA+IERFRl9NQVhfQkFTRSApCi0gICAgICAgICAgICByZWdzWzBdID0gREVGX01BWF9C
QVNFOwotICAgICAgICBicmVhazsKLQotICAgIGNhc2UgMHgwMDAwMDAwMToKLSAgICB7Ci0gICAg
ICAgIC8qIEhvc3QgdG9wb2xvZ3kgZXhwb3NlZCB0byBQViBndWVzdC4gIFByb3ZpZGUgaG9zdCB2
YWx1ZS4gKi8KLSAgICAgICAgYm9vbCBob3N0X2h0dCA9IHJlZ3NbM10gJiBiaXRtYXNrb2YoWDg2
X0ZFQVRVUkVfSFRUKTsKLQotICAgICAgICAvKgotICAgICAgICAgKiBEb24ndCBwaWNrIGhvc3Qn
cyBJbml0aWFsIEFQSUMgSUQgd2hpY2ggY2FuIGNoYW5nZSBmcm9tIHJ1bgotICAgICAgICAgKiB0
byBydW4uCi0gICAgICAgICAqLwotICAgICAgICByZWdzWzFdICY9IDB4MDBmZmZmZmZ1OwotCi0g
ICAgICAgIHJlZ3NbMl0gPSBpbmZvLT5mZWF0dXJlc2V0W2ZlYXR1cmV3b3JkX29mKFg4Nl9GRUFU
VVJFX1NTRTMpXTsKLSAgICAgICAgcmVnc1szXSA9IChpbmZvLT5mZWF0dXJlc2V0W2ZlYXR1cmV3
b3JkX29mKFg4Nl9GRUFUVVJFX0ZQVSldICYKLSAgICAgICAgICAgICAgICAgICB+Yml0bWFza29m
KFg4Nl9GRUFUVVJFX0hUVCkpOwotCi0gICAgICAgIGlmICggaG9zdF9odHQgKQotICAgICAgICAg
ICAgcmVnc1szXSB8PSBiaXRtYXNrb2YoWDg2X0ZFQVRVUkVfSFRUKTsKLSAgICAgICAgYnJlYWs7
Ci0gICAgfQotCi0gICAgY2FzZSAweDAwMDAwMDA3OgotICAgICAgICBpZiAoIGlucHV0WzFdID09
IDAgKQotICAgICAgICB7Ci0gICAgICAgICAgICByZWdzWzFdID0gaW5mby0+ZmVhdHVyZXNldFtm
ZWF0dXJld29yZF9vZihYODZfRkVBVFVSRV9GU0dTQkFTRSldOwotICAgICAgICAgICAgcmVnc1sy
XSA9IGluZm8tPmZlYXR1cmVzZXRbZmVhdHVyZXdvcmRfb2YoWDg2X0ZFQVRVUkVfUFJFRkVUQ0hX
VDEpXTsKLSAgICAgICAgICAgIHJlZ3NbM10gPSBpbmZvLT5mZWF0dXJlc2V0W2ZlYXR1cmV3b3Jk
X29mKFg4Nl9GRUFUVVJFX0FWWDUxMl80Vk5OSVcpXTsKLSAgICAgICAgfQotICAgICAgICBlbHNl
Ci0gICAgICAgIHsKLSAgICAgICAgICAgIHJlZ3NbMV0gPSAwOwotICAgICAgICAgICAgcmVnc1sy
XSA9IDA7Ci0gICAgICAgICAgICByZWdzWzNdID0gMDsKLSAgICAgICAgfQotICAgICAgICByZWdz
WzBdID0gMDsKLSAgICAgICAgYnJlYWs7Ci0KLSAgICBjYXNlIDB4MDAwMDAwMGQ6IC8qIFhlbiBh
dXRvbWF0aWNhbGx5IGNhbGN1bGF0ZXMgYWxtb3N0IGV2ZXJ5dGhpbmcuICovCi0gICAgICAgIGlm
ICggaW5wdXRbMV0gPT0gMSApCi0gICAgICAgICAgICByZWdzWzBdID0gaW5mby0+ZmVhdHVyZXNl
dFtmZWF0dXJld29yZF9vZihYODZfRkVBVFVSRV9YU0FWRU9QVCldOwotICAgICAgICBlbHNlCi0g
ICAgICAgICAgICByZWdzWzBdID0gMDsKLSAgICAgICAgcmVnc1sxXSA9IHJlZ3NbMl0gPSByZWdz
WzNdID0gMDsKLSAgICAgICAgYnJlYWs7Ci0KLSAgICBjYXNlIDB4ODAwMDAwMDA6Ci0gICAgewot
ICAgICAgICB1bnNpZ25lZCBpbnQgbWF4ID0gKGluZm8tPnZlbmRvciAmIChYODZfVkVORE9SX0FN
RCB8IFg4Nl9WRU5ET1JfSFlHT04pKQotICAgICAgICAgICAgPyBERUZfTUFYX0FNREVYVCA6IERF
Rl9NQVhfSU5URUxFWFQ7Ci0KLSAgICAgICAgaWYgKCByZWdzWzBdID4gbWF4ICkKLSAgICAgICAg
ICAgIHJlZ3NbMF0gPSBtYXg7Ci0gICAgICAgIGJyZWFrOwotICAgIH0KLQotICAgIGNhc2UgMHg4
MDAwMDAwMToKLSAgICB7Ci0gICAgICAgIC8qIEhvc3QgdG9wb2xvZ3kgZXhwb3NlZCB0byBQViBn
dWVzdC4gIFByb3ZpZGUgaG9zdCBDTVBfTEVHQUNZIHZhbHVlLiAqLwotICAgICAgICBib29sIGhv
c3RfY21wX2xlZ2FjeSA9IHJlZ3NbMl0gJiBiaXRtYXNrb2YoWDg2X0ZFQVRVUkVfQ01QX0xFR0FD
WSk7Ci0KLSAgICAgICAgcmVnc1syXSA9IChpbmZvLT5mZWF0dXJlc2V0W2ZlYXR1cmV3b3JkX29m
KFg4Nl9GRUFUVVJFX0xBSEZfTE0pXSAmCi0gICAgICAgICAgICAgICAgICAgfmJpdG1hc2tvZihY
ODZfRkVBVFVSRV9DTVBfTEVHQUNZKSk7Ci0gICAgICAgIHJlZ3NbM10gPSBpbmZvLT5mZWF0dXJl
c2V0W2ZlYXR1cmV3b3JkX29mKFg4Nl9GRUFUVVJFX1NZU0NBTEwpXTsKLQotICAgICAgICBpZiAo
IGhvc3RfY21wX2xlZ2FjeSApCi0gICAgICAgICAgICByZWdzWzJdIHw9IGJpdG1hc2tvZihYODZf
RkVBVFVSRV9DTVBfTEVHQUNZKTsKLQotICAgICAgICBicmVhazsKLSAgICB9Ci0KLSAgICBjYXNl
IDB4ODAwMDAwMDg6Ci0gICAgICAgIHJlZ3NbMF0gJj0gMHgwMDAwZmZmZnU7Ci0gICAgICAgIHJl
Z3NbMV0gPSBpbmZvLT5mZWF0dXJlc2V0W2ZlYXR1cmV3b3JkX29mKFg4Nl9GRUFUVVJFX0NMWkVS
TyldOwotICAgICAgICByZWdzWzJdID0gcmVnc1szXSA9IDA7Ci0gICAgICAgIGJyZWFrOwotCi0g
ICAgY2FzZSAweDAwMDAwMDA1OiAvKiBNT05JVE9SL01XQUlUICovCi0gICAgY2FzZSAweDAwMDAw
MDBiOiAvKiBFeHRlbmRlZCBUb3BvbG9neSBFbnVtZXJhdGlvbiAqLwotICAgIGNhc2UgMHg4MDAw
MDAwYTogLyogU1ZNIHJldmlzaW9uIGFuZCBmZWF0dXJlcyAqLwotICAgIGNhc2UgMHg4MDAwMDAx
YjogLyogSW5zdHJ1Y3Rpb24gQmFzZWQgU2FtcGxpbmcgKi8KLSAgICBjYXNlIDB4ODAwMDAwMWM6
IC8qIExpZ2h0IFdlaWdodCBQcm9maWxpbmcgKi8KLSAgICBjYXNlIDB4ODAwMDAwMWU6IC8qIEV4
dGVuZGVkIHRvcG9sb2d5IHJlcG9ydGluZyAqLwotICAgICAgICByZWdzWzBdID0gcmVnc1sxXSA9
IHJlZ3NbMl0gPSByZWdzWzNdID0gMDsKLSAgICAgICAgYnJlYWs7Ci0gICAgfQotfQotCi1zdGF0
aWMgdm9pZCB4Y19jcHVpZF9wb2xpY3koY29uc3Qgc3RydWN0IGNwdWlkX2RvbWFpbl9pbmZvICpp
bmZvLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHVuc2lnbmVkIGludCAqaW5w
dXQsIHVuc2lnbmVkIGludCAqcmVncykKLXsKLSAgICAvKgotICAgICAqIEZvciBoeXBlcnZpc29y
IGxlYXZlcyAoMHg0MDAwWFhYWCkgb25seSAweDQwMDB4eDAwLkVBWFs3OjBdIGJpdHMgKG1heAot
ICAgICAqIG51bWJlciBvZiBsZWF2ZXMpIGNhbiBiZSBzZXQgYnkgdXNlci4gSHlwZXJ2aXNvciB3
aWxsIGVuZm9yY2UgdGhpcyBzbwotICAgICAqIGFsbCBvdGhlciBiaXRzIGFyZSBkb24ndC1jYXJl
IGFuZCB3ZSBjYW4gc2V0IHRoZW0gdG8gemVyby4KLSAgICAgKi8KLSAgICBpZiAoIChpbnB1dFsw
XSAmIDB4ZmZmZjAwMDApID09IDB4NDAwMDAwMDAgKQotICAgIHsKLSAgICAgICAgcmVnc1swXSA9
IHJlZ3NbMV0gPSByZWdzWzJdID0gcmVnc1szXSA9IDA7Ci0gICAgICAgIHJldHVybjsKLSAgICB9
Ci0KLSAgICBpZiAoIGluZm8tPmh2bSApCi0gICAgICAgIHhjX2NwdWlkX2h2bV9wb2xpY3koaW5m
bywgaW5wdXQsIHJlZ3MpOwotICAgIGVsc2UKLSAgICAgICAgeGNfY3B1aWRfcHZfcG9saWN5KGlu
Zm8sIGlucHV0LCByZWdzKTsKLX0KLQotc3RhdGljIGludCB4Y19jcHVpZF9kb19kb21jdGwoCi0g
ICAgeGNfaW50ZXJmYWNlICp4Y2gsIHVpbnQzMl90IGRvbWlkLAotICAgIGNvbnN0IHVuc2lnbmVk
IGludCAqaW5wdXQsIGNvbnN0IHVuc2lnbmVkIGludCAqcmVncykKLXsKLSAgICBERUNMQVJFX0RP
TUNUTDsKLQotICAgIG1lbXNldCgmZG9tY3RsLCAwLCBzaXplb2YgKGRvbWN0bCkpOwotICAgIGRv
bWN0bC5kb21haW4gPSBkb21pZDsKLSAgICBkb21jdGwuY21kID0gWEVOX0RPTUNUTF9zZXRfY3B1
aWQ7Ci0gICAgZG9tY3RsLnUuY3B1aWQuaW5wdXRbMF0gPSBpbnB1dFswXTsKLSAgICBkb21jdGwu
dS5jcHVpZC5pbnB1dFsxXSA9IGlucHV0WzFdOwotICAgIGRvbWN0bC51LmNwdWlkLmVheCA9IHJl
Z3NbMF07Ci0gICAgZG9tY3RsLnUuY3B1aWQuZWJ4ID0gcmVnc1sxXTsKLSAgICBkb21jdGwudS5j
cHVpZC5lY3ggPSByZWdzWzJdOwotICAgIGRvbWN0bC51LmNwdWlkLmVkeCA9IHJlZ3NbM107Ci0K
LSAgICByZXR1cm4gZG9fZG9tY3RsKHhjaCwgJmRvbWN0bCk7Ci19Ci0KLXN0YXRpYyB2b2lkIHNh
bml0aXNlX2ZlYXR1cmVzZXQoc3RydWN0IGNwdWlkX2RvbWFpbl9pbmZvICppbmZvKQotewotICAg
IGNvbnN0IHVpbnQzMl90IGZzX3NpemUgPSB4Y19nZXRfY3B1X2ZlYXR1cmVzZXRfc2l6ZSgpOwot
ICAgIHVpbnQzMl90IGRpc2FibGVkX2ZlYXR1cmVzW2ZzX3NpemVdOwotICAgIHN0YXRpYyBjb25z
dCB1aW50MzJfdCBkZWVwX2ZlYXR1cmVzW10gPSBJTklUX0RFRVBfRkVBVFVSRVM7Ci0gICAgdW5z
aWduZWQgaW50IGksIGI7Ci0KLSAgICBpZiAoIGluZm8tPmh2bSApCi0gICAgewotICAgICAgICAv
KiBIVk0gb3IgUFZIIEd1ZXN0ICovCi0KLSAgICAgICAgaWYgKCAhaW5mby0+cGFlICkKLSAgICAg
ICAgICAgIGNsZWFyX2JpdChYODZfRkVBVFVSRV9QQUUsIGluZm8tPmZlYXR1cmVzZXQpOwotCi0g
ICAgICAgIGlmICggIWluZm8tPm5lc3RlZGh2bSApCi0gICAgICAgIHsKLSAgICAgICAgICAgIGNs
ZWFyX2JpdChYODZfRkVBVFVSRV9TVk0sIGluZm8tPmZlYXR1cmVzZXQpOwotICAgICAgICAgICAg
Y2xlYXJfYml0KFg4Nl9GRUFUVVJFX1ZNWCwgaW5mby0+ZmVhdHVyZXNldCk7Ci0gICAgICAgIH0K
LSAgICB9Ci0gICAgZWxzZQotICAgIHsKLSAgICAgICAgLyogUFYgR3Vlc3QgKi8KLQotICAgICAg
ICBpZiAoICFpbmZvLT5wdjY0ICkKLSAgICAgICAgewotICAgICAgICAgICAgY2xlYXJfYml0KFg4
Nl9GRUFUVVJFX0xNLCBpbmZvLT5mZWF0dXJlc2V0KTsKLSAgICAgICAgICAgIGlmICggIShpbmZv
LT52ZW5kb3IgJiAoWDg2X1ZFTkRPUl9BTUQgfCBYODZfVkVORE9SX0hZR09OKSkgKQotICAgICAg
ICAgICAgICAgIGNsZWFyX2JpdChYODZfRkVBVFVSRV9TWVNDQUxMLCBpbmZvLT5mZWF0dXJlc2V0
KTsKLSAgICAgICAgfQotCi0gICAgICAgIGNsZWFyX2JpdChYODZfRkVBVFVSRV9QU0UsIGluZm8t
PmZlYXR1cmVzZXQpOwotICAgICAgICBjbGVhcl9iaXQoWDg2X0ZFQVRVUkVfUFNFMzYsIGluZm8t
PmZlYXR1cmVzZXQpOwotICAgICAgICBjbGVhcl9iaXQoWDg2X0ZFQVRVUkVfUEdFLCBpbmZvLT5m
ZWF0dXJlc2V0KTsKLSAgICAgICAgY2xlYXJfYml0KFg4Nl9GRUFUVVJFX1BBR0UxR0IsIGluZm8t
PmZlYXR1cmVzZXQpOwotICAgIH0KLQotICAgIGlmICggaW5mby0+eGZlYXR1cmVfbWFzayA9PSAw
ICkKLSAgICAgICAgY2xlYXJfYml0KFg4Nl9GRUFUVVJFX1hTQVZFLCBpbmZvLT5mZWF0dXJlc2V0
KTsKLQotICAgIC8qIERpc2FibGUgZGVlcCBkZXBlbmRlbmNpZXMgb2YgZGlzYWJsZWQgZmVhdHVy
ZXMuICovCi0gICAgZm9yICggaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGRpc2FibGVkX2ZlYXR1cmVz
KTsgKytpICkKLSAgICAgICAgZGlzYWJsZWRfZmVhdHVyZXNbaV0gPSB+aW5mby0+ZmVhdHVyZXNl
dFtpXSAmIGRlZXBfZmVhdHVyZXNbaV07Ci0KLSAgICBmb3IgKCBiID0gMDsgYiA8IHNpemVvZihk
aXNhYmxlZF9mZWF0dXJlcykgKiBDSEFSX0JJVDsgKytiICkKLSAgICB7Ci0gICAgICAgIGNvbnN0
IHVpbnQzMl90ICpkZnM7Ci0KLSAgICAgICAgaWYgKCAhdGVzdF9iaXQoYiwgZGlzYWJsZWRfZmVh
dHVyZXMpIHx8Ci0gICAgICAgICAgICAgIShkZnMgPSB4ODZfY3B1aWRfbG9va3VwX2RlZXBfZGVw
cyhiKSkgKQotICAgICAgICAgICAgIGNvbnRpbnVlOwotCi0gICAgICAgIGZvciAoIGkgPSAwOyBp
IDwgQVJSQVlfU0laRShkaXNhYmxlZF9mZWF0dXJlcyk7ICsraSApCi0gICAgICAgIHsKLSAgICAg
ICAgICAgIGluZm8tPmZlYXR1cmVzZXRbaV0gJj0gfmRmc1tpXTsKLSAgICAgICAgICAgIGRpc2Fi
bGVkX2ZlYXR1cmVzW2ldICY9IH5kZnNbaV07Ci0gICAgICAgIH0KLSAgICB9Ci19Ci0KLWludCB4
Y19jcHVpZF9hcHBseV9wb2xpY3koeGNfaW50ZXJmYWNlICp4Y2gsIHVpbnQzMl90IGRvbWlkLAot
ICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB1aW50MzJfdCAqZmVhdHVyZXNldCwgdW5z
aWduZWQgaW50IG5yX2ZlYXR1cmVzKQotewotICAgIHN0cnVjdCBjcHVpZF9kb21haW5faW5mbyBp
bmZvID0ge307Ci0gICAgdW5zaWduZWQgaW50IGlucHV0WzJdID0geyAwLCAwIH0sIHJlZ3NbNF07
Ci0gICAgdW5zaWduZWQgaW50IGJhc2VfbWF4LCBleHRfbWF4OwotICAgIGludCByYzsKLQotICAg
IHJjID0gZ2V0X2NwdWlkX2RvbWFpbl9pbmZvKHhjaCwgZG9taWQsICZpbmZvLCBmZWF0dXJlc2V0
LCBucl9mZWF0dXJlcyk7Ci0gICAgaWYgKCByYyApCi0gICAgICAgIGdvdG8gb3V0OwotCi0gICAg
Y3B1aWQoaW5wdXQsIHJlZ3MpOwotICAgIGJhc2VfbWF4ID0gKHJlZ3NbMF0gPD0gREVGX01BWF9C
QVNFKSA/IHJlZ3NbMF0gOiBERUZfTUFYX0JBU0U7Ci0gICAgaW5wdXRbMF0gPSAweDgwMDAwMDAw
OwotICAgIGNwdWlkKGlucHV0LCByZWdzKTsKLQotICAgIGlmICggaW5mby52ZW5kb3IgPT0gWDg2
X1ZFTkRPUl9BTUQgfHwgaW5mby52ZW5kb3IgPT0gWDg2X1ZFTkRPUl9IWUdPTiApCi0gICAgICAg
IGV4dF9tYXggPSAocmVnc1swXSA8PSBERUZfTUFYX0FNREVYVCkgPyByZWdzWzBdIDogREVGX01B
WF9BTURFWFQ7Ci0gICAgZWxzZQotICAgICAgICBleHRfbWF4ID0gKHJlZ3NbMF0gPD0gREVGX01B
WF9JTlRFTEVYVCkgPyByZWdzWzBdIDogREVGX01BWF9JTlRFTEVYVDsKLQotICAgIHNhbml0aXNl
X2ZlYXR1cmVzZXQoJmluZm8pOwotCi0gICAgaW5wdXRbMF0gPSAwOwotICAgIGlucHV0WzFdID0g
WEVOX0NQVUlEX0lOUFVUX1VOVVNFRDsKLSAgICBmb3IgKCA7IDsgKQotICAgIHsKLSAgICAgICAg
Y3B1aWQoaW5wdXQsIHJlZ3MpOwotICAgICAgICB4Y19jcHVpZF9wb2xpY3koJmluZm8sIGlucHV0
LCByZWdzKTsKLQotICAgICAgICBpZiAoIHJlZ3NbMF0gfHwgcmVnc1sxXSB8fCByZWdzWzJdIHx8
IHJlZ3NbM10gKQotICAgICAgICB7Ci0gICAgICAgICAgICByYyA9IHhjX2NwdWlkX2RvX2RvbWN0
bCh4Y2gsIGRvbWlkLCBpbnB1dCwgcmVncyk7Ci0gICAgICAgICAgICBpZiAoIHJjICkKLSAgICAg
ICAgICAgICAgICBnb3RvIG91dDsKLSAgICAgICAgfQotCi0gICAgICAgIC8qIEludGVsIGNhY2hl
IGRlc2NyaXB0b3IgbGVhdmVzLiAqLwotICAgICAgICBpZiAoIGlucHV0WzBdID09IDQgKQotICAg
ICAgICB7Ci0gICAgICAgICAgICBpbnB1dFsxXSsrOwotICAgICAgICAgICAgLyogTW9yZSB0byBk
bz8gVGhlbiBsb29wIGtlZXBpbmcgJSVlYXg9PTB4MDAwMDAwMDQuICovCi0gICAgICAgICAgICBp
ZiAoIChyZWdzWzBdICYgMHgxZikgIT0gMCApCi0gICAgICAgICAgICAgICAgY29udGludWU7Ci0g
ICAgICAgIH0KLSAgICAgICAgLyogRXh0ZW5kZWQgVG9wb2xvZ3kgbGVhdmVzLiAqLwotICAgICAg
ICBlbHNlIGlmICggaW5wdXRbMF0gPT0gMHhiICkKLSAgICAgICAgewotICAgICAgICAgICAgdWlu
dDhfdCBsZXZlbF90eXBlID0gcmVnc1syXSA+PiA4OwotCi0gICAgICAgICAgICBpbnB1dFsxXSsr
OwotICAgICAgICAgICAgaWYgKCBsZXZlbF90eXBlID49IDEgJiYgbGV2ZWxfdHlwZSA8PSAyICkK
LSAgICAgICAgICAgICAgICBjb250aW51ZTsKLSAgICAgICAgfQotCi0gICAgICAgIGlucHV0WzBd
Kys7Ci0gICAgICAgIGlmICggIShpbnB1dFswXSAmIDB4ODAwMDAwMDB1KSAmJiAoaW5wdXRbMF0g
PiBiYXNlX21heCApICkKLSAgICAgICAgICAgIGlucHV0WzBdID0gMHg4MDAwMDAwMHU7Ci0KLSAg
ICAgICAgaW5wdXRbMV0gPSBYRU5fQ1BVSURfSU5QVVRfVU5VU0VEOwotICAgICAgICBpZiAoIChp
bnB1dFswXSA9PSA0KSB8fCAoaW5wdXRbMF0gPT0gNykgfHwgKGlucHV0WzBdID09IDB4YikgKQot
ICAgICAgICAgICAgaW5wdXRbMV0gPSAwOwotICAgICAgICBlbHNlIGlmICggaW5wdXRbMF0gPT0g
MHhkICkKLSAgICAgICAgICAgIGlucHV0WzFdID0gMTsgLyogWGVuIGF1dG9tYXRpY2FsbHkgY2Fs
Y3VsYXRlcyBhbG1vc3QgZXZlcnl0aGluZy4gKi8KLQotICAgICAgICBpZiAoIChpbnB1dFswXSAm
IDB4ODAwMDAwMDB1KSAmJiAoaW5wdXRbMF0gPiBleHRfbWF4KSApCi0gICAgICAgICAgICBicmVh
azsKLSAgICB9Ci0KLSBvdXQ6Ci0gICAgZnJlZV9jcHVpZF9kb21haW5faW5mbygmaW5mbyk7Ci0g
ICAgcmV0dXJuIHJjOwotfQotCiAvKgogICogQ29uZmlndXJlIGEgc2luZ2xlIGlucHV0IHdpdGgg
dGhlIGluZm9ybWF0aW9tIGZyb20gY29uZmlnLgogICoKQEAgLTEwNTQsMyArNDQ2LDE5MSBAQCBp
bnQgeGNfY3B1aWRfc2V0KAogCiAgICAgcmV0dXJuIHJjOwogfQorCitpbnQgeGNfY3B1aWRfYXBw
bHlfcG9saWN5KHhjX2ludGVyZmFjZSAqeGNoLCB1aW50MzJfdCBkb21pZCwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgY29uc3QgdWludDMyX3QgKmZlYXR1cmVzZXQsIHVuc2lnbmVkIGludCBu
cl9mZWF0dXJlcykKK3sKKyAgICBpbnQgcmM7CisgICAgeGNfZG9taW5mb190IGRpOworICAgIHVu
c2lnbmVkIGludCBpLCBucl9sZWF2ZXMsIG5yX21zcnM7CisgICAgeGVuX2NwdWlkX2xlYWZfdCAq
bGVhdmVzID0gTlVMTDsKKyAgICBzdHJ1Y3QgY3B1aWRfcG9saWN5ICpwID0gTlVMTDsKKyAgICB1
aW50MzJfdCBlcnJfbGVhZiA9IC0xLCBlcnJfc3VibGVhZiA9IC0xLCBlcnJfbXNyID0gLTE7CisK
KyAgICBpZiAoIHhjX2RvbWFpbl9nZXRpbmZvKHhjaCwgZG9taWQsIDEsICZkaSkgIT0gMSB8fAor
ICAgICAgICAgZGkuZG9taWQgIT0gZG9taWQgKQorICAgIHsKKyAgICAgICAgRVJST1IoIkZhaWxl
ZCB0byBvYnRhaW4gZCVkIGluZm8iLCBkb21pZCk7CisgICAgICAgIHJjID0gLUVTUkNIOworICAg
ICAgICBnb3RvIG91dDsKKyAgICB9CisKKyAgICByYyA9IHhjX2dldF9jcHVfcG9saWN5X3NpemUo
eGNoLCAmbnJfbGVhdmVzLCAmbnJfbXNycyk7CisgICAgaWYgKCByYyApCisgICAgeworICAgICAg
ICBQRVJST1IoIkZhaWxlZCB0byBvYnRhaW4gcG9saWN5IGluZm8gc2l6ZSIpOworICAgICAgICBy
YyA9IC1lcnJubzsKKyAgICAgICAgZ290byBvdXQ7CisgICAgfQorCisgICAgcmMgPSAtRU5PTUVN
OworICAgIGlmICggKGxlYXZlcyA9IGNhbGxvYyhucl9sZWF2ZXMsIHNpemVvZigqbGVhdmVzKSkp
ID09IE5VTEwgfHwKKyAgICAgICAgIChwID0gY2FsbG9jKDEsIHNpemVvZigqcCkpKSA9PSBOVUxM
ICkKKyAgICAgICAgZ290byBvdXQ7CisKKyAgICBucl9tc3JzID0gMDsKKyAgICByYyA9IHhjX2dl
dF9kb21haW5fY3B1X3BvbGljeSh4Y2gsIGRvbWlkLCAmbnJfbGVhdmVzLCBsZWF2ZXMsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJm5yX21zcnMsIE5VTEwpOworICAgIGlmICgg
cmMgKQorICAgIHsKKyAgICAgICAgUEVSUk9SKCJGYWlsZWQgdG8gb2J0YWluIGQlZCdzIHBvbGlj
eSIsIGRvbWlkKTsKKyAgICAgICAgcmMgPSAtZXJybm87CisgICAgICAgIGdvdG8gb3V0OworICAg
IH0KKworICAgIHJjID0geDg2X2NwdWlkX2NvcHlfZnJvbV9idWZmZXIocCwgbGVhdmVzLCBucl9s
ZWF2ZXMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmZXJyX2xlYWYsICZl
cnJfc3VibGVhZik7CisgICAgaWYgKCByYyApCisgICAgeworICAgICAgICBFUlJPUigiRmFpbGVk
IHRvIGRlc2VyaWFsaXNlIENQVUlEIChlcnIgbGVhZiAlI3gsIHN1YmxlYWYgJSN4KSAoJWQgPSAl
cykiLAorICAgICAgICAgICAgICBlcnJfbGVhZiwgZXJyX3N1YmxlYWYsIC1yYywgc3RyZXJyb3Io
LXJjKSk7CisgICAgICAgIGdvdG8gb3V0OworICAgIH0KKworICAgIGlmICggZmVhdHVyZXNldCAp
CisgICAgeworICAgICAgICB1aW50MzJfdCBkaXNhYmxlZF9mZWF0dXJlc1tGRUFUVVJFU0VUX05S
X0VOVFJJRVNdLAorICAgICAgICAgICAgZmVhdFtGRUFUVVJFU0VUX05SX0VOVFJJRVNdID0ge307
CisgICAgICAgIHN0YXRpYyBjb25zdCB1aW50MzJfdCBkZWVwX2ZlYXR1cmVzW10gPSBJTklUX0RF
RVBfRkVBVFVSRVM7CisgICAgICAgIHVuc2lnbmVkIGludCBpLCBiOworCisgICAgICAgIC8qCisg
ICAgICAgICAqIFRoZSB1c2VyIHN1cHBsaWVkIGZlYXR1cmVzZXQgbWF5IGJlIHNob3J0ZXIgb3Ig
bG9uZ2VyIHRoYW4KKyAgICAgICAgICogRkVBVFVSRVNFVF9OUl9FTlRSSUVTLiAgU2hvcnRlciBp
cyBmaW5lLCBhbmQgd2Ugd2lsbCB6ZXJvLWV4dGVuZC4KKyAgICAgICAgICogTG9uZ2VyIGlzIGZp
bmUsIHNvIGxvbmcgYXMgaXQgb25seSBwYWRkZWQgd2l0aCB6ZXJvcy4KKyAgICAgICAgICovCisg
ICAgICAgIHVuc2lnbmVkIGludCB1c2VyX2xlbiA9IG1pbihGRUFUVVJFU0VUX05SX0VOVFJJRVMg
KyAwdSwgbnJfZmVhdHVyZXMpOworCisgICAgICAgIC8qIENoZWNrIGZvciB0cnVuY2F0ZWQgc2V0
IGJpdHMuICovCisgICAgICAgIHJjID0gLUVPUE5PVFNVUFA7CisgICAgICAgIGZvciAoIGkgPSB1
c2VyX2xlbjsgaSA8IG5yX2ZlYXR1cmVzOyArK2kgKQorICAgICAgICAgICAgaWYgKCBmZWF0dXJl
c2V0W2ldICE9IDAgKQorICAgICAgICAgICAgICAgIGdvdG8gb3V0OworCisgICAgICAgIG1lbWNw
eShmZWF0LCBmZWF0dXJlc2V0LCBzaXplb2YoKmZlYXR1cmVzZXQpICogdXNlcl9sZW4pOworCisg
ICAgICAgIC8qIERpc2FibGUgZGVlcCBkZXBlbmRlbmNpZXMgb2YgZGlzYWJsZWQgZmVhdHVyZXMu
ICovCisgICAgICAgIGZvciAoIGkgPSAwOyBpIDwgQVJSQVlfU0laRShkaXNhYmxlZF9mZWF0dXJl
cyk7ICsraSApCisgICAgICAgICAgICBkaXNhYmxlZF9mZWF0dXJlc1tpXSA9IH5mZWF0W2ldICYg
ZGVlcF9mZWF0dXJlc1tpXTsKKworICAgICAgICBmb3IgKCBiID0gMDsgYiA8IHNpemVvZihkaXNh
YmxlZF9mZWF0dXJlcykgKiBDSEFSX0JJVDsgKytiICkKKyAgICAgICAgeworICAgICAgICAgICAg
Y29uc3QgdWludDMyX3QgKmRmczsKKworICAgICAgICAgICAgaWYgKCAhdGVzdF9iaXQoYiwgZGlz
YWJsZWRfZmVhdHVyZXMpIHx8CisgICAgICAgICAgICAgICAgICEoZGZzID0geDg2X2NwdWlkX2xv
b2t1cF9kZWVwX2RlcHMoYikpICkKKyAgICAgICAgICAgICAgICBjb250aW51ZTsKKworICAgICAg
ICAgICAgZm9yICggaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGRpc2FibGVkX2ZlYXR1cmVzKTsgKytp
ICkKKyAgICAgICAgICAgIHsKKyAgICAgICAgICAgICAgICBmZWF0W2ldICY9IH5kZnNbaV07Cisg
ICAgICAgICAgICAgICAgZGlzYWJsZWRfZmVhdHVyZXNbaV0gJj0gfmRmc1tpXTsKKyAgICAgICAg
ICAgIH0KKyAgICAgICAgfQorCisgICAgICAgIGNwdWlkX2ZlYXR1cmVzZXRfdG9fcG9saWN5KGZl
YXQsIHApOworICAgIH0KKworICAgIGlmICggIWRpLmh2bSApCisgICAgeworICAgICAgICB1aW50
MzJfdCBob3N0X2ZlYXR1cmVzZXRbRkVBVFVSRVNFVF9OUl9FTlRSSUVTXSA9IHt9OworICAgICAg
ICB1aW50MzJfdCBsZW4gPSBBUlJBWV9TSVpFKGhvc3RfZmVhdHVyZXNldCk7CisKKyAgICAgICAg
cmMgPSB4Y19nZXRfY3B1X2ZlYXR1cmVzZXQoeGNoLCBYRU5fU1lTQ1RMX2NwdV9mZWF0dXJlc2V0
X2hvc3QsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZsZW4sIGhvc3RfZmVh
dHVyZXNldCk7CisgICAgICAgIGlmICggcmMgKQorICAgICAgICB7CisgICAgICAgICAgICAvKiBU
b2xlcmF0ZSAiYnVmZmVyIHRvbyBzbWFsbCIsIGFzIHdlJ3ZlIGdvdCB0aGUgYml0cyB3ZSBuZWVk
LiAqLworICAgICAgICAgICAgaWYgKCBlcnJubyA9PSBFTk9CVUZTICkKKyAgICAgICAgICAgICAg
ICByYyA9IDA7CisgICAgICAgICAgICBlbHNlCisgICAgICAgICAgICB7CisgICAgICAgICAgICAg
ICAgUEVSUk9SKCJGYWlsZWQgdG8gb2J0YWluIGhvc3QgZmVhdHVyZXNldCIpOworICAgICAgICAg
ICAgICAgIHJjID0gLWVycm5vOworICAgICAgICAgICAgICAgIGdvdG8gb3V0OworICAgICAgICAg
ICAgfQorICAgICAgICB9CisKKyAgICAgICAgLyoKKyAgICAgICAgICogT24gaGFyZHdhcmUgd2l0
aG91dCBDUFVJRCBGYXVsdGluZywgUFYgZ3Vlc3RzIHNlZSByZWFsIHRvcG9sb2d5LgorICAgICAg
ICAgKiBBcyBhIGNvbnNlcXVlbmNlLCB0aGV5IGFsc28gbmVlZCB0byBzZWUgdGhlIGhvc3QgaHR0
L2NtcCBmaWVsZHMuCisgICAgICAgICAqLworICAgICAgICBwLT5iYXNpYy5odHQgICAgICAgPSB0
ZXN0X2JpdChYODZfRkVBVFVSRV9IVFQsIGhvc3RfZmVhdHVyZXNldCk7CisgICAgICAgIHAtPmV4
dGQuY21wX2xlZ2FjeSA9IHRlc3RfYml0KFg4Nl9GRUFUVVJFX0NNUF9MRUdBQ1ksIGhvc3RfZmVh
dHVyZXNldCk7CisgICAgfQorICAgIGVsc2UKKyAgICB7CisgICAgICAgIC8qCisgICAgICAgICAq
IFRvcG9sb2d5IGZvciBIVk0gZ3Vlc3RzIGlzIGVudGlyZWx5IGNvbnRyb2xsZWQgYnkgWGVuLiAg
Rm9yIG5vdywgd2UKKyAgICAgICAgICogaGFyZGNvZGUgQVBJQ19JRCA9IHZjcHVfaWQgKiAyIHRv
IGdpdmUgdGhlIGlsbHVzaW9uIG9mIG5vIFNNVC4KKyAgICAgICAgICovCisgICAgICAgIHAtPmJh
c2ljLmh0dCA9IHRydWU7CisgICAgICAgIHAtPmV4dGQuY21wX2xlZ2FjeSA9IGZhbHNlOworCisg
ICAgICAgIHAtPmJhc2ljLmxwcHAgKj0gMjsKKworICAgICAgICBzd2l0Y2ggKCBwLT54ODZfdmVu
ZG9yICkKKyAgICAgICAgeworICAgICAgICBjYXNlIFg4Nl9WRU5ET1JfSU5URUw6CisgICAgICAg
ICAgICBmb3IgKCBpID0gMDsgKHAtPmNhY2hlLnN1YmxlYWZbaV0udHlwZSAmJgorICAgICAgICAg
ICAgICAgICAgICAgICAgICBpIDwgQVJSQVlfU0laRShwLT5jYWNoZS5yYXcpKTsgKytpICkKKyAg
ICAgICAgICAgIHsKKyAgICAgICAgICAgICAgICBwLT5jYWNoZS5zdWJsZWFmW2ldLmNvcmVzX3Bl
cl9wYWNrYWdlID0KKyAgICAgICAgICAgICAgICAgICAgKHAtPmNhY2hlLnN1YmxlYWZbaV0uY29y
ZXNfcGVyX3BhY2thZ2UgPDwgMSkgfCAxOworICAgICAgICAgICAgICAgIHAtPmNhY2hlLnN1Ymxl
YWZbaV0udGhyZWFkc19wZXJfY2FjaGUgPSAwOworICAgICAgICAgICAgfQorICAgICAgICAgICAg
YnJlYWs7CisKKyAgICAgICAgY2FzZSBYODZfVkVORE9SX0FNRDoKKyAgICAgICAgY2FzZSBYODZf
VkVORE9SX0hZR09OOgorICAgICAgICAgICAgcC0+ZXh0ZC5uYyA9IChwLT5leHRkLm5jIDw8IDEp
IHwgMTsKKyAgICAgICAgICAgIHAtPmV4dGQuYXBpY19pZF9zaXplKys7CisgICAgICAgICAgICBi
cmVhazsKKyAgICAgICAgfQorCisgICAgICAgIC8qCisgICAgICAgICAqIFRoZXNlIHNldHRpbmdz
IGFyZSBuZWNlc3NhcnkgdG8gY2F1c2UgZWFybGllciBIVk1fUEFSQU1fTkVTVEVESFZNIC8KKyAg
ICAgICAgICogWEVOX0RPTUNUTF9kaXNhYmxlX21pZ3JhdGUgc2V0dGluZ3MgdG8gYmUgcmVmbGVj
dGVkIGNvcnJlY3RseSBpbgorICAgICAgICAgKiBDUFVJRC4gIFhlbiB3aWxsIGRpc2NhcmQgdGhl
c2UgYml0cyBpZiBjb25maWd1cmF0aW9uIGhhc24ndCBiZWVuCisgICAgICAgICAqIHNldCBmb3Ig
dGhlIGRvbWFpbi4KKyAgICAgICAgICovCisgICAgICAgIHAtPmV4dGQuaXRzYyA9IHRydWU7Cisg
ICAgICAgIHAtPmJhc2ljLnZteCA9IHRydWU7CisgICAgICAgIHAtPmV4dGQuc3ZtID0gdHJ1ZTsK
KyAgICB9CisKKyAgICByYyA9IHg4Nl9jcHVpZF9jb3B5X3RvX2J1ZmZlcihwLCBsZWF2ZXMsICZu
cl9sZWF2ZXMpOworICAgIGlmICggcmMgKQorICAgIHsKKyAgICAgICAgRVJST1IoIkZhaWxlZCB0
byBzZXJpYWxpc2UgQ1BVSUQgKCVkID0gJXMpIiwgLXJjLCBzdHJlcnJvcigtcmMpKTsKKyAgICAg
ICAgZ290byBvdXQ7CisgICAgfQorCisgICAgcmMgPSB4Y19zZXRfZG9tYWluX2NwdV9wb2xpY3ko
eGNoLCBkb21pZCwgbnJfbGVhdmVzLCBsZWF2ZXMsIDAsIE5VTEwsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgJmVycl9sZWFmLCAmZXJyX3N1YmxlYWYsICZlcnJfbXNyKTsKKyAg
ICBpZiAoIHJjICkKKyAgICB7CisgICAgICAgIFBFUlJPUigiRmFpbGVkIHRvIHNldCBkJWQncyBw
b2xpY3kgKGVyciBsZWFmICUjeCwgc3VibGVhZiAlI3gsIG1zciAlI3gpIiwKKyAgICAgICAgICAg
ICAgIGRvbWlkLCBlcnJfbGVhZiwgZXJyX3N1YmxlYWYsIGVycl9tc3IpOworICAgICAgICByYyA9
IC1lcnJubzsKKyAgICAgICAgZ290byBvdXQ7CisgICAgfQorCisgICAgcmMgPSAwOworCitvdXQ6
CisgICAgZnJlZShwKTsKKyAgICBmcmVlKGxlYXZlcyk7CisKKyAgICByZXR1cm4gcmM7Cit9CmRp
ZmYgLS1naXQgYS94ZW4vaW5jbHVkZS94ZW4vbGliL3g4Ni9jcHVpZC5oIGIveGVuL2luY2x1ZGUv
eGVuL2xpYi94ODYvY3B1aWQuaAppbmRleCA3OTg0MGY5OWNlLi4zMzFlZjRmNGYwIDEwMDY0NAot
LS0gYS94ZW4vaW5jbHVkZS94ZW4vbGliL3g4Ni9jcHVpZC5oCisrKyBiL3hlbi9pbmNsdWRlL3hl
bi9saWIveDg2L2NwdWlkLmgKQEAgLTE1NCw4ICsxNTQsMTIgQEAgc3RydWN0IGNwdWlkX3BvbGlj
eQogICAgIHVuaW9uIHsKICAgICAgICAgc3RydWN0IGNwdWlkX2xlYWYgcmF3W0NQVUlEX0dVRVNU
X05SX0NBQ0hFXTsKICAgICAgICAgc3RydWN0IGNwdWlkX2NhY2hlX2xlYWYgewotICAgICAgICAg
ICAgdWludDMyX3QgdHlwZTo1LAotICAgICAgICAgICAgICAgIDoyNywgOjMyLCA6MzIsIDozMjsK
KyAgICAgICAgICAgIHVpbnQzMl90IC8qIGEgKi8gdHlwZTo1LCBsZXZlbDozOworICAgICAgICAg
ICAgYm9vbCBzZWxmX2luaXQ6MSwgZnVsbHlfYXNzb2M6MTsKKyAgICAgICAgICAgIHVpbnQzMl90
IDo0LCB0aHJlYWRzX3Blcl9jYWNoZToxMiwgY29yZXNfcGVyX3BhY2thZ2U6NjsKKyAgICAgICAg
ICAgIHVpbnQzMl90IC8qIGIgKi8gbGluZV9zaXplOjEyLCBwYXJ0aXRpb25zOjEwLCB3YXlzOjEw
OworICAgICAgICAgICAgdWludDMyX3QgLyogYyAqLyBzZXRzOworICAgICAgICAgICAgYm9vbCAv
KiBkICovIHdiaW52ZDoxLCBpbmNsdXNpdmU6MSwgY29tcGxleDoxOwogICAgICAgICB9IHN1Ymxl
YWZbQ1BVSURfR1VFU1RfTlJfQ0FDSEVdOwogICAgIH0gY2FjaGU7CiAKQEAgLTI1OSw3ICsyNjMs
OCBAQCBzdHJ1Y3QgY3B1aWRfcG9saWN5CiAgICAgICAgICAgICAgICAgdWludDMyX3QgZThiOwog
ICAgICAgICAgICAgICAgIHN0cnVjdCB7IERFQ0xfQklURklFTEQoZThiKTsgfTsKICAgICAgICAg
ICAgIH07Ci0gICAgICAgICAgICB1aW50MzJfdCAvKiBjICovOjMyLCAvKiBkICovOjMyOworICAg
ICAgICAgICAgdWludDMyX3QgbmM6OCwgOjQsIGFwaWNfaWRfc2l6ZTo0LCA6MTY7CisgICAgICAg
ICAgICB1aW50MzJfdCAvKiBkICovOjMyOwogICAgICAgICB9OwogICAgIH0gZXh0ZDsKIAotLSAK
Mi4xMS4wCgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18K
WGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0
cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

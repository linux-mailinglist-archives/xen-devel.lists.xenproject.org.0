Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id E9E4872D92
	for <lists+xen-devel@lfdr.de>; Wed, 24 Jul 2019 13:29:29 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hqFQH-00029H-RQ; Wed, 24 Jul 2019 11:27:05 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=Fm8U=VV=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1hqFQG-00029C-NB
 for xen-devel@lists.xenproject.org; Wed, 24 Jul 2019 11:27:04 +0000
X-Inumbo-ID: f557fda0-ae05-11e9-8980-bc764e045a96
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id f557fda0-ae05-11e9-8980-bc764e045a96;
 Wed, 24 Jul 2019 11:27:03 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 48925AF7E;
 Wed, 24 Jul 2019 11:27:02 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Wed, 24 Jul 2019 13:26:58 +0200
Message-Id: <20190724112658.31495-3-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190724112658.31495-1-jgross@suse.com>
References: <20190724112658.31495-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v3 2/2] xen: merge temporary vcpu pinning
 scenarios
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>,
 Dario Faggioli <dfaggioli@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VG9kYXkgdGhlcmUgYXJlIHR3byBzY2VuYXJpb3Mgd2hpY2ggYXJlIHBpbm5pbmcgdmNwdXMgdGVt
cG9yYXJpbHkgdG8KYSBzaW5nbGUgcGh5c2ljYWwgY3B1OgoKLSB3YWl0X2V2ZW50KCkgaGFuZGxp
bmcKLSBTQ0hFRE9QX3Bpbl9vdmVycmlkZSBoYW5kbGluZwoKRWFjaCBvZiB0aG9zZSBjYXNlcyBh
cmUgaGFuZGxlZCBpbmRlcGVuZGVudGx5IHRvZGF5IHVzaW5nIHRoZWlyIG93bgp0ZW1wb3Jhcnkg
Y3B1bWFzayB0byBzYXZlIHRoZSBvbGQgYWZmaW5pdHkgc2V0dGluZ3MuCgpUaGUgdHdvIGNhc2Vz
IGNhbiBiZSBjb21iaW5lZCBhcyB0aGUgZmlyc3QgY2FzZSB3aWxsIG9ubHkgcGluIGEgdmNwdSB0
bwp0aGUgcGh5c2ljYWwgY3B1IGl0IGlzIGFscmVhZHkgcnVubmluZyBvbiwgd2hpbGUgU0NIRURP
UF9waW5fb3ZlcnJpZGUgaXMKYWxsb3dlZCB0byBmYWlsLgoKU28gbWVyZ2UgdGhlIHR3byB0ZW1w
b3JhcnkgcGlubmluZyBzY2VuYXJpb3MgYnkgb25seSB1c2luZyBvbmUgY3B1bWFzawphbmQgYSBw
ZXItdmNwdSBiaXRtYXNrIGZvciBzcGVjaWZ5aW5nIHdoaWNoIG9mIHRoZSBzY2VuYXJpb3MgaXMK
Y3VycmVudGx5IGFjdGl2ZSAodGhleSBhcmUgYm90aCBhbGxvd2VkIHRvIGJlIGFjdGl2ZSBmb3Ig
dGhlIHNhbWUgdmNwdSkuCgpOb3RlIHRoYXQgd2UgZG9uJ3QgbmVlZCB0byBjYWxsIGRvbWFpbl91
cGRhdGVfbm9kZV9hZmZpbml0eSgpIGFzIHdlCmFyZSBvbmx5IHBpbm5pbmcgZm9yIGEgYnJpZWYg
cGVyaW9kIG9mIHRpbWUuCgpTaWduZWQtb2ZmLWJ5OiBKdWVyZ2VuIEdyb3NzIDxqZ3Jvc3NAc3Vz
ZS5jb20+ClJldmlld2VkLWJ5OiBBbmRyZXcgQ29vcGVyIDxhbmRyZXcuY29vcGVyM0BjaXRyaXgu
Y29tPgotLS0KVjI6Ci0gcmVtb3ZlZCB0aGUgTk1JL01DRSBjYXNlCi0gcmVuYW1lIHZjcHVfc2V0
X3RtcF9hZmZpbml0eSgpIChKYW4gQmV1bGljaCkKLSByZW1vdmUgdmNwdV9waW5fb3ZlcnJpZGUo
KSB3cmFwcGVyIChBbmRyZXcgQ29vcGVyKQotIGN1cnJlbnQgLT4gY3VyciAoSmFuIEJldWxpY2gs
IEFuZHJldyBDb29wZXIpCi0gbWFrZSBjcHUgcGFyYW1ldGVyIHVuc2lnbmVkIGludCAoSmFuIEJl
dWxpY2gpCi0gYWRkIGNvbW1lbnQgKERhcmlvIEZhZ2dpb2xpKQoKVjM6Ci0gcmVqZWN0IFNDSEVE
T1BfcGluX292ZXJyaWRlIHdpdGggTlJfQ1BVUyAoSmFuIEJldWxpY2gpCi0tLQogeGVuL2NvbW1v
bi9kb21haW4uYyAgICAgfCAgMSArCiB4ZW4vY29tbW9uL2RvbWN0bC5jICAgICB8ICAyICstCiB4
ZW4vY29tbW9uL3NjaGVkdWxlLmMgICB8IDUwICsrKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrLS0tLS0tLS0tLS0tLS0KIHhlbi9jb21tb24vd2FpdC5jICAgICAgIHwgMzAgKysrKysr
KysrKy0tLS0tLS0tLS0tLS0tLS0tLS0KIHhlbi9pbmNsdWRlL3hlbi9zY2hlZC5oIHwgIDggKysr
KystLS0KIDUgZmlsZXMgY2hhbmdlZCwgNTMgaW5zZXJ0aW9ucygrKSwgMzggZGVsZXRpb25zKC0p
CgpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9kb21haW4uYyBiL3hlbi9jb21tb24vZG9tYWluLmMK
aW5kZXggYmM1NmE1MTgxNS4uZThlODUwNzk2ZSAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9kb21h
aW4uYworKysgYi94ZW4vY29tbW9uL2RvbWFpbi5jCkBAIC0xMjY3LDYgKzEyNjcsNyBAQCBpbnQg
dmNwdV9yZXNldChzdHJ1Y3QgdmNwdSAqdikKICAgICB2LT5hc3luY19leGNlcHRpb25fbWFzayA9
IDA7CiAgICAgbWVtc2V0KHYtPmFzeW5jX2V4Y2VwdGlvbl9zdGF0ZSwgMCwgc2l6ZW9mKHYtPmFz
eW5jX2V4Y2VwdGlvbl9zdGF0ZSkpOwogI2VuZGlmCisgICAgdi0+YWZmaW5pdHlfYnJva2VuID0g
MDsKICAgICBjbGVhcl9iaXQoX1ZQRl9ibG9ja2VkLCAmdi0+cGF1c2VfZmxhZ3MpOwogICAgIGNs
ZWFyX2JpdChfVlBGX2luX3Jlc2V0LCAmdi0+cGF1c2VfZmxhZ3MpOwogCmRpZmYgLS1naXQgYS94
ZW4vY29tbW9uL2RvbWN0bC5jIGIveGVuL2NvbW1vbi9kb21jdGwuYwppbmRleCA3MmE0NDk1M2Qw
Li5mYTI2MGNlNWZiIDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL2RvbWN0bC5jCisrKyBiL3hlbi9j
b21tb24vZG9tY3RsLmMKQEAgLTY1NCw3ICs2NTQsNyBAQCBsb25nIGRvX2RvbWN0bChYRU5fR1VF
U1RfSEFORExFX1BBUkFNKHhlbl9kb21jdGxfdCkgdV9kb21jdGwpCiAKICAgICAgICAgICAgIC8q
IFVuZG8gYSBzdHVjayBTQ0hFRF9waW5fb3ZlcnJpZGU/ICovCiAgICAgICAgICAgICBpZiAoIHZj
cHVhZmYtPmZsYWdzICYgWEVOX1ZDUFVBRkZJTklUWV9GT1JDRSApCi0gICAgICAgICAgICAgICAg
dmNwdV9waW5fb3ZlcnJpZGUodiwgLTEpOworICAgICAgICAgICAgICAgIHZjcHVfdGVtcG9yYXJ5
X2FmZmluaXR5KHYsIE5SX0NQVVMsIFZDUFVfQUZGSU5JVFlfT1ZFUlJJREUpOwogCiAgICAgICAg
ICAgICByZXQgPSAwOwogCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3NjaGVkdWxlLmMgYi94ZW4v
Y29tbW9uL3NjaGVkdWxlLmMKaW5kZXggMzQ5Zjk2MjRmNS4uMTMwYjk3ZDg3NSAxMDA2NDQKLS0t
IGEveGVuL2NvbW1vbi9zY2hlZHVsZS5jCisrKyBiL3hlbi9jb21tb24vc2NoZWR1bGUuYwpAQCAt
MTEwNiw0MyArMTEwNiw1OSBAQCB2b2lkIHdhdGNoZG9nX2RvbWFpbl9kZXN0cm95KHN0cnVjdCBk
b21haW4gKmQpCiAgICAgICAgIGtpbGxfdGltZXIoJmQtPndhdGNoZG9nX3RpbWVyW2ldKTsKIH0K
IAotaW50IHZjcHVfcGluX292ZXJyaWRlKHN0cnVjdCB2Y3B1ICp2LCBpbnQgY3B1KQorLyoKKyAq
IFBpbiBhIHZjcHUgdGVtcG9yYXJpbHkgdG8gYSBzcGVjaWZpYyBDUFUgKG9yIHJlc3RvcmUgb2xk
IHBpbm5pbmcgc3RhdGUgaWYKKyAqIGNwdSBpcyBOUl9DUFVTKS4KKyAqIFRlbXBvcmFyeSBwaW5u
aW5nIGNhbiBiZSBkb25lIGR1ZSB0byB0d28gcmVhc29ucywgd2hpY2ggbWF5IGJlIG5lc3RlZDoK
KyAqIC0gVkNQVV9BRkZJTklUWV9PVkVSUklERSAocmVxdWVzdGVkIGJ5IGd1ZXN0KTogaXMgYWxs
b3dlZCB0byBmYWlsIGluIGNhc2UKKyAqICAgb2YgYSBjb25mbGljdCAoZS5nLiBpbiBjYXNlIGNw
dXBvb2wgZG9lc24ndCBpbmNsdWRlIHJlcXVlc3RlZCBDUFUsIG9yCisgKiAgIGFub3RoZXIgY29u
ZmxpY3RpbmcgdGVtcG9yYXJ5IHBpbm5pbmcgaXMgYWxyZWFkeSBpbiBlZmZlY3QuCisgKiAtIFZD
UFVfQUZGSU5JVFlfV0FJVCAoY2FsbGVkIGJ5IHdhaXRfZXZlbnQoKSk6IG9ubHkgdXNlZCB0byBw
aW4gdmNwdSB0byB0aGUKKyAqICAgQ1BVIGl0IGlzIGp1c3QgcnVubmluZyBvbi4gQ2FuJ3QgZmFp
bCBpZiB1c2VkIHByb3Blcmx5LgorICovCitpbnQgdmNwdV90ZW1wb3JhcnlfYWZmaW5pdHkoc3Ry
dWN0IHZjcHUgKnYsIHVuc2lnbmVkIGludCBjcHUsIHVpbnQ4X3QgcmVhc29uKQogewogICAgIHNw
aW5sb2NrX3QgKmxvY2s7CiAgICAgaW50IHJldCA9IC1FSU5WQUw7CisgICAgYm9vbCBtaWdyYXRl
OwogCiAgICAgbG9jayA9IHZjcHVfc2NoZWR1bGVfbG9ja19pcnEodik7CiAKLSAgICBpZiAoIGNw
dSA8IDAgKQorICAgIGlmICggY3B1ID09IE5SX0NQVVMgKQogICAgIHsKLSAgICAgICAgaWYgKCB2
LT5hZmZpbml0eV9icm9rZW4gKQorICAgICAgICBpZiAoIHYtPmFmZmluaXR5X2Jyb2tlbiAmIHJl
YXNvbiApCiAgICAgICAgIHsKLSAgICAgICAgICAgIHNjaGVkX3NldF9hZmZpbml0eSh2LCB2LT5j
cHVfaGFyZF9hZmZpbml0eV9zYXZlZCwgTlVMTCk7Ci0gICAgICAgICAgICB2LT5hZmZpbml0eV9i
cm9rZW4gPSAwOwogICAgICAgICAgICAgcmV0ID0gMDsKKyAgICAgICAgICAgIHYtPmFmZmluaXR5
X2Jyb2tlbiAmPSB+cmVhc29uOwogICAgICAgICB9CisgICAgICAgIGlmICggIXJldCAmJiAhdi0+
YWZmaW5pdHlfYnJva2VuICkKKyAgICAgICAgICAgIHNjaGVkX3NldF9hZmZpbml0eSh2LCB2LT5j
cHVfaGFyZF9hZmZpbml0eV9zYXZlZCwgTlVMTCk7CiAgICAgfQogICAgIGVsc2UgaWYgKCBjcHUg
PCBucl9jcHVfaWRzICkKICAgICB7Ci0gICAgICAgIGlmICggdi0+YWZmaW5pdHlfYnJva2VuICkK
KyAgICAgICAgaWYgKCAodi0+YWZmaW5pdHlfYnJva2VuICYgcmVhc29uKSB8fAorICAgICAgICAg
ICAgICh2LT5hZmZpbml0eV9icm9rZW4gJiYgdi0+cHJvY2Vzc29yICE9IGNwdSkgKQogICAgICAg
ICAgICAgcmV0ID0gLUVCVVNZOwogICAgICAgICBlbHNlIGlmICggY3B1bWFza190ZXN0X2NwdShj
cHUsIFZDUFUyT05MSU5FKHYpKSApCiAgICAgICAgIHsKLSAgICAgICAgICAgIGNwdW1hc2tfY29w
eSh2LT5jcHVfaGFyZF9hZmZpbml0eV9zYXZlZCwgdi0+Y3B1X2hhcmRfYWZmaW5pdHkpOwotICAg
ICAgICAgICAgdi0+YWZmaW5pdHlfYnJva2VuID0gMTsKLSAgICAgICAgICAgIHNjaGVkX3NldF9h
ZmZpbml0eSh2LCBjcHVtYXNrX29mKGNwdSksIE5VTEwpOworICAgICAgICAgICAgaWYgKCAhdi0+
YWZmaW5pdHlfYnJva2VuICkKKyAgICAgICAgICAgIHsKKyAgICAgICAgICAgICAgICBjcHVtYXNr
X2NvcHkodi0+Y3B1X2hhcmRfYWZmaW5pdHlfc2F2ZWQsIHYtPmNwdV9oYXJkX2FmZmluaXR5KTsK
KyAgICAgICAgICAgICAgICBzY2hlZF9zZXRfYWZmaW5pdHkodiwgY3B1bWFza19vZihjcHUpLCBO
VUxMKTsKKyAgICAgICAgICAgIH0KKyAgICAgICAgICAgIHYtPmFmZmluaXR5X2Jyb2tlbiB8PSBy
ZWFzb247CiAgICAgICAgICAgICByZXQgPSAwOwogICAgICAgICB9CiAgICAgfQogCi0gICAgaWYg
KCByZXQgPT0gMCApCisgICAgbWlncmF0ZSA9ICFyZXQgJiYgIWNwdW1hc2tfdGVzdF9jcHUodi0+
cHJvY2Vzc29yLCB2LT5jcHVfaGFyZF9hZmZpbml0eSk7CisgICAgaWYgKCBtaWdyYXRlICkKICAg
ICAgICAgdmNwdV9taWdyYXRlX3N0YXJ0KHYpOwogCiAgICAgdmNwdV9zY2hlZHVsZV91bmxvY2tf
aXJxKGxvY2ssIHYpOwogCi0gICAgZG9tYWluX3VwZGF0ZV9ub2RlX2FmZmluaXR5KHYtPmRvbWFp
bik7Ci0KLSAgICB2Y3B1X21pZ3JhdGVfZmluaXNoKHYpOworICAgIGlmICggbWlncmF0ZSApCisg
ICAgICAgIHZjcHVfbWlncmF0ZV9maW5pc2godik7CiAKICAgICByZXR1cm4gcmV0OwogfQpAQCAt
MTI1OCw2ICsxMjc0LDcgQEAgcmV0X3QgZG9fc2NoZWRfb3AoaW50IGNtZCwgWEVOX0dVRVNUX0hB
TkRMRV9QQVJBTSh2b2lkKSBhcmcpCiAgICAgY2FzZSBTQ0hFRE9QX3Bpbl9vdmVycmlkZToKICAg
ICB7CiAgICAgICAgIHN0cnVjdCBzY2hlZF9waW5fb3ZlcnJpZGUgc2NoZWRfcGluX292ZXJyaWRl
OworICAgICAgICB1bnNpZ25lZCBpbnQgY3B1OwogCiAgICAgICAgIHJldCA9IC1FUEVSTTsKICAg
ICAgICAgaWYgKCAhaXNfaGFyZHdhcmVfZG9tYWluKGN1cnJlbnQtPmRvbWFpbikgKQpAQCAtMTI2
Nyw3ICsxMjg0LDEyIEBAIHJldF90IGRvX3NjaGVkX29wKGludCBjbWQsIFhFTl9HVUVTVF9IQU5E
TEVfUEFSQU0odm9pZCkgYXJnKQogICAgICAgICBpZiAoIGNvcHlfZnJvbV9ndWVzdCgmc2NoZWRf
cGluX292ZXJyaWRlLCBhcmcsIDEpICkKICAgICAgICAgICAgIGJyZWFrOwogCi0gICAgICAgIHJl
dCA9IHZjcHVfcGluX292ZXJyaWRlKGN1cnJlbnQsIHNjaGVkX3Bpbl9vdmVycmlkZS5wY3B1KTsK
KyAgICAgICAgcmV0ID0gLUVJTlZBTDsKKyAgICAgICAgaWYgKCBzY2hlZF9waW5fb3ZlcnJpZGUu
cGNwdSA+PSBOUl9DUFVTICkKKyAgICAgICAgICAgYnJlYWs7CisKKyAgICAgICAgY3B1ID0gc2No
ZWRfcGluX292ZXJyaWRlLnBjcHUgPCAwID8gTlJfQ1BVUyA6IHNjaGVkX3Bpbl9vdmVycmlkZS5w
Y3B1OworICAgICAgICByZXQgPSB2Y3B1X3RlbXBvcmFyeV9hZmZpbml0eShjdXJyZW50LCBjcHUs
IFZDUFVfQUZGSU5JVFlfT1ZFUlJJREUpOwogCiAgICAgICAgIGJyZWFrOwogICAgIH0KZGlmZiAt
LWdpdCBhL3hlbi9jb21tb24vd2FpdC5jIGIveGVuL2NvbW1vbi93YWl0LmMKaW5kZXggNGY4MzBh
MTRlOC4uM2ZjNWY2ODYxMSAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi93YWl0LmMKKysrIGIveGVu
L2NvbW1vbi93YWl0LmMKQEAgLTM0LDggKzM0LDYgQEAgc3RydWN0IHdhaXRxdWV1ZV92Y3B1IHsK
ICAgICAgKi8KICAgICB2b2lkICplc3A7CiAgICAgY2hhciAqc3RhY2s7Ci0gICAgY3B1bWFza190
IHNhdmVkX2FmZmluaXR5OwotICAgIHVuc2lnbmVkIGludCB3YWtldXBfY3B1OwogI2VuZGlmCiB9
OwogCkBAIC0xMzEsMTIgKzEyOSwxMCBAQCBzdGF0aWMgdm9pZCBfX3ByZXBhcmVfdG9fd2FpdChz
dHJ1Y3Qgd2FpdHF1ZXVlX3ZjcHUgKndxdikKICAgICBBU1NFUlQod3F2LT5lc3AgPT0gMCk7CiAK
ICAgICAvKiBTYXZlIGN1cnJlbnQgVkNQVSBhZmZpbml0eTsgZm9yY2Ugd2FrZXVwIG9uICp0aGlz
KiBDUFUgb25seS4gKi8KLSAgICB3cXYtPndha2V1cF9jcHUgPSBzbXBfcHJvY2Vzc29yX2lkKCk7
Ci0gICAgY3B1bWFza19jb3B5KCZ3cXYtPnNhdmVkX2FmZmluaXR5LCBjdXJyLT5jcHVfaGFyZF9h
ZmZpbml0eSk7Ci0gICAgaWYgKCB2Y3B1X3NldF9oYXJkX2FmZmluaXR5KGN1cnIsIGNwdW1hc2tf
b2Yod3F2LT53YWtldXBfY3B1KSkgKQorICAgIGlmICggdmNwdV90ZW1wb3JhcnlfYWZmaW5pdHko
Y3Vyciwgc21wX3Byb2Nlc3Nvcl9pZCgpLCBWQ1BVX0FGRklOSVRZX1dBSVQpICkKICAgICB7CiAg
ICAgICAgIGdkcHJpbnRrKFhFTkxPR19FUlIsICJVbmFibGUgdG8gc2V0IHZjcHUgYWZmaW5pdHlc
biIpOwotICAgICAgICBkb21haW5fY3Jhc2goY3VycmVudC0+ZG9tYWluKTsKKyAgICAgICAgZG9t
YWluX2NyYXNoKGN1cnItPmRvbWFpbik7CiAKICAgICAgICAgZm9yICggOyA7ICkKICAgICAgICAg
ICAgIGRvX3NvZnRpcnEoKTsKQEAgLTE3MCw3ICsxNjYsNyBAQCBzdGF0aWMgdm9pZCBfX3ByZXBh
cmVfdG9fd2FpdChzdHJ1Y3Qgd2FpdHF1ZXVlX3ZjcHUgKndxdikKICAgICBpZiAoIHVubGlrZWx5
KHdxdi0+ZXNwID09IDApICkKICAgICB7CiAgICAgICAgIGdkcHJpbnRrKFhFTkxPR19FUlIsICJT
dGFjayB0b28gbGFyZ2UgaW4gJXNcbiIsIF9fZnVuY19fKTsKLSAgICAgICAgZG9tYWluX2NyYXNo
KGN1cnJlbnQtPmRvbWFpbik7CisgICAgICAgIGRvbWFpbl9jcmFzaChjdXJyLT5kb21haW4pOwog
CiAgICAgICAgIGZvciAoIDsgOyApCiAgICAgICAgICAgICBkb19zb2Z0aXJxKCk7CkBAIC0xODIs
MzAgKzE3OCwyNCBAQCBzdGF0aWMgdm9pZCBfX3ByZXBhcmVfdG9fd2FpdChzdHJ1Y3Qgd2FpdHF1
ZXVlX3ZjcHUgKndxdikKIHN0YXRpYyB2b2lkIF9fZmluaXNoX3dhaXQoc3RydWN0IHdhaXRxdWV1
ZV92Y3B1ICp3cXYpCiB7CiAgICAgd3F2LT5lc3AgPSBOVUxMOwotICAgICh2b2lkKXZjcHVfc2V0
X2hhcmRfYWZmaW5pdHkoY3VycmVudCwgJndxdi0+c2F2ZWRfYWZmaW5pdHkpOworICAgIHZjcHVf
dGVtcG9yYXJ5X2FmZmluaXR5KGN1cnJlbnQsIE5SX0NQVVMsIFZDUFVfQUZGSU5JVFlfV0FJVCk7
CiB9CiAKIHZvaWQgY2hlY2tfd2FrZXVwX2Zyb21fd2FpdCh2b2lkKQogewotICAgIHN0cnVjdCB3
YWl0cXVldWVfdmNwdSAqd3F2ID0gY3VycmVudC0+d2FpdHF1ZXVlX3ZjcHU7CisgICAgc3RydWN0
IHZjcHUgKmN1cnIgPSBjdXJyZW50OworICAgIHN0cnVjdCB3YWl0cXVldWVfdmNwdSAqd3F2ID0g
Y3Vyci0+d2FpdHF1ZXVlX3ZjcHU7CiAKICAgICBBU1NFUlQobGlzdF9lbXB0eSgmd3F2LT5saXN0
KSk7CiAKICAgICBpZiAoIGxpa2VseSh3cXYtPmVzcCA9PSBOVUxMKSApCiAgICAgICAgIHJldHVy
bjsKIAotICAgIC8qIENoZWNrIGlmIHdlIHdva2UgdXAgb24gdGhlIHdyb25nIENQVS4gKi8KLSAg
ICBpZiAoIHVubGlrZWx5KHNtcF9wcm9jZXNzb3JfaWQoKSAhPSB3cXYtPndha2V1cF9jcHUpICkK
KyAgICAvKiBDaGVjayBpZiB3ZSBhcmUgc3RpbGwgcGlubmVkLiAqLworICAgIGlmICggdW5saWtl
bHkoIShjdXJyLT5hZmZpbml0eV9icm9rZW4gJiBWQ1BVX0FGRklOSVRZX1dBSVQpKSApCiAgICAg
ewotICAgICAgICAvKiBSZS1zZXQgVkNQVSBhZmZpbml0eSBhbmQgcmUtZW50ZXIgdGhlIHNjaGVk
dWxlci4gKi8KLSAgICAgICAgc3RydWN0IHZjcHUgKmN1cnIgPSBjdXJyZW50OwotICAgICAgICBj
cHVtYXNrX2NvcHkoJndxdi0+c2F2ZWRfYWZmaW5pdHksIGN1cnItPmNwdV9oYXJkX2FmZmluaXR5
KTsKLSAgICAgICAgaWYgKCB2Y3B1X3NldF9oYXJkX2FmZmluaXR5KGN1cnIsIGNwdW1hc2tfb2Yo
d3F2LT53YWtldXBfY3B1KSkgKQotICAgICAgICB7Ci0gICAgICAgICAgICBnZHByaW50ayhYRU5M
T0dfRVJSLCAiVW5hYmxlIHRvIHNldCB2Y3B1IGFmZmluaXR5XG4iKTsKLSAgICAgICAgICAgIGRv
bWFpbl9jcmFzaChjdXJyZW50LT5kb21haW4pOwotICAgICAgICB9Ci0gICAgICAgIHdhaXQoKTsg
LyogdGFrZXMgdXMgYmFjayBpbnRvIHRoZSBzY2hlZHVsZXIgKi8KKyAgICAgICAgZ2RwcmludGso
WEVOTE9HX0VSUiwgInZjcHUgYWZmaW5pdHkgbG9zdFxuIik7CisgICAgICAgIGRvbWFpbl9jcmFz
aChjdXJyLT5kb21haW4pOwogICAgIH0KIAogICAgIC8qCmRpZmYgLS1naXQgYS94ZW4vaW5jbHVk
ZS94ZW4vc2NoZWQuaCBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCmluZGV4IGMxOTdlOTNkNzMu
Ljk1Nzg2MjhjNmEgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCisrKyBiL3hl
bi9pbmNsdWRlL3hlbi9zY2hlZC5oCkBAIC0yMDAsNyArMjAwLDkgQEAgc3RydWN0IHZjcHUKICAg
ICAvKiBWQ1BVIGlzIHBhdXNlZCBmb2xsb3dpbmcgc2h1dGRvd24gcmVxdWVzdCAoZC0+aXNfc2h1
dHRpbmdfZG93bik/ICovCiAgICAgYm9vbCAgICAgICAgICAgICBwYXVzZWRfZm9yX3NodXRkb3du
OwogICAgIC8qIFZDUFUgbmVlZCBhZmZpbml0eSByZXN0b3JlZCAqLwotICAgIGJvb2wgICAgICAg
ICAgICAgYWZmaW5pdHlfYnJva2VuOworICAgIHVpbnQ4X3QgICAgICAgICAgYWZmaW5pdHlfYnJv
a2VuOworI2RlZmluZSBWQ1BVX0FGRklOSVRZX09WRVJSSURFICAgIDB4MDEKKyNkZWZpbmUgVkNQ
VV9BRkZJTklUWV9XQUlUICAgICAgICAweDAyCiAKICAgICAvKiBBIGh5cGVyY2FsbCBoYXMgYmVl
biBwcmVlbXB0ZWQuICovCiAgICAgYm9vbCAgICAgICAgICAgICBoY2FsbF9wcmVlbXB0ZWQ7CkBA
IC0yNDUsNyArMjQ3LDcgQEAgc3RydWN0IHZjcHUKIAogICAgIC8qIEJpdG1hc2sgb2YgQ1BVcyBv
biB3aGljaCB0aGlzIFZDUFUgbWF5IHJ1bi4gKi8KICAgICBjcHVtYXNrX3Zhcl90ICAgIGNwdV9o
YXJkX2FmZmluaXR5OwotICAgIC8qIFVzZWQgdG8gcmVzdG9yZSBhZmZpbml0eSBhY3Jvc3MgUzMu
ICovCisgICAgLyogVXNlZCB0byBzYXZlIGFmZmluaXR5IGR1cmluZyB0ZW1wb3JhcnkgcGlubmlu
Zy4gKi8KICAgICBjcHVtYXNrX3Zhcl90ICAgIGNwdV9oYXJkX2FmZmluaXR5X3NhdmVkOwogCiAg
ICAgLyogQml0bWFzayBvZiBDUFVzIG9uIHdoaWNoIHRoaXMgVkNQVSBwcmVmZXJzIHRvIHJ1bi4g
Ki8KQEAgLTg3MywxMCArODc1LDEwIEBAIGludCBjcHVfZGlzYWJsZV9zY2hlZHVsZXIodW5zaWdu
ZWQgaW50IGNwdSk7CiAvKiBXZSBuZWVkIGl0IGluIGRvbTBfc2V0dXBfdmNwdSAqLwogdm9pZCBz
Y2hlZF9zZXRfYWZmaW5pdHkoc3RydWN0IHZjcHUgKnYsIGNvbnN0IGNwdW1hc2tfdCAqaGFyZCwK
ICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNwdW1hc2tfdCAqc29mdCk7CitpbnQgdmNw
dV90ZW1wb3JhcnlfYWZmaW5pdHkoc3RydWN0IHZjcHUgKnYsIHVuc2lnbmVkIGludCBjcHUsIHVp
bnQ4X3QgcmVhc29uKTsKIGludCB2Y3B1X3NldF9oYXJkX2FmZmluaXR5KHN0cnVjdCB2Y3B1ICp2
LCBjb25zdCBjcHVtYXNrX3QgKmFmZmluaXR5KTsKIGludCB2Y3B1X3NldF9zb2Z0X2FmZmluaXR5
KHN0cnVjdCB2Y3B1ICp2LCBjb25zdCBjcHVtYXNrX3QgKmFmZmluaXR5KTsKIHZvaWQgcmVzdG9y
ZV92Y3B1X2FmZmluaXR5KHN0cnVjdCBkb21haW4gKmQpOwotaW50IHZjcHVfcGluX292ZXJyaWRl
KHN0cnVjdCB2Y3B1ICp2LCBpbnQgY3B1KTsKIAogdm9pZCB2Y3B1X3J1bnN0YXRlX2dldChzdHJ1
Y3QgdmNwdSAqdiwgc3RydWN0IHZjcHVfcnVuc3RhdGVfaW5mbyAqcnVuc3RhdGUpOwogdWludDY0
X3QgZ2V0X2NwdV9pZGxlX3RpbWUodW5zaWduZWQgaW50IGNwdSk7Ci0tIAoyLjE2LjQKCgpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFp
bGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhl
bnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

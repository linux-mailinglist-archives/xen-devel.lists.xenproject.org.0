Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 371B9A32AB
	for <lists+xen-devel@lfdr.de>; Fri, 30 Aug 2019 10:33:20 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i3cIX-0006aU-Hd; Fri, 30 Aug 2019 08:30:21 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=0MMg=W2=citrix.com=paul.durrant@srs-us1.protection.inumbo.net>)
 id 1i3cIV-0006Zb-Fu
 for xen-devel@lists.xenproject.org; Fri, 30 Aug 2019 08:30:19 +0000
X-Inumbo-ID: 5bf74cea-cb00-11e9-951b-bc764e2007e4
Received: from esa2.hc3370-68.iphmx.com (unknown [216.71.145.153])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 5bf74cea-cb00-11e9-951b-bc764e2007e4;
 Fri, 30 Aug 2019 08:30:02 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1567153803;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=f7wJFxu5nvTpqnzRaXipM78gD3N1KaYbdOsNbxW97ic=;
 b=HYSWoUuEGWgB+lIrO5XhFM5VdHghd4tyNpnsLic8h8bafuDqLLPBmN5U
 UpfSotPKj0+jzSFVQHpH5ATWoEqW4MUAz3aG/LETZqsvff9af2epVHLV1
 uW3CBCyB+3sBrtfdrcqAkUL1R4N7R2kr+YJ4OPATNNfQWBYz3tJjfVIwL w=;
Authentication-Results: esa2.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=paul.durrant@citrix.com;
 spf=Pass smtp.mailfrom=Paul.Durrant@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa2.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 paul.durrant@citrix.com) identity=pra;
 client-ip=162.221.158.21; receiver=esa2.hc3370-68.iphmx.com;
 envelope-from="Paul.Durrant@citrix.com";
 x-sender="paul.durrant@citrix.com"; x-conformance=sidf_compatible
Received-SPF: Pass (esa2.hc3370-68.iphmx.com: domain of
 Paul.Durrant@citrix.com designates 162.221.158.21 as
 permitted sender) identity=mailfrom;
 client-ip=162.221.158.21; receiver=esa2.hc3370-68.iphmx.com;
 envelope-from="Paul.Durrant@citrix.com";
 x-sender="Paul.Durrant@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83 ~all"
Received-SPF: None (esa2.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa2.hc3370-68.iphmx.com;
 envelope-from="Paul.Durrant@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: EQ9EdXgetcJZg2oQjURojtCKNs5CegCKQ2caHe+b1JUzBDjyNRAz8IVh+cryFWO3tdX7HUpsq7
 opcOZolZoHNlqdpuLRmb5VfzfLkSwklx3QfGADnpX3k1cu2vooDTjMHb581+j+SNQIWwLlsg/A
 0JrVM9tyFytijV5L1EQ/1qFSvBa8GsacKOAeqCucKv6sYNAgOl3iJBdL/YG909w02X5RHedFQM
 BOG7yD3siROKnCFwP+3qRvmD+gQhUtGedznj05JtuyPrkEA6RYJcgRjxOlAwLmSMf34cRatixx
 PfU=
X-SBRS: 2.7
X-MesageID: 4925074
X-Ironport-Server: esa2.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.64,446,1559534400"; 
   d="scan'208";a="4925074"
From: Paul Durrant <paul.durrant@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Fri, 30 Aug 2019 09:29:50 +0100
Message-ID: <20190830082953.2192-4-paul.durrant@citrix.com>
X-Mailer: git-send-email 2.20.1.2.gb21ebb671
In-Reply-To: <20190830082953.2192-1-paul.durrant@citrix.com>
References: <20190830082953.2192-1-paul.durrant@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v7 3/6] use is_iommu_enabled() where
 appropriate...
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Kevin Tian <kevin.tian@intel.com>,
 Stefano Stabellini <sstabellini@kernel.org>,
 Jun Nakajima <jun.nakajima@intel.com>, Wei Liu <wl@xen.org>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>, Julien
 Grall <julien.grall@arm.com>, Paul Durrant <paul.durrant@citrix.com>,
 Jan Beulich <jbeulich@suse.com>, Daniel De Graaf <dgdegra@tycho.nsa.gov>,
 Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>,
 Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

Li4ucmF0aGVyIHRoYW4gdGVzdGluZyB0aGUgZ2xvYmFsIGlvbW11X2VuYWJsZWQgZmxhZyBhbmQg
b3BzIHBvaW50ZXIuCgpOb3cgdGhhdCB0aGVyZSBpcyBhIHBlci1kb21haW4gZmxhZyBpbmRpY2F0
aW5nIHdoZXRoZXIgdGhlIGRvbWFpbiBpcwpwZXJtaXR0ZWQgdG8gdXNlIHRoZSBJT01NVSAod2hp
Y2ggZGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBvcHMgcG9pbnRlciB3aWxsCmJlIHNldCksIG1hbnkg
dGVzdHMgb2YgdGhlIGdsb2JhbCBpb21tdV9lbmFibGVkIGZsYWcgYW5kIG9wcyBwb2ludGVyIGNh
bgpiZSB0cmFuc2xhdGVkIGludG8gdGVzdHMgb2YgdGhlIHBlci1kb21haW4gZmxhZy4gU29tZSBv
ZiB0aGUgb3RoZXIgdGVzdHMgb2YKcHVyZWx5IHRoZSBnbG9iYWwgaW9tbXVfZW5hYmxlZCBmbGFn
IGNhbiBhbHNvIGJlIHRyYW5zbGF0ZWQgaW50byB0ZXN0cyBvZgp0aGUgcGVyLWRvbWFpbiBmbGFn
LgoKTk9URTogVGhlIGNvbW1lbnQgaW4gaW9tbXVfc2hhcmVfcDJtX3RhYmxlKCkgaXMgYWxzbyBm
aXhlZDsgbmVlZF9pb21tdSgpCiAgICAgIGRpc2FwcGVhcmVkIHNvbWUgdGltZSBhZ28uIEFsc28s
IHdoaWxzdCB0aGUgc3R5bGUgb2YgdGhlICdpZicgaW4KICAgICAgZmxhc2tfaW9tbXVfcmVzb3Vy
Y2VfdXNlX3Blcm0oKSBpcyBmaXhlZCwgSSBoYXZlIG5vdCB0cmFuc2xhdGVkIGFueQogICAgICBp
bnN0YW5jZXMgb2YgdTMyIGludG8gdWludDMyX3QgdG8ga2VlcCBjb25zaXN0ZW5jeS4gSU1PIHN1
Y2ggYQogICAgICB0cmFuc2xhdGlvbiB3b3VsZCBiZSBiZXR0ZXIgZG9uZSBnbG9iYWxseSBmb3Ig
dGhlIHNvdXJjZSBtb2R1bGUgaW4KICAgICAgYSBzZXBhcmF0ZSBwYXRjaC4KICAgICAgVGhlIGNo
YW5nZSB0byB0aGUgZGVmaW5pdGlvbiBvZiBpb21tdV9jYWxsKCkgaXMgdG8ga2VlcCB0aGUgUFYg
c2hpbQogICAgICBidWlsZCBoYXBweS4gV2l0aG91dCB0aGlzIGNoYW5nZSBpdCB3aWxsIGZhaWwg
dG8gY29tcGlsZSB3aXRoIGVycm9ycwogICAgICBvZiB0aGUgZm9ybToKCmlvbW11LmM6MzYxOjMy
OiBlcnJvcjogdW51c2VkIHZhcmlhYmxlIOKAmGhk4oCZIFstV2Vycm9yPXVudXNlZC12YXJpYWJs
ZV0KICAgICBjb25zdCBzdHJ1Y3QgZG9tYWluX2lvbW11ICpoZCA9IGRvbV9pb21tdShkKTsKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF5+CgpTaWduZWQtb2ZmLWJ5OiBQYXVs
IER1cnJhbnQgPHBhdWwuZHVycmFudEBjaXRyaXguY29tPgpSZXZpZXdlZC1ieTogIlJvZ2VyIFBh
dSBNb25uw6kiIDxyb2dlci5wYXVAY2l0cml4LmNvbT4KUmV2aWV3ZWQtYnk6IEtldmluIFRpYW4g
PGtldmluLnRpYW5AaW50ZWwuY29tPgpBY2tlZC1ieTogRGFuaWVsIERlIEdyYWFmIDxkZ2RlZ3Jh
QHR5Y2hvLm5zYS5nb3Y+ClJldmlld2VkLWJ5OiBKYW4gQmV1bGljaCA8amJldWxpY2hAc3VzZS5j
b20+Ci0tLQpDYzogU3RlZmFubyBTdGFiZWxsaW5pIDxzc3RhYmVsbGluaUBrZXJuZWwub3JnPgpD
YzogSnVsaWVuIEdyYWxsIDxqdWxpZW4uZ3JhbGxAYXJtLmNvbT4KQ2M6IFZvbG9keW15ciBCYWJj
aHVrIDxWb2xvZHlteXJfQmFiY2h1a0BlcGFtLmNvbT4KQ2M6IEFuZHJldyBDb29wZXIgPGFuZHJl
dy5jb29wZXIzQGNpdHJpeC5jb20+CkNjOiBXZWkgTGl1IDx3bEB4ZW4ub3JnPgpDYzogSnVuIE5h
a2FqaW1hIDxqdW4ubmFrYWppbWFAaW50ZWwuY29tPgpDYzogR2VvcmdlIER1bmxhcCA8Z2Vvcmdl
LmR1bmxhcEBldS5jaXRyaXguY29tPgpDYzogU3VyYXZlZSBTdXRoaWt1bHBhbml0IDxzdXJhdmVl
LnN1dGhpa3VscGFuaXRAYW1kLmNvbT4KClByZXZpb3VzbHkgcGFydCBvZiBzZXJpZXMgaHR0cHM6
Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9hcmNoaXZlcy9odG1sL3hlbi1kZXZlbC8yMDE5LTA3L21z
ZzAyMjY3Lmh0bWwKCnY3OgogLSBGaXggaW9tbXVfY2FsbCgpIHJhdGhlciB0aGFuIG1lc3Npbmcg
d2l0aCB0aGUgaW5pdGlhbGl6dGlvbiBvZiAnaGQnCiAtIENvbnN0aWZ5IGRvbWFpbiBwb2ludGVy
IHBhc3NlZCB0byBmbGFza19pb21tdV9yZXNvdXJjZV91c2VfcGVybSgpCgp2NToKIC0gRml4IGxv
Z2ljIGluIEFSTSBwMm1faW5pdCgpCiAtIE1ha2UgaW9tbXVfZG9fZG9tY3RsKCkgcmV0dXJuIC1F
T1BOT1RTVVBQIHJhdGhlciB0aGFuIC1FTk9TWVMgaWYgdGhlCiAgIElPTU1VIGlzIG5vdCBlbmFi
bGVkCiAtIEZpeCB0ZXN0IGluIHBjaV9lbmFibGVfYWNzKCkKIC0gRml4IHRlc3QgaW4gZmxhc2tf
aW9tbXVfcmVzb3VyY2VfdXNlX3Blcm0oKQotLS0KIHhlbi9hcmNoL2FybS9wMm0uYyAgICAgICAg
ICAgICAgICAgICAgICAgIHwgIDIgKy0KIHhlbi9hcmNoL3g4Ni9kb20wX2J1aWxkLmMgICAgICAg
ICAgICAgICAgIHwgIDIgKy0KIHhlbi9hcmNoL3g4Ni9kb21jdGwuYyAgICAgICAgICAgICAgICAg
ICAgIHwgIDQgKy0tCiB4ZW4vYXJjaC94ODYvaHZtL2h2bS5jICAgICAgICAgICAgICAgICAgICB8
ICA2ICsrLS0tCiB4ZW4vYXJjaC94ODYvaHZtL3Zpb2FwaWMuYyAgICAgICAgICAgICAgICB8ICAy
ICstCiB4ZW4vYXJjaC94ODYvaHZtL3ZteC92bWNzLmMgICAgICAgICAgICAgICB8ICAyICstCiB4
ZW4vYXJjaC94ODYvaHZtL3ZteC92bXguYyAgICAgICAgICAgICAgICB8ICAyICstCiB4ZW4vYXJj
aC94ODYvbW0vcDJtLWVwdC5jICAgICAgICAgICAgICAgICB8ICA0ICstLQogeGVuL2RyaXZlcnMv
cGFzc3Rocm91Z2gvYW1kL2lvbW11X2d1ZXN0LmMgfCAgMiArLQogeGVuL2RyaXZlcnMvcGFzc3Ro
cm91Z2gvZGV2aWNlX3RyZWUuYyAgICAgfCAgNCArLS0KIHhlbi9kcml2ZXJzL3Bhc3N0aHJvdWdo
L2lvLmMgICAgICAgICAgICAgIHwgIDggKysrLS0tCiB4ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9p
b21tdS5jICAgICAgICAgICB8IDMxICsrKysrKysrKystLS0tLS0tLS0tLS0tCiB4ZW4vZHJpdmVy
cy9wYXNzdGhyb3VnaC9wY2kuYyAgICAgICAgICAgICB8IDE2ICsrKysrKy0tLS0tLQogeGVuL2Ry
aXZlcnMvcGFzc3Rocm91Z2gvdnRkL2lvbW11LmMgICAgICAgfCAgMiArLQogeGVuL2RyaXZlcnMv
cGFzc3Rocm91Z2gvdnRkL3g4Ni9odm0uYyAgICAgfCAgMiArLQogeGVuL2RyaXZlcnMvcGFzc3Ro
cm91Z2gveDg2L2lvbW11LmMgICAgICAgfCAgMiArLQogeGVuL2luY2x1ZGUvYXNtLXg4Ni9pb21t
dS5oICAgICAgICAgICAgICAgfCAxMyArKysrKysrKy0tCiB4ZW4veHNtL2ZsYXNrL2hvb2tzLmMg
ICAgICAgICAgICAgICAgICAgICB8IDE4ICsrKysrKy0tLS0tLS0KIDE4IGZpbGVzIGNoYW5nZWQs
IDY0IGluc2VydGlvbnMoKyksIDU4IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3hlbi9hcmNo
L2FybS9wMm0uYyBiL3hlbi9hcmNoL2FybS9wMm0uYwppbmRleCBlMjhlYTFjODVhLi43ZjE0NDI5
MzJhIDEwMDY0NAotLS0gYS94ZW4vYXJjaC9hcm0vcDJtLmMKKysrIGIveGVuL2FyY2gvYXJtL3Ay
bS5jCkBAIC0xNTMxLDcgKzE1MzEsNyBAQCBpbnQgcDJtX2luaXQoc3RydWN0IGRvbWFpbiAqZCkK
ICAgICAgKiBzaGFyZWQgd2l0aCB0aGUgQ1BVLCBYZW4gaGFzIHRvIG1ha2Ugc3VyZSB0aGF0IHRo
ZSBQVCBjaGFuZ2VzIGhhdmUKICAgICAgKiByZWFjaGVkIHRoZSBtZW1vcnkKICAgICAgKi8KLSAg
ICBwMm0tPmNsZWFuX3B0ZSA9IGlvbW11X2VuYWJsZWQgJiYKKyAgICBwMm0tPmNsZWFuX3B0ZSA9
IGlzX2lvbW11X2VuYWJsZWQoZCkgJiYKICAgICAgICAgIWlvbW11X2hhc19mZWF0dXJlKGQsIElP
TU1VX0ZFQVRfQ09IRVJFTlRfV0FMSyk7CiAKICAgICByYyA9IHAybV9hbGxvY190YWJsZShkKTsK
ZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9kb20wX2J1aWxkLmMgYi94ZW4vYXJjaC94ODYvZG9t
MF9idWlsZC5jCmluZGV4IGM2OTU3MDkyMGMuLmQzODE3ODRlZGQgMTAwNjQ0Ci0tLSBhL3hlbi9h
cmNoL3g4Ni9kb20wX2J1aWxkLmMKKysrIGIveGVuL2FyY2gveDg2L2RvbTBfYnVpbGQuYwpAQCAt
MzU2LDcgKzM1Niw3IEBAIHVuc2lnbmVkIGxvbmcgX19pbml0IGRvbTBfY29tcHV0ZV9ucl9wYWdl
cygKICAgICAgICAgYXZhaWwgLT0gZC0+bWF4X3ZjcHVzIC0gMTsKIAogICAgIC8qIFJlc2VydmUg
bWVtb3J5IGZvciBpb21tdV9kb20wX2luaXQoKSAocm91Z2ggZXN0aW1hdGUpLiAqLwotICAgIGlm
ICggaW9tbXVfZW5hYmxlZCApCisgICAgaWYgKCBpc19pb21tdV9lbmFibGVkKGQpICkKICAgICB7
CiAgICAgICAgIHVuc2lnbmVkIGludCBzOwogCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvZG9t
Y3RsLmMgYi94ZW4vYXJjaC94ODYvZG9tY3RsLmMKaW5kZXggMWU5OGZjODAwOS4uYzRjYjAwYmNm
MCAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L2RvbWN0bC5jCisrKyBiL3hlbi9hcmNoL3g4Ni9k
b21jdGwuYwpAQCAtNzAzLDcgKzcwMyw3IEBAIGxvbmcgYXJjaF9kb19kb21jdGwoCiAgICAgICAg
ICAgICBicmVhazsKIAogICAgICAgICByZXQgPSAtRVNSQ0g7Ci0gICAgICAgIGlmICggaW9tbXVf
ZW5hYmxlZCApCisgICAgICAgIGlmICggaXNfaW9tbXVfZW5hYmxlZChkKSApCiAgICAgICAgIHsK
ICAgICAgICAgICAgIHBjaWRldnNfbG9jaygpOwogICAgICAgICAgICAgcmV0ID0gcHRfaXJxX2Ny
ZWF0ZV9iaW5kKGQsIGJpbmQpOwpAQCAtNzMyLDcgKzczMiw3IEBAIGxvbmcgYXJjaF9kb19kb21j
dGwoCiAgICAgICAgIGlmICggcmV0ICkKICAgICAgICAgICAgIGJyZWFrOwogCi0gICAgICAgIGlm
ICggaW9tbXVfZW5hYmxlZCApCisgICAgICAgIGlmICggaXNfaW9tbXVfZW5hYmxlZChkKSApCiAg
ICAgICAgIHsKICAgICAgICAgICAgIHBjaWRldnNfbG9jaygpOwogICAgICAgICAgICAgcmV0ID0g
cHRfaXJxX2Rlc3Ryb3lfYmluZChkLCBiaW5kKTsKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9o
dm0vaHZtLmMgYi94ZW4vYXJjaC94ODYvaHZtL2h2bS5jCmluZGV4IDAyOWVlYTNiODUuLjE3MmM4
NjBhY2MgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9odm0vaHZtLmMKKysrIGIveGVuL2FyY2gv
eDg2L2h2bS9odm0uYwpAQCAtNDY1LDcgKzQ2NSw3IEBAIHZvaWQgaHZtX21pZ3JhdGVfdGltZXJz
KHN0cnVjdCB2Y3B1ICp2KQogCiB2b2lkIGh2bV9taWdyYXRlX3BpcnEoc3RydWN0IGh2bV9waXJx
X2RwY2kgKnBpcnFfZHBjaSwgY29uc3Qgc3RydWN0IHZjcHUgKnYpCiB7Ci0gICAgQVNTRVJUKGlv
bW11X2VuYWJsZWQgJiYKKyAgICBBU1NFUlQoaXNfaW9tbXVfZW5hYmxlZCh2LT5kb21haW4pICYm
CiAgICAgICAgICAgIChpc19oYXJkd2FyZV9kb21haW4odi0+ZG9tYWluKSB8fCBodm1fZG9tYWlu
X2lycSh2LT5kb21haW4pLT5kcGNpKSk7CiAKICAgICBpZiAoIChwaXJxX2RwY2ktPmZsYWdzICYg
SFZNX0lSUV9EUENJX01BQ0hfTVNJKSAmJgpAQCAtNDk2LDcgKzQ5Niw3IEBAIHZvaWQgaHZtX21p
Z3JhdGVfcGlycXMoc3RydWN0IHZjcHUgKnYpCiB7CiAgICAgc3RydWN0IGRvbWFpbiAqZCA9IHYt
PmRvbWFpbjsKIAotICAgIGlmICggIWlvbW11X2VuYWJsZWQgfHwgIWh2bV9kb21haW5faXJxKGQp
LT5kcGNpICkKKyAgICBpZiAoICFpc19pb21tdV9lbmFibGVkKGQpIHx8ICFodm1fZG9tYWluX2ly
cShkKS0+ZHBjaSApCiAgICAgICAgcmV0dXJuOwogCiAgICAgc3Bpbl9sb2NrKCZkLT5ldmVudF9s
b2NrKTsKQEAgLTIyNjQsNyArMjI2NCw3IEBAIGludCBodm1fc2V0X2NyMCh1bnNpZ25lZCBsb25n
IHZhbHVlLCBib29sIG1heV9kZWZlcikKICAgICB9CiAKICAgICBpZiAoICgodmFsdWUgXiBvbGRf
dmFsdWUpICYgWDg2X0NSMF9DRCkgJiYKLSAgICAgICAgIGlvbW11X2VuYWJsZWQgJiYgaHZtX2Z1
bmNzLmhhbmRsZV9jZCAmJgorICAgICAgICAgaXNfaW9tbXVfZW5hYmxlZChkKSAmJiBodm1fZnVu
Y3MuaGFuZGxlX2NkICYmCiAgICAgICAgICAoIXJhbmdlc2V0X2lzX2VtcHR5KGQtPmlvbWVtX2Nh
cHMpIHx8CiAgICAgICAgICAgIXJhbmdlc2V0X2lzX2VtcHR5KGQtPmFyY2guaW9wb3J0X2NhcHMp
IHx8CiAgICAgICAgICAgaGFzX2FyY2hfcGRldnMoZCkpICkKZGlmZiAtLWdpdCBhL3hlbi9hcmNo
L3g4Ni9odm0vdmlvYXBpYy5jIGIveGVuL2FyY2gveDg2L2h2bS92aW9hcGljLmMKaW5kZXggOWMy
NWY3MmI0ZC4uOWFlZWYzMmExNCAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L2h2bS92aW9hcGlj
LmMKKysrIGIveGVuL2FyY2gveDg2L2h2bS92aW9hcGljLmMKQEAgLTUzNiw3ICs1MzYsNyBAQCB2
b2lkIHZpb2FwaWNfdXBkYXRlX0VPSShzdHJ1Y3QgZG9tYWluICpkLCB1OCB2ZWN0b3IpCiAKICAg
ICAgICAgICAgIGVudC0+ZmllbGRzLnJlbW90ZV9pcnIgPSAwOwogCi0gICAgICAgICAgICBpZiAo
IGlvbW11X2VuYWJsZWQgKQorICAgICAgICAgICAgaWYgKCBpc19pb21tdV9lbmFibGVkKGQpICkK
ICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICBzcGluX3VubG9jaygmZC0+YXJjaC5odm0u
aXJxX2xvY2spOwogICAgICAgICAgICAgICAgIGh2bV9kcGNpX2VvaShkLCB2aW9hcGljLT5iYXNl
X2dzaSArIHBpbiwgZW50KTsKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9odm0vdm14L3ZtY3Mu
YyBiL3hlbi9hcmNoL3g4Ni9odm0vdm14L3ZtY3MuYwppbmRleCAxNmYxNGFiZThmLi5lZDI3ZThk
ZWY3IDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYvaHZtL3ZteC92bWNzLmMKKysrIGIveGVuL2Fy
Y2gveDg2L2h2bS92bXgvdm1jcy5jCkBAIC0xMDg3LDcgKzEwODcsNyBAQCBzdGF0aWMgaW50IGNv
bnN0cnVjdF92bWNzKHN0cnVjdCB2Y3B1ICp2KQogICAgICAgICB2bXhfY2xlYXJfbXNyX2ludGVy
Y2VwdCh2LCBNU1JfSUEzMl9TWVNFTlRFUl9DUywgVk1YX01TUl9SVyk7CiAgICAgICAgIHZteF9j
bGVhcl9tc3JfaW50ZXJjZXB0KHYsIE1TUl9JQTMyX1NZU0VOVEVSX0VTUCwgVk1YX01TUl9SVyk7
CiAgICAgICAgIHZteF9jbGVhcl9tc3JfaW50ZXJjZXB0KHYsIE1TUl9JQTMyX1NZU0VOVEVSX0VJ
UCwgVk1YX01TUl9SVyk7Ci0gICAgICAgIGlmICggcGFnaW5nX21vZGVfaGFwKGQpICYmICghaW9t
bXVfZW5hYmxlZCB8fCBpb21tdV9zbm9vcCkgKQorICAgICAgICBpZiAoIHBhZ2luZ19tb2RlX2hh
cChkKSAmJiAoIWlzX2lvbW11X2VuYWJsZWQoZCkgfHwgaW9tbXVfc25vb3ApICkKICAgICAgICAg
ICAgIHZteF9jbGVhcl9tc3JfaW50ZXJjZXB0KHYsIE1TUl9JQTMyX0NSX1BBVCwgVk1YX01TUl9S
Vyk7CiAgICAgICAgIGlmICggKHZtZXhpdF9jdGwgJiBWTV9FWElUX0NMRUFSX0JORENGR1MpICYm
CiAgICAgICAgICAgICAgKHZtZW50cnlfY3RsICYgVk1fRU5UUllfTE9BRF9CTkRDRkdTKSApCmRp
ZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvaHZtL3ZteC92bXguYyBiL3hlbi9hcmNoL3g4Ni9odm0v
dm14L3ZteC5jCmluZGV4IDAwNjAzMTBkNzQuLjNiM2Q1YjYyNTAgMTAwNjQ0Ci0tLSBhL3hlbi9h
cmNoL3g4Ni9odm0vdm14L3ZteC5jCisrKyBiL3hlbi9hcmNoL3g4Ni9odm0vdm14L3ZteC5jCkBA
IC0xMjEwLDcgKzEyMTAsNyBAQCBzdGF0aWMgdm9pZCB2bXhfaGFuZGxlX2NkKHN0cnVjdCB2Y3B1
ICp2LCB1bnNpZ25lZCBsb25nIHZhbHVlKQogICAgICAgICB7CiAgICAgICAgICAgICB2LT5hcmNo
Lmh2bS5jYWNoZV9tb2RlID0gTk9STUFMX0NBQ0hFX01PREU7CiAgICAgICAgICAgICB2bXhfc2V0
X2d1ZXN0X3BhdCh2LCAqcGF0KTsKLSAgICAgICAgICAgIGlmICggIWlvbW11X2VuYWJsZWQgfHwg
aW9tbXVfc25vb3AgKQorICAgICAgICAgICAgaWYgKCAhaXNfaW9tbXVfZW5hYmxlZCh2LT5kb21h
aW4pIHx8IGlvbW11X3Nub29wICkKICAgICAgICAgICAgICAgICB2bXhfY2xlYXJfbXNyX2ludGVy
Y2VwdCh2LCBNU1JfSUEzMl9DUl9QQVQsIFZNWF9NU1JfUlcpOwogICAgICAgICAgICAgaHZtX2Fz
aWRfZmx1c2hfdmNwdSh2KTsgLyogbm8gbmVlZCB0byBmbHVzaCBjYWNoZSAqLwogICAgICAgICB9
CmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvbW0vcDJtLWVwdC5jIGIveGVuL2FyY2gveDg2L21t
L3AybS1lcHQuYwppbmRleCA5NTJlYmFkODJmLi5mYTM0N2U2MDI2IDEwMDY0NAotLS0gYS94ZW4v
YXJjaC94ODYvbW0vcDJtLWVwdC5jCisrKyBiL3hlbi9hcmNoL3g4Ni9tbS9wMm0tZXB0LmMKQEAg
LTI2MCw3ICsyNjAsNyBAQCBzdGF0aWMgYm9vbF90IGVwdF9zcGxpdF9zdXBlcl9wYWdlKHN0cnVj
dCBwMm1fZG9tYWluICpwMm0sCiAgICAgICAgICplcHRlID0gKmVwdF9lbnRyeTsKICAgICAgICAg
ZXB0ZS0+c3AgPSAobGV2ZWwgPiAxKTsKICAgICAgICAgZXB0ZS0+bWZuICs9IGkgKiB0cnVuazsK
LSAgICAgICAgZXB0ZS0+c25wID0gKGlvbW11X2VuYWJsZWQgJiYgaW9tbXVfc25vb3ApOworICAg
ICAgICBlcHRlLT5zbnAgPSBpc19pb21tdV9lbmFibGVkKHAybS0+ZG9tYWluKSAmJiBpb21tdV9z
bm9vcDsKICAgICAgICAgZXB0ZS0+c3VwcHJlc3NfdmUgPSAxOwogCiAgICAgICAgIGVwdF9wMm1f
dHlwZV90b19mbGFncyhwMm0sIGVwdGUsIGVwdGUtPnNhX3AybXQsIGVwdGUtPmFjY2Vzcyk7CkBA
IC03NjYsNyArNzY2LDcgQEAgZXB0X3NldF9lbnRyeShzdHJ1Y3QgcDJtX2RvbWFpbiAqcDJtLCBn
Zm5fdCBnZm5fLCBtZm5fdCBtZm4sCiAgICAgICAgIG5ld19lbnRyeS5zcCA9ICEhaTsKICAgICAg
ICAgbmV3X2VudHJ5LnNhX3AybXQgPSBwMm10OwogICAgICAgICBuZXdfZW50cnkuYWNjZXNzID0g
cDJtYTsKLSAgICAgICAgbmV3X2VudHJ5LnNucCA9IChpb21tdV9lbmFibGVkICYmIGlvbW11X3Nu
b29wKTsKKyAgICAgICAgbmV3X2VudHJ5LnNucCA9IGlzX2lvbW11X2VuYWJsZWQoZCkgJiYgaW9t
bXVfc25vb3A7CiAKICAgICAgICAgLyogdGhlIGNhbGxlciBzaG91bGQgdGFrZSBjYXJlIG9mIHRo
ZSBwcmV2aW91cyBwYWdlICovCiAgICAgICAgIG5ld19lbnRyeS5tZm4gPSBtZm5feChtZm4pOwpk
aWZmIC0tZ2l0IGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL2lvbW11X2d1ZXN0LmMgYi94
ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfZ3Vlc3QuYwppbmRleCA3ZjJkZDY2MmFm
Li4xZjJiY2ZiZTE1IDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9t
bXVfZ3Vlc3QuYworKysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfZ3Vlc3Qu
YwpAQCAtODIxLDcgKzgyMSw3IEBAIGludCBndWVzdF9pb21tdV9pbml0KHN0cnVjdCBkb21haW4q
IGQpCiAgICAgc3RydWN0IGd1ZXN0X2lvbW11ICppb21tdTsKICAgICBzdHJ1Y3QgZG9tYWluX2lv
bW11ICpoZCA9IGRvbV9pb21tdShkKTsKIAotICAgIGlmICggIWlzX2h2bV9kb21haW4oZCkgfHwg
IWlvbW11X2VuYWJsZWQgfHwgIWlvbW11djJfZW5hYmxlZCB8fAorICAgIGlmICggIWlzX2h2bV9k
b21haW4oZCkgfHwgIWlzX2lvbW11X2VuYWJsZWQoZCkgfHwgIWlvbW11djJfZW5hYmxlZCB8fAog
ICAgICAgICAgIWhhc192aW9tbXUoZCkgKQogICAgICAgICByZXR1cm4gMDsKIApkaWZmIC0tZ2l0
IGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvZGV2aWNlX3RyZWUuYyBiL3hlbi9kcml2ZXJzL3Bh
c3N0aHJvdWdoL2RldmljZV90cmVlLmMKaW5kZXggZDMyYjE3MjY2NC4uMTJmMmM0YzNmMiAxMDA2
NDQKLS0tIGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvZGV2aWNlX3RyZWUuYworKysgYi94ZW4v
ZHJpdmVycy9wYXNzdGhyb3VnaC9kZXZpY2VfdHJlZS5jCkBAIC0yOSw3ICsyOSw3IEBAIGludCBp
b21tdV9hc3NpZ25fZHRfZGV2aWNlKHN0cnVjdCBkb21haW4gKmQsIHN0cnVjdCBkdF9kZXZpY2Vf
bm9kZSAqZGV2KQogICAgIGludCByYyA9IC1FQlVTWTsKICAgICBzdHJ1Y3QgZG9tYWluX2lvbW11
ICpoZCA9IGRvbV9pb21tdShkKTsKIAotICAgIGlmICggIWlvbW11X2VuYWJsZWQgfHwgIWhkLT5w
bGF0Zm9ybV9vcHMgKQorICAgIGlmICggIWlzX2lvbW11X2VuYWJsZWQoZCkgKQogICAgICAgICBy
ZXR1cm4gLUVJTlZBTDsKIAogICAgIGlmICggIWR0X2RldmljZV9pc19wcm90ZWN0ZWQoZGV2KSAp
CkBAIC03MSw3ICs3MSw3IEBAIGludCBpb21tdV9kZWFzc2lnbl9kdF9kZXZpY2Uoc3RydWN0IGRv
bWFpbiAqZCwgc3RydWN0IGR0X2RldmljZV9ub2RlICpkZXYpCiAgICAgY29uc3Qgc3RydWN0IGRv
bWFpbl9pb21tdSAqaGQgPSBkb21faW9tbXUoZCk7CiAgICAgaW50IHJjOwogCi0gICAgaWYgKCAh
aW9tbXVfZW5hYmxlZCB8fCAhaGQtPnBsYXRmb3JtX29wcyApCisgICAgaWYgKCAhaXNfaW9tbXVf
ZW5hYmxlZChkKSApCiAgICAgICAgIHJldHVybiAtRUlOVkFMOwogCiAgICAgaWYgKCAhZHRfZGV2
aWNlX2lzX3Byb3RlY3RlZChkZXYpICkKZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJv
dWdoL2lvLmMgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9pby5jCmluZGV4IDQyOTBjN2M3MTAu
LmIyOTJlNzkzODIgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2lvLmMKKysr
IGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvaW8uYwpAQCAtNDM0LDcgKzQzNCw3IEBAIGludCBw
dF9pcnFfY3JlYXRlX2JpbmQoCiAgICAgICAgICAgICBpZiAoIHZjcHUgKQogICAgICAgICAgICAg
ICAgIHBpcnFfZHBjaS0+Z21zaS5wb3N0ZWQgPSB0cnVlOwogICAgICAgICB9Ci0gICAgICAgIGlm
ICggdmNwdSAmJiBpb21tdV9lbmFibGVkICkKKyAgICAgICAgaWYgKCB2Y3B1ICYmIGlzX2lvbW11
X2VuYWJsZWQoZCkgKQogICAgICAgICAgICAgaHZtX21pZ3JhdGVfcGlycShwaXJxX2RwY2ksIHZj
cHUpOwogCiAgICAgICAgIC8qIFVzZSBpbnRlcnJ1cHQgcG9zdGluZyBpZiBpdCBpcyBzdXBwb3J0
ZWQuICovCkBAIC04MTcsNyArODE3LDcgQEAgaW50IGh2bV9kb19JUlFfZHBjaShzdHJ1Y3QgZG9t
YWluICpkLCBzdHJ1Y3QgcGlycSAqcGlycSkKIAogICAgIEFTU0VSVChpc19odm1fZG9tYWluKGQp
KTsKIAotICAgIGlmICggIWlvbW11X2VuYWJsZWQgfHwgKCFpc19oYXJkd2FyZV9kb21haW4oZCkg
JiYgIWRwY2kpIHx8CisgICAgaWYgKCAhaXNfaW9tbXVfZW5hYmxlZChkKSB8fCAoIWlzX2hhcmR3
YXJlX2RvbWFpbihkKSAmJiAhZHBjaSkgfHwKICAgICAgICAgICFwaXJxX2RwY2kgfHwgIShwaXJx
X2RwY2ktPmZsYWdzICYgSFZNX0lSUV9EUENJX01BUFBFRCkgKQogICAgICAgICByZXR1cm4gMDsK
IApAQCAtODY5LDcgKzg2OSw3IEBAIHN0YXRpYyBpbnQgX2h2bV9kcGNpX21zaV9lb2koc3RydWN0
IGRvbWFpbiAqZCwKIAogdm9pZCBodm1fZHBjaV9tc2lfZW9pKHN0cnVjdCBkb21haW4gKmQsIGlu
dCB2ZWN0b3IpCiB7Ci0gICAgaWYgKCAhaW9tbXVfZW5hYmxlZCB8fAorICAgIGlmICggIWlzX2lv
bW11X2VuYWJsZWQoZCkgfHwKICAgICAgICAgICghaHZtX2RvbWFpbl9pcnEoZCktPmRwY2kgJiYg
IWlzX2hhcmR3YXJlX2RvbWFpbihkKSkgKQogICAgICAgIHJldHVybjsKIApAQCAtMTAwMSw3ICsx
MDAxLDcgQEAgdm9pZCBodm1fZHBjaV9lb2koc3RydWN0IGRvbWFpbiAqZCwgdW5zaWduZWQgaW50
IGd1ZXN0X2dzaSwKICAgICBjb25zdCBzdHJ1Y3QgaHZtX2lycV9kcGNpICpodm1faXJxX2RwY2k7
CiAgICAgY29uc3Qgc3RydWN0IGh2bV9naXJxX2RwY2lfbWFwcGluZyAqZ2lycTsKIAotICAgIGlm
ICggIWlvbW11X2VuYWJsZWQgKQorICAgIGlmICggIWlzX2lvbW11X2VuYWJsZWQoZCkgKQogICAg
ICAgICByZXR1cm47CiAKICAgICBpZiAoIGlzX2hhcmR3YXJlX2RvbWFpbihkKSApCmRpZmYgLS1n
aXQgYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9pb21tdS5jIGIveGVuL2RyaXZlcnMvcGFzc3Ro
cm91Z2gvaW9tbXUuYwppbmRleCBlNjFkM2QxMzY4Li45ZGFjZTY0YWY5IDEwMDY0NAotLS0gYS94
ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9pb21tdS5jCisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJv
dWdoL2lvbW11LmMKQEAgLTE3OSw3ICsxNzksNyBAQCB2b2lkIF9faHdkb21faW5pdCBpb21tdV9o
d2RvbV9pbml0KHN0cnVjdCBkb21haW4gKmQpCiAKICAgICBjaGVja19od2RvbV9yZXFzKGQpOwog
Ci0gICAgaWYgKCAhaW9tbXVfZW5hYmxlZCApCisgICAgaWYgKCAhaXNfaW9tbXVfZW5hYmxlZChk
KSApCiAgICAgICAgIHJldHVybjsKIAogICAgIHJlZ2lzdGVyX2tleWhhbmRsZXIoJ28nLCAmaW9t
bXVfZHVtcF9wMm1fdGFibGUsICJkdW1wIGlvbW11IHAybSB0YWJsZSIsIDApOwpAQCAtMjg0LDcg
KzI4NCw3IEBAIGludCBpb21tdV9jb25zdHJ1Y3Qoc3RydWN0IGRvbWFpbiAqZCkKIAogdm9pZCBp
b21tdV9kb21haW5fZGVzdHJveShzdHJ1Y3QgZG9tYWluICpkKQogewotICAgIGlmICggIWlvbW11
X2VuYWJsZWQgfHwgIWRvbV9pb21tdShkKS0+cGxhdGZvcm1fb3BzICkKKyAgICBpZiAoICFpc19p
b21tdV9lbmFibGVkKGQpICkKICAgICAgICAgcmV0dXJuOwogCiAgICAgaW9tbXVfdGVhcmRvd24o
ZCk7CkBAIC0zMDAsNyArMzAwLDcgQEAgaW50IGlvbW11X21hcChzdHJ1Y3QgZG9tYWluICpkLCBk
Zm5fdCBkZm4sIG1mbl90IG1mbiwKICAgICB1bnNpZ25lZCBsb25nIGk7CiAgICAgaW50IHJjID0g
MDsKIAotICAgIGlmICggIWlvbW11X2VuYWJsZWQgfHwgIWhkLT5wbGF0Zm9ybV9vcHMgKQorICAg
IGlmICggIWlzX2lvbW11X2VuYWJsZWQoZCkgKQogICAgICAgICByZXR1cm4gMDsKIAogICAgIEFT
U0VSVChJU19BTElHTkVEKGRmbl94KGRmbiksICgxdWwgPDwgcGFnZV9vcmRlcikpKTsKQEAgLTM2
MCw3ICszNjAsNyBAQCBpbnQgaW9tbXVfdW5tYXAoc3RydWN0IGRvbWFpbiAqZCwgZGZuX3QgZGZu
LCB1bnNpZ25lZCBpbnQgcGFnZV9vcmRlciwKICAgICB1bnNpZ25lZCBsb25nIGk7CiAgICAgaW50
IHJjID0gMDsKIAotICAgIGlmICggIWlvbW11X2VuYWJsZWQgfHwgIWhkLT5wbGF0Zm9ybV9vcHMg
KQorICAgIGlmICggIWlzX2lvbW11X2VuYWJsZWQoZCkgKQogICAgICAgICByZXR1cm4gMDsKIAog
ICAgIEFTU0VSVChJU19BTElHTkVEKGRmbl94KGRmbiksICgxdWwgPDwgcGFnZV9vcmRlcikpKTsK
QEAgLTQxMyw3ICs0MTMsNyBAQCBpbnQgaW9tbXVfbG9va3VwX3BhZ2Uoc3RydWN0IGRvbWFpbiAq
ZCwgZGZuX3QgZGZuLCBtZm5fdCAqbWZuLAogewogICAgIGNvbnN0IHN0cnVjdCBkb21haW5faW9t
bXUgKmhkID0gZG9tX2lvbW11KGQpOwogCi0gICAgaWYgKCAhaW9tbXVfZW5hYmxlZCB8fCAhaGQt
PnBsYXRmb3JtX29wcyB8fCAhaGQtPnBsYXRmb3JtX29wcy0+bG9va3VwX3BhZ2UgKQorICAgIGlm
ICggIWlzX2lvbW11X2VuYWJsZWQoZCkgfHwgIWhkLT5wbGF0Zm9ybV9vcHMtPmxvb2t1cF9wYWdl
ICkKICAgICAgICAgcmV0dXJuIC1FT1BOT1RTVVBQOwogCiAgICAgcmV0dXJuIGlvbW11X2NhbGwo
aGQtPnBsYXRmb3JtX29wcywgbG9va3VwX3BhZ2UsIGQsIGRmbiwgbWZuLCBmbGFncyk7CkBAIC00
NDIsOCArNDQyLDggQEAgaW50IGlvbW11X2lvdGxiX2ZsdXNoKHN0cnVjdCBkb21haW4gKmQsIGRm
bl90IGRmbiwgdW5zaWduZWQgaW50IHBhZ2VfY291bnQsCiAgICAgY29uc3Qgc3RydWN0IGRvbWFp
bl9pb21tdSAqaGQgPSBkb21faW9tbXUoZCk7CiAgICAgaW50IHJjOwogCi0gICAgaWYgKCAhaW9t
bXVfZW5hYmxlZCB8fCAhaGQtPnBsYXRmb3JtX29wcyB8fAotICAgICAgICAgIWhkLT5wbGF0Zm9y
bV9vcHMtPmlvdGxiX2ZsdXNoIHx8ICFwYWdlX2NvdW50IHx8ICFmbHVzaF9mbGFncyApCisgICAg
aWYgKCAhaXNfaW9tbXVfZW5hYmxlZChkKSB8fCAhaGQtPnBsYXRmb3JtX29wcy0+aW90bGJfZmx1
c2ggfHwKKyAgICAgICAgICFwYWdlX2NvdW50IHx8ICFmbHVzaF9mbGFncyApCiAgICAgICAgIHJl
dHVybiAwOwogCiAgICAgaWYgKCBkZm5fZXEoZGZuLCBJTlZBTElEX0RGTikgKQpAQCAtNDcwLDgg
KzQ3MCw4IEBAIGludCBpb21tdV9pb3RsYl9mbHVzaF9hbGwoc3RydWN0IGRvbWFpbiAqZCwgdW5z
aWduZWQgaW50IGZsdXNoX2ZsYWdzKQogICAgIGNvbnN0IHN0cnVjdCBkb21haW5faW9tbXUgKmhk
ID0gZG9tX2lvbW11KGQpOwogICAgIGludCByYzsKIAotICAgIGlmICggIWlvbW11X2VuYWJsZWQg
fHwgIWhkLT5wbGF0Zm9ybV9vcHMgfHwKLSAgICAgICAgICFoZC0+cGxhdGZvcm1fb3BzLT5pb3Rs
Yl9mbHVzaF9hbGwgfHwgIWZsdXNoX2ZsYWdzICkKKyAgICBpZiAoICFpc19pb21tdV9lbmFibGVk
KGQpIHx8ICFoZC0+cGxhdGZvcm1fb3BzLT5pb3RsYl9mbHVzaF9hbGwgfHwKKyAgICAgICAgICFm
bHVzaF9mbGFncyApCiAgICAgICAgIHJldHVybiAwOwogCiAgICAgLyoKQEAgLTU1Niw4ICs1NTYs
OCBAQCBpbnQgaW9tbXVfZG9fZG9tY3RsKAogewogICAgIGludCByZXQgPSAtRU5PREVWOwogCi0g
ICAgaWYgKCAhaW9tbXVfZW5hYmxlZCApCi0gICAgICAgIHJldHVybiAtRU5PU1lTOworICAgIGlm
ICggIWlzX2lvbW11X2VuYWJsZWQoZCkgKQorICAgICAgICByZXR1cm4gLUVPUE5PVFNVUFA7CiAK
ICNpZmRlZiBDT05GSUdfSEFTX1BDSQogICAgIHJldCA9IGlvbW11X2RvX3BjaV9kb21jdGwoZG9t
Y3RsLCBkLCB1X2RvbWN0bCk7CkBAIC01NzYsOSArNTc2LDkgQEAgdm9pZCBpb21tdV9zaGFyZV9w
Mm1fdGFibGUoc3RydWN0IGRvbWFpbiogZCkKICAgICBBU1NFUlQoaGFwX2VuYWJsZWQoZCkpOwog
ICAgIC8qCiAgICAgICogaW9tbXVfdXNlX2hhcF9wdChkKSBjYW5ub3QgYmUgdXNlZCBoZXJlIGJl
Y2F1c2UgZHVyaW5nIGRvbWFpbgotICAgICAqIGNvbnN0cnVjdGlvbiBuZWVkX2lvbW11KGQpIHdp
bGwgYWx3YXlzIHJldHVybiBmYWxzZSBoZXJlLgorICAgICAqIGNvbnN0cnVjdGlvbiBoYXNfaW9t
bXVfcHQoZCkgd2lsbCBhbHdheXMgcmV0dXJuIGZhbHNlIGhlcmUuCiAgICAgICovCi0gICAgaWYg
KCBpb21tdV9lbmFibGVkICYmIGlvbW11X2hhcF9wdF9zaGFyZSApCisgICAgaWYgKCBpc19pb21t
dV9lbmFibGVkKGQpICYmIGlvbW11X2hhcF9wdF9zaGFyZSApCiAgICAgICAgIGlvbW11X2dldF9v
cHMoKS0+c2hhcmVfcDJtKGQpOwogfQogCkBAIC02MDgsMTAgKzYwOCw3IEBAIGludCBpb21tdV9n
ZXRfcmVzZXJ2ZWRfZGV2aWNlX21lbW9yeShpb21tdV9ncmRtX3QgKmZ1bmMsIHZvaWQgKmN0eHQp
CiAKIGJvb2xfdCBpb21tdV9oYXNfZmVhdHVyZShzdHJ1Y3QgZG9tYWluICpkLCBlbnVtIGlvbW11
X2ZlYXR1cmUgZmVhdHVyZSkKIHsKLSAgICBpZiAoICFpb21tdV9lbmFibGVkICkKLSAgICAgICAg
cmV0dXJuIDA7Ci0KLSAgICByZXR1cm4gdGVzdF9iaXQoZmVhdHVyZSwgZG9tX2lvbW11KGQpLT5m
ZWF0dXJlcyk7CisgICAgcmV0dXJuIGlzX2lvbW11X2VuYWJsZWQoZCkgJiYgdGVzdF9iaXQoZmVh
dHVyZSwgZG9tX2lvbW11KGQpLT5mZWF0dXJlcyk7CiB9CiAKIHN0YXRpYyB2b2lkIGlvbW11X2R1
bXBfcDJtX3RhYmxlKHVuc2lnbmVkIGNoYXIga2V5KQpkaWZmIC0tZ2l0IGEveGVuL2RyaXZlcnMv
cGFzc3Rocm91Z2gvcGNpLmMgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9wY2kuYwppbmRleCBh
ZjAxMWQzMmRjLi44MTQxMDY2NzlmIDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3Vn
aC9wY2kuYworKysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9wY2kuYwpAQCAtNTk1LDcgKzU5
NSw3IEBAIHN0YXRpYyB2b2lkIHBjaV9lbmFibGVfYWNzKHN0cnVjdCBwY2lfZGV2ICpwZGV2KQog
ICAgIHUxNiBjYXAsIGN0cmwsIHNlZyA9IHBkZXYtPnNlZzsKICAgICB1OCBidXMgPSBwZGV2LT5i
dXM7CiAKLSAgICBpZiAoICFpb21tdV9lbmFibGVkICkKKyAgICBpZiAoICFpc19pb21tdV9lbmFi
bGVkKHBkZXYtPmRvbWFpbikgKQogICAgICAgICByZXR1cm47CiAKICAgICBwb3MgPSBwY2lfZmlu
ZF9leHRfY2FwYWJpbGl0eShzZWcsIGJ1cywgcGRldi0+ZGV2Zm4sIFBDSV9FWFRfQ0FQX0lEX0FD
Uyk7CkBAIC04NjQsNyArODY0LDcgQEAgc3RhdGljIGludCBwY2lfY2xlYW5fZHBjaV9pcnFzKHN0
cnVjdCBkb21haW4gKmQpCiB7CiAgICAgc3RydWN0IGh2bV9pcnFfZHBjaSAqaHZtX2lycV9kcGNp
ID0gTlVMTDsKIAotICAgIGlmICggIWlvbW11X2VuYWJsZWQgKQorICAgIGlmICggIWlzX2lvbW11
X2VuYWJsZWQoZCkgKQogICAgICAgICByZXR1cm4gMDsKIAogICAgIGlmICggIWlzX2h2bV9kb21h
aW4oZCkgKQpAQCAtODk3LDcgKzg5Nyw3IEBAIHN0YXRpYyBpbnQgZGVhc3NpZ25fZGV2aWNlKHN0
cnVjdCBkb21haW4gKmQsIHVpbnQxNl90IHNlZywgdWludDhfdCBidXMsCiAgICAgc3RydWN0IHBj
aV9kZXYgKnBkZXY7CiAgICAgaW50IHJldCA9IDA7CiAKLSAgICBpZiAoICFpb21tdV9lbmFibGVk
IHx8ICFoZC0+cGxhdGZvcm1fb3BzICkKKyAgICBpZiAoICFpc19pb21tdV9lbmFibGVkKGQpICkK
ICAgICAgICAgcmV0dXJuIC1FSU5WQUw7CiAKICAgICBBU1NFUlQocGNpZGV2c19sb2NrZWQoKSk7
CkBAIC0xMzgzLDcgKzEzODMsNyBAQCBzdGF0aWMgaW50IGlvbW11X2FkZF9kZXZpY2Uoc3RydWN0
IHBjaV9kZXYgKnBkZXYpCiAgICAgQVNTRVJUKHBjaWRldnNfbG9ja2VkKCkpOwogCiAgICAgaGQg
PSBkb21faW9tbXUocGRldi0+ZG9tYWluKTsKLSAgICBpZiAoICFpb21tdV9lbmFibGVkIHx8ICFo
ZC0+cGxhdGZvcm1fb3BzICkKKyAgICBpZiAoICFpc19pb21tdV9lbmFibGVkKHBkZXYtPmRvbWFp
bikgKQogICAgICAgICByZXR1cm4gMDsKIAogICAgIHJjID0gaGQtPnBsYXRmb3JtX29wcy0+YWRk
X2RldmljZShwZGV2LT5kZXZmbiwgcGNpX3RvX2RldihwZGV2KSk7CkBAIC0xNDEyLDcgKzE0MTIs
NyBAQCBzdGF0aWMgaW50IGlvbW11X2VuYWJsZV9kZXZpY2Uoc3RydWN0IHBjaV9kZXYgKnBkZXYp
CiAgICAgQVNTRVJUKHBjaWRldnNfbG9ja2VkKCkpOwogCiAgICAgaGQgPSBkb21faW9tbXUocGRl
di0+ZG9tYWluKTsKLSAgICBpZiAoICFpb21tdV9lbmFibGVkIHx8ICFoZC0+cGxhdGZvcm1fb3Bz
IHx8CisgICAgaWYgKCAhaXNfaW9tbXVfZW5hYmxlZChwZGV2LT5kb21haW4pIHx8CiAgICAgICAg
ICAhaGQtPnBsYXRmb3JtX29wcy0+ZW5hYmxlX2RldmljZSApCiAgICAgICAgIHJldHVybiAwOwog
CkBAIC0xNDI4LDcgKzE0MjgsNyBAQCBzdGF0aWMgaW50IGlvbW11X3JlbW92ZV9kZXZpY2Uoc3Ry
dWN0IHBjaV9kZXYgKnBkZXYpCiAgICAgICAgIHJldHVybiAtRUlOVkFMOwogCiAgICAgaGQgPSBk
b21faW9tbXUocGRldi0+ZG9tYWluKTsKLSAgICBpZiAoICFpb21tdV9lbmFibGVkIHx8ICFoZC0+
cGxhdGZvcm1fb3BzICkKKyAgICBpZiAoICFpc19pb21tdV9lbmFibGVkKHBkZXYtPmRvbWFpbikg
KQogICAgICAgICByZXR1cm4gMDsKIAogICAgIGZvciAoIGRldmZuID0gcGRldi0+ZGV2Zm4gOyBw
ZGV2LT5waGFudG9tX3N0cmlkZTsgKQpAQCAtMTQ3MSw3ICsxNDcxLDcgQEAgc3RhdGljIGludCBh
c3NpZ25fZGV2aWNlKHN0cnVjdCBkb21haW4gKmQsIHUxNiBzZWcsIHU4IGJ1cywgdTggZGV2Zm4s
IHUzMiBmbGFnKQogICAgIHN0cnVjdCBwY2lfZGV2ICpwZGV2OwogICAgIGludCByYyA9IDA7CiAK
LSAgICBpZiAoICFpb21tdV9lbmFibGVkIHx8ICFoZC0+cGxhdGZvcm1fb3BzICkKKyAgICBpZiAo
ICFpc19pb21tdV9lbmFibGVkKGQpICkKICAgICAgICAgcmV0dXJuIDA7CiAKICAgICAvKiBQcmV2
ZW50IGRldmljZSBhc3NpZ24gaWYgbWVtIHBhZ2luZyBvciBtZW0gc2hhcmluZyBoYXZlIGJlZW4g
CkBAIC0xNTM3LDcgKzE1MzcsNyBAQCBzdGF0aWMgaW50IGlvbW11X2dldF9kZXZpY2VfZ3JvdXAo
CiAgICAgaW50IGkgPSAwOwogICAgIGNvbnN0IHN0cnVjdCBpb21tdV9vcHMgKm9wcyA9IGhkLT5w
bGF0Zm9ybV9vcHM7CiAKLSAgICBpZiAoICFpb21tdV9lbmFibGVkIHx8ICFvcHMgfHwgIW9wcy0+
Z2V0X2RldmljZV9ncm91cF9pZCApCisgICAgaWYgKCAhaXNfaW9tbXVfZW5hYmxlZChkKSB8fCAh
b3BzLT5nZXRfZGV2aWNlX2dyb3VwX2lkICkKICAgICAgICAgcmV0dXJuIDA7CiAKICAgICBncm91
cF9pZCA9IG9wcy0+Z2V0X2RldmljZV9ncm91cF9pZChzZWcsIGJ1cywgZGV2Zm4pOwpkaWZmIC0t
Z2l0IGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvdnRkL2lvbW11LmMgYi94ZW4vZHJpdmVycy9w
YXNzdGhyb3VnaC92dGQvaW9tbXUuYwppbmRleCBkZWZhNzRmYWUzLi5lNTZkN2JlZmI0IDEwMDY0
NAotLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC92dGQvaW9tbXUuYworKysgYi94ZW4vZHJp
dmVycy9wYXNzdGhyb3VnaC92dGQvaW9tbXUuYwpAQCAtMTc1Nyw3ICsxNzU3LDcgQEAgc3RhdGlj
IHZvaWQgaW9tbXVfZG9tYWluX3RlYXJkb3duKHN0cnVjdCBkb21haW4gKmQpCiAgICAgICAgIHhm
cmVlKG1ybXJyKTsKICAgICB9CiAKLSAgICBBU1NFUlQoaW9tbXVfZW5hYmxlZCk7CisgICAgQVNT
RVJUKGlzX2lvbW11X2VuYWJsZWQoZCkpOwogCiAgICAgLyoKICAgICAgKiBXZSBjYW4ndCB1c2Ug
aW9tbXVfdXNlX2hhcF9wdCBoZXJlIGJlY2F1c2UgZWl0aGVyIElPTU1VIHN0YXRlCmRpZmYgLS1n
aXQgYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC92dGQveDg2L2h2bS5jIGIveGVuL2RyaXZlcnMv
cGFzc3Rocm91Z2gvdnRkL3g4Ni9odm0uYwppbmRleCA2Njc1ZGNhMDI3Li5mNzdiMzU4MTVjIDEw
MDY0NAotLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC92dGQveDg2L2h2bS5jCisrKyBiL3hl
bi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC94ODYvaHZtLmMKQEAgLTUxLDcgKzUxLDcgQEAgdm9p
ZCBodm1fZHBjaV9pc2FpcnFfZW9pKHN0cnVjdCBkb21haW4gKmQsIHVuc2lnbmVkIGludCBpc2Fp
cnEpCiAgICAgc3RydWN0IGh2bV9pcnFfZHBjaSAqZHBjaSA9IE5VTEw7CiAKICAgICBBU1NFUlQo
aXNhaXJxIDwgTlJfSVNBSVJRUyk7Ci0gICAgaWYgKCAhaW9tbXVfZW5hYmxlZCApCisgICAgaWYg
KCAhaXNfaW9tbXVfZW5hYmxlZChkKSApCiAgICAgICAgIHJldHVybjsKIAogICAgIHNwaW5fbG9j
aygmZC0+ZXZlbnRfbG9jayk7CmRpZmYgLS1naXQgYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC94
ODYvaW9tbXUuYyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3g4Ni9pb21tdS5jCmluZGV4IDky
YzFkMDFlZGYuLjgzMTlmZTBhNjkgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdo
L3g4Ni9pb21tdS5jCisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3g4Ni9pb21tdS5jCkBA
IC0xODAsNyArMTgwLDcgQEAgaW50IGFyY2hfaW9tbXVfcG9wdWxhdGVfcGFnZV90YWJsZShzdHJ1
Y3QgZG9tYWluICpkKQogCiB2b2lkIF9faHdkb21faW5pdCBhcmNoX2lvbW11X2NoZWNrX2F1dG90
cmFuc2xhdGVkX2h3ZG9tKHN0cnVjdCBkb21haW4gKmQpCiB7Ci0gICAgaWYgKCAhaW9tbXVfZW5h
YmxlZCApCisgICAgaWYgKCAhaXNfaW9tbXVfZW5hYmxlZChkKSApCiAgICAgICAgIHBhbmljKCJQ
cmVzZW50bHksIGlvbW11IG11c3QgYmUgZW5hYmxlZCBmb3IgUFZIIGhhcmR3YXJlIGRvbWFpblxu
Iik7CiB9CiAKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL2FzbS14ODYvaW9tbXUuaCBiL3hlbi9p
bmNsdWRlL2FzbS14ODYvaW9tbXUuaAppbmRleCBmYWNmODM1YWRhLi5kN2ZlMmRmNTFmIDEwMDY0
NAotLS0gYS94ZW4vaW5jbHVkZS9hc20teDg2L2lvbW11LmgKKysrIGIveGVuL2luY2x1ZGUvYXNt
LXg4Ni9pb21tdS5oCkBAIC02MSw4ICs2MSwxNyBAQCBleHRlcm4gc3RydWN0IGlvbW11X29wcyBp
b21tdV9vcHM7CiAKICNpZmRlZiBOREVCVUcKICMgaW5jbHVkZSA8YXNtL2FsdGVybmF0aXZlLmg+
Ci0jIGRlZmluZSBpb21tdV9jYWxsKG9wcywgZm4sIGFyZ3MuLi4pICBhbHRlcm5hdGl2ZV9jYWxs
KGlvbW11X29wcy5mbiwgIyMgYXJncykKLSMgZGVmaW5lIGlvbW11X3ZjYWxsKG9wcywgZm4sIGFy
Z3MuLi4pIGFsdGVybmF0aXZlX3ZjYWxsKGlvbW11X29wcy5mbiwgIyMgYXJncykKKyMgZGVmaW5l
IGlvbW11X2NhbGwob3BzLCBmbiwgYXJncy4uLikgICAgICAgICBcCisoeyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAorICAgICh2b2lkKW9wczsgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIFwKKyAgICBhbHRlcm5hdGl2ZV9jYWxsKGlvbW11X29wcy5m
biwgIyMgYXJncyk7ICBcCit9KQorCisjIGRlZmluZSBpb21tdV92Y2FsbChvcHMsIGZuLCBhcmdz
Li4uKSAgICAgICAgXAorKHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIFwKKyAgICAodm9pZClvcHM7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCisg
ICAgYWx0ZXJuYXRpdmVfdmNhbGwoaW9tbXVfb3BzLmZuLCAjIyBhcmdzKTsgXAorfSkKICNlbmRp
ZgogCiBzdGF0aWMgaW5saW5lIGNvbnN0IHN0cnVjdCBpb21tdV9vcHMgKmlvbW11X2dldF9vcHMo
dm9pZCkKZGlmZiAtLWdpdCBhL3hlbi94c20vZmxhc2svaG9va3MuYyBiL3hlbi94c20vZmxhc2sv
aG9va3MuYwppbmRleCA2ODAwZjJkOWEwLi5hNDQ5ODY5NTUwIDEwMDY0NAotLS0gYS94ZW4veHNt
L2ZsYXNrL2hvb2tzLmMKKysrIGIveGVuL3hzbS9mbGFzay9ob29rcy5jCkBAIC04ODMsNyArODgz
LDcgQEAgc3RhdGljIGludCBmbGFza19tYXBfZG9tYWluX21zaSAoc3RydWN0IGRvbWFpbiAqZCwg
aW50IGlycSwgY29uc3Qgdm9pZCAqZGF0YSwKICNlbmRpZgogfQogCi1zdGF0aWMgdTMyIGZsYXNr
X2lvbW11X3Jlc291cmNlX3VzZV9wZXJtKHZvaWQpCitzdGF0aWMgdTMyIGZsYXNrX2lvbW11X3Jl
c291cmNlX3VzZV9wZXJtKGNvbnN0IHN0cnVjdCBkb21haW4gKmQpCiB7CiAgICAgLyogT2J0YWlu
IHRoZSBwZXJtaXNzaW9uIGxldmVsIHJlcXVpcmVkIGZvciBhbGxvd2luZyBhIGRvbWFpbgogICAg
ICAqIHRvIHVzZSBhbiBhc3NpZ25lZCBkZXZpY2UuCkBAIC04OTYsNyArODk2LDcgQEAgc3RhdGlj
IHUzMiBmbGFza19pb21tdV9yZXNvdXJjZV91c2VfcGVybSh2b2lkKQogICAgICAqLwogICAgIHUz
MiBwZXJtID0gUkVTT1VSQ0VfX1VTRV9OT0lPTU1VOwogCi0gICAgaWYgKGlvbW11X2VuYWJsZWQp
CisgICAgaWYgKCBpc19pb21tdV9lbmFibGVkKGQpICkKICAgICAgICAgcGVybSA9ICggaW9tbXVf
aW50cmVtYXAgPyBSRVNPVVJDRV9fVVNFX0lPTU1VIDoKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBSRVNPVVJDRV9fVVNFX0lPTU1VX05PSU5UUkVNQVAgKTsKICAgICByZXR1cm4g
cGVybTsKQEAgLTkwNyw3ICs5MDcsNyBAQCBzdGF0aWMgaW50IGZsYXNrX21hcF9kb21haW5faXJx
IChzdHJ1Y3QgZG9tYWluICpkLCBpbnQgaXJxLCBjb25zdCB2b2lkICpkYXRhKQogICAgIHUzMiBz
aWQsIGRzaWQ7CiAgICAgaW50IHJjID0gLUVQRVJNOwogICAgIHN0cnVjdCBhdmNfYXVkaXRfZGF0
YSBhZDsKLSAgICB1MzIgZHBlcm0gPSBmbGFza19pb21tdV9yZXNvdXJjZV91c2VfcGVybSgpOwor
ICAgIHUzMiBkcGVybSA9IGZsYXNrX2lvbW11X3Jlc291cmNlX3VzZV9wZXJtKGQpOwogCiAgICAg
aWYgKCBpcnEgPj0gbnJfc3RhdGljX2lycXMgJiYgZGF0YSApIHsKICAgICAgICAgcmMgPSBmbGFz
a19tYXBfZG9tYWluX21zaShkLCBpcnEsIGRhdGEsICZzaWQsICZhZCk7CkBAIC05NzMsNyArOTcz
LDcgQEAgc3RhdGljIGludCBmbGFza19iaW5kX3B0X2lycSAoc3RydWN0IGRvbWFpbiAqZCwgc3Ry
dWN0IHhlbl9kb21jdGxfYmluZF9wdF9pcnEgKmIKICAgICBpbnQgcmMgPSAtRVBFUk07CiAgICAg
aW50IGlycTsKICAgICBzdHJ1Y3QgYXZjX2F1ZGl0X2RhdGEgYWQ7Ci0gICAgdTMyIGRwZXJtID0g
Zmxhc2tfaW9tbXVfcmVzb3VyY2VfdXNlX3Blcm0oKTsKKyAgICB1MzIgZHBlcm0gPSBmbGFza19p
b21tdV9yZXNvdXJjZV91c2VfcGVybShkKTsKIAogICAgIHJjID0gY3VycmVudF9oYXNfcGVybShk
LCBTRUNDTEFTU19SRVNPVVJDRSwgUkVTT1VSQ0VfX0FERCk7CiAgICAgaWYgKCByYyApCkBAIC0x
MDQ2LDcgKzEwNDYsNyBAQCBzdGF0aWMgaW50IGZsYXNrX2lvbWVtX3Blcm1pc3Npb24oc3RydWN0
IGRvbWFpbiAqZCwgdWludDY0X3Qgc3RhcnQsIHVpbnQ2NF90IGVuZAogCiAgICAgZGF0YS5zc2lk
ID0gZG9tYWluX3NpZChjdXJyZW50LT5kb21haW4pOwogICAgIGRhdGEuZHNpZCA9IGRvbWFpbl9z
aWQoZCk7Ci0gICAgZGF0YS51c2VfcGVybSA9IGZsYXNrX2lvbW11X3Jlc291cmNlX3VzZV9wZXJt
KCk7CisgICAgZGF0YS51c2VfcGVybSA9IGZsYXNrX2lvbW11X3Jlc291cmNlX3VzZV9wZXJtKGQp
OwogCiAgICAgcmV0dXJuIHNlY3VyaXR5X2l0ZXJhdGVfaW9tZW1fc2lkcyhzdGFydCwgZW5kLCBf
aW9tZW1faGFzX3Blcm0sICZkYXRhKTsKIH0KQEAgLTEwNzEsNyArMTA3MSw3IEBAIHN0YXRpYyBp
bnQgZmxhc2tfcGNpX2NvbmZpZ19wZXJtaXNzaW9uKHN0cnVjdCBkb21haW4gKmQsIHVpbnQzMl90
IG1hY2hpbmVfYmRmLCB1CiAgICAgaWYgKCBhY2Nlc3MgJiYgKGVuZCA+PSAweDEwICYmIHN0YXJ0
IDwgMHgyOCkgKQogICAgICAgICBwZXJtID0gUkVTT1VSQ0VfX1NFVFVQOwogICAgIGVsc2UKLSAg
ICAgICAgcGVybSA9IGZsYXNrX2lvbW11X3Jlc291cmNlX3VzZV9wZXJtKCk7CisgICAgICAgIHBl
cm0gPSBmbGFza19pb21tdV9yZXNvdXJjZV91c2VfcGVybShkKTsKIAogICAgIEFWQ19BVURJVF9E
QVRBX0lOSVQoJmFkLCBERVYpOwogICAgIGFkLmRldmljZSA9ICh1bnNpZ25lZCBsb25nKSBtYWNo
aW5lX2JkZjsKQEAgLTEyOTYsNyArMTI5Niw3IEBAIHN0YXRpYyBpbnQgZmxhc2tfYXNzaWduX2Rl
dmljZShzdHJ1Y3QgZG9tYWluICpkLCB1aW50MzJfdCBtYWNoaW5lX2JkZikKICAgICB1MzIgZHNp
ZCwgcnNpZDsKICAgICBpbnQgcmMgPSAtRVBFUk07CiAgICAgc3RydWN0IGF2Y19hdWRpdF9kYXRh
IGFkOwotICAgIHUzMiBkcGVybSA9IGZsYXNrX2lvbW11X3Jlc291cmNlX3VzZV9wZXJtKCk7Cisg
ICAgdTMyIGRwZXJtID0gZmxhc2tfaW9tbXVfcmVzb3VyY2VfdXNlX3Blcm0oZCk7CiAKICAgICBp
ZiAoICFkICkKICAgICAgICAgcmV0dXJuIGZsYXNrX3Rlc3RfYXNzaWduX2RldmljZShtYWNoaW5l
X2JkZik7CkBAIC0xMzU1LDcgKzEzNTUsNyBAQCBzdGF0aWMgaW50IGZsYXNrX2Fzc2lnbl9kdGRl
dmljZShzdHJ1Y3QgZG9tYWluICpkLCBjb25zdCBjaGFyICpkdHBhdGgpCiAgICAgdTMyIGRzaWQs
IHJzaWQ7CiAgICAgaW50IHJjID0gLUVQRVJNOwogICAgIHN0cnVjdCBhdmNfYXVkaXRfZGF0YSBh
ZDsKLSAgICB1MzIgZHBlcm0gPSBmbGFza19pb21tdV9yZXNvdXJjZV91c2VfcGVybSgpOworICAg
IHUzMiBkcGVybSA9IGZsYXNrX2lvbW11X3Jlc291cmNlX3VzZV9wZXJtKGQpOwogCiAgICAgaWYg
KCAhZCApCiAgICAgICAgIHJldHVybiBmbGFza190ZXN0X2Fzc2lnbl9kdGRldmljZShkdHBhdGgp
OwpAQCAtMTU0MCw3ICsxNTQwLDcgQEAgc3RhdGljIGludCBmbGFza19pb3BvcnRfcGVybWlzc2lv
bihzdHJ1Y3QgZG9tYWluICpkLCB1aW50MzJfdCBzdGFydCwgdWludDMyX3QgZW4KIAogICAgIGRh
dGEuc3NpZCA9IGRvbWFpbl9zaWQoY3VycmVudC0+ZG9tYWluKTsKICAgICBkYXRhLmRzaWQgPSBk
b21haW5fc2lkKGQpOwotICAgIGRhdGEudXNlX3Blcm0gPSBmbGFza19pb21tdV9yZXNvdXJjZV91
c2VfcGVybSgpOworICAgIGRhdGEudXNlX3Blcm0gPSBmbGFza19pb21tdV9yZXNvdXJjZV91c2Vf
cGVybShkKTsKIAogICAgIHJldHVybiBzZWN1cml0eV9pdGVyYXRlX2lvcG9ydF9zaWRzKHN0YXJ0
LCBlbmQsIF9pb3BvcnRfaGFzX3Blcm0sICZkYXRhKTsKIH0KLS0gCjIuMjAuMS4yLmdiMjFlYmI2
NzEKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4t
ZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczov
L2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 0481CEB062
	for <lists+xen-devel@lfdr.de>; Thu, 31 Oct 2019 13:33:46 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iQ9bk-000053-MY; Thu, 31 Oct 2019 12:31:20 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=CAAN=YY=xenbits.xen.org=iwj@srs-us1.protection.inumbo.net>)
 id 1iQ9bj-0008Vk-46
 for xen-devel@lists.xen.org; Thu, 31 Oct 2019 12:31:19 +0000
X-Inumbo-ID: 4ef634f6-fbda-11e9-8aca-bc764e2007e4
Received: from mail.xenproject.org (unknown [104.130.215.37])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 4ef634f6-fbda-11e9-8aca-bc764e2007e4;
 Thu, 31 Oct 2019 12:31:06 +0000 (UTC)
Received: from xenbits.xenproject.org ([104.239.192.120])
 by mail.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <iwj@xenbits.xen.org>)
 id 1iQ9bP-0007DL-Cp; Thu, 31 Oct 2019 12:30:59 +0000
Received: from iwj by xenbits.xenproject.org with local (Exim 4.89)
 (envelope-from <iwj@xenbits.xen.org>)
 id 1iQ9bP-0004PX-AC; Thu, 31 Oct 2019 12:30:59 +0000
Content-Type: multipart/mixed; boundary="=separator"; charset="utf-8"
Content-Transfer-Encoding: binary
MIME-Version: 1.0
X-Mailer: MIME-tools 5.508 (Entity 5.508)
To: xen-announce@lists.xen.org, xen-devel@lists.xen.org,
 xen-users@lists.xen.org, oss-security@lists.openwall.com
From: Xen.org security team <security@xen.org>
Message-Id: <E1iQ9bP-0004PX-AC@xenbits.xenproject.org>
Date: Thu, 31 Oct 2019 12:30:59 +0000
Subject: [Xen-devel] Xen Security Advisory 302 v5 (CVE-2019-18424) - passed
 through PCI devices may corrupt host memory after deassignment
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: "Xen.org security team" <security-team-members@xen.org>
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

--=separator
Content-Type: text/plain; charset="utf-8"
Content-Disposition: inline
Content-Transfer-Encoding: 7bit

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

            Xen Security Advisory CVE-2019-18424 / XSA-302
                               version 5

 passed through PCI devices may corrupt host memory after deassignment

UPDATES IN VERSION 5
====================

Public release.

The patches are broken on ARM (which is not affected by the issue).
Don't apply the patches on ARM.  See Resolution.

ISSUE DESCRIPTION
=================

When a PCI device is assigned to an untrusted domain, it is possible
for that domain to program the device to DMA to an arbitrary address.
The IOMMU is used to protect the host from malicious DMA by making
sure that the device addresses can only target memory assigned to the
guest. However, when the guest domain is torn down, or the device is
deassigned, the device is assigned back to dom0, thus allowing any
in-flight DMA to potentially target critical host data.

IMPACT
======

An untrusted domain with access to a physical device can DMA into host
memory, leading to privilege escalation.

VULNERABLE SYSTEMS
==================

Only systems where guests are given direct access to physical devices
capable of DMA (PCI pass-through) are vulnerable.  Systems which do
not use PCI pass-through are not vulnerable.

MITIGATION
==========

In some configurations, use of passthrough can be replaced with a
higher-level protocol such as Xen PV block or network devices.

CREDITS
=======

This issue was discovered by Paul Durrant of Citrix.

RESOLUTION
==========

Applying the appropriate attached patchset should resolve this issue.
For Xen 4.9 and earlier at least the first patch of XSA-299
(whitespace cleanup) is also needed for XSA-302 to apply.

Unfortunately, at the time of writing, these patches have not been
tested to our satisfaction.

The patches are known to break on ARM.  ARM is not affected by the
issue, so do not apply these patches on ARM systems.  (On x86, there
is a latent bug but the patches are good to use.)

xsa302/*.patch         xen-unstable
xsa302-4.12/*.patch    Xen 4.12.x
xsa302-4.11/*.patch    Xen 4.11.x
xsa302-4.10/*.patch    Xen 4.10.x
xsa302-4.9/*.patch     Xen 4.9.x, Xen 4.8.x

$ sha256sum xsa302* xsa302*/*
d722d1bed2440a5d35f0fd041e4a77966b7d26980a0f874d38d48710db0b9ebd  xsa302.meta
703faced133ca21142f484acd8cf16578258e12ae0cf1413a5d9252f1e099465  xsa302-4.9/0001-IOMMU-add-missing-HVM-check.patch
edb4753b91fa66e2f4b51d0075d106fc28d8451241ba482a33c2db4be53f21d1  xsa302-4.9/0002-passthrough-quarantine-PCI-devices.patch
3c79107d8fd94807543443192fb31f3d188912c208f4dbda61f1f2ff92701afc  xsa302-4.10/0001-IOMMU-add-missing-HVM-check.patch
2a76add5a907baf0217e57e2a4dca91a6a8ce84c67b9ff87be1bcbb1f29efdc6  xsa302-4.10/0002-passthrough-quarantine-PCI-devices.patch
a75723160c52c2c65d563905d0904b587beda1cfb6ca3ee18fb70e79818d3faa  xsa302-4.11/0001-IOMMU-add-missing-HVM-check.patch
48b9dae7adbe2438dcaa00f969532d835061cb4a06ab2bf47ada2afb644de4c5  xsa302-4.11/0002-passthrough-quarantine-PCI-devices.patch
a21efa6cae14e87318ca3927f0ac310aee2dd1323f2dbf040c0fe80789d78712  xsa302-4.12/0001-IOMMU-add-missing-HVM-check.patch
0a95f750ad1d5eb1838b6488e4ac188acdc2e568eb21b26306d5af2980bffb58  xsa302-4.12/0002-passthrough-quarantine-PCI-devices.patch
11d7015960eab265b1f9ce372dd14597b6c4cc7907d77ed3eed14d161dd50e5c  xsa302/0001-passthrough-quarantine-PCI-devices.patch
$

DEPLOYMENT DURING EMBARGO
=========================

Deployment of the *patches* described above (or others which are
substantially similar) is permitted during the embargo, even on
public-facing systems with untrusted guest users and administrators.

But: Distribution of updated software is prohibited (except to other
members of the predisclosure list).

Also: deployment of the reconfiguration *mitigation* is NOT permitted
(except where all the affected systems and VMs are administered and
used only by organisations which are members of the Xen Project
Security Issues Predisclosure List).  Specifically, deployment on
public cloud systems is NOT permitted.

This is because this reconfiguration reveals that a PCI passthrough
vulnerability is involved.

Deployment of that migitation is permitted only AFTER the embargo
ends.

Predisclosure list members who wish to deploy significantly different
patches and/or mitigations, please contact the Xen Project Security
Team.

(Note: this during-embargo deployment notice is retained in
post-embargo publicly released Xen Project advisories, even though it
is then no longer applicable.  This is to enable the community to have
oversight of the Xen Project Security Team's decisionmaking.)

For more information about permissible uses of embargoed information,
consult the Xen Project community's agreed Security Policy:
  http://www.xenproject.org/security-policy.html
-----BEGIN PGP SIGNATURE-----

iQFABAEBCAAqFiEEI+MiLBRfRHX6gGCng/4UyVfoK9kFAl260/wMHHBncEB4ZW4u
b3JnAAoJEIP+FMlX6CvZ2TYH/A+tmA2Wsw0NbdEhSzztj6cVFZpev16S75vOxLUm
/dFTQSxNVeqyzZjI7u9JPZUatQVIHwdDPi9Oiwygn8pFid1RBe+fn3saM3JdNQrA
pYVOCEYGoxnz/lpPLWfcI8aUIkdhU4Ns/hwXVa6lUNno9MaqqJR278k6nmB9/0QS
bFvsMirqTKHm7wQptY5mRcULdjcpn+u4W45nje3+TU0mMRQkbm+pnNX57qzn/LFI
/atzBQ8iyv9/y3e/soAXv3AkWzs/lUVIAZepaFhXCHi3WuMsMUyZAdDOUBmD0tBt
pjQzx408ZoMPtqqDKpY1qEn9Bu1MsIxx/4htqlgG0c9Kh1U=
=cUbr
-----END PGP SIGNATURE-----

--=separator
Content-Type: application/octet-stream; name="xsa302.meta"
Content-Disposition: attachment; filename="xsa302.meta"
Content-Transfer-Encoding: base64

ewogICJYU0EiOiAzMDIsCiAgIlN1cHBvcnRlZFZlcnNpb25zIjogWwogICAg
Im1hc3RlciIsCiAgICAiNC4xMiIsCiAgICAiNC4xMSIsCiAgICAiNC4xMCIs
CiAgICAiNC45IiwKICAgICI0LjgiCiAgXSwKICAiVHJlZXMiOiBbCiAgICAi
eGVuIgogIF0sCiAgIlJlY2lwZXMiOiB7CiAgICAiNC4xMCI6IHsKICAgICAg
IlJlY2lwZXMiOiB7CiAgICAgICAgInhlbiI6IHsKICAgICAgICAgICJTdGFi
bGVSZWYiOiAiMzEzMWJmOTU2YWIxNTkyOTVlY2RkZTBjNWFkMDAzZDBjNWFm
NDY5NSIsCiAgICAgICAgICAiUHJlcmVxcyI6IFsKICAgICAgICAgICAgMjk2
LAogICAgICAgICAgICAyOTgsCiAgICAgICAgICAgIDI5OSwKICAgICAgICAg
ICAgMzAxCiAgICAgICAgICBdLAogICAgICAgICAgIlBhdGNoZXMiOiBbCiAg
ICAgICAgICAgICJ4c2EzMDItNC4xMC8qIgogICAgICAgICAgXQogICAgICAg
IH0KICAgICAgfQogICAgfSwKICAgICI0LjExIjogewogICAgICAiUmVjaXBl
cyI6IHsKICAgICAgICAieGVuIjogewogICAgICAgICAgIlN0YWJsZVJlZiI6
ICIzMzQyZWU5MzE4Y2QzOGJhMDA2MjU1YjY4N2FiN2ExNDUzOTllYTkyIiwK
ICAgICAgICAgICJQcmVyZXFzIjogWwogICAgICAgICAgICAyOTYsCiAgICAg
ICAgICAgIDI5OCwKICAgICAgICAgICAgMjk5LAogICAgICAgICAgICAzMDEK
ICAgICAgICAgIF0sCiAgICAgICAgICAiUGF0Y2hlcyI6IFsKICAgICAgICAg
ICAgInhzYTMwMi00LjExLyoucGF0Y2giCiAgICAgICAgICBdCiAgICAgICAg
fQogICAgICB9CiAgICB9LAogICAgIjQuMTIiOiB7CiAgICAgICJSZWNpcGVz
IjogewogICAgICAgICJ4ZW4iOiB7CiAgICAgICAgICAiU3RhYmxlUmVmIjog
IjU5OWQ2ZDIzY2JiNzkwYTc4OGY3YTQ5YWI0ZjExZjFhM2I1YjQyOWUiLAog
ICAgICAgICAgIlByZXJlcXMiOiBbCiAgICAgICAgICAgIDI5NiwKICAgICAg
ICAgICAgMjk4LAogICAgICAgICAgICAyOTksCiAgICAgICAgICAgIDMwMQog
ICAgICAgICAgXSwKICAgICAgICAgICJQYXRjaGVzIjogWwogICAgICAgICAg
ICAieHNhMzAyLTQuMTIvKi5wYXRjaCIKICAgICAgICAgIF0KICAgICAgICB9
CiAgICAgIH0KICAgIH0sCiAgICAiNC44IjogewogICAgICAiUmVjaXBlcyI6
IHsKICAgICAgICAieGVuIjogewogICAgICAgICAgIlN0YWJsZVJlZiI6ICJj
NjcyMTBmNjBkZmE4MzU2NWQyNmFlNzEwZTRmNWU3MjlhOTVkY2U1IiwKICAg
ICAgICAgICJQcmVyZXFzIjogWwogICAgICAgICAgICAyOTYsCiAgICAgICAg
ICAgIDI5OCwKICAgICAgICAgICAgMjk5LAogICAgICAgICAgICAzMDEKICAg
ICAgICAgIF0sCiAgICAgICAgICAiUGF0Y2hlcyI6IFsKICAgICAgICAgICAg
InhzYTMwMi00LjkvKi5wYXRjaCIKICAgICAgICAgIF0KICAgICAgICB9CiAg
ICAgIH0KICAgIH0sCiAgICAiNC45IjogewogICAgICAiUmVjaXBlcyI6IHsK
ICAgICAgICAieGVuIjogewogICAgICAgICAgIlN0YWJsZVJlZiI6ICI4ZDJh
Njg4MDE1MTkzZTIwYWU0N2ZlM2MyMDhmOTkxMjgyNDBmODIxIiwKICAgICAg
ICAgICJQcmVyZXFzIjogWwogICAgICAgICAgICAyOTYsCiAgICAgICAgICAg
IDI5OCwKICAgICAgICAgICAgMjk5LAogICAgICAgICAgICAzMDEKICAgICAg
ICAgIF0sCiAgICAgICAgICAiUGF0Y2hlcyI6IFsKICAgICAgICAgICAgInhz
YTMwMi00LjkvKi5wYXRjaCIKICAgICAgICAgIF0KICAgICAgICB9CiAgICAg
IH0KICAgIH0sCiAgICAibWFzdGVyIjogewogICAgICAiUmVjaXBlcyI6IHsK
ICAgICAgICAieGVuIjogewogICAgICAgICAgIlN0YWJsZVJlZiI6ICI1NWFi
MjkyYzQyZGI0MWIwNWNmZGJhMDEyNjgwYmYxZTBlYTAyZjdhIiwKICAgICAg
ICAgICJQcmVyZXFzIjogWwogICAgICAgICAgICAyOTYsCiAgICAgICAgICAg
IDI5OCwKICAgICAgICAgICAgMjk5LAogICAgICAgICAgICAzMDEKICAgICAg
ICAgIF0sCiAgICAgICAgICAiUGF0Y2hlcyI6IFsKICAgICAgICAgICAgInhz
YTMwMi8qLnBhdGNoIgogICAgICAgICAgXQogICAgICAgIH0KICAgICAgfQog
ICAgfQogIH0KfQ==

--=separator
Content-Type: application/octet-stream;
 name="xsa302-4.9/0001-IOMMU-add-missing-HVM-check.patch"
Content-Disposition: attachment;
 filename="xsa302-4.9/0001-IOMMU-add-missing-HVM-check.patch"
Content-Transfer-Encoding: base64

RnJvbSBiMTYxNjA0NWRjMmZjM2QyOGU2MTcwMTY0Y2VlZWY2M2E5ZjMyNWI5
IE1vbiBTZXAgMTcgMDA6MDA6MDAgMjAwMQpGcm9tOiBKYW4gQmV1bGljaCA8
amJldWxpY2hAc3VzZS5jb20+CkRhdGU6IFdlZCwgMiBPY3QgMjAxOSAxMzoz
Njo1OSArMDIwMApTdWJqZWN0OiBbUEFUQ0ggMS8yXSBJT01NVTogYWRkIG1p
c3NpbmcgSFZNIGNoZWNrCk1JTUUtVmVyc2lvbjogMS4wCkNvbnRlbnQtVHlw
ZTogdGV4dC9wbGFpbjsgY2hhcnNldD1VVEYtOApDb250ZW50LVRyYW5zZmVy
LUVuY29kaW5nOiA4Yml0CgpGaXggYW4gdW5ndWFyZGVkIGQtPmFyY2guaHZt
IGFjY2VzcyBpbiBhc3NpZ25fZGV2aWNlKCkuCgpTaWduZWQtb2ZmLWJ5OiBK
YW4gQmV1bGljaCA8amJldWxpY2hAc3VzZS5jb20+ClJldmlld2VkLWJ5OiBS
b2dlciBQYXUgTW9ubsOpIDxyb2dlci5wYXVAY2l0cml4LmNvbT4KQWNrZWQt
Ynk6IEFuZHJldyBDb29wZXIgPGFuZHJldy5jb29wZXIzQGNpdHJpeC5jb20+
CgooY2hlcnJ5IHBpY2tlZCBmcm9tIGNvbW1pdCA0MWZkMTAwOWNkNzQxNmI3
M2Q3NDVhNzdjMjRiNGU4ZDFhMjk2ZmU2KQpTaWduZWQtb2ZmLWJ5OiBJYW4g
SmFja3NvbiA8aWFuLmphY2tzb25AZXUuY2l0cml4LmNvbT4KLS0tCiB4ZW4v
ZHJpdmVycy9wYXNzdGhyb3VnaC9wY2kuYyB8IDMgKystCiAxIGZpbGUgY2hh
bmdlZCwgMiBpbnNlcnRpb25zKCspLCAxIGRlbGV0aW9uKC0pCgpkaWZmIC0t
Z2l0IGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvcGNpLmMgYi94ZW4vZHJp
dmVycy9wYXNzdGhyb3VnaC9wY2kuYwppbmRleCBiMDBkZTI0M2I4Li5lY2I2
N2ViYzcwIDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9w
Y2kuYworKysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9wY2kuYwpAQCAt
MTM3MSw3ICsxMzcxLDggQEAgc3RhdGljIGludCBhc3NpZ25fZGV2aWNlKHN0
cnVjdCBkb21haW4gKmQsIHUxNiBzZWcsIHU4IGJ1cywgdTggZGV2Zm4sIHUz
MiBmbGFnKQogICAgIC8qIFByZXZlbnQgZGV2aWNlIGFzc2lnbiBpZiBtZW0g
cGFnaW5nIG9yIG1lbSBzaGFyaW5nIGhhdmUgYmVlbiAKICAgICAgKiBlbmFi
bGVkIGZvciB0aGlzIGRvbWFpbiAqLwogICAgIGlmICggdW5saWtlbHkoIW5l
ZWRfaW9tbXUoZCkgJiYKLSAgICAgICAgICAgIChkLT5hcmNoLmh2bV9kb21h
aW4ubWVtX3NoYXJpbmdfZW5hYmxlZCB8fAorICAgICAgICAgICAgKChpc19o
dm1fZG9tYWluKGQpICYmCisgICAgICAgICAgICAgIGQtPmFyY2guaHZtX2Rv
bWFpbi5tZW1fc2hhcmluZ19lbmFibGVkKSB8fAogICAgICAgICAgICAgIGQt
PnZtX2V2ZW50LT5wYWdpbmcucmluZ19wYWdlIHx8CiAgICAgICAgICAgICAg
cDJtX2dldF9ob3N0cDJtKGQpLT5nbG9iYWxfbG9nZGlydHkpKSApCiAgICAg
ICAgIHJldHVybiAtRVhERVY7Ci0tIAoyLjExLjAKCg==

--=separator
Content-Type: application/octet-stream;
 name="xsa302-4.9/0002-passthrough-quarantine-PCI-devices.patch"
Content-Disposition: attachment;
 filename="xsa302-4.9/0002-passthrough-quarantine-PCI-devices.patch"
Content-Transfer-Encoding: base64

RnJvbSA4OGNlMzFiNjRiOWNkYTkzNzYyZGIwYjg4ZDI5NDMxODBhZmUzYTMz
IE1vbiBTZXAgMTcgMDA6MDA6MDAgMjAwMQpGcm9tOiBQYXVsIER1cnJhbnQg
PHBhdWwuZHVycmFudEBjaXRyaXguY29tPgpEYXRlOiBNb24sIDE0IE9jdCAy
MDE5IDE3OjUyOjU5ICswMTAwClN1YmplY3Q6IFtQQVRDSCAyLzJdIHBhc3N0
aHJvdWdoOiBxdWFyYW50aW5lIFBDSSBkZXZpY2VzCgpXaGVuIGEgUENJIGRl
dmljZSBpcyBhc3NpZ25lZCB0byBhbiB1bnRydXN0ZWQgZG9tYWluLCBpdCBp
cyBwb3NzaWJsZSBmb3IKdGhhdCBkb21haW4gdG8gcHJvZ3JhbSB0aGUgZGV2
aWNlIHRvIERNQSB0byBhbiBhcmJpdHJhcnkgYWRkcmVzcy4gVGhlCklPTU1V
IGlzIHVzZWQgdG8gcHJvdGVjdCB0aGUgaG9zdCBmcm9tIG1hbGljaW91cyBE
TUEgYnkgbWFraW5nIHN1cmUgdGhhdAp0aGUgZGV2aWNlIGFkZHJlc3NlcyBj
YW4gb25seSB0YXJnZXQgbWVtb3J5IGFzc2lnbmVkIHRvIHRoZSBndWVzdC4g
SG93ZXZlciwKd2hlbiB0aGUgZ3Vlc3QgZG9tYWluIGlzIHRvcm4gZG93biB0
aGUgZGV2aWNlIGlzIGFzc2lnbmVkIGJhY2sgdG8gZG9tMCwKdGh1cyBhbGxv
d2luZyBhbnkgaW4tZmxpZ2h0IERNQSB0byBwb3RlbnRpYWxseSB0YXJnZXQg
Y3JpdGljYWwgaG9zdCBkYXRhLgoKVGhpcyBwYXRjaCBpbnRyb2R1Y2VzIGEg
J3F1YXJhbnRpbmUnIGZvciBQQ0kgZGV2aWNlcyB1c2luZyBkb21faW8uIFdo
ZW4KdGhlIHRvb2xzdGFjayBtYWtlcyBhIGRldmljZSBhc3NpZ25hYmxlIChi
eSBiaW5kaW5nIGl0IHRvIHBjaWJhY2spLCBpdAp3aWxsIG5vdyBhbHNvIGFz
c2lnbiBpdCB0byBET01JRF9JTyBhbmQgdGhlIGRldmljZSB3aWxsIG9ubHkg
YmUgYXNzaWduZWQKYmFjayB0byBkb20wIHdoZW4gdGhlIGRldmljZSBpcyBt
YWRlIHVuYXNzaWduYWJsZSBhZ2Fpbi4gV2hpbHN0IGRldmljZSBpcwphc3Np
Z25hYmxlIGl0IHdpbGwgb25seSBldmVyIHRyYW5zZmVyIGJldHdlZW4gZG9t
X2lvIGFuZCBndWVzdCBkb21haW5zLgpkb21faW8gaXMgYWN0dWFsbHkgb25s
eSB1c2VkIGFzIGEgc2VudGluZWwgZG9tYWluIGZvciBxdWFyYW50aW5pbmcg
cHVycG9zZXM7Cml0IGlzIG5vdCBjb25maWd1cmVkIHdpdGggYW55IElPTU1V
IG1hcHBpbmdzLiBBc3NpZ25tZW50IHRvIGRvbV9pbyBzaW1wbHkKbWVhbnMg
dGhhdCB0aGUgZGV2aWNlJ3MgaW5pdGlhdG9yIChyZXF1ZXN0b3IpIGlkZW50
aWZpZXIgaXMgbm90IHByZXNlbnQgaW4KdGhlIElPTU1VJ3MgZGV2aWNlIHRh
YmxlIGFuZCB0aHVzIGFueSBETUEgdHJhbnNhY3Rpb25zIGlzc3VlZCB3aWxs
IGJlCnRlcm1pbmF0ZWQgd2l0aCBhIGZhdWx0IGNvbmRpdGlvbi4KCkluIGFk
ZGl0aW9uLCBhIGZpeCB0byBhc3NpZ25tZW50IGhhbmRsaW5nIGlzIG1hZGUg
Zm9yIFZULWQuICBGYWlsdXJlCmR1cmluZyB0aGUgYXNzaWdubWVudCBzdGVw
IHNob3VsZCBub3QgbGVhZCB0byBhIGRldmljZSBzdGlsbCBiZWluZwphc3Nv
Y2lhdGVkIHdpdGggaXRzIHByaW9yIG93bmVyLiBIYW5kIHRoZSBkZXZpY2Ug
dG8gRG9tSU8gdGVtcG9yYXJpbHksCnVudGlsIHRoZSBhc3NpZ25tZW50IHN0
ZXAgaGFzIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuICBSZW1vdmUgdGhlIFBJ
Cmhvb2tzIGZyb20gdGhlIHNvdXJjZSBkb21haW4gdGhlbiBlYXJsaWVyIGFz
IHdlbGwuCgpGYWlsdXJlIG9mIHRoZSByZWNvdmVyeSByZWFzc2lnbl9kZXZp
Y2Vfb3duZXJzaGlwKCkgbWF5IG5vdCBnbyBzaWxlbnQ6ClRoZXJlIGUuZy4g
bWF5IHN0aWxsIGJlIGxlZnQgb3ZlciBSTVJSIG1hcHBpbmdzIGluIHRoZSBk
b21haW4gYXNzaWdubWVudAp0byB3aGljaCBoYXMgZmFpbGVkLCBhbmQgaGVu
Y2Ugd2UgY2FuJ3QgYWxsb3cgdGhhdCBkb21haW4gdG8gY29udGludWUKZXhl
Y3V0aW5nLgoKTk9URTogVGhpcyBwYXRjaCBhbHNvIGluY2x1ZGVzIG9uZSBw
cmludGsoKSBjbGVhbnVwOyB0aGUKICAgICAgIlhFTl9ET01DVExfYXNzaWdu
X2RldmljZTogIiB0YWcgaXMgZHJvcHBlZCBpbiBpb21tdV9kb19wY2lfZG9t
Y3RsKCksCiAgICAgIHNpbmNlIHNpbWlsYXIgcHJpbnRrKCktcyBlbHNld2hl
cmUgYWxzbyBkb24ndCBsb2cgc3VjaCBhIHRhZy4KClRoaXMgaXMgWFNBLTMw
Mi4KClNpZ25lZC1vZmYtYnk6IFBhdWwgRHVycmFudCA8cGF1bC5kdXJyYW50
QGNpdHJpeC5jb20+ClNpZ25lZC1vZmYtYnk6IEphbiBCZXVsaWNoIDxqYmV1
bGljaEBzdXNlLmNvbT4KU2lnbmVkLW9mZi1ieTogSWFuIEphY2tzb24gPGlh
bi5qYWNrc29uQGV1LmNpdHJpeC5jb20+Ci0tLQogdG9vbHMvbGlieGwvbGli
eGxfcGNpLmMgICAgICAgICAgICAgICAgICAgICB8IDI1ICsrKysrKysrKysr
LQogeGVuL2FyY2gveDg2L21tLmMgICAgICAgICAgICAgICAgICAgICAgICAg
ICB8ICAyICsKIHhlbi9jb21tb24vZG9tY3RsLmMgICAgICAgICAgICAgICAg
ICAgICAgICAgfCAxNCArKysrKystCiB4ZW4vZHJpdmVycy9wYXNzdGhyb3Vn
aC9hbWQvcGNpX2FtZF9pb21tdS5jIHwgMTAgKysrKy0KIHhlbi9kcml2ZXJz
L3Bhc3N0aHJvdWdoL2lvbW11LmMgICAgICAgICAgICAgfCAgOSArKysrKwog
eGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvcGNpLmMgICAgICAgICAgICAgICB8
IDU5ICsrKysrKysrKysrKysrKysrKysrKystLS0tLS0tCiB4ZW4vZHJpdmVy
cy9wYXNzdGhyb3VnaC92dGQvaW9tbXUuYyAgICAgICAgIHwgNDAgKysrKysr
KysrKysrKysrKy0tLQogeGVuL2luY2x1ZGUveGVuL3BjaS5oICAgICAgICAg
ICAgICAgICAgICAgICB8ICAzICsrCiA4IGZpbGVzIGNoYW5nZWQsIDEzOCBp
bnNlcnRpb25zKCspLCAyNCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS90
b29scy9saWJ4bC9saWJ4bF9wY2kuYyBiL3Rvb2xzL2xpYnhsL2xpYnhsX3Bj
aS5jCmluZGV4IGIxNGRmMTYyOWEuLjg0YTI5M2NmOTkgMTAwNjQ0Ci0tLSBh
L3Rvb2xzL2xpYnhsL2xpYnhsX3BjaS5jCisrKyBiL3Rvb2xzL2xpYnhsL2xp
YnhsX3BjaS5jCkBAIC03NjEsNiArNzYxLDcgQEAgc3RhdGljIGludCBsaWJ4
bF9fZGV2aWNlX3BjaV9hc3NpZ25hYmxlX2FkZChsaWJ4bF9fZ2MgKmdjLAog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBs
aWJ4bF9kZXZpY2VfcGNpICpwY2lkZXYsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGludCByZWJpbmQpCiB7CisgICAg
bGlieGxfY3R4ICpjdHggPSBsaWJ4bF9fZ2Nfb3duZXIoZ2MpOwogICAgIHVu
c2lnbmVkIGRvbSwgYnVzLCBkZXYsIGZ1bmM7CiAgICAgY2hhciAqc3BhdGgs
ICpkcml2ZXJfcGF0aCA9IE5VTEw7CiAgICAgaW50IHJjOwpAQCAtNzg2LDcg
Kzc4Nyw3IEBAIHN0YXRpYyBpbnQgbGlieGxfX2RldmljZV9wY2lfYXNzaWdu
YWJsZV9hZGQobGlieGxfX2djICpnYywKICAgICB9CiAgICAgaWYgKCByYyAp
IHsKICAgICAgICAgTE9HKFdBUk4sIFBDSV9CREYiIGFscmVhZHkgYXNzaWdu
ZWQgdG8gcGNpYmFjayIsIGRvbSwgYnVzLCBkZXYsIGZ1bmMpOwotICAgICAg
ICByZXR1cm4gMDsKKyAgICAgICAgZ290byBxdWFyYW50aW5lOwogICAgIH0K
IAogICAgIC8qIENoZWNrIHRvIHNlZSBpZiB0aGVyZSdzIGFscmVhZHkgYSBk
cml2ZXIgdGhhdCB3ZSBuZWVkIHRvIHVuYmluZCBmcm9tICovCkBAIC04MTcs
NiArODE4LDE5IEBAIHN0YXRpYyBpbnQgbGlieGxfX2RldmljZV9wY2lfYXNz
aWduYWJsZV9hZGQobGlieGxfX2djICpnYywKICAgICAgICAgcmV0dXJuIEVS
Uk9SX0ZBSUw7CiAgICAgfQogCitxdWFyYW50aW5lOgorICAgIC8qCisgICAg
ICogRE9NSURfSU8gaXMganVzdCBhIHNlbnRpbmVsIGRvbWFpbiwgd2l0aG91
dCBhbnkgYWN0dWFsIG1hcHBpbmdzLAorICAgICAqIHNvIGFsd2F5cyBwYXNz
IFhFTl9ET01DVExfREVWX1JETV9SRUxBWEVEIHRvIGF2b2lkIGFzc2lnbm1l
bnQgYmVpbmcKKyAgICAgKiB1bm5lY2Vzc2FyaWx5IGRlbmllZC4KKyAgICAg
Ki8KKyAgICByYyA9IHhjX2Fzc2lnbl9kZXZpY2UoY3R4LT54Y2gsIERPTUlE
X0lPLCBwY2lkZXZfZW5jb2RlX2JkZihwY2lkZXYpLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICBYRU5fRE9NQ1RMX0RFVl9SRE1fUkVMQVhFRCk7Cisg
ICAgaWYgKCByYyA8IDAgKSB7CisgICAgICAgIExPRyhFUlJPUiwgImZhaWxl
ZCB0byBxdWFyYW50aW5lICJQQ0lfQkRGLCBkb20sIGJ1cywgZGV2LCBmdW5j
KTsKKyAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUw7CisgICAgfQorCiAgICAg
cmV0dXJuIDA7CiB9CiAKQEAgLTgyNCw5ICs4MzgsMTggQEAgc3RhdGljIGlu
dCBsaWJ4bF9fZGV2aWNlX3BjaV9hc3NpZ25hYmxlX3JlbW92ZShsaWJ4bF9f
Z2MgKmdjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBsaWJ4bF9kZXZpY2VfcGNpICpwY2lkZXYsCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBy
ZWJpbmQpCiB7CisgICAgbGlieGxfY3R4ICpjdHggPSBsaWJ4bF9fZ2Nfb3du
ZXIoZ2MpOwogICAgIGludCByYzsKICAgICBjaGFyICpkcml2ZXJfcGF0aDsK
IAorICAgIC8qIERlLXF1YXJhbnRpbmUgKi8KKyAgICByYyA9IHhjX2RlYXNz
aWduX2RldmljZShjdHgtPnhjaCwgRE9NSURfSU8sIHBjaWRldl9lbmNvZGVf
YmRmKHBjaWRldikpOworICAgIGlmICggcmMgPCAwICkgeworICAgICAgICBM
T0coRVJST1IsICJmYWlsZWQgdG8gZGUtcXVhcmFudGluZSAiUENJX0JERiwg
cGNpZGV2LT5kb21haW4sIHBjaWRldi0+YnVzLAorICAgICAgICAgICAgcGNp
ZGV2LT5kZXYsIHBjaWRldi0+ZnVuYyk7CisgICAgICAgIHJldHVybiBFUlJP
Ul9GQUlMOworICAgIH0KKwogICAgIC8qIFVuYmluZCBmcm9tIHBjaWJhY2sg
Ki8KICAgICBpZiAoIChyYz1wY2liYWNrX2Rldl9pc19hc3NpZ25lZChnYywg
cGNpZGV2KSkgPCAwICkgewogICAgICAgICByZXR1cm4gRVJST1JfRkFJTDsK
ZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9tbS5jIGIveGVuL2FyY2gveDg2
L21tLmMKaW5kZXggZjdlMGNjNDUwOC4uZGYyODM5MTg1OSAxMDA2NDQKLS0t
IGEveGVuL2FyY2gveDg2L21tLmMKKysrIGIveGVuL2FyY2gveDg2L21tLmMK
QEAgLTMwOCw5ICszMDgsMTEgQEAgdm9pZCBfX2luaXQgYXJjaF9pbml0X21l
bW9yeSh2b2lkKQogICAgICAqIEluaXRpYWxpc2Ugb3VyIERPTUlEX0lPIGRv
bWFpbi4KICAgICAgKiBUaGlzIGRvbWFpbiBvd25zIEkvTyBwYWdlcyB0aGF0
IGFyZSB3aXRoaW4gdGhlIHJhbmdlIG9mIHRoZSBwYWdlX2luZm8KICAgICAg
KiBhcnJheS4gTWFwcGluZ3Mgb2NjdXIgYXQgdGhlIHByaXYgb2YgdGhlIGNh
bGxlci4KKyAgICAgKiBRdWFyYW50aW5lZCBQQ0kgZGV2aWNlcyB3aWxsIGJl
IGFzc29jaWF0ZWQgd2l0aCB0aGlzIGRvbWFpbi4KICAgICAgKi8KICAgICBk
b21faW8gPSBkb21haW5fY3JlYXRlKERPTUlEX0lPLCBET01DUkZfZHVtbXks
IDAsIE5VTEwpOwogICAgIEJVR19PTihJU19FUlIoZG9tX2lvKSk7CisgICAg
SU5JVF9MSVNUX0hFQUQoJmRvbV9pby0+YXJjaC5wZGV2X2xpc3QpOwogCiAg
ICAgLyoKICAgICAgKiBJbml0aWFsaXNlIG91ciBDT1cgZG9tYWluLgpkaWZm
IC0tZ2l0IGEveGVuL2NvbW1vbi9kb21jdGwuYyBiL3hlbi9jb21tb24vZG9t
Y3RsLmMKaW5kZXggMDExYTdkZTM1NS4uZjhmN2FhNWY0MCAxMDA2NDQKLS0t
IGEveGVuL2NvbW1vbi9kb21jdGwuYworKysgYi94ZW4vY29tbW9uL2RvbWN0
bC5jCkBAIC0zOTYsNiArMzk2LDE2IEBAIGxvbmcgZG9fZG9tY3RsKFhFTl9H
VUVTVF9IQU5ETEVfUEFSQU0oeGVuX2RvbWN0bF90KSB1X2RvbWN0bCkKICAg
ICBjYXNlIFhFTl9ET01DVExfZ2Ric3hfZ3Vlc3RtZW1pbzoKICAgICAgICAg
ZCA9IE5VTEw7CiAgICAgICAgIGJyZWFrOworICAgIGNhc2UgWEVOX0RPTUNU
TF9hc3NpZ25fZGV2aWNlOgorICAgIGNhc2UgWEVOX0RPTUNUTF9kZWFzc2ln
bl9kZXZpY2U6CisgICAgICAgIGlmICggb3AtPmRvbWFpbiA9PSBET01JRF9J
TyApCisgICAgICAgIHsKKyAgICAgICAgICAgIGQgPSBkb21faW87CisgICAg
ICAgICAgICBicmVhazsKKyAgICAgICAgfQorICAgICAgICBlbHNlIGlmICgg
b3AtPmRvbWFpbiA9PSBET01JRF9JTlZBTElEICkKKyAgICAgICAgICAgIHJl
dHVybiAtRVNSQ0g7CisgICAgICAgIC8qIGZhbGwgdGhyb3VnaCAqLwogICAg
IGRlZmF1bHQ6CiAgICAgICAgIGQgPSByY3VfbG9ja19kb21haW5fYnlfaWQo
b3AtPmRvbWFpbik7CiAgICAgICAgIGlmICggIWQgJiYgb3AtPmNtZCAhPSBY
RU5fRE9NQ1RMX2dldGRvbWFpbmluZm8gKQpAQCAtNDA4LDcgKzQxOCw3IEBA
IGxvbmcgZG9fZG9tY3RsKFhFTl9HVUVTVF9IQU5ETEVfUEFSQU0oeGVuX2Rv
bWN0bF90KSB1X2RvbWN0bCkKIAogICAgIGlmICggIWRvbWN0bF9sb2NrX2Fj
cXVpcmUoKSApCiAgICAgewotICAgICAgICBpZiAoIGQgKQorICAgICAgICBp
ZiAoIGQgJiYgZCAhPSBkb21faW8gKQogICAgICAgICAgICAgcmN1X3VubG9j
a19kb21haW4oZCk7CiAgICAgICAgIHJldHVybiBoeXBlcmNhbGxfY3JlYXRl
X2NvbnRpbnVhdGlvbigKICAgICAgICAgICAgIF9fSFlQRVJWSVNPUl9kb21j
dGwsICJoIiwgdV9kb21jdGwpOwpAQCAtMTE1MCw3ICsxMTYwLDcgQEAgbG9u
ZyBkb19kb21jdGwoWEVOX0dVRVNUX0hBTkRMRV9QQVJBTSh4ZW5fZG9tY3Rs
X3QpIHVfZG9tY3RsKQogICAgIGRvbWN0bF9sb2NrX3JlbGVhc2UoKTsKIAog
IGRvbWN0bF9vdXRfdW5sb2NrX2RvbW9ubHk6Ci0gICAgaWYgKCBkICkKKyAg
ICBpZiAoIGQgJiYgZCAhPSBkb21faW8gKQogICAgICAgICByY3VfdW5sb2Nr
X2RvbWFpbihkKTsKIAogICAgIGlmICggY29weWJhY2sgJiYgX19jb3B5X3Rv
X2d1ZXN0KHVfZG9tY3RsLCBvcCwgMSkgKQpkaWZmIC0tZ2l0IGEveGVuL2Ry
aXZlcnMvcGFzc3Rocm91Z2gvYW1kL3BjaV9hbWRfaW9tbXUuYyBiL3hlbi9k
cml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9wY2lfYW1kX2lvbW11LmMKaW5kZXgg
OGMyNTExMGVhZS4uZDExZGM5Yzk0ZSAxMDA2NDQKLS0tIGEveGVuL2RyaXZl
cnMvcGFzc3Rocm91Z2gvYW1kL3BjaV9hbWRfaW9tbXUuYworKysgYi94ZW4v
ZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvcGNpX2FtZF9pb21tdS5jCkBAIC0x
MTgsNiArMTE4LDEwIEBAIHN0YXRpYyB2b2lkIGFtZF9pb21tdV9zZXR1cF9k
b21haW5fZGV2aWNlKAogICAgIHU4IGJ1cyA9IHBkZXYtPmJ1czsKICAgICBj
b25zdCBzdHJ1Y3QgZG9tYWluX2lvbW11ICpoZCA9IGRvbV9pb21tdShkb21h
aW4pOwogCisgICAgLyogZG9tX2lvIGlzIHVzZWQgYXMgYSBzZW50aW5lbCBm
b3IgcXVhcmFudGluZWQgZGV2aWNlcyAqLworICAgIGlmICggZG9tYWluID09
IGRvbV9pbyApCisgICAgICAgIHJldHVybjsKKwogICAgIEJVR19PTiggIWhk
LT5hcmNoLnJvb3RfdGFibGUgfHwgIWhkLT5hcmNoLnBhZ2luZ19tb2RlIHx8
CiAgICAgICAgICAgICAhaW9tbXUtPmRldl90YWJsZS5idWZmZXIgKTsKIApA
QCAtMzMwLDYgKzMzNCwxMCBAQCB2b2lkIGFtZF9pb21tdV9kaXNhYmxlX2Rv
bWFpbl9kZXZpY2Uoc3RydWN0IGRvbWFpbiAqZG9tYWluLAogICAgIGludCBy
ZXFfaWQ7CiAgICAgdTggYnVzID0gcGRldi0+YnVzOwogCisgICAgLyogZG9t
X2lvIGlzIHVzZWQgYXMgYSBzZW50aW5lbCBmb3IgcXVhcmFudGluZWQgZGV2
aWNlcyAqLworICAgIGlmICggZG9tYWluID09IGRvbV9pbyApCisgICAgICAg
IHJldHVybjsKKwogICAgIEJVR19PTiAoIGlvbW11LT5kZXZfdGFibGUuYnVm
ZmVyID09IE5VTEwgKTsKICAgICByZXFfaWQgPSBnZXRfZG1hX3JlcXVlc3Rv
cl9pZChpb21tdS0+c2VnLCBQQ0lfQkRGMihidXMsIGRldmZuKSk7CiAgICAg
ZHRlID0gaW9tbXUtPmRldl90YWJsZS5idWZmZXIgKyAocmVxX2lkICogSU9N
TVVfREVWX1RBQkxFX0VOVFJZX1NJWkUpOwpAQCAtNDE2LDcgKzQyNCw3IEBA
IHN0YXRpYyBpbnQgYW1kX2lvbW11X2Fzc2lnbl9kZXZpY2Uoc3RydWN0IGRv
bWFpbiAqZCwgdTggZGV2Zm4sCiAgICAgICAgICAgICBpdnJzX21hcHBpbmdz
W3JlcV9pZF0ucmVhZF9wZXJtaXNzaW9uKTsKICAgICB9CiAKLSAgICByZXR1
cm4gcmVhc3NpZ25fZGV2aWNlKGhhcmR3YXJlX2RvbWFpbiwgZCwgZGV2Zm4s
IHBkZXYpOworICAgIHJldHVybiByZWFzc2lnbl9kZXZpY2UocGRldi0+ZG9t
YWluLCBkLCBkZXZmbiwgcGRldik7CiB9CiAKIHN0YXRpYyB2b2lkIGRlYWxs
b2NhdGVfbmV4dF9wYWdlX3RhYmxlKHN0cnVjdCBwYWdlX2luZm8gKnBnLCBp
bnQgbGV2ZWwpCmRpZmYgLS1naXQgYS94ZW4vZHJpdmVycy9wYXNzdGhyb3Vn
aC9pb21tdS5jIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvaW9tbXUuYwpp
bmRleCA1ZTgxODEzOTQyLi45ZWJiOGM2YmM0IDEwMDY0NAotLS0gYS94ZW4v
ZHJpdmVycy9wYXNzdGhyb3VnaC9pb21tdS5jCisrKyBiL3hlbi9kcml2ZXJz
L3Bhc3N0aHJvdWdoL2lvbW11LmMKQEAgLTIwOCw2ICsyMDgsOSBAQCB2b2lk
IGlvbW11X3RlYXJkb3duKHN0cnVjdCBkb21haW4gKmQpCiB7CiAgICAgY29u
c3Qgc3RydWN0IGRvbWFpbl9pb21tdSAqaGQgPSBkb21faW9tbXUoZCk7CiAK
KyAgICBpZiAoIGQgPT0gZG9tX2lvICkKKyAgICAgICAgcmV0dXJuOworCiAg
ICAgZC0+bmVlZF9pb21tdSA9IDA7CiAgICAgaGQtPnBsYXRmb3JtX29wcy0+
dGVhcmRvd24oZCk7CiAgICAgdGFza2xldF9zY2hlZHVsZSgmaW9tbXVfcHRf
Y2xlYW51cF90YXNrbGV0KTsKQEAgLTIxOCw2ICsyMjEsOSBAQCBpbnQgaW9t
bXVfY29uc3RydWN0KHN0cnVjdCBkb21haW4gKmQpCiAgICAgaWYgKCBuZWVk
X2lvbW11KGQpID4gMCApCiAgICAgICAgIHJldHVybiAwOwogCisgICAgaWYg
KCBkID09IGRvbV9pbyApCisgICAgICAgIHJldHVybiAwOworCiAgICAgaWYg
KCAhaW9tbXVfdXNlX2hhcF9wdChkKSApCiAgICAgewogICAgICAgICBpbnQg
cmM7CkBAIC0zOTMsNiArMzk5LDkgQEAgaW50IF9faW5pdCBpb21tdV9zZXR1
cCh2b2lkKQogICAgIHByaW50aygiSS9PIHZpcnR1YWxpc2F0aW9uICVzYWJs
ZWRcbiIsIGlvbW11X2VuYWJsZWQgPyAiZW4iIDogImRpcyIpOwogICAgIGlm
ICggaW9tbXVfZW5hYmxlZCApCiAgICAgeworICAgICAgICBpZiAoIGlvbW11
X2RvbWFpbl9pbml0KGRvbV9pbykgKQorICAgICAgICAgICAgcGFuaWMoIkNv
dWxkIG5vdCBzZXQgdXAgcXVhcmFudGluZVxuIik7CisKICAgICAgICAgcHJp
bnRrKCIgLSBEb20wIG1vZGU6ICVzXG4iLAogICAgICAgICAgICAgICAgaW9t
bXVfcGFzc3Rocm91Z2ggPyAiUGFzc3Rocm91Z2giIDoKICAgICAgICAgICAg
ICAgIGlvbW11X2RvbTBfc3RyaWN0ID8gIlN0cmljdCIgOiAiUmVsYXhlZCIp
OwpkaWZmIC0tZ2l0IGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvcGNpLmMg
Yi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9wY2kuYwppbmRleCBlY2I2N2Vi
YzcwLi4wMjUwZDE5YWU1IDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy9wYXNz
dGhyb3VnaC9wY2kuYworKysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9w
Y2kuYwpAQCAtMTM0NCwxOSArMTM0NCwyOSBAQCBpbnQgaW9tbXVfcmVtb3Zl
X2RldmljZShzdHJ1Y3QgcGNpX2RldiAqcGRldikKICAgICByZXR1cm4gaGQt
PnBsYXRmb3JtX29wcy0+cmVtb3ZlX2RldmljZShwZGV2LT5kZXZmbiwgcGNp
X3RvX2RldihwZGV2KSk7CiB9CiAKLS8qCi0gKiBJZiB0aGUgZGV2aWNlIGlz
bid0IG93bmVkIGJ5IHRoZSBoYXJkd2FyZSBkb21haW4sIGl0IG1lYW5zIGl0
IGFscmVhZHkKLSAqIGhhcyBiZWVuIGFzc2lnbmVkIHRvIG90aGVyIGRvbWFp
biwgb3IgaXQgZG9lc24ndCBleGlzdC4KLSAqLwogc3RhdGljIGludCBkZXZp
Y2VfYXNzaWduZWQodTE2IHNlZywgdTggYnVzLCB1OCBkZXZmbikKIHsKICAg
ICBzdHJ1Y3QgcGNpX2RldiAqcGRldjsKKyAgICBpbnQgcmMgPSAwOwogCiAg
ICAgcGNpZGV2c19sb2NrKCk7Ci0gICAgcGRldiA9IHBjaV9nZXRfcGRldl9i
eV9kb21haW4oaGFyZHdhcmVfZG9tYWluLCBzZWcsIGJ1cywgZGV2Zm4pOwor
CisgICAgcGRldiA9IHBjaV9nZXRfcGRldihzZWcsIGJ1cywgZGV2Zm4pOwor
CisgICAgaWYgKCAhcGRldiApCisgICAgICAgIHJjID0gLUVOT0RFVjsKKyAg
ICAvKgorICAgICAqIElmIHRoZSBkZXZpY2UgZXhpc3RzIGFuZCBpdCBpcyBu
b3Qgb3duZWQgYnkgZWl0aGVyIHRoZSBoYXJkd2FyZQorICAgICAqIGRvbWFp
biBvciBkb21faW8gdGhlbiBpdCBtdXN0IGJlIGFzc2lnbmVkIHRvIGEgZ3Vl
c3QsIG9yIGJlCisgICAgICogaGlkZGVuIChvd25lZCBieSBkb21feGVuKS4K
KyAgICAgKi8KKyAgICBlbHNlIGlmICggcGRldi0+ZG9tYWluICE9IGhhcmR3
YXJlX2RvbWFpbiAmJgorICAgICAgICAgICAgICBwZGV2LT5kb21haW4gIT0g
ZG9tX2lvICkKKyAgICAgICAgcmMgPSAtRUJVU1k7CisKICAgICBwY2lkZXZz
X3VubG9jaygpOwogCi0gICAgcmV0dXJuIHBkZXYgPyAwIDogLUVCVVNZOwor
ICAgIHJldHVybiByYzsKIH0KIAogc3RhdGljIGludCBhc3NpZ25fZGV2aWNl
KHN0cnVjdCBkb21haW4gKmQsIHUxNiBzZWcsIHU4IGJ1cywgdTggZGV2Zm4s
IHUzMiBmbGFnKQpAQCAtMTM3MCw3ICsxMzgwLDggQEAgc3RhdGljIGludCBh
c3NpZ25fZGV2aWNlKHN0cnVjdCBkb21haW4gKmQsIHUxNiBzZWcsIHU4IGJ1
cywgdTggZGV2Zm4sIHUzMiBmbGFnKQogCiAgICAgLyogUHJldmVudCBkZXZp
Y2UgYXNzaWduIGlmIG1lbSBwYWdpbmcgb3IgbWVtIHNoYXJpbmcgaGF2ZSBi
ZWVuIAogICAgICAqIGVuYWJsZWQgZm9yIHRoaXMgZG9tYWluICovCi0gICAg
aWYgKCB1bmxpa2VseSghbmVlZF9pb21tdShkKSAmJgorICAgIGlmICggZCAh
PSBkb21faW8gJiYKKyAgICAgICAgIHVubGlrZWx5KCFuZWVkX2lvbW11KGQp
ICYmCiAgICAgICAgICAgICAoKGlzX2h2bV9kb21haW4oZCkgJiYKICAgICAg
ICAgICAgICAgZC0+YXJjaC5odm1fZG9tYWluLm1lbV9zaGFyaW5nX2VuYWJs
ZWQpIHx8CiAgICAgICAgICAgICAgZC0+dm1fZXZlbnQtPnBhZ2luZy5yaW5n
X3BhZ2UgfHwKQEAgLTEzODcsMTIgKzEzOTgsMjAgQEAgc3RhdGljIGludCBh
c3NpZ25fZGV2aWNlKHN0cnVjdCBkb21haW4gKmQsIHUxNiBzZWcsIHU4IGJ1
cywgdTggZGV2Zm4sIHUzMiBmbGFnKQogICAgICAgICByZXR1cm4gcmM7CiAg
ICAgfQogCi0gICAgcGRldiA9IHBjaV9nZXRfcGRldl9ieV9kb21haW4oaGFy
ZHdhcmVfZG9tYWluLCBzZWcsIGJ1cywgZGV2Zm4pOworICAgIHBkZXYgPSBw
Y2lfZ2V0X3BkZXYoc2VnLCBidXMsIGRldmZuKTsKKworICAgIHJjID0gLUVO
T0RFVjsKICAgICBpZiAoICFwZGV2ICkKLSAgICB7Ci0gICAgICAgIHJjID0g
cGNpX2dldF9wZGV2KHNlZywgYnVzLCBkZXZmbikgPyAtRUJVU1kgOiAtRU5P
REVWOwogICAgICAgICBnb3RvIGRvbmU7Ci0gICAgfQorCisgICAgcmMgPSAw
OworICAgIGlmICggZCA9PSBwZGV2LT5kb21haW4gKQorICAgICAgICBnb3Rv
IGRvbmU7CisKKyAgICByYyA9IC1FQlVTWTsKKyAgICBpZiAoIHBkZXYtPmRv
bWFpbiAhPSBoYXJkd2FyZV9kb21haW4gJiYKKyAgICAgICAgIHBkZXYtPmRv
bWFpbiAhPSBkb21faW8gKQorICAgICAgICBnb3RvIGRvbmU7CiAKICAgICBp
ZiAoIHBkZXYtPm1zaXggKQogICAgICAgICBtc2l4dGJsX2luaXQoZCk7CkBA
IC0xNDE1LDYgKzE0MzQsMTAgQEAgc3RhdGljIGludCBhc3NpZ25fZGV2aWNl
KHN0cnVjdCBkb21haW4gKmQsIHUxNiBzZWcsIHU4IGJ1cywgdTggZGV2Zm4s
IHUzMiBmbGFnKQogICAgIH0KIAogIGRvbmU6CisgICAgLyogVGhlIGRldmlj
ZSBpcyBhc3NpZ25lZCB0byBkb21faW8gc28gbWFyayBpdCBhcyBxdWFyYW50
aW5lZCAqLworICAgIGlmICggIXJjICYmIGQgPT0gZG9tX2lvICkKKyAgICAg
ICAgcGRldi0+cXVhcmFudGluZSA9IHRydWU7CisKICAgICBpZiAoICFoYXNf
YXJjaF9wZGV2cyhkKSAmJiBuZWVkX2lvbW11KGQpICkKICAgICAgICAgaW9t
bXVfdGVhcmRvd24oZCk7CiAgICAgcGNpZGV2c191bmxvY2soKTsKQEAgLTE0
MjcsNiArMTQ1MCw3IEBAIGludCBkZWFzc2lnbl9kZXZpY2Uoc3RydWN0IGRv
bWFpbiAqZCwgdTE2IHNlZywgdTggYnVzLCB1OCBkZXZmbikKIHsKICAgICBj
b25zdCBzdHJ1Y3QgZG9tYWluX2lvbW11ICpoZCA9IGRvbV9pb21tdShkKTsK
ICAgICBzdHJ1Y3QgcGNpX2RldiAqcGRldiA9IE5VTEw7CisgICAgc3RydWN0
IGRvbWFpbiAqdGFyZ2V0OwogICAgIGludCByZXQgPSAwOwogCiAgICAgaWYg
KCAhaW9tbXVfZW5hYmxlZCB8fCAhaGQtPnBsYXRmb3JtX29wcyApCkBAIC0x
NDM3LDEyICsxNDYxLDE2IEBAIGludCBkZWFzc2lnbl9kZXZpY2Uoc3RydWN0
IGRvbWFpbiAqZCwgdTE2IHNlZywgdTggYnVzLCB1OCBkZXZmbikKICAgICBp
ZiAoICFwZGV2ICkKICAgICAgICAgcmV0dXJuIC1FTk9ERVY7CiAKKyAgICAv
KiBEZS1hc3NpZ25tZW50IGZyb20gZG9tX2lvIHNob3VsZCBkZS1xdWFyYW50
aW5lIHRoZSBkZXZpY2UgKi8KKyAgICB0YXJnZXQgPSAocGRldi0+cXVhcmFu
dGluZSAmJiBwZGV2LT5kb21haW4gIT0gZG9tX2lvKSA/CisgICAgICAgIGRv
bV9pbyA6IGhhcmR3YXJlX2RvbWFpbjsKKwogICAgIHdoaWxlICggcGRldi0+
cGhhbnRvbV9zdHJpZGUgKQogICAgIHsKICAgICAgICAgZGV2Zm4gKz0gcGRl
di0+cGhhbnRvbV9zdHJpZGU7CiAgICAgICAgIGlmICggUENJX1NMT1QoZGV2
Zm4pICE9IFBDSV9TTE9UKHBkZXYtPmRldmZuKSApCiAgICAgICAgICAgICBi
cmVhazsKLSAgICAgICAgcmV0ID0gaGQtPnBsYXRmb3JtX29wcy0+cmVhc3Np
Z25fZGV2aWNlKGQsIGhhcmR3YXJlX2RvbWFpbiwgZGV2Zm4sCisgICAgICAg
IHJldCA9IGhkLT5wbGF0Zm9ybV9vcHMtPnJlYXNzaWduX2RldmljZShkLCB0
YXJnZXQsIGRldmZuLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgcGNpX3RvX2RldihwZGV2KSk7CiAgICAgICAg
IGlmICggIXJldCApCiAgICAgICAgICAgICBjb250aW51ZTsKQEAgLTE0NTMs
NyArMTQ4MSw3IEBAIGludCBkZWFzc2lnbl9kZXZpY2Uoc3RydWN0IGRvbWFp
biAqZCwgdTE2IHNlZywgdTggYnVzLCB1OCBkZXZmbikKICAgICB9CiAKICAg
ICBkZXZmbiA9IHBkZXYtPmRldmZuOwotICAgIHJldCA9IGhkLT5wbGF0Zm9y
bV9vcHMtPnJlYXNzaWduX2RldmljZShkLCBoYXJkd2FyZV9kb21haW4sIGRl
dmZuLAorICAgIHJldCA9IGhkLT5wbGF0Zm9ybV9vcHMtPnJlYXNzaWduX2Rl
dmljZShkLCB0YXJnZXQsIGRldmZuLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBwY2lfdG9fZGV2KHBkZXYpKTsKICAg
ICBpZiAoIHJldCApCiAgICAgewpAQCAtMTQ2Myw2ICsxNDkxLDkgQEAgaW50
IGRlYXNzaWduX2RldmljZShzdHJ1Y3QgZG9tYWluICpkLCB1MTYgc2VnLCB1
OCBidXMsIHU4IGRldmZuKQogICAgICAgICByZXR1cm4gcmV0OwogICAgIH0K
IAorICAgIGlmICggcGRldi0+ZG9tYWluID09IGhhcmR3YXJlX2RvbWFpbiAg
KQorICAgICAgICBwZGV2LT5xdWFyYW50aW5lID0gZmFsc2U7CisKICAgICBw
ZGV2LT5mYXVsdC5jb3VudCA9IDA7CiAKICAgICBpZiAoICFoYXNfYXJjaF9w
ZGV2cyhkKSAmJiBuZWVkX2lvbW11KGQpICkKQEAgLTE2NTQsNyArMTY4NSw3
IEBAIGludCBpb21tdV9kb19wY2lfZG9tY3RsKAogICAgICAgICAgICAgcmV0
ID0gaHlwZXJjYWxsX2NyZWF0ZV9jb250aW51YXRpb24oX19IWVBFUlZJU09S
X2RvbWN0bCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICJoIiwgdV9kb21jdGwpOwogICAgICAgICBlbHNlIGlm
ICggcmV0ICkKLSAgICAgICAgICAgIHByaW50ayhYRU5MT0dfR19FUlIgIlhF
Tl9ET01DVExfYXNzaWduX2RldmljZTogIgorICAgICAgICAgICAgcHJpbnRr
KFhFTkxPR19HX0VSUgogICAgICAgICAgICAgICAgICAgICJhc3NpZ24gJTA0
eDolMDJ4OiUwMnguJXUgdG8gZG9tJWQgZmFpbGVkICglZClcbiIsCiAgICAg
ICAgICAgICAgICAgICAgc2VnLCBidXMsIFBDSV9TTE9UKGRldmZuKSwgUENJ
X0ZVTkMoZGV2Zm4pLAogICAgICAgICAgICAgICAgICAgIGQtPmRvbWFpbl9p
ZCwgcmV0KTsKZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdo
L3Z0ZC9pb21tdS5jIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvdnRkL2lv
bW11LmMKaW5kZXggMjA5MzY2ODMyOC4uMGUwYWE2ZDUxNyAxMDA2NDQKLS0t
IGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvdnRkL2lvbW11LmMKKysrIGIv
eGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvdnRkL2lvbW11LmMKQEAgLTEzMzIs
NiArMTMzMiwxMCBAQCBpbnQgZG9tYWluX2NvbnRleHRfbWFwcGluZ19vbmUo
CiAgICAgaW50IGFnYXcsIHJjLCByZXQ7CiAgICAgYm9vbF90IGZsdXNoX2Rl
dl9pb3RsYjsKIAorICAgIC8qIGRvbV9pbyBpcyB1c2VkIGFzIGEgc2VudGlu
ZWwgZm9yIHF1YXJhbnRpbmVkIGRldmljZXMgKi8KKyAgICBpZiAoIGRvbWFp
biA9PSBkb21faW8gKQorICAgICAgICByZXR1cm4gMDsKKwogICAgIEFTU0VS
VChwY2lkZXZzX2xvY2tlZCgpKTsKICAgICBzcGluX2xvY2soJmlvbW11LT5s
b2NrKTsKICAgICBtYWRkciA9IGJ1c190b19jb250ZXh0X21hZGRyKGlvbW11
LCBidXMpOwpAQCAtMTU2Nyw2ICsxNTcxLDEwIEBAIGludCBkb21haW5fY29u
dGV4dF91bm1hcF9vbmUoCiAgICAgaW50IGlvbW11X2RvbWlkLCByYywgcmV0
OwogICAgIGJvb2xfdCBmbHVzaF9kZXZfaW90bGI7CiAKKyAgICAvKiBkb21f
aW8gaXMgdXNlZCBhcyBhIHNlbnRpbmVsIGZvciBxdWFyYW50aW5lZCBkZXZp
Y2VzICovCisgICAgaWYgKCBkb21haW4gPT0gZG9tX2lvICkKKyAgICAgICAg
cmV0dXJuIDA7CisKICAgICBBU1NFUlQocGNpZGV2c19sb2NrZWQoKSk7CiAg
ICAgc3Bpbl9sb2NrKCZpb21tdS0+bG9jayk7CiAKQEAgLTE2OTksNiArMTcw
NywxMCBAQCBzdGF0aWMgaW50IGRvbWFpbl9jb250ZXh0X3VubWFwKHN0cnVj
dCBkb21haW4gKmRvbWFpbiwgdTggZGV2Zm4sCiAgICAgICAgIGdvdG8gb3V0
OwogICAgIH0KIAorICAgIC8qIGRvbV9pbyBpcyB1c2VkIGFzIGEgc2VudGlu
ZWwgZm9yIHF1YXJhbnRpbmVkIGRldmljZXMgKi8KKyAgICBpZiAoIGRvbWFp
biA9PSBkb21faW8gKQorICAgICAgICBnb3RvIG91dDsKKwogICAgIC8qCiAg
ICAgICogaWYgbm8gb3RoZXIgZGV2aWNlcyB1bmRlciB0aGUgc2FtZSBpb21t
dSBvd25lZCBieSB0aGlzIGRvbWFpbiwKICAgICAgKiBjbGVhciBpb21tdSBp
biBpb21tdV9iaXRtYXAgYW5kIGNsZWFyIGRvbWFpbl9pZCBpbiBkb21pZF9i
aXRtcApAQCAtMjM4Myw2ICsyMzk1LDE1IEBAIHN0YXRpYyBpbnQgcmVhc3Np
Z25fZGV2aWNlX293bmVyc2hpcCgKICAgICBpZiAoIHJldCApCiAgICAgICAg
IHJldHVybiByZXQ7CiAKKyAgICBpZiAoIGRldmZuID09IHBkZXYtPmRldmZu
ICkKKyAgICB7CisgICAgICAgIGxpc3RfbW92ZSgmcGRldi0+ZG9tYWluX2xp
c3QsICZkb21faW8tPmFyY2gucGRldl9saXN0KTsKKyAgICAgICAgcGRldi0+
ZG9tYWluID0gZG9tX2lvOworICAgIH0KKworICAgIGlmICggIWhhc19hcmNo
X3BkZXZzKHNvdXJjZSkgKQorICAgICAgICB2bXhfcGlfaG9va3NfZGVhc3Np
Z24oc291cmNlKTsKKwogICAgIGlmICggIWhhc19hcmNoX3BkZXZzKHRhcmdl
dCkgKQogICAgICAgICB2bXhfcGlfaG9va3NfYXNzaWduKHRhcmdldCk7CiAK
QEAgLTI0MDEsMTUgKzI0MjIsMTMgQEAgc3RhdGljIGludCByZWFzc2lnbl9k
ZXZpY2Vfb3duZXJzaGlwKAogICAgICAgICBwZGV2LT5kb21haW4gPSB0YXJn
ZXQ7CiAgICAgfQogCi0gICAgaWYgKCAhaGFzX2FyY2hfcGRldnMoc291cmNl
KSApCi0gICAgICAgIHZteF9waV9ob29rc19kZWFzc2lnbihzb3VyY2UpOwot
CiAgICAgcmV0dXJuIHJldDsKIH0KIAogc3RhdGljIGludCBpbnRlbF9pb21t
dV9hc3NpZ25fZGV2aWNlKAogICAgIHN0cnVjdCBkb21haW4gKmQsIHU4IGRl
dmZuLCBzdHJ1Y3QgcGNpX2RldiAqcGRldiwgdTMyIGZsYWcpCiB7CisgICAg
c3RydWN0IGRvbWFpbiAqcyA9IHBkZXYtPmRvbWFpbjsKICAgICBzdHJ1Y3Qg
YWNwaV9ybXJyX3VuaXQgKnJtcnI7CiAgICAgaW50IHJldCA9IDAsIGk7CiAg
ICAgdTE2IGJkZiwgc2VnOwpAQCAtMjQ1Miw4ICsyNDcxLDggQEAgc3RhdGlj
IGludCBpbnRlbF9pb21tdV9hc3NpZ25fZGV2aWNlKAogICAgICAgICB9CiAg
ICAgfQogCi0gICAgcmV0ID0gcmVhc3NpZ25fZGV2aWNlX293bmVyc2hpcCho
YXJkd2FyZV9kb21haW4sIGQsIGRldmZuLCBwZGV2KTsKLSAgICBpZiAoIHJl
dCApCisgICAgcmV0ID0gcmVhc3NpZ25fZGV2aWNlX293bmVyc2hpcChzLCBk
LCBkZXZmbiwgcGRldik7CisgICAgaWYgKCByZXQgfHwgZCA9PSBkb21faW8g
KQogICAgICAgICByZXR1cm4gcmV0OwogCiAgICAgLyogU2V0dXAgcm1yciBp
ZGVudGl0eSBtYXBwaW5nICovCkBAIC0yNDY2LDExICsyNDg1LDIwIEBAIHN0
YXRpYyBpbnQgaW50ZWxfaW9tbXVfYXNzaWduX2RldmljZSgKICAgICAgICAg
ICAgIHJldCA9IHJtcnJfaWRlbnRpdHlfbWFwcGluZyhkLCAxLCBybXJyLCBm
bGFnKTsKICAgICAgICAgICAgIGlmICggcmV0ICkKICAgICAgICAgICAgIHsK
LSAgICAgICAgICAgICAgICByZWFzc2lnbl9kZXZpY2Vfb3duZXJzaGlwKGQs
IGhhcmR3YXJlX2RvbWFpbiwgZGV2Zm4sIHBkZXYpOworICAgICAgICAgICAg
ICAgIGludCByYzsKKworICAgICAgICAgICAgICAgIHJjID0gcmVhc3NpZ25f
ZGV2aWNlX293bmVyc2hpcChkLCBzLCBkZXZmbiwgcGRldik7CiAgICAgICAg
ICAgICAgICAgcHJpbnRrKFhFTkxPR19HX0VSUiBWVERQUkVGSVgKICAgICAg
ICAgICAgICAgICAgICAgICAgIiBjYW5ub3QgbWFwIHJlc2VydmVkIHJlZ2lv
biAoJSJQUkl4NjQiLCUiUFJJeDY0Il0gZm9yIERvbSVkICglZClcbiIsCiAg
ICAgICAgICAgICAgICAgICAgICAgIHJtcnItPmJhc2VfYWRkcmVzcywgcm1y
ci0+ZW5kX2FkZHJlc3MsCiAgICAgICAgICAgICAgICAgICAgICAgIGQtPmRv
bWFpbl9pZCwgcmV0KTsKKyAgICAgICAgICAgICAgICBpZiAoIHJjICkKKyAg
ICAgICAgICAgICAgICB7CisgICAgICAgICAgICAgICAgICAgIHByaW50ayhY
RU5MT0dfRVJSIFZURFBSRUZJWAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIiBmYWlsZWQgdG8gcmVjbGFpbSAlMDR4OiUwMng6JTAyeC4ldSBmcm9t
ICVwZCAoJWQpXG4iLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vn
LCBidXMsIFBDSV9TTE9UKGRldmZuKSwgUENJX0ZVTkMoZGV2Zm4pLCBkLCBy
Yyk7CisgICAgICAgICAgICAgICAgICAgIGRvbWFpbl9jcmFzaChkKTsKKyAg
ICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg
ICAgICAgICB9CiAgICAgICAgIH0KZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRl
L3hlbi9wY2kuaCBiL3hlbi9pbmNsdWRlL3hlbi9wY2kuaAppbmRleCBkYTFi
ZDIyMjIzLi4yOTE3ZDAwYTQ3IDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS94
ZW4vcGNpLmgKKysrIGIveGVuL2luY2x1ZGUveGVuL3BjaS5oCkBAIC02OCw2
ICs2OCw5IEBAIHN0cnVjdCBwY2lfZGV2IHsKIAogICAgIG5vZGVpZF90IG5v
ZGU7IC8qIE5VTUEgbm9kZSAqLwogCisgICAgLyogRGV2aWNlIHRvIGJlIHF1
YXJhbnRpbmVkLCBkb24ndCBhdXRvbWF0aWNhbGx5IHJlLWFzc2lnbiB0byBk
b20wICovCisgICAgYm9vbCBxdWFyYW50aW5lOworCiAgICAgZW51bSBwZGV2
X3R5cGUgewogICAgICAgICBERVZfVFlQRV9QQ0lfVU5LTk9XTiwKICAgICAg
ICAgREVWX1RZUEVfUENJZV9FTkRQT0lOVCwKLS0gCjIuMTEuMAoK

--=separator
Content-Type: application/octet-stream;
 name="xsa302-4.10/0001-IOMMU-add-missing-HVM-check.patch"
Content-Disposition: attachment;
 filename="xsa302-4.10/0001-IOMMU-add-missing-HVM-check.patch"
Content-Transfer-Encoding: base64

RnJvbSAyYmNiZjI4NDMyNTA4ODhiNzIwYmZlYTE4OGFjOTg0MmM4NDdmMzg4
IE1vbiBTZXAgMTcgMDA6MDA6MDAgMjAwMQpGcm9tOiBKYW4gQmV1bGljaCA8
amJldWxpY2hAc3VzZS5jb20+CkRhdGU6IFdlZCwgMiBPY3QgMjAxOSAxMzoz
Njo1OSArMDIwMApTdWJqZWN0OiBbUEFUQ0ggMS8yXSBJT01NVTogYWRkIG1p
c3NpbmcgSFZNIGNoZWNrCk1JTUUtVmVyc2lvbjogMS4wCkNvbnRlbnQtVHlw
ZTogdGV4dC9wbGFpbjsgY2hhcnNldD1VVEYtOApDb250ZW50LVRyYW5zZmVy
LUVuY29kaW5nOiA4Yml0CgpGaXggYW4gdW5ndWFyZGVkIGQtPmFyY2guaHZt
IGFjY2VzcyBpbiBhc3NpZ25fZGV2aWNlKCkuCgpTaWduZWQtb2ZmLWJ5OiBK
YW4gQmV1bGljaCA8amJldWxpY2hAc3VzZS5jb20+ClJldmlld2VkLWJ5OiBS
b2dlciBQYXUgTW9ubsOpIDxyb2dlci5wYXVAY2l0cml4LmNvbT4KQWNrZWQt
Ynk6IEFuZHJldyBDb29wZXIgPGFuZHJldy5jb29wZXIzQGNpdHJpeC5jb20+
CgooY2hlcnJ5IHBpY2tlZCBmcm9tIGNvbW1pdCA0MWZkMTAwOWNkNzQxNmI3
M2Q3NDVhNzdjMjRiNGU4ZDFhMjk2ZmU2KQpTaWduZWQtb2ZmLWJ5OiBJYW4g
SmFja3NvbiA8aWFuLmphY2tzb25AZXUuY2l0cml4LmNvbT4KLS0tCiB4ZW4v
ZHJpdmVycy9wYXNzdGhyb3VnaC9wY2kuYyB8IDMgKystCiAxIGZpbGUgY2hh
bmdlZCwgMiBpbnNlcnRpb25zKCspLCAxIGRlbGV0aW9uKC0pCgpkaWZmIC0t
Z2l0IGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvcGNpLmMgYi94ZW4vZHJp
dmVycy9wYXNzdGhyb3VnaC9wY2kuYwppbmRleCBlMDIxYzdhMzE3Li5lMTY2
OGExOTY4IDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9w
Y2kuYworKysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9wY2kuYwpAQCAt
MTM4Niw3ICsxMzg2LDggQEAgc3RhdGljIGludCBhc3NpZ25fZGV2aWNlKHN0
cnVjdCBkb21haW4gKmQsIHUxNiBzZWcsIHU4IGJ1cywgdTggZGV2Zm4sIHUz
MiBmbGFnKQogICAgIC8qIFByZXZlbnQgZGV2aWNlIGFzc2lnbiBpZiBtZW0g
cGFnaW5nIG9yIG1lbSBzaGFyaW5nIGhhdmUgYmVlbiAKICAgICAgKiBlbmFi
bGVkIGZvciB0aGlzIGRvbWFpbiAqLwogICAgIGlmICggdW5saWtlbHkoIW5l
ZWRfaW9tbXUoZCkgJiYKLSAgICAgICAgICAgIChkLT5hcmNoLmh2bV9kb21h
aW4ubWVtX3NoYXJpbmdfZW5hYmxlZCB8fAorICAgICAgICAgICAgKChpc19o
dm1fZG9tYWluKGQpICYmCisgICAgICAgICAgICAgIGQtPmFyY2guaHZtX2Rv
bWFpbi5tZW1fc2hhcmluZ19lbmFibGVkKSB8fAogICAgICAgICAgICAgIHZt
X2V2ZW50X2NoZWNrX3JpbmcoZC0+dm1fZXZlbnRfcGFnaW5nKSB8fAogICAg
ICAgICAgICAgIHAybV9nZXRfaG9zdHAybShkKS0+Z2xvYmFsX2xvZ2RpcnR5
KSkgKQogICAgICAgICByZXR1cm4gLUVYREVWOwotLSAKMi4xMS4wCgo=

--=separator
Content-Type: application/octet-stream;
 name="xsa302-4.10/0002-passthrough-quarantine-PCI-devices.patch"
Content-Disposition: attachment;
 filename="xsa302-4.10/0002-passthrough-quarantine-PCI-devices.patch"
Content-Transfer-Encoding: base64

RnJvbSAwMmRkMDdlNTNiOTA0NTcwZTAzMjBkMTdkNzcwMjJkZGJjNGU4MjI1
IE1vbiBTZXAgMTcgMDA6MDA6MDAgMjAwMQpGcm9tOiBQYXVsIER1cnJhbnQg
PHBhdWwuZHVycmFudEBjaXRyaXguY29tPgpEYXRlOiBNb24sIDE0IE9jdCAy
MDE5IDE3OjUyOjU5ICswMTAwClN1YmplY3Q6IFtQQVRDSCAyLzJdIHBhc3N0
aHJvdWdoOiBxdWFyYW50aW5lIFBDSSBkZXZpY2VzCgpXaGVuIGEgUENJIGRl
dmljZSBpcyBhc3NpZ25lZCB0byBhbiB1bnRydXN0ZWQgZG9tYWluLCBpdCBp
cyBwb3NzaWJsZSBmb3IKdGhhdCBkb21haW4gdG8gcHJvZ3JhbSB0aGUgZGV2
aWNlIHRvIERNQSB0byBhbiBhcmJpdHJhcnkgYWRkcmVzcy4gVGhlCklPTU1V
IGlzIHVzZWQgdG8gcHJvdGVjdCB0aGUgaG9zdCBmcm9tIG1hbGljaW91cyBE
TUEgYnkgbWFraW5nIHN1cmUgdGhhdAp0aGUgZGV2aWNlIGFkZHJlc3NlcyBj
YW4gb25seSB0YXJnZXQgbWVtb3J5IGFzc2lnbmVkIHRvIHRoZSBndWVzdC4g
SG93ZXZlciwKd2hlbiB0aGUgZ3Vlc3QgZG9tYWluIGlzIHRvcm4gZG93biB0
aGUgZGV2aWNlIGlzIGFzc2lnbmVkIGJhY2sgdG8gZG9tMCwKdGh1cyBhbGxv
d2luZyBhbnkgaW4tZmxpZ2h0IERNQSB0byBwb3RlbnRpYWxseSB0YXJnZXQg
Y3JpdGljYWwgaG9zdCBkYXRhLgoKVGhpcyBwYXRjaCBpbnRyb2R1Y2VzIGEg
J3F1YXJhbnRpbmUnIGZvciBQQ0kgZGV2aWNlcyB1c2luZyBkb21faW8uIFdo
ZW4KdGhlIHRvb2xzdGFjayBtYWtlcyBhIGRldmljZSBhc3NpZ25hYmxlIChi
eSBiaW5kaW5nIGl0IHRvIHBjaWJhY2spLCBpdAp3aWxsIG5vdyBhbHNvIGFz
c2lnbiBpdCB0byBET01JRF9JTyBhbmQgdGhlIGRldmljZSB3aWxsIG9ubHkg
YmUgYXNzaWduZWQKYmFjayB0byBkb20wIHdoZW4gdGhlIGRldmljZSBpcyBt
YWRlIHVuYXNzaWduYWJsZSBhZ2Fpbi4gV2hpbHN0IGRldmljZSBpcwphc3Np
Z25hYmxlIGl0IHdpbGwgb25seSBldmVyIHRyYW5zZmVyIGJldHdlZW4gZG9t
X2lvIGFuZCBndWVzdCBkb21haW5zLgpkb21faW8gaXMgYWN0dWFsbHkgb25s
eSB1c2VkIGFzIGEgc2VudGluZWwgZG9tYWluIGZvciBxdWFyYW50aW5pbmcg
cHVycG9zZXM7Cml0IGlzIG5vdCBjb25maWd1cmVkIHdpdGggYW55IElPTU1V
IG1hcHBpbmdzLiBBc3NpZ25tZW50IHRvIGRvbV9pbyBzaW1wbHkKbWVhbnMg
dGhhdCB0aGUgZGV2aWNlJ3MgaW5pdGlhdG9yIChyZXF1ZXN0b3IpIGlkZW50
aWZpZXIgaXMgbm90IHByZXNlbnQgaW4KdGhlIElPTU1VJ3MgZGV2aWNlIHRh
YmxlIGFuZCB0aHVzIGFueSBETUEgdHJhbnNhY3Rpb25zIGlzc3VlZCB3aWxs
IGJlCnRlcm1pbmF0ZWQgd2l0aCBhIGZhdWx0IGNvbmRpdGlvbi4KCkluIGFk
ZGl0aW9uLCBhIGZpeCB0byBhc3NpZ25tZW50IGhhbmRsaW5nIGlzIG1hZGUg
Zm9yIFZULWQuICBGYWlsdXJlCmR1cmluZyB0aGUgYXNzaWdubWVudCBzdGVw
IHNob3VsZCBub3QgbGVhZCB0byBhIGRldmljZSBzdGlsbCBiZWluZwphc3Nv
Y2lhdGVkIHdpdGggaXRzIHByaW9yIG93bmVyLiBIYW5kIHRoZSBkZXZpY2Ug
dG8gRG9tSU8gdGVtcG9yYXJpbHksCnVudGlsIHRoZSBhc3NpZ25tZW50IHN0
ZXAgaGFzIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuICBSZW1vdmUgdGhlIFBJ
Cmhvb2tzIGZyb20gdGhlIHNvdXJjZSBkb21haW4gdGhlbiBlYXJsaWVyIGFz
IHdlbGwuCgpGYWlsdXJlIG9mIHRoZSByZWNvdmVyeSByZWFzc2lnbl9kZXZp
Y2Vfb3duZXJzaGlwKCkgbWF5IG5vdCBnbyBzaWxlbnQ6ClRoZXJlIGUuZy4g
bWF5IHN0aWxsIGJlIGxlZnQgb3ZlciBSTVJSIG1hcHBpbmdzIGluIHRoZSBk
b21haW4gYXNzaWdubWVudAp0byB3aGljaCBoYXMgZmFpbGVkLCBhbmQgaGVu
Y2Ugd2UgY2FuJ3QgYWxsb3cgdGhhdCBkb21haW4gdG8gY29udGludWUKZXhl
Y3V0aW5nLgoKTk9URTogVGhpcyBwYXRjaCBhbHNvIGluY2x1ZGVzIG9uZSBw
cmludGsoKSBjbGVhbnVwOyB0aGUKICAgICAgIlhFTl9ET01DVExfYXNzaWdu
X2RldmljZTogIiB0YWcgaXMgZHJvcHBlZCBpbiBpb21tdV9kb19wY2lfZG9t
Y3RsKCksCiAgICAgIHNpbmNlIHNpbWlsYXIgcHJpbnRrKCktcyBlbHNld2hl
cmUgYWxzbyBkb24ndCBsb2cgc3VjaCBhIHRhZy4KClRoaXMgaXMgWFNBLTMw
Mi4KClNpZ25lZC1vZmYtYnk6IFBhdWwgRHVycmFudCA8cGF1bC5kdXJyYW50
QGNpdHJpeC5jb20+ClNpZ25lZC1vZmYtYnk6IEphbiBCZXVsaWNoIDxqYmV1
bGljaEBzdXNlLmNvbT4KU2lnbmVkLW9mZi1ieTogSWFuIEphY2tzb24gPGlh
bi5qYWNrc29uQGV1LmNpdHJpeC5jb20+Ci0tLQogdG9vbHMvbGlieGwvbGli
eGxfcGNpLmMgICAgICAgICAgICAgICAgICAgICB8IDI1ICsrKysrKysrKysr
LQogeGVuL2FyY2gveDg2L21tLmMgICAgICAgICAgICAgICAgICAgICAgICAg
ICB8ICAyICsKIHhlbi9jb21tb24vZG9tY3RsLmMgICAgICAgICAgICAgICAg
ICAgICAgICAgfCAxNCArKysrKystCiB4ZW4vZHJpdmVycy9wYXNzdGhyb3Vn
aC9hbWQvcGNpX2FtZF9pb21tdS5jIHwgMTAgKysrKy0KIHhlbi9kcml2ZXJz
L3Bhc3N0aHJvdWdoL2lvbW11LmMgICAgICAgICAgICAgfCAgOSArKysrKwog
eGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvcGNpLmMgICAgICAgICAgICAgICB8
IDU5ICsrKysrKysrKysrKysrKysrKysrKystLS0tLS0tCiB4ZW4vZHJpdmVy
cy9wYXNzdGhyb3VnaC92dGQvaW9tbXUuYyAgICAgICAgIHwgNDAgKysrKysr
KysrKysrKysrKy0tLQogeGVuL2luY2x1ZGUveGVuL3BjaS5oICAgICAgICAg
ICAgICAgICAgICAgICB8ICAzICsrCiA4IGZpbGVzIGNoYW5nZWQsIDEzOCBp
bnNlcnRpb25zKCspLCAyNCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS90
b29scy9saWJ4bC9saWJ4bF9wY2kuYyBiL3Rvb2xzL2xpYnhsL2xpYnhsX3Bj
aS5jCmluZGV4IDg4YTU1Y2U4YmQuLjFiNWM0NGYzZTcgMTAwNjQ0Ci0tLSBh
L3Rvb2xzL2xpYnhsL2xpYnhsX3BjaS5jCisrKyBiL3Rvb2xzL2xpYnhsL2xp
YnhsX3BjaS5jCkBAIC03NDksNiArNzQ5LDcgQEAgc3RhdGljIGludCBsaWJ4
bF9fZGV2aWNlX3BjaV9hc3NpZ25hYmxlX2FkZChsaWJ4bF9fZ2MgKmdjLAog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBs
aWJ4bF9kZXZpY2VfcGNpICpwY2lkZXYsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGludCByZWJpbmQpCiB7CisgICAg
bGlieGxfY3R4ICpjdHggPSBsaWJ4bF9fZ2Nfb3duZXIoZ2MpOwogICAgIHVu
c2lnbmVkIGRvbSwgYnVzLCBkZXYsIGZ1bmM7CiAgICAgY2hhciAqc3BhdGgs
ICpkcml2ZXJfcGF0aCA9IE5VTEw7CiAgICAgaW50IHJjOwpAQCAtNzc0LDcg
Kzc3NSw3IEBAIHN0YXRpYyBpbnQgbGlieGxfX2RldmljZV9wY2lfYXNzaWdu
YWJsZV9hZGQobGlieGxfX2djICpnYywKICAgICB9CiAgICAgaWYgKCByYyAp
IHsKICAgICAgICAgTE9HKFdBUk4sIFBDSV9CREYiIGFscmVhZHkgYXNzaWdu
ZWQgdG8gcGNpYmFjayIsIGRvbSwgYnVzLCBkZXYsIGZ1bmMpOwotICAgICAg
ICByZXR1cm4gMDsKKyAgICAgICAgZ290byBxdWFyYW50aW5lOwogICAgIH0K
IAogICAgIC8qIENoZWNrIHRvIHNlZSBpZiB0aGVyZSdzIGFscmVhZHkgYSBk
cml2ZXIgdGhhdCB3ZSBuZWVkIHRvIHVuYmluZCBmcm9tICovCkBAIC04MDUs
NiArODA2LDE5IEBAIHN0YXRpYyBpbnQgbGlieGxfX2RldmljZV9wY2lfYXNz
aWduYWJsZV9hZGQobGlieGxfX2djICpnYywKICAgICAgICAgcmV0dXJuIEVS
Uk9SX0ZBSUw7CiAgICAgfQogCitxdWFyYW50aW5lOgorICAgIC8qCisgICAg
ICogRE9NSURfSU8gaXMganVzdCBhIHNlbnRpbmVsIGRvbWFpbiwgd2l0aG91
dCBhbnkgYWN0dWFsIG1hcHBpbmdzLAorICAgICAqIHNvIGFsd2F5cyBwYXNz
IFhFTl9ET01DVExfREVWX1JETV9SRUxBWEVEIHRvIGF2b2lkIGFzc2lnbm1l
bnQgYmVpbmcKKyAgICAgKiB1bm5lY2Vzc2FyaWx5IGRlbmllZC4KKyAgICAg
Ki8KKyAgICByYyA9IHhjX2Fzc2lnbl9kZXZpY2UoY3R4LT54Y2gsIERPTUlE
X0lPLCBwY2lkZXZfZW5jb2RlX2JkZihwY2lkZXYpLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICBYRU5fRE9NQ1RMX0RFVl9SRE1fUkVMQVhFRCk7Cisg
ICAgaWYgKCByYyA8IDAgKSB7CisgICAgICAgIExPRyhFUlJPUiwgImZhaWxl
ZCB0byBxdWFyYW50aW5lICJQQ0lfQkRGLCBkb20sIGJ1cywgZGV2LCBmdW5j
KTsKKyAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUw7CisgICAgfQorCiAgICAg
cmV0dXJuIDA7CiB9CiAKQEAgLTgxMiw5ICs4MjYsMTggQEAgc3RhdGljIGlu
dCBsaWJ4bF9fZGV2aWNlX3BjaV9hc3NpZ25hYmxlX3JlbW92ZShsaWJ4bF9f
Z2MgKmdjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBsaWJ4bF9kZXZpY2VfcGNpICpwY2lkZXYsCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBy
ZWJpbmQpCiB7CisgICAgbGlieGxfY3R4ICpjdHggPSBsaWJ4bF9fZ2Nfb3du
ZXIoZ2MpOwogICAgIGludCByYzsKICAgICBjaGFyICpkcml2ZXJfcGF0aDsK
IAorICAgIC8qIERlLXF1YXJhbnRpbmUgKi8KKyAgICByYyA9IHhjX2RlYXNz
aWduX2RldmljZShjdHgtPnhjaCwgRE9NSURfSU8sIHBjaWRldl9lbmNvZGVf
YmRmKHBjaWRldikpOworICAgIGlmICggcmMgPCAwICkgeworICAgICAgICBM
T0coRVJST1IsICJmYWlsZWQgdG8gZGUtcXVhcmFudGluZSAiUENJX0JERiwg
cGNpZGV2LT5kb21haW4sIHBjaWRldi0+YnVzLAorICAgICAgICAgICAgcGNp
ZGV2LT5kZXYsIHBjaWRldi0+ZnVuYyk7CisgICAgICAgIHJldHVybiBFUlJP
Ul9GQUlMOworICAgIH0KKwogICAgIC8qIFVuYmluZCBmcm9tIHBjaWJhY2sg
Ki8KICAgICBpZiAoIChyYz1wY2liYWNrX2Rldl9pc19hc3NpZ25lZChnYywg
cGNpZGV2KSkgPCAwICkgewogICAgICAgICByZXR1cm4gRVJST1JfRkFJTDsK
ZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9tbS5jIGIveGVuL2FyY2gveDg2
L21tLmMKaW5kZXggY2UyYzA4MmNhZi4uMGU0MjQ5N2NmNyAxMDA2NDQKLS0t
IGEveGVuL2FyY2gveDg2L21tLmMKKysrIGIveGVuL2FyY2gveDg2L21tLmMK
QEAgLTI5NSw5ICsyOTUsMTEgQEAgdm9pZCBfX2luaXQgYXJjaF9pbml0X21l
bW9yeSh2b2lkKQogICAgICAqIEluaXRpYWxpc2Ugb3VyIERPTUlEX0lPIGRv
bWFpbi4KICAgICAgKiBUaGlzIGRvbWFpbiBvd25zIEkvTyBwYWdlcyB0aGF0
IGFyZSB3aXRoaW4gdGhlIHJhbmdlIG9mIHRoZSBwYWdlX2luZm8KICAgICAg
KiBhcnJheS4gTWFwcGluZ3Mgb2NjdXIgYXQgdGhlIHByaXYgb2YgdGhlIGNh
bGxlci4KKyAgICAgKiBRdWFyYW50aW5lZCBQQ0kgZGV2aWNlcyB3aWxsIGJl
IGFzc29jaWF0ZWQgd2l0aCB0aGlzIGRvbWFpbi4KICAgICAgKi8KICAgICBk
b21faW8gPSBkb21haW5fY3JlYXRlKERPTUlEX0lPLCBET01DUkZfZHVtbXks
IDAsIE5VTEwpOwogICAgIEJVR19PTihJU19FUlIoZG9tX2lvKSk7CisgICAg
SU5JVF9MSVNUX0hFQUQoJmRvbV9pby0+YXJjaC5wZGV2X2xpc3QpOwogCiAg
ICAgLyoKICAgICAgKiBJbml0aWFsaXNlIG91ciBDT1cgZG9tYWluLgpkaWZm
IC0tZ2l0IGEveGVuL2NvbW1vbi9kb21jdGwuYyBiL3hlbi9jb21tb24vZG9t
Y3RsLmMKaW5kZXggM2M2ZmE0ZWM2Ny4uYTcwZjRiNDZmOCAxMDA2NDQKLS0t
IGEveGVuL2NvbW1vbi9kb21jdGwuYworKysgYi94ZW4vY29tbW9uL2RvbWN0
bC5jCkBAIC0zOTIsNiArMzkyLDE2IEBAIGxvbmcgZG9fZG9tY3RsKFhFTl9H
VUVTVF9IQU5ETEVfUEFSQU0oeGVuX2RvbWN0bF90KSB1X2RvbWN0bCkKIAog
ICAgIHN3aXRjaCAoIG9wLT5jbWQgKQogICAgIHsKKyAgICBjYXNlIFhFTl9E
T01DVExfYXNzaWduX2RldmljZToKKyAgICBjYXNlIFhFTl9ET01DVExfZGVh
c3NpZ25fZGV2aWNlOgorICAgICAgICBpZiAoIG9wLT5kb21haW4gPT0gRE9N
SURfSU8gKQorICAgICAgICB7CisgICAgICAgICAgICBkID0gZG9tX2lvOwor
ICAgICAgICAgICAgYnJlYWs7CisgICAgICAgIH0KKyAgICAgICAgZWxzZSBp
ZiAoIG9wLT5kb21haW4gPT0gRE9NSURfSU5WQUxJRCApCisgICAgICAgICAg
ICByZXR1cm4gLUVTUkNIOworICAgICAgICAvKiBmYWxsIHRocm91Z2ggKi8K
ICAgICBjYXNlIFhFTl9ET01DVExfdGVzdF9hc3NpZ25fZGV2aWNlOgogICAg
ICAgICBpZiAoIG9wLT5kb21haW4gPT0gRE9NSURfSU5WQUxJRCApCiAgICAg
ICAgIHsKQEAgLTQxMyw3ICs0MjMsNyBAQCBsb25nIGRvX2RvbWN0bChYRU5f
R1VFU1RfSEFORExFX1BBUkFNKHhlbl9kb21jdGxfdCkgdV9kb21jdGwpCiAK
ICAgICBpZiAoICFkb21jdGxfbG9ja19hY3F1aXJlKCkgKQogICAgIHsKLSAg
ICAgICAgaWYgKCBkICkKKyAgICAgICAgaWYgKCBkICYmIGQgIT0gZG9tX2lv
ICkKICAgICAgICAgICAgIHJjdV91bmxvY2tfZG9tYWluKGQpOwogICAgICAg
ICByZXR1cm4gaHlwZXJjYWxsX2NyZWF0ZV9jb250aW51YXRpb24oCiAgICAg
ICAgICAgICBfX0hZUEVSVklTT1JfZG9tY3RsLCAiaCIsIHVfZG9tY3RsKTsK
QEAgLTExNjMsNyArMTE3Myw3IEBAIGxvbmcgZG9fZG9tY3RsKFhFTl9HVUVT
VF9IQU5ETEVfUEFSQU0oeGVuX2RvbWN0bF90KSB1X2RvbWN0bCkKICAgICBk
b21jdGxfbG9ja19yZWxlYXNlKCk7CiAKICBkb21jdGxfb3V0X3VubG9ja19k
b21vbmx5OgotICAgIGlmICggZCApCisgICAgaWYgKCBkICYmIGQgIT0gZG9t
X2lvICkKICAgICAgICAgcmN1X3VubG9ja19kb21haW4oZCk7CiAKICAgICBp
ZiAoIGNvcHliYWNrICYmIF9fY29weV90b19ndWVzdCh1X2RvbWN0bCwgb3As
IDEpICkKZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2Ft
ZC9wY2lfYW1kX2lvbW11LmMgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9h
bWQvcGNpX2FtZF9pb21tdS5jCmluZGV4IDEyZDI2OTViODkuLmVjOGJhYWU3
MTcgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9w
Y2lfYW1kX2lvbW11LmMKKysrIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gv
YW1kL3BjaV9hbWRfaW9tbXUuYwpAQCAtMTE4LDYgKzExOCwxMCBAQCBzdGF0
aWMgdm9pZCBhbWRfaW9tbXVfc2V0dXBfZG9tYWluX2RldmljZSgKICAgICB1
OCBidXMgPSBwZGV2LT5idXM7CiAgICAgY29uc3Qgc3RydWN0IGRvbWFpbl9p
b21tdSAqaGQgPSBkb21faW9tbXUoZG9tYWluKTsKIAorICAgIC8qIGRvbV9p
byBpcyB1c2VkIGFzIGEgc2VudGluZWwgZm9yIHF1YXJhbnRpbmVkIGRldmlj
ZXMgKi8KKyAgICBpZiAoIGRvbWFpbiA9PSBkb21faW8gKQorICAgICAgICBy
ZXR1cm47CisKICAgICBCVUdfT04oICFoZC0+YXJjaC5yb290X3RhYmxlIHx8
ICFoZC0+YXJjaC5wYWdpbmdfbW9kZSB8fAogICAgICAgICAgICAgIWlvbW11
LT5kZXZfdGFibGUuYnVmZmVyICk7CiAKQEAgLTMwNSw2ICszMDksMTAgQEAg
dm9pZCBhbWRfaW9tbXVfZGlzYWJsZV9kb21haW5fZGV2aWNlKHN0cnVjdCBk
b21haW4gKmRvbWFpbiwKICAgICBpbnQgcmVxX2lkOwogICAgIHU4IGJ1cyA9
IHBkZXYtPmJ1czsKIAorICAgIC8qIGRvbV9pbyBpcyB1c2VkIGFzIGEgc2Vu
dGluZWwgZm9yIHF1YXJhbnRpbmVkIGRldmljZXMgKi8KKyAgICBpZiAoIGRv
bWFpbiA9PSBkb21faW8gKQorICAgICAgICByZXR1cm47CisKICAgICBCVUdf
T04gKCBpb21tdS0+ZGV2X3RhYmxlLmJ1ZmZlciA9PSBOVUxMICk7CiAgICAg
cmVxX2lkID0gZ2V0X2RtYV9yZXF1ZXN0b3JfaWQoaW9tbXUtPnNlZywgUENJ
X0JERjIoYnVzLCBkZXZmbikpOwogICAgIGR0ZSA9IGlvbW11LT5kZXZfdGFi
bGUuYnVmZmVyICsgKHJlcV9pZCAqIElPTU1VX0RFVl9UQUJMRV9FTlRSWV9T
SVpFKTsKQEAgLTM5MSw3ICszOTksNyBAQCBzdGF0aWMgaW50IGFtZF9pb21t
dV9hc3NpZ25fZGV2aWNlKHN0cnVjdCBkb21haW4gKmQsIHU4IGRldmZuLAog
ICAgICAgICAgICAgaXZyc19tYXBwaW5nc1tyZXFfaWRdLnJlYWRfcGVybWlz
c2lvbik7CiAgICAgfQogCi0gICAgcmV0dXJuIHJlYXNzaWduX2RldmljZSho
YXJkd2FyZV9kb21haW4sIGQsIGRldmZuLCBwZGV2KTsKKyAgICByZXR1cm4g
cmVhc3NpZ25fZGV2aWNlKHBkZXYtPmRvbWFpbiwgZCwgZGV2Zm4sIHBkZXYp
OwogfQogCiBzdGF0aWMgdm9pZCBkZWFsbG9jYXRlX25leHRfcGFnZV90YWJs
ZShzdHJ1Y3QgcGFnZV9pbmZvICpwZywgaW50IGxldmVsKQpkaWZmIC0tZ2l0
IGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvaW9tbXUuYyBiL3hlbi9kcml2
ZXJzL3Bhc3N0aHJvdWdoL2lvbW11LmMKaW5kZXggYjVmODA0NDQzOS4uYWQy
Y2U4ZjM5YiAxMDA2NDQKLS0tIGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gv
aW9tbXUuYworKysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9pb21tdS5j
CkBAIC0yMTksNiArMjE5LDkgQEAgdm9pZCBpb21tdV90ZWFyZG93bihzdHJ1
Y3QgZG9tYWluICpkKQogewogICAgIGNvbnN0IHN0cnVjdCBkb21haW5faW9t
bXUgKmhkID0gZG9tX2lvbW11KGQpOwogCisgICAgaWYgKCBkID09IGRvbV9p
byApCisgICAgICAgIHJldHVybjsKKwogICAgIGQtPm5lZWRfaW9tbXUgPSAw
OwogICAgIGhkLT5wbGF0Zm9ybV9vcHMtPnRlYXJkb3duKGQpOwogICAgIHRh
c2tsZXRfc2NoZWR1bGUoJmlvbW11X3B0X2NsZWFudXBfdGFza2xldCk7CkBA
IC0yMjksNiArMjMyLDkgQEAgaW50IGlvbW11X2NvbnN0cnVjdChzdHJ1Y3Qg
ZG9tYWluICpkKQogICAgIGlmICggbmVlZF9pb21tdShkKSA+IDAgKQogICAg
ICAgICByZXR1cm4gMDsKIAorICAgIGlmICggZCA9PSBkb21faW8gKQorICAg
ICAgICByZXR1cm4gMDsKKwogICAgIGlmICggIWlvbW11X3VzZV9oYXBfcHQo
ZCkgKQogICAgIHsKICAgICAgICAgaW50IHJjOwpAQCAtNDA0LDYgKzQxMCw5
IEBAIGludCBfX2luaXQgaW9tbXVfc2V0dXAodm9pZCkKICAgICBwcmludGso
IkkvTyB2aXJ0dWFsaXNhdGlvbiAlc2FibGVkXG4iLCBpb21tdV9lbmFibGVk
ID8gImVuIiA6ICJkaXMiKTsKICAgICBpZiAoIGlvbW11X2VuYWJsZWQgKQog
ICAgIHsKKyAgICAgICAgaWYgKCBpb21tdV9kb21haW5faW5pdChkb21faW8p
ICkKKyAgICAgICAgICAgIHBhbmljKCJDb3VsZCBub3Qgc2V0IHVwIHF1YXJh
bnRpbmVcbiIpOworCiAgICAgICAgIHByaW50aygiIC0gRG9tMCBtb2RlOiAl
c1xuIiwKICAgICAgICAgICAgICAgIGlvbW11X3Bhc3N0aHJvdWdoID8gIlBh
c3N0aHJvdWdoIiA6CiAgICAgICAgICAgICAgICBpb21tdV9kb20wX3N0cmlj
dCA/ICJTdHJpY3QiIDogIlJlbGF4ZWQiKTsKZGlmZiAtLWdpdCBhL3hlbi9k
cml2ZXJzL3Bhc3N0aHJvdWdoL3BjaS5jIGIveGVuL2RyaXZlcnMvcGFzc3Ro
cm91Z2gvcGNpLmMKaW5kZXggZTE2NjhhMTk2OC4uNmIyZTlkMjg5NiAxMDA2
NDQKLS0tIGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvcGNpLmMKKysrIGIv
eGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvcGNpLmMKQEAgLTEzNTksMTkgKzEz
NTksMjkgQEAgc3RhdGljIGludCBpb21tdV9yZW1vdmVfZGV2aWNlKHN0cnVj
dCBwY2lfZGV2ICpwZGV2KQogICAgIHJldHVybiBoZC0+cGxhdGZvcm1fb3Bz
LT5yZW1vdmVfZGV2aWNlKHBkZXYtPmRldmZuLCBwY2lfdG9fZGV2KHBkZXYp
KTsKIH0KIAotLyoKLSAqIElmIHRoZSBkZXZpY2UgaXNuJ3Qgb3duZWQgYnkg
dGhlIGhhcmR3YXJlIGRvbWFpbiwgaXQgbWVhbnMgaXQgYWxyZWFkeQotICog
aGFzIGJlZW4gYXNzaWduZWQgdG8gb3RoZXIgZG9tYWluLCBvciBpdCBkb2Vz
bid0IGV4aXN0LgotICovCiBzdGF0aWMgaW50IGRldmljZV9hc3NpZ25lZCh1
MTYgc2VnLCB1OCBidXMsIHU4IGRldmZuKQogewogICAgIHN0cnVjdCBwY2lf
ZGV2ICpwZGV2OworICAgIGludCByYyA9IDA7CiAKICAgICBwY2lkZXZzX2xv
Y2soKTsKLSAgICBwZGV2ID0gcGNpX2dldF9wZGV2X2J5X2RvbWFpbihoYXJk
d2FyZV9kb21haW4sIHNlZywgYnVzLCBkZXZmbik7CisKKyAgICBwZGV2ID0g
cGNpX2dldF9wZGV2KHNlZywgYnVzLCBkZXZmbik7CisKKyAgICBpZiAoICFw
ZGV2ICkKKyAgICAgICAgcmMgPSAtRU5PREVWOworICAgIC8qCisgICAgICog
SWYgdGhlIGRldmljZSBleGlzdHMgYW5kIGl0IGlzIG5vdCBvd25lZCBieSBl
aXRoZXIgdGhlIGhhcmR3YXJlCisgICAgICogZG9tYWluIG9yIGRvbV9pbyB0
aGVuIGl0IG11c3QgYmUgYXNzaWduZWQgdG8gYSBndWVzdCwgb3IgYmUKKyAg
ICAgKiBoaWRkZW4gKG93bmVkIGJ5IGRvbV94ZW4pLgorICAgICAqLworICAg
IGVsc2UgaWYgKCBwZGV2LT5kb21haW4gIT0gaGFyZHdhcmVfZG9tYWluICYm
CisgICAgICAgICAgICAgIHBkZXYtPmRvbWFpbiAhPSBkb21faW8gKQorICAg
ICAgICByYyA9IC1FQlVTWTsKKwogICAgIHBjaWRldnNfdW5sb2NrKCk7CiAK
LSAgICByZXR1cm4gcGRldiA/IDAgOiAtRUJVU1k7CisgICAgcmV0dXJuIHJj
OwogfQogCiBzdGF0aWMgaW50IGFzc2lnbl9kZXZpY2Uoc3RydWN0IGRvbWFp
biAqZCwgdTE2IHNlZywgdTggYnVzLCB1OCBkZXZmbiwgdTMyIGZsYWcpCkBA
IC0xMzg1LDcgKzEzOTUsOCBAQCBzdGF0aWMgaW50IGFzc2lnbl9kZXZpY2Uo
c3RydWN0IGRvbWFpbiAqZCwgdTE2IHNlZywgdTggYnVzLCB1OCBkZXZmbiwg
dTMyIGZsYWcpCiAKICAgICAvKiBQcmV2ZW50IGRldmljZSBhc3NpZ24gaWYg
bWVtIHBhZ2luZyBvciBtZW0gc2hhcmluZyBoYXZlIGJlZW4gCiAgICAgICog
ZW5hYmxlZCBmb3IgdGhpcyBkb21haW4gKi8KLSAgICBpZiAoIHVubGlrZWx5
KCFuZWVkX2lvbW11KGQpICYmCisgICAgaWYgKCBkICE9IGRvbV9pbyAmJgor
ICAgICAgICAgdW5saWtlbHkoIW5lZWRfaW9tbXUoZCkgJiYKICAgICAgICAg
ICAgICgoaXNfaHZtX2RvbWFpbihkKSAmJgogICAgICAgICAgICAgICBkLT5h
cmNoLmh2bV9kb21haW4ubWVtX3NoYXJpbmdfZW5hYmxlZCkgfHwKICAgICAg
ICAgICAgICB2bV9ldmVudF9jaGVja19yaW5nKGQtPnZtX2V2ZW50X3BhZ2lu
ZykgfHwKQEAgLTE0MDIsMTIgKzE0MTMsMjAgQEAgc3RhdGljIGludCBhc3Np
Z25fZGV2aWNlKHN0cnVjdCBkb21haW4gKmQsIHUxNiBzZWcsIHU4IGJ1cywg
dTggZGV2Zm4sIHUzMiBmbGFnKQogICAgICAgICByZXR1cm4gcmM7CiAgICAg
fQogCi0gICAgcGRldiA9IHBjaV9nZXRfcGRldl9ieV9kb21haW4oaGFyZHdh
cmVfZG9tYWluLCBzZWcsIGJ1cywgZGV2Zm4pOworICAgIHBkZXYgPSBwY2lf
Z2V0X3BkZXYoc2VnLCBidXMsIGRldmZuKTsKKworICAgIHJjID0gLUVOT0RF
VjsKICAgICBpZiAoICFwZGV2ICkKLSAgICB7Ci0gICAgICAgIHJjID0gcGNp
X2dldF9wZGV2KHNlZywgYnVzLCBkZXZmbikgPyAtRUJVU1kgOiAtRU5PREVW
OwogICAgICAgICBnb3RvIGRvbmU7Ci0gICAgfQorCisgICAgcmMgPSAwOwor
ICAgIGlmICggZCA9PSBwZGV2LT5kb21haW4gKQorICAgICAgICBnb3RvIGRv
bmU7CisKKyAgICByYyA9IC1FQlVTWTsKKyAgICBpZiAoIHBkZXYtPmRvbWFp
biAhPSBoYXJkd2FyZV9kb21haW4gJiYKKyAgICAgICAgIHBkZXYtPmRvbWFp
biAhPSBkb21faW8gKQorICAgICAgICBnb3RvIGRvbmU7CiAKICAgICBpZiAo
IHBkZXYtPm1zaXggKQogICAgICAgICBtc2l4dGJsX2luaXQoZCk7CkBAIC0x
NDMwLDYgKzE0NDksMTAgQEAgc3RhdGljIGludCBhc3NpZ25fZGV2aWNlKHN0
cnVjdCBkb21haW4gKmQsIHUxNiBzZWcsIHU4IGJ1cywgdTggZGV2Zm4sIHUz
MiBmbGFnKQogICAgIH0KIAogIGRvbmU6CisgICAgLyogVGhlIGRldmljZSBp
cyBhc3NpZ25lZCB0byBkb21faW8gc28gbWFyayBpdCBhcyBxdWFyYW50aW5l
ZCAqLworICAgIGlmICggIXJjICYmIGQgPT0gZG9tX2lvICkKKyAgICAgICAg
cGRldi0+cXVhcmFudGluZSA9IHRydWU7CisKICAgICBpZiAoICFoYXNfYXJj
aF9wZGV2cyhkKSAmJiBuZWVkX2lvbW11KGQpICkKICAgICAgICAgaW9tbXVf
dGVhcmRvd24oZCk7CiAgICAgcGNpZGV2c191bmxvY2soKTsKQEAgLTE0NDIs
NiArMTQ2NSw3IEBAIGludCBkZWFzc2lnbl9kZXZpY2Uoc3RydWN0IGRvbWFp
biAqZCwgdTE2IHNlZywgdTggYnVzLCB1OCBkZXZmbikKIHsKICAgICBjb25z
dCBzdHJ1Y3QgZG9tYWluX2lvbW11ICpoZCA9IGRvbV9pb21tdShkKTsKICAg
ICBzdHJ1Y3QgcGNpX2RldiAqcGRldiA9IE5VTEw7CisgICAgc3RydWN0IGRv
bWFpbiAqdGFyZ2V0OwogICAgIGludCByZXQgPSAwOwogCiAgICAgaWYgKCAh
aW9tbXVfZW5hYmxlZCB8fCAhaGQtPnBsYXRmb3JtX29wcyApCkBAIC0xNDUy
LDEyICsxNDc2LDE2IEBAIGludCBkZWFzc2lnbl9kZXZpY2Uoc3RydWN0IGRv
bWFpbiAqZCwgdTE2IHNlZywgdTggYnVzLCB1OCBkZXZmbikKICAgICBpZiAo
ICFwZGV2ICkKICAgICAgICAgcmV0dXJuIC1FTk9ERVY7CiAKKyAgICAvKiBE
ZS1hc3NpZ25tZW50IGZyb20gZG9tX2lvIHNob3VsZCBkZS1xdWFyYW50aW5l
IHRoZSBkZXZpY2UgKi8KKyAgICB0YXJnZXQgPSAocGRldi0+cXVhcmFudGlu
ZSAmJiBwZGV2LT5kb21haW4gIT0gZG9tX2lvKSA/CisgICAgICAgIGRvbV9p
byA6IGhhcmR3YXJlX2RvbWFpbjsKKwogICAgIHdoaWxlICggcGRldi0+cGhh
bnRvbV9zdHJpZGUgKQogICAgIHsKICAgICAgICAgZGV2Zm4gKz0gcGRldi0+
cGhhbnRvbV9zdHJpZGU7CiAgICAgICAgIGlmICggUENJX1NMT1QoZGV2Zm4p
ICE9IFBDSV9TTE9UKHBkZXYtPmRldmZuKSApCiAgICAgICAgICAgICBicmVh
azsKLSAgICAgICAgcmV0ID0gaGQtPnBsYXRmb3JtX29wcy0+cmVhc3NpZ25f
ZGV2aWNlKGQsIGhhcmR3YXJlX2RvbWFpbiwgZGV2Zm4sCisgICAgICAgIHJl
dCA9IGhkLT5wbGF0Zm9ybV9vcHMtPnJlYXNzaWduX2RldmljZShkLCB0YXJn
ZXQsIGRldmZuLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgcGNpX3RvX2RldihwZGV2KSk7CiAgICAgICAgIGlm
ICggIXJldCApCiAgICAgICAgICAgICBjb250aW51ZTsKQEAgLTE0NjgsNyAr
MTQ5Niw3IEBAIGludCBkZWFzc2lnbl9kZXZpY2Uoc3RydWN0IGRvbWFpbiAq
ZCwgdTE2IHNlZywgdTggYnVzLCB1OCBkZXZmbikKICAgICB9CiAKICAgICBk
ZXZmbiA9IHBkZXYtPmRldmZuOwotICAgIHJldCA9IGhkLT5wbGF0Zm9ybV9v
cHMtPnJlYXNzaWduX2RldmljZShkLCBoYXJkd2FyZV9kb21haW4sIGRldmZu
LAorICAgIHJldCA9IGhkLT5wbGF0Zm9ybV9vcHMtPnJlYXNzaWduX2Rldmlj
ZShkLCB0YXJnZXQsIGRldmZuLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBwY2lfdG9fZGV2KHBkZXYpKTsKICAgICBp
ZiAoIHJldCApCiAgICAgewpAQCAtMTQ3OCw2ICsxNTA2LDkgQEAgaW50IGRl
YXNzaWduX2RldmljZShzdHJ1Y3QgZG9tYWluICpkLCB1MTYgc2VnLCB1OCBi
dXMsIHU4IGRldmZuKQogICAgICAgICByZXR1cm4gcmV0OwogICAgIH0KIAor
ICAgIGlmICggcGRldi0+ZG9tYWluID09IGhhcmR3YXJlX2RvbWFpbiAgKQor
ICAgICAgICBwZGV2LT5xdWFyYW50aW5lID0gZmFsc2U7CisKICAgICBwZGV2
LT5mYXVsdC5jb3VudCA9IDA7CiAKICAgICBpZiAoICFoYXNfYXJjaF9wZGV2
cyhkKSAmJiBuZWVkX2lvbW11KGQpICkKQEAgLTE2NTYsNyArMTY4Nyw3IEBA
IGludCBpb21tdV9kb19wY2lfZG9tY3RsKAogICAgICAgICAgICAgcmV0ID0g
aHlwZXJjYWxsX2NyZWF0ZV9jb250aW51YXRpb24oX19IWVBFUlZJU09SX2Rv
bWN0bCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICJoIiwgdV9kb21jdGwpOwogICAgICAgICBlbHNlIGlmICgg
cmV0ICkKLSAgICAgICAgICAgIHByaW50ayhYRU5MT0dfR19FUlIgIlhFTl9E
T01DVExfYXNzaWduX2RldmljZTogIgorICAgICAgICAgICAgcHJpbnRrKFhF
TkxPR19HX0VSUgogICAgICAgICAgICAgICAgICAgICJhc3NpZ24gJTA0eDol
MDJ4OiUwMnguJXUgdG8gZG9tJWQgZmFpbGVkICglZClcbiIsCiAgICAgICAg
ICAgICAgICAgICAgc2VnLCBidXMsIFBDSV9TTE9UKGRldmZuKSwgUENJX0ZV
TkMoZGV2Zm4pLAogICAgICAgICAgICAgICAgICAgIGQtPmRvbWFpbl9pZCwg
cmV0KTsKZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0
ZC9pb21tdS5jIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvdnRkL2lvbW11
LmMKaW5kZXggNDgxZWZlZjJiMC4uMWQxNjEyN2Q4ZiAxMDA2NDQKLS0tIGEv
eGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvdnRkL2lvbW11LmMKKysrIGIveGVu
L2RyaXZlcnMvcGFzc3Rocm91Z2gvdnRkL2lvbW11LmMKQEAgLTEzMzIsNiAr
MTMzMiwxMCBAQCBpbnQgZG9tYWluX2NvbnRleHRfbWFwcGluZ19vbmUoCiAg
ICAgaW50IGFnYXcsIHJjLCByZXQ7CiAgICAgYm9vbF90IGZsdXNoX2Rldl9p
b3RsYjsKIAorICAgIC8qIGRvbV9pbyBpcyB1c2VkIGFzIGEgc2VudGluZWwg
Zm9yIHF1YXJhbnRpbmVkIGRldmljZXMgKi8KKyAgICBpZiAoIGRvbWFpbiA9
PSBkb21faW8gKQorICAgICAgICByZXR1cm4gMDsKKwogICAgIEFTU0VSVChw
Y2lkZXZzX2xvY2tlZCgpKTsKICAgICBzcGluX2xvY2soJmlvbW11LT5sb2Nr
KTsKICAgICBtYWRkciA9IGJ1c190b19jb250ZXh0X21hZGRyKGlvbW11LCBi
dXMpOwpAQCAtMTU2Nyw2ICsxNTcxLDEwIEBAIGludCBkb21haW5fY29udGV4
dF91bm1hcF9vbmUoCiAgICAgaW50IGlvbW11X2RvbWlkLCByYywgcmV0Owog
ICAgIGJvb2xfdCBmbHVzaF9kZXZfaW90bGI7CiAKKyAgICAvKiBkb21faW8g
aXMgdXNlZCBhcyBhIHNlbnRpbmVsIGZvciBxdWFyYW50aW5lZCBkZXZpY2Vz
ICovCisgICAgaWYgKCBkb21haW4gPT0gZG9tX2lvICkKKyAgICAgICAgcmV0
dXJuIDA7CisKICAgICBBU1NFUlQocGNpZGV2c19sb2NrZWQoKSk7CiAgICAg
c3Bpbl9sb2NrKCZpb21tdS0+bG9jayk7CiAKQEAgLTE2OTksNiArMTcwNywx
MCBAQCBzdGF0aWMgaW50IGRvbWFpbl9jb250ZXh0X3VubWFwKHN0cnVjdCBk
b21haW4gKmRvbWFpbiwgdTggZGV2Zm4sCiAgICAgICAgIGdvdG8gb3V0Owog
ICAgIH0KIAorICAgIC8qIGRvbV9pbyBpcyB1c2VkIGFzIGEgc2VudGluZWwg
Zm9yIHF1YXJhbnRpbmVkIGRldmljZXMgKi8KKyAgICBpZiAoIGRvbWFpbiA9
PSBkb21faW8gKQorICAgICAgICBnb3RvIG91dDsKKwogICAgIC8qCiAgICAg
ICogaWYgbm8gb3RoZXIgZGV2aWNlcyB1bmRlciB0aGUgc2FtZSBpb21tdSBv
d25lZCBieSB0aGlzIGRvbWFpbiwKICAgICAgKiBjbGVhciBpb21tdSBpbiBp
b21tdV9iaXRtYXAgYW5kIGNsZWFyIGRvbWFpbl9pZCBpbiBkb21pZF9iaXRt
cApAQCAtMjM4Myw2ICsyMzk1LDE1IEBAIHN0YXRpYyBpbnQgcmVhc3NpZ25f
ZGV2aWNlX293bmVyc2hpcCgKICAgICBpZiAoIHJldCApCiAgICAgICAgIHJl
dHVybiByZXQ7CiAKKyAgICBpZiAoIGRldmZuID09IHBkZXYtPmRldmZuICkK
KyAgICB7CisgICAgICAgIGxpc3RfbW92ZSgmcGRldi0+ZG9tYWluX2xpc3Qs
ICZkb21faW8tPmFyY2gucGRldl9saXN0KTsKKyAgICAgICAgcGRldi0+ZG9t
YWluID0gZG9tX2lvOworICAgIH0KKworICAgIGlmICggIWhhc19hcmNoX3Bk
ZXZzKHNvdXJjZSkgKQorICAgICAgICB2bXhfcGlfaG9va3NfZGVhc3NpZ24o
c291cmNlKTsKKwogICAgIGlmICggIWhhc19hcmNoX3BkZXZzKHRhcmdldCkg
KQogICAgICAgICB2bXhfcGlfaG9va3NfYXNzaWduKHRhcmdldCk7CiAKQEAg
LTI0MDEsMTUgKzI0MjIsMTMgQEAgc3RhdGljIGludCByZWFzc2lnbl9kZXZp
Y2Vfb3duZXJzaGlwKAogICAgICAgICBwZGV2LT5kb21haW4gPSB0YXJnZXQ7
CiAgICAgfQogCi0gICAgaWYgKCAhaGFzX2FyY2hfcGRldnMoc291cmNlKSAp
Ci0gICAgICAgIHZteF9waV9ob29rc19kZWFzc2lnbihzb3VyY2UpOwotCiAg
ICAgcmV0dXJuIHJldDsKIH0KIAogc3RhdGljIGludCBpbnRlbF9pb21tdV9h
c3NpZ25fZGV2aWNlKAogICAgIHN0cnVjdCBkb21haW4gKmQsIHU4IGRldmZu
LCBzdHJ1Y3QgcGNpX2RldiAqcGRldiwgdTMyIGZsYWcpCiB7CisgICAgc3Ry
dWN0IGRvbWFpbiAqcyA9IHBkZXYtPmRvbWFpbjsKICAgICBzdHJ1Y3QgYWNw
aV9ybXJyX3VuaXQgKnJtcnI7CiAgICAgaW50IHJldCA9IDAsIGk7CiAgICAg
dTE2IGJkZiwgc2VnOwpAQCAtMjQ1Miw4ICsyNDcxLDggQEAgc3RhdGljIGlu
dCBpbnRlbF9pb21tdV9hc3NpZ25fZGV2aWNlKAogICAgICAgICB9CiAgICAg
fQogCi0gICAgcmV0ID0gcmVhc3NpZ25fZGV2aWNlX293bmVyc2hpcChoYXJk
d2FyZV9kb21haW4sIGQsIGRldmZuLCBwZGV2KTsKLSAgICBpZiAoIHJldCAp
CisgICAgcmV0ID0gcmVhc3NpZ25fZGV2aWNlX293bmVyc2hpcChzLCBkLCBk
ZXZmbiwgcGRldik7CisgICAgaWYgKCByZXQgfHwgZCA9PSBkb21faW8gKQog
ICAgICAgICByZXR1cm4gcmV0OwogCiAgICAgLyogU2V0dXAgcm1yciBpZGVu
dGl0eSBtYXBwaW5nICovCkBAIC0yNDY2LDExICsyNDg1LDIwIEBAIHN0YXRp
YyBpbnQgaW50ZWxfaW9tbXVfYXNzaWduX2RldmljZSgKICAgICAgICAgICAg
IHJldCA9IHJtcnJfaWRlbnRpdHlfbWFwcGluZyhkLCAxLCBybXJyLCBmbGFn
KTsKICAgICAgICAgICAgIGlmICggcmV0ICkKICAgICAgICAgICAgIHsKLSAg
ICAgICAgICAgICAgICByZWFzc2lnbl9kZXZpY2Vfb3duZXJzaGlwKGQsIGhh
cmR3YXJlX2RvbWFpbiwgZGV2Zm4sIHBkZXYpOworICAgICAgICAgICAgICAg
IGludCByYzsKKworICAgICAgICAgICAgICAgIHJjID0gcmVhc3NpZ25fZGV2
aWNlX293bmVyc2hpcChkLCBzLCBkZXZmbiwgcGRldik7CiAgICAgICAgICAg
ICAgICAgcHJpbnRrKFhFTkxPR19HX0VSUiBWVERQUkVGSVgKICAgICAgICAg
ICAgICAgICAgICAgICAgIiBjYW5ub3QgbWFwIHJlc2VydmVkIHJlZ2lvbiAo
JSJQUkl4NjQiLCUiUFJJeDY0Il0gZm9yIERvbSVkICglZClcbiIsCiAgICAg
ICAgICAgICAgICAgICAgICAgIHJtcnItPmJhc2VfYWRkcmVzcywgcm1yci0+
ZW5kX2FkZHJlc3MsCiAgICAgICAgICAgICAgICAgICAgICAgIGQtPmRvbWFp
bl9pZCwgcmV0KTsKKyAgICAgICAgICAgICAgICBpZiAoIHJjICkKKyAgICAg
ICAgICAgICAgICB7CisgICAgICAgICAgICAgICAgICAgIHByaW50ayhYRU5M
T0dfRVJSIFZURFBSRUZJWAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
IiBmYWlsZWQgdG8gcmVjbGFpbSAlMDR4OiUwMng6JTAyeC4ldSBmcm9tICVw
ZCAoJWQpXG4iLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VnLCBi
dXMsIFBDSV9TTE9UKGRldmZuKSwgUENJX0ZVTkMoZGV2Zm4pLCBkLCByYyk7
CisgICAgICAgICAgICAgICAgICAgIGRvbWFpbl9jcmFzaChkKTsKKyAgICAg
ICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg
ICAgICB9CiAgICAgICAgIH0KZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL3hl
bi9wY2kuaCBiL3hlbi9pbmNsdWRlL3hlbi9wY2kuaAppbmRleCA0M2YyMTI1
MWE1Li4zMjQxZTUxZTNjIDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS94ZW4v
cGNpLmgKKysrIGIveGVuL2luY2x1ZGUveGVuL3BjaS5oCkBAIC02OCw2ICs2
OCw5IEBAIHN0cnVjdCBwY2lfZGV2IHsKIAogICAgIG5vZGVpZF90IG5vZGU7
IC8qIE5VTUEgbm9kZSAqLwogCisgICAgLyogRGV2aWNlIHRvIGJlIHF1YXJh
bnRpbmVkLCBkb24ndCBhdXRvbWF0aWNhbGx5IHJlLWFzc2lnbiB0byBkb20w
ICovCisgICAgYm9vbCBxdWFyYW50aW5lOworCiAgICAgZW51bSBwZGV2X3R5
cGUgewogICAgICAgICBERVZfVFlQRV9QQ0lfVU5LTk9XTiwKICAgICAgICAg
REVWX1RZUEVfUENJZV9FTkRQT0lOVCwKLS0gCjIuMTEuMAoK

--=separator
Content-Type: application/octet-stream;
 name="xsa302-4.11/0001-IOMMU-add-missing-HVM-check.patch"
Content-Disposition: attachment;
 filename="xsa302-4.11/0001-IOMMU-add-missing-HVM-check.patch"
Content-Transfer-Encoding: base64

RnJvbSBiYmNhMjlmODhkOWFkOWM3ZTkxMTI1YTNiNWQ1ZjEzYTIzZTU4MDFm
IE1vbiBTZXAgMTcgMDA6MDA6MDAgMjAwMQpGcm9tOiBKYW4gQmV1bGljaCA8
amJldWxpY2hAc3VzZS5jb20+CkRhdGU6IFdlZCwgMiBPY3QgMjAxOSAxMzoz
Njo1OSArMDIwMApTdWJqZWN0OiBbUEFUQ0ggMS8yXSBJT01NVTogYWRkIG1p
c3NpbmcgSFZNIGNoZWNrCk1JTUUtVmVyc2lvbjogMS4wCkNvbnRlbnQtVHlw
ZTogdGV4dC9wbGFpbjsgY2hhcnNldD1VVEYtOApDb250ZW50LVRyYW5zZmVy
LUVuY29kaW5nOiA4Yml0CgpGaXggYW4gdW5ndWFyZGVkIGQtPmFyY2guaHZt
IGFjY2VzcyBpbiBhc3NpZ25fZGV2aWNlKCkuCgpTaWduZWQtb2ZmLWJ5OiBK
YW4gQmV1bGljaCA8amJldWxpY2hAc3VzZS5jb20+ClJldmlld2VkLWJ5OiBS
b2dlciBQYXUgTW9ubsOpIDxyb2dlci5wYXVAY2l0cml4LmNvbT4KQWNrZWQt
Ynk6IEFuZHJldyBDb29wZXIgPGFuZHJldy5jb29wZXIzQGNpdHJpeC5jb20+
CgooY2hlcnJ5IHBpY2tlZCBmcm9tIGNvbW1pdCA0MWZkMTAwOWNkNzQxNmI3
M2Q3NDVhNzdjMjRiNGU4ZDFhMjk2ZmU2KQpTaWduZWQtb2ZmLWJ5OiBJYW4g
SmFja3NvbiA8aWFuLmphY2tzb25AZXUuY2l0cml4LmNvbT4KLS0tCiB4ZW4v
ZHJpdmVycy9wYXNzdGhyb3VnaC9wY2kuYyB8IDMgKystCiAxIGZpbGUgY2hh
bmdlZCwgMiBpbnNlcnRpb25zKCspLCAxIGRlbGV0aW9uKC0pCgpkaWZmIC0t
Z2l0IGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvcGNpLmMgYi94ZW4vZHJp
dmVycy9wYXNzdGhyb3VnaC9wY2kuYwppbmRleCBmNTFjYWU3ZjRlLi4wMzdh
YmE3Yzk0IDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9w
Y2kuYworKysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9wY2kuYwpAQCAt
MTQxNiw3ICsxNDE2LDggQEAgc3RhdGljIGludCBhc3NpZ25fZGV2aWNlKHN0
cnVjdCBkb21haW4gKmQsIHUxNiBzZWcsIHU4IGJ1cywgdTggZGV2Zm4sIHUz
MiBmbGFnKQogICAgIC8qIFByZXZlbnQgZGV2aWNlIGFzc2lnbiBpZiBtZW0g
cGFnaW5nIG9yIG1lbSBzaGFyaW5nIGhhdmUgYmVlbiAKICAgICAgKiBlbmFi
bGVkIGZvciB0aGlzIGRvbWFpbiAqLwogICAgIGlmICggdW5saWtlbHkoIW5l
ZWRfaW9tbXUoZCkgJiYKLSAgICAgICAgICAgIChkLT5hcmNoLmh2bV9kb21h
aW4ubWVtX3NoYXJpbmdfZW5hYmxlZCB8fAorICAgICAgICAgICAgKChpc19o
dm1fZG9tYWluKGQpICYmCisgICAgICAgICAgICAgIGQtPmFyY2guaHZtX2Rv
bWFpbi5tZW1fc2hhcmluZ19lbmFibGVkKSB8fAogICAgICAgICAgICAgIHZt
X2V2ZW50X2NoZWNrX3JpbmcoZC0+dm1fZXZlbnRfcGFnaW5nKSB8fAogICAg
ICAgICAgICAgIHAybV9nZXRfaG9zdHAybShkKS0+Z2xvYmFsX2xvZ2RpcnR5
KSkgKQogICAgICAgICByZXR1cm4gLUVYREVWOwotLSAKMi4xMS4wCgo=

--=separator
Content-Type: application/octet-stream;
 name="xsa302-4.11/0002-passthrough-quarantine-PCI-devices.patch"
Content-Disposition: attachment;
 filename="xsa302-4.11/0002-passthrough-quarantine-PCI-devices.patch"
Content-Transfer-Encoding: base64

RnJvbSBlYzk5ODU3ZjU5ZjdmMDYyMzZmMTFjYThiMGIyMzAzZTVlNzQ1Y2M0
IE1vbiBTZXAgMTcgMDA6MDA6MDAgMjAwMQpGcm9tOiBQYXVsIER1cnJhbnQg
PHBhdWwuZHVycmFudEBjaXRyaXguY29tPgpEYXRlOiBNb24sIDE0IE9jdCAy
MDE5IDE3OjUyOjU5ICswMTAwClN1YmplY3Q6IFtQQVRDSCAyLzJdIHBhc3N0
aHJvdWdoOiBxdWFyYW50aW5lIFBDSSBkZXZpY2VzCgpXaGVuIGEgUENJIGRl
dmljZSBpcyBhc3NpZ25lZCB0byBhbiB1bnRydXN0ZWQgZG9tYWluLCBpdCBp
cyBwb3NzaWJsZSBmb3IKdGhhdCBkb21haW4gdG8gcHJvZ3JhbSB0aGUgZGV2
aWNlIHRvIERNQSB0byBhbiBhcmJpdHJhcnkgYWRkcmVzcy4gVGhlCklPTU1V
IGlzIHVzZWQgdG8gcHJvdGVjdCB0aGUgaG9zdCBmcm9tIG1hbGljaW91cyBE
TUEgYnkgbWFraW5nIHN1cmUgdGhhdAp0aGUgZGV2aWNlIGFkZHJlc3NlcyBj
YW4gb25seSB0YXJnZXQgbWVtb3J5IGFzc2lnbmVkIHRvIHRoZSBndWVzdC4g
SG93ZXZlciwKd2hlbiB0aGUgZ3Vlc3QgZG9tYWluIGlzIHRvcm4gZG93biB0
aGUgZGV2aWNlIGlzIGFzc2lnbmVkIGJhY2sgdG8gZG9tMCwKdGh1cyBhbGxv
d2luZyBhbnkgaW4tZmxpZ2h0IERNQSB0byBwb3RlbnRpYWxseSB0YXJnZXQg
Y3JpdGljYWwgaG9zdCBkYXRhLgoKVGhpcyBwYXRjaCBpbnRyb2R1Y2VzIGEg
J3F1YXJhbnRpbmUnIGZvciBQQ0kgZGV2aWNlcyB1c2luZyBkb21faW8uIFdo
ZW4KdGhlIHRvb2xzdGFjayBtYWtlcyBhIGRldmljZSBhc3NpZ25hYmxlIChi
eSBiaW5kaW5nIGl0IHRvIHBjaWJhY2spLCBpdAp3aWxsIG5vdyBhbHNvIGFz
c2lnbiBpdCB0byBET01JRF9JTyBhbmQgdGhlIGRldmljZSB3aWxsIG9ubHkg
YmUgYXNzaWduZWQKYmFjayB0byBkb20wIHdoZW4gdGhlIGRldmljZSBpcyBt
YWRlIHVuYXNzaWduYWJsZSBhZ2Fpbi4gV2hpbHN0IGRldmljZSBpcwphc3Np
Z25hYmxlIGl0IHdpbGwgb25seSBldmVyIHRyYW5zZmVyIGJldHdlZW4gZG9t
X2lvIGFuZCBndWVzdCBkb21haW5zLgpkb21faW8gaXMgYWN0dWFsbHkgb25s
eSB1c2VkIGFzIGEgc2VudGluZWwgZG9tYWluIGZvciBxdWFyYW50aW5pbmcg
cHVycG9zZXM7Cml0IGlzIG5vdCBjb25maWd1cmVkIHdpdGggYW55IElPTU1V
IG1hcHBpbmdzLiBBc3NpZ25tZW50IHRvIGRvbV9pbyBzaW1wbHkKbWVhbnMg
dGhhdCB0aGUgZGV2aWNlJ3MgaW5pdGlhdG9yIChyZXF1ZXN0b3IpIGlkZW50
aWZpZXIgaXMgbm90IHByZXNlbnQgaW4KdGhlIElPTU1VJ3MgZGV2aWNlIHRh
YmxlIGFuZCB0aHVzIGFueSBETUEgdHJhbnNhY3Rpb25zIGlzc3VlZCB3aWxs
IGJlCnRlcm1pbmF0ZWQgd2l0aCBhIGZhdWx0IGNvbmRpdGlvbi4KCkluIGFk
ZGl0aW9uLCBhIGZpeCB0byBhc3NpZ25tZW50IGhhbmRsaW5nIGlzIG1hZGUg
Zm9yIFZULWQuICBGYWlsdXJlCmR1cmluZyB0aGUgYXNzaWdubWVudCBzdGVw
IHNob3VsZCBub3QgbGVhZCB0byBhIGRldmljZSBzdGlsbCBiZWluZwphc3Nv
Y2lhdGVkIHdpdGggaXRzIHByaW9yIG93bmVyLiBIYW5kIHRoZSBkZXZpY2Ug
dG8gRG9tSU8gdGVtcG9yYXJpbHksCnVudGlsIHRoZSBhc3NpZ25tZW50IHN0
ZXAgaGFzIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuICBSZW1vdmUgdGhlIFBJ
Cmhvb2tzIGZyb20gdGhlIHNvdXJjZSBkb21haW4gdGhlbiBlYXJsaWVyIGFz
IHdlbGwuCgpGYWlsdXJlIG9mIHRoZSByZWNvdmVyeSByZWFzc2lnbl9kZXZp
Y2Vfb3duZXJzaGlwKCkgbWF5IG5vdCBnbyBzaWxlbnQ6ClRoZXJlIGUuZy4g
bWF5IHN0aWxsIGJlIGxlZnQgb3ZlciBSTVJSIG1hcHBpbmdzIGluIHRoZSBk
b21haW4gYXNzaWdubWVudAp0byB3aGljaCBoYXMgZmFpbGVkLCBhbmQgaGVu
Y2Ugd2UgY2FuJ3QgYWxsb3cgdGhhdCBkb21haW4gdG8gY29udGludWUKZXhl
Y3V0aW5nLgoKTk9URTogVGhpcyBwYXRjaCBhbHNvIGluY2x1ZGVzIG9uZSBw
cmludGsoKSBjbGVhbnVwOyB0aGUKICAgICAgIlhFTl9ET01DVExfYXNzaWdu
X2RldmljZTogIiB0YWcgaXMgZHJvcHBlZCBpbiBpb21tdV9kb19wY2lfZG9t
Y3RsKCksCiAgICAgIHNpbmNlIHNpbWlsYXIgcHJpbnRrKCktcyBlbHNld2hl
cmUgYWxzbyBkb24ndCBsb2cgc3VjaCBhIHRhZy4KClRoaXMgaXMgWFNBLTMw
Mi4KClNpZ25lZC1vZmYtYnk6IFBhdWwgRHVycmFudCA8cGF1bC5kdXJyYW50
QGNpdHJpeC5jb20+ClNpZ25lZC1vZmYtYnk6IEphbiBCZXVsaWNoIDxqYmV1
bGljaEBzdXNlLmNvbT4KU2lnbmVkLW9mZi1ieTogSWFuIEphY2tzb24gPGlh
bi5qYWNrc29uQGV1LmNpdHJpeC5jb20+Ci0tLQogdG9vbHMvbGlieGwvbGli
eGxfcGNpLmMgICAgICAgICAgICAgICAgICAgICB8IDI1ICsrKysrKysrKysr
LQogeGVuL2FyY2gveDg2L21tLmMgICAgICAgICAgICAgICAgICAgICAgICAg
ICB8ICAyICsKIHhlbi9jb21tb24vZG9tY3RsLmMgICAgICAgICAgICAgICAg
ICAgICAgICAgfCAxNCArKysrKystCiB4ZW4vZHJpdmVycy9wYXNzdGhyb3Vn
aC9hbWQvcGNpX2FtZF9pb21tdS5jIHwgMTAgKysrKy0KIHhlbi9kcml2ZXJz
L3Bhc3N0aHJvdWdoL2lvbW11LmMgICAgICAgICAgICAgfCAgOSArKysrKwog
eGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvcGNpLmMgICAgICAgICAgICAgICB8
IDU5ICsrKysrKysrKysrKysrKysrKysrKystLS0tLS0tCiB4ZW4vZHJpdmVy
cy9wYXNzdGhyb3VnaC92dGQvaW9tbXUuYyAgICAgICAgIHwgNDAgKysrKysr
KysrKysrKysrKy0tLQogeGVuL2luY2x1ZGUveGVuL3BjaS5oICAgICAgICAg
ICAgICAgICAgICAgICB8ICAzICsrCiA4IGZpbGVzIGNoYW5nZWQsIDEzOCBp
bnNlcnRpb25zKCspLCAyNCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS90
b29scy9saWJ4bC9saWJ4bF9wY2kuYyBiL3Rvb2xzL2xpYnhsL2xpYnhsX3Bj
aS5jCmluZGV4IDQ3NTVhMGM5M2MuLjgxODkwYTkxYWMgMTAwNjQ0Ci0tLSBh
L3Rvb2xzL2xpYnhsL2xpYnhsX3BjaS5jCisrKyBiL3Rvb2xzL2xpYnhsL2xp
YnhsX3BjaS5jCkBAIC03NTQsNiArNzU0LDcgQEAgc3RhdGljIGludCBsaWJ4
bF9fZGV2aWNlX3BjaV9hc3NpZ25hYmxlX2FkZChsaWJ4bF9fZ2MgKmdjLAog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBs
aWJ4bF9kZXZpY2VfcGNpICpwY2lkZXYsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGludCByZWJpbmQpCiB7CisgICAg
bGlieGxfY3R4ICpjdHggPSBsaWJ4bF9fZ2Nfb3duZXIoZ2MpOwogICAgIHVu
c2lnbmVkIGRvbSwgYnVzLCBkZXYsIGZ1bmM7CiAgICAgY2hhciAqc3BhdGgs
ICpkcml2ZXJfcGF0aCA9IE5VTEw7CiAgICAgaW50IHJjOwpAQCAtNzc5LDcg
Kzc4MCw3IEBAIHN0YXRpYyBpbnQgbGlieGxfX2RldmljZV9wY2lfYXNzaWdu
YWJsZV9hZGQobGlieGxfX2djICpnYywKICAgICB9CiAgICAgaWYgKCByYyAp
IHsKICAgICAgICAgTE9HKFdBUk4sIFBDSV9CREYiIGFscmVhZHkgYXNzaWdu
ZWQgdG8gcGNpYmFjayIsIGRvbSwgYnVzLCBkZXYsIGZ1bmMpOwotICAgICAg
ICByZXR1cm4gMDsKKyAgICAgICAgZ290byBxdWFyYW50aW5lOwogICAgIH0K
IAogICAgIC8qIENoZWNrIHRvIHNlZSBpZiB0aGVyZSdzIGFscmVhZHkgYSBk
cml2ZXIgdGhhdCB3ZSBuZWVkIHRvIHVuYmluZCBmcm9tICovCkBAIC04MTAs
NiArODExLDE5IEBAIHN0YXRpYyBpbnQgbGlieGxfX2RldmljZV9wY2lfYXNz
aWduYWJsZV9hZGQobGlieGxfX2djICpnYywKICAgICAgICAgcmV0dXJuIEVS
Uk9SX0ZBSUw7CiAgICAgfQogCitxdWFyYW50aW5lOgorICAgIC8qCisgICAg
ICogRE9NSURfSU8gaXMganVzdCBhIHNlbnRpbmVsIGRvbWFpbiwgd2l0aG91
dCBhbnkgYWN0dWFsIG1hcHBpbmdzLAorICAgICAqIHNvIGFsd2F5cyBwYXNz
IFhFTl9ET01DVExfREVWX1JETV9SRUxBWEVEIHRvIGF2b2lkIGFzc2lnbm1l
bnQgYmVpbmcKKyAgICAgKiB1bm5lY2Vzc2FyaWx5IGRlbmllZC4KKyAgICAg
Ki8KKyAgICByYyA9IHhjX2Fzc2lnbl9kZXZpY2UoY3R4LT54Y2gsIERPTUlE
X0lPLCBwY2lkZXZfZW5jb2RlX2JkZihwY2lkZXYpLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICBYRU5fRE9NQ1RMX0RFVl9SRE1fUkVMQVhFRCk7Cisg
ICAgaWYgKCByYyA8IDAgKSB7CisgICAgICAgIExPRyhFUlJPUiwgImZhaWxl
ZCB0byBxdWFyYW50aW5lICJQQ0lfQkRGLCBkb20sIGJ1cywgZGV2LCBmdW5j
KTsKKyAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUw7CisgICAgfQorCiAgICAg
cmV0dXJuIDA7CiB9CiAKQEAgLTgxNyw5ICs4MzEsMTggQEAgc3RhdGljIGlu
dCBsaWJ4bF9fZGV2aWNlX3BjaV9hc3NpZ25hYmxlX3JlbW92ZShsaWJ4bF9f
Z2MgKmdjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBsaWJ4bF9kZXZpY2VfcGNpICpwY2lkZXYsCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBy
ZWJpbmQpCiB7CisgICAgbGlieGxfY3R4ICpjdHggPSBsaWJ4bF9fZ2Nfb3du
ZXIoZ2MpOwogICAgIGludCByYzsKICAgICBjaGFyICpkcml2ZXJfcGF0aDsK
IAorICAgIC8qIERlLXF1YXJhbnRpbmUgKi8KKyAgICByYyA9IHhjX2RlYXNz
aWduX2RldmljZShjdHgtPnhjaCwgRE9NSURfSU8sIHBjaWRldl9lbmNvZGVf
YmRmKHBjaWRldikpOworICAgIGlmICggcmMgPCAwICkgeworICAgICAgICBM
T0coRVJST1IsICJmYWlsZWQgdG8gZGUtcXVhcmFudGluZSAiUENJX0JERiwg
cGNpZGV2LT5kb21haW4sIHBjaWRldi0+YnVzLAorICAgICAgICAgICAgcGNp
ZGV2LT5kZXYsIHBjaWRldi0+ZnVuYyk7CisgICAgICAgIHJldHVybiBFUlJP
Ul9GQUlMOworICAgIH0KKwogICAgIC8qIFVuYmluZCBmcm9tIHBjaWJhY2sg
Ki8KICAgICBpZiAoIChyYz1wY2liYWNrX2Rldl9pc19hc3NpZ25lZChnYywg
cGNpZGV2KSkgPCAwICkgewogICAgICAgICByZXR1cm4gRVJST1JfRkFJTDsK
ZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9tbS5jIGIveGVuL2FyY2gveDg2
L21tLmMKaW5kZXggZTZhNGNiMjhmOC4uYzFhYjU3ZjlhNSAxMDA2NDQKLS0t
IGEveGVuL2FyY2gveDg2L21tLmMKKysrIGIveGVuL2FyY2gveDg2L21tLmMK
QEAgLTI5NSw5ICsyOTUsMTEgQEAgdm9pZCBfX2luaXQgYXJjaF9pbml0X21l
bW9yeSh2b2lkKQogICAgICAqIEluaXRpYWxpc2Ugb3VyIERPTUlEX0lPIGRv
bWFpbi4KICAgICAgKiBUaGlzIGRvbWFpbiBvd25zIEkvTyBwYWdlcyB0aGF0
IGFyZSB3aXRoaW4gdGhlIHJhbmdlIG9mIHRoZSBwYWdlX2luZm8KICAgICAg
KiBhcnJheS4gTWFwcGluZ3Mgb2NjdXIgYXQgdGhlIHByaXYgb2YgdGhlIGNh
bGxlci4KKyAgICAgKiBRdWFyYW50aW5lZCBQQ0kgZGV2aWNlcyB3aWxsIGJl
IGFzc29jaWF0ZWQgd2l0aCB0aGlzIGRvbWFpbi4KICAgICAgKi8KICAgICBk
b21faW8gPSBkb21haW5fY3JlYXRlKERPTUlEX0lPLCBOVUxMKTsKICAgICBC
VUdfT04oSVNfRVJSKGRvbV9pbykpOworICAgIElOSVRfTElTVF9IRUFEKCZk
b21faW8tPmFyY2gucGRldl9saXN0KTsKIAogICAgIC8qCiAgICAgICogSW5p
dGlhbGlzZSBvdXIgQ09XIGRvbWFpbi4KZGlmZiAtLWdpdCBhL3hlbi9jb21t
b24vZG9tY3RsLmMgYi94ZW4vY29tbW9uL2RvbWN0bC5jCmluZGV4IDliN2Jj
MDgzZWUuLjc0MWQ3NzRjZDEgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vZG9t
Y3RsLmMKKysrIGIveGVuL2NvbW1vbi9kb21jdGwuYwpAQCAtMzkyLDYgKzM5
MiwxNiBAQCBsb25nIGRvX2RvbWN0bChYRU5fR1VFU1RfSEFORExFX1BBUkFN
KHhlbl9kb21jdGxfdCkgdV9kb21jdGwpCiAKICAgICBzd2l0Y2ggKCBvcC0+
Y21kICkKICAgICB7CisgICAgY2FzZSBYRU5fRE9NQ1RMX2Fzc2lnbl9kZXZp
Y2U6CisgICAgY2FzZSBYRU5fRE9NQ1RMX2RlYXNzaWduX2RldmljZToKKyAg
ICAgICAgaWYgKCBvcC0+ZG9tYWluID09IERPTUlEX0lPICkKKyAgICAgICAg
eworICAgICAgICAgICAgZCA9IGRvbV9pbzsKKyAgICAgICAgICAgIGJyZWFr
OworICAgICAgICB9CisgICAgICAgIGVsc2UgaWYgKCBvcC0+ZG9tYWluID09
IERPTUlEX0lOVkFMSUQgKQorICAgICAgICAgICAgcmV0dXJuIC1FU1JDSDsK
KyAgICAgICAgLyogZmFsbCB0aHJvdWdoICovCiAgICAgY2FzZSBYRU5fRE9N
Q1RMX3Rlc3RfYXNzaWduX2RldmljZToKICAgICAgICAgaWYgKCBvcC0+ZG9t
YWluID09IERPTUlEX0lOVkFMSUQgKQogICAgICAgICB7CkBAIC00MTMsNyAr
NDIzLDcgQEAgbG9uZyBkb19kb21jdGwoWEVOX0dVRVNUX0hBTkRMRV9QQVJB
TSh4ZW5fZG9tY3RsX3QpIHVfZG9tY3RsKQogCiAgICAgaWYgKCAhZG9tY3Rs
X2xvY2tfYWNxdWlyZSgpICkKICAgICB7Ci0gICAgICAgIGlmICggZCApCisg
ICAgICAgIGlmICggZCAmJiBkICE9IGRvbV9pbyApCiAgICAgICAgICAgICBy
Y3VfdW5sb2NrX2RvbWFpbihkKTsKICAgICAgICAgcmV0dXJuIGh5cGVyY2Fs
bF9jcmVhdGVfY29udGludWF0aW9uKAogICAgICAgICAgICAgX19IWVBFUlZJ
U09SX2RvbWN0bCwgImgiLCB1X2RvbWN0bCk7CkBAIC0xMTQ4LDcgKzExNTgs
NyBAQCBsb25nIGRvX2RvbWN0bChYRU5fR1VFU1RfSEFORExFX1BBUkFNKHhl
bl9kb21jdGxfdCkgdV9kb21jdGwpCiAgICAgZG9tY3RsX2xvY2tfcmVsZWFz
ZSgpOwogCiAgZG9tY3RsX291dF91bmxvY2tfZG9tb25seToKLSAgICBpZiAo
IGQgKQorICAgIGlmICggZCAmJiBkICE9IGRvbV9pbyApCiAgICAgICAgIHJj
dV91bmxvY2tfZG9tYWluKGQpOwogCiAgICAgaWYgKCBjb3B5YmFjayAmJiBf
X2NvcHlfdG9fZ3Vlc3QodV9kb21jdGwsIG9wLCAxKSApCmRpZmYgLS1naXQg
YS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvcGNpX2FtZF9pb21tdS5j
IGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL3BjaV9hbWRfaW9tbXUu
YwppbmRleCAxMmQyNjk1Yjg5Li5lYzhiYWFlNzE3IDEwMDY0NAotLS0gYS94
ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvcGNpX2FtZF9pb21tdS5jCisr
KyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9wY2lfYW1kX2lvbW11
LmMKQEAgLTExOCw2ICsxMTgsMTAgQEAgc3RhdGljIHZvaWQgYW1kX2lvbW11
X3NldHVwX2RvbWFpbl9kZXZpY2UoCiAgICAgdTggYnVzID0gcGRldi0+YnVz
OwogICAgIGNvbnN0IHN0cnVjdCBkb21haW5faW9tbXUgKmhkID0gZG9tX2lv
bW11KGRvbWFpbik7CiAKKyAgICAvKiBkb21faW8gaXMgdXNlZCBhcyBhIHNl
bnRpbmVsIGZvciBxdWFyYW50aW5lZCBkZXZpY2VzICovCisgICAgaWYgKCBk
b21haW4gPT0gZG9tX2lvICkKKyAgICAgICAgcmV0dXJuOworCiAgICAgQlVH
X09OKCAhaGQtPmFyY2gucm9vdF90YWJsZSB8fCAhaGQtPmFyY2gucGFnaW5n
X21vZGUgfHwKICAgICAgICAgICAgICFpb21tdS0+ZGV2X3RhYmxlLmJ1ZmZl
ciApOwogCkBAIC0zMDUsNiArMzA5LDEwIEBAIHZvaWQgYW1kX2lvbW11X2Rp
c2FibGVfZG9tYWluX2RldmljZShzdHJ1Y3QgZG9tYWluICpkb21haW4sCiAg
ICAgaW50IHJlcV9pZDsKICAgICB1OCBidXMgPSBwZGV2LT5idXM7CiAKKyAg
ICAvKiBkb21faW8gaXMgdXNlZCBhcyBhIHNlbnRpbmVsIGZvciBxdWFyYW50
aW5lZCBkZXZpY2VzICovCisgICAgaWYgKCBkb21haW4gPT0gZG9tX2lvICkK
KyAgICAgICAgcmV0dXJuOworCiAgICAgQlVHX09OICggaW9tbXUtPmRldl90
YWJsZS5idWZmZXIgPT0gTlVMTCApOwogICAgIHJlcV9pZCA9IGdldF9kbWFf
cmVxdWVzdG9yX2lkKGlvbW11LT5zZWcsIFBDSV9CREYyKGJ1cywgZGV2Zm4p
KTsKICAgICBkdGUgPSBpb21tdS0+ZGV2X3RhYmxlLmJ1ZmZlciArIChyZXFf
aWQgKiBJT01NVV9ERVZfVEFCTEVfRU5UUllfU0laRSk7CkBAIC0zOTEsNyAr
Mzk5LDcgQEAgc3RhdGljIGludCBhbWRfaW9tbXVfYXNzaWduX2RldmljZShz
dHJ1Y3QgZG9tYWluICpkLCB1OCBkZXZmbiwKICAgICAgICAgICAgIGl2cnNf
bWFwcGluZ3NbcmVxX2lkXS5yZWFkX3Blcm1pc3Npb24pOwogICAgIH0KIAot
ICAgIHJldHVybiByZWFzc2lnbl9kZXZpY2UoaGFyZHdhcmVfZG9tYWluLCBk
LCBkZXZmbiwgcGRldik7CisgICAgcmV0dXJuIHJlYXNzaWduX2RldmljZShw
ZGV2LT5kb21haW4sIGQsIGRldmZuLCBwZGV2KTsKIH0KIAogc3RhdGljIHZv
aWQgZGVhbGxvY2F0ZV9uZXh0X3BhZ2VfdGFibGUoc3RydWN0IHBhZ2VfaW5m
byAqcGcsIGludCBsZXZlbCkKZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL3Bh
c3N0aHJvdWdoL2lvbW11LmMgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9p
b21tdS5jCmluZGV4IDA0YjBiZTM3ZDMuLjgwMjdkOTZmMWMgMTAwNjQ0Ci0t
LSBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2lvbW11LmMKKysrIGIveGVu
L2RyaXZlcnMvcGFzc3Rocm91Z2gvaW9tbXUuYwpAQCAtMjE5LDYgKzIxOSw5
IEBAIHZvaWQgaW9tbXVfdGVhcmRvd24oc3RydWN0IGRvbWFpbiAqZCkKIHsK
ICAgICBjb25zdCBzdHJ1Y3QgZG9tYWluX2lvbW11ICpoZCA9IGRvbV9pb21t
dShkKTsKIAorICAgIGlmICggZCA9PSBkb21faW8gKQorICAgICAgICByZXR1
cm47CisKICAgICBkLT5uZWVkX2lvbW11ID0gMDsKICAgICBoZC0+cGxhdGZv
cm1fb3BzLT50ZWFyZG93bihkKTsKICAgICB0YXNrbGV0X3NjaGVkdWxlKCZp
b21tdV9wdF9jbGVhbnVwX3Rhc2tsZXQpOwpAQCAtMjI5LDYgKzIzMiw5IEBA
IGludCBpb21tdV9jb25zdHJ1Y3Qoc3RydWN0IGRvbWFpbiAqZCkKICAgICBp
ZiAoIG5lZWRfaW9tbXUoZCkgPiAwICkKICAgICAgICAgcmV0dXJuIDA7CiAK
KyAgICBpZiAoIGQgPT0gZG9tX2lvICkKKyAgICAgICAgcmV0dXJuIDA7CisK
ICAgICBpZiAoICFpb21tdV91c2VfaGFwX3B0KGQpICkKICAgICB7CiAgICAg
ICAgIGludCByYzsKQEAgLTQwNCw2ICs0MTAsOSBAQCBpbnQgX19pbml0IGlv
bW11X3NldHVwKHZvaWQpCiAgICAgcHJpbnRrKCJJL08gdmlydHVhbGlzYXRp
b24gJXNhYmxlZFxuIiwgaW9tbXVfZW5hYmxlZCA/ICJlbiIgOiAiZGlzIik7
CiAgICAgaWYgKCBpb21tdV9lbmFibGVkICkKICAgICB7CisgICAgICAgIGlm
ICggaW9tbXVfZG9tYWluX2luaXQoZG9tX2lvKSApCisgICAgICAgICAgICBw
YW5pYygiQ291bGQgbm90IHNldCB1cCBxdWFyYW50aW5lXG4iKTsKKwogICAg
ICAgICBwcmludGsoIiAtIERvbTAgbW9kZTogJXNcbiIsCiAgICAgICAgICAg
ICAgICBpb21tdV9wYXNzdGhyb3VnaCA/ICJQYXNzdGhyb3VnaCIgOgogICAg
ICAgICAgICAgICAgaW9tbXVfZG9tMF9zdHJpY3QgPyAiU3RyaWN0IiA6ICJS
ZWxheGVkIik7CmRpZmYgLS1naXQgYS94ZW4vZHJpdmVycy9wYXNzdGhyb3Vn
aC9wY2kuYyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3BjaS5jCmluZGV4
IDAzN2FiYTdjOTQuLmZiMDEwYTU0N2IgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2
ZXJzL3Bhc3N0aHJvdWdoL3BjaS5jCisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0
aHJvdWdoL3BjaS5jCkBAIC0xMzg5LDE5ICsxMzg5LDI5IEBAIHN0YXRpYyBp
bnQgaW9tbXVfcmVtb3ZlX2RldmljZShzdHJ1Y3QgcGNpX2RldiAqcGRldikK
ICAgICByZXR1cm4gaGQtPnBsYXRmb3JtX29wcy0+cmVtb3ZlX2RldmljZShw
ZGV2LT5kZXZmbiwgcGNpX3RvX2RldihwZGV2KSk7CiB9CiAKLS8qCi0gKiBJ
ZiB0aGUgZGV2aWNlIGlzbid0IG93bmVkIGJ5IHRoZSBoYXJkd2FyZSBkb21h
aW4sIGl0IG1lYW5zIGl0IGFscmVhZHkKLSAqIGhhcyBiZWVuIGFzc2lnbmVk
IHRvIG90aGVyIGRvbWFpbiwgb3IgaXQgZG9lc24ndCBleGlzdC4KLSAqLwog
c3RhdGljIGludCBkZXZpY2VfYXNzaWduZWQodTE2IHNlZywgdTggYnVzLCB1
OCBkZXZmbikKIHsKICAgICBzdHJ1Y3QgcGNpX2RldiAqcGRldjsKKyAgICBp
bnQgcmMgPSAwOwogCiAgICAgcGNpZGV2c19sb2NrKCk7Ci0gICAgcGRldiA9
IHBjaV9nZXRfcGRldl9ieV9kb21haW4oaGFyZHdhcmVfZG9tYWluLCBzZWcs
IGJ1cywgZGV2Zm4pOworCisgICAgcGRldiA9IHBjaV9nZXRfcGRldihzZWcs
IGJ1cywgZGV2Zm4pOworCisgICAgaWYgKCAhcGRldiApCisgICAgICAgIHJj
ID0gLUVOT0RFVjsKKyAgICAvKgorICAgICAqIElmIHRoZSBkZXZpY2UgZXhp
c3RzIGFuZCBpdCBpcyBub3Qgb3duZWQgYnkgZWl0aGVyIHRoZSBoYXJkd2Fy
ZQorICAgICAqIGRvbWFpbiBvciBkb21faW8gdGhlbiBpdCBtdXN0IGJlIGFz
c2lnbmVkIHRvIGEgZ3Vlc3QsIG9yIGJlCisgICAgICogaGlkZGVuIChvd25l
ZCBieSBkb21feGVuKS4KKyAgICAgKi8KKyAgICBlbHNlIGlmICggcGRldi0+
ZG9tYWluICE9IGhhcmR3YXJlX2RvbWFpbiAmJgorICAgICAgICAgICAgICBw
ZGV2LT5kb21haW4gIT0gZG9tX2lvICkKKyAgICAgICAgcmMgPSAtRUJVU1k7
CisKICAgICBwY2lkZXZzX3VubG9jaygpOwogCi0gICAgcmV0dXJuIHBkZXYg
PyAwIDogLUVCVVNZOworICAgIHJldHVybiByYzsKIH0KIAogc3RhdGljIGlu
dCBhc3NpZ25fZGV2aWNlKHN0cnVjdCBkb21haW4gKmQsIHUxNiBzZWcsIHU4
IGJ1cywgdTggZGV2Zm4sIHUzMiBmbGFnKQpAQCAtMTQxNSw3ICsxNDI1LDgg
QEAgc3RhdGljIGludCBhc3NpZ25fZGV2aWNlKHN0cnVjdCBkb21haW4gKmQs
IHUxNiBzZWcsIHU4IGJ1cywgdTggZGV2Zm4sIHUzMiBmbGFnKQogCiAgICAg
LyogUHJldmVudCBkZXZpY2UgYXNzaWduIGlmIG1lbSBwYWdpbmcgb3IgbWVt
IHNoYXJpbmcgaGF2ZSBiZWVuIAogICAgICAqIGVuYWJsZWQgZm9yIHRoaXMg
ZG9tYWluICovCi0gICAgaWYgKCB1bmxpa2VseSghbmVlZF9pb21tdShkKSAm
JgorICAgIGlmICggZCAhPSBkb21faW8gJiYKKyAgICAgICAgIHVubGlrZWx5
KCFuZWVkX2lvbW11KGQpICYmCiAgICAgICAgICAgICAoKGlzX2h2bV9kb21h
aW4oZCkgJiYKICAgICAgICAgICAgICAgZC0+YXJjaC5odm1fZG9tYWluLm1l
bV9zaGFyaW5nX2VuYWJsZWQpIHx8CiAgICAgICAgICAgICAgdm1fZXZlbnRf
Y2hlY2tfcmluZyhkLT52bV9ldmVudF9wYWdpbmcpIHx8CkBAIC0xNDMyLDEy
ICsxNDQzLDIwIEBAIHN0YXRpYyBpbnQgYXNzaWduX2RldmljZShzdHJ1Y3Qg
ZG9tYWluICpkLCB1MTYgc2VnLCB1OCBidXMsIHU4IGRldmZuLCB1MzIgZmxh
ZykKICAgICAgICAgcmV0dXJuIHJjOwogICAgIH0KIAotICAgIHBkZXYgPSBw
Y2lfZ2V0X3BkZXZfYnlfZG9tYWluKGhhcmR3YXJlX2RvbWFpbiwgc2VnLCBi
dXMsIGRldmZuKTsKKyAgICBwZGV2ID0gcGNpX2dldF9wZGV2KHNlZywgYnVz
LCBkZXZmbik7CisKKyAgICByYyA9IC1FTk9ERVY7CiAgICAgaWYgKCAhcGRl
diApCi0gICAgewotICAgICAgICByYyA9IHBjaV9nZXRfcGRldihzZWcsIGJ1
cywgZGV2Zm4pID8gLUVCVVNZIDogLUVOT0RFVjsKICAgICAgICAgZ290byBk
b25lOwotICAgIH0KKworICAgIHJjID0gMDsKKyAgICBpZiAoIGQgPT0gcGRl
di0+ZG9tYWluICkKKyAgICAgICAgZ290byBkb25lOworCisgICAgcmMgPSAt
RUJVU1k7CisgICAgaWYgKCBwZGV2LT5kb21haW4gIT0gaGFyZHdhcmVfZG9t
YWluICYmCisgICAgICAgICBwZGV2LT5kb21haW4gIT0gZG9tX2lvICkKKyAg
ICAgICAgZ290byBkb25lOwogCiAgICAgaWYgKCBwZGV2LT5tc2l4ICkKICAg
ICAgICAgbXNpeHRibF9pbml0KGQpOwpAQCAtMTQ2MCw2ICsxNDc5LDEwIEBA
IHN0YXRpYyBpbnQgYXNzaWduX2RldmljZShzdHJ1Y3QgZG9tYWluICpkLCB1
MTYgc2VnLCB1OCBidXMsIHU4IGRldmZuLCB1MzIgZmxhZykKICAgICB9CiAK
ICBkb25lOgorICAgIC8qIFRoZSBkZXZpY2UgaXMgYXNzaWduZWQgdG8gZG9t
X2lvIHNvIG1hcmsgaXQgYXMgcXVhcmFudGluZWQgKi8KKyAgICBpZiAoICFy
YyAmJiBkID09IGRvbV9pbyApCisgICAgICAgIHBkZXYtPnF1YXJhbnRpbmUg
PSB0cnVlOworCiAgICAgaWYgKCAhaGFzX2FyY2hfcGRldnMoZCkgJiYgbmVl
ZF9pb21tdShkKSApCiAgICAgICAgIGlvbW11X3RlYXJkb3duKGQpOwogICAg
IHBjaWRldnNfdW5sb2NrKCk7CkBAIC0xNDcyLDYgKzE0OTUsNyBAQCBpbnQg
ZGVhc3NpZ25fZGV2aWNlKHN0cnVjdCBkb21haW4gKmQsIHUxNiBzZWcsIHU4
IGJ1cywgdTggZGV2Zm4pCiB7CiAgICAgY29uc3Qgc3RydWN0IGRvbWFpbl9p
b21tdSAqaGQgPSBkb21faW9tbXUoZCk7CiAgICAgc3RydWN0IHBjaV9kZXYg
KnBkZXYgPSBOVUxMOworICAgIHN0cnVjdCBkb21haW4gKnRhcmdldDsKICAg
ICBpbnQgcmV0ID0gMDsKIAogICAgIGlmICggIWlvbW11X2VuYWJsZWQgfHwg
IWhkLT5wbGF0Zm9ybV9vcHMgKQpAQCAtMTQ4MiwxMiArMTUwNiwxNiBAQCBp
bnQgZGVhc3NpZ25fZGV2aWNlKHN0cnVjdCBkb21haW4gKmQsIHUxNiBzZWcs
IHU4IGJ1cywgdTggZGV2Zm4pCiAgICAgaWYgKCAhcGRldiApCiAgICAgICAg
IHJldHVybiAtRU5PREVWOwogCisgICAgLyogRGUtYXNzaWdubWVudCBmcm9t
IGRvbV9pbyBzaG91bGQgZGUtcXVhcmFudGluZSB0aGUgZGV2aWNlICovCisg
ICAgdGFyZ2V0ID0gKHBkZXYtPnF1YXJhbnRpbmUgJiYgcGRldi0+ZG9tYWlu
ICE9IGRvbV9pbykgPworICAgICAgICBkb21faW8gOiBoYXJkd2FyZV9kb21h
aW47CisKICAgICB3aGlsZSAoIHBkZXYtPnBoYW50b21fc3RyaWRlICkKICAg
ICB7CiAgICAgICAgIGRldmZuICs9IHBkZXYtPnBoYW50b21fc3RyaWRlOwog
ICAgICAgICBpZiAoIFBDSV9TTE9UKGRldmZuKSAhPSBQQ0lfU0xPVChwZGV2
LT5kZXZmbikgKQogICAgICAgICAgICAgYnJlYWs7Ci0gICAgICAgIHJldCA9
IGhkLT5wbGF0Zm9ybV9vcHMtPnJlYXNzaWduX2RldmljZShkLCBoYXJkd2Fy
ZV9kb21haW4sIGRldmZuLAorICAgICAgICByZXQgPSBoZC0+cGxhdGZvcm1f
b3BzLT5yZWFzc2lnbl9kZXZpY2UoZCwgdGFyZ2V0LCBkZXZmbiwKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBj
aV90b19kZXYocGRldikpOwogICAgICAgICBpZiAoICFyZXQgKQogICAgICAg
ICAgICAgY29udGludWU7CkBAIC0xNDk4LDcgKzE1MjYsNyBAQCBpbnQgZGVh
c3NpZ25fZGV2aWNlKHN0cnVjdCBkb21haW4gKmQsIHUxNiBzZWcsIHU4IGJ1
cywgdTggZGV2Zm4pCiAgICAgfQogCiAgICAgZGV2Zm4gPSBwZGV2LT5kZXZm
bjsKLSAgICByZXQgPSBoZC0+cGxhdGZvcm1fb3BzLT5yZWFzc2lnbl9kZXZp
Y2UoZCwgaGFyZHdhcmVfZG9tYWluLCBkZXZmbiwKKyAgICByZXQgPSBoZC0+
cGxhdGZvcm1fb3BzLT5yZWFzc2lnbl9kZXZpY2UoZCwgdGFyZ2V0LCBkZXZm
biwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgcGNpX3RvX2RldihwZGV2KSk7CiAgICAgaWYgKCByZXQgKQogICAgIHsK
QEAgLTE1MDgsNiArMTUzNiw5IEBAIGludCBkZWFzc2lnbl9kZXZpY2Uoc3Ry
dWN0IGRvbWFpbiAqZCwgdTE2IHNlZywgdTggYnVzLCB1OCBkZXZmbikKICAg
ICAgICAgcmV0dXJuIHJldDsKICAgICB9CiAKKyAgICBpZiAoIHBkZXYtPmRv
bWFpbiA9PSBoYXJkd2FyZV9kb21haW4gICkKKyAgICAgICAgcGRldi0+cXVh
cmFudGluZSA9IGZhbHNlOworCiAgICAgcGRldi0+ZmF1bHQuY291bnQgPSAw
OwogCiAgICAgaWYgKCAhaGFzX2FyY2hfcGRldnMoZCkgJiYgbmVlZF9pb21t
dShkKSApCkBAIC0xNjg2LDcgKzE3MTcsNyBAQCBpbnQgaW9tbXVfZG9fcGNp
X2RvbWN0bCgKICAgICAgICAgICAgIHJldCA9IGh5cGVyY2FsbF9jcmVhdGVf
Y29udGludWF0aW9uKF9fSFlQRVJWSVNPUl9kb21jdGwsCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaCIsIHVf
ZG9tY3RsKTsKICAgICAgICAgZWxzZSBpZiAoIHJldCApCi0gICAgICAgICAg
ICBwcmludGsoWEVOTE9HX0dfRVJSICJYRU5fRE9NQ1RMX2Fzc2lnbl9kZXZp
Y2U6ICIKKyAgICAgICAgICAgIHByaW50ayhYRU5MT0dfR19FUlIKICAgICAg
ICAgICAgICAgICAgICAiYXNzaWduICUwNHg6JTAyeDolMDJ4LiV1IHRvIGRv
bSVkIGZhaWxlZCAoJWQpXG4iLAogICAgICAgICAgICAgICAgICAgIHNlZywg
YnVzLCBQQ0lfU0xPVChkZXZmbiksIFBDSV9GVU5DKGRldmZuKSwKICAgICAg
ICAgICAgICAgICAgICBkLT5kb21haW5faWQsIHJldCk7CmRpZmYgLS1naXQg
YS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC92dGQvaW9tbXUuYyBiL3hlbi9k
cml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9pb21tdS5jCmluZGV4IDRjNzE5ZDRl
ZTcuLjE5ZjdkMTMwMTMgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL3Bhc3N0
aHJvdWdoL3Z0ZC9pb21tdS5jCisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJv
dWdoL3Z0ZC9pb21tdS5jCkBAIC0xMzM4LDYgKzEzMzgsMTAgQEAgaW50IGRv
bWFpbl9jb250ZXh0X21hcHBpbmdfb25lKAogICAgIGludCBhZ2F3LCByYywg
cmV0OwogICAgIGJvb2xfdCBmbHVzaF9kZXZfaW90bGI7CiAKKyAgICAvKiBk
b21faW8gaXMgdXNlZCBhcyBhIHNlbnRpbmVsIGZvciBxdWFyYW50aW5lZCBk
ZXZpY2VzICovCisgICAgaWYgKCBkb21haW4gPT0gZG9tX2lvICkKKyAgICAg
ICAgcmV0dXJuIDA7CisKICAgICBBU1NFUlQocGNpZGV2c19sb2NrZWQoKSk7
CiAgICAgc3Bpbl9sb2NrKCZpb21tdS0+bG9jayk7CiAgICAgbWFkZHIgPSBi
dXNfdG9fY29udGV4dF9tYWRkcihpb21tdSwgYnVzKTsKQEAgLTE1NzMsNiAr
MTU3NywxMCBAQCBpbnQgZG9tYWluX2NvbnRleHRfdW5tYXBfb25lKAogICAg
IGludCBpb21tdV9kb21pZCwgcmMsIHJldDsKICAgICBib29sX3QgZmx1c2hf
ZGV2X2lvdGxiOwogCisgICAgLyogZG9tX2lvIGlzIHVzZWQgYXMgYSBzZW50
aW5lbCBmb3IgcXVhcmFudGluZWQgZGV2aWNlcyAqLworICAgIGlmICggZG9t
YWluID09IGRvbV9pbyApCisgICAgICAgIHJldHVybiAwOworCiAgICAgQVNT
RVJUKHBjaWRldnNfbG9ja2VkKCkpOwogICAgIHNwaW5fbG9jaygmaW9tbXUt
PmxvY2spOwogCkBAIC0xNzA1LDYgKzE3MTMsMTAgQEAgc3RhdGljIGludCBk
b21haW5fY29udGV4dF91bm1hcChzdHJ1Y3QgZG9tYWluICpkb21haW4sIHU4
IGRldmZuLAogICAgICAgICBnb3RvIG91dDsKICAgICB9CiAKKyAgICAvKiBk
b21faW8gaXMgdXNlZCBhcyBhIHNlbnRpbmVsIGZvciBxdWFyYW50aW5lZCBk
ZXZpY2VzICovCisgICAgaWYgKCBkb21haW4gPT0gZG9tX2lvICkKKyAgICAg
ICAgZ290byBvdXQ7CisKICAgICAvKgogICAgICAqIGlmIG5vIG90aGVyIGRl
dmljZXMgdW5kZXIgdGhlIHNhbWUgaW9tbXUgb3duZWQgYnkgdGhpcyBkb21h
aW4sCiAgICAgICogY2xlYXIgaW9tbXUgaW4gaW9tbXVfYml0bWFwIGFuZCBj
bGVhciBkb21haW5faWQgaW4gZG9taWRfYml0bXAKQEAgLTIzODksNiArMjQw
MSwxNSBAQCBzdGF0aWMgaW50IHJlYXNzaWduX2RldmljZV9vd25lcnNoaXAo
CiAgICAgaWYgKCByZXQgKQogICAgICAgICByZXR1cm4gcmV0OwogCisgICAg
aWYgKCBkZXZmbiA9PSBwZGV2LT5kZXZmbiApCisgICAgeworICAgICAgICBs
aXN0X21vdmUoJnBkZXYtPmRvbWFpbl9saXN0LCAmZG9tX2lvLT5hcmNoLnBk
ZXZfbGlzdCk7CisgICAgICAgIHBkZXYtPmRvbWFpbiA9IGRvbV9pbzsKKyAg
ICB9CisKKyAgICBpZiAoICFoYXNfYXJjaF9wZGV2cyhzb3VyY2UpICkKKyAg
ICAgICAgdm14X3BpX2hvb2tzX2RlYXNzaWduKHNvdXJjZSk7CisKICAgICBp
ZiAoICFoYXNfYXJjaF9wZGV2cyh0YXJnZXQpICkKICAgICAgICAgdm14X3Bp
X2hvb2tzX2Fzc2lnbih0YXJnZXQpOwogCkBAIC0yNDA3LDE1ICsyNDI4LDEz
IEBAIHN0YXRpYyBpbnQgcmVhc3NpZ25fZGV2aWNlX293bmVyc2hpcCgKICAg
ICAgICAgcGRldi0+ZG9tYWluID0gdGFyZ2V0OwogICAgIH0KIAotICAgIGlm
ICggIWhhc19hcmNoX3BkZXZzKHNvdXJjZSkgKQotICAgICAgICB2bXhfcGlf
aG9va3NfZGVhc3NpZ24oc291cmNlKTsKLQogICAgIHJldHVybiByZXQ7CiB9
CiAKIHN0YXRpYyBpbnQgaW50ZWxfaW9tbXVfYXNzaWduX2RldmljZSgKICAg
ICBzdHJ1Y3QgZG9tYWluICpkLCB1OCBkZXZmbiwgc3RydWN0IHBjaV9kZXYg
KnBkZXYsIHUzMiBmbGFnKQogeworICAgIHN0cnVjdCBkb21haW4gKnMgPSBw
ZGV2LT5kb21haW47CiAgICAgc3RydWN0IGFjcGlfcm1ycl91bml0ICpybXJy
OwogICAgIGludCByZXQgPSAwLCBpOwogICAgIHUxNiBiZGYsIHNlZzsKQEAg
LTI0NTgsOCArMjQ3Nyw4IEBAIHN0YXRpYyBpbnQgaW50ZWxfaW9tbXVfYXNz
aWduX2RldmljZSgKICAgICAgICAgfQogICAgIH0KIAotICAgIHJldCA9IHJl
YXNzaWduX2RldmljZV9vd25lcnNoaXAoaGFyZHdhcmVfZG9tYWluLCBkLCBk
ZXZmbiwgcGRldik7Ci0gICAgaWYgKCByZXQgKQorICAgIHJldCA9IHJlYXNz
aWduX2RldmljZV9vd25lcnNoaXAocywgZCwgZGV2Zm4sIHBkZXYpOworICAg
IGlmICggcmV0IHx8IGQgPT0gZG9tX2lvICkKICAgICAgICAgcmV0dXJuIHJl
dDsKIAogICAgIC8qIFNldHVwIHJtcnIgaWRlbnRpdHkgbWFwcGluZyAqLwpA
QCAtMjQ3MiwxMSArMjQ5MSwyMCBAQCBzdGF0aWMgaW50IGludGVsX2lvbW11
X2Fzc2lnbl9kZXZpY2UoCiAgICAgICAgICAgICByZXQgPSBybXJyX2lkZW50
aXR5X21hcHBpbmcoZCwgMSwgcm1yciwgZmxhZyk7CiAgICAgICAgICAgICBp
ZiAoIHJldCApCiAgICAgICAgICAgICB7Ci0gICAgICAgICAgICAgICAgcmVh
c3NpZ25fZGV2aWNlX293bmVyc2hpcChkLCBoYXJkd2FyZV9kb21haW4sIGRl
dmZuLCBwZGV2KTsKKyAgICAgICAgICAgICAgICBpbnQgcmM7CisKKyAgICAg
ICAgICAgICAgICByYyA9IHJlYXNzaWduX2RldmljZV9vd25lcnNoaXAoZCwg
cywgZGV2Zm4sIHBkZXYpOwogICAgICAgICAgICAgICAgIHByaW50ayhYRU5M
T0dfR19FUlIgVlREUFJFRklYCiAgICAgICAgICAgICAgICAgICAgICAgICIg
Y2Fubm90IG1hcCByZXNlcnZlZCByZWdpb24gKCUiUFJJeDY0IiwlIlBSSXg2
NCJdIGZvciBEb20lZCAoJWQpXG4iLAogICAgICAgICAgICAgICAgICAgICAg
ICBybXJyLT5iYXNlX2FkZHJlc3MsIHJtcnItPmVuZF9hZGRyZXNzLAogICAg
ICAgICAgICAgICAgICAgICAgICBkLT5kb21haW5faWQsIHJldCk7CisgICAg
ICAgICAgICAgICAgaWYgKCByYyApCisgICAgICAgICAgICAgICAgeworICAg
ICAgICAgICAgICAgICAgICBwcmludGsoWEVOTE9HX0VSUiBWVERQUkVGSVgK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICIgZmFpbGVkIHRvIHJlY2xh
aW0gJTA0eDolMDJ4OiUwMnguJXUgZnJvbSAlcGQgKCVkKVxuIiwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHNlZywgYnVzLCBQQ0lfU0xPVChkZXZm
biksIFBDSV9GVU5DKGRldmZuKSwgZCwgcmMpOworICAgICAgICAgICAgICAg
ICAgICBkb21haW5fY3Jhc2goZCk7CisgICAgICAgICAgICAgICAgfQogICAg
ICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgfQogICAgICAgICB9
CmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS94ZW4vcGNpLmggYi94ZW4vaW5j
bHVkZS94ZW4vcGNpLmgKaW5kZXggNGNmYTc3NDYxNS4uMDY2MzY0YmRlZiAx
MDA2NDQKLS0tIGEveGVuL2luY2x1ZGUveGVuL3BjaS5oCisrKyBiL3hlbi9p
bmNsdWRlL3hlbi9wY2kuaApAQCAtODgsNiArODgsOSBAQCBzdHJ1Y3QgcGNp
X2RldiB7CiAKICAgICBub2RlaWRfdCBub2RlOyAvKiBOVU1BIG5vZGUgKi8K
IAorICAgIC8qIERldmljZSB0byBiZSBxdWFyYW50aW5lZCwgZG9uJ3QgYXV0
b21hdGljYWxseSByZS1hc3NpZ24gdG8gZG9tMCAqLworICAgIGJvb2wgcXVh
cmFudGluZTsKKwogICAgIGVudW0gcGRldl90eXBlIHsKICAgICAgICAgREVW
X1RZUEVfUENJX1VOS05PV04sCiAgICAgICAgIERFVl9UWVBFX1BDSWVfRU5E
UE9JTlQsCi0tIAoyLjExLjAKCg==

--=separator
Content-Type: application/octet-stream;
 name="xsa302-4.12/0001-IOMMU-add-missing-HVM-check.patch"
Content-Disposition: attachment;
 filename="xsa302-4.12/0001-IOMMU-add-missing-HVM-check.patch"
Content-Transfer-Encoding: base64

RnJvbSAwYzljMGZiYjM1NmUzMjEwY2I3N2IzZDczOGJlNTA5ODFiMjYwNThh
IE1vbiBTZXAgMTcgMDA6MDA6MDAgMjAwMQpGcm9tOiBKYW4gQmV1bGljaCA8
amJldWxpY2hAc3VzZS5jb20+CkRhdGU6IFdlZCwgMiBPY3QgMjAxOSAxMzoz
Njo1OSArMDIwMApTdWJqZWN0OiBbUEFUQ0ggMS8yXSBJT01NVTogYWRkIG1p
c3NpbmcgSFZNIGNoZWNrCk1JTUUtVmVyc2lvbjogMS4wCkNvbnRlbnQtVHlw
ZTogdGV4dC9wbGFpbjsgY2hhcnNldD1VVEYtOApDb250ZW50LVRyYW5zZmVy
LUVuY29kaW5nOiA4Yml0CgpGaXggYW4gdW5ndWFyZGVkIGQtPmFyY2guaHZt
IGFjY2VzcyBpbiBhc3NpZ25fZGV2aWNlKCkuCgpTaWduZWQtb2ZmLWJ5OiBK
YW4gQmV1bGljaCA8amJldWxpY2hAc3VzZS5jb20+ClJldmlld2VkLWJ5OiBS
b2dlciBQYXUgTW9ubsOpIDxyb2dlci5wYXVAY2l0cml4LmNvbT4KQWNrZWQt
Ynk6IEFuZHJldyBDb29wZXIgPGFuZHJldy5jb29wZXIzQGNpdHJpeC5jb20+
CgooY2hlcnJ5IHBpY2tlZCBmcm9tIGNvbW1pdCA0MWZkMTAwOWNkNzQxNmI3
M2Q3NDVhNzdjMjRiNGU4ZDFhMjk2ZmU2KQpTaWduZWQtb2ZmLWJ5OiBJYW4g
SmFja3NvbiA8aWFuLmphY2tzb25AZXUuY2l0cml4LmNvbT4KLS0tCiB4ZW4v
ZHJpdmVycy9wYXNzdGhyb3VnaC9wY2kuYyB8IDMgKystCiAxIGZpbGUgY2hh
bmdlZCwgMiBpbnNlcnRpb25zKCspLCAxIGRlbGV0aW9uKC0pCgpkaWZmIC0t
Z2l0IGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvcGNpLmMgYi94ZW4vZHJp
dmVycy9wYXNzdGhyb3VnaC9wY2kuYwppbmRleCA4MTA4ZWQ1ZjlhLi5kNzQy
MGJkOGJmIDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9w
Y2kuYworKysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9wY2kuYwpAQCAt
MTQ1Miw3ICsxNDUyLDggQEAgc3RhdGljIGludCBhc3NpZ25fZGV2aWNlKHN0
cnVjdCBkb21haW4gKmQsIHUxNiBzZWcsIHU4IGJ1cywgdTggZGV2Zm4sIHUz
MiBmbGFnKQogCiAgICAgLyogUHJldmVudCBkZXZpY2UgYXNzaWduIGlmIG1l
bSBwYWdpbmcgb3IgbWVtIHNoYXJpbmcgaGF2ZSBiZWVuIAogICAgICAqIGVu
YWJsZWQgZm9yIHRoaXMgZG9tYWluICovCi0gICAgaWYgKCB1bmxpa2VseShk
LT5hcmNoLmh2bS5tZW1fc2hhcmluZ19lbmFibGVkIHx8CisgICAgaWYgKCB1
bmxpa2VseSgoaXNfaHZtX2RvbWFpbihkKSAmJgorICAgICAgICAgICAgICAg
ICAgIGQtPmFyY2guaHZtLm1lbV9zaGFyaW5nX2VuYWJsZWQpIHx8CiAgICAg
ICAgICAgICAgICAgICB2bV9ldmVudF9jaGVja19yaW5nKGQtPnZtX2V2ZW50
X3BhZ2luZykgfHwKICAgICAgICAgICAgICAgICAgIHAybV9nZXRfaG9zdHAy
bShkKS0+Z2xvYmFsX2xvZ2RpcnR5KSApCiAgICAgICAgIHJldHVybiAtRVhE
RVY7Ci0tIAoyLjExLjAKCg==

--=separator
Content-Type: application/octet-stream;
 name="xsa302-4.12/0002-passthrough-quarantine-PCI-devices.patch"
Content-Disposition: attachment;
 filename="xsa302-4.12/0002-passthrough-quarantine-PCI-devices.patch"
Content-Transfer-Encoding: base64

RnJvbSAyNzhkOGU1ODVhOWYxMTBhMWFmMGJkOTJhOWZjNDM3MzNjOWM3MjI3
IE1vbiBTZXAgMTcgMDA6MDA6MDAgMjAwMQpGcm9tOiBQYXVsIER1cnJhbnQg
PHBhdWwuZHVycmFudEBjaXRyaXguY29tPgpEYXRlOiBNb24sIDE0IE9jdCAy
MDE5IDE3OjUyOjU5ICswMTAwClN1YmplY3Q6IFtQQVRDSCAyLzJdIHBhc3N0
aHJvdWdoOiBxdWFyYW50aW5lIFBDSSBkZXZpY2VzCgpXaGVuIGEgUENJIGRl
dmljZSBpcyBhc3NpZ25lZCB0byBhbiB1bnRydXN0ZWQgZG9tYWluLCBpdCBp
cyBwb3NzaWJsZSBmb3IKdGhhdCBkb21haW4gdG8gcHJvZ3JhbSB0aGUgZGV2
aWNlIHRvIERNQSB0byBhbiBhcmJpdHJhcnkgYWRkcmVzcy4gVGhlCklPTU1V
IGlzIHVzZWQgdG8gcHJvdGVjdCB0aGUgaG9zdCBmcm9tIG1hbGljaW91cyBE
TUEgYnkgbWFraW5nIHN1cmUgdGhhdAp0aGUgZGV2aWNlIGFkZHJlc3NlcyBj
YW4gb25seSB0YXJnZXQgbWVtb3J5IGFzc2lnbmVkIHRvIHRoZSBndWVzdC4g
SG93ZXZlciwKd2hlbiB0aGUgZ3Vlc3QgZG9tYWluIGlzIHRvcm4gZG93biB0
aGUgZGV2aWNlIGlzIGFzc2lnbmVkIGJhY2sgdG8gZG9tMCwKdGh1cyBhbGxv
d2luZyBhbnkgaW4tZmxpZ2h0IERNQSB0byBwb3RlbnRpYWxseSB0YXJnZXQg
Y3JpdGljYWwgaG9zdCBkYXRhLgoKVGhpcyBwYXRjaCBpbnRyb2R1Y2VzIGEg
J3F1YXJhbnRpbmUnIGZvciBQQ0kgZGV2aWNlcyB1c2luZyBkb21faW8uIFdo
ZW4KdGhlIHRvb2xzdGFjayBtYWtlcyBhIGRldmljZSBhc3NpZ25hYmxlIChi
eSBiaW5kaW5nIGl0IHRvIHBjaWJhY2spLCBpdAp3aWxsIG5vdyBhbHNvIGFz
c2lnbiBpdCB0byBET01JRF9JTyBhbmQgdGhlIGRldmljZSB3aWxsIG9ubHkg
YmUgYXNzaWduZWQKYmFjayB0byBkb20wIHdoZW4gdGhlIGRldmljZSBpcyBt
YWRlIHVuYXNzaWduYWJsZSBhZ2Fpbi4gV2hpbHN0IGRldmljZSBpcwphc3Np
Z25hYmxlIGl0IHdpbGwgb25seSBldmVyIHRyYW5zZmVyIGJldHdlZW4gZG9t
X2lvIGFuZCBndWVzdCBkb21haW5zLgpkb21faW8gaXMgYWN0dWFsbHkgb25s
eSB1c2VkIGFzIGEgc2VudGluZWwgZG9tYWluIGZvciBxdWFyYW50aW5pbmcg
cHVycG9zZXM7Cml0IGlzIG5vdCBjb25maWd1cmVkIHdpdGggYW55IElPTU1V
IG1hcHBpbmdzLiBBc3NpZ25tZW50IHRvIGRvbV9pbyBzaW1wbHkKbWVhbnMg
dGhhdCB0aGUgZGV2aWNlJ3MgaW5pdGlhdG9yIChyZXF1ZXN0b3IpIGlkZW50
aWZpZXIgaXMgbm90IHByZXNlbnQgaW4KdGhlIElPTU1VJ3MgZGV2aWNlIHRh
YmxlIGFuZCB0aHVzIGFueSBETUEgdHJhbnNhY3Rpb25zIGlzc3VlZCB3aWxs
IGJlCnRlcm1pbmF0ZWQgd2l0aCBhIGZhdWx0IGNvbmRpdGlvbi4KCkluIGFk
ZGl0aW9uLCBhIGZpeCB0byBhc3NpZ25tZW50IGhhbmRsaW5nIGlzIG1hZGUg
Zm9yIFZULWQuICBGYWlsdXJlCmR1cmluZyB0aGUgYXNzaWdubWVudCBzdGVw
IHNob3VsZCBub3QgbGVhZCB0byBhIGRldmljZSBzdGlsbCBiZWluZwphc3Nv
Y2lhdGVkIHdpdGggaXRzIHByaW9yIG93bmVyLiBIYW5kIHRoZSBkZXZpY2Ug
dG8gRG9tSU8gdGVtcG9yYXJpbHksCnVudGlsIHRoZSBhc3NpZ25tZW50IHN0
ZXAgaGFzIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuICBSZW1vdmUgdGhlIFBJ
Cmhvb2tzIGZyb20gdGhlIHNvdXJjZSBkb21haW4gdGhlbiBlYXJsaWVyIGFz
IHdlbGwuCgpGYWlsdXJlIG9mIHRoZSByZWNvdmVyeSByZWFzc2lnbl9kZXZp
Y2Vfb3duZXJzaGlwKCkgbWF5IG5vdCBnbyBzaWxlbnQ6ClRoZXJlIGUuZy4g
bWF5IHN0aWxsIGJlIGxlZnQgb3ZlciBSTVJSIG1hcHBpbmdzIGluIHRoZSBk
b21haW4gYXNzaWdubWVudAp0byB3aGljaCBoYXMgZmFpbGVkLCBhbmQgaGVu
Y2Ugd2UgY2FuJ3QgYWxsb3cgdGhhdCBkb21haW4gdG8gY29udGludWUKZXhl
Y3V0aW5nLgoKTk9URTogVGhpcyBwYXRjaCBhbHNvIGluY2x1ZGVzIG9uZSBw
cmludGsoKSBjbGVhbnVwOyB0aGUKICAgICAgIlhFTl9ET01DVExfYXNzaWdu
X2RldmljZTogIiB0YWcgaXMgZHJvcHBlZCBpbiBpb21tdV9kb19wY2lfZG9t
Y3RsKCksCiAgICAgIHNpbmNlIHNpbWlsYXIgcHJpbnRrKCktcyBlbHNld2hl
cmUgYWxzbyBkb24ndCBsb2cgc3VjaCBhIHRhZy4KClRoaXMgaXMgWFNBLTMw
Mi4KClNpZ25lZC1vZmYtYnk6IFBhdWwgRHVycmFudCA8cGF1bC5kdXJyYW50
QGNpdHJpeC5jb20+ClNpZ25lZC1vZmYtYnk6IEphbiBCZXVsaWNoIDxqYmV1
bGljaEBzdXNlLmNvbT4KU2lnbmVkLW9mZi1ieTogSWFuIEphY2tzb24gPGlh
bi5qYWNrc29uQGV1LmNpdHJpeC5jb20+CihjaGVycnkgcGlja2VkIGZyb20g
Y29tbWl0IGVjOTk4NTdmNTlmN2YwNjIzNmYxMWNhOGIwYjIzMDNlNWU3NDVj
YzQpCi0tLQogdG9vbHMvbGlieGwvbGlieGxfcGNpLmMgICAgICAgICAgICAg
ICAgICAgICB8IDI1ICsrKysrKysrKysrLQogeGVuL2FyY2gveDg2L21tLmMg
ICAgICAgICAgICAgICAgICAgICAgICAgICB8ICAyICsKIHhlbi9jb21tb24v
ZG9tY3RsLmMgICAgICAgICAgICAgICAgICAgICAgICAgfCAxNCArKysrKyst
CiB4ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvcGNpX2FtZF9pb21tdS5j
IHwgMTAgKysrKy0KIHhlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2lvbW11LmMg
ICAgICAgICAgICAgfCAgOSArKysrKwogeGVuL2RyaXZlcnMvcGFzc3Rocm91
Z2gvcGNpLmMgICAgICAgICAgICAgICB8IDU5ICsrKysrKysrKysrKysrKysr
KysrKystLS0tLS0tCiB4ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC92dGQvaW9t
bXUuYyAgICAgICAgIHwgNDAgKysrKysrKysrKysrKysrKy0tLQogeGVuL2lu
Y2x1ZGUveGVuL3BjaS5oICAgICAgICAgICAgICAgICAgICAgICB8ICAzICsr
CiA4IGZpbGVzIGNoYW5nZWQsIDEzOCBpbnNlcnRpb25zKCspLCAyNCBkZWxl
dGlvbnMoLSkKCmRpZmYgLS1naXQgYS90b29scy9saWJ4bC9saWJ4bF9wY2ku
YyBiL3Rvb2xzL2xpYnhsL2xpYnhsX3BjaS5jCmluZGV4IDg4YzMyNGVhMjMu
LmQ2YTIzZmI1ZjggMTAwNjQ0Ci0tLSBhL3Rvb2xzL2xpYnhsL2xpYnhsX3Bj
aS5jCisrKyBiL3Rvb2xzL2xpYnhsL2xpYnhsX3BjaS5jCkBAIC03NTQsNiAr
NzU0LDcgQEAgc3RhdGljIGludCBsaWJ4bF9fZGV2aWNlX3BjaV9hc3NpZ25h
YmxlX2FkZChsaWJ4bF9fZ2MgKmdjLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBsaWJ4bF9kZXZpY2VfcGNpICpwY2lk
ZXYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGludCByZWJpbmQpCiB7CisgICAgbGlieGxfY3R4ICpjdHggPSBsaWJ4
bF9fZ2Nfb3duZXIoZ2MpOwogICAgIHVuc2lnbmVkIGRvbSwgYnVzLCBkZXYs
IGZ1bmM7CiAgICAgY2hhciAqc3BhdGgsICpkcml2ZXJfcGF0aCA9IE5VTEw7
CiAgICAgaW50IHJjOwpAQCAtNzc5LDcgKzc4MCw3IEBAIHN0YXRpYyBpbnQg
bGlieGxfX2RldmljZV9wY2lfYXNzaWduYWJsZV9hZGQobGlieGxfX2djICpn
YywKICAgICB9CiAgICAgaWYgKCByYyApIHsKICAgICAgICAgTE9HKFdBUk4s
IFBDSV9CREYiIGFscmVhZHkgYXNzaWduZWQgdG8gcGNpYmFjayIsIGRvbSwg
YnVzLCBkZXYsIGZ1bmMpOwotICAgICAgICByZXR1cm4gMDsKKyAgICAgICAg
Z290byBxdWFyYW50aW5lOwogICAgIH0KIAogICAgIC8qIENoZWNrIHRvIHNl
ZSBpZiB0aGVyZSdzIGFscmVhZHkgYSBkcml2ZXIgdGhhdCB3ZSBuZWVkIHRv
IHVuYmluZCBmcm9tICovCkBAIC04MTAsNiArODExLDE5IEBAIHN0YXRpYyBp
bnQgbGlieGxfX2RldmljZV9wY2lfYXNzaWduYWJsZV9hZGQobGlieGxfX2dj
ICpnYywKICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUw7CiAgICAgfQogCitx
dWFyYW50aW5lOgorICAgIC8qCisgICAgICogRE9NSURfSU8gaXMganVzdCBh
IHNlbnRpbmVsIGRvbWFpbiwgd2l0aG91dCBhbnkgYWN0dWFsIG1hcHBpbmdz
LAorICAgICAqIHNvIGFsd2F5cyBwYXNzIFhFTl9ET01DVExfREVWX1JETV9S
RUxBWEVEIHRvIGF2b2lkIGFzc2lnbm1lbnQgYmVpbmcKKyAgICAgKiB1bm5l
Y2Vzc2FyaWx5IGRlbmllZC4KKyAgICAgKi8KKyAgICByYyA9IHhjX2Fzc2ln
bl9kZXZpY2UoY3R4LT54Y2gsIERPTUlEX0lPLCBwY2lkZXZfZW5jb2RlX2Jk
ZihwY2lkZXYpLAorICAgICAgICAgICAgICAgICAgICAgICAgICBYRU5fRE9N
Q1RMX0RFVl9SRE1fUkVMQVhFRCk7CisgICAgaWYgKCByYyA8IDAgKSB7Cisg
ICAgICAgIExPRyhFUlJPUiwgImZhaWxlZCB0byBxdWFyYW50aW5lICJQQ0lf
QkRGLCBkb20sIGJ1cywgZGV2LCBmdW5jKTsKKyAgICAgICAgcmV0dXJuIEVS
Uk9SX0ZBSUw7CisgICAgfQorCiAgICAgcmV0dXJuIDA7CiB9CiAKQEAgLTgx
Nyw5ICs4MzEsMTggQEAgc3RhdGljIGludCBsaWJ4bF9fZGV2aWNlX3BjaV9h
c3NpZ25hYmxlX3JlbW92ZShsaWJ4bF9fZ2MgKmdjLAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ4bF9kZXZp
Y2VfcGNpICpwY2lkZXYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGludCByZWJpbmQpCiB7CisgICAgbGlieGxf
Y3R4ICpjdHggPSBsaWJ4bF9fZ2Nfb3duZXIoZ2MpOwogICAgIGludCByYzsK
ICAgICBjaGFyICpkcml2ZXJfcGF0aDsKIAorICAgIC8qIERlLXF1YXJhbnRp
bmUgKi8KKyAgICByYyA9IHhjX2RlYXNzaWduX2RldmljZShjdHgtPnhjaCwg
RE9NSURfSU8sIHBjaWRldl9lbmNvZGVfYmRmKHBjaWRldikpOworICAgIGlm
ICggcmMgPCAwICkgeworICAgICAgICBMT0coRVJST1IsICJmYWlsZWQgdG8g
ZGUtcXVhcmFudGluZSAiUENJX0JERiwgcGNpZGV2LT5kb21haW4sIHBjaWRl
di0+YnVzLAorICAgICAgICAgICAgcGNpZGV2LT5kZXYsIHBjaWRldi0+ZnVu
Yyk7CisgICAgICAgIHJldHVybiBFUlJPUl9GQUlMOworICAgIH0KKwogICAg
IC8qIFVuYmluZCBmcm9tIHBjaWJhY2sgKi8KICAgICBpZiAoIChyYz1wY2li
YWNrX2Rldl9pc19hc3NpZ25lZChnYywgcGNpZGV2KSkgPCAwICkgewogICAg
ICAgICByZXR1cm4gRVJST1JfRkFJTDsKZGlmZiAtLWdpdCBhL3hlbi9hcmNo
L3g4Ni9tbS5jIGIveGVuL2FyY2gveDg2L21tLmMKaW5kZXggMzU1N2NkMTE3
OC4uMTFkNzUzZDhkMiAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L21tLmMK
KysrIGIveGVuL2FyY2gveDg2L21tLmMKQEAgLTI5NSw5ICsyOTUsMTEgQEAg
dm9pZCBfX2luaXQgYXJjaF9pbml0X21lbW9yeSh2b2lkKQogICAgICAqIElu
aXRpYWxpc2Ugb3VyIERPTUlEX0lPIGRvbWFpbi4KICAgICAgKiBUaGlzIGRv
bWFpbiBvd25zIEkvTyBwYWdlcyB0aGF0IGFyZSB3aXRoaW4gdGhlIHJhbmdl
IG9mIHRoZSBwYWdlX2luZm8KICAgICAgKiBhcnJheS4gTWFwcGluZ3Mgb2Nj
dXIgYXQgdGhlIHByaXYgb2YgdGhlIGNhbGxlci4KKyAgICAgKiBRdWFyYW50
aW5lZCBQQ0kgZGV2aWNlcyB3aWxsIGJlIGFzc29jaWF0ZWQgd2l0aCB0aGlz
IGRvbWFpbi4KICAgICAgKi8KICAgICBkb21faW8gPSBkb21haW5fY3JlYXRl
KERPTUlEX0lPLCBOVUxMLCBmYWxzZSk7CiAgICAgQlVHX09OKElTX0VSUihk
b21faW8pKTsKKyAgICBJTklUX0xJU1RfSEVBRCgmZG9tX2lvLT5hcmNoLnBk
ZXZfbGlzdCk7CiAKICAgICAvKgogICAgICAqIEluaXRpYWxpc2Ugb3VyIENP
VyBkb21haW4uCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL2RvbWN0bC5jIGIv
eGVuL2NvbW1vbi9kb21jdGwuYwppbmRleCBkMDhiNjI3NGUyLi5lM2M0YmUy
YjQ4IDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL2RvbWN0bC5jCisrKyBiL3hl
bi9jb21tb24vZG9tY3RsLmMKQEAgLTM5MSw2ICszOTEsMTYgQEAgbG9uZyBk
b19kb21jdGwoWEVOX0dVRVNUX0hBTkRMRV9QQVJBTSh4ZW5fZG9tY3RsX3Qp
IHVfZG9tY3RsKQogCiAgICAgc3dpdGNoICggb3AtPmNtZCApCiAgICAgewor
ICAgIGNhc2UgWEVOX0RPTUNUTF9hc3NpZ25fZGV2aWNlOgorICAgIGNhc2Ug
WEVOX0RPTUNUTF9kZWFzc2lnbl9kZXZpY2U6CisgICAgICAgIGlmICggb3At
PmRvbWFpbiA9PSBET01JRF9JTyApCisgICAgICAgIHsKKyAgICAgICAgICAg
IGQgPSBkb21faW87CisgICAgICAgICAgICBicmVhazsKKyAgICAgICAgfQor
ICAgICAgICBlbHNlIGlmICggb3AtPmRvbWFpbiA9PSBET01JRF9JTlZBTElE
ICkKKyAgICAgICAgICAgIHJldHVybiAtRVNSQ0g7CisgICAgICAgIC8qIGZh
bGwgdGhyb3VnaCAqLwogICAgIGNhc2UgWEVOX0RPTUNUTF90ZXN0X2Fzc2ln
bl9kZXZpY2U6CiAgICAgICAgIGlmICggb3AtPmRvbWFpbiA9PSBET01JRF9J
TlZBTElEICkKICAgICAgICAgewpAQCAtNDEyLDcgKzQyMiw3IEBAIGxvbmcg
ZG9fZG9tY3RsKFhFTl9HVUVTVF9IQU5ETEVfUEFSQU0oeGVuX2RvbWN0bF90
KSB1X2RvbWN0bCkKIAogICAgIGlmICggIWRvbWN0bF9sb2NrX2FjcXVpcmUo
KSApCiAgICAgewotICAgICAgICBpZiAoIGQgKQorICAgICAgICBpZiAoIGQg
JiYgZCAhPSBkb21faW8gKQogICAgICAgICAgICAgcmN1X3VubG9ja19kb21h
aW4oZCk7CiAgICAgICAgIHJldHVybiBoeXBlcmNhbGxfY3JlYXRlX2NvbnRp
bnVhdGlvbigKICAgICAgICAgICAgIF9fSFlQRVJWSVNPUl9kb21jdGwsICJo
IiwgdV9kb21jdGwpOwpAQCAtMTA3NCw3ICsxMDg0LDcgQEAgbG9uZyBkb19k
b21jdGwoWEVOX0dVRVNUX0hBTkRMRV9QQVJBTSh4ZW5fZG9tY3RsX3QpIHVf
ZG9tY3RsKQogICAgIGRvbWN0bF9sb2NrX3JlbGVhc2UoKTsKIAogIGRvbWN0
bF9vdXRfdW5sb2NrX2RvbW9ubHk6Ci0gICAgaWYgKCBkICkKKyAgICBpZiAo
IGQgJiYgZCAhPSBkb21faW8gKQogICAgICAgICByY3VfdW5sb2NrX2RvbWFp
bihkKTsKIAogICAgIGlmICggY29weWJhY2sgJiYgX19jb3B5X3RvX2d1ZXN0
KHVfZG9tY3RsLCBvcCwgMSkgKQpkaWZmIC0tZ2l0IGEveGVuL2RyaXZlcnMv
cGFzc3Rocm91Z2gvYW1kL3BjaV9hbWRfaW9tbXUuYyBiL3hlbi9kcml2ZXJz
L3Bhc3N0aHJvdWdoL2FtZC9wY2lfYW1kX2lvbW11LmMKaW5kZXggMzNhMzc5
OGYzNi4uMTVjMTNlMTE2MyAxMDA2NDQKLS0tIGEveGVuL2RyaXZlcnMvcGFz
c3Rocm91Z2gvYW1kL3BjaV9hbWRfaW9tbXUuYworKysgYi94ZW4vZHJpdmVy
cy9wYXNzdGhyb3VnaC9hbWQvcGNpX2FtZF9pb21tdS5jCkBAIC0xMjAsNiAr
MTIwLDEwIEBAIHN0YXRpYyB2b2lkIGFtZF9pb21tdV9zZXR1cF9kb21haW5f
ZGV2aWNlKAogICAgIHU4IGJ1cyA9IHBkZXYtPmJ1czsKICAgICBjb25zdCBz
dHJ1Y3QgZG9tYWluX2lvbW11ICpoZCA9IGRvbV9pb21tdShkb21haW4pOwog
CisgICAgLyogZG9tX2lvIGlzIHVzZWQgYXMgYSBzZW50aW5lbCBmb3IgcXVh
cmFudGluZWQgZGV2aWNlcyAqLworICAgIGlmICggZG9tYWluID09IGRvbV9p
byApCisgICAgICAgIHJldHVybjsKKwogICAgIEJVR19PTiggIWhkLT5hcmNo
LnJvb3RfdGFibGUgfHwgIWhkLT5hcmNoLnBhZ2luZ19tb2RlIHx8CiAgICAg
ICAgICAgICAhaW9tbXUtPmRldl90YWJsZS5idWZmZXIgKTsKIApAQCAtMjc3
LDYgKzI4MSwxMCBAQCB2b2lkIGFtZF9pb21tdV9kaXNhYmxlX2RvbWFpbl9k
ZXZpY2Uoc3RydWN0IGRvbWFpbiAqZG9tYWluLAogICAgIGludCByZXFfaWQ7
CiAgICAgdTggYnVzID0gcGRldi0+YnVzOwogCisgICAgLyogZG9tX2lvIGlz
IHVzZWQgYXMgYSBzZW50aW5lbCBmb3IgcXVhcmFudGluZWQgZGV2aWNlcyAq
LworICAgIGlmICggZG9tYWluID09IGRvbV9pbyApCisgICAgICAgIHJldHVy
bjsKKwogICAgIEJVR19PTiAoIGlvbW11LT5kZXZfdGFibGUuYnVmZmVyID09
IE5VTEwgKTsKICAgICByZXFfaWQgPSBnZXRfZG1hX3JlcXVlc3Rvcl9pZChp
b21tdS0+c2VnLCBQQ0lfQkRGMihidXMsIGRldmZuKSk7CiAgICAgZHRlID0g
aW9tbXUtPmRldl90YWJsZS5idWZmZXIgKyAocmVxX2lkICogSU9NTVVfREVW
X1RBQkxFX0VOVFJZX1NJWkUpOwpAQCAtMzYzLDcgKzM3MSw3IEBAIHN0YXRp
YyBpbnQgYW1kX2lvbW11X2Fzc2lnbl9kZXZpY2Uoc3RydWN0IGRvbWFpbiAq
ZCwgdTggZGV2Zm4sCiAgICAgICAgICAgICBpdnJzX21hcHBpbmdzW3JlcV9p
ZF0ucmVhZF9wZXJtaXNzaW9uKTsKICAgICB9CiAKLSAgICByZXR1cm4gcmVh
c3NpZ25fZGV2aWNlKGhhcmR3YXJlX2RvbWFpbiwgZCwgZGV2Zm4sIHBkZXYp
OworICAgIHJldHVybiByZWFzc2lnbl9kZXZpY2UocGRldi0+ZG9tYWluLCBk
LCBkZXZmbiwgcGRldik7CiB9CiAKIHN0YXRpYyB2b2lkIGRlYWxsb2NhdGVf
bmV4dF9wYWdlX3RhYmxlKHN0cnVjdCBwYWdlX2luZm8gKnBnLCBpbnQgbGV2
ZWwpCmRpZmYgLS1naXQgYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9pb21t
dS5jIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvaW9tbXUuYwppbmRleCBh
NjY5N2Q1OGZiLi4yNzYyZTEzNDJmIDEwMDY0NAotLS0gYS94ZW4vZHJpdmVy
cy9wYXNzdGhyb3VnaC9pb21tdS5jCisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0
aHJvdWdoL2lvbW11LmMKQEAgLTIzMiw2ICsyMzIsOSBAQCB2b2lkIGlvbW11
X3RlYXJkb3duKHN0cnVjdCBkb21haW4gKmQpCiB7CiAgICAgc3RydWN0IGRv
bWFpbl9pb21tdSAqaGQgPSBkb21faW9tbXUoZCk7CiAKKyAgICBpZiAoIGQg
PT0gZG9tX2lvICkKKyAgICAgICAgcmV0dXJuOworCiAgICAgaGQtPnN0YXR1
cyA9IElPTU1VX1NUQVRVU19kaXNhYmxlZDsKICAgICBoZC0+cGxhdGZvcm1f
b3BzLT50ZWFyZG93bihkKTsKICAgICB0YXNrbGV0X3NjaGVkdWxlKCZpb21t
dV9wdF9jbGVhbnVwX3Rhc2tsZXQpOwpAQCAtMjQxLDYgKzI0NCw5IEBAIGlu
dCBpb21tdV9jb25zdHJ1Y3Qoc3RydWN0IGRvbWFpbiAqZCkKIHsKICAgICBz
dHJ1Y3QgZG9tYWluX2lvbW11ICpoZCA9IGRvbV9pb21tdShkKTsKIAorICAg
IGlmICggZCA9PSBkb21faW8gKQorICAgICAgICByZXR1cm4gMDsKKwogICAg
IGlmICggaGQtPnN0YXR1cyA9PSBJT01NVV9TVEFUVVNfaW5pdGlhbGl6ZWQg
KQogICAgICAgICByZXR1cm4gMDsKIApAQCAtNTIxLDYgKzUyNyw5IEBAIGlu
dCBfX2luaXQgaW9tbXVfc2V0dXAodm9pZCkKICAgICBwcmludGsoIkkvTyB2
aXJ0dWFsaXNhdGlvbiAlc2FibGVkXG4iLCBpb21tdV9lbmFibGVkID8gImVu
IiA6ICJkaXMiKTsKICAgICBpZiAoIGlvbW11X2VuYWJsZWQgKQogICAgIHsK
KyAgICAgICAgaWYgKCBpb21tdV9kb21haW5faW5pdChkb21faW8pICkKKyAg
ICAgICAgICAgIHBhbmljKCJDb3VsZCBub3Qgc2V0IHVwIHF1YXJhbnRpbmVc
biIpOworCiAgICAgICAgIHByaW50aygiIC0gRG9tMCBtb2RlOiAlc1xuIiwK
ICAgICAgICAgICAgICAgIGlvbW11X2h3ZG9tX3Bhc3N0aHJvdWdoID8gIlBh
c3N0aHJvdWdoIiA6CiAgICAgICAgICAgICAgICBpb21tdV9od2RvbV9zdHJp
Y3QgPyAiU3RyaWN0IiA6ICJSZWxheGVkIik7CmRpZmYgLS1naXQgYS94ZW4v
ZHJpdmVycy9wYXNzdGhyb3VnaC9wY2kuYyBiL3hlbi9kcml2ZXJzL3Bhc3N0
aHJvdWdoL3BjaS5jCmluZGV4IGQ3NDIwYmQ4YmYuLmQ2NmE4YTFkYWYgMTAw
NjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3BjaS5jCisrKyBi
L3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3BjaS5jCkBAIC0xNDI2LDE5ICsx
NDI2LDI5IEBAIHN0YXRpYyBpbnQgaW9tbXVfcmVtb3ZlX2RldmljZShzdHJ1
Y3QgcGNpX2RldiAqcGRldikKICAgICByZXR1cm4gaGQtPnBsYXRmb3JtX29w
cy0+cmVtb3ZlX2RldmljZShwZGV2LT5kZXZmbiwgcGNpX3RvX2RldihwZGV2
KSk7CiB9CiAKLS8qCi0gKiBJZiB0aGUgZGV2aWNlIGlzbid0IG93bmVkIGJ5
IHRoZSBoYXJkd2FyZSBkb21haW4sIGl0IG1lYW5zIGl0IGFscmVhZHkKLSAq
IGhhcyBiZWVuIGFzc2lnbmVkIHRvIG90aGVyIGRvbWFpbiwgb3IgaXQgZG9l
c24ndCBleGlzdC4KLSAqLwogc3RhdGljIGludCBkZXZpY2VfYXNzaWduZWQo
dTE2IHNlZywgdTggYnVzLCB1OCBkZXZmbikKIHsKICAgICBzdHJ1Y3QgcGNp
X2RldiAqcGRldjsKKyAgICBpbnQgcmMgPSAwOwogCiAgICAgcGNpZGV2c19s
b2NrKCk7Ci0gICAgcGRldiA9IHBjaV9nZXRfcGRldl9ieV9kb21haW4oaGFy
ZHdhcmVfZG9tYWluLCBzZWcsIGJ1cywgZGV2Zm4pOworCisgICAgcGRldiA9
IHBjaV9nZXRfcGRldihzZWcsIGJ1cywgZGV2Zm4pOworCisgICAgaWYgKCAh
cGRldiApCisgICAgICAgIHJjID0gLUVOT0RFVjsKKyAgICAvKgorICAgICAq
IElmIHRoZSBkZXZpY2UgZXhpc3RzIGFuZCBpdCBpcyBub3Qgb3duZWQgYnkg
ZWl0aGVyIHRoZSBoYXJkd2FyZQorICAgICAqIGRvbWFpbiBvciBkb21faW8g
dGhlbiBpdCBtdXN0IGJlIGFzc2lnbmVkIHRvIGEgZ3Vlc3QsIG9yIGJlCisg
ICAgICogaGlkZGVuIChvd25lZCBieSBkb21feGVuKS4KKyAgICAgKi8KKyAg
ICBlbHNlIGlmICggcGRldi0+ZG9tYWluICE9IGhhcmR3YXJlX2RvbWFpbiAm
JgorICAgICAgICAgICAgICBwZGV2LT5kb21haW4gIT0gZG9tX2lvICkKKyAg
ICAgICAgcmMgPSAtRUJVU1k7CisKICAgICBwY2lkZXZzX3VubG9jaygpOwog
Ci0gICAgcmV0dXJuIHBkZXYgPyAwIDogLUVCVVNZOworICAgIHJldHVybiBy
YzsKIH0KIAogc3RhdGljIGludCBhc3NpZ25fZGV2aWNlKHN0cnVjdCBkb21h
aW4gKmQsIHUxNiBzZWcsIHU4IGJ1cywgdTggZGV2Zm4sIHUzMiBmbGFnKQpA
QCAtMTQ1Miw3ICsxNDYyLDggQEAgc3RhdGljIGludCBhc3NpZ25fZGV2aWNl
KHN0cnVjdCBkb21haW4gKmQsIHUxNiBzZWcsIHU4IGJ1cywgdTggZGV2Zm4s
IHUzMiBmbGFnKQogCiAgICAgLyogUHJldmVudCBkZXZpY2UgYXNzaWduIGlm
IG1lbSBwYWdpbmcgb3IgbWVtIHNoYXJpbmcgaGF2ZSBiZWVuIAogICAgICAq
IGVuYWJsZWQgZm9yIHRoaXMgZG9tYWluICovCi0gICAgaWYgKCB1bmxpa2Vs
eSgoaXNfaHZtX2RvbWFpbihkKSAmJgorICAgIGlmICggZCAhPSBkb21faW8g
JiYKKyAgICAgICAgIHVubGlrZWx5KChpc19odm1fZG9tYWluKGQpICYmCiAg
ICAgICAgICAgICAgICAgICAgZC0+YXJjaC5odm0ubWVtX3NoYXJpbmdfZW5h
YmxlZCkgfHwKICAgICAgICAgICAgICAgICAgIHZtX2V2ZW50X2NoZWNrX3Jp
bmcoZC0+dm1fZXZlbnRfcGFnaW5nKSB8fAogICAgICAgICAgICAgICAgICAg
cDJtX2dldF9ob3N0cDJtKGQpLT5nbG9iYWxfbG9nZGlydHkpICkKQEAgLTE0
NjgsMTIgKzE0NzksMjAgQEAgc3RhdGljIGludCBhc3NpZ25fZGV2aWNlKHN0
cnVjdCBkb21haW4gKmQsIHUxNiBzZWcsIHU4IGJ1cywgdTggZGV2Zm4sIHUz
MiBmbGFnKQogICAgICAgICByZXR1cm4gcmM7CiAgICAgfQogCi0gICAgcGRl
diA9IHBjaV9nZXRfcGRldl9ieV9kb21haW4oaGFyZHdhcmVfZG9tYWluLCBz
ZWcsIGJ1cywgZGV2Zm4pOworICAgIHBkZXYgPSBwY2lfZ2V0X3BkZXYoc2Vn
LCBidXMsIGRldmZuKTsKKworICAgIHJjID0gLUVOT0RFVjsKICAgICBpZiAo
ICFwZGV2ICkKLSAgICB7Ci0gICAgICAgIHJjID0gcGNpX2dldF9wZGV2KHNl
ZywgYnVzLCBkZXZmbikgPyAtRUJVU1kgOiAtRU5PREVWOwogICAgICAgICBn
b3RvIGRvbmU7Ci0gICAgfQorCisgICAgcmMgPSAwOworICAgIGlmICggZCA9
PSBwZGV2LT5kb21haW4gKQorICAgICAgICBnb3RvIGRvbmU7CisKKyAgICBy
YyA9IC1FQlVTWTsKKyAgICBpZiAoIHBkZXYtPmRvbWFpbiAhPSBoYXJkd2Fy
ZV9kb21haW4gJiYKKyAgICAgICAgIHBkZXYtPmRvbWFpbiAhPSBkb21faW8g
KQorICAgICAgICBnb3RvIGRvbmU7CiAKICAgICBpZiAoIHBkZXYtPm1zaXgg
KQogICAgICAgICBtc2l4dGJsX2luaXQoZCk7CkBAIC0xNDk2LDYgKzE1MTUs
MTAgQEAgc3RhdGljIGludCBhc3NpZ25fZGV2aWNlKHN0cnVjdCBkb21haW4g
KmQsIHUxNiBzZWcsIHU4IGJ1cywgdTggZGV2Zm4sIHUzMiBmbGFnKQogICAg
IH0KIAogIGRvbmU6CisgICAgLyogVGhlIGRldmljZSBpcyBhc3NpZ25lZCB0
byBkb21faW8gc28gbWFyayBpdCBhcyBxdWFyYW50aW5lZCAqLworICAgIGlm
ICggIXJjICYmIGQgPT0gZG9tX2lvICkKKyAgICAgICAgcGRldi0+cXVhcmFu
dGluZSA9IHRydWU7CisKICAgICBpZiAoICFoYXNfYXJjaF9wZGV2cyhkKSAm
JiBoYXNfaW9tbXVfcHQoZCkgKQogICAgICAgICBpb21tdV90ZWFyZG93bihk
KTsKICAgICBwY2lkZXZzX3VubG9jaygpOwpAQCAtMTUwOCw2ICsxNTMxLDcg
QEAgaW50IGRlYXNzaWduX2RldmljZShzdHJ1Y3QgZG9tYWluICpkLCB1MTYg
c2VnLCB1OCBidXMsIHU4IGRldmZuKQogewogICAgIGNvbnN0IHN0cnVjdCBk
b21haW5faW9tbXUgKmhkID0gZG9tX2lvbW11KGQpOwogICAgIHN0cnVjdCBw
Y2lfZGV2ICpwZGV2ID0gTlVMTDsKKyAgICBzdHJ1Y3QgZG9tYWluICp0YXJn
ZXQ7CiAgICAgaW50IHJldCA9IDA7CiAKICAgICBpZiAoICFpb21tdV9lbmFi
bGVkIHx8ICFoZC0+cGxhdGZvcm1fb3BzICkKQEAgLTE1MTgsMTIgKzE1NDIs
MTYgQEAgaW50IGRlYXNzaWduX2RldmljZShzdHJ1Y3QgZG9tYWluICpkLCB1
MTYgc2VnLCB1OCBidXMsIHU4IGRldmZuKQogICAgIGlmICggIXBkZXYgKQog
ICAgICAgICByZXR1cm4gLUVOT0RFVjsKIAorICAgIC8qIERlLWFzc2lnbm1l
bnQgZnJvbSBkb21faW8gc2hvdWxkIGRlLXF1YXJhbnRpbmUgdGhlIGRldmlj
ZSAqLworICAgIHRhcmdldCA9IChwZGV2LT5xdWFyYW50aW5lICYmIHBkZXYt
PmRvbWFpbiAhPSBkb21faW8pID8KKyAgICAgICAgZG9tX2lvIDogaGFyZHdh
cmVfZG9tYWluOworCiAgICAgd2hpbGUgKCBwZGV2LT5waGFudG9tX3N0cmlk
ZSApCiAgICAgewogICAgICAgICBkZXZmbiArPSBwZGV2LT5waGFudG9tX3N0
cmlkZTsKICAgICAgICAgaWYgKCBQQ0lfU0xPVChkZXZmbikgIT0gUENJX1NM
T1QocGRldi0+ZGV2Zm4pICkKICAgICAgICAgICAgIGJyZWFrOwotICAgICAg
ICByZXQgPSBoZC0+cGxhdGZvcm1fb3BzLT5yZWFzc2lnbl9kZXZpY2UoZCwg
aGFyZHdhcmVfZG9tYWluLCBkZXZmbiwKKyAgICAgICAgcmV0ID0gaGQtPnBs
YXRmb3JtX29wcy0+cmVhc3NpZ25fZGV2aWNlKGQsIHRhcmdldCwgZGV2Zm4s
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBwY2lfdG9fZGV2KHBkZXYpKTsKICAgICAgICAgaWYgKCAhcmV0ICkK
ICAgICAgICAgICAgIGNvbnRpbnVlOwpAQCAtMTUzNCw3ICsxNTYyLDcgQEAg
aW50IGRlYXNzaWduX2RldmljZShzdHJ1Y3QgZG9tYWluICpkLCB1MTYgc2Vn
LCB1OCBidXMsIHU4IGRldmZuKQogICAgIH0KIAogICAgIGRldmZuID0gcGRl
di0+ZGV2Zm47Ci0gICAgcmV0ID0gaGQtPnBsYXRmb3JtX29wcy0+cmVhc3Np
Z25fZGV2aWNlKGQsIGhhcmR3YXJlX2RvbWFpbiwgZGV2Zm4sCisgICAgcmV0
ID0gaGQtPnBsYXRmb3JtX29wcy0+cmVhc3NpZ25fZGV2aWNlKGQsIHRhcmdl
dCwgZGV2Zm4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHBjaV90b19kZXYocGRldikpOwogICAgIGlmICggcmV0ICkK
ICAgICB7CkBAIC0xNTQ0LDYgKzE1NzIsOSBAQCBpbnQgZGVhc3NpZ25fZGV2
aWNlKHN0cnVjdCBkb21haW4gKmQsIHUxNiBzZWcsIHU4IGJ1cywgdTggZGV2
Zm4pCiAgICAgICAgIHJldHVybiByZXQ7CiAgICAgfQogCisgICAgaWYgKCBw
ZGV2LT5kb21haW4gPT0gaGFyZHdhcmVfZG9tYWluICApCisgICAgICAgIHBk
ZXYtPnF1YXJhbnRpbmUgPSBmYWxzZTsKKwogICAgIHBkZXYtPmZhdWx0LmNv
dW50ID0gMDsKIAogICAgIGlmICggIWhhc19hcmNoX3BkZXZzKGQpICYmIGhh
c19pb21tdV9wdChkKSApCkBAIC0xNzIyLDcgKzE3NTMsNyBAQCBpbnQgaW9t
bXVfZG9fcGNpX2RvbWN0bCgKICAgICAgICAgICAgIHJldCA9IGh5cGVyY2Fs
bF9jcmVhdGVfY29udGludWF0aW9uKF9fSFlQRVJWSVNPUl9kb21jdGwsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAiaCIsIHVfZG9tY3RsKTsKICAgICAgICAgZWxzZSBpZiAoIHJldCApCi0g
ICAgICAgICAgICBwcmludGsoWEVOTE9HX0dfRVJSICJYRU5fRE9NQ1RMX2Fz
c2lnbl9kZXZpY2U6ICIKKyAgICAgICAgICAgIHByaW50ayhYRU5MT0dfR19F
UlIKICAgICAgICAgICAgICAgICAgICAiYXNzaWduICUwNHg6JTAyeDolMDJ4
LiV1IHRvIGRvbSVkIGZhaWxlZCAoJWQpXG4iLAogICAgICAgICAgICAgICAg
ICAgIHNlZywgYnVzLCBQQ0lfU0xPVChkZXZmbiksIFBDSV9GVU5DKGRldmZu
KSwKICAgICAgICAgICAgICAgICAgICBkLT5kb21haW5faWQsIHJldCk7CmRp
ZmYgLS1naXQgYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC92dGQvaW9tbXUu
YyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9pb21tdS5jCmluZGV4
IDFkYjFjZDlmMmQuLmE4ZDFiYWEwNjQgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2
ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9pb21tdS5jCisrKyBiL3hlbi9kcml2ZXJz
L3Bhc3N0aHJvdWdoL3Z0ZC9pb21tdS5jCkBAIC0xMzM4LDYgKzEzMzgsMTAg
QEAgaW50IGRvbWFpbl9jb250ZXh0X21hcHBpbmdfb25lKAogICAgIGludCBh
Z2F3LCByYywgcmV0OwogICAgIGJvb2xfdCBmbHVzaF9kZXZfaW90bGI7CiAK
KyAgICAvKiBkb21faW8gaXMgdXNlZCBhcyBhIHNlbnRpbmVsIGZvciBxdWFy
YW50aW5lZCBkZXZpY2VzICovCisgICAgaWYgKCBkb21haW4gPT0gZG9tX2lv
ICkKKyAgICAgICAgcmV0dXJuIDA7CisKICAgICBBU1NFUlQocGNpZGV2c19s
b2NrZWQoKSk7CiAgICAgc3Bpbl9sb2NrKCZpb21tdS0+bG9jayk7CiAgICAg
bWFkZHIgPSBidXNfdG9fY29udGV4dF9tYWRkcihpb21tdSwgYnVzKTsKQEAg
LTE1NzMsNiArMTU3NywxMCBAQCBpbnQgZG9tYWluX2NvbnRleHRfdW5tYXBf
b25lKAogICAgIGludCBpb21tdV9kb21pZCwgcmMsIHJldDsKICAgICBib29s
X3QgZmx1c2hfZGV2X2lvdGxiOwogCisgICAgLyogZG9tX2lvIGlzIHVzZWQg
YXMgYSBzZW50aW5lbCBmb3IgcXVhcmFudGluZWQgZGV2aWNlcyAqLworICAg
IGlmICggZG9tYWluID09IGRvbV9pbyApCisgICAgICAgIHJldHVybiAwOwor
CiAgICAgQVNTRVJUKHBjaWRldnNfbG9ja2VkKCkpOwogICAgIHNwaW5fbG9j
aygmaW9tbXUtPmxvY2spOwogCkBAIC0xNzA1LDYgKzE3MTMsMTAgQEAgc3Rh
dGljIGludCBkb21haW5fY29udGV4dF91bm1hcChzdHJ1Y3QgZG9tYWluICpk
b21haW4sIHU4IGRldmZuLAogICAgICAgICBnb3RvIG91dDsKICAgICB9CiAK
KyAgICAvKiBkb21faW8gaXMgdXNlZCBhcyBhIHNlbnRpbmVsIGZvciBxdWFy
YW50aW5lZCBkZXZpY2VzICovCisgICAgaWYgKCBkb21haW4gPT0gZG9tX2lv
ICkKKyAgICAgICAgZ290byBvdXQ7CisKICAgICAvKgogICAgICAqIGlmIG5v
IG90aGVyIGRldmljZXMgdW5kZXIgdGhlIHNhbWUgaW9tbXUgb3duZWQgYnkg
dGhpcyBkb21haW4sCiAgICAgICogY2xlYXIgaW9tbXUgaW4gaW9tbXVfYml0
bWFwIGFuZCBjbGVhciBkb21haW5faWQgaW4gZG9taWRfYml0bXAKQEAgLTI0
NDEsNiArMjQ1MywxNSBAQCBzdGF0aWMgaW50IHJlYXNzaWduX2RldmljZV9v
d25lcnNoaXAoCiAgICAgaWYgKCByZXQgKQogICAgICAgICByZXR1cm4gcmV0
OwogCisgICAgaWYgKCBkZXZmbiA9PSBwZGV2LT5kZXZmbiApCisgICAgewor
ICAgICAgICBsaXN0X21vdmUoJnBkZXYtPmRvbWFpbl9saXN0LCAmZG9tX2lv
LT5hcmNoLnBkZXZfbGlzdCk7CisgICAgICAgIHBkZXYtPmRvbWFpbiA9IGRv
bV9pbzsKKyAgICB9CisKKyAgICBpZiAoICFoYXNfYXJjaF9wZGV2cyhzb3Vy
Y2UpICkKKyAgICAgICAgdm14X3BpX2hvb2tzX2RlYXNzaWduKHNvdXJjZSk7
CisKICAgICBpZiAoICFoYXNfYXJjaF9wZGV2cyh0YXJnZXQpICkKICAgICAg
ICAgdm14X3BpX2hvb2tzX2Fzc2lnbih0YXJnZXQpOwogCkBAIC0yNDU5LDE1
ICsyNDgwLDEzIEBAIHN0YXRpYyBpbnQgcmVhc3NpZ25fZGV2aWNlX293bmVy
c2hpcCgKICAgICAgICAgcGRldi0+ZG9tYWluID0gdGFyZ2V0OwogICAgIH0K
IAotICAgIGlmICggIWhhc19hcmNoX3BkZXZzKHNvdXJjZSkgKQotICAgICAg
ICB2bXhfcGlfaG9va3NfZGVhc3NpZ24oc291cmNlKTsKLQogICAgIHJldHVy
biByZXQ7CiB9CiAKIHN0YXRpYyBpbnQgaW50ZWxfaW9tbXVfYXNzaWduX2Rl
dmljZSgKICAgICBzdHJ1Y3QgZG9tYWluICpkLCB1OCBkZXZmbiwgc3RydWN0
IHBjaV9kZXYgKnBkZXYsIHUzMiBmbGFnKQogeworICAgIHN0cnVjdCBkb21h
aW4gKnMgPSBwZGV2LT5kb21haW47CiAgICAgc3RydWN0IGFjcGlfcm1ycl91
bml0ICpybXJyOwogICAgIGludCByZXQgPSAwLCBpOwogICAgIHUxNiBiZGYs
IHNlZzsKQEAgLTI1MTAsOCArMjUyOSw4IEBAIHN0YXRpYyBpbnQgaW50ZWxf
aW9tbXVfYXNzaWduX2RldmljZSgKICAgICAgICAgfQogICAgIH0KIAotICAg
IHJldCA9IHJlYXNzaWduX2RldmljZV9vd25lcnNoaXAoaGFyZHdhcmVfZG9t
YWluLCBkLCBkZXZmbiwgcGRldik7Ci0gICAgaWYgKCByZXQgKQorICAgIHJl
dCA9IHJlYXNzaWduX2RldmljZV9vd25lcnNoaXAocywgZCwgZGV2Zm4sIHBk
ZXYpOworICAgIGlmICggcmV0IHx8IGQgPT0gZG9tX2lvICkKICAgICAgICAg
cmV0dXJuIHJldDsKIAogICAgIC8qIFNldHVwIHJtcnIgaWRlbnRpdHkgbWFw
cGluZyAqLwpAQCAtMjUyNCwxMSArMjU0MywyMCBAQCBzdGF0aWMgaW50IGlu
dGVsX2lvbW11X2Fzc2lnbl9kZXZpY2UoCiAgICAgICAgICAgICByZXQgPSBy
bXJyX2lkZW50aXR5X21hcHBpbmcoZCwgMSwgcm1yciwgZmxhZyk7CiAgICAg
ICAgICAgICBpZiAoIHJldCApCiAgICAgICAgICAgICB7Ci0gICAgICAgICAg
ICAgICAgcmVhc3NpZ25fZGV2aWNlX293bmVyc2hpcChkLCBoYXJkd2FyZV9k
b21haW4sIGRldmZuLCBwZGV2KTsKKyAgICAgICAgICAgICAgICBpbnQgcmM7
CisKKyAgICAgICAgICAgICAgICByYyA9IHJlYXNzaWduX2RldmljZV9vd25l
cnNoaXAoZCwgcywgZGV2Zm4sIHBkZXYpOwogICAgICAgICAgICAgICAgIHBy
aW50ayhYRU5MT0dfR19FUlIgVlREUFJFRklYCiAgICAgICAgICAgICAgICAg
ICAgICAgICIgY2Fubm90IG1hcCByZXNlcnZlZCByZWdpb24gKCUiUFJJeDY0
IiwlIlBSSXg2NCJdIGZvciBEb20lZCAoJWQpXG4iLAogICAgICAgICAgICAg
ICAgICAgICAgICBybXJyLT5iYXNlX2FkZHJlc3MsIHJtcnItPmVuZF9hZGRy
ZXNzLAogICAgICAgICAgICAgICAgICAgICAgICBkLT5kb21haW5faWQsIHJl
dCk7CisgICAgICAgICAgICAgICAgaWYgKCByYyApCisgICAgICAgICAgICAg
ICAgeworICAgICAgICAgICAgICAgICAgICBwcmludGsoWEVOTE9HX0VSUiBW
VERQUkVGSVgKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICIgZmFpbGVk
IHRvIHJlY2xhaW0gJTA0eDolMDJ4OiUwMnguJXUgZnJvbSAlcGQgKCVkKVxu
IiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlZywgYnVzLCBQQ0lf
U0xPVChkZXZmbiksIFBDSV9GVU5DKGRldmZuKSwgZCwgcmMpOworICAgICAg
ICAgICAgICAgICAgICBkb21haW5fY3Jhc2goZCk7CisgICAgICAgICAgICAg
ICAgfQogICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgfQog
ICAgICAgICB9CmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS94ZW4vcGNpLmgg
Yi94ZW4vaW5jbHVkZS94ZW4vcGNpLmgKaW5kZXggOGIyMWU4ZGM4NC4uYTAz
MWZkNjAyMCAxMDA2NDQKLS0tIGEveGVuL2luY2x1ZGUveGVuL3BjaS5oCisr
KyBiL3hlbi9pbmNsdWRlL3hlbi9wY2kuaApAQCAtODgsNiArODgsOSBAQCBz
dHJ1Y3QgcGNpX2RldiB7CiAKICAgICBub2RlaWRfdCBub2RlOyAvKiBOVU1B
IG5vZGUgKi8KIAorICAgIC8qIERldmljZSB0byBiZSBxdWFyYW50aW5lZCwg
ZG9uJ3QgYXV0b21hdGljYWxseSByZS1hc3NpZ24gdG8gZG9tMCAqLworICAg
IGJvb2wgcXVhcmFudGluZTsKKwogICAgIC8qIERldmljZSB3aXRoIGVycmF0
YSwgaWdub3JlIHRoZSBCQVJzLiAqLwogICAgIGJvb2wgaWdub3JlX2JhcnM7
CiAKLS0gCjIuMTEuMAoK

--=separator
Content-Type: application/octet-stream;
 name="xsa302/0001-passthrough-quarantine-PCI-devices.patch"
Content-Disposition: attachment;
 filename="xsa302/0001-passthrough-quarantine-PCI-devices.patch"
Content-Transfer-Encoding: base64

RnJvbSA4YTlmZWM1M2YxNzQwMjJhZGM4OGYyNTM3MmM1N2IyZWI2M2ZhNTM4
IE1vbiBTZXAgMTcgMDA6MDA6MDAgMjAwMQpGcm9tOiBQYXVsIER1cnJhbnQg
PHBhdWxAeGVuLm9yZz4KRGF0ZTogRnJpLCAxOCBPY3QgMjAxOSAxNzo0MTo0
NCArMDEwMApTdWJqZWN0OiBbUEFUQ0hdIHBhc3N0aHJvdWdoOiBxdWFyYW50
aW5lIFBDSSBkZXZpY2VzCgpXaGVuIGEgUENJIGRldmljZSBpcyBhc3NpZ25l
ZCB0byBhbiB1bnRydXN0ZWQgZG9tYWluLCBpdCBpcyBwb3NzaWJsZSBmb3IK
dGhhdCBkb21haW4gdG8gcHJvZ3JhbSB0aGUgZGV2aWNlIHRvIERNQSB0byBh
biBhcmJpdHJhcnkgYWRkcmVzcy4gVGhlCklPTU1VIGlzIHVzZWQgdG8gcHJv
dGVjdCB0aGUgaG9zdCBmcm9tIG1hbGljaW91cyBETUEgYnkgbWFraW5nIHN1
cmUgdGhhdAp0aGUgZGV2aWNlIGFkZHJlc3NlcyBjYW4gb25seSB0YXJnZXQg
bWVtb3J5IGFzc2lnbmVkIHRvIHRoZSBndWVzdC4gSG93ZXZlciwKd2hlbiB0
aGUgZ3Vlc3QgZG9tYWluIGlzIHRvcm4gZG93biB0aGUgZGV2aWNlIGlzIGFz
c2lnbmVkIGJhY2sgdG8gZG9tMCwKdGh1cyBhbGxvd2luZyBhbnkgaW4tZmxp
Z2h0IERNQSB0byBwb3RlbnRpYWxseSB0YXJnZXQgY3JpdGljYWwgaG9zdCBk
YXRhLgoKVGhpcyBwYXRjaCBpbnRyb2R1Y2VzIGEgJ3F1YXJhbnRpbmUnIGZv
ciBQQ0kgZGV2aWNlcyB1c2luZyBkb21faW8uIFdoZW4KdGhlIHRvb2xzdGFj
ayBtYWtlcyBhIGRldmljZSBhc3NpZ25hYmxlIChieSBiaW5kaW5nIGl0IHRv
IHBjaWJhY2spLCBpdAp3aWxsIG5vdyBhbHNvIGFzc2lnbiBpdCB0byBET01J
RF9JTyBhbmQgdGhlIGRldmljZSB3aWxsIG9ubHkgYmUgYXNzaWduZWQKYmFj
ayB0byBkb20wIHdoZW4gdGhlIGRldmljZSBpcyBtYWRlIHVuYXNzaWduYWJs
ZSBhZ2Fpbi4gV2hpbHN0IGRldmljZSBpcwphc3NpZ25hYmxlIGl0IHdpbGwg
b25seSBldmVyIHRyYW5zZmVyIGJldHdlZW4gZG9tX2lvIGFuZCBndWVzdCBk
b21haW5zLgpkb21faW8gaXMgYWN0dWFsbHkgb25seSB1c2VkIGFzIGEgc2Vu
dGluZWwgZG9tYWluIGZvciBxdWFyYW50aW5pbmcgcHVycG9zZXM7Cml0IGlz
IG5vdCBjb25maWd1cmVkIHdpdGggYW55IElPTU1VIG1hcHBpbmdzLiBBc3Np
Z25tZW50IHRvIGRvbV9pbyBzaW1wbHkKbWVhbnMgdGhhdCB0aGUgZGV2aWNl
J3MgaW5pdGlhdG9yIChyZXF1ZXN0b3IpIGlkZW50aWZpZXIgaXMgbm90IHBy
ZXNlbnQgaW4KdGhlIElPTU1VJ3MgZGV2aWNlIHRhYmxlIGFuZCB0aHVzIGFu
eSBETUEgdHJhbnNhY3Rpb25zIGlzc3VlZCB3aWxsIGJlCnRlcm1pbmF0ZWQg
d2l0aCBhIGZhdWx0IGNvbmRpdGlvbi4KCkluIGFkZGl0aW9uLCBhIGZpeCB0
byBhc3NpZ25tZW50IGhhbmRsaW5nIGlzIG1hZGUgZm9yIFZULWQuICBGYWls
dXJlCmR1cmluZyB0aGUgYXNzaWdubWVudCBzdGVwIHNob3VsZCBub3QgbGVh
ZCB0byBhIGRldmljZSBzdGlsbCBiZWluZwphc3NvY2lhdGVkIHdpdGggaXRz
IHByaW9yIG93bmVyLiBIYW5kIHRoZSBkZXZpY2UgdG8gRG9tSU8gdGVtcG9y
YXJpbHksCnVudGlsIHRoZSBhc3NpZ25tZW50IHN0ZXAgaGFzIGNvbXBsZXRl
ZCBzdWNjZXNzZnVsbHkuICBSZW1vdmUgdGhlIFBJCmhvb2tzIGZyb20gdGhl
IHNvdXJjZSBkb21haW4gdGhlbiBlYXJsaWVyIGFzIHdlbGwuCgpGYWlsdXJl
IG9mIHRoZSByZWNvdmVyeSByZWFzc2lnbl9kZXZpY2Vfb3duZXJzaGlwKCkg
bWF5IG5vdCBnbyBzaWxlbnQ6ClRoZXJlIGUuZy4gbWF5IHN0aWxsIGJlIGxl
ZnQgb3ZlciBSTVJSIG1hcHBpbmdzIGluIHRoZSBkb21haW4gYXNzaWdubWVu
dAp0byB3aGljaCBoYXMgZmFpbGVkLCBhbmQgaGVuY2Ugd2UgY2FuJ3QgYWxs
b3cgdGhhdCBkb21haW4gdG8gY29udGludWUKZXhlY3V0aW5nLgoKTk9URTog
VGhpcyBwYXRjaCBhbHNvIGluY2x1ZGVzIG9uZSBwcmludGsoKSBjbGVhbnVw
OyB0aGUKICAgICAgIlhFTl9ET01DVExfYXNzaWduX2RldmljZTogIiB0YWcg
aXMgZHJvcHBlZCBpbiBpb21tdV9kb19wY2lfZG9tY3RsKCksCiAgICAgIHNp
bmNlIHNpbWlsYXIgcHJpbnRrKCktcyBlbHNld2hlcmUgYWxzbyBkb24ndCBs
b2cgc3VjaCBhIHRhZy4KClRoaXMgaXMgWFNBLTMwMi4KClNpZ25lZC1vZmYt
Ynk6IFBhdWwgRHVycmFudCA8cGF1bC5kdXJyYW50QGNpdHJpeC5jb20+ClNp
Z25lZC1vZmYtYnk6IEphbiBCZXVsaWNoIDxqYmV1bGljaEBzdXNlLmNvbT4K
U2lnbmVkLW9mZi1ieTogSWFuIEphY2tzb24gPGlhbi5qYWNrc29uQGV1LmNp
dHJpeC5jb20+Ci0tLQogdG9vbHMvbGlieGwvbGlieGxfcGNpLmMgICAgICAg
ICAgICAgICAgICAgICB8IDI1ICsrKysrKysrKysrLQogeGVuL2NvbW1vbi9k
b21haW4uYyAgICAgICAgICAgICAgICAgICAgICAgICB8ICAxICsKIHhlbi9j
b21tb24vZG9tY3RsLmMgICAgICAgICAgICAgICAgICAgICAgICAgfCAxNCAr
KysrKystCiB4ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvcGNpX2FtZF9p
b21tdS5jIHwgMTAgKysrKy0KIHhlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2lv
bW11LmMgICAgICAgICAgICAgfCAgNiArKy0KIHhlbi9kcml2ZXJzL3Bhc3N0
aHJvdWdoL3BjaS5jICAgICAgICAgICAgICAgfCA1OSArKysrKysrKysrKysr
KysrKysrKysrLS0tLS0tLQogeGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvdnRk
L2lvbW11LmMgICAgICAgICB8IDQwICsrKysrKysrKysrKysrKystLS0KIHhl
bi9pbmNsdWRlL3hlbi9wY2kuaCAgICAgICAgICAgICAgICAgICAgICAgfCAg
MyArKwogOCBmaWxlcyBjaGFuZ2VkLCAxMzMgaW5zZXJ0aW9ucygrKSwgMjUg
ZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGlieGxf
cGNpLmMgYi90b29scy9saWJ4bC9saWJ4bF9wY2kuYwppbmRleCBiNTQ0NGQx
NTUyLi4yY2NhYjAzM2I0IDEwMDY0NAotLS0gYS90b29scy9saWJ4bC9saWJ4
bF9wY2kuYworKysgYi90b29scy9saWJ4bC9saWJ4bF9wY2kuYwpAQCAtNzY2
LDYgKzc2Niw3IEBAIHN0YXRpYyBpbnQgbGlieGxfX2RldmljZV9wY2lfYXNz
aWduYWJsZV9hZGQobGlieGxfX2djICpnYywKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlieGxfZGV2aWNlX3BjaSAq
cGNpZGV2LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBpbnQgcmViaW5kKQogeworICAgIGxpYnhsX2N0eCAqY3R4ID0g
bGlieGxfX2djX293bmVyKGdjKTsKICAgICB1bnNpZ25lZCBkb20sIGJ1cywg
ZGV2LCBmdW5jOwogICAgIGNoYXIgKnNwYXRoLCAqZHJpdmVyX3BhdGggPSBO
VUxMOwogICAgIGludCByYzsKQEAgLTc5MSw3ICs3OTIsNyBAQCBzdGF0aWMg
aW50IGxpYnhsX19kZXZpY2VfcGNpX2Fzc2lnbmFibGVfYWRkKGxpYnhsX19n
YyAqZ2MsCiAgICAgfQogICAgIGlmICggcmMgKSB7CiAgICAgICAgIExPRyhX
QVJOLCBQQ0lfQkRGIiBhbHJlYWR5IGFzc2lnbmVkIHRvIHBjaWJhY2siLCBk
b20sIGJ1cywgZGV2LCBmdW5jKTsKLSAgICAgICAgcmV0dXJuIDA7CisgICAg
ICAgIGdvdG8gcXVhcmFudGluZTsKICAgICB9CiAKICAgICAvKiBDaGVjayB0
byBzZWUgaWYgdGhlcmUncyBhbHJlYWR5IGEgZHJpdmVyIHRoYXQgd2UgbmVl
ZCB0byB1bmJpbmQgZnJvbSAqLwpAQCAtODIyLDYgKzgyMywxOSBAQCBzdGF0
aWMgaW50IGxpYnhsX19kZXZpY2VfcGNpX2Fzc2lnbmFibGVfYWRkKGxpYnhs
X19nYyAqZ2MsCiAgICAgICAgIHJldHVybiBFUlJPUl9GQUlMOwogICAgIH0K
IAorcXVhcmFudGluZToKKyAgICAvKgorICAgICAqIERPTUlEX0lPIGlzIGp1
c3QgYSBzZW50aW5lbCBkb21haW4sIHdpdGhvdXQgYW55IGFjdHVhbCBtYXBw
aW5ncywKKyAgICAgKiBzbyBhbHdheXMgcGFzcyBYRU5fRE9NQ1RMX0RFVl9S
RE1fUkVMQVhFRCB0byBhdm9pZCBhc3NpZ25tZW50IGJlaW5nCisgICAgICog
dW5uZWNlc3NhcmlseSBkZW5pZWQuCisgICAgICovCisgICAgcmMgPSB4Y19h
c3NpZ25fZGV2aWNlKGN0eC0+eGNoLCBET01JRF9JTywgcGNpZGV2X2VuY29k
ZV9iZGYocGNpZGV2KSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgWEVO
X0RPTUNUTF9ERVZfUkRNX1JFTEFYRUQpOworICAgIGlmICggcmMgPCAwICkg
eworICAgICAgICBMT0coRVJST1IsICJmYWlsZWQgdG8gcXVhcmFudGluZSAi
UENJX0JERiwgZG9tLCBidXMsIGRldiwgZnVuYyk7CisgICAgICAgIHJldHVy
biBFUlJPUl9GQUlMOworICAgIH0KKwogICAgIHJldHVybiAwOwogfQogCkBA
IC04MjksOSArODQzLDE4IEBAIHN0YXRpYyBpbnQgbGlieGxfX2RldmljZV9w
Y2lfYXNzaWduYWJsZV9yZW1vdmUobGlieGxfX2djICpnYywKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlieGxf
ZGV2aWNlX3BjaSAqcGNpZGV2LAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBpbnQgcmViaW5kKQogeworICAgIGxp
YnhsX2N0eCAqY3R4ID0gbGlieGxfX2djX293bmVyKGdjKTsKICAgICBpbnQg
cmM7CiAgICAgY2hhciAqZHJpdmVyX3BhdGg7CiAKKyAgICAvKiBEZS1xdWFy
YW50aW5lICovCisgICAgcmMgPSB4Y19kZWFzc2lnbl9kZXZpY2UoY3R4LT54
Y2gsIERPTUlEX0lPLCBwY2lkZXZfZW5jb2RlX2JkZihwY2lkZXYpKTsKKyAg
ICBpZiAoIHJjIDwgMCApIHsKKyAgICAgICAgTE9HKEVSUk9SLCAiZmFpbGVk
IHRvIGRlLXF1YXJhbnRpbmUgIlBDSV9CREYsIHBjaWRldi0+ZG9tYWluLCBw
Y2lkZXYtPmJ1cywKKyAgICAgICAgICAgIHBjaWRldi0+ZGV2LCBwY2lkZXYt
PmZ1bmMpOworICAgICAgICByZXR1cm4gRVJST1JfRkFJTDsKKyAgICB9CisK
ICAgICAvKiBVbmJpbmQgZnJvbSBwY2liYWNrICovCiAgICAgaWYgKCAocmM9
cGNpYmFja19kZXZfaXNfYXNzaWduZWQoZ2MsIHBjaWRldikpIDwgMCApIHsK
ICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUw7CmRpZmYgLS1naXQgYS94ZW4v
Y29tbW9uL2RvbWFpbi5jIGIveGVuL2NvbW1vbi9kb21haW4uYwppbmRleCA5
YzczNjBlZDJhLi5mYzI0MjNhNWQyIDEwMDY0NAotLS0gYS94ZW4vY29tbW9u
L2RvbWFpbi5jCisrKyBiL3hlbi9jb21tb24vZG9tYWluLmMKQEAgLTU0OCw2
ICs1NDgsNyBAQCB2b2lkIF9faW5pdCBzZXR1cF9zeXN0ZW1fZG9tYWlucyh2
b2lkKQogICAgICAqIEluaXRpYWxpc2Ugb3VyIERPTUlEX0lPIGRvbWFpbi4K
ICAgICAgKiBUaGlzIGRvbWFpbiBvd25zIEkvTyBwYWdlcyB0aGF0IGFyZSB3
aXRoaW4gdGhlIHJhbmdlIG9mIHRoZSBwYWdlX2luZm8KICAgICAgKiBhcnJh
eS4gTWFwcGluZ3Mgb2NjdXIgYXQgdGhlIHByaXYgb2YgdGhlIGNhbGxlci4K
KyAgICAgKiBRdWFyYW50aW5lZCBQQ0kgZGV2aWNlcyB3aWxsIGJlIGFzc29j
aWF0ZWQgd2l0aCB0aGlzIGRvbWFpbi4KICAgICAgKi8KICAgICBkb21faW8g
PSBkb21haW5fY3JlYXRlKERPTUlEX0lPLCBOVUxMLCBmYWxzZSk7CiAgICAg
aWYgKCBJU19FUlIoZG9tX2lvKSApCmRpZmYgLS1naXQgYS94ZW4vY29tbW9u
L2RvbWN0bC5jIGIveGVuL2NvbW1vbi9kb21jdGwuYwppbmRleCBkNTk3YTA5
Zjk4Li4wM2QwMjI2MDM5IDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL2RvbWN0
bC5jCisrKyBiL3hlbi9jb21tb24vZG9tY3RsLmMKQEAgLTM4Myw2ICszODMs
MTYgQEAgbG9uZyBkb19kb21jdGwoWEVOX0dVRVNUX0hBTkRMRV9QQVJBTSh4
ZW5fZG9tY3RsX3QpIHVfZG9tY3RsKQogCiAgICAgc3dpdGNoICggb3AtPmNt
ZCApCiAgICAgeworICAgIGNhc2UgWEVOX0RPTUNUTF9hc3NpZ25fZGV2aWNl
OgorICAgIGNhc2UgWEVOX0RPTUNUTF9kZWFzc2lnbl9kZXZpY2U6CisgICAg
ICAgIGlmICggb3AtPmRvbWFpbiA9PSBET01JRF9JTyApCisgICAgICAgIHsK
KyAgICAgICAgICAgIGQgPSBkb21faW87CisgICAgICAgICAgICBicmVhazsK
KyAgICAgICAgfQorICAgICAgICBlbHNlIGlmICggb3AtPmRvbWFpbiA9PSBE
T01JRF9JTlZBTElEICkKKyAgICAgICAgICAgIHJldHVybiAtRVNSQ0g7Cisg
ICAgICAgIC8qIGZhbGwgdGhyb3VnaCAqLwogICAgIGNhc2UgWEVOX0RPTUNU
TF90ZXN0X2Fzc2lnbl9kZXZpY2U6CiAgICAgY2FzZSBYRU5fRE9NQ1RMX3Zt
X2V2ZW50X29wOgogICAgICAgICBpZiAoIG9wLT5kb21haW4gPT0gRE9NSURf
SU5WQUxJRCApCkBAIC00MDUsNyArNDE1LDcgQEAgbG9uZyBkb19kb21jdGwo
WEVOX0dVRVNUX0hBTkRMRV9QQVJBTSh4ZW5fZG9tY3RsX3QpIHVfZG9tY3Rs
KQogCiAgICAgaWYgKCAhZG9tY3RsX2xvY2tfYWNxdWlyZSgpICkKICAgICB7
Ci0gICAgICAgIGlmICggZCApCisgICAgICAgIGlmICggZCAmJiBkICE9IGRv
bV9pbyApCiAgICAgICAgICAgICByY3VfdW5sb2NrX2RvbWFpbihkKTsKICAg
ICAgICAgcmV0dXJuIGh5cGVyY2FsbF9jcmVhdGVfY29udGludWF0aW9uKAog
ICAgICAgICAgICAgX19IWVBFUlZJU09SX2RvbWN0bCwgImgiLCB1X2RvbWN0
bCk7CkBAIC0xMDY0LDcgKzEwNzQsNyBAQCBsb25nIGRvX2RvbWN0bChYRU5f
R1VFU1RfSEFORExFX1BBUkFNKHhlbl9kb21jdGxfdCkgdV9kb21jdGwpCiAg
ICAgZG9tY3RsX2xvY2tfcmVsZWFzZSgpOwogCiAgZG9tY3RsX291dF91bmxv
Y2tfZG9tb25seToKLSAgICBpZiAoIGQgKQorICAgIGlmICggZCAmJiBkICE9
IGRvbV9pbyApCiAgICAgICAgIHJjdV91bmxvY2tfZG9tYWluKGQpOwogCiAg
ICAgaWYgKCBjb3B5YmFjayAmJiBfX2NvcHlfdG9fZ3Vlc3QodV9kb21jdGws
IG9wLCAxKSApCmRpZmYgLS1naXQgYS94ZW4vZHJpdmVycy9wYXNzdGhyb3Vn
aC9hbWQvcGNpX2FtZF9pb21tdS5jIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91
Z2gvYW1kL3BjaV9hbWRfaW9tbXUuYwppbmRleCAwNTNlNzM1NWM0Li5iMjA0
NjI0NWQ3IDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9h
bWQvcGNpX2FtZF9pb21tdS5jCisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJv
dWdoL2FtZC9wY2lfYW1kX2lvbW11LmMKQEAgLTk1LDYgKzk1LDEwIEBAIHN0
YXRpYyB2b2lkIGFtZF9pb21tdV9zZXR1cF9kb21haW5fZGV2aWNlKAogICAg
IHU4IGJ1cyA9IHBkZXYtPmJ1czsKICAgICBjb25zdCBzdHJ1Y3QgZG9tYWlu
X2lvbW11ICpoZCA9IGRvbV9pb21tdShkb21haW4pOwogCisgICAgLyogZG9t
X2lvIGlzIHVzZWQgYXMgYSBzZW50aW5lbCBmb3IgcXVhcmFudGluZWQgZGV2
aWNlcyAqLworICAgIGlmICggZG9tYWluID09IGRvbV9pbyApCisgICAgICAg
IHJldHVybjsKKwogICAgIEJVR19PTiggIWhkLT5hcmNoLnJvb3RfdGFibGUg
fHwgIWhkLT5hcmNoLnBhZ2luZ19tb2RlIHx8CiAgICAgICAgICAgICAhaW9t
bXUtPmRldl90YWJsZS5idWZmZXIgKTsKIApAQCAtMjc2LDYgKzI4MCwxMCBA
QCBzdGF0aWMgdm9pZCBhbWRfaW9tbXVfZGlzYWJsZV9kb21haW5fZGV2aWNl
KGNvbnN0IHN0cnVjdCBkb21haW4gKmRvbWFpbiwKICAgICBpbnQgcmVxX2lk
OwogICAgIHU4IGJ1cyA9IHBkZXYtPmJ1czsKIAorICAgIC8qIGRvbV9pbyBp
cyB1c2VkIGFzIGEgc2VudGluZWwgZm9yIHF1YXJhbnRpbmVkIGRldmljZXMg
Ki8KKyAgICBpZiAoIGRvbWFpbiA9PSBkb21faW8gKQorICAgICAgICByZXR1
cm47CisKICAgICBCVUdfT04gKCBpb21tdS0+ZGV2X3RhYmxlLmJ1ZmZlciA9
PSBOVUxMICk7CiAgICAgcmVxX2lkID0gZ2V0X2RtYV9yZXF1ZXN0b3JfaWQo
aW9tbXUtPnNlZywgUENJX0JERjIoYnVzLCBkZXZmbikpOwogICAgIHRhYmxl
ID0gaW9tbXUtPmRldl90YWJsZS5idWZmZXI7CkBAIC0zNzMsNyArMzgxLDcg
QEAgc3RhdGljIGludCBhbWRfaW9tbXVfYXNzaWduX2RldmljZShzdHJ1Y3Qg
ZG9tYWluICpkLCB1OCBkZXZmbiwKICAgICAgICAgICAgIGl2cnNfbWFwcGlu
Z3NbcmVxX2lkXS5yZWFkX3Blcm1pc3Npb24pOwogICAgIH0KIAotICAgIHJl
dHVybiByZWFzc2lnbl9kZXZpY2UoaGFyZHdhcmVfZG9tYWluLCBkLCBkZXZm
biwgcGRldik7CisgICAgcmV0dXJuIHJlYXNzaWduX2RldmljZShwZGV2LT5k
b21haW4sIGQsIGRldmZuLCBwZGV2KTsKIH0KIAogc3RhdGljIHZvaWQgZGVh
bGxvY2F0ZV9uZXh0X3BhZ2VfdGFibGUoc3RydWN0IHBhZ2VfaW5mbyAqcGcs
IGludCBsZXZlbCkKZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJv
dWdoL2lvbW11LmMgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9pb21tdS5j
CmluZGV4IDllZjVmMzc2YzUuLjhjYmU5MDhmZmYgMTAwNjQ0Ci0tLSBhL3hl
bi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2lvbW11LmMKKysrIGIveGVuL2RyaXZl
cnMvcGFzc3Rocm91Z2gvaW9tbXUuYwpAQCAtMTgxLDcgKzE4MSw3IEBAIGlu
dCBpb21tdV9kb21haW5faW5pdChzdHJ1Y3QgZG9tYWluICpkLCB1bnNpZ25l
ZCBpbnQgb3B0cykKIAogICAgIGhkLT5wbGF0Zm9ybV9vcHMgPSBpb21tdV9n
ZXRfb3BzKCk7CiAgICAgcmV0ID0gaGQtPnBsYXRmb3JtX29wcy0+aW5pdChk
KTsKLSAgICBpZiAoIHJldCApCisgICAgaWYgKCByZXQgfHwgaXNfc3lzdGVt
X2RvbWFpbihkKSApCiAgICAgICAgIHJldHVybiByZXQ7CiAKICAgICBpZiAo
IGlzX2hhcmR3YXJlX2RvbWFpbihkKSApCkBAIC00NzMsNiArNDczLDEwIEBA
IGludCBfX2luaXQgaW9tbXVfc2V0dXAodm9pZCkKICAgICB9CiAgICAgZWxz
ZQogICAgIHsKKyAgICAgICAgZG9tX2lvLT5vcHRpb25zIHw9IFhFTl9ET01D
VExfQ0RGX2lvbW11OworICAgICAgICBpZiAoIGlvbW11X2RvbWFpbl9pbml0
KGRvbV9pbywgMCkgKQorICAgICAgICAgICAgcGFuaWMoIkNvdWxkIG5vdCBz
ZXQgdXAgcXVhcmFudGluZVxuIik7CisKICAgICAgICAgcHJpbnRrKCIgLSBE
b20wIG1vZGU6ICVzXG4iLAogICAgICAgICAgICAgICAgaW9tbXVfaHdkb21f
cGFzc3Rocm91Z2ggPyAiUGFzc3Rocm91Z2giIDoKICAgICAgICAgICAgICAg
IGlvbW11X2h3ZG9tX3N0cmljdCA/ICJTdHJpY3QiIDogIlJlbGF4ZWQiKTsK
ZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3BjaS5jIGIv
eGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvcGNpLmMKaW5kZXggYmRjYzQ4MmQ4
MS4uMThhN2RjNzIyNCAxMDA2NDQKLS0tIGEveGVuL2RyaXZlcnMvcGFzc3Ro
cm91Z2gvcGNpLmMKKysrIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvcGNp
LmMKQEAgLTkxMCw2ICs5MTAsNyBAQCBzdGF0aWMgaW50IGRlYXNzaWduX2Rl
dmljZShzdHJ1Y3QgZG9tYWluICpkLCB1aW50MTZfdCBzZWcsIHVpbnQ4X3Qg
YnVzLAogewogICAgIGNvbnN0IHN0cnVjdCBkb21haW5faW9tbXUgKmhkID0g
ZG9tX2lvbW11KGQpOwogICAgIHN0cnVjdCBwY2lfZGV2ICpwZGV2OworICAg
IHN0cnVjdCBkb21haW4gKnRhcmdldDsKICAgICBpbnQgcmV0ID0gMDsKIAog
ICAgIGlmICggIWlzX2lvbW11X2VuYWJsZWQoZCkgKQpAQCAtOTIwLDEyICs5
MjEsMTYgQEAgc3RhdGljIGludCBkZWFzc2lnbl9kZXZpY2Uoc3RydWN0IGRv
bWFpbiAqZCwgdWludDE2X3Qgc2VnLCB1aW50OF90IGJ1cywKICAgICBpZiAo
ICFwZGV2ICkKICAgICAgICAgcmV0dXJuIC1FTk9ERVY7CiAKKyAgICAvKiBE
ZS1hc3NpZ25tZW50IGZyb20gZG9tX2lvIHNob3VsZCBkZS1xdWFyYW50aW5l
IHRoZSBkZXZpY2UgKi8KKyAgICB0YXJnZXQgPSAocGRldi0+cXVhcmFudGlu
ZSAmJiBwZGV2LT5kb21haW4gIT0gZG9tX2lvKSA/CisgICAgICAgIGRvbV9p
byA6IGhhcmR3YXJlX2RvbWFpbjsKKwogICAgIHdoaWxlICggcGRldi0+cGhh
bnRvbV9zdHJpZGUgKQogICAgIHsKICAgICAgICAgZGV2Zm4gKz0gcGRldi0+
cGhhbnRvbV9zdHJpZGU7CiAgICAgICAgIGlmICggUENJX1NMT1QoZGV2Zm4p
ICE9IFBDSV9TTE9UKHBkZXYtPmRldmZuKSApCiAgICAgICAgICAgICBicmVh
azsKLSAgICAgICAgcmV0ID0gaGQtPnBsYXRmb3JtX29wcy0+cmVhc3NpZ25f
ZGV2aWNlKGQsIGhhcmR3YXJlX2RvbWFpbiwgZGV2Zm4sCisgICAgICAgIHJl
dCA9IGhkLT5wbGF0Zm9ybV9vcHMtPnJlYXNzaWduX2RldmljZShkLCB0YXJn
ZXQsIGRldmZuLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgcGNpX3RvX2RldihwZGV2KSk7CiAgICAgICAgIGlm
ICggIXJldCApCiAgICAgICAgICAgICBjb250aW51ZTsKQEAgLTkzNiw3ICs5
NDEsNyBAQCBzdGF0aWMgaW50IGRlYXNzaWduX2RldmljZShzdHJ1Y3QgZG9t
YWluICpkLCB1aW50MTZfdCBzZWcsIHVpbnQ4X3QgYnVzLAogICAgIH0KIAog
ICAgIGRldmZuID0gcGRldi0+ZGV2Zm47Ci0gICAgcmV0ID0gaGQtPnBsYXRm
b3JtX29wcy0+cmVhc3NpZ25fZGV2aWNlKGQsIGhhcmR3YXJlX2RvbWFpbiwg
ZGV2Zm4sCisgICAgcmV0ID0gaGQtPnBsYXRmb3JtX29wcy0+cmVhc3NpZ25f
ZGV2aWNlKGQsIHRhcmdldCwgZGV2Zm4sCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHBjaV90b19kZXYocGRldikpOwog
ICAgIGlmICggcmV0ICkKICAgICB7CkBAIC05NDYsNiArOTUxLDkgQEAgc3Rh
dGljIGludCBkZWFzc2lnbl9kZXZpY2Uoc3RydWN0IGRvbWFpbiAqZCwgdWlu
dDE2X3Qgc2VnLCB1aW50OF90IGJ1cywKICAgICAgICAgcmV0dXJuIHJldDsK
ICAgICB9CiAKKyAgICBpZiAoIHBkZXYtPmRvbWFpbiA9PSBoYXJkd2FyZV9k
b21haW4gICkKKyAgICAgICAgcGRldi0+cXVhcmFudGluZSA9IGZhbHNlOwor
CiAgICAgcGRldi0+ZmF1bHQuY291bnQgPSAwOwogCiAgICAgcmV0dXJuIHJl
dDsKQEAgLTE0NjIsMTkgKzE0NzAsMjkgQEAgc3RhdGljIGludCBpb21tdV9y
ZW1vdmVfZGV2aWNlKHN0cnVjdCBwY2lfZGV2ICpwZGV2KQogICAgIHJldHVy
biBoZC0+cGxhdGZvcm1fb3BzLT5yZW1vdmVfZGV2aWNlKHBkZXYtPmRldmZu
LCBwY2lfdG9fZGV2KHBkZXYpKTsKIH0KIAotLyoKLSAqIElmIHRoZSBkZXZp
Y2UgaXNuJ3Qgb3duZWQgYnkgdGhlIGhhcmR3YXJlIGRvbWFpbiwgaXQgbWVh
bnMgaXQgYWxyZWFkeQotICogaGFzIGJlZW4gYXNzaWduZWQgdG8gb3RoZXIg
ZG9tYWluLCBvciBpdCBkb2Vzbid0IGV4aXN0LgotICovCiBzdGF0aWMgaW50
IGRldmljZV9hc3NpZ25lZCh1MTYgc2VnLCB1OCBidXMsIHU4IGRldmZuKQog
ewogICAgIHN0cnVjdCBwY2lfZGV2ICpwZGV2OworICAgIGludCByYyA9IDA7
CiAKICAgICBwY2lkZXZzX2xvY2soKTsKLSAgICBwZGV2ID0gcGNpX2dldF9w
ZGV2X2J5X2RvbWFpbihoYXJkd2FyZV9kb21haW4sIHNlZywgYnVzLCBkZXZm
bik7CisKKyAgICBwZGV2ID0gcGNpX2dldF9wZGV2KHNlZywgYnVzLCBkZXZm
bik7CisKKyAgICBpZiAoICFwZGV2ICkKKyAgICAgICAgcmMgPSAtRU5PREVW
OworICAgIC8qCisgICAgICogSWYgdGhlIGRldmljZSBleGlzdHMgYW5kIGl0
IGlzIG5vdCBvd25lZCBieSBlaXRoZXIgdGhlIGhhcmR3YXJlCisgICAgICog
ZG9tYWluIG9yIGRvbV9pbyB0aGVuIGl0IG11c3QgYmUgYXNzaWduZWQgdG8g
YSBndWVzdCwgb3IgYmUKKyAgICAgKiBoaWRkZW4gKG93bmVkIGJ5IGRvbV94
ZW4pLgorICAgICAqLworICAgIGVsc2UgaWYgKCBwZGV2LT5kb21haW4gIT0g
aGFyZHdhcmVfZG9tYWluICYmCisgICAgICAgICAgICAgIHBkZXYtPmRvbWFp
biAhPSBkb21faW8gKQorICAgICAgICByYyA9IC1FQlVTWTsKKwogICAgIHBj
aWRldnNfdW5sb2NrKCk7CiAKLSAgICByZXR1cm4gcGRldiA/IDAgOiAtRUJV
U1k7CisgICAgcmV0dXJuIHJjOwogfQogCiBzdGF0aWMgaW50IGFzc2lnbl9k
ZXZpY2Uoc3RydWN0IGRvbWFpbiAqZCwgdTE2IHNlZywgdTggYnVzLCB1OCBk
ZXZmbiwgdTMyIGZsYWcpCkBAIC0xNDg4LDcgKzE1MDYsOCBAQCBzdGF0aWMg
aW50IGFzc2lnbl9kZXZpY2Uoc3RydWN0IGRvbWFpbiAqZCwgdTE2IHNlZywg
dTggYnVzLCB1OCBkZXZmbiwgdTMyIGZsYWcpCiAKICAgICAvKiBQcmV2ZW50
IGRldmljZSBhc3NpZ24gaWYgbWVtIHBhZ2luZyBvciBtZW0gc2hhcmluZyBo
YXZlIGJlZW4gCiAgICAgICogZW5hYmxlZCBmb3IgdGhpcyBkb21haW4gKi8K
LSAgICBpZiAoIHVubGlrZWx5KChpc19odm1fZG9tYWluKGQpICYmCisgICAg
aWYgKCBkICE9IGRvbV9pbyAmJgorICAgICAgICAgdW5saWtlbHkoKGlzX2h2
bV9kb21haW4oZCkgJiYKICAgICAgICAgICAgICAgICAgICBkLT5hcmNoLmh2
bS5tZW1fc2hhcmluZ19lbmFibGVkKSB8fAogICAgICAgICAgICAgICAgICAg
dm1fZXZlbnRfY2hlY2tfcmluZyhkLT52bV9ldmVudF9wYWdpbmcpIHx8CiAg
ICAgICAgICAgICAgICAgICBwMm1fZ2V0X2hvc3RwMm0oZCktPmdsb2JhbF9s
b2dkaXJ0eSkgKQpAQCAtMTQ5NywxMiArMTUxNiwyMCBAQCBzdGF0aWMgaW50
IGFzc2lnbl9kZXZpY2Uoc3RydWN0IGRvbWFpbiAqZCwgdTE2IHNlZywgdTgg
YnVzLCB1OCBkZXZmbiwgdTMyIGZsYWcpCiAgICAgaWYgKCAhcGNpZGV2c190
cnlsb2NrKCkgKQogICAgICAgICByZXR1cm4gLUVSRVNUQVJUOwogCi0gICAg
cGRldiA9IHBjaV9nZXRfcGRldl9ieV9kb21haW4oaGFyZHdhcmVfZG9tYWlu
LCBzZWcsIGJ1cywgZGV2Zm4pOworICAgIHBkZXYgPSBwY2lfZ2V0X3BkZXYo
c2VnLCBidXMsIGRldmZuKTsKKworICAgIHJjID0gLUVOT0RFVjsKICAgICBp
ZiAoICFwZGV2ICkKLSAgICB7Ci0gICAgICAgIHJjID0gcGNpX2dldF9wZGV2
KHNlZywgYnVzLCBkZXZmbikgPyAtRUJVU1kgOiAtRU5PREVWOwogICAgICAg
ICBnb3RvIGRvbmU7Ci0gICAgfQorCisgICAgcmMgPSAwOworICAgIGlmICgg
ZCA9PSBwZGV2LT5kb21haW4gKQorICAgICAgICBnb3RvIGRvbmU7CisKKyAg
ICByYyA9IC1FQlVTWTsKKyAgICBpZiAoIHBkZXYtPmRvbWFpbiAhPSBoYXJk
d2FyZV9kb21haW4gJiYKKyAgICAgICAgIHBkZXYtPmRvbWFpbiAhPSBkb21f
aW8gKQorICAgICAgICBnb3RvIGRvbmU7CiAKICAgICBpZiAoIHBkZXYtPm1z
aXggKQogICAgIHsKQEAgLTE1MzAsNiArMTU1NywxMCBAQCBzdGF0aWMgaW50
IGFzc2lnbl9kZXZpY2Uoc3RydWN0IGRvbWFpbiAqZCwgdTE2IHNlZywgdTgg
YnVzLCB1OCBkZXZmbiwgdTMyIGZsYWcpCiAgICAgfQogCiAgZG9uZToKKyAg
ICAvKiBUaGUgZGV2aWNlIGlzIGFzc2lnbmVkIHRvIGRvbV9pbyBzbyBtYXJr
IGl0IGFzIHF1YXJhbnRpbmVkICovCisgICAgaWYgKCAhcmMgJiYgZCA9PSBk
b21faW8gKQorICAgICAgICBwZGV2LT5xdWFyYW50aW5lID0gdHJ1ZTsKKwog
ICAgIHBjaWRldnNfdW5sb2NrKCk7CiAKICAgICByZXR1cm4gcmM7CkBAIC0x
NzA1LDcgKzE3MzYsNyBAQCBpbnQgaW9tbXVfZG9fcGNpX2RvbWN0bCgKICAg
ICAgICAgICAgIHJldCA9IGh5cGVyY2FsbF9jcmVhdGVfY29udGludWF0aW9u
KF9fSFlQRVJWSVNPUl9kb21jdGwsCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAiaCIsIHVfZG9tY3RsKTsKICAg
ICAgICAgZWxzZSBpZiAoIHJldCApCi0gICAgICAgICAgICBwcmludGsoWEVO
TE9HX0dfRVJSICJYRU5fRE9NQ1RMX2Fzc2lnbl9kZXZpY2U6ICIKKyAgICAg
ICAgICAgIHByaW50ayhYRU5MT0dfR19FUlIKICAgICAgICAgICAgICAgICAg
ICAiYXNzaWduICUwNHg6JTAyeDolMDJ4LiV1IHRvIGRvbSVkIGZhaWxlZCAo
JWQpXG4iLAogICAgICAgICAgICAgICAgICAgIHNlZywgYnVzLCBQQ0lfU0xP
VChkZXZmbiksIFBDSV9GVU5DKGRldmZuKSwKICAgICAgICAgICAgICAgICAg
ICBkLT5kb21haW5faWQsIHJldCk7CmRpZmYgLS1naXQgYS94ZW4vZHJpdmVy
cy9wYXNzdGhyb3VnaC92dGQvaW9tbXUuYyBiL3hlbi9kcml2ZXJzL3Bhc3N0
aHJvdWdoL3Z0ZC9pb21tdS5jCmluZGV4IGYwOGVlYzA3MGQuLjUzNDkzZWZj
Y2MgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9p
b21tdS5jCisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9pb21t
dS5jCkBAIC0xMjkwLDYgKzEyOTAsMTAgQEAgaW50IGRvbWFpbl9jb250ZXh0
X21hcHBpbmdfb25lKAogICAgIGludCBhZ2F3LCByYywgcmV0OwogICAgIGJv
b2xfdCBmbHVzaF9kZXZfaW90bGI7CiAKKyAgICAvKiBkb21faW8gaXMgdXNl
ZCBhcyBhIHNlbnRpbmVsIGZvciBxdWFyYW50aW5lZCBkZXZpY2VzICovCisg
ICAgaWYgKCBkb21haW4gPT0gZG9tX2lvICkKKyAgICAgICAgcmV0dXJuIDA7
CisKICAgICBBU1NFUlQocGNpZGV2c19sb2NrZWQoKSk7CiAgICAgc3Bpbl9s
b2NrKCZpb21tdS0+bG9jayk7CiAgICAgbWFkZHIgPSBidXNfdG9fY29udGV4
dF9tYWRkcihpb21tdSwgYnVzKTsKQEAgLTE1MzYsNiArMTU0MCwxMCBAQCBp
bnQgZG9tYWluX2NvbnRleHRfdW5tYXBfb25lKAogICAgIGludCBpb21tdV9k
b21pZCwgcmMsIHJldDsKICAgICBib29sX3QgZmx1c2hfZGV2X2lvdGxiOwog
CisgICAgLyogZG9tX2lvIGlzIHVzZWQgYXMgYSBzZW50aW5lbCBmb3IgcXVh
cmFudGluZWQgZGV2aWNlcyAqLworICAgIGlmICggZG9tYWluID09IGRvbV9p
byApCisgICAgICAgIHJldHVybiAwOworCiAgICAgQVNTRVJUKHBjaWRldnNf
bG9ja2VkKCkpOwogICAgIHNwaW5fbG9jaygmaW9tbXUtPmxvY2spOwogCkBA
IC0xNjY4LDYgKzE2NzYsMTAgQEAgc3RhdGljIGludCBkb21haW5fY29udGV4
dF91bm1hcChzdHJ1Y3QgZG9tYWluICpkb21haW4sIHU4IGRldmZuLAogICAg
ICAgICBnb3RvIG91dDsKICAgICB9CiAKKyAgICAvKiBkb21faW8gaXMgdXNl
ZCBhcyBhIHNlbnRpbmVsIGZvciBxdWFyYW50aW5lZCBkZXZpY2VzICovCisg
ICAgaWYgKCBkb21haW4gPT0gZG9tX2lvICkKKyAgICAgICAgZ290byBvdXQ7
CisKICAgICAvKgogICAgICAqIGlmIG5vIG90aGVyIGRldmljZXMgdW5kZXIg
dGhlIHNhbWUgaW9tbXUgb3duZWQgYnkgdGhpcyBkb21haW4sCiAgICAgICog
Y2xlYXIgaW9tbXUgaW4gaW9tbXVfYml0bWFwIGFuZCBjbGVhciBkb21haW5f
aWQgaW4gZG9taWRfYml0bXAKQEAgLTIzOTQsNiArMjQwNiwxNSBAQCBzdGF0
aWMgaW50IHJlYXNzaWduX2RldmljZV9vd25lcnNoaXAoCiAgICAgaWYgKCBy
ZXQgKQogICAgICAgICByZXR1cm4gcmV0OwogCisgICAgaWYgKCBkZXZmbiA9
PSBwZGV2LT5kZXZmbiApCisgICAgeworICAgICAgICBsaXN0X21vdmUoJnBk
ZXYtPmRvbWFpbl9saXN0LCAmZG9tX2lvLT5wZGV2X2xpc3QpOworICAgICAg
ICBwZGV2LT5kb21haW4gPSBkb21faW87CisgICAgfQorCisgICAgaWYgKCAh
aGFzX2FyY2hfcGRldnMoc291cmNlKSApCisgICAgICAgIHZteF9waV9ob29r
c19kZWFzc2lnbihzb3VyY2UpOworCiAgICAgaWYgKCAhaGFzX2FyY2hfcGRl
dnModGFyZ2V0KSApCiAgICAgICAgIHZteF9waV9ob29rc19hc3NpZ24odGFy
Z2V0KTsKIApAQCAtMjQxMiwxNSArMjQzMywxMyBAQCBzdGF0aWMgaW50IHJl
YXNzaWduX2RldmljZV9vd25lcnNoaXAoCiAgICAgICAgIHBkZXYtPmRvbWFp
biA9IHRhcmdldDsKICAgICB9CiAKLSAgICBpZiAoICFoYXNfYXJjaF9wZGV2
cyhzb3VyY2UpICkKLSAgICAgICAgdm14X3BpX2hvb2tzX2RlYXNzaWduKHNv
dXJjZSk7Ci0KICAgICByZXR1cm4gcmV0OwogfQogCiBzdGF0aWMgaW50IGlu
dGVsX2lvbW11X2Fzc2lnbl9kZXZpY2UoCiAgICAgc3RydWN0IGRvbWFpbiAq
ZCwgdTggZGV2Zm4sIHN0cnVjdCBwY2lfZGV2ICpwZGV2LCB1MzIgZmxhZykK
IHsKKyAgICBzdHJ1Y3QgZG9tYWluICpzID0gcGRldi0+ZG9tYWluOwogICAg
IHN0cnVjdCBhY3BpX3JtcnJfdW5pdCAqcm1ycjsKICAgICBpbnQgcmV0ID0g
MCwgaTsKICAgICB1MTYgYmRmLCBzZWc7CkBAIC0yNDYzLDggKzI0ODIsOCBA
QCBzdGF0aWMgaW50IGludGVsX2lvbW11X2Fzc2lnbl9kZXZpY2UoCiAgICAg
ICAgIH0KICAgICB9CiAKLSAgICByZXQgPSByZWFzc2lnbl9kZXZpY2Vfb3du
ZXJzaGlwKGhhcmR3YXJlX2RvbWFpbiwgZCwgZGV2Zm4sIHBkZXYpOwotICAg
IGlmICggcmV0ICkKKyAgICByZXQgPSByZWFzc2lnbl9kZXZpY2Vfb3duZXJz
aGlwKHMsIGQsIGRldmZuLCBwZGV2KTsKKyAgICBpZiAoIHJldCB8fCBkID09
IGRvbV9pbyApCiAgICAgICAgIHJldHVybiByZXQ7CiAKICAgICAvKiBTZXR1
cCBybXJyIGlkZW50aXR5IG1hcHBpbmcgKi8KQEAgLTI0NzcsMTEgKzI0OTYs
MjAgQEAgc3RhdGljIGludCBpbnRlbF9pb21tdV9hc3NpZ25fZGV2aWNlKAog
ICAgICAgICAgICAgcmV0ID0gcm1ycl9pZGVudGl0eV9tYXBwaW5nKGQsIDEs
IHJtcnIsIGZsYWcpOwogICAgICAgICAgICAgaWYgKCByZXQgKQogICAgICAg
ICAgICAgewotICAgICAgICAgICAgICAgIHJlYXNzaWduX2RldmljZV9vd25l
cnNoaXAoZCwgaGFyZHdhcmVfZG9tYWluLCBkZXZmbiwgcGRldik7CisgICAg
ICAgICAgICAgICAgaW50IHJjOworCisgICAgICAgICAgICAgICAgcmMgPSBy
ZWFzc2lnbl9kZXZpY2Vfb3duZXJzaGlwKGQsIHMsIGRldmZuLCBwZGV2KTsK
ICAgICAgICAgICAgICAgICBwcmludGsoWEVOTE9HX0dfRVJSIFZURFBSRUZJ
WAogICAgICAgICAgICAgICAgICAgICAgICAiIGNhbm5vdCBtYXAgcmVzZXJ2
ZWQgcmVnaW9uICglIlBSSXg2NCIsJSJQUkl4NjQiXSBmb3IgRG9tJWQgKCVk
KVxuIiwKICAgICAgICAgICAgICAgICAgICAgICAgcm1yci0+YmFzZV9hZGRy
ZXNzLCBybXJyLT5lbmRfYWRkcmVzcywKICAgICAgICAgICAgICAgICAgICAg
ICAgZC0+ZG9tYWluX2lkLCByZXQpOworICAgICAgICAgICAgICAgIGlmICgg
cmMgKQorICAgICAgICAgICAgICAgIHsKKyAgICAgICAgICAgICAgICAgICAg
cHJpbnRrKFhFTkxPR19FUlIgVlREUFJFRklYCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAiIGZhaWxlZCB0byByZWNsYWltICUwNHg6JTAyeDolMDJ4
LiV1IGZyb20gJXBkICglZClcbiIsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICBzZWcsIGJ1cywgUENJX1NMT1QoZGV2Zm4pLCBQQ0lfRlVOQyhkZXZm
biksIGQsIHJjKTsKKyAgICAgICAgICAgICAgICAgICAgZG9tYWluX2NyYXNo
KGQpOworICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICBicmVh
azsKICAgICAgICAgICAgIH0KICAgICAgICAgfQpkaWZmIC0tZ2l0IGEveGVu
L2luY2x1ZGUveGVuL3BjaS5oIGIveGVuL2luY2x1ZGUveGVuL3BjaS5oCmlu
ZGV4IDM5M2NiNDVkZTMuLjJiYzRhYWY0NTMgMTAwNjQ0Ci0tLSBhL3hlbi9p
bmNsdWRlL3hlbi9wY2kuaAorKysgYi94ZW4vaW5jbHVkZS94ZW4vcGNpLmgK
QEAgLTk5LDYgKzk5LDkgQEAgc3RydWN0IHBjaV9kZXYgewogCiAgICAgbm9k
ZWlkX3Qgbm9kZTsgLyogTlVNQSBub2RlICovCiAKKyAgICAvKiBEZXZpY2Ug
dG8gYmUgcXVhcmFudGluZWQsIGRvbid0IGF1dG9tYXRpY2FsbHkgcmUtYXNz
aWduIHRvIGRvbTAgKi8KKyAgICBib29sIHF1YXJhbnRpbmU7CisKICAgICAv
KiBEZXZpY2Ugd2l0aCBlcnJhdGEsIGlnbm9yZSB0aGUgQkFScy4gKi8KICAg
ICBib29sIGlnbm9yZV9iYXJzOwogCi0tIAoyLjExLjAKCg==

--=separator
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: base64
Content-Disposition: inline

X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVs
IG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0
cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

--=separator--


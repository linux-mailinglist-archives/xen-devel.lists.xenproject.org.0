Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 1874CE3185
	for <lists+xen-devel@lfdr.de>; Thu, 24 Oct 2019 13:53:13 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iNbeA-0002qt-EA; Thu, 24 Oct 2019 11:51:18 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=hYBa=YR=oracle.com=daniel.kiper@srs-us1.protection.inumbo.net>)
 id 1iNbe9-0002qm-N7
 for xen-devel@lists.xenproject.org; Thu, 24 Oct 2019 11:51:17 +0000
X-Inumbo-ID: 95227830-f654-11e9-949e-12813bfff9fa
Received: from aserp2120.oracle.com (unknown [141.146.126.78])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 95227830-f654-11e9-949e-12813bfff9fa;
 Thu, 24 Oct 2019 11:51:15 +0000 (UTC)
Received: from pps.filterd (aserp2120.oracle.com [127.0.0.1])
 by aserp2120.oracle.com (8.16.0.27/8.16.0.27) with SMTP id x9OBdJG0027398;
 Thu, 24 Oct 2019 11:48:52 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=oracle.com;
 h=from : to : cc :
 subject : date : message-id : in-reply-to : references; s=corp-2019-08-05;
 bh=LUzRexjL28yJiqsxlCEDrO6ZjBR5UcznsiT108Fhh90=;
 b=c5LL9ICuhAvct5zCXTyJVAtUedOprRdHfzs7b9FO0qi9KYEgislnjRhBKw3kCuAKfbBy
 hLa167hW8lhJDP/FM04kaq5BvanyzB/dHCtee8PxjoqjnxPUgyylwuhy+AhO85s6ySnA
 2Tkoi6hFc8h4P4vUY9FGbFylgBMyv7CQxwBk/Rdu6L+KiWWhXYZJWymRoxA2nwado/Us
 z/api8S63nY9yFE63KEzXLCeebCrjgXlr2KF+ayZyS1txfuOJME47EbJ/WAJuZu8RLey
 ll9ya1muIMGj4J7gNEVdXBn+TeQ+cRHaDswL0dGMd7OoylthlyKzs/FinQAhKVJb1OSv XA== 
Received: from userp3020.oracle.com (userp3020.oracle.com [156.151.31.79])
 by aserp2120.oracle.com with ESMTP id 2vqteq323y-1
 (version=TLSv1.2 cipher=ECDHE-RSA-AES256-GCM-SHA384 bits=256 verify=OK);
 Thu, 24 Oct 2019 11:48:52 +0000
Received: from pps.filterd (userp3020.oracle.com [127.0.0.1])
 by userp3020.oracle.com (8.16.0.27/8.16.0.27) with SMTP id x9OBeF8v147903;
 Thu, 24 Oct 2019 11:48:51 GMT
Received: from userv0122.oracle.com (userv0122.oracle.com [156.151.31.75])
 by userp3020.oracle.com with ESMTP id 2vtsk4kdru-1
 (version=TLSv1.2 cipher=ECDHE-RSA-AES256-GCM-SHA384 bits=256 verify=OK);
 Thu, 24 Oct 2019 11:48:51 +0000
Received: from abhmp0008.oracle.com (abhmp0008.oracle.com [141.146.116.14])
 by userv0122.oracle.com (8.14.4/8.14.4) with ESMTP id x9OBmoqV017116;
 Thu, 24 Oct 2019 11:48:50 GMT
Received: from tomti.i.net-space.pl (/10.175.165.209)
 by default (Oracle Beehive Gateway v4.0)
 with ESMTP ; Thu, 24 Oct 2019 04:48:49 -0700
From: Daniel Kiper <daniel.kiper@oracle.com>
To: linux-efi@vger.kernel.org, linux-kernel@vger.kernel.org, x86@kernel.org,
 xen-devel@lists.xenproject.org
Date: Thu, 24 Oct 2019 13:48:14 +0200
Message-Id: <20191024114814.6488-4-daniel.kiper@oracle.com>
X-Mailer: git-send-email 2.11.0
In-Reply-To: <20191024114814.6488-1-daniel.kiper@oracle.com>
References: <20191024114814.6488-1-daniel.kiper@oracle.com>
X-Proofpoint-Virus-Version: vendor=nai engine=6000 definitions=9419
 signatures=668684
X-Proofpoint-Spam-Details: rule=notspam policy=default score=0 suspectscore=0
 malwarescore=0
 phishscore=0 bulkscore=0 spamscore=0 mlxscore=0 mlxlogscore=999
 adultscore=0 classifier=spam adjust=0 reason=mlx scancount=1
 engine=8.0.1-1908290000 definitions=main-1910240116
X-Proofpoint-Virus-Version: vendor=nai engine=6000 definitions=9419
 signatures=668684
X-Proofpoint-Spam-Details: rule=notspam policy=default score=0
 priorityscore=1501 malwarescore=0
 suspectscore=0 phishscore=0 bulkscore=0 spamscore=0 clxscore=1015
 lowpriorityscore=0 mlxscore=0 impostorscore=0 mlxlogscore=999 adultscore=0
 classifier=spam adjust=0 reason=mlx scancount=1 engine=8.0.1-1908290000
 definitions=main-1910240116
Subject: [Xen-devel] [PATCH v4 3/3] x86/boot: Introduce the setup_indirect
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: jgross@suse.com, eric.snowberg@oracle.com, ard.biesheuvel@linaro.org,
 konrad.wilk@oracle.com, corbet@lwn.net, peterz@infradead.org,
 ross.philipson@oracle.com, dave.hansen@linux.intel.com, mingo@redhat.com,
 bp@alien8.de, rdunlap@infradead.org, luto@kernel.org, hpa@zytor.com,
 kanth.ghatraju@oracle.com, boris.ostrovsky@oracle.com, tglx@linutronix.de
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhlIHNldHVwX2RhdGEgaXMgYSBiaXQgYXdrd2FyZCB0byB1c2UgZm9yIGV4dHJlbWVseSBsYXJn
ZSBkYXRhIG9iamVjdHMsCmJvdGggYmVjYXVzZSB0aGUgc2V0dXBfZGF0YSBoZWFkZXIgaGFzIHRv
IGJlIGFkamFjZW50IHRvIHRoZSBkYXRhIG9iamVjdAphbmQgYmVjYXVzZSBpdCBoYXMgYSAzMi1i
aXQgbGVuZ3RoIGZpZWxkLiBIb3dldmVyLCBpdCBpcyBpbXBvcnRhbnQgdGhhdAppbnRlcm1lZGlh
dGUgc3RhZ2VzIG9mIHRoZSBib290IHByb2Nlc3MgaGF2ZSBhIHdheSB0byBpZGVudGlmeSB3aGlj
aApjaHVua3Mgb2YgbWVtb3J5IGFyZSBvY2N1cGllZCBieSBrZXJuZWwgZGF0YS4gVGh1cyB3ZSBp
bnRyb2R1Y2UgYW4gdW5pZm9ybQp3YXkgdG8gc3BlY2lmeSBzdWNoIGluZGlyZWN0IGRhdGEgYXMg
c2V0dXBfaW5kaXJlY3Qgc3RydWN0IGFuZApTRVRVUF9JTkRJUkVDVCB0eXBlLgoKU3VnZ2VzdGVk
LWJ5OiBILiBQZXRlciBBbnZpbiAoSW50ZWwpIDxocGFAenl0b3IuY29tPgpTaWduZWQtb2ZmLWJ5
OiBEYW5pZWwgS2lwZXIgPGRhbmllbC5raXBlckBvcmFjbGUuY29tPgpBY2tlZC1ieTogS29ucmFk
IFJ6ZXN6dXRlayBXaWxrIDxrb25yYWQud2lsa0BvcmFjbGUuY29tPgpSZXZpZXdlZC1ieTogUm9z
cyBQaGlsaXBzb24gPHJvc3MucGhpbGlwc29uQG9yYWNsZS5jb20+ClJldmlld2VkLWJ5OiBILiBQ
ZXRlciBBbnZpbiAoSW50ZWwpIDxocGFAenl0b3IuY29tPgotLS0KdjQgLSBzdWdnZXN0aW9ucy9m
aXhlczoKICAgLSBjaGFuZ2UgIk5vdGU6IiB0byAiLi4gbm90ZTo6Ii4KCnYzIC0gc3VnZ2VzdGlv
bnMvZml4ZXM6CiAgIC0gYWRkIHNldHVwX2luZGlyZWN0IG1hcHBpbmcvS0FTTFIgYXZvaWRhbmNl
L2V0Yy4gY29kZQogICAgIChzdWdnZXN0ZWQgYnkgSC4gUGV0ZXIgQW52aW4pLAogICAtIHRoZSBT
RVRVUF9JTkRJUkVDVCBzZXRzIG1vc3Qgc2lnbmlmaWNhbnQgYml0IHJpZ2h0IG5vdzsKICAgICB0
aGlzIHdheSBpdCBpcyBwb3NzaWJsZSB0byBkaWZmZXJlbnRpYXRlIHJlZ3VsYXIgc2V0dXBfZGF0
YQogICAgIGFuZCBzZXR1cF9pbmRpcmVjdCBvYmplY3RzIGluIHRoZSBkZWJ1Z2ZzIGZpbGVzeXN0
ZW0uCgp2MiAtIHN1Z2dlc3Rpb25zL2ZpeGVzOgogICAtIGFkZCBzZXR1cF9pbmRpcmVjdCB1c2Fn
ZSBleGFtcGxlCiAgICAgKHN1Z2dlc3RlZCBieSBFcmljIFNub3diZXJnIGFuZCBSb3NzIFBoaWxp
cHNvbikuCi0tLQogRG9jdW1lbnRhdGlvbi94ODYvYm9vdC5yc3QgICAgICAgICAgICB8IDQxICsr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiBhcmNoL3g4Ni9ib290L2NvbXByZXNz
ZWQva2FzbHIuYyAgICAgIHwgMTIgKysrKysrKysrKwogYXJjaC94ODYvaW5jbHVkZS91YXBpL2Fz
bS9ib290cGFyYW0uaCB8IDE2ICsrKysrKysrKysrLS0tCiBhcmNoL3g4Ni9rZXJuZWwvZTgyMC5j
ICAgICAgICAgICAgICAgIHwgMTEgKysrKysrKysrKwogYXJjaC94ODYva2VybmVsL2tkZWJ1Z2Zz
LmMgICAgICAgICAgICB8IDIwICsrKysrKysrKysrKystLS0tCiBhcmNoL3g4Ni9rZXJuZWwva3N5
c2ZzLmMgICAgICAgICAgICAgIHwgMzAgKysrKysrKysrKysrKysrKysrKy0tLS0tLQogYXJjaC94
ODYva2VybmVsL3NldHVwLmMgICAgICAgICAgICAgICB8ICA0ICsrKysKIGFyY2gveDg2L21tL2lv
cmVtYXAuYyAgICAgICAgICAgICAgICAgfCAxMSArKysrKysrKysrCiA4IGZpbGVzIGNoYW5nZWQs
IDEzMSBpbnNlcnRpb25zKCspLCAxNCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9Eb2N1bWVu
dGF0aW9uL3g4Ni9ib290LnJzdCBiL0RvY3VtZW50YXRpb24veDg2L2Jvb3QucnN0CmluZGV4IDhl
NTIzYzIzZWRlMy4uMzgxNTViYTg3NDBmIDEwMDY0NAotLS0gYS9Eb2N1bWVudGF0aW9uL3g4Ni9i
b290LnJzdAorKysgYi9Eb2N1bWVudGF0aW9uL3g4Ni9ib290LnJzdApAQCAtODI3LDYgKzgyNyw0
NyBAQCBQcm90b2NvbDoJMi4wOSsKICAgc3VyZSB0byBjb25zaWRlciB0aGUgY2FzZSB3aGVyZSB0
aGUgbGlua2VkIGxpc3QgYWxyZWFkeSBjb250YWlucwogICBlbnRyaWVzLgogCisgIFRoZSBzZXR1
cF9kYXRhIGlzIGEgYml0IGF3a3dhcmQgdG8gdXNlIGZvciBleHRyZW1lbHkgbGFyZ2UgZGF0YSBv
YmplY3RzLAorICBib3RoIGJlY2F1c2UgdGhlIHNldHVwX2RhdGEgaGVhZGVyIGhhcyB0byBiZSBh
ZGphY2VudCB0byB0aGUgZGF0YSBvYmplY3QKKyAgYW5kIGJlY2F1c2UgaXQgaGFzIGEgMzItYml0
IGxlbmd0aCBmaWVsZC4gSG93ZXZlciwgaXQgaXMgaW1wb3J0YW50IHRoYXQKKyAgaW50ZXJtZWRp
YXRlIHN0YWdlcyBvZiB0aGUgYm9vdCBwcm9jZXNzIGhhdmUgYSB3YXkgdG8gaWRlbnRpZnkgd2hp
Y2gKKyAgY2h1bmtzIG9mIG1lbW9yeSBhcmUgb2NjdXBpZWQgYnkga2VybmVsIGRhdGEuCisKKyAg
VGh1cyBzZXR1cF9pbmRpcmVjdCBzdHJ1Y3QgYW5kIFNFVFVQX0lORElSRUNUIHR5cGUgd2VyZSBp
bnRyb2R1Y2VkIGluCisgIHByb3RvY29sIDIuMTUuCisKKyAgc3RydWN0IHNldHVwX2luZGlyZWN0
IHsKKyAgICBfX3UzMiB0eXBlOworICAgIF9fdTMyIHJlc2VydmVkOyAgLyogUmVzZXJ2ZWQsIG11
c3QgYmUgc2V0IHRvIHplcm8uICovCisgICAgX191NjQgbGVuOworICAgIF9fdTY0IGFkZHI7Cisg
IH07CisKKyAgVGhlIHR5cGUgbWVtYmVyIGlzIGEgU0VUVVBfSU5ESVJFQ1QgfCBTRVRVUF8qIHR5
cGUuIEhvd2V2ZXIsIGl0IGNhbm5vdCBiZQorICBTRVRVUF9JTkRJUkVDVCBpdHNlbGYgc2luY2Ug
bWFraW5nIHRoZSBzZXR1cF9pbmRpcmVjdCBhIHRyZWUgc3RydWN0dXJlCisgIGNvdWxkIHJlcXVp
cmUgYSBsb3Qgb2Ygc3RhY2sgc3BhY2UgaW4gc29tZXRoaW5nIHRoYXQgbmVlZHMgdG8gcGFyc2Ug
aXQKKyAgYW5kIHN0YWNrIHNwYWNlIGNhbiBiZSBsaW1pdGVkIGluIGJvb3QgY29udGV4dHMuCisK
KyAgTGV0J3MgZ2l2ZSBhbiBleGFtcGxlIGhvdyB0byBwb2ludCB0byBTRVRVUF9FODIwX0VYVCBk
YXRhIHVzaW5nIHNldHVwX2luZGlyZWN0LgorICBJbiB0aGlzIGNhc2Ugc2V0dXBfZGF0YSBhbmQg
c2V0dXBfaW5kaXJlY3Qgd2lsbCBsb29rIGxpa2UgdGhpczoKKworICBzdHJ1Y3Qgc2V0dXBfZGF0
YSB7CisgICAgX191NjQgbmV4dCA9IDAgb3IgPGFkZHJfb2ZfbmV4dF9zZXR1cF9kYXRhX3N0cnVj
dD47CisgICAgX191MzIgdHlwZSA9IFNFVFVQX0lORElSRUNUOworICAgIF9fdTMyIGxlbiA9IHNp
emVvZihzZXR1cF9kYXRhKTsKKyAgICBfX3U4IGRhdGFbc2l6ZW9mKHNldHVwX2luZGlyZWN0KV0g
PSBzdHJ1Y3Qgc2V0dXBfaW5kaXJlY3QgeworICAgICAgX191MzIgdHlwZSA9IFNFVFVQX0lORElS
RUNUIHwgU0VUVVBfRTgyMF9FWFQ7CisgICAgICBfX3UzMiByZXNlcnZlZCA9IDA7CisgICAgICBf
X3U2NCBsZW4gPSA8bGVuX29mX1NFVFVQX0U4MjBfRVhUX2RhdGE+OworICAgICAgX191NjQgYWRk
ciA9IDxhZGRyX29mX1NFVFVQX0U4MjBfRVhUX2RhdGE+OworICAgIH0KKyAgfQorCisuLiBub3Rl
OjoKKyAgICAgU0VUVVBfSU5ESVJFQ1QgfCBTRVRVUF9OT05FIG9iamVjdHMgY2Fubm90IGJlIHBy
b3Blcmx5IGRpc3Rpbmd1aXNoZWQKKyAgICAgZnJvbSBTRVRVUF9JTkRJUkVDVCBpdHNlbGYuIFNv
LCB0aGlzIGtpbmQgb2Ygb2JqZWN0cyBjYW5ub3QgYmUgcHJvdmlkZWQKKyAgICAgYnkgdGhlIGJv
b3Rsb2FkZXJzLgorCiA9PT09PT09PT09PT0JPT09PT09PT09PT09CiBGaWVsZCBuYW1lOglwcmVm
X2FkZHJlc3MKIFR5cGU6CQlyZWFkIChyZWxvYykKZGlmZiAtLWdpdCBhL2FyY2gveDg2L2Jvb3Qv
Y29tcHJlc3NlZC9rYXNsci5jIGIvYXJjaC94ODYvYm9vdC9jb21wcmVzc2VkL2thc2xyLmMKaW5k
ZXggMmU1M2MwNTZiYTIwLi5iYjliZmVmMTc0YWUgMTAwNjQ0Ci0tLSBhL2FyY2gveDg2L2Jvb3Qv
Y29tcHJlc3NlZC9rYXNsci5jCisrKyBiL2FyY2gveDg2L2Jvb3QvY29tcHJlc3NlZC9rYXNsci5j
CkBAIC00NTksNiArNDU5LDE4IEBAIHN0YXRpYyBib29sIG1lbV9hdm9pZF9vdmVybGFwKHN0cnVj
dCBtZW1fdmVjdG9yICppbWcsCiAJCQlpc19vdmVybGFwcGluZyA9IHRydWU7CiAJCX0KIAorCQlp
ZiAocHRyLT50eXBlID09IFNFVFVQX0lORElSRUNUICYmCisJCSAgICAoKHN0cnVjdCBzZXR1cF9p
bmRpcmVjdCAqKXB0ci0+ZGF0YSktPnR5cGUgIT0gU0VUVVBfSU5ESVJFQ1QpIHsKKwkJCWF2b2lk
LnN0YXJ0ID0gKChzdHJ1Y3Qgc2V0dXBfaW5kaXJlY3QgKilwdHItPmRhdGEpLT5hZGRyOworCQkJ
YXZvaWQuc2l6ZSA9ICgoc3RydWN0IHNldHVwX2luZGlyZWN0ICopcHRyLT5kYXRhKS0+bGVuOwor
CisJCQlpZiAobWVtX292ZXJsYXBzKGltZywgJmF2b2lkKSAmJiAoYXZvaWQuc3RhcnQgPCBlYXJs
aWVzdCkpIHsKKwkJCQkqb3ZlcmxhcCA9IGF2b2lkOworCQkJCWVhcmxpZXN0ID0gb3ZlcmxhcC0+
c3RhcnQ7CisJCQkJaXNfb3ZlcmxhcHBpbmcgPSB0cnVlOworCQkJfQorCQl9CisKIAkJcHRyID0g
KHN0cnVjdCBzZXR1cF9kYXRhICopKHVuc2lnbmVkIGxvbmcpcHRyLT5uZXh0OwogCX0KIApkaWZm
IC0tZ2l0IGEvYXJjaC94ODYvaW5jbHVkZS91YXBpL2FzbS9ib290cGFyYW0uaCBiL2FyY2gveDg2
L2luY2x1ZGUvdWFwaS9hc20vYm9vdHBhcmFtLmgKaW5kZXggZGJiNDExMjhlNWEwLi45NDkwNjZi
NTM5OGEgMTAwNjQ0Ci0tLSBhL2FyY2gveDg2L2luY2x1ZGUvdWFwaS9hc20vYm9vdHBhcmFtLmgK
KysrIGIvYXJjaC94ODYvaW5jbHVkZS91YXBpL2FzbS9ib290cGFyYW0uaApAQCAtMiw3ICsyLDcg
QEAKICNpZm5kZWYgX0FTTV9YODZfQk9PVFBBUkFNX0gKICNkZWZpbmUgX0FTTV9YODZfQk9PVFBB
UkFNX0gKIAotLyogc2V0dXBfZGF0YSB0eXBlcyAqLworLyogc2V0dXBfZGF0YS9zZXR1cF9pbmRp
cmVjdCB0eXBlcyAqLwogI2RlZmluZSBTRVRVUF9OT05FCQkJMAogI2RlZmluZSBTRVRVUF9FODIw
X0VYVAkJCTEKICNkZWZpbmUgU0VUVVBfRFRCCQkJMgpAQCAtMTEsOCArMTEsMTAgQEAKICNkZWZp
bmUgU0VUVVBfQVBQTEVfUFJPUEVSVElFUwkJNQogI2RlZmluZSBTRVRVUF9KQUlMSE9VU0UJCQk2
CiAKLS8qIG1heChTRVRVUF8qKSAqLwotI2RlZmluZSBTRVRVUF9UWVBFX01BWAkJCVNFVFVQX0pB
SUxIT1VTRQorI2RlZmluZSBTRVRVUF9JTkRJUkVDVAkJCSgxPDwzMSkKKworLyogU0VUVVBfSU5E
SVJFQ1QgfCBtYXgoU0VUVVBfKikgKi8KKyNkZWZpbmUgU0VUVVBfVFlQRV9NQVgJCQkoU0VUVVBf
SU5ESVJFQ1QgfCBTRVRVUF9KQUlMSE9VU0UpCiAKIC8qIHJhbV9zaXplIGZsYWdzICovCiAjZGVm
aW5lIFJBTURJU0tfSU1BR0VfU1RBUlRfTUFTSwkweDA3RkYKQEAgLTUyLDYgKzU0LDE0IEBAIHN0
cnVjdCBzZXR1cF9kYXRhIHsKIAlfX3U4IGRhdGFbMF07CiB9OwogCisvKiBleHRlbnNpYmxlIHNl
dHVwIGluZGlyZWN0IGRhdGEgbm9kZSAqLworc3RydWN0IHNldHVwX2luZGlyZWN0IHsKKwlfX3Uz
MiB0eXBlOworCV9fdTMyIHJlc2VydmVkOyAgLyogUmVzZXJ2ZWQsIG11c3QgYmUgc2V0IHRvIHpl
cm8uICovCisJX191NjQgbGVuOworCV9fdTY0IGFkZHI7Cit9OworCiBzdHJ1Y3Qgc2V0dXBfaGVh
ZGVyIHsKIAlfX3U4CXNldHVwX3NlY3RzOwogCV9fdTE2CXJvb3RfZmxhZ3M7CmRpZmYgLS1naXQg
YS9hcmNoL3g4Ni9rZXJuZWwvZTgyMC5jIGIvYXJjaC94ODYva2VybmVsL2U4MjAuYwppbmRleCA3
ZGEyYmNkMmI4ZWIuLjBiZmU5YTY4NWIzYiAxMDA2NDQKLS0tIGEvYXJjaC94ODYva2VybmVsL2U4
MjAuYworKysgYi9hcmNoL3g4Ni9rZXJuZWwvZTgyMC5jCkBAIC05OTksNiArOTk5LDE3IEBAIHZv
aWQgX19pbml0IGU4MjBfX3Jlc2VydmVfc2V0dXBfZGF0YSh2b2lkKQogCQlkYXRhID0gZWFybHlf
bWVtcmVtYXAocGFfZGF0YSwgc2l6ZW9mKCpkYXRhKSk7CiAJCWU4MjBfX3JhbmdlX3VwZGF0ZShw
YV9kYXRhLCBzaXplb2YoKmRhdGEpK2RhdGEtPmxlbiwgRTgyMF9UWVBFX1JBTSwgRTgyMF9UWVBF
X1JFU0VSVkVEX0tFUk4pOwogCQllODIwX19yYW5nZV91cGRhdGVfa2V4ZWMocGFfZGF0YSwgc2l6
ZW9mKCpkYXRhKStkYXRhLT5sZW4sIEU4MjBfVFlQRV9SQU0sIEU4MjBfVFlQRV9SRVNFUlZFRF9L
RVJOKTsKKworCQlpZiAoZGF0YS0+dHlwZSA9PSBTRVRVUF9JTkRJUkVDVCAmJgorCQkgICAgKChz
dHJ1Y3Qgc2V0dXBfaW5kaXJlY3QgKilkYXRhLT5kYXRhKS0+dHlwZSAhPSBTRVRVUF9JTkRJUkVD
VCkgeworCQkJZTgyMF9fcmFuZ2VfdXBkYXRlKCgoc3RydWN0IHNldHVwX2luZGlyZWN0ICopZGF0
YS0+ZGF0YSktPmFkZHIsCisJCQkJCSAgICgoc3RydWN0IHNldHVwX2luZGlyZWN0ICopZGF0YS0+
ZGF0YSktPmxlbiwKKwkJCQkJICAgRTgyMF9UWVBFX1JBTSwgRTgyMF9UWVBFX1JFU0VSVkVEX0tF
Uk4pOworCQkJZTgyMF9fcmFuZ2VfdXBkYXRlX2tleGVjKCgoc3RydWN0IHNldHVwX2luZGlyZWN0
ICopZGF0YS0+ZGF0YSktPmFkZHIsCisJCQkJCQkgKChzdHJ1Y3Qgc2V0dXBfaW5kaXJlY3QgKilk
YXRhLT5kYXRhKS0+bGVuLAorCQkJCQkJIEU4MjBfVFlQRV9SQU0sIEU4MjBfVFlQRV9SRVNFUlZF
RF9LRVJOKTsKKwkJfQorCiAJCXBhX2RhdGEgPSBkYXRhLT5uZXh0OwogCQllYXJseV9tZW11bm1h
cChkYXRhLCBzaXplb2YoKmRhdGEpKTsKIAl9CmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9rZXJuZWwv
a2RlYnVnZnMuYyBiL2FyY2gveDg2L2tlcm5lbC9rZGVidWdmcy5jCmluZGV4IGVkYWEzMGIyMDg0
MS4uNzAxYTk4MzAwZjg2IDEwMDY0NAotLS0gYS9hcmNoL3g4Ni9rZXJuZWwva2RlYnVnZnMuYwor
KysgYi9hcmNoL3g4Ni9rZXJuZWwva2RlYnVnZnMuYwpAQCAtNDQsNyArNDQsMTEgQEAgc3RhdGlj
IHNzaXplX3Qgc2V0dXBfZGF0YV9yZWFkKHN0cnVjdCBmaWxlICpmaWxlLCBjaGFyIF9fdXNlciAq
dXNlcl9idWYsCiAJaWYgKGNvdW50ID4gbm9kZS0+bGVuIC0gcG9zKQogCQljb3VudCA9IG5vZGUt
PmxlbiAtIHBvczsKIAotCXBhID0gbm9kZS0+cGFkZHIgKyBzaXplb2Yoc3RydWN0IHNldHVwX2Rh
dGEpICsgcG9zOworCXBhID0gbm9kZS0+cGFkZHIgKyBwb3M7CisKKwlpZiAoIShub2RlLT50eXBl
ICYgU0VUVVBfSU5ESVJFQ1QpIHx8IG5vZGUtPnR5cGUgPT0gU0VUVVBfSU5ESVJFQ1QpCisJCXBh
ICs9IHNpemVvZihzdHJ1Y3Qgc2V0dXBfZGF0YSk7CisKIAlwID0gbWVtcmVtYXAocGEsIGNvdW50
LCBNRU1SRU1BUF9XQik7CiAJaWYgKCFwKQogCQlyZXR1cm4gLUVOT01FTTsKQEAgLTEwOCw5ICsx
MTIsMTcgQEAgc3RhdGljIGludCBfX2luaXQgY3JlYXRlX3NldHVwX2RhdGFfbm9kZXMoc3RydWN0
IGRlbnRyeSAqcGFyZW50KQogCQkJZ290byBlcnJfZGlyOwogCQl9CiAKLQkJbm9kZS0+cGFkZHIg
PSBwYV9kYXRhOwotCQlub2RlLT50eXBlID0gZGF0YS0+dHlwZTsKLQkJbm9kZS0+bGVuID0gZGF0
YS0+bGVuOworCQlpZiAoZGF0YS0+dHlwZSA9PSBTRVRVUF9JTkRJUkVDVCAmJgorCQkgICAgKChz
dHJ1Y3Qgc2V0dXBfaW5kaXJlY3QgKilkYXRhLT5kYXRhKS0+dHlwZSAhPSBTRVRVUF9JTkRJUkVD
VCkgeworCQkJbm9kZS0+cGFkZHIgPSAoKHN0cnVjdCBzZXR1cF9pbmRpcmVjdCAqKWRhdGEtPmRh
dGEpLT5hZGRyOworCQkJbm9kZS0+dHlwZSA9ICgoc3RydWN0IHNldHVwX2luZGlyZWN0ICopZGF0
YS0+ZGF0YSktPnR5cGU7CisJCQlub2RlLT5sZW4gPSAoKHN0cnVjdCBzZXR1cF9pbmRpcmVjdCAq
KWRhdGEtPmRhdGEpLT5sZW47CisJCX0gZWxzZSB7CisJCQlub2RlLT5wYWRkciA9IHBhX2RhdGE7
CisJCQlub2RlLT50eXBlID0gZGF0YS0+dHlwZTsKKwkJCW5vZGUtPmxlbiA9IGRhdGEtPmxlbjsK
KwkJfQorCiAJCWNyZWF0ZV9zZXR1cF9kYXRhX25vZGUoZCwgbm8sIG5vZGUpOwogCQlwYV9kYXRh
ID0gZGF0YS0+bmV4dDsKIApkaWZmIC0tZ2l0IGEvYXJjaC94ODYva2VybmVsL2tzeXNmcy5jIGIv
YXJjaC94ODYva2VybmVsL2tzeXNmcy5jCmluZGV4IDc5NjlkYTkzOTIxMy4uMTRlZjgxMjFhYTUz
IDEwMDY0NAotLS0gYS9hcmNoL3g4Ni9rZXJuZWwva3N5c2ZzLmMKKysrIGIvYXJjaC94ODYva2Vy
bmVsL2tzeXNmcy5jCkBAIC0xMDAsNyArMTAwLDExIEBAIHN0YXRpYyBpbnQgX19pbml0IGdldF9z
ZXR1cF9kYXRhX3NpemUoaW50IG5yLCBzaXplX3QgKnNpemUpCiAJCWlmICghZGF0YSkKIAkJCXJl
dHVybiAtRU5PTUVNOwogCQlpZiAobnIgPT0gaSkgewotCQkJKnNpemUgPSBkYXRhLT5sZW47CisJ
CQlpZiAoZGF0YS0+dHlwZSA9PSBTRVRVUF9JTkRJUkVDVCAmJgorCQkJICAgICgoc3RydWN0IHNl
dHVwX2luZGlyZWN0ICopZGF0YS0+ZGF0YSktPnR5cGUgIT0gU0VUVVBfSU5ESVJFQ1QpCisJCQkJ
KnNpemUgPSAoKHN0cnVjdCBzZXR1cF9pbmRpcmVjdCAqKWRhdGEtPmRhdGEpLT5sZW47CisJCQll
bHNlCisJCQkJKnNpemUgPSBkYXRhLT5sZW47CiAJCQltZW11bm1hcChkYXRhKTsKIAkJCXJldHVy
biAwOwogCQl9CkBAIC0xMzAsNyArMTM0LDEwIEBAIHN0YXRpYyBzc2l6ZV90IHR5cGVfc2hvdyhz
dHJ1Y3Qga29iamVjdCAqa29iaiwKIAlpZiAoIWRhdGEpCiAJCXJldHVybiAtRU5PTUVNOwogCi0J
cmV0ID0gc3ByaW50ZihidWYsICIweCV4XG4iLCBkYXRhLT50eXBlKTsKKwlpZiAoZGF0YS0+dHlw
ZSA9PSBTRVRVUF9JTkRJUkVDVCkKKwkJcmV0ID0gc3ByaW50ZihidWYsICIweCV4XG4iLCAoKHN0
cnVjdCBzZXR1cF9pbmRpcmVjdCAqKWRhdGEtPmRhdGEpLT50eXBlKTsKKwllbHNlCisJCXJldCA9
IHNwcmludGYoYnVmLCAiMHgleFxuIiwgZGF0YS0+dHlwZSk7CiAJbWVtdW5tYXAoZGF0YSk7CiAJ
cmV0dXJuIHJldDsKIH0KQEAgLTE0Miw3ICsxNDksNyBAQCBzdGF0aWMgc3NpemVfdCBzZXR1cF9k
YXRhX2RhdGFfcmVhZChzdHJ1Y3QgZmlsZSAqZnAsCiAJCQkJICAgIGxvZmZfdCBvZmYsIHNpemVf
dCBjb3VudCkKIHsKIAlpbnQgbnIsIHJldCA9IDA7Ci0JdTY0IHBhZGRyOworCXU2NCBwYWRkciwg
bGVuOwogCXN0cnVjdCBzZXR1cF9kYXRhICpkYXRhOwogCXZvaWQgKnA7CiAKQEAgLTE1NywxOSAr
MTY0LDI4IEBAIHN0YXRpYyBzc2l6ZV90IHNldHVwX2RhdGFfZGF0YV9yZWFkKHN0cnVjdCBmaWxl
ICpmcCwKIAlpZiAoIWRhdGEpCiAJCXJldHVybiAtRU5PTUVNOwogCi0JaWYgKG9mZiA+IGRhdGEt
PmxlbikgeworCWlmIChkYXRhLT50eXBlID09IFNFVFVQX0lORElSRUNUICYmCisJICAgICgoc3Ry
dWN0IHNldHVwX2luZGlyZWN0ICopZGF0YS0+ZGF0YSktPnR5cGUgIT0gU0VUVVBfSU5ESVJFQ1Qp
IHsKKwkJcGFkZHIgPSAoKHN0cnVjdCBzZXR1cF9pbmRpcmVjdCAqKWRhdGEtPmRhdGEpLT5hZGRy
OworCQlsZW4gPSAoKHN0cnVjdCBzZXR1cF9pbmRpcmVjdCAqKWRhdGEtPmRhdGEpLT5sZW47CisJ
fSBlbHNlIHsKKwkJcGFkZHIgKz0gc2l6ZW9mKCpkYXRhKTsKKwkJbGVuID0gZGF0YS0+bGVuOwor
CX0KKworCWlmIChvZmYgPiBsZW4pIHsKIAkJcmV0ID0gLUVJTlZBTDsKIAkJZ290byBvdXQ7CiAJ
fQogCi0JaWYgKGNvdW50ID4gZGF0YS0+bGVuIC0gb2ZmKQotCQljb3VudCA9IGRhdGEtPmxlbiAt
IG9mZjsKKwlpZiAoY291bnQgPiBsZW4gLSBvZmYpCisJCWNvdW50ID0gbGVuIC0gb2ZmOwogCiAJ
aWYgKCFjb3VudCkKIAkJZ290byBvdXQ7CiAKIAlyZXQgPSBjb3VudDsKLQlwID0gbWVtcmVtYXAo
cGFkZHIgKyBzaXplb2YoKmRhdGEpLCBkYXRhLT5sZW4sIE1FTVJFTUFQX1dCKTsKKwlwID0gbWVt
cmVtYXAocGFkZHIsIGxlbiwgTUVNUkVNQVBfV0IpOwogCWlmICghcCkgewogCQlyZXQgPSAtRU5P
TUVNOwogCQlnb3RvIG91dDsKZGlmZiAtLWdpdCBhL2FyY2gveDg2L2tlcm5lbC9zZXR1cC5jIGIv
YXJjaC94ODYva2VybmVsL3NldHVwLmMKaW5kZXggNzdlYTk2Yjc5NGJkLi40NjAzNzAyZGJmYzEg
MTAwNjQ0Ci0tLSBhL2FyY2gveDg2L2tlcm5lbC9zZXR1cC5jCisrKyBiL2FyY2gveDg2L2tlcm5l
bC9zZXR1cC5jCkBAIC00MzgsNiArNDM4LDEwIEBAIHN0YXRpYyB2b2lkIF9faW5pdCBtZW1ibG9j
a194ODZfcmVzZXJ2ZV9yYW5nZV9zZXR1cF9kYXRhKHZvaWQpCiAJd2hpbGUgKHBhX2RhdGEpIHsK
IAkJZGF0YSA9IGVhcmx5X21lbXJlbWFwKHBhX2RhdGEsIHNpemVvZigqZGF0YSkpOwogCQltZW1i
bG9ja19yZXNlcnZlKHBhX2RhdGEsIHNpemVvZigqZGF0YSkgKyBkYXRhLT5sZW4pOworCQlpZiAo
ZGF0YS0+dHlwZSA9PSBTRVRVUF9JTkRJUkVDVCAmJgorCQkgICAgKChzdHJ1Y3Qgc2V0dXBfaW5k
aXJlY3QgKilkYXRhLT5kYXRhKS0+dHlwZSAhPSBTRVRVUF9JTkRJUkVDVCkKKwkJCW1lbWJsb2Nr
X3Jlc2VydmUoKChzdHJ1Y3Qgc2V0dXBfaW5kaXJlY3QgKilkYXRhLT5kYXRhKS0+YWRkciwKKwkJ
CQkJICgoc3RydWN0IHNldHVwX2luZGlyZWN0ICopZGF0YS0+ZGF0YSktPmxlbik7CiAJCXBhX2Rh
dGEgPSBkYXRhLT5uZXh0OwogCQllYXJseV9tZW11bm1hcChkYXRhLCBzaXplb2YoKmRhdGEpKTsK
IAl9CmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9tbS9pb3JlbWFwLmMgYi9hcmNoL3g4Ni9tbS9pb3Jl
bWFwLmMKaW5kZXggYTM5ZGNkYjVhZTM0Li4xZmY5YzIwMzBiNGYgMTAwNjQ0Ci0tLSBhL2FyY2gv
eDg2L21tL2lvcmVtYXAuYworKysgYi9hcmNoL3g4Ni9tbS9pb3JlbWFwLmMKQEAgLTYyNiw2ICs2
MjYsMTcgQEAgc3RhdGljIGJvb2wgbWVtcmVtYXBfaXNfc2V0dXBfZGF0YShyZXNvdXJjZV9zaXpl
X3QgcGh5c19hZGRyLAogCQlwYWRkcl9uZXh0ID0gZGF0YS0+bmV4dDsKIAkJbGVuID0gZGF0YS0+
bGVuOwogCisJCWlmICgocGh5c19hZGRyID4gcGFkZHIpICYmIChwaHlzX2FkZHIgPCAocGFkZHIg
KyBsZW4pKSkgeworCQkJbWVtdW5tYXAoZGF0YSk7CisJCQlyZXR1cm4gdHJ1ZTsKKwkJfQorCisJ
CWlmIChkYXRhLT50eXBlID09IFNFVFVQX0lORElSRUNUICYmCisJCSAgICAoKHN0cnVjdCBzZXR1
cF9pbmRpcmVjdCAqKWRhdGEtPmRhdGEpLT50eXBlICE9IFNFVFVQX0lORElSRUNUKSB7CisJCQlw
YWRkciA9ICgoc3RydWN0IHNldHVwX2luZGlyZWN0ICopZGF0YS0+ZGF0YSktPmFkZHI7CisJCQls
ZW4gPSAoKHN0cnVjdCBzZXR1cF9pbmRpcmVjdCAqKWRhdGEtPmRhdGEpLT5sZW47CisJCX0KKwog
CQltZW11bm1hcChkYXRhKTsKIAogCQlpZiAoKHBoeXNfYWRkciA+IHBhZGRyKSAmJiAocGh5c19h
ZGRyIDwgKHBhZGRyICsgbGVuKSkpCi0tIAoyLjExLjAKCgpfX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZl
bEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxt
YW4vbGlzdGluZm8veGVuLWRldmVs

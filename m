Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 77111BFF8E
	for <lists+xen-devel@lfdr.de>; Fri, 27 Sep 2019 09:03:51 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iDkFr-0003NZ-L1; Fri, 27 Sep 2019 07:01:27 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=Rbpq=XW=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1iDkFp-0003Ls-3u
 for xen-devel@lists.xenproject.org; Fri, 27 Sep 2019 07:01:25 +0000
X-Inumbo-ID: 8ff66912-e0f4-11e9-966c-12813bfff9fa
Received: from mx1.suse.de (unknown [195.135.220.15])
 by localhost (Halon) with ESMTPS
 id 8ff66912-e0f4-11e9-966c-12813bfff9fa;
 Fri, 27 Sep 2019 07:01:02 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id BB7B3B170;
 Fri, 27 Sep 2019 07:00:59 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Fri, 27 Sep 2019 09:00:17 +0200
Message-Id: <20190927070050.12405-14-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190927070050.12405-1-jgross@suse.com>
References: <20190927070050.12405-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v4 13/46] xen/sched: add is_running indicator to
 struct sched_unit
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Tim Deegan <tim@xen.org>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Dario Faggioli <dfaggioli@suse.com>,
 Julien Grall <julien.grall@arm.com>, Meng Xu <mengxu@cis.upenn.edu>,
 Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

QWRkIGFuIGlzX3J1bm5pbmcgaW5kaWNhdG9yIHRvIHN0cnVjdCBzY2hlZF91bml0IHdoaWNoIHdp
bGwgYmUgc2V0CndoZW5ldmVyIHRoZSB1bml0IGlzIGJlaW5nIHNjaGVkdWxlZC4gU3dpdGNoIHNj
aGVkdWxlciBjb2RlIHRvIHVzZQp1bml0LT5pc19ydW5uaW5nIGluc3RlYWQgb2YgdmNwdS0+aXNf
cnVubmluZyBmb3Igc2NoZWR1bGluZyBkZWNpc2lvbnMuCgpBdCB0aGUgc2FtZSB0aW1lIGludHJv
ZHVjZSBhIHN0YXRlX2VudHJ5X3RpbWUgZmllbGQgaW4gc3RydWN0CnNjaGVkX3VuaXQgYmVpbmcg
dXBkYXRlZCB3aGVuZXZlciB0aGUgaXNfcnVubmluZyBpbmRpY2F0b3IgaXMgY2hhbmdlZC4KVXNl
IHRoYXQgbmV3IGZpZWxkIGluIHRoZSBzY2hlZHVsZXJzIGluc3RlYWQgb2YgdGhlIHNpbWlsYXIg
dmNwdSBmaWVsZC4KClNpZ25lZC1vZmYtYnk6IEp1ZXJnZW4gR3Jvc3MgPGpncm9zc0BzdXNlLmNv
bT4KUmV2aWV3ZWQtYnk6IERhcmlvIEZhZ2dpb2xpIDxkZmFnZ2lvbGlAc3VzZS5jb20+Ci0tLQpS
RkMgVjI6Ci0gZml4IGFybSBidWlsZCwgZG9uJ3QgZHJvcCB2LT5pc19ydW5uaW5nClYzOgotIGF2
b2lkIGhvbGVzIGluIHN0cnVjdHVyZXMgKEphbiBCZXVsaWNoKQpWNDoKLSBhc3NpZ24gdHJ1ZS9m
YWxzZSB0byBib29sZWFuIGluc3RlYWQgb2YgMS8wIChKYW4gQmV1bGljaCkKLS0tCiB4ZW4vY29t
bW9uL3NjaGVkX2NyZWRpdC5jICB8IDEyICsrKysrKystLS0tLQogeGVuL2NvbW1vbi9zY2hlZF9j
cmVkaXQyLmMgfCAxOCArKysrKysrKystLS0tLS0tLS0KIHhlbi9jb21tb24vc2NoZWRfcnQuYyAg
ICAgIHwgIDIgKy0KIHhlbi9jb21tb24vc2NoZWR1bGUuYyAgICAgIHwgMTMgKysrKysrKysrKy0t
LQogeGVuL2luY2x1ZGUveGVuL3NjaGVkLmggICAgfCAgNiArKysrKysKIDUgZmlsZXMgY2hhbmdl
ZCwgMzMgaW5zZXJ0aW9ucygrKSwgMTggZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEveGVuL2Nv
bW1vbi9zY2hlZF9jcmVkaXQuYyBiL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0LmMKaW5kZXggNzMy
ZmQ0NjFiNS4uOTQwNGNjZmQ5MCAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQu
YworKysgYi94ZW4vY29tbW9uL3NjaGVkX2NyZWRpdC5jCkBAIC03MDksNyArNzA5LDcgQEAgX19j
c2NoZWRfdmNwdV9pc19taWdyYXRlYWJsZShjb25zdCBzdHJ1Y3QgY3NjaGVkX3ByaXZhdGUgKnBy
diwgc3RydWN0IHZjcHUgKnZjLAogICAgICAqIFRoZSBjYWxsZXIgaXMgc3VwcG9zZWQgdG8gaGF2
ZSBhbHJlYWR5IGNoZWNrZWQgdGhhdCB2YyBpcyBhbHNvCiAgICAgICogbm90IHJ1bm5pbmcuCiAg
ICAgICovCi0gICAgQVNTRVJUKCF2Yy0+aXNfcnVubmluZyk7CisgICAgQVNTRVJUKCF2Yy0+c2No
ZWRfdW5pdC0+aXNfcnVubmluZyk7CiAKICAgICByZXR1cm4gIV9fY3NjaGVkX3ZjcHVfaXNfY2Fj
aGVfaG90KHBydiwgc3ZjKSAmJgogICAgICAgICAgICBjcHVtYXNrX3Rlc3RfY3B1KGRlc3RfY3B1
LCBtYXNrKTsKQEAgLTEwMzMsNyArMTAzMyw4IEBAIGNzY2hlZF91bml0X2luc2VydChjb25zdCBz
dHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogCiAgICAgbG9j
ayA9IHVuaXRfc2NoZWR1bGVfbG9ja19pcnEodW5pdCk7CiAKLSAgICBpZiAoICFfX3ZjcHVfb25f
cnVucShzdmMpICYmIHZjcHVfcnVubmFibGUodmMpICYmICF2Yy0+aXNfcnVubmluZyApCisgICAg
aWYgKCAhX192Y3B1X29uX3J1bnEoc3ZjKSAmJiB2Y3B1X3J1bm5hYmxlKHZjKSAmJgorICAgICAg
ICAgIXZjLT5zY2hlZF91bml0LT5pc19ydW5uaW5nICkKICAgICAgICAgcnVucV9pbnNlcnQoc3Zj
KTsKIAogICAgIHVuaXRfc2NoZWR1bGVfdW5sb2NrX2lycShsb2NrLCB1bml0KTsKQEAgLTE2NDYs
OCArMTY0Nyw5IEBAIGNzY2hlZF9ydW5xX3N0ZWFsKGludCBwZWVyX2NwdSwgaW50IGNwdSwgaW50
IHByaSwgaW50IGJhbGFuY2Vfc3RlcCkKICAgICAgICAgICogdkNQVXMgd2l0aCB1c2VmdWwgc29m
dCBhZmZpbml0aWVzIGluIHNvbWUgc29ydCBvZiBiaXRtYXAKICAgICAgICAgICogb3IgY291bnRl
ci4KICAgICAgICAgICovCi0gICAgICAgIGlmICggdmMtPmlzX3J1bm5pbmcgfHwgKGJhbGFuY2Vf
c3RlcCA9PSBCQUxBTkNFX1NPRlRfQUZGSU5JVFkgJiYKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIWhhc19zb2Z0X2FmZmluaXR5KHZjLT5zY2hlZF91bml0KSkgKQorICAgICAgICBp
ZiAoIHZjLT5zY2hlZF91bml0LT5pc19ydW5uaW5nIHx8CisgICAgICAgICAgICAgKGJhbGFuY2Vf
c3RlcCA9PSBCQUxBTkNFX1NPRlRfQUZGSU5JVFkgJiYKKyAgICAgICAgICAgICAgIWhhc19zb2Z0
X2FmZmluaXR5KHZjLT5zY2hlZF91bml0KSkgKQogICAgICAgICAgICAgY29udGludWU7CiAKICAg
ICAgICAgYWZmaW5pdHlfYmFsYW5jZV9jcHVtYXNrKHZjLT5zY2hlZF91bml0LCBiYWxhbmNlX3N0
ZXAsIGNwdW1hc2tfc2NyYXRjaCk7CkBAIC0xODU1LDcgKzE4NTcsNyBAQCBjc2NoZWRfc2NoZWR1
bGUoCiAgICAgICAgICAgICAgICAgICAgICh1bnNpZ25lZCBjaGFyICopJmQpOwogICAgIH0KIAot
ICAgIHJ1bnRpbWUgPSBub3cgLSBjdXJyZW50LT5ydW5zdGF0ZS5zdGF0ZV9lbnRyeV90aW1lOwor
ICAgIHJ1bnRpbWUgPSBub3cgLSBjdXJyZW50LT5zY2hlZF91bml0LT5zdGF0ZV9lbnRyeV90aW1l
OwogICAgIGlmICggcnVudGltZSA8IDAgKSAvKiBEb2VzIHRoaXMgZXZlciBoYXBwZW4/ICovCiAg
ICAgICAgIHJ1bnRpbWUgPSAwOwogCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3NjaGVkX2NyZWRp
dDIuYyBiL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0Mi5jCmluZGV4IDg4NTdjOThkZDguLjdlYzYx
YTI2NDkgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0Mi5jCisrKyBiL3hlbi9j
b21tb24vc2NoZWRfY3JlZGl0Mi5jCkBAIC0xMjg0LDcgKzEyODQsNyBAQCBydW5xX2luc2VydChj
b25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YykKIAog
ICAgIEFTU0VSVCgmc3ZjLT5ycWQtPnJ1bnEgPT0gcnVucSk7CiAgICAgQVNTRVJUKCFpc19pZGxl
X3ZjcHUoc3ZjLT52Y3B1KSk7Ci0gICAgQVNTRVJUKCFzdmMtPnZjcHUtPmlzX3J1bm5pbmcpOwor
ICAgIEFTU0VSVCghc3ZjLT52Y3B1LT5zY2hlZF91bml0LT5pc19ydW5uaW5nKTsKICAgICBBU1NF
UlQoIShzdmMtPmZsYWdzICYgQ1NGTEFHX3NjaGVkdWxlZCkpOwogCiAgICAgbGlzdF9mb3JfZWFj
aCggaXRlciwgcnVucSApCkBAIC0xMzQxLDggKzEzNDEsOCBAQCBzdGF0aWMgaW5saW5lIGJvb2wg
aXNfcHJlZW1wdGFibGUoY29uc3Qgc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjLAogICAgIGlmICgg
cmF0ZWxpbWl0IDw9IENTQ0hFRDJfUkFURUxJTUlUX1RJQ0tMRV9UT0xFUkFOQ0UgKQogICAgICAg
ICByZXR1cm4gdHJ1ZTsKIAotICAgIEFTU0VSVChzdmMtPnZjcHUtPmlzX3J1bm5pbmcpOwotICAg
IHJldHVybiBub3cgLSBzdmMtPnZjcHUtPnJ1bnN0YXRlLnN0YXRlX2VudHJ5X3RpbWUgPgorICAg
IEFTU0VSVChzdmMtPnZjcHUtPnNjaGVkX3VuaXQtPmlzX3J1bm5pbmcpOworICAgIHJldHVybiBu
b3cgLSBzdmMtPnZjcHUtPnNjaGVkX3VuaXQtPnN0YXRlX2VudHJ5X3RpbWUgPgogICAgICAgICAg
ICByYXRlbGltaXQgLSBDU0NIRUQyX1JBVEVMSU1JVF9USUNLTEVfVE9MRVJBTkNFOwogfQogCkBA
IC0yOTMyLDcgKzI5MzIsNyBAQCBjc2NoZWQyX2RvbV9jbnRsKAogICAgICAgICAgICAgICAgIHsK
ICAgICAgICAgICAgICAgICAgICAgc3ZjID0gY3NjaGVkMl91bml0KHYtPnNjaGVkX3VuaXQpOwog
ICAgICAgICAgICAgICAgICAgICBsb2NrID0gdW5pdF9zY2hlZHVsZV9sb2NrKHN2Yy0+dmNwdS0+
c2NoZWRfdW5pdCk7Ci0gICAgICAgICAgICAgICAgICAgIGlmICggdi0+aXNfcnVubmluZyApCisg
ICAgICAgICAgICAgICAgICAgIGlmICggdi0+c2NoZWRfdW5pdC0+aXNfcnVubmluZyApCiAgICAg
ICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCBj
cHUgPSB2LT5wcm9jZXNzb3I7CiAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVk
Ml9ydW5xdWV1ZV9kYXRhICpycWQgPSBjMnJxZChvcHMsIGNwdSk7CkBAIC0zMjA1LDggKzMyMDUs
OCBAQCBjc2NoZWQyX3J1bnRpbWUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBpbnQgY3B1
LAogICAgIGlmICggcHJ2LT5yYXRlbGltaXRfdXMgKQogICAgIHsKICAgICAgICAgc190aW1lX3Qg
cmF0ZWxpbWl0X21pbiA9IE1JQ1JPU0VDUyhwcnYtPnJhdGVsaW1pdF91cyk7Ci0gICAgICAgIGlm
ICggc25leHQtPnZjcHUtPmlzX3J1bm5pbmcgKQotICAgICAgICAgICAgcmF0ZWxpbWl0X21pbiA9
IHNuZXh0LT52Y3B1LT5ydW5zdGF0ZS5zdGF0ZV9lbnRyeV90aW1lICsKKyAgICAgICAgaWYgKCBz
bmV4dC0+dmNwdS0+c2NoZWRfdW5pdC0+aXNfcnVubmluZyApCisgICAgICAgICAgICByYXRlbGlt
aXRfbWluID0gc25leHQtPnZjcHUtPnNjaGVkX3VuaXQtPnN0YXRlX2VudHJ5X3RpbWUgKwogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIE1JQ1JPU0VDUyhwcnYtPnJhdGVsaW1pdF91cykgLSBu
b3c7CiAgICAgICAgIGlmICggcmF0ZWxpbWl0X21pbiA+IG1pbl90aW1lICkKICAgICAgICAgICAg
IG1pbl90aW1lID0gcmF0ZWxpbWl0X21pbjsKQEAgLTMzMDMsNyArMzMwMyw3IEBAIHJ1bnFfY2Fu
ZGlkYXRlKHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCwKICAgICAgKiBubyBwb2lu
dCBmb3JjaW5nIGl0IHRvIGRvIHNvIHVudGlsIHJhdGUgbGltaXRpbmcgZXhwaXJlcy4KICAgICAg
Ki8KICAgICBpZiAoICF5aWVsZCAmJiBwcnYtPnJhdGVsaW1pdF91cyAmJiB2Y3B1X3J1bm5hYmxl
KHNjdXJyLT52Y3B1KSAmJgotICAgICAgICAgKG5vdyAtIHNjdXJyLT52Y3B1LT5ydW5zdGF0ZS5z
dGF0ZV9lbnRyeV90aW1lKSA8CisgICAgICAgICAobm93IC0gc2N1cnItPnZjcHUtPnNjaGVkX3Vu
aXQtPnN0YXRlX2VudHJ5X3RpbWUpIDwKICAgICAgICAgICBNSUNST1NFQ1MocHJ2LT5yYXRlbGlt
aXRfdXMpICkKICAgICB7CiAgICAgICAgIGlmICggdW5saWtlbHkodGJfaW5pdF9kb25lKSApCkBA
IC0zMzE0LDcgKzMzMTQsNyBAQCBydW5xX2NhbmRpZGF0ZShzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1
ZV9kYXRhICpycWQsCiAgICAgICAgICAgICB9IGQ7CiAgICAgICAgICAgICBkLmRvbSA9IHNjdXJy
LT52Y3B1LT5kb21haW4tPmRvbWFpbl9pZDsKICAgICAgICAgICAgIGQudmNwdSA9IHNjdXJyLT52
Y3B1LT52Y3B1X2lkOwotICAgICAgICAgICAgZC5ydW50aW1lID0gbm93IC0gc2N1cnItPnZjcHUt
PnJ1bnN0YXRlLnN0YXRlX2VudHJ5X3RpbWU7CisgICAgICAgICAgICBkLnJ1bnRpbWUgPSBub3cg
LSBzY3Vyci0+dmNwdS0+c2NoZWRfdW5pdC0+c3RhdGVfZW50cnlfdGltZTsKICAgICAgICAgICAg
IF9fdHJhY2VfdmFyKFRSQ19DU0NIRUQyX1JBVEVMSU1JVCwgMSwKICAgICAgICAgICAgICAgICAg
ICAgICAgIHNpemVvZihkKSwKICAgICAgICAgICAgICAgICAgICAgICAgICh1bnNpZ25lZCBjaGFy
ICopJmQpOwpAQCAtMzU2Miw3ICszNTYyLDcgQEAgY3NjaGVkMl9zY2hlZHVsZSgKICAgICAgICAg
aWYgKCBzbmV4dCAhPSBzY3VyciApCiAgICAgICAgIHsKICAgICAgICAgICAgIEFTU0VSVChzbmV4
dC0+cnFkID09IHJxZCk7Ci0gICAgICAgICAgICBBU1NFUlQoIXNuZXh0LT52Y3B1LT5pc19ydW5u
aW5nKTsKKyAgICAgICAgICAgIEFTU0VSVCghc25leHQtPnZjcHUtPnNjaGVkX3VuaXQtPmlzX3J1
bm5pbmcpOwogCiAgICAgICAgICAgICBydW5xX3JlbW92ZShzbmV4dCk7CiAgICAgICAgICAgICBf
X3NldF9iaXQoX19DU0ZMQUdfc2NoZWR1bGVkLCAmc25leHQtPmZsYWdzKTsKZGlmZiAtLWdpdCBh
L3hlbi9jb21tb24vc2NoZWRfcnQuYyBiL3hlbi9jb21tb24vc2NoZWRfcnQuYwppbmRleCA4NTZl
YWUxZmFhLi4xM2UwZDc1NGFiIDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL3NjaGVkX3J0LmMKKysr
IGIveGVuL2NvbW1vbi9zY2hlZF9ydC5jCkBAIC05MDUsNyArOTA1LDcgQEAgcnRfdW5pdF9pbnNl
cnQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkK
ICAgICB7CiAgICAgICAgIHJlcGxxX2luc2VydChvcHMsIHN2Yyk7CiAKLSAgICAgICAgaWYgKCAh
dmMtPmlzX3J1bm5pbmcgKQorICAgICAgICBpZiAoICF1bml0LT5pc19ydW5uaW5nICkKICAgICAg
ICAgICAgIHJ1bnFfaW5zZXJ0KG9wcywgc3ZjKTsKICAgICB9CiAgICAgdW5pdF9zY2hlZHVsZV91
bmxvY2tfaXJxKGxvY2ssIHVuaXQpOwpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZHVsZS5j
IGIveGVuL2NvbW1vbi9zY2hlZHVsZS5jCmluZGV4IDE1N2I5MWM0MzkuLmIwMjdjMDg0YmYgMTAw
NjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWR1bGUuYworKysgYi94ZW4vY29tbW9uL3NjaGVkdWxl
LmMKQEAgLTQxMiw2ICs0MTIsOCBAQCBpbnQgc2NoZWRfaW5pdF92Y3B1KHN0cnVjdCB2Y3B1ICp2
LCB1bnNpZ25lZCBpbnQgcHJvY2Vzc29yKQogICAgIHsKICAgICAgICAgZ2V0X3NjaGVkX3Jlcyh2
LT5wcm9jZXNzb3IpLT5jdXJyID0gdW5pdDsKICAgICAgICAgdi0+aXNfcnVubmluZyA9IDE7Cisg
ICAgICAgIHVuaXQtPmlzX3J1bm5pbmcgPSB0cnVlOworICAgICAgICB1bml0LT5zdGF0ZV9lbnRy
eV90aW1lID0gTk9XKCk7CiAgICAgfQogICAgIGVsc2UKICAgICB7CkBAIC03MzIsNyArNzM0LDgg
QEAgc3RhdGljIHZvaWQgdmNwdV9taWdyYXRlX2ZpbmlzaChzdHJ1Y3QgdmNwdSAqdikKICAgICAg
KiBjb250ZXh0X3NhdmVkKCk7IGFuZCBpbiBhbnkgY2FzZSwgaWYgdGhlIGJpdCBpcyBjbGVhcmVk
LCB0aGVuCiAgICAgICogc29tZW9uZSBlbHNlIGhhcyBhbHJlYWR5IGRvbmUgdGhlIHdvcmsgc28g
d2UgZG9uJ3QgbmVlZCB0by4KICAgICAgKi8KLSAgICBpZiAoIHYtPmlzX3J1bm5pbmcgfHwgIXRl
c3RfYml0KF9WUEZfbWlncmF0aW5nLCAmdi0+cGF1c2VfZmxhZ3MpICkKKyAgICBpZiAoIHYtPnNj
aGVkX3VuaXQtPmlzX3J1bm5pbmcgfHwKKyAgICAgICAgICF0ZXN0X2JpdChfVlBGX21pZ3JhdGlu
ZywgJnYtPnBhdXNlX2ZsYWdzKSApCiAgICAgICAgIHJldHVybjsKIAogICAgIG9sZF9jcHUgPSBu
ZXdfY3B1ID0gdi0+cHJvY2Vzc29yOwpAQCAtNzg2LDcgKzc4OSw3IEBAIHN0YXRpYyB2b2lkIHZj
cHVfbWlncmF0ZV9maW5pc2goc3RydWN0IHZjcHUgKnYpCiAgICAgICogYmVjYXVzZSB0aGV5IGJv
dGggaGFwcGVuIGluIChkaWZmZXJlbnQpIHNwaW5sb2NrIHJlZ2lvbnMsIGFuZCB0aG9zZQogICAg
ICAqIHJlZ2lvbnMgYXJlIHN0cmljdGx5IHNlcmlhbGlzZWQuCiAgICAgICovCi0gICAgaWYgKCB2
LT5pc19ydW5uaW5nIHx8CisgICAgaWYgKCB2LT5zY2hlZF91bml0LT5pc19ydW5uaW5nIHx8CiAg
ICAgICAgICAhdGVzdF9hbmRfY2xlYXJfYml0KF9WUEZfbWlncmF0aW5nLCAmdi0+cGF1c2VfZmxh
Z3MpICkKICAgICB7CiAgICAgICAgIHNjaGVkX3NwaW5fdW5sb2NrX2RvdWJsZShvbGRfbG9jaywg
bmV3X2xvY2ssIGZsYWdzKTsKQEAgLTE2NzQsOCArMTY3NywxMCBAQCBzdGF0aWMgdm9pZCBzY2hl
ZHVsZSh2b2lkKQogICAgICAqIHN3aXRjaCwgZWxzZSBsb3N0X3JlY29yZHMgcmVzdW1lIHdpbGwg
bm90IHdvcmsgcHJvcGVybHkuCiAgICAgICovCiAKLSAgICBBU1NFUlQoIW5leHQtPmlzX3J1bm5p
bmcpOworICAgIEFTU0VSVCghbmV4dC0+c2NoZWRfdW5pdC0+aXNfcnVubmluZyk7CiAgICAgbmV4
dC0+aXNfcnVubmluZyA9IDE7CisgICAgbmV4dC0+c2NoZWRfdW5pdC0+aXNfcnVubmluZyA9IHRy
dWU7CisgICAgbmV4dC0+c2NoZWRfdW5pdC0+c3RhdGVfZW50cnlfdGltZSA9IG5vdzsKIAogICAg
IHBjcHVfc2NoZWR1bGVfdW5sb2NrX2lycShsb2NrLCBjcHUpOwogCkBAIC0xNjk3LDYgKzE3MDIs
OCBAQCB2b2lkIGNvbnRleHRfc2F2ZWQoc3RydWN0IHZjcHUgKnByZXYpCiAgICAgc21wX3dtYigp
OwogCiAgICAgcHJldi0+aXNfcnVubmluZyA9IDA7CisgICAgcHJldi0+c2NoZWRfdW5pdC0+aXNf
cnVubmluZyA9IGZhbHNlOworICAgIHByZXYtPnNjaGVkX3VuaXQtPnN0YXRlX2VudHJ5X3RpbWUg
PSBOT1coKTsKIAogICAgIC8qIENoZWNrIGZvciBtaWdyYXRpb24gcmVxdWVzdCAvYWZ0ZXIvIGNs
ZWFyaW5nIHJ1bm5pbmcgZmxhZy4gKi8KICAgICBzbXBfbWIoKTsKZGlmZiAtLWdpdCBhL3hlbi9p
bmNsdWRlL3hlbi9zY2hlZC5oIGIveGVuL2luY2x1ZGUveGVuL3NjaGVkLmgKaW5kZXggMzIyN2Qy
ZmU3MS4uNTY0NmQ2MjBjMyAxMDA2NDQKLS0tIGEveGVuL2luY2x1ZGUveGVuL3NjaGVkLmgKKysr
IGIveGVuL2luY2x1ZGUveGVuL3NjaGVkLmgKQEAgLTI3MCw4ICsyNzAsMTQgQEAgc3RydWN0IHNj
aGVkX3VuaXQgewogICAgIHN0cnVjdCBzY2hlZF9yZXNvdXJjZSAqcmVzOwogICAgIHVuc2lnbmVk
IGludCAgICAgICAgICAgdW5pdF9pZDsKIAorICAgIC8qIEN1cnJlbnRseSBydW5uaW5nIG9uIGEg
Q1BVPyAqLworICAgIGJvb2wgICAgICAgICAgICAgICAgICAgaXNfcnVubmluZzsKICAgICAvKiBE
b2VzIHNvZnQgYWZmaW5pdHkgYWN0dWFsbHkgcGxheSBhIHJvbGUgKGdpdmVuIGhhcmQgYWZmaW5p
dHkpPyAqLwogICAgIGJvb2wgICAgICAgICAgICAgICAgICAgc29mdF9hZmZfZWZmZWN0aXZlOwor
CisgICAgLyogTGFzdCB0aW1lIHVuaXQgZ290IChkZS0pc2NoZWR1bGVkLiAqLworICAgIHVpbnQ2
NF90ICAgICAgICAgICAgICAgc3RhdGVfZW50cnlfdGltZTsKKwogICAgIC8qIEJpdG1hc2sgb2Yg
Q1BVcyBvbiB3aGljaCB0aGlzIFZDUFUgbWF5IHJ1bi4gKi8KICAgICBjcHVtYXNrX3Zhcl90ICAg
ICAgICAgIGNwdV9oYXJkX2FmZmluaXR5OwogICAgIC8qIFVzZWQgdG8gc2F2ZSBhZmZpbml0eSBk
dXJpbmcgdGVtcG9yYXJ5IHBpbm5pbmcuICovCi0tIAoyLjE2LjQKCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhl
bi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3Jn
L21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

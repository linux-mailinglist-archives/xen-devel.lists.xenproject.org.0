Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 641967D951
	for <lists+xen-devel@lfdr.de>; Thu,  1 Aug 2019 12:22:13 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1ht8Ah-0001fU-4I; Thu, 01 Aug 2019 10:18:55 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=TV56=V5=intel.com=chao.gao@srs-us1.protection.inumbo.net>)
 id 1ht8Af-0001fA-EB
 for xen-devel@lists.xenproject.org; Thu, 01 Aug 2019 10:18:53 +0000
X-Inumbo-ID: c117e5ca-b445-11e9-b505-bb2a9efd3abe
Received: from mga17.intel.com (unknown [192.55.52.151])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id c117e5ca-b445-11e9-b505-bb2a9efd3abe;
 Thu, 01 Aug 2019 10:18:49 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga003.jf.intel.com ([10.7.209.27])
 by fmsmga107.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 01 Aug 2019 03:18:49 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,333,1559545200"; d="scan'208";a="175207864"
Received: from gao-cwp.sh.intel.com ([10.239.159.26])
 by orsmga003.jf.intel.com with ESMTP; 01 Aug 2019 03:18:48 -0700
From: Chao Gao <chao.gao@intel.com>
To: xen-devel@lists.xenproject.org
Date: Thu,  1 Aug 2019 18:22:36 +0800
Message-Id: <1564654971-31328-2-git-send-email-chao.gao@intel.com>
X-Mailer: git-send-email 1.9.1
In-Reply-To: <1564654971-31328-1-git-send-email-chao.gao@intel.com>
References: <1564654971-31328-1-git-send-email-chao.gao@intel.com>
Subject: [Xen-devel] [PATCH v8 01/16] misc/xen-ucode: Upload a microcode
 blob to the hypervisor
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Ashok Raj <ashok.raj@intel.com>,
 Wei Liu <wl@xen.org>, Chao Gao <chao.gao@intel.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhpcyBwYXRjaCBwcm92aWRlcyBhIHRvb2wgZm9yIGxhdGUgbWljcm9jb2RlIHVwZGF0ZS4KClNp
Z25lZC1vZmYtYnk6IEtvbnJhZCBSemVzenV0ZWsgV2lsayA8a29ucmFkLndpbGtAb3JhY2xlLmNv
bT4KU2lnbmVkLW9mZi1ieTogQ2hhbyBHYW8gPGNoYW8uZ2FvQGludGVsLmNvbT4KQWNrZWQtYnk6
IEFuZHJldyBDb29wZXIgPGFuZHJldy5jb29wZXIzQGNpdHJpeC5jb20+Ci0tLQpDaGFuZ2VzIGlu
IHY4OgogLSBDb3JyZWN0IHR3byBjb2Rpbmcgc3R5bGUgaXNzdWVzLiBObyBmdW5jdGlvbmFsIGNo
YW5nZXMuCgpDaGFuZ2VzIGluIHY3OgogLSBpbnRyb2R1Y2UgeGNfbWljcm9jb2RlX3VwZGF0ZSgp
IHJhdGhlciB0aGFuIHhjX3BsYXRmb3JtX29wKCkKIC0gYXZvaWQgY3JlYXRpbmcgYm91bmNlIGJ1
ZmZlciB0d2ljZQogLSByZW5hbWUgeGVubWljcm9jb2RlIHRvIHhlbi11Y29kZSwgZm9sbG93aW5n
IG5hbWluZyB0cmFkaXRpb24KIG9mIG90aGVyIHRvb2xzIHRoZXJlLgotLS0KIHRvb2xzL2xpYnhj
L2luY2x1ZGUveGVuY3RybC5oIHwgIDEgKwogdG9vbHMvbGlieGMveGNfbWlzYy5jICAgICAgICAg
fCAyMyArKysrKysrKysrKysrKwogdG9vbHMvbWlzYy9NYWtlZmlsZSAgICAgICAgICAgfCAgNCAr
KysKIHRvb2xzL21pc2MveGVuLXVjb2RlLmMgICAgICAgIHwgNzMgKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKwogNCBmaWxlcyBjaGFuZ2VkLCAxMDEgaW5zZXJ0aW9u
cygrKQogY3JlYXRlIG1vZGUgMTAwNjQ0IHRvb2xzL21pc2MveGVuLXVjb2RlLmMKCmRpZmYgLS1n
aXQgYS90b29scy9saWJ4Yy9pbmNsdWRlL3hlbmN0cmwuaCBiL3Rvb2xzL2xpYnhjL2luY2x1ZGUv
eGVuY3RybC5oCmluZGV4IDBhN2Q4OTQuLjBmZjZlZDkgMTAwNjQ0Ci0tLSBhL3Rvb2xzL2xpYnhj
L2luY2x1ZGUveGVuY3RybC5oCisrKyBiL3Rvb2xzL2xpYnhjL2luY2x1ZGUveGVuY3RybC5oCkBA
IC0xMjQ0LDYgKzEyNDQsNyBAQCB0eXBlZGVmIHVpbnQzMl90IHhjX25vZGVfdG9fbm9kZV9kaXN0
X3Q7CiBpbnQgeGNfcGh5c2luZm8oeGNfaW50ZXJmYWNlICp4Y2gsIHhjX3BoeXNpbmZvX3QgKmlu
Zm8pOwogaW50IHhjX2NwdXRvcG9pbmZvKHhjX2ludGVyZmFjZSAqeGNoLCB1bnNpZ25lZCAqbWF4
X2NwdXMsCiAgICAgICAgICAgICAgICAgICAgeGNfY3B1dG9wb190ICpjcHV0b3BvKTsKK2ludCB4
Y19taWNyb2NvZGVfdXBkYXRlKHhjX2ludGVyZmFjZSAqeGNoLCBjb25zdCB2b2lkICpidWYsIHNp
emVfdCBsZW4pOwogaW50IHhjX251bWFpbmZvKHhjX2ludGVyZmFjZSAqeGNoLCB1bnNpZ25lZCAq
bWF4X25vZGVzLAogICAgICAgICAgICAgICAgIHhjX21lbWluZm9fdCAqbWVtaW5mbywgdWludDMy
X3QgKmRpc3RhbmNlKTsKIGludCB4Y19wY2l0b3BvaW5mbyh4Y19pbnRlcmZhY2UgKnhjaCwgdW5z
aWduZWQgbnVtX2RldnMsCmRpZmYgLS1naXQgYS90b29scy9saWJ4Yy94Y19taXNjLmMgYi90b29s
cy9saWJ4Yy94Y19taXNjLmMKaW5kZXggNWU2NzE0YS4uOGU2MGI2ZSAxMDA2NDQKLS0tIGEvdG9v
bHMvbGlieGMveGNfbWlzYy5jCisrKyBiL3Rvb2xzL2xpYnhjL3hjX21pc2MuYwpAQCAtMjI2LDYg
KzIyNiwyOSBAQCBpbnQgeGNfcGh5c2luZm8oeGNfaW50ZXJmYWNlICp4Y2gsCiAgICAgcmV0dXJu
IDA7CiB9CiAKK2ludCB4Y19taWNyb2NvZGVfdXBkYXRlKHhjX2ludGVyZmFjZSAqeGNoLCBjb25z
dCB2b2lkICpidWYsIHNpemVfdCBsZW4pCit7CisgICAgaW50IHJldDsKKyAgICBERUNMQVJFX1BM
QVRGT1JNX09QOworICAgIERFQ0xBUkVfSFlQRVJDQUxMX0JVRkZFUihzdHJ1Y3QgeGVucGZfbWlj
cm9jb2RlX3VwZGF0ZSwgdWMpOworCisgICAgdWMgPSB4Y19oeXBlcmNhbGxfYnVmZmVyX2FsbG9j
KHhjaCwgdWMsIGxlbik7CisgICAgaWYgKCB1YyA9PSBOVUxMICkKKyAgICAgICAgcmV0dXJuIC0x
OworCisgICAgbWVtY3B5KHVjLCBidWYsIGxlbik7CisKKyAgICBwbGF0Zm9ybV9vcC5jbWQgPSBY
RU5QRl9taWNyb2NvZGVfdXBkYXRlOworICAgIHBsYXRmb3JtX29wLnUubWljcm9jb2RlLmxlbmd0
aCA9IGxlbjsKKyAgICBzZXRfeGVuX2d1ZXN0X2hhbmRsZShwbGF0Zm9ybV9vcC51Lm1pY3JvY29k
ZS5kYXRhLCB1Yyk7CisKKyAgICByZXQgPSBkb19wbGF0Zm9ybV9vcCh4Y2gsICZwbGF0Zm9ybV9v
cCk7CisKKyAgICB4Y19oeXBlcmNhbGxfYnVmZmVyX2ZyZWUoeGNoLCB1Yyk7CisKKyAgICByZXR1
cm4gcmV0OworfQorCiBpbnQgeGNfY3B1dG9wb2luZm8oeGNfaW50ZXJmYWNlICp4Y2gsIHVuc2ln
bmVkICptYXhfY3B1cywKICAgICAgICAgICAgICAgICAgICB4Y19jcHV0b3BvX3QgKmNwdXRvcG8p
CiB7CmRpZmYgLS1naXQgYS90b29scy9taXNjL01ha2VmaWxlIGIvdG9vbHMvbWlzYy9NYWtlZmls
ZQppbmRleCBkNDMyMGRjLi42Mzk0N2JmIDEwMDY0NAotLS0gYS90b29scy9taXNjL01ha2VmaWxl
CisrKyBiL3Rvb2xzL21pc2MvTWFrZWZpbGUKQEAgLTIyLDYgKzIyLDcgQEAgSU5TVEFMTF9TQklO
LSQoQ09ORklHX1g4NikgICAgICs9IHhlbi1odm1jcmFzaAogSU5TVEFMTF9TQklOLSQoQ09ORklH
X1g4NikgICAgICs9IHhlbi1odm1jdHgKIElOU1RBTExfU0JJTi0kKENPTkZJR19YODYpICAgICAr
PSB4ZW4tbG93bWVtZAogSU5TVEFMTF9TQklOLSQoQ09ORklHX1g4NikgICAgICs9IHhlbi1tZm5k
dW1wCitJTlNUQUxMX1NCSU4tJChDT05GSUdfWDg2KSAgICAgKz0geGVuLXVjb2RlCiBJTlNUQUxM
X1NCSU4gICAgICAgICAgICAgICAgICAgKz0geGVuY292CiBJTlNUQUxMX1NCSU4gICAgICAgICAg
ICAgICAgICAgKz0geGVubG9ja3Byb2YKIElOU1RBTExfU0JJTiAgICAgICAgICAgICAgICAgICAr
PSB4ZW5wZXJmCkBAIC0xMTMsNCArMTE0LDcgQEAgeGVuLWxvd21lbWQ6IHhlbi1sb3dtZW1kLm8K
IHhlbmNvdjogeGVuY292Lm8KIAkkKENDKSAkKExERkxBR1MpIC1vICRAICQ8ICQoTERMSUJTX2xp
YnhlbmN0cmwpICQoQVBQRU5EX0xERkxBR1MpCiAKK3hlbi11Y29kZTogeGVuLXVjb2RlLm8KKwkk
KENDKSAkKExERkxBR1MpIC1vICRAICQ8ICQoTERMSUJTX2xpYnhlbmN0cmwpICQoQVBQRU5EX0xE
RkxBR1MpCisKIC1pbmNsdWRlICQoREVQU19JTkNMVURFKQpkaWZmIC0tZ2l0IGEvdG9vbHMvbWlz
Yy94ZW4tdWNvZGUuYyBiL3Rvb2xzL21pc2MveGVuLXVjb2RlLmMKbmV3IGZpbGUgbW9kZSAxMDA2
NDQKaW5kZXggMDAwMDAwMC4uMmIxNDE5NAotLS0gL2Rldi9udWxsCisrKyBiL3Rvb2xzL21pc2Mv
eGVuLXVjb2RlLmMKQEAgLTAsMCArMSw3MyBAQAorI2RlZmluZSBfR05VX1NPVVJDRQorCisjaW5j
bHVkZSA8c3RkaW8uaD4KKyNpbmNsdWRlIDxzdGRsaWIuaD4KKyNpbmNsdWRlIDxzeXMvbW1hbi5o
PgorI2luY2x1ZGUgPGVycm5vLmg+CisjaW5jbHVkZSA8c3RyaW5nLmg+CisjaW5jbHVkZSA8aW50
dHlwZXMuaD4KKyNpbmNsdWRlIDx1bmlzdGQuaD4KKyNpbmNsdWRlIDxzeXMvdHlwZXMuaD4KKyNp
bmNsdWRlIDxzeXMvc3RhdC5oPgorI2luY2x1ZGUgPGZjbnRsLmg+CisjaW5jbHVkZSA8eGVuY3Ry
bC5oPgorCitpbnQgbWFpbihpbnQgYXJnYywgY2hhciAqYXJndltdKQoreworICAgIGludCBmZCwg
bGVuLCByZXQ7CisgICAgY2hhciAqZmlsZW5hbWUsICpidWY7CisgICAgc3RydWN0IHN0YXQgc3Q7
CisgICAgeGNfaW50ZXJmYWNlICp4Y2g7CisKKyAgICBpZiAoYXJnYyA8IDIpCisgICAgeworICAg
ICAgICBmcHJpbnRmKHN0ZGVyciwKKyAgICAgICAgICAgICAgICAieGVuLXVjb2RlOiBYZW4gbWlj
cm9jb2RlIHVwZGF0aW5nIHRvb2xcbiIKKyAgICAgICAgICAgICAgICAiVXNhZ2U6ICVzIDxtaWNy
b2NvZGUgYmxvYj5cbiIsIGFyZ3ZbMF0pOworICAgICAgICByZXR1cm4gMDsKKyAgICB9CisKKyAg
ICBmaWxlbmFtZSA9IGFyZ3ZbMV07CisgICAgZmQgPSBvcGVuKGZpbGVuYW1lLCBPX1JET05MWSk7
CisgICAgaWYgKGZkIDwgMCkgeworICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIkNvdWxkIG5vdCBv
cGVuICVzLiAoZXJyOiAlcylcbiIsCisgICAgICAgICAgICAgICAgZmlsZW5hbWUsIHN0cmVycm9y
KGVycm5vKSk7CisgICAgICAgIHJldHVybiBlcnJubzsKKyAgICB9CisKKyAgICBpZiAoc3RhdChm
aWxlbmFtZSwgJnN0KSAhPSAwKSB7CisgICAgICAgIGZwcmludGYoc3RkZXJyLCAiQ291bGQgbm90
IGdldCB0aGUgc2l6ZSBvZiAlcy4gKGVycjogJXMpXG4iLAorICAgICAgICAgICAgICAgIGZpbGVu
YW1lLCBzdHJlcnJvcihlcnJubykpOworICAgICAgICByZXR1cm4gZXJybm87CisgICAgfQorCisg
ICAgbGVuID0gc3Quc3Rfc2l6ZTsKKyAgICBidWYgPSBtbWFwKDAsIGxlbiwgUFJPVF9SRUFELCBN
QVBfUFJJVkFURSwgZmQsIDApOworICAgIGlmIChidWYgPT0gTUFQX0ZBSUxFRCkgeworICAgICAg
ICBmcHJpbnRmKHN0ZGVyciwgIm1tYXAgZmFpbGVkLiAoZXJyb3I6ICVzKVxuIiwgc3RyZXJyb3Io
ZXJybm8pKTsKKyAgICAgICAgcmV0dXJuIGVycm5vOworICAgIH0KKworICAgIHhjaCA9IHhjX2lu
dGVyZmFjZV9vcGVuKDAsMCwwKTsKKyAgICBpZiAoeGNoID09IE5VTEwpCisgICAgeworICAgICAg
ICBmcHJpbnRmKHN0ZGVyciwgIkVycm9yIG9wZW5pbmcgeGMgaW50ZXJmYWNlLiAoZXJyOiAlcylc
biIsCisgICAgICAgICAgICAgICAgc3RyZXJyb3IoZXJybm8pKTsKKyAgICAgICAgcmV0dXJuIGVy
cm5vOworICAgIH0KKworICAgIHJldCA9IHhjX21pY3JvY29kZV91cGRhdGUoeGNoLCBidWYsIGxl
bik7CisgICAgaWYgKHJldCkKKyAgICAgICAgZnByaW50ZihzdGRlcnIsICJGYWlsZWQgdG8gdXBk
YXRlIG1pY3JvY29kZS4gKGVycjogJXMpXG4iLAorICAgICAgICAgICAgICAgIHN0cmVycm9yKGVy
cm5vKSk7CisKKyAgICB4Y19pbnRlcmZhY2VfY2xvc2UoeGNoKTsKKworICAgIGlmIChtdW5tYXAo
YnVmLCBsZW4pKSB7CisgICAgICAgIHByaW50ZigiQ291bGQgbm90IHVubWFwOiAlZCglcylcbiIs
IGVycm5vLCBzdHJlcnJvcihlcnJubykpOworICAgICAgICByZXR1cm4gZXJybm87CisgICAgfQor
ICAgIGNsb3NlKGZkKTsKKworICAgIHJldHVybiAwOworfQotLSAKMS44LjMuMQoKCl9fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5n
IGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJv
amVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

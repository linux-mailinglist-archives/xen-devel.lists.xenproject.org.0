Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id BD41912C03
	for <lists+xen-devel@lfdr.de>; Fri,  3 May 2019 13:09:18 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hMVzS-0003tW-Td; Fri, 03 May 2019 11:04:30 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=XpsL=TD=citrix.com=prvs=019780e18=roger.pau@srs-us1.protection.inumbo.net>)
 id 1hMVzR-0003tR-JC
 for xen-devel@lists.xenproject.org; Fri, 03 May 2019 11:04:29 +0000
X-Inumbo-ID: 3215bd1e-6d93-11e9-a2b0-e348741ffecd
Received: from SMTP.EU.CITRIX.COM (unknown [185.25.65.24])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 3215bd1e-6d93-11e9-a2b0-e348741ffecd;
 Fri, 03 May 2019 11:04:18 +0000 (UTC)
X-IronPort-AV: E=Sophos;i="5.60,425,1549929600"; d="scan'208";a="89621915"
Date: Fri, 3 May 2019 13:04:11 +0200
From: Roger Pau =?utf-8?B?TW9ubsOp?= <roger.pau@citrix.com>
To: Olaf Hering <olaf@aepfle.de>
Message-ID: <20190503110411.so4kiwmji4en3ugc@Air-de-Roger>
References: <20190503094251.16148-1-olaf@aepfle.de>
MIME-Version: 1.0
Content-Disposition: inline
In-Reply-To: <20190503094251.16148-1-olaf@aepfle.de>
User-Agent: NeoMutt/20180716
X-ClientProxiedBy: AMSPEX02CAS01.citrite.net (10.69.22.112) To
 AMSPEX02CL02.citrite.net (10.69.22.126)
Subject: Re: [Xen-devel] [PATCH v2] libxl: fix migration of PV and PVH domUs
 with and without qemu
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Anthony PERARD <anthony.perard@citrix.com>, xen-devel@lists.xenproject.org,
 Ian Jackson <ian.jackson@eu.citrix.com>, Wei Liu <wei.liu2@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

T24gRnJpLCBNYXkgMDMsIDIwMTkgYXQgMTE6NDI6NTFBTSArMDIwMCwgT2xhZiBIZXJpbmcgd3Jv
dGU6Cj4gSWYgYSBkb21VIGhhcyBhIHFlbXUteGVuIGluc3RhbmNlIGF0dGFjaGVkLCBpdCBpcyBy
ZXF1aXJlZCB0byBjYWxsIHFlbXVzCj4gInhlbi1zYXZlLWRldmljZXMtc3RhdGUiIG1ldGhvZC4g
V2l0aG91dCBpdCwgdGhlIHJlY2VpdmluZyBzaWRlIG9mIGEgUFYgb3IKPiBQVkggbWlncmF0aW9u
IG1heSBiZSB1bmFibGUgdG8gbG9jayB0aGUgaW1hZ2U6Cj4gCj4geGVuIGJlOiBxZGlzay01MTcx
MjogeGVuIGJlOiBxZGlzay01MTcxMjogZXJyb3I6IEZhaWxlZCB0byBnZXQgIndyaXRlIiBsb2Nr
Cj4gZXJyb3I6IEZhaWxlZCB0byBnZXQgIndyaXRlIiBsb2NrCj4geGVuIGJlOiBxZGlzay01MTcx
MjogeGVuIGJlOiBxZGlzay01MTcxMjogaW5pdGlhbGlzZSgpIGZhaWxlZAo+IGluaXRpYWxpc2Uo
KSBmYWlsZWQKPiAKPiBUbyBmaXggdGhpcyBidWcsIGxpYnhsX19kb21haW5fc3VzcGVuZF9kZXZp
Y2VfbW9kZWwoKSBhbmQKPiBsaWJ4bF9fZG9tYWluX3Jlc3VtZV9kZXZpY2VfbW9kZWwoKSBoYXZl
IHRvIGJlIGNhbGxlZCBub3Qgb25seSBmb3IgSFZNLAo+IGJ1dCBhbHNvIGlmIHRoZSBhY3RpdmUg
ZGV2aWNlX21vZGVsIGlzIFFFTVVfWEVOLgo+IAo+IFVuZm9ydHVuYXRlbHksIGxpYnhsX19kb21h
aW5fYnVpbGRfaW5mb19zZXRkZWZhdWx0KCkgaGFyZGNvZGVzCj4gYl9pbmZvLT5kZXZpY2VfbW9k
ZWxfdmVyc2lvbiB0byBRRU1VX1hFTiBpZiBpdCBkb2VzIG5vdCBrbm93IGl0IGFueQo+IGJldHRl
ci4gVGhpcyBicmVha3MgZG9tVXMgd2l0aG91dCBhIGRldmljZV9tb2RlbC4gbGlieGxfX3FtcF9z
dG9wKCkgd291bGQKPiB3YWl0IDEwIHNlY29uZHMgaW4gcW1wX29wZW4oKSBmb3IgYSBxZW11IHRo
YXQgd2lsbCBuZXZlciBhcHBlYXIuICBEdXJpbmcKPiB0aGlzIGxvbmcgdGltZWZyYW1lIHRoZSBk
b21VIHJlbWFpbnMgaW4gc3RhdGUgcGF1c2VkIG9uIHRoZSBzZW5kaW5nIHNpZGUuCj4gQXMgYSBy
ZXN1bHQgbmV0d29yayBjb25uZWN0aW9ucyBtYXkgYmUgZHJvcHBlZC4gT25jZSB0aGlzIGJ1ZyBp
cyBmaXhlZCBhcwo+IHdlbGwsIGJ5IGp1c3QgcmVtb3ZpbmcgdGhhdCBhc3N1bXB0aW9uLCB0aGVy
ZSBpcyBubyBjb2RlIHRvIGFjdHVhbGx5Cj4gaW5pdGlhbGlzZSBiX2luZm8tPmRldmljZV9tb2Rl
bF92ZXJzaW9uLgo+IAo+IFRoZXJlIGlzIGEgaGVscGVyIGZ1bmN0aW9uIGxpYnhsX19uZWVkX3hl
bnB2X3FlbXUoKSwgd2hpY2ggaXMgdXNlZCBpbgo+IHZhcmlvdXMgcGxhY2VzIHRvIGRlY2lkZSBp
ZiBhbnkgZGV2aWNlX21vZGVsIGhhcyB0byBiZSBzcGF3bmVkLiBUaGlzCj4gZnVuY3Rpb24gY2Fu
IG5vdCBiZSB1c2VkIGFzIGlzLCBqdXN0IHRvIGZpbGwgYl9pbmZvLT5kZXZpY2VfbW9kZWxfdmVy
c2lvbiwKPiBiZWNhdXNlIHN0b3JlX2xpYnhsX2VudHJ5KCkgd2FzIGFscmVhZHkgY2FsbGVkIGVh
cmxpZXIuIFVwZGF0ZSB0aGlzCj4gZnVuY3Rpb24gdG8gcmVjZWl2ZSBhIGRvbWlkIHRvIHdvcmsg
d2l0aCwgaW5zdGVhZCBvZiByZWFkaW5nIHhlbnN0b3JlLgoKSSBoYXZlIHRvIGFkbWl0IEknbSBu
b3QgdGhhdCBmYW1pbGlhciB3aXRoIHRoZSBtaWdyYXRpb24gY29kZSwgYW5kCml0J3MgZmFpcmx5
IGNvbXBsZXgsIHNvIHRha2UgdGhpcyB3aXRoIGEgcGluY2ggb2Ygc2FsdC4KCldvdWxkbid0IGl0
IGJlIGVhc2llciB0byBsZWF2ZSBsaWJ4bF9fbmVlZF94ZW5wdl9xZW11IGFsb25lIGFuZCBqdXN0
CnVzZSB0aGUgY29udGVudHMgb2YgdGhlIG1pZ3JhdGlvbiBzdHJlYW0gdG8gZGVjaWRlIHdoZXRo
ZXIgdG8gbGF1bmNoIGEKUUVNVSBmb3IgdGhlIFBWIGJhY2tlbmRzIG9yIG5vdD8gaWU6IGp1c3Qg
cGFyc2luZyB0aGUgZG9tYWluIGNvbmZpZyBvbgp0aGUgbWlncmF0aW9uIHN0cmVhbSBzaG91bGQg
YmUgZW5vdWdoIGZvciB0aGUgZGVzdGluYXRpb24gc2lkZSB0bwpkZWNpZGUgd2hldGhlciBhIFFF
TVUgaXMgbmVlZGVkIGluIG9yZGVyIHRvIGhhbmRsZSB0aGUgUFYgYmFja2VuZHM/Cgo+IFJlYXJy
YW5nZSB0aGUgY29kZSBhbmQgaW5pdGlhbGl6ZSBiX2luZm8tPmRldmljZV9tb2RlbF92ZXJzaW9u
IGluCj4gbGlieGxfX2RvbWFpbl9idWlsZF9pbmZvX3NldGRlZmF1bHQoKSBwZXIgRE9NQUlOX1RZ
UEUuCj4gCj4gVXBkYXRlIGluaXRpYXRlX2RvbWFpbl9jcmVhdGUoKSB0byBzZXQgYl9pbmZvLT5k
ZXZpY2VfbW9kZWxfdmVyc2lvbiBpZiBpdAo+IHdhcyBub3Qgc2V0IGVhcmxpZXIsIHVzaW5nIHRo
ZSB1cGRhdGVkIGxpYnhsX19uZWVkX3hlbnB2X3FlbXUoKS4KPiAKPiBJbnRyb2R1Y2UgTElCWExf
REVWSUNFX01PREVMX1ZFUlNJT05fTk9ORV9SRVFVSVJFRCBmb3IgUFYgYW5kIFBWSCB0aGF0Cj4g
aGF2ZSBubyBuZWVkIGZvciBhIGRldmljZV9tb2RlbC4KPiAKPiBVcGRhdGUgZXhpc3RpbmcgdXNl
cnMgb2YgbGlieGxfX25lZWRfeGVucHZfcWVtdSgpIHRvIHVzZQo+IGJfaW5mby0+ZGV2aWNlX21v
ZGVsX3ZlcnNpb24gZm9yIHRoZWlyIGNoZWNrIGlmIGEgZGV2aWNlX21vZGVsIGlzIG5lZWRlZC4K
PiAKPiB2MDI6Cj4gLSB1cGRhdGUgd29yZGluZyBpbiBhIGNvbW1lbnQKPiAtIHJlbW92ZSBzdGFs
ZSBnb3RvIGluIGRvbWNyZWF0ZV9sYXVuY2hfZG0KPiAtIGluaXRpYWxpemUgcmV0IGluIGxpYnhs
X19uZWVkX3hlbnB2X3FlbXUKPiAKPiBTaWduZWQtb2ZmLWJ5OiBPbGFmIEhlcmluZyA8b2xhZkBh
ZXBmbGUuZGU+Cj4gQ2M6IFJvZ2VyIFBhdSBNb25uw6kgPHJvZ2VyLnBhdUBjaXRyaXguY29tPgo+
IENjOiBBbnRob255IFBFUkFSRCA8YW50aG9ueS5wZXJhcmRAY2l0cml4LmNvbT4KPiAtLS0KPiAg
dG9vbHMvbGlieGwvbGlieGxfY3JlYXRlLmMgICAgICB8IDM5ICsrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKystLS0tLS0tLQo+ICB0b29scy9saWJ4bC9saWJ4bF9kbS5jICAgICAgICAgIHwg
NDAgKysrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLQo+ICB0b29scy9saWJ4
bC9saWJ4bF9kb21fc3VzcGVuZC5jIHwgIDggKysrKysrLS0KPiAgdG9vbHMvbGlieGwvbGlieGxf
aW50ZXJuYWwuaCAgICB8ICAzICsrLQo+ICB0b29scy9saWJ4bC9saWJ4bF90eXBlcy5pZGwgICAg
IHwgIDEgKwo+ICA1IGZpbGVzIGNoYW5nZWQsIDYzIGluc2VydGlvbnMoKyksIDI4IGRlbGV0aW9u
cygtKQo+IAo+IGRpZmYgLS1naXQgYS90b29scy9saWJ4bC9saWJ4bF9jcmVhdGUuYyBiL3Rvb2xz
L2xpYnhsL2xpYnhsX2NyZWF0ZS5jCj4gaW5kZXggODlmZTgwZmM5Yy4uMTUwYWIwMjM1NCAxMDA2
NDQKPiAtLS0gYS90b29scy9saWJ4bC9saWJ4bF9jcmVhdGUuYwo+ICsrKyBiL3Rvb2xzL2xpYnhs
L2xpYnhsX2NyZWF0ZS5jCj4gQEAgLTg3LDE2ICs4NywyMCBAQCBpbnQgbGlieGxfX2RvbWFpbl9i
dWlsZF9pbmZvX3NldGRlZmF1bHQobGlieGxfX2djICpnYywKPiAgICAgICAgICBiX2luZm8tPmRl
dmljZV9tb2RlbF9zc2lkcmVmID0gU0VDSU5JVFNJRF9ET01ETTsKPiAgCj4gICAgICBpZiAoIWJf
aW5mby0+ZGV2aWNlX21vZGVsX3ZlcnNpb24pIHsKPiAtICAgICAgICBpZiAoYl9pbmZvLT50eXBl
ID09IExJQlhMX0RPTUFJTl9UWVBFX0hWTSkgewo+ICsgICAgICAgIHN3aXRjaCAoYl9pbmZvLT50
eXBlKSB7Cj4gKyAgICAgICAgY2FzZSBMSUJYTF9ET01BSU5fVFlQRV9IVk06Cj4gICAgICAgICAg
ICAgIGlmIChsaWJ4bF9kZWZib29sX3ZhbChiX2luZm8tPmRldmljZV9tb2RlbF9zdHViZG9tYWlu
KSkgewo+ICAgICAgICAgICAgICAgICAgYl9pbmZvLT5kZXZpY2VfbW9kZWxfdmVyc2lvbiA9Cj4g
ICAgICAgICAgICAgICAgICAgICAgTElCWExfREVWSUNFX01PREVMX1ZFUlNJT05fUUVNVV9YRU5f
VFJBRElUSU9OQUw7Cj4gICAgICAgICAgICAgIH0gZWxzZSB7Cj4gICAgICAgICAgICAgICAgICBi
X2luZm8tPmRldmljZV9tb2RlbF92ZXJzaW9uID0gbGlieGxfX2RlZmF1bHRfZGV2aWNlX21vZGVs
KGdjKTsKPiAgICAgICAgICAgICAgfQo+IC0gICAgICAgIH0gZWxzZSB7Cj4gLSAgICAgICAgICAg
IGJfaW5mby0+ZGV2aWNlX21vZGVsX3ZlcnNpb24gPQo+IC0gICAgICAgICAgICAgICAgTElCWExf
REVWSUNFX01PREVMX1ZFUlNJT05fUUVNVV9YRU47Cj4gKyAgICAgICAgICAgIGJyZWFrOwo+ICsg
ICAgICAgIGNhc2UgTElCWExfRE9NQUlOX1RZUEVfUFY6Cj4gKyAgICAgICAgY2FzZSBMSUJYTF9E
T01BSU5fVFlQRV9QVkg6Cj4gKyAgICAgICAgZGVmYXVsdDoKPiArICAgICAgICAgICAgLyogbWF5
IGJlIHNldCBsYXRlciAqLwo+ICsgICAgICAgICAgICBicmVhazsKCklzIGl0IHJlYWxseSB3b3J0
aCBpdCB0byBjaGFuZ2UgdGhlIGlmIGludG8gYSBzd2l0Y2g/IEFGQUlDVCBpdCB3b3VsZApiZSBz
aW1wbGVyIHRvIGp1c3QgcmVtb3ZlIHRoZSBlbHNlIGJyYW5jaCBmcm9tIHRoZSBleGlzdGluZyBp
Zi4KCj4gICAgICAgICAgfQo+ICAgICAgICAgIGlmIChiX2luZm8tPmRldmljZV9tb2RlbF92ZXJz
aW9uCj4gICAgICAgICAgICAgICAgICA9PSBMSUJYTF9ERVZJQ0VfTU9ERUxfVkVSU0lPTl9RRU1V
X1hFTikgewo+IEBAIC05NzgsNiArOTgyLDE3IEBAIHN0YXRpYyB2b2lkIGluaXRpYXRlX2RvbWFp
bl9jcmVhdGUobGlieGxfX2VnYyAqZWdjLAo+ICAgICAgICAgIGdvdG8gZXJyb3Jfb3V0Owo+ICAg
ICAgfQo+ICAKPiArICAgIGlmIChkX2NvbmZpZy0+Yl9pbmZvLmRldmljZV9tb2RlbF92ZXJzaW9u
Cj4gKyAgICAgICAgPT0gTElCWExfREVWSUNFX01PREVMX1ZFUlNJT05fVU5LTk9XTikgewo+ICsg
ICAgICAgIHJldCA9IGxpYnhsX19uZWVkX3hlbnB2X3FlbXUoZ2MsIGRfY29uZmlnLCBkb21pZCk7
CgpJIHRoaW5rIHRoZSBhYm92ZSBjYWxsIGlzIHdyb25nLCBsaWJ4bF9fbmVlZF94ZW5wdl9xZW11
IGV4cGVjdHMgdG8gZ2V0CnRoZSBkb21pZCBvZiB0aGUgdG9vbHN0YWNrIGRvbWFpbiAoaWU6IHRo
ZSBkb21haW4gcnVubmluZyB0aGlzIGNvZGUpLApub3QgdGhlIGRvbWFpbiBiZWluZyBjcmVhdGVk
LgoKPiArICAgICAgICBpZiAocmV0KQo+ICsgICAgICAgICAgICBkX2NvbmZpZy0+Yl9pbmZvLmRl
dmljZV9tb2RlbF92ZXJzaW9uID0KPiArICAgICAgICAgICAgICAgIExJQlhMX0RFVklDRV9NT0RF
TF9WRVJTSU9OX1FFTVVfWEVOOwo+ICsgICAgICAgIGVsc2UKPiArICAgICAgICAgICAgZF9jb25m
aWctPmJfaW5mby5kZXZpY2VfbW9kZWxfdmVyc2lvbiA9Cj4gKyAgICAgICAgICAgICAgICBMSUJY
TF9ERVZJQ0VfTU9ERUxfVkVSU0lPTl9OT05FX1JFUVVJUkVEOwo+ICsgICAgfQo+ICsKPiAgICAg
IGRjcy0+Z3Vlc3RfZG9taWQgPSBkb21pZDsKPiAgICAgIGRjcy0+c2Rzcy5kbS5ndWVzdF9kb21p
ZCA9IDA7IC8qIG1lYW5zIHdlIGhhdmVuJ3Qgc3Bhd25lZCAqLwo+ICAKPiBAQCAtMTMxMiw2ICsx
MzI3LDcgQEAgc3RhdGljIHZvaWQgZG9tY3JlYXRlX2xhdW5jaF9kbShsaWJ4bF9fZWdjICplZ2Ms
IGxpYnhsX19tdWx0aWRldiAqbXVsdGlkZXYsCj4gICAgICBsaWJ4bF9fZG9tYWluX2NyZWF0ZV9z
dGF0ZSAqZGNzID0gQ09OVEFJTkVSX09GKG11bHRpZGV2LCAqZGNzLCBtdWx0aWRldik7Cj4gICAg
ICBTVEFURV9BT19HQyhkY3MtPmFvKTsKPiAgICAgIGludCBpOwo+ICsgICAgYm9vbCBuZWVkX3Fl
bXU7Cj4gIAo+ICAgICAgLyogY29udmVuaWVuY2UgYWxpYXNlcyAqLwo+ICAgICAgY29uc3QgdWlu
dDMyX3QgZG9taWQgPSBkY3MtPmd1ZXN0X2RvbWlkOwo+IEBAIC0xNDY0LDEwICsxNDgwLDE3IEBA
IHN0YXRpYyB2b2lkIGRvbWNyZWF0ZV9sYXVuY2hfZG0obGlieGxfX2VnYyAqZWdjLCBsaWJ4bF9f
bXVsdGlkZXYgKm11bHRpZGV2LAo+ICAgICAgICAgIGxpYnhsX19kZXZpY2VfY29uc29sZV9hZGQo
Z2MsIGRvbWlkLCAmY29uc29sZSwgc3RhdGUsICZkZXZpY2UpOwo+ICAgICAgICAgIGxpYnhsX19k
ZXZpY2VfY29uc29sZV9kaXNwb3NlKCZjb25zb2xlKTsKPiAgCj4gLSAgICAgICAgcmV0ID0gbGli
eGxfX25lZWRfeGVucHZfcWVtdShnYywgZF9jb25maWcpOwo+IC0gICAgICAgIGlmIChyZXQgPCAw
KQo+IC0gICAgICAgICAgICBnb3RvIGVycm9yX291dDsKPiAtICAgICAgICBpZiAocmV0KSB7Cj4g
KyAgICAgICAgc3dpdGNoIChkX2NvbmZpZy0+Yl9pbmZvLmRldmljZV9tb2RlbF92ZXJzaW9uKSB7
Cj4gKyAgICAgICAgICAgIGNhc2UgTElCWExfREVWSUNFX01PREVMX1ZFUlNJT05fUUVNVV9YRU5f
VFJBRElUSU9OQUw6Cj4gKyAgICAgICAgICAgIGNhc2UgTElCWExfREVWSUNFX01PREVMX1ZFUlNJ
T05fUUVNVV9YRU46Cj4gKyAgICAgICAgICAgICAgICBuZWVkX3FlbXUgPSB0cnVlOwo+ICsgICAg
ICAgICAgICAgICAgYnJlYWs7Cj4gKyAgICAgICAgICAgIGRlZmF1bHQ6Cj4gKyAgICAgICAgICAg
ICAgICBuZWVkX3FlbXUgPSBmYWxzZTsKPiArICAgICAgICAgICAgICAgIGJyZWFrOwoKQUZBSUNU
IGF0IHRoaXMgcG9pbnQgZGV2aWNlX21vZGVsX3ZlcnNpb24gd2lsbCBlaXRoZXIgYmUgc2V0IHRv
IG9uZSBvZgp0aGUgdmVyc2lvbnMgKGVpdGhlciB0cmFkIG9yIHVwc3RyZWFtKSBvciB0byBub25l
LiBTbyB5b3UKY291bGQgaW5pdGlhbGl6ZSBuZWVkX3FlbXUgdG8gZmFsc2UgYW5kIHNldCBpZiB0
byB0cnVlIGlmCmRldmljZV9tb2RlbF92ZXJzaW9uICE9IExJQlhMX0RFVklDRV9NT0RFTF9WRVJT
SU9OX05PTkVfUkVRVUlSRUQuCgo+ICsgICAgICAgIH0KPiArCj4gKyAgICAgICAgaWYgKG5lZWRf
cWVtdSkgewo+ICAgICAgICAgICAgICBkY3MtPnNkc3MuZG0uZ3Vlc3RfZG9taWQgPSBkb21pZDsK
PiAgICAgICAgICAgICAgbGlieGxfX3NwYXduX2xvY2FsX2RtKGVnYywgJmRjcy0+c2Rzcy5kbSk7
Cj4gICAgICAgICAgICAgIHJldHVybjsKPiBkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGlieGxf
ZG0uYyBiL3Rvb2xzL2xpYnhsL2xpYnhsX2RtLmMKPiBpbmRleCAyZjE5Nzg2YmRkLi5iYWIwNGFi
MTk2IDEwMDY0NAo+IC0tLSBhL3Rvb2xzL2xpYnhsL2xpYnhsX2RtLmMKPiArKysgYi90b29scy9s
aWJ4bC9saWJ4bF9kbS5jCj4gQEAgLTIyNjgsNyArMjI2OCw3IEBAIHN0YXRpYyB2b2lkIHNwYXdu
X3N0dWJfbGF1bmNoX2RtKGxpYnhsX19lZ2MgKmVnYywKPiAgICAgIGxpYnhsX19kb21haW5fYnVp
bGRfc3RhdGUgKmNvbnN0IGRfc3RhdGUgPSBzZHNzLT5kbS5idWlsZF9zdGF0ZTsKPiAgICAgIGxp
YnhsX19kb21haW5fYnVpbGRfc3RhdGUgKmNvbnN0IHN0dWJkb21fc3RhdGUgPSAmc2Rzcy0+ZG1f
c3RhdGU7Cj4gICAgICB1aW50MzJfdCBkbV9kb21pZCA9IHNkc3MtPnB2cWVtdS5ndWVzdF9kb21p
ZDsKPiAtICAgIGludCBuZWVkX3FlbXU7Cj4gKyAgICBib29sIG5lZWRfcWVtdTsKPiAgCj4gICAg
ICBpZiAocmV0KSB7Cj4gICAgICAgICAgTE9HRChFUlJPUiwgZ3Vlc3RfZG9taWQsICJlcnJvciBj
b25uZWN0aW5nIGRpc2sgZGV2aWNlcyIpOwo+IEBAIC0yMzM3LDcgKzIzMzcsMTUgQEAgc3RhdGlj
IHZvaWQgc3Bhd25fc3R1Yl9sYXVuY2hfZG0obGlieGxfX2VnYyAqZWdjLAo+ICAgICAgICAgIH0K
PiAgICAgIH0KPiAgCj4gLSAgICBuZWVkX3FlbXUgPSBsaWJ4bF9fbmVlZF94ZW5wdl9xZW11KGdj
LCBkbV9jb25maWcpOwo+ICsgICAgc3dpdGNoIChkbV9jb25maWctPmJfaW5mby5kZXZpY2VfbW9k
ZWxfdmVyc2lvbikgewo+ICsgICAgICAgIGNhc2UgTElCWExfREVWSUNFX01PREVMX1ZFUlNJT05f
UUVNVV9YRU5fVFJBRElUSU9OQUw6Cj4gKyAgICAgICAgY2FzZSBMSUJYTF9ERVZJQ0VfTU9ERUxf
VkVSU0lPTl9RRU1VX1hFTjoKPiArICAgICAgICAgICAgbmVlZF9xZW11ID0gdHJ1ZTsKPiArICAg
ICAgICAgICAgYnJlYWs7Cj4gKyAgICAgICAgZGVmYXVsdDoKPiArICAgICAgICAgICAgbmVlZF9x
ZW11ID0gZmFsc2U7Cj4gKyAgICAgICAgICAgIGJyZWFrOwo+ICsgICAgfQo+ICAKPiAgICAgIGZv
ciAoaSA9IDA7IGkgPCBudW1fY29uc29sZTsgaSsrKSB7Cj4gICAgICAgICAgbGlieGxfX2Rldmlj
ZSBkZXZpY2U7Cj4gQEAgLTMxNzUsMTggKzMxODMsMTEgQEAgc3RhdGljIHZvaWQga2lsbF9kZXZp
Y2VfbW9kZWxfdWlkX2NiKGxpYnhsX19lZ2MgKmVnYywKPiAgfQo+ICAKPiAgLyogUmV0dXJuIDAg
aWYgbm8gZG0gbmVlZGVkLCAxIGlmIG5lZWRlZCBhbmQgPDAgaWYgZXJyb3IuICovCj4gLWludCBs
aWJ4bF9fbmVlZF94ZW5wdl9xZW11KGxpYnhsX19nYyAqZ2MsIGxpYnhsX2RvbWFpbl9jb25maWcg
KmRfY29uZmlnKQo+ICtpbnQgbGlieGxfX25lZWRfeGVucHZfcWVtdShsaWJ4bF9fZ2MgKmdjLCBs
aWJ4bF9kb21haW5fY29uZmlnICpkX2NvbmZpZywgdWludDMyX3QgZG9taWQpCj4gIHsKPiAtICAg
IGludCBpZHgsIGksIHJldCwgbnVtOwo+IC0gICAgdWludDMyX3QgZG9taWQ7Cj4gKyAgICBpbnQg
aWR4LCBpLCByZXQgPSAwLCBudW07Cj4gICAgICBjb25zdCBzdHJ1Y3QgbGlieGxfZGV2aWNlX3R5
cGUgKmR0Owo+ICAKPiAtICAgIHJldCA9IGxpYnhsX19nZXRfZG9taWQoZ2MsICZkb21pZCk7Cj4g
LSAgICBpZiAocmV0KSB7Cj4gLSAgICAgICAgTE9HKEVSUk9SLCAidW5hYmxlIHRvIGdldCBkb21h
aW4gaWQiKTsKPiAtICAgICAgICBnb3RvIG91dDsKPiAtICAgIH0KClRoZSBhYm92ZSBjYWxscyBn
ZXRzIHRoZSBkb21pZCBvZiB0aGUgY3VycmVudCBkb21haW4gcnVubmluZyB0aGlzIGNvZGUKKHRo
ZSB0b29sc3RhY2sgZG9tYWluKSwgbm90IHRoZSBkb21haW4gYmVpbmcgY3JlYXRlZC4KCj4gLQo+
ICAgICAgaWYgKGRfY29uZmlnLT5udW1fdmZicyA+IDAgfHwgZF9jb25maWctPm51bV9wOXMgPiAw
KSB7Cj4gICAgICAgICAgcmV0ID0gMTsKPiAgICAgICAgICBnb3RvIG91dDsKPiBAQCAtMzIzOCwy
MSArMzIzOSwyNiBAQCBpbnQgbGlieGxfX2RtX2NoZWNrX3N0YXJ0KGxpYnhsX19nYyAqZ2MsIGxp
YnhsX2RvbWFpbl9jb25maWcgKmRfY29uZmlnLAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHVpbnQzMl90IGRvbWlkKQo+ICB7Cj4gICAgICBpbnQgcmM7Cj4gKyAgICBib29sIG5lZWRfcWVt
dTsKPiAgCj4gICAgICBpZiAobGlieGxfX2RtX2FjdGl2ZShnYywgZG9taWQpKQo+ICAgICAgICAg
IHJldHVybiAwOwo+ICAKPiAtICAgIHJjID0gbGlieGxfX25lZWRfeGVucHZfcWVtdShnYywgZF9j
b25maWcpOwo+IC0gICAgaWYgKHJjIDwgMCkKPiAtICAgICAgICBnb3RvIG91dDsKPiAtCj4gLSAg
ICBpZiAoIXJjKQo+ICsgICAgc3dpdGNoIChkX2NvbmZpZy0+Yl9pbmZvLmRldmljZV9tb2RlbF92
ZXJzaW9uKSB7Cj4gKyAgICAgICAgY2FzZSBMSUJYTF9ERVZJQ0VfTU9ERUxfVkVSU0lPTl9RRU1V
X1hFTl9UUkFESVRJT05BTDoKPiArICAgICAgICBjYXNlIExJQlhMX0RFVklDRV9NT0RFTF9WRVJT
SU9OX1FFTVVfWEVOOgo+ICsgICAgICAgICAgICBuZWVkX3FlbXUgPSB0cnVlOwo+ICsgICAgICAg
ICAgICBicmVhazsKPiArICAgICAgICBkZWZhdWx0Ogo+ICsgICAgICAgICAgICBuZWVkX3FlbXUg
PSBmYWxzZTsKPiArICAgICAgICAgICAgYnJlYWs7Cj4gKyAgICB9Cj4gKyAgICBpZiAobmVlZF9x
ZW11ID09IGZhbHNlKQo+ICAgICAgICAgIHJldHVybiAwOwo+ICAKPiAgICAgIExPR0QoRVJST1Is
IGRvbWlkLCAiZGV2aWNlIG1vZGVsIHJlcXVpcmVkIGJ1dCBub3QgcnVubmluZyIpOwo+ICAgICAg
cmMgPSBFUlJPUl9GQUlMOwo+ICAKPiAtb3V0Ogo+ICAgICAgcmV0dXJuIHJjOwo+ICB9Cj4gIAo+
IGRpZmYgLS1naXQgYS90b29scy9saWJ4bC9saWJ4bF9kb21fc3VzcGVuZC5jIGIvdG9vbHMvbGli
eGwvbGlieGxfZG9tX3N1c3BlbmQuYwo+IGluZGV4IGQxYWYzYTY1NzMuLmM0OTJmZTVkZDEgMTAw
NjQ0Cj4gLS0tIGEvdG9vbHMvbGlieGwvbGlieGxfZG9tX3N1c3BlbmQuYwo+ICsrKyBiL3Rvb2xz
L2xpYnhsL2xpYnhsX2RvbV9zdXNwZW5kLmMKPiBAQCAtMzc5LDcgKzM3OSw5IEBAIHN0YXRpYyB2
b2lkIGRvbWFpbl9zdXNwZW5kX2NvbW1vbl9ndWVzdF9zdXNwZW5kZWQobGlieGxfX2VnYyAqZWdj
LAo+ICAgICAgbGlieGxfX2V2X3hzd2F0Y2hfZGVyZWdpc3RlcihnYywgJmRzcHMtPmd1ZXN0X3dh
dGNoKTsKPiAgICAgIGxpYnhsX19ldl90aW1lX2RlcmVnaXN0ZXIoZ2MsICZkc3BzLT5ndWVzdF90
aW1lb3V0KTsKPiAgCj4gLSAgICBpZiAoZHNwcy0+dHlwZSA9PSBMSUJYTF9ET01BSU5fVFlQRV9I
Vk0pIHsKPiArICAgIGlmIChkc3BzLT50eXBlID09IExJQlhMX0RPTUFJTl9UWVBFX0hWTSB8fAo+
ICsgICAgICAgIGxpYnhsX19kZXZpY2VfbW9kZWxfdmVyc2lvbl9ydW5uaW5nKGdjLCBkc3BzLT5k
b21pZCkgPT0KPiArICAgICAgICBMSUJYTF9ERVZJQ0VfTU9ERUxfVkVSU0lPTl9RRU1VX1hFTikg
ewo+ICAgICAgICAgIGRzcHMtPmNhbGxiYWNrX2RldmljZV9tb2RlbF9kb25lID0gZG9tYWluX3N1
c3BlbmRfY29tbW9uX2RvbmU7Cj4gICAgICAgICAgbGlieGxfX2RvbWFpbl9zdXNwZW5kX2Rldmlj
ZV9tb2RlbChlZ2MsIGRzcHMpOyAvKiBtdXN0IGJlIGxhc3QgKi8KPiAgICAgICAgICByZXR1cm47
Cj4gQEAgLTQ1OSw3ICs0NjEsOSBAQCBpbnQgbGlieGxfX2RvbWFpbl9yZXN1bWUobGlieGxfX2dj
ICpnYywgdWludDMyX3QgZG9taWQsIGludCBzdXNwZW5kX2NhbmNlbCkKPiAgICAgICAgICBnb3Rv
IG91dDsKPiAgICAgIH0KPiAgCj4gLSAgICBpZiAodHlwZSA9PSBMSUJYTF9ET01BSU5fVFlQRV9I
Vk0pIHsKPiArICAgIGlmICh0eXBlID09IExJQlhMX0RPTUFJTl9UWVBFX0hWTSB8fAo+ICsgICAg
ICAgIGxpYnhsX19kZXZpY2VfbW9kZWxfdmVyc2lvbl9ydW5uaW5nKGdjLCBkb21pZCkgPT0KPiAr
ICAgICAgICBMSUJYTF9ERVZJQ0VfTU9ERUxfVkVSU0lPTl9RRU1VX1hFTikgewo+ICAgICAgICAg
IHJjID0gbGlieGxfX2RvbWFpbl9yZXN1bWVfZGV2aWNlX21vZGVsKGdjLCBkb21pZCk7Cj4gICAg
ICAgICAgaWYgKHJjKSB7Cj4gICAgICAgICAgICAgIExPR0QoRVJST1IsIGRvbWlkLCAiZmFpbGVk
IHRvIHJlc3VtZSBkZXZpY2UgbW9kZWw6JWQiLCByYyk7Cj4gZGlmZiAtLWdpdCBhL3Rvb2xzL2xp
YnhsL2xpYnhsX2ludGVybmFsLmggYi90b29scy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5oCj4gaW5k
ZXggNDRlMDIyMTI4NC4uOWViNDIxMWQ4NSAxMDA2NDQKPiAtLS0gYS90b29scy9saWJ4bC9saWJ4
bF9pbnRlcm5hbC5oCj4gKysrIGIvdG9vbHMvbGlieGwvbGlieGxfaW50ZXJuYWwuaAo+IEBAIC0x
ODE3LDcgKzE4MTcsOCBAQCBfaGlkZGVuIGludCBsaWJ4bF9fZG9tYWluX2J1aWxkKGxpYnhsX19n
YyAqZ2MsCj4gIF9oaWRkZW4gY29uc3QgY2hhciAqbGlieGxfX2RvbWFpbl9kZXZpY2VfbW9kZWwo
bGlieGxfX2djICpnYywKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGNvbnN0IGxpYnhsX2RvbWFpbl9idWlsZF9pbmZvICppbmZvKTsKPiAgX2hpZGRlbiBpbnQgbGli
eGxfX25lZWRfeGVucHZfcWVtdShsaWJ4bF9fZ2MgKmdjLAo+IC0gICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGxpYnhsX2RvbWFpbl9jb25maWcgKmRfY29uZmlnKTsKPiArICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ4bF9kb21haW5fY29uZmlnICpkX2NvbmZp
ZywKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCBkb21pZCk7
Cj4gIF9oaWRkZW4gYm9vbCBsaWJ4bF9fcXVlcnlfcWVtdV9iYWNrZW5kKGxpYnhsX19nYyAqZ2Ms
Cj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90IGRvbWlk
LAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCBiYWNr
ZW5kX2lkLAo+IGRpZmYgLS1naXQgYS90b29scy9saWJ4bC9saWJ4bF90eXBlcy5pZGwgYi90b29s
cy9saWJ4bC9saWJ4bF90eXBlcy5pZGwKPiBpbmRleCBjYjQ3MDJmZDdhLi43ZDc1YmQzODUwIDEw
MDY0NAo+IC0tLSBhL3Rvb2xzL2xpYnhsL2xpYnhsX3R5cGVzLmlkbAo+ICsrKyBiL3Rvb2xzL2xp
YnhsL2xpYnhsX3R5cGVzLmlkbAo+IEBAIC0xMDYsNiArMTA2LDcgQEAgbGlieGxfZGV2aWNlX21v
ZGVsX3ZlcnNpb24gPSBFbnVtZXJhdGlvbigiZGV2aWNlX21vZGVsX3ZlcnNpb24iLCBbCj4gICAg
ICAoMCwgIlVOS05PV04iKSwKPiAgICAgICgxLCAiUUVNVV9YRU5fVFJBRElUSU9OQUwiKSwgIyBI
aXN0b3JpY2FsIHFlbXUteGVuIGRldmljZSBtb2RlbCAocWVtdS1kbSkKPiAgICAgICgyLCAiUUVN
VV9YRU4iKSwgICAgICAgICAgICAgIyBVcHN0cmVhbSBiYXNlZCBxZW11LXhlbiBkZXZpY2UgbW9k
ZWwKPiArICAgICgzLCAiTk9ORV9SRVFVSVJFRCIpLAo+ICAgICAgXSkKPiAgCj4gIGxpYnhsX2Nv
bnNvbGVfdHlwZSA9IEVudW1lcmF0aW9uKCJjb25zb2xlX3R5cGUiLCBbCgpfX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0
Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qu
b3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

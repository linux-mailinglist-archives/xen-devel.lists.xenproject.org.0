Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 6EFDABFFC1
	for <lists+xen-devel@lfdr.de>; Fri, 27 Sep 2019 09:06:20 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iDkHT-00067M-6t; Fri, 27 Sep 2019 07:03:07 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=Rbpq=XW=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1iDkHR-00064y-CX
 for xen-devel@lists.xenproject.org; Fri, 27 Sep 2019 07:03:05 +0000
X-Inumbo-ID: 919739a1-e0f4-11e9-966c-12813bfff9fa
Received: from mx1.suse.de (unknown [195.135.220.15])
 by localhost (Halon) with ESMTPS
 id 919739a1-e0f4-11e9-966c-12813bfff9fa;
 Fri, 27 Sep 2019 07:01:10 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id D79E9B174;
 Fri, 27 Sep 2019 07:00:59 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Fri, 27 Sep 2019 09:00:21 +0200
Message-Id: <20190927070050.12405-18-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190927070050.12405-1-jgross@suse.com>
References: <20190927070050.12405-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v4 17/46] xen/sched: make credit2 scheduler vcpu
 agnostic.
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Dario Faggioli <dfaggioli@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

U3dpdGNoIGNyZWRpdDIgc2NoZWR1bGVyIGNvbXBsZXRlbHkgZnJvbSB2Y3B1IHRvIHNjaGVkX3Vu
aXQgdXNhZ2UuCgpBcyB3ZSBhcmUgdG91Y2hpbmcgbG90cyBvZiBsaW5lcyByZW1vdmUgc29tZSB3
aGl0ZSBzcGFjZSBhdCB0aGUgZW5kIG9mCnRoZSBsaW5lLCB0b28uCgpTaWduZWQtb2ZmLWJ5OiBK
dWVyZ2VuIEdyb3NzIDxqZ3Jvc3NAc3VzZS5jb20+ClJldmlld2VkLWJ5OiBEYXJpbyBGYWdnaW9s
aSA8ZGZhZ2dpb2xpQHN1c2UuY29tPgotLS0KIHhlbi9jb21tb24vc2NoZWRfY3JlZGl0Mi5jIHwg
ODIyICsrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogMSBmaWxl
IGNoYW5nZWQsIDQwNSBpbnNlcnRpb25zKCspLCA0MTcgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0
IGEveGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQyLmMgYi94ZW4vY29tbW9uL3NjaGVkX2NyZWRpdDIu
YwppbmRleCA3ZWM2MWEyNjQ5Li4zZWU3NjMyM2RmIDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL3Nj
aGVkX2NyZWRpdDIuYworKysgYi94ZW4vY29tbW9uL3NjaGVkX2NyZWRpdDIuYwpAQCAtNDUsNyAr
NDUsNyBAQAogI2RlZmluZSBUUkNfQ1NDSEVEMl9TQ0hFRF9UQVNLTEVUICAgIFRSQ19TQ0hFRF9D
TEFTU19FVlQoQ1NDSEVEMiwgOCkKICNkZWZpbmUgVFJDX0NTQ0hFRDJfVVBEQVRFX0xPQUQgICAg
ICBUUkNfU0NIRURfQ0xBU1NfRVZUKENTQ0hFRDIsIDkpCiAjZGVmaW5lIFRSQ19DU0NIRUQyX1JV
TlFfQVNTSUdOICAgICAgVFJDX1NDSEVEX0NMQVNTX0VWVChDU0NIRUQyLCAxMCkKLSNkZWZpbmUg
VFJDX0NTQ0hFRDJfVVBEQVRFX1ZDUFVfTE9BRCBUUkNfU0NIRURfQ0xBU1NfRVZUKENTQ0hFRDIs
IDExKQorI2RlZmluZSBUUkNfQ1NDSEVEMl9VUERBVEVfVU5JVF9MT0FEIFRSQ19TQ0hFRF9DTEFT
U19FVlQoQ1NDSEVEMiwgMTEpCiAjZGVmaW5lIFRSQ19DU0NIRUQyX1VQREFURV9SVU5RX0xPQUQg
VFJDX1NDSEVEX0NMQVNTX0VWVChDU0NIRUQyLCAxMikKICNkZWZpbmUgVFJDX0NTQ0hFRDJfVElD
S0xFX05FVyAgICAgICBUUkNfU0NIRURfQ0xBU1NfRVZUKENTQ0hFRDIsIDEzKQogI2RlZmluZSBU
UkNfQ1NDSEVEMl9SVU5RX01BWF9XRUlHSFQgIFRSQ19TQ0hFRF9DTEFTU19FVlQoQ1NDSEVEMiwg
MTQpCkBAIC03NCwxMyArNzQsMTMgQEAKICAqIERlc2lnbjoKICAqCiAgKiBWTXMgImJ1cm4iIGNy
ZWRpdHMgYmFzZWQgb24gdGhlaXIgd2VpZ2h0OyBoaWdoZXIgd2VpZ2h0IG1lYW5zCi0gKiBjcmVk
aXRzIGJ1cm4gbW9yZSBzbG93bHkuICBUaGUgaGlnaGVzdCB3ZWlnaHQgdmNwdSBidXJucyBjcmVk
aXRzIGF0CisgKiBjcmVkaXRzIGJ1cm4gbW9yZSBzbG93bHkuICBUaGUgaGlnaGVzdCB3ZWlnaHQg
dW5pdCBidXJucyBjcmVkaXRzIGF0CiAgKiBhIHJhdGUgb2YgMSBjcmVkaXQgcGVyIG5hbm9zZWNv
bmQuICBPdGhlcnMgYnVybiBwcm9wb3J0aW9uYWxseQogICogbW9yZS4KICAqCi0gKiB2Y3B1cyBh
cmUgaW5zZXJ0ZWQgaW50byB0aGUgcnVucXVldWUgYnkgY3JlZGl0IG9yZGVyLgorICogdW5pdHMg
YXJlIGluc2VydGVkIGludG8gdGhlIHJ1bnF1ZXVlIGJ5IGNyZWRpdCBvcmRlci4KICAqCi0gKiBD
cmVkaXRzIGFyZSAicmVzZXQiIHdoZW4gdGhlIG5leHQgdmNwdSBpbiB0aGUgcnVucXVldWUgaXMg
bGVzcyB0aGFuCisgKiBDcmVkaXRzIGFyZSAicmVzZXQiIHdoZW4gdGhlIG5leHQgdW5pdCBpbiB0
aGUgcnVucXVldWUgaXMgbGVzcyB0aGFuCiAgKiBvciBlcXVhbCB0byB6ZXJvLiAgQXQgdGhhdCBw
b2ludCwgZXZlcnlvbmUncyBjcmVkaXRzIGFyZSAiY2xpcHBlZCIKICAqIHRvIGEgc21hbGwgdmFs
dWUsIGFuZCBhIGZpeGVkIGNyZWRpdCBpcyBhZGRlZCB0byBldmVyeW9uZS4KICAqLwpAQCAtOTUs
MzMgKzk1LDMzIEBACiAgKiAgIGJlIGdpdmVuIGEgY2FwIG9mIDI1JTsgYSBkb21haW4gdGhhdCBt
dXN0IG5vdCB1c2UgbW9yZSB0aGFuIDErMS8yIG9mCiAgKiAgIHBoeXNpY2FsIENQVSB0aW1lLCB3
aWxsIGJlIGdpdmVuIGEgY2FwIG9mIDE1MCU7CiAgKgotICogLSBjYXBzIGFyZSBwZXItZG9tYWlu
IChub3QgcGVyLXZDUFUpLiBJZiBhIGRvbWFpbiBoYXMgb25seSAxIHZDUFUsIGFuZAotICogICBh
IDQwJSBjYXAsIHRoYXQgb25lIHZDUFUgd2lsbCB1c2UgNDAlIG9mIG9uZSBwQ1BVLiBJZiBhIHNv
bWFpbiBoYXMgNAotICogICB2Q1BVcywgYW5kIGEgMjAwJSBjYXAsIHRoZSBlcXVpdmFsZW50IG9m
IDEwMCUgdGltZSBvbiAyIHBDUFVzIHdpbGwgYmUKLSAqICAgc3BsaXQgYW1vbmcgdGhlIHYgdkNQ
VXMuIEhvdyBtdWNoIGVhY2ggb2YgdGhlIHZDUFVzIHdpbGwgYWN0dWFsbHkgZ2V0LAorICogLSBj
YXBzIGFyZSBwZXItZG9tYWluIChub3QgcGVyLXVuaXQpLiBJZiBhIGRvbWFpbiBoYXMgb25seSAx
IHVuaXQsIGFuZAorICogICBhIDQwJSBjYXAsIHRoYXQgb25lIHVuaXQgd2lsbCB1c2UgNDAlIG9m
IG9uZSBwQ1BVLiBJZiBhIHNvbWFpbiBoYXMgNAorICogICB1bml0cywgYW5kIGEgMjAwJSBjYXAs
IHRoZSBlcXVpdmFsZW50IG9mIDEwMCUgdGltZSBvbiAyIHBDUFVzIHdpbGwgYmUKKyAqICAgc3Bs
aXQgYW1vbmcgdGhlIHYgdW5pdHMuIEhvdyBtdWNoIGVhY2ggb2YgdGhlIHVuaXRzIHdpbGwgYWN0
dWFsbHkgZ2V0LAogICogICBkdXJpbmcgYW55IGdpdmVuIGludGVydmFsIG9mIHRpbWUsIGlzIHVu
c3BlY2lmaWVkIChhcyBpdCBkZXBlbmRzIG9uCiAgKiAgIHZhcmlvdXMgYXNwZWN0czogd29ya2xv
YWQsIHN5c3RlbSBsb2FkLCBldGMuKS4gRm9yIGluc3RhbmNlLCBpdCBpcwotICogICBwb3NzaWJs
ZSB0aGF0LCBkdXJpbmcgYSBnaXZlbiB0aW1lIGludGVydmFsLCAyIHZDUFVzIHVzZSAxMDAlIGVh
Y2gsCisgKiAgIHBvc3NpYmxlIHRoYXQsIGR1cmluZyBhIGdpdmVuIHRpbWUgaW50ZXJ2YWwsIDIg
dW5pdHMgdXNlIDEwMCUgZWFjaCwKICAqICAgYW5kIHRoZSBvdGhlciB0d28gdXNlIG5vdGhpbmc7
IHdoaWxlIGR1cmluZyBhbm90aGVyIHRpbWUgaW50ZXJ2YWwsCi0gKiAgIHR3byB2Q1BVcyB1c2Ug
ODAlLCBvbmUgdXNlcyAxMCUgYW5kIHRoZSBvdGhlciAzMCU7IG9yIHRoYXQgZWFjaCB1c2UKKyAq
ICAgdHdvIHVuaXRzIHVzZSA4MCUsIG9uZSB1c2VzIDEwJSBhbmQgdGhlIG90aGVyIDMwJTsgb3Ig
dGhhdCBlYWNoIHVzZQogICogICA1MCUgKGFuZCBzbyBvbiBhbmQgc28gZm9ydGgpLgogICoKICAq
IEZvciBpbXBsZW1lbnRpbmcgdGhpcywgd2UgdXNlIHRoZSBmb2xsb3dpbmcgYXBwcm9hY2g6CiAg
KgogICogLSBlYWNoIGRvbWFpbiBpcyBnaXZlbiBhICdidWRnZXQnLCBhbiBlYWNoIGRvbWFpbiBo
YXMgYSB0aW1lciwgd2hpY2gKICAqICAgcmVwbGVuaXNoZXMgdGhlIGRvbWFpbidzIGJ1ZGdldCBw
ZXJpb2RpY2FsbHkuIFRoZSBidWRnZXQgaXMgdGhlIGFtb3VudAotICogICBvZiB0aW1lIHRoZSB2
Q1BVcyBvZiB0aGUgZG9tYWluIGNhbiB1c2UgZXZlcnkgJ3BlcmlvZCc7CisgKiAgIG9mIHRpbWUg
dGhlIHVuaXRzIG9mIHRoZSBkb21haW4gY2FuIHVzZSBldmVyeSAncGVyaW9kJzsKICAqCiAgKiAt
IHRoZSBwZXJpb2QgaXMgQ1NDSEVEMl9CREdUX1JFUExfUEVSSU9ELCBhbmQgaXMgdGhlIHNhbWUg
Zm9yIGFsbCBkb21haW5zCiAgKiAgIChidXQgZWFjaCBkb21haW4gaGFzIGl0cyBvd24gdGltZXI7
IHNvIHRoZSBhbGwgYXJlIHBlcmlvZGljIGJ5IHRoZSBzYW1lCiAgKiAgIHBlcmlvZCwgYnV0IHJl
cGxlbmlzaG1lbnQgb2YgdGhlIGJ1ZGdldHMgb2YgdGhlIHZhcmlvdXMgZG9tYWlucywgYXQKICAq
ICAgcGVyaW9kcyBib3VuZGFyaWVzLCBhcmUgbm90IHN5bmNocm9ub3VzKTsKICAqCi0gKiAtIHdo
ZW4gdkNQVXMgcnVuLCB0aGV5IGNvbnN1bWUgYnVkZ2V0LiBXaGVuIHRoZXkgZG9uJ3QgcnVuLCB0
aGV5IGRvbid0Ci0gKiAgIGNvbnN1bWUgYnVkZ2V0LiBJZiB0aGVyZSBpcyBubyBidWRnZXQgbGVm
dCBmb3IgdGhlIGRvbWFpbiwgbm8gdkNQVSBvZgotICogICB0aGF0IGRvbWFpbiBjYW4gcnVuLiBJ
ZiBhIHZDUFUgdHJpZXMgdG8gcnVuIGFuZCBmaW5kcyB0aGF0IHRoZXJlIGlzIG5vCisgKiAtIHdo
ZW4gdW5pdHMgcnVuLCB0aGV5IGNvbnN1bWUgYnVkZ2V0LiBXaGVuIHRoZXkgZG9uJ3QgcnVuLCB0
aGV5IGRvbid0CisgKiAgIGNvbnN1bWUgYnVkZ2V0LiBJZiB0aGVyZSBpcyBubyBidWRnZXQgbGVm
dCBmb3IgdGhlIGRvbWFpbiwgbm8gdW5pdCBvZgorICogICB0aGF0IGRvbWFpbiBjYW4gcnVuLiBJ
ZiBhbiB1bml0IHRyaWVzIHRvIHJ1biBhbmQgZmluZHMgdGhhdCB0aGVyZSBpcyBubwogICogICBi
dWRnZXQsIGl0IGJsb2Nrcy4KLSAqICAgQXQgd2hhdGV2ZXIgdGltZSBhIHZDUFUgd2FudHMgdG8g
cnVuLCBpdCBtdXN0IGNoZWNrIHRoZSBkb21haW4ncyBidWRnZXQsCisgKiAgIEF0IHdoYXRldmVy
IHRpbWUgYW4gdW5pdCB3YW50cyB0byBydW4sIGl0IG11c3QgY2hlY2sgdGhlIGRvbWFpbidzIGJ1
ZGdldCwKICAqICAgYW5kIGlmIHRoZXJlIGlzIHNvbWUsIGl0IGNhbiB1c2UgaXQuCiAgKgogICog
LSBidWRnZXQgaXMgcmVwbGVuaXNoZWQgdG8gdGhlIHRvcCBvZiB0aGUgY2FwYWNpdHkgZm9yIHRo
ZSBkb21haW4gb25jZQpAQCAtMTI5LDM5ICsxMjksMzkgQEAKICAqICAgdGhvdWdoLCB0aGUgYnVk
Z2V0IGFmdGVyIGEgcmVwbGVuaXNobWVudCB3aWxsIGFsd2F5cyBiZSBhdCBtb3N0IGVxdWFsCiAg
KiAgIHRvIHRoZSB0b3RhbCBjYXBhY2lmeSBvZiB0aGUgZG9tYWluICgndG90X2J1ZGdldCcpOwog
ICoKLSAqIC0gd2hlbiBhIGJ1ZGdldCByZXBsZW5pc2htZW50IG9jY3VycywgaWYgdGhlcmUgYXJl
IHZDUFVzIHRoYXQgaGFkIGJlZW4KKyAqIC0gd2hlbiBhIGJ1ZGdldCByZXBsZW5pc2htZW50IG9j
Y3VycywgaWYgdGhlcmUgYXJlIHVuaXRzIHRoYXQgaGFkIGJlZW4KICAqICAgYmxvY2tlZCBiZWNh
dXNlIG9mIGxhY2sgb2YgYnVkZ2V0LCB0aGV5J2xsIGJlIHVuYmxvY2tlZCwgYW5kIHRoZXkgd2ls
bAogICogICAocG90ZW50aWFsbHkpIGJlIGFibGUgdG8gcnVuIGFnYWluLgogICoKICAqIEZpbmFs
bHksIHNvbWUgZXZlbiBtb3JlIGltcGxlbWVudGF0aW9uIHJlbGF0ZWQgZGV0YWlsOgogICoKLSAq
IC0gYnVkZ2V0IGlzIHN0b3JlZCBpbiBhIGRvbWFpbi13aWRlIHBvb2wuIHZDUFVzIG9mIHRoZSBk
b21haW4gdGhhdCB3YW50CisgKiAtIGJ1ZGdldCBpcyBzdG9yZWQgaW4gYSBkb21haW4td2lkZSBw
b29sLiBVbml0cyBvZiB0aGUgZG9tYWluIHRoYXQgd2FudAogICogICB0byBydW4gZ28gdG8gc3Vj
aCBwb29sLCBhbmQgZ3J1YiBzb21lLiBXaGVuIHRoZXkgZG8gc28sIHRoZSBhbW91bnQKICAqICAg
dGhleSBncmFiYmVkIGlzIF9pbW1lZGlhdGVseV8gcmVtb3ZlZCBmcm9tIHRoZSBwb29sLiBUaGlz
IGhhcHBlbnMgaW4KLSAqICAgdmNwdV9ncmFiX2J1ZGdldCgpOworICogICB1bml0X2dyYWJfYnVk
Z2V0KCk7CiAgKgotICogLSB3aGVuIHZDUFVzIHN0b3AgcnVubmluZywgaWYgdGhleSd2ZSBub3Qg
Y29uc3VtZWQgYWxsIHRoZSBidWRnZXQgdGhleQorICogLSB3aGVuIHVuaXRzIHN0b3AgcnVubmlu
ZywgaWYgdGhleSd2ZSBub3QgY29uc3VtZWQgYWxsIHRoZSBidWRnZXQgdGhleQogICogICB0b29r
LCB0aGUgbGVmdG92ZXIgaXMgcHV0IGJhY2sgaW4gdGhlIHBvb2wuIFRoaXMgaGFwcGVucyBpbgot
ICogICB2Y3B1X3JldHVybl9idWRnZXQoKTsKKyAqICAgdW5pdF9yZXR1cm5fYnVkZ2V0KCk7CiAg
KgotICogLSB0aGUgYWJvdmUgbWVhbnMgdGhhdCBhIHZDUFUgY2FuIGZpbmQgb3V0IHRoYXQgdGhl
cmUgaXMgbm8gYnVkZ2V0IGFuZAorICogLSB0aGUgYWJvdmUgbWVhbnMgdGhhdCBhbiB1bml0IGNh
biBmaW5kIG91dCB0aGF0IHRoZXJlIGlzIG5vIGJ1ZGdldCBhbmQKICAqICAgYmxvY2ssIG5vdCBv
bmx5IGlmIHRoZSBjYXAgaGFzIGFjdHVhbGx5IGJlZW4gcmVhY2hlZCAoZm9yIHRoaXMgcGVyaW9k
KSwKLSAqICAgYnV0IGFsc28gaWYgc29tZSBvdGhlciB2Q1BVcywgaW4gb3JkZXIgdG8gcnVuLCBo
YXZlIGdyYWJiZWQgYSBjZXJ0YWluCisgKiAgIGJ1dCBhbHNvIGlmIHNvbWUgb3RoZXIgdW5pdHMs
IGluIG9yZGVyIHRvIHJ1biwgaGF2ZSBncmFiYmVkIGEgY2VydGFpbgogICogICBxdW90YSBvZiBi
dWRnZXQsIG5vIG1hdHRlciB3aGV0aGVyIHRoZXkndmUgYWxyZWFkeSB1c2VkIGl0IGFsbCBvciBu
b3QuCi0gKiAgIEEgdkNQVSBibG9ja2luZyBiZWNhdXNlIChhbnkgZm9ybSBvZikgbGFjayBvZiBi
dWRnZXQgaXMgc2FpZCB0byBiZQotICogICAicGFya2VkIiwgYW5kIHN1Y2ggYmxvY2tpbmcgaGFw
cGVucyBpbiBwYXJrX3ZjcHUoKTsKKyAqICAgQW4gdW5pdCBibG9ja2luZyBiZWNhdXNlIChhbnkg
Zm9ybSBvZikgbGFjayBvZiBidWRnZXQgaXMgc2FpZCB0byBiZQorICogICAicGFya2VkIiwgYW5k
IHN1Y2ggYmxvY2tpbmcgaGFwcGVucyBpbiBwYXJrX3VuaXQoKTsKICAqCi0gKiAtIHdoZW4gYSB2
Q1BVIHN0b3BzIHJ1bm5pbmcsIGFuZCBwdXRzIGJhY2sgc29tZSBidWRnZXQgaW4gdGhlIGRvbWFp
biBwb29sLAorICogLSB3aGVuIGFuIHVuaXQgc3RvcHMgcnVubmluZywgYW5kIHB1dHMgYmFjayBz
b21lIGJ1ZGdldCBpbiB0aGUgZG9tYWluIHBvb2wsCiAgKiAgIHdlIG5lZWQgdG8gY2hlY2sgd2hl
dGhlciB0aGVyZSBpcyBzb21lb25lIHdoaWNoIGhhcyBiZWVuIHBhcmtlZCBhbmQgdGhhdAotICog
ICBjYW4gYmUgdW5wYXJrZWQuIFRoaXMgaGFwcGVucyBpbiB1bnBhcmtfcGFya2VkX3ZjcHVzKCks
IGNhbGxlZCBmcm9tCisgKiAgIGNhbiBiZSB1bnBhcmtlZC4gVGhpcyBoYXBwZW5zIGluIHVucGFy
a19wYXJrZWRfdW5pdHMoKSwgY2FsbGVkIGZyb20KICAqICAgY3NjaGVkMl9jb250ZXh0X3NhdmVk
KCk7CiAgKgogICogLSBvZiBjb3Vyc2UsIHVucGFya2luZyBoYXBwZW5zIGFsc28gYXMgYSBjb25z
ZXF1ZW5jZSBvZiB0aGUgZG9tYWluJ3MgYnVkZ2V0CiAgKiAgIGJlaW5nIHJlcGxlbmlzaGVkIGJ5
IHRoZSBwZXJpb2RpYyB0aW1lci4gVGhpcyBhbHNvIG9jY3VycyBieSBtZWFucyBvZgogICogICBj
YWxsaW5nIGNzY2hlZDJfY29udGV4dF9zYXZlZCgpIChidXQgZnJvbSByZXBsZW5pc2hfZG9tYWlu
X2J1ZGdldCgpKTsKICAqCi0gKiAtIHBhcmtlZCB2Q1BVcyBvZiBhIGRvbWFpbiBhcmUga2VwdCBp
biBhIChwZXItZG9tYWluKSBsaXN0LCBjYWxsZWQKLSAqICAgJ3BhcmtlZF92Y3B1cycpLiBNYW5p
cHVsYXRpb24gb2YgdGhlIGxpc3QgYW5kIG9mIHRoZSBkb21haW4td2lkZSBidWRnZXQKKyAqIC0g
cGFya2VkIHVuaXRzIG9mIGEgZG9tYWluIGFyZSBrZXB0IGluIGEgKHBlci1kb21haW4pIGxpc3Qs
IGNhbGxlZAorICogICAncGFya2VkX3VuaXRzJykuIE1hbmlwdWxhdGlvbiBvZiB0aGUgbGlzdCBh
bmQgb2YgdGhlIGRvbWFpbi13aWRlIGJ1ZGdldAogICogICBwb29sLCBtdXN0IG9jY3VyIG9ubHkg
d2hlbiBob2xkaW5nIHRoZSAnYnVkZ2V0X2xvY2snLgogICovCiAKQEAgLTE3NCw5ICsxNzQsOSBA
QAogICogICAgIHBjcHVfc2NoZWR1bGVfbG9jaygpIC8gdW5pdF9zY2hlZHVsZV9sb2NrKCkgKGFu
ZCBmcmllbmRzKSwKICAqICAgKiBhIGNwdSBtYXkgKHRyeSB0bykgdGFrZSBhICJyZW1vdGUiIHJ1
bnF1ZXVlIGxvY2ssIGUuZy4sIGZvcgogICogICAgIGxvYWQgYmFsYW5jaW5nOwotICogICsgc2Vy
aWFsaXplcyBydW5xdWV1ZSBvcGVyYXRpb25zIChyZW1vdmluZyBhbmQgaW5zZXJ0aW5nIHZjcHVz
KTsKKyAqICArIHNlcmlhbGl6ZXMgcnVucXVldWUgb3BlcmF0aW9ucyAocmVtb3ZpbmcgYW5kIGlu
c2VydGluZyB1bml0cyk7CiAgKiAgKyBwcm90ZWN0cyBydW5xdWV1ZS13aWRlIGRhdGEgaW4gY3Nj
aGVkMl9ydW5xdWV1ZV9kYXRhOwotICogICsgcHJvdGVjdHMgdmNwdSBwYXJhbWV0ZXJzIGluIGNz
Y2hlZDJfdW5pdCBmb3IgdGhlIHZjcHUgaW4gdGhlCisgKiAgKyBwcm90ZWN0cyB1bml0IHBhcmFt
ZXRlcnMgaW4gY3NjaGVkMl91bml0IGZvciB0aGUgdW5pdCBpbiB0aGUKICAqICAgIHJ1bnF1ZXVl
LgogICoKICAqIC0gUHJpdmF0ZSBzY2hlZHVsZXIgbG9jawpAQCAtMTkwLDggKzE5MCw4IEBACiAg
KiAgKyBpdCBpcyBwZXItZG9tYWluOwogICogICsgcHJvdGVjdHMsIGluIGRvbWFpbnMgdGhhdCBo
YXZlIGFuIHV0aWxpemF0aW9uIGNhcDsKICAqICAgKiBtYW5pcHVsYXRpb24gb2YgdGhlIHRvdGFs
IGJ1ZGdldCBvZiB0aGUgZG9tYWluIChhcyBpdCBpcyBzaGFyZWQKLSAqICAgICBhbW9uZyBhbGwg
dkNQVXMgb2YgdGhlIGRvbWFpbiksCi0gKiAgICogbWFuaXB1bGF0aW9uIG9mIHRoZSBsaXN0IG9m
IHZDUFVzIHRoYXQgYXJlIGJsb2NrZWQgd2FpdGluZyBmb3IKKyAqICAgICBhbW9uZyBhbGwgdW5p
dHMgb2YgdGhlIGRvbWFpbiksCisgKiAgICogbWFuaXB1bGF0aW9uIG9mIHRoZSBsaXN0IG9mIHVu
aXRzIHRoYXQgYXJlIGJsb2NrZWQgd2FpdGluZyBmb3IKICAqICAgICBzb21lIGJ1ZGdldCB0byBi
ZSBhdmFpbGFibGUuCiAgKgogICogLSBUeXBlOgpAQCAtMjI4LDkgKzIyOCw5IEBACiAgKi8KICNk
ZWZpbmUgQ1NDSEVEMl9DUkVESVRfSU5JVCAgICAgICAgICBNSUxMSVNFQ1MoMTApCiAvKgotICog
QW1vdW50IG9mIGNyZWRpdCB0aGUgaWRsZSB2Y3B1cyBoYXZlLiBJdCBuZXZlciBjaGFuZ2VzLCBh
cyBpZGxlCi0gKiB2Y3B1cyBkb2VzIG5vdCBjb25zdW1lIGNyZWRpdHMsIGFuZCBpdCBtdXN0IGJl
IGxvd2VyIHRoYW4gd2hhdGV2ZXIKLSAqIGFtb3VudCBvZiBjcmVkaXQgJ3JlZ3VsYXInIHZjcHUg
d291bGQgZW5kIHVwIHdpdGguCisgKiBBbW91bnQgb2YgY3JlZGl0IHRoZSBpZGxlIHVuaXRzIGhh
dmUuIEl0IG5ldmVyIGNoYW5nZXMsIGFzIGlkbGUKKyAqIHVuaXRzIGRvZXMgbm90IGNvbnN1bWUg
Y3JlZGl0cywgYW5kIGl0IG11c3QgYmUgbG93ZXIgdGhhbiB3aGF0ZXZlcgorICogYW1vdW50IG9m
IGNyZWRpdCAncmVndWxhcicgdW5pdCB3b3VsZCBlbmQgdXAgd2l0aC4KICAqLwogI2RlZmluZSBD
U0NIRUQyX0lETEVfQ1JFRElUICAgICAgICAgICgtKDFVPDwzMCkpCiAvKgpAQCAtMjQzLDkgKzI0
Myw5IEBACiAgKiBNSU5fVElNRVIuCiAgKi8KICNkZWZpbmUgQ1NDSEVEMl9NSUdSQVRFX1JFU0lT
VCAgICAgICAoKG9wdF9taWdyYXRlX3Jlc2lzdCkqTUlDUk9TRUNTKDEpKQotLyogSG93IG11Y2gg
dG8gImNvbXBlbnNhdGUiIGEgdmNwdSBmb3IgTDIgbWlncmF0aW9uLiAqLworLyogSG93IG11Y2gg
dG8gImNvbXBlbnNhdGUiIGFuIHVuaXQgZm9yIEwyIG1pZ3JhdGlvbi4gKi8KICNkZWZpbmUgQ1ND
SEVEMl9NSUdSQVRFX0NPTVBFTlNBVElPTiBNSUNST1NFQ1MoNTApCi0vKiBIb3cgdG9sZXJhbnQg
d2Ugc2hvdWxkIGJlIHdoZW4gcGVla2luZyBhdCBydW50aW1lIG9mIHZjcHVzIG9uIG90aGVyIGNw
dXMgKi8KKy8qIEhvdyB0b2xlcmFudCB3ZSBzaG91bGQgYmUgd2hlbiBwZWVraW5nIGF0IHJ1bnRp
bWUgb2YgdW5pdHMgb24gb3RoZXIgY3B1cyAqLwogI2RlZmluZSBDU0NIRUQyX1JBVEVMSU1JVF9U
SUNLTEVfVE9MRVJBTkNFIE1JQ1JPU0VDUyg1MCkKIC8qIFJlc2V0OiBWYWx1ZSBiZWxvdyB3aGlj
aCBjcmVkaXQgd2lsbCBiZSByZXNldC4gKi8KICNkZWZpbmUgQ1NDSEVEMl9DUkVESVRfUkVTRVQg
ICAgICAgICAwCkBAIC0yNTgsNyArMjU4LDcgQEAKICAqIEZsYWdzCiAgKi8KIC8qCi0gKiBDU0ZM
QUdfc2NoZWR1bGVkOiBJcyB0aGlzIHZjcHUgZWl0aGVyIHJ1bm5pbmcgb24sIG9yIGNvbnRleHQt
c3dpdGNoaW5nIG9mZiwKKyAqIENTRkxBR19zY2hlZHVsZWQ6IElzIHRoaXMgdW5pdCBlaXRoZXIg
cnVubmluZyBvbiwgb3IgY29udGV4dC1zd2l0Y2hpbmcgb2ZmLAogICogYSBwaHlzaWNhbCBjcHU/
CiAgKiArIEFjY2Vzc2VkIG9ubHkgd2l0aCBydW5xdWV1ZSBsb2NrIGhlbGQKICAqICsgU2V0IHdo
ZW4gY2hvc2VuIGFzIG5leHQgaW4gY3NjaGVkMl9zY2hlZHVsZSgpLgpAQCAtMjgwLDIxICsyODAs
MjEgQEAKICNkZWZpbmUgX19DU0ZMQUdfZGVsYXllZF9ydW5xX2FkZCAyCiAjZGVmaW5lIENTRkxB
R19kZWxheWVkX3J1bnFfYWRkICgxVTw8X19DU0ZMQUdfZGVsYXllZF9ydW5xX2FkZCkKIC8qCi0g
KiBDU0ZMQUdfcnVucV9taWdyYXRlX3JlcXVlc3Q6IFRoaXMgdmNwdSBpcyBiZWluZyBtaWdyYXRl
ZCBhcyBhIHJlc3VsdCBvZiBhCisgKiBDU0ZMQUdfcnVucV9taWdyYXRlX3JlcXVlc3Q6IFRoaXMg
dW5pdCBpcyBiZWluZyBtaWdyYXRlZCBhcyBhIHJlc3VsdCBvZiBhCiAgKiBjcmVkaXQyLWluaXRp
YXRlZCBydW5xIG1pZ3JhdGUgcmVxdWVzdDsgbWlncmF0ZSBpdCB0byB0aGUgcnVucXVldWUgaW5k
aWNhdGVkCi0gKiBpbiB0aGUgc3ZjIHN0cnVjdC4gCisgKiBpbiB0aGUgc3ZjIHN0cnVjdC4KICAq
LwogI2RlZmluZSBfX0NTRkxBR19ydW5xX21pZ3JhdGVfcmVxdWVzdCAzCiAjZGVmaW5lIENTRkxB
R19ydW5xX21pZ3JhdGVfcmVxdWVzdCAoMVU8PF9fQ1NGTEFHX3J1bnFfbWlncmF0ZV9yZXF1ZXN0
KQogLyoKLSAqIENTRkxBR192Y3B1X3lpZWxkOiB0aGlzIHZjcHUgd2FzIHJ1bm5pbmcsIGFuZCBo
YXMgY2FsbGVkIHZjcHVfeWllbGQoKS4gVGhlCisgKiBDU0ZMQUdfdW5pdF95aWVsZDogdGhpcyB1
bml0IHdhcyBydW5uaW5nLCBhbmQgaGFzIGNhbGxlZCB2Y3B1X3lpZWxkKCkuIFRoZQogICogc2No
ZWR1bGVyIGlzIGludm9rZWQgdG8gc2VlIGlmIHdlIGNhbiBnaXZlIHRoZSBjcHUgdG8gc29tZW9u
ZSBlbHNlLCBhbmQKLSAqIGdldCBiYWNrIHRvIHRoZSB5aWVsZGluZyB2Y3B1IGluIGEgd2hpbGUu
CisgKiBnZXQgYmFjayB0byB0aGUgeWllbGRpbmcgdW5pdCBpbiBhIHdoaWxlLgogICovCi0jZGVm
aW5lIF9fQ1NGTEFHX3ZjcHVfeWllbGQgNAotI2RlZmluZSBDU0ZMQUdfdmNwdV95aWVsZCAoMVU8
PF9fQ1NGTEFHX3ZjcHVfeWllbGQpCisjZGVmaW5lIF9fQ1NGTEFHX3VuaXRfeWllbGQgNAorI2Rl
ZmluZSBDU0ZMQUdfdW5pdF95aWVsZCAoMVU8PF9fQ1NGTEFHX3VuaXRfeWllbGQpCiAvKgotICog
Q1NGTEFHU19waW5uZWQ6IHRoaXMgdmNwdSBpcyBjdXJyZW50bHkgJ3Bpbm5lZCcsIGkuZS4sIGhh
cyBpdHMgaGFyZAorICogQ1NGTEFHU19waW5uZWQ6IHRoaXMgdW5pdCBpcyBjdXJyZW50bHkgJ3Bp
bm5lZCcsIGkuZS4sIGhhcyBpdHMgaGFyZAogICogYWZmaW5pdHkgc2V0IHRvIG9uZSBhbmQgb25s
eSAxIGNwdSAoYW5kLCBoZW5jZSwgY2FuIG9ubHkgcnVuIHRoZXJlKS4KICAqLwogI2RlZmluZSBf
X0NTRkxBR19waW5uZWQgNQpAQCAtMzA2LDcgKzMwNiw3IEBAIGludGVnZXJfcGFyYW0oInNjaGVk
X2NyZWRpdDJfbWlncmF0ZV9yZXNpc3QiLCBvcHRfbWlncmF0ZV9yZXNpc3QpOwogLyoKICAqIExv
YWQgdHJhY2tpbmcgYW5kIGxvYWQgYmFsYW5jaW5nCiAgKgotICogTG9hZCBoaXN0b3J5IG9mIHJ1
bnF1ZXVlcyBhbmQgdmNwdXMgaXMgYWNjb3VudGVkIGZvciBieSB1c2luZyBhbgorICogTG9hZCBo
aXN0b3J5IG9mIHJ1bnF1ZXVlcyBhbmQgdW5pdHMgaXMgYWNjb3VudGVkIGZvciBieSB1c2luZyBh
bgogICogZXhwb25lbnRpYWwgd2VpZ2h0ZWQgbW92aW5nIGF2ZXJhZ2UgYWxnb3JpdGhtLiBIb3dl
dmVyLCBpbnN0ZWFkIG9mIHVzaW5nCiAgKiBmcmFjdGlvbnMsd2Ugc2hpZnQgZXZlcnl0aGluZyB0
byBsZWZ0IGJ5IHRoZSBudW1iZXIgb2YgYml0cyB3ZSB3YW50IHRvCiAgKiB1c2UgZm9yIHJlcHJl
c2VudGluZyB0aGUgZnJhY3Rpb25hbCBwYXJ0IChRLWZvcm1hdCkuCkBAIC0zMjYsNyArMzI2LDcg
QEAgaW50ZWdlcl9wYXJhbSgic2NoZWRfY3JlZGl0Ml9taWdyYXRlX3Jlc2lzdCIsIG9wdF9taWdy
YXRlX3Jlc2lzdCk7CiAgKgogICogd2hlcmUgVyBpcyB0aGUgbGVuZ3RoIG9mIHRoZSB3aW5kb3cs
IFAgdGhlIG11bHRpcGxpZXIgZm9yIHRyYW5zaXRpb25nIGludG8KICAqIFEtZm9ybWF0IGZpeGVk
IHBvaW50IGFyaXRobWV0aWMgYW5kIGxvYWQgaXMgdGhlIGluc3RhbnRhbmVvdXMgbG9hZCBvZiBh
Ci0gKiBydW5xdWV1ZSwgd2hpY2ggYmFzaWNhbGx5IGlzIHRoZSBudW1iZXIgb2YgcnVubmFibGUg
dmNwdXMgdGhlcmUgYXJlIG9uIHRoZQorICogcnVucXVldWUsIHdoaWNoIGJhc2ljYWxseSBpcyB0
aGUgbnVtYmVyIG9mIHJ1bm5hYmxlIHVuaXRzIHRoZXJlIGFyZSBvbiB0aGUKICAqIHJ1bnF1ZXVl
IChmb3IgdGhlIG1lYW5pbmcgb2YgdGhlIG90aGVyIHRlcm1zLCBsb29rIGF0IHRoZSBkb2MgY29t
bWVudCB0bwogICogIHVwZGF0ZV9ydW5xX2xvYWQoKSkuCiAgKgpAQCAtMzM4LDcgKzMzOCw3IEBA
IGludGVnZXJfcGFyYW0oInNjaGVkX2NyZWRpdDJfbWlncmF0ZV9yZXNpc3QiLCBvcHRfbWlncmF0
ZV9yZXNpc3QpOwogICogVGhlIG1heGltdW0gcG9zc2libGUgdmFsdWUgZm9yIHRoZSBhdmVyYWdl
IGxvYWQsIHdoaWNoIHdlIHdhbnQgdG8gc3RvcmUgaW4KICAqIHNfdGltZV90IHR5cGUgdmFyaWFi
bGVzIChpLmUuLCB3ZSBoYXZlIDYzIGJpdHMgYXZhaWxhYmxlKSBpcyBsb2FkKlAuIFRoaXMKICAq
IG1lYW5zIHRoYXQsIHdpdGggUCAxOCBiaXRzIHdpZGUsIGxvYWQgY2FuIG9jY3VweSA0NSBiaXRz
LiBUaGlzIGluIHR1cm4KLSAqIG1lYW5zIHdlIGNhbiBoYXZlIDJeNDUgdmNwdXMgaW4gZWFjaCBy
dW5xdWV1ZSwgYmVmb3JlIG92ZXJmbG93IG9jY3VycyEKKyAqIG1lYW5zIHdlIGNhbiBoYXZlIDJe
NDUgdW5pdHMgaW4gZWFjaCBydW5xdWV1ZSwgYmVmb3JlIG92ZXJmbG93IG9jY3VycyEKICAqCiAg
KiBIb3dldmVyLCBpdCBjYW4gaGFwcGVuIHRoYXQsIGF0IHN0ZXAgaisxLCBpZjoKICAqCkBAIC0z
NTQsMTMgKzM1NCwxMyBAQCBpbnRlZ2VyX3BhcmFtKCJzY2hlZF9jcmVkaXQyX21pZ3JhdGVfcmVz
aXN0Iiwgb3B0X21pZ3JhdGVfcmVzaXN0KTsKICAqCiAgKiAgMl4oNjMgLSAzMCAtIDE4KSA9IDJe
MTUgPSAzMjc2OAogICoKLSAqIFNvIDMyNzY4IGlzIHRoZSBtYXhpbXVtIG51bWJlciBvZiB2Y3B1
cyB0aGUgd2UgY2FuIGhhdmUgaW4gYSBydW5xdWV1ZSwKKyAqIFNvIDMyNzY4IGlzIHRoZSBtYXhp
bXVtIG51bWJlciBvZiB1bml0cyB0aGUgd2UgY2FuIGhhdmUgaW4gYSBydW5xdWV1ZSwKICAqIGF0
IGFueSBnaXZlbiB0aW1lLCBhbmQgc3RpbGwgbm90IGhhdmUgcHJvYmxlbXMgd2l0aCB0aGUgbG9h
ZCB0cmFja2luZwogICogY2FsY3VsYXRpb25zLi4uIGFuZCB0aGlzIGlzIG1vcmUgdGhhbiBmaW5l
LgogICoKICAqIEFzIGEgbWF0dGVyIG9mIGZhY3QsIHNpbmNlIHdlIGFyZSB1c2luZyBtaWNyb3Nl
Y29uZHMgZ3JhbnVsYXJpdHksIHdlIGhhdmUKICAqIFc9Ml4yMC4gU28sIHN0aWxsIHdpdGggMTgg
ZnJhY3Rpb25hbCBiaXRzIGFuZCBhIDEgc2Vjb25kIGxvbmcgd2luZG93LCB0aGVyZQotICogbWF5
IGJlIDJeMjUgPSAzMzU1NDQzMiB2Y3B1cyBpbiBhIHJ1bnEgYmVmb3JlIHdlIGhhdmUgdG8gc3Rh
cnQgdGhpbmtpbmcKKyAqIG1heSBiZSAyXjI1ID0gMzM1NTQ0MzIgdW5pdHMgaW4gYSBydW5xIGJl
Zm9yZSB3ZSBoYXZlIHRvIHN0YXJ0IHRoaW5raW5nCiAgKiBhYm91dCBvdmVyZmxvdy4KICAqLwog
CkBAIC00NjksNyArNDY5LDcgQEAgc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSB7CiAgICAg
dW5zaWduZWQgaW50IG5yX2NwdXM7ICAgICAgLyogSG93IG1hbnkgQ1BVcyBhcmUgc2hhcmluZyB0
aGlzIHJ1bnF1ZXVlICAgICovCiAgICAgaW50IGlkOyAgICAgICAgICAgICAgICAgICAgLyogSUQg
b2YgdGhpcyBydW5xdWV1ZSAoLTEgaWYgaW52YWxpZCkgICAgICAgICovCiAKLSAgICBpbnQgbG9h
ZDsgICAgICAgICAgICAgICAgICAvKiBJbnN0YW50YW5lb3VzIGxvYWQgKG51bSBvZiBub24taWRs
ZSB2Y3B1cykgKi8KKyAgICBpbnQgbG9hZDsgICAgICAgICAgICAgICAgICAvKiBJbnN0YW50YW5l
b3VzIGxvYWQgKG51bSBvZiBub24taWRsZSB1bml0cykgKi8KICAgICBzX3RpbWVfdCBsb2FkX2xh
c3RfdXBkYXRlOyAvKiBMYXN0IHRpbWUgYXZlcmFnZSB3YXMgdXBkYXRlZCAgICAgICAgICAgICAg
Ki8KICAgICBzX3RpbWVfdCBhdmdsb2FkOyAgICAgICAgICAvKiBEZWNheWluZyBxdWV1ZSBsb2Fk
ICAgICAgICAgICAgICAgICAgICAgICAgKi8KICAgICBzX3RpbWVfdCBiX2F2Z2xvYWQ7ICAgICAg
ICAvKiBEZWNheWluZyBxdWV1ZSBsb2FkIG1vZGlmaWVkIGJ5IGJhbGFuY2luZyAgKi8KQEAgLTQ3
OSw4ICs0NzksOCBAQCBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhIHsKICAgICAgICAgdGlj
a2xlZCwgICAgICAgICAgICAgICAvKiBIYXZlIGJlZW4gYXNrZWQgdG8gZ28gdGhyb3VnaCBzY2hl
ZHVsZSAgICAgKi8KICAgICAgICAgaWRsZTsgICAgICAgICAgICAgICAgICAvKiBDdXJyZW50bHkg
aWRsZSBwY3B1cyAgICAgICAgICAgICAgICAgICAgICAgKi8KIAotICAgIHN0cnVjdCBsaXN0X2hl
YWQgc3ZjOyAgICAgIC8qIExpc3Qgb2YgYWxsIHZjcHVzIGFzc2lnbmVkIHRvIHRoZSBydW5xdWV1
ZSAqLwotICAgIHVuc2lnbmVkIGludCBtYXhfd2VpZ2h0OyAgIC8qIE1heCB3ZWlnaHQgb2YgdGhl
IHZjcHVzIGluIHRoaXMgcnVucXVldWUgICAqLworICAgIHN0cnVjdCBsaXN0X2hlYWQgc3ZjOyAg
ICAgIC8qIExpc3Qgb2YgYWxsIHVuaXRzIGFzc2lnbmVkIHRvIHRoZSBydW5xdWV1ZSAqLworICAg
IHVuc2lnbmVkIGludCBtYXhfd2VpZ2h0OyAgIC8qIE1heCB3ZWlnaHQgb2YgdGhlIHVuaXRzIGlu
IHRoaXMgcnVucXVldWUgICAqLwogICAgIHVuc2lnbmVkIGludCBwaWNrX2JpYXM7ICAgIC8qIExh
c3QgcGlja2VkIHBjcHUuIFN0YXJ0IGZyb20gaXQgbmV4dCB0aW1lICAqLwogfTsKIApAQCAtNTEw
LDIwICs1MTAsMjAgQEAgc3RydWN0IGNzY2hlZDJfcGNwdSB7CiB9OwogCiAvKgotICogVmlydHVh
bCBDUFUKKyAqIFNjaGVkdWxlIFVuaXQKICAqLwogc3RydWN0IGNzY2hlZDJfdW5pdCB7CiAgICAg
c3RydWN0IGNzY2hlZDJfZG9tICpzZG9tOyAgICAgICAgICAvKiBVcC1wb2ludGVyIHRvIGRvbWFp
biAgICAgICAgICAgICAgICAqLwotICAgIHN0cnVjdCB2Y3B1ICp2Y3B1OyAgICAgICAgICAgICAg
ICAgLyogVXAtcG9pbnRlciwgdG8gdmNwdSAgICAgICAgICAgICAgICAgKi8KKyAgICBzdHJ1Y3Qg
c2NoZWRfdW5pdCAqdW5pdDsgICAgICAgICAgIC8qIFVwLXBvaW50ZXIsIHRvIHNjaGVkdWxlIHVu
aXQgICAgICAgICovCiAgICAgc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFkOyAvKiBV
cC1wb2ludGVyIHRvIHRoZSBydW5xdWV1ZSAgICAgICAgICAqLwogCiAgICAgaW50IGNyZWRpdDsg
ICAgICAgICAgICAgICAgICAgICAgICAvKiBDdXJyZW50IGFtb3VudCBvZiBjcmVkaXQgICAgICAg
ICAgICAqLwotICAgIHVuc2lnbmVkIGludCB3ZWlnaHQ7ICAgICAgICAgICAgICAgLyogV2VpZ2h0
IG9mIHRoaXMgdmNwdSAgICAgICAgICAgICAgICAgKi8KKyAgICB1bnNpZ25lZCBpbnQgd2VpZ2h0
OyAgICAgICAgICAgICAgIC8qIFdlaWdodCBvZiB0aGlzIHVuaXQgICAgICAgICAgICAgICAgICov
CiAgICAgdW5zaWduZWQgaW50IHJlc2lkdWFsOyAgICAgICAgICAgICAvKiBSZW1pbmRlciBvZiBk
aXYobWF4X3dlaWdodC93ZWlnaHQpICAqLwogICAgIHVuc2lnbmVkIGZsYWdzOyAgICAgICAgICAg
ICAgICAgICAgLyogU3RhdHVzIGZsYWdzICgxNiBiaXRzIHdvdWxkIGJlIG9rLCAgKi8KICAgICBz
X3RpbWVfdCBidWRnZXQ7ICAgICAgICAgICAgICAgICAgIC8qIEN1cnJlbnQgYnVkZ2V0IChpZiBk
b21haW5zIGhhcyBjYXApICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAvKiBidXQgY2xlYXJfYml0KCkgZG9lcyBub3QgbGlrZSB0aGF0KSAqLwotICAgIHNfdGltZV90
IGJ1ZGdldF9xdW90YTsgICAgICAgICAgICAgLyogQnVkZ2V0IHRvIHdoaWNoIHZDUFUgaXMgZW50
aXRsZWQgICAgKi8KKyAgICBzX3RpbWVfdCBidWRnZXRfcXVvdGE7ICAgICAgICAgICAgIC8qIEJ1
ZGdldCB0byB3aGljaCB1bml0IGlzIGVudGl0bGVkICAgICovCiAKICAgICBzX3RpbWVfdCBzdGFy
dF90aW1lOyAgICAgICAgICAgICAgIC8qIFRpbWUgd2Ugd2VyZSBzY2hlZHVsZWQgKGZvciBjcmVk
aXQpICovCiAKQEAgLTUzMiw3ICs1MzIsNyBAQCBzdHJ1Y3QgY3NjaGVkMl91bml0IHsKICAgICBz
X3RpbWVfdCBhdmdsb2FkOyAgICAgICAgICAgICAgICAgIC8qIERlY2F5aW5nIHF1ZXVlIGxvYWQg
ICAgICAgICAgICAgICAgICovCiAKICAgICBzdHJ1Y3QgbGlzdF9oZWFkIHJ1bnFfZWxlbTsgICAg
ICAgIC8qIE9uIHRoZSBydW5xdWV1ZSAocnFkLT5ydW5xKSAgICAgICAgICovCi0gICAgc3RydWN0
IGxpc3RfaGVhZCBwYXJrZWRfZWxlbTsgICAgICAvKiBPbiB0aGUgcGFya2VkX3ZjcHVzIGxpc3Qg
ICAgICAgICAgICAqLworICAgIHN0cnVjdCBsaXN0X2hlYWQgcGFya2VkX2VsZW07ICAgICAgLyog
T24gdGhlIHBhcmtlZF91bml0cyBsaXN0ICAgICAgICAgICAgKi8KICAgICBzdHJ1Y3QgbGlzdF9o
ZWFkIHJxZF9lbGVtOyAgICAgICAgIC8qIE9uIGNzY2hlZDJfcnVucXVldWVfZGF0YSdzIHN2YyBs
aXN0ICovCiAgICAgc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqbWlncmF0ZV9ycWQ7IC8q
IFByZS1kZXRlcm1pbmVkIG1pZ3IuIHRhcmdldCAqLwogICAgIGludCB0aWNrbGVkX2NwdTsgICAg
ICAgICAgICAgICAgICAgLyogQ3B1IHRoYXQgd2lsbCBwaWNrIHVzICgtMSBpZiBub25lKSAgKi8K
QEAgLTU1MCwxMiArNTUwLDEyIEBAIHN0cnVjdCBjc2NoZWQyX2RvbSB7CiAKICAgICBzdHJ1Y3Qg
dGltZXIgcmVwbF90aW1lcjsgICAgLyogVGltZXIgZm9yIHBlcmlvZGljIHJlcGxlbmlzaG1lbnQg
b2YgYnVkZ2V0ICovCiAgICAgc190aW1lX3QgbmV4dF9yZXBsOyAgICAgICAgIC8qIFRpbWUgYXQg
d2hpY2ggbmV4dCByZXBsZW5pc2htZW50IG9jY3VycyAgICAqLwotICAgIHN0cnVjdCBsaXN0X2hl
YWQgcGFya2VkX3ZjcHVzOyAvKiBMaXN0IG9mIENQVXMgd2FpdGluZyBmb3IgYnVkZ2V0ICAgICAg
ICAgKi8KKyAgICBzdHJ1Y3QgbGlzdF9oZWFkIHBhcmtlZF91bml0czsgLyogTGlzdCBvZiBDUFVz
IHdhaXRpbmcgZm9yIGJ1ZGdldCAgICAgICAgICovCiAKICAgICBzdHJ1Y3QgbGlzdF9oZWFkIHNk
b21fZWxlbTsgLyogT24gY3NjaGVkMl9ydW5xdWV1ZV9kYXRhJ3Mgc2RvbSBsaXN0ICAgICAgICov
CiAgICAgdWludDE2X3Qgd2VpZ2h0OyAgICAgICAgICAgIC8qIFVzZXIgc3BlY2lmaWVkIHdlaWdo
dCAgICAgICAgICAgICAgICAgICAgICAqLwogICAgIHVpbnQxNl90IGNhcDsgICAgICAgICAgICAg
ICAvKiBVc2VyIHNwZWNpZmllZCBjYXAgICAgICAgICAgICAgICAgICAgICAgICAgKi8KLSAgICB1
aW50MTZfdCBucl92Y3B1czsgICAgICAgICAgLyogTnVtYmVyIG9mIHZjcHVzIG9mIHRoaXMgZG9t
YWluICAgICAgICAgICAgICovCisgICAgdWludDE2X3QgbnJfdW5pdHM7ICAgICAgICAgIC8qIE51
bWJlciBvZiB1bml0cyBvZiB0aGlzIGRvbWFpbiAgICAgICAgICAgICAqLwogfTsKIAogLyoKQEAg
LTU5NCw3ICs1OTQsNyBAQCBzdGF0aWMgaW5saW5lIHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2Rh
dGEgKmMycnFkKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKICAgICByZXR1cm4gJmNzY2hl
ZDJfcHJpdihvcHMpLT5ycWRbYzJyKGNwdSldOwogfQogCi0vKiBEb2VzIHRoZSBkb21haW4gb2Yg
dGhpcyB2Q1BVIGhhdmUgYSBjYXA/ICovCisvKiBEb2VzIHRoZSBkb21haW4gb2YgdGhpcyB1bml0
IGhhdmUgYSBjYXA/ICovCiBzdGF0aWMgaW5saW5lIGJvb2wgaGFzX2NhcChjb25zdCBzdHJ1Y3Qg
Y3NjaGVkMl91bml0ICpzdmMpCiB7CiAgICAgcmV0dXJuIHN2Yy0+YnVkZ2V0ICE9IFNUSU1FX01B
WDsKQEAgLTYxMiwyNCArNjEyLDI0IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBoYXNfY2FwKGNvbnN0
IHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YykKICAqICAgIHNtdF9pZGxlIG1hc2suCiAgKgogICog
T25jZSB3ZSBoYXZlIHN1Y2ggYSBtYXNrLCBpdCBpcyBlYXN5IHRvIGltcGxlbWVudCBhIHBvbGlj
eSB0aGF0LCBlaXRoZXI6Ci0gKiAgLSB1c2VzIGZ1bGx5IGlkbGUgY29yZXMgZmlyc3Q6IGl0IGlz
IGVub3VnaCB0byB0cnkgdG8gc2NoZWR1bGUgdGhlIHZjcHVzCisgKiAgLSB1c2VzIGZ1bGx5IGlk
bGUgY29yZXMgZmlyc3Q6IGl0IGlzIGVub3VnaCB0byB0cnkgdG8gc2NoZWR1bGUgdGhlIHVuaXRz
CiAgKiAgICBvbiBwY3B1cyBmcm9tIHNtdF9pZGxlIG1hc2sgZmlyc3QuIFRoaXMgaXMgd2hhdCBo
YXBwZW5zIGlmCiAgKiAgICBzY2hlZF9zbXRfcG93ZXJfc2F2aW5ncyB3YXMgbm90IHNldCBhdCBi
b290IChkZWZhdWx0KSwgYW5kIGl0IG1heGltaXplcwogICogICAgdHJ1ZSBwYXJhbGxlbGlzbSwg
YW5kIGhlbmNlIHBlcmZvcm1hbmNlOwotICogIC0gdXNlcyBhbHJlYWR5IGJ1c3kgY29yZXMgZmly
c3Q6IGl0IGlzIGVub3VnaCB0byB0cnkgdG8gc2NoZWR1bGUgdGhlIHZjcHVzCisgKiAgLSB1c2Vz
IGFscmVhZHkgYnVzeSBjb3JlcyBmaXJzdDogaXQgaXMgZW5vdWdoIHRvIHRyeSB0byBzY2hlZHVs
ZSB0aGUgdW5pdHMKICAqICAgIG9uIHBjcHVzIHRoYXQgYXJlIGlkbGUsIGJ1dCBhcmUgbm90IGlu
IHNtdF9pZGxlLiBUaGlzIGlzIHdoYXQgaGFwcGVucyBpZgogICogICAgc2NoZWRfc210X3Bvd2Vy
X3NhdmluZ3MgaXMgc2V0IGF0IGJvb3QsIGFuZCBpdCBhbGxvd3MgYXMgbW9yZSBjb3JlcyBhcwog
ICogICAgcG9zc2libGUgdG8gc3RheSBpbiBsb3cgcG93ZXIgc3RhdGVzLCBtaW5pbWl6aW5nIHBv
d2VyIGNvbnN1bXB0aW9uLgogICoKICAqIFRoaXMgbG9naWMgaXMgZW50aXJlbHkgaW1wbGVtZW50
ZWQgaW4gcnVucV90aWNrbGUoKSwgYW5kIHRoYXQgaXMgZW5vdWdoLgotICogSW4gZmFjdCwgaW4g
dGhpcyBzY2hlZHVsZXIsIHBsYWNlbWVudCBvZiBhIHZjcHUgb24gb25lIG9mIHRoZSBwY3B1cyBv
ZiBhCisgKiBJbiBmYWN0LCBpbiB0aGlzIHNjaGVkdWxlciwgcGxhY2VtZW50IG9mIGFuIHVuaXQg
b24gb25lIG9mIHRoZSBwY3B1cyBvZiBhCiAgKiBydW5xLCBfYWx3YXlzXyBoYXBwZW5zIGJ5IG1l
YW5zIG9mIHRpY2tsaW5nOgotICogIC0gd2hlbiBhIHZjcHUgd2FrZXMgdXAsIGl0IGNhbGxzIGNz
Y2hlZDJfdW5pdF93YWtlKCksIHdoaWNoIGNhbGxzCisgKiAgLSB3aGVuIGFuIHVuaXQgd2FrZXMg
dXAsIGl0IGNhbGxzIGNzY2hlZDJfdW5pdF93YWtlKCksIHdoaWNoIGNhbGxzCiAgKiAgICBydW5x
X3RpY2tsZSgpOwogICogIC0gd2hlbiBhIG1pZ3JhdGlvbiBpcyBpbml0aWF0ZWQgaW4gc2NoZWR1
bGUuYywgd2UgY2FsbCBjc2NoZWQyX3Jlc19waWNrKCksCiAgKiAgICBjc2NoZWQyX3VuaXRfbWln
cmF0ZSgpICh3aGljaCBjYWxscyBtaWdyYXRlKCkpIGFuZCBjc2NoZWQyX3VuaXRfd2FrZSgpLgog
ICogICAgY3NjaGVkMl9yZXNfcGljaygpIGxvb2tzIGZvciB0aGUgbGVhc3QgbG9hZGVkIHJ1bnEg
YW5kIHJldHVybiBqdXN0IGFueQotICogICAgb2YgaXRzIHByb2Nlc3NvcnMuIFRoZW4sIGNzY2hl
ZDJfdW5pdF9taWdyYXRlKCkganVzdCBtb3ZlcyB0aGUgdmNwdSB0bworICogICAgb2YgaXRzIHBy
b2Nlc3NvcnMuIFRoZW4sIGNzY2hlZDJfdW5pdF9taWdyYXRlKCkganVzdCBtb3ZlcyB0aGUgdW5p
dCB0bwogICogICAgdGhlIGNob3NlbiBydW5xLCBhbmQgaXQgaXMgYWdhaW4gcnVucV90aWNrbGUo
KSwgY2FsbGVkIGJ5CiAgKiAgICBjc2NoZWQyX3VuaXRfd2FrZSgpIHRoYXQgYWN0dWFsbHkgZGVj
aWRlcyB3aGF0IHBjcHUgdG8gdXNlIHdpdGhpbiB0aGUKICAqICAgIGNob3NlbiBydW5xOwpAQCAt
NjQ0LDcgKzY0NCw3IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBoYXNfY2FwKGNvbnN0IHN0cnVjdCBj
c2NoZWQyX3VuaXQgKnN2YykKICAqCiAgKiBOQiB0aGF0IHJxZC0+c210X2lkbGUgaXMgZGlmZmVy
ZW50IHRoYW4gcnFkLT5pZGxlLiAgcnFkLT5pZGxlCiAgKiByZWNvcmRzIHBjcHVzIHRoYXQgYXQg
YXJlIG1lcmVseSBpZGxlIChpLmUuLCBhdCB0aGUgbW9tZW50IGRvIG5vdAotICogaGF2ZSBhIHZj
cHUgcnVubmluZyBvbiB0aGVtKS4gIEJ1dCB5b3UgaGF2ZSB0byBtYW51YWxseSBmaWx0ZXIgb3V0
CisgKiBoYXZlIGFuIHVuaXQgcnVubmluZyBvbiB0aGVtKS4gIEJ1dCB5b3UgaGF2ZSB0byBtYW51
YWxseSBmaWx0ZXIgb3V0CiAgKiB3aGljaCBwY3B1cyBoYXZlIGJlZW4gdGlja2xlZCBpbiBvcmRl
ciB0byBmaW5kIGNvcmVzIHRoYXQgYXJlIG5vdAogICogZ29pbmcgdG8gYmUgYnVzeSBzb29uLiAg
RmlsdGVyaW5nIG91dCB0aWNrbGVkIGNwdXMgcGFpcndpc2UgaXMgYQogICogbG90IG9mIGV4dHJh
IHBhaW47IHNvIGZvciBycWQtPnNtdF9pZGxlLCB3ZSBleHBsaWNpdGx5IG1ha2Ugc28gdGhhdApA
QCAtNjkxLDI0ICs2OTEsMjQgQEAgdm9pZCBzbXRfaWRsZV9tYXNrX2NsZWFyKHVuc2lnbmVkIGlu
dCBjcHUsIGNwdW1hc2tfdCAqbWFzaykKICAqLwogc3RhdGljIGludCBnZXRfZmFsbGJhY2tfY3B1
KHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YykKIHsKLSAgICBzdHJ1Y3QgdmNwdSAqdiA9IHN2Yy0+
dmNwdTsKKyAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCA9IHN2Yy0+dW5pdDsKICAgICB1bnNp
Z25lZCBpbnQgYnM7CiAKICAgICBTQ0hFRF9TVEFUX0NSQU5LKG5lZWRfZmFsbGJhY2tfY3B1KTsK
IAogICAgIGZvcl9lYWNoX2FmZmluaXR5X2JhbGFuY2Vfc3RlcCggYnMgKQogICAgIHsKLSAgICAg
ICAgaW50IGNwdSA9IHYtPnByb2Nlc3NvcjsKKyAgICAgICAgaW50IGNwdSA9IHNjaGVkX3VuaXRf
bWFzdGVyKHVuaXQpOwogCi0gICAgICAgIGlmICggYnMgPT0gQkFMQU5DRV9TT0ZUX0FGRklOSVRZ
ICYmICFoYXNfc29mdF9hZmZpbml0eSh2LT5zY2hlZF91bml0KSApCisgICAgICAgIGlmICggYnMg
PT0gQkFMQU5DRV9TT0ZUX0FGRklOSVRZICYmICFoYXNfc29mdF9hZmZpbml0eSh1bml0KSApCiAg
ICAgICAgICAgICBjb250aW51ZTsKIAotICAgICAgICBhZmZpbml0eV9iYWxhbmNlX2NwdW1hc2so
di0+c2NoZWRfdW5pdCwgYnMsIGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSk7CisgICAgICAgIGFm
ZmluaXR5X2JhbGFuY2VfY3B1bWFzayh1bml0LCBicywgY3B1bWFza19zY3JhdGNoX2NwdShjcHUp
KTsKICAgICAgICAgY3B1bWFza19hbmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCBjcHVtYXNr
X3NjcmF0Y2hfY3B1KGNwdSksCi0gICAgICAgICAgICAgICAgICAgIGNwdXBvb2xfZG9tYWluX2Nw
dW1hc2sodi0+ZG9tYWluKSk7CisgICAgICAgICAgICAgICAgICAgIGNwdXBvb2xfZG9tYWluX2Nw
dW1hc2sodW5pdC0+ZG9tYWluKSk7CiAKICAgICAgICAgLyoKLSAgICAgICAgICogVGhpcyBpcyBj
YXNlcyAxIG9yIDMgKGRlcGVuZGluZyBvbiBicyk6IGlmIHYtPnByb2Nlc3NvciBpcyAoc3RpbGwp
CisgICAgICAgICAqIFRoaXMgaXMgY2FzZXMgMSBvciAzIChkZXBlbmRpbmcgb24gYnMpOiBpZiBw
cm9jZXNzb3IgaXMgKHN0aWxsKQogICAgICAgICAgKiBpbiBvdXIgYWZmaW5pdHksIGdvIGZvciBp
dCwgZm9yIGNhY2hlIGJldHRlcm5lc3MuCiAgICAgICAgICAqLwogICAgICAgICBpZiAoIGxpa2Vs
eShjcHVtYXNrX3Rlc3RfY3B1KGNwdSwgY3B1bWFza19zY3JhdGNoX2NwdShjcHUpKSkgKQpAQCAt
NzMwLDcgKzczMCw3IEBAIHN0YXRpYyBpbnQgZ2V0X2ZhbGxiYWNrX2NwdShzdHJ1Y3QgY3NjaGVk
Ml91bml0ICpzdmMpCiAgICAgICAgICAqIFdlIG1heSB3ZWxsIHBpY2sgYW55IHZhbGlkIHBjcHUg
ZnJvbSBvdXIgc29mdC1hZmZpbml0eSwgb3V0c2lkZQogICAgICAgICAgKiBvZiBvdXIgY3VycmVu
dCBydW5xdWV1ZSwgYnV0IHdlIGRlY2lkZSBub3QgdG8uIEluIGZhY3QsIGNoYW5naW5nCiAgICAg
ICAgICAqIHJ1bnF1ZXVlIGlzIHNsb3csIGFmZmVjdHMgbG9hZCBkaXN0cmlidXRpb24sIGFuZCBp
cyBhIHNvdXJjZSBvZgotICAgICAgICAgKiBvdmVyaGVhZCBmb3IgdGhlIHZjcHVzIHJ1bm5pbmcg
b24gdGhlIG90aGVyIHJ1bnF1ZXVlICh3ZSBuZWVkIHRoZQorICAgICAgICAgKiBvdmVyaGVhZCBm
b3IgdGhlIHVuaXRzIHJ1bm5pbmcgb24gdGhlIG90aGVyIHJ1bnF1ZXVlICh3ZSBuZWVkIHRoZQog
ICAgICAgICAgKiBsb2NrKS4gU28sIGJldHRlciBkbyB0aGF0IGFzIGEgY29uc2VxdWVuY2Ugb2Yg
YSB3ZWxsIGluZm9ybWVkCiAgICAgICAgICAqIGRlY2lzaW9uIChvciBpZiB3ZSByZWFsbHkgZG9u
J3QgaGF2ZSBhbnkgb3RoZXIgY2hhbmNlLCBhcyB3ZSB3aWxsLAogICAgICAgICAgKiBhdCBzdGVw
IDUsIGlmIHdlIGdldCB0byB0aGVyZSkuCkBAIC03NjIsNyArNzYyLDcgQEAgc3RhdGljIGludCBn
ZXRfZmFsbGJhY2tfY3B1KHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YykKICAgICAgKiBXZSBjYW4n
dCBiZSBoZXJlLiAgQnV0IGlmIHRoYXQgc29tZWhvdyBoYXBwZW4gKGluIG5vbi1kZWJ1ZyBidWls
ZHMpLAogICAgICAqIGF0IGxlYXN0IHJldHVybiBzb21ldGhpbmcgd2hpY2ggYm90aCBvbmxpbmUg
YW5kIGluIG91ciBoYXJkLWFmZmluaXR5LgogICAgICAqLwotICAgIHJldHVybiBjcHVtYXNrX2Fu
eShjcHVtYXNrX3NjcmF0Y2hfY3B1KHYtPnByb2Nlc3NvcikpOworICAgIHJldHVybiBjcHVtYXNr
X2FueShjcHVtYXNrX3NjcmF0Y2hfY3B1KHNjaGVkX3VuaXRfbWFzdGVyKHVuaXQpKSk7CiB9CiAK
IC8qCkBAIC03OTEsNyArNzkxLDcgQEAgc3RhdGljIHNfdGltZV90IGMydChzdHJ1Y3QgY3NjaGVk
Ml9ydW5xdWV1ZV9kYXRhICpycWQsIHNfdGltZV90IGNyZWRpdCwgc3RydWN0IGMKICAqIFJ1bnF1
ZXVlIHJlbGF0ZWQgY29kZS4KICAqLwogCi1zdGF0aWMgaW5saW5lIGludCB2Y3B1X29uX3J1bnEo
c3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQorc3RhdGljIGlubGluZSBpbnQgdW5pdF9vbl9ydW5x
KHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YykKIHsKICAgICByZXR1cm4gIWxpc3RfZW1wdHkoJnN2
Yy0+cnVucV9lbGVtKTsKIH0KQEAgLTk0OSwxNyArOTQ5LDE3IEBAIF9ydW5xX2Fzc2lnbihzdHJ1
Y3QgY3NjaGVkMl91bml0ICpzdmMsIHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCkK
IAogICAgIHVwZGF0ZV9tYXhfd2VpZ2h0KHN2Yy0+cnFkLCBzdmMtPndlaWdodCwgMCk7CiAKLSAg
ICAvKiBFeHBlY3RlZCBuZXcgbG9hZCBiYXNlZCBvbiBhZGRpbmcgdGhpcyB2Y3B1ICovCisgICAg
LyogRXhwZWN0ZWQgbmV3IGxvYWQgYmFzZWQgb24gYWRkaW5nIHRoaXMgdW5pdCAqLwogICAgIHJx
ZC0+Yl9hdmdsb2FkICs9IHN2Yy0+YXZnbG9hZDsKIAogICAgIGlmICggdW5saWtlbHkodGJfaW5p
dF9kb25lKSApCiAgICAgewogICAgICAgICBzdHJ1Y3QgewotICAgICAgICAgICAgdW5zaWduZWQg
dmNwdToxNiwgZG9tOjE2OworICAgICAgICAgICAgdW5zaWduZWQgdW5pdDoxNiwgZG9tOjE2Owog
ICAgICAgICAgICAgdW5zaWduZWQgcnFpOjE2OwogICAgICAgICB9IGQ7Ci0gICAgICAgIGQuZG9t
ID0gc3ZjLT52Y3B1LT5kb21haW4tPmRvbWFpbl9pZDsKLSAgICAgICAgZC52Y3B1ID0gc3ZjLT52
Y3B1LT52Y3B1X2lkOworICAgICAgICBkLmRvbSA9IHN2Yy0+dW5pdC0+ZG9tYWluLT5kb21haW5f
aWQ7CisgICAgICAgIGQudW5pdCA9IHN2Yy0+dW5pdC0+dW5pdF9pZDsKICAgICAgICAgZC5ycWk9
cnFkLT5pZDsKICAgICAgICAgX190cmFjZV92YXIoVFJDX0NTQ0hFRDJfUlVOUV9BU1NJR04sIDEs
CiAgICAgICAgICAgICAgICAgICAgIHNpemVvZihkKSwKQEAgLTk2OSwxMyArOTY5LDEzIEBAIF9y
dW5xX2Fzc2lnbihzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMsIHN0cnVjdCBjc2NoZWQyX3J1bnF1
ZXVlX2RhdGEgKnJxZCkKIH0KIAogc3RhdGljIHZvaWQKLXJ1bnFfYXNzaWduKGNvbnN0IHN0cnVj
dCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHZjcHUgKnZjKQorcnVucV9hc3NpZ24oY29uc3Qgc3Ry
dWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIHsKLSAgICBzdHJ1
Y3QgY3NjaGVkMl91bml0ICpzdmMgPSB2Yy0+c2NoZWRfdW5pdC0+cHJpdjsKKyAgICBzdHJ1Y3Qg
Y3NjaGVkMl91bml0ICpzdmMgPSB1bml0LT5wcml2OwogCiAgICAgQVNTRVJUKHN2Yy0+cnFkID09
IE5VTEwpOwogCi0gICAgX3J1bnFfYXNzaWduKHN2YywgYzJycWQob3BzLCB2Yy0+cHJvY2Vzc29y
KSk7CisgICAgX3J1bnFfYXNzaWduKHN2YywgYzJycWQob3BzLCBzY2hlZF91bml0X21hc3Rlcih1
bml0KSkpOwogfQogCiBzdGF0aWMgdm9pZApAQCAtOTgzLDI0ICs5ODMsMjQgQEAgX3J1bnFfZGVh
c3NpZ24oc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQogewogICAgIHN0cnVjdCBjc2NoZWQyX3J1
bnF1ZXVlX2RhdGEgKnJxZCA9IHN2Yy0+cnFkOwogCi0gICAgQVNTRVJUKCF2Y3B1X29uX3J1bnEo
c3ZjKSk7CisgICAgQVNTRVJUKCF1bml0X29uX3J1bnEoc3ZjKSk7CiAgICAgQVNTRVJUKCEoc3Zj
LT5mbGFncyAmIENTRkxBR19zY2hlZHVsZWQpKTsKIAogICAgIGxpc3RfZGVsX2luaXQoJnN2Yy0+
cnFkX2VsZW0pOwogICAgIHVwZGF0ZV9tYXhfd2VpZ2h0KHJxZCwgMCwgc3ZjLT53ZWlnaHQpOwog
Ci0gICAgLyogRXhwZWN0ZWQgbmV3IGxvYWQgYmFzZWQgb24gcmVtb3ZpbmcgdGhpcyB2Y3B1ICov
CisgICAgLyogRXhwZWN0ZWQgbmV3IGxvYWQgYmFzZWQgb24gcmVtb3ZpbmcgdGhpcyB1bml0ICov
CiAgICAgcnFkLT5iX2F2Z2xvYWQgPSBtYXhfdChzX3RpbWVfdCwgcnFkLT5iX2F2Z2xvYWQgLSBz
dmMtPmF2Z2xvYWQsIDApOwogCiAgICAgc3ZjLT5ycWQgPSBOVUxMOwogfQogCiBzdGF0aWMgdm9p
ZAotcnVucV9kZWFzc2lnbihjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCB2Y3B1
ICp2YykKK3J1bnFfZGVhc3NpZ24oY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qg
c2NoZWRfdW5pdCAqdW5pdCkKIHsKLSAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMgPSB2Yy0+
c2NoZWRfdW5pdC0+cHJpdjsKKyAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMgPSB1bml0LT5w
cml2OwogCi0gICAgQVNTRVJUKHN2Yy0+cnFkID09IGMycnFkKG9wcywgdmMtPnByb2Nlc3Nvcikp
OworICAgIEFTU0VSVChzdmMtPnJxZCA9PSBjMnJxZChvcHMsIHNjaGVkX3VuaXRfbWFzdGVyKHVu
aXQpKSk7CiAKICAgICBfcnVucV9kZWFzc2lnbihzdmMpOwogfQpAQCAtMTIwMywxNSArMTIwMywx
NSBAQCB1cGRhdGVfc3ZjX2xvYWQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAgICAg
ICAgICAgICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YywgaW50IGNoYW5nZSwgc190aW1lX3Qg
bm93KQogewogICAgIHN0cnVjdCBjc2NoZWQyX3ByaXZhdGUgKnBydiA9IGNzY2hlZDJfcHJpdihv
cHMpOwotICAgIHNfdGltZV90IGRlbHRhLCB2Y3B1X2xvYWQ7CisgICAgc190aW1lX3QgZGVsdGEs
IHVuaXRfbG9hZDsKICAgICB1bnNpZ25lZCBpbnQgUCwgVzsKIAogICAgIGlmICggY2hhbmdlID09
IC0xICkKLSAgICAgICAgdmNwdV9sb2FkID0gMTsKKyAgICAgICAgdW5pdF9sb2FkID0gMTsKICAg
ICBlbHNlIGlmICggY2hhbmdlID09IDEgKQotICAgICAgICB2Y3B1X2xvYWQgPSAwOworICAgICAg
ICB1bml0X2xvYWQgPSAwOwogICAgIGVsc2UKLSAgICAgICAgdmNwdV9sb2FkID0gdmNwdV9ydW5u
YWJsZShzdmMtPnZjcHUpOworICAgICAgICB1bml0X2xvYWQgPSB1bml0X3J1bm5hYmxlKHN2Yy0+
dW5pdCk7CiAKICAgICBXID0gcHJ2LT5sb2FkX3dpbmRvd19zaGlmdDsKICAgICBQID0gcHJ2LT5s
b2FkX3ByZWNpc2lvbl9zaGlmdDsKQEAgLTEyMTksNyArMTIxOSw3IEBAIHVwZGF0ZV9zdmNfbG9h
ZChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAKICAgICBpZiAoIHN2Yy0+bG9hZF9sYXN0
X3VwZGF0ZSArICgxVUxMIDw8IFcpIDwgbm93ICkKICAgICB7Ci0gICAgICAgIHN2Yy0+YXZnbG9h
ZCA9IHZjcHVfbG9hZCA8PCBQOworICAgICAgICBzdmMtPmF2Z2xvYWQgPSB1bml0X2xvYWQgPDwg
UDsKICAgICB9CiAgICAgZWxzZQogICAgIHsKQEAgLTEyMzIsNyArMTIzMiw3IEBAIHVwZGF0ZV9z
dmNfbG9hZChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAgICAgICAgIH0KIAogICAgICAg
ICBzdmMtPmF2Z2xvYWQgPSBzdmMtPmF2Z2xvYWQgKwotICAgICAgICAgICAgICAgICAgICAgICAo
KGRlbHRhICogKHZjcHVfbG9hZCA8PCBQKSkgPj4gVykgLQorICAgICAgICAgICAgICAgICAgICAg
ICAoKGRlbHRhICogKHVuaXRfbG9hZCA8PCBQKSkgPj4gVykgLQogICAgICAgICAgICAgICAgICAg
ICAgICAoKGRlbHRhICogc3ZjLT5hdmdsb2FkKSA+PiBXKTsKICAgICB9CiAgICAgc3ZjLT5sb2Fk
X2xhc3RfdXBkYXRlID0gbm93OwpAQCAtMTI0NCwxNCArMTI0NCwxNCBAQCB1cGRhdGVfc3ZjX2xv
YWQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAgIHsKICAgICAgICAgc3RydWN0IHsK
ICAgICAgICAgICAgIHVpbnQ2NF90IHZfYXZnbG9hZDsKLSAgICAgICAgICAgIHVuc2lnbmVkIHZj
cHU6MTYsIGRvbToxNjsKKyAgICAgICAgICAgIHVuc2lnbmVkIHVuaXQ6MTYsIGRvbToxNjsKICAg
ICAgICAgICAgIHVuc2lnbmVkIHNoaWZ0OwogICAgICAgICB9IGQ7Ci0gICAgICAgIGQuZG9tID0g
c3ZjLT52Y3B1LT5kb21haW4tPmRvbWFpbl9pZDsKLSAgICAgICAgZC52Y3B1ID0gc3ZjLT52Y3B1
LT52Y3B1X2lkOworICAgICAgICBkLmRvbSA9IHN2Yy0+dW5pdC0+ZG9tYWluLT5kb21haW5faWQ7
CisgICAgICAgIGQudW5pdCA9IHN2Yy0+dW5pdC0+dW5pdF9pZDsKICAgICAgICAgZC52X2F2Z2xv
YWQgPSBzdmMtPmF2Z2xvYWQ7CiAgICAgICAgIGQuc2hpZnQgPSBQOwotICAgICAgICBfX3RyYWNl
X3ZhcihUUkNfQ1NDSEVEMl9VUERBVEVfVkNQVV9MT0FELCAxLAorICAgICAgICBfX3RyYWNlX3Zh
cihUUkNfQ1NDSEVEMl9VUERBVEVfVU5JVF9MT0FELCAxLAogICAgICAgICAgICAgICAgICAgICBz
aXplb2YoZCksCiAgICAgICAgICAgICAgICAgICAgICh1bnNpZ25lZCBjaGFyICopJmQpOwogICAg
IH0KQEAgLTEyNzMsMTggKzEyNzMsMTggQEAgc3RhdGljIHZvaWQKIHJ1bnFfaW5zZXJ0KGNvbnN0
IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQogewogICAg
IHN0cnVjdCBsaXN0X2hlYWQgKml0ZXI7Ci0gICAgdW5zaWduZWQgaW50IGNwdSA9IHN2Yy0+dmNw
dS0+cHJvY2Vzc29yOworICAgIHVuc2lnbmVkIGludCBjcHUgPSBzY2hlZF91bml0X21hc3Rlcihz
dmMtPnVuaXQpOwogICAgIHN0cnVjdCBsaXN0X2hlYWQgKiBydW5xID0gJmMycnFkKG9wcywgY3B1
KS0+cnVucTsKICAgICBpbnQgcG9zID0gMDsKIAogICAgIEFTU0VSVChzcGluX2lzX2xvY2tlZChn
ZXRfc2NoZWRfcmVzKGNwdSktPnNjaGVkdWxlX2xvY2spKTsKIAotICAgIEFTU0VSVCghdmNwdV9v
bl9ydW5xKHN2YykpOwotICAgIEFTU0VSVChjMnIoY3B1KSA9PSBjMnIoc3ZjLT52Y3B1LT5wcm9j
ZXNzb3IpKTsKKyAgICBBU1NFUlQoIXVuaXRfb25fcnVucShzdmMpKTsKKyAgICBBU1NFUlQoYzJy
KGNwdSkgPT0gYzJyKHNjaGVkX3VuaXRfbWFzdGVyKHN2Yy0+dW5pdCkpKTsKIAogICAgIEFTU0VS
VCgmc3ZjLT5ycWQtPnJ1bnEgPT0gcnVucSk7Ci0gICAgQVNTRVJUKCFpc19pZGxlX3ZjcHUoc3Zj
LT52Y3B1KSk7Ci0gICAgQVNTRVJUKCFzdmMtPnZjcHUtPnNjaGVkX3VuaXQtPmlzX3J1bm5pbmcp
OworICAgIEFTU0VSVCghaXNfaWRsZV91bml0KHN2Yy0+dW5pdCkpOworICAgIEFTU0VSVCghc3Zj
LT51bml0LT5pc19ydW5uaW5nKTsKICAgICBBU1NFUlQoIShzdmMtPmZsYWdzICYgQ1NGTEFHX3Nj
aGVkdWxlZCkpOwogCiAgICAgbGlzdF9mb3JfZWFjaCggaXRlciwgcnVucSApCkBAIC0xMzAxLDEx
ICsxMzAxLDExIEBAIHJ1bnFfaW5zZXJ0KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3Ry
dWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQogICAgIGlmICggdW5saWtlbHkodGJfaW5pdF9kb25lKSAp
CiAgICAgewogICAgICAgICBzdHJ1Y3QgewotICAgICAgICAgICAgdW5zaWduZWQgdmNwdToxNiwg
ZG9tOjE2OworICAgICAgICAgICAgdW5zaWduZWQgdW5pdDoxNiwgZG9tOjE2OwogICAgICAgICAg
ICAgdW5zaWduZWQgcG9zOwogICAgICAgICB9IGQ7Ci0gICAgICAgIGQuZG9tID0gc3ZjLT52Y3B1
LT5kb21haW4tPmRvbWFpbl9pZDsKLSAgICAgICAgZC52Y3B1ID0gc3ZjLT52Y3B1LT52Y3B1X2lk
OworICAgICAgICBkLmRvbSA9IHN2Yy0+dW5pdC0+ZG9tYWluLT5kb21haW5faWQ7CisgICAgICAg
IGQudW5pdCA9IHN2Yy0+dW5pdC0+dW5pdF9pZDsKICAgICAgICAgZC5wb3MgPSBwb3M7CiAgICAg
ICAgIF9fdHJhY2VfdmFyKFRSQ19DU0NIRUQyX1JVTlFfUE9TLCAxLAogICAgICAgICAgICAgICAg
ICAgICBzaXplb2YoZCksCkBAIC0xMzE1LDcgKzEzMTUsNyBAQCBydW5xX2luc2VydChjb25zdCBz
dHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YykKIAogc3RhdGlj
IGlubGluZSB2b2lkIHJ1bnFfcmVtb3ZlKHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YykKIHsKLSAg
ICBBU1NFUlQodmNwdV9vbl9ydW5xKHN2YykpOworICAgIEFTU0VSVCh1bml0X29uX3J1bnEoc3Zj
KSk7CiAgICAgbGlzdF9kZWxfaW5pdCgmc3ZjLT5ydW5xX2VsZW0pOwogfQogCkBAIC0xMzQxLDgg
KzEzNDEsOCBAQCBzdGF0aWMgaW5saW5lIGJvb2wgaXNfcHJlZW1wdGFibGUoY29uc3Qgc3RydWN0
IGNzY2hlZDJfdW5pdCAqc3ZjLAogICAgIGlmICggcmF0ZWxpbWl0IDw9IENTQ0hFRDJfUkFURUxJ
TUlUX1RJQ0tMRV9UT0xFUkFOQ0UgKQogICAgICAgICByZXR1cm4gdHJ1ZTsKIAotICAgIEFTU0VS
VChzdmMtPnZjcHUtPnNjaGVkX3VuaXQtPmlzX3J1bm5pbmcpOwotICAgIHJldHVybiBub3cgLSBz
dmMtPnZjcHUtPnNjaGVkX3VuaXQtPnN0YXRlX2VudHJ5X3RpbWUgPgorICAgIEFTU0VSVChzdmMt
PnVuaXQtPmlzX3J1bm5pbmcpOworICAgIHJldHVybiBub3cgLSBzdmMtPnVuaXQtPnN0YXRlX2Vu
dHJ5X3RpbWUgPgogICAgICAgICAgICByYXRlbGltaXQgLSBDU0NIRUQyX1JBVEVMSU1JVF9USUNL
TEVfVE9MRVJBTkNFOwogfQogCkBAIC0xMzcwLDE3ICsxMzcwLDE3IEBAIHN0YXRpYyBzX3RpbWVf
dCB0aWNrbGVfc2NvcmUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzX3RpbWVfdCBub3cs
CiAKICAgICAvKgogICAgICAqIFdlIGFyZSBkZWFsaW5nIHdpdGggY3B1cyB0aGF0IGFyZSBtYXJr
ZWQgbm9uLWlkbGUgKGkuZS4sIHRoYXQgYXJlIG5vdAotICAgICAqIGluIHJxZC0+aWRsZSkuIEhv
d2V2ZXIsIHNvbWUgb2YgdGhlbSBtYXkgYmUgcnVubmluZyB0aGVpciBpZGxlIHZjcHUsCisgICAg
ICogaW4gcnFkLT5pZGxlKS4gSG93ZXZlciwgc29tZSBvZiB0aGVtIG1heSBiZSBydW5uaW5nIHRo
ZWlyIGlkbGUgdW5pdCwKICAgICAgKiBpZiB0YWtpbmcgY2FyZSBvZiB0YXNrbGV0cy4gSW4gdGhh
dCBjYXNlLCB3ZSB3YW50IHRvIGxlYXZlIGl0IGFsb25lLgogICAgICAqLwotICAgIGlmICggdW5s
aWtlbHkoaXNfaWRsZV92Y3B1KGN1ci0+dmNwdSkgfHwKKyAgICBpZiAoIHVubGlrZWx5KGlzX2lk
bGVfdW5pdChjdXItPnVuaXQpIHx8CiAgICAgICAgICAhaXNfcHJlZW1wdGFibGUoY3VyLCBub3cs
IE1JQ1JPU0VDUyhwcnYtPnJhdGVsaW1pdF91cykpKSApCiAgICAgICAgIHJldHVybiAtMTsKIAog
ICAgIGJ1cm5fY3JlZGl0cyhycWQsIGN1ciwgbm93KTsKIAogICAgIHNjb3JlID0gbmV3LT5jcmVk
aXQgLSBjdXItPmNyZWRpdDsKLSAgICBpZiAoIG5ldy0+dmNwdS0+cHJvY2Vzc29yICE9IGNwdSAp
CisgICAgaWYgKCBzY2hlZF91bml0X21hc3RlcihuZXctPnVuaXQpICE9IGNwdSApCiAgICAgICAg
IHNjb3JlIC09IENTQ0hFRDJfTUlHUkFURV9SRVNJU1Q7CiAKICAgICAvKgpAQCAtMTM5MSwyMSAr
MTM5MSwyMSBAQCBzdGF0aWMgc190aW1lX3QgdGlja2xlX3Njb3JlKGNvbnN0IHN0cnVjdCBzY2hl
ZHVsZXIgKm9wcywgc190aW1lX3Qgbm93LAogICAgICAqLwogICAgIGlmICggc2NvcmUgPiAwICkK
ICAgICB7Ci0gICAgICAgIGlmICggY3B1bWFza190ZXN0X2NwdShjcHUsIG5ldy0+dmNwdS0+c2No
ZWRfdW5pdC0+Y3B1X3NvZnRfYWZmaW5pdHkpICkKKyAgICAgICAgaWYgKCBjcHVtYXNrX3Rlc3Rf
Y3B1KGNwdSwgbmV3LT51bml0LT5jcHVfc29mdF9hZmZpbml0eSkgKQogICAgICAgICAgICAgc2Nv
cmUgKz0gQ1NDSEVEMl9DUkVESVRfSU5JVDsKIAotICAgICAgICBpZiAoICFjcHVtYXNrX3Rlc3Rf
Y3B1KGNwdSwgY3VyLT52Y3B1LT5zY2hlZF91bml0LT5jcHVfc29mdF9hZmZpbml0eSkgKQorICAg
ICAgICBpZiAoICFjcHVtYXNrX3Rlc3RfY3B1KGNwdSwgY3VyLT51bml0LT5jcHVfc29mdF9hZmZp
bml0eSkgKQogICAgICAgICAgICAgc2NvcmUgKz0gQ1NDSEVEMl9DUkVESVRfSU5JVDsKICAgICB9
CiAKICAgICBpZiAoIHVubGlrZWx5KHRiX2luaXRfZG9uZSkgKQogICAgIHsKICAgICAgICAgc3Ry
dWN0IHsKLSAgICAgICAgICAgIHVuc2lnbmVkIHZjcHU6MTYsIGRvbToxNjsKKyAgICAgICAgICAg
IHVuc2lnbmVkIHVuaXQ6MTYsIGRvbToxNjsKICAgICAgICAgICAgIGludCBjcmVkaXQsIHNjb3Jl
OwogICAgICAgICB9IGQ7Ci0gICAgICAgIGQuZG9tID0gY3VyLT52Y3B1LT5kb21haW4tPmRvbWFp
bl9pZDsKLSAgICAgICAgZC52Y3B1ID0gY3VyLT52Y3B1LT52Y3B1X2lkOworICAgICAgICBkLmRv
bSA9IGN1ci0+dW5pdC0+ZG9tYWluLT5kb21haW5faWQ7CisgICAgICAgIGQudW5pdCA9IGN1ci0+
dW5pdC0+dW5pdF9pZDsKICAgICAgICAgZC5jcmVkaXQgPSBjdXItPmNyZWRpdDsKICAgICAgICAg
ZC5zY29yZSA9IHNjb3JlOwogICAgICAgICBfX3RyYWNlX3ZhcihUUkNfQ1NDSEVEMl9USUNLTEVf
Q0hFQ0ssIDEsCkBAIC0xNDE3LDE0ICsxNDE3LDE0IEBAIHN0YXRpYyBzX3RpbWVfdCB0aWNrbGVf
c2NvcmUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzX3RpbWVfdCBub3csCiB9CiAKIC8q
Ci0gKiBDaGVjayB3aGF0IHByb2Nlc3NvciBpdCBpcyBiZXN0IHRvICd3YWtlJywgZm9yIHBpY2tp
bmcgdXAgYSB2Y3B1IHRoYXQgaGFzCisgKiBDaGVjayB3aGF0IHByb2Nlc3NvciBpdCBpcyBiZXN0
IHRvICd3YWtlJywgZm9yIHBpY2tpbmcgdXAgYW4gdW5pdCB0aGF0IGhhcwogICoganVzdCBiZWVu
IHB1dCAoYmFjaykgaW4gdGhlIHJ1bnF1ZXVlLiBMb2dpYyBpcyBhcyBmb2xsb3dzOgogICogIDEu
IGlmIHRoZXJlIGFyZSBpZGxlIHByb2Nlc3NvcnMgaW4gdGhlIHJ1bnEsIHdha2Ugb25lIG9mIHRo
ZW07Ci0gKiAgMi4gaWYgdGhlcmUgYXJlbid0IGlkbGUgcHJvY2Vzc29yLCBjaGVjayB0aGUgb25l
IHdlcmUgdGhlIHZjcHUgd2FzCisgKiAgMi4gaWYgdGhlcmUgYXJlbid0IGlkbGUgcHJvY2Vzc29y
LCBjaGVjayB0aGUgb25lIHdlcmUgdGhlIHVuaXQgd2FzCiAgKiAgICAgcnVubmluZyBiZWZvcmUg
dG8gc2VlIGlmIHdlIGNhbiBwcmVlbXB0IHdoYXQncyBydW5uaW5nIHRoZXJlIG5vdwogICogICAg
IChhbmQgaGVuY2UgZG9pbmcganVzdCBvbmUgbWlncmF0aW9uKTsKLSAqICAzLiBsYXN0IHN0YW5k
OiBjaGVjayBhbGwgcHJvY2Vzc29ycyBhbmQgc2VlIGlmIHRoZSB2Y3B1IGlzIGluIHJpZ2h0Ci0g
KiAgICAgb2YgcHJlZW1wdGluZyBhbnkgb2YgdGhlIG90aGVyIHZjcHVzIHJ1bm5pbmcgb24gdGhl
bSAodGhpcyByZXF1aXJlcworICogIDMuIGxhc3Qgc3RhbmQ6IGNoZWNrIGFsbCBwcm9jZXNzb3Jz
IGFuZCBzZWUgaWYgdGhlIHVuaXQgaXMgaW4gcmlnaHQKKyAqICAgICBvZiBwcmVlbXB0aW5nIGFu
eSBvZiB0aGUgb3RoZXIgdW5pdHMgcnVubmluZyBvbiB0aGVtICh0aGlzIHJlcXVpcmVzCiAgKiAg
ICAgdHdvIG1pZ3JhdGlvbnMsIGFuZCB0aGF0J3MgaW5kZWVkIHdoeSBpdCBpcyBsZWZ0IGFzIHRo
ZSBsYXN0IHN0YW5kKS4KICAqCiAgKiBOb3RlIHRoYXQgd2hlbiB3ZSBzYXkgJ2lkbGUgcHJvY2Vz
c29ycycgd2hhdCB3ZSByZWFsbHkgbWVhbiBpcyAocHJldHR5CkBAIC0xNDM3LDEwICsxNDM3LDEw
IEBAIHJ1bnFfdGlja2xlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IGNzY2hl
ZDJfdW5pdCAqbmV3LCBzX3RpbWVfdCBub3cpCiB7CiAgICAgaW50IGksIGlwaWQgPSAtMTsKICAg
ICBzX3RpbWVfdCBtYXggPSAwOwotICAgIHN0cnVjdCBzY2hlZF91bml0ICp1bml0ID0gbmV3LT52
Y3B1LT5zY2hlZF91bml0OwotICAgIHVuc2lnbmVkIGludCBicywgY3B1ID0gbmV3LT52Y3B1LT5w
cm9jZXNzb3I7CisgICAgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQgPSBuZXctPnVuaXQ7CisgICAg
dW5zaWduZWQgaW50IGJzLCBjcHUgPSBzY2hlZF91bml0X21hc3Rlcih1bml0KTsKICAgICBzdHJ1
Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQgPSBjMnJxZChvcHMsIGNwdSk7Ci0gICAgY3B1
bWFza190ICpvbmxpbmUgPSBjcHVwb29sX2RvbWFpbl9jcHVtYXNrKG5ldy0+dmNwdS0+ZG9tYWlu
KTsKKyAgICBjcHVtYXNrX3QgKm9ubGluZSA9IGNwdXBvb2xfZG9tYWluX2NwdW1hc2sodW5pdC0+
ZG9tYWluKTsKICAgICBjcHVtYXNrX3QgbWFzazsKIAogICAgIEFTU0VSVChuZXctPnJxZCA9PSBy
cWQpOwpAQCAtMTQ0OCwxMyArMTQ0OCwxMyBAQCBydW5xX3RpY2tsZShjb25zdCBzdHJ1Y3Qgc2No
ZWR1bGVyICpvcHMsIHN0cnVjdCBjc2NoZWQyX3VuaXQgKm5ldywgc190aW1lX3Qgbm93KQogICAg
IGlmICggdW5saWtlbHkodGJfaW5pdF9kb25lKSApCiAgICAgewogICAgICAgICBzdHJ1Y3Qgewot
ICAgICAgICAgICAgdW5zaWduZWQgdmNwdToxNiwgZG9tOjE2OworICAgICAgICAgICAgdW5zaWdu
ZWQgdW5pdDoxNiwgZG9tOjE2OwogICAgICAgICAgICAgdW5zaWduZWQgcHJvY2Vzc29yOwogICAg
ICAgICAgICAgaW50IGNyZWRpdDsKICAgICAgICAgfSBkOwotICAgICAgICBkLmRvbSA9IG5ldy0+
dmNwdS0+ZG9tYWluLT5kb21haW5faWQ7Ci0gICAgICAgIGQudmNwdSA9IG5ldy0+dmNwdS0+dmNw
dV9pZDsKLSAgICAgICAgZC5wcm9jZXNzb3IgPSBuZXctPnZjcHUtPnByb2Nlc3NvcjsKKyAgICAg
ICAgZC5kb20gPSB1bml0LT5kb21haW4tPmRvbWFpbl9pZDsKKyAgICAgICAgZC51bml0ID0gdW5p
dC0+dW5pdF9pZDsKKyAgICAgICAgZC5wcm9jZXNzb3IgPSBjcHU7CiAgICAgICAgIGQuY3JlZGl0
ID0gbmV3LT5jcmVkaXQ7CiAgICAgICAgIF9fdHJhY2VfdmFyKFRSQ19DU0NIRUQyX1RJQ0tMRV9O
RVcsIDEsCiAgICAgICAgICAgICAgICAgICAgIHNpemVvZihkKSwKQEAgLTE0NjIsMTEgKzE0NjIs
MTEgQEAgcnVucV90aWNrbGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgY3Nj
aGVkMl91bml0ICpuZXcsIHNfdGltZV90IG5vdykKICAgICB9CiAKICAgICAvKgotICAgICAqIEV4
Y2x1c2l2ZSBwaW5uaW5nIGlzIHdoZW4gYSB2Y3B1IGhhcyBoYXJkLWFmZmluaXR5IHdpdGggb25s
eSBvbmUKLSAgICAgKiBjcHUsIGFuZCB0aGVyZSBpcyBubyBvdGhlciB2Y3B1IHRoYXQgaGFzIGhh
cmQtYWZmaW5pdHkgd2l0aCB0aGF0CisgICAgICogRXhjbHVzaXZlIHBpbm5pbmcgaXMgd2hlbiBh
biB1bml0IGhhcyBoYXJkLWFmZmluaXR5IHdpdGggb25seSBvbmUKKyAgICAgKiBjcHUsIGFuZCB0
aGVyZSBpcyBubyBvdGhlciB1bml0IHRoYXQgaGFzIGhhcmQtYWZmaW5pdHkgd2l0aCB0aGF0CiAg
ICAgICogc2FtZSBjcHUuIFRoaXMgaXMgaW5mcmVxdWVudCwgYnV0IGlmIGl0IGhhcHBlbnMsIGlz
IGZvciBhY2hpZXZpbmcKICAgICAgKiB0aGUgbW9zdCBwb3NzaWJsZSBkZXRlcm1pbmlzbSwgYW5k
IGxlYXN0IHBvc3NpYmxlIG92ZXJoZWFkIGZvcgotICAgICAqIHRoZSB2Y3B1cyBpbiBxdWVzdGlv
bi4KKyAgICAgKiB0aGUgdW5pdHMgaW4gcXVlc3Rpb24uCiAgICAgICoKICAgICAgKiBUcnkgdG8g
aWRlbnRpZnkgdGhlIHZhc3QgbWFqb3JpdHkgb2YgdGhlc2Ugc2l0dWF0aW9ucywgYW5kIGRlYWwK
ICAgICAgKiB3aXRoIHRoZW0gcXVpY2tseS4KQEAgLTE1MzMsNyArMTUzMyw3IEBAIHJ1bnFfdGlj
a2xlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IGNzY2hlZDJfdW5pdCAqbmV3
LCBzX3RpbWVfdCBub3cpCiAgICAgLyoKICAgICAgKiBOb3RlIHRoYXQsIGlmIHdlIGFyZSBoZXJl
LCBpdCBtZWFucyB3ZSBoYXZlIGRvbmUgdGhlIGhhcmQtYWZmaW5pdHkKICAgICAgKiBiYWxhbmNp
bmcgc3RlcCBvZiB0aGUgbG9vcCwgYW5kIGhlbmNlIHdoYXQgd2UgaGF2ZSBpbiBjcHVtYXNrX3Nj
cmF0Y2gKLSAgICAgKiBpcyB3aGF0IHdlIHB1dCB0aGVyZSBmb3IgbGFzdCwgaS5lLiwgbmV3J3Mg
dmNwdV9oYXJkX2FmZmluaXR5ICYgb25saW5lCisgICAgICogaXMgd2hhdCB3ZSBwdXQgdGhlcmUg
Zm9yIGxhc3QsIGkuZS4sIG5ldydzIHVuaXRfaGFyZF9hZmZpbml0eSAmIG9ubGluZQogICAgICAq
IHdoaWNoIGlzIGV4YWN0bHkgd2hhdCB3ZSBuZWVkIGZvciB0aGUgbmV4dCBwYXJ0IG9mIHRoZSBm
dW5jdGlvbi4KICAgICAgKi8KIApAQCAtMTU0NCw3ICsxNTQ0LDcgQEAgcnVucV90aWNrbGUoY29u
c3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgY3NjaGVkMl91bml0ICpuZXcsIHNfdGlt
ZV90IG5vdykKICAgICAgKgogICAgICAqIEZvciBkZWNpZGluZyB3aGljaCBjcHUgdG8gdGlja2xl
LCB3ZSB1c2UgdGlja2xlX3Njb3JlKCksIHdoaWNoIHdpbGwKICAgICAgKiBmYWN0b3IgaW4gYm90
aCBuZXcncyBzb2Z0LWFmZmluaXR5LCBhbmQgdGhlIHNvZnQtYWZmaW5pdHkgb2YgdGhlCi0gICAg
ICogdmNwdSBydW5uaW5nIG9uIGVhY2ggY3B1IHRoYXQgd2UgY29uc2lkZXIuCisgICAgICogdW5p
dCBydW5uaW5nIG9uIGVhY2ggY3B1IHRoYXQgd2UgY29uc2lkZXIuCiAgICAgICovCiAgICAgY3B1
bWFza19hbmRub3QoJm1hc2ssICZycWQtPmFjdGl2ZSwgJnJxZC0+aWRsZSk7CiAgICAgY3B1bWFz
a19hbmRub3QoJm1hc2ssICZtYXNrLCAmcnFkLT50aWNrbGVkKTsKQEAgLTE1ODksNyArMTU4OSw3
IEBAIHJ1bnFfdGlja2xlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IGNzY2hl
ZDJfdW5pdCAqbmV3LCBzX3RpbWVfdCBub3cpCiAgICAgICAgIHJldHVybjsKICAgICB9CiAKLSAg
ICBBU1NFUlQoIWlzX2lkbGVfdmNwdShjdXJyX29uX2NwdShpcGlkKS0+dmNwdV9saXN0KSk7Cisg
ICAgQVNTRVJUKCFpc19pZGxlX3VuaXQoY3Vycl9vbl9jcHUoaXBpZCkpKTsKICAgICBTQ0hFRF9T
VEFUX0NSQU5LKHRpY2tsZWRfYnVzeV9jcHUpOwogIHRpY2tsZToKICAgICBCVUdfT04oaXBpZCA9
PSAtMSk7CkBAIC0xNjI0LDE2ICsxNjI0LDE2IEBAIHN0YXRpYyB2b2lkIHJlc2V0X2NyZWRpdChj
b25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGludCBjcHUsIHNfdGltZV90IG5vdywKIAogICAg
IC8qCiAgICAgICogVW5kZXIgbm9ybWFsIGNpcmN1bXN0YW5jZXMsIHNuZXh0LT5jcmVkaXQgc2hv
dWxkIG5ldmVyIGJlIGxlc3MKLSAgICAgKiB0aGFuIC1DU0NIRUQyX01JTl9USU1FUi4gIEhvd2V2
ZXIsIHVuZGVyIHNvbWUgY2lyY3Vtc3RhbmNlcywgYQotICAgICAqIHZjcHUgd2l0aCBsb3cgY3Jl
ZGl0cyBtYXkgYmUgYWxsb3dlZCB0byBydW4gbG9uZyBlbm91Z2ggdGhhdAorICAgICAqIHRoYW4g
LUNTQ0hFRDJfTUlOX1RJTUVSLiAgSG93ZXZlciwgdW5kZXIgc29tZSBjaXJjdW1zdGFuY2VzLCBh
bgorICAgICAqIHVuaXQgd2l0aCBsb3cgY3JlZGl0cyBtYXkgYmUgYWxsb3dlZCB0byBydW4gbG9u
ZyBlbm91Z2ggdGhhdAogICAgICAqIGl0cyBjcmVkaXRzIGFyZSBhY3R1YWxseSBsZXNzIHRoYW4g
LUNTQ0hFRDJfQ1JFRElUX0lOSVQuCi0gICAgICogKEluc3RhbmNlcyBoYXZlIGJlZW4gb2JzZXJ2
ZWQsIGZvciBleGFtcGxlLCB3aGVyZSBhIHZjcHUgd2l0aAorICAgICAqIChJbnN0YW5jZXMgaGF2
ZSBiZWVuIG9ic2VydmVkLCBmb3IgZXhhbXBsZSwgd2hlcmUgYW4gdW5pdCB3aXRoCiAgICAgICog
MjAwdXMgb2YgY3JlZGl0IHdhcyBhbGxvd2VkIHRvIHJ1biBmb3IgMTFtcywgZ2l2aW5nIGl0IC0x
MC44bXMKICAgICAgKiBvZiBjcmVkaXQuICBUaHVzIGl0IHdhcyBzdGlsbCBuZWdhdGl2ZSBldmVu
IGFmdGVyIHRoZSByZXNldC4pCiAgICAgICoKICAgICAgKiBJZiB0aGlzIGlzIHRoZSBjYXNlIGZv
ciBzbmV4dCwgd2Ugc2ltcGx5IHdhbnQgdG8ga2VlcCBtb3ZpbmcKICAgICAgKiBldmVyeW9uZSB1
cCB1bnRpbCBpdCBpcyBpbiB0aGUgYmxhY2sgYWdhaW4uICBUaGlzIGZhaXIgYmVjYXVzZQotICAg
ICAqIG5vbmUgb2YgdGhlIG90aGVyIHZjcHVzIHdhbnQgdG8gcnVuIGF0IHRoZSBtb21lbnQuCisg
ICAgICogbm9uZSBvZiB0aGUgb3RoZXIgdW5pdHMgd2FudCB0byBydW4gYXQgdGhlIG1vbWVudC4K
ICAgICAgKgogICAgICAqIFJhdGhlciB0aGFuIGxvb3BpbmcsIGhvd2V2ZXIsIHdlIGp1c3QgY2Fs
Y3VsYXRlIGEgbXVsdGlwbGllciwKICAgICAgKiBhdm9pZGluZyBhbiBpbnRlZ2VyIGRpdmlzaW9u
IGFuZCBtdWx0aXBsaWNhdGlvbiBpbiB0aGUgY29tbW9uCkBAIC0xNjUwLDE2ICsxNjUwLDE2IEBA
IHN0YXRpYyB2b2lkIHJlc2V0X2NyZWRpdChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGlu
dCBjcHUsIHNfdGltZV90IG5vdywKICAgICAgICAgaW50IHN0YXJ0X2NyZWRpdDsKIAogICAgICAg
ICBzdmMgPSBsaXN0X2VudHJ5KGl0ZXIsIHN0cnVjdCBjc2NoZWQyX3VuaXQsIHJxZF9lbGVtKTsK
LSAgICAgICAgc3ZjX2NwdSA9IHN2Yy0+dmNwdS0+cHJvY2Vzc29yOworICAgICAgICBzdmNfY3B1
ID0gc2NoZWRfdW5pdF9tYXN0ZXIoc3ZjLT51bml0KTsKIAotICAgICAgICBBU1NFUlQoIWlzX2lk
bGVfdmNwdShzdmMtPnZjcHUpKTsKKyAgICAgICAgQVNTRVJUKCFpc19pZGxlX3VuaXQoc3ZjLT51
bml0KSk7CiAgICAgICAgIEFTU0VSVChzdmMtPnJxZCA9PSBycWQpOwogCiAgICAgICAgIC8qCiAg
ICAgICAgICAqIElmIHN2YyBpcyBydW5uaW5nLCBpdCBpcyBvdXIgcmVzcG9uc2liaWxpdHkgdG8g
bWFrZSBzdXJlLCBoZXJlLAogICAgICAgICAgKiB0aGF0IHRoZSBjcmVkaXQgaXQgaGFzIHNwZW50
IHNvIGZhciBnZXQgYWNjb3VudGVkLgogICAgICAgICAgKi8KLSAgICAgICAgaWYgKCBzdmMtPnZj
cHUgPT0gY3Vycl9vbl9jcHUoc3ZjX2NwdSktPnZjcHVfbGlzdCApCisgICAgICAgIGlmICggc3Zj
LT51bml0ID09IGN1cnJfb25fY3B1KHN2Y19jcHUpICkKICAgICAgICAgewogICAgICAgICAgICAg
YnVybl9jcmVkaXRzKHJxZCwgc3ZjLCBub3cpOwogICAgICAgICAgICAgLyoKQEAgLTE2OTAsMTIg
KzE2OTAsMTIgQEAgc3RhdGljIHZvaWQgcmVzZXRfY3JlZGl0KGNvbnN0IHN0cnVjdCBzY2hlZHVs
ZXIgKm9wcywgaW50IGNwdSwgc190aW1lX3Qgbm93LAogICAgICAgICBpZiAoIHVubGlrZWx5KHRi
X2luaXRfZG9uZSkgKQogICAgICAgICB7CiAgICAgICAgICAgICBzdHJ1Y3QgewotICAgICAgICAg
ICAgICAgIHVuc2lnbmVkIHZjcHU6MTYsIGRvbToxNjsKKyAgICAgICAgICAgICAgICB1bnNpZ25l
ZCB1bml0OjE2LCBkb206MTY7CiAgICAgICAgICAgICAgICAgaW50IGNyZWRpdF9zdGFydCwgY3Jl
ZGl0X2VuZDsKICAgICAgICAgICAgICAgICB1bnNpZ25lZCBtdWx0aXBsaWVyOwogICAgICAgICAg
ICAgfSBkOwotICAgICAgICAgICAgZC5kb20gPSBzdmMtPnZjcHUtPmRvbWFpbi0+ZG9tYWluX2lk
OwotICAgICAgICAgICAgZC52Y3B1ID0gc3ZjLT52Y3B1LT52Y3B1X2lkOworICAgICAgICAgICAg
ZC5kb20gPSBzdmMtPnVuaXQtPmRvbWFpbi0+ZG9tYWluX2lkOworICAgICAgICAgICAgZC51bml0
ID0gc3ZjLT51bml0LT51bml0X2lkOwogICAgICAgICAgICAgZC5jcmVkaXRfc3RhcnQgPSBzdGFy
dF9jcmVkaXQ7CiAgICAgICAgICAgICBkLmNyZWRpdF9lbmQgPSBzdmMtPmNyZWRpdDsKICAgICAg
ICAgICAgIGQubXVsdGlwbGllciA9IG07CkBAIC0xNzE1LDkgKzE3MTUsOSBAQCB2b2lkIGJ1cm5f
Y3JlZGl0cyhzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQsCiB7CiAgICAgc190aW1l
X3QgZGVsdGE7CiAKLSAgICBBU1NFUlQoc3ZjID09IGNzY2hlZDJfdW5pdChjdXJyX29uX2NwdShz
dmMtPnZjcHUtPnByb2Nlc3NvcikpKTsKKyAgICBBU1NFUlQoc3ZjID09IGNzY2hlZDJfdW5pdChj
dXJyX29uX2NwdShzY2hlZF91bml0X21hc3RlcihzdmMtPnVuaXQpKSkpOwogCi0gICAgaWYgKCB1
bmxpa2VseShpc19pZGxlX3ZjcHUoc3ZjLT52Y3B1KSkgKQorICAgIGlmICggdW5saWtlbHkoaXNf
aWRsZV91bml0KHN2Yy0+dW5pdCkpICkKICAgICB7CiAgICAgICAgIEFTU0VSVChzdmMtPmNyZWRp
dCA9PSBDU0NIRUQyX0lETEVfQ1JFRElUKTsKICAgICAgICAgcmV0dXJuOwpAQCAtMTc0NiwxMiAr
MTc0NiwxMiBAQCB2b2lkIGJ1cm5fY3JlZGl0cyhzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRh
ICpycWQsCiAgICAgaWYgKCB1bmxpa2VseSh0Yl9pbml0X2RvbmUpICkKICAgICB7CiAgICAgICAg
IHN0cnVjdCB7Ci0gICAgICAgICAgICB1bnNpZ25lZCB2Y3B1OjE2LCBkb206MTY7CisgICAgICAg
ICAgICB1bnNpZ25lZCB1bml0OjE2LCBkb206MTY7CiAgICAgICAgICAgICBpbnQgY3JlZGl0LCBi
dWRnZXQ7CiAgICAgICAgICAgICBpbnQgZGVsdGE7CiAgICAgICAgIH0gZDsKLSAgICAgICAgZC5k
b20gPSBzdmMtPnZjcHUtPmRvbWFpbi0+ZG9tYWluX2lkOwotICAgICAgICBkLnZjcHUgPSBzdmMt
PnZjcHUtPnZjcHVfaWQ7CisgICAgICAgIGQuZG9tID0gc3ZjLT51bml0LT5kb21haW4tPmRvbWFp
bl9pZDsKKyAgICAgICAgZC51bml0ID0gc3ZjLT51bml0LT51bml0X2lkOwogICAgICAgICBkLmNy
ZWRpdCA9IHN2Yy0+Y3JlZGl0OwogICAgICAgICBkLmJ1ZGdldCA9IGhhc19jYXAoc3ZjKSA/ICBz
dmMtPmJ1ZGdldCA6IElOVF9NSU47CiAgICAgICAgIGQuZGVsdGEgPSBkZWx0YTsKQEAgLTE3NjUs
MzkgKzE3NjUsMzkgQEAgdm9pZCBidXJuX2NyZWRpdHMoc3RydWN0IGNzY2hlZDJfcnVucXVldWVf
ZGF0YSAqcnFkLAogICogQnVkZ2V0LXJlbGF0ZWQgY29kZS4KICAqLwogCi1zdGF0aWMgdm9pZCBw
YXJrX3ZjcHUoc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQorc3RhdGljIHZvaWQgcGFya191bml0
KHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YykKIHsKLSAgICBzdHJ1Y3QgdmNwdSAqdiA9IHN2Yy0+
dmNwdTsKKyAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCA9IHN2Yy0+dW5pdDsKIAogICAgIEFT
U0VSVChzcGluX2lzX2xvY2tlZCgmc3ZjLT5zZG9tLT5idWRnZXRfbG9jaykpOwogCiAgICAgLyoK
LSAgICAgKiBJdCB3YXMgaW1wb3NzaWJsZSB0byBmaW5kIGJ1ZGdldCBmb3IgdGhpcyB2Q1BVLCBz
byBpdCBoYXMgdG8gYmUKKyAgICAgKiBJdCB3YXMgaW1wb3NzaWJsZSB0byBmaW5kIGJ1ZGdldCBm
b3IgdGhpcyB1bml0LCBzbyBpdCBoYXMgdG8gYmUKICAgICAgKiAicGFya2VkIi4gVGhpcyBpbXBs
aWVzIGl0IGlzIG5vdCBydW5uYWJsZSwgc28gd2UgbWFyayBpdCBhcyBzdWNoIGluCi0gICAgICog
aXRzIHBhdXNlX2ZsYWdzLiBJZiB0aGUgdkNQVSBpcyBjdXJyZW50bHkgc2NoZWR1bGVkICh3aGlj
aCBtZWFucyB3ZQorICAgICAqIGl0cyBwYXVzZV9mbGFncy4gSWYgdGhlIHVuaXQgaXMgY3VycmVu
dGx5IHNjaGVkdWxlZCAod2hpY2ggbWVhbnMgd2UKICAgICAgKiBhcmUgaGVyZSBhZnRlciBiZWlu
ZyBjYWxsZWQgZnJvbSB3aXRoaW4gY3NjaGVkX3NjaGVkdWxlKCkpLCBmbGFnZ2luZwogICAgICAq
IGlzIGVub3VnaCwgYXMgd2UnbGwgY2hvb3NlIHNvbWVvbmUgZWxzZSwgYW5kIHRoZW4gY29udGV4
dF9zYXZlZCgpCiAgICAgICogd2lsbCB0YWtlIGNhcmUgb2YgdXBkYXRpbmcgdGhlIGxvYWQgcHJv
cGVybHkuCiAgICAgICoKLSAgICAgKiBJZiwgT1RPSCwgdGhlIHZDUFUgaXMgc2l0dGluZyBpbiB0
aGUgcnVucXVldWUgKHdoaWNoIG1lYW5zIHdlIGFyZSBoZXJlCisgICAgICogSWYsIE9UT0gsIHRo
ZSB1bml0IGlzIHNpdHRpbmcgaW4gdGhlIHJ1bnF1ZXVlICh3aGljaCBtZWFucyB3ZSBhcmUgaGVy
ZQogICAgICAqIGFmdGVyIGJlaW5nIGNhbGxlZCBmcm9tIHdpdGhpbiBydW5xX2NhbmRpZGF0ZSgp
KSwgd2UgbXVzdCBnbyBhbGwgdGhlCiAgICAgICogd2F5IGRvd24gdG8gdGFraW5nIGl0IG91dCBv
ZiB0aGVyZSwgYW5kIHVwZGF0aW5nIHRoZSBsb2FkIGFjY29yZGluZ2x5LgogICAgICAqCi0gICAg
ICogSW4gYm90aCBjYXNlcywgd2UgYWxzbyBhZGQgaXQgdG8gdGhlIGxpc3Qgb2YgcGFya2VkIHZD
UFVzIG9mIHRoZSBkb21haW4uCisgICAgICogSW4gYm90aCBjYXNlcywgd2UgYWxzbyBhZGQgaXQg
dG8gdGhlIGxpc3Qgb2YgcGFya2VkIHVuaXRzIG9mIHRoZSBkb21haW4uCiAgICAgICovCi0gICAg
X19zZXRfYml0KF9WUEZfcGFya2VkLCAmdi0+cGF1c2VfZmxhZ3MpOwotICAgIGlmICggdmNwdV9v
bl9ydW5xKHN2YykgKQorICAgIHNjaGVkX3NldF9wYXVzZV9mbGFncyh1bml0LCBfVlBGX3Bhcmtl
ZCk7CisgICAgaWYgKCB1bml0X29uX3J1bnEoc3ZjKSApCiAgICAgewogICAgICAgICBydW5xX3Jl
bW92ZShzdmMpOwogICAgICAgICB1cGRhdGVfbG9hZChzdmMtPnNkb20tPmRvbS0+Y3B1cG9vbC0+
c2NoZWQsIHN2Yy0+cnFkLCBzdmMsIC0xLCBOT1coKSk7CiAgICAgfQotICAgIGxpc3RfYWRkKCZz
dmMtPnBhcmtlZF9lbGVtLCAmc3ZjLT5zZG9tLT5wYXJrZWRfdmNwdXMpOworICAgIGxpc3RfYWRk
KCZzdmMtPnBhcmtlZF9lbGVtLCAmc3ZjLT5zZG9tLT5wYXJrZWRfdW5pdHMpOwogfQogCi1zdGF0
aWMgYm9vbCB2Y3B1X2dyYWJfYnVkZ2V0KHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YykKK3N0YXRp
YyBib29sIHVuaXRfZ3JhYl9idWRnZXQoc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQogewogICAg
IHN0cnVjdCBjc2NoZWQyX2RvbSAqc2RvbSA9IHN2Yy0+c2RvbTsKLSAgICB1bnNpZ25lZCBpbnQg
Y3B1ID0gc3ZjLT52Y3B1LT5wcm9jZXNzb3I7CisgICAgdW5zaWduZWQgaW50IGNwdSA9IHNjaGVk
X3VuaXRfbWFzdGVyKHN2Yy0+dW5pdCk7CiAKICAgICBBU1NFUlQoc3Bpbl9pc19sb2NrZWQoZ2V0
X3NjaGVkX3JlcyhjcHUpLT5zY2hlZHVsZV9sb2NrKSk7CiAKQEAgLTE4MDksOSArMTgwOSw5IEBA
IHN0YXRpYyBib29sIHZjcHVfZ3JhYl9idWRnZXQoc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQog
CiAgICAgLyoKICAgICAgKiBIZXJlLCBzdmMtPmJ1ZGdldCBpcyA8PSAwIChhcywgaWYgaXQgd2Fz
ID4gMCwgd2UnZCBoYXZlIHRha2VuIHRoZSBpZgotICAgICAqIGFib3ZlISkuIFRoYXQgYmFzaWNh
bGx5IG1lYW5zIHRoZSB2Q1BVIGhhcyBvdmVycnVuIGEgYml0IC0tYmVjYXVzZSBvZgorICAgICAq
IGFib3ZlISkuIFRoYXQgYmFzaWNhbGx5IG1lYW5zIHRoZSB1bml0IGhhcyBvdmVycnVuIGEgYml0
IC0tYmVjYXVzZSBvZgogICAgICAqIHZhcmlvdXMgcmVhc29ucy0tIGFuZCB3ZSB3YW50IHRvIHRh
a2UgdGhhdCBpbnRvIGFjY291bnQuIFdpdGggdGhlICs9LAotICAgICAqIHdlIGFyZSBhY3R1YWxs
eSBzdWJ0cmFjdGluZyB0aGUgYW1vdW50IG9mIGJ1ZGdldCB0aGUgdkNQVSBoYXMKKyAgICAgKiB3
ZSBhcmUgYWN0dWFsbHkgc3VidHJhY3RpbmcgdGhlIGFtb3VudCBvZiBidWRnZXQgdGhlIHVuaXQg
aGFzCiAgICAgICogb3ZlcmNvbnN1bWVkLCBmcm9tIHRoZSB0b3RhbCBkb21haW4gYnVkZ2V0Lgog
ICAgICAqLwogICAgIHNkb20tPmJ1ZGdldCArPSBzdmMtPmJ1ZGdldDsKQEAgLTE4MzIsNyArMTgz
Miw3IEBAIHN0YXRpYyBib29sIHZjcHVfZ3JhYl9idWRnZXQoc3RydWN0IGNzY2hlZDJfdW5pdCAq
c3ZjKQogICAgIGVsc2UKICAgICB7CiAgICAgICAgIHN2Yy0+YnVkZ2V0ID0gMDsKLSAgICAgICAg
cGFya192Y3B1KHN2Yyk7CisgICAgICAgIHBhcmtfdW5pdChzdmMpOwogICAgIH0KIAogICAgIHNw
aW5fdW5sb2NrKCZzZG9tLT5idWRnZXRfbG9jayk7CkBAIC0xODQxLDEwICsxODQxLDEwIEBAIHN0
YXRpYyBib29sIHZjcHVfZ3JhYl9idWRnZXQoc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQogfQog
CiBzdGF0aWMgdm9pZAotdmNwdV9yZXR1cm5fYnVkZ2V0KHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2
Yywgc3RydWN0IGxpc3RfaGVhZCAqcGFya2VkKQordW5pdF9yZXR1cm5fYnVkZ2V0KHN0cnVjdCBj
c2NoZWQyX3VuaXQgKnN2Yywgc3RydWN0IGxpc3RfaGVhZCAqcGFya2VkKQogewogICAgIHN0cnVj
dCBjc2NoZWQyX2RvbSAqc2RvbSA9IHN2Yy0+c2RvbTsKLSAgICB1bnNpZ25lZCBpbnQgY3B1ID0g
c3ZjLT52Y3B1LT5wcm9jZXNzb3I7CisgICAgdW5zaWduZWQgaW50IGNwdSA9IHNjaGVkX3VuaXRf
bWFzdGVyKHN2Yy0+dW5pdCk7CiAKICAgICBBU1NFUlQoc3Bpbl9pc19sb2NrZWQoZ2V0X3NjaGVk
X3JlcyhjcHUpLT5zY2hlZHVsZV9sb2NrKSk7CiAgICAgQVNTRVJUKGxpc3RfZW1wdHkocGFya2Vk
KSk7CkBAIC0xODUzLDcgKzE4NTMsNyBAQCB2Y3B1X3JldHVybl9idWRnZXQoc3RydWN0IGNzY2hl
ZDJfdW5pdCAqc3ZjLCBzdHJ1Y3QgbGlzdF9oZWFkICpwYXJrZWQpCiAgICAgc3Bpbl9sb2NrKCZz
ZG9tLT5idWRnZXRfbG9jayk7CiAKICAgICAvKgotICAgICAqIFRoZSB2Q1BVIGlzIHN0b3BwaW5n
IHJ1bm5pbmcgKGUuZy4sIGJlY2F1c2UgaXQncyBibG9ja2luZywgb3IgaXQgaGFzCisgICAgICog
VGhlIHVuaXQgaXMgc3RvcHBpbmcgcnVubmluZyAoZS5nLiwgYmVjYXVzZSBpdCdzIGJsb2NraW5n
LCBvciBpdCBoYXMKICAgICAgKiBiZWVuIHByZWVtcHRlZCkuIElmIGl0IGhhc24ndCBjb25zdW1l
ZCBhbGwgdGhlIGJ1ZGdldCBpdCBnb3Qgd2hlbiwKICAgICAgKiBzdGFydGluZyB0byBydW4sIHB1
dCB0aGF0IHJlbWFpbmluZyBhbW91bnQgYmFjayBpbiB0aGUgZG9tYWluJ3MgYnVkZ2V0CiAgICAg
ICogcG9vbC4KQEAgLTE4NjIsNTggKzE4NjIsNTggQEAgdmNwdV9yZXR1cm5fYnVkZ2V0KHN0cnVj
dCBjc2NoZWQyX3VuaXQgKnN2Yywgc3RydWN0IGxpc3RfaGVhZCAqcGFya2VkKQogICAgIHN2Yy0+
YnVkZ2V0ID0gMDsKIAogICAgIC8qCi0gICAgICogTWFraW5nIGJ1ZGdldCBhdmFpbGFibGUgYWdh
aW4gdG8gdGhlIGRvbWFpbiBtZWFucyB0aGF0IHBhcmtlZCB2Q1BVcwotICAgICAqIG1heSBiZSB1
bnBhcmtlZCBhbmQgcnVuLiBUaGV5IGFyZSwgaWYgYW55LCBpbiB0aGUgZG9tYWluJ3MgcGFya2Vk
X3ZjcHVzCisgICAgICogTWFraW5nIGJ1ZGdldCBhdmFpbGFibGUgYWdhaW4gdG8gdGhlIGRvbWFp
biBtZWFucyB0aGF0IHBhcmtlZCB1bml0cworICAgICAqIG1heSBiZSB1bnBhcmtlZCBhbmQgcnVu
LiBUaGV5IGFyZSwgaWYgYW55LCBpbiB0aGUgZG9tYWluJ3MgcGFya2VkX3VuaXRzCiAgICAgICog
bGlzdCwgc28gd2Ugd2FudCB0byBnbyB0aHJvdWdoIHRoYXQgYW5kIHVucGFyayB0aGVtIChzbyB0
aGV5IGNhbiB0cnkKICAgICAgKiB0byBnZXQgc29tZSBidWRnZXQpLgogICAgICAqCiAgICAgICog
VG91Y2hpbmcgdGhlIGxpc3QgcmVxdWlyZXMgdGhlIGJ1ZGdldF9sb2NrLCB3aGljaCB3ZSBob2xk
LiBMZXQncwogICAgICAqIHRoZXJlZm9yZSBwdXQgZXZlcnlvbmUgaW4gdGhhdCBsaXN0IGluIGFu
b3RoZXIsIHRlbXBvcmFyeSBsaXN0LCB3aGljaAotICAgICAqIHRoZW4gdGhlIGNhbGxlciB3aWxs
IHRyYXZlcnNlLCB1bnBhcmtpbmcgdGhlIHZDUFVzIGl0IGZpbmRzIHRoZXJlLgorICAgICAqIHRo
ZW4gdGhlIGNhbGxlciB3aWxsIHRyYXZlcnNlLCB1bnBhcmtpbmcgdGhlIHVuaXRzIGl0IGZpbmRz
IHRoZXJlLgogICAgICAqCiAgICAgICogSW4gZmFjdCwgd2UgY2FuJ3QgZG8gdGhlIGFjdHVhbCB1
bnBhcmtpbmcgaGVyZSwgYmVjYXVzZSB0aGF0IHJlcXVpcmVzCi0gICAgICogdGFraW5nIHRoZSBy
dW5xdWV1ZSBsb2NrIG9mIHRoZSB2Q1BVcyBiZWluZyB1bnBhcmtlZCwgYW5kIHdlIGNhbid0Cisg
ICAgICogdGFraW5nIHRoZSBydW5xdWV1ZSBsb2NrIG9mIHRoZSB1bml0cyBiZWluZyB1bnBhcmtl
ZCwgYW5kIHdlIGNhbid0CiAgICAgICogdGFrZSBhbnkgcnVucXVldWUgbG9ja3Mgd2hpbGUgd2Ug
aG9sZCBhIGJ1ZGdldF9sb2NrLgogICAgICAqLwogICAgIGlmICggc2RvbS0+YnVkZ2V0ID4gMCAp
Ci0gICAgICAgIGxpc3Rfc3BsaWNlX2luaXQoJnNkb20tPnBhcmtlZF92Y3B1cywgcGFya2VkKTsK
KyAgICAgICAgbGlzdF9zcGxpY2VfaW5pdCgmc2RvbS0+cGFya2VkX3VuaXRzLCBwYXJrZWQpOwog
CiAgICAgc3Bpbl91bmxvY2soJnNkb20tPmJ1ZGdldF9sb2NrKTsKIH0KIAogc3RhdGljIHZvaWQK
LXVucGFya19wYXJrZWRfdmNwdXMoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qg
bGlzdF9oZWFkICp2Y3B1cykKK3VucGFya19wYXJrZWRfdW5pdHMoY29uc3Qgc3RydWN0IHNjaGVk
dWxlciAqb3BzLCBzdHJ1Y3QgbGlzdF9oZWFkICp1bml0cykKIHsKICAgICBzdHJ1Y3QgY3NjaGVk
Ml91bml0ICpzdmMsICp0bXA7CiAgICAgc3BpbmxvY2tfdCAqbG9jazsKIAotICAgIGxpc3RfZm9y
X2VhY2hfZW50cnlfc2FmZShzdmMsIHRtcCwgdmNwdXMsIHBhcmtlZF9lbGVtKQorICAgIGxpc3Rf
Zm9yX2VhY2hfZW50cnlfc2FmZSAoIHN2YywgdG1wLCB1bml0cywgcGFya2VkX2VsZW0gKQogICAg
IHsKICAgICAgICAgdW5zaWduZWQgbG9uZyBmbGFnczsKICAgICAgICAgc190aW1lX3Qgbm93Owog
Ci0gICAgICAgIGxvY2sgPSB1bml0X3NjaGVkdWxlX2xvY2tfaXJxc2F2ZShzdmMtPnZjcHUtPnNj
aGVkX3VuaXQsICZmbGFncyk7CisgICAgICAgIGxvY2sgPSB1bml0X3NjaGVkdWxlX2xvY2tfaXJx
c2F2ZShzdmMtPnVuaXQsICZmbGFncyk7CiAKLSAgICAgICAgX19jbGVhcl9iaXQoX1ZQRl9wYXJr
ZWQsICZzdmMtPnZjcHUtPnBhdXNlX2ZsYWdzKTsKKyAgICAgICAgc2NoZWRfY2xlYXJfcGF1c2Vf
ZmxhZ3Moc3ZjLT51bml0LCBfVlBGX3BhcmtlZCk7CiAgICAgICAgIGlmICggdW5saWtlbHkoc3Zj
LT5mbGFncyAmIENTRkxBR19zY2hlZHVsZWQpICkKICAgICAgICAgewogICAgICAgICAgICAgLyoK
ICAgICAgICAgICAgICAqIFdlIGVuZCBoZXJlIGlmIGEgYnVkZ2V0IHJlcGxlbmlzaG1lbnQgYXJy
aXZlZCBiZXR3ZWVuCiAgICAgICAgICAgICAgKiBjc2NoZWQyX3NjaGVkdWxlKCkgKGFuZCwgaW4g
cGFydGljdWxhciwgYWZ0ZXIgYSBjYWxsIHRvCi0gICAgICAgICAgICAgKiB2Y3B1X2dyYWJfYnVk
Z2V0KCkgdGhhdCByZXR1cm5lZCBmYWxzZSksIGFuZAorICAgICAgICAgICAgICogdW5pdF9ncmFi
X2J1ZGdldCgpIHRoYXQgcmV0dXJuZWQgZmFsc2UpLCBhbmQKICAgICAgICAgICAgICAqIGNvbnRl
eHRfc2F2ZWQoKS4gQnkgc2V0dGluZyBfX0NTRkxBR19kZWxheWVkX3J1bnFfYWRkLAotICAgICAg
ICAgICAgICogd2UgdGVsbCBjb250ZXh0X3NhdmVkKCkgdG8gcHV0IHRoZSB2Q1BVIGJhY2sgaW4g
dGhlCisgICAgICAgICAgICAgKiB3ZSB0ZWxsIGNvbnRleHRfc2F2ZWQoKSB0byBwdXQgdGhlIHVu
aXQgYmFjayBpbiB0aGUKICAgICAgICAgICAgICAqIHJ1bnF1ZXVlLCBmcm9tIHdoZXJlIGl0IHdp
bGwgY29tcGV0ZSB3aXRoIHRoZSBvdGhlcnMKICAgICAgICAgICAgICAqIGZvciB0aGUgbmV3bHkg
cmVwbGVuaXNoZWQgYnVkZ2V0LgogICAgICAgICAgICAgICovCiAgICAgICAgICAgICBBU1NFUlQo
IHN2Yy0+cnFkICE9IE5VTEwgKTsKLSAgICAgICAgICAgIEFTU0VSVCggYzJycWQob3BzLCBzdmMt
PnZjcHUtPnByb2Nlc3NvcikgPT0gc3ZjLT5ycWQgKTsKKyAgICAgICAgICAgIEFTU0VSVCggYzJy
cWQob3BzLCBzY2hlZF91bml0X21hc3RlcihzdmMtPnVuaXQpKSA9PSBzdmMtPnJxZCApOwogICAg
ICAgICAgICAgX19zZXRfYml0KF9fQ1NGTEFHX2RlbGF5ZWRfcnVucV9hZGQsICZzdmMtPmZsYWdz
KTsKICAgICAgICAgfQotICAgICAgICBlbHNlIGlmICggdmNwdV9ydW5uYWJsZShzdmMtPnZjcHUp
ICkKKyAgICAgICAgZWxzZSBpZiAoIHVuaXRfcnVubmFibGUoc3ZjLT51bml0KSApCiAgICAgICAg
IHsKICAgICAgICAgICAgIC8qCi0gICAgICAgICAgICAgKiBUaGUgdkNQVSBzaG91bGQgZ28gYmFj
ayB0byB0aGUgcnVucXVldWUsIGFuZCBjb21wZXRlIGZvcgorICAgICAgICAgICAgICogVGhlIHVu
aXQgc2hvdWxkIGdvIGJhY2sgdG8gdGhlIHJ1bnF1ZXVlLCBhbmQgY29tcGV0ZSBmb3IKICAgICAg
ICAgICAgICAqIHRoZSBuZXdseSByZXBsZW5pc2hlZCBidWRnZXQsIGJ1dCBvbmx5IGlmIGl0IGlz
IGFjdHVhbGx5CiAgICAgICAgICAgICAgKiBydW5uYWJsZSAoYW5kIHdhcyB0aGVyZWZvcmUgb2Zm
bGluZSBvbmx5IGJlY2F1c2Ugb2YgdGhlCiAgICAgICAgICAgICAgKiBsYWNrIG9mIGJ1ZGdldCku
CkBAIC0xOTI1LDcgKzE5MjUsNyBAQCB1bnBhcmtfcGFya2VkX3ZjcHVzKGNvbnN0IHN0cnVjdCBz
Y2hlZHVsZXIgKm9wcywgc3RydWN0IGxpc3RfaGVhZCAqdmNwdXMpCiAgICAgICAgIH0KICAgICAg
ICAgbGlzdF9kZWxfaW5pdCgmc3ZjLT5wYXJrZWRfZWxlbSk7CiAKLSAgICAgICAgdW5pdF9zY2hl
ZHVsZV91bmxvY2tfaXJxcmVzdG9yZShsb2NrLCBmbGFncywgc3ZjLT52Y3B1LT5zY2hlZF91bml0
KTsKKyAgICAgICAgdW5pdF9zY2hlZHVsZV91bmxvY2tfaXJxcmVzdG9yZShsb2NrLCBmbGFncywg
c3ZjLT51bml0KTsKICAgICB9CiB9CiAKQEAgLTE5NTUsNyArMTk1NSw3IEBAIHN0YXRpYyB2b2lk
IHJlcGxlbmlzaF9kb21haW5fYnVkZ2V0KHZvaWQqIGRhdGEpCiAgICAgICoKICAgICAgKiBFdmVu
IGluIGNhc2VzIG9mIG92ZXJydW4gb3IgZGVsYXksIGhvd2V2ZXIsIHdlIGV4cGVjdCB0aGF0IGlu
IDk5JSBvZgogICAgICAqIGNhc2VzLCBkb2luZyBqdXN0IG9uZSByZXBsZW5pc2htZW50IHdpbGwg
YmUgZ29vZCBlbm91Z2ggZm9yIGJlaW5nIGFibGUKLSAgICAgKiB0byB1bnBhcmsgdGhlIHZDUFVz
IHRoYXQgYXJlIHdhaXRpbmcgZm9yIHNvbWUgYnVkZ2V0LgorICAgICAqIHRvIHVucGFyayB0aGUg
dW5pdHMgdGhhdCBhcmUgd2FpdGluZyBmb3Igc29tZSBidWRnZXQuCiAgICAgICovCiAgICAgZG9f
cmVwbGVuaXNoKHNkb20pOwogCkBAIC0xOTc1LDcgKzE5NzUsNyBAQCBzdGF0aWMgdm9pZCByZXBs
ZW5pc2hfZG9tYWluX2J1ZGdldCh2b2lkKiBkYXRhKQogICAgIH0KICAgICAvKgogICAgICAqIDIp
IGlmIHdlIG92ZXJydW4gYnkgbW9yZSB0aGFuIHRvdF9idWRnZXQsIHRoZW4gYnVkZ2V0K3RvdF9i
dWRnZXQgaXMKLSAgICAgKiBzdGlsbCA8IDAsIHdoaWNoIG1lYW5zIHRoYXQgd2UgY2FuJ3QgdW5w
YXJrIHRoZSB2Q1BVcy4gTGV0J3MgYmFpbCwKKyAgICAgKiBzdGlsbCA8IDAsIHdoaWNoIG1lYW5z
IHRoYXQgd2UgY2FuJ3QgdW5wYXJrIHRoZSB1bml0cy4gTGV0J3MgYmFpbCwKICAgICAgKiBhbmQg
d2FpdCBmb3IgZnV0dXJlIHJlcGxlbmlzaG1lbnRzLgogICAgICAqLwogICAgIGlmICggdW5saWtl
bHkoc2RvbS0+YnVkZ2V0IDw9IDApICkKQEAgLTE5ODksMTQgKzE5ODksMTQgQEAgc3RhdGljIHZv
aWQgcmVwbGVuaXNoX2RvbWFpbl9idWRnZXQodm9pZCogZGF0YSkKIAogICAgIC8qCiAgICAgICog
QXMgYWJvdmUsIGxldCdzIHByZXBhcmUgdGhlIHRlbXBvcmFyeSBsaXN0LCBvdXQgb2YgdGhlIGRv
bWFpbidzCi0gICAgICogcGFya2VkX3ZjcHVzIGxpc3QsIG5vdyB0aGF0IHdlIGhvbGQgdGhlIGJ1
ZGdldF9sb2NrLiBUaGVuLCBkcm9wIHN1Y2gKKyAgICAgKiBwYXJrZWRfdW5pdHMgbGlzdCwgbm93
IHRoYXQgd2UgaG9sZCB0aGUgYnVkZ2V0X2xvY2suIFRoZW4sIGRyb3Agc3VjaAogICAgICAqIGxv
Y2ssIGFuZCBwYXNzIHRoZSBsaXN0IHRvIHRoZSB1bnBhcmtpbmcgZnVuY3Rpb24uCiAgICAgICov
Ci0gICAgbGlzdF9zcGxpY2VfaW5pdCgmc2RvbS0+cGFya2VkX3ZjcHVzLCAmcGFya2VkKTsKKyAg
ICBsaXN0X3NwbGljZV9pbml0KCZzZG9tLT5wYXJrZWRfdW5pdHMsICZwYXJrZWQpOwogCiAgICAg
c3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmc2RvbS0+YnVkZ2V0X2xvY2ssIGZsYWdzKTsKIAotICAg
IHVucGFya19wYXJrZWRfdmNwdXMoc2RvbS0+ZG9tLT5jcHVwb29sLT5zY2hlZCwgJnBhcmtlZCk7
CisgICAgdW5wYXJrX3BhcmtlZF91bml0cyhzZG9tLT5kb20tPmNwdXBvb2wtPnNjaGVkLCAmcGFy
a2VkKTsKIAogIG91dDoKICAgICBzZXRfdGltZXIoJnNkb20tPnJlcGxfdGltZXIsIHNkb20tPm5l
eHRfcmVwbCk7CkBAIC0yMDA0LDM3ICsyMDA0LDM2IEBAIHN0YXRpYyB2b2lkIHJlcGxlbmlzaF9k
b21haW5fYnVkZ2V0KHZvaWQqIGRhdGEpCiAKICNpZm5kZWYgTkRFQlVHCiBzdGF0aWMgaW5saW5l
IHZvaWQKLWNzY2hlZDJfdmNwdV9jaGVjayhzdHJ1Y3QgdmNwdSAqdmMpCitjc2NoZWQyX3VuaXRf
Y2hlY2soc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiB7Ci0gICAgc3RydWN0IGNzY2hlZDJfdW5p
dCAqIGNvbnN0IHN2YyA9IGNzY2hlZDJfdW5pdCh2Yy0+c2NoZWRfdW5pdCk7CisgICAgc3RydWN0
IGNzY2hlZDJfdW5pdCAqIGNvbnN0IHN2YyA9IGNzY2hlZDJfdW5pdCh1bml0KTsKICAgICBzdHJ1
Y3QgY3NjaGVkMl9kb20gKiBjb25zdCBzZG9tID0gc3ZjLT5zZG9tOwogCi0gICAgQlVHX09OKCBz
dmMtPnZjcHUgIT0gdmMgKTsKLSAgICBCVUdfT04oIHNkb20gIT0gY3NjaGVkMl9kb20odmMtPmRv
bWFpbikgKTsKKyAgICBCVUdfT04oIHN2Yy0+dW5pdCAhPSB1bml0ICk7CisgICAgQlVHX09OKCBz
ZG9tICE9IGNzY2hlZDJfZG9tKHVuaXQtPmRvbWFpbikgKTsKICAgICBpZiAoIHNkb20gKQogICAg
IHsKLSAgICAgICAgQlVHX09OKCBpc19pZGxlX3ZjcHUodmMpICk7Ci0gICAgICAgIEJVR19PTigg
c2RvbS0+ZG9tICE9IHZjLT5kb21haW4gKTsKKyAgICAgICAgQlVHX09OKCBpc19pZGxlX3VuaXQo
dW5pdCkgKTsKKyAgICAgICAgQlVHX09OKCBzZG9tLT5kb20gIT0gdW5pdC0+ZG9tYWluICk7CiAg
ICAgfQogICAgIGVsc2UKICAgICB7Ci0gICAgICAgIEJVR19PTiggIWlzX2lkbGVfdmNwdSh2Yykg
KTsKKyAgICAgICAgQlVHX09OKCAhaXNfaWRsZV91bml0KHVuaXQpICk7CiAgICAgfQogICAgIFND
SEVEX1NUQVRfQ1JBTksodW5pdF9jaGVjayk7CiB9Ci0jZGVmaW5lIENTQ0hFRDJfVkNQVV9DSEVD
SyhfdmMpICAoY3NjaGVkMl92Y3B1X2NoZWNrKF92YykpCisjZGVmaW5lIENTQ0hFRDJfVU5JVF9D
SEVDSyh1bml0KSAgKGNzY2hlZDJfdW5pdF9jaGVjayh1bml0KSkKICNlbHNlCi0jZGVmaW5lIENT
Q0hFRDJfVkNQVV9DSEVDSyhfdmMpCisjZGVmaW5lIENTQ0hFRDJfVU5JVF9DSEVDSyh1bml0KQog
I2VuZGlmCiAKIHN0YXRpYyB2b2lkICoKIGNzY2hlZDJfYWxsb2NfdWRhdGEoY29uc3Qgc3RydWN0
IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCwKICAgICAgICAgICAgICAg
ICAgICAgdm9pZCAqZGQpCiB7Ci0gICAgc3RydWN0IHZjcHUgKnZjID0gdW5pdC0+dmNwdV9saXN0
OwogICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YzsKIAotICAgIC8qIEFsbG9jYXRlIHBlci1W
Q1BVIGluZm8gKi8KKyAgICAvKiBBbGxvY2F0ZSBwZXItVU5JVCBpbmZvICovCiAgICAgc3ZjID0g
eHphbGxvYyhzdHJ1Y3QgY3NjaGVkMl91bml0KTsKICAgICBpZiAoIHN2YyA9PSBOVUxMICkKICAg
ICAgICAgcmV0dXJuIE5VTEw7CkBAIC0yMDQzLDEwICsyMDQyLDEwIEBAIGNzY2hlZDJfYWxsb2Nf
dWRhdGEoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5p
dCwKICAgICBJTklUX0xJU1RfSEVBRCgmc3ZjLT5ydW5xX2VsZW0pOwogCiAgICAgc3ZjLT5zZG9t
ID0gZGQ7Ci0gICAgc3ZjLT52Y3B1ID0gdmM7CisgICAgc3ZjLT51bml0ID0gdW5pdDsKICAgICBz
dmMtPmZsYWdzID0gMFU7CiAKLSAgICBpZiAoICEgaXNfaWRsZV92Y3B1KHZjKSApCisgICAgaWYg
KCAhIGlzX2lkbGVfdW5pdCh1bml0KSApCiAgICAgewogICAgICAgICBBU1NFUlQoc3ZjLT5zZG9t
ICE9IE5VTEwpOwogICAgICAgICBzdmMtPmNyZWRpdCA9IENTQ0hFRDJfQ1JFRElUX0lOSVQ7CkBA
IC0yMDc1LDE5ICsyMDc0LDE4IEBAIGNzY2hlZDJfYWxsb2NfdWRhdGEoY29uc3Qgc3RydWN0IHNj
aGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCwKIHN0YXRpYyB2b2lkCiBjc2No
ZWQyX3VuaXRfc2xlZXAoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRf
dW5pdCAqdW5pdCkKIHsKLSAgICBzdHJ1Y3QgdmNwdSAqdmMgPSB1bml0LT52Y3B1X2xpc3Q7CiAg
ICAgc3RydWN0IGNzY2hlZDJfdW5pdCAqIGNvbnN0IHN2YyA9IGNzY2hlZDJfdW5pdCh1bml0KTsK
IAotICAgIEFTU0VSVCghaXNfaWRsZV92Y3B1KHZjKSk7CisgICAgQVNTRVJUKCFpc19pZGxlX3Vu
aXQodW5pdCkpOwogICAgIFNDSEVEX1NUQVRfQ1JBTksodW5pdF9zbGVlcCk7CiAKLSAgICBpZiAo
IGN1cnJfb25fY3B1KHZjLT5wcm9jZXNzb3IpID09IHVuaXQgKQorICAgIGlmICggY3Vycl9vbl9j
cHUoc2NoZWRfdW5pdF9tYXN0ZXIodW5pdCkpID09IHVuaXQgKQogICAgIHsKLSAgICAgICAgdGlj
a2xlX2NwdSh2Yy0+cHJvY2Vzc29yLCBzdmMtPnJxZCk7CisgICAgICAgIHRpY2tsZV9jcHUoc2No
ZWRfdW5pdF9tYXN0ZXIodW5pdCksIHN2Yy0+cnFkKTsKICAgICB9Ci0gICAgZWxzZSBpZiAoIHZj
cHVfb25fcnVucShzdmMpICkKKyAgICBlbHNlIGlmICggdW5pdF9vbl9ydW5xKHN2YykgKQogICAg
IHsKLSAgICAgICAgQVNTRVJUKHN2Yy0+cnFkID09IGMycnFkKG9wcywgdmMtPnByb2Nlc3Nvcikp
OworICAgICAgICBBU1NFUlQoc3ZjLT5ycWQgPT0gYzJycWQob3BzLCBzY2hlZF91bml0X21hc3Rl
cih1bml0KSkpOwogICAgICAgICB1cGRhdGVfbG9hZChvcHMsIHN2Yy0+cnFkLCBzdmMsIC0xLCBO
T1coKSk7CiAgICAgICAgIHJ1bnFfcmVtb3ZlKHN2Yyk7CiAgICAgfQpAQCAtMjA5OCwxNCArMjA5
NiwxMyBAQCBjc2NoZWQyX3VuaXRfc2xlZXAoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBz
dHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIHN0YXRpYyB2b2lkCiBjc2NoZWQyX3VuaXRfd2FrZShj
b25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogewot
ICAgIHN0cnVjdCB2Y3B1ICp2YyA9IHVuaXQtPnZjcHVfbGlzdDsKICAgICBzdHJ1Y3QgY3NjaGVk
Ml91bml0ICogY29uc3Qgc3ZjID0gY3NjaGVkMl91bml0KHVuaXQpOwotICAgIHVuc2lnbmVkIGlu
dCBjcHUgPSB2Yy0+cHJvY2Vzc29yOworICAgIHVuc2lnbmVkIGludCBjcHUgPSBzY2hlZF91bml0
X21hc3Rlcih1bml0KTsKICAgICBzX3RpbWVfdCBub3c7CiAKICAgICBBU1NFUlQoc3Bpbl9pc19s
b2NrZWQoZ2V0X3NjaGVkX3JlcyhjcHUpLT5zY2hlZHVsZV9sb2NrKSk7CiAKLSAgICBBU1NFUlQo
IWlzX2lkbGVfdmNwdSh2YykpOworICAgIEFTU0VSVCghaXNfaWRsZV91bml0KHVuaXQpKTsKIAog
ICAgIGlmICggdW5saWtlbHkoY3Vycl9vbl9jcHUoY3B1KSA9PSB1bml0KSApCiAgICAgewpAQCAt
MjExMywxOCArMjExMCwxOCBAQCBjc2NoZWQyX3VuaXRfd2FrZShjb25zdCBzdHJ1Y3Qgc2NoZWR1
bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogICAgICAgICBnb3RvIG91dDsKICAg
ICB9CiAKLSAgICBpZiAoIHVubGlrZWx5KHZjcHVfb25fcnVucShzdmMpKSApCisgICAgaWYgKCB1
bmxpa2VseSh1bml0X29uX3J1bnEoc3ZjKSkgKQogICAgIHsKICAgICAgICAgU0NIRURfU1RBVF9D
UkFOSyh1bml0X3dha2Vfb25ydW5xKTsKICAgICAgICAgZ290byBvdXQ7CiAgICAgfQogCi0gICAg
aWYgKCBsaWtlbHkodmNwdV9ydW5uYWJsZSh2YykpICkKKyAgICBpZiAoIGxpa2VseSh1bml0X3J1
bm5hYmxlKHVuaXQpKSApCiAgICAgICAgIFNDSEVEX1NUQVRfQ1JBTksodW5pdF93YWtlX3J1bm5h
YmxlKTsKICAgICBlbHNlCiAgICAgICAgIFNDSEVEX1NUQVRfQ1JBTksodW5pdF93YWtlX25vdF9y
dW5uYWJsZSk7CiAKLSAgICAvKiBJZiB0aGUgY29udGV4dCBoYXNuJ3QgYmVlbiBzYXZlZCBmb3Ig
dGhpcyB2Y3B1IHlldCwgd2UgY2FuJ3QgcHV0IGl0IG9uCisgICAgLyogSWYgdGhlIGNvbnRleHQg
aGFzbid0IGJlZW4gc2F2ZWQgZm9yIHRoaXMgdW5pdCB5ZXQsIHdlIGNhbid0IHB1dCBpdCBvbgog
ICAgICAqIGFub3RoZXIgcnVucXVldWUuICBJbnN0ZWFkLCB3ZSBzZXQgYSBmbGFnIHNvIHRoYXQg
aXQgd2lsbCBiZSBwdXQgb24gdGhlIHJ1bnF1ZXVlCiAgICAgICogYWZ0ZXIgdGhlIGNvbnRleHQg
aGFzIGJlZW4gc2F2ZWQuICovCiAgICAgaWYgKCB1bmxpa2VseShzdmMtPmZsYWdzICYgQ1NGTEFH
X3NjaGVkdWxlZCkgKQpAQCAtMjEzNSwxNSArMjEzMiwxNSBAQCBjc2NoZWQyX3VuaXRfd2FrZShj
b25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogCiAg
ICAgLyogQWRkIGludG8gdGhlIG5ldyBydW5xdWV1ZSBpZiBuZWNlc3NhcnkgKi8KICAgICBpZiAo
IHN2Yy0+cnFkID09IE5VTEwgKQotICAgICAgICBydW5xX2Fzc2lnbihvcHMsIHZjKTsKKyAgICAg
ICAgcnVucV9hc3NpZ24ob3BzLCB1bml0KTsKICAgICBlbHNlCi0gICAgICAgIEFTU0VSVChjMnJx
ZChvcHMsIHZjLT5wcm9jZXNzb3IpID09IHN2Yy0+cnFkICk7CisgICAgICAgIEFTU0VSVChjMnJx
ZChvcHMsIHNjaGVkX3VuaXRfbWFzdGVyKHVuaXQpKSA9PSBzdmMtPnJxZCApOwogCiAgICAgbm93
ID0gTk9XKCk7CiAKICAgICB1cGRhdGVfbG9hZChvcHMsIHN2Yy0+cnFkLCBzdmMsIDEsIG5vdyk7
Ci0gICAgICAgIAotICAgIC8qIFB1dCB0aGUgVkNQVSBvbiB0aGUgcnVucSAqLworCisgICAgLyog
UHV0IHRoZSBVTklUIG9uIHRoZSBydW5xICovCiAgICAgcnVucV9pbnNlcnQob3BzLCBzdmMpOwog
ICAgIHJ1bnFfdGlja2xlKG9wcywgc3ZjLCBub3cpOwogCkBAIC0yMTU2LDQ5ICsyMTUzLDUwIEBA
IGNzY2hlZDJfdW5pdF95aWVsZChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBz
Y2hlZF91bml0ICp1bml0KQogewogICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKiBjb25zdCBzdmMg
PSBjc2NoZWQyX3VuaXQodW5pdCk7CiAKLSAgICBfX3NldF9iaXQoX19DU0ZMQUdfdmNwdV95aWVs
ZCwgJnN2Yy0+ZmxhZ3MpOworICAgIF9fc2V0X2JpdChfX0NTRkxBR191bml0X3lpZWxkLCAmc3Zj
LT5mbGFncyk7CiB9CiAKIHN0YXRpYyB2b2lkCiBjc2NoZWQyX2NvbnRleHRfc2F2ZWQoY29uc3Qg
c3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIHsKLSAgICBz
dHJ1Y3QgdmNwdSAqdmMgPSB1bml0LT52Y3B1X2xpc3Q7CiAgICAgc3RydWN0IGNzY2hlZDJfdW5p
dCAqIGNvbnN0IHN2YyA9IGNzY2hlZDJfdW5pdCh1bml0KTsKICAgICBzcGlubG9ja190ICpsb2Nr
ID0gdW5pdF9zY2hlZHVsZV9sb2NrX2lycSh1bml0KTsKICAgICBzX3RpbWVfdCBub3cgPSBOT1co
KTsKICAgICBMSVNUX0hFQUQod2VyZV9wYXJrZWQpOwogCi0gICAgQlVHX09OKCAhaXNfaWRsZV92
Y3B1KHZjKSAmJiBzdmMtPnJxZCAhPSBjMnJxZChvcHMsIHZjLT5wcm9jZXNzb3IpKTsKLSAgICBB
U1NFUlQoaXNfaWRsZV92Y3B1KHZjKSB8fCBzdmMtPnJxZCA9PSBjMnJxZChvcHMsIHZjLT5wcm9j
ZXNzb3IpKTsKKyAgICBCVUdfT04oICFpc19pZGxlX3VuaXQodW5pdCkgJiYKKyAgICAgICAgICAg
IHN2Yy0+cnFkICE9IGMycnFkKG9wcywgc2NoZWRfdW5pdF9tYXN0ZXIodW5pdCkpKTsKKyAgICBB
U1NFUlQoaXNfaWRsZV91bml0KHVuaXQpIHx8CisgICAgICAgICAgIHN2Yy0+cnFkID09IGMycnFk
KG9wcywgc2NoZWRfdW5pdF9tYXN0ZXIodW5pdCkpKTsKIAotICAgIC8qIFRoaXMgdmNwdSBpcyBu
b3cgZWxpZ2libGUgdG8gYmUgcHV0IG9uIHRoZSBydW5xdWV1ZSBhZ2FpbiAqLworICAgIC8qIFRo
aXMgdW5pdCBpcyBub3cgZWxpZ2libGUgdG8gYmUgcHV0IG9uIHRoZSBydW5xdWV1ZSBhZ2FpbiAq
LwogICAgIF9fY2xlYXJfYml0KF9fQ1NGTEFHX3NjaGVkdWxlZCwgJnN2Yy0+ZmxhZ3MpOwogCiAg
ICAgaWYgKCB1bmxpa2VseShoYXNfY2FwKHN2YykgJiYgc3ZjLT5idWRnZXQgPiAwKSApCi0gICAg
ICAgIHZjcHVfcmV0dXJuX2J1ZGdldChzdmMsICZ3ZXJlX3BhcmtlZCk7CisgICAgICAgIHVuaXRf
cmV0dXJuX2J1ZGdldChzdmMsICZ3ZXJlX3BhcmtlZCk7CiAKICAgICAvKiBJZiBzb21lb25lIHdh
bnRzIGl0IG9uIHRoZSBydW5xdWV1ZSwgcHV0IGl0IHRoZXJlLiAqLwogICAgIC8qCiAgICAgICog
TkI6IFdlIGNhbiBnZXQgcmlkIG9mIENTRkxBR19zY2hlZHVsZWQgYnkgY2hlY2tpbmcgZm9yCi0g
ICAgICogdmMtPmlzX3J1bm5pbmcgYW5kIHZjcHVfb25fcnVucShzdmMpIGhlcmUuICBIb3dldmVy
LAorICAgICAqIHZjLT5pc19ydW5uaW5nIGFuZCB1bml0X29uX3J1bnEoc3ZjKSBoZXJlLiAgSG93
ZXZlciwKICAgICAgKiBzaW5jZSB3ZSdyZSBhY2Nlc3NpbmcgdGhlIGZsYWdzIGNhY2hlbGluZSBh
bnl3YXksCiAgICAgICogaXQgc2VlbXMgYSBiaXQgcG9pbnRsZXNzOyBlc3BlY2lhbGx5IGFzIHdl
IGhhdmUgcGxlbnR5IG9mCiAgICAgICogYml0cyBmcmVlLgogICAgICAqLwogICAgIGlmICggX190
ZXN0X2FuZF9jbGVhcl9iaXQoX19DU0ZMQUdfZGVsYXllZF9ydW5xX2FkZCwgJnN2Yy0+ZmxhZ3Mp
Ci0gICAgICAgICAmJiBsaWtlbHkodmNwdV9ydW5uYWJsZSh2YykpICkKKyAgICAgICAgICYmIGxp
a2VseSh1bml0X3J1bm5hYmxlKHVuaXQpKSApCiAgICAgewotICAgICAgICBBU1NFUlQoIXZjcHVf
b25fcnVucShzdmMpKTsKKyAgICAgICAgQVNTRVJUKCF1bml0X29uX3J1bnEoc3ZjKSk7CiAKICAg
ICAgICAgcnVucV9pbnNlcnQob3BzLCBzdmMpOwogICAgICAgICBydW5xX3RpY2tsZShvcHMsIHN2
Yywgbm93KTsKICAgICB9Ci0gICAgZWxzZSBpZiAoICFpc19pZGxlX3ZjcHUodmMpICkKKyAgICBl
bHNlIGlmICggIWlzX2lkbGVfdW5pdCh1bml0KSApCiAgICAgICAgIHVwZGF0ZV9sb2FkKG9wcywg
c3ZjLT5ycWQsIHN2YywgLTEsIG5vdyk7CiAKICAgICB1bml0X3NjaGVkdWxlX3VubG9ja19pcnEo
bG9jaywgdW5pdCk7CiAKLSAgICB1bnBhcmtfcGFya2VkX3ZjcHVzKG9wcywgJndlcmVfcGFya2Vk
KTsKKyAgICB1bnBhcmtfcGFya2VkX3VuaXRzKG9wcywgJndlcmVfcGFya2VkKTsKIH0KIAogI2Rl
ZmluZSBNQVhfTE9BRCAoU1RJTUVfTUFYKQpAQCAtMjIwNiw5ICsyMjA0LDggQEAgc3RhdGljIHN0
cnVjdCBzY2hlZF9yZXNvdXJjZSAqCiBjc2NoZWQyX3Jlc19waWNrKGNvbnN0IHN0cnVjdCBzY2hl
ZHVsZXIgKm9wcywgY29uc3Qgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiB7CiAgICAgc3RydWN0
IGNzY2hlZDJfcHJpdmF0ZSAqcHJ2ID0gY3NjaGVkMl9wcml2KG9wcyk7Ci0gICAgc3RydWN0IHZj
cHUgKnZjID0gdW5pdC0+dmNwdV9saXN0OwogICAgIGludCBpLCBtaW5fcnFpID0gLTEsIG1pbl9z
X3JxaSA9IC0xOwotICAgIHVuc2lnbmVkIGludCBuZXdfY3B1LCBjcHUgPSB2Yy0+cHJvY2Vzc29y
OworICAgIHVuc2lnbmVkIGludCBuZXdfY3B1LCBjcHUgPSBzY2hlZF91bml0X21hc3Rlcih1bml0
KTsKICAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMgPSBjc2NoZWQyX3VuaXQodW5pdCk7CiAg
ICAgc190aW1lX3QgbWluX2F2Z2xvYWQgPSBNQVhfTE9BRCwgbWluX3NfYXZnbG9hZCA9IE1BWF9M
T0FEOwogICAgIGJvb2wgaGFzX3NvZnQ7CkBAIC0yMjQ2LDcgKzIyNDMsNyBAQCBjc2NoZWQyX3Jl
c19waWNrKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgY29uc3Qgc3RydWN0IHNjaGVkX3Vu
aXQgKnVuaXQpCiAgICAgfQogCiAgICAgY3B1bWFza19hbmQoY3B1bWFza19zY3JhdGNoX2NwdShj
cHUpLCB1bml0LT5jcHVfaGFyZF9hZmZpbml0eSwKLSAgICAgICAgICAgICAgICBjcHVwb29sX2Rv
bWFpbl9jcHVtYXNrKHZjLT5kb21haW4pKTsKKyAgICAgICAgICAgICAgICBjcHVwb29sX2RvbWFp
bl9jcHVtYXNrKHVuaXQtPmRvbWFpbikpOwogCiAgICAgLyoKICAgICAgKiBGaXJzdCBjaGVjayB0
byBzZWUgaWYgd2UncmUgaGVyZSBiZWNhdXNlIHNvbWVvbmUgZWxzZSBzdWdnZXN0ZWQgYSBwbGFj
ZQpAQCAtMjM1Nyw3ICsyMzU0LDcgQEAgY3NjaGVkMl9yZXNfcGljayhjb25zdCBzdHJ1Y3Qgc2No
ZWR1bGVyICpvcHMsIGNvbnN0IHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogICAgICAgICAgKiBX
ZSBoYXZlIHNvZnQgYWZmaW5pdHksIGFuZCB3ZSBoYXZlIGEgY2FuZGlkYXRlIHJ1bnEsIHNvIGdv
IGZvciBpdC4KICAgICAgICAgICoKICAgICAgICAgICogTm90ZSB0aGF0LCB0byBvYnRhaW4gdGhl
IHNvZnQtYWZmaW5pdHkgbWFzaywgd2UgImp1c3QiIHB1dCB3aGF0IHdlCi0gICAgICAgICAqIGhh
dmUgaW4gY3B1bWFza19zY3JhdGNoIGluICYmIHdpdGggdmMtPmNwdV9zb2Z0X2FmZmluaXR5LiBU
aGlzIGlzCisgICAgICAgICAqIGhhdmUgaW4gY3B1bWFza19zY3JhdGNoIGluICYmIHdpdGggdW5p
dC0+Y3B1X3NvZnRfYWZmaW5pdHkuIFRoaXMgaXMKICAgICAgICAgICogb2sgYmVjYXVzZToKICAg
ICAgICAgICogLSB3ZSBrbm93IHRoYXQgdW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHkgYW5kIC0+Y3B1
X3NvZnRfYWZmaW5pdHkgaGF2ZQogICAgICAgICAgKiAgIGEgbm9uLWVtcHR5IGludGVyc2VjdGlv
biAoYmVjYXVzZSBoYXNfc29mdCBpcyB0cnVlKTsKQEAgLTIzODAsNyArMjM3Nyw3IEBAIGNzY2hl
ZDJfcmVzX3BpY2soY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBjb25zdCBzdHJ1Y3Qgc2No
ZWRfdW5pdCAqdW5pdCkKICAgICAgICAgICogYW55IHN1aXRhYmxlIHJ1bnEuIEJ1dCB3ZSBkaWQg
ZmluZCBvbmUgd2hlbiBjb25zaWRlcmluZyBoYXJkCiAgICAgICAgICAqIGFmZmluaXR5LCBzbyBn
byBmb3IgaXQuCiAgICAgICAgICAqCi0gICAgICAgICAqIGNwdW1hc2tfc2NyYXRjaCBhbHJlYWR5
IGhhcyB2Yy0+Y3B1X2hhcmRfYWZmaW5pdHkgJgorICAgICAgICAgKiBjcHVtYXNrX3NjcmF0Y2gg
YWxyZWFkeSBoYXMgdW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHkgJgogICAgICAgICAgKiBjcHVwb29s
X2RvbWFpbl9jcHVtYXNrKCkgaW4gaXQsIHNvIGl0J3MgZW5vdWdoIHRoYXQgd2UgZmlsdGVyCiAg
ICAgICAgICAqIHdpdGggdGhlIGNwdXMgb2YgdGhlIHJ1bnEuCiAgICAgICAgICAqLwpAQCAtMjQx
MSwxMSArMjQwOCwxMSBAQCBjc2NoZWQyX3Jlc19waWNrKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIg
Km9wcywgY29uc3Qgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiAgICAgewogICAgICAgICBzdHJ1
Y3QgewogICAgICAgICAgICAgdWludDY0X3QgYl9hdmdsb2FkOwotICAgICAgICAgICAgdW5zaWdu
ZWQgdmNwdToxNiwgZG9tOjE2OworICAgICAgICAgICAgdW5zaWduZWQgdW5pdDoxNiwgZG9tOjE2
OwogICAgICAgICAgICAgdW5zaWduZWQgcnFfaWQ6MTYsIG5ld19jcHU6MTY7CiAgICAgICAgIH0g
ZDsKLSAgICAgICAgZC5kb20gPSB2Yy0+ZG9tYWluLT5kb21haW5faWQ7Ci0gICAgICAgIGQudmNw
dSA9IHZjLT52Y3B1X2lkOworICAgICAgICBkLmRvbSA9IHVuaXQtPmRvbWFpbi0+ZG9tYWluX2lk
OworICAgICAgICBkLnVuaXQgPSB1bml0LT51bml0X2lkOwogICAgICAgICBkLnJxX2lkID0gbWlu
X3JxaTsKICAgICAgICAgZC5iX2F2Z2xvYWQgPSBtaW5fYXZnbG9hZDsKICAgICAgICAgZC5uZXdf
Y3B1ID0gbmV3X2NwdTsKQEAgLTI0MzQsMTAgKzI0MzEsMTAgQEAgdHlwZWRlZiBzdHJ1Y3Qgewog
ICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKiBiZXN0X3B1c2hfc3ZjLCAqYmVzdF9wdWxsX3N2YzsK
ICAgICAvKiBOQjogUmVhZCBieSBjb25zaWRlcigpICovCiAgICAgc3RydWN0IGNzY2hlZDJfcnVu
cXVldWVfZGF0YSAqbHJxZDsKLSAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpvcnFk
OyAgICAgICAgICAgICAgICAgIAorICAgIHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKm9y
cWQ7CiB9IGJhbGFuY2Vfc3RhdGVfdDsKIAotc3RhdGljIHZvaWQgY29uc2lkZXIoYmFsYW5jZV9z
dGF0ZV90ICpzdCwgCitzdGF0aWMgdm9pZCBjb25zaWRlcihiYWxhbmNlX3N0YXRlX3QgKnN0LAog
ICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGNzY2hlZDJfdW5pdCAqcHVzaF9zdmMsCiAgICAg
ICAgICAgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICpwdWxsX3N2YykKIHsKQEAgLTI0
NzYsMTcgKzI0NzMsMTcgQEAgc3RhdGljIHZvaWQgbWlncmF0ZShjb25zdCBzdHJ1Y3Qgc2NoZWR1
bGVyICpvcHMsCiAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2Rh
dGEgKnRycWQsCiAgICAgICAgICAgICAgICAgICAgIHNfdGltZV90IG5vdykKIHsKLSAgICBpbnQg
Y3B1ID0gc3ZjLT52Y3B1LT5wcm9jZXNzb3I7Ci0gICAgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQg
PSBzdmMtPnZjcHUtPnNjaGVkX3VuaXQ7CisgICAgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQgPSBz
dmMtPnVuaXQ7CisgICAgaW50IGNwdSA9IHNjaGVkX3VuaXRfbWFzdGVyKHVuaXQpOwogCiAgICAg
aWYgKCB1bmxpa2VseSh0Yl9pbml0X2RvbmUpICkKICAgICB7CiAgICAgICAgIHN0cnVjdCB7Ci0g
ICAgICAgICAgICB1bnNpZ25lZCB2Y3B1OjE2LCBkb206MTY7CisgICAgICAgICAgICB1bnNpZ25l
ZCB1bml0OjE2LCBkb206MTY7CiAgICAgICAgICAgICB1bnNpZ25lZCBycWk6MTYsIHRycWk6MTY7
CiAgICAgICAgIH0gZDsKLSAgICAgICAgZC5kb20gPSBzdmMtPnZjcHUtPmRvbWFpbi0+ZG9tYWlu
X2lkOwotICAgICAgICBkLnZjcHUgPSBzdmMtPnZjcHUtPnZjcHVfaWQ7CisgICAgICAgIGQuZG9t
ID0gdW5pdC0+ZG9tYWluLT5kb21haW5faWQ7CisgICAgICAgIGQudW5pdCA9IHVuaXQtPnVuaXRf
aWQ7CiAgICAgICAgIGQucnFpID0gc3ZjLT5ycWQtPmlkOwogICAgICAgICBkLnRycWkgPSB0cnFk
LT5pZDsKICAgICAgICAgX190cmFjZV92YXIoVFJDX0NTQ0hFRDJfTUlHUkFURSwgMSwKQEAgLTI0
OTgsNyArMjQ5NSw3IEBAIHN0YXRpYyB2b2lkIG1pZ3JhdGUoY29uc3Qgc3RydWN0IHNjaGVkdWxl
ciAqb3BzLAogICAgIHsKICAgICAgICAgLyogSXQncyBydW5uaW5nOyBtYXJrIGl0IHRvIG1pZ3Jh
dGUuICovCiAgICAgICAgIHN2Yy0+bWlncmF0ZV9ycWQgPSB0cnFkOwotICAgICAgICBfX3NldF9i
aXQoX1ZQRl9taWdyYXRpbmcsICZzdmMtPnZjcHUtPnBhdXNlX2ZsYWdzKTsKKyAgICAgICAgc2No
ZWRfc2V0X3BhdXNlX2ZsYWdzKHVuaXQsIF9WUEZfbWlncmF0aW5nKTsKICAgICAgICAgX19zZXRf
Yml0KF9fQ1NGTEFHX3J1bnFfbWlncmF0ZV9yZXF1ZXN0LCAmc3ZjLT5mbGFncyk7CiAgICAgICAg
IFNDSEVEX1NUQVRfQ1JBTksobWlncmF0ZV9yZXF1ZXN0ZWQpOwogICAgICAgICB0aWNrbGVfY3B1
KGNwdSwgc3ZjLT5ycWQpOwpAQCAtMjUwNyw3ICsyNTA0LDcgQEAgc3RhdGljIHZvaWQgbWlncmF0
ZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAgICAgewogICAgICAgICBpbnQgb25fcnVu
cSA9IDA7CiAgICAgICAgIC8qIEl0J3Mgbm90IHJ1bm5pbmc7IGp1c3QgbW92ZSBpdCAqLwotICAg
ICAgICBpZiAoIHZjcHVfb25fcnVucShzdmMpICkKKyAgICAgICAgaWYgKCB1bml0X29uX3J1bnEo
c3ZjKSApCiAgICAgICAgIHsKICAgICAgICAgICAgIHJ1bnFfcmVtb3ZlKHN2Yyk7CiAgICAgICAg
ICAgICB1cGRhdGVfbG9hZChvcHMsIHN2Yy0+cnFkLCBOVUxMLCAtMSwgbm93KTsKQEAgLTI1MTYs
MTQgKzI1MTMsMTQgQEAgc3RhdGljIHZvaWQgbWlncmF0ZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVy
ICpvcHMsCiAgICAgICAgIF9ydW5xX2RlYXNzaWduKHN2Yyk7CiAKICAgICAgICAgY3B1bWFza19h
bmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCB1bml0LT5jcHVfaGFyZF9hZmZpbml0eSwKLSAg
ICAgICAgICAgICAgICAgICAgY3B1cG9vbF9kb21haW5fY3B1bWFzayhzdmMtPnZjcHUtPmRvbWFp
bikpOworICAgICAgICAgICAgICAgICAgICBjcHVwb29sX2RvbWFpbl9jcHVtYXNrKHVuaXQtPmRv
bWFpbikpOwogICAgICAgICBjcHVtYXNrX2FuZChjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksIGNw
dW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwKICAgICAgICAgICAgICAgICAgICAgJnRycWQtPmFjdGl2
ZSk7Ci0gICAgICAgIHN2Yy0+dmNwdS0+cHJvY2Vzc29yID0gY3B1bWFza19jeWNsZSh0cnFkLT5w
aWNrX2JpYXMsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBj
cHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSkpOwotICAgICAgICBzdmMtPnZjcHUtPnNjaGVkX3VuaXQt
PnJlcyA9IGdldF9zY2hlZF9yZXMoc3ZjLT52Y3B1LT5wcm9jZXNzb3IpOwotICAgICAgICB0cnFk
LT5waWNrX2JpYXMgPSBzdmMtPnZjcHUtPnByb2Nlc3NvcjsKLSAgICAgICAgQVNTRVJUKHN2Yy0+
dmNwdS0+cHJvY2Vzc29yIDwgbnJfY3B1X2lkcyk7CisgICAgICAgIHNjaGVkX3NldF9yZXModW5p
dCwKKyAgICAgICAgICAgICAgICAgICAgICBnZXRfc2NoZWRfcmVzKGNwdW1hc2tfY3ljbGUodHJx
ZC0+cGlja19iaWFzLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSkpKSk7CisgICAgICAgIHRycWQtPnBpY2tf
YmlhcyA9IHNjaGVkX3VuaXRfbWFzdGVyKHVuaXQpOworICAgICAgICBBU1NFUlQoc2NoZWRfdW5p
dF9tYXN0ZXIodW5pdCkgPCBucl9jcHVfaWRzKTsKIAogICAgICAgICBfcnVucV9hc3NpZ24oc3Zj
LCB0cnFkKTsKICAgICAgICAgaWYgKCBvbl9ydW5xICkKQEAgLTI1NDMsMTQgKzI1NDAsMTQgQEAg
c3RhdGljIHZvaWQgbWlncmF0ZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAgKiAgLSBz
dmMgaXMgbm90IGFscmVhZHkgZmxhZ2dlZCB0byBtaWdyYXRlLAogICogIC0gaWYgc3ZjIGlzIGFs
bG93ZWQgdG8gcnVuIG9uIGF0IGxlYXN0IG9uZSBvZiB0aGUgcGNwdXMgb2YgcnFkLgogICovCi1z
dGF0aWMgYm9vbCB2Y3B1X2lzX21pZ3JhdGVhYmxlKHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YywK
K3N0YXRpYyBib29sIHVuaXRfaXNfbWlncmF0ZWFibGUoc3RydWN0IGNzY2hlZDJfdW5pdCAqc3Zj
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBjc2NoZWQyX3J1bnF1
ZXVlX2RhdGEgKnJxZCkKIHsKLSAgICBzdHJ1Y3QgdmNwdSAqdiA9IHN2Yy0+dmNwdTsKLSAgICBp
bnQgY3B1ID0gc3ZjLT52Y3B1LT5wcm9jZXNzb3I7CisgICAgc3RydWN0IHNjaGVkX3VuaXQgKnVu
aXQgPSBzdmMtPnVuaXQ7CisgICAgaW50IGNwdSA9IHNjaGVkX3VuaXRfbWFzdGVyKHVuaXQpOwog
Ci0gICAgY3B1bWFza19hbmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCB2LT5zY2hlZF91bml0
LT5jcHVfaGFyZF9hZmZpbml0eSwKLSAgICAgICAgICAgICAgICBjcHVwb29sX2RvbWFpbl9jcHVt
YXNrKHYtPmRvbWFpbikpOworICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1
KSwgdW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHksCisgICAgICAgICAgICAgICAgY3B1cG9vbF9kb21h
aW5fY3B1bWFzayh1bml0LT5kb21haW4pKTsKIAogICAgIHJldHVybiAhKHN2Yy0+ZmxhZ3MgJiBD
U0ZMQUdfcnVucV9taWdyYXRlX3JlcXVlc3QpICYmCiAgICAgICAgICAgIGNwdW1hc2tfaW50ZXJz
ZWN0cyhjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksICZycWQtPmFjdGl2ZSk7CkBAIC0yNTg3LDcg
KzI1ODQsNyBAQCByZXRyeToKICAgICBmb3JfZWFjaF9jcHUoaSwgJnBydi0+YWN0aXZlX3F1ZXVl
cykKICAgICB7CiAgICAgICAgIHNfdGltZV90IGRlbHRhOwotICAgICAgICAKKwogICAgICAgICBz
dC5vcnFkID0gcHJ2LT5ycWQgKyBpOwogCiAgICAgICAgIGlmICggc3Qub3JxZCA9PSBzdC5scnFk
CkBAIC0yNTk1LDcgKzI1OTIsNyBAQCByZXRyeToKICAgICAgICAgICAgIGNvbnRpbnVlOwogCiAg
ICAgICAgIHVwZGF0ZV9ydW5xX2xvYWQob3BzLCBzdC5vcnFkLCAwLCBub3cpOwotICAgIAorCiAg
ICAgICAgIGRlbHRhID0gc3QubHJxZC0+Yl9hdmdsb2FkIC0gc3Qub3JxZC0+Yl9hdmdsb2FkOwog
ICAgICAgICBpZiAoIGRlbHRhIDwgMCApCiAgICAgICAgICAgICBkZWx0YSA9IC1kZWx0YTsKQEAg
LTI2MTgsNyArMjYxNSw3IEBAIHJldHJ5OgogICAgICAgICBzX3RpbWVfdCBsb2FkX21heDsKICAg
ICAgICAgaW50IGNwdXNfbWF4OwogCi0gICAgICAgIAorCiAgICAgICAgIGxvYWRfbWF4ID0gc3Qu
bHJxZC0+Yl9hdmdsb2FkOwogICAgICAgICBpZiAoIHN0Lm9ycWQtPmJfYXZnbG9hZCA+IGxvYWRf
bWF4ICkKICAgICAgICAgICAgIGxvYWRfbWF4ID0gc3Qub3JxZC0+Yl9hdmdsb2FkOwpAQCAtMjY1
Nyw3ICsyNjU0LDcgQEAgcmV0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgb3B0X292ZXJsb2FkX2JhbGFuY2VfdG9sZXJhbmNlKSkgKQogICAgICAgICAgICAg
ICAgIGdvdG8gb3V0OwogICAgIH0KLSAgICAgICAgICAgICAKKwogICAgIC8qIFRyeSB0byBncmFi
IHRoZSBvdGhlciBydW5xdWV1ZSBsb2NrOyBpZiBpdCdzIGJlZW4gdGFrZW4gaW4gdGhlCiAgICAg
ICogbWVhbnRpbWUsIHRyeSB0aGUgcHJvY2VzcyBvdmVyIGFnYWluLiAgVGhpcyBjYW4ndCBkZWFk
bG9jawogICAgICAqIGJlY2F1c2UgaWYgaXQgZG9lc24ndCBnZXQgYW55IG90aGVyIHJxZCBsb2Nr
cywgaXQgd2lsbCBzaW1wbHkKQEAgLTI2OTcsMTcgKzI2OTQsMTcgQEAgcmV0cnk6CiAKICAgICAg
ICAgdXBkYXRlX3N2Y19sb2FkKG9wcywgcHVzaF9zdmMsIDAsIG5vdyk7CiAKLSAgICAgICAgaWYg
KCAhdmNwdV9pc19taWdyYXRlYWJsZShwdXNoX3N2Yywgc3Qub3JxZCkgKQorICAgICAgICBpZiAo
ICF1bml0X2lzX21pZ3JhdGVhYmxlKHB1c2hfc3ZjLCBzdC5vcnFkKSApCiAgICAgICAgICAgICBj
b250aW51ZTsKIAogICAgICAgICBsaXN0X2Zvcl9lYWNoKCBwdWxsX2l0ZXIsICZzdC5vcnFkLT5z
dmMgKQogICAgICAgICB7CiAgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICogcHVsbF9z
dmMgPSBsaXN0X2VudHJ5KHB1bGxfaXRlciwgc3RydWN0IGNzY2hlZDJfdW5pdCwgcnFkX2VsZW0p
OwotICAgICAgICAgICAgCisKICAgICAgICAgICAgIGlmICggIWlubmVyX2xvYWRfdXBkYXRlZCAp
CiAgICAgICAgICAgICAgICAgdXBkYXRlX3N2Y19sb2FkKG9wcywgcHVsbF9zdmMsIDAsIG5vdyk7
Ci0gICAgICAgIAotICAgICAgICAgICAgaWYgKCAhdmNwdV9pc19taWdyYXRlYWJsZShwdWxsX3N2
Yywgc3QubHJxZCkgKQorCisgICAgICAgICAgICBpZiAoICF1bml0X2lzX21pZ3JhdGVhYmxlKHB1
bGxfc3ZjLCBzdC5scnFkKSApCiAgICAgICAgICAgICAgICAgY29udGludWU7CiAKICAgICAgICAg
ICAgIGNvbnNpZGVyKCZzdCwgcHVzaF9zdmMsIHB1bGxfc3ZjKTsKQEAgLTI3MjIsOCArMjcxOSw4
IEBAIHJldHJ5OgogICAgIGxpc3RfZm9yX2VhY2goIHB1bGxfaXRlciwgJnN0Lm9ycWQtPnN2YyAp
CiAgICAgewogICAgICAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICogcHVsbF9zdmMgPSBsaXN0X2Vu
dHJ5KHB1bGxfaXRlciwgc3RydWN0IGNzY2hlZDJfdW5pdCwgcnFkX2VsZW0pOwotICAgICAgICAK
LSAgICAgICAgaWYgKCAhdmNwdV9pc19taWdyYXRlYWJsZShwdWxsX3N2Yywgc3QubHJxZCkgKQor
CisgICAgICAgIGlmICggIXVuaXRfaXNfbWlncmF0ZWFibGUocHVsbF9zdmMsIHN0LmxycWQpICkK
ICAgICAgICAgICAgIGNvbnRpbnVlOwogCiAgICAgICAgIC8qIENvbnNpZGVyIHB1bGwgb25seSAq
LwpAQCAtMjc0Niw4ICsyNzQzLDcgQEAgc3RhdGljIHZvaWQKIGNzY2hlZDJfdW5pdF9taWdyYXRl
KAogICAgIGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX3VuaXQgKnVu
aXQsIHVuc2lnbmVkIGludCBuZXdfY3B1KQogewotICAgIHN0cnVjdCB2Y3B1ICp2YyA9IHVuaXQt
PnZjcHVfbGlzdDsKLSAgICBzdHJ1Y3QgZG9tYWluICpkID0gdmMtPmRvbWFpbjsKKyAgICBzdHJ1
Y3QgZG9tYWluICpkID0gdW5pdC0+ZG9tYWluOwogICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKiBj
b25zdCBzdmMgPSBjc2NoZWQyX3VuaXQodW5pdCk7CiAgICAgc3RydWN0IGNzY2hlZDJfcnVucXVl
dWVfZGF0YSAqdHJxZDsKICAgICBzX3RpbWVfdCBub3cgPSBOT1coKTsKQEAgLTI3NTksMjUgKzI3
NTUsMjQgQEAgY3NjaGVkMl91bml0X21pZ3JhdGUoCiAgICAgICogY3B1cG9vbC4KICAgICAgKgog
ICAgICAqIEFuZCBzaW5jZSB0aGVyZSBpbmRlZWQgaXMgdGhlIGNoYW5jZSB0aGF0IGl0IGlzIG5v
dCBwYXJ0IG9mIGl0LCBhbGwKLSAgICAgKiB3ZSBtdXN0IGRvIGlzIHJlbW92ZSBfYW5kXyB1bmFz
c2lnbiB0aGUgdkNQVSBmcm9tIGFueSBydW5xdWV1ZSwgYXMKKyAgICAgKiB3ZSBtdXN0IGRvIGlz
IHJlbW92ZSBfYW5kXyB1bmFzc2lnbiB0aGUgdW5pdCBmcm9tIGFueSBydW5xdWV1ZSwgYXMKICAg
ICAgKiB3ZWxsIGFzIHVwZGF0aW5nIHYtPnByb2Nlc3NvciB3aXRoIHRoZSB0YXJnZXQsIHNvIHRo
YXQgdGhlIHN1c3BlbmQKICAgICAgKiBwcm9jZXNzIGNhbiBjb250aW51ZS4KICAgICAgKgogICAg
ICAqIEl0IHdpbGwgdGhlbiBiZSBkdXJpbmcgcmVzdW1lIHRoYXQgYSBuZXcsIG1lYW5pbmdmdWws
IHZhbHVlIGZvcgogICAgICAqIHYtPnByb2Nlc3NvciB3aWxsIGJlIGNob3NlbiwgYW5kIGR1cmlu
ZyBhY3R1YWwgZG9tYWluIHVucGF1c2UgdGhhdAotICAgICAqIHRoZSB2Q1BVIHdpbGwgYmUgYXNz
aWduZWQgdG8gYW5kIGFkZGVkIHRvIHRoZSBwcm9wZXIgcnVucXVldWUuCisgICAgICogdGhlIHVu
aXQgd2lsbCBiZSBhc3NpZ25lZCB0byBhbmQgYWRkZWQgdG8gdGhlIHByb3BlciBydW5xdWV1ZS4K
ICAgICAgKi8KICAgICBpZiAoIHVubGlrZWx5KCFjcHVtYXNrX3Rlc3RfY3B1KG5ld19jcHUsIGNw
dXBvb2xfZG9tYWluX2NwdW1hc2soZCkpKSApCiAgICAgewogICAgICAgICBBU1NFUlQoc3lzdGVt
X3N0YXRlID09IFNZU19TVEFURV9zdXNwZW5kKTsKLSAgICAgICAgaWYgKCB2Y3B1X29uX3J1bnEo
c3ZjKSApCisgICAgICAgIGlmICggdW5pdF9vbl9ydW5xKHN2YykgKQogICAgICAgICB7CiAgICAg
ICAgICAgICBydW5xX3JlbW92ZShzdmMpOwogICAgICAgICAgICAgdXBkYXRlX2xvYWQob3BzLCBz
dmMtPnJxZCwgTlVMTCwgLTEsIG5vdyk7CiAgICAgICAgIH0KICAgICAgICAgX3J1bnFfZGVhc3Np
Z24oc3ZjKTsKLSAgICAgICAgdmMtPnByb2Nlc3NvciA9IG5ld19jcHU7Ci0gICAgICAgIHVuaXQt
PnJlcyA9IGdldF9zY2hlZF9yZXMobmV3X2NwdSk7CisgICAgICAgIHNjaGVkX3NldF9yZXModW5p
dCwgZ2V0X3NjaGVkX3JlcyhuZXdfY3B1KSk7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKQEAg
LTI3OTEsMTcgKzI3ODYsMTQgQEAgY3NjaGVkMl91bml0X21pZ3JhdGUoCiAgICAgICogRG8gdGhl
IGFjdHVhbCBtb3ZlbWVudCB0b3dhcmQgbmV3X2NwdSwgYW5kIHVwZGF0ZSB2Yy0+cHJvY2Vzc29y
LgogICAgICAqIElmIHdlIGFyZSBjaGFuZ2luZyBydW5xdWV1ZSwgbWlncmF0ZSgpIHRha2VzIGNh
cmUgb2YgZXZlcnl0aGluZy4KICAgICAgKiBJZiB3ZSBhcmUgbm90IGNoYW5naW5nIHJ1bnF1ZXVl
LCB3ZSBuZWVkIHRvIHVwZGF0ZSB2Yy0+cHJvY2Vzc29yCi0gICAgICogaGVyZS4gSW4gZmFjdCwg
aWYsIGZvciBpbnN0YW5jZSwgd2UgYXJlIGhlcmUgYmVjYXVzZSB0aGUgdmNwdSdzCisgICAgICog
aGVyZS4gSW4gZmFjdCwgaWYsIGZvciBpbnN0YW5jZSwgd2UgYXJlIGhlcmUgYmVjYXVzZSB0aGUg
dW5pdCdzCiAgICAgICogaGFyZCBhZmZpbml0eSBjaGFuZ2VkLCB3ZSBkb24ndCB3YW50IHRvIHJp
c2sgbGVhdmluZyB2Yy0+cHJvY2Vzc29yCiAgICAgICogcG9pbnRpbmcgdG8gYSBwY3B1IHdoZXJl
IHdlIGNhbid0IHJ1biBhbnkgbG9uZ2VyLgogICAgICAqLwogICAgIGlmICggdHJxZCAhPSBzdmMt
PnJxZCApCiAgICAgICAgIG1pZ3JhdGUob3BzLCBzdmMsIHRycWQsIG5vdyk7CiAgICAgZWxzZQot
ICAgIHsKLSAgICAgICAgdmMtPnByb2Nlc3NvciA9IG5ld19jcHU7Ci0gICAgICAgIHVuaXQtPnJl
cyA9IGdldF9zY2hlZF9yZXMobmV3X2NwdSk7Ci0gICAgfQorICAgICAgICBzY2hlZF9zZXRfcmVz
KHVuaXQsIGdldF9zY2hlZF9yZXMobmV3X2NwdSkpOwogfQogCiBzdGF0aWMgaW50CkBAIC0yODEz
LDE4ICsyODA1LDE4IEBAIGNzY2hlZDJfZG9tX2NudGwoCiAgICAgc3RydWN0IGNzY2hlZDJfZG9t
ICogY29uc3Qgc2RvbSA9IGNzY2hlZDJfZG9tKGQpOwogICAgIHN0cnVjdCBjc2NoZWQyX3ByaXZh
dGUgKnBydiA9IGNzY2hlZDJfcHJpdihvcHMpOwogICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7Ci0g
ICAgc3RydWN0IHZjcHUgKnY7CisgICAgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQ7CiAgICAgaW50
IHJjID0gMDsKIAogICAgIC8qCiAgICAgICogTG9ja2luZzoKICAgICAgKiAgLSB3ZSBtdXN0IHRh
a2UgdGhlIHByaXZhdGUgbG9jayBmb3IgYWNjZXNzaW5nIHRoZSB3ZWlnaHRzIG9mIHRoZQotICAg
ICAqICAgIHZjcHVzIG9mIGQsIGFuZC9vciB0aGUgY2FwOworICAgICAqICAgIHVuaXRzIG9mIGQs
IGFuZC9vciB0aGUgY2FwOwogICAgICAqICAtIGluIHRoZSBwdXRpbmZvIGNhc2UsIHdlIGFsc28g
bmVlZCB0aGUgcnVucXVldWUgbG9jayhzKSwgZm9yCiAgICAgICogICAgdXBkYXRpbmcgdGhlIG1h
eCB3YWlnaHQgb2YgdGhlIHJ1bnF1ZXVlKHMpLgogICAgICAqICAgIElmIGNoYW5naW5nIHRoZSBj
YXAsIHdlIGFsc28gbmVlZCB0aGUgYnVkZ2V0X2xvY2ssIGZvciB1cGRhdGluZwogICAgICAqICAg
IHRoZSB2YWx1ZSBvZiB0aGUgZG9tYWluIGJ1ZGdldCBwb29sIChhbmQgdGhlIHJ1bnF1ZXVlIGxv
Y2ssCi0gICAgICogICAgZm9yIGFkanVzdGluZyB0aGUgcGFyYW1ldGVycyBhbmQgcmVzY2hlZHVs
aW5nIGFueSB2Q1BVIHRoYXQgaXMKKyAgICAgKiAgICBmb3IgYWRqdXN0aW5nIHRoZSBwYXJhbWV0
ZXJzIGFuZCByZXNjaGVkdWxpbmcgYW55IHVuaXQgdGhhdCBpcwogICAgICAqICAgIHJ1bm5pbmcg
YXQgdGhlIHRpbWUgb2YgdGhlIGNoYW5nZSkuCiAgICAgICovCiAgICAgc3dpdGNoICggb3AtPmNt
ZCApCkBAIC0yODQ2LDE4ICsyODM4LDE4IEBAIGNzY2hlZDJfZG9tX2NudGwoCiAKICAgICAgICAg
ICAgIHNkb20tPndlaWdodCA9IG9wLT51LmNyZWRpdDIud2VpZ2h0OwogCi0gICAgICAgICAgICAv
KiBVcGRhdGUgd2VpZ2h0cyBmb3IgdmNwdXMsIGFuZCBtYXhfd2VpZ2h0IGZvciBydW5xdWV1ZXMg
b24gd2hpY2ggdGhleSByZXNpZGUgKi8KLSAgICAgICAgICAgIGZvcl9lYWNoX3ZjcHUgKCBkLCB2
ICkKKyAgICAgICAgICAgIC8qIFVwZGF0ZSB3ZWlnaHRzIGZvciB1bml0cywgYW5kIG1heF93ZWln
aHQgZm9yIHJ1bnF1ZXVlcyBvbiB3aGljaCB0aGV5IHJlc2lkZSAqLworICAgICAgICAgICAgZm9y
X2VhY2hfc2NoZWRfdW5pdCAoIGQsIHVuaXQgKQogICAgICAgICAgICAgewotICAgICAgICAgICAg
ICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YyA9IGNzY2hlZDJfdW5pdCh2LT5zY2hlZF91bml0
KTsKLSAgICAgICAgICAgICAgICBzcGlubG9ja190ICpsb2NrID0gdW5pdF9zY2hlZHVsZV9sb2Nr
KHN2Yy0+dmNwdS0+c2NoZWRfdW5pdCk7CisgICAgICAgICAgICAgICAgc3RydWN0IGNzY2hlZDJf
dW5pdCAqc3ZjID0gY3NjaGVkMl91bml0KHVuaXQpOworICAgICAgICAgICAgICAgIHNwaW5sb2Nr
X3QgKmxvY2sgPSB1bml0X3NjaGVkdWxlX2xvY2sodW5pdCk7CiAKLSAgICAgICAgICAgICAgICBB
U1NFUlQoc3ZjLT5ycWQgPT0gYzJycWQob3BzLCBzdmMtPnZjcHUtPnByb2Nlc3NvcikpOworICAg
ICAgICAgICAgICAgIEFTU0VSVChzdmMtPnJxZCA9PSBjMnJxZChvcHMsIHNjaGVkX3VuaXRfbWFz
dGVyKHVuaXQpKSk7CiAKICAgICAgICAgICAgICAgICBzdmMtPndlaWdodCA9IHNkb20tPndlaWdo
dDsKICAgICAgICAgICAgICAgICB1cGRhdGVfbWF4X3dlaWdodChzdmMtPnJxZCwgc3ZjLT53ZWln
aHQsIG9sZF93ZWlnaHQpOwogCi0gICAgICAgICAgICAgICAgdW5pdF9zY2hlZHVsZV91bmxvY2so
bG9jaywgc3ZjLT52Y3B1LT5zY2hlZF91bml0KTsKKyAgICAgICAgICAgICAgICB1bml0X3NjaGVk
dWxlX3VubG9jayhsb2NrLCB1bml0KTsKICAgICAgICAgICAgIH0KICAgICAgICAgfQogICAgICAg
ICAvKiBDYXAgKi8KQEAgLTI4NjYsOCArMjg1OCw4IEBAIGNzY2hlZDJfZG9tX2NudGwoCiAgICAg
ICAgICAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmM7CiAgICAgICAgICAgICBzcGlubG9ja190
ICpsb2NrOwogCi0gICAgICAgICAgICAvKiBDYXAgaXMgb25seSB2YWxpZCBpZiBpdCdzIGJlbG93
IDEwMCAqIG5yX29mX3ZDUFVTICovCi0gICAgICAgICAgICBpZiAoIG9wLT51LmNyZWRpdDIuY2Fw
ID4gMTAwICogc2RvbS0+bnJfdmNwdXMgKQorICAgICAgICAgICAgLyogQ2FwIGlzIG9ubHkgdmFs
aWQgaWYgaXQncyBiZWxvdyAxMDAgKiBucl9vZl91bml0cyAqLworICAgICAgICAgICAgaWYgKCBv
cC0+dS5jcmVkaXQyLmNhcCA+IDEwMCAqIHNkb20tPm5yX3VuaXRzICkKICAgICAgICAgICAgIHsK
ICAgICAgICAgICAgICAgICByYyA9IC1FSU5WQUw7CiAgICAgICAgICAgICAgICAgd3JpdGVfdW5s
b2NrX2lycXJlc3RvcmUoJnBydi0+bG9jaywgZmxhZ3MpOwpAQCAtMjg4MCwyMyArMjg3MiwyMyBA
QCBjc2NoZWQyX2RvbV9jbnRsKAogICAgICAgICAgICAgc3Bpbl91bmxvY2soJnNkb20tPmJ1ZGdl
dF9sb2NrKTsKIAogICAgICAgICAgICAgLyoKLSAgICAgICAgICAgICAqIFdoZW4gdHJ5aW5nIHRv
IGdldCBzb21lIGJ1ZGdldCBhbmQgcnVuLCBlYWNoIHZDUFUgd2lsbCBncmFiCi0gICAgICAgICAg
ICAgKiBmcm9tIHRoZSBwb29sIDEvTiAod2l0aCBOID0gbnIgb2YgdkNQVXMgb2YgdGhlIGRvbWFp
bikgb2YKLSAgICAgICAgICAgICAqIHRoZSB0b3RhbCBidWRnZXQuIFJvdWdobHkgc3BlYWtpbmcs
IHRoaXMgbWVhbnMgZWFjaCB2Q1BVIHdpbGwKKyAgICAgICAgICAgICAqIFdoZW4gdHJ5aW5nIHRv
IGdldCBzb21lIGJ1ZGdldCBhbmQgcnVuLCBlYWNoIHVuaXQgd2lsbCBncmFiCisgICAgICAgICAg
ICAgKiBmcm9tIHRoZSBwb29sIDEvTiAod2l0aCBOID0gbnIgb2YgdW5pdHMgb2YgdGhlIGRvbWFp
bikgb2YKKyAgICAgICAgICAgICAqIHRoZSB0b3RhbCBidWRnZXQuIFJvdWdobHkgc3BlYWtpbmcs
IHRoaXMgbWVhbnMgZWFjaCB1bml0IHdpbGwKICAgICAgICAgICAgICAqIGhhdmUgYXQgbGVhc3Qg
b25lIGNoYW5jZSB0byBydW4gZHVyaW5nIGV2ZXJ5IHBlcmlvZC4KICAgICAgICAgICAgICAqLwot
ICAgICAgICAgICAgZm9yX2VhY2hfdmNwdSAoIGQsIHYgKQorICAgICAgICAgICAgZm9yX2VhY2hf
c2NoZWRfdW5pdCAoIGQsIHVuaXQgKQogICAgICAgICAgICAgewotICAgICAgICAgICAgICAgIHN2
YyA9IGNzY2hlZDJfdW5pdCh2LT5zY2hlZF91bml0KTsKLSAgICAgICAgICAgICAgICBsb2NrID0g
dW5pdF9zY2hlZHVsZV9sb2NrKHN2Yy0+dmNwdS0+c2NoZWRfdW5pdCk7CisgICAgICAgICAgICAg
ICAgc3ZjID0gY3NjaGVkMl91bml0KHVuaXQpOworICAgICAgICAgICAgICAgIGxvY2sgPSB1bml0
X3NjaGVkdWxlX2xvY2sodW5pdCk7CiAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAg
ICAgKiBUb28gc21hbGwgcXVvdGFzIHdvdWxkIGluIHRoZW9yeSBjYXVzZSBhIGxvdCBvZiBvdmVy
aGVhZCwKICAgICAgICAgICAgICAgICAgKiB3aGljaCB0aGVuIHdvbid0IGhhcHBlbiBiZWNhdXNl
LCBpbiBjc2NoZWQyX3J1bnRpbWUoKSwKICAgICAgICAgICAgICAgICAgKiBDU0NIRUQyX01JTl9U
SU1FUiBpcyB3aGF0IHdvdWxkIGJlIHVzZWQgYW55d2F5LgogICAgICAgICAgICAgICAgICAqLwot
ICAgICAgICAgICAgICAgIHN2Yy0+YnVkZ2V0X3F1b3RhID0gbWF4KHNkb20tPnRvdF9idWRnZXQg
LyBzZG9tLT5ucl92Y3B1cywKKyAgICAgICAgICAgICAgICBzdmMtPmJ1ZGdldF9xdW90YSA9IG1h
eChzZG9tLT50b3RfYnVkZ2V0IC8gc2RvbS0+bnJfdW5pdHMsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgQ1NDSEVEMl9NSU5fVElNRVIpOwotICAgICAgICAgICAgICAg
IHVuaXRfc2NoZWR1bGVfdW5sb2NrKGxvY2ssIHN2Yy0+dmNwdS0+c2NoZWRfdW5pdCk7CisgICAg
ICAgICAgICAgICAgdW5pdF9zY2hlZHVsZV91bmxvY2sobG9jaywgdW5pdCk7CiAgICAgICAgICAg
ICB9CiAKICAgICAgICAgICAgIGlmICggc2RvbS0+Y2FwID09IDAgKQpAQCAtMjkwNiw3ICsyODk4
LDcgQEAgY3NjaGVkMl9kb21fY250bCgKICAgICAgICAgICAgICAgICAgKiBhbmQgcXVldWUgaXRz
IGZpcnN0IHJlcGxlbmlzaG1lbnQgZXZlbnQuCiAgICAgICAgICAgICAgICAgICoKICAgICAgICAg
ICAgICAgICAgKiBTaW5jZSBjYXAgaXMgY3VycmVudGx5IGRpc2FibGVkIGZvciB0aGlzIGRvbWFp
biwgd2UKLSAgICAgICAgICAgICAgICAgKiBrbm93IG5vIHZDUFUgaXMgbWVzc2luZyB3aXRoIHRo
ZSBkb21haW4ncyBidWRnZXQsIGFuZAorICAgICAgICAgICAgICAgICAqIGtub3cgbm8gdW5pdCBp
cyBtZXNzaW5nIHdpdGggdGhlIGRvbWFpbidzIGJ1ZGdldCwgYW5kCiAgICAgICAgICAgICAgICAg
ICogdGhlIHJlcGxlbmlzaG1lbnQgdGltZXIgaXMgc3RpbGwgb2ZmLgogICAgICAgICAgICAgICAg
ICAqIEZvciB0aGVzZSByZWFzb25zLCBpdCBpcyBzYWZlIHRvIGRvIHRoZSBmb2xsb3dpbmcgd2l0
aG91dAogICAgICAgICAgICAgICAgICAqIHRha2luZyB0aGUgYnVkZ2V0X2xvY2suCkBAIC0yOTE2
LDQyICsyOTA4LDQyIEBAIGNzY2hlZDJfZG9tX2NudGwoCiAgICAgICAgICAgICAgICAgc2V0X3Rp
bWVyKCZzZG9tLT5yZXBsX3RpbWVyLCBzZG9tLT5uZXh0X3JlcGwpOwogCiAgICAgICAgICAgICAg
ICAgLyoKLSAgICAgICAgICAgICAgICAgKiBOb3csIGxldCdzIGVuYWJsZSBidWRnZXQgYWNjb3Vu
dGluZyBmb3IgYWxsIHRoZSB2Q1BVcy4KKyAgICAgICAgICAgICAgICAgKiBOb3csIGxldCdzIGVu
YWJsZSBidWRnZXQgYWNjb3VudGluZyBmb3IgYWxsIHRoZSB1bml0cy4KICAgICAgICAgICAgICAg
ICAgKiBGb3IgbWFraW5nIHN1cmUgdGhhdCB0aGV5IHdpbGwgc3RhcnQgdG8gaG9ub3VyIHRoZSBk
b21haW4ncwogICAgICAgICAgICAgICAgICAqIGNhcCwgd2Ugc2V0IHRoZWlyIGJ1ZGdldCB0byAw
LgogICAgICAgICAgICAgICAgICAqIFRoaXMgd2F5LCBhcyBzb29uIGFzIHRoZXkgd2lsbCB0cnkg
dG8gcnVuLCB0aGV5IHdpbGwgaGF2ZQogICAgICAgICAgICAgICAgICAqIHRvIGdldCBzb21lIGJ1
ZGdldC4KICAgICAgICAgICAgICAgICAgKgotICAgICAgICAgICAgICAgICAqIEZvciB0aGUgdkNQ
VXMgdGhhdCBhcmUgYWxyZWFkeSBydW5uaW5nLCB3ZSB0cmlnZ2VyIHRoZQorICAgICAgICAgICAg
ICAgICAqIEZvciB0aGUgdW5pdHMgdGhhdCBhcmUgYWxyZWFkeSBydW5uaW5nLCB3ZSB0cmlnZ2Vy
IHRoZQogICAgICAgICAgICAgICAgICAqIHNjaGVkdWxlciBvbiB0aGVpciBwQ1BVLiBXaGVuLCBh
cyBhIGNvbnNlcXVlbmNlIG9mIHRoaXMsCiAgICAgICAgICAgICAgICAgICogY3NjaGVkMl9zY2hl
ZHVsZSgpIHdpbGwgcnVuLCBpdCB3aWxsIGZpZ3VyZSBvdXQgdGhlcmUgaXMKLSAgICAgICAgICAg
ICAgICAgKiBubyBidWRnZXQsIGFuZCB0aGUgdkNQVSB3aWxsIHRyeSB0byBnZXQgc29tZSAoYW5k
IGJlIHBhcmtlZCwKKyAgICAgICAgICAgICAgICAgKiBubyBidWRnZXQsIGFuZCB0aGUgdW5pdCB3
aWxsIHRyeSB0byBnZXQgc29tZSAoYW5kIGJlIHBhcmtlZCwKICAgICAgICAgICAgICAgICAgKiBp
ZiB0aGVyZSdzIG5vbmUsIGFuZCB3ZSdsbCBzd2l0Y2ggdG8gc29tZW9uZSBlbHNlKS4KICAgICAg
ICAgICAgICAgICAgKi8KLSAgICAgICAgICAgICAgICBmb3JfZWFjaF92Y3B1ICggZCwgdiApCisg
ICAgICAgICAgICAgICAgZm9yX2VhY2hfc2NoZWRfdW5pdCAoIGQsIHVuaXQgKQogICAgICAgICAg
ICAgICAgIHsKLSAgICAgICAgICAgICAgICAgICAgc3ZjID0gY3NjaGVkMl91bml0KHYtPnNjaGVk
X3VuaXQpOwotICAgICAgICAgICAgICAgICAgICBsb2NrID0gdW5pdF9zY2hlZHVsZV9sb2NrKHN2
Yy0+dmNwdS0+c2NoZWRfdW5pdCk7Ci0gICAgICAgICAgICAgICAgICAgIGlmICggdi0+c2NoZWRf
dW5pdC0+aXNfcnVubmluZyApCisgICAgICAgICAgICAgICAgICAgIHN2YyA9IGNzY2hlZDJfdW5p
dCh1bml0KTsKKyAgICAgICAgICAgICAgICAgICAgbG9jayA9IHVuaXRfc2NoZWR1bGVfbG9jayh1
bml0KTsKKyAgICAgICAgICAgICAgICAgICAgaWYgKCB1bml0LT5pc19ydW5uaW5nICkKICAgICAg
ICAgICAgICAgICAgICAgewotICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IGNw
dSA9IHYtPnByb2Nlc3NvcjsKKyAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCBj
cHUgPSBzY2hlZF91bml0X21hc3Rlcih1bml0KTsKICAgICAgICAgICAgICAgICAgICAgICAgIHN0
cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCA9IGMycnFkKG9wcywgY3B1KTsKIAotICAg
ICAgICAgICAgICAgICAgICAgICAgQVNTRVJUKGN1cnJfb25fY3B1KGNwdSktPnZjcHVfbGlzdCA9
PSB2KTsKKyAgICAgICAgICAgICAgICAgICAgICAgIEFTU0VSVChjdXJyX29uX2NwdShjcHUpID09
IHVuaXQpOwogCiAgICAgICAgICAgICAgICAgICAgICAgICAvKgotICAgICAgICAgICAgICAgICAg
ICAgICAgICogV2UgYXJlIHRyaWdnZXJpbmcgYSByZXNjaGVkdWxlIG9uIHRoZSB2Q1BVJ3MKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAqIFdlIGFyZSB0cmlnZ2VyaW5nIGEgcmVzY2hlZHVsZSBv
biB0aGUgdW5pdCdzCiAgICAgICAgICAgICAgICAgICAgICAgICAgKiBwQ1BVLiBUaGF0IHdpbGwg
cnVuIGJ1cm5fY3JlZGl0cygpIGFuZCwgc2luY2UKLSAgICAgICAgICAgICAgICAgICAgICAgICAq
IHRoZSB2Q1BVIGlzIGNhcHBlZCBub3csIGl0IHdvdWxkIGNoYXJnZSBhbGwgdGhlCisgICAgICAg
ICAgICAgICAgICAgICAgICAgKiB0aGUgdW5pdCBpcyBjYXBwZWQgbm93LCBpdCB3b3VsZCBjaGFy
Z2UgYWxsIHRoZQogICAgICAgICAgICAgICAgICAgICAgICAgICogZXhlY3V0aW9uIHRpbWUgb2Yg
dGhpcyBsYXN0IHJvdW5kIGFzIGJ1ZGdldCBhcwotICAgICAgICAgICAgICAgICAgICAgICAgICog
d2VsbC4gVGhhdCB3aWxsIG1ha2UgdGhlIHZDUFUgYnVkZ2V0IGdvIG5lZ2F0aXZlLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICogd2VsbC4gVGhhdCB3aWxsIG1ha2UgdGhlIHVuaXQgYnVkZ2V0
IGdvIG5lZ2F0aXZlLAogICAgICAgICAgICAgICAgICAgICAgICAgICogcG90ZW50aWFsbHkgYnkg
YSBsYXJnZSBhbW91bnQsIGFuZCBpdCdzIHVuZmFpci4KICAgICAgICAgICAgICAgICAgICAgICAg
ICAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgKiBUbyBhdm9pZCB0aGF0LCBjYWxsIGJ1cm5f
Y3JlZGl0KCkgaGVyZSwgdG8gZG8gdGhlCiAgICAgICAgICAgICAgICAgICAgICAgICAgKiBhY2Nv
dW50aW5nIG9mIHRoaXMgY3VycmVudCBydW5uaW5nIGluc3RhbmNlIG5vdywKICAgICAgICAgICAg
ICAgICAgICAgICAgICAqIHdpdGggYnVkZ2V0dGluZyBzdGlsbCBkaXNhYmxlZC4gVGhpcyBkb2Vz
IG5vdAogICAgICAgICAgICAgICAgICAgICAgICAgICogcHJldmVudCBzb21lIHNtYWxsIGFtb3Vu
dCBvZiBidWRnZXQgYmVpbmcgY2hhcmdlZAotICAgICAgICAgICAgICAgICAgICAgICAgICogdG8g
dGhlIHZDUFUgKGkuZS4sIHRoZSBhbW91bnQgb2YgdGltZSBpdCBydW5zIGZyb20KKyAgICAgICAg
ICAgICAgICAgICAgICAgICAqIHRvIHRoZSB1bml0IChpLmUuLCB0aGUgYW1vdW50IG9mIHRpbWUg
aXQgcnVucyBmcm9tCiAgICAgICAgICAgICAgICAgICAgICAgICAgKiBub3csIHRvIHdoZW4gc2No
ZWR1bGluZyBoYXBwZW5zKS4gVGhlIGJ1ZGdldCB3aWxsCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgKiBhbHNvIGdvIGJlbG93IDAsIGJ1dCBhIGxvdCBsZXNzIHRoYW4gaG93IGl0IHdvdWxkCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgKiBpZiB3ZSBkb24ndCBkbyB0aGlzLgpAQCAtMjk2Miw3
ICsyOTU0LDcgQEAgY3NjaGVkMl9kb21fY250bCgKICAgICAgICAgICAgICAgICAgICAgICAgIGNw
dV9yYWlzZV9zb2Z0aXJxKGNwdSwgU0NIRURVTEVfU09GVElSUSk7CiAgICAgICAgICAgICAgICAg
ICAgIH0KICAgICAgICAgICAgICAgICAgICAgc3ZjLT5idWRnZXQgPSAwOwotICAgICAgICAgICAg
ICAgICAgICB1bml0X3NjaGVkdWxlX3VubG9jayhsb2NrLCBzdmMtPnZjcHUtPnNjaGVkX3VuaXQp
OworICAgICAgICAgICAgICAgICAgICB1bml0X3NjaGVkdWxlX3VubG9jayhsb2NrLCB1bml0KTsK
ICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICB9CiAKQEAgLTI5NzQsMzAgKzI5NjYsMzAg
QEAgY3NjaGVkMl9kb21fY250bCgKIAogICAgICAgICAgICAgc3RvcF90aW1lcigmc2RvbS0+cmVw
bF90aW1lcik7CiAKLSAgICAgICAgICAgIC8qIERpc2FibGUgYnVkZ2V0IGFjY291bnRpbmcgZm9y
IGFsbCB0aGUgdkNQVXMuICovCi0gICAgICAgICAgICBmb3JfZWFjaF92Y3B1ICggZCwgdiApCisg
ICAgICAgICAgICAvKiBEaXNhYmxlIGJ1ZGdldCBhY2NvdW50aW5nIGZvciBhbGwgdGhlIHVuaXRz
LiAqLworICAgICAgICAgICAgZm9yX2VhY2hfc2NoZWRfdW5pdCAoIGQsIHVuaXQgKQogICAgICAg
ICAgICAgewotICAgICAgICAgICAgICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YyA9IGNzY2hl
ZDJfdW5pdCh2LT5zY2hlZF91bml0KTsKLSAgICAgICAgICAgICAgICBzcGlubG9ja190ICpsb2Nr
ID0gdW5pdF9zY2hlZHVsZV9sb2NrKHN2Yy0+dmNwdS0+c2NoZWRfdW5pdCk7CisgICAgICAgICAg
ICAgICAgc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjID0gY3NjaGVkMl91bml0KHVuaXQpOworICAg
ICAgICAgICAgICAgIHNwaW5sb2NrX3QgKmxvY2sgPSB1bml0X3NjaGVkdWxlX2xvY2sodW5pdCk7
CiAKICAgICAgICAgICAgICAgICBzdmMtPmJ1ZGdldCA9IFNUSU1FX01BWDsKICAgICAgICAgICAg
ICAgICBzdmMtPmJ1ZGdldF9xdW90YSA9IDA7CiAKLSAgICAgICAgICAgICAgICB1bml0X3NjaGVk
dWxlX3VubG9jayhsb2NrLCBzdmMtPnZjcHUtPnNjaGVkX3VuaXQpOworICAgICAgICAgICAgICAg
IHVuaXRfc2NoZWR1bGVfdW5sb2NrKGxvY2ssIHVuaXQpOwogICAgICAgICAgICAgfQogICAgICAg
ICAgICAgc2RvbS0+Y2FwID0gMDsKICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgKiBXZSBh
cmUgZGlzYWJsaW5nIHRoZSBjYXAgZm9yIHRoaXMgZG9tYWluLCB3aGljaCBtYXkgaGF2ZQotICAg
ICAgICAgICAgICogdkNQVXMgd2FpdGluZyBmb3IgYSByZXBsZW5pc2htZW50LCBzbyB3ZSB1bnBh
cmsgdGhlbSBhbGwuCisgICAgICAgICAgICAgKiB1bml0cyB3YWl0aW5nIGZvciBhIHJlcGxlbmlz
aG1lbnQsIHNvIHdlIHVucGFyayB0aGVtIGFsbC4KICAgICAgICAgICAgICAqIE5vdGUgdGhhdCwg
c2luY2Ugd2UgaGF2ZSBhbHJlYWR5IGRpc2FibGVkIGJ1ZGdldCBhY2NvdW50aW5nCi0gICAgICAg
ICAgICAgKiBmb3IgYWxsIHRoZSB2Q1BVcyBvZiB0aGUgZG9tYWluLCBubyBjdXJyZW50bHkgcnVu
bmluZyB2Q1BVCi0gICAgICAgICAgICAgKiB3aWxsIGJlIGFkZGVkIHRvIHRoZSBwYXJrZWQgdkNQ
VXMgbGlzdCBhbnkgbG9uZ2VyLgorICAgICAgICAgICAgICogZm9yIGFsbCB0aGUgdW5pdHMgb2Yg
dGhlIGRvbWFpbiwgbm8gY3VycmVudGx5IHJ1bm5pbmcgdW5pdAorICAgICAgICAgICAgICogd2ls
bCBiZSBhZGRlZCB0byB0aGUgcGFya2VkIHVuaXRzIGxpc3QgYW55IGxvbmdlci4KICAgICAgICAg
ICAgICAqLwogICAgICAgICAgICAgc3Bpbl9sb2NrKCZzZG9tLT5idWRnZXRfbG9jayk7Ci0gICAg
ICAgICAgICBsaXN0X3NwbGljZV9pbml0KCZzZG9tLT5wYXJrZWRfdmNwdXMsICZwYXJrZWQpOwor
ICAgICAgICAgICAgbGlzdF9zcGxpY2VfaW5pdCgmc2RvbS0+cGFya2VkX3VuaXRzLCAmcGFya2Vk
KTsKICAgICAgICAgICAgIHNwaW5fdW5sb2NrKCZzZG9tLT5idWRnZXRfbG9jayk7CiAKLSAgICAg
ICAgICAgIHVucGFya19wYXJrZWRfdmNwdXMob3BzLCAmcGFya2VkKTsKKyAgICAgICAgICAgIHVu
cGFya19wYXJrZWRfdW5pdHMob3BzLCAmcGFya2VkKTsKICAgICAgICAgfQogICAgICAgICB3cml0
ZV91bmxvY2tfaXJxcmVzdG9yZSgmcHJ2LT5sb2NrLCBmbGFncyk7CiAgICAgICAgIGJyZWFrOwpA
QCAtMzA3NCwxMiArMzA2NiwxMiBAQCBjc2NoZWQyX2FsbG9jX2RvbWRhdGEoY29uc3Qgc3RydWN0
IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgZG9tYWluICpkb20pCiAgICAgc2RvbS0+ZG9tID0gZG9t
OwogICAgIHNkb20tPndlaWdodCA9IENTQ0hFRDJfREVGQVVMVF9XRUlHSFQ7CiAgICAgc2RvbS0+
Y2FwID0gMFU7Ci0gICAgc2RvbS0+bnJfdmNwdXMgPSAwOworICAgIHNkb20tPm5yX3VuaXRzID0g
MDsKIAogICAgIGluaXRfdGltZXIoJnNkb20tPnJlcGxfdGltZXIsIHJlcGxlbmlzaF9kb21haW5f
YnVkZ2V0LCBzZG9tLAogICAgICAgICAgICAgICAgY3B1bWFza19hbnkoY3B1cG9vbF9kb21haW5f
Y3B1bWFzayhkb20pKSk7CiAgICAgc3Bpbl9sb2NrX2luaXQoJnNkb20tPmJ1ZGdldF9sb2NrKTsK
LSAgICBJTklUX0xJU1RfSEVBRCgmc2RvbS0+cGFya2VkX3ZjcHVzKTsKKyAgICBJTklUX0xJU1Rf
SEVBRCgmc2RvbS0+cGFya2VkX3VuaXRzKTsKIAogICAgIHdyaXRlX2xvY2tfaXJxc2F2ZSgmcHJ2
LT5sb2NrLCBmbGFncyk7CiAKQEAgLTMxMTMsMzQgKzMxMDUsMzIgQEAgY3NjaGVkMl9mcmVlX2Rv
bWRhdGEoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCB2b2lkICpkYXRhKQogc3RhdGljIHZv
aWQKIGNzY2hlZDJfdW5pdF9pbnNlcnQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1
Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIHsKLSAgICBzdHJ1Y3QgdmNwdSAqdmMgPSB1bml0LT52Y3B1
X2xpc3Q7CiAgICAgc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjID0gdW5pdC0+cHJpdjsKICAgICBz
dHJ1Y3QgY3NjaGVkMl9kb20gKiBjb25zdCBzZG9tID0gc3ZjLT5zZG9tOwogICAgIHNwaW5sb2Nr
X3QgKmxvY2s7CiAKLSAgICBBU1NFUlQoIWlzX2lkbGVfdmNwdSh2YykpOworICAgIEFTU0VSVCgh
aXNfaWRsZV91bml0KHVuaXQpKTsKICAgICBBU1NFUlQobGlzdF9lbXB0eSgmc3ZjLT5ydW5xX2Vs
ZW0pKTsKIAogICAgIC8qIGNzY2hlZDJfcmVzX3BpY2soKSBleHBlY3RzIHRoZSBwY3B1IGxvY2sg
dG8gYmUgaGVsZCAqLwogICAgIGxvY2sgPSB1bml0X3NjaGVkdWxlX2xvY2tfaXJxKHVuaXQpOwog
Ci0gICAgdW5pdC0+cmVzID0gY3NjaGVkMl9yZXNfcGljayhvcHMsIHVuaXQpOwotICAgIHZjLT5w
cm9jZXNzb3IgPSB1bml0LT5yZXMtPm1hc3Rlcl9jcHU7CisgICAgc2NoZWRfc2V0X3Jlcyh1bml0
LCBjc2NoZWQyX3Jlc19waWNrKG9wcywgdW5pdCkpOwogCiAgICAgc3Bpbl91bmxvY2tfaXJxKGxv
Y2spOwogCiAgICAgbG9jayA9IHVuaXRfc2NoZWR1bGVfbG9ja19pcnEodW5pdCk7CiAKLSAgICAv
KiBBZGQgdmNwdSB0byBydW5xdWV1ZSBvZiBpbml0aWFsIHByb2Nlc3NvciAqLwotICAgIHJ1bnFf
YXNzaWduKG9wcywgdmMpOworICAgIC8qIEFkZCB1bml0IHRvIHJ1bnF1ZXVlIG9mIGluaXRpYWwg
cHJvY2Vzc29yICovCisgICAgcnVucV9hc3NpZ24ob3BzLCB1bml0KTsKIAogICAgIHVuaXRfc2No
ZWR1bGVfdW5sb2NrX2lycShsb2NrLCB1bml0KTsKIAotICAgIHNkb20tPm5yX3ZjcHVzKys7Cisg
ICAgc2RvbS0+bnJfdW5pdHMrKzsKIAogICAgIFNDSEVEX1NUQVRfQ1JBTksodW5pdF9pbnNlcnQp
OwogCi0gICAgQ1NDSEVEMl9WQ1BVX0NIRUNLKHZjKTsKKyAgICBDU0NIRUQyX1VOSVRfQ0hFQ0so
dW5pdCk7CiB9CiAKIHN0YXRpYyB2b2lkCkBAIC0zMTU0LDExICszMTQ0LDEwIEBAIGNzY2hlZDJf
ZnJlZV91ZGF0YShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHZvaWQgKnByaXYpCiBzdGF0
aWMgdm9pZAogY3NjaGVkMl91bml0X3JlbW92ZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMs
IHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogewotICAgIHN0cnVjdCB2Y3B1ICp2YyA9IHVuaXQt
PnZjcHVfbGlzdDsKICAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICogY29uc3Qgc3ZjID0gY3NjaGVk
Ml91bml0KHVuaXQpOwogICAgIHNwaW5sb2NrX3QgKmxvY2s7CiAKLSAgICBBU1NFUlQoIWlzX2lk
bGVfdmNwdSh2YykpOworICAgIEFTU0VSVCghaXNfaWRsZV91bml0KHVuaXQpKTsKICAgICBBU1NF
UlQobGlzdF9lbXB0eSgmc3ZjLT5ydW5xX2VsZW0pKTsKIAogICAgIFNDSEVEX1NUQVRfQ1JBTkso
dW5pdF9yZW1vdmUpOwpAQCAtMzE2NiwxNCArMzE1NSwxNCBAQCBjc2NoZWQyX3VuaXRfcmVtb3Zl
KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiAg
ICAgLyogUmVtb3ZlIGZyb20gcnVucXVldWUgKi8KICAgICBsb2NrID0gdW5pdF9zY2hlZHVsZV9s
b2NrX2lycSh1bml0KTsKIAotICAgIHJ1bnFfZGVhc3NpZ24ob3BzLCB2Yyk7CisgICAgcnVucV9k
ZWFzc2lnbihvcHMsIHVuaXQpOwogCiAgICAgdW5pdF9zY2hlZHVsZV91bmxvY2tfaXJxKGxvY2ss
IHVuaXQpOwogCi0gICAgc3ZjLT5zZG9tLT5ucl92Y3B1cy0tOworICAgIHN2Yy0+c2RvbS0+bnJf
dW5pdHMtLTsKIH0KIAotLyogSG93IGxvbmcgc2hvdWxkIHdlIGxldCB0aGlzIHZjcHUgcnVuIGZv
cj8gKi8KKy8qIEhvdyBsb25nIHNob3VsZCB3ZSBsZXQgdGhpcyB1bml0IHJ1biBmb3I/ICovCiBz
dGF0aWMgc190aW1lX3QKIGNzY2hlZDJfcnVudGltZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpv
cHMsIGludCBjcHUsCiAgICAgICAgICAgICAgICAgc3RydWN0IGNzY2hlZDJfdW5pdCAqc25leHQs
IHNfdGltZV90IG5vdykKQEAgLTMxODgsNyArMzE3Nyw3IEBAIGNzY2hlZDJfcnVudGltZShjb25z
dCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGludCBjcHUsCiAgICAgICogSWYgd2UncmUgaWRsZSwg
anVzdCBzdGF5IHNvLiBPdGhlcnMgKG9yIGV4dGVybmFsIGV2ZW50cykKICAgICAgKiB3aWxsIHBv
a2UgdXMgd2hlbiBuZWNlc3NhcnkuCiAgICAgICovCi0gICAgaWYgKCBpc19pZGxlX3ZjcHUoc25l
eHQtPnZjcHUpICkKKyAgICBpZiAoIGlzX2lkbGVfdW5pdChzbmV4dC0+dW5pdCkgKQogICAgICAg
ICByZXR1cm4gLTE7CiAKICAgICAvKiBHZW5lcmFsIGFsZ29yaXRobToKQEAgLTMyMDUsOCArMzE5
NCw4IEBAIGNzY2hlZDJfcnVudGltZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGludCBj
cHUsCiAgICAgaWYgKCBwcnYtPnJhdGVsaW1pdF91cyApCiAgICAgewogICAgICAgICBzX3RpbWVf
dCByYXRlbGltaXRfbWluID0gTUlDUk9TRUNTKHBydi0+cmF0ZWxpbWl0X3VzKTsKLSAgICAgICAg
aWYgKCBzbmV4dC0+dmNwdS0+c2NoZWRfdW5pdC0+aXNfcnVubmluZyApCi0gICAgICAgICAgICBy
YXRlbGltaXRfbWluID0gc25leHQtPnZjcHUtPnNjaGVkX3VuaXQtPnN0YXRlX2VudHJ5X3RpbWUg
KworICAgICAgICBpZiAoIHNuZXh0LT51bml0LT5pc19ydW5uaW5nICkKKyAgICAgICAgICAgIHJh
dGVsaW1pdF9taW4gPSBzbmV4dC0+dW5pdC0+c3RhdGVfZW50cnlfdGltZSArCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgTUlDUk9TRUNTKHBydi0+cmF0ZWxpbWl0X3VzKSAtIG5vdzsKICAg
ICAgICAgaWYgKCByYXRlbGltaXRfbWluID4gbWluX3RpbWUgKQogICAgICAgICAgICAgbWluX3Rp
bWUgPSByYXRlbGltaXRfbWluOwpAQCAtMzIyMyw3ICszMjEyLDcgQEAgY3NjaGVkMl9ydW50aW1l
KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgaW50IGNwdSwKICAgICB7CiAgICAgICAgIHN0
cnVjdCBjc2NoZWQyX3VuaXQgKnN3YWl0ID0gcnVucV9lbGVtKHJ1bnEtPm5leHQpOwogCi0gICAg
ICAgIGlmICggISBpc19pZGxlX3ZjcHUoc3dhaXQtPnZjcHUpCisgICAgICAgIGlmICggISBpc19p
ZGxlX3VuaXQoc3dhaXQtPnVuaXQpCiAgICAgICAgICAgICAgJiYgc3dhaXQtPmNyZWRpdCA+IDAg
KQogICAgICAgICB7CiAgICAgICAgICAgICBydF9jcmVkaXQgPSBzbmV4dC0+Y3JlZGl0IC0gc3dh
aXQtPmNyZWRpdDsKQEAgLTMyMzcsNyArMzIyNiw3IEBAIGNzY2hlZDJfcnVudGltZShjb25zdCBz
dHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGludCBjcHUsCiAgICAgICoKICAgICAgKiBGSVhNRTogU2Vl
IGlmIHdlIGNhbiBlbGltaW5hdGUgdGhpcyBjb252ZXJzaW9uIGlmIHdlIGtub3cgdGltZQogICAg
ICAqIHdpbGwgYmUgb3V0c2lkZSAoTUlOLE1BWCkuICBQcm9iYWJseSByZXF1aXJlcyBwcmUtY2Fs
Y3VsYXRpbmcKLSAgICAgKiBjcmVkaXQgdmFsdWVzIG9mIE1JTixNQVggcGVyIHZjcHUsIHNpbmNl
IGVhY2ggdmNwdSBidXJucyBjcmVkaXQKKyAgICAgKiBjcmVkaXQgdmFsdWVzIG9mIE1JTixNQVgg
cGVyIHVuaXQsIHNpbmNlIGVhY2ggdW5pdCBidXJucyBjcmVkaXQKICAgICAgKiBhdCBhIGRpZmZl
cmVudCByYXRlLgogICAgICAqLwogICAgIGlmICggcnRfY3JlZGl0ID4gMCApCkBAIC0zMjg1LDM2
ICszMjc0LDM1IEBAIHJ1bnFfY2FuZGlkYXRlKHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEg
KnJxZCwKIAogICAgICpza2lwcGVkID0gMDsKIAotICAgIGlmICggdW5saWtlbHkoaXNfaWRsZV92
Y3B1KHNjdXJyLT52Y3B1KSkgKQorICAgIGlmICggdW5saWtlbHkoaXNfaWRsZV91bml0KHNjdXJy
LT51bml0KSkgKQogICAgIHsKICAgICAgICAgc25leHQgPSBzY3VycjsKICAgICAgICAgZ290byBj
aGVja19ydW5xOwogICAgIH0KIAotICAgIHlpZWxkID0gX190ZXN0X2FuZF9jbGVhcl9iaXQoX19D
U0ZMQUdfdmNwdV95aWVsZCwgJnNjdXJyLT5mbGFncyk7CisgICAgeWllbGQgPSBfX3Rlc3RfYW5k
X2NsZWFyX2JpdChfX0NTRkxBR191bml0X3lpZWxkLCAmc2N1cnItPmZsYWdzKTsKIAogICAgIC8q
Ci0gICAgICogUmV0dXJuIHRoZSBjdXJyZW50IHZjcHUgaWYgaXQgaGFzIGV4ZWN1dGVkIGZvciBs
ZXNzIHRoYW4gcmF0ZWxpbWl0LgotICAgICAqIEFkanVzdHN0bWVudCBmb3IgdGhlIHNlbGVjdGVk
IHZjcHUncyBjcmVkaXQgYW5kIGRlY2lzaW9uCisgICAgICogUmV0dXJuIHRoZSBjdXJyZW50IHVu
aXQgaWYgaXQgaGFzIGV4ZWN1dGVkIGZvciBsZXNzIHRoYW4gcmF0ZWxpbWl0LgorICAgICAqIEFk
anVzdHN0bWVudCBmb3IgdGhlIHNlbGVjdGVkIHVuaXQncyBjcmVkaXQgYW5kIGRlY2lzaW9uCiAg
ICAgICogZm9yIGhvdyBsb25nIGl0IHdpbGwgcnVuIHdpbGwgYmUgdGFrZW4gaW4gY3NjaGVkMl9y
dW50aW1lLgogICAgICAqCiAgICAgICogTm90ZSB0aGF0LCBpZiBzY3VyciBpcyB5aWVsZGluZywg
d2UgZG9uJ3QgbGV0IHJhdGUgbGltaXRpbmcga2ljayBpbi4KICAgICAgKiBJbiBmYWN0LCBpdCBt
YXkgYmUgdGhlIGNhc2UgdGhhdCBzY3VyciBpcyBhYm91dCB0byBzcGluLCBhbmQgdGhlcmUncwog
ICAgICAqIG5vIHBvaW50IGZvcmNpbmcgaXQgdG8gZG8gc28gdW50aWwgcmF0ZSBsaW1pdGluZyBl
eHBpcmVzLgogICAgICAqLwotICAgIGlmICggIXlpZWxkICYmIHBydi0+cmF0ZWxpbWl0X3VzICYm
IHZjcHVfcnVubmFibGUoc2N1cnItPnZjcHUpICYmCi0gICAgICAgICAobm93IC0gc2N1cnItPnZj
cHUtPnNjaGVkX3VuaXQtPnN0YXRlX2VudHJ5X3RpbWUpIDwKLSAgICAgICAgICBNSUNST1NFQ1Mo
cHJ2LT5yYXRlbGltaXRfdXMpICkKKyAgICBpZiAoICF5aWVsZCAmJiBwcnYtPnJhdGVsaW1pdF91
cyAmJiB1bml0X3J1bm5hYmxlKHNjdXJyLT51bml0KSAmJgorICAgICAgICAgKG5vdyAtIHNjdXJy
LT51bml0LT5zdGF0ZV9lbnRyeV90aW1lKSA8IE1JQ1JPU0VDUyhwcnYtPnJhdGVsaW1pdF91cykg
KQogICAgIHsKICAgICAgICAgaWYgKCB1bmxpa2VseSh0Yl9pbml0X2RvbmUpICkKICAgICAgICAg
ewogICAgICAgICAgICAgc3RydWN0IHsKLSAgICAgICAgICAgICAgICB1bnNpZ25lZCB2Y3B1OjE2
LCBkb206MTY7CisgICAgICAgICAgICAgICAgdW5zaWduZWQgdW5pdDoxNiwgZG9tOjE2OwogICAg
ICAgICAgICAgICAgIHVuc2lnbmVkIHJ1bnRpbWU7CiAgICAgICAgICAgICB9IGQ7Ci0gICAgICAg
ICAgICBkLmRvbSA9IHNjdXJyLT52Y3B1LT5kb21haW4tPmRvbWFpbl9pZDsKLSAgICAgICAgICAg
IGQudmNwdSA9IHNjdXJyLT52Y3B1LT52Y3B1X2lkOwotICAgICAgICAgICAgZC5ydW50aW1lID0g
bm93IC0gc2N1cnItPnZjcHUtPnNjaGVkX3VuaXQtPnN0YXRlX2VudHJ5X3RpbWU7CisgICAgICAg
ICAgICBkLmRvbSA9IHNjdXJyLT51bml0LT5kb21haW4tPmRvbWFpbl9pZDsKKyAgICAgICAgICAg
IGQudW5pdCA9IHNjdXJyLT51bml0LT51bml0X2lkOworICAgICAgICAgICAgZC5ydW50aW1lID0g
bm93IC0gc2N1cnItPnVuaXQtPnN0YXRlX2VudHJ5X3RpbWU7CiAgICAgICAgICAgICBfX3RyYWNl
X3ZhcihUUkNfQ1NDSEVEMl9SQVRFTElNSVQsIDEsCiAgICAgICAgICAgICAgICAgICAgICAgICBz
aXplb2YoZCksCiAgICAgICAgICAgICAgICAgICAgICAgICAodW5zaWduZWQgY2hhciAqKSZkKTsK
QEAgLTMzMjMsMTMgKzMzMTEsMTMgQEAgcnVucV9jYW5kaWRhdGUoc3RydWN0IGNzY2hlZDJfcnVu
cXVldWVfZGF0YSAqcnFkLAogICAgIH0KIAogICAgIC8qIElmIHNjdXJyIGhhcyBhIHNvZnQtYWZm
aW5pdHksIGxldCdzIGNoZWNrIHdoZXRoZXIgY3B1IGlzIHBhcnQgb2YgaXQgKi8KLSAgICBpZiAo
IGhhc19zb2Z0X2FmZmluaXR5KHNjdXJyLT52Y3B1LT5zY2hlZF91bml0KSApCisgICAgaWYgKCBo
YXNfc29mdF9hZmZpbml0eShzY3Vyci0+dW5pdCkgKQogICAgIHsKLSAgICAgICAgYWZmaW5pdHlf
YmFsYW5jZV9jcHVtYXNrKHNjdXJyLT52Y3B1LT5zY2hlZF91bml0LCBCQUxBTkNFX1NPRlRfQUZG
SU5JVFksCisgICAgICAgIGFmZmluaXR5X2JhbGFuY2VfY3B1bWFzayhzY3Vyci0+dW5pdCwgQkFM
QU5DRV9TT0ZUX0FGRklOSVRZLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3B1
bWFza19zY3JhdGNoKTsKICAgICAgICAgaWYgKCB1bmxpa2VseSghY3B1bWFza190ZXN0X2NwdShj
cHUsIGNwdW1hc2tfc2NyYXRjaCkpICkKICAgICAgICAgewotICAgICAgICAgICAgY3B1bWFza190
ICpvbmxpbmUgPSBjcHVwb29sX2RvbWFpbl9jcHVtYXNrKHNjdXJyLT52Y3B1LT5kb21haW4pOwor
ICAgICAgICAgICAgY3B1bWFza190ICpvbmxpbmUgPSBjcHVwb29sX2RvbWFpbl9jcHVtYXNrKHNj
dXJyLT51bml0LT5kb21haW4pOwogCiAgICAgICAgICAgICAvKiBPaywgaXMgYW55IG9mIHRoZSBw
Y3B1cyBpbiBzY3VyciBzb2Z0LWFmZmluaXR5IGlkbGU/ICovCiAgICAgICAgICAgICBjcHVtYXNr
X2FuZChjcHVtYXNrX3NjcmF0Y2gsIGNwdW1hc2tfc2NyYXRjaCwgJnJxZC0+aWRsZSk7CkBAIC0z
MzU3LDEwICszMzQ1LDEwIEBAIHJ1bnFfY2FuZGlkYXRlKHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVl
X2RhdGEgKnJxZCwKICAgICAgKgogICAgICAqIE9mIGNvdXJzZSwgd2UgYWxzbyBkZWZhdWx0IHRv
IGlkbGUgYWxzbyBpZiBzY3VyciBpcyBub3QgcnVubmFibGUuCiAgICAgICovCi0gICAgaWYgKCB2
Y3B1X3J1bm5hYmxlKHNjdXJyLT52Y3B1KSAmJiAhc29mdF9hZmZfcHJlZW1wdCApCisgICAgaWYg
KCB1bml0X3J1bm5hYmxlKHNjdXJyLT51bml0KSAmJiAhc29mdF9hZmZfcHJlZW1wdCApCiAgICAg
ICAgIHNuZXh0ID0gc2N1cnI7CiAgICAgZWxzZQotICAgICAgICBzbmV4dCA9IGNzY2hlZDJfdW5p
dChpZGxlX3ZjcHVbY3B1XS0+c2NoZWRfdW5pdCk7CisgICAgICAgIHNuZXh0ID0gY3NjaGVkMl91
bml0KHNjaGVkX2lkbGVfdW5pdChjcHUpKTsKIAogIGNoZWNrX3J1bnE6CiAgICAgbGlzdF9mb3Jf
ZWFjaF9zYWZlKCBpdGVyLCB0ZW1wLCAmcnFkLT5ydW5xICkKQEAgLTMzNzAsMjQgKzMzNTgsMjQg
QEAgcnVucV9jYW5kaWRhdGUoc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFkLAogICAg
ICAgICBpZiAoIHVubGlrZWx5KHRiX2luaXRfZG9uZSkgKQogICAgICAgICB7CiAgICAgICAgICAg
ICBzdHJ1Y3QgewotICAgICAgICAgICAgICAgIHVuc2lnbmVkIHZjcHU6MTYsIGRvbToxNjsKKyAg
ICAgICAgICAgICAgICB1bnNpZ25lZCB1bml0OjE2LCBkb206MTY7CiAgICAgICAgICAgICB9IGQ7
Ci0gICAgICAgICAgICBkLmRvbSA9IHN2Yy0+dmNwdS0+ZG9tYWluLT5kb21haW5faWQ7Ci0gICAg
ICAgICAgICBkLnZjcHUgPSBzdmMtPnZjcHUtPnZjcHVfaWQ7CisgICAgICAgICAgICBkLmRvbSA9
IHN2Yy0+dW5pdC0+ZG9tYWluLT5kb21haW5faWQ7CisgICAgICAgICAgICBkLnVuaXQgPSBzdmMt
PnVuaXQtPnVuaXRfaWQ7CiAgICAgICAgICAgICBfX3RyYWNlX3ZhcihUUkNfQ1NDSEVEMl9SVU5R
X0NBTkRfQ0hFQ0ssIDEsCiAgICAgICAgICAgICAgICAgICAgICAgICBzaXplb2YoZCksCiAgICAg
ICAgICAgICAgICAgICAgICAgICAodW5zaWduZWQgY2hhciAqKSZkKTsKICAgICAgICAgfQogCi0g
ICAgICAgIC8qIE9ubHkgY29uc2lkZXIgdmNwdXMgdGhhdCBhcmUgYWxsb3dlZCB0byBydW4gb24g
dGhpcyBwcm9jZXNzb3IuICovCi0gICAgICAgIGlmICggIWNwdW1hc2tfdGVzdF9jcHUoY3B1LCBz
dmMtPnZjcHUtPnNjaGVkX3VuaXQtPmNwdV9oYXJkX2FmZmluaXR5KSApCisgICAgICAgIC8qIE9u
bHkgY29uc2lkZXIgdW5pdHMgdGhhdCBhcmUgYWxsb3dlZCB0byBydW4gb24gdGhpcyBwcm9jZXNz
b3IuICovCisgICAgICAgIGlmICggIWNwdW1hc2tfdGVzdF9jcHUoY3B1LCBzdmMtPnVuaXQtPmNw
dV9oYXJkX2FmZmluaXR5KSApCiAgICAgICAgIHsKICAgICAgICAgICAgICgqc2tpcHBlZCkrKzsK
ICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICB9CiAKICAgICAgICAgLyoKLSAgICAgICAg
ICogSWYgYSB2Y3B1IGlzIG1lYW50IHRvIGJlIHBpY2tlZCB1cCBieSBhbm90aGVyIHByb2Nlc3Nv
ciwgYW5kIHN1Y2gKKyAgICAgICAgICogSWYgYW4gdW5pdCBpcyBtZWFudCB0byBiZSBwaWNrZWQg
dXAgYnkgYW5vdGhlciBwcm9jZXNzb3IsIGFuZCBzdWNoCiAgICAgICAgICAqIHByb2Nlc3NvciBo
YXMgbm90IHNjaGVkdWxlZCB5ZXQsIGxlYXZlIGl0IGluIHRoZSBydW5xdWV1ZSBmb3IgaGltLgog
ICAgICAgICAgKi8KICAgICAgICAgaWYgKCBzdmMtPnRpY2tsZWRfY3B1ICE9IC0xICYmIHN2Yy0+
dGlja2xlZF9jcHUgIT0gY3B1ICYmCkBAIC0zNDAyLDcgKzMzOTAsNyBAQCBydW5xX2NhbmRpZGF0
ZShzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQsCiAgICAgICAgICAqIElmIHRoaXMg
aXMgb24gYSBkaWZmZXJlbnQgcHJvY2Vzc29yLCBkb24ndCBwdWxsIGl0IHVubGVzcwogICAgICAg
ICAgKiBpdHMgY3JlZGl0IGlzIGF0IGxlYXN0IENTQ0hFRDJfTUlHUkFURV9SRVNJU1QgaGlnaGVy
LgogICAgICAgICAgKi8KLSAgICAgICAgaWYgKCBzdmMtPnZjcHUtPnByb2Nlc3NvciAhPSBjcHUK
KyAgICAgICAgaWYgKCBzY2hlZF91bml0X21hc3RlcihzdmMtPnVuaXQpICE9IGNwdQogICAgICAg
ICAgICAgICYmIHNuZXh0LT5jcmVkaXQgKyBDU0NIRUQyX01JR1JBVEVfUkVTSVNUID4gc3ZjLT5j
cmVkaXQgKQogICAgICAgICB7CiAgICAgICAgICAgICAoKnNraXBwZWQpKys7CkBAIC0zNDE3LDcg
KzM0MDUsNyBAQCBydW5xX2NhbmRpZGF0ZShzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpy
cWQsCiAgICAgICAgICAqIHNvbWUgYnVkZ2V0LCB0aGVuIGNob29zZSBpdC4KICAgICAgICAgICov
CiAgICAgICAgIGlmICggKHlpZWxkIHx8IHN2Yy0+Y3JlZGl0ID4gc25leHQtPmNyZWRpdCkgJiYK
LSAgICAgICAgICAgICAoIWhhc19jYXAoc3ZjKSB8fCB2Y3B1X2dyYWJfYnVkZ2V0KHN2YykpICkK
KyAgICAgICAgICAgICAoIWhhc19jYXAoc3ZjKSB8fCB1bml0X2dyYWJfYnVkZ2V0KHN2YykpICkK
ICAgICAgICAgICAgIHNuZXh0ID0gc3ZjOwogCiAgICAgICAgIC8qIEluIGFueSBjYXNlLCBpZiB3
ZSBnb3QgdGhpcyBmYXIsIGJyZWFrLiAqLwpAQCAtMzQyNywxMiArMzQxNSwxMiBAQCBydW5xX2Nh
bmRpZGF0ZShzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQsCiAgICAgaWYgKCB1bmxp
a2VseSh0Yl9pbml0X2RvbmUpICkKICAgICB7CiAgICAgICAgIHN0cnVjdCB7Ci0gICAgICAgICAg
ICB1bnNpZ25lZCB2Y3B1OjE2LCBkb206MTY7CisgICAgICAgICAgICB1bnNpZ25lZCB1bml0OjE2
LCBkb206MTY7CiAgICAgICAgICAgICB1bnNpZ25lZCB0aWNrbGVkX2NwdSwgc2tpcHBlZDsKICAg
ICAgICAgICAgIGludCBjcmVkaXQ7CiAgICAgICAgIH0gZDsKLSAgICAgICAgZC5kb20gPSBzbmV4
dC0+dmNwdS0+ZG9tYWluLT5kb21haW5faWQ7Ci0gICAgICAgIGQudmNwdSA9IHNuZXh0LT52Y3B1
LT52Y3B1X2lkOworICAgICAgICBkLmRvbSA9IHNuZXh0LT51bml0LT5kb21haW4tPmRvbWFpbl9p
ZDsKKyAgICAgICAgZC51bml0ID0gc25leHQtPnVuaXQtPnVuaXRfaWQ7CiAgICAgICAgIGQuY3Jl
ZGl0ID0gc25leHQtPmNyZWRpdDsKICAgICAgICAgZC50aWNrbGVkX2NwdSA9IHNuZXh0LT50aWNr
bGVkX2NwdTsKICAgICAgICAgZC5za2lwcGVkID0gKnNraXBwZWQ7CkBAIC0zNDY0LDE0ICszNDUy
LDE1IEBAIGNzY2hlZDJfc2NoZWR1bGUoCiB7CiAgICAgY29uc3QgaW50IGNwdSA9IHNtcF9wcm9j
ZXNzb3JfaWQoKTsKICAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQ7Ci0gICAg
c3RydWN0IGNzY2hlZDJfdW5pdCAqIGNvbnN0IHNjdXJyID0gY3NjaGVkMl91bml0KGN1cnJlbnQt
PnNjaGVkX3VuaXQpOworICAgIHN0cnVjdCBzY2hlZF91bml0ICpjdXJydW5pdCA9IGN1cnJlbnQt
PnNjaGVkX3VuaXQ7CisgICAgc3RydWN0IGNzY2hlZDJfdW5pdCAqIGNvbnN0IHNjdXJyID0gY3Nj
aGVkMl91bml0KGN1cnJ1bml0KTsKICAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICpzbmV4dCA9IE5V
TEw7Ci0gICAgdW5zaWduZWQgaW50IHNraXBwZWRfdmNwdXMgPSAwOworICAgIHVuc2lnbmVkIGlu
dCBza2lwcGVkX3VuaXRzID0gMDsKICAgICBzdHJ1Y3QgdGFza19zbGljZSByZXQ7CiAgICAgYm9v
bCB0aWNrbGVkOwogCiAgICAgU0NIRURfU1RBVF9DUkFOSyhzY2hlZHVsZSk7Ci0gICAgQ1NDSEVE
Ml9WQ1BVX0NIRUNLKGN1cnJlbnQpOworICAgIENTQ0hFRDJfVU5JVF9DSEVDSyhjdXJydW5pdCk7
CiAKICAgICBCVUdfT04oIWNwdW1hc2tfdGVzdF9jcHUoY3B1LCAmY3NjaGVkMl9wcml2KG9wcykt
PmluaXRpYWxpemVkKSk7CiAKQEAgLTM0ODAsNyArMzQ2OSw3IEBAIGNzY2hlZDJfc2NoZWR1bGUo
CiAKICAgICBBU1NFUlQoc3Bpbl9pc19sb2NrZWQoZ2V0X3NjaGVkX3JlcyhjcHUpLT5zY2hlZHVs
ZV9sb2NrKSk7CiAKLSAgICBCVUdfT04oIWlzX2lkbGVfdmNwdShzY3Vyci0+dmNwdSkgJiYgc2N1
cnItPnJxZCAhPSBycWQpOworICAgIEJVR19PTighaXNfaWRsZV91bml0KGN1cnJ1bml0KSAmJiBz
Y3Vyci0+cnFkICE9IHJxZCk7CiAKICAgICAvKiBDbGVhciAidGlja2xlZCIgYml0IG5vdyB0aGF0
IHdlJ3ZlIGJlZW4gc2NoZWR1bGVkICovCiAgICAgdGlja2xlZCA9IGNwdW1hc2tfdGVzdF9jcHUo
Y3B1LCAmcnFkLT50aWNrbGVkKTsKQEAgLTM1MDAsNyArMzQ4OSw3IEBAIGNzY2hlZDJfc2NoZWR1
bGUoCiAgICAgICAgIGQuY3B1ID0gY3B1OwogICAgICAgICBkLnJxX2lkID0gYzJyKGNwdSk7CiAg
ICAgICAgIGQudGFza2xldCA9IHRhc2tsZXRfd29ya19zY2hlZHVsZWQ7Ci0gICAgICAgIGQuaWRs
ZSA9IGlzX2lkbGVfdmNwdShjdXJyZW50KTsKKyAgICAgICAgZC5pZGxlID0gaXNfaWRsZV91bml0
KGN1cnJ1bml0KTsKICAgICAgICAgZC5zbXRfaWRsZSA9IGNwdW1hc2tfdGVzdF9jcHUoY3B1LCAm
cnFkLT5zbXRfaWRsZSk7CiAgICAgICAgIGQudGlja2xlZCA9IHRpY2tsZWQ7CiAgICAgICAgIF9f
dHJhY2VfdmFyKFRSQ19DU0NIRUQyX1NDSEVEVUxFLCAxLApAQCAtMzUxNCw1NSArMzUwMyw1NSBA
QCBjc2NoZWQyX3NjaGVkdWxlKAogICAgIC8qCiAgICAgICogIEJlbG93IDAsIG1lYW5zIHRoYXQg
d2UgYXJlIGNhcHBlZCBhbmQgd2UgaGF2ZSBvdmVycnVuIG91ciAgYnVkZ2V0LgogICAgICAqICBM
ZXQncyB0cnkgdG8gZ2V0IHNvbWUgbW9yZSBidXQsIGlmIHdlIGZhaWwgKGUuZy4sIGJlY2F1c2Ug
b2YgdGhlCi0gICAgICogIG90aGVyIHJ1bm5pbmcgdmNwdXMpLCB3ZSB3aWxsIGJlIHBhcmtlZC4K
KyAgICAgKiAgb3RoZXIgcnVubmluZyB1bml0cyksIHdlIHdpbGwgYmUgcGFya2VkLgogICAgICAq
LwogICAgIGlmICggdW5saWtlbHkoc2N1cnItPmJ1ZGdldCA8PSAwKSApCi0gICAgICAgIHZjcHVf
Z3JhYl9idWRnZXQoc2N1cnIpOworICAgICAgICB1bml0X2dyYWJfYnVkZ2V0KHNjdXJyKTsKIAog
ICAgIC8qCi0gICAgICogU2VsZWN0IG5leHQgcnVubmFibGUgbG9jYWwgVkNQVSAoaWUgdG9wIG9m
IGxvY2FsIHJ1bnEpLgorICAgICAqIFNlbGVjdCBuZXh0IHJ1bm5hYmxlIGxvY2FsIFVOSVQgKGll
IHRvcCBvZiBsb2NhbCBydW5xKS4KICAgICAgKgotICAgICAqIElmIHRoZSBjdXJyZW50IHZjcHUg
aXMgcnVubmFibGUsIGFuZCBoYXMgaGlnaGVyIGNyZWRpdCB0aGFuCisgICAgICogSWYgdGhlIGN1
cnJlbnQgdW5pdCBpcyBydW5uYWJsZSwgYW5kIGhhcyBoaWdoZXIgY3JlZGl0IHRoYW4KICAgICAg
KiB0aGUgbmV4dCBndXkgb24gdGhlIHF1ZXVlIChvciB0aGVyZSBpcyBub29uZSBlbHNlKSwgd2Ug
d2FudCB0bwogICAgICAqIHJ1biBoaW0gYWdhaW4uCiAgICAgICoKLSAgICAgKiBJZiB0aGVyZSdz
IHRhc2tsZXQgd29yayB0byBkbywgd2Ugd2FudCB0byBjaG9zZSB0aGUgaWRsZSB2Y3B1CisgICAg
ICogSWYgdGhlcmUncyB0YXNrbGV0IHdvcmsgdG8gZG8sIHdlIHdhbnQgdG8gY2hvc2UgdGhlIGlk
bGUgdW5pdAogICAgICAqIGZvciB0aGlzIHByb2Nlc3NvciwgYW5kIG1hcmsgdGhlIGN1cnJlbnQg
Zm9yIGRlbGF5ZWQgcnVucXVldWUKICAgICAgKiBhZGQuCiAgICAgICoKLSAgICAgKiBJZiB0aGUg
Y3VycmVudCB2Y3B1IGlzIHJ1bm5hYmxlLCBhbmQgdGhlcmUncyBhbm90aGVyIHJ1bm5hYmxlCisg
ICAgICogSWYgdGhlIGN1cnJlbnQgdW5pdCBpcyBydW5uYWJsZSwgYW5kIHRoZXJlJ3MgYW5vdGhl
ciBydW5uYWJsZQogICAgICAqIGNhbmRpZGF0ZSwgd2Ugd2FudCB0byBtYXJrIGN1cnJlbnQgZm9y
IGRlbGF5ZWQgcnVucXVldWUgYWRkLAogICAgICAqIGFuZCByZW1vdmUgdGhlIG5leHQgZ3V5IGZy
b20gdGhlIHF1ZXVlLgogICAgICAqCi0gICAgICogSWYgdGhlIGN1cnJlbnQgdmNwdSBpcyBub3Qg
cnVubmFibGUsIHdlIHdhbnQgdG8gY2hvc2UgdGhlIGlkbGUKLSAgICAgKiB2Y3B1IGZvciB0aGlz
IHByb2Nlc3Nvci4KKyAgICAgKiBJZiB0aGUgY3VycmVudCB1bml0IGlzIG5vdCBydW5uYWJsZSwg
d2Ugd2FudCB0byBjaG9zZSB0aGUgaWRsZQorICAgICAqIHVuaXQgZm9yIHRoaXMgcHJvY2Vzc29y
LgogICAgICAqLwogICAgIGlmICggdGFza2xldF93b3JrX3NjaGVkdWxlZCApCiAgICAgewotICAg
ICAgICBfX2NsZWFyX2JpdChfX0NTRkxBR192Y3B1X3lpZWxkLCAmc2N1cnItPmZsYWdzKTsKKyAg
ICAgICAgX19jbGVhcl9iaXQoX19DU0ZMQUdfdW5pdF95aWVsZCwgJnNjdXJyLT5mbGFncyk7CiAg
ICAgICAgIHRyYWNlX3ZhcihUUkNfQ1NDSEVEMl9TQ0hFRF9UQVNLTEVULCAxLCAwLCBOVUxMKTsK
LSAgICAgICAgc25leHQgPSBjc2NoZWQyX3VuaXQoaWRsZV92Y3B1W2NwdV0tPnNjaGVkX3VuaXQp
OworICAgICAgICBzbmV4dCA9IGNzY2hlZDJfdW5pdChzY2hlZF9pZGxlX3VuaXQoY3B1KSk7CiAg
ICAgfQogICAgIGVsc2UKLSAgICAgICAgc25leHQgPSBydW5xX2NhbmRpZGF0ZShycWQsIHNjdXJy
LCBjcHUsIG5vdywgJnNraXBwZWRfdmNwdXMpOworICAgICAgICBzbmV4dCA9IHJ1bnFfY2FuZGlk
YXRlKHJxZCwgc2N1cnIsIGNwdSwgbm93LCAmc2tpcHBlZF91bml0cyk7CiAKLSAgICAvKiBJZiBz
d2l0Y2hpbmcgZnJvbSBhIG5vbi1pZGxlIHJ1bm5hYmxlIHZjcHUsIHB1dCBpdAorICAgIC8qIElm
IHN3aXRjaGluZyBmcm9tIGEgbm9uLWlkbGUgcnVubmFibGUgdW5pdCwgcHV0IGl0CiAgICAgICog
YmFjayBvbiB0aGUgcnVucXVldWUuICovCiAgICAgaWYgKCBzbmV4dCAhPSBzY3VycgotICAgICAg
ICAgJiYgIWlzX2lkbGVfdmNwdShzY3Vyci0+dmNwdSkKLSAgICAgICAgICYmIHZjcHVfcnVubmFi
bGUoY3VycmVudCkgKQorICAgICAgICAgJiYgIWlzX2lkbGVfdW5pdChjdXJydW5pdCkKKyAgICAg
ICAgICYmIHVuaXRfcnVubmFibGUoY3VycnVuaXQpICkKICAgICAgICAgX19zZXRfYml0KF9fQ1NG
TEFHX2RlbGF5ZWRfcnVucV9hZGQsICZzY3Vyci0+ZmxhZ3MpOwogCiAgICAgcmV0Lm1pZ3JhdGVk
ID0gMDsKIAogICAgIC8qIEFjY291bnRpbmcgZm9yIG5vbi1pZGxlIHRhc2tzICovCi0gICAgaWYg
KCAhaXNfaWRsZV92Y3B1KHNuZXh0LT52Y3B1KSApCisgICAgaWYgKCAhaXNfaWRsZV91bml0KHNu
ZXh0LT51bml0KSApCiAgICAgewogICAgICAgICAvKiBJZiBzd2l0Y2hpbmcsIHJlbW92ZSB0aGlz
IGZyb20gdGhlIHJ1bnF1ZXVlIGFuZCBtYXJrIGl0IHNjaGVkdWxlZCAqLwogICAgICAgICBpZiAo
IHNuZXh0ICE9IHNjdXJyICkKICAgICAgICAgewogICAgICAgICAgICAgQVNTRVJUKHNuZXh0LT5y
cWQgPT0gcnFkKTsKLSAgICAgICAgICAgIEFTU0VSVCghc25leHQtPnZjcHUtPnNjaGVkX3VuaXQt
PmlzX3J1bm5pbmcpOworICAgICAgICAgICAgQVNTRVJUKCFzbmV4dC0+dW5pdC0+aXNfcnVubmlu
Zyk7CiAKICAgICAgICAgICAgIHJ1bnFfcmVtb3ZlKHNuZXh0KTsKICAgICAgICAgICAgIF9fc2V0
X2JpdChfX0NTRkxBR19zY2hlZHVsZWQsICZzbmV4dC0+ZmxhZ3MpOwpAQCAtMzU3NywxOSArMzU2
NiwxOSBAQCBjc2NoZWQyX3NjaGVkdWxlKAogCiAgICAgICAgIC8qCiAgICAgICAgICAqIFRoZSBy
ZXNldCBjb25kaXRpb24gaXMgImhhcyBhIHNjaGVkdWxlciBlcG9jaCBjb21lIHRvIGFuIGVuZD8i
LgotICAgICAgICAgKiBUaGUgd2F5IHRoaXMgaXMgZW5mb3JjZWQgaXMgY2hlY2tpbmcgd2hldGhl
ciB0aGUgdmNwdSBhdCB0aGUgdG9wCisgICAgICAgICAqIFRoZSB3YXkgdGhpcyBpcyBlbmZvcmNl
ZCBpcyBjaGVja2luZyB3aGV0aGVyIHRoZSB1bml0IGF0IHRoZSB0b3AKICAgICAgICAgICogb2Yg
dGhlIHJ1bnF1ZXVlIGhhcyBuZWdhdGl2ZSBjcmVkaXRzLiBUaGlzIG1lYW5zIHRoZSBlcG9jaHMg
aGF2ZQogICAgICAgICAgKiB2YXJpYWJsZSBsZW5ndGgsIGFzIGluIG9uZSBlcG9jaCBleHBvcmVz
IHdoZW46Ci0gICAgICAgICAqICAxKSB0aGUgdmNwdSBhdCB0aGUgdG9wIG9mIHRoZSBydW5xdWV1
ZSBoYXMgZXhlY3V0ZWQgZm9yCisgICAgICAgICAqICAxKSB0aGUgdW5pdCBhdCB0aGUgdG9wIG9m
IHRoZSBydW5xdWV1ZSBoYXMgZXhlY3V0ZWQgZm9yCiAgICAgICAgICAqICAgICBhcm91bmQgMTAg
bXMgKHdpdGggZGVmYXVsdCBwYXJhbWV0ZXJzKTsKLSAgICAgICAgICogIDIpIG5vIG90aGVyIHZj
cHUgd2l0aCBoaWdoZXIgY3JlZGl0cyB3YW50cyB0byBydW4uCisgICAgICAgICAqICAyKSBubyBv
dGhlciB1bml0IHdpdGggaGlnaGVyIGNyZWRpdHMgd2FudHMgdG8gcnVuLgogICAgICAgICAgKgog
ICAgICAgICAgKiBIZXJlLCB3aGVyZSB3ZSB3YW50IHRvIGNoZWNrIGZvciByZXNldCwgd2UgbmVl
ZCB0byBtYWtlIHN1cmUgdGhlCi0gICAgICAgICAqIHByb3BlciB2Y3B1IGlzIGJlaW5nIHVzZWQu
IEluIGZhY3QsIHJ1bnF1ZXVlX2NhbmRpZGF0ZSgpIG1heSBoYXZlCi0gICAgICAgICAqIG5vdCBy
ZXR1cm5lZCB0aGUgZmlyc3QgdmNwdSBpbiB0aGUgcnVucXVldWUsIGZvciB2YXJpb3VzIHJlYXNv
bnMKKyAgICAgICAgICogcHJvcGVyIHVuaXQgaXMgYmVpbmcgdXNlZC4gSW4gZmFjdCwgcnVucXVl
dWVfY2FuZGlkYXRlKCkgbWF5IGhhdmUKKyAgICAgICAgICogbm90IHJldHVybmVkIHRoZSBmaXJz
dCB1bml0IGluIHRoZSBydW5xdWV1ZSwgZm9yIHZhcmlvdXMgcmVhc29ucwogICAgICAgICAgKiAo
ZS5nLiwgYWZmaW5pdHkpLiBPbmx5IHRyaWdnZXIgYSByZXNldCB3aGVuIGl0IGRvZXMuCiAgICAg
ICAgICAqLwotICAgICAgICBpZiAoIHNraXBwZWRfdmNwdXMgPT0gMCAmJiBzbmV4dC0+Y3JlZGl0
IDw9IENTQ0hFRDJfQ1JFRElUX1JFU0VUICkKKyAgICAgICAgaWYgKCBza2lwcGVkX3VuaXRzID09
IDAgJiYgc25leHQtPmNyZWRpdCA8PSBDU0NIRUQyX0NSRURJVF9SRVNFVCApCiAgICAgICAgIHsK
ICAgICAgICAgICAgIHJlc2V0X2NyZWRpdChvcHMsIGNwdSwgbm93LCBzbmV4dCk7CiAgICAgICAg
ICAgICBiYWxhbmNlX2xvYWQob3BzLCBjcHUsIG5vdyk7CkBAIC0zNTk5LDExICszNTg4LDEwIEBA
IGNzY2hlZDJfc2NoZWR1bGUoCiAgICAgICAgIHNuZXh0LT50aWNrbGVkX2NwdSA9IC0xOwogCiAg
ICAgICAgIC8qIFNhZmUgYmVjYXVzZSBsb2NrIGZvciBvbGQgcHJvY2Vzc29yIGlzIGhlbGQgKi8K
LSAgICAgICAgaWYgKCBzbmV4dC0+dmNwdS0+cHJvY2Vzc29yICE9IGNwdSApCisgICAgICAgIGlm
ICggc2NoZWRfdW5pdF9tYXN0ZXIoc25leHQtPnVuaXQpICE9IGNwdSApCiAgICAgICAgIHsKICAg
ICAgICAgICAgIHNuZXh0LT5jcmVkaXQgKz0gQ1NDSEVEMl9NSUdSQVRFX0NPTVBFTlNBVElPTjsK
LSAgICAgICAgICAgIHNuZXh0LT52Y3B1LT5wcm9jZXNzb3IgPSBjcHU7Ci0gICAgICAgICAgICBz
bmV4dC0+dmNwdS0+c2NoZWRfdW5pdC0+cmVzID0gZ2V0X3NjaGVkX3JlcyhjcHUpOworICAgICAg
ICAgICAgc2NoZWRfc2V0X3JlcyhzbmV4dC0+dW5pdCwgZ2V0X3NjaGVkX3JlcyhjcHUpKTsKICAg
ICAgICAgICAgIFNDSEVEX1NUQVRfQ1JBTksobWlncmF0ZWQpOwogICAgICAgICAgICAgcmV0Lm1p
Z3JhdGVkID0gMTsKICAgICAgICAgfQpAQCAtMzYzNywyMCArMzYyNSwyMCBAQCBjc2NoZWQyX3Nj
aGVkdWxlKAogICAgICAqIFJldHVybiB0YXNrIHRvIHJ1biBuZXh0Li4uCiAgICAgICovCiAgICAg
cmV0LnRpbWUgPSBjc2NoZWQyX3J1bnRpbWUob3BzLCBjcHUsIHNuZXh0LCBub3cpOwotICAgIHJl
dC50YXNrID0gc25leHQtPnZjcHUtPnNjaGVkX3VuaXQ7CisgICAgcmV0LnRhc2sgPSBzbmV4dC0+
dW5pdDsKIAotICAgIENTQ0hFRDJfVkNQVV9DSEVDSyhyZXQudGFzay0+dmNwdV9saXN0KTsKKyAg
ICBDU0NIRUQyX1VOSVRfQ0hFQ0socmV0LnRhc2spOwogICAgIHJldHVybiByZXQ7CiB9CiAKIHN0
YXRpYyB2b2lkCi1jc2NoZWQyX2R1bXBfdmNwdShzdHJ1Y3QgY3NjaGVkMl9wcml2YXRlICpwcnYs
IHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YykKK2NzY2hlZDJfZHVtcF91bml0KHN0cnVjdCBjc2No
ZWQyX3ByaXZhdGUgKnBydiwgc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQogewogICAgIHByaW50
aygiWyVpLiVpXSBmbGFncz0leCBjcHU9JWkiLAotICAgICAgICAgICAgc3ZjLT52Y3B1LT5kb21h
aW4tPmRvbWFpbl9pZCwKLSAgICAgICAgICAgIHN2Yy0+dmNwdS0+dmNwdV9pZCwKKyAgICAgICAg
ICAgIHN2Yy0+dW5pdC0+ZG9tYWluLT5kb21haW5faWQsCisgICAgICAgICAgICBzdmMtPnVuaXQt
PnVuaXRfaWQsCiAgICAgICAgICAgICBzdmMtPmZsYWdzLAotICAgICAgICAgICAgc3ZjLT52Y3B1
LT5wcm9jZXNzb3IpOworICAgICAgICAgICAgc2NoZWRfdW5pdF9tYXN0ZXIoc3ZjLT51bml0KSk7
CiAKICAgICBwcmludGsoIiBjcmVkaXQ9JSIgUFJJaTMyIiBbdz0ldV0iLCBzdmMtPmNyZWRpdCwg
c3ZjLT53ZWlnaHQpOwogCkBAIC0zNjc1LDEyICszNjYzLDEyIEBAIGR1bXBfcGNwdShjb25zdCBz
dHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGludCBjcHUpCiAgICAgICAgICAgIENQVU1BU0tfUFIocGVy
X2NwdShjcHVfc2libGluZ19tYXNrLCBjcHUpKSwKICAgICAgICAgICAgQ1BVTUFTS19QUihwZXJf
Y3B1KGNwdV9jb3JlX21hc2ssIGNwdSkpKTsKIAotICAgIC8qIGN1cnJlbnQgVkNQVSAobm90aGlu
ZyB0byBzYXkgaWYgdGhhdCdzIHRoZSBpZGxlIHZjcHUpICovCisgICAgLyogY3VycmVudCBVTklU
IChub3RoaW5nIHRvIHNheSBpZiB0aGF0J3MgdGhlIGlkbGUgdW5pdCkgKi8KICAgICBzdmMgPSBj
c2NoZWQyX3VuaXQoY3Vycl9vbl9jcHUoY3B1KSk7Ci0gICAgaWYgKCBzdmMgJiYgIWlzX2lkbGVf
dmNwdShzdmMtPnZjcHUpICkKKyAgICBpZiAoIHN2YyAmJiAhaXNfaWRsZV91bml0KHN2Yy0+dW5p
dCkgKQogICAgIHsKICAgICAgICAgcHJpbnRrKCJcdHJ1bjogIik7Ci0gICAgICAgIGNzY2hlZDJf
ZHVtcF92Y3B1KHBydiwgc3ZjKTsKKyAgICAgICAgY3NjaGVkMl9kdW1wX3VuaXQocHJ2LCBzdmMp
OwogICAgIH0KIH0KIApAQCAtMzczNyw3ICszNzI1LDcgQEAgY3NjaGVkMl9kdW1wKGNvbnN0IHN0
cnVjdCBzY2hlZHVsZXIgKm9wcykKICAgICBsaXN0X2Zvcl9lYWNoKCBpdGVyX3Nkb20sICZwcnYt
PnNkb20gKQogICAgIHsKICAgICAgICAgc3RydWN0IGNzY2hlZDJfZG9tICpzZG9tOwotICAgICAg
ICBzdHJ1Y3QgdmNwdSAqdjsKKyAgICAgICAgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQ7CiAKICAg
ICAgICAgc2RvbSA9IGxpc3RfZW50cnkoaXRlcl9zZG9tLCBzdHJ1Y3QgY3NjaGVkMl9kb20sIHNk
b21fZWxlbSk7CiAKQEAgLTM3NDUsMTkgKzM3MzMsMTkgQEAgY3NjaGVkMl9kdW1wKGNvbnN0IHN0
cnVjdCBzY2hlZHVsZXIgKm9wcykKICAgICAgICAgICAgICAgIHNkb20tPmRvbS0+ZG9tYWluX2lk
LAogICAgICAgICAgICAgICAgc2RvbS0+d2VpZ2h0LAogICAgICAgICAgICAgICAgc2RvbS0+Y2Fw
LAotICAgICAgICAgICAgICAgc2RvbS0+bnJfdmNwdXMpOworICAgICAgICAgICAgICAgc2RvbS0+
bnJfdW5pdHMpOwogCi0gICAgICAgIGZvcl9lYWNoX3ZjcHUoIHNkb20tPmRvbSwgdiApCisgICAg
ICAgIGZvcl9lYWNoX3NjaGVkX3VuaXQgKCBzZG9tLT5kb20sIHVuaXQgKQogICAgICAgICB7Ci0g
ICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICogY29uc3Qgc3ZjID0gY3NjaGVkMl91bml0
KHYtPnNjaGVkX3VuaXQpOworICAgICAgICAgICAgc3RydWN0IGNzY2hlZDJfdW5pdCAqIGNvbnN0
IHN2YyA9IGNzY2hlZDJfdW5pdCh1bml0KTsKICAgICAgICAgICAgIHNwaW5sb2NrX3QgKmxvY2s7
CiAKLSAgICAgICAgICAgIGxvY2sgPSB1bml0X3NjaGVkdWxlX2xvY2soc3ZjLT52Y3B1LT5zY2hl
ZF91bml0KTsKKyAgICAgICAgICAgIGxvY2sgPSB1bml0X3NjaGVkdWxlX2xvY2sodW5pdCk7CiAK
ICAgICAgICAgICAgIHByaW50aygiXHQlM2Q6ICIsICsrbG9vcCk7Ci0gICAgICAgICAgICBjc2No
ZWQyX2R1bXBfdmNwdShwcnYsIHN2Yyk7CisgICAgICAgICAgICBjc2NoZWQyX2R1bXBfdW5pdChw
cnYsIHN2Yyk7CiAKLSAgICAgICAgICAgIHVuaXRfc2NoZWR1bGVfdW5sb2NrKGxvY2ssIHN2Yy0+
dmNwdS0+c2NoZWRfdW5pdCk7CisgICAgICAgICAgICB1bml0X3NjaGVkdWxlX3VubG9jayhsb2Nr
LCB1bml0KTsKICAgICAgICAgfQogICAgIH0KIApAQCAtMzc4Myw3ICszNzcxLDcgQEAgY3NjaGVk
Ml9kdW1wKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcykKICAgICAgICAgICAgIGlmICggc3Zj
ICkKICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICBwcmludGsoIlx0JTNkOiAiLCBsb29w
KyspOwotICAgICAgICAgICAgICAgIGNzY2hlZDJfZHVtcF92Y3B1KHBydiwgc3ZjKTsKKyAgICAg
ICAgICAgICAgICBjc2NoZWQyX2R1bXBfdW5pdChwcnYsIHN2Yyk7CiAgICAgICAgICAgICB9CiAg
ICAgICAgIH0KICAgICAgICAgc3Bpbl91bmxvY2soJnJxZC0+bG9jayk7CkBAIC0zODg1LDcgKzM4
NzMsNyBAQCBjc2NoZWQyX3N3aXRjaF9zY2hlZChzdHJ1Y3Qgc2NoZWR1bGVyICpuZXdfb3BzLCB1
bnNpZ25lZCBpbnQgY3B1LAogICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YyA9IHZkYXRhOwog
ICAgIHVuc2lnbmVkIHJxaTsKIAotICAgIEFTU0VSVChwZGF0YSAmJiBzdmMgJiYgaXNfaWRsZV92
Y3B1KHN2Yy0+dmNwdSkpOworICAgIEFTU0VSVChwZGF0YSAmJiBzdmMgJiYgaXNfaWRsZV91bml0
KHN2Yy0+dW5pdCkpOwogCiAgICAgLyoKICAgICAgKiBXZSBvd24gb25lIHJ1bnF1ZXVlIGxvY2sg
YWxyZWFkeSAoZnJvbSBzY2hlZHVsZV9jcHVfc3dpdGNoKCkpLiBUaGlzCkBAIC0zODk4LDcgKzM4
ODYsNyBAQCBjc2NoZWQyX3N3aXRjaF9zY2hlZChzdHJ1Y3Qgc2NoZWR1bGVyICpuZXdfb3BzLCB1
bnNpZ25lZCBpbnQgY3B1LAogICAgIEFTU0VSVCghbG9jYWxfaXJxX2lzX2VuYWJsZWQoKSk7CiAg
ICAgd3JpdGVfbG9jaygmcHJ2LT5sb2NrKTsKIAotICAgIGlkbGVfdmNwdVtjcHVdLT5zY2hlZF91
bml0LT5wcml2ID0gdmRhdGE7CisgICAgc2NoZWRfaWRsZV91bml0KGNwdSktPnByaXYgPSB2ZGF0
YTsKIAogICAgIHJxaSA9IGluaXRfcGRhdGEocHJ2LCBwZGF0YSwgY3B1KTsKIApAQCAtMzk0MCw3
ICszOTI4LDcgQEAgY3NjaGVkMl9kZWluaXRfcGRhdGEoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAq
b3BzLCB2b2lkICpwY3B1LCBpbnQgY3B1KQogICAgICAqLwogICAgIEFTU0VSVChzcGMgJiYgc3Bj
LT5ydW5xX2lkICE9IC0xKTsKICAgICBBU1NFUlQoY3B1bWFza190ZXN0X2NwdShjcHUsICZwcnYt
PmluaXRpYWxpemVkKSk7Ci0gICAgCisKICAgICAvKiBGaW5kIHRoZSBvbGQgcnVucXVldWUgYW5k
IHJlbW92ZSB0aGlzIGNwdSBmcm9tIGl0ICovCiAgICAgcnFkID0gcHJ2LT5ycWQgKyBzcGMtPnJ1
bnFfaWQ7CiAKLS0gCjIuMTYuNAoKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnBy
b2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94
ZW4tZGV2ZWw=

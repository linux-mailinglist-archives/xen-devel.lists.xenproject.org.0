Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 28EFF71F47
	for <lists+xen-devel@lfdr.de>; Tue, 23 Jul 2019 20:27:48 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hpzTm-0004xJ-Si; Tue, 23 Jul 2019 18:25:38 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=bPW/=VU=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1hpzTl-0004wy-Iy
 for xen-devel@lists.xenproject.org; Tue, 23 Jul 2019 18:25:37 +0000
X-Inumbo-ID: 42eacefe-ad77-11e9-8980-bc764e045a96
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 42eacefe-ad77-11e9-8980-bc764e045a96;
 Tue, 23 Jul 2019 18:25:35 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 60722ADC1;
 Tue, 23 Jul 2019 18:25:34 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Tue, 23 Jul 2019 20:25:30 +0200
Message-Id: <20190723182530.24087-3-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190723182530.24087-1-jgross@suse.com>
References: <20190723182530.24087-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v2 2/2] xen: merge temporary vcpu pinning
 scenarios
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>,
 Dario Faggioli <dfaggioli@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VG9kYXkgdGhlcmUgYXJlIHR3byBzY2VuYXJpb3Mgd2hpY2ggYXJlIHBpbm5pbmcgdmNwdXMgdGVt
cG9yYXJpbHkgdG8KYSBzaW5nbGUgcGh5c2ljYWwgY3B1OgoKLSB3YWl0X2V2ZW50KCkgaGFuZGxp
bmcKLSB2Y3B1X3Bpbl9vdmVycmlkZSgpIGhhbmRsaW5nCgpFYWNoIG9mIHRob3NlIGNhc2VzIGFy
ZSBoYW5kbGVkIGluZGVwZW5kZW50bHkgdG9kYXkgdXNpbmcgdGhlaXIgb3duCnRlbXBvcmFyeSBj
cHVtYXNrIHRvIHNhdmUgdGhlIG9sZCBhZmZpbml0eSBzZXR0aW5ncy4KClRoZSB0d28gY2FzZXMg
Y2FuIGJlIGNvbWJpbmVkIGFzIHRoZSBmaXJzdCBjYXNlIHdpbGwgb25seSBwaW4gYSB2Y3B1IHRv
CnRoZSBwaHlzaWNhbCBjcHUgaXQgaXMgYWxyZWFkeSBydW5uaW5nIG9uLCB3aGlsZSB2Y3B1X3Bp
bl9vdmVycmlkZSgpIGlzCmFsbG93ZWQgdG8gZmFpbC4KClNvIG1lcmdlIHRoZSB0d28gdGVtcG9y
YXJ5IHBpbm5pbmcgc2NlbmFyaW9zIGJ5IG9ubHkgdXNpbmcgb25lIGNwdW1hc2sKYW5kIGEgcGVy
LXZjcHUgYml0bWFzayBmb3Igc3BlY2lmeWluZyB3aGljaCBvZiB0aGUgc2NlbmFyaW9zIGlzCmN1
cnJlbnRseSBhY3RpdmUgKHRoZXkgYXJlIGFsbG93ZWQgdG8gbmVzdCkuCgpOb3RlIHRoYXQgd2Ug
ZG9uJ3QgbmVlZCB0byBjYWxsIGRvbWFpbl91cGRhdGVfbm9kZV9hZmZpbml0eSgpIGFzIHdlCmFy
ZSBvbmx5IHBpbm5pbmcgZm9yIGEgYnJpZWYgcGVyaW9kIG9mIHRpbWUuCgpTaWduZWQtb2ZmLWJ5
OiBKdWVyZ2VuIEdyb3NzIDxqZ3Jvc3NAc3VzZS5jb20+Ci0tLQpWMjoKLSByZW1vdmVkIHRoZSBO
TUkvTUNFIGNhc2UKLSByZW5hbWUgdmNwdV9zZXRfdG1wX2FmZmluaXR5KCkgKEphbiBCZXVsaWNo
KQotIHJlbW92ZSB2Y3B1X3Bpbl9vdmVycmlkZSgpIHdyYXBwZXIgKEFuZHJldyBDb29wZXIpCi0g
Y3VycmVudCAtPiBjdXJyIChKYW4gQmV1bGljaCwgQW5kcmV3IENvb3BlcikKLSBtYWtlIGNwdSBw
YXJhbWV0ZXIgdW5zaWduZWQgaW50IChKYW4gQmV1bGljaCkKLSBhZGQgY29tbWVudCAoRGFyaW8g
RmFnZ2lvbGkpCi0tLQogeGVuL2NvbW1vbi9kb21haW4uYyAgICAgfCAgMSArCiB4ZW4vY29tbW9u
L2RvbWN0bC5jICAgICB8ICAyICstCiB4ZW4vY29tbW9uL3NjaGVkdWxlLmMgICB8IDQ2ICsrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tLS0KIHhlbi9jb21tb24vd2Fp
dC5jICAgICAgIHwgMzAgKysrKysrKysrKy0tLS0tLS0tLS0tLS0tLS0tLS0tCiB4ZW4vaW5jbHVk
ZS94ZW4vc2NoZWQuaCB8ICA4ICsrKysrLS0tCiA1IGZpbGVzIGNoYW5nZWQsIDQ5IGluc2VydGlv
bnMoKyksIDM4IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vZG9tYWluLmMg
Yi94ZW4vY29tbW9uL2RvbWFpbi5jCmluZGV4IGJjNTZhNTE4MTUuLmU4ZTg1MDc5NmUgMTAwNjQ0
Ci0tLSBhL3hlbi9jb21tb24vZG9tYWluLmMKKysrIGIveGVuL2NvbW1vbi9kb21haW4uYwpAQCAt
MTI2Nyw2ICsxMjY3LDcgQEAgaW50IHZjcHVfcmVzZXQoc3RydWN0IHZjcHUgKnYpCiAgICAgdi0+
YXN5bmNfZXhjZXB0aW9uX21hc2sgPSAwOwogICAgIG1lbXNldCh2LT5hc3luY19leGNlcHRpb25f
c3RhdGUsIDAsIHNpemVvZih2LT5hc3luY19leGNlcHRpb25fc3RhdGUpKTsKICNlbmRpZgorICAg
IHYtPmFmZmluaXR5X2Jyb2tlbiA9IDA7CiAgICAgY2xlYXJfYml0KF9WUEZfYmxvY2tlZCwgJnYt
PnBhdXNlX2ZsYWdzKTsKICAgICBjbGVhcl9iaXQoX1ZQRl9pbl9yZXNldCwgJnYtPnBhdXNlX2Zs
YWdzKTsKIApkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9kb21jdGwuYyBiL3hlbi9jb21tb24vZG9t
Y3RsLmMKaW5kZXggNzJhNDQ5NTNkMC4uZmEyNjBjZTVmYiAxMDA2NDQKLS0tIGEveGVuL2NvbW1v
bi9kb21jdGwuYworKysgYi94ZW4vY29tbW9uL2RvbWN0bC5jCkBAIC02NTQsNyArNjU0LDcgQEAg
bG9uZyBkb19kb21jdGwoWEVOX0dVRVNUX0hBTkRMRV9QQVJBTSh4ZW5fZG9tY3RsX3QpIHVfZG9t
Y3RsKQogCiAgICAgICAgICAgICAvKiBVbmRvIGEgc3R1Y2sgU0NIRURfcGluX292ZXJyaWRlPyAq
LwogICAgICAgICAgICAgaWYgKCB2Y3B1YWZmLT5mbGFncyAmIFhFTl9WQ1BVQUZGSU5JVFlfRk9S
Q0UgKQotICAgICAgICAgICAgICAgIHZjcHVfcGluX292ZXJyaWRlKHYsIC0xKTsKKyAgICAgICAg
ICAgICAgICB2Y3B1X3RlbXBvcmFyeV9hZmZpbml0eSh2LCBOUl9DUFVTLCBWQ1BVX0FGRklOSVRZ
X09WRVJSSURFKTsKIAogICAgICAgICAgICAgcmV0ID0gMDsKIApkaWZmIC0tZ2l0IGEveGVuL2Nv
bW1vbi9zY2hlZHVsZS5jIGIveGVuL2NvbW1vbi9zY2hlZHVsZS5jCmluZGV4IDM0OWY5NjI0ZjUu
LjUwODE3NmExNDIgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWR1bGUuYworKysgYi94ZW4v
Y29tbW9uL3NjaGVkdWxlLmMKQEAgLTExMDYsNDMgKzExMDYsNTkgQEAgdm9pZCB3YXRjaGRvZ19k
b21haW5fZGVzdHJveShzdHJ1Y3QgZG9tYWluICpkKQogICAgICAgICBraWxsX3RpbWVyKCZkLT53
YXRjaGRvZ190aW1lcltpXSk7CiB9CiAKLWludCB2Y3B1X3Bpbl9vdmVycmlkZShzdHJ1Y3QgdmNw
dSAqdiwgaW50IGNwdSkKKy8qCisgKiBQaW4gYSB2Y3B1IHRlbXBvcmFyaWx5IHRvIGEgc3BlY2lm
aWMgQ1BVIChvciByZXN0b3JlIG9sZCBwaW5uaW5nIHN0YXRlIGlmCisgKiBjcHUgaXMgTlJfQ1BV
UykuCisgKiBUZW1wb3JhcnkgcGlubmluZyBjYW4gYmUgZG9uZSBkdWUgdG8gdHdvIHJlYXNvbnMs
IHdoaWNoIG1heSBiZSBuZXN0ZWQ6CisgKiAtIFZDUFVfQUZGSU5JVFlfT1ZFUlJJREUgKHJlcXVl
c3RlZCBieSBndWVzdCk6IGlzIGFsbG93ZWQgdG8gZmFpbCBpbiBjYXNlCisgKiAgIG9mIGEgY29u
ZmxpY3QgKGUuZy4gaW4gY2FzZSBjcHVwb29sIGRvZXNuJ3QgaW5jbHVkZSByZXF1ZXN0ZWQgQ1BV
LCBvcgorICogICBhbm90aGVyIGNvbmZsaWN0aW5nIHRlbXBvcmFyeSBwaW5uaW5nIGlzIGFscmVh
ZHkgaW4gZWZmZWN0LgorICogLSBWQ1BVX0FGRklOSVRZX1dBSVQgKGNhbGxlZCBieSB3YWl0X2V2
ZW50KCk6IG9ubHkgdXNlZCB0byBwaW4gdmNwdSB0byB0aGUKKyAqICAgQ1BVIGl0IGlzIGp1c3Qg
cnVubmluZyBvbi4gQ2FuJ3QgZmFpbCBpZiB1c2VkIHByb3Blcmx5LgorICovCitpbnQgdmNwdV90
ZW1wb3JhcnlfYWZmaW5pdHkoc3RydWN0IHZjcHUgKnYsIHVuc2lnbmVkIGludCBjcHUsIHVpbnQ4
X3QgcmVhc29uKQogewogICAgIHNwaW5sb2NrX3QgKmxvY2s7CiAgICAgaW50IHJldCA9IC1FSU5W
QUw7CisgICAgYm9vbCBtaWdyYXRlOwogCiAgICAgbG9jayA9IHZjcHVfc2NoZWR1bGVfbG9ja19p
cnEodik7CiAKLSAgICBpZiAoIGNwdSA8IDAgKQorICAgIGlmICggY3B1ID09IE5SX0NQVVMgKQog
ICAgIHsKLSAgICAgICAgaWYgKCB2LT5hZmZpbml0eV9icm9rZW4gKQorICAgICAgICBpZiAoIHYt
PmFmZmluaXR5X2Jyb2tlbiAmIHJlYXNvbiApCiAgICAgICAgIHsKLSAgICAgICAgICAgIHNjaGVk
X3NldF9hZmZpbml0eSh2LCB2LT5jcHVfaGFyZF9hZmZpbml0eV9zYXZlZCwgTlVMTCk7Ci0gICAg
ICAgICAgICB2LT5hZmZpbml0eV9icm9rZW4gPSAwOwogICAgICAgICAgICAgcmV0ID0gMDsKKyAg
ICAgICAgICAgIHYtPmFmZmluaXR5X2Jyb2tlbiAmPSB+cmVhc29uOwogICAgICAgICB9CisgICAg
ICAgIGlmICggIXJldCAmJiAhdi0+YWZmaW5pdHlfYnJva2VuICkKKyAgICAgICAgICAgIHNjaGVk
X3NldF9hZmZpbml0eSh2LCB2LT5jcHVfaGFyZF9hZmZpbml0eV9zYXZlZCwgTlVMTCk7CiAgICAg
fQogICAgIGVsc2UgaWYgKCBjcHUgPCBucl9jcHVfaWRzICkKICAgICB7Ci0gICAgICAgIGlmICgg
di0+YWZmaW5pdHlfYnJva2VuICkKKyAgICAgICAgaWYgKCAodi0+YWZmaW5pdHlfYnJva2VuICYg
cmVhc29uKSB8fAorICAgICAgICAgICAgICh2LT5hZmZpbml0eV9icm9rZW4gJiYgdi0+cHJvY2Vz
c29yICE9IGNwdSkgKQogICAgICAgICAgICAgcmV0ID0gLUVCVVNZOwogICAgICAgICBlbHNlIGlm
ICggY3B1bWFza190ZXN0X2NwdShjcHUsIFZDUFUyT05MSU5FKHYpKSApCiAgICAgICAgIHsKLSAg
ICAgICAgICAgIGNwdW1hc2tfY29weSh2LT5jcHVfaGFyZF9hZmZpbml0eV9zYXZlZCwgdi0+Y3B1
X2hhcmRfYWZmaW5pdHkpOwotICAgICAgICAgICAgdi0+YWZmaW5pdHlfYnJva2VuID0gMTsKLSAg
ICAgICAgICAgIHNjaGVkX3NldF9hZmZpbml0eSh2LCBjcHVtYXNrX29mKGNwdSksIE5VTEwpOwor
ICAgICAgICAgICAgaWYgKCAhdi0+YWZmaW5pdHlfYnJva2VuICkKKyAgICAgICAgICAgIHsKKyAg
ICAgICAgICAgICAgICBjcHVtYXNrX2NvcHkodi0+Y3B1X2hhcmRfYWZmaW5pdHlfc2F2ZWQsIHYt
PmNwdV9oYXJkX2FmZmluaXR5KTsKKyAgICAgICAgICAgICAgICBzY2hlZF9zZXRfYWZmaW5pdHko
diwgY3B1bWFza19vZihjcHUpLCBOVUxMKTsKKyAgICAgICAgICAgIH0KKyAgICAgICAgICAgIHYt
PmFmZmluaXR5X2Jyb2tlbiB8PSByZWFzb247CiAgICAgICAgICAgICByZXQgPSAwOwogICAgICAg
ICB9CiAgICAgfQogCi0gICAgaWYgKCByZXQgPT0gMCApCisgICAgbWlncmF0ZSA9ICFyZXQgJiYg
IWNwdW1hc2tfdGVzdF9jcHUodi0+cHJvY2Vzc29yLCB2LT5jcHVfaGFyZF9hZmZpbml0eSk7Cisg
ICAgaWYgKCBtaWdyYXRlICkKICAgICAgICAgdmNwdV9taWdyYXRlX3N0YXJ0KHYpOwogCiAgICAg
dmNwdV9zY2hlZHVsZV91bmxvY2tfaXJxKGxvY2ssIHYpOwogCi0gICAgZG9tYWluX3VwZGF0ZV9u
b2RlX2FmZmluaXR5KHYtPmRvbWFpbik7Ci0KLSAgICB2Y3B1X21pZ3JhdGVfZmluaXNoKHYpOwor
ICAgIGlmICggbWlncmF0ZSApCisgICAgICAgIHZjcHVfbWlncmF0ZV9maW5pc2godik7CiAKICAg
ICByZXR1cm4gcmV0OwogfQpAQCAtMTI1OCw2ICsxMjc0LDcgQEAgcmV0X3QgZG9fc2NoZWRfb3Ao
aW50IGNtZCwgWEVOX0dVRVNUX0hBTkRMRV9QQVJBTSh2b2lkKSBhcmcpCiAgICAgY2FzZSBTQ0hF
RE9QX3Bpbl9vdmVycmlkZToKICAgICB7CiAgICAgICAgIHN0cnVjdCBzY2hlZF9waW5fb3ZlcnJp
ZGUgc2NoZWRfcGluX292ZXJyaWRlOworICAgICAgICB1bnNpZ25lZCBpbnQgY3B1OwogCiAgICAg
ICAgIHJldCA9IC1FUEVSTTsKICAgICAgICAgaWYgKCAhaXNfaGFyZHdhcmVfZG9tYWluKGN1cnJl
bnQtPmRvbWFpbikgKQpAQCAtMTI2Nyw3ICsxMjg0LDggQEAgcmV0X3QgZG9fc2NoZWRfb3AoaW50
IGNtZCwgWEVOX0dVRVNUX0hBTkRMRV9QQVJBTSh2b2lkKSBhcmcpCiAgICAgICAgIGlmICggY29w
eV9mcm9tX2d1ZXN0KCZzY2hlZF9waW5fb3ZlcnJpZGUsIGFyZywgMSkgKQogICAgICAgICAgICAg
YnJlYWs7CiAKLSAgICAgICAgcmV0ID0gdmNwdV9waW5fb3ZlcnJpZGUoY3VycmVudCwgc2NoZWRf
cGluX292ZXJyaWRlLnBjcHUpOworICAgICAgICBjcHUgPSBzY2hlZF9waW5fb3ZlcnJpZGUucGNw
dSA8IDAgPyBOUl9DUFVTIDogc2NoZWRfcGluX292ZXJyaWRlLnBjcHU7CisgICAgICAgIHJldCA9
IHZjcHVfdGVtcG9yYXJ5X2FmZmluaXR5KGN1cnJlbnQsIGNwdSwgVkNQVV9BRkZJTklUWV9PVkVS
UklERSk7CiAKICAgICAgICAgYnJlYWs7CiAgICAgfQpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi93
YWl0LmMgYi94ZW4vY29tbW9uL3dhaXQuYwppbmRleCA0ZjgzMGExNGU4Li4zZmM1ZjY4NjExIDEw
MDY0NAotLS0gYS94ZW4vY29tbW9uL3dhaXQuYworKysgYi94ZW4vY29tbW9uL3dhaXQuYwpAQCAt
MzQsOCArMzQsNiBAQCBzdHJ1Y3Qgd2FpdHF1ZXVlX3ZjcHUgewogICAgICAqLwogICAgIHZvaWQg
KmVzcDsKICAgICBjaGFyICpzdGFjazsKLSAgICBjcHVtYXNrX3Qgc2F2ZWRfYWZmaW5pdHk7Ci0g
ICAgdW5zaWduZWQgaW50IHdha2V1cF9jcHU7CiAjZW5kaWYKIH07CiAKQEAgLTEzMSwxMiArMTI5
LDEwIEBAIHN0YXRpYyB2b2lkIF9fcHJlcGFyZV90b193YWl0KHN0cnVjdCB3YWl0cXVldWVfdmNw
dSAqd3F2KQogICAgIEFTU0VSVCh3cXYtPmVzcCA9PSAwKTsKIAogICAgIC8qIFNhdmUgY3VycmVu
dCBWQ1BVIGFmZmluaXR5OyBmb3JjZSB3YWtldXAgb24gKnRoaXMqIENQVSBvbmx5LiAqLwotICAg
IHdxdi0+d2FrZXVwX2NwdSA9IHNtcF9wcm9jZXNzb3JfaWQoKTsKLSAgICBjcHVtYXNrX2NvcHko
Jndxdi0+c2F2ZWRfYWZmaW5pdHksIGN1cnItPmNwdV9oYXJkX2FmZmluaXR5KTsKLSAgICBpZiAo
IHZjcHVfc2V0X2hhcmRfYWZmaW5pdHkoY3VyciwgY3B1bWFza19vZih3cXYtPndha2V1cF9jcHUp
KSApCisgICAgaWYgKCB2Y3B1X3RlbXBvcmFyeV9hZmZpbml0eShjdXJyLCBzbXBfcHJvY2Vzc29y
X2lkKCksIFZDUFVfQUZGSU5JVFlfV0FJVCkgKQogICAgIHsKICAgICAgICAgZ2RwcmludGsoWEVO
TE9HX0VSUiwgIlVuYWJsZSB0byBzZXQgdmNwdSBhZmZpbml0eVxuIik7Ci0gICAgICAgIGRvbWFp
bl9jcmFzaChjdXJyZW50LT5kb21haW4pOworICAgICAgICBkb21haW5fY3Jhc2goY3Vyci0+ZG9t
YWluKTsKIAogICAgICAgICBmb3IgKCA7IDsgKQogICAgICAgICAgICAgZG9fc29mdGlycSgpOwpA
QCAtMTcwLDcgKzE2Niw3IEBAIHN0YXRpYyB2b2lkIF9fcHJlcGFyZV90b193YWl0KHN0cnVjdCB3
YWl0cXVldWVfdmNwdSAqd3F2KQogICAgIGlmICggdW5saWtlbHkod3F2LT5lc3AgPT0gMCkgKQog
ICAgIHsKICAgICAgICAgZ2RwcmludGsoWEVOTE9HX0VSUiwgIlN0YWNrIHRvbyBsYXJnZSBpbiAl
c1xuIiwgX19mdW5jX18pOwotICAgICAgICBkb21haW5fY3Jhc2goY3VycmVudC0+ZG9tYWluKTsK
KyAgICAgICAgZG9tYWluX2NyYXNoKGN1cnItPmRvbWFpbik7CiAKICAgICAgICAgZm9yICggOyA7
ICkKICAgICAgICAgICAgIGRvX3NvZnRpcnEoKTsKQEAgLTE4MiwzMCArMTc4LDI0IEBAIHN0YXRp
YyB2b2lkIF9fcHJlcGFyZV90b193YWl0KHN0cnVjdCB3YWl0cXVldWVfdmNwdSAqd3F2KQogc3Rh
dGljIHZvaWQgX19maW5pc2hfd2FpdChzdHJ1Y3Qgd2FpdHF1ZXVlX3ZjcHUgKndxdikKIHsKICAg
ICB3cXYtPmVzcCA9IE5VTEw7Ci0gICAgKHZvaWQpdmNwdV9zZXRfaGFyZF9hZmZpbml0eShjdXJy
ZW50LCAmd3F2LT5zYXZlZF9hZmZpbml0eSk7CisgICAgdmNwdV90ZW1wb3JhcnlfYWZmaW5pdHko
Y3VycmVudCwgTlJfQ1BVUywgVkNQVV9BRkZJTklUWV9XQUlUKTsKIH0KIAogdm9pZCBjaGVja193
YWtldXBfZnJvbV93YWl0KHZvaWQpCiB7Ci0gICAgc3RydWN0IHdhaXRxdWV1ZV92Y3B1ICp3cXYg
PSBjdXJyZW50LT53YWl0cXVldWVfdmNwdTsKKyAgICBzdHJ1Y3QgdmNwdSAqY3VyciA9IGN1cnJl
bnQ7CisgICAgc3RydWN0IHdhaXRxdWV1ZV92Y3B1ICp3cXYgPSBjdXJyLT53YWl0cXVldWVfdmNw
dTsKIAogICAgIEFTU0VSVChsaXN0X2VtcHR5KCZ3cXYtPmxpc3QpKTsKIAogICAgIGlmICggbGlr
ZWx5KHdxdi0+ZXNwID09IE5VTEwpICkKICAgICAgICAgcmV0dXJuOwogCi0gICAgLyogQ2hlY2sg
aWYgd2Ugd29rZSB1cCBvbiB0aGUgd3JvbmcgQ1BVLiAqLwotICAgIGlmICggdW5saWtlbHkoc21w
X3Byb2Nlc3Nvcl9pZCgpICE9IHdxdi0+d2FrZXVwX2NwdSkgKQorICAgIC8qIENoZWNrIGlmIHdl
IGFyZSBzdGlsbCBwaW5uZWQuICovCisgICAgaWYgKCB1bmxpa2VseSghKGN1cnItPmFmZmluaXR5
X2Jyb2tlbiAmIFZDUFVfQUZGSU5JVFlfV0FJVCkpICkKICAgICB7Ci0gICAgICAgIC8qIFJlLXNl
dCBWQ1BVIGFmZmluaXR5IGFuZCByZS1lbnRlciB0aGUgc2NoZWR1bGVyLiAqLwotICAgICAgICBz
dHJ1Y3QgdmNwdSAqY3VyciA9IGN1cnJlbnQ7Ci0gICAgICAgIGNwdW1hc2tfY29weSgmd3F2LT5z
YXZlZF9hZmZpbml0eSwgY3Vyci0+Y3B1X2hhcmRfYWZmaW5pdHkpOwotICAgICAgICBpZiAoIHZj
cHVfc2V0X2hhcmRfYWZmaW5pdHkoY3VyciwgY3B1bWFza19vZih3cXYtPndha2V1cF9jcHUpKSAp
Ci0gICAgICAgIHsKLSAgICAgICAgICAgIGdkcHJpbnRrKFhFTkxPR19FUlIsICJVbmFibGUgdG8g
c2V0IHZjcHUgYWZmaW5pdHlcbiIpOwotICAgICAgICAgICAgZG9tYWluX2NyYXNoKGN1cnJlbnQt
PmRvbWFpbik7Ci0gICAgICAgIH0KLSAgICAgICAgd2FpdCgpOyAvKiB0YWtlcyB1cyBiYWNrIGlu
dG8gdGhlIHNjaGVkdWxlciAqLworICAgICAgICBnZHByaW50ayhYRU5MT0dfRVJSLCAidmNwdSBh
ZmZpbml0eSBsb3N0XG4iKTsKKyAgICAgICAgZG9tYWluX2NyYXNoKGN1cnItPmRvbWFpbik7CiAg
ICAgfQogCiAgICAgLyoKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oIGIveGVu
L2luY2x1ZGUveGVuL3NjaGVkLmgKaW5kZXggYzE5N2U5M2Q3My4uOTU3ODYyOGM2YSAxMDA2NDQK
LS0tIGEveGVuL2luY2x1ZGUveGVuL3NjaGVkLmgKKysrIGIveGVuL2luY2x1ZGUveGVuL3NjaGVk
LmgKQEAgLTIwMCw3ICsyMDAsOSBAQCBzdHJ1Y3QgdmNwdQogICAgIC8qIFZDUFUgaXMgcGF1c2Vk
IGZvbGxvd2luZyBzaHV0ZG93biByZXF1ZXN0IChkLT5pc19zaHV0dGluZ19kb3duKT8gKi8KICAg
ICBib29sICAgICAgICAgICAgIHBhdXNlZF9mb3Jfc2h1dGRvd247CiAgICAgLyogVkNQVSBuZWVk
IGFmZmluaXR5IHJlc3RvcmVkICovCi0gICAgYm9vbCAgICAgICAgICAgICBhZmZpbml0eV9icm9r
ZW47CisgICAgdWludDhfdCAgICAgICAgICBhZmZpbml0eV9icm9rZW47CisjZGVmaW5lIFZDUFVf
QUZGSU5JVFlfT1ZFUlJJREUgICAgMHgwMQorI2RlZmluZSBWQ1BVX0FGRklOSVRZX1dBSVQgICAg
ICAgIDB4MDIKIAogICAgIC8qIEEgaHlwZXJjYWxsIGhhcyBiZWVuIHByZWVtcHRlZC4gKi8KICAg
ICBib29sICAgICAgICAgICAgIGhjYWxsX3ByZWVtcHRlZDsKQEAgLTI0NSw3ICsyNDcsNyBAQCBz
dHJ1Y3QgdmNwdQogCiAgICAgLyogQml0bWFzayBvZiBDUFVzIG9uIHdoaWNoIHRoaXMgVkNQVSBt
YXkgcnVuLiAqLwogICAgIGNwdW1hc2tfdmFyX3QgICAgY3B1X2hhcmRfYWZmaW5pdHk7Ci0gICAg
LyogVXNlZCB0byByZXN0b3JlIGFmZmluaXR5IGFjcm9zcyBTMy4gKi8KKyAgICAvKiBVc2VkIHRv
IHNhdmUgYWZmaW5pdHkgZHVyaW5nIHRlbXBvcmFyeSBwaW5uaW5nLiAqLwogICAgIGNwdW1hc2tf
dmFyX3QgICAgY3B1X2hhcmRfYWZmaW5pdHlfc2F2ZWQ7CiAKICAgICAvKiBCaXRtYXNrIG9mIENQ
VXMgb24gd2hpY2ggdGhpcyBWQ1BVIHByZWZlcnMgdG8gcnVuLiAqLwpAQCAtODczLDEwICs4NzUs
MTAgQEAgaW50IGNwdV9kaXNhYmxlX3NjaGVkdWxlcih1bnNpZ25lZCBpbnQgY3B1KTsKIC8qIFdl
IG5lZWQgaXQgaW4gZG9tMF9zZXR1cF92Y3B1ICovCiB2b2lkIHNjaGVkX3NldF9hZmZpbml0eShz
dHJ1Y3QgdmNwdSAqdiwgY29uc3QgY3B1bWFza190ICpoYXJkLAogICAgICAgICAgICAgICAgICAg
ICAgICAgY29uc3QgY3B1bWFza190ICpzb2Z0KTsKK2ludCB2Y3B1X3RlbXBvcmFyeV9hZmZpbml0
eShzdHJ1Y3QgdmNwdSAqdiwgdW5zaWduZWQgaW50IGNwdSwgdWludDhfdCByZWFzb24pOwogaW50
IHZjcHVfc2V0X2hhcmRfYWZmaW5pdHkoc3RydWN0IHZjcHUgKnYsIGNvbnN0IGNwdW1hc2tfdCAq
YWZmaW5pdHkpOwogaW50IHZjcHVfc2V0X3NvZnRfYWZmaW5pdHkoc3RydWN0IHZjcHUgKnYsIGNv
bnN0IGNwdW1hc2tfdCAqYWZmaW5pdHkpOwogdm9pZCByZXN0b3JlX3ZjcHVfYWZmaW5pdHkoc3Ry
dWN0IGRvbWFpbiAqZCk7Ci1pbnQgdmNwdV9waW5fb3ZlcnJpZGUoc3RydWN0IHZjcHUgKnYsIGlu
dCBjcHUpOwogCiB2b2lkIHZjcHVfcnVuc3RhdGVfZ2V0KHN0cnVjdCB2Y3B1ICp2LCBzdHJ1Y3Qg
dmNwdV9ydW5zdGF0ZV9pbmZvICpydW5zdGF0ZSk7CiB1aW50NjRfdCBnZXRfY3B1X2lkbGVfdGlt
ZSh1bnNpZ25lZCBpbnQgY3B1KTsKLS0gCjIuMTYuNAoKCl9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVs
QGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1h
bi9saXN0aW5mby94ZW4tZGV2ZWw=

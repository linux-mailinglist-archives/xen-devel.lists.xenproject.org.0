Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 395A917A2D2
	for <lists+xen-devel@lfdr.de>; Thu,  5 Mar 2020 11:06:37 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1j9nLl-00010H-QK; Thu, 05 Mar 2020 10:03:29 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=eGB2=4W=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1j9nLk-00010C-Ox
 for xen-devel@lists.xenproject.org; Thu, 05 Mar 2020 10:03:28 +0000
X-Inumbo-ID: 8e35e282-5ec8-11ea-a54f-12813bfff9fa
Received: from mx2.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 8e35e282-5ec8-11ea-a54f-12813bfff9fa;
 Thu, 05 Mar 2020 10:03:26 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx2.suse.de (Postfix) with ESMTP id 8D629B23A;
 Thu,  5 Mar 2020 10:03:25 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org,
	linux-kernel@vger.kernel.org
Date: Thu,  5 Mar 2020 11:03:23 +0100
Message-Id: <20200305100323.16736-1-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
Subject: [Xen-devel] [PATCH] xen/xenbus: fix locking
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Boris Ostrovsky <boris.ostrovsky@oracle.com>,
 Stefano Stabellini <sstabellini@kernel.org>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

Q29tbWl0IDA2MGVhYmU4ZmJlNzI2ICgieGVuYnVzL2JhY2tlbmQ6IFByb3RlY3QgeGVuYnVzIGNh
bGxiYWNrIHdpdGgKbG9jayIpIGludHJvZHVjZWQgYSBidWcgYnkgaG9sZGluZyBhIGxvY2sgd2hp
bGUgY2FsbGluZyBhIGZ1bmN0aW9uCndoaWNoIG1pZ2h0IHNjaGVkdWxlLgoKRml4IHRoYXQgYnkg
dXNpbmcgYSBzZW1hcGhvcmUgaW5zdGVhZC4KCkZpeGVzOiAwNjBlYWJlOGZiZTcyNiAoInhlbmJ1
cy9iYWNrZW5kOiBQcm90ZWN0IHhlbmJ1cyBjYWxsYmFjayB3aXRoIGxvY2siKQpTaWduZWQtb2Zm
LWJ5OiBKdWVyZ2VuIEdyb3NzIDxqZ3Jvc3NAc3VzZS5jb20+Ci0tLQogZHJpdmVycy94ZW4veGVu
YnVzL3hlbmJ1c19wcm9iZS5jICAgICAgICAgfCAxMCArKysrKy0tLS0tCiBkcml2ZXJzL3hlbi94
ZW5idXMveGVuYnVzX3Byb2JlX2JhY2tlbmQuYyB8ICA1ICsrKy0tCiBpbmNsdWRlL3hlbi94ZW5i
dXMuaCAgICAgICAgICAgICAgICAgICAgICB8ICAzICsrLQogMyBmaWxlcyBjaGFuZ2VkLCAxMCBp
bnNlcnRpb25zKCspLCA4IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMveGVuL3hl
bmJ1cy94ZW5idXNfcHJvYmUuYyBiL2RyaXZlcnMveGVuL3hlbmJ1cy94ZW5idXNfcHJvYmUuYwpp
bmRleCA2Njk3NWRhNGYzYjYuLjhjNGQwNWI2ODdiNyAxMDA2NDQKLS0tIGEvZHJpdmVycy94ZW4v
eGVuYnVzL3hlbmJ1c19wcm9iZS5jCisrKyBiL2RyaXZlcnMveGVuL3hlbmJ1cy94ZW5idXNfcHJv
YmUuYwpAQCAtMjM5LDkgKzIzOSw5IEBAIGludCB4ZW5idXNfZGV2X3Byb2JlKHN0cnVjdCBkZXZp
Y2UgKl9kZXYpCiAJCWdvdG8gZmFpbDsKIAl9CiAKLQlzcGluX2xvY2soJmRldi0+cmVjbGFpbV9s
b2NrKTsKKwlkb3duKCZkZXYtPnJlY2xhaW1fc2VtKTsKIAllcnIgPSBkcnYtPnByb2JlKGRldiwg
aWQpOwotCXNwaW5fdW5sb2NrKCZkZXYtPnJlY2xhaW1fbG9jayk7CisJdXAoJmRldi0+cmVjbGFp
bV9zZW0pOwogCWlmIChlcnIpCiAJCWdvdG8gZmFpbF9wdXQ7CiAKQEAgLTI3MSw5ICsyNzEsOSBA
QCBpbnQgeGVuYnVzX2Rldl9yZW1vdmUoc3RydWN0IGRldmljZSAqX2RldikKIAlmcmVlX290aGVy
ZW5kX3dhdGNoKGRldik7CiAKIAlpZiAoZHJ2LT5yZW1vdmUpIHsKLQkJc3Bpbl9sb2NrKCZkZXYt
PnJlY2xhaW1fbG9jayk7CisJCWRvd24oJmRldi0+cmVjbGFpbV9zZW0pOwogCQlkcnYtPnJlbW92
ZShkZXYpOwotCQlzcGluX3VubG9jaygmZGV2LT5yZWNsYWltX2xvY2spOworCQl1cCgmZGV2LT5y
ZWNsYWltX3NlbSk7CiAJfQogCiAJbW9kdWxlX3B1dChkcnYtPmRyaXZlci5vd25lcik7CkBAIC00
NzMsNyArNDczLDcgQEAgaW50IHhlbmJ1c19wcm9iZV9ub2RlKHN0cnVjdCB4ZW5fYnVzX3R5cGUg
KmJ1cywKIAkJZ290byBmYWlsOwogCiAJZGV2X3NldF9uYW1lKCZ4ZW5kZXYtPmRldiwgIiVzIiwg
ZGV2bmFtZSk7Ci0Jc3Bpbl9sb2NrX2luaXQoJnhlbmRldi0+cmVjbGFpbV9sb2NrKTsKKwlzZW1h
X2luaXQoJnhlbmRldi0+cmVjbGFpbV9zZW0sIDEpOwogCiAJLyogUmVnaXN0ZXIgd2l0aCBnZW5l
cmljIGRldmljZSBmcmFtZXdvcmsuICovCiAJZXJyID0gZGV2aWNlX3JlZ2lzdGVyKCZ4ZW5kZXYt
PmRldik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL3hlbi94ZW5idXMveGVuYnVzX3Byb2JlX2JhY2tl
bmQuYyBiL2RyaXZlcnMveGVuL3hlbmJ1cy94ZW5idXNfcHJvYmVfYmFja2VuZC5jCmluZGV4IDc5
MWY2ZmUwMWU5MS4uOWIyZmJlNjliY2NjIDEwMDY0NAotLS0gYS9kcml2ZXJzL3hlbi94ZW5idXMv
eGVuYnVzX3Byb2JlX2JhY2tlbmQuYworKysgYi9kcml2ZXJzL3hlbi94ZW5idXMveGVuYnVzX3By
b2JlX2JhY2tlbmQuYwpAQCAtNDUsNiArNDUsNyBAQAogI2luY2x1ZGUgPGxpbnV4L21tLmg+CiAj
aW5jbHVkZSA8bGludXgvbm90aWZpZXIuaD4KICNpbmNsdWRlIDxsaW51eC9leHBvcnQuaD4KKyNp
bmNsdWRlIDxsaW51eC9zZW1hcGhvcmUuaD4KIAogI2luY2x1ZGUgPGFzbS9wYWdlLmg+CiAjaW5j
bHVkZSA8YXNtL3BndGFibGUuaD4KQEAgLTI1NywxMCArMjU4LDEwIEBAIHN0YXRpYyBpbnQgYmFj
a2VuZF9yZWNsYWltX21lbW9yeShzdHJ1Y3QgZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEpCiAJZHJ2
ID0gdG9feGVuYnVzX2RyaXZlcihkZXYtPmRyaXZlcik7CiAJaWYgKGRydiAmJiBkcnYtPnJlY2xh
aW1fbWVtb3J5KSB7CiAJCXhkZXYgPSB0b194ZW5idXNfZGV2aWNlKGRldik7Ci0JCWlmICghc3Bp
bl90cnlsb2NrKCZ4ZGV2LT5yZWNsYWltX2xvY2spKQorCQlpZiAoZG93bl90cnlsb2NrKCZ4ZGV2
LT5yZWNsYWltX3NlbSkpCiAJCQlyZXR1cm4gMDsKIAkJZHJ2LT5yZWNsYWltX21lbW9yeSh4ZGV2
KTsKLQkJc3Bpbl91bmxvY2soJnhkZXYtPnJlY2xhaW1fbG9jayk7CisJCXVwKCZ4ZGV2LT5yZWNs
YWltX3NlbSk7CiAJfQogCXJldHVybiAwOwogfQpkaWZmIC0tZ2l0IGEvaW5jbHVkZS94ZW4veGVu
YnVzLmggYi9pbmNsdWRlL3hlbi94ZW5idXMuaAppbmRleCA4OWE4ODk1ODViYTAuLjg1MGE0M2Jk
NjlkMyAxMDA2NDQKLS0tIGEvaW5jbHVkZS94ZW4veGVuYnVzLmgKKysrIGIvaW5jbHVkZS94ZW4v
eGVuYnVzLmgKQEAgLTQyLDYgKzQyLDcgQEAKICNpbmNsdWRlIDxsaW51eC9jb21wbGV0aW9uLmg+
CiAjaW5jbHVkZSA8bGludXgvaW5pdC5oPgogI2luY2x1ZGUgPGxpbnV4L3NsYWIuaD4KKyNpbmNs
dWRlIDxsaW51eC9zZW1hcGhvcmUuaD4KICNpbmNsdWRlIDx4ZW4vaW50ZXJmYWNlL3hlbi5oPgog
I2luY2x1ZGUgPHhlbi9pbnRlcmZhY2UvZ3JhbnRfdGFibGUuaD4KICNpbmNsdWRlIDx4ZW4vaW50
ZXJmYWNlL2lvL3hlbmJ1cy5oPgpAQCAtNzYsNyArNzcsNyBAQCBzdHJ1Y3QgeGVuYnVzX2Rldmlj
ZSB7CiAJZW51bSB4ZW5idXNfc3RhdGUgc3RhdGU7CiAJc3RydWN0IGNvbXBsZXRpb24gZG93bjsK
IAlzdHJ1Y3Qgd29ya19zdHJ1Y3Qgd29yazsKLQlzcGlubG9ja190IHJlY2xhaW1fbG9jazsKKwlz
dHJ1Y3Qgc2VtYXBob3JlIHJlY2xhaW1fc2VtOwogfTsKIAogc3RhdGljIGlubGluZSBzdHJ1Y3Qg
eGVuYnVzX2RldmljZSAqdG9feGVuYnVzX2RldmljZShzdHJ1Y3QgZGV2aWNlICpkZXYpCi0tIAoy
LjE2LjQKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpY
ZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRw
czovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

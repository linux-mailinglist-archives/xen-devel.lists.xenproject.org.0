Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 0A002BFF94
	for <lists+xen-devel@lfdr.de>; Fri, 27 Sep 2019 09:04:03 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iDkFw-0003T2-ME; Fri, 27 Sep 2019 07:01:32 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=Rbpq=XW=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1iDkFu-0003Qy-5y
 for xen-devel@lists.xenproject.org; Fri, 27 Sep 2019 07:01:30 +0000
X-Inumbo-ID: 8ff66910-e0f4-11e9-966c-12813bfff9fa
Received: from mx1.suse.de (unknown [195.135.220.15])
 by localhost (Halon) with ESMTPS
 id 8ff66910-e0f4-11e9-966c-12813bfff9fa;
 Fri, 27 Sep 2019 07:01:01 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id D1149B172;
 Fri, 27 Sep 2019 07:00:59 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Fri, 27 Sep 2019 09:00:19 +0200
Message-Id: <20190927070050.12405-16-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190927070050.12405-1-jgross@suse.com>
References: <20190927070050.12405-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v4 15/46] xen/sched: make rt scheduler vcpu
 agnostic.
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 George Dunlap <george.dunlap@eu.citrix.com>, Meng Xu <mengxu@cis.upenn.edu>,
 Dario Faggioli <dfaggioli@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

U3dpdGNoIHJ0IHNjaGVkdWxlciBjb21wbGV0ZWx5IGZyb20gdmNwdSB0byBzY2hlZF91bml0IHVz
YWdlLgoKU2lnbmVkLW9mZi1ieTogSnVlcmdlbiBHcm9zcyA8amdyb3NzQHN1c2UuY29tPgpSZXZp
ZXdlZC1ieTogRGFyaW8gRmFnZ2lvbGkgPGRmYWdnaW9saUBzdXNlLmNvbT4KLS0tCiB4ZW4vY29t
bW9uL3NjaGVkX3J0LmMgfCAzNTYgKysrKysrKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCAxNzQgaW5zZXJ0aW9ucygrKSwgMTgyIGRl
bGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vc2NoZWRfcnQuYyBiL3hlbi9jb21t
b24vc2NoZWRfcnQuYwppbmRleCAxM2UwZDc1NGFiLi4zZTg4NTJjMzQ4IDEwMDY0NAotLS0gYS94
ZW4vY29tbW9uL3NjaGVkX3J0LmMKKysrIGIveGVuL2NvbW1vbi9zY2hlZF9ydC5jCkBAIC0zNiw3
ICszNiw3IEBACiAgKgogICogTWlncmF0aW9uIGNvbXBlbnNhdGlvbiBhbmQgcmVzaXN0IGxpa2Ug
Y3JlZGl0MiB0byBiZXR0ZXIgdXNlIGNhY2hlOwogICogTG9jayBIb2xkZXIgUHJvYmxlbSwgdXNp
bmcgeWllbGQ/Ci0gKiBTZWxmIHN3aXRjaCBwcm9ibGVtOiBWQ1BVcyBvZiB0aGUgc2FtZSBkb21h
aW4gbWF5IHByZWVtcHQgZWFjaCBvdGhlcjsKKyAqIFNlbGYgc3dpdGNoIHByb2JsZW06IFVOSVRz
IG9mIHRoZSBzYW1lIGRvbWFpbiBtYXkgcHJlZW1wdCBlYWNoIG90aGVyOwogICovCiAKIC8qCkBA
IC00NCwzMCArNDQsMzAgQEAKICAqCiAgKiBUaGlzIHNjaGVkdWxlciBmb2xsb3dzIHRoZSBQcmVl
bXB0aXZlIEdsb2JhbCBFYXJsaWVzdCBEZWFkbGluZSBGaXJzdCAoRURGKQogICogdGhlb3J5IGlu
IHJlYWwtdGltZSBmaWVsZC4KLSAqIEF0IGFueSBzY2hlZHVsaW5nIHBvaW50LCB0aGUgVkNQVSB3
aXRoIGVhcmxpZXIgZGVhZGxpbmUgaGFzIGhpZ2hlciBwcmlvcml0eS4KLSAqIFRoZSBzY2hlZHVs
ZXIgYWx3YXlzIHBpY2tzIGhpZ2hlc3QgcHJpb3JpdHkgVkNQVSB0byBydW4gb24gYSBmZWFzaWJs
ZSBQQ1BVLgotICogQSBQQ1BVIGlzIGZlYXNpYmxlIGlmIHRoZSBWQ1BVIGNhbiBydW4gb24gdGhp
cyBQQ1BVIGFuZCAodGhlIFBDUFUgaXMgaWRsZSBvcgotICogaGFzIGEgbG93ZXItcHJpb3JpdHkg
VkNQVSBydW5uaW5nIG9uIGl0LikKKyAqIEF0IGFueSBzY2hlZHVsaW5nIHBvaW50LCB0aGUgVU5J
VCB3aXRoIGVhcmxpZXIgZGVhZGxpbmUgaGFzIGhpZ2hlciBwcmlvcml0eS4KKyAqIFRoZSBzY2hl
ZHVsZXIgYWx3YXlzIHBpY2tzIGhpZ2hlc3QgcHJpb3JpdHkgVU5JVCB0byBydW4gb24gYSBmZWFz
aWJsZSBQQ1BVLgorICogQSBQQ1BVIGlzIGZlYXNpYmxlIGlmIHRoZSBVTklUIGNhbiBydW4gb24g
dGhpcyBQQ1BVIGFuZCAodGhlIFBDUFUgaXMgaWRsZSBvcgorICogaGFzIGEgbG93ZXItcHJpb3Jp
dHkgVU5JVCBydW5uaW5nIG9uIGl0LikKICAqCi0gKiBFYWNoIFZDUFUgaGFzIGEgZGVkaWNhdGVk
IHBlcmlvZCwgYnVkZ2V0IGFuZCBhIGV4dHJhdGltZSBmbGFnCi0gKiBUaGUgZGVhZGxpbmUgb2Yg
YSBWQ1BVIGlzIGF0IHRoZSBlbmQgb2YgZWFjaCBwZXJpb2Q7Ci0gKiBBIFZDUFUgaGFzIGl0cyBi
dWRnZXQgcmVwbGVuaXNoZWQgYXQgdGhlIGJlZ2lubmluZyBvZiBlYWNoIHBlcmlvZDsKLSAqIFdo
aWxlIHNjaGVkdWxlZCwgYSBWQ1BVIGJ1cm5zIGl0cyBidWRnZXQuCi0gKiBUaGUgVkNQVSBuZWVk
cyB0byBmaW5pc2ggaXRzIGJ1ZGdldCBiZWZvcmUgaXRzIGRlYWRsaW5lIGluIGVhY2ggcGVyaW9k
OwotICogVGhlIFZDUFUgZGlzY2FyZHMgaXRzIHVudXNlZCBidWRnZXQgYXQgdGhlIGVuZCBvZiBl
YWNoIHBlcmlvZC4KLSAqIFdoZW4gYSBWQ1BVIHJ1bnMgb3V0IG9mIGJ1ZGdldCBpbiBhIHBlcmlv
ZCwgaWYgaXRzIGV4dHJhdGltZSBmbGFnIGlzIHNldCwKLSAqIHRoZSBWQ1BVIGluY3JlYXNlcyBp
dHMgcHJpb3JpdHlfbGV2ZWwgYnkgMSBhbmQgcmVmaWxscyBpdHMgYnVkZ2V0OyBvdGhlcndpc2Us
CisgKiBFYWNoIFVOSVQgaGFzIGEgZGVkaWNhdGVkIHBlcmlvZCwgYnVkZ2V0IGFuZCBhIGV4dHJh
dGltZSBmbGFnCisgKiBUaGUgZGVhZGxpbmUgb2YgYW4gVU5JVCBpcyBhdCB0aGUgZW5kIG9mIGVh
Y2ggcGVyaW9kOworICogQW4gVU5JVCBoYXMgaXRzIGJ1ZGdldCByZXBsZW5pc2hlZCBhdCB0aGUg
YmVnaW5uaW5nIG9mIGVhY2ggcGVyaW9kOworICogV2hpbGUgc2NoZWR1bGVkLCBhbiBVTklUIGJ1
cm5zIGl0cyBidWRnZXQuCisgKiBUaGUgVU5JVCBuZWVkcyB0byBmaW5pc2ggaXRzIGJ1ZGdldCBi
ZWZvcmUgaXRzIGRlYWRsaW5lIGluIGVhY2ggcGVyaW9kOworICogVGhlIFVOSVQgZGlzY2FyZHMg
aXRzIHVudXNlZCBidWRnZXQgYXQgdGhlIGVuZCBvZiBlYWNoIHBlcmlvZC4KKyAqIFdoZW4gYW4g
VU5JVCBydW5zIG91dCBvZiBidWRnZXQgaW4gYSBwZXJpb2QsIGlmIGl0cyBleHRyYXRpbWUgZmxh
ZyBpcyBzZXQsCisgKiB0aGUgVU5JVCBpbmNyZWFzZXMgaXRzIHByaW9yaXR5X2xldmVsIGJ5IDEg
YW5kIHJlZmlsbHMgaXRzIGJ1ZGdldDsgb3RoZXJ3aXNlLAogICogaXQgaGFzIHRvIHdhaXQgdW50
aWwgbmV4dCBwZXJpb2QuCiAgKgotICogRWFjaCBWQ1BVIGlzIGltcGxlbWVudGVkIGFzIGEgZGVm
ZXJhYmxlIHNlcnZlci4KLSAqIFdoZW4gYSBWQ1BVIGhhcyBhIHRhc2sgcnVubmluZyBvbiBpdCwg
aXRzIGJ1ZGdldCBpcyBjb250aW51b3VzbHkgYnVybmVkOwotICogV2hlbiBhIFZDUFUgaGFzIG5v
IHRhc2sgYnV0IHdpdGggYnVkZ2V0IGxlZnQsIGl0cyBidWRnZXQgaXMgcHJlc2VydmVkLgorICog
RWFjaCBVTklUIGlzIGltcGxlbWVudGVkIGFzIGEgZGVmZXJhYmxlIHNlcnZlci4KKyAqIFdoZW4g
YW4gVU5JVCBoYXMgYSB0YXNrIHJ1bm5pbmcgb24gaXQsIGl0cyBidWRnZXQgaXMgY29udGludW91
c2x5IGJ1cm5lZDsKKyAqIFdoZW4gYW4gVU5JVCBoYXMgbm8gdGFzayBidXQgd2l0aCBidWRnZXQg
bGVmdCwgaXRzIGJ1ZGdldCBpcyBwcmVzZXJ2ZWQuCiAgKgogICogUXVldWUgc2NoZW1lOgogICog
QSBnbG9iYWwgcnVucXVldWUgYW5kIGEgZ2xvYmFsIGRlcGxldGVkcXVldWUgZm9yIGVhY2ggQ1BV
IHBvb2wuCi0gKiBUaGUgcnVucXVldWUgaG9sZHMgYWxsIHJ1bm5hYmxlIFZDUFVzIHdpdGggYnVk
Z2V0LAorICogVGhlIHJ1bnF1ZXVlIGhvbGRzIGFsbCBydW5uYWJsZSBVTklUcyB3aXRoIGJ1ZGdl
dCwKICAqIHNvcnRlZCBieSBwcmlvcml0eV9sZXZlbCBhbmQgZGVhZGxpbmU7Ci0gKiBUaGUgZGVw
bGV0ZWRxdWV1ZSBob2xkcyBhbGwgVkNQVXMgd2l0aG91dCBidWRnZXQsIHVuc29ydGVkOworICog
VGhlIGRlcGxldGVkcXVldWUgaG9sZHMgYWxsIFVOSVRzIHdpdGhvdXQgYnVkZ2V0LCB1bnNvcnRl
ZDsKICAqCiAgKiBOb3RlOiBjcHVtYXNrIGFuZCBjcHVwb29sIGlzIHN1cHBvcnRlZC4KICAqLwpA
QCAtODIsNyArODIsNyBAQAogICogaW4gc2NoZWR1bGUuYwogICoKICAqIFRoZSBmdW5jdGlvbnMg
aW52b2xlcyBSdW5RIGFuZCBuZWVkcyB0byBncmFiIGxvY2tzIGFyZToKLSAqICAgIHZjcHVfaW5z
ZXJ0LCB2Y3B1X3JlbW92ZSwgY29udGV4dF9zYXZlZCwgcnVucV9pbnNlcnQKKyAqICAgIHVuaXRf
aW5zZXJ0LCB1bml0X3JlbW92ZSwgY29udGV4dF9zYXZlZCwgcnVucV9pbnNlcnQKICAqLwogCiAK
QEAgLTk1LDcgKzk1LDcgQEAKIAogLyoKICAqIE1heCBwZXJpb2Q6IG1heCBkZWx0YSBvZiB0aW1l
IHR5cGUsIGJlY2F1c2UgcGVyaW9kIGlzIGFkZGVkIHRvIHRoZSB0aW1lCi0gKiBhIHZjcHUgYWN0
aXZhdGVzLCBzbyB0aGlzIG11c3Qgbm90IG92ZXJmbG93LgorICogYW4gdW5pdCBhY3RpdmF0ZXMs
IHNvIHRoaXMgbXVzdCBub3Qgb3ZlcmZsb3cuCiAgKiBNaW4gcGVyaW9kOiAxMCB1cywgY29uc2lk
ZXJpbmcgdGhlIHNjaGVkdWxpbmcgb3ZlcmhlYWQgKHdoZW4gcGVyaW9kIGlzCiAgKiB0b28gbG93
LCBzY2hlZHVsaW5nIGlzIGludm9rZWQgdG9vIGZyZXF1ZW50bHksIGNhdXNpbmcgaGlnaCBvdmVy
aGVhZCkuCiAgKi8KQEAgLTEyMSwxMiArMTIxLDEyIEBACiAgKiBGbGFncwogICovCiAvKgotICog
UlREU19zY2hlZHVsZWQ6IElzIHRoaXMgdmNwdSBlaXRoZXIgcnVubmluZyBvbiwgb3IgY29udGV4
dC1zd2l0Y2hpbmcgb2ZmLAorICogUlREU19zY2hlZHVsZWQ6IElzIHRoaXMgdW5pdCBlaXRoZXIg
cnVubmluZyBvbiwgb3IgY29udGV4dC1zd2l0Y2hpbmcgb2ZmLAogICogYSBwaHlpc2NhbCBjcHU/
CiAgKiArIEFjY2Vzc2VkIG9ubHkgd2l0aCBnbG9iYWwgbG9jayBoZWxkLgogICogKyBTZXQgd2hl
biBjaG9zZW4gYXMgbmV4dCBpbiBydF9zY2hlZHVsZSgpLgogICogKyBDbGVhcmVkIGFmdGVyIGNv
bnRleHQgc3dpdGNoIGhhcyBiZWVuIHNhdmVkIGluIHJ0X2NvbnRleHRfc2F2ZWQoKQotICogKyBD
aGVja2VkIGluIHZjcHVfd2FrZSB0byBzZWUgaWYgd2UgY2FuIGFkZCB0byB0aGUgUnVucXVldWUs
IG9yIGlmIHdlIHNob3VsZAorICogKyBDaGVja2VkIGluIHVuaXRfd2FrZSB0byBzZWUgaWYgd2Ug
Y2FuIGFkZCB0byB0aGUgUnVucXVldWUsIG9yIGlmIHdlIHNob3VsZAogICogICBzZXQgUlREU19k
ZWxheWVkX3J1bnFfYWRkCiAgKiArIENoZWNrZWQgdG8gYmUgZmFsc2UgaW4gcnVucV9pbnNlcnQu
CiAgKi8KQEAgLTE0NiwxNSArMTQ2LDE1IEBACiAvKgogICogUlREU19kZXBsZXRlZDogRG9lcyB0
aGlzIHZjcCBydW4gb3V0IG9mIGJ1ZGdldD8KICAqIFRoaXMgZmxhZyBpcwotICogKyBzZXQgaW4g
YnVybl9idWRnZXQoKSBpZiBhIHZjcHUgaGFzIHplcm8gYnVkZ2V0IGxlZnQ7CisgKiArIHNldCBp
biBidXJuX2J1ZGdldCgpIGlmIGFuIHVuaXQgaGFzIHplcm8gYnVkZ2V0IGxlZnQ7CiAgKiArIGNs
ZWFyZWQgYW5kIGNoZWNrZWQgaW4gdGhlIHJlcGVuaXNobWVudCBoYW5kbGVyLAotICogICBmb3Ig
dGhlIHZjcHVzIHRoYXQgYXJlIGJlaW5nIHJlcGxlbmlzaGVkLgorICogICBmb3IgdGhlIHVuaXRz
IHRoYXQgYXJlIGJlaW5nIHJlcGxlbmlzaGVkLgogICovCiAjZGVmaW5lIF9fUlREU19kZXBsZXRl
ZCAgICAgMwogI2RlZmluZSBSVERTX2RlcGxldGVkICgxPDxfX1JURFNfZGVwbGV0ZWQpCiAKIC8q
Ci0gKiBSVERTX2V4dHJhdGltZTogQ2FuIHRoZSB2Y3B1IHJ1biBpbiB0aGUgdGltZSB0aGF0IGlz
CisgKiBSVERTX2V4dHJhdGltZTogQ2FuIHRoZSB1bml0IHJ1biBpbiB0aGUgdGltZSB0aGF0IGlz
CiAgKiBub3QgcGFydCBvZiBhbnkgcmVhbC10aW1lIHJlc2VydmF0aW9uLCBhbmQgd291bGQgdGhl
cmVmb3JlCiAgKiBiZSBvdGhlcndpc2UgbGVmdCBpZGxlPwogICovCkBAIC0xODMsMTEgKzE4Mywx
MSBAQCBzdHJ1Y3QgcnRfcHJpdmF0ZSB7CiAgICAgc3BpbmxvY2tfdCBsb2NrOyAgICAgICAgICAg
IC8qIHRoZSBnbG9iYWwgY29hcnNlLWdyYWluZWQgbG9jayAqLwogICAgIHN0cnVjdCBsaXN0X2hl
YWQgc2RvbTsgICAgICAvKiBsaXN0IG9mIGF2YWlsYWxiZSBkb21haW5zLCB1c2VkIGZvciBkdW1w
ICovCiAKLSAgICBzdHJ1Y3QgbGlzdF9oZWFkIHJ1bnE7ICAgICAgLyogb3JkZXJlZCBsaXN0IG9m
IHJ1bm5hYmxlIHZjcHVzICovCi0gICAgc3RydWN0IGxpc3RfaGVhZCBkZXBsZXRlZHE7IC8qIHVu
b3JkZXJlZCBsaXN0IG9mIGRlcGxldGVkIHZjcHVzICovCisgICAgc3RydWN0IGxpc3RfaGVhZCBy
dW5xOyAgICAgIC8qIG9yZGVyZWQgbGlzdCBvZiBydW5uYWJsZSB1bml0cyAqLworICAgIHN0cnVj
dCBsaXN0X2hlYWQgZGVwbGV0ZWRxOyAvKiB1bm9yZGVyZWQgbGlzdCBvZiBkZXBsZXRlZCB1bml0
cyAqLwogCiAgICAgc3RydWN0IHRpbWVyIHJlcGxfdGltZXI7ICAgIC8qIHJlcGxlbmlzaG1lbnQg
dGltZXIgKi8KLSAgICBzdHJ1Y3QgbGlzdF9oZWFkIHJlcGxxOyAgICAgLyogb3JkZXJlZCBsaXN0
IG9mIHZjcHVzIHRoYXQgbmVlZCByZXBsZW5pc2htZW50ICovCisgICAgc3RydWN0IGxpc3RfaGVh
ZCByZXBscTsgICAgIC8qIG9yZGVyZWQgbGlzdCBvZiB1bml0cyB0aGF0IG5lZWQgcmVwbGVuaXNo
bWVudCAqLwogCiAgICAgY3B1bWFza190IHRpY2tsZWQ7ICAgICAgICAgIC8qIGNwdXMgYmVlbiB0
aWNrbGVkICovCiB9OwpAQCAtMTk5LDE4ICsxOTksMTggQEAgc3RydWN0IHJ0X3VuaXQgewogICAg
IHN0cnVjdCBsaXN0X2hlYWQgcV9lbGVtOyAgICAgLyogb24gdGhlIHJ1bnEvZGVwbGV0ZWRxIGxp
c3QgKi8KICAgICBzdHJ1Y3QgbGlzdF9oZWFkIHJlcGxxX2VsZW07IC8qIG9uIHRoZSByZXBsZW5p
c2htZW50IGV2ZW50cyBsaXN0ICovCiAKLSAgICAvKiBWQ1BVIHBhcmFtZXRlcnMsIGluIG5hbm9z
ZWNvbmRzICovCisgICAgLyogVU5JVCBwYXJhbWV0ZXJzLCBpbiBuYW5vc2Vjb25kcyAqLwogICAg
IHNfdGltZV90IHBlcmlvZDsKICAgICBzX3RpbWVfdCBidWRnZXQ7CiAKLSAgICAvKiBWQ1BVIGN1
cnJlbnQgaW5mb3JtYXRpb24gaW4gbmFub3NlY29uZCAqLworICAgIC8qIFVOSVQgY3VycmVudCBp
bmZvcm1hdGlvbiBpbiBuYW5vc2Vjb25kICovCiAgICAgc190aW1lX3QgY3VyX2J1ZGdldDsgICAg
ICAgICAvKiBjdXJyZW50IGJ1ZGdldCAqLwogICAgIHNfdGltZV90IGxhc3Rfc3RhcnQ7ICAgICAg
ICAgLyogbGFzdCBzdGFydCB0aW1lICovCiAgICAgc190aW1lX3QgY3VyX2RlYWRsaW5lOyAgICAg
ICAvKiBjdXJyZW50IGRlYWRsaW5lIGZvciBFREYgKi8KIAogICAgIC8qIFVwLXBvaW50ZXJzICov
CiAgICAgc3RydWN0IHJ0X2RvbSAqc2RvbTsKLSAgICBzdHJ1Y3QgdmNwdSAqdmNwdTsKKyAgICBz
dHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdDsKIAogICAgIHVuc2lnbmVkIHByaW9yaXR5X2xldmVsOwog
CkBAIC0yNjMsNyArMjYzLDcgQEAgc3RhdGljIGlubGluZSBib29sIGhhc19leHRyYXRpbWUoY29u
c3Qgc3RydWN0IHJ0X3VuaXQgKnN2YykKICAqIGFuZCB0aGUgcmVwbGVuaXNobWVudCBldmVudHMg
cXVldWUuCiAgKi8KIHN0YXRpYyBpbnQKLXZjcHVfb25fcShjb25zdCBzdHJ1Y3QgcnRfdW5pdCAq
c3ZjKQordW5pdF9vbl9xKGNvbnN0IHN0cnVjdCBydF91bml0ICpzdmMpCiB7CiAgICByZXR1cm4g
IWxpc3RfZW1wdHkoJnN2Yy0+cV9lbGVtKTsKIH0KQEAgLTI4MSw3ICsyODEsNyBAQCByZXBscV9l
bGVtKHN0cnVjdCBsaXN0X2hlYWQgKmVsZW0pCiB9CiAKIHN0YXRpYyBpbnQKLXZjcHVfb25fcmVw
bHEoY29uc3Qgc3RydWN0IHJ0X3VuaXQgKnN2YykKK3VuaXRfb25fcmVwbHEoY29uc3Qgc3RydWN0
IHJ0X3VuaXQgKnN2YykKIHsKICAgICByZXR1cm4gIWxpc3RfZW1wdHkoJnN2Yy0+cmVwbHFfZWxl
bSk7CiB9CkBAIC0yOTEsNyArMjkxLDcgQEAgdmNwdV9vbl9yZXBscShjb25zdCBzdHJ1Y3QgcnRf
dW5pdCAqc3ZjKQogICogT3RoZXJ3aXNlLCByZXR1cm4gdmFsdWUgPCAwCiAgKi8KIHN0YXRpYyBz
X3RpbWVfdAotY29tcGFyZV92Y3B1X3ByaW9yaXR5KGNvbnN0IHN0cnVjdCBydF91bml0ICp2MSwg
Y29uc3Qgc3RydWN0IHJ0X3VuaXQgKnYyKQorY29tcGFyZV91bml0X3ByaW9yaXR5KGNvbnN0IHN0
cnVjdCBydF91bml0ICp2MSwgY29uc3Qgc3RydWN0IHJ0X3VuaXQgKnYyKQogewogICAgIGludCBw
cmlvID0gdjItPnByaW9yaXR5X2xldmVsIC0gdjEtPnByaW9yaXR5X2xldmVsOwogCkBAIC0zMDIs
MTUgKzMwMiwxNSBAQCBjb21wYXJlX3ZjcHVfcHJpb3JpdHkoY29uc3Qgc3RydWN0IHJ0X3VuaXQg
KnYxLCBjb25zdCBzdHJ1Y3QgcnRfdW5pdCAqdjIpCiB9CiAKIC8qCi0gKiBEZWJ1ZyByZWxhdGVk
IGNvZGUsIGR1bXAgdmNwdS9jcHUgaW5mb3JtYXRpb24KKyAqIERlYnVnIHJlbGF0ZWQgY29kZSwg
ZHVtcCB1bml0L2NwdSBpbmZvcm1hdGlvbgogICovCiBzdGF0aWMgdm9pZAotcnRfZHVtcF92Y3B1
KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgY29uc3Qgc3RydWN0IHJ0X3VuaXQgKnN2YykK
K3J0X2R1bXBfdW5pdChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGNvbnN0IHN0cnVjdCBy
dF91bml0ICpzdmMpCiB7CiAgICAgY3B1bWFza190ICpjcHVwb29sX21hc2ssICptYXNrOwogCiAg
ICAgQVNTRVJUKHN2YyAhPSBOVUxMKTsKLSAgICAvKiBpZGxlIHZjcHUgKi8KKyAgICAvKiBpZGxl
IHVuaXQgKi8KICAgICBpZiggc3ZjLT5zZG9tID09IE5VTEwgKQogICAgIHsKICAgICAgICAgcHJp
bnRrKCJcbiIpOwpAQCAtMzIxLDIwICszMjEsMjAgQEAgcnRfZHVtcF92Y3B1KGNvbnN0IHN0cnVj
dCBzY2hlZHVsZXIgKm9wcywgY29uc3Qgc3RydWN0IHJ0X3VuaXQgKnN2YykKICAgICAgKiBXZSBj
YW4ndCBqdXN0IHVzZSAnY3B1bWFza19zY3JhdGNoJyBiZWNhdXNlIHRoZSBkdW1waW5nIGNhbgog
ICAgICAqIGhhcHBlbiBmcm9tIGEgcENQVSBvdXRzaWRlIG9mIHRoaXMgc2NoZWR1bGVyJ3MgY3B1
cG9vbCwgYW5kCiAgICAgICogaGVuY2UgaXQncyBub3QgcmlnaHQgdG8gdXNlIGl0cyBwQ1BVJ3Mg
c2NyYXRjaCBtYXNrLgotICAgICAqIE9uIHRoZSBvdGhlciBoYW5kLCBpdCBpcyBzYWZlIHRvIHVz
ZSBzdmMtPnZjcHUtPnByb2Nlc3NvcidzCisgICAgICogT24gdGhlIG90aGVyIGhhbmQsIGl0IGlz
IHNhZmUgdG8gdXNlIHNjaGVkX3VuaXRfbWFzdGVyKHN2Yy0+dW5pdCkncwogICAgICAqIG93biBz
Y3JhdGNoIHNwYWNlLCBzaW5jZSB3ZSBob2xkIHRoZSBydW5xdWV1ZSBsb2NrLgogICAgICAqLwot
ICAgIG1hc2sgPSBjcHVtYXNrX3NjcmF0Y2hfY3B1KHN2Yy0+dmNwdS0+cHJvY2Vzc29yKTsKKyAg
ICBtYXNrID0gY3B1bWFza19zY3JhdGNoX2NwdShzY2hlZF91bml0X21hc3RlcihzdmMtPnVuaXQp
KTsKIAotICAgIGNwdXBvb2xfbWFzayA9IGNwdXBvb2xfZG9tYWluX2NwdW1hc2soc3ZjLT52Y3B1
LT5kb21haW4pOwotICAgIGNwdW1hc2tfYW5kKG1hc2ssIGNwdXBvb2xfbWFzaywgc3ZjLT52Y3B1
LT5zY2hlZF91bml0LT5jcHVfaGFyZF9hZmZpbml0eSk7CisgICAgY3B1cG9vbF9tYXNrID0gY3B1
cG9vbF9kb21haW5fY3B1bWFzayhzdmMtPnVuaXQtPmRvbWFpbik7CisgICAgY3B1bWFza19hbmQo
bWFzaywgY3B1cG9vbF9tYXNrLCBzdmMtPnVuaXQtPmNwdV9oYXJkX2FmZmluaXR5KTsKICAgICBw
cmludGsoIlslNWQuJS0ydV0gY3B1ICV1LCAoJSJQUklfc3RpbWUiLCAlIlBSSV9zdGltZSIpLCIK
ICAgICAgICAgICAgIiBjdXJfYj0lIlBSSV9zdGltZSIgY3VyX2Q9JSJQUklfc3RpbWUiIGxhc3Rf
c3RhcnQ9JSJQUklfc3RpbWUiXG4iCiAgICAgICAgICAgICIgXHRcdCBwcmlvcml0eV9sZXZlbD0l
ZCBoYXNfZXh0cmF0aW1lPSVkXG4iCiAgICAgICAgICAgICIgXHRcdCBvblE9JWQgcnVubmFibGU9
JWQgZmxhZ3M9JXggZWZmZWN0aXZlIGhhcmRfYWZmaW5pdHk9JSpwYmxcbiIsCi0gICAgICAgICAg
ICBzdmMtPnZjcHUtPmRvbWFpbi0+ZG9tYWluX2lkLAotICAgICAgICAgICAgc3ZjLT52Y3B1LT52
Y3B1X2lkLAotICAgICAgICAgICAgc3ZjLT52Y3B1LT5wcm9jZXNzb3IsCisgICAgICAgICAgICBz
dmMtPnVuaXQtPmRvbWFpbi0+ZG9tYWluX2lkLAorICAgICAgICAgICAgc3ZjLT51bml0LT51bml0
X2lkLAorICAgICAgICAgICAgc2NoZWRfdW5pdF9tYXN0ZXIoc3ZjLT51bml0KSwKICAgICAgICAg
ICAgIHN2Yy0+cGVyaW9kLAogICAgICAgICAgICAgc3ZjLT5idWRnZXQsCiAgICAgICAgICAgICBz
dmMtPmN1cl9idWRnZXQsCkBAIC0zNDIsOCArMzQyLDggQEAgcnRfZHVtcF92Y3B1KGNvbnN0IHN0
cnVjdCBzY2hlZHVsZXIgKm9wcywgY29uc3Qgc3RydWN0IHJ0X3VuaXQgKnN2YykKICAgICAgICAg
ICAgIHN2Yy0+bGFzdF9zdGFydCwKICAgICAgICAgICAgIHN2Yy0+cHJpb3JpdHlfbGV2ZWwsCiAg
ICAgICAgICAgICBoYXNfZXh0cmF0aW1lKHN2YyksCi0gICAgICAgICAgICB2Y3B1X29uX3Eoc3Zj
KSwKLSAgICAgICAgICAgIHZjcHVfcnVubmFibGUoc3ZjLT52Y3B1KSwKKyAgICAgICAgICAgIHVu
aXRfb25fcShzdmMpLAorICAgICAgICAgICAgdW5pdF9ydW5uYWJsZShzdmMtPnVuaXQpLAogICAg
ICAgICAgICAgc3ZjLT5mbGFncywgQ1BVTUFTS19QUihtYXNrKSk7CiB9CiAKQEAgLTM1NiwxMSAr
MzU2LDExIEBAIHJ0X2R1bXBfcGNwdShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGludCBj
cHUpCiAKICAgICBzcGluX2xvY2tfaXJxc2F2ZSgmcHJ2LT5sb2NrLCBmbGFncyk7CiAgICAgcHJp
bnRrKCJDUFVbJTAyZF1cbiIsIGNwdSk7Ci0gICAgLyogY3VycmVudCBWQ1BVIChub3RoaW5nIHRv
IHNheSBpZiB0aGF0J3MgdGhlIGlkbGUgdmNwdSkuICovCisgICAgLyogY3VycmVudCBVTklUIChu
b3RoaW5nIHRvIHNheSBpZiB0aGF0J3MgdGhlIGlkbGUgdW5pdCkuICovCiAgICAgc3ZjID0gcnRf
dW5pdChjdXJyX29uX2NwdShjcHUpKTsKLSAgICBpZiAoIHN2YyAmJiAhaXNfaWRsZV92Y3B1KHN2
Yy0+dmNwdSkgKQorICAgIGlmICggc3ZjICYmICFpc19pZGxlX3VuaXQoc3ZjLT51bml0KSApCiAg
ICAgewotICAgICAgICBydF9kdW1wX3ZjcHUob3BzLCBzdmMpOworICAgICAgICBydF9kdW1wX3Vu
aXQob3BzLCBzdmMpOwogICAgIH0KICAgICBzcGluX3VubG9ja19pcnFyZXN0b3JlKCZwcnYtPmxv
Y2ssIGZsYWdzKTsKIH0KQEAgLTM4NywzNSArMzg3LDM1IEBAIHJ0X2R1bXAoY29uc3Qgc3RydWN0
IHNjaGVkdWxlciAqb3BzKQogICAgIGxpc3RfZm9yX2VhY2ggKCBpdGVyLCBydW5xICkKICAgICB7
CiAgICAgICAgIHN2YyA9IHFfZWxlbShpdGVyKTsKLSAgICAgICAgcnRfZHVtcF92Y3B1KG9wcywg
c3ZjKTsKKyAgICAgICAgcnRfZHVtcF91bml0KG9wcywgc3ZjKTsKICAgICB9CiAKICAgICBwcmlu
dGsoIkdsb2JhbCBEZXBsZXRlZFF1ZXVlIGluZm86XG4iKTsKICAgICBsaXN0X2Zvcl9lYWNoICgg
aXRlciwgZGVwbGV0ZWRxICkKICAgICB7CiAgICAgICAgIHN2YyA9IHFfZWxlbShpdGVyKTsKLSAg
ICAgICAgcnRfZHVtcF92Y3B1KG9wcywgc3ZjKTsKKyAgICAgICAgcnRfZHVtcF91bml0KG9wcywg
c3ZjKTsKICAgICB9CiAKICAgICBwcmludGsoIkdsb2JhbCBSZXBsZW5pc2htZW50IEV2ZW50cyBp
bmZvOlxuIik7CiAgICAgbGlzdF9mb3JfZWFjaCAoIGl0ZXIsIHJlcGxxICkKICAgICB7CiAgICAg
ICAgIHN2YyA9IHJlcGxxX2VsZW0oaXRlcik7Ci0gICAgICAgIHJ0X2R1bXBfdmNwdShvcHMsIHN2
Yyk7CisgICAgICAgIHJ0X2R1bXBfdW5pdChvcHMsIHN2Yyk7CiAgICAgfQogCiAgICAgcHJpbnRr
KCJEb21haW4gaW5mbzpcbiIpOwogICAgIGxpc3RfZm9yX2VhY2ggKCBpdGVyLCAmcHJ2LT5zZG9t
ICkKICAgICB7Ci0gICAgICAgIHN0cnVjdCB2Y3B1ICp2OworICAgICAgICBzdHJ1Y3Qgc2NoZWRf
dW5pdCAqdW5pdDsKIAogICAgICAgICBzZG9tID0gbGlzdF9lbnRyeShpdGVyLCBzdHJ1Y3QgcnRf
ZG9tLCBzZG9tX2VsZW0pOwogICAgICAgICBwcmludGsoIlx0ZG9tYWluOiAlZFxuIiwgc2RvbS0+
ZG9tLT5kb21haW5faWQpOwogCi0gICAgICAgIGZvcl9lYWNoX3ZjcHUgKCBzZG9tLT5kb20sIHYg
KQorICAgICAgICBmb3JfZWFjaF9zY2hlZF91bml0ICggc2RvbS0+ZG9tLCB1bml0ICkKICAgICAg
ICAgewotICAgICAgICAgICAgc3ZjID0gcnRfdW5pdCh2LT5zY2hlZF91bml0KTsKLSAgICAgICAg
ICAgIHJ0X2R1bXBfdmNwdShvcHMsIHN2Yyk7CisgICAgICAgICAgICBzdmMgPSBydF91bml0KHVu
aXQpOworICAgICAgICAgICAgcnRfZHVtcF91bml0KG9wcywgc3ZjKTsKICAgICAgICAgfQogICAg
IH0KIApAQCAtNDU3LDEyICs0NTcsMTIgQEAgcnRfdXBkYXRlX2RlYWRsaW5lKHNfdGltZV90IG5v
dywgc3RydWN0IHJ0X3VuaXQgKnN2YykKICAgICAvKiBUUkFDRSAqLwogICAgIHsKICAgICAgICAg
c3RydWN0IF9fcGFja2VkIHsKLSAgICAgICAgICAgIHVuc2lnbmVkIHZjcHU6MTYsIGRvbToxNjsK
KyAgICAgICAgICAgIHVuc2lnbmVkIHVuaXQ6MTYsIGRvbToxNjsKICAgICAgICAgICAgIHVuc2ln
bmVkIHByaW9yaXR5X2xldmVsOwogICAgICAgICAgICAgdWludDY0X3QgY3VyX2RlYWRsaW5lLCBj
dXJfYnVkZ2V0OwogICAgICAgICB9IGQ7Ci0gICAgICAgIGQuZG9tID0gc3ZjLT52Y3B1LT5kb21h
aW4tPmRvbWFpbl9pZDsKLSAgICAgICAgZC52Y3B1ID0gc3ZjLT52Y3B1LT52Y3B1X2lkOworICAg
ICAgICBkLmRvbSA9IHN2Yy0+dW5pdC0+ZG9tYWluLT5kb21haW5faWQ7CisgICAgICAgIGQudW5p
dCA9IHN2Yy0+dW5pdC0+dW5pdF9pZDsKICAgICAgICAgZC5wcmlvcml0eV9sZXZlbCA9IHN2Yy0+
cHJpb3JpdHlfbGV2ZWw7CiAgICAgICAgIGQuY3VyX2RlYWRsaW5lID0gKHVpbnQ2NF90KSBzdmMt
PmN1cl9kZWFkbGluZTsKICAgICAgICAgZC5jdXJfYnVkZ2V0ID0gKHVpbnQ2NF90KSBzdmMtPmN1
cl9idWRnZXQ7CkBAIC00NzUsMTUgKzQ3NSwxNSBAQCBydF91cGRhdGVfZGVhZGxpbmUoc190aW1l
X3Qgbm93LCBzdHJ1Y3QgcnRfdW5pdCAqc3ZjKQogfQogCiAvKgotICogSGVscGVycyBmb3IgcmVt
b3ZpbmcgYW5kIGluc2VydGluZyBhIHZjcHUgaW4gYSBxdWV1ZQotICogdGhhdCBpcyBiZWluZyBr
ZXB0IG9yZGVyZWQgYnkgdGhlIHZjcHVzJyBkZWFkbGluZXMgKGFzIEVERgorICogSGVscGVycyBm
b3IgcmVtb3ZpbmcgYW5kIGluc2VydGluZyBhbiB1bml0IGluIGEgcXVldWUKKyAqIHRoYXQgaXMg
YmVpbmcga2VwdCBvcmRlcmVkIGJ5IHRoZSB1bml0cycgZGVhZGxpbmVzIChhcyBFREYKICAqIG1h
bmRhdGVzKS4KICAqCi0gKiBGb3IgY2FsbGVycycgY29udmVuaWVuY2UsIHRoZSB2Y3B1IHJlbW92
aW5nIGhlbHBlciByZXR1cm5zCi0gKiB0cnVlIGlmIHRoZSB2Y3B1IHJlbW92ZWQgd2FzIHRoZSBv
bmUgYXQgdGhlIGZyb250IG9mIHRoZQorICogRm9yIGNhbGxlcnMnIGNvbnZlbmllbmNlLCB0aGUg
dW5pdCByZW1vdmluZyBoZWxwZXIgcmV0dXJucworICogdHJ1ZSBpZiB0aGUgdW5pdCByZW1vdmVk
IHdhcyB0aGUgb25lIGF0IHRoZSBmcm9udCBvZiB0aGUKICAqIHF1ZXVlOyBzaW1pbGFybHksIHRo
ZSBpbnNlcnRpbmcgaGVscGVyIHJldHVybnMgdHJ1ZSBpZiB0aGUKICAqIGluc2VydGVkIGVuZGVk
IGF0IHRoZSBmcm9udCBvZiB0aGUgcXVldWUgKGkuZS4sIGluIGJvdGgKLSAqIGNhc2VzLCBpZiB0
aGUgdmNwdSB3aXRoIHRoZSBlYXJsaWVzdCBkZWFkbGluZSBpcyB3aGF0IHdlCisgKiBjYXNlcywg
aWYgdGhlIHVuaXQgd2l0aCB0aGUgZWFybGllc3QgZGVhZGxpbmUgaXMgd2hhdCB3ZQogICogYXJl
IGRlYWxpbmcgd2l0aCkuCiAgKi8KIHN0YXRpYyBpbmxpbmUgYm9vbApAQCAtNTA5LDcgKzUwOSw3
IEBAIGRlYWRsaW5lX3F1ZXVlX2luc2VydChzdHJ1Y3QgcnRfdW5pdCAqICgqcWVsZW0pKHN0cnVj
dCBsaXN0X2hlYWQgKiksCiAgICAgbGlzdF9mb3JfZWFjaCAoIGl0ZXIsIHF1ZXVlICkKICAgICB7
CiAgICAgICAgIHN0cnVjdCBydF91bml0ICogaXRlcl9zdmMgPSAoKnFlbGVtKShpdGVyKTsKLSAg
ICAgICAgaWYgKCBjb21wYXJlX3ZjcHVfcHJpb3JpdHkoc3ZjLCBpdGVyX3N2YykgPiAwICkKKyAg
ICAgICAgaWYgKCBjb21wYXJlX3VuaXRfcHJpb3JpdHkoc3ZjLCBpdGVyX3N2YykgPiAwICkKICAg
ICAgICAgICAgIGJyZWFrOwogICAgICAgICBwb3MrKzsKICAgICB9CkBAIC01MjQsNyArNTI0LDcg
QEAgZGVhZGxpbmVfcXVldWVfaW5zZXJ0KHN0cnVjdCBydF91bml0ICogKCpxZWxlbSkoc3RydWN0
IGxpc3RfaGVhZCAqKSwKIHN0YXRpYyBpbmxpbmUgdm9pZAogcV9yZW1vdmUoc3RydWN0IHJ0X3Vu
aXQgKnN2YykKIHsKLSAgICBBU1NFUlQoIHZjcHVfb25fcShzdmMpICk7CisgICAgQVNTRVJUKCB1
bml0X29uX3Eoc3ZjKSApOwogICAgIGxpc3RfZGVsX2luaXQoJnN2Yy0+cV9lbGVtKTsKIH0KIApA
QCAtNTM0LDE0ICs1MzQsMTQgQEAgcmVwbHFfcmVtb3ZlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIg
Km9wcywgc3RydWN0IHJ0X3VuaXQgKnN2YykKICAgICBzdHJ1Y3QgcnRfcHJpdmF0ZSAqcHJ2ID0g
cnRfcHJpdihvcHMpOwogICAgIHN0cnVjdCBsaXN0X2hlYWQgKnJlcGxxID0gcnRfcmVwbHEob3Bz
KTsKIAotICAgIEFTU0VSVCggdmNwdV9vbl9yZXBscShzdmMpICk7CisgICAgQVNTRVJUKCB1bml0
X29uX3JlcGxxKHN2YykgKTsKIAogICAgIGlmICggZGVhZGxpbmVfcXVldWVfcmVtb3ZlKHJlcGxx
LCAmc3ZjLT5yZXBscV9lbGVtKSApCiAgICAgewogICAgICAgICAvKgogICAgICAgICAgKiBUaGUg
cmVwbGVuaXNobWVudCB0aW1lciBuZWVkcyB0byBiZSBzZXQgdG8gZmlyZSB3aGVuIGEKLSAgICAg
ICAgICogcmVwbGVuaXNobWVudCBmb3IgdGhlIHZjcHUgYXQgdGhlIGZyb250IG9mIHRoZSByZXBs
ZW5pc2htZW50Ci0gICAgICAgICAqIHF1ZXVlIGlzIGR1ZS4gSWYgaXQgaXMgc3VjaCB2Y3B1IHRo
YXQgd2UganVzdCByZW1vdmVkLCB3ZSBtYXkKKyAgICAgICAgICogcmVwbGVuaXNobWVudCBmb3Ig
dGhlIHVuaXQgYXQgdGhlIGZyb250IG9mIHRoZSByZXBsZW5pc2htZW50CisgICAgICAgICAqIHF1
ZXVlIGlzIGR1ZS4gSWYgaXQgaXMgc3VjaCB1bml0IHRoYXQgd2UganVzdCByZW1vdmVkLCB3ZSBt
YXkKICAgICAgICAgICogbmVlZCB0byByZXByb2dyYW0gdGhlIHRpbWVyLgogICAgICAgICAgKi8K
ICAgICAgICAgaWYgKCAhbGlzdF9lbXB0eShyZXBscSkgKQpAQCAtNTU2LDcgKzU1Niw3IEBAIHJl
cGxxX3JlbW92ZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBydF91bml0ICpz
dmMpCiAKIC8qCiAgKiBJbnNlcnQgc3ZjIHdpdGggYnVkZ2V0IGluIFJ1blEgYWNjb3JkaW5nIHRv
IEVERjoKLSAqIHZjcHVzIHdpdGggc21hbGxlciBkZWFkbGluZXMgZ28gZmlyc3QuCisgKiB1bml0
cyB3aXRoIHNtYWxsZXIgZGVhZGxpbmVzIGdvIGZpcnN0LgogICogSW5zZXJ0IHN2YyB3aXRob3V0
IGJ1ZGdldCBpbiBEZXBsZXRlZFEgdW5zb3J0ZWQ7CiAgKi8KIHN0YXRpYyB2b2lkCkBAIC01NjYs
OCArNTY2LDggQEAgcnVucV9pbnNlcnQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1
Y3QgcnRfdW5pdCAqc3ZjKQogICAgIHN0cnVjdCBsaXN0X2hlYWQgKnJ1bnEgPSBydF9ydW5xKG9w
cyk7CiAKICAgICBBU1NFUlQoIHNwaW5faXNfbG9ja2VkKCZwcnYtPmxvY2spICk7Ci0gICAgQVNT
RVJUKCAhdmNwdV9vbl9xKHN2YykgKTsKLSAgICBBU1NFUlQoIHZjcHVfb25fcmVwbHEoc3ZjKSAp
OworICAgIEFTU0VSVCggIXVuaXRfb25fcShzdmMpICk7CisgICAgQVNTRVJUKCB1bml0X29uX3Jl
cGxxKHN2YykgKTsKIAogICAgIC8qIGFkZCBzdmMgdG8gcnVucSBpZiBzdmMgc3RpbGwgaGFzIGJ1
ZGdldCBvciBpdHMgZXh0cmF0aW1lIGlzIHNldCAqLwogICAgIGlmICggc3ZjLT5jdXJfYnVkZ2V0
ID4gMCB8fApAQCAtNTgzLDcgKzU4Myw3IEBAIHJlcGxxX2luc2VydChjb25zdCBzdHJ1Y3Qgc2No
ZWR1bGVyICpvcHMsIHN0cnVjdCBydF91bml0ICpzdmMpCiAgICAgc3RydWN0IGxpc3RfaGVhZCAq
cmVwbHEgPSBydF9yZXBscShvcHMpOwogICAgIHN0cnVjdCBydF9wcml2YXRlICpwcnYgPSBydF9w
cml2KG9wcyk7CiAKLSAgICBBU1NFUlQoICF2Y3B1X29uX3JlcGxxKHN2YykgKTsKKyAgICBBU1NF
UlQoICF1bml0X29uX3JlcGxxKHN2YykgKTsKIAogICAgIC8qCiAgICAgICogVGhlIHRpbWVyIG1h
eSBiZSByZS1wcm9ncmFtbWVkIGlmIHN2YyBpcyBpbnNlcnRlZApAQCAtNjA2LDEyICs2MDYsMTIg
QEAgcmVwbHFfcmVpbnNlcnQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgcnRf
dW5pdCAqc3ZjKQogICAgIHN0cnVjdCBydF91bml0ICpyZWFybV9zdmMgPSBzdmM7CiAgICAgYm9v
bF90IHJlYXJtID0gMDsKIAotICAgIEFTU0VSVCggdmNwdV9vbl9yZXBscShzdmMpICk7CisgICAg
QVNTRVJUKCB1bml0X29uX3JlcGxxKHN2YykgKTsKIAogICAgIC8qCiAgICAgICogSWYgc3ZjIHdh
cyBhdCB0aGUgZnJvbnQgb2YgdGhlIHJlcGxlbmlzaG1lbnQgcXVldWUsIHdlIGNlcnRhaW5seQog
ICAgICAqIG5lZWQgdG8gcmUtcHJvZ3JhbSB0aGUgdGltZXIsIGFuZCB3ZSB3YW50IHRvIHVzZSB0
aGUgZGVhZGxpbmUgb2YKLSAgICAgKiB0aGUgdmNwdSB3aGljaCBpcyBub3cgYXQgdGhlIGZyb250
IG9mIHRoZSBxdWV1ZSAod2hpY2ggbWF5IHN0aWxsCisgICAgICogdGhlIHVuaXQgd2hpY2ggaXMg
bm93IGF0IHRoZSBmcm9udCBvZiB0aGUgcXVldWUgKHdoaWNoIG1heSBzdGlsbAogICAgICAqIGJl
IHN2YyBvciBub3QpLgogICAgICAqCiAgICAgICogV2UgbWF5IGFsc28gbmVlZCB0byByZS1wcm9n
cmFtLCBpZiBzdmMgaGFzIGJlZW4gcHV0IGF0IHRoZSBmcm9udApAQCAtNjMxLDI0ICs2MzEsMjMg
QEAgcmVwbHFfcmVpbnNlcnQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgcnRf
dW5pdCAqc3ZjKQogfQogCiAvKgotICogUGljayBhIHZhbGlkIHJlc291cmNlIGZvciB0aGUgdmNw
dSB2YwotICogVmFsaWQgcmVzb3VyY2Ugb2YgYSB2Y3B1IGlzIGludGVzZWN0aW9uIG9mIHZjcHUn
cyBhZmZpbml0eQorICogUGljayBhIHZhbGlkIHJlc291cmNlIGZvciB0aGUgdW5pdCB2YworICog
VmFsaWQgcmVzb3VyY2Ugb2YgYW4gdW5pdCBpcyBpbnRlc2VjdGlvbiBvZiB1bml0J3MgYWZmaW5p
dHkKICAqIGFuZCBhdmFpbGFibGUgcmVzb3VyY2VzCiAgKi8KIHN0YXRpYyBzdHJ1Y3Qgc2NoZWRf
cmVzb3VyY2UgKgogcnRfcmVzX3BpY2soY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBjb25z
dCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIHsKLSAgICBzdHJ1Y3QgdmNwdSAqdmMgPSB1bml0
LT52Y3B1X2xpc3Q7CiAgICAgY3B1bWFza190IGNwdXM7CiAgICAgY3B1bWFza190ICpvbmxpbmU7
CiAgICAgaW50IGNwdTsKIAotICAgIG9ubGluZSA9IGNwdXBvb2xfZG9tYWluX2NwdW1hc2sodmMt
PmRvbWFpbik7CisgICAgb25saW5lID0gY3B1cG9vbF9kb21haW5fY3B1bWFzayh1bml0LT5kb21h
aW4pOwogICAgIGNwdW1hc2tfYW5kKCZjcHVzLCBvbmxpbmUsIHVuaXQtPmNwdV9oYXJkX2FmZmlu
aXR5KTsKIAotICAgIGNwdSA9IGNwdW1hc2tfdGVzdF9jcHUodmMtPnByb2Nlc3NvciwgJmNwdXMp
Ci0gICAgICAgICAgICA/IHZjLT5wcm9jZXNzb3IKLSAgICAgICAgICAgIDogY3B1bWFza19jeWNs
ZSh2Yy0+cHJvY2Vzc29yLCAmY3B1cyk7CisgICAgY3B1ID0gY3B1bWFza190ZXN0X2NwdShzY2hl
ZF91bml0X21hc3Rlcih1bml0KSwgJmNwdXMpCisgICAgICAgICAgICA/IHNjaGVkX3VuaXRfbWFz
dGVyKHVuaXQpCisgICAgICAgICAgICA6IGNwdW1hc2tfY3ljbGUoc2NoZWRfdW5pdF9tYXN0ZXIo
dW5pdCksICZjcHVzKTsKICAgICBBU1NFUlQoICFjcHVtYXNrX2VtcHR5KCZjcHVzKSAmJiBjcHVt
YXNrX3Rlc3RfY3B1KGNwdSwgJmNwdXMpICk7CiAKICAgICByZXR1cm4gZ2V0X3NjaGVkX3Jlcyhj
cHUpOwpAQCAtNzM2LDcgKzczNSw3IEBAIHJ0X3N3aXRjaF9zY2hlZChzdHJ1Y3Qgc2NoZWR1bGVy
ICpuZXdfb3BzLCB1bnNpZ25lZCBpbnQgY3B1LAogICAgIHN0cnVjdCBydF9wcml2YXRlICpwcnYg
PSBydF9wcml2KG5ld19vcHMpOwogICAgIHN0cnVjdCBydF91bml0ICpzdmMgPSB2ZGF0YTsKIAot
ICAgIEFTU0VSVCghcGRhdGEgJiYgc3ZjICYmIGlzX2lkbGVfdmNwdShzdmMtPnZjcHUpKTsKKyAg
ICBBU1NFUlQoIXBkYXRhICYmIHN2YyAmJiBpc19pZGxlX3VuaXQoc3ZjLT51bml0KSk7CiAKICAg
ICAvKgogICAgICAqIFdlIGFyZSBob2xkaW5nIHRoZSBydW5xdWV1ZSBsb2NrIGFscmVhZHkgKGl0
J3MgYmVlbiB0YWtlbiBpbgpAQCAtNzYwLDcgKzc1OSw3IEBAIHJ0X3N3aXRjaF9zY2hlZChzdHJ1
Y3Qgc2NoZWR1bGVyICpuZXdfb3BzLCB1bnNpZ25lZCBpbnQgY3B1LAogICAgICAgICBkcHJpbnRr
KFhFTkxPR19ERUJVRywgIlJURFM6IHRpbWVyIGluaXRpYWxpemVkIG9uIGNwdSAldVxuIiwgY3B1
KTsKICAgICB9CiAKLSAgICBpZGxlX3ZjcHVbY3B1XS0+c2NoZWRfdW5pdC0+cHJpdiA9IHZkYXRh
OworICAgIHNjaGVkX2lkbGVfdW5pdChjcHUpLT5wcml2ID0gdmRhdGE7CiAKICAgICByZXR1cm4g
JnBydi0+bG9jazsKIH0KQEAgLTg0MCwxMCArODM5LDkgQEAgcnRfZnJlZV9kb21kYXRhKGNvbnN0
IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgdm9pZCAqZGF0YSkKIHN0YXRpYyB2b2lkICoKIHJ0X2Fs
bG9jX3VkYXRhKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX3VuaXQg
KnVuaXQsIHZvaWQgKmRkKQogewotICAgIHN0cnVjdCB2Y3B1ICp2YyA9IHVuaXQtPnZjcHVfbGlz
dDsKICAgICBzdHJ1Y3QgcnRfdW5pdCAqc3ZjOwogCi0gICAgLyogQWxsb2NhdGUgcGVyLVZDUFUg
aW5mbyAqLworICAgIC8qIEFsbG9jYXRlIHBlci1VTklUIGluZm8gKi8KICAgICBzdmMgPSB4emFs
bG9jKHN0cnVjdCBydF91bml0KTsKICAgICBpZiAoIHN2YyA9PSBOVUxMICkKICAgICAgICAgcmV0
dXJuIE5VTEw7CkBAIC04NTIsMTMgKzg1MCwxMyBAQCBydF9hbGxvY191ZGF0YShjb25zdCBzdHJ1
Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0LCB2b2lkICpkZCkKICAg
ICBJTklUX0xJU1RfSEVBRCgmc3ZjLT5yZXBscV9lbGVtKTsKICAgICBzdmMtPmZsYWdzID0gMFU7
CiAgICAgc3ZjLT5zZG9tID0gZGQ7Ci0gICAgc3ZjLT52Y3B1ID0gdmM7CisgICAgc3ZjLT51bml0
ID0gdW5pdDsKICAgICBzdmMtPmxhc3Rfc3RhcnQgPSAwOwogCiAgICAgX19zZXRfYml0KF9fUlRE
U19leHRyYXRpbWUsICZzdmMtPmZsYWdzKTsKICAgICBzdmMtPnByaW9yaXR5X2xldmVsID0gMDsK
ICAgICBzdmMtPnBlcmlvZCA9IFJURFNfREVGQVVMVF9QRVJJT0Q7Ci0gICAgaWYgKCAhaXNfaWRs
ZV92Y3B1KHZjKSApCisgICAgaWYgKCAhaXNfaWRsZV91bml0KHVuaXQpICkKICAgICAgICAgc3Zj
LT5idWRnZXQgPSBSVERTX0RFRkFVTFRfQlVER0VUOwogCiAgICAgU0NIRURfU1RBVF9DUkFOSyh1
bml0X2FsbG9jKTsKQEAgLTg3OCwyMiArODc2LDIwIEBAIHJ0X2ZyZWVfdWRhdGEoY29uc3Qgc3Ry
dWN0IHNjaGVkdWxlciAqb3BzLCB2b2lkICpwcml2KQogICogSXQgaXMgY2FsbGVkIGluIHNjaGVk
X21vdmVfZG9tYWluKCkgYW5kIHNjaGVkX2luaXRfdmNwdQogICogaW4gc2NoZWR1bGUuYy4KICAq
IFdoZW4gbW92ZSBhIGRvbWFpbiB0byBhIG5ldyBjcHVwb29sLgotICogSXQgaW5zZXJ0cyB2Y3B1
cyBvZiBtb3ZpbmcgZG9tYWluIHRvIHRoZSBzY2hlZHVsZXIncyBSdW5RIGluCisgKiBJdCBpbnNl
cnRzIHVuaXRzIG9mIG1vdmluZyBkb21haW4gdG8gdGhlIHNjaGVkdWxlcidzIFJ1blEgaW4KICAq
IGRlc3QuIGNwdXBvb2wuCiAgKi8KIHN0YXRpYyB2b2lkCiBydF91bml0X2luc2VydChjb25zdCBz
dHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogewotICAgIHN0
cnVjdCB2Y3B1ICp2YyA9IHVuaXQtPnZjcHVfbGlzdDsKICAgICBzdHJ1Y3QgcnRfdW5pdCAqc3Zj
ID0gcnRfdW5pdCh1bml0KTsKICAgICBzX3RpbWVfdCBub3c7CiAgICAgc3BpbmxvY2tfdCAqbG9j
azsKIAotICAgIEJVR19PTiggaXNfaWRsZV92Y3B1KHZjKSApOworICAgIEJVR19PTiggaXNfaWRs
ZV91bml0KHVuaXQpICk7CiAKLSAgICAvKiBUaGlzIGlzIHNhZmUgYmVjYXVzZSB2YyBpc24ndCB5
ZXQgYmVpbmcgc2NoZWR1bGVkICovCi0gICAgdW5pdC0+cmVzID0gcnRfcmVzX3BpY2sob3BzLCB1
bml0KTsKLSAgICB2Yy0+cHJvY2Vzc29yID0gdW5pdC0+cmVzLT5tYXN0ZXJfY3B1OworICAgIC8q
IFRoaXMgaXMgc2FmZSBiZWNhdXNlIHVuaXQgaXNuJ3QgeWV0IGJlaW5nIHNjaGVkdWxlZCAqLwor
ICAgIHNjaGVkX3NldF9yZXModW5pdCwgcnRfcmVzX3BpY2sob3BzLCB1bml0KSk7CiAKICAgICBs
b2NrID0gdW5pdF9zY2hlZHVsZV9sb2NrX2lycSh1bml0KTsKIApAQCAtOTAxLDcgKzg5Nyw3IEBA
IHJ0X3VuaXRfaW5zZXJ0KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVk
X3VuaXQgKnVuaXQpCiAgICAgaWYgKCBub3cgPj0gc3ZjLT5jdXJfZGVhZGxpbmUgKQogICAgICAg
ICBydF91cGRhdGVfZGVhZGxpbmUobm93LCBzdmMpOwogCi0gICAgaWYgKCAhdmNwdV9vbl9xKHN2
YykgJiYgdmNwdV9ydW5uYWJsZSh2YykgKQorICAgIGlmICggIXVuaXRfb25fcShzdmMpICYmIHVu
aXRfcnVubmFibGUodW5pdCkgKQogICAgIHsKICAgICAgICAgcmVwbHFfaW5zZXJ0KG9wcywgc3Zj
KTsKIApAQCAtOTI4LDEwICs5MjQsMTAgQEAgcnRfdW5pdF9yZW1vdmUoY29uc3Qgc3RydWN0IHNj
aGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKICAgICBCVUdfT04oIHNkb20g
PT0gTlVMTCApOwogCiAgICAgbG9jayA9IHVuaXRfc2NoZWR1bGVfbG9ja19pcnEodW5pdCk7Ci0g
ICAgaWYgKCB2Y3B1X29uX3Eoc3ZjKSApCisgICAgaWYgKCB1bml0X29uX3Eoc3ZjKSApCiAgICAg
ICAgIHFfcmVtb3ZlKHN2Yyk7CiAKLSAgICBpZiAoIHZjcHVfb25fcmVwbHEoc3ZjKSApCisgICAg
aWYgKCB1bml0X29uX3JlcGxxKHN2YykgKQogICAgICAgICByZXBscV9yZW1vdmUob3BzLHN2Yyk7
CiAKICAgICB1bml0X3NjaGVkdWxlX3VubG9ja19pcnEobG9jaywgdW5pdCk7CkBAIC05NDUsOCAr
OTQxLDggQEAgYnVybl9idWRnZXQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qg
cnRfdW5pdCAqc3ZjLCBzX3RpbWVfdCBub3cpCiB7CiAgICAgc190aW1lX3QgZGVsdGE7CiAKLSAg
ICAvKiBkb24ndCBidXJuIGJ1ZGdldCBmb3IgaWRsZSBWQ1BVICovCi0gICAgaWYgKCBpc19pZGxl
X3ZjcHUoc3ZjLT52Y3B1KSApCisgICAgLyogZG9uJ3QgYnVybiBidWRnZXQgZm9yIGlkbGUgVU5J
VCAqLworICAgIGlmICggaXNfaWRsZV91bml0KHN2Yy0+dW5pdCkgKQogICAgICAgICByZXR1cm47
CiAKICAgICAvKiBidXJuIGF0IG5hbm9zZWNvbmRzIGxldmVsICovCkBAIC05ODMsMTQgKzk3OSwx
NCBAQCBidXJuX2J1ZGdldChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBydF91
bml0ICpzdmMsIHNfdGltZV90IG5vdykKICAgICAvKiBUUkFDRSAqLwogICAgIHsKICAgICAgICAg
c3RydWN0IF9fcGFja2VkIHsKLSAgICAgICAgICAgIHVuc2lnbmVkIHZjcHU6MTYsIGRvbToxNjsK
KyAgICAgICAgICAgIHVuc2lnbmVkIHVuaXQ6MTYsIGRvbToxNjsKICAgICAgICAgICAgIHVpbnQ2
NF90IGN1cl9idWRnZXQ7CiAgICAgICAgICAgICBpbnQgZGVsdGE7CiAgICAgICAgICAgICB1bnNp
Z25lZCBwcmlvcml0eV9sZXZlbDsKICAgICAgICAgICAgIGJvb2wgaGFzX2V4dHJhdGltZTsKICAg
ICAgICAgfSBkOwotICAgICAgICBkLmRvbSA9IHN2Yy0+dmNwdS0+ZG9tYWluLT5kb21haW5faWQ7
Ci0gICAgICAgIGQudmNwdSA9IHN2Yy0+dmNwdS0+dmNwdV9pZDsKKyAgICAgICAgZC5kb20gPSBz
dmMtPnVuaXQtPmRvbWFpbi0+ZG9tYWluX2lkOworICAgICAgICBkLnVuaXQgPSBzdmMtPnVuaXQt
PnVuaXRfaWQ7CiAgICAgICAgIGQuY3VyX2J1ZGdldCA9ICh1aW50NjRfdCkgc3ZjLT5jdXJfYnVk
Z2V0OwogICAgICAgICBkLmRlbHRhID0gZGVsdGE7CiAgICAgICAgIGQucHJpb3JpdHlfbGV2ZWwg
PSBzdmMtPnByaW9yaXR5X2xldmVsOwpAQCAtMTAyMCw5ICsxMDE2LDggQEAgcnVucV9waWNrKGNv
bnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgY29uc3QgY3B1bWFza190ICptYXNrKQogICAgICAg
ICBpdGVyX3N2YyA9IHFfZWxlbShpdGVyKTsKIAogICAgICAgICAvKiBtYXNrIGNwdV9oYXJkX2Fm
ZmluaXR5ICYgY3B1cG9vbCAmIG1hc2sgKi8KLSAgICAgICAgb25saW5lID0gY3B1cG9vbF9kb21h
aW5fY3B1bWFzayhpdGVyX3N2Yy0+dmNwdS0+ZG9tYWluKTsKLSAgICAgICAgY3B1bWFza19hbmQo
JmNwdV9jb21tb24sIG9ubGluZSwKLSAgICAgICAgICAgICAgICAgICAgaXRlcl9zdmMtPnZjcHUt
PnNjaGVkX3VuaXQtPmNwdV9oYXJkX2FmZmluaXR5KTsKKyAgICAgICAgb25saW5lID0gY3B1cG9v
bF9kb21haW5fY3B1bWFzayhpdGVyX3N2Yy0+dW5pdC0+ZG9tYWluKTsKKyAgICAgICAgY3B1bWFz
a19hbmQoJmNwdV9jb21tb24sIG9ubGluZSwgaXRlcl9zdmMtPnVuaXQtPmNwdV9oYXJkX2FmZmlu
aXR5KTsKICAgICAgICAgY3B1bWFza19hbmQoJmNwdV9jb21tb24sIG1hc2ssICZjcHVfY29tbW9u
KTsKICAgICAgICAgaWYgKCBjcHVtYXNrX2VtcHR5KCZjcHVfY29tbW9uKSApCiAgICAgICAgICAg
ICBjb250aW51ZTsKQEAgLTEwMzgsMTEgKzEwMzMsMTEgQEAgcnVucV9waWNrKGNvbnN0IHN0cnVj
dCBzY2hlZHVsZXIgKm9wcywgY29uc3QgY3B1bWFza190ICptYXNrKQogICAgICAgICBpZiggc3Zj
ICE9IE5VTEwgKQogICAgICAgICB7CiAgICAgICAgICAgICBzdHJ1Y3QgX19wYWNrZWQgewotICAg
ICAgICAgICAgICAgIHVuc2lnbmVkIHZjcHU6MTYsIGRvbToxNjsKKyAgICAgICAgICAgICAgICB1
bnNpZ25lZCB1bml0OjE2LCBkb206MTY7CiAgICAgICAgICAgICAgICAgdWludDY0X3QgY3VyX2Rl
YWRsaW5lLCBjdXJfYnVkZ2V0OwogICAgICAgICAgICAgfSBkOwotICAgICAgICAgICAgZC5kb20g
PSBzdmMtPnZjcHUtPmRvbWFpbi0+ZG9tYWluX2lkOwotICAgICAgICAgICAgZC52Y3B1ID0gc3Zj
LT52Y3B1LT52Y3B1X2lkOworICAgICAgICAgICAgZC5kb20gPSBzdmMtPnVuaXQtPmRvbWFpbi0+
ZG9tYWluX2lkOworICAgICAgICAgICAgZC51bml0ID0gc3ZjLT51bml0LT51bml0X2lkOwogICAg
ICAgICAgICAgZC5jdXJfZGVhZGxpbmUgPSAodWludDY0X3QpIHN2Yy0+Y3VyX2RlYWRsaW5lOwog
ICAgICAgICAgICAgZC5jdXJfYnVkZ2V0ID0gKHVpbnQ2NF90KSBzdmMtPmN1cl9idWRnZXQ7CiAg
ICAgICAgICAgICB0cmFjZV92YXIoVFJDX1JURFNfUlVOUV9QSUNLLCAxLApAQCAtMTA2Niw2ICsx
MDYxLDcgQEAgcnRfc2NoZWR1bGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzX3RpbWVf
dCBub3csIGJvb2xfdCB0YXNrbGV0X3dvcmtfc2NoZWQKICAgICBzdHJ1Y3QgcnRfdW5pdCAqY29u
c3Qgc2N1cnIgPSBydF91bml0KGN1cnJlbnQtPnNjaGVkX3VuaXQpOwogICAgIHN0cnVjdCBydF91
bml0ICpzbmV4dCA9IE5VTEw7CiAgICAgc3RydWN0IHRhc2tfc2xpY2UgcmV0ID0geyAubWlncmF0
ZWQgPSAwIH07CisgICAgc3RydWN0IHNjaGVkX3VuaXQgKmN1cnJ1bml0ID0gY3VycmVudC0+c2No
ZWRfdW5pdDsKIAogICAgIC8qIFRSQUNFICovCiAgICAgewpAQCAtMTA3NSw3ICsxMDcxLDcgQEAg
cnRfc2NoZWR1bGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzX3RpbWVfdCBub3csIGJv
b2xfdCB0YXNrbGV0X3dvcmtfc2NoZWQKICAgICAgICAgZC5jcHUgPSBjcHU7CiAgICAgICAgIGQu
dGFza2xldCA9IHRhc2tsZXRfd29ya19zY2hlZHVsZWQ7CiAgICAgICAgIGQudGlja2xlZCA9IGNw
dW1hc2tfdGVzdF9jcHUoY3B1LCAmcHJ2LT50aWNrbGVkKTsKLSAgICAgICAgZC5pZGxlID0gaXNf
aWRsZV92Y3B1KGN1cnJlbnQpOworICAgICAgICBkLmlkbGUgPSBpc19pZGxlX3VuaXQoY3VycnVu
aXQpOwogICAgICAgICB0cmFjZV92YXIoVFJDX1JURFNfU0NIRURVTEUsIDEsCiAgICAgICAgICAg
ICAgICAgICBzaXplb2YoZCksCiAgICAgICAgICAgICAgICAgICAodW5zaWduZWQgY2hhciAqKSZk
KTsKQEAgLTEwODQsNzIgKzEwODAsNzAgQEAgcnRfc2NoZWR1bGUoY29uc3Qgc3RydWN0IHNjaGVk
dWxlciAqb3BzLCBzX3RpbWVfdCBub3csIGJvb2xfdCB0YXNrbGV0X3dvcmtfc2NoZWQKICAgICAv
KiBjbGVhciB0aWNrZWQgYml0IG5vdyB0aGF0IHdlJ3ZlIGJlZW4gc2NoZWR1bGVkICovCiAgICAg
Y3B1bWFza19jbGVhcl9jcHUoY3B1LCAmcHJ2LT50aWNrbGVkKTsKIAotICAgIC8qIGJ1cm5fYnVk
Z2V0IHdvdWxkIHJldHVybiBmb3IgSURMRSBWQ1BVICovCisgICAgLyogYnVybl9idWRnZXQgd291
bGQgcmV0dXJuIGZvciBJRExFIFVOSVQgKi8KICAgICBidXJuX2J1ZGdldChvcHMsIHNjdXJyLCBu
b3cpOwogCiAgICAgaWYgKCB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkICkKICAgICB7CiAgICAgICAg
IHRyYWNlX3ZhcihUUkNfUlREU19TQ0hFRF9UQVNLTEVULCAxLCAwLCAgTlVMTCk7Ci0gICAgICAg
IHNuZXh0ID0gcnRfdW5pdChpZGxlX3ZjcHVbY3B1XS0+c2NoZWRfdW5pdCk7CisgICAgICAgIHNu
ZXh0ID0gcnRfdW5pdChzY2hlZF9pZGxlX3VuaXQoY3B1KSk7CiAgICAgfQogICAgIGVsc2UKICAg
ICB7CiAgICAgICAgIHNuZXh0ID0gcnVucV9waWNrKG9wcywgY3B1bWFza19vZihjcHUpKTsKICAg
ICAgICAgaWYgKCBzbmV4dCA9PSBOVUxMICkKLSAgICAgICAgICAgIHNuZXh0ID0gcnRfdW5pdChp
ZGxlX3ZjcHVbY3B1XS0+c2NoZWRfdW5pdCk7CisgICAgICAgICAgICBzbmV4dCA9IHJ0X3VuaXQo
c2NoZWRfaWRsZV91bml0KGNwdSkpOwogCiAgICAgICAgIC8qIGlmIHNjdXJyIGhhcyBoaWdoZXIg
cHJpb3JpdHkgYW5kIGJ1ZGdldCwgc3RpbGwgcGljayBzY3VyciAqLwotICAgICAgICBpZiAoICFp
c19pZGxlX3ZjcHUoY3VycmVudCkgJiYKLSAgICAgICAgICAgICB2Y3B1X3J1bm5hYmxlKGN1cnJl
bnQpICYmCisgICAgICAgIGlmICggIWlzX2lkbGVfdW5pdChjdXJydW5pdCkgJiYKKyAgICAgICAg
ICAgICB1bml0X3J1bm5hYmxlKGN1cnJ1bml0KSAmJgogICAgICAgICAgICAgIHNjdXJyLT5jdXJf
YnVkZ2V0ID4gMCAmJgotICAgICAgICAgICAgICggaXNfaWRsZV92Y3B1KHNuZXh0LT52Y3B1KSB8
fAotICAgICAgICAgICAgICAgY29tcGFyZV92Y3B1X3ByaW9yaXR5KHNjdXJyLCBzbmV4dCkgPiAw
ICkgKQorICAgICAgICAgICAgICggaXNfaWRsZV91bml0KHNuZXh0LT51bml0KSB8fAorICAgICAg
ICAgICAgICAgY29tcGFyZV91bml0X3ByaW9yaXR5KHNjdXJyLCBzbmV4dCkgPiAwICkgKQogICAg
ICAgICAgICAgc25leHQgPSBzY3VycjsKICAgICB9CiAKICAgICBpZiAoIHNuZXh0ICE9IHNjdXJy
ICYmCi0gICAgICAgICAhaXNfaWRsZV92Y3B1KGN1cnJlbnQpICYmCi0gICAgICAgICB2Y3B1X3J1
bm5hYmxlKGN1cnJlbnQpICkKKyAgICAgICAgICFpc19pZGxlX3VuaXQoY3VycnVuaXQpICYmCisg
ICAgICAgICB1bml0X3J1bm5hYmxlKGN1cnJ1bml0KSApCiAgICAgICAgIF9fc2V0X2JpdChfX1JU
RFNfZGVsYXllZF9ydW5xX2FkZCwgJnNjdXJyLT5mbGFncyk7CiAKICAgICBzbmV4dC0+bGFzdF9z
dGFydCA9IG5vdzsKLSAgICByZXQudGltZSA9ICAtMTsgLyogaWYgYW4gaWRsZSB2Y3B1IGlzIHBp
Y2tlZCAqLwotICAgIGlmICggIWlzX2lkbGVfdmNwdShzbmV4dC0+dmNwdSkgKQorICAgIHJldC50
aW1lID0gIC0xOyAvKiBpZiBhbiBpZGxlIHVuaXQgaXMgcGlja2VkICovCisgICAgaWYgKCAhaXNf
aWRsZV91bml0KHNuZXh0LT51bml0KSApCiAgICAgewogICAgICAgICBpZiAoIHNuZXh0ICE9IHNj
dXJyICkKICAgICAgICAgewogICAgICAgICAgICAgcV9yZW1vdmUoc25leHQpOwogICAgICAgICAg
ICAgX19zZXRfYml0KF9fUlREU19zY2hlZHVsZWQsICZzbmV4dC0+ZmxhZ3MpOwogICAgICAgICB9
Ci0gICAgICAgIGlmICggc25leHQtPnZjcHUtPnByb2Nlc3NvciAhPSBjcHUgKQorICAgICAgICBp
ZiAoIHNjaGVkX3VuaXRfbWFzdGVyKHNuZXh0LT51bml0KSAhPSBjcHUgKQogICAgICAgICB7Ci0g
ICAgICAgICAgICBzbmV4dC0+dmNwdS0+cHJvY2Vzc29yID0gY3B1OwotICAgICAgICAgICAgc25l
eHQtPnZjcHUtPnNjaGVkX3VuaXQtPnJlcyA9IGdldF9zY2hlZF9yZXMoY3B1KTsKKyAgICAgICAg
ICAgIHNjaGVkX3NldF9yZXMoc25leHQtPnVuaXQsIGdldF9zY2hlZF9yZXMoY3B1KSk7CiAgICAg
ICAgICAgICByZXQubWlncmF0ZWQgPSAxOwogICAgICAgICB9CiAgICAgICAgIHJldC50aW1lID0g
c25leHQtPmN1cl9idWRnZXQ7IC8qIGludm9rZSB0aGUgc2NoZWR1bGVyIG5leHQgdGltZSAqLwog
ICAgIH0KLSAgICByZXQudGFzayA9IHNuZXh0LT52Y3B1LT5zY2hlZF91bml0OworICAgIHJldC50
YXNrID0gc25leHQtPnVuaXQ7CiAKICAgICByZXR1cm4gcmV0OwogfQogCiAvKgotICogUmVtb3Zl
IFZDUFUgZnJvbSBSdW5RCisgKiBSZW1vdmUgVU5JVCBmcm9tIFJ1blEKICAqIFRoZSBsb2NrIGlz
IGFscmVhZHkgZ3JhYmJlZCBpbiBzY2hlZHVsZS5jLCBubyBuZWVkIHRvIGxvY2sgaGVyZQogICov
CiBzdGF0aWMgdm9pZAogcnRfdW5pdF9zbGVlcChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMs
IHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogewotICAgIHN0cnVjdCB2Y3B1ICp2YyA9IHVuaXQt
PnZjcHVfbGlzdDsKICAgICBzdHJ1Y3QgcnRfdW5pdCAqIGNvbnN0IHN2YyA9IHJ0X3VuaXQodW5p
dCk7CiAKLSAgICBCVUdfT04oIGlzX2lkbGVfdmNwdSh2YykgKTsKKyAgICBCVUdfT04oIGlzX2lk
bGVfdW5pdCh1bml0KSApOwogICAgIFNDSEVEX1NUQVRfQ1JBTksodW5pdF9zbGVlcCk7CiAKLSAg
ICBpZiAoIGN1cnJfb25fY3B1KHZjLT5wcm9jZXNzb3IpID09IHVuaXQgKQotICAgICAgICBjcHVf
cmFpc2Vfc29mdGlycSh2Yy0+cHJvY2Vzc29yLCBTQ0hFRFVMRV9TT0ZUSVJRKTsKLSAgICBlbHNl
IGlmICggdmNwdV9vbl9xKHN2YykgKQorICAgIGlmICggY3Vycl9vbl9jcHUoc2NoZWRfdW5pdF9t
YXN0ZXIodW5pdCkpID09IHVuaXQgKQorICAgICAgICBjcHVfcmFpc2Vfc29mdGlycShzY2hlZF91
bml0X21hc3Rlcih1bml0KSwgU0NIRURVTEVfU09GVElSUSk7CisgICAgZWxzZSBpZiAoIHVuaXRf
b25fcShzdmMpICkKICAgICB7CiAgICAgICAgIHFfcmVtb3ZlKHN2Yyk7CiAgICAgICAgIHJlcGxx
X3JlbW92ZShvcHMsIHN2Yyk7CkBAIC0xMTU5LDIwICsxMTUzLDIwIEBAIHJ0X3VuaXRfc2xlZXAo
Y29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIH0K
IAogLyoKLSAqIFBpY2sgYSBjcHUgd2hlcmUgdG8gcnVuIGEgdmNwdSwKLSAqIHBvc3NpYmx5IGtp
Y2tpbmcgb3V0IHRoZSB2Y3B1IHJ1bm5pbmcgdGhlcmUKKyAqIFBpY2sgYSBjcHUgd2hlcmUgdG8g
cnVuIGFuIHVuaXQsCisgKiBwb3NzaWJseSBraWNraW5nIG91dCB0aGUgdW5pdCBydW5uaW5nIHRo
ZXJlCiAgKiBDYWxsZWQgYnkgd2FrZSgpIGFuZCBjb250ZXh0X3NhdmVkKCkKICAqIFdlIGhhdmUg
YSBydW5uaW5nIGNhbmRpZGF0ZSBoZXJlLCB0aGUga2ljayBsb2dpYyBpczoKICAqIEFtb25nIGFs
bCB0aGUgY3B1cyB0aGF0IGFyZSB3aXRoaW4gdGhlIGNwdSBhZmZpbml0eQogICogMSkgaWYgdGhl
cmUgYXJlIGFueSBpZGxlIENQVXMsIGtpY2sgb25lLgogICAgICAgRm9yIGNhY2hlIGJlbmVmaXQs
IHdlIGNoZWNrIG5ldy0+Y3B1IGFzIGZpcnN0CiAgKiAyKSBub3cgYWxsIHBjcHVzIGFyZSBidXN5
OwotICogICAgYW1vbmcgYWxsIHRoZSBydW5uaW5nIHZjcHVzLCBwaWNrIGxvd2VzdCBwcmlvcml0
eSBvbmUKKyAqICAgIGFtb25nIGFsbCB0aGUgcnVubmluZyB1bml0cywgcGljayBsb3dlc3QgcHJp
b3JpdHkgb25lCiAgKiAgICBpZiBzbmV4dCBoYXMgaGlnaGVyIHByaW9yaXR5LCBraWNrIGl0Lgog
ICoKICAqIFRPRE86Ci0gKiAxKSB3aGF0IGlmIHRoZXNlIHR3byB2Y3B1cyBiZWxvbmdzIHRvIHRo
ZSBzYW1lIGRvbWFpbj8KLSAqICAgIHJlcGxhY2UgYSB2Y3B1IGJlbG9uZ2luZyB0byB0aGUgc2Ft
ZSBkb21haW4gaW50cm9kdWNlcyBtb3JlIG92ZXJoZWFkCisgKiAxKSB3aGF0IGlmIHRoZXNlIHR3
byB1bml0cyBiZWxvbmdzIHRvIHRoZSBzYW1lIGRvbWFpbj8KKyAqICAgIHJlcGxhY2UgYW4gdW5p
dCBiZWxvbmdpbmcgdG8gdGhlIHNhbWUgZG9tYWluIGludHJvZHVjZXMgbW9yZSBvdmVyaGVhZAog
ICoKICAqIGxvY2sgaXMgZ3JhYmJlZCBiZWZvcmUgY2FsbGluZyB0aGlzIGZ1bmN0aW9uCiAgKi8K
QEAgLTExODAsMTggKzExNzQsMTggQEAgc3RhdGljIHZvaWQKIHJ1bnFfdGlja2xlKGNvbnN0IHN0
cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHJ0X3VuaXQgKm5ldykKIHsKICAgICBzdHJ1Y3Qg
cnRfcHJpdmF0ZSAqcHJ2ID0gcnRfcHJpdihvcHMpOwotICAgIHN0cnVjdCBydF91bml0ICpsYXRl
c3RfZGVhZGxpbmVfdmNwdSA9IE5VTEw7IC8qIGxvd2VzdCBwcmlvcml0eSAqLworICAgIHN0cnVj
dCBydF91bml0ICpsYXRlc3RfZGVhZGxpbmVfdW5pdCA9IE5VTEw7IC8qIGxvd2VzdCBwcmlvcml0
eSAqLwogICAgIHN0cnVjdCBydF91bml0ICppdGVyX3N2YzsKLSAgICBzdHJ1Y3QgdmNwdSAqaXRl
cl92YzsKKyAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCAqaXRlcl91bml0OwogICAgIGludCBjcHUgPSAw
LCBjcHVfdG9fdGlja2xlID0gMDsKICAgICBjcHVtYXNrX3Qgbm90X3RpY2tsZWQ7CiAgICAgY3B1
bWFza190ICpvbmxpbmU7CiAKLSAgICBpZiAoIG5ldyA9PSBOVUxMIHx8IGlzX2lkbGVfdmNwdShu
ZXctPnZjcHUpICkKKyAgICBpZiAoIG5ldyA9PSBOVUxMIHx8IGlzX2lkbGVfdW5pdChuZXctPnVu
aXQpICkKICAgICAgICAgcmV0dXJuOwogCi0gICAgb25saW5lID0gY3B1cG9vbF9kb21haW5fY3B1
bWFzayhuZXctPnZjcHUtPmRvbWFpbik7Ci0gICAgY3B1bWFza19hbmQoJm5vdF90aWNrbGVkLCBv
bmxpbmUsIG5ldy0+dmNwdS0+c2NoZWRfdW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHkpOworICAgIG9u
bGluZSA9IGNwdXBvb2xfZG9tYWluX2NwdW1hc2sobmV3LT51bml0LT5kb21haW4pOworICAgIGNw
dW1hc2tfYW5kKCZub3RfdGlja2xlZCwgb25saW5lLCBuZXctPnVuaXQtPmNwdV9oYXJkX2FmZmlu
aXR5KTsKICAgICBjcHVtYXNrX2FuZG5vdCgmbm90X3RpY2tsZWQsICZub3RfdGlja2xlZCwgJnBy
di0+dGlja2xlZCk7CiAKICAgICAvKgpAQCAtMTE5OSwzMSArMTE5MywzMSBAQCBydW5xX3RpY2ts
ZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBydF91bml0ICpuZXcpCiAgICAg
ICogICAgRm9yIGNhY2hlIGJlbmVmaXQsd2UgZmlyc3Qgc2VhcmNoIG5ldy0+Y3B1LgogICAgICAq
ICAgIFRoZSBzYW1lIGxvb3AgYWxzbyBmaW5kIHRoZSBvbmUgd2l0aCBsb3dlc3QgcHJpb3JpdHku
CiAgICAgICovCi0gICAgY3B1ID0gY3B1bWFza190ZXN0X29yX2N5Y2xlKG5ldy0+dmNwdS0+cHJv
Y2Vzc29yLCAmbm90X3RpY2tsZWQpOworICAgIGNwdSA9IGNwdW1hc2tfdGVzdF9vcl9jeWNsZShz
Y2hlZF91bml0X21hc3RlcihuZXctPnVuaXQpLCAmbm90X3RpY2tsZWQpOwogICAgIHdoaWxlICgg
Y3B1IT0gbnJfY3B1X2lkcyApCiAgICAgewotICAgICAgICBpdGVyX3ZjID0gY3Vycl9vbl9jcHUo
Y3B1KS0+dmNwdV9saXN0OwotICAgICAgICBpZiAoIGlzX2lkbGVfdmNwdShpdGVyX3ZjKSApCisg
ICAgICAgIGl0ZXJfdW5pdCA9IGN1cnJfb25fY3B1KGNwdSk7CisgICAgICAgIGlmICggaXNfaWRs
ZV91bml0KGl0ZXJfdW5pdCkgKQogICAgICAgICB7CiAgICAgICAgICAgICBTQ0hFRF9TVEFUX0NS
QU5LKHRpY2tsZWRfaWRsZV9jcHUpOwogICAgICAgICAgICAgY3B1X3RvX3RpY2tsZSA9IGNwdTsK
ICAgICAgICAgICAgIGdvdG8gb3V0OwogICAgICAgICB9Ci0gICAgICAgIGl0ZXJfc3ZjID0gcnRf
dW5pdChpdGVyX3ZjLT5zY2hlZF91bml0KTsKLSAgICAgICAgaWYgKCBsYXRlc3RfZGVhZGxpbmVf
dmNwdSA9PSBOVUxMIHx8Ci0gICAgICAgICAgICAgY29tcGFyZV92Y3B1X3ByaW9yaXR5KGl0ZXJf
c3ZjLCBsYXRlc3RfZGVhZGxpbmVfdmNwdSkgPCAwICkKLSAgICAgICAgICAgIGxhdGVzdF9kZWFk
bGluZV92Y3B1ID0gaXRlcl9zdmM7CisgICAgICAgIGl0ZXJfc3ZjID0gcnRfdW5pdChpdGVyX3Vu
aXQpOworICAgICAgICBpZiAoIGxhdGVzdF9kZWFkbGluZV91bml0ID09IE5VTEwgfHwKKyAgICAg
ICAgICAgICBjb21wYXJlX3VuaXRfcHJpb3JpdHkoaXRlcl9zdmMsIGxhdGVzdF9kZWFkbGluZV91
bml0KSA8IDAgKQorICAgICAgICAgICAgbGF0ZXN0X2RlYWRsaW5lX3VuaXQgPSBpdGVyX3N2YzsK
IAogICAgICAgICBjcHVtYXNrX2NsZWFyX2NwdShjcHUsICZub3RfdGlja2xlZCk7CiAgICAgICAg
IGNwdSA9IGNwdW1hc2tfY3ljbGUoY3B1LCAmbm90X3RpY2tsZWQpOwogICAgIH0KIAotICAgIC8q
IDIpIGNhbmRpY2F0ZSBoYXMgaGlnaGVyIHByaW9yaXR5LCBraWNrIG91dCBsb3dlc3QgcHJpb3Jp
dHkgdmNwdSAqLwotICAgIGlmICggbGF0ZXN0X2RlYWRsaW5lX3ZjcHUgIT0gTlVMTCAmJgotICAg
ICAgICAgY29tcGFyZV92Y3B1X3ByaW9yaXR5KGxhdGVzdF9kZWFkbGluZV92Y3B1LCBuZXcpIDwg
MCApCisgICAgLyogMikgY2FuZGljYXRlIGhhcyBoaWdoZXIgcHJpb3JpdHksIGtpY2sgb3V0IGxv
d2VzdCBwcmlvcml0eSB1bml0ICovCisgICAgaWYgKCBsYXRlc3RfZGVhZGxpbmVfdW5pdCAhPSBO
VUxMICYmCisgICAgICAgICBjb21wYXJlX3VuaXRfcHJpb3JpdHkobGF0ZXN0X2RlYWRsaW5lX3Vu
aXQsIG5ldykgPCAwICkKICAgICB7CiAgICAgICAgIFNDSEVEX1NUQVRfQ1JBTksodGlja2xlZF9i
dXN5X2NwdSk7Ci0gICAgICAgIGNwdV90b190aWNrbGUgPSBsYXRlc3RfZGVhZGxpbmVfdmNwdS0+
dmNwdS0+cHJvY2Vzc29yOworICAgICAgICBjcHVfdG9fdGlja2xlID0gc2NoZWRfdW5pdF9tYXN0
ZXIobGF0ZXN0X2RlYWRsaW5lX3VuaXQtPnVuaXQpOwogICAgICAgICBnb3RvIG91dDsKICAgICB9
CiAKQEAgLTEyNDksMzUgKzEyNDMsMzQgQEAgcnVucV90aWNrbGUoY29uc3Qgc3RydWN0IHNjaGVk
dWxlciAqb3BzLCBzdHJ1Y3QgcnRfdW5pdCAqbmV3KQogfQogCiAvKgotICogU2hvdWxkIGFsd2F5
cyB3YWtlIHVwIHJ1bm5hYmxlIHZjcHUsIHB1dCBpdCBiYWNrIHRvIFJ1blEuCisgKiBTaG91bGQg
YWx3YXlzIHdha2UgdXAgcnVubmFibGUgdW5pdCwgcHV0IGl0IGJhY2sgdG8gUnVuUS4KICAqIENo
ZWNrIHByaW9yaXR5IHRvIHJhaXNlIGludGVycnVwdAogICogVGhlIGxvY2sgaXMgYWxyZWFkeSBn
cmFiYmVkIGluIHNjaGVkdWxlLmMsIG5vIG5lZWQgdG8gbG9jayBoZXJlCi0gKiBUT0RPOiB3aGF0
IGlmIHRoZXNlIHR3byB2Y3B1cyBiZWxvbmdzIHRvIHRoZSBzYW1lIGRvbWFpbj8KKyAqIFRPRE86
IHdoYXQgaWYgdGhlc2UgdHdvIHVuaXRzIGJlbG9uZ3MgdG8gdGhlIHNhbWUgZG9tYWluPwogICov
CiBzdGF0aWMgdm9pZAogcnRfdW5pdF93YWtlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywg
c3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiB7Ci0gICAgc3RydWN0IHZjcHUgKnZjID0gdW5pdC0+
dmNwdV9saXN0OwogICAgIHN0cnVjdCBydF91bml0ICogY29uc3Qgc3ZjID0gcnRfdW5pdCh1bml0
KTsKICAgICBzX3RpbWVfdCBub3c7CiAgICAgYm9vbF90IG1pc3NlZDsKIAotICAgIEJVR19PTigg
aXNfaWRsZV92Y3B1KHZjKSApOworICAgIEJVR19PTiggaXNfaWRsZV91bml0KHVuaXQpICk7CiAK
LSAgICBpZiAoIHVubGlrZWx5KGN1cnJfb25fY3B1KHZjLT5wcm9jZXNzb3IpID09IHVuaXQpICkK
KyAgICBpZiAoIHVubGlrZWx5KGN1cnJfb25fY3B1KHNjaGVkX3VuaXRfbWFzdGVyKHVuaXQpKSA9
PSB1bml0KSApCiAgICAgewogICAgICAgICBTQ0hFRF9TVEFUX0NSQU5LKHVuaXRfd2FrZV9ydW5u
aW5nKTsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIAogICAgIC8qIG9uIFJ1blEvRGVwbGV0ZWRR
LCBqdXN0IHVwZGF0ZSBpbmZvIGlzIG9rICovCi0gICAgaWYgKCB1bmxpa2VseSh2Y3B1X29uX3Eo
c3ZjKSkgKQorICAgIGlmICggdW5saWtlbHkodW5pdF9vbl9xKHN2YykpICkKICAgICB7CiAgICAg
ICAgIFNDSEVEX1NUQVRfQ1JBTksodW5pdF93YWtlX29ucnVucSk7CiAgICAgICAgIHJldHVybjsK
ICAgICB9CiAKLSAgICBpZiAoIGxpa2VseSh2Y3B1X3J1bm5hYmxlKHZjKSkgKQorICAgIGlmICgg
bGlrZWx5KHVuaXRfcnVubmFibGUodW5pdCkpICkKICAgICAgICAgU0NIRURfU1RBVF9DUkFOSyh1
bml0X3dha2VfcnVubmFibGUpOwogICAgIGVsc2UKICAgICAgICAgU0NIRURfU1RBVF9DUkFOSyh1
bml0X3dha2Vfbm90X3J1bm5hYmxlKTsKQEAgLTEyOTMsMTYgKzEyODYsMTYgQEAgcnRfdW5pdF93
YWtlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQp
CiAgICAgICAgIHJ0X3VwZGF0ZV9kZWFkbGluZShub3csIHN2Yyk7CiAKICAgICAvKgotICAgICAq
IElmIGNvbnRleHQgaGFzbid0IGJlZW4gc2F2ZWQgZm9yIHRoaXMgdmNwdSB5ZXQsIHdlIGNhbid0
IHB1dCBpdCBvbgorICAgICAqIElmIGNvbnRleHQgaGFzbid0IGJlZW4gc2F2ZWQgZm9yIHRoaXMg
dW5pdCB5ZXQsIHdlIGNhbid0IHB1dCBpdCBvbgogICAgICAqIHRoZSBydW4tcXVldWUvZGVwbGV0
ZWQtcXVldWUuIEluc3RlYWQsIHdlIHNldCB0aGUgYXBwcm9wcmlhdGUgZmxhZywKLSAgICAgKiB0
aGUgdmNwdSB3aWxsIGJlIHB1dCBiYWNrIG9uIHF1ZXVlIGFmdGVyIHRoZSBjb250ZXh0IGhhcyBi
ZWVuIHNhdmVkCisgICAgICogdGhlIHVuaXQgd2lsbCBiZSBwdXQgYmFjayBvbiBxdWV1ZSBhZnRl
ciB0aGUgY29udGV4dCBoYXMgYmVlbiBzYXZlZAogICAgICAqIChpbiBydF9jb250ZXh0X3NhdmUo
KSkuCiAgICAgICovCiAgICAgaWYgKCB1bmxpa2VseShzdmMtPmZsYWdzICYgUlREU19zY2hlZHVs
ZWQpICkKICAgICB7CiAgICAgICAgIF9fc2V0X2JpdChfX1JURFNfZGVsYXllZF9ydW5xX2FkZCwg
JnN2Yy0+ZmxhZ3MpOwogICAgICAgICAvKgotICAgICAgICAgKiBUaGUgdmNwdSBpcyB3YWtpbmcg
dXAgYWxyZWFkeSwgYW5kIHdlIGRpZG4ndCBldmVuIGhhZCB0aGUgdGltZSB0bworICAgICAgICAg
KiBUaGUgdW5pdCBpcyB3YWtpbmcgdXAgYWxyZWFkeSwgYW5kIHdlIGRpZG4ndCBldmVuIGhhZCB0
aGUgdGltZSB0bwogICAgICAgICAgKiByZW1vdmUgaXRzIG5leHQgcmVwbGVuaXNobWVudCBldmVu
dCBmcm9tIHRoZSByZXBsZW5pc2htZW50IHF1ZXVlCiAgICAgICAgICAqIHdoZW4gaXQgYmxvY2tl
ZCEgTm8gYmlnIGRlYWwuIElmIHdlIGRpZCBub3QgbWlzcyB0aGUgZGVhZGxpbmUgaW4KICAgICAg
ICAgICogdGhlIG1lYW50aW1lLCBsZXQncyBqdXN0IGxlYXZlIGl0IHRoZXJlLiBJZiB3ZSBkaWQs
IGxldCdzIHJlbW92ZSBpdApAQCAtMTMyMywyMiArMTMxNiwyMSBAQCBydF91bml0X3dha2UoY29u
c3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIAogLyoK
ICAqIHNjdXJyIGhhcyBmaW5pc2hlZCBjb250ZXh0IHN3aXRjaCwgaW5zZXJ0IGl0IGJhY2sgdG8g
dGhlIFJ1blEsCi0gKiBhbmQgdGhlbiBwaWNrIHRoZSBoaWdoZXN0IHByaW9yaXR5IHZjcHUgZnJv
bSBydW5xIHRvIHJ1bgorICogYW5kIHRoZW4gcGljayB0aGUgaGlnaGVzdCBwcmlvcml0eSB1bml0
IGZyb20gcnVucSB0byBydW4KICAqLwogc3RhdGljIHZvaWQKIHJ0X2NvbnRleHRfc2F2ZWQoY29u
c3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIHsKLSAg
ICBzdHJ1Y3QgdmNwdSAqdmMgPSB1bml0LT52Y3B1X2xpc3Q7CiAgICAgc3RydWN0IHJ0X3VuaXQg
KnN2YyA9IHJ0X3VuaXQodW5pdCk7CiAgICAgc3BpbmxvY2tfdCAqbG9jayA9IHVuaXRfc2NoZWR1
bGVfbG9ja19pcnEodW5pdCk7CiAKICAgICBfX2NsZWFyX2JpdChfX1JURFNfc2NoZWR1bGVkLCAm
c3ZjLT5mbGFncyk7Ci0gICAgLyogbm90IGluc2VydCBpZGxlIHZjcHUgdG8gcnVucSAqLwotICAg
IGlmICggaXNfaWRsZV92Y3B1KHZjKSApCisgICAgLyogbm90IGluc2VydCBpZGxlIHVuaXQgdG8g
cnVucSAqLworICAgIGlmICggaXNfaWRsZV91bml0KHVuaXQpICkKICAgICAgICAgZ290byBvdXQ7
CiAKICAgICBpZiAoIF9fdGVzdF9hbmRfY2xlYXJfYml0KF9fUlREU19kZWxheWVkX3J1bnFfYWRk
LCAmc3ZjLT5mbGFncykgJiYKLSAgICAgICAgIGxpa2VseSh2Y3B1X3J1bm5hYmxlKHZjKSkgKQor
ICAgICAgICAgbGlrZWx5KHVuaXRfcnVubmFibGUodW5pdCkpICkKICAgICB7CiAgICAgICAgIHJ1
bnFfaW5zZXJ0KG9wcywgc3ZjKTsKICAgICAgICAgcnVucV90aWNrbGUob3BzLCBzdmMpOwpAQCAt
MTM1MSw3ICsxMzQzLDcgQEAgb3V0OgogfQogCiAvKgotICogc2V0L2dldCBlYWNoIHZjcHUgaW5m
byBvZiBlYWNoIGRvbWFpbgorICogc2V0L2dldCBlYWNoIHVuaXQgaW5mbyBvZiBlYWNoIGRvbWFp
bgogICovCiBzdGF0aWMgaW50CiBydF9kb21fY250bCgKQEAgLTEzNjEsNyArMTM1Myw3IEBAIHJ0
X2RvbV9jbnRsKAogewogICAgIHN0cnVjdCBydF9wcml2YXRlICpwcnYgPSBydF9wcml2KG9wcyk7
CiAgICAgc3RydWN0IHJ0X3VuaXQgKnN2YzsKLSAgICBzdHJ1Y3QgdmNwdSAqdjsKKyAgICBzdHJ1
Y3Qgc2NoZWRfdW5pdCAqdW5pdDsKICAgICB1bnNpZ25lZCBsb25nIGZsYWdzOwogICAgIGludCBy
YyA9IDA7CiAgICAgc3RydWN0IHhlbl9kb21jdGxfc2NoZWRwYXJhbV92Y3B1IGxvY2FsX3NjaGVk
OwpAQCAtMTM4Miw5ICsxMzc0LDkgQEAgcnRfZG9tX2NudGwoCiAgICAgICAgICAgICBicmVhazsK
ICAgICAgICAgfQogICAgICAgICBzcGluX2xvY2tfaXJxc2F2ZSgmcHJ2LT5sb2NrLCBmbGFncyk7
Ci0gICAgICAgIGZvcl9lYWNoX3ZjcHUgKCBkLCB2ICkKKyAgICAgICAgZm9yX2VhY2hfc2NoZWRf
dW5pdCAoIGQsIHVuaXQgKQogICAgICAgICB7Ci0gICAgICAgICAgICBzdmMgPSBydF91bml0KHYt
PnNjaGVkX3VuaXQpOworICAgICAgICAgICAgc3ZjID0gcnRfdW5pdCh1bml0KTsKICAgICAgICAg
ICAgIHN2Yy0+cGVyaW9kID0gTUlDUk9TRUNTKG9wLT51LnJ0ZHMucGVyaW9kKTsgLyogdHJhbnNm
ZXIgdG8gbmFub3NlYyAqLwogICAgICAgICAgICAgc3ZjLT5idWRnZXQgPSBNSUNST1NFQ1Mob3At
PnUucnRkcy5idWRnZXQpOwogICAgICAgICB9CkBAIC0xNDUyLDcgKzE0NDQsNyBAQCBydF9kb21f
Y250bCgKICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgfQogICAgICAgICBpZiAoICFy
YyApCi0gICAgICAgICAgICAvKiBub3RpZnkgdXBwZXIgY2FsbGVyIGhvdyBtYW55IHZjcHVzIGhh
dmUgYmVlbiBwcm9jZXNzZWQuICovCisgICAgICAgICAgICAvKiBub3RpZnkgdXBwZXIgY2FsbGVy
IGhvdyBtYW55IHVuaXRzIGhhdmUgYmVlbiBwcm9jZXNzZWQuICovCiAgICAgICAgICAgICBvcC0+
dS52Lm5yX3ZjcHVzID0gaW5kZXg7CiAgICAgICAgIGJyZWFrOwogICAgIH0KQEAgLTE0NjEsNyAr
MTQ1Myw3IEBAIHJ0X2RvbV9jbnRsKAogfQogCiAvKgotICogVGhlIHJlcGxlbmlzaG1lbnQgdGlt
ZXIgaGFuZGxlciBwaWNrcyB2Y3B1cworICogVGhlIHJlcGxlbmlzaG1lbnQgdGltZXIgaGFuZGxl
ciBwaWNrcyB1bml0cwogICogZnJvbSB0aGUgcmVwbHEgYW5kIGRvZXMgdGhlIGFjdHVhbCByZXBs
ZW5pc2htZW50LgogICovCiBzdGF0aWMgdm9pZCByZXBsX3RpbWVyX2hhbmRsZXIodm9pZCAqZGF0
YSl7CkBAIC0xNDc5LDcgKzE0NzEsNyBAQCBzdGF0aWMgdm9pZCByZXBsX3RpbWVyX2hhbmRsZXIo
dm9pZCAqZGF0YSl7CiAgICAgbm93ID0gTk9XKCk7CiAKICAgICAvKgotICAgICAqIERvIHRoZSBy
ZXBsZW5pc2htZW50IGFuZCBtb3ZlIHJlcGxlbmlzaGVkIHZjcHVzCisgICAgICogRG8gdGhlIHJl
cGxlbmlzaG1lbnQgYW5kIG1vdmUgcmVwbGVuaXNoZWQgdW5pdHMKICAgICAgKiB0byB0aGUgdGVt
cG9yYXJ5IGxpc3QgdG8gdGlja2xlLgogICAgICAqIElmIHN2YyBpcyBvbiBydW4gcXVldWUsIHdl
IG5lZWQgdG8gcHV0IGl0IGF0CiAgICAgICogdGhlIGNvcnJlY3QgcGxhY2Ugc2luY2UgaXRzIGRl
YWRsaW5lIGNoYW5nZXMuCkBAIC0xNDk1LDcgKzE0ODcsNyBAQCBzdGF0aWMgdm9pZCByZXBsX3Rp
bWVyX2hhbmRsZXIodm9pZCAqZGF0YSl7CiAgICAgICAgIHJ0X3VwZGF0ZV9kZWFkbGluZShub3cs
IHN2Yyk7CiAgICAgICAgIGxpc3RfYWRkKCZzdmMtPnJlcGxxX2VsZW0sICZ0bXBfcmVwbHEpOwog
Ci0gICAgICAgIGlmICggdmNwdV9vbl9xKHN2YykgKQorICAgICAgICBpZiAoIHVuaXRfb25fcShz
dmMpICkKICAgICAgICAgewogICAgICAgICAgICAgcV9yZW1vdmUoc3ZjKTsKICAgICAgICAgICAg
IHJ1bnFfaW5zZXJ0KG9wcywgc3ZjKTsKQEAgLTE1MDMsMjYgKzE0OTUsMjYgQEAgc3RhdGljIHZv
aWQgcmVwbF90aW1lcl9oYW5kbGVyKHZvaWQgKmRhdGEpewogICAgIH0KIAogICAgIC8qCi0gICAg
ICogSXRlcmF0ZSB0aHJvdWdoIHRoZSBsaXN0IG9mIHVwZGF0ZWQgdmNwdXMuCi0gICAgICogSWYg
YW4gdXBkYXRlZCB2Y3B1IGlzIHJ1bm5pbmcsIHRpY2tsZSB0aGUgaGVhZCBvZiB0aGUKKyAgICAg
KiBJdGVyYXRlIHRocm91Z2ggdGhlIGxpc3Qgb2YgdXBkYXRlZCB1bml0cy4KKyAgICAgKiBJZiBh
biB1cGRhdGVkIHVuaXQgaXMgcnVubmluZywgdGlja2xlIHRoZSBoZWFkIG9mIHRoZQogICAgICAq
IHJ1bnF1ZXVlIGlmIGl0IGhhcyBhIGhpZ2hlciBwcmlvcml0eS4KLSAgICAgKiBJZiBhbiB1cGRh
dGVkIHZjcHUgd2FzIGRlcGxldGVkIGFuZCBvbiB0aGUgcnVucXVldWUsIHRpY2tsZSBpdC4KLSAg
ICAgKiBGaW5hbGx5LCByZWluc2VydCB0aGUgdmNwdXMgYmFjayB0byByZXBsZW5pc2hlbWVudCBl
dmVudHMgbGlzdC4KKyAgICAgKiBJZiBhbiB1cGRhdGVkIHVuaXQgd2FzIGRlcGxldGVkIGFuZCBv
biB0aGUgcnVucXVldWUsIHRpY2tsZSBpdC4KKyAgICAgKiBGaW5hbGx5LCByZWluc2VydCB0aGUg
dW5pdHMgYmFjayB0byByZXBsZW5pc2hlbWVudCBldmVudHMgbGlzdC4KICAgICAgKi8KICAgICBs
aXN0X2Zvcl9lYWNoX3NhZmUgKCBpdGVyLCB0bXAsICZ0bXBfcmVwbHEgKQogICAgIHsKICAgICAg
ICAgc3ZjID0gcmVwbHFfZWxlbShpdGVyKTsKIAotICAgICAgICBpZiAoIGN1cnJfb25fY3B1KHN2
Yy0+dmNwdS0+cHJvY2Vzc29yKSA9PSBzdmMtPnZjcHUtPnNjaGVkX3VuaXQgJiYKKyAgICAgICAg
aWYgKCBjdXJyX29uX2NwdShzY2hlZF91bml0X21hc3RlcihzdmMtPnVuaXQpKSA9PSBzdmMtPnVu
aXQgJiYKICAgICAgICAgICAgICAhbGlzdF9lbXB0eShydW5xKSApCiAgICAgICAgIHsKICAgICAg
ICAgICAgIHN0cnVjdCBydF91bml0ICpuZXh0X29uX3J1bnEgPSBxX2VsZW0ocnVucS0+bmV4dCk7
CiAKLSAgICAgICAgICAgIGlmICggY29tcGFyZV92Y3B1X3ByaW9yaXR5KHN2YywgbmV4dF9vbl9y
dW5xKSA8IDAgKQorICAgICAgICAgICAgaWYgKCBjb21wYXJlX3VuaXRfcHJpb3JpdHkoc3ZjLCBu
ZXh0X29uX3J1bnEpIDwgMCApCiAgICAgICAgICAgICAgICAgcnVucV90aWNrbGUob3BzLCBuZXh0
X29uX3J1bnEpOwogICAgICAgICB9CiAgICAgICAgIGVsc2UgaWYgKCBfX3Rlc3RfYW5kX2NsZWFy
X2JpdChfX1JURFNfZGVwbGV0ZWQsICZzdmMtPmZsYWdzKSAmJgotICAgICAgICAgICAgICAgICAg
dmNwdV9vbl9xKHN2YykgKQorICAgICAgICAgICAgICAgICAgdW5pdF9vbl9xKHN2YykgKQogICAg
ICAgICAgICAgcnVucV90aWNrbGUob3BzLCBzdmMpOwogCiAgICAgICAgIGxpc3RfZGVsKCZzdmMt
PnJlcGxxX2VsZW0pOwpAQCAtMTUzMCw3ICsxNTIyLDcgQEAgc3RhdGljIHZvaWQgcmVwbF90aW1l
cl9oYW5kbGVyKHZvaWQgKmRhdGEpewogICAgIH0KIAogICAgIC8qCi0gICAgICogSWYgdGhlcmUg
YXJlIHZjcHVzIGxlZnQgaW4gdGhlIHJlcGxlbmlzaG1lbnQgZXZlbnQgbGlzdCwKKyAgICAgKiBJ
ZiB0aGVyZSBhcmUgdW5pdHMgbGVmdCBpbiB0aGUgcmVwbGVuaXNobWVudCBldmVudCBsaXN0LAog
ICAgICAqIHNldCB0aGUgbmV4dCByZXBsZW5pc2htZW50IHRvIGhhcHBlbiBhdCB0aGUgZGVhZGxp
bmUgb2YKICAgICAgKiB0aGUgb25lIGluIHRoZSBmcm9udC4KICAgICAgKi8KLS0gCjIuMTYuNAoK
Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZl
bCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlz
dHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

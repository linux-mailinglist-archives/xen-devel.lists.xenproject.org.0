Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 987D214A66C
	for <lists+xen-devel@lfdr.de>; Mon, 27 Jan 2020 15:43:41 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iw5ZR-0003CG-Hh; Mon, 27 Jan 2020 14:40:57 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=x5IB=3Q=citrix.com=andrew.cooper3@srs-us1.protection.inumbo.net>)
 id 1iw5ZQ-0003BN-2B
 for xen-devel@lists.xenproject.org; Mon, 27 Jan 2020 14:40:56 +0000
X-Inumbo-ID: 046a07e0-4113-11ea-b833-bc764e2007e4
Received: from esa4.hc3370-68.iphmx.com (unknown [216.71.155.144])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 046a07e0-4113-11ea-b833-bc764e2007e4;
 Mon, 27 Jan 2020 14:40:52 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1580136052;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version;
 bh=75uIekn1UFqgP1IYkhjUCMtjBDzTaPOeRFCIvL3sHNM=;
 b=bW5dNs2SDzxvfy+V1xov7UEk1Bn1YWMY5NxtIomKezhw/fK6u6ninfxc
 gk9ORwJY76fYySEneV2t+AdWyZWblDBQPHegeDVLKsnzTiRfQ3q/ww2ar
 LbO9HCxowzIoasmk5E/e+5POftLsR1VTZu5WGkrQoQHq9utNxWoKUr+3C k=;
Authentication-Results: esa4.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=andrew.cooper3@citrix.com;
 spf=Pass smtp.mailfrom=Andrew.Cooper3@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa4.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 andrew.cooper3@citrix.com) identity=pra;
 client-ip=162.221.158.21; receiver=esa4.hc3370-68.iphmx.com;
 envelope-from="Andrew.Cooper3@citrix.com";
 x-sender="andrew.cooper3@citrix.com";
 x-conformance=sidf_compatible
Received-SPF: Pass (esa4.hc3370-68.iphmx.com: domain of
 Andrew.Cooper3@citrix.com designates 162.221.158.21 as
 permitted sender) identity=mailfrom;
 client-ip=162.221.158.21; receiver=esa4.hc3370-68.iphmx.com;
 envelope-from="Andrew.Cooper3@citrix.com";
 x-sender="Andrew.Cooper3@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83
 ip4:168.245.78.127 ~all"
Received-SPF: None (esa4.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa4.hc3370-68.iphmx.com;
 envelope-from="Andrew.Cooper3@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: 99rYCcF8qyJOxufjPfepmMptk0ytFEYI3QS1wUt3t5VmIC9m3/3hdCEJk5M2vmMoW1w/qIRTUw
 JtH5NgXueo07xcWDGqAQ8ZNKQuyNiIEHc0IAOPqiQlXQXL6EzowGvNiVtYYkAw/JlxpCvLHPLR
 3s2EcIJ30fKB6FLcZXZEtQ5jcbiDm0pcodQM4Dckhnq7eDdofShRXIzFEy68ngd9jYJgLF6ELT
 XdVvPlBL5mVqmoFmVcLDDMxtiW0VuVG53latCiVqjrt571wB1A92L+3RCvLlT5nUW5JBf3G7sg
 auw=
X-SBRS: 2.7
X-MesageID: 12093209
X-Ironport-Server: esa4.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.70,370,1574139600"; d="scan'208";a="12093209"
From: Andrew Cooper <andrew.cooper3@citrix.com>
To: Xen-devel <xen-devel@lists.xenproject.org>
Date: Mon, 27 Jan 2020 14:34:40 +0000
Message-ID: <20200127143444.25538-14-andrew.cooper3@citrix.com>
X-Mailer: git-send-email 2.11.0
In-Reply-To: <20200127143444.25538-1-andrew.cooper3@citrix.com>
References: <20200127143444.25538-1-andrew.cooper3@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v2 13/17] libxc/restore: Handle X86_{CPUID,
 MSR}_DATA records
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>, Wei Liu <wl@xen.org>,
 Ian Jackson <Ian.Jackson@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

Rm9yIG5vdywgdGhlIGRhdGEgYXJlIGp1c3Qgc3Rhc2hlZCwgYW5kIGRpc2NhcmRlZCBhdCB0aGUg
ZW5kLgoKQSBmdXR1cmUgY2hhbmdlIHdpbGwgcmVzdG9yZSB0aGUgZGF0YSwgb25jZSBsaWJ4bCBo
YXMgYmVlbiBhZGp1c3RlZCB0byBhdm9pZApjbG9iYmVyaW5nIHRoZSBkYXRhLgoKTm8gZnVuY3Rp
b25hbCBjaGFuZ2UuCgpTaWduZWQtb2ZmLWJ5OiBBbmRyZXcgQ29vcGVyIDxhbmRyZXcuY29vcGVy
M0BjaXRyaXguY29tPgpBY2tlZC1ieTogSWFuIEphY2tzb24gPGlhbi5qYWNrc29uQGV1LmNpdHJp
eC5jb20+Ci0tLQpDQzogSWFuIEphY2tzb24gPElhbi5KYWNrc29uQGNpdHJpeC5jb20+CkNDOiBX
ZWkgTGl1IDx3bEB4ZW4ub3JnPgotLS0KIHRvb2xzL2xpYnhjL3hjX3NyX2NvbW1vbi5oICAgICAg
ICAgIHwgMTAgKysrKysrKysrKwogdG9vbHMvbGlieGMveGNfc3JfY29tbW9uX3g4Ni5jICAgICAg
fCA0MCArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiB0b29scy9saWJ4Yy94
Y19zcl9jb21tb25feDg2LmggICAgICB8IDE0ICsrKysrKysrKysrKysKIHRvb2xzL2xpYnhjL3hj
X3NyX3Jlc3RvcmVfeDg2X2h2bS5jIHwgIDkgKysrKysrKysrCiB0b29scy9saWJ4Yy94Y19zcl9y
ZXN0b3JlX3g4Nl9wdi5jICB8ICA5ICsrKysrKysrKwogNSBmaWxlcyBjaGFuZ2VkLCA4MiBpbnNl
cnRpb25zKCspCgpkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGMveGNfc3JfY29tbW9uLmggYi90b29s
cy9saWJ4Yy94Y19zcl9jb21tb24uaAppbmRleCBmZDdmYjY3MzA1Li43NzQyMjYwNjkwIDEwMDY0
NAotLS0gYS90b29scy9saWJ4Yy94Y19zcl9jb21tb24uaAorKysgYi90b29scy9saWJ4Yy94Y19z
cl9jb21tb24uaApAQCAtMjk2LDYgKzI5NiwxNiBAQCBzdHJ1Y3QgeGNfc3JfY29udGV4dAogICAg
IHsKICAgICAgICAgc3RydWN0IC8qIHg4NiAqLwogICAgICAgICB7CisgICAgICAgICAgICAvKiBD
b21tb24gc2F2ZS9yZXN0b3JlIGRhdGEuICovCisgICAgICAgICAgICB1bmlvbgorICAgICAgICAg
ICAgeworICAgICAgICAgICAgICAgIHN0cnVjdAorICAgICAgICAgICAgICAgIHsKKyAgICAgICAg
ICAgICAgICAgICAgLyogWDg2X3tDUFVJRCxNU1J9X0RBVEEgYmxvYnMgZm9yIENQVSBQb2xpY3ku
ICovCisgICAgICAgICAgICAgICAgICAgIHN0cnVjdCB4Y19zcl9ibG9iIGNwdWlkLCBtc3I7Cisg
ICAgICAgICAgICAgICAgfSByZXN0b3JlOworICAgICAgICAgICAgfTsKKwogICAgICAgICAgICAg
c3RydWN0IC8qIHg4NiBQViBndWVzdC4gKi8KICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAg
ICAvKiA0IG9yIDg7IDMyIG9yIDY0IGJpdCBkb21haW4gKi8KZGlmZiAtLWdpdCBhL3Rvb2xzL2xp
YnhjL3hjX3NyX2NvbW1vbl94ODYuYyBiL3Rvb2xzL2xpYnhjL3hjX3NyX2NvbW1vbl94ODYuYwpp
bmRleCAwMTE2ODRkZjk3Li44OTgwMjk5ZTlhIDEwMDY0NAotLS0gYS90b29scy9saWJ4Yy94Y19z
cl9jb21tb25feDg2LmMKKysrIGIvdG9vbHMvbGlieGMveGNfc3JfY29tbW9uX3g4Ni5jCkBAIC00
Miw2ICs0Miw0NiBAQCBpbnQgaGFuZGxlX3g4Nl90c2NfaW5mbyhzdHJ1Y3QgeGNfc3JfY29udGV4
dCAqY3R4LCBzdHJ1Y3QgeGNfc3JfcmVjb3JkICpyZWMpCiAgICAgcmV0dXJuIDA7CiB9CiAKK2lu
dCBoYW5kbGVfeDg2X2NwdWlkX3BvbGljeShzdHJ1Y3QgeGNfc3JfY29udGV4dCAqY3R4LCBzdHJ1
Y3QgeGNfc3JfcmVjb3JkICpyZWMpCit7CisgICAgeGNfaW50ZXJmYWNlICp4Y2ggPSBjdHgtPnhj
aDsKKyAgICBpbnQgcmM7CisKKyAgICBpZiAoIHJlYy0+bGVuZ3RoID09IDAgfHwKKyAgICAgICAg
IHJlYy0+bGVuZ3RoICUgc2l6ZW9mKHhlbl9jcHVpZF9sZWFmX3QpICE9IDAgKQorICAgIHsKKyAg
ICAgICAgRVJST1IoIlg4Nl9DUFVJRF9QT0xJQ1kgc2l6ZSAldSBzaG91bGQgYmUgbXVsdGlwbGUg
b2YgJXp1IiwKKyAgICAgICAgICAgICAgcmVjLT5sZW5ndGgsIHNpemVvZih4ZW5fY3B1aWRfbGVh
Zl90KSk7CisgICAgICAgIHJldHVybiAtMTsKKyAgICB9CisKKyAgICByYyA9IHVwZGF0ZV9ibG9i
KCZjdHgtPng4Ni5yZXN0b3JlLmNwdWlkLCByZWMtPmRhdGEsIHJlYy0+bGVuZ3RoKTsKKyAgICBp
ZiAoIHJjICkKKyAgICAgICAgRVJST1IoIlVuYWJsZSB0byBhbGxvY2F0ZSAldSBieXRlcyBmb3Ig
WDg2X0NQVUlEX1BPTElDWSIsIHJlYy0+bGVuZ3RoKTsKKworICAgIHJldHVybiByYzsKK30KKwor
aW50IGhhbmRsZV94ODZfbXNyX3BvbGljeShzdHJ1Y3QgeGNfc3JfY29udGV4dCAqY3R4LCBzdHJ1
Y3QgeGNfc3JfcmVjb3JkICpyZWMpCit7CisgICAgeGNfaW50ZXJmYWNlICp4Y2ggPSBjdHgtPnhj
aDsKKyAgICBpbnQgcmM7CisKKyAgICBpZiAoIHJlYy0+bGVuZ3RoID09IDAgfHwKKyAgICAgICAg
IHJlYy0+bGVuZ3RoICUgc2l6ZW9mKHhlbl9tc3JfZW50cnlfdCkgIT0gMCApCisgICAgeworICAg
ICAgICBFUlJPUigiWDg2X01TUl9QT0xJQ1kgc2l6ZSAldSBzaG91bGQgYmUgbXVsdGlwbGUgb2Yg
JXp1IiwKKyAgICAgICAgICAgICAgcmVjLT5sZW5ndGgsIHNpemVvZih4ZW5fY3B1aWRfbGVhZl90
KSk7CisgICAgICAgIHJldHVybiAtMTsKKyAgICB9CisKKyAgICByYyA9IHVwZGF0ZV9ibG9iKCZj
dHgtPng4Ni5yZXN0b3JlLm1zciwgcmVjLT5kYXRhLCByZWMtPmxlbmd0aCk7CisgICAgaWYgKCBy
YyApCisgICAgICAgIEVSUk9SKCJVbmFibGUgdG8gYWxsb2NhdGUgJXUgYnl0ZXMgZm9yIFg4Nl9N
U1JfUE9MSUNZIiwgcmVjLT5sZW5ndGgpOworCisgICAgcmV0dXJuIHJjOworfQorCiAvKgogICog
TG9jYWwgdmFyaWFibGVzOgogICogbW9kZTogQwpkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGMveGNf
c3JfY29tbW9uX3g4Ni5oIGIvdG9vbHMvbGlieGMveGNfc3JfY29tbW9uX3g4Ni5oCmluZGV4IGVi
YzQzNTViZDEuLmM0NThjMWFhMzcgMTAwNjQ0Ci0tLSBhL3Rvb2xzL2xpYnhjL3hjX3NyX2NvbW1v
bl94ODYuaAorKysgYi90b29scy9saWJ4Yy94Y19zcl9jb21tb25feDg2LmgKQEAgLTE0LDYgKzE0
LDIwIEBAIGludCB3cml0ZV94ODZfdHNjX2luZm8oc3RydWN0IHhjX3NyX2NvbnRleHQgKmN0eCk7
CiAgKi8KIGludCBoYW5kbGVfeDg2X3RzY19pbmZvKHN0cnVjdCB4Y19zcl9jb250ZXh0ICpjdHgs
IHN0cnVjdCB4Y19zcl9yZWNvcmQgKnJlYyk7CiAKKy8qCisgKiBQYXJzZXMgYW4gWDg2X0NQVUlE
X1BPTElDWSByZWNvcmQgYW5kIHN0YXNoZXMgdGhlIGNvbnRlbnQgZm9yIGFwcGxpY2F0aW9uCisg
KiB3aGVuIGEgU1RBVElDX0RBVEFfRU5EIHJlY29yZCBpcyBlbmNvdW50ZXJlZC4KKyAqLworaW50
IGhhbmRsZV94ODZfY3B1aWRfcG9saWN5KHN0cnVjdCB4Y19zcl9jb250ZXh0ICpjdHgsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHhjX3NyX3JlY29yZCAqcmVjKTsKKworLyoK
KyAqIFBhcnNlcyBhbiBYODZfTVNSX1BPTElDWSByZWNvcmQgYW5kIHN0YXNoZXMgdGhlIGNvbnRl
bnQgZm9yIGFwcGxpY2F0aW9uCisgKiB3aGVuIGEgU1RBVElDX0RBVEFfRU5EIHJlY29yZCBpcyBl
bmNvdW50ZXJlZC4KKyAqLworaW50IGhhbmRsZV94ODZfbXNyX3BvbGljeShzdHJ1Y3QgeGNfc3Jf
Y29udGV4dCAqY3R4LAorICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgeGNfc3JfcmVj
b3JkICpyZWMpOworCiAjZW5kaWYKIC8qCiAgKiBMb2NhbCB2YXJpYWJsZXM6CmRpZmYgLS1naXQg
YS90b29scy9saWJ4Yy94Y19zcl9yZXN0b3JlX3g4Nl9odm0uYyBiL3Rvb2xzL2xpYnhjL3hjX3Ny
X3Jlc3RvcmVfeDg2X2h2bS5jCmluZGV4IDNmNzgyNDhmMzIuLmNlZjk5ZTAzOTcgMTAwNjQ0Ci0t
LSBhL3Rvb2xzL2xpYnhjL3hjX3NyX3Jlc3RvcmVfeDg2X2h2bS5jCisrKyBiL3Rvb2xzL2xpYnhj
L3hjX3NyX3Jlc3RvcmVfeDg2X2h2bS5jCkBAIC0xNzEsNiArMTcxLDEyIEBAIHN0YXRpYyBpbnQg
eDg2X2h2bV9wcm9jZXNzX3JlY29yZChzdHJ1Y3QgeGNfc3JfY29udGV4dCAqY3R4LAogICAgIGNh
c2UgUkVDX1RZUEVfSFZNX1BBUkFNUzoKICAgICAgICAgcmV0dXJuIGhhbmRsZV9odm1fcGFyYW1z
KGN0eCwgcmVjKTsKIAorICAgIGNhc2UgUkVDX1RZUEVfWDg2X0NQVUlEX1BPTElDWToKKyAgICAg
ICAgcmV0dXJuIGhhbmRsZV94ODZfY3B1aWRfcG9saWN5KGN0eCwgcmVjKTsKKworICAgIGNhc2Ug
UkVDX1RZUEVfWDg2X01TUl9QT0xJQ1k6CisgICAgICAgIHJldHVybiBoYW5kbGVfeDg2X21zcl9w
b2xpY3koY3R4LCByZWMpOworCiAgICAgZGVmYXVsdDoKICAgICAgICAgcmV0dXJuIFJFQ09SRF9O
T1RfUFJPQ0VTU0VEOwogICAgIH0KQEAgLTIyNyw2ICsyMzMsOSBAQCBzdGF0aWMgaW50IHg4Nl9o
dm1fY2xlYW51cChzdHJ1Y3QgeGNfc3JfY29udGV4dCAqY3R4KQogewogICAgIGZyZWUoY3R4LT54
ODYuaHZtLnJlc3RvcmUuY29udGV4dC5wdHIpOwogCisgICAgZnJlZShjdHgtPng4Ni5yZXN0b3Jl
LmNwdWlkLnB0cik7CisgICAgZnJlZShjdHgtPng4Ni5yZXN0b3JlLm1zci5wdHIpOworCiAgICAg
cmV0dXJuIDA7CiB9CiAKZGlmZiAtLWdpdCBhL3Rvb2xzL2xpYnhjL3hjX3NyX3Jlc3RvcmVfeDg2
X3B2LmMgYi90b29scy9saWJ4Yy94Y19zcl9yZXN0b3JlX3g4Nl9wdi5jCmluZGV4IDM3NTYyMjVi
ZTYuLjNhYWM0YmQ1MDIgMTAwNjQ0Ci0tLSBhL3Rvb2xzL2xpYnhjL3hjX3NyX3Jlc3RvcmVfeDg2
X3B2LmMKKysrIGIvdG9vbHMvbGlieGMveGNfc3JfcmVzdG9yZV94ODZfcHYuYwpAQCAtMTEwMiw2
ICsxMTAyLDEyIEBAIHN0YXRpYyBpbnQgeDg2X3B2X3Byb2Nlc3NfcmVjb3JkKHN0cnVjdCB4Y19z
cl9jb250ZXh0ICpjdHgsCiAgICAgY2FzZSBSRUNfVFlQRV9YODZfVFNDX0lORk86CiAgICAgICAg
IHJldHVybiBoYW5kbGVfeDg2X3RzY19pbmZvKGN0eCwgcmVjKTsKIAorICAgIGNhc2UgUkVDX1RZ
UEVfWDg2X0NQVUlEX1BPTElDWToKKyAgICAgICAgcmV0dXJuIGhhbmRsZV94ODZfY3B1aWRfcG9s
aWN5KGN0eCwgcmVjKTsKKworICAgIGNhc2UgUkVDX1RZUEVfWDg2X01TUl9QT0xJQ1k6CisgICAg
ICAgIHJldHVybiBoYW5kbGVfeDg2X21zcl9wb2xpY3koY3R4LCByZWMpOworCiAgICAgZGVmYXVs
dDoKICAgICAgICAgcmV0dXJuIFJFQ09SRF9OT1RfUFJPQ0VTU0VEOwogICAgIH0KQEAgLTExNzMs
NiArMTE3OSw5IEBAIHN0YXRpYyBpbnQgeDg2X3B2X2NsZWFudXAoc3RydWN0IHhjX3NyX2NvbnRl
eHQgKmN0eCkKICAgICBpZiAoIGN0eC0+eDg2LnB2Lm0ycCApCiAgICAgICAgIG11bm1hcChjdHgt
Png4Ni5wdi5tMnAsIGN0eC0+eDg2LnB2Lm5yX20ycF9mcmFtZXMgKiBQQUdFX1NJWkUpOwogCisg
ICAgZnJlZShjdHgtPng4Ni5yZXN0b3JlLmNwdWlkLnB0cik7CisgICAgZnJlZShjdHgtPng4Ni5y
ZXN0b3JlLm1zci5wdHIpOworCiAgICAgcmV0dXJuIDA7CiB9CiAKLS0gCjIuMTEuMAoKCl9fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWls
aW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVu
cHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

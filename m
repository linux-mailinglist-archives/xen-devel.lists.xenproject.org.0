Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id DC3EF2C468
	for <lists+xen-devel@lfdr.de>; Tue, 28 May 2019 12:36:10 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hVZQm-00061Y-7e; Tue, 28 May 2019 10:34:08 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=31/0=T4=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1hVZQD-0004rh-TP
 for xen-devel@lists.xenproject.org; Tue, 28 May 2019 10:33:33 +0000
X-Inumbo-ID: 071abf92-8134-11e9-8144-97777117baca
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 071abf92-8134-11e9-8144-97777117baca;
 Tue, 28 May 2019 10:33:27 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id A79BBB040;
 Tue, 28 May 2019 10:33:26 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Tue, 28 May 2019 12:32:52 +0200
Message-Id: <20190528103313.1343-40-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190528103313.1343-1-jgross@suse.com>
References: <20190528103313.1343-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH 39/60] x86: optimize loading of GDT at context
 switch
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Andrew Cooper <andrew.cooper3@citrix.com>,
 Wei Liu <wl@xen.org>, Jan Beulich <jbeulich@suse.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SW5zdGVhZCBvZiBkeW5hbWljYWxseSBkZWNpZGUgd2hldGhlciB0aGUgcHJldmlvdXMgdmNwdSB3
YXMgdXNpbmcgZnVsbApvciBkZWZhdWx0IEdEVCBqdXN0IGFkZCBhIHBlcmNwdSB2YXJpYWJsZSBm
b3IgdGhhdCBwdXJwb3NlLiBUaGlzIGF0Cm9uY2UgcmVtb3ZlcyB0aGUgbmVlZCBmb3IgdGVzdGlu
ZyB2Y3B1X2lkcyB0byBkaWZmZXIgdHdpY2UuCgpDYWNoZSB0aGUgbmVlZF9mdWxsX2dkdChuZCkg
dmFsdWUgaW4gYSBsb2NhbCB2YXJpYWJsZS4KClNpZ25lZC1vZmYtYnk6IEp1ZXJnZW4gR3Jvc3Mg
PGpncm9zc0BzdXNlLmNvbT4KUmV2aWV3ZWQtYnk6IEphbiBCZXVsaWNoIDxqYmV1bGljaEBzdXNl
LmNvbT4KLS0tClJGQyBWMjogbmV3IHBhdGNoIChzcGxpdCBmcm9tIHByZXZpb3VzIG9uZSkKVjE6
IGluaXQgcGVyY3B1IGZsYWcgYXQgY3B1IHN0YXJ0dXAKICAgIHJlbmFtZSB2YXJpYWJsZSAoSmFu
IEJldWxpY2gpCi0tLQogeGVuL2FyY2gveDg2L2NwdS9jb21tb24uYyAgfCAgMyArKysKIHhlbi9h
cmNoL3g4Ni9kb21haW4uYyAgICAgIHwgMTYgKysrKysrKysrKystLS0tLQogeGVuL2luY2x1ZGUv
YXNtLXg4Ni9kZXNjLmggfCAgMSArCiAzIGZpbGVzIGNoYW5nZWQsIDE1IGluc2VydGlvbnMoKyks
IDUgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L2NwdS9jb21tb24uYyBi
L3hlbi9hcmNoL3g4Ni9jcHUvY29tbW9uLmMKaW5kZXggMzNmNWQzMjU1Ny4uOGI5MDM1NmZlNSAx
MDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L2NwdS9jb21tb24uYworKysgYi94ZW4vYXJjaC94ODYv
Y3B1L2NvbW1vbi5jCkBAIC00OSw2ICs0OSw4IEBAIHVuc2lnbmVkIGludCB2YWRkcl9iaXRzIF9f
cmVhZF9tb3N0bHkgPSBWQUREUl9CSVRTOwogc3RhdGljIHVuc2lnbmVkIGludCBjbGVhcmVkX2Nh
cHNbTkNBUElOVFNdOwogc3RhdGljIHVuc2lnbmVkIGludCBmb3JjZWRfY2Fwc1tOQ0FQSU5UU107
CiAKK0RFRklORV9QRVJfQ1BVKGJvb2wsIGZ1bGxfZ2R0X2xvYWRlZCk7CisKIHZvaWQgX19pbml0
IHNldHVwX2NsZWFyX2NwdV9jYXAodW5zaWduZWQgaW50IGNhcCkKIHsKIAljb25zdCB1aW50MzJf
dCAqZGZzOwpAQCAtNzQ1LDYgKzc0Nyw3IEBAIHZvaWQgbG9hZF9zeXN0ZW1fdGFibGVzKHZvaWQp
CiAJCW9mZnNldG9mKHN0cnVjdCB0c3Nfc3RydWN0LCBfX2NhY2hlbGluZV9maWxsZXIpIC0gMSwK
IAkJU1lTX0RFU0NfdHNzX2J1c3kpOwogCisgICAgICAgIHBlcl9jcHUoZnVsbF9nZHRfbG9hZGVk
LCBjcHUpID0gZmFsc2U7CiAJbGdkdCgmZ2R0cik7CiAJbGlkdCgmaWR0cik7CiAJbHRyKFRTU19F
TlRSWSA8PCAzKTsKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9kb21haW4uYyBiL3hlbi9hcmNo
L3g4Ni9kb21haW4uYwppbmRleCBhZGMwNjE1NGVlLi45OGQyOTM5ZGFmIDEwMDY0NAotLS0gYS94
ZW4vYXJjaC94ODYvZG9tYWluLmMKKysrIGIveGVuL2FyY2gveDg2L2RvbWFpbi5jCkBAIC0xNjQ1
LDYgKzE2NDUsOCBAQCBzdGF0aWMgaW5saW5lIHZvaWQgbG9hZF9mdWxsX2dkdChjb25zdCBzdHJ1
Y3QgdmNwdSAqdiwgdW5zaWduZWQgaW50IGNwdSkKICAgICB9OwogCiAgICAgbGdkdCgmZ2R0X2Rl
c2MpOworCisgICAgcGVyX2NwdShmdWxsX2dkdF9sb2FkZWQsIGNwdSkgPSB0cnVlOwogfQogCiBz
dGF0aWMgaW5saW5lIHZvaWQgbG9hZF9kZWZhdWx0X2dkdChjb25zdCBzZWdfZGVzY190ICpnZHQs
IHVuc2lnbmVkIGludCBjcHUpCkBAIC0xNjU1LDYgKzE2NTcsOCBAQCBzdGF0aWMgaW5saW5lIHZv
aWQgbG9hZF9kZWZhdWx0X2dkdChjb25zdCBzZWdfZGVzY190ICpnZHQsIHVuc2lnbmVkIGludCBj
cHUpCiAgICAgfTsKIAogICAgIGxnZHQoJmdkdF9kZXNjKTsKKworICAgIHBlcl9jcHUoZnVsbF9n
ZHRfbG9hZGVkLCBjcHUpID0gZmFsc2U7CiB9CiAKIHN0YXRpYyB2b2lkIF9fY29udGV4dF9zd2l0
Y2godm9pZCkKQEAgLTE2NjUsNiArMTY2OSw3IEBAIHN0YXRpYyB2b2lkIF9fY29udGV4dF9zd2l0
Y2godm9pZCkKICAgICBzdHJ1Y3QgdmNwdSAgICAgICAgICAqbiA9IGN1cnJlbnQ7CiAgICAgc3Ry
dWN0IGRvbWFpbiAgICAgICAgKnBkID0gcC0+ZG9tYWluLCAqbmQgPSBuLT5kb21haW47CiAgICAg
c2VnX2Rlc2NfdCAgICAgICAgICAgKmdkdDsKKyAgICBib29sICAgICAgICAgICAgICAgICAgZnVs
bF9nZHQ7CiAKICAgICBBU1NFUlQocCAhPSBuKTsKICAgICBBU1NFUlQoIXZjcHVfY3B1X2RpcnR5
KG4pKTsKQEAgLTE3MDcsMTEgKzE3MTIsMTMgQEAgc3RhdGljIHZvaWQgX19jb250ZXh0X3N3aXRj
aCh2b2lkKQogICAgIGdkdCA9ICFpc19wdl8zMmJpdF9kb21haW4obmQpID8gcGVyX2NwdShnZHRf
dGFibGUsIGNwdSkgOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVyX2Nw
dShjb21wYXRfZ2R0X3RhYmxlLCBjcHUpOwogCi0gICAgaWYgKCBuZWVkX2Z1bGxfZ2R0KG5kKSAp
CisgICAgZnVsbF9nZHQgPSBuZWVkX2Z1bGxfZ2R0KG5kKTsKKworICAgIGlmICggZnVsbF9nZHQg
KQogICAgICAgICB3cml0ZV9mdWxsX2dkdF9wdGVzKGdkdCwgbik7CiAKLSAgICBpZiAoIG5lZWRf
ZnVsbF9nZHQocGQpICYmCi0gICAgICAgICAoKHAtPnZjcHVfaWQgIT0gbi0+dmNwdV9pZCkgfHwg
IW5lZWRfZnVsbF9nZHQobmQpKSApCisgICAgaWYgKCBwZXJfY3B1KGZ1bGxfZ2R0X2xvYWRlZCwg
Y3B1KSAmJgorICAgICAgICAgKChwLT52Y3B1X2lkICE9IG4tPnZjcHVfaWQpIHx8ICFmdWxsX2dk
dCkgKQogICAgICAgICBsb2FkX2RlZmF1bHRfZ2R0KGdkdCwgY3B1KTsKIAogICAgIHdyaXRlX3B0
YmFzZShuKTsKQEAgLTE3MjMsOCArMTczMCw3IEBAIHN0YXRpYyB2b2lkIF9fY29udGV4dF9zd2l0
Y2godm9pZCkKICAgICAgICAgc3ZtX2xvYWRfc2VncygwLCAwLCAwLCAwLCAwLCAwLCAwKTsKICNl
bmRpZgogCi0gICAgaWYgKCBuZWVkX2Z1bGxfZ2R0KG5kKSAmJgotICAgICAgICAgKChwLT52Y3B1
X2lkICE9IG4tPnZjcHVfaWQpIHx8ICFuZWVkX2Z1bGxfZ2R0KHBkKSkgKQorICAgIGlmICggZnVs
bF9nZHQgJiYgIXBlcl9jcHUoZnVsbF9nZHRfbG9hZGVkLCBjcHUpICkKICAgICAgICAgbG9hZF9m
dWxsX2dkdChuLCBjcHUpOwogCiAgICAgaWYgKCBwZCAhPSBuZCApCmRpZmYgLS1naXQgYS94ZW4v
aW5jbHVkZS9hc20teDg2L2Rlc2MuaCBiL3hlbi9pbmNsdWRlL2FzbS14ODYvZGVzYy5oCmluZGV4
IDg1ZTgzYmNlZmIuLmZmOWFjNWYxNWQgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL2FzbS14ODYv
ZGVzYy5oCisrKyBiL3hlbi9pbmNsdWRlL2FzbS14ODYvZGVzYy5oCkBAIC0yMDgsNiArMjA4LDcg
QEAgZXh0ZXJuIHNlZ19kZXNjX3QgYm9vdF9jcHVfZ2R0X3RhYmxlW107CiBERUNMQVJFX1BFUl9D
UFUoc2VnX2Rlc2NfdCAqLCBnZHRfdGFibGUpOwogZXh0ZXJuIHNlZ19kZXNjX3QgYm9vdF9jcHVf
Y29tcGF0X2dkdF90YWJsZVtdOwogREVDTEFSRV9QRVJfQ1BVKHNlZ19kZXNjX3QgKiwgY29tcGF0
X2dkdF90YWJsZSk7CitERUNMQVJFX1BFUl9DUFUoYm9vbCwgZnVsbF9nZHRfbG9hZGVkKTsKIAog
ZXh0ZXJuIHZvaWQgbG9hZF9UUih2b2lkKTsKIAotLSAKMi4xNi40CgoKX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApY
ZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9y
Zy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 4B94817A127
	for <lists+xen-devel@lfdr.de>; Thu,  5 Mar 2020 09:23:08 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1j9ljd-00087A-JF; Thu, 05 Mar 2020 08:20:01 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=9ybd=4W=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1j9ljc-00086z-P1
 for xen-devel@lists.xenproject.org; Thu, 05 Mar 2020 08:20:00 +0000
X-Inumbo-ID: 1ac94b9e-5eba-11ea-90c4-bc764e2007e4
Received: from mx2.suse.de (unknown [195.135.220.15])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 1ac94b9e-5eba-11ea-90c4-bc764e2007e4;
 Thu, 05 Mar 2020 08:19:59 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx2.suse.de (Postfix) with ESMTP id EB97DAFDC;
 Thu,  5 Mar 2020 08:19:58 +0000 (UTC)
To: Andrew Cooper <andrew.cooper3@citrix.com>
References: <20200303182447.15469-1-andrew.cooper3@citrix.com>
 <b2dc100f-b28e-c977-fe87-968e0d26c7cb@suse.com>
 <f72e3e9b-92f4-49b4-5c53-1d3e988e9456@citrix.com>
From: Jan Beulich <jbeulich@suse.com>
Message-ID: <24aea937-8078-03d3-d688-a1aabfd8bbd7@suse.com>
Date: Thu, 5 Mar 2020 09:20:00 +0100
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:68.0) Gecko/20100101
 Thunderbird/68.5.0
MIME-Version: 1.0
In-Reply-To: <f72e3e9b-92f4-49b4-5c53-1d3e988e9456@citrix.com>
Content-Language: en-US
Subject: Re: [Xen-devel] [PATCH] x86/cpuid: Untangle Invariant TSC handling
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Anthony PERARD <anthony.perard@citrix.com>,
 Xen-devel <xen-devel@lists.xenproject.org>,
 Ian Jackson <Ian.Jackson@citrix.com>, Wei Liu <wl@xen.org>,
 =?UTF-8?Q?Roger_Pau_Monn=c3=a9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

T24gMDQuMDMuMjAyMCAxOTo0MCwgQW5kcmV3IENvb3BlciB3cm90ZToKPiBPbiAwNC8wMy8yMDIw
IDEwOjI1LCBKYW4gQmV1bGljaCB3cm90ZToKPj4gT24gMDMuMDMuMjAyMCAxOToyNCwgQW5kcmV3
IENvb3BlciB3cm90ZToKPj4+IElUU0MgYmVpbmcgdmlzaWJsZSB0byB0aGUgZ3Vlc3QgaXMgY3Vy
cmVudGx5IGltcGxpY2l0IHdpdGggdGhlIHRvb2xzdGFjawo+Pj4gdW5jb25kaXRpb25hbGx5IGFz
a2luZyBmb3IgaXQsIGFuZCBYZW4gY2xpcHBpbmcgaXQgYmFzZWQgb24gdGhlIHZUU0MgYW5kL29y
Cj4+PiBYRU5fRE9NQ1RMX2Rpc2FibGVfbWlncmF0ZSBzZXR0aW5ncy4KPj4+Cj4+PiBUaGlzIGlz
IHByb2JsZW1hdGljIGZvciBzZXZlcmFsIHJlYXNvbnMuCj4+Pgo+Pj4gRmlyc3QsIHRoZSBpbXBs
aWNpdCB2VFNDIGJlaGF2aW91ciBtYW5pZmVzdHMgYXMgYSByZWFsIGJ1ZyBvbiBtaWdyYXRpb24g
dG8gYQo+Pj4gaG9zdCB3aXRoIGEgZGlmZmVyZW50IGZyZXF1ZW5jeSwgd2l0aCBJVFNDIGJ1dCB3
aXRob3V0IFRTQyBzY2FsaW5nCj4+PiBjYXBhYmlsaXRpZXMsIHdoZXJlYnkgdGhlIElUU0MgZmVh
dHVyZSBiZWNvbWVzIGFkdmVydGlzZWQgdG8gdGhlIGd1ZXN0LiAgSVRTQwo+Pj4gd2lsbCBkaXNh
cHBlYXIgYWdhaW4gaWYgdGhlIGd1ZXN0IG1pZ3JhdGVzIHRvIHNlcnZlciB3aXRoIHRoZSBzYW1l
IGZyZXF1ZW5jeQo+Pj4gYXMgdGhlIG9yaWdpbmFsLCBvciB0byBvbmUgd2l0aCBUU0Mgc2NhbGlu
ZyBzdXBwb3J0Lgo+Pj4KPj4+IFNlY29uZGx5LCBkaXNhbGxvd2luZyBJVFNDIHVubGVzcyB0aGUg
Z3Vlc3QgZG9lc24ndCBtaWdyYXRlIGlzIGNvbmNlcHR1YWxseQo+Pj4gd3JvbmcuICBJdCBpcyBj
b21tb24gdG8gaGF2ZSBtaWdyYXRpb24gcG9vbHMgb2YgaWRlbnRpY2FsIGhhcmR3YXJlLCBhdCB3
aGljaAo+Pj4gcG9pbnQgdGhlIFRTQyBmcmVxdWVuY3kgaXMgdGhlIHNhbWUsCj4+IFRoaXMgc3Rh
dGVtZW50IGlzIHRvbyBicm9hZDogUG9vbHMgb2YgaWRlbnRpY2FsIGhhcmR3YXJlIG1heSBoYXZl
IHRoZSBzYW1lCj4+IG5vbWluYWwgZnJlcXVlbmNpZXMsIGJ1dCB0d28gZGlzdGluY3Qgc3lzdGVt
cyBhcmUgaGFyZGx5IGV2ZXIgZ29pbmcgdG8gaGF2ZQo+PiB0aGUgZXhhY3Qgc2FtZSBhY3R1YWwg
KG1lYXN1cmVkIG9yIGV2ZW4gcmVhbCkgZnJlcXVlbmNpZXMuCj4gCj4gVGhlcmUgaXMgbm8gc3Vj
aCB0aGluZyBhcyB0cnVseSBpbnZhcmlhbnQgVFNDLsKgIEV2ZW4gd2l0aCB0aGUgYmVzdAo+IGhh
cmR3YXJlIGluIHRoZSB3b3JsZCwgdGhlIHJlZmVyZW5jZSBmcmVxdWVuY3kgd2lsbCBjaGFuZ2Ug
YmFzZWQgb24KPiBwaHlzaWNhbCBwcm9wZXJ0aWVzIG9mIHRoZSBzdXJyb3VuZGluZ3MsIGluY2x1
ZGluZyB0aGluZ3MgbGlrZSBhbWJpZW50Cj4gdGVtcGVyYXR1cmUuwqAgaS5lLiBldmVuIGEgc2lu
Z2xlIHNlcnZlciwgc2l0dGluZyBpbiBhIGRhdGFjZW50ZXIgaXMKPiBsaWtlbHkgdG8gc2VlIGEg
ZnJhY3Rpb25hbCBjaGFuZ2UgaW4gZnJlcXVlbmN5IGFjcm9zcyBhIDI0aCBwZXJpb2QuCj4gCj4g
V2hhdCBtYXR0ZXJzIGlzIHRoZSBlcnJvciBtYXJnaW5zLCBhbmQgaG93IGxvbmcgdW50aWwgaXQg
bWFuaWZlc3RzIGFzIGEKPiBub3RpY2VhYmxlIGRpZmZlcmVuY2UuCj4gCj4+IFJlY2FsbCBPbGFm
J3MgdlRTQy10b2xlcmFuY2UgcGF0Y2ggdGhhdCBzdGlsbCBoYXNuJ3QgbGFuZGVkIGFueXdoZXJl
Pwo+IAo+IFRoaXMgaXMgYSBkaWZmZXJlbnQgcHJvYmxlbS7CoCBFdmVuIG9uIHRoZSBzYW1lIHN5
c3RlbSwgZXJyb3JzIGluIFhlbidzCj4gZnJlcXVlbmN5IGNhbGN1bGF0aW9ucyBjYW4gZGlmZmVy
IGJ5IHNldmVyYWwgaHVuZHJlZCBrSHogKGlpcmMpLCBib290IHRvCj4gYm9vdCwgbWFraW5nIGl0
IHF1aXRlIHVzZWxlc3MgZm9yIGFuc3dlcmluZyB0aGUgcXVlc3Rpb24gImFtIEkgcnVubmluZwo+
IGF0IHRoZSBmcmVxdWVuY3kgdGhlIGd1ZXN0IHNhdyBiZWZvcmU/Iiwgd2hpY2ggaXMgaG93IHdl
IGp1c3Qgd2hldGhlciB0bwo+IGludGVyY2VwdCBUU0MgYWNjZXNzZXMgb3Igbm90LgoKQnV0IHRo
YXQncyB3aHkgSSd2ZSBzYWlkICJ0b28gYnJvYWQiOiBSaWdodCBub3cgcG9vbHMgb2YgaWRlbnRp
Y2FsCmhhcmR3YXJlIHdpbGwgbm90IGxvb2sgdG8gdXMgYXMgaWYgdGhleSBhbGwgaGFkIHRoZSBz
YW1lIGZyZXEuCgo+IFRoZXJlIGFyZSB0aGluZ3Mgd2hpY2ggY2FuIGJlIGRvbmUgYWJvdXQgdGhp
cywgc3VjaCBhcyB1c2luZyBmcmVxdWVuY3kKPiBkYXRhIHByb3ZpZGVkIGJ5IHRoZSBDUFUgZGly
ZWN0bHkgKHJhdGhlciB0aGFuIGNvcnJlbGF0aW5nIGl0IHdpdGggYQo+IHNlcGFyYXRlIHRpbWVz
b3VyY2UpLsKgIEF0IHRoYXQgcG9pbnQsIHRoZSBvbmx5IGRpZmZlcmVuY2UgYmV0d2VlbiB0d28K
PiBpZGVudGljYWwgc3lzdGVtcyB3aWxsIGJlIHRoZSB2YXJpYWJpbGl0eSBpbiB0aGUgcmVmZXJl
bmNlIGNsb2NrLCBhbmQKPiBQTEwgY2lyY3VpdHJ5IHdoaWNoIHVsdGltYXRlbHkgbXVsdGlwbGll
cyBpdCB1cCBmcm9tIDE5LjIvMjUvMTAwIE1IeiB0bwo+IHRoZSAxLTMuNUdIeiB0eXBpY2FsbHkg
ZW5jb3VudGVyZWQgZm9yIGNvcmUgZnJlcXVlbmNpZXMuCgpSaWdodC4gVGhlIHF1ZXN0aW9uIGp1
c3QgaXMgaG93IGxhcmdlIHRoZSBlcnJvciBtYXJnaW4gaXMgZnJvbSB0aGUKbm9taW5hbCBmcmVx
dWVuY3kgcmVwb3J0ZWQgdmlhIENQVUlEIGxlYXZlcyAxNS8xNiBhbmQgdGhlIGFjdHVhbApmcmVx
dWVuY3kuIElmIGl0J3Mgbm8gd29yc2UgdGhhbiB0aGUgZGlmZmVyZW5jZXMgd2Ugb2JzZXJ2ZSBm
cm9tCm91ciAibWVhc3VyZW1lbnQiLCB0aGVuIHllcywgd2UgY291bGQgYW5kIHBlcmhhcHMgc2hv
dWxkIHVzZSB0aGF0CmRhdGEgaWYgYXZhaWxhYmxlLgoKPj4+IGFuZCBtb3JlIG1vZGVybiBoYXJk
d2FyZSBoYXMgVFNDIHNjYWxpbmcKPj4+IHN1cHBvcnQgYW55d2F5LiAgSW4gYm90aCBjYXNlcywg
aXQgaXMgc2FmZSB0byBhZHZlcnRpc2UgSVRTQyBhbmQgbWlncmF0ZSB0aGUKPj4+IGd1ZXN0Lgo+
Pj4KPj4+IFJlbW92ZSBhbGwgaW1wbGljaXQgbG9naWMgbG9naWMgaW4gWGVuLCBhbmQgbWFrZSBJ
VFNDIHBhcnQgb2YgdGhlIG1heCBDUFVJRAo+Pj4gcG9saWNpZXMgZm9yIGd1ZXN0cy4gIFBsdW1i
IGFuIGl0c2MgcGFyYW1ldGVyIGludG8geGNfY3B1aWRfYXBwbHlfcG9saWN5KCkgYW5kCj4+PiBo
YXZlIGxpYnhsX19jcHVpZF9sZWdhY3koKSBmaWxsIGluIHRoZSB0d28gY2FzZXMgd2hlcmUgaXQg
Y2FuIHJlYXNvbmFibHkKPj4+IGV4cGVjdCBJVFNDIHRvIGJlIHNhZmUgZm9yIHRoZSBndWVzdCB0
byBzZWUuCj4+Pgo+Pj4gVGhpcyBpcyBhIGJlaGF2aW91ciBjaGFuZ2UgZm9yIFRTQ19NT0RFX05B
VElWRSwgd2hlcmUgdGhlIElUU0Mgd2lsbCBub3cKPj4+IHJlbGlhYmx5IG5vdCBhcHBlYXIsIGFu
ZCBmb3IgdGhlIGNhc2Ugd2hlcmUgdGhlIHVzZXIgZXhwbGljaXRseSByZXF1ZXN0cyBJVFNDLAo+
Pj4gaW4gd2hpY2ggY2FzZSBpdCB3aWxsIGFwcGVhciBldmVuIGlmIHRoZSBndWVzdCBpc24ndCBt
YXJrZWQgYXMgbm9taWdyYXRlLgo+PiBIb3cgc2Vuc2libGUgaXMgaXQgdG8gYWxsb3cgdGhlIHVz
ZXIgdG8gcmVxdWVzdCBzb21ldGhpbmcgbGlrZSBJVFNDIHdpdGgKPj4gbm8gcmVzcGVjdGl2ZSBz
dXBwb3J0IHVuZGVybmVhdGg/Cj4gCj4gUmlnaHQgbm93LCBYZW4gd2lsbCBpZ25vcmUgSVRTQyBp
ZiB0aGUgaGFyZHdhcmUgaXNuJ3QgY2FwYWJsZSwganVzdCBsaWtlCj4gYW55IG90aGVyIG1pc3Np
bmcgZmVhdHVyZSBmbGFnLgo+IAo+IFdoZW4gd2UgZ2V0IHRoZSBwb2xpY3kgYXVkaXRpbmcgbG9n
aWMgaW4gYmV0dGVyIHNoYXBlLCBJIGludGVuZCB0bwo+IHJlamVjdCByZXF1ZXN0cyB3aGljaCBj
YW4ndCBiZSBmdWxmaWxsZWQuCgpPa2F5LCBnb29kIHRvIGtub3cuIEkgd29uZGVyIHRob3VnaCBo
b3cgd2VsbCB3ZSdsbCBiZSBhYmxlIHRvCmV4cHJlc3MgaW4gdGhlIGV2ZW50dWFsIHVzZXIgdmlz
aWJsZSBlcnJvciBtZXNzYWdlIHdoaWNoIG9mCnRoZSBzZXR0aW5ncyB3YXMgYWN0dWFsbHkgcmVm
dXNlZC4KCj4+IFNob3VsZG4ndCB3ZSB0cmFuc2xhdGUgc3VjaCBhIHJlcXVlc3QKPj4gaW50byBl
bmFibGluZyB2VFNDIGlmIHRoZXJlJ3Mgbm8gSVRTQyBvbiB0aGUgcGxhdGZvcm0/Cj4gCj4gTm8s
IGJlY2F1c2UgYSkgZG9pbmcgdGhpbmdzIGltcGxpY2l0bHkgbGlrZSB0aGlzIGlzIHRoZSByb290
IG9mIGZhciB0b28KPiBtYW55IGJ1Z3MsIHRoaXMgcGF0Y2ggaW5jbHVkZWQsIGFuZCBiKSBpdCBw
cm9iYWJseSBpc24ndCB3aGF0IHRoZSB1c2VyCj4gd2FudHMuCj4gCj4gVGhlIHJlYXNvbiB0byBw
bGF5IGFyb3VuZCB3aXRoIFRTQyBzZXR0aW5ncyB3aWxsIHVsdGltYXRlbHkgdG8gYmUgdHJ5Cj4g
YW5kIGF2b2lkIGludGVyY2VwdGluZyBSRFRTQywgYmVjYXVzZSB0aGUgcGVyZm9ybWFuY2UgaGl0
IGZyb20KPiBpbnRlcmNlcHRpb24gZG9taW5hdGVzIG1vc3Qgb3RoZXIgZmFjdG9ycy4KPiAKPj4g
QWN0dWFsbHkgbG9va2luZwo+PiBhdCB0aGUgY2hhbmdlIHRvIGxpYnhsX19jcHVpZF9sZWdhY3ko
KSBJIHdvbmRlciB3aGV0aGVyIHlvdSBkb24ndCBpbnN0ZWFkCj4+IG1lYW4gInJlcXVlc3RzIHZU
U0MiIGhlcmUuCj4gCj4gSSBkb24ndCBzZWUgaG93IHlvdSBjb21lIHRvIHRoYXQgY29uY2x1c2lv
bi7CoCBJdCBpcyB0d28gc2VwYXJhdGUgY2FzZXMKPiB3aGVyZSB0aGUgdG9vbHN0YWNrIGNhbiBy
ZWFzb25hYmx5IGV4cGVjdCB0aGUgZ3Vlc3Qtb2JzZXJ2ZWQgZnJlcXVlbmN5Cj4gbm90IHRvIGRp
ZmZlci4KCkxvb2tpbmcgYXQgdGhpcyBodW5rCgpAQCAtNDMyLDcgKzQzMywyMiBAQCB2b2lkIGxp
YnhsX19jcHVpZF9sZWdhY3kobGlieGxfY3R4ICpjdHgsIHVpbnQzMl90IGRvbWlkLAogICAgIGlm
IChpbmZvLT50eXBlID09IExJQlhMX0RPTUFJTl9UWVBFX0hWTSkKICAgICAgICAgcGFlID0gbGli
eGxfZGVmYm9vbF92YWwoaW5mby0+dS5odm0ucGFlKTsKIAotICAgIHhjX2NwdWlkX2FwcGx5X3Bv
bGljeShjdHgtPnhjaCwgZG9taWQsIE5VTEwsIDAsIHBhZSk7CisgICAgLyoKKyAgICAgKiBBZHZl
cnRpc2luZyBJbnZhcmlhbnQgVFNDIHRvIGEgZ3Vlc3QgbWVhbnMgdGhhdCB0aGUgVFNDIGZyZXF1
ZW5jeSB3b24ndAorICAgICAqIGNoYW5nZSBhdCBhbnkgcG9pbnQgaW4gdGhlIGZ1dHVyZS4KKyAg
ICAgKgorICAgICAqIFdlIGRvIG5vdCBoYXZlIGVub3VnaCBpbmZvcm1hdGlvbiBhYm91dCBwb3Rl
bnRpYWwgbWlncmF0aW9uCisgICAgICogZGVzdGluYXRpb25zIHRvIGtub3cgd2hldGhlciBhZHZl
cnRpc2luZyBJVFNDIGlzIHNhZmUsIGJ1dCBpZiB0aGUgZ3Vlc3QKKyAgICAgKiBpc24ndCBnb2lu
ZyB0byBtaWdyYXRlLCB0aGVuIHRoZSBjdXJyZW50IGhhcmR3YXJlIGlzIGFsbCB0aGF0IG1hdHRl
cnMuCisgICAgICoKKyAgICAgKiBBbHRlcm5hdGl2ZWx5LCBhbiBpbnRlcm5hbCBwcm9wZXJ0eSBv
ZiB2VFNDIGlzIHRoYXQgdGhlIHZhbHVlcyByZWFkIGFyZQorICAgICAqIGludmFyaWFudC4gIEFk
dmVydGlzZSBJVFNDIHdoZW4gd2Uga25vdyB0aGUgZG9tYWluIHdpbGwgaGF2ZSBlbXVhbHRlZAor
ICAgICAqIFRTQyBldmVyeXdoZXJlIGl0IGdvZXMuCisgICAgICovCisgICAgaXRzYyA9IChsaWJ4
bF9kZWZib29sX3ZhbChpbmZvLT5kaXNhYmxlX21pZ3JhdGUpIHx8CisgICAgICAgICAgICBpbmZv
LT50c2NfbW9kZSA9PSBMSUJYTF9UU0NfTU9ERV9BTFdBWVNfRU1VTEFURSk7CisKKyAgICB4Y19j
cHVpZF9hcHBseV9wb2xpY3koY3R4LT54Y2gsIGRvbWlkLCBOVUxMLCAwLCBwYWUsIGl0c2MpOwoK
SSBzZWUgdGhlIGNoZWNrIG9mIC0+dHNjX21vZGUsIHdoaWNoIGFpdWkgaXMgYSByZXF1ZXN0IHRv
IGVuYWJsZQp2VFNDIHVuY29uZGl0aW9uYWxseS4gVGhpcyBwbHVzICJuby1taWdyYXRlIiBnZXQg
dHJhbnNsYXRlZCB0bwplbmFibGluZyBvZiBJVFNDLgoKSmFuCgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1k
ZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21h
aWxtYW4vbGlzdGluZm8veGVuLWRldmVs

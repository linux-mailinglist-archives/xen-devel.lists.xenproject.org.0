Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 5824A6CE67
	for <lists+xen-devel@lfdr.de>; Thu, 18 Jul 2019 14:59:38 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1ho5xH-0005lY-CE; Thu, 18 Jul 2019 12:56:15 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=B+y+=VP=tklengyel.com=bounce+e181d6.cd840-xen-devel=lists.xenproject.org@srs-us1.protection.inumbo.net>)
 id 1ho5xF-0005lT-JD
 for xen-devel@lists.xenproject.org; Thu, 18 Jul 2019 12:56:13 +0000
X-Inumbo-ID: 6b4a8f5c-a95b-11e9-8980-bc764e045a96
Received: from rs224.mailgun.us (unknown [209.61.151.224])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 6b4a8f5c-a95b-11e9-8980-bc764e045a96;
 Thu, 18 Jul 2019 12:56:12 +0000 (UTC)
DKIM-Signature: a=rsa-sha256; v=1; c=relaxed/relaxed; d=tklengyel.com;
 q=dns/txt; 
 s=krs; t=1563454571; h=Content-Type: Cc: To: Subject: Message-ID: Date:
 From: In-Reply-To: References: MIME-Version: Sender;
 bh=XFyi2hT+r5yZuO75p33icoSyEq2Q7zSVTy5HBAXA+Ew=;
 b=Tvinw9KbgdiV79X9QO9B5Kle/EtdOvkLWd3Iegw7OfT+1uR3rJPeZdZeYM2Dj+7ns744avXH
 XUf+iYbXpHO07hf3uS/uW7BPgS4Kg8XrqTj0RJvTc5uLuvR9dzDN0//T1HiAC6LUviHgAHgW
 DqLpgVscp+vr7B9qttg4wVeO424=
X-Mailgun-Sending-Ip: 209.61.151.224
X-Mailgun-Sid: WyIyYTNmOCIsICJ4ZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmciLCAiY2Q4NDAiXQ==
Received: from mail-wm1-f41.google.com (mail-wm1-f41.google.com
 [209.85.128.41])
 by mxa.mailgun.org with ESMTP id 5d306c6a.7efccf1b14f0-smtp-out-n01;
 Thu, 18 Jul 2019 12:56:10 -0000 (UTC)
Received: by mail-wm1-f41.google.com with SMTP id a15so25476918wmj.5
 for <xen-devel@lists.xenproject.org>; Thu, 18 Jul 2019 05:56:10 -0700 (PDT)
X-Gm-Message-State: APjAAAWCSjrkDEMtpuivTqILOSH41qrmcEXL7NKMhOtDnuD1A9ASY49j
 NSTVsyTSyxIq5w+DnpXprLHAF66faqAsF4drZII=
X-Google-Smtp-Source: APXvYqy1Fu4UyMO2MTxR7EykOy8qJXcOCG8JNEdiTo4VZEq0F/5yuGIND09S3TMS50c5rGD7J7u1BG1Gbjb0iG5BCWA=
X-Received: by 2002:a1c:7d4e:: with SMTP id y75mr42889594wmc.169.1563454569633; 
 Thu, 18 Jul 2019 05:56:09 -0700 (PDT)
MIME-Version: 1.0
References: <20190717193335.11991-1-tamas@tklengyel.com>
 <20190717193335.11991-2-tamas@tklengyel.com>
 <66bbd9f7-12f9-b654-555d-a02d5f4f0dba@suse.com>
In-Reply-To: <66bbd9f7-12f9-b654-555d-a02d5f4f0dba@suse.com>
From: Tamas K Lengyel <tamas@tklengyel.com>
Date: Thu, 18 Jul 2019 06:55:33 -0600
X-Gmail-Original-Message-ID: <CABfawhkJR8sz8cVCfcuxQ-4+xoQOSTs-XQuow-qzPyd4xZwq0g@mail.gmail.com>
Message-ID: <CABfawhkJR8sz8cVCfcuxQ-4+xoQOSTs-XQuow-qzPyd4xZwq0g@mail.gmail.com>
To: Jan Beulich <JBeulich@suse.com>
Subject: Re: [Xen-devel] [PATCH v6 1/5] x86/mem_sharing: reorder when pages
 are unlocked and released
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: George Dunlap <george.dunlap@eu.citrix.com>,
 "xen-devel@lists.xenproject.org" <xen-devel@lists.xenproject.org>,
 Roger Pau Monne <roger.pau@citrix.com>, Wei Liu <wei.liu2@citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

T24gVGh1LCBKdWwgMTgsIDIwMTkgYXQgNDo0NyBBTSBKYW4gQmV1bGljaCA8SkJldWxpY2hAc3Vz
ZS5jb20+IHdyb3RlOgo+Cj4gT24gMTcuMDcuMjAxOSAyMTozMywgVGFtYXMgSyBMZW5neWVsIHdy
b3RlOgo+ID4gQ2FsbGluZyBfcHV0X3BhZ2VfdHlwZSB3aGlsZSBhbHNvIGhvbGRpbmcgdGhlIHBh
Z2VfbG9jawo+ID4gZm9yIHRoYXQgcGFnZSBjYW4gY2F1c2UgYSBkZWFkbG9jay4KPiA+Cj4gPiBU
aGUgY29tbWVudCBiZWluZyBkcm9wcGVkIGlzIGluY29ycmVjdCBzaW5jZSBpdCdzIG5vdyBvdXQt
b2YtZGF0ZS4KPiA+Cj4gPiBTaWduZWQtb2ZmLWJ5OiBUYW1hcyBLIExlbmd5ZWwgPHRhbWFzQHRr
bGVuZ3llbC5jb20+Cj4KPiBUaGUgZGVzY3JpcHRpb24gY292ZXJzIC4uLgo+Cj4gPiAtLS0gYS94
ZW4vYXJjaC94ODYvbW0vbWVtX3NoYXJpbmcuYwo+ID4gKysrIGIveGVuL2FyY2gveDg2L21tL21l
bV9zaGFyaW5nLmMKPiA+IEBAIC02NDgsMTAgKzY0OCw2IEBAIHN0YXRpYyBpbnQgcGFnZV9tYWtl
X3ByaXZhdGUoc3RydWN0IGRvbWFpbiAqZCwgc3RydWN0IHBhZ2VfaW5mbyAqcGFnZSkKPiA+ICAg
ICAgICAgICByZXR1cm4gLUVCVVNZOwo+ID4gICAgICAgfQo+ID4KPiA+IC0gICAgLyogV2UgY2Fu
IG9ubHkgY2hhbmdlIHRoZSB0eXBlIGlmIGNvdW50IGlzIG9uZSAqLwo+ID4gLSAgICAvKiBCZWNh
dXNlIHdlIGFyZSBsb2NraW5nIHBhZ2VzIGluZGl2aWR1YWxseSwgd2UgbmVlZCB0byBkcm9wCj4g
PiAtICAgICAqIHRoZSBsb2NrIGhlcmUsIHdoaWxlIHRoZSBwYWdlIGlzIHR5cGVkLiBXZSBjYW5u
b3QgcmlzayB0aGUKPiA+IC0gICAgICogcmFjZSBvZiBwYWdlX3VubG9jayBhbmQgdGhlbiBwdXRf
cGFnZV90eXBlLiAqLwo+ID4gICAgICAgZXhwZWN0ZWRfdHlwZSA9IChQR1Rfc2hhcmVkX3BhZ2Ug
fCBQR1RfdmFsaWRhdGVkIHwgUEdUX2xvY2tlZCB8IDIpOwo+ID4gICAgICAgaWYgKCBwYWdlLT51
LmludXNlLnR5cGVfaW5mbyAhPSBleHBlY3RlZF90eXBlICkKPiA+ICAgICAgIHsKPiA+IEBAIC02
NjAsMTIgKzY1NiwxMSBAQCBzdGF0aWMgaW50IHBhZ2VfbWFrZV9wcml2YXRlKHN0cnVjdCBkb21h
aW4gKmQsIHN0cnVjdCBwYWdlX2luZm8gKnBhZ2UpCj4gPiAgICAgICAgICAgcmV0dXJuIC1FRVhJ
U1Q7Cj4gPiAgICAgICB9Cj4gPgo+ID4gKyAgICBtZW1fc2hhcmluZ19wYWdlX3VubG9jayhwYWdl
KTsKPiA+ICsKPiA+ICAgICAgIC8qIERyb3AgdGhlIGZpbmFsIHR5cGVjb3VudCAqLwo+ID4gICAg
ICAgcHV0X3BhZ2VfYW5kX3R5cGUocGFnZSk7Cj4gPgo+ID4gLSAgICAvKiBOb3cgdGhhdCB3ZSd2
ZSBkcm9wcGVkIHRoZSB0eXBlLCB3ZSBjYW4gdW5sb2NrICovCj4gPiAtICAgIG1lbV9zaGFyaW5n
X3BhZ2VfdW5sb2NrKHBhZ2UpOwo+ID4gLQo+ID4gICAgICAgLyogQ2hhbmdlIHRoZSBvd25lciAq
Lwo+ID4gICAgICAgQVNTRVJUKHBhZ2VfZ2V0X293bmVyKHBhZ2UpID09IGRvbV9jb3cpOwo+ID4g
ICAgICAgcGFnZV9zZXRfb3duZXIocGFnZSwgZCk7Cj4KPiBhbGwgb2YgdGhlIGFib3ZlLiBCdXQg
d2hhdCBhYm91dCAuLi4KPgo+ID4gQEAgLTkwMCw2ICs4OTUsNyBAQCBzdGF0aWMgaW50IHNoYXJl
X3BhZ2VzKHN0cnVjdCBkb21haW4gKnNkLCBnZm5fdCBzZ2ZuLCBzaHJfaGFuZGxlX3Qgc2gsCj4g
PiAgICAgICBwMm1fdHlwZV90IHNtZm5fdHlwZSwgY21mbl90eXBlOwo+ID4gICAgICAgc3RydWN0
IHR3b19nZm5zIHRnOwo+ID4gICAgICAgc3RydWN0IHJtYXBfaXRlcmF0b3Igcmk7Cj4gPiArICAg
IHVuc2lnbmVkIGxvbmcgcHV0X2NvdW50ID0gMDsKPiA+Cj4gPiAgICAgICBnZXRfdHdvX2dmbnMo
c2QsIHNnZm4sICZzbWZuX3R5cGUsIE5VTEwsICZzbWZuLAo+ID4gICAgICAgICAgICAgICAgICAg
IGNkLCBjZ2ZuLCAmY21mbl90eXBlLCBOVUxMLCAmY21mbiwgMCwgJnRnKTsKPiA+IEBAIC05NjQs
MTUgKzk2MCw2IEBAIHN0YXRpYyBpbnQgc2hhcmVfcGFnZXMoc3RydWN0IGRvbWFpbiAqc2QsIGdm
bl90IHNnZm4sIHNocl9oYW5kbGVfdCBzaCwKPiA+ICAgICAgICAgICBnb3RvIGVycl9vdXQ7Cj4g
PiAgICAgICB9Cj4gPgo+ID4gLSAgICAvKiBBY3F1aXJlIGFuIGV4dHJhIHJlZmVyZW5jZSwgZm9y
IHRoZSBmcmVlaW5nIGJlbG93IHRvIGJlIHNhZmUuICovCj4gPiAtICAgIGlmICggIWdldF9wYWdl
KGNwYWdlLCBkb21fY293KSApCj4gPiAtICAgIHsKPiA+IC0gICAgICAgIHJldCA9IC1FT1ZFUkZM
T1c7Cj4gPiAtICAgICAgICBtZW1fc2hhcmluZ19wYWdlX3VubG9jayhzZWNvbmRwZyk7Cj4gPiAt
ICAgICAgICBtZW1fc2hhcmluZ19wYWdlX3VubG9jayhmaXJzdHBnKTsKPiA+IC0gICAgICAgIGdv
dG8gZXJyX291dDsKPiA+IC0gICAgfQo+ID4gLQo+ID4gICAgICAgLyogTWVyZ2UgdGhlIGxpc3Rz
IHRvZ2V0aGVyICovCj4gPiAgICAgICBybWFwX3NlZWRfaXRlcmF0b3IoY3BhZ2UsICZyaSk7Cj4g
PiAgICAgICB3aGlsZSAoIChnZm4gPSBybWFwX2l0ZXJhdGUoY3BhZ2UsICZyaSkpICE9IE5VTEwp
Cj4gPiBAQCAtOTg0LDEzICs5NzEsMTQgQEAgc3RhdGljIGludCBzaGFyZV9wYWdlcyhzdHJ1Y3Qg
ZG9tYWluICpzZCwgZ2ZuX3Qgc2dmbiwgc2hyX2hhbmRsZV90IHNoLAo+ID4gICAgICAgICAgICAq
IERvbid0IGNoYW5nZSB0aGUgdHlwZSBvZiBybWFwIGZvciB0aGUgY2xpZW50IHBhZ2UuICovCj4g
PiAgICAgICAgICAgcm1hcF9kZWwoZ2ZuLCBjcGFnZSwgMCk7Cj4gPiAgICAgICAgICAgcm1hcF9h
ZGQoZ2ZuLCBzcGFnZSk7Cj4gPiAtICAgICAgICBwdXRfcGFnZV9hbmRfdHlwZShjcGFnZSk7Cj4g
PiArICAgICAgICBwdXRfY291bnQrKzsKPiA+ICAgICAgICAgICBkID0gZ2V0X2RvbWFpbl9ieV9p
ZChnZm4tPmRvbWFpbik7Cj4gPiAgICAgICAgICAgQlVHX09OKCFkKTsKPiA+ICAgICAgICAgICBC
VUdfT04oc2V0X3NoYXJlZF9wMm1fZW50cnkoZCwgZ2ZuLT5nZm4sIHNtZm4pKTsKPiA+ICAgICAg
ICAgICBwdXRfZG9tYWluKGQpOwo+ID4gICAgICAgfQo+ID4gICAgICAgQVNTRVJUKGxpc3RfZW1w
dHkoJmNwYWdlLT5zaGFyaW5nLT5nZm5zKSk7Cj4gPiArICAgIEJVR19PTighcHV0X2NvdW50KTsK
PiA+Cj4gPiAgICAgICAvKiBDbGVhciB0aGUgcmVzdCBvZiB0aGUgc2hhcmVkIHN0YXRlICovCj4g
PiAgICAgICBwYWdlX3NoYXJpbmdfZGlzcG9zZShjcGFnZSk7Cj4gPiBAQCAtMTAwMSw3ICs5ODks
OSBAQCBzdGF0aWMgaW50IHNoYXJlX3BhZ2VzKHN0cnVjdCBkb21haW4gKnNkLCBnZm5fdCBzZ2Zu
LCBzaHJfaGFuZGxlX3Qgc2gsCj4gPgo+ID4gICAgICAgLyogRnJlZSB0aGUgY2xpZW50IHBhZ2Ug
Ki8KPiA+ICAgICAgIHB1dF9wYWdlX2FsbG9jX3JlZihjcGFnZSk7Cj4gPiAtICAgIHB1dF9wYWdl
KGNwYWdlKTsKPiA+ICsKPiA+ICsgICAgd2hpbGUgKCBwdXRfY291bnQtLSApCj4gPiArICAgICAg
ICBwdXRfcGFnZV9hbmRfdHlwZShjcGFnZSk7Cj4gPgo+ID4gICAgICAgLyogV2UgbWFuYWdlZCB0
byBmcmVlIGEgZG9tYWluIHBhZ2UuICovCj4gPiAgICAgICBhdG9taWNfZGVjKCZucl9zaGFyZWRf
bWZucyk7Cj4gPiBAQCAtMTE2NSwxOSArMTE1NSwxMyBAQCBpbnQgX19tZW1fc2hhcmluZ191bnNo
YXJlX3BhZ2Uoc3RydWN0IGRvbWFpbiAqZCwKPiA+ICAgICAgIHsKPiA+ICAgICAgICAgICBpZiAo
ICFsYXN0X2dmbiApCj4gPiAgICAgICAgICAgICAgIG1lbV9zaGFyaW5nX2dmbl9kZXN0cm95KHBh
Z2UsIGQsIGdmbl9pbmZvKTsKPiA+IC0gICAgICAgIHB1dF9wYWdlX2FuZF90eXBlKHBhZ2UpOwo+
ID4gKwo+ID4gICAgICAgICAgIG1lbV9zaGFyaW5nX3BhZ2VfdW5sb2NrKHBhZ2UpOwo+ID4gKwo+
ID4gICAgICAgICAgIGlmICggbGFzdF9nZm4gKQo+ID4gLSAgICAgICAgewo+ID4gLSAgICAgICAg
ICAgIGlmICggIWdldF9wYWdlKHBhZ2UsIGRvbV9jb3cpICkKPiA+IC0gICAgICAgICAgICB7Cj4g
PiAtICAgICAgICAgICAgICAgIHB1dF9nZm4oZCwgZ2ZuKTsKPiA+IC0gICAgICAgICAgICAgICAg
ZG9tYWluX2NyYXNoKGQpOwo+ID4gLSAgICAgICAgICAgICAgICByZXR1cm4gLUVPVkVSRkxPVzsK
PiA+IC0gICAgICAgICAgICB9Cj4gPiAgICAgICAgICAgICAgIHB1dF9wYWdlX2FsbG9jX3JlZihw
YWdlKTsKPiA+IC0gICAgICAgICAgICBwdXRfcGFnZShwYWdlKTsKPiA+IC0gICAgICAgIH0KPiA+
ICsKPiA+ICsgICAgICAgIHB1dF9wYWdlX2FuZF90eXBlKHBhZ2UpOwo+ID4gICAgICAgICAgIHB1
dF9nZm4oZCwgZ2ZuKTsKPiA+Cj4gPiAgICAgICAgICAgcmV0dXJuIDA7Cj4KPiAuLi4gdGhpcyAo
bWFpbiwgYXMgSSBndWVzcyBieSB0aGUgdGl0bGUpIHBhcnQgb2YgdGhlIGNoYW5nZT8gSSB0aGlu
awo+IHlvdSB3YW50IHRvIGV4cGxhaW4gd2hhdCB3YXMgd3JvbmcgaGVyZSBhbmQvb3Igd2h5IHRo
ZSBuZXcgYXJyYW5nZW1lbnQKPiBpcyBiZXR0ZXIuIChJJ20gc29ycnksIEkgZ3Vlc3MgaXQgd2Fz
IHRoaXMgd2F5IG9uIHByaW9yIHZlcnNpb25zCj4gYWxyZWFkeSwgYnV0IGFwcGFyZW50bHkgSSBk
aWRuJ3Qgbm90aWNlLikKCkl0J3Mgd2hhdCB0aGUgcGF0Y2ggbWVzc2FnZSBzYXlzIC0gY2FsbGlu
ZyBwdXRfcGFnZV9hbmRfdHlwZSBiZWZvcmUKbWVtX3NoYXJpbmdfcGFnZV91bmxvY2sgY2FuIGNh
dXNlIGEgZGVhZGxvY2suIFNpbmNlIG5vdyB3ZSBhcmUgbm93CmhvbGRpbmcgYSByZWZlcmVuY2Ug
dG8gdGhlIHBhZ2UgdGlsbCB0aGUgZW5kIHRoZXJlIGlzIG5vIG5lZWQgZm9yIHRoZQpleHRyYSBn
ZXRfcGFnZS9wdXRfcGFnZSBsb2dpYyB3aGVuIHdlIGFyZSBkZWFsaW5nIHdpdGggdGhlIGxhc3Rf
Z2ZuLgoKVGFtYXMKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3Jn
Cmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 320DF170215
	for <lists+xen-devel@lfdr.de>; Wed, 26 Feb 2020 16:15:52 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1j6yMw-0000JQ-F5; Wed, 26 Feb 2020 15:13:02 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=NxXS=4O=citrix.com=roger.pau@srs-us1.protection.inumbo.net>)
 id 1j6yMu-0000JL-5G
 for xen-devel@lists.xenproject.org; Wed, 26 Feb 2020 15:13:00 +0000
X-Inumbo-ID: 78d81c9e-58aa-11ea-9458-12813bfff9fa
Received: from esa1.hc3370-68.iphmx.com (unknown [216.71.145.142])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 78d81c9e-58aa-11ea-9458-12813bfff9fa;
 Wed, 26 Feb 2020 15:12:58 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1582729979;
 h=date:from:to:cc:subject:message-id:references:
 mime-version:in-reply-to;
 bh=8Qv9bDR7bU+K1ukBuT7XMCYGIrpUuFREM007yWLDnA8=;
 b=UxDvelQ5uKES+dhq851H1qVY83Mc8ylTG630xwT42wbmb2tDzZdQb2fe
 WC4b1ztDY4PyG4mK/BkYxIyxhMkIDbYvQRWNyCREt1XzmJRaZEoe3ueaj
 T6ERtKKrF3BMJSE/WP2Fxa8CZ3SuB6OcQEu+4Xoo+rTqP4nY/mW7wQkpk 8=;
Authentication-Results: esa1.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=roger.pau@citrix.com;
 spf=Pass smtp.mailfrom=roger.pau@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa1.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 roger.pau@citrix.com) identity=pra; client-ip=162.221.158.21;
 receiver=esa1.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="roger.pau@citrix.com"; x-conformance=sidf_compatible
Received-SPF: Pass (esa1.hc3370-68.iphmx.com: domain of
 roger.pau@citrix.com designates 162.221.158.21 as permitted
 sender) identity=mailfrom; client-ip=162.221.158.21;
 receiver=esa1.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="roger.pau@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83
 ip4:168.245.78.127 ~all"
Received-SPF: None (esa1.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa1.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: aeKVKAUX5ATgY6FB0DJy9JDNfy9YQ9e52E2FRnSazZ3/naRmOmPqp0OHZL1yaBgLDG+YZneQNt
 D5Loi9PmFopl4RTqUF7ION1jgmVrTwH5zfM00b3eg7Djclu/PYuvmJHjs7/ABDJqwrR4qHcqc7
 Na8BTxrLVQtfd43FjSQwY2EHqTGXrlEpvid6jS4fK2rW8Yf1WRzrwSYGxM4a8sTdG1MjQVi6B/
 UGE/dH2SEnbZf5CJ9pQazeUjbkoi3G3DjRj+fMulmvK1e3JH3YKjGyZfXKweXitoh1WEaWW156
 vyE=
X-SBRS: 2.7
X-MesageID: 13226818
X-Ironport-Server: esa1.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.70,488,1574139600"; d="scan'208";a="13226818"
Date: Wed, 26 Feb 2020 16:12:47 +0100
From: Roger Pau =?utf-8?B?TW9ubsOp?= <roger.pau@citrix.com>
To: Tamas K Lengyel <tamas.lengyel@intel.com>
Message-ID: <20200226151247.GF24458@Air-de-Roger.citrite.net>
References: <cover.1582658216.git.tamas.lengyel@intel.com>
 <8df741964b56c10ed912f9187dcb31aae7251085.1582658216.git.tamas.lengyel@intel.com>
MIME-Version: 1.0
Content-Disposition: inline
In-Reply-To: <8df741964b56c10ed912f9187dcb31aae7251085.1582658216.git.tamas.lengyel@intel.com>
X-ClientProxiedBy: AMSPEX02CAS01.citrite.net (10.69.22.112) To
 AMSPEX02CL01.citrite.net (10.69.22.125)
Subject: Re: [Xen-devel] [PATCH v10 1/3] xen/mem_sharing: VM forking
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Stefano Stabellini <sstabellini@kernel.org>, Julien
 Grall <julien@xen.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>, Andrew
 Cooper <andrew.cooper3@citrix.com>, Ian Jackson <ian.jackson@eu.citrix.com>,
 George Dunlap <george.dunlap@citrix.com>,
 Tamas K Lengyel <tamas@tklengyel.com>, Jan Beulich <jbeulich@suse.com>,
 xen-devel@lists.xenproject.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

T24gVHVlLCBGZWIgMjUsIDIwMjAgYXQgMTE6MTc6NTVBTSAtMDgwMCwgVGFtYXMgSyBMZW5neWVs
IHdyb3RlOgo+IFZNIGZvcmtpbmcgaXMgdGhlIHByb2Nlc3Mgb2YgY3JlYXRpbmcgYSBkb21haW4g
d2l0aCBhbiBlbXB0eSBtZW1vcnkgc3BhY2UgYW5kIGEKPiBwYXJlbnQgZG9tYWluIHNwZWNpZmll
ZCBmcm9tIHdoaWNoIHRvIHBvcHVsYXRlIHRoZSBtZW1vcnkgd2hlbiBuZWNlc3NhcnkuIEZvcgo+
IHRoZSBuZXcgZG9tYWluIHRvIGJlIGZ1bmN0aW9uYWwgdGhlIFZNIHN0YXRlIGlzIGNvcGllZCBv
dmVyIGFzIHBhcnQgb2YgdGhlIGZvcmsKPiBvcGVyYXRpb24gKEhWTSBwYXJhbXMsIGhhcCBhbGxv
Y2F0aW9uLCBldGMpLgo+IAo+IFNpZ25lZC1vZmYtYnk6IFRhbWFzIEsgTGVuZ3llbCA8dGFtYXMu
bGVuZ3llbEBpbnRlbC5jb20+Cj4gLS0tCj4gdjEwOiBzZXR1cCB2Y3B1X2luZm8gcGFnZXMgZm9y
IHZDUFVzIGluIHRoZSBmb3JrIGlmIHRoZSBwYXJlbnQgaGFzIHRoZW0KPiAgICAgIHNldHVwIHBh
Z2VzIGZvciBzcGVjaWFsIEhWTSBQRk5zIGlmIHRoZSBwYXJlbnQgaGFzIHRoZW0KPiAgICAgIG1p
bm9yIGFkanVzdG1lbnRzIGJhc2VkIG9uIFJvZ2VyJ3MgY29tbWVudHMKPiAtLS0KPiAgeGVuL2Fy
Y2gveDg2L2RvbWFpbi5jICAgICAgICAgICAgIHwgIDExICsrCj4gIHhlbi9hcmNoL3g4Ni9odm0v
aHZtLmMgICAgICAgICAgICB8ICAgNCArLQo+ICB4ZW4vYXJjaC94ODYvbW0vaGFwL2hhcC5jICAg
ICAgICAgfCAgIDMgKy0KPiAgeGVuL2FyY2gveDg2L21tL21lbV9zaGFyaW5nLmMgICAgIHwgMjg3
ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwo+ICB4ZW4vYXJjaC94ODYvbW0vcDJtLmMg
ICAgICAgICAgICAgfCAgIDkgKy0KPiAgeGVuL2NvbW1vbi9kb21haW4uYyAgICAgICAgICAgICAg
IHwgICAzICsKPiAgeGVuL2luY2x1ZGUvYXNtLXg4Ni9oYXAuaCAgICAgICAgIHwgICAxICsKPiAg
eGVuL2luY2x1ZGUvYXNtLXg4Ni9odm0vaHZtLmggICAgIHwgICAyICsKPiAgeGVuL2luY2x1ZGUv
YXNtLXg4Ni9tZW1fc2hhcmluZy5oIHwgIDE3ICsrCj4gIHhlbi9pbmNsdWRlL3B1YmxpYy9tZW1v
cnkuaCAgICAgICB8ICAgNSArCj4gIHhlbi9pbmNsdWRlL3hlbi9zY2hlZC5oICAgICAgICAgICB8
ICAgNSArCj4gIDExIGZpbGVzIGNoYW5nZWQsIDM0MiBpbnNlcnRpb25zKCspLCA1IGRlbGV0aW9u
cygtKQo+IAo+IGRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvZG9tYWluLmMgYi94ZW4vYXJjaC94
ODYvZG9tYWluLmMKPiBpbmRleCBmZTYzYzIzNjc2Li4xYWIwY2EwOTQyIDEwMDY0NAo+IC0tLSBh
L3hlbi9hcmNoL3g4Ni9kb21haW4uYwo+ICsrKyBiL3hlbi9hcmNoL3g4Ni9kb21haW4uYwo+IEBA
IC0yMjAzLDYgKzIyMDMsMTcgQEAgaW50IGRvbWFpbl9yZWxpbnF1aXNoX3Jlc291cmNlcyhzdHJ1
Y3QgZG9tYWluICpkKQo+ICAgICAgICAgICAgICByZXQgPSByZWxpbnF1aXNoX3NoYXJlZF9wYWdl
cyhkKTsKPiAgICAgICAgICAgICAgaWYgKCByZXQgKQo+ICAgICAgICAgICAgICAgICAgcmV0dXJu
IHJldDsKPiArCj4gKyAgICAgICAgICAgIC8qCj4gKyAgICAgICAgICAgICAqIElmIHRoZSBkb21h
aW4gaXMgZm9ya2VkLCBkZWNyZW1lbnQgdGhlIHBhcmVudCdzIHBhdXNlIGNvdW50Cj4gKyAgICAg
ICAgICAgICAqIGFuZCByZWxlYXNlIHRoZSBkb21haW4uCj4gKyAgICAgICAgICAgICAqLwo+ICsg
ICAgICAgICAgICBpZiAoIGQtPnBhcmVudCApCj4gKyAgICAgICAgICAgIHsKPiArICAgICAgICAg
ICAgICAgIGRvbWFpbl91bnBhdXNlKGQtPnBhcmVudCk7Cj4gKyAgICAgICAgICAgICAgICBwdXRf
ZG9tYWluKGQtPnBhcmVudCk7Cj4gKyAgICAgICAgICAgICAgICBkLT5wYXJlbnQgPSBOVUxMOwo+
ICsgICAgICAgICAgICB9Cj4gICAgICAgICAgfQo+ICAjZW5kaWYKPiAgCj4gZGlmZiAtLWdpdCBh
L3hlbi9hcmNoL3g4Ni9odm0vaHZtLmMgYi94ZW4vYXJjaC94ODYvaHZtL2h2bS5jCj4gaW5kZXgg
YTMzOWIzNmEwZC4uYzI4NGYzY2Y1ZiAxMDA2NDQKPiAtLS0gYS94ZW4vYXJjaC94ODYvaHZtL2h2
bS5jCj4gKysrIGIveGVuL2FyY2gveDg2L2h2bS9odm0uYwo+IEBAIC0xOTE1LDcgKzE5MTUsNyBA
QCBpbnQgaHZtX2hhcF9uZXN0ZWRfcGFnZV9mYXVsdChwYWRkcl90IGdwYSwgdW5zaWduZWQgbG9u
ZyBnbGEsCj4gICAgICB9Cj4gICNlbmRpZgo+ICAKPiAtICAgIC8qIFNwdXJpb3VzIGZhdWx0PyBQ
b0QgYW5kIGxvZy1kaXJ0eSBhbHNvIHRha2UgdGhpcyBwYXRoLiAqLwo+ICsgICAgLyogU3B1cmlv
dXMgZmF1bHQ/IFBvRCwgbG9nLWRpcnR5IGFuZCBWTSBmb3JraW5nIGFsc28gdGFrZSB0aGlzIHBh
dGguICovCj4gICAgICBpZiAoIHAybV9pc19yYW0ocDJtdCkgKQo+ICAgICAgewo+ICAgICAgICAg
IHJjID0gMTsKPiBAQCAtNDQyOSw3ICs0NDI5LDcgQEAgc3RhdGljIGludCBodm1fYWxsb3dfZ2V0
X3BhcmFtKHN0cnVjdCBkb21haW4gKmQsCj4gICAgICByZXR1cm4gcmM7Cj4gIH0KPiAgCj4gLXN0
YXRpYyBpbnQgaHZtX2dldF9wYXJhbShzdHJ1Y3QgZG9tYWluICpkLCB1aW50MzJfdCBpbmRleCwg
dWludDY0X3QgKnZhbHVlKQo+ICtpbnQgaHZtX2dldF9wYXJhbShzdHJ1Y3QgZG9tYWluICpkLCB1
aW50MzJfdCBpbmRleCwgdWludDY0X3QgKnZhbHVlKQo+ICB7Cj4gICAgICBpbnQgcmM7Cj4gIAo+
IGRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvbW0vaGFwL2hhcC5jIGIveGVuL2FyY2gveDg2L21t
L2hhcC9oYXAuYwo+IGluZGV4IDNkOTNmMzQ1MWMuLmM3YzdmZjZlOTkgMTAwNjQ0Cj4gLS0tIGEv
eGVuL2FyY2gveDg2L21tL2hhcC9oYXAuYwo+ICsrKyBiL3hlbi9hcmNoL3g4Ni9tbS9oYXAvaGFw
LmMKPiBAQCAtMzIxLDggKzMyMSw3IEBAIHN0YXRpYyB2b2lkIGhhcF9mcmVlX3AybV9wYWdlKHN0
cnVjdCBkb21haW4gKmQsIHN0cnVjdCBwYWdlX2luZm8gKnBnKQo+ICB9Cj4gIAo+ICAvKiBSZXR1
cm4gdGhlIHNpemUgb2YgdGhlIHBvb2wsIHJvdW5kZWQgdXAgdG8gdGhlIG5lYXJlc3QgTUIgKi8K
PiAtc3RhdGljIHVuc2lnbmVkIGludAo+IC1oYXBfZ2V0X2FsbG9jYXRpb24oc3RydWN0IGRvbWFp
biAqZCkKPiArdW5zaWduZWQgaW50IGhhcF9nZXRfYWxsb2NhdGlvbihzdHJ1Y3QgZG9tYWluICpk
KQo+ICB7Cj4gICAgICB1bnNpZ25lZCBpbnQgcGcgPSBkLT5hcmNoLnBhZ2luZy5oYXAudG90YWxf
cGFnZXMKPiAgICAgICAgICArIGQtPmFyY2gucGFnaW5nLmhhcC5wMm1fcGFnZXM7Cj4gZGlmZiAt
LWdpdCBhL3hlbi9hcmNoL3g4Ni9tbS9tZW1fc2hhcmluZy5jIGIveGVuL2FyY2gveDg2L21tL21l
bV9zaGFyaW5nLmMKPiBpbmRleCAzODM1YmM5MjhmLi44ZWUzN2U2OTQzIDEwMDY0NAo+IC0tLSBh
L3hlbi9hcmNoL3g4Ni9tbS9tZW1fc2hhcmluZy5jCj4gKysrIGIveGVuL2FyY2gveDg2L21tL21l
bV9zaGFyaW5nLmMKPiBAQCAtMjIsNiArMjIsNyBAQAo+ICAKPiAgI2luY2x1ZGUgPHhlbi90eXBl
cy5oPgo+ICAjaW5jbHVkZSA8eGVuL2RvbWFpbl9wYWdlLmg+Cj4gKyNpbmNsdWRlIDx4ZW4vZXZl
bnQuaD4KPiAgI2luY2x1ZGUgPHhlbi9zcGlubG9jay5oPgo+ICAjaW5jbHVkZSA8eGVuL3J3bG9j
ay5oPgo+ICAjaW5jbHVkZSA8eGVuL21tLmg+Cj4gQEAgLTM2LDYgKzM3LDggQEAKPiAgI2luY2x1
ZGUgPGFzbS9hbHRwMm0uaD4KPiAgI2luY2x1ZGUgPGFzbS9hdG9taWMuaD4KPiAgI2luY2x1ZGUg
PGFzbS9ldmVudC5oPgo+ICsjaW5jbHVkZSA8YXNtL2hhcC5oPgo+ICsjaW5jbHVkZSA8YXNtL2h2
bS9odm0uaD4KPiAgI2luY2x1ZGUgPHhzbS94c20uaD4KPiAgCj4gICNpbmNsdWRlICJtbS1sb2Nr
cy5oIgo+IEBAIC0xNDQ0LDYgKzE0NDcsMjYzIEBAIHN0YXRpYyBpbmxpbmUgaW50IG1lbV9zaGFy
aW5nX2NvbnRyb2woc3RydWN0IGRvbWFpbiAqZCwgYm9vbCBlbmFibGUpCj4gICAgICByZXR1cm4g
MDsKPiAgfQo+ICAKPiArLyoKPiArICogRm9ya2luZyBhIHBhZ2Ugb25seSBnZXRzIGNhbGxlZCB3
aGVuIHRoZSBWTSBmYXVsdHMgZHVlIHRvIG5vIGVudHJ5IGJlaW5nCj4gKyAqIGluIHRoZSBFUFQg
Zm9yIHRoZSBhY2Nlc3MuIERlcGVuZGluZyBvbiB0aGUgdHlwZSBvZiBhY2Nlc3Mgd2UgZWl0aGVy
Cj4gKyAqIHBvcHVsYXRlIHRoZSBwaHlzbWFwIHdpdGggYSBzaGFyZWQgZW50cnkgZm9yIHJlYWQt
b25seSBhY2Nlc3Mgb3IKPiArICogZm9yayB0aGUgcGFnZSBpZiBpdHMgYSB3cml0ZSBhY2Nlc3Mu
Cj4gKyAqCj4gKyAqIFRoZSBjbGllbnQgcDJtIGlzIGFscmVhZHkgbG9ja2VkIHNvIHdlIG9ubHkg
bmVlZCB0byBsb2NrCj4gKyAqIHRoZSBwYXJlbnQncyBoZXJlLgo+ICsgKi8KPiAraW50IG1lbV9z
aGFyaW5nX2ZvcmtfcGFnZShzdHJ1Y3QgZG9tYWluICpkLCBnZm5fdCBnZm4sIGJvb2wgdW5zaGFy
aW5nKQo+ICt7Cj4gKyAgICBpbnQgcmMgPSAtRU5PRU5UOwo+ICsgICAgc2hyX2hhbmRsZV90IGhh
bmRsZTsKPiArICAgIHN0cnVjdCBkb21haW4gKnBhcmVudCA9IGQtPnBhcmVudDsKPiArICAgIHN0
cnVjdCBwMm1fZG9tYWluICpwMm07Cj4gKyAgICB1bnNpZ25lZCBsb25nIGdmbl9sID0gZ2ZuX3go
Z2ZuKTsKPiArICAgIG1mbl90IG1mbiwgbmV3X21mbjsKPiArICAgIHAybV90eXBlX3QgcDJtdDsK
PiArICAgIHN0cnVjdCBwYWdlX2luZm8gKnBhZ2U7Cj4gKwo+ICsgICAgaWYgKCAhbWVtX3NoYXJp
bmdfaXNfZm9yayhkKSApCj4gKyAgICAgICAgcmV0dXJuIC1FTk9FTlQ7Cj4gKwo+ICsgICAgaWYg
KCAhdW5zaGFyaW5nICkKPiArICAgIHsKPiArICAgICAgICAvKiBGb3IgcmVhZC1vbmx5IGFjY2Vz
c2VzIHdlIGp1c3QgYWRkIGEgc2hhcmVkIGVudHJ5IHRvIHRoZSBwaHlzbWFwICovCj4gKyAgICAg
ICAgd2hpbGUgKCBwYXJlbnQgKQo+ICsgICAgICAgIHsKPiArICAgICAgICAgICAgaWYgKCAhKHJj
ID0gbm9taW5hdGVfcGFnZShwYXJlbnQsIGdmbiwgMCwgJmhhbmRsZSkpICkKPiArICAgICAgICAg
ICAgICAgIGJyZWFrOwo+ICsKPiArICAgICAgICAgICAgcGFyZW50ID0gcGFyZW50LT5wYXJlbnQ7
Cj4gKyAgICAgICAgfQo+ICsKPiArICAgICAgICBpZiAoICFyYyApCj4gKyAgICAgICAgewo+ICsg
ICAgICAgICAgICAvKiBUaGUgY2xpZW50J3MgcDJtIGlzIGFscmVhZHkgbG9ja2VkICovCj4gKyAg
ICAgICAgICAgIHN0cnVjdCBwMm1fZG9tYWluICpwcDJtID0gcDJtX2dldF9ob3N0cDJtKHBhcmVu
dCk7Cj4gKwo+ICsgICAgICAgICAgICBwMm1fbG9jayhwcDJtKTsKPiArICAgICAgICAgICAgcmMg
PSBhZGRfdG9fcGh5c21hcChwYXJlbnQsIGdmbl9sLCBoYW5kbGUsIGQsIGdmbl9sLCBmYWxzZSk7
Cj4gKyAgICAgICAgICAgIHAybV91bmxvY2socHAybSk7Cj4gKwo+ICsgICAgICAgICAgICBpZiAo
ICFyYyApCj4gKyAgICAgICAgICAgICAgICByZXR1cm4gMDsKPiArICAgICAgICB9Cj4gKyAgICB9
Cj4gKwo+ICsgICAgLyoKPiArICAgICAqIElmIGl0J3MgYSB3cml0ZSBhY2Nlc3MgKGllLiB1bnNo
YXJpbmcpIG9yIGlmIGFkZGluZyBhIHNoYXJlZCBlbnRyeSB0bwo+ICsgICAgICogdGhlIHBoeXNt
YXAgZmFpbGVkIHdlJ2xsIGZvcmsgdGhlIHBhZ2UgZGlyZWN0bHkuCj4gKyAgICAgKi8KPiArICAg
IHAybSA9IHAybV9nZXRfaG9zdHAybShkKTsKPiArICAgIHBhcmVudCA9IGQtPnBhcmVudDsKPiAr
Cj4gKyAgICB3aGlsZSAoIHBhcmVudCApCj4gKyAgICB7Cj4gKyAgICAgICAgbWZuID0gZ2V0X2dm
bl9xdWVyeShwYXJlbnQsIGdmbl9sLCAmcDJtdCk7Cj4gKwo+ICsgICAgICAgIC8qCj4gKyAgICAg
ICAgICogV2UgY2FuJ3QgZm9yayBncmFudCBtZW1vcnkgZnJvbSB0aGUgcGFyZW50LCBvbmx5IHJl
Z3VsYXIgcmFtLgo+ICsgICAgICAgICAqLwo+ICsgICAgICAgIGlmICggbWZuX3ZhbGlkKG1mbikg
JiYgcDJtX2lzX3JhbShwMm10KSApCj4gKyAgICAgICAgICAgIGJyZWFrOwo+ICsKPiArICAgICAg
ICBwdXRfZ2ZuKHBhcmVudCwgZ2ZuX2wpOwo+ICsgICAgICAgIHBhcmVudCA9IHBhcmVudC0+cGFy
ZW50Owo+ICsgICAgfQo+ICsKPiArICAgIGlmICggIXBhcmVudCApCj4gKyAgICAgICAgcmV0dXJu
IC1FTk9FTlQ7Cj4gKwo+ICsgICAgaWYgKCAhKHBhZ2UgPSBhbGxvY19kb21oZWFwX3BhZ2UoZCwg
MCkpICkKPiArICAgIHsKPiArICAgICAgICBwdXRfZ2ZuKHBhcmVudCwgZ2ZuX2wpOwo+ICsgICAg
ICAgIHJldHVybiAtRU5PTUVNOwo+ICsgICAgfQo+ICsKPiArICAgIG5ld19tZm4gPSBwYWdlX3Rv
X21mbihwYWdlKTsKPiArICAgIGNvcHlfZG9tYWluX3BhZ2UobmV3X21mbiwgbWZuKTsKPiArICAg
IHNldF9ncGZuX2Zyb21fbWZuKG1mbl94KG5ld19tZm4pLCBnZm5fbCk7Cj4gKwo+ICsgICAgcHV0
X2dmbihwYXJlbnQsIGdmbl9sKTsKPiArCj4gKyAgICByZXR1cm4gcDJtLT5zZXRfZW50cnkocDJt
LCBnZm4sIG5ld19tZm4sIFBBR0VfT1JERVJfNEssIHAybV9yYW1fcncsCj4gKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgcDJtLT5kZWZhdWx0X2FjY2VzcywgLTEpOwo+ICt9Cj4gKwo+ICtzdGF0
aWMgaW50IGJyaW5nX3VwX3ZjcHVzKHN0cnVjdCBkb21haW4gKmNkLCBzdHJ1Y3QgZG9tYWluICpk
KQo+ICt7Cj4gKyAgICB1bnNpZ25lZCBpbnQgaTsKPiArICAgIHN0cnVjdCBwMm1fZG9tYWluICpw
Mm0gPSBwMm1fZ2V0X2hvc3RwMm0oY2QpOwo+ICsgICAgaW50IHJldCA9IC1FSU5WQUw7Cj4gKwo+
ICsgICAgaWYgKCBkLT5tYXhfdmNwdXMgIT0gY2QtPm1heF92Y3B1cyApCj4gKyAgICAgICAgcmV0
dXJuIHJldDsKPiArCj4gKyAgICBpZiAoIChyZXQgPSBjcHVwb29sX21vdmVfZG9tYWluKGNkLCBk
LT5jcHVwb29sKSkgKQo+ICsgICAgICAgIHJldHVybiByZXQ7CgpZb3UgY2FuIGpvaW4gYm90aCBp
ZnMgaW50byBhIHNpbmdsZSBvbmUsIHNpbmNlIGJvdGggcmV0dXJuIHJldC4KCj4gKwo+ICsgICAg
Zm9yICggaSA9IDA7IGkgPCBjZC0+bWF4X3ZjcHVzOyBpKysgKQo+ICsgICAgewo+ICsgICAgICAg
IG1mbl90IHZjcHVfaW5mb19tZm47Cj4gKwo+ICsgICAgICAgIGlmICggIWQtPnZjcHVbaV0gfHwg
Y2QtPnZjcHVbaV0gKQo+ICsgICAgICAgICAgICBjb250aW51ZTsKPiArCj4gKyAgICAgICAgaWYg
KCAhdmNwdV9jcmVhdGUoY2QsIGkpICkKPiArICAgICAgICAgICAgcmV0dXJuIC1FSU5WQUw7Cj4g
Kwo+ICsgICAgICAgIC8qCj4gKyAgICAgICAgICogTWFwIGluIGEgcGFnZSBmb3IgdGhlIHZjcHVf
aW5mbyBpZiB0aGUgZ3Vlc3QgdXNlcyBvbmUgdG8gdGhlIGV4YWN0Cj4gKyAgICAgICAgICogc2Ft
ZSBzcG90Lgo+ICsgICAgICAgICAqLwo+ICsgICAgICAgIHZjcHVfaW5mb19tZm4gPSBkLT52Y3B1
W2ldLT52Y3B1X2luZm9fbWZuOwo+ICsgICAgICAgIGlmICggIW1mbl9lcSh2Y3B1X2luZm9fbWZu
LCBJTlZBTElEX01GTikgKQo+ICsgICAgICAgIHsKPiArICAgICAgICAgICAgc3RydWN0IHBhZ2Vf
aW5mbyAqcGFnZTsKPiArICAgICAgICAgICAgbWZuX3QgbmV3X21mbjsKPiArICAgICAgICAgICAg
Z2ZuX3QgZ2ZuID0gbWZuX3RvX2dmbihkLCB2Y3B1X2luZm9fbWZuKTsKPiArICAgICAgICAgICAg
dW5zaWduZWQgbG9uZyBnZm5fbCA9IGdmbl94KGdmbik7Cj4gKwo+ICsgICAgICAgICAgICBpZiAo
ICEocGFnZSA9IGFsbG9jX2RvbWhlYXBfcGFnZShjZCwgMCkpICkKPiArICAgICAgICAgICAgICAg
IHJldHVybiAtRU5PTUVNOwo+ICsKPiArICAgICAgICAgICAgbmV3X21mbiA9IHBhZ2VfdG9fbWZu
KHBhZ2UpOwo+ICsgICAgICAgICAgICBzZXRfZ3Bmbl9mcm9tX21mbihtZm5feChuZXdfbWZuKSwg
Z2ZuX2wpOwo+ICsKPiArICAgICAgICAgICAgaWYgKCAhKHJldCA9IHAybS0+c2V0X2VudHJ5KHAy
bSwgZ2ZuLCBuZXdfbWZuLCBQQUdFX09SREVSXzRLLAo+ICsgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgcDJtX3JhbV9ydywgcDJtLT5kZWZhdWx0X2FjY2VzcywgLTEpKSAp
Cj4gKyAgICAgICAgICAgICAgICByZXR1cm4gcmV0Owo+ICsKPiArICAgICAgICAgICAgaWYgKCAh
KHJldCA9IG1hcF92Y3B1X2luZm8oY2QtPnZjcHVbaV0sIGdmbl9sLAo+ICsgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBkLT52Y3B1W2ldLT52Y3B1X2luZm9fb2Zmc2V0KSkg
KQo+ICsgICAgICAgICAgICAgICAgcmV0dXJuIHJldDsKCkkgdGhpbmsgeW91IGFsc28gbmVlZCB0
byBjb3B5IHRoZSBjb250ZW50cyBmcm9tIHRoZSBwYXJlbnQgaW50byB0aG9zZQp2Y3B1X2luZm8g
YXJlYXMsIG9yIGVsc2UgeW91IG1pZ2h0IGRpc2NhcmQgcGVuZGluZyBldmVudCBjaGFubmVscwpj
b250YWluZWQgaW4gdGhlIGV2dGNobl8qIGZpZWxkcz8gKGFuZCB0aGUgbWFza2VkIGNoYW5uZWxz
IGlmIGFueSkuCgpUaGUgcnVudGltZSBhcmVhIHNob3VsZCBiZSBoYW5kbGVkIGluIGEgc2ltaWxh
ciB3YXkgQUZBSUNUIChhbGJlaXQKdGhlcmUncyBubyBuZWVkIHRvIGNvcHkgdGhlIHBhcmVudCdz
IGRhdGEgaW4gdGhhdCBjYXNlKSwgc2VlClZDUFVPUF9yZWdpc3Rlcl9ydW5zdGF0ZV9tZW1vcnlf
YXJlYS4KCj4gKyAgICAgICAgfQo+ICsgICAgfQo+ICsKPiArICAgIGRvbWFpbl91cGRhdGVfbm9k
ZV9hZmZpbml0eShjZCk7Cj4gKyAgICByZXR1cm4gMDsKPiArfQo+ICsKPiArc3RhdGljIGludCBm
b3JrX2hhcF9hbGxvY2F0aW9uKHN0cnVjdCBkb21haW4gKmNkLCBzdHJ1Y3QgZG9tYWluICpkKQo+
ICt7Cj4gKyAgICBpbnQgcmM7Cj4gKyAgICBib29sIHByZWVtcHRlZDsKPiArICAgIHVuc2lnbmVk
IGxvbmcgbWIgPSBoYXBfZ2V0X2FsbG9jYXRpb24oZCk7Cj4gKwo+ICsgICAgaWYgKCBtYiA9PSBo
YXBfZ2V0X2FsbG9jYXRpb24oY2QpICkKPiArICAgICAgICByZXR1cm4gMDsKPiArCj4gKyAgICBw
YWdpbmdfbG9jayhjZCk7Cj4gKyAgICByYyA9IGhhcF9zZXRfYWxsb2NhdGlvbihjZCwgbWIgPDwg
KDIwIC0gUEFHRV9TSElGVCksICZwcmVlbXB0ZWQpOwo+ICsgICAgcGFnaW5nX3VubG9jayhjZCk7
Cj4gKwo+ICsgICAgcmV0dXJuIHByZWVtcHRlZCA/IC1FUkVTVEFSVCA6IHJjOwo+ICt9Cj4gKwo+
ICtzdGF0aWMgdm9pZCBmb3JrX3RzYyhzdHJ1Y3QgZG9tYWluICpjZCwgc3RydWN0IGRvbWFpbiAq
ZCkKPiArewo+ICsgICAgdWludDMyX3QgdHNjX21vZGU7Cj4gKyAgICB1aW50MzJfdCBndHNjX2to
ejsKPiArICAgIHVpbnQzMl90IGluY2FybmF0aW9uOwo+ICsgICAgdWludDY0X3QgZWxhcHNlZF9u
c2VjOwo+ICsKPiArICAgIHRzY19nZXRfaW5mbyhkLCAmdHNjX21vZGUsICZlbGFwc2VkX25zZWMs
ICZndHNjX2toeiwgJmluY2FybmF0aW9uKTsKPiArICAgIC8qIERvbid0IGJ1bXAgaW5jYXJuYXRp
b24gb24gc2V0ICovCj4gKyAgICB0c2Nfc2V0X2luZm8oY2QsIHRzY19tb2RlLCBlbGFwc2VkX25z
ZWMsIGd0c2Nfa2h6LCBpbmNhcm5hdGlvbiAtIDEpOwo+ICt9Cj4gKwo+ICtzdGF0aWMgaW50IHBv
cHVsYXRlX3NwZWNpYWxfcGFnZXMoc3RydWN0IGRvbWFpbiAqY2QpCj4gK3sKPiArICAgIHN0cnVj
dCBwMm1fZG9tYWluICpwMm0gPSBwMm1fZ2V0X2hvc3RwMm0oY2QpOwo+ICsgICAgc3RhdGljIGNv
bnN0IHVuc2lnbmVkIGludCBwYXJhbXNbXSA9Cj4gKyAgICB7Cj4gKyAgICAgICAgSFZNX1BBUkFN
X1NUT1JFX1BGTiwKPiArICAgICAgICBIVk1fUEFSQU1fSU9SRVFfUEZOLAo+ICsgICAgICAgIEhW
TV9QQVJBTV9CVUZJT1JFUV9QRk4sCj4gKyAgICAgICAgSFZNX1BBUkFNX0NPTlNPTEVfUEZOCj4g
KyAgICB9Owo+ICsgICAgdW5zaWduZWQgaW50IGk7Cj4gKwo+ICsgICAgZm9yICggaT0wOyBpPDQ7
IGkrKyApCgpOaXQ6IGNhbiB5b3UgcGxlYXNlIGFkZCBzb21lIHNwYWNlcyBhcm91bmQgdGhlIG9w
ZXJhdG9ycz8KCj4gKyAgICB7Cj4gKyAgICAgICAgdWludDY0X3QgdmFsdWUgPSAwOwo+ICsgICAg
ICAgIG1mbl90IG5ld19tZm47Cj4gKyAgICAgICAgc3RydWN0IHBhZ2VfaW5mbyAqcGFnZTsKPiAr
Cj4gKyAgICAgICAgaWYgKCBodm1fZ2V0X3BhcmFtKGNkLCBwYXJhbXNbaV0sICZ2YWx1ZSkgfHwg
IXZhbHVlICkKPiArICAgICAgICAgICAgY29udGludWU7Cj4gKwo+ICsgICAgICAgIGlmICggIShw
YWdlID0gYWxsb2NfZG9taGVhcF9wYWdlKGNkLCAwKSkgKQo+ICsgICAgICAgICAgICByZXR1cm4g
LUVOT01FTTsKPiArCj4gKyAgICAgICAgbmV3X21mbiA9IHBhZ2VfdG9fbWZuKHBhZ2UpOwo+ICsg
ICAgICAgIHNldF9ncGZuX2Zyb21fbWZuKG1mbl94KG5ld19tZm4pLCB2YWx1ZSk7Cj4gKwo+ICsg
ICAgICAgIHJldHVybiBwMm0tPnNldF9lbnRyeShwMm0sIF9nZm4odmFsdWUpLCBuZXdfbWZuLCBQ
QUdFX09SREVSXzRLLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwMm1fcmFtX3J3
LCBwMm0tPmRlZmF1bHRfYWNjZXNzLCAtMSk7CgpJIHRoaW5rIHlvdSBhbHNvIG5lZWQgdG8gY29w
eSB0aGUgY29udGVudHMgZnJvbSB0aGUgcGFyZW50IHBhZ2UgaGVyZS4KCj4gKyAgICB9Cj4gKwo+
ICsgICAgcmV0dXJuIDA7Cj4gK30KPiArCj4gK3N0YXRpYyBpbnQgZm9yayhzdHJ1Y3QgZG9tYWlu
ICpkLCBzdHJ1Y3QgZG9tYWluICpjZCkKPiArewo+ICsgICAgaW50IHJjID0gLUVCVVNZOwo+ICsK
PiArICAgIGlmICggIWNkLT5jb250cm9sbGVyX3BhdXNlX2NvdW50ICkKPiArICAgICAgICByZXR1
cm4gcmM7Cj4gKwo+ICsgICAgLyoKPiArICAgICAqIFdlIG9ubHkgd2FudCB0byBnZXQgYW5kIHBh
dXNlIHRoZSBwYXJlbnQgb25jZSwgbm90IGVhY2ggdGltZSB0aGlzCj4gKyAgICAgKiBvcGVyYXRp
b24gaXMgcmVzdGFydGVkIGR1ZSB0byBwcmVlbXB0aW9uLgo+ICsgICAgICovCj4gKyAgICBpZiAo
ICFjZC0+cGFyZW50X3BhdXNlZCApCj4gKyAgICB7Cj4gKyAgICAgICAgaWYgKCAhZ2V0X2RvbWFp
bihkKSApCj4gKyAgICAgICAgewo+ICsgICAgICAgICAgICBBU1NFUlRfVU5SRUFDSEFCTEUoKTsK
PiArICAgICAgICAgICAgcmV0dXJuIC1FQlVTWTsKPiArICAgICAgICB9Cj4gKwo+ICsgICAgICAg
IGRvbWFpbl9wYXVzZShkKTsKPiArICAgICAgICBjZC0+cGFyZW50X3BhdXNlZCA9IHRydWU7Cj4g
KyAgICAgICAgY2QtPm1heF9wYWdlcyA9IGQtPm1heF9wYWdlczsKPiArICAgICAgICBjZC0+bWF4
X3ZjcHVzID0gZC0+bWF4X3ZjcHVzOwo+ICsgICAgfQo+ICsKPiArICAgIC8qIHRoaXMgaXMgcHJl
ZW1wdGlibGUgc28gaXQncyB0aGUgZmlyc3QgdG8gZ2V0IGRvbmUgKi8KPiArICAgIGlmICggKHJj
ID0gZm9ya19oYXBfYWxsb2NhdGlvbihjZCwgZCkpICkKPiArICAgICAgICBnb3RvIGRvbmU7Cj4g
Kwo+ICsgICAgaWYgKCAocmMgPSBicmluZ191cF92Y3B1cyhjZCwgZCkpICkKPiArICAgICAgICBn
b3RvIGRvbmU7Cj4gKwo+ICsgICAgaWYgKCAocmMgPSBodm1fY29weV9jb250ZXh0X2FuZF9wYXJh
bXMoY2QsIGQpKSApCj4gKyAgICAgICAgZ290byBkb25lOwo+ICsKPiArICAgIGlmICggKHJjID0g
cG9wdWxhdGVfc3BlY2lhbF9wYWdlcyhjZCkpICkKPiArICAgICAgICBnb3RvIGRvbmU7Cj4gKwo+
ICsgICAgZm9ya190c2MoY2QsIGQpOwoKSSB0aGluayB5b3UgbmVlZCB0byBjb3B5IHRoZSBjb250
ZW50cyBvZiB0aGUgc2hhcmVkIGluZm8gcGFnZSBmcm9tIHRoZQpwYXJlbnQgaW50byB0aGUgY2hp
bGQsIG9yIGVsc2UgeW91IGFyZSBkaXNjYXJkaW5nIGFueSBwZW5kaW5nIGV2ZW50CmNoYW5uZWxz
LiBZb3Ugc2hvdWxkIGFsc28gbWFwIHN1Y2ggc2hhcmVkIGluZm8gcGFnZSBpbnRvIHRoZSBzYW1l
IGdmbgphcyB0aGUgcGFyZW50LgoKVGhhbmtzLCBSb2dlci4KCl9fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRl
dmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFp
bG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 7F45B2DA55
	for <lists+xen-devel@lfdr.de>; Wed, 29 May 2019 12:21:27 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hVvef-0003IO-Nk; Wed, 29 May 2019 10:17:57 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=9SAg=T5=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1hVvee-0003IJ-St
 for xen-devel@lists.xenproject.org; Wed, 29 May 2019 10:17:56 +0000
X-Inumbo-ID: 048c7eec-81fb-11e9-9ea5-abe0f3483738
Received: from prv1-mh.provo.novell.com (unknown [137.65.248.33])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 048c7eec-81fb-11e9-9ea5-abe0f3483738;
 Wed, 29 May 2019 10:17:53 +0000 (UTC)
Received: from INET-PRV1-MTA by prv1-mh.provo.novell.com
 with Novell_GroupWise; Wed, 29 May 2019 04:17:52 -0600
Message-Id: <5CEE5C4D02000078002335A0@prv1-mh.provo.novell.com>
X-Mailer: Novell GroupWise Internet Agent 18.1.1 
Date: Wed, 29 May 2019 04:17:49 -0600
From: "Jan Beulich" <JBeulich@suse.com>
To: "xen-devel" <xen-devel@lists.xenproject.org>
Mime-Version: 1.0
Content-Disposition: inline
Subject: [Xen-devel] [PATCH] x86/SMP: don't try to stop already stopped CPUs
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>, Wei Liu <wl@xen.org>,
 Roger Pau Monne <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SW4gcGFydGljdWxhciB3aXRoIGFuIGVuYWJsZWQgSU9NTVUgKGJ1dCBub3QgcmVhbGx5IGxpbWl0
ZWQgdG8gdGhpcwpjYXNlKSwgdHJ5aW5nIHRvIGludm9rZSBmaXh1cF9pcnFzKCkgYWZ0ZXIgaGF2
aW5nIGFscmVhZHkgZG9uZQpkaXNhYmxlX0lPX0FQSUMoKSAtPiBjbGVhcl9JT19BUElDKCkgaXMg
YSByYXRoZXIgYmFkIGlkZWE6CgogUklQOiAgICBlMDA4Ols8ZmZmZjgyZDA4MDI2YTAzNj5dIGFt
ZF9pb21tdV9yZWFkX2lvYXBpY19mcm9tX2lyZSsweGRlLzB4MTEzCiBSRkxBR1M6IDAwMDAwMDAw
MDAwMTAwMDYgICBDT05URVhUOiBoeXBlcnZpc29yIChkMHYwKQogcmF4OiBmZmZmODMyMDI5MWRl
MDBjICAgcmJ4OiAwMDAwMDAwMDAwMDAwMDAzICAgcmN4OiBmZmZmODMyMDM1MDAwMDAwCiByZHg6
IDAwMDAwMDAwMDAwMDAwMDAgICByc2k6IDAwMDAwMDAwMDAwMDAwMDAgICByZGk6IGZmZmY4MmQw
ODA1Y2E4NDAKIHJicDogZmZmZjgzMDA5ZThhNzljOCAgIHJzcDogZmZmZjgzMDA5ZThhNzlhOCAg
IHI4OiAgMDAwMDAwMDAwMDAwMDAwMAogcjk6ICAwMDAwMDAwMDAwMDAwMDA0ICAgcjEwOiAwMDAw
MDAwMDAwMDhiOWY5ICAgcjExOiAwMDAwMDAwMDAwMDAwMDA2CiByMTI6IDAwMDAwMDAwMDAwMTAw
MDAgICByMTM6IDAwMDAwMDAwMDAwMDAwMDMgICByMTQ6IDAwMDAwMDAwMDAwMDAwMDAKIHIxNTog
MDAwMDAwMDBmZmZlZmZmZiAgIGNyMDogMDAwMDAwMDA4MDA1MDAzMyAgIGNyNDogMDAwMDAwMDAw
MDM0MDZlMAogY3IzOiAwMDAwMDAyMDM1ZDU5MDAwICAgY3IyOiBmZmZmODg4MjRjY2I0ZWUwCiBm
c2I6IDAwMDA3ZjIxNDNmMDg4NDAgICBnc2I6IGZmZmY4ODgyNTZhMDAwMDAgICBnc3M6IDAwMDAw
MDAwMDAwMDAwMDAKIGRzOiAwMDAwICAgZXM6IDAwMDAgICBmczogMDAwMCAgIGdzOiAwMDAwICAg
c3M6IGUwMTAgICBjczogZTAwOAogWGVuIGNvZGUgYXJvdW5kIDxmZmZmODJkMDgwMjZhMDM2PiAo
YW1kX2lvbW11X3JlYWRfaW9hcGljX2Zyb21faXJlKzB4ZGUvMHgxMTMpOgogIGZmIDA3IDAwIDAw
IDM5IGQzIDc0IDAyIDwwZj4gMGIgNDEgODEgZTQgMDAgZjggZmYgZmYgOGIgMTAgODkgZDAgMjUg
MDAgMDAKIFhlbiBzdGFjayB0cmFjZSBmcm9tIHJzcD1mZmZmODMwMDllOGE3OWE4OgogLi4uCiBY
ZW4gY2FsbCB0cmFjZToKICAgIFs8ZmZmZjgyZDA4MDI2YTAzNj5dIGFtZF9pb21tdV9yZWFkX2lv
YXBpY19mcm9tX2lyZSsweGRlLzB4MTEzCiAgICBbPGZmZmY4MmQwODAyNmJmN2I+XSBpb21tdV9y
ZWFkX2FwaWNfZnJvbV9pcmUrMHgxMC8weDEyCiAgICBbPGZmZmY4MmQwODAyN2Y3MTg+XSBpb19h
cGljLmMjbW9kaWZ5X0lPX0FQSUNfaXJxKzB4NWUvMHgxMjYKICAgIFs8ZmZmZjgyZDA4MDI3Zjlj
NT5dIGlvX2FwaWMuYyN1bm1hc2tfSU9fQVBJQ19pcnErMHgyZC8weDQxCiAgICBbPGZmZmY4MmQw
ODAyODliYzc+XSBmaXh1cF9pcnFzKzB4MzIwLzB4NDBiCiAgICBbPGZmZmY4MmQwODAyYTgyYzQ+
XSBzbXBfc2VuZF9zdG9wKzB4NGIvMHhhOAogICAgWzxmZmZmODJkMDgwMmE3YjJmPl0gbWFjaGlu
ZV9yZXN0YXJ0KzB4OTgvMHgyODgKICAgIFs8ZmZmZjgyZDA4MDI1MjI0Mj5dIGNvbnNvbGVfc3Vz
cGVuZCswLzB4MjgKICAgIFs8ZmZmZjgyZDA4MDJiMDFkYT5dIGRvX2dlbmVyYWxfcHJvdGVjdGlv
bisweDIwNC8weDI0ZQogICAgWzxmZmZmODJkMDgwMzg1YTNkPl0geDg2XzY0L2VudHJ5LlMjaGFu
ZGxlX2V4Y2VwdGlvbl9zYXZlZCsweDY4LzB4OTQKICAgIFs8MDAwMDAwMDBhYTViNTI2Yj5dIDAw
MDAwMDAwYWE1YjUyNmIKICAgIFs8ZmZmZjgyZDA4MDJhN2M3ZD5dIG1hY2hpbmVfcmVzdGFydCsw
eDFlNi8weDI4OAogICAgWzxmZmZmODJkMDgwMjQwZjc1Pl0gaHdkb21fc2h1dGRvd24rMHhhMi8w
eDExZAogICAgWzxmZmZmODJkMDgwMjBiYWEyPl0gZG9tYWluX3NodXRkb3duKzB4NGYvMHhkOAog
ICAgWzxmZmZmODJkMDgwMjNmZTk4Pl0gZG9fc2NoZWRfb3ArMHgxMmYvMHg0MmEKICAgIFs8ZmZm
ZjgyZDA4MDM3ZTQwND5dIHB2X2h5cGVyY2FsbCsweDFlNC8weDU2NAogICAgWzxmZmZmODJkMDgw
Mzg1NDMyPl0gbHN0YXJfZW50ZXIrMHgxMTIvMHgxMjAKCkRvbid0IGNhbGwgZml4dXBfaXJxcygp
IGFuZCBkb24ndCBzZW5kIGFueSBJUEkgaWYgdGhlcmUncyBvbmx5IG9uZQpvbmxpbmUgQ1BVIGFu
eXdheSwgYW5kIGRvbid0IGNhbGwgX19zdG9wX3RoaXNfY3B1KCkgYXQgYWxsIHdoZW4gdGhlIENQ
VQp3ZSdyZSBvbiB3YXMgYWxyZWFkeSBtYXJrZWQgb2ZmbGluZSAoYnkgYSBwcmlvciBpbnZvY2F0
aW9uIG9mCl9fc3RvcF90aGlzX2NwdSgpKS4KClJlcG9ydGVkLWJ5OiBBbmRyZXcgQ29vcGVyIDxh
bmRyZXcuY29vcGVyM0BjaXRyaXguY29tPgpTaWduZWQtb2ZmLWJ5OiBKYW4gQmV1bGljaCA8amJl
dWxpY2hAc3VzZS5jb20+CgotLS0gYS94ZW4vYXJjaC94ODYvc21wLmMKKysrIGIveGVuL2FyY2gv
eDg2L3NtcC5jCkBAIC0zMDIsMjMgKzMwMiwzMSBAQCBzdGF0aWMgdm9pZCBzdG9wX3RoaXNfY3B1
KHZvaWQgKmR1bW15KQogICovCiB2b2lkIHNtcF9zZW5kX3N0b3Aodm9pZCkKIHsKLSAgICBpbnQg
dGltZW91dCA9IDEwOworICAgIHVuc2lnbmVkIGludCBjcHUgPSBzbXBfcHJvY2Vzc29yX2lkKCk7
CiAKLSAgICBsb2NhbF9pcnFfZGlzYWJsZSgpOwotICAgIGZpeHVwX2lycXMoY3B1bWFza19vZihz
bXBfcHJvY2Vzc29yX2lkKCkpLCAwKTsKLSAgICBsb2NhbF9pcnFfZW5hYmxlKCk7Ci0KLSAgICBz
bXBfY2FsbF9mdW5jdGlvbihzdG9wX3RoaXNfY3B1LCBOVUxMLCAwKTsKLQotICAgIC8qIFdhaXQg
MTBtcyBmb3IgYWxsIG90aGVyIENQVXMgdG8gZ28gb2ZmbGluZS4gKi8KLSAgICB3aGlsZSAoIChu
dW1fb25saW5lX2NwdXMoKSA+IDEpICYmICh0aW1lb3V0LS0gPiAwKSApCi0gICAgICAgIG1kZWxh
eSgxKTsKLQotICAgIGxvY2FsX2lycV9kaXNhYmxlKCk7Ci0gICAgZGlzYWJsZV9JT19BUElDKCk7
Ci0gICAgaHBldF9kaXNhYmxlKCk7Ci0gICAgX19zdG9wX3RoaXNfY3B1KCk7Ci0gICAgbG9jYWxf
aXJxX2VuYWJsZSgpOworICAgIGlmICggbnVtX29ubGluZV9jcHVzKCkgPiAxICkKKyAgICB7Cisg
ICAgICAgIGludCB0aW1lb3V0ID0gMTA7CisKKyAgICAgICAgbG9jYWxfaXJxX2Rpc2FibGUoKTsK
KyAgICAgICAgZml4dXBfaXJxcyhjcHVtYXNrX29mKGNwdSksIDApOworICAgICAgICBsb2NhbF9p
cnFfZW5hYmxlKCk7CisKKyAgICAgICAgc21wX2NhbGxfZnVuY3Rpb24oc3RvcF90aGlzX2NwdSwg
TlVMTCwgMCk7CisKKyAgICAgICAgLyogV2FpdCAxMG1zIGZvciBhbGwgb3RoZXIgQ1BVcyB0byBn
byBvZmZsaW5lLiAqLworICAgICAgICB3aGlsZSAoIChudW1fb25saW5lX2NwdXMoKSA+IDEpICYm
ICh0aW1lb3V0LS0gPiAwKSApCisgICAgICAgICAgICBtZGVsYXkoMSk7CisgICAgfQorCisgICAg
aWYgKCBjcHVfb25saW5lKGNwdSkgKQorICAgIHsKKyAgICAgICAgbG9jYWxfaXJxX2Rpc2FibGUo
KTsKKyAgICAgICAgZGlzYWJsZV9JT19BUElDKCk7CisgICAgICAgIGhwZXRfZGlzYWJsZSgpOwor
ICAgICAgICBfX3N0b3BfdGhpc19jcHUoKTsKKyAgICAgICAgbG9jYWxfaXJxX2VuYWJsZSgpOwor
ICAgIH0KIH0KIAogdm9pZCBzbXBfc2VuZF9ubWlfYWxsYnV0c2VsZih2b2lkKQoKCgoKCl9fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWls
aW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVu
cHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

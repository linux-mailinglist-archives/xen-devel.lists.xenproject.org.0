Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 0F15E188907
	for <lists+xen-devel@lfdr.de>; Tue, 17 Mar 2020 16:19:56 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1jEDxz-0001jF-3G; Tue, 17 Mar 2020 15:17:15 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=fiuw=5C=virtuozzo.com=vsementsov@srs-us1.protection.inumbo.net>)
 id 1jEDxx-0001ir-0U
 for xen-devel@lists.xenproject.org; Tue, 17 Mar 2020 15:17:13 +0000
X-Inumbo-ID: 5d9d8b36-6862-11ea-bec1-bc764e2007e4
Received: from EUR04-VI1-obe.outbound.protection.outlook.com (unknown
 [40.107.8.139]) by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 5d9d8b36-6862-11ea-bec1-bc764e2007e4;
 Tue, 17 Mar 2020 15:17:08 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=CcbGzDvgmo4stBOG4bu8vBrLOBsHHyb1orhnCjgKg1wYFc0eKKlWXzkHM+aEtvZV9orOHXfSIcA+lHXOBt+4hvVWd4BA73bFBC7hXTv/GpYXi8R16vYItqlwWpUdu4QSvN9bmwhpmHBSXxzym6br5LMgSjBTW1d9zkwc1+POuOlqa6acHE2mWbHsdPRVNf353YbLHVSOZBOHwoRau9iNodXcUiImSwpRQFLZvoag1xARbQ+r57oOZxf1TAnUelxQEk2egJ0Zgl+w2DE2h8IarzUN/iUseM0g8W9R7SPNjNi2jMcd+ByriW5+M/PGRgflwfacNBu62N1hwNtlb41bpg==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=XwTQjo26AZ7w0MXa3LZcBy1dibOpY9v7cdvOb/3d730=;
 b=mY6tbZaPJChnIgYPz9z2UhwqjHhPDVoDAk+iv++mOigHovD7FOF1Pqob+W80upMrhpBWcPe2Zz9CxZa34xXqe4h4PpgZ4WbkgjWP8yL/87OO+84Nwy9lUeCjle+r8sKniSI24S7h587KaG7EX9DlUKjKH71BYv/TY/kjZ+rrQZT5/CjoNeBGexUXVPAufqR5vggW0xInN3gwn7fY2rB6QYwWk/CDUg9NcgawSewG8MQ2+p1ndJNo2PicAmgEu/lizggtDS66H57OqI1ey5Yg2VRonx2DIdeVTTzDEGQx/1bHxYCnzUyskbAqw9G3VELNf+4LnpsThW5+etFlLa6Qjw==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=virtuozzo.com; dmarc=pass action=none
 header.from=virtuozzo.com; dkim=pass header.d=virtuozzo.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=virtuozzo.com;
 s=selector2;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=XwTQjo26AZ7w0MXa3LZcBy1dibOpY9v7cdvOb/3d730=;
 b=lvrpAZDYBZ167kiV8jcQwrtjWROXyZZ9ivTnZVNADUjiKT2hX1jd0cTfKfppBI6I2Tv0ymcQD0XNob0s1lvM7lRzmVyaAp0/eBRt3zRgfsBbdD/lBxE/RaoplIs+zovAPBblRFueqZP7k5Vb/Q3emMvYKN7c4VDDj5VwCYJiSfw=
Authentication-Results: spf=none (sender IP is )
 smtp.mailfrom=vsementsov@virtuozzo.com; 
Received: from HE1PR0802MB2507.eurprd08.prod.outlook.com (10.175.35.136) by
 HE1PR0802MB2299.eurprd08.prod.outlook.com (10.172.125.13) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2814.22; Tue, 17 Mar 2020 15:17:05 +0000
Received: from HE1PR0802MB2507.eurprd08.prod.outlook.com
 ([fe80::4d32:e4e1:5b9f:240f]) by HE1PR0802MB2507.eurprd08.prod.outlook.com
 ([fe80::4d32:e4e1:5b9f:240f%12]) with mapi id 15.20.2814.021; Tue, 17 Mar
 2020 15:17:05 +0000
From: Vladimir Sementsov-Ogievskiy <vsementsov@virtuozzo.com>
To: qemu-devel@nongnu.org
Date: Tue, 17 Mar 2020 18:16:25 +0300
Message-Id: <20200317151625.20797-10-vsementsov@virtuozzo.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20200317151625.20797-1-vsementsov@virtuozzo.com>
References: <20200317151625.20797-1-vsementsov@virtuozzo.com>
X-ClientProxiedBy: AM0PR10CA0005.EURPRD10.PROD.OUTLOOK.COM
 (2603:10a6:208:17c::15) To HE1PR0802MB2507.eurprd08.prod.outlook.com
 (2603:10a6:3:e1::8)
MIME-Version: 1.0
X-MS-Exchange-MessageSentRepresentingType: 1
Received: from localhost.localdomain (185.215.60.248) by
 AM0PR10CA0005.EURPRD10.PROD.OUTLOOK.COM (2603:10a6:208:17c::15) with
 Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.2835.15 via Frontend
 Transport; Tue, 17 Mar 2020 15:17:04 +0000
X-Mailer: git-send-email 2.21.0
X-Originating-IP: [185.215.60.248]
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: a4de4470-1e7f-4b80-89eb-08d7ca864084
X-MS-TrafficTypeDiagnostic: HE1PR0802MB2299:
X-MS-Exchange-Transport-Forked: True
X-Microsoft-Antispam-PRVS: <HE1PR0802MB2299D7FD8321DD923FADC5B4C1F60@HE1PR0802MB2299.eurprd08.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:111;
X-Forefront-PRVS: 0345CFD558
X-Forefront-Antispam-Report: SFV:NSPM;
 SFS:(10019020)(4636009)(346002)(366004)(39850400004)(376002)(396003)(136003)(199004)(26005)(52116002)(16526019)(86362001)(8676002)(186003)(6916009)(66476007)(7416002)(66556008)(66946007)(8936002)(6666004)(81156014)(6512007)(478600001)(69590400007)(6506007)(36756003)(81166006)(54906003)(6486002)(2906002)(30864003)(316002)(2616005)(4326008)(1076003)(956004)(5660300002);
 DIR:OUT; SFP:1102; SCL:1; SRVR:HE1PR0802MB2299;
 H:HE1PR0802MB2507.eurprd08.prod.outlook.com; FPR:; SPF:None; LANG:en;
 PTR:InfoNoRecords; A:1; 
Received-SPF: None (protection.outlook.com: virtuozzo.com does not designate
 permitted sender hosts)
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam: BCL:0;
X-Microsoft-Antispam-Message-Info: alCQNG+fBTQZPOOWGCgJ18uOgdw+aLj8/rID+FyBePMuqqWTShhzKXGXsZn0yyVJIPOe7rrhg/uiVhW5DbckipS0oNgUKRt7nvXIfAPCI/bSCnK2d2A59TVPOFSk9S3wYp1tl3D08AulTocmBGQdkEgviP0Q7lh+Sf49ijIn0rljGFXvFC7mpuMK7Tu+h8u5Ha5sNsLIPJzWp4zjwyAxU/Q3Y/vbsdJKJ3LhMz7Hh3JwpHhKd+TYLM1DqfOhF/DrHU0NS1Q2lZ8KI5ukaiwK4P6QfnW1B1TeDuZwttxsuD+YveCjX/sL+PopRrUv/WB9gZs8K9oo4PA6fAB5S0Ny/K1qBvLuYyj7VcueaYveyd8iTTg3SLZC/OVLfFbbj2p9EKKEv4JvQGkY+SKUhW03jUCjTVms6YRpOZ5KvivP0ZZF6KisKPv98uBrxGoQn1ShZoRLc3VoJDRMZul3sb/qdUroyGCHUljymqGMdeKp8OQo8Dhv/3ok37m40ZbihMRS
X-MS-Exchange-AntiSpam-MessageData: PtT3V71taMn8mpJsqKU/KLjBWm8Bm8735QN190FFdtlYaPf/jQta2Bo46SH1hJLRjCxDPHoiBUe3uHXVIhLipmcsE8F0x94cOA/kuTW9NzyszuyDIRRJtLGWnDvXm7SZldJ74R7Orx0AFsqaAsfQ+g==
X-OriginatorOrg: virtuozzo.com
X-MS-Exchange-CrossTenant-Network-Message-Id: a4de4470-1e7f-4b80-89eb-08d7ca864084
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 17 Mar 2020 15:17:05.6259 (UTC)
X-MS-Exchange-CrossTenant-FromEntityHeader: Hosted
X-MS-Exchange-CrossTenant-Id: 0bc7f26d-0264-416e-a6fc-8352af79c58f
X-MS-Exchange-CrossTenant-MailboxType: HOSTED
X-MS-Exchange-CrossTenant-UserPrincipalName: 7EMKphGNm8R9ervG41b3mqdED0J9ff4UHsZwsHOI8FoqXGIHWjuWEx/Sd8EKmCvROOIGfXENjR0hTP9Rt7ma6DIfW8o0oGD3ntOqTKk7KpI=
X-MS-Exchange-Transport-CrossTenantHeadersStamped: HE1PR0802MB2299
Subject: [Xen-devel] [PATCH v10 9/9] xen: introduce ERRP_AUTO_PROPAGATE
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Kevin Wolf <kwolf@redhat.com>, vsementsov@virtuozzo.com,
 qemu-block@nongnu.org, Paul Durrant <paul@xen.org>, armbru@redhat.com,
 Greg Kurz <groug@kaod.org>, Stefano Stabellini <sstabellini@kernel.org>,
 Stefan Hajnoczi <stefanha@redhat.com>,
 Anthony Perard <anthony.perard@citrix.com>, xen-devel@lists.xenproject.org,
 Max Reitz <mreitz@redhat.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SWYgd2Ugd2FudCB0byBhZGQgc29tZSBpbmZvIHRvIGVycnAgKGJ5IGVycm9yX3ByZXBlbmQoKSBv
cgplcnJvcl9hcHBlbmRfaGludCgpKSwgd2UgbXVzdCB1c2UgdGhlIEVSUlBfQVVUT19QUk9QQUdB
VEUgbWFjcm8uCk90aGVyd2lzZSwgdGhpcyBpbmZvIHdpbGwgbm90IGJlIGFkZGVkIHdoZW4gZXJy
cCA9PSAmZXJyb3JfZmF0YWwKKHRoZSBwcm9ncmFtIHdpbGwgZXhpdCBwcmlvciB0byB0aGUgZXJy
b3JfYXBwZW5kX2hpbnQoKSBvcgplcnJvcl9wcmVwZW5kKCkgY2FsbCkuICBGaXggc3VjaCBjYXNl
cy4KCklmIHdlIHdhbnQgdG8gY2hlY2sgZXJyb3IgYWZ0ZXIgZXJycC1mdW5jdGlvbiBjYWxsLCB3
ZSBuZWVkIHRvCmludHJvZHVjZSBsb2NhbF9lcnIgYW5kIHRoZW4gcHJvcGFnYXRlIGl0IHRvIGVy
cnAuIEluc3RlYWQsIHVzZQpFUlJQX0FVVE9fUFJPUEFHQVRFIG1hY3JvLCBiZW5lZml0cyBhcmU6
CjEuIE5vIG5lZWQgb2YgZXhwbGljaXQgZXJyb3JfcHJvcGFnYXRlIGNhbGwKMi4gTm8gbmVlZCBv
ZiBleHBsaWNpdCBsb2NhbF9lcnIgdmFyaWFibGU6IHVzZSBlcnJwIGRpcmVjdGx5CjMuIEVSUlBf
QVVUT19QUk9QQUdBVEUgbGVhdmVzIGVycnAgYXMgaXMgaWYgaXQncyBub3QgTlVMTCBvcgogICAm
ZXJyb3JfZmF0YWwsIHRoaXMgbWVhbnMgdGhhdCB3ZSBkb24ndCBicmVhayBlcnJvcl9hYm9ydAog
ICAod2UnbGwgYWJvcnQgb24gZXJyb3Jfc2V0LCBub3Qgb24gZXJyb3JfcHJvcGFnYXRlKQoKVGhp
cyBjb21taXQgaXMgZ2VuZXJhdGVkIGJ5IGNvbW1hbmQKCiAgICBzZWQgLW4gJy9eWDg2IFhlbiBD
UFVzJC8sL14kL3tzL15GOiAvL3B9JyBNQUlOVEFJTkVSUyB8IFwKICAgIHhhcmdzIGdpdCBscy1m
aWxlcyB8IGdyZXAgJ1wuW2hjXSQnIHwgXAogICAgeGFyZ3Mgc3BhdGNoIFwKICAgICAgICAtLXNw
LWZpbGUgc2NyaXB0cy9jb2NjaW5lbGxlL2F1dG8tcHJvcGFnYXRlZC1lcnJwLmNvY2NpIFwKICAg
ICAgICAtLW1hY3JvLWZpbGUgc2NyaXB0cy9jb2NjaS1tYWNyby1maWxlLmggXAogICAgICAgIC0t
aW4tcGxhY2UgLS1uby1zaG93LWRpZmYgLS1tYXgtd2lkdGggODAKClJlcG9ydGVkLWJ5OiBLZXZp
biBXb2xmIDxrd29sZkByZWRoYXQuY29tPgpSZXBvcnRlZC1ieTogR3JlZyBLdXJ6IDxncm91Z0Br
YW9kLm9yZz4KU2lnbmVkLW9mZi1ieTogVmxhZGltaXIgU2VtZW50c292LU9naWV2c2tpeSA8dnNl
bWVudHNvdkB2aXJ0dW96em8uY29tPgpSZXZpZXdlZC1ieTogUGF1bCBEdXJyYW50IDxwYXVsQHhl
bi5vcmc+Ci0tLQogaHcvYmxvY2svZGF0YXBsYW5lL3hlbi1ibG9jay5jIHwgIDE3ICsrLS0tCiBo
dy9ibG9jay94ZW4tYmxvY2suYyAgICAgICAgICAgfCAxMjIgKysrKysrKysrKysrKystLS0tLS0t
LS0tLS0tLS0tLS0tCiBody9wY2ktaG9zdC94ZW5faWdkX3B0LmMgICAgICAgfCAgIDcgKy0KIGh3
L3hlbi94ZW4tYmFja2VuZC5jICAgICAgICAgICB8ICAgNyArLQogaHcveGVuL3hlbi1idXMuYyAg
ICAgICAgICAgICAgIHwgIDkyICsrKysrKysrKysrLS0tLS0tLS0tLS0tLS0KIGh3L3hlbi94ZW4t
aG9zdC1wY2ktZGV2aWNlLmMgICB8ICAyNyArKysrLS0tLQogaHcveGVuL3hlbl9wdC5jICAgICAg
ICAgICAgICAgIHwgIDI1ICsrKy0tLS0KIGh3L3hlbi94ZW5fcHRfY29uZmlnX2luaXQuYyAgICB8
ICAyMCArKystLS0KIDggZmlsZXMgY2hhbmdlZCwgMTM4IGluc2VydGlvbnMoKyksIDE3OSBkZWxl
dGlvbnMoLSkKCmRpZmYgLS1naXQgYS9ody9ibG9jay9kYXRhcGxhbmUveGVuLWJsb2NrLmMgYi9o
dy9ibG9jay9kYXRhcGxhbmUveGVuLWJsb2NrLmMKaW5kZXggMjg4YTg3YTgxNC4uM2E4NDY5ZmU4
NyAxMDA2NDQKLS0tIGEvaHcvYmxvY2svZGF0YXBsYW5lL3hlbi1ibG9jay5jCisrKyBiL2h3L2Js
b2NrL2RhdGFwbGFuZS94ZW4tYmxvY2suYwpAQCAtNzM5LDggKzczOSw4IEBAIHZvaWQgeGVuX2Js
b2NrX2RhdGFwbGFuZV9zdGFydChYZW5CbG9ja0RhdGFQbGFuZSAqZGF0YXBsYW5lLAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCBwcm90b2NvbCwKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBFcnJvciAqKmVycnApCiB7CisgICAgRVJSUF9BVVRPX1BS
T1BBR0FURSgpOwogICAgIFhlbkRldmljZSAqeGVuZGV2ID0gZGF0YXBsYW5lLT54ZW5kZXY7Ci0g
ICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgdW5zaWduZWQgaW50IHJpbmdfc2l6ZTsK
ICAgICB1bnNpZ25lZCBpbnQgaTsKIApAQCAtNzc2LDkgKzc3Niw4IEBAIHZvaWQgeGVuX2Jsb2Nr
X2RhdGFwbGFuZV9zdGFydChYZW5CbG9ja0RhdGFQbGFuZSAqZGF0YXBsYW5lLAogICAgIH0KIAog
ICAgIHhlbl9kZXZpY2Vfc2V0X21heF9ncmFudF9yZWZzKHhlbmRldiwgZGF0YXBsYW5lLT5ucl9y
aW5nX3JlZiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmbG9jYWxfZXJyKTsK
LSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2Nh
bF9lcnIpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycnApOworICAgIGlm
ICgqZXJycCkgewogICAgICAgICBnb3RvIHN0b3A7CiAgICAgfQogCkBAIC03ODYsOSArNzg1LDgg
QEAgdm9pZCB4ZW5fYmxvY2tfZGF0YXBsYW5lX3N0YXJ0KFhlbkJsb2NrRGF0YVBsYW5lICpkYXRh
cGxhbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0
YXBsYW5lLT5yaW5nX3JlZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBkYXRhcGxhbmUtPm5yX3JpbmdfcmVmLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIFBST1RfUkVBRCB8IFBST1RfV1JJVEUsCi0gICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJmxvY2FsX2Vycik7Ci0gICAgaWYg
KGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJwKTsKKyAg
ICBpZiAoKmVycnApIHsKICAgICAgICAgZ290byBzdG9wOwogICAgIH0KIApAQCAtODIxLDkgKzgx
OSw4IEBAIHZvaWQgeGVuX2Jsb2NrX2RhdGFwbGFuZV9zdGFydChYZW5CbG9ja0RhdGFQbGFuZSAq
ZGF0YXBsYW5lLAogICAgIGRhdGFwbGFuZS0+ZXZlbnRfY2hhbm5lbCA9CiAgICAgICAgIHhlbl9k
ZXZpY2VfYmluZF9ldmVudF9jaGFubmVsKHhlbmRldiwgZXZlbnRfY2hhbm5lbCwKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeGVuX2Jsb2NrX2RhdGFwbGFuZV9ldmVudCwg
ZGF0YXBsYW5lLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmbG9jYWxf
ZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJw
LCBsb2NhbF9lcnIpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJw
KTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ290byBzdG9wOwogICAgIH0KIApkaWZmIC0t
Z2l0IGEvaHcvYmxvY2sveGVuLWJsb2NrLmMgYi9ody9ibG9jay94ZW4tYmxvY2suYwppbmRleCA3
YjNiNmRlZTk3Li41ZDRjOTQxODFjIDEwMDY0NAotLS0gYS9ody9ibG9jay94ZW4tYmxvY2suYwor
KysgYi9ody9ibG9jay94ZW4tYmxvY2suYwpAQCAtMTk1LDYgKzE5NSw3IEBAIHN0YXRpYyBjb25z
dCBCbG9ja0Rldk9wcyB4ZW5fYmxvY2tfZGV2X29wcyA9IHsKIAogc3RhdGljIHZvaWQgeGVuX2Js
b2NrX3JlYWxpemUoWGVuRGV2aWNlICp4ZW5kZXYsIEVycm9yICoqZXJycCkKIHsKKyAgICBFUlJQ
X0FVVE9fUFJPUEFHQVRFKCk7CiAgICAgWGVuQmxvY2tEZXZpY2UgKmJsb2NrZGV2ID0gWEVOX0JM
T0NLX0RFVklDRSh4ZW5kZXYpOwogICAgIFhlbkJsb2NrRGV2aWNlQ2xhc3MgKmJsb2NrZGV2X2Ns
YXNzID0KICAgICAgICAgWEVOX0JMT0NLX0RFVklDRV9HRVRfQ0xBU1MoeGVuZGV2KTsKQEAgLTIw
Miw3ICsyMDMsNiBAQCBzdGF0aWMgdm9pZCB4ZW5fYmxvY2tfcmVhbGl6ZShYZW5EZXZpY2UgKnhl
bmRldiwgRXJyb3IgKiplcnJwKQogICAgIFhlbkJsb2NrVmRldiAqdmRldiA9ICZibG9ja2Rldi0+
cHJvcHMudmRldjsKICAgICBCbG9ja0NvbmYgKmNvbmYgPSAmYmxvY2tkZXYtPnByb3BzLmNvbmY7
CiAgICAgQmxvY2tCYWNrZW5kICpibGsgPSBjb25mLT5ibGs7Ci0gICAgRXJyb3IgKmxvY2FsX2Vy
ciA9IE5VTEw7CiAKICAgICBpZiAodmRldi0+dHlwZSA9PSBYRU5fQkxPQ0tfVkRFVl9UWVBFX0lO
VkFMSUQpIHsKICAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAidmRldiBwcm9wZXJ0eSBub3Qgc2V0
Iik7CkBAIC0yMTIsOSArMjEyLDggQEAgc3RhdGljIHZvaWQgeGVuX2Jsb2NrX3JlYWxpemUoWGVu
RGV2aWNlICp4ZW5kZXYsIEVycm9yICoqZXJycCkKICAgICB0cmFjZV94ZW5fYmxvY2tfcmVhbGl6
ZSh0eXBlLCB2ZGV2LT5kaXNrLCB2ZGV2LT5wYXJ0aXRpb24pOwogCiAgICAgaWYgKGJsb2NrZGV2
X2NsYXNzLT5yZWFsaXplKSB7Ci0gICAgICAgIGJsb2NrZGV2X2NsYXNzLT5yZWFsaXplKGJsb2Nr
ZGV2LCAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICAgICAg
ZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgIGJsb2NrZGV2X2NsYXNz
LT5yZWFsaXplKGJsb2NrZGV2LCBlcnJwKTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAg
ICAgICByZXR1cm47CiAgICAgICAgIH0KICAgICB9CkBAIC0yODQsOCArMjgzLDggQEAgc3RhdGlj
IHZvaWQgeGVuX2Jsb2NrX2Zyb250ZW5kX2NoYW5nZWQoWGVuRGV2aWNlICp4ZW5kZXYsCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnVtIHhlbmJ1c19zdGF0ZSBmcm9u
dGVuZF9zdGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVycm9y
ICoqZXJycCkKIHsKKyAgICBFUlJQX0FVVE9fUFJPUEFHQVRFKCk7CiAgICAgZW51bSB4ZW5idXNf
c3RhdGUgYmFja2VuZF9zdGF0ZSA9IHhlbl9kZXZpY2VfYmFja2VuZF9nZXRfc3RhdGUoeGVuZGV2
KTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAogICAgIHN3aXRjaCAoZnJvbnRlbmRf
c3RhdGUpIHsKICAgICBjYXNlIFhlbmJ1c1N0YXRlSW5pdGlhbGlzZWQ6CkBAIC0yOTQsMTUgKzI5
MywxMyBAQCBzdGF0aWMgdm9pZCB4ZW5fYmxvY2tfZnJvbnRlbmRfY2hhbmdlZChYZW5EZXZpY2Ug
KnhlbmRldiwKICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICB9CiAKLSAgICAgICAgeGVuX2Js
b2NrX2Rpc2Nvbm5lY3QoeGVuZGV2LCAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYgKGxvY2FsX2Vy
cikgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAg
ICAgIHhlbl9ibG9ja19kaXNjb25uZWN0KHhlbmRldiwgZXJycCk7CisgICAgICAgIGlmICgqZXJy
cCkgewogICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgIH0KIAotICAgICAgICB4ZW5fYmxvY2tf
Y29ubmVjdCh4ZW5kZXYsICZsb2NhbF9lcnIpOwotICAgICAgICBpZiAobG9jYWxfZXJyKSB7Ci0g
ICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgeGVu
X2Jsb2NrX2Nvbm5lY3QoeGVuZGV2LCBlcnJwKTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAg
ICAgICAgICBicmVhazsKICAgICAgICAgfQogCkBAIC0zMTUsOSArMzEyLDggQEAgc3RhdGljIHZv
aWQgeGVuX2Jsb2NrX2Zyb250ZW5kX2NoYW5nZWQoWGVuRGV2aWNlICp4ZW5kZXYsCiAKICAgICBj
YXNlIFhlbmJ1c1N0YXRlQ2xvc2VkOgogICAgIGNhc2UgWGVuYnVzU3RhdGVVbmtub3duOgotICAg
ICAgICB4ZW5fYmxvY2tfZGlzY29ubmVjdCh4ZW5kZXYsICZsb2NhbF9lcnIpOwotICAgICAgICBp
ZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxf
ZXJyKTsKKyAgICAgICAgeGVuX2Jsb2NrX2Rpc2Nvbm5lY3QoeGVuZGV2LCBlcnJwKTsKKyAgICAg
ICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICBicmVhazsKICAgICAgICAgfQogCkBAIC00MDQs
MTAgKzQwMCwxMCBAQCBzdGF0aWMgaW50IHZiZF9uYW1lX3RvX2Rpc2soY29uc3QgY2hhciAqbmFt
ZSwgY29uc3QgY2hhciAqKmVuZHAsCiBzdGF0aWMgdm9pZCB4ZW5fYmxvY2tfc2V0X3ZkZXYoT2Jq
ZWN0ICpvYmosIFZpc2l0b3IgKnYsIGNvbnN0IGNoYXIgKm5hbWUsCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgdm9pZCAqb3BhcXVlLCBFcnJvciAqKmVycnApCiB7CisgICAgRVJSUF9B
VVRPX1BST1BBR0FURSgpOwogICAgIERldmljZVN0YXRlICpkZXYgPSBERVZJQ0Uob2JqKTsKICAg
ICBQcm9wZXJ0eSAqcHJvcCA9IG9wYXF1ZTsKICAgICBYZW5CbG9ja1ZkZXYgKnZkZXYgPSBxZGV2
X2dldF9wcm9wX3B0cihkZXYsIHByb3ApOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwog
ICAgIGNoYXIgKnN0ciwgKnA7CiAgICAgY29uc3QgY2hhciAqZW5kOwogCkBAIC00MTYsOSArNDEy
LDggQEAgc3RhdGljIHZvaWQgeGVuX2Jsb2NrX3NldF92ZGV2KE9iamVjdCAqb2JqLCBWaXNpdG9y
ICp2LCBjb25zdCBjaGFyICpuYW1lLAogICAgICAgICByZXR1cm47CiAgICAgfQogCi0gICAgdmlz
aXRfdHlwZV9zdHIodiwgbmFtZSwgJnN0ciwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2Vy
cikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICB2aXNp
dF90eXBlX3N0cih2LCBuYW1lLCAmc3RyLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAg
ICAgcmV0dXJuOwogICAgIH0KIApAQCAtNjcyLDkgKzY2Nyw5IEBAIHN0YXRpYyB2b2lkIHhlbl9i
bG9ja19ibG9ja2Rldl9kZWwoY29uc3QgY2hhciAqbm9kZV9uYW1lLCBFcnJvciAqKmVycnApCiBz
dGF0aWMgY2hhciAqeGVuX2Jsb2NrX2Jsb2NrZGV2X2FkZChjb25zdCBjaGFyICppZCwgUURpY3Qg
KnFkaWN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJw
KQogeworICAgIEVSUlBfQVVUT19QUk9QQUdBVEUoKTsKICAgICBjb25zdCBjaGFyICpkcml2ZXIg
PSBxZGljdF9nZXRfdHJ5X3N0cihxZGljdCwgImRyaXZlciIpOwogICAgIEJsb2NrZGV2T3B0aW9u
cyAqb3B0aW9ucyA9IE5VTEw7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgY2hh
ciAqbm9kZV9uYW1lOwogICAgIFZpc2l0b3IgKnY7CiAKQEAgLTY4OSwxOCArNjg0LDE2IEBAIHN0
YXRpYyBjaGFyICp4ZW5fYmxvY2tfYmxvY2tkZXZfYWRkKGNvbnN0IGNoYXIgKmlkLCBRRGljdCAq
cWRpY3QsCiAgICAgdHJhY2VfeGVuX2Jsb2NrX2Jsb2NrZGV2X2FkZChub2RlX25hbWUpOwogCiAg
ICAgdiA9IHFvYmplY3RfaW5wdXRfdmlzaXRvcl9uZXcoUU9CSkVDVChxZGljdCkpOwotICAgIHZp
c2l0X3R5cGVfQmxvY2tkZXZPcHRpb25zKHYsIE5VTEwsICZvcHRpb25zLCAmbG9jYWxfZXJyKTsK
KyAgICB2aXNpdF90eXBlX0Jsb2NrZGV2T3B0aW9ucyh2LCBOVUxMLCAmb3B0aW9ucywgZXJycCk7
CiAgICAgdmlzaXRfZnJlZSh2KTsKIAotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJy
b3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAg
IGdvdG8gZmFpbDsKICAgICB9CiAKLSAgICBxbXBfYmxvY2tkZXZfYWRkKG9wdGlvbnMsICZsb2Nh
bF9lcnIpOworICAgIHFtcF9ibG9ja2Rldl9hZGQob3B0aW9ucywgZXJycCk7CiAKLSAgICBpZiAo
bG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwor
ICAgIGlmICgqZXJycCkgewogICAgICAgICBnb3RvIGZhaWw7CiAgICAgfQogCkBAIC03MTksMTQg
KzcxMiwxMiBAQCBmYWlsOgogCiBzdGF0aWMgdm9pZCB4ZW5fYmxvY2tfZHJpdmVfZGVzdHJveShY
ZW5CbG9ja0RyaXZlICpkcml2ZSwgRXJyb3IgKiplcnJwKQogeworICAgIEVSUlBfQVVUT19QUk9Q
QUdBVEUoKTsKICAgICBjaGFyICpub2RlX25hbWUgPSBkcml2ZS0+bm9kZV9uYW1lOwogCiAgICAg
aWYgKG5vZGVfbmFtZSkgewotICAgICAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKLQotICAg
ICAgICB4ZW5fYmxvY2tfYmxvY2tkZXZfZGVsKG5vZGVfbmFtZSwgJmxvY2FsX2Vycik7Ci0gICAg
ICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBs
b2NhbF9lcnIpOworICAgICAgICB4ZW5fYmxvY2tfYmxvY2tkZXZfZGVsKG5vZGVfbmFtZSwgZXJy
cCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9
CiAgICAgICAgIGdfZnJlZShub2RlX25hbWUpOwpAQCAtNzQwLDYgKzczMSw3IEBAIHN0YXRpYyBY
ZW5CbG9ja0RyaXZlICp4ZW5fYmxvY2tfZHJpdmVfY3JlYXRlKGNvbnN0IGNoYXIgKmlkLAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hhciAqZGV2
aWNlX3R5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBR
RGljdCAqb3B0cywgRXJyb3IgKiplcnJwKQogeworICAgIEVSUlBfQVVUT19QUk9QQUdBVEUoKTsK
ICAgICBjb25zdCBjaGFyICpwYXJhbXMgPSBxZGljdF9nZXRfdHJ5X3N0cihvcHRzLCAicGFyYW1z
Iik7CiAgICAgY29uc3QgY2hhciAqbW9kZSA9IHFkaWN0X2dldF90cnlfc3RyKG9wdHMsICJtb2Rl
Iik7CiAgICAgY29uc3QgY2hhciAqZGlyZWN0X2lvX3NhZmUgPSBxZGljdF9nZXRfdHJ5X3N0cihv
cHRzLCAiZGlyZWN0LWlvLXNhZmUiKTsKQEAgLTc0Nyw3ICs3MzksNiBAQCBzdGF0aWMgWGVuQmxv
Y2tEcml2ZSAqeGVuX2Jsb2NrX2RyaXZlX2NyZWF0ZShjb25zdCBjaGFyICppZCwKICAgICBjaGFy
ICpkcml2ZXIgPSBOVUxMOwogICAgIGNoYXIgKmZpbGVuYW1lID0gTlVMTDsKICAgICBYZW5CbG9j
a0RyaXZlICpkcml2ZSA9IE5VTEw7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAg
UURpY3QgKmZpbGVfbGF5ZXI7CiAgICAgUURpY3QgKmRyaXZlcl9sYXllcjsKIApAQCAtODI2LDEz
ICs4MTcsMTIgQEAgc3RhdGljIFhlbkJsb2NrRHJpdmUgKnhlbl9ibG9ja19kcml2ZV9jcmVhdGUo
Y29uc3QgY2hhciAqaWQsCiAKICAgICBnX2Fzc2VydCghZHJpdmUtPm5vZGVfbmFtZSk7CiAgICAg
ZHJpdmUtPm5vZGVfbmFtZSA9IHhlbl9ibG9ja19ibG9ja2Rldl9hZGQoZHJpdmUtPmlkLCBkcml2
ZXJfbGF5ZXIsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
JmxvY2FsX2Vycik7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgZXJycCk7CiAKICAgICBxb2JqZWN0X3VucmVmKGRyaXZlcl9sYXllcik7CiAKIGRvbmU6Ci0g
ICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxf
ZXJyKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgeGVuX2Jsb2NrX2RyaXZlX2Rlc3Ryb3ko
ZHJpdmUsIE5VTEwpOwogICAgICAgICByZXR1cm4gTlVMTDsKICAgICB9CkBAIC04NTcsOCArODQ3
LDggQEAgc3RhdGljIHZvaWQgeGVuX2Jsb2NrX2lvdGhyZWFkX2Rlc3Ryb3koWGVuQmxvY2tJT1Ro
cmVhZCAqaW90aHJlYWQsCiBzdGF0aWMgWGVuQmxvY2tJT1RocmVhZCAqeGVuX2Jsb2NrX2lvdGhy
ZWFkX2NyZWF0ZShjb25zdCBjaGFyICppZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIEVycm9yICoqZXJycCkKIHsKKyAgICBFUlJQX0FVVE9fUFJP
UEFHQVRFKCk7CiAgICAgWGVuQmxvY2tJT1RocmVhZCAqaW90aHJlYWQgPSBnX25ldyhYZW5CbG9j
a0lPVGhyZWFkLCAxKTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBRRGljdCAq
b3B0czsKICAgICBRT2JqZWN0ICpyZXRfZGF0YTsKIApAQCAtODY3LDEzICs4NTcsMTEgQEAgc3Rh
dGljIFhlbkJsb2NrSU9UaHJlYWQgKnhlbl9ibG9ja19pb3RocmVhZF9jcmVhdGUoY29uc3QgY2hh
ciAqaWQsCiAgICAgb3B0cyA9IHFkaWN0X25ldygpOwogICAgIHFkaWN0X3B1dF9zdHIob3B0cywg
InFvbS10eXBlIiwgVFlQRV9JT1RIUkVBRCk7CiAgICAgcWRpY3RfcHV0X3N0cihvcHRzLCAiaWQi
LCBpZCk7Ci0gICAgcW1wX29iamVjdF9hZGQob3B0cywgJnJldF9kYXRhLCAmbG9jYWxfZXJyKTsK
KyAgICBxbXBfb2JqZWN0X2FkZChvcHRzLCAmcmV0X2RhdGEsIGVycnApOwogICAgIHFvYmplY3Rf
dW5yZWYob3B0cyk7CiAgICAgcW9iamVjdF91bnJlZihyZXRfZGF0YSk7CiAKLSAgICBpZiAobG9j
YWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwotCisg
ICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdfZnJlZShpb3RocmVhZC0+aWQpOwogICAgICAgICBn
X2ZyZWUoaW90aHJlYWQpOwogICAgICAgICByZXR1cm4gTlVMTDsKQEAgLTg4NSw2ICs4NzMsNyBA
QCBzdGF0aWMgWGVuQmxvY2tJT1RocmVhZCAqeGVuX2Jsb2NrX2lvdGhyZWFkX2NyZWF0ZShjb25z
dCBjaGFyICppZCwKIHN0YXRpYyB2b2lkIHhlbl9ibG9ja19kZXZpY2VfY3JlYXRlKFhlbkJhY2tl
bmRJbnN0YW5jZSAqYmFja2VuZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IFFEaWN0ICpvcHRzLCBFcnJvciAqKmVycnApCiB7CisgICAgRVJSUF9BVVRPX1BST1BBR0FURSgp
OwogICAgIFhlbkJ1cyAqeGVuYnVzID0geGVuX2JhY2tlbmRfZ2V0X2J1cyhiYWNrZW5kKTsKICAg
ICBjb25zdCBjaGFyICpuYW1lID0geGVuX2JhY2tlbmRfZ2V0X25hbWUoYmFja2VuZCk7CiAgICAg
dW5zaWduZWQgbG9uZyBudW1iZXI7CkBAIC04OTIsNyArODgxLDYgQEAgc3RhdGljIHZvaWQgeGVu
X2Jsb2NrX2RldmljZV9jcmVhdGUoWGVuQmFja2VuZEluc3RhbmNlICpiYWNrZW5kLAogICAgIFhl
bkJsb2NrRHJpdmUgKmRyaXZlID0gTlVMTDsKICAgICBYZW5CbG9ja0lPVGhyZWFkICppb3RocmVh
ZCA9IE5VTEw7CiAgICAgWGVuRGV2aWNlICp4ZW5kZXYgPSBOVUxMOwotICAgIEVycm9yICpsb2Nh
bF9lcnIgPSBOVUxMOwogICAgIGNvbnN0IGNoYXIgKnR5cGU7CiAgICAgWGVuQmxvY2tEZXZpY2Ug
KmJsb2NrZGV2OwogCkBAIC05MjQsNTIgKzkxMiw0OCBAQCBzdGF0aWMgdm9pZCB4ZW5fYmxvY2tf
ZGV2aWNlX2NyZWF0ZShYZW5CYWNrZW5kSW5zdGFuY2UgKmJhY2tlbmQsCiAgICAgICAgIGdvdG8g
ZmFpbDsKICAgICB9CiAKLSAgICBkcml2ZSA9IHhlbl9ibG9ja19kcml2ZV9jcmVhdGUodmRldiwg
ZGV2aWNlX3R5cGUsIG9wdHMsICZsb2NhbF9lcnIpOworICAgIGRyaXZlID0geGVuX2Jsb2NrX2Ry
aXZlX2NyZWF0ZSh2ZGV2LCBkZXZpY2VfdHlwZSwgb3B0cywgZXJycCk7CiAgICAgaWYgKCFkcml2
ZSkgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGVfcHJlcGVuZChlcnJwLCBsb2NhbF9lcnIsICJm
YWlsZWQgdG8gY3JlYXRlIGRyaXZlOiAiKTsKKyAgICAgICAgZXJyb3JfcHJlcGVuZChlcnJwLCAi
ZmFpbGVkIHRvIGNyZWF0ZSBkcml2ZTogIik7CiAgICAgICAgIGdvdG8gZmFpbDsKICAgICB9CiAK
LSAgICBpb3RocmVhZCA9IHhlbl9ibG9ja19pb3RocmVhZF9jcmVhdGUodmRldiwgJmxvY2FsX2Vy
cik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGVfcHJlcGVu
ZChlcnJwLCBsb2NhbF9lcnIsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJmYWls
ZWQgdG8gY3JlYXRlIGlvdGhyZWFkOiAiKTsKKyAgICBpb3RocmVhZCA9IHhlbl9ibG9ja19pb3Ro
cmVhZF9jcmVhdGUodmRldiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CisgICAgICAgIGVycm9y
X3ByZXBlbmQoZXJycCwgImZhaWxlZCB0byBjcmVhdGUgaW90aHJlYWQ6ICIpOwogICAgICAgICBn
b3RvIGZhaWw7CiAgICAgfQogCiAgICAgeGVuZGV2ID0gWEVOX0RFVklDRShxZGV2X2NyZWF0ZShC
VVMoeGVuYnVzKSwgdHlwZSkpOwogICAgIGJsb2NrZGV2ID0gWEVOX0JMT0NLX0RFVklDRSh4ZW5k
ZXYpOwogCi0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9zdHIoT0JKRUNUKHhlbmRldiksIHZkZXYs
ICJ2ZGV2IiwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJv
cl9wcm9wYWdhdGVfcHJlcGVuZChlcnJwLCBsb2NhbF9lcnIsICJmYWlsZWQgdG8gc2V0ICd2ZGV2
JzogIik7CisgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9zdHIoT0JKRUNUKHhlbmRldiksIHZkZXYs
ICJ2ZGV2IiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CisgICAgICAgIGVycm9yX3ByZXBlbmQo
ZXJycCwgImZhaWxlZCB0byBzZXQgJ3ZkZXYnOiAiKTsKICAgICAgICAgZ290byBmYWlsOwogICAg
IH0KIAogICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfc3RyKE9CSkVDVCh4ZW5kZXYpLAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHhlbl9ibG9ja19kcml2ZV9nZXRfbm9kZV9uYW1lKGRyaXZl
KSwgImRyaXZlIiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAmbG9jYWxfZXJyKTsKLSAg
ICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZV9wcmVwZW5kKGVycnAs
IGxvY2FsX2VyciwgImZhaWxlZCB0byBzZXQgJ2RyaXZlJzogIik7CisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CisgICAgICAgIGVycm9yX3ByZXBl
bmQoZXJycCwgImZhaWxlZCB0byBzZXQgJ2RyaXZlJzogIik7CiAgICAgICAgIGdvdG8gZmFpbDsK
ICAgICB9CiAKICAgICBvYmplY3RfcHJvcGVydHlfc2V0X3N0cihPQkpFQ1QoeGVuZGV2KSwgaW90
aHJlYWQtPmlkLCAiaW90aHJlYWQiLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICZsb2Nh
bF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlX3By
ZXBlbmQoZXJycCwgbG9jYWxfZXJyLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAi
ZmFpbGVkIHRvIHNldCAnaW90aHJlYWQnOiAiKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKKyAgICAgICAgZXJyb3JfcHJlcGVuZChlcnJwLCAi
ZmFpbGVkIHRvIHNldCAnaW90aHJlYWQnOiAiKTsKICAgICAgICAgZ290byBmYWlsOwogICAgIH0K
IAogICAgIGJsb2NrZGV2LT5pb3RocmVhZCA9IGlvdGhyZWFkOwogICAgIGJsb2NrZGV2LT5kcml2
ZSA9IGRyaXZlOwogCi0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCh4ZW5kZXYp
LCB0cnVlLCAicmVhbGl6ZWQiLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0g
ICAgICAgIGVycm9yX3Byb3BhZ2F0ZV9wcmVwZW5kKGVycnAsIGxvY2FsX2VyciwKLSAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgInJlYWxpemF0aW9uIG9mIGRldmljZSAlcyBmYWlsZWQ6
ICIsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUpOworICAgIG9iamVjdF9w
cm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoeGVuZGV2KSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7
CisgICAgaWYgKCplcnJwKSB7CisgICAgICAgIGVycm9yX3ByZXBlbmQoZXJycCwgInJlYWxpemF0
aW9uIG9mIGRldmljZSAlcyBmYWlsZWQ6ICIsIHR5cGUpOwogICAgICAgICBnb3RvIGZhaWw7CiAg
ICAgfQogCkBAIC05OTMsMzEgKzk3NywyOSBAQCBmYWlsOgogc3RhdGljIHZvaWQgeGVuX2Jsb2Nr
X2RldmljZV9kZXN0cm95KFhlbkJhY2tlbmRJbnN0YW5jZSAqYmFja2VuZCwKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBFcnJvciAqKmVycnApCiB7CisgICAgRVJSUF9BVVRP
X1BST1BBR0FURSgpOwogICAgIFhlbkRldmljZSAqeGVuZGV2ID0geGVuX2JhY2tlbmRfZ2V0X2Rl
dmljZShiYWNrZW5kKTsKICAgICBYZW5CbG9ja0RldmljZSAqYmxvY2tkZXYgPSBYRU5fQkxPQ0tf
REVWSUNFKHhlbmRldik7CiAgICAgWGVuQmxvY2tWZGV2ICp2ZGV2ID0gJmJsb2NrZGV2LT5wcm9w
cy52ZGV2OwogICAgIFhlbkJsb2NrRHJpdmUgKmRyaXZlID0gYmxvY2tkZXYtPmRyaXZlOwogICAg
IFhlbkJsb2NrSU9UaHJlYWQgKmlvdGhyZWFkID0gYmxvY2tkZXYtPmlvdGhyZWFkOwotICAgIEVy
cm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgdHJhY2VfeGVuX2Jsb2NrX2RldmljZV9kZXN0
cm95KHZkZXYtPm51bWJlcik7CiAKICAgICBvYmplY3RfdW5wYXJlbnQoT0JKRUNUKHhlbmRldikp
OwogCiAgICAgaWYgKGlvdGhyZWFkKSB7Ci0gICAgICAgIHhlbl9ibG9ja19pb3RocmVhZF9kZXN0
cm95KGlvdGhyZWFkLCAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAg
ICAgICAgICAgZXJyb3JfcHJvcGFnYXRlX3ByZXBlbmQoZXJycCwgbG9jYWxfZXJyLAotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAiZmFpbGVkIHRvIGRlc3Ryb3kgaW90aHJlYWQ6ICIp
OworICAgICAgICB4ZW5fYmxvY2tfaW90aHJlYWRfZGVzdHJveShpb3RocmVhZCwgZXJycCk7Cisg
ICAgICAgIGlmICgqZXJycCkgeworICAgICAgICAgICAgZXJyb3JfcHJlcGVuZChlcnJwLCAiZmFp
bGVkIHRvIGRlc3Ryb3kgaW90aHJlYWQ6ICIpOwogICAgICAgICAgICAgcmV0dXJuOwogICAgICAg
ICB9CiAgICAgfQogCiAgICAgaWYgKGRyaXZlKSB7Ci0gICAgICAgIHhlbl9ibG9ja19kcml2ZV9k
ZXN0cm95KGRyaXZlLCAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAg
ICAgICAgICAgZXJyb3JfcHJvcGFnYXRlX3ByZXBlbmQoZXJycCwgbG9jYWxfZXJyLAotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAiZmFpbGVkIHRvIGRlc3Ryb3kgZHJpdmU6ICIpOwor
ICAgICAgICB4ZW5fYmxvY2tfZHJpdmVfZGVzdHJveShkcml2ZSwgZXJycCk7CisgICAgICAgIGlm
ICgqZXJycCkgeworICAgICAgICAgICAgZXJyb3JfcHJlcGVuZChlcnJwLCAiZmFpbGVkIHRvIGRl
c3Ryb3kgZHJpdmU6ICIpOwogICAgICAgICB9CiAgICAgfQogfQpkaWZmIC0tZ2l0IGEvaHcvcGNp
LWhvc3QveGVuX2lnZF9wdC5jIGIvaHcvcGNpLWhvc3QveGVuX2lnZF9wdC5jCmluZGV4IGVmY2M5
MzQ3ZmYuLjI5YWRlOWNhMjUgMTAwNjQ0Ci0tLSBhL2h3L3BjaS1ob3N0L3hlbl9pZ2RfcHQuYwor
KysgYi9ody9wY2ktaG9zdC94ZW5faWdkX3B0LmMKQEAgLTc5LDE3ICs3OSwxNiBAQCBzdGF0aWMg
dm9pZCBob3N0X3BjaV9jb25maWdfcmVhZChpbnQgcG9zLCBpbnQgbGVuLCB1aW50MzJfdCAqdmFs
LCBFcnJvciAqKmVycnApCiAKIHN0YXRpYyB2b2lkIGlnZF9wdF9pNDQwZnhfcmVhbGl6ZShQQ0lE
ZXZpY2UgKnBjaV9kZXYsIEVycm9yICoqZXJycCkKIHsKKyAgICBFUlJQX0FVVE9fUFJPUEFHQVRF
KCk7CiAgICAgdWludDMyX3QgdmFsID0gMDsKICAgICBzaXplX3QgaTsKICAgICBpbnQgcG9zLCBs
ZW47Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICBmb3IgKGkgPSAwOyBpIDwg
QVJSQVlfU0laRShpZ2RfaG9zdF9icmlkZ2VfaW5mb3MpOyBpKyspIHsKICAgICAgICAgcG9zID0g
aWdkX2hvc3RfYnJpZGdlX2luZm9zW2ldLm9mZnNldDsKICAgICAgICAgbGVuID0gaWdkX2hvc3Rf
YnJpZGdlX2luZm9zW2ldLmxlbjsKLSAgICAgICAgaG9zdF9wY2lfY29uZmlnX3JlYWQocG9zLCBs
ZW4sICZ2YWwsICZsb2NhbF9lcnIpOwotICAgICAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAg
ICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgaG9zdF9wY2lf
Y29uZmlnX3JlYWQocG9zLCBsZW4sICZ2YWwsIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsK
ICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQogICAgICAgICBwY2lfZGVmYXVsdF93cml0
ZV9jb25maWcocGNpX2RldiwgcG9zLCB2YWwsIGxlbik7CmRpZmYgLS1naXQgYS9ody94ZW4veGVu
LWJhY2tlbmQuYyBiL2h3L3hlbi94ZW4tYmFja2VuZC5jCmluZGV4IGRhMDY1ZjgxYjcuLjFjYzA2
OTQwNTMgMTAwNjQ0Ci0tLSBhL2h3L3hlbi94ZW4tYmFja2VuZC5jCisrKyBiL2h3L3hlbi94ZW4t
YmFja2VuZC5jCkBAIC05OCw5ICs5OCw5IEBAIHN0YXRpYyB2b2lkIHhlbl9iYWNrZW5kX2xpc3Rf
cmVtb3ZlKFhlbkJhY2tlbmRJbnN0YW5jZSAqYmFja2VuZCkKIHZvaWQgeGVuX2JhY2tlbmRfZGV2
aWNlX2NyZWF0ZShYZW5CdXMgKnhlbmJ1cywgY29uc3QgY2hhciAqdHlwZSwKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGFyICpuYW1lLCBRRGljdCAqb3B0cywgRXJyb3Ig
KiplcnJwKQogeworICAgIEVSUlBfQVVUT19QUk9QQUdBVEUoKTsKICAgICBjb25zdCBYZW5CYWNr
ZW5kSW1wbCAqaW1wbCA9IHhlbl9iYWNrZW5kX3RhYmxlX2xvb2t1cCh0eXBlKTsKICAgICBYZW5C
YWNrZW5kSW5zdGFuY2UgKmJhY2tlbmQ7Ci0gICAgRXJyb3IgKmxvY2FsX2Vycm9yID0gTlVMTDsK
IAogICAgIGlmICghaW1wbCkgewogICAgICAgICByZXR1cm47CkBAIC0xMTAsOSArMTEwLDggQEAg
dm9pZCB4ZW5fYmFja2VuZF9kZXZpY2VfY3JlYXRlKFhlbkJ1cyAqeGVuYnVzLCBjb25zdCBjaGFy
ICp0eXBlLAogICAgIGJhY2tlbmQtPnhlbmJ1cyA9IHhlbmJ1czsKICAgICBiYWNrZW5kLT5uYW1l
ID0gZ19zdHJkdXAobmFtZSk7CiAKLSAgICBpbXBsLT5jcmVhdGUoYmFja2VuZCwgb3B0cywgJmxv
Y2FsX2Vycm9yKTsKLSAgICBpZiAobG9jYWxfZXJyb3IpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFn
YXRlKGVycnAsIGxvY2FsX2Vycm9yKTsKKyAgICBpbXBsLT5jcmVhdGUoYmFja2VuZCwgb3B0cywg
ZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdfZnJlZShiYWNrZW5kLT5uYW1lKTsK
ICAgICAgICAgZ19mcmVlKGJhY2tlbmQpOwogICAgICAgICByZXR1cm47CmRpZmYgLS1naXQgYS9o
dy94ZW4veGVuLWJ1cy5jIGIvaHcveGVuL3hlbi1idXMuYwppbmRleCAxODIzN2IzNGVhLi45NzI1
OWM5NjRiIDEwMDY0NAotLS0gYS9ody94ZW4veGVuLWJ1cy5jCisrKyBiL2h3L3hlbi94ZW4tYnVz
LmMKQEAgLTUzLDkgKzUzLDkgQEAgc3RhdGljIGNoYXIgKnhlbl9kZXZpY2VfZ2V0X2Zyb250ZW5k
X3BhdGgoWGVuRGV2aWNlICp4ZW5kZXYpCiAKIHN0YXRpYyB2b2lkIHhlbl9kZXZpY2VfdW5wbHVn
KFhlbkRldmljZSAqeGVuZGV2LCBFcnJvciAqKmVycnApCiB7CisgICAgRVJSUF9BVVRPX1BST1BB
R0FURSgpOwogICAgIFhlbkJ1cyAqeGVuYnVzID0gWEVOX0JVUyhxZGV2X2dldF9wYXJlbnRfYnVz
KERFVklDRSh4ZW5kZXYpKSk7CiAgICAgY29uc3QgY2hhciAqdHlwZSA9IG9iamVjdF9nZXRfdHlw
ZW5hbWUoT0JKRUNUKHhlbmRldikpOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAg
IHhzX3RyYW5zYWN0aW9uX3QgdGlkOwogCiAgICAgdHJhY2VfeGVuX2RldmljZV91bnBsdWcodHlw
ZSwgeGVuZGV2LT5uYW1lKTsKQEAgLTY5LDE0ICs2OSwxNCBAQCBhZ2FpbjoKICAgICB9CiAKICAg
ICB4c19ub2RlX3ByaW50Zih4ZW5idXMtPnhzaCwgdGlkLCB4ZW5kZXYtPmJhY2tlbmRfcGF0aCwg
Im9ubGluZSIsCi0gICAgICAgICAgICAgICAgICAgJmxvY2FsX2VyciwgIiV1IiwgMCk7Ci0gICAg
aWYgKGxvY2FsX2VycikgeworICAgICAgICAgICAgICAgICAgIGVycnAsICIldSIsIDApOworICAg
IGlmICgqZXJycCkgewogICAgICAgICBnb3RvIGFib3J0OwogICAgIH0KIAogICAgIHhzX25vZGVf
cHJpbnRmKHhlbmJ1cy0+eHNoLCB0aWQsIHhlbmRldi0+YmFja2VuZF9wYXRoLCAic3RhdGUiLAot
ICAgICAgICAgICAgICAgICAgICZsb2NhbF9lcnIsICIldSIsIFhlbmJ1c1N0YXRlQ2xvc2luZyk7
Ci0gICAgaWYgKGxvY2FsX2VycikgeworICAgICAgICAgICAgICAgICAgIGVycnAsICIldSIsIFhl
bmJ1c1N0YXRlQ2xvc2luZyk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8gYWJvcnQ7
CiAgICAgfQogCkBAIC05Niw3ICs5Niw2IEBAIGFib3J0OgogICAgICAqIGZyb20gZW5kaW5nIHRo
ZSB0cmFuc2FjdGlvbi4KICAgICAgKi8KICAgICB4c190cmFuc2FjdGlvbl9lbmQoeGVuYnVzLT54
c2gsIHRpZCwgdHJ1ZSk7Ci0gICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CiB9
CiAKIHN0YXRpYyB2b2lkIHhlbl9idXNfcHJpbnRfZGV2KE1vbml0b3IgKm1vbiwgRGV2aWNlU3Rh
dGUgKmRldiwgaW50IGluZGVudCkKQEAgLTIwNSwxNSArMjA0LDEzIEBAIHN0YXRpYyBYZW5XYXRj
aCAqd2F0Y2hfbGlzdF9hZGQoWGVuV2F0Y2hMaXN0ICp3YXRjaF9saXN0LCBjb25zdCBjaGFyICpu
b2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGFyICprZXksIFhl
bldhdGNoSGFuZGxlciBoYW5kbGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2
b2lkICpvcGFxdWUsIEVycm9yICoqZXJycCkKIHsKKyAgICBFUlJQX0FVVE9fUFJPUEFHQVRFKCk7
CiAgICAgWGVuV2F0Y2ggKndhdGNoID0gbmV3X3dhdGNoKG5vZGUsIGtleSwgaGFuZGxlciwgb3Bh
cXVlKTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAogICAgIG5vdGlmaWVyX2xpc3Rf
YWRkKCZ3YXRjaF9saXN0LT5ub3RpZmllcnMsICZ3YXRjaC0+bm90aWZpZXIpOwogCi0gICAgeHNf
bm9kZV93YXRjaCh3YXRjaF9saXN0LT54c2gsIG5vZGUsIGtleSwgd2F0Y2gtPnRva2VuLCAmbG9j
YWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShl
cnJwLCBsb2NhbF9lcnIpOwotCisgICAgeHNfbm9kZV93YXRjaCh3YXRjaF9saXN0LT54c2gsIG5v
ZGUsIGtleSwgd2F0Y2gtPnRva2VuLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAg
bm90aWZpZXJfcmVtb3ZlKCZ3YXRjaC0+bm90aWZpZXIpOwogICAgICAgICBmcmVlX3dhdGNoKHdh
dGNoKTsKIApAQCAtMjU1LDExICsyNTIsMTEgQEAgc3RhdGljIHZvaWQgeGVuX2J1c19iYWNrZW5k
X2NyZWF0ZShYZW5CdXMgKnhlbmJ1cywgY29uc3QgY2hhciAqdHlwZSwKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hhciAqbmFtZSwgY2hhciAqcGF0aCwKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJwKQogeworICAgIEVSUlBf
QVVUT19QUk9QQUdBVEUoKTsKICAgICB4c190cmFuc2FjdGlvbl90IHRpZDsKICAgICBjaGFyICoq
a2V5OwogICAgIFFEaWN0ICpvcHRzOwogICAgIHVuc2lnbmVkIGludCBpLCBuOwotICAgIEVycm9y
ICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgdHJhY2VfeGVuX2J1c19iYWNrZW5kX2NyZWF0ZSh0
eXBlLCBwYXRoKTsKIApAQCAtMzE0LDEzICszMTEsMTEgQEAgYWdhaW46CiAgICAgICAgIHJldHVy
bjsKICAgICB9CiAKLSAgICB4ZW5fYmFja2VuZF9kZXZpY2VfY3JlYXRlKHhlbmJ1cywgdHlwZSwg
bmFtZSwgb3B0cywgJmxvY2FsX2Vycik7CisgICAgeGVuX2JhY2tlbmRfZGV2aWNlX2NyZWF0ZSh4
ZW5idXMsIHR5cGUsIG5hbWUsIG9wdHMsIGVycnApOwogICAgIHFvYmplY3RfdW5yZWYob3B0cyk7
CiAKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZV9wcmVwZW5k
KGVycnAsIGxvY2FsX2VyciwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImZhaWxl
ZCB0byBjcmVhdGUgJyVzJyBkZXZpY2UgJyVzJzogIiwKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgdHlwZSwgbmFtZSk7CisgICAgaWYgKCplcnJwKSB7CisgICAgICAgIGVycm9yX3By
ZXBlbmQoZXJycCwgImZhaWxlZCB0byBjcmVhdGUgJyVzJyBkZXZpY2UgJyVzJzogIiwgdHlwZSwg
bmFtZSk7CiAgICAgfQogfQogCkBAIC02OTIsOSArNjg3LDkgQEAgc3RhdGljIHZvaWQgeGVuX2Rl
dmljZV9yZW1vdmVfd2F0Y2goWGVuRGV2aWNlICp4ZW5kZXYsIFhlbldhdGNoICp3YXRjaCwKIAog
c3RhdGljIHZvaWQgeGVuX2RldmljZV9iYWNrZW5kX2NyZWF0ZShYZW5EZXZpY2UgKnhlbmRldiwg
RXJyb3IgKiplcnJwKQogeworICAgIEVSUlBfQVVUT19QUk9QQUdBVEUoKTsKICAgICBYZW5CdXMg
KnhlbmJ1cyA9IFhFTl9CVVMocWRldl9nZXRfcGFyZW50X2J1cyhERVZJQ0UoeGVuZGV2KSkpOwog
ICAgIHN0cnVjdCB4c19wZXJtaXNzaW9ucyBwZXJtc1syXTsKLSAgICBFcnJvciAqbG9jYWxfZXJy
ID0gTlVMTDsKIAogICAgIHhlbmRldi0+YmFja2VuZF9wYXRoID0geGVuX2RldmljZV9nZXRfYmFj
a2VuZF9wYXRoKHhlbmRldik7CiAKQEAgLTcwNiwzMCArNzAxLDI3IEBAIHN0YXRpYyB2b2lkIHhl
bl9kZXZpY2VfYmFja2VuZF9jcmVhdGUoWGVuRGV2aWNlICp4ZW5kZXYsIEVycm9yICoqZXJycCkK
ICAgICBnX2Fzc2VydCh4ZW5idXMtPnhzaCk7CiAKICAgICB4c19ub2RlX2NyZWF0ZSh4ZW5idXMt
PnhzaCwgWEJUX05VTEwsIHhlbmRldi0+YmFja2VuZF9wYXRoLCBwZXJtcywKLSAgICAgICAgICAg
ICAgICAgICBBUlJBWV9TSVpFKHBlcm1zKSwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2Vy
cikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGVfcHJlcGVuZChlcnJwLCBsb2NhbF9lcnIsCi0g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJmYWlsZWQgdG8gY3JlYXRlIGJhY2tlbmQ6
ICIpOworICAgICAgICAgICAgICAgICAgIEFSUkFZX1NJWkUocGVybXMpLCBlcnJwKTsKKyAgICBp
ZiAoKmVycnApIHsKKyAgICAgICAgZXJyb3JfcHJlcGVuZChlcnJwLCAiZmFpbGVkIHRvIGNyZWF0
ZSBiYWNrZW5kOiAiKTsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIAogICAgIHhlbmRldi0+YmFj
a2VuZF9zdGF0ZV93YXRjaCA9CiAgICAgICAgIHhlbl9kZXZpY2VfYWRkX3dhdGNoKHhlbmRldiwg
eGVuZGV2LT5iYWNrZW5kX3BhdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzdGF0
ZSIsIHhlbl9kZXZpY2VfYmFja2VuZF9jaGFuZ2VkLAotICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3By
b3BhZ2F0ZV9wcmVwZW5kKGVycnAsIGxvY2FsX2VyciwKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgImZhaWxlZCB0byB3YXRjaCBiYWNrZW5kIHN0YXRlOiAiKTsKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CisgICAgICAgIGVycm9y
X3ByZXBlbmQoZXJycCwgImZhaWxlZCB0byB3YXRjaCBiYWNrZW5kIHN0YXRlOiAiKTsKICAgICAg
ICAgcmV0dXJuOwogICAgIH0KIAogICAgIHhlbmRldi0+YmFja2VuZF9vbmxpbmVfd2F0Y2ggPQog
ICAgICAgICB4ZW5fZGV2aWNlX2FkZF93YXRjaCh4ZW5kZXYsIHhlbmRldi0+YmFja2VuZF9wYXRo
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAib25saW5lIiwgeGVuX2RldmljZV9iYWNr
ZW5kX2NoYW5nZWQsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICZsb2NhbF9lcnIpOwot
ICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlX3ByZXBlbmQoZXJy
cCwgbG9jYWxfZXJyLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZmFpbGVkIHRv
IHdhdGNoIGJhY2tlbmQgb25saW5lOiAiKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ZXJycCk7CisgICAgaWYgKCplcnJwKSB7CisgICAgICAgIGVycm9yX3ByZXBlbmQoZXJycCwgImZh
aWxlZCB0byB3YXRjaCBiYWNrZW5kIG9ubGluZTogIik7CiAgICAgICAgIHJldHVybjsKICAgICB9
CiB9CkBAIC04NjYsOSArODU4LDkgQEAgc3RhdGljIGJvb2wgeGVuX2RldmljZV9mcm9udGVuZF9l
eGlzdHMoWGVuRGV2aWNlICp4ZW5kZXYpCiAKIHN0YXRpYyB2b2lkIHhlbl9kZXZpY2VfZnJvbnRl
bmRfY3JlYXRlKFhlbkRldmljZSAqeGVuZGV2LCBFcnJvciAqKmVycnApCiB7CisgICAgRVJSUF9B
VVRPX1BST1BBR0FURSgpOwogICAgIFhlbkJ1cyAqeGVuYnVzID0gWEVOX0JVUyhxZGV2X2dldF9w
YXJlbnRfYnVzKERFVklDRSh4ZW5kZXYpKSk7CiAgICAgc3RydWN0IHhzX3Blcm1pc3Npb25zIHBl
cm1zWzJdOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgeGVuZGV2LT5mcm9u
dGVuZF9wYXRoID0geGVuX2RldmljZV9nZXRfZnJvbnRlbmRfcGF0aCh4ZW5kZXYpOwogCkBAIC04
ODUsMjAgKzg3NywxOCBAQCBzdGF0aWMgdm9pZCB4ZW5fZGV2aWNlX2Zyb250ZW5kX2NyZWF0ZShY
ZW5EZXZpY2UgKnhlbmRldiwgRXJyb3IgKiplcnJwKQogICAgICAgICBnX2Fzc2VydCh4ZW5idXMt
PnhzaCk7CiAKICAgICAgICAgeHNfbm9kZV9jcmVhdGUoeGVuYnVzLT54c2gsIFhCVF9OVUxMLCB4
ZW5kZXYtPmZyb250ZW5kX3BhdGgsIHBlcm1zLAotICAgICAgICAgICAgICAgICAgICAgICBBUlJB
WV9TSVpFKHBlcm1zKSwgJmxvY2FsX2Vycik7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsKLSAg
ICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZV9wcmVwZW5kKGVycnAsIGxvY2FsX2VyciwKLSAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJmYWlsZWQgdG8gY3JlYXRlIGZyb250ZW5k
OiAiKTsKKyAgICAgICAgICAgICAgICAgICAgICAgQVJSQVlfU0laRShwZXJtcyksIGVycnApOwor
ICAgICAgICBpZiAoKmVycnApIHsKKyAgICAgICAgICAgIGVycm9yX3ByZXBlbmQoZXJycCwgImZh
aWxlZCB0byBjcmVhdGUgZnJvbnRlbmQ6ICIpOwogICAgICAgICAgICAgcmV0dXJuOwogICAgICAg
ICB9CiAgICAgfQogCiAgICAgeGVuZGV2LT5mcm9udGVuZF9zdGF0ZV93YXRjaCA9CiAgICAgICAg
IHhlbl9kZXZpY2VfYWRkX3dhdGNoKHhlbmRldiwgeGVuZGV2LT5mcm9udGVuZF9wYXRoLCAic3Rh
dGUiLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4ZW5fZGV2aWNlX2Zyb250ZW5kX2No
YW5nZWQsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3Jf
cHJvcGFnYXRlX3ByZXBlbmQoZXJycCwgbG9jYWxfZXJyLAotICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAiZmFpbGVkIHRvIHdhdGNoIGZyb250ZW5kIHN0YXRlOiAiKTsKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgeGVuX2RldmljZV9mcm9udGVuZF9jaGFuZ2VkLCBlcnJwKTsK
KyAgICBpZiAoKmVycnApIHsKKyAgICAgICAgZXJyb3JfcHJlcGVuZChlcnJwLCAiZmFpbGVkIHRv
IHdhdGNoIGZyb250ZW5kIHN0YXRlOiAiKTsKICAgICB9CiB9CiAKQEAgLTEyNDcsMTEgKzEyMzcs
MTEgQEAgc3RhdGljIHZvaWQgeGVuX2RldmljZV9leGl0KE5vdGlmaWVyICpuLCB2b2lkICpkYXRh
KQogCiBzdGF0aWMgdm9pZCB4ZW5fZGV2aWNlX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJy
b3IgKiplcnJwKQogeworICAgIEVSUlBfQVVUT19QUk9QQUdBVEUoKTsKICAgICBYZW5EZXZpY2Ug
KnhlbmRldiA9IFhFTl9ERVZJQ0UoZGV2KTsKICAgICBYZW5EZXZpY2VDbGFzcyAqeGVuZGV2X2Ns
YXNzID0gWEVOX0RFVklDRV9HRVRfQ0xBU1MoeGVuZGV2KTsKICAgICBYZW5CdXMgKnhlbmJ1cyA9
IFhFTl9CVVMocWRldl9nZXRfcGFyZW50X2J1cyhERVZJQ0UoeGVuZGV2KSkpOwogICAgIGNvbnN0
IGNoYXIgKnR5cGUgPSBvYmplY3RfZ2V0X3R5cGVuYW1lKE9CSkVDVCh4ZW5kZXYpKTsKLSAgICBF
cnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAogICAgIGlmICh4ZW5kZXYtPmZyb250ZW5kX2lkID09
IERPTUlEX0lOVkFMSUQpIHsKICAgICAgICAgeGVuZGV2LT5mcm9udGVuZF9pZCA9IHhlbl9kb21p
ZDsKQEAgLTEyNjcsMTAgKzEyNTcsOSBAQCBzdGF0aWMgdm9pZCB4ZW5fZGV2aWNlX3JlYWxpemUo
RGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogICAgICAgICBnb3RvIHVucmVhbGl6ZTsK
ICAgICB9CiAKLSAgICB4ZW5kZXYtPm5hbWUgPSB4ZW5kZXZfY2xhc3MtPmdldF9uYW1lKHhlbmRl
diwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9w
YWdhdGVfcHJlcGVuZChlcnJwLCBsb2NhbF9lcnIsCi0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICJmYWlsZWQgdG8gZ2V0IGRldmljZSBuYW1lOiAiKTsKKyAgICB4ZW5kZXYtPm5hbWUg
PSB4ZW5kZXZfY2xhc3MtPmdldF9uYW1lKHhlbmRldiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7
CisgICAgICAgIGVycm9yX3ByZXBlbmQoZXJycCwgImZhaWxlZCB0byBnZXQgZGV2aWNlIG5hbWU6
ICIpOwogICAgICAgICBnb3RvIHVucmVhbGl6ZTsKICAgICB9CiAKQEAgLTEyOTMsMjIgKzEyODIs
MTkgQEAgc3RhdGljIHZvaWQgeGVuX2RldmljZV9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVy
cm9yICoqZXJycCkKICAgICB4ZW5kZXYtPmZlYXR1cmVfZ3JhbnRfY29weSA9CiAgICAgICAgICh4
ZW5nbnR0YWJfZ3JhbnRfY29weSh4ZW5kZXYtPnhndGgsIDAsIE5VTEwpID09IDApOwogCi0gICAg
eGVuX2RldmljZV9iYWNrZW5kX2NyZWF0ZSh4ZW5kZXYsICZsb2NhbF9lcnIpOwotICAgIGlmIChs
b2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7Cisg
ICAgeGVuX2RldmljZV9iYWNrZW5kX2NyZWF0ZSh4ZW5kZXYsIGVycnApOworICAgIGlmICgqZXJy
cCkgewogICAgICAgICBnb3RvIHVucmVhbGl6ZTsKICAgICB9CiAKLSAgICB4ZW5fZGV2aWNlX2Zy
b250ZW5kX2NyZWF0ZSh4ZW5kZXYsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsK
LSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgeGVuX2Rldmlj
ZV9mcm9udGVuZF9jcmVhdGUoeGVuZGV2LCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAg
ICAgZ290byB1bnJlYWxpemU7CiAgICAgfQogCiAgICAgaWYgKHhlbmRldl9jbGFzcy0+cmVhbGl6
ZSkgewotICAgICAgICB4ZW5kZXZfY2xhc3MtPnJlYWxpemUoeGVuZGV2LCAmbG9jYWxfZXJyKTsK
LSAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVy
cnAsIGxvY2FsX2Vycik7CisgICAgICAgIHhlbmRldl9jbGFzcy0+cmVhbGl6ZSh4ZW5kZXYsIGVy
cnApOworICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIGdvdG8gdW5yZWFsaXplOwog
ICAgICAgICB9CiAgICAgfQpkaWZmIC0tZ2l0IGEvaHcveGVuL3hlbi1ob3N0LXBjaS1kZXZpY2Uu
YyBiL2h3L3hlbi94ZW4taG9zdC1wY2ktZGV2aWNlLmMKaW5kZXggMWI0NGRjYWZhZi4uMDIzNzlj
MzQxYyAxMDA2NDQKLS0tIGEvaHcveGVuL3hlbi1ob3N0LXBjaS1kZXZpY2UuYworKysgYi9ody94
ZW4veGVuLWhvc3QtcGNpLWRldmljZS5jCkBAIC0zMzMsOCArMzMzLDggQEAgdm9pZCB4ZW5faG9z
dF9wY2lfZGV2aWNlX2dldChYZW5Ib3N0UENJRGV2aWNlICpkLCB1aW50MTZfdCBkb21haW4sCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQ4X3QgYnVzLCB1aW50OF90IGRldiwgdWlu
dDhfdCBmdW5jLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcnJvciAqKmVycnApCiB7
CisgICAgRVJSUF9BVVRPX1BST1BBR0FURSgpOwogICAgIHVuc2lnbmVkIGludCB2OwotICAgIEVy
cm9yICplcnIgPSBOVUxMOwogCiAgICAgZC0+Y29uZmlnX2ZkID0gLTE7CiAgICAgZC0+ZG9tYWlu
ID0gZG9tYWluOwpAQCAtMzQyLDM2ICszNDIsMzYgQEAgdm9pZCB4ZW5faG9zdF9wY2lfZGV2aWNl
X2dldChYZW5Ib3N0UENJRGV2aWNlICpkLCB1aW50MTZfdCBkb21haW4sCiAgICAgZC0+ZGV2ID0g
ZGV2OwogICAgIGQtPmZ1bmMgPSBmdW5jOwogCi0gICAgeGVuX2hvc3RfcGNpX2NvbmZpZ19vcGVu
KGQsICZlcnIpOwotICAgIGlmIChlcnIpIHsKKyAgICB4ZW5faG9zdF9wY2lfY29uZmlnX29wZW4o
ZCwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8gZXJyb3I7CiAgICAgfQog
Ci0gICAgeGVuX2hvc3RfcGNpX2dldF9yZXNvdXJjZShkLCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7
CisgICAgeGVuX2hvc3RfcGNpX2dldF9yZXNvdXJjZShkLCBlcnJwKTsKKyAgICBpZiAoKmVycnAp
IHsKICAgICAgICAgZ290byBlcnJvcjsKICAgICB9CiAKLSAgICB4ZW5faG9zdF9wY2lfZ2V0X2hl
eF92YWx1ZShkLCAidmVuZG9yIiwgJnYsICZlcnIpOwotICAgIGlmIChlcnIpIHsKKyAgICB4ZW5f
aG9zdF9wY2lfZ2V0X2hleF92YWx1ZShkLCAidmVuZG9yIiwgJnYsIGVycnApOworICAgIGlmICgq
ZXJycCkgewogICAgICAgICBnb3RvIGVycm9yOwogICAgIH0KICAgICBkLT52ZW5kb3JfaWQgPSB2
OwogCi0gICAgeGVuX2hvc3RfcGNpX2dldF9oZXhfdmFsdWUoZCwgImRldmljZSIsICZ2LCAmZXJy
KTsKLSAgICBpZiAoZXJyKSB7CisgICAgeGVuX2hvc3RfcGNpX2dldF9oZXhfdmFsdWUoZCwgImRl
dmljZSIsICZ2LCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ290byBlcnJvcjsK
ICAgICB9CiAgICAgZC0+ZGV2aWNlX2lkID0gdjsKIAotICAgIHhlbl9ob3N0X3BjaV9nZXRfZGVj
X3ZhbHVlKGQsICJpcnEiLCAmdiwgJmVycik7Ci0gICAgaWYgKGVycikgeworICAgIHhlbl9ob3N0
X3BjaV9nZXRfZGVjX3ZhbHVlKGQsICJpcnEiLCAmdiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7
CiAgICAgICAgIGdvdG8gZXJyb3I7CiAgICAgfQogICAgIGQtPmlycSA9IHY7CiAKLSAgICB4ZW5f
aG9zdF9wY2lfZ2V0X2hleF92YWx1ZShkLCAiY2xhc3MiLCAmdiwgJmVycik7Ci0gICAgaWYgKGVy
cikgeworICAgIHhlbl9ob3N0X3BjaV9nZXRfaGV4X3ZhbHVlKGQsICJjbGFzcyIsICZ2LCBlcnJw
KTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ290byBlcnJvcjsKICAgICB9CiAgICAgZC0+
Y2xhc3NfY29kZSA9IHY7CkBAIC0zODEsNyArMzgxLDYgQEAgdm9pZCB4ZW5faG9zdF9wY2lfZGV2
aWNlX2dldChYZW5Ib3N0UENJRGV2aWNlICpkLCB1aW50MTZfdCBkb21haW4sCiAgICAgcmV0dXJu
OwogCiBlcnJvcjoKLSAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKIAogICAgIGlmIChk
LT5jb25maWdfZmQgPj0gMCkgewogICAgICAgICBjbG9zZShkLT5jb25maWdfZmQpOwpkaWZmIC0t
Z2l0IGEvaHcveGVuL3hlbl9wdC5jIGIvaHcveGVuL3hlbl9wdC5jCmluZGV4IGI5MTA4MmNiOGIu
LmY1N2I4MTU4OGUgMTAwNjQ0Ci0tLSBhL2h3L3hlbi94ZW5fcHQuYworKysgYi9ody94ZW4veGVu
X3B0LmMKQEAgLTc2NywxMiArNzY3LDEyIEBAIHN0YXRpYyB2b2lkIHhlbl9wdF9kZXN0cm95KFBD
SURldmljZSAqZCkgewogCiBzdGF0aWMgdm9pZCB4ZW5fcHRfcmVhbGl6ZShQQ0lEZXZpY2UgKmQs
IEVycm9yICoqZXJycCkKIHsKKyAgICBFUlJQX0FVVE9fUFJPUEFHQVRFKCk7CiAgICAgWGVuUENJ
UGFzc3Rocm91Z2hTdGF0ZSAqcyA9IFhFTl9QVF9ERVZJQ0UoZCk7CiAgICAgaW50IGksIHJjID0g
MDsKICAgICB1aW50OF90IG1hY2hpbmVfaXJxID0gMCwgc2NyYXRjaDsKICAgICB1aW50MTZfdCBj
bWQgPSAwOwogICAgIGludCBwaXJxID0gWEVOX1BUX1VOQVNTSUdORURfUElSUTsKLSAgICBFcnJv
ciAqZXJyID0gTlVMTDsKIAogICAgIC8qIHJlZ2lzdGVyIHJlYWwgZGV2aWNlICovCiAgICAgWEVO
X1BUX0xPRyhkLCAiQXNzaWduaW5nIHJlYWwgcGh5c2ljYWwgZGV2aWNlICUwMng6JTAyeC4lZCIK
QEAgLTc4MywxMCArNzgzLDkgQEAgc3RhdGljIHZvaWQgeGVuX3B0X3JlYWxpemUoUENJRGV2aWNl
ICpkLCBFcnJvciAqKmVycnApCiAgICAgeGVuX2hvc3RfcGNpX2RldmljZV9nZXQoJnMtPnJlYWxf
ZGV2aWNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMtPmhvc3RhZGRyLmRvbWFpbiwg
cy0+aG9zdGFkZHIuYnVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMtPmhvc3RhZGRy
LnNsb3QsIHMtPmhvc3RhZGRyLmZ1bmN0aW9uLAotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICZlcnIpOwotICAgIGlmIChlcnIpIHsKLSAgICAgICAgZXJyb3JfYXBwZW5kX2hpbnQoJmVyciwg
IkZhaWxlZCB0byBcIm9wZW5cIiB0aGUgcmVhbCBwY2kgZGV2aWNlIik7Ci0gICAgICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycnAp
OworICAgIGlmICgqZXJycCkgeworICAgICAgICBlcnJvcl9hcHBlbmRfaGludChlcnJwLCAiRmFp
bGVkIHRvIFwib3BlblwiIHRoZSByZWFsIHBjaSBkZXZpY2UiKTsKICAgICAgICAgcmV0dXJuOwog
ICAgIH0KIApAQCAtODEzLDExICs4MTIsMTAgQEAgc3RhdGljIHZvaWQgeGVuX3B0X3JlYWxpemUo
UENJRGV2aWNlICpkLCBFcnJvciAqKmVycnApCiAgICAgICAgICAgICByZXR1cm47CiAgICAgICAg
IH0KIAotICAgICAgICB4ZW5fcHRfc2V0dXBfdmdhKHMsICZzLT5yZWFsX2RldmljZSwgJmVycik7
Ci0gICAgICAgIGlmIChlcnIpIHsKLSAgICAgICAgICAgIGVycm9yX2FwcGVuZF9oaW50KCZlcnIs
ICJTZXR1cCBWR0EgQklPUyBvZiBwYXNzdGhyb3VnaCIKLSAgICAgICAgICAgICAgICAgICAgIiBH
RlggZmFpbGVkIik7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAg
ICAgICAgeGVuX3B0X3NldHVwX3ZnYShzLCAmcy0+cmVhbF9kZXZpY2UsIGVycnApOworICAgICAg
ICBpZiAoKmVycnApIHsKKyAgICAgICAgICAgIGVycm9yX2FwcGVuZF9oaW50KGVycnAsICJTZXR1
cCBWR0EgQklPUyBvZiBwYXNzdGhyb3VnaCIKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICIgR0ZYIGZhaWxlZCIpOwogICAgICAgICAgICAgeGVuX2hvc3RfcGNpX2RldmljZV9wdXQoJnMt
PnJlYWxfZGV2aWNlKTsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQpAQCAtODMwLDEw
ICs4MjgsOSBAQCBzdGF0aWMgdm9pZCB4ZW5fcHRfcmVhbGl6ZShQQ0lEZXZpY2UgKmQsIEVycm9y
ICoqZXJycCkKICAgICB4ZW5fcHRfcmVnaXN0ZXJfcmVnaW9ucyhzLCAmY21kKTsKIAogICAgIC8q
IHJlaW5pdGlhbGl6ZSBlYWNoIGNvbmZpZyByZWdpc3RlciB0byBiZSBlbXVsYXRlZCAqLwotICAg
IHhlbl9wdF9jb25maWdfaW5pdChzLCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7Ci0gICAgICAgIGVy
cm9yX2FwcGVuZF9oaW50KCZlcnIsICJQQ0kgQ29uZmlnIHNwYWNlIGluaXRpYWxpc2F0aW9uIGZh
aWxlZCIpOwotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICB4ZW5fcHRf
Y29uZmlnX2luaXQocywgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CisgICAgICAgIGVycm9yX2Fw
cGVuZF9oaW50KGVycnAsICJQQ0kgQ29uZmlnIHNwYWNlIGluaXRpYWxpc2F0aW9uIGZhaWxlZCIp
OwogICAgICAgICByYyA9IC0xOwogICAgICAgICBnb3RvIGVycl9vdXQ7CiAgICAgfQpkaWZmIC0t
Z2l0IGEvaHcveGVuL3hlbl9wdF9jb25maWdfaW5pdC5jIGIvaHcveGVuL3hlbl9wdF9jb25maWdf
aW5pdC5jCmluZGV4IDMxZWM1YWRkMWQuLmFmM2ZiZDFiZmIgMTAwNjQ0Ci0tLSBhL2h3L3hlbi94
ZW5fcHRfY29uZmlnX2luaXQuYworKysgYi9ody94ZW4veGVuX3B0X2NvbmZpZ19pbml0LmMKQEAg
LTIwMDgsOCArMjAwOCw4IEBAIHN0YXRpYyB2b2lkIHhlbl9wdF9jb25maWdfcmVnX2luaXQoWGVu
UENJUGFzc3Rocm91Z2hTdGF0ZSAqcywKIAogdm9pZCB4ZW5fcHRfY29uZmlnX2luaXQoWGVuUENJ
UGFzc3Rocm91Z2hTdGF0ZSAqcywgRXJyb3IgKiplcnJwKQogeworICAgIEVSUlBfQVVUT19QUk9Q
QUdBVEUoKTsKICAgICBpbnQgaSwgcmM7Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7CiAKICAgICBR
TElTVF9JTklUKCZzLT5yZWdfZ3Jwcyk7CiAKQEAgLTIwNTIsMTAgKzIwNTIsOSBAQCB2b2lkIHhl
bl9wdF9jb25maWdfaW5pdChYZW5QQ0lQYXNzdGhyb3VnaFN0YXRlICpzLCBFcnJvciAqKmVycnAp
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ19n
cnBfb2Zmc2V0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAmcmVnX2dycF9lbnRyeS0+c2l6ZSk7CiAgICAgICAgICAgICBpZiAocmMgPCAwKSB7Ci0g
ICAgICAgICAgICAgICAgZXJyb3Jfc2V0ZygmZXJyLCAiRmFpbGVkIHRvIGluaXRpYWxpemUgJWQv
JXp1LCB0eXBlID0gMHgleCwiCisgICAgICAgICAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAiRmFp
bGVkIHRvIGluaXRpYWxpemUgJWQvJXp1LCB0eXBlID0gMHgleCwiCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAiIHJjOiAlZCIsIGksIEFSUkFZX1NJWkUoeGVuX3B0X2VtdV9yZWdfZ3Jwcyks
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4ZW5fcHRfZW11X3JlZ19ncnBzW2ldLmdycF90
eXBlLCByYyk7Ci0gICAgICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CiAg
ICAgICAgICAgICAgICAgeGVuX3B0X2NvbmZpZ19kZWxldGUocyk7CiAgICAgICAgICAgICAgICAg
cmV0dXJuOwogICAgICAgICAgICAgfQpAQCAtMjA2OCwxMyArMjA2NywxNCBAQCB2b2lkIHhlbl9w
dF9jb25maWdfaW5pdChYZW5QQ0lQYXNzdGhyb3VnaFN0YXRlICpzLCBFcnJvciAqKmVycnApCiAK
ICAgICAgICAgICAgICAgICAvKiBpbml0aWFsaXplIGNhcGFiaWxpdHkgcmVnaXN0ZXIgKi8KICAg
ICAgICAgICAgICAgICBmb3IgKGogPSAwOyByZWdzLT5zaXplICE9IDA7IGorKywgcmVncysrKSB7
Ci0gICAgICAgICAgICAgICAgICAgIHhlbl9wdF9jb25maWdfcmVnX2luaXQocywgcmVnX2dycF9l
bnRyeSwgcmVncywgJmVycik7Ci0gICAgICAgICAgICAgICAgICAgIGlmIChlcnIpIHsKLSAgICAg
ICAgICAgICAgICAgICAgICAgIGVycm9yX2FwcGVuZF9oaW50KCZlcnIsICJGYWlsZWQgdG8gaW5p
dCByZWdpc3RlciAlZCIKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiBvZmZzZXRz
IDB4JXggaW4gZ3JwX3R5cGUgPSAweCV4ICglZC8lenUpIiwgaiwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgcmVncy0+b2Zmc2V0LCB4ZW5fcHRfZW11X3JlZ19ncnBzW2ldLmdycF90
eXBlLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLCBBUlJBWV9TSVpFKHhlbl9w
dF9lbXVfcmVnX2dycHMpKTsKLSAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0
ZShlcnJwLCBlcnIpOworICAgICAgICAgICAgICAgICAgICB4ZW5fcHRfY29uZmlnX3JlZ19pbml0
KHMsIHJlZ19ncnBfZW50cnksIHJlZ3MsIGVycnApOworICAgICAgICAgICAgICAgICAgICBpZiAo
KmVycnApIHsKKyAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yX2FwcGVuZF9oaW50KGVycnAs
ICJGYWlsZWQgdG8gaW5pdCByZWdpc3RlciAlZCIKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICIgb2Zmc2V0cyAweCV4IGluIGdycF90eXBlID0gMHgleCAoJWQvJXp1
KSIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVncy0+b2Zmc2V0LAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeGVuX3B0X2VtdV9yZWdfZ3Jwc1tp
XS5ncnBfdHlwZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGks
IEFSUkFZX1NJWkUoeGVuX3B0X2VtdV9yZWdfZ3JwcykpOwogICAgICAgICAgICAgICAgICAgICAg
ICAgeGVuX3B0X2NvbmZpZ19kZWxldGUocyk7CiAgICAgICAgICAgICAgICAgICAgICAgICByZXR1
cm47CiAgICAgICAgICAgICAgICAgICAgIH0KLS0gCjIuMjEuMAoKCl9fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVu
LWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcv
bWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

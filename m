Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 83160C1AE4
	for <lists+xen-devel@lfdr.de>; Mon, 30 Sep 2019 07:23:52 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iEo85-0001vu-4O; Mon, 30 Sep 2019 05:21:49 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=hbFO=XZ=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1iEo83-0001vV-Gj
 for xen-devel@lists.xenproject.org; Mon, 30 Sep 2019 05:21:47 +0000
X-Inumbo-ID: 2e7db178-e342-11e9-96c8-12813bfff9fa
Received: from mx1.suse.de (unknown [195.135.220.15])
 by localhost (Halon) with ESMTPS
 id 2e7db178-e342-11e9-96c8-12813bfff9fa;
 Mon, 30 Sep 2019 05:21:40 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 3063CAF13;
 Mon, 30 Sep 2019 05:21:39 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Mon, 30 Sep 2019 07:21:17 +0200
Message-Id: <20190930052135.11257-2-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190930052135.11257-1-jgross@suse.com>
References: <20190930052135.11257-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v5 01/19] xen/sched: add code to sync scheduling
 of all vcpus of a sched unit
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>,
 Dario Faggioli <dfaggioli@suse.com>,
 Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

V2hlbiBzd2l0Y2hpbmcgc2NoZWQgdW5pdHMgc3luY2hyb25pemUgYWxsIHZjcHVzIG9mIHRoZSBu
ZXcgdW5pdCB0byBiZQpzY2hlZHVsZWQgYXQgdGhlIHNhbWUgdGltZS4KCkEgdmFyaWFibGUgc2No
ZWRfZ3JhbnVsYXJpdHkgaXMgYWRkZWQgd2hpY2ggaG9sZHMgdGhlIG51bWJlciBvZiB2Y3B1cwpw
ZXIgc2NoZWR1bGUgdW5pdC4KCkFzIHRhc2tsZXRzIHJlcXVpcmUgdG8gc2NoZWR1bGUgdGhlIGlk
bGUgdW5pdCBpdCBpcyByZXF1aXJlZCB0byBzZXQgdGhlCnRhc2tsZXRfd29ya19zY2hlZHVsZWQg
cGFyYW1ldGVyIG9mIGRvX3NjaGVkdWxlKCkgdG8gdHJ1ZSBpZiBhbnkgY3B1CmNvdmVyZWQgYnkg
dGhlIGN1cnJlbnQgc2NoZWR1bGUoKSBjYWxsIGhhcyBhbnkgcGVuZGluZyB0YXNrbGV0IHdvcmsu
CgpGb3Igam9pbmluZyBvdGhlciB2Y3B1cyBvZiB0aGUgc2NoZWR1bGUgdW5pdCB3ZSBuZWVkIHRv
IGFkZCBhIG5ldwpzb2Z0aXJxIFNDSEVEX1NMQVZFX1NPRlRJUlEgaW4gb3JkZXIgdG8gaGF2ZSBh
IHdheSB0byBpbml0aWF0ZSBhCmNvbnRleHQgc3dpdGNoIHdpdGhvdXQgY2FsbGluZyB0aGUgZ2Vu
ZXJpYyBzY2hlZHVsZSgpIGZ1bmN0aW9uCnNlbGVjdGluZyB0aGUgdmNwdSB0byBzd2l0Y2ggdG8s
IGFzIHdlIGFscmVhZHkga25vdyB3aGljaCB2Y3B1IHdlCndhbnQgdG8gcnVuLiBUaGlzIGhhcyB0
aGUgb3RoZXIgYWR2YW50YWdlIG5vdCB0byBsb29zZSBhbnkgb3RoZXIKY29uY3VycmVudCBTQ0hF
RFVMRV9TT0ZUSVJRIGV2ZW50cy4KClNpZ25lZC1vZmYtYnk6IEp1ZXJnZW4gR3Jvc3MgPGpncm9z
c0BzdXNlLmNvbT4KUmV2aWV3ZWQtYnk6IERhcmlvIEZhZ2dpb2xpIDxkZmFnZ2lvbGlAc3VzZS5j
b20+Ci0tLQpSRkMgVjI6Ci0gbW92ZSBzeW5jaW5nIGFmdGVyIGNvbnRleHRfc3dpdGNoKCkgdG8g
c2NoZWR1bGUuYwpWMjoKLSBkb24ndCBydW4gdGFza2xldHMgZGlyZWN0bHkgZnJvbSBzY2hlZF93
YWl0X3JlbmRlenZvdXNfaW4oKQpWMzoKLSBhZGFwdCBhcnJheSBzaXplIGluIHNjaGVkX21vdmVf
ZG9tYWluKCkgKEphbiBCZXVsaWNoKQotIGludCAtPiB1bnNpZ25lZCBpbnQgKEphbiBCZXVsaWNo
KQpWNDoKLSByZW5hbWVkIHNkIHRvIHNyIGluIHNldmVyYWwgcGxhY2VzIChKYW4gQmV1bGljaCkK
LSBzd2FwIHN0b3BfdGltZXIoKSBhbmQgTk9XKCkgY2FsbHMgKEphbiBCZXVsaWNoKQotIGNvbnRl
eHRfc3dpdGNoKCkgb24gQVJNIHJldHVybnMgLSBoYW5kbGUgdGhhdCAoSmFuIEJldWxpY2gpCi0t
LQogeGVuL2FyY2gvYXJtL2RvbWFpbi5jICAgICAgfCAgIDIgKy0KIHhlbi9hcmNoL3g4Ni9kb21h
aW4uYyAgICAgIHwgICAzICstCiB4ZW4vY29tbW9uL3NjaGVkdWxlLmMgICAgICB8IDM1MyArKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0KIHhlbi9jb21tb24vc29m
dGlycS5jICAgICAgIHwgICA2ICstCiB4ZW4vaW5jbHVkZS94ZW4vc2NoZWQtaWYuaCB8ICAgMSAr
CiB4ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaCAgICB8ICAxNiArLQogeGVuL2luY2x1ZGUveGVuL3Nv
ZnRpcnEuaCAgfCAgIDEgKwogNyBmaWxlcyBjaGFuZ2VkLCAyOTQgaW5zZXJ0aW9ucygrKSwgODgg
ZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEveGVuL2FyY2gvYXJtL2RvbWFpbi5jIGIveGVuL2Fy
Y2gvYXJtL2RvbWFpbi5jCmluZGV4IGYwZWU1YTIxNDAuLjQ2MGU5NjhlOTcgMTAwNjQ0Ci0tLSBh
L3hlbi9hcmNoL2FybS9kb21haW4uYworKysgYi94ZW4vYXJjaC9hcm0vZG9tYWluLmMKQEAgLTMx
OCw3ICszMTgsNyBAQCBzdGF0aWMgdm9pZCBzY2hlZHVsZV90YWlsKHN0cnVjdCB2Y3B1ICpwcmV2
KQogCiAgICAgbG9jYWxfaXJxX2VuYWJsZSgpOwogCi0gICAgY29udGV4dF9zYXZlZChwcmV2KTsK
KyAgICBzY2hlZF9jb250ZXh0X3N3aXRjaGVkKHByZXYsIGN1cnJlbnQpOwogCiAgICAgdXBkYXRl
X3J1bnN0YXRlX2FyZWEoY3VycmVudCk7CiAKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9kb21h
aW4uYyBiL3hlbi9hcmNoL3g4Ni9kb21haW4uYwppbmRleCBjN2ZhMjI0Yzg5Li4yN2Y5OWQzYmNj
IDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYvZG9tYWluLmMKKysrIGIveGVuL2FyY2gveDg2L2Rv
bWFpbi5jCkBAIC0xNzg0LDcgKzE3ODQsNiBAQCBzdGF0aWMgdm9pZCBfX2NvbnRleHRfc3dpdGNo
KHZvaWQpCiAgICAgcGVyX2NwdShjdXJyX3ZjcHUsIGNwdSkgPSBuOwogfQogCi0KIHZvaWQgY29u
dGV4dF9zd2l0Y2goc3RydWN0IHZjcHUgKnByZXYsIHN0cnVjdCB2Y3B1ICpuZXh0KQogewogICAg
IHVuc2lnbmVkIGludCBjcHUgPSBzbXBfcHJvY2Vzc29yX2lkKCk7CkBAIC0xODYwLDcgKzE4NTks
NyBAQCB2b2lkIGNvbnRleHRfc3dpdGNoKHN0cnVjdCB2Y3B1ICpwcmV2LCBzdHJ1Y3QgdmNwdSAq
bmV4dCkKICAgICAgICAgfQogICAgIH0KIAotICAgIGNvbnRleHRfc2F2ZWQocHJldik7CisgICAg
c2NoZWRfY29udGV4dF9zd2l0Y2hlZChwcmV2LCBuZXh0KTsKIAogICAgIF91cGRhdGVfcnVuc3Rh
dGVfYXJlYShuZXh0KTsKICAgICAvKiBNdXN0IGJlIGRvbmUgd2l0aCBpbnRlcnJ1cHRzIGVuYWJs
ZWQgKi8KZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vc2NoZWR1bGUuYyBiL3hlbi9jb21tb24vc2No
ZWR1bGUuYwppbmRleCA0NzExZWNlMWVmLi5mZjY3ZmIzNjMzIDEwMDY0NAotLS0gYS94ZW4vY29t
bW9uL3NjaGVkdWxlLmMKKysrIGIveGVuL2NvbW1vbi9zY2hlZHVsZS5jCkBAIC02MSw2ICs2MSw5
IEBAIGJvb2xlYW5fcGFyYW0oInNjaGVkX3NtdF9wb3dlcl9zYXZpbmdzIiwgc2NoZWRfc210X3Bv
d2VyX3NhdmluZ3MpOwogaW50IHNjaGVkX3JhdGVsaW1pdF91cyA9IFNDSEVEX0RFRkFVTFRfUkFU
RUxJTUlUX1VTOwogaW50ZWdlcl9wYXJhbSgic2NoZWRfcmF0ZWxpbWl0X3VzIiwgc2NoZWRfcmF0
ZWxpbWl0X3VzKTsKIAorLyogTnVtYmVyIG9mIHZjcHVzIHBlciBzdHJ1Y3Qgc2NoZWRfdW5pdC4g
Ki8KK3N0YXRpYyB1bnNpZ25lZCBpbnQgX19yZWFkX21vc3RseSBzY2hlZF9ncmFudWxhcml0eSA9
IDE7CisKIC8qIENvbW1vbiBsb2NrIGZvciBmcmVlIGNwdXMuICovCiBzdGF0aWMgREVGSU5FX1NQ
SU5MT0NLKHNjaGVkX2ZyZWVfY3B1X2xvY2spOwogCkBAIC01MzIsOCArNTM1LDggQEAgaW50IHNj
aGVkX21vdmVfZG9tYWluKHN0cnVjdCBkb21haW4gKmQsIHN0cnVjdCBjcHVwb29sICpjKQogICAg
IGlmICggSVNfRVJSKGRvbWRhdGEpICkKICAgICAgICAgcmV0dXJuIFBUUl9FUlIoZG9tZGF0YSk7
CiAKLSAgICAvKiBUT0RPOiBmaXggYXJyYXkgc2l6ZSB3aXRoIG11bHRpcGxlIHZjcHVzIHBlciB1
bml0LiAqLwotICAgIHVuaXRfcHJpdiA9IHh6YWxsb2NfYXJyYXkodm9pZCAqLCBkLT5tYXhfdmNw
dXMpOworICAgIHVuaXRfcHJpdiA9IHh6YWxsb2NfYXJyYXkodm9pZCAqLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgRElWX1JPVU5EX1VQKGQtPm1heF92Y3B1cywgc2NoZWRfZ3JhbnVs
YXJpdHkpKTsKICAgICBpZiAoIHVuaXRfcHJpdiA9PSBOVUxMICkKICAgICB7CiAgICAgICAgIHNj
aGVkX2ZyZWVfZG9tZGF0YShjLT5zY2hlZCwgZG9tZGF0YSk7CkBAIC0xNzE0LDEzMyArMTcxNywz
MjUgQEAgdm9pZCB2Y3B1X3NldF9wZXJpb2RpY190aW1lcihzdHJ1Y3QgdmNwdSAqdiwgc190aW1l
X3QgdmFsdWUpCiAgICAgc3Bpbl91bmxvY2soJnYtPnBlcmlvZGljX3RpbWVyX2xvY2spOwogfQog
Ci0vKgotICogVGhlIG1haW4gZnVuY3Rpb24KLSAqIC0gZGVzY2hlZHVsZSB0aGUgY3VycmVudCBk
b21haW4gKHNjaGVkdWxlciBpbmRlcGVuZGVudCkuCi0gKiAtIHBpY2sgYSBuZXcgZG9tYWluIChz
Y2hlZHVsZXIgZGVwZW5kZW50KS4KLSAqLwotc3RhdGljIHZvaWQgc2NoZWR1bGUodm9pZCkKK3N0
YXRpYyB2b2lkIHNjaGVkX3N3aXRjaF91bml0cyhzdHJ1Y3Qgc2NoZWRfcmVzb3VyY2UgKnNyLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBzY2hlZF91bml0ICpuZXh0LCBz
dHJ1Y3Qgc2NoZWRfdW5pdCAqcHJldiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBz
X3RpbWVfdCBub3cpCiB7Ci0gICAgc3RydWN0IHNjaGVkX3VuaXQgICAgKnByZXYgPSBjdXJyZW50
LT5zY2hlZF91bml0LCAqbmV4dCA9IE5VTEw7Ci0gICAgc190aW1lX3QgICAgICAgICAgICAgIG5v
dzsKLSAgICBzdHJ1Y3Qgc2NoZWR1bGVyICAgICAqc2NoZWQ7Ci0gICAgdW5zaWduZWQgbG9uZyAg
ICAgICAgKnRhc2tsZXRfd29yayA9ICZ0aGlzX2NwdSh0YXNrbGV0X3dvcmtfdG9fZG8pOwotICAg
IGJvb2wgICAgICAgICAgICAgICAgICB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkID0gZmFsc2U7Ci0g
ICAgc3RydWN0IHNjaGVkX3Jlc291cmNlICpzZDsKLSAgICBzcGlubG9ja190ICAgICAgICAgICAq
bG9jazsKLSAgICBpbnQgY3B1ID0gc21wX3Byb2Nlc3Nvcl9pZCgpOworICAgIHNyLT5jdXJyID0g
bmV4dDsKIAotICAgIEFTU0VSVF9OT1RfSU5fQVRPTUlDKCk7CisgICAgVFJBQ0VfM0QoVFJDX1ND
SEVEX1NXSVRDSF9JTkZQUkVWLCBwcmV2LT5kb21haW4tPmRvbWFpbl9pZCwgcHJldi0+dW5pdF9p
ZCwKKyAgICAgICAgICAgICBub3cgLSBwcmV2LT5zdGF0ZV9lbnRyeV90aW1lKTsKKyAgICBUUkFD
RV80RChUUkNfU0NIRURfU1dJVENIX0lORk5FWFQsIG5leHQtPmRvbWFpbi0+ZG9tYWluX2lkLCBu
ZXh0LT51bml0X2lkLAorICAgICAgICAgICAgIChuZXh0LT52Y3B1X2xpc3QtPnJ1bnN0YXRlLnN0
YXRlID09IFJVTlNUQVRFX3J1bm5hYmxlKSA/CisgICAgICAgICAgICAgKG5vdyAtIG5leHQtPnN0
YXRlX2VudHJ5X3RpbWUpIDogMCwgcHJldi0+bmV4dF90aW1lKTsKIAotICAgIFNDSEVEX1NUQVRf
Q1JBTksoc2NoZWRfcnVuKTsKKyAgICBBU1NFUlQocHJldi0+dmNwdV9saXN0LT5ydW5zdGF0ZS5z
dGF0ZSA9PSBSVU5TVEFURV9ydW5uaW5nKTsKKworICAgIFRSQUNFXzREKFRSQ19TQ0hFRF9TV0lU
Q0gsIHByZXYtPmRvbWFpbi0+ZG9tYWluX2lkLCBwcmV2LT51bml0X2lkLAorICAgICAgICAgICAg
IG5leHQtPmRvbWFpbi0+ZG9tYWluX2lkLCBuZXh0LT51bml0X2lkKTsKKworICAgIHNjaGVkX3Vu
aXRfcnVuc3RhdGVfY2hhbmdlKHByZXYsIGZhbHNlLCBub3cpOworCisgICAgQVNTRVJUKG5leHQt
PnZjcHVfbGlzdC0+cnVuc3RhdGUuc3RhdGUgIT0gUlVOU1RBVEVfcnVubmluZyk7CisgICAgc2No
ZWRfdW5pdF9ydW5zdGF0ZV9jaGFuZ2UobmV4dCwgdHJ1ZSwgbm93KTsKIAotICAgIHNkID0gZ2V0
X3NjaGVkX3JlcyhjcHUpOworICAgIC8qCisgICAgICogTkIuIERvbid0IGFkZCBhbnkgdHJhY2Ug
cmVjb3JkcyBmcm9tIGhlcmUgdW50aWwgdGhlIGFjdHVhbCBjb250ZXh0CisgICAgICogc3dpdGNo
LCBlbHNlIGxvc3RfcmVjb3JkcyByZXN1bWUgd2lsbCBub3Qgd29yayBwcm9wZXJseS4KKyAgICAg
Ki8KKworICAgIEFTU0VSVCghbmV4dC0+aXNfcnVubmluZyk7CisgICAgbmV4dC0+dmNwdV9saXN0
LT5pc19ydW5uaW5nID0gMTsKKyAgICBuZXh0LT5pc19ydW5uaW5nID0gdHJ1ZTsKKyAgICBuZXh0
LT5zdGF0ZV9lbnRyeV90aW1lID0gbm93OworfQorCitzdGF0aWMgYm9vbCBzY2hlZF90YXNrbGV0
X2NoZWNrX2NwdSh1bnNpZ25lZCBpbnQgY3B1KQoreworICAgIHVuc2lnbmVkIGxvbmcgKnRhc2ts
ZXRfd29yayA9ICZwZXJfY3B1KHRhc2tsZXRfd29ya190b19kbywgY3B1KTsKIAotICAgIC8qIFVw
ZGF0ZSB0YXNrbGV0IHNjaGVkdWxpbmcgc3RhdHVzLiAqLwogICAgIHN3aXRjaCAoICp0YXNrbGV0
X3dvcmsgKQogICAgIHsKICAgICBjYXNlIFRBU0tMRVRfZW5xdWV1ZWQ6CiAgICAgICAgIHNldF9i
aXQoX1RBU0tMRVRfc2NoZWR1bGVkLCB0YXNrbGV0X3dvcmspOwogICAgICAgICAvKiBmYWxsdGhy
b3VnaCAqLwogICAgIGNhc2UgVEFTS0xFVF9lbnF1ZXVlZHxUQVNLTEVUX3NjaGVkdWxlZDoKLSAg
ICAgICAgdGFza2xldF93b3JrX3NjaGVkdWxlZCA9IHRydWU7CisgICAgICAgIHJldHVybiB0cnVl
OwogICAgICAgICBicmVhazsKICAgICBjYXNlIFRBU0tMRVRfc2NoZWR1bGVkOgogICAgICAgICBj
bGVhcl9iaXQoX1RBU0tMRVRfc2NoZWR1bGVkLCB0YXNrbGV0X3dvcmspOworICAgICAgICAvKiBm
YWxsdGhyb3VnaCAqLwogICAgIGNhc2UgMDoKLSAgICAgICAgLyp0YXNrbGV0X3dvcmtfc2NoZWR1
bGVkID0gZmFsc2U7Ki8KKyAgICAgICAgLyogcmV0dXJuIGZhbHNlOyAqLwogICAgICAgICBicmVh
azsKICAgICBkZWZhdWx0OgogICAgICAgICBCVUcoKTsKICAgICB9CiAKLSAgICBsb2NrID0gcGNw
dV9zY2hlZHVsZV9sb2NrX2lycShjcHUpOworICAgIHJldHVybiBmYWxzZTsKK30KIAotICAgIG5v
dyA9IE5PVygpOworc3RhdGljIGJvb2wgc2NoZWRfdGFza2xldF9jaGVjayh1bnNpZ25lZCBpbnQg
Y3B1KQoreworICAgIGJvb2wgdGFza2xldF93b3JrX3NjaGVkdWxlZCA9IGZhbHNlOworICAgIGNv
bnN0IGNwdW1hc2tfdCAqbWFzayA9IGdldF9zY2hlZF9yZXMoY3B1KS0+Y3B1czsKKyAgICB1bnNp
Z25lZCBpbnQgY3B1X2l0ZXI7CisKKyAgICBmb3JfZWFjaF9jcHUgKCBjcHVfaXRlciwgbWFzayAp
CisgICAgICAgIGlmICggc2NoZWRfdGFza2xldF9jaGVja19jcHUoY3B1X2l0ZXIpICkKKyAgICAg
ICAgICAgIHRhc2tsZXRfd29ya19zY2hlZHVsZWQgPSB0cnVlOwogCi0gICAgc3RvcF90aW1lcigm
c2QtPnNfdGltZXIpOworICAgIHJldHVybiB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkOworfQorCitz
dGF0aWMgc3RydWN0IHNjaGVkX3VuaXQgKmRvX3NjaGVkdWxlKHN0cnVjdCBzY2hlZF91bml0ICpw
cmV2LCBzX3RpbWVfdCBub3csCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHVuc2lnbmVkIGludCBjcHUpCit7CisgICAgc3RydWN0IHNjaGVkdWxlciAqc2NoZWQgPSBwZXJf
Y3B1KHNjaGVkdWxlciwgY3B1KTsKKyAgICBzdHJ1Y3Qgc2NoZWRfcmVzb3VyY2UgKnNyID0gZ2V0
X3NjaGVkX3JlcyhjcHUpOworICAgIHN0cnVjdCBzY2hlZF91bml0ICpuZXh0OwogCiAgICAgLyog
Z2V0IHBvbGljeS1zcGVjaWZpYyBkZWNpc2lvbiBvbiBzY2hlZHVsaW5nLi4uICovCi0gICAgc2No
ZWQgPSB0aGlzX2NwdShzY2hlZHVsZXIpOwotICAgIHNjaGVkLT5kb19zY2hlZHVsZShzY2hlZCwg
cHJldiwgbm93LCB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkKTsKKyAgICBzY2hlZC0+ZG9fc2NoZWR1
bGUoc2NoZWQsIHByZXYsIG5vdywgc2NoZWRfdGFza2xldF9jaGVjayhjcHUpKTsKIAogICAgIG5l
eHQgPSBwcmV2LT5uZXh0X3Rhc2s7CiAKLSAgICBzZC0+Y3VyciA9IG5leHQ7Ci0KICAgICBpZiAo
IHByZXYtPm5leHRfdGltZSA+PSAwICkgLyogLXZlIG1lYW5zIG5vIGxpbWl0ICovCi0gICAgICAg
IHNldF90aW1lcigmc2QtPnNfdGltZXIsIG5vdyArIHByZXYtPm5leHRfdGltZSk7CisgICAgICAg
IHNldF90aW1lcigmc3ItPnNfdGltZXIsIG5vdyArIHByZXYtPm5leHRfdGltZSk7CisKKyAgICBp
ZiAoIGxpa2VseShwcmV2ICE9IG5leHQpICkKKyAgICAgICAgc2NoZWRfc3dpdGNoX3VuaXRzKHNy
LCBuZXh0LCBwcmV2LCBub3cpOworCisgICAgcmV0dXJuIG5leHQ7Cit9CisKK3N0YXRpYyB2b2lk
IGNvbnRleHRfc2F2ZWQoc3RydWN0IHZjcHUgKnByZXYpCit7CisgICAgc3RydWN0IHNjaGVkX3Vu
aXQgKnVuaXQgPSBwcmV2LT5zY2hlZF91bml0OworCisgICAgLyogQ2xlYXIgcnVubmluZyBmbGFn
IC9hZnRlci8gd3JpdGluZyBjb250ZXh0IHRvIG1lbW9yeS4gKi8KKyAgICBzbXBfd21iKCk7CisK
KyAgICBwcmV2LT5pc19ydW5uaW5nID0gMDsKKyAgICB1bml0LT5pc19ydW5uaW5nID0gZmFsc2U7
CisgICAgdW5pdC0+c3RhdGVfZW50cnlfdGltZSA9IE5PVygpOworCisgICAgLyogQ2hlY2sgZm9y
IG1pZ3JhdGlvbiByZXF1ZXN0IC9hZnRlci8gY2xlYXJpbmcgcnVubmluZyBmbGFnLiAqLworICAg
IHNtcF9tYigpOworCisgICAgc2NoZWRfY29udGV4dF9zYXZlZCh2Y3B1X3NjaGVkdWxlcihwcmV2
KSwgdW5pdCk7CiAKLSAgICBpZiAoIHVubGlrZWx5KHByZXYgPT0gbmV4dCkgKQorICAgIHNjaGVk
X3VuaXRfbWlncmF0ZV9maW5pc2godW5pdCk7Cit9CisKKy8qCisgKiBSZW5kZXp2b3VzIG9uIGVu
ZCBvZiBjb250ZXh0IHN3aXRjaC4KKyAqIEFzIG5vIGxvY2sgaXMgcHJvdGVjdGluZyB0aGlzIHJl
bmRlenZvdXMgZnVuY3Rpb24gd2UgbmVlZCB0byB1c2UgYXRvbWljCisgKiBhY2Nlc3MgZnVuY3Rp
b25zIG9uIHRoZSBjb3VudGVyLgorICogVGhlIGNvdW50ZXIgd2lsbCBiZSAwIGluIGNhc2Ugbm8g
cmVuZGV6dm91cyBpcyBuZWVkZWQuIEZvciB0aGUgcmVuZGV6dm91cworICogY2FzZSBpdCBpcyBp
bml0aWFsaXNlZCB0byB0aGUgbnVtYmVyIG9mIGNwdXMgdG8gcmVuZGV6dm91cyBwbHVzIDEuIEVh
Y2gKKyAqIG1lbWJlciBlbnRlcmluZyBkZWNyZW1lbnRzIHRoZSBjb3VudGVyLiBUaGUgbGFzdCBv
bmUgd2lsbCBkZWNyZW1lbnQgaXQgdG8KKyAqIDEgYW5kIHBlcmZvcm0gdGhlIGZpbmFsIG5lZWRl
ZCBhY3Rpb24gaW4gdGhhdCBjYXNlIChjYWxsIG9mIGNvbnRleHRfc2F2ZWQoKQorICogaWYgdmNw
dSB3YXMgc3dpdGNoZWQpLCBhbmQgdGhlbiBzZXQgdGhlIGNvdW50ZXIgdG8gemVyby4gVGhlIG90
aGVyIG1lbWJlcnMKKyAqIHdpbGwgd2FpdCB1bnRpbCB0aGUgY291bnRlciBiZWNvbWVzIHplcm8g
dW50aWwgdGhleSBwcm9jZWVkLgorICovCit2b2lkIHNjaGVkX2NvbnRleHRfc3dpdGNoZWQoc3Ry
dWN0IHZjcHUgKnZwcmV2LCBzdHJ1Y3QgdmNwdSAqdm5leHQpCit7CisgICAgc3RydWN0IHNjaGVk
X3VuaXQgKm5leHQgPSB2bmV4dC0+c2NoZWRfdW5pdDsKKworICAgIGlmICggYXRvbWljX3JlYWQo
Jm5leHQtPnJlbmRlenZvdXNfb3V0X2NudCkgKQorICAgIHsKKyAgICAgICAgaW50IGNudCA9IGF0
b21pY19kZWNfcmV0dXJuKCZuZXh0LT5yZW5kZXp2b3VzX291dF9jbnQpOworCisgICAgICAgIC8q
IENhbGwgY29udGV4dF9zYXZlZCgpIGJlZm9yZSByZWxlYXNpbmcgb3RoZXIgd2FpdGVycy4gKi8K
KyAgICAgICAgaWYgKCBjbnQgPT0gMSApCisgICAgICAgIHsKKyAgICAgICAgICAgIGlmICggdnBy
ZXYgIT0gdm5leHQgKQorICAgICAgICAgICAgICAgIGNvbnRleHRfc2F2ZWQodnByZXYpOworICAg
ICAgICAgICAgYXRvbWljX3NldCgmbmV4dC0+cmVuZGV6dm91c19vdXRfY250LCAwKTsKKyAgICAg
ICAgfQorICAgICAgICBlbHNlCisgICAgICAgICAgICB3aGlsZSAoIGF0b21pY19yZWFkKCZuZXh0
LT5yZW5kZXp2b3VzX291dF9jbnQpICkKKyAgICAgICAgICAgICAgICBjcHVfcmVsYXgoKTsKKyAg
ICB9CisgICAgZWxzZSBpZiAoIHZwcmV2ICE9IHZuZXh0ICkKKyAgICAgICAgY29udGV4dF9zYXZl
ZCh2cHJldik7Cit9CisKK3N0YXRpYyB2b2lkIHNjaGVkX2NvbnRleHRfc3dpdGNoKHN0cnVjdCB2
Y3B1ICp2cHJldiwgc3RydWN0IHZjcHUgKnZuZXh0LAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgc190aW1lX3Qgbm93KQoreworICAgIGlmICggdW5saWtlbHkodnByZXYgPT0gdm5l
eHQpICkKICAgICB7Ci0gICAgICAgIHBjcHVfc2NoZWR1bGVfdW5sb2NrX2lycShsb2NrLCBjcHUp
OwogICAgICAgICBUUkFDRV80RChUUkNfU0NIRURfU1dJVENIX0lORkNPTlQsCi0gICAgICAgICAg
ICAgICAgIG5leHQtPmRvbWFpbi0+ZG9tYWluX2lkLCBuZXh0LT51bml0X2lkLAotICAgICAgICAg
ICAgICAgICBub3cgLSBwcmV2LT5zdGF0ZV9lbnRyeV90aW1lLAotICAgICAgICAgICAgICAgICBw
cmV2LT5uZXh0X3RpbWUpOwotICAgICAgICB0cmFjZV9jb250aW51ZV9ydW5uaW5nKG5leHQtPnZj
cHVfbGlzdCk7Ci0gICAgICAgIHJldHVybiBjb250aW51ZV9ydW5uaW5nKHByZXYtPnZjcHVfbGlz
dCk7CisgICAgICAgICAgICAgICAgIHZuZXh0LT5kb21haW4tPmRvbWFpbl9pZCwgdm5leHQtPnNj
aGVkX3VuaXQtPnVuaXRfaWQsCisgICAgICAgICAgICAgICAgIG5vdyAtIHZwcmV2LT5ydW5zdGF0
ZS5zdGF0ZV9lbnRyeV90aW1lLAorICAgICAgICAgICAgICAgICB2cHJldi0+c2NoZWRfdW5pdC0+
bmV4dF90aW1lKTsKKyAgICAgICAgc2NoZWRfY29udGV4dF9zd2l0Y2hlZCh2cHJldiwgdm5leHQp
OworICAgICAgICB0cmFjZV9jb250aW51ZV9ydW5uaW5nKHZuZXh0KTsKKyAgICAgICAgcmV0dXJu
IGNvbnRpbnVlX3J1bm5pbmcodnByZXYpOwogICAgIH0KIAotICAgIFRSQUNFXzNEKFRSQ19TQ0hF
RF9TV0lUQ0hfSU5GUFJFViwKLSAgICAgICAgICAgICBwcmV2LT5kb21haW4tPmRvbWFpbl9pZCwg
cHJldi0+dW5pdF9pZCwKLSAgICAgICAgICAgICBub3cgLSBwcmV2LT5zdGF0ZV9lbnRyeV90aW1l
KTsKLSAgICBUUkFDRV80RChUUkNfU0NIRURfU1dJVENIX0lORk5FWFQsCi0gICAgICAgICAgICAg
bmV4dC0+ZG9tYWluLT5kb21haW5faWQsIG5leHQtPnVuaXRfaWQsCi0gICAgICAgICAgICAgKG5l
eHQtPnZjcHVfbGlzdC0+cnVuc3RhdGUuc3RhdGUgPT0gUlVOU1RBVEVfcnVubmFibGUpID8KLSAg
ICAgICAgICAgICAobm93IC0gbmV4dC0+c3RhdGVfZW50cnlfdGltZSkgOiAwLAotICAgICAgICAg
ICAgIHByZXYtPm5leHRfdGltZSk7CisgICAgU0NIRURfU1RBVF9DUkFOSyhzY2hlZF9jdHgpOwog
Ci0gICAgQVNTRVJUKHByZXYtPnZjcHVfbGlzdC0+cnVuc3RhdGUuc3RhdGUgPT0gUlVOU1RBVEVf
cnVubmluZyk7CisgICAgc3RvcF90aW1lcigmdnByZXYtPnBlcmlvZGljX3RpbWVyKTsKIAotICAg
IFRSQUNFXzREKFRSQ19TQ0hFRF9TV0lUQ0gsCi0gICAgICAgICAgICAgcHJldi0+ZG9tYWluLT5k
b21haW5faWQsIHByZXYtPnVuaXRfaWQsCi0gICAgICAgICAgICAgbmV4dC0+ZG9tYWluLT5kb21h
aW5faWQsIG5leHQtPnVuaXRfaWQpOworICAgIGlmICggdm5leHQtPnNjaGVkX3VuaXQtPm1pZ3Jh
dGVkICkKKyAgICAgICAgdmNwdV9tb3ZlX2lycXModm5leHQpOwogCi0gICAgc2NoZWRfdW5pdF9y
dW5zdGF0ZV9jaGFuZ2UocHJldiwgZmFsc2UsIG5vdyk7CisgICAgdmNwdV9wZXJpb2RpY190aW1l
cl93b3JrKHZuZXh0KTsKIAotICAgIEFTU0VSVChuZXh0LT52Y3B1X2xpc3QtPnJ1bnN0YXRlLnN0
YXRlICE9IFJVTlNUQVRFX3J1bm5pbmcpOwotICAgIHNjaGVkX3VuaXRfcnVuc3RhdGVfY2hhbmdl
KG5leHQsIHRydWUsIG5vdyk7CisgICAgY29udGV4dF9zd2l0Y2godnByZXYsIHZuZXh0KTsKK30K
IAotICAgIC8qCi0gICAgICogTkIuIERvbid0IGFkZCBhbnkgdHJhY2UgcmVjb3JkcyBmcm9tIGhl
cmUgdW50aWwgdGhlIGFjdHVhbCBjb250ZXh0Ci0gICAgICogc3dpdGNoLCBlbHNlIGxvc3RfcmVj
b3JkcyByZXN1bWUgd2lsbCBub3Qgd29yayBwcm9wZXJseS4KLSAgICAgKi8KKy8qCisgKiBSZW5k
ZXp2b3VzIGJlZm9yZSB0YWtpbmcgYSBzY2hlZHVsaW5nIGRlY2lzaW9uLgorICogQ2FsbGVkIHdp
dGggc2NoZWR1bGUgbG9jayBoZWxkLCBzbyBhbGwgYWNjZXNzZXMgdG8gdGhlIHJlbmRlenZvdXMg
Y291bnRlcgorICogY2FuIGJlIG5vcm1hbCBvbmVzIChubyBhdG9taWMgYWNjZXNzZXMgbmVlZGVk
KS4KKyAqIFRoZSBjb3VudGVyIGlzIGluaXRpYWxpemVkIHRvIHRoZSBudW1iZXIgb2YgY3B1cyB0
byByZW5kZXp2b3VzIGluaXRpYWxseS4KKyAqIEVhY2ggY3B1IGVudGVyaW5nIHdpbGwgZGVjcmVt
ZW50IHRoZSBjb3VudGVyLiBJbiBjYXNlIHRoZSBjb3VudGVyIGJlY29tZXMKKyAqIHplcm8gZG9f
c2NoZWR1bGUoKSBpcyBjYWxsZWQgYW5kIHRoZSByZW5kZXp2b3VzIGNvdW50ZXIgZm9yIGxlYXZp
bmcKKyAqIGNvbnRleHRfc3dpdGNoKCkgaXMgc2V0LiBBbGwgb3RoZXIgbWVtYmVycyB3aWxsIHdh
aXQgdW50aWwgdGhlIGNvdW50ZXIgaXMKKyAqIGJlY29taW5nIHplcm8sIGRyb3BwaW5nIHRoZSBz
Y2hlZHVsZSBsb2NrIGluIGJldHdlZW4uCisgKi8KK3N0YXRpYyBzdHJ1Y3Qgc2NoZWRfdW5pdCAq
c2NoZWRfd2FpdF9yZW5kZXp2b3VzX2luKHN0cnVjdCBzY2hlZF91bml0ICpwcmV2LAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BpbmxvY2tfdCAq
KmxvY2ssIGludCBjcHUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBzX3RpbWVfdCBub3cpCit7CisgICAgc3RydWN0IHNjaGVkX3VuaXQgKm5leHQ7
CiAKLSAgICBBU1NFUlQoIW5leHQtPmlzX3J1bm5pbmcpOwotICAgIG5leHQtPnZjcHVfbGlzdC0+
aXNfcnVubmluZyA9IDE7Ci0gICAgbmV4dC0+aXNfcnVubmluZyA9IHRydWU7Ci0gICAgbmV4dC0+
c3RhdGVfZW50cnlfdGltZSA9IG5vdzsKKyAgICBpZiAoICEtLXByZXYtPnJlbmRlenZvdXNfaW5f
Y250ICkKKyAgICB7CisgICAgICAgIG5leHQgPSBkb19zY2hlZHVsZShwcmV2LCBub3csIGNwdSk7
CisgICAgICAgIGF0b21pY19zZXQoJm5leHQtPnJlbmRlenZvdXNfb3V0X2NudCwgc2NoZWRfZ3Jh
bnVsYXJpdHkgKyAxKTsKKyAgICAgICAgcmV0dXJuIG5leHQ7CisgICAgfQogCi0gICAgcGNwdV9z
Y2hlZHVsZV91bmxvY2tfaXJxKGxvY2ssIGNwdSk7CisgICAgd2hpbGUgKCBwcmV2LT5yZW5kZXp2
b3VzX2luX2NudCApCisgICAgeworICAgICAgICAvKgorICAgICAgICAgKiBDb21pbmcgZnJvbSBp
ZGxlIG1pZ2h0IG5lZWQgdG8gZG8gdGFza2xldCB3b3JrLgorICAgICAgICAgKiBJbiBvcmRlciB0
byBhdm9pZCBkZWFkbG9ja3Mgd2UgY2FuJ3QgZG8gdGhhdCBoZXJlLCBidXQgaGF2ZSB0bworICAg
ICAgICAgKiBjb250aW51ZSB0aGUgaWRsZSBsb29wLgorICAgICAgICAgKiBVbmRvIHRoZSByZW5k
ZXp2b3VzX2luX2NudCBkZWNyZW1lbnQgYW5kIHNjaGVkdWxlIGFub3RoZXIgY2FsbCBvZgorICAg
ICAgICAgKiBzY2hlZF9zbGF2ZSgpLgorICAgICAgICAgKi8KKyAgICAgICAgaWYgKCBpc19pZGxl
X3VuaXQocHJldikgJiYgc2NoZWRfdGFza2xldF9jaGVja19jcHUoY3B1KSApCisgICAgICAgIHsK
KyAgICAgICAgICAgIHN0cnVjdCB2Y3B1ICp2cHJldiA9IGN1cnJlbnQ7CiAKLSAgICBTQ0hFRF9T
VEFUX0NSQU5LKHNjaGVkX2N0eCk7CisgICAgICAgICAgICBwcmV2LT5yZW5kZXp2b3VzX2luX2Nu
dCsrOworICAgICAgICAgICAgYXRvbWljX3NldCgmcHJldi0+cmVuZGV6dm91c19vdXRfY250LCAw
KTsKKworICAgICAgICAgICAgcGNwdV9zY2hlZHVsZV91bmxvY2tfaXJxKCpsb2NrLCBjcHUpOwor
CisgICAgICAgICAgICByYWlzZV9zb2Z0aXJxKFNDSEVEX1NMQVZFX1NPRlRJUlEpOworICAgICAg
ICAgICAgc2NoZWRfY29udGV4dF9zd2l0Y2godnByZXYsIHZwcmV2LCBub3cpOworCisgICAgICAg
ICAgICByZXR1cm4gTlVMTDsgICAgICAgICAvKiBBUk0gb25seS4gKi8KKyAgICAgICAgfQogCi0g
ICAgc3RvcF90aW1lcigmcHJldi0+dmNwdV9saXN0LT5wZXJpb2RpY190aW1lcik7CisgICAgICAg
IHBjcHVfc2NoZWR1bGVfdW5sb2NrX2lycSgqbG9jaywgY3B1KTsKIAotICAgIGlmICggbmV4dC0+
bWlncmF0ZWQgKQotICAgICAgICB2Y3B1X21vdmVfaXJxcyhuZXh0LT52Y3B1X2xpc3QpOworICAg
ICAgICBjcHVfcmVsYXgoKTsKIAotICAgIHZjcHVfcGVyaW9kaWNfdGltZXJfd29yayhuZXh0LT52
Y3B1X2xpc3QpOworICAgICAgICAqbG9jayA9IHBjcHVfc2NoZWR1bGVfbG9ja19pcnEoY3B1KTsK
KyAgICB9CiAKLSAgICBjb250ZXh0X3N3aXRjaChwcmV2LT52Y3B1X2xpc3QsIG5leHQtPnZjcHVf
bGlzdCk7CisgICAgcmV0dXJuIHByZXYtPm5leHRfdGFzazsKIH0KIAotdm9pZCBjb250ZXh0X3Nh
dmVkKHN0cnVjdCB2Y3B1ICpwcmV2KQorc3RhdGljIHZvaWQgc2NoZWRfc2xhdmUodm9pZCkKIHsK
LSAgICAvKiBDbGVhciBydW5uaW5nIGZsYWcgL2FmdGVyLyB3cml0aW5nIGNvbnRleHQgdG8gbWVt
b3J5LiAqLwotICAgIHNtcF93bWIoKTsKKyAgICBzdHJ1Y3QgdmNwdSAgICAgICAgICAqdnByZXYg
PSBjdXJyZW50OworICAgIHN0cnVjdCBzY2hlZF91bml0ICAgICpwcmV2ID0gdnByZXYtPnNjaGVk
X3VuaXQsICpuZXh0OworICAgIHNfdGltZV90ICAgICAgICAgICAgICBub3c7CisgICAgc3Bpbmxv
Y2tfdCAgICAgICAgICAgKmxvY2s7CisgICAgdW5zaWduZWQgaW50ICAgICAgICAgIGNwdSA9IHNt
cF9wcm9jZXNzb3JfaWQoKTsKIAotICAgIHByZXYtPmlzX3J1bm5pbmcgPSAwOwotICAgIHByZXYt
PnNjaGVkX3VuaXQtPmlzX3J1bm5pbmcgPSBmYWxzZTsKLSAgICBwcmV2LT5zY2hlZF91bml0LT5z
dGF0ZV9lbnRyeV90aW1lID0gTk9XKCk7CisgICAgQVNTRVJUX05PVF9JTl9BVE9NSUMoKTsKIAot
ICAgIC8qIENoZWNrIGZvciBtaWdyYXRpb24gcmVxdWVzdCAvYWZ0ZXIvIGNsZWFyaW5nIHJ1bm5p
bmcgZmxhZy4gKi8KLSAgICBzbXBfbWIoKTsKKyAgICBsb2NrID0gcGNwdV9zY2hlZHVsZV9sb2Nr
X2lycShjcHUpOwogCi0gICAgc2NoZWRfY29udGV4dF9zYXZlZCh2Y3B1X3NjaGVkdWxlcihwcmV2
KSwgcHJldi0+c2NoZWRfdW5pdCk7CisgICAgbm93ID0gTk9XKCk7CisKKyAgICBpZiAoICFwcmV2
LT5yZW5kZXp2b3VzX2luX2NudCApCisgICAgeworICAgICAgICBwY3B1X3NjaGVkdWxlX3VubG9j
a19pcnEobG9jaywgY3B1KTsKKyAgICAgICAgcmV0dXJuOworICAgIH0KKworICAgIHN0b3BfdGlt
ZXIoJmdldF9zY2hlZF9yZXMoY3B1KS0+c190aW1lcik7CisKKyAgICBuZXh0ID0gc2NoZWRfd2Fp
dF9yZW5kZXp2b3VzX2luKHByZXYsICZsb2NrLCBjcHUsIG5vdyk7CisgICAgaWYgKCAhbmV4dCAp
CisgICAgICAgIHJldHVybjsKKworICAgIHBjcHVfc2NoZWR1bGVfdW5sb2NrX2lycShsb2NrLCBj
cHUpOwogCi0gICAgc2NoZWRfdW5pdF9taWdyYXRlX2ZpbmlzaChwcmV2LT5zY2hlZF91bml0KTsK
KyAgICBzY2hlZF9jb250ZXh0X3N3aXRjaCh2cHJldiwgbmV4dC0+dmNwdV9saXN0LCBub3cpOwor
fQorCisvKgorICogVGhlIG1haW4gZnVuY3Rpb24KKyAqIC0gZGVzY2hlZHVsZSB0aGUgY3VycmVu
dCBkb21haW4gKHNjaGVkdWxlciBpbmRlcGVuZGVudCkuCisgKiAtIHBpY2sgYSBuZXcgZG9tYWlu
IChzY2hlZHVsZXIgZGVwZW5kZW50KS4KKyAqLworc3RhdGljIHZvaWQgc2NoZWR1bGUodm9pZCkK
K3sKKyAgICBzdHJ1Y3QgdmNwdSAgICAgICAgICAqdm5leHQsICp2cHJldiA9IGN1cnJlbnQ7Cisg
ICAgc3RydWN0IHNjaGVkX3VuaXQgICAgKnByZXYgPSB2cHJldi0+c2NoZWRfdW5pdCwgKm5leHQg
PSBOVUxMOworICAgIHNfdGltZV90ICAgICAgICAgICAgICBub3c7CisgICAgc3RydWN0IHNjaGVk
X3Jlc291cmNlICpzcjsKKyAgICBzcGlubG9ja190ICAgICAgICAgICAqbG9jazsKKyAgICBpbnQg
Y3B1ID0gc21wX3Byb2Nlc3Nvcl9pZCgpOworCisgICAgQVNTRVJUX05PVF9JTl9BVE9NSUMoKTsK
KworICAgIFNDSEVEX1NUQVRfQ1JBTksoc2NoZWRfcnVuKTsKKworICAgIHNyID0gZ2V0X3NjaGVk
X3JlcyhjcHUpOworCisgICAgbG9jayA9IHBjcHVfc2NoZWR1bGVfbG9ja19pcnEoY3B1KTsKKwor
ICAgIGlmICggcHJldi0+cmVuZGV6dm91c19pbl9jbnQgKQorICAgIHsKKyAgICAgICAgLyoKKyAg
ICAgICAgICogV2UgaGF2ZSBhIHJhY2U6IHNjaGVkX3NsYXZlKCkgc2hvdWxkIGJlIGNhbGxlZCwg
c28gcmFpc2UgYSBzb2Z0aXJxCisgICAgICAgICAqIGluIG9yZGVyIHRvIHJlLWVudGVyIHNjaGVk
dWxlKCkgbGF0ZXIgYW5kIGNhbGwgc2NoZWRfc2xhdmUoKSBub3cuCisgICAgICAgICAqLworICAg
ICAgICBwY3B1X3NjaGVkdWxlX3VubG9ja19pcnEobG9jaywgY3B1KTsKKworICAgICAgICByYWlz
ZV9zb2Z0aXJxKFNDSEVEVUxFX1NPRlRJUlEpOworICAgICAgICByZXR1cm4gc2NoZWRfc2xhdmUo
KTsKKyAgICB9CisKKyAgICBzdG9wX3RpbWVyKCZzci0+c190aW1lcik7CisKKyAgICBub3cgPSBO
T1coKTsKKworICAgIGlmICggc2NoZWRfZ3JhbnVsYXJpdHkgPiAxICkKKyAgICB7CisgICAgICAg
IGNwdW1hc2tfdCBtYXNrOworCisgICAgICAgIHByZXYtPnJlbmRlenZvdXNfaW5fY250ID0gc2No
ZWRfZ3JhbnVsYXJpdHk7CisgICAgICAgIGNwdW1hc2tfYW5kbm90KCZtYXNrLCBzci0+Y3B1cywg
Y3B1bWFza19vZihjcHUpKTsKKyAgICAgICAgY3B1bWFza19yYWlzZV9zb2Z0aXJxKCZtYXNrLCBT
Q0hFRF9TTEFWRV9TT0ZUSVJRKTsKKyAgICAgICAgbmV4dCA9IHNjaGVkX3dhaXRfcmVuZGV6dm91
c19pbihwcmV2LCAmbG9jaywgY3B1LCBub3cpOworICAgICAgICBpZiAoICFuZXh0ICkKKyAgICAg
ICAgICAgIHJldHVybjsKKyAgICB9CisgICAgZWxzZQorICAgIHsKKyAgICAgICAgcHJldi0+cmVu
ZGV6dm91c19pbl9jbnQgPSAwOworICAgICAgICBuZXh0ID0gZG9fc2NoZWR1bGUocHJldiwgbm93
LCBjcHUpOworICAgICAgICBhdG9taWNfc2V0KCZuZXh0LT5yZW5kZXp2b3VzX291dF9jbnQsIDAp
OworICAgIH0KKworICAgIHBjcHVfc2NoZWR1bGVfdW5sb2NrX2lycShsb2NrLCBjcHUpOworCisg
ICAgdm5leHQgPSBuZXh0LT52Y3B1X2xpc3Q7CisgICAgc2NoZWRfY29udGV4dF9zd2l0Y2godnBy
ZXYsIHZuZXh0LCBub3cpOwogfQogCiAvKiBUaGUgc2NoZWR1bGVyIHRpbWVyOiBmb3JjZSBhIHJ1
biB0aHJvdWdoIHRoZSBzY2hlZHVsZXIgKi8KQEAgLTE4ODEsNiArMjA3Niw3IEBAIHN0YXRpYyBp
bnQgY3B1X3NjaGVkdWxlX3VwKHVuc2lnbmVkIGludCBjcHUpCiAgICAgaWYgKCBzciA9PSBOVUxM
ICkKICAgICAgICAgcmV0dXJuIC1FTk9NRU07CiAgICAgc3ItPm1hc3Rlcl9jcHUgPSBjcHU7Cisg
ICAgc3ItPmNwdXMgPSBjcHVtYXNrX29mKGNwdSk7CiAgICAgc2V0X3NjaGVkX3JlcyhjcHUsIHNy
KTsKIAogICAgIHBlcl9jcHUoc2NoZWR1bGVyLCBjcHUpID0gJnNjaGVkX2lkbGVfb3BzOwpAQCAt
MTkwMSw2ICsyMDk3LDggQEAgc3RhdGljIGludCBjcHVfc2NoZWR1bGVfdXAodW5zaWduZWQgaW50
IGNwdSkKICAgICBpZiAoIGlkbGVfdmNwdVtjcHVdID09IE5VTEwgKQogICAgICAgICByZXR1cm4g
LUVOT01FTTsKIAorICAgIGlkbGVfdmNwdVtjcHVdLT5zY2hlZF91bml0LT5yZW5kZXp2b3VzX2lu
X2NudCA9IDA7CisKICAgICAvKgogICAgICAqIE5vIG5lZWQgdG8gYWxsb2NhdGUgYW55IHNjaGVk
dWxlciBkYXRhLCBhcyBjcHVzIGNvbWluZyBvbmxpbmUgYXJlCiAgICAgICogZnJlZSBpbml0aWFs
bHkgYW5kIHRoZSBpZGxlIHNjaGVkdWxlciBkb2Vzbid0IG5lZWQgYW55IGRhdGEgYXJlYXMKQEAg
LTIwMDEsNiArMjE5OSw3IEBAIHZvaWQgX19pbml0IHNjaGVkdWxlcl9pbml0KHZvaWQpCiAgICAg
aW50IGk7CiAKICAgICBvcGVuX3NvZnRpcnEoU0NIRURVTEVfU09GVElSUSwgc2NoZWR1bGUpOwor
ICAgIG9wZW5fc29mdGlycShTQ0hFRF9TTEFWRV9TT0ZUSVJRLCBzY2hlZF9zbGF2ZSk7CiAKICAg
ICBmb3IgKCBpID0gMDsgaSA8IE5VTV9TQ0hFRFVMRVJTOyBpKyspCiAgICAgewpkaWZmIC0tZ2l0
IGEveGVuL2NvbW1vbi9zb2Z0aXJxLmMgYi94ZW4vY29tbW9uL3NvZnRpcnEuYwppbmRleCA4M2Mz
YzA5YmQ1Li4yZDY2MTkzMjAzIDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL3NvZnRpcnEuYworKysg
Yi94ZW4vY29tbW9uL3NvZnRpcnEuYwpAQCAtMzMsOCArMzMsOCBAQCBzdGF0aWMgdm9pZCBfX2Rv
X3NvZnRpcnEodW5zaWduZWQgbG9uZyBpZ25vcmVfbWFzaykKICAgICBmb3IgKCA7IDsgKQogICAg
IHsKICAgICAgICAgLyoKLSAgICAgICAgICogSW5pdGlhbGlzZSBAY3B1IG9uIGV2ZXJ5IGl0ZXJh
dGlvbjogU0NIRURVTEVfU09GVElSUSBtYXkgbW92ZQotICAgICAgICAgKiB1cyB0byBhbm90aGVy
IHByb2Nlc3Nvci4KKyAgICAgICAgICogSW5pdGlhbGlzZSBAY3B1IG9uIGV2ZXJ5IGl0ZXJhdGlv
bjogU0NIRURVTEVfU09GVElSUSBvcgorICAgICAgICAgKiBTQ0hFRF9TTEFWRV9TT0ZUSVJRIG1h
eSBtb3ZlIHVzIHRvIGFub3RoZXIgcHJvY2Vzc29yLgogICAgICAgICAgKi8KICAgICAgICAgY3B1
ID0gc21wX3Byb2Nlc3Nvcl9pZCgpOwogCkBAIC01NSw3ICs1NSw3IEBAIHZvaWQgcHJvY2Vzc19w
ZW5kaW5nX3NvZnRpcnFzKHZvaWQpCiB7CiAgICAgQVNTRVJUKCFpbl9pcnEoKSAmJiBsb2NhbF9p
cnFfaXNfZW5hYmxlZCgpKTsKICAgICAvKiBEbyBub3QgZW50ZXIgc2NoZWR1bGVyIGFzIGl0IGNh
biBwcmVlbXB0IHRoZSBjYWxsaW5nIGNvbnRleHQuICovCi0gICAgX19kb19zb2Z0aXJxKDF1bDw8
U0NIRURVTEVfU09GVElSUSk7CisgICAgX19kb19zb2Z0aXJxKCgxdWwgPDwgU0NIRURVTEVfU09G
VElSUSkgfCAoMXVsIDw8IFNDSEVEX1NMQVZFX1NPRlRJUlEpKTsKIH0KIAogdm9pZCBkb19zb2Z0
aXJxKHZvaWQpCmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQtaWYuaCBiL3hlbi9p
bmNsdWRlL3hlbi9zY2hlZC1pZi5oCmluZGV4IDA0MjNiZTk4N2QuLmM2NWRmYTk0M2IgMTAwNjQ0
Ci0tLSBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5oCisrKyBiL3hlbi9pbmNsdWRlL3hlbi9z
Y2hlZC1pZi5oCkBAIC00Miw2ICs0Miw3IEBAIHN0cnVjdCBzY2hlZF9yZXNvdXJjZSB7CiAKICAg
ICAvKiBDcHUgd2l0aCBsb3dlc3QgaWQgaW4gc2NoZWR1bGluZyByZXNvdXJjZS4gKi8KICAgICB1
bnNpZ25lZCBpbnQgICAgICAgIG1hc3Rlcl9jcHU7CisgICAgY29uc3QgY3B1bWFza190ICAgICpj
cHVzOyAgICAgICAgICAgLyogY3B1cyBjb3ZlcmVkIGJ5IHRoaXMgc3RydWN0ICAgICAqLwogfTsK
IAogREVDTEFSRV9QRVJfQ1BVKHN0cnVjdCBzY2hlZHVsZXIgKiwgc2NoZWR1bGVyKTsKZGlmZiAt
LWdpdCBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oIGIveGVuL2luY2x1ZGUveGVuL3NjaGVkLmgK
aW5kZXggZWJmNzIzYTg2Ni4uYzc3MGFiNGFhMCAxMDA2NDQKLS0tIGEveGVuL2luY2x1ZGUveGVu
L3NjaGVkLmgKKysrIGIveGVuL2luY2x1ZGUveGVuL3NjaGVkLmgKQEAgLTI5Miw2ICsyOTIsMTIg
QEAgc3RydWN0IHNjaGVkX3VuaXQgewogICAgIC8qIE5leHQgdW5pdCB0byBydW4uICovCiAgICAg
c3RydWN0IHNjaGVkX3VuaXQgICAgICAqbmV4dF90YXNrOwogICAgIHNfdGltZV90ICAgICAgICAg
ICAgICAgIG5leHRfdGltZTsKKworICAgIC8qIE51bWJlciBvZiB2Y3B1cyBub3QgeWV0IGpvaW5l
ZCBmb3IgY29udGV4dCBzd2l0Y2guICovCisgICAgdW5zaWduZWQgaW50ICAgICAgICAgICAgcmVu
ZGV6dm91c19pbl9jbnQ7CisKKyAgICAvKiBOdW1iZXIgb2YgdmNwdXMgbm90IHlldCBmaW5pc2hl
ZCB3aXRoIGNvbnRleHQgc3dpdGNoLiAqLworICAgIGF0b21pY190ICAgICAgICAgICAgICAgIHJl
bmRlenZvdXNfb3V0X2NudDsKIH07CiAKICNkZWZpbmUgZm9yX2VhY2hfc2NoZWRfdW5pdChkLCB1
KSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXApAQCAtNjk2LDEwICs3
MDIsMTAgQEAgdm9pZCBzeW5jX2xvY2FsX2V4ZWNzdGF0ZSh2b2lkKTsKIAogLyoKICAqIENhbGxl
ZCBieSB0aGUgc2NoZWR1bGVyIHRvIHN3aXRjaCB0byBhbm90aGVyIFZDUFUuIFRoaXMgZnVuY3Rp
b24gbXVzdAotICogY2FsbCBjb250ZXh0X3NhdmVkKEBwcmV2KSB3aGVuIHRoZSBsb2NhbCBDUFUg
aXMgbm8gbG9uZ2VyIHJ1bm5pbmcgaW4KLSAqIEBwcmV2J3MgY29udGV4dCwgYW5kIHRoYXQgY29u
dGV4dCBpcyBzYXZlZCB0byBtZW1vcnkuIEFsdGVybmF0aXZlbHksIGlmCi0gKiBpbXBsZW1lbnRp
bmcgbGF6eSBjb250ZXh0IHN3aXRjaGluZywgaXQgc3VmZmljZXMgdG8gZW5zdXJlIHRoYXQgaW52
b2tpbmcKLSAqIHN5bmNfdmNwdV9leGVjc3RhdGUoKSB3aWxsIHN3aXRjaCBhbmQgY29tbWl0IEBw
cmV2J3Mgc3RhdGUuCisgKiBjYWxsIHNjaGVkX2NvbnRleHRfc3dpdGNoZWQoQHByZXYsIEBuZXh0
KSB3aGVuIHRoZSBsb2NhbCBDUFUgaXMgbm8gbG9uZ2VyCisgKiBydW5uaW5nIGluIEBwcmV2J3Mg
Y29udGV4dCwgYW5kIHRoYXQgY29udGV4dCBpcyBzYXZlZCB0byBtZW1vcnkuCisgKiBBbHRlcm5h
dGl2ZWx5LCBpZiBpbXBsZW1lbnRpbmcgbGF6eSBjb250ZXh0IHN3aXRjaGluZywgaXQgc3VmZmlj
ZXMgdG8gZW5zdXJlCisgKiB0aGF0IGludm9raW5nIHN5bmNfdmNwdV9leGVjc3RhdGUoKSB3aWxs
IHN3aXRjaCBhbmQgY29tbWl0IEBwcmV2J3Mgc3RhdGUuCiAgKi8KIHZvaWQgY29udGV4dF9zd2l0
Y2goCiAgICAgc3RydWN0IHZjcHUgKnByZXYsCkBAIC03MTEsNyArNzE3LDcgQEAgdm9pZCBjb250
ZXh0X3N3aXRjaCgKICAqIHNhdmVkIHRvIG1lbW9yeS4gQWx0ZXJuYXRpdmVseSwgaWYgaW1wbGVt
ZW50aW5nIGxhenkgY29udGV4dCBzd2l0Y2hpbmcsCiAgKiBlbnN1cmUgdGhhdCBpbnZva2luZyBz
eW5jX3ZjcHVfZXhlY3N0YXRlKCkgd2lsbCBzd2l0Y2ggYW5kIGNvbW1pdCBAcHJldi4KICAqLwot
dm9pZCBjb250ZXh0X3NhdmVkKHN0cnVjdCB2Y3B1ICpwcmV2KTsKK3ZvaWQgc2NoZWRfY29udGV4
dF9zd2l0Y2hlZChzdHJ1Y3QgdmNwdSAqcHJldiwgc3RydWN0IHZjcHUgKnZuZXh0KTsKIAogLyog
Q2FsbGVkIGJ5IHRoZSBzY2hlZHVsZXIgdG8gY29udGludWUgcnVubmluZyB0aGUgY3VycmVudCBW
Q1BVLiAqLwogdm9pZCBjb250aW51ZV9ydW5uaW5nKApkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUv
eGVuL3NvZnRpcnEuaCBiL3hlbi9pbmNsdWRlL3hlbi9zb2Z0aXJxLmgKaW5kZXggYzMyN2M5YjZj
ZC4uZDcyNzNiMzg5YiAxMDA2NDQKLS0tIGEveGVuL2luY2x1ZGUveGVuL3NvZnRpcnEuaAorKysg
Yi94ZW4vaW5jbHVkZS94ZW4vc29mdGlycS5oCkBAIC00LDYgKzQsNyBAQAogLyogTG93LWxhdGVu
Y3kgc29mdGlycXMgY29tZSBmaXJzdCBpbiB0aGUgZm9sbG93aW5nIGxpc3QuICovCiBlbnVtIHsK
ICAgICBUSU1FUl9TT0ZUSVJRID0gMCwKKyAgICBTQ0hFRF9TTEFWRV9TT0ZUSVJRLAogICAgIFND
SEVEVUxFX1NPRlRJUlEsCiAgICAgTkVXX1RMQkZMVVNIX0NMT0NLX1BFUklPRF9TT0ZUSVJRLAog
ICAgIFJDVV9TT0ZUSVJRLAotLSAKMi4xNi40CgoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlz
dHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xp
c3RpbmZvL3hlbi1kZXZlbA==

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 58CE035D0D
	for <lists+xen-devel@lfdr.de>; Wed,  5 Jun 2019 14:42:02 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hYVAc-0001xO-Iw; Wed, 05 Jun 2019 12:37:34 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=73hT=UE=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1hYVAb-0001xJ-If
 for xen-devel@lists.xenproject.org; Wed, 05 Jun 2019 12:37:33 +0000
X-Inumbo-ID: ae89295c-878e-11e9-b934-63c300ec3e7e
Received: from prv1-mh.provo.novell.com (unknown [137.65.248.33])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id ae89295c-878e-11e9-b934-63c300ec3e7e;
 Wed, 05 Jun 2019 12:37:30 +0000 (UTC)
Received: from INET-PRV1-MTA by prv1-mh.provo.novell.com
 with Novell_GroupWise; Wed, 05 Jun 2019 06:37:29 -0600
Message-Id: <5CF7B7870200007800235841@prv1-mh.provo.novell.com>
X-Mailer: Novell GroupWise Internet Agent 18.1.1 
Date: Wed, 05 Jun 2019 06:37:27 -0600
From: "Jan Beulich" <JBeulich@suse.com>
To: "Chao Gao" <chao.gao@intel.com>
References: <1558945891-3015-1-git-send-email-chao.gao@intel.com>
 <1558945891-3015-7-git-send-email-chao.gao@intel.com>
In-Reply-To: <1558945891-3015-7-git-send-email-chao.gao@intel.com>
Mime-Version: 1.0
Content-Disposition: inline
Subject: Re: [Xen-devel] [PATCH v7 06/10] microcode: split out
 apply_microcode() from cpu_request_microcode()
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Sergey Dyasli <sergey.dyasli@citrix.com>, Ashok Raj <ashok.raj@intel.com>,
 WeiLiu <wl@xen.org>, Andrew Cooper <andrew.cooper3@citrix.com>,
 xen-devel <xen-devel@lists.xenproject.org>,
 Roger Pau Monne <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

Pj4+IE9uIDI3LjA1LjE5IGF0IDEwOjMxLCA8Y2hhby5nYW9AaW50ZWwuY29tPiB3cm90ZToKPiBE
dXJpbmcgbGF0ZSBtaWNyb2NvZGUgdXBkYXRlLCBhcHBseV9taWNyb2NvZGUoKSBpcyBpbnZva2Vk
IGluCj4gY3B1X3JlcXVlc3RfbWljcm9jb2RlKCkuIFRvIG1ha2UgbGF0ZSBtaWNyb2NvZGUgdXBk
YXRlIG1vcmUgcmVsaWFibGUsCj4gd2Ugd2FudCB0byBwdXQgdGhlIGFwcGx5X21pY3JvY29kZSgp
IGludG8gc3RvcF9tYWNoaW5lIGNvbnRleHQuIFNvCj4gd2Ugc3BsaXQgb3V0IGl0IGZyb20gY3B1
X3JlcXVlc3RfbWljcm9jb2RlKCkuIEFzIGEgY29uc2VxdWVuY2UsCj4gYXBwbHlfbWljcm9jb2Rl
KCkgc2hvdWxkIGJlIGludm9rZWQgZXhwbGljaXRseSBpbiB0aGUgY29tbW9uIGNvZGUuCj4gCj4g
UHJldmlvdXNseSwgYXBwbHlfbWljcm9jb2RlKCkgZ2V0cyB0aGUgbWljcm9jb2RlIHBhdGNoIHRv
IGJlIGFwcGxpZWQgZnJvbQo+IHRoZSBtaWNyb2NvZGUgY2FjaGUuIE5vdywgdGhlIHBhdGNoIGlz
IHBhc3NlZCBhcyBhIGZ1bmN0aW9uIGFyZ3VtZW50IGFuZAo+IGEgcGF0Y2ggaXMgY2FjaGVkIGZv
ciBjcHUtaG90cGx1ZyBhbmQgY3B1IHJlc3VtaW5nLCBvbmx5IGFmdGVyIGl0IGhhcwo+IGJlZW4g
bG9hZGVkIHRvIGEgY3B1IHdpdGhvdXQgYW55IGVycm9yLiBBcyBhIGNvbnNlcXVlbmNlLCB0aGUK
PiAnbWF0Y2hfY3B1JyBjaGVjayBpbiBtaWNyb2NvZGVfdXBkYXRlX2NhY2hlIGlzIHJlbW92ZWQs
IHdoaWNoIG90aGVyd2lzZQo+IHdvdWxkIGZhaWwuCgpUaGUgIm9ubHkgYWZ0ZXIgaXQgaGFzIGJl
ZW4gbG9hZGVkIHRvIGEgY3B1IHdpdGhvdXQgYW55IGVycm9yIiBpcyBhCnByb2JsZW0sIHByZWNp
c2VseSBmb3IgdGhlIGNhc2Ugd2hlcmUgdWNvZGUgb24gdGhlIGRpZmZlcmVudCBjb3JlcwppcyBu
b3QgaW4gc3luYyBpbml0aWFsbHkuIEkgd291bGQgYWN0dWFsbHkgbGlrZSB0byBwdXQgdXAgdGhp
cyBxdWVzdGlvbjoKV2hlbiBhIGNvcmUgaGFzIG5vIHVjb2RlIGxvYWRlZCBhdCBhbGwgeWV0IGFu
ZCBvbmx5IHN0cmljdGx5IG9sZGVyCih0aGFuIGxvYWRlZCBvbiBzb21lIG90aGVyIGNvcmVzKSB1
Y29kZSBpcyBmb3VuZCB0byBiZSBhdmFpbGFibGUsCndoZXRoZXIgdGhlbiBpdCB3b3VsZG4ndCBz
dGlsbCBiZSBiZXR0ZXIgdG8gYXBwbHkgdGhhdCB1Y29kZSB0bwpfYXQgbGVhc3RfIHRoZSBjb3Jl
cyB0aGF0IGhhdmUgbm9uZSBsb2FkZWQgeWV0LgoKVG8gZ2V0IHRoZSBzeXN0ZW0gaW50byAic2Fu
ZSIgc3RhdGUgaXQgbWF5IGV2ZW4gYmUgbmVjZXNzYXJ5IHRvCmRvd25ncmFkZSB1Y29kZSBvbiB0
aGUgY29yZXMgd2hpY2ggZGlkIGhhdmUgaXQgbG9hZGVkIGFscmVhZHksCmluIHN1Y2ggYSBzaXR1
YXRpb24uCgo+IE9uIEFNRCBzaWRlLCBzdm1faG9zdF9vc3Z3X2luaXQoKSBpcyBzdXBwb3NlZCB0
byBiZSBjYWxsZWQgYWZ0ZXIKPiBtaWNyb2NvZGUgdXBkYXRlLiBBcyBhcHBseV9taWNyY29kZSgp
IHdvbid0IGJlIGNhbGxlZCBieQo+IGNwdV9yZXF1ZXN0X21pY3JvY29kZSgpIG5vdywgc3ZtX2hv
c3Rfb3N2d19pbml0KCkgaXMgbW92ZWQgdG8gdGhlCj4gZW5kIG9mIGFwcGx5X21pY3JvY29kZSgp
LgoKSSBndWVzcyB0aGlzIHJlYWxseSBvdWdodCB0byBiZWNvbWUgYSB2ZW5kb3IgaG9vayBhcyB3
ZWxsLCBidXQgSQp3b3VsZG4ndCBpbnNpc3Qgb24geW91IGRvaW5nIHNvIGhlcmUuCgo+IC0tLSBh
L3hlbi9hcmNoL3g4Ni9hY3BpL3Bvd2VyLmMKPiArKysgYi94ZW4vYXJjaC94ODYvYWNwaS9wb3dl
ci5jCj4gQEAgLTI1Myw3ICsyNTMsNyBAQCBzdGF0aWMgaW50IGVudGVyX3N0YXRlKHUzMiBzdGF0
ZSkKPiAgCj4gICAgICBjb25zb2xlX2VuZF9zeW5jKCk7Cj4gIAo+IC0gICAgbWljcm9jb2RlX3Jl
c3VtZV9jcHUoKTsKPiArICAgIGVhcmx5X21pY3JvY29kZV91cGRhdGVfY3B1KCk7CgpUaGUgdXNl
IGhlcmUsIHRoZSAoY2hhbmdlZCkgdXNlIGluIHN0YXJ0X3NlY29uZGFyeSgpLCBhbmQgdGhlIGRy
b3BwaW5nCm9mIGl0cyBfX2luaXQgc3VnZ2VzdCB0byBtYWtlIGFuIGF0dGVtcHQgdG8gZmluZCBh
IGJldHRlciBuYW1lIGZvciB0aGUKZnVuY3Rpb24uIE1heWJlIG1pY3JvY29kZV91cGRhdGVfb25l
KCk/Cgo+ICsvKgo+ICsgKiBMb2FkIGEgbWljcm9jb2RlIHVwZGF0ZSB0byBjdXJyZW50IENQVS4K
PiArICoKPiArICogSWYgbm8gcGF0Y2ggaXMgcHJvdmlkZWQsIHRoZSBjYWNoZWQgcGF0Y2ggd2ls
bCBiZSBsb2FkZWQuIE1pY3JvY29kZSB1cGRhdGUKPiArICogZHVyaW5nIEFQcyBicmluZ3VwIGFu
ZCBDUFUgcmVzdW1pbmcgZmFsbHMgaW50byB0aGlzIGNhc2UuCj4gKyAqLwo+ICtzdGF0aWMgaW50
IG1pY3JvY29kZV91cGRhdGVfY3B1KHN0cnVjdCBtaWNyb2NvZGVfcGF0Y2ggKnBhdGNoKQoKY29u
c3Q/Cgo+ICB7Cj4gLSAgICBpbnQgZXJyOwo+IC0gICAgc3RydWN0IGNwdV9zaWduYXR1cmUgKnNp
ZyA9ICZ0aGlzX2NwdShjcHVfc2lnKTsKPiArICAgIGludCByZXQgPSBtaWNyb2NvZGVfb3BzLT5j
b2xsZWN0X2NwdV9pbmZvKCZ0aGlzX2NwdShjcHVfc2lnKSk7Cj4gIAo+IC0gICAgaWYgKCAhbWlj
cm9jb2RlX29wcyApCj4gLSAgICAgICAgcmV0dXJuIDA7Cj4gKyAgICBpZiAoIHVubGlrZWx5KHJl
dCkgKQo+ICsgICAgICAgIHJldHVybiByZXQ7Cj4gIAo+ICAgICAgc3Bpbl9sb2NrKCZtaWNyb2Nv
ZGVfbXV0ZXgpOwo+ICAKPiAtICAgIGVyciA9IG1pY3JvY29kZV9vcHMtPmNvbGxlY3RfY3B1X2lu
Zm8oc2lnKTsKPiAtICAgIGlmICggbGlrZWx5KCFlcnIpICkKPiAtICAgICAgICBlcnIgPSBtaWNy
b2NvZGVfb3BzLT5hcHBseV9taWNyb2NvZGUoKTsKPiAtICAgIHNwaW5fdW5sb2NrKCZtaWNyb2Nv
ZGVfbXV0ZXgpOwo+ICsgICAgaWYgKCBwYXRjaCApCj4gKyAgICB7Cj4gKyAgICAgICAgLyoKPiAr
ICAgICAgICAgKiBJZiBhIHBhdGNoIGlzIHNwZWNpZmllZCwgaXQgc2hvdWxkIGhhcyBuZXdlciBy
ZXZpc2lvbiB0aGFuCj4gKyAgICAgICAgICogdGhhdCBvZiB0aGUgcGF0Y2ggY2FjaGVkLgo+ICsg
ICAgICAgICAqLwo+ICsgICAgICAgIGlmICggbWljcm9jb2RlX2NhY2hlICYmCj4gKyAgICAgICAg
ICAgICBtaWNyb2NvZGVfb3BzLT5jb21wYXJlX3BhdGNoKHBhdGNoLCBtaWNyb2NvZGVfY2FjaGUp
ICE9IE5FV19VQ09ERSApCj4gKyAgICAgICAgewo+ICsgICAgICAgICAgICBzcGluX3VubG9jaygm
bWljcm9jb2RlX211dGV4KTsKPiArICAgICAgICAgICAgcmV0dXJuIC1FSU5WQUw7Cj4gKyAgICAg
ICAgfQo+ICAKPiAtICAgIHJldHVybiBlcnI7Cj4gLX0KPiArICAgICAgICByZXQgPSBtaWNyb2Nv
ZGVfb3BzLT5hcHBseV9taWNyb2NvZGUocGF0Y2gpOwoKVGhlcmUncyBubyBwcmludGsoKSBoZXJl
IGJ1dCAuLi4KCj4gKyAgICB9Cj4gKyAgICBlbHNlIGlmICggbWljcm9jb2RlX2NhY2hlICkKPiAr
ICAgIHsKPiArICAgICAgICByZXQgPSBtaWNyb2NvZGVfb3BzLT5hcHBseV9taWNyb2NvZGUobWlj
cm9jb2RlX2NhY2hlKTsKPiArICAgICAgICBpZiAoIHJldCA9PSAtRUlPICkKPiArICAgICAgICAg
ICAgcHJpbnRrKCJVcGRhdGUgZmFpbGVkLiBSZWJvb3QgbmVlZGVkXG4iKTsKCi4uLiB5b3UgZW1p
dCBhIGxvZyBtZXNzYWdlIGhlcmUuIFdoeSB0aGUgZGlmZmVyZW5jZT8gQW5kIHdvdWxkbid0Cml0
IGJlIGJldHRlciB0byBoYXZlIGp1c3QgYSBzaW5nbGUgY2FsbCB0byAtPmFwcGx5IGFueXdheSwg
Ynkgc2ltcGx5CmFzc2lnbmluZyAibWljcm9jb2RlX2NhY2hlIiB0byAicGF0Y2giIGFuZCBtb3Zp
bmcgdGhlIGNhbGwgYSBsaXR0bGUKZnVydGhlciBkb3duPwoKPiArICAgIH0KPiArICAgIGVsc2UK
PiArICAgICAgICAvKiBObyBwYXRjaCB0byB1cGRhdGUgKi8KPiArICAgICAgICByZXQgPSAtRUlO
VkFMOwoKLUVOT0VOVD8KCj4gQEAgLTI0Nyw0NiArMjcwLDMyIEBAIGJvb2wgbWljcm9jb2RlX3Vw
ZGF0ZV9jYWNoZShzdHJ1Y3QgbWljcm9jb2RlX3BhdGNoICpwYXRjaCkKPiAgICAgIHJldHVybiB0
cnVlOwo+ICB9Cj4gIAo+IC1zdGF0aWMgaW50IG1pY3JvY29kZV91cGRhdGVfY3B1KGNvbnN0IHZv
aWQgKmJ1Ziwgc2l6ZV90IHNpemUpCj4gK3N0YXRpYyBsb25nIGRvX21pY3JvY29kZV91cGRhdGUo
dm9pZCAqcGF0Y2gpCj4gIHsKPiAtICAgIGludCBlcnI7Cj4gLSAgICB1bnNpZ25lZCBpbnQgY3B1
ID0gc21wX3Byb2Nlc3Nvcl9pZCgpOwo+IC0gICAgc3RydWN0IGNwdV9zaWduYXR1cmUgKnNpZyA9
ICZwZXJfY3B1KGNwdV9zaWcsIGNwdSk7Cj4gLQo+IC0gICAgc3Bpbl9sb2NrKCZtaWNyb2NvZGVf
bXV0ZXgpOwo+ICsgICAgaW50IGVycm9yLCBjcHU7CgpXaGlsZSAiaW50IiBpcyBmaW5lIGZvciBl
cnJvciBjb2RlcywgaXQgYWxtb3N0IGNlcnRhaW5seSB3YW50cyB0byBiZQoidW5zaWduZWQgaW50
IiBmb3IgImNwdSIuIFRoZSBtb3JlIHRoYXQgaXQgaGFkIGJlZW4gdGhhdCB3YXMgYmVmb3JlLgpJ
IGFsc28gZG9uJ3Qgc2VlIHdoeSB5b3UgbmVlZCB0byBzd2l0Y2ggZnJvbSAiZXJyIiB0byAiZXJy
b3IiIC0gb2gsCi4uLgoKPiAtICAgIGVyciA9IG1pY3JvY29kZV9vcHMtPmNvbGxlY3RfY3B1X2lu
Zm8oc2lnKTsKPiAtICAgIGlmICggbGlrZWx5KCFlcnIpICkKPiAtICAgICAgICBlcnIgPSBtaWNy
b2NvZGVfb3BzLT5jcHVfcmVxdWVzdF9taWNyb2NvZGUoYnVmLCBzaXplKTsKPiAtICAgIHNwaW5f
dW5sb2NrKCZtaWNyb2NvZGVfbXV0ZXgpOwo+IC0KPiAtICAgIHJldHVybiBlcnI7Cj4gLX0KPiAt
Cj4gLXN0YXRpYyBsb25nIGRvX21pY3JvY29kZV91cGRhdGUodm9pZCAqX2luZm8pCj4gLXsKPiAt
ICAgIHN0cnVjdCBtaWNyb2NvZGVfaW5mbyAqaW5mbyA9IF9pbmZvOwo+IC0gICAgaW50IGVycm9y
Owo+ICsgICAgZXJyb3IgPSBtaWNyb2NvZGVfdXBkYXRlX2NwdShwYXRjaCk7CgouLi4gdGhlcmUg
d2FzIGEgcHJlLWV4aXN0aW5nIHZhcmlhYmxlIG9mIHRoYXQgbmFtZSBoZXJlLgoKPiArICAgIGlm
ICggZXJyb3IgKQo+ICsgICAgewo+ICsgICAgICAgIG1pY3JvY29kZV9vcHMtPmZyZWVfcGF0Y2go
bWljcm9jb2RlX2NhY2hlKTsKCkRvZXMgdGhpcyBhbHNvIHNldCAibWljcm9jb2RlX2NhY2hlIiB0
byBOVUxMPyBJIGRpZG4ndCB0aGluayBzby4KSXQncyBhbnl3YXkgbm90IHJlYWxseSBjbGVhciB3
aHkgX2FsbF8gZm9ybXMgb2YgZXJyb3JzIHNob3VsZCBsZWFkCnRvIGNsZWFyaW5nIG9mIHRoZSBj
YWNoZS4gSG93ZXZlciAtIGxvb2tpbmcgYXQgdGhlIGNvZGUgZnVydGhlcgpkb3duLCBkb24ndCB5
b3UgcmF0aGVyIG1lYW4gdG8gZnJlZSAicGF0Y2giIGhlcmUgYW55d2F5PwoKPiArICAgICAgICBy
ZXR1cm4gZXJyb3I7Cj4gKyAgICB9Cj4gIAo+IC0gICAgQlVHX09OKGluZm8tPmNwdSAhPSBzbXBf
cHJvY2Vzc29yX2lkKCkpOwo+ICAKPiAtICAgIGVycm9yID0gbWljcm9jb2RlX3VwZGF0ZV9jcHUo
aW5mby0+YnVmZmVyLCBpbmZvLT5idWZmZXJfc2l6ZSk7Cj4gLSAgICBpZiAoIGVycm9yICkKPiAt
ICAgICAgICBpbmZvLT5lcnJvciA9IGVycm9yOwo+ICsgICAgY3B1ID0gY3B1bWFza19uZXh0KHNt
cF9wcm9jZXNzb3JfaWQoKSwgJmNwdV9vbmxpbmVfbWFwKTsKPiArICAgIGlmICggY3B1IDwgbnJf
Y3B1X2lkcyApCj4gKyAgICAgICAgcmV0dXJuIGNvbnRpbnVlX2h5cGVyY2FsbF9vbl9jcHUoY3B1
LCBkb19taWNyb2NvZGVfdXBkYXRlLCBwYXRjaCk7Cj4gIAo+IC0gICAgaW5mby0+Y3B1ID0gY3B1
bWFza19uZXh0KGluZm8tPmNwdSwgJmNwdV9vbmxpbmVfbWFwKTsKPiAtICAgIGlmICggaW5mby0+
Y3B1IDwgbnJfY3B1X2lkcyApCj4gLSAgICAgICAgcmV0dXJuIGNvbnRpbnVlX2h5cGVyY2FsbF9v
bl9jcHUoaW5mby0+Y3B1LCBkb19taWNyb2NvZGVfdXBkYXRlLCBpbmZvKTsKPiArICAgIG1pY3Jv
Y29kZV91cGRhdGVfY2FjaGUocGF0Y2gpOwoKSW5kZXBlbmRlbnQgb2YgbXkgcmVtYXJrcyBhdCB0
aGUgdG9wIEkgd291bGQgdGhpbmsgdGhhdCB1cGRhdGluZyBvZgp0aGUgY2FjaGUgc2hvdWxkIGhh
cHBlbiBhZnRlciB0aGUgZmlyc3Qgc3VjY2Vzc2Z1bCBsb2FkaW5nIG9uIGEgQ1BVLApub3QgYWZ0
ZXIgYWxsIENQVXMgaGF2ZSBiZWVuIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5LiBUaGVyZSB3b3VsZCB0
aGVuCmFsc28gbm90IGJlIGFueSBuZWVkIHRvIHBhc3MgInBhdGNoIiBvbiB0byBjb250aW51ZV9o
eXBlcmNhbGxfb25fY3B1KCkKYSBmZXcgbGluZXMgdXAgZnJvbSBoZXJlIChhbGJlaXQgZnJvbSBh
IGdlbmVyYWwgbG9naWMgcGVyc3BlY3RpdmUgaXQgbWF5CmluZGVlZCBiZSBlYXNpZXIgdG8ga2Vl
cCBpdCB0aGF0IHdheSkuCgo+IEBAIC0yOTQsMzIgKzMwMyw0OSBAQCBpbnQgbWljcm9jb2RlX3Vw
ZGF0ZShYRU5fR1VFU1RfSEFORExFX1BBUkFNKGNvbnN0X3ZvaWQpIGJ1ZiwgdW5zaWduZWQgbG9u
ZyBsZW4pCj4gICAgICBpZiAoIG1pY3JvY29kZV9vcHMgPT0gTlVMTCApCj4gICAgICAgICAgcmV0
dXJuIC1FSU5WQUw7Cj4gIAo+IC0gICAgaW5mbyA9IHhtYWxsb2NfYnl0ZXMoc2l6ZW9mKCppbmZv
KSArIGxlbik7Cj4gLSAgICBpZiAoIGluZm8gPT0gTlVMTCApCj4gLSAgICAgICAgcmV0dXJuIC1F
Tk9NRU07Cj4gLQo+IC0gICAgcmV0ID0gY29weV9mcm9tX2d1ZXN0KGluZm8tPmJ1ZmZlciwgYnVm
LCBsZW4pOwo+IC0gICAgaWYgKCByZXQgIT0gMCApCj4gKyAgICBidWZmZXIgPSB4bWFsbG9jX2J5
dGVzKGxlbik7Cj4gKyAgICBpZiAoICFidWZmZXIgKQo+ICAgICAgewo+IC0gICAgICAgIHhmcmVl
KGluZm8pOwo+IC0gICAgICAgIHJldHVybiByZXQ7Cj4gKyAgICAgICAgcmV0ID0gLUVOT01FTTsK
PiArICAgICAgICBnb3RvIGZyZWU7Cj4gICAgICB9Cj4gIAo+IC0gICAgaW5mby0+YnVmZmVyX3Np
emUgPSBsZW47Cj4gLSAgICBpbmZvLT5lcnJvciA9IDA7Cj4gLSAgICBpbmZvLT5jcHUgPSBjcHVt
YXNrX2ZpcnN0KCZjcHVfb25saW5lX21hcCk7Cj4gKyAgICBpZiAoIGNvcHlfZnJvbV9ndWVzdChi
dWZmZXIsIGJ1ZiwgbGVuKSApCj4gKyAgICB7Cj4gKyAgICAgICAgcmV0ID0gLUVGQVVMVDsKPiAr
ICAgICAgICBnb3RvIGZyZWU7Cj4gKyAgICB9Cj4gIAo+ICAgICAgaWYgKCBtaWNyb2NvZGVfb3Bz
LT5zdGFydF91cGRhdGUgKQo+ICAgICAgewo+ICAgICAgICAgIHJldCA9IG1pY3JvY29kZV9vcHMt
PnN0YXJ0X3VwZGF0ZSgpOwo+ICAgICAgICAgIGlmICggcmV0ICE9IDAgKQo+IC0gICAgICAgIHsK
PiAtICAgICAgICAgICAgeGZyZWUoaW5mbyk7Cj4gLSAgICAgICAgICAgIHJldHVybiByZXQ7Cj4g
LSAgICAgICAgfQo+ICsgICAgICAgICAgICBnb3RvIGZyZWU7Cj4gICAgICB9Cj4gIAo+IC0gICAg
cmV0dXJuIGNvbnRpbnVlX2h5cGVyY2FsbF9vbl9jcHUoaW5mby0+Y3B1LCBkb19taWNyb2NvZGVf
dXBkYXRlLCBpbmZvKTsKPiArICAgIHBhdGNoID0gbWljcm9jb2RlX3BhcnNlX2Jsb2IoYnVmZmVy
LCBsZW4pOwo+ICsgICAgaWYgKCBJU19FUlIocGF0Y2gpICkKPiArICAgIHsKPiArICAgICAgICBw
cmludGsoWEVOTE9HX0VSUiAiUGFyc2luZyBtaWNyb2NvZGUgYmxvYiBlcnJvciAlbGRcbiIsIFBU
Ul9FUlIocGF0Y2gpKTsKPiArICAgICAgICByZXQgPSBQVFJfRVJSKHBhdGNoKTsKClNvIEkgYXNz
dW1lIHdlIHdvdWxkIGdldCBoZXJlIHdoZW4gdGhlIHN5c3RlbSBhbHJlYWR5IGhhcyB0aGUKbmV3
ZXN0IChvciBldmVuIG5ld2VyKSB1Y29kZSBsb2FkZWQuIFRoYXQncyBub3QgYW4gZXJyb3IsIGFu
ZAppbW8gbm8gbG9nIG1lc3NhZ2Ugc3VnZ2VzdGluZyBzbyBzaG91bGQgYmUgaXNzdWVkLiBQZXJo
YXBzIHRoZQpwYXJzaW5nIGNvZGUgY291bGQgcmV0dXJuIE5VTEwgdG8gaW5kaWNhdGUgc28/IEFs
dGhvdWdoLCBqdWRnaW5nCmJ5IHRoZSBjb2RlIGZ1cnRoZXIgZG93biB5b3UgYWxyZWFkeSBleHBl
Y3QgTlVMTCBwb3RlbnRpYWxseQpjb21pbmcgYmFjaywgYnV0IEkgY2FuJ3Qgc2VlbSB0byBiZSBh
YmxlIHRvIGZpZ3VyZSB0aGUgY29uZGl0aW9uKHMpLgoKQWxzbyBwbGVhc2Ugc3dpdGNoIHRoZSB0
d28gbGluZXMgYXJvdW5kIGFuZCB1c2UgInJldCIgaW4gdGhlIHByaW50aygpCmludm9jYXRpb24u
Cgo+ICsgICAgICAgIGdvdG8gZnJlZTsKPiArICAgIH0KPiArCj4gKyAgICBpZiAoICFtaWNyb2Nv
ZGVfb3BzLT5tYXRjaF9jcHUocGF0Y2gpICkKPiArICAgIHsKPiArICAgICAgICBwcmludGsoWEVO
TE9HX0VSUiAiTm8gbWF0Y2hpbmcgb3IgbmV3ZXIgdWNvZGUgZm91bmQuIFVwZGF0ZSBhYm9ydGVk
IVxuIik7CgpJIGFzc3VtZSB0aGUgIm1hdGNoaW5nIiBoZXJlIGlzIG1lYW50IHRvIGNvdmVyIHRo
ZSBDUFUgc2lnbmF0dXJlPwpUaGUgd29yZGluZyBpcyBhbWJpZ3VvdXMgdGhpcyB3YXksIGJlY2F1
c2UgaXQgY291bGQgYWxzbyBtZWFuIHRoZXJlCndhcyBubyB1Y29kZSBmb3VuZCBtYXRjaGluZyB0
aGF0IHdoaWNoIGlzIGFscmVhZHkgbG9hZGVkICh3aGljaCwgYXMKcGVyIGFib3ZlLCBtYXkgZW5k
IHVwIGJlaW5nIHJlbGV2YW50KS4KCkZ1cnRoZXJtb3JlIC0gd2h5IHRoaXMgY2hlY2ssIHdoZW4g
bWljcm9jb2RlX3BhcnNlX2Jsb2IoKSBhbHJlYWR5Cmxvb2tzIGZvciBzb21ldGhpbmcgdGhhdCdz
IG5ld2VyIHRoYW4gd2hhdCBpcyBjdXJyZW50bHkgbG9hZGVkIChhbmQKbWF0Y2hlcyB0aGUgQ1BV
IHNpZ25hdHVyZSk/Cgo+IEBAIC0zNjIsMTMgKzM5Nyw0MSBAQCBpbnQgX19pbml0IGVhcmx5X21p
Y3JvY29kZV91cGRhdGVfY3B1KGJvb2wgc3RhcnRfdXBkYXRlKQo+ICAgICAgfQo+ICAgICAgaWYg
KCBkYXRhICkKPiAgICAgIHsKPiAtICAgICAgICBpZiAoIHN0YXJ0X3VwZGF0ZSAmJiBtaWNyb2Nv
ZGVfb3BzLT5zdGFydF91cGRhdGUgKQo+ICsgICAgICAgIHN0cnVjdCBtaWNyb2NvZGVfcGF0Y2gg
KnBhdGNoOwo+ICsKPiArICAgICAgICBpZiAoIG1pY3JvY29kZV9vcHMtPnN0YXJ0X3VwZGF0ZSAp
Cj4gICAgICAgICAgICAgIHJjID0gbWljcm9jb2RlX29wcy0+c3RhcnRfdXBkYXRlKCk7Cj4gIAo+
ICAgICAgICAgIGlmICggcmMgKQo+ICAgICAgICAgICAgICByZXR1cm4gcmM7Cj4gIAo+IC0gICAg
ICAgIHJldHVybiBtaWNyb2NvZGVfdXBkYXRlX2NwdShkYXRhLCBsZW4pOwo+ICsgICAgICAgIHBh
dGNoID0gbWljcm9jb2RlX3BhcnNlX2Jsb2IoZGF0YSwgbGVuKTsKPiArICAgICAgICBpZiAoIElT
X0VSUihwYXRjaCkgKQo+ICsgICAgICAgIHsKPiArICAgICAgICAgICAgcHJpbnRrKFhFTkxPR19F
UlIgIlBhcnNpbmcgbWljcm9jb2RlIGJsb2IgZXJyb3IgJWxkXG4iLAo+ICsgICAgICAgICAgICAg
ICAgICAgUFRSX0VSUihwYXRjaCkpOwo+ICsgICAgICAgICAgICByZXR1cm4gUFRSX0VSUihwYXRj
aCk7Cj4gKyAgICAgICAgfQo+ICsKPiArICAgICAgICBpZiAoICFtaWNyb2NvZGVfb3BzLT5tYXRj
aF9jcHUocGF0Y2gpICkKPiArICAgICAgICB7Cj4gKyAgICAgICAgICAgIHByaW50ayhYRU5MT0df
RVJSICJObyBtYXRjaGluZyBvciBuZXdlciB1Y29kZSBmb3VuZC4gVXBkYXRlIGFib3J0ZWQhXG4i
KTsKPiArICAgICAgICAgICAgaWYgKCBwYXRjaCApCj4gKyAgICAgICAgICAgICAgICBtaWNyb2Nv
ZGVfb3BzLT5mcmVlX3BhdGNoKHBhdGNoKTsKPiArICAgICAgICAgICAgcmV0dXJuIC1FSU5WQUw7
Cj4gKyAgICAgICAgfQoKU2FtZSByZW1hcmtzIGhlcmUgdGhlbi4KCj4gQEAgLTI5Miw2ICsyOTEs
MTAgQEAgc3RhdGljIGludCBhcHBseV9taWNyb2NvZGUodm9pZCkKPiAgCj4gICAgICBzaWctPnJl
diA9IHJldjsKPiAgCj4gKyNpZmRlZiBDT05GSUdfSFZNCj4gKyAgICBzdm1faG9zdF9vc3Z3X2lu
aXQoKTsKPiArI2VuZGlmCj4gKwo+ICAgICAgcmV0dXJuIDA7Cj4gIH0KCldoaWxlIHRoaXMgbm93
IHNpdHMgb24gdGhlIHN1Y2Nlc3MgcGF0aCBvbmx5LCAuLi4KCj4gQEAgLTU5MiwxNyArNTk2LDEw
IEBAIHN0YXRpYyBpbnQgY3B1X3JlcXVlc3RfbWljcm9jb2RlKGNvbnN0IHZvaWQgKmJ1Ziwgc2l6
ZV90IGJ1ZnNpemUpCj4gICAgICB9Cj4gIAo+ICAgIG91dDoKPiAtI2lmIENPTkZJR19IVk0KPiAt
ICAgIHN2bV9ob3N0X29zdndfaW5pdCgpOwo+IC0jZW5kaWYKPiArICAgIGlmICggZXJyb3IgJiYg
IXBhdGNoICkKPiArICAgICAgICBwYXRjaCA9IEVSUl9QVFIoZXJyb3IpOwo+ICAKPiAtICAgIC8q
Cj4gLSAgICAgKiBJbiBzb21lIGNhc2VzIHdlIG1heSByZXR1cm4gYW4gZXJyb3IgZXZlbiBpZiBw
cm9jZXNzb3IncyBtaWNyb2NvZGUgaGFzCj4gLSAgICAgKiBiZWVuIHVwZGF0ZWQuIEZvciBleGFt
cGxlLCB0aGUgZmlyc3QgcGF0Y2ggaW4gYSBjb250YWluZXIgZmlsZSBpcyBsb2FkZWQKPiAtICAg
ICAqIHN1Y2Nlc3NmdWxseSBidXQgc3Vic2VxdWVudCBjb250YWluZXIgZmlsZSBwcm9jZXNzaW5n
IGVuY291bnRlcnMgYQo+IC0gICAgICogZmFpbHVyZS4KPiAtICAgICAqLwo+IC0gICAgcmV0dXJu
IGVycm9yOwo+ICsgICAgcmV0dXJuIHBhdGNoOwo+ICB9CgouLi4gcHJldmlvdXNseSBpdCBoYXMg
YWxzbyBiZWVuIGludm9rZWQgaW4gdGhlIGVycm9yIGNhc2UuIFNlZSB0aGUKY29tbWVudCBpbiBz
dGFydF91cGRhdGUoKS4KCj4gLS0tIGEveGVuL2FyY2gveDg2L21pY3JvY29kZV9pbnRlbC5jCj4g
KysrIGIveGVuL2FyY2gveDg2L21pY3JvY29kZV9pbnRlbC5jCj4gQEAgLTI3Myw0NiArMjczLDI3
IEBAIHN0YXRpYyBlbnVtIG1pY3JvY29kZV9tYXRjaF9yZXN1bHQgY29tcGFyZV9wYXRjaCgKPiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZF9oZWFkZXItPnBmLCBvbGRfaGVh
ZGVyLT5yZXYpOwo+ICB9Cj4gIAo+IC0vKgo+IC0gKiByZXR1cm4gMCAtIG5vIHVwZGF0ZSBmb3Vu
ZAo+IC0gKiByZXR1cm4gMSAtIGZvdW5kIHVwZGF0ZQo+IC0gKiByZXR1cm4gPCAwIC0gZXJyb3IK
PiAtICovCj4gLXN0YXRpYyBpbnQgZ2V0X21hdGNoaW5nX21pY3JvY29kZShjb25zdCB2b2lkICpt
YykKPiArc3RhdGljIHN0cnVjdCBtaWNyb2NvZGVfcGF0Y2ggKmFsbG93X21pY3JvY29kZV9wYXRj
aCgKCkRpZCB5b3UgcGVyaGFwcyBtZWFuIHRoaXMgdG8gYmUgYWxsb2NfbWljcm9jb2RlX3BhdGNo
KCk/Cgo+IEBAIC0zODgsMjYgKzM2OCwzOSBAQCBzdGF0aWMgbG9uZyBnZXRfbmV4dF91Y29kZV9m
cm9tX2J1ZmZlcih2b2lkICoqbWMsIGNvbnN0IHU4ICpidWYsCj4gICAgICByZXR1cm4gb2Zmc2V0
ICsgdG90YWxfc2l6ZTsKPiAgfQo+ICAKPiAtc3RhdGljIGludCBjcHVfcmVxdWVzdF9taWNyb2Nv
ZGUoY29uc3Qgdm9pZCAqYnVmLCBzaXplX3Qgc2l6ZSkKPiArc3RhdGljIHN0cnVjdCBtaWNyb2Nv
ZGVfcGF0Y2ggKmNwdV9yZXF1ZXN0X21pY3JvY29kZShjb25zdCB2b2lkICpidWYsCj4gKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZV90IHNp
emUpCj4gIHsKPiAgICAgIGxvbmcgb2Zmc2V0ID0gMDsKPiAgICAgIGludCBlcnJvciA9IDA7Cj4g
ICAgICB2b2lkICptYzsKPiArICAgIHN0cnVjdCBtaWNyb2NvZGVfcGF0Y2ggKnBhdGNoID0gTlVM
TDsKPiAgCj4gICAgICB3aGlsZSAoIChvZmZzZXQgPSBnZXRfbmV4dF91Y29kZV9mcm9tX2J1ZmZl
cigmbWMsIGJ1Ziwgc2l6ZSwgb2Zmc2V0KSkgPiAwICkKPiAgICAgIHsKPiArICAgICAgICBzdHJ1
Y3QgbWljcm9jb2RlX3BhdGNoICpuZXdfcGF0Y2g7Cj4gKwo+ICAgICAgICAgIGVycm9yID0gbWlj
cm9jb2RlX3Nhbml0eV9jaGVjayhtYyk7Cj4gICAgICAgICAgaWYgKCBlcnJvciApCj4gICAgICAg
ICAgICAgIGJyZWFrOwo+IC0gICAgICAgIGVycm9yID0gZ2V0X21hdGNoaW5nX21pY3JvY29kZSht
Yyk7Cj4gLSAgICAgICAgaWYgKCBlcnJvciA8IDAgKQo+ICsKPiArICAgICAgICBuZXdfcGF0Y2gg
PSBhbGxvd19taWNyb2NvZGVfcGF0Y2gobWMpOwo+ICsgICAgICAgIGlmICggSVNfRVJSKG5ld19w
YXRjaCkgKQo+ICsgICAgICAgIHsKPiArICAgICAgICAgICAgZXJyb3IgPSBQVFJfRVJSKG5ld19w
YXRjaCk7Cj4gICAgICAgICAgICAgIGJyZWFrOwo+IC0gICAgICAgIC8qCj4gLSAgICAgICAgICog
SXQncyBwb3NzaWJsZSB0aGUgZGF0YSBmaWxlIGhhcyBtdWx0aXBsZSBtYXRjaGluZyB1Y29kZSwK
PiAtICAgICAgICAgKiBsZXRzIGtlZXAgc2VhcmNoaW5nIHRpbGwgdGhlIGxhdGVzdCB2ZXJzaW9u
Cj4gLSAgICAgICAgICovCj4gLSAgICAgICAgaWYgKCBlcnJvciA9PSAxICkKPiAtICAgICAgICAg
ICAgZXJyb3IgPSAwOwo+ICsgICAgICAgIH0KPiArCj4gKyAgICAgICAgLyogQ29tcGFyZSBwYXRj
aGVzIGFuZCBzdG9yZSB0aGUgb25lIHdpdGggaGlnaGVyIHJldmlzaW9uICovCj4gKyAgICAgICAg
aWYgKCAhcGF0Y2ggJiYgbWF0Y2hfY3B1KG5ld19wYXRjaCkgKQo+ICsgICAgICAgICAgICBwYXRj
aCA9IG5ld19wYXRjaDsKPiArICAgICAgICBlbHNlIGlmICggcGF0Y2ggJiYgKGNvbXBhcmVfcGF0
Y2gobmV3X3BhdGNoLCBwYXRjaCkgPT0gTkVXX1VDT0RFKSApCgpBdCBsZWFzdCB0aGUgYXBwZWFy
YW5jZSBvZiB0aGlzIGlzIG1pc2xlYWRpbmcsIGJ1dCB1bmxlc3MgSSdtIG1pc3NpbmcKc29tZXRo
aW5nIGl0J3MgYWN0dWFsbHkgd3Jvbmc6IFlvdSBzZWVtIHRvIGltcGx5IHRoYXQgZnJvbQptYXRj
aF9jcHUocGF0Y2gxKSByZXR1cm5pbmcgdHJ1ZSBhbmQgY29tcGFyZV9wYXRjaChwYXRjaDIsIHBh
dGNoMSkKcmV0dXJuaW5nIHRydWUgaXQgZm9sbG93cyB0aGF0IGFsc28gbWF0Y2hfY3B1KHBhdGNo
Mikgd291bGQgcmV0dXJuCnRydWUuIEJ1dCBJIGRvbid0IHRoaW5rIHRoYXQncyB0aGUgY2FzZSwg
YmVjYXVzZSBvZiBob3cgdGhlICJwZiIgZmllbGQKd29ya3MuCgpFdmVuIGluIGNhc2UgSSd2ZSBv
dmVybG9va2VkIGFuIGltcGxpY2l0IG1hdGNoX2NwdShuZXdfcGF0Y2gpIEknZApsaWtlIHRvIGFz
ayBmb3IgdGhpcyB0byBiZSBjbGFyaWZpZWQsIGVpdGhlciBieSBjaGFuZ2luZyB0aGUgY29kZQpz
dHJ1Y3R1cmUsIG9yIGJ5IGF0dGFjaGluZyBhIHN1aXRhYmxlIGNvbW1lbnQuCgo+IC0tLSBhL3hl
bi9hcmNoL3g4Ni9zbXBib290LmMKPiArKysgYi94ZW4vYXJjaC94ODYvc21wYm9vdC5jCj4gQEAg
LTM2MywxMCArMzYzLDcgQEAgdm9pZCBzdGFydF9zZWNvbmRhcnkodm9pZCAqdW51c2VkKQo+ICAK
PiAgICAgIGluaXRpYWxpemVfY3B1X2RhdGEoY3B1KTsKPiAgCj4gLSAgICBpZiAoIHN5c3RlbV9z
dGF0ZSA8PSBTWVNfU1RBVEVfc21wX2Jvb3QgKQo+IC0gICAgICAgIGVhcmx5X21pY3JvY29kZV91
cGRhdGVfY3B1KGZhbHNlKTsKPiAtICAgIGVsc2UKPiAtICAgICAgICBtaWNyb2NvZGVfcmVzdW1l
X2NwdSgpOwo+ICsgICAgZWFybHlfbWljcm9jb2RlX3VwZGF0ZV9jcHUoKTsKCkknbSBzdHJ1Z2ds
aW5nIHRvIHVuZGVyc3RhbmQgaG93IHlvdSBnZXQgYXdheSB3aXRob3V0IHRoZSAiZmFsc2UiCmFy
Z3VtZW50IHRoYXQgd2FzIHBhc3NlZCBoZXJlIGJlZm9yZS4gWW91IGxvb2sgdG8gbm93IGJlIGNh
bGxpbmcKLT5zdGFydF91cGRhdGUoKSB1bmNvbmRpdGlvbmFsbHkgKHNvIGxvbmcgYXMgdGhlIGhv
b2sgaXMgbm90IE5VTEwpLAp3aGljaCBJIGRvbid0IHRoaW5rIGlzIGNvcnJlY3QuIFRoaXMgc2hv
dWxkIGJlIGNhbGxlZCBvbmx5IG9uY2UgYnkKdGhlIENQVSBfbGVhZGluZ18gYW4gdXBkYXRlICh0
aGUgQlNQIGR1cmluZyBib290LCBhbmQgdGhlIENQVQp0aGUgaHlwZXJjYWxsIGdldHMgaW52b2tl
ZCBvbiAob3IgdGhlIGZpcnN0IENQVSBhbiB1cGRhdGUgZ2V0cwppc3N1ZWQgb25lKSBmb3IgYSBs
YXRlIHVwZGF0ZS4gQW0gSSBtaXNzaW5nIHNvbWV0aGluZz8KCkphbgoKCl9fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QK
WGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5v
cmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

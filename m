Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id F20B72FD95
	for <lists+xen-devel@lfdr.de>; Thu, 30 May 2019 16:21:45 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hWLt6-0003FG-8Y; Thu, 30 May 2019 14:18:36 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=Fq1a=T6=bitdefender.com=ppircalabu@srs-us1.protection.inumbo.net>)
 id 1hWLt4-0003CU-4X
 for xen-devel@lists.xenproject.org; Thu, 30 May 2019 14:18:34 +0000
X-Inumbo-ID: cb69e44c-82e5-11e9-8fc3-d7a4e6e4b3c5
Received: from mx01.bbu.dsd.mx.bitdefender.com (unknown [91.199.104.161])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id cb69e44c-82e5-11e9-8fc3-d7a4e6e4b3c5;
 Thu, 30 May 2019 14:18:29 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp02.buh.bitdefender.net [10.17.80.76])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 E54BD305FFAB; Thu, 30 May 2019 17:18:25 +0300 (EEST)
Received: from bitdefender.com (unknown [195.189.155.70])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id C20813051E7B;
 Thu, 30 May 2019 17:18:25 +0300 (EEST)
From: Petre Pircalabu <ppircalabu@bitdefender.com>
To: xen-devel@lists.xenproject.org
Date: Thu, 30 May 2019 17:18:23 +0300
Message-Id: <2da0f80cc9af391f623466f8152a1728274a967b.1559224640.git.ppircalabu@bitdefender.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <cover.1559224640.git.ppircalabu@bitdefender.com>
References: <cover.1559224640.git.ppircalabu@bitdefender.com>
In-Reply-To: <cover.1559224640.git.ppircalabu@bitdefender.com>
References: <cover.1559224640.git.ppircalabu@bitdefender.com>
Subject: [Xen-devel] [PATCH 9/9] xen-access: Add support for vm_event_ng
 interface
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Petre Pircalabu <ppircalabu@bitdefender.com>,
 Tamas K Lengyel <tamas@tklengyel.com>, Ian Jackson <ian.jackson@eu.citrix.com>,
 Wei Liu <wl@xen.org>, Razvan Cojocaru <rcojocaru@bitdefender.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

U3BsaXQgeGVuLWFjY2VzcyBpbiBvcmRlciB0byBhY2NvbW1vZGF0ZSBib3RoIHZtX2V2ZW50IGlu
dGVyZmFjZXMKKGxlZ2FjeSBhbmQgTkcpLiBCeSBkZWZhdWx0LCB0aGUgbGVnYWN5IHZtX2V2ZW50
IGlzIHNlbGVjdGVkIGJ1dAp0aGlzIGNhbiBiZSBjaGFuZ2VkIGJ5IGFkZGluZyB0aGUgJy1uJyBm
bGFnIGluIHRoZSBjb21tYW5kIGxpbmUuCgpTaWduZWQtb2ZmLWJ5OiBQZXRyZSBQaXJjYWxhYnUg
PHBwaXJjYWxhYnVAYml0ZGVmZW5kZXIuY29tPgotLS0KIHRvb2xzL3Rlc3RzL3hlbi1hY2Nlc3Mv
TWFrZWZpbGUgICAgICB8ICAgNyArLQogdG9vbHMvdGVzdHMveGVuLWFjY2Vzcy92bS1ldmVudC1u
Zy5jIHwgMjEwICsrKysrKysrKysrKysrKysrKwogdG9vbHMvdGVzdHMveGVuLWFjY2Vzcy92bS1l
dmVudC5jICAgIHwgMTkzICsrKysrKysrKysrKysrKysrCiB0b29scy90ZXN0cy94ZW4tYWNjZXNz
L3hlbi1hY2Nlc3MuYyAgfCA0MDggKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0K
IHRvb2xzL3Rlc3RzL3hlbi1hY2Nlc3MveGVuLWFjY2Vzcy5oICB8ICA5MSArKysrKysrKwogNSBm
aWxlcyBjaGFuZ2VkLCA2NDQgaW5zZXJ0aW9ucygrKSwgMjY1IGRlbGV0aW9ucygtKQogY3JlYXRl
IG1vZGUgMTAwNjQ0IHRvb2xzL3Rlc3RzL3hlbi1hY2Nlc3Mvdm0tZXZlbnQtbmcuYwogY3JlYXRl
IG1vZGUgMTAwNjQ0IHRvb2xzL3Rlc3RzL3hlbi1hY2Nlc3Mvdm0tZXZlbnQuYwogY3JlYXRlIG1v
ZGUgMTAwNjQ0IHRvb2xzL3Rlc3RzL3hlbi1hY2Nlc3MveGVuLWFjY2Vzcy5oCgpkaWZmIC0tZ2l0
IGEvdG9vbHMvdGVzdHMveGVuLWFjY2Vzcy9NYWtlZmlsZSBiL3Rvb2xzL3Rlc3RzL3hlbi1hY2Nl
c3MvTWFrZWZpbGUKaW5kZXggMTMxYzlmMy4uMTc3NjBkOCAxMDA2NDQKLS0tIGEvdG9vbHMvdGVz
dHMveGVuLWFjY2Vzcy9NYWtlZmlsZQorKysgYi90b29scy90ZXN0cy94ZW4tYWNjZXNzL01ha2Vm
aWxlCkBAIC03LDYgKzcsNyBAQCBDRkxBR1MgKz0gLURYQ19XQU5UX0NPTVBBVF9ERVZJQ0VNT0RF
TF9BUEkKIENGTEFHUyArPSAkKENGTEFHU19saWJ4ZW5jdHJsKQogQ0ZMQUdTICs9ICQoQ0ZMQUdT
X2xpYnhlbmd1ZXN0KQogQ0ZMQUdTICs9ICQoQ0ZMQUdTX2xpYnhlbmV2dGNobikKK0NGTEFHUyAr
PSAkKENGTEFHU19saWJ4ZW5mb3JlaWdubWVtb3J5KQogQ0ZMQUdTICs9ICQoQ0ZMQUdTX3hlbmlu
Y2x1ZGUpCiAKIFRBUkdFVFMteSA6PSB4ZW4tYWNjZXNzCkBAIC0yNSw4ICsyNiwxMCBAQCBjbGVh
bjoKIC5QSE9OWTogZGlzdGNsZWFuCiBkaXN0Y2xlYW46IGNsZWFuCiAKLXhlbi1hY2Nlc3M6IHhl
bi1hY2Nlc3MubyBNYWtlZmlsZQotCSQoQ0MpIC1vICRAICQ8ICQoTERGTEFHUykgJChMRExJQlNf
bGlieGVuY3RybCkgJChMRExJQlNfbGlieGVuZ3Vlc3QpICQoTERMSUJTX2xpYnhlbmV2dGNobikK
K09CSlMgPSB4ZW4tYWNjZXNzLm8gdm0tZXZlbnQubyB2bS1ldmVudC1uZy5vCisKK3hlbi1hY2Nl
c3M6ICQoT0JKUykgTWFrZWZpbGUKKwkkKENDKSAtbyAkQCAkKE9CSlMpICQoTERGTEFHUykgJChM
RExJQlNfbGlieGVuY3RybCkgJChMRExJQlNfbGlieGVuZ3Vlc3QpICQoTERMSUJTX2xpYnhlbmV2
dGNobikgJChMRExJQlNfbGlieGVuZm9yZWlnbm1lbW9yeSkKIAogaW5zdGFsbCB1bmluc3RhbGw6
CiAKZGlmZiAtLWdpdCBhL3Rvb2xzL3Rlc3RzL3hlbi1hY2Nlc3Mvdm0tZXZlbnQtbmcuYyBiL3Rv
b2xzL3Rlc3RzL3hlbi1hY2Nlc3Mvdm0tZXZlbnQtbmcuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NApp
bmRleCAwMDAwMDAwLi45MTc3Y2ZjCi0tLSAvZGV2L251bGwKKysrIGIvdG9vbHMvdGVzdHMveGVu
LWFjY2Vzcy92bS1ldmVudC1uZy5jCkBAIC0wLDAgKzEsMjEwIEBACisvKgorICogdm0tZXZlbnQt
bmcuYworICoKKyAqIENvcHlyaWdodCAoYykgMjAxOSBCaXRkZWZlbmRlciBTLlIuTC4KKyAqCisg
KiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBl
cnNvbiBvYnRhaW5pbmcgYSBjb3B5CisgKiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVk
IGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8KKyAqIGRlYWwgaW4gdGhl
IFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRp
b24gdGhlCisgKiByaWdodHMgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBk
aXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3IKKyAqIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0
d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCisgKiBm
dXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgor
ICoKKyAqIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90
aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluCisgKiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBv
cnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KKyAqCisgKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQg
IkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgorICogSU1Q
TElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJD
SEFOVEFCSUxJVFksCisgKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9O
SU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKKyAqIEFVVEhPUlMgT1IgQ09QWVJJ
R0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIKKyAq
IExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RI
RVJXSVNFLCBBUklTSU5HCisgKiBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRI
RSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSCisgKiBERUFMSU5HUyBJTiBUSEUgU09GVFdB
UkUuCisgKi8KKworI2luY2x1ZGUgPGVycm5vLmg+CisjaW5jbHVkZSA8aW50dHlwZXMuaD4KKyNp
bmNsdWRlIDxzdGRsaWIuaD4KKyNpbmNsdWRlIDxzdHJpbmcuaD4KKyNpbmNsdWRlIDxzeXMvbW1h
bi5oPgorI2luY2x1ZGUgPHhlbmZvcmVpZ25tZW1vcnkuaD4KKyNpbmNsdWRlICJ4ZW4tYWNjZXNz
LmgiCisKKyNpZm5kZWYgUEZOX1VQCisjZGVmaW5lIFBGTl9VUCh4KSAgICAgKCgoeCkgKyBYQ19Q
QUdFX1NJWkUtMSkgPj4gWENfUEFHRV9TSElGVCkKKyNlbmRpZiAvKiBQRk5fVVAgKi8KKwordHlw
ZWRlZiBzdHJ1Y3Qgdm1fZXZlbnRfY2hhbm5lbHMKK3sKKyAgICB2bV9ldmVudF90IHZtZTsKKyAg
ICBpbnQgbnVtX3ZjcHVzOworICAgIHhlbmZvcmVpZ25tZW1vcnlfaGFuZGxlICpmbWVtOworICAg
IHhlbmZvcmVpZ25tZW1vcnlfcmVzb3VyY2VfaGFuZGxlICpmcmVzOworICAgIHN0cnVjdCB2bV9l
dmVudF9zbG90ICpzbG90czsKKyAgICBpbnQgcG9ydHNbMF07Cit9IHZtX2V2ZW50X2NoYW5uZWxz
X3Q7CisKKyNkZWZpbmUgdG9fY2hhbm5lbHMoX3ZtZSkgY29udGFpbmVyX29mKChfdm1lKSwgdm1f
ZXZlbnRfY2hhbm5lbHNfdCwgdm1lKQorCitzdGF0aWMgaW50IHZtX2V2ZW50X2NoYW5uZWxzX2lu
aXQoeGNfaW50ZXJmYWNlICp4Y2gsIHhlbmV2dGNobl9oYW5kbGUgKnhjZSwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBkb21pZF90IGRvbWFpbl9pZCwgdm1fZXZlbnRfb3BzX3Qg
Km9wcywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bV9ldmVudF90ICoqdm1f
ZXZlbnQpCit7CisgICAgdm1fZXZlbnRfY2hhbm5lbHNfdCAqaW1wbCA9IE5VTEw7CisgICAgaW50
IHJjLCBpLCBudW1fdmNwdXM7CisgICAgeGNfZG9taW5mb190IGluZm87CisgICAgdW5zaWduZWQg
bG9uZyBucl9mcmFtZXM7CisKKyAgICAvKiBHZXQgdGhlIG51bWJlcnMgb2YgdmNwdXMgKi8KKyAg
ICByYyA9IHhjX2RvbWFpbl9nZXRpbmZvKHhjaCwgZG9tYWluX2lkLCAxLCAmaW5mbyk7CisgICAg
aWYgKCByYyAhPSAxICkKKyAgICB7CisgICAgICAgIEVSUk9SKCJ4Y19kb21haW5fZ2V0aW5mbyBm
YWlsZWQuIHJjID0gJWRcbiIsIHJjKTsKKyAgICAgICAgcmV0dXJuIHJjOworICAgIH0KKworICAg
IG51bV92Y3B1cyA9IGluZm8ubWF4X3ZjcHVfaWQgKyAxOworCisgICAgaW1wbCA9ICh2bV9ldmVu
dF9jaGFubmVsc190ICopY2FsbG9jKDEsIHNpemVvZih2bV9ldmVudF9jaGFubmVsc190KSArCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bV92Y3B1cyAqIHNp
emVvZihpbnQpKTsKKyAgICBpZiAoICFpbXBsICkKKyAgICAgICAgcmV0dXJuIC1FTk9NRU07CisK
KyAgICBpbXBsLT5udW1fdmNwdXMgPSBudW1fdmNwdXM7CisKKyAgICBpbXBsLT5mbWVtID0geGVu
Zm9yZWlnbm1lbW9yeV9vcGVuKDAsMCk7CisgICAgaWYgKCAhaW1wbC0+Zm1lbSApCisgICAgewor
ICAgICAgICByYyA9IC1lcnJubzsKKyAgICAgICAgZ290byBlcnI7CisgICAgfQorCisgICAgcmMg
PSB4Y19tb25pdG9yX25nX2NyZWF0ZSh4Y2gsIGRvbWFpbl9pZCk7CisgICAgaWYgKCByYyApCisg
ICAgeworICAgICAgICBFUlJPUigiRmFpbGVkIHRvIGVuYWJsZSBtb25pdG9yIik7CisgICAgICAg
IGdvdG8gZXJyOworICAgIH0KKworICAgIG5yX2ZyYW1lcyA9IFBGTl9VUChudW1fdmNwdXMgKiBz
aXplb2Yoc3RydWN0IHZtX2V2ZW50X3Nsb3QpKTsKKworICAgIGltcGwtPmZyZXMgPSB4ZW5mb3Jl
aWdubWVtb3J5X21hcF9yZXNvdXJjZShpbXBsLT5mbWVtLCBkb21haW5faWQsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFhFTk1FTV9yZXNvdXJjZV92bV9l
dmVudCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWEVO
X1ZNX0VWRU5UX1RZUEVfTU9OSVRPUiwgMCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgbnJfZnJhbWVzLCAodm9pZCopJmltcGwtPnNsb3RzLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQUk9UX1JFQUQgfCBQUk9U
X1dSSVRFLCAwKTsKKyAgICBpZiAoICFpbXBsLT5mcmVzICkKKyAgICB7CisgICAgICAgIEVSUk9S
KCJGYWlsZWQgdG8gbWFwIHZtX2V2ZW50IHJlc291cmNlIik7CisgICAgICAgIHJjID0gLWVycm5v
OworICAgICAgICBnb3RvIGVycjsKKyAgICB9CisKKyAgICBmb3IgKCBpID0gMDsgaSA8IGltcGwt
Pm51bV92Y3B1czsgaSsrKQorICAgIHsKKyAgICAgICAgcmMgPSB4ZW5ldnRjaG5fYmluZF9pbnRl
cmRvbWFpbih4Y2UsIGRvbWFpbl9pZCwgaW1wbC0+c2xvdHNbaV0ucG9ydCk7CisgICAgICAgIGlm
ICggIHJjIDwgMCApCisgICAgICAgIHsKKyAgICAgICAgICAgIEVSUk9SKCJGYWlsZWQgdG8gYmlu
ZCB2bV9ldmVudF9zbG90IHBvcnQgZm9yIHZjcHUgJWQiLCBpKTsKKyAgICAgICAgICAgIHJjID0g
LWVycm5vOworICAgICAgICAgICAgZ290byBlcnI7CisgICAgICAgIH0KKworICAgICAgICBpbXBs
LT5wb3J0c1tpXSA9IHJjOworICAgIH0KKworICAgIHJjID0geGNfbW9uaXRvcl9uZ19zZXRfc3Rh
dGUoeGNoLCBkb21haW5faWQsIHRydWUpOworICAgIGlmICggIHJjIDwgMCApCisgICAgeworICAg
ICAgICBFUlJPUigiRmFpbGVkIHRvIHN0YXJ0IG1vbml0b3IgcmMgPSAlZCIsIHJjKTsKKyAgICAg
ICAgZ290byBlcnI7CisgICAgfQorCisKKyAgICAqdm1fZXZlbnQgPSAodm1fZXZlbnRfdCopIGlt
cGw7CisgICAgcmV0dXJuIDA7CisKK2VycjoKKyAgICB4Y19tb25pdG9yX25nX2Rlc3Ryb3koeGNo
LCBkb21haW5faWQpOworICAgIHhlbmZvcmVpZ25tZW1vcnlfdW5tYXBfcmVzb3VyY2UoaW1wbC0+
Zm1lbSwgaW1wbC0+ZnJlcyk7CisgICAgeGVuZm9yZWlnbm1lbW9yeV9jbG9zZShpbXBsLT5mbWVt
KTsKKyAgICBmcmVlKGltcGwpOworICAgIHJldHVybiByYzsKK30KKworc3RhdGljIGludCB2Y3B1
X2lkX2J5X3BvcnQodm1fZXZlbnRfY2hhbm5lbHNfdCAqaW1wbCwgaW50IHBvcnQsIGludCAqdmNw
dV9pZCkKK3sKKyAgICBpbnQgaTsKKworICAgIGZvciAoIGkgPSAwOyBpIDwgaW1wbC0+bnVtX3Zj
cHVzOyBpKysgKQorICAgIHsKKyAgICAgICAgaWYgKCBwb3J0ID09IGltcGwtPnBvcnRzW2ldICkK
KyAgICAgICAgeworICAgICAgICAgICAgKnZjcHVfaWQgPSBpOworICAgICAgICAgICAgcmV0dXJu
IDA7CisgICAgICAgIH0KKyAgICB9CisKKyAgICByZXR1cm4gLUVJTlZBTDsKK30KKworc3RhdGlj
IGludCB2bV9ldmVudF9jaGFubmVsc190ZWFyZG93bih2bV9ldmVudF90ICp2bV9ldmVudCkKK3sK
KyAgICB2bV9ldmVudF9jaGFubmVsc190ICppbXBsID0gdG9fY2hhbm5lbHModm1fZXZlbnQpOwor
CisgICAgeGNfbW9uaXRvcl9uZ19kZXN0cm95KGltcGwtPnZtZS54Y2gsIGltcGwtPnZtZS5kb21h
aW5faWQpOworICAgIHhlbmZvcmVpZ25tZW1vcnlfdW5tYXBfcmVzb3VyY2UoaW1wbC0+Zm1lbSwg
aW1wbC0+ZnJlcyk7CisgICAgeGVuZm9yZWlnbm1lbW9yeV9jbG9zZShpbXBsLT5mbWVtKTsKKwor
ICAgIHJldHVybiAwOworfQorCitzdGF0aWMgYm9vbCB2bV9ldmVudF9jaGFubmVsc19nZXRfcmVx
dWVzdCh2bV9ldmVudF90ICp2bV9ldmVudCwgdm1fZXZlbnRfcmVxdWVzdF90ICpyZXEsIGludCAq
cG9ydCkKK3sKKyAgICBpbnQgdmNwdV9pZDsKKyAgICB2bV9ldmVudF9jaGFubmVsc190ICppbXBs
ID0gdG9fY2hhbm5lbHModm1fZXZlbnQpOworCisgICAgaWYgKCB2Y3B1X2lkX2J5X3BvcnQoaW1w
bCwgKnBvcnQsICZ2Y3B1X2lkKSAhPSAwICkKKyAgICAgICAgcmV0dXJuIGZhbHNlOworCisgICAg
aWYgKCBpbXBsLT5zbG90c1t2Y3B1X2lkXS5zdGF0ZSAhPSBTVEFURV9WTV9FVkVOVF9TTE9UX1NV
Qk1JVCApCisgICAgICAgIHJldHVybiBmYWxzZTsKKworICAgIG1lbWNweShyZXEsICZpbXBsLT5z
bG90c1t2Y3B1X2lkXS51LnJlcSwgc2l6ZW9mKCpyZXEpKTsKKworICAgIHJldHVybiB0cnVlOwor
fQorCitzdGF0aWMgdm9pZCB2bV9ldmVudF9jaGFubmVsc19wdXRfcmVzcG9uc2Uodm1fZXZlbnRf
dCAqdm1fZXZlbnQsIHZtX2V2ZW50X3Jlc3BvbnNlX3QgKnJzcCwgaW50IHBvcnQpCit7CisgICAg
aW50IHZjcHVfaWQ7CisgICAgdm1fZXZlbnRfY2hhbm5lbHNfdCAqaW1wbCA9IHRvX2NoYW5uZWxz
KHZtX2V2ZW50KTsKKworICAgIGlmICggdmNwdV9pZF9ieV9wb3J0KGltcGwsIHBvcnQsICZ2Y3B1
X2lkKSAhPSAwICkKKyAgICAgICAgcmV0dXJuOworCisgICAgbWVtY3B5KCZpbXBsLT5zbG90c1t2
Y3B1X2lkXS51LnJzcCwgcnNwLCBzaXplb2YoKnJzcCkpOworICAgIGltcGwtPnNsb3RzW3ZjcHVf
aWRdLnN0YXRlID0gU1RBVEVfVk1fRVZFTlRfU0xPVF9GSU5JU0g7Cit9CisKK3N0YXRpYyBpbnQg
dm1fZXZlbnRfY2hhbm5lbHNfbm90aWZ5X3BvcnQodm1fZXZlbnRfdCAqdm1fZXZlbnQsIGludCBw
b3J0KQoreworICAgIHJldHVybiB4ZW5ldnRjaG5fbm90aWZ5KHZtX2V2ZW50LT54Y2UsIHBvcnQp
OworfQorCit2bV9ldmVudF9vcHNfdCBjaGFubmVsX29wcyA9IHsKKyAgICAuZ2V0X3JlcXVlc3Qg
PSB2bV9ldmVudF9jaGFubmVsc19nZXRfcmVxdWVzdCwKKyAgICAucHV0X3Jlc3BvbnNlID0gdm1f
ZXZlbnRfY2hhbm5lbHNfcHV0X3Jlc3BvbnNlLAorICAgIC5ub3RpZnlfcG9ydCA9IHZtX2V2ZW50
X2NoYW5uZWxzX25vdGlmeV9wb3J0LAorICAgIC5pbml0ID0gdm1fZXZlbnRfY2hhbm5lbHNfaW5p
dCwKKyAgICAudGVhcmRvd24gPSB2bV9ldmVudF9jaGFubmVsc190ZWFyZG93bgorfTsKKworLyoK
KyAqIExvY2FsIHZhcmlhYmxlczoKKyAqIG1vZGU6IEMKKyAqIGMtZmlsZS1zdHlsZTogIkJTRCIK
KyAqIGMtYmFzaWMtb2Zmc2V0OiA0CisgKiBpbmRlbnQtdGFicy1tb2RlOiBuaWwKKyAqIEVuZDoK
Ky0gKi8KZGlmZiAtLWdpdCBhL3Rvb2xzL3Rlc3RzL3hlbi1hY2Nlc3Mvdm0tZXZlbnQuYyBiL3Rv
b2xzL3Rlc3RzL3hlbi1hY2Nlc3Mvdm0tZXZlbnQuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRl
eCAwMDAwMDAwLi5mZmQ1NDc2Ci0tLSAvZGV2L251bGwKKysrIGIvdG9vbHMvdGVzdHMveGVuLWFj
Y2Vzcy92bS1ldmVudC5jCkBAIC0wLDAgKzEsMTkzIEBACisvKgorICogdm0tZXZlbnQuYworICoK
KyAqIENvcHlyaWdodCAoYykgMjAxOSBCaXRkZWZlbmRlciBTLlIuTC4KKyAqCisgKiBQZXJtaXNz
aW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRh
aW5pbmcgYSBjb3B5CisgKiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50
YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8KKyAqIGRlYWwgaW4gdGhlIFNvZnR3YXJl
IHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlCisg
KiByaWdodHMgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRl
LCBzdWJsaWNlbnNlLCBhbmQvb3IKKyAqIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5k
IHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCisgKiBmdXJuaXNoZWQg
dG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgorICoKKyAqIFRo
ZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxs
IGJlIGluY2x1ZGVkIGluCisgKiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9m
IHRoZSBTb2Z0d2FyZS4KKyAqCisgKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwg
V0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgorICogSU1QTElFRCwgSU5D
TFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJ
VFksCisgKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VN
RU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKKyAqIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERF
UlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIKKyAqIExJQUJJTElU
WSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBB
UklTSU5HCisgKiBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FS
RSBPUiBUSEUgVVNFIE9SIE9USEVSCisgKiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuCisgKi8K
KworI2luY2x1ZGUgPGVycm5vLmg+CisjaW5jbHVkZSA8aW50dHlwZXMuaD4KKyNpbmNsdWRlIDxz
dGRsaWIuaD4KKyNpbmNsdWRlIDxzdHJpbmcuaD4KKyNpbmNsdWRlIDxzeXMvbW1hbi5oPgorI2lu
Y2x1ZGUgInhlbi1hY2Nlc3MuaCIKKwordHlwZWRlZiBzdHJ1Y3Qgdm1fZXZlbnRfcmluZyB7Cisg
ICAgdm1fZXZlbnRfdCB2bWU7CisgICAgaW50IHBvcnQ7CisgICAgdm1fZXZlbnRfYmFja19yaW5n
X3QgYmFja19yaW5nOworICAgIHVpbnQzMl90IGV2dGNobl9wb3J0OworICAgIHZvaWQgKnJpbmdf
cGFnZTsKK30gdm1fZXZlbnRfcmluZ190OworCisjZGVmaW5lIHRvX3JpbmcoX3ZtZSkgY29udGFp
bmVyX29mKChfdm1lKSwgdm1fZXZlbnRfcmluZ190LCB2bWUpCisKK3N0YXRpYyBpbnQgdm1fZXZl
bnRfcmluZ19pbml0KHhjX2ludGVyZmFjZSAqeGNoLCB4ZW5ldnRjaG5faGFuZGxlICp4Y2UsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb21pZF90IGRvbWFpbl9pZCwgdm1fZXZlbnRf
b3BzX3QgKm9wcywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtX2V2ZW50X3QgKip2
bV9ldmVudCkKK3sKKyAgICB2bV9ldmVudF9yaW5nX3QgKmltcGw7CisgICAgaW50IHJjOworCisg
ICAgaW1wbCA9ICh2bV9ldmVudF9yaW5nX3QqKSBjYWxsb2MgKDEsIHNpemVvZih2bV9ldmVudF9y
aW5nX3QpKTsKKyAgICBpZiAoICFpbXBsICkKKyAgICAgICAgcmV0dXJuIC1FTk9NRU07CisKKyAg
ICAvKiBFbmFibGUgbWVtX2FjY2VzcyAqLworICAgIGltcGwtPnJpbmdfcGFnZSA9IHhjX21vbml0
b3JfZW5hYmxlKHhjaCwgZG9tYWluX2lkLCAmaW1wbC0+ZXZ0Y2huX3BvcnQpOworICAgIGlmICgg
aW1wbC0+cmluZ19wYWdlID09IE5VTEwgKQorICAgIHsKKyAgICAgICAgc3dpdGNoICggZXJybm8g
KSB7CisgICAgICAgICAgICBjYXNlIEVCVVNZOgorICAgICAgICAgICAgICAgIEVSUk9SKCJ4ZW5h
Y2Nlc3MgaXMgKG9yIHdhcykgYWN0aXZlIG9uIHRoaXMgZG9tYWluIik7CisgICAgICAgICAgICAg
ICAgYnJlYWs7CisgICAgICAgICAgICBjYXNlIEVOT0RFVjoKKyAgICAgICAgICAgICAgICBFUlJP
UigiRVBUIG5vdCBzdXBwb3J0ZWQgZm9yIHRoaXMgZ3Vlc3QiKTsKKyAgICAgICAgICAgICAgICBi
cmVhazsKKyAgICAgICAgICAgIGRlZmF1bHQ6CisgICAgICAgICAgICAgICAgcGVycm9yKCJFcnJv
ciBlbmFibGluZyBtZW1fYWNjZXNzIik7CisgICAgICAgICAgICAgICAgYnJlYWs7CisgICAgICAg
IH0KKyAgICAgICAgcmMgPSAtZXJybm87CisgICAgICAgIGdvdG8gZXJyOworICAgIH0KKworICAg
IC8qIEJpbmQgZXZlbnQgbm90aWZpY2F0aW9uICovCisgICAgcmMgPSB4ZW5ldnRjaG5fYmluZF9p
bnRlcmRvbWFpbih4Y2UsIGRvbWFpbl9pZCwgaW1wbC0+ZXZ0Y2huX3BvcnQpOworICAgIGlmICgg
cmMgPCAwICkKKyAgICB7CisgICAgICAgIEVSUk9SKCJGYWlsZWQgdG8gYmluZCBldmVudCBjaGFu
bmVsIik7CisgICAgICAgIG11bm1hcChpbXBsLT5yaW5nX3BhZ2UsIFhDX1BBR0VfU0laRSk7Cisg
ICAgICAgIHhjX21vbml0b3JfZGlzYWJsZSh4Y2gsIGRvbWFpbl9pZCk7CisgICAgICAgIGdvdG8g
ZXJyOworICAgIH0KKworICAgIGltcGwtPnBvcnQgPSByYzsKKworICAgIC8qIEluaXRpYWxpc2Ug
cmluZyAqLworICAgIFNIQVJFRF9SSU5HX0lOSVQoKHZtX2V2ZW50X3NyaW5nX3QgKilpbXBsLT5y
aW5nX3BhZ2UpOworICAgIEJBQ0tfUklOR19JTklUKCZpbXBsLT5iYWNrX3JpbmcsICh2bV9ldmVu
dF9zcmluZ190ICopaW1wbC0+cmluZ19wYWdlLAorICAgICAgICAgICAgICAgICAgIFhDX1BBR0Vf
U0laRSk7CisKKyAgICAqdm1fZXZlbnQgPSAodm1fZXZlbnRfdCopIGltcGw7CisgICAgcmV0dXJu
IDA7CisKK2VycjoKKyAgICBmcmVlKGltcGwpOworICAgIHJldHVybiByYzsKK30KKworc3RhdGlj
IGludCB2bV9ldmVudF9yaW5nX3RlYXJkb3duKHZtX2V2ZW50X3QgKnZtX2V2ZW50KQoreworICAg
IHZtX2V2ZW50X3JpbmdfdCAqaW1wbCA9IHRvX3Jpbmcodm1fZXZlbnQpOworICAgIGludCByYzsK
KworICAgIGlmICggaW1wbC0+cmluZ19wYWdlICkKKyAgICAgICAgbXVubWFwKGltcGwtPnJpbmdf
cGFnZSwgWENfUEFHRV9TSVpFKTsKKworICAgIC8qIFRlYXIgZG93biBkb21haW4geGVuYWNjZXNz
IGluIFhlbiAqLworICAgIHJjID0geGNfbW9uaXRvcl9kaXNhYmxlKHZtX2V2ZW50LT54Y2gsIHZt
X2V2ZW50LT5kb21haW5faWQpOworICAgIGlmICggcmMgIT0gMCApCisgICAgeworICAgICAgICBF
UlJPUigiRXJyb3IgdGVhcmluZyBkb3duIGRvbWFpbiB4ZW5hY2Nlc3MgaW4geGVuIik7CisgICAg
ICAgIHJldHVybiByYzsKKyAgICB9CisKKyAgICAvKiBVbmJpbmQgVklSUSAqLworICAgIHJjID0g
eGVuZXZ0Y2huX3VuYmluZCh2bV9ldmVudC0+eGNlLCBpbXBsLT5wb3J0KTsKKyAgICBpZiAoIHJj
ICE9IDAgKQorICAgIHsKKyAgICAgICAgRVJST1IoIkVycm9yIHVuYmluZGluZyBldmVudCBwb3J0
Iik7CisgICAgICAgIHJldHVybiByYzsKKyAgICB9CisKKyAgICByZXR1cm4gMDsKK30KKworLyoK
KyAqIE5vdGUgdGhhdCB0aGlzIGZ1bmN0aW9uIGlzIG5vdCB0aHJlYWQgc2FmZS4KKyAqLworc3Rh
dGljIGJvb2wgdm1fZXZlbnRfcmluZ19nZXRfcmVxdWVzdCh2bV9ldmVudF90ICp2bV9ldmVudCwg
dm1fZXZlbnRfcmVxdWVzdF90ICpyZXEsIGludCAqcG9ydCkKK3sKKyAgICB2bV9ldmVudF9iYWNr
X3JpbmdfdCAqYmFja19yaW5nOworICAgIFJJTkdfSURYIHJlcV9jb25zOworICAgIHZtX2V2ZW50
X3JpbmdfdCAqaW1wbCA9IHRvX3Jpbmcodm1fZXZlbnQpOworCisgICAgaWYgKCAhUklOR19IQVNf
VU5DT05TVU1FRF9SRVFVRVNUUygmaW1wbC0+YmFja19yaW5nKSApCisgICAgICAgIHJldHVybiBm
YWxzZTsKKworICAgIGJhY2tfcmluZyA9ICZpbXBsLT5iYWNrX3Jpbmc7CisgICAgcmVxX2NvbnMg
PSBiYWNrX3JpbmctPnJlcV9jb25zOworCisgICAgLyogQ29weSByZXF1ZXN0ICovCisgICAgbWVt
Y3B5KHJlcSwgUklOR19HRVRfUkVRVUVTVChiYWNrX3JpbmcsIHJlcV9jb25zKSwgc2l6ZW9mKCpy
ZXEpKTsKKyAgICByZXFfY29ucysrOworCisgICAgLyogVXBkYXRlIHJpbmcgKi8KKyAgICBiYWNr
X3JpbmctPnJlcV9jb25zID0gcmVxX2NvbnM7CisgICAgYmFja19yaW5nLT5zcmluZy0+cmVxX2V2
ZW50ID0gcmVxX2NvbnMgKyAxOworCisgICAgKnBvcnQgPSBpbXBsLT5wb3J0OworCisgICAgcmV0
dXJuIHRydWU7Cit9CisKKy8qCisgKiBOb3RlIHRoYXQgdGhpcyBmdW5jdGlvbiBpcyBub3QgdGhy
ZWFkIHNhZmUuCisgKi8KK3N0YXRpYyB2b2lkIHZtX2V2ZW50X3JpbmdfcHV0X3Jlc3BvbnNlKHZt
X2V2ZW50X3QgKnZtX2V2ZW50LCB2bV9ldmVudF9yZXNwb25zZV90ICpyc3AsIGludCBwb3J0KQor
eworICAgIHZtX2V2ZW50X2JhY2tfcmluZ190ICpiYWNrX3Jpbmc7CisgICAgUklOR19JRFggcnNw
X3Byb2Q7CisgICAgdm1fZXZlbnRfcmluZ190ICppbXBsID0gdG9fcmluZyh2bV9ldmVudCk7CisK
KyAgICBiYWNrX3JpbmcgPSAmaW1wbC0+YmFja19yaW5nOworICAgIHJzcF9wcm9kID0gYmFja19y
aW5nLT5yc3BfcHJvZF9wdnQ7CisKKyAgICAvKiBDb3B5IHJlc3BvbnNlICovCisgICAgbWVtY3B5
KFJJTkdfR0VUX1JFU1BPTlNFKGJhY2tfcmluZywgcnNwX3Byb2QpLCByc3AsIHNpemVvZigqcnNw
KSk7CisgICAgcnNwX3Byb2QrKzsKKworICAgIC8qIFVwZGF0ZSByaW5nICovCisgICAgYmFja19y
aW5nLT5yc3BfcHJvZF9wdnQgPSByc3BfcHJvZDsKKyAgICBSSU5HX1BVU0hfUkVTUE9OU0VTKGJh
Y2tfcmluZyk7Cit9CisKK3N0YXRpYyBpbnQgdm1fZXZlbnRfcmluZ19ub3RpZnlfcG9ydCh2bV9l
dmVudF90ICp2bV9ldmVudCwgaW50IHBvcnQpCit7CisgICAgcmV0dXJuIHhlbmV2dGNobl9ub3Rp
Znkodm1fZXZlbnQtPnhjZSwgcG9ydCk7Cit9CisKK3ZtX2V2ZW50X29wc190IHJpbmdfb3BzID0g
eworICAgIC5nZXRfcmVxdWVzdCA9IHZtX2V2ZW50X3JpbmdfZ2V0X3JlcXVlc3QsCisgICAgLnB1
dF9yZXNwb25zZSA9IHZtX2V2ZW50X3JpbmdfcHV0X3Jlc3BvbnNlLAorICAgIC5ub3RpZnlfcG9y
dCA9IHZtX2V2ZW50X3Jpbmdfbm90aWZ5X3BvcnQsCisgICAgLmluaXQgPSB2bV9ldmVudF9yaW5n
X2luaXQsCisgICAgLnRlYXJkb3duID0gdm1fZXZlbnRfcmluZ190ZWFyZG93bgorfTsKKworLyoK
KyAqIExvY2FsIHZhcmlhYmxlczoKKyAqIG1vZGU6IEMKKyAqIGMtZmlsZS1zdHlsZTogIkJTRCIK
KyAqIGMtYmFzaWMtb2Zmc2V0OiA0CisgKiBpbmRlbnQtdGFicy1tb2RlOiBuaWwKKyAqIEVuZDoK
KyAqLwpkaWZmIC0tZ2l0IGEvdG9vbHMvdGVzdHMveGVuLWFjY2Vzcy94ZW4tYWNjZXNzLmMgYi90
b29scy90ZXN0cy94ZW4tYWNjZXNzL3hlbi1hY2Nlc3MuYwppbmRleCA2YWFlZTE2Li4yNjdkMTYz
IDEwMDY0NAotLS0gYS90b29scy90ZXN0cy94ZW4tYWNjZXNzL3hlbi1hY2Nlc3MuYworKysgYi90
b29scy90ZXN0cy94ZW4tYWNjZXNzL3hlbi1hY2Nlc3MuYwpAQCAtMzUsMTIgKzM1LDggQEAKICNp
bmNsdWRlIDx0aW1lLmg+CiAjaW5jbHVkZSA8c2lnbmFsLmg+CiAjaW5jbHVkZSA8dW5pc3RkLmg+
Ci0jaW5jbHVkZSA8c3lzL21tYW4uaD4KICNpbmNsdWRlIDxwb2xsLmg+Ci0KLSNpbmNsdWRlIDx4
ZW5jdHJsLmg+Ci0jaW5jbHVkZSA8eGVuZXZ0Y2huLmg+Ci0jaW5jbHVkZSA8eGVuL3ZtX2V2ZW50
Lmg+CisjaW5jbHVkZSA8Z2V0b3B0Lmg+CiAKICNpbmNsdWRlIDx4ZW4tdG9vbHMvbGlicy5oPgog
CkBAIC01MSw5ICs0Nyw3IEBACiAjZGVmaW5lIFNUQVJUX1BGTiAwVUxMCiAjZW5kaWYKIAotI2Rl
ZmluZSBEUFJJTlRGKGEsIGIuLi4pIGZwcmludGYoc3RkZXJyLCBhLCAjIyBiKQotI2RlZmluZSBF
UlJPUihhLCBiLi4uKSBmcHJpbnRmKHN0ZGVyciwgYSAiXG4iLCAjIyBiKQotI2RlZmluZSBQRVJS
T1IoYSwgYi4uLikgZnByaW50ZihzdGRlcnIsIGEgIjogJXNcbiIsICMjIGIsIHN0cmVycm9yKGVy
cm5vKSkKKyNpbmNsdWRlICJ4ZW4tYWNjZXNzLmgiCiAKIC8qIEZyb20geGVuL2luY2x1ZGUvYXNt
LXg4Ni9wcm9jZXNzb3IuaCAqLwogI2RlZmluZSBYODZfVFJBUF9ERUJVRyAgMQpAQCAtNjIsMzIg
KzU2LDE0IEBACiAvKiBGcm9tIHhlbi9pbmNsdWRlL2FzbS14ODYveDg2LWRlZm5zLmggKi8KICNk
ZWZpbmUgWDg2X0NSNF9QR0UgICAgICAgIDB4MDAwMDAwODAgLyogZW5hYmxlIGdsb2JhbCBwYWdl
cyAqLwogCi10eXBlZGVmIHN0cnVjdCB2bV9ldmVudCB7Ci0gICAgZG9taWRfdCBkb21haW5faWQ7
Ci0gICAgeGVuZXZ0Y2huX2hhbmRsZSAqeGNlX2hhbmRsZTsKLSAgICBpbnQgcG9ydDsKLSAgICB2
bV9ldmVudF9iYWNrX3JpbmdfdCBiYWNrX3Jpbmc7Ci0gICAgdWludDMyX3QgZXZ0Y2huX3BvcnQ7
Ci0gICAgdm9pZCAqcmluZ19wYWdlOwotfSB2bV9ldmVudF90OwotCi10eXBlZGVmIHN0cnVjdCB4
ZW5hY2Nlc3MgewotICAgIHhjX2ludGVyZmFjZSAqeGNfaGFuZGxlOwotCi0gICAgeGVuX3Bmbl90
IG1heF9ncGZuOwotCi0gICAgdm1fZXZlbnRfdCB2bV9ldmVudDsKLX0geGVuYWNjZXNzX3Q7Ci0K
IHN0YXRpYyBpbnQgaW50ZXJydXB0ZWQ7Ci1ib29sIGV2dGNobl9iaW5kID0gMCwgZXZ0Y2huX29w
ZW4gPSAwLCBtZW1fYWNjZXNzX2VuYWJsZSA9IDA7CiAKIHN0YXRpYyB2b2lkIGNsb3NlX2hhbmRs
ZXIoaW50IHNpZykKIHsKICAgICBpbnRlcnJ1cHRlZCA9IHNpZzsKIH0KIAotaW50IHhjX3dhaXRf
Zm9yX2V2ZW50X29yX3RpbWVvdXQoeGNfaW50ZXJmYWNlICp4Y2gsIHhlbmV2dGNobl9oYW5kbGUg
KnhjZSwgdW5zaWduZWQgbG9uZyBtcykKK3N0YXRpYyBpbnQgeGNfd2FpdF9mb3JfZXZlbnRfb3Jf
dGltZW91dCh4Y19pbnRlcmZhY2UgKnhjaCwgeGVuZXZ0Y2huX2hhbmRsZSAqeGNlLCB1bnNpZ25l
ZCBsb25nIG1zKQogewogICAgIHN0cnVjdCBwb2xsZmQgZmQgPSB7IC5mZCA9IHhlbmV2dGNobl9m
ZCh4Y2UpLCAuZXZlbnRzID0gUE9MTElOIHwgUE9MTEVSUiB9OwogICAgIGludCBwb3J0OwpAQCAt
MTI4LDE2MCArMTA0LDg2IEBAIGludCB4Y193YWl0X2Zvcl9ldmVudF9vcl90aW1lb3V0KHhjX2lu
dGVyZmFjZSAqeGNoLCB4ZW5ldnRjaG5faGFuZGxlICp4Y2UsIHVuc2lnCiAgICAgcmV0dXJuIC1l
cnJubzsKIH0KIAotaW50IHhlbmFjY2Vzc190ZWFyZG93bih4Y19pbnRlcmZhY2UgKnhjaCwgeGVu
YWNjZXNzX3QgKnhlbmFjY2VzcykKK3N0YXRpYyBpbnQgdm1fZXZlbnRfdGVhcmRvd24odm1fZXZl
bnRfdCAqdm1fZXZlbnQpCiB7CiAgICAgaW50IHJjOwogCi0gICAgaWYgKCB4ZW5hY2Nlc3MgPT0g
TlVMTCApCisgICAgaWYgKCB2bV9ldmVudCA9PSBOVUxMICkKICAgICAgICAgcmV0dXJuIDA7CiAK
LSAgICAvKiBUZWFyIGRvd24gZG9tYWluIHhlbmFjY2VzcyBpbiBYZW4gKi8KLSAgICBpZiAoIHhl
bmFjY2Vzcy0+dm1fZXZlbnQucmluZ19wYWdlICkKLSAgICAgICAgbXVubWFwKHhlbmFjY2Vzcy0+
dm1fZXZlbnQucmluZ19wYWdlLCBYQ19QQUdFX1NJWkUpOwotCi0gICAgaWYgKCBtZW1fYWNjZXNz
X2VuYWJsZSApCi0gICAgewotICAgICAgICByYyA9IHhjX21vbml0b3JfZGlzYWJsZSh4ZW5hY2Nl
c3MtPnhjX2hhbmRsZSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeGVuYWNjZXNz
LT52bV9ldmVudC5kb21haW5faWQpOwotICAgICAgICBpZiAoIHJjICE9IDAgKQotICAgICAgICB7
Ci0gICAgICAgICAgICBFUlJPUigiRXJyb3IgdGVhcmluZyBkb3duIGRvbWFpbiB4ZW5hY2Nlc3Mg
aW4geGVuIik7Ci0gICAgICAgICAgICByZXR1cm4gcmM7Ci0gICAgICAgIH0KLSAgICB9Ci0KLSAg
ICAvKiBVbmJpbmQgVklSUSAqLwotICAgIGlmICggZXZ0Y2huX2JpbmQgKQotICAgIHsKLSAgICAg
ICAgcmMgPSB4ZW5ldnRjaG5fdW5iaW5kKHhlbmFjY2Vzcy0+dm1fZXZlbnQueGNlX2hhbmRsZSwK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhlbmFjY2Vzcy0+dm1fZXZlbnQucG9ydCk7
Ci0gICAgICAgIGlmICggcmMgIT0gMCApCi0gICAgICAgIHsKLSAgICAgICAgICAgIEVSUk9SKCJF
cnJvciB1bmJpbmRpbmcgZXZlbnQgcG9ydCIpOwotICAgICAgICAgICAgcmV0dXJuIHJjOwotICAg
ICAgICB9Ci0gICAgfQorICAgIHJjID0gdm1fZXZlbnQtPm9wcy0+dGVhcmRvd24odm1fZXZlbnQp
OworICAgIGlmICggcmMgIT0gMCApCisgICAgICAgIHJldHVybiByYzsKIAogICAgIC8qIENsb3Nl
IGV2ZW50IGNoYW5uZWwgKi8KLSAgICBpZiAoIGV2dGNobl9vcGVuICkKKyAgICByYyA9IHhlbmV2
dGNobl9jbG9zZSh2bV9ldmVudC0+eGNlKTsKKyAgICBpZiAoIHJjICE9IDAgKQogICAgIHsKLSAg
ICAgICAgcmMgPSB4ZW5ldnRjaG5fY2xvc2UoeGVuYWNjZXNzLT52bV9ldmVudC54Y2VfaGFuZGxl
KTsKLSAgICAgICAgaWYgKCByYyAhPSAwICkKLSAgICAgICAgewotICAgICAgICAgICAgRVJST1Io
IkVycm9yIGNsb3NpbmcgZXZlbnQgY2hhbm5lbCIpOwotICAgICAgICAgICAgcmV0dXJuIHJjOwot
ICAgICAgICB9CisgICAgICAgIEVSUk9SKCJFcnJvciBjbG9zaW5nIGV2ZW50IGNoYW5uZWwiKTsK
KyAgICAgICAgcmV0dXJuIHJjOwogICAgIH0KIAogICAgIC8qIENsb3NlIGNvbm5lY3Rpb24gdG8g
WGVuICovCi0gICAgcmMgPSB4Y19pbnRlcmZhY2VfY2xvc2UoeGVuYWNjZXNzLT54Y19oYW5kbGUp
OworICAgIHJjID0geGNfaW50ZXJmYWNlX2Nsb3NlKHZtX2V2ZW50LT54Y2gpOwogICAgIGlmICgg
cmMgIT0gMCApCiAgICAgewogICAgICAgICBFUlJPUigiRXJyb3IgY2xvc2luZyBjb25uZWN0aW9u
IHRvIHhlbiIpOwogICAgICAgICByZXR1cm4gcmM7CiAgICAgfQotICAgIHhlbmFjY2Vzcy0+eGNf
aGFuZGxlID0gTlVMTDsKLQotICAgIGZyZWUoeGVuYWNjZXNzKTsKIAogICAgIHJldHVybiAwOwog
fQogCi14ZW5hY2Nlc3NfdCAqeGVuYWNjZXNzX2luaXQoeGNfaW50ZXJmYWNlICoqeGNoX3IsIGRv
bWlkX3QgZG9tYWluX2lkKQorc3RhdGljIHZtX2V2ZW50X3QgKnZtX2V2ZW50X2luaXQoZG9taWRf
dCBkb21haW5faWQsIHZtX2V2ZW50X29wc190ICpvcHMpCiB7Ci0gICAgeGVuYWNjZXNzX3QgKnhl
bmFjY2VzcyA9IDA7CisgICAgdm1fZXZlbnRfdCAqdm1fZXZlbnQ7CiAgICAgeGNfaW50ZXJmYWNl
ICp4Y2g7CisgICAgeGVuZXZ0Y2huX2hhbmRsZSAqeGNlOworICAgIHhlbl9wZm5fdCBtYXhfZ3Bm
bjsKICAgICBpbnQgcmM7CiAKKyAgICBpZiAoICFvcHMgKQorICAgICAgICByZXR1cm4gTlVMTDsK
KwogICAgIHhjaCA9IHhjX2ludGVyZmFjZV9vcGVuKE5VTEwsIE5VTEwsIDApOwogICAgIGlmICgg
IXhjaCApCi0gICAgICAgIGdvdG8gZXJyX2lmYWNlOworICAgICAgICBnb3RvIGVycjsKIAogICAg
IERQUklOVEYoInhlbmFjY2VzcyBpbml0XG4iKTsKLSAgICAqeGNoX3IgPSB4Y2g7Ci0KLSAgICAv
KiBBbGxvY2F0ZSBtZW1vcnkgKi8KLSAgICB4ZW5hY2Nlc3MgPSBtYWxsb2Moc2l6ZW9mKHhlbmFj
Y2Vzc190KSk7Ci0gICAgbWVtc2V0KHhlbmFjY2VzcywgMCwgc2l6ZW9mKHhlbmFjY2Vzc190KSk7
Ci0KLSAgICAvKiBPcGVuIGNvbm5lY3Rpb24gdG8geGVuICovCi0gICAgeGVuYWNjZXNzLT54Y19o
YW5kbGUgPSB4Y2g7Ci0KLSAgICAvKiBTZXQgZG9tYWluIGlkICovCi0gICAgeGVuYWNjZXNzLT52
bV9ldmVudC5kb21haW5faWQgPSBkb21haW5faWQ7Ci0KLSAgICAvKiBFbmFibGUgbWVtX2FjY2Vz
cyAqLwotICAgIHhlbmFjY2Vzcy0+dm1fZXZlbnQucmluZ19wYWdlID0KLSAgICAgICAgICAgIHhj
X21vbml0b3JfZW5hYmxlKHhlbmFjY2Vzcy0+eGNfaGFuZGxlLAotICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgeGVuYWNjZXNzLT52bV9ldmVudC5kb21haW5faWQsCi0gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAmeGVuYWNjZXNzLT52bV9ldmVudC5ldnRjaG5fcG9ydCk7Ci0gICAg
aWYgKCB4ZW5hY2Nlc3MtPnZtX2V2ZW50LnJpbmdfcGFnZSA9PSBOVUxMICkKLSAgICB7Ci0gICAg
ICAgIHN3aXRjaCAoIGVycm5vICkgewotICAgICAgICAgICAgY2FzZSBFQlVTWToKLSAgICAgICAg
ICAgICAgICBFUlJPUigieGVuYWNjZXNzIGlzIChvciB3YXMpIGFjdGl2ZSBvbiB0aGlzIGRvbWFp
biIpOwotICAgICAgICAgICAgICAgIGJyZWFrOwotICAgICAgICAgICAgY2FzZSBFTk9ERVY6Ci0g
ICAgICAgICAgICAgICAgRVJST1IoIkVQVCBub3Qgc3VwcG9ydGVkIGZvciB0aGlzIGd1ZXN0Iik7
Ci0gICAgICAgICAgICAgICAgYnJlYWs7Ci0gICAgICAgICAgICBkZWZhdWx0OgotICAgICAgICAg
ICAgICAgIHBlcnJvcigiRXJyb3IgZW5hYmxpbmcgbWVtX2FjY2VzcyIpOwotICAgICAgICAgICAg
ICAgIGJyZWFrOwotICAgICAgICB9Ci0gICAgICAgIGdvdG8gZXJyOwotICAgIH0KLSAgICBtZW1f
YWNjZXNzX2VuYWJsZSA9IDE7CiAKICAgICAvKiBPcGVuIGV2ZW50IGNoYW5uZWwgKi8KLSAgICB4
ZW5hY2Nlc3MtPnZtX2V2ZW50LnhjZV9oYW5kbGUgPSB4ZW5ldnRjaG5fb3BlbihOVUxMLCAwKTsK
LSAgICBpZiAoIHhlbmFjY2Vzcy0+dm1fZXZlbnQueGNlX2hhbmRsZSA9PSBOVUxMICkKKyAgICB4
Y2UgPSB4ZW5ldnRjaG5fb3BlbihOVUxMLCAwKTsKKyAgICBpZiAoICF4Y2UgKQogICAgIHsKICAg
ICAgICAgRVJST1IoIkZhaWxlZCB0byBvcGVuIGV2ZW50IGNoYW5uZWwiKTsKICAgICAgICAgZ290
byBlcnI7CiAgICAgfQotICAgIGV2dGNobl9vcGVuID0gMTsKLQotICAgIC8qIEJpbmQgZXZlbnQg
bm90aWZpY2F0aW9uICovCi0gICAgcmMgPSB4ZW5ldnRjaG5fYmluZF9pbnRlcmRvbWFpbih4ZW5h
Y2Nlc3MtPnZtX2V2ZW50LnhjZV9oYW5kbGUsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICB4ZW5hY2Nlc3MtPnZtX2V2ZW50LmRvbWFpbl9pZCwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHhlbmFjY2Vzcy0+dm1fZXZlbnQuZXZ0Y2huX3BvcnQpOwotICAg
IGlmICggcmMgPCAwICkKLSAgICB7Ci0gICAgICAgIEVSUk9SKCJGYWlsZWQgdG8gYmluZCBldmVu
dCBjaGFubmVsIik7Ci0gICAgICAgIGdvdG8gZXJyOwotICAgIH0KLSAgICBldnRjaG5fYmluZCA9
IDE7Ci0gICAgeGVuYWNjZXNzLT52bV9ldmVudC5wb3J0ID0gcmM7Ci0KLSAgICAvKiBJbml0aWFs
aXNlIHJpbmcgKi8KLSAgICBTSEFSRURfUklOR19JTklUKCh2bV9ldmVudF9zcmluZ190ICopeGVu
YWNjZXNzLT52bV9ldmVudC5yaW5nX3BhZ2UpOwotICAgIEJBQ0tfUklOR19JTklUKCZ4ZW5hY2Nl
c3MtPnZtX2V2ZW50LmJhY2tfcmluZywKLSAgICAgICAgICAgICAgICAgICAodm1fZXZlbnRfc3Jp
bmdfdCAqKXhlbmFjY2Vzcy0+dm1fZXZlbnQucmluZ19wYWdlLAotICAgICAgICAgICAgICAgICAg
IFhDX1BBR0VfU0laRSk7CiAKICAgICAvKiBHZXQgbWF4X2dwZm4gKi8KLSAgICByYyA9IHhjX2Rv
bWFpbl9tYXhpbXVtX2dwZm4oeGVuYWNjZXNzLT54Y19oYW5kbGUsCi0gICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHhlbmFjY2Vzcy0+dm1fZXZlbnQuZG9tYWluX2lkLAotICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAmeGVuYWNjZXNzLT5tYXhfZ3Bmbik7Ci0KKyAgICByYyA9
IHhjX2RvbWFpbl9tYXhpbXVtX2dwZm4oeGNoLCBkb21haW5faWQsICZtYXhfZ3Bmbik7CiAgICAg
aWYgKCByYyApCiAgICAgewogICAgICAgICBFUlJPUigiRmFpbGVkIHRvIGdldCBtYXggZ3BmbiIp
OwogICAgICAgICBnb3RvIGVycjsKICAgICB9CisgICAgRFBSSU5URigibWF4X2dwZm4gPSAlIlBS
SV94ZW5fcGZuIlxuIiwgbWF4X2dwZm4pOworCisgICAgcmMgPSBvcHMtPmluaXQoeGNoLCB4Y2Us
IGRvbWFpbl9pZCwgb3BzLCAmdm1fZXZlbnQpOworICAgIGlmICggcmMgPCAwICkKKyAgICAgICAg
Z290byBlcnI7CiAKLSAgICBEUFJJTlRGKCJtYXhfZ3BmbiA9ICUiUFJJX3hlbl9wZm4iXG4iLCB4
ZW5hY2Nlc3MtPm1heF9ncGZuKTsKKyAgICB2bV9ldmVudC0+eGNoID0geGNoOworICAgIHZtX2V2
ZW50LT54Y2UgPSB4Y2U7CisgICAgdm1fZXZlbnQtPmRvbWFpbl9pZCA9IGRvbWFpbl9pZDsKKyAg
ICB2bV9ldmVudC0+b3BzID0gb3BzOworICAgIHZtX2V2ZW50LT5tYXhfZ3BmbiA9IG1heF9ncGZu
OwogCi0gICAgcmV0dXJuIHhlbmFjY2VzczsKKyAgICByZXR1cm4gdm1fZXZlbnQ7CiAKICBlcnI6
Ci0gICAgcmMgPSB4ZW5hY2Nlc3NfdGVhcmRvd24oeGNoLCB4ZW5hY2Nlc3MpOwotICAgIGlmICgg
cmMgKQotICAgIHsKLSAgICAgICAgRVJST1IoIkZhaWxlZCB0byB0ZWFyZG93biB4ZW5hY2Nlc3Mg
c3RydWN0dXJlIVxuIik7Ci0gICAgfQorICAgIHhlbmV2dGNobl9jbG9zZSh4Y2UpOworICAgIHhj
X2ludGVyZmFjZV9jbG9zZSh4Y2gpOwogCi0gZXJyX2lmYWNlOgogICAgIHJldHVybiBOVUxMOwog
fQogCkBAIC0yOTksMjYgKzIwMSw2IEBAIGludCBjb250cm9sX3NpbmdsZXN0ZXAoCiB9CiAKIC8q
Ci0gKiBOb3RlIHRoYXQgdGhpcyBmdW5jdGlvbiBpcyBub3QgdGhyZWFkIHNhZmUuCi0gKi8KLXN0
YXRpYyB2b2lkIGdldF9yZXF1ZXN0KHZtX2V2ZW50X3QgKnZtX2V2ZW50LCB2bV9ldmVudF9yZXF1
ZXN0X3QgKnJlcSkKLXsKLSAgICB2bV9ldmVudF9iYWNrX3JpbmdfdCAqYmFja19yaW5nOwotICAg
IFJJTkdfSURYIHJlcV9jb25zOwotCi0gICAgYmFja19yaW5nID0gJnZtX2V2ZW50LT5iYWNrX3Jp
bmc7Ci0gICAgcmVxX2NvbnMgPSBiYWNrX3JpbmctPnJlcV9jb25zOwotCi0gICAgLyogQ29weSBy
ZXF1ZXN0ICovCi0gICAgbWVtY3B5KHJlcSwgUklOR19HRVRfUkVRVUVTVChiYWNrX3JpbmcsIHJl
cV9jb25zKSwgc2l6ZW9mKCpyZXEpKTsKLSAgICByZXFfY29ucysrOwotCi0gICAgLyogVXBkYXRl
IHJpbmcgKi8KLSAgICBiYWNrX3JpbmctPnJlcV9jb25zID0gcmVxX2NvbnM7Ci0gICAgYmFja19y
aW5nLT5zcmluZy0+cmVxX2V2ZW50ID0gcmVxX2NvbnMgKyAxOwotfQotCi0vKgogICogWDg2IGNv
bnRyb2wgcmVnaXN0ZXIgbmFtZXMKICAqLwogc3RhdGljIGNvbnN0IGNoYXIqIGdldF94ODZfY3Ry
bF9yZWdfbmFtZSh1aW50MzJfdCBpbmRleCkKQEAgLTMzNiwyOSArMjE4LDkgQEAgc3RhdGljIGNv
bnN0IGNoYXIqIGdldF94ODZfY3RybF9yZWdfbmFtZSh1aW50MzJfdCBpbmRleCkKICAgICByZXR1
cm4gbmFtZXNbaW5kZXhdOwogfQogCi0vKgotICogTm90ZSB0aGF0IHRoaXMgZnVuY3Rpb24gaXMg
bm90IHRocmVhZCBzYWZlLgotICovCi1zdGF0aWMgdm9pZCBwdXRfcmVzcG9uc2Uodm1fZXZlbnRf
dCAqdm1fZXZlbnQsIHZtX2V2ZW50X3Jlc3BvbnNlX3QgKnJzcCkKLXsKLSAgICB2bV9ldmVudF9i
YWNrX3JpbmdfdCAqYmFja19yaW5nOwotICAgIFJJTkdfSURYIHJzcF9wcm9kOwotCi0gICAgYmFj
a19yaW5nID0gJnZtX2V2ZW50LT5iYWNrX3Jpbmc7Ci0gICAgcnNwX3Byb2QgPSBiYWNrX3Jpbmct
PnJzcF9wcm9kX3B2dDsKLQotICAgIC8qIENvcHkgcmVzcG9uc2UgKi8KLSAgICBtZW1jcHkoUklO
R19HRVRfUkVTUE9OU0UoYmFja19yaW5nLCByc3BfcHJvZCksIHJzcCwgc2l6ZW9mKCpyc3ApKTsK
LSAgICByc3BfcHJvZCsrOwotCi0gICAgLyogVXBkYXRlIHJpbmcgKi8KLSAgICBiYWNrX3Jpbmct
PnJzcF9wcm9kX3B2dCA9IHJzcF9wcm9kOwotICAgIFJJTkdfUFVTSF9SRVNQT05TRVMoYmFja19y
aW5nKTsKLX0KLQogdm9pZCB1c2FnZShjaGFyKiBwcm9nbmFtZSkKIHsKLSAgICBmcHJpbnRmKHN0
ZGVyciwgIlVzYWdlOiAlcyBbLW1dIDxkb21haW5faWQ+IHdyaXRlfGV4ZWMiLCBwcm9nbmFtZSk7
CisgICAgZnByaW50ZihzdGRlcnIsICJVc2FnZTogJXMgWy1tXSBbLW5dIDxkb21haW5faWQ+IHdy
aXRlfGV4ZWMiLCBwcm9nbmFtZSk7CiAjaWYgZGVmaW5lZChfX2kzODZfXykgfHwgZGVmaW5lZChf
X3g4Nl82NF9fKQogICAgICAgICAgICAgZnByaW50ZihzdGRlcnIsICJ8YnJlYWtwb2ludHxhbHRw
Mm1fd3JpdGV8YWx0cDJtX2V4ZWN8ZGVidWd8Y3B1aWR8ZGVzY19hY2Nlc3N8d3JpdGVfY3RybHJl
Z19jcjR8YWx0cDJtX3dyaXRlX25vX2dwdCIpOwogI2VsaWYgZGVmaW5lZChfX2FybV9fKSB8fCBk
ZWZpbmVkKF9fYWFyY2g2NF9fKQpAQCAtMzY4LDE5ICsyMzAsMjIgQEAgdm9pZCB1c2FnZShjaGFy
KiBwcm9nbmFtZSkKICAgICAgICAgICAgICJcbiIKICAgICAgICAgICAgICJMb2dzIGZpcnN0IHBh
Z2Ugd3JpdGVzLCBleGVjcywgb3IgYnJlYWtwb2ludCB0cmFwcyB0aGF0IG9jY3VyIG9uIHRoZSBk
b21haW4uXG4iCiAgICAgICAgICAgICAiXG4iCi0gICAgICAgICAgICAiLW0gcmVxdWlyZXMgdGhp
cyBwcm9ncmFtIHRvIHJ1biwgb3IgZWxzZSB0aGUgZG9tYWluIG1heSBwYXVzZVxuIik7CisgICAg
ICAgICAgICAiLW0gcmVxdWlyZXMgdGhpcyBwcm9ncmFtIHRvIHJ1biwgb3IgZWxzZSB0aGUgZG9t
YWluIG1heSBwYXVzZVxuIgorCSAgICAiLW4gdXNlcyB0aGUgcGVyLXZjcHUgY2hhbm5lbHMgdm1f
ZXZlbnQgaW50ZXJmYWNlXG4iKTsKIH0KIAorZXh0ZXJuIHZtX2V2ZW50X29wc190IHJpbmdfb3Bz
OworZXh0ZXJuIHZtX2V2ZW50X29wc190IGNoYW5uZWxfb3BzOworCiBpbnQgbWFpbihpbnQgYXJn
YywgY2hhciAqYXJndltdKQogewogICAgIHN0cnVjdCBzaWdhY3Rpb24gYWN0OwogICAgIGRvbWlk
X3QgZG9tYWluX2lkOwotICAgIHhlbmFjY2Vzc190ICp4ZW5hY2Nlc3M7CisgICAgdm1fZXZlbnRf
dCAqdm1fZXZlbnQ7CiAgICAgdm1fZXZlbnRfcmVxdWVzdF90IHJlcTsKICAgICB2bV9ldmVudF9y
ZXNwb25zZV90IHJzcDsKICAgICBpbnQgcmMgPSAtMTsKICAgICBpbnQgcmMxOwotICAgIHhjX2lu
dGVyZmFjZSAqeGNoOwogICAgIHhlbm1lbV9hY2Nlc3NfdCBkZWZhdWx0X2FjY2VzcyA9IFhFTk1F
TV9hY2Nlc3Nfcnd4OwogICAgIHhlbm1lbV9hY2Nlc3NfdCBhZnRlcl9maXJzdF9hY2Nlc3MgPSBY
RU5NRU1fYWNjZXNzX3J3eDsKICAgICBpbnQgbWVtYWNjZXNzID0gMDsKQEAgLTM5NSwxMDYgKzI2
MCwxMjIgQEAgaW50IG1haW4oaW50IGFyZ2MsIGNoYXIgKmFyZ3ZbXSkKICAgICBpbnQgd3JpdGVf
Y3RybHJlZ19jcjQgPSAwOwogICAgIGludCBhbHRwMm1fd3JpdGVfbm9fZ3B0ID0gMDsKICAgICB1
aW50MTZfdCBhbHRwMm1fdmlld19pZCA9IDA7CisgICAgaW50IG5ld19pbnRlcmZhY2UgPSAwOwog
CiAgICAgY2hhciogcHJvZ25hbWUgPSBhcmd2WzBdOwotICAgIGFyZ3YrKzsKLSAgICBhcmdjLS07
CisgICAgY2hhciogY29tbWFuZDsKKyAgICBpbnQgYzsKKyAgICBpbnQgb3B0aW9uX2luZGV4Owor
ICAgIHN0cnVjdCBvcHRpb24gbG9uZ19vcHRpb25zW10gPQorICAgIHsKKyAgICAgICAgeyAibWVt
LWFjY2Vzcy1saXN0ZW5lciIsIG5vX2FyZ3VtZW50LCAwLCAnbScgfSwKKyAgICAgICAgeyAibmV3
LWludGVyZmFjZSIsIG5vX2FyZ3VtZW50LCAwLCAnbicgfQorICAgIH07CiAKLSAgICBpZiAoIGFy
Z2MgPT0gMyAmJiBhcmd2WzBdWzBdID09ICctJyApCisgICAgd2hpbGUoMSkKICAgICB7Ci0gICAg
ICAgIGlmICggIXN0cmNtcChhcmd2WzBdLCAiLW0iKSApCi0gICAgICAgICAgICByZXF1aXJlZCA9
IDE7Ci0gICAgICAgIGVsc2UKKyAgICAgICAgYyA9IGdldG9wdF9sb25nKGFyZ2MsIGFyZ3YsICJt
biIsIGxvbmdfb3B0aW9ucywgJm9wdGlvbl9pbmRleCk7CisgICAgICAgIGlmICggYyA9PSAtMSAp
CisgICAgICAgICAgICBicmVhazsKKworICAgICAgICBzd2l0Y2ggKGMpCiAgICAgICAgIHsKLSAg
ICAgICAgICAgIHVzYWdlKHByb2duYW1lKTsKLSAgICAgICAgICAgIHJldHVybiAtMTsKKyAgICAg
ICAgICAgIGNhc2UgJ20nOgorICAgICAgICAgICAgICAgIHJlcXVpcmVkID0gMTsKKyAgICAgICAg
ICAgICAgICBicmVhazsKKworICAgICAgICAgICAgY2FzZSAnbic6CisgICAgICAgICAgICAgICAg
bmV3X2ludGVyZmFjZSA9IDE7CisgICAgICAgICAgICAgICAgYnJlYWs7CisKKyAgICAgICAgICAg
IGRlZmF1bHQ6CisgICAgICAgICAgICAgICAgdXNhZ2UocHJvZ25hbWUpOworICAgICAgICAgICAg
ICAgIHJldHVybiAtMTsKICAgICAgICAgfQotICAgICAgICBhcmd2Kys7Ci0gICAgICAgIGFyZ2Mt
LTsKICAgICB9CiAKLSAgICBpZiAoIGFyZ2MgIT0gMiApCisgICAgaWYgKCBhcmdjIC0gb3B0aW5k
ICE9IDIgKQogICAgIHsKICAgICAgICAgdXNhZ2UocHJvZ25hbWUpOwogICAgICAgICByZXR1cm4g
LTE7CiAgICAgfQogCi0gICAgZG9tYWluX2lkID0gYXRvaShhcmd2WzBdKTsKLSAgICBhcmd2Kys7
Ci0gICAgYXJnYy0tOworICAgIGRvbWFpbl9pZCA9IGF0b2koYXJndltvcHRpbmQrK10pOworICAg
IGNvbW1hbmQgPSBhcmd2W29wdGluZF07CiAKLSAgICBpZiAoICFzdHJjbXAoYXJndlswXSwgIndy
aXRlIikgKQorICAgIGlmICggIXN0cmNtcChjb21tYW5kLCAid3JpdGUiKSApCiAgICAgewogICAg
ICAgICBkZWZhdWx0X2FjY2VzcyA9IFhFTk1FTV9hY2Nlc3Nfcng7CiAgICAgICAgIGFmdGVyX2Zp
cnN0X2FjY2VzcyA9IFhFTk1FTV9hY2Nlc3Nfcnd4OwogICAgICAgICBtZW1hY2Nlc3MgPSAxOwog
ICAgIH0KLSAgICBlbHNlIGlmICggIXN0cmNtcChhcmd2WzBdLCAiZXhlYyIpICkKKyAgICBlbHNl
IGlmICggIXN0cmNtcChjb21tYW5kLCAiZXhlYyIpICkKICAgICB7CiAgICAgICAgIGRlZmF1bHRf
YWNjZXNzID0gWEVOTUVNX2FjY2Vzc19ydzsKICAgICAgICAgYWZ0ZXJfZmlyc3RfYWNjZXNzID0g
WEVOTUVNX2FjY2Vzc19yd3g7CiAgICAgICAgIG1lbWFjY2VzcyA9IDE7CiAgICAgfQogI2lmIGRl
ZmluZWQoX19pMzg2X18pIHx8IGRlZmluZWQoX194ODZfNjRfXykKLSAgICBlbHNlIGlmICggIXN0
cmNtcChhcmd2WzBdLCAiYnJlYWtwb2ludCIpICkKKyAgICBlbHNlIGlmICggIXN0cmNtcChjb21t
YW5kLCAiYnJlYWtwb2ludCIpICkKICAgICB7CiAgICAgICAgIGJyZWFrcG9pbnQgPSAxOwogICAg
IH0KLSAgICBlbHNlIGlmICggIXN0cmNtcChhcmd2WzBdLCAiYWx0cDJtX3dyaXRlIikgKQorICAg
IGVsc2UgaWYgKCAhc3RyY21wKGNvbW1hbmQsICJhbHRwMm1fd3JpdGUiKSApCiAgICAgewogICAg
ICAgICBkZWZhdWx0X2FjY2VzcyA9IFhFTk1FTV9hY2Nlc3Nfcng7CiAgICAgICAgIGFsdHAybSA9
IDE7CiAgICAgICAgIG1lbWFjY2VzcyA9IDE7CiAgICAgfQotICAgIGVsc2UgaWYgKCAhc3RyY21w
KGFyZ3ZbMF0sICJhbHRwMm1fZXhlYyIpICkKKyAgICBlbHNlIGlmICggIXN0cmNtcChjb21tYW5k
LCAiYWx0cDJtX2V4ZWMiKSApCiAgICAgewogICAgICAgICBkZWZhdWx0X2FjY2VzcyA9IFhFTk1F
TV9hY2Nlc3Nfcnc7CiAgICAgICAgIGFsdHAybSA9IDE7CiAgICAgICAgIG1lbWFjY2VzcyA9IDE7
CiAgICAgfQotICAgIGVsc2UgaWYgKCAhc3RyY21wKGFyZ3ZbMF0sICJhbHRwMm1fd3JpdGVfbm9f
Z3B0IikgKQorICAgIGVsc2UgaWYgKCAhc3RyY21wKGNvbW1hbmQsICJhbHRwMm1fd3JpdGVfbm9f
Z3B0IikgKQogICAgIHsKICAgICAgICAgZGVmYXVsdF9hY2Nlc3MgPSBYRU5NRU1fYWNjZXNzX3J3
OwogICAgICAgICBhbHRwMm1fd3JpdGVfbm9fZ3B0ID0gMTsKICAgICAgICAgbWVtYWNjZXNzID0g
MTsKICAgICAgICAgYWx0cDJtID0gMTsKICAgICB9Ci0gICAgZWxzZSBpZiAoICFzdHJjbXAoYXJn
dlswXSwgImRlYnVnIikgKQorICAgIGVsc2UgaWYgKCAhc3RyY21wKGNvbW1hbmQsICJkZWJ1ZyIp
ICkKICAgICB7CiAgICAgICAgIGRlYnVnID0gMTsKICAgICB9Ci0gICAgZWxzZSBpZiAoICFzdHJj
bXAoYXJndlswXSwgImNwdWlkIikgKQorICAgIGVsc2UgaWYgKCAhc3RyY21wKGNvbW1hbmQsICJj
cHVpZCIpICkKICAgICB7CiAgICAgICAgIGNwdWlkID0gMTsKICAgICB9Ci0gICAgZWxzZSBpZiAo
ICFzdHJjbXAoYXJndlswXSwgImRlc2NfYWNjZXNzIikgKQorICAgIGVsc2UgaWYgKCAhc3RyY21w
KGNvbW1hbmQsICJkZXNjX2FjY2VzcyIpICkKICAgICB7CiAgICAgICAgIGRlc2NfYWNjZXNzID0g
MTsKICAgICB9Ci0gICAgZWxzZSBpZiAoICFzdHJjbXAoYXJndlswXSwgIndyaXRlX2N0cmxyZWdf
Y3I0IikgKQorICAgIGVsc2UgaWYgKCAhc3RyY21wKGNvbW1hbmQsICJ3cml0ZV9jdHJscmVnX2Ny
NCIpICkKICAgICB7CiAgICAgICAgIHdyaXRlX2N0cmxyZWdfY3I0ID0gMTsKICAgICB9CiAjZWxp
ZiBkZWZpbmVkKF9fYXJtX18pIHx8IGRlZmluZWQoX19hYXJjaDY0X18pCi0gICAgZWxzZSBpZiAo
ICFzdHJjbXAoYXJndlswXSwgInByaXZjYWxsIikgKQorICAgIGVsc2UgaWYgKCAhc3RyY21wKGNv
bW1hbmQsICJwcml2Y2FsbCIpICkKICAgICB7CiAgICAgICAgIHByaXZjYWxsID0gMTsKICAgICB9
CiAjZW5kaWYKICAgICBlbHNlCiAgICAgewotICAgICAgICB1c2FnZShhcmd2WzBdKTsKKyAgICAg
ICAgdXNhZ2UoY29tbWFuZCk7CiAgICAgICAgIHJldHVybiAtMTsKICAgICB9CiAKLSAgICB4ZW5h
Y2Nlc3MgPSB4ZW5hY2Nlc3NfaW5pdCgmeGNoLCBkb21haW5faWQpOwotICAgIGlmICggeGVuYWNj
ZXNzID09IE5VTEwgKQorICAgIHZtX2V2ZW50ID0gdm1fZXZlbnRfaW5pdChkb21haW5faWQsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIChuZXdfaW50ZXJmYWNlKSA/ICZjaGFubmVsX29w
cyA6ICZyaW5nX29wcyk7CisgICAgaWYgKCB2bV9ldmVudCA9PSBOVUxMICkKICAgICB7Ci0gICAg
ICAgIEVSUk9SKCJFcnJvciBpbml0aWFsaXNpbmcgeGVuYWNjZXNzIik7CisgICAgICAgIEVSUk9S
KCJFcnJvciBpbml0aWFsaXNpbmcgdm1fZXZlbnQiKTsKICAgICAgICAgcmV0dXJuIDE7CiAgICAg
fQogCi0gICAgRFBSSU5URigic3RhcnRpbmcgJXMgJXVcbiIsIGFyZ3ZbMF0sIGRvbWFpbl9pZCk7
CisgICAgRFBSSU5URigic3RhcnRpbmcgJXMgJXVcbiIsIGNvbW1hbmQsIGRvbWFpbl9pZCk7CiAK
ICAgICAvKiBlbnN1cmUgdGhhdCBpZiB3ZSBnZXQgYSBzaWduYWwsIHdlJ2xsIGRvIGNsZWFudXAs
IHRoZW4gZXhpdCAqLwogICAgIGFjdC5zYV9oYW5kbGVyID0gY2xvc2VfaGFuZGxlcjsKQEAgLTUw
Niw3ICszODcsNyBAQCBpbnQgbWFpbihpbnQgYXJnYywgY2hhciAqYXJndltdKQogICAgIHNpZ2Fj
dGlvbihTSUdBTFJNLCAmYWN0LCBOVUxMKTsKIAogICAgIC8qIFNldCB3aGV0aGVyIHRoZSBhY2Nl
c3MgbGlzdGVuZXIgaXMgcmVxdWlyZWQgKi8KLSAgICByYyA9IHhjX2RvbWFpbl9zZXRfYWNjZXNz
X3JlcXVpcmVkKHhjaCwgZG9tYWluX2lkLCByZXF1aXJlZCk7CisgICAgcmMgPSB4Y19kb21haW5f
c2V0X2FjY2Vzc19yZXF1aXJlZCh2bV9ldmVudC0+eGNoLCBkb21haW5faWQsIHJlcXVpcmVkKTsK
ICAgICBpZiAoIHJjIDwgMCApCiAgICAgewogICAgICAgICBFUlJPUigiRXJyb3IgJWQgc2V0dGlu
ZyBtZW1fYWNjZXNzIGxpc3RlbmVyIHJlcXVpcmVkXG4iLCByYyk7CkBAIC01MjEsMTMgKzQwMiwx
MyBAQCBpbnQgbWFpbihpbnQgYXJnYywgY2hhciAqYXJndltdKQogCiAgICAgICAgIGlmKCBhbHRw
Mm1fd3JpdGVfbm9fZ3B0ICkKICAgICAgICAgewotICAgICAgICAgICAgcmMgPSB4Y19tb25pdG9y
X2luZ3Vlc3RfcGFnZWZhdWx0KHhjaCwgZG9tYWluX2lkLCAxKTsKKyAgICAgICAgICAgIHJjID0g
eGNfbW9uaXRvcl9pbmd1ZXN0X3BhZ2VmYXVsdCh2bV9ldmVudC0+eGNoLCBkb21haW5faWQsIDEp
OwogICAgICAgICAgICAgaWYgKCByYyA8IDAgKQogICAgICAgICAgICAgewogICAgICAgICAgICAg
ICAgIEVSUk9SKCJFcnJvciAlZCBzZXR0aW5nIGluZ3Vlc3QgcGFnZWZhdWx0XG4iLCByYyk7CiAg
ICAgICAgICAgICAgICAgZ290byBleGl0OwogICAgICAgICAgICAgfQotICAgICAgICAgICAgcmMg
PSB4Y19tb25pdG9yX2VtdWxfdW5pbXBsZW1lbnRlZCh4Y2gsIGRvbWFpbl9pZCwgMSk7CisgICAg
ICAgICAgICByYyA9IHhjX21vbml0b3JfZW11bF91bmltcGxlbWVudGVkKHZtX2V2ZW50LT54Y2gs
IGRvbWFpbl9pZCwgMSk7CiAgICAgICAgICAgICBpZiAoIHJjIDwgMCApCiAgICAgICAgICAgICB7
CiAgICAgICAgICAgICAgICAgRVJST1IoIkVycm9yICVkIGZhaWxlZCB0byBlbmFibGUgZW11bCB1
bmltcGxlbWVudGVkXG4iLCByYyk7CkBAIC01MzUsMTQgKzQxNiwxNSBAQCBpbnQgbWFpbihpbnQg
YXJnYywgY2hhciAqYXJndltdKQogICAgICAgICAgICAgfQogICAgICAgICB9CiAKLSAgICAgICAg
cmMgPSB4Y19hbHRwMm1fc2V0X2RvbWFpbl9zdGF0ZSggeGNoLCBkb21haW5faWQsIDEgKTsKKyAg
ICAgICAgcmMgPSB4Y19hbHRwMm1fc2V0X2RvbWFpbl9zdGF0ZSggdm1fZXZlbnQtPnhjaCwgZG9t
YWluX2lkLCAxICk7CiAgICAgICAgIGlmICggcmMgPCAwICkKICAgICAgICAgewogICAgICAgICAg
ICAgRVJST1IoIkVycm9yICVkIGVuYWJsaW5nIGFsdHAybSBvbiBkb21haW4hXG4iLCByYyk7CiAg
ICAgICAgICAgICBnb3RvIGV4aXQ7CiAgICAgICAgIH0KIAotICAgICAgICByYyA9IHhjX2FsdHAy
bV9jcmVhdGVfdmlldyggeGNoLCBkb21haW5faWQsIGRlZmF1bHRfYWNjZXNzLCAmYWx0cDJtX3Zp
ZXdfaWQgKTsKKyAgICAgICAgcmMgPSB4Y19hbHRwMm1fY3JlYXRlX3ZpZXcoIHZtX2V2ZW50LT54
Y2gsIGRvbWFpbl9pZCwgZGVmYXVsdF9hY2Nlc3MsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAmYWx0cDJtX3ZpZXdfaWQgKTsKICAgICAgICAgaWYgKCByYyA8IDAgKQogICAg
ICAgICB7CiAgICAgICAgICAgICBFUlJPUigiRXJyb3IgJWQgY3JlYXRpbmcgYWx0cDJtIHZpZXch
XG4iLCByYyk7CkBAIC01NTIsMjQgKzQzNCwyNCBAQCBpbnQgbWFpbihpbnQgYXJnYywgY2hhciAq
YXJndltdKQogICAgICAgICBEUFJJTlRGKCJhbHRwMm0gdmlldyBjcmVhdGVkIHdpdGggaWQgJXVc
biIsIGFsdHAybV92aWV3X2lkKTsKICAgICAgICAgRFBSSU5URigiU2V0dGluZyBhbHRwMm0gbWVt
X2FjY2VzcyBwZXJtaXNzaW9ucy4uICIpOwogCi0gICAgICAgIGZvcig7IGdmbiA8IHhlbmFjY2Vz
cy0+bWF4X2dwZm47ICsrZ2ZuKQorICAgICAgICBmb3IoOyBnZm4gPCB2bV9ldmVudC0+bWF4X2dw
Zm47ICsrZ2ZuKQogICAgICAgICB7Ci0gICAgICAgICAgICByYyA9IHhjX2FsdHAybV9zZXRfbWVt
X2FjY2VzcyggeGNoLCBkb21haW5faWQsIGFsdHAybV92aWV3X2lkLCBnZm4sCi0gICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdF9hY2Nlc3MpOworICAgICAg
ICAgICAgcmMgPSB4Y19hbHRwMm1fc2V0X21lbV9hY2Nlc3MoIHZtX2V2ZW50LT54Y2gsIGRvbWFp
bl9pZCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbHRwMm1f
dmlld19pZCwgZ2ZuLCBkZWZhdWx0X2FjY2Vzcyk7CiAgICAgICAgICAgICBpZiAoICFyYyApCiAg
ICAgICAgICAgICAgICAgcGVybV9zZXQrKzsKICAgICAgICAgfQogCiAgICAgICAgIERQUklOVEYo
ImRvbmUhIFBlcm1pc3Npb25zIHNldCBvbiAlbHUgcGFnZXMuXG4iLCBwZXJtX3NldCk7CiAKLSAg
ICAgICAgcmMgPSB4Y19hbHRwMm1fc3dpdGNoX3RvX3ZpZXcoIHhjaCwgZG9tYWluX2lkLCBhbHRw
Mm1fdmlld19pZCApOworICAgICAgICByYyA9IHhjX2FsdHAybV9zd2l0Y2hfdG9fdmlldyggdm1f
ZXZlbnQtPnhjaCwgZG9tYWluX2lkLCBhbHRwMm1fdmlld19pZCApOwogICAgICAgICBpZiAoIHJj
IDwgMCApCiAgICAgICAgIHsKICAgICAgICAgICAgIEVSUk9SKCJFcnJvciAlZCBzd2l0Y2hpbmcg
dG8gYWx0cDJtIHZpZXchXG4iLCByYyk7CiAgICAgICAgICAgICBnb3RvIGV4aXQ7CiAgICAgICAg
IH0KIAotICAgICAgICByYyA9IHhjX21vbml0b3Jfc2luZ2xlc3RlcCggeGNoLCBkb21haW5faWQs
IDEgKTsKKyAgICAgICAgcmMgPSB4Y19tb25pdG9yX3NpbmdsZXN0ZXAoIHZtX2V2ZW50LT54Y2gs
IGRvbWFpbl9pZCwgMSApOwogICAgICAgICBpZiAoIHJjIDwgMCApCiAgICAgICAgIHsKICAgICAg
ICAgICAgIEVSUk9SKCJFcnJvciAlZCBmYWlsZWQgdG8gZW5hYmxlIHNpbmdsZXN0ZXAgbW9uaXRv
cmluZyFcbiIsIHJjKTsKQEAgLTU4MCwxNSArNDYyLDE1IEBAIGludCBtYWluKGludCBhcmdjLCBj
aGFyICphcmd2W10pCiAgICAgaWYgKCBtZW1hY2Nlc3MgJiYgIWFsdHAybSApCiAgICAgewogICAg
ICAgICAvKiBTZXQgdGhlIGRlZmF1bHQgYWNjZXNzIHR5cGUgYW5kIGNvbnZlcnQgYWxsIHBhZ2Vz
IHRvIGl0ICovCi0gICAgICAgIHJjID0geGNfc2V0X21lbV9hY2Nlc3MoeGNoLCBkb21haW5faWQs
IGRlZmF1bHRfYWNjZXNzLCB+MHVsbCwgMCk7CisgICAgICAgIHJjID0geGNfc2V0X21lbV9hY2Nl
c3Modm1fZXZlbnQtPnhjaCwgZG9tYWluX2lkLCBkZWZhdWx0X2FjY2VzcywgfjB1bGwsIDApOwog
ICAgICAgICBpZiAoIHJjIDwgMCApCiAgICAgICAgIHsKICAgICAgICAgICAgIEVSUk9SKCJFcnJv
ciAlZCBzZXR0aW5nIGRlZmF1bHQgbWVtIGFjY2VzcyB0eXBlXG4iLCByYyk7CiAgICAgICAgICAg
ICBnb3RvIGV4aXQ7CiAgICAgICAgIH0KIAotICAgICAgICByYyA9IHhjX3NldF9tZW1fYWNjZXNz
KHhjaCwgZG9tYWluX2lkLCBkZWZhdWx0X2FjY2VzcywgU1RBUlRfUEZOLAotICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICh4ZW5hY2Nlc3MtPm1heF9ncGZuIC0gU1RBUlRfUEZOKSApOwor
ICAgICAgICByYyA9IHhjX3NldF9tZW1fYWNjZXNzKHZtX2V2ZW50LT54Y2gsIGRvbWFpbl9pZCwg
ZGVmYXVsdF9hY2Nlc3MsIFNUQVJUX1BGTiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAodm1fZXZlbnQtPm1heF9ncGZuIC0gU1RBUlRfUEZOKSApOwogCiAgICAgICAgIGlmICggcmMg
PCAwICkKICAgICAgICAgewpAQCAtNjAwLDcgKzQ4Miw3IEBAIGludCBtYWluKGludCBhcmdjLCBj
aGFyICphcmd2W10pCiAKICAgICBpZiAoIGJyZWFrcG9pbnQgKQogICAgIHsKLSAgICAgICAgcmMg
PSB4Y19tb25pdG9yX3NvZnR3YXJlX2JyZWFrcG9pbnQoeGNoLCBkb21haW5faWQsIDEpOworICAg
ICAgICByYyA9IHhjX21vbml0b3Jfc29mdHdhcmVfYnJlYWtwb2ludCh2bV9ldmVudC0+eGNoLCBk
b21haW5faWQsIDEpOwogICAgICAgICBpZiAoIHJjIDwgMCApCiAgICAgICAgIHsKICAgICAgICAg
ICAgIEVSUk9SKCJFcnJvciAlZCBzZXR0aW5nIGJyZWFrcG9pbnQgdHJhcHBpbmcgd2l0aCB2bV9l
dmVudFxuIiwgcmMpOwpAQCAtNjEwLDcgKzQ5Miw3IEBAIGludCBtYWluKGludCBhcmdjLCBjaGFy
ICphcmd2W10pCiAKICAgICBpZiAoIGRlYnVnICkKICAgICB7Ci0gICAgICAgIHJjID0geGNfbW9u
aXRvcl9kZWJ1Z19leGNlcHRpb25zKHhjaCwgZG9tYWluX2lkLCAxLCAxKTsKKyAgICAgICAgcmMg
PSB4Y19tb25pdG9yX2RlYnVnX2V4Y2VwdGlvbnModm1fZXZlbnQtPnhjaCwgZG9tYWluX2lkLCAx
LCAxKTsKICAgICAgICAgaWYgKCByYyA8IDAgKQogICAgICAgICB7CiAgICAgICAgICAgICBFUlJP
UigiRXJyb3IgJWQgc2V0dGluZyBkZWJ1ZyBleGNlcHRpb24gbGlzdGVuZXIgd2l0aCB2bV9ldmVu
dFxuIiwgcmMpOwpAQCAtNjIwLDcgKzUwMiw3IEBAIGludCBtYWluKGludCBhcmdjLCBjaGFyICph
cmd2W10pCiAKICAgICBpZiAoIGNwdWlkICkKICAgICB7Ci0gICAgICAgIHJjID0geGNfbW9uaXRv
cl9jcHVpZCh4Y2gsIGRvbWFpbl9pZCwgMSk7CisgICAgICAgIHJjID0geGNfbW9uaXRvcl9jcHVp
ZCh2bV9ldmVudC0+eGNoLCBkb21haW5faWQsIDEpOwogICAgICAgICBpZiAoIHJjIDwgMCApCiAg
ICAgICAgIHsKICAgICAgICAgICAgIEVSUk9SKCJFcnJvciAlZCBzZXR0aW5nIGNwdWlkIGxpc3Rl
bmVyIHdpdGggdm1fZXZlbnRcbiIsIHJjKTsKQEAgLTYzMCw3ICs1MTIsNyBAQCBpbnQgbWFpbihp
bnQgYXJnYywgY2hhciAqYXJndltdKQogCiAgICAgaWYgKCBkZXNjX2FjY2VzcyApCiAgICAgewot
ICAgICAgICByYyA9IHhjX21vbml0b3JfZGVzY3JpcHRvcl9hY2Nlc3MoeGNoLCBkb21haW5faWQs
IDEpOworICAgICAgICByYyA9IHhjX21vbml0b3JfZGVzY3JpcHRvcl9hY2Nlc3Modm1fZXZlbnQt
PnhjaCwgZG9tYWluX2lkLCAxKTsKICAgICAgICAgaWYgKCByYyA8IDAgKQogICAgICAgICB7CiAg
ICAgICAgICAgICBFUlJPUigiRXJyb3IgJWQgc2V0dGluZyBkZXNjcmlwdG9yIGFjY2VzcyBsaXN0
ZW5lciB3aXRoIHZtX2V2ZW50XG4iLCByYyk7CkBAIC02NDAsNyArNTIyLDcgQEAgaW50IG1haW4o
aW50IGFyZ2MsIGNoYXIgKmFyZ3ZbXSkKIAogICAgIGlmICggcHJpdmNhbGwgKQogICAgIHsKLSAg
ICAgICAgcmMgPSB4Y19tb25pdG9yX3ByaXZpbGVnZWRfY2FsbCh4Y2gsIGRvbWFpbl9pZCwgMSk7
CisgICAgICAgIHJjID0geGNfbW9uaXRvcl9wcml2aWxlZ2VkX2NhbGwodm1fZXZlbnQtPnhjaCwg
ZG9tYWluX2lkLCAxKTsKICAgICAgICAgaWYgKCByYyA8IDAgKQogICAgICAgICB7CiAgICAgICAg
ICAgICBFUlJPUigiRXJyb3IgJWQgc2V0dGluZyBwcml2aWxlZ2VkIGNhbGwgdHJhcHBpbmcgd2l0
aCB2bV9ldmVudFxuIiwgcmMpOwpAQCAtNjUxLDcgKzUzMyw3IEBAIGludCBtYWluKGludCBhcmdj
LCBjaGFyICphcmd2W10pCiAgICAgaWYgKCB3cml0ZV9jdHJscmVnX2NyNCApCiAgICAgewogICAg
ICAgICAvKiBNYXNrIHRoZSBDUjQuUEdFIGJpdCBzbyBubyBldmVudHMgd2lsbCBiZSBnZW5lcmF0
ZWQgZm9yIGdsb2JhbCBUTEIgZmx1c2hlcy4gKi8KLSAgICAgICAgcmMgPSB4Y19tb25pdG9yX3dy
aXRlX2N0cmxyZWcoeGNoLCBkb21haW5faWQsIFZNX0VWRU5UX1g4Nl9DUjQsIDEsIDEsCisgICAg
ICAgIHJjID0geGNfbW9uaXRvcl93cml0ZV9jdHJscmVnKHZtX2V2ZW50LT54Y2gsIGRvbWFpbl9p
ZCwgVk1fRVZFTlRfWDg2X0NSNCwgMSwgMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgWDg2X0NSNF9QR0UsIDEpOwogICAgICAgICBpZiAoIHJjIDwgMCApCiAgICAgICAg
IHsKQEAgLTY2Myw0MSArNTQ1LDQzIEBAIGludCBtYWluKGludCBhcmdjLCBjaGFyICphcmd2W10p
CiAgICAgLyogV2FpdCBmb3IgYWNjZXNzICovCiAgICAgZm9yICg7OykKICAgICB7CisgICAgICAg
IGludCBwb3J0ID0gMDsKKwogICAgICAgICBpZiAoIGludGVycnVwdGVkICkKICAgICAgICAgewog
ICAgICAgICAgICAgLyogVW5yZWdpc3RlciBmb3IgZXZlcnkgZXZlbnQgKi8KICAgICAgICAgICAg
IERQUklOVEYoInhlbmFjY2VzcyBzaHV0dGluZyBkb3duIG9uIHNpZ25hbCAlZFxuIiwgaW50ZXJy
dXB0ZWQpOwogCiAgICAgICAgICAgICBpZiAoIGJyZWFrcG9pbnQgKQotICAgICAgICAgICAgICAg
IHJjID0geGNfbW9uaXRvcl9zb2Z0d2FyZV9icmVha3BvaW50KHhjaCwgZG9tYWluX2lkLCAwKTsK
KyAgICAgICAgICAgICAgICByYyA9IHhjX21vbml0b3Jfc29mdHdhcmVfYnJlYWtwb2ludCh2bV9l
dmVudC0+eGNoLCBkb21haW5faWQsIDApOwogICAgICAgICAgICAgaWYgKCBkZWJ1ZyApCi0gICAg
ICAgICAgICAgICAgcmMgPSB4Y19tb25pdG9yX2RlYnVnX2V4Y2VwdGlvbnMoeGNoLCBkb21haW5f
aWQsIDAsIDApOworICAgICAgICAgICAgICAgIHJjID0geGNfbW9uaXRvcl9kZWJ1Z19leGNlcHRp
b25zKHZtX2V2ZW50LT54Y2gsIGRvbWFpbl9pZCwgMCwgMCk7CiAgICAgICAgICAgICBpZiAoIGNw
dWlkICkKLSAgICAgICAgICAgICAgICByYyA9IHhjX21vbml0b3JfY3B1aWQoeGNoLCBkb21haW5f
aWQsIDApOworICAgICAgICAgICAgICAgIHJjID0geGNfbW9uaXRvcl9jcHVpZCh2bV9ldmVudC0+
eGNoLCBkb21haW5faWQsIDApOwogICAgICAgICAgICAgaWYgKCBkZXNjX2FjY2VzcyApCi0gICAg
ICAgICAgICAgICAgcmMgPSB4Y19tb25pdG9yX2Rlc2NyaXB0b3JfYWNjZXNzKHhjaCwgZG9tYWlu
X2lkLCAwKTsKKyAgICAgICAgICAgICAgICByYyA9IHhjX21vbml0b3JfZGVzY3JpcHRvcl9hY2Nl
c3Modm1fZXZlbnQtPnhjaCwgZG9tYWluX2lkLCAwKTsKICAgICAgICAgICAgIGlmICggd3JpdGVf
Y3RybHJlZ19jcjQgKQotICAgICAgICAgICAgICAgIHJjID0geGNfbW9uaXRvcl93cml0ZV9jdHJs
cmVnKHhjaCwgZG9tYWluX2lkLCBWTV9FVkVOVF9YODZfQ1I0LCAwLCAwLCAwLCAwKTsKKyAgICAg
ICAgICAgICAgICByYyA9IHhjX21vbml0b3Jfd3JpdGVfY3RybHJlZyh2bV9ldmVudC0+eGNoLCBk
b21haW5faWQsIFZNX0VWRU5UX1g4Nl9DUjQsIDAsIDAsIDAsIDApOwogCiAgICAgICAgICAgICBp
ZiAoIHByaXZjYWxsICkKLSAgICAgICAgICAgICAgICByYyA9IHhjX21vbml0b3JfcHJpdmlsZWdl
ZF9jYWxsKHhjaCwgZG9tYWluX2lkLCAwKTsKKyAgICAgICAgICAgICAgICByYyA9IHhjX21vbml0
b3JfcHJpdmlsZWdlZF9jYWxsKHZtX2V2ZW50LT54Y2gsIGRvbWFpbl9pZCwgMCk7CiAKICAgICAg
ICAgICAgIGlmICggYWx0cDJtICkKICAgICAgICAgICAgIHsKLSAgICAgICAgICAgICAgICByYyA9
IHhjX2FsdHAybV9zd2l0Y2hfdG9fdmlldyggeGNoLCBkb21haW5faWQsIDAgKTsKLSAgICAgICAg
ICAgICAgICByYyA9IHhjX2FsdHAybV9kZXN0cm95X3ZpZXcoeGNoLCBkb21haW5faWQsIGFsdHAy
bV92aWV3X2lkKTsKLSAgICAgICAgICAgICAgICByYyA9IHhjX2FsdHAybV9zZXRfZG9tYWluX3N0
YXRlKHhjaCwgZG9tYWluX2lkLCAwKTsKLSAgICAgICAgICAgICAgICByYyA9IHhjX21vbml0b3Jf
c2luZ2xlc3RlcCh4Y2gsIGRvbWFpbl9pZCwgMCk7CisgICAgICAgICAgICAgICAgcmMgPSB4Y19h
bHRwMm1fc3dpdGNoX3RvX3ZpZXcoIHZtX2V2ZW50LT54Y2gsIGRvbWFpbl9pZCwgMCApOworICAg
ICAgICAgICAgICAgIHJjID0geGNfYWx0cDJtX2Rlc3Ryb3lfdmlldyh2bV9ldmVudC0+eGNoLCBk
b21haW5faWQsIGFsdHAybV92aWV3X2lkKTsKKyAgICAgICAgICAgICAgICByYyA9IHhjX2FsdHAy
bV9zZXRfZG9tYWluX3N0YXRlKHZtX2V2ZW50LT54Y2gsIGRvbWFpbl9pZCwgMCk7CisgICAgICAg
ICAgICAgICAgcmMgPSB4Y19tb25pdG9yX3NpbmdsZXN0ZXAodm1fZXZlbnQtPnhjaCwgZG9tYWlu
X2lkLCAwKTsKICAgICAgICAgICAgIH0gZWxzZSB7Ci0gICAgICAgICAgICAgICAgcmMgPSB4Y19z
ZXRfbWVtX2FjY2Vzcyh4Y2gsIGRvbWFpbl9pZCwgWEVOTUVNX2FjY2Vzc19yd3gsIH4wdWxsLCAw
KTsKLSAgICAgICAgICAgICAgICByYyA9IHhjX3NldF9tZW1fYWNjZXNzKHhjaCwgZG9tYWluX2lk
LCBYRU5NRU1fYWNjZXNzX3J3eCwgU1RBUlRfUEZOLAotICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgKHhlbmFjY2Vzcy0+bWF4X2dwZm4gLSBTVEFSVF9QRk4pICk7CisgICAg
ICAgICAgICAgICAgcmMgPSB4Y19zZXRfbWVtX2FjY2Vzcyh2bV9ldmVudC0+eGNoLCBkb21haW5f
aWQsIFhFTk1FTV9hY2Nlc3Nfcnd4LCB+MHVsbCwgMCk7CisgICAgICAgICAgICAgICAgcmMgPSB4
Y19zZXRfbWVtX2FjY2Vzcyh2bV9ldmVudC0+eGNoLCBkb21haW5faWQsIFhFTk1FTV9hY2Nlc3Nf
cnd4LCBTVEFSVF9QRk4sCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAo
dm1fZXZlbnQtPm1heF9ncGZuIC0gU1RBUlRfUEZOKSApOwogICAgICAgICAgICAgfQogCiAgICAg
ICAgICAgICBzaHV0dGluZ19kb3duID0gMTsKICAgICAgICAgfQogCi0gICAgICAgIHJjID0geGNf
d2FpdF9mb3JfZXZlbnRfb3JfdGltZW91dCh4Y2gsIHhlbmFjY2Vzcy0+dm1fZXZlbnQueGNlX2hh
bmRsZSwgMTAwKTsKKyAgICAgICAgcmMgPSB4Y193YWl0X2Zvcl9ldmVudF9vcl90aW1lb3V0KHZt
X2V2ZW50LT54Y2gsIHZtX2V2ZW50LT54Y2UsIDEwMCk7CiAgICAgICAgIGlmICggcmMgPCAtMSAp
CiAgICAgICAgIHsKICAgICAgICAgICAgIEVSUk9SKCJFcnJvciBnZXR0aW5nIGV2ZW50Iik7CkBA
IC03MDksMTAgKzU5MywxMCBAQCBpbnQgbWFpbihpbnQgYXJnYywgY2hhciAqYXJndltdKQogICAg
ICAgICAgICAgRFBSSU5URigiR290IGV2ZW50IGZyb20gWGVuXG4iKTsKICAgICAgICAgfQogCi0g
ICAgICAgIHdoaWxlICggUklOR19IQVNfVU5DT05TVU1FRF9SRVFVRVNUUygmeGVuYWNjZXNzLT52
bV9ldmVudC5iYWNrX3JpbmcpICkKLSAgICAgICAgewotICAgICAgICAgICAgZ2V0X3JlcXVlc3Qo
JnhlbmFjY2Vzcy0+dm1fZXZlbnQsICZyZXEpOworICAgICAgICBwb3J0ID0gcmM7CiAKKyAgICAg
ICAgd2hpbGUgKCB2bV9ldmVudC0+b3BzLT5nZXRfcmVxdWVzdCh2bV9ldmVudCwgJnJlcSwgJnBv
cnQpICkKKyAgICAgICAgewogICAgICAgICAgICAgaWYgKCByZXEudmVyc2lvbiAhPSBWTV9FVkVO
VF9JTlRFUkZBQ0VfVkVSU0lPTiApCiAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgRVJS
T1IoIkVycm9yOiB2bV9ldmVudCBpbnRlcmZhY2UgdmVyc2lvbiBtaXNtYXRjaCFcbiIpOwpAQCAt
NzM1LDcgKzYxOSw3IEBAIGludCBtYWluKGludCBhcmdjLCBjaGFyICphcmd2W10pCiAgICAgICAg
ICAgICAgICAgICAgICAqIEF0IHNodXRkb3duIHdlIGhhdmUgYWxyZWFkeSByZXNldCBhbGwgdGhl
IHBlcm1pc3Npb25zIHNvIHJlYWxseSBubyB1c2UgZ2V0dGluZyBpdCBhZ2Fpbi4KICAgICAgICAg
ICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgIHhlbm1lbV9hY2Nlc3NfdCBhY2Nl
c3M7Ci0gICAgICAgICAgICAgICAgICAgIHJjID0geGNfZ2V0X21lbV9hY2Nlc3MoeGNoLCBkb21h
aW5faWQsIHJlcS51Lm1lbV9hY2Nlc3MuZ2ZuLCAmYWNjZXNzKTsKKyAgICAgICAgICAgICAgICAg
ICAgcmMgPSB4Y19nZXRfbWVtX2FjY2Vzcyh2bV9ldmVudC0+eGNoLCBkb21haW5faWQsIHJlcS51
Lm1lbV9hY2Nlc3MuZ2ZuLCAmYWNjZXNzKTsKICAgICAgICAgICAgICAgICAgICAgaWYgKHJjIDwg
MCkKICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgRVJST1Io
IkVycm9yICVkIGdldHRpbmcgbWVtX2FjY2VzcyBldmVudFxuIiwgcmMpOwpAQCAtNzY4LDcgKzY1
Miw3IEBAIGludCBtYWluKGludCBhcmdjLCBjaGFyICphcmd2W10pCiAgICAgICAgICAgICAgICAg
fQogICAgICAgICAgICAgICAgIGVsc2UgaWYgKCBkZWZhdWx0X2FjY2VzcyAhPSBhZnRlcl9maXJz
dF9hY2Nlc3MgKQogICAgICAgICAgICAgICAgIHsKLSAgICAgICAgICAgICAgICAgICAgcmMgPSB4
Y19zZXRfbWVtX2FjY2Vzcyh4Y2gsIGRvbWFpbl9pZCwgYWZ0ZXJfZmlyc3RfYWNjZXNzLAorICAg
ICAgICAgICAgICAgICAgICByYyA9IHhjX3NldF9tZW1fYWNjZXNzKHZtX2V2ZW50LT54Y2gsIGRv
bWFpbl9pZCwgYWZ0ZXJfZmlyc3RfYWNjZXNzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHJlcS51Lm1lbV9hY2Nlc3MuZ2ZuLCAxKTsKICAgICAgICAgICAgICAg
ICAgICAgaWYgKHJjIDwgMCkKICAgICAgICAgICAgICAgICAgICAgewpAQCAtNzg4LDcgKzY3Miw3
IEBAIGludCBtYWluKGludCBhcmdjLCBjaGFyICphcmd2W10pCiAgICAgICAgICAgICAgICAgICAg
ICAgIHJlcS52Y3B1X2lkKTsKIAogICAgICAgICAgICAgICAgIC8qIFJlaW5qZWN0ICovCi0gICAg
ICAgICAgICAgICAgcmMgPSB4Y19odm1faW5qZWN0X3RyYXAoeGNoLCBkb21haW5faWQsIHJlcS52
Y3B1X2lkLAorICAgICAgICAgICAgICAgIHJjID0geGNfaHZtX2luamVjdF90cmFwKHZtX2V2ZW50
LT54Y2gsIGRvbWFpbl9pZCwgcmVxLnZjcHVfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgWDg2X1RSQVBfSU5UMywKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICByZXEudS5zb2Z0d2FyZV9icmVha3BvaW50LnR5cGUsIC0xLAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS51LnNvZnR3YXJlX2JyZWFrcG9p
bnQuaW5zbl9sZW5ndGgsIDApOwpAQCAtODMzLDcgKzcxNyw3IEBAIGludCBtYWluKGludCBhcmdj
LCBjaGFyICphcmd2W10pCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcS51LmRlYnVnX2V4Y2Vw
dGlvbi5pbnNuX2xlbmd0aCk7CiAKICAgICAgICAgICAgICAgICAvKiBSZWluamVjdCAqLwotICAg
ICAgICAgICAgICAgIHJjID0geGNfaHZtX2luamVjdF90cmFwKHhjaCwgZG9tYWluX2lkLCByZXEu
dmNwdV9pZCwKKyAgICAgICAgICAgICAgICByYyA9IHhjX2h2bV9pbmplY3RfdHJhcCh2bV9ldmVu
dC0+eGNoLCBkb21haW5faWQsIHJlcS52Y3B1X2lkLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIFg4Nl9UUkFQX0RFQlVHLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHJlcS51LmRlYnVnX2V4Y2VwdGlvbi50eXBlLCAtMSwKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEudS5kZWJ1Z19leGNlcHRpb24uaW5z
bl9sZW5ndGgsCkBAIC04OTYsMTcgKzc4MCwxNSBAQCBpbnQgbWFpbihpbnQgYXJnYywgY2hhciAq
YXJndltdKQogICAgICAgICAgICAgfQogCiAgICAgICAgICAgICAvKiBQdXQgdGhlIHJlc3BvbnNl
IG9uIHRoZSByaW5nICovCi0gICAgICAgICAgICBwdXRfcmVzcG9uc2UoJnhlbmFjY2Vzcy0+dm1f
ZXZlbnQsICZyc3ApOwotICAgICAgICB9Ci0KLSAgICAgICAgLyogVGVsbCBYZW4gcGFnZSBpcyBy
ZWFkeSAqLwotICAgICAgICByYyA9IHhlbmV2dGNobl9ub3RpZnkoeGVuYWNjZXNzLT52bV9ldmVu
dC54Y2VfaGFuZGxlLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeGVuYWNjZXNzLT52
bV9ldmVudC5wb3J0KTsKKyAgICAgICAgICAgIHB1dF9yZXNwb25zZSh2bV9ldmVudCwgJnJzcCwg
cG9ydCk7CiAKLSAgICAgICAgaWYgKCByYyAhPSAwICkKLSAgICAgICAgewotICAgICAgICAgICAg
RVJST1IoIkVycm9yIHJlc3VtaW5nIHBhZ2UiKTsKLSAgICAgICAgICAgIGludGVycnVwdGVkID0g
LTE7CisgICAgICAgICAgICAvKiBUZWxsIFhlbiBwYWdlIGlzIHJlYWR5ICovCisgICAgICAgICAg
ICByYyA9IG5vdGlmeV9wb3J0KHZtX2V2ZW50LCBwb3J0KTsKKyAgICAgICAgICAgIGlmICggcmMg
IT0gMCApCisgICAgICAgICAgICB7CisgICAgICAgICAgICAgICAgRVJST1IoIkVycm9yIHJlc3Vt
aW5nIHBhZ2UiKTsKKyAgICAgICAgICAgICAgICBpbnRlcnJ1cHRlZCA9IC0xOworICAgICAgICAg
ICAgfQogICAgICAgICB9CiAKICAgICAgICAgaWYgKCBzaHV0dGluZ19kb3duICkKQEAgLTkxOSwx
MyArODAxLDEzIEBAIGV4aXQ6CiAgICAgewogICAgICAgICB1aW50MzJfdCB2Y3B1X2lkOwogICAg
ICAgICBmb3IgKCB2Y3B1X2lkID0gMDsgdmNwdV9pZDxYRU5fTEVHQUNZX01BWF9WQ1BVUzsgdmNw
dV9pZCsrKQotICAgICAgICAgICAgcmMgPSBjb250cm9sX3NpbmdsZXN0ZXAoeGNoLCBkb21haW5f
aWQsIHZjcHVfaWQsIDApOworICAgICAgICAgICAgcmMgPSBjb250cm9sX3NpbmdsZXN0ZXAodm1f
ZXZlbnQtPnhjaCwgZG9tYWluX2lkLCB2Y3B1X2lkLCAwKTsKICAgICB9CiAKLSAgICAvKiBUZWFy
IGRvd24gZG9tYWluIHhlbmFjY2VzcyAqLwotICAgIHJjMSA9IHhlbmFjY2Vzc190ZWFyZG93bih4
Y2gsIHhlbmFjY2Vzcyk7CisgICAgLyogVGVhciBkb3duIGRvbWFpbiAqLworICAgIHJjMSA9IHZt
X2V2ZW50X3RlYXJkb3duKHZtX2V2ZW50KTsKICAgICBpZiAoIHJjMSAhPSAwICkKLSAgICAgICAg
RVJST1IoIkVycm9yIHRlYXJpbmcgZG93biB4ZW5hY2Nlc3MiKTsKKyAgICAgICAgRVJST1IoIkVy
cm9yIHRlYXJpbmcgZG93biB2bV9ldmVudCIpOwogCiAgICAgaWYgKCByYyA9PSAwICkKICAgICAg
ICAgcmMgPSByYzE7CmRpZmYgLS1naXQgYS90b29scy90ZXN0cy94ZW4tYWNjZXNzL3hlbi1hY2Nl
c3MuaCBiL3Rvb2xzL3Rlc3RzL3hlbi1hY2Nlc3MveGVuLWFjY2Vzcy5oCm5ldyBmaWxlIG1vZGUg
MTAwNjQ0CmluZGV4IDAwMDAwMDAuLjlmYzY0MGMKLS0tIC9kZXYvbnVsbAorKysgYi90b29scy90
ZXN0cy94ZW4tYWNjZXNzL3hlbi1hY2Nlc3MuaApAQCAtMCwwICsxLDkxIEBACisvKgorICogeGVu
LWFjY2Vzcy5oCisgKgorICogQ29weXJpZ2h0IChjKSAyMDE5IEJpdGRlZmVuZGVyIFMuUi5MLgor
ICoKKyAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBh
bnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkKKyAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29j
aWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0bworICogZGVhbCBp
biB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGlt
aXRhdGlvbiB0aGUKKyAqIHJpZ2h0cyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxp
c2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vcgorICogc2VsbCBjb3BpZXMgb2YgdGhl
IFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMK
KyAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlv
bnM6CisgKgorICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lv
biBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4KKyAqIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRp
YWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgorICoKKyAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9W
SURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCisg
KiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9G
IE1FUkNIQU5UQUJJTElUWSwKKyAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFO
RCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQorICogQVVUSE9SUyBPUiBD
T1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhF
UgorICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBP
UiBPVEhFUldJU0UsIEFSSVNJTkcKKyAqIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJ
VEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIKKyAqIERFQUxJTkdTIElOIFRIRSBT
T0ZUV0FSRS4KKyAqLworCisjaWZuZGVmIFhFTl9BQ0NFU1NfSAorI2RlZmluZSBYRU5fQUNDRVNT
X0gKKworI2luY2x1ZGUgPHhlbmN0cmwuaD4KKyNpbmNsdWRlIDx4ZW5ldnRjaG4uaD4KKyNpbmNs
dWRlIDx4ZW4vdm1fZXZlbnQuaD4KKworI2lmbmRlZiBjb250YWluZXJfb2YKKyNkZWZpbmUgY29u
dGFpbmVyX29mKHB0ciwgdHlwZSwgbWVtYmVyKSAoeyBcCisgICAgICAgICAgICAgICAgY29uc3Qg
dHlwZW9mKCAoKHR5cGUgKikwKS0+bWVtYmVyICkgKl9fbXB0ciA9IChwdHIpOyBcCisgICAgICAg
ICAgICAgICAgKHR5cGUgKikoIChjaGFyICopX19tcHRyIC0gb2Zmc2V0b2YodHlwZSxtZW1iZXIp
ICk7fSkKKyNlbmRpZiAvKiBjb250YWluZXJfb2YgKi8KKworI2RlZmluZSBEUFJJTlRGKGEsIGIu
Li4pIGZwcmludGYoc3RkZXJyLCBhLCAjIyBiKQorI2RlZmluZSBFUlJPUihhLCBiLi4uKSBmcHJp
bnRmKHN0ZGVyciwgYSAiXG4iLCAjIyBiKQorI2RlZmluZSBQRVJST1IoYSwgYi4uLikgZnByaW50
ZihzdGRlcnIsIGEgIjogJXNcbiIsICMjIGIsIHN0cmVycm9yKGVycm5vKSkKKworc3RydWN0IHZt
X2V2ZW50X29wczsKKwordHlwZWRlZiBzdHJ1Y3Qgdm1fZXZlbnQgeworICAgIHhjX2ludGVyZmFj
ZSAqeGNoOworICAgIGRvbWlkX3QgZG9tYWluX2lkOworICAgIHhlbmV2dGNobl9oYW5kbGUgKnhj
ZTsKKyAgICB4ZW5fcGZuX3QgbWF4X2dwZm47CisgICAgc3RydWN0IHZtX2V2ZW50X29wcyAqb3Bz
OworfSB2bV9ldmVudF90OworCit0eXBlZGVmIHN0cnVjdCB2bV9ldmVudF9vcHMgeworICAgIGlu
dCAoKmluaXQpKHhjX2ludGVyZmFjZSAqLCB4ZW5ldnRjaG5faGFuZGxlICosIGRvbWlkX3QsCisg
ICAgICAgICAgICAgICAgc3RydWN0IHZtX2V2ZW50X29wcyAqLCB2bV9ldmVudF90ICoqKTsKKyAg
ICBpbnQgKCp0ZWFyZG93bikodm1fZXZlbnRfdCAqKTsKKyAgICBib29sICgqZ2V0X3JlcXVlc3Qp
KHZtX2V2ZW50X3QgKiwgdm1fZXZlbnRfcmVxdWVzdF90ICosIGludCAqKTsKKyAgICB2b2lkICgq
cHV0X3Jlc3BvbnNlKSh2bV9ldmVudF90ICosIHZtX2V2ZW50X3Jlc3BvbnNlX3QgKiwgaW50KTsK
KyAgICBpbnQgKCpub3RpZnlfcG9ydCkodm1fZXZlbnRfdCAqLCBpbnQgcG9ydCk7Cit9IHZtX2V2
ZW50X29wc190OworCitzdGF0aWMgaW5saW5lIGJvb2wgZ2V0X3JlcXVlc3Qodm1fZXZlbnRfdCAq
dm1fZXZlbnQsIHZtX2V2ZW50X3JlcXVlc3RfdCAqcmVxLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGludCAqcG9ydCkKK3sKKyAgICByZXR1cm4gKCB2bV9ldmVudCApID8gdm1fZXZl
bnQtPm9wcy0+Z2V0X3JlcXVlc3Qodm1fZXZlbnQsIHJlcSwgcG9ydCkgOgorICAgICAgICAgICAg
ICAgICAgICAgICAgICBmYWxzZTsKK30KKworc3RhdGljIGlubGluZSB2b2lkIHB1dF9yZXNwb25z
ZSh2bV9ldmVudF90ICp2bV9ldmVudCwgdm1fZXZlbnRfcmVzcG9uc2VfdCAqcnNwLCBpbnQgcG9y
dCkKK3sKKyAgICBpZiAoICB2bV9ldmVudCApCisgICAgICAgIHZtX2V2ZW50LT5vcHMtPnB1dF9y
ZXNwb25zZSh2bV9ldmVudCwgcnNwLCBwb3J0KTsKK30KKworc3RhdGljIGlubGluZSBpbnQgbm90
aWZ5X3BvcnQodm1fZXZlbnRfdCAqdm1fZXZlbnQsIGludCBwb3J0KQoreworICAgIGlmICggIXZt
X2V2ZW50ICkKKyAgICAgICAgcmV0dXJuIC1FSU5WQUw7CisKKyAgICByZXR1cm4gdm1fZXZlbnQt
Pm9wcy0+bm90aWZ5X3BvcnQodm1fZXZlbnQsIHBvcnQpOworfQorCisjZW5kaWYgLyogWEVOX0FD
Q0VTU19IICovCisKKy8qCisgKiBMb2NhbCB2YXJpYWJsZXM6CisgKiBtb2RlOiBDCisgKiBjLWZp
bGUtc3R5bGU6ICJCU0QiCisgKiBjLWJhc2ljLW9mZnNldDogNAorICogaW5kZW50LXRhYnMtbW9k
ZTogbmlsCisgKiBFbmQ6CisgKi8KLS0gCjIuNy40CgoKX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxA
bGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFu
L2xpc3RpbmZvL3hlbi1kZXZlbA==

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 0F82481D56
	for <lists+xen-devel@lfdr.de>; Mon,  5 Aug 2019 15:33:19 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hud3t-0004ik-EO; Mon, 05 Aug 2019 13:30:05 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=j9cV=WB=arm.com=julien.grall@srs-us1.protection.inumbo.net>)
 id 1hud3s-0004a3-BO
 for xen-devel@lists.xenproject.org; Mon, 05 Aug 2019 13:30:04 +0000
X-Inumbo-ID: 215ad532-b785-11e9-8980-bc764e045a96
Received: from foss.arm.com (unknown [217.140.110.172])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTP
 id 215ad532-b785-11e9-8980-bc764e045a96;
 Mon, 05 Aug 2019 13:30:02 +0000 (UTC)
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.121.207.14])
 by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id 8FB891570;
 Mon,  5 Aug 2019 06:30:02 -0700 (PDT)
Received: from e108454-lin.cambridge.arm.com (e108454-lin.cambridge.arm.com
 [10.1.196.50])
 by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPSA id DE2D63F706;
 Mon,  5 Aug 2019 06:30:00 -0700 (PDT)
From: Julien Grall <julien.grall@arm.com>
To: xen-devel@lists.xenproject.org
Date: Mon,  5 Aug 2019 14:29:52 +0100
Message-Id: <20190805132955.1630-2-julien.grall@arm.com>
X-Mailer: git-send-email 2.11.0
In-Reply-To: <20190805132955.1630-1-julien.grall@arm.com>
References: <20190805132955.1630-1-julien.grall@arm.com>
Subject: [Xen-devel] [PATCH v2 1/4] xen/console: Don't treat NUL character
 as the end of the buffer
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>,
 Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

QWZ0ZXIgdXBncmFkaW5nIERlYmlhbiB0byBCdXN0ZXIsIEkgaGF2ZSBiZWdhbiB0byBub3RpY2Ug
Y29uc29sZQptYW5nbGluZyB3aGVuIHVzaW5nIHpzaCBpbiBEb20wLiBUaGlzIGlzIGhhcHBlbm5p
bmcgYmVjYXVzZSBvdXRwdXQgc2VudCBieQp6c2ggdG8gdGhlIGNvbnNvbGUgbWF5IGNvbnRhaW4g
TlVMcyBpbiB0aGUgbWlkZGxlIG9mIHRoZSBidWZmZXIuCgpUaGUgYWN0dWFsIGltcGxlbWVudGF0
aW9uIG9mIENPTlNPTEVJT193cml0ZSBjb25zaWRlcnMgdGhhdCBhIGJ1ZmZlcgphbHdheXMgdGVy
bWluYXRlIHdpdGggYSBOVUwgYW5kIHRoZXJlZm9yZSB3aWxsIGlnbm9yZSBhbnl0aGluZyBhZnRl
ciBpdC4KCkluIGdlbmVyYWwsIE5VTHMgYXJlIHBlcmZlY3RseSBsZWdpdGltYXRlIGluIHRlcm1p
bmFsIHN0cmVhbXMuIEZvcgppbnN0YW5jZSwgdGhpcyBjb3VsZCBiZSB1c2VkIGZvciBwYWRkaW5n
IHNsb3cgdGVybWluYWxzLiBTZWUgdGVybWluZm8oNSkKc2VjdGlvbiBgRGVsYXlzIGFuZCBQYWRk
aW5nYCwgb3Igc2VhcmNoIGZvciB0aGUgcGNyZSAnXGJwYWQnLgoKT3RoZXIgdXNlIGNhc2VzIGlu
Y2x1ZGVzIHVzaW5nIHRoZSBjb25zb2xlIGZvciBkdW1waW5nIG5vbi1odW1hbgpyZWFkYWJsZSBp
bmZvcm1hdGlvbiAoZS5nIGRlYnVnZ2VyLCBmaWxlIGlmIG5vIG5ldHdvcmsuLi4pLiBXaXRoIHRo
ZQpjdXJyZW50IGJlaGF2aW9yLCB0aGUgcmVzdWx0aW5nIHN0cmVhbSB3aWxsIGVuZCB1cCB0byBi
ZSBjb3JydXB0ZWQuCgpUaGUgZG9jdW1lbnRhdGlvbiBmb3IgQ09OU09MRUlPX3dyaXRlIGlzIHBy
ZXR0eSBsaW1pdGVkICh0byBub3Qgc2F5CmluZXhpc3RlbnQpLiBGcm9tIHRoZSBkZWNsYXJhdGlv
biwgdGhlIGh5cGVyY2FsbCB0YWtlcyBhIGJ1ZmZlciBhbmQgc2l6ZS4KU28gdGhpcyBjb3VsZCBs
ZWFkIHRvIHRoaW5rIHRoZSBOVUwgY2hhcmFjdGVyIGlzIGFsbG93ZWQgaW4gdGhlIG1pZGRsZSBv
Zgp0aGUgYnVmZmVyLgoKVGhpcyBwYXRjaCB1cGRhdGVzIHRoZSBjb25zb2xlIEFQSSB0byBwYXNz
IHRoZSBzaXplIGFsb25nIHRoZSBidWZmZXIKZG93biBzbyB3ZSBjYW4gcmVtb3ZlIHRoZSByZWxp
YW5jZSBvbiBidWZmZXIgdGVybWluYXRpbmcgYnkgYSBOVUwKY2hhcmFjdGVyLgoKU2lnbmVkLW9m
Zi1ieTogSnVsaWVuIEdyYWxsIDxqdWxpZW4uZ3JhbGxAYXJtLmNvbT4KCi0tLQoKVGhpcyBwYXRj
aCB3YXMgb3JpZ2luYWxseSBzZW50IHN0YW5kYWxvbmUgWzFdLiBCdXQgdGhlIHNlcmllcyBncm93
cyB0bwppbmNsdWRlIGFub3RoZXIgYnVnIGZvdW5kIGluIHRoZSBjb25zb2xlIGNvZGUgYW5kIGRv
Y3VtZW50YXRpb24uCgpDbmhhbmdlcyBpbiB2MjoKICAgIC0gU3dpdGNoIGZyb20gdW5zaWduZWQg
aW50IHRvIHNpemVfdC4gU28gdHJ1bmNhdGlvbiBpcyBhdm9pZGVkLiBXZQogICAgY2FuIGRlY2lk
ZSB3aGV0aGVyIHdlIHdhbnQgZXhwbGljaXQgdHJ1bmNhdGlvbiBsYXRlciBvbi4KICAgIC0gUmVt
b3ZlIHVuZWNlc3NhcnkgbGVhZGluZyBOVUwgYWRkZWQgaW4gZHVtcF9jb25zb2xlX3Jpbmdfa2V5
CiAgICAtIFJlbW92ZSB1bmVjZXNzYXJ5IGRlY29yYXRpb24gaW4gc2VyY29uX3B1dHMKICAgIC0g
Rml4IGxvb3AgaW4gbGZiX3Njcm9sbF9wdXRzCiAgICAtIHVzZSB3aGlsZSgpIHJhdGhlciB0aGFu
IGRvIHt9IHdoaWxlKCkKCkNoYW5nZSBzaW5jZSB0aGUgc3RhbmRhbG9uZSB2ZXJzaW9uOgogICAg
LSBGaXggZWFybHkgcHJpbnRrIG9uIEFybQogICAgLSBGaXggZ2Ric3R1YgogICAgLSBSZW1vdmUg
dW5lY2Vzc2FyeSBsZWFkaW5nIE5VTCBjaGFyYWN0ZXIgYWRkZWQgYnkgWGVuCiAgICAtIEhhbmRs
ZSBEb21VIGNvbnNvbGUKICAgIC0gUmV3b3JrIHRoZSBjb21taXQgbWVzc2FnZQoKQmVsb3cgYSBz
bWFsbCBDIHByb2dyYW0gdG8gcmVwcm8gdGhlIGJ1ZyBvbiBYZW46CgppbnQgbWFpbih2b2lkKQp7
CiAgICB3cml0ZSgxLAogICAgICAgICAgIlxyXDMzWzBtXDBcMFwwXDBcMFwwXDBcMFwzM1syN21c
MzNbMjRtXDMzW2pcMzNbMzJtanVsaWVuXDMzWzMxbUBcMzNbMDBtXDMzWzM2bWp1bm8yLWp1bGll
bmc6flwzM1szN20+IiwKICAgICAgICAgIDc1KTsKICAgIHdyaXRlKDEsCiAgICAgICAgICAiXDMz
W0tcMzNbMzJDXDMzWzAxOzMzbS0tanVubzItanVsaWVuZy0xMzo0NC0tXDMzWzAwbVwzM1szN21c
MzNbNTVEIiwKICAgICAgICAgIDU0KTsKICAgIHdyaXRlKDEsICJcMzNbPzIwMDRoIiwgOCk7Cgog
ICAgcmV0dXJuIDA7Cn0KCldpdGhvdXQgdGhpcyBwYXRjaCwgdGhlIG9ubHkgLS1qdW5vMi1qdWxp
ZW5nLTEzOjQ0LS0gd2lsbCBiZSBwcmludGVkIGluCnllbGxvdy4KClRoaXMgcGF0Y2ggd2FzIHRl
c3RlZCBvbiBBcm0gdXNpbmcgc2VyaWFsIGNvbnNvbGUuIEkgYW0gbm90IGVudGlyZWx5CnN1cmUg
d2hldGhlciB0aGUgdmlkZW8gYW5kIFBWIGNvbnNvbGUgaXMgY29ycmVjdC4gSSB3b3VsZCBhcHBy
ZWNpYXRlIGhlbHAKZm9yIHRlc3RpbmcgaGVyZS4KClsxXSBodHRwczovL2xpc3RzLnhlbnByb2pl
Y3Qub3JnL2FyY2hpdmVzL2h0bWwveGVuLWRldmVsLzIwMTktMDIvbXNnMDE5MzIuaHRtbAotLS0K
IHhlbi9hcmNoL2FybS9lYXJseV9wcmludGsuYyAgICAgICB8ICA1ICsrLS0KIHhlbi9jb21tb24v
Z2Ric3R1Yi5jICAgICAgICAgICAgICB8ICA2ICsrLS0KIHhlbi9kcml2ZXJzL2NoYXIvY29uc29s
ZS5jICAgICAgICB8IDU5ICsrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLS0tLQog
eGVuL2RyaXZlcnMvY2hhci9jb25zb2xlZC5jICAgICAgIHwgIDcgKystLS0KIHhlbi9kcml2ZXJz
L2NoYXIvc2VyaWFsLmMgICAgICAgICB8ICA3ICsrKy0tCiB4ZW4vZHJpdmVycy9jaGFyL3hlbl9w
dl9jb25zb2xlLmMgfCAxMCArKystLS0tCiB4ZW4vZHJpdmVycy92aWRlby9sZmIuYyAgICAgICAg
ICAgfCAxNCArKysrKystLS0tCiB4ZW4vZHJpdmVycy92aWRlby9sZmIuaCAgICAgICAgICAgfCAg
NCArLS0KIHhlbi9kcml2ZXJzL3ZpZGVvL3ZnYS5jICAgICAgICAgICB8IDE0ICsrKysrLS0tLS0K
IHhlbi9pbmNsdWRlL3hlbi9jb25zb2xlLmggICAgICAgICB8ICAyICstCiB4ZW4vaW5jbHVkZS94
ZW4vZWFybHlfcHJpbnRrLmggICAgfCAgMiArLQogeGVuL2luY2x1ZGUveGVuL3B2X2NvbnNvbGUu
aCAgICAgIHwgIDQgKy0tCiB4ZW4vaW5jbHVkZS94ZW4vc2VyaWFsLmggICAgICAgICAgfCAgNCAr
LS0KIHhlbi9pbmNsdWRlL3hlbi92aWRlby5oICAgICAgICAgICB8ICA0ICstLQogMTQgZmlsZXMg
Y2hhbmdlZCwgNzEgaW5zZXJ0aW9ucygrKSwgNzEgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEv
eGVuL2FyY2gvYXJtL2Vhcmx5X3ByaW50ay5jIGIveGVuL2FyY2gvYXJtL2Vhcmx5X3ByaW50ay5j
CmluZGV4IDk3NDY2YTEyYjEuLjMzMzA3M2Q5N2UgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL2FybS9l
YXJseV9wcmludGsuYworKysgYi94ZW4vYXJjaC9hcm0vZWFybHlfcHJpbnRrLmMKQEAgLTE3LDkg
KzE3LDEwIEBACiB2b2lkIGVhcmx5X3B1dGNoKGNoYXIgYyk7CiB2b2lkIGVhcmx5X2ZsdXNoKHZv
aWQpOwogCi12b2lkIGVhcmx5X3B1dHMoY29uc3QgY2hhciAqcykKK3ZvaWQgZWFybHlfcHV0cyhj
b25zdCBjaGFyICpzLCBzaXplX3QgbnIpCiB7Ci0gICAgd2hpbGUgKCpzICE9ICdcMCcpIHsKKyAg
ICB3aGlsZSAoIG5yLS0gPiAwICkKKyAgICB7CiAgICAgICAgIGlmICgqcyA9PSAnXG4nKQogICAg
ICAgICAgICAgZWFybHlfcHV0Y2goJ1xyJyk7CiAgICAgICAgIGVhcmx5X3B1dGNoKCpzKTsKZGlm
ZiAtLWdpdCBhL3hlbi9jb21tb24vZ2Ric3R1Yi5jIGIveGVuL2NvbW1vbi9nZGJzdHViLmMKaW5k
ZXggMDcwOTVlMWVjNy4uNjIzNDgzNGEyMCAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9nZGJzdHVi
LmMKKysrIGIveGVuL2NvbW1vbi9nZGJzdHViLmMKQEAgLTY4LDcgKzY4LDcgQEAgc3RhdGljIHZv
aWQgZ2RiX3NtcF9yZXN1bWUodm9pZCk7CiBzdGF0aWMgY2hhciBfX2luaXRkYXRhIG9wdF9nZGJb
MzBdOwogc3RyaW5nX3BhcmFtKCJnZGIiLCBvcHRfZ2RiKTsKIAotc3RhdGljIHZvaWQgZ2Ric3R1
Yl9jb25zb2xlX3B1dHMoY29uc3QgY2hhciAqc3RyKTsKK3N0YXRpYyB2b2lkIGdkYnN0dWJfY29u
c29sZV9wdXRzKGNvbnN0IGNoYXIgKnN0ciwgc2l6ZV90IG5yKTsKIAogLyogdmFsdWUgPC0+IGNo
YXIgKGRlKXNlcmlhbHplcnMgKi8KIHN0YXRpYyBjaGFyCkBAIC01NDYsMTQgKzU0NiwxNCBAQCBf
X2dkYl9jdHggPSB7CiBzdGF0aWMgc3RydWN0IGdkYl9jb250ZXh0ICpnZGJfY3R4ID0gJl9fZ2Ri
X2N0eDsKIAogc3RhdGljIHZvaWQKLWdkYnN0dWJfY29uc29sZV9wdXRzKGNvbnN0IGNoYXIgKnN0
cikKK2dkYnN0dWJfY29uc29sZV9wdXRzKGNvbnN0IGNoYXIgKnN0ciwgc2l6ZV90IG5yKQogewog
ICAgIGNvbnN0IGNoYXIgKnA7CiAKICAgICBnZGJfc3RhcnRfcGFja2V0KGdkYl9jdHgpOwogICAg
IGdkYl93cml0ZV90b19wYWNrZXRfY2hhcignTycsIGdkYl9jdHgpOwogCi0gICAgZm9yICggcCA9
IHN0cjsgKnAgIT0gJ1wwJzsgcCsrICkKKyAgICBmb3IgKCBwID0gc3RyOyBuciA+IDA7IHArKywg
bnItLSApCiAgICAgewogICAgICAgICBnZGJfd3JpdGVfdG9fcGFja2V0X2NoYXIoaGV4MmNoYXIo
KCpwPj40KSAmIDB4MGYpLCBnZGJfY3R4ICk7CiAgICAgICAgIGdkYl93cml0ZV90b19wYWNrZXRf
Y2hhcihoZXgyY2hhcigoKnApICYgMHgwZiksIGdkYl9jdHggKTsKZGlmZiAtLWdpdCBhL3hlbi9k
cml2ZXJzL2NoYXIvY29uc29sZS5jIGIveGVuL2RyaXZlcnMvY2hhci9jb25zb2xlLmMKaW5kZXgg
ZDcyOGU3MzdkMS4uNzUyYTExZjZjNSAxMDA2NDQKLS0tIGEveGVuL2RyaXZlcnMvY2hhci9jb25z
b2xlLmMKKysrIGIveGVuL2RyaXZlcnMvY2hhci9jb25zb2xlLmMKQEAgLTMyNiw5ICszMjYsOSBA
QCBsb25nIHJlYWRfY29uc29sZV9yaW5nKHN0cnVjdCB4ZW5fc3lzY3RsX3JlYWRjb25zb2xlICpv
cCkKIHN0YXRpYyBjaGFyIHNlcmlhbF9yeF9yaW5nW1NFUklBTF9SWF9TSVpFXTsKIHN0YXRpYyB1
bnNpZ25lZCBpbnQgc2VyaWFsX3J4X2NvbnMsIHNlcmlhbF9yeF9wcm9kOwogCi1zdGF0aWMgdm9p
ZCAoKnNlcmlhbF9zdGVhbF9mbikoY29uc3QgY2hhciAqKSA9IGVhcmx5X3B1dHM7CitzdGF0aWMg
dm9pZCAoKnNlcmlhbF9zdGVhbF9mbikoY29uc3QgY2hhciAqLCBzaXplX3QgbnIpID0gZWFybHlf
cHV0czsKIAotaW50IGNvbnNvbGVfc3RlYWwoaW50IGhhbmRsZSwgdm9pZCAoKmZuKShjb25zdCBj
aGFyICopKQoraW50IGNvbnNvbGVfc3RlYWwoaW50IGhhbmRsZSwgdm9pZCAoKmZuKShjb25zdCBj
aGFyICosIHNpemVfdCBucikpCiB7CiAgICAgaWYgKCAoaGFuZGxlID09IC0xKSB8fCAoaGFuZGxl
ICE9IHNlcmNvbl9oYW5kbGUpICkKICAgICAgICAgcmV0dXJuIDA7CkBAIC0zNDYsMTUgKzM0Niwx
NSBAQCB2b2lkIGNvbnNvbGVfZ2l2ZWJhY2soaW50IGlkKQogICAgICAgICBzZXJpYWxfc3RlYWxf
Zm4gPSBOVUxMOwogfQogCi1zdGF0aWMgdm9pZCBzZXJjb25fcHV0cyhjb25zdCBjaGFyICpzKQor
c3RhdGljIHZvaWQgc2VyY29uX3B1dHMoY29uc3QgY2hhciAqcywgc2l6ZV90IG5yKQogewogICAg
IGlmICggc2VyaWFsX3N0ZWFsX2ZuICE9IE5VTEwgKQotICAgICAgICAoKnNlcmlhbF9zdGVhbF9m
bikocyk7CisgICAgICAgIHNlcmlhbF9zdGVhbF9mbihzLCBucik7CiAgICAgZWxzZQotICAgICAg
ICBzZXJpYWxfcHV0cyhzZXJjb25faGFuZGxlLCBzKTsKKyAgICAgICAgc2VyaWFsX3B1dHMoc2Vy
Y29uX2hhbmRsZSwgcywgbnIpOwogCiAgICAgLyogQ29weSBhbGwgc2VyaWFsIG91dHB1dCBpbnRv
IFBWIGNvbnNvbGUgKi8KLSAgICBwdl9jb25zb2xlX3B1dHMocyk7CisgICAgcHZfY29uc29sZV9w
dXRzKHMsIG5yKTsKIH0KIAogc3RhdGljIHZvaWQgZHVtcF9jb25zb2xlX3Jpbmdfa2V5KHVuc2ln
bmVkIGNoYXIga2V5KQpAQCAtMzg3LDEwICszODcsOSBAQCBzdGF0aWMgdm9pZCBkdW1wX2NvbnNv
bGVfcmluZ19rZXkodW5zaWduZWQgY2hhciBrZXkpCiAgICAgICAgIHNvZmFyICs9IGxlbjsKICAg
ICAgICAgYyArPSBsZW47CiAgICAgfQotICAgIGJ1Zltzb2Zhcl0gPSAnXDAnOwogCi0gICAgc2Vy
Y29uX3B1dHMoYnVmKTsKLSAgICB2aWRlb19wdXRzKGJ1Zik7CisgICAgc2VyY29uX3B1dHMoYnVm
LCBzb2Zhcik7CisgICAgdmlkZW9fcHV0cyhidWYsIHNvZmFyKTsKIAogICAgIGZyZWVfeGVuaGVh
cF9wYWdlcyhidWYsIG9yZGVyKTsKIH0KQEAgLTUyOCw3ICs1MjcsNyBAQCBzdGF0aWMgaW5saW5l
IHZvaWQgeGVuX2NvbnNvbGVfd3JpdGVfZGVidWdfcG9ydChjb25zdCBjaGFyICpidWYsIHNpemVf
dCBsZW4pCiBzdGF0aWMgbG9uZyBndWVzdF9jb25zb2xlX3dyaXRlKFhFTl9HVUVTVF9IQU5ETEVf
UEFSQU0oY2hhcikgYnVmZmVyLCBpbnQgY291bnQpCiB7CiAgICAgY2hhciBrYnVmWzEyOF07Ci0g
ICAgaW50IGtjb3VudCA9IDA7CisgICAgdW5zaWduZWQgaW50IGtjb3VudCA9IDA7CiAgICAgc3Ry
dWN0IGRvbWFpbiAqY2QgPSBjdXJyZW50LT5kb21haW47CiAKICAgICB3aGlsZSAoIGNvdW50ID4g
MCApCkBAIC01NDEsMjUgKzU0MCwyMiBAQCBzdGF0aWMgbG9uZyBndWVzdF9jb25zb2xlX3dyaXRl
KFhFTl9HVUVTVF9IQU5ETEVfUEFSQU0oY2hhcikgYnVmZmVyLCBpbnQgY291bnQpCiAgICAgICAg
IGtjb3VudCA9IG1pbl90KGludCwgY291bnQsIHNpemVvZihrYnVmKS0xKTsKICAgICAgICAgaWYg
KCBjb3B5X2Zyb21fZ3Vlc3Qoa2J1ZiwgYnVmZmVyLCBrY291bnQpICkKICAgICAgICAgICAgIHJl
dHVybiAtRUZBVUxUOwotICAgICAgICBrYnVmW2tjb3VudF0gPSAnXDAnOwogCiAgICAgICAgIGlm
ICggaXNfaGFyZHdhcmVfZG9tYWluKGNkKSApCiAgICAgICAgIHsKICAgICAgICAgICAgIC8qIFVz
ZSBkaXJlY3QgY29uc29sZSBvdXRwdXQgYXMgaXQgY291bGQgYmUgaW50ZXJhY3RpdmUgKi8KICAg
ICAgICAgICAgIHNwaW5fbG9ja19pcnEoJmNvbnNvbGVfbG9jayk7CiAKLSAgICAgICAgICAgIHNl
cmNvbl9wdXRzKGtidWYpOwotICAgICAgICAgICAgdmlkZW9fcHV0cyhrYnVmKTsKKyAgICAgICAg
ICAgIHNlcmNvbl9wdXRzKGtidWYsIGtjb3VudCk7CisgICAgICAgICAgICB2aWRlb19wdXRzKGti
dWYsIGtjb3VudCk7CiAKICNpZmRlZiBDT05GSUdfWDg2CiAgICAgICAgICAgICBpZiAoIG9wdF9j
b25zb2xlX3hlbiApCiAgICAgICAgICAgICB7Ci0gICAgICAgICAgICAgICAgc2l6ZV90IGxlbiA9
IHN0cmxlbihrYnVmKTsKLQogICAgICAgICAgICAgICAgIGlmICggeGVuX2d1ZXN0ICkKLSAgICAg
ICAgICAgICAgICAgICAgeGVuX2h5cGVyY2FsbF9jb25zb2xlX3dyaXRlKGtidWYsIGxlbik7Cisg
ICAgICAgICAgICAgICAgICAgIHhlbl9oeXBlcmNhbGxfY29uc29sZV93cml0ZShrYnVmLCBrY291
bnQpOwogICAgICAgICAgICAgICAgIGVsc2UKLSAgICAgICAgICAgICAgICAgICAgeGVuX2NvbnNv
bGVfd3JpdGVfZGVidWdfcG9ydChrYnVmLCBsZW4pOworICAgICAgICAgICAgICAgICAgICB4ZW5f
Y29uc29sZV93cml0ZV9kZWJ1Z19wb3J0KGtidWYsIGtjb3VudCk7CiAgICAgICAgICAgICB9CiAj
ZW5kaWYKIApAQCAtNTc2LDE5ICs1NzIsMjAgQEAgc3RhdGljIGxvbmcgZ3Vlc3RfY29uc29sZV93
cml0ZShYRU5fR1VFU1RfSEFORExFX1BBUkFNKGNoYXIpIGJ1ZmZlciwgaW50IGNvdW50KQogICAg
ICAgICAgICAgY2hhciAqa2luID0ga2J1ZiwgKmtvdXQgPSBrYnVmLCBjOwogCiAgICAgICAgICAg
ICAvKiBTdHJpcCBub24tcHJpbnRhYmxlIGNoYXJhY3RlcnMgKi8KLSAgICAgICAgICAgIGZvciAo
IDsgOyApCisgICAgICAgICAgICBkbwogICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIGMg
PSAqa2luKys7Ci0gICAgICAgICAgICAgICAgaWYgKCBjID09ICdcMCcgfHwgYyA9PSAnXG4nICkK
KyAgICAgICAgICAgICAgICBpZiAoIGMgPT0gJ1xuJyApCiAgICAgICAgICAgICAgICAgICAgIGJy
ZWFrOwogICAgICAgICAgICAgICAgIGlmICggaXNwcmludChjKSB8fCBjID09ICdcdCcgKQogICAg
ICAgICAgICAgICAgICAgICAqa291dCsrID0gYzsKLSAgICAgICAgICAgIH0KKyAgICAgICAgICAg
IH0gd2hpbGUgKCAtLWtjb3VudCA+IDAgKTsKKwogICAgICAgICAgICAgKmtvdXQgPSAnXDAnOwog
ICAgICAgICAgICAgc3Bpbl9sb2NrKCZjZC0+cGJ1Zl9sb2NrKTsKKyAgICAgICAgICAgIGtjb3Vu
dCA9IGtpbiAtIGtidWY7CiAgICAgICAgICAgICBpZiAoIGMgPT0gJ1xuJyApCiAgICAgICAgICAg
ICB7Ci0gICAgICAgICAgICAgICAga2NvdW50ID0ga2luIC0ga2J1ZjsKICAgICAgICAgICAgICAg
ICBjZC0+cGJ1ZltjZC0+cGJ1Zl9pZHhdID0gJ1wwJzsKICAgICAgICAgICAgICAgICBndWVzdF9w
cmludGsoY2QsIFhFTkxPR19HX0RFQlVHICIlcyVzXG4iLCBjZC0+cGJ1Ziwga2J1Zik7CiAgICAg
ICAgICAgICAgICAgY2QtPnBidWZfaWR4ID0gMDsKQEAgLTY2NywxNiArNjY0LDE2IEBAIHN0YXRp
YyBib29sX3QgY29uc29sZV9sb2Nrc19idXN0ZWQ7CiAKIHN0YXRpYyB2b2lkIF9fcHV0c3RyKGNv
bnN0IGNoYXIgKnN0cikKIHsKKyAgICBzaXplX3QgbGVuID0gc3RybGVuKHN0cik7CisKICAgICBB
U1NFUlQoc3Bpbl9pc19sb2NrZWQoJmNvbnNvbGVfbG9jaykpOwogCi0gICAgc2VyY29uX3B1dHMo
c3RyKTsKLSAgICB2aWRlb19wdXRzKHN0cik7CisgICAgc2VyY29uX3B1dHMoc3RyLCBsZW4pOwor
ICAgIHZpZGVvX3B1dHMoc3RyLCBsZW4pOwogCiAjaWZkZWYgQ09ORklHX1g4NgogICAgIGlmICgg
b3B0X2NvbnNvbGVfeGVuICkKICAgICB7Ci0gICAgICAgIHNpemVfdCBsZW4gPSBzdHJsZW4oc3Ry
KTsKLQogICAgICAgICBpZiAoIHhlbl9ndWVzdCApCiAgICAgICAgICAgICB4ZW5faHlwZXJjYWxs
X2NvbnNvbGVfd3JpdGUoc3RyLCBsZW4pOwogICAgICAgICBlbHNlCkBAIC0xMjUwLDYgKzEyNDcs
NyBAQCB2b2lkIGRlYnVndHJhY2VfcHJpbnRrKGNvbnN0IGNoYXIgKmZtdCwgLi4uKQogICAgIGNo
YXIgICAgICAgICAgY250YnVmWzI0XTsKICAgICB2YV9saXN0ICAgICAgIGFyZ3M7CiAgICAgdW5z
aWduZWQgbG9uZyBmbGFnczsKKyAgICB1bnNpZ25lZCBpbnQgbnI7CiAKICAgICBpZiAoIGRlYnVn
dHJhY2VfYnl0ZXMgPT0gMCApCiAgICAgICAgIHJldHVybjsKQEAgLTEyNjEsMTQgKzEyNTksMTUg
QEAgdm9pZCBkZWJ1Z3RyYWNlX3ByaW50ayhjb25zdCBjaGFyICpmbXQsIC4uLikKICAgICBBU1NF
UlQoZGVidWd0cmFjZV9idWZbZGVidWd0cmFjZV9ieXRlcyAtIDFdID09IDApOwogCiAgICAgdmFf
c3RhcnQoYXJncywgZm10KTsKLSAgICB2c25wcmludGYoYnVmLCBzaXplb2YoYnVmKSwgZm10LCBh
cmdzKTsKKyAgICBuciA9IHZzY25wcmludGYoYnVmLCBzaXplb2YoYnVmKSwgZm10LCBhcmdzKTsK
ICAgICB2YV9lbmQoYXJncyk7CiAKICAgICBpZiAoIGRlYnVndHJhY2Vfc2VuZF90b19jb25zb2xl
ICkKICAgICB7Ci0gICAgICAgIHNucHJpbnRmKGNudGJ1Ziwgc2l6ZW9mKGNudGJ1ZiksICIldSAi
LCArK2NvdW50KTsKLSAgICAgICAgc2VyaWFsX3B1dHMoc2VyY29uX2hhbmRsZSwgY250YnVmKTsK
LSAgICAgICAgc2VyaWFsX3B1dHMoc2VyY29uX2hhbmRsZSwgYnVmKTsKKyAgICAgICAgdW5zaWdu
ZWQgaW50IG4gPSBzbnByaW50ZihjbnRidWYsIHNpemVvZihjbnRidWYpLCAiJXUgIiwgKytjb3Vu
dCk7CisKKyAgICAgICAgc2VyaWFsX3B1dHMoc2VyY29uX2hhbmRsZSwgY250YnVmLCBuKTsKKyAg
ICAgICAgc2VyaWFsX3B1dHMoc2VyY29uX2hhbmRsZSwgYnVmLCBucik7CiAgICAgfQogICAgIGVs
c2UKICAgICB7CkBAIC0xMzgxLDcgKzEzODAsNyBAQCB2b2lkIHBhbmljKGNvbnN0IGNoYXIgKmZt
dCwgLi4uKQogICogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioKICAqLwogCi1zdGF0aWMgdm9pZCBzdXNwZW5kX3N0ZWFsX2ZuKGNv
bnN0IGNoYXIgKnN0cikgeyB9CitzdGF0aWMgdm9pZCBzdXNwZW5kX3N0ZWFsX2ZuKGNvbnN0IGNo
YXIgKnN0ciwgc2l6ZV90IG5yKSB7IH0KIHN0YXRpYyBpbnQgc3VzcGVuZF9zdGVhbF9pZDsKIAog
aW50IGNvbnNvbGVfc3VzcGVuZCh2b2lkKQpkaWZmIC0tZ2l0IGEveGVuL2RyaXZlcnMvY2hhci9j
b25zb2xlZC5jIGIveGVuL2RyaXZlcnMvY2hhci9jb25zb2xlZC5jCmluZGV4IDU1MmFiZjU3NjYu
LjIyMmUwMTg0NDIgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL2NoYXIvY29uc29sZWQuYworKysg
Yi94ZW4vZHJpdmVycy9jaGFyL2NvbnNvbGVkLmMKQEAgLTc3LDE2ICs3NywxMyBAQCBzaXplX3Qg
Y29uc29sZWRfZ3Vlc3Rfcngodm9pZCkKIAogICAgICAgICBpZiAoIGlkeCA+PSBCVUZfU1ogKQog
ICAgICAgICB7Ci0gICAgICAgICAgICBwdl9jb25zb2xlX3B1dHMoYnVmKTsKKyAgICAgICAgICAg
IHB2X2NvbnNvbGVfcHV0cyhidWYsIEJVRl9TWik7CiAgICAgICAgICAgICBpZHggPSAwOwogICAg
ICAgICB9CiAgICAgfQogCiAgICAgaWYgKCBpZHggKQotICAgIHsKLSAgICAgICAgYnVmW2lkeF0g
PSAnXDAnOwotICAgICAgICBwdl9jb25zb2xlX3B1dHMoYnVmKTsKLSAgICB9CisgICAgICAgIHB2
X2NvbnNvbGVfcHV0cyhidWYsIGlkeCk7CiAKICAgICAvKiBObyBuZWVkIGZvciBhIG1lbSBiYXJy
aWVyIGJlY2F1c2UgZXZlcnkgY2hhcmFjdGVyIHdhcyBhbHJlYWR5IGNvbnN1bWVkICovCiAgICAg
YmFycmllcigpOwpkaWZmIC0tZ2l0IGEveGVuL2RyaXZlcnMvY2hhci9zZXJpYWwuYyBiL3hlbi9k
cml2ZXJzL2NoYXIvc2VyaWFsLmMKaW5kZXggMjIxYTE0YzA5Mi4uODhjZDg3Njc5MCAxMDA2NDQK
LS0tIGEveGVuL2RyaXZlcnMvY2hhci9zZXJpYWwuYworKysgYi94ZW4vZHJpdmVycy9jaGFyL3Nl
cmlhbC5jCkBAIC0yMjMsMTEgKzIyMywxMCBAQCB2b2lkIHNlcmlhbF9wdXRjKGludCBoYW5kbGUs
IGNoYXIgYykKICAgICBzcGluX3VubG9ja19pcnFyZXN0b3JlKCZwb3J0LT50eF9sb2NrLCBmbGFn
cyk7CiB9CiAKLXZvaWQgc2VyaWFsX3B1dHMoaW50IGhhbmRsZSwgY29uc3QgY2hhciAqcykKK3Zv
aWQgc2VyaWFsX3B1dHMoaW50IGhhbmRsZSwgY29uc3QgY2hhciAqcywgc2l6ZV90IG5yKQogewog
ICAgIHN0cnVjdCBzZXJpYWxfcG9ydCAqcG9ydDsKICAgICB1bnNpZ25lZCBsb25nIGZsYWdzOwot
ICAgIGNoYXIgYzsKIAogICAgIGlmICggaGFuZGxlID09IC0xICkKICAgICAgICAgcmV0dXJuOwpA
QCAtMjM4LDggKzIzNywxMCBAQCB2b2lkIHNlcmlhbF9wdXRzKGludCBoYW5kbGUsIGNvbnN0IGNo
YXIgKnMpCiAKICAgICBzcGluX2xvY2tfaXJxc2F2ZSgmcG9ydC0+dHhfbG9jaywgZmxhZ3MpOwog
Ci0gICAgd2hpbGUgKCAoYyA9ICpzKyspICE9ICdcMCcgKQorICAgIGZvciAoIDsgbnIgPiAwOyBu
ci0tLCBzKysgKQogICAgIHsKKyAgICAgICAgY2hhciBjID0gKnM7CisKICAgICAgICAgaWYgKCAo
YyA9PSAnXG4nKSAmJiAoaGFuZGxlICYgU0VSSE5EX0NPT0tFRCkgKQogICAgICAgICAgICAgX19z
ZXJpYWxfcHV0Yyhwb3J0LCAnXHInIHwgKChoYW5kbGUgJiBTRVJITkRfSEkpID8gMHg4MCA6IDB4
MDApKTsKIApkaWZmIC0tZ2l0IGEveGVuL2RyaXZlcnMvY2hhci94ZW5fcHZfY29uc29sZS5jIGIv
eGVuL2RyaXZlcnMvY2hhci94ZW5fcHZfY29uc29sZS5jCmluZGV4IGNjMWMxZDc0M2YuLjYxMjc4
NGIwNzQgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL2NoYXIveGVuX3B2X2NvbnNvbGUuYworKysg
Yi94ZW4vZHJpdmVycy9jaGFyL3hlbl9wdl9jb25zb2xlLmMKQEAgLTEyOSwxMyArMTI5LDEzIEBA
IHNpemVfdCBwdl9jb25zb2xlX3J4KHN0cnVjdCBjcHVfdXNlcl9yZWdzICpyZWdzKQogICAgIHJl
dHVybiByZWN2OwogfQogCi1zdGF0aWMgc2l6ZV90IHB2X3JpbmdfcHV0cyhjb25zdCBjaGFyICpi
dWYpCitzdGF0aWMgc2l6ZV90IHB2X3JpbmdfcHV0cyhjb25zdCBjaGFyICpidWYsIHNpemVfdCBu
cikKIHsKICAgICBYRU5DT05TX1JJTkdfSURYIGNvbnMsIHByb2Q7CiAgICAgc2l6ZV90IHNlbnQg
PSAwLCBhdmFpbDsKICAgICBib29sIHB1dF9yID0gZmFsc2U7CiAKLSAgICB3aGlsZSAoIGJ1Zltz
ZW50XSAhPSAnXDAnIHx8IHB1dF9yICkKKyAgICB3aGlsZSAoIHNlbnQgPCBuciB8fCBwdXRfciAp
CiAgICAgewogICAgICAgICBjb25zID0gQUNDRVNTX09OQ0UoY29uc19yaW5nLT5vdXRfY29ucyk7
CiAgICAgICAgIHByb2QgPSBjb25zX3JpbmctPm91dF9wcm9kOwpAQCAtMTU2LDcgKzE1Niw3IEBA
IHN0YXRpYyBzaXplX3QgcHZfcmluZ19wdXRzKGNvbnN0IGNoYXIgKmJ1ZikKICAgICAgICAgICAg
IGNvbnRpbnVlOwogICAgICAgICB9CiAKLSAgICAgICAgd2hpbGUgKCBhdmFpbCAmJiAoYnVmW3Nl
bnRdICE9ICdcMCcgfHwgcHV0X3IpICkKKyAgICAgICAgd2hpbGUgKCBhdmFpbCAmJiAoc2VudCA8
IG5yIHx8IHB1dF9yKSApCiAgICAgICAgIHsKICAgICAgICAgICAgIGlmICggcHV0X3IgKQogICAg
ICAgICAgICAgewpAQCAtMTg1LDcgKzE4NSw3IEBAIHN0YXRpYyBzaXplX3QgcHZfcmluZ19wdXRz
KGNvbnN0IGNoYXIgKmJ1ZikKICAgICByZXR1cm4gc2VudDsKIH0KIAotdm9pZCBwdl9jb25zb2xl
X3B1dHMoY29uc3QgY2hhciAqYnVmKQordm9pZCBwdl9jb25zb2xlX3B1dHMoY29uc3QgY2hhciAq
YnVmLCBzaXplX3QgbnIpCiB7CiAgICAgdW5zaWduZWQgbG9uZyBmbGFnczsKIApAQCAtMTkzLDcg
KzE5Myw3IEBAIHZvaWQgcHZfY29uc29sZV9wdXRzKGNvbnN0IGNoYXIgKmJ1ZikKICAgICAgICAg
cmV0dXJuOwogCiAgICAgc3Bpbl9sb2NrX2lycXNhdmUoJnR4X2xvY2ssIGZsYWdzKTsKLSAgICBw
dl9yaW5nX3B1dHMoYnVmKTsKKyAgICBwdl9yaW5nX3B1dHMoYnVmLCBucik7CiAgICAgc3Bpbl91
bmxvY2tfaXJxcmVzdG9yZSgmdHhfbG9jaywgZmxhZ3MpOwogfQogCmRpZmYgLS1naXQgYS94ZW4v
ZHJpdmVycy92aWRlby9sZmIuYyBiL3hlbi9kcml2ZXJzL3ZpZGVvL2xmYi5jCmluZGV4IDUwMjIx
OTVhZTUuLjc1Yjc0OWIzMzAgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL3ZpZGVvL2xmYi5jCisr
KyBiL3hlbi9kcml2ZXJzL3ZpZGVvL2xmYi5jCkBAIC01MywxNCArNTMsMTUgQEAgc3RhdGljIHZv
aWQgbGZiX3Nob3dfbGluZSgKIH0KIAogLyogRmFzdCBtb2RlIHdoaWNoIHJlZHJhd3MgYWxsIG1v
ZGlmaWVkIHBhcnRzIG9mIGEgMkQgdGV4dCBidWZmZXIuICovCi12b2lkIGxmYl9yZWRyYXdfcHV0
cyhjb25zdCBjaGFyICpzKQordm9pZCBsZmJfcmVkcmF3X3B1dHMoY29uc3QgY2hhciAqcywgc2l6
ZV90IG5yKQogewogICAgIHVuc2lnbmVkIGludCBpLCBtaW5fcmVkcmF3X3kgPSBsZmIueXBvczsK
LSAgICBjaGFyIGM7CiAKICAgICAvKiBQYXN0ZSBjaGFyYWN0ZXJzIGludG8gdGV4dCBidWZmZXIu
ICovCi0gICAgd2hpbGUgKCAoYyA9ICpzKyspICE9ICdcMCcgKQorICAgIGZvciAoIDsgbnIgPiAw
OyBuci0tLCBzKysgKQogICAgIHsKKyAgICAgICAgY2hhciBjID0gKnM7CisKICAgICAgICAgaWYg
KCAoYyA9PSAnXG4nKSB8fCAobGZiLnhwb3MgPj0gbGZiLmxmYnAudGV4dF9jb2x1bW5zKSApCiAg
ICAgICAgIHsKICAgICAgICAgICAgIGlmICggKytsZmIueXBvcyA+PSBsZmIubGZicC50ZXh0X3Jv
d3MgKQpAQCAtOTcsMTMgKzk4LDE0IEBAIHZvaWQgbGZiX3JlZHJhd19wdXRzKGNvbnN0IGNoYXIg
KnMpCiB9CiAKIC8qIFNsb3dlciBsaW5lLWJhc2VkIHNjcm9sbCBtb2RlIHdoaWNoIGludGVyYWN0
cyBiZXR0ZXIgd2l0aCBkb20wLiAqLwotdm9pZCBsZmJfc2Nyb2xsX3B1dHMoY29uc3QgY2hhciAq
cykKK3ZvaWQgbGZiX3Njcm9sbF9wdXRzKGNvbnN0IGNoYXIgKnMsIHNpemVfdCBucikKIHsKICAg
ICB1bnNpZ25lZCBpbnQgaTsKLSAgICBjaGFyIGM7CiAKLSAgICB3aGlsZSAoIChjID0gKnMrKykg
IT0gJ1wwJyApCisgICAgZm9yICggOyBuciA+IDA7IG5yLS0sIHMrKyApCiAgICAgeworICAgICAg
ICBjaGFyIGMgPSAqczsKKwogICAgICAgICBpZiAoIChjID09ICdcbicpIHx8IChsZmIueHBvcyA+
PSBsZmIubGZicC50ZXh0X2NvbHVtbnMpICkKICAgICAgICAgewogICAgICAgICAgICAgdW5zaWdu
ZWQgaW50IGJ5dGVzID0gKGxmYi5sZmJwLndpZHRoICoKZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJz
L3ZpZGVvL2xmYi5oIGIveGVuL2RyaXZlcnMvdmlkZW8vbGZiLmgKaW5kZXggYWM0MGE2NjM3OS4u
ZTc0M2NjZGQ2YiAxMDA2NDQKLS0tIGEveGVuL2RyaXZlcnMvdmlkZW8vbGZiLmgKKysrIGIveGVu
L2RyaXZlcnMvdmlkZW8vbGZiLmgKQEAgLTM1LDggKzM1LDggQEAgc3RydWN0IGxmYl9wcm9wIHsK
ICAgICB1bnNpZ25lZCBpbnQgdGV4dF9yb3dzOwogfTsKIAotdm9pZCBsZmJfcmVkcmF3X3B1dHMo
Y29uc3QgY2hhciAqcyk7Ci12b2lkIGxmYl9zY3JvbGxfcHV0cyhjb25zdCBjaGFyICpzKTsKK3Zv
aWQgbGZiX3JlZHJhd19wdXRzKGNvbnN0IGNoYXIgKnMsIHNpemVfdCBucik7Cit2b2lkIGxmYl9z
Y3JvbGxfcHV0cyhjb25zdCBjaGFyICpzLCBzaXplX3QgbnIpOwogdm9pZCBsZmJfY2FycmlhZ2Vf
cmV0dXJuKHZvaWQpOwogdm9pZCBsZmJfZnJlZSh2b2lkKTsKIApkaWZmIC0tZ2l0IGEveGVuL2Ry
aXZlcnMvdmlkZW8vdmdhLmMgYi94ZW4vZHJpdmVycy92aWRlby92Z2EuYwppbmRleCA0NTQ0NTdh
ZGU4Li42NjZmMmUyNTA5IDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy92aWRlby92Z2EuYworKysg
Yi94ZW4vZHJpdmVycy92aWRlby92Z2EuYwpAQCAtMTgsOSArMTgsOSBAQCBzdGF0aWMgaW50IHZn
YWNvbl9rZWVwOwogc3RhdGljIHVuc2lnbmVkIGludCB4cG9zLCB5cG9zOwogc3RhdGljIHVuc2ln
bmVkIGNoYXIgKnZpZGVvOwogCi1zdGF0aWMgdm9pZCB2Z2FfdGV4dF9wdXRzKGNvbnN0IGNoYXIg
KnMpOwotc3RhdGljIHZvaWQgdmdhX25vb3BfcHV0cyhjb25zdCBjaGFyICpzKSB7fQotdm9pZCAo
KnZpZGVvX3B1dHMpKGNvbnN0IGNoYXIgKikgPSB2Z2Ffbm9vcF9wdXRzOworc3RhdGljIHZvaWQg
dmdhX3RleHRfcHV0cyhjb25zdCBjaGFyICpzLCBzaXplX3QgbnIpOworc3RhdGljIHZvaWQgdmdh
X25vb3BfcHV0cyhjb25zdCBjaGFyICpzLCBzaXplX3QgbnIpIHt9Cit2b2lkICgqdmlkZW9fcHV0
cykoY29uc3QgY2hhciAqLCBzaXplX3QgbnIpID0gdmdhX25vb3BfcHV0czsKIAogLyoKICAqICd2
Z2E9PG1vZGUtc3BlY2lmaWVyPlssa2VlcF0nIHdoZXJlIDxtb2RlLXNwZWNpZmllcj4gaXMgb25l
IG9mOgpAQCAtMTc0LDEyICsxNzQsMTIgQEAgdm9pZCBfX2luaXQgdmlkZW9fZW5kYm9vdCh2b2lk
KQogICAgIH0KIH0KIAotc3RhdGljIHZvaWQgdmdhX3RleHRfcHV0cyhjb25zdCBjaGFyICpzKQor
c3RhdGljIHZvaWQgdmdhX3RleHRfcHV0cyhjb25zdCBjaGFyICpzLCBzaXplX3QgbnIpCiB7Ci0g
ICAgY2hhciBjOwotCi0gICAgd2hpbGUgKCAoYyA9ICpzKyspICE9ICdcMCcgKQorICAgIGZvciAo
IDsgbnIgPiAwOyBuci0tLCBzKysgKQogICAgIHsKKyAgICAgICAgY2hhciBjID0gKnM7CisKICAg
ICAgICAgaWYgKCAoYyA9PSAnXG4nKSB8fCAoeHBvcyA+PSBjb2x1bW5zKSApCiAgICAgICAgIHsK
ICAgICAgICAgICAgIGlmICggKyt5cG9zID49IGxpbmVzICkKZGlmZiAtLWdpdCBhL3hlbi9pbmNs
dWRlL3hlbi9jb25zb2xlLmggYi94ZW4vaW5jbHVkZS94ZW4vY29uc29sZS5oCmluZGV4IGI0Zjk0
NjM5MzYuLmJhOTE0ZjllNWIgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL3hlbi9jb25zb2xlLmgK
KysrIGIveGVuL2luY2x1ZGUveGVuL2NvbnNvbGUuaApAQCAtMzgsNyArMzgsNyBAQCBzdHJ1Y3Qg
ZG9tYWluICpjb25zb2xlX2lucHV0X2RvbWFpbih2b2lkKTsKICAqIFN0ZWFsIG91dHB1dCBmcm9t
IHRoZSBjb25zb2xlLiBSZXR1cm5zICt2ZSBpZGVudGlmaWVyLCBlbHNlIC12ZSBlcnJvci4KICAq
IFRha2VzIHRoZSBoYW5kbGUgb2YgdGhlIHNlcmlhbCBsaW5lIHRvIHN0ZWFsLCBhbmQgc3RlYWwg
Y2FsbGJhY2sgZnVuY3Rpb24uCiAgKi8KLWludCBjb25zb2xlX3N0ZWFsKGludCBoYW5kbGUsIHZv
aWQgKCpmbikoY29uc3QgY2hhciAqKSk7CitpbnQgY29uc29sZV9zdGVhbChpbnQgaGFuZGxlLCB2
b2lkICgqZm4pKGNvbnN0IGNoYXIgKiwgc2l6ZV90IG5yKSk7CiAKIC8qIEdpdmUgYmFjayBzdG9s
ZW4gY29uc29sZS4gVGFrZXMgdGhlIGlkZW50aWZpZXIgcmV0dXJuZWQgYnkgY29uc29sZV9zdGVh
bC4gKi8KIHZvaWQgY29uc29sZV9naXZlYmFjayhpbnQgaWQpOwpkaWZmIC0tZ2l0IGEveGVuL2lu
Y2x1ZGUveGVuL2Vhcmx5X3ByaW50ay5oIGIveGVuL2luY2x1ZGUveGVuL2Vhcmx5X3ByaW50ay5o
CmluZGV4IDJjM2UxYjM1MTkuLjBmNzZjM2E3NGYgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL3hl
bi9lYXJseV9wcmludGsuaAorKysgYi94ZW4vaW5jbHVkZS94ZW4vZWFybHlfcHJpbnRrLmgKQEAg
LTUsNyArNSw3IEBACiAjZGVmaW5lIF9fWEVOX0VBUkxZX1BSSU5US19IX18KIAogI2lmZGVmIENP
TkZJR19FQVJMWV9QUklOVEsKLXZvaWQgZWFybHlfcHV0cyhjb25zdCBjaGFyICpzKTsKK3ZvaWQg
ZWFybHlfcHV0cyhjb25zdCBjaGFyICpzLCBzaXplX3QgbnIpOwogI2Vsc2UKICNkZWZpbmUgZWFy
bHlfcHV0cyBOVUxMCiAjZW5kaWYKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL3hlbi9wdl9jb25z
b2xlLmggYi94ZW4vaW5jbHVkZS94ZW4vcHZfY29uc29sZS5oCmluZGV4IGNiOTI1Mzk2NjYuLjQ3
NDVmNDZmMmQgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL3hlbi9wdl9jb25zb2xlLmgKKysrIGIv
eGVuL2luY2x1ZGUveGVuL3B2X2NvbnNvbGUuaApAQCAtOCw3ICs4LDcgQEAKIHZvaWQgcHZfY29u
c29sZV9pbml0KHZvaWQpOwogdm9pZCBwdl9jb25zb2xlX3NldF9yeF9oYW5kbGVyKHNlcmlhbF9y
eF9mbiBmbik7CiB2b2lkIHB2X2NvbnNvbGVfaW5pdF9wb3N0aXJxKHZvaWQpOwotdm9pZCBwdl9j
b25zb2xlX3B1dHMoY29uc3QgY2hhciAqYnVmKTsKK3ZvaWQgcHZfY29uc29sZV9wdXRzKGNvbnN0
IGNoYXIgKmJ1Ziwgc2l6ZV90IG5yKTsKIHNpemVfdCBwdl9jb25zb2xlX3J4KHN0cnVjdCBjcHVf
dXNlcl9yZWdzICpyZWdzKTsKIGV2dGNobl9wb3J0X3QgcHZfY29uc29sZV9ldnRjaG4odm9pZCk7
CiAKQEAgLTE3LDcgKzE3LDcgQEAgZXZ0Y2huX3BvcnRfdCBwdl9jb25zb2xlX2V2dGNobih2b2lk
KTsKIHN0YXRpYyBpbmxpbmUgdm9pZCBwdl9jb25zb2xlX2luaXQodm9pZCkge30KIHN0YXRpYyBp
bmxpbmUgdm9pZCBwdl9jb25zb2xlX3NldF9yeF9oYW5kbGVyKHNlcmlhbF9yeF9mbiBmbikgeyB9
CiBzdGF0aWMgaW5saW5lIHZvaWQgcHZfY29uc29sZV9pbml0X3Bvc3RpcnEodm9pZCkgeyB9Ci1z
dGF0aWMgaW5saW5lIHZvaWQgcHZfY29uc29sZV9wdXRzKGNvbnN0IGNoYXIgKmJ1ZikgeyB9Citz
dGF0aWMgaW5saW5lIHZvaWQgcHZfY29uc29sZV9wdXRzKGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90
IG5yKSB7IH0KIHN0YXRpYyBpbmxpbmUgc2l6ZV90IHB2X2NvbnNvbGVfcngoc3RydWN0IGNwdV91
c2VyX3JlZ3MgKnJlZ3MpIHsgcmV0dXJuIDA7IH0KIGV2dGNobl9wb3J0X3QgcHZfY29uc29sZV9l
dnRjaG4odm9pZCkKIHsKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL3hlbi9zZXJpYWwuaCBiL3hl
bi9pbmNsdWRlL3hlbi9zZXJpYWwuaAppbmRleCBmMjk5NGQ0MDkzLi42NTQ4ZjBiMGE5IDEwMDY0
NAotLS0gYS94ZW4vaW5jbHVkZS94ZW4vc2VyaWFsLmgKKysrIGIveGVuL2luY2x1ZGUveGVuL3Nl
cmlhbC5oCkBAIC0xMTQsOCArMTE0LDggQEAgaW50IHNlcmlhbF9wYXJzZV9oYW5kbGUoY2hhciAq
Y29uZik7CiAvKiBUcmFuc21pdCBhIHNpbmdsZSBjaGFyYWN0ZXIgdmlhIHRoZSBzcGVjaWZpZWQg
Q09NIHBvcnQuICovCiB2b2lkIHNlcmlhbF9wdXRjKGludCBoYW5kbGUsIGNoYXIgYyk7CiAKLS8q
IFRyYW5zbWl0IGEgTlVMTC10ZXJtaW5hdGVkIHN0cmluZyB2aWEgdGhlIHNwZWNpZmllZCBDT00g
cG9ydC4gKi8KLXZvaWQgc2VyaWFsX3B1dHMoaW50IGhhbmRsZSwgY29uc3QgY2hhciAqcyk7Cisv
KiBUcmFuc21pdCBhIHN0cmluZyB2aWEgdGhlIHNwZWNpZmllZCBDT00gcG9ydC4gKi8KK3ZvaWQg
c2VyaWFsX3B1dHMoaW50IGhhbmRsZSwgY29uc3QgY2hhciAqcywgc2l6ZV90IG5yKTsKIAogLyoK
ICAqIEFuIGFsdGVybmF0aXZlIHRvIHJlZ2lzdGVyaW5nIGEgY2hhcmFjdGVyLXJlY2VpdmUgaG9v
ay4gVGhpcyBmdW5jdGlvbgpkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUveGVuL3ZpZGVvLmggYi94
ZW4vaW5jbHVkZS94ZW4vdmlkZW8uaAppbmRleCAyZTg5N2Y5ZGY1Li45MDVmMzMxMTEyIDEwMDY0
NAotLS0gYS94ZW4vaW5jbHVkZS94ZW4vdmlkZW8uaAorKysgYi94ZW4vaW5jbHVkZS94ZW4vdmlk
ZW8uaApAQCAtMTMsMTEgKzEzLDExIEBACiAKICNpZmRlZiBDT05GSUdfVklERU8KIHZvaWQgdmlk
ZW9faW5pdCh2b2lkKTsKLWV4dGVybiB2b2lkICgqdmlkZW9fcHV0cykoY29uc3QgY2hhciAqKTsK
K2V4dGVybiB2b2lkICgqdmlkZW9fcHV0cykoY29uc3QgY2hhciAqLCBzaXplX3QgbnIpOwogdm9p
ZCB2aWRlb19lbmRib290KHZvaWQpOwogI2Vsc2UKICNkZWZpbmUgdmlkZW9faW5pdCgpICAgICgo
dm9pZCkwKQotI2RlZmluZSB2aWRlb19wdXRzKHMpICAgKCh2b2lkKTApCisjZGVmaW5lIHZpZGVv
X3B1dHMocywgbnIpICAgKCh2b2lkKTApCiAjZGVmaW5lIHZpZGVvX2VuZGJvb3QoKSAoKHZvaWQp
MCkKICNlbmRpZgogCi0tIAoyLjExLjAKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54
ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGlu
Zm8veGVuLWRldmVs

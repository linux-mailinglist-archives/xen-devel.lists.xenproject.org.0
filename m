Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id BC8452C46A
	for <lists+xen-devel@lfdr.de>; Tue, 28 May 2019 12:36:11 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hVZQ4-0004ZS-7m; Tue, 28 May 2019 10:33:24 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=31/0=T4=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1hVZQ1-0004XR-Sc
 for xen-devel@lists.xenproject.org; Tue, 28 May 2019 10:33:21 +0000
X-Inumbo-ID: 030b03f4-8134-11e9-8980-bc764e045a96
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 030b03f4-8134-11e9-8980-bc764e045a96;
 Tue, 28 May 2019 10:33:20 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id DCF46B00E;
 Tue, 28 May 2019 10:33:17 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Tue, 28 May 2019 12:32:20 +0200
Message-Id: <20190528103313.1343-8-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190528103313.1343-1-jgross@suse.com>
References: <20190528103313.1343-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH 07/60] xen/sched: build a linked list of struct
 sched_unit
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Tim Deegan <tim@xen.org>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Dario Faggioli <dfaggioli@suse.com>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SW4gb3JkZXIgdG8gbWFrZSBpdCBlYXN5IHRvIGl0ZXJhdGUgb3ZlciBzY2hlZF91bml0IGVsZW1l
bnRzIG9mIGEKZG9tYWluIGJ1aWxkIGEgc2luZ2xlIGxpbmtlZCBsaXN0IGFuZCBhZGQgYW4gaXRl
cmF0b3IgZm9yIGl0LiBUaGUgbmV3Cmxpc3QgaXMgZ3VhcmRlZCBieSB0aGUgc2FtZSBtZWNoYW5p
c21zIGFzIHRoZSB2Y3B1IGxpbmtlZCBsaXN0IGFzIGl0CmlzIG1vZGlmaWVkIG9ubHkgdmlhIHZj
cHVfY3JlYXRlKCkgb3IgdmNwdV9kZXN0cm95KCkuCgpGb3IgY29tcGxldGVuZXNzIGFkZCBhbm90
aGVyIGl0ZXJhdG9yIGZvcl9lYWNoX3NjaGVkX3VuaXRfdmNwdSgpIHdoaWNoCndpbGwgaXRlcmF0
ZSBvdmVyIGFsbCB2Y3B1cyBpZiBhIHNjaGVkX3VuaXQgKHJpZ2h0IG5vdyBvbmx5IG9uZSkuIFRo
aXMKd2lsbCBiZSBuZWVkZWQgbGF0ZXIgZm9yIGxhcmdlciBzY2hlZHVsaW5nIGdyYW51bGFyaXR5
IChlLmcuIGNvcmVzKS4KClNpZ25lZC1vZmYtYnk6IEp1ZXJnZW4gR3Jvc3MgPGpncm9zc0BzdXNl
LmNvbT4KLS0tCiB4ZW4vY29tbW9uL3NjaGVkdWxlLmMgICB8IDU2ICsrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0KIHhlbi9pbmNsdWRlL3hlbi9zY2hlZC5o
IHwgIDkgKysrKysrKysKIDIgZmlsZXMgY2hhbmdlZCwgNTggaW5zZXJ0aW9ucygrKSwgNyBkZWxl
dGlvbnMoLSkKCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3NjaGVkdWxlLmMgYi94ZW4vY29tbW9u
L3NjaGVkdWxlLmMKaW5kZXggODZhNDNmNzE5Mi4uNDlkMjU0ODllZiAxMDA2NDQKLS0tIGEveGVu
L2NvbW1vbi9zY2hlZHVsZS5jCisrKyBiL3hlbi9jb21tb24vc2NoZWR1bGUuYwpAQCAtMjQ5LDYg
KzI0OSw1MiBAQCBzdGF0aWMgdm9pZCBzY2hlZF9zcGluX3VubG9ja19kb3VibGUoc3BpbmxvY2tf
dCAqbG9jazEsIHNwaW5sb2NrX3QgKmxvY2syLAogICAgIHNwaW5fdW5sb2NrX2lycXJlc3RvcmUo
bG9jazEsIGZsYWdzKTsKIH0KIAorc3RhdGljIHZvaWQgc2NoZWRfZnJlZV91bml0KHN0cnVjdCBz
Y2hlZF91bml0ICp1bml0KQoreworICAgIHN0cnVjdCBzY2hlZF91bml0ICpwcmV2X3VuaXQ7Cisg
ICAgc3RydWN0IGRvbWFpbiAqZCA9IHVuaXQtPnZjcHUtPmRvbWFpbjsKKworICAgIGlmICggZC0+
c2NoZWRfdW5pdF9saXN0ID09IHVuaXQgKQorICAgICAgICBkLT5zY2hlZF91bml0X2xpc3QgPSB1
bml0LT5uZXh0X2luX2xpc3Q7CisgICAgZWxzZQorICAgIHsKKyAgICAgICAgZm9yX2VhY2hfc2No
ZWRfdW5pdCAoIGQsIHByZXZfdW5pdCApCisgICAgICAgIHsKKyAgICAgICAgICAgIGlmICggcHJl
dl91bml0LT5uZXh0X2luX2xpc3QgPT0gdW5pdCApCisgICAgICAgICAgICB7CisgICAgICAgICAg
ICAgICAgcHJldl91bml0LT5uZXh0X2luX2xpc3QgPSB1bml0LT5uZXh0X2luX2xpc3Q7CisgICAg
ICAgICAgICAgICAgYnJlYWs7CisgICAgICAgICAgICB9CisgICAgICAgIH0KKyAgICB9CisKKyAg
ICB1bml0LT52Y3B1LT5zY2hlZF91bml0ID0gTlVMTDsKKyAgICB4ZnJlZSh1bml0KTsKK30KKwor
c3RhdGljIHN0cnVjdCBzY2hlZF91bml0ICpzY2hlZF9hbGxvY191bml0KHN0cnVjdCB2Y3B1ICp2
KQoreworICAgIHN0cnVjdCBzY2hlZF91bml0ICp1bml0LCAqKnByZXZfdW5pdDsKKyAgICBzdHJ1
Y3QgZG9tYWluICpkID0gdi0+ZG9tYWluOworCisgICAgaWYgKCAodW5pdCA9IHh6YWxsb2Moc3Ry
dWN0IHNjaGVkX3VuaXQpKSA9PSBOVUxMICkKKyAgICAgICAgcmV0dXJuIE5VTEw7CisKKyAgICB2
LT5zY2hlZF91bml0ID0gdW5pdDsKKyAgICB1bml0LT52Y3B1ID0gdjsKKworICAgIGZvciAoIHBy
ZXZfdW5pdCA9ICZkLT5zY2hlZF91bml0X2xpc3Q7ICpwcmV2X3VuaXQ7CisgICAgICAgICAgcHJl
dl91bml0ID0gJigqcHJldl91bml0KS0+bmV4dF9pbl9saXN0ICkKKyAgICAgICAgaWYgKCAoKnBy
ZXZfdW5pdCktPm5leHRfaW5fbGlzdCAmJgorICAgICAgICAgICAgICgqcHJldl91bml0KS0+bmV4
dF9pbl9saXN0LT52Y3B1LT52Y3B1X2lkID4gdi0+dmNwdV9pZCApCisgICAgICAgICAgICBicmVh
azsKKworICAgIHVuaXQtPm5leHRfaW5fbGlzdCA9ICpwcmV2X3VuaXQ7CisgICAgKnByZXZfdW5p
dCA9IHVuaXQ7CisKKyAgICByZXR1cm4gdW5pdDsKK30KKwogaW50IHNjaGVkX2luaXRfdmNwdShz
dHJ1Y3QgdmNwdSAqdiwgdW5zaWduZWQgaW50IHByb2Nlc3NvcikKIHsKICAgICBzdHJ1Y3QgZG9t
YWluICpkID0gdi0+ZG9tYWluOwpAQCAtMjU2LDEwICszMDIsOCBAQCBpbnQgc2NoZWRfaW5pdF92
Y3B1KHN0cnVjdCB2Y3B1ICp2LCB1bnNpZ25lZCBpbnQgcHJvY2Vzc29yKQogCiAgICAgdi0+cHJv
Y2Vzc29yID0gcHJvY2Vzc29yOwogCi0gICAgaWYgKCAodW5pdCA9IHh6YWxsb2Moc3RydWN0IHNj
aGVkX3VuaXQpKSA9PSBOVUxMICkKKyAgICBpZiAoICh1bml0ID0gc2NoZWRfYWxsb2NfdW5pdCh2
KSkgPT0gTlVMTCApCiAgICAgICAgIHJldHVybiAxOwotICAgIHYtPnNjaGVkX3VuaXQgPSB1bml0
OwotICAgIHVuaXQtPnZjcHUgPSB2OwogCiAgICAgLyogSW5pdGlhbGlzZSB0aGUgcGVyLXZjcHUg
dGltZXJzLiAqLwogICAgIGluaXRfdGltZXIoJnYtPnBlcmlvZGljX3RpbWVyLCB2Y3B1X3Blcmlv
ZGljX3RpbWVyX2ZuLApAQCAtMjcyLDggKzMxNiw3IEBAIGludCBzY2hlZF9pbml0X3ZjcHUoc3Ry
dWN0IHZjcHUgKnYsIHVuc2lnbmVkIGludCBwcm9jZXNzb3IpCiAgICAgdW5pdC0+cHJpdiA9IHNj
aGVkX2FsbG9jX3ZkYXRhKGRvbV9zY2hlZHVsZXIoZCksIHVuaXQsIGQtPnNjaGVkX3ByaXYpOwog
ICAgIGlmICggdW5pdC0+cHJpdiA9PSBOVUxMICkKICAgICB7Ci0gICAgICAgIHYtPnNjaGVkX3Vu
aXQgPSBOVUxMOwotICAgICAgICB4ZnJlZSh1bml0KTsKKyAgICAgICAgc2NoZWRfZnJlZV91bml0
KHVuaXQpOwogICAgICAgICByZXR1cm4gMTsKICAgICB9CiAKQEAgLTQxNiw4ICs0NTksNyBAQCB2
b2lkIHNjaGVkX2Rlc3Ryb3lfdmNwdShzdHJ1Y3QgdmNwdSAqdikKICAgICAgICAgYXRvbWljX2Rl
YygmcGVyX2NwdShzY2hlZHVsZV9kYXRhLCB2LT5wcm9jZXNzb3IpLnVyZ2VudF9jb3VudCk7CiAg
ICAgc2NoZWRfcmVtb3ZlX3VuaXQodmNwdV9zY2hlZHVsZXIodiksIHVuaXQpOwogICAgIHNjaGVk
X2ZyZWVfdmRhdGEodmNwdV9zY2hlZHVsZXIodiksIHVuaXQtPnByaXYpOwotICAgIHhmcmVlKHVu
aXQpOwotICAgIHYtPnNjaGVkX3VuaXQgPSBOVUxMOworICAgIHNjaGVkX2ZyZWVfdW5pdCh1bml0
KTsKIH0KIAogaW50IHNjaGVkX2luaXRfZG9tYWluKHN0cnVjdCBkb21haW4gKmQsIGludCBwb29s
aWQpCmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaCBiL3hlbi9pbmNsdWRlL3hl
bi9zY2hlZC5oCmluZGV4IGY1NDlhZDYwZDEuLjRkYTFhYjIwMWQgMTAwNjQ0Ci0tLSBhL3hlbi9p
bmNsdWRlL3hlbi9zY2hlZC5oCisrKyBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCkBAIC0yNzks
OCArMjc5LDE2IEBAIHN0cnVjdCB2Y3B1CiBzdHJ1Y3Qgc2NoZWRfdW5pdCB7CiAgICAgc3RydWN0
IHZjcHUgICAgICAgICAgICp2Y3B1OwogICAgIHZvaWQgICAgICAgICAgICAgICAgICAqcHJpdjsg
ICAgICAvKiBzY2hlZHVsZXIgcHJpdmF0ZSBkYXRhICovCisgICAgc3RydWN0IHNjaGVkX3VuaXQg
ICAgICpuZXh0X2luX2xpc3Q7CiB9OwogCisjZGVmaW5lIGZvcl9lYWNoX3NjaGVkX3VuaXQoZCwg
ZSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwKKyAgICBmb3IgKCAo
ZSkgPSAoZCktPnNjaGVkX3VuaXRfbGlzdDsgKGUpICE9IE5VTEw7IChlKSA9IChlKS0+bmV4dF9p
bl9saXN0ICkKKworI2RlZmluZSBmb3JfZWFjaF9zY2hlZF91bml0X3ZjcHUoaSwgdikgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCisgICAgZm9yICggKHYpID0gKGkpLT52Y3B1
OyAodikgIT0gTlVMTCAmJiAodiktPnNjaGVkX3VuaXQgPT0gKGkpOyAgICAgICAgIFwKKyAgICAg
ICAgICAodikgPSAodiktPm5leHRfaW5fbGlzdCApCisKIC8qIFBlci1kb21haW4gbG9jayBjYW4g
YmUgcmVjdXJzaXZlbHkgYWNxdWlyZWQgaW4gZmF1bHQgaGFuZGxlcnMuICovCiAjZGVmaW5lIGRv
bWFpbl9sb2NrKGQpIHNwaW5fbG9ja19yZWN1cnNpdmUoJihkKS0+ZG9tYWluX2xvY2spCiAjZGVm
aW5lIGRvbWFpbl91bmxvY2soZCkgc3Bpbl91bmxvY2tfcmVjdXJzaXZlKCYoZCktPmRvbWFpbl9s
b2NrKQpAQCAtMzM5LDYgKzM0Nyw3IEBAIHN0cnVjdCBkb21haW4KIAogICAgIC8qIFNjaGVkdWxp
bmcuICovCiAgICAgdm9pZCAgICAgICAgICAgICpzY2hlZF9wcml2OyAgICAvKiBzY2hlZHVsZXIt
c3BlY2lmaWMgZGF0YSAqLworICAgIHN0cnVjdCBzY2hlZF91bml0ICpzY2hlZF91bml0X2xpc3Q7
CiAgICAgc3RydWN0IGNwdXBvb2wgICpjcHVwb29sOwogCiAgICAgc3RydWN0IGRvbWFpbiAgICpu
ZXh0X2luX2xpc3Q7Ci0tIAoyLjE2LjQKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54
ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGlu
Zm8veGVuLWRldmVs

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id C12E9CDBE2
	for <lists+xen-devel@lfdr.de>; Mon,  7 Oct 2019 08:39:25 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iHMcA-0000Xk-4l; Mon, 07 Oct 2019 06:35:26 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=d412=YA=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1iHMc8-0000Xf-1g
 for xen-devel@lists.xenproject.org; Mon, 07 Oct 2019 06:35:24 +0000
X-Inumbo-ID: a32b8984-e8cc-11e9-97a3-12813bfff9fa
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id a32b8984-e8cc-11e9-97a3-12813bfff9fa;
 Mon, 07 Oct 2019 06:35:22 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 7B1AEAB98;
 Mon,  7 Oct 2019 06:35:21 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Mon,  7 Oct 2019 08:35:19 +0200
Message-Id: <20191007063519.2912-1-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
Subject: [Xen-devel] [PATCH v2] xen/sched: let credit scheduler control its
 timer all alone
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Tim Deegan <tim@xen.org>,
 Stefano Stabellini <sstabellini@kernel.org>, Julien Grall <julien@xen.org>,
 Wei Liu <wl@xen.org>, Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>,
 Robert VanVossen <robert.vanvossen@dornerworks.com>,
 Dario Faggioli <dfaggioli@suse.com>,
 Josh Whitehead <josh.whitehead@dornerworks.com>,
 Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhlIGNyZWRpdCBzY2hlZHVsZXIgaXMgdGhlIG9ubHkgc2NoZWR1bGVyIHdpdGggdGlja19zdXNw
ZW5kIGFuZAp0aWNrX3Jlc3VtZSBjYWxsYmFja3MuIFRvZGF5IHRob3NlIGNhbGxiYWNrcyBhcmUg
aW52b2tlZCB3aXRob3V0IGJlaW5nCmd1YXJkZWQgYnkgdGhlIHNjaGVkdWxlciBsb2NrIHdoaWNo
IGlzIGNyaXRpY2FsIHdoZW4gYXQgdGhlIHNhbWUgdGhlCmNwdSB0aG9zZSBjYWxsYmFja3MgYXJl
IGFjdGl2ZSBpcyBiZWluZyBtb3ZlZCB0byBvciBmcm9tIGEgY3B1cG9vbC4KCkNyYXNoZXMgbGlr
ZSB0aGUgZm9sbG93aW5nIGFyZSBwb3NzaWJsZSBkdWUgdG8gdGhhdCByYWNlOgoKKFhFTikgLS0t
LVsgWGVuLTQuMTMuMC04LjAuMTItZCAgeDg2XzY0ICBkZWJ1Zz15ICAgTm90IHRhaW50ZWQgXS0t
LS0KKFhFTikgQ1BVOiAgICA3OQooWEVOKSBSSVA6ICAgIGUwMDg6WzxmZmZmODJkMDgwMjQ2N2Rj
Pl0gc2V0X3RpbWVyKzB4MzkvMHgxZjcKKFhFTikgUkZMQUdTOiAwMDAwMDAwMDAwMDEwMDAyICAg
Q09OVEVYVDogaHlwZXJ2aXNvcgo8c25pcD4KKFhFTikgWGVuIGNhbGwgdHJhY2U6CihYRU4pICAg
IFs8ZmZmZjgyZDA4MDI0NjdkYz5dIHNldF90aW1lcisweDM5LzB4MWY3CihYRU4pICAgIFs8ZmZm
ZjgyZDA4MDIyYzFmND5dCnNjaGVkX2NyZWRpdC5jI2NzY2hlZF90aWNrX3Jlc3VtZSsweDU0LzB4
NTkKKFhFTikgICAgWzxmZmZmODJkMDgwMjQxZGZlPl0gc2NoZWRfdGlja19yZXN1bWUrMHg2Ny8w
eDg2CihYRU4pICAgIFs8ZmZmZjgyZDA4MDJlZGE1Mj5dIG13YWl0LWlkbGUuYyNtd2FpdF9pZGxl
KzB4MzJiLzB4MzU3CihYRU4pICAgIFs8ZmZmZjgyZDA4MDI3OTM5ZT5dIGRvbWFpbi5jI2lkbGVf
bG9vcCsweGE2LzB4YzIKKFhFTikKKFhFTikgUGFnZXRhYmxlIHdhbGsgZnJvbSAwMDAwMDAwMDAw
MDAwMDQ4OgooWEVOKSAgTDRbMHgwMDBdID0gMDAwMDAwODJjZmI5YzA2MyBmZmZmZmZmZmZmZmZm
ZmZmCihYRU4pICBMM1sweDAwMF0gPSAwMDAwMDA4MmNmYjliMDYzIGZmZmZmZmZmZmZmZmZmZmYK
KFhFTikgIEwyWzB4MDAwXSA9IDAwMDAwMDgyY2ZiOWEwNjMgZmZmZmZmZmZmZmZmZmZmZgooWEVO
KSAgTDFbMHgwMDBdID0gMDAwMDAwMDAwMDAwMDAwMCBmZmZmZmZmZmZmZmZmZmZmCihYRU4pCihY
RU4pICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKKFhFTikgUGFuaWMg
b24gQ1BVIDc5OgooWEVOKSBGQVRBTCBQQUdFIEZBVUxUCihYRU4pIFtlcnJvcl9jb2RlPTAwMDBd
CihYRU4pIEZhdWx0aW5nIGxpbmVhciBhZGRyZXNzOiAwMDAwMDAwMDAwMDAwMDQ4CihYRU4pICoq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKClRoZSBjYWxsYmFja3MgYXJl
IHVzZWQgd2hlbiB0aGUgY3B1IGlzIGdvaW5nIHRvIG9yIGNvbWluZyBmcm9tIGlkbGUgaW4Kb3Jk
ZXIgdG8gYWxsb3cgaGlnaGVyIEMtc3RhdGVzLgoKVGhlIGNyZWRpdCBzY2hlZHVsZXIga25vd3Mg
d2hlbiBpdCBpcyBnb2luZyB0byBzY2hlZHVsZSBhbiBpZGxlCnNjaGVkdWxpbmcgdW5pdCBvciBh
bm90aGVyIG9uZSBhZnRlciBpZGxlLCBzbyBpdCBjYW4gZWFzaWx5IHN0b3Agb3IKcmVzdW1lIHRo
ZSB0aW1lciBpdHNlbGYgcmVtb3ZpbmcgdGhlIG5lZWQgdG8gZG8gc28gdmlhIHRoZSBjYWxsYmFj
ay4KQXMgdGhpcyB0aW1lciBoYW5kbGluZyBpcyBkb25lIGluIHRoZSBtYWluIHNjaGVkdWxpbmcg
ZnVuY3Rpb24gdGhlCnNjaGVkdWxlciBsb2NrIGlzIHN0aWxsIGhlbGQsIHNvIHRoZSByYWNlIHdp
dGggY3B1cG9vbCBvcGVyYXRpb25zIGNhbgpubyBsb25nZXIgb2NjdXIuIE5vdGUgdGhhdCBjYWxs
aW5nIHRoZSBjYWxsYmFja3MgZnJvbSBzY2hlZHVsZV9jcHVfcm0oKQphbmQgc2NoZWR1bGVfY3B1
X2FkZCgpIGlzIG5vIGxvbmdlciBuZWVkZWQsIGFzIHRoZSB0cmFuc2l0aW9ucyB0byBhbmQKZnJv
bSBpZGxlIGluIHRoZSBjcHVwb29sIHdpdGggY3JlZGl0IGFjdGl2ZSB3aWxsIGF1dG9tYXRpY2Fs
bHkgb2NjdXIKYW5kIGRvIHRoZSByaWdodCB0aGluZy4KCldpdGggdGhlIGxhc3QgdXNlciBvZiB0
aGUgY2FsbGJhY2tzIGdvbmUgdGhvc2UgY2FuIGJlIHJlbW92ZWQuCgpTdWdnZXN0ZWQtYnk6IEdl
b3JnZSBEdW5sYXAgPGdlb3JnZS5kdW5sYXBAY2l0cml4LmNvbT4KU2lnbmVkLW9mZi1ieTogSnVl
cmdlbiBHcm9zcyA8amdyb3NzQHN1c2UuY29tPgotLS0KVjI6Ci0gaW5zdGVhZCBvZiBsb2NraW5n
IGhhbmRsZSB0aW1lciBpbiBjcmVkaXQgb25seSAoR2VvcmdlIER1bmxhcCkKLS0tCiB4ZW4vY29t
bW9uL3NjaGVkX2FyaW5jNjUzLmMgfCAgMyAtLS0KIHhlbi9jb21tb24vc2NoZWRfY3JlZGl0LmMg
ICB8IDM0ICsrKysrKysrLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIHhlbi9jb21tb24vc2No
ZWR1bGUuYyAgICAgICB8IDI2ICsrLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiB4ZW4vaW5jbHVk
ZS94ZW4vc2NoZWQtaWYuaCAgfCAxNSAtLS0tLS0tLS0tLS0tLS0KIDQgZmlsZXMgY2hhbmdlZCwg
MTAgaW5zZXJ0aW9ucygrKSwgNjggZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEveGVuL2NvbW1v
bi9zY2hlZF9hcmluYzY1My5jIGIveGVuL2NvbW1vbi9zY2hlZF9hcmluYzY1My5jCmluZGV4IDQ1
YzA1YzZjZDkuLjU2NTU3NWMzMjYgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWRfYXJpbmM2
NTMuYworKysgYi94ZW4vY29tbW9uL3NjaGVkX2FyaW5jNjUzLmMKQEAgLTcyNCw5ICs3MjQsNiBA
QCBzdGF0aWMgY29uc3Qgc3RydWN0IHNjaGVkdWxlciBzY2hlZF9hcmluYzY1M19kZWYgPSB7CiAK
ICAgICAuZHVtcF9zZXR0aW5ncyAgPSBOVUxMLAogICAgIC5kdW1wX2NwdV9zdGF0ZSA9IE5VTEws
Ci0KLSAgICAudGlja19zdXNwZW5kICAgPSBOVUxMLAotICAgIC50aWNrX3Jlc3VtZSAgICA9IE5V
TEwsCiB9OwogCiBSRUdJU1RFUl9TQ0hFRFVMRVIoc2NoZWRfYXJpbmM2NTNfZGVmKTsKZGlmZiAt
LWdpdCBhL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0LmMgYi94ZW4vY29tbW9uL3NjaGVkX2NyZWRp
dC5jCmluZGV4IDMxZmRjZDZhMmYuLmZiZmZjZjM5OTYgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24v
c2NoZWRfY3JlZGl0LmMKKysrIGIveGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQuYwpAQCAtMTgzMSw2
ICsxODMxLDcgQEAgc3RhdGljIHZvaWQgY3NjaGVkX3NjaGVkdWxlKAogewogICAgIGNvbnN0IHVu
c2lnbmVkIGludCBjdXJfY3B1ID0gc21wX3Byb2Nlc3Nvcl9pZCgpOwogICAgIGNvbnN0IHVuc2ln
bmVkIGludCBzY2hlZF9jcHUgPSBzY2hlZF9nZXRfcmVzb3VyY2VfY3B1KGN1cl9jcHUpOworICAg
IHN0cnVjdCBjc2NoZWRfcGNwdSAqc3BjID0gQ1NDSEVEX1BDUFUoY3VyX2NwdSk7CiAgICAgc3Ry
dWN0IGxpc3RfaGVhZCAqIGNvbnN0IHJ1bnEgPSBSVU5RKHNjaGVkX2NwdSk7CiAgICAgc3RydWN0
IGNzY2hlZF91bml0ICogY29uc3Qgc2N1cnIgPSBDU0NIRURfVU5JVCh1bml0KTsKICAgICBzdHJ1
Y3QgY3NjaGVkX3ByaXZhdGUgKnBydiA9IENTQ0hFRF9QUklWKG9wcyk7CkBAIC0yMDAwLDYgKzIw
MDEsMTMgQEAgb3V0OgogICAgIHVuaXQtPm5leHRfdGFzayA9IHNuZXh0LT51bml0OwogICAgIHNu
ZXh0LT51bml0LT5taWdyYXRlZCA9IG1pZ3JhdGVkOwogCisgICAgLyogU3RvcCBjcmVkaXQgdGlj
ayB3aGVuIGdvaW5nIHRvIGlkbGUsIHJlc3RhcnQgaXQgd2hlbiBjb21pbmcgZnJvbSBpZGxlLiAq
LworICAgIGlmICggIWlzX2lkbGVfdW5pdCh1bml0KSAmJiBpc19pZGxlX3VuaXQodW5pdC0+bmV4
dF90YXNrKSApCisgICAgICAgIHN0b3BfdGltZXIoJnNwYy0+dGlja2VyKTsKKyAgICBpZiAoIGlz
X2lkbGVfdW5pdCh1bml0KSAmJiAhaXNfaWRsZV91bml0KHVuaXQtPm5leHRfdGFzaykgKQorICAg
ICAgICBzZXRfdGltZXIoJnNwYy0+dGlja2VyLCBub3cgKyBNSUNST1NFQ1MocHJ2LT50aWNrX3Bl
cmlvZF91cykKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLSBub3cgJSBNSUNST1NF
Q1MocHJ2LT50aWNrX3BlcmlvZF91cykgKTsKKwogICAgIENTQ0hFRF9VTklUX0NIRUNLKHVuaXQt
Pm5leHRfdGFzayk7CiB9CiAKQEAgLTIyMzcsMjkgKzIyNDUsNiBAQCBjc2NoZWRfZGVpbml0KHN0
cnVjdCBzY2hlZHVsZXIgKm9wcykKICAgICB9CiB9CiAKLXN0YXRpYyB2b2lkIGNzY2hlZF90aWNr
X3N1c3BlbmQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCB1bnNpZ25lZCBpbnQgY3B1KQot
ewotICAgIHN0cnVjdCBjc2NoZWRfcGNwdSAqc3BjOwotCi0gICAgc3BjID0gQ1NDSEVEX1BDUFUo
Y3B1KTsKLQotICAgIHN0b3BfdGltZXIoJnNwYy0+dGlja2VyKTsKLX0KLQotc3RhdGljIHZvaWQg
Y3NjaGVkX3RpY2tfcmVzdW1lKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgdW5zaWduZWQg
aW50IGNwdSkKLXsKLSAgICBzdHJ1Y3QgY3NjaGVkX3ByaXZhdGUgKnBydjsKLSAgICBzdHJ1Y3Qg
Y3NjaGVkX3BjcHUgKnNwYzsKLSAgICB1aW50NjRfdCBub3cgPSBOT1coKTsKLQotICAgIHNwYyA9
IENTQ0hFRF9QQ1BVKGNwdSk7Ci0KLSAgICBwcnYgPSBDU0NIRURfUFJJVihvcHMpOwotCi0gICAg
c2V0X3RpbWVyKCZzcGMtPnRpY2tlciwgbm93ICsgTUlDUk9TRUNTKHBydi0+dGlja19wZXJpb2Rf
dXMpCi0gICAgICAgICAgICAtIG5vdyAlIE1JQ1JPU0VDUyhwcnYtPnRpY2tfcGVyaW9kX3VzKSAp
OwotfQotCiBzdGF0aWMgY29uc3Qgc3RydWN0IHNjaGVkdWxlciBzY2hlZF9jcmVkaXRfZGVmID0g
ewogICAgIC5uYW1lICAgICAgICAgICA9ICJTTVAgQ3JlZGl0IFNjaGVkdWxlciIsCiAgICAgLm9w
dF9uYW1lICAgICAgID0gImNyZWRpdCIsCkBAIC0yMjk1LDkgKzIyODAsNiBAQCBzdGF0aWMgY29u
c3Qgc3RydWN0IHNjaGVkdWxlciBzY2hlZF9jcmVkaXRfZGVmID0gewogICAgIC5zd2l0Y2hfc2No
ZWQgICA9IGNzY2hlZF9zd2l0Y2hfc2NoZWQsCiAgICAgLmFsbG9jX2RvbWRhdGEgID0gY3NjaGVk
X2FsbG9jX2RvbWRhdGEsCiAgICAgLmZyZWVfZG9tZGF0YSAgID0gY3NjaGVkX2ZyZWVfZG9tZGF0
YSwKLQotICAgIC50aWNrX3N1c3BlbmQgICA9IGNzY2hlZF90aWNrX3N1c3BlbmQsCi0gICAgLnRp
Y2tfcmVzdW1lICAgID0gY3NjaGVkX3RpY2tfcmVzdW1lLAogfTsKIAogUkVHSVNURVJfU0NIRURV
TEVSKHNjaGVkX2NyZWRpdF9kZWYpOwpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZHVsZS5j
IGIveGVuL2NvbW1vbi9zY2hlZHVsZS5jCmluZGV4IDIxN2ZjYjA5Y2UuLmMzMjdjNDBiOTIgMTAw
NjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWR1bGUuYworKysgYi94ZW4vY29tbW9uL3NjaGVkdWxl
LmMKQEAgLTI4NzEsOCArMjg3MSw2IEBAIGludCBzY2hlZHVsZV9jcHVfYWRkKHVuc2lnbmVkIGlu
dCBjcHUsIHN0cnVjdCBjcHVwb29sICpjKQogICAgIC8qIF9Ob3RfIHBjcHVfc2NoZWR1bGVfdW5s
b2NrKCk6IHNjaGVkdWxlX2xvY2sgaGFzIGNoYW5nZWQhICovCiAgICAgc3Bpbl91bmxvY2tfaXJx
cmVzdG9yZShvbGRfbG9jaywgZmxhZ3MpOwogCi0gICAgc2NoZWRfZG9fdGlja19yZXN1bWUobmV3
X29wcywgY3B1KTsKLQogICAgIHNyLT5ncmFudWxhcml0eSA9IGNwdXBvb2xfZ2V0X2dyYW51bGFy
aXR5KGMpOwogICAgIHNyLT5jcHVwb29sID0gYzsKICAgICAvKiBUaGUgIGNwdSBpcyBhZGRlZCB0
byBhIHBvb2wsIHRyaWdnZXIgaXQgdG8gZ28gcGljayB1cCBzb21lIHdvcmsgKi8KQEAgLTI5NDMs
OCArMjk0MSw2IEBAIGludCBzY2hlZHVsZV9jcHVfcm0odW5zaWduZWQgaW50IGNwdSkKICAgICBB
U1NFUlQoY3B1bWFza190ZXN0X2NwdShjcHUsICZjcHVwb29sX2ZyZWVfY3B1cykpOwogICAgIEFT
U0VSVCghY3B1bWFza190ZXN0X2NwdShjcHUsIHNyLT5jcHVwb29sLT5jcHVfdmFsaWQpKTsKIAot
ICAgIHNjaGVkX2RvX3RpY2tfc3VzcGVuZChvbGRfb3BzLCBjcHUpOwotCiAgICAgLyogU2VlIGNv
bW1lbnQgaW4gc2NoZWR1bGVfY3B1X2FkZCgpIHJlZ2FyZGluZyBsb2NrIHN3aXRjaGluZy4gKi8K
ICAgICBvbGRfbG9jayA9IHBjcHVfc2NoZWR1bGVfbG9ja19pcnFzYXZlKGNwdSwgJmZsYWdzKTsK
IApAQCAtMzA4MiwzMiArMzA3OCwxNCBAQCB2b2lkIHNjaGVkdWxlX2R1bXAoc3RydWN0IGNwdXBv
b2wgKmMpCiAKIHZvaWQgc2NoZWRfdGlja19zdXNwZW5kKHZvaWQpCiB7Ci0gICAgc3RydWN0IHNj
aGVkdWxlciAqc2NoZWQ7Ci0gICAgdW5zaWduZWQgaW50IGNwdSA9IHNtcF9wcm9jZXNzb3JfaWQo
KTsKLQotICAgIHJjdV9yZWFkX2xvY2soJnNjaGVkX3Jlc19yY3Vsb2NrKTsKLQotICAgIHNjaGVk
ID0gZ2V0X3NjaGVkX3JlcyhjcHUpLT5zY2hlZHVsZXI7Ci0gICAgc2NoZWRfZG9fdGlja19zdXNw
ZW5kKHNjaGVkLCBjcHUpOwotICAgIHJjdV9pZGxlX2VudGVyKGNwdSk7CisgICAgcmN1X2lkbGVf
ZW50ZXIoc21wX3Byb2Nlc3Nvcl9pZCgpKTsKICAgICByY3VfaWRsZV90aW1lcl9zdGFydCgpOwot
Ci0gICAgcmN1X3JlYWRfdW5sb2NrKCZzY2hlZF9yZXNfcmN1bG9jayk7CiB9CiAKIHZvaWQgc2No
ZWRfdGlja19yZXN1bWUodm9pZCkKIHsKLSAgICBzdHJ1Y3Qgc2NoZWR1bGVyICpzY2hlZDsKLSAg
ICB1bnNpZ25lZCBpbnQgY3B1ID0gc21wX3Byb2Nlc3Nvcl9pZCgpOwotCi0gICAgcmN1X3JlYWRf
bG9jaygmc2NoZWRfcmVzX3JjdWxvY2spOwotCiAgICAgcmN1X2lkbGVfdGltZXJfc3RvcCgpOwot
ICAgIHJjdV9pZGxlX2V4aXQoY3B1KTsKLSAgICBzY2hlZCA9IGdldF9zY2hlZF9yZXMoY3B1KS0+
c2NoZWR1bGVyOwotICAgIHNjaGVkX2RvX3RpY2tfcmVzdW1lKHNjaGVkLCBjcHUpOwotCi0gICAg
cmN1X3JlYWRfdW5sb2NrKCZzY2hlZF9yZXNfcmN1bG9jayk7CisgICAgcmN1X2lkbGVfZXhpdChz
bXBfcHJvY2Vzc29yX2lkKCkpOwogfQogCiB2b2lkIHdhaXQodm9pZCkKZGlmZiAtLWdpdCBhL3hl
bi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5oIGIveGVuL2luY2x1ZGUveGVuL3NjaGVkLWlmLmgKaW5k
ZXggY2Q3MzFkNzE3Mi4uMjk3MTU2NTJiYyAxMDA2NDQKLS0tIGEveGVuL2luY2x1ZGUveGVuL3Nj
aGVkLWlmLmgKKysrIGIveGVuL2luY2x1ZGUveGVuL3NjaGVkLWlmLmgKQEAgLTM1Myw5ICszNTMs
NiBAQCBzdHJ1Y3Qgc2NoZWR1bGVyIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHN0cnVjdCB4ZW5fc3lzY3RsX3NjaGVkdWxlcl9vcCAqKTsKICAgICB2b2lkICAgICAgICAg
KCpkdW1wX3NldHRpbmdzKSAgKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKik7CiAgICAgdm9pZCAg
ICAgICAgICgqZHVtcF9jcHVfc3RhdGUpIChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICosIGludCk7
Ci0KLSAgICB2b2lkICAgICAgICAgKCp0aWNrX3N1c3BlbmQpICAgIChjb25zdCBzdHJ1Y3Qgc2No
ZWR1bGVyICosIHVuc2lnbmVkIGludCk7Ci0gICAgdm9pZCAgICAgICAgICgqdGlja19yZXN1bWUp
ICAgICAoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqLCB1bnNpZ25lZCBpbnQpOwogfTsKIAogc3Rh
dGljIGlubGluZSBpbnQgc2NoZWRfaW5pdChzdHJ1Y3Qgc2NoZWR1bGVyICpzKQpAQCAtMzg3LDE4
ICszODQsNiBAQCBzdGF0aWMgaW5saW5lIHZvaWQgc2NoZWRfZHVtcF9jcHVfc3RhdGUoY29uc3Qg
c3RydWN0IHNjaGVkdWxlciAqcywgaW50IGNwdSkKICAgICAgICAgcy0+ZHVtcF9jcHVfc3RhdGUo
cywgY3B1KTsKIH0KIAotc3RhdGljIGlubGluZSB2b2lkIHNjaGVkX2RvX3RpY2tfc3VzcGVuZChj
b25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpzLCBpbnQgY3B1KQotewotICAgIGlmICggcy0+dGlja19z
dXNwZW5kICkKLSAgICAgICAgcy0+dGlja19zdXNwZW5kKHMsIGNwdSk7Ci19Ci0KLXN0YXRpYyBp
bmxpbmUgdm9pZCBzY2hlZF9kb190aWNrX3Jlc3VtZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpz
LCBpbnQgY3B1KQotewotICAgIGlmICggcy0+dGlja19yZXN1bWUgKQotICAgICAgICBzLT50aWNr
X3Jlc3VtZShzLCBjcHUpOwotfQotCiBzdGF0aWMgaW5saW5lIHZvaWQgKnNjaGVkX2FsbG9jX2Rv
bWRhdGEoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqcywKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBzdHJ1Y3QgZG9tYWluICpkKQogewotLSAKMi4xNi40CgoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxp
bmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5w
cm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

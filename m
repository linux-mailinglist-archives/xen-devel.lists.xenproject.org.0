Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id C39FC173FE0
	for <lists+xen-devel@lfdr.de>; Fri, 28 Feb 2020 19:44:15 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1j7kZU-0002p5-UL; Fri, 28 Feb 2020 18:41:12 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=6b2x=4Q=intel.com=tamas.lengyel@srs-us1.protection.inumbo.net>)
 id 1j7kZT-0002ok-C8
 for xen-devel@lists.xenproject.org; Fri, 28 Feb 2020 18:41:11 +0000
X-Inumbo-ID: dfbfa840-5a59-11ea-8e51-bc764e2007e4
Received: from mga06.intel.com (unknown [134.134.136.31])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id dfbfa840-5a59-11ea-8e51-bc764e2007e4;
 Fri, 28 Feb 2020 18:41:04 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga005.fm.intel.com ([10.253.24.32])
 by orsmga104.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 28 Feb 2020 10:41:02 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.70,497,1574150400"; d="scan'208";a="437512252"
Received: from tlengyel-mobl2.amr.corp.intel.com (HELO localhost.localdomain)
 ([10.251.159.227])
 by fmsmga005.fm.intel.com with ESMTP; 28 Feb 2020 10:41:01 -0800
From: Tamas K Lengyel <tamas.lengyel@intel.com>
To: xen-devel@lists.xenproject.org
Date: Fri, 28 Feb 2020 10:40:51 -0800
Message-Id: <4d049987eab1a08607f62d0e3b51768b529e1ff5.1582914998.git.tamas.lengyel@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <cover.1582914997.git.tamas.lengyel@intel.com>
References: <cover.1582914997.git.tamas.lengyel@intel.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v11 1/3] xen/mem_sharing: VM forking
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Stefano Stabellini <sstabellini@kernel.org>,
 Tamas K Lengyel <tamas.lengyel@intel.com>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>,
 George Dunlap <george.dunlap@citrix.com>,
 Tamas K Lengyel <tamas@tklengyel.com>, Jan Beulich <jbeulich@suse.com>,
 Julien Grall <julien@xen.org>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

Vk0gZm9ya2luZyBpcyB0aGUgcHJvY2VzcyBvZiBjcmVhdGluZyBhIGRvbWFpbiB3aXRoIGFuIGVt
cHR5IG1lbW9yeSBzcGFjZSBhbmQgYQpwYXJlbnQgZG9tYWluIHNwZWNpZmllZCBmcm9tIHdoaWNo
IHRvIHBvcHVsYXRlIHRoZSBtZW1vcnkgd2hlbiBuZWNlc3NhcnkuIEZvcgp0aGUgbmV3IGRvbWFp
biB0byBiZSBmdW5jdGlvbmFsIHRoZSBWTSBzdGF0ZSBpcyBjb3BpZWQgb3ZlciBhcyBwYXJ0IG9m
IHRoZSBmb3JrCm9wZXJhdGlvbiAoSFZNIHBhcmFtcywgaGFwIGFsbG9jYXRpb24sIGV0YykuCgpT
aWduZWQtb2ZmLWJ5OiBUYW1hcyBLIExlbmd5ZWwgPHRhbWFzLmxlbmd5ZWxAaW50ZWwuY29tPgot
LS0KdjExOiBGdWxseSBjb3B5IHZjcHVfaW5mbyBwYWdlcwogICAgIFNldHVwIHZjcHVfcnVuc3Rh
dGUgZm9yIGZvcmtzCiAgICAgQWRkZWQgVE9ETyBub3RlIGZvciBQViB0aW1lcnMKICAgICBDb3B5
IHNoYXJlZF9pbmZvIHBhZ2UKICAgICBBZGQgY29weV9zZXR0aW5ncyBmdW5jdGlvbiwgdG8gYmUg
c2hhcmVkIHdpdGggZm9ya19yZXNldCBpbiB0aGUgbmV4dCBwYXRjaAotLS0KIHhlbi9hcmNoL3g4
Ni9kb21haW4uYyAgICAgICAgICAgICB8ICAxMSArCiB4ZW4vYXJjaC94ODYvaHZtL2h2bS5jICAg
ICAgICAgICAgfCAgIDQgKy0KIHhlbi9hcmNoL3g4Ni9tbS9oYXAvaGFwLmMgICAgICAgICB8ICAg
MyArLQogeGVuL2FyY2gveDg2L21tL21lbV9zaGFyaW5nLmMgICAgIHwgMzY4ICsrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKwogeGVuL2FyY2gveDg2L21tL3AybS5jICAgICAgICAgICAgIHwg
ICA5ICstCiB4ZW4vY29tbW9uL2RvbWFpbi5jICAgICAgICAgICAgICAgfCAgIDMgKwogeGVuL2lu
Y2x1ZGUvYXNtLXg4Ni9oYXAuaCAgICAgICAgIHwgICAxICsKIHhlbi9pbmNsdWRlL2FzbS14ODYv
aHZtL2h2bS5oICAgICB8ICAgMiArCiB4ZW4vaW5jbHVkZS9hc20teDg2L21lbV9zaGFyaW5nLmgg
fCAgMTcgKysKIHhlbi9pbmNsdWRlL3B1YmxpYy9tZW1vcnkuaCAgICAgICB8ICAgNSArCiB4ZW4v
aW5jbHVkZS94ZW4vc2NoZWQuaCAgICAgICAgICAgfCAgIDUgKwogMTEgZmlsZXMgY2hhbmdlZCwg
NDIzIGluc2VydGlvbnMoKyksIDUgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEveGVuL2FyY2gv
eDg2L2RvbWFpbi5jIGIveGVuL2FyY2gveDg2L2RvbWFpbi5jCmluZGV4IGZlNjNjMjM2NzYuLjFh
YjBjYTA5NDIgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9kb21haW4uYworKysgYi94ZW4vYXJj
aC94ODYvZG9tYWluLmMKQEAgLTIyMDMsNiArMjIwMywxNyBAQCBpbnQgZG9tYWluX3JlbGlucXVp
c2hfcmVzb3VyY2VzKHN0cnVjdCBkb21haW4gKmQpCiAgICAgICAgICAgICByZXQgPSByZWxpbnF1
aXNoX3NoYXJlZF9wYWdlcyhkKTsKICAgICAgICAgICAgIGlmICggcmV0ICkKICAgICAgICAgICAg
ICAgICByZXR1cm4gcmV0OworCisgICAgICAgICAgICAvKgorICAgICAgICAgICAgICogSWYgdGhl
IGRvbWFpbiBpcyBmb3JrZWQsIGRlY3JlbWVudCB0aGUgcGFyZW50J3MgcGF1c2UgY291bnQKKyAg
ICAgICAgICAgICAqIGFuZCByZWxlYXNlIHRoZSBkb21haW4uCisgICAgICAgICAgICAgKi8KKyAg
ICAgICAgICAgIGlmICggZC0+cGFyZW50ICkKKyAgICAgICAgICAgIHsKKyAgICAgICAgICAgICAg
ICBkb21haW5fdW5wYXVzZShkLT5wYXJlbnQpOworICAgICAgICAgICAgICAgIHB1dF9kb21haW4o
ZC0+cGFyZW50KTsKKyAgICAgICAgICAgICAgICBkLT5wYXJlbnQgPSBOVUxMOworICAgICAgICAg
ICAgfQogICAgICAgICB9CiAjZW5kaWYKIApkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L2h2bS9o
dm0uYyBiL3hlbi9hcmNoL3g4Ni9odm0vaHZtLmMKaW5kZXggZGI1ZDdiNGQzMC4uYzU1MWNjMzFm
MyAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L2h2bS9odm0uYworKysgYi94ZW4vYXJjaC94ODYv
aHZtL2h2bS5jCkBAIC0xOTE2LDcgKzE5MTYsNyBAQCBpbnQgaHZtX2hhcF9uZXN0ZWRfcGFnZV9m
YXVsdChwYWRkcl90IGdwYSwgdW5zaWduZWQgbG9uZyBnbGEsCiAgICAgfQogI2VuZGlmCiAKLSAg
ICAvKiBTcHVyaW91cyBmYXVsdD8gUG9EIGFuZCBsb2ctZGlydHkgYWxzbyB0YWtlIHRoaXMgcGF0
aC4gKi8KKyAgICAvKiBTcHVyaW91cyBmYXVsdD8gUG9ELCBsb2ctZGlydHkgYW5kIFZNIGZvcmtp
bmcgYWxzbyB0YWtlIHRoaXMgcGF0aC4gKi8KICAgICBpZiAoIHAybV9pc19yYW0ocDJtdCkgKQog
ICAgIHsKICAgICAgICAgcmMgPSAxOwpAQCAtNDQzMCw3ICs0NDMwLDcgQEAgc3RhdGljIGludCBo
dm1fYWxsb3dfZ2V0X3BhcmFtKHN0cnVjdCBkb21haW4gKmQsCiAgICAgcmV0dXJuIHJjOwogfQog
Ci1zdGF0aWMgaW50IGh2bV9nZXRfcGFyYW0oc3RydWN0IGRvbWFpbiAqZCwgdWludDMyX3QgaW5k
ZXgsIHVpbnQ2NF90ICp2YWx1ZSkKK2ludCBodm1fZ2V0X3BhcmFtKHN0cnVjdCBkb21haW4gKmQs
IHVpbnQzMl90IGluZGV4LCB1aW50NjRfdCAqdmFsdWUpCiB7CiAgICAgaW50IHJjOwogCmRpZmYg
LS1naXQgYS94ZW4vYXJjaC94ODYvbW0vaGFwL2hhcC5jIGIveGVuL2FyY2gveDg2L21tL2hhcC9o
YXAuYwppbmRleCAzZDkzZjM0NTFjLi5jN2M3ZmY2ZTk5IDEwMDY0NAotLS0gYS94ZW4vYXJjaC94
ODYvbW0vaGFwL2hhcC5jCisrKyBiL3hlbi9hcmNoL3g4Ni9tbS9oYXAvaGFwLmMKQEAgLTMyMSw4
ICszMjEsNyBAQCBzdGF0aWMgdm9pZCBoYXBfZnJlZV9wMm1fcGFnZShzdHJ1Y3QgZG9tYWluICpk
LCBzdHJ1Y3QgcGFnZV9pbmZvICpwZykKIH0KIAogLyogUmV0dXJuIHRoZSBzaXplIG9mIHRoZSBw
b29sLCByb3VuZGVkIHVwIHRvIHRoZSBuZWFyZXN0IE1CICovCi1zdGF0aWMgdW5zaWduZWQgaW50
Ci1oYXBfZ2V0X2FsbG9jYXRpb24oc3RydWN0IGRvbWFpbiAqZCkKK3Vuc2lnbmVkIGludCBoYXBf
Z2V0X2FsbG9jYXRpb24oc3RydWN0IGRvbWFpbiAqZCkKIHsKICAgICB1bnNpZ25lZCBpbnQgcGcg
PSBkLT5hcmNoLnBhZ2luZy5oYXAudG90YWxfcGFnZXMKICAgICAgICAgKyBkLT5hcmNoLnBhZ2lu
Zy5oYXAucDJtX3BhZ2VzOwpkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L21tL21lbV9zaGFyaW5n
LmMgYi94ZW4vYXJjaC94ODYvbW0vbWVtX3NoYXJpbmcuYwppbmRleCAzODM1YmM5MjhmLi40YTg0
MGQwOWRkIDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYvbW0vbWVtX3NoYXJpbmcuYworKysgYi94
ZW4vYXJjaC94ODYvbW0vbWVtX3NoYXJpbmcuYwpAQCAtMjIsNiArMjIsNyBAQAogCiAjaW5jbHVk
ZSA8eGVuL3R5cGVzLmg+CiAjaW5jbHVkZSA8eGVuL2RvbWFpbl9wYWdlLmg+CisjaW5jbHVkZSA8
eGVuL2V2ZW50Lmg+CiAjaW5jbHVkZSA8eGVuL3NwaW5sb2NrLmg+CiAjaW5jbHVkZSA8eGVuL3J3
bG9jay5oPgogI2luY2x1ZGUgPHhlbi9tbS5oPgpAQCAtMzYsNiArMzcsOCBAQAogI2luY2x1ZGUg
PGFzbS9hbHRwMm0uaD4KICNpbmNsdWRlIDxhc20vYXRvbWljLmg+CiAjaW5jbHVkZSA8YXNtL2V2
ZW50Lmg+CisjaW5jbHVkZSA8YXNtL2hhcC5oPgorI2luY2x1ZGUgPGFzbS9odm0vaHZtLmg+CiAj
aW5jbHVkZSA8eHNtL3hzbS5oPgogCiAjaW5jbHVkZSAibW0tbG9ja3MuaCIKQEAgLTE0NDQsNiAr
MTQ0NywzMzQgQEAgc3RhdGljIGlubGluZSBpbnQgbWVtX3NoYXJpbmdfY29udHJvbChzdHJ1Y3Qg
ZG9tYWluICpkLCBib29sIGVuYWJsZSkKICAgICByZXR1cm4gMDsKIH0KIAorLyoKKyAqIEZvcmtp
bmcgYSBwYWdlIG9ubHkgZ2V0cyBjYWxsZWQgd2hlbiB0aGUgVk0gZmF1bHRzIGR1ZSB0byBubyBl
bnRyeSBiZWluZworICogaW4gdGhlIEVQVCBmb3IgdGhlIGFjY2Vzcy4gRGVwZW5kaW5nIG9uIHRo
ZSB0eXBlIG9mIGFjY2VzcyB3ZSBlaXRoZXIKKyAqIHBvcHVsYXRlIHRoZSBwaHlzbWFwIHdpdGgg
YSBzaGFyZWQgZW50cnkgZm9yIHJlYWQtb25seSBhY2Nlc3Mgb3IKKyAqIGZvcmsgdGhlIHBhZ2Ug
aWYgaXRzIGEgd3JpdGUgYWNjZXNzLgorICoKKyAqIFRoZSBjbGllbnQgcDJtIGlzIGFscmVhZHkg
bG9ja2VkIHNvIHdlIG9ubHkgbmVlZCB0byBsb2NrCisgKiB0aGUgcGFyZW50J3MgaGVyZS4KKyAq
LworaW50IG1lbV9zaGFyaW5nX2ZvcmtfcGFnZShzdHJ1Y3QgZG9tYWluICpkLCBnZm5fdCBnZm4s
IGJvb2wgdW5zaGFyaW5nKQoreworICAgIGludCByYyA9IC1FTk9FTlQ7CisgICAgc2hyX2hhbmRs
ZV90IGhhbmRsZTsKKyAgICBzdHJ1Y3QgZG9tYWluICpwYXJlbnQgPSBkLT5wYXJlbnQ7CisgICAg
c3RydWN0IHAybV9kb21haW4gKnAybTsKKyAgICB1bnNpZ25lZCBsb25nIGdmbl9sID0gZ2ZuX3go
Z2ZuKTsKKyAgICBtZm5fdCBtZm4sIG5ld19tZm47CisgICAgcDJtX3R5cGVfdCBwMm10OworICAg
IHN0cnVjdCBwYWdlX2luZm8gKnBhZ2U7CisKKyAgICBpZiAoICFtZW1fc2hhcmluZ19pc19mb3Jr
KGQpICkKKyAgICAgICAgcmV0dXJuIC1FTk9FTlQ7CisKKyAgICBpZiAoICF1bnNoYXJpbmcgKQor
ICAgIHsKKyAgICAgICAgLyogRm9yIHJlYWQtb25seSBhY2Nlc3NlcyB3ZSBqdXN0IGFkZCBhIHNo
YXJlZCBlbnRyeSB0byB0aGUgcGh5c21hcCAqLworICAgICAgICB3aGlsZSAoIHBhcmVudCApCisg
ICAgICAgIHsKKyAgICAgICAgICAgIGlmICggIShyYyA9IG5vbWluYXRlX3BhZ2UocGFyZW50LCBn
Zm4sIDAsICZoYW5kbGUpKSApCisgICAgICAgICAgICAgICAgYnJlYWs7CisKKyAgICAgICAgICAg
IHBhcmVudCA9IHBhcmVudC0+cGFyZW50OworICAgICAgICB9CisKKyAgICAgICAgaWYgKCAhcmMg
KQorICAgICAgICB7CisgICAgICAgICAgICAvKiBUaGUgY2xpZW50J3MgcDJtIGlzIGFscmVhZHkg
bG9ja2VkICovCisgICAgICAgICAgICBzdHJ1Y3QgcDJtX2RvbWFpbiAqcHAybSA9IHAybV9nZXRf
aG9zdHAybShwYXJlbnQpOworCisgICAgICAgICAgICBwMm1fbG9jayhwcDJtKTsKKyAgICAgICAg
ICAgIHJjID0gYWRkX3RvX3BoeXNtYXAocGFyZW50LCBnZm5fbCwgaGFuZGxlLCBkLCBnZm5fbCwg
ZmFsc2UpOworICAgICAgICAgICAgcDJtX3VubG9jayhwcDJtKTsKKworICAgICAgICAgICAgaWYg
KCAhcmMgKQorICAgICAgICAgICAgICAgIHJldHVybiAwOworICAgICAgICB9CisgICAgfQorCisg
ICAgLyoKKyAgICAgKiBJZiBpdCdzIGEgd3JpdGUgYWNjZXNzIChpZS4gdW5zaGFyaW5nKSBvciBp
ZiBhZGRpbmcgYSBzaGFyZWQgZW50cnkgdG8KKyAgICAgKiB0aGUgcGh5c21hcCBmYWlsZWQgd2Un
bGwgZm9yayB0aGUgcGFnZSBkaXJlY3RseS4KKyAgICAgKi8KKyAgICBwMm0gPSBwMm1fZ2V0X2hv
c3RwMm0oZCk7CisgICAgcGFyZW50ID0gZC0+cGFyZW50OworCisgICAgd2hpbGUgKCBwYXJlbnQg
KQorICAgIHsKKyAgICAgICAgbWZuID0gZ2V0X2dmbl9xdWVyeShwYXJlbnQsIGdmbl9sLCAmcDJt
dCk7CisKKyAgICAgICAgLyoKKyAgICAgICAgICogV2UgY2FuJ3QgZm9yayBncmFudCBtZW1vcnkg
ZnJvbSB0aGUgcGFyZW50LCBvbmx5IHJlZ3VsYXIgcmFtLgorICAgICAgICAgKi8KKyAgICAgICAg
aWYgKCBtZm5fdmFsaWQobWZuKSAmJiBwMm1faXNfcmFtKHAybXQpICkKKyAgICAgICAgICAgIGJy
ZWFrOworCisgICAgICAgIHB1dF9nZm4ocGFyZW50LCBnZm5fbCk7CisgICAgICAgIHBhcmVudCA9
IHBhcmVudC0+cGFyZW50OworICAgIH0KKworICAgIGlmICggIXBhcmVudCApCisgICAgICAgIHJl
dHVybiAtRU5PRU5UOworCisgICAgaWYgKCAhKHBhZ2UgPSBhbGxvY19kb21oZWFwX3BhZ2UoZCwg
MCkpICkKKyAgICB7CisgICAgICAgIHB1dF9nZm4ocGFyZW50LCBnZm5fbCk7CisgICAgICAgIHJl
dHVybiAtRU5PTUVNOworICAgIH0KKworICAgIG5ld19tZm4gPSBwYWdlX3RvX21mbihwYWdlKTsK
KyAgICBjb3B5X2RvbWFpbl9wYWdlKG5ld19tZm4sIG1mbik7CisgICAgc2V0X2dwZm5fZnJvbV9t
Zm4obWZuX3gobmV3X21mbiksIGdmbl9sKTsKKworICAgIHB1dF9nZm4ocGFyZW50LCBnZm5fbCk7
CisKKyAgICByZXR1cm4gcDJtLT5zZXRfZW50cnkocDJtLCBnZm4sIG5ld19tZm4sIFBBR0VfT1JE
RVJfNEssIHAybV9yYW1fcncsCisgICAgICAgICAgICAgICAgICAgICAgICAgIHAybS0+ZGVmYXVs
dF9hY2Nlc3MsIC0xKTsKK30KKworc3RhdGljIGludCBicmluZ191cF92Y3B1cyhzdHJ1Y3QgZG9t
YWluICpjZCwgc3RydWN0IGRvbWFpbiAqZCkKK3sKKyAgICB1bnNpZ25lZCBpbnQgaTsKKyAgICBp
bnQgcmV0ID0gLUVJTlZBTDsKKworICAgIGlmICggZC0+bWF4X3ZjcHVzICE9IGNkLT5tYXhfdmNw
dXMgfHwKKyAgICAgICAgKHJldCA9IGNwdXBvb2xfbW92ZV9kb21haW4oY2QsIGQtPmNwdXBvb2wp
KSApCisgICAgICAgIHJldHVybiByZXQ7CisKKyAgICBmb3IgKCBpID0gMDsgaSA8IGNkLT5tYXhf
dmNwdXM7IGkrKyApCisgICAgeworICAgICAgICBpZiAoICFkLT52Y3B1W2ldIHx8IGNkLT52Y3B1
W2ldICkKKyAgICAgICAgICAgIGNvbnRpbnVlOworCisgICAgICAgIGlmICggIXZjcHVfY3JlYXRl
KGNkLCBpKSApCisgICAgICAgICAgICByZXR1cm4gLUVJTlZBTDsKKyAgICB9CisKKyAgICBkb21h
aW5fdXBkYXRlX25vZGVfYWZmaW5pdHkoY2QpOworICAgIHJldHVybiAwOworfQorCitzdGF0aWMg
aW50IGNvcHlfdmNwdV9zZXR0aW5ncyhzdHJ1Y3QgZG9tYWluICpjZCwgc3RydWN0IGRvbWFpbiAq
ZCkKK3sKKyAgICB1bnNpZ25lZCBpbnQgaTsKKyAgICBzdHJ1Y3QgcDJtX2RvbWFpbiAqcDJtID0g
cDJtX2dldF9ob3N0cDJtKGNkKTsKKyAgICBpbnQgcmV0ID0gLUVJTlZBTDsKKworICAgIGZvciAo
IGkgPSAwOyBpIDwgY2QtPm1heF92Y3B1czsgaSsrICkKKyAgICB7CisgICAgICAgIGNvbnN0IHN0
cnVjdCB2Y3B1ICpkX3ZjcHUgPSBkLT52Y3B1W2ldOworICAgICAgICBzdHJ1Y3QgdmNwdSAqY2Rf
dmNwdSA9IGNkLT52Y3B1W2ldOworICAgICAgICBzdHJ1Y3QgdmNwdV9ydW5zdGF0ZV9pbmZvIHJ1
bnN0YXRlOworICAgICAgICBtZm5fdCB2Y3B1X2luZm9fbWZuOworCisgICAgICAgIGlmICggIWRf
dmNwdSB8fCAhY2RfdmNwdSApCisgICAgICAgICAgICBjb250aW51ZTsKKworICAgICAgICAvKgor
ICAgICAgICAgKiBDb3B5ICYgbWFwIGluIHRoZSB2Y3B1X2luZm8gcGFnZSBpZiB0aGUgZ3Vlc3Qg
dXNlcyBvbmUKKyAgICAgICAgICovCisgICAgICAgIHZjcHVfaW5mb19tZm4gPSBkX3ZjcHUtPnZj
cHVfaW5mb19tZm47CisgICAgICAgIGlmICggIW1mbl9lcSh2Y3B1X2luZm9fbWZuLCBJTlZBTElE
X01GTikgKQorICAgICAgICB7CisgICAgICAgICAgICBtZm5fdCBuZXdfdmNwdV9pbmZvX21mbiA9
IGNkX3ZjcHUtPnZjcHVfaW5mb19tZm47CisKKyAgICAgICAgICAgIC8qCisgICAgICAgICAgICAg
KiBBbGxvY2F0ZSAmIG1hcCB0aGUgcGFnZSBmb3IgaXQgaWYgaXQgaGFzbid0IGJlZW4gYWxyZWFk
eQorICAgICAgICAgICAgICovCisgICAgICAgICAgICBpZiAoIG1mbl9lcShuZXdfdmNwdV9pbmZv
X21mbiwgSU5WQUxJRF9NRk4pICkKKyAgICAgICAgICAgIHsKKyAgICAgICAgICAgICAgICBnZm5f
dCBnZm4gPSBtZm5fdG9fZ2ZuKGQsIHZjcHVfaW5mb19tZm4pOworICAgICAgICAgICAgICAgIHVu
c2lnbmVkIGxvbmcgZ2ZuX2wgPSBnZm5feChnZm4pOworICAgICAgICAgICAgICAgIHN0cnVjdCBw
YWdlX2luZm8gKnBhZ2U7CisKKyAgICAgICAgICAgICAgICBpZiAoICEocGFnZSA9IGFsbG9jX2Rv
bWhlYXBfcGFnZShjZCwgMCkpICkKKyAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC1FTk9NRU07
CisKKyAgICAgICAgICAgICAgICBuZXdfdmNwdV9pbmZvX21mbiA9IHBhZ2VfdG9fbWZuKHBhZ2Up
OworICAgICAgICAgICAgICAgIHNldF9ncGZuX2Zyb21fbWZuKG1mbl94KG5ld192Y3B1X2luZm9f
bWZuKSwgZ2ZuX2wpOworCisgICAgICAgICAgICAgICAgcmV0ID0gcDJtLT5zZXRfZW50cnkocDJt
LCBnZm4sIG5ld192Y3B1X2luZm9fbWZuLCBQQUdFX09SREVSXzRLLAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHAybV9yYW1fcncsIHAybS0+ZGVmYXVsdF9hY2Nlc3MsIC0x
KTsKKyAgICAgICAgICAgICAgICBpZiAoIHJldCApCisgICAgICAgICAgICAgICAgICAgIHJldHVy
biByZXQ7CisKKyAgICAgICAgICAgICAgICByZXQgPSBtYXBfdmNwdV9pbmZvKGNkX3ZjcHUsIGdm
bl9sLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZF92Y3B1LT52Y3B1X2lu
Zm9fb2Zmc2V0KTsKKyAgICAgICAgICAgICAgICBpZiAoIHJldCApCisgICAgICAgICAgICAgICAg
ICAgIHJldHVybiByZXQ7CisgICAgICAgICAgICB9CisKKyAgICAgICAgICAgIGNvcHlfZG9tYWlu
X3BhZ2UobmV3X3ZjcHVfaW5mb19tZm4sIHZjcHVfaW5mb19tZm4pOworICAgICAgICB9CisKKyAg
ICAgICAgLyoKKyAgICAgICAgICogU2V0dXAgdGhlIHZDUFUgcnVuc3RhdGUgYXJlYQorICAgICAg
ICAgKi8KKyAgICAgICAgaWYgKCBndWVzdF9oYW5kbGVfaXNfbnVsbChydW5zdGF0ZV9ndWVzdChj
ZF92Y3B1KSkgKQorICAgICAgICB7CisgICAgICAgICAgICBydW5zdGF0ZV9ndWVzdChjZF92Y3B1
KSA9IHJ1bnN0YXRlX2d1ZXN0KGRfdmNwdSk7CisgICAgICAgICAgICB2Y3B1X3J1bnN0YXRlX2dl
dChjZF92Y3B1LCAmcnVuc3RhdGUpOworICAgICAgICAgICAgX19jb3B5X3RvX2d1ZXN0KHJ1bnN0
YXRlX2d1ZXN0KGNkX3ZjcHUpLCAmcnVuc3RhdGUsIDEpOworICAgICAgICB9CisKKyAgICAgICAg
LyoKKyAgICAgICAgICogVE9ETzogdG8gc3VwcG9ydCBWTXMgd2l0aCBQViBpbnRlcmZhY2VzIGNv
cHkgYWRkaXRpb25hbAorICAgICAgICAgKiBzZXR0aW5ncyBoZXJlLCBzdWNoIGFzIFBWIHRpbWVy
cy4KKyAgICAgICAgICovCisgICAgfQorCisgICAgcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQg
Zm9ya19oYXBfYWxsb2NhdGlvbihzdHJ1Y3QgZG9tYWluICpjZCwgc3RydWN0IGRvbWFpbiAqZCkK
K3sKKyAgICBpbnQgcmM7CisgICAgYm9vbCBwcmVlbXB0ZWQ7CisgICAgdW5zaWduZWQgbG9uZyBt
YiA9IGhhcF9nZXRfYWxsb2NhdGlvbihkKTsKKworICAgIGlmICggbWIgPT0gaGFwX2dldF9hbGxv
Y2F0aW9uKGNkKSApCisgICAgICAgIHJldHVybiAwOworCisgICAgcGFnaW5nX2xvY2soY2QpOwor
ICAgIHJjID0gaGFwX3NldF9hbGxvY2F0aW9uKGNkLCBtYiA8PCAoMjAgLSBQQUdFX1NISUZUKSwg
JnByZWVtcHRlZCk7CisgICAgcGFnaW5nX3VubG9jayhjZCk7CisKKyAgICByZXR1cm4gcHJlZW1w
dGVkID8gLUVSRVNUQVJUIDogcmM7Cit9CisKK3N0YXRpYyB2b2lkIGNvcHlfdHNjKHN0cnVjdCBk
b21haW4gKmNkLCBzdHJ1Y3QgZG9tYWluICpkKQoreworICAgIHVpbnQzMl90IHRzY19tb2RlOwor
ICAgIHVpbnQzMl90IGd0c2Nfa2h6OworICAgIHVpbnQzMl90IGluY2FybmF0aW9uOworICAgIHVp
bnQ2NF90IGVsYXBzZWRfbnNlYzsKKworICAgIHRzY19nZXRfaW5mbyhkLCAmdHNjX21vZGUsICZl
bGFwc2VkX25zZWMsICZndHNjX2toeiwgJmluY2FybmF0aW9uKTsKKyAgICAvKiBEb24ndCBidW1w
IGluY2FybmF0aW9uIG9uIHNldCAqLworICAgIHRzY19zZXRfaW5mbyhjZCwgdHNjX21vZGUsIGVs
YXBzZWRfbnNlYywgZ3RzY19raHosIGluY2FybmF0aW9uIC0gMSk7Cit9CisKK3N0YXRpYyBpbnQg
Y29weV9zcGVjaWFsX3BhZ2VzKHN0cnVjdCBkb21haW4gKmNkLCBzdHJ1Y3QgZG9tYWluICpkKQor
eworICAgIG1mbl90IG5ld19tZm4sIG9sZF9tZm47CisgICAgc3RydWN0IHAybV9kb21haW4gKnAy
bSA9IHAybV9nZXRfaG9zdHAybShjZCk7CisgICAgc3RhdGljIGNvbnN0IHVuc2lnbmVkIGludCBw
YXJhbXNbXSA9CisgICAgeworICAgICAgICBIVk1fUEFSQU1fU1RPUkVfUEZOLAorICAgICAgICBI
Vk1fUEFSQU1fSU9SRVFfUEZOLAorICAgICAgICBIVk1fUEFSQU1fQlVGSU9SRVFfUEZOLAorICAg
ICAgICBIVk1fUEFSQU1fQ09OU09MRV9QRk4KKyAgICB9OworICAgIHVuc2lnbmVkIGludCBpOwor
ICAgIGludCByYzsKKworICAgIGZvciAoIGkgPSAwOyBpIDwgNDsgaSsrICkKKyAgICB7CisgICAg
ICAgIHAybV90eXBlX3QgdDsKKyAgICAgICAgdWludDY0X3QgdmFsdWUgPSAwOworICAgICAgICBz
dHJ1Y3QgcGFnZV9pbmZvICpwYWdlOworCisgICAgICAgIGlmICggaHZtX2dldF9wYXJhbShjZCwg
cGFyYW1zW2ldLCAmdmFsdWUpIHx8ICF2YWx1ZSApCisgICAgICAgICAgICBjb250aW51ZTsKKwor
ICAgICAgICBvbGRfbWZuID0gZ2V0X2dmbl9xdWVyeV91bmxvY2tlZChkLCB2YWx1ZSwgJnQpOwor
ICAgICAgICBuZXdfbWZuID0gZ2V0X2dmbl9xdWVyeV91bmxvY2tlZChjZCwgdmFsdWUsICZ0KTsK
KworICAgICAgICAvKgorICAgICAgICAgKiBBbGxvY2F0ZSB0aGUgcGFnZSBhbmQgbWFwIGl0IGlu
IGlmIGl0J3Mgbm90IHByZXNlbnQKKyAgICAgICAgICovCisgICAgICAgIGlmICggbWZuX2VxKG5l
d19tZm4sIElOVkFMSURfTUZOKSApCisgICAgICAgIHsKKyAgICAgICAgICAgIGlmICggIShwYWdl
ID0gYWxsb2NfZG9taGVhcF9wYWdlKGNkLCAwKSkgKQorICAgICAgICAgICAgICAgIHJldHVybiAt
RU5PTUVNOworCisgICAgICAgICAgICBuZXdfbWZuID0gcGFnZV90b19tZm4ocGFnZSk7CisgICAg
ICAgICAgICBzZXRfZ3Bmbl9mcm9tX21mbihtZm5feChuZXdfbWZuKSwgdmFsdWUpOworCisgICAg
ICAgICAgICByYyA9IHAybS0+c2V0X2VudHJ5KHAybSwgX2dmbih2YWx1ZSksIG5ld19tZm4sIFBB
R0VfT1JERVJfNEssCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAybV9yYW1fcncs
IHAybS0+ZGVmYXVsdF9hY2Nlc3MsIC0xKTsKKyAgICAgICAgICAgIGlmICggcmMgKQorICAgICAg
ICAgICAgICAgIHJldHVybiByYzsKKyAgICAgICAgfQorCisgICAgICAgIGNvcHlfZG9tYWluX3Bh
Z2UobmV3X21mbiwgb2xkX21mbik7CisgICAgfQorCisgICAgb2xkX21mbiA9IF9tZm4odmlydF90
b19tZm4oZC0+c2hhcmVkX2luZm8pKTsKKyAgICBuZXdfbWZuID0gX21mbih2aXJ0X3RvX21mbihj
ZC0+c2hhcmVkX2luZm8pKTsKKyAgICBjb3B5X2RvbWFpbl9wYWdlKG5ld19tZm4sIG9sZF9tZm4p
OworCisgICAgcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgY29weV9zZXR0aW5ncyhzdHJ1Y3Qg
ZG9tYWluICpjZCwgc3RydWN0IGRvbWFpbiAqZCkKK3sKKyAgICBpbnQgcmM7CisKKyAgICBpZiAo
IChyYyA9IGNvcHlfdmNwdV9zZXR0aW5ncyhjZCwgZCkpICkKKyAgICAgICAgcmV0dXJuIHJjOwor
CisgICAgaWYgKCAocmMgPSBodm1fY29weV9jb250ZXh0X2FuZF9wYXJhbXMoY2QsIGQpKSApCisg
ICAgICAgIHJldHVybiByYzsKKworICAgIGlmICggKHJjID0gY29weV9zcGVjaWFsX3BhZ2VzKGNk
LCBkKSkgKQorICAgICAgICByZXR1cm4gcmM7CisKKyAgICBjb3B5X3RzYyhjZCwgZCk7CisKKyAg
ICByZXR1cm4gcmM7Cit9CisKK3N0YXRpYyBpbnQgZm9yayhzdHJ1Y3QgZG9tYWluICpjZCwgc3Ry
dWN0IGRvbWFpbiAqZCkKK3sKKyAgICBpbnQgcmMgPSAtRUJVU1k7CisKKyAgICBpZiAoICFjZC0+
Y29udHJvbGxlcl9wYXVzZV9jb3VudCApCisgICAgICAgIHJldHVybiByYzsKKworICAgIC8qCisg
ICAgICogV2Ugb25seSB3YW50IHRvIGdldCBhbmQgcGF1c2UgdGhlIHBhcmVudCBvbmNlLCBub3Qg
ZWFjaCB0aW1lIHRoaXMKKyAgICAgKiBvcGVyYXRpb24gaXMgcmVzdGFydGVkIGR1ZSB0byBwcmVl
bXB0aW9uLgorICAgICAqLworICAgIGlmICggIWNkLT5wYXJlbnRfcGF1c2VkICkKKyAgICB7Cisg
ICAgICAgIGlmICggIWdldF9kb21haW4oZCkgKQorICAgICAgICB7CisgICAgICAgICAgICBBU1NF
UlRfVU5SRUFDSEFCTEUoKTsKKyAgICAgICAgICAgIHJldHVybiAtRUJVU1k7CisgICAgICAgIH0K
KworICAgICAgICBkb21haW5fcGF1c2UoZCk7CisgICAgICAgIGNkLT5wYXJlbnRfcGF1c2VkID0g
dHJ1ZTsKKyAgICAgICAgY2QtPm1heF9wYWdlcyA9IGQtPm1heF9wYWdlczsKKyAgICB9CisKKyAg
ICAvKiB0aGlzIGlzIHByZWVtcHRpYmxlIHNvIGl0J3MgdGhlIGZpcnN0IHRvIGdldCBkb25lICov
CisgICAgaWYgKCAocmMgPSBmb3JrX2hhcF9hbGxvY2F0aW9uKGNkLCBkKSkgKQorICAgICAgICBn
b3RvIGRvbmU7CisKKyAgICBpZiAoIChyYyA9IGJyaW5nX3VwX3ZjcHVzKGNkLCBkKSkgKQorICAg
ICAgICBnb3RvIGRvbmU7CisKKyAgICBpZiAoIChyYyA9IGNvcHlfc2V0dGluZ3MoY2QsIGQpKSAp
CisgICAgICAgIGdvdG8gZG9uZTsKKworICAgIGNkLT5wYXJlbnQgPSBkOworCisgZG9uZToKKyAg
ICBpZiAoIHJjICYmIHJjICE9IC1FUkVTVEFSVCApCisgICAgeworICAgICAgICBkb21haW5fdW5w
YXVzZShkKTsKKyAgICAgICAgcHV0X2RvbWFpbihkKTsKKyAgICAgICAgY2QtPnBhcmVudF9wYXVz
ZWQgPSBmYWxzZTsKKyAgICB9CisKKyAgICByZXR1cm4gcmM7Cit9CisKIGludCBtZW1fc2hhcmlu
Z19tZW1vcChYRU5fR1VFU1RfSEFORExFX1BBUkFNKHhlbl9tZW1fc2hhcmluZ19vcF90KSBhcmcp
CiB7CiAgICAgaW50IHJjOwpAQCAtMTY5OCw2ICsyMDI5LDQzIEBAIGludCBtZW1fc2hhcmluZ19t
ZW1vcChYRU5fR1VFU1RfSEFORExFX1BBUkFNKHhlbl9tZW1fc2hhcmluZ19vcF90KSBhcmcpCiAg
ICAgICAgIHJjID0gZGVidWdfZ3JlZihkLCBtc28udS5kZWJ1Zy51LmdyZWYpOwogICAgICAgICBi
cmVhazsKIAorICAgIGNhc2UgWEVOTUVNX3NoYXJpbmdfb3BfZm9yazoKKyAgICB7CisgICAgICAg
IHN0cnVjdCBkb21haW4gKnBkOworCisgICAgICAgIHJjID0gLUVJTlZBTDsKKyAgICAgICAgaWYg
KCBtc28udS5mb3JrLl9wYWRbMF0gfHwgbXNvLnUuZm9yay5fcGFkWzFdIHx8CisgICAgICAgICAg
ICAgbXNvLnUuZm9yay5fcGFkWzJdICkKKyAgICAgICAgICAgIGdvdG8gb3V0OworCisgICAgICAg
IHJjID0gcmN1X2xvY2tfbGl2ZV9yZW1vdGVfZG9tYWluX2J5X2lkKG1zby51LmZvcmsucGFyZW50
X2RvbWFpbiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
JnBkKTsKKyAgICAgICAgaWYgKCByYyApCisgICAgICAgICAgICBnb3RvIG91dDsKKworICAgICAg
ICByYyA9IC1FSU5WQUw7CisgICAgICAgIGlmICggcGQtPm1heF92Y3B1cyAhPSBkLT5tYXhfdmNw
dXMgKQorICAgICAgICB7CisgICAgICAgICAgICByY3VfdW5sb2NrX2RvbWFpbihwZCk7CisgICAg
ICAgICAgICBnb3RvIG91dDsKKyAgICAgICAgfQorCisgICAgICAgIGlmICggIW1lbV9zaGFyaW5n
X2VuYWJsZWQocGQpICYmIChyYyA9IG1lbV9zaGFyaW5nX2NvbnRyb2wocGQsIHRydWUpKSApCisg
ICAgICAgIHsKKyAgICAgICAgICAgIHJjdV91bmxvY2tfZG9tYWluKHBkKTsKKyAgICAgICAgICAg
IGdvdG8gb3V0OworICAgICAgICB9CisKKyAgICAgICAgcmMgPSBmb3JrKGQsIHBkKTsKKworICAg
ICAgICBpZiAoIHJjID09IC1FUkVTVEFSVCApCisgICAgICAgICAgICByYyA9IGh5cGVyY2FsbF9j
cmVhdGVfY29udGludWF0aW9uKF9fSFlQRVJWSVNPUl9tZW1vcnlfb3AsCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJsaCIsIFhFTk1FTV9zaGFyaW5nX29w
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmcpOwor
ICAgICAgICByY3VfdW5sb2NrX2RvbWFpbihwZCk7CisgICAgICAgIGJyZWFrOworICAgIH0KKwog
ICAgIGRlZmF1bHQ6CiAgICAgICAgIHJjID0gLUVOT1NZUzsKICAgICAgICAgYnJlYWs7CmRpZmYg
LS1naXQgYS94ZW4vYXJjaC94ODYvbW0vcDJtLmMgYi94ZW4vYXJjaC94ODYvbW0vcDJtLmMKaW5k
ZXggMzcxOWRlYWU3Ny4uMzljMDc3ODlmYSAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L21tL3Ay
bS5jCisrKyBiL3hlbi9hcmNoL3g4Ni9tbS9wMm0uYwpAQCAtNTA5LDYgKzUwOSwxMiBAQCBtZm5f
dCBfX2dldF9nZm5fdHlwZV9hY2Nlc3Moc3RydWN0IHAybV9kb21haW4gKnAybSwgdW5zaWduZWQg
bG9uZyBnZm5fbCwKIAogICAgIG1mbiA9IHAybS0+Z2V0X2VudHJ5KHAybSwgZ2ZuLCB0LCBhLCBx
LCBwYWdlX29yZGVyLCBOVUxMKTsKIAorICAgIC8qIENoZWNrIGlmIHdlIG5lZWQgdG8gZm9yayB0
aGUgcGFnZSAqLworICAgIGlmICggKHEgJiBQMk1fQUxMT0MpICYmIHAybV9pc19ob2xlKCp0KSAm
JgorICAgICAgICAgIW1lbV9zaGFyaW5nX2ZvcmtfcGFnZShwMm0tPmRvbWFpbiwgZ2ZuLCAhIShx
ICYgUDJNX1VOU0hBUkUpKSApCisgICAgICAgIG1mbiA9IHAybS0+Z2V0X2VudHJ5KHAybSwgZ2Zu
LCB0LCBhLCBxLCBwYWdlX29yZGVyLCBOVUxMKTsKKworICAgIC8qIENoZWNrIGlmIHdlIG5lZWQg
dG8gdW5zaGFyZSB0aGUgcGFnZSAqLwogICAgIGlmICggKHEgJiBQMk1fVU5TSEFSRSkgJiYgcDJt
X2lzX3NoYXJlZCgqdCkgKQogICAgIHsKICAgICAgICAgQVNTRVJUKHAybV9pc19ob3N0cDJtKHAy
bSkpOwpAQCAtNTg4LDcgKzU5NCw4IEBAIHN0cnVjdCBwYWdlX2luZm8gKnAybV9nZXRfcGFnZV9m
cm9tX2dmbigKICAgICAgICAgICAgIHJldHVybiBwYWdlOwogCiAgICAgICAgIC8qIEVycm9yIHBh
dGg6IG5vdCBhIHN1aXRhYmxlIEdGTiBhdCBhbGwgKi8KLSAgICAgICAgaWYgKCAhcDJtX2lzX3Jh
bSgqdCkgJiYgIXAybV9pc19wYWdpbmcoKnQpICYmICFwMm1faXNfcG9kKCp0KSApCisgICAgICAg
IGlmICggIXAybV9pc19yYW0oKnQpICYmICFwMm1faXNfcGFnaW5nKCp0KSAmJiAhcDJtX2lzX3Bv
ZCgqdCkgJiYKKyAgICAgICAgICAgICAhbWVtX3NoYXJpbmdfaXNfZm9yayhwMm0tPmRvbWFpbikg
KQogICAgICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAgfQogCmRpZmYgLS1naXQgYS94ZW4vY29t
bW9uL2RvbWFpbi5jIGIveGVuL2NvbW1vbi9kb21haW4uYwppbmRleCA2YWQ0NThmYTZiLi4wMjk5
ODIzNWRkIDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL2RvbWFpbi5jCisrKyBiL3hlbi9jb21tb24v
ZG9tYWluLmMKQEAgLTEyNjksNiArMTI2OSw5IEBAIGludCBtYXBfdmNwdV9pbmZvKHN0cnVjdCB2
Y3B1ICp2LCB1bnNpZ25lZCBsb25nIGdmbiwgdW5zaWduZWQgb2Zmc2V0KQogCiAgICAgdi0+dmNw
dV9pbmZvID0gbmV3X2luZm87CiAgICAgdi0+dmNwdV9pbmZvX21mbiA9IHBhZ2VfdG9fbWZuKHBh
Z2UpOworI2lmZGVmIENPTkZJR19NRU1fU0hBUklORworICAgIHYtPnZjcHVfaW5mb19vZmZzZXQg
PSBvZmZzZXQ7CisjZW5kaWYKIAogICAgIC8qIFNldCBuZXcgdmNwdV9pbmZvIHBvaW50ZXIgL2Jl
Zm9yZS8gc2V0dGluZyBwZW5kaW5nIGZsYWdzLiAqLwogICAgIHNtcF93bWIoKTsKZGlmZiAtLWdp
dCBhL3hlbi9pbmNsdWRlL2FzbS14ODYvaGFwLmggYi94ZW4vaW5jbHVkZS9hc20teDg2L2hhcC5o
CmluZGV4IGI5NGJmYjRlZDAuLjFiZjA3ZTQ5ZmUgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL2Fz
bS14ODYvaGFwLmgKKysrIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9oYXAuaApAQCAtNDUsNiArNDUs
NyBAQCBpbnQgICBoYXBfdHJhY2tfZGlydHlfdnJhbShzdHJ1Y3QgZG9tYWluICpkLAogCiBleHRl
cm4gY29uc3Qgc3RydWN0IHBhZ2luZ19tb2RlICpoYXBfcGFnaW5nX2dldF9tb2RlKHN0cnVjdCB2
Y3B1ICopOwogaW50IGhhcF9zZXRfYWxsb2NhdGlvbihzdHJ1Y3QgZG9tYWluICpkLCB1bnNpZ25l
ZCBpbnQgcGFnZXMsIGJvb2wgKnByZWVtcHRlZCk7Cit1bnNpZ25lZCBpbnQgaGFwX2dldF9hbGxv
Y2F0aW9uKHN0cnVjdCBkb21haW4gKmQpOwogCiAjZW5kaWYgLyogWEVOX0hBUF9IICovCiAKZGlm
ZiAtLWdpdCBhL3hlbi9pbmNsdWRlL2FzbS14ODYvaHZtL2h2bS5oIGIveGVuL2luY2x1ZGUvYXNt
LXg4Ni9odm0vaHZtLmgKaW5kZXggMjRkYTgyNGNiZi4uMzVlOTcwYjAzMCAxMDA2NDQKLS0tIGEv
eGVuL2luY2x1ZGUvYXNtLXg4Ni9odm0vaHZtLmgKKysrIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9o
dm0vaHZtLmgKQEAgLTMzOSw2ICszMzksOCBAQCBib29sIGh2bV9mbHVzaF92Y3B1X3RsYihib29s
ICgqZmx1c2hfdmNwdSkodm9pZCAqY3R4dCwgc3RydWN0IHZjcHUgKnYpLAogCiBpbnQgaHZtX2Nv
cHlfY29udGV4dF9hbmRfcGFyYW1zKHN0cnVjdCBkb21haW4gKnNyYywgc3RydWN0IGRvbWFpbiAq
ZHN0KTsKIAoraW50IGh2bV9nZXRfcGFyYW0oc3RydWN0IGRvbWFpbiAqZCwgdWludDMyX3QgaW5k
ZXgsIHVpbnQ2NF90ICp2YWx1ZSk7CisKICNpZmRlZiBDT05GSUdfSFZNCiAKICNkZWZpbmUgaHZt
X2dldF9ndWVzdF90c2ModikgaHZtX2dldF9ndWVzdF90c2NfZml4ZWQodiwgMCkKZGlmZiAtLWdp
dCBhL3hlbi9pbmNsdWRlL2FzbS14ODYvbWVtX3NoYXJpbmcuaCBiL3hlbi9pbmNsdWRlL2FzbS14
ODYvbWVtX3NoYXJpbmcuaAppbmRleCA1Mzc2MGEyODk2Li5hYzk2OGZhZTNmIDEwMDY0NAotLS0g
YS94ZW4vaW5jbHVkZS9hc20teDg2L21lbV9zaGFyaW5nLmgKKysrIGIveGVuL2luY2x1ZGUvYXNt
LXg4Ni9tZW1fc2hhcmluZy5oCkBAIC0zOSw2ICszOSw5IEBAIHN0cnVjdCBtZW1fc2hhcmluZ19k
b21haW4KIAogI2RlZmluZSBtZW1fc2hhcmluZ19lbmFibGVkKGQpICgoZCktPmFyY2guaHZtLm1l
bV9zaGFyaW5nLmVuYWJsZWQpCiAKKyNkZWZpbmUgbWVtX3NoYXJpbmdfaXNfZm9yayhkKSBcCisg
ICAgKG1lbV9zaGFyaW5nX2VuYWJsZWQoZCkgJiYgISEoKGQpLT5wYXJlbnQpKQorCiAvKiBBdWRp
dGluZyBvZiBtZW1vcnkgc2hhcmluZyBjb2RlPyAqLwogI2lmbmRlZiBOREVCVUcKICNkZWZpbmUg
TUVNX1NIQVJJTkdfQVVESVQgMQpAQCAtODgsNiArOTEsOSBAQCBzdGF0aWMgaW5saW5lIGludCBt
ZW1fc2hhcmluZ191bnNoYXJlX3BhZ2Uoc3RydWN0IGRvbWFpbiAqZCwKICAgICByZXR1cm4gcmM7
CiB9CiAKK2ludCBtZW1fc2hhcmluZ19mb3JrX3BhZ2Uoc3RydWN0IGRvbWFpbiAqZCwgZ2ZuX3Qg
Z2ZuLAorICAgICAgICAgICAgICAgICAgICAgICAgICBib29sIHVuc2hhcmluZyk7CisKIC8qCiAg
KiBJZiBjYWxsZWQgYnkgYSBmb3JlaWduIGRvbWFpbiwgcG9zc2libGUgZXJyb3JzIGFyZQogICog
ICAtRUJVU1kgLT4gcmluZyBmdWxsCkBAIC0xMTcsNiArMTIzLDcgQEAgaW50IHJlbGlucXVpc2hf
c2hhcmVkX3BhZ2VzKHN0cnVjdCBkb21haW4gKmQpOwogI2Vsc2UKIAogI2RlZmluZSBtZW1fc2hh
cmluZ19lbmFibGVkKGQpIGZhbHNlCisjZGVmaW5lIG1lbV9zaGFyaW5nX2lzX2ZvcmsocDJtKSBm
YWxzZQogCiBzdGF0aWMgaW5saW5lIHVuc2lnbmVkIGludCBtZW1fc2hhcmluZ19nZXRfbnJfc2F2
ZWRfbWZucyh2b2lkKQogewpAQCAtMTQxLDYgKzE0OCwxNiBAQCBzdGF0aWMgaW5saW5lIGludCBt
ZW1fc2hhcmluZ19ub3RpZnlfZW5vbWVtKHN0cnVjdCBkb21haW4gKmQsIHVuc2lnbmVkIGxvbmcg
Z2ZuLAogICAgIHJldHVybiAtRU9QTk9UU1VQUDsKIH0KIAorc3RhdGljIGlubGluZSBpbnQgbWVt
X3NoYXJpbmdfZm9yayhzdHJ1Y3QgZG9tYWluICpkLCBzdHJ1Y3QgZG9tYWluICpjZCwgYm9vbCB2
Y3B1KQoreworICAgIHJldHVybiAtRU9QTk9UU1VQUDsKK30KKworc3RhdGljIGlubGluZSBpbnQg
bWVtX3NoYXJpbmdfZm9ya19wYWdlKHN0cnVjdCBkb21haW4gKmQsIGdmbl90IGdmbiwgYm9vbCBs
b2NrKQoreworICAgIHJldHVybiAtRU9QTk9UU1VQUDsKK30KKwogI2VuZGlmCiAKICNlbmRpZiAv
KiBfX01FTV9TSEFSSU5HX0hfXyAqLwpkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUvcHVibGljL21l
bW9yeS5oIGIveGVuL2luY2x1ZGUvcHVibGljL21lbW9yeS5oCmluZGV4IDEyNmQwZmYwNmUuLmMx
ZGJhZDA2MGUgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL3B1YmxpYy9tZW1vcnkuaAorKysgYi94
ZW4vaW5jbHVkZS9wdWJsaWMvbWVtb3J5LmgKQEAgLTQ4Miw2ICs0ODIsNyBAQCBERUZJTkVfWEVO
X0dVRVNUX0hBTkRMRSh4ZW5fbWVtX2FjY2Vzc19vcF90KTsKICNkZWZpbmUgWEVOTUVNX3NoYXJp
bmdfb3BfYWRkX3BoeXNtYXAgICAgICAgNgogI2RlZmluZSBYRU5NRU1fc2hhcmluZ19vcF9hdWRp
dCAgICAgICAgICAgICA3CiAjZGVmaW5lIFhFTk1FTV9zaGFyaW5nX29wX3JhbmdlX3NoYXJlICAg
ICAgIDgKKyNkZWZpbmUgWEVOTUVNX3NoYXJpbmdfb3BfZm9yayAgICAgICAgICAgICAgOQogCiAj
ZGVmaW5lIFhFTk1FTV9TSEFSSU5HX09QX1NfSEFORExFX0lOVkFMSUQgICgtMTApCiAjZGVmaW5l
IFhFTk1FTV9TSEFSSU5HX09QX0NfSEFORExFX0lOVkFMSUQgICgtOSkKQEAgLTUzMiw2ICs1MzMs
MTAgQEAgc3RydWN0IHhlbl9tZW1fc2hhcmluZ19vcCB7CiAgICAgICAgICAgICAgICAgdWludDMy
X3QgZ3JlZjsgICAgIC8qIElOOiBncmVmIHRvIGRlYnVnICAgICAgICAgKi8KICAgICAgICAgICAg
IH0gdTsKICAgICAgICAgfSBkZWJ1ZzsKKyAgICAgICAgc3RydWN0IG1lbV9zaGFyaW5nX29wX2Zv
cmsgeyAgICAgIC8qIE9QX0ZPUksgKi8KKyAgICAgICAgICAgIGRvbWlkX3QgcGFyZW50X2RvbWFp
bjsgICAgICAgIC8qIElOOiBwYXJlbnQncyBkb21haW4gaWQgKi8KKyAgICAgICAgICAgIHVpbnQx
Nl90IF9wYWRbM107ICAgICAgICAgICAgIC8qIE11c3QgYmUgc2V0IHRvIDAgKi8KKyAgICAgICAg
fSBmb3JrOwogICAgIH0gdTsKIH07CiB0eXBlZGVmIHN0cnVjdCB4ZW5fbWVtX3NoYXJpbmdfb3Ag
eGVuX21lbV9zaGFyaW5nX29wX3Q7CmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQu
aCBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCmluZGV4IDNhNGY0MzA5OGMuLmM2YmE1YTUyYTQg
MTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCisrKyBiL3hlbi9pbmNsdWRlL3hl
bi9zY2hlZC5oCkBAIC0yNDgsNiArMjQ4LDkgQEAgc3RydWN0IHZjcHUKIAogICAgIC8qIEd1ZXN0
LXNwZWNpZmllZCByZWxvY2F0aW9uIG9mIHZjcHVfaW5mby4gKi8KICAgICBtZm5fdCAgICAgICAg
ICAgIHZjcHVfaW5mb19tZm47CisjaWZkZWYgQ09ORklHX01FTV9TSEFSSU5HCisgICAgdWludDMy
X3QgICAgICAgICB2Y3B1X2luZm9fb2Zmc2V0OworI2VuZGlmCiAKICAgICBzdHJ1Y3QgZXZ0Y2hu
X2ZpZm9fdmNwdSAqZXZ0Y2huX2ZpZm87CiAKQEAgLTUwMyw2ICs1MDYsOCBAQCBzdHJ1Y3QgZG9t
YWluCiAgICAgLyogTWVtb3J5IHNoYXJpbmcgc3VwcG9ydCAqLwogI2lmZGVmIENPTkZJR19NRU1f
U0hBUklORwogICAgIHN0cnVjdCB2bV9ldmVudF9kb21haW4gKnZtX2V2ZW50X3NoYXJlOworICAg
IHN0cnVjdCBkb21haW4gKnBhcmVudDsgLyogVk0gZm9yayBwYXJlbnQgKi8KKyAgICBib29sIHBh
cmVudF9wYXVzZWQ7CiAjZW5kaWYKICAgICAvKiBNZW1vcnkgcGFnaW5nIHN1cHBvcnQgKi8KICNp
ZmRlZiBDT05GSUdfSEFTX01FTV9QQUdJTkcKLS0gCjIuMjAuMQoKCl9fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVu
LWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcv
bWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

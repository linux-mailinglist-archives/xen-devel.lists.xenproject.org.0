Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id B65CA13C20D
	for <lists+xen-devel@lfdr.de>; Wed, 15 Jan 2020 13:56:15 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iriAU-00019W-6t; Wed, 15 Jan 2020 12:53:06 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=NEZB=3E=suse.de=tzimmermann@srs-us1.protection.inumbo.net>)
 id 1iriAS-000191-FX
 for xen-devel@lists.xenproject.org; Wed, 15 Jan 2020 12:53:04 +0000
X-Inumbo-ID: e74a06e6-3795-11ea-a2eb-bc764e2007e4
Received: from mx2.suse.de (unknown [195.135.220.15])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id e74a06e6-3795-11ea-a2eb-bc764e2007e4;
 Wed, 15 Jan 2020 12:52:36 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx2.suse.de (Postfix) with ESMTP id 17B48B033;
 Wed, 15 Jan 2020 12:52:35 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: airlied@linux.ie, daniel@ffwll.ch, kraxel@redhat.com,
 maarten.lankhorst@linux.intel.com, mripard@kernel.org, hdegoede@redhat.com,
 david@lechnology.com, noralf@tronnes.org, sean@poorly.run,
 oleksandr_andrushchenko@epam.com, sam@ravnborg.org,
 laurent.pinchart@ideasonboard.com, emil.velikov@collabora.com
Date: Wed, 15 Jan 2020 13:52:26 +0100
Message-Id: <20200115125226.13843-5-tzimmermann@suse.de>
X-Mailer: git-send-email 2.24.1
In-Reply-To: <20200115125226.13843-1-tzimmermann@suse.de>
References: <20200115125226.13843-1-tzimmermann@suse.de>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v2 4/4] drm/simple-kms: Let DRM core send VBLANK
 events by default
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: xen-devel@lists.xenproject.org, Thomas Zimmermann <tzimmermann@suse.de>,
 dri-devel@lists.freedesktop.org, virtualization@lists.linux-foundation.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SW4gZHJtX2F0b21pY19oZWxwZXJfZmFrZV92YmxhbmsoKSB0aGUgRFJNIGNvcmUgc2VuZHMgb3V0
IFZCTEFOSyBldmVudHMKaWYgc3RydWN0IGRybV9jcnRjX3N0YXRlLm5vX3ZibGFuayBpcyBlbmFi
bGVkIGluIHRoZSBjaGVjaygpIGNhbGxiYWNrcy4KCkZvciBkcml2ZXJzIHRoYXQgaGF2ZSBuZWl0
aGVyIGFuIGVuYWJsZV92YmxhbmsoKSBjYWxsYmFjayBub3IgYSBjaGVjaygpCmNhbGxiYWNrLCB0
aGUgc2ltcGxlLUtNUyBoZWxwZXJzIGVuYWJsZSBWQkxBTksgZ2VuZXJhdGlvbiBieSBkZWZhdWx0
LiBUaGlzCnNpbXBsaWZpZXMgYm9jaHMsIHVkbCwgc2V2ZXJhbCB0aW55IGRyaXZlcnMsIGFuZCBk
cml2ZXJzIGJhc2VkIHVwb24gTUlQSQpEUEkgaGVscGVycy4gVGhlIGRyaXZlciBmb3IgWGVuIGV4
cGxpY2l0bHkgZGlzYWJsZXMgbm9fdmJsYW5rLCBhcyBpdCBoYXMKaXRzIG93biBsb2dpYyBmb3Ig
c2VuZGluZyB0aGVzZSBldmVudHMuCgpTaWduZWQtb2ZmLWJ5OiBUaG9tYXMgWmltbWVybWFubiA8
dHppbW1lcm1hbm5Ac3VzZS5kZT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vYm9jaHMvYm9jaHNfa21z
LmMgICAgICAgfCAgOSAtLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fbWlwaV9kYmkuYyAg
ICAgICAgICB8ICA5IC0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2RybV9zaW1wbGVfa21zX2hl
bHBlci5jIHwgMTkgKysrKysrKysrKysrKysrLS0tLQogZHJpdmVycy9ncHUvZHJtL3RpbnkvZ20x
MnUzMjAuYyAgICAgICAgIHwgIDkgLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vdGlueS9pbGk5
MjI1LmMgICAgICAgICAgfCAgOSAtLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS90aW55L3JlcGFw
ZXIuYyAgICAgICAgICB8ICA5IC0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL3Rpbnkvc3Q3NTg2
LmMgICAgICAgICAgIHwgIDkgLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vdWRsL3VkbF9tb2Rl
c2V0LmMgICAgICAgfCAxMSAtLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL3hlbi94ZW5fZHJt
X2Zyb250X2ttcy5jIHwgMTMgKysrKysrKysrKysrKwogOSBmaWxlcyBjaGFuZ2VkLCAyOCBpbnNl
cnRpb25zKCspLCA2OSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
Ym9jaHMvYm9jaHNfa21zLmMgYi9kcml2ZXJzL2dwdS9kcm0vYm9jaHMvYm9jaHNfa21zLmMKaW5k
ZXggM2YwMDA2YzI0NzBkLi5mZjI3NWZhZWU4OGQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9ib2Nocy9ib2Noc19rbXMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYm9jaHMvYm9jaHNfa21z
LmMKQEAgLTcsNyArNyw2IEBACiAjaW5jbHVkZSA8ZHJtL2RybV9hdG9taWNfaGVscGVyLmg+CiAj
aW5jbHVkZSA8ZHJtL2RybV9nZW1fZnJhbWVidWZmZXJfaGVscGVyLmg+CiAjaW5jbHVkZSA8ZHJt
L2RybV9wcm9iZV9oZWxwZXIuaD4KLSNpbmNsdWRlIDxkcm0vZHJtX3ZibGFuay5oPgogCiAjaW5j
bHVkZSAiYm9jaHMuaCIKIApAQCAtNTcsMTYgKzU2LDggQEAgc3RhdGljIHZvaWQgYm9jaHNfcGlw
ZV91cGRhdGUoc3RydWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAogCQkJICAgICAg
c3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqb2xkX3N0YXRlKQogewogCXN0cnVjdCBib2Noc19kZXZp
Y2UgKmJvY2hzID0gcGlwZS0+Y3J0Yy5kZXYtPmRldl9wcml2YXRlOwotCXN0cnVjdCBkcm1fY3J0
YyAqY3J0YyA9ICZwaXBlLT5jcnRjOwogCiAJYm9jaHNfcGxhbmVfdXBkYXRlKGJvY2hzLCBwaXBl
LT5wbGFuZS5zdGF0ZSk7Ci0KLQlpZiAoY3J0Yy0+c3RhdGUtPmV2ZW50KSB7Ci0JCXNwaW5fbG9j
a19pcnEoJmNydGMtPmRldi0+ZXZlbnRfbG9jayk7Ci0JCWRybV9jcnRjX3NlbmRfdmJsYW5rX2V2
ZW50KGNydGMsIGNydGMtPnN0YXRlLT5ldmVudCk7Ci0JCWNydGMtPnN0YXRlLT5ldmVudCA9IE5V
TEw7Ci0JCXNwaW5fdW5sb2NrX2lycSgmY3J0Yy0+ZGV2LT5ldmVudF9sb2NrKTsKLQl9CiB9CiAK
IHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGVfZnVuY3MgYm9jaHNf
cGlwZV9mdW5jcyA9IHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fbWlwaV9kYmku
YyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fbWlwaV9kYmkuYwppbmRleCAxNmJmZjFiZTRiOGEuLjEz
Yjc1M2NiM2Y2NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9taXBpX2RiaS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fbWlwaV9kYmkuYwpAQCAtMjQsNyArMjQsNiBAQAogI2lu
Y2x1ZGUgPGRybS9kcm1fbW9kZXMuaD4KICNpbmNsdWRlIDxkcm0vZHJtX3Byb2JlX2hlbHBlci5o
PgogI2luY2x1ZGUgPGRybS9kcm1fcmVjdC5oPgotI2luY2x1ZGUgPGRybS9kcm1fdmJsYW5rLmg+
CiAjaW5jbHVkZSA8dmlkZW8vbWlwaV9kaXNwbGF5Lmg+CiAKICNkZWZpbmUgTUlQSV9EQklfTUFY
X1NQSV9SRUFEX1NQRUVEIDIwMDAwMDAgLyogMk1IeiAqLwpAQCAtMjk5LDE4ICsyOTgsMTAgQEAg
dm9pZCBtaXBpX2RiaV9waXBlX3VwZGF0ZShzdHJ1Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGUg
KnBpcGUsCiAJCQkgIHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKm9sZF9zdGF0ZSkKIHsKIAlzdHJ1
Y3QgZHJtX3BsYW5lX3N0YXRlICpzdGF0ZSA9IHBpcGUtPnBsYW5lLnN0YXRlOwotCXN0cnVjdCBk
cm1fY3J0YyAqY3J0YyA9ICZwaXBlLT5jcnRjOwogCXN0cnVjdCBkcm1fcmVjdCByZWN0OwogCiAJ
aWYgKGRybV9hdG9taWNfaGVscGVyX2RhbWFnZV9tZXJnZWQob2xkX3N0YXRlLCBzdGF0ZSwgJnJl
Y3QpKQogCQltaXBpX2RiaV9mYl9kaXJ0eShzdGF0ZS0+ZmIsICZyZWN0KTsKLQotCWlmIChjcnRj
LT5zdGF0ZS0+ZXZlbnQpIHsKLQkJc3Bpbl9sb2NrX2lycSgmY3J0Yy0+ZGV2LT5ldmVudF9sb2Nr
KTsKLQkJZHJtX2NydGNfc2VuZF92YmxhbmtfZXZlbnQoY3J0YywgY3J0Yy0+c3RhdGUtPmV2ZW50
KTsKLQkJc3Bpbl91bmxvY2tfaXJxKCZjcnRjLT5kZXYtPmV2ZW50X2xvY2spOwotCQljcnRjLT5z
dGF0ZS0+ZXZlbnQgPSBOVUxMOwotCX0KIH0KIEVYUE9SVF9TWU1CT0wobWlwaV9kYmlfcGlwZV91
cGRhdGUpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX3NpbXBsZV9rbXNfaGVs
cGVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX3NpbXBsZV9rbXNfaGVscGVyLmMKaW5kZXggMTVm
YjUxNmFlMmQ4Li40NDE0YzdhNWIyY2UgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9kcm1f
c2ltcGxlX2ttc19oZWxwZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX3NpbXBsZV9rbXNf
aGVscGVyLmMKQEAgLTE0NiwxMCArMTQ2LDIxIEBAIHN0YXRpYyBpbnQgZHJtX3NpbXBsZV9rbXNf
cGxhbmVfYXRvbWljX2NoZWNrKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCWlmICghcGxhbmVf
c3RhdGUtPnZpc2libGUpCiAJCXJldHVybiAwOwogCi0JaWYgKCFwaXBlLT5mdW5jcyB8fCAhcGlw
ZS0+ZnVuY3MtPmNoZWNrKQotCQlyZXR1cm4gMDsKLQotCXJldHVybiBwaXBlLT5mdW5jcy0+Y2hl
Y2socGlwZSwgcGxhbmVfc3RhdGUsIGNydGNfc3RhdGUpOworCWlmIChwaXBlLT5mdW5jcykgewor
CQlpZiAocGlwZS0+ZnVuY3MtPmNoZWNrKQorCQkJcmV0dXJuIHBpcGUtPmZ1bmNzLT5jaGVjayhw
aXBlLCBwbGFuZV9zdGF0ZSwKKwkJCQkJCSAgY3J0Y19zdGF0ZSk7CisJCWlmIChwaXBlLT5mdW5j
cy0+ZW5hYmxlX3ZibGFuaykKKwkJCXJldHVybiAwOworCX0KKworCS8qIERyaXZlcnMgd2l0aG91
dCBWQkxBTksgc3VwcG9ydCBoYXZlIHRvIGZha2UgVkJMQU5LIGV2ZW50cy4gQXMKKwkgKiB0aGVy
ZSdzIG5vIGNoZWNrKCkgY2FsbGJhY2sgdG8gZW5hYmxlIHRoaXMsIHNldCB0aGUgbm9fdmJsYW5r
CisJICogZmllbGQgYnkgZGVmYXVsdC4KKwkgKi8KKwljcnRjX3N0YXRlLT5ub192YmxhbmsgPSB0
cnVlOworCisJcmV0dXJuIDA7CiB9CiAKIHN0YXRpYyB2b2lkIGRybV9zaW1wbGVfa21zX3BsYW5l
X2F0b21pY191cGRhdGUoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vdGlueS9nbTEydTMyMC5jIGIvZHJpdmVycy9ncHUvZHJtL3RpbnkvZ20xMnUz
MjAuYwppbmRleCA5NGZiMWY1OTM1NjQuLmE0ODE3MzQ0MWFlMCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL3RpbnkvZ20xMnUzMjAuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdGlueS9nbTEy
dTMyMC5jCkBAIC0yMiw3ICsyMiw2IEBACiAjaW5jbHVkZSA8ZHJtL2RybV9tb2Rlc2V0X2hlbHBl
cl92dGFibGVzLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9wcm9iZV9oZWxwZXIuaD4KICNpbmNsdWRl
IDxkcm0vZHJtX3NpbXBsZV9rbXNfaGVscGVyLmg+Ci0jaW5jbHVkZSA8ZHJtL2RybV92Ymxhbmsu
aD4KIAogc3RhdGljIGJvb2wgZWNvX21vZGU7CiBtb2R1bGVfcGFyYW0oZWNvX21vZGUsIGJvb2ws
IDA2NDQpOwpAQCAtNjEwLDE4ICs2MDksMTAgQEAgc3RhdGljIHZvaWQgZ20xMnUzMjBfcGlwZV91
cGRhdGUoc3RydWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAogCQkJCSBzdHJ1Y3Qg
ZHJtX3BsYW5lX3N0YXRlICpvbGRfc3RhdGUpCiB7CiAJc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAq
c3RhdGUgPSBwaXBlLT5wbGFuZS5zdGF0ZTsKLQlzdHJ1Y3QgZHJtX2NydGMgKmNydGMgPSAmcGlw
ZS0+Y3J0YzsKIAlzdHJ1Y3QgZHJtX3JlY3QgcmVjdDsKIAogCWlmIChkcm1fYXRvbWljX2hlbHBl
cl9kYW1hZ2VfbWVyZ2VkKG9sZF9zdGF0ZSwgc3RhdGUsICZyZWN0KSkKIAkJZ20xMnUzMjBfZmJf
bWFya19kaXJ0eShwaXBlLT5wbGFuZS5zdGF0ZS0+ZmIsICZyZWN0KTsKLQotCWlmIChjcnRjLT5z
dGF0ZS0+ZXZlbnQpIHsKLQkJc3Bpbl9sb2NrX2lycSgmY3J0Yy0+ZGV2LT5ldmVudF9sb2NrKTsK
LQkJZHJtX2NydGNfc2VuZF92YmxhbmtfZXZlbnQoY3J0YywgY3J0Yy0+c3RhdGUtPmV2ZW50KTsK
LQkJY3J0Yy0+c3RhdGUtPmV2ZW50ID0gTlVMTDsKLQkJc3Bpbl91bmxvY2tfaXJxKCZjcnRjLT5k
ZXYtPmV2ZW50X2xvY2spOwotCX0KIH0KIAogc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fc2ltcGxl
X2Rpc3BsYXlfcGlwZV9mdW5jcyBnbTEydTMyMF9waXBlX2Z1bmNzID0gewpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL3RpbnkvaWxpOTIyNS5jIGIvZHJpdmVycy9ncHUvZHJtL3RpbnkvaWxp
OTIyNS5jCmluZGV4IGM2NmFjYzU2NmMyYi4uODAyZmI4ZGRlMWI2IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vdGlueS9pbGk5MjI1LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3RpbnkvaWxp
OTIyNS5jCkBAIC0yNiw3ICsyNiw2IEBACiAjaW5jbHVkZSA8ZHJtL2RybV9nZW1fZnJhbWVidWZm
ZXJfaGVscGVyLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9taXBpX2RiaS5oPgogI2luY2x1ZGUgPGRy
bS9kcm1fcmVjdC5oPgotI2luY2x1ZGUgPGRybS9kcm1fdmJsYW5rLmg+CiAKICNkZWZpbmUgSUxJ
OTIyNV9EUklWRVJfUkVBRF9DT0RFCTB4MDAKICNkZWZpbmUgSUxJOTIyNV9EUklWRVJfT1VUUFVU
X0NPTlRST0wJMHgwMQpAQCAtMTY1LDE4ICsxNjQsMTAgQEAgc3RhdGljIHZvaWQgaWxpOTIyNV9w
aXBlX3VwZGF0ZShzdHJ1Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGUgKnBpcGUsCiAJCQkJc3Ry
dWN0IGRybV9wbGFuZV9zdGF0ZSAqb2xkX3N0YXRlKQogewogCXN0cnVjdCBkcm1fcGxhbmVfc3Rh
dGUgKnN0YXRlID0gcGlwZS0+cGxhbmUuc3RhdGU7Ci0Jc3RydWN0IGRybV9jcnRjICpjcnRjID0g
JnBpcGUtPmNydGM7CiAJc3RydWN0IGRybV9yZWN0IHJlY3Q7CiAKIAlpZiAoZHJtX2F0b21pY19o
ZWxwZXJfZGFtYWdlX21lcmdlZChvbGRfc3RhdGUsIHN0YXRlLCAmcmVjdCkpCiAJCWlsaTkyMjVf
ZmJfZGlydHkoc3RhdGUtPmZiLCAmcmVjdCk7Ci0KLQlpZiAoY3J0Yy0+c3RhdGUtPmV2ZW50KSB7
Ci0JCXNwaW5fbG9ja19pcnEoJmNydGMtPmRldi0+ZXZlbnRfbG9jayk7Ci0JCWRybV9jcnRjX3Nl
bmRfdmJsYW5rX2V2ZW50KGNydGMsIGNydGMtPnN0YXRlLT5ldmVudCk7Ci0JCXNwaW5fdW5sb2Nr
X2lycSgmY3J0Yy0+ZGV2LT5ldmVudF9sb2NrKTsKLQkJY3J0Yy0+c3RhdGUtPmV2ZW50ID0gTlVM
TDsKLQl9CiB9CiAKIHN0YXRpYyB2b2lkIGlsaTkyMjVfcGlwZV9lbmFibGUoc3RydWN0IGRybV9z
aW1wbGVfZGlzcGxheV9waXBlICpwaXBlLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3Rp
bnkvcmVwYXBlci5jIGIvZHJpdmVycy9ncHUvZHJtL3RpbnkvcmVwYXBlci5jCmluZGV4IDc2ZDE3
OTIwMDc3NS4uMTgzNDg0NTk1YWVhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdGlueS9y
ZXBhcGVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3RpbnkvcmVwYXBlci5jCkBAIC0zMyw3ICsz
Myw2IEBACiAjaW5jbHVkZSA8ZHJtL2RybV9nZW1fZnJhbWVidWZmZXJfaGVscGVyLmg+CiAjaW5j
bHVkZSA8ZHJtL2RybV9tb2Rlcy5oPgogI2luY2x1ZGUgPGRybS9kcm1fcmVjdC5oPgotI2luY2x1
ZGUgPGRybS9kcm1fdmJsYW5rLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9wcm9iZV9oZWxwZXIuaD4K
ICNpbmNsdWRlIDxkcm0vZHJtX3NpbXBsZV9rbXNfaGVscGVyLmg+CiAKQEAgLTg1NiwxOCArODU1
LDEwIEBAIHN0YXRpYyB2b2lkIHJlcGFwZXJfcGlwZV91cGRhdGUoc3RydWN0IGRybV9zaW1wbGVf
ZGlzcGxheV9waXBlICpwaXBlLAogCQkJCXN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKm9sZF9zdGF0
ZSkKIHsKIAlzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpzdGF0ZSA9IHBpcGUtPnBsYW5lLnN0YXRl
OwotCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9ICZwaXBlLT5jcnRjOwogCXN0cnVjdCBkcm1fcmVj
dCByZWN0OwogCiAJaWYgKGRybV9hdG9taWNfaGVscGVyX2RhbWFnZV9tZXJnZWQob2xkX3N0YXRl
LCBzdGF0ZSwgJnJlY3QpKQogCQlyZXBhcGVyX2ZiX2RpcnR5KHN0YXRlLT5mYik7Ci0KLQlpZiAo
Y3J0Yy0+c3RhdGUtPmV2ZW50KSB7Ci0JCXNwaW5fbG9ja19pcnEoJmNydGMtPmRldi0+ZXZlbnRf
bG9jayk7Ci0JCWRybV9jcnRjX3NlbmRfdmJsYW5rX2V2ZW50KGNydGMsIGNydGMtPnN0YXRlLT5l
dmVudCk7Ci0JCXNwaW5fdW5sb2NrX2lycSgmY3J0Yy0+ZGV2LT5ldmVudF9sb2NrKTsKLQkJY3J0
Yy0+c3RhdGUtPmV2ZW50ID0gTlVMTDsKLQl9CiB9CiAKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJt
X3NpbXBsZV9kaXNwbGF5X3BpcGVfZnVuY3MgcmVwYXBlcl9waXBlX2Z1bmNzID0gewpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL3Rpbnkvc3Q3NTg2LmMgYi9kcml2ZXJzL2dwdS9kcm0vdGlu
eS9zdDc1ODYuYwppbmRleCAwNjBjYzc1NjE5NGYuLjllZjU1OWRkMzE5MSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL3Rpbnkvc3Q3NTg2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3Rpbnkv
c3Q3NTg2LmMKQEAgLTIzLDcgKzIzLDYgQEAKICNpbmNsdWRlIDxkcm0vZHJtX2dlbV9mcmFtZWJ1
ZmZlcl9oZWxwZXIuaD4KICNpbmNsdWRlIDxkcm0vZHJtX21pcGlfZGJpLmg+CiAjaW5jbHVkZSA8
ZHJtL2RybV9yZWN0Lmg+Ci0jaW5jbHVkZSA8ZHJtL2RybV92YmxhbmsuaD4KIAogLyogY29udHJv
bGxlci1zcGVjaWZpYyBjb21tYW5kcyAqLwogI2RlZmluZSBTVDc1ODZfRElTUF9NT0RFX0dSQVkJ
MHgzOApAQCAtMTU5LDE4ICsxNTgsMTAgQEAgc3RhdGljIHZvaWQgc3Q3NTg2X3BpcGVfdXBkYXRl
KHN0cnVjdCBkcm1fc2ltcGxlX2Rpc3BsYXlfcGlwZSAqcGlwZSwKIAkJCSAgICAgICBzdHJ1Y3Qg
ZHJtX3BsYW5lX3N0YXRlICpvbGRfc3RhdGUpCiB7CiAJc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAq
c3RhdGUgPSBwaXBlLT5wbGFuZS5zdGF0ZTsKLQlzdHJ1Y3QgZHJtX2NydGMgKmNydGMgPSAmcGlw
ZS0+Y3J0YzsKIAlzdHJ1Y3QgZHJtX3JlY3QgcmVjdDsKIAogCWlmIChkcm1fYXRvbWljX2hlbHBl
cl9kYW1hZ2VfbWVyZ2VkKG9sZF9zdGF0ZSwgc3RhdGUsICZyZWN0KSkKIAkJc3Q3NTg2X2ZiX2Rp
cnR5KHN0YXRlLT5mYiwgJnJlY3QpOwotCi0JaWYgKGNydGMtPnN0YXRlLT5ldmVudCkgewotCQlz
cGluX2xvY2tfaXJxKCZjcnRjLT5kZXYtPmV2ZW50X2xvY2spOwotCQlkcm1fY3J0Y19zZW5kX3Zi
bGFua19ldmVudChjcnRjLCBjcnRjLT5zdGF0ZS0+ZXZlbnQpOwotCQlzcGluX3VubG9ja19pcnEo
JmNydGMtPmRldi0+ZXZlbnRfbG9jayk7Ci0JCWNydGMtPnN0YXRlLT5ldmVudCA9IE5VTEw7Ci0J
fQogfQogCiBzdGF0aWMgdm9pZCBzdDc1ODZfcGlwZV9lbmFibGUoc3RydWN0IGRybV9zaW1wbGVf
ZGlzcGxheV9waXBlICpwaXBlLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3VkbC91ZGxf
bW9kZXNldC5jIGIvZHJpdmVycy9ncHUvZHJtL3VkbC91ZGxfbW9kZXNldC5jCmluZGV4IDIyYWYx
Nzk1OTA1My4uZDU5ZWJhYzcwYjE1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdWRsL3Vk
bF9tb2Rlc2V0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3VkbC91ZGxfbW9kZXNldC5jCkBAIC0z
NzUsOCArMzc1LDYgQEAgdWRsX3NpbXBsZV9kaXNwbGF5X3BpcGVfZW5hYmxlKHN0cnVjdCBkcm1f
c2ltcGxlX2Rpc3BsYXlfcGlwZSAqcGlwZSwKIAljaGFyICp3cnB0cjsKIAlpbnQgY29sb3JfZGVw
dGggPSBVRExfQ09MT1JfREVQVEhfMTZCUFA7CiAKLQljcnRjX3N0YXRlLT5ub192YmxhbmsgPSB0
cnVlOwotCiAJYnVmID0gKGNoYXIgKil1ZGwtPm1vZGVfYnVmOwogCiAJLyogVGhpcyBmaXJzdCBz
ZWN0aW9uIGhhcyB0byBkbyB3aXRoIHNldHRpbmcgdGhlIGJhc2UgYWRkcmVzcyBvbiB0aGUKQEAg
LTQyOCwxNCArNDI2LDYgQEAgdWRsX3NpbXBsZV9kaXNwbGF5X3BpcGVfZGlzYWJsZShzdHJ1Y3Qg
ZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGUgKnBpcGUpCiAJdWRsX3N1Ym1pdF91cmIoZGV2LCB1cmIs
IGJ1ZiAtIChjaGFyICopdXJiLT50cmFuc2Zlcl9idWZmZXIpOwogfQogCi1zdGF0aWMgaW50Ci11
ZGxfc2ltcGxlX2Rpc3BsYXlfcGlwZV9jaGVjayhzdHJ1Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3Bp
cGUgKnBpcGUsCi0JCQkgICAgICBzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwK
LQkJCSAgICAgIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKLXsKLQlyZXR1cm4g
MDsKLX0KLQogc3RhdGljIHZvaWQKIHVkbF9zaW1wbGVfZGlzcGxheV9waXBlX3VwZGF0ZShzdHJ1
Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGUgKnBpcGUsCiAJCQkgICAgICAgc3RydWN0IGRybV9w
bGFuZV9zdGF0ZSAqb2xkX3BsYW5lX3N0YXRlKQpAQCAtNDU3LDcgKzQ0Nyw2IEBAIHN0cnVjdCBk
cm1fc2ltcGxlX2Rpc3BsYXlfcGlwZV9mdW5jcyB1ZGxfc2ltcGxlX2Rpc3BsYXlfcGlwZV9mdW5j
cyA9IHsKIAkubW9kZV92YWxpZCA9IHVkbF9zaW1wbGVfZGlzcGxheV9waXBlX21vZGVfdmFsaWQs
CiAJLmVuYWJsZSA9IHVkbF9zaW1wbGVfZGlzcGxheV9waXBlX2VuYWJsZSwKIAkuZGlzYWJsZSA9
IHVkbF9zaW1wbGVfZGlzcGxheV9waXBlX2Rpc2FibGUsCi0JLmNoZWNrID0gdWRsX3NpbXBsZV9k
aXNwbGF5X3BpcGVfY2hlY2ssCiAJLnVwZGF0ZSA9IHVkbF9zaW1wbGVfZGlzcGxheV9waXBlX3Vw
ZGF0ZSwKIAkucHJlcGFyZV9mYiA9IGRybV9nZW1fZmJfc2ltcGxlX2Rpc3BsYXlfcGlwZV9wcmVw
YXJlX2ZiLAogfTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS94ZW4veGVuX2RybV9mcm9u
dF9rbXMuYyBiL2RyaXZlcnMvZ3B1L2RybS94ZW4veGVuX2RybV9mcm9udF9rbXMuYwppbmRleCA0
ZjM0YzUyMDgxODAuLjhlYzI5ZDVkMzM1MyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3hl
bi94ZW5fZHJtX2Zyb250X2ttcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS94ZW4veGVuX2RybV9m
cm9udF9rbXMuYwpAQCAtMjIwLDYgKzIyMCwxOCBAQCBzdGF0aWMgYm9vbCBkaXNwbGF5X3NlbmRf
cGFnZV9mbGlwKHN0cnVjdCBkcm1fc2ltcGxlX2Rpc3BsYXlfcGlwZSAqcGlwZSwKIAlyZXR1cm4g
ZmFsc2U7CiB9CiAKK3N0YXRpYyBpbnQgZGlzcGxheV9jaGVjayhzdHJ1Y3QgZHJtX3NpbXBsZV9k
aXNwbGF5X3BpcGUgKnBpcGUsCisJCQkgc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqcGxhbmVfc3Rh
dGUsCisJCQkgc3RydWN0IGRybV9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQoreworCS8qIE1ha2Ug
c3VyZSB0aGUgc2ltcGxlIERSTSBoZWxwZXJzIGRvbid0IGVuYWJsZSBWQkxBTksKKwkgKiBnZW5l
cmF0aW9uLiBYZW4gaGFzIGl0J3Mgb3duIGxvZ2ljIHRvIGRvIHNvLgorCSAqLworCWNydGNfc3Rh
dGUtPm5vX3ZibGFuayA9IGZhbHNlOworCisJcmV0dXJuIDA7Cit9CisKIHN0YXRpYyB2b2lkIGRp
c3BsYXlfdXBkYXRlKHN0cnVjdCBkcm1fc2ltcGxlX2Rpc3BsYXlfcGlwZSAqcGlwZSwKIAkJCSAg
IHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKm9sZF9wbGFuZV9zdGF0ZSkKIHsKQEAgLTI4NCw2ICsy
OTYsNyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlX2Z1bmNz
IGRpc3BsYXlfZnVuY3MgPSB7CiAJLmVuYWJsZSA9IGRpc3BsYXlfZW5hYmxlLAogCS5kaXNhYmxl
ID0gZGlzcGxheV9kaXNhYmxlLAogCS5wcmVwYXJlX2ZiID0gZHJtX2dlbV9mYl9zaW1wbGVfZGlz
cGxheV9waXBlX3ByZXBhcmVfZmIsCisJLmNoZWNrID0gZGlzcGxheV9jaGVjaywKIAkudXBkYXRl
ID0gZGlzcGxheV91cGRhdGUsCiB9OwogCi0tIAoyLjI0LjEKCgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1k
ZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21h
aWxtYW4vbGlzdGluZm8veGVuLWRldmVs

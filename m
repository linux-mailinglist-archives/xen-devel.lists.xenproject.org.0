Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 2F978B803E
	for <lists+xen-devel@lfdr.de>; Thu, 19 Sep 2019 19:43:48 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iB0Qw-0004va-Lk; Thu, 19 Sep 2019 17:41:34 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=vwgP=XO=citrix.com=anthony.perard@srs-us1.protection.inumbo.net>)
 id 1iB0Qv-0004u4-6h
 for xen-devel@lists.xenproject.org; Thu, 19 Sep 2019 17:41:33 +0000
X-Inumbo-ID: af3b90aa-db04-11e9-978d-bc764e2007e4
Received: from esa5.hc3370-68.iphmx.com (unknown [216.71.155.168])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id af3b90aa-db04-11e9-978d-bc764e2007e4;
 Thu, 19 Sep 2019 17:41:17 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1568914877;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=I5GOTjkWyrkZ0RQDztLKaC6Ig0iqextS75xs8JPRgxc=;
 b=GCAeu0l5vz2w1QZJUIxECBBu8T2mj42EzvIRrengK0V+11Oxl/TRZ4zz
 vYOTIYgOs/6c/rnZa+EYXLGorOKOTafQpcbVfOeKYekkCPbg+0XcZAQp3
 gL0yq9nfi1Weas8WdNLOOsefr7xqVwIc5dc+7o00ND0/1obtYigeRa+/U I=;
Authentication-Results: esa5.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=anthony.perard@citrix.com;
 spf=Pass smtp.mailfrom=anthony.perard@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa5.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 anthony.perard@citrix.com) identity=pra;
 client-ip=162.221.158.21; receiver=esa5.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="anthony.perard@citrix.com";
 x-conformance=sidf_compatible
Received-SPF: Pass (esa5.hc3370-68.iphmx.com: domain of
 anthony.perard@citrix.com designates 162.221.158.21 as
 permitted sender) identity=mailfrom;
 client-ip=162.221.158.21; receiver=esa5.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="anthony.perard@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83 ~all"
Received-SPF: None (esa5.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa5.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: 6GtLjN3SpSY+xhfhj89cb2YqD+WKQnGKgEKZl3+WfiTwcd5Z+fr0zc1xQntAr99PlDCsfuiMai
 O+LO5OJT1ofu5WMfegP2/O276KkSscqp5Zunp2HkcXZ+gTUZK7Dz5TaKYxsWFTSuvrazDgjx3k
 abOB0B9wkIlNIBeCWUgSRZMyup6dwxYGm3zxkp1RoAjCfVHpJR4od2ddOCFa64JIvAmsUoSK8P
 zyYejKt6Fe9eOdGX5+9UYuUk0PKZU3gMJZtQLVV5pHmcs1NFmar53XjZjx84h/9jlKB9S0KmmL
 FRw=
X-SBRS: 2.7
X-MesageID: 6010798
X-Ironport-Server: esa5.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.64,524,1559534400"; 
   d="scan'208";a="6010798"
From: Anthony PERARD <anthony.perard@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Thu, 19 Sep 2019 18:16:49 +0100
Message-ID: <20190919171656.899649-30-anthony.perard@citrix.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190919171656.899649-1-anthony.perard@citrix.com>
References: <20190919171656.899649-1-anthony.perard@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v2 29/35] libxl_pci: Use libxl__ao_device with
 pci_remove
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Anthony PERARD <anthony.perard@citrix.com>, Ian
 Jackson <ian.jackson@eu.citrix.com>, Wei Liu <wl@xen.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhpcyBpcyBpbiBwcmVwYXJhdGlvbiBvZiB1c2luZyBhc3luY2hyb25vdXMgb3BlcmF0aW9uIHRv
IGNvbW11bmljYXRlCndpdGggUUVNVSB2aWEgUU1QIChsaWJ4bF9fZXZfcW1wKS4KClNpZ25lZC1v
ZmYtYnk6IEFudGhvbnkgUEVSQVJEIDxhbnRob255LnBlcmFyZEBjaXRyaXguY29tPgpBY2tlZC1i
eTogSWFuIEphY2tzb24gPGlhbi5qYWNrc29uQGV1LmNpdHJpeC5jb20+Ci0tLQogdG9vbHMvbGli
eGwvbGlieGxfZG9tYWluLmMgICB8ICA0OSArKysrKystLQogdG9vbHMvbGlieGwvbGlieGxfaW50
ZXJuYWwuaCB8ICAgNiArLQogdG9vbHMvbGlieGwvbGlieGxfcGNpLmMgICAgICB8IDIyMSArKysr
KysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLQogMyBmaWxlcyBjaGFuZ2VkLCAyMTAgaW5z
ZXJ0aW9ucygrKSwgNjYgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGli
eGxfZG9tYWluLmMgYi90b29scy9saWJ4bC9saWJ4bF9kb21haW4uYwppbmRleCBmM2MzOWZhODZm
YzkuLmNkNzE5MDAzNTAwNSAxMDA2NDQKLS0tIGEvdG9vbHMvbGlieGwvbGlieGxfZG9tYWluLmMK
KysrIGIvdG9vbHMvbGlieGwvbGlieGxfZG9tYWluLmMKQEAgLTExMDQsNiArMTEwNCw5IEBAIHN0
YXRpYyB2b2lkIGRlc3Ryb3lfZmluaXNoX2NoZWNrKGxpYnhsX19lZ2MgKmVnYywKIH0KIAogLyog
Q2FsbGJhY2tzIGZvciBsaWJ4bF9fZGVzdHJveV9kb21pZCAqLworc3RhdGljIHZvaWQgZGVzdHJv
eV9kb21pZF9wY2lfZG9uZShsaWJ4bF9fZWdjICplZ2MsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIGxpYnhsX19tdWx0aWRldiAqbXVsdGlkZXYsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGludCByYyk7CiBzdGF0aWMgdm9pZCBkbV9kZXN0cm95X2NiKGxp
YnhsX19lZ2MgKmVnYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlieGxfX2Rlc3Ryb3lf
ZGV2aWNlbW9kZWxfc3RhdGUgKmRkbXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBy
Yyk7CkBAIC0xMTIwLDggKzExMjMsNyBAQCB2b2lkIGxpYnhsX19kZXN0cm95X2RvbWlkKGxpYnhs
X19lZ2MgKmVnYywgbGlieGxfX2Rlc3Ryb3lfZG9taWRfc3RhdGUgKmRpcykKIHsKICAgICBTVEFU
RV9BT19HQyhkaXMtPmFvKTsKICAgICB1aW50MzJfdCBkb21pZCA9IGRpcy0+ZG9taWQ7Ci0gICAg
aW50IHJjLCBkbV9wcmVzZW50OwotICAgIGludCByOworICAgIGludCByYzsKIAogICAgIGxpYnhs
X19ldl9jaGlsZF9pbml0KCZkaXMtPmRlc3Ryb3llcik7CiAKQEAgLTExMzUsNiArMTEzNyw0MSBA
QCB2b2lkIGxpYnhsX19kZXN0cm95X2RvbWlkKGxpYnhsX19lZ2MgKmVnYywgbGlieGxfX2Rlc3Ry
b3lfZG9taWRfc3RhdGUgKmRpcykKICAgICAgICAgZ290byBvdXQ7CiAgICAgfQogCisgICAgbGli
eGxfX211bHRpZGV2X2JlZ2luKGFvLCAmZGlzLT5tdWx0aWRldik7CisgICAgZGlzLT5tdWx0aWRl
di5jYWxsYmFjayA9IGRlc3Ryb3lfZG9taWRfcGNpX2RvbmU7CisgICAgbGlieGxfX2RldmljZV9w
Y2lfZGVzdHJveV9hbGwoZWdjLCBkb21pZCwgJmRpcy0+bXVsdGlkZXYpOworICAgIGxpYnhsX19t
dWx0aWRldl9wcmVwYXJlZChlZ2MsICZkaXMtPm11bHRpZGV2LCAwKTsKKyAgICByZXR1cm47CisK
K291dDoKKyAgICBhc3NlcnQocmMpOworICAgIGRpcy0+Y2FsbGJhY2soZWdjLCBkaXMsIHJjKTsK
K30KKworc3RhdGljIHZvaWQgZGVzdHJveV9kb21pZF9wY2lfZG9uZShsaWJ4bF9fZWdjICplZ2Ms
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnhsX19tdWx0aWRldiAqbXVs
dGlkZXYsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCByYykKK3sKKyAg
ICBTVEFURV9BT19HQyhtdWx0aWRldi0+YW8pOworICAgIGxpYnhsX19kZXN0cm95X2RvbWlkX3N0
YXRlICpkaXMgPQorICAgICAgICBDT05UQUlORVJfT0YobXVsdGlkZXYsICpkaXMsIG11bHRpZGV2
KTsKKyAgICBpbnQgZG1fcHJlc2VudDsKKyAgICBpbnQgcjsKKworICAgIC8qIENvbnZlbmllbmNl
IGFsaWFzZXMgKi8KKyAgICBsaWJ4bF9kb21pZCBkb21pZCA9IGRpcy0+ZG9taWQ7CisKKyAgICBp
ZiAocmMpIHsKKyAgICAgICAgTE9HRChFUlJPUiwgZG9taWQsICJQY2kgc2h1dGRvd24gZmFpbGVk
Iik7CisgICAgICAgIGdvdG8gb3V0OworICAgIH0KKworICAgIHIgPSB4Y19kb21haW5fcGF1c2Uo
Q1RYLT54Y2gsIGRvbWlkKTsKKyAgICBpZiAociA8IDApIHsKKyAgICAgICAgTE9HRVZEKEVSUk9S
LCByLCBkb21pZCwgInhjX2RvbWFpbl9wYXVzZSBmYWlsZWQiKTsKKyAgICAgICAgcmMgPSBFUlJP
Ul9GQUlMOworICAgIH0KKwogICAgIHN3aXRjaCAobGlieGxfX2RvbWFpbl90eXBlKGdjLCBkb21p
ZCkpIHsKICAgICBjYXNlIExJQlhMX0RPTUFJTl9UWVBFX0hWTToKICAgICAgICAgaWYgKGxpYnhs
X2dldF9zdHViZG9tX2lkKENUWCwgZG9taWQpKSB7CkBAIC0xMTUzLDE0ICsxMTkwLDYgQEAgdm9p
ZCBsaWJ4bF9fZGVzdHJveV9kb21pZChsaWJ4bF9fZWdjICplZ2MsIGxpYnhsX19kZXN0cm95X2Rv
bWlkX3N0YXRlICpkaXMpCiAgICAgICAgIGFib3J0KCk7CiAgICAgfQogCi0gICAgaWYgKGxpYnhs
X19kZXZpY2VfcGNpX2Rlc3Ryb3lfYWxsKGdjLCBkb21pZCkgPCAwKQotICAgICAgICBMT0dEKEVS
Uk9SLCBkb21pZCwgIlBjaSBzaHV0ZG93biBmYWlsZWQiKTsKLSAgICByID0geGNfZG9tYWluX3Bh
dXNlKENUWC0+eGNoLCBkb21pZCk7Ci0gICAgaWYgKHIgPCAwKSB7Ci0gICAgICAgIExPR0VWRChF
UlJPUiwgciwgZG9taWQsICJ4Y19kb21haW5fcGF1c2UgZmFpbGVkIik7Ci0gICAgICAgIHJjID0g
RVJST1JfRkFJTDsKLSAgICB9Ci0KICAgICBpZiAoZG1fcHJlc2VudCkgewogICAgICAgICBkaXMt
PmRkbXMuYW8gPSBhbzsKICAgICAgICAgZGlzLT5kZG1zLmRvbWlkID0gZG9taWQ7CmRpZmYgLS1n
aXQgYS90b29scy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5oIGIvdG9vbHMvbGlieGwvbGlieGxfaW50
ZXJuYWwuaAppbmRleCBkNjBiOWM0MTZhYmYuLjc4MmNiZmMwOWFmYiAxMDA2NDQKLS0tIGEvdG9v
bHMvbGlieGwvbGlieGxfaW50ZXJuYWwuaAorKysgYi90b29scy9saWJ4bC9saWJ4bF9pbnRlcm5h
bC5oCkBAIC0xOTksNiArMTk5LDcgQEAgdHlwZWRlZiBzdHJ1Y3QgbGlieGxfX2NhcmVmZCBsaWJ4
bF9fY2FyZWZkOwogdHlwZWRlZiBzdHJ1Y3QgbGlieGxfX2V2X2RldmxvY2sgbGlieGxfX2V2X2Rl
dmxvY2s7CiB0eXBlZGVmIHN0cnVjdCBsaWJ4bF9fZG1fcmVzdW1lX3N0YXRlIGxpYnhsX19kbV9y
ZXN1bWVfc3RhdGU7CiB0eXBlZGVmIHN0cnVjdCBsaWJ4bF9fYW9fZGV2aWNlIGxpYnhsX19hb19k
ZXZpY2U7Cit0eXBlZGVmIHN0cnVjdCBsaWJ4bF9fbXVsdGlkZXYgbGlieGxfX211bHRpZGV2Owog
CiB0eXBlZGVmIHN0cnVjdCBsaWJ4bF9fZG9tYWluX2NyZWF0ZV9zdGF0ZSBsaWJ4bF9fZG9tYWlu
X2NyZWF0ZV9zdGF0ZTsKIHR5cGVkZWYgdm9pZCBsaWJ4bF9fZG9tYWluX2NyZWF0ZV9jYihzdHJ1
Y3QgbGlieGxfX2VnYyAqZWdjLApAQCAtMTU5Nyw3ICsxNTk4LDggQEAgX2hpZGRlbiBpbnQgbGli
eGxfX3BjaV90b3BvbG9neV9pbml0KGxpYnhsX19nYyAqZ2MsCiBfaGlkZGVuIHZvaWQgbGlieGxf
X2RldmljZV9wY2lfYWRkKGxpYnhsX19lZ2MgKmVnYywgdWludDMyX3QgZG9taWQsCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnhsX2RldmljZV9wY2kgKnBjaWRldiwgYm9v
bCBzdGFydGluZywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlieGxfX2Fv
X2RldmljZSAqYW9kZXYpOwotX2hpZGRlbiBpbnQgbGlieGxfX2RldmljZV9wY2lfZGVzdHJveV9h
bGwobGlieGxfX2djICpnYywgdWludDMyX3QgZG9taWQpOworX2hpZGRlbiB2b2lkIGxpYnhsX19k
ZXZpY2VfcGNpX2Rlc3Ryb3lfYWxsKGxpYnhsX19lZ2MgKmVnYywgdWludDMyX3QgZG9taWQsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlieGxfX211bHRpZGV2
ICopOwogX2hpZGRlbiBib29sIGxpYnhsX19pc19pZ2RfdmdhX3Bhc3N0aHJ1KGxpYnhsX19nYyAq
Z2MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGlieGxf
ZG9tYWluX2NvbmZpZyAqZF9jb25maWcpOwogCkBAIC0yNTczLDcgKzI1NzUsNiBAQCBfaGlkZGVu
IHZvaWQgbGlieGxfX2tpbGwobGlieGxfX2djICpnYywgcGlkX3QgcGlkLCBpbnQgc2lnLCBjb25z
dCBjaGFyICp3aGF0KTsKIAogLyotLS0tLSBkZXZpY2UgYWRkaXRpb24vcmVtb3ZhbCAtLS0tLSov
CiAKLXR5cGVkZWYgc3RydWN0IGxpYnhsX19tdWx0aWRldiBsaWJ4bF9fbXVsdGlkZXY7CiB0eXBl
ZGVmIHZvaWQgbGlieGxfX2RldmljZV9jYWxsYmFjayhsaWJ4bF9fZWdjKiwgbGlieGxfX2FvX2Rl
dmljZSopOwogCiAvKiBUaGlzIGZ1bmN0aW9ucyBzZXRzIHRoZSBuZWNlc3NhcnkgbGlieGxfX2Fv
X2RldmljZSBzdHJ1Y3QgdmFsdWVzIHRvIHVzZQpAQCAtMzkyNCw2ICszOTI1LDcgQEAgc3RydWN0
IGxpYnhsX19kZXN0cm95X2RvbWlkX3N0YXRlIHsKICAgICBsaWJ4bF9fZGVzdHJveV9kZXZpY2Vt
b2RlbF9zdGF0ZSBkZG1zOwogICAgIGxpYnhsX19ldl9jaGlsZCBkZXN0cm95ZXI7CiAgICAgYm9v
bCBzb2Z0X3Jlc2V0OworICAgIGxpYnhsX19tdWx0aWRldiBtdWx0aWRldjsKIH07CiAKIHN0cnVj
dCBsaWJ4bF9fZG9tYWluX2Rlc3Ryb3lfc3RhdGUgewpkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwv
bGlieGxfcGNpLmMgYi90b29scy9saWJ4bC9saWJ4bF9wY2kuYwppbmRleCAzNDc3ZjNhYmE2MDUu
LmE1ZjcwMGYwYmY2NCAxMDA2NDQKLS0tIGEvdG9vbHMvbGlieGwvbGlieGxfcGNpLmMKKysrIGIv
dG9vbHMvbGlieGwvbGlieGxfcGNpLmMKQEAgLTE3MzAsMjQgKzE3MzAsNDcgQEAgc3RhdGljIGlu
dCBxZW11X3BjaV9yZW1vdmVfeGVuc3RvcmUobGlieGxfX2djICpnYywgdWludDMyX3QgZG9taWQs
CiAgICAgcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBpbnQgbGlieGxfX2RldmljZV9wY2lfcmVtb3Zl
X2NvbW1vbihsaWJ4bF9fZ2MgKmdjLCB1aW50MzJfdCBkb21pZCwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ4bF9kZXZpY2VfcGNpICpwY2lkZXYsIGludCBm
b3JjZSk7Ci0KLXN0YXRpYyBpbnQgZG9fcGNpX3JlbW92ZShsaWJ4bF9fZ2MgKmdjLCB1aW50MzJf
dCBkb21pZCwKLSAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ4bF9kZXZpY2VfcGNpICpwY2lk
ZXYsIGludCBmb3JjZSkKK3R5cGVkZWYgc3RydWN0IHBjaV9yZW1vdmVfc3RhdGUgeworICAgIGxp
YnhsX19hb19kZXZpY2UgKmFvZGV2OworICAgIGxpYnhsX2RvbWlkIGRvbWlkOworICAgIGxpYnhs
X2RldmljZV9wY2kgKnBjaWRldjsKKyAgICBib29sIGZvcmNlOworICAgIGJvb2wgaHZtOworICAg
IHVuc2lnbmVkIGludCBvcmlnX3ZkZXY7CisgICAgdW5zaWduZWQgaW50IHBmdW5jX21hc2s7Cisg
ICAgaW50IG5leHRfZnVuYzsKKyAgICBsaWJ4bF9fYW9fZGV2aWNlIHN0dWJkb21fYW9kZXY7Cit9
IHBjaV9yZW1vdmVfc3RhdGU7CisKK3N0YXRpYyB2b2lkIGxpYnhsX19kZXZpY2VfcGNpX3JlbW92
ZV9jb21tb24obGlieGxfX2VnYyAqZWdjLAorICAgIHVpbnQzMl90IGRvbWlkLCBsaWJ4bF9kZXZp
Y2VfcGNpICpwY2lkZXYsIGJvb2wgZm9yY2UsCisgICAgbGlieGxfX2FvX2RldmljZSAqYW9kZXYp
Oworc3RhdGljIHZvaWQgZGV2aWNlX3BjaV9yZW1vdmVfY29tbW9uX25leHQobGlieGxfX2VnYyAq
ZWdjLAorICAgIHBjaV9yZW1vdmVfc3RhdGUgKnBycywgaW50IHJjKTsKK3N0YXRpYyB2b2lkIHBj
aV9yZW1vdmVfZGV0YXRjaGVkKGxpYnhsX19lZ2MgKmVnYywKKyAgICBwY2lfcmVtb3ZlX3N0YXRl
ICpwcnMsIGludCByYyk7CitzdGF0aWMgdm9pZCBwY2lfcmVtb3ZlX3N0dWJkb21fZG9uZShsaWJ4
bF9fZWdjICplZ2MsCisgICAgbGlieGxfX2FvX2RldmljZSAqYW9kZXYpOworc3RhdGljIHZvaWQg
cGNpX3JlbW92ZV9kb25lKGxpYnhsX19lZ2MgKmVnYywKKyAgICBwY2lfcmVtb3ZlX3N0YXRlICpw
cnMsIGludCByYyk7CisKK3N0YXRpYyB2b2lkIGRvX3BjaV9yZW1vdmUobGlieGxfX2VnYyAqZWdj
LCB1aW50MzJfdCBkb21pZCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgbGlieGxfZGV2aWNl
X3BjaSAqcGNpZGV2LCBpbnQgZm9yY2UsCisgICAgICAgICAgICAgICAgICAgICAgICAgIHBjaV9y
ZW1vdmVfc3RhdGUgKnBycykKIHsKKyAgICBTVEFURV9BT19HQyhwcnMtPmFvZGV2LT5hbyk7CiAg
ICAgbGlieGxfY3R4ICpjdHggPSBsaWJ4bF9fZ2Nfb3duZXIoZ2MpOwogICAgIGxpYnhsX2Rldmlj
ZV9wY2kgKmFzc2lnbmVkOwogICAgIGxpYnhsX2RvbWFpbl90eXBlIHR5cGUgPSBsaWJ4bF9fZG9t
YWluX3R5cGUoZ2MsIGRvbWlkKTsKLSAgICBpbnQgaHZtID0gMCwgcmMsIG51bTsKLSAgICBpbnQg
c3R1YmRvbWlkID0gMDsKKyAgICBpbnQgcmMsIG51bTsKICAgICB1aW50MzJfdCBkb21haW5pZCA9
IGRvbWlkOwotICAgIGJvb2wgaXNzdHViZG9tID0gbGlieGxfaXNfc3R1YmRvbShjdHgsIGRvbWlk
LCAmZG9tYWluaWQpOwotCiAKICAgICBhc3NpZ25lZCA9IGxpYnhsX2RldmljZV9wY2lfbGlzdChj
dHgsIGRvbWlkLCAmbnVtKTsKLSAgICBpZiAoIGFzc2lnbmVkID09IE5VTEwgKQotICAgICAgICBy
ZXR1cm4gRVJST1JfRkFJTDsKKyAgICBpZiAoYXNzaWduZWQgPT0gTlVMTCkgeworICAgICAgICBy
YyA9IEVSUk9SX0ZBSUw7CisgICAgICAgIGdvdG8gb3V0X2ZhaWw7CisgICAgfQorICAgIGxpYnhs
X19wdHJfYWRkKGdjLCBhc3NpZ25lZCk7CiAKICAgICByYyA9IEVSUk9SX0lOVkFMOwogICAgIGlm
ICggIWlzX3BjaWRldl9pbl9hcnJheShhc3NpZ25lZCwgbnVtLCBwY2lkZXYtPmRvbWFpbiwKQEAg
LTE3NTgsNyArMTc4MSw3IEBAIHN0YXRpYyBpbnQgZG9fcGNpX3JlbW92ZShsaWJ4bF9fZ2MgKmdj
LCB1aW50MzJfdCBkb21pZCwKIAogICAgIHJjID0gRVJST1JfRkFJTDsKICAgICBpZiAodHlwZSA9
PSBMSUJYTF9ET01BSU5fVFlQRV9IVk0pIHsKLSAgICAgICAgaHZtID0gMTsKKyAgICAgICAgcHJz
LT5odm0gPSB0cnVlOwogICAgICAgICBzd2l0Y2ggKGxpYnhsX19kZXZpY2VfbW9kZWxfdmVyc2lv
bl9ydW5uaW5nKGdjLCBkb21pZCkpIHsKICAgICAgICAgY2FzZSBMSUJYTF9ERVZJQ0VfTU9ERUxf
VkVSU0lPTl9RRU1VX1hFTl9UUkFESVRJT05BTDoKICAgICAgICAgICAgIGlmIChsaWJ4bF9fd2Fp
dF9mb3JfZGV2aWNlX21vZGVsX2RlcHJlY2F0ZWQoZ2MsIGRvbWlkLApAQCAtMTgyMSw3ICsxODQ0
LDcgQEAgc3RhdGljIGludCBkb19wY2lfcmVtb3ZlKGxpYnhsX19nYyAqZ2MsIHVpbnQzMl90IGRv
bWlkLAogICAgICAgICBmID0gZm9wZW4oc3lzZnNfcGF0aCwgInIiKTsKICAgICAgICAgaWYgKGYg
PT0gTlVMTCkgewogICAgICAgICAgICAgTE9HRUQoRVJST1IsIGRvbWFpbmlkLCAiQ291bGRuJ3Qg
b3BlbiAlcyIsIHN5c2ZzX3BhdGgpOwotICAgICAgICAgICAgZ290byBvdXQ7CisgICAgICAgICAg
ICBnb3RvIHNraXBfaXJxOwogICAgICAgICB9CiAgICAgICAgIGlmICgoZnNjYW5mKGYsICIldSIs
ICZpcnEpID09IDEpICYmIGlycSkgewogICAgICAgICAgICAgcmMgPSB4Y19waHlzZGV2X3VubWFw
X3BpcnEoY3R4LT54Y2gsIGRvbWlkLCBpcnEpOwpAQCAtMTgzNSw1MiArMTg1OCwxMzQgQEAgc3Rh
dGljIGludCBkb19wY2lfcmVtb3ZlKGxpYnhsX19nYyAqZ2MsIHVpbnQzMl90IGRvbWlkLAogICAg
ICAgICB9CiAgICAgICAgIGZjbG9zZShmKTsKICAgICB9Ci1vdXQ6Citza2lwX2lycToKKyAgICBy
YyA9IDA7CitvdXRfZmFpbDoKKyAgICBwY2lfcmVtb3ZlX2RldGF0Y2hlZChlZ2MsIHBycywgcmMp
OworfQorCitzdGF0aWMgdm9pZCBwY2lfcmVtb3ZlX2RldGF0Y2hlZChsaWJ4bF9fZWdjICplZ2Ms
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwY2lfcmVtb3ZlX3N0YXRlICpwcnMs
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgcmMpCit7CisgICAgU1RBVEVf
QU9fR0MocHJzLT5hb2Rldi0+YW8pOworICAgIGludCBzdHViZG9taWQgPSAwOworICAgIHVpbnQz
Ml90IGRvbWFpbmlkID0gcHJzLT5kb21pZDsKKyAgICBib29sIGlzc3R1YmRvbTsKKworICAgIC8q
IENvbnZlbmllbmNlIGFsaWFzZXMgKi8KKyAgICBsaWJ4bF9kZXZpY2VfcGNpICpjb25zdCBwY2lk
ZXYgPSBwcnMtPnBjaWRldjsKKyAgICBsaWJ4bF9kb21pZCBkb21pZCA9IHBycy0+ZG9taWQ7CisK
KyAgICBpZiAocmMpIGdvdG8gb3V0OworCisgICAgaXNzdHViZG9tID0gbGlieGxfaXNfc3R1YmRv
bShDVFgsIGRvbWlkLCAmZG9tYWluaWQpOworCiAgICAgLyogZG9uJ3QgZG8gbXVsdGlwbGUgcmVz
ZXRzIHdoaWxlIHNvbWUgZnVuY3Rpb25zIGFyZSBzdGlsbCBwYXNzZWQgdGhyb3VnaCAqLwogICAg
IGlmICggKHBjaWRldi0+dmRldmZuICYgMHg3KSA9PSAwICkgewogICAgICAgICBsaWJ4bF9fZGV2
aWNlX3BjaV9yZXNldChnYywgcGNpZGV2LT5kb21haW4sIHBjaWRldi0+YnVzLCBwY2lkZXYtPmRl
diwgcGNpZGV2LT5mdW5jKTsKICAgICB9CiAKICAgICBpZiAoIWlzc3R1YmRvbSkgewotICAgICAg
ICByYyA9IHhjX2RlYXNzaWduX2RldmljZShjdHgtPnhjaCwgZG9taWQsIHBjaWRldl9lbmNvZGVf
YmRmKHBjaWRldikpOwotICAgICAgICBpZiAocmMgPCAwICYmIChodm0gfHwgZXJybm8gIT0gRU5P
U1lTKSkKKyAgICAgICAgcmMgPSB4Y19kZWFzc2lnbl9kZXZpY2UoQ1RYLT54Y2gsIGRvbWlkLCBw
Y2lkZXZfZW5jb2RlX2JkZihwY2lkZXYpKTsKKyAgICAgICAgaWYgKHJjIDwgMCAmJiAocHJzLT5o
dm0gfHwgZXJybm8gIT0gRU5PU1lTKSkKICAgICAgICAgICAgIExPR0VEKEVSUk9SLCBkb21haW5p
ZCwgInhjX2RlYXNzaWduX2RldmljZSBmYWlsZWQiKTsKICAgICB9CiAKLSAgICBzdHViZG9taWQg
PSBsaWJ4bF9nZXRfc3R1YmRvbV9pZChjdHgsIGRvbWlkKTsKKyAgICBzdHViZG9taWQgPSBsaWJ4
bF9nZXRfc3R1YmRvbV9pZChDVFgsIGRvbWlkKTsKICAgICBpZiAoc3R1YmRvbWlkICE9IDApIHsK
LSAgICAgICAgbGlieGxfZGV2aWNlX3BjaSBwY2lkZXZfcyA9ICpwY2lkZXY7Ci0gICAgICAgIGxp
YnhsX19kZXZpY2VfcGNpX3JlbW92ZV9jb21tb24oZ2MsIHN0dWJkb21pZCwgJnBjaWRldl9zLCBm
b3JjZSk7Ci0gICAgfQorICAgICAgICBsaWJ4bF9kZXZpY2VfcGNpICpwY2lkZXZfczsKKyAgICAg
ICAgbGlieGxfX2FvX2RldmljZSAqY29uc3Qgc3R1YmRvbV9hb2RldiA9ICZwcnMtPnN0dWJkb21f
YW9kZXY7CisKKyAgICAgICAgR0NORVcocGNpZGV2X3MpOworICAgICAgICBsaWJ4bF9kZXZpY2Vf
cGNpX2luaXQocGNpZGV2X3MpOworICAgICAgICBsaWJ4bF9kZXZpY2VfcGNpX2NvcHkoQ1RYLCBw
Y2lkZXZfcywgcGNpZGV2KTsKIAotICAgIGxpYnhsX19kZXZpY2VfcGNpX3JlbW92ZV94ZW5zdG9y
ZShnYywgZG9taWQsIHBjaWRldik7CisgICAgICAgIGxpYnhsX19wcmVwYXJlX2FvX2RldmljZShh
bywgc3R1YmRvbV9hb2Rldik7CisgICAgICAgIHN0dWJkb21fYW9kZXYtPmFjdGlvbiA9IExJQlhM
X19ERVZJQ0VfQUNUSU9OX1JFTU9WRTsKKyAgICAgICAgc3R1YmRvbV9hb2Rldi0+Y2FsbGJhY2sg
PSBwY2lfcmVtb3ZlX3N0dWJkb21fZG9uZTsKKyAgICAgICAgc3R1YmRvbV9hb2Rldi0+dXBkYXRl
X2pzb24gPSBwcnMtPmFvZGV2LT51cGRhdGVfanNvbjsKKyAgICAgICAgbGlieGxfX2RldmljZV9w
Y2lfcmVtb3ZlX2NvbW1vbihlZ2MsIHN0dWJkb21pZCwgcGNpZGV2X3MsCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJzLT5mb3JjZSwgc3R1YmRvbV9hb2Rldik7Cisg
ICAgICAgIHJldHVybjsKKyAgICB9CiAKICAgICByYyA9IDA7Ci1vdXRfZmFpbDoKLSAgICBmcmVl
KGFzc2lnbmVkKTsKLSAgICByZXR1cm4gcmM7CitvdXQ6CisgICAgcGNpX3JlbW92ZV9kb25lKGVn
YywgcHJzLCByYyk7Cit9CisKK3N0YXRpYyB2b2lkIHBjaV9yZW1vdmVfc3R1YmRvbV9kb25lKGxp
YnhsX19lZ2MgKmVnYywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnhs
X19hb19kZXZpY2UgKmFvZGV2KQoreworICAgIHBjaV9yZW1vdmVfc3RhdGUgKnBycyA9IENPTlRB
SU5FUl9PRihhb2RldiwgKnBycywgc3R1YmRvbV9hb2Rldik7CiAKKyAgICBwY2lfcmVtb3ZlX2Rv
bmUoZWdjLCBwcnMsIDApOwogfQogCi1zdGF0aWMgaW50IGxpYnhsX19kZXZpY2VfcGNpX3JlbW92
ZV9jb21tb24obGlieGxfX2djICpnYywgdWludDMyX3QgZG9taWQsCi0gICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlieGxfZGV2aWNlX3BjaSAqcGNpZGV2LCBpbnQg
Zm9yY2UpCitzdGF0aWMgdm9pZCBwY2lfcmVtb3ZlX2RvbmUobGlieGxfX2VnYyAqZWdjLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHBjaV9yZW1vdmVfc3RhdGUgKnBycywKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBpbnQgcmMpCiB7Ci0gICAgdW5zaWduZWQgaW50IG9yaWdfdmRl
diwgcGZ1bmNfbWFzazsKLSAgICBpbnQgaSwgcmM7CisgICAgRUdDX0dDOwogCi0gICAgb3JpZ192
ZGV2ID0gcGNpZGV2LT52ZGV2Zm4gJiB+N1U7CisgICAgaWYgKHJjKSBnb3RvIG91dDsKKworICAg
IGxpYnhsX19kZXZpY2VfcGNpX3JlbW92ZV94ZW5zdG9yZShnYywgcHJzLT5kb21pZCwgcHJzLT5w
Y2lkZXYpOworb3V0OgorICAgIGRldmljZV9wY2lfcmVtb3ZlX2NvbW1vbl9uZXh0KGVnYywgcHJz
LCByYyk7Cit9CisKK3N0YXRpYyB2b2lkIGxpYnhsX19kZXZpY2VfcGNpX3JlbW92ZV9jb21tb24o
bGlieGxfX2VnYyAqZWdjLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICB1aW50MzJfdCBkb21pZCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgbGlieGxfZGV2aWNlX3BjaSAqcGNpZGV2LAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBib29sIGZvcmNlLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBsaWJ4bF9fYW9fZGV2aWNlICphb2RldikKK3sKKyAgICBT
VEFURV9BT19HQyhhb2Rldi0+YW8pOworICAgIGludCByYzsKKyAgICBwY2lfcmVtb3ZlX3N0YXRl
ICpwcnM7CisKKyAgICBHQ05FVyhwcnMpOworICAgIHBycy0+YW9kZXYgPSBhb2RldjsKKyAgICBw
cnMtPmRvbWlkID0gZG9taWQ7CisgICAgcHJzLT5wY2lkZXYgPSBwY2lkZXY7CisgICAgcHJzLT5m
b3JjZSA9IGZvcmNlOworCisgICAgcHJzLT5vcmlnX3ZkZXYgPSBwY2lkZXYtPnZkZXZmbiAmIH43
VTsKIAogICAgIGlmICggcGNpZGV2LT52ZnVuY19tYXNrID09IExJQlhMX1BDSV9GVU5DX0FMTCAp
IHsKLSAgICAgICAgaWYgKCBwY2lfbXVsdGlmdW5jdGlvbl9jaGVjayhnYywgcGNpZGV2LCAmcGZ1
bmNfbWFzaykgKSB7CisgICAgICAgIGlmICggcGNpX211bHRpZnVuY3Rpb25fY2hlY2soZ2MsIHBj
aWRldiwgJnBycy0+cGZ1bmNfbWFzaykgKSB7CiAgICAgICAgICAgICByYyA9IEVSUk9SX0ZBSUw7
CiAgICAgICAgICAgICBnb3RvIG91dDsKICAgICAgICAgfQotICAgICAgICBwY2lkZXYtPnZmdW5j
X21hc2sgJj0gcGZ1bmNfbWFzazsKKyAgICAgICAgcGNpZGV2LT52ZnVuY19tYXNrICY9IHBycy0+
cGZ1bmNfbWFzazsKICAgICB9ZWxzZXsKLSAgICAgICAgcGZ1bmNfbWFzayA9ICgxIDw8IHBjaWRl
di0+ZnVuYyk7CisgICAgICAgIHBycy0+cGZ1bmNfbWFzayA9ICgxIDw8IHBjaWRldi0+ZnVuYyk7
CiAgICAgfQogCi0gICAgZm9yKHJjID0gMCwgaSA9IDc7IGkgPj0gMDsgLS1pKSB7CisgICAgcmMg
PSAwOworICAgIHBycy0+bmV4dF9mdW5jID0gNzsKK291dDoKKyAgICBkZXZpY2VfcGNpX3JlbW92
ZV9jb21tb25fbmV4dChlZ2MsIHBycywgcmMpOworfQorCitzdGF0aWMgdm9pZCBkZXZpY2VfcGNp
X3JlbW92ZV9jb21tb25fbmV4dChsaWJ4bF9fZWdjICplZ2MsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBwY2lfcmVtb3ZlX3N0YXRlICpwcnMsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgcmMpCit7CisgICAgLyogQ29udmVu
aWVuY2UgYWxpYXNlcyAqLworICAgIGxpYnhsX2RvbWlkIGRvbWlkID0gcHJzLT5kb21pZDsKKyAg
ICBsaWJ4bF9kZXZpY2VfcGNpICpjb25zdCBwY2lkZXYgPSBwcnMtPnBjaWRldjsKKyAgICBsaWJ4
bF9fYW9fZGV2aWNlICpjb25zdCBhb2RldiA9IHBycy0+YW9kZXY7CisgICAgY29uc3QgdW5zaWdu
ZWQgaW50IHBmdW5jX21hc2sgPSBwcnMtPnBmdW5jX21hc2s7CisgICAgY29uc3QgdW5zaWduZWQg
aW50IG9yaWdfdmRldiA9IHBycy0+b3JpZ192ZGV2OworCisgICAgaWYgKHJjKSBnb3RvIG91dDsK
KworICAgIHdoaWxlIChwcnMtPm5leHRfZnVuYyA+PSAwKSB7CisgICAgICAgIGNvbnN0IGludCBp
ID0gcHJzLT5uZXh0X2Z1bmM7CisgICAgICAgIHBycy0+bmV4dF9mdW5jLS07CiAgICAgICAgIGlm
ICggKDEgPDwgaSkgJiBwZnVuY19tYXNrICkgewogICAgICAgICAgICAgaWYgKCBwY2lkZXYtPnZm
dW5jX21hc2sgPT0gcGZ1bmNfbWFzayApIHsKICAgICAgICAgICAgICAgICBwY2lkZXYtPmZ1bmMg
PSBpOwpAQCAtMTg4OCwxMyArMTk5MywxNSBAQCBzdGF0aWMgaW50IGxpYnhsX19kZXZpY2VfcGNp
X3JlbW92ZV9jb21tb24obGlieGxfX2djICpnYywgdWludDMyX3QgZG9taWQsCiAgICAgICAgICAg
ICB9ZWxzZXsKICAgICAgICAgICAgICAgICBwY2lkZXYtPnZkZXZmbiA9IG9yaWdfdmRldjsKICAg
ICAgICAgICAgIH0KLSAgICAgICAgICAgIGlmICggZG9fcGNpX3JlbW92ZShnYywgZG9taWQsIHBj
aWRldiwgZm9yY2UpICkKLSAgICAgICAgICAgICAgICByYyA9IEVSUk9SX0ZBSUw7CisgICAgICAg
ICAgICBkb19wY2lfcmVtb3ZlKGVnYywgZG9taWQsIHBjaWRldiwgcHJzLT5mb3JjZSwgcHJzKTsK
KyAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQogICAgIH0KIAorICAgIHJjID0gMDsKIG91
dDoKLSAgICByZXR1cm4gcmM7CisgICAgYW9kZXYtPnJjID0gcmM7CisgICAgYW9kZXYtPmNhbGxi
YWNrKGVnYywgYW9kZXYpOwogfQogCiBpbnQgbGlieGxfZGV2aWNlX3BjaV9yZW1vdmUobGlieGxf
Y3R4ICpjdHgsIHVpbnQzMl90IGRvbWlkLApAQCAtMTkwMywxMSArMjAxMCwxNCBAQCBpbnQgbGli
eGxfZGV2aWNlX3BjaV9yZW1vdmUobGlieGxfY3R4ICpjdHgsIHVpbnQzMl90IGRvbWlkLAogCiB7
CiAgICAgQU9fQ1JFQVRFKGN0eCwgZG9taWQsIGFvX2hvdyk7Ci0gICAgaW50IHJjOwotCi0gICAg
cmMgPSBsaWJ4bF9fZGV2aWNlX3BjaV9yZW1vdmVfY29tbW9uKGdjLCBkb21pZCwgcGNpZGV2LCAw
KTsKKyAgICBsaWJ4bF9fYW9fZGV2aWNlICphb2RldjsKIAotICAgIGxpYnhsX19hb19jb21wbGV0
ZShlZ2MsIGFvLCByYyk7CisgICAgR0NORVcoYW9kZXYpOworICAgIGxpYnhsX19wcmVwYXJlX2Fv
X2RldmljZShhbywgYW9kZXYpOworICAgIGFvZGV2LT5hY3Rpb24gPSBMSUJYTF9fREVWSUNFX0FD
VElPTl9SRU1PVkU7CisgICAgYW9kZXYtPmNhbGxiYWNrID0gZGV2aWNlX2FkZHJtX2FvY29tcGxl
dGU7CisgICAgYW9kZXYtPnVwZGF0ZV9qc29uID0gdHJ1ZTsKKyAgICBsaWJ4bF9fZGV2aWNlX3Bj
aV9yZW1vdmVfY29tbW9uKGVnYywgZG9taWQsIHBjaWRldiwgZmFsc2UsIGFvZGV2KTsKICAgICBy
ZXR1cm4gQU9fSU5QUk9HUkVTUzsKIH0KIApAQCAtMTkxNiwxMSArMjAyNiwxNCBAQCBpbnQgbGli
eGxfZGV2aWNlX3BjaV9kZXN0cm95KGxpYnhsX2N0eCAqY3R4LCB1aW50MzJfdCBkb21pZCwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGlieGxfYXN5bmNvcF9ob3cgKmFvX2hv
dykKIHsKICAgICBBT19DUkVBVEUoY3R4LCBkb21pZCwgYW9faG93KTsKLSAgICBpbnQgcmM7Ci0K
LSAgICByYyA9IGxpYnhsX19kZXZpY2VfcGNpX3JlbW92ZV9jb21tb24oZ2MsIGRvbWlkLCBwY2lk
ZXYsIDEpOworICAgIGxpYnhsX19hb19kZXZpY2UgKmFvZGV2OwogCi0gICAgbGlieGxfX2FvX2Nv
bXBsZXRlKGVnYywgYW8sIHJjKTsKKyAgICBHQ05FVyhhb2Rldik7CisgICAgbGlieGxfX3ByZXBh
cmVfYW9fZGV2aWNlKGFvLCBhb2Rldik7CisgICAgYW9kZXYtPmFjdGlvbiA9IExJQlhMX19ERVZJ
Q0VfQUNUSU9OX1JFTU9WRTsKKyAgICBhb2Rldi0+Y2FsbGJhY2sgPSBkZXZpY2VfYWRkcm1fYW9j
b21wbGV0ZTsKKyAgICBhb2Rldi0+dXBkYXRlX2pzb24gPSB0cnVlOworICAgIGxpYnhsX19kZXZp
Y2VfcGNpX3JlbW92ZV9jb21tb24oZWdjLCBkb21pZCwgcGNpZGV2LCB0cnVlLCBhb2Rldik7CiAg
ICAgcmV0dXJuIEFPX0lOUFJPR1JFU1M7CiB9CiAKQEAgLTIwMDQsMjcgKzIxMTcsMjcgQEAgbGli
eGxfZGV2aWNlX3BjaSAqbGlieGxfZGV2aWNlX3BjaV9saXN0KGxpYnhsX2N0eCAqY3R4LCB1aW50
MzJfdCBkb21pZCwgaW50ICpudW0KICAgICByZXR1cm4gcGNpZGV2czsKIH0KIAotaW50IGxpYnhs
X19kZXZpY2VfcGNpX2Rlc3Ryb3lfYWxsKGxpYnhsX19nYyAqZ2MsIHVpbnQzMl90IGRvbWlkKQor
dm9pZCBsaWJ4bF9fZGV2aWNlX3BjaV9kZXN0cm95X2FsbChsaWJ4bF9fZWdjICplZ2MsIHVpbnQz
Ml90IGRvbWlkLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ4bF9fbXVs
dGlkZXYgKm11bHRpZGV2KQogewotICAgIGxpYnhsX2N0eCAqY3R4ID0gbGlieGxfX2djX293bmVy
KGdjKTsKKyAgICBTVEFURV9BT19HQyhtdWx0aWRldi0+YW8pOwogICAgIGxpYnhsX2RldmljZV9w
Y2kgKnBjaWRldnM7Ci0gICAgaW50IG51bSwgaSwgcmMgPSAwOworICAgIGludCBudW0sIGk7CiAK
LSAgICBwY2lkZXZzID0gbGlieGxfZGV2aWNlX3BjaV9saXN0KGN0eCwgZG9taWQsICZudW0pOwor
ICAgIHBjaWRldnMgPSBsaWJ4bF9kZXZpY2VfcGNpX2xpc3QoQ1RYLCBkb21pZCwgJm51bSk7CiAg
ICAgaWYgKCBwY2lkZXZzID09IE5VTEwgKQotICAgICAgICByZXR1cm4gMDsKKyAgICAgICAgcmV0
dXJuOworICAgIGxpYnhsX19wdHJfYWRkKGdjLCBwY2lkZXZzKTsKIAogICAgIGZvciAoaSA9IDA7
IGkgPCBudW07IGkrKykgewogICAgICAgICAvKiBGb3JjZSByZW1vdmUgb24gc2h1dGRvd24gc2lu
Y2UsIG9uIEhWTSwgcWVtdSB3aWxsIG5vdCBhbHdheXMKICAgICAgICAgICogcmVzcG9uZCB0byBT
Q0kgaW50ZXJydXB0IGJlY2F1c2UgdGhlIGd1ZXN0IGtlcm5lbCBoYXMgc2h1dCBkb3duIHRoZQog
ICAgICAgICAgKiBkZXZpY2VzIGJ5IHRoZSB0aW1lIHdlIGV2ZW4gZ2V0IGhlcmUhCiAgICAgICAg
ICAqLwotICAgICAgICBpZiAobGlieGxfX2RldmljZV9wY2lfcmVtb3ZlX2NvbW1vbihnYywgZG9t
aWQsIHBjaWRldnMgKyBpLCAxKSA8IDApCi0gICAgICAgICAgICByYyA9IEVSUk9SX0ZBSUw7Cisg
ICAgICAgIGxpYnhsX19hb19kZXZpY2UgKmFvZGV2ID0gbGlieGxfX211bHRpZGV2X3ByZXBhcmUo
bXVsdGlkZXYpOworICAgICAgICBsaWJ4bF9fZGV2aWNlX3BjaV9yZW1vdmVfY29tbW9uKGVnYywg
ZG9taWQsIHBjaWRldnMgKyBpLCB0cnVlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGFvZGV2KTsKICAgICB9Ci0KLSAgICBmcmVlKHBjaWRldnMpOwotICAgIHJldHVy
biByYzsKIH0KIAogaW50IGxpYnhsX19ncmFudF92Z2FfaW9tZW1fcGVybWlzc2lvbihsaWJ4bF9f
Z2MgKmdjLCBjb25zdCB1aW50MzJfdCBkb21pZCwKLS0gCkFudGhvbnkgUEVSQVJECgoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxp
bmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5w
cm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

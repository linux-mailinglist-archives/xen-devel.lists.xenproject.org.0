Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 8C4B6B8046
	for <lists+xen-devel@lfdr.de>; Thu, 19 Sep 2019 19:44:14 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iB0R1-00053Z-Kg; Thu, 19 Sep 2019 17:41:39 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=vwgP=XO=citrix.com=anthony.perard@srs-us1.protection.inumbo.net>)
 id 1iB0R0-00052A-7H
 for xen-devel@lists.xenproject.org; Thu, 19 Sep 2019 17:41:38 +0000
X-Inumbo-ID: af5d9a7e-db04-11e9-a337-bc764e2007e4
Received: from esa5.hc3370-68.iphmx.com (unknown [216.71.155.168])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id af5d9a7e-db04-11e9-a337-bc764e2007e4;
 Thu, 19 Sep 2019 17:41:18 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1568914878;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=riibcUNR+m+jG1WH0pzxicB8ys53JqxoTIyAS95sEgI=;
 b=HO2SFx1Q5PoF3uAokwvzG7r9CWKdWi4PmWvXe8PkeGpZjgUQjJjmWCwK
 103AVjItSbpZtwVPO7fU7+XiLR1v4bR0xZy8gurktm7wvVDPB3mStURoq
 ZiJ7CETHgvM5YIj7buu9Vm8+4ikwDDGpAI0m20HP7uwNpHuzAQ41MOyRq c=;
Authentication-Results: esa5.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=anthony.perard@citrix.com;
 spf=Pass smtp.mailfrom=anthony.perard@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa5.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 anthony.perard@citrix.com) identity=pra;
 client-ip=162.221.158.21; receiver=esa5.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="anthony.perard@citrix.com";
 x-conformance=sidf_compatible
Received-SPF: Pass (esa5.hc3370-68.iphmx.com: domain of
 anthony.perard@citrix.com designates 162.221.158.21 as
 permitted sender) identity=mailfrom;
 client-ip=162.221.158.21; receiver=esa5.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="anthony.perard@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83 ~all"
Received-SPF: None (esa5.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa5.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: cQqwwqlCdmmvTW2Q5v54AyiOPL6G3d3z8rrdbQNbwCm/NgRHewEZggfhpyJflfj07zkL0SdLWg
 jNjWltAWOGM/DmSgEiJlf653IkzLIwjvebkDzZRr8oBPHu18MAs5vuA49r9PPym1SvR15yQb45
 nmyLbXPIhMFEHfS0x2Vebxf/8kd74DxAKRt3AYEYgEMRwfAvViKW6pi47BxUhv5JG7NHc1Z/ey
 xIWBnrmNEZMcM2rliytUDBBwgxxnEDpaz1yJ9ii3LZWtrhfAqD3QKTny1L8/a0BysEU/Kem3TG
 xlw=
X-SBRS: 2.7
X-MesageID: 6010801
X-Ironport-Server: esa5.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.64,524,1559534400"; 
   d="scan'208";a="6010801"
From: Anthony PERARD <anthony.perard@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Thu, 19 Sep 2019 18:16:43 +0100
Message-ID: <20190919171656.899649-24-anthony.perard@citrix.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190919171656.899649-1-anthony.perard@citrix.com>
References: <20190919171656.899649-1-anthony.perard@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v2 23/35] libxl:
 libxl__initiate_device_usbdev_remove now use ev_qmp
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Anthony PERARD <anthony.perard@citrix.com>, Ian
 Jackson <ian.jackson@eu.citrix.com>, Wei Liu <wl@xen.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

U2lnbmVkLW9mZi1ieTogQW50aG9ueSBQRVJBUkQgPGFudGhvbnkucGVyYXJkQGNpdHJpeC5jb20+
CkFja2VkLWJ5OiBJYW4gSmFja3NvbiA8aWFuLmphY2tzb25AZXUuY2l0cml4LmNvbT4KLS0tCiB0
b29scy9saWJ4bC9saWJ4bF91c2IuYyB8IDc4ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgNjggaW5zZXJ0aW9ucygrKSwgMTAgZGVsZXRp
b25zKC0pCgpkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGlieGxfdXNiLmMgYi90b29scy9saWJ4
bC9saWJ4bF91c2IuYwppbmRleCAzYjQzMjIzMWVhODUuLjFmYzdjY2Y0MWY4NiAxMDA2NDQKLS0t
IGEvdG9vbHMvbGlieGwvbGlieGxfdXNiLmMKKysrIGIvdG9vbHMvbGlieGwvbGlieGxfdXNiLmMK
QEAgLTQxNywxOCArNDE3LDE2IEBAIHN0YXRpYyBpbnQgbGlieGxfX2RldmljZV91c2JkZXZfYWRk
X2h2bShsaWJ4bF9fZ2MgKmdjLCBsaWJ4bF9fZXZfcW1wICpxbXAsCiB9CiAKIC8qIFNlbmQgcW1w
IGNvbW1hbmRzIHRvIGRlbGV0ZSBhIHVzYiBkZXZpY2UgaW4gcWVtdS4gKi8KLXN0YXRpYyBpbnQg
bGlieGxfX2RldmljZV91c2JkZXZfZGVsX2h2bShsaWJ4bF9fZ2MgKmdjLCB1aW50MzJfdCBkb21p
ZCwKK3N0YXRpYyBpbnQgbGlieGxfX2RldmljZV91c2JkZXZfZGVsX2h2bShsaWJ4bF9fZ2MgKmdj
LCBsaWJ4bF9fZXZfcW1wICpxbXAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgbGlieGxfZGV2aWNlX3VzYmRldiAqdXNiZGV2KQogewotICAgIGZsZXhhcnJheV90ICpx
bXBfYXJnczsKKyAgICBsaWJ4bF9fanNvbl9vYmplY3QgKnFtcF9hcmdzID0gTlVMTDsKIAotICAg
IHFtcF9hcmdzID0gZmxleGFycmF5X21ha2UoZ2MsIDIsIDEpOwotICAgIGZsZXhhcnJheV9hcHBl
bmRfcGFpcihxbXBfYXJncywgImlkIiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgR0NTUFJJ
TlRGKCJ4ZW51c2ItJWQtJWQiLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
dXNiZGV2LT51Lmhvc3RkZXYuaG9zdGJ1cywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHVzYmRldi0+dS5ob3N0ZGV2Lmhvc3RhZGRyKSk7CisgICAgbGlieGxfX3FtcF9wYXJh
bV9hZGRfc3RyaW5nKGdjLCAmcW1wX2FyZ3MsICJpZCIsCisgICAgICAgIEdDU1BSSU5URigieGVu
dXNiLSVkLSVkIiwgdXNiZGV2LT51Lmhvc3RkZXYuaG9zdGJ1cywKKyAgICAgICAgICAgICAgICAg
IHVzYmRldi0+dS5ob3N0ZGV2Lmhvc3RhZGRyKSk7CiAKLSAgICByZXR1cm4gbGlieGxfX3FtcF9y
dW5fY29tbWFuZF9mbGV4YXJyYXkoZ2MsIGRvbWlkLCAiZGV2aWNlX2RlbCIsIHFtcF9hcmdzKTsK
KyAgICByZXR1cm4gbGlieGxfX2V2X3FtcF9zZW5kKGdjLCBxbXAsICJkZXZpY2VfZGVsIiwgcW1w
X2FyZ3MpOwogfQogCiBzdGF0aWMgTElCWExfREVGSU5FX1VQREFURV9ERVZJRCh1c2JjdHJsKQpA
QCAtMTg2Niw2ICsxODY0LDEzIEBAIHN0YXRpYyB2b2lkIGRldmljZV91c2JkZXZfYWRkX2RvbmUo
bGlieGxfX2VnYyAqZWdjLAogTElCWExfREVGSU5FX0RFVklDRV9BREQodXNiZGV2KQogc3RhdGlj
IExJQlhMX0RFRklORV9ERVZJQ0VTX0FERCh1c2JkZXYpCiAKK3N0YXRpYyB2b2lkIGRldmljZV91
c2JkZXZfcmVtb3ZlX3RpbWVvdXQobGlieGxfX2VnYyAqZWdjLAorICAgIGxpYnhsX19ldl90aW1l
ICpldiwgY29uc3Qgc3RydWN0IHRpbWV2YWwgKnJlcXVlc3RlZF9hYnMsIGludCByYyk7CitzdGF0
aWMgdm9pZCBkZXZpY2VfdXNiZGV2X3JlbW92ZV9xbXBfY2IobGlieGxfX2VnYyAqZWdjLAorICAg
IGxpYnhsX19ldl9xbXAgKnFtcCwgY29uc3QgbGlieGxfX2pzb25fb2JqZWN0ICpyLCBpbnQgcmMp
Oworc3RhdGljIHZvaWQgZGV2aWNlX3VzYmRldl9yZW1vdmVfZG9uZShsaWJ4bF9fZWdjICplZ2Ms
CisgICAgbGlieGxfX2FvX2RldmljZSAqYW9kZXYsIGludCByYyk7CisKIC8qIE9wZXJhdGlvbiB0
byByZW1vdmUgdXNiIGRldmljZS4KICAqCiAgKiBHZW5lcmFsbHksIGl0IGRvZXM6CkBAIC0xODg1
LDYgKzE4OTAsNyBAQCBzdGF0aWMgdm9pZCBsaWJ4bF9fZGV2aWNlX3VzYmRldl9yZW1vdmUobGli
eGxfX2VnYyAqZWdjLCB1aW50MzJfdCBkb21pZCwKICAgICBpbnQgcmM7CiAgICAgY2hhciAqYnVz
aWQ7CiAgICAgbGlieGxfZGV2aWNlX3VzYmN0cmwgdXNiY3RybDsKKyAgICBib29sIGhhc19jYWxs
YmFjayA9IGZhbHNlOwogCiAgICAgLyogU3RvcmUgKnVzYmRldiB0byBiZSB1c2VkIGJ5IGNhbGxi
YWNrcyAqLwogICAgIGFvZGV2LT5kZXZpY2VfY29uZmlnID0gdXNiZGV2OwpAQCAtMTk2NCwxNCAr
MTk3MCwyMyBAQCBzdGF0aWMgdm9pZCBsaWJ4bF9fZGV2aWNlX3VzYmRldl9yZW1vdmUobGlieGxf
X2VnYyAqZWdjLCB1aW50MzJfdCBkb21pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBMSUJYTF9VU0JDVFJMX1RZUEVfREVWSUNFTU9ERUwpOwogICAgICAg
ICBpZiAocmMpIGdvdG8gb3V0OwogCi0gICAgICAgIHJjID0gbGlieGxfX2RldmljZV91c2JkZXZf
ZGVsX2h2bShnYywgZG9taWQsIHVzYmRldik7CisgICAgICAgIHJjID0gbGlieGxfX2V2X3RpbWVf
cmVnaXN0ZXJfcmVsKGFvLCAmYW9kZXYtPnRpbWVvdXQsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGRldmljZV91c2JkZXZfcmVtb3ZlX3RpbWVvdXQsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExJQlhMX1FNUF9DTURfVElNRU9VVCAq
IDEwMDApOworICAgICAgICBpZiAocmMpIGdvdG8gb3V0OworCisgICAgICAgIGFvZGV2LT5xbXAu
YW8gPSBhbzsKKyAgICAgICAgYW9kZXYtPnFtcC5kb21pZCA9IGRvbWlkOworICAgICAgICBhb2Rl
di0+cW1wLmNhbGxiYWNrID0gZGV2aWNlX3VzYmRldl9yZW1vdmVfcW1wX2NiOworICAgICAgICBh
b2Rldi0+cW1wLnBheWxvYWRfZmQgPSAtMTsKKyAgICAgICAgcmMgPSBsaWJ4bF9fZGV2aWNlX3Vz
YmRldl9kZWxfaHZtKGdjLCAmYW9kZXYtPnFtcCwgdXNiZGV2KTsKICAgICAgICAgaWYgKHJjKSB7
CiAgICAgICAgICAgICBsaWJ4bF9fZGV2aWNlX3VzYmRldl9hZGRfeGVuc3RvcmUoZ2MsIGRvbWlk
LCB1c2JkZXYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
TElCWExfVVNCQ1RSTF9UWVBFX0RFVklDRU1PREVMLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGZhbHNlKTsKICAgICAgICAgICAgIGdvdG8gb3V0OwogICAg
ICAgICB9Ci0KKyAgICAgICAgaGFzX2NhbGxiYWNrID0gdHJ1ZTsKICAgICAgICAgYnJlYWs7CiAg
ICAgZGVmYXVsdDoKICAgICAgICAgTE9HRChFUlJPUiwgZG9taWQsICJVbnN1cHBvcnRlZCB1c2Ig
Y29udHJvbGxlciB0eXBlIik7CkBAIC0xOTgzLDYgKzE5OTgsNDkgQEAgc3RhdGljIHZvaWQgbGli
eGxfX2RldmljZV91c2JkZXZfcmVtb3ZlKGxpYnhsX19lZ2MgKmVnYywgdWludDMyX3QgZG9taWQs
CiAKIG91dDoKICAgICBsaWJ4bF9kZXZpY2VfdXNiY3RybF9kaXNwb3NlKCZ1c2JjdHJsKTsKKyAg
ICAvKiBPbmx5IGNhbGwgX2RvbmUgaWYgbm8gY2FsbGJhY2sgaGF2ZSBiZWVuIHNldHVwICovCisg
ICAgaWYgKCFoYXNfY2FsbGJhY2spCisgICAgICAgIGRldmljZV91c2JkZXZfcmVtb3ZlX2RvbmUo
ZWdjLCBhb2RldiwgcmMpOyAvKiBtdXN0IGJlIGxhc3QgKi8KK30KKworc3RhdGljIHZvaWQgZGV2
aWNlX3VzYmRldl9yZW1vdmVfdGltZW91dChsaWJ4bF9fZWdjICplZ2MsCisgICAgbGlieGxfX2V2
X3RpbWUgKmV2LCBjb25zdCBzdHJ1Y3QgdGltZXZhbCAqcmVxdWVzdGVkX2FicywgaW50IHJjKQor
eworICAgIEVHQ19HQzsKKyAgICBsaWJ4bF9fYW9fZGV2aWNlICphb2RldiA9IENPTlRBSU5FUl9P
RihldiwgKmFvZGV2LCB0aW1lb3V0KTsKKworICAgIGlmIChyYyA9PSBFUlJPUl9USU1FRE9VVCkK
KyAgICAgICAgTE9HRChFUlJPUiwgYW9kZXYtPnFtcC5kb21pZCwKKyAgICAgICAgICAgICAiUmVt
b3ZpbmcgdXNiZGV2IGZyb20gUUVNVSB0aW1lZCBvdXQiKTsKKyAgICBkZXZpY2VfdXNiZGV2X3Jl
bW92ZV9xbXBfY2IoZWdjLCAmYW9kZXYtPnFtcCwgTlVMTCwgcmMpOworfQorCitzdGF0aWMgdm9p
ZCBkZXZpY2VfdXNiZGV2X3JlbW92ZV9xbXBfY2IobGlieGxfX2VnYyAqZWdjLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnhsX19ldl9xbXAgKnFtcCwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsaWJ4bF9fanNvbl9vYmpl
Y3QgKnIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IHJjKQor
eworICAgIEVHQ19HQzsKKyAgICBsaWJ4bF9fYW9fZGV2aWNlICphb2RldiA9IENPTlRBSU5FUl9P
RihxbXAsICphb2RldiwgcW1wKTsKKyAgICBsaWJ4bF9kZXZpY2VfdXNiZGV2ICpjb25zdCB1c2Jk
ZXYgPSBhb2Rldi0+ZGV2aWNlX2NvbmZpZzsKKworICAgIGlmIChyYykgeworICAgICAgICBsaWJ4
bF9fZGV2aWNlX3VzYmRldl9hZGRfeGVuc3RvcmUoZ2MsIHFtcC0+ZG9taWQsIHVzYmRldiwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExJQlhMX1VTQkNUUkxfVFlQ
RV9ERVZJQ0VNT0RFTCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGZhbHNlKTsKKyAgICB9CisKKyAgICBkZXZpY2VfdXNiZGV2X3JlbW92ZV9kb25lKGVnYywgYW9k
ZXYsIHJjKTsgLyogbXVzdCBiZSBsYXN0ICovCit9CisKK3N0YXRpYyB2b2lkIGRldmljZV91c2Jk
ZXZfcmVtb3ZlX2RvbmUobGlieGxfX2VnYyAqZWdjLAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBsaWJ4bF9fYW9fZGV2aWNlICphb2RldiwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgaW50IHJjKQoreworICAgIEVHQ19HQzsKKworICAgIGxpYnhs
X19ldl90aW1lX2RlcmVnaXN0ZXIoZ2MsICZhb2Rldi0+dGltZW91dCk7CisgICAgbGlieGxfX2V2
X3FtcF9kaXNwb3NlKGdjLCAmYW9kZXYtPnFtcCk7CiAgICAgYW9kZXYtPnJjID0gcmM7CiAgICAg
YW9kZXYtPmNhbGxiYWNrKGVnYywgYW9kZXYpOwogfQotLSAKQW50aG9ueSBQRVJBUkQKCgpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFp
bGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhl
bnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

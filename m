Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id A51842C489
	for <lists+xen-devel@lfdr.de>; Tue, 28 May 2019 12:37:59 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hVZRV-0007c2-7J; Tue, 28 May 2019 10:34:53 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=31/0=T4=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1hVZQI-00052c-Rt
 for xen-devel@lists.xenproject.org; Tue, 28 May 2019 10:33:38 +0000
X-Inumbo-ID: 096a3088-8134-11e9-8980-bc764e045a96
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 096a3088-8134-11e9-8980-bc764e045a96;
 Tue, 28 May 2019 10:33:31 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 74263B02F;
 Tue, 28 May 2019 10:33:30 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Tue, 28 May 2019 12:33:07 +0200
Message-Id: <20190528103313.1343-55-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190528103313.1343-1-jgross@suse.com>
References: <20190528103313.1343-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH 54/60] xen/sched: add minimalistic idle
 scheduler for free cpus
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>,
 Dario Faggioli <dfaggioli@suse.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SW5zdGVhZCBvZiBoYXZpbmcgYSBmdWxsIGJsb3duIHNjaGVkdWxlciBydW5uaW5nIGZvciB0aGUg
ZnJlZSBjcHVzCmFkZCBhIHZlcnkgbWluaW1hbGlzdGljIHNjaGVkdWxlciBmb3IgdGhhdCBwdXJw
b3NlIG9ubHkgZXZlciBzY2hlZHVsaW5nCnRoZSByZWxhdGVkIGlkbGUgdmNwdS4gVGhpcyBoYXMg
dGhlIGJpZyBhZHZhbnRhZ2Ugb2Ygbm90IG5lZWRpbmcgYW55CnBlci1jcHUsIHBlci1kb21haW4g
b3IgcGVyLXNjaGVkdWxpbmcgdW5pdCBkYXRhIGZvciBmcmVlIGNwdXMgYW5kIGluCnR1cm4gc2lt
cGxpZnlpbmcgbW92aW5nIGNwdXMgdG8gYW5kIGZyb20gY3B1cG9vbHMgYSBsb3QuCgpBcyB0aGlz
IG5ldyBzY2hlZHVsZXIgaXMgbm90IHVzZXIgc2VsZWN0YWJsZSBkb24ndCByZWdpc3RlciBpdCBh
cyBhbgpvZmZpY2lhbCBzY2hlZHVsZXIsIGJ1dCBqdXN0IGluY2x1ZGUgaXQgaW4gc2NoZWR1bGUu
Yy4KClNpZ25lZC1vZmYtYnk6IEp1ZXJnZW4gR3Jvc3MgPGpncm9zc0BzdXNlLmNvbT4KLS0tClYx
OiBuZXcgcGF0Y2gKLS0tCiB4ZW4vYXJjaC9hcm0vc21wYm9vdC5jICB8ICAgMiAtCiB4ZW4vYXJj
aC94ODYvc21wYm9vdC5jICB8ICAgMiAtCiB4ZW4vY29tbW9uL3NjaGVkdWxlLmMgICB8IDE0MyAr
KysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIHhlbi9pbmNs
dWRlL3hlbi9zY2hlZC5oIHwgICAxIC0KIDQgZmlsZXMgY2hhbmdlZCwgNjcgaW5zZXJ0aW9ucygr
KSwgODEgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEveGVuL2FyY2gvYXJtL3NtcGJvb3QuYyBi
L3hlbi9hcmNoL2FybS9zbXBib290LmMKaW5kZXggOWE2NTgyZjJhNi4uZjc1NjQ0NDM2MiAxMDA2
NDQKLS0tIGEveGVuL2FyY2gvYXJtL3NtcGJvb3QuYworKysgYi94ZW4vYXJjaC9hcm0vc21wYm9v
dC5jCkBAIC0zNTAsOCArMzUwLDYgQEAgdm9pZCBzdGFydF9zZWNvbmRhcnkodW5zaWduZWQgbG9u
ZyBib290X3BoeXNfb2Zmc2V0LAogCiAgICAgc2V0dXBfY3B1X3NpYmxpbmdfbWFwKGNwdWlkKTsK
IAotICAgIHNjaGVkdWxlcl9wZXJjcHVfaW5pdChjcHVpZCk7Ci0KICAgICAvKiBSdW4gbG9jYWwg
bm90aWZpZXJzICovCiAgICAgbm90aWZ5X2NwdV9zdGFydGluZyhjcHVpZCk7CiAgICAgLyoKZGlm
ZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9zbXBib290LmMgYi94ZW4vYXJjaC94ODYvc21wYm9vdC5j
CmluZGV4IDdlOTViMmNkYWMuLjE1M2JmYmI0YjcgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9z
bXBib290LmMKKysrIGIveGVuL2FyY2gveDg2L3NtcGJvb3QuYwpAQCAtMzgyLDggKzM4Miw2IEBA
IHZvaWQgc3RhcnRfc2Vjb25kYXJ5KHZvaWQgKnVudXNlZCkKIAogICAgIHNldF9jcHVfc2libGlu
Z19tYXAoY3B1KTsKIAotICAgIHNjaGVkdWxlcl9wZXJjcHVfaW5pdChjcHUpOwotCiAgICAgaW5p
dF9wZXJjcHVfdGltZSgpOwogCiAgICAgc2V0dXBfc2Vjb25kYXJ5X0FQSUNfY2xvY2soKTsKZGlm
ZiAtLWdpdCBhL3hlbi9jb21tb24vc2NoZWR1bGUuYyBiL3hlbi9jb21tb24vc2NoZWR1bGUuYwpp
bmRleCA3YTVhYjRiMWI2Li5kM2U0YWUyMjZjIDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL3NjaGVk
dWxlLmMKKysrIGIveGVuL2NvbW1vbi9zY2hlZHVsZS5jCkBAIC04Myw2ICs4Myw1NyBAQCBleHRl
cm4gY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqX19zdGFydF9zY2hlZHVsZXJzX2FycmF5W10sICpf
X2VuZF9zY2hlZHVsZXJzX2FycgogCiBzdGF0aWMgc3RydWN0IHNjaGVkdWxlciBfX3JlYWRfbW9z
dGx5IG9wczsKIAorc3RhdGljIHNwaW5sb2NrX3QgKgorc2NoZWRfaWRsZV9zd2l0Y2hfc2NoZWQo
c3RydWN0IHNjaGVkdWxlciAqbmV3X29wcywgdW5zaWduZWQgaW50IGNwdSwKKyAgICAgICAgICAg
ICAgICAgICAgICAgIHZvaWQgKnBkYXRhLCB2b2lkICp2ZGF0YSkKK3sKKyAgICBzY2hlZF9pZGxl
X3VuaXQoY3B1KS0+cHJpdiA9IE5VTEw7CisKKyAgICByZXR1cm4gJnNjaGVkX2ZyZWVfY3B1X2xv
Y2s7Cit9CisKK3N0YXRpYyBzdHJ1Y3Qgc2NoZWRfcmVzb3VyY2UgKgorc2NoZWRfaWRsZV9yZXNf
cGljayhjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0
KQoreworICAgIHJldHVybiB1bml0LT5yZXM7Cit9CisKK3N0YXRpYyB2b2lkICoKK3NjaGVkX2lk
bGVfYWxsb2NfdmRhdGEoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRf
dW5pdCAqdW5pdCwKKyAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqZGQpCit7CisgICAgLyog
QW55IG5vbi1OVUxMIHBvaW50ZXIgaXMgZmluZSBoZXJlLiAqLworICAgIHJldHVybiAodm9pZCAq
KTFVTDsKK30KKworc3RhdGljIHZvaWQKK3NjaGVkX2lkbGVfZnJlZV92ZGF0YShjb25zdCBzdHJ1
Y3Qgc2NoZWR1bGVyICpvcHMsIHZvaWQgKnByaXYpCit7Cit9CisKK3N0YXRpYyB2b2lkIHNjaGVk
X2lkbGVfc2NoZWR1bGUoCisgICAgY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qg
c2NoZWRfdW5pdCAqdW5pdCwgc190aW1lX3Qgbm93LAorICAgIGJvb2wgdGFza2xldF93b3JrX3Nj
aGVkdWxlZCkKK3sKKyAgICBjb25zdCB1bnNpZ25lZCBpbnQgY3B1ID0gc21wX3Byb2Nlc3Nvcl9p
ZCgpOworCisgICAgdW5pdC0+bmV4dF90aW1lID0gLTE7CisgICAgdW5pdC0+bmV4dF90YXNrID0g
c2NoZWRfaWRsZV91bml0KHNjaGVkX2dldF9yZXNvdXJjZV9jcHUoY3B1KSk7Cit9CisKK3N0YXRp
YyBzdHJ1Y3Qgc2NoZWR1bGVyIHNjaGVkX2lkbGVfb3BzID0geworICAgIC5uYW1lICAgICAgICAg
ICA9ICJJZGxlIFNjaGVkdWxlciIsCisgICAgLm9wdF9uYW1lICAgICAgID0gImlkbGUiLAorICAg
IC5zY2hlZF9kYXRhICAgICA9IE5VTEwsCisKKyAgICAucGlja19yZXNvdXJjZSAgPSBzY2hlZF9p
ZGxlX3Jlc19waWNrLAorICAgIC5kb19zY2hlZHVsZSAgICA9IHNjaGVkX2lkbGVfc2NoZWR1bGUs
CisKKyAgICAuYWxsb2NfdmRhdGEgICAgPSBzY2hlZF9pZGxlX2FsbG9jX3ZkYXRhLAorICAgIC5m
cmVlX3ZkYXRhICAgICA9IHNjaGVkX2lkbGVfZnJlZV92ZGF0YSwKKyAgICAuc3dpdGNoX3NjaGVk
ICAgPSBzY2hlZF9pZGxlX3N3aXRjaF9zY2hlZCwKK307CisKIHN0YXRpYyBpbmxpbmUgc3RydWN0
IHZjcHUgKnVuaXQydmNwdV9jcHUoc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQsCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCBjcHUpCiB7CkBAIC0y
MTQxLDcgKzIxOTIsNiBAQCBzdGF0aWMgdm9pZCBwb2xsX3RpbWVyX2ZuKHZvaWQgKmRhdGEpCiBz
dGF0aWMgaW50IGNwdV9zY2hlZHVsZV91cCh1bnNpZ25lZCBpbnQgY3B1KQogewogICAgIHN0cnVj
dCBzY2hlZF9yZXNvdXJjZSAqc2Q7Ci0gICAgdm9pZCAqc2NoZWRfcHJpdjsKIAogICAgIHNkID0g
eHphbGxvYyhzdHJ1Y3Qgc2NoZWRfcmVzb3VyY2UpOwogICAgIGlmICggc2QgPT0gTlVMTCApCkBA
IC0yMTUwLDcgKzIyMDAsNyBAQCBzdGF0aWMgaW50IGNwdV9zY2hlZHVsZV91cCh1bnNpZ25lZCBp
bnQgY3B1KQogICAgIHNkLT5jcHVzID0gY3B1bWFza19vZihjcHUpOwogICAgIHNldF9zY2hlZF9y
ZXMoY3B1LCBzZCk7CiAKLSAgICBzZC0+c2NoZWR1bGVyID0gJm9wczsKKyAgICBzZC0+c2NoZWR1
bGVyID0gJnNjaGVkX2lkbGVfb3BzOwogICAgIHNwaW5fbG9ja19pbml0KCZzZC0+X2xvY2spOwog
ICAgIHNkLT5zY2hlZHVsZV9sb2NrID0gJnNjaGVkX2ZyZWVfY3B1X2xvY2s7CiAgICAgaW5pdF90
aW1lcigmc2QtPnNfdGltZXIsIHNfdGltZXJfZm4sIE5VTEwsIGNwdSk7CkBAIC0yMTcxLDIwICsy
MjIxLDEwIEBAIHN0YXRpYyBpbnQgY3B1X3NjaGVkdWxlX3VwKHVuc2lnbmVkIGludCBjcHUpCiAg
ICAgICAgIHN0cnVjdCBzY2hlZF91bml0ICp1bml0ID0gaWRsZS0+c2NoZWRfdW5pdDsKIAogICAg
ICAgICAvKgotICAgICAgICAgKiBEdXJpbmcgKEFDUEk/KSBzdXNwZW5kIHRoZSBpZGxlIHZDUFUg
Zm9yIHRoaXMgcENQVSBpcyBub3QgZnJlZWQsCi0gICAgICAgICAqIHdoaWxlIGl0cyBzY2hlZHVs
ZXIgc3BlY2lmaWMgZGF0YSAod2hhdCBpcyBwb2ludGVkIGJ5IHNjaGVkX3ByaXYpCi0gICAgICAg
ICAqIGlzLiBBbHNvLCBhdCB0aGlzIHN0YWdlIG9mIHRoZSByZXN1bWUgcGF0aCwgd2UgYXR0YWNo
IHRoZSBwQ1BVCi0gICAgICAgICAqIHRvIHRoZSBkZWZhdWx0IHNjaGVkdWxlciwgbm8gbWF0dGVy
IGluIHdoYXQgY3B1cG9vbCBpdCB3YXMgYmVmb3JlCi0gICAgICAgICAqIHN1c3BlbmQuIFRvIGF2
b2lkIGluY29uc2lzdGVuY3ksIGxldCdzIGFsbG9jYXRlIGRlZmF1bHQgc2NoZWR1bGVyCi0gICAg
ICAgICAqIGRhdGEgZm9yIHRoZSBpZGxlIHZDUFUgaGVyZS4gSWYgdGhlIHBDUFUgd2FzIGluIGEg
ZGlmZmVyZW50IHBvb2wKLSAgICAgICAgICogd2l0aCBhIGRpZmZlcmVudCBzY2hlZHVsZXIsIGl0
IGlzIHNjaGVkdWxlX2NwdV9zd2l0Y2goKSwgaW52b2tlZAotICAgICAgICAgKiBsYXRlciwgdGhh
dCB3aWxsIHNldCB0aGluZ3MgdXAgYXMgYXBwcm9wcmlhdGUuCisgICAgICAgICAqIE5vIG5lZWQg
dG8gYWxsb2NhdGUgYW55IHNjaGVkdWxlciBkYXRhLCBhcyBjcHVzIGNvbWluZyBvbmxpbmUgYXJl
CisgICAgICAgICAqIGZyZWUgaW5pdGlhbGx5IGFuZCB0aGUgaWRsZSBzY2hlZHVsZXIgZG9lc24n
dCBuZWVkIGFueSBkYXRhIGFyZWFzCisgICAgICAgICAqIGFsbG9jYXRlZC4KICAgICAgICAgICov
Ci0gICAgICAgIEFTU0VSVCh1bml0LT5wcml2ID09IE5VTEwpOwotCi0gICAgICAgIHVuaXQtPnBy
aXYgPSBzY2hlZF9hbGxvY192ZGF0YSgmb3BzLCB1bml0LCBpZGxlLT5kb21haW4tPnNjaGVkX3By
aXYpOwotICAgICAgICBpZiAoIHVuaXQtPnByaXYgPT0gTlVMTCApCi0gICAgICAgICAgICByZXR1
cm4gLUVOT01FTTsKIAogICAgICAgICAvKiBVcGRhdGUgdGhlIHJlc291cmNlIHBvaW50ZXIgaW4g
dGhlIGlkbGUgdW5pdC4gKi8KICAgICAgICAgdW5pdC0+cmVzID0gc2Q7CkBAIC0yMTk1LDE2ICsy
MjM1LDcgQEAgc3RhdGljIGludCBjcHVfc2NoZWR1bGVfdXAodW5zaWduZWQgaW50IGNwdSkKICAg
ICBzZC0+Y3VyciA9IGlkbGVfdmNwdVtjcHVdLT5zY2hlZF91bml0OwogICAgIHNkLT5zY2hlZF91
bml0X2lkbGUgPSBpZGxlX3ZjcHVbY3B1XS0+c2NoZWRfdW5pdDsKIAotICAgIC8qCi0gICAgICog
V2UgZG9uJ3Qgd2FudCB0byByaXNrIGNhbGxpbmcgeGZyZWUoKSBvbiBhbiBzZC0+c2NoZWRfcHJp
dgotICAgICAqIChlLmcuLCBpbnNpZGUgZnJlZV9wZGF0YSwgZnJvbSBjcHVfc2NoZWR1bGVfZG93
bigpIGNhbGxlZAotICAgICAqIGR1cmluZyBDUFVfVVBfQ0FOQ0VMTEVEKSB0aGF0IGNvbnRhaW5z
IGFuIElTX0VSUiB2YWx1ZS4KLSAgICAgKi8KLSAgICBzY2hlZF9wcml2ID0gc2NoZWRfYWxsb2Nf
cGRhdGEoJm9wcywgY3B1KTsKLSAgICBpZiAoIElTX0VSUihzY2hlZF9wcml2KSApCi0gICAgICAg
IHJldHVybiBQVFJfRVJSKHNjaGVkX3ByaXYpOwotCi0gICAgc2QtPnNjaGVkX3ByaXYgPSBzY2hl
ZF9wcml2OworICAgIHNkLT5zY2hlZF9wcml2ID0gTlVMTDsKIAogICAgIHJldHVybiAwOwogfQpA
QCAtMjIxMiwxMyArMjI0Myw2IEBAIHN0YXRpYyBpbnQgY3B1X3NjaGVkdWxlX3VwKHVuc2lnbmVk
IGludCBjcHUpCiBzdGF0aWMgdm9pZCBjcHVfc2NoZWR1bGVfZG93bih1bnNpZ25lZCBpbnQgY3B1
KQogewogICAgIHN0cnVjdCBzY2hlZF9yZXNvdXJjZSAqc2QgPSBnZXRfc2NoZWRfcmVzKGNwdSk7
Ci0gICAgc3RydWN0IHNjaGVkdWxlciAqc2NoZWQgPSBzZC0+c2NoZWR1bGVyOwotCi0gICAgc2No
ZWRfZnJlZV9wZGF0YShzY2hlZCwgc2QtPnNjaGVkX3ByaXYsIGNwdSk7Ci0gICAgc2NoZWRfZnJl
ZV92ZGF0YShzY2hlZCwgaWRsZV92Y3B1W2NwdV0tPnNjaGVkX3VuaXQtPnByaXYpOwotCi0gICAg
aWRsZV92Y3B1W2NwdV0tPnNjaGVkX3VuaXQtPnByaXYgPSBOVUxMOwotICAgIHNkLT5zY2hlZF9w
cml2ID0gTlVMTDsKIAogICAgIGtpbGxfdGltZXIoJnNkLT5zX3RpbWVyKTsKIApAQCAtMjIyNiwy
NiArMjI1MCwxNCBAQCBzdGF0aWMgdm9pZCBjcHVfc2NoZWR1bGVfZG93bih1bnNpZ25lZCBpbnQg
Y3B1KQogICAgIHhmcmVlKHNkKTsKIH0KIAotdm9pZCBzY2hlZHVsZXJfcGVyY3B1X2luaXQodW5z
aWduZWQgaW50IGNwdSkKLXsKLSAgICBzdHJ1Y3Qgc2NoZWRfcmVzb3VyY2UgKnNkID0gZ2V0X3Nj
aGVkX3JlcyhjcHUpOwotICAgIHN0cnVjdCBzY2hlZHVsZXIgKnNjaGVkID0gc2QtPnNjaGVkdWxl
cjsKLQotICAgIGlmICggc3lzdGVtX3N0YXRlICE9IFNZU19TVEFURV9yZXN1bWUgKQotICAgICAg
ICBzY2hlZF9pbml0X3BkYXRhKHNjaGVkLCBzZC0+c2NoZWRfcHJpdiwgY3B1KTsKLX0KLQogdm9p
ZCBzY2hlZF9ybV9jcHUodW5zaWduZWQgaW50IGNwdSkKIHsKICAgICBpbnQgcmM7Ci0gICAgc3Ry
dWN0IHNjaGVkX3Jlc291cmNlICpzZCA9IGdldF9zY2hlZF9yZXMoY3B1KTsKLSAgICBzdHJ1Y3Qg
c2NoZWR1bGVyICpzY2hlZCA9IHNkLT5zY2hlZHVsZXI7CiAKICAgICByY3VfcmVhZF9sb2NrKCZk
b21saXN0X3JlYWRfbG9jayk7CiAgICAgcmMgPSBjcHVfZGlzYWJsZV9zY2hlZHVsZXIoY3B1KTsK
ICAgICBCVUdfT04ocmMpOwogICAgIHJjdV9yZWFkX3VubG9jaygmZG9tbGlzdF9yZWFkX2xvY2sp
OwotICAgIHNjaGVkX2RlaW5pdF9wZGF0YShzY2hlZCwgc2QtPnNjaGVkX3ByaXYsIGNwdSk7CiAg
ICAgY3B1X3NjaGVkdWxlX2Rvd24oY3B1KTsKIH0KIApAQCAtMjI2MCwzMiArMjI3MiwyMiBAQCBz
dGF0aWMgaW50IGNwdV9zY2hlZHVsZV9jYWxsYmFjaygKICAgICAgKiBhbGxvY2F0aW5nIGFuZCBp
bml0aWFsaXppbmcgdGhlIHBlci1wQ1BVIHNjaGVkdWxlciBzcGVjaWZpYyBkYXRhLAogICAgICAq
IGFzIHdlbGwgYXMgInJlZ2lzdGVyaW5nIiB0aGlzIHBDUFUgdG8gdGhlIHNjaGVkdWxlciAod2hp
Y2ggbWF5CiAgICAgICogaW52b2x2ZSBtb2RpZnlpbmcgc29tZSBzY2hlZHVsZXIgd2lkZSBkYXRh
IHN0cnVjdHVyZXMpLgotICAgICAqIFRoaXMgaGFwcGVucyBieSBjYWxsaW5nIHRoZSBhbGxvY19w
ZGF0YSBhbmQgaW5pdF9wZGF0YSBob29rcywgaW4KLSAgICAgKiB0aGlzIG9yZGVyLiBBIHNjaGVk
dWxlciB0aGF0IGRvZXMgbm90IG5lZWQgdG8gYWxsb2NhdGUgYW55IHBlci1wQ1BVCi0gICAgICog
ZGF0YSBjYW4gYXZvaWQgaW1wbGVtZW50aW5nIGFsbG9jX3BkYXRhLiBpbml0X3BkYXRhIG1heSwg
aG93ZXZlciwgYmUKLSAgICAgKiBuZWNlc3NhcnkvdXNlZnVsIGluIHRoaXMgY2FzZSB0b28gKGUu
Zy4sIGl0IGNhbiBjb250YWluIHRoZSAicmVnaXN0ZXIKLSAgICAgKiB0aGUgcENQVSB0byB0aGUg
c2NoZWR1bGVyIiBwYXJ0KS4gYWxsb2NfcGRhdGEgKGlmIHByZXNlbnQpIGlzIGNhbGxlZAotICAg
ICAqIGR1cmluZyBDUFVfVVBfUFJFUEFSRS4gaW5pdF9wZGF0YSAoaWYgcHJlc2VudCkgaXMgY2Fs
bGVkIGJlZm9yZQotICAgICAqIENQVV9TVEFSVElORyBpbiBzY2hlZHVsZXJfcGVyY3B1X2luaXQo
KS4KKyAgICAgKiBBcyBuZXcgcENQVXMgYWx3YXlzIHN0YXJ0IGFzICJmcmVlIiBjcHVzIHdpdGgg
dGhlIG1pbmltYWwgaWRsZQorICAgICAqIHNjaGVkdWxlciBiZWluZyBpbiBjaGFyZ2UsIHdlIGRv
bid0IG5lZWQgYW55IG9mIHRoYXQuCiAgICAgICoKICAgICAgKiBPbiB0aGUgb3RoZXIgaGFuZCwg
YXQgdGVhcmRvd24sIHdlIG5lZWQgdG8gcmV2ZXJzZSB3aGF0IGhhcyBiZWVuIGRvbmUKLSAgICAg
KiBkdXJpbmcgaW5pdGlhbGl6YXRpb24sIGFuZCB0aGVuIGZyZWUgdGhlIHBlci1wQ1BVIHNwZWNp
ZmljIGRhdGEuIFRoaXMKLSAgICAgKiBoYXBwZW5zIGJ5IGNhbGxpbmcgdGhlIGRlaW5pdF9wZGF0
YSBhbmQgZnJlZV9wZGF0YSBob29rcywgaW4gdGhpcworICAgICAqIGR1cmluZyBpbml0aWFsaXph
dGlvbiwgYW5kIHRoZW4gZnJlZSB0aGUgcGVyLXBDUFUgc3BlY2lmaWMgZGF0YS4gQQorICAgICAq
IHBDUFUgYnJvdWdodCBkb3duIGlzIG5vdCBmb3JjZWQgdGhyb3VnaCAiZnJlZSIgY3B1cywgc28g
aGVyZSB3ZSBuZWVkIHRvCisgICAgICogdXNlIHRoZSBhcHByb3ByaWF0ZSBob29rcy4KKyAgICAg
KgorICAgICAqIFRoaXMgaGFwcGVucyBieSBjYWxsaW5nIHRoZSBkZWluaXRfcGRhdGEgYW5kIGZy
ZWVfcGRhdGEgaG9va3MsIGluIHRoaXMKICAgICAgKiBvcmRlci4gSWYgbm8gcGVyLXBDUFUgbWVt
b3J5IHdhcyBhbGxvY2F0ZWQsIHRoZXJlIGlzIG5vIG5lZWQgdG8KICAgICAgKiBwcm92aWRlIGFu
IGltcGxlbWVudGF0aW9uIG9mIGZyZWVfcGRhdGEuIGRlaW5pdF9wZGF0YSBtYXksIGhvd2V2ZXIs
CiAgICAgICogYmUgbmVjZXNzYXJ5L3VzZWZ1bCBpbiB0aGlzIGNhc2UgdG9vIChlLmcuLCBpdCBj
YW4gdW5kbyBzb21ldGhpbmcgZG9uZQogICAgICAqIG9uIHNjaGVkdWxlciB3aWRlIGRhdGEgc3Ry
dWN0dXJlIGR1cmluZyBpbml0X3BkYXRhKS4gQm90aCBkZWluaXRfcGRhdGEKICAgICAgKiBhbmQg
ZnJlZV9wZGF0YSBhcmUgY2FsbGVkIGR1cmluZyBDUFVfREVBRC4KICAgICAgKgotICAgICAqIElm
IHNvbWV0aW5nIGdvZXMgd3JvbmcgZHVyaW5nIGJyaW5ndXAsIHdlIGdvIHRvIENQVV9VUF9DQU5D
RUxMRUQKLSAgICAgKiAqYmVmb3JlKiBoYXZpbmcgY2FsbGVkIGluaXRfcGRhdGEuIEluIHRoaXMg
Y2FzZSwgYXMgdGhlcmUgaXMgbm8KLSAgICAgKiBpbml0aWFsaXphdGlvbiBuZWVkaW5nIHVuZG9p
bmcsIG9ubHkgZnJlZV9wZGF0YSBzaG91bGQgYmUgY2FsbGVkLgotICAgICAqIFRoaXMgbWVhbnMg
aXQgaXMgcG9zc2libGUgdG8gY2FsbCBmcmVlX3BkYXRhIGp1c3QgYWZ0ZXIgYWxsb2NfcGRhdGEs
Ci0gICAgICogd2l0aG91dCBhIGluaXRfcGRhdGEvZGVpbml0X3BkYXRhICJjeWNsZSIgaW4gYmV0
d2VlbiB0aGUgdHdvLgotICAgICAqCi0gICAgICogU28sIGluIHN1bW1hcnksIHRoZSB1c2FnZSBw
YXR0ZXJuIHNob3VsZCBsb29rIGVpdGhlcgotICAgICAqICAtIGFsbG9jX3BkYXRhLS0+aW5pdF9w
ZGF0YS0tPmRlaW5pdF9wZGF0YS0tPmZyZWVfcGRhdGEsIG9yCi0gICAgICogIC0gYWxsb2NfcGRh
dGEtLT5mcmVlX3BkYXRhLgorICAgICAqIElmIHNvbWV0aW5nIGdvZXMgd3JvbmcgZHVyaW5nIGJy
aW5ndXAsIHdlIGdvIHRvIENQVV9VUF9DQU5DRUxMRUQuCiAgICAgICovCiAgICAgc3dpdGNoICgg
YWN0aW9uICkKICAgICB7CkBAIC0yNDAyLDkgKzI0MDQsNiBAQCB2b2lkIF9faW5pdCBzY2hlZHVs
ZXJfaW5pdCh2b2lkKQogICAgICAgICBCVUcoKTsKICAgICBnZXRfc2NoZWRfcmVzKDApLT5jdXJy
ID0gaWRsZV92Y3B1WzBdLT5zY2hlZF91bml0OwogICAgIGdldF9zY2hlZF9yZXMoMCktPnNjaGVk
X3VuaXRfaWRsZSA9IGlkbGVfdmNwdVswXS0+c2NoZWRfdW5pdDsKLSAgICBnZXRfc2NoZWRfcmVz
KDApLT5zY2hlZF9wcml2ID0gc2NoZWRfYWxsb2NfcGRhdGEoJm9wcywgMCk7Ci0gICAgQlVHX09O
KElTX0VSUihnZXRfc2NoZWRfcmVzKDApLT5zY2hlZF9wcml2KSk7Ci0gICAgc2NoZWR1bGVyX3Bl
cmNwdV9pbml0KDApOwogfQogCiAvKgpAQCAtMjQxMiwxOCArMjQxMSwxNCBAQCB2b2lkIF9faW5p
dCBzY2hlZHVsZXJfaW5pdCh2b2lkKQogICogY3B1cG9vbCwgb3Igc3ViamVjdCBpdCB0byB0aGUg
c2NoZWR1bGVyIG9mIGEgbmV3IGNwdXBvb2wuCiAgKgogICogRm9yIHRoZSBwQ1BVcyB0aGF0IGFy
ZSByZW1vdmVkIGZyb20gdGhlaXIgY3B1cG9vbCwgdGhlaXIgc2NoZWR1bGVyIGJlY29tZXMKLSAq
ICZvcHMgKHRoZSBkZWZhdWx0IHNjaGVkdWxlciwgc2VsZWN0ZWQgYXQgYm9vdCwgd2hpY2ggYWxz
byBzZXJ2aWNlcyB0aGUKLSAqIGRlZmF1bHQgY3B1cG9vbCkuIEhvd2V2ZXIsIGFzIHRoZXNlIHBD
UFVzIGFyZSBub3QgcmVhbGx5IHBhcnQgb2YgYW55IHBvb2wsCi0gKiB0aGVyZSB3b24ndCBiZSBh
bnkgc2NoZWR1bGluZyBldmVudCBvbiB0aGVtLCBub3QgZXZlbiBmcm9tIHRoZSBkZWZhdWx0Ci0g
KiBzY2hlZHVsZXIuIEJhc2ljYWxseSwgdGhleSB3aWxsIGp1c3Qgc2l0IGlkbGUgdW50aWwgdGhl
eSBhcmUgZXhwbGljaXRseQotICogYWRkZWQgYmFjayB0byBhIGNwdXBvb2wuCisgKiAmc2NoZWRf
aWRsZV9vcHMgKHRoZSBpZGxlIHNjaGVkdWxlcikuCiAgKi8KIGludCBzY2hlZHVsZV9jcHVfc3dp
dGNoKHVuc2lnbmVkIGludCBjcHUsIHN0cnVjdCBjcHVwb29sICpjKQogewogICAgIHN0cnVjdCB2
Y3B1ICppZGxlOwogICAgIHZvaWQgKnBwcml2LCAqcHByaXZfb2xkLCAqdnByaXYsICp2cHJpdl9v
bGQ7CiAgICAgc3RydWN0IHNjaGVkdWxlciAqb2xkX29wcyA9IGdldF9zY2hlZF9yZXMoY3B1KS0+
c2NoZWR1bGVyOwotICAgIHN0cnVjdCBzY2hlZHVsZXIgKm5ld19vcHMgPSAoYyA9PSBOVUxMKSA/
ICZvcHMgOiBjLT5zY2hlZDsKKyAgICBzdHJ1Y3Qgc2NoZWR1bGVyICpuZXdfb3BzID0gKGMgPT0g
TlVMTCkgPyAmc2NoZWRfaWRsZV9vcHMgOiBjLT5zY2hlZDsKICAgICBzdHJ1Y3Qgc2NoZWRfcmVz
b3VyY2UgKnNkID0gZ2V0X3NjaGVkX3JlcyhjcHUpOwogICAgIHN0cnVjdCBjcHVwb29sICpvbGRf
cG9vbCA9IHNkLT5jcHVwb29sOwogICAgIHNwaW5sb2NrX3QgKm9sZF9sb2NrLCAqbmV3X2xvY2s7
CkBAIC0yNDQzLDkgKzI0MzgsNiBAQCBpbnQgc2NoZWR1bGVfY3B1X3N3aXRjaCh1bnNpZ25lZCBp
bnQgY3B1LCBzdHJ1Y3QgY3B1cG9vbCAqYykKICAgICBBU1NFUlQoKGMgPT0gTlVMTCAmJiAhY3B1
bWFza190ZXN0X2NwdShjcHUsIG9sZF9wb29sLT5jcHVfdmFsaWQpKSB8fAogICAgICAgICAgICAo
YyAhPSBOVUxMICYmICFjcHVtYXNrX3Rlc3RfY3B1KGNwdSwgYy0+Y3B1X3ZhbGlkKSkpOwogCi0g
ICAgaWYgKCBvbGRfb3BzID09IG5ld19vcHMgKQotICAgICAgICBnb3RvIG91dDsKLQogICAgIC8q
CiAgICAgICogVG8gc2V0dXAgdGhlIGNwdSBmb3IgdGhlIG5ldyBzY2hlZHVsZXIgd2UgbmVlZDoK
ICAgICAgKiAgLSBhIHZhbGlkIGluc3RhbmNlIG9mIHBlci1DUFUgc2NoZWR1bGVyIHNwZWNpZmlj
IGRhdGEsIGFzIGl0IGlzCkBAIC0yNDk4LDcgKzI0OTAsNyBAQCBpbnQgc2NoZWR1bGVfY3B1X3N3
aXRjaCh1bnNpZ25lZCBpbnQgY3B1LCBzdHJ1Y3QgY3B1cG9vbCAqYykKICAgICAgKiB0YWtpbmcg
aXQsIGZpbmRzIGFsbCB0aGUgaW5pdGlhbGl6YXRpb25zIHdlJ3ZlIGRvbmUgYWJvdmUgaW4gcGxh
Y2UuCiAgICAgICovCiAgICAgc21wX21iKCk7Ci0gICAgc2QtPnNjaGVkdWxlX2xvY2sgPSBjID8g
bmV3X2xvY2sgOiAmc2NoZWRfZnJlZV9jcHVfbG9jazsKKyAgICBzZC0+c2NoZWR1bGVfbG9jayA9
IG5ld19sb2NrOwogCiAgICAgLyogX05vdF8gcGNwdV9zY2hlZHVsZV91bmxvY2soKTogc2NoZWR1
bGVfbG9jayBtYXkgaGF2ZSBjaGFuZ2VkISAqLwogICAgIHNwaW5fdW5sb2NrX2lycXJlc3RvcmUo
b2xkX2xvY2ssIGZsYWdzKTsKQEAgLTI1MTAsNyArMjUwMiw2IEBAIGludCBzY2hlZHVsZV9jcHVf
c3dpdGNoKHVuc2lnbmVkIGludCBjcHUsIHN0cnVjdCBjcHVwb29sICpjKQogICAgIHNjaGVkX2Zy
ZWVfdmRhdGEob2xkX29wcywgdnByaXZfb2xkKTsKICAgICBzY2hlZF9mcmVlX3BkYXRhKG9sZF9v
cHMsIHBwcml2X29sZCwgY3B1KTsKIAotIG91dDoKICAgICBnZXRfc2NoZWRfcmVzKGNwdSktPmdy
YW51bGFyaXR5ID0gYyA/IGMtPmdyYW51bGFyaXR5IDogMTsKICAgICBnZXRfc2NoZWRfcmVzKGNw
dSktPmNwdXBvb2wgPSBjOwogICAgIC8qIFdoZW4gYSBjcHUgaXMgYWRkZWQgdG8gYSBwb29sLCB0
cmlnZ2VyIGl0IHRvIGdvIHBpY2sgdXAgc29tZSB3b3JrICovCmRpZmYgLS1naXQgYS94ZW4vaW5j
bHVkZS94ZW4vc2NoZWQuaCBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCmluZGV4IDdkYzYzYzQ0
OWIuLmU2ODliYmEzNjEgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCisrKyBi
L3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCkBAIC02NzcsNyArNjc3LDYgQEAgdm9pZCBfX2RvbWFp
bl9jcmFzaChzdHJ1Y3QgZG9tYWluICpkKTsKIHZvaWQgbm9yZXR1cm4gYXNtX2RvbWFpbl9jcmFz
aF9zeW5jaHJvbm91cyh1bnNpZ25lZCBsb25nIGFkZHIpOwogCiB2b2lkIHNjaGVkdWxlcl9pbml0
KHZvaWQpOwotdm9pZCBzY2hlZHVsZXJfcGVyY3B1X2luaXQodW5zaWduZWQgaW50IGNwdSk7CiBp
bnQgIHNjaGVkX2luaXRfdmNwdShzdHJ1Y3QgdmNwdSAqdik7CiB2b2lkIHNjaGVkX2Rlc3Ryb3lf
dmNwdShzdHJ1Y3QgdmNwdSAqdik7CiBpbnQgIHNjaGVkX2luaXRfZG9tYWluKHN0cnVjdCBkb21h
aW4gKmQsIGludCBwb29saWQpOwotLSAKMi4xNi40CgoKX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxA
bGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFu
L2xpc3RpbmZvL3hlbi1kZXZlbA==

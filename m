Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id AEE2424958
	for <lists+xen-devel@lfdr.de>; Tue, 21 May 2019 09:50:05 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hSzUJ-0007pg-LZ; Tue, 21 May 2019 07:47:07 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=O+mW=TV=amazon.de=prvs=03752d4d0=nmanthey@srs-us1.protection.inumbo.net>)
 id 1hSzUH-0007pT-KC
 for xen-devel@lists.xenproject.org; Tue, 21 May 2019 07:47:05 +0000
X-Inumbo-ID: 9dfd0002-7b9c-11e9-ace0-3b2f95878d83
Received: from smtp-fw-6002.amazon.com (unknown [52.95.49.90])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 9dfd0002-7b9c-11e9-ace0-3b2f95878d83;
 Tue, 21 May 2019 07:47:00 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amazon.de; i=@amazon.de; q=dns/txt; s=amazon201209;
 t=1558424820; x=1589960820;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version;
 bh=mKyUkwpJiWDN4bs7yGZA4ydno1021YOJ4zwRCjdLdzI=;
 b=KW0svLLoZwn1z7g8UFwFUKMwsltfaZ8nfLVskCo0/ew3eDUtt1xKDL/d
 u5QKccsrGSmIbXNiY49YLPTptBI/vvaJ6CDX3i8HjmKbEzniwvXB5+dlP
 XZMf+qodJ1MF8T0rre0arnuynSPHfe7Lar8LRn07OdJIFQiEMYos3t3Ml g=;
X-IronPort-AV: E=Sophos;i="5.60,494,1549929600"; d="scan'208";a="403024841"
Received: from iad6-co-svc-p1-lb1-vlan3.amazon.com (HELO
 email-inbound-relay-2b-c300ac87.us-west-2.amazon.com) ([10.124.125.6])
 by smtp-border-fw-out-6002.iad6.amazon.com with ESMTP/TLS/DHE-RSA-AES256-SHA;
 21 May 2019 07:46:58 +0000
Received: from EX13MTAUEA001.ant.amazon.com
 (pdx1-ws-svc-p6-lb9-vlan3.pdx.amazon.com [10.236.137.198])
 by email-inbound-relay-2b-c300ac87.us-west-2.amazon.com (8.14.7/8.14.7) with
 ESMTP id x4L7kqTG056728
 (version=TLSv1/SSLv3 cipher=AES256-SHA bits=256 verify=FAIL);
 Tue, 21 May 2019 07:46:58 GMT
Received: from EX13D08UEE002.ant.amazon.com (10.43.62.92) by
 EX13MTAUEA001.ant.amazon.com (10.43.61.243) with Microsoft SMTP Server (TLS)
 id 15.0.1367.3; Tue, 21 May 2019 07:46:57 +0000
Received: from EX13MTAUWB001.ant.amazon.com (10.43.161.207) by
 EX13D08UEE002.ant.amazon.com (10.43.62.92) with Microsoft SMTP Server (TLS)
 id 15.0.1367.3; Tue, 21 May 2019 07:46:57 +0000
Received: from uc1a35a69ae4659.ant.amazon.com (10.28.85.34) by
 mail-relay.amazon.com (10.43.161.249) with Microsoft SMTP Server id
 15.0.1367.3 via Frontend Transport; Tue, 21 May 2019 07:46:53 +0000
From: Norbert Manthey <nmanthey@amazon.de>
To: <xen-devel@lists.xenproject.org>
Date: Tue, 21 May 2019 09:45:45 +0200
Message-ID: <1558424746-24059-3-git-send-email-nmanthey@amazon.de>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1558424746-24059-1-git-send-email-nmanthey@amazon.de>
References: <1558424746-24059-1-git-send-email-nmanthey@amazon.de>
MIME-Version: 1.0
Precedence: Bulk
Subject: [Xen-devel] [PATCH L1TF MDS GT v1 2/3] common/grant_table: harden
 bound accesses
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Tim Deegan <tim@xen.org>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wei.liu2@citrix.com>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>, Ian
 Jackson <ian.jackson@eu.citrix.com>, Dario Faggioli <dfaggioli@suse.com>,
 Martin Pohlack <mpohlack@amazon.de>, Pawel Wieczorkiewicz <wipawel@amazon.de>,
 Julien Grall <julien.grall@arm.com>, David Woodhouse <dwmw@amazon.co.uk>,
 Jan Beulich <jbeulich@suse.com>, Martin Mazein <amazein@amazon.de>,
 Bjoern Doebel <doebel@amazon.de>, Norbert Manthey <nmanthey@amazon.de>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

R3Vlc3RzIGNhbiBpc3N1ZSBncmFudCB0YWJsZSBvcGVyYXRpb25zIGFuZCBwcm92aWRlIGd1ZXN0
IGNvbnRyb2xsZWQKZGF0YSB0byB0aGVtLiBUaGlzIGRhdGEgaXMgdXNlZCBhcyBpbmRleCBmb3Ig
bWVtb3J5IGxvYWRzIGFmdGVyIGJvdW5kCmNoZWNrcyBoYXZlIGJlZW4gZG9uZS4gVG8gYXZvaWQg
c3BlY3VsYXRpdmUgb3V0LW9mLWJvdW5kIGFjY2Vzc2VzLCB3ZQp1c2UgdGhlIGFycmF5X2luZGV4
X25vc3BlYyBtYWNybyB3aGVyZSBhcHBsaWNhYmxlLCBvciB0aGUgbWFjcm8KYmxvY2tfc3BlY3Vs
YXRpb24uIE5vdGUsIHRoYXQgdGhlIGJsb2NrX3NwZWN1bGF0aW9uIGlzIGFsd2F5cyB1c2VkIGlu
CnRoZSBjYWxscyB0byBzaGFyZWRfZW50cnlfaGVhZGVyIGFuZCBucl9ncmFudF9lbnRyaWVzLCBz
byB0aGF0IG5vCmFkZGl0aW9uYWwgcHJvdGVjdGlvbiBpcyByZXF1aXJlZCBvbmNlIHRoZXNlIGZ1
bmN0aW9ucyBoYXZlIGJlZW4KY2FsbGVkLgoKU3BlY3VsYXRpdmUgZXhlY3V0aW9uIGlzIG5vdCBi
bG9ja2VkIGluIGNhc2Ugb25lIG9mIHRoZSBmb2xsb3dpbmcKcHJvcGVydGllcyBpcyB0cnVlOgog
LSBwYXRoIGNhbm5vdCBiZSB0cmlnZ2VyZWQgYnkgdGhlIGd1ZXN0CiAtIHBhdGggZG9lcyBub3Qg
cmV0dXJuIHRvIHRoZSBndWVzdAogLSBwYXRoIGRvZXMgbm90IHJlc3VsdCBpbiBhbiBvdXQtb2Yt
Ym91bmQgYWNjZXNzCiAtIHBhdGggY2Fubm90IGJlIGV4ZWN1dGVkIHJlcGVhdGVkbHkKT25seSB0
aGUgY29tYmluYXRpb24gb2YgdGhlIGFib3ZlIHByb3BlcnRpZXMgYWxsb3dzIHRvIGFjdHVhbGx5
IGxlYWsKY29udGludW91cyBjaHVua3Mgb2YgbWVtb3J5LiBUaGVyZWZvcmUsIHdlIG9ubHkgYWRk
IHRoZSBwZW5hbHR5IG9mCnByb3RlY3RpdmUgbWVjaGFuaXNtcyBpbiBjYXNlIGEgcG90ZW50aWFs
IHNwZWN1bGF0aXZlIG91dC1vZi1ib3VuZAphY2Nlc3MgbWF0Y2hlcyBhbGwgdGhlIGFib3ZlIHBy
b3BlcnRpZXMuCgpUaGlzIGNvbW1pdCBhZGRyZXNzZXMgb25seSBvdXQtb2YtYm91bmQgYWNjZXNz
ZXMgd2hvc2UgaW5kZXggaXMKZGlyZWN0bHkgY29udHJvbGxlZCBieSB0aGUgZ3Vlc3QsIGFuZCB0
aGUgaW5kZXggaXMgY2hlY2tlZCBiZWZvcmUuClBvdGVudGlhbCBvdXQtb2YtYm91bmQgYWNjZXNz
ZXMgdGhhdCBhcmUgY2F1c2VkIGJ5IHNwZWN1bGF0aXZlbHkKZXZhbHVhdGluZyB0aGUgdmVyc2lv
biBvZiB0aGUgY3VycmVudCB0YWJsZSBhcmUgbm90IGFkZHJlc3NlZCBpbiB0aGlzCmNvbW1pdC4K
ClRoaXMgaXMgcGFydCBvZiB0aGUgc3BlY3VsYXRpdmUgaGFyZGVuaW5nIGVmZm9ydC4KClNpZ25l
ZC1vZmYtYnk6IE5vcmJlcnQgTWFudGhleSA8bm1hbnRoZXlAYW1hem9uLmRlPgotLS0KCk5vdGVz
OgogIHYxOiAgYWRhcHQgdGhlIGNvbW1lbnRzIGZvciBzaGFyZWRfZW50cnlfaGVhZGVyIHRvIHNo
b3cgdGhhdCB0aGV5ICdhbHNvJwogICAgICAgYmxvY2sgc3BlY3VsYXRpdmUgZXhlY3V0aW9uCgog
eGVuL2NvbW1vbi9ncmFudF90YWJsZS5jIHwgNDMgKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKy0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDM0IGluc2VydGlvbnMoKyksIDkgZGVs
ZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9ncmFudF90YWJsZS5jIGIveGVuL2Nv
bW1vbi9ncmFudF90YWJsZS5jCi0tLSBhL3hlbi9jb21tb24vZ3JhbnRfdGFibGUuYworKysgYi94
ZW4vY29tbW9uL2dyYW50X3RhYmxlLmMKQEAgLTk4OCw5ICs5ODgsMTAgQEAgbWFwX2dyYW50X3Jl
ZigKICAgICAgICAgUElOX0ZBSUwodW5sb2NrX291dCwgR05UU1RfYmFkX2dudHJlZiwgIkJhZCBy
ZWYgJSN4IGZvciBkJWRcbiIsCiAgICAgICAgICAgICAgICAgIG9wLT5yZWYsIHJndC0+ZG9tYWlu
LT5kb21haW5faWQpOwogCi0gICAgYWN0ID0gYWN0aXZlX2VudHJ5X2FjcXVpcmUocmd0LCBvcC0+
cmVmKTsKKyAgICAvKiBUaGlzIGNhbGwgYWxzbyBlbnN1cmVzIHRoZSBhYm92ZSBjaGVjayBjYW5u
b3QgYmUgcGFzc2VkIHNwZWN1bGF0aXZlbHkgKi8KICAgICBzaGFoID0gc2hhcmVkX2VudHJ5X2hl
YWRlcihyZ3QsIG9wLT5yZWYpOwogICAgIHN0YXR1cyA9IHJndC0+Z3RfdmVyc2lvbiA9PSAxID8g
JnNoYWgtPmZsYWdzIDogJnN0YXR1c19lbnRyeShyZ3QsIG9wLT5yZWYpOworICAgIGFjdCA9IGFj
dGl2ZV9lbnRyeV9hY3F1aXJlKHJndCwgb3AtPnJlZik7CiAKICAgICAvKiBJZiBhbHJlYWR5IHBp
bm5lZCwgY2hlY2sgdGhlIGFjdGl2ZSBkb21pZCBhbmQgYXZvaWQgcmVmY250IG92ZXJmbG93LiAq
LwogICAgIGlmICggYWN0LT5waW4gJiYKQEAgLTEzNDYsNiArMTM0Nyw5IEBAIHVubWFwX2NvbW1v
bigKICAgICAgICAgZ290byB1bmxvY2tfb3V0OwogICAgIH0KIAorICAgIC8qIE1ha2Ugc3VyZSB0
aGUgYWJvdmUgYm91bmQgY2hlY2sgY2Fubm90IGJlIGJ5cGFzc2VkIHNwZWN1bGF0aXZlbHkgKi8K
KyAgICBibG9ja19zcGVjdWxhdGlvbigpOworCiAgICAgYWN0ID0gYWN0aXZlX2VudHJ5X2FjcXVp
cmUocmd0LCBvcC0+cmVmKTsKIAogICAgIC8qCkBAIC0xNDQzLDcgKzE0NDcsNyBAQCB1bm1hcF9j
b21tb25fY29tcGxldGUoc3RydWN0IGdudHRhYl91bm1hcF9jb21tb24gKm9wKQogICAgIHN0cnVj
dCBwYWdlX2luZm8gKnBnOwogICAgIHVpbnQxNl90ICpzdGF0dXM7CiAKLSAgICBpZiAoICFvcC0+
ZG9uZSApCisgICAgaWYgKCBldmFsdWF0ZV9ub3NwZWMoIW9wLT5kb25lKSApCiAgICAgewogICAg
ICAgICAvKiB1bm1hcF9jb21tb24oKSBkaWRuJ3QgZG8gYW55dGhpbmcgLSBub3RoaW5nIHRvIGNv
bXBsZXRlLiAqLwogICAgICAgICByZXR1cm47CkBAIC0yMDUxLDYgKzIwNTUsNyBAQCBnbnR0YWJf
cHJlcGFyZV9mb3JfdHJhbnNmZXIoCiAgICAgICAgIGdvdG8gZmFpbDsKICAgICB9CiAKKyAgICAv
KiBUaGlzIGNhbGwgYWxzbyBlbnN1cmVzIHRoZSBhYm92ZSBjaGVjayBjYW5ub3QgYmUgcGFzc2Vk
IHNwZWN1bGF0aXZlbHkgKi8KICAgICBzaGEgPSBzaGFyZWRfZW50cnlfaGVhZGVyKHJndCwgcmVm
KTsKIAogICAgIHNjb21iby53b3JkID0gKih1MzIgKikmc2hhLT5mbGFnczsKQEAgLTIyNDgsNyAr
MjI1MywxMiBAQCBnbnR0YWJfdHJhbnNmZXIoCiAgICAgICAgIHNwaW5fdW5sb2NrKCZlLT5wYWdl
X2FsbG9jX2xvY2spOwogICAgICAgICBva2F5ID0gZ250dGFiX3ByZXBhcmVfZm9yX3RyYW5zZmVy
KGUsIGQsIGdvcC5yZWYpOwogCi0gICAgICAgIGlmICggdW5saWtlbHkoIW9rYXkgfHwgYXNzaWdu
X3BhZ2VzKGUsIHBhZ2UsIDAsIE1FTUZfbm9fcmVmY291bnQpKSApCisgICAgICAgIC8qCisgICAg
ICAgICAqIE1ha2Ugc3VyZSB0aGUgcmVmZXJlbmNlIGJvdW5kIGNoZWNrIGluIGdudHRhYl9wcmVw
YXJlX2Zvcl90cmFuc2ZlcgorICAgICAgICAgKiBpcyByZXNwZWN0ZWQgYW5kIHNwZWN1bGF0aXZl
IGV4ZWN1dGlvbiBpcyBibG9ja2VkIGFjY29yZGluZ2x5CisgICAgICAgICAqLworICAgICAgICBp
ZiAoIHVubGlrZWx5KCFldmFsdWF0ZV9ub3NwZWMob2theSkpIHx8CisgICAgICAgICAgICB1bmxp
a2VseShhc3NpZ25fcGFnZXMoZSwgcGFnZSwgMCwgTUVNRl9ub19yZWZjb3VudCkpICkKICAgICAg
ICAgewogICAgICAgICAgICAgYm9vbCBkcm9wX2RvbV9yZWY7CiAKQEAgLTI0MzUsOCArMjQ0NSwx
MCBAQCBhY3F1aXJlX2dyYW50X2Zvcl9jb3B5KAogICAgICAgICBQSU5fRkFJTChndF91bmxvY2tf
b3V0LCBHTlRTVF9iYWRfZ250cmVmLAogICAgICAgICAgICAgICAgICAiQmFkIGdyYW50IHJlZmVy
ZW5jZSAlI3hcbiIsIGdyZWYpOwogCi0gICAgYWN0ID0gYWN0aXZlX2VudHJ5X2FjcXVpcmUocmd0
LCBncmVmKTsKKyAgICAvKiBUaGlzIGNhbGwgYWxzbyBlbnN1cmVzIHRoZSBhYm92ZSBjaGVjayBj
YW5ub3QgYmUgcGFzc2VkIHNwZWN1bGF0aXZlbHkgKi8KICAgICBzaGFoID0gc2hhcmVkX2VudHJ5
X2hlYWRlcihyZ3QsIGdyZWYpOworICAgIGFjdCA9IGFjdGl2ZV9lbnRyeV9hY3F1aXJlKHJndCwg
Z3JlZik7CisKICAgICBpZiAoIHJndC0+Z3RfdmVyc2lvbiA9PSAxICkKICAgICB7CiAgICAgICAg
IHNoYTIgPSBOVUxMOwpAQCAtMjg1Myw2ICsyODY1LDkgQEAgc3RhdGljIGludCBnbnR0YWJfY29w
eV9idWYoY29uc3Qgc3RydWN0IGdudHRhYl9jb3B5ICpvcCwKICAgICAgICAgICAgICAgICAgb3At
PmRlc3Qub2Zmc2V0LCBkZXN0LT5wdHIub2Zmc2V0LAogICAgICAgICAgICAgICAgICBvcC0+bGVu
LCBkZXN0LT5sZW4pOwogCisgICAgLyogTWFrZSBzdXJlIHRoZSBhYm92ZSBjaGVja3MgYXJlIG5v
dCBieXBhc3NlZCBzcGVjdWxhdGl2ZWx5ICovCisgICAgYmxvY2tfc3BlY3VsYXRpb24oKTsKKwog
ICAgIG1lbWNweShkZXN0LT52aXJ0ICsgb3AtPmRlc3Qub2Zmc2V0LCBzcmMtPnZpcnQgKyBvcC0+
c291cmNlLm9mZnNldCwKICAgICAgICAgICAgb3AtPmxlbik7CiAgICAgZ250dGFiX21hcmtfZGly
dHkoZGVzdC0+ZG9tYWluLCBkZXN0LT5tZm4pOwpAQCAtMjk3Miw3ICsyOTg3LDcgQEAgZ250dGFi
X3NldF92ZXJzaW9uKFhFTl9HVUVTVF9IQU5ETEVfUEFSQU0oZ250dGFiX3NldF92ZXJzaW9uX3Qp
IHVvcCkKICAgICBzdHJ1Y3QgZ3JhbnRfdGFibGUgKmd0ID0gY3VycmQtPmdyYW50X3RhYmxlOwog
ICAgIGdyYW50X2VudHJ5X3YxX3QgcmVzZXJ2ZWRfZW50cmllc1tHTlRUQUJfTlJfUkVTRVJWRURf
RU5UUklFU107CiAgICAgaW50IHJlczsKLSAgICB1bnNpZ25lZCBpbnQgaTsKKyAgICB1bnNpZ25l
ZCBpbnQgaSwgbnJfZW50czsKIAogICAgIGlmICggY29weV9mcm9tX2d1ZXN0KCZvcCwgdW9wLCAx
KSApCiAgICAgICAgIHJldHVybiAtRUZBVUxUOwpAQCAtMjk5Niw3ICszMDExLDggQEAgZ250dGFi
X3NldF92ZXJzaW9uKFhFTl9HVUVTVF9IQU5ETEVfUEFSQU0oZ250dGFiX3NldF92ZXJzaW9uX3Qp
IHVvcCkKICAgICAgKiBhcmUgYWxsb3dlZCB0byBiZSBpbiB1c2UgKHhlbnN0b3JlL3hlbmNvbnNv
bGUga2VlcHMgdGhlbSBtYXBwZWQpLgogICAgICAqIChZb3UgbmVlZCB0byBjaGFuZ2UgdGhlIHZl
cnNpb24gbnVtYmVyIGZvciBlLmcuIGtleGVjLikKICAgICAgKi8KLSAgICBmb3IgKCBpID0gR05U
VEFCX05SX1JFU0VSVkVEX0VOVFJJRVM7IGkgPCBucl9ncmFudF9lbnRyaWVzKGd0KTsgaSsrICkK
KyAgICBucl9lbnRzID0gbnJfZ3JhbnRfZW50cmllcyhndCk7CisgICAgZm9yICggaSA9IEdOVFRB
Ql9OUl9SRVNFUlZFRF9FTlRSSUVTOyBpIDwgbnJfZW50czsgaSsrICkKICAgICB7CiAgICAgICAg
IGlmICggcmVhZF9hdG9taWMoJl9hY3RpdmVfZW50cnkoZ3QsIGkpLnBpbikgIT0gMCApCiAgICAg
ICAgIHsKQEAgLTMyMzgsNiArMzI1NCw5IEBAIHN3YXBfZ3JhbnRfcmVmKGdyYW50X3JlZl90IHJl
Zl9hLCBncmFudF9yZWZfdCByZWZfYikKICAgICBpZiAoIHVubGlrZWx5KHJlZl9iID49IG5yX2dy
YW50X2VudHJpZXMoZC0+Z3JhbnRfdGFibGUpKSkKICAgICAgICAgUElOX0ZBSUwob3V0LCBHTlRT
VF9iYWRfZ250cmVmLCAiQmFkIHJlZi1iICUjeFxuIiwgcmVmX2IpOwogCisgICAgLyogTWFrZSBz
dXJlIHRoZSBhYm92ZSBjaGVja3MgYXJlIG5vdCBieXBhc3NlZCBzcGVjdWxhdGl2ZWx5ICovCisg
ICAgYmxvY2tfc3BlY3VsYXRpb24oKTsKKwogICAgIC8qIFN3YXBwaW5nIHRoZSBzYW1lIHJlZiBp
cyBhIG5vLW9wLiAqLwogICAgIGlmICggcmVmX2EgPT0gcmVmX2IgKQogICAgICAgICBnb3RvIG91
dDsKQEAgLTM3MDcsMTMgKzM3MjYsMTQgQEAgdm9pZCBncmFudF90YWJsZV93YXJuX2FjdGl2ZV9n
cmFudHMoc3RydWN0IGRvbWFpbiAqZCkKICAgICBzdHJ1Y3QgZ3JhbnRfdGFibGUgKmd0ID0gZC0+
Z3JhbnRfdGFibGU7CiAgICAgc3RydWN0IGFjdGl2ZV9ncmFudF9lbnRyeSAqYWN0OwogICAgIGdy
YW50X3JlZl90IHJlZjsKLSAgICB1bnNpZ25lZCBpbnQgbnJfYWN0aXZlID0gMDsKKyAgICB1bnNp
Z25lZCBpbnQgbnJfYWN0aXZlID0gMCwgbnJfZW50czsKIAogI2RlZmluZSBXQVJOX0dSQU5UX01B
WCAxMAogCiAgICAgZ3JhbnRfcmVhZF9sb2NrKGd0KTsKIAotICAgIGZvciAoIHJlZiA9IDA7IHJl
ZiAhPSBucl9ncmFudF9lbnRyaWVzKGd0KTsgcmVmKysgKQorICAgIG5yX2VudHMgPSBucl9ncmFu
dF9lbnRyaWVzKGd0KTsKKyAgICBmb3IgKCByZWYgPSAwOyByZWYgIT0gbnJfZW50czsgcmVmKysg
KQogICAgIHsKICAgICAgICAgYWN0ID0gYWN0aXZlX2VudHJ5X2FjcXVpcmUoZ3QsIHJlZik7CiAg
ICAgICAgIGlmICggIWFjdC0+cGluICkKQEAgLTM4NjMsNiArMzg4Myw5IEBAIHN0YXRpYyBpbnQg
Z250dGFiX2dldF9zdGF0dXNfZnJhbWVfbWZuKHN0cnVjdCBkb21haW4gKmQsCiAgICAgICAgICAg
ICByZXR1cm4gLUVJTlZBTDsKICAgICB9CiAKKyAgICAvKiBNYWtlIHN1cmUgaWR4IGlzIGJvdW5k
ZWQgd3J0IG5yX3N0YXR1c19mcmFtZXMgKi8KKyAgICBibG9ja19zcGVjdWxhdGlvbigpOworCiAg
ICAgKm1mbiA9IF9tZm4odmlydF90b19tZm4oZ3QtPnN0YXR1c1tpZHhdKSk7CiAgICAgcmV0dXJu
IDA7CiB9CkBAIC0zOTYyLDYgKzM5ODUsNyBAQCBzdGF0aWMgdm9pZCBnbnR0YWJfdXNhZ2VfcHJp
bnQoc3RydWN0IGRvbWFpbiAqcmQpCiAgICAgaW50IGZpcnN0ID0gMTsKICAgICBncmFudF9yZWZf
dCByZWY7CiAgICAgc3RydWN0IGdyYW50X3RhYmxlICpndCA9IHJkLT5ncmFudF90YWJsZTsKKyAg
ICB1bnNpZ25lZCBpbnQgbnJfZW50czsKIAogICAgIHByaW50aygiICAgICAgLS0tLS0tLS0gYWN0
aXZlIC0tLS0tLS0tICAgICAgIC0tLS0tLS0tIHNoYXJlZCAtLS0tLS0tLVxuIik7CiAgICAgcHJp
bnRrKCJbcmVmXSBsb2NhbGRvbSBtZm4gICAgICBwaW4gICAgICAgICAgbG9jYWxkb20gZ21mbiAg
ICAgZmxhZ3NcbiIpOwpAQCAtMzk3NCw3ICszOTk4LDggQEAgc3RhdGljIHZvaWQgZ250dGFiX3Vz
YWdlX3ByaW50KHN0cnVjdCBkb21haW4gKnJkKQogICAgICAgICAgICBucl9ncmFudF9mcmFtZXMo
Z3QpLCBndC0+bWF4X2dyYW50X2ZyYW1lcywKICAgICAgICAgICAgbnJfbWFwdHJhY2tfZnJhbWVz
KGd0KSwgZ3QtPm1heF9tYXB0cmFja19mcmFtZXMpOwogCi0gICAgZm9yICggcmVmID0gMDsgcmVm
ICE9IG5yX2dyYW50X2VudHJpZXMoZ3QpOyByZWYrKyApCisgICAgbnJfZW50cyA9IG5yX2dyYW50
X2VudHJpZXMoZ3QpOworICAgIGZvciAoIHJlZiA9IDA7IHJlZiAhPSBucl9lbnRzOyByZWYrKyAp
CiAgICAgewogICAgICAgICBzdHJ1Y3QgYWN0aXZlX2dyYW50X2VudHJ5ICphY3Q7CiAgICAgICAg
IHN0cnVjdCBncmFudF9lbnRyeV9oZWFkZXIgKnNoYTsKLS0gCjIuNy40CgoKCgpBbWF6b24gRGV2
ZWxvcG1lbnQgQ2VudGVyIEdlcm1hbnkgR21iSApLcmF1c2Vuc3RyLiAzOAoxMDExNyBCZXJsaW4K
R2VzY2hhZWZ0c2Z1ZWhyZXI6IENocmlzdGlhbiBTY2hsYWVnZXIsIFJhbGYgSGVyYnJpY2gKVXN0
LUlEOiBERSAyODkgMjM3IDg3OQpFaW5nZXRyYWdlbiBhbSBBbXRzZ2VyaWNodCBDaGFybG90dGVu
YnVyZyBIUkIgMTQ5MTczIEIKCgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJv
amVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hl
bi1kZXZlbA==

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 4EC746E729
	for <lists+xen-devel@lfdr.de>; Fri, 19 Jul 2019 16:10:48 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hoTY3-00070U-NQ; Fri, 19 Jul 2019 14:07:47 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=RcFV=VQ=citrix.com=roger.pau@srs-us1.protection.inumbo.net>)
 id 1hoTY1-0006zj-Dq
 for xen-devel@lists.xenproject.org; Fri, 19 Jul 2019 14:07:45 +0000
X-Inumbo-ID: 9333c889-aa2e-11e9-8980-bc764e045a96
Received: from esa1.hc3370-68.iphmx.com (unknown [216.71.145.142])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 9333c889-aa2e-11e9-8980-bc764e045a96;
 Fri, 19 Jul 2019 14:07:42 +0000 (UTC)
Authentication-Results: esa1.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=roger.pau@citrix.com;
 spf=Pass smtp.mailfrom=roger.pau@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa1.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 roger.pau@citrix.com) identity=pra; client-ip=162.221.158.21;
 receiver=esa1.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="roger.pau@citrix.com"; x-conformance=sidf_compatible
Received-SPF: Pass (esa1.hc3370-68.iphmx.com: domain of
 roger.pau@citrix.com designates 162.221.158.21 as permitted
 sender) identity=mailfrom; client-ip=162.221.158.21;
 receiver=esa1.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="roger.pau@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83 ~all"
Received-SPF: None (esa1.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa1.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: AL58eRS7X5jrTx4c9JrrYnRkQ6vftZj9CjVUvgf6uUBv6psx9lbCDTjG9pprrXra7xJ4akvC1P
 wM2JijwwwMVdJJpB5c2bCp0pCE7ZCIbxvg+njfJuYMiImaJpZCYT4OubyyDlVL6Yuy6T7W7ori
 TcRfbwLtujrS8RpmgGW54o4CG5Wc5E+6eCmXq+9MPE2qlu8qg3cVRHHn9bjzltbC8b+Ml/5QsY
 vv2WyS/BgxIXqv1GLyyBxOkoaShMFxWYT+025TDaEkgqM9e5UEiX7PI85he6hA4cwW2NxAxWZd
 0XI=
X-SBRS: 2.7
X-MesageID: 3219948
X-Ironport-Server: esa1.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.64,282,1559534400"; 
   d="scan'208";a="3219948"
From: Roger Pau Monne <roger.pau@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Fri, 19 Jul 2019 16:07:21 +0200
Message-ID: <20190719140724.69596-4-roger.pau@citrix.com>
X-Mailer: git-send-email 2.20.1 (Apple Git-117)
In-Reply-To: <20190719140724.69596-1-roger.pau@citrix.com>
References: <20190719140724.69596-1-roger.pau@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v4 3/6] pci: switch pci_conf_read32 to use
 pci_sbdf_t
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Kevin Tian <kevin.tian@intel.com>,
 Stefano Stabellini <sstabellini@kernel.org>,
 Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>, Andrew
 Cooper <andrew.cooper3@citrix.com>, Ian Jackson <ian.jackson@eu.citrix.com>,
 Tim Deegan <tim@xen.org>, Julien Grall <julien.grall@arm.com>,
 Jan Beulich <jbeulich@suse.com>, Brian Woods <brian.woods@amd.com>,
 Roger Pau Monne <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhpcyByZWR1Y2VzIHRoZSBudW1iZXIgb2YgcGFyYW1ldGVycyBvZiB0aGUgZnVuY3Rpb24gdG8g
dHdvLCBhbmQKc2ltcGxpZmllcyBzb21lIG9mIHRoZSBjYWxsaW5nIHNpdGVzLgoKV2hpbGUgdGhl
cmUgY29udmVydCB7SUdEL0lPSH1fREVWIHRvIGJlIGEgcGNpX3NiZGZfdCBpdHNlbGYgaW5zdGVh
ZCBvZgphIGRldmljZSBudW1iZXIuCgpTaWduZWQtb2ZmLWJ5OiBSb2dlciBQYXUgTW9ubsOpIDxy
b2dlci5wYXVAY2l0cml4LmNvbT4KQWNrZWQtYnk6IEJyaWFuIFdvb2RzIDxicmlhbi53b29kc0Bh
bWQuY29tPgpSZXZpZXdlZC1ieTogS2V2aW4gVGlhbiA8a2V2aW4udGlhbkBpbnRlbC5jb20+Ci0t
LQpDYzogSmFuIEJldWxpY2ggPGpiZXVsaWNoQHN1c2UuY29tPgpDYzogQW5kcmV3IENvb3BlciA8
YW5kcmV3LmNvb3BlcjNAY2l0cml4LmNvbT4KQ2M6IFdlaSBMaXUgPHdsQHhlbi5vcmc+CkNjOiBH
ZW9yZ2UgRHVubGFwIDxHZW9yZ2UuRHVubGFwQGV1LmNpdHJpeC5jb20+CkNjOiBJYW4gSmFja3Nv
biA8aWFuLmphY2tzb25AZXUuY2l0cml4LmNvbT4KQ2M6IEp1bGllbiBHcmFsbCA8anVsaWVuLmdy
YWxsQGFybS5jb20+CkNjOiBLb25yYWQgUnplc3p1dGVrIFdpbGsgPGtvbnJhZC53aWxrQG9yYWNs
ZS5jb20+CkNjOiBTdGVmYW5vIFN0YWJlbGxpbmkgPHNzdGFiZWxsaW5pQGtlcm5lbC5vcmc+CkNj
OiBUaW0gRGVlZ2FuIDx0aW1AeGVuLm9yZz4KQ2M6IFN1cmF2ZWUgU3V0aGlrdWxwYW5pdCA8c3Vy
YXZlZS5zdXRoaWt1bHBhbml0QGFtZC5jb20+CkNjOiBCcmlhbiBXb29kcyA8YnJpYW4ud29vZHNA
YW1kLmNvbT4KQ2M6IEtldmluIFRpYW4gPGtldmluLnRpYW5AaW50ZWwuY29tPgotLS0KQ2hhbmdl
cyBzaW5jZSB2MzoKIC0gRml4IHR3byB1c2FnZXMgb2YgdTMyIGFuZCB1NjQuCiAtIFN3aXRjaCB7
SUdEL0lPSH1fREVWIHRvIHBjaV9zYmRmX3QuCi0tLQogeGVuL2FyY2gveDg2L2NwdS9hbWQuYyAg
ICAgICAgICAgICAgICAgICAgIHwgIDcgKystLQogeGVuL2FyY2gveDg2L21tLmMgICAgICAgICAg
ICAgICAgICAgICAgICAgIHwgIDIgKy0KIHhlbi9hcmNoL3g4Ni9tc2kuYyAgICAgICAgICAgICAg
ICAgICAgICAgICB8IDMwICsrKysrKy0tLS0tLS0tCiB4ZW4vYXJjaC94ODYvb3Byb2ZpbGUvb3Bf
bW9kZWxfYXRobG9uLmMgICAgfCAgNiArKy0KIHhlbi9hcmNoL3g4Ni94ODZfNjQvbW1jb25mLWZh
bTEwaC5jICAgICAgICB8ICA4ICsrLS0KIHhlbi9hcmNoL3g4Ni94ODZfNjQvbW1jb25maWctc2hh
cmVkLmMgICAgICB8IDEyICsrKy0tLQogeGVuL2FyY2gveDg2L3g4Nl82NC9wY2kuYyAgICAgICAg
ICAgICAgICAgIHwgMjcgKysrKysrLS0tLS0tLQogeGVuL2RyaXZlcnMvY2hhci9laGNpLWRiZ3Au
YyAgICAgICAgICAgICAgIHwgMjAgKysrKysrLS0tLQogeGVuL2RyaXZlcnMvY2hhci9uczE2NTUw
LmMgICAgICAgICAgICAgICAgIHwgMTggKysrKystLS0tCiB4ZW4vZHJpdmVycy9wYXNzdGhyb3Vn
aC9hbWQvaW9tbXVfZGV0ZWN0LmMgfCAgMiArLQogeGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1k
L2lvbW11X2luaXQuYyAgIHwgIDQgKy0KIHhlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3BjaS5jICAg
ICAgICAgICAgICB8IDE1ICsrKy0tLS0KIHhlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9xdWly
a3MuYyAgICAgICB8IDQ2ICsrKysrKysrKysrLS0tLS0tLS0tLS0KIHhlbi9kcml2ZXJzL3BjaS9w
Y2kuYyAgICAgICAgICAgICAgICAgICAgICB8ICA0ICstCiB4ZW4vZHJpdmVycy92cGNpL2hlYWRl
ci5jICAgICAgICAgICAgICAgICAgfCAgNiArLS0KIHhlbi9kcml2ZXJzL3ZwY2kvbXNpeC5jICAg
ICAgICAgICAgICAgICAgICB8ICA2ICstLQogeGVuL2RyaXZlcnMvdnBjaS92cGNpLmMgICAgICAg
ICAgICAgICAgICAgIHwgIDUgKy0tCiB4ZW4vaW5jbHVkZS94ZW4vcGNpLmggICAgICAgICAgICAg
ICAgICAgICAgfCAgNCArLQogMTggZmlsZXMgY2hhbmdlZCwgMTA2IGluc2VydGlvbnMoKyksIDEx
NiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvY3B1L2FtZC5jIGIveGVu
L2FyY2gveDg2L2NwdS9hbWQuYwppbmRleCBjNmM3NGU3NWY1Li44YTQwMzczZGRmIDEwMDY0NAot
LS0gYS94ZW4vYXJjaC94ODYvY3B1L2FtZC5jCisrKyBiL3hlbi9hcmNoL3g4Ni9jcHUvYW1kLmMK
QEAgLTQxNyw3ICs0MTcsOCBAQCBzdGF0aWMgdm9pZCBkaXNhYmxlX2MxX3JhbXBpbmcodm9pZCkK
IAlpbnQgbm9kZSwgbnJfbm9kZXM7CiAKIAkvKiBSZWFkIHRoZSBudW1iZXIgb2Ygbm9kZXMgZnJv
bSB0aGUgZmlyc3QgTm9ydGhicmlkZ2UuICovCi0JbnJfbm9kZXMgPSAoKHBjaV9jb25mX3JlYWQz
MigwLCAwLCAweDE4LCAweDAsIDB4NjApPj40KSYweDA3KSsxOworCW5yX25vZGVzID0gKChwY2lf
Y29uZl9yZWFkMzIoUENJX1NCREYoMCwgMCwgMHgxOCwgMCksIDB4NjApID4+IDQpICYKKwkJICAg
IDB4MDcpICsgMTsKIAlmb3IgKG5vZGUgPSAwOyBub2RlIDwgbnJfbm9kZXM7IG5vZGUrKykgewog
CQkvKiBQTU03OiBidXM9MCwgZGV2PTB4MTgrbm9kZSwgZnVuY3Rpb249MHgzLCByZWdpc3Rlcj0w
eDg3LiAqLwogCQlwbW03ID0gcGNpX2NvbmZfcmVhZDgoUENJX1NCREYoMCwgMCwgMHgxOCArIG5v
ZGUsIDMpLCAweDg3KTsKQEAgLTcwMyw4ICs3MDQsOCBAQCBzdGF0aWMgdm9pZCBpbml0X2FtZChz
dHJ1Y3QgY3B1aW5mb194ODYgKmMpCiAKIAlpZiAoYy0+eDg2ID09IDB4MTYgJiYgYy0+eDg2X21v
ZGVsIDw9IDB4ZikgewogCQlpZiAoYyA9PSAmYm9vdF9jcHVfZGF0YSkgewotCQkJbCA9IHBjaV9j
b25mX3JlYWQzMigwLCAwLCAweDE4LCAweDMsIDB4NTgpOwotCQkJaCA9IHBjaV9jb25mX3JlYWQz
MigwLCAwLCAweDE4LCAweDMsIDB4NWMpOworCQkJbCA9IHBjaV9jb25mX3JlYWQzMihQQ0lfU0JE
RigwLCAwLCAweDE4LCAzKSwgMHg1OCk7CisJCQloID0gcGNpX2NvbmZfcmVhZDMyKFBDSV9TQkRG
KDAsIDAsIDB4MTgsIDMpLCAweDVjKTsKIAkJCWlmICgobCAmIDB4MWYpIHwgKGggJiAweDEpKQog
CQkJCXByaW50ayhLRVJOX1dBUk5JTkcKIAkJCQkgICAgICAgIkFwcGx5aW5nIHdvcmthcm91bmQg
Zm9yIGVycmF0dW0gNzkyOiAlcyVzJXNcbiIsCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvbW0u
YyBiL3hlbi9hcmNoL3g4Ni9tbS5jCmluZGV4IDMzNDU3MWQ0NDUuLjU2Yjk1ZTE1ZDEgMTAwNjQ0
Ci0tLSBhL3hlbi9hcmNoL3g4Ni9tbS5jCisrKyBiL3hlbi9hcmNoL3g4Ni9tbS5jCkBAIC01OTUw
LDcgKzU5NTAsNyBAQCBjb25zdCBzdHJ1Y3QgcGxhdGZvcm1fYmFkX3BhZ2UgKl9faW5pdCBnZXRf
cGxhdGZvcm1fYmFkcGFnZXModW5zaWduZWQgaW50ICphcnJheQogICAgIH0KIAogICAgICphcnJh
eV9zaXplID0gQVJSQVlfU0laRShzbmJfYmFkX3BhZ2VzKTsKLSAgICBpZ2RfaWQgPSBwY2lfY29u
Zl9yZWFkMzIoMCwgMCwgMiwgMCwgMCk7CisgICAgaWdkX2lkID0gcGNpX2NvbmZfcmVhZDMyKFBD
SV9TQkRGKDAsIDAsIDIsIDApLCAwKTsKICAgICBpZiAoIElTX1NOQl9HRlgoaWdkX2lkKSApCiAg
ICAgICAgIHJldHVybiBzbmJfYmFkX3BhZ2VzOwogCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYv
bXNpLmMgYi94ZW4vYXJjaC94ODYvbXNpLmMKaW5kZXggN2RmOWRkYWNmZi4uNTI2MTdjZDg0MyAx
MDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L21zaS5jCisrKyBiL3hlbi9hcmNoL3g4Ni9tc2kuYwpA
QCAtMTkxLDE2ICsxOTEsMTMgQEAgc3RhdGljIGJvb2wgcmVhZF9tc2lfbXNnKHN0cnVjdCBtc2lf
ZGVzYyAqZW50cnksIHN0cnVjdCBtc2lfbXNnICptc2cpCiAgICAgewogICAgICAgICBzdHJ1Y3Qg
cGNpX2RldiAqZGV2ID0gZW50cnktPmRldjsKICAgICAgICAgaW50IHBvcyA9IGVudHJ5LT5tc2lf
YXR0cmliLnBvczsKLSAgICAgICAgdTE2IGRhdGEsIHNlZyA9IGRldi0+c2VnOwotICAgICAgICB1
OCBidXMgPSBkZXYtPmJ1czsKLSAgICAgICAgdTggc2xvdCA9IFBDSV9TTE9UKGRldi0+ZGV2Zm4p
OwotICAgICAgICB1OCBmdW5jID0gUENJX0ZVTkMoZGV2LT5kZXZmbik7CisgICAgICAgIHVpbnQx
Nl90IGRhdGE7CiAKLSAgICAgICAgbXNnLT5hZGRyZXNzX2xvID0gcGNpX2NvbmZfcmVhZDMyKHNl
ZywgYnVzLCBzbG90LCBmdW5jLAorICAgICAgICBtc2ctPmFkZHJlc3NfbG8gPSBwY2lfY29uZl9y
ZWFkMzIoZGV2LT5zYmRmLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgbXNpX2xvd2VyX2FkZHJlc3NfcmVnKHBvcykpOwogICAgICAgICBpZiAoIGVudHJ5LT5tc2lf
YXR0cmliLmlzXzY0ICkKICAgICAgICAgewotICAgICAgICAgICAgbXNnLT5hZGRyZXNzX2hpID0g
cGNpX2NvbmZfcmVhZDMyKHNlZywgYnVzLCBzbG90LCBmdW5jLAorICAgICAgICAgICAgbXNnLT5h
ZGRyZXNzX2hpID0gcGNpX2NvbmZfcmVhZDMyKGRldi0+c2JkZiwKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2lfdXBwZXJfYWRkcmVzc19yZWcocG9zKSk7
CiAgICAgICAgICAgICBkYXRhID0gcGNpX2NvbmZfcmVhZDE2KGRldi0+c2JkZiwgbXNpX2RhdGFf
cmVnKHBvcywgMSkpOwogICAgICAgICB9CkBAIC0zOTYsNyArMzkzLDcgQEAgc3RhdGljIGJvb2wg
bXNpX3NldF9tYXNrX2JpdChzdHJ1Y3QgaXJxX2Rlc2MgKmRlc2MsIGJvb2wgaG9zdCwgYm9vbCBn
dWVzdCkKICAgICAgICAgewogICAgICAgICAgICAgdTMyIG1hc2tfYml0czsKIAotICAgICAgICAg
ICAgbWFza19iaXRzID0gcGNpX2NvbmZfcmVhZDMyKHNlZywgYnVzLCBzbG90LCBmdW5jLCBlbnRy
eS0+bXNpLm1wb3MpOworICAgICAgICAgICAgbWFza19iaXRzID0gcGNpX2NvbmZfcmVhZDMyKHBk
ZXYtPnNiZGYsIGVudHJ5LT5tc2kubXBvcyk7CiAgICAgICAgICAgICBtYXNrX2JpdHMgJj0gfigo
dTMyKTEgPDwgZW50cnktPm1zaV9hdHRyaWIuZW50cnlfbnIpOwogICAgICAgICAgICAgbWFza19i
aXRzIHw9ICh1MzIpZmxhZyA8PCBlbnRyeS0+bXNpX2F0dHJpYi5lbnRyeV9ucjsKICAgICAgICAg
ICAgIHBjaV9jb25mX3dyaXRlMzIoc2VnLCBidXMsIHNsb3QsIGZ1bmMsIGVudHJ5LT5tc2kubXBv
cywgbWFza19iaXRzKTsKQEAgLTQ2NSwxMCArNDYyLDcgQEAgc3RhdGljIGludCBtc2lfZ2V0X21h
c2tfYml0KGNvbnN0IHN0cnVjdCBtc2lfZGVzYyAqZW50cnkpCiAgICAgY2FzZSBQQ0lfQ0FQX0lE
X01TSToKICAgICAgICAgaWYgKCAhZW50cnktPm1zaV9hdHRyaWIubWFza2JpdCApCiAgICAgICAg
ICAgICBicmVhazsKLSAgICAgICAgcmV0dXJuIChwY2lfY29uZl9yZWFkMzIoZW50cnktPmRldi0+
c2VnLCBlbnRyeS0+ZGV2LT5idXMsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBD
SV9TTE9UKGVudHJ5LT5kZXYtPmRldmZuKSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgUENJX0ZVTkMoZW50cnktPmRldi0+ZGV2Zm4pLAotICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBlbnRyeS0+bXNpLm1wb3MpID4+CisgICAgICAgIHJldHVybiAocGNpX2NvbmZfcmVh
ZDMyKGVudHJ5LT5kZXYtPnNiZGYsIGVudHJ5LT5tc2kubXBvcykgPj4KICAgICAgICAgICAgICAg
ICBlbnRyeS0+bXNpX2F0dHJpYi5lbnRyeV9ucikgJiAxOwogICAgIGNhc2UgUENJX0NBUF9JRF9N
U0lYOgogICAgICAgICBpZiAoIHVubGlrZWx5KCFtc2l4X21lbW9yeV9kZWNvZGVkKGVudHJ5LT5k
ZXYsCkBAIC03MjMsNyArNzE3LDcgQEAgc3RhdGljIGludCBtc2lfY2FwYWJpbGl0eV9pbml0KHN0
cnVjdCBwY2lfZGV2ICpkZXYsCiAgICAgICAgIHUzMiBtYXNrYml0czsKIAogICAgICAgICAvKiBB
bGwgTVNJcyBhcmUgdW5tYXNrZWQgYnkgZGVmYXVsdCwgTWFzayB0aGVtIGFsbCAqLwotICAgICAg
ICBtYXNrYml0cyA9IHBjaV9jb25mX3JlYWQzMihzZWcsIGJ1cywgc2xvdCwgZnVuYywgbXBvcyk7
CisgICAgICAgIG1hc2tiaXRzID0gcGNpX2NvbmZfcmVhZDMyKGRldi0+c2JkZiwgbXBvcyk7CiAg
ICAgICAgIG1hc2tiaXRzIHw9IH4odTMyKTAgPj4gKDMyIC0gbWF4dmVjKTsKICAgICAgICAgcGNp
X2NvbmZfd3JpdGUzMihzZWcsIGJ1cywgc2xvdCwgZnVuYywgbXBvcywgbWFza2JpdHMpOwogICAg
IH0KQEAgLTgwOCw3ICs4MDIsNyBAQCBzdGF0aWMgdTY0IHJlYWRfcGNpX21lbV9iYXIodTE2IHNl
ZywgdTggYnVzLCB1OCBzbG90LCB1OCBmdW5jLCB1OCBiaXIsIGludCB2ZikKIAogICAgIGlmICgg
YmlyID49IGxpbWl0ICkKICAgICAgICAgcmV0dXJuIDA7Ci0gICAgYWRkciA9IHBjaV9jb25mX3Jl
YWQzMihzZWcsIGJ1cywgc2xvdCwgZnVuYywgYmFzZSArIGJpciAqIDQpOworICAgIGFkZHIgPSBw
Y2lfY29uZl9yZWFkMzIoUENJX1NCREYoc2VnLCBidXMsIHNsb3QsIGZ1bmMpLCBiYXNlICsgYmly
ICogNCk7CiAgICAgaWYgKCAoYWRkciAmIFBDSV9CQVNFX0FERFJFU1NfU1BBQ0UpID09IFBDSV9C
QVNFX0FERFJFU1NfU1BBQ0VfSU8gKQogICAgICAgICByZXR1cm4gMDsKICAgICBpZiAoIChhZGRy
ICYgUENJX0JBU0VfQUREUkVTU19NRU1fVFlQRV9NQVNLKSA9PSBQQ0lfQkFTRV9BRERSRVNTX01F
TV9UWVBFXzY0ICkKQEAgLTgxNyw4ICs4MTEsOCBAQCBzdGF0aWMgdTY0IHJlYWRfcGNpX21lbV9i
YXIodTE2IHNlZywgdTggYnVzLCB1OCBzbG90LCB1OCBmdW5jLCB1OCBiaXIsIGludCB2ZikKICAg
ICAgICAgaWYgKCArK2JpciA+PSBsaW1pdCApCiAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAg
ICAgcmV0dXJuIGFkZHIgKyBkaXNwICsKLSAgICAgICAgICAgICAgICgodTY0KXBjaV9jb25mX3Jl
YWQzMihzZWcsIGJ1cywgc2xvdCwgZnVuYywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBiYXNlICsgYmlyICogNCkgPDwgMzIpOworICAgICAgICAgICAgICAgKCh1aW50NjRf
dClwY2lfY29uZl9yZWFkMzIoUENJX1NCREYoc2VnLCBidXMsIHNsb3QsIGZ1bmMpLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFzZSArIGJpciAqIDQpIDw8IDMy
KTsKICAgICB9CiAgICAgcmV0dXJuIChhZGRyICYgUENJX0JBU0VfQUREUkVTU19NRU1fTUFTSykg
KyBkaXNwOwogfQpAQCAtODg2LDggKzg4MCw3IEBAIHN0YXRpYyBpbnQgbXNpeF9jYXBhYmlsaXR5
X2luaXQoc3RydWN0IHBjaV9kZXYgKmRldiwKICAgICB9CiAKICAgICAvKiBMb2NhdGUgTVNJLVgg
dGFibGUgcmVnaW9uICovCi0gICAgdGFibGVfb2Zmc2V0ID0gcGNpX2NvbmZfcmVhZDMyKHNlZywg
YnVzLCBzbG90LCBmdW5jLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2l4
X3RhYmxlX29mZnNldF9yZWcocG9zKSk7CisgICAgdGFibGVfb2Zmc2V0ID0gcGNpX2NvbmZfcmVh
ZDMyKGRldi0+c2JkZiwgbXNpeF90YWJsZV9vZmZzZXRfcmVnKHBvcykpOwogICAgIGJpciA9ICh1
OCkodGFibGVfb2Zmc2V0ICYgUENJX01TSVhfQklSTUFTSyk7CiAgICAgdGFibGVfb2Zmc2V0ICY9
IH5QQ0lfTVNJWF9CSVJNQVNLOwogCkBAIC05MzMsOCArOTI2LDcgQEAgc3RhdGljIGludCBtc2l4
X2NhcGFiaWxpdHlfaW5pdChzdHJ1Y3QgcGNpX2RldiAqZGV2LAogICAgICAgICBXQVJOX09OKHJh
bmdlc2V0X292ZXJsYXBzX3JhbmdlKG1taW9fcm9fcmFuZ2VzLCBtc2l4LT50YWJsZS5maXJzdCwK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2l4LT50YWJsZS5sYXN0
KSk7CiAKLSAgICAgICAgcGJhX29mZnNldCA9IHBjaV9jb25mX3JlYWQzMihzZWcsIGJ1cywgc2xv
dCwgZnVuYywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2l4X3BiYV9v
ZmZzZXRfcmVnKHBvcykpOworICAgICAgICBwYmFfb2Zmc2V0ID0gcGNpX2NvbmZfcmVhZDMyKGRl
di0+c2JkZiwgbXNpeF9wYmFfb2Zmc2V0X3JlZyhwb3MpKTsKICAgICAgICAgYmlyID0gKHU4KShw
YmFfb2Zmc2V0ICYgUENJX01TSVhfQklSTUFTSyk7CiAgICAgICAgIHBiYV9wYWRkciA9IHJlYWRf
cGNpX21lbV9iYXIoc2VnLCBwYnVzLCBwc2xvdCwgcGZ1bmMsIGJpciwgdmYpOwogICAgICAgICBX
QVJOX09OKCFwYmFfcGFkZHIpOwpkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L29wcm9maWxlL29w
X21vZGVsX2F0aGxvbi5jIGIveGVuL2FyY2gveDg2L29wcm9maWxlL29wX21vZGVsX2F0aGxvbi5j
CmluZGV4IDNkNmUyNmY2MzYuLjNiZjBiMDIxNGQgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9v
cHJvZmlsZS9vcF9tb2RlbF9hdGhsb24uYworKysgYi94ZW4vYXJjaC94ODYvb3Byb2ZpbGUvb3Bf
bW9kZWxfYXRobG9uLmMKQEAgLTQ2Myw3ICs0NjMsOCBAQCBzdGF0aWMgaW50IF9faW5pdCBpbml0
X2lic19ubWkodm9pZCkKIAlmb3IgKGJ1cyA9IDA7IGJ1cyA8IDI1NjsgYnVzKyspIHsKIAkJZm9y
IChkZXYgPSAwOyBkZXYgPCAzMjsgZGV2KyspIHsKIAkJCWZvciAoZnVuYyA9IDA7IGZ1bmMgPCA4
OyBmdW5jKyspIHsKLQkJCQlpZCA9IHBjaV9jb25mX3JlYWQzMigwLCBidXMsIGRldiwgZnVuYywg
UENJX1ZFTkRPUl9JRCk7CisJCQkJaWQgPSBwY2lfY29uZl9yZWFkMzIoUENJX1NCREYoMCwgYnVz
LCBkZXYsIGZ1bmMpLAorCQkJCQkJICAgICBQQ0lfVkVORE9SX0lEKTsKIAogCQkJCXZlbmRvcl9p
ZCA9IGlkICYgMHhmZmZmOwogCQkJCWRldl9pZCA9IChpZCA+PiAxNikgJiAweGZmZmY7CkBAIC00
NzQsNyArNDc1LDggQEAgc3RhdGljIGludCBfX2luaXQgaW5pdF9pYnNfbm1pKHZvaWQpCiAJCQkJ
CXBjaV9jb25mX3dyaXRlMzIoMCwgYnVzLCBkZXYsIGZ1bmMsIElCU0NUTCwKIAkJCQkJCUlCU0NU
TF9MVlRPRkZTRVRWQUwgfCBBUElDX0VJTFZUX0xWVE9GRl9JQlMpOwogCi0JCQkJCXZhbHVlID0g
cGNpX2NvbmZfcmVhZDMyKDAsIGJ1cywgZGV2LCBmdW5jLCBJQlNDVEwpOworCQkJCQl2YWx1ZSA9
IHBjaV9jb25mX3JlYWQzMihQQ0lfU0JERigwLCBidXMsIGRldiwgZnVuYyksCisJCQkJCQkJCUlC
U0NUTCk7CiAKIAkJCQkJaWYgKHZhbHVlICE9IChJQlNDVExfTFZUT0ZGU0VUVkFMIHwKIAkJCQkJ
CUFQSUNfRUlMVlRfTFZUT0ZGX0lCUykpIHsKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni94ODZf
NjQvbW1jb25mLWZhbTEwaC5jIGIveGVuL2FyY2gveDg2L3g4Nl82NC9tbWNvbmYtZmFtMTBoLmMK
aW5kZXggZWQwYWNiOTk2OC4uZjk5NzY4OGFkNCAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L3g4
Nl82NC9tbWNvbmYtZmFtMTBoLmMKKysrIGIveGVuL2FyY2gveDg2L3g4Nl82NC9tbWNvbmYtZmFt
MTBoLmMKQEAgLTUyLDcgKzUyLDcgQEAgc3RhdGljIHZvaWQgX19pbml0IGdldF9mYW0xMGhfcGNp
X21tY29uZl9iYXNlKHZvaWQpCiAKIAkJYnVzID0gcGNpX3Byb2Jlc1tpXS5idXM7CiAJCXNsb3Qg
PSBwY2lfcHJvYmVzW2ldLnNsb3Q7Ci0JCWlkID0gcGNpX2NvbmZfcmVhZDMyKDAsIGJ1cywgc2xv
dCwgMCwgUENJX1ZFTkRPUl9JRCk7CisJCWlkID0gcGNpX2NvbmZfcmVhZDMyKFBDSV9TQkRGKDAs
IGJ1cywgc2xvdCwgMCksIFBDSV9WRU5ET1JfSUQpOwogCiAJCXZlbmRvciA9IGlkICYgMHhmZmZm
OwogCQlkZXZpY2UgPSAoaWQ+PjE2KSAmIDB4ZmZmZjsKQEAgLTgzLDEyICs4MywxNCBAQCBzdGF0
aWMgdm9pZCBfX2luaXQgZ2V0X2ZhbTEwaF9wY2lfbW1jb25mX2Jhc2Uodm9pZCkKIAkgKiBhYm92
ZSA0RwogCSAqLwogCWZvciAoaGlfbW1pb19udW0gPSBpID0gMDsgaSA8IDg7IGkrKykgewotCQl2
YWwgPSBwY2lfY29uZl9yZWFkMzIoMCwgYnVzLCBzbG90LCAxLCAweDgwICsgKGkgPDwgMykpOwor
CQl2YWwgPSBwY2lfY29uZl9yZWFkMzIoUENJX1NCREYoMCwgYnVzLCBzbG90LCAxKSwKKwkJCQkg
ICAgICAweDgwICsgKGkgPDwgMykpOwogCQlpZiAoISh2YWwgJiAzKSkKIAkJCWNvbnRpbnVlOwog
CiAJCXN0YXJ0ID0gKHZhbCAmIDB4ZmZmZmZmMDApIDw8IDg7IC8qIDM5OjE2IG9uIDMxOjgqLwot
CQl2YWwgPSBwY2lfY29uZl9yZWFkMzIoMCwgYnVzLCBzbG90LCAxLCAweDg0ICsgKGkgPDwgMykp
OworCQl2YWwgPSBwY2lfY29uZl9yZWFkMzIoUENJX1NCREYoMCwgYnVzLCBzbG90LCAxKSwKKwkJ
CQkgICAgICAweDg0ICsgKGkgPDwgMykpOwogCQllbmQgPSAoKHZhbCAmIDB4ZmZmZmZmMDApIDw8
IDgpIHwgMHhmZmZmOyAvKiAzOToxNiBvbiAzMTo4Ki8KIAogCQlpZiAoZW5kIDwgdG9tMikKZGlm
ZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni94ODZfNjQvbW1jb25maWctc2hhcmVkLmMgYi94ZW4vYXJj
aC94ODYveDg2XzY0L21tY29uZmlnLXNoYXJlZC5jCmluZGV4IDlkMWRiNTkwZDkuLmNjMDhiNTJh
MzUgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni94ODZfNjQvbW1jb25maWctc2hhcmVkLmMKKysr
IGIveGVuL2FyY2gveDg2L3g4Nl82NC9tbWNvbmZpZy1zaGFyZWQuYwpAQCAtODksNyArODksNyBA
QCBzdGF0aWMgY29uc3QgY2hhciBfX2luaXQgKnBjaV9tbWNmZ19pbnRlbF85NDUodm9pZCkKIAog
ICAgIHBjaV9tbWNmZ19jb25maWdfbnVtID0gMTsKIAotICAgIHBjaWV4YmFyID0gcGNpX2NvbmZf
cmVhZDMyKDAsIDAsIDAsIDAsIDB4NDgpOworICAgIHBjaWV4YmFyID0gcGNpX2NvbmZfcmVhZDMy
KFBDSV9TQkRGKDAsIDAsIDAsIDApLCAweDQ4KTsKIAogICAgIC8qIEVuYWJsZSBiaXQgKi8KICAg
ICBpZiAoIShwY2lleGJhciAmIDEpKQpAQCAtMjEzLDE0ICsyMTMsMTQgQEAgc3RhdGljIGNvbnN0
IGNoYXIgX19pbml0ICpwY2lfbW1jZmdfbnZpZGlhX21jcDU1KHZvaWQpCiAgICAgICAgIHUzMiBs
LCBleHRjZmc7CiAgICAgICAgIHUxNiB2ZW5kb3IsIGRldmljZTsKIAotICAgICAgICBsID0gcGNp
X2NvbmZfcmVhZDMyKDAsIGJ1cywgMCwgMCwgMCk7CisgICAgICAgIGwgPSBwY2lfY29uZl9yZWFk
MzIoUENJX1NCREYoMCwgYnVzLCAwLCAwKSwgMCk7CiAgICAgICAgIHZlbmRvciA9IGwgJiAweGZm
ZmY7CiAgICAgICAgIGRldmljZSA9IChsID4+IDE2KSAmIDB4ZmZmZjsKIAogICAgICAgICBpZiAo
UENJX1ZFTkRPUl9JRF9OVklESUEgIT0gdmVuZG9yIHx8IDB4MDM2OSAhPSBkZXZpY2UpCiAgICAg
ICAgICAgICBjb250aW51ZTsKIAotICAgICAgICBleHRjZmcgPSBwY2lfY29uZl9yZWFkMzIoMCwg
YnVzLCAwLCAwLCBleHRjZmdfcmVnbnVtKTsKKyAgICAgICAgZXh0Y2ZnID0gcGNpX2NvbmZfcmVh
ZDMyKFBDSV9TQkRGKDAsIGJ1cywgMCwgMCksIGV4dGNmZ19yZWdudW0pOwogCiAgICAgICAgIGlm
IChleHRjZmcgJiBleHRjZmdfZW5hYmxlX21hc2spCiAgICAgICAgICAgICBpKys7CkBAIC0yMzks
MTQgKzIzOSwxNCBAQCBzdGF0aWMgY29uc3QgY2hhciBfX2luaXQgKnBjaV9tbWNmZ19udmlkaWFf
bWNwNTUodm9pZCkKICAgICAgICAgdTE2IHZlbmRvciwgZGV2aWNlOwogICAgICAgICBpbnQgc2l6
ZV9pbmRleDsKIAotICAgICAgICBsID0gcGNpX2NvbmZfcmVhZDMyKDAsIGJ1cywgMCwgMCwgMCk7
CisgICAgICAgIGwgPSBwY2lfY29uZl9yZWFkMzIoUENJX1NCREYoMCwgYnVzLCAwLCAwKSwgMCk7
CiAgICAgICAgIHZlbmRvciA9IGwgJiAweGZmZmY7CiAgICAgICAgIGRldmljZSA9IChsID4+IDE2
KSAmIDB4ZmZmZjsKIAogICAgICAgICBpZiAoUENJX1ZFTkRPUl9JRF9OVklESUEgIT0gdmVuZG9y
IHx8IDB4MDM2OSAhPSBkZXZpY2UpCiAgICAgICAgICAgICBjb250aW51ZTsKIAotICAgICAgICBl
eHRjZmcgPSBwY2lfY29uZl9yZWFkMzIoMCwgYnVzLCAwLCAwLCBleHRjZmdfcmVnbnVtKTsKKyAg
ICAgICAgZXh0Y2ZnID0gcGNpX2NvbmZfcmVhZDMyKFBDSV9TQkRGKDAsIGJ1cywgMCwgMCksIGV4
dGNmZ19yZWdudW0pOwogCiAgICAgICAgIGlmICghKGV4dGNmZyAmIGV4dGNmZ19lbmFibGVfbWFz
aykpCiAgICAgICAgICAgICBjb250aW51ZTsKQEAgLTMxMiw3ICszMTIsNyBAQCBzdGF0aWMgaW50
IF9faW5pdCBwY2lfbW1jZmdfY2hlY2tfaG9zdGJyaWRnZSh2b2lkKQogICAgIGZvciAoaSA9IDA7
ICFuYW1lICYmIGkgPCBBUlJBWV9TSVpFKHBjaV9tbWNmZ19wcm9iZXMpOyBpKyspIHsKICAgICAg
ICAgYnVzID0gIHBjaV9tbWNmZ19wcm9iZXNbaV0uYnVzOwogICAgICAgICBkZXZmbiA9IHBjaV9t
bWNmZ19wcm9iZXNbaV0uZGV2Zm47Ci0gICAgICAgIGwgPSBwY2lfY29uZl9yZWFkMzIoMCwgYnVz
LCBQQ0lfU0xPVChkZXZmbiksIFBDSV9GVU5DKGRldmZuKSwgMCk7CisgICAgICAgIGwgPSBwY2lf
Y29uZl9yZWFkMzIoUENJX1NCREYzKDAsIGJ1cywgZGV2Zm4pLCAwKTsKICAgICAgICAgdmVuZG9y
ID0gbCAmIDB4ZmZmZjsKICAgICAgICAgZGV2aWNlID0gKGwgPj4gMTYpICYgMHhmZmZmOwogCmRp
ZmYgLS1naXQgYS94ZW4vYXJjaC94ODYveDg2XzY0L3BjaS5jIGIveGVuL2FyY2gveDg2L3g4Nl82
NC9wY2kuYwppbmRleCBmZTM2YjYwYzUwLi5iOGI4MmE2ZmU3IDEwMDY0NAotLS0gYS94ZW4vYXJj
aC94ODYveDg2XzY0L3BjaS5jCisrKyBiL3hlbi9hcmNoL3g4Ni94ODZfNjQvcGNpLmMKQEAgLTM3
LDI4ICszNywyMyBAQCB1aW50MTZfdCBwY2lfY29uZl9yZWFkMTYocGNpX3NiZGZfdCBzYmRmLCB1
bnNpZ25lZCBpbnQgcmVnKQogICAgIHJldHVybiBwY2lfY29uZl9yZWFkKFBDSV9DT05GX0FERFJF
U1Moc2JkZiwgcmVnKSwgcmVnICYgMiwgMik7CiB9CiAKLSN1bmRlZiBQQ0lfQ09ORl9BRERSRVNT
Ci0jZGVmaW5lIFBDSV9DT05GX0FERFJFU1MoYnVzLCBkZXYsIGZ1bmMsIHJlZykgXAotICAgICgw
eDgwMDAwMDAwIHwgKGJ1cyA8PCAxNikgfCAoZGV2IDw8IDExKSB8IChmdW5jIDw8IDgpIHwgKHJl
ZyAmIH4zKSkKLQotdWludDMyX3QgcGNpX2NvbmZfcmVhZDMyKAotICAgIHVuc2lnbmVkIGludCBz
ZWcsIHVuc2lnbmVkIGludCBidXMsIHVuc2lnbmVkIGludCBkZXYsIHVuc2lnbmVkIGludCBmdW5j
LAotICAgIHVuc2lnbmVkIGludCByZWcpCit1aW50MzJfdCBwY2lfY29uZl9yZWFkMzIocGNpX3Ni
ZGZfdCBzYmRmLCB1bnNpZ25lZCBpbnQgcmVnKQogewotICAgIHUzMiB2YWx1ZTsKLQotICAgIGlm
ICggc2VnIHx8IHJlZyA+IDI1NSApCisgICAgaWYgKCBzYmRmLnNlZyB8fCByZWcgPiAyNTUgKQog
ICAgIHsKLSAgICAgICAgcGNpX21tY2ZnX3JlYWQoc2VnLCBidXMsIFBDSV9ERVZGTihkZXYsIGZ1
bmMpLCByZWcsIDQsICZ2YWx1ZSk7CisgICAgICAgIHVpbnQzMl90IHZhbHVlOworCisgICAgICAg
IHBjaV9tbWNmZ19yZWFkKHNiZGYuc2VnLCBzYmRmLmJ1cywgc2JkZi5kZXZmbiwgcmVnLCA0LCAm
dmFsdWUpOwogICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgfQotICAgIGVsc2UKLSAgICB7Ci0g
ICAgICAgIEJVR19PTigoYnVzID4gMjU1KSB8fCAoZGV2ID4gMzEpIHx8IChmdW5jID4gNykpOwot
ICAgICAgICByZXR1cm4gcGNpX2NvbmZfcmVhZChQQ0lfQ09ORl9BRERSRVNTKGJ1cywgZGV2LCBm
dW5jLCByZWcpLCAwLCA0KTsKLSAgICB9CisKKyAgICByZXR1cm4gcGNpX2NvbmZfcmVhZChQQ0lf
Q09ORl9BRERSRVNTKHNiZGYsIHJlZyksIDAsIDQpOwogfQogCisjdW5kZWYgUENJX0NPTkZfQURE
UkVTUworI2RlZmluZSBQQ0lfQ09ORl9BRERSRVNTKGJ1cywgZGV2LCBmdW5jLCByZWcpIFwKKyAg
ICAoMHg4MDAwMDAwMCB8IChidXMgPDwgMTYpIHwgKGRldiA8PCAxMSkgfCAoZnVuYyA8PCA4KSB8
IChyZWcgJiB+MykpCisKIHZvaWQgcGNpX2NvbmZfd3JpdGU4KAogICAgIHVuc2lnbmVkIGludCBz
ZWcsIHVuc2lnbmVkIGludCBidXMsIHVuc2lnbmVkIGludCBkZXYsIHVuc2lnbmVkIGludCBmdW5j
LAogICAgIHVuc2lnbmVkIGludCByZWcsIHVpbnQ4X3QgZGF0YSkKZGlmZiAtLWdpdCBhL3hlbi9k
cml2ZXJzL2NoYXIvZWhjaS1kYmdwLmMgYi94ZW4vZHJpdmVycy9jaGFyL2VoY2ktZGJncC5jCmlu
ZGV4IDY0MjU4ZGEyZGMuLjliOTAyNWZiMzMgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL2NoYXIv
ZWhjaS1kYmdwLmMKKysrIGIveGVuL2RyaXZlcnMvY2hhci9laGNpLWRiZ3AuYwpAQCAtNjgyLDcg
KzY4Miw4IEBAIHN0YXRpYyBpbnQgZGJncF9jb250cm9sX21zZyhzdHJ1Y3QgZWhjaV9kYmdwICpk
YmdwLCB1bnNpZ25lZCBpbnQgZGV2bnVtLAogCiBzdGF0aWMgdW5zaWduZWQgaW50IF9faW5pdCBf
X2ZpbmRfZGJncCh1OCBidXMsIHU4IHNsb3QsIHU4IGZ1bmMpCiB7Ci0gICAgdTMyIGNsYXNzID0g
cGNpX2NvbmZfcmVhZDMyKDAsIGJ1cywgc2xvdCwgZnVuYywgUENJX0NMQVNTX1JFVklTSU9OKTsK
KyAgICB1aW50MzJfdCBjbGFzcyA9IHBjaV9jb25mX3JlYWQzMihQQ0lfU0JERigwLCBidXMsIHNs
b3QsIGZ1bmMpLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9DTEFT
U19SRVZJU0lPTik7CiAKICAgICBpZiAoIChjbGFzcyA+PiA4KSAhPSBQQ0lfQ0xBU1NfU0VSSUFM
X1VTQl9FSENJICkKICAgICAgICAgcmV0dXJuIDA7CkBAIC0xMDA2LDcgKzEwMDcsOCBAQCBzdGF0
aWMgc2V0X2RlYnVnX3BvcnRfdCBfX3JlYWRfbW9zdGx5IHNldF9kZWJ1Z19wb3J0ID0gZGVmYXVs
dF9zZXRfZGVidWdfcG9ydDsKIAogc3RhdGljIHZvaWQgbnZpZGlhX3NldF9kZWJ1Z19wb3J0KHN0
cnVjdCBlaGNpX2RiZ3AgKmRiZ3AsIHVuc2lnbmVkIGludCBwb3J0KQogewotICAgIHUzMiBkd29y
ZCA9IHBjaV9jb25mX3JlYWQzMigwLCBkYmdwLT5idXMsIGRiZ3AtPnNsb3QsIGRiZ3AtPmZ1bmMs
IDB4NzQpOworICAgIHVpbnQzMl90IGR3b3JkID0gcGNpX2NvbmZfcmVhZDMyKFBDSV9TQkRGKDAs
IGRiZ3AtPmJ1cywgZGJncC0+c2xvdCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBkYmdwLT5mdW5jKSwgMHg3NCk7CiAKICAgICBkd29yZCAmPSB+KDB4MGYg
PDwgMTIpOwogICAgIGR3b3JkIHw9IChwb3J0ICYgMHgwZikgPDwgMTI7CkBAIC0xMDM5LDcgKzEw
NDEsOCBAQCBzdGF0aWMgdm9pZCBlaGNpX2RiZ3BfYmlvc19oYW5kb2ZmKHN0cnVjdCBlaGNpX2Ri
Z3AgKmRiZ3AsIHUzMiBoY2NfcGFyYW1zKQogICAgIGlmICggIW9mZnNldCApCiAgICAgICAgIHJl
dHVybjsKIAotICAgIGNhcCA9IHBjaV9jb25mX3JlYWQzMigwLCBkYmdwLT5idXMsIGRiZ3AtPnNs
b3QsIGRiZ3AtPmZ1bmMsIG9mZnNldCk7CisgICAgY2FwID0gcGNpX2NvbmZfcmVhZDMyKFBDSV9T
QkRGKDAsIGRiZ3AtPmJ1cywgZGJncC0+c2xvdCwgZGJncC0+ZnVuYyksCisgICAgICAgICAgICAg
ICAgICAgICAgICAgIG9mZnNldCk7CiAgICAgZGJncF9wcmludGsoImRiZ3A6IEVIQ0kgQklPUyBz
dGF0ZSAlMDh4XG4iLCBjYXApOwogCiAgICAgaWYgKCAoY2FwICYgMHhmZikgPT0gMSAmJiAoY2Fw
ICYgRUhDSV9VU0JMRUdTVVBfQklPUykgKQpAQCAtMTA1NCw3ICsxMDU3LDggQEAgc3RhdGljIHZv
aWQgZWhjaV9kYmdwX2Jpb3NfaGFuZG9mZihzdHJ1Y3QgZWhjaV9kYmdwICpkYmdwLCB1MzIgaGNj
X3BhcmFtcykKICAgICB7CiAgICAgICAgIG1kZWxheSgxMCk7CiAgICAgICAgIG1zZWMgLT0gMTA7
Ci0gICAgICAgIGNhcCA9IHBjaV9jb25mX3JlYWQzMigwLCBkYmdwLT5idXMsIGRiZ3AtPnNsb3Qs
IGRiZ3AtPmZ1bmMsIG9mZnNldCk7CisgICAgICAgIGNhcCA9IHBjaV9jb25mX3JlYWQzMihQQ0lf
U0JERigwLCBkYmdwLT5idXMsIGRiZ3AtPnNsb3QsIGRiZ3AtPmZ1bmMpLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgb2Zmc2V0KTsKICAgICB9CiAKICAgICBpZiAoIGNhcCAmIEVIQ0lf
VVNCTEVHU1VQX0JJT1MgKQpAQCAtMTMwNyw3ICsxMzExLDcgQEAgc3RhdGljIHZvaWQgX19pbml0
IGVoY2lfZGJncF9pbml0X3ByZWlycShzdHJ1Y3Qgc2VyaWFsX3BvcnQgKnBvcnQpCiAgICAgdTMy
IGRlYnVnX3BvcnQsIG9mZnNldDsKICAgICB2b2lkIF9faW9tZW0gKmVoY2lfYmFyOwogCi0gICAg
ZGVidWdfcG9ydCA9IHBjaV9jb25mX3JlYWQzMigwLCBkYmdwLT5idXMsIGRiZ3AtPnNsb3QsIGRi
Z3AtPmZ1bmMsCisgICAgZGVidWdfcG9ydCA9IHBjaV9jb25mX3JlYWQzMihQQ0lfU0JERigwLCBk
YmdwLT5idXMsIGRiZ3AtPnNsb3QsIGRiZ3AtPmZ1bmMpLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgZGJncC0+Y2FwKTsKICAgICBvZmZzZXQgPSAoZGVidWdfcG9ydCA+PiAxNikg
JiAweGZmZjsKIApAQCAtMTUwNCw3ICsxNTA4LDcgQEAgdm9pZCBfX2luaXQgZWhjaV9kYmdwX2lu
aXQodm9pZCkKICAgICBlbHNlCiAgICAgICAgIHJldHVybjsKIAotICAgIGRlYnVnX3BvcnQgPSBw
Y2lfY29uZl9yZWFkMzIoMCwgZGJncC0+YnVzLCBkYmdwLT5zbG90LCBkYmdwLT5mdW5jLAorICAg
IGRlYnVnX3BvcnQgPSBwY2lfY29uZl9yZWFkMzIoUENJX1NCREYoMCwgZGJncC0+YnVzLCBkYmdw
LT5zbG90LCBkYmdwLT5mdW5jKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRi
Z3AtPmNhcCk7CiAgICAgZGJncC0+YmFyID0gKGRlYnVnX3BvcnQgPj4gMjkpICYgMHg3OwogICAg
IGRiZ3AtPmJhciA9ICgoZGJncC0+YmFyIC0gMSkgKiA0KSArIFBDSV9CQVNFX0FERFJFU1NfMDsK
QEAgLTE1MTYsOCArMTUyMCw4IEBAIHZvaWQgX19pbml0IGVoY2lfZGJncF9pbml0KHZvaWQpCiAg
ICAgICAgIHJldHVybjsKICAgICB9CiAKLSAgICBkYmdwLT5iYXJfdmFsID0gYmFyX3ZhbCA9IHBj
aV9jb25mX3JlYWQzMigwLCBkYmdwLT5idXMsIGRiZ3AtPnNsb3QsCi0gICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGJncC0+ZnVuYywgZGJncC0+YmFyKTsKKyAg
ICBkYmdwLT5iYXJfdmFsID0gYmFyX3ZhbCA9IHBjaV9jb25mX3JlYWQzMihQQ0lfU0JERigwLCBk
YmdwLT5idXMsIGRiZ3AtPnNsb3QsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgZGJncC0+ZnVuYyksIGRiZ3AtPmJhcik7CiAgICAgZGJncF9w
cmludGsoImJhcl92YWw6ICUwOHhcbiIsIGJhcl92YWwpOwogICAgIGlmICggYmFyX3ZhbCAmIH5Q
Q0lfQkFTRV9BRERSRVNTX01FTV9NQVNLICkKICAgICB7CmRpZmYgLS1naXQgYS94ZW4vZHJpdmVy
cy9jaGFyL25zMTY1NTAuYyBiL3hlbi9kcml2ZXJzL2NoYXIvbnMxNjU1MC5jCmluZGV4IDk5YzEy
NTRjYWMuLmZlNzE0MDZjYzEgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL2NoYXIvbnMxNjU1MC5j
CisrKyBiL3hlbi9kcml2ZXJzL2NoYXIvbnMxNjU1MC5jCkBAIC0xMTEyLDI3ICsxMTEyLDI4IEBA
IHBjaV91YXJ0X2NvbmZpZyhzdHJ1Y3QgbnMxNjU1MCAqdWFydCwgYm9vbF90IHNraXBfYW10LCB1
bnNpZ25lZCBpbnQgaWR4KQogICAgICAgICAgICAgICAgIH0KIAogICAgICAgICAgICAgICAgIHVh
cnQtPmlvX2Jhc2UgPSAwOwotICAgICAgICAgICAgICAgIGJhciA9IHBjaV9jb25mX3JlYWQzMigw
LCBiLCBkLCBmLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lfQkFT
RV9BRERSRVNTXzAgKyBiYXJfaWR4KjQpOworICAgICAgICAgICAgICAgIGJhciA9IHBjaV9jb25m
X3JlYWQzMihQQ0lfU0JERigwLCBiLCBkLCBmKSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgUENJX0JBU0VfQUREUkVTU18wICsgYmFyX2lkeCAqIDQpOwogCiAgICAgICAg
ICAgICAgICAgLyogTU1JTyBiYXNlZCAqLwogICAgICAgICAgICAgICAgIGlmICggcGFyYW0tPm1t
aW8gJiYgIShiYXIgJiBQQ0lfQkFTRV9BRERSRVNTX1NQQUNFX0lPKSApCiAgICAgICAgICAgICAg
ICAgewogICAgICAgICAgICAgICAgICAgICBwY2lfY29uZl93cml0ZTMyKDAsIGIsIGQsIGYsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX0JBU0VfQUREUkVTU18wICsg
YmFyX2lkeCo0LCB+MHUpOwotICAgICAgICAgICAgICAgICAgICBsZW4gPSBwY2lfY29uZl9yZWFk
MzIoMCwgYiwgZCwgZiwgUENJX0JBU0VfQUREUkVTU18wICsgYmFyX2lkeCo0KTsKKyAgICAgICAg
ICAgICAgICAgICAgbGVuID0gcGNpX2NvbmZfcmVhZDMyKFBDSV9TQkRGKDAsIGIsIGQsIGYpLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX0JBU0VfQUREUkVT
U18wICsgYmFyX2lkeCAqIDQpOwogICAgICAgICAgICAgICAgICAgICBwY2lfY29uZl93cml0ZTMy
KDAsIGIsIGQsIGYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX0JB
U0VfQUREUkVTU18wICsgYmFyX2lkeCo0LCBiYXIpOwogCiAgICAgICAgICAgICAgICAgICAgIC8q
IEhhbmRsZSA2NCBiaXQgQkFSIGlmIGZvdW5kICovCiAgICAgICAgICAgICAgICAgICAgIGlmICgg
YmFyICYgUENJX0JBU0VfQUREUkVTU19NRU1fVFlQRV82NCApCiAgICAgICAgICAgICAgICAgICAg
IHsKLSAgICAgICAgICAgICAgICAgICAgICAgIGJhcl82NCA9IHBjaV9jb25mX3JlYWQzMigwLCBi
LCBkLCBmLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lfQkFTRV9B
RERSRVNTXzAgKyAoYmFyX2lkeCsxKSo0KTsKKyAgICAgICAgICAgICAgICAgICAgICAgIGJhcl82
NCA9IHBjaV9jb25mX3JlYWQzMihQQ0lfU0JERigwLCBiLCBkLCBmKSwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgUENJX0JBU0VfQUREUkVTU18wICsgKGJhcl9pZHggKyAx
KSAqIDQpOwogICAgICAgICAgICAgICAgICAgICAgICAgcGNpX2NvbmZfd3JpdGUzMigwLCBiLCBk
LCBmLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX0JBU0VfQUREUkVT
U18wICsgKGJhcl9pZHgrMSkqNCwgfjB1KTsKLSAgICAgICAgICAgICAgICAgICAgICAgIGxlbl82
NCA9IHBjaV9jb25mX3JlYWQzMigwLCBiLCBkLCBmLAotICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgUENJX0JBU0VfQUREUkVTU18wICsgKGJhcl9pZHgrMSkqNCk7CisgICAgICAg
ICAgICAgICAgICAgICAgICBsZW5fNjQgPSBwY2lfY29uZl9yZWFkMzIoUENJX1NCREYoMCwgYiwg
ZCwgZiksCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lfQkFTRV9BRERS
RVNTXzAgKyAoYmFyX2lkeCArIDEpICogNCk7CiAgICAgICAgICAgICAgICAgICAgICAgICBwY2lf
Y29uZl93cml0ZTMyKDAsIGIsIGQsIGYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBQQ0lfQkFTRV9BRERSRVNTXzAgKyAoYmFyX2lkeCsxKSo0LCBiYXJfNjQpOwogICAgICAg
ICAgICAgICAgICAgICAgICAgc2l6ZSAgPSAoKHU2NCl+MCA8PCAzMikgfCBQQ0lfQkFTRV9BRERS
RVNTX01FTV9NQVNLOwpAQCAtMTE0OSw3ICsxMTUwLDggQEAgcGNpX3VhcnRfY29uZmlnKHN0cnVj
dCBuczE2NTUwICp1YXJ0LCBib29sX3Qgc2tpcF9hbXQsIHVuc2lnbmVkIGludCBpZHgpCiAgICAg
ICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICBwY2lfY29uZl93cml0ZTMyKDAsIGIs
IGQsIGYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX0JBU0VfQURE
UkVTU18wICsgYmFyX2lkeCo0LCB+MHUpOwotICAgICAgICAgICAgICAgICAgICBsZW4gPSBwY2lf
Y29uZl9yZWFkMzIoMCwgYiwgZCwgZiwgUENJX0JBU0VfQUREUkVTU18wKTsKKyAgICAgICAgICAg
ICAgICAgICAgbGVuID0gcGNpX2NvbmZfcmVhZDMyKFBDSV9TQkRGKDAsIGIsIGQsIGYpLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX0JBU0VfQUREUkVTU18w
KTsKICAgICAgICAgICAgICAgICAgICAgcGNpX2NvbmZfd3JpdGUzMigwLCBiLCBkLCBmLAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9CQVNFX0FERFJFU1NfMCArIGJh
cl9pZHgqNCwgYmFyKTsKICAgICAgICAgICAgICAgICAgICAgc2l6ZSA9IGxlbiAmIFBDSV9CQVNF
X0FERFJFU1NfSU9fTUFTSzsKZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2Ft
ZC9pb21tdV9kZXRlY3QuYyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9pb21tdV9kZXRl
Y3QuYwppbmRleCAyODI4MmU0N2FjLi5lYzg4MTFhZGFjIDEwMDY0NAotLS0gYS94ZW4vZHJpdmVy
cy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfZGV0ZWN0LmMKKysrIGIveGVuL2RyaXZlcnMvcGFzc3Ro
cm91Z2gvYW1kL2lvbW11X2RldGVjdC5jCkBAIC00OCw3ICs0OCw3IEBAIHN0YXRpYyBpbnQgX19p
bml0IGdldF9pb21tdV9jYXBhYmlsaXRpZXMoCiB7CiAgICAgdTggdHlwZTsKIAotICAgIGlvbW11
LT5jYXAuaGVhZGVyID0gcGNpX2NvbmZfcmVhZDMyKHNlZywgYnVzLCBkZXYsIGZ1bmMsIGNhcF9w
dHIpOworICAgIGlvbW11LT5jYXAuaGVhZGVyID0gcGNpX2NvbmZfcmVhZDMyKFBDSV9TQkRGKHNl
ZywgYnVzLCBkZXYsIGZ1bmMpLCBjYXBfcHRyKTsKICAgICB0eXBlID0gZ2V0X2ZpZWxkX2Zyb21f
cmVnX3UzMihpb21tdS0+Y2FwLmhlYWRlciwgUENJX0NBUF9UWVBFX01BU0ssCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgUENJX0NBUF9UWVBFX1NISUZUKTsKIApkaWZmIC0tZ2l0
IGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL2lvbW11X2luaXQuYyBiL3hlbi9kcml2ZXJz
L3Bhc3N0aHJvdWdoL2FtZC9pb21tdV9pbml0LmMKaW5kZXggNGM3ZTA2NWZlMC4uZjYwMjM4YTVi
OCAxMDA2NDQKLS0tIGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL2lvbW11X2luaXQuYwor
KysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfaW5pdC5jCkBAIC04NDUsNyAr
ODQ1LDcgQEAgc3RhdGljIHZvaWQgYW1kX2lvbW11X2VycmF0dW1fNzQ2X3dvcmthcm91bmQoc3Ry
dWN0IGFtZF9pb21tdSAqaW9tbXUpCiAgICAgICAgIHJldHVybjsKIAogICAgIHBjaV9jb25mX3dy
aXRlMzIoaW9tbXUtPnNlZywgYnVzLCBkZXYsIGZ1bmMsIDB4ZjAsIDB4OTApOwotICAgIHZhbHVl
ID0gcGNpX2NvbmZfcmVhZDMyKGlvbW11LT5zZWcsIGJ1cywgZGV2LCBmdW5jLCAweGY0KTsKKyAg
ICB2YWx1ZSA9IHBjaV9jb25mX3JlYWQzMihQQ0lfU0JERjIoaW9tbXUtPnNlZywgaW9tbXUtPmJk
ZiksIDB4ZjQpOwogCiAgICAgaWYgKCB2YWx1ZSAmICgxIDw8IDIpICkKICAgICAgICAgcmV0dXJu
OwpAQCAtMTIyOCw3ICsxMjI4LDcgQEAgc3RhdGljIGJvb2xfdCBfX2luaXQgYW1kX3NwNTEwMF9l
cnJhdHVtMjgodm9pZCkKIAogICAgIGZvciAoYnVzID0gMDsgYnVzIDwgMjU2OyBidXMrKykKICAg
ICB7Ci0gICAgICAgIGlkID0gcGNpX2NvbmZfcmVhZDMyKDAsIGJ1cywgMHgxNCwgMCwgUENJX1ZF
TkRPUl9JRCk7CisgICAgICAgIGlkID0gcGNpX2NvbmZfcmVhZDMyKFBDSV9TQkRGKDAsIGJ1cywg
MHgxNCwgMCksIFBDSV9WRU5ET1JfSUQpOwogCiAgICAgICAgIHZlbmRvcl9pZCA9IGlkICYgMHhm
ZmZmOwogICAgICAgICBkZXZfaWQgPSAoaWQgPj4gMTYpICYgMHhmZmZmOwpkaWZmIC0tZ2l0IGEv
eGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvcGNpLmMgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9w
Y2kuYwppbmRleCA2YmM1Yjk2ODJiLi43Zjk1NzNjZWVlIDEwMDY0NAotLS0gYS94ZW4vZHJpdmVy
cy9wYXNzdGhyb3VnaC9wY2kuYworKysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9wY2kuYwpA
QCAtNjMyLDggKzYzMiw3IEBAIHVuc2lnbmVkIGludCBwY2lfc2l6ZV9tZW1fYmFyKHBjaV9zYmRm
X3Qgc2JkZiwgdW5zaWduZWQgaW50IHBvcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHVpbnQ2NF90ICpwYWRkciwgdWludDY0X3QgKnBzaXplLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgdW5zaWduZWQgaW50IGZsYWdzKQogewotICAgIHVpbnQzMl90IGhpID0gMCwgYmFy
ID0gcGNpX2NvbmZfcmVhZDMyKHNiZGYuc2VnLCBzYmRmLmJ1cywgc2JkZi5kZXYsCi0gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2JkZi5mbiwgcG9zKTsKKyAgICB1
aW50MzJfdCBoaSA9IDAsIGJhciA9IHBjaV9jb25mX3JlYWQzMihzYmRmLCBwb3MpOwogICAgIHVp
bnQ2NF90IHNpemU7CiAgICAgYm9vbCBpczY0Yml0cyA9ICEoZmxhZ3MgJiBQQ0lfQkFSX1JPTSkg
JiYKICAgICAgICAgKGJhciAmIFBDSV9CQVNFX0FERFJFU1NfTUVNX1RZUEVfTUFTSykgPT0gUENJ
X0JBU0VfQUREUkVTU19NRU1fVFlQRV82NDsKQEAgLTY1NSwxNSArNjU0LDEzIEBAIHVuc2lnbmVk
IGludCBwY2lfc2l6ZV9tZW1fYmFyKHBjaV9zYmRmX3Qgc2JkZiwgdW5zaWduZWQgaW50IHBvcywK
ICAgICAgICAgICAgICpwc2l6ZSA9IDA7CiAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAg
fQotICAgICAgICBoaSA9IHBjaV9jb25mX3JlYWQzMihzYmRmLnNlZywgc2JkZi5idXMsIHNiZGYu
ZGV2LCBzYmRmLmZuLCBwb3MgKyA0KTsKKyAgICAgICAgaGkgPSBwY2lfY29uZl9yZWFkMzIoc2Jk
ZiwgcG9zICsgNCk7CiAgICAgICAgIHBjaV9jb25mX3dyaXRlMzIoc2JkZi5zZWcsIHNiZGYuYnVz
LCBzYmRmLmRldiwgc2JkZi5mbiwgcG9zICsgNCwgfjApOwogICAgIH0KLSAgICBzaXplID0gcGNp
X2NvbmZfcmVhZDMyKHNiZGYuc2VnLCBzYmRmLmJ1cywgc2JkZi5kZXYsIHNiZGYuZm4sCi0gICAg
ICAgICAgICAgICAgICAgICAgICAgICBwb3MpICYgbWFzazsKKyAgICBzaXplID0gcGNpX2NvbmZf
cmVhZDMyKHNiZGYsIHBvcykgJiBtYXNrOwogICAgIGlmICggaXM2NGJpdHMgKQogICAgIHsKLSAg
ICAgICAgc2l6ZSB8PSAodWludDY0X3QpcGNpX2NvbmZfcmVhZDMyKHNiZGYuc2VnLCBzYmRmLmJ1
cywgc2JkZi5kZXYsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBz
YmRmLmZuLCBwb3MgKyA0KSA8PCAzMjsKKyAgICAgICAgc2l6ZSB8PSAodWludDY0X3QpcGNpX2Nv
bmZfcmVhZDMyKHNiZGYsIHBvcyArIDQpIDw8IDMyOwogICAgICAgICBwY2lfY29uZl93cml0ZTMy
KHNiZGYuc2VnLCBzYmRmLmJ1cywgc2JkZi5kZXYsIHNiZGYuZm4sIHBvcyArIDQsIGhpKTsKICAg
ICB9CiAgICAgZWxzZSBpZiAoIHNpemUgKQpAQCAtNzUwLDcgKzc0Nyw3IEBAIGludCBwY2lfYWRk
X2RldmljZSh1MTYgc2VnLCB1OCBidXMsIHU4IGRldmZuLAogICAgICAgICAgICAgZm9yICggaSA9
IDA7IGkgPCBQQ0lfU1JJT1ZfTlVNX0JBUlM7ICkKICAgICAgICAgICAgIHsKICAgICAgICAgICAg
ICAgICB1bnNpZ25lZCBpbnQgaWR4ID0gcG9zICsgUENJX1NSSU9WX0JBUiArIGkgKiA0OwotICAg
ICAgICAgICAgICAgIHUzMiBiYXIgPSBwY2lfY29uZl9yZWFkMzIoc2VnLCBidXMsIHNsb3QsIGZ1
bmMsIGlkeCk7CisgICAgICAgICAgICAgICAgdWludDMyX3QgYmFyID0gcGNpX2NvbmZfcmVhZDMy
KHBkZXYtPnNiZGYsIGlkeCk7CiAgICAgICAgICAgICAgICAgcGNpX3NiZGZfdCBzYmRmID0gUENJ
X1NCREYzKHNlZywgYnVzLCBkZXZmbik7CiAKICAgICAgICAgICAgICAgICBpZiAoIChiYXIgJiBQ
Q0lfQkFTRV9BRERSRVNTX1NQQUNFKSA9PQpAQCAtMTAwMiw3ICs5OTksNyBAQCBib29sX3QgX19p
bml0IHBjaV9kZXZpY2VfZGV0ZWN0KHUxNiBzZWcsIHU4IGJ1cywgdTggZGV2LCB1OCBmdW5jKQog
ewogICAgIHUzMiB2ZW5kb3I7CiAKLSAgICB2ZW5kb3IgPSBwY2lfY29uZl9yZWFkMzIoc2VnLCBi
dXMsIGRldiwgZnVuYywgUENJX1ZFTkRPUl9JRCk7CisgICAgdmVuZG9yID0gcGNpX2NvbmZfcmVh
ZDMyKFBDSV9TQkRGKHNlZywgYnVzLCBkZXYsIGZ1bmMpLCBQQ0lfVkVORE9SX0lEKTsKICAgICAv
KiBzb21lIGJyb2tlbiBib2FyZHMgcmV0dXJuIDAgb3IgfjAgaWYgYSBzbG90IGlzIGVtcHR5OiAq
LwogICAgIGlmICggKHZlbmRvciA9PSAweGZmZmZmZmZmKSB8fCAodmVuZG9yID09IDB4MDAwMDAw
MDApIHx8CiAgICAgICAgICAodmVuZG9yID09IDB4MDAwMGZmZmYpIHx8ICh2ZW5kb3IgPT0gMHhm
ZmZmMDAwMCkgKQpkaWZmIC0tZ2l0IGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvdnRkL3F1aXJr
cy5jIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvdnRkL3F1aXJrcy5jCmluZGV4IDQ3NTk3Yzk2
MDAuLjQwYmMyNWQ1NDQgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9x
dWlya3MuYworKysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC92dGQvcXVpcmtzLmMKQEAgLTM3
LDggKzM3LDggQEAKICNpbmNsdWRlICJleHRlcm4uaCIKICNpbmNsdWRlICJ2dGQuaCIKIAotI2Rl
ZmluZSBJT0hfREVWICAgICAgMAotI2RlZmluZSBJR0RfREVWICAgICAgMgorI2RlZmluZSBJT0hf
REVWICAgICAgUENJX1NCREYoMCwgMCwgMCwgMCkKKyNkZWZpbmUgSUdEX0RFViAgICAgIFBDSV9T
QkRGKDAsIDAsIDIsIDApCiAKICNkZWZpbmUgSUdEX0JBUl9NQVNLIDB4RkZGRkZGRkZGRkZGMDAw
MAogI2RlZmluZSBHR0MgMHg1MgpAQCAtNzQsNyArNzQsNyBAQCBpbnQgaXNfaWdkX3Z0X2VuYWJs
ZWRfcXVpcmsodm9pZCkKICAgICAgICAgcmV0dXJuIDE7CiAKICAgICAvKiBpbnRlZ3JhdGVkIGdy
YXBoaWNzIG9uIEludGVsIHBsYXRmb3JtcyBpcyBsb2NhdGVkIGF0IDA6Mi4wICovCi0gICAgZ2dj
ID0gcGNpX2NvbmZfcmVhZDE2KFBDSV9TQkRGKDAsIDAsIElHRF9ERVYsIDApLCBHR0MpOworICAg
IGdnYyA9IHBjaV9jb25mX3JlYWQxNihJR0RfREVWLCBHR0MpOwogICAgIHJldHVybiAoIGdnYyAm
IEdHQ19NRU1PUllfVlRfRU5BQkxFRCA/IDEgOiAwICk7CiB9CiAKQEAgLTg4LDEyICs4OCwxMiBA
QCBzdGF0aWMgdm9pZCBfX2luaXQgY2FudGlnYV9iM19lcnJhdGFfaW5pdCh2b2lkKQogICAgIHUx
NiB2aWQ7CiAgICAgdTggZGlkX2hpLCByaWQ7CiAKLSAgICB2aWQgPSBwY2lfY29uZl9yZWFkMTYo
UENJX1NCREYoMCwgMCwgSUdEX0RFViwgMCksIDApOworICAgIHZpZCA9IHBjaV9jb25mX3JlYWQx
NihJR0RfREVWLCAwKTsKICAgICBpZiAoIHZpZCAhPSAweDgwODYgKQogICAgICAgICByZXR1cm47
CiAKLSAgICBkaWRfaGkgPSBwY2lfY29uZl9yZWFkOChQQ0lfU0JERigwLCAwLCBJR0RfREVWLCAw
KSwgMyk7Ci0gICAgcmlkID0gcGNpX2NvbmZfcmVhZDgoUENJX1NCREYoMCwgMCwgSUdEX0RFViwg
MCksIDgpOworICAgIGRpZF9oaSA9IHBjaV9jb25mX3JlYWQ4KElHRF9ERVYsIDMpOworICAgIHJp
ZCA9IHBjaV9jb25mX3JlYWQ4KElHRF9ERVYsIDgpOwogCiAgICAgaWYgKCAoZGlkX2hpID09IDB4
MkEpICYmIChyaWQgPT0gMHg3KSApCiAgICAgICAgIGlzX2NhbnRpZ2FfYjMgPSAxOwpAQCAtMTI4
LDkgKzEyOCw5IEBAIHN0YXRpYyB2b2lkIF9faW5pdCBtYXBfaWdkX3JlZyh2b2lkKQogICAgIGlm
ICggaWdkX3JlZ192YSApCiAgICAgICAgIHJldHVybjsKIAotICAgIGlnZF9tbWlvICAgPSBwY2lf
Y29uZl9yZWFkMzIoMCwgMCwgSUdEX0RFViwgMCwgUENJX0JBU0VfQUREUkVTU18xKTsKKyAgICBp
Z2RfbW1pbyAgID0gcGNpX2NvbmZfcmVhZDMyKElHRF9ERVYsIFBDSV9CQVNFX0FERFJFU1NfMSk7
CiAgICAgaWdkX21taW8gPDw9IDMyOwotICAgIGlnZF9tbWlvICArPSBwY2lfY29uZl9yZWFkMzIo
MCwgMCwgSUdEX0RFViwgMCwgUENJX0JBU0VfQUREUkVTU18wKTsKKyAgICBpZ2RfbW1pbyAgKz0g
cGNpX2NvbmZfcmVhZDMyKElHRF9ERVYsICBQQ0lfQkFTRV9BRERSRVNTXzApOwogICAgIGlnZF9y
ZWdfdmEgPSBpb3JlbWFwKGlnZF9tbWlvICYgSUdEX0JBUl9NQVNLLCAweDMwMDApOwogfQogCkBA
IC0yODAsNyArMjgwLDcgQEAgc3RhdGljIHZvaWQgX19pbml0IHR5bGVyc2J1cmdfaW50cmVtYXBf
cXVpcmsodm9pZCkKICAgICBmb3IgKCBidXMgPSAwOyBidXMgPCAweDEwMDsgYnVzKysgKQogICAg
IHsKICAgICAgICAgLyogTWF0Y2ggb24gU3lzdGVtIE1hbmFnZW1lbnQgUmVnaXN0ZXJzIG9uIERl
dmljZSAyMCBGdW5jdGlvbiAwICovCi0gICAgICAgIGRldmljZSA9IHBjaV9jb25mX3JlYWQzMigw
LCBidXMsIDIwLCAwLCBQQ0lfVkVORE9SX0lEKTsKKyAgICAgICAgZGV2aWNlID0gcGNpX2NvbmZf
cmVhZDMyKFBDSV9TQkRGKDAsIGJ1cywgMjAsIDApLCBQQ0lfVkVORE9SX0lEKTsKICAgICAgICAg
cmV2ID0gcGNpX2NvbmZfcmVhZDgoUENJX1NCREYoMCwgYnVzLCAyMCwgMCksIFBDSV9SRVZJU0lP
Tl9JRCk7CiAKICAgICAgICAgaWYgKCByZXYgPT0gMHgxMyAmJiBkZXZpY2UgPT0gMHgzNDJlODA4
NiApCkBAIC0yOTYsOCArMjk2LDggQEAgc3RhdGljIHZvaWQgX19pbml0IHR5bGVyc2J1cmdfaW50
cmVtYXBfcXVpcmsodm9pZCkKIC8qIGluaXRpYWxpemUgcGxhdGZvcm0gaWRlbnRpZmljYXRpb24g
ZmxhZ3MgKi8KIHZvaWQgX19pbml0IHBsYXRmb3JtX3F1aXJrc19pbml0KHZvaWQpCiB7Ci0gICAg
aW9oX2lkID0gcGNpX2NvbmZfcmVhZDMyKDAsIDAsIElPSF9ERVYsIDAsIDApOwotICAgIGlnZF9p
ZCA9IHBjaV9jb25mX3JlYWQzMigwLCAwLCBJR0RfREVWLCAwLCAwKTsKKyAgICBpb2hfaWQgPSBw
Y2lfY29uZl9yZWFkMzIoSU9IX0RFViwgMCk7CisgICAgaWdkX2lkID0gcGNpX2NvbmZfcmVhZDMy
KElHRF9ERVYsIDApOwogCiAgICAgLyogTW9iaWxlIDQgU2VyaWVzIENoaXBzZXQgbmVnbGVjdHMg
dG8gc2V0IFJXQkYgY2FwYWJpbGl0eS4gKi8KICAgICBpZiAoIGlvaF9pZCA9PSAweDJhNDA4MDg2
ICkKQEAgLTM1NiwxNSArMzU2LDE1IEBAIGludCBtZV93aWZpX3F1aXJrKHN0cnVjdCBkb21haW4g
KmRvbWFpbiwgdTggYnVzLCB1OCBkZXZmbiwgaW50IG1hcCkKICAgICB1MzIgaWQ7CiAgICAgaW50
IHJjID0gMDsKIAotICAgIGlkID0gcGNpX2NvbmZfcmVhZDMyKDAsIDAsIDAsIDAsIDApOworICAg
IGlkID0gcGNpX2NvbmZfcmVhZDMyKFBDSV9TQkRGKDAsIDAsIDAsIDApLCAwKTsKICAgICBpZiAo
IElTX0NURyhpZCkgKQogICAgIHsKICAgICAgICAgLyogcXVpdCBpZiBNRSBkb2VzIG5vdCBleGlz
dCAqLwotICAgICAgICBpZiAoIHBjaV9jb25mX3JlYWQzMigwLCAwLCAzLCAwLCAwKSA9PSAweGZm
ZmZmZmZmICkKKyAgICAgICAgaWYgKCBwY2lfY29uZl9yZWFkMzIoUENJX1NCREYoMCwgMCwgMywg
MCksIDApID09IDB4ZmZmZmZmZmYgKQogICAgICAgICAgICAgcmV0dXJuIDA7CiAKICAgICAgICAg
LyogaWYgZGV2aWNlIGlzIFdMQU4gZGV2aWNlLCBtYXAgTUUgcGhhbnRvbSBkZXZpY2UgMDozLjcg
Ki8KLSAgICAgICAgaWQgPSBwY2lfY29uZl9yZWFkMzIoMCwgYnVzLCBQQ0lfU0xPVChkZXZmbiks
IFBDSV9GVU5DKGRldmZuKSwgMCk7CisgICAgICAgIGlkID0gcGNpX2NvbmZfcmVhZDMyKFBDSV9T
QkRGMygwLCBidXMsIGRldmZuKSwgMCk7CiAgICAgICAgIHN3aXRjaCAoaWQpCiAgICAgICAgIHsK
ICAgICAgICAgICAgIGNhc2UgMHg0MjMyODA4NjoKQEAgLTM4NCwxMSArMzg0LDExIEBAIGludCBt
ZV93aWZpX3F1aXJrKHN0cnVjdCBkb21haW4gKmRvbWFpbiwgdTggYnVzLCB1OCBkZXZmbiwgaW50
IG1hcCkKICAgICBlbHNlIGlmICggSVNfSUxLKGlkKSB8fCBJU19DUFQoaWQpICkKICAgICB7CiAg
ICAgICAgIC8qIHF1aXQgaWYgTUUgZG9lcyBub3QgZXhpc3QgKi8KLSAgICAgICAgaWYgKCBwY2lf
Y29uZl9yZWFkMzIoMCwgMCwgMjIsIDAsIDApID09IDB4ZmZmZmZmZmYgKQorICAgICAgICBpZiAo
IHBjaV9jb25mX3JlYWQzMihQQ0lfU0JERigwLCAwLCAyMiwgMCksIDApID09IDB4ZmZmZmZmZmYg
KQogICAgICAgICAgICAgcmV0dXJuIDA7CiAKICAgICAgICAgLyogaWYgZGV2aWNlIGlzIFdMQU4g
ZGV2aWNlLCBtYXAgTUUgcGhhbnRvbSBkZXZpY2UgMDoyMi43ICovCi0gICAgICAgIGlkID0gcGNp
X2NvbmZfcmVhZDMyKDAsIGJ1cywgUENJX1NMT1QoZGV2Zm4pLCBQQ0lfRlVOQyhkZXZmbiksIDAp
OworICAgICAgICBpZCA9IHBjaV9jb25mX3JlYWQzMihQQ0lfU0JERjMoMCwgYnVzLCBkZXZmbiks
IDApOwogICAgICAgICBzd2l0Y2ggKGlkKQogICAgICAgICB7CiAgICAgICAgICAgICBjYXNlIDB4
MDA4NzgwODY6ICAgICAgICAvKiBLaWxtZXIgUGVhayAqLwpAQCAtNDM4LDcgKzQzOCw3IEBAIHZv
aWQgcGNpX3Z0ZF9xdWlyayhjb25zdCBzdHJ1Y3QgcGNpX2RldiAqcGRldikKICAgICBjYXNlIDB4
MzQyZTogLyogVHlsZXJzYnVyZyBjaGlwc2V0IChOZWhhbGVtIC8gV2VzdG1lcmUgc3lzdGVtcykg
Ki8KICAgICBjYXNlIDB4MzcyODogLyogWGVvbiBDNTUwMC9DMzUwMCAoSmFzcGVyRm9yZXN0KSAq
LwogICAgIGNhc2UgMHgzYzI4OiAvKiBTYW5keWJyaWRnZSAqLwotICAgICAgICB2YWwgPSBwY2lf
Y29uZl9yZWFkMzIoc2VnLCBidXMsIGRldiwgZnVuYywgMHgxQUMpOworICAgICAgICB2YWwgPSBw
Y2lfY29uZl9yZWFkMzIocGRldi0+c2JkZiwgMHgxQUMpOwogICAgICAgICBwY2lfY29uZl93cml0
ZTMyKHNlZywgYnVzLCBkZXYsIGZ1bmMsIDB4MUFDLCB2YWwgfCAoMSA8PCAzMSkpOwogICAgICAg
ICBwcmludGsoWEVOTE9HX0lORk8gIk1hc2tlZCBWVC1kIGVycm9yIHNpZ25hbGluZyBvbiAlMDR4
OiUwMng6JTAyeC4ldVxuIiwKICAgICAgICAgICAgICAgIHNlZywgYnVzLCBkZXYsIGZ1bmMpOwpA
QCAtNDYxLDcgKzQ2MSw3IEBAIHZvaWQgcGNpX3Z0ZF9xdWlyayhjb25zdCBzdHJ1Y3QgcGNpX2Rl
diAqcGRldikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9F
WFRfQ0FQX0lEX1ZORFIpOwogICAgICAgICAgICAgd2hpbGUgKCBwb3MgKQogICAgICAgICAgICAg
ewotICAgICAgICAgICAgICAgIHZhbCA9IHBjaV9jb25mX3JlYWQzMihzZWcsIGJ1cywgZGV2LCBm
dW5jLCBwb3MgKyBQQ0lfVk5EUl9IRUFERVIpOworICAgICAgICAgICAgICAgIHZhbCA9IHBjaV9j
b25mX3JlYWQzMihwZGV2LT5zYmRmLCBwb3MgKyBQQ0lfVk5EUl9IRUFERVIpOwogICAgICAgICAg
ICAgICAgIGlmICggUENJX1ZORFJfSEVBREVSX0lEKHZhbCkgPT0gNCAmJiBQQ0lfVk5EUl9IRUFE
RVJfUkVWKHZhbCkgPT0gMSApCiAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAg
ICBwb3MgKz0gUENJX1ZORFJfSEVBREVSOwpAQCAtNDgxLDggKzQ4MSw4IEBAIHZvaWQgcGNpX3Z0
ZF9xdWlyayhjb25zdCBzdHJ1Y3QgcGNpX2RldiAqcGRldikKICAgICAgICAgICAgIGJyZWFrOwog
ICAgICAgICB9CiAKLSAgICAgICAgdmFsID0gcGNpX2NvbmZfcmVhZDMyKHNlZywgYnVzLCBkZXYs
IGZ1bmMsIHBvcyArIFBDSV9FUlJfVU5DT1JfTUFTSyk7Ci0gICAgICAgIHZhbDIgPSBwY2lfY29u
Zl9yZWFkMzIoc2VnLCBidXMsIGRldiwgZnVuYywgcG9zICsgUENJX0VSUl9DT1JfTUFTSyk7Cisg
ICAgICAgIHZhbCA9IHBjaV9jb25mX3JlYWQzMihwZGV2LT5zYmRmLCBwb3MgKyBQQ0lfRVJSX1VO
Q09SX01BU0spOworICAgICAgICB2YWwyID0gcGNpX2NvbmZfcmVhZDMyKHBkZXYtPnNiZGYsIHBv
cyArIFBDSV9FUlJfQ09SX01BU0spOwogICAgICAgICBpZiAoICh2YWwgJiBQQ0lfRVJSX1VOQ19V
TlNVUCkgJiYgKHZhbDIgJiBQQ0lfRVJSX0NPUl9BRFZfTkZBVCkgKQogICAgICAgICAgICAgYWN0
aW9uID0gIkZvdW5kIG1hc2tlZCI7CiAgICAgICAgIGVsc2UgaWYgKCAhZmYgKQpAQCAtNDk3LDcg
KzQ5Nyw3IEBAIHZvaWQgcGNpX3Z0ZF9xdWlyayhjb25zdCBzdHJ1Y3QgcGNpX2RldiAqcGRldikK
ICAgICAgICAgICAgIGFjdGlvbiA9ICJNdXN0IG5vdCBtYXNrIjsKIAogICAgICAgICAvKiBYUFVO
Q0VSUk1TSyBTZW5kIENvbXBsZXRpb24gd2l0aCBVbnN1cHBvcnRlZCBSZXF1ZXN0ICovCi0gICAg
ICAgIHZhbCA9IHBjaV9jb25mX3JlYWQzMihzZWcsIGJ1cywgZGV2LCBmdW5jLCAweDIwYyk7Cisg
ICAgICAgIHZhbCA9IHBjaV9jb25mX3JlYWQzMihwZGV2LT5zYmRmLCAweDIwYyk7CiAgICAgICAg
IHBjaV9jb25mX3dyaXRlMzIoc2VnLCBidXMsIGRldiwgZnVuYywgMHgyMGMsIHZhbCB8ICgxIDw8
IDQpKTsKIAogICAgICAgICBwcmludGsoWEVOTE9HX0lORk8gIiVzIFVSIHNpZ25hbGluZyBvbiAl
MDR4OiUwMng6JTAyeC4ldVxuIiwKQEAgLTUxNCw4ICs1MTQsOCBAQCB2b2lkIHBjaV92dGRfcXVp
cmsoY29uc3Qgc3RydWN0IHBjaV9kZXYgKnBkZXYpCiAgICAgY2FzZSAweDE2MTA6IGNhc2UgMHgx
NjE0OiBjYXNlIDB4MTYxODogLyogQnJvYWR3ZWxsICovCiAgICAgY2FzZSAweDE5MDA6IGNhc2Ug
MHgxOTA0OiBjYXNlIDB4MTkwODogY2FzZSAweDE5MGM6IGNhc2UgMHgxOTBmOiAvKiBTa3lsYWtl
ICovCiAgICAgY2FzZSAweDE5MTA6IGNhc2UgMHgxOTE4OiBjYXNlIDB4MTkxZjogLyogU2t5bGFr
ZSAqLwotICAgICAgICBiYXIgPSBwY2lfY29uZl9yZWFkMzIoc2VnLCBidXMsIGRldiwgZnVuYywg
MHg2Yyk7Ci0gICAgICAgIGJhciA9IChiYXIgPDwgMzIpIHwgcGNpX2NvbmZfcmVhZDMyKHNlZywg
YnVzLCBkZXYsIGZ1bmMsIDB4NjgpOworICAgICAgICBiYXIgPSBwY2lfY29uZl9yZWFkMzIocGRl
di0+c2JkZiwgMHg2Yyk7CisgICAgICAgIGJhciA9IChiYXIgPDwgMzIpIHwgcGNpX2NvbmZfcmVh
ZDMyKHBkZXYtPnNiZGYsIDB4NjgpOwogICAgICAgICBwYSA9IGJhciAmIDB4N2ZmZmZmZjAwMFVM
OyAvKiBiaXRzIDEyLi4uMzggKi8KICAgICAgICAgaWYgKCAoYmFyICYgMSkgJiYgcGEgJiYKICAg
ICAgICAgICAgICBwYWdlX2lzX3JhbV90eXBlKHBhZGRyX3RvX3BmbihwYSksIFJBTV9UWVBFX1JF
U0VSVkVEKSApCmRpZmYgLS1naXQgYS94ZW4vZHJpdmVycy9wY2kvcGNpLmMgYi94ZW4vZHJpdmVy
cy9wY2kvcGNpLmMKaW5kZXggNWU1ZTBmMDUzOC4uYjI0NzAyZTBjMyAxMDA2NDQKLS0tIGEveGVu
L2RyaXZlcnMvcGNpL3BjaS5jCisrKyBiL3hlbi9kcml2ZXJzL3BjaS9wY2kuYwpAQCAtOTMsNyAr
OTMsNyBAQCBpbnQgcGNpX2ZpbmRfbmV4dF9leHRfY2FwYWJpbGl0eShpbnQgc2VnLCBpbnQgYnVz
LCBpbnQgZGV2Zm4sIGludCBzdGFydCwgaW50IGNhcAogICAgIGludCB0dGwgPSA0ODA7IC8qIDM4
NDAgYnl0ZXMsIG1pbmltdW0gOCBieXRlcyBwZXIgY2FwYWJpbGl0eSAqLwogICAgIGludCBwb3Mg
PSBtYXgoc3RhcnQsIDB4MTAwKTsKIAotICAgIGhlYWRlciA9IHBjaV9jb25mX3JlYWQzMihzZWcs
IGJ1cywgUENJX1NMT1QoZGV2Zm4pLCBQQ0lfRlVOQyhkZXZmbiksIHBvcyk7CisgICAgaGVhZGVy
ID0gcGNpX2NvbmZfcmVhZDMyKFBDSV9TQkRGMyhzZWcsIGJ1cywgZGV2Zm4pLCBwb3MpOwogCiAg
ICAgLyoKICAgICAgKiBJZiB3ZSBoYXZlIG5vIGNhcGFiaWxpdGllcywgdGhpcyBpcyBpbmRpY2F0
ZWQgYnkgY2FwIElELApAQCAtMTA5LDcgKzEwOSw3IEBAIGludCBwY2lfZmluZF9uZXh0X2V4dF9j
YXBhYmlsaXR5KGludCBzZWcsIGludCBidXMsIGludCBkZXZmbiwgaW50IHN0YXJ0LCBpbnQgY2Fw
CiAgICAgICAgIHBvcyA9IFBDSV9FWFRfQ0FQX05FWFQoaGVhZGVyKTsKICAgICAgICAgaWYgKCBw
b3MgPCAweDEwMCApCiAgICAgICAgICAgICBicmVhazsKLSAgICAgICAgaGVhZGVyID0gcGNpX2Nv
bmZfcmVhZDMyKHNlZywgYnVzLCBQQ0lfU0xPVChkZXZmbiksIFBDSV9GVU5DKGRldmZuKSwgcG9z
KTsKKyAgICAgICAgaGVhZGVyID0gcGNpX2NvbmZfcmVhZDMyKFBDSV9TQkRGMyhzZWcsIGJ1cywg
ZGV2Zm4pLCBwb3MpOwogICAgIH0KICAgICByZXR1cm4gMDsKIH0KZGlmZiAtLWdpdCBhL3hlbi9k
cml2ZXJzL3ZwY2kvaGVhZGVyLmMgYi94ZW4vZHJpdmVycy92cGNpL2hlYWRlci5jCmluZGV4IDBi
MTc2YjQ5MGEuLjc0NzY2MzQ5ODIgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL3ZwY2kvaGVhZGVy
LmMKKysrIGIveGVuL2RyaXZlcnMvdnBjaS9oZWFkZXIuYwpAQCAtNTExLDcgKzUxMSw3IEBAIHN0
YXRpYyBpbnQgaW5pdF9iYXJzKHN0cnVjdCBwY2lfZGV2ICpwZGV2KQogICAgICAgICAgICAgY29u
dGludWU7CiAgICAgICAgIH0KIAotICAgICAgICB2YWwgPSBwY2lfY29uZl9yZWFkMzIocGRldi0+
c2VnLCBwZGV2LT5idXMsIHNsb3QsIGZ1bmMsIHJlZyk7CisgICAgICAgIHZhbCA9IHBjaV9jb25m
X3JlYWQzMihwZGV2LT5zYmRmLCByZWcpOwogICAgICAgICBpZiAoICh2YWwgJiBQQ0lfQkFTRV9B
RERSRVNTX1NQQUNFKSA9PSBQQ0lfQkFTRV9BRERSRVNTX1NQQUNFX0lPICkKICAgICAgICAgewog
ICAgICAgICAgICAgYmFyc1tpXS50eXBlID0gVlBDSV9CQVJfSU87CkBAIC01NjEsOCArNTYxLDgg
QEAgc3RhdGljIGludCBpbml0X2JhcnMoc3RydWN0IHBjaV9kZXYgKnBkZXYpCiAgICAgICAgIHJv
bS0+dHlwZSA9IFZQQ0lfQkFSX1JPTTsKICAgICAgICAgcm9tLT5zaXplID0gc2l6ZTsKICAgICAg
ICAgcm9tLT5hZGRyID0gYWRkcjsKLSAgICAgICAgaGVhZGVyLT5yb21fZW5hYmxlZCA9IHBjaV9j
b25mX3JlYWQzMihwZGV2LT5zZWcsIHBkZXYtPmJ1cywgc2xvdCwgZnVuYywKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb21fcmVnKSAmIFBDSV9ST01fQURE
UkVTU19FTkFCTEU7CisgICAgICAgIGhlYWRlci0+cm9tX2VuYWJsZWQgPSBwY2lfY29uZl9yZWFk
MzIocGRldi0+c2JkZiwgcm9tX3JlZykgJgorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
UENJX1JPTV9BRERSRVNTX0VOQUJMRTsKIAogICAgICAgICByYyA9IHZwY2lfYWRkX3JlZ2lzdGVy
KHBkZXYtPnZwY2ksIHZwY2lfaHdfcmVhZDMyLCByb21fd3JpdGUsIHJvbV9yZWcsCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgNCwgcm9tKTsKZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJz
L3ZwY2kvbXNpeC5jIGIveGVuL2RyaXZlcnMvdnBjaS9tc2l4LmMKaW5kZXggOGU2Y2QwNzBkMC4u
YzYwY2JhMDEzNyAxMDA2NDQKLS0tIGEveGVuL2RyaXZlcnMvdnBjaS9tc2l4LmMKKysrIGIveGVu
L2RyaXZlcnMvdnBjaS9tc2l4LmMKQEAgLTQ2OSwxMSArNDY5LDkgQEAgc3RhdGljIGludCBpbml0
X21zaXgoc3RydWN0IHBjaV9kZXYgKnBkZXYpCiAgICAgcGRldi0+dnBjaS0+bXNpeC0+cGRldiA9
IHBkZXY7CiAKICAgICBwZGV2LT52cGNpLT5tc2l4LT50YWJsZXNbVlBDSV9NU0lYX1RBQkxFXSA9
Ci0gICAgICAgIHBjaV9jb25mX3JlYWQzMihwZGV2LT5zZWcsIHBkZXYtPmJ1cywgc2xvdCwgZnVu
YywKLSAgICAgICAgICAgICAgICAgICAgICAgIG1zaXhfdGFibGVfb2Zmc2V0X3JlZyhtc2l4X29m
ZnNldCkpOworICAgICAgICBwY2lfY29uZl9yZWFkMzIocGRldi0+c2JkZiwgbXNpeF90YWJsZV9v
ZmZzZXRfcmVnKG1zaXhfb2Zmc2V0KSk7CiAgICAgcGRldi0+dnBjaS0+bXNpeC0+dGFibGVzW1ZQ
Q0lfTVNJWF9QQkFdID0KLSAgICAgICAgcGNpX2NvbmZfcmVhZDMyKHBkZXYtPnNlZywgcGRldi0+
YnVzLCBzbG90LCBmdW5jLAotICAgICAgICAgICAgICAgICAgICAgICAgbXNpeF9wYmFfb2Zmc2V0
X3JlZyhtc2l4X29mZnNldCkpOworICAgICAgICBwY2lfY29uZl9yZWFkMzIocGRldi0+c2JkZiwg
bXNpeF9wYmFfb2Zmc2V0X3JlZyhtc2l4X29mZnNldCkpOwogCiAgICAgZm9yICggaSA9IDA7IGkg
PCBwZGV2LT52cGNpLT5tc2l4LT5tYXhfZW50cmllczsgaSsrKQogICAgIHsKZGlmZiAtLWdpdCBh
L3hlbi9kcml2ZXJzL3ZwY2kvdnBjaS5jIGIveGVuL2RyaXZlcnMvdnBjaS92cGNpLmMKaW5kZXgg
MWE0YzJlZTRmMS4uMjEwNjI1NTg2MyAxMDA2NDQKLS0tIGEveGVuL2RyaXZlcnMvdnBjaS92cGNp
LmMKKysrIGIveGVuL2RyaXZlcnMvdnBjaS92cGNpLmMKQEAgLTEyMCw4ICsxMjAsNyBAQCB1aW50
MzJfdCB2cGNpX2h3X3JlYWQxNihjb25zdCBzdHJ1Y3QgcGNpX2RldiAqcGRldiwgdW5zaWduZWQg
aW50IHJlZywKIHVpbnQzMl90IHZwY2lfaHdfcmVhZDMyKGNvbnN0IHN0cnVjdCBwY2lfZGV2ICpw
ZGV2LCB1bnNpZ25lZCBpbnQgcmVnLAogICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqZGF0
YSkKIHsKLSAgICByZXR1cm4gcGNpX2NvbmZfcmVhZDMyKHBkZXYtPnNlZywgcGRldi0+YnVzLCBQ
Q0lfU0xPVChwZGV2LT5kZXZmbiksCi0gICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lfRlVO
QyhwZGV2LT5kZXZmbiksIHJlZyk7CisgICAgcmV0dXJuIHBjaV9jb25mX3JlYWQzMihwZGV2LT5z
YmRmLCByZWcpOwogfQogCiBpbnQgdnBjaV9hZGRfcmVnaXN0ZXIoc3RydWN0IHZwY2kgKnZwY2ks
IHZwY2lfcmVhZF90ICpyZWFkX2hhbmRsZXIsCkBAIC0yMTEsNyArMjEwLDcgQEAgc3RhdGljIHVp
bnQzMl90IHZwY2lfcmVhZF9odyhwY2lfc2JkZl90IHNiZGYsIHVuc2lnbmVkIGludCByZWcsCiAg
ICAgc3dpdGNoICggc2l6ZSApCiAgICAgewogICAgIGNhc2UgNDoKLSAgICAgICAgZGF0YSA9IHBj
aV9jb25mX3JlYWQzMihzYmRmLnNlZywgc2JkZi5idXMsIHNiZGYuZGV2LCBzYmRmLmZuLCByZWcp
OworICAgICAgICBkYXRhID0gcGNpX2NvbmZfcmVhZDMyKHNiZGYsIHJlZyk7CiAgICAgICAgIGJy
ZWFrOwogCiAgICAgY2FzZSAzOgpkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUveGVuL3BjaS5oIGIv
eGVuL2luY2x1ZGUveGVuL3BjaS5oCmluZGV4IDI4NDdhOGU2YWYuLjY4ODU0MDg2ODcgMTAwNjQ0
Ci0tLSBhL3hlbi9pbmNsdWRlL3hlbi9wY2kuaAorKysgYi94ZW4vaW5jbHVkZS94ZW4vcGNpLmgK
QEAgLTE3NCw5ICsxNzQsNyBAQCB2b2lkIHBjaV9jaGVja19kaXNhYmxlX2RldmljZSh1MTYgc2Vn
LCB1OCBidXMsIHU4IGRldmZuKTsKIAogdWludDhfdCBwY2lfY29uZl9yZWFkOChwY2lfc2JkZl90
IHNiZGYsIHVuc2lnbmVkIGludCByZWcpOwogdWludDE2X3QgcGNpX2NvbmZfcmVhZDE2KHBjaV9z
YmRmX3Qgc2JkZiwgdW5zaWduZWQgaW50IHJlZyk7Ci11aW50MzJfdCBwY2lfY29uZl9yZWFkMzIo
Ci0gICAgdW5zaWduZWQgaW50IHNlZywgdW5zaWduZWQgaW50IGJ1cywgdW5zaWduZWQgaW50IGRl
diwgdW5zaWduZWQgaW50IGZ1bmMsCi0gICAgdW5zaWduZWQgaW50IHJlZyk7Cit1aW50MzJfdCBw
Y2lfY29uZl9yZWFkMzIocGNpX3NiZGZfdCBzYmRmLCB1bnNpZ25lZCBpbnQgcmVnKTsKIHZvaWQg
cGNpX2NvbmZfd3JpdGU4KAogICAgIHVuc2lnbmVkIGludCBzZWcsIHVuc2lnbmVkIGludCBidXMs
IHVuc2lnbmVkIGludCBkZXYsIHVuc2lnbmVkIGludCBmdW5jLAogICAgIHVuc2lnbmVkIGludCBy
ZWcsIHVpbnQ4X3QgZGF0YSk7Ci0tIAoyLjIwLjEgKEFwcGxlIEdpdC0xMTcpCgoKX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcg
bGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9q
ZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

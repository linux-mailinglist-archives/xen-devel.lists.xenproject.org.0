Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 51715B2A97
	for <lists+xen-devel@lfdr.de>; Sat, 14 Sep 2019 10:55:45 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i93oK-00088o-BD; Sat, 14 Sep 2019 08:53:40 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=rDpt=XJ=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1i93oH-00086L-Um
 for xen-devel@lists.xenproject.org; Sat, 14 Sep 2019 08:53:38 +0000
X-Inumbo-ID: 105c4532-d6cd-11e9-a337-bc764e2007e4
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 105c4532-d6cd-11e9-a337-bc764e2007e4;
 Sat, 14 Sep 2019 08:53:04 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 1C73EB061;
 Sat, 14 Sep 2019 08:53:03 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Sat, 14 Sep 2019 10:52:31 +0200
Message-Id: <20190914085251.18816-28-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190914085251.18816-1-jgross@suse.com>
References: <20190914085251.18816-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v3 27/47] xen/sched: move struct task_slice into
 struct sched_unit
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Tim Deegan <tim@xen.org>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>,
 Robert VanVossen <robert.vanvossen@dornerworks.com>,
 Dario Faggioli <dfaggioli@suse.com>, Julien Grall <julien.grall@arm.com>,
 Josh Whitehead <josh.whitehead@dornerworks.com>,
 Meng Xu <mengxu@cis.upenn.edu>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SW4gb3JkZXIgdG8gcHJlcGFyZSBmb3IgbXVsdGlwbGUgdmNwdXMgcGVyIHNjaGVkdWxlIHVuaXQg
bW92ZSBzdHJ1Y3QKdGFza19zbGljZSBpbiBzY2hlZHVsZSgpIGZyb20gdGhlIGxvY2FsIHN0YWNr
IGludG8gc3RydWN0IHNjaGVkX3VuaXQKb2YgdGhlIGN1cnJlbnRseSBydW5uaW5nIHVuaXQuIFRv
IG1ha2UgYWNjZXNzIGVhc2llciBmb3IgdGhlIHNpbmdsZQpzY2hlZHVsZXJzIGFkZCB0aGUgcG9p
bnRlciBvZiB0aGUgY3VycmVudGx5IHJ1bm5pbmcgdW5pdCBhcyBhIHBhcmFtZXRlcgpvZiBkb19z
Y2hlZHVsZSgpLgoKV2hpbGUgYXQgaXQgc3dpdGNoIHRoZSB0YXNrbGV0X3dvcmtfc2NoZWR1bGVk
IHBhcmFtZXRlciBvZgpkb19zY2hlZHVsZSgpIGZyb20gYm9vbF90IHRvIGJvb2wuCgpBcyBzdHJ1
Y3QgdGFza19zbGljZSBpcyBvbmx5IGV2ZXIgbW9kaWZpZWQgd2l0aCB0aGUgbG9jYWwgc2NoZWR1
bGUKbG9jayBoZWxkIGl0IGlzIHNhZmUgdG8gZGlyZWN0bHkgc2V0IHRoZSBkaWZmZXJlbnQgdW5p
dHMgaW4gc3RydWN0CnNjaGVkX3VuaXQgaW5zdGVhZCBvZiB1c2luZyBhbiBvbi1zdGFjayBjb3B5
IGZvciByZXR1cm5pbmcgdGhlIGRhdGEuCgpTaWduZWQtb2ZmLWJ5OiBKdWVyZ2VuIEdyb3NzIDxq
Z3Jvc3NAc3VzZS5jb20+Ci0tLQpWMzoKLSByZWFkZCBhY2NpZGVudGFsbHkgZHJvcHBlZCBjYWxs
IG9mIGNvbnRpbnVlX3J1bm5pbmcoKSAoRGFyaW8gRmFnZ2lvbGkpCi0tLQogeGVuL2NvbW1vbi9z
Y2hlZF9hcmluYzY1My5jIHwgMjAgKysrKysrKy0tLS0tLS0tLS0tLS0KIHhlbi9jb21tb24vc2No
ZWRfY3JlZGl0LmMgICB8IDI1ICsrKysrKysrKysrLS0tLS0tLS0tLS0tLS0KIHhlbi9jb21tb24v
c2NoZWRfY3JlZGl0Mi5jICB8IDIxICsrKysrKysrKy0tLS0tLS0tLS0tLQogeGVuL2NvbW1vbi9z
Y2hlZF9udWxsLmMgICAgIHwgMjkgKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0KIHhlbi9j
b21tb24vc2NoZWRfcnQuYyAgICAgICB8IDIyICsrKysrKysrKysrLS0tLS0tLS0tLS0KIHhlbi9j
b21tb24vc2NoZWR1bGUuYyAgICAgICB8IDMwICsrKysrKysrKysrKysrLS0tLS0tLS0tLS0tLS0t
LQogeGVuL2luY2x1ZGUveGVuL3NjaGVkLWlmLmggIHwgMTEgKysrLS0tLS0tLS0KIHhlbi9pbmNs
dWRlL3hlbi9zY2hlZC5oICAgICB8ICA2ICsrKysrKwogOCBmaWxlcyBjaGFuZ2VkLCA3NSBpbnNl
cnRpb25zKCspLCA4OSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3NjaGVk
X2FyaW5jNjUzLmMgYi94ZW4vY29tbW9uL3NjaGVkX2FyaW5jNjUzLmMKaW5kZXggYTRkYjM0ODQz
Yi4uOTZmM2U4NDRkMiAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9zY2hlZF9hcmluYzY1My5jCisr
KyBiL3hlbi9jb21tb24vc2NoZWRfYXJpbmM2NTMuYwpAQCAtNDk3LDE4ICs0OTcsMTQgQEAgYTY1
M3NjaGVkX3VuaXRfd2FrZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hl
ZF91bml0ICp1bml0KQogICoKICAqIEBwYXJhbSBvcHMgICAgICAgUG9pbnRlciB0byB0aGlzIGlu
c3RhbmNlIG9mIHRoZSBzY2hlZHVsZXIgc3RydWN0dXJlCiAgKiBAcGFyYW0gbm93ICAgICAgIEN1
cnJlbnQgdGltZQotICoKLSAqIEByZXR1cm4gICAgICAgICAgQWRkcmVzcyBvZiB0aGUgVU5JVCBz
dHJ1Y3R1cmUgc2NoZWR1bGVkIHRvIGJlIHJ1biBuZXh0Ci0gKiAgICAgICAgICAgICAgICAgIEFt
b3VudCBvZiB0aW1lIHRvIGV4ZWN1dGUgdGhlIHJldHVybmVkIFVOSVQKLSAqICAgICAgICAgICAg
ICAgICAgRmxhZyBmb3Igd2hldGhlciB0aGUgVU5JVCB3YXMgbWlncmF0ZWQKICAqLwotc3RhdGlj
IHN0cnVjdCB0YXNrX3NsaWNlCitzdGF0aWMgdm9pZAogYTY1M3NjaGVkX2RvX3NjaGVkdWxlKAog
ICAgIGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKKyAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCAq
cHJldiwKICAgICBzX3RpbWVfdCBub3csCi0gICAgYm9vbF90IHRhc2tsZXRfd29ya19zY2hlZHVs
ZWQpCisgICAgYm9vbCB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkKQogewotICAgIHN0cnVjdCB0YXNr
X3NsaWNlIHJldDsgICAgICAgICAgICAgICAgICAgICAgLyogaG9sZCB0aGUgY2hvc2VuIGRvbWFp
biAqLwogICAgIHN0cnVjdCBzY2hlZF91bml0ICpuZXdfdGFzayA9IE5VTEw7CiAgICAgc3RhdGlj
IHVuc2lnbmVkIGludCBzY2hlZF9pbmRleCA9IDA7CiAgICAgc3RhdGljIHNfdGltZV90IG5leHRf
c3dpdGNoX3RpbWU7CkBAIC01ODYsMTMgKzU4MiwxMSBAQCBhNjUzc2NoZWRfZG9fc2NoZWR1bGUo
CiAgICAgICogUmV0dXJuIHRoZSBhbW91bnQgb2YgdGltZSB0aGUgbmV4dCBkb21haW4gaGFzIHRv
IHJ1biBhbmQgdGhlIGFkZHJlc3MKICAgICAgKiBvZiB0aGUgc2VsZWN0ZWQgdGFzaydzIFVOSVQg
c3RydWN0dXJlLgogICAgICAqLwotICAgIHJldC50aW1lID0gbmV4dF9zd2l0Y2hfdGltZSAtIG5v
dzsKLSAgICByZXQudGFzayA9IG5ld190YXNrOwotICAgIHJldC5taWdyYXRlZCA9IDA7Ci0KLSAg
ICBCVUdfT04ocmV0LnRpbWUgPD0gMCk7CisgICAgcHJldi0+bmV4dF90aW1lID0gbmV4dF9zd2l0
Y2hfdGltZSAtIG5vdzsKKyAgICBwcmV2LT5uZXh0X3Rhc2sgPSBuZXdfdGFzazsKKyAgICBuZXdf
dGFzay0+bWlncmF0ZWQgPSBmYWxzZTsKIAotICAgIHJldHVybiByZXQ7CisgICAgQlVHX09OKHBy
ZXYtPm5leHRfdGltZSA8PSAwKTsKIH0KIAogLyoqCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3Nj
aGVkX2NyZWRpdC5jIGIveGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQuYwppbmRleCAyMDNjNWRlY2Vm
Li41ODAyYTY3Nzg0IDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL3NjaGVkX2NyZWRpdC5jCisrKyBi
L3hlbi9jb21tb24vc2NoZWRfY3JlZGl0LmMKQEAgLTE2NzUsNyArMTY3NSw3IEBAIGNzY2hlZF9y
dW5xX3N0ZWFsKGludCBwZWVyX2NwdSwgaW50IGNwdSwgaW50IHByaSwgaW50IGJhbGFuY2Vfc3Rl
cCkKIAogc3RhdGljIHN0cnVjdCBjc2NoZWRfdW5pdCAqCiBjc2NoZWRfbG9hZF9iYWxhbmNlKHN0
cnVjdCBjc2NoZWRfcHJpdmF0ZSAqcHJ2LCBpbnQgY3B1LAotICAgIHN0cnVjdCBjc2NoZWRfdW5p
dCAqc25leHQsIGJvb2xfdCAqc3RvbGVuKQorICAgIHN0cnVjdCBjc2NoZWRfdW5pdCAqc25leHQs
IGJvb2wgKnN0b2xlbikKIHsKICAgICBzdHJ1Y3QgY3B1cG9vbCAqYyA9IHBlcl9jcHUoY3B1cG9v
bCwgY3B1KTsKICAgICBzdHJ1Y3QgY3NjaGVkX3VuaXQgKnNwZWVyOwpAQCAtMTc5MSw3ICsxNzkx
LDcgQEAgY3NjaGVkX2xvYWRfYmFsYW5jZShzdHJ1Y3QgY3NjaGVkX3ByaXZhdGUgKnBydiwgaW50
IGNwdSwKICAgICAgICAgICAgICAgICAvKiBBcyBzb29uIGFzIG9uZSB1bml0IGlzIGZvdW5kLCBi
YWxhbmNpbmcgZW5kcyAqLwogICAgICAgICAgICAgICAgIGlmICggc3BlZXIgIT0gTlVMTCApCiAg
ICAgICAgICAgICAgICAgewotICAgICAgICAgICAgICAgICAgICAqc3RvbGVuID0gMTsKKyAgICAg
ICAgICAgICAgICAgICAgKnN0b2xlbiA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgIC8qCiAg
ICAgICAgICAgICAgICAgICAgICAqIE5leHQgdGltZSB3ZSdsbCBsb29rIGZvciB3b3JrIHRvIHN0
ZWFsIG9uIHRoaXMgbm9kZSwgd2UKICAgICAgICAgICAgICAgICAgICAgICogd2lsbCBzdGFydCBm
cm9tIHRoZSBuZXh0IHBDUFUsIHdpdGggcmVzcGVjdCB0byB0aGlzIG9uZSwKQEAgLTE4MjEsMTkg
KzE4MjEsMTggQEAgY3NjaGVkX2xvYWRfYmFsYW5jZShzdHJ1Y3QgY3NjaGVkX3ByaXZhdGUgKnBy
diwgaW50IGNwdSwKICAqIFRoaXMgZnVuY3Rpb24gaXMgaW4gdGhlIGNyaXRpY2FsIHBhdGguIEl0
IGlzIGRlc2lnbmVkIHRvIGJlIHNpbXBsZSBhbmQKICAqIGZhc3QgZm9yIHRoZSBjb21tb24gY2Fz
ZS4KICAqLwotc3RhdGljIHN0cnVjdCB0YXNrX3NsaWNlCi1jc2NoZWRfc2NoZWR1bGUoCi0gICAg
Y29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzX3RpbWVfdCBub3csIGJvb2xfdCB0YXNrbGV0
X3dvcmtfc2NoZWR1bGVkKQorc3RhdGljIHZvaWQgY3NjaGVkX3NjaGVkdWxlKAorICAgIGNvbnN0
IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQsIHNfdGltZV90
IG5vdywKKyAgICBib29sIHRhc2tsZXRfd29ya19zY2hlZHVsZWQpCiB7CiAgICAgY29uc3QgdW5z
aWduZWQgaW50IGN1cl9jcHUgPSBzbXBfcHJvY2Vzc29yX2lkKCk7CiAgICAgY29uc3QgdW5zaWdu
ZWQgaW50IHNjaGVkX2NwdSA9IHNjaGVkX2dldF9yZXNvdXJjZV9jcHUoY3VyX2NwdSk7CiAgICAg
c3RydWN0IGxpc3RfaGVhZCAqIGNvbnN0IHJ1bnEgPSBSVU5RKHNjaGVkX2NwdSk7Ci0gICAgc3Ry
dWN0IHNjaGVkX3VuaXQgKnVuaXQgPSBjdXJyZW50LT5zY2hlZF91bml0OwogICAgIHN0cnVjdCBj
c2NoZWRfdW5pdCAqIGNvbnN0IHNjdXJyID0gQ1NDSEVEX1VOSVQodW5pdCk7CiAgICAgc3RydWN0
IGNzY2hlZF9wcml2YXRlICpwcnYgPSBDU0NIRURfUFJJVihvcHMpOwogICAgIHN0cnVjdCBjc2No
ZWRfdW5pdCAqc25leHQ7Ci0gICAgc3RydWN0IHRhc2tfc2xpY2UgcmV0OwogICAgIHNfdGltZV90
IHJ1bnRpbWUsIHRzbGljZTsKKyAgICBib29sIG1pZ3JhdGVkID0gZmFsc2U7CiAKICAgICBTQ0hF
RF9TVEFUX0NSQU5LKHNjaGVkdWxlKTsKICAgICBDU0NIRURfVU5JVF9DSEVDSyh1bml0KTsKQEAg
LTE5MjQsNyArMTkyMyw2IEBAIGNzY2hlZF9zY2hlZHVsZSgKICAgICAgICAgICAgICAgICAgICAg
ICAgICh1bnNpZ25lZCBjaGFyICopJmQpOwogICAgICAgICB9CiAKLSAgICAgICAgcmV0Lm1pZ3Jh
dGVkID0gMDsKICAgICAgICAgZ290byBvdXQ7CiAgICAgfQogICAgIHRzbGljZSA9IHBydi0+dHNs
aWNlOwpAQCAtMTk0Miw3ICsxOTQwLDYgQEAgY3NjaGVkX3NjaGVkdWxlKAogICAgIH0KIAogICAg
IHNuZXh0ID0gX19ydW5xX2VsZW0ocnVucS0+bmV4dCk7Ci0gICAgcmV0Lm1pZ3JhdGVkID0gMDsK
IAogICAgIC8qIFRhc2tsZXQgd29yayAod2hpY2ggcnVucyBpbiBpZGxlIFVOSVQgY29udGV4dCkg
b3ZlcnJpZGVzIGFsbCBlbHNlLiAqLwogICAgIGlmICggdGFza2xldF93b3JrX3NjaGVkdWxlZCAp
CkBAIC0xOTY4LDcgKzE5NjUsNyBAQCBjc2NoZWRfc2NoZWR1bGUoCiAgICAgaWYgKCBzbmV4dC0+
cHJpID4gQ1NDSEVEX1BSSV9UU19PVkVSICkKICAgICAgICAgX19ydW5xX3JlbW92ZShzbmV4dCk7
CiAgICAgZWxzZQotICAgICAgICBzbmV4dCA9IGNzY2hlZF9sb2FkX2JhbGFuY2UocHJ2LCBzY2hl
ZF9jcHUsIHNuZXh0LCAmcmV0Lm1pZ3JhdGVkKTsKKyAgICAgICAgc25leHQgPSBjc2NoZWRfbG9h
ZF9iYWxhbmNlKHBydiwgc2NoZWRfY3B1LCBzbmV4dCwgJm1pZ3JhdGVkKTsKIAogICAgIC8qCiAg
ICAgICogVXBkYXRlIGlkbGVycyBtYXNrIGlmIG5lY2Vzc2FyeS4gV2hlbiB3ZSdyZSBpZGxpbmcs
IG90aGVyIENQVXMKQEAgLTE5OTEsMTIgKzE5ODgsMTIgQEAgb3V0OgogICAgIC8qCiAgICAgICog
UmV0dXJuIHRhc2sgdG8gcnVuIG5leHQuLi4KICAgICAgKi8KLSAgICByZXQudGltZSA9IChpc19p
ZGxlX3VuaXQoc25leHQtPnVuaXQpID8KKyAgICB1bml0LT5uZXh0X3RpbWUgPSAoaXNfaWRsZV91
bml0KHNuZXh0LT51bml0KSA/CiAgICAgICAgICAgICAgICAgLTEgOiB0c2xpY2UpOwotICAgIHJl
dC50YXNrID0gc25leHQtPnVuaXQ7CisgICAgdW5pdC0+bmV4dF90YXNrID0gc25leHQtPnVuaXQ7
CisgICAgc25leHQtPnVuaXQtPm1pZ3JhdGVkID0gbWlncmF0ZWQ7CiAKLSAgICBDU0NIRURfVU5J
VF9DSEVDSyhyZXQudGFzayk7Ci0gICAgcmV0dXJuIHJldDsKKyAgICBDU0NIRURfVU5JVF9DSEVD
Syh1bml0LT5uZXh0X3Rhc2spOwogfQogCiBzdGF0aWMgdm9pZApkaWZmIC0tZ2l0IGEveGVuL2Nv
bW1vbi9zY2hlZF9jcmVkaXQyLmMgYi94ZW4vY29tbW9uL3NjaGVkX2NyZWRpdDIuYwppbmRleCBj
ZjA1NTllOTY0Li40MTRhYzhmNWI2IDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL3NjaGVkX2NyZWRp
dDIuYworKysgYi94ZW4vY29tbW9uL3NjaGVkX2NyZWRpdDIuYwpAQCAtMzQ0NCwxOSArMzQ0NCwx
OCBAQCBydW5xX2NhbmRpZGF0ZShzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQsCiAg
KiBUaGlzIGZ1bmN0aW9uIGlzIGluIHRoZSBjcml0aWNhbCBwYXRoLiBJdCBpcyBkZXNpZ25lZCB0
byBiZSBzaW1wbGUgYW5kCiAgKiBmYXN0IGZvciB0aGUgY29tbW9uIGNhc2UuCiAgKi8KLXN0YXRp
YyBzdHJ1Y3QgdGFza19zbGljZQotY3NjaGVkMl9zY2hlZHVsZSgKLSAgICBjb25zdCBzdHJ1Y3Qg
c2NoZWR1bGVyICpvcHMsIHNfdGltZV90IG5vdywgYm9vbCB0YXNrbGV0X3dvcmtfc2NoZWR1bGVk
KQorc3RhdGljIHZvaWQgY3NjaGVkMl9zY2hlZHVsZSgKKyAgICBjb25zdCBzdHJ1Y3Qgc2NoZWR1
bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICpjdXJydW5pdCwgc190aW1lX3Qgbm93LAorICAg
IGJvb2wgdGFza2xldF93b3JrX3NjaGVkdWxlZCkKIHsKICAgICBjb25zdCB1bnNpZ25lZCBpbnQg
Y3VyX2NwdSA9IHNtcF9wcm9jZXNzb3JfaWQoKTsKICAgICBjb25zdCB1bnNpZ25lZCBpbnQgc2No
ZWRfY3B1ID0gc2NoZWRfZ2V0X3Jlc291cmNlX2NwdShjdXJfY3B1KTsKICAgICBzdHJ1Y3QgY3Nj
aGVkMl9ydW5xdWV1ZV9kYXRhICpycWQ7Ci0gICAgc3RydWN0IHNjaGVkX3VuaXQgKmN1cnJ1bml0
ID0gY3VycmVudC0+c2NoZWRfdW5pdDsKICAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICogY29uc3Qg
c2N1cnIgPSBjc2NoZWQyX3VuaXQoY3VycnVuaXQpOwogICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQg
KnNuZXh0ID0gTlVMTDsKICAgICB1bnNpZ25lZCBpbnQgc2tpcHBlZF91bml0cyA9IDA7Ci0gICAg
c3RydWN0IHRhc2tfc2xpY2UgcmV0OwogICAgIGJvb2wgdGlja2xlZDsKKyAgICBib29sIG1pZ3Jh
dGVkID0gZmFsc2U7CiAKICAgICBTQ0hFRF9TVEFUX0NSQU5LKHNjaGVkdWxlKTsKICAgICBDU0NI
RUQyX1VOSVRfQ0hFQ0soY3VycnVuaXQpOwpAQCAtMzU0MSw4ICszNTQwLDYgQEAgY3NjaGVkMl9z
Y2hlZHVsZSgKICAgICAgICAgICYmIHVuaXRfcnVubmFibGUoY3VycnVuaXQpICkKICAgICAgICAg
X19zZXRfYml0KF9fQ1NGTEFHX2RlbGF5ZWRfcnVucV9hZGQsICZzY3Vyci0+ZmxhZ3MpOwogCi0g
ICAgcmV0Lm1pZ3JhdGVkID0gMDsKLQogICAgIC8qIEFjY291bnRpbmcgZm9yIG5vbi1pZGxlIHRh
c2tzICovCiAgICAgaWYgKCAhaXNfaWRsZV91bml0KHNuZXh0LT51bml0KSApCiAgICAgewpAQCAt
MzU5Miw3ICszNTg5LDcgQEAgY3NjaGVkMl9zY2hlZHVsZSgKICAgICAgICAgICAgIHNuZXh0LT5j
cmVkaXQgKz0gQ1NDSEVEMl9NSUdSQVRFX0NPTVBFTlNBVElPTjsKICAgICAgICAgICAgIHNjaGVk
X3NldF9yZXMoc25leHQtPnVuaXQsIGdldF9zY2hlZF9yZXMoc2NoZWRfY3B1KSk7CiAgICAgICAg
ICAgICBTQ0hFRF9TVEFUX0NSQU5LKG1pZ3JhdGVkKTsKLSAgICAgICAgICAgIHJldC5taWdyYXRl
ZCA9IDE7CisgICAgICAgICAgICBtaWdyYXRlZCA9IHRydWU7CiAgICAgICAgIH0KICAgICB9CiAg
ICAgZWxzZQpAQCAtMzYyMywxMSArMzYyMCwxMSBAQCBjc2NoZWQyX3NjaGVkdWxlKAogICAgIC8q
CiAgICAgICogUmV0dXJuIHRhc2sgdG8gcnVuIG5leHQuLi4KICAgICAgKi8KLSAgICByZXQudGlt
ZSA9IGNzY2hlZDJfcnVudGltZShvcHMsIHNjaGVkX2NwdSwgc25leHQsIG5vdyk7Ci0gICAgcmV0
LnRhc2sgPSBzbmV4dC0+dW5pdDsKKyAgICBjdXJydW5pdC0+bmV4dF90aW1lID0gY3NjaGVkMl9y
dW50aW1lKG9wcywgc2NoZWRfY3B1LCBzbmV4dCwgbm93KTsKKyAgICBjdXJydW5pdC0+bmV4dF90
YXNrID0gc25leHQtPnVuaXQ7CisgICAgc25leHQtPnVuaXQtPm1pZ3JhdGVkID0gbWlncmF0ZWQ7
CiAKLSAgICBDU0NIRUQyX1VOSVRfQ0hFQ0socmV0LnRhc2spOwotICAgIHJldHVybiByZXQ7Cisg
ICAgQ1NDSEVEMl9VTklUX0NIRUNLKGN1cnJ1bml0LT5uZXh0X3Rhc2spOwogfQogCiBzdGF0aWMg
dm9pZApkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZF9udWxsLmMgYi94ZW4vY29tbW9uL3Nj
aGVkX251bGwuYwppbmRleCA0MTMxZGYwZGIzLi5kN2RlZWYwN2I4IDEwMDY0NAotLS0gYS94ZW4v
Y29tbW9uL3NjaGVkX251bGwuYworKysgYi94ZW4vY29tbW9uL3NjaGVkX251bGwuYwpAQCAtNzc5
LDE2ICs3NzksMTQgQEAgc3RhdGljIGlubGluZSB2b2lkIG51bGxfdW5pdF9jaGVjayhzdHJ1Y3Qg
c2NoZWRfdW5pdCAqdW5pdCkKICAqICAtIHRoZSB1bml0IGFzc2lnbmVkIHRvIHRoZSBwQ1BVLCBp
ZiB0aGVyZSdzIG9uZSBhbmQgaXQgY2FuIHJ1bjsKICAqICAtIHRoZSBpZGxlIHVuaXQsIG90aGVy
d2lzZS4KICAqLwotc3RhdGljIHN0cnVjdCB0YXNrX3NsaWNlIG51bGxfc2NoZWR1bGUoY29uc3Qg
c3RydWN0IHNjaGVkdWxlciAqb3BzLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgc190aW1lX3Qgbm93LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgYm9vbF90IHRhc2tsZXRfd29ya19zY2hlZHVsZWQpCitzdGF0aWMgdm9pZCBudWxsX3NjaGVk
dWxlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX3VuaXQgKnByZXYs
CisgICAgICAgICAgICAgICAgICAgICAgICAgIHNfdGltZV90IG5vdywgYm9vbCB0YXNrbGV0X3dv
cmtfc2NoZWR1bGVkKQogewogICAgIHVuc2lnbmVkIGludCBiczsKICAgICBjb25zdCB1bnNpZ25l
ZCBpbnQgY3VyX2NwdSA9IHNtcF9wcm9jZXNzb3JfaWQoKTsKICAgICBjb25zdCB1bnNpZ25lZCBp
bnQgc2NoZWRfY3B1ID0gc2NoZWRfZ2V0X3Jlc291cmNlX2NwdShjdXJfY3B1KTsKICAgICBzdHJ1
Y3QgbnVsbF9wcml2YXRlICpwcnYgPSBudWxsX3ByaXYob3BzKTsKICAgICBzdHJ1Y3QgbnVsbF91
bml0ICp3dmM7Ci0gICAgc3RydWN0IHRhc2tfc2xpY2UgcmV0OwogCiAgICAgU0NIRURfU1RBVF9D
UkFOSyhzY2hlZHVsZSk7CiAgICAgTlVMTF9VTklUX0NIRUNLKGN1cnJlbnQtPnNjaGVkX3VuaXQp
OwpAQCAtODE2LDE5ICs4MTQsMTggQEAgc3RhdGljIHN0cnVjdCB0YXNrX3NsaWNlIG51bGxfc2No
ZWR1bGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAgIGlmICggdGFza2xldF93b3Jr
X3NjaGVkdWxlZCApCiAgICAgewogICAgICAgICB0cmFjZV92YXIoVFJDX1NOVUxMX1RBU0tMRVQs
IDEsIDAsIE5VTEwpOwotICAgICAgICByZXQudGFzayA9IHNjaGVkX2lkbGVfdW5pdChzY2hlZF9j
cHUpOworICAgICAgICBwcmV2LT5uZXh0X3Rhc2sgPSBzY2hlZF9pZGxlX3VuaXQoc2NoZWRfY3B1
KTsKICAgICB9CiAgICAgZWxzZQotICAgICAgICByZXQudGFzayA9IHBlcl9jcHUobnBjLCBzY2hl
ZF9jcHUpLnVuaXQ7Ci0gICAgcmV0Lm1pZ3JhdGVkID0gMDsKLSAgICByZXQudGltZSA9IC0xOwor
ICAgICAgICBwcmV2LT5uZXh0X3Rhc2sgPSBwZXJfY3B1KG5wYywgc2NoZWRfY3B1KS51bml0Owor
ICAgIHByZXYtPm5leHRfdGltZSA9IC0xOwogCiAgICAgLyoKICAgICAgKiBXZSBtYXkgYmUgbmV3
IGluIHRoZSBjcHVwb29sLCBvciBqdXN0IGNvbWluZyBiYWNrIG9ubGluZS4gSW4gd2hpY2gKICAg
ICAgKiBjYXNlLCB0aGVyZSBtYXkgYmUgdW5pdHMgaW4gdGhlIHdhaXRxdWV1ZSB0aGF0IHdlIGNh
biBhc3NpZ24gdG8gdXMKICAgICAgKiBhbmQgcnVuLgogICAgICAqLwotICAgIGlmICggdW5saWtl
bHkocmV0LnRhc2sgPT0gTlVMTCkgKQorICAgIGlmICggdW5saWtlbHkocHJldi0+bmV4dF90YXNr
ID09IE5VTEwpICkKICAgICB7CiAgICAgICAgIHNwaW5fbG9jaygmcHJ2LT53YWl0cV9sb2NrKTsK
IApAQCAtODU0LDcgKzg1MSw3IEBAIHN0YXRpYyBzdHJ1Y3QgdGFza19zbGljZSBudWxsX3NjaGVk
dWxlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKICAgICAgICAgICAgICAgICB7CiAgICAg
ICAgICAgICAgICAgICAgIHVuaXRfYXNzaWduKHBydiwgd3ZjLT51bml0LCBzY2hlZF9jcHUpOwog
ICAgICAgICAgICAgICAgICAgICBsaXN0X2RlbF9pbml0KCZ3dmMtPndhaXRxX2VsZW0pOwotICAg
ICAgICAgICAgICAgICAgICByZXQudGFzayA9IHd2Yy0+dW5pdDsKKyAgICAgICAgICAgICAgICAg
ICAgcHJldi0+bmV4dF90YXNrID0gd3ZjLT51bml0OwogICAgICAgICAgICAgICAgICAgICBnb3Rv
IHVubG9jazsKICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICB9CkBAIC04NjIsMTUgKzg1
OSwxNyBAQCBzdGF0aWMgc3RydWN0IHRhc2tfc2xpY2UgbnVsbF9zY2hlZHVsZShjb25zdCBzdHJ1
Y3Qgc2NoZWR1bGVyICpvcHMsCiAgdW5sb2NrOgogICAgICAgICBzcGluX3VubG9jaygmcHJ2LT53
YWl0cV9sb2NrKTsKIAotICAgICAgICBpZiAoIHJldC50YXNrID09IE5VTEwgJiYgIWNwdW1hc2tf
dGVzdF9jcHUoc2NoZWRfY3B1LCAmcHJ2LT5jcHVzX2ZyZWUpICkKKyAgICAgICAgaWYgKCBwcmV2
LT5uZXh0X3Rhc2sgPT0gTlVMTCAmJgorICAgICAgICAgICAgICFjcHVtYXNrX3Rlc3RfY3B1KHNj
aGVkX2NwdSwgJnBydi0+Y3B1c19mcmVlKSApCiAgICAgICAgICAgICBjcHVtYXNrX3NldF9jcHUo
c2NoZWRfY3B1LCAmcHJ2LT5jcHVzX2ZyZWUpOwogICAgIH0KIAotICAgIGlmICggdW5saWtlbHko
cmV0LnRhc2sgPT0gTlVMTCB8fCAhdW5pdF9ydW5uYWJsZShyZXQudGFzaykpICkKLSAgICAgICAg
cmV0LnRhc2sgPSBzY2hlZF9pZGxlX3VuaXQoc2NoZWRfY3B1KTsKKyAgICBpZiAoIHVubGlrZWx5
KHByZXYtPm5leHRfdGFzayA9PSBOVUxMIHx8ICF1bml0X3J1bm5hYmxlKHByZXYtPm5leHRfdGFz
aykpICkKKyAgICAgICAgcHJldi0+bmV4dF90YXNrID0gc2NoZWRfaWRsZV91bml0KHNjaGVkX2Nw
dSk7CiAKLSAgICBOVUxMX1VOSVRfQ0hFQ0socmV0LnRhc2spOwotICAgIHJldHVybiByZXQ7Cisg
ICAgTlVMTF9VTklUX0NIRUNLKHByZXYtPm5leHRfdGFzayk7CisKKyAgICBwcmV2LT5uZXh0X3Rh
c2stPm1pZ3JhdGVkID0gZmFsc2U7CiB9CiAKIHN0YXRpYyBpbmxpbmUgdm9pZCBkdW1wX3VuaXQo
c3RydWN0IG51bGxfcHJpdmF0ZSAqcHJ2LCBzdHJ1Y3QgbnVsbF91bml0ICpudmMpCmRpZmYgLS1n
aXQgYS94ZW4vY29tbW9uL3NjaGVkX3J0LmMgYi94ZW4vY29tbW9uL3NjaGVkX3J0LmMKaW5kZXgg
YWI0OGQ0YmIxZC4uOTFiYzNkNTZmYiAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9zY2hlZF9ydC5j
CisrKyBiL3hlbi9jb21tb24vc2NoZWRfcnQuYwpAQCAtMTA1NCwxNiArMTA1NCwxNiBAQCBydW5x
X3BpY2soY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBjb25zdCBjcHVtYXNrX3QgKm1hc2sp
CiAgKiBzY2hlZHVsZSBmdW5jdGlvbiBmb3IgcnQgc2NoZWR1bGVyLgogICogVGhlIGxvY2sgaXMg
YWxyZWFkeSBncmFiYmVkIGluIHNjaGVkdWxlLmMsIG5vIG5lZWQgdG8gbG9jayBoZXJlCiAgKi8K
LXN0YXRpYyBzdHJ1Y3QgdGFza19zbGljZQotcnRfc2NoZWR1bGUoY29uc3Qgc3RydWN0IHNjaGVk
dWxlciAqb3BzLCBzX3RpbWVfdCBub3csIGJvb2xfdCB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkKQor
c3RhdGljIHZvaWQKK3J0X3NjaGVkdWxlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3Ry
dWN0IHNjaGVkX3VuaXQgKmN1cnJ1bml0LAorICAgICAgICAgICAgc190aW1lX3Qgbm93LCBib29s
IHRhc2tsZXRfd29ya19zY2hlZHVsZWQpCiB7CiAgICAgY29uc3QgdW5zaWduZWQgaW50IGN1cl9j
cHUgPSBzbXBfcHJvY2Vzc29yX2lkKCk7CiAgICAgY29uc3QgdW5zaWduZWQgaW50IHNjaGVkX2Nw
dSA9IHNjaGVkX2dldF9yZXNvdXJjZV9jcHUoY3VyX2NwdSk7CiAgICAgc3RydWN0IHJ0X3ByaXZh
dGUgKnBydiA9IHJ0X3ByaXYob3BzKTsKLSAgICBzdHJ1Y3QgcnRfdW5pdCAqY29uc3Qgc2N1cnIg
PSBydF91bml0KGN1cnJlbnQtPnNjaGVkX3VuaXQpOworICAgIHN0cnVjdCBydF91bml0ICpjb25z
dCBzY3VyciA9IHJ0X3VuaXQoY3VycnVuaXQpOwogICAgIHN0cnVjdCBydF91bml0ICpzbmV4dCA9
IE5VTEw7Ci0gICAgc3RydWN0IHRhc2tfc2xpY2UgcmV0ID0geyAubWlncmF0ZWQgPSAwIH07Ci0g
ICAgc3RydWN0IHNjaGVkX3VuaXQgKmN1cnJ1bml0ID0gY3VycmVudC0+c2NoZWRfdW5pdDsKKyAg
ICBib29sIG1pZ3JhdGVkID0gZmFsc2U7CiAKICAgICAvKiBUUkFDRSAqLwogICAgIHsKQEAgLTEx
MTEsNyArMTExMSw3IEBAIHJ0X3NjaGVkdWxlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywg
c190aW1lX3Qgbm93LCBib29sX3QgdGFza2xldF93b3JrX3NjaGVkCiAgICAgICAgIF9fc2V0X2Jp
dChfX1JURFNfZGVsYXllZF9ydW5xX2FkZCwgJnNjdXJyLT5mbGFncyk7CiAKICAgICBzbmV4dC0+
bGFzdF9zdGFydCA9IG5vdzsKLSAgICByZXQudGltZSA9ICAtMTsgLyogaWYgYW4gaWRsZSB1bml0
IGlzIHBpY2tlZCAqLworICAgIGN1cnJ1bml0LT5uZXh0X3RpbWUgPSAgLTE7IC8qIGlmIGFuIGlk
bGUgdW5pdCBpcyBwaWNrZWQgKi8KICAgICBpZiAoICFpc19pZGxlX3VuaXQoc25leHQtPnVuaXQp
ICkKICAgICB7CiAgICAgICAgIGlmICggc25leHQgIT0gc2N1cnIgKQpAQCAtMTEyMiwxMyArMTEy
MiwxMyBAQCBydF9zY2hlZHVsZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHNfdGltZV90
IG5vdywgYm9vbF90IHRhc2tsZXRfd29ya19zY2hlZAogICAgICAgICBpZiAoIHNjaGVkX3VuaXRf
Y3B1KHNuZXh0LT51bml0KSAhPSBzY2hlZF9jcHUgKQogICAgICAgICB7CiAgICAgICAgICAgICBz
Y2hlZF9zZXRfcmVzKHNuZXh0LT51bml0LCBnZXRfc2NoZWRfcmVzKHNjaGVkX2NwdSkpOwotICAg
ICAgICAgICAgcmV0Lm1pZ3JhdGVkID0gMTsKKyAgICAgICAgICAgIG1pZ3JhdGVkID0gdHJ1ZTsK
ICAgICAgICAgfQotICAgICAgICByZXQudGltZSA9IHNuZXh0LT5jdXJfYnVkZ2V0OyAvKiBpbnZv
a2UgdGhlIHNjaGVkdWxlciBuZXh0IHRpbWUgKi8KKyAgICAgICAgLyogSW52b2tlIHRoZSBzY2hl
ZHVsZXIgbmV4dCB0aW1lLiAqLworICAgICAgICBjdXJydW5pdC0+bmV4dF90aW1lID0gc25leHQt
PmN1cl9idWRnZXQ7CiAgICAgfQotICAgIHJldC50YXNrID0gc25leHQtPnVuaXQ7Ci0KLSAgICBy
ZXR1cm4gcmV0OworICAgIGN1cnJ1bml0LT5uZXh0X3Rhc2sgPSBzbmV4dC0+dW5pdDsKKyAgICBz
bmV4dC0+dW5pdC0+bWlncmF0ZWQgPSBtaWdyYXRlZDsKIH0KIAogLyoKZGlmZiAtLWdpdCBhL3hl
bi9jb21tb24vc2NoZWR1bGUuYyBiL3hlbi9jb21tb24vc2NoZWR1bGUuYwppbmRleCA3MDI3MWNk
ZWEyLi5hYWQzOTZlZTU0IDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL3NjaGVkdWxlLmMKKysrIGIv
eGVuL2NvbW1vbi9zY2hlZHVsZS5jCkBAIC0xMDgsMTUgKzEwOCwxNCBAQCBzY2hlZF9pZGxlX2Zy
ZWVfdmRhdGEoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCB2b2lkICpwcml2KQogewogfQog
Ci1zdGF0aWMgc3RydWN0IHRhc2tfc2xpY2Ugc2NoZWRfaWRsZV9zY2hlZHVsZSgKLSAgICBjb25z
dCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHNfdGltZV90IG5vdywKK3N0YXRpYyB2b2lkIHNjaGVk
X2lkbGVfc2NoZWR1bGUoCisgICAgY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qg
c2NoZWRfdW5pdCAqdW5pdCwgc190aW1lX3Qgbm93LAogICAgIGJvb2wgdGFza2xldF93b3JrX3Nj
aGVkdWxlZCkKIHsKICAgICBjb25zdCB1bnNpZ25lZCBpbnQgY3B1ID0gc21wX3Byb2Nlc3Nvcl9p
ZCgpOwotICAgIHN0cnVjdCB0YXNrX3NsaWNlIHJldCA9IHsgLnRpbWUgPSAtMSB9OwogCi0gICAg
cmV0LnRhc2sgPSBzY2hlZF9pZGxlX3VuaXQoY3B1KTsKLSAgICByZXR1cm4gcmV0OworICAgIHVu
aXQtPm5leHRfdGltZSA9IC0xOworICAgIHVuaXQtPm5leHRfdGFzayA9IHNjaGVkX2lkbGVfdW5p
dChjcHUpOwogfQogCiBzdGF0aWMgc3RydWN0IHNjaGVkdWxlciBzY2hlZF9pZGxlX29wcyA9IHsK
QEAgLTE3MTksMTAgKzE3MTgsOSBAQCBzdGF0aWMgdm9pZCBzY2hlZHVsZSh2b2lkKQogICAgIHNf
dGltZV90ICAgICAgICAgICAgICBub3c7CiAgICAgc3RydWN0IHNjaGVkdWxlciAgICAgKnNjaGVk
OwogICAgIHVuc2lnbmVkIGxvbmcgICAgICAgICp0YXNrbGV0X3dvcmsgPSAmdGhpc19jcHUodGFz
a2xldF93b3JrX3RvX2RvKTsKLSAgICBib29sX3QgICAgICAgICAgICAgICAgdGFza2xldF93b3Jr
X3NjaGVkdWxlZCA9IDA7CisgICAgYm9vbCAgICAgICAgICAgICAgICAgIHRhc2tsZXRfd29ya19z
Y2hlZHVsZWQgPSBmYWxzZTsKICAgICBzdHJ1Y3Qgc2NoZWRfcmVzb3VyY2UgKnNkOwogICAgIHNw
aW5sb2NrX3QgICAgICAgICAgICpsb2NrOwotICAgIHN0cnVjdCB0YXNrX3NsaWNlICAgICBuZXh0
X3NsaWNlOwogICAgIGludCBjcHUgPSBzbXBfcHJvY2Vzc29yX2lkKCk7CiAKICAgICBBU1NFUlRf
Tk9UX0lOX0FUT01JQygpOwpAQCAtMTczOCwxMiArMTczNiwxMiBAQCBzdGF0aWMgdm9pZCBzY2hl
ZHVsZSh2b2lkKQogICAgICAgICBzZXRfYml0KF9UQVNLTEVUX3NjaGVkdWxlZCwgdGFza2xldF93
b3JrKTsKICAgICAgICAgLyogZmFsbHRocm91Z2ggKi8KICAgICBjYXNlIFRBU0tMRVRfZW5xdWV1
ZWR8VEFTS0xFVF9zY2hlZHVsZWQ6Ci0gICAgICAgIHRhc2tsZXRfd29ya19zY2hlZHVsZWQgPSAx
OworICAgICAgICB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkID0gdHJ1ZTsKICAgICAgICAgYnJlYWs7
CiAgICAgY2FzZSBUQVNLTEVUX3NjaGVkdWxlZDoKICAgICAgICAgY2xlYXJfYml0KF9UQVNLTEVU
X3NjaGVkdWxlZCwgdGFza2xldF93b3JrKTsKICAgICBjYXNlIDA6Ci0gICAgICAgIC8qdGFza2xl
dF93b3JrX3NjaGVkdWxlZCA9IDA7Ki8KKyAgICAgICAgLyp0YXNrbGV0X3dvcmtfc2NoZWR1bGVk
ID0gZmFsc2U7Ki8KICAgICAgICAgYnJlYWs7CiAgICAgZGVmYXVsdDoKICAgICAgICAgQlVHKCk7
CkBAIC0xNzU3LDE0ICsxNzU1LDE0IEBAIHN0YXRpYyB2b2lkIHNjaGVkdWxlKHZvaWQpCiAKICAg
ICAvKiBnZXQgcG9saWN5LXNwZWNpZmljIGRlY2lzaW9uIG9uIHNjaGVkdWxpbmcuLi4gKi8KICAg
ICBzY2hlZCA9IHRoaXNfY3B1KHNjaGVkdWxlcik7Ci0gICAgbmV4dF9zbGljZSA9IHNjaGVkLT5k
b19zY2hlZHVsZShzY2hlZCwgbm93LCB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkKTsKKyAgICBzY2hl
ZC0+ZG9fc2NoZWR1bGUoc2NoZWQsIHByZXYsIG5vdywgdGFza2xldF93b3JrX3NjaGVkdWxlZCk7
CiAKLSAgICBuZXh0ID0gbmV4dF9zbGljZS50YXNrOworICAgIG5leHQgPSBwcmV2LT5uZXh0X3Rh
c2s7CiAKICAgICBzZC0+Y3VyciA9IG5leHQ7CiAKLSAgICBpZiAoIG5leHRfc2xpY2UudGltZSA+
PSAwICkgLyogLXZlIG1lYW5zIG5vIGxpbWl0ICovCi0gICAgICAgIHNldF90aW1lcigmc2QtPnNf
dGltZXIsIG5vdyArIG5leHRfc2xpY2UudGltZSk7CisgICAgaWYgKCBwcmV2LT5uZXh0X3RpbWUg
Pj0gMCApIC8qIC12ZSBtZWFucyBubyBsaW1pdCAqLworICAgICAgICBzZXRfdGltZXIoJnNkLT5z
X3RpbWVyLCBub3cgKyBwcmV2LT5uZXh0X3RpbWUpOwogCiAgICAgaWYgKCB1bmxpa2VseShwcmV2
ID09IG5leHQpICkKICAgICB7CkBAIC0xNzcyLDcgKzE3NzAsNyBAQCBzdGF0aWMgdm9pZCBzY2hl
ZHVsZSh2b2lkKQogICAgICAgICBUUkFDRV80RChUUkNfU0NIRURfU1dJVENIX0lORkNPTlQsCiAg
ICAgICAgICAgICAgICAgIG5leHQtPmRvbWFpbi0+ZG9tYWluX2lkLCBuZXh0LT51bml0X2lkLAog
ICAgICAgICAgICAgICAgICBub3cgLSBwcmV2LT5zdGF0ZV9lbnRyeV90aW1lLAotICAgICAgICAg
ICAgICAgICBuZXh0X3NsaWNlLnRpbWUpOworICAgICAgICAgICAgICAgICBwcmV2LT5uZXh0X3Rp
bWUpOwogICAgICAgICB0cmFjZV9jb250aW51ZV9ydW5uaW5nKG5leHQtPnZjcHVfbGlzdCk7CiAg
ICAgICAgIHJldHVybiBjb250aW51ZV9ydW5uaW5nKHByZXYtPnZjcHVfbGlzdCk7CiAgICAgfQpA
QCAtMTc4NCw3ICsxNzgyLDcgQEAgc3RhdGljIHZvaWQgc2NoZWR1bGUodm9pZCkKICAgICAgICAg
ICAgICBuZXh0LT5kb21haW4tPmRvbWFpbl9pZCwgbmV4dC0+dW5pdF9pZCwKICAgICAgICAgICAg
ICAobmV4dC0+dmNwdV9saXN0LT5ydW5zdGF0ZS5zdGF0ZSA9PSBSVU5TVEFURV9ydW5uYWJsZSkg
PwogICAgICAgICAgICAgIChub3cgLSBuZXh0LT5zdGF0ZV9lbnRyeV90aW1lKSA6IDAsCi0gICAg
ICAgICAgICAgbmV4dF9zbGljZS50aW1lKTsKKyAgICAgICAgICAgICBwcmV2LT5uZXh0X3RpbWUp
OwogCiAgICAgQVNTRVJUKHByZXYtPnZjcHVfbGlzdC0+cnVuc3RhdGUuc3RhdGUgPT0gUlVOU1RB
VEVfcnVubmluZyk7CiAKQEAgLTE4MTMsNyArMTgxMSw3IEBAIHN0YXRpYyB2b2lkIHNjaGVkdWxl
KHZvaWQpCiAKICAgICBzdG9wX3RpbWVyKCZwcmV2LT52Y3B1X2xpc3QtPnBlcmlvZGljX3RpbWVy
KTsKIAotICAgIGlmICggbmV4dF9zbGljZS5taWdyYXRlZCApCisgICAgaWYgKCBuZXh0LT5taWdy
YXRlZCApCiAgICAgICAgIHZjcHVfbW92ZV9pcnFzKG5leHQtPnZjcHVfbGlzdCk7CiAKICAgICB2
Y3B1X3BlcmlvZGljX3RpbWVyX3dvcmsobmV4dC0+dmNwdV9saXN0KTsKZGlmZiAtLWdpdCBhL3hl
bi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5oIGIveGVuL2luY2x1ZGUveGVuL3NjaGVkLWlmLmgKaW5k
ZXggODQyOWU5ZTI4Ny4uNGU4OWExZTY0MCAxMDA2NDQKLS0tIGEveGVuL2luY2x1ZGUveGVuL3Nj
aGVkLWlmLmgKKysrIGIveGVuL2luY2x1ZGUveGVuL3NjaGVkLWlmLmgKQEAgLTE5NiwxMiArMTk2
LDYgQEAgc3RhdGljIGlubGluZSBzcGlubG9ja190ICpwY3B1X3NjaGVkdWxlX3RyeWxvY2sodW5z
aWduZWQgaW50IGNwdSkKICAgICByZXR1cm4gTlVMTDsKIH0KIAotc3RydWN0IHRhc2tfc2xpY2Ug
ewotICAgIHN0cnVjdCBzY2hlZF91bml0ICp0YXNrOwotICAgIHNfdGltZV90ICAgICAgICAgICB0
aW1lOwotICAgIGJvb2xfdCAgICAgICAgICAgICBtaWdyYXRlZDsKLX07Ci0KIHN0cnVjdCBzY2hl
ZHVsZXIgewogICAgIGNoYXIgKm5hbWU7ICAgICAgICAgICAgIC8qIGZ1bGwgbmFtZSBmb3IgdGhp
cyBzY2hlZHVsZXIgICAgICAqLwogICAgIGNoYXIgKm9wdF9uYW1lOyAgICAgICAgIC8qIG9wdGlv
biBuYW1lIGZvciB0aGlzIHNjaGVkdWxlciAgICAqLwpAQCAtMjQ0LDggKzIzOCw5IEBAIHN0cnVj
dCBzY2hlZHVsZXIgewogICAgIHZvaWQgICAgICAgICAoKmNvbnRleHRfc2F2ZWQpICAoY29uc3Qg
c3RydWN0IHNjaGVkdWxlciAqLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
c3RydWN0IHNjaGVkX3VuaXQgKik7CiAKLSAgICBzdHJ1Y3QgdGFza19zbGljZSAoKmRvX3NjaGVk
dWxlKSAoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqLCBzX3RpbWVfdCwKLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgYm9vbF90IHRhc2tsZXRfd29ya19zY2hlZHVsZWQpOwor
ICAgIHZvaWQgICAgICAgICAoKmRvX3NjaGVkdWxlKSAgICAoY29uc3Qgc3RydWN0IHNjaGVkdWxl
ciAqLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHNjaGVkX3Vu
aXQgKiwgc190aW1lX3QsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib29s
IHRhc2tsZXRfd29ya19zY2hlZHVsZWQpOwogCiAgICAgc3RydWN0IHNjaGVkX3Jlc291cmNlICoo
KnBpY2tfcmVzb3VyY2UpKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKiwKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RydWN0IHNjaGVkX3VuaXQgKik7
CmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaCBiL3hlbi9pbmNsdWRlL3hlbi9z
Y2hlZC5oCmluZGV4IDM2MjU3YTA2ZmUuLmE4MTY0ZDg3M2MgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNs
dWRlL3hlbi9zY2hlZC5oCisrKyBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCkBAIC0yNzQsNiAr
Mjc0LDggQEAgc3RydWN0IHNjaGVkX3VuaXQgewogICAgIGJvb2wgICAgICAgICAgICAgICAgICAg
aXNfcnVubmluZzsKICAgICAvKiBEb2VzIHNvZnQgYWZmaW5pdHkgYWN0dWFsbHkgcGxheSBhIHJv
bGUgKGdpdmVuIGhhcmQgYWZmaW5pdHkpPyAqLwogICAgIGJvb2wgICAgICAgICAgICAgICAgICAg
c29mdF9hZmZfZWZmZWN0aXZlOworICAgIC8qIEl0ZW0gaGFzIGJlZW4gbWlncmF0ZWQgdG8gb3Ro
ZXIgY3B1KHMpLiAqLworICAgIGJvb2wgICAgICAgICAgICAgICAgICAgbWlncmF0ZWQ7CiAKICAg
ICAvKiBMYXN0IHRpbWUgdW5pdCBnb3QgKGRlLSlzY2hlZHVsZWQuICovCiAgICAgdWludDY0X3Qg
ICAgICAgICAgICAgICBzdGF0ZV9lbnRyeV90aW1lOwpAQCAtMjg2LDYgKzI4OCwxMCBAQCBzdHJ1
Y3Qgc2NoZWRfdW5pdCB7CiAgICAgY3B1bWFza192YXJfdCAgICAgICAgICBjcHVfaGFyZF9hZmZp
bml0eV9zYXZlZDsKICAgICAvKiBCaXRtYXNrIG9mIENQVXMgb24gd2hpY2ggdGhpcyBWQ1BVIHBy
ZWZlcnMgdG8gcnVuLiAqLwogICAgIGNwdW1hc2tfdmFyX3QgICAgICAgICAgY3B1X3NvZnRfYWZm
aW5pdHk7CisKKyAgICAvKiBOZXh0IHVuaXQgdG8gcnVuLiAqLworICAgIHN0cnVjdCBzY2hlZF91
bml0ICAgICAgKm5leHRfdGFzazsKKyAgICBzX3RpbWVfdCAgICAgICAgICAgICAgICBuZXh0X3Rp
bWU7CiB9OwogCiAjZGVmaW5lIGZvcl9lYWNoX3NjaGVkX3VuaXQoZCwgZSkgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwKLS0gCjIuMTYuNAoKCl9fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QK
WGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5v
cmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 8F2BA12408E
	for <lists+xen-devel@lfdr.de>; Wed, 18 Dec 2019 08:51:55 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1ihU5P-0003p1-O9; Wed, 18 Dec 2019 07:49:35 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=NgR6=2I=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1ihU5O-0003oP-6G
 for xen-devel@lists.xenproject.org; Wed, 18 Dec 2019 07:49:34 +0000
X-Inumbo-ID: deef49a2-216a-11ea-88e7-bc764e2007e4
Received: from mx2.suse.de (unknown [195.135.220.15])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id deef49a2-216a-11ea-88e7-bc764e2007e4;
 Wed, 18 Dec 2019 07:49:08 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx2.suse.de (Postfix) with ESMTP id 5BFCDAE19;
 Wed, 18 Dec 2019 07:49:04 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Wed, 18 Dec 2019 08:48:57 +0100
Message-Id: <20191218074859.21665-8-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20191218074859.21665-1-jgross@suse.com>
References: <20191218074859.21665-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH 7/9] xen/sched: switch scheduling to bool where
 appropriate
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Julien Grall <julien@xen.org>,
 Wei Liu <wl@xen.org>, Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Dario Faggioli <dfaggioli@suse.com>,
 Josh Whitehead <josh.whitehead@dornerworks.com>,
 Meng Xu <mengxu@cis.upenn.edu>, Jan Beulich <jbeulich@suse.com>,
 Stewart Hildebrand <stewart.hildebrand@dornerworks.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

U2NoZWR1bGluZyBjb2RlIGhhcyBzZXZlcmFsIHBsYWNlcyB1c2luZyBpbnQgb3IgYm9vbF90IGlu
c3RlYWQgb2YgYm9vbC4KU3dpdGNoIHRob3NlLgoKU2lnbmVkLW9mZi1ieTogSnVlcmdlbiBHcm9z
cyA8amdyb3NzQHN1c2UuY29tPgotLS0KIHhlbi9jb21tb24vc2NoZWQvY3B1cG9vbC5jICAgICAg
ICB8IDEwICsrKysrLS0tLS0KIHhlbi9jb21tb24vc2NoZWQvc2NoZWQtaWYuaCAgICAgICB8ICAy
ICstCiB4ZW4vY29tbW9uL3NjaGVkL3NjaGVkX2FyaW5jNjUzLmMgfCAgOCArKysrLS0tLQogeGVu
L2NvbW1vbi9zY2hlZC9zY2hlZF9jcmVkaXQuYyAgIHwgMTIgKysrKysrLS0tLS0tCiB4ZW4vY29t
bW9uL3NjaGVkL3NjaGVkX3J0LmMgICAgICAgfCAxNCArKysrKysrLS0tLS0tLQogeGVuL2NvbW1v
bi9zY2hlZC9zY2hlZHVsZS5jICAgICAgIHwgMTQgKysrKysrKy0tLS0tLS0KIHhlbi9pbmNsdWRl
L3hlbi9zY2hlZC5oICAgICAgICAgICB8ICA2ICsrKy0tLQogNyBmaWxlcyBjaGFuZ2VkLCAzMyBp
bnNlcnRpb25zKCspLCAzMyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3Nj
aGVkL2NwdXBvb2wuYyBiL3hlbi9jb21tb24vc2NoZWQvY3B1cG9vbC5jCmluZGV4IGQ1YjY0ZDBh
NmEuLjE0MjEyYmI0YWUgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWQvY3B1cG9vbC5jCisr
KyBiL3hlbi9jb21tb24vc2NoZWQvY3B1cG9vbC5jCkBAIC0xNTQsNyArMTU0LDcgQEAgc3RhdGlj
IHN0cnVjdCBjcHVwb29sICphbGxvY19jcHVwb29sX3N0cnVjdCh2b2lkKQogICogdGhlIHNlYXJj
aGVkIGlkIGlzIHJldHVybmVkCiAgKiByZXR1cm5zIE5VTEwgaWYgbm90IGZvdW5kLgogICovCi1z
dGF0aWMgc3RydWN0IGNwdXBvb2wgKl9fY3B1cG9vbF9maW5kX2J5X2lkKGludCBpZCwgaW50IGV4
YWN0KQorc3RhdGljIHN0cnVjdCBjcHVwb29sICpfX2NwdXBvb2xfZmluZF9ieV9pZChpbnQgaWQs
IGJvb2wgZXhhY3QpCiB7CiAgICAgc3RydWN0IGNwdXBvb2wgKipxOwogCkBAIC0xNjksMTAgKzE2
OSwxMCBAQCBzdGF0aWMgc3RydWN0IGNwdXBvb2wgKl9fY3B1cG9vbF9maW5kX2J5X2lkKGludCBp
ZCwgaW50IGV4YWN0KQogCiBzdGF0aWMgc3RydWN0IGNwdXBvb2wgKmNwdXBvb2xfZmluZF9ieV9p
ZChpbnQgcG9vbGlkKQogewotICAgIHJldHVybiBfX2NwdXBvb2xfZmluZF9ieV9pZChwb29saWQs
IDEpOworICAgIHJldHVybiBfX2NwdXBvb2xfZmluZF9ieV9pZChwb29saWQsIHRydWUpOwogfQog
Ci1zdGF0aWMgc3RydWN0IGNwdXBvb2wgKl9fY3B1cG9vbF9nZXRfYnlfaWQoaW50IHBvb2xpZCwg
aW50IGV4YWN0KQorc3RhdGljIHN0cnVjdCBjcHVwb29sICpfX2NwdXBvb2xfZ2V0X2J5X2lkKGlu
dCBwb29saWQsIGJvb2wgZXhhY3QpCiB7CiAgICAgc3RydWN0IGNwdXBvb2wgKmM7CiAgICAgc3Bp
bl9sb2NrKCZjcHVwb29sX2xvY2spOwpAQCAtMTg1LDEyICsxODUsMTIgQEAgc3RhdGljIHN0cnVj
dCBjcHVwb29sICpfX2NwdXBvb2xfZ2V0X2J5X2lkKGludCBwb29saWQsIGludCBleGFjdCkKIAog
c3RydWN0IGNwdXBvb2wgKmNwdXBvb2xfZ2V0X2J5X2lkKGludCBwb29saWQpCiB7Ci0gICAgcmV0
dXJuIF9fY3B1cG9vbF9nZXRfYnlfaWQocG9vbGlkLCAxKTsKKyAgICByZXR1cm4gX19jcHVwb29s
X2dldF9ieV9pZChwb29saWQsIHRydWUpOwogfQogCiBzdGF0aWMgc3RydWN0IGNwdXBvb2wgKmNw
dXBvb2xfZ2V0X25leHRfYnlfaWQoaW50IHBvb2xpZCkKIHsKLSAgICByZXR1cm4gX19jcHVwb29s
X2dldF9ieV9pZChwb29saWQsIDApOworICAgIHJldHVybiBfX2NwdXBvb2xfZ2V0X2J5X2lkKHBv
b2xpZCwgZmFsc2UpOwogfQogCiB2b2lkIGNwdXBvb2xfcHV0KHN0cnVjdCBjcHVwb29sICpwb29s
KQpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZC9zY2hlZC1pZi5oIGIveGVuL2NvbW1vbi9z
Y2hlZC9zY2hlZC1pZi5oCmluZGV4IGVkY2UzNTRkYzcuLjlkMGRiNzVjYmIgMTAwNjQ0Ci0tLSBh
L3hlbi9jb21tb24vc2NoZWQvc2NoZWQtaWYuaAorKysgYi94ZW4vY29tbW9uL3NjaGVkL3NjaGVk
LWlmLmgKQEAgLTU4OSw3ICs1ODksNyBAQCB1bnNpZ25lZCBpbnQgY3B1cG9vbF9nZXRfZ3JhbnVs
YXJpdHkoY29uc3Qgc3RydWN0IGNwdXBvb2wgKmMpOwogICogKiBUaGUgaGFyZCBhZmZpbml0eSBp
cyBub3QgYSBzdWJzZXQgb2Ygc29mdCBhZmZpbml0eQogICogKiBUaGVyZSBpcyBhbiBvdmVybGFw
IGJldHdlZW4gdGhlIHNvZnQgYW5kIGhhcmQgYWZmaW5pdHkgbWFza3MKICAqLwotc3RhdGljIGlu
bGluZSBpbnQgaGFzX3NvZnRfYWZmaW5pdHkoY29uc3Qgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQp
CitzdGF0aWMgaW5saW5lIGJvb2wgaGFzX3NvZnRfYWZmaW5pdHkoY29uc3Qgc3RydWN0IHNjaGVk
X3VuaXQgKnVuaXQpCiB7CiAgICAgcmV0dXJuIHVuaXQtPnNvZnRfYWZmX2VmZmVjdGl2ZSAmJgog
ICAgICAgICAgICAhY3B1bWFza19zdWJzZXQoY3B1cG9vbF9kb21haW5fbWFzdGVyX2NwdW1hc2so
dW5pdC0+ZG9tYWluKSwKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vc2NoZWQvc2NoZWRfYXJpbmM2
NTMuYyBiL3hlbi9jb21tb24vc2NoZWQvc2NoZWRfYXJpbmM2NTMuYwppbmRleCBmZTE1NzU0OTAw
Li5kYzQ1Mzc4OTUyIDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL3NjaGVkL3NjaGVkX2FyaW5jNjUz
LmMKKysrIGIveGVuL2NvbW1vbi9zY2hlZC9zY2hlZF9hcmluYzY1My5jCkBAIC03NSw3ICs3NSw3
IEBAIHR5cGVkZWYgc3RydWN0IGFyaW5jNjUzX3VuaXRfcwogICAgICAqIGFyaW5jNjUzX3VuaXRf
dCBwb2ludGVyLiAqLwogICAgIHN0cnVjdCBzY2hlZF91bml0ICogdW5pdDsKICAgICAvKiBhd2Fr
ZSBob2xkcyB3aGV0aGVyIHRoZSBVTklUIGhhcyBiZWVuIHdva2VuIHdpdGggdmNwdV93YWtlKCkg
Ki8KLSAgICBib29sX3QgICAgICAgICAgICAgIGF3YWtlOworICAgIGJvb2wgICAgICAgICAgICAg
ICAgYXdha2U7CiAgICAgLyogbGlzdCBob2xkcyB0aGUgbGlua2VkIGxpc3QgaW5mb3JtYXRpb24g
Zm9yIHRoZSBsaXN0IHRoaXMgVU5JVAogICAgICAqIGlzIHN0b3JlZCBpbiAqLwogICAgIHN0cnVj
dCBsaXN0X2hlYWQgICAgbGlzdDsKQEAgLTQyNyw3ICs0MjcsNyBAQCBhNjUzc2NoZWRfYWxsb2Nf
dWRhdGEoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5p
dCwKICAgICAgKiB3aWxsIG1hcmsgdGhlIFVOSVQgYXdha2UuCiAgICAgICovCiAgICAgc3ZjLT51
bml0ID0gdW5pdDsKLSAgICBzdmMtPmF3YWtlID0gMDsKKyAgICBzdmMtPmF3YWtlID0gZmFsc2U7
CiAgICAgaWYgKCAhaXNfaWRsZV91bml0KHVuaXQpICkKICAgICAgICAgbGlzdF9hZGQoJnN2Yy0+
bGlzdCwgJlNDSEVEX1BSSVYob3BzKS0+dW5pdF9saXN0KTsKICAgICB1cGRhdGVfc2NoZWR1bGVf
dW5pdHMob3BzKTsKQEAgLTQ3Myw3ICs0NzMsNyBAQCBzdGF0aWMgdm9pZAogYTY1M3NjaGVkX3Vu
aXRfc2xlZXAoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAq
dW5pdCkKIHsKICAgICBpZiAoIEFVTklUKHVuaXQpICE9IE5VTEwgKQotICAgICAgICBBVU5JVCh1
bml0KS0+YXdha2UgPSAwOworICAgICAgICBBVU5JVCh1bml0KS0+YXdha2UgPSBmYWxzZTsKIAog
ICAgIC8qCiAgICAgICogSWYgdGhlIFVOSVQgYmVpbmcgcHV0IHRvIHNsZWVwIGlzIHRoZSBzYW1l
IG9uZSB0aGF0IGlzIGN1cnJlbnRseQpAQCAtNDkzLDcgKzQ5Myw3IEBAIHN0YXRpYyB2b2lkCiBh
NjUzc2NoZWRfdW5pdF93YWtlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNj
aGVkX3VuaXQgKnVuaXQpCiB7CiAgICAgaWYgKCBBVU5JVCh1bml0KSAhPSBOVUxMICkKLSAgICAg
ICAgQVVOSVQodW5pdCktPmF3YWtlID0gMTsKKyAgICAgICAgQVVOSVQodW5pdCktPmF3YWtlID0g
dHJ1ZTsKIAogICAgIGNwdV9yYWlzZV9zb2Z0aXJxKHNjaGVkX3VuaXRfbWFzdGVyKHVuaXQpLCBT
Q0hFRFVMRV9TT0ZUSVJRKTsKIH0KZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vc2NoZWQvc2NoZWRf
Y3JlZGl0LmMgYi94ZW4vY29tbW9uL3NjaGVkL3NjaGVkX2NyZWRpdC5jCmluZGV4IDhiMWRlOWIw
MzMuLjA1OTMwMjYxZDkgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWQvc2NoZWRfY3JlZGl0
LmMKKysrIGIveGVuL2NvbW1vbi9zY2hlZC9zY2hlZF9jcmVkaXQuYwpAQCAtMjQ1LDcgKzI0NSw3
IEBAIF9fcnVucV9lbGVtKHN0cnVjdCBsaXN0X2hlYWQgKmVsZW0pCiB9CiAKIC8qIElzIHRoZSBm
aXJzdCBlbGVtZW50IG9mIGNwdSdzIHJ1bnEgKGlmIGFueSkgY3B1J3MgaWRsZSB1bml0PyAqLwot
c3RhdGljIGlubGluZSBib29sX3QgaXNfcnVucV9pZGxlKHVuc2lnbmVkIGludCBjcHUpCitzdGF0
aWMgaW5saW5lIGJvb2wgaXNfcnVucV9pZGxlKHVuc2lnbmVkIGludCBjcHUpCiB7CiAgICAgLyoK
ICAgICAgKiBXZSdyZSBwZWVraW5nIGF0IGNwdSdzIHJ1bnEsIHdlIG11c3QgaG9sZCB0aGUgcHJv
cGVyIGxvY2suCkBAIC0zNDQsNyArMzQ0LDcgQEAgc3RhdGljIHZvaWQgYnVybl9jcmVkaXRzKHN0
cnVjdCBjc2NoZWRfdW5pdCAqc3ZjLCBzX3RpbWVfdCBub3cpCiAgICAgc3ZjLT5zdGFydF90aW1l
ICs9IChjcmVkaXRzICogTUlMTElTRUNTKDEpKSAvIENTQ0hFRF9DUkVESVRTX1BFUl9NU0VDOwog
fQogCi1zdGF0aWMgYm9vbF90IF9fcmVhZF9tb3N0bHkgb3B0X3RpY2tsZV9vbmVfaWRsZSA9IDE7
CitzdGF0aWMgYm9vbCBfX3JlYWRfbW9zdGx5IG9wdF90aWNrbGVfb25lX2lkbGUgPSB0cnVlOwog
Ym9vbGVhbl9wYXJhbSgidGlja2xlX29uZV9pZGxlX2NwdSIsIG9wdF90aWNrbGVfb25lX2lkbGUp
OwogCiBERUZJTkVfUEVSX0NQVSh1bnNpZ25lZCBpbnQsIGxhc3RfdGlja2xlX2NwdSk7CkBAIC03
MTksNyArNzE5LDcgQEAgX19jc2NoZWRfdW5pdF9pc19taWdyYXRlYWJsZShjb25zdCBzdHJ1Y3Qg
Y3NjaGVkX3ByaXZhdGUgKnBydiwKIAogc3RhdGljIGludAogX2NzY2hlZF9jcHVfcGljayhjb25z
dCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGNvbnN0IHN0cnVjdCBzY2hlZF91bml0ICp1bml0LAot
ICAgICAgICAgICAgICAgICBib29sX3QgY29tbWl0KQorICAgICAgICAgICAgICAgICBib29sIGNv
bW1pdCkKIHsKICAgICBpbnQgY3B1ID0gc2NoZWRfdW5pdF9tYXN0ZXIodW5pdCk7CiAgICAgLyog
V2UgbXVzdCBhbHdheXMgdXNlIGNwdSdzIHNjcmF0Y2ggc3BhY2UgKi8KQEAgLTg3MSw3ICs4NzEs
NyBAQCBjc2NoZWRfcmVzX3BpY2soY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBjb25zdCBz
dHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKICAgICAgKiBnZXQgYm9vc3RlZCwgd2hpY2ggd2UgZG9u
J3QgZGVzZXJ2ZSBhcyB3ZSBhcmUgIm9ubHkiIG1pZ3JhdGluZy4KICAgICAgKi8KICAgICBzZXRf
Yml0KENTQ0hFRF9GTEFHX1VOSVRfTUlHUkFUSU5HLCAmc3ZjLT5mbGFncyk7Ci0gICAgcmV0dXJu
IGdldF9zY2hlZF9yZXMoX2NzY2hlZF9jcHVfcGljayhvcHMsIHVuaXQsIDEpKTsKKyAgICByZXR1
cm4gZ2V0X3NjaGVkX3JlcyhfY3NjaGVkX2NwdV9waWNrKG9wcywgdW5pdCwgdHJ1ZSkpOwogfQog
CiBzdGF0aWMgaW5saW5lIHZvaWQKQEAgLTk3NSw3ICs5NzUsNyBAQCBjc2NoZWRfdW5pdF9hY2N0
KHN0cnVjdCBjc2NoZWRfcHJpdmF0ZSAqcHJ2LCB1bnNpZ25lZCBpbnQgY3B1KQogICAgICAgICAg
KiBtaWdyYXRpbmcgaXQgdG8gcnVuIGVsc2V3aGVyZSAoc2VlIG11bHRpLWNvcmUgYW5kIG11bHRp
LXRocmVhZAogICAgICAgICAgKiBzdXBwb3J0IGluIGNzY2hlZF9yZXNfcGljaygpKS4KICAgICAg
ICAgICovCi0gICAgICAgIG5ld19jcHUgPSBfY3NjaGVkX2NwdV9waWNrKG9wcywgY3VycnVuaXQs
IDApOworICAgICAgICBuZXdfY3B1ID0gX2NzY2hlZF9jcHVfcGljayhvcHMsIGN1cnJ1bml0LCBm
YWxzZSk7CiAKICAgICAgICAgdW5pdF9zY2hlZHVsZV91bmxvY2tfaXJxcmVzdG9yZShsb2NrLCBm
bGFncywgY3VycnVuaXQpOwogCkBAIC0xMTA4LDcgKzExMDgsNyBAQCBzdGF0aWMgdm9pZAogY3Nj
aGVkX3VuaXRfd2FrZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91
bml0ICp1bml0KQogewogICAgIHN0cnVjdCBjc2NoZWRfdW5pdCAqIGNvbnN0IHN2YyA9IENTQ0hF
RF9VTklUKHVuaXQpOwotICAgIGJvb2xfdCBtaWdyYXRpbmc7CisgICAgYm9vbCBtaWdyYXRpbmc7
CiAKICAgICBCVUdfT04oIGlzX2lkbGVfdW5pdCh1bml0KSApOwogCmRpZmYgLS1naXQgYS94ZW4v
Y29tbW9uL3NjaGVkL3NjaGVkX3J0LmMgYi94ZW4vY29tbW9uL3NjaGVkL3NjaGVkX3J0LmMKaW5k
ZXggMjY0YTc1MzExNi4uODY0NmQ3NzM0MyAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9zY2hlZC9z
Y2hlZF9ydC5jCisrKyBiL3hlbi9jb21tb24vc2NoZWQvc2NoZWRfcnQuYwpAQCAtNDkwLDEwICs0
OTAsMTAgQEAgcnRfdXBkYXRlX2RlYWRsaW5lKHNfdGltZV90IG5vdywgc3RydWN0IHJ0X3VuaXQg
KnN2YykKIHN0YXRpYyBpbmxpbmUgYm9vbAogZGVhZGxpbmVfcXVldWVfcmVtb3ZlKHN0cnVjdCBs
aXN0X2hlYWQgKnF1ZXVlLCBzdHJ1Y3QgbGlzdF9oZWFkICplbGVtKQogewotICAgIGludCBwb3Mg
PSAwOworICAgIGJvb2wgcG9zID0gZmFsc2U7CiAKICAgICBpZiAoIHF1ZXVlLT5uZXh0ICE9IGVs
ZW0gKQotICAgICAgICBwb3MgPSAxOworICAgICAgICBwb3MgPSB0cnVlOwogCiAgICAgbGlzdF9k
ZWxfaW5pdChlbGVtKTsKICAgICByZXR1cm4gIXBvczsKQEAgLTUwNSwxNCArNTA1LDE0IEBAIGRl
YWRsaW5lX3F1ZXVlX2luc2VydChzdHJ1Y3QgcnRfdW5pdCAqICgqcWVsZW0pKHN0cnVjdCBsaXN0
X2hlYWQgKiksCiAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGxpc3RfaGVhZCAqcXVldWUp
CiB7CiAgICAgc3RydWN0IGxpc3RfaGVhZCAqaXRlcjsKLSAgICBpbnQgcG9zID0gMDsKKyAgICBi
b29sIHBvcyA9IGZhbHNlOwogCiAgICAgbGlzdF9mb3JfZWFjaCAoIGl0ZXIsIHF1ZXVlICkKICAg
ICB7CiAgICAgICAgIHN0cnVjdCBydF91bml0ICogaXRlcl9zdmMgPSAoKnFlbGVtKShpdGVyKTsK
ICAgICAgICAgaWYgKCBjb21wYXJlX3VuaXRfcHJpb3JpdHkoc3ZjLCBpdGVyX3N2YykgPiAwICkK
ICAgICAgICAgICAgIGJyZWFrOwotICAgICAgICBwb3MrKzsKKyAgICAgICAgcG9zID0gdHJ1ZTsK
ICAgICB9CiAgICAgbGlzdF9hZGRfdGFpbChlbGVtLCBpdGVyKTsKICAgICByZXR1cm4gIXBvczsK
QEAgLTYwNSw3ICs2MDUsNyBAQCByZXBscV9yZWluc2VydChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVy
ICpvcHMsIHN0cnVjdCBydF91bml0ICpzdmMpCiB7CiAgICAgc3RydWN0IGxpc3RfaGVhZCAqcmVw
bHEgPSBydF9yZXBscShvcHMpOwogICAgIHN0cnVjdCBydF91bml0ICpyZWFybV9zdmMgPSBzdmM7
Ci0gICAgYm9vbF90IHJlYXJtID0gMDsKKyAgICBib29sIHJlYXJtID0gZmFsc2U7CiAKICAgICBB
U1NFUlQoIHVuaXRfb25fcmVwbHEoc3ZjKSApOwogCkBAIC02MjIsNyArNjIyLDcgQEAgcmVwbHFf
cmVpbnNlcnQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgcnRfdW5pdCAqc3Zj
KQogICAgIHsKICAgICAgICAgZGVhZGxpbmVfcmVwbHFfaW5zZXJ0KHN2YywgJnN2Yy0+cmVwbHFf
ZWxlbSwgcmVwbHEpOwogICAgICAgICByZWFybV9zdmMgPSByZXBscV9lbGVtKHJlcGxxLT5uZXh0
KTsKLSAgICAgICAgcmVhcm0gPSAxOworICAgICAgICByZWFybSA9IHRydWU7CiAgICAgfQogICAg
IGVsc2UKICAgICAgICAgcmVhcm0gPSBkZWFkbGluZV9yZXBscV9pbnNlcnQoc3ZjLCAmc3ZjLT5y
ZXBscV9lbGVtLCByZXBscSk7CkBAIC0xMjc5LDcgKzEyNzksNyBAQCBydF91bml0X3dha2UoY29u
c3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIHsKICAg
ICBzdHJ1Y3QgcnRfdW5pdCAqIGNvbnN0IHN2YyA9IHJ0X3VuaXQodW5pdCk7CiAgICAgc190aW1l
X3Qgbm93OwotICAgIGJvb2xfdCBtaXNzZWQ7CisgICAgYm9vbCBtaXNzZWQ7CiAKICAgICBCVUdf
T04oIGlzX2lkbGVfdW5pdCh1bml0KSApOwogCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3NjaGVk
L3NjaGVkdWxlLmMgYi94ZW4vY29tbW9uL3NjaGVkL3NjaGVkdWxlLmMKaW5kZXggZGI4Y2UxNDZj
YS4uMzMwN2U4OGI2YyAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9zY2hlZC9zY2hlZHVsZS5jCisr
KyBiL3hlbi9jb21tb24vc2NoZWQvc2NoZWR1bGUuYwpAQCAtNTMsNyArNTMsNyBAQCBzdHJpbmdf
cGFyYW0oInNjaGVkIiwgb3B0X3NjaGVkKTsKICAqIHNjaGVkdWxlciB3aWxsIGdpdmUgcHJlZmVy
cmVuY2UgdG8gcGFydGlhbGx5IGlkbGUgcGFja2FnZSBjb21wYXJlZCB0bwogICogdGhlIGZ1bGwg
aWRsZSBwYWNrYWdlLCB3aGVuIHBpY2tpbmcgcENQVSB0byBzY2hlZHVsZSB2Q1BVLgogICovCi1i
b29sX3Qgc2NoZWRfc210X3Bvd2VyX3NhdmluZ3MgPSAwOworYm9vbCBzY2hlZF9zbXRfcG93ZXJf
c2F2aW5nczsKIGJvb2xlYW5fcGFyYW0oInNjaGVkX3NtdF9wb3dlcl9zYXZpbmdzIiwgc2NoZWRf
c210X3Bvd2VyX3NhdmluZ3MpOwogCiAvKiBEZWZhdWx0IHNjaGVkdWxpbmcgcmF0ZSBsaW1pdDog
MW1zCkBAIC01NzQsNyArNTc0LDcgQEAgaW50IHNjaGVkX2luaXRfdmNwdShzdHJ1Y3QgdmNwdSAq
dikKICAgICB7CiAgICAgICAgIGdldF9zY2hlZF9yZXModi0+cHJvY2Vzc29yKS0+Y3VyciA9IHVu
aXQ7CiAgICAgICAgIGdldF9zY2hlZF9yZXModi0+cHJvY2Vzc29yKS0+c2NoZWRfdW5pdF9pZGxl
ID0gdW5pdDsKLSAgICAgICAgdi0+aXNfcnVubmluZyA9IDE7CisgICAgICAgIHYtPmlzX3J1bm5p
bmcgPSB0cnVlOwogICAgICAgICB1bml0LT5pc19ydW5uaW5nID0gdHJ1ZTsKICAgICAgICAgdW5p
dC0+c3RhdGVfZW50cnlfdGltZSA9IE5PVygpOwogICAgIH0KQEAgLTk4Myw3ICs5ODMsNyBAQCBz
dGF0aWMgdm9pZCBzY2hlZF91bml0X21pZ3JhdGVfZmluaXNoKHN0cnVjdCBzY2hlZF91bml0ICp1
bml0KQogICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAgICAgdW5zaWduZWQgaW50IG9sZF9jcHUs
IG5ld19jcHU7CiAgICAgc3BpbmxvY2tfdCAqb2xkX2xvY2ssICpuZXdfbG9jazsKLSAgICBib29s
X3QgcGlja19jYWxsZWQgPSAwOworICAgIGJvb2wgcGlja19jYWxsZWQgPSBmYWxzZTsKICAgICBz
dHJ1Y3QgdmNwdSAqdjsKIAogICAgIC8qCkBAIC0xMDI5LDcgKzEwMjksNyBAQCBzdGF0aWMgdm9p
ZCBzY2hlZF91bml0X21pZ3JhdGVfZmluaXNoKHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogICAg
ICAgICAgICAgaWYgKCAobmV3X2xvY2sgPT0gZ2V0X3NjaGVkX3JlcyhuZXdfY3B1KS0+c2NoZWR1
bGVfbG9jaykgJiYKICAgICAgICAgICAgICAgICAgY3B1bWFza190ZXN0X2NwdShuZXdfY3B1LCB1
bml0LT5kb21haW4tPmNwdXBvb2wtPmNwdV92YWxpZCkgKQogICAgICAgICAgICAgICAgIGJyZWFr
OwotICAgICAgICAgICAgcGlja19jYWxsZWQgPSAxOworICAgICAgICAgICAgcGlja19jYWxsZWQg
PSB0cnVlOwogICAgICAgICB9CiAgICAgICAgIGVsc2UKICAgICAgICAgewpAQCAtMTAzNyw3ICsx
MDM3LDcgQEAgc3RhdGljIHZvaWQgc2NoZWRfdW5pdF9taWdyYXRlX2ZpbmlzaChzdHJ1Y3Qgc2No
ZWRfdW5pdCAqdW5pdCkKICAgICAgICAgICAgICAqIFdlIGRvIG5vdCBob2xkIHRoZSBzY2hlZHVs
ZXIgbG9jayBhcHByb3ByaWF0ZSBmb3IgdGhpcyB2Q1BVLgogICAgICAgICAgICAgICogVGh1cyB3
ZSBjYW5ub3Qgc2VsZWN0IGEgbmV3IENQVSBvbiB0aGlzIGl0ZXJhdGlvbi4gVHJ5IGFnYWluLgog
ICAgICAgICAgICAgICovCi0gICAgICAgICAgICBwaWNrX2NhbGxlZCA9IDA7CisgICAgICAgICAg
ICBwaWNrX2NhbGxlZCA9IGZhbHNlOwogICAgICAgICB9CiAKICAgICAgICAgc2NoZWRfc3Bpbl91
bmxvY2tfZG91YmxlKG9sZF9sb2NrLCBuZXdfbG9jaywgZmxhZ3MpOwpAQCAtMjE0OCw3ICsyMTQ4
LDcgQEAgc3RhdGljIHZvaWQgc2NoZWRfc3dpdGNoX3VuaXRzKHN0cnVjdCBzY2hlZF9yZXNvdXJj
ZSAqc3IsCiAgICAgICAgICAgICB2Y3B1X3J1bnN0YXRlX2NoYW5nZSh2bmV4dCwgdm5leHQtPm5l
d19zdGF0ZSwgbm93KTsKICAgICAgICAgfQogCi0gICAgICAgIHZuZXh0LT5pc19ydW5uaW5nID0g
MTsKKyAgICAgICAgdm5leHQtPmlzX3J1bm5pbmcgPSB0cnVlOwogCiAgICAgICAgIGlmICggaXNf
aWRsZV92Y3B1KHZuZXh0KSApCiAgICAgICAgICAgICB2bmV4dC0+c2NoZWRfdW5pdCA9IG5leHQ7
CkBAIC0yMjE5LDcgKzIyMTksNyBAQCBzdGF0aWMgdm9pZCB2Y3B1X2NvbnRleHRfc2F2ZWQoc3Ry
dWN0IHZjcHUgKnZwcmV2LCBzdHJ1Y3QgdmNwdSAqdm5leHQpCiAgICAgc21wX3dtYigpOwogCiAg
ICAgaWYgKCB2cHJldiAhPSB2bmV4dCApCi0gICAgICAgIHZwcmV2LT5pc19ydW5uaW5nID0gMDsK
KyAgICAgICAgdnByZXYtPmlzX3J1bm5pbmcgPSBmYWxzZTsKIH0KIAogc3RhdGljIHZvaWQgdW5p
dF9jb250ZXh0X3NhdmVkKHN0cnVjdCBzY2hlZF9yZXNvdXJjZSAqc3IpCmRpZmYgLS1naXQgYS94
ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaCBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCmluZGV4IDU1
MzM1ZDZhYjMuLmIyZjQ4YTM1MTIgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5o
CisrKyBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCkBAIC01NTcsMTggKzU1NywxOCBAQCBzdGF0
aWMgaW5saW5lIGJvb2wgaXNfc3lzdGVtX2RvbWFpbihjb25zdCBzdHJ1Y3QgZG9tYWluICpkKQog
ICogVXNlIHRoaXMgd2hlbiB5b3UgZG9uJ3QgaGF2ZSBhbiBleGlzdGluZyByZWZlcmVuY2UgdG8g
QGQuIEl0IHJldHVybnMKICAqIEZBTFNFIGlmIEBkIGlzIGJlaW5nIGRlc3Ryb3llZC4KICAqLwot
c3RhdGljIGFsd2F5c19pbmxpbmUgaW50IGdldF9kb21haW4oc3RydWN0IGRvbWFpbiAqZCkKK3N0
YXRpYyBhbHdheXNfaW5saW5lIGJvb2wgZ2V0X2RvbWFpbihzdHJ1Y3QgZG9tYWluICpkKQogewog
ICAgIGludCBvbGQsIHNlZW4gPSBhdG9taWNfcmVhZCgmZC0+cmVmY250KTsKICAgICBkbwogICAg
IHsKICAgICAgICAgb2xkID0gc2VlbjsKICAgICAgICAgaWYgKCB1bmxpa2VseShvbGQgJiBET01B
SU5fREVTVFJPWUVEKSApCi0gICAgICAgICAgICByZXR1cm4gMDsKKyAgICAgICAgICAgIHJldHVy
biBmYWxzZTsKICAgICAgICAgc2VlbiA9IGF0b21pY19jbXB4Y2hnKCZkLT5yZWZjbnQsIG9sZCwg
b2xkICsgMSk7CiAgICAgfQogICAgIHdoaWxlICggdW5saWtlbHkoc2VlbiAhPSBvbGQpICk7Ci0g
ICAgcmV0dXJuIDE7CisgICAgcmV0dXJuIHRydWU7CiB9CiAKIC8qCi0tIAoyLjE2LjQKCgpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFp
bGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhl
bnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

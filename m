Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id C319987D98
	for <lists+xen-devel@lfdr.de>; Fri,  9 Aug 2019 17:03:34 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hw6M1-0006ZU-FM; Fri, 09 Aug 2019 14:58:53 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=yG4W=WF=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1hw6Ly-0006Um-Dc
 for xen-devel@lists.xenproject.org; Fri, 09 Aug 2019 14:58:50 +0000
X-Inumbo-ID: 2e9834bc-bab6-11e9-94d9-0bc1dfb3a158
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 2e9834bc-bab6-11e9-94d9-0bc1dfb3a158;
 Fri, 09 Aug 2019 14:58:44 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id AC5A7B087;
 Fri,  9 Aug 2019 14:58:42 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Fri,  9 Aug 2019 16:57:58 +0200
Message-Id: <20190809145833.1020-14-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190809145833.1020-1-jgross@suse.com>
References: <20190809145833.1020-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v2 13/48] xen/sched: add is_running indicator to
 struct sched_unit
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Tim Deegan <tim@xen.org>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Dario Faggioli <dfaggioli@suse.com>,
 Julien Grall <julien.grall@arm.com>, Meng Xu <mengxu@cis.upenn.edu>,
 Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

QWRkIGFuIGlzX3J1bm5pbmcgaW5kaWNhdG9yIHRvIHN0cnVjdCBzY2hlZF91bml0IHdoaWNoIHdp
bGwgYmUgc2V0CndoZW5ldmVyIHRoZSB1bml0IGlzIGJlaW5nIHNjaGVkdWxlZC4gU3dpdGNoIHNj
aGVkdWxlciBjb2RlIHRvIHVzZQp1bml0LT5pc19ydW5uaW5nIGluc3RlYWQgb2YgdmNwdS0+aXNf
cnVubmluZyBmb3Igc2NoZWR1bGluZyBkZWNpc2lvbnMuCgpBdCB0aGUgc2FtZSB0aW1lIGludHJv
ZHVjZSBhIHN0YXRlX2VudHJ5X3RpbWUgZmllbGQgaW4gc3RydWN0CnNjaGVkX3VuaXQgYmVpbmcg
dXBkYXRlZCB3aGVuZXZlciB0aGUgaXNfcnVubmluZyBpbmRpY2F0b3IgaXMgY2hhbmdlZC4KVXNl
IHRoYXQgbmV3IGZpZWxkIGluIHRoZSBzY2hlZHVsZXJzIGluc3RlYWQgb2YgdGhlIHNpbWlsYXIg
dmNwdSBmaWVsZC4KClNpZ25lZC1vZmYtYnk6IEp1ZXJnZW4gR3Jvc3MgPGpncm9zc0BzdXNlLmNv
bT4KLS0tClJGQyBWMjogZml4IGFybSBidWlsZCwgZG9uJ3QgZHJvcCB2LT5pc19ydW5uaW5nCi0t
LQogeGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQuYyAgfCAxMiArKysrKysrLS0tLS0KIHhlbi9jb21t
b24vc2NoZWRfY3JlZGl0Mi5jIHwgMTggKysrKysrKysrLS0tLS0tLS0tCiB4ZW4vY29tbW9uL3Nj
aGVkX3J0LmMgICAgICB8ICAyICstCiB4ZW4vY29tbW9uL3NjaGVkdWxlLmMgICAgICB8IDE1ICsr
KysrKysrKysrLS0tLQogeGVuL2luY2x1ZGUveGVuL3NjaGVkLmggICAgfCAgNSArKysrKwogNSBm
aWxlcyBjaGFuZ2VkLCAzMyBpbnNlcnRpb25zKCspLCAxOSBkZWxldGlvbnMoLSkKCmRpZmYgLS1n
aXQgYS94ZW4vY29tbW9uL3NjaGVkX2NyZWRpdC5jIGIveGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQu
YwppbmRleCAzMzk3MDJmM2VjLi4xNDNjNzU0M2U4IDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL3Nj
aGVkX2NyZWRpdC5jCisrKyBiL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0LmMKQEAgLTcwOSw3ICs3
MDksNyBAQCBfX2NzY2hlZF92Y3B1X2lzX21pZ3JhdGVhYmxlKGNvbnN0IHN0cnVjdCBjc2NoZWRf
cHJpdmF0ZSAqcHJ2LCBzdHJ1Y3QgdmNwdSAqdmMsCiAgICAgICogVGhlIGNhbGxlciBpcyBzdXBw
b3NlZCB0byBoYXZlIGFscmVhZHkgY2hlY2tlZCB0aGF0IHZjIGlzIGFsc28KICAgICAgKiBub3Qg
cnVubmluZy4KICAgICAgKi8KLSAgICBBU1NFUlQoIXZjLT5pc19ydW5uaW5nKTsKKyAgICBBU1NF
UlQoIXZjLT5zY2hlZF91bml0LT5pc19ydW5uaW5nKTsKIAogICAgIHJldHVybiAhX19jc2NoZWRf
dmNwdV9pc19jYWNoZV9ob3QocHJ2LCBzdmMpICYmCiAgICAgICAgICAgIGNwdW1hc2tfdGVzdF9j
cHUoZGVzdF9jcHUsIG1hc2spOwpAQCAtMTAzMyw3ICsxMDMzLDggQEAgY3NjaGVkX3VuaXRfaW5z
ZXJ0KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQp
CiAKICAgICBsb2NrID0gdW5pdF9zY2hlZHVsZV9sb2NrX2lycSh1bml0KTsKIAotICAgIGlmICgg
IV9fdmNwdV9vbl9ydW5xKHN2YykgJiYgdmNwdV9ydW5uYWJsZSh2YykgJiYgIXZjLT5pc19ydW5u
aW5nICkKKyAgICBpZiAoICFfX3ZjcHVfb25fcnVucShzdmMpICYmIHZjcHVfcnVubmFibGUodmMp
ICYmCisgICAgICAgICAhdmMtPnNjaGVkX3VuaXQtPmlzX3J1bm5pbmcgKQogICAgICAgICBydW5x
X2luc2VydChzdmMpOwogCiAgICAgdW5pdF9zY2hlZHVsZV91bmxvY2tfaXJxKGxvY2ssIHVuaXQp
OwpAQCAtMTY0Niw4ICsxNjQ3LDkgQEAgY3NjaGVkX3J1bnFfc3RlYWwoaW50IHBlZXJfY3B1LCBp
bnQgY3B1LCBpbnQgcHJpLCBpbnQgYmFsYW5jZV9zdGVwKQogICAgICAgICAgKiB2Q1BVcyB3aXRo
IHVzZWZ1bCBzb2Z0IGFmZmluaXRpZXMgaW4gc29tZSBzb3J0IG9mIGJpdG1hcAogICAgICAgICAg
KiBvciBjb3VudGVyLgogICAgICAgICAgKi8KLSAgICAgICAgaWYgKCB2Yy0+aXNfcnVubmluZyB8
fCAoYmFsYW5jZV9zdGVwID09IEJBTEFOQ0VfU09GVF9BRkZJTklUWSAmJgotICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAhaGFzX3NvZnRfYWZmaW5pdHkodmMtPnNjaGVkX3VuaXQpKSAp
CisgICAgICAgIGlmICggdmMtPnNjaGVkX3VuaXQtPmlzX3J1bm5pbmcgfHwKKyAgICAgICAgICAg
ICAoYmFsYW5jZV9zdGVwID09IEJBTEFOQ0VfU09GVF9BRkZJTklUWSAmJgorICAgICAgICAgICAg
ICAhaGFzX3NvZnRfYWZmaW5pdHkodmMtPnNjaGVkX3VuaXQpKSApCiAgICAgICAgICAgICBjb250
aW51ZTsKIAogICAgICAgICBhZmZpbml0eV9iYWxhbmNlX2NwdW1hc2sodmMtPnNjaGVkX3VuaXQs
IGJhbGFuY2Vfc3RlcCwgY3B1bWFza19zY3JhdGNoKTsKQEAgLTE4NTUsNyArMTg1Nyw3IEBAIGNz
Y2hlZF9zY2hlZHVsZSgKICAgICAgICAgICAgICAgICAgICAgKHVuc2lnbmVkIGNoYXIgKikmZCk7
CiAgICAgfQogCi0gICAgcnVudGltZSA9IG5vdyAtIGN1cnJlbnQtPnJ1bnN0YXRlLnN0YXRlX2Vu
dHJ5X3RpbWU7CisgICAgcnVudGltZSA9IG5vdyAtIGN1cnJlbnQtPnNjaGVkX3VuaXQtPnN0YXRl
X2VudHJ5X3RpbWU7CiAgICAgaWYgKCBydW50aW1lIDwgMCApIC8qIERvZXMgdGhpcyBldmVyIGhh
cHBlbj8gKi8KICAgICAgICAgcnVudGltZSA9IDA7CiAKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24v
c2NoZWRfY3JlZGl0Mi5jIGIveGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQyLmMKaW5kZXggZWQ4MzM4
MWRkYi4uNTQ4N2QwODdlMSAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQyLmMK
KysrIGIveGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQyLmMKQEAgLTEyODQsNyArMTI4NCw3IEBAIHJ1
bnFfaW5zZXJ0KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IGNzY2hlZDJfdW5p
dCAqc3ZjKQogCiAgICAgQVNTRVJUKCZzdmMtPnJxZC0+cnVucSA9PSBydW5xKTsKICAgICBBU1NF
UlQoIWlzX2lkbGVfdmNwdShzdmMtPnZjcHUpKTsKLSAgICBBU1NFUlQoIXN2Yy0+dmNwdS0+aXNf
cnVubmluZyk7CisgICAgQVNTRVJUKCFzdmMtPnZjcHUtPnNjaGVkX3VuaXQtPmlzX3J1bm5pbmcp
OwogICAgIEFTU0VSVCghKHN2Yy0+ZmxhZ3MgJiBDU0ZMQUdfc2NoZWR1bGVkKSk7CiAKICAgICBs
aXN0X2Zvcl9lYWNoKCBpdGVyLCBydW5xICkKQEAgLTEzNDEsOCArMTM0MSw4IEBAIHN0YXRpYyBp
bmxpbmUgYm9vbCBpc19wcmVlbXB0YWJsZShjb25zdCBzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMs
CiAgICAgaWYgKCByYXRlbGltaXQgPD0gQ1NDSEVEMl9SQVRFTElNSVRfVElDS0xFX1RPTEVSQU5D
RSApCiAgICAgICAgIHJldHVybiB0cnVlOwogCi0gICAgQVNTRVJUKHN2Yy0+dmNwdS0+aXNfcnVu
bmluZyk7Ci0gICAgcmV0dXJuIG5vdyAtIHN2Yy0+dmNwdS0+cnVuc3RhdGUuc3RhdGVfZW50cnlf
dGltZSA+CisgICAgQVNTRVJUKHN2Yy0+dmNwdS0+c2NoZWRfdW5pdC0+aXNfcnVubmluZyk7Cisg
ICAgcmV0dXJuIG5vdyAtIHN2Yy0+dmNwdS0+c2NoZWRfdW5pdC0+c3RhdGVfZW50cnlfdGltZSA+
CiAgICAgICAgICAgIHJhdGVsaW1pdCAtIENTQ0hFRDJfUkFURUxJTUlUX1RJQ0tMRV9UT0xFUkFO
Q0U7CiB9CiAKQEAgLTI5MzIsNyArMjkzMiw3IEBAIGNzY2hlZDJfZG9tX2NudGwoCiAgICAgICAg
ICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICBzdmMgPSBjc2NoZWQyX3VuaXQodi0+c2No
ZWRfdW5pdCk7CiAgICAgICAgICAgICAgICAgICAgIGxvY2sgPSB1bml0X3NjaGVkdWxlX2xvY2so
c3ZjLT52Y3B1LT5zY2hlZF91bml0KTsKLSAgICAgICAgICAgICAgICAgICAgaWYgKCB2LT5pc19y
dW5uaW5nICkKKyAgICAgICAgICAgICAgICAgICAgaWYgKCB2LT5zY2hlZF91bml0LT5pc19ydW5u
aW5nICkKICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgdW5z
aWduZWQgaW50IGNwdSA9IHYtPnByb2Nlc3NvcjsKICAgICAgICAgICAgICAgICAgICAgICAgIHN0
cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCA9IGMycnFkKG9wcywgY3B1KTsKQEAgLTMy
MDUsOCArMzIwNSw4IEBAIGNzY2hlZDJfcnVudGltZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpv
cHMsIGludCBjcHUsCiAgICAgaWYgKCBwcnYtPnJhdGVsaW1pdF91cyApCiAgICAgewogICAgICAg
ICBzX3RpbWVfdCByYXRlbGltaXRfbWluID0gTUlDUk9TRUNTKHBydi0+cmF0ZWxpbWl0X3VzKTsK
LSAgICAgICAgaWYgKCBzbmV4dC0+dmNwdS0+aXNfcnVubmluZyApCi0gICAgICAgICAgICByYXRl
bGltaXRfbWluID0gc25leHQtPnZjcHUtPnJ1bnN0YXRlLnN0YXRlX2VudHJ5X3RpbWUgKworICAg
ICAgICBpZiAoIHNuZXh0LT52Y3B1LT5zY2hlZF91bml0LT5pc19ydW5uaW5nICkKKyAgICAgICAg
ICAgIHJhdGVsaW1pdF9taW4gPSBzbmV4dC0+dmNwdS0+c2NoZWRfdW5pdC0+c3RhdGVfZW50cnlf
dGltZSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTUlDUk9TRUNTKHBydi0+cmF0ZWxp
bWl0X3VzKSAtIG5vdzsKICAgICAgICAgaWYgKCByYXRlbGltaXRfbWluID4gbWluX3RpbWUgKQog
ICAgICAgICAgICAgbWluX3RpbWUgPSByYXRlbGltaXRfbWluOwpAQCAtMzMwMyw3ICszMzAzLDcg
QEAgcnVucV9jYW5kaWRhdGUoc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFkLAogICAg
ICAqIG5vIHBvaW50IGZvcmNpbmcgaXQgdG8gZG8gc28gdW50aWwgcmF0ZSBsaW1pdGluZyBleHBp
cmVzLgogICAgICAqLwogICAgIGlmICggIXlpZWxkICYmIHBydi0+cmF0ZWxpbWl0X3VzICYmIHZj
cHVfcnVubmFibGUoc2N1cnItPnZjcHUpICYmCi0gICAgICAgICAobm93IC0gc2N1cnItPnZjcHUt
PnJ1bnN0YXRlLnN0YXRlX2VudHJ5X3RpbWUpIDwKKyAgICAgICAgIChub3cgLSBzY3Vyci0+dmNw
dS0+c2NoZWRfdW5pdC0+c3RhdGVfZW50cnlfdGltZSkgPAogICAgICAgICAgIE1JQ1JPU0VDUyhw
cnYtPnJhdGVsaW1pdF91cykgKQogICAgIHsKICAgICAgICAgaWYgKCB1bmxpa2VseSh0Yl9pbml0
X2RvbmUpICkKQEAgLTMzMTQsNyArMzMxNCw3IEBAIHJ1bnFfY2FuZGlkYXRlKHN0cnVjdCBjc2No
ZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCwKICAgICAgICAgICAgIH0gZDsKICAgICAgICAgICAgIGQu
ZG9tID0gc2N1cnItPnZjcHUtPmRvbWFpbi0+ZG9tYWluX2lkOwogICAgICAgICAgICAgZC52Y3B1
ID0gc2N1cnItPnZjcHUtPnZjcHVfaWQ7Ci0gICAgICAgICAgICBkLnJ1bnRpbWUgPSBub3cgLSBz
Y3Vyci0+dmNwdS0+cnVuc3RhdGUuc3RhdGVfZW50cnlfdGltZTsKKyAgICAgICAgICAgIGQucnVu
dGltZSA9IG5vdyAtIHNjdXJyLT52Y3B1LT5zY2hlZF91bml0LT5zdGF0ZV9lbnRyeV90aW1lOwog
ICAgICAgICAgICAgX190cmFjZV92YXIoVFJDX0NTQ0hFRDJfUkFURUxJTUlULCAxLAogICAgICAg
ICAgICAgICAgICAgICAgICAgc2l6ZW9mKGQpLAogICAgICAgICAgICAgICAgICAgICAgICAgKHVu
c2lnbmVkIGNoYXIgKikmZCk7CkBAIC0zNTYyLDcgKzM1NjIsNyBAQCBjc2NoZWQyX3NjaGVkdWxl
KAogICAgICAgICBpZiAoIHNuZXh0ICE9IHNjdXJyICkKICAgICAgICAgewogICAgICAgICAgICAg
QVNTRVJUKHNuZXh0LT5ycWQgPT0gcnFkKTsKLSAgICAgICAgICAgIEFTU0VSVCghc25leHQtPnZj
cHUtPmlzX3J1bm5pbmcpOworICAgICAgICAgICAgQVNTRVJUKCFzbmV4dC0+dmNwdS0+c2NoZWRf
dW5pdC0+aXNfcnVubmluZyk7CiAKICAgICAgICAgICAgIHJ1bnFfcmVtb3ZlKHNuZXh0KTsKICAg
ICAgICAgICAgIF9fc2V0X2JpdChfX0NTRkxBR19zY2hlZHVsZWQsICZzbmV4dC0+ZmxhZ3MpOwpk
aWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZF9ydC5jIGIveGVuL2NvbW1vbi9zY2hlZF9ydC5j
CmluZGV4IGI2NjI5MjQ0ODMuLmRmMWE4NzRjOTcgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2No
ZWRfcnQuYworKysgYi94ZW4vY29tbW9uL3NjaGVkX3J0LmMKQEAgLTkwNiw3ICs5MDYsNyBAQCBy
dF91bml0X2luc2VydChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91
bml0ICp1bml0KQogICAgIHsKICAgICAgICAgcmVwbHFfaW5zZXJ0KG9wcywgc3ZjKTsKIAotICAg
ICAgICBpZiAoICF2Yy0+aXNfcnVubmluZyApCisgICAgICAgIGlmICggIXVuaXQtPmlzX3J1bm5p
bmcgKQogICAgICAgICAgICAgcnVucV9pbnNlcnQob3BzLCBzdmMpOwogICAgIH0KICAgICB1bml0
X3NjaGVkdWxlX3VubG9ja19pcnEobG9jaywgdW5pdCk7CmRpZmYgLS1naXQgYS94ZW4vY29tbW9u
L3NjaGVkdWxlLmMgYi94ZW4vY29tbW9uL3NjaGVkdWxlLmMKaW5kZXggOGNiYjYzMjBjNi4uMDMx
MTlhZjI1YyAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9zY2hlZHVsZS5jCisrKyBiL3hlbi9jb21t
b24vc2NoZWR1bGUuYwpAQCAtNDA3LDYgKzQwNyw4IEBAIGludCBzY2hlZF9pbml0X3ZjcHUoc3Ry
dWN0IHZjcHUgKnYsIHVuc2lnbmVkIGludCBwcm9jZXNzb3IpCiAgICAgewogICAgICAgICBnZXRf
c2NoZWRfcmVzKHYtPnByb2Nlc3NvciktPmN1cnIgPSB1bml0OwogICAgICAgICB2LT5pc19ydW5u
aW5nID0gMTsKKyAgICAgICAgdW5pdC0+aXNfcnVubmluZyA9IDE7CisgICAgICAgIHVuaXQtPnN0
YXRlX2VudHJ5X3RpbWUgPSBOT1coKTsKICAgICB9CiAgICAgZWxzZQogICAgIHsKQEAgLTcyNyw3
ICs3MjksOCBAQCBzdGF0aWMgdm9pZCB2Y3B1X21pZ3JhdGVfZmluaXNoKHN0cnVjdCB2Y3B1ICp2
KQogICAgICAqIGNvbnRleHRfc2F2ZWQoKTsgYW5kIGluIGFueSBjYXNlLCBpZiB0aGUgYml0IGlz
IGNsZWFyZWQsIHRoZW4KICAgICAgKiBzb21lb25lIGVsc2UgaGFzIGFscmVhZHkgZG9uZSB0aGUg
d29yayBzbyB3ZSBkb24ndCBuZWVkIHRvLgogICAgICAqLwotICAgIGlmICggdi0+aXNfcnVubmlu
ZyB8fCAhdGVzdF9iaXQoX1ZQRl9taWdyYXRpbmcsICZ2LT5wYXVzZV9mbGFncykgKQorICAgIGlm
ICggdi0+c2NoZWRfdW5pdC0+aXNfcnVubmluZyB8fAorICAgICAgICAgIXRlc3RfYml0KF9WUEZf
bWlncmF0aW5nLCAmdi0+cGF1c2VfZmxhZ3MpICkKICAgICAgICAgcmV0dXJuOwogCiAgICAgb2xk
X2NwdSA9IG5ld19jcHUgPSB2LT5wcm9jZXNzb3I7CkBAIC03ODEsNyArNzg0LDcgQEAgc3RhdGlj
IHZvaWQgdmNwdV9taWdyYXRlX2ZpbmlzaChzdHJ1Y3QgdmNwdSAqdikKICAgICAgKiBiZWNhdXNl
IHRoZXkgYm90aCBoYXBwZW4gaW4gKGRpZmZlcmVudCkgc3BpbmxvY2sgcmVnaW9ucywgYW5kIHRo
b3NlCiAgICAgICogcmVnaW9ucyBhcmUgc3RyaWN0bHkgc2VyaWFsaXNlZC4KICAgICAgKi8KLSAg
ICBpZiAoIHYtPmlzX3J1bm5pbmcgfHwKKyAgICBpZiAoIHYtPnNjaGVkX3VuaXQtPmlzX3J1bm5p
bmcgfHwKICAgICAgICAgICF0ZXN0X2FuZF9jbGVhcl9iaXQoX1ZQRl9taWdyYXRpbmcsICZ2LT5w
YXVzZV9mbGFncykgKQogICAgIHsKICAgICAgICAgc2NoZWRfc3Bpbl91bmxvY2tfZG91YmxlKG9s
ZF9sb2NrLCBuZXdfbG9jaywgZmxhZ3MpOwpAQCAtODA5LDcgKzgxMiw3IEBAIHZvaWQgdmNwdV9m
b3JjZV9yZXNjaGVkdWxlKHN0cnVjdCB2Y3B1ICp2KQogewogICAgIHNwaW5sb2NrX3QgKmxvY2sg
PSB1bml0X3NjaGVkdWxlX2xvY2tfaXJxKHYtPnNjaGVkX3VuaXQpOwogCi0gICAgaWYgKCB2LT5p
c19ydW5uaW5nICkKKyAgICBpZiAoIHYtPnNjaGVkX3VuaXQtPmlzX3J1bm5pbmcgKQogICAgICAg
ICB2Y3B1X21pZ3JhdGVfc3RhcnQodik7CiAKICAgICB1bml0X3NjaGVkdWxlX3VubG9ja19pcnEo
bG9jaywgdi0+c2NoZWRfdW5pdCk7CkBAIC0xNjYzLDggKzE2NjYsMTAgQEAgc3RhdGljIHZvaWQg
c2NoZWR1bGUodm9pZCkKICAgICAgKiBzd2l0Y2gsIGVsc2UgbG9zdF9yZWNvcmRzIHJlc3VtZSB3
aWxsIG5vdCB3b3JrIHByb3Blcmx5LgogICAgICAqLwogCi0gICAgQVNTRVJUKCFuZXh0LT5pc19y
dW5uaW5nKTsKKyAgICBBU1NFUlQoIW5leHQtPnNjaGVkX3VuaXQtPmlzX3J1bm5pbmcpOwogICAg
IG5leHQtPmlzX3J1bm5pbmcgPSAxOworICAgIG5leHQtPnNjaGVkX3VuaXQtPmlzX3J1bm5pbmcg
PSAxOworICAgIG5leHQtPnNjaGVkX3VuaXQtPnN0YXRlX2VudHJ5X3RpbWUgPSBub3c7CiAKICAg
ICBwY3B1X3NjaGVkdWxlX3VubG9ja19pcnEobG9jaywgY3B1KTsKIApAQCAtMTY4Niw2ICsxNjkx
LDggQEAgdm9pZCBjb250ZXh0X3NhdmVkKHN0cnVjdCB2Y3B1ICpwcmV2KQogICAgIHNtcF93bWIo
KTsKIAogICAgIHByZXYtPmlzX3J1bm5pbmcgPSAwOworICAgIHByZXYtPnNjaGVkX3VuaXQtPmlz
X3J1bm5pbmcgPSAwOworICAgIHByZXYtPnNjaGVkX3VuaXQtPnN0YXRlX2VudHJ5X3RpbWUgPSBO
T1coKTsKIAogICAgIC8qIENoZWNrIGZvciBtaWdyYXRpb24gcmVxdWVzdCAvYWZ0ZXIvIGNsZWFy
aW5nIHJ1bm5pbmcgZmxhZy4gKi8KICAgICBzbXBfbWIoKTsKZGlmZiAtLWdpdCBhL3hlbi9pbmNs
dWRlL3hlbi9zY2hlZC5oIGIveGVuL2luY2x1ZGUveGVuL3NjaGVkLmgKaW5kZXggZmEyZGJmNDdl
ZS4uZjUwNmMwY2JkNCAxMDA2NDQKLS0tIGEveGVuL2luY2x1ZGUveGVuL3NjaGVkLmgKKysrIGIv
eGVuL2luY2x1ZGUveGVuL3NjaGVkLmgKQEAgLTI3Miw2ICsyNzIsMTEgQEAgc3RydWN0IHNjaGVk
X3VuaXQgewogICAgIHN0cnVjdCBzY2hlZF9yZXNvdXJjZSAqcmVzOwogICAgIGludCAgICAgICAg
ICAgICAgICAgICAgdW5pdF9pZDsKIAorICAgIC8qIExhc3QgdGltZSB1bml0IGdvdCAoZGUtKXNj
aGVkdWxlZC4gKi8KKyAgICB1aW50NjRfdCAgICAgICAgICAgICAgIHN0YXRlX2VudHJ5X3RpbWU7
CisKKyAgICAvKiBDdXJyZW50bHkgcnVubmluZyBvbiBhIENQVT8gKi8KKyAgICBib29sICAgICAg
ICAgICAgICAgICAgIGlzX3J1bm5pbmc7CiAgICAgLyogRG9lcyBzb2Z0IGFmZmluaXR5IGFjdHVh
bGx5IHBsYXkgYSByb2xlIChnaXZlbiBoYXJkIGFmZmluaXR5KT8gKi8KICAgICBib29sICAgICAg
ICAgICAgICAgICAgIHNvZnRfYWZmX2VmZmVjdGl2ZTsKICAgICAvKiBCaXRtYXNrIG9mIENQVXMg
b24gd2hpY2ggdGhpcyBWQ1BVIG1heSBydW4uICovCi0tIAoyLjE2LjQKCgpfX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0
Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qu
b3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

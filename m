Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 278E42175A
	for <lists+xen-devel@lfdr.de>; Fri, 17 May 2019 12:56:07 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hRaUS-00079f-Uv; Fri, 17 May 2019 10:53:28 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=mYL4=TR=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1hRaUR-00079K-62
 for xen-devel@lists.xenproject.org; Fri, 17 May 2019 10:53:27 +0000
X-Inumbo-ID: fd992ce2-7891-11e9-bb02-53d9015f7d8a
Received: from prv1-mh.provo.novell.com (unknown [137.65.248.33])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id fd992ce2-7891-11e9-bb02-53d9015f7d8a;
 Fri, 17 May 2019 10:53:23 +0000 (UTC)
Received: from INET-PRV1-MTA by prv1-mh.provo.novell.com
 with Novell_GroupWise; Fri, 17 May 2019 04:53:22 -0600
Message-Id: <5CDE92A302000078002300F9@prv1-mh.provo.novell.com>
X-Mailer: Novell GroupWise Internet Agent 18.1.0 
Date: Fri, 17 May 2019 04:53:23 -0600
From: "Jan Beulich" <JBeulich@suse.com>
To: "xen-devel" <xen-devel@lists.xenproject.org>
References: <5CC6DD090200007800229E80@prv1-mh.provo.novell.com>
 <5CDE8F5B020000780023005F@prv1-mh.provo.novell.com>
In-Reply-To: <5CDE8F5B020000780023005F@prv1-mh.provo.novell.com>
Mime-Version: 1.0
Content-Disposition: inline
Subject: [Xen-devel] [PATCH v3 15/15] x86/IRQ: move {,_}clear_irq_vector()
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>, Wei Liu <wei.liu2@citrix.com>,
 Roger Pau Monne <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhpcyBpcyBsYXJnZWx5IHRvIGRyb3AgYSBmb3J3YXJkIGRlY2xhcmF0aW9uLiBUaGVyZSdzIG9u
ZSBmdW5jdGlvbmFsCmNoYW5nZSAtIGNsZWFyX2lycV92ZWN0b3IoKSBnZXRzIG1hcmtlZCBfX2lu
aXQsIGFzIGl0cyBvbmx5IGNhbGxlciBpcwpjaGVja190aW1lcigpLiBCZXlvbmQgdGhpcyBvbmx5
IGEgZmV3IHN0cmF5IGJsYW5rcyBnZXQgcmVtb3ZlZC4KClNpZ25lZC1vZmYtYnk6IEphbiBCZXVs
aWNoIDxqYmV1bGljaEBzdXNlLmNvbT4KLS0tCnYzOiBOZXcuCgotLS0gYS94ZW4vYXJjaC94ODYv
aXJxLmMKKysrIGIveGVuL2FyY2gveDg2L2lycS5jCkBAIC0yNyw3ICsyNyw2IEBACiAjaW5jbHVk
ZSA8cHVibGljL3BoeXNkZXYuaD4KIAogc3RhdGljIGludCBwYXJzZV9pcnFfdmVjdG9yX21hcF9w
YXJhbShjb25zdCBjaGFyICpzKTsKLXN0YXRpYyB2b2lkIF9jbGVhcl9pcnFfdmVjdG9yKHN0cnVj
dCBpcnFfZGVzYyAqZGVzYyk7CiAKIC8qIG9wdF9ub2lycWJhbGFuY2U6IElmIHRydWUsIHNvZnR3
YXJlIElSUSBiYWxhbmNpbmcvYWZmaW5pdHkgaXMgZGlzYWJsZWQuICovCiBib29sIF9fcmVhZF9t
b3N0bHkgb3B0X25vaXJxYmFsYW5jZTsKQEAgLTE5MSw2ICsxOTAsNjcgQEAgaW50IF9faW5pdCBi
aW5kX2lycV92ZWN0b3IoaW50IGlycSwgaW50CiAgICAgcmV0dXJuIHJldDsKIH0KIAorc3RhdGlj
IHZvaWQgX2NsZWFyX2lycV92ZWN0b3Ioc3RydWN0IGlycV9kZXNjICpkZXNjKQoreworICAgIHVu
c2lnbmVkIGludCBjcHUsIG9sZF92ZWN0b3IsIGlycSA9IGRlc2MtPmlycTsKKyAgICB1bnNpZ25l
ZCBpbnQgdmVjdG9yID0gZGVzYy0+YXJjaC52ZWN0b3I7CisgICAgY3B1bWFza190ICp0bXBfbWFz
ayA9IHRoaXNfY3B1KHNjcmF0Y2hfY3B1bWFzayk7CisKKyAgICBCVUdfT04oIXZhbGlkX2lycV92
ZWN0b3IodmVjdG9yKSk7CisKKyAgICAvKiBBbHdheXMgY2xlYXIgZGVzYy0+YXJjaC52ZWN0b3Ig
Ki8KKyAgICBjcHVtYXNrX2FuZCh0bXBfbWFzaywgZGVzYy0+YXJjaC5jcHVfbWFzaywgJmNwdV9v
bmxpbmVfbWFwKTsKKworICAgIGZvcl9lYWNoX2NwdShjcHUsIHRtcF9tYXNrKQorICAgIHsKKyAg
ICAgICAgQVNTRVJUKHBlcl9jcHUodmVjdG9yX2lycSwgY3B1KVt2ZWN0b3JdID09IGlycSk7Cisg
ICAgICAgIHBlcl9jcHUodmVjdG9yX2lycSwgY3B1KVt2ZWN0b3JdID0gfmlycTsKKyAgICB9CisK
KyAgICBkZXNjLT5hcmNoLnZlY3RvciA9IElSUV9WRUNUT1JfVU5BU1NJR05FRDsKKyAgICBjcHVt
YXNrX2NsZWFyKGRlc2MtPmFyY2guY3B1X21hc2spOworCisgICAgaWYgKCBkZXNjLT5hcmNoLnVz
ZWRfdmVjdG9ycyApCisgICAgeworICAgICAgICBBU1NFUlQodGVzdF9iaXQodmVjdG9yLCBkZXNj
LT5hcmNoLnVzZWRfdmVjdG9ycykpOworICAgICAgICBjbGVhcl9iaXQodmVjdG9yLCBkZXNjLT5h
cmNoLnVzZWRfdmVjdG9ycyk7CisgICAgfQorCisgICAgZGVzYy0+YXJjaC51c2VkID0gSVJRX1VO
VVNFRDsKKworICAgIHRyYWNlX2lycV9tYXNrKFRSQ19IV19JUlFfQ0xFQVJfVkVDVE9SLCBpcnEs
IHZlY3RvciwgdG1wX21hc2spOworCisgICAgaWYgKCBsaWtlbHkoIWRlc2MtPmFyY2gubW92ZV9p
bl9wcm9ncmVzcykgKQorICAgICAgICByZXR1cm47CisKKyAgICAvKiBJZiB3ZSB3ZXJlIGluIG1v
dGlvbiwgYWxzbyBjbGVhciBkZXNjLT5hcmNoLm9sZF92ZWN0b3IgKi8KKyAgICBvbGRfdmVjdG9y
ID0gZGVzYy0+YXJjaC5vbGRfdmVjdG9yOworICAgIGNwdW1hc2tfYW5kKHRtcF9tYXNrLCBkZXNj
LT5hcmNoLm9sZF9jcHVfbWFzaywgJmNwdV9vbmxpbmVfbWFwKTsKKworICAgIGZvcl9lYWNoX2Nw
dShjcHUsIHRtcF9tYXNrKQorICAgIHsKKyAgICAgICAgQVNTRVJUKHBlcl9jcHUodmVjdG9yX2ly
cSwgY3B1KVtvbGRfdmVjdG9yXSA9PSBpcnEpOworICAgICAgICBUUkFDRV8zRChUUkNfSFdfSVJR
X01PVkVfRklOSVNILCBpcnEsIG9sZF92ZWN0b3IsIGNwdSk7CisgICAgICAgIHBlcl9jcHUodmVj
dG9yX2lycSwgY3B1KVtvbGRfdmVjdG9yXSA9IH5pcnE7CisgICAgfQorCisgICAgcmVsZWFzZV9v
bGRfdmVjKGRlc2MpOworCisgICAgZGVzYy0+YXJjaC5tb3ZlX2luX3Byb2dyZXNzID0gMDsKK30K
Kwordm9pZCBfX2luaXQgY2xlYXJfaXJxX3ZlY3RvcihpbnQgaXJxKQoreworICAgIHN0cnVjdCBp
cnFfZGVzYyAqZGVzYyA9IGlycV90b19kZXNjKGlycSk7CisgICAgdW5zaWduZWQgbG9uZyBmbGFn
czsKKworICAgIHNwaW5fbG9ja19pcnFzYXZlKCZkZXNjLT5sb2NrLCBmbGFncyk7CisgICAgc3Bp
bl9sb2NrKCZ2ZWN0b3JfbG9jayk7CisgICAgX2NsZWFyX2lycV92ZWN0b3IoZGVzYyk7CisgICAg
c3Bpbl91bmxvY2soJnZlY3Rvcl9sb2NrKTsKKyAgICBzcGluX3VubG9ja19pcnFyZXN0b3JlKCZk
ZXNjLT5sb2NrLCBmbGFncyk7Cit9CisKIC8qCiAgKiBEeW5hbWljIGlycSBhbGxvY2F0ZSBhbmQg
ZGVhbGxvY2F0aW9uIGZvciBNU0kKICAqLwpAQCAtMjgxLDY3ICszNDEsNiBAQCB2b2lkIGRlc3Ry
b3lfaXJxKHVuc2lnbmVkIGludCBpcnEpCiAgICAgeGZyZWUoYWN0aW9uKTsKIH0KIAotc3RhdGlj
IHZvaWQgX2NsZWFyX2lycV92ZWN0b3Ioc3RydWN0IGlycV9kZXNjICpkZXNjKQotewotICAgIHVu
c2lnbmVkIGludCBjcHUsIG9sZF92ZWN0b3IsIGlycSA9IGRlc2MtPmlycTsKLSAgICB1bnNpZ25l
ZCBpbnQgdmVjdG9yID0gZGVzYy0+YXJjaC52ZWN0b3I7Ci0gICAgY3B1bWFza190ICp0bXBfbWFz
ayA9IHRoaXNfY3B1KHNjcmF0Y2hfY3B1bWFzayk7Ci0KLSAgICBCVUdfT04oIXZhbGlkX2lycV92
ZWN0b3IodmVjdG9yKSk7Ci0KLSAgICAvKiBBbHdheXMgY2xlYXIgZGVzYy0+YXJjaC52ZWN0b3Ig
Ki8KLSAgICBjcHVtYXNrX2FuZCh0bXBfbWFzaywgZGVzYy0+YXJjaC5jcHVfbWFzaywgJmNwdV9v
bmxpbmVfbWFwKTsKLQotICAgIGZvcl9lYWNoX2NwdShjcHUsIHRtcF9tYXNrKQotICAgIHsKLSAg
ICAgICAgQVNTRVJUKCBwZXJfY3B1KHZlY3Rvcl9pcnEsIGNwdSlbdmVjdG9yXSA9PSBpcnEgKTsK
LSAgICAgICAgcGVyX2NwdSh2ZWN0b3JfaXJxLCBjcHUpW3ZlY3Rvcl0gPSB+aXJxOwotICAgIH0K
LQotICAgIGRlc2MtPmFyY2gudmVjdG9yID0gSVJRX1ZFQ1RPUl9VTkFTU0lHTkVEOwotICAgIGNw
dW1hc2tfY2xlYXIoZGVzYy0+YXJjaC5jcHVfbWFzayk7Ci0KLSAgICBpZiAoIGRlc2MtPmFyY2gu
dXNlZF92ZWN0b3JzICkKLSAgICB7Ci0gICAgICAgIEFTU0VSVCh0ZXN0X2JpdCh2ZWN0b3IsIGRl
c2MtPmFyY2gudXNlZF92ZWN0b3JzKSk7Ci0gICAgICAgIGNsZWFyX2JpdCh2ZWN0b3IsIGRlc2Mt
PmFyY2gudXNlZF92ZWN0b3JzKTsKLSAgICB9Ci0KLSAgICBkZXNjLT5hcmNoLnVzZWQgPSBJUlFf
VU5VU0VEOwotCi0gICAgdHJhY2VfaXJxX21hc2soVFJDX0hXX0lSUV9DTEVBUl9WRUNUT1IsIGly
cSwgdmVjdG9yLCB0bXBfbWFzayk7Ci0KLSAgICBpZiAoIGxpa2VseSghZGVzYy0+YXJjaC5tb3Zl
X2luX3Byb2dyZXNzKSApCi0gICAgICAgIHJldHVybjsKLQotICAgIC8qIElmIHdlIHdlcmUgaW4g
bW90aW9uLCBhbHNvIGNsZWFyIGRlc2MtPmFyY2gub2xkX3ZlY3RvciAqLwotICAgIG9sZF92ZWN0
b3IgPSBkZXNjLT5hcmNoLm9sZF92ZWN0b3I7Ci0gICAgY3B1bWFza19hbmQodG1wX21hc2ssIGRl
c2MtPmFyY2gub2xkX2NwdV9tYXNrLCAmY3B1X29ubGluZV9tYXApOwotCi0gICAgZm9yX2VhY2hf
Y3B1KGNwdSwgdG1wX21hc2spCi0gICAgewotICAgICAgICBBU1NFUlQoIHBlcl9jcHUodmVjdG9y
X2lycSwgY3B1KVtvbGRfdmVjdG9yXSA9PSBpcnEgKTsKLSAgICAgICAgVFJBQ0VfM0QoVFJDX0hX
X0lSUV9NT1ZFX0ZJTklTSCwgaXJxLCBvbGRfdmVjdG9yLCBjcHUpOwotICAgICAgICBwZXJfY3B1
KHZlY3Rvcl9pcnEsIGNwdSlbb2xkX3ZlY3Rvcl0gPSB+aXJxOwotICAgIH0KLQotICAgIHJlbGVh
c2Vfb2xkX3ZlYyhkZXNjKTsKLQotICAgIGRlc2MtPmFyY2gubW92ZV9pbl9wcm9ncmVzcyA9IDA7
Ci19Ci0KLXZvaWQgY2xlYXJfaXJxX3ZlY3RvcihpbnQgaXJxKQotewotICAgIHN0cnVjdCBpcnFf
ZGVzYyAqZGVzYyA9IGlycV90b19kZXNjKGlycSk7Ci0gICAgdW5zaWduZWQgbG9uZyBmbGFnczsK
LQotICAgIHNwaW5fbG9ja19pcnFzYXZlKCZkZXNjLT5sb2NrLCBmbGFncyk7Ci0gICAgc3Bpbl9s
b2NrKCZ2ZWN0b3JfbG9jayk7Ci0gICAgX2NsZWFyX2lycV92ZWN0b3IoZGVzYyk7Ci0gICAgc3Bp
bl91bmxvY2soJnZlY3Rvcl9sb2NrKTsKLSAgICBzcGluX3VubG9ja19pcnFyZXN0b3JlKCZkZXNj
LT5sb2NrLCBmbGFncyk7Ci19Ci0KIGludCBpcnFfdG9fdmVjdG9yKGludCBpcnEpCiB7CiAgICAg
aW50IHZlY3RvciA9IElSUV9WRUNUT1JfVU5BU1NJR05FRDsKCgoKCl9fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVu
LWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcv
bWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 02693AD3FD
	for <lists+xen-devel@lfdr.de>; Mon,  9 Sep 2019 09:38:51 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i7EDZ-00053w-MD; Mon, 09 Sep 2019 07:36:09 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=m/oR=XE=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1i7EDX-00053h-O1
 for xen-devel@lists.xenproject.org; Mon, 09 Sep 2019 07:36:07 +0000
X-Inumbo-ID: 77f88ba1-d2d4-11e9-ac08-12813bfff9fa
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 77f88ba1-d2d4-11e9-ac08-12813bfff9fa;
 Mon, 09 Sep 2019 07:36:01 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 59F34AE68;
 Mon,  9 Sep 2019 07:36:00 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Mon,  9 Sep 2019 09:35:56 +0200
Message-Id: <20190909073557.16168-5-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190909073557.16168-1-jgross@suse.com>
References: <20190909073557.16168-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v6 4/5] xen: add per-cpu buffer option to
 debugtrace
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

ZGVidWd0cmFjZSBpcyBub3JtYWxseSB3cml0aW5nIHRyYWNlIGVudHJpZXMgaW50byBhIHNpbmds
ZSB0cmFjZQpidWZmZXIuIFRoZXJlIGFyZSBjYXNlcyB3aGVyZSB0aGlzIGlzIG5vdCBvcHRpbWFs
LCBlLmcuIHdoZW4gaHVudGluZwphIGJ1ZyB3aGljaCByZXF1aXJlcyB3cml0aW5nIGxvdHMgb2Yg
dHJhY2UgZW50cmllcyBhbmQgb25lIGNwdSBpcwpzdHVjay4gVGhpcyB3aWxsIHJlc3VsdCBpbiBv
dGhlciBjcHVzIGZpbGxpbmcgdGhlIHRyYWNlIGJ1ZmZlciBhbmQKZmluYWxseSBvdmVyd3JpdGlu
ZyB0aGUgaW50ZXJlc3RpbmcgdHJhY2UgZW50cmllcyBvZiB0aGUgaGFuZ2luZyBjcHUuCgpJbiBv
cmRlciB0byBiZSBhYmxlIHRvIGRlYnVnIHN1Y2ggc2l0dWF0aW9ucyBhZGQgdGhlIGNhcGFiaWxp
dHkgdG8gdXNlCnBlci1jcHUgdHJhY2UgYnVmZmVycy4gVGhpcyBjYW4gYmUgc2VsZWN0ZWQgYnkg
c3BlY2lmeWluZyB0aGUKZGVidWd0cmFjZSBib290IHBhcmFtZXRlciB3aXRoIHRoZSBtb2RpZmll
ciAiY3B1OiIsIGxpa2U6CgogIGRlYnVndHJhY2U9Y3B1OjE2CgpBdCB0aGUgc2FtZSB0aW1lIHN3
aXRjaCB0aGUgcGFyc2luZyBmdW5jdGlvbiB0byBhY2NlcHQgc2l6ZSBtb2RpZmllcnMKKGUuZy4g
NE0gb3IgMUcpLgoKUHJpbnRpbmcgb3V0IHRoZSB0cmFjZSBlbnRyaWVzIGlzIGRvbmUgZm9yIGVh
Y2ggYnVmZmVyIGluIG9yZGVyIHRvCm1pbmltaXplIHRoZSBlZmZvcnQgbmVlZGVkIGR1cmluZyBw
cmludGluZy4gQXMgZWFjaCBlbnRyeSBpcyBwcmVmaXhlZAp3aXRoIGl0cyBzZXF1ZW5jZSBudW1i
ZXIgc29ydGluZyB0aGUgZW50cmllcyBjYW4gZWFzaWx5IGJlIGRvbmUgd2hlbgphbmFseXppbmcg
dGhlbS4KClNpZ25lZC1vZmYtYnk6IEp1ZXJnZW4gR3Jvc3MgPGpncm9zc0BzdXNlLmNvbT4KLS0t
ClYyOgotIG9ubHkgYWxsb2NhdGUgYnVmZmVyIGlmIG5vdCBhbHJlYWR5IGRvbmUgc28KVjQ6Ci0g
dW5zaWduZWQgaW50IC0+IHVuc2lnbmVkIGxvbmcgKEphbiBCZXVsaWNoKQotIHJlcGxhY2UgY2hl
Y2sgZm9yIGJ5dGVzIDwgUEFHRV9TSVpFIGJ5ICFieXRlcyAoSmFuIEJldWxpY2gpCi0gcHJpbnQg
aW5mbyB3aGljaCBidWZmZXIgYWxsb2NhdGlvbiBmYWlsZWQgKEphbiBCZXVsaWNoKQotIHJlcGxh
Y2Ugc3dpdGNoIGJ5IGlmIGluIGNwdSBub3RpZmllciBoYW5kbGVyIChKYW4gQmV1bGljaCkKVjU6
Ci0gZG9uJ3Qgc2lsZW50bHkgaWdub3JlIHRyYWlsaW5nIGNoYXJhY3RlcnMgd2hlbiBwYXJzaW5n
IGJ1ZmZlciBzaXplCiAgKEphbiBCZXVsaWNoKQotIGxpbWl0IHNjb3BlIG9mIHNvbWUgdmFyaWFi
bGVzIChKYW4gQmV1bGljaCkKLSBhZGp1c3QgZXJyb3IgbWVzc2FnZSBmb3JtYXQgKEphbiBCZXVs
aWNoKQpWNjoKLSBtb3ZlIGNhbGN1bGF0aW9uIG9mIGZpbmFsIGRlYnVndHJhY2VfYnl0ZXMgdmFs
dWUgdG8gcGFyYW1ldGVyIHBhcnNpbmcKLS0tCiBkb2NzL21pc2MveGVuLWNvbW1hbmQtbGluZS5w
YW5kb2MgfCAgIDcgKy0KIHhlbi9jb21tb24vZGVidWd0cmFjZS5jICAgICAgICAgICB8IDE1OCAr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLQogMiBmaWxlcyBjaGFuZ2VkLCAx
MjcgaW5zZXJ0aW9ucygrKSwgMzggZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZG9jcy9taXNj
L3hlbi1jb21tYW5kLWxpbmUucGFuZG9jIGIvZG9jcy9taXNjL3hlbi1jb21tYW5kLWxpbmUucGFu
ZG9jCmluZGV4IDdjNzJlMzEwMzIuLjgzMjc5N2UyZTIgMTAwNjQ0Ci0tLSBhL2RvY3MvbWlzYy94
ZW4tY29tbWFuZC1saW5lLnBhbmRvYworKysgYi9kb2NzL21pc2MveGVuLWNvbW1hbmQtbGluZS5w
YW5kb2MKQEAgLTY0NCwxMiArNjQ0LDEzIEBAIG92ZXIgdGhlIFBDSSBidXNzZXMgc2VxdWVudGlh
bGx5KSBvciBieSBQQ0kgZGV2aWNlIChtdXN0IGJlIG9uIHNlZ21lbnQgMCkuCiBMaW1pdHMgdGhl
IG51bWJlciBsaW5lcyBwcmludGVkIGluIFhlbiBzdGFjayB0cmFjZXMuCiAKICMjIyBkZWJ1Z3Ry
YWNlCi0+IGA9IDxpbnRlZ2VyPmAKKz4gYD0gW2NwdTpdPHNpemU+YAogCiA+IERlZmF1bHQ6IGAx
MjhgCiAKLVNwZWNpZnkgdGhlIHNpemUgb2YgdGhlIGNvbnNvbGUgZGVidWcgdHJhY2UgYnVmZmVy
IGluIEtpQi4gVGhlIGRlYnVnCi10cmFjZSBmZWF0dXJlIGlzIG9ubHkgZW5hYmxlZCBpbiBkZWJ1
Z2dpbmcgYnVpbGRzIG9mIFhlbi4KK1NwZWNpZnkgdGhlIHNpemUgb2YgdGhlIGNvbnNvbGUgZGVi
dWcgdHJhY2UgYnVmZmVyLiBCeSBzcGVjaWZ5aW5nIGBjcHU6YAorYWRkaXRpb25hbGx5IGEgdHJh
Y2UgYnVmZmVyIG9mIHRoZSBzcGVjaWZpZWQgc2l6ZSBpcyBhbGxvY2F0ZWQgcGVyIGNwdS4KK1Ro
ZSBkZWJ1ZyB0cmFjZSBmZWF0dXJlIGlzIG9ubHkgZW5hYmxlZCBpbiBkZWJ1Z2dpbmcgYnVpbGRz
IG9mIFhlbi4KIAogIyMjIGRtYV9iaXRzCiA+IGA9IDxpbnRlZ2VyPmAKZGlmZiAtLWdpdCBhL3hl
bi9jb21tb24vZGVidWd0cmFjZS5jIGIveGVuL2NvbW1vbi9kZWJ1Z3RyYWNlLmMKaW5kZXggNTFh
YjQxZjdhNy4uNjY5YjIxMDJhYiAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9kZWJ1Z3RyYWNlLmMK
KysrIGIveGVuL2NvbW1vbi9kZWJ1Z3RyYWNlLmMKQEAgLTYsNiArNiw3IEBACiAKIAogI2luY2x1
ZGUgPHhlbi9jb25zb2xlLmg+CisjaW5jbHVkZSA8eGVuL2NwdS5oPgogI2luY2x1ZGUgPHhlbi9p
bml0Lmg+CiAjaW5jbHVkZSA8eGVuL2tleWhhbmRsZXIuaD4KICNpbmNsdWRlIDx4ZW4vbGliLmg+
CkBAIC0yMywzNSArMjQsNzkgQEAgc3RydWN0IGRlYnVndHJhY2VfZGF0YSB7CiB9OwogCiBzdGF0
aWMgc3RydWN0IGRlYnVndHJhY2VfZGF0YSAqZHRfZGF0YTsKK3N0YXRpYyBERUZJTkVfUEVSX0NQ
VShzdHJ1Y3QgZGVidWd0cmFjZV9kYXRhICosIGR0X2NwdV9kYXRhKTsKIAotc3RhdGljIHVuc2ln
bmVkIGludCBkZWJ1Z3RyYWNlX2tpbG9ieXRlcyA9IDEyODsKLXN0YXRpYyB1bnNpZ25lZCBsb25n
IGRlYnVndHJhY2VfYnl0ZXM7CitzdGF0aWMgdW5zaWduZWQgbG9uZyBkZWJ1Z3RyYWNlX2J5dGVz
ID0gMTI4IDw8IDEwOworc3RhdGljIGJvb2wgZGVidWd0cmFjZV9wZXJfY3B1Owogc3RhdGljIGJv
b2wgZGVidWd0cmFjZV9idWZfZW1wdHk7CiBzdGF0aWMgYm9vbCBkZWJ1Z3RyYWNlX3VzZWQ7CiBz
dGF0aWMgREVGSU5FX1NQSU5MT0NLKGRlYnVndHJhY2VfbG9jayk7Ci1pbnRlZ2VyX3BhcmFtKCJk
ZWJ1Z3RyYWNlIiwgZGVidWd0cmFjZV9raWxvYnl0ZXMpOwogCi1zdGF0aWMgdm9pZCBkZWJ1Z3Ry
YWNlX2R1bXBfd29ya2VyKHZvaWQpCitzdGF0aWMgaW50IF9faW5pdCBkZWJ1Z3RyYWNlX3BhcnNl
X3BhcmFtKGNvbnN0IGNoYXIgKnMpCiB7Ci0gICAgaWYgKCAhZGVidWd0cmFjZV91c2VkICkKKyAg
ICB1bnNpZ25lZCBsb25nIGJ5dGVzOworCisgICAgaWYgKCAhc3RybmNtcChzLCAiY3B1OiIsIDQp
ICkKKyAgICB7CisgICAgICAgIGRlYnVndHJhY2VfcGVyX2NwdSA9IHRydWU7CisgICAgICAgIHMg
Kz0gNDsKKyAgICB9CisgICAgYnl0ZXMgPSBwYXJzZV9zaXplX2FuZF91bml0KHMsICZzKTsKKwor
ICAgIGlmICggKnMgKQorICAgICAgICByZXR1cm4gLUVJTlZBTDsKKworICAgIGRlYnVndHJhY2Vf
Ynl0ZXMgPSBNQVgoYnl0ZXMsIFBBR0VfU0laRSk7CisKKyAgICAvKiBSb3VuZCBzaXplIGRvd24g
dG8gbmV4dCBwb3dlciBvZiB0d28uICovCisgICAgd2hpbGUgKCAoYnl0ZXMgPSAoZGVidWd0cmFj
ZV9ieXRlcyAmIChkZWJ1Z3RyYWNlX2J5dGVzIC0gMSkpKSAhPSAwICkKKyAgICAgICAgZGVidWd0
cmFjZV9ieXRlcyA9IGJ5dGVzOworCisgICAgcmV0dXJuIDA7Cit9CitjdXN0b21fcGFyYW0oImRl
YnVndHJhY2UiLCBkZWJ1Z3RyYWNlX3BhcnNlX3BhcmFtKTsKKworc3RhdGljIHZvaWQgZGVidWd0
cmFjZV9kdW1wX2J1ZmZlcihzdHJ1Y3QgZGVidWd0cmFjZV9kYXRhICpkYXRhLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGFyICp3aGljaCkKK3sKKyAgICBpZiAo
ICFkYXRhICkKICAgICAgICAgcmV0dXJuOwogCi0gICAgcHJpbnRrKCJkZWJ1Z3RyYWNlX2R1bXAo
KSBzdGFydGluZ1xuIik7CisgICAgcHJpbnRrKCJkZWJ1Z3RyYWNlX2R1bXAoKSAlcyBidWZmZXIg
c3RhcnRpbmdcbiIsIHdoaWNoKTsKIAogICAgIC8qIFByaW50IG9sZGVzdCBwb3J0aW9uIG9mIHRo
ZSByaW5nLiAqLwotICAgIGlmICggZHRfZGF0YS0+YnVmW2R0X2RhdGEtPnByZF0gIT0gJ1wwJyAp
Ci0gICAgICAgIGNvbnNvbGVfc2VyaWFsX3B1dHMoJmR0X2RhdGEtPmJ1ZltkdF9kYXRhLT5wcmRd
LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlYnVndHJhY2VfYnl0ZXMgLSBkdF9kYXRh
LT5wcmQpOworICAgIGlmICggZGF0YS0+YnVmW2RhdGEtPnByZF0gIT0gJ1wwJyApCisgICAgICAg
IGNvbnNvbGVfc2VyaWFsX3B1dHMoJmRhdGEtPmJ1ZltkYXRhLT5wcmRdLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGRlYnVndHJhY2VfYnl0ZXMgLSBkYXRhLT5wcmQpOwogCiAgICAgLyog
UHJpbnQgeW91bmdlc3QgcG9ydGlvbiBvZiB0aGUgcmluZy4gKi8KLSAgICBkdF9kYXRhLT5idWZb
ZHRfZGF0YS0+cHJkXSA9ICdcMCc7Ci0gICAgY29uc29sZV9zZXJpYWxfcHV0cygmZHRfZGF0YS0+
YnVmWzBdLCBkdF9kYXRhLT5wcmQpOworICAgIGRhdGEtPmJ1ZltkYXRhLT5wcmRdID0gJ1wwJzsK
KyAgICBjb25zb2xlX3NlcmlhbF9wdXRzKCZkYXRhLT5idWZbMF0sIGRhdGEtPnByZCk7CiAKLSAg
ICBtZW1zZXQoZHRfZGF0YS0+YnVmLCAnXDAnLCBkZWJ1Z3RyYWNlX2J5dGVzKTsKLSAgICBkdF9k
YXRhLT5wcmQgPSAwOwotICAgIGRlYnVndHJhY2VfYnVmX2VtcHR5ID0gdHJ1ZTsKKyAgICBtZW1z
ZXQoZGF0YS0+YnVmLCAnXDAnLCBkZWJ1Z3RyYWNlX2J5dGVzKTsKKyAgICBkYXRhLT5wcmQgPSAw
OwogCi0gICAgcHJpbnRrKCJkZWJ1Z3RyYWNlX2R1bXAoKSBmaW5pc2hlZFxuIik7CisgICAgcHJp
bnRrKCJkZWJ1Z3RyYWNlX2R1bXAoKSAlcyBidWZmZXIgZmluaXNoZWRcbiIsIHdoaWNoKTsKK30K
Kworc3RhdGljIHZvaWQgZGVidWd0cmFjZV9kdW1wX3dvcmtlcih2b2lkKQoreworICAgIHVuc2ln
bmVkIGludCBjcHU7CisKKyAgICBpZiAoICFkZWJ1Z3RyYWNlX3VzZWQgKQorICAgICAgICByZXR1
cm47CisKKyAgICBkZWJ1Z3RyYWNlX2R1bXBfYnVmZmVyKGR0X2RhdGEsICJnbG9iYWwiKTsKKwor
ICAgIGZvciAoIGNwdSA9IDA7IGNwdSA8IG5yX2NwdV9pZHM7IGNwdSsrICkKKyAgICB7CisgICAg
ICAgIGNoYXIgYnVmWzE2XTsKKworICAgICAgICBzbnByaW50ZihidWYsIHNpemVvZihidWYpLCAi
Y3B1ICV1IiwgY3B1KTsKKyAgICAgICAgZGVidWd0cmFjZV9kdW1wX2J1ZmZlcihwZXJfY3B1KGR0
X2NwdV9kYXRhLCBjcHUpLCBidWYpOworICAgIH0KKworICAgIGRlYnVndHJhY2VfYnVmX2VtcHR5
ID0gdHJ1ZTsKIH0KIAogc3RhdGljIHZvaWQgZGVidWd0cmFjZV90b2dnbGUodm9pZCkKQEAgLTkx
LDI4ICsxMzYsMzMgQEAgdm9pZCBkZWJ1Z3RyYWNlX2R1bXAodm9pZCkKIAogc3RhdGljIHZvaWQg
ZGVidWd0cmFjZV9hZGRfdG9fYnVmKGNoYXIgKmJ1ZikKIHsKKyAgICBzdHJ1Y3QgZGVidWd0cmFj
ZV9kYXRhICpkYXRhOwogICAgIGNoYXIgKnA7CiAKKyAgICBkYXRhID0gZGVidWd0cmFjZV9wZXJf
Y3B1ID8gdGhpc19jcHUoZHRfY3B1X2RhdGEpIDogZHRfZGF0YTsKKwogICAgIGZvciAoIHAgPSBi
dWY7ICpwICE9ICdcMCc7IHArKyApCiAgICAgewotICAgICAgICBkdF9kYXRhLT5idWZbZHRfZGF0
YS0+cHJkKytdID0gKnA7Ci0gICAgICAgIGlmICggZHRfZGF0YS0+cHJkID09IGRlYnVndHJhY2Vf
Ynl0ZXMgKQotICAgICAgICAgICAgZHRfZGF0YS0+cHJkID0gMDsKKyAgICAgICAgZGF0YS0+YnVm
W2RhdGEtPnByZCsrXSA9ICpwOworICAgICAgICBpZiAoIGRhdGEtPnByZCA9PSBkZWJ1Z3RyYWNl
X2J5dGVzICkKKyAgICAgICAgICAgIGRhdGEtPnByZCA9IDA7CiAgICAgfQogfQogCiB2b2lkIGRl
YnVndHJhY2VfcHJpbnRrKGNvbnN0IGNoYXIgKmZtdCwgLi4uKQogewogICAgIHN0YXRpYyBjaGFy
IGJ1ZlsxMDI0XSwgbGFzdF9idWZbMTAyNF07Ci0gICAgc3RhdGljIHVuc2lnbmVkIGludCBjb3Vu
dCwgbGFzdF9jb3VudDsKKyAgICBzdGF0aWMgdW5zaWduZWQgaW50IGNvdW50LCBsYXN0X2NvdW50
LCBsYXN0X2NwdTsKICAgICBzdGF0aWMgdW5zaWduZWQgbG9uZyBsYXN0X3ByZDsKIAogICAgIGNo
YXIgICAgICAgICAgY250YnVmWzI0XTsKICAgICB2YV9saXN0ICAgICAgIGFyZ3M7CiAgICAgdW5z
aWduZWQgbG9uZyBmbGFnczsKICAgICB1bnNpZ25lZCBpbnQgbnI7CisgICAgc3RydWN0IGRlYnVn
dHJhY2VfZGF0YSAqZGF0YTsKIAotICAgIGlmICggIWR0X2RhdGEgKQorICAgIGRhdGEgPSBkZWJ1
Z3RyYWNlX3Blcl9jcHUgPyB0aGlzX2NwdShkdF9jcHVfZGF0YSkgOiBkdF9kYXRhOworICAgIGlm
ICggIWRhdGEgKQogICAgICAgICByZXR1cm47CiAKICAgICBkZWJ1Z3RyYWNlX3VzZWQgPSB0cnVl
OwpAQCAtMTMyLDE3ICsxODIsMjAgQEAgdm9pZCBkZWJ1Z3RyYWNlX3ByaW50ayhjb25zdCBjaGFy
ICpmbXQsIC4uLikKICAgICB9CiAgICAgZWxzZQogICAgIHsKKyAgICAgICAgdW5zaWduZWQgaW50
IGNwdSA9IGRlYnVndHJhY2VfcGVyX2NwdSA/IHNtcF9wcm9jZXNzb3JfaWQoKSA6IDA7CisKICAg
ICAgICAgaWYgKCBkZWJ1Z3RyYWNlX2J1Zl9lbXB0eSB8fCBzdHJjbXAoYnVmLCBsYXN0X2J1Zikg
KQogICAgICAgICB7CiAgICAgICAgICAgICBkZWJ1Z3RyYWNlX2J1Zl9lbXB0eSA9IGZhbHNlOwot
ICAgICAgICAgICAgbGFzdF9wcmQgPSBkdF9kYXRhLT5wcmQ7CisgICAgICAgICAgICBsYXN0X3By
ZCA9IGRhdGEtPnByZDsKICAgICAgICAgICAgIGxhc3RfY291bnQgPSArK2NvdW50OworICAgICAg
ICAgICAgbGFzdF9jcHUgPSBjcHU7CiAgICAgICAgICAgICBzYWZlX3N0cmNweShsYXN0X2J1Ziwg
YnVmKTsKICAgICAgICAgICAgIHNucHJpbnRmKGNudGJ1Ziwgc2l6ZW9mKGNudGJ1ZiksICIldSAi
LCBjb3VudCk7CiAgICAgICAgIH0KICAgICAgICAgZWxzZQogICAgICAgICB7Ci0gICAgICAgICAg
ICBkdF9kYXRhLT5wcmQgPSBsYXN0X3ByZDsKKyAgICAgICAgICAgIGRhdGEtPnByZCA9IGxhc3Rf
cHJkOwogICAgICAgICAgICAgc25wcmludGYoY250YnVmLCBzaXplb2YoY250YnVmKSwgIiV1LSV1
ICIsIGxhc3RfY291bnQsICsrY291bnQpOwogICAgICAgICB9CiAgICAgICAgIGRlYnVndHJhY2Vf
YWRkX3RvX2J1ZihjbnRidWYpOwpAQCAtMTU3LDM0ICsyMTAsNjkgQEAgc3RhdGljIHZvaWQgZGVi
dWd0cmFjZV9rZXkodW5zaWduZWQgY2hhciBrZXkpCiAgICAgZGVidWd0cmFjZV90b2dnbGUoKTsK
IH0KIAotc3RhdGljIGludCBfX2luaXQgZGVidWd0cmFjZV9pbml0KHZvaWQpCitzdGF0aWMgdm9p
ZCBkZWJ1Z3RyYWNlX2FsbG9jX2J1ZmZlcihzdHJ1Y3QgZGVidWd0cmFjZV9kYXRhICoqcHRyLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IGNwdSkKIHsK
ICAgICBpbnQgb3JkZXI7Ci0gICAgdW5zaWduZWQgbG9uZyBrYnl0ZXM7CiAgICAgc3RydWN0IGRl
YnVndHJhY2VfZGF0YSAqZGF0YTsKIAotICAgIC8qIFJvdW5kIHNpemUgZG93biB0byBuZXh0IHBv
d2VyIG9mIHR3by4gKi8KLSAgICB3aGlsZSAoIChrYnl0ZXMgPSAoZGVidWd0cmFjZV9raWxvYnl0
ZXMgJiAoZGVidWd0cmFjZV9raWxvYnl0ZXMtMSkpKSAhPSAwICkKLSAgICAgICAgZGVidWd0cmFj
ZV9raWxvYnl0ZXMgPSBrYnl0ZXM7Ci0KLSAgICBkZWJ1Z3RyYWNlX2J5dGVzID0gZGVidWd0cmFj
ZV9raWxvYnl0ZXMgPDwgMTA7Ci0gICAgaWYgKCBkZWJ1Z3RyYWNlX2J5dGVzID09IDAgKQotICAg
ICAgICByZXR1cm4gMDsKKyAgICBpZiAoICpwdHIgKQorICAgICAgICByZXR1cm47CiAKICAgICBv
cmRlciA9IGdldF9vcmRlcl9mcm9tX2J5dGVzKGRlYnVndHJhY2VfYnl0ZXMpOwogICAgIGRhdGEg
PSBhbGxvY194ZW5oZWFwX3BhZ2VzKG9yZGVyLCAwKTsKICAgICBpZiAoICFkYXRhICkKLSAgICAg
ICAgcmV0dXJuIC1FTk9NRU07CisgICAgeworICAgICAgICBpZiAoIGRlYnVndHJhY2VfcGVyX2Nw
dSApCisgICAgICAgICAgICBwcmludGsoIkNQVSV1OiBmYWlsZWQgdG8gYWxsb2NhdGUgZGVidWd0
cmFjZSBidWZmZXJcbiIsIGNwdSk7CisgICAgICAgIGVsc2UKKyAgICAgICAgICAgIHByaW50aygi
ZmFpbGVkIHRvIGFsbG9jYXRlIGRlYnVndHJhY2UgYnVmZmVyXG4iKTsKKyAgICAgICAgcmV0dXJu
OworICAgIH0KIAotICAgIGRlYnVndHJhY2VfYnl0ZXMgPSBQQUdFX1NJWkUgPDwgb3JkZXI7Ci0g
ICAgbWVtc2V0KGRhdGEsICdcMCcsIGRlYnVndHJhY2VfYnl0ZXMpOwotICAgIGRlYnVndHJhY2Vf
Ynl0ZXMgLT0gc2l6ZW9mKCpkYXRhKTsKKyAgICBtZW1zZXQoZGF0YSwgJ1wwJywgZGVidWd0cmFj
ZV9ieXRlcyArIHNpemVvZigqZGF0YSkpOwogCiAgICAgZHRfZGF0YSA9IGRhdGE7CisgICAgKnB0
ciA9IGRhdGE7Cit9CisKK3N0YXRpYyBpbnQgZGVidWd0cmFjZV9jcHVfY2FsbGJhY2soc3RydWN0
IG5vdGlmaWVyX2Jsb2NrICpuZmIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHVuc2lnbmVkIGxvbmcgYWN0aW9uLCB2b2lkICpoY3B1KQoreworICAgIHVuc2lnbmVkIGludCBj
cHUgPSAodW5zaWduZWQgbG9uZyloY3B1OworCisgICAgLyogQnVmZmVycyBhcmUgb25seSBldmVy
IGFsbG9jYXRlZCwgbmV2ZXIgZnJlZWQuICovCisgICAgaWYgKCBhY3Rpb24gPT0gQ1BVX1VQX1BS
RVBBUkUgKQorICAgICAgICBkZWJ1Z3RyYWNlX2FsbG9jX2J1ZmZlcigmcGVyX2NwdShkdF9jcHVf
ZGF0YSwgY3B1KSwgY3B1KTsKKworICAgIHJldHVybiAwOworfQorCitzdGF0aWMgc3RydWN0IG5v
dGlmaWVyX2Jsb2NrIGRlYnVndHJhY2VfbmZiID0geworICAgIC5ub3RpZmllcl9jYWxsID0gZGVi
dWd0cmFjZV9jcHVfY2FsbGJhY2sKK307CisKK3N0YXRpYyBpbnQgX19pbml0IGRlYnVndHJhY2Vf
aW5pdCh2b2lkKQoreworICAgIHVuc2lnbmVkIGludCBjcHU7CisKKyAgICBpZiAoICFkZWJ1Z3Ry
YWNlX2J5dGVzICkKKyAgICAgICAgcmV0dXJuIDA7CiAKICAgICByZWdpc3Rlcl9rZXloYW5kbGVy
KCdUJywgZGVidWd0cmFjZV9rZXksCiAgICAgICAgICAgICAgICAgICAgICAgICAidG9nZ2xlIGRl
YnVndHJhY2UgdG8gY29uc29sZS9idWZmZXIiLCAwKTsKIAorICAgIGRlYnVndHJhY2VfYnl0ZXMg
LT0gc2l6ZW9mKHN0cnVjdCBkZWJ1Z3RyYWNlX2RhdGEpOworCisgICAgaWYgKCBkZWJ1Z3RyYWNl
X3Blcl9jcHUgKQorICAgIHsKKyAgICAgICAgZm9yX2VhY2hfb25saW5lX2NwdSAoIGNwdSApCisg
ICAgICAgICAgICBkZWJ1Z3RyYWNlX2FsbG9jX2J1ZmZlcigmcGVyX2NwdShkdF9jcHVfZGF0YSwg
Y3B1KSwgY3B1KTsKKyAgICAgICAgcmVnaXN0ZXJfY3B1X25vdGlmaWVyKCZkZWJ1Z3RyYWNlX25m
Yik7CisgICAgfQorICAgIGVsc2UKKyAgICAgICAgZGVidWd0cmFjZV9hbGxvY19idWZmZXIoJmR0
X2RhdGEsIDApOworCiAgICAgcmV0dXJuIDA7CiB9CiBfX2luaXRjYWxsKGRlYnVndHJhY2VfaW5p
dCk7Ci0tIAoyLjE2LjQKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0
Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRl
dmVs

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id E1A9F2C46F
	for <lists+xen-devel@lfdr.de>; Tue, 28 May 2019 12:36:24 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hVZQ5-0004b3-KI; Tue, 28 May 2019 10:33:25 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=31/0=T4=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1hVZQ3-0004Xu-12
 for xen-devel@lists.xenproject.org; Tue, 28 May 2019 10:33:23 +0000
X-Inumbo-ID: 02a686da-8134-11e9-83cd-275097e2238a
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 02a686da-8134-11e9-83cd-275097e2238a;
 Tue, 28 May 2019 10:33:19 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 38F9FAFF9;
 Tue, 28 May 2019 10:33:17 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Tue, 28 May 2019 12:32:18 +0200
Message-Id: <20190528103313.1343-6-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190528103313.1343-1-jgross@suse.com>
References: <20190528103313.1343-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH 05/60] xen/sched: alloc struct sched_unit for
 each vcpu
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Tim Deegan <tim@xen.org>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Dario Faggioli <dfaggioli@suse.com>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

QWxsb2NhdGUgYSBzdHJ1Y3Qgc2NoZWRfdW5pdCBmb3IgZWFjaCB2Y3B1LiBUaGlzIHJlbW92ZXMg
dGhlIG5lZWQgdG8KaGF2ZSBpdCBsb2NhbGx5IG9uIHRoZSBzdGFjayBpbiBzY2hlZHVsZS5jLgoK
U2lnbmVkLW9mZi1ieTogSnVlcmdlbiBHcm9zcyA8amdyb3NzQHN1c2UuY29tPgotLS0KIHhlbi9j
b21tb24vc2NoZWR1bGUuYyAgIHwgNjcgKysrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLQogeGVuL2luY2x1ZGUveGVuL3NjaGVkLmggfCAgMiArKwogMiBmaWxl
cyBjaGFuZ2VkLCAzMyBpbnNlcnRpb25zKCspLCAzNiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQg
YS94ZW4vY29tbW9uL3NjaGVkdWxlLmMgYi94ZW4vY29tbW9uL3NjaGVkdWxlLmMKaW5kZXggOGE4
ZTczZmU1Ny4uM2ZmODgwOTZkOCAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9zY2hlZHVsZS5jCisr
KyBiL3hlbi9jb21tb24vc2NoZWR1bGUuYwpAQCAtMjUyLDEwICsyNTIsMTUgQEAgc3RhdGljIHZv
aWQgc2NoZWRfc3Bpbl91bmxvY2tfZG91YmxlKHNwaW5sb2NrX3QgKmxvY2sxLCBzcGlubG9ja190
ICpsb2NrMiwKIGludCBzY2hlZF9pbml0X3ZjcHUoc3RydWN0IHZjcHUgKnYsIHVuc2lnbmVkIGlu
dCBwcm9jZXNzb3IpCiB7CiAgICAgc3RydWN0IGRvbWFpbiAqZCA9IHYtPmRvbWFpbjsKLSAgICBz
dHJ1Y3Qgc2NoZWRfdW5pdCB1bml0ID0geyAudmNwdSA9IHYgfTsKKyAgICBzdHJ1Y3Qgc2NoZWRf
dW5pdCAqdW5pdDsKIAogICAgIHYtPnByb2Nlc3NvciA9IHByb2Nlc3NvcjsKIAorICAgIGlmICgg
KHVuaXQgPSB4emFsbG9jKHN0cnVjdCBzY2hlZF91bml0KSkgPT0gTlVMTCApCisgICAgICAgIHJl
dHVybiAxOworICAgIHYtPnNjaGVkX3VuaXQgPSB1bml0OworICAgIHVuaXQtPnZjcHUgPSB2Owor
CiAgICAgLyogSW5pdGlhbGlzZSB0aGUgcGVyLXZjcHUgdGltZXJzLiAqLwogICAgIGluaXRfdGlt
ZXIoJnYtPnBlcmlvZGljX3RpbWVyLCB2Y3B1X3BlcmlvZGljX3RpbWVyX2ZuLAogICAgICAgICAg
ICAgICAgdiwgdi0+cHJvY2Vzc29yKTsKQEAgLTI2NCw5ICsyNjksMTMgQEAgaW50IHNjaGVkX2lu
aXRfdmNwdShzdHJ1Y3QgdmNwdSAqdiwgdW5zaWduZWQgaW50IHByb2Nlc3NvcikKICAgICBpbml0
X3RpbWVyKCZ2LT5wb2xsX3RpbWVyLCBwb2xsX3RpbWVyX2ZuLAogICAgICAgICAgICAgICAgdiwg
di0+cHJvY2Vzc29yKTsKIAotICAgIHYtPnNjaGVkX3ByaXYgPSBzY2hlZF9hbGxvY192ZGF0YShk
b21fc2NoZWR1bGVyKGQpLCAmdW5pdCwgZC0+c2NoZWRfcHJpdik7CisgICAgdi0+c2NoZWRfcHJp
diA9IHNjaGVkX2FsbG9jX3ZkYXRhKGRvbV9zY2hlZHVsZXIoZCksIHVuaXQsIGQtPnNjaGVkX3By
aXYpOwogICAgIGlmICggdi0+c2NoZWRfcHJpdiA9PSBOVUxMICkKKyAgICB7CisgICAgICAgIHYt
PnNjaGVkX3VuaXQgPSBOVUxMOworICAgICAgICB4ZnJlZSh1bml0KTsKICAgICAgICAgcmV0dXJu
IDE7CisgICAgfQogCiAgICAgLyoKICAgICAgKiBJbml0aWFsaXplIGFmZmluaXR5IHNldHRpbmdz
LiBUaGUgaWRsZXIsIGFuZCBwb3RlbnRpYWxseQpAQCAtMjg1LDcgKzI5NCw3IEBAIGludCBzY2hl
ZF9pbml0X3ZjcHUoc3RydWN0IHZjcHUgKnYsIHVuc2lnbmVkIGludCBwcm9jZXNzb3IpCiAgICAg
fQogICAgIGVsc2UKICAgICB7Ci0gICAgICAgIHNjaGVkX2luc2VydF91bml0KGRvbV9zY2hlZHVs
ZXIoZCksICZ1bml0KTsKKyAgICAgICAgc2NoZWRfaW5zZXJ0X3VuaXQoZG9tX3NjaGVkdWxlcihk
KSwgdW5pdCk7CiAgICAgfQogCiAgICAgcmV0dXJuIDA7CkBAIC0zMDYsNyArMzE1LDYgQEAgaW50
IHNjaGVkX21vdmVfZG9tYWluKHN0cnVjdCBkb21haW4gKmQsIHN0cnVjdCBjcHVwb29sICpjKQog
ICAgIHZvaWQgKnZjcHVkYXRhOwogICAgIHN0cnVjdCBzY2hlZHVsZXIgKm9sZF9vcHM7CiAgICAg
dm9pZCAqb2xkX2RvbWRhdGE7Ci0gICAgc3RydWN0IHNjaGVkX3VuaXQgdW5pdDsKIAogICAgIGZv
cl9lYWNoX3ZjcHUgKCBkLCB2ICkKICAgICB7CkBAIC0zMjcsOCArMzM1LDggQEAgaW50IHNjaGVk
X21vdmVfZG9tYWluKHN0cnVjdCBkb21haW4gKmQsIHN0cnVjdCBjcHVwb29sICpjKQogCiAgICAg
Zm9yX2VhY2hfdmNwdSAoIGQsIHYgKQogICAgIHsKLSAgICAgICAgdW5pdC52Y3B1ID0gdjsKLSAg
ICAgICAgdmNwdV9wcml2W3YtPnZjcHVfaWRdID0gc2NoZWRfYWxsb2NfdmRhdGEoYy0+c2NoZWQs
ICZ1bml0LCBkb21kYXRhKTsKKyAgICAgICAgdmNwdV9wcml2W3YtPnZjcHVfaWRdID0gc2NoZWRf
YWxsb2NfdmRhdGEoYy0+c2NoZWQsIHYtPnNjaGVkX3VuaXQsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvbWRhdGEpOwogICAgICAgICBpZiAoIHZj
cHVfcHJpdlt2LT52Y3B1X2lkXSA9PSBOVUxMICkKICAgICAgICAgewogICAgICAgICAgICAgZm9y
X2VhY2hfdmNwdSAoIGQsIHYgKQpAQCAtMzQ2LDggKzM1NCw3IEBAIGludCBzY2hlZF9tb3ZlX2Rv
bWFpbihzdHJ1Y3QgZG9tYWluICpkLCBzdHJ1Y3QgY3B1cG9vbCAqYykKIAogICAgIGZvcl9lYWNo
X3ZjcHUgKCBkLCB2ICkKICAgICB7Ci0gICAgICAgIHVuaXQudmNwdSA9IHY7Ci0gICAgICAgIHNj
aGVkX3JlbW92ZV91bml0KG9sZF9vcHMsICZ1bml0KTsKKyAgICAgICAgc2NoZWRfcmVtb3ZlX3Vu
aXQob2xkX29wcywgdi0+c2NoZWRfdW5pdCk7CiAgICAgfQogCiAgICAgZC0+Y3B1cG9vbCA9IGM7
CkBAIC0zNTgsNyArMzY1LDYgQEAgaW50IHNjaGVkX21vdmVfZG9tYWluKHN0cnVjdCBkb21haW4g
KmQsIHN0cnVjdCBjcHVwb29sICpjKQogICAgIHsKICAgICAgICAgc3BpbmxvY2tfdCAqbG9jazsK
IAotICAgICAgICB1bml0LnZjcHUgPSB2OwogICAgICAgICB2Y3B1ZGF0YSA9IHYtPnNjaGVkX3By
aXY7CiAKICAgICAgICAgbWlncmF0ZV90aW1lcigmdi0+cGVyaW9kaWNfdGltZXIsIG5ld19wKTsK
QEAgLTM4Myw3ICszODksNyBAQCBpbnQgc2NoZWRfbW92ZV9kb21haW4oc3RydWN0IGRvbWFpbiAq
ZCwgc3RydWN0IGNwdXBvb2wgKmMpCiAKICAgICAgICAgbmV3X3AgPSBjcHVtYXNrX2N5Y2xlKG5l
d19wLCBjLT5jcHVfdmFsaWQpOwogCi0gICAgICAgIHNjaGVkX2luc2VydF91bml0KGMtPnNjaGVk
LCAmdW5pdCk7CisgICAgICAgIHNjaGVkX2luc2VydF91bml0KGMtPnNjaGVkLCB2LT5zY2hlZF91
bml0KTsKIAogICAgICAgICBzY2hlZF9mcmVlX3ZkYXRhKG9sZF9vcHMsIHZjcHVkYXRhKTsKICAg
ICB9CkBAIC00MDEsMTUgKzQwNywxNyBAQCBpbnQgc2NoZWRfbW92ZV9kb21haW4oc3RydWN0IGRv
bWFpbiAqZCwgc3RydWN0IGNwdXBvb2wgKmMpCiAKIHZvaWQgc2NoZWRfZGVzdHJveV92Y3B1KHN0
cnVjdCB2Y3B1ICp2KQogewotICAgIHN0cnVjdCBzY2hlZF91bml0IHVuaXQgPSB7IC52Y3B1ID0g
diB9OworICAgIHN0cnVjdCBzY2hlZF91bml0ICp1bml0ID0gdi0+c2NoZWRfdW5pdDsKIAogICAg
IGtpbGxfdGltZXIoJnYtPnBlcmlvZGljX3RpbWVyKTsKICAgICBraWxsX3RpbWVyKCZ2LT5zaW5n
bGVzaG90X3RpbWVyKTsKICAgICBraWxsX3RpbWVyKCZ2LT5wb2xsX3RpbWVyKTsKICAgICBpZiAo
IHRlc3RfYW5kX2NsZWFyX2Jvb2wodi0+aXNfdXJnZW50KSApCiAgICAgICAgIGF0b21pY19kZWMo
JnBlcl9jcHUoc2NoZWR1bGVfZGF0YSwgdi0+cHJvY2Vzc29yKS51cmdlbnRfY291bnQpOwotICAg
IHNjaGVkX3JlbW92ZV91bml0KHZjcHVfc2NoZWR1bGVyKHYpLCAmdW5pdCk7CisgICAgc2NoZWRf
cmVtb3ZlX3VuaXQodmNwdV9zY2hlZHVsZXIodiksIHVuaXQpOwogICAgIHNjaGVkX2ZyZWVfdmRh
dGEodmNwdV9zY2hlZHVsZXIodiksIHYtPnNjaGVkX3ByaXYpOworICAgIHhmcmVlKHVuaXQpOwor
ICAgIHYtPnNjaGVkX3VuaXQgPSBOVUxMOwogfQogCiBpbnQgc2NoZWRfaW5pdF9kb21haW4oc3Ry
dWN0IGRvbWFpbiAqZCwgaW50IHBvb2xpZCkKQEAgLTQ1Myw4ICs0NjEsNiBAQCB2b2lkIHNjaGVk
X2Rlc3Ryb3lfZG9tYWluKHN0cnVjdCBkb21haW4gKmQpCiAKIHZvaWQgdmNwdV9zbGVlcF9ub3N5
bmNfbG9ja2VkKHN0cnVjdCB2Y3B1ICp2KQogewotICAgIHN0cnVjdCBzY2hlZF91bml0IHVuaXQg
PSB7IC52Y3B1ID0gdiB9OwotCiAgICAgQVNTRVJUKHNwaW5faXNfbG9ja2VkKHBlcl9jcHUoc2No
ZWR1bGVfZGF0YSx2LT5wcm9jZXNzb3IpLnNjaGVkdWxlX2xvY2spKTsKIAogICAgIGlmICggbGlr
ZWx5KCF2Y3B1X3J1bm5hYmxlKHYpKSApCkBAIC00NjIsNyArNDY4LDcgQEAgdm9pZCB2Y3B1X3Ns
ZWVwX25vc3luY19sb2NrZWQoc3RydWN0IHZjcHUgKnYpCiAgICAgICAgIGlmICggdi0+cnVuc3Rh
dGUuc3RhdGUgPT0gUlVOU1RBVEVfcnVubmFibGUgKQogICAgICAgICAgICAgdmNwdV9ydW5zdGF0
ZV9jaGFuZ2UodiwgUlVOU1RBVEVfb2ZmbGluZSwgTk9XKCkpOwogCi0gICAgICAgIHNjaGVkX3Ns
ZWVwKHZjcHVfc2NoZWR1bGVyKHYpLCAmdW5pdCk7CisgICAgICAgIHNjaGVkX3NsZWVwKHZjcHVf
c2NoZWR1bGVyKHYpLCB2LT5zY2hlZF91bml0KTsKICAgICB9CiB9CiAKQEAgLTQ5NCw3ICs1MDAs
NiBAQCB2b2lkIHZjcHVfd2FrZShzdHJ1Y3QgdmNwdSAqdikKIHsKICAgICB1bnNpZ25lZCBsb25n
IGZsYWdzOwogICAgIHNwaW5sb2NrX3QgKmxvY2s7Ci0gICAgc3RydWN0IHNjaGVkX3VuaXQgdW5p
dCA9IHsgLnZjcHUgPSB2IH07CiAKICAgICBUUkFDRV8yRChUUkNfU0NIRURfV0FLRSwgdi0+ZG9t
YWluLT5kb21haW5faWQsIHYtPnZjcHVfaWQpOwogCkBAIC01MDQsNyArNTA5LDcgQEAgdm9pZCB2
Y3B1X3dha2Uoc3RydWN0IHZjcHUgKnYpCiAgICAgewogICAgICAgICBpZiAoIHYtPnJ1bnN0YXRl
LnN0YXRlID49IFJVTlNUQVRFX2Jsb2NrZWQgKQogICAgICAgICAgICAgdmNwdV9ydW5zdGF0ZV9j
aGFuZ2UodiwgUlVOU1RBVEVfcnVubmFibGUsIE5PVygpKTsKLSAgICAgICAgc2NoZWRfd2FrZSh2
Y3B1X3NjaGVkdWxlcih2KSwgJnVuaXQpOworICAgICAgICBzY2hlZF93YWtlKHZjcHVfc2NoZWR1
bGVyKHYpLCB2LT5zY2hlZF91bml0KTsKICAgICB9CiAgICAgZWxzZSBpZiAoICEodi0+cGF1c2Vf
ZmxhZ3MgJiBWUEZfYmxvY2tlZCkgKQogICAgIHsKQEAgLTU0Myw3ICs1NDgsNiBAQCB2b2lkIHZj
cHVfdW5ibG9jayhzdHJ1Y3QgdmNwdSAqdikKIHN0YXRpYyB2b2lkIHZjcHVfbW92ZV9sb2NrZWQo
c3RydWN0IHZjcHUgKnYsIHVuc2lnbmVkIGludCBuZXdfY3B1KQogewogICAgIHVuc2lnbmVkIGlu
dCBvbGRfY3B1ID0gdi0+cHJvY2Vzc29yOwotICAgIHN0cnVjdCBzY2hlZF91bml0IHVuaXQgPSB7
IC52Y3B1ID0gdiB9OwogCiAgICAgLyoKICAgICAgKiBUcmFuc2ZlciB1cmdlbmN5IHN0YXR1cyB0
byBuZXcgQ1BVIGJlZm9yZSBzd2l0Y2hpbmcgQ1BVcywgYXMKQEAgLTU2MCw3ICs1NjQsNyBAQCBz
dGF0aWMgdm9pZCB2Y3B1X21vdmVfbG9ja2VkKHN0cnVjdCB2Y3B1ICp2LCB1bnNpZ25lZCBpbnQg
bmV3X2NwdSkKICAgICAgKiBBY3R1YWwgQ1BVIHN3aXRjaCB0byBuZXcgQ1BVLiAgVGhpcyBpcyBz
YWZlIGJlY2F1c2UgdGhlIGxvY2sKICAgICAgKiBwb2ludGVyIGNhbid0IGNoYW5nZSB3aGlsZSB0
aGUgY3VycmVudCBsb2NrIGlzIGhlbGQuCiAgICAgICovCi0gICAgc2NoZWRfbWlncmF0ZSh2Y3B1
X3NjaGVkdWxlcih2KSwgJnVuaXQsIG5ld19jcHUpOworICAgIHNjaGVkX21pZ3JhdGUodmNwdV9z
Y2hlZHVsZXIodiksIHYtPnNjaGVkX3VuaXQsIG5ld19jcHUpOwogfQogCiAvKgpAQCAtNjAyLDcg
KzYwNiw2IEBAIHN0YXRpYyB2b2lkIHZjcHVfbWlncmF0ZV9maW5pc2goc3RydWN0IHZjcHUgKnYp
CiAgICAgdW5zaWduZWQgaW50IG9sZF9jcHUsIG5ld19jcHU7CiAgICAgc3BpbmxvY2tfdCAqb2xk
X2xvY2ssICpuZXdfbG9jazsKICAgICBib29sX3QgcGlja19jYWxsZWQgPSAwOwotICAgIHN0cnVj
dCBzY2hlZF91bml0IHVuaXQgPSB7IC52Y3B1ID0gdiB9OwogCiAgICAgLyoKICAgICAgKiBJZiB0
aGUgdmNwdSBpcyBjdXJyZW50bHkgcnVubmluZywgdGhpcyB3aWxsIGJlIGhhbmRsZWQgYnkKQEAg
LTYzOSw3ICs2NDIsNyBAQCBzdGF0aWMgdm9pZCB2Y3B1X21pZ3JhdGVfZmluaXNoKHN0cnVjdCB2
Y3B1ICp2KQogICAgICAgICAgICAgICAgIGJyZWFrOwogCiAgICAgICAgICAgICAvKiBTZWxlY3Qg
YSBuZXcgQ1BVLiAqLwotICAgICAgICAgICAgbmV3X2NwdSA9IHNjaGVkX3BpY2tfY3B1KHZjcHVf
c2NoZWR1bGVyKHYpLCAmdW5pdCk7CisgICAgICAgICAgICBuZXdfY3B1ID0gc2NoZWRfcGlja19j
cHUodmNwdV9zY2hlZHVsZXIodiksIHYtPnNjaGVkX3VuaXQpOwogICAgICAgICAgICAgaWYgKCAo
bmV3X2xvY2sgPT0gcGVyX2NwdShzY2hlZHVsZV9kYXRhLCBuZXdfY3B1KS5zY2hlZHVsZV9sb2Nr
KSAmJgogICAgICAgICAgICAgICAgICBjcHVtYXNrX3Rlc3RfY3B1KG5ld19jcHUsIHYtPmRvbWFp
bi0+Y3B1cG9vbC0+Y3B1X3ZhbGlkKSApCiAgICAgICAgICAgICAgICAgYnJlYWs7CkBAIC03MDks
NyArNzEyLDYgQEAgdm9pZCByZXN0b3JlX3ZjcHVfYWZmaW5pdHkoc3RydWN0IGRvbWFpbiAqZCkK
ICAgICB7CiAgICAgICAgIHNwaW5sb2NrX3QgKmxvY2s7CiAgICAgICAgIHVuc2lnbmVkIGludCBv
bGRfY3B1ID0gdi0+cHJvY2Vzc29yOwotICAgICAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCB1bml0ID0g
eyAudmNwdSA9IHYgfTsKIAogICAgICAgICBBU1NFUlQoIXZjcHVfcnVubmFibGUodikpOwogCkBA
IC03NDUsNyArNzQ3LDcgQEAgdm9pZCByZXN0b3JlX3ZjcHVfYWZmaW5pdHkoc3RydWN0IGRvbWFp
biAqZCkKICAgICAgICAgdi0+cHJvY2Vzc29yID0gY3B1bWFza19hbnkoY3B1bWFza19zY3JhdGNo
X2NwdShjcHUpKTsKIAogICAgICAgICBsb2NrID0gdmNwdV9zY2hlZHVsZV9sb2NrX2lycSh2KTsK
LSAgICAgICAgdi0+cHJvY2Vzc29yID0gc2NoZWRfcGlja19jcHUodmNwdV9zY2hlZHVsZXIodiks
ICZ1bml0KTsKKyAgICAgICAgdi0+cHJvY2Vzc29yID0gc2NoZWRfcGlja19jcHUodmNwdV9zY2hl
ZHVsZXIodiksIHYtPnNjaGVkX3VuaXQpOwogICAgICAgICBzcGluX3VubG9ja19pcnEobG9jayk7
CiAKICAgICAgICAgaWYgKCBvbGRfY3B1ICE9IHYtPnByb2Nlc3NvciApCkBAIC04NTcsOSArODU5
LDcgQEAgc3RhdGljIGludCBjcHVfZGlzYWJsZV9zY2hlZHVsZXJfY2hlY2sodW5zaWduZWQgaW50
IGNwdSkKIHZvaWQgc2NoZWRfc2V0X2FmZmluaXR5KAogICAgIHN0cnVjdCB2Y3B1ICp2LCBjb25z
dCBjcHVtYXNrX3QgKmhhcmQsIGNvbnN0IGNwdW1hc2tfdCAqc29mdCkKIHsKLSAgICBzdHJ1Y3Qg
c2NoZWRfdW5pdCB1bml0ID0geyAudmNwdSA9IHYgfTsKLQotICAgIHNjaGVkX2FkanVzdF9hZmZp
bml0eShkb21fc2NoZWR1bGVyKHYtPmRvbWFpbiksICZ1bml0LCBoYXJkLCBzb2Z0KTsKKyAgICBz
Y2hlZF9hZGp1c3RfYWZmaW5pdHkoZG9tX3NjaGVkdWxlcih2LT5kb21haW4pLCB2LT5zY2hlZF91
bml0LCBoYXJkLCBzb2Z0KTsKIAogICAgIGlmICggaGFyZCApCiAgICAgICAgIGNwdW1hc2tfY29w
eSh2LT5jcHVfaGFyZF9hZmZpbml0eSwgaGFyZCk7CkBAIC0xMDMyLDEwICsxMDMyLDkgQEAgc3Rh
dGljIGxvbmcgZG9fcG9sbChzdHJ1Y3Qgc2NoZWRfcG9sbCAqc2NoZWRfcG9sbCkKIGxvbmcgdmNw
dV95aWVsZCh2b2lkKQogewogICAgIHN0cnVjdCB2Y3B1ICogdj1jdXJyZW50OwotICAgIHN0cnVj
dCBzY2hlZF91bml0IHVuaXQgPSB7IC52Y3B1ID0gdiB9OwogICAgIHNwaW5sb2NrX3QgKmxvY2sg
PSB2Y3B1X3NjaGVkdWxlX2xvY2tfaXJxKHYpOwogCi0gICAgc2NoZWRfeWllbGQodmNwdV9zY2hl
ZHVsZXIodiksICZ1bml0KTsKKyAgICBzY2hlZF95aWVsZCh2Y3B1X3NjaGVkdWxlcih2KSwgdi0+
c2NoZWRfdW5pdCk7CiAgICAgdmNwdV9zY2hlZHVsZV91bmxvY2tfaXJxKGxvY2ssIHYpOwogCiAg
ICAgU0NIRURfU1RBVF9DUkFOSyh2Y3B1X3lpZWxkKTsKQEAgLTE1MzAsOCArMTUyOSw2IEBAIHN0
YXRpYyB2b2lkIHNjaGVkdWxlKHZvaWQpCiAKIHZvaWQgY29udGV4dF9zYXZlZChzdHJ1Y3QgdmNw
dSAqcHJldikKIHsKLSAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCB1bml0ID0geyAudmNwdSA9IHByZXYg
fTsKLQogICAgIC8qIENsZWFyIHJ1bm5pbmcgZmxhZyAvYWZ0ZXIvIHdyaXRpbmcgY29udGV4dCB0
byBtZW1vcnkuICovCiAgICAgc21wX3dtYigpOwogCkBAIC0xNTQwLDcgKzE1MzcsNyBAQCB2b2lk
IGNvbnRleHRfc2F2ZWQoc3RydWN0IHZjcHUgKnByZXYpCiAgICAgLyogQ2hlY2sgZm9yIG1pZ3Jh
dGlvbiByZXF1ZXN0IC9hZnRlci8gY2xlYXJpbmcgcnVubmluZyBmbGFnLiAqLwogICAgIHNtcF9t
YigpOwogCi0gICAgc2NoZWRfY29udGV4dF9zYXZlZCh2Y3B1X3NjaGVkdWxlcihwcmV2KSwgJnVu
aXQpOworICAgIHNjaGVkX2NvbnRleHRfc2F2ZWQodmNwdV9zY2hlZHVsZXIocHJldiksIHByZXYt
PnNjaGVkX3VuaXQpOwogCiAgICAgdmNwdV9taWdyYXRlX2ZpbmlzaChwcmV2KTsKIH0KQEAgLTE1
OTYsNyArMTU5Myw2IEBAIHN0YXRpYyBpbnQgY3B1X3NjaGVkdWxlX3VwKHVuc2lnbmVkIGludCBj
cHUpCiAgICAgZWxzZQogICAgIHsKICAgICAgICAgc3RydWN0IHZjcHUgKmlkbGUgPSBpZGxlX3Zj
cHVbY3B1XTsKLSAgICAgICAgc3RydWN0IHNjaGVkX3VuaXQgdW5pdCA9IHsgLnZjcHUgPSBpZGxl
IH07CiAKICAgICAgICAgLyoKICAgICAgICAgICogRHVyaW5nIChBQ1BJPykgc3VzcGVuZCB0aGUg
aWRsZSB2Q1BVIGZvciB0aGlzIHBDUFUgaXMgbm90IGZyZWVkLApAQCAtMTYxMCw3ICsxNjA2LDcg
QEAgc3RhdGljIGludCBjcHVfc2NoZWR1bGVfdXAodW5zaWduZWQgaW50IGNwdSkKICAgICAgICAg
ICovCiAgICAgICAgIEFTU0VSVChpZGxlLT5zY2hlZF9wcml2ID09IE5VTEwpOwogCi0gICAgICAg
IGlkbGUtPnNjaGVkX3ByaXYgPSBzY2hlZF9hbGxvY192ZGF0YSgmb3BzLCAmdW5pdCwKKyAgICAg
ICAgaWRsZS0+c2NoZWRfcHJpdiA9IHNjaGVkX2FsbG9jX3ZkYXRhKCZvcHMsIGlkbGUtPnNjaGVk
X3VuaXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZGxl
LT5kb21haW4tPnNjaGVkX3ByaXYpOwogICAgICAgICBpZiAoIGlkbGUtPnNjaGVkX3ByaXYgPT0g
TlVMTCApCiAgICAgICAgICAgICByZXR1cm4gLUVOT01FTTsKQEAgLTE4MjcsNyArMTgyMyw2IEBA
IHZvaWQgX19pbml0IHNjaGVkdWxlcl9pbml0KHZvaWQpCiBpbnQgc2NoZWR1bGVfY3B1X3N3aXRj
aCh1bnNpZ25lZCBpbnQgY3B1LCBzdHJ1Y3QgY3B1cG9vbCAqYykKIHsKICAgICBzdHJ1Y3QgdmNw
dSAqaWRsZTsKLSAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCB1bml0OwogICAgIHZvaWQgKnBwcml2LCAq
cHByaXZfb2xkLCAqdnByaXYsICp2cHJpdl9vbGQ7CiAgICAgc3RydWN0IHNjaGVkdWxlciAqb2xk
X29wcyA9IHBlcl9jcHUoc2NoZWR1bGVyLCBjcHUpOwogICAgIHN0cnVjdCBzY2hlZHVsZXIgKm5l
d19vcHMgPSAoYyA9PSBOVUxMKSA/ICZvcHMgOiBjLT5zY2hlZDsKQEAgLTE4NjQsMTEgKzE4NTks
MTEgQEAgaW50IHNjaGVkdWxlX2NwdV9zd2l0Y2godW5zaWduZWQgaW50IGNwdSwgc3RydWN0IGNw
dXBvb2wgKmMpCiAgICAgICogICAgc2NoZWRfcHJpdiBmaWVsZCBvZiB0aGUgcGVyLXZDUFUgaW5m
byBvZiB0aGUgaWRsZSBkb21haW4uCiAgICAgICovCiAgICAgaWRsZSA9IGlkbGVfdmNwdVtjcHVd
OwotICAgIHVuaXQudmNwdSA9IGlkbGU7CiAgICAgcHByaXYgPSBzY2hlZF9hbGxvY19wZGF0YShu
ZXdfb3BzLCBjcHUpOwogICAgIGlmICggSVNfRVJSKHBwcml2KSApCiAgICAgICAgIHJldHVybiBQ
VFJfRVJSKHBwcml2KTsKLSAgICB2cHJpdiA9IHNjaGVkX2FsbG9jX3ZkYXRhKG5ld19vcHMsICZ1
bml0LCBpZGxlLT5kb21haW4tPnNjaGVkX3ByaXYpOworICAgIHZwcml2ID0gc2NoZWRfYWxsb2Nf
dmRhdGEobmV3X29wcywgaWRsZS0+c2NoZWRfdW5pdCwKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGlkbGUtPmRvbWFpbi0+c2NoZWRfcHJpdik7CiAgICAgaWYgKCB2cHJpdiA9PSBOVUxM
ICkKICAgICB7CiAgICAgICAgIHNjaGVkX2ZyZWVfcGRhdGEobmV3X29wcywgcHByaXYsIGNwdSk7
CmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaCBiL3hlbi9pbmNsdWRlL3hlbi9z
Y2hlZC5oCmluZGV4IDcyYTE3NzU4YTEuLmU4ZWE0MmU4NjcgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNs
dWRlL3hlbi9zY2hlZC5oCisrKyBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCkBAIC0xNDAsNiAr
MTQwLDcgQEAgdm9pZCBldnRjaG5fZGVzdHJveShzdHJ1Y3QgZG9tYWluICpkKTsgLyogZnJvbSBk
b21haW5fa2lsbCAqLwogdm9pZCBldnRjaG5fZGVzdHJveV9maW5hbChzdHJ1Y3QgZG9tYWluICpk
KTsgLyogZnJvbSBjb21wbGV0ZV9kb21haW5fZGVzdHJveSAqLwogCiBzdHJ1Y3Qgd2FpdHF1ZXVl
X3ZjcHU7CitzdHJ1Y3Qgc2NoZWRfdW5pdDsKIAogc3RydWN0IHZjcHUKIHsKQEAgLTE2MCw2ICsx
NjEsNyBAQCBzdHJ1Y3QgdmNwdQogCiAgICAgc3RydWN0IHRpbWVyICAgICBwb2xsX3RpbWVyOyAg
ICAvKiB0aW1lb3V0IGZvciBTQ0hFRE9QX3BvbGwgKi8KIAorICAgIHN0cnVjdCBzY2hlZF91bml0
ICpzY2hlZF91bml0OwogICAgIHZvaWQgICAgICAgICAgICAqc2NoZWRfcHJpdjsgICAgLyogc2No
ZWR1bGVyLXNwZWNpZmljIGRhdGEgKi8KIAogICAgIHN0cnVjdCB2Y3B1X3J1bnN0YXRlX2luZm8g
cnVuc3RhdGU7Ci0tIAoyLjE2LjQKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5w
cm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8v
eGVuLWRldmVs

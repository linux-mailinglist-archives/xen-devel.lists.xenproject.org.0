Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 451CD1543BC
	for <lists+xen-devel@lfdr.de>; Thu,  6 Feb 2020 13:06:55 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1izftE-0003u1-Bb; Thu, 06 Feb 2020 12:04:12 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=TqwH=32=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1izftC-0003tw-Iz
 for xen-devel@lists.xenproject.org; Thu, 06 Feb 2020 12:04:10 +0000
X-Inumbo-ID: c71e1890-48d8-11ea-af4b-12813bfff9fa
Received: from mx2.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id c71e1890-48d8-11ea-af4b-12813bfff9fa;
 Thu, 06 Feb 2020 12:04:08 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx2.suse.de (Postfix) with ESMTP id 5FF22B1B3;
 Thu,  6 Feb 2020 12:04:07 +0000 (UTC)
To: xen-devel@lists.xenproject.org
References: <20200123085504.30911-1-jgross@suse.com>
From: =?UTF-8?B?SsO8cmdlbiBHcm/Dnw==?= <jgross@suse.com>
Message-ID: <f914af29-cb1b-6e03-8a8e-66a046acb718@suse.com>
Date: Thu, 6 Feb 2020 13:04:06 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101
 Thunderbird/68.2.1
MIME-Version: 1.0
In-Reply-To: <20200123085504.30911-1-jgross@suse.com>
Content-Language: en-US
Subject: Re: [Xen-devel] [PATCH] xen/sched: rework credit2 run-queue
 allocation
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: George Dunlap <george.dunlap@eu.citrix.com>,
 Dario Faggioli <dfaggioli@suse.com>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

T24gMjMuMDEuMjAgMDk6NTUsIEp1ZXJnZW4gR3Jvc3Mgd3JvdGU6Cj4gQ3VycmVudGx5IHRoZSBt
ZW1vcnkgZm9yIGVhY2ggcnVuLXF1ZXVlIG9mIHRoZSBjcmVkaXQyIHNjaGVkdWxlciBpcwo+IGFs
bG9jYXRlZCBhdCB0aGUgc2NoZWR1bGVyJ3MgaW5pdCBmdW5jdGlvbjogZm9yIGVhY2ggY3B1IGlu
IHRoZSBzeXN0ZW0KPiBhIHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgaXMgYmVpbmcgYWxs
b2NhdGVkLCBldmVuIGlmIHRoZQo+IGN1cnJlbnQgc2NoZWR1bGVyIG9ubHkgaGFuZGxlcyBvbmUg
cGh5c2ljYWwgY3B1IG9yIGlzIGNvbmZpZ3VyZWQgdG8KPiB3b3JrIHdpdGggYSBzaW5nbGUgcnVu
LXF1ZXVlLiBBcyBlYWNoIHN0cnVjdCBjb250YWlucyA0IGNwdW1hc2tzIHRoaXMKPiBzdW1zIHVw
IHRvIHJhdGhlciBsYXJnZSBtZW1vcnkgc2l6ZXMgcHJldHR5IGZhc3QuCj4gCj4gUmV3b3JrIHRo
ZSBtZW1vcnkgYWxsb2NhdGlvbiBmb3IgcnVuLXF1ZXVlcyB0byBiZSBkb25lIG9ubHkgd2hlbgo+
IG5lZWRlZCwgaS5lLiB3aGVuIGFkZGluZyBhIHBoeXNpY2FsIGNwdSB0byB0aGUgc2NoZWR1bGVy
IHJlcXVpcmluZyBhCj4gbmV3IHJ1bi1xdWV1ZS4KPiAKPiBJbiBmYWN0IHRoaXMgZml4ZXMgYSBi
dWcgaW4gY3JlZGl0MiByZWxhdGVkIHRvIHJ1bi1xdWV1ZSBoYW5kbGluZzoKPiBjcHVfdG9fcnVu
cXVldWUoKSB3aWxsIHJldHVybiB0aGUgZmlyc3QgZnJlZSBvciBtYXRjaGluZyBydW4tcXVldWUs
Cj4gd2hpY2ggZXZlciBpcyBmb3VuZCBmaXJzdC4gU28gaW4gY2FzZSBhIGNwdSBpcyByZW1vdmVk
IGZyb20gY3JlZGl0Mgo+IHRoaXMgY291bGQgcmVzdWx0IGluIGUuZy4gcnVuLXF1ZXVlIDAgYmVj
b21pbmcgZnJlZSwgc28gd2hlbiBhbm90aGVyCj4gY3B1IGlzIGFkZGVkIGl0IHdpbGwgaW4gYW55
IGNhc2UgYmUgYXNzaWduZWQgdG8gdGhhdCBmcmVlIHJ1bi1xdWV1ZSwKPiBldmVuIGlmIGl0IHdv
dWxkIGhhdmUgZm91bmQgYW5vdGhlciBydW4tcXVldWUgbWF0Y2hpbmcgbGF0ZXIuCj4gCj4gU2ln
bmVkLW9mZi1ieTogSnVlcmdlbiBHcm9zcyA8amdyb3NzQHN1c2UuY29tPgoKR2VudGxlIHBpbmcu
Li4KCgpKdWVyZ2VuCgo+IC0tLQo+ICAgeGVuL2NvbW1vbi9zY2hlZC9jcmVkaXQyLmMgfCAzNzIg
KysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCj4gICAxIGZpbGUg
Y2hhbmdlZCwgMTg0IGluc2VydGlvbnMoKyksIDE4OCBkZWxldGlvbnMoLSkKPiAKPiBkaWZmIC0t
Z2l0IGEveGVuL2NvbW1vbi9zY2hlZC9jcmVkaXQyLmMgYi94ZW4vY29tbW9uL3NjaGVkL2NyZWRp
dDIuYwo+IGluZGV4IDI1NmMxYzAxZmMuLjQ5YTNjNTUzZjEgMTAwNjQ0Cj4gLS0tIGEveGVuL2Nv
bW1vbi9zY2hlZC9jcmVkaXQyLmMKPiArKysgYi94ZW4vY29tbW9uL3NjaGVkL2NyZWRpdDIuYwo+
IEBAIC00NjYsOCArNDY2LDEyIEBAIGN1c3RvbV9wYXJhbSgiY3JlZGl0Ml9ydW5xdWV1ZSIsIHBh
cnNlX2NyZWRpdDJfcnVucXVldWUpOwo+ICAgc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSB7
Cj4gICAgICAgc3BpbmxvY2tfdCBsb2NrOyAgICAgICAgICAgLyogTG9jayBmb3IgdGhpcyBydW5x
dWV1ZSAgICAgICAgICAgICAgICAgICAgICovCj4gICAKPiArICAgIHN0cnVjdCBsaXN0X2hlYWQg
cnFsOyAgICAgIC8qIExpc3Qgb2YgcnVucXVldWVzICAgICAgICAgICAgICAgICAgICAgICAgICAq
Lwo+ICAgICAgIHN0cnVjdCBsaXN0X2hlYWQgcnVucTsgICAgIC8qIE9yZGVyZWQgbGlzdCBvZiBy
dW5uYWJsZSB2bXMgICAgICAgICAgICAgICAqLwo+ICsgICAgdW5zaWduZWQgaW50IHJlZmNudDsg
ICAgICAgLyogSG93IG1hbnkgQ1BVcyByZWZlcmVuY2UgdGhpcyBydW5xdWV1ZSAgICAgICovCj4g
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiAoaW5jbHVkaW5nIG5vdCB5ZXQgYWN0
aXZlIG9uZXMpICAgICAgICAgICAgKi8KPiAgICAgICB1bnNpZ25lZCBpbnQgbnJfY3B1czsgICAg
ICAvKiBIb3cgbWFueSBDUFVzIGFyZSBzaGFyaW5nIHRoaXMgcnVucXVldWUgICAgKi8KPiArICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIChvbmx5IGFjdGl2ZSBvbmVzKSAgICAgICAg
ICAgICAgICAgICAgICAgICAqLwo+ICAgICAgIGludCBpZDsgICAgICAgICAgICAgICAgICAgIC8q
IElEIG9mIHRoaXMgcnVucXVldWUgKC0xIGlmIGludmFsaWQpICAgICAgICAqLwo+ICAgCj4gICAg
ICAgaW50IGxvYWQ7ICAgICAgICAgICAgICAgICAgLyogSW5zdGFudGFuZW91cyBsb2FkIChudW0g
b2Ygbm9uLWlkbGUgdW5pdHMpICovCj4gQEAgLTQ5NSw4ICs0OTksOCBAQCBzdHJ1Y3QgY3NjaGVk
Ml9wcml2YXRlIHsKPiAgICAgICB1bnNpZ25lZCBpbnQgbG9hZF93aW5kb3dfc2hpZnQ7ICAgIC8q
IExlbmdodCBvZiBsb2FkIGRlY2F5aW5nIHdpbmRvdyAgICAgKi8KPiAgICAgICB1bnNpZ25lZCBp
bnQgcmF0ZWxpbWl0X3VzOyAgICAgICAgIC8qIFJhdGUgbGltaXRpbmcgZm9yIHRoaXMgc2NoZWR1
bGVyICAgKi8KPiAgIAo+IC0gICAgY3B1bWFza190IGFjdGl2ZV9xdWV1ZXM7ICAgICAgICAgICAv
KiBSdW5xdWV1ZXMgd2l0aCAobWF5YmUpIGFjdGl2ZSBjcHVzICovCj4gLSAgICBzdHJ1Y3QgY3Nj
aGVkMl9ydW5xdWV1ZV9kYXRhICpycWQ7IC8qIERhdGEgb2YgdGhlIHZhcmlvdXMgcnVucXVldWVz
ICAgICAgKi8KPiArICAgIHVuc2lnbmVkIGludCBhY3RpdmVfcXVldWVzOyAgICAgICAgLyogTnVt
YmVyIG9mIGFjdGl2ZSBydW5xdWV1ZXMgICAgICAgICAqLwo+ICsgICAgc3RydWN0IGxpc3RfaGVh
ZCBycWw7ICAgICAgICAgICAgICAvKiBMaXN0IG9mIHJ1bnF1ZXVlcyAgICAgICAgICAgICAgICAg
ICovCj4gICAKPiAgICAgICBjcHVtYXNrX3QgaW5pdGlhbGl6ZWQ7ICAgICAgICAgICAgIC8qIENQ
VXMgcGFydCBvZiB0aGlzIHNjaGVkdWxlciAgICAgICAgKi8KPiAgICAgICBzdHJ1Y3QgbGlzdF9o
ZWFkIHNkb207ICAgICAgICAgICAgIC8qIExpc3Qgb2YgZG9tYWlucyAoZm9yIGRlYnVnIGtleSkg
ICAgKi8KPiBAQCAtNTA3LDcgKzUxMSw3IEBAIHN0cnVjdCBjc2NoZWQyX3ByaXZhdGUgewo+ICAg
ICovCj4gICBzdHJ1Y3QgY3NjaGVkMl9wY3B1IHsKPiAgICAgICBjcHVtYXNrX3Qgc2libGluZ19t
YXNrOyAgICAgICAgICAgIC8qIFNpYmxpbmdzIGluIHRoZSBzYW1lIHJ1bnF1ZXVlICAgICAgKi8K
PiAtICAgIGludCBydW5xX2lkOwo+ICsgICAgc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAq
cnFkOyAvKiBSdW5xdWV1ZSBmb3IgdGhpcyBDUFUgICAgICAgICAgICAgICovCj4gICB9Owo+ICAg
Cj4gICAvKgo+IEBAIC01ODUsMTQgKzU4OSwxMyBAQCBzdGF0aWMgaW5saW5lIHN0cnVjdCBjc2No
ZWQyX2RvbSAqY3NjaGVkMl9kb20oY29uc3Qgc3RydWN0IGRvbWFpbiAqZCkKPiAgIC8qIENQVSB0
byBydW5xX2lkIG1hY3JvICovCj4gICBzdGF0aWMgaW5saW5lIGludCBjMnIodW5zaWduZWQgaW50
IGNwdSkKPiAgIHsKPiAtICAgIHJldHVybiBjc2NoZWQyX3BjcHUoY3B1KS0+cnVucV9pZDsKPiAr
ICAgIHJldHVybiBjc2NoZWQyX3BjcHUoY3B1KS0+cnFkLT5pZDsKPiAgIH0KPiAgIAo+ICAgLyog
Q1BVIHRvIHJ1bnF1ZXVlIHN0cnVjdCBtYWNybyAqLwo+IC1zdGF0aWMgaW5saW5lIHN0cnVjdCBj
c2NoZWQyX3J1bnF1ZXVlX2RhdGEgKmMycnFkKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywK
PiAtICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNp
Z25lZCBpbnQgY3B1KQo+ICtzdGF0aWMgaW5saW5lIHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2Rh
dGEgKmMycnFkKHVuc2lnbmVkIGludCBjcHUpCj4gICB7Cj4gLSAgICByZXR1cm4gJmNzY2hlZDJf
cHJpdihvcHMpLT5ycWRbYzJyKGNwdSldOwo+ICsgICAgcmV0dXJuIGNzY2hlZDJfcGNwdShjcHUp
LT5ycWQ7Cj4gICB9Cj4gICAKPiAgIC8qIERvZXMgdGhlIGRvbWFpbiBvZiB0aGlzIHVuaXQgaGF2
ZSBhIGNhcD8gKi8KPiBAQCAtODAzLDM2ICs4MDYsNiBAQCBzdGF0aWMgaW5saW5lIHN0cnVjdCBj
c2NoZWQyX3VuaXQgKiBydW5xX2VsZW0oc3RydWN0IGxpc3RfaGVhZCAqZWxlbSkKPiAgICAgICBy
ZXR1cm4gbGlzdF9lbnRyeShlbGVtLCBzdHJ1Y3QgY3NjaGVkMl91bml0LCBydW5xX2VsZW0pOwo+
ICAgfQo+ICAgCj4gLXN0YXRpYyB2b2lkIGFjdGl2YXRlX3J1bnF1ZXVlKHN0cnVjdCBjc2NoZWQy
X3ByaXZhdGUgKnBydiwgaW50IHJxaSkKPiAtewo+IC0gICAgc3RydWN0IGNzY2hlZDJfcnVucXVl
dWVfZGF0YSAqcnFkOwo+IC0KPiAtICAgIHJxZCA9IHBydi0+cnFkICsgcnFpOwo+IC0KPiAtICAg
IEJVR19PTighY3B1bWFza19lbXB0eSgmcnFkLT5hY3RpdmUpKTsKPiAtCj4gLSAgICBycWQtPm1h
eF93ZWlnaHQgPSAxOwo+IC0gICAgcnFkLT5pZCA9IHJxaTsKPiAtICAgIElOSVRfTElTVF9IRUFE
KCZycWQtPnN2Yyk7Cj4gLSAgICBJTklUX0xJU1RfSEVBRCgmcnFkLT5ydW5xKTsKPiAtICAgIHNw
aW5fbG9ja19pbml0KCZycWQtPmxvY2spOwo+IC0KPiAtICAgIF9fY3B1bWFza19zZXRfY3B1KHJx
aSwgJnBydi0+YWN0aXZlX3F1ZXVlcyk7Cj4gLX0KPiAtCj4gLXN0YXRpYyB2b2lkIGRlYWN0aXZh
dGVfcnVucXVldWUoc3RydWN0IGNzY2hlZDJfcHJpdmF0ZSAqcHJ2LCBpbnQgcnFpKQo+IC17Cj4g
LSAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQ7Cj4gLQo+IC0gICAgcnFkID0g
cHJ2LT5ycWQgKyBycWk7Cj4gLQo+IC0gICAgQlVHX09OKCFjcHVtYXNrX2VtcHR5KCZycWQtPmFj
dGl2ZSkpOwo+IC0KPiAtICAgIHJxZC0+aWQgPSAtMTsKPiAtCj4gLSAgICBfX2NwdW1hc2tfY2xl
YXJfY3B1KHJxaSwgJnBydi0+YWN0aXZlX3F1ZXVlcyk7Cj4gLX0KPiAtCj4gICBzdGF0aWMgaW5s
aW5lIGJvb2wgc2FtZV9ub2RlKHVuc2lnbmVkIGludCBjcHVhLCB1bnNpZ25lZCBpbnQgY3B1YikK
PiAgIHsKPiAgICAgICByZXR1cm4gY3B1X3RvX25vZGUoY3B1YSkgPT0gY3B1X3RvX25vZGUoY3B1
Yik7Cj4gQEAgLTg0OSw1MSArODIyLDcxIEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBzYW1lX2NvcmUo
dW5zaWduZWQgaW50IGNwdWEsIHVuc2lnbmVkIGludCBjcHViKQo+ICAgICAgICAgICAgICBjcHVf
dG9fY29yZShjcHVhKSA9PSBjcHVfdG9fY29yZShjcHViKTsKPiAgIH0KPiAgIAo+IC1zdGF0aWMg
dW5zaWduZWQgaW50Cj4gLWNwdV90b19ydW5xdWV1ZShjb25zdCBzdHJ1Y3QgY3NjaGVkMl9wcml2
YXRlICpwcnYsIHVuc2lnbmVkIGludCBjcHUpCj4gK3N0YXRpYyBzdHJ1Y3QgY3NjaGVkMl9ydW5x
dWV1ZV9kYXRhICoKPiArY3B1X2FkZF90b19ydW5xdWV1ZShzdHJ1Y3QgY3NjaGVkMl9wcml2YXRl
ICpwcnYsIHVuc2lnbmVkIGludCBjcHUpCj4gICB7Cj4gLSAgICBjb25zdCBzdHJ1Y3QgY3NjaGVk
Ml9ydW5xdWV1ZV9kYXRhICpycWQ7Cj4gLSAgICB1bnNpZ25lZCBpbnQgcnFpOwo+ICsgICAgc3Ry
dWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFkLCAqcnFkX25ldzsKPiArICAgIHN0cnVjdCBs
aXN0X2hlYWQgKnJxZF9pbnM7Cj4gKyAgICB1bnNpZ25lZCBsb25nIGZsYWdzOwo+ICsgICAgaW50
IHJxaSA9IDA7Cj4gKyAgICBib29sIHJxaV91bnVzZWQgPSBmYWxzZSwgcnFkX3ZhbGlkID0gZmFs
c2U7Cj4gKwo+ICsgICAgcnFkX25ldyA9IHh6YWxsb2Moc3RydWN0IGNzY2hlZDJfcnVucXVldWVf
ZGF0YSk7Cj4gICAKPiAtICAgIGZvciAoIHJxaSA9IDA7IHJxaSA8IG5yX2NwdV9pZHM7IHJxaSsr
ICkKPiArICAgIHdyaXRlX2xvY2tfaXJxc2F2ZSgmcHJ2LT5sb2NrLCBmbGFncyk7Cj4gKwo+ICsg
ICAgcnFkX2lucyA9ICZwcnYtPnJxbDsKPiArICAgIGxpc3RfZm9yX2VhY2hfZW50cnkgKCBycWQs
ICZwcnYtPnJxbCwgcnFsICkKPiAgICAgICB7Cj4gICAgICAgICAgIHVuc2lnbmVkIGludCBwZWVy
X2NwdTsKPiAgIAo+IC0gICAgICAgIC8qCj4gLSAgICAgICAgICogQXMgc29vbiBhcyB3ZSBjb21l
IGFjcm9zcyBhbiB1bmluaXRpYWxpemVkIHJ1bnF1ZXVlLCB1c2UgaXQuCj4gLSAgICAgICAgICog
SW4gZmFjdCwgZWl0aGVyOgo+IC0gICAgICAgICAqICAtIHdlIGFyZSBpbml0aWFsaXppbmcgdGhl
IGZpcnN0IGNwdSwgYW5kIHdlIGFzc2lnbiBpdCB0bwo+IC0gICAgICAgICAqICAgIHJ1bnF1ZXVl
IDAuIFRoaXMgaXMgaGFuZHksIGVzcGVjaWFsbHkgaWYgd2UgYXJlIGRlYWxpbmcKPiAtICAgICAg
ICAgKiAgICB3aXRoIHRoZSBib290IGNwdSAoaWYgY3JlZGl0MiBpcyB0aGUgZGVmYXVsdCBzY2hl
ZHVsZXIpLAo+IC0gICAgICAgICAqICAgIGFzIHdlIHdvdWxkIG5vdCBiZSBhYmxlIHRvIHVzZSBj
cHVfdG9fc29ja2V0KCkgYW5kIHNpbWlsYXIKPiAtICAgICAgICAgKiAgICBoZWxwZXJzIGFueXdh
eSAodGhleSdyZSByZXN1bHQgb2Ygd2hpY2ggaXMgbm90IHJlbGlhYmxlIHlldCk7Cj4gLSAgICAg
ICAgICogIC0gd2UgaGF2ZSBnb25lIHRocm91Z2ggYWxsIHRoZSBhY3RpdmUgcnVucXVldWVzLCBh
bmQgaGF2ZSBub3QKPiAtICAgICAgICAgKiAgICBmb3VuZCBhbnlvbmUgd2hvc2UgY3B1cycgdG9w
b2xvZ3kgbWF0Y2hlcyB0aGUgb25lIHdlIGFyZQo+IC0gICAgICAgICAqICAgIGRlYWxpbmcgd2l0
aCwgc28gYWN0aXZhdGluZyBhIG5ldyBydW5xdWV1ZSBpcyB3aGF0IHdlIHdhbnQuCj4gLSAgICAg
ICAgICovCj4gLSAgICAgICAgaWYgKCBwcnYtPnJxZFtycWldLmlkID09IC0xICkKPiAtICAgICAg
ICAgICAgYnJlYWs7Cj4gKyAgICAgICAgLyogUmVtZW1iZXIgZmlyc3QgdW51c2VkIHF1ZXVlIGlu
ZGV4LiAqLwo+ICsgICAgICAgIGlmICggIXJxaV91bnVzZWQgJiYgcnFkLT5pZCA+IHJxaSApCj4g
KyAgICAgICAgICAgIHJxaV91bnVzZWQgPSB0cnVlOwo+ICAgCj4gLSAgICAgICAgcnFkID0gcHJ2
LT5ycWQgKyBycWk7Cj4gLSAgICAgICAgQlVHX09OKGNwdW1hc2tfZW1wdHkoJnJxZC0+YWN0aXZl
KSk7Cj4gLQo+IC0gICAgICAgIHBlZXJfY3B1ID0gY3B1bWFza19maXJzdCgmcnFkLT5hY3RpdmUp
Owo+ICsgICAgICAgIHBlZXJfY3B1ID0gcnFkLT5waWNrX2JpYXM7Cj4gICAgICAgICAgIEJVR19P
TihjcHVfdG9fc29ja2V0KGNwdSkgPT0gWEVOX0lOVkFMSURfU09DS0VUX0lEIHx8Cj4gICAgICAg
ICAgICAgICAgICBjcHVfdG9fc29ja2V0KHBlZXJfY3B1KSA9PSBYRU5fSU5WQUxJRF9TT0NLRVRf
SUQpOwo+ICAgCj4gLSAgICAgICAgaWYgKG9wdF9ydW5xdWV1ZSA9PSBPUFRfUlVOUVVFVUVfQ1BV
KQo+IC0gICAgICAgICAgICBjb250aW51ZTsKPiAgICAgICAgICAgaWYgKCBvcHRfcnVucXVldWUg
PT0gT1BUX1JVTlFVRVVFX0FMTCB8fAo+ICAgICAgICAgICAgICAgIChvcHRfcnVucXVldWUgPT0g
T1BUX1JVTlFVRVVFX0NPUkUgJiYgc2FtZV9jb3JlKHBlZXJfY3B1LCBjcHUpKSB8fAo+ICAgICAg
ICAgICAgICAgIChvcHRfcnVucXVldWUgPT0gT1BUX1JVTlFVRVVFX1NPQ0tFVCAmJiBzYW1lX3Nv
Y2tldChwZWVyX2NwdSwgY3B1KSkgfHwKPiAgICAgICAgICAgICAgICAob3B0X3J1bnF1ZXVlID09
IE9QVF9SVU5RVUVVRV9OT0RFICYmIHNhbWVfbm9kZShwZWVyX2NwdSwgY3B1KSkgKQo+ICsgICAg
ICAgIHsKPiArICAgICAgICAgICAgcnFkX3ZhbGlkID0gdHJ1ZTsKPiAgICAgICAgICAgICAgIGJy
ZWFrOwo+ICsgICAgICAgIH0KPiArCj4gKyAgICAgICAgaWYgKCAhcnFpX3VudXNlZCApCj4gKyAg
ICAgICAgewo+ICsgICAgICAgICAgICBycWkrKzsKPiArICAgICAgICAgICAgcnFkX2lucyA9ICZy
cWQtPnJxbDsKPiArICAgICAgICB9Cj4gKyAgICB9Cj4gKwo+ICsgICAgaWYgKCAhcnFkX3ZhbGlk
ICkKPiArICAgIHsKPiArICAgICAgICBpZiAoICFycWRfbmV3ICkKPiArICAgICAgICB7Cj4gKyAg
ICAgICAgICAgIHJxZCA9IEVSUl9QVFIoLUVOT01FTSk7Cj4gKyAgICAgICAgICAgIGdvdG8gb3V0
Owo+ICsgICAgICAgIH0KPiArICAgICAgICBycWQgPSBycWRfbmV3Owo+ICsgICAgICAgIHJxZF9u
ZXcgPSBOVUxMOwo+ICsKPiArICAgICAgICBsaXN0X2FkZCgmcnFkLT5ycWwsIHJxZF9pbnMpOwo+
ICsgICAgICAgIHJxZC0+cGlja19iaWFzID0gY3B1Owo+ICsgICAgICAgIHJxZC0+aWQgPSBycWk7
Cj4gICAgICAgfQo+ICAgCj4gLSAgICAvKiBXZSByZWFsbHkgZXhwZWN0IHRvIGJlIGFibGUgdG8g
YXNzaWduIGVhY2ggY3B1IHRvIGEgcnVucXVldWUuICovCj4gLSAgICBCVUdfT04ocnFpID49IG5y
X2NwdV9pZHMpOwo+ICsgICAgcnFkLT5yZWZjbnQrKzsKPiArCj4gKyBvdXQ6Cj4gKyAgICB3cml0
ZV91bmxvY2tfaXJxcmVzdG9yZSgmcHJ2LT5sb2NrLCBmbGFncyk7Cj4gKwo+ICsgICAgeGZyZWUo
cnFkX25ldyk7Cj4gICAKPiAtICAgIHJldHVybiBycWk7Cj4gKyAgICByZXR1cm4gcnFkOwo+ICAg
fQo+ICAgCj4gICAvKiBGaW5kIHRoZSBkb21haW4gd2l0aCB0aGUgaGlnaGVzdCB3ZWlnaHQuICov
Cj4gQEAgLTk3MSwxMyArOTY0LDEzIEBAIF9ydW5xX2Fzc2lnbihzdHJ1Y3QgY3NjaGVkMl91bml0
ICpzdmMsIHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCkKPiAgIH0KPiAgIAo+ICAg
c3RhdGljIHZvaWQKPiAtcnVucV9hc3NpZ24oY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBj
b25zdCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKPiArcnVucV9hc3NpZ24oY29uc3Qgc3RydWN0
IHNjaGVkX3VuaXQgKnVuaXQpCj4gICB7Cj4gICAgICAgc3RydWN0IGNzY2hlZDJfdW5pdCAqc3Zj
ID0gdW5pdC0+cHJpdjsKPiAgIAo+ICAgICAgIEFTU0VSVChzdmMtPnJxZCA9PSBOVUxMKTsKPiAg
IAo+IC0gICAgX3J1bnFfYXNzaWduKHN2YywgYzJycWQob3BzLCBzY2hlZF91bml0X21hc3Rlcih1
bml0KSkpOwo+ICsgICAgX3J1bnFfYXNzaWduKHN2YywgYzJycWQoc2NoZWRfdW5pdF9tYXN0ZXIo
dW5pdCkpKTsKPiAgIH0KPiAgIAo+ICAgc3RhdGljIHZvaWQKPiBAQCAtOTk4LDExICs5OTEsMTEg
QEAgX3J1bnFfZGVhc3NpZ24oc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQo+ICAgfQo+ICAgCj4g
ICBzdGF0aWMgdm9pZAo+IC1ydW5xX2RlYXNzaWduKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9w
cywgY29uc3Qgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCj4gK3J1bnFfZGVhc3NpZ24oY29uc3Qg
c3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCj4gICB7Cj4gICAgICAgc3RydWN0IGNzY2hlZDJfdW5p
dCAqc3ZjID0gdW5pdC0+cHJpdjsKPiAgIAo+IC0gICAgQVNTRVJUKHN2Yy0+cnFkID09IGMycnFk
KG9wcywgc2NoZWRfdW5pdF9tYXN0ZXIodW5pdCkpKTsKPiArICAgIEFTU0VSVChzdmMtPnJxZCA9
PSBjMnJxZChzY2hlZF91bml0X21hc3Rlcih1bml0KSkpOwo+ICAgCj4gICAgICAgX3J1bnFfZGVh
c3NpZ24oc3ZjKTsKPiAgIH0KPiBAQCAtMTI3MSwxMiArMTI2NCwxMSBAQCB1cGRhdGVfbG9hZChj
b25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCj4gICAgICAgICAgIHVwZGF0ZV9zdmNfbG9hZChv
cHMsIHN2YywgY2hhbmdlLCBub3cpOwo+ICAgfQo+ICAgCj4gLXN0YXRpYyB2b2lkCj4gLXJ1bnFf
aW5zZXJ0KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IGNzY2hlZDJfdW5pdCAq
c3ZjKQo+ICtzdGF0aWMgdm9pZCBydW5xX2luc2VydChzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMp
Cj4gICB7Cj4gICAgICAgc3RydWN0IGxpc3RfaGVhZCAqaXRlcjsKPiAgICAgICB1bnNpZ25lZCBp
bnQgY3B1ID0gc2NoZWRfdW5pdF9tYXN0ZXIoc3ZjLT51bml0KTsKPiAtICAgIHN0cnVjdCBsaXN0
X2hlYWQgKiBydW5xID0gJmMycnFkKG9wcywgY3B1KS0+cnVucTsKPiArICAgIHN0cnVjdCBsaXN0
X2hlYWQgKnJ1bnEgPSAmYzJycWQoY3B1KS0+cnVucTsKPiAgICAgICBpbnQgcG9zID0gMDsKPiAg
IAo+ICAgICAgIEFTU0VSVChzcGluX2lzX2xvY2tlZChnZXRfc2NoZWRfcmVzKGNwdSktPnNjaGVk
dWxlX2xvY2spKTsKPiBAQCAtMTM2NSw3ICsxMzU3LDcgQEAgc3RhdGljIGlubGluZSBib29sIGlz
X3ByZWVtcHRhYmxlKGNvbnN0IHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YywKPiAgIHN0YXRpYyBz
X3RpbWVfdCB0aWNrbGVfc2NvcmUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzX3RpbWVf
dCBub3csCj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cnVjdCBjc2No
ZWQyX3VuaXQgKm5ldywgdW5zaWduZWQgaW50IGNwdSkKPiAgIHsKPiAtICAgIHN0cnVjdCBjc2No
ZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCA9IGMycnFkKG9wcywgY3B1KTsKPiArICAgIHN0cnVjdCBj
c2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCA9IGMycnFkKGNwdSk7Cj4gICAgICAgc3RydWN0IGNz
Y2hlZDJfdW5pdCAqIGN1ciA9IGNzY2hlZDJfdW5pdChjdXJyX29uX2NwdShjcHUpKTsKPiAgICAg
ICBjb25zdCBzdHJ1Y3QgY3NjaGVkMl9wcml2YXRlICpwcnYgPSBjc2NoZWQyX3ByaXYob3BzKTsK
PiAgICAgICBzX3RpbWVfdCBzY29yZTsKPiBAQCAtMTQ0MSw3ICsxNDMzLDcgQEAgcnVucV90aWNr
bGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgY3NjaGVkMl91bml0ICpuZXcs
IHNfdGltZV90IG5vdykKPiAgICAgICBzX3RpbWVfdCBtYXggPSAwOwo+ICAgICAgIHN0cnVjdCBz
Y2hlZF91bml0ICp1bml0ID0gbmV3LT51bml0Owo+ICAgICAgIHVuc2lnbmVkIGludCBicywgY3B1
ID0gc2NoZWRfdW5pdF9tYXN0ZXIodW5pdCk7Cj4gLSAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1
ZV9kYXRhICpycWQgPSBjMnJxZChvcHMsIGNwdSk7Cj4gKyAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5x
dWV1ZV9kYXRhICpycWQgPSBjMnJxZChjcHUpOwo+ICAgICAgIGNvbnN0IGNwdW1hc2tfdCAqb25s
aW5lID0gY3B1cG9vbF9kb21haW5fbWFzdGVyX2NwdW1hc2sodW5pdC0+ZG9tYWluKTsKPiAgICAg
ICBjcHVtYXNrX3QgbWFzazsKPiAgIAo+IEBAIC0xNjE3LDEwICsxNjA5LDkgQEAgcnVucV90aWNr
bGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgY3NjaGVkMl91bml0ICpuZXcs
IHNfdGltZV90IG5vdykKPiAgIC8qCj4gICAgKiBDcmVkaXQtcmVsYXRlZCBjb2RlCj4gICAgKi8K
PiAtc3RhdGljIHZvaWQgcmVzZXRfY3JlZGl0KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywg
aW50IGNwdSwgc190aW1lX3Qgbm93LAo+IC0gICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0
IGNzY2hlZDJfdW5pdCAqc25leHQpCj4gK3N0YXRpYyB2b2lkIHJlc2V0X2NyZWRpdChpbnQgY3B1
LCBzX3RpbWVfdCBub3csIHN0cnVjdCBjc2NoZWQyX3VuaXQgKnNuZXh0KQo+ICAgewo+IC0gICAg
c3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFkID0gYzJycWQob3BzLCBjcHUpOwo+ICsg
ICAgc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFkID0gYzJycWQoY3B1KTsKPiAgICAg
ICBzdHJ1Y3QgbGlzdF9oZWFkICppdGVyOwo+ICAgICAgIGludCBtOwo+ICAgCj4gQEAgLTE5MDks
NyArMTkwMCw3IEBAIHVucGFya19wYXJrZWRfdW5pdHMoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAq
b3BzLCBzdHJ1Y3QgbGlzdF9oZWFkICp1bml0cykKPiAgICAgICAgICAgICAgICAqIGZvciB0aGUg
bmV3bHkgcmVwbGVuaXNoZWQgYnVkZ2V0Lgo+ICAgICAgICAgICAgICAgICovCj4gICAgICAgICAg
ICAgICBBU1NFUlQoIHN2Yy0+cnFkICE9IE5VTEwgKTsKPiAtICAgICAgICAgICAgQVNTRVJUKCBj
MnJxZChvcHMsIHNjaGVkX3VuaXRfbWFzdGVyKHN2Yy0+dW5pdCkpID09IHN2Yy0+cnFkICk7Cj4g
KyAgICAgICAgICAgIEFTU0VSVCggYzJycWQoc2NoZWRfdW5pdF9tYXN0ZXIoc3ZjLT51bml0KSkg
PT0gc3ZjLT5ycWQgKTsKPiAgICAgICAgICAgICAgIF9fc2V0X2JpdChfX0NTRkxBR19kZWxheWVk
X3J1bnFfYWRkLCAmc3ZjLT5mbGFncyk7Cj4gICAgICAgICAgIH0KPiAgICAgICAgICAgZWxzZSBp
ZiAoIHVuaXRfcnVubmFibGUoc3ZjLT51bml0KSApCj4gQEAgLTE5MjIsNyArMTkxMyw3IEBAIHVu
cGFya19wYXJrZWRfdW5pdHMoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgbGlz
dF9oZWFkICp1bml0cykKPiAgICAgICAgICAgICAgICAqLwo+ICAgICAgICAgICAgICAgbm93ID0g
Tk9XKCk7Cj4gICAgICAgICAgICAgICB1cGRhdGVfbG9hZChvcHMsIHN2Yy0+cnFkLCBzdmMsIDEs
IG5vdyk7Cj4gLSAgICAgICAgICAgIHJ1bnFfaW5zZXJ0KG9wcywgc3ZjKTsKPiArICAgICAgICAg
ICAgcnVucV9pbnNlcnQoc3ZjKTsKPiAgICAgICAgICAgICAgIHJ1bnFfdGlja2xlKG9wcywgc3Zj
LCBub3cpOwo+ICAgICAgICAgICB9Cj4gICAgICAgICAgIGxpc3RfZGVsX2luaXQoJnN2Yy0+cGFy
a2VkX2VsZW0pOwo+IEBAIC0yMDg3LDcgKzIwNzgsNyBAQCBjc2NoZWQyX3VuaXRfc2xlZXAoY29u
c3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKPiAgICAg
ICB9Cj4gICAgICAgZWxzZSBpZiAoIHVuaXRfb25fcnVucShzdmMpICkKPiAgICAgICB7Cj4gLSAg
ICAgICAgQVNTRVJUKHN2Yy0+cnFkID09IGMycnFkKG9wcywgc2NoZWRfdW5pdF9tYXN0ZXIodW5p
dCkpKTsKPiArICAgICAgICBBU1NFUlQoc3ZjLT5ycWQgPT0gYzJycWQoc2NoZWRfdW5pdF9tYXN0
ZXIodW5pdCkpKTsKPiAgICAgICAgICAgdXBkYXRlX2xvYWQob3BzLCBzdmMtPnJxZCwgc3ZjLCAt
MSwgTk9XKCkpOwo+ICAgICAgICAgICBydW5xX3JlbW92ZShzdmMpOwo+ICAgICAgIH0KPiBAQCAt
MjEzNCwxNiArMjEyNSwxNiBAQCBjc2NoZWQyX3VuaXRfd2FrZShjb25zdCBzdHJ1Y3Qgc2NoZWR1
bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQo+ICAgCj4gICAgICAgLyogQWRkIGlu
dG8gdGhlIG5ldyBydW5xdWV1ZSBpZiBuZWNlc3NhcnkgKi8KPiAgICAgICBpZiAoIHN2Yy0+cnFk
ID09IE5VTEwgKQo+IC0gICAgICAgIHJ1bnFfYXNzaWduKG9wcywgdW5pdCk7Cj4gKyAgICAgICAg
cnVucV9hc3NpZ24odW5pdCk7Cj4gICAgICAgZWxzZQo+IC0gICAgICAgIEFTU0VSVChjMnJxZChv
cHMsIHNjaGVkX3VuaXRfbWFzdGVyKHVuaXQpKSA9PSBzdmMtPnJxZCApOwo+ICsgICAgICAgIEFT
U0VSVChjMnJxZChzY2hlZF91bml0X21hc3Rlcih1bml0KSkgPT0gc3ZjLT5ycWQgKTsKPiAgIAo+
ICAgICAgIG5vdyA9IE5PVygpOwo+ICAgCj4gICAgICAgdXBkYXRlX2xvYWQob3BzLCBzdmMtPnJx
ZCwgc3ZjLCAxLCBub3cpOwo+ICAgCj4gICAgICAgLyogUHV0IHRoZSBVTklUIG9uIHRoZSBydW5x
ICovCj4gLSAgICBydW5xX2luc2VydChvcHMsIHN2Yyk7Cj4gKyAgICBydW5xX2luc2VydChzdmMp
Owo+ICAgICAgIHJ1bnFfdGlja2xlKG9wcywgc3ZjLCBub3cpOwo+ICAgCj4gICBvdXQ6Cj4gQEAg
LTIxNjcsOSArMjE1OCw5IEBAIGNzY2hlZDJfY29udGV4dF9zYXZlZChjb25zdCBzdHJ1Y3Qgc2No
ZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQo+ICAgICAgIExJU1RfSEVBRCh3
ZXJlX3BhcmtlZCk7Cj4gICAKPiAgICAgICBCVUdfT04oICFpc19pZGxlX3VuaXQodW5pdCkgJiYK
PiAtICAgICAgICAgICAgc3ZjLT5ycWQgIT0gYzJycWQob3BzLCBzY2hlZF91bml0X21hc3Rlcih1
bml0KSkpOwo+ICsgICAgICAgICAgICBzdmMtPnJxZCAhPSBjMnJxZChzY2hlZF91bml0X21hc3Rl
cih1bml0KSkpOwo+ICAgICAgIEFTU0VSVChpc19pZGxlX3VuaXQodW5pdCkgfHwKPiAtICAgICAg
ICAgICBzdmMtPnJxZCA9PSBjMnJxZChvcHMsIHNjaGVkX3VuaXRfbWFzdGVyKHVuaXQpKSk7Cj4g
KyAgICAgICAgICAgc3ZjLT5ycWQgPT0gYzJycWQoc2NoZWRfdW5pdF9tYXN0ZXIodW5pdCkpKTsK
PiAgIAo+ICAgICAgIC8qIFRoaXMgdW5pdCBpcyBub3cgZWxpZ2libGUgdG8gYmUgcHV0IG9uIHRo
ZSBydW5xdWV1ZSBhZ2FpbiAqLwo+ICAgICAgIF9fY2xlYXJfYml0KF9fQ1NGTEFHX3NjaGVkdWxl
ZCwgJnN2Yy0+ZmxhZ3MpOwo+IEBAIC0yMTkwLDcgKzIxODEsNyBAQCBjc2NoZWQyX2NvbnRleHRf
c2F2ZWQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5p
dCkKPiAgICAgICB7Cj4gICAgICAgICAgIEFTU0VSVCghdW5pdF9vbl9ydW5xKHN2YykpOwo+ICAg
Cj4gLSAgICAgICAgcnVucV9pbnNlcnQob3BzLCBzdmMpOwo+ICsgICAgICAgIHJ1bnFfaW5zZXJ0
KHN2Yyk7Cj4gICAgICAgICAgIHJ1bnFfdGlja2xlKG9wcywgc3ZjLCBub3cpOwo+ICAgICAgIH0K
PiAgICAgICBlbHNlIGlmICggIWlzX2lkbGVfdW5pdCh1bml0KSApCj4gQEAgLTIyMDYsMTMgKzIx
OTcsMTMgQEAgc3RhdGljIHN0cnVjdCBzY2hlZF9yZXNvdXJjZSAqCj4gICBjc2NoZWQyX3Jlc19w
aWNrKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgY29uc3Qgc3RydWN0IHNjaGVkX3VuaXQg
KnVuaXQpCj4gICB7Cj4gICAgICAgc3RydWN0IGNzY2hlZDJfcHJpdmF0ZSAqcHJ2ID0gY3NjaGVk
Ml9wcml2KG9wcyk7Cj4gLSAgICBpbnQgaSwgbWluX3JxaSA9IC0xLCBtaW5fc19ycWkgPSAtMTsK
PiAgICAgICB1bnNpZ25lZCBpbnQgbmV3X2NwdSwgY3B1ID0gc2NoZWRfdW5pdF9tYXN0ZXIodW5p
dCk7Cj4gICAgICAgc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjID0gY3NjaGVkMl91bml0KHVuaXQp
Owo+ICAgICAgIHNfdGltZV90IG1pbl9hdmdsb2FkID0gTUFYX0xPQUQsIG1pbl9zX2F2Z2xvYWQg
PSBNQVhfTE9BRDsKPiAgICAgICBib29sIGhhc19zb2Z0Owo+ICsgICAgc3RydWN0IGNzY2hlZDJf
cnVucXVldWVfZGF0YSAqcnFkLCAqbWluX3JxZCA9IE5VTEwsICptaW5fc19ycWQgPSBOVUxMOwo+
ICAgCj4gLSAgICBBU1NFUlQoIWNwdW1hc2tfZW1wdHkoJnBydi0+YWN0aXZlX3F1ZXVlcykpOwo+
ICsgICAgQVNTRVJUKCFsaXN0X2VtcHR5KCZwcnYtPnJxbCkpOwo+ICAgCj4gICAgICAgU0NIRURf
U1RBVF9DUkFOSyhwaWNrX3Jlc291cmNlKTsKPiAgIAo+IEBAIC0yMjkwLDEzICsyMjgxLDEwIEBA
IGNzY2hlZDJfcmVzX3BpY2soY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBjb25zdCBzdHJ1
Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKPiAgICAgICAgKiBGaW5kIGJvdGggcnVucXVldWVzIGluIG9u
ZSBwYXNzLgo+ICAgICAgICAqLwo+ICAgICAgIGhhc19zb2Z0ID0gaGFzX3NvZnRfYWZmaW5pdHko
dW5pdCk7Cj4gLSAgICBmb3JfZWFjaF9jcHUoaSwgJnBydi0+YWN0aXZlX3F1ZXVlcykKPiArICAg
IGxpc3RfZm9yX2VhY2hfZW50cnkgKCBycWQsICZwcnYtPnJxbCwgcnFsICkKPiAgICAgICB7Cj4g
LSAgICAgICAgc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFkOwo+ICAgICAgICAgICBz
X3RpbWVfdCBycWRfYXZnbG9hZCA9IE1BWF9MT0FEOwo+ICAgCj4gLSAgICAgICAgcnFkID0gcHJ2
LT5ycWQgKyBpOwo+IC0KPiAgICAgICAgICAgLyoKPiAgICAgICAgICAgICogSWYgbm9uZSBvZiB0
aGUgY3B1cyBvZiB0aGlzIHJ1bnF1ZXVlIGlzIGluIHN2YydzIGhhcmQtYWZmaW5pdHksCj4gICAg
ICAgICAgICAqIHNraXAgdGhlIHJ1bnF1ZXVlLgo+IEBAIC0yMzM5LDE4ICsyMzI3LDE4IEBAIGNz
Y2hlZDJfcmVzX3BpY2soY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBjb25zdCBzdHJ1Y3Qg
c2NoZWRfdW5pdCAqdW5pdCkKPiAgICAgICAgICAgICAgIGlmICggY3B1bWFza19pbnRlcnNlY3Rz
KCZtYXNrLCB1bml0LT5jcHVfc29mdF9hZmZpbml0eSkgKQo+ICAgICAgICAgICAgICAgewo+ICAg
ICAgICAgICAgICAgICAgIG1pbl9zX2F2Z2xvYWQgPSBycWRfYXZnbG9hZDsKPiAtICAgICAgICAg
ICAgICAgIG1pbl9zX3JxaSA9IGk7Cj4gKyAgICAgICAgICAgICAgICBtaW5fc19ycWQgPSBycWQ7
Cj4gICAgICAgICAgICAgICB9Cj4gICAgICAgICAgIH0KPiAgICAgICAgICAgLyogSW4gYW55IGNh
c2UsIGtlZXAgdGhlICJoYXJkLWFmZmluaXR5IG1pbmltdW0iIHVwZGF0ZWQgdG9vLiAqLwo+ICAg
ICAgICAgICBpZiAoIHJxZF9hdmdsb2FkIDwgbWluX2F2Z2xvYWQgKQo+ICAgICAgICAgICB7Cj4g
ICAgICAgICAgICAgICBtaW5fYXZnbG9hZCA9IHJxZF9hdmdsb2FkOwo+IC0gICAgICAgICAgICBt
aW5fcnFpID0gaTsKPiArICAgICAgICAgICAgbWluX3JxZCA9IHJxZDsKPiAgICAgICAgICAgfQo+
ICAgICAgIH0KPiAgIAo+IC0gICAgaWYgKCBoYXNfc29mdCAmJiBtaW5fc19ycWkgIT0gLTEgKQo+
ICsgICAgaWYgKCBoYXNfc29mdCAmJiBtaW5fc19ycWQgKQo+ICAgICAgIHsKPiAgICAgICAgICAg
LyoKPiAgICAgICAgICAgICogV2UgaGF2ZSBzb2Z0IGFmZmluaXR5LCBhbmQgd2UgaGF2ZSBhIGNh
bmRpZGF0ZSBydW5xLCBzbyBnbyBmb3IgaXQuCj4gQEAgLTIzNzAsOSArMjM1OCw5IEBAIGNzY2hl
ZDJfcmVzX3BpY2soY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBjb25zdCBzdHJ1Y3Qgc2No
ZWRfdW5pdCAqdW5pdCkKPiAgICAgICAgICAgY3B1bWFza19hbmQoY3B1bWFza19zY3JhdGNoX2Nw
dShjcHUpLCBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksCj4gICAgICAgICAgICAgICAgICAgICAg
IHVuaXQtPmNwdV9zb2Z0X2FmZmluaXR5KTsKPiAgICAgICAgICAgY3B1bWFza19hbmQoY3B1bWFz
a19zY3JhdGNoX2NwdShjcHUpLCBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksCj4gLSAgICAgICAg
ICAgICAgICAgICAgJnBydi0+cnFkW21pbl9zX3JxaV0uYWN0aXZlKTsKPiArICAgICAgICAgICAg
ICAgICAgICAmbWluX3NfcnFkLT5hY3RpdmUpOwo+ICAgICAgIH0KPiAtICAgIGVsc2UgaWYgKCBt
aW5fcnFpICE9IC0xICkKPiArICAgIGVsc2UgaWYgKCBtaW5fcnFkICkKPiAgICAgICB7Cj4gICAg
ICAgICAgIC8qCj4gICAgICAgICAgICAqIEVpdGhlciB3ZSBkb24ndCBoYXZlIHNvZnQtYWZmaW5p
dHksIG9yIHdlIGRvLCBidXQgd2UgZGlkIG5vdCBmaW5kCj4gQEAgLTIzODQsNyArMjM3Miw3IEBA
IGNzY2hlZDJfcmVzX3BpY2soY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBjb25zdCBzdHJ1
Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKPiAgICAgICAgICAgICogd2l0aCB0aGUgY3B1cyBvZiB0aGUg
cnVucS4KPiAgICAgICAgICAgICovCj4gICAgICAgICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tfc2Ny
YXRjaF9jcHUoY3B1KSwgY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLAo+IC0gICAgICAgICAgICAg
ICAgICAgICZwcnYtPnJxZFttaW5fcnFpXS5hY3RpdmUpOwo+ICsgICAgICAgICAgICAgICAgICAg
ICZtaW5fcnFkLT5hY3RpdmUpOwo+ICAgICAgIH0KPiAgICAgICBlbHNlCj4gICAgICAgewo+IEBA
IC0yMzkzLDE0ICsyMzgxLDEzIEBAIGNzY2hlZDJfcmVzX3BpY2soY29uc3Qgc3RydWN0IHNjaGVk
dWxlciAqb3BzLCBjb25zdCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKPiAgICAgICAgICAgICog
Y29udGVudGlvbikuCj4gICAgICAgICAgICAqLwo+ICAgICAgICAgICBuZXdfY3B1ID0gZ2V0X2Zh
bGxiYWNrX2NwdShzdmMpOwo+IC0gICAgICAgIG1pbl9ycWkgPSBjMnIobmV3X2NwdSk7Cj4gLSAg
ICAgICAgbWluX2F2Z2xvYWQgPSBwcnYtPnJxZFttaW5fcnFpXS5iX2F2Z2xvYWQ7Cj4gKyAgICAg
ICAgbWluX3JxZCA9IGMycnFkKG5ld19jcHUpOwo+ICsgICAgICAgIG1pbl9hdmdsb2FkID0gbWlu
X3JxZC0+Yl9hdmdsb2FkOwo+ICAgICAgICAgICBnb3RvIG91dF91cDsKPiAgICAgICB9Cj4gICAK
PiAtICAgIG5ld19jcHUgPSBjcHVtYXNrX2N5Y2xlKHBydi0+cnFkW21pbl9ycWldLnBpY2tfYmlh
cywKPiAtICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1
KSk7Cj4gLSAgICBwcnYtPnJxZFttaW5fcnFpXS5waWNrX2JpYXMgPSBuZXdfY3B1Owo+ICsgICAg
bmV3X2NwdSA9IGNwdW1hc2tfY3ljbGUobWluX3JxZC0+cGlja19iaWFzLCBjcHVtYXNrX3NjcmF0
Y2hfY3B1KGNwdSkpOwo+ICsgICAgbWluX3JxZC0+cGlja19iaWFzID0gbmV3X2NwdTsKPiAgICAg
ICBCVUdfT04obmV3X2NwdSA+PSBucl9jcHVfaWRzKTsKPiAgIAo+ICAgIG91dF91cDoKPiBAQCAt
MjQxNSw3ICsyNDAyLDcgQEAgY3NjaGVkMl9yZXNfcGljayhjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVy
ICpvcHMsIGNvbnN0IHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQo+ICAgICAgICAgICB9IGQ7Cj4g
ICAgICAgICAgIGQuZG9tID0gdW5pdC0+ZG9tYWluLT5kb21haW5faWQ7Cj4gICAgICAgICAgIGQu
dW5pdCA9IHVuaXQtPnVuaXRfaWQ7Cj4gLSAgICAgICAgZC5ycV9pZCA9IG1pbl9ycWk7Cj4gKyAg
ICAgICAgZC5ycV9pZCA9IG1pbl9ycWQtPmlkOwo+ICAgICAgICAgICBkLmJfYXZnbG9hZCA9IG1p
bl9hdmdsb2FkOwo+ICAgICAgICAgICBkLm5ld19jcHUgPSBuZXdfY3B1Owo+ICAgICAgICAgICBf
X3RyYWNlX3ZhcihUUkNfQ1NDSEVEMl9QSUNLRURfQ1BVLCAxLAo+IEBAIC0yNTI4LDcgKzI1MTUs
NyBAQCBzdGF0aWMgdm9pZCBtaWdyYXRlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKPiAg
ICAgICAgICAgaWYgKCBvbl9ydW5xICkKPiAgICAgICAgICAgewo+ICAgICAgICAgICAgICAgdXBk
YXRlX2xvYWQob3BzLCBzdmMtPnJxZCwgTlVMTCwgMSwgbm93KTsKPiAtICAgICAgICAgICAgcnVu
cV9pbnNlcnQob3BzLCBzdmMpOwo+ICsgICAgICAgICAgICBydW5xX2luc2VydChzdmMpOwo+ICAg
ICAgICAgICAgICAgcnVucV90aWNrbGUob3BzLCBzdmMsIG5vdyk7Cj4gICAgICAgICAgICAgICBT
Q0hFRF9TVEFUX0NSQU5LKG1pZ3JhdGVfb25fcnVucSk7Cj4gICAgICAgICAgIH0KPiBAQCAtMjU1
OCw5ICsyNTQ1LDkgQEAgc3RhdGljIGJvb2wgdW5pdF9pc19taWdyYXRlYWJsZShjb25zdCBzdHJ1
Y3QgY3NjaGVkMl91bml0ICpzdmMsCj4gICBzdGF0aWMgdm9pZCBiYWxhbmNlX2xvYWQoY29uc3Qg
c3RydWN0IHNjaGVkdWxlciAqb3BzLCBpbnQgY3B1LCBzX3RpbWVfdCBub3cpCj4gICB7Cj4gICAg
ICAgc3RydWN0IGNzY2hlZDJfcHJpdmF0ZSAqcHJ2ID0gY3NjaGVkMl9wcml2KG9wcyk7Cj4gLSAg
ICBpbnQgaSwgbWF4X2RlbHRhX3JxaTsKPiAgICAgICBzdHJ1Y3QgbGlzdF9oZWFkICpwdXNoX2l0
ZXIsICpwdWxsX2l0ZXI7Cj4gICAgICAgYm9vbCBpbm5lcl9sb2FkX3VwZGF0ZWQgPSAwOwo+ICsg
ICAgc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFkLCAqbWF4X2RlbHRhX3JxZDsKPiAg
IAo+ICAgICAgIGJhbGFuY2Vfc3RhdGVfdCBzdCA9IHsgLmJlc3RfcHVzaF9zdmMgPSBOVUxMLCAu
YmVzdF9wdWxsX3N2YyA9IE5VTEwgfTsKPiAgIAo+IEBAIC0yNTcyLDIyICsyNTU5LDIyIEBAIHN0
YXRpYyB2b2lkIGJhbGFuY2VfbG9hZChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGludCBj
cHUsIHNfdGltZV90IG5vdykKPiAgICAgICAgKi8KPiAgIAo+ICAgICAgIEFTU0VSVChzcGluX2lz
X2xvY2tlZChnZXRfc2NoZWRfcmVzKGNwdSktPnNjaGVkdWxlX2xvY2spKTsKPiAtICAgIHN0Lmxy
cWQgPSBjMnJxZChvcHMsIGNwdSk7Cj4gKyAgICBzdC5scnFkID0gYzJycWQoY3B1KTsKPiAgIAo+
ICAgICAgIHVwZGF0ZV9ydW5xX2xvYWQob3BzLCBzdC5scnFkLCAwLCBub3cpOwo+ICAgCj4gICBy
ZXRyeToKPiAtICAgIG1heF9kZWx0YV9ycWkgPSAtMTsKPiArICAgIG1heF9kZWx0YV9ycWQgPSBO
VUxMOwo+ICAgICAgIGlmICggIXJlYWRfdHJ5bG9jaygmcHJ2LT5sb2NrKSApCj4gICAgICAgICAg
IHJldHVybjsKPiAgIAo+ICAgICAgIHN0LmxvYWRfZGVsdGEgPSAwOwo+ICAgCj4gLSAgICBmb3Jf
ZWFjaF9jcHUoaSwgJnBydi0+YWN0aXZlX3F1ZXVlcykKPiArICAgIGxpc3RfZm9yX2VhY2hfZW50
cnkgKCBycWQsICZwcnYtPnJxbCwgcnFsICkKPiAgICAgICB7Cj4gICAgICAgICAgIHNfdGltZV90
IGRlbHRhOwo+ICAgCj4gLSAgICAgICAgc3Qub3JxZCA9IHBydi0+cnFkICsgaTsKPiArICAgICAg
ICBzdC5vcnFkID0gcnFkOwo+ICAgCj4gICAgICAgICAgIGlmICggc3Qub3JxZCA9PSBzdC5scnFk
Cj4gICAgICAgICAgICAgICAgfHwgIXNwaW5fdHJ5bG9jaygmc3Qub3JxZC0+bG9jaykgKQo+IEBA
IC0yNjAyLDcgKzI1ODksNyBAQCByZXRyeToKPiAgICAgICAgICAgaWYgKCBkZWx0YSA+IHN0Lmxv
YWRfZGVsdGEgKQo+ICAgICAgICAgICB7Cj4gICAgICAgICAgICAgICBzdC5sb2FkX2RlbHRhID0g
ZGVsdGE7Cj4gLSAgICAgICAgICAgIG1heF9kZWx0YV9ycWkgPSBpOwo+ICsgICAgICAgICAgICBt
YXhfZGVsdGFfcnFkID0gcnFkOwo+ICAgICAgICAgICB9Cj4gICAKPiAgICAgICAgICAgc3Bpbl91
bmxvY2soJnN0Lm9ycWQtPmxvY2spOwo+IEBAIC0yNjEwLDcgKzI1OTcsNyBAQCByZXRyeToKPiAg
IAo+ICAgICAgIC8qIE1pbmltaXplIGhvbGRpbmcgdGhlIHByaXZhdGUgc2NoZWR1bGVyIGxvY2su
ICovCj4gICAgICAgcmVhZF91bmxvY2soJnBydi0+bG9jayk7Cj4gLSAgICBpZiAoIG1heF9kZWx0
YV9ycWkgPT0gLTEgKQo+ICsgICAgaWYgKCAhbWF4X2RlbHRhX3JxZCApCj4gICAgICAgICAgIGdv
dG8gb3V0Owo+ICAgCj4gICAgICAgewo+IEBAIC0yNjIyLDEwICsyNjA5LDcgQEAgcmV0cnk6Cj4g
ICAgICAgICAgIGlmICggc3Qub3JxZC0+Yl9hdmdsb2FkID4gbG9hZF9tYXggKQo+ICAgICAgICAg
ICAgICAgbG9hZF9tYXggPSBzdC5vcnFkLT5iX2F2Z2xvYWQ7Cj4gICAKPiAtICAgICAgICBjcHVz
X21heCA9IHN0LmxycWQtPm5yX2NwdXM7Cj4gLSAgICAgICAgaSA9IHN0Lm9ycWQtPm5yX2NwdXM7
Cj4gLSAgICAgICAgaWYgKCBpID4gY3B1c19tYXggKQo+IC0gICAgICAgICAgICBjcHVzX21heCA9
IGk7Cj4gKyAgICAgICAgY3B1c19tYXggPSBtYXgoc3QubHJxZC0+bnJfY3B1cywgc3Qub3JxZC0+
bnJfY3B1cyk7Cj4gICAKPiAgICAgICAgICAgaWYgKCB1bmxpa2VseSh0Yl9pbml0X2RvbmUpICkK
PiAgICAgICAgICAgewo+IEBAIC0yNjYxLDcgKzI2NDUsNyBAQCByZXRyeToKPiAgICAgICAgKiBt
ZWFudGltZSwgdHJ5IHRoZSBwcm9jZXNzIG92ZXIgYWdhaW4uICBUaGlzIGNhbid0IGRlYWRsb2Nr
Cj4gICAgICAgICogYmVjYXVzZSBpZiBpdCBkb2Vzbid0IGdldCBhbnkgb3RoZXIgcnFkIGxvY2tz
LCBpdCB3aWxsIHNpbXBseQo+ICAgICAgICAqIGdpdmUgdXAgYW5kIHJldHVybi4gKi8KPiAtICAg
IHN0Lm9ycWQgPSBwcnYtPnJxZCArIG1heF9kZWx0YV9ycWk7Cj4gKyAgICBzdC5vcnFkID0gbWF4
X2RlbHRhX3JxZDsKPiAgICAgICBpZiAoICFzcGluX3RyeWxvY2soJnN0Lm9ycWQtPmxvY2spICkK
PiAgICAgICAgICAgZ290byByZXRyeTsKPiAgIAo+IEBAIC0yNzUyLDcgKzI3MzYsNyBAQCBjc2No
ZWQyX3VuaXRfbWlncmF0ZSgKPiAgICAgICBBU1NFUlQoY3B1bWFza190ZXN0X2NwdShuZXdfY3B1
LCAmY3NjaGVkMl9wcml2KG9wcyktPmluaXRpYWxpemVkKSk7Cj4gICAgICAgQVNTRVJUKGNwdW1h
c2tfdGVzdF9jcHUobmV3X2NwdSwgdW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHkpKTsKPiAgIAo+IC0g
ICAgdHJxZCA9IGMycnFkKG9wcywgbmV3X2NwdSk7Cj4gKyAgICB0cnFkID0gYzJycWQobmV3X2Nw
dSk7Cj4gICAKPiAgICAgICAvKgo+ICAgICAgICAqIERvIHRoZSBhY3R1YWwgbW92ZW1lbnQgdG93
YXJkIG5ld19jcHUsIGFuZCB1cGRhdGUgdmMtPnByb2Nlc3Nvci4KPiBAQCAtMjgxNiw3ICsyODAw
LDcgQEAgY3NjaGVkMl9kb21fY250bCgKPiAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVk
Ml91bml0ICpzdmMgPSBjc2NoZWQyX3VuaXQodW5pdCk7Cj4gICAgICAgICAgICAgICAgICAgc3Bp
bmxvY2tfdCAqbG9jayA9IHVuaXRfc2NoZWR1bGVfbG9jayh1bml0KTsKPiAgIAo+IC0gICAgICAg
ICAgICAgICAgQVNTRVJUKHN2Yy0+cnFkID09IGMycnFkKG9wcywgc2NoZWRfdW5pdF9tYXN0ZXIo
dW5pdCkpKTsKPiArICAgICAgICAgICAgICAgIEFTU0VSVChzdmMtPnJxZCA9PSBjMnJxZChzY2hl
ZF91bml0X21hc3Rlcih1bml0KSkpOwo+ICAgCj4gICAgICAgICAgICAgICAgICAgc3ZjLT53ZWln
aHQgPSBzZG9tLT53ZWlnaHQ7Cj4gICAgICAgICAgICAgICAgICAgdXBkYXRlX21heF93ZWlnaHQo
c3ZjLT5ycWQsIHN2Yy0+d2VpZ2h0LCBvbGRfd2VpZ2h0KTsKPiBAQCAtMjg5OSw3ICsyODgzLDcg
QEAgY3NjaGVkMl9kb21fY250bCgKPiAgICAgICAgICAgICAgICAgICAgICAgaWYgKCB1bml0LT5p
c19ydW5uaW5nICkKPiAgICAgICAgICAgICAgICAgICAgICAgewo+ICAgICAgICAgICAgICAgICAg
ICAgICAgICAgdW5zaWduZWQgaW50IGNwdSA9IHNjaGVkX3VuaXRfbWFzdGVyKHVuaXQpOwo+IC0g
ICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQg
PSBjMnJxZChvcHMsIGNwdSk7Cj4gKyAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBjc2No
ZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCA9IGMycnFkKGNwdSk7Cj4gICAKPiAgICAgICAgICAgICAg
ICAgICAgICAgICAgIEFTU0VSVChjdXJyX29uX2NwdShjcHUpID09IHVuaXQpOwo+ICAgCj4gQEAg
LTMwOTQsNyArMzA3OCw3IEBAIGNzY2hlZDJfdW5pdF9pbnNlcnQoY29uc3Qgc3RydWN0IHNjaGVk
dWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKPiAgICAgICBsb2NrID0gdW5pdF9z
Y2hlZHVsZV9sb2NrX2lycSh1bml0KTsKPiAgIAo+ICAgICAgIC8qIEFkZCB1bml0IHRvIHJ1bnF1
ZXVlIG9mIGluaXRpYWwgcHJvY2Vzc29yICovCj4gLSAgICBydW5xX2Fzc2lnbihvcHMsIHVuaXQp
Owo+ICsgICAgcnVucV9hc3NpZ24odW5pdCk7Cj4gICAKPiAgICAgICB1bml0X3NjaGVkdWxlX3Vu
bG9ja19pcnEobG9jaywgdW5pdCk7Cj4gICAKPiBAQCAtMzEyNyw3ICszMTExLDcgQEAgY3NjaGVk
Ml91bml0X3JlbW92ZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91
bml0ICp1bml0KQo+ICAgICAgIC8qIFJlbW92ZSBmcm9tIHJ1bnF1ZXVlICovCj4gICAgICAgbG9j
ayA9IHVuaXRfc2NoZWR1bGVfbG9ja19pcnEodW5pdCk7Cj4gICAKPiAtICAgIHJ1bnFfZGVhc3Np
Z24ob3BzLCB1bml0KTsKPiArICAgIHJ1bnFfZGVhc3NpZ24odW5pdCk7Cj4gICAKPiAgICAgICB1
bml0X3NjaGVkdWxlX3VubG9ja19pcnEobG9jaywgdW5pdCk7Cj4gICAKPiBAQCAtMzE0MSw3ICsz
MTI1LDcgQEAgY3NjaGVkMl9ydW50aW1lKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgaW50
IGNwdSwKPiAgIHsKPiAgICAgICBzX3RpbWVfdCB0aW1lLCBtaW5fdGltZTsKPiAgICAgICBpbnQg
cnRfY3JlZGl0OyAvKiBQcm9wb3NlZCBydW50aW1lIG1lYXN1cmVkIGluIGNyZWRpdHMgKi8KPiAt
ICAgIHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCA9IGMycnFkKG9wcywgY3B1KTsK
PiArICAgIHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCA9IGMycnFkKGNwdSk7Cj4g
ICAgICAgc3RydWN0IGxpc3RfaGVhZCAqcnVucSA9ICZycWQtPnJ1bnE7Cj4gICAgICAgY29uc3Qg
c3RydWN0IGNzY2hlZDJfcHJpdmF0ZSAqcHJ2ID0gY3NjaGVkMl9wcml2KG9wcyk7Cj4gICAKPiBA
QCAtMzQzOCw3ICszNDIyLDcgQEAgc3RhdGljIHZvaWQgY3NjaGVkMl9zY2hlZHVsZSgKPiAgIAo+
ICAgICAgIEJVR19PTighY3B1bWFza190ZXN0X2NwdShzY2hlZF9jcHUsICZjc2NoZWQyX3ByaXYo
b3BzKS0+aW5pdGlhbGl6ZWQpKTsKPiAgIAo+IC0gICAgcnFkID0gYzJycWQob3BzLCBzY2hlZF9j
cHUpOwo+ICsgICAgcnFkID0gYzJycWQoc2NoZWRfY3B1KTsKPiAgICAgICBCVUdfT04oIWNwdW1h
c2tfdGVzdF9jcHUoc2NoZWRfY3B1LCAmcnFkLT5hY3RpdmUpKTsKPiAgIAo+ICAgICAgIEFTU0VS
VChzcGluX2lzX2xvY2tlZChnZXRfc2NoZWRfcmVzKHNjaGVkX2NwdSktPnNjaGVkdWxlX2xvY2sp
KTsKPiBAQCAtMzU1Miw3ICszNTM2LDcgQEAgc3RhdGljIHZvaWQgY3NjaGVkMl9zY2hlZHVsZSgK
PiAgICAgICAgICAgICovCj4gICAgICAgICAgIGlmICggc2tpcHBlZF91bml0cyA9PSAwICYmIHNu
ZXh0LT5jcmVkaXQgPD0gQ1NDSEVEMl9DUkVESVRfUkVTRVQgKQo+ICAgICAgICAgICB7Cj4gLSAg
ICAgICAgICAgIHJlc2V0X2NyZWRpdChvcHMsIHNjaGVkX2NwdSwgbm93LCBzbmV4dCk7Cj4gKyAg
ICAgICAgICAgIHJlc2V0X2NyZWRpdChzY2hlZF9jcHUsIG5vdywgc25leHQpOwo+ICAgICAgICAg
ICAgICAgYmFsYW5jZV9sb2FkKG9wcywgc2NoZWRfY3B1LCBub3cpOwo+ICAgICAgICAgICB9Cj4g
ICAKPiBAQCAtMzY1MSw3ICszNjM1LDggQEAgY3NjaGVkMl9kdW1wKGNvbnN0IHN0cnVjdCBzY2hl
ZHVsZXIgKm9wcykKPiAgICAgICBzdHJ1Y3QgbGlzdF9oZWFkICppdGVyX3Nkb207Cj4gICAgICAg
c3RydWN0IGNzY2hlZDJfcHJpdmF0ZSAqcHJ2ID0gY3NjaGVkMl9wcml2KG9wcyk7Cj4gICAgICAg
dW5zaWduZWQgbG9uZyBmbGFnczsKPiAtICAgIHVuc2lnbmVkIGludCBpLCBqLCBsb29wOwo+ICsg
ICAgdW5zaWduZWQgaW50IGosIGxvb3A7Cj4gKyAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9k
YXRhICpycWQ7Cj4gICAKPiAgICAgICAvKgo+ICAgICAgICAqIFdlIG5lZWQgdGhlIHByaXZhdGUg
c2NoZWR1bGVyIGxvY2sgYXMgd2UgYWNjZXNzIGdsb2JhbAo+IEBAIC0zNjYxLDEzICszNjQ2LDEz
IEBAIGNzY2hlZDJfZHVtcChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMpCj4gICAKPiAgICAg
ICBwcmludGsoIkFjdGl2ZSBxdWV1ZXM6ICVkXG4iCj4gICAgICAgICAgICAgICJcdGRlZmF1bHQt
d2VpZ2h0ICAgICA9ICVkXG4iLAo+IC0gICAgICAgICAgIGNwdW1hc2tfd2VpZ2h0KCZwcnYtPmFj
dGl2ZV9xdWV1ZXMpLAo+ICsgICAgICAgICAgIHBydi0+YWN0aXZlX3F1ZXVlcywKPiAgICAgICAg
ICAgICAgQ1NDSEVEMl9ERUZBVUxUX1dFSUdIVCk7Cj4gLSAgICBmb3JfZWFjaF9jcHUoaSwgJnBy
di0+YWN0aXZlX3F1ZXVlcykKPiArICAgIGxpc3RfZm9yX2VhY2hfZW50cnkgKCBycWQsICZwcnYt
PnJxbCwgcnFsICkKPiAgICAgICB7Cj4gICAgICAgICAgIHNfdGltZV90IGZyYWN0aW9uOwo+ICAg
Cj4gLSAgICAgICAgZnJhY3Rpb24gPSAocHJ2LT5ycWRbaV0uYXZnbG9hZCAqIDEwMCkgPj4gcHJ2
LT5sb2FkX3ByZWNpc2lvbl9zaGlmdDsKPiArICAgICAgICBmcmFjdGlvbiA9IChycWQtPmF2Z2xv
YWQgKiAxMDApID4+IHBydi0+bG9hZF9wcmVjaXNpb25fc2hpZnQ7Cj4gICAKPiAgICAgICAgICAg
cHJpbnRrKCJSdW5xdWV1ZSAlZDpcbiIKPiAgICAgICAgICAgICAgICAgICJcdG5jcHVzICAgICAg
ICAgICAgICA9ICV1XG4iCj4gQEAgLTM2NzYsMjEgKzM2NjEsMjEgQEAgY3NjaGVkMl9kdW1wKGNv
bnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcykKPiAgICAgICAgICAgICAgICAgICJcdHBpY2tfYmlh
cyAgICAgICAgICA9ICV1XG4iCj4gICAgICAgICAgICAgICAgICAiXHRpbnN0bG9hZCAgICAgICAg
ICAgPSAlZFxuIgo+ICAgICAgICAgICAgICAgICAgIlx0YXZlbG9hZCAgICAgICAgICAgID0gJSJQ
Uklfc3RpbWUiICh+JSJQUklfc3RpbWUiJSUpXG4iLAo+IC0gICAgICAgICAgICAgICBpLAo+IC0g
ICAgICAgICAgICAgICBwcnYtPnJxZFtpXS5ucl9jcHVzLAo+IC0gICAgICAgICAgICAgICBDUFVN
QVNLX1BSKCZwcnYtPnJxZFtpXS5hY3RpdmUpLAo+IC0gICAgICAgICAgICAgICBwcnYtPnJxZFtp
XS5tYXhfd2VpZ2h0LAo+IC0gICAgICAgICAgICAgICBwcnYtPnJxZFtpXS5waWNrX2JpYXMsCj4g
LSAgICAgICAgICAgICAgIHBydi0+cnFkW2ldLmxvYWQsCj4gLSAgICAgICAgICAgICAgIHBydi0+
cnFkW2ldLmF2Z2xvYWQsCj4gKyAgICAgICAgICAgICAgIHJxZC0+aWQsCj4gKyAgICAgICAgICAg
ICAgIHJxZC0+bnJfY3B1cywKPiArICAgICAgICAgICAgICAgQ1BVTUFTS19QUigmcnFkLT5hY3Rp
dmUpLAo+ICsgICAgICAgICAgICAgICBycWQtPm1heF93ZWlnaHQsCj4gKyAgICAgICAgICAgICAg
IHJxZC0+cGlja19iaWFzLAo+ICsgICAgICAgICAgICAgICBycWQtPmxvYWQsCj4gKyAgICAgICAg
ICAgICAgIHJxZC0+YXZnbG9hZCwKPiAgICAgICAgICAgICAgICAgIGZyYWN0aW9uKTsKPiAgIAo+
ICAgICAgICAgICBwcmludGsoIlx0aWRsZXJzOiAlKnBiXG4iCj4gICAgICAgICAgICAgICAgICAi
XHR0aWNrbGVkOiAlKnBiXG4iCj4gICAgICAgICAgICAgICAgICAiXHRmdWxseSBpZGxlIGNvcmVz
OiAlKnBiXG4iLAo+IC0gICAgICAgICAgICAgICBDUFVNQVNLX1BSKCZwcnYtPnJxZFtpXS5pZGxl
KSwKPiAtICAgICAgICAgICAgICAgQ1BVTUFTS19QUigmcHJ2LT5ycWRbaV0udGlja2xlZCksCj4g
LSAgICAgICAgICAgICAgIENQVU1BU0tfUFIoJnBydi0+cnFkW2ldLnNtdF9pZGxlKSk7Cj4gKyAg
ICAgICAgICAgICAgIENQVU1BU0tfUFIoJnJxZC0+aWRsZSksCj4gKyAgICAgICAgICAgICAgIENQ
VU1BU0tfUFIoJnJxZC0+dGlja2xlZCksCj4gKyAgICAgICAgICAgICAgIENQVU1BU0tfUFIoJnJx
ZC0+c210X2lkbGUpKTsKPiAgICAgICB9Cj4gICAKPiAgICAgICBwcmludGsoIkRvbWFpbiBpbmZv
OlxuIik7Cj4gQEAgLTM3MjIsMTYgKzM3MDcsMTUgQEAgY3NjaGVkMl9kdW1wKGNvbnN0IHN0cnVj
dCBzY2hlZHVsZXIgKm9wcykKPiAgICAgICAgICAgfQo+ICAgICAgIH0KPiAgIAo+IC0gICAgZm9y
X2VhY2hfY3B1KGksICZwcnYtPmFjdGl2ZV9xdWV1ZXMpCj4gKyAgICBsaXN0X2Zvcl9lYWNoX2Vu
dHJ5ICggcnFkLCAmcHJ2LT5ycWwsIHJxbCApCj4gICAgICAgewo+IC0gICAgICAgIHN0cnVjdCBj
c2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCA9IHBydi0+cnFkICsgaTsKPiAgICAgICAgICAgc3Ry
dWN0IGxpc3RfaGVhZCAqaXRlciwgKnJ1bnEgPSAmcnFkLT5ydW5xOwo+ICAgICAgICAgICBpbnQg
bG9vcCA9IDA7Cj4gICAKPiAgICAgICAgICAgLyogV2UgbmVlZCB0aGUgbG9jayB0byBzY2FuIHRo
ZSBydW5xdWV1ZS4gKi8KPiAgICAgICAgICAgc3Bpbl9sb2NrKCZycWQtPmxvY2spOwo+ICAgCj4g
LSAgICAgICAgcHJpbnRrKCJSdW5xdWV1ZSAlZDpcbiIsIGkpOwo+ICsgICAgICAgIHByaW50aygi
UnVucXVldWUgJWQ6XG4iLCBycWQtPmlkKTsKPiAgIAo+ICAgICAgICAgICBmb3JfZWFjaF9jcHUo
aiwgJnJxZC0+YWN0aXZlKQo+ICAgICAgICAgICAgICAgZHVtcF9wY3B1KG9wcywgaik7Cj4gQEAg
LTM3NTYsMjAgKzM3NDAsMjggQEAgY3NjaGVkMl9kdW1wKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIg
Km9wcykKPiAgIHN0YXRpYyB2b2lkICoKPiAgIGNzY2hlZDJfYWxsb2NfcGRhdGEoY29uc3Qgc3Ry
dWN0IHNjaGVkdWxlciAqb3BzLCBpbnQgY3B1KQo+ICAgewo+ICsgICAgc3RydWN0IGNzY2hlZDJf
cHJpdmF0ZSAqcHJ2ID0gY3NjaGVkMl9wcml2KG9wcyk7Cj4gICAgICAgc3RydWN0IGNzY2hlZDJf
cGNwdSAqc3BjOwo+ICsgICAgc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFkOwo+ICAg
Cj4gICAgICAgc3BjID0geHphbGxvYyhzdHJ1Y3QgY3NjaGVkMl9wY3B1KTsKPiAgICAgICBpZiAo
IHNwYyA9PSBOVUxMICkKPiAgICAgICAgICAgcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7Cj4gICAK
PiAtICAgIC8qIE5vdCBpbiBhbnkgcnVucXVldWUgeWV0ICovCj4gLSAgICBzcGMtPnJ1bnFfaWQg
PSAtMTsKPiArICAgIHJxZCA9IGNwdV9hZGRfdG9fcnVucXVldWUocHJ2LCBjcHUpOwo+ICsgICAg
aWYgKCBJU19FUlIocnFkKSApCj4gKyAgICB7Cj4gKyAgICAgICAgeGZyZWUoc3BjKTsKPiArICAg
ICAgICByZXR1cm4gcnFkOwo+ICsgICAgfQo+ICsKPiArICAgIHNwYy0+cnFkID0gcnFkOwo+ICAg
Cj4gICAgICAgcmV0dXJuIHNwYzsKPiAgIH0KPiAgIAo+ICAgLyogUmV0dXJucyB0aGUgSUQgb2Yg
dGhlIHJ1bnF1ZXVlIHRoZSBjcHUgaXMgYXNzaWduZWQgdG8uICovCj4gLXN0YXRpYyB1bnNpZ25l
ZAo+ICtzdGF0aWMgc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqCj4gICBpbml0X3BkYXRh
KHN0cnVjdCBjc2NoZWQyX3ByaXZhdGUgKnBydiwgc3RydWN0IGNzY2hlZDJfcGNwdSAqc3BjLAo+
ICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgY3B1KQo+ICAgewo+IEBAIC0zNzc5LDE4ICszNzcx
LDIzIEBAIGluaXRfcGRhdGEoc3RydWN0IGNzY2hlZDJfcHJpdmF0ZSAqcHJ2LCBzdHJ1Y3QgY3Nj
aGVkMl9wY3B1ICpzcGMsCj4gICAgICAgQVNTRVJUKHJ3X2lzX3dyaXRlX2xvY2tlZCgmcHJ2LT5s
b2NrKSk7Cj4gICAgICAgQVNTRVJUKCFjcHVtYXNrX3Rlc3RfY3B1KGNwdSwgJnBydi0+aW5pdGlh
bGl6ZWQpKTsKPiAgICAgICAvKiBDUFUgZGF0YSBuZWVkcyB0byBiZSBhbGxvY2F0ZWQsIGJ1dCBz
dGlsbCB1bmluaXRpYWxpemVkLiAqLwo+IC0gICAgQVNTRVJUKHNwYyAmJiBzcGMtPnJ1bnFfaWQg
PT0gLTEpOwo+ICsgICAgQVNTRVJUKHNwYyk7Cj4gICAKPiAtICAgIC8qIEZpZ3VyZSBvdXQgd2hp
Y2ggcnVucXVldWUgdG8gcHV0IGl0IGluICovCj4gLSAgICBzcGMtPnJ1bnFfaWQgPSBjcHVfdG9f
cnVucXVldWUocHJ2LCBjcHUpOwo+ICsgICAgcnFkID0gc3BjLT5ycWQ7Cj4gICAKPiAtICAgIHJx
ZCA9IHBydi0+cnFkICsgc3BjLT5ydW5xX2lkOwo+ICsgICAgQVNTRVJUKHJxZCAmJiAhY3B1bWFz
a190ZXN0X2NwdShjcHUsICZzcGMtPnJxZC0+YWN0aXZlKSk7Cj4gICAKPiAtICAgIHByaW50ayhY
RU5MT0dfSU5GTyAiQWRkaW5nIGNwdSAlZCB0byBydW5xdWV1ZSAlZFxuIiwgY3B1LCBzcGMtPnJ1
bnFfaWQpOwo+IC0gICAgaWYgKCAhIGNwdW1hc2tfdGVzdF9jcHUoc3BjLT5ydW5xX2lkLCAmcHJ2
LT5hY3RpdmVfcXVldWVzKSApCj4gKyAgICBwcmludGsoWEVOTE9HX0lORk8gIkFkZGluZyBjcHUg
JWQgdG8gcnVucXVldWUgJWRcbiIsIGNwdSwgcnFkLT5pZCk7Cj4gKyAgICBpZiAoICFycWQtPm5y
X2NwdXMgKQo+ICAgICAgIHsKPiAgICAgICAgICAgcHJpbnRrKFhFTkxPR19JTkZPICIgRmlyc3Qg
Y3B1IG9uIHJ1bnF1ZXVlLCBhY3RpdmF0aW5nXG4iKTsKPiAtICAgICAgICBhY3RpdmF0ZV9ydW5x
dWV1ZShwcnYsIHNwYy0+cnVucV9pZCk7Cj4gKwo+ICsgICAgICAgIEJVR19PTighY3B1bWFza19l
bXB0eSgmcnFkLT5hY3RpdmUpKTsKPiArICAgICAgICBycWQtPm1heF93ZWlnaHQgPSAxOwo+ICsg
ICAgICAgIElOSVRfTElTVF9IRUFEKCZycWQtPnN2Yyk7Cj4gKyAgICAgICAgSU5JVF9MSVNUX0hF
QUQoJnJxZC0+cnVucSk7Cj4gKyAgICAgICAgc3Bpbl9sb2NrX2luaXQoJnJxZC0+bG9jayk7Cj4g
KyAgICAgICAgcHJ2LT5hY3RpdmVfcXVldWVzKys7Cj4gICAgICAgfQo+ICAgCj4gICAgICAgX19j
cHVtYXNrX3NldF9jcHUoY3B1LCAmc3BjLT5zaWJsaW5nX21hc2spOwo+IEBAIC0zODE0LDcgKzM4
MTEsNyBAQCBpbml0X3BkYXRhKHN0cnVjdCBjc2NoZWQyX3ByaXZhdGUgKnBydiwgc3RydWN0IGNz
Y2hlZDJfcGNwdSAqc3BjLAo+ICAgICAgIGlmICggcnFkLT5ucl9jcHVzID09IDEgKQo+ICAgICAg
ICAgICBycWQtPnBpY2tfYmlhcyA9IGNwdTsKPiAgIAo+IC0gICAgcmV0dXJuIHNwYy0+cnVucV9p
ZDsKPiArICAgIHJldHVybiBycWQ7Cj4gICB9Cj4gICAKPiAgIHN0YXRpYyB2b2lkCj4gQEAgLTM4
MjMsMTQgKzM4MjAsMTQgQEAgY3NjaGVkMl9pbml0X3BkYXRhKGNvbnN0IHN0cnVjdCBzY2hlZHVs
ZXIgKm9wcywgdm9pZCAqcGRhdGEsIGludCBjcHUpCj4gICAgICAgc3RydWN0IGNzY2hlZDJfcHJp
dmF0ZSAqcHJ2ID0gY3NjaGVkMl9wcml2KG9wcyk7Cj4gICAgICAgc3BpbmxvY2tfdCAqb2xkX2xv
Y2s7Cj4gICAgICAgdW5zaWduZWQgbG9uZyBmbGFnczsKPiAtICAgIHVuc2lnbmVkIHJxaTsKPiAr
ICAgIHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZDsKPiAgIAo+ICAgICAgIHdyaXRl
X2xvY2tfaXJxc2F2ZSgmcHJ2LT5sb2NrLCBmbGFncyk7Cj4gICAgICAgb2xkX2xvY2sgPSBwY3B1
X3NjaGVkdWxlX2xvY2soY3B1KTsKPiAgIAo+IC0gICAgcnFpID0gaW5pdF9wZGF0YShwcnYsIHBk
YXRhLCBjcHUpOwo+ICsgICAgcnFkID0gaW5pdF9wZGF0YShwcnYsIHBkYXRhLCBjcHUpOwo+ICAg
ICAgIC8qIE1vdmUgdGhlIHNjaGVkdWxlciBsb2NrIHRvIHRoZSBuZXcgcnVucSBsb2NrLiAqLwo+
IC0gICAgZ2V0X3NjaGVkX3JlcyhjcHUpLT5zY2hlZHVsZV9sb2NrID0gJnBydi0+cnFkW3JxaV0u
bG9jazsKPiArICAgIGdldF9zY2hlZF9yZXMoY3B1KS0+c2NoZWR1bGVfbG9jayA9ICZycWQtPmxv
Y2s7Cj4gICAKPiAgICAgICAvKiBfTm90XyBwY3B1X3NjaGVkdWxlX3VubG9jaygpOiBzY2hlZHVs
ZV9sb2NrIG1heSBoYXZlIGNoYW5nZWQhICovCj4gICAgICAgc3Bpbl91bmxvY2sob2xkX2xvY2sp
Owo+IEBAIC0zODQ0LDcgKzM4NDEsNyBAQCBjc2NoZWQyX3N3aXRjaF9zY2hlZChzdHJ1Y3Qgc2No
ZWR1bGVyICpuZXdfb3BzLCB1bnNpZ25lZCBpbnQgY3B1LAo+ICAgewo+ICAgICAgIHN0cnVjdCBj
c2NoZWQyX3ByaXZhdGUgKnBydiA9IGNzY2hlZDJfcHJpdihuZXdfb3BzKTsKPiAgICAgICBzdHJ1
Y3QgY3NjaGVkMl91bml0ICpzdmMgPSB2ZGF0YTsKPiAtICAgIHVuc2lnbmVkIHJxaTsKPiArICAg
IHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZDsKPiAgIAo+ICAgICAgIEFTU0VSVChw
ZGF0YSAmJiBzdmMgJiYgaXNfaWRsZV91bml0KHN2Yy0+dW5pdCkpOwo+ICAgCj4gQEAgLTM4NjEs
NyArMzg1OCw3IEBAIGNzY2hlZDJfc3dpdGNoX3NjaGVkKHN0cnVjdCBzY2hlZHVsZXIgKm5ld19v
cHMsIHVuc2lnbmVkIGludCBjcHUsCj4gICAKPiAgICAgICBzY2hlZF9pZGxlX3VuaXQoY3B1KS0+
cHJpdiA9IHZkYXRhOwo+ICAgCj4gLSAgICBycWkgPSBpbml0X3BkYXRhKHBydiwgcGRhdGEsIGNw
dSk7Cj4gKyAgICBycWQgPSBpbml0X3BkYXRhKHBydiwgcGRhdGEsIGNwdSk7Cj4gICAKPiAgICAg
ICAvKgo+ICAgICAgICAqIE5vdyB0aGF0IHdlIGtub3cgd2hhdCBydW5xdWV1ZSB3ZSdsbCBnbyBp
biwgZG91YmxlIGNoZWNrIHdoYXQncyBzYWlkCj4gQEAgLTM4NjksMTEgKzM4NjYsMTEgQEAgY3Nj
aGVkMl9zd2l0Y2hfc2NoZWQoc3RydWN0IHNjaGVkdWxlciAqbmV3X29wcywgdW5zaWduZWQgaW50
IGNwdSwKPiAgICAgICAgKiB0aGlzIHNjaGVkdWxlciwgYW5kIHNvIGl0J3Mgc2FmZSB0byBoYXZl
IHRha2VuIGl0IC9iZWZvcmUvIG91cgo+ICAgICAgICAqIHByaXZhdGUgZ2xvYmFsIGxvY2suCj4g
ICAgICAgICovCj4gLSAgICBBU1NFUlQoZ2V0X3NjaGVkX3JlcyhjcHUpLT5zY2hlZHVsZV9sb2Nr
ICE9ICZwcnYtPnJxZFtycWldLmxvY2spOwo+ICsgICAgQVNTRVJUKGdldF9zY2hlZF9yZXMoY3B1
KS0+c2NoZWR1bGVfbG9jayAhPSAmcnFkLT5sb2NrKTsKPiAgIAo+ICAgICAgIHdyaXRlX3VubG9j
aygmcHJ2LT5sb2NrKTsKPiAgIAo+IC0gICAgcmV0dXJuICZwcnYtPnJxZFtycWldLmxvY2s7Cj4g
KyAgICByZXR1cm4gJnJxZC0+bG9jazsKPiAgIH0KPiAgIAo+ICAgc3RhdGljIHZvaWQKPiBAQCAt
Mzg5OSwxNiArMzg5NiwxNiBAQCBjc2NoZWQyX2RlaW5pdF9wZGF0YShjb25zdCBzdHJ1Y3Qgc2No
ZWR1bGVyICpvcHMsIHZvaWQgKnBjcHUsIGludCBjcHUpCj4gICAgICAgICogIDIuIGluaXRfcGRh
dGEgbXVzdCBoYXZlIGJlZW4gY2FsbGVkIG9uIHRoaXMgY3B1LCBhbmQgZGVpbml0X3BkYXRhCj4g
ICAgICAgICogICAgICh1cyEpIG11c3Qgbm90IGhhdmUgYmVlbiBjYWxsZWQgb24gaXQgYWxyZWFk
eS4KPiAgICAgICAgKi8KPiAtICAgIEFTU0VSVChzcGMgJiYgc3BjLT5ydW5xX2lkICE9IC0xKTsK
PiArICAgIEFTU0VSVChzcGMgJiYgc3BjLT5ycWQpOwo+ICAgICAgIEFTU0VSVChjcHVtYXNrX3Rl
c3RfY3B1KGNwdSwgJnBydi0+aW5pdGlhbGl6ZWQpKTsKPiAgIAo+ICAgICAgIC8qIEZpbmQgdGhl
IG9sZCBydW5xdWV1ZSBhbmQgcmVtb3ZlIHRoaXMgY3B1IGZyb20gaXQgKi8KPiAtICAgIHJxZCA9
IHBydi0+cnFkICsgc3BjLT5ydW5xX2lkOwo+ICsgICAgcnFkID0gc3BjLT5ycWQ7Cj4gICAKPiAg
ICAgICAvKiBObyBuZWVkIHRvIHNhdmUgSVJRcyBoZXJlLCB0aGV5J3JlIGFscmVhZHkgZGlzYWJs
ZWQgKi8KPiAgICAgICBzcGluX2xvY2soJnJxZC0+bG9jayk7Cj4gICAKPiAtICAgIHByaW50ayhY
RU5MT0dfSU5GTyAiUmVtb3ZpbmcgY3B1ICVkIGZyb20gcnVucXVldWUgJWRcbiIsIGNwdSwgc3Bj
LT5ydW5xX2lkKTsKPiArICAgIHByaW50ayhYRU5MT0dfSU5GTyAiUmVtb3ZpbmcgY3B1ICVkIGZy
b20gcnVucXVldWUgJWRcbiIsIGNwdSwgcnFkLT5pZCk7Cj4gICAKPiAgICAgICBfX2NwdW1hc2tf
Y2xlYXJfY3B1KGNwdSwgJnJxZC0+aWRsZSk7Cj4gICAgICAgX19jcHVtYXNrX2NsZWFyX2NwdShj
cHUsICZycWQtPnNtdF9pZGxlKTsKPiBAQCAtMzkyMywxMyArMzkyMCwxMyBAQCBjc2NoZWQyX2Rl
aW5pdF9wZGF0YShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHZvaWQgKnBjcHUsIGludCBj
cHUpCj4gICAgICAgaWYgKCBycWQtPm5yX2NwdXMgPT0gMCApCj4gICAgICAgewo+ICAgICAgICAg
ICBwcmludGsoWEVOTE9HX0lORk8gIiBObyBjcHVzIGxlZnQgb24gcnVucXVldWUsIGRpc2FibGlu
Z1xuIik7Cj4gLSAgICAgICAgZGVhY3RpdmF0ZV9ydW5xdWV1ZShwcnYsIHNwYy0+cnVucV9pZCk7
Cj4gKwo+ICsgICAgICAgIEJVR19PTighY3B1bWFza19lbXB0eSgmcnFkLT5hY3RpdmUpKTsKPiAr
ICAgICAgICBwcnYtPmFjdGl2ZV9xdWV1ZXMtLTsKPiAgICAgICB9Cj4gICAgICAgZWxzZSBpZiAo
IHJxZC0+cGlja19iaWFzID09IGNwdSApCj4gICAgICAgICAgIHJxZC0+cGlja19iaWFzID0gY3B1
bWFza19maXJzdCgmcnFkLT5hY3RpdmUpOwo+ICAgCj4gLSAgICBzcGMtPnJ1bnFfaWQgPSAtMTsK
PiAtCj4gICAgICAgc3Bpbl91bmxvY2soJnJxZC0+bG9jayk7Cj4gICAKPiAgICAgICBfX2NwdW1h
c2tfY2xlYXJfY3B1KGNwdSwgJnBydi0+aW5pdGlhbGl6ZWQpOwo+IEBAIC0zOTQyLDE4ICszOTM5
LDI5IEBAIGNzY2hlZDJfZGVpbml0X3BkYXRhKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywg
dm9pZCAqcGNwdSwgaW50IGNwdSkKPiAgIHN0YXRpYyB2b2lkCj4gICBjc2NoZWQyX2ZyZWVfcGRh
dGEoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCB2b2lkICpwY3B1LCBpbnQgY3B1KQo+ICAg
ewo+ICsgICAgc3RydWN0IGNzY2hlZDJfcHJpdmF0ZSAqcHJ2ID0gY3NjaGVkMl9wcml2KG9wcyk7
Cj4gICAgICAgc3RydWN0IGNzY2hlZDJfcGNwdSAqc3BjID0gcGNwdTsKPiArICAgIHN0cnVjdCBj
c2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZDsKPiArICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7Cj4g
ICAKPiAtICAgIC8qCj4gLSAgICAgKiBwY3B1IGVpdGhlciBwb2ludHMgdG8gYSB2YWxpZCBzdHJ1
Y3QgY3NjaGVkMl9wY3B1LCBvciBpcyBOVUxMIChpZgo+IC0gICAgICogQ1BVIGJyaW5ndXAgZmFp
bGVkLCBhbmQgd2UncmUgYmVlaW5nIGNhbGxlZCBmcm9tIENQVV9VUF9DQU5DRUxMRUQpLgo+IC0g
ICAgICogeGZyZWUoKSBkb2VzIG5vdCByZWFsbHkgbWluZCwgYnV0IHdlIHdhbnQgdG8gYmUgc3Vy
ZSB0aGF0IGVpdGhlcgo+IC0gICAgICogaW5pdF9wZGF0YSBoYXMgbmV2ZXIgYmVlbiBjYWxsZWQs
IG9yIGRlaW5pdF9wZGF0YSBoYXMgYmVlbiBjYWxsZWQKPiAtICAgICAqIGFscmVhZHkuCj4gLSAg
ICAgKi8KPiAtICAgIEFTU0VSVCghcGNwdSB8fCBzcGMtPnJ1bnFfaWQgPT0gLTEpOwo+IC0gICAg
QVNTRVJUKCFjcHVtYXNrX3Rlc3RfY3B1KGNwdSwgJmNzY2hlZDJfcHJpdihvcHMpLT5pbml0aWFs
aXplZCkpOwo+ICsgICAgaWYgKCAhc3BjICkKPiArICAgICAgICByZXR1cm47Cj4gKwo+ICsgICAg
d3JpdGVfbG9ja19pcnFzYXZlKCZwcnYtPmxvY2ssIGZsYWdzKTsKPiArCj4gKyAgICBycWQgPSBz
cGMtPnJxZDsKPiArICAgIEFTU0VSVChycWQgJiYgcnFkLT5yZWZjbnQpOwo+ICsgICAgQVNTRVJU
KCFjcHVtYXNrX3Rlc3RfY3B1KGNwdSwgJnBydi0+aW5pdGlhbGl6ZWQpKTsKPiArCj4gKyAgICBy
cWQtPnJlZmNudC0tOwo+ICsgICAgaWYgKCAhcnFkLT5yZWZjbnQgKQo+ICsgICAgICAgIGxpc3Rf
ZGVsKCZycWQtPnJxbCk7Cj4gKyAgICBlbHNlCj4gKyAgICAgICAgcnFkID0gTlVMTDsKPiArCj4g
KyAgICB3cml0ZV91bmxvY2tfaXJxcmVzdG9yZSgmcHJ2LT5sb2NrLCBmbGFncyk7Cj4gICAKPiAr
ICAgIHhmcmVlKHJxZCk7Cj4gICAgICAgeGZyZWUocGNwdSk7Cj4gICB9Cj4gICAKPiBAQCAtMzk4
Nyw3ICszOTk1LDYgQEAgY3NjaGVkMl9nbG9iYWxfaW5pdCh2b2lkKQo+ICAgc3RhdGljIGludAo+
ICAgY3NjaGVkMl9pbml0KHN0cnVjdCBzY2hlZHVsZXIgKm9wcykKPiAgIHsKPiAtICAgIGludCBp
Owo+ICAgICAgIHN0cnVjdCBjc2NoZWQyX3ByaXZhdGUgKnBydjsKPiAgIAo+ICAgICAgIHByaW50
aygiSW5pdGlhbGl6aW5nIENyZWRpdDIgc2NoZWR1bGVyXG4iKTsKPiBAQCAtNDAyMCwxOCArNDAy
Nyw5IEBAIGNzY2hlZDJfaW5pdChzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMpCj4gICAgICAgb3BzLT5z
Y2hlZF9kYXRhID0gcHJ2Owo+ICAgCj4gICAgICAgcndsb2NrX2luaXQoJnBydi0+bG9jayk7Cj4g
KyAgICBJTklUX0xJU1RfSEVBRCgmcHJ2LT5ycWwpOwo+ICAgICAgIElOSVRfTElTVF9IRUFEKCZw
cnYtPnNkb20pOwo+ICAgCj4gLSAgICAvKiBBbGxvY2F0ZSBhbGwgcnVucXVldWVzIGFuZCBtYXJr
IHRoZW0gYXMgdW4taW5pdGlhbGl6ZWQgKi8KPiAtICAgIHBydi0+cnFkID0geHphbGxvY19hcnJh
eShzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhLCBucl9jcHVfaWRzKTsKPiAtICAgIGlmICgg
IXBydi0+cnFkICkKPiAtICAgIHsKPiAtICAgICAgICB4ZnJlZShwcnYpOwo+IC0gICAgICAgIHJl
dHVybiAtRU5PTUVNOwo+IC0gICAgfQo+IC0gICAgZm9yICggaSA9IDA7IGkgPCBucl9jcHVfaWRz
OyBpKysgKQo+IC0gICAgICAgIHBydi0+cnFkW2ldLmlkID0gLTE7Cj4gLQo+ICAgICAgIC8qIGlu
aXRpYWxpemUgcmF0ZWxpbWl0ICovCj4gICAgICAgcHJ2LT5yYXRlbGltaXRfdXMgPSBzY2hlZF9y
YXRlbGltaXRfdXM7Cj4gICAKPiBAQCAtNDA0OSw4ICs0MDQ3LDYgQEAgY3NjaGVkMl9kZWluaXQo
c3RydWN0IHNjaGVkdWxlciAqb3BzKQo+ICAgCj4gICAgICAgcHJ2ID0gY3NjaGVkMl9wcml2KG9w
cyk7Cj4gICAgICAgb3BzLT5zY2hlZF9kYXRhID0gTlVMTDsKPiAtICAgIGlmICggcHJ2ICkKPiAt
ICAgICAgICB4ZnJlZShwcnYtPnJxZCk7Cj4gICAgICAgeGZyZWUocHJ2KTsKPiAgIH0KPiAgIAo+
IAoKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1k
ZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8v
bGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

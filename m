Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id BEDBCBC6F5
	for <lists+xen-devel@lfdr.de>; Tue, 24 Sep 2019 13:35:51 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iCj2M-00074K-GU; Tue, 24 Sep 2019 11:31:18 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=LhKX=XT=citrix.com=anthony.perard@srs-us1.protection.inumbo.net>)
 id 1iCj2K-00073c-B9
 for xen-devel@lists.xenproject.org; Tue, 24 Sep 2019 11:31:16 +0000
X-Inumbo-ID: d05226a7-debe-11e9-9616-12813bfff9fa
Received: from esa2.hc3370-68.iphmx.com (unknown [216.71.145.153])
 by localhost (Halon) with ESMTPS
 id d05226a7-debe-11e9-9616-12813bfff9fa;
 Tue, 24 Sep 2019 11:31:15 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1569324676;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=7L6iSgcHG/c+uve0NKelK5BctXcMVLX+wsTXUpwg2PA=;
 b=gVWMdnSXOgGum1hsw5KwBAploLA8Rud/jqxnz2hZtnpCgDSjJodQVWkC
 IwtdP4dyXjfUBPA5RXlWQosviuw4qJZCQQc2ZyosW5PE/6D8Jn2E8R+ww
 tJtU+SV8T+t2SO9rXZVGDovmNBmtooKRSzCPM9SYLiXDZi6emDVfUXaKA U=;
Authentication-Results: esa2.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=anthony.perard@citrix.com;
 spf=Pass smtp.mailfrom=anthony.perard@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa2.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 anthony.perard@citrix.com) identity=pra;
 client-ip=162.221.158.21; receiver=esa2.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="anthony.perard@citrix.com";
 x-conformance=sidf_compatible
Received-SPF: Pass (esa2.hc3370-68.iphmx.com: domain of
 anthony.perard@citrix.com designates 162.221.158.21 as
 permitted sender) identity=mailfrom;
 client-ip=162.221.158.21; receiver=esa2.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="anthony.perard@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83 ~all"
Received-SPF: None (esa2.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa2.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: HuWOP7dnM3Q5DQaZOixldM+ggIx6YQ8di8TGOZIxjE0xodRTpU2ECA9uQ5jwpR4v0zam/B367q
 OFq+z1960EFxc3QQWuD22sz+710TD+SwIt0hCX+uZm5mbXQ9yQD6kEy18GOjoc7PWKR2lihvOl
 1sipdwWFjKpYa/hInkpnU1OcKxzx+IhdylJxQF7qLaO6rwzR7nBMSHdZHHFlla0NY+e37SQNgm
 DXtBCucEgT1/choIucV+rh1zb+U3gMlLZOMtHC8pZlBcueBBs5aOtrI8EarOAeTg3fhhbG8keC
 MKE=
X-SBRS: 2.7
X-MesageID: 5977597
X-Ironport-Server: esa2.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.64,543,1559534400"; 
   d="scan'208";a="5977597"
From: Anthony PERARD <anthony.perard@citrix.com>
To: <qemu-devel@nongnu.org>
Date: Tue, 24 Sep 2019 12:30:21 +0100
Message-ID: <20190924113026.255634-3-anthony.perard@citrix.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190924113026.255634-1-anthony.perard@citrix.com>
References: <20190924113026.255634-1-anthony.perard@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PULL 2/7] xen / notify: introduce a new XenWatchList
 abstraction
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Anthony PERARD <anthony.perard@citrix.com>, xen-devel@lists.xenproject.org,
 Peter Maydell <peter.maydell@linaro.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

RnJvbTogUGF1bCBEdXJyYW50IDxwYXVsLmR1cnJhbnRAY2l0cml4LmNvbT4KClhlbnN0b3JlIHdh
dGNoIGNhbGwtYmFja3MgYXJlIGFscmVhZHkgYWJzdHJhY3RlZCBhd2F5IGZyb20gWGVuQnVzIHVz
aW5nCnRoZSBYZW5XYXRjaCBkYXRhIHN0cnVjdHVyZSBidXQgdGhlIGFzc29jaWF0ZWQgTm90aWZp
ZXJMaXN0IG1hbmlwdWxhdGlvbgphbmQgZmlsZSBoYW5kbGUgcmVnaXN0cmF0aW9uIGlzIHN0aWxs
IG9wZW4gY29kZWQgaW4gdmFyaW91cyB4ZW5fYnVzXy4uLigpCmZ1bmN0aW9ucy4KVGhpcyBwYXRj
aCBjcmVhdGVzIGEgbmV3IFhlbldhdGNoTGlzdCBkYXRhIHN0cnVjdHVyZSB0byBhbGxvdyB0aGVz
ZQppbnRlcmFjdGlvbnMgdG8gYmUgYWJzdHJhY3RlZCBhd2F5IGZyb20gWGVuQnVzIGFzIHdlbGwu
IFRoaXMgaXMgaW4KcHJlcGFyYXRpb24gZm9yIGEgc3Vic2VxdWVudCBwYXRjaCB3aGljaCB3aWxs
IGludHJvZHVjZSBzZXBhcmF0ZSB3YXRjaCBsaXN0cwpmb3IgWGVuQnVzIGFuZCBYZW5EZXZpY2Ug
b2JqZWN0cy4KCk5PVEU6IFRoaXMgcGF0Y2ggYWxzbyBpbnRyb2R1Y2VzIGEgbmV3IG5vdGlmaWVy
X2xpc3RfZW1wdHkoKSBoZWxwZXIgZnVuY3Rpb24KICAgICAgZm9yIHRoZSBwdXJwb3NlcyBvZiBh
ZGRpbmcgYW4gYXNzZXJ0aW9uIHRoYXQgYSBYZW5XYXRjaExpc3QgaXMgbm90CiAgICAgIGZyZWVk
IHdoaWxzdCBpdHMgYXNzb2NpYXRlZCBOb3RpZmllckxpc3QgaXMgc3RpbGwgb2NjdXBpZWQuCgpT
aWduZWQtb2ZmLWJ5OiBQYXVsIER1cnJhbnQgPHBhdWwuZHVycmFudEBjaXRyaXguY29tPgpSZXZp
ZXdlZC1ieTogQW50aG9ueSBQZXJhcmQgPGFudGhvbnkucGVyYXJkQGNpdHJpeC5jb20+Ck1lc3Nh
Z2UtSWQ6IDwyMDE5MDkxMzA4MjE1OS4zMTMzOC0yLXBhdWwuZHVycmFudEBjaXRyaXguY29tPgpT
aWduZWQtb2ZmLWJ5OiBBbnRob255IFBFUkFSRCA8YW50aG9ueS5wZXJhcmRAY2l0cml4LmNvbT4K
LS0tCiBody94ZW4vdHJhY2UtZXZlbnRzICAgICAgfCAgIDUgKy0KIGh3L3hlbi94ZW4tYnVzLmMg
ICAgICAgICB8IDExNyArKysrKysrKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tLS0KIGlu
Y2x1ZGUvaHcveGVuL3hlbi1idXMuaCB8ICAgMyArLQogaW5jbHVkZS9xZW11L25vdGlmeS5oICAg
IHwgICAyICsKIHV0aWwvbm90aWZ5LmMgICAgICAgICAgICB8ICAgNSArKwogNSBmaWxlcyBjaGFu
Z2VkLCA4NyBpbnNlcnRpb25zKCspLCA0NSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9ody94
ZW4vdHJhY2UtZXZlbnRzIGIvaHcveGVuL3RyYWNlLWV2ZW50cwppbmRleCBiYzgyZWNiMWE1Li5h
YzhkOWMyMGQyIDEwMDY0NAotLS0gYS9ody94ZW4vdHJhY2UtZXZlbnRzCisrKyBiL2h3L3hlbi90
cmFjZS1ldmVudHMKQEAgLTE5LDkgKzE5LDggQEAgeGVuX2J1c191bnJlYWxpemUodm9pZCkgIiIK
IHhlbl9idXNfZW51bWVyYXRlKHZvaWQpICIiCiB4ZW5fYnVzX3R5cGVfZW51bWVyYXRlKGNvbnN0
IGNoYXIgKnR5cGUpICJ0eXBlOiAlcyIKIHhlbl9idXNfYmFja2VuZF9jcmVhdGUoY29uc3QgY2hh
ciAqdHlwZSwgY29uc3QgY2hhciAqcGF0aCkgInR5cGU6ICVzIHBhdGg6ICVzIgoteGVuX2J1c19h
ZGRfd2F0Y2goY29uc3QgY2hhciAqbm9kZSwgY29uc3QgY2hhciAqa2V5LCBjaGFyICp0b2tlbikg
Im5vZGU6ICVzIGtleTogJXMgdG9rZW46ICVzIgoteGVuX2J1c19yZW1vdmVfd2F0Y2goY29uc3Qg
Y2hhciAqbm9kZSwgY29uc3QgY2hhciAqa2V5LCBjaGFyICp0b2tlbikgIm5vZGU6ICVzIGtleTog
JXMgdG9rZW46ICVzIgoteGVuX2J1c193YXRjaChjb25zdCBjaGFyICp0b2tlbikgInRva2VuOiAl
cyIKK3hlbl9idXNfYWRkX3dhdGNoKGNvbnN0IGNoYXIgKm5vZGUsIGNvbnN0IGNoYXIgKmtleSkg
Im5vZGU6ICVzIGtleTogJXMiCit4ZW5fYnVzX3JlbW92ZV93YXRjaChjb25zdCBjaGFyICpub2Rl
LCBjb25zdCBjaGFyICprZXkpICJub2RlOiAlcyBrZXk6ICVzIgogeGVuX2RldmljZV9yZWFsaXpl
KGNvbnN0IGNoYXIgKnR5cGUsIGNoYXIgKm5hbWUpICJ0eXBlOiAlcyBuYW1lOiAlcyIKIHhlbl9k
ZXZpY2VfdW5yZWFsaXplKGNvbnN0IGNoYXIgKnR5cGUsIGNoYXIgKm5hbWUpICJ0eXBlOiAlcyBu
YW1lOiAlcyIKIHhlbl9kZXZpY2VfYmFja2VuZF9zdGF0ZShjb25zdCBjaGFyICp0eXBlLCBjaGFy
ICpuYW1lLCBjb25zdCBjaGFyICpzdGF0ZSkgInR5cGU6ICVzIG5hbWU6ICVzIC0+ICVzIgpkaWZm
IC0tZ2l0IGEvaHcveGVuL3hlbi1idXMuYyBiL2h3L3hlbi94ZW4tYnVzLmMKaW5kZXggMDI1ZGY1
ZTU5Zi4uMjhlZmFjY2ZmMiAxMDA2NDQKLS0tIGEvaHcveGVuL3hlbi1idXMuYworKysgYi9ody94
ZW4veGVuLWJ1cy5jCkBAIC0xNTcsMTggKzE1Nyw2MCBAQCBzdGF0aWMgdm9pZCBmcmVlX3dhdGNo
KFhlbldhdGNoICp3YXRjaCkKICAgICBnX2ZyZWUod2F0Y2gpOwogfQogCi1zdGF0aWMgWGVuV2F0
Y2ggKnhlbl9idXNfYWRkX3dhdGNoKFhlbkJ1cyAqeGVuYnVzLCBjb25zdCBjaGFyICpub2RlLAot
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGFyICprZXksIFhlbldh
dGNoSGFuZGxlciBoYW5kbGVyLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2
b2lkICpvcGFxdWUsIEVycm9yICoqZXJycCkKK3N0cnVjdCBYZW5XYXRjaExpc3QgeworICAgIHN0
cnVjdCB4c19oYW5kbGUgKnhzaDsKKyAgICBOb3RpZmllckxpc3Qgbm90aWZpZXJzOworfTsKKwor
c3RhdGljIHZvaWQgd2F0Y2hfbGlzdF9ldmVudCh2b2lkICpvcGFxdWUpCit7CisgICAgWGVuV2F0
Y2hMaXN0ICp3YXRjaF9saXN0ID0gb3BhcXVlOworICAgIGNoYXIgKip2OworICAgIGNvbnN0IGNo
YXIgKnRva2VuOworCisgICAgdiA9IHhzX2NoZWNrX3dhdGNoKHdhdGNoX2xpc3QtPnhzaCk7Cisg
ICAgaWYgKCF2KSB7CisgICAgICAgIHJldHVybjsKKyAgICB9CisKKyAgICB0b2tlbiA9IHZbWFNf
V0FUQ0hfVE9LRU5dOworCisgICAgbm90aWZpZXJfbGlzdF9ub3RpZnkoJndhdGNoX2xpc3QtPm5v
dGlmaWVycywgKHZvaWQgKil0b2tlbik7CisKKyAgICBmcmVlKHYpOworfQorCitzdGF0aWMgWGVu
V2F0Y2hMaXN0ICp3YXRjaF9saXN0X2NyZWF0ZShzdHJ1Y3QgeHNfaGFuZGxlICp4c2gpCit7Cisg
ICAgWGVuV2F0Y2hMaXN0ICp3YXRjaF9saXN0ID0gZ19uZXcwKFhlbldhdGNoTGlzdCwgMSk7CisK
KyAgICBnX2Fzc2VydCh4c2gpOworCisgICAgd2F0Y2hfbGlzdC0+eHNoID0geHNoOworICAgIG5v
dGlmaWVyX2xpc3RfaW5pdCgmd2F0Y2hfbGlzdC0+bm90aWZpZXJzKTsKKyAgICBxZW11X3NldF9m
ZF9oYW5kbGVyKHhzX2ZpbGVubyh3YXRjaF9saXN0LT54c2gpLCB3YXRjaF9saXN0X2V2ZW50LCBO
VUxMLAorICAgICAgICAgICAgICAgICAgICAgICAgd2F0Y2hfbGlzdCk7CisKKyAgICByZXR1cm4g
d2F0Y2hfbGlzdDsKK30KKworc3RhdGljIHZvaWQgd2F0Y2hfbGlzdF9kZXN0cm95KFhlbldhdGNo
TGlzdCAqd2F0Y2hfbGlzdCkKK3sKKyAgICBnX2Fzc2VydChub3RpZmllcl9saXN0X2VtcHR5KCZ3
YXRjaF9saXN0LT5ub3RpZmllcnMpKTsKKyAgICBxZW11X3NldF9mZF9oYW5kbGVyKHhzX2ZpbGVu
byh3YXRjaF9saXN0LT54c2gpLCBOVUxMLCBOVUxMLCBOVUxMKTsKKyAgICBnX2ZyZWUod2F0Y2hf
bGlzdCk7Cit9CisKK3N0YXRpYyBYZW5XYXRjaCAqd2F0Y2hfbGlzdF9hZGQoWGVuV2F0Y2hMaXN0
ICp3YXRjaF9saXN0LCBjb25zdCBjaGFyICpub2RlLAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBjb25zdCBjaGFyICprZXksIFhlbldhdGNoSGFuZGxlciBoYW5kbGVyLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkICpvcGFxdWUsIEVycm9yICoqZXJycCkKIHsK
ICAgICBYZW5XYXRjaCAqd2F0Y2ggPSBuZXdfd2F0Y2gobm9kZSwga2V5LCBoYW5kbGVyLCBvcGFx
dWUpOwogICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCi0gICAgdHJhY2VfeGVuX2J1c19h
ZGRfd2F0Y2god2F0Y2gtPm5vZGUsIHdhdGNoLT5rZXksIHdhdGNoLT50b2tlbik7Ci0KLSAgICBu
b3RpZmllcl9saXN0X2FkZCgmeGVuYnVzLT53YXRjaF9ub3RpZmllcnMsICZ3YXRjaC0+bm90aWZp
ZXIpOworICAgIG5vdGlmaWVyX2xpc3RfYWRkKCZ3YXRjaF9saXN0LT5ub3RpZmllcnMsICZ3YXRj
aC0+bm90aWZpZXIpOwogCi0gICAgeHNfbm9kZV93YXRjaCh4ZW5idXMtPnhzaCwgbm9kZSwga2V5
LCB3YXRjaC0+dG9rZW4sICZsb2NhbF9lcnIpOworICAgIHhzX25vZGVfd2F0Y2god2F0Y2hfbGlz
dC0+eHNoLCBub2RlLCBrZXksIHdhdGNoLT50b2tlbiwgJmxvY2FsX2Vycik7CiAgICAgaWYgKGxv
Y2FsX2VycikgewogICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKIApA
QCAtMTgxLDE4ICsyMjMsMzQgQEAgc3RhdGljIFhlbldhdGNoICp4ZW5fYnVzX2FkZF93YXRjaChY
ZW5CdXMgKnhlbmJ1cywgY29uc3QgY2hhciAqbm9kZSwKICAgICByZXR1cm4gd2F0Y2g7CiB9CiAK
LXN0YXRpYyB2b2lkIHhlbl9idXNfcmVtb3ZlX3dhdGNoKFhlbkJ1cyAqeGVuYnVzLCBYZW5XYXRj
aCAqd2F0Y2gsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcnJvciAqKmVycnAp
CitzdGF0aWMgdm9pZCB3YXRjaF9saXN0X3JlbW92ZShYZW5XYXRjaExpc3QgKndhdGNoX2xpc3Qs
IFhlbldhdGNoICp3YXRjaCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVycm9yICoq
ZXJycCkKIHsKLSAgICB0cmFjZV94ZW5fYnVzX3JlbW92ZV93YXRjaCh3YXRjaC0+bm9kZSwgd2F0
Y2gtPmtleSwgd2F0Y2gtPnRva2VuKTsKLQotICAgIHhzX25vZGVfdW53YXRjaCh4ZW5idXMtPnhz
aCwgd2F0Y2gtPm5vZGUsIHdhdGNoLT5rZXksIHdhdGNoLT50b2tlbiwKKyAgICB4c19ub2RlX3Vu
d2F0Y2god2F0Y2hfbGlzdC0+eHNoLCB3YXRjaC0+bm9kZSwgd2F0Y2gtPmtleSwgd2F0Y2gtPnRv
a2VuLAogICAgICAgICAgICAgICAgICAgICBlcnJwKTsKIAogICAgIG5vdGlmaWVyX3JlbW92ZSgm
d2F0Y2gtPm5vdGlmaWVyKTsKICAgICBmcmVlX3dhdGNoKHdhdGNoKTsKIH0KIAorc3RhdGljIFhl
bldhdGNoICp4ZW5fYnVzX2FkZF93YXRjaChYZW5CdXMgKnhlbmJ1cywgY29uc3QgY2hhciAqbm9k
ZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hhciAqa2V5LCBY
ZW5XYXRjaEhhbmRsZXIgaGFuZGxlciwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgdm9pZCAqb3BhcXVlLCBFcnJvciAqKmVycnApCit7CisgICAgdHJhY2VfeGVuX2J1c19hZGRf
d2F0Y2gobm9kZSwga2V5KTsKKworICAgIHJldHVybiB3YXRjaF9saXN0X2FkZCh4ZW5idXMtPndh
dGNoX2xpc3QsIG5vZGUsIGtleSwgaGFuZGxlciwgb3BhcXVlLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICBlcnJwKTsKK30KKworc3RhdGljIHZvaWQgeGVuX2J1c19yZW1vdmVfd2F0Y2goWGVu
QnVzICp4ZW5idXMsIFhlbldhdGNoICp3YXRjaCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIEVycm9yICoqZXJycCkKK3sKKyAgICB0cmFjZV94ZW5fYnVzX3JlbW92ZV93YXRjaCh3
YXRjaC0+bm9kZSwgd2F0Y2gtPmtleSk7CisKKyAgICB3YXRjaF9saXN0X3JlbW92ZSh4ZW5idXMt
PndhdGNoX2xpc3QsIHdhdGNoLCBlcnJwKTsKK30KKwogc3RhdGljIHZvaWQgeGVuX2J1c19iYWNr
ZW5kX2NyZWF0ZShYZW5CdXMgKnhlbmJ1cywgY29uc3QgY2hhciAqdHlwZSwKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hhciAqbmFtZSwgY2hhciAqcGF0aCwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJwKQpAQCAtMzM4LDM1
ICszOTYsMTQgQEAgc3RhdGljIHZvaWQgeGVuX2J1c191bnJlYWxpemUoQnVzU3RhdGUgKmJ1cywg
RXJyb3IgKiplcnJwKQogICAgICAgICB4ZW5idXMtPmJhY2tlbmRfd2F0Y2ggPSBOVUxMOwogICAg
IH0KIAotICAgIGlmICgheGVuYnVzLT54c2gpIHsKLSAgICAgICAgcmV0dXJuOworICAgIGlmICh4
ZW5idXMtPndhdGNoX2xpc3QpIHsKKyAgICAgICAgd2F0Y2hfbGlzdF9kZXN0cm95KHhlbmJ1cy0+
d2F0Y2hfbGlzdCk7CisgICAgICAgIHhlbmJ1cy0+d2F0Y2hfbGlzdCA9IE5VTEw7CiAgICAgfQog
Ci0gICAgcWVtdV9zZXRfZmRfaGFuZGxlcih4c19maWxlbm8oeGVuYnVzLT54c2gpLCBOVUxMLCBO
VUxMLCBOVUxMKTsKLQotICAgIHhzX2Nsb3NlKHhlbmJ1cy0+eHNoKTsKLX0KLQotc3RhdGljIHZv
aWQgeGVuX2J1c193YXRjaCh2b2lkICpvcGFxdWUpCi17Ci0gICAgWGVuQnVzICp4ZW5idXMgPSBv
cGFxdWU7Ci0gICAgY2hhciAqKnY7Ci0gICAgY29uc3QgY2hhciAqdG9rZW47Ci0KLSAgICBnX2Fz
c2VydCh4ZW5idXMtPnhzaCk7Ci0KLSAgICB2ID0geHNfY2hlY2tfd2F0Y2goeGVuYnVzLT54c2gp
OwotICAgIGlmICghdikgewotICAgICAgICByZXR1cm47CisgICAgaWYgKHhlbmJ1cy0+eHNoKSB7
CisgICAgICAgIHhzX2Nsb3NlKHhlbmJ1cy0+eHNoKTsKICAgICB9Ci0KLSAgICB0b2tlbiA9IHZb
WFNfV0FUQ0hfVE9LRU5dOwotCi0gICAgdHJhY2VfeGVuX2J1c193YXRjaCh0b2tlbik7Ci0KLSAg
ICBub3RpZmllcl9saXN0X25vdGlmeSgmeGVuYnVzLT53YXRjaF9ub3RpZmllcnMsICh2b2lkICop
dG9rZW4pOwotCi0gICAgZnJlZSh2KTsKIH0KIAogc3RhdGljIHZvaWQgeGVuX2J1c19yZWFsaXpl
KEJ1c1N0YXRlICpidXMsIEVycm9yICoqZXJycCkKQEAgLTM5MCw5ICs0MjcsNyBAQCBzdGF0aWMg
dm9pZCB4ZW5fYnVzX3JlYWxpemUoQnVzU3RhdGUgKmJ1cywgRXJyb3IgKiplcnJwKQogICAgICAg
ICB4ZW5idXMtPmJhY2tlbmRfaWQgPSAwOyAvKiBBc3N1bWUgbGFjayBvZiBub2RlIG1lYW5zIGRv
bTAgKi8KICAgICB9CiAKLSAgICBub3RpZmllcl9saXN0X2luaXQoJnhlbmJ1cy0+d2F0Y2hfbm90
aWZpZXJzKTsKLSAgICBxZW11X3NldF9mZF9oYW5kbGVyKHhzX2ZpbGVubyh4ZW5idXMtPnhzaCks
IHhlbl9idXNfd2F0Y2gsIE5VTEwsCi0gICAgICAgICAgICAgICAgICAgICAgICB4ZW5idXMpOwor
ICAgIHhlbmJ1cy0+d2F0Y2hfbGlzdCA9IHdhdGNoX2xpc3RfY3JlYXRlKHhlbmJ1cy0+eHNoKTsK
IAogICAgIG1vZHVsZV9jYWxsX2luaXQoTU9EVUxFX0lOSVRfWEVOX0JBQ0tFTkQpOwogCmRpZmYg
LS1naXQgYS9pbmNsdWRlL2h3L3hlbi94ZW4tYnVzLmggYi9pbmNsdWRlL2h3L3hlbi94ZW4tYnVz
LmgKaW5kZXggMWMyZDlkZmRiOC4uODhiODRlMjliYiAxMDA2NDQKLS0tIGEvaW5jbHVkZS9ody94
ZW4veGVuLWJ1cy5oCisrKyBiL2luY2x1ZGUvaHcveGVuL3hlbi1idXMuaApAQCAtMTQsNiArMTQs
NyBAQAogCiB0eXBlZGVmIHZvaWQgKCpYZW5XYXRjaEhhbmRsZXIpKHZvaWQgKm9wYXF1ZSk7CiAK
K3R5cGVkZWYgc3RydWN0IFhlbldhdGNoTGlzdCBYZW5XYXRjaExpc3Q7CiB0eXBlZGVmIHN0cnVj
dCBYZW5XYXRjaCBYZW5XYXRjaDsKIHR5cGVkZWYgc3RydWN0IFhlbkV2ZW50Q2hhbm5lbCBYZW5F
dmVudENoYW5uZWw7CiAKQEAgLTYzLDcgKzY0LDcgQEAgdHlwZWRlZiBzdHJ1Y3QgWGVuQnVzIHsK
ICAgICBCdXNTdGF0ZSBxYnVzOwogICAgIGRvbWlkX3QgYmFja2VuZF9pZDsKICAgICBzdHJ1Y3Qg
eHNfaGFuZGxlICp4c2g7Ci0gICAgTm90aWZpZXJMaXN0IHdhdGNoX25vdGlmaWVyczsKKyAgICBY
ZW5XYXRjaExpc3QgKndhdGNoX2xpc3Q7CiAgICAgWGVuV2F0Y2ggKmJhY2tlbmRfd2F0Y2g7CiB9
IFhlbkJ1czsKIApkaWZmIC0tZ2l0IGEvaW5jbHVkZS9xZW11L25vdGlmeS5oIGIvaW5jbHVkZS9x
ZW11L25vdGlmeS5oCmluZGV4IGEzZDczZTRiYzcuLmJjZmE3MGZiMmUgMTAwNjQ0Ci0tLSBhL2lu
Y2x1ZGUvcWVtdS9ub3RpZnkuaAorKysgYi9pbmNsdWRlL3FlbXUvbm90aWZ5LmgKQEAgLTQwLDYg
KzQwLDggQEAgdm9pZCBub3RpZmllcl9yZW1vdmUoTm90aWZpZXIgKm5vdGlmaWVyKTsKIAogdm9p
ZCBub3RpZmllcl9saXN0X25vdGlmeShOb3RpZmllckxpc3QgKmxpc3QsIHZvaWQgKmRhdGEpOwog
Citib29sIG5vdGlmaWVyX2xpc3RfZW1wdHkoTm90aWZpZXJMaXN0ICpsaXN0KTsKKwogLyogU2Ft
ZSBhcyBOb3RpZmllciBidXQgYWxsb3dzIC5ub3RpZnkoKSB0byByZXR1cm4gZXJyb3JzICovCiB0
eXBlZGVmIHN0cnVjdCBOb3RpZmllcldpdGhSZXR1cm4gTm90aWZpZXJXaXRoUmV0dXJuOwogCmRp
ZmYgLS1naXQgYS91dGlsL25vdGlmeS5jIGIvdXRpbC9ub3RpZnkuYwppbmRleCBhZWU4ZDkzY2Iw
Li43NmJhYjIxMmFlIDEwMDY0NAotLS0gYS91dGlsL25vdGlmeS5jCisrKyBiL3V0aWwvbm90aWZ5
LmMKQEAgLTQwLDYgKzQwLDExIEBAIHZvaWQgbm90aWZpZXJfbGlzdF9ub3RpZnkoTm90aWZpZXJM
aXN0ICpsaXN0LCB2b2lkICpkYXRhKQogICAgIH0KIH0KIAorYm9vbCBub3RpZmllcl9saXN0X2Vt
cHR5KE5vdGlmaWVyTGlzdCAqbGlzdCkKK3sKKyAgICByZXR1cm4gUUxJU1RfRU1QVFkoJmxpc3Qt
Pm5vdGlmaWVycyk7Cit9CisKIHZvaWQgbm90aWZpZXJfd2l0aF9yZXR1cm5fbGlzdF9pbml0KE5v
dGlmaWVyV2l0aFJldHVybkxpc3QgKmxpc3QpCiB7CiAgICAgUUxJU1RfSU5JVCgmbGlzdC0+bm90
aWZpZXJzKTsKLS0gCkFudGhvbnkgUEVSQVJECgoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlz
dHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xp
c3RpbmZvL3hlbi1kZXZlbA==

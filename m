Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 7214DBE1B3
	for <lists+xen-devel@lfdr.de>; Wed, 25 Sep 2019 17:52:35 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iD9Xq-0000mg-0F; Wed, 25 Sep 2019 15:49:34 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=mFb1=XU=intel.com=tamas.lengyel@srs-us1.protection.inumbo.net>)
 id 1iD9Xo-0000mI-TW
 for xen-devel@lists.xenproject.org; Wed, 25 Sep 2019 15:49:32 +0000
X-Inumbo-ID: 0f5c2020-dfac-11e9-9637-12813bfff9fa
Received: from mga12.intel.com (unknown [192.55.52.136])
 by localhost (Halon) with ESMTPS
 id 0f5c2020-dfac-11e9-9637-12813bfff9fa;
 Wed, 25 Sep 2019 15:49:30 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga006.jf.intel.com ([10.7.209.51])
 by fmsmga106.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 25 Sep 2019 08:49:28 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,548,1559545200"; d="scan'208";a="193812624"
Received: from tlengyel-mobl2.amr.corp.intel.com (HELO localhost.localdomain)
 ([10.252.129.153])
 by orsmga006.jf.intel.com with ESMTP; 25 Sep 2019 08:49:27 -0700
From: Tamas K Lengyel <tamas.lengyel@intel.com>
To: xen-devel@lists.xenproject.org
Date: Wed, 25 Sep 2019 08:48:39 -0700
Message-Id: <07b30029c26f90d292d05d2e28944d9034f27fa7.1569425745.git.tamas.lengyel@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <cover.1569425745.git.tamas.lengyel@intel.com>
References: <cover.1569425745.git.tamas.lengyel@intel.com>
MIME-Version: 1.0
Subject: [Xen-devel] [RFC PATCH for-next 01/18] x86: make
 hvm_{get/set}_param accessible
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>,
 Tamas K Lengyel <tamas.lengyel@intel.com>, Wei Liu <wl@xen.org>,
 Jan Beulich <jbeulich@suse.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

Q3VycmVudGx5IHRoZSBodm0gcGFyYW1ldGVycyBhcmUgb25seSBhY2Nlc3NpYmxlIHZpYSB0aGUg
SFZNT1AgaHlwZXJjYWxscy4gQnkKZXhwb3NpbmcgaHZtX3tnZXQvc2V0fV9wYXJhbSBpdCB3aWxs
IGJlIHBvc3NpYmxlIGZvciBWTSBmb3JraW5nIHRvIGNvcHkgdGhlCnBhcmFtZXRlcnMgZGlyZWN0
bHkgaW50byB0aGUgY2xvbmUgZG9tYWluLgoKU2lnbmVkLW9mZi1ieTogVGFtYXMgSyBMZW5neWVs
IDx0YW1hcy5sZW5neWVsQGludGVsLmNvbT4KLS0tCiB4ZW4vYXJjaC94ODYvaHZtL2h2bS5jICAg
ICAgICB8IDE2OSArKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tCiB4ZW4vaW5jbHVk
ZS9hc20teDg2L2h2bS9odm0uaCB8ICAgNCArCiAyIGZpbGVzIGNoYW5nZWQsIDEwNiBpbnNlcnRp
b25zKCspLCA2NyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvaHZtL2h2
bS5jIGIveGVuL2FyY2gveDg2L2h2bS9odm0uYwppbmRleCBmZGIxZTE3ZjU5Li42NjdjODMwZGI1
IDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYvaHZtL2h2bS5jCisrKyBiL3hlbi9hcmNoL3g4Ni9o
dm0vaHZtLmMKQEAgLTQwNTQsMTYgKzQwNTQsMTcgQEAgc3RhdGljIGludCBodm1vcF9zZXRfZXZ0
Y2huX3VwY2FsbF92ZWN0b3IoCiB9CiAKIHN0YXRpYyBpbnQgaHZtX2FsbG93X3NldF9wYXJhbShz
dHJ1Y3QgZG9tYWluICpkLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0
cnVjdCB4ZW5faHZtX3BhcmFtICphKQorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVp
bnQzMl90IGluZGV4LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQ2NF90IG5l
d192YWx1ZSkKIHsKLSAgICB1aW50NjRfdCB2YWx1ZSA9IGQtPmFyY2guaHZtLnBhcmFtc1thLT5p
bmRleF07CisgICAgdWludDY0X3QgdmFsdWUgPSBkLT5hcmNoLmh2bS5wYXJhbXNbaW5kZXhdOwog
ICAgIGludCByYzsKIAogICAgIHJjID0geHNtX2h2bV9wYXJhbShYU01fVEFSR0VULCBkLCBIVk1P
UF9zZXRfcGFyYW0pOwogICAgIGlmICggcmMgKQogICAgICAgICByZXR1cm4gcmM7CiAKLSAgICBz
d2l0Y2ggKCBhLT5pbmRleCApCisgICAgc3dpdGNoICggaW5kZXggKQogICAgIHsKICAgICAvKiBU
aGUgZm9sbG93aW5nIHBhcmFtZXRlcnMgY2FuIGJlIHNldCBieSB0aGUgZ3Vlc3QuICovCiAgICAg
Y2FzZSBIVk1fUEFSQU1fQ0FMTEJBQ0tfSVJROgpAQCAtNDA5Niw3ICs0MDk3LDcgQEAgc3RhdGlj
IGludCBodm1fYWxsb3dfc2V0X3BhcmFtKHN0cnVjdCBkb21haW4gKmQsCiAgICAgaWYgKCByYyAp
CiAgICAgICAgIHJldHVybiByYzsKIAotICAgIHN3aXRjaCAoIGEtPmluZGV4ICkKKyAgICBzd2l0
Y2ggKCBpbmRleCApCiAgICAgewogICAgIC8qIFRoZSBmb2xsb3dpbmcgcGFyYW1ldGVycyBzaG91
bGQgb25seSBiZSBjaGFuZ2VkIG9uY2UuICovCiAgICAgY2FzZSBIVk1fUEFSQU1fVklSSURJQU46
CkBAIC00MTA2LDcgKzQxMDcsNyBAQCBzdGF0aWMgaW50IGh2bV9hbGxvd19zZXRfcGFyYW0oc3Ry
dWN0IGRvbWFpbiAqZCwKICAgICBjYXNlIEhWTV9QQVJBTV9OUl9JT1JFUV9TRVJWRVJfUEFHRVM6
CiAgICAgY2FzZSBIVk1fUEFSQU1fQUxUUDJNOgogICAgIGNhc2UgSFZNX1BBUkFNX01DQV9DQVA6
Ci0gICAgICAgIGlmICggdmFsdWUgIT0gMCAmJiBhLT52YWx1ZSAhPSB2YWx1ZSApCisgICAgICAg
IGlmICggdmFsdWUgIT0gMCAmJiBuZXdfdmFsdWUgIT0gdmFsdWUgKQogICAgICAgICAgICAgcmMg
PSAtRUVYSVNUOwogICAgICAgICBicmVhazsKICAgICBkZWZhdWx0OgpAQCAtNDExNiwxMyArNDEx
NywxMSBAQCBzdGF0aWMgaW50IGh2bV9hbGxvd19zZXRfcGFyYW0oc3RydWN0IGRvbWFpbiAqZCwK
ICAgICByZXR1cm4gcmM7CiB9CiAKLXN0YXRpYyBpbnQgaHZtb3Bfc2V0X3BhcmFtKAoraW50IGh2
bW9wX3NldF9wYXJhbSgKICAgICBYRU5fR1VFU1RfSEFORExFX1BBUkFNKHhlbl9odm1fcGFyYW1f
dCkgYXJnKQogewotICAgIHN0cnVjdCBkb21haW4gKmN1cnJfZCA9IGN1cnJlbnQtPmRvbWFpbjsK
ICAgICBzdHJ1Y3QgeGVuX2h2bV9wYXJhbSBhOwogICAgIHN0cnVjdCBkb21haW4gKmQ7Ci0gICAg
c3RydWN0IHZjcHUgKnY7CiAgICAgaW50IHJjOwogCiAgICAgaWYgKCBjb3B5X2Zyb21fZ3Vlc3Qo
JmEsIGFyZywgMSkgKQpAQCAtNDE0MiwyMyArNDE0MSw0MiBAQCBzdGF0aWMgaW50IGh2bW9wX3Nl
dF9wYXJhbSgKICAgICBpZiAoICFpc19odm1fZG9tYWluKGQpICkKICAgICAgICAgZ290byBvdXQ7
CiAKLSAgICByYyA9IGh2bV9hbGxvd19zZXRfcGFyYW0oZCwgJmEpOworICAgIHJjID0gaHZtX3Nl
dF9wYXJhbShkLCBhLmluZGV4LCBhLnZhbHVlKTsKKworIG91dDoKKyAgICByY3VfdW5sb2NrX2Rv
bWFpbihkKTsKKyAgICByZXR1cm4gcmM7Cit9CisKK2ludCBodm1fc2V0X3BhcmFtKAorICAgIHN0
cnVjdCBkb21haW4gKmQsCisgICAgdWludDMyX3QgaW5kZXgsCisgICAgdWludDY0X3QgdmFsdWUp
Cit7CisgICAgc3RydWN0IGRvbWFpbiAqY3Vycl9kID0gY3VycmVudC0+ZG9tYWluOworICAgIGlu
dCByYzsKKyAgICBzdHJ1Y3QgdmNwdSAqdjsKKworICAgIGlmICggaW5kZXggPj0gSFZNX05SX1BB
UkFNUyApCisgICAgICAgIHJldHVybiAtRUlOVkFMOworCisgICAgcmMgPSBodm1fYWxsb3dfc2V0
X3BhcmFtKGQsIGluZGV4LCB2YWx1ZSk7CiAgICAgaWYgKCByYyApCiAgICAgICAgIGdvdG8gb3V0
OwogCi0gICAgc3dpdGNoICggYS5pbmRleCApCisgICAgc3dpdGNoICggaW5kZXggKQogICAgIHsK
ICAgICBjYXNlIEhWTV9QQVJBTV9DQUxMQkFDS19JUlE6Ci0gICAgICAgIGh2bV9zZXRfY2FsbGJh
Y2tfdmlhKGQsIGEudmFsdWUpOworICAgICAgICBodm1fc2V0X2NhbGxiYWNrX3ZpYShkLCB2YWx1
ZSk7CiAgICAgICAgIGh2bV9sYXRjaF9zaGluZm9fc2l6ZShkKTsKICAgICAgICAgYnJlYWs7CiAg
ICAgY2FzZSBIVk1fUEFSQU1fVElNRVJfTU9ERToKLSAgICAgICAgaWYgKCBhLnZhbHVlID4gSFZN
UFRNX29uZV9taXNzZWRfdGlja19wZW5kaW5nICkKKyAgICAgICAgaWYgKCB2YWx1ZSA+IEhWTVBU
TV9vbmVfbWlzc2VkX3RpY2tfcGVuZGluZyApCiAgICAgICAgICAgICByYyA9IC1FSU5WQUw7CiAg
ICAgICAgIGJyZWFrOwogICAgIGNhc2UgSFZNX1BBUkFNX1ZJUklESUFOOgotICAgICAgICBpZiAo
IChhLnZhbHVlICYgfkhWTVBWX2ZlYXR1cmVfbWFzaykgfHwKLSAgICAgICAgICAgICAhKGEudmFs
dWUgJiBIVk1QVl9iYXNlX2ZyZXEpICkKKyAgICAgICAgaWYgKCAodmFsdWUgJiB+SFZNUFZfZmVh
dHVyZV9tYXNrKSB8fAorICAgICAgICAgICAgICEodmFsdWUgJiBIVk1QVl9iYXNlX2ZyZXEpICkK
ICAgICAgICAgICAgIHJjID0gLUVJTlZBTDsKICAgICAgICAgYnJlYWs7CiAgICAgY2FzZSBIVk1f
UEFSQU1fSURFTlRfUFQ6CkBAIC00MTY4LDcgKzQxODYsNyBAQCBzdGF0aWMgaW50IGh2bW9wX3Nl
dF9wYXJhbSgKICAgICAgICAgICovCiAgICAgICAgIGlmICggIXBhZ2luZ19tb2RlX2hhcChkKSB8
fCAhY3B1X2hhc192bXggKQogICAgICAgICB7Ci0gICAgICAgICAgICBkLT5hcmNoLmh2bS5wYXJh
bXNbYS5pbmRleF0gPSBhLnZhbHVlOworICAgICAgICAgICAgZC0+YXJjaC5odm0ucGFyYW1zW2lu
ZGV4XSA9IHZhbHVlOwogICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgIH0KIApAQCAtNDE4Myw3
ICs0MjAxLDcgQEAgc3RhdGljIGludCBodm1vcF9zZXRfcGFyYW0oCiAKICAgICAgICAgcmMgPSAw
OwogICAgICAgICBkb21haW5fcGF1c2UoZCk7Ci0gICAgICAgIGQtPmFyY2guaHZtLnBhcmFtc1th
LmluZGV4XSA9IGEudmFsdWU7CisgICAgICAgIGQtPmFyY2guaHZtLnBhcmFtc1tpbmRleF0gPSB2
YWx1ZTsKICAgICAgICAgZm9yX2VhY2hfdmNwdSAoIGQsIHYgKQogICAgICAgICAgICAgcGFnaW5n
X3VwZGF0ZV9jcjModiwgZmFsc2UpOwogICAgICAgICBkb21haW5fdW5wYXVzZShkKTsKQEAgLTQx
OTIsMjMgKzQyMTAsMjMgQEAgc3RhdGljIGludCBodm1vcF9zZXRfcGFyYW0oCiAgICAgICAgIGJy
ZWFrOwogICAgIGNhc2UgSFZNX1BBUkFNX0RNX0RPTUFJTjoKICAgICAgICAgLyogVGhlIG9ubHkg
dmFsdWUgdGhpcyBzaG91bGQgZXZlciBiZSBzZXQgdG8gaXMgRE9NSURfU0VMRiAqLwotICAgICAg
ICBpZiAoIGEudmFsdWUgIT0gRE9NSURfU0VMRiApCisgICAgICAgIGlmICggdmFsdWUgIT0gRE9N
SURfU0VMRiApCiAgICAgICAgICAgICByYyA9IC1FSU5WQUw7CiAKLSAgICAgICAgYS52YWx1ZSA9
IGN1cnJfZC0+ZG9tYWluX2lkOworICAgICAgICB2YWx1ZSA9IGN1cnJfZC0+ZG9tYWluX2lkOwog
ICAgICAgICBicmVhazsKICAgICBjYXNlIEhWTV9QQVJBTV9BQ1BJX1NfU1RBVEU6CiAgICAgICAg
IHJjID0gMDsKLSAgICAgICAgaWYgKCBhLnZhbHVlID09IDMgKQorICAgICAgICBpZiAoIHZhbHVl
ID09IDMgKQogICAgICAgICAgICAgaHZtX3MzX3N1c3BlbmQoZCk7Ci0gICAgICAgIGVsc2UgaWYg
KCBhLnZhbHVlID09IDAgKQorICAgICAgICBlbHNlIGlmICggdmFsdWUgPT0gMCApCiAgICAgICAg
ICAgICBodm1fczNfcmVzdW1lKGQpOwogICAgICAgICBlbHNlCiAgICAgICAgICAgICByYyA9IC1F
SU5WQUw7CiAKICAgICAgICAgYnJlYWs7CiAgICAgY2FzZSBIVk1fUEFSQU1fQUNQSV9JT1BPUlRT
X0xPQ0FUSU9OOgotICAgICAgICByYyA9IHBtdGltZXJfY2hhbmdlX2lvcG9ydChkLCBhLnZhbHVl
KTsKKyAgICAgICAgcmMgPSBwbXRpbWVyX2NoYW5nZV9pb3BvcnQoZCwgdmFsdWUpOwogICAgICAg
ICBicmVhazsKICAgICBjYXNlIEhWTV9QQVJBTV9NRU1PUllfRVZFTlRfQ1IwOgogICAgIGNhc2Ug
SFZNX1BBUkFNX01FTU9SWV9FVkVOVF9DUjM6CkBAIC00MjIzLDI0ICs0MjQxLDI0IEBAIHN0YXRp
YyBpbnQgaHZtb3Bfc2V0X3BhcmFtKAogICAgICAgICByYyA9IHhzbV9odm1fcGFyYW1fbmVzdGVk
KFhTTV9QUklWLCBkKTsKICAgICAgICAgaWYgKCByYyApCiAgICAgICAgICAgICBicmVhazsKLSAg
ICAgICAgaWYgKCBhLnZhbHVlID4gMSApCisgICAgICAgIGlmICggdmFsdWUgPiAxICkKICAgICAg
ICAgICAgIHJjID0gLUVJTlZBTDsKICAgICAgICAgLyoKICAgICAgICAgICogUmVtb3ZlIHRoZSBj
aGVjayBiZWxvdyBvbmNlIHdlIGhhdmUKICAgICAgICAgICogc2hhZG93LW9uLXNoYWRvdy4KICAg
ICAgICAgICovCi0gICAgICAgIGlmICggIXBhZ2luZ19tb2RlX2hhcChkKSAmJiBhLnZhbHVlICkK
KyAgICAgICAgaWYgKCAhcGFnaW5nX21vZGVfaGFwKGQpICYmIHZhbHVlICkKICAgICAgICAgICAg
IHJjID0gLUVJTlZBTDsKLSAgICAgICAgaWYgKCBhLnZhbHVlICYmCisgICAgICAgIGlmICggdmFs
dWUgJiYKICAgICAgICAgICAgICBkLT5hcmNoLmh2bS5wYXJhbXNbSFZNX1BBUkFNX0FMVFAyTV0g
KQogICAgICAgICAgICAgcmMgPSAtRUlOVkFMOwogICAgICAgICAvKiBTZXQgdXAgTkhWTSBzdGF0
ZSBmb3IgYW55IHZjcHVzIHRoYXQgYXJlIGFscmVhZHkgdXAuICovCi0gICAgICAgIGlmICggYS52
YWx1ZSAmJgorICAgICAgICBpZiAoIHZhbHVlICYmCiAgICAgICAgICAgICAgIWQtPmFyY2guaHZt
LnBhcmFtc1tIVk1fUEFSQU1fTkVTVEVESFZNXSApCiAgICAgICAgICAgICBmb3JfZWFjaF92Y3B1
KGQsIHYpCiAgICAgICAgICAgICAgICAgaWYgKCByYyA9PSAwICkKICAgICAgICAgICAgICAgICAg
ICAgcmMgPSBuZXN0ZWRodm1fdmNwdV9pbml0aWFsaXNlKHYpOwotICAgICAgICBpZiAoICFhLnZh
bHVlIHx8IHJjICkKKyAgICAgICAgaWYgKCAhdmFsdWUgfHwgcmMgKQogICAgICAgICAgICAgZm9y
X2VhY2hfdmNwdShkLCB2KQogICAgICAgICAgICAgICAgIG5lc3RlZGh2bV92Y3B1X2Rlc3Ryb3ko
dik7CiAgICAgICAgIGJyZWFrOwpAQCAtNDI0OCwzMCArNDI2NiwzMCBAQCBzdGF0aWMgaW50IGh2
bW9wX3NldF9wYXJhbSgKICAgICAgICAgcmMgPSB4c21faHZtX3BhcmFtX2FsdHAybWh2bShYU01f
UFJJViwgZCk7CiAgICAgICAgIGlmICggcmMgKQogICAgICAgICAgICAgYnJlYWs7Ci0gICAgICAg
IGlmICggYS52YWx1ZSA+IFhFTl9BTFRQMk1fbGltaXRlZCApCisgICAgICAgIGlmICggdmFsdWUg
PiBYRU5fQUxUUDJNX2xpbWl0ZWQgKQogICAgICAgICAgICAgcmMgPSAtRUlOVkFMOwotICAgICAg
ICBpZiAoIGEudmFsdWUgJiYKKyAgICAgICAgaWYgKCB2YWx1ZSAmJgogICAgICAgICAgICAgIGQt
PmFyY2guaHZtLnBhcmFtc1tIVk1fUEFSQU1fTkVTVEVESFZNXSApCiAgICAgICAgICAgICByYyA9
IC1FSU5WQUw7CiAgICAgICAgIGJyZWFrOwogICAgIGNhc2UgSFZNX1BBUkFNX1RSSVBMRV9GQVVM
VF9SRUFTT046Ci0gICAgICAgIGlmICggYS52YWx1ZSA+IFNIVVRET1dOX01BWCApCisgICAgICAg
IGlmICggdmFsdWUgPiBTSFVURE9XTl9NQVggKQogICAgICAgICAgICAgcmMgPSAtRUlOVkFMOwog
ICAgICAgICBicmVhazsKICAgICBjYXNlIEhWTV9QQVJBTV9JT1JFUV9TRVJWRVJfUEZOOgotICAg
ICAgICBkLT5hcmNoLmh2bS5pb3JlcV9nZm4uYmFzZSA9IGEudmFsdWU7CisgICAgICAgIGQtPmFy
Y2guaHZtLmlvcmVxX2dmbi5iYXNlID0gdmFsdWU7CiAgICAgICAgIGJyZWFrOwogICAgIGNhc2Ug
SFZNX1BBUkFNX05SX0lPUkVRX1NFUlZFUl9QQUdFUzoKICAgICB7CiAgICAgICAgIHVuc2lnbmVk
IGludCBpOwogCi0gICAgICAgIGlmICggYS52YWx1ZSA9PSAwIHx8Ci0gICAgICAgICAgICAgYS52
YWx1ZSA+IHNpemVvZihkLT5hcmNoLmh2bS5pb3JlcV9nZm4ubWFzaykgKiA4ICkKKyAgICAgICAg
aWYgKCB2YWx1ZSA9PSAwIHx8CisgICAgICAgICAgICAgdmFsdWUgPiBzaXplb2YoZC0+YXJjaC5o
dm0uaW9yZXFfZ2ZuLm1hc2spICogOCApCiAgICAgICAgIHsKICAgICAgICAgICAgIHJjID0gLUVJ
TlZBTDsKICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICB9Ci0gICAgICAgIGZvciAoIGkgPSAw
OyBpIDwgYS52YWx1ZTsgaSsrICkKKyAgICAgICAgZm9yICggaSA9IDA7IGkgPCB2YWx1ZTsgaSsr
ICkKICAgICAgICAgICAgIHNldF9iaXQoaSwgJmQtPmFyY2guaHZtLmlvcmVxX2dmbi5tYXNrKTsK
IAogICAgICAgICBicmVhazsKQEAgLTQyODMsMzUgKzQzMDEsMzUgQEAgc3RhdGljIGludCBodm1v
cF9zZXRfcGFyYW0oCiAgICAgICAgICAgICAgICAgICAgICBzaXplb2YoZC0+YXJjaC5odm0uaW9y
ZXFfZ2ZuLmxlZ2FjeV9tYXNrKSAqIDgpOwogICAgICAgICBCVUlMRF9CVUdfT04oSFZNX1BBUkFN
X0JVRklPUkVRX1BGTiA+CiAgICAgICAgICAgICAgICAgICAgICBzaXplb2YoZC0+YXJjaC5odm0u
aW9yZXFfZ2ZuLmxlZ2FjeV9tYXNrKSAqIDgpOwotICAgICAgICBpZiAoIGEudmFsdWUgKQotICAg
ICAgICAgICAgc2V0X2JpdChhLmluZGV4LCAmZC0+YXJjaC5odm0uaW9yZXFfZ2ZuLmxlZ2FjeV9t
YXNrKTsKKyAgICAgICAgaWYgKCB2YWx1ZSApCisgICAgICAgICAgICBzZXRfYml0KGluZGV4LCAm
ZC0+YXJjaC5odm0uaW9yZXFfZ2ZuLmxlZ2FjeV9tYXNrKTsKICAgICAgICAgYnJlYWs7CiAKICAg
ICBjYXNlIEhWTV9QQVJBTV9YODdfRklQX1dJRFRIOgotICAgICAgICBpZiAoIGEudmFsdWUgIT0g
MCAmJiBhLnZhbHVlICE9IDQgJiYgYS52YWx1ZSAhPSA4ICkKKyAgICAgICAgaWYgKCB2YWx1ZSAh
PSAwICYmIHZhbHVlICE9IDQgJiYgdmFsdWUgIT0gOCApCiAgICAgICAgIHsKICAgICAgICAgICAg
IHJjID0gLUVJTlZBTDsKICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICB9Ci0gICAgICAgIGQt
PmFyY2gueDg3X2ZpcF93aWR0aCA9IGEudmFsdWU7CisgICAgICAgIGQtPmFyY2gueDg3X2ZpcF93
aWR0aCA9IHZhbHVlOwogICAgICAgICBicmVhazsKIAogICAgIGNhc2UgSFZNX1BBUkFNX1ZNODZf
VFNTOgogICAgICAgICAvKiBIYXJkd2FyZSB3b3VsZCBzaWxlbnRseSB0cnVuY2F0ZSBoaWdoIGJp
dHMuICovCi0gICAgICAgIGlmICggYS52YWx1ZSAhPSAodWludDMyX3QpYS52YWx1ZSApCisgICAg
ICAgIGlmICggdmFsdWUgIT0gKHVpbnQzMl90KXZhbHVlICkKICAgICAgICAgewogICAgICAgICAg
ICAgaWYgKCBkID09IGN1cnJfZCApCiAgICAgICAgICAgICAgICAgZG9tYWluX2NyYXNoKGQpOwog
ICAgICAgICAgICAgcmMgPSAtRUlOVkFMOwogICAgICAgICB9CiAgICAgICAgIC8qIE9sZCBodm1s
b2FkZXIgYmluYXJpZXMgaGFyZGNvZGUgdGhlIHNpemUgdG8gMTI4IGJ5dGVzLiAqLwotICAgICAg
ICBpZiAoIGEudmFsdWUgKQotICAgICAgICAgICAgYS52YWx1ZSB8PSAoMTI4VUxMIDw8IDMyKSB8
IFZNODZfVFNTX1VQREFURUQ7Ci0gICAgICAgIGEuaW5kZXggPSBIVk1fUEFSQU1fVk04Nl9UU1Nf
U0laRUQ7CisgICAgICAgIGlmICggdmFsdWUgKQorICAgICAgICAgICAgdmFsdWUgfD0gKDEyOFVM
TCA8PCAzMikgfCBWTTg2X1RTU19VUERBVEVEOworICAgICAgICBpbmRleCA9IEhWTV9QQVJBTV9W
TTg2X1RTU19TSVpFRDsKICAgICAgICAgYnJlYWs7CiAKICAgICBjYXNlIEhWTV9QQVJBTV9WTTg2
X1RTU19TSVpFRDoKLSAgICAgICAgaWYgKCAoYS52YWx1ZSA+PiAzMikgPCBzaXplb2Yoc3RydWN0
IHRzczMyKSApCisgICAgICAgIGlmICggKHZhbHVlID4+IDMyKSA8IHNpemVvZihzdHJ1Y3QgdHNz
MzIpICkKICAgICAgICAgewogICAgICAgICAgICAgaWYgKCBkID09IGN1cnJfZCApCiAgICAgICAg
ICAgICAgICAgZG9tYWluX2NyYXNoKGQpOwpAQCAtNDMyMiwzNCArNDM0MCwzMyBAQCBzdGF0aWMg
aW50IGh2bW9wX3NldF9wYXJhbSgKICAgICAgICAgICogMjU2IGJpdHMgaW50ZXJydXB0IHJlZGly
ZWN0aW9uIGJpdG1hcCArIDY0ayBiaXRzIEkvTyBiaXRtYXAKICAgICAgICAgICogcGx1cyBvbmUg
cGFkZGluZyBieXRlKS4KICAgICAgICAgICovCi0gICAgICAgIGlmICggKGEudmFsdWUgPj4gMzIp
ID4gc2l6ZW9mKHN0cnVjdCB0c3MzMikgKworICAgICAgICBpZiAoICh2YWx1ZSA+PiAzMikgPiBz
aXplb2Yoc3RydWN0IHRzczMyKSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKDB4
MTAwIC8gOCkgKyAoMHgxMDAwMCAvIDgpICsgMSApCi0gICAgICAgICAgICBhLnZhbHVlID0gKHVp
bnQzMl90KWEudmFsdWUgfAorICAgICAgICAgICAgdmFsdWUgPSAodWludDMyX3QpdmFsdWUgfAog
ICAgICAgICAgICAgICAgICAgICAgICgoc2l6ZW9mKHN0cnVjdCB0c3MzMikgKyAoMHgxMDAgLyA4
KSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgweDEw
MDAwIC8gOCkgKyAxKSA8PCAzMik7Ci0gICAgICAgIGEudmFsdWUgfD0gVk04Nl9UU1NfVVBEQVRF
RDsKKyAgICAgICAgdmFsdWUgfD0gVk04Nl9UU1NfVVBEQVRFRDsKICAgICAgICAgYnJlYWs7CiAK
ICAgICBjYXNlIEhWTV9QQVJBTV9NQ0FfQ0FQOgotICAgICAgICByYyA9IHZtY2VfZW5hYmxlX21j
YV9jYXAoZCwgYS52YWx1ZSk7CisgICAgICAgIHJjID0gdm1jZV9lbmFibGVfbWNhX2NhcChkLCB2
YWx1ZSk7CiAgICAgICAgIGJyZWFrOwogICAgIH0KIAogICAgIGlmICggcmMgIT0gMCApCiAgICAg
ICAgIGdvdG8gb3V0OwogCi0gICAgZC0+YXJjaC5odm0ucGFyYW1zW2EuaW5kZXhdID0gYS52YWx1
ZTsKKyAgICBkLT5hcmNoLmh2bS5wYXJhbXNbaW5kZXhdID0gdmFsdWU7CiAKICAgICBIVk1fREJH
X0xPRyhEQkdfTEVWRUxfSENBTEwsICJzZXQgcGFyYW0gJXUgPSAlIlBSSXg2NCwKLSAgICAgICAg
ICAgICAgICBhLmluZGV4LCBhLnZhbHVlKTsKKyAgICAgICAgICAgICAgICBpbmRleCwgdmFsdWUp
OwogCiAgb3V0OgotICAgIHJjdV91bmxvY2tfZG9tYWluKGQpOwogICAgIHJldHVybiByYzsKIH0K
IAogc3RhdGljIGludCBodm1fYWxsb3dfZ2V0X3BhcmFtKHN0cnVjdCBkb21haW4gKmQsCi0gICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RydWN0IHhlbl9odm1fcGFyYW0gKmEp
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgaW5kZXgpCiB7CiAgICAg
aW50IHJjOwogCkBAIC00MzU3LDcgKzQzNzQsNyBAQCBzdGF0aWMgaW50IGh2bV9hbGxvd19nZXRf
cGFyYW0oc3RydWN0IGRvbWFpbiAqZCwKICAgICBpZiAoIHJjICkKICAgICAgICAgcmV0dXJuIHJj
OwogCi0gICAgc3dpdGNoICggYS0+aW5kZXggKQorICAgIHN3aXRjaCAoIGluZGV4ICkKICAgICB7
CiAgICAgLyogVGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzIGNhbiBiZSByZWFkIGJ5IHRoZSBndWVz
dC4gKi8KICAgICBjYXNlIEhWTV9QQVJBTV9DQUxMQkFDS19JUlE6CkBAIC00NDExLDQyICs0NDI4
LDYwIEBAIHN0YXRpYyBpbnQgaHZtb3BfZ2V0X3BhcmFtKAogICAgIGlmICggIWlzX2h2bV9kb21h
aW4oZCkgKQogICAgICAgICBnb3RvIG91dDsKIAotICAgIHJjID0gaHZtX2FsbG93X2dldF9wYXJh
bShkLCAmYSk7CisgICAgcmMgPSBodm1fZ2V0X3BhcmFtKGQsIGEuaW5kZXgsICZhLnZhbHVlKTsK
ICAgICBpZiAoIHJjICkKICAgICAgICAgZ290byBvdXQ7CiAKLSAgICBzd2l0Y2ggKCBhLmluZGV4
ICkKKyAgICByYyA9IF9fY29weV90b19ndWVzdChhcmcsICZhLCAxKSA/IC1FRkFVTFQgOiAwOwor
CisgICAgSFZNX0RCR19MT0coREJHX0xFVkVMX0hDQUxMLCAiZ2V0IHBhcmFtICV1ID0gJSJQUkl4
NjQsCisgICAgICAgICAgICAgICAgYS5pbmRleCwgYS52YWx1ZSk7CisKKyBvdXQ6CisgICAgcmN1
X3VubG9ja19kb21haW4oZCk7CisgICAgcmV0dXJuIHJjOworfQorCitpbnQgaHZtX2dldF9wYXJh
bSgKKyAgICBzdHJ1Y3QgZG9tYWluICpkLAorICAgIHVpbnQzMl90IGluZGV4LAorICAgIHVpbnQ2
NF90ICp2YWx1ZSkKK3sKKyAgICBpbnQgcmM7CisKKyAgICBpZiAoIGluZGV4ID49IEhWTV9OUl9Q
QVJBTVMgfHwgIXZhbHVlICkKKyAgICAgICAgcmV0dXJuIC1FSU5WQUw7CisKKyAgICByYyA9IGh2
bV9hbGxvd19nZXRfcGFyYW0oZCwgaW5kZXgpOworICAgIGlmICggcmMgKQorICAgICAgICByZXR1
cm4gcmM7CisKKyAgICBzd2l0Y2ggKCBpbmRleCApCiAgICAgewogICAgIGNhc2UgSFZNX1BBUkFN
X0FDUElfU19TVEFURToKLSAgICAgICAgYS52YWx1ZSA9IGQtPmFyY2guaHZtLmlzX3MzX3N1c3Bl
bmRlZCA/IDMgOiAwOworICAgICAgICAqdmFsdWUgPSBkLT5hcmNoLmh2bS5pc19zM19zdXNwZW5k
ZWQgPyAzIDogMDsKICAgICAgICAgYnJlYWs7CiAKICAgICBjYXNlIEhWTV9QQVJBTV9WTTg2X1RT
UzoKLSAgICAgICAgYS52YWx1ZSA9ICh1aW50MzJfdClkLT5hcmNoLmh2bS5wYXJhbXNbSFZNX1BB
UkFNX1ZNODZfVFNTX1NJWkVEXTsKKyAgICAgICAgKnZhbHVlID0gKHVpbnQzMl90KWQtPmFyY2gu
aHZtLnBhcmFtc1tIVk1fUEFSQU1fVk04Nl9UU1NfU0laRURdOwogICAgICAgICBicmVhazsKIAog
ICAgIGNhc2UgSFZNX1BBUkFNX1ZNODZfVFNTX1NJWkVEOgotICAgICAgICBhLnZhbHVlID0gZC0+
YXJjaC5odm0ucGFyYW1zW0hWTV9QQVJBTV9WTTg2X1RTU19TSVpFRF0gJgotICAgICAgICAgICAg
ICAgICAgflZNODZfVFNTX1VQREFURUQ7CisgICAgICAgICp2YWx1ZSA9IGQtPmFyY2guaHZtLnBh
cmFtc1tIVk1fUEFSQU1fVk04Nl9UU1NfU0laRURdICYKKyAgICAgICAgICAgICAgICAgICB+Vk04
Nl9UU1NfVVBEQVRFRDsKICAgICAgICAgYnJlYWs7CiAKICAgICBjYXNlIEhWTV9QQVJBTV9YODdf
RklQX1dJRFRIOgotICAgICAgICBhLnZhbHVlID0gZC0+YXJjaC54ODdfZmlwX3dpZHRoOworICAg
ICAgICAqdmFsdWUgPSBkLT5hcmNoLng4N19maXBfd2lkdGg7CiAgICAgICAgIGJyZWFrOwogICAg
IGRlZmF1bHQ6Ci0gICAgICAgIGEudmFsdWUgPSBkLT5hcmNoLmh2bS5wYXJhbXNbYS5pbmRleF07
CisgICAgICAgICp2YWx1ZSA9IGQtPmFyY2guaHZtLnBhcmFtc1tpbmRleF07CiAgICAgICAgIGJy
ZWFrOwogICAgIH0KIAotICAgIHJjID0gX19jb3B5X3RvX2d1ZXN0KGFyZywgJmEsIDEpID8gLUVG
QVVMVCA6IDA7Ci0KLSAgICBIVk1fREJHX0xPRyhEQkdfTEVWRUxfSENBTEwsICJnZXQgcGFyYW0g
JXUgPSAlIlBSSXg2NCwKLSAgICAgICAgICAgICAgICBhLmluZGV4LCBhLnZhbHVlKTsKKyAgICBy
ZXR1cm4gMDsKK307CiAKLSBvdXQ6Ci0gICAgcmN1X3VubG9ja19kb21haW4oZCk7Ci0gICAgcmV0
dXJuIHJjOwotfQogCiAvKgogICogYWx0cDJtIG9wZXJhdGlvbnMgYXJlIGVudmlzaW9uZWQgYXMg
YmVpbmcgdXNlZCBpbiBzZXZlcmFsIGRpZmZlcmVudApkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUv
YXNtLXg4Ni9odm0vaHZtLmggYi94ZW4vaW5jbHVkZS9hc20teDg2L2h2bS9odm0uaAppbmRleCA0
ZTcyZDA3MzJlLi43ZjAwMGZhNmIxIDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS9hc20teDg2L2h2
bS9odm0uaAorKysgYi94ZW4vaW5jbHVkZS9hc20teDg2L2h2bS9odm0uaApAQCAtMzM2LDYgKzMz
NiwxMCBAQCB1bnNpZ25lZCBsb25nIGh2bV9jcjRfZ3Vlc3RfdmFsaWRfYml0cyhjb25zdCBzdHJ1
Y3QgZG9tYWluICpkLCBib29sIHJlc3RvcmUpOwogYm9vbCBodm1fZmx1c2hfdmNwdV90bGIoYm9v
bCAoKmZsdXNoX3ZjcHUpKHZvaWQgKmN0eHQsIHN0cnVjdCB2Y3B1ICp2KSwKICAgICAgICAgICAg
ICAgICAgICAgICAgIHZvaWQgKmN0eHQpOwogCisvKiBDYWxsZXIgbXVzdCBob2xkIGRvbWFpbiBs
b2NrcyAqLworaW50IGh2bV9nZXRfcGFyYW0oc3RydWN0IGRvbWFpbiAqZCwgdWludDMyX3QgaW5k
ZXgsIHVpbnQ2NF90ICp2YWx1ZSk7CitpbnQgaHZtX3NldF9wYXJhbShzdHJ1Y3QgZG9tYWluICpk
LCB1aW50MzJfdCBpbmRleCwgdWludDY0X3QgdmFsdWUpOworCiAjaWZkZWYgQ09ORklHX0hWTQog
CiAjZGVmaW5lIGh2bV9nZXRfZ3Vlc3RfdHNjKHYpIGh2bV9nZXRfZ3Vlc3RfdHNjX2ZpeGVkKHYs
IDApCi0tIAoyLjIwLjEKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0
Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRl
dmVs

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id DED3377EA5
	for <lists+xen-devel@lfdr.de>; Sun, 28 Jul 2019 10:44:28 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hrejt-0008VN-88; Sun, 28 Jul 2019 08:41:09 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=TCcn=VZ=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1hrejr-0008V9-Jg
 for xen-devel@lists.xenproject.org; Sun, 28 Jul 2019 08:41:07 +0000
X-Inumbo-ID: 6fb892c6-b113-11e9-8980-bc764e045a96
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 6fb892c6-b113-11e9-8980-bc764e045a96;
 Sun, 28 Jul 2019 08:41:05 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 2E914AEF1;
 Sun, 28 Jul 2019 08:41:04 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Sun, 28 Jul 2019 10:40:58 +0200
Message-Id: <20190728084100.13071-2-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190728084100.13071-1-jgross@suse.com>
References: <20190728084100.13071-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH 1/3] xen: move debugtrace coding to
 common/debugtrace.c
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SW5zdGVhZCBvZiBsaXZpbmcgaW4gZHJpdmVycy9jaGFyL2NvbnNvbGUuYyBtb3ZlIHRoZSBkZWJ1
Z3RyYWNlCnJlbGF0ZWQgY29kaW5nIHRvIGEgbmV3IGZpbGUgY29tbW9uL2RlYnVndHJhY2UuYwoK
U2lnbmVkLW9mZi1ieTogSnVlcmdlbiBHcm9zcyA8amdyb3NzQHN1c2UuY29tPgotLS0KIHhlbi9j
b21tb24vTWFrZWZpbGUgICAgICAgIHwgICAxICsKIHhlbi9jb21tb24vZGVidWd0cmFjZS5jICAg
IHwgMTc3ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwogeGVu
L2RyaXZlcnMvY2hhci9jb25zb2xlLmMgfCAxNzYgKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0KIHhlbi9pbmNsdWRlL3hlbi9jb25zb2xlLmggIHwgICA0ICsKIDQg
ZmlsZXMgY2hhbmdlZCwgMTg0IGluc2VydGlvbnMoKyksIDE3NCBkZWxldGlvbnMoLSkKIGNyZWF0
ZSBtb2RlIDEwMDY0NCB4ZW4vY29tbW9uL2RlYnVndHJhY2UuYwoKZGlmZiAtLWdpdCBhL3hlbi9j
b21tb24vTWFrZWZpbGUgYi94ZW4vY29tbW9uL01ha2VmaWxlCmluZGV4IGVkZGRhNWRhYTYuLjYy
YjM0ZTY5ZTkgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vTWFrZWZpbGUKKysrIGIveGVuL2NvbW1v
bi9NYWtlZmlsZQpAQCAtNCw2ICs0LDcgQEAgb2JqLXkgKz0gYnNlYXJjaC5vCiBvYmotJChDT05G
SUdfQ09SRV9QQVJLSU5HKSArPSBjb3JlX3Bhcmtpbmcubwogb2JqLXkgKz0gY3B1Lm8KIG9iai15
ICs9IGNwdXBvb2wubworb2JqLSQoQ09ORklHX0RFQlVHX1RSQUNFKSArPSBkZWJ1Z3RyYWNlLm8K
IG9iai0kKENPTkZJR19IQVNfREVWSUNFX1RSRUUpICs9IGRldmljZV90cmVlLm8KIG9iai15ICs9
IGRvbWN0bC5vCiBvYmoteSArPSBkb21haW4ubwpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9kZWJ1
Z3RyYWNlLmMgYi94ZW4vY29tbW9uL2RlYnVndHJhY2UuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NApp
bmRleCAwMDAwMDAwMDAwLi5hZDEwMTU0NDk1Ci0tLSAvZGV2L251bGwKKysrIGIveGVuL2NvbW1v
bi9kZWJ1Z3RyYWNlLmMKQEAgLTAsMCArMSwxNzcgQEAKKy8qKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioK
KyAqIGRlYnVndHJhY2UuYworICoKKyAqIERlYnVndHJhY2UgZm9yIFhlbgorICovCisKKworI2lu
Y2x1ZGUgPHhlbi9jb25zb2xlLmg+CisjaW5jbHVkZSA8eGVuL2luaXQuaD4KKyNpbmNsdWRlIDx4
ZW4va2V5aGFuZGxlci5oPgorI2luY2x1ZGUgPHhlbi9saWIuaD4KKyNpbmNsdWRlIDx4ZW4vbW0u
aD4KKyNpbmNsdWRlIDx4ZW4vc2VyaWFsLmg+CisjaW5jbHVkZSA8eGVuL3NwaW5sb2NrLmg+Cisj
aW5jbHVkZSA8eGVuL3dhdGNoZG9nLmg+CisKKy8qIFNlbmQgb3V0cHV0IGRpcmVjdCB0byBjb25z
b2xlLCBvciBidWZmZXIgaXQ/ICovCitzdGF0aWMgdm9sYXRpbGUgaW50IGRlYnVndHJhY2Vfc2Vu
ZF90b19jb25zb2xlOworCitzdGF0aWMgY2hhciAgICAgICAgKmRlYnVndHJhY2VfYnVmOyAvKiBE
ZWJ1Zy10cmFjZSBidWZmZXIgKi8KK3N0YXRpYyB1bnNpZ25lZCBpbnQgZGVidWd0cmFjZV9wcmQ7
IC8qIFByb2R1Y2VyIGluZGV4ICAgICAqLworc3RhdGljIHVuc2lnbmVkIGludCBkZWJ1Z3RyYWNl
X2tpbG9ieXRlcyA9IDEyOCwgZGVidWd0cmFjZV9ieXRlczsKK3N0YXRpYyB1bnNpZ25lZCBpbnQg
ZGVidWd0cmFjZV91c2VkOworc3RhdGljIERFRklORV9TUElOTE9DSyhkZWJ1Z3RyYWNlX2xvY2sp
OworaW50ZWdlcl9wYXJhbSgiZGVidWd0cmFjZSIsIGRlYnVndHJhY2Vfa2lsb2J5dGVzKTsKKwor
c3RhdGljIHZvaWQgZGVidWd0cmFjZV9kdW1wX3dvcmtlcih2b2lkKQoreworICAgIGlmICggKGRl
YnVndHJhY2VfYnl0ZXMgPT0gMCkgfHwgIWRlYnVndHJhY2VfdXNlZCApCisgICAgICAgIHJldHVy
bjsKKworICAgIHByaW50aygiZGVidWd0cmFjZV9kdW1wKCkgc3RhcnRpbmdcbiIpOworCisgICAg
LyogUHJpbnQgb2xkZXN0IHBvcnRpb24gb2YgdGhlIHJpbmcuICovCisgICAgQVNTRVJUKGRlYnVn
dHJhY2VfYnVmW2RlYnVndHJhY2VfYnl0ZXMgLSAxXSA9PSAwKTsKKyAgICBzZXJjb25fcHV0cygm
ZGVidWd0cmFjZV9idWZbZGVidWd0cmFjZV9wcmRdKTsKKworICAgIC8qIFByaW50IHlvdW5nZXN0
IHBvcnRpb24gb2YgdGhlIHJpbmcuICovCisgICAgZGVidWd0cmFjZV9idWZbZGVidWd0cmFjZV9w
cmRdID0gJ1wwJzsKKyAgICBzZXJjb25fcHV0cygmZGVidWd0cmFjZV9idWZbMF0pOworCisgICAg
bWVtc2V0KGRlYnVndHJhY2VfYnVmLCAnXDAnLCBkZWJ1Z3RyYWNlX2J5dGVzKTsKKworICAgIHBy
aW50aygiZGVidWd0cmFjZV9kdW1wKCkgZmluaXNoZWRcbiIpOworfQorCitzdGF0aWMgdm9pZCBk
ZWJ1Z3RyYWNlX3RvZ2dsZSh2b2lkKQoreworICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7CisKKyAg
ICB3YXRjaGRvZ19kaXNhYmxlKCk7CisgICAgc3Bpbl9sb2NrX2lycXNhdmUoJmRlYnVndHJhY2Vf
bG9jaywgZmxhZ3MpOworCisgICAgLyoKKyAgICAgKiBEdW1wIHRoZSBidWZmZXIgKmJlZm9yZSog
dG9nZ2xpbmcsIGluIGNhc2UgdGhlIGFjdCBvZiBkdW1waW5nIHRoZQorICAgICAqIGJ1ZmZlciBp
dHNlbGYgY2F1c2VzIG1vcmUgcHJpbnRrKCkgaW52b2NhdGlvbnMuCisgICAgICovCisgICAgcHJp
bnRrKCJkZWJ1Z3RyYWNlX3ByaW50ayBub3cgd3JpdGluZyB0byAlcy5cbiIsCisgICAgICAgICAg
ICFkZWJ1Z3RyYWNlX3NlbmRfdG9fY29uc29sZSA/ICJjb25zb2xlIjogImJ1ZmZlciIpOworICAg
IGlmICggIWRlYnVndHJhY2Vfc2VuZF90b19jb25zb2xlICkKKyAgICAgICAgZGVidWd0cmFjZV9k
dW1wX3dvcmtlcigpOworCisgICAgZGVidWd0cmFjZV9zZW5kX3RvX2NvbnNvbGUgPSAhZGVidWd0
cmFjZV9zZW5kX3RvX2NvbnNvbGU7CisKKyAgICBzcGluX3VubG9ja19pcnFyZXN0b3JlKCZkZWJ1
Z3RyYWNlX2xvY2ssIGZsYWdzKTsKKyAgICB3YXRjaGRvZ19lbmFibGUoKTsKKworfQorCit2b2lk
IGRlYnVndHJhY2VfZHVtcCh2b2lkKQoreworICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7CisKKyAg
ICB3YXRjaGRvZ19kaXNhYmxlKCk7CisgICAgc3Bpbl9sb2NrX2lycXNhdmUoJmRlYnVndHJhY2Vf
bG9jaywgZmxhZ3MpOworCisgICAgZGVidWd0cmFjZV9kdW1wX3dvcmtlcigpOworCisgICAgc3Bp
bl91bmxvY2tfaXJxcmVzdG9yZSgmZGVidWd0cmFjZV9sb2NrLCBmbGFncyk7CisgICAgd2F0Y2hk
b2dfZW5hYmxlKCk7Cit9CisKK3N0YXRpYyB2b2lkIGRlYnVndHJhY2VfYWRkX3RvX2J1ZihjaGFy
ICpidWYpCit7CisgICAgY2hhciAqcDsKKworICAgIGZvciAoIHAgPSBidWY7ICpwICE9ICdcMCc7
IHArKyApCisgICAgeworICAgICAgICBkZWJ1Z3RyYWNlX2J1ZltkZWJ1Z3RyYWNlX3ByZCsrXSA9
ICpwOworICAgICAgICAvKiBBbHdheXMgbGVhdmUgYSBudWwgYnl0ZSBhdCB0aGUgZW5kIG9mIHRo
ZSBidWZmZXIuICovCisgICAgICAgIGlmICggZGVidWd0cmFjZV9wcmQgPT0gKGRlYnVndHJhY2Vf
Ynl0ZXMgLSAxKSApCisgICAgICAgICAgICBkZWJ1Z3RyYWNlX3ByZCA9IDA7CisgICAgfQorfQor
Cit2b2lkIGRlYnVndHJhY2VfcHJpbnRrKGNvbnN0IGNoYXIgKmZtdCwgLi4uKQoreworICAgIHN0
YXRpYyBjaGFyIGJ1ZlsxMDI0XSwgbGFzdF9idWZbMTAyNF07CisgICAgc3RhdGljIHVuc2lnbmVk
IGludCBjb3VudCwgbGFzdF9jb3VudCwgbGFzdF9wcmQ7CisKKyAgICBjaGFyICAgICAgICAgIGNu
dGJ1ZlsyNF07CisgICAgdmFfbGlzdCAgICAgICBhcmdzOworICAgIHVuc2lnbmVkIGxvbmcgZmxh
Z3M7CisKKyAgICBpZiAoIGRlYnVndHJhY2VfYnl0ZXMgPT0gMCApCisgICAgICAgIHJldHVybjsK
KworICAgIGRlYnVndHJhY2VfdXNlZCA9IDE7CisKKyAgICBzcGluX2xvY2tfaXJxc2F2ZSgmZGVi
dWd0cmFjZV9sb2NrLCBmbGFncyk7CisKKyAgICBBU1NFUlQoZGVidWd0cmFjZV9idWZbZGVidWd0
cmFjZV9ieXRlcyAtIDFdID09IDApOworCisgICAgdmFfc3RhcnQoYXJncywgZm10KTsKKyAgICB2
c25wcmludGYoYnVmLCBzaXplb2YoYnVmKSwgZm10LCBhcmdzKTsKKyAgICB2YV9lbmQoYXJncyk7
CisKKyAgICBpZiAoIGRlYnVndHJhY2Vfc2VuZF90b19jb25zb2xlICkKKyAgICB7CisgICAgICAg
IHNucHJpbnRmKGNudGJ1Ziwgc2l6ZW9mKGNudGJ1ZiksICIldSAiLCArK2NvdW50KTsKKyAgICAg
ICAgc2VyaWFsX3B1dHMoc2VyY29uX2hhbmRsZSwgY250YnVmKTsKKyAgICAgICAgc2VyaWFsX3B1
dHMoc2VyY29uX2hhbmRsZSwgYnVmKTsKKyAgICB9CisgICAgZWxzZQorICAgIHsKKyAgICAgICAg
aWYgKCBzdHJjbXAoYnVmLCBsYXN0X2J1ZikgKQorICAgICAgICB7CisgICAgICAgICAgICBsYXN0
X3ByZCA9IGRlYnVndHJhY2VfcHJkOworICAgICAgICAgICAgbGFzdF9jb3VudCA9ICsrY291bnQ7
CisgICAgICAgICAgICBzYWZlX3N0cmNweShsYXN0X2J1ZiwgYnVmKTsKKyAgICAgICAgICAgIHNu
cHJpbnRmKGNudGJ1Ziwgc2l6ZW9mKGNudGJ1ZiksICIldSAiLCBjb3VudCk7CisgICAgICAgIH0K
KyAgICAgICAgZWxzZQorICAgICAgICB7CisgICAgICAgICAgICBkZWJ1Z3RyYWNlX3ByZCA9IGxh
c3RfcHJkOworICAgICAgICAgICAgc25wcmludGYoY250YnVmLCBzaXplb2YoY250YnVmKSwgIiV1
LSV1ICIsIGxhc3RfY291bnQsICsrY291bnQpOworICAgICAgICB9CisgICAgICAgIGRlYnVndHJh
Y2VfYWRkX3RvX2J1ZihjbnRidWYpOworICAgICAgICBkZWJ1Z3RyYWNlX2FkZF90b19idWYoYnVm
KTsKKyAgICB9CisKKyAgICBzcGluX3VubG9ja19pcnFyZXN0b3JlKCZkZWJ1Z3RyYWNlX2xvY2ss
IGZsYWdzKTsKK30KKworc3RhdGljIHZvaWQgZGVidWd0cmFjZV9rZXkodW5zaWduZWQgY2hhciBr
ZXkpCit7CisgICAgZGVidWd0cmFjZV90b2dnbGUoKTsKK30KKworc3RhdGljIGludCBfX2luaXQg
ZGVidWd0cmFjZV9pbml0KHZvaWQpCit7CisgICAgaW50IG9yZGVyOworICAgIHVuc2lnbmVkIGlu
dCBrYnl0ZXMsIGJ5dGVzOworCisgICAgLyogUm91bmQgc2l6ZSBkb3duIHRvIG5leHQgcG93ZXIg
b2YgdHdvLiAqLworICAgIHdoaWxlICggKGtieXRlcyA9IChkZWJ1Z3RyYWNlX2tpbG9ieXRlcyAm
IChkZWJ1Z3RyYWNlX2tpbG9ieXRlcy0xKSkpICE9IDAgKQorICAgICAgICBkZWJ1Z3RyYWNlX2tp
bG9ieXRlcyA9IGtieXRlczsKKworICAgIGJ5dGVzID0gZGVidWd0cmFjZV9raWxvYnl0ZXMgPDwg
MTA7CisgICAgaWYgKCBieXRlcyA9PSAwICkKKyAgICAgICAgcmV0dXJuIDA7CisKKyAgICBvcmRl
ciA9IGdldF9vcmRlcl9mcm9tX2J5dGVzKGJ5dGVzKTsKKyAgICBkZWJ1Z3RyYWNlX2J1ZiA9IGFs
bG9jX3hlbmhlYXBfcGFnZXMob3JkZXIsIDApOworICAgIEFTU0VSVChkZWJ1Z3RyYWNlX2J1ZiAh
PSBOVUxMKTsKKworICAgIG1lbXNldChkZWJ1Z3RyYWNlX2J1ZiwgJ1wwJywgYnl0ZXMpOworCisg
ICAgZGVidWd0cmFjZV9ieXRlcyA9IGJ5dGVzOworCisgICAgcmVnaXN0ZXJfa2V5aGFuZGxlcign
VCcsIGRlYnVndHJhY2Vfa2V5LAorICAgICAgICAgICAgICAgICAgICAgICAgInRvZ2dsZSBkZWJ1
Z3RyYWNlIHRvIGNvbnNvbGUvYnVmZmVyIiwgMCk7CisKKyAgICByZXR1cm4gMDsKK30KK19faW5p
dGNhbGwoZGVidWd0cmFjZV9pbml0KTsKKwpkaWZmIC0tZ2l0IGEveGVuL2RyaXZlcnMvY2hhci9j
b25zb2xlLmMgYi94ZW4vZHJpdmVycy9jaGFyL2NvbnNvbGUuYwppbmRleCBkNzI4ZTczN2QxLi45
Zjg3ZGM3NGFjIDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy9jaGFyL2NvbnNvbGUuYworKysgYi94
ZW4vZHJpdmVycy9jaGFyL2NvbnNvbGUuYwpAQCAtOTIsNyArOTIsNyBAQCBzdGF0aWMgY2hhciAq
X19yZWFkX21vc3RseSBjb25yaW5nID0gX2NvbnJpbmc7CiBzdGF0aWMgdWludDMyX3QgX19yZWFk
X21vc3RseSBjb25yaW5nX3NpemUgPSBfQ09OUklOR19TSVpFOwogc3RhdGljIHVpbnQzMl90IGNv
bnJpbmdjLCBjb25yaW5ncDsKIAotc3RhdGljIGludCBfX3JlYWRfbW9zdGx5IHNlcmNvbl9oYW5k
bGUgPSAtMTsKK2ludCBfX3JlYWRfbW9zdGx5IHNlcmNvbl9oYW5kbGUgPSAtMTsKIAogI2lmZGVm
IENPTkZJR19YODYKIC8qIFRyaXN0YXRlOiAwIGRpc2FibGVkLCAxIHVzZXIgZW5hYmxlZCwgLTEg
ZGVmYXVsdCBlbmFibGVkICovCkBAIC0zNDYsNyArMzQ2LDcgQEAgdm9pZCBjb25zb2xlX2dpdmVi
YWNrKGludCBpZCkKICAgICAgICAgc2VyaWFsX3N0ZWFsX2ZuID0gTlVMTDsKIH0KIAotc3RhdGlj
IHZvaWQgc2VyY29uX3B1dHMoY29uc3QgY2hhciAqcykKK3ZvaWQgc2VyY29uX3B1dHMoY29uc3Qg
Y2hhciAqcykKIHsKICAgICBpZiAoIHNlcmlhbF9zdGVhbF9mbiAhPSBOVUxMICkKICAgICAgICAg
KCpzZXJpYWxfc3RlYWxfZm4pKHMpOwpAQCAtMTE1NSwxNzggKzExNTUsNiBAQCBpbnQgcHJpbnRr
X3JhdGVsaW1pdCh2b2lkKQogICAgIHJldHVybiBfX3ByaW50a19yYXRlbGltaXQocHJpbnRrX3Jh
dGVsaW1pdF9tcywgcHJpbnRrX3JhdGVsaW1pdF9idXJzdCk7CiB9CiAKLS8qCi0gKiAqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgot
ICogKioqKioqKioqKioqKioqIFNlcmlhbCBjb25zb2xlIHJpbmcgYnVmZmVyICoqKioqKioqKioq
KioqKioqKioKLSAqICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqCi0gKi8KLQotI2lmZGVmIENPTkZJR19ERUJVR19UUkFDRQotCi0v
KiBTZW5kIG91dHB1dCBkaXJlY3QgdG8gY29uc29sZSwgb3IgYnVmZmVyIGl0PyAqLwotc3RhdGlj
IHZvbGF0aWxlIGludCBkZWJ1Z3RyYWNlX3NlbmRfdG9fY29uc29sZTsKLQotc3RhdGljIGNoYXIg
ICAgICAgICpkZWJ1Z3RyYWNlX2J1ZjsgLyogRGVidWctdHJhY2UgYnVmZmVyICovCi1zdGF0aWMg
dW5zaWduZWQgaW50IGRlYnVndHJhY2VfcHJkOyAvKiBQcm9kdWNlciBpbmRleCAgICAgKi8KLXN0
YXRpYyB1bnNpZ25lZCBpbnQgZGVidWd0cmFjZV9raWxvYnl0ZXMgPSAxMjgsIGRlYnVndHJhY2Vf
Ynl0ZXM7Ci1zdGF0aWMgdW5zaWduZWQgaW50IGRlYnVndHJhY2VfdXNlZDsKLXN0YXRpYyBERUZJ
TkVfU1BJTkxPQ0soZGVidWd0cmFjZV9sb2NrKTsKLWludGVnZXJfcGFyYW0oImRlYnVndHJhY2Ui
LCBkZWJ1Z3RyYWNlX2tpbG9ieXRlcyk7Ci0KLXN0YXRpYyB2b2lkIGRlYnVndHJhY2VfZHVtcF93
b3JrZXIodm9pZCkKLXsKLSAgICBpZiAoIChkZWJ1Z3RyYWNlX2J5dGVzID09IDApIHx8ICFkZWJ1
Z3RyYWNlX3VzZWQgKQotICAgICAgICByZXR1cm47Ci0KLSAgICBwcmludGsoImRlYnVndHJhY2Vf
ZHVtcCgpIHN0YXJ0aW5nXG4iKTsKLQotICAgIC8qIFByaW50IG9sZGVzdCBwb3J0aW9uIG9mIHRo
ZSByaW5nLiAqLwotICAgIEFTU0VSVChkZWJ1Z3RyYWNlX2J1ZltkZWJ1Z3RyYWNlX2J5dGVzIC0g
MV0gPT0gMCk7Ci0gICAgc2VyY29uX3B1dHMoJmRlYnVndHJhY2VfYnVmW2RlYnVndHJhY2VfcHJk
XSk7Ci0KLSAgICAvKiBQcmludCB5b3VuZ2VzdCBwb3J0aW9uIG9mIHRoZSByaW5nLiAqLwotICAg
IGRlYnVndHJhY2VfYnVmW2RlYnVndHJhY2VfcHJkXSA9ICdcMCc7Ci0gICAgc2VyY29uX3B1dHMo
JmRlYnVndHJhY2VfYnVmWzBdKTsKLQotICAgIG1lbXNldChkZWJ1Z3RyYWNlX2J1ZiwgJ1wwJywg
ZGVidWd0cmFjZV9ieXRlcyk7Ci0KLSAgICBwcmludGsoImRlYnVndHJhY2VfZHVtcCgpIGZpbmlz
aGVkXG4iKTsKLX0KLQotc3RhdGljIHZvaWQgZGVidWd0cmFjZV90b2dnbGUodm9pZCkKLXsKLSAg
ICB1bnNpZ25lZCBsb25nIGZsYWdzOwotCi0gICAgd2F0Y2hkb2dfZGlzYWJsZSgpOwotICAgIHNw
aW5fbG9ja19pcnFzYXZlKCZkZWJ1Z3RyYWNlX2xvY2ssIGZsYWdzKTsKLQotICAgIC8qCi0gICAg
ICogRHVtcCB0aGUgYnVmZmVyICpiZWZvcmUqIHRvZ2dsaW5nLCBpbiBjYXNlIHRoZSBhY3Qgb2Yg
ZHVtcGluZyB0aGUKLSAgICAgKiBidWZmZXIgaXRzZWxmIGNhdXNlcyBtb3JlIHByaW50aygpIGlu
dm9jYXRpb25zLgotICAgICAqLwotICAgIHByaW50aygiZGVidWd0cmFjZV9wcmludGsgbm93IHdy
aXRpbmcgdG8gJXMuXG4iLAotICAgICAgICAgICAhZGVidWd0cmFjZV9zZW5kX3RvX2NvbnNvbGUg
PyAiY29uc29sZSI6ICJidWZmZXIiKTsKLSAgICBpZiAoICFkZWJ1Z3RyYWNlX3NlbmRfdG9fY29u
c29sZSApCi0gICAgICAgIGRlYnVndHJhY2VfZHVtcF93b3JrZXIoKTsKLQotICAgIGRlYnVndHJh
Y2Vfc2VuZF90b19jb25zb2xlID0gIWRlYnVndHJhY2Vfc2VuZF90b19jb25zb2xlOwotCi0gICAg
c3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZGVidWd0cmFjZV9sb2NrLCBmbGFncyk7Ci0gICAgd2F0
Y2hkb2dfZW5hYmxlKCk7Ci0KLX0KLQotdm9pZCBkZWJ1Z3RyYWNlX2R1bXAodm9pZCkKLXsKLSAg
ICB1bnNpZ25lZCBsb25nIGZsYWdzOwotCi0gICAgd2F0Y2hkb2dfZGlzYWJsZSgpOwotICAgIHNw
aW5fbG9ja19pcnFzYXZlKCZkZWJ1Z3RyYWNlX2xvY2ssIGZsYWdzKTsKLQotICAgIGRlYnVndHJh
Y2VfZHVtcF93b3JrZXIoKTsKLQotICAgIHNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmRlYnVndHJh
Y2VfbG9jaywgZmxhZ3MpOwotICAgIHdhdGNoZG9nX2VuYWJsZSgpOwotfQotCi1zdGF0aWMgdm9p
ZCBkZWJ1Z3RyYWNlX2FkZF90b19idWYoY2hhciAqYnVmKQotewotICAgIGNoYXIgKnA7Ci0KLSAg
ICBmb3IgKCBwID0gYnVmOyAqcCAhPSAnXDAnOyBwKysgKQotICAgIHsKLSAgICAgICAgZGVidWd0
cmFjZV9idWZbZGVidWd0cmFjZV9wcmQrK10gPSAqcDsKLSAgICAgICAgLyogQWx3YXlzIGxlYXZl
IGEgbnVsIGJ5dGUgYXQgdGhlIGVuZCBvZiB0aGUgYnVmZmVyLiAqLwotICAgICAgICBpZiAoIGRl
YnVndHJhY2VfcHJkID09IChkZWJ1Z3RyYWNlX2J5dGVzIC0gMSkgKQotICAgICAgICAgICAgZGVi
dWd0cmFjZV9wcmQgPSAwOwotICAgIH0KLX0KLQotdm9pZCBkZWJ1Z3RyYWNlX3ByaW50ayhjb25z
dCBjaGFyICpmbXQsIC4uLikKLXsKLSAgICBzdGF0aWMgY2hhciBidWZbMTAyNF0sIGxhc3RfYnVm
WzEwMjRdOwotICAgIHN0YXRpYyB1bnNpZ25lZCBpbnQgY291bnQsIGxhc3RfY291bnQsIGxhc3Rf
cHJkOwotCi0gICAgY2hhciAgICAgICAgICBjbnRidWZbMjRdOwotICAgIHZhX2xpc3QgICAgICAg
YXJnczsKLSAgICB1bnNpZ25lZCBsb25nIGZsYWdzOwotCi0gICAgaWYgKCBkZWJ1Z3RyYWNlX2J5
dGVzID09IDAgKQotICAgICAgICByZXR1cm47Ci0KLSAgICBkZWJ1Z3RyYWNlX3VzZWQgPSAxOwot
Ci0gICAgc3Bpbl9sb2NrX2lycXNhdmUoJmRlYnVndHJhY2VfbG9jaywgZmxhZ3MpOwotCi0gICAg
QVNTRVJUKGRlYnVndHJhY2VfYnVmW2RlYnVndHJhY2VfYnl0ZXMgLSAxXSA9PSAwKTsKLQotICAg
IHZhX3N0YXJ0KGFyZ3MsIGZtdCk7Ci0gICAgdnNucHJpbnRmKGJ1Ziwgc2l6ZW9mKGJ1ZiksIGZt
dCwgYXJncyk7Ci0gICAgdmFfZW5kKGFyZ3MpOwotCi0gICAgaWYgKCBkZWJ1Z3RyYWNlX3NlbmRf
dG9fY29uc29sZSApCi0gICAgewotICAgICAgICBzbnByaW50ZihjbnRidWYsIHNpemVvZihjbnRi
dWYpLCAiJXUgIiwgKytjb3VudCk7Ci0gICAgICAgIHNlcmlhbF9wdXRzKHNlcmNvbl9oYW5kbGUs
IGNudGJ1Zik7Ci0gICAgICAgIHNlcmlhbF9wdXRzKHNlcmNvbl9oYW5kbGUsIGJ1Zik7Ci0gICAg
fQotICAgIGVsc2UKLSAgICB7Ci0gICAgICAgIGlmICggc3RyY21wKGJ1ZiwgbGFzdF9idWYpICkK
LSAgICAgICAgewotICAgICAgICAgICAgbGFzdF9wcmQgPSBkZWJ1Z3RyYWNlX3ByZDsKLSAgICAg
ICAgICAgIGxhc3RfY291bnQgPSArK2NvdW50OwotICAgICAgICAgICAgc2FmZV9zdHJjcHkobGFz
dF9idWYsIGJ1Zik7Ci0gICAgICAgICAgICBzbnByaW50ZihjbnRidWYsIHNpemVvZihjbnRidWYp
LCAiJXUgIiwgY291bnQpOwotICAgICAgICB9Ci0gICAgICAgIGVsc2UKLSAgICAgICAgewotICAg
ICAgICAgICAgZGVidWd0cmFjZV9wcmQgPSBsYXN0X3ByZDsKLSAgICAgICAgICAgIHNucHJpbnRm
KGNudGJ1Ziwgc2l6ZW9mKGNudGJ1ZiksICIldS0ldSAiLCBsYXN0X2NvdW50LCArK2NvdW50KTsK
LSAgICAgICAgfQotICAgICAgICBkZWJ1Z3RyYWNlX2FkZF90b19idWYoY250YnVmKTsKLSAgICAg
ICAgZGVidWd0cmFjZV9hZGRfdG9fYnVmKGJ1Zik7Ci0gICAgfQotCi0gICAgc3Bpbl91bmxvY2tf
aXJxcmVzdG9yZSgmZGVidWd0cmFjZV9sb2NrLCBmbGFncyk7Ci19Ci0KLXN0YXRpYyB2b2lkIGRl
YnVndHJhY2Vfa2V5KHVuc2lnbmVkIGNoYXIga2V5KQotewotICAgIGRlYnVndHJhY2VfdG9nZ2xl
KCk7Ci19Ci0KLXN0YXRpYyBpbnQgX19pbml0IGRlYnVndHJhY2VfaW5pdCh2b2lkKQotewotICAg
IGludCBvcmRlcjsKLSAgICB1bnNpZ25lZCBpbnQga2J5dGVzLCBieXRlczsKLQotICAgIC8qIFJv
dW5kIHNpemUgZG93biB0byBuZXh0IHBvd2VyIG9mIHR3by4gKi8KLSAgICB3aGlsZSAoIChrYnl0
ZXMgPSAoZGVidWd0cmFjZV9raWxvYnl0ZXMgJiAoZGVidWd0cmFjZV9raWxvYnl0ZXMtMSkpKSAh
PSAwICkKLSAgICAgICAgZGVidWd0cmFjZV9raWxvYnl0ZXMgPSBrYnl0ZXM7Ci0KLSAgICBieXRl
cyA9IGRlYnVndHJhY2Vfa2lsb2J5dGVzIDw8IDEwOwotICAgIGlmICggYnl0ZXMgPT0gMCApCi0g
ICAgICAgIHJldHVybiAwOwotCi0gICAgb3JkZXIgPSBnZXRfb3JkZXJfZnJvbV9ieXRlcyhieXRl
cyk7Ci0gICAgZGVidWd0cmFjZV9idWYgPSBhbGxvY194ZW5oZWFwX3BhZ2VzKG9yZGVyLCAwKTsK
LSAgICBBU1NFUlQoZGVidWd0cmFjZV9idWYgIT0gTlVMTCk7Ci0KLSAgICBtZW1zZXQoZGVidWd0
cmFjZV9idWYsICdcMCcsIGJ5dGVzKTsKLQotICAgIGRlYnVndHJhY2VfYnl0ZXMgPSBieXRlczsK
LQotICAgIHJlZ2lzdGVyX2tleWhhbmRsZXIoJ1QnLCBkZWJ1Z3RyYWNlX2tleSwKLSAgICAgICAg
ICAgICAgICAgICAgICAgICJ0b2dnbGUgZGVidWd0cmFjZSB0byBjb25zb2xlL2J1ZmZlciIsIDAp
OwotCi0gICAgcmV0dXJuIDA7Ci19Ci1fX2luaXRjYWxsKGRlYnVndHJhY2VfaW5pdCk7Ci0KLSNl
bmRpZiAvKiAhQ09ORklHX0RFQlVHX1RSQUNFICovCi0KLQogLyoKICAqICoqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgKiAqKioq
KioqKioqKioqKiogRGVidWdnaW5nL3RyYWNpbmcvZXJyb3ItcmVwb3J0ICoqKioqKioqKioqKioq
KgpkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUveGVuL2NvbnNvbGUuaCBiL3hlbi9pbmNsdWRlL3hl
bi9jb25zb2xlLmgKaW5kZXggYjRmOTQ2MzkzNi4uMjZhZWRlMjJlNCAxMDA2NDQKLS0tIGEveGVu
L2luY2x1ZGUveGVuL2NvbnNvbGUuaAorKysgYi94ZW4vaW5jbHVkZS94ZW4vY29uc29sZS5oCkBA
IC00OCw0ICs0OCw4IEBAIGludCBjb25zb2xlX3Jlc3VtZSh2b2lkKTsKIAogZXh0ZXJuIGludDhf
dCBvcHRfY29uc29sZV94ZW47CiAKKy8qIElzc3VlIHN0cmluZyB2aWEgc2VyaWFsIGxpbmUuICov
CitleHRlcm4gaW50IHNlcmNvbl9oYW5kbGU7Cit2b2lkIHNlcmNvbl9wdXRzKGNvbnN0IGNoYXIg
KnMpOworCiAjZW5kaWYgLyogX19DT05TT0xFX0hfXyAqLwotLSAKMi4xNi40CgoKX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcg
bGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9q
ZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

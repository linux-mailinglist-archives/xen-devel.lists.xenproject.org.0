Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 1EA85B2AB4
	for <lists+xen-devel@lfdr.de>; Sat, 14 Sep 2019 10:57:10 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i93oV-0008Rm-3q; Sat, 14 Sep 2019 08:53:51 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=rDpt=XJ=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1i93oS-0008OK-NO
 for xen-devel@lists.xenproject.org; Sat, 14 Sep 2019 08:53:48 +0000
X-Inumbo-ID: 0e37f866-d6cd-11e9-95c1-12813bfff9fa
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 0e37f866-d6cd-11e9-95c1-12813bfff9fa;
 Sat, 14 Sep 2019 08:53:01 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 73ACEB664;
 Sat, 14 Sep 2019 08:52:59 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Sat, 14 Sep 2019 10:52:18 +0200
Message-Id: <20190914085251.18816-15-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190914085251.18816-1-jgross@suse.com>
References: <20190914085251.18816-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v3 14/47] xen/sched: make null scheduler vcpu
 agnostic.
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Dario Faggioli <dfaggioli@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

U3dpdGNoIG51bGwgc2NoZWR1bGVyIGNvbXBsZXRlbHkgZnJvbSB2Y3B1IHRvIHNjaGVkX3VuaXQg
dXNhZ2UuCgpTaWduZWQtb2ZmLWJ5OiBKdWVyZ2VuIEdyb3NzIDxqZ3Jvc3NAc3VzZS5jb20+Ci0t
LQogeGVuL2NvbW1vbi9zY2hlZF9udWxsLmMgfCAzMzMgKysrKysrKysrKysrKysrKysrKysrKysr
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgMTY1IGluc2VydGlvbnMo
KyksIDE2OCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3NjaGVkX251bGwu
YyBiL3hlbi9jb21tb24vc2NoZWRfbnVsbC5jCmluZGV4IDYzZWUxZjU0MzkuLmMzNjY2YzlmNTYg
MTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWRfbnVsbC5jCisrKyBiL3hlbi9jb21tb24vc2No
ZWRfbnVsbC5jCkBAIC0xOCwxMCArMTgsMTAgQEAKIAogLyoKICAqIFRoZSAnbnVsbCcgc2NoZWR1
bGVyIGFsd2F5cyBjaG9vc2UgdG8gcnVuLCBvbiBlYWNoIHBDUFUsIGVpdGhlciBub3RoaW5nCi0g
KiAoaS5lLiwgdGhlIHBDUFUgc3RheXMgaWRsZSkgb3IgYWx3YXlzIHRoZSBzYW1lIHZDUFUuCisg
KiAoaS5lLiwgdGhlIHBDUFUgc3RheXMgaWRsZSkgb3IgYWx3YXlzIHRoZSBzYW1lIEl0ZW0uCiAg
KgogICogSXQgaXMgYWltZWQgYXQgc3VwcG9ydGluZyBzdGF0aWMgc2NlbmFyaW9zLCB3aGVyZSB0
aGVyZSBhbHdheXMgYXJlCi0gKiBsZXNzIHZDUFVzIHRoYW4gcENQVXMgKGFuZCB0aGUgdkNQVXMg
ZG9uJ3QgbmVlZCB0byBtb3ZlIGFtb25nIHBDUFVzCisgKiBsZXNzIEl0ZW1zIHRoYW4gcENQVXMg
KGFuZCB0aGUgSXRlbXMgZG9uJ3QgbmVlZCB0byBtb3ZlIGFtb25nIHBDUFVzCiAgKiBmb3IgYW55
IHJlYXNvbikgd2l0aCB0aGUgbGVhc3QgcG9zc2libGUgb3ZlcmhlYWQuCiAgKgogICogVHlwaWNh
bCB1c2VjYXNlIGFyZSBlbWJlZGRlZCBhcHBsaWNhdGlvbnMsIGJ1dCBhbHNvIEhQQywgZXNwZWNp
YWxseQpAQCAtMzcsOCArMzcsOCBAQAogICogbnVsbCB0cmFjaW5nIGV2ZW50cy4gQ2hlY2sgaW5j
bHVkZS9wdWJsaWMvdHJhY2UuaCBmb3IgbW9yZSBkZXRhaWxzLgogICovCiAjZGVmaW5lIFRSQ19T
TlVMTF9QSUNLRURfQ1BVICAgIFRSQ19TQ0hFRF9DTEFTU19FVlQoU05VTEwsIDEpCi0jZGVmaW5l
IFRSQ19TTlVMTF9WQ1BVX0FTU0lHTiAgIFRSQ19TQ0hFRF9DTEFTU19FVlQoU05VTEwsIDIpCi0j
ZGVmaW5lIFRSQ19TTlVMTF9WQ1BVX0RFQVNTSUdOIFRSQ19TQ0hFRF9DTEFTU19FVlQoU05VTEws
IDMpCisjZGVmaW5lIFRSQ19TTlVMTF9VTklUX0FTU0lHTiAgIFRSQ19TQ0hFRF9DTEFTU19FVlQo
U05VTEwsIDIpCisjZGVmaW5lIFRSQ19TTlVMTF9VTklUX0RFQVNTSUdOIFRSQ19TQ0hFRF9DTEFT
U19FVlQoU05VTEwsIDMpCiAjZGVmaW5lIFRSQ19TTlVMTF9NSUdSQVRFICAgICAgIFRSQ19TQ0hF
RF9DTEFTU19FVlQoU05VTEwsIDQpCiAjZGVmaW5lIFRSQ19TTlVMTF9TQ0hFRFVMRSAgICAgIFRS
Q19TQ0hFRF9DTEFTU19FVlQoU05VTEwsIDUpCiAjZGVmaW5lIFRSQ19TTlVMTF9UQVNLTEVUICAg
ICAgIFRSQ19TQ0hFRF9DTEFTU19FVlQoU05VTEwsIDYpCkBAIC00NywxMyArNDcsMTMgQEAKICAq
IExvY2tpbmc6CiAgKiAtIFNjaGVkdWxlci1sb2NrIChhLmsuYS4gcnVucXVldWUgbG9jayk6CiAg
KiAgKyBpcyBwZXItcENQVTsKLSAqICArIHNlcmlhbGl6ZXMgYXNzaWdubWVudCBhbmQgZGVhc3Np
Z25tZW50IG9mIHZDUFVzIHRvIGEgcENQVS4KKyAqICArIHNlcmlhbGl6ZXMgYXNzaWdubWVudCBh
bmQgZGVhc3NpZ25tZW50IG9mIEl0ZW1zIHRvIGEgcENQVS4KICAqIC0gUHJpdmF0ZSBkYXRhIGxv
Y2sgKGEuay5hLiBwcml2YXRlIHNjaGVkdWxlciBsb2NrKToKICAqICArIGlzIHNjaGVkdWxlci13
aWRlOwogICogICsgc2VyaWFsaXplcyBhY2Nlc3NlcyB0byB0aGUgbGlzdCBvZiBkb21haW5zIGlu
IHRoaXMgc2NoZWR1bGVyLgogICogLSBXYWl0cXVldWUgbG9jazoKICAqICArIGlzIHNjaGVkdWxl
ci13aWRlOwotICogICsgc2VyaWFsaXplIGFjY2Vzc2VzIHRvIHRoZSBsaXN0IG9mIHZDUFVzIHdh
aXRpbmcgdG8gYmUgYXNzaWduZWQKKyAqICArIHNlcmlhbGl6ZSBhY2Nlc3NlcyB0byB0aGUgbGlz
dCBvZiBJdGVtcyB3YWl0aW5nIHRvIGJlIGFzc2lnbmVkCiAgKiAgICB0byBwQ1BVcy4KICAqCiAg
KiBPcmRlcmluZyBpczogcHJpdmF0ZSBsb2NrLCBydW5xdWV1ZSBsb2NrLCB3YWl0cXVldWUgbG9j
ay4gT3IsIE9UT0gsCkBAIC03NywyNSArNzcsMjUgQEAKIHN0cnVjdCBudWxsX3ByaXZhdGUgewog
ICAgIHNwaW5sb2NrX3QgbG9jazsgICAgICAgIC8qIHNjaGVkdWxlciBsb2NrOyBuZXN0cyBpbnNp
ZGUgY3B1cG9vbF9sb2NrICovCiAgICAgc3RydWN0IGxpc3RfaGVhZCBuZG9tOyAgLyogRG9tYWlu
cyBvZiB0aGlzIHNjaGVkdWxlciAgICAgICAgICAgICAgICAgKi8KLSAgICBzdHJ1Y3QgbGlzdF9o
ZWFkIHdhaXRxOyAvKiB2Q1BVcyBub3QgYXNzaWduZWQgdG8gYW55IHBDUFUgICAgICAgICAgICAq
LworICAgIHN0cnVjdCBsaXN0X2hlYWQgd2FpdHE7IC8qIEl0ZW1zIG5vdCBhc3NpZ25lZCB0byBh
bnkgcENQVSAgICAgICAgICAgICovCiAgICAgc3BpbmxvY2tfdCB3YWl0cV9sb2NrOyAgLyogc2Vy
aWFsaXplcyB3YWl0cTsgbmVzdHMgaW5zaWRlIHJ1bnEgbG9ja3MgKi8KLSAgICBjcHVtYXNrX3Qg
Y3B1c19mcmVlOyAgICAvKiBDUFVzIHdpdGhvdXQgYSB2Q1BVIGFzc29jaWF0ZWQgdG8gdGhlbSAg
ICAqLworICAgIGNwdW1hc2tfdCBjcHVzX2ZyZWU7ICAgIC8qIENQVXMgd2l0aG91dCBhIEl0ZW0g
YXNzb2NpYXRlZCB0byB0aGVtICAgICovCiB9OwogCiAvKgogICogUGh5c2ljYWwgQ1BVCiAgKi8K
IHN0cnVjdCBudWxsX3BjcHUgewotICAgIHN0cnVjdCB2Y3B1ICp2Y3B1OworICAgIHN0cnVjdCBz
Y2hlZF91bml0ICp1bml0OwogfTsKIERFRklORV9QRVJfQ1BVKHN0cnVjdCBudWxsX3BjcHUsIG5w
Yyk7CiAKIC8qCi0gKiBWaXJ0dWFsIENQVQorICogU2NoZWR1bGUgSXRlbQogICovCiBzdHJ1Y3Qg
bnVsbF91bml0IHsKICAgICBzdHJ1Y3QgbGlzdF9oZWFkIHdhaXRxX2VsZW07Ci0gICAgc3RydWN0
IHZjcHUgKnZjcHU7CisgICAgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQ7CiB9OwogCiAvKgpAQCAt
MTE5LDEzICsxMTksMTMgQEAgc3RhdGljIGlubGluZSBzdHJ1Y3QgbnVsbF91bml0ICpudWxsX3Vu
aXQoY29uc3Qgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiAgICAgcmV0dXJuIHVuaXQtPnByaXY7
CiB9CiAKLXN0YXRpYyBpbmxpbmUgYm9vbCB2Y3B1X2NoZWNrX2FmZmluaXR5KHN0cnVjdCB2Y3B1
ICp2LCB1bnNpZ25lZCBpbnQgY3B1LAorc3RhdGljIGlubGluZSBib29sIHVuaXRfY2hlY2tfYWZm
aW5pdHkoc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgY3B1LAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IGJhbGFuY2Vfc3RlcCkKIHsKLSAgICBhZmZpbml0
eV9iYWxhbmNlX2NwdW1hc2sodi0+c2NoZWRfdW5pdCwgYmFsYW5jZV9zdGVwLAotICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSkpOworICAgIGFmZmlu
aXR5X2JhbGFuY2VfY3B1bWFzayh1bml0LCBiYWxhbmNlX3N0ZXAsIGNwdW1hc2tfc2NyYXRjaF9j
cHUoY3B1KSk7CiAgICAgY3B1bWFza19hbmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCBjcHVt
YXNrX3NjcmF0Y2hfY3B1KGNwdSksCi0gICAgICAgICAgICAgICAgY3B1cG9vbF9kb21haW5fY3B1
bWFzayh2LT5kb21haW4pKTsKKyAgICAgICAgICAgICAgICBjcHVwb29sX2RvbWFpbl9jcHVtYXNr
KHVuaXQtPmRvbWFpbikpOwogCiAgICAgcmV0dXJuIGNwdW1hc2tfdGVzdF9jcHUoY3B1LCBjcHVt
YXNrX3NjcmF0Y2hfY3B1KGNwdSkpOwogfQpAQCAtMTYwLDkgKzE2MCw5IEBAIHN0YXRpYyB2b2lk
IG51bGxfZGVpbml0KHN0cnVjdCBzY2hlZHVsZXIgKm9wcykKIAogc3RhdGljIHZvaWQgaW5pdF9w
ZGF0YShzdHJ1Y3QgbnVsbF9wcml2YXRlICpwcnYsIHVuc2lnbmVkIGludCBjcHUpCiB7Ci0gICAg
LyogTWFyayB0aGUgcENQVSBhcyBmcmVlLCBhbmQgd2l0aCBubyB2Q1BVIGFzc2lnbmVkICovCisg
ICAgLyogTWFyayB0aGUgcENQVSBhcyBmcmVlLCBhbmQgd2l0aCBubyB1bml0IGFzc2lnbmVkICov
CiAgICAgY3B1bWFza19zZXRfY3B1KGNwdSwgJnBydi0+Y3B1c19mcmVlKTsKLSAgICBwZXJfY3B1
KG5wYywgY3B1KS52Y3B1ID0gTlVMTDsKKyAgICBwZXJfY3B1KG5wYywgY3B1KS51bml0ID0gTlVM
TDsKIH0KIAogc3RhdGljIHZvaWQgbnVsbF9pbml0X3BkYXRhKGNvbnN0IHN0cnVjdCBzY2hlZHVs
ZXIgKm9wcywgdm9pZCAqcGRhdGEsIGludCBjcHUpCkBAIC0xODMsMTMgKzE4MywxMiBAQCBzdGF0
aWMgdm9pZCBudWxsX2RlaW5pdF9wZGF0YShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHZv
aWQgKnBjcHUsIGludCBjcHUpCiAgICAgQVNTRVJUKCFwY3B1KTsKIAogICAgIGNwdW1hc2tfY2xl
YXJfY3B1KGNwdSwgJnBydi0+Y3B1c19mcmVlKTsKLSAgICBwZXJfY3B1KG5wYywgY3B1KS52Y3B1
ID0gTlVMTDsKKyAgICBwZXJfY3B1KG5wYywgY3B1KS51bml0ID0gTlVMTDsKIH0KIAogc3RhdGlj
IHZvaWQgKm51bGxfYWxsb2NfdmRhdGEoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQsIHZvaWQg
KmRkKQogewotICAgIHN0cnVjdCB2Y3B1ICp2ID0gdW5pdC0+dmNwdV9saXN0OwogICAgIHN0cnVj
dCBudWxsX3VuaXQgKm52YzsKIAogICAgIG52YyA9IHh6YWxsb2Moc3RydWN0IG51bGxfdW5pdCk7
CkBAIC0xOTcsNyArMTk2LDcgQEAgc3RhdGljIHZvaWQgKm51bGxfYWxsb2NfdmRhdGEoY29uc3Qg
c3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAgICAgICByZXR1cm4gTlVMTDsKIAogICAgIElOSVRf
TElTVF9IRUFEKCZudmMtPndhaXRxX2VsZW0pOwotICAgIG52Yy0+dmNwdSA9IHY7CisgICAgbnZj
LT51bml0ID0gdW5pdDsKIAogICAgIFNDSEVEX1NUQVRfQ1JBTksodW5pdF9hbGxvYyk7CiAKQEAg
LTI0OSwxNSArMjQ4LDE1IEBAIHN0YXRpYyB2b2lkIG51bGxfZnJlZV9kb21kYXRhKGNvbnN0IHN0
cnVjdCBzY2hlZHVsZXIgKm9wcywgdm9pZCAqZGF0YSkKIH0KIAogLyoKLSAqIHZDUFUgdG8gcENQ
VSBhc3NpZ25tZW50IGFuZCBwbGFjZW1lbnQuIFRoaXMgX29ubHlfIGhhcHBlbnM6CisgKiB1bml0
IHRvIHBDUFUgYXNzaWdubWVudCBhbmQgcGxhY2VtZW50LiBUaGlzIF9vbmx5XyBoYXBwZW5zOgog
ICogIC0gb24gaW5zZXJ0LAogICogIC0gb24gbWlncmF0ZS4KICAqCi0gKiBJbnNlcnQgb2NjdXJz
IHdoZW4gYSB2Q1BVIGpvaW5zIHRoaXMgc2NoZWR1bGVyIGZvciB0aGUgZmlyc3QgdGltZQorICog
SW5zZXJ0IG9jY3VycyB3aGVuIGEgdW5pdCBqb2lucyB0aGlzIHNjaGVkdWxlciBmb3IgdGhlIGZp
cnN0IHRpbWUKICAqIChlLmcuLCB3aGVuIHRoZSBkb21haW4gaXQncyBwYXJ0IG9mIGlzIG1vdmVk
IHRvIHRoZSBzY2hlZHVsZXIncwogICogY3B1cG9vbCkuCiAgKgotICogTWlncmF0aW9uIG1heSBi
ZSBuZWNlc3NhcnkgaWYgYSBwQ1BVICh3aXRoIGEgdkNQVSBhc3NpZ25lZCB0byBpdCkKKyAqIE1p
Z3JhdGlvbiBtYXkgYmUgbmVjZXNzYXJ5IGlmIGEgcENQVSAod2l0aCBhIHVuaXQgYXNzaWduZWQg
dG8gaXQpCiAgKiBpcyByZW1vdmVkIGZyb20gdGhlIHNjaGVkdWxlcidzIGNwdXBvb2wuCiAgKgog
ICogU28gdGhpcyBpcyBub3QgcGFydCBvZiBhbnkgaG90IHBhdGguCkBAIC0yNjYsOSArMjY1LDgg
QEAgc3RhdGljIHN0cnVjdCBzY2hlZF9yZXNvdXJjZSAqCiBwaWNrX3JlcyhzdHJ1Y3QgbnVsbF9w
cml2YXRlICpwcnYsIGNvbnN0IHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogewogICAgIHVuc2ln
bmVkIGludCBiczsKLSAgICBzdHJ1Y3QgdmNwdSAqdiA9IHVuaXQtPnZjcHVfbGlzdDsKLSAgICB1
bnNpZ25lZCBpbnQgY3B1ID0gdi0+cHJvY2Vzc29yLCBuZXdfY3B1OwotICAgIGNwdW1hc2tfdCAq
Y3B1cyA9IGNwdXBvb2xfZG9tYWluX2NwdW1hc2sodi0+ZG9tYWluKTsKKyAgICB1bnNpZ25lZCBp
bnQgY3B1ID0gc2NoZWRfdW5pdF9jcHUodW5pdCksIG5ld19jcHU7CisgICAgY3B1bWFza190ICpj
cHVzID0gY3B1cG9vbF9kb21haW5fY3B1bWFzayh1bml0LT5kb21haW4pOwogCiAgICAgQVNTRVJU
KHNwaW5faXNfbG9ja2VkKGdldF9zY2hlZF9yZXMoY3B1KS0+c2NoZWR1bGVfbG9jaykpOwogCkBA
IC0yODMsMTEgKzI4MSwxMiBAQCBwaWNrX3JlcyhzdHJ1Y3QgbnVsbF9wcml2YXRlICpwcnYsIGNv
bnN0IHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogICAgICAgICAvKgogICAgICAgICAgKiBJZiBv
dXIgcHJvY2Vzc29yIGlzIGZyZWUsIG9yIHdlIGFyZSBhc3NpZ25lZCB0byBpdCwgYW5kIGl0IGlz
IGFsc28KICAgICAgICAgICogc3RpbGwgdmFsaWQgYW5kIHBhcnQgb2Ygb3VyIGFmZmluaXR5LCBq
dXN0IGdvIGZvciBpdC4KLSAgICAgICAgICogKE5vdGUgdGhhdCB3ZSBtYXkgY2FsbCB2Y3B1X2No
ZWNrX2FmZmluaXR5KCksIGJ1dCB3ZSBkZWxpYmVyYXRlbHkKKyAgICAgICAgICogKE5vdGUgdGhh
dCB3ZSBtYXkgY2FsbCB1bml0X2NoZWNrX2FmZmluaXR5KCksIGJ1dCB3ZSBkZWxpYmVyYXRlbHkK
ICAgICAgICAgICogZG9uJ3QsIHNvIHdlIGdldCB0byBrZWVwIGluIHRoZSBzY3JhdGNoIGNwdW1h
c2sgd2hhdCB3ZSBoYXZlIGp1c3QKICAgICAgICAgICogcHV0IGluIGl0LikKICAgICAgICAgICov
Ci0gICAgICAgIGlmICggbGlrZWx5KChwZXJfY3B1KG5wYywgY3B1KS52Y3B1ID09IE5VTEwgfHwg
cGVyX2NwdShucGMsIGNwdSkudmNwdSA9PSB2KQorICAgICAgICBpZiAoIGxpa2VseSgocGVyX2Nw
dShucGMsIGNwdSkudW5pdCA9PSBOVUxMIHx8CisgICAgICAgICAgICAgICAgICAgICBwZXJfY3B1
KG5wYywgY3B1KS51bml0ID09IHVuaXQpCiAgICAgICAgICAgICAgICAgICAgICYmIGNwdW1hc2tf
dGVzdF9jcHUoY3B1LCBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSkpKSApCiAgICAgICAgIHsKICAg
ICAgICAgICAgIG5ld19jcHUgPSBjcHU7CkBAIC0zMDUsMTMgKzMwNCwxMyBAQCBwaWNrX3Jlcyhz
dHJ1Y3QgbnVsbF9wcml2YXRlICpwcnYsIGNvbnN0IHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQog
CiAgICAgLyoKICAgICAgKiBJZiB3ZSBkaWRuJ3QgZmluZCBhbnkgZnJlZSBwQ1BVLCBqdXN0IHBp
Y2sgYW55IHZhbGlkIHBjcHUsIGV2ZW4gaWYKLSAgICAgKiBpdCBoYXMgYW5vdGhlciB2Q1BVIGFz
c2lnbmVkLiBUaGlzIHdpbGwgaGFwcGVuIGR1cmluZyBzaHV0ZG93biBhbmQKKyAgICAgKiBpdCBo
YXMgYW5vdGhlciBJdGVtIGFzc2lnbmVkLiBUaGlzIHdpbGwgaGFwcGVuIGR1cmluZyBzaHV0ZG93
biBhbmQKICAgICAgKiBzdXNwZW5kL3Jlc3VtZSwgYnV0IGl0IG1heSBhbHNvIGhhcHBlbiBkdXJp
bmcgIm5vcm1hbCBvcGVyYXRpb24iLCBpZgogICAgICAqIGFsbCB0aGUgcENQVXMgYXJlIGJ1c3ku
CiAgICAgICoKICAgICAgKiBJbiBmYWN0LCB0aGVyZSBtdXN0IGFsd2F5cyBiZSBzb21ldGhpbmcg
c2FuZSBpbiB2LT5wcm9jZXNzb3IsIG9yCiAgICAgICogdW5pdF9zY2hlZHVsZV9sb2NrKCkgYW5k
IGZyaWVuZHMgd29uJ3Qgd29yay4gVGhpcyBpcyBub3QgYSBwcm9ibGVtLAotICAgICAqIGFzIHdl
IHdpbGwgYWN0dWFsbHkgYXNzaWduIHRoZSB2Q1BVIHRvIHRoZSBwQ1BVIHdlIHJldHVybiBmcm9t
IGhlcmUsCisgICAgICogYXMgd2Ugd2lsbCBhY3R1YWxseSBhc3NpZ24gdGhlIEl0ZW0gdG8gdGhl
IHBDUFUgd2UgcmV0dXJuIGZyb20gaGVyZSwKICAgICAgKiBvbmx5IGlmIHRoZSBwQ1BVIGlzIGZy
ZWUuCiAgICAgICovCiAgICAgY3B1bWFza19hbmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCBj
cHVzLCB1bml0LT5jcHVfaGFyZF9hZmZpbml0eSk7CkBAIC0zMjEsMTEgKzMyMCwxMSBAQCBwaWNr
X3JlcyhzdHJ1Y3QgbnVsbF9wcml2YXRlICpwcnYsIGNvbnN0IHN0cnVjdCBzY2hlZF91bml0ICp1
bml0KQogICAgIGlmICggdW5saWtlbHkodGJfaW5pdF9kb25lKSApCiAgICAgewogICAgICAgICBz
dHJ1Y3QgewotICAgICAgICAgICAgdWludDE2X3QgdmNwdSwgZG9tOworICAgICAgICAgICAgdWlu
dDE2X3QgdW5pdCwgZG9tOwogICAgICAgICAgICAgdWludDMyX3QgbmV3X2NwdTsKICAgICAgICAg
fSBkOwotICAgICAgICBkLmRvbSA9IHYtPmRvbWFpbi0+ZG9tYWluX2lkOwotICAgICAgICBkLnZj
cHUgPSB2LT52Y3B1X2lkOworICAgICAgICBkLmRvbSA9IHVuaXQtPmRvbWFpbi0+ZG9tYWluX2lk
OworICAgICAgICBkLnVuaXQgPSB1bml0LT51bml0X2lkOwogICAgICAgICBkLm5ld19jcHUgPSBu
ZXdfY3B1OwogICAgICAgICBfX3RyYWNlX3ZhcihUUkNfU05VTExfUElDS0VEX0NQVSwgMSwgc2l6
ZW9mKGQpLCAmZCk7CiAgICAgfQpAQCAtMzMzLDY0ICszMzIsNjQgQEAgcGlja19yZXMoc3RydWN0
IG51bGxfcHJpdmF0ZSAqcHJ2LCBjb25zdCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKICAgICBy
ZXR1cm4gZ2V0X3NjaGVkX3JlcyhuZXdfY3B1KTsKIH0KIAotc3RhdGljIHZvaWQgdmNwdV9hc3Np
Z24oc3RydWN0IG51bGxfcHJpdmF0ZSAqcHJ2LCBzdHJ1Y3QgdmNwdSAqdiwKK3N0YXRpYyB2b2lk
IHVuaXRfYXNzaWduKHN0cnVjdCBudWxsX3ByaXZhdGUgKnBydiwgc3RydWN0IHNjaGVkX3VuaXQg
KnVuaXQsCiAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgY3B1KQogewotICAg
IEFTU0VSVChpc192Y3B1X29ubGluZSh2KSk7CisgICAgQVNTRVJUKGlzX3VuaXRfb25saW5lKHVu
aXQpKTsKIAotICAgIHBlcl9jcHUobnBjLCBjcHUpLnZjcHUgPSB2OwotICAgIHYtPnByb2Nlc3Nv
ciA9IGNwdTsKLSAgICB2LT5zY2hlZF91bml0LT5yZXMgPSBnZXRfc2NoZWRfcmVzKGNwdSk7Cisg
ICAgcGVyX2NwdShucGMsIGNwdSkudW5pdCA9IHVuaXQ7CisgICAgc2NoZWRfc2V0X3Jlcyh1bml0
LCBnZXRfc2NoZWRfcmVzKGNwdSkpOwogICAgIGNwdW1hc2tfY2xlYXJfY3B1KGNwdSwgJnBydi0+
Y3B1c19mcmVlKTsKIAotICAgIGRwcmludGsoWEVOTE9HX0dfSU5GTywgIiVkIDwtLSAlcHZcbiIs
IGNwdSwgdik7CisgICAgZHByaW50ayhYRU5MT0dfR19JTkZPLCAiJWQgPC0tICVwZHYlZFxuIiwg
Y3B1LCB1bml0LT5kb21haW4sIHVuaXQtPnVuaXRfaWQpOwogCiAgICAgaWYgKCB1bmxpa2VseSh0
Yl9pbml0X2RvbmUpICkKICAgICB7CiAgICAgICAgIHN0cnVjdCB7Ci0gICAgICAgICAgICB1aW50
MTZfdCB2Y3B1LCBkb207CisgICAgICAgICAgICB1aW50MTZfdCB1bml0LCBkb207CiAgICAgICAg
ICAgICB1aW50MzJfdCBjcHU7CiAgICAgICAgIH0gZDsKLSAgICAgICAgZC5kb20gPSB2LT5kb21h
aW4tPmRvbWFpbl9pZDsKLSAgICAgICAgZC52Y3B1ID0gdi0+dmNwdV9pZDsKKyAgICAgICAgZC5k
b20gPSB1bml0LT5kb21haW4tPmRvbWFpbl9pZDsKKyAgICAgICAgZC51bml0ID0gdW5pdC0+dW5p
dF9pZDsKICAgICAgICAgZC5jcHUgPSBjcHU7Ci0gICAgICAgIF9fdHJhY2VfdmFyKFRSQ19TTlVM
TF9WQ1BVX0FTU0lHTiwgMSwgc2l6ZW9mKGQpLCAmZCk7CisgICAgICAgIF9fdHJhY2VfdmFyKFRS
Q19TTlVMTF9VTklUX0FTU0lHTiwgMSwgc2l6ZW9mKGQpLCAmZCk7CiAgICAgfQogfQogCiAvKiBS
ZXR1cm5zIHRydWUgaWYgYSBjcHUgd2FzIHRpY2tsZWQgKi8KLXN0YXRpYyBib29sIHZjcHVfZGVh
c3NpZ24oc3RydWN0IG51bGxfcHJpdmF0ZSAqcHJ2LCBzdHJ1Y3QgdmNwdSAqdikKK3N0YXRpYyBi
b29sIHVuaXRfZGVhc3NpZ24oc3RydWN0IG51bGxfcHJpdmF0ZSAqcHJ2LCBzdHJ1Y3Qgc2NoZWRf
dW5pdCAqdW5pdCkKIHsKICAgICB1bnNpZ25lZCBpbnQgYnM7Ci0gICAgdW5zaWduZWQgaW50IGNw
dSA9IHYtPnByb2Nlc3NvcjsKKyAgICB1bnNpZ25lZCBpbnQgY3B1ID0gc2NoZWRfdW5pdF9jcHUo
dW5pdCk7CiAgICAgc3RydWN0IG51bGxfdW5pdCAqd3ZjOwogCi0gICAgQVNTRVJUKGxpc3RfZW1w
dHkoJm51bGxfdW5pdCh2LT5zY2hlZF91bml0KS0+d2FpdHFfZWxlbSkpOwotICAgIEFTU0VSVChw
ZXJfY3B1KG5wYywgdi0+cHJvY2Vzc29yKS52Y3B1ID09IHYpOwotICAgIEFTU0VSVCghY3B1bWFz
a190ZXN0X2NwdSh2LT5wcm9jZXNzb3IsICZwcnYtPmNwdXNfZnJlZSkpOworICAgIEFTU0VSVChs
aXN0X2VtcHR5KCZudWxsX3VuaXQodW5pdCktPndhaXRxX2VsZW0pKTsKKyAgICBBU1NFUlQocGVy
X2NwdShucGMsIGNwdSkudW5pdCA9PSB1bml0KTsKKyAgICBBU1NFUlQoIWNwdW1hc2tfdGVzdF9j
cHUoY3B1LCAmcHJ2LT5jcHVzX2ZyZWUpKTsKIAotICAgIHBlcl9jcHUobnBjLCBjcHUpLnZjcHUg
PSBOVUxMOworICAgIHBlcl9jcHUobnBjLCBjcHUpLnVuaXQgPSBOVUxMOwogICAgIGNwdW1hc2tf
c2V0X2NwdShjcHUsICZwcnYtPmNwdXNfZnJlZSk7CiAKLSAgICBkcHJpbnRrKFhFTkxPR19HX0lO
Rk8sICIlZCA8LS0gTlVMTCAoJXB2KVxuIiwgY3B1LCB2KTsKKyAgICBkcHJpbnRrKFhFTkxPR19H
X0lORk8sICIlZCA8LS0gTlVMTCAoJXBkdiVkKVxuIiwgY3B1LCB1bml0LT5kb21haW4sCisgICAg
ICAgICAgICB1bml0LT51bml0X2lkKTsKIAogICAgIGlmICggdW5saWtlbHkodGJfaW5pdF9kb25l
KSApCiAgICAgewogICAgICAgICBzdHJ1Y3QgewotICAgICAgICAgICAgdWludDE2X3QgdmNwdSwg
ZG9tOworICAgICAgICAgICAgdWludDE2X3QgdW5pdCwgZG9tOwogICAgICAgICAgICAgdWludDMy
X3QgY3B1OwogICAgICAgICB9IGQ7Ci0gICAgICAgIGQuZG9tID0gdi0+ZG9tYWluLT5kb21haW5f
aWQ7Ci0gICAgICAgIGQudmNwdSA9IHYtPnZjcHVfaWQ7CisgICAgICAgIGQuZG9tID0gdW5pdC0+
ZG9tYWluLT5kb21haW5faWQ7CisgICAgICAgIGQudW5pdCA9IHVuaXQtPnVuaXRfaWQ7CiAgICAg
ICAgIGQuY3B1ID0gY3B1OwotICAgICAgICBfX3RyYWNlX3ZhcihUUkNfU05VTExfVkNQVV9ERUFT
U0lHTiwgMSwgc2l6ZW9mKGQpLCAmZCk7CisgICAgICAgIF9fdHJhY2VfdmFyKFRSQ19TTlVMTF9V
TklUX0RFQVNTSUdOLCAxLCBzaXplb2YoZCksICZkKTsKICAgICB9CiAKICAgICBzcGluX2xvY2so
JnBydi0+d2FpdHFfbG9jayk7CiAKICAgICAvKgotICAgICAqIElmIHYgaXMgYXNzaWduZWQgdG8g
YSBwQ1BVLCBsZXQncyBzZWUgaWYgdGhlcmUgaXMgc29tZW9uZSB3YWl0aW5nLAotICAgICAqIHN1
aXRhYmxlIHRvIGJlIGFzc2lnbmVkIHRvIGl0IChwcmlvcml0aXppbmcgdmNwdXMgdGhhdCBoYXZl
CisgICAgICogSWYgdW5pdCBpcyBhc3NpZ25lZCB0byBhIHBDUFUsIGxldCdzIHNlZSBpZiB0aGVy
ZSBpcyBzb21lb25lIHdhaXRpbmcsCisgICAgICogc3VpdGFibGUgdG8gYmUgYXNzaWduZWQgdG8g
aXQgKHByaW9yaXRpemluZyB1bml0cyB0aGF0IGhhdmUKICAgICAgKiBzb2Z0LWFmZmluaXR5IHdp
dGggY3B1KS4KICAgICAgKi8KICAgICBmb3JfZWFjaF9hZmZpbml0eV9iYWxhbmNlX3N0ZXAoIGJz
ICkKQEAgLTM5OCwxMyArMzk3LDEzIEBAIHN0YXRpYyBib29sIHZjcHVfZGVhc3NpZ24oc3RydWN0
IG51bGxfcHJpdmF0ZSAqcHJ2LCBzdHJ1Y3QgdmNwdSAqdikKICAgICAgICAgbGlzdF9mb3JfZWFj
aF9lbnRyeSggd3ZjLCAmcHJ2LT53YWl0cSwgd2FpdHFfZWxlbSApCiAgICAgICAgIHsKICAgICAg
ICAgICAgIGlmICggYnMgPT0gQkFMQU5DRV9TT0ZUX0FGRklOSVRZICYmCi0gICAgICAgICAgICAg
ICAgICFoYXNfc29mdF9hZmZpbml0eSh3dmMtPnZjcHUtPnNjaGVkX3VuaXQpICkKKyAgICAgICAg
ICAgICAgICAgIWhhc19zb2Z0X2FmZmluaXR5KHd2Yy0+dW5pdCkgKQogICAgICAgICAgICAgICAg
IGNvbnRpbnVlOwogCi0gICAgICAgICAgICBpZiAoIHZjcHVfY2hlY2tfYWZmaW5pdHkod3ZjLT52
Y3B1LCBjcHUsIGJzKSApCisgICAgICAgICAgICBpZiAoIHVuaXRfY2hlY2tfYWZmaW5pdHkod3Zj
LT51bml0LCBjcHUsIGJzKSApCiAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgbGlzdF9k
ZWxfaW5pdCgmd3ZjLT53YWl0cV9lbGVtKTsKLSAgICAgICAgICAgICAgICB2Y3B1X2Fzc2lnbihw
cnYsIHd2Yy0+dmNwdSwgY3B1KTsKKyAgICAgICAgICAgICAgICB1bml0X2Fzc2lnbihwcnYsIHd2
Yy0+dW5pdCwgY3B1KTsKICAgICAgICAgICAgICAgICBjcHVfcmFpc2Vfc29mdGlycShjcHUsIFND
SEVEVUxFX1NPRlRJUlEpOwogICAgICAgICAgICAgICAgIHNwaW5fdW5sb2NrKCZwcnYtPndhaXRx
X2xvY2spOwogICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwpAQCAtNDI1LDkgKzQyNCw5IEBA
IHN0YXRpYyBzcGlubG9ja190ICpudWxsX3N3aXRjaF9zY2hlZChzdHJ1Y3Qgc2NoZWR1bGVyICpu
ZXdfb3BzLAogICAgIHN0cnVjdCBudWxsX3ByaXZhdGUgKnBydiA9IG51bGxfcHJpdihuZXdfb3Bz
KTsKICAgICBzdHJ1Y3QgbnVsbF91bml0ICpudmMgPSB2ZGF0YTsKIAotICAgIEFTU0VSVChudmMg
JiYgaXNfaWRsZV92Y3B1KG52Yy0+dmNwdSkpOworICAgIEFTU0VSVChudmMgJiYgaXNfaWRsZV91
bml0KG52Yy0+dW5pdCkpOwogCi0gICAgaWRsZV92Y3B1W2NwdV0tPnNjaGVkX3VuaXQtPnByaXYg
PSB2ZGF0YTsKKyAgICBzY2hlZF9pZGxlX3VuaXQoY3B1KS0+cHJpdiA9IHZkYXRhOwogCiAgICAg
LyoKICAgICAgKiBXZSBhcmUgaG9sZGluZyB0aGUgcnVucXVldWUgbG9jayBhbHJlYWR5IChpdCdz
IGJlZW4gdGFrZW4gaW4KQEAgLTQ0NCw0MSArNDQzLDQwIEBAIHN0YXRpYyBzcGlubG9ja190ICpu
dWxsX3N3aXRjaF9zY2hlZChzdHJ1Y3Qgc2NoZWR1bGVyICpuZXdfb3BzLAogc3RhdGljIHZvaWQg
bnVsbF91bml0X2luc2VydChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogewotICAgIHN0cnVj
dCB2Y3B1ICp2ID0gdW5pdC0+dmNwdV9saXN0OwogICAgIHN0cnVjdCBudWxsX3ByaXZhdGUgKnBy
diA9IG51bGxfcHJpdihvcHMpOwogICAgIHN0cnVjdCBudWxsX3VuaXQgKm52YyA9IG51bGxfdW5p
dCh1bml0KTsKICAgICB1bnNpZ25lZCBpbnQgY3B1OwogICAgIHNwaW5sb2NrX3QgKmxvY2s7CiAK
LSAgICBBU1NFUlQoIWlzX2lkbGVfdmNwdSh2KSk7CisgICAgQVNTRVJUKCFpc19pZGxlX3VuaXQo
dW5pdCkpOwogCiAgICAgbG9jayA9IHVuaXRfc2NoZWR1bGVfbG9ja19pcnEodW5pdCk7CiAKLSAg
ICBpZiAoIHVubGlrZWx5KCFpc192Y3B1X29ubGluZSh2KSkgKQorICAgIGlmICggdW5saWtlbHko
IWlzX3VuaXRfb25saW5lKHVuaXQpKSApCiAgICAgewogICAgICAgICB1bml0X3NjaGVkdWxlX3Vu
bG9ja19pcnEobG9jaywgdW5pdCk7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKICByZXRyeToK
LSAgICB1bml0LT5yZXMgPSBwaWNrX3JlcyhwcnYsIHVuaXQpOwotICAgIGNwdSA9IHYtPnByb2Nl
c3NvciA9IHVuaXQtPnJlcy0+bWFzdGVyX2NwdTsKKyAgICBzY2hlZF9zZXRfcmVzKHVuaXQsIHBp
Y2tfcmVzKHBydiwgdW5pdCkpOworICAgIGNwdSA9IHNjaGVkX3VuaXRfY3B1KHVuaXQpOwogCiAg
ICAgc3Bpbl91bmxvY2sobG9jayk7CiAKICAgICBsb2NrID0gdW5pdF9zY2hlZHVsZV9sb2NrKHVu
aXQpOwogCiAgICAgY3B1bWFza19hbmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCB1bml0LT5j
cHVfaGFyZF9hZmZpbml0eSwKLSAgICAgICAgICAgICAgICBjcHVwb29sX2RvbWFpbl9jcHVtYXNr
KHYtPmRvbWFpbikpOworICAgICAgICAgICAgICAgIGNwdXBvb2xfZG9tYWluX2NwdW1hc2sodW5p
dC0+ZG9tYWluKSk7CiAKLSAgICAvKiBJZiB0aGUgcENQVSBpcyBmcmVlLCB3ZSBhc3NpZ24gdiB0
byBpdCAqLwotICAgIGlmICggbGlrZWx5KHBlcl9jcHUobnBjLCBjcHUpLnZjcHUgPT0gTlVMTCkg
KQorICAgIC8qIElmIHRoZSBwQ1BVIGlzIGZyZWUsIHdlIGFzc2lnbiB1bml0IHRvIGl0ICovCisg
ICAgaWYgKCBsaWtlbHkocGVyX2NwdShucGMsIGNwdSkudW5pdCA9PSBOVUxMKSApCiAgICAgewog
ICAgICAgICAvKgogICAgICAgICAgKiBJbnNlcnQgaXMgZm9sbG93ZWQgYnkgdmNwdV93YWtlKCks
IHNvIHRoZXJlJ3Mgbm8gbmVlZCB0byBwb2tlCiAgICAgICAgICAqIHRoZSBwY3B1IHdpdGggdGhl
IFNDSEVEVUxFX1NPRlRJUlEsIGFzIHdha2Ugd2lsbCBkbyB0aGF0LgogICAgICAgICAgKi8KLSAg
ICAgICAgdmNwdV9hc3NpZ24ocHJ2LCB2LCBjcHUpOworICAgICAgICB1bml0X2Fzc2lnbihwcnYs
IHVuaXQsIGNwdSk7CiAgICAgfQogICAgIGVsc2UgaWYgKCBjcHVtYXNrX2ludGVyc2VjdHMoJnBy
di0+Y3B1c19mcmVlLCBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSkpICkKICAgICB7CkBAIC00OTcs
NyArNDk1LDggQEAgc3RhdGljIHZvaWQgbnVsbF91bml0X2luc2VydChjb25zdCBzdHJ1Y3Qgc2No
ZWR1bGVyICpvcHMsCiAgICAgICAgICAqLwogICAgICAgICBzcGluX2xvY2soJnBydi0+d2FpdHFf
bG9jayk7CiAgICAgICAgIGxpc3RfYWRkX3RhaWwoJm52Yy0+d2FpdHFfZWxlbSwgJnBydi0+d2Fp
dHEpOwotICAgICAgICBkcHJpbnRrKFhFTkxPR19HX1dBUk5JTkcsICJXQVJOSU5HOiAlcHYgbm90
IGFzc2lnbmVkIHRvIGFueSBDUFUhXG4iLCB2KTsKKyAgICAgICAgZHByaW50ayhYRU5MT0dfR19X
QVJOSU5HLCAiV0FSTklORzogJXBkdiVkIG5vdCBhc3NpZ25lZCB0byBhbnkgQ1BVIVxuIiwKKyAg
ICAgICAgICAgICAgICB1bml0LT5kb21haW4sIHVuaXQtPnVuaXRfaWQpOwogICAgICAgICBzcGlu
X3VubG9jaygmcHJ2LT53YWl0cV9sb2NrKTsKICAgICB9CiAgICAgc3Bpbl91bmxvY2tfaXJxKGxv
Y2spOwpAQCAtNTA4LDI0ICs1MDcsMjMgQEAgc3RhdGljIHZvaWQgbnVsbF91bml0X2luc2VydChj
b25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiBzdGF0aWMgdm9pZCBudWxsX3VuaXRfcmVtb3Zl
KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiB7Ci0gICAgc3RydWN0IHZjcHUgKnYgPSB1bml0
LT52Y3B1X2xpc3Q7CiAgICAgc3RydWN0IG51bGxfcHJpdmF0ZSAqcHJ2ID0gbnVsbF9wcml2KG9w
cyk7CiAgICAgc3RydWN0IG51bGxfdW5pdCAqbnZjID0gbnVsbF91bml0KHVuaXQpOwogICAgIHNw
aW5sb2NrX3QgKmxvY2s7CiAKLSAgICBBU1NFUlQoIWlzX2lkbGVfdmNwdSh2KSk7CisgICAgQVNT
RVJUKCFpc19pZGxlX3VuaXQodW5pdCkpOwogCiAgICAgbG9jayA9IHVuaXRfc2NoZWR1bGVfbG9j
a19pcnEodW5pdCk7CiAKLSAgICAvKiBJZiBvZmZsaW5lLCB0aGUgdmNwdSBzaG91bGRuJ3QgYmUg
YXNzaWduZWQsIG5vciBpbiB0aGUgd2FpdHF1ZXVlICovCi0gICAgaWYgKCB1bmxpa2VseSghaXNf
dmNwdV9vbmxpbmUodikpICkKKyAgICAvKiBJZiBvZmZsaW5lLCB0aGUgdW5pdCBzaG91bGRuJ3Qg
YmUgYXNzaWduZWQsIG5vciBpbiB0aGUgd2FpdHF1ZXVlICovCisgICAgaWYgKCB1bmxpa2VseSgh
aXNfdW5pdF9vbmxpbmUodW5pdCkpICkKICAgICB7Ci0gICAgICAgIEFTU0VSVChwZXJfY3B1KG5w
Yywgdi0+cHJvY2Vzc29yKS52Y3B1ICE9IHYpOworICAgICAgICBBU1NFUlQocGVyX2NwdShucGMs
IHNjaGVkX3VuaXRfY3B1KHVuaXQpKS51bml0ICE9IHVuaXQpOwogICAgICAgICBBU1NFUlQobGlz
dF9lbXB0eSgmbnZjLT53YWl0cV9lbGVtKSk7CiAgICAgICAgIGdvdG8gb3V0OwogICAgIH0KIAot
ICAgIC8qIElmIHYgaXMgaW4gd2FpdHF1ZXVlLCBqdXN0IGdldCBpdCBvdXQgb2YgdGhlcmUgYW5k
IGJhaWwgKi8KKyAgICAvKiBJZiB1bml0IGlzIGluIHdhaXRxdWV1ZSwganVzdCBnZXQgaXQgb3V0
IG9mIHRoZXJlIGFuZCBiYWlsICovCiAgICAgaWYgKCB1bmxpa2VseSghbGlzdF9lbXB0eSgmbnZj
LT53YWl0cV9lbGVtKSkgKQogICAgIHsKICAgICAgICAgc3Bpbl9sb2NrKCZwcnYtPndhaXRxX2xv
Y2spOwpAQCAtNTM1LDcgKzUzMyw3IEBAIHN0YXRpYyB2b2lkIG51bGxfdW5pdF9yZW1vdmUoY29u
c3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAgICAgICBnb3RvIG91dDsKICAgICB9CiAKLSAg
ICB2Y3B1X2RlYXNzaWduKHBydiwgdik7CisgICAgdW5pdF9kZWFzc2lnbihwcnYsIHVuaXQpOwog
CiAgb3V0OgogICAgIHVuaXRfc2NoZWR1bGVfdW5sb2NrX2lycShsb2NrLCB1bml0KTsKQEAgLTU0
NiwxNCArNTQ0LDEzIEBAIHN0YXRpYyB2b2lkIG51bGxfdW5pdF9yZW1vdmUoY29uc3Qgc3RydWN0
IHNjaGVkdWxlciAqb3BzLAogc3RhdGljIHZvaWQgbnVsbF91bml0X3dha2UoY29uc3Qgc3RydWN0
IHNjaGVkdWxlciAqb3BzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHNjaGVk
X3VuaXQgKnVuaXQpCiB7Ci0gICAgc3RydWN0IHZjcHUgKnYgPSB1bml0LT52Y3B1X2xpc3Q7CiAg
ICAgc3RydWN0IG51bGxfcHJpdmF0ZSAqcHJ2ID0gbnVsbF9wcml2KG9wcyk7CiAgICAgc3RydWN0
IG51bGxfdW5pdCAqbnZjID0gbnVsbF91bml0KHVuaXQpOwotICAgIHVuc2lnbmVkIGludCBjcHUg
PSB2LT5wcm9jZXNzb3I7CisgICAgdW5zaWduZWQgaW50IGNwdSA9IHNjaGVkX3VuaXRfY3B1KHVu
aXQpOwogCi0gICAgQVNTRVJUKCFpc19pZGxlX3ZjcHUodikpOworICAgIEFTU0VSVCghaXNfaWRs
ZV91bml0KHVuaXQpKTsKIAotICAgIGlmICggdW5saWtlbHkoY3Vycl9vbl9jcHUoY3B1KSA9PSB1
bml0KSApCisgICAgaWYgKCB1bmxpa2VseShjdXJyX29uX2NwdShzY2hlZF91bml0X2NwdSh1bml0
KSkgPT0gdW5pdCkgKQogICAgIHsKICAgICAgICAgU0NIRURfU1RBVF9DUkFOSyh1bml0X3dha2Vf
cnVubmluZyk7CiAgICAgICAgIHJldHVybjsKQEAgLTU2NiwzMyArNTYzLDMzIEBAIHN0YXRpYyB2
b2lkIG51bGxfdW5pdF93YWtlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKICAgICAgICAg
cmV0dXJuOwogICAgIH0KIAotICAgIGlmICggbGlrZWx5KHZjcHVfcnVubmFibGUodikpICkKKyAg
ICBpZiAoIGxpa2VseSh1bml0X3J1bm5hYmxlKHVuaXQpKSApCiAgICAgICAgIFNDSEVEX1NUQVRf
Q1JBTksodW5pdF93YWtlX3J1bm5hYmxlKTsKICAgICBlbHNlCiAgICAgICAgIFNDSEVEX1NUQVRf
Q1JBTksodW5pdF93YWtlX25vdF9ydW5uYWJsZSk7CiAKICAgICAvKgotICAgICAqIElmIGEgdmNw
dSBpcyBuZWl0aGVyIG9uIGEgcENQVSBub3IgaW4gdGhlIHdhaXRxdWV1ZSwgaXQgbWVhbnMgaXQg
d2FzCisgICAgICogSWYgYSB1bml0IGlzIG5laXRoZXIgb24gYSBwQ1BVIG5vciBpbiB0aGUgd2Fp
dHF1ZXVlLCBpdCBtZWFucyBpdCB3YXMKICAgICAgKiBvZmZsaW5lLCBhbmQgdGhhdCBpdCBpcyBu
b3cgY29taW5nIGJhY2sgYmVpbmcgb25saW5lLgogICAgICAqLwotICAgIGlmICggdW5saWtlbHko
cGVyX2NwdShucGMsIGNwdSkudmNwdSAhPSB2ICYmIGxpc3RfZW1wdHkoJm52Yy0+d2FpdHFfZWxl
bSkpICkKKyAgICBpZiAoIHVubGlrZWx5KHBlcl9jcHUobnBjLCBjcHUpLnVuaXQgIT0gdW5pdCAm
JiBsaXN0X2VtcHR5KCZudmMtPndhaXRxX2VsZW0pKSApCiAgICAgewogICAgICAgICBzcGluX2xv
Y2soJnBydi0+d2FpdHFfbG9jayk7CiAgICAgICAgIGxpc3RfYWRkX3RhaWwoJm52Yy0+d2FpdHFf
ZWxlbSwgJnBydi0+d2FpdHEpOwogICAgICAgICBzcGluX3VubG9jaygmcHJ2LT53YWl0cV9sb2Nr
KTsKIAogICAgICAgICBjcHVtYXNrX2FuZChjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksIHVuaXQt
PmNwdV9oYXJkX2FmZmluaXR5LAotICAgICAgICAgICAgICAgICAgICBjcHVwb29sX2RvbWFpbl9j
cHVtYXNrKHYtPmRvbWFpbikpOworICAgICAgICAgICAgICAgICAgICBjcHVwb29sX2RvbWFpbl9j
cHVtYXNrKHVuaXQtPmRvbWFpbikpOwogCiAgICAgICAgIGlmICggIWNwdW1hc2tfaW50ZXJzZWN0
cygmcHJ2LT5jcHVzX2ZyZWUsIGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSkgKQogICAgICAgICB7
CiAgICAgICAgICAgICBkcHJpbnRrKFhFTkxPR19HX1dBUk5JTkcsICJXQVJOSU5HOiBkJWR2JWQg
bm90IGFzc2lnbmVkIHRvIGFueSBDUFUhXG4iLAotICAgICAgICAgICAgICAgICAgICB2LT5kb21h
aW4tPmRvbWFpbl9pZCwgdi0+dmNwdV9pZCk7CisgICAgICAgICAgICAgICAgICAgIHVuaXQtPmRv
bWFpbi0+ZG9tYWluX2lkLCB1bml0LT51bml0X2lkKTsKICAgICAgICAgICAgIHJldHVybjsKICAg
ICAgICAgfQogCiAgICAgICAgIC8qCi0gICAgICAgICAqIE5vdyB3ZSB3b3VsZCB3YW50IHRvIGFz
c2lnbiB0aGUgdmNwdSB0byBjcHUsIGJ1dCB3ZSBjYW4ndCwgYmVjYXVzZQorICAgICAgICAgKiBO
b3cgd2Ugd291bGQgd2FudCB0byBhc3NpZ24gdGhlIHVuaXQgdG8gY3B1LCBidXQgd2UgY2FuJ3Qs
IGJlY2F1c2UKICAgICAgICAgICogd2UgZG9uJ3QgaGF2ZSB0aGUgbG9jay4gU28sIGxldCdzIGRv
IHRoZSBmb2xsb3dpbmc6CiAgICAgICAgICAqIC0gdHJ5IHRvIHJlbW92ZSBjcHUgZnJvbSB0aGUg
bGlzdCBvZiBmcmVlIGNwdXMsIHRvIGF2b2lkIHJhY2VzIHdpdGgKICAgICAgICAgICogICBvdGhl
ciBvbmxpbmluZywgaW5zZXJ0aW5nIG9yIG1pZ3JhdGluZyBvcGVyYXRpb25zOwpAQCAtNjEzLDI1
ICs2MTAsMjQgQEAgc3RhdGljIHZvaWQgbnVsbF91bml0X3dha2UoY29uc3Qgc3RydWN0IHNjaGVk
dWxlciAqb3BzLAogICAgICAgICB9CiAgICAgfQogCi0gICAgLyogTm90ZSB0aGF0IHdlIGdldCBo
ZXJlIG9ubHkgZm9yIHZDUFVzIGFzc2lnbmVkIHRvIGEgcENQVSAqLwotICAgIGNwdV9yYWlzZV9z
b2Z0aXJxKHYtPnByb2Nlc3NvciwgU0NIRURVTEVfU09GVElSUSk7CisgICAgLyogTm90ZSB0aGF0
IHdlIGdldCBoZXJlIG9ubHkgZm9yIHVuaXRzIGFzc2lnbmVkIHRvIGEgcENQVSAqLworICAgIGNw
dV9yYWlzZV9zb2Z0aXJxKHNjaGVkX3VuaXRfY3B1KHVuaXQpLCBTQ0hFRFVMRV9TT0ZUSVJRKTsK
IH0KIAogc3RhdGljIHZvaWQgbnVsbF91bml0X3NsZWVwKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIg
Km9wcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5p
dCkKIHsKLSAgICBzdHJ1Y3QgdmNwdSAqdiA9IHVuaXQtPnZjcHVfbGlzdDsKICAgICBzdHJ1Y3Qg
bnVsbF9wcml2YXRlICpwcnYgPSBudWxsX3ByaXYob3BzKTsKLSAgICB1bnNpZ25lZCBpbnQgY3B1
ID0gdi0+cHJvY2Vzc29yOworICAgIHVuc2lnbmVkIGludCBjcHUgPSBzY2hlZF91bml0X2NwdSh1
bml0KTsKICAgICBib29sIHRpY2tsZWQgPSBmYWxzZTsKIAotICAgIEFTU0VSVCghaXNfaWRsZV92
Y3B1KHYpKTsKKyAgICBBU1NFUlQoIWlzX2lkbGVfdW5pdCh1bml0KSk7CiAKLSAgICAvKiAKLSAg
ICAgKiBDaGVjayBpZiB0aGUgdmNwdSBpcyBpbiB0aGUgcHJvY2VzcyBvZiBiZWluZyBvZmZsaW5l
ZC4gaWYgeWVzLAorICAgIC8qCisgICAgICogQ2hlY2sgaWYgdGhlIHVuaXQgaXMgaW4gdGhlIHBy
b2Nlc3Mgb2YgYmVpbmcgb2ZmbGluZWQuIElmIHllcywKICAgICAgKiB3ZSBuZWVkIHRvIHJlbW92
ZSBpdCBmcm9tIGVpdGhlciBpdHMgcENQVSBvciB0aGUgd2FpdHF1ZXVlLgogICAgICAqLwotICAg
IGlmICggdW5saWtlbHkoIWlzX3ZjcHVfb25saW5lKHYpKSApCisgICAgaWYgKCB1bmxpa2VseSgh
aXNfdW5pdF9vbmxpbmUodW5pdCkpICkKICAgICB7CiAgICAgICAgIHN0cnVjdCBudWxsX3VuaXQg
Km52YyA9IG51bGxfdW5pdCh1bml0KTsKIApAQCAtNjQxLDExICs2MzcsMTEgQEAgc3RhdGljIHZv
aWQgbnVsbF91bml0X3NsZWVwKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKICAgICAgICAg
ICAgIGxpc3RfZGVsX2luaXQoJm52Yy0+d2FpdHFfZWxlbSk7CiAgICAgICAgICAgICBzcGluX3Vu
bG9jaygmcHJ2LT53YWl0cV9sb2NrKTsKICAgICAgICAgfQotICAgICAgICBlbHNlIGlmICggcGVy
X2NwdShucGMsIGNwdSkudmNwdSA9PSB2ICkKLSAgICAgICAgICAgIHRpY2tsZWQgPSB2Y3B1X2Rl
YXNzaWduKHBydiwgdik7CisgICAgICAgIGVsc2UgaWYgKCBwZXJfY3B1KG5wYywgY3B1KS51bml0
ID09IHVuaXQgKQorICAgICAgICAgICAgdGlja2xlZCA9IHVuaXRfZGVhc3NpZ24ocHJ2LCB1bml0
KTsKICAgICB9CiAKLSAgICAvKiBJZiB2IGlzIG5vdCBhc3NpZ25lZCB0byBhIHBDUFUsIG9yIGlz
IG5vdCBydW5uaW5nLCBubyBuZWVkIHRvIGJvdGhlciAqLworICAgIC8qIElmIHVuaXQgaXMgbm90
IGFzc2lnbmVkIHRvIGEgcENQVSwgb3IgaXMgbm90IHJ1bm5pbmcsIG5vIG5lZWQgdG8gYm90aGVy
ICovCiAgICAgaWYgKCBsaWtlbHkoIXRpY2tsZWQgJiYgY3Vycl9vbl9jcHUoY3B1KSA9PSB1bml0
KSApCiAgICAgICAgIGNwdV9yYWlzZV9zb2Z0aXJxKGNwdSwgU0NIRURVTEVfU09GVElSUSk7CiAK
QEAgLTY1NSw0MiArNjUxLDQxIEBAIHN0YXRpYyB2b2lkIG51bGxfdW5pdF9zbGVlcChjb25zdCBz
dHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiBzdGF0aWMgc3RydWN0IHNjaGVkX3Jlc291cmNlICoKIG51
bGxfcmVzX3BpY2soY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBjb25zdCBzdHJ1Y3Qgc2No
ZWRfdW5pdCAqdW5pdCkKIHsKLSAgICBBU1NFUlQoIWlzX2lkbGVfdmNwdSh1bml0LT52Y3B1X2xp
c3QpKTsKKyAgICBBU1NFUlQoIWlzX2lkbGVfdW5pdCh1bml0KSk7CiAgICAgcmV0dXJuIHBpY2tf
cmVzKG51bGxfcHJpdihvcHMpLCB1bml0KTsKIH0KIAogc3RhdGljIHZvaWQgbnVsbF91bml0X21p
Z3JhdGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQsIHVuc2lnbmVkIGludCBuZXdfY3B1KQog
ewotICAgIHN0cnVjdCB2Y3B1ICp2ID0gdW5pdC0+dmNwdV9saXN0OwogICAgIHN0cnVjdCBudWxs
X3ByaXZhdGUgKnBydiA9IG51bGxfcHJpdihvcHMpOwogICAgIHN0cnVjdCBudWxsX3VuaXQgKm52
YyA9IG51bGxfdW5pdCh1bml0KTsKIAotICAgIEFTU0VSVCghaXNfaWRsZV92Y3B1KHYpKTsKKyAg
ICBBU1NFUlQoIWlzX2lkbGVfdW5pdCh1bml0KSk7CiAKLSAgICBpZiAoIHYtPnByb2Nlc3NvciA9
PSBuZXdfY3B1ICkKKyAgICBpZiAoIHNjaGVkX3VuaXRfY3B1KHVuaXQpID09IG5ld19jcHUgKQog
ICAgICAgICByZXR1cm47CiAKICAgICBpZiAoIHVubGlrZWx5KHRiX2luaXRfZG9uZSkgKQogICAg
IHsKICAgICAgICAgc3RydWN0IHsKLSAgICAgICAgICAgIHVpbnQxNl90IHZjcHUsIGRvbTsKKyAg
ICAgICAgICAgIHVpbnQxNl90IHVuaXQsIGRvbTsKICAgICAgICAgICAgIHVpbnQxNl90IGNwdSwg
bmV3X2NwdTsKICAgICAgICAgfSBkOwotICAgICAgICBkLmRvbSA9IHYtPmRvbWFpbi0+ZG9tYWlu
X2lkOwotICAgICAgICBkLnZjcHUgPSB2LT52Y3B1X2lkOwotICAgICAgICBkLmNwdSA9IHYtPnBy
b2Nlc3NvcjsKKyAgICAgICAgZC5kb20gPSB1bml0LT5kb21haW4tPmRvbWFpbl9pZDsKKyAgICAg
ICAgZC51bml0ID0gdW5pdC0+dW5pdF9pZDsKKyAgICAgICAgZC5jcHUgPSBzY2hlZF91bml0X2Nw
dSh1bml0KTsKICAgICAgICAgZC5uZXdfY3B1ID0gbmV3X2NwdTsKICAgICAgICAgX190cmFjZV92
YXIoVFJDX1NOVUxMX01JR1JBVEUsIDEsIHNpemVvZihkKSwgJmQpOwogICAgIH0KIAogICAgIC8q
Ci0gICAgICogSWYgdiBpcyBhc3NpZ25lZCB0byBhIHBDUFUsIHRoZW4gc3VjaCBwQ1BVIGJlY29t
ZXMgZnJlZSwgYW5kIHdlCisgICAgICogSWYgdW5pdCBpcyBhc3NpZ25lZCB0byBhIHBDUFUsIHRo
ZW4gc3VjaCBwQ1BVIGJlY29tZXMgZnJlZSwgYW5kIHdlCiAgICAgICogc2hvdWxkIGxvb2sgaW4g
dGhlIHdhaXRxdWV1ZSBpZiBhbnlvbmUgZWxzZSBjYW4gYmUgYXNzaWduZWQgdG8gaXQuCiAgICAg
ICovCi0gICAgaWYgKCBsaWtlbHkocGVyX2NwdShucGMsIHYtPnByb2Nlc3NvcikudmNwdSA9PSB2
KSApCisgICAgaWYgKCBsaWtlbHkocGVyX2NwdShucGMsIHNjaGVkX3VuaXRfY3B1KHVuaXQpKS51
bml0ID09IHVuaXQpICkKICAgICB7Ci0gICAgICAgIHZjcHVfZGVhc3NpZ24ocHJ2LCB2KTsKKyAg
ICAgICAgdW5pdF9kZWFzc2lnbihwcnYsIHVuaXQpOwogICAgICAgICBTQ0hFRF9TVEFUX0NSQU5L
KG1pZ3JhdGVfcnVubmluZyk7CiAgICAgfQogICAgIGVsc2UgaWYgKCAhbGlzdF9lbXB0eSgmbnZj
LT53YWl0cV9lbGVtKSApCkBAIC02OTksMTMgKzY5NCwxMyBAQCBzdGF0aWMgdm9pZCBudWxsX3Vu
aXRfbWlncmF0ZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAgICAgU0NIRURfU1RBVF9D
UkFOSyhtaWdyYXRlZCk7CiAKICAgICAvKgotICAgICAqIElmIGEgdmNwdSBpcyAoZ29pbmcpIG9m
ZmxpbmUsIHdlIHdhbnQgaXQgdG8gYmUgbmVpdGhlciBhc3NpZ25lZAorICAgICAqIElmIGEgdW5p
dCBpcyAoZ29pbmcpIG9mZmxpbmUsIHdlIHdhbnQgaXQgdG8gYmUgbmVpdGhlciBhc3NpZ25lZAog
ICAgICAqIHRvIGEgcENQVSwgbm9yIGluIHRoZSB3YWl0cXVldWUuCiAgICAgICoKICAgICAgKiBJ
ZiBpdCB3YXMgb24gYSBjcHUsIHdlJ3ZlIHJlbW92ZWQgaXQgZnJvbSB0aGVyZSBhYm92ZS4gSWYg
aXQgaXMKICAgICAgKiBpbiB0aGUgd2FpdHF1ZXVlLCB3ZSByZW1vdmUgaXQgZnJvbSB0aGVyZSBu
b3cuIEFuZCB0aGVuIHdlIGJhaWwuCiAgICAgICovCi0gICAgaWYgKCB1bmxpa2VseSghaXNfdmNw
dV9vbmxpbmUodikpICkKKyAgICBpZiAoIHVubGlrZWx5KCFpc191bml0X29ubGluZSh1bml0KSkg
KQogICAgIHsKICAgICAgICAgc3Bpbl9sb2NrKCZwcnYtPndhaXRxX2xvY2spOwogICAgICAgICBs
aXN0X2RlbF9pbml0KCZudmMtPndhaXRxX2VsZW0pOwpAQCAtNzE0LDMyICs3MDksMzQgQEAgc3Rh
dGljIHZvaWQgbnVsbF91bml0X21pZ3JhdGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAog
ICAgIH0KIAogICAgIC8qCi0gICAgICogTGV0J3Mgbm93IGNvbnNpZGVyIG5ld19jcHUsIHdoaWNo
IGlzIHdoZXJlIHYgaXMgYmVpbmcgc2VudC4gSXQgY2FuIGJlCi0gICAgICogZWl0aGVyIGZyZWUs
IG9yIGhhdmUgYSB2Q1BVIGFscmVhZHkgYXNzaWduZWQgdG8gaXQuCisgICAgICogTGV0J3Mgbm93
IGNvbnNpZGVyIG5ld19jcHUsIHdoaWNoIGlzIHdoZXJlIHVuaXQgaXMgYmVpbmcgc2VudC4gSXQg
Y2FuIGJlCisgICAgICogZWl0aGVyIGZyZWUsIG9yIGhhdmUgYSB1bml0IGFscmVhZHkgYXNzaWdu
ZWQgdG8gaXQuCiAgICAgICoKLSAgICAgKiBJbiB0aGUgZm9ybWVyIGNhc2UsIHdlIHNob3VsZCBh
c3NpZ24gdiB0byBpdCwgYW5kIHRyeSB0byBnZXQgaXQgdG8gcnVuLAorICAgICAqIEluIHRoZSBm
b3JtZXIgY2FzZSB3ZSBzaG91bGQgYXNzaWduIHVuaXQgdG8gaXQsIGFuZCB0cnkgdG8gZ2V0IGl0
IHRvIHJ1biwKICAgICAgKiBpZiBwb3NzaWJsZSwgYWNjb3JkaW5nIHRvIGFmZmluaXR5LgogICAg
ICAqCi0gICAgICogSW4gbGF0dGVyLCBhbGwgd2UgY2FuIGRvIGlzIHRvIHBhcmsgdiBpbiB0aGUg
d2FpdHF1ZXVlLgorICAgICAqIEluIGxhdHRlciwgYWxsIHdlIGNhbiBkbyBpcyB0byBwYXJrIHVu
aXQgaW4gdGhlIHdhaXRxdWV1ZS4KICAgICAgKi8KLSAgICBpZiAoIHBlcl9jcHUobnBjLCBuZXdf
Y3B1KS52Y3B1ID09IE5VTEwgJiYKLSAgICAgICAgIHZjcHVfY2hlY2tfYWZmaW5pdHkodiwgbmV3
X2NwdSwgQkFMQU5DRV9IQVJEX0FGRklOSVRZKSApCisgICAgaWYgKCBwZXJfY3B1KG5wYywgbmV3
X2NwdSkudW5pdCA9PSBOVUxMICYmCisgICAgICAgICB1bml0X2NoZWNrX2FmZmluaXR5KHVuaXQs
IG5ld19jcHUsIEJBTEFOQ0VfSEFSRF9BRkZJTklUWSkgKQogICAgIHsKLSAgICAgICAgLyogdiBt
aWdodCBoYXZlIGJlZW4gaW4gdGhlIHdhaXRxdWV1ZSwgc28gcmVtb3ZlIGl0ICovCisgICAgICAg
IC8qIHVuaXQgbWlnaHQgaGF2ZSBiZWVuIGluIHRoZSB3YWl0cXVldWUsIHNvIHJlbW92ZSBpdCAq
LwogICAgICAgICBzcGluX2xvY2soJnBydi0+d2FpdHFfbG9jayk7CiAgICAgICAgIGxpc3RfZGVs
X2luaXQoJm52Yy0+d2FpdHFfZWxlbSk7CiAgICAgICAgIHNwaW5fdW5sb2NrKCZwcnYtPndhaXRx
X2xvY2spOwogCi0gICAgICAgIHZjcHVfYXNzaWduKHBydiwgdiwgbmV3X2NwdSk7CisgICAgICAg
IHVuaXRfYXNzaWduKHBydiwgdW5pdCwgbmV3X2NwdSk7CiAgICAgfQogICAgIGVsc2UKICAgICB7
Ci0gICAgICAgIC8qIFB1dCB2IGluIHRoZSB3YWl0cXVldWUsIGlmIGl0IHdhc24ndCB0aGVyZSBh
bHJlYWR5ICovCisgICAgICAgIC8qIFB1dCB1bml0IGluIHRoZSB3YWl0cXVldWUsIGlmIGl0IHdh
c24ndCB0aGVyZSBhbHJlYWR5ICovCiAgICAgICAgIHNwaW5fbG9jaygmcHJ2LT53YWl0cV9sb2Nr
KTsKICAgICAgICAgaWYgKCBsaXN0X2VtcHR5KCZudmMtPndhaXRxX2VsZW0pICkKICAgICAgICAg
ewogICAgICAgICAgICAgbGlzdF9hZGRfdGFpbCgmbnZjLT53YWl0cV9lbGVtLCAmcHJ2LT53YWl0
cSk7Ci0gICAgICAgICAgICBkcHJpbnRrKFhFTkxPR19HX1dBUk5JTkcsICJXQVJOSU5HOiAlcHYg
bm90IGFzc2lnbmVkIHRvIGFueSBDUFUhXG4iLCB2KTsKKyAgICAgICAgICAgIGRwcmludGsoWEVO
TE9HX0dfV0FSTklORywKKyAgICAgICAgICAgICAgICAgICAgIldBUk5JTkc6ICVwZHYlZCBub3Qg
YXNzaWduZWQgdG8gYW55IENQVSFcbiIsIHVuaXQtPmRvbWFpbiwKKyAgICAgICAgICAgICAgICAg
ICAgdW5pdC0+dW5pdF9pZCk7CiAgICAgICAgIH0KICAgICAgICAgc3Bpbl91bmxvY2soJnBydi0+
d2FpdHFfbG9jayk7CiAgICAgfQpAQCAtNzUzLDM1ICs3NTAsMzQgQEAgc3RhdGljIHZvaWQgbnVs
bF91bml0X21pZ3JhdGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAgICAqIGJ5IHRo
aXMsIHdpbGwgYmUgZml4ZWQtdXAgZHVyaW5nIHJlc3VtZS4KICAgICAgKi8KICBvdXQ6Ci0gICAg
di0+cHJvY2Vzc29yID0gbmV3X2NwdTsKLSAgICB1bml0LT5yZXMgPSBnZXRfc2NoZWRfcmVzKG5l
d19jcHUpOworICAgIHNjaGVkX3NldF9yZXModW5pdCwgZ2V0X3NjaGVkX3JlcyhuZXdfY3B1KSk7
CiB9CiAKICNpZm5kZWYgTkRFQlVHCi1zdGF0aWMgaW5saW5lIHZvaWQgbnVsbF92Y3B1X2NoZWNr
KHN0cnVjdCB2Y3B1ICp2KQorc3RhdGljIGlubGluZSB2b2lkIG51bGxfdW5pdF9jaGVjayhzdHJ1
Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIHsKLSAgICBzdHJ1Y3QgbnVsbF91bml0ICogY29uc3QgbnZj
ID0gbnVsbF91bml0KHYtPnNjaGVkX3VuaXQpOwotICAgIHN0cnVjdCBudWxsX2RvbSAqIGNvbnN0
IG5kb20gPSB2LT5kb21haW4tPnNjaGVkX3ByaXY7CisgICAgc3RydWN0IG51bGxfdW5pdCAqIGNv
bnN0IG52YyA9IG51bGxfdW5pdCh1bml0KTsKKyAgICBzdHJ1Y3QgbnVsbF9kb20gKiBjb25zdCBu
ZG9tID0gdW5pdC0+ZG9tYWluLT5zY2hlZF9wcml2OwogCi0gICAgQlVHX09OKG52Yy0+dmNwdSAh
PSB2KTsKKyAgICBCVUdfT04obnZjLT51bml0ICE9IHVuaXQpOwogCiAgICAgaWYgKCBuZG9tICkK
LSAgICAgICAgQlVHX09OKGlzX2lkbGVfdmNwdSh2KSk7CisgICAgICAgIEJVR19PTihpc19pZGxl
X3VuaXQodW5pdCkpOwogICAgIGVsc2UKLSAgICAgICAgQlVHX09OKCFpc19pZGxlX3ZjcHUodikp
OworICAgICAgICBCVUdfT04oIWlzX2lkbGVfdW5pdCh1bml0KSk7CiAKICAgICBTQ0hFRF9TVEFU
X0NSQU5LKHVuaXRfY2hlY2spOwogfQotI2RlZmluZSBOVUxMX1ZDUFVfQ0hFQ0sodikgIChudWxs
X3ZjcHVfY2hlY2sodikpCisjZGVmaW5lIE5VTExfVU5JVF9DSEVDSyh1bml0KSAgKG51bGxfdW5p
dF9jaGVjayh1bml0KSkKICNlbHNlCi0jZGVmaW5lIE5VTExfVkNQVV9DSEVDSyh2KQorI2RlZmlu
ZSBOVUxMX1VOSVRfQ0hFQ0sodW5pdCkKICNlbmRpZgogCiAKIC8qCiAgKiBUaGUgbW9zdCBzaW1w
bGUgc2NoZWR1bGluZyBmdW5jdGlvbiBvZiBhbGwgdGltZXMhIFdlIGVpdGhlciByZXR1cm46Ci0g
KiAgLSB0aGUgdkNQVSBhc3NpZ25lZCB0byB0aGUgcENQVSwgaWYgdGhlcmUncyBvbmUgYW5kIGl0
IGNhbiBydW47Ci0gKiAgLSB0aGUgaWRsZSB2Q1BVLCBvdGhlcndpc2UuCisgKiAgLSB0aGUgdW5p
dCBhc3NpZ25lZCB0byB0aGUgcENQVSwgaWYgdGhlcmUncyBvbmUgYW5kIGl0IGNhbiBydW47Cisg
KiAgLSB0aGUgaWRsZSB1bml0LCBvdGhlcndpc2UuCiAgKi8KIHN0YXRpYyBzdHJ1Y3QgdGFza19z
bGljZSBudWxsX3NjaGVkdWxlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNfdGltZV90IG5vdywKQEAgLTc5NCwyNCAr
NzkwLDI0IEBAIHN0YXRpYyBzdHJ1Y3QgdGFza19zbGljZSBudWxsX3NjaGVkdWxlKGNvbnN0IHN0
cnVjdCBzY2hlZHVsZXIgKm9wcywKICAgICBzdHJ1Y3QgdGFza19zbGljZSByZXQ7CiAKICAgICBT
Q0hFRF9TVEFUX0NSQU5LKHNjaGVkdWxlKTsKLSAgICBOVUxMX1ZDUFVfQ0hFQ0soY3VycmVudCk7
CisgICAgTlVMTF9VTklUX0NIRUNLKGN1cnJlbnQtPnNjaGVkX3VuaXQpOwogCiAgICAgaWYgKCB1
bmxpa2VseSh0Yl9pbml0X2RvbmUpICkKICAgICB7CiAgICAgICAgIHN0cnVjdCB7CiAgICAgICAg
ICAgICB1aW50MTZfdCB0YXNrbGV0LCBjcHU7Ci0gICAgICAgICAgICBpbnQxNl90IHZjcHUsIGRv
bTsKKyAgICAgICAgICAgIGludDE2X3QgdW5pdCwgZG9tOwogICAgICAgICB9IGQ7CiAgICAgICAg
IGQuY3B1ID0gY3B1OwogICAgICAgICBkLnRhc2tsZXQgPSB0YXNrbGV0X3dvcmtfc2NoZWR1bGVk
OwotICAgICAgICBpZiAoIHBlcl9jcHUobnBjLCBjcHUpLnZjcHUgPT0gTlVMTCApCisgICAgICAg
IGlmICggcGVyX2NwdShucGMsIGNwdSkudW5pdCA9PSBOVUxMICkKICAgICAgICAgewotICAgICAg
ICAgICAgZC52Y3B1ID0gZC5kb20gPSAtMTsKKyAgICAgICAgICAgIGQudW5pdCA9IGQuZG9tID0g
LTE7CiAgICAgICAgIH0KICAgICAgICAgZWxzZQogICAgICAgICB7Ci0gICAgICAgICAgICBkLnZj
cHUgPSBwZXJfY3B1KG5wYywgY3B1KS52Y3B1LT52Y3B1X2lkOwotICAgICAgICAgICAgZC5kb20g
PSBwZXJfY3B1KG5wYywgY3B1KS52Y3B1LT5kb21haW4tPmRvbWFpbl9pZDsKKyAgICAgICAgICAg
IGQudW5pdCA9IHBlcl9jcHUobnBjLCBjcHUpLnVuaXQtPnVuaXRfaWQ7CisgICAgICAgICAgICBk
LmRvbSA9IHBlcl9jcHUobnBjLCBjcHUpLnVuaXQtPmRvbWFpbi0+ZG9tYWluX2lkOwogICAgICAg
ICB9CiAgICAgICAgIF9fdHJhY2VfdmFyKFRSQ19TTlVMTF9TQ0hFRFVMRSwgMSwgc2l6ZW9mKGQp
LCAmZCk7CiAgICAgfQpAQCAtODE5LDE2ICs4MTUsMTYgQEAgc3RhdGljIHN0cnVjdCB0YXNrX3Ns
aWNlIG51bGxfc2NoZWR1bGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAgIGlmICgg
dGFza2xldF93b3JrX3NjaGVkdWxlZCApCiAgICAgewogICAgICAgICB0cmFjZV92YXIoVFJDX1NO
VUxMX1RBU0tMRVQsIDEsIDAsIE5VTEwpOwotICAgICAgICByZXQudGFzayA9IGlkbGVfdmNwdVtj
cHVdLT5zY2hlZF91bml0OworICAgICAgICByZXQudGFzayA9IHNjaGVkX2lkbGVfdW5pdChjcHUp
OwogICAgIH0KICAgICBlbHNlCi0gICAgICAgIHJldC50YXNrID0gcGVyX2NwdShucGMsIGNwdSku
dmNwdS0+c2NoZWRfdW5pdDsKKyAgICAgICAgcmV0LnRhc2sgPSBwZXJfY3B1KG5wYywgY3B1KS51
bml0OwogICAgIHJldC5taWdyYXRlZCA9IDA7CiAgICAgcmV0LnRpbWUgPSAtMTsKIAogICAgIC8q
CiAgICAgICogV2UgbWF5IGJlIG5ldyBpbiB0aGUgY3B1cG9vbCwgb3IganVzdCBjb21pbmcgYmFj
ayBvbmxpbmUuIEluIHdoaWNoCi0gICAgICogY2FzZSwgdGhlcmUgbWF5IGJlIHZDUFVzIGluIHRo
ZSB3YWl0cXVldWUgdGhhdCB3ZSBjYW4gYXNzaWduIHRvIHVzCisgICAgICogY2FzZSwgdGhlcmUg
bWF5IGJlIHVuaXRzIGluIHRoZSB3YWl0cXVldWUgdGhhdCB3ZSBjYW4gYXNzaWduIHRvIHVzCiAg
ICAgICogYW5kIHJ1bi4KICAgICAgKi8KICAgICBpZiAoIHVubGlrZWx5KHJldC50YXNrID09IE5V
TEwpICkKQEAgLTgzOSwxMCArODM1LDEwIEBAIHN0YXRpYyBzdHJ1Y3QgdGFza19zbGljZSBudWxs
X3NjaGVkdWxlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKICAgICAgICAgICAgIGdvdG8g
dW5sb2NrOwogCiAgICAgICAgIC8qCi0gICAgICAgICAqIFdlIHNjYW4gdGhlIHdhaXRxdWV1ZSB0
d2ljZSwgZm9yIHByaW9yaXRpemluZyB2Y3B1cyB0aGF0IGhhdmUKKyAgICAgICAgICogV2Ugc2Nh
biB0aGUgd2FpdHF1ZXVlIHR3aWNlLCBmb3IgcHJpb3JpdGl6aW5nIHVuaXRzIHRoYXQgaGF2ZQog
ICAgICAgICAgKiBzb2Z0LWFmZmluaXR5IHdpdGggY3B1LiBUaGlzIG1heSBsb29rIGxpa2Ugc29t
ZXRoaW5nIGV4cGVuc2l2ZSB0bwotICAgICAgICAgKiBkbyBoZXJlIGluIG51bGxfc2NoZWR1bGUo
KSwgYnV0IGl0J3MgYWN0dWFsbHkgZmluZSwgYmVjZXVzZSB3ZSBkbwotICAgICAgICAgKiBpdCBv
bmx5IGluIGNhc2VzIHdoZXJlIGEgcGNwdSBoYXMgbm8gdmNwdSBhc3NvY2lhdGVkIChlLmcuLCBh
cworICAgICAgICAgKiBkbyBoZXJlIGluIG51bGxfc2NoZWR1bGUoKSwgYnV0IGl0J3MgYWN0dWFs
bHkgZmluZSwgYmVjYXVzZSB3ZSBkbworICAgICAgICAgKiBpdCBvbmx5IGluIGNhc2VzIHdoZXJl
IGEgcGNwdSBoYXMgbm8gdW5pdCBhc3NvY2lhdGVkIChlLmcuLCBhcwogICAgICAgICAgKiBzYWlk
IGFib3ZlLCB0aGUgY3B1IGhhcyBqdXN0IGpvaW5lZCBhIGNwdXBvb2wpLgogICAgICAgICAgKi8K
ICAgICAgICAgZm9yX2VhY2hfYWZmaW5pdHlfYmFsYW5jZV9zdGVwKCBicyApCkBAIC04NTAsMTQg
Kzg0NiwxNCBAQCBzdGF0aWMgc3RydWN0IHRhc2tfc2xpY2UgbnVsbF9zY2hlZHVsZShjb25zdCBz
dHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAgICAgICAgICAgICBsaXN0X2Zvcl9lYWNoX2VudHJ5KCB3
dmMsICZwcnYtPndhaXRxLCB3YWl0cV9lbGVtICkKICAgICAgICAgICAgIHsKICAgICAgICAgICAg
ICAgICBpZiAoIGJzID09IEJBTEFOQ0VfU09GVF9BRkZJTklUWSAmJgotICAgICAgICAgICAgICAg
ICAgICAgIWhhc19zb2Z0X2FmZmluaXR5KHd2Yy0+dmNwdS0+c2NoZWRfdW5pdCkgKQorICAgICAg
ICAgICAgICAgICAgICAgIWhhc19zb2Z0X2FmZmluaXR5KHd2Yy0+dW5pdCkgKQogICAgICAgICAg
ICAgICAgICAgICBjb250aW51ZTsKIAotICAgICAgICAgICAgICAgIGlmICggdmNwdV9jaGVja19h
ZmZpbml0eSh3dmMtPnZjcHUsIGNwdSwgYnMpICkKKyAgICAgICAgICAgICAgICBpZiAoIHVuaXRf
Y2hlY2tfYWZmaW5pdHkod3ZjLT51bml0LCBjcHUsIGJzKSApCiAgICAgICAgICAgICAgICAgewot
ICAgICAgICAgICAgICAgICAgICB2Y3B1X2Fzc2lnbihwcnYsIHd2Yy0+dmNwdSwgY3B1KTsKKyAg
ICAgICAgICAgICAgICAgICAgdW5pdF9hc3NpZ24ocHJ2LCB3dmMtPnVuaXQsIGNwdSk7CiAgICAg
ICAgICAgICAgICAgICAgIGxpc3RfZGVsX2luaXQoJnd2Yy0+d2FpdHFfZWxlbSk7Ci0gICAgICAg
ICAgICAgICAgICAgIHJldC50YXNrID0gd3ZjLT52Y3B1LT5zY2hlZF91bml0OworICAgICAgICAg
ICAgICAgICAgICByZXQudGFzayA9IHd2Yy0+dW5pdDsKICAgICAgICAgICAgICAgICAgICAgZ290
byB1bmxvY2s7CiAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgfQpAQCAtODcwLDE3ICs4
NjYsMTcgQEAgc3RhdGljIHN0cnVjdCB0YXNrX3NsaWNlIG51bGxfc2NoZWR1bGUoY29uc3Qgc3Ry
dWN0IHNjaGVkdWxlciAqb3BzLAogICAgIH0KIAogICAgIGlmICggdW5saWtlbHkocmV0LnRhc2sg
PT0gTlVMTCB8fCAhdW5pdF9ydW5uYWJsZShyZXQudGFzaykpICkKLSAgICAgICAgcmV0LnRhc2sg
PSBpZGxlX3ZjcHVbY3B1XS0+c2NoZWRfdW5pdDsKKyAgICAgICAgcmV0LnRhc2sgPSBzY2hlZF9p
ZGxlX3VuaXQoY3B1KTsKIAotICAgIE5VTExfVkNQVV9DSEVDSyhyZXQudGFzay0+dmNwdV9saXN0
KTsKKyAgICBOVUxMX1VOSVRfQ0hFQ0socmV0LnRhc2spOwogICAgIHJldHVybiByZXQ7CiB9CiAK
LXN0YXRpYyBpbmxpbmUgdm9pZCBkdW1wX3ZjcHUoc3RydWN0IG51bGxfcHJpdmF0ZSAqcHJ2LCBz
dHJ1Y3QgbnVsbF91bml0ICpudmMpCitzdGF0aWMgaW5saW5lIHZvaWQgZHVtcF91bml0KHN0cnVj
dCBudWxsX3ByaXZhdGUgKnBydiwgc3RydWN0IG51bGxfdW5pdCAqbnZjKQogewotICAgIHByaW50
aygiWyVpLiVpXSBwY3B1PSVkIiwgbnZjLT52Y3B1LT5kb21haW4tPmRvbWFpbl9pZCwKLSAgICAg
ICAgICAgIG52Yy0+dmNwdS0+dmNwdV9pZCwgbGlzdF9lbXB0eSgmbnZjLT53YWl0cV9lbGVtKSA/
Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG52Yy0+dmNwdS0+cHJvY2Vzc29yIDog
LTEpOworICAgIHByaW50aygiWyVpLiVpXSBwY3B1PSVkIiwgbnZjLT51bml0LT5kb21haW4tPmRv
bWFpbl9pZCwKKyAgICAgICAgICAgIG52Yy0+dW5pdC0+dW5pdF9pZCwgbGlzdF9lbXB0eSgmbnZj
LT53YWl0cV9lbGVtKSA/CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVkX3Vu
aXRfY3B1KG52Yy0+dW5pdCkgOiAtMSk7CiB9CiAKIHN0YXRpYyB2b2lkIG51bGxfZHVtcF9wY3B1
KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgaW50IGNwdSkKQEAgLTg5NSwxNiArODkxLDE3
IEBAIHN0YXRpYyB2b2lkIG51bGxfZHVtcF9wY3B1KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9w
cywgaW50IGNwdSkKICAgICBwcmludGsoIkNQVVslMDJkXSBzaWJsaW5nPSUqcGIsIGNvcmU9JSpw
YiIsCiAgICAgICAgICAgIGNwdSwgQ1BVTUFTS19QUihwZXJfY3B1KGNwdV9zaWJsaW5nX21hc2ss
IGNwdSkpLAogICAgICAgICAgICBDUFVNQVNLX1BSKHBlcl9jcHUoY3B1X2NvcmVfbWFzaywgY3B1
KSkpOwotICAgIGlmICggcGVyX2NwdShucGMsIGNwdSkudmNwdSAhPSBOVUxMICkKLSAgICAgICAg
cHJpbnRrKCIsIHZjcHU9JXB2IiwgcGVyX2NwdShucGMsIGNwdSkudmNwdSk7CisgICAgaWYgKCBw
ZXJfY3B1KG5wYywgY3B1KS51bml0ICE9IE5VTEwgKQorICAgICAgICBwcmludGsoIiwgdW5pdD0l
cGR2JWQiLCBwZXJfY3B1KG5wYywgY3B1KS51bml0LT5kb21haW4sCisgICAgICAgICAgICAgICBw
ZXJfY3B1KG5wYywgY3B1KS51bml0LT51bml0X2lkKTsKICAgICBwcmludGsoIlxuIik7CiAKLSAg
ICAvKiBjdXJyZW50IFZDUFUgKG5vdGhpbmcgdG8gc2F5IGlmIHRoYXQncyB0aGUgaWRsZSB2Y3B1
KSAqLworICAgIC8qIGN1cnJlbnQgdW5pdCAobm90aGluZyB0byBzYXkgaWYgdGhhdCdzIHRoZSBp
ZGxlIHVuaXQpICovCiAgICAgbnZjID0gbnVsbF91bml0KGN1cnJfb25fY3B1KGNwdSkpOwotICAg
IGlmICggbnZjICYmICFpc19pZGxlX3ZjcHUobnZjLT52Y3B1KSApCisgICAgaWYgKCBudmMgJiYg
IWlzX2lkbGVfdW5pdChudmMtPnVuaXQpICkKICAgICB7CiAgICAgICAgIHByaW50aygiXHRydW46
ICIpOwotICAgICAgICBkdW1wX3ZjcHUocHJ2LCBudmMpOworICAgICAgICBkdW1wX3VuaXQocHJ2
LCBudmMpOwogICAgICAgICBwcmludGsoIlxuIik7CiAgICAgfQogCkBAIC05MjcsMjMgKzkyNCwy
MyBAQCBzdGF0aWMgdm9pZCBudWxsX2R1bXAoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzKQog
ICAgIGxpc3RfZm9yX2VhY2goIGl0ZXIsICZwcnYtPm5kb20gKQogICAgIHsKICAgICAgICAgc3Ry
dWN0IG51bGxfZG9tICpuZG9tOwotICAgICAgICBzdHJ1Y3QgdmNwdSAqdjsKKyAgICAgICAgc3Ry
dWN0IHNjaGVkX3VuaXQgKnVuaXQ7CiAKICAgICAgICAgbmRvbSA9IGxpc3RfZW50cnkoaXRlciwg
c3RydWN0IG51bGxfZG9tLCBuZG9tX2VsZW0pOwogCiAgICAgICAgIHByaW50aygiXHREb21haW46
ICVkXG4iLCBuZG9tLT5kb20tPmRvbWFpbl9pZCk7Ci0gICAgICAgIGZvcl9lYWNoX3ZjcHUoIG5k
b20tPmRvbSwgdiApCisgICAgICAgIGZvcl9lYWNoX3NjaGVkX3VuaXQoIG5kb20tPmRvbSwgdW5p
dCApCiAgICAgICAgIHsKLSAgICAgICAgICAgIHN0cnVjdCBudWxsX3VuaXQgKiBjb25zdCBudmMg
PSBudWxsX3VuaXQodi0+c2NoZWRfdW5pdCk7CisgICAgICAgICAgICBzdHJ1Y3QgbnVsbF91bml0
ICogY29uc3QgbnZjID0gbnVsbF91bml0KHVuaXQpOwogICAgICAgICAgICAgc3BpbmxvY2tfdCAq
bG9jazsKIAotICAgICAgICAgICAgbG9jayA9IHVuaXRfc2NoZWR1bGVfbG9jayhudmMtPnZjcHUt
PnNjaGVkX3VuaXQpOworICAgICAgICAgICAgbG9jayA9IHVuaXRfc2NoZWR1bGVfbG9jayh1bml0
KTsKIAogICAgICAgICAgICAgcHJpbnRrKCJcdCUzZDogIiwgKytsb29wKTsKLSAgICAgICAgICAg
IGR1bXBfdmNwdShwcnYsIG52Yyk7CisgICAgICAgICAgICBkdW1wX3VuaXQocHJ2LCBudmMpOwog
ICAgICAgICAgICAgcHJpbnRrKCJcbiIpOwogCi0gICAgICAgICAgICB1bml0X3NjaGVkdWxlX3Vu
bG9jayhsb2NrLCBudmMtPnZjcHUtPnNjaGVkX3VuaXQpOworICAgICAgICAgICAgdW5pdF9zY2hl
ZHVsZV91bmxvY2sobG9jaywgdW5pdCk7CiAgICAgICAgIH0KICAgICB9CiAKQEAgLTk1OCw3ICs5
NTUsNyBAQCBzdGF0aWMgdm9pZCBudWxsX2R1bXAoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3Bz
KQogICAgICAgICAgICAgcHJpbnRrKCIsICIpOwogICAgICAgICBpZiAoIGxvb3AgJSAyNCA9PSAw
ICkKICAgICAgICAgICAgIHByaW50aygiXG5cdCIpOwotICAgICAgICBwcmludGsoIiVwdiIsIG52
Yy0+dmNwdSk7CisgICAgICAgIHByaW50aygiJXBkdiVkIiwgbnZjLT51bml0LT5kb21haW4sIG52
Yy0+dW5pdC0+dW5pdF9pZCk7CiAgICAgfQogICAgIHByaW50aygiXG4iKTsKICAgICBzcGluX3Vu
bG9jaygmcHJ2LT53YWl0cV9sb2NrKTsKLS0gCjIuMTYuNAoKCl9fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRl
dmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFp
bG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

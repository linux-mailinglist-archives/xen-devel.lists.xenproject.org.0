Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id D40C616EEE6
	for <lists+xen-devel@lfdr.de>; Tue, 25 Feb 2020 20:22:08 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1j6fij-00077z-UR; Tue, 25 Feb 2020 19:18:17 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=nw84=4N=intel.com=tamas.lengyel@srs-us1.protection.inumbo.net>)
 id 1j6fii-00077u-E3
 for xen-devel@lists.xenproject.org; Tue, 25 Feb 2020 19:18:16 +0000
X-Inumbo-ID: 90bdb0dd-5803-11ea-9354-12813bfff9fa
Received: from mga06.intel.com (unknown [134.134.136.31])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 90bdb0dd-5803-11ea-9354-12813bfff9fa;
 Tue, 25 Feb 2020 19:18:14 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga003.jf.intel.com ([10.7.209.27])
 by orsmga104.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 25 Feb 2020 11:18:14 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.70,485,1574150400"; d="scan'208";a="237776400"
Received: from tlengyel-mobl2.amr.corp.intel.com (HELO localhost.localdomain)
 ([10.254.187.145])
 by orsmga003.jf.intel.com with ESMTP; 25 Feb 2020 11:18:12 -0800
From: Tamas K Lengyel <tamas.lengyel@intel.com>
To: xen-devel@lists.xenproject.org
Date: Tue, 25 Feb 2020 11:17:57 -0800
Message-Id: <469220b87755c4d222af85186b992bc4ffe15fac.1582658216.git.tamas.lengyel@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <cover.1582658216.git.tamas.lengyel@intel.com>
References: <cover.1582658216.git.tamas.lengyel@intel.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v10 3/3] xen/tools: VM forking toolstack side
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Anthony PERARD <anthony.perard@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>,
 Tamas K Lengyel <tamas.lengyel@intel.com>, Wei Liu <wl@xen.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

QWRkIG5lY2Vzc2FyeSBiaXRzIHRvIGltcGxlbWVudCAieGwgZm9yay12bSIgY29tbWFuZHMuIFRo
ZSBjb21tYW5kIGFsbG93cyB0aGUKdXNlciB0byBzcGVjaWZ5IGhvdyB0byBsYXVuY2ggdGhlIGRl
dmljZSBtb2RlbCBhbGxvd2luZyBmb3IgYSBsYXRlLWxhdW5jaCBtb2RlbAppbiB3aGljaCB0aGUg
dXNlciBjYW4gZXhlY3V0ZSB0aGUgZm9yayB3aXRob3V0IHRoZSBkZXZpY2UgbW9kZWwgYW5kIGRl
Y2lkZSB0bwpvbmx5IGxhdGVyIGxhdW5jaCBpdC4KClNpZ25lZC1vZmYtYnk6IFRhbWFzIEsgTGVu
Z3llbCA8dGFtYXMubGVuZ3llbEBpbnRlbC5jb20+Ci0tLQp2MTA6IG1vdmUgY29kZSBpbnRvIHg4
NiBzcGVjaWZpYyBjb2RlIHNvIGl0IGRvZXNuJ3QgZ2V0IGNvbXBpbGVkIG9uIEFSTQogICAgIGNv
bXBpbGUgdGVzdGVkIG9uIEFSTQogICAgIHJlcXVpcmUgdXNlciB0byBzcGVjaWZ5IHBhcmVudCdz
IG1heC12Y3B1IHNldHRpbmcKICAgICBkb2N1bWVudCBsaW1pdGF0aW9uIG9uIGNlcnRhaW4gb3B0
aW9ucyBoYXZpbmcgdG8gYmUgc2V0IHRvIGRlZmF1bHQKLS0tCiBkb2NzL21hbi94bC4xLnBvZC5p
biAgICAgICAgICB8ICA0NCArKysrKwogdG9vbHMvbGlieGMvaW5jbHVkZS94ZW5jdHJsLmggfCAg
MTMgKysKIHRvb2xzL2xpYnhjL3hjX21lbXNoci5jICAgICAgIHwgIDIyICsrKwogdG9vbHMvbGli
eGwvbGlieGwuaCAgICAgICAgICAgfCAgMTEgKysKIHRvb2xzL2xpYnhsL2xpYnhsX2NyZWF0ZS5j
ICAgIHwgMzYxICsrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0KIHRvb2xzL2xpYnhs
L2xpYnhsX2RtLmMgICAgICAgIHwgICAyICstCiB0b29scy9saWJ4bC9saWJ4bF9kb20uYyAgICAg
ICB8ICA0MyArKystCiB0b29scy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5oICB8ICAgNyArCiB0b29s
cy9saWJ4bC9saWJ4bF90eXBlcy5pZGwgICB8ICAgMSArCiB0b29scy9saWJ4bC9saWJ4bF94ODYu
YyAgICAgICB8ICA0MSArKysrCiB0b29scy94bC9NYWtlZmlsZSAgICAgICAgICAgICB8ICAgMiAr
LQogdG9vbHMveGwveGwuaCAgICAgICAgICAgICAgICAgfCAgIDUgKwogdG9vbHMveGwveGxfY21k
dGFibGUuYyAgICAgICAgfCAgMTUgKysKIHRvb2xzL3hsL3hsX2Zvcmt2bS5jICAgICAgICAgIHwg
MTQ3ICsrKysrKysrKysrKysrCiB0b29scy94bC94bF92bWNvbnRyb2wuYyAgICAgICB8ICAxNCAr
KwogMTUgZmlsZXMgY2hhbmdlZCwgNTYyIGluc2VydGlvbnMoKyksIDE2NiBkZWxldGlvbnMoLSkK
IGNyZWF0ZSBtb2RlIDEwMDY0NCB0b29scy94bC94bF9mb3Jrdm0uYwoKZGlmZiAtLWdpdCBhL2Rv
Y3MvbWFuL3hsLjEucG9kLmluIGIvZG9jcy9tYW4veGwuMS5wb2QuaW4KaW5kZXggMDkzMzkyODJl
Ni4uNTljMDNjNjQyNyAxMDA2NDQKLS0tIGEvZG9jcy9tYW4veGwuMS5wb2QuaW4KKysrIGIvZG9j
cy9tYW4veGwuMS5wb2QuaW4KQEAgLTcwOCw2ICs3MDgsNTAgQEAgYWJvdmUpLgogCiA9YmFjawog
Cis9aXRlbSBCPGZvcmstdm0+IFtJPE9QVElPTlM+XSBJPGRvbWFpbi1pZD4KKworQ3JlYXRlIGEg
Zm9yayBvZiBhIHJ1bm5pbmcgVk0uICBUaGUgZG9tYWluIHdpbGwgYmUgcGF1c2VkIGFmdGVyIHRo
ZSBvcGVyYXRpb24KK2FuZCByZW1haW5zIHBhdXNlZCB3aGlsZSBmb3JrcyBvZiBpdCBleGlzdC4g
IEV4cGVyaW1lbnRhbCBhbmQgeDg2IG9ubHkuCitGb3JrcyBjYW4gb25seSBiZSBtYWRlIG9mIGRv
bWFpbnMgd2l0aCBIQVAgZW5hYmxlZCBhbmQgb24gSW50ZWwgaGFyZHdhcmUuICBUaGUKK3BhcmVu
dCBkb21haW4gbXVzdCBiZSBjcmVhdGVkIHdpdGggdGhlIHhsIHRvb2xzdGFjayBhbmQgaXRzIGNv
bmZpZ3VyYXRpb24gbXVzdAorbm90IG1hbnVhbGx5IGRlZmluZSBtYXhfZ3JhbnRfZnJhbWVzLCBt
YXhfbWFwdHJhY2tfZnJhbWVzIG9yIG1heF9ldmVudF9jaGFubmVscy4KKworQjxPUFRJT05TPgor
Cis9b3ZlciA0CisKKz1pdGVtIEI8LXA+CisKK0xlYXZlIHRoZSBmb3JrIHBhdXNlZCBhZnRlciBj
cmVhdGluZyBpdC4KKworPWl0ZW0gQjwtLWxhdW5jaC1kbT4KKworU3BlY2lmeSB3aGV0aGVyIHRo
ZSBkZXZpY2UgbW9kZWwgKFFFTVUpIHNob3VsZCBiZSBsYXVuY2hlZCBmb3IgdGhlIGZvcmsuIExh
dGUKK2xhdW5jaCBhbGxvd3MgdG8gc3RhcnQgdGhlIGRldmljZSBtb2RlbCBmb3IgYW4gYWxyZWFk
eSBydW5uaW5nIGZvcmsuCisKKz1pdGVtIEI8LUM+CisKK1RoZSBjb25maWcgZmlsZSB0byB1c2Ug
d2hlbiBsYXVuY2hpbmcgdGhlIGRldmljZSBtb2RlbC4gIEN1cnJlbnRseSByZXF1aXJlZCB3aGVu
CitsYXVuY2hpbmcgdGhlIGRldmljZSBtb2RlbC4gIE1vc3QgY29uZmlnIHNldHRpbmdzIE1VU1Qg
bWF0Y2ggdGhlIHBhcmVudCBkb21haW4KK2V4YWN0bHksIG9ubHkgY2hhbmdlIFZNIG5hbWUsIGRp
c2sgcGF0aCBhbmQgbmV0d29yayBjb25maWd1cmF0aW9ucy4KKworPWl0ZW0gQjwtUT4KKworVGhl
IHBhdGggdG8gdGhlIHFlbXUgc2F2ZSBmaWxlIHRvIHVzZSB3aGVuIGxhdW5jaGluZyB0aGUgZGV2
aWNlIG1vZGVsLiAgQ3VycmVudGx5CityZXF1aXJlZCB3aGVuIGxhdW5jaGluZyB0aGUgZGV2aWNl
IG1vZGVsLgorCis9aXRlbSBCPC0tZm9yay1yZXNldD4KKworUGVyZm9ybSBhIHJlc2V0IG9wZXJh
dGlvbiBvZiBhbiBhbHJlYWR5IHJ1bm5pbmcgZm9yay4gIE5vdGUgdGhhdCByZXNldHRpbmcgbWF5
CitiZSBsZXNzIHBlcmZvcm1hbnQgdGhlbiBjcmVhdGluZyBhIG5ldyBmb3JrIGRlcGVuZGluZyBv
biBob3cgbXVjaCBtZW1vcnkgdGhlCitmb3JrIGhhcyBkZWR1cGxpY2F0ZWQgZHVyaW5nIGl0cyBy
dW50aW1lLgorCis9aXRlbSBCPC0tbWF4LXZjcHVzPgorCitTcGVjaWZ5IHRoZSBtYXgtdmNwdXMg
bWF0Y2hpbmcgdGhlIHBhcmVudCBkb21haW4gd2hlbiBub3QgbGF1bmNoaW5nIHRoZSBkbS4KKwor
PWJhY2sKKwogPWl0ZW0gQjxzaGFyaW5nPiBbSTxkb21haW4taWQ+XQogCiBEaXNwbGF5IHRoZSBu
dW1iZXIgb2Ygc2hhcmVkIHBhZ2VzIGZvciBhIHNwZWNpZmllZCBkb21haW4uIElmIG5vIGRvbWFp
biBpcwpkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGMvaW5jbHVkZS94ZW5jdHJsLmggYi90b29scy9s
aWJ4Yy9pbmNsdWRlL3hlbmN0cmwuaAppbmRleCA5OTU1MmE1ZjczLi45MGZjZTgzMTk2IDEwMDY0
NAotLS0gYS90b29scy9saWJ4Yy9pbmNsdWRlL3hlbmN0cmwuaAorKysgYi90b29scy9saWJ4Yy9p
bmNsdWRlL3hlbmN0cmwuaApAQCAtMjIyNSw2ICsyMjI1LDE5IEBAIGludCB4Y19tZW1zaHJfcmFu
Z2Vfc2hhcmUoeGNfaW50ZXJmYWNlICp4Y2gsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHVp
bnQ2NF90IGZpcnN0X2dmbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDY0X3QgbGFz
dF9nZm4pOwogCitpbnQgeGNfbWVtc2hyX2ZvcmsoeGNfaW50ZXJmYWNlICp4Y2gsCisgICAgICAg
ICAgICAgICAgICAgdWludDMyX3Qgc291cmNlX2RvbWFpbiwKKyAgICAgICAgICAgICAgICAgICB1
aW50MzJfdCBjbGllbnRfZG9tYWluKTsKKworLyoKKyAqIE5vdGU6IHRoaXMgZnVuY3Rpb24gaXMg
b25seSBpbnRlbmRlZCB0byBiZSB1c2VkIG9uIHNob3J0LWxpdmVkIGZvcmtzIHRoYXQKKyAqIGhh
dmVuJ3QgeWV0IGFxdWlyZWQgYSBsb3Qgb2YgbWVtb3J5LiBJbiBjYXNlIHRoZSBmb3JrIGhhcyBh
IGxvdCBvZiBtZW1vcnkKKyAqIGl0IGlzIGxpa2VseSBtb3JlIHBlcmZvcm1hbnQgdG8gY3JlYXRl
IGEgbmV3IGZvcmsgd2l0aCB4Y19tZW1zaHJfZm9yay4KKyAqCisgKiBXaXRoIFZNcyB0aGF0IGhh
dmUgYSBsb3Qgb2YgbWVtb3J5IHRoaXMgY2FsbCBtYXkgYmxvY2sgZm9yIGEgbG9uZyB0aW1lLgor
ICovCitpbnQgeGNfbWVtc2hyX2ZvcmtfcmVzZXQoeGNfaW50ZXJmYWNlICp4Y2gsIHVpbnQzMl90
IGZvcmtlZF9kb21haW4pOworCiAvKiBEZWJ1ZyBjYWxsczogcmV0dXJuIHRoZSBudW1iZXIgb2Yg
cGFnZXMgcmVmZXJlbmNpbmcgdGhlIHNoYXJlZCBmcmFtZSBiYWNraW5nCiAgKiB0aGUgaW5wdXQg
YXJndW1lbnQuIFNob3VsZCBiZSBvbmUgb3IgZ3JlYXRlci4KICAqCmRpZmYgLS1naXQgYS90b29s
cy9saWJ4Yy94Y19tZW1zaHIuYyBiL3Rvb2xzL2xpYnhjL3hjX21lbXNoci5jCmluZGV4IDk3ZTJl
NmE4ZDkuLmQwZTRlZTIyNWIgMTAwNjQ0Ci0tLSBhL3Rvb2xzL2xpYnhjL3hjX21lbXNoci5jCisr
KyBiL3Rvb2xzL2xpYnhjL3hjX21lbXNoci5jCkBAIC0yMzksNiArMjM5LDI4IEBAIGludCB4Y19t
ZW1zaHJfZGVidWdfZ3JlZih4Y19pbnRlcmZhY2UgKnhjaCwKICAgICByZXR1cm4geGNfbWVtc2hy
X21lbW9wKHhjaCwgZG9taWQsICZtc28pOwogfQogCitpbnQgeGNfbWVtc2hyX2ZvcmsoeGNfaW50
ZXJmYWNlICp4Y2gsIHVpbnQzMl90IHBkb21pZCwgdWludDMyX3QgZG9taWQpCit7CisgICAgeGVu
X21lbV9zaGFyaW5nX29wX3QgbXNvOworCisgICAgbWVtc2V0KCZtc28sIDAsIHNpemVvZihtc28p
KTsKKworICAgIG1zby5vcCA9IFhFTk1FTV9zaGFyaW5nX29wX2Zvcms7CisgICAgbXNvLnUuZm9y
ay5wYXJlbnRfZG9tYWluID0gcGRvbWlkOworCisgICAgcmV0dXJuIHhjX21lbXNocl9tZW1vcCh4
Y2gsIGRvbWlkLCAmbXNvKTsKK30KKworaW50IHhjX21lbXNocl9mb3JrX3Jlc2V0KHhjX2ludGVy
ZmFjZSAqeGNoLCB1aW50MzJfdCBkb21pZCkKK3sKKyAgICB4ZW5fbWVtX3NoYXJpbmdfb3BfdCBt
c287CisKKyAgICBtZW1zZXQoJm1zbywgMCwgc2l6ZW9mKG1zbykpOworICAgIG1zby5vcCA9IFhF
Tk1FTV9zaGFyaW5nX29wX2ZvcmtfcmVzZXQ7CisKKyAgICByZXR1cm4geGNfbWVtc2hyX21lbW9w
KHhjaCwgZG9taWQsICZtc28pOworfQorCiBpbnQgeGNfbWVtc2hyX2F1ZGl0KHhjX2ludGVyZmFj
ZSAqeGNoKQogewogICAgIHhlbl9tZW1fc2hhcmluZ19vcF90IG1zbzsKZGlmZiAtLWdpdCBhL3Rv
b2xzL2xpYnhsL2xpYnhsLmggYi90b29scy9saWJ4bC9saWJ4bC5oCmluZGV4IDM1ZTEzNDI4YjIu
LjZiOTY4YmRjYjQgMTAwNjQ0Ci0tLSBhL3Rvb2xzL2xpYnhsL2xpYnhsLmgKKysrIGIvdG9vbHMv
bGlieGwvbGlieGwuaApAQCAtMjY1Nyw2ICsyNjU3LDE3IEBAIGludCBsaWJ4bF9wc3JfZ2V0X2h3
X2luZm8obGlieGxfY3R4ICpjdHgsIGxpYnhsX3Bzcl9mZWF0X3R5cGUgdHlwZSwKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IGx2bCwgdW5zaWduZWQgaW50ICpuciwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgbGlieGxfcHNyX2h3X2luZm8gKippbmZvKTsKIHZvaWQg
bGlieGxfcHNyX2h3X2luZm9fbGlzdF9mcmVlKGxpYnhsX3Bzcl9od19pbmZvICpsaXN0LCB1bnNp
Z25lZCBpbnQgbnIpOworCitpbnQgbGlieGxfZG9tYWluX2Zvcmtfdm0obGlieGxfY3R4ICpjdHgs
IHVpbnQzMl90IHBkb21pZCwgdWludDMyX3QgbWF4X3ZjcHVzLCB1aW50MzJfdCAqZG9taWQpCisg
ICAgICAgICAgICAgICAgICAgICAgICAgTElCWExfRVhURVJOQUxfQ0FMTEVSU19PTkxZOworCitp
bnQgbGlieGxfZG9tYWluX2ZvcmtfbGF1bmNoX2RtKGxpYnhsX2N0eCAqY3R4LCBsaWJ4bF9kb21h
aW5fY29uZmlnICpkX2NvbmZpZywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWlu
dDMyX3QgZG9taWQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxpYnhs
X2FzeW5jcHJvZ3Jlc3NfaG93ICphb3BfY29uc29sZV9ob3cpCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIExJQlhMX0VYVEVSTkFMX0NBTExFUlNfT05MWTsKKworaW50IGxpYnhsX2Rv
bWFpbl9mb3JrX3Jlc2V0KGxpYnhsX2N0eCAqY3R4LCB1aW50MzJfdCBkb21pZCkKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBMSUJYTF9FWFRFUk5BTF9DQUxMRVJTX09OTFk7CiAjZW5kaWYK
IAogLyogbWlzYyAqLwpkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGlieGxfY3JlYXRlLmMgYi90
b29scy9saWJ4bC9saWJ4bF9jcmVhdGUuYwppbmRleCBjY2M5ZTcwOTkwLi5lYmE4Y2U0MTliIDEw
MDY0NAotLS0gYS90b29scy9saWJ4bC9saWJ4bF9jcmVhdGUuYworKysgYi90b29scy9saWJ4bC9s
aWJ4bF9jcmVhdGUuYwpAQCAtNTM2LDEyICs1MzYsMTIgQEAgb3V0OgogICAgIHJldHVybiByZXQ7
CiB9CiAKLWludCBsaWJ4bF9fZG9tYWluX21ha2UobGlieGxfX2djICpnYywgbGlieGxfZG9tYWlu
X2NvbmZpZyAqZF9jb25maWcsCi0gICAgICAgICAgICAgICAgICAgICAgIGxpYnhsX19kb21haW5f
YnVpbGRfc3RhdGUgKnN0YXRlLAotICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCAqZG9t
aWQsIGJvb2wgc29mdF9yZXNldCkKK3N0YXRpYyBpbnQgbGlieGxfX2RvbWFpbl9tYWtlX3hzX2Vu
dHJpZXMobGlieGxfX2djICpnYywgbGlieGxfZG9tYWluX2NvbmZpZyAqZF9jb25maWcsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnhsX19kb21haW5fYnVpbGRf
c3RhdGUgKnN0YXRlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1
aW50MzJfdCBkb21pZCkKIHsKICAgICBsaWJ4bF9jdHggKmN0eCA9IGxpYnhsX19nY19vd25lcihn
Yyk7Ci0gICAgaW50IHJldCwgcmMsIG5iX3ZtOworICAgIGludCByYywgbmJfdm07CiAgICAgY29u
c3QgY2hhciAqZG9tX3R5cGU7CiAgICAgY2hhciAqdXVpZF9zdHJpbmc7CiAgICAgY2hhciAqZG9t
X3BhdGgsICp2bV9wYXRoLCAqbGlieGxfcGF0aDsKQEAgLTU1Myw5ICs1NTMsNiBAQCBpbnQgbGli
eGxfX2RvbWFpbl9tYWtlKGxpYnhsX19nYyAqZ2MsIGxpYnhsX2RvbWFpbl9jb25maWcgKmRfY29u
ZmlnLAogCiAgICAgLyogY29udmVuaWVuY2UgYWxpYXNlcyAqLwogICAgIGxpYnhsX2RvbWFpbl9j
cmVhdGVfaW5mbyAqaW5mbyA9ICZkX2NvbmZpZy0+Y19pbmZvOwotICAgIGxpYnhsX2RvbWFpbl9i
dWlsZF9pbmZvICpiX2luZm8gPSAmZF9jb25maWctPmJfaW5mbzsKLQotICAgIGFzc2VydChzb2Z0
X3Jlc2V0IHx8ICpkb21pZCA9PSBJTlZBTElEX0RPTUlEKTsKIAogICAgIHV1aWRfc3RyaW5nID0g
bGlieGxfX3V1aWQyc3RyaW5nKGdjLCBpbmZvLT51dWlkKTsKICAgICBpZiAoIXV1aWRfc3RyaW5n
KSB7CkBAIC01NjMsMTM3ICs1NjAsNyBAQCBpbnQgbGlieGxfX2RvbWFpbl9tYWtlKGxpYnhsX19n
YyAqZ2MsIGxpYnhsX2RvbWFpbl9jb25maWcgKmRfY29uZmlnLAogICAgICAgICBnb3RvIG91dDsK
ICAgICB9CiAKLSAgICBpZiAoIXNvZnRfcmVzZXQpIHsKLSAgICAgICAgc3RydWN0IHhlbl9kb21j
dGxfY3JlYXRlZG9tYWluIGNyZWF0ZSA9IHsKLSAgICAgICAgICAgIC5zc2lkcmVmID0gaW5mby0+
c3NpZHJlZiwKLSAgICAgICAgICAgIC5tYXhfdmNwdXMgPSBiX2luZm8tPm1heF92Y3B1cywKLSAg
ICAgICAgICAgIC5tYXhfZXZ0Y2huX3BvcnQgPSBiX2luZm8tPmV2ZW50X2NoYW5uZWxzLAotICAg
ICAgICAgICAgLm1heF9ncmFudF9mcmFtZXMgPSBiX2luZm8tPm1heF9ncmFudF9mcmFtZXMsCi0g
ICAgICAgICAgICAubWF4X21hcHRyYWNrX2ZyYW1lcyA9IGJfaW5mby0+bWF4X21hcHRyYWNrX2Zy
YW1lcywKLSAgICAgICAgfTsKLQotICAgICAgICBpZiAoaW5mby0+dHlwZSAhPSBMSUJYTF9ET01B
SU5fVFlQRV9QVikgewotICAgICAgICAgICAgY3JlYXRlLmZsYWdzIHw9IFhFTl9ET01DVExfQ0RG
X2h2bTsKLSAgICAgICAgICAgIGNyZWF0ZS5mbGFncyB8PQotICAgICAgICAgICAgICAgIGxpYnhs
X2RlZmJvb2xfdmFsKGluZm8tPmhhcCkgPyBYRU5fRE9NQ1RMX0NERl9oYXAgOiAwOwotICAgICAg
ICAgICAgY3JlYXRlLmZsYWdzIHw9Ci0gICAgICAgICAgICAgICAgbGlieGxfZGVmYm9vbF92YWwo
aW5mby0+b29zKSA/IDAgOiBYRU5fRE9NQ1RMX0NERl9vb3Nfb2ZmOwotICAgICAgICB9Ci0KLSAg
ICAgICAgYXNzZXJ0KGluZm8tPnBhc3N0aHJvdWdoICE9IExJQlhMX1BBU1NUSFJPVUdIX0RFRkFV
TFQpOwotICAgICAgICBMT0coREVUQUlMLCAicGFzc3Rocm91Z2g6ICVzIiwKLSAgICAgICAgICAg
IGxpYnhsX3Bhc3N0aHJvdWdoX3RvX3N0cmluZyhpbmZvLT5wYXNzdGhyb3VnaCkpOwotCi0gICAg
ICAgIGlmIChpbmZvLT5wYXNzdGhyb3VnaCAhPSBMSUJYTF9QQVNTVEhST1VHSF9ESVNBQkxFRCkK
LSAgICAgICAgICAgIGNyZWF0ZS5mbGFncyB8PSBYRU5fRE9NQ1RMX0NERl9pb21tdTsKLQotICAg
ICAgICBpZiAoaW5mby0+cGFzc3Rocm91Z2ggPT0gTElCWExfUEFTU1RIUk9VR0hfU1lOQ19QVCkK
LSAgICAgICAgICAgIGNyZWF0ZS5pb21tdV9vcHRzIHw9IFhFTl9ET01DVExfSU9NTVVfbm9fc2hh
cmVwdDsKLQotICAgICAgICAvKiBVbHRpbWF0ZWx5LCBoYW5kbGUgaXMgYW4gYXJyYXkgb2YgMTYg
dWludDhfdCwgc2FtZSBhcyB1dWlkICovCi0gICAgICAgIGxpYnhsX3V1aWRfY29weShjdHgsIChs
aWJ4bF91dWlkICopJmNyZWF0ZS5oYW5kbGUsICZpbmZvLT51dWlkKTsKLQotICAgICAgICByZXQg
PSBsaWJ4bF9fYXJjaF9kb21haW5fcHJlcGFyZV9jb25maWcoZ2MsIGRfY29uZmlnLCAmY3JlYXRl
KTsKLSAgICAgICAgaWYgKHJldCA8IDApIHsKLSAgICAgICAgICAgIExPR0VEKEVSUk9SLCAqZG9t
aWQsICJmYWlsIHRvIGdldCBkb21haW4gY29uZmlnIik7Ci0gICAgICAgICAgICByYyA9IEVSUk9S
X0ZBSUw7Ci0gICAgICAgICAgICBnb3RvIG91dDsKLSAgICAgICAgfQotCi0gICAgICAgIGZvciAo
OzspIHsKLSAgICAgICAgICAgIHVpbnQzMl90IGxvY2FsX2RvbWlkOwotICAgICAgICAgICAgYm9v
bCByZWNlbnQ7Ci0KLSAgICAgICAgICAgIGlmIChpbmZvLT5kb21pZCA9PSBSQU5ET01fRE9NSUQp
IHsKLSAgICAgICAgICAgICAgICB1aW50MTZfdCB2OwotCi0gICAgICAgICAgICAgICAgcmV0ID0g
bGlieGxfX3JhbmRvbV9ieXRlcyhnYywgKHZvaWQgKikmdiwgc2l6ZW9mKHYpKTsKLSAgICAgICAg
ICAgICAgICBpZiAocmV0IDwgMCkKLSAgICAgICAgICAgICAgICAgICAgYnJlYWs7Ci0KLSAgICAg
ICAgICAgICAgICB2ICY9IERPTUlEX01BU0s7Ci0gICAgICAgICAgICAgICAgaWYgKCFsaWJ4bF9k
b21pZF92YWxpZF9ndWVzdCh2KSkKLSAgICAgICAgICAgICAgICAgICAgY29udGludWU7Ci0KLSAg
ICAgICAgICAgICAgICBsb2NhbF9kb21pZCA9IHY7Ci0gICAgICAgICAgICB9IGVsc2UgewotICAg
ICAgICAgICAgICAgIGxvY2FsX2RvbWlkID0gaW5mby0+ZG9taWQ7IC8qIE1heSBub3QgYmUgdmFs
aWQgKi8KLSAgICAgICAgICAgIH0KLQotICAgICAgICAgICAgcmV0ID0geGNfZG9tYWluX2NyZWF0
ZShjdHgtPnhjaCwgJmxvY2FsX2RvbWlkLCAmY3JlYXRlKTsKLSAgICAgICAgICAgIGlmIChyZXQg
PCAwKSB7Ci0gICAgICAgICAgICAgICAgLyoKLSAgICAgICAgICAgICAgICAgKiBJZiB3ZSBnZW5l
cmF0ZWQgYSByYW5kb20gZG9taWQgYW5kIGNyZWF0aW9uIGZhaWxlZAotICAgICAgICAgICAgICAg
ICAqIGJlY2F1c2UgdGhhdCBkb21pZCBhbHJlYWR5IGV4aXN0cyB0aGVuIHNpbXBseSB0cnkKLSAg
ICAgICAgICAgICAgICAgKiBhZ2Fpbi4KLSAgICAgICAgICAgICAgICAgKi8KLSAgICAgICAgICAg
ICAgICBpZiAoZXJybm8gPT0gRUVYSVNUICYmIGluZm8tPmRvbWlkID09IFJBTkRPTV9ET01JRCkK
LSAgICAgICAgICAgICAgICAgICAgY29udGludWU7Ci0KLSAgICAgICAgICAgICAgICBMT0dFRChF
UlJPUiwgbG9jYWxfZG9taWQsICJkb21haW4gY3JlYXRpb24gZmFpbCIpOwotICAgICAgICAgICAg
ICAgIHJjID0gRVJST1JfRkFJTDsKLSAgICAgICAgICAgICAgICBnb3RvIG91dDsKLSAgICAgICAg
ICAgIH0KLQotICAgICAgICAgICAgLyogQSBuZXcgZG9tYWluIG5vdyBleGlzdHMgKi8KLSAgICAg
ICAgICAgICpkb21pZCA9IGxvY2FsX2RvbWlkOwotCi0gICAgICAgICAgICByYyA9IGxpYnhsX19p
c19kb21pZF9yZWNlbnQoZ2MsIGxvY2FsX2RvbWlkLCAmcmVjZW50KTsKLSAgICAgICAgICAgIGlm
IChyYykKLSAgICAgICAgICAgICAgICBnb3RvIG91dDsKLQotICAgICAgICAgICAgLyogVGhlIGRv
bWlkIGlzIG5vdCByZWNlbnQsIHNvIHdlJ3JlIGRvbmUgKi8KLSAgICAgICAgICAgIGlmICghcmVj
ZW50KQotICAgICAgICAgICAgICAgIGJyZWFrOwotCi0gICAgICAgICAgICAvKgotICAgICAgICAg
ICAgICogSWYgdGhlIGRvbWlkIHdhcyBzcGVjaWZpZWQgdGhlbiB0aGVyZSdzIG5vIHBvaW50IGlu
Ci0gICAgICAgICAgICAgKiB0cnlpbmcgYWdhaW4uCi0gICAgICAgICAgICAgKi8KLSAgICAgICAg
ICAgIGlmIChsaWJ4bF9kb21pZF92YWxpZF9ndWVzdChpbmZvLT5kb21pZCkpIHsKLSAgICAgICAg
ICAgICAgICBMT0dFRChFUlJPUiwgbG9jYWxfZG9taWQsICJkb21haW4gaWQgcmVjZW50bHkgdXNl
ZCIpOwotICAgICAgICAgICAgICAgIHJjID0gRVJST1JfRkFJTDsKLSAgICAgICAgICAgICAgICBn
b3RvIG91dDsKLSAgICAgICAgICAgIH0KLQotICAgICAgICAgICAgLyoKLSAgICAgICAgICAgICAq
IFRoZSBkb21haW4gaXMgcmVjZW50IGFuZCBzbyBjYW5ub3QgYmUgdXNlZC4gQ2xlYXIgZG9taWQK
LSAgICAgICAgICAgICAqIGhlcmUgc2luY2UsIGlmIHhjX2RvbWFpbl9kZXN0cm95KCkgZmFpbHMg
YmVsb3cgdGhlcmUgaXMKLSAgICAgICAgICAgICAqIGxpdHRsZSBwb2ludCBjYWxsaW5nIGl0IGFn
YWluIGluIHRoZSBlcnJvciBwYXRoLgotICAgICAgICAgICAgICovCi0gICAgICAgICAgICAqZG9t
aWQgPSBJTlZBTElEX0RPTUlEOwotCi0gICAgICAgICAgICByZXQgPSB4Y19kb21haW5fZGVzdHJv
eShjdHgtPnhjaCwgbG9jYWxfZG9taWQpOwotICAgICAgICAgICAgaWYgKHJldCA8IDApIHsKLSAg
ICAgICAgICAgICAgICBMT0dFRChFUlJPUiwgbG9jYWxfZG9taWQsICJkb21haW4gZGVzdHJveSBm
YWlsIik7Ci0gICAgICAgICAgICAgICAgcmMgPSBFUlJPUl9GQUlMOwotICAgICAgICAgICAgICAg
IGdvdG8gb3V0OwotICAgICAgICAgICAgfQotCi0gICAgICAgICAgICAvKiBUaGUgZG9tYWluIHdh
cyBzdWNjZXNzZnVsbHkgZGVzdHJveWVkLCBzbyB3ZSBjYW4gdHJ5IGFnYWluICovCi0gICAgICAg
IH0KLQotICAgICAgICByYyA9IGxpYnhsX19hcmNoX2RvbWFpbl9zYXZlX2NvbmZpZyhnYywgZF9j
b25maWcsIHN0YXRlLCAmY3JlYXRlKTsKLSAgICAgICAgaWYgKHJjIDwgMCkKLSAgICAgICAgICAg
IGdvdG8gb3V0OwotICAgIH0KLQotICAgIC8qCi0gICAgICogSWYgc29mdF9yZXNldCBpcyBzZXQg
dGhlIHRoZSBkb21pZCB3aWxsIGhhdmUgYmVlbiB2YWxpZCBvbiBlbnRyeS4KLSAgICAgKiBJZiBp
dCB3YXMgbm90IHNldCB0aGVuIHhjX2RvbWFpbl9jcmVhdGUoKSBzaG91bGQgaGF2ZSBhc3NpZ25l
ZCBhCi0gICAgICogdmFsaWQgdmFsdWUuIEVpdGhlciB3YXksIGlmIHdlIHJlYWNoIHRoaXMgcG9p
bnQsIGRvbWlkIHNob3VsZCBiZQotICAgICAqIHZhbGlkLgotICAgICAqLwotICAgIGFzc2VydChs
aWJ4bF9kb21pZF92YWxpZF9ndWVzdCgqZG9taWQpKTsKLQotICAgIHJldCA9IHhjX2NwdXBvb2xf
bW92ZWRvbWFpbihjdHgtPnhjaCwgaW5mby0+cG9vbGlkLCAqZG9taWQpOwotICAgIGlmIChyZXQg
PCAwKSB7Ci0gICAgICAgIExPR0VEKEVSUk9SLCAqZG9taWQsICJkb21haW4gbW92ZSBmYWlsIik7
Ci0gICAgICAgIHJjID0gRVJST1JfRkFJTDsKLSAgICAgICAgZ290byBvdXQ7Ci0gICAgfQotCi0g
ICAgZG9tX3BhdGggPSBsaWJ4bF9feHNfZ2V0X2RvbXBhdGgoZ2MsICpkb21pZCk7CisgICAgZG9t
X3BhdGggPSBsaWJ4bF9feHNfZ2V0X2RvbXBhdGgoZ2MsIGRvbWlkKTsKICAgICBpZiAoIWRvbV9w
YXRoKSB7CiAgICAgICAgIHJjID0gRVJST1JfRkFJTDsKICAgICAgICAgZ290byBvdXQ7CkBAIC03
MDEsMTIgKzU2OCwxMiBAQCBpbnQgbGlieGxfX2RvbWFpbl9tYWtlKGxpYnhsX19nYyAqZ2MsIGxp
YnhsX2RvbWFpbl9jb25maWcgKmRfY29uZmlnLAogCiAgICAgdm1fcGF0aCA9IEdDU1BSSU5URigi
L3ZtLyVzIiwgdXVpZF9zdHJpbmcpOwogICAgIGlmICghdm1fcGF0aCkgewotICAgICAgICBMT0dE
KEVSUk9SLCAqZG9taWQsICJjYW5ub3QgYWxsb2NhdGUgY3JlYXRlIHBhdGhzIik7CisgICAgICAg
IExPR0QoRVJST1IsIGRvbWlkLCAiY2Fubm90IGFsbG9jYXRlIGNyZWF0ZSBwYXRocyIpOwogICAg
ICAgICByYyA9IEVSUk9SX0ZBSUw7CiAgICAgICAgIGdvdG8gb3V0OwogICAgIH0KIAotICAgIGxp
YnhsX3BhdGggPSBsaWJ4bF9feHNfbGlieGxfcGF0aChnYywgKmRvbWlkKTsKKyAgICBsaWJ4bF9w
YXRoID0gbGlieGxfX3hzX2xpYnhsX3BhdGgoZ2MsIGRvbWlkKTsKICAgICBpZiAoIWxpYnhsX3Bh
dGgpIHsKICAgICAgICAgcmMgPSBFUlJPUl9GQUlMOwogICAgICAgICBnb3RvIG91dDsKQEAgLTcx
NywxMCArNTg0LDEwIEBAIGludCBsaWJ4bF9fZG9tYWluX21ha2UobGlieGxfX2djICpnYywgbGli
eGxfZG9tYWluX2NvbmZpZyAqZF9jb25maWcsCiAKICAgICByb3Blcm1bMF0uaWQgPSAwOwogICAg
IHJvcGVybVswXS5wZXJtcyA9IFhTX1BFUk1fTk9ORTsKLSAgICByb3Blcm1bMV0uaWQgPSAqZG9t
aWQ7CisgICAgcm9wZXJtWzFdLmlkID0gZG9taWQ7CiAgICAgcm9wZXJtWzFdLnBlcm1zID0gWFNf
UEVSTV9SRUFEOwogCi0gICAgcndwZXJtWzBdLmlkID0gKmRvbWlkOworICAgIHJ3cGVybVswXS5p
ZCA9IGRvbWlkOwogICAgIHJ3cGVybVswXS5wZXJtcyA9IFhTX1BFUk1fTk9ORTsKIAogcmV0cnlf
dHJhbnNhY3Rpb246CkBAIC03MzgsNyArNjA1LDcgQEAgcmV0cnlfdHJhbnNhY3Rpb246CiAgICAg
ICAgICAgICAgICAgICAgIG5vcGVybSwgQVJSQVlfU0laRShub3Blcm0pKTsKIAogICAgIHhzX3dy
aXRlKGN0eC0+eHNoLCB0LCBHQ1NQUklOVEYoIiVzL3ZtIiwgZG9tX3BhdGgpLCB2bV9wYXRoLCBz
dHJsZW4odm1fcGF0aCkpOwotICAgIHJjID0gbGlieGxfX2RvbWFpbl9yZW5hbWUoZ2MsICpkb21p
ZCwgMCwgaW5mby0+bmFtZSwgdCk7CisgICAgcmMgPSBsaWJ4bF9fZG9tYWluX3JlbmFtZShnYywg
ZG9taWQsIDAsIGluZm8tPm5hbWUsIHQpOwogICAgIGlmIChyYykKICAgICAgICAgZ290byBvdXQ7
CiAKQEAgLTgxNSw3ICs2ODIsNyBAQCByZXRyeV90cmFuc2FjdGlvbjoKIAogICAgIHZtX2xpc3Qg
PSBsaWJ4bF9saXN0X3ZtKGN0eCwgJm5iX3ZtKTsKICAgICBpZiAoIXZtX2xpc3QpIHsKLSAgICAg
ICAgTE9HRChFUlJPUiwgKmRvbWlkLCAiY2Fubm90IGdldCBudW1iZXIgb2YgcnVubmluZyBndWVz
dHMiKTsKKyAgICAgICAgTE9HRChFUlJPUiwgZG9taWQsICJjYW5ub3QgZ2V0IG51bWJlciBvZiBy
dW5uaW5nIGd1ZXN0cyIpOwogICAgICAgICByYyA9IEVSUk9SX0ZBSUw7CiAgICAgICAgIGdvdG8g
b3V0OwogICAgIH0KQEAgLTgzOSw3ICs3MDYsNyBAQCByZXRyeV90cmFuc2FjdGlvbjoKICAgICAg
ICAgICAgIHQgPSAwOwogICAgICAgICAgICAgZ290byByZXRyeV90cmFuc2FjdGlvbjsKICAgICAg
ICAgfQotICAgICAgICBMT0dFRChFUlJPUiwgKmRvbWlkLCAiZG9tYWluIGNyZWF0aW9uICIieGVu
c3RvcmUgdHJhbnNhY3Rpb24gY29tbWl0IGZhaWxlZCIpOworICAgICAgICBMT0dFRChFUlJPUiwg
ZG9taWQsICJkb21haW4gY3JlYXRpb24gIiJ4ZW5zdG9yZSB0cmFuc2FjdGlvbiBjb21taXQgZmFp
bGVkIik7CiAgICAgICAgIHJjID0gRVJST1JfRkFJTDsKICAgICAgICAgZ290byBvdXQ7CiAgICAg
fQpAQCAtODUxLDYgKzcxOCwxNTUgQEAgcmV0cnlfdHJhbnNhY3Rpb246CiAgICAgcmV0dXJuIHJj
OwogfQogCitpbnQgbGlieGxfX2RvbWFpbl9tYWtlKGxpYnhsX19nYyAqZ2MsIGxpYnhsX2RvbWFp
bl9jb25maWcgKmRfY29uZmlnLAorICAgICAgICAgICAgICAgICAgICAgICBsaWJ4bF9fZG9tYWlu
X2J1aWxkX3N0YXRlICpzdGF0ZSwKKyAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgKmRv
bWlkLCBib29sIHNvZnRfcmVzZXQpCit7CisgICAgbGlieGxfY3R4ICpjdHggPSBsaWJ4bF9fZ2Nf
b3duZXIoZ2MpOworICAgIGludCByZXQsIHJjOworCisgICAgLyogY29udmVuaWVuY2UgYWxpYXNl
cyAqLworICAgIGxpYnhsX2RvbWFpbl9jcmVhdGVfaW5mbyAqaW5mbyA9ICZkX2NvbmZpZy0+Y19p
bmZvOworICAgIGxpYnhsX2RvbWFpbl9idWlsZF9pbmZvICpiX2luZm8gPSAmZF9jb25maWctPmJf
aW5mbzsKKworICAgIGFzc2VydChzb2Z0X3Jlc2V0IHx8ICpkb21pZCA9PSBJTlZBTElEX0RPTUlE
KTsKKworICAgIGlmICghc29mdF9yZXNldCkgeworICAgICAgICBzdHJ1Y3QgeGVuX2RvbWN0bF9j
cmVhdGVkb21haW4gY3JlYXRlID0geworICAgICAgICAgICAgLnNzaWRyZWYgPSBpbmZvLT5zc2lk
cmVmLAorICAgICAgICAgICAgLm1heF92Y3B1cyA9IGJfaW5mby0+bWF4X3ZjcHVzLAorICAgICAg
ICAgICAgLm1heF9ldnRjaG5fcG9ydCA9IGJfaW5mby0+ZXZlbnRfY2hhbm5lbHMsCisgICAgICAg
ICAgICAubWF4X2dyYW50X2ZyYW1lcyA9IGJfaW5mby0+bWF4X2dyYW50X2ZyYW1lcywKKyAgICAg
ICAgICAgIC5tYXhfbWFwdHJhY2tfZnJhbWVzID0gYl9pbmZvLT5tYXhfbWFwdHJhY2tfZnJhbWVz
LAorICAgICAgICB9OworCisgICAgICAgIGlmIChpbmZvLT50eXBlICE9IExJQlhMX0RPTUFJTl9U
WVBFX1BWKSB7CisgICAgICAgICAgICBjcmVhdGUuZmxhZ3MgfD0gWEVOX0RPTUNUTF9DREZfaHZt
OworICAgICAgICAgICAgY3JlYXRlLmZsYWdzIHw9CisgICAgICAgICAgICAgICAgbGlieGxfZGVm
Ym9vbF92YWwoaW5mby0+aGFwKSA/IFhFTl9ET01DVExfQ0RGX2hhcCA6IDA7CisgICAgICAgICAg
ICBjcmVhdGUuZmxhZ3MgfD0KKyAgICAgICAgICAgICAgICBsaWJ4bF9kZWZib29sX3ZhbChpbmZv
LT5vb3MpID8gMCA6IFhFTl9ET01DVExfQ0RGX29vc19vZmY7CisgICAgICAgIH0KKworICAgICAg
ICBhc3NlcnQoaW5mby0+cGFzc3Rocm91Z2ggIT0gTElCWExfUEFTU1RIUk9VR0hfREVGQVVMVCk7
CisgICAgICAgIExPRyhERVRBSUwsICJwYXNzdGhyb3VnaDogJXMiLAorICAgICAgICAgICAgbGli
eGxfcGFzc3Rocm91Z2hfdG9fc3RyaW5nKGluZm8tPnBhc3N0aHJvdWdoKSk7CisKKyAgICAgICAg
aWYgKGluZm8tPnBhc3N0aHJvdWdoICE9IExJQlhMX1BBU1NUSFJPVUdIX0RJU0FCTEVEKQorICAg
ICAgICAgICAgY3JlYXRlLmZsYWdzIHw9IFhFTl9ET01DVExfQ0RGX2lvbW11OworCisgICAgICAg
IGlmIChpbmZvLT5wYXNzdGhyb3VnaCA9PSBMSUJYTF9QQVNTVEhST1VHSF9TWU5DX1BUKQorICAg
ICAgICAgICAgY3JlYXRlLmlvbW11X29wdHMgfD0gWEVOX0RPTUNUTF9JT01NVV9ub19zaGFyZXB0
OworCisgICAgICAgIC8qIFVsdGltYXRlbHksIGhhbmRsZSBpcyBhbiBhcnJheSBvZiAxNiB1aW50
OF90LCBzYW1lIGFzIHV1aWQgKi8KKyAgICAgICAgbGlieGxfdXVpZF9jb3B5KGN0eCwgKGxpYnhs
X3V1aWQgKikmY3JlYXRlLmhhbmRsZSwgJmluZm8tPnV1aWQpOworCisgICAgICAgIHJldCA9IGxp
YnhsX19hcmNoX2RvbWFpbl9wcmVwYXJlX2NvbmZpZyhnYywgZF9jb25maWcsICZjcmVhdGUpOwor
ICAgICAgICBpZiAocmV0IDwgMCkgeworICAgICAgICAgICAgTE9HRUQoRVJST1IsICpkb21pZCwg
ImZhaWwgdG8gZ2V0IGRvbWFpbiBjb25maWciKTsKKyAgICAgICAgICAgIHJjID0gRVJST1JfRkFJ
TDsKKyAgICAgICAgICAgIGdvdG8gb3V0OworICAgICAgICB9CisKKyAgICAgICAgZm9yICg7Oykg
eworICAgICAgICAgICAgdWludDMyX3QgbG9jYWxfZG9taWQ7CisgICAgICAgICAgICBib29sIHJl
Y2VudDsKKworICAgICAgICAgICAgaWYgKGluZm8tPmRvbWlkID09IFJBTkRPTV9ET01JRCkgewor
ICAgICAgICAgICAgICAgIHVpbnQxNl90IHY7CisKKyAgICAgICAgICAgICAgICByZXQgPSBsaWJ4
bF9fcmFuZG9tX2J5dGVzKGdjLCAodm9pZCAqKSZ2LCBzaXplb2YodikpOworICAgICAgICAgICAg
ICAgIGlmIChyZXQgPCAwKQorICAgICAgICAgICAgICAgICAgICBicmVhazsKKworICAgICAgICAg
ICAgICAgIHYgJj0gRE9NSURfTUFTSzsKKyAgICAgICAgICAgICAgICBpZiAoIWxpYnhsX2RvbWlk
X3ZhbGlkX2d1ZXN0KHYpKQorICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKKworICAgICAg
ICAgICAgICAgIGxvY2FsX2RvbWlkID0gdjsKKyAgICAgICAgICAgIH0gZWxzZSB7CisgICAgICAg
ICAgICAgICAgbG9jYWxfZG9taWQgPSBpbmZvLT5kb21pZDsgLyogTWF5IG5vdCBiZSB2YWxpZCAq
LworICAgICAgICAgICAgfQorCisgICAgICAgICAgICByZXQgPSB4Y19kb21haW5fY3JlYXRlKGN0
eC0+eGNoLCAmbG9jYWxfZG9taWQsICZjcmVhdGUpOworICAgICAgICAgICAgaWYgKHJldCA8IDAp
IHsKKyAgICAgICAgICAgICAgICAvKgorICAgICAgICAgICAgICAgICAqIElmIHdlIGdlbmVyYXRl
ZCBhIHJhbmRvbSBkb21pZCBhbmQgY3JlYXRpb24gZmFpbGVkCisgICAgICAgICAgICAgICAgICog
YmVjYXVzZSB0aGF0IGRvbWlkIGFscmVhZHkgZXhpc3RzIHRoZW4gc2ltcGx5IHRyeQorICAgICAg
ICAgICAgICAgICAqIGFnYWluLgorICAgICAgICAgICAgICAgICAqLworICAgICAgICAgICAgICAg
IGlmIChlcnJubyA9PSBFRVhJU1QgJiYgaW5mby0+ZG9taWQgPT0gUkFORE9NX0RPTUlEKQorICAg
ICAgICAgICAgICAgICAgICBjb250aW51ZTsKKworICAgICAgICAgICAgICAgIExPR0VEKEVSUk9S
LCBsb2NhbF9kb21pZCwgImRvbWFpbiBjcmVhdGlvbiBmYWlsIik7CisgICAgICAgICAgICAgICAg
cmMgPSBFUlJPUl9GQUlMOworICAgICAgICAgICAgICAgIGdvdG8gb3V0OworICAgICAgICAgICAg
fQorCisgICAgICAgICAgICAvKiBBIG5ldyBkb21haW4gbm93IGV4aXN0cyAqLworICAgICAgICAg
ICAgKmRvbWlkID0gbG9jYWxfZG9taWQ7CisKKyAgICAgICAgICAgIHJjID0gbGlieGxfX2lzX2Rv
bWlkX3JlY2VudChnYywgbG9jYWxfZG9taWQsICZyZWNlbnQpOworICAgICAgICAgICAgaWYgKHJj
KQorICAgICAgICAgICAgICAgIGdvdG8gb3V0OworCisgICAgICAgICAgICAvKiBUaGUgZG9taWQg
aXMgbm90IHJlY2VudCwgc28gd2UncmUgZG9uZSAqLworICAgICAgICAgICAgaWYgKCFyZWNlbnQp
CisgICAgICAgICAgICAgICAgYnJlYWs7CisKKyAgICAgICAgICAgIC8qCisgICAgICAgICAgICAg
KiBJZiB0aGUgZG9taWQgd2FzIHNwZWNpZmllZCB0aGVuIHRoZXJlJ3Mgbm8gcG9pbnQgaW4KKyAg
ICAgICAgICAgICAqIHRyeWluZyBhZ2Fpbi4KKyAgICAgICAgICAgICAqLworICAgICAgICAgICAg
aWYgKGxpYnhsX2RvbWlkX3ZhbGlkX2d1ZXN0KGluZm8tPmRvbWlkKSkgeworICAgICAgICAgICAg
ICAgIExPR0VEKEVSUk9SLCBsb2NhbF9kb21pZCwgImRvbWFpbiBpZCByZWNlbnRseSB1c2VkIik7
CisgICAgICAgICAgICAgICAgcmMgPSBFUlJPUl9GQUlMOworICAgICAgICAgICAgICAgIGdvdG8g
b3V0OworICAgICAgICAgICAgfQorCisgICAgICAgICAgICAvKgorICAgICAgICAgICAgICogVGhl
IGRvbWFpbiBpcyByZWNlbnQgYW5kIHNvIGNhbm5vdCBiZSB1c2VkLiBDbGVhciBkb21pZAorICAg
ICAgICAgICAgICogaGVyZSBzaW5jZSwgaWYgeGNfZG9tYWluX2Rlc3Ryb3koKSBmYWlscyBiZWxv
dyB0aGVyZSBpcworICAgICAgICAgICAgICogbGl0dGxlIHBvaW50IGNhbGxpbmcgaXQgYWdhaW4g
aW4gdGhlIGVycm9yIHBhdGguCisgICAgICAgICAgICAgKi8KKyAgICAgICAgICAgICpkb21pZCA9
IElOVkFMSURfRE9NSUQ7CisKKyAgICAgICAgICAgIHJldCA9IHhjX2RvbWFpbl9kZXN0cm95KGN0
eC0+eGNoLCBsb2NhbF9kb21pZCk7CisgICAgICAgICAgICBpZiAocmV0IDwgMCkgeworICAgICAg
ICAgICAgICAgIExPR0VEKEVSUk9SLCBsb2NhbF9kb21pZCwgImRvbWFpbiBkZXN0cm95IGZhaWwi
KTsKKyAgICAgICAgICAgICAgICByYyA9IEVSUk9SX0ZBSUw7CisgICAgICAgICAgICAgICAgZ290
byBvdXQ7CisgICAgICAgICAgICB9CisKKyAgICAgICAgICAgIC8qIFRoZSBkb21haW4gd2FzIHN1
Y2Nlc3NmdWxseSBkZXN0cm95ZWQsIHNvIHdlIGNhbiB0cnkgYWdhaW4gKi8KKyAgICAgICAgfQor
CisgICAgICAgIHJjID0gbGlieGxfX2FyY2hfZG9tYWluX3NhdmVfY29uZmlnKGdjLCBkX2NvbmZp
Zywgc3RhdGUsICZjcmVhdGUpOworICAgICAgICBpZiAocmMgPCAwKQorICAgICAgICAgICAgZ290
byBvdXQ7CisgICAgfQorCisgICAgLyoKKyAgICAgKiBJZiBzb2Z0X3Jlc2V0IGlzIHNldCB0aGUg
dGhlIGRvbWlkIHdpbGwgaGF2ZSBiZWVuIHZhbGlkIG9uIGVudHJ5LgorICAgICAqIElmIGl0IHdh
cyBub3Qgc2V0IHRoZW4geGNfZG9tYWluX2NyZWF0ZSgpIHNob3VsZCBoYXZlIGFzc2lnbmVkIGEK
KyAgICAgKiB2YWxpZCB2YWx1ZS4gRWl0aGVyIHdheSwgaWYgd2UgcmVhY2ggdGhpcyBwb2ludCwg
ZG9taWQgc2hvdWxkIGJlCisgICAgICogdmFsaWQuCisgICAgICovCisgICAgYXNzZXJ0KGxpYnhs
X2RvbWlkX3ZhbGlkX2d1ZXN0KCpkb21pZCkpOworCisgICAgcmV0ID0geGNfY3B1cG9vbF9tb3Zl
ZG9tYWluKGN0eC0+eGNoLCBpbmZvLT5wb29saWQsICpkb21pZCk7CisgICAgaWYgKHJldCA8IDAp
IHsKKyAgICAgICAgTE9HRUQoRVJST1IsICpkb21pZCwgImRvbWFpbiBtb3ZlIGZhaWwiKTsKKyAg
ICAgICAgcmMgPSBFUlJPUl9GQUlMOworICAgICAgICBnb3RvIG91dDsKKyAgICB9CisKKyAgICBy
YyA9IGxpYnhsX19kb21haW5fbWFrZV94c19lbnRyaWVzKGdjLCBkX2NvbmZpZywgc3RhdGUsICpk
b21pZCk7CisKK291dDoKKyAgICByZXR1cm4gcmM7Cit9CisKIHN0YXRpYyBpbnQgc3RvcmVfbGli
eGxfZW50cnkobGlieGxfX2djICpnYywgdWludDMyX3QgZG9taWQsCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIGxpYnhsX2RvbWFpbl9idWlsZF9pbmZvICpiX2luZm8pCiB7CkBAIC0xMTcy
LDE2ICsxMTg4LDMyIEBAIHN0YXRpYyB2b2lkIGluaXRpYXRlX2RvbWFpbl9jcmVhdGUobGlieGxf
X2VnYyAqZWdjLAogICAgIHJldCA9IGxpYnhsX19kb21haW5fY29uZmlnX3NldGRlZmF1bHQoZ2Ms
ZF9jb25maWcsZG9taWQpOwogICAgIGlmIChyZXQpIGdvdG8gZXJyb3Jfb3V0OwogCi0gICAgcmV0
ID0gbGlieGxfX2RvbWFpbl9tYWtlKGdjLCBkX2NvbmZpZywgJmRjcy0+YnVpbGRfc3RhdGUsICZk
b21pZCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGNzLT5zb2Z0X3Jlc2V0KTsKLSAg
ICBpZiAocmV0KSB7Ci0gICAgICAgIExPR0QoRVJST1IsIGRvbWlkLCAiY2Fubm90IG1ha2UgZG9t
YWluOiAlZCIsIHJldCk7CisgICAgaWYgKCAhZF9jb25maWctPmRtX3Jlc3RvcmVfZmlsZSApCisg
ICAgeworICAgICAgICByZXQgPSBsaWJ4bF9fZG9tYWluX21ha2UoZ2MsIGRfY29uZmlnLCAmZGNz
LT5idWlsZF9zdGF0ZSwgJmRvbWlkLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ZGNzLT5zb2Z0X3Jlc2V0KTsKICAgICAgICAgZGNzLT5ndWVzdF9kb21pZCA9IGRvbWlkOworCisg
ICAgICAgIGlmIChyZXQpIHsKKyAgICAgICAgICAgIExPR0QoRVJST1IsIGRvbWlkLCAiY2Fubm90
IG1ha2UgZG9tYWluOiAlZCIsIHJldCk7CisgICAgICAgICAgICByZXQgPSBFUlJPUl9GQUlMOwor
ICAgICAgICAgICAgZ290byBlcnJvcl9vdXQ7CisgICAgICAgIH0KKyAgICB9IGVsc2UgaWYgKCBk
Y3MtPmd1ZXN0X2RvbWlkICE9IElOVkFMSURfRE9NSUQgKSB7CisgICAgICAgIGRvbWlkID0gZGNz
LT5ndWVzdF9kb21pZDsKKworICAgICAgICByZXQgPSBsaWJ4bF9fZG9tYWluX21ha2VfeHNfZW50
cmllcyhnYywgZF9jb25maWcsICZkY3MtPmJ1aWxkX3N0YXRlLCBkb21pZCk7CisgICAgICAgIGlm
IChyZXQpIHsKKyAgICAgICAgICAgIExPR0QoRVJST1IsIGRvbWlkLCAiY2Fubm90IG1ha2UgZG9t
YWluOiAlZCIsIHJldCk7CisgICAgICAgICAgICByZXQgPSBFUlJPUl9GQUlMOworICAgICAgICAg
ICAgZ290byBlcnJvcl9vdXQ7CisgICAgICAgIH0KKyAgICB9IGVsc2UgeworICAgICAgICBMT0dE
KEVSUk9SLCBkb21pZCwgImNhbm5vdCBtYWtlIGRvbWFpbiIpOwogICAgICAgICByZXQgPSBFUlJP
Ul9GQUlMOwogICAgICAgICBnb3RvIGVycm9yX291dDsKICAgICB9CiAKLSAgICBkY3MtPmd1ZXN0
X2RvbWlkID0gZG9taWQ7CiAgICAgZGNzLT5zZHNzLmRtLmd1ZXN0X2RvbWlkID0gMDsgLyogbWVh
bnMgd2UgaGF2ZW4ndCBzcGF3bmVkICovCiAKICAgICAvKiBwb3N0LTQuMTMgdG9kbzogbW92ZSB0
aGVzZSBuZXh0IGJpdHMgb2YgZGVmYXVsdGluZyB0bwpAQCAtMTIxNyw3ICsxMjQ5LDcgQEAgc3Rh
dGljIHZvaWQgaW5pdGlhdGVfZG9tYWluX2NyZWF0ZShsaWJ4bF9fZWdjICplZ2MsCiAgICAgaWYg
KHJldCkKICAgICAgICAgZ290byBlcnJvcl9vdXQ7CiAKLSAgICBpZiAocmVzdG9yZV9mZCA+PSAw
IHx8IGRjcy0+c29mdF9yZXNldCkgeworICAgIGlmIChyZXN0b3JlX2ZkID49IDAgfHwgZGNzLT5z
b2Z0X3Jlc2V0IHx8IGRfY29uZmlnLT5kbV9yZXN0b3JlX2ZpbGUpIHsKICAgICAgICAgTE9HRChE
RUJVRywgZG9taWQsICJyZXN0b3JpbmcsIG5vdCBydW5uaW5nIGJvb3Rsb2FkZXIiKTsKICAgICAg
ICAgZG9tY3JlYXRlX2Jvb3Rsb2FkZXJfZG9uZShlZ2MsICZkY3MtPmJsLCAwKTsKICAgICB9IGVs
c2UgIHsKQEAgLTEyOTMsNyArMTMyNSwxNiBAQCBzdGF0aWMgdm9pZCBkb21jcmVhdGVfYm9vdGxv
YWRlcl9kb25lKGxpYnhsX19lZ2MgKmVnYywKICAgICBkY3MtPnNkc3MuZG0uY2FsbGJhY2sgPSBk
b21jcmVhdGVfZGV2bW9kZWxfc3RhcnRlZDsKICAgICBkY3MtPnNkc3MuY2FsbGJhY2sgPSBkb21j
cmVhdGVfZGV2bW9kZWxfc3RhcnRlZDsKIAotICAgIGlmIChyZXN0b3JlX2ZkIDwgMCAmJiAhZGNz
LT5zb2Z0X3Jlc2V0KSB7CisgICAgaWYgKHJlc3RvcmVfZmQgPCAwICYmICFkY3MtPnNvZnRfcmVz
ZXQgJiYgIWRfY29uZmlnLT5kbV9yZXN0b3JlX2ZpbGUpIHsKKyAgICAgICAgcmMgPSBsaWJ4bF9f
ZG9tYWluX2J1aWxkKGdjLCBkX2NvbmZpZywgZG9taWQsIHN0YXRlKTsKKyAgICAgICAgZG9tY3Jl
YXRlX3JlYnVpbGRfZG9uZShlZ2MsIGRjcywgcmMpOworICAgICAgICByZXR1cm47CisgICAgfQor
CisgICAgaWYgKCBkX2NvbmZpZy0+ZG1fcmVzdG9yZV9maWxlICkgeworICAgICAgICBkY3MtPnNy
cy5kY3MgPSBkY3M7CisgICAgICAgIGRjcy0+c3JzLmFvID0gYW87CisgICAgICAgIHN0YXRlLT5m
b3JrZWRfdm0gPSB0cnVlOwogICAgICAgICByYyA9IGxpYnhsX19kb21haW5fYnVpbGQoZ2MsIGRf
Y29uZmlnLCBkb21pZCwgc3RhdGUpOwogICAgICAgICBkb21jcmVhdGVfcmVidWlsZF9kb25lKGVn
YywgZGNzLCByYyk7CiAgICAgICAgIHJldHVybjsKQEAgLTE0OTEsNiArMTUzMiw3IEBAIHN0YXRp
YyB2b2lkIGRvbWNyZWF0ZV9yZWJ1aWxkX2RvbmUobGlieGxfX2VnYyAqZWdjLAogICAgIC8qIGNv
bnZlbmllbmNlIGFsaWFzZXMgKi8KICAgICBjb25zdCB1aW50MzJfdCBkb21pZCA9IGRjcy0+Z3Vl
c3RfZG9taWQ7CiAgICAgbGlieGxfZG9tYWluX2NvbmZpZyAqY29uc3QgZF9jb25maWcgPSBkY3Mt
Pmd1ZXN0X2NvbmZpZzsKKyAgICBsaWJ4bF9fZG9tYWluX2J1aWxkX3N0YXRlICpjb25zdCBzdGF0
ZSA9ICZkY3MtPmJ1aWxkX3N0YXRlOwogCiAgICAgaWYgKHJldCkgewogICAgICAgICBMT0dEKEVS
Uk9SLCBkb21pZCwgImNhbm5vdCAocmUtKWJ1aWxkIGRvbWFpbjogJWQiLCByZXQpOwpAQCAtMTQ5
OCw2ICsxNTQwLDkgQEAgc3RhdGljIHZvaWQgZG9tY3JlYXRlX3JlYnVpbGRfZG9uZShsaWJ4bF9f
ZWdjICplZ2MsCiAgICAgICAgIGdvdG8gZXJyb3Jfb3V0OwogICAgIH0KIAorICAgIGlmICggZF9j
b25maWctPmRtX3Jlc3RvcmVfZmlsZSApCisgICAgICAgIHN0YXRlLT5zYXZlZF9zdGF0ZSA9IEdD
U1BSSU5URigiJXMiLCBkX2NvbmZpZy0+ZG1fcmVzdG9yZV9maWxlKTsKKwogICAgIHN0b3JlX2xp
YnhsX2VudHJ5KGdjLCBkb21pZCwgJmRfY29uZmlnLT5iX2luZm8pOwogCiAgICAgbGlieGxfX211
bHRpZGV2X2JlZ2luKGFvLCAmZGNzLT5tdWx0aWRldik7CkBAIC0xODg2LDcgKzE5MzEsNyBAQCBz
dGF0aWMgdm9pZCBkb21haW5fY3JlYXRlX2NiKGxpYnhsX19lZ2MgKmVnYywKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgbGlieGxfX2RvbWFpbl9jcmVhdGVfc3RhdGUgKmRjcywKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgaW50IHJjLCB1aW50MzJfdCBkb21pZCk7CiAKLXN0YXRp
YyBpbnQgZG9fZG9tYWluX2NyZWF0ZShsaWJ4bF9jdHggKmN0eCwgbGlieGxfZG9tYWluX2NvbmZp
ZyAqZF9jb25maWcsCitpbnQgbGlieGxfX2RvX2RvbWFpbl9jcmVhdGUobGlieGxfY3R4ICpjdHgs
IGxpYnhsX2RvbWFpbl9jb25maWcgKmRfY29uZmlnLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHVpbnQzMl90ICpkb21pZCwgaW50IHJlc3RvcmVfZmQsIGludCBzZW5kX2JhY2tfZmQsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGlieGxfZG9tYWluX3Jlc3RvcmVfcGFy
YW1zICpwYXJhbXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGlieGxfYXN5
bmNvcF9ob3cgKmFvX2hvdywKQEAgLTE4OTksNiArMTk0NCw4IEBAIHN0YXRpYyBpbnQgZG9fZG9t
YWluX2NyZWF0ZShsaWJ4bF9jdHggKmN0eCwgbGlieGxfZG9tYWluX2NvbmZpZyAqZF9jb25maWcs
CiAgICAgR0NORVcoY2Rjcyk7CiAgICAgY2Rjcy0+ZGNzLmFvID0gYW87CiAgICAgY2Rjcy0+ZGNz
Lmd1ZXN0X2NvbmZpZyA9IGRfY29uZmlnOworICAgIGNkY3MtPmRjcy5ndWVzdF9kb21pZCA9ICpk
b21pZDsKKwogICAgIGxpYnhsX2RvbWFpbl9jb25maWdfaW5pdCgmY2Rjcy0+ZGNzLmd1ZXN0X2Nv
bmZpZ19zYXZlZCk7CiAgICAgbGlieGxfZG9tYWluX2NvbmZpZ19jb3B5KGN0eCwgJmNkY3MtPmRj
cy5ndWVzdF9jb25maWdfc2F2ZWQsIGRfY29uZmlnKTsKICAgICBjZGNzLT5kY3MucmVzdG9yZV9m
ZCA9IGNkY3MtPmRjcy5saWJ4Y19mZCA9IHJlc3RvcmVfZmQ7CkBAIC0yMTQzLDggKzIxOTAsOCBA
QCBpbnQgbGlieGxfZG9tYWluX2NyZWF0ZV9uZXcobGlieGxfY3R4ICpjdHgsIGxpYnhsX2RvbWFp
bl9jb25maWcgKmRfY29uZmlnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxp
YnhsX2FzeW5jcHJvZ3Jlc3NfaG93ICphb3BfY29uc29sZV9ob3cpCiB7CiAgICAgdW5zZXRfZGlz
a19jb2xvX3Jlc3RvcmUoZF9jb25maWcpOwotICAgIHJldHVybiBkb19kb21haW5fY3JlYXRlKGN0
eCwgZF9jb25maWcsIGRvbWlkLCAtMSwgLTEsIE5VTEwsCi0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgYW9faG93LCBhb3BfY29uc29sZV9ob3cpOworICAgIHJldHVybiBsaWJ4bF9fZG9fZG9t
YWluX2NyZWF0ZShjdHgsIGRfY29uZmlnLCBkb21pZCwgLTEsIC0xLCBOVUxMLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGFvX2hvdywgYW9wX2NvbnNvbGVfaG93KTsKIH0KIAog
aW50IGxpYnhsX2RvbWFpbl9jcmVhdGVfcmVzdG9yZShsaWJ4bF9jdHggKmN0eCwgbGlieGxfZG9t
YWluX2NvbmZpZyAqZF9jb25maWcsCkBAIC0yMTYwLDggKzIyMDcsOCBAQCBpbnQgbGlieGxfZG9t
YWluX2NyZWF0ZV9yZXN0b3JlKGxpYnhsX2N0eCAqY3R4LCBsaWJ4bF9kb21haW5fY29uZmlnICpk
X2NvbmZpZywKICAgICAgICAgdW5zZXRfZGlza19jb2xvX3Jlc3RvcmUoZF9jb25maWcpOwogICAg
IH0KIAotICAgIHJldHVybiBkb19kb21haW5fY3JlYXRlKGN0eCwgZF9jb25maWcsIGRvbWlkLCBy
ZXN0b3JlX2ZkLCBzZW5kX2JhY2tfZmQsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFy
YW1zLCBhb19ob3csIGFvcF9jb25zb2xlX2hvdyk7CisgICAgcmV0dXJuIGxpYnhsX19kb19kb21h
aW5fY3JlYXRlKGN0eCwgZF9jb25maWcsIGRvbWlkLCByZXN0b3JlX2ZkLCBzZW5kX2JhY2tfZmQs
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtcywgYW9faG93LCBhb3Bf
Y29uc29sZV9ob3cpOwogfQogCiBpbnQgbGlieGxfZG9tYWluX3NvZnRfcmVzZXQobGlieGxfY3R4
ICpjdHgsCmRpZmYgLS1naXQgYS90b29scy9saWJ4bC9saWJ4bF9kbS5jIGIvdG9vbHMvbGlieGwv
bGlieGxfZG0uYwppbmRleCAzYjFkYTkwMTY3Li44N2FlMTQ3OGNmIDEwMDY0NAotLS0gYS90b29s
cy9saWJ4bC9saWJ4bF9kbS5jCisrKyBiL3Rvb2xzL2xpYnhsL2xpYnhsX2RtLmMKQEAgLTI3ODcs
NyArMjc4Nyw3IEBAIHN0YXRpYyB2b2lkIGRldmljZV9tb2RlbF9zcGF3bl9vdXRjb21lKGxpYnhs
X19lZ2MgKmVnYywKIAogICAgIGxpYnhsX19kb21haW5fYnVpbGRfc3RhdGUgKnN0YXRlID0gZG1z
cy0+YnVpbGRfc3RhdGU7CiAKLSAgICBpZiAoc3RhdGUtPnNhdmVkX3N0YXRlKSB7CisgICAgaWYg
KHN0YXRlLT5zYXZlZF9zdGF0ZSAmJiAhc3RhdGUtPmZvcmtlZF92bSkgewogICAgICAgICByZXQy
ID0gdW5saW5rKHN0YXRlLT5zYXZlZF9zdGF0ZSk7CiAgICAgICAgIGlmIChyZXQyKSB7CiAgICAg
ICAgICAgICBMT0dFRChFUlJPUiwgZG1zcy0+Z3Vlc3RfZG9taWQsICIlczogZmFpbGVkIHRvIHJl
bW92ZSBkZXZpY2UtbW9kZWwgc3RhdGUgJXMiLApkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGli
eGxfZG9tLmMgYi90b29scy9saWJ4bC9saWJ4bF9kb20uYwppbmRleCA3MWNiNTc4OTIzLi4zYmM3
MTE3Yjk5IDEwMDY0NAotLS0gYS90b29scy9saWJ4bC9saWJ4bF9kb20uYworKysgYi90b29scy9s
aWJ4bC9saWJ4bF9kb20uYwpAQCAtMjQ5LDkgKzI0OSwxMiBAQCBpbnQgbGlieGxfX2J1aWxkX3By
ZShsaWJ4bF9fZ2MgKmdjLCB1aW50MzJfdCBkb21pZCwKICAgICBsaWJ4bF9kb21haW5fYnVpbGRf
aW5mbyAqY29uc3QgaW5mbyA9ICZkX2NvbmZpZy0+Yl9pbmZvOwogICAgIGxpYnhsX2N0eCAqY3R4
ID0gbGlieGxfX2djX293bmVyKGdjKTsKICAgICBjaGFyICp4c19kb21pZCwgKmNvbl9kb21pZDsK
LSAgICBpbnQgcmM7CisgICAgaW50IHJjID0gMDsKICAgICB1aW50NjRfdCBzaXplOwogCisgICAg
aWYgKCBzdGF0ZS0+Zm9ya2VkX3ZtICkKKyAgICAgICAgZ290byBza2lwX2Zvcms7CisKICAgICBp
ZiAoeGNfZG9tYWluX21heF92Y3B1cyhjdHgtPnhjaCwgZG9taWQsIGluZm8tPm1heF92Y3B1cykg
IT0gMCkgewogICAgICAgICBMT0coRVJST1IsICJDb3VsZG4ndCBzZXQgbWF4IHZjcHUgY291bnQi
KTsKICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUw7CkBAIC0zNjIsNyArMzY1LDYgQEAgaW50IGxp
YnhsX19idWlsZF9wcmUobGlieGxfX2djICpnYywgdWludDMyX3QgZG9taWQsCiAgICAgICAgIH0K
ICAgICB9CiAKLQogICAgIHJjID0gbGlieGxfX2FyY2hfZXh0cmFfbWVtb3J5KGdjLCBpbmZvLCAm
c2l6ZSk7CiAgICAgaWYgKHJjIDwgMCkgewogICAgICAgICBMT0dFKEVSUk9SLCAiQ291bGRuJ3Qg
Z2V0IGFyY2ggZXh0cmEgY29uc3RhbnQgbWVtb3J5IHNpemUiKTsKQEAgLTM3NCw2ICszNzYsMTEg
QEAgaW50IGxpYnhsX19idWlsZF9wcmUobGlieGxfX2djICpnYywgdWludDMyX3QgZG9taWQsCiAg
ICAgICAgIHJldHVybiBFUlJPUl9GQUlMOwogICAgIH0KIAorICAgIHJjID0gbGlieGxfX2FyY2hf
ZG9tYWluX2NyZWF0ZShnYywgZF9jb25maWcsIGRvbWlkKTsKKyAgICBpZiAoIHJjICkKKyAgICAg
ICAgZ290byBvdXQ7CisKK3NraXBfZm9yazoKICAgICB4c19kb21pZCA9IHhzX3JlYWQoY3R4LT54
c2gsIFhCVF9OVUxMLCAiL3Rvb2wveGVuc3RvcmVkL2RvbWlkIiwgTlVMTCk7CiAgICAgc3RhdGUt
PnN0b3JlX2RvbWlkID0geHNfZG9taWQgPyBhdG9pKHhzX2RvbWlkKSA6IDA7CiAgICAgZnJlZSh4
c19kb21pZCk7CkBAIC0zODUsOCArMzkyLDcgQEAgaW50IGxpYnhsX19idWlsZF9wcmUobGlieGxf
X2djICpnYywgdWludDMyX3QgZG9taWQsCiAgICAgc3RhdGUtPnN0b3JlX3BvcnQgPSB4Y19ldnRj
aG5fYWxsb2NfdW5ib3VuZChjdHgtPnhjaCwgZG9taWQsIHN0YXRlLT5zdG9yZV9kb21pZCk7CiAg
ICAgc3RhdGUtPmNvbnNvbGVfcG9ydCA9IHhjX2V2dGNobl9hbGxvY191bmJvdW5kKGN0eC0+eGNo
LCBkb21pZCwgc3RhdGUtPmNvbnNvbGVfZG9taWQpOwogCi0gICAgcmMgPSBsaWJ4bF9fYXJjaF9k
b21haW5fY3JlYXRlKGdjLCBkX2NvbmZpZywgZG9taWQpOwotCitvdXQ6CiAgICAgcmV0dXJuIHJj
OwogfQogCkBAIC00NDQsNiArNDUwLDkgQEAgaW50IGxpYnhsX19idWlsZF9wb3N0KGxpYnhsX19n
YyAqZ2MsIHVpbnQzMl90IGRvbWlkLAogICAgIGNoYXIgKiplbnRzOwogICAgIGludCBpLCByYzsK
IAorICAgIGlmICggc3RhdGUtPmZvcmtlZF92bSApCisgICAgICAgIGdvdG8gc2tpcF9mb3JrOwor
CiAgICAgaWYgKGluZm8tPm51bV92bnVtYV9ub2RlcyAmJiAhaW5mby0+bnVtX3ZjcHVfc29mdF9h
ZmZpbml0eSkgewogICAgICAgICByYyA9IHNldF92bnVtYV9hZmZpbml0eShnYywgZG9taWQsIGlu
Zm8pOwogICAgICAgICBpZiAocmMpCkBAIC00NjYsNiArNDc1LDcgQEAgaW50IGxpYnhsX19idWls
ZF9wb3N0KGxpYnhsX19nYyAqZ2MsIHVpbnQzMl90IGRvbWlkLAogICAgICAgICB9CiAgICAgfQog
Citza2lwX2Zvcms6CiAgICAgZW50cyA9IGxpYnhsX19jYWxsb2MoZ2MsIDEyICsgKGluZm8tPm1h
eF92Y3B1cyAqIDIpICsgMiwgc2l6ZW9mKGNoYXIgKikpOwogICAgIGVudHNbMF0gPSAibWVtb3J5
L3N0YXRpYy1tYXgiOwogICAgIGVudHNbMV0gPSBHQ1NQUklOVEYoIiUiUFJJZDY0LCBpbmZvLT5t
YXhfbWVta2IpOwpAQCAtNzI4LDE0ICs3MzgsMTYgQEAgc3RhdGljIGludCBodm1fYnVpbGRfc2V0
X3BhcmFtcyh4Y19pbnRlcmZhY2UgKmhhbmRsZSwgdWludDMyX3QgZG9taWQsCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGxpYnhsX2RvbWFpbl9idWlsZF9pbmZvICppbmZvLAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgc3RvcmVfZXZ0Y2huLCB1bnNpZ25lZCBs
b25nICpzdG9yZV9tZm4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBjb25z
b2xlX2V2dGNobiwgdW5zaWduZWQgbG9uZyAqY29uc29sZV9tZm4sCi0gICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGRvbWlkX3Qgc3RvcmVfZG9taWQsIGRvbWlkX3QgY29uc29sZV9kb21p
ZCkKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9taWRfdCBzdG9yZV9kb21pZCwg
ZG9taWRfdCBjb25zb2xlX2RvbWlkLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBi
b29sIGZvcmtlZF92bSkKIHsKICAgICBzdHJ1Y3QgaHZtX2luZm9fdGFibGUgKnZhX2h2bTsKICAg
ICB1aW50OF90ICp2YV9tYXAsIHN1bTsKICAgICB1aW50NjRfdCBzdHJfbWZuLCBjb25zX21mbjsK
ICAgICBpbnQgaTsKIAotICAgIGlmIChpbmZvLT50eXBlID09IExJQlhMX0RPTUFJTl9UWVBFX0hW
TSkgeworICAgIGlmICggaW5mby0+dHlwZSA9PSBMSUJYTF9ET01BSU5fVFlQRV9IVk0gJiYgIWZv
cmtlZF92bSApCisgICAgewogICAgICAgICB2YV9tYXAgPSB4Y19tYXBfZm9yZWlnbl9yYW5nZSho
YW5kbGUsIGRvbWlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBYQ19Q
QUdFX1NJWkUsIFBST1RfUkVBRCB8IFBST1RfV1JJVEUsCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIEhWTV9JTkZPX1BGTik7CkBAIC0xMDUxLDYgKzEwNjMsMjMgQEAgaW50
IGxpYnhsX19idWlsZF9odm0obGlieGxfX2djICpnYywgdWludDMyX3QgZG9taWQsCiAgICAgc3Ry
dWN0IHhjX2RvbV9pbWFnZSAqZG9tID0gTlVMTDsKICAgICBib29sIGRldmljZV9tb2RlbCA9IGlu
Zm8tPnR5cGUgPT0gTElCWExfRE9NQUlOX1RZUEVfSFZNID8gdHJ1ZSA6IGZhbHNlOwogCisgICAg
aWYgKCBzdGF0ZS0+Zm9ya2VkX3ZtICkKKyAgICB7CisgICAgICAgIHJjID0gaHZtX2J1aWxkX3Nl
dF9wYXJhbXMoY3R4LT54Y2gsIGRvbWlkLCBpbmZvLCBzdGF0ZS0+c3RvcmVfcG9ydCwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmc3RhdGUtPnN0b3JlX21mbiwgc3RhdGUtPmNv
bnNvbGVfcG9ydCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmc3RhdGUtPmNv
bnNvbGVfbWZuLCBzdGF0ZS0+c3RvcmVfZG9taWQsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgc3RhdGUtPmNvbnNvbGVfZG9taWQsIHN0YXRlLT5mb3JrZWRfdm0pOworCisgICAg
ICAgIGlmICggcmMgKQorICAgICAgICAgICAgcmV0dXJuIHJjOworCisgICAgICAgIHJldHVybiB4
Y19kb21fZ250dGFiX3NlZWQoY3R4LT54Y2gsIGRvbWlkLCB0cnVlLAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHN0YXRlLT5jb25zb2xlX21mbiwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBzdGF0ZS0+c3RvcmVfbWZuLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHN0YXRlLT5jb25zb2xlX2RvbWlkLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHN0YXRlLT5zdG9yZV9kb21pZCk7CisgICAgfQorCiAgICAgeGNfZG9tX2xv
Z2luaXQoY3R4LT54Y2gpOwogCiAgICAgLyoKQEAgLTExNzUsNyArMTIwNCw3IEBAIGludCBsaWJ4
bF9fYnVpbGRfaHZtKGxpYnhsX19nYyAqZ2MsIHVpbnQzMl90IGRvbWlkLAogICAgIHJjID0gaHZt
X2J1aWxkX3NldF9wYXJhbXMoY3R4LT54Y2gsIGRvbWlkLCBpbmZvLCBzdGF0ZS0+c3RvcmVfcG9y
dCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmc3RhdGUtPnN0b3JlX21mbiwgc3Rh
dGUtPmNvbnNvbGVfcG9ydCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmc3RhdGUt
PmNvbnNvbGVfbWZuLCBzdGF0ZS0+c3RvcmVfZG9taWQsCi0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgc3RhdGUtPmNvbnNvbGVfZG9taWQpOworICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHN0YXRlLT5jb25zb2xlX2RvbWlkLCBmYWxzZSk7CiAgICAgaWYgKHJjICE9IDApIHsK
ICAgICAgICAgTE9HKEVSUk9SLCAiaHZtIGJ1aWxkIHNldCBwYXJhbXMgZmFpbGVkIik7CiAgICAg
ICAgIGdvdG8gb3V0OwpkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGlieGxfaW50ZXJuYWwuaCBi
L3Rvb2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmgKaW5kZXggNDNlNTg4NWQxZS4uNmQxZTIwNTg5
ZCAxMDA2NDQKLS0tIGEvdG9vbHMvbGlieGwvbGlieGxfaW50ZXJuYWwuaAorKysgYi90b29scy9s
aWJ4bC9saWJ4bF9pbnRlcm5hbC5oCkBAIC0xMzc0LDYgKzEzNzQsNyBAQCB0eXBlZGVmIHN0cnVj
dCB7CiAKICAgICBjaGFyICpzYXZlZF9zdGF0ZTsKICAgICBpbnQgZG1fbW9uaXRvcl9mZDsKKyAg
ICBib29sIGZvcmtlZF92bTsKIAogICAgIGxpYnhsX19maWxlX3JlZmVyZW5jZSBwdl9rZXJuZWw7
CiAgICAgbGlieGxfX2ZpbGVfcmVmZXJlbmNlIHB2X3JhbWRpc2s7CkBAIC00ODEzLDYgKzQ4MTQs
MTIgQEAgX2hpZGRlbiBpbnQgbGlieGxfX2RvbWFpbl9wdmNvbnRyb2wobGlieGxfX2VnYyAqZWdj
LAogLyogQ2hlY2sgd2hldGhlciBhIGRvbWlkIGlzIHJlY2VudCAqLwogaW50IGxpYnhsX19pc19k
b21pZF9yZWNlbnQobGlieGxfX2djICpnYywgdWludDMyX3QgZG9taWQsIGJvb2wgKnJlY2VudCk7
CiAKK19oaWRkZW4gaW50IGxpYnhsX19kb19kb21haW5fY3JlYXRlKGxpYnhsX2N0eCAqY3R4LCBs
aWJ4bF9kb21haW5fY29uZmlnICpkX2NvbmZpZywKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHVpbnQzMl90ICpkb21pZCwgaW50IHJlc3RvcmVfZmQsIGludCBzZW5kX2JhY2tf
ZmQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsaWJ4bF9kb21h
aW5fcmVzdG9yZV9wYXJhbXMgKnBhcmFtcywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGNvbnN0IGxpYnhsX2FzeW5jb3BfaG93ICphb19ob3csCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBjb25zdCBsaWJ4bF9hc3luY3Byb2dyZXNzX2hvdyAqYW9wX2Nv
bnNvbGVfaG93KTsKKwogI2VuZGlmCiAKIC8qCmRpZmYgLS1naXQgYS90b29scy9saWJ4bC9saWJ4
bF90eXBlcy5pZGwgYi90b29scy9saWJ4bC9saWJ4bF90eXBlcy5pZGwKaW5kZXggZDBkNDMxNjE0
Zi4uNTVjMjgyYjFjZCAxMDA2NDQKLS0tIGEvdG9vbHMvbGlieGwvbGlieGxfdHlwZXMuaWRsCisr
KyBiL3Rvb2xzL2xpYnhsL2xpYnhsX3R5cGVzLmlkbApAQCAtOTU3LDYgKzk1Nyw3IEBAIGxpYnhs
X2RvbWFpbl9jb25maWcgPSBTdHJ1Y3QoImRvbWFpbl9jb25maWciLCBbCiAgICAgKCJvbl93YXRj
aGRvZyIsIGxpYnhsX2FjdGlvbl9vbl9zaHV0ZG93biksCiAgICAgKCJvbl9jcmFzaCIsIGxpYnhs
X2FjdGlvbl9vbl9zaHV0ZG93biksCiAgICAgKCJvbl9zb2Z0X3Jlc2V0IiwgbGlieGxfYWN0aW9u
X29uX3NodXRkb3duKSwKKyAgICAoImRtX3Jlc3RvcmVfZmlsZSIsIHN0cmluZywgeydjb25zdCc6
IFRydWV9KSwKICAgICBdLCBkaXI9RElSX0lOKQogCiBsaWJ4bF9kaXNraW5mbyA9IFN0cnVjdCgi
ZGlza2luZm8iLCBbCmRpZmYgLS1naXQgYS90b29scy9saWJ4bC9saWJ4bF94ODYuYyBiL3Rvb2xz
L2xpYnhsL2xpYnhsX3g4Ni5jCmluZGV4IGY4YmM4MjhlNjIuLmY0MzEyNDExZmMgMTAwNjQ0Ci0t
LSBhL3Rvb2xzL2xpYnhsL2xpYnhsX3g4Ni5jCisrKyBiL3Rvb2xzL2xpYnhsL2xpYnhsX3g4Ni5j
CkBAIC0yLDYgKzIsNyBAQAogI2luY2x1ZGUgImxpYnhsX2FyY2guaCIKIAogI2luY2x1ZGUgPHhj
X2RvbS5oPgorI2luY2x1ZGUgPHhlbi14c20vZmxhc2svZmxhc2suaD4KIAogaW50IGxpYnhsX19h
cmNoX2RvbWFpbl9wcmVwYXJlX2NvbmZpZyhsaWJ4bF9fZ2MgKmdjLAogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBsaWJ4bF9kb21haW5fY29uZmlnICpkX2NvbmZpZywKQEAg
LTg0Miw2ICs4NDMsNDYgQEAgaW50IGxpYnhsX19hcmNoX3Bhc3N0aHJvdWdoX21vZGVfc2V0ZGVm
YXVsdChsaWJ4bF9fZ2MgKmdjLAogICAgIHJldHVybiByYzsKIH0KIAorLyoKKyAqIFRoZSBwYXJl
bnQgZG9tYWluIGlzIGV4cGVjdGVkIHRvIGJlIGNyZWF0ZWQgd2l0aCBkZWZhdWx0IHNldHRpbmdz
IGZvcgorICogLSBtYXhfZXZ0Y2hfcG9ydAorICogLSBtYXhfZ3JhbnRfZnJhbWVzCisgKiAtIG1h
eF9tYXB0cmFja19mcmFtZXMKKyAqLworaW50IGxpYnhsX2RvbWFpbl9mb3JrX3ZtKGxpYnhsX2N0
eCAqY3R4LCB1aW50MzJfdCBwZG9taWQsIHVpbnQzMl90IG1heF92Y3B1cywgdWludDMyX3QgKmRv
bWlkKQoreworICAgIGludCByYzsKKyAgICBzdHJ1Y3QgeGVuX2RvbWN0bF9jcmVhdGVkb21haW4g
Y3JlYXRlID0gezB9OworICAgIGNyZWF0ZS5mbGFncyB8PSBYRU5fRE9NQ1RMX0NERl9odm07Cisg
ICAgY3JlYXRlLmZsYWdzIHw9IFhFTl9ET01DVExfQ0RGX2hhcDsKKyAgICBjcmVhdGUuZmxhZ3Mg
fD0gWEVOX0RPTUNUTF9DREZfb29zX29mZjsKKyAgICBjcmVhdGUuYXJjaC5lbXVsYXRpb25fZmxh
Z3MgPSAoWEVOX1g4Nl9FTVVfQUxMICYgflhFTl9YODZfRU1VX1ZQQ0kpOworICAgIGNyZWF0ZS5z
c2lkcmVmID0gU0VDSU5JVFNJRF9ET01VOworICAgIGNyZWF0ZS5tYXhfdmNwdXMgPSBtYXhfdmNw
dXM7CisgICAgY3JlYXRlLm1heF9ldnRjaG5fcG9ydCA9IDEwMjM7CisgICAgY3JlYXRlLm1heF9n
cmFudF9mcmFtZXMgPSBMSUJYTF9NQVhfR1JBTlRfRlJBTUVTX0RFRkFVTFQ7CisgICAgY3JlYXRl
Lm1heF9tYXB0cmFja19mcmFtZXMgPSBMSUJYTF9NQVhfTUFQVFJBQ0tfRlJBTUVTX0RFRkFVTFQ7
CisKKyAgICBpZiAoIChyYyA9IHhjX2RvbWFpbl9jcmVhdGUoY3R4LT54Y2gsIGRvbWlkLCAmY3Jl
YXRlKSkgKQorICAgICAgICByZXR1cm4gcmM7CisKKyAgICBpZiAoIChyYyA9IHhjX21lbXNocl9m
b3JrKGN0eC0+eGNoLCBwZG9taWQsICpkb21pZCkpICkKKyAgICAgICAgeGNfZG9tYWluX2Rlc3Ry
b3koY3R4LT54Y2gsICpkb21pZCk7CisKKyAgICByZXR1cm4gcmM7Cit9CisKK2ludCBsaWJ4bF9k
b21haW5fZm9ya19sYXVuY2hfZG0obGlieGxfY3R4ICpjdHgsIGxpYnhsX2RvbWFpbl9jb25maWcg
KmRfY29uZmlnLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCBkb21p
ZCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGlieGxfYXN5bmNwcm9n
cmVzc19ob3cgKmFvcF9jb25zb2xlX2hvdykKK3sKKyAgICByZXR1cm4gbGlieGxfX2RvX2RvbWFp
bl9jcmVhdGUoY3R4LCBkX2NvbmZpZywgJmRvbWlkLCAtMSwgLTEsIDAsIDAsIGFvcF9jb25zb2xl
X2hvdyk7Cit9CisKK2ludCBsaWJ4bF9kb21haW5fZm9ya19yZXNldChsaWJ4bF9jdHggKmN0eCwg
dWludDMyX3QgZG9taWQpCit7CisgICAgcmV0dXJuIHhjX21lbXNocl9mb3JrX3Jlc2V0KGN0eC0+
eGNoLCBkb21pZCk7Cit9CiAKIC8qCiAgKiBMb2NhbCB2YXJpYWJsZXM6CmRpZmYgLS1naXQgYS90
b29scy94bC9NYWtlZmlsZSBiL3Rvb2xzL3hsL01ha2VmaWxlCmluZGV4IGFmNDkxMmU2N2EuLjA3
MzIyMjIzM2IgMTAwNjQ0Ci0tLSBhL3Rvb2xzL3hsL01ha2VmaWxlCisrKyBiL3Rvb2xzL3hsL01h
a2VmaWxlCkBAIC0xNSw3ICsxNSw3IEBAIExERkxBR1MgKz0gJChQVEhSRUFEX0xERkxBR1MpCiBD
RkxBR1NfWEwgKz0gJChDRkxBR1NfbGlieGVubGlnaHQpCiBDRkxBR1NfWEwgKz0gLVdzaGFkb3cK
IAotWExfT0JKUy0kKENPTkZJR19YODYpID0geGxfcHNyLm8KK1hMX09CSlMtJChDT05GSUdfWDg2
KSA9IHhsX3Bzci5vIHhsX2Zvcmt2bS5vCiBYTF9PQkpTID0geGwubyB4bF9jbWR0YWJsZS5vIHhs
X3N4cC5vIHhsX3V0aWxzLm8gJChYTF9PQkpTLXkpCiBYTF9PQkpTICs9IHhsX3BhcnNlLm8geGxf
Y3B1cG9vbC5vIHhsX2ZsYXNrLm8KIFhMX09CSlMgKz0geGxfdnRwbS5vIHhsX2Jsb2NrLm8geGxf
bmljLm8geGxfdXNiLm8KZGlmZiAtLWdpdCBhL3Rvb2xzL3hsL3hsLmggYi90b29scy94bC94bC5o
CmluZGV4IDA2NTY5YzZjNGEuLjExMDVjMzRiMTUgMTAwNjQ0Ci0tLSBhL3Rvb2xzL3hsL3hsLmgK
KysrIGIvdG9vbHMveGwveGwuaApAQCAtMzEsNiArMzEsNyBAQCBzdHJ1Y3QgY21kX3NwZWMgewog
fTsKIAogc3RydWN0IGRvbWFpbl9jcmVhdGUgeworICAgIHVpbnQzMl90IGRkb21pZDsgLyogZm9y
ayBsYXVuY2ggZG0gZm9yIHRoaXMgZG9taWQgKi8KICAgICBpbnQgZGVidWc7CiAgICAgaW50IGRh
ZW1vbml6ZTsKICAgICBpbnQgbW9uaXRvcjsgLyogaGFuZGxlIGd1ZXN0IHJlYm9vdHMgZXRjICov
CkBAIC00NSw2ICs0Niw3IEBAIHN0cnVjdCBkb21haW5fY3JlYXRlIHsKICAgICBjb25zdCBjaGFy
ICpjb25maWdfZmlsZTsKICAgICBjaGFyICpleHRyYV9jb25maWc7IC8qIGV4dHJhIGNvbmZpZyBz
dHJpbmcgKi8KICAgICBjb25zdCBjaGFyICpyZXN0b3JlX2ZpbGU7CisgICAgY29uc3QgY2hhciAq
ZG1fcmVzdG9yZV9maWxlOwogICAgIGNoYXIgKmNvbG9fcHJveHlfc2NyaXB0OwogICAgIGJvb2wg
dXNlcnNwYWNlX2NvbG9fcHJveHk7CiAgICAgaW50IG1pZ3JhdGVfZmQ7IC8qIC0xIG1lYW5zIG5v
bmUgKi8KQEAgLTEyOCw2ICsxMzAsOCBAQCBpbnQgbWFpbl9wY2lhc3NpZ25hYmxlX3JlbW92ZShp
bnQgYXJnYywgY2hhciAqKmFyZ3YpOwogaW50IG1haW5fcGNpYXNzaWduYWJsZV9saXN0KGludCBh
cmdjLCBjaGFyICoqYXJndik7CiAjaWZuZGVmIExJQlhMX0hBVkVfTk9fU1VTUEVORF9SRVNVTUUK
IGludCBtYWluX3Jlc3RvcmUoaW50IGFyZ2MsIGNoYXIgKiphcmd2KTsKK2ludCBtYWluX2Zvcmtf
bGF1bmNoX2RtKGludCBhcmdjLCBjaGFyICoqYXJndik7CitpbnQgbWFpbl9mb3JrX3Jlc2V0KGlu
dCBhcmdjLCBjaGFyICoqYXJndik7CiBpbnQgbWFpbl9taWdyYXRlX3JlY2VpdmUoaW50IGFyZ2Ms
IGNoYXIgKiphcmd2KTsKIGludCBtYWluX3NhdmUoaW50IGFyZ2MsIGNoYXIgKiphcmd2KTsKIGlu
dCBtYWluX21pZ3JhdGUoaW50IGFyZ2MsIGNoYXIgKiphcmd2KTsKQEAgLTIxMiw2ICsyMTYsNyBA
QCBpbnQgbWFpbl9wc3JfY2F0X2NibV9zZXQoaW50IGFyZ2MsIGNoYXIgKiphcmd2KTsKIGludCBt
YWluX3Bzcl9jYXRfc2hvdyhpbnQgYXJnYywgY2hhciAqKmFyZ3YpOwogaW50IG1haW5fcHNyX21i
YV9zZXQoaW50IGFyZ2MsIGNoYXIgKiphcmd2KTsKIGludCBtYWluX3Bzcl9tYmFfc2hvdyhpbnQg
YXJnYywgY2hhciAqKmFyZ3YpOworaW50IG1haW5fZm9ya192bShpbnQgYXJnYywgY2hhciAqKmFy
Z3YpOwogI2VuZGlmCiBpbnQgbWFpbl9xZW11X21vbml0b3JfY29tbWFuZChpbnQgYXJnYywgY2hh
ciAqKmFyZ3YpOwogCmRpZmYgLS1naXQgYS90b29scy94bC94bF9jbWR0YWJsZS5jIGIvdG9vbHMv
eGwveGxfY21kdGFibGUuYwppbmRleCAwODMzNTM5NGU1Li5lZjYzNGFiZjMyIDEwMDY0NAotLS0g
YS90b29scy94bC94bF9jbWR0YWJsZS5jCisrKyBiL3Rvb2xzL3hsL3hsX2NtZHRhYmxlLmMKQEAg
LTE4Nyw2ICsxODcsMjEgQEAgc3RydWN0IGNtZF9zcGVjIGNtZF90YWJsZVtdID0gewogICAgICAg
IlJlc3RvcmUgYSBkb21haW4gZnJvbSBhIHNhdmVkIHN0YXRlIiwKICAgICAgICItIGZvciBpbnRl
cm5hbCB1c2Ugb25seSIsCiAgICAgfSwKKyNpZiBkZWZpbmVkKF9faTM4Nl9fKSB8fCBkZWZpbmVk
KF9feDg2XzY0X18pCisgICAgeyAiZm9yay12bSIsCisgICAgICAmbWFpbl9mb3JrX3ZtLCAwLCAx
LAorICAgICAgIkZvcmsgYSBkb21haW4gZnJvbSB0aGUgcnVubmluZyBwYXJlbnQgZG9taWQuIEV4
cGVyaW1lbnRhbC4gTW9zdCBjb25maWcgc2V0dGluZ3MgbXVzdCBtYXRjaCBwYXJlbnQuIiwKKyAg
ICAgICJbb3B0aW9uc10gPERvbWlkPiIsCisgICAgICAiLWggICAgICAgICAgICAgICAgICAgICAg
ICAgICBQcmludCB0aGlzIGhlbHAuXG4iCisgICAgICAiLUMgPGNvbmZpZz4gICAgICAgICAgICAg
ICAgICBVc2UgY29uZmlnIGZpbGUgZm9yIFZNIGZvcmsuXG4iCisgICAgICAiLVEgPHFlbXUtc2F2
ZS1maWxlPiAgICAgICAgICBVc2UgcWVtdSBzYXZlIGZpbGUgZm9yIFZNIGZvcmsuXG4iCisgICAg
ICAiLS1sYXVuY2gtZG0gPHllc3xub3xsYXRlPiAgICBMYXVuY2ggZGV2aWNlIG1vZGVsIChRRU1V
KSBmb3IgVk0gZm9yay5cbiIKKyAgICAgICItLWZvcmstcmVzZXQgICAgICAgICAgICAgICAgIFJl
c2V0IFZNIGZvcmsuXG4iCisgICAgICAiLS1tYXgtdmNwdXMgICAgICAgICAgICAgICAgICBTcGVj
aWZ5IG1heC12Y3B1cyBtYXRjaGluZyB0aGUgcGFyZW50IGRvbWFpbiB3aGVuIG5vdCBsYXVuY2hp
bmcgZG1cbiIKKyAgICAgICItcCAgICAgICAgICAgICAgICAgICAgICAgICAgIERvIG5vdCB1bnBh
dXNlIGZvcmsgVk0gYWZ0ZXIgb3BlcmF0aW9uLlxuIgorICAgICAgIi1kICAgICAgICAgICAgICAg
ICAgICAgICAgICAgRW5hYmxlIGRlYnVnIG1lc3NhZ2VzLlxuIgorICAgIH0sCisjZW5kaWYKICNl
bmRpZgogICAgIHsgImR1bXAtY29yZSIsCiAgICAgICAmbWFpbl9kdW1wX2NvcmUsIDAsIDEsCmRp
ZmYgLS1naXQgYS90b29scy94bC94bF9mb3Jrdm0uYyBiL3Rvb2xzL3hsL3hsX2Zvcmt2bS5jCm5l
dyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAuLmE3ZWU1YjQ3NzEKLS0tIC9kZXYv
bnVsbAorKysgYi90b29scy94bC94bF9mb3Jrdm0uYwpAQCAtMCwwICsxLDE0NyBAQAorLyoKKyAq
IENvcHlyaWdodCAyMDIwIEludGVsIENvcnBvcmF0aW9uCisgKgorICogVGhpcyBwcm9ncmFtIGlz
IGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKKyAq
IGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNl
bnNlIGFzIHB1Ymxpc2hlZAorICogYnkgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgdmVy
c2lvbiAyLjEgb25seS4gd2l0aCB0aGUgc3BlY2lhbAorICogZXhjZXB0aW9uIG9uIGxpbmtpbmcg
ZGVzY3JpYmVkIGluIGZpbGUgTElDRU5TRS4KKyAqCisgKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJp
YnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKKyAqIGJ1dCBXSVRIT1VU
IEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCisgKiBN
RVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUg
dGhlCisgKiBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWls
cy4KKyAqLworCisjaW5jbHVkZSA8ZmNudGwuaD4KKyNpbmNsdWRlIDxpbnR0eXBlcy5oPgorI2lu
Y2x1ZGUgPHN0ZGxpYi5oPgorI2luY2x1ZGUgPHN5cy9zdGF0Lmg+CisjaW5jbHVkZSA8c3lzL3R5
cGVzLmg+CisjaW5jbHVkZSA8c3lzL3V0c25hbWUuaD4KKyNpbmNsdWRlIDx0aW1lLmg+CisjaW5j
bHVkZSA8dW5pc3RkLmg+CisKKyNpbmNsdWRlIDxsaWJ4bC5oPgorI2luY2x1ZGUgPGxpYnhsX3V0
aWxzLmg+CisjaW5jbHVkZSA8bGlieGx1dGlsLmg+CisKKyNpbmNsdWRlICJ4bC5oIgorI2luY2x1
ZGUgInhsX3V0aWxzLmgiCisjaW5jbHVkZSAieGxfcGFyc2UuaCIKKworaW50IG1haW5fZm9ya192
bShpbnQgYXJnYywgY2hhciAqKmFyZ3YpCit7CisgICAgaW50IHJjLCBkZWJ1ZyA9IDA7CisgICAg
dWludDMyX3QgZG9taWRfaW4gPSBJTlZBTElEX0RPTUlELCBkb21pZF9vdXQgPSBJTlZBTElEX0RP
TUlEOworICAgIGludCBsYXVuY2hfZG0gPSAxOworICAgIGJvb2wgcmVzZXQgPSAwOworICAgIGJv
b2wgcGF1c2UgPSAwOworICAgIGNvbnN0IGNoYXIgKmNvbmZpZ19maWxlID0gTlVMTDsKKyAgICBj
b25zdCBjaGFyICpkbV9yZXN0b3JlX2ZpbGUgPSBOVUxMOworICAgIHVpbnQzMl90IG1heF92Y3B1
cyA9IDA7CisKKyAgICBpbnQgb3B0OworICAgIHN0YXRpYyBzdHJ1Y3Qgb3B0aW9uIG9wdHNbXSA9
IHsKKyAgICAgICAgeyJsYXVuY2gtZG0iLCAxLCAwLCAnbCd9LAorICAgICAgICB7ImZvcmstcmVz
ZXQiLCAwLCAwLCAncid9LAorICAgICAgICB7Im1heC12Y3B1cyIsIDEsIDAsICdtJ30sCisgICAg
ICAgIENPTU1PTl9MT05HX09QVFMKKyAgICB9OworCisgICAgU1dJVENIX0ZPUkVBQ0hfT1BUKG9w
dCwgInBoZEM6UTpsOnJtOk46RDpCOlY6Iiwgb3B0cywgImZvcmstdm0iLCAxKSB7CisgICAgY2Fz
ZSAnZCc6CisgICAgICAgIGRlYnVnID0gMTsKKyAgICAgICAgYnJlYWs7CisgICAgY2FzZSAncCc6
CisgICAgICAgIHBhdXNlID0gMTsKKyAgICAgICAgYnJlYWs7CisgICAgY2FzZSAnbSc6CisgICAg
ICAgIG1heF92Y3B1cyA9IGF0b2kob3B0YXJnKTsKKyAgICAgICAgYnJlYWs7CisgICAgY2FzZSAn
Qyc6CisgICAgICAgIGNvbmZpZ19maWxlID0gb3B0YXJnOworICAgICAgICBicmVhazsKKyAgICBj
YXNlICdRJzoKKyAgICAgICAgZG1fcmVzdG9yZV9maWxlID0gb3B0YXJnOworICAgICAgICBicmVh
azsKKyAgICBjYXNlICdsJzoKKyAgICAgICAgaWYgKCAhc3RyY21wKG9wdGFyZywgIm5vIikgKQor
ICAgICAgICAgICAgbGF1bmNoX2RtID0gMDsKKyAgICAgICAgaWYgKCAhc3RyY21wKG9wdGFyZywg
InllcyIpICkKKyAgICAgICAgICAgIGxhdW5jaF9kbSA9IDE7CisgICAgICAgIGlmICggIXN0cmNt
cChvcHRhcmcsICJsYXRlIikgKQorICAgICAgICAgICAgbGF1bmNoX2RtID0gMjsKKyAgICAgICAg
YnJlYWs7CisgICAgY2FzZSAncic6CisgICAgICAgIHJlc2V0ID0gMTsKKyAgICAgICAgYnJlYWs7
CisgICAgY2FzZSAnTic6IC8qIGZhbGwtdGhyb3VnaCAqLworICAgIGNhc2UgJ0QnOiAvKiBmYWxs
LXRocm91Z2ggKi8KKyAgICBjYXNlICdCJzogLyogZmFsbC10aHJvdWdoICovCisgICAgY2FzZSAn
Vic6CisgICAgICAgIGZwcmludGYoc3RkZXJyLCAiVW5pbXBsZW1lbnRlZCBvcHRpb24ocylcbiIp
OworICAgICAgICByZXR1cm4gRVhJVF9GQUlMVVJFOworICAgIH0KKworICAgIGlmIChhcmdjLW9w
dGluZCA9PSAxKSB7CisgICAgICAgIGRvbWlkX2luID0gYXRvaShhcmd2W29wdGluZF0pOworICAg
IH0gZWxzZSB7CisgICAgICAgIGhlbHAoImZvcmstdm0iKTsKKyAgICAgICAgcmV0dXJuIEVYSVRf
RkFJTFVSRTsKKyAgICB9CisKKyAgICBpZiAobGF1bmNoX2RtICYmICghY29uZmlnX2ZpbGUgfHwg
IWRtX3Jlc3RvcmVfZmlsZSkpIHsKKyAgICAgICAgZnByaW50ZihzdGRlcnIsICJDdXJyZW50bHkg
eW91IG11c3QgcHJvdmlkZSBib3RoIC1DIGFuZCAtUSBvcHRpb25zXG4iKTsKKyAgICAgICAgcmV0
dXJuIEVYSVRfRkFJTFVSRTsKKyAgICB9CisKKyAgICBpZiAocmVzZXQpIHsKKyAgICAgICAgZG9t
aWRfb3V0ID0gZG9taWRfaW47CisgICAgICAgIGlmIChsaWJ4bF9kb21haW5fZm9ya19yZXNldChj
dHgsIGRvbWlkX2luKSA9PSBFWElUX0ZBSUxVUkUpCisgICAgICAgICAgICByZXR1cm4gRVhJVF9G
QUlMVVJFOworICAgIH0KKworICAgIGlmIChsYXVuY2hfZG0gPT0gMiB8fCByZXNldCkgeworICAg
ICAgICBkb21pZF9vdXQgPSBkb21pZF9pbjsKKyAgICAgICAgcmMgPSBFWElUX1NVQ0NFU1M7Cisg
ICAgfSBlbHNlIHsKKyAgICAgICAgaWYgKCAhbWF4X3ZjcHVzICkKKyAgICAgICAgeworICAgICAg
ICAgICAgZnByaW50ZihzdGRlcnIsICJDdXJyZW50bHkgeW91IG11c3QgcGFyZW50J3MgbWF4X3Zj
cHUgZm9yIHRoaXMgb3B0aW9uXG4iKTsKKyAgICAgICAgICAgIHJldHVybiBFWElUX0ZBSUxVUkU7
CisgICAgICAgIH0KKworICAgICAgICByYyA9IGxpYnhsX2RvbWFpbl9mb3JrX3ZtKGN0eCwgZG9t
aWRfaW4sIG1heF92Y3B1cywgJmRvbWlkX291dCk7CisgICAgfQorCisgICAgaWYgKHJjID09IEVY
SVRfU1VDQ0VTUykgeworICAgICAgICBpZiAoIGxhdW5jaF9kbSApIHsKKyAgICAgICAgICAgIHN0
cnVjdCBkb21haW5fY3JlYXRlIGRvbV9pbmZvOworICAgICAgICAgICAgbWVtc2V0KCZkb21faW5m
bywgMCwgc2l6ZW9mKGRvbV9pbmZvKSk7CisgICAgICAgICAgICBkb21faW5mby5kZG9taWQgPSBk
b21pZF9vdXQ7CisgICAgICAgICAgICBkb21faW5mby5kbV9yZXN0b3JlX2ZpbGUgPSBkbV9yZXN0
b3JlX2ZpbGU7CisgICAgICAgICAgICBkb21faW5mby5kZWJ1ZyA9IGRlYnVnOworICAgICAgICAg
ICAgZG9tX2luZm8ucGF1c2VkID0gcGF1c2U7CisgICAgICAgICAgICBkb21faW5mby5jb25maWdf
ZmlsZSA9IGNvbmZpZ19maWxlOworICAgICAgICAgICAgZG9tX2luZm8ubWlncmF0ZV9mZCA9IC0x
OworICAgICAgICAgICAgZG9tX2luZm8uc2VuZF9iYWNrX2ZkID0gLTE7CisgICAgICAgICAgICBy
YyA9IGNyZWF0ZV9kb21haW4oJmRvbV9pbmZvKSA8IDAgPyBFWElUX0ZBSUxVUkUgOiBFWElUX1NV
Q0NFU1M7CisgICAgICAgIH0gZWxzZSBpZiAoICFwYXVzZSApCisgICAgICAgICAgICByYyA9IGxp
YnhsX2RvbWFpbl91bnBhdXNlKGN0eCwgZG9taWRfb3V0LCBOVUxMKTsKKyAgICB9CisKKyAgICBp
ZiAocmMgPT0gRVhJVF9TVUNDRVNTKQorICAgICAgICBmcHJpbnRmKHN0ZGVyciwgImZvcmstdm0g
Y29tbWFuZCBzdWNjZXNzZnVsbHkgcmV0dXJuZWQgZG9taWQ6ICV1XG4iLCBkb21pZF9vdXQpOwor
ICAgIGVsc2UgaWYgKCBkb21pZF9vdXQgIT0gSU5WQUxJRF9ET01JRCApCisgICAgICAgIGxpYnhs
X2RvbWFpbl9kZXN0cm95KGN0eCwgZG9taWRfb3V0LCAwKTsKKworICAgIHJldHVybiByYzsKK30K
KworLyoKKyAqIExvY2FsIHZhcmlhYmxlczoKKyAqIG1vZGU6IEMKKyAqIGMtYmFzaWMtb2Zmc2V0
OiA0CisgKiBpbmRlbnQtdGFicy1tb2RlOiBuaWwKKyAqIEVuZDoKKyAqLwpkaWZmIC0tZ2l0IGEv
dG9vbHMveGwveGxfdm1jb250cm9sLmMgYi90b29scy94bC94bF92bWNvbnRyb2wuYwppbmRleCAy
ZTJkNDI3NDkyLi43ODJmYmJjMjRiIDEwMDY0NAotLS0gYS90b29scy94bC94bF92bWNvbnRyb2wu
YworKysgYi90b29scy94bC94bF92bWNvbnRyb2wuYwpAQCAtNjc2LDYgKzY3NiwxMiBAQCBpbnQg
Y3JlYXRlX2RvbWFpbihzdHJ1Y3QgZG9tYWluX2NyZWF0ZSAqZG9tX2luZm8pCiAKICAgICBpbnQg
cmVzdG9yaW5nID0gKHJlc3RvcmVfZmlsZSB8fCAobWlncmF0ZV9mZCA+PSAwKSk7CiAKKyNpZiBk
ZWZpbmVkKF9faTM4Nl9fKSB8fCBkZWZpbmVkKF9feDg2XzY0X18pCisgICAgLyogVk0gZm9ya2lu
ZyAqLworICAgIHVpbnQzMl90IGRkb21pZCA9IGRvbV9pbmZvLT5kZG9taWQ7IC8vIGxhdW5jaCBk
bSBmb3IgdGhpcyBkb21haW4gaWZmIHNldAorICAgIGNvbnN0IGNoYXIgKmRtX3Jlc3RvcmVfZmls
ZSA9IGRvbV9pbmZvLT5kbV9yZXN0b3JlX2ZpbGU7CisjZW5kaWYKKwogICAgIGxpYnhsX2RvbWFp
bl9jb25maWdfaW5pdCgmZF9jb25maWcpOwogCiAgICAgaWYgKHJlc3RvcmluZykgewpAQCAtOTI2
LDYgKzkzMiwxNCBAQCBzdGFydDoKICAgICAgICAgICogcmVzdG9yZS9taWdyYXRlLXJlY2VpdmUg
aXQgYWdhaW4uCiAgICAgICAgICAqLwogICAgICAgICByZXN0b3JpbmcgPSAwOworI2lmIGRlZmlu
ZWQoX19pMzg2X18pIHx8IGRlZmluZWQoX194ODZfNjRfXykKKyAgICB9IGVsc2UgaWYgKCBkZG9t
aWQgKSB7CisgICAgICAgIGRfY29uZmlnLmRtX3Jlc3RvcmVfZmlsZSA9IGRtX3Jlc3RvcmVfZmls
ZTsKKyAgICAgICAgcmV0ID0gbGlieGxfZG9tYWluX2ZvcmtfbGF1bmNoX2RtKGN0eCwgJmRfY29u
ZmlnLCBkZG9taWQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBh
dXRvY29ubmVjdF9jb25zb2xlX2hvdyk7CisgICAgICAgIGRvbWlkID0gZGRvbWlkOworICAgICAg
ICBkZG9taWQgPSBJTlZBTElEX0RPTUlEOworI2VuZGlmCiAgICAgfSBlbHNlIGlmIChkb21pZF9z
b2Z0X3Jlc2V0ICE9IElOVkFMSURfRE9NSUQpIHsKICAgICAgICAgLyogRG8gc29mdCByZXNldC4g
Ki8KICAgICAgICAgcmV0ID0gbGlieGxfZG9tYWluX3NvZnRfcmVzZXQoY3R4LCAmZF9jb25maWcs
IGRvbWlkX3NvZnRfcmVzZXQsCi0tIAoyLjIwLjEKCgpfX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBs
aXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4v
bGlzdGluZm8veGVuLWRldmVs

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id D0A2281B96
	for <lists+xen-devel@lfdr.de>; Mon,  5 Aug 2019 15:16:04 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hucnC-0003Ge-8R; Mon, 05 Aug 2019 13:12:50 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=5ABr=WB=intel.com=chao.gao@srs-us1.protection.inumbo.net>)
 id 1hucnA-0003GZ-UJ
 for xen-devel@lists.xenproject.org; Mon, 05 Aug 2019 13:12:48 +0000
X-Inumbo-ID: b59567c8-b782-11e9-81d1-3b00f4a57c05
Received: from mga06.intel.com (unknown [134.134.136.31])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id b59567c8-b782-11e9-81d1-3b00f4a57c05;
 Mon, 05 Aug 2019 13:12:43 +0000 (UTC)
X-Amp-Result: UNKNOWN
X-Amp-Original-Verdict: FILE UNKNOWN
X-Amp-File-Uploaded: False
Received: from fmsmga008.fm.intel.com ([10.253.24.58])
 by orsmga104.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 05 Aug 2019 06:12:17 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,350,1559545200"; d="scan'208";a="173880953"
Received: from gao-cwp.sh.intel.com (HELO gao-cwp) ([10.239.159.26])
 by fmsmga008.fm.intel.com with ESMTP; 05 Aug 2019 06:12:15 -0700
Date: Mon, 5 Aug 2019 21:16:24 +0800
From: Chao Gao <chao.gao@intel.com>
To: Jan Beulich <JBeulich@suse.com>
Message-ID: <20190805131623.GC1685@gao-cwp>
References: <1564654971-31328-1-git-send-email-chao.gao@intel.com>
 <1564654971-31328-15-git-send-email-chao.gao@intel.com>
 <14b8b6ba-4b3c-dada-dfb2-65b815ca621f@suse.com>
MIME-Version: 1.0
Content-Disposition: inline
In-Reply-To: <14b8b6ba-4b3c-dada-dfb2-65b815ca621f@suse.com>
User-Agent: Mutt/1.5.21 (2010-09-15)
Subject: Re: [Xen-devel] [PATCH v8 14/16] x86/microcode: Synchronize late
 microcode loading
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Kevin Tian <kevin.tian@intel.com>, Ashok Raj <ashok.raj@intel.com>,
 Wei Liu <wl@xen.org>, Andrew Cooper <andrew.cooper3@citrix.com>,
 Jun Nakajima <jun.nakajima@intel.com>,
 "xen-devel@lists.xenproject.org" <xen-devel@lists.xenproject.org>,
 Thomas Gleixner <tglx@linutronix.de>, Borislav Petkov <bp@suse.de>,
 Roger Pau =?iso-8859-1?Q?Monn=E9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

T24gTW9uLCBBdWcgMDUsIDIwMTkgYXQgMTA6NDM6MTZBTSArMDAwMCwgSmFuIEJldWxpY2ggd3Jv
dGU6Cj5PbiAwMS4wOC4yMDE5IDEyOjIyLCBDaGFvIEdhbyB3cm90ZToKPj4gQEAgLTIzNCw2ICsy
NjcsMzUgQEAgYm9vbCBtaWNyb2NvZGVfdXBkYXRlX2NhY2hlKHN0cnVjdCBtaWNyb2NvZGVfcGF0
Y2ggKnBhdGNoKQo+PiAgIH0KPj4gICAKPj4gICAvKgo+PiArICogV2FpdCBmb3IgYSBjb25kaXRp
b24gdG8gYmUgbWV0IHdpdGggYSB0aW1lb3V0ICh1cykuCj4+ICsgKi8KPj4gK3N0YXRpYyBpbnQg
d2FpdF9mb3JfY29uZGl0aW9uKGludCAoKmZ1bmMpKHZvaWQgKmRhdGEpLCB2b2lkICpkYXRhLAo+
PiArICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCB0aW1lb3V0KQo+PiArewo+
PiArICAgIHdoaWxlICggIWZ1bmMoZGF0YSkgKQo+PiArICAgIHsKPj4gKyAgICAgICAgaWYgKCAh
dGltZW91dC0tICkKPj4gKyAgICAgICAgewo+PiArICAgICAgICAgICAgcHJpbnRrKCJDUFUldTog
VGltZW91dCBpbiAlc1xuIiwgc21wX3Byb2Nlc3Nvcl9pZCgpLCBfX2Z1bmNfXyk7Cj4KPkkgZG9u
J3QgdGhpbmsgX19mdW5jX18gaXMgaGVscGZ1bCBoZXJlIGZvciBwcm9ibGVtIGFuYWx5c2lzLiBJ
bnN0ZWFkCj5JIHRoaW5rIHlvdSB3b3VsZCB3YW50IHRvIGxvZyBlaXRoZXIgZnVuYyBvciBfX2J1
aWx0aW5fcmV0dXJuX2FkZHJlc3MoMCkuCgpXaWxsIGRvLgoKPgo+PiBAQCAtMjgzLDM3ICszNDUs
MTA1IEBAIHN0YXRpYyBpbnQgbWljcm9jb2RlX3VwZGF0ZV9jcHUoY29uc3Qgc3RydWN0IG1pY3Jv
Y29kZV9wYXRjaCAqcGF0Y2gpCj4+ICAgICAgIHJldHVybiBlcnI7Cj4+ICAgfQo+PiAgIAo+PiAt
c3RhdGljIGxvbmcgZG9fbWljcm9jb2RlX3VwZGF0ZSh2b2lkICpwYXRjaCkKPj4gK3N0YXRpYyBp
bnQgZG9fbWljcm9jb2RlX3VwZGF0ZSh2b2lkICpwYXRjaCkKPj4gICB7Cj4+IC0gICAgdW5zaWdu
ZWQgaW50IGNwdTsKPj4gKyAgICB1bnNpZ25lZCBpbnQgY3B1ID0gc21wX3Byb2Nlc3Nvcl9pZCgp
Owo+PiArICAgIHVuc2lnbmVkIGludCBjcHVfbnIgPSBudW1fb25saW5lX2NwdXMoKTsKPj4gKyAg
ICBpbnQgcmV0Owo+PiAgIAo+PiAtICAgIC8qIHN0b3JlIHRoZSBwYXRjaCBhZnRlciBhIHN1Y2Nl
c3NmdWwgbG9hZGluZyAqLwo+PiAtICAgIGlmICggIW1pY3JvY29kZV91cGRhdGVfY3B1KHBhdGNo
KSAmJiBwYXRjaCApCj4+ICsgICAgLyogTWFyayBsb2FkaW5nIGFuIHVjb2RlIGlzIGluIHByb2dy
ZXNzICovCj4+ICsgICAgY21weGNoZygmbG9hZGluZ19zdGF0ZSwgTE9BRElOR19FWElURUQsIExP
QURJTkdfRU5URVJFRCk7Cj4KPldoeSBjbXB4Y2hnKCksIGVzcGVjaWFsbHkgd2hlbiB5b3UgZG9u
J3QgY2hlY2sgd2hldGhlciB0aGUgc3RvcmUKPmhhcyBhY3R1YWxseSBoYXBwZW5lZD8gKFNhbWUg
ZnVydGhlciBkb3duIHRoZW4uKQoKbG9hZGluZ19zdGF0ZSBpcyBzZXQgdG8gIkxPQURJTkdfRVhJ
VEVEIiBieSB0aGUgY2FsbGVyLiBTbyB0aGUgZmlyc3QgQ1BVCmNvbWluZyBoZXJlIHdvdWxkIHN0
b3JlICJMT0FESU5HX0VOVEVSRUQiIHRvIGl0LiBBbmQgd2UgZG9uJ3QgbmVlZApzcGVjaWFsIGhh
bmRsaW5nIGZvciB0aGUgQ1BVIHRoYXQgc2V0cyB0aGUgc3RhdGUsIHNvIHRoZSByZXR1cm4gdmFs
dWUKaXNuJ3QgY2hlY2tlZC4KCkhlcmUgYXJlIG15IGNvbnNpZGVyYXRpb25zIGFib3V0IGhvdyB0
byBzZXQgdGhlIHN0YXRlOgoxKSBXZSBjYW5ub3Qgc2V0IHRoZSBzdGF0ZSBpbiB0aGUgY2FsbGVy
LiBCZWNhdXNlIHdlIHdvdWxkIHVzZSB0aGlzCnN0YXRlIHRvIGJsb2NrICNOTUkgaGFuZGxpbmcu
IFNldHRpbmcgdGhlIHN0YXRlIGluIHRoZSBjYWxsZXIgbWF5CmJyZWFrIHN0b3BfbWFjaGluZV9y
dW4gbWVjaGFuaXNtIHdpdGggdGhlIHBhdGNoIDE2LgoKMikgVGhlIGZpcnN0IENQVSByZWFjaGlu
ZyBoZXJlIHNob3VsZCBzZXQgdGhlIHN0YXRlIChpdCBtZWFucyB3ZSBjYW5ub3QKY2hvb3NlIG9u
ZSBDUFUsIGUuZy4gQlNQLCB0byBkbyBpdCkuIFdpdGggdGhpcywgI05NSSBoYW5kbGluZyBpcwpk
aXNhYmxlZCBzeXN0ZW0td2lzZSBiZWZvcmUgYW55IENQVSBjYWxscyBpbi4gT3RoZXJ3aXNlLCBp
ZiB0aGVyZSBpcwphbiBleGNlcHRpb24gZm9yIGEgQ1BVLCBpdCBtYXkgYmUgc3RpbGwgaW4gI05N
SSBoYW5kbGluZywgd2hlbiBpdHMKc2libGluZyB0aHJlYWQgc3RhcnRzIGxvYWRpbmcgYW4gdWNv
ZGUuCgozKSBBIHNpbXBsZSBhc3NpZ25tZW50IG9uIGV2ZXJ5IENQVSBpcyBwcm9ibGVtYXRpYyBp
biBzb21lIGNhc2VzLgpGb3IgZXhhbXBsZSwgaWYgb25lIENQVSBjb21lcyBpbiBhZnRlciBvdGhl
ciBDUFVzIHRpbWVkIG91dCBhbmQgbGVmdCwKaXQgbWlnaHQgc2V0IHRoZSBzdGF0ZSB0byAiTE9B
RElOR19FTlRFUkVEIiBhbmQgYmUgYmxvY2tlZCBpbiAjTk1JCmhhbmRsaW5nIGZvcmV2ZXIgd2l0
aCBwYXRjaCAxNi4KClRoYXQncyB3aHkgSSBjaG9vc2UgdG8gdXNlIGEgY21weGhnKCkuCgpSZWdh
cmRpbmcgdGhlIGNtcHhjaGcoKSBpbiBlcnJvci1oYW5kbGluZyBiZWxvdywgaXQgY2FuIGJlIHJl
cGxhY2VkIGJ5CmEgc2ltcGxlIGFzc2lnbm1lbnQuIEJ1dCBJIGFtIG5vdCBzdXJlIHdoZXRoZXIg
aXQgaXMgYmV0dGVyIHRvIHVzZQpjbXB4Y2hnKCkgY29uc2lkZXJpbmcgY2FjaGUgbGluZSBib3Vu
Y2luZy4KCj4KPj4gKyAgICBjcHVtYXNrX3NldF9jcHUoY3B1LCAmY3B1X2NhbGxpbl9tYXApOwo+
PiArICAgIHJldCA9IHdhaXRfZm9yX2NvbmRpdGlvbih3YWl0X2NwdV9jYWxsaW4sICh2b2lkICop
KHVuc2lnbmVkIGxvbmcpY3B1X25yLAo+PiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICBN
SUNST0NPREVfQ0FMTElOX1RJTUVPVVRfVVMpOwo+PiArICAgIGlmICggcmV0ICkKPj4gICAgICAg
ewo+PiAtICAgICAgICBzcGluX2xvY2soJm1pY3JvY29kZV9tdXRleCk7Cj4+IC0gICAgICAgIG1p
Y3JvY29kZV91cGRhdGVfY2FjaGUocGF0Y2gpOwo+PiAtICAgICAgICBzcGluX3VubG9jaygmbWlj
cm9jb2RlX211dGV4KTsKPj4gLSAgICAgICAgcGF0Y2ggPSBOVUxMOwo+PiArICAgICAgICBjbXB4
Y2hnKCZsb2FkaW5nX3N0YXRlLCBMT0FESU5HX0VOVEVSRUQsIExPQURJTkdfQUJPUlRFRCk7Cj4+
ICsgICAgICAgIHJldHVybiByZXQ7Cj4+ICAgICAgIH0KPj4gICAKPj4gLSAgICBpZiAoIG1pY3Jv
Y29kZV9vcHMtPmVuZF91cGRhdGUgKQo+PiAtICAgICAgICBtaWNyb2NvZGVfb3BzLT5lbmRfdXBk
YXRlKCk7Cj4+ICsgICAgLyoKPj4gKyAgICAgKiBMb2FkIG1pY3JvY29kZSB1cGRhdGUgb24gb25s
eSBvbmUgbG9naWNhbCBwcm9jZXNzb3IgcGVyIGNvcmUsIG9yIGluCj4+ICsgICAgICogQU1EJ3Mg
dGVybSwgb25lIGNvcmUgcGVyIGNvbXB1dGUgdW5pdC4gVGhlIG9uZSB3aXRoIHRoZSBsb3dlc3Qg
dGhyZWFkCj4+ICsgICAgICogaWQgYW1vbmcgYWxsIHNpYmxpbmdzIGlzIGNob3NlbiB0byBwZXJm
b3JtIHRoZSBsb2FkaW5nLgo+PiArICAgICAqLwo+PiArICAgIGlmICggKGNwdSA9PSBjcHVtYXNr
X2ZpcnN0KHBlcl9jcHUoY3B1X3NpYmxpbmdfbWFzaywgY3B1KSkpICkKPj4gKyAgICB7Cj4+ICsg
ICAgICAgIHN0YXRpYyB1bnNpZ25lZCBpbnQgcGFuaWNrZWQgPSAwOwo+PiArICAgICAgICBib29s
IG1vbml0b3I7Cj4+ICsgICAgICAgIHVuc2lnbmVkIGludCBkb25lOwo+PiArICAgICAgICB1bnNp
Z25lZCBsb25nIHRpY2sgPSAwOwo+PiAgIAo+PiAtICAgIGNwdSA9IGNwdW1hc2tfbmV4dChzbXBf
cHJvY2Vzc29yX2lkKCksICZjcHVfb25saW5lX21hcCk7Cj4+IC0gICAgaWYgKCBjcHUgPCBucl9j
cHVfaWRzICkKPj4gLSAgICAgICAgcmV0dXJuIGNvbnRpbnVlX2h5cGVyY2FsbF9vbl9jcHUoY3B1
LCBkb19taWNyb2NvZGVfdXBkYXRlLCBwYXRjaCk7Cj4+ICsgICAgICAgIHJldCA9IG1pY3JvY29k
ZV9vcHMtPmFwcGx5X21pY3JvY29kZShwYXRjaCk7Cj4+ICsgICAgICAgIGlmICggIXJldCApCj4+
ICsgICAgICAgIHsKPj4gKyAgICAgICAgICAgIHVuc2lnbmVkIGludCBjcHUyOwo+PiAgIAo+PiAt
ICAgIC8qIEZyZWUgdGhlIHBhdGNoIGlmIG5vIENQVSBoYXMgbG9hZGVkIGl0IHN1Y2Nlc3NmdWxs
eS4gKi8KPj4gLSAgICBpZiAoIHBhdGNoICkKPj4gLSAgICAgICAgbWljcm9jb2RlX2ZyZWVfcGF0
Y2gocGF0Y2gpOwo+PiArICAgICAgICAgICAgYXRvbWljX2luYygmY3B1X3VwZGF0ZWQpOwo+PiAr
ICAgICAgICAgICAgLyogUHJvcGFnYXRlIHJldmlzaW9uIG51bWJlciB0byBhbGwgc2libGluZ3Mg
Ki8KPj4gKyAgICAgICAgICAgIGZvcl9lYWNoX2NwdShjcHUyLCBwZXJfY3B1KGNwdV9zaWJsaW5n
X21hc2ssIGNwdSkpCj4+ICsgICAgICAgICAgICAgICAgcGVyX2NwdShjcHVfc2lnLCBjcHUyKS5y
ZXYgPSB0aGlzX2NwdShjcHVfc2lnKS5yZXY7Cj4+ICsgICAgICAgIH0KPj4gICAKPj4gLSAgICBy
ZXR1cm4gMDsKPj4gKyAgICAgICAgLyoKPj4gKyAgICAgICAgICogVGhlIGZpcnN0IENQVSByZWFj
aGluZyBoZXJlIHdpbGwgbW9uaXRvciB0aGUgcHJvZ3Jlc3MgYW5kIGVtaXQKPj4gKyAgICAgICAg
ICogd2FybmluZyBtZXNzYWdlIGlmIHRoZSBkdXJhdGlvbiBpcyB0b28gbG9uZyAoZS5nLiA+MSBz
ZWNvbmQpLgo+PiArICAgICAgICAgKi8KPj4gKyAgICAgICAgbW9uaXRvciA9ICFhdG9taWNfaW5j
X3JldHVybigmY3B1X291dCk7Cj4+ICsgICAgICAgIGlmICggbW9uaXRvciApCj4+ICsgICAgICAg
ICAgICB0aWNrID0gcmR0c2Nfb3JkZXJlZCgpOwo+PiArCj4+ICsgICAgICAgIC8qIFdhaXRpbmcg
Zm9yIGFsbCBjb3JlcyBvciBjb21wdXRpbmcgdW5pdHMgZmluaXNoaW5nIHVwZGF0ZSAqLwo+PiAr
ICAgICAgICBkb25lID0gYXRvbWljX3JlYWQoJmNwdV9vdXQpOwo+PiArICAgICAgICB3aGlsZSAo
IHBhbmlja2VkICYmIGRvbmUgIT0gbnJfY29yZXMgKQo+Cj5Eb24ndCB5b3UgbWVhbiAiIXBhbmlj
a2VkIiBoZXJlLCBvciB8fCBpbnN0ZWFkIG9mICYmID8gT3RoZXJ3aXNlIEkgZG9uJ3QKPnNlZSBo
b3cgdGhlIGxvb3Agd291bGQgZXZlciBiZSBlbnRlcmVkLgoKU29ycnkuIEl0IHNob3VsZCBiZSAh
cGFuaWNrZWQuCgpPdGhlciBjb21tZW50cyBhcmUgcmVhc29uYWJsZSBhbmQgSSB3aWxsIGZvbGxv
dyB5b3VyIHN1Z2dlc3Rpb25zLgoKVGhhbmtzCkNoYW8KCl9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVs
QGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1h
bi9saXN0aW5mby94ZW4tZGV2ZWw=

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 3A4904366E
	for <lists+xen-devel@lfdr.de>; Thu, 13 Jun 2019 15:25:30 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hbPgb-000185-CW; Thu, 13 Jun 2019 13:22:37 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=BOU1=UM=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1hbPgZ-00017t-VU
 for xen-devel@lists.xenproject.org; Thu, 13 Jun 2019 13:22:36 +0000
X-Inumbo-ID: 4d638f6f-8dde-11e9-8980-bc764e045a96
Received: from prv1-mh.provo.novell.com (unknown [137.65.248.33])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 4d638f6f-8dde-11e9-8980-bc764e045a96;
 Thu, 13 Jun 2019 13:22:33 +0000 (UTC)
Received: from INET-PRV1-MTA by prv1-mh.provo.novell.com
 with Novell_GroupWise; Thu, 13 Jun 2019 07:22:32 -0600
Message-Id: <5D024E170200007800237DFD@prv1-mh.provo.novell.com>
X-Mailer: Novell GroupWise Internet Agent 18.1.1 
Date: Thu, 13 Jun 2019 07:22:31 -0600
From: "Jan Beulich" <JBeulich@suse.com>
To: "xen-devel" <xen-devel@lists.xenproject.org>
References: <5D024C500200007800237DD8@prv1-mh.provo.novell.com>
In-Reply-To: <5D024C500200007800237DD8@prv1-mh.provo.novell.com>
Mime-Version: 1.0
Content-Disposition: inline
Subject: [Xen-devel] [PATCH 1/9] AMD/IOMMU: use bit field for extended
 feature register
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>,
 Brian Woods <brian.woods@amd.com>,
 Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhpcyBhbHNvIHRha2VzIGNhcmUgb2Ygc2V2ZXJhbCBvZiB0aGUgc2hpZnQgdmFsdWVzIHdyb25n
bHkgaGF2aW5nIGJlZW4Kc3BlY2lmaWVkIGFzIGhleCByYXRoZXIgdGhhbiBkZWMuCgpUYWtlIHRo
ZSBvcHBvcnR1bml0eSBhbmQgYWRkIGZ1cnRoZXIgZmllbGRzLgoKU2lnbmVkLW9mZi1ieTogSmFu
IEJldWxpY2ggPGpiZXVsaWNoQHN1c2UuY29tPgoKLS0tIGEveGVuL2RyaXZlcnMvcGFzc3Rocm91
Z2gvYW1kL2lvbW11X2RldGVjdC5jCisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9p
b21tdV9kZXRlY3QuYwpAQCAtNjAsNDMgKzYwLDcyIEBAIHN0YXRpYyBpbnQgX19pbml0IGdldF9p
b21tdV9jYXBhYmlsaXRpZXMKIAogdm9pZCBfX2luaXQgZ2V0X2lvbW11X2ZlYXR1cmVzKHN0cnVj
dCBhbWRfaW9tbXUgKmlvbW11KQogewotICAgIHUzMiBsb3csIGhpZ2g7Ci0gICAgaW50IGkgPSAw
IDsKLSAgICBzdGF0aWMgY29uc3QgY2hhciAqX19pbml0ZGF0YSBmZWF0dXJlX3N0cltdID0gewot
ICAgICAgICAiLSBQcmVmZXRjaCBQYWdlcyBDb21tYW5kIiwgCi0gICAgICAgICItIFBlcmlwaGVy
YWwgUGFnZSBTZXJ2aWNlIFJlcXVlc3QiLCAKLSAgICAgICAgIi0gWDJBUElDIFN1cHBvcnRlZCIs
IAotICAgICAgICAiLSBOWCBiaXQgU3VwcG9ydGVkIiwgCi0gICAgICAgICItIEd1ZXN0IFRyYW5z
bGF0aW9uIiwgCi0gICAgICAgICItIFJlc2VydmVkIGJpdCBbNV0iLAotICAgICAgICAiLSBJbnZh
bGlkYXRlIEFsbCBDb21tYW5kIiwgCi0gICAgICAgICItIEd1ZXN0IEFQSUMgc3VwcG9ydGVkIiwg
Ci0gICAgICAgICItIEhhcmR3YXJlIEVycm9yIFJlZ2lzdGVycyIsIAotICAgICAgICAiLSBQZXJm
b3JtYW5jZSBDb3VudGVycyIsIAotICAgICAgICBOVUxMCi0gICAgfTsKLQogICAgIEFTU0VSVCgg
aW9tbXUtPm1taW9fYmFzZSApOwogCiAgICAgaWYgKCAhaW9tbXVfaGFzX2NhcChpb21tdSwgUENJ
X0NBUF9FRlJTVVBfU0hJRlQpICkKICAgICB7Ci0gICAgICAgIGlvbW11LT5mZWF0dXJlcyA9IDA7
CisgICAgICAgIGlvbW11LT5mZWF0dXJlcy5yYXcgPSAwOwogICAgICAgICByZXR1cm47CiAgICAg
fQogCi0gICAgbG93ID0gcmVhZGwoaW9tbXUtPm1taW9fYmFzZSArIElPTU1VX0VYVF9GRUFUVVJF
X01NSU9fT0ZGU0VUKTsKLSAgICBoaWdoID0gcmVhZGwoaW9tbXUtPm1taW9fYmFzZSArIElPTU1V
X0VYVF9GRUFUVVJFX01NSU9fT0ZGU0VUICsgNCk7Ci0KLSAgICBpb21tdS0+ZmVhdHVyZXMgPSAo
KHU2NCloaWdoIDw8IDMyKSB8IGxvdzsKKyAgICBpb21tdS0+ZmVhdHVyZXMucmF3ID0KKyAgICAg
ICAgcmVhZHEoaW9tbXUtPm1taW9fYmFzZSArIElPTU1VX0VYVF9GRUFUVVJFX01NSU9fT0ZGU0VU
KTsKIAogICAgIHByaW50aygiQU1ELVZpOiBJT01NVSBFeHRlbmRlZCBGZWF0dXJlczpcbiIpOwog
Ci0gICAgd2hpbGUgKCBmZWF0dXJlX3N0cltpXSApCisjZGVmaW5lIE1BU0soZmxkKSAoKHVuaW9u
IGFtZF9pb21tdV9leHRfZmVhdHVyZXMpeyAuZmxkcy5mbGQgPSB+MCB9KS5yYXcKKyNkZWZpbmUg
RkVBVChmbGQsIHN0cikgZG8geyBcCisgICAgaWYgKCBNQVNLKGZsZCkgJiAoTUFTSyhmbGQpIC0g
MSkgKSBcCisgICAgICAgIHByaW50ayggIi0gIiBzdHIgIjogJSN4XG4iLCBpb21tdS0+ZmVhdHVy
ZXMuZmxkcy5mbGQpOyBcCisgICAgZWxzZSBpZiAoIGlvbW11LT5mZWF0dXJlcy5yYXcgJiBNQVNL
KGZsZCkgKSBcCisgICAgICAgIHByaW50ayggIi0gIiBzdHIgIlxuIik7IFwKK30gd2hpbGUgKCBm
YWxzZSApCisKKyAgICBGRUFUKHByZWZfc3VwLCAgICAgICAgICAgIlByZWZldGNoIFBhZ2VzIENv
bW1hbmQiKTsKKyAgICBGRUFUKHBwcl9zdXAsICAgICAgICAgICAgIlBlcmlwaGVyYWwgUGFnZSBT
ZXJ2aWNlIFJlcXVlc3QiKTsKKyAgICBGRUFUKHh0X3N1cCwgICAgICAgICAgICAgIngyQVBJQyIp
OworICAgIEZFQVQobnhfc3VwLCAgICAgICAgICAgICAiTlggYml0Iik7CisgICAgRkVBVChnYXBw
aV9zdXAsICAgICAgICAgICJHdWVzdCBBUElDIFBoeXNpY2FsIFByb2Nlc3NvciBJbnRlcnJ1cHQi
KTsKKyAgICBGRUFUKGlhX3N1cCwgICAgICAgICAgICAgIkludmFsaWRhdGUgQWxsIENvbW1hbmQi
KTsKKyAgICBGRUFUKGdhX3N1cCwgICAgICAgICAgICAgIkd1ZXN0IEFQSUMiKTsKKyAgICBGRUFU
KGhlX3N1cCwgICAgICAgICAgICAgIkhhcmR3YXJlIEVycm9yIFJlZ2lzdGVycyIpOworICAgIEZF
QVQocGNfc3VwLCAgICAgICAgICAgICAiUGVyZm9ybWFuY2UgQ291bnRlcnMiKTsKKyAgICBGRUFU
KGhhdHMsICAgICAgICAgICAgICAgIkhvc3QgQWRkcmVzcyBUcmFuc2xhdGlvbiBTaXplIik7CisK
KyAgICBpZiAoIGlvbW11LT5mZWF0dXJlcy5mbGRzLmd0X3N1cCApCiAgICAgewotICAgICAgICBp
ZiAoIGFtZF9pb21tdV9oYXNfZmVhdHVyZShpb21tdSwgaSkgKQotICAgICAgICAgICAgcHJpbnRr
KCAiICVzXG4iLCBmZWF0dXJlX3N0cltpXSk7Ci0gICAgICAgIGkrKzsKKyAgICAgICAgRkVBVChn
YXRzLCAgICAgICAgICAgIkd1ZXN0IEFkZHJlc3MgVHJhbnNsYXRpb24gU2l6ZSIpOworICAgICAg
ICBGRUFUKGdseF9zdXAsICAgICAgICAiR3Vlc3QgQ1IzIFJvb3QgVGFibGUgTGV2ZWwiKTsKKyAg
ICAgICAgRkVBVChwYXNfbWF4LCAgICAgICAgIk1heGltdW0gUEFTSUQiKTsKICAgICB9CisKKyAg
ICBGRUFUKHNtaWZfc3VwLCAgICAgICAgICAgIlNNSSBGaWx0ZXIgUmVnaXN0ZXIiKTsKKyAgICBG
RUFUKHNtaWZfcmMsICAgICAgICAgICAgIlNNSSBGaWx0ZXIgUmVnaXN0ZXIgQ291bnQiKTsKKyAg
ICBGRUFUKGdhbV9zdXAsICAgICAgICAgICAgIkd1ZXN0IFZpcnR1YWwgQVBJQyBNb2RlcyIpOwor
ICAgIEZFQVQoZHVhbF9wcHJfbG9nX3N1cCwgICAiRHVhbCBQUFIgTG9nIik7CisgICAgRkVBVChk
dWFsX2V2ZW50X2xvZ19zdXAsICJEdWFsIEV2ZW50IExvZyIpOworICAgIEZFQVQoc2F0X3N1cCwg
ICAgICAgICAgICAiU2VjdXJlIEFUUyIpOworICAgIEZFQVQodXNfc3VwLCAgICAgICAgICAgICAi
VXNlciAvIFN1cGVydmlzb3IgUGFnZSBQcm90ZWN0aW9uIik7CisgICAgRkVBVChkZXZfdGJsX3Nl
Z19zdXAsICAgICJEZXZpY2UgVGFibGUgU2VnbWVudGF0aW9uIik7CisgICAgRkVBVChwcHJfZWFy
bHlfb2Zfc3VwLCAgICJQUFIgTG9nIE92ZXJmbG93IEVhcmx5IFdhcm5pbmciKTsKKyAgICBGRUFU
KHBwcl9hdXRvX3JzcF9zdXAsICAgIlBQUiBBdXRvbWF0aWMgUmVzcG9uc2UiKTsKKyAgICBGRUFU
KG1hcmNfc3VwLCAgICAgICAgICAgIk1lbW9yeSBBY2Nlc3MgUm91dGluZyBhbmQgQ29udHJvbCIp
OworICAgIEZFQVQoYmxrX3N0b3BfbXJrX3N1cCwgICAiQmxvY2sgU3RvcE1hcmsgTWVzc2FnZSIp
OworICAgIEZFQVQocGVyZl9vcHRfc3VwICwgICAgICAiUGVyZm9ybWFuY2UgT3B0aW1pemF0aW9u
Iik7CisgICAgRkVBVChtc2lfY2FwX21taW9fc3VwLCAgICJNU0kgQ2FwYWJpbGl0eSBNTUlPIEFj
Y2VzcyIpOworICAgIEZFQVQoZ2lvX3N1cCwgICAgICAgICAgICAiR3Vlc3QgSS9PIFByb3RlY3Rp
b24iKTsKKyAgICBGRUFUKGhhX3N1cCwgICAgICAgICAgICAgIkhvc3QgQWNjZXNzIik7CisgICAg
RkVBVChlcGhfc3VwLCAgICAgICAgICAgICJFbmhhbmNlZCBQUFIgSGFuZGxpbmciKTsKKyAgICBG
RUFUKGF0dHJfZndfc3VwLCAgICAgICAgIkF0dHJpYnV0ZSBGb3J3YXJkIik7CisgICAgRkVBVCho
ZF9zdXAsICAgICAgICAgICAgICJIb3N0IERpcnR5Iik7CisgICAgRkVBVChpbnZfaW90bGJfdHlw
ZV9zdXAsICJJbnZhbGlkYXRlIElPVExCIFR5cGUiKTsKKyAgICBGRUFUKHZpb21tdV9zdXAsICAg
ICAgICAgIlZpcnR1YWxpemVkIElPTU1VIik7CisgICAgRkVBVCh2bV9ndWFyZF9pb19zdXAsICAg
ICJWTUd1YXJkIEkvTyBTdXBwb3J0Iik7CisgICAgRkVBVCh2bV90YWJsZV9zaXplLCAgICAgICJW
TSBUYWJsZSBTaXplIik7CisgICAgRkVBVChnYV91cGRhdGVfZGlzX3N1cCwgICJHdWVzdCBBY2Nl
c3MgQml0IFVwZGF0ZSBEaXNhYmxlIik7CisKKyN1bmRlZiBGRUFUCisjdW5kZWYgTUFTSwogfQog
CiBpbnQgX19pbml0IGFtZF9pb21tdV9kZXRlY3Rfb25lX2FjcGkoCi0tLSBhL3hlbi9kcml2ZXJz
L3Bhc3N0aHJvdWdoL2FtZC9pb21tdV9ndWVzdC5jCisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJv
dWdoL2FtZC9pb21tdV9ndWVzdC5jCkBAIC02MzgsNyArNjM4LDcgQEAgc3RhdGljIHVpbnQ2NF90
IGlvbW11X21taW9fcmVhZDY0KHN0cnVjdAogICAgICAgICB2YWwgPSByZWdfdG9fdTY0KGlvbW11
LT5yZWdfc3RhdHVzKTsKICAgICAgICAgYnJlYWs7CiAgICAgY2FzZSBJT01NVV9FWFRfRkVBVFVS
RV9NTUlPX09GRlNFVDoKLSAgICAgICAgdmFsID0gcmVnX3RvX3U2NChpb21tdS0+cmVnX2V4dF9m
ZWF0dXJlKTsKKyAgICAgICAgdmFsID0gaW9tbXUtPnJlZ19leHRfZmVhdHVyZS5yYXc7CiAgICAg
ICAgIGJyZWFrOwogCiAgICAgZGVmYXVsdDoKQEAgLTgwMiwzOSArODAyLDI2IEBAIGludCBndWVz
dF9pb21tdV9zZXRfYmFzZShzdHJ1Y3QgZG9tYWluICoKIC8qIEluaXRpYWxpemUgbW1pbyByZWFk
IG9ubHkgYml0cyAqLwogc3RhdGljIHZvaWQgZ3Vlc3RfaW9tbXVfcmVnX2luaXQoc3RydWN0IGd1
ZXN0X2lvbW11ICppb21tdSkKIHsKLSAgICB1aW50MzJfdCBsb3dlciwgdXBwZXI7CisgICAgdW5p
b24gYW1kX2lvbW11X2V4dF9mZWF0dXJlcyBlZiA9IHsKKyAgICAgICAgLyogU3VwcG9ydCBwcmVm
ZXRjaCAqLworICAgICAgICAuZmxkcy5wcmVmX3N1cCA9IDEsCisgICAgICAgIC8qIFN1cHBvcnQg
UFBSIGxvZyAqLworICAgICAgICAuZmxkcy5wcHJfc3VwID0gMSwKKyAgICAgICAgLyogU3VwcG9y
dCBndWVzdCB0cmFuc2xhdGlvbiAqLworICAgICAgICAuZmxkcy5ndF9zdXAgPSAxLAorICAgICAg
ICAvKiBTdXBwb3J0IGludmFsaWRhdGUgYWxsIGNvbW1hbmQgKi8KKyAgICAgICAgLmZsZHMuaWFf
c3VwID0gMSwKKyAgICAgICAgLyogSG9zdCB0cmFuc2xhdGlvbiBzaXplIGhhcyA2IGxldmVscyAq
LworICAgICAgICAuZmxkcy5oYXRzID0gSE9TVF9BRERSRVNTX1NJWkVfNl9MRVZFTCwKKyAgICAg
ICAgLyogR3Vlc3QgdHJhbnNsYXRpb24gc2l6ZSBoYXMgNiBsZXZlbHMgKi8KKyAgICAgICAgLmZs
ZHMuZ2F0cyA9IEdVRVNUX0FERFJFU1NfU0laRV82X0xFVkVMLAorICAgICAgICAvKiBTaW5nbGUg
bGV2ZWwgZ0NSMyAqLworICAgICAgICAuZmxkcy5nbHhfc3VwID0gR1VFU1RfQ1IzXzFfTEVWRUws
CisgICAgICAgIC8qIDkgYml0IFBBU0lEICovCisgICAgICAgIC5mbGRzLnBhc19tYXggPSBQQVNN
QVhfOV9iaXQsCisgICAgfTsKIAotICAgIGxvd2VyID0gdXBwZXIgPSAwOwotICAgIC8qIFN1cHBv
cnQgcHJlZmV0Y2ggKi8KLSAgICBpb21tdV9zZXRfYml0KCZsb3dlcixJT01NVV9FWFRfRkVBVFVS
RV9QUkVGU1VQX1NISUZUKTsKLSAgICAvKiBTdXBwb3J0IFBQUiBsb2cgKi8KLSAgICBpb21tdV9z
ZXRfYml0KCZsb3dlcixJT01NVV9FWFRfRkVBVFVSRV9QUFJTVVBfU0hJRlQpOwotICAgIC8qIFN1
cHBvcnQgZ3Vlc3QgdHJhbnNsYXRpb24gKi8KLSAgICBpb21tdV9zZXRfYml0KCZsb3dlcixJT01N
VV9FWFRfRkVBVFVSRV9HVFNVUF9TSElGVCk7Ci0gICAgLyogU3VwcG9ydCBpbnZhbGlkYXRlIGFs
bCBjb21tYW5kICovCi0gICAgaW9tbXVfc2V0X2JpdCgmbG93ZXIsSU9NTVVfRVhUX0ZFQVRVUkVf
SUFTVVBfU0hJRlQpOwotCi0gICAgLyogSG9zdCB0cmFuc2xhdGlvbiBzaXplIGhhcyA2IGxldmVs
cyAqLwotICAgIHNldF9maWVsZF9pbl9yZWdfdTMyKEhPU1RfQUREUkVTU19TSVpFXzZfTEVWRUws
IGxvd2VyLAotICAgICAgICAgICAgICAgICAgICAgICAgIElPTU1VX0VYVF9GRUFUVVJFX0hBVFNf
TUFTSywKLSAgICAgICAgICAgICAgICAgICAgICAgICBJT01NVV9FWFRfRkVBVFVSRV9IQVRTX1NI
SUZULAotICAgICAgICAgICAgICAgICAgICAgICAgICZsb3dlcik7Ci0gICAgLyogR3Vlc3QgdHJh
bnNsYXRpb24gc2l6ZSBoYXMgNiBsZXZlbHMgKi8KLSAgICBzZXRfZmllbGRfaW5fcmVnX3UzMihH
VUVTVF9BRERSRVNTX1NJWkVfNl9MRVZFTCwgbG93ZXIsCi0gICAgICAgICAgICAgICAgICAgICAg
ICAgSU9NTVVfRVhUX0ZFQVRVUkVfR0FUU19NQVNLLAotICAgICAgICAgICAgICAgICAgICAgICAg
IElPTU1VX0VYVF9GRUFUVVJFX0dBVFNfU0hJRlQsCi0gICAgICAgICAgICAgICAgICAgICAgICAg
Jmxvd2VyKTsKLSAgICAvKiBTaW5nbGUgbGV2ZWwgZ0NSMyAqLwotICAgIHNldF9maWVsZF9pbl9y
ZWdfdTMyKEdVRVNUX0NSM18xX0xFVkVMLCBsb3dlciwKLSAgICAgICAgICAgICAgICAgICAgICAg
ICBJT01NVV9FWFRfRkVBVFVSRV9HTFhTVVBfTUFTSywKLSAgICAgICAgICAgICAgICAgICAgICAg
ICBJT01NVV9FWFRfRkVBVFVSRV9HTFhTVVBfU0hJRlQsICZsb3dlcik7Ci0gICAgLyogOSBiaXQg
UEFTSUQgKi8KLSAgICBzZXRfZmllbGRfaW5fcmVnX3UzMihQQVNNQVhfOV9iaXQsIHVwcGVyLAot
ICAgICAgICAgICAgICAgICAgICAgICAgIElPTU1VX0VYVF9GRUFUVVJFX1BBU01BWF9NQVNLLAot
ICAgICAgICAgICAgICAgICAgICAgICAgIElPTU1VX0VYVF9GRUFUVVJFX1BBU01BWF9TSElGVCwg
JnVwcGVyKTsKLQotICAgIGlvbW11LT5yZWdfZXh0X2ZlYXR1cmUubG8gPSBsb3dlcjsKLSAgICBp
b21tdS0+cmVnX2V4dF9mZWF0dXJlLmhpID0gdXBwZXI7CisgICAgaW9tbXUtPnJlZ19leHRfZmVh
dHVyZSA9IGVmOwogfQogCiBzdGF0aWMgaW50IGd1ZXN0X2lvbW11X21taW9fcmFuZ2Uoc3RydWN0
IHZjcHUgKnYsIHVuc2lnbmVkIGxvbmcgYWRkcikKLS0tIGEveGVuL2RyaXZlcnMvcGFzc3Rocm91
Z2gvYW1kL2lvbW11X2luaXQuYworKysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9t
bXVfaW5pdC5jCkBAIC04ODMsNyArODgzLDcgQEAgc3RhdGljIHZvaWQgZW5hYmxlX2lvbW11KHN0
cnVjdCBhbWRfaW9tbQogICAgIHJlZ2lzdGVyX2lvbW11X2V2ZW50X2xvZ19pbl9tbWlvX3NwYWNl
KGlvbW11KTsKICAgICByZWdpc3Rlcl9pb21tdV9leGNsdXNpb25fcmFuZ2UoaW9tbXUpOwogCi0g
ICAgaWYgKCBhbWRfaW9tbXVfaGFzX2ZlYXR1cmUoaW9tbXUsIElPTU1VX0VYVF9GRUFUVVJFX1BQ
UlNVUF9TSElGVCkgKQorICAgIGlmICggaW9tbXUtPmZlYXR1cmVzLmZsZHMucHByX3N1cCApCiAg
ICAgICAgIHJlZ2lzdGVyX2lvbW11X3Bwcl9sb2dfaW5fbW1pb19zcGFjZShpb21tdSk7CiAKICAg
ICBkZXNjID0gaXJxX3RvX2Rlc2MoaW9tbXUtPm1zaS5pcnEpOwpAQCAtODk3LDE1ICs4OTcsMTUg
QEAgc3RhdGljIHZvaWQgZW5hYmxlX2lvbW11KHN0cnVjdCBhbWRfaW9tbQogICAgIHNldF9pb21t
dV9jb21tYW5kX2J1ZmZlcl9jb250cm9sKGlvbW11LCBJT01NVV9DT05UUk9MX0VOQUJMRUQpOwog
ICAgIHNldF9pb21tdV9ldmVudF9sb2dfY29udHJvbChpb21tdSwgSU9NTVVfQ09OVFJPTF9FTkFC
TEVEKTsKIAotICAgIGlmICggYW1kX2lvbW11X2hhc19mZWF0dXJlKGlvbW11LCBJT01NVV9FWFRf
RkVBVFVSRV9QUFJTVVBfU0hJRlQpICkKKyAgICBpZiAoIGlvbW11LT5mZWF0dXJlcy5mbGRzLnBw
cl9zdXAgKQogICAgICAgICBzZXRfaW9tbXVfcHByX2xvZ19jb250cm9sKGlvbW11LCBJT01NVV9D
T05UUk9MX0VOQUJMRUQpOwogCi0gICAgaWYgKCBhbWRfaW9tbXVfaGFzX2ZlYXR1cmUoaW9tbXUs
IElPTU1VX0VYVF9GRUFUVVJFX0dUU1VQX1NISUZUKSApCisgICAgaWYgKCBpb21tdS0+ZmVhdHVy
ZXMuZmxkcy5ndF9zdXAgKQogICAgICAgICBzZXRfaW9tbXVfZ3Vlc3RfdHJhbnNsYXRpb25fY29u
dHJvbChpb21tdSwgSU9NTVVfQ09OVFJPTF9FTkFCTEVEKTsKIAogICAgIHNldF9pb21tdV90cmFu
c2xhdGlvbl9jb250cm9sKGlvbW11LCBJT01NVV9DT05UUk9MX0VOQUJMRUQpOwogCi0gICAgaWYg
KCBhbWRfaW9tbXVfaGFzX2ZlYXR1cmUoaW9tbXUsIElPTU1VX0VYVF9GRUFUVVJFX0lBU1VQX1NI
SUZUKSApCisgICAgaWYgKCBpb21tdS0+ZmVhdHVyZXMuZmxkcy5pYV9zdXAgKQogICAgICAgICBh
bWRfaW9tbXVfZmx1c2hfYWxsX2NhY2hlcyhpb21tdSk7CiAKICAgICBpb21tdS0+ZW5hYmxlZCA9
IDE7CkBAIC05MjgsMTAgKzkyOCwxMCBAQCBzdGF0aWMgdm9pZCBkaXNhYmxlX2lvbW11KHN0cnVj
dCBhbWRfaW9tCiAgICAgc2V0X2lvbW11X2NvbW1hbmRfYnVmZmVyX2NvbnRyb2woaW9tbXUsIElP
TU1VX0NPTlRST0xfRElTQUJMRUQpOwogICAgIHNldF9pb21tdV9ldmVudF9sb2dfY29udHJvbChp
b21tdSwgSU9NTVVfQ09OVFJPTF9ESVNBQkxFRCk7CiAKLSAgICBpZiAoIGFtZF9pb21tdV9oYXNf
ZmVhdHVyZShpb21tdSwgSU9NTVVfRVhUX0ZFQVRVUkVfUFBSU1VQX1NISUZUKSApCisgICAgaWYg
KCBpb21tdS0+ZmVhdHVyZXMuZmxkcy5wcHJfc3VwICkKICAgICAgICAgc2V0X2lvbW11X3Bwcl9s
b2dfY29udHJvbChpb21tdSwgSU9NTVVfQ09OVFJPTF9ESVNBQkxFRCk7CiAKLSAgICBpZiAoIGFt
ZF9pb21tdV9oYXNfZmVhdHVyZShpb21tdSwgSU9NTVVfRVhUX0ZFQVRVUkVfR1RTVVBfU0hJRlQp
ICkKKyAgICBpZiAoIGlvbW11LT5mZWF0dXJlcy5mbGRzLmd0X3N1cCApCiAgICAgICAgIHNldF9p
b21tdV9ndWVzdF90cmFuc2xhdGlvbl9jb250cm9sKGlvbW11LCBJT01NVV9DT05UUk9MX0RJU0FC
TEVEKTsKIAogICAgIHNldF9pb21tdV90cmFuc2xhdGlvbl9jb250cm9sKGlvbW11LCBJT01NVV9D
T05UUk9MX0RJU0FCTEVEKTsKQEAgLTEwMjcsNyArMTAyNyw3IEBAIHN0YXRpYyBpbnQgX19pbml0
IGFtZF9pb21tdV9pbml0X29uZShzdHIKIAogICAgIGdldF9pb21tdV9mZWF0dXJlcyhpb21tdSk7
CiAKLSAgICBpZiAoIGlvbW11LT5mZWF0dXJlcyApCisgICAgaWYgKCBpb21tdS0+ZmVhdHVyZXMu
cmF3ICkKICAgICAgICAgaW9tbXV2Ml9lbmFibGVkID0gMTsKIAogICAgIGlmICggYWxsb2NhdGVf
Y21kX2J1ZmZlcihpb21tdSkgPT0gTlVMTCApCkBAIC0xMDM2LDkgKzEwMzYsOCBAQCBzdGF0aWMg
aW50IF9faW5pdCBhbWRfaW9tbXVfaW5pdF9vbmUoc3RyCiAgICAgaWYgKCBhbGxvY2F0ZV9ldmVu
dF9sb2coaW9tbXUpID09IE5VTEwgKQogICAgICAgICBnb3RvIGVycm9yX291dDsKIAotICAgIGlm
ICggYW1kX2lvbW11X2hhc19mZWF0dXJlKGlvbW11LCBJT01NVV9FWFRfRkVBVFVSRV9QUFJTVVBf
U0hJRlQpICkKLSAgICAgICAgaWYgKCBhbGxvY2F0ZV9wcHJfbG9nKGlvbW11KSA9PSBOVUxMICkK
LSAgICAgICAgICAgIGdvdG8gZXJyb3Jfb3V0OworICAgIGlmICggaW9tbXUtPmZlYXR1cmVzLmZs
ZHMucHByX3N1cCAmJiAhYWxsb2NhdGVfcHByX2xvZyhpb21tdSkgKQorICAgICAgICBnb3RvIGVy
cm9yX291dDsKIAogICAgIGlmICggIXNldF9pb21tdV9pbnRlcnJ1cHRfaGFuZGxlcihpb21tdSkg
KQogICAgICAgICBnb3RvIGVycm9yX291dDsKQEAgLTEzODksNyArMTM4OCw3IEBAIHZvaWQgYW1k
X2lvbW11X3Jlc3VtZSh2b2lkKQogICAgIH0KIAogICAgIC8qIGZsdXNoIGFsbCBjYWNoZSBlbnRy
aWVzIGFmdGVyIGlvbW11IHJlLWVuYWJsZWQgKi8KLSAgICBpZiAoICFhbWRfaW9tbXVfaGFzX2Zl
YXR1cmUoaW9tbXUsIElPTU1VX0VYVF9GRUFUVVJFX0lBU1VQX1NISUZUKSApCisgICAgaWYgKCAh
aW9tbXUtPmZlYXR1cmVzLmZsZHMuaWFfc3VwICkKICAgICB7CiAgICAgICAgIGludmFsaWRhdGVf
YWxsX2RldmljZXMoKTsKICAgICAgICAgaW52YWxpZGF0ZV9hbGxfZG9tYWluX3BhZ2VzKCk7Ci0t
LSBhL3hlbi9pbmNsdWRlL2FzbS14ODYvYW1kLWlvbW11LmgKKysrIGIveGVuL2luY2x1ZGUvYXNt
LXg4Ni9hbWQtaW9tbXUuaApAQCAtODMsNyArODMsNyBAQCBzdHJ1Y3QgYW1kX2lvbW11IHsKICAg
ICBpb21tdV9jYXBfdCBjYXA7CiAKICAgICB1OCBodF9mbGFnczsKLSAgICB1NjQgZmVhdHVyZXM7
CisgICAgdW5pb24gYW1kX2lvbW11X2V4dF9mZWF0dXJlcyBmZWF0dXJlczsKIAogICAgIHZvaWQg
Km1taW9fYmFzZTsKICAgICB1bnNpZ25lZCBsb25nIG1taW9fYmFzZV9waHlzOwpAQCAtMTc0LDcg
KzE3NCw3IEBAIHN0cnVjdCBndWVzdF9pb21tdSB7CiAgICAgLyogTU1JTyByZWdzICovCiAgICAg
c3RydWN0IG1taW9fcmVnICAgICAgICAgcmVnX2N0cmw7ICAgICAgICAgICAgICAvKiBNTUlPIG9m
ZnNldCAwMDE4aCAqLwogICAgIHN0cnVjdCBtbWlvX3JlZyAgICAgICAgIHJlZ19zdGF0dXM7ICAg
ICAgICAgICAgLyogTU1JTyBvZmZzZXQgMjAyMGggKi8KLSAgICBzdHJ1Y3QgbW1pb19yZWcgICAg
ICAgICByZWdfZXh0X2ZlYXR1cmU7ICAgICAgIC8qIE1NSU8gb2Zmc2V0IDAwMzBoICovCisgICAg
dW5pb24gYW1kX2lvbW11X2V4dF9mZWF0dXJlcyByZWdfZXh0X2ZlYXR1cmU7ICAvKiBNTUlPIG9m
ZnNldCAwMDMwaCAqLwogCiAgICAgLyogZ3Vlc3QgaW50ZXJydXB0IHNldHRpbmdzICovCiAgICAg
c3RydWN0IGd1ZXN0X2lvbW11X21zaSAgbXNpOwotLS0gYS94ZW4vaW5jbHVkZS9hc20teDg2L2h2
bS9zdm0vYW1kLWlvbW11LWRlZnMuaAorKysgYi94ZW4vaW5jbHVkZS9hc20teDg2L2h2bS9zdm0v
YW1kLWlvbW11LWRlZnMuaApAQCAtMzQ2LDI2ICszNDYsNTcgQEAgc3RydWN0IGFtZF9pb21tdV9k
dGUgewogI2RlZmluZSBJT01NVV9FWENMVVNJT05fTElNSVRfSElHSF9NQVNLCQkweEZGRkZGRkZG
CiAjZGVmaW5lIElPTU1VX0VYQ0xVU0lPTl9MSU1JVF9ISUdIX1NISUZUCTAKIAotLyogRXh0ZW5k
ZWQgRmVhdHVyZSBSZWdpc3RlciovCisvKiBFeHRlbmRlZCBGZWF0dXJlIFJlZ2lzdGVyICovCiAj
ZGVmaW5lIElPTU1VX0VYVF9GRUFUVVJFX01NSU9fT0ZGU0VUICAgICAgICAgICAgICAgICAgIDB4
MzAKLSNkZWZpbmUgSU9NTVVfRVhUX0ZFQVRVUkVfUFJFRlNVUF9TSElGVCAgICAgICAgICAgICAg
ICAgMHgwCi0jZGVmaW5lIElPTU1VX0VYVF9GRUFUVVJFX1BQUlNVUF9TSElGVCAgICAgICAgICAg
ICAgICAgIDB4MQotI2RlZmluZSBJT01NVV9FWFRfRkVBVFVSRV9YVFNVUF9TSElGVCAgICAgICAg
ICAgICAgICAgICAweDIKLSNkZWZpbmUgSU9NTVVfRVhUX0ZFQVRVUkVfTlhTVVBfU0hJRlQgICAg
ICAgICAgICAgICAgICAgMHgzCi0jZGVmaW5lIElPTU1VX0VYVF9GRUFUVVJFX0dUU1VQX1NISUZU
ICAgICAgICAgICAgICAgICAgIDB4NAotI2RlZmluZSBJT01NVV9FWFRfRkVBVFVSRV9JQVNVUF9T
SElGVCAgICAgICAgICAgICAgICAgICAweDYKLSNkZWZpbmUgSU9NTVVfRVhUX0ZFQVRVUkVfR0FT
VVBfU0hJRlQgICAgICAgICAgICAgICAgICAgMHg3Ci0jZGVmaW5lIElPTU1VX0VYVF9GRUFUVVJF
X0hFU1VQX1NISUZUICAgICAgICAgICAgICAgICAgIDB4OAotI2RlZmluZSBJT01NVV9FWFRfRkVB
VFVSRV9QQ1NVUF9TSElGVCAgICAgICAgICAgICAgICAgICAweDkKLSNkZWZpbmUgSU9NTVVfRVhU
X0ZFQVRVUkVfSEFUU19TSElGVCAgICAgICAgICAgICAgICAgICAgMHgxMAotI2RlZmluZSBJT01N
VV9FWFRfRkVBVFVSRV9IQVRTX01BU0sgICAgICAgICAgICAgICAgICAgICAweDAwMDAwQzAwCi0j
ZGVmaW5lIElPTU1VX0VYVF9GRUFUVVJFX0dBVFNfU0hJRlQgICAgICAgICAgICAgICAgICAgIDB4
MTIKLSNkZWZpbmUgSU9NTVVfRVhUX0ZFQVRVUkVfR0FUU19NQVNLICAgICAgICAgICAgICAgICAg
ICAgMHgwMDAwMzAwMAotI2RlZmluZSBJT01NVV9FWFRfRkVBVFVSRV9HTFhTVVBfU0hJRlQgICAg
ICAgICAgICAgICAgICAweDE0Ci0jZGVmaW5lIElPTU1VX0VYVF9GRUFUVVJFX0dMWFNVUF9NQVNL
ICAgICAgICAgICAgICAgICAgIDB4MDAwMEMwMDAKIAotI2RlZmluZSBJT01NVV9FWFRfRkVBVFVS
RV9QQVNNQVhfU0hJRlQgICAgICAgICAgICAgICAgICAweDAKLSNkZWZpbmUgSU9NTVVfRVhUX0ZF
QVRVUkVfUEFTTUFYX01BU0sgICAgICAgICAgICAgICAgICAgMHgwMDAwMDAxRgordW5pb24gYW1k
X2lvbW11X2V4dF9mZWF0dXJlcyB7CisgICAgdWludDY0X3QgcmF3OworICAgIHN0cnVjdCB7Cisg
ICAgICAgIHVuc2lnbmVkIGludCBwcmVmX3N1cDoxOworICAgICAgICB1bnNpZ25lZCBpbnQgcHBy
X3N1cDoxOworICAgICAgICB1bnNpZ25lZCBpbnQgeHRfc3VwOjE7CisgICAgICAgIHVuc2lnbmVk
IGludCBueF9zdXA6MTsKKyAgICAgICAgdW5zaWduZWQgaW50IGd0X3N1cDoxOworICAgICAgICB1
bnNpZ25lZCBpbnQgZ2FwcGlfc3VwOjE7CisgICAgICAgIHVuc2lnbmVkIGludCBpYV9zdXA6MTsK
KyAgICAgICAgdW5zaWduZWQgaW50IGdhX3N1cDoxOworICAgICAgICB1bnNpZ25lZCBpbnQgaGVf
c3VwOjE7CisgICAgICAgIHVuc2lnbmVkIGludCBwY19zdXA6MTsKKyAgICAgICAgdW5zaWduZWQg
aW50IGhhdHM6MjsKKyAgICAgICAgdW5zaWduZWQgaW50IGdhdHM6MjsKKyAgICAgICAgdW5zaWdu
ZWQgaW50IGdseF9zdXA6MjsKKyAgICAgICAgdW5zaWduZWQgaW50IHNtaWZfc3VwOjI7CisgICAg
ICAgIHVuc2lnbmVkIGludCBzbWlmX3JjOjM7CisgICAgICAgIHVuc2lnbmVkIGludCBnYW1fc3Vw
OjM7CisgICAgICAgIHVuc2lnbmVkIGludCBkdWFsX3Bwcl9sb2dfc3VwOjI7CisgICAgICAgIHVu
c2lnbmVkIGludCA6MjsKKyAgICAgICAgdW5zaWduZWQgaW50IGR1YWxfZXZlbnRfbG9nX3N1cDoy
OworICAgICAgICB1bnNpZ25lZCBpbnQgc2F0X3N1cDoxOworICAgICAgICB1bnNpZ25lZCBpbnQg
OjE7CisgICAgICAgIHVuc2lnbmVkIGludCBwYXNfbWF4OjU7CisgICAgICAgIHVuc2lnbmVkIGlu
dCB1c19zdXA6MTsKKyAgICAgICAgdW5zaWduZWQgaW50IGRldl90Ymxfc2VnX3N1cDoyOworICAg
ICAgICB1bnNpZ25lZCBpbnQgcHByX2Vhcmx5X29mX3N1cDoxOworICAgICAgICB1bnNpZ25lZCBp
bnQgcHByX2F1dG9fcnNwX3N1cDoxOworICAgICAgICB1bnNpZ25lZCBpbnQgbWFyY19zdXA6MjsK
KyAgICAgICAgdW5zaWduZWQgaW50IGJsa19zdG9wX21ya19zdXA6MTsKKyAgICAgICAgdW5zaWdu
ZWQgaW50IHBlcmZfb3B0X3N1cDoxOworICAgICAgICB1bnNpZ25lZCBpbnQgbXNpX2NhcF9tbWlv
X3N1cDoxOworICAgICAgICB1bnNpZ25lZCBpbnQgOjE7CisgICAgICAgIHVuc2lnbmVkIGludCBn
aW9fc3VwOjE7CisgICAgICAgIHVuc2lnbmVkIGludCBoYV9zdXA6MTsKKyAgICAgICAgdW5zaWdu
ZWQgaW50IGVwaF9zdXA6MTsKKyAgICAgICAgdW5zaWduZWQgaW50IGF0dHJfZndfc3VwOjE7Cisg
ICAgICAgIHVuc2lnbmVkIGludCBoZF9zdXA6MTsKKyAgICAgICAgdW5zaWduZWQgaW50IDoxOwor
ICAgICAgICB1bnNpZ25lZCBpbnQgaW52X2lvdGxiX3R5cGVfc3VwOjE7CisgICAgICAgIHVuc2ln
bmVkIGludCB2aW9tbXVfc3VwOjE7CisgICAgICAgIHVuc2lnbmVkIGludCB2bV9ndWFyZF9pb19z
dXA6MTsKKyAgICAgICAgdW5zaWduZWQgaW50IHZtX3RhYmxlX3NpemU6NDsKKyAgICAgICAgdW5z
aWduZWQgaW50IGdhX3VwZGF0ZV9kaXNfc3VwOjE7CisgICAgICAgIHVuc2lnbmVkIGludCA6MjsK
KyAgICB9IGZsZHM7Cit9OwogCiAvKiBTdGF0dXMgUmVnaXN0ZXIqLwogI2RlZmluZSBJT01NVV9T
VEFUVVNfTU1JT19PRkZTRVQJCTB4MjAyMAotLS0gYS94ZW4vaW5jbHVkZS9hc20teDg2L2h2bS9z
dm0vYW1kLWlvbW11LXByb3RvLmgKKysrIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9odm0vc3ZtL2Ft
ZC1pb21tdS1wcm90by5oCkBAIC0yMTksMTMgKzIxOSw2IEBAIHN0YXRpYyBpbmxpbmUgaW50IGlv
bW11X2hhc19jYXAoc3RydWN0IGEKICAgICByZXR1cm4gISEoaW9tbXUtPmNhcC5oZWFkZXIgJiAo
MXUgPDwgYml0KSk7CiB9CiAKLXN0YXRpYyBpbmxpbmUgaW50IGFtZF9pb21tdV9oYXNfZmVhdHVy
ZShzdHJ1Y3QgYW1kX2lvbW11ICppb21tdSwgdWludDMyX3QgYml0KQotewotICAgIGlmICggIWlv
bW11X2hhc19jYXAoaW9tbXUsIFBDSV9DQVBfRUZSU1VQX1NISUZUKSApCi0gICAgICAgIHJldHVy
biAwOwotICAgIHJldHVybiAhIShpb21tdS0+ZmVhdHVyZXMgJiAoMVUgPDwgYml0KSk7Ci19Ci0K
IC8qIGFjY2VzcyB0YWlsIG9yIGhlYWQgcG9pbnRlciBvZiByaW5nIGJ1ZmZlciAqLwogc3RhdGlj
IGlubGluZSB1aW50MzJfdCBpb21tdV9nZXRfcmJfcG9pbnRlcih1aW50MzJfdCByZWcpCiB7CgoK
CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2
ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xp
c3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

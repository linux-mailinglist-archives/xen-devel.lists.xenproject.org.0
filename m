Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 126E17E9B38
	for <lists+xen-devel@lfdr.de>; Mon, 13 Nov 2023 12:31:08 +0100 (CET)
Received: from list by lists.xenproject.org with outflank-mailman.631534.984921 (Exim 4.92)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1r2V8q-0008Ln-Br; Mon, 13 Nov 2023 11:30:08 +0000
X-Outflank-Mailman: Message body and most headers restored to incoming version
Received: by outflank-mailman (output) from mailman id 631534.984921; Mon, 13 Nov 2023 11:30:08 +0000
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.92)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1r2V8q-0008Jc-9D; Mon, 13 Nov 2023 11:30:08 +0000
Received: by outflank-mailman (input) for mailman id 631534;
 Mon, 13 Nov 2023 11:30:07 +0000
Received: from se1-gles-sth1-in.inumbo.com ([159.253.27.254]
 helo=se1-gles-sth1.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.92) (envelope-from
 <SRS0=JPUY=G2=gmail.com=marietto2008@srs-se1.protection.inumbo.net>)
 id 1r2V8p-0008JW-N1
 for xen-devel@lists.xenproject.org; Mon, 13 Nov 2023 11:30:07 +0000
Received: from mail-ej1-x62c.google.com (mail-ej1-x62c.google.com
 [2a00:1450:4864:20::62c])
 by se1-gles-sth1.inumbo.com (Halon) with ESMTPS
 id fe6d82f5-8217-11ee-98da-6d05b1d4d9a1;
 Mon, 13 Nov 2023 12:30:06 +0100 (CET)
Received: by mail-ej1-x62c.google.com with SMTP id
 a640c23a62f3a-991c786369cso663322066b.1
 for <xen-devel@lists.xenproject.org>; Mon, 13 Nov 2023 03:30:06 -0800 (PST)
X-BeenThere: xen-devel@lists.xenproject.org
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Errors-To: xen-devel-bounces@lists.xenproject.org
Precedence: list
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>
X-Inumbo-ID: fe6d82f5-8217-11ee-98da-6d05b1d4d9a1
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20230601; t=1699875005; x=1700479805; darn=lists.xenproject.org;
        h=to:subject:message-id:date:from:mime-version:from:to:cc:subject
         :date:message-id:reply-to;
        bh=DtCyPPM4273jVtYbR9To4aJCWKPYJii5McTWBg+Uj2Q=;
        b=SV8W77FLIQFt1ES8Td0P2A3MCHoRPn/baEyFbBx+Umu15VWsn+QOvsQPIBdQDY6Hli
         yVFYDX1E0joml2RwJ5w+X2BlyQIw7aLBZwGUDLZ36dVCnPDQasXirFjoEtkoR9wTJtHQ
         zfoKMr6nTA0nms2ejbpIlIDy4uDZgBAvVz7tLvq8coX9ThADQJJntapEQGrqOtjNIIrD
         YgWp/hlPz4+B4aEOJvZd28VZekXLSB05RBc/xqA2Ucy1jxgHGc7FynU+wENOnARgC4wI
         8CV61FOc3Sgz6DZGK+QppW64FgN4Tk4eOA25pAV04a3xh3XGnJL5DdMhVfeEGJ9b7SBk
         kILg==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1699875005; x=1700479805;
        h=to:subject:message-id:date:from:mime-version:x-gm-message-state
         :from:to:cc:subject:date:message-id:reply-to;
        bh=DtCyPPM4273jVtYbR9To4aJCWKPYJii5McTWBg+Uj2Q=;
        b=gwURv5Dn1oeZo/GOiHud+vNGStfJNdK5BIkou5mXhRsml8Z9B9If476rIp5GHfUFXQ
         /Bdpbov2uBy247CwiaLVoTAEuHWQvuR4qSUQYrABbOvvuY7jGE6qnAKJ0QnazxqkPwoV
         BoUhYIkETbM5OrkGu7Rz7ziQn289/WH0C6lLt8uNarA8ylfTsPoSwhiYma8kzkuPW8X2
         sguzLQEy7U6LwTwX6BXBjnCuxwz+gjSVh2Necrj7QJ3X5TinhbjcmJqrndvj7JNwJpAS
         gFzFO0girRr9pm0uhb88ZitZHf8hkHFu2PZ+dCxNex6jR92ugSXcd1RJx05bhdZPPD6E
         rTIw==
X-Gm-Message-State: AOJu0YyIV1sx37FL0no8dfrQCl09UwEP17x+BM4kxMUr6vSZF6XZfmB6
	/RTm8Y/6s9Y5m7u87IZro3yoFvqjdUReDHcLHaw=
X-Google-Smtp-Source: AGHT+IG/MBbeWjo63UjVV4K14yChPV7mQCskhkt22bSCnzs9BhwCVQqxSNSjgWsSLiq9MOvW/H5pH27/YqkNzPgGdE0=
X-Received: by 2002:a17:906:c56:b0:9db:e46c:569 with SMTP id
 t22-20020a1709060c5600b009dbe46c0569mr3816022ejf.45.1699875005271; Mon, 13
 Nov 2023 03:30:05 -0800 (PST)
MIME-Version: 1.0
From: Mario Marietto <marietto2008@gmail.com>
Date: Mon, 13 Nov 2023 12:29:28 +0100
Message-ID: <CA+1FSiiq9Z2sWq9R=7wEA0=LCavohupBedJOVnGrCHGiMZhR=A@mail.gmail.com>
Subject: Values generated by the ViryaOS uboot-script-gen do not work
 correctly on the Chromebook Snow
To: =?UTF-8?Q?Marek_Marczykowski=2DG=C3=B3recki?= <marmarek@invisiblethingslab.com>, 
	Chuck Zmudzinski <brchuckz@netscape.net>, Stefano Stabellini <sstabellini@kernel.org>, 
	Julien Grall <julien@xen.org>, Bertrand Marquis <bertrand.marquis@arm.com>, 
	xen-devel <xen-devel@lists.xenproject.org>
Content-Type: multipart/alternative; boundary="000000000000da1659060a06fd8a"

--000000000000da1659060a06fd8a
Content-Type: text/plain; charset="UTF-8"

Hello.

I'm trying to find an easier way to the problem that you can read here :

https://github.com/mobile-virt/u-boot-chromebook-xe303c12/tree/chromebook/xen#starting-a-domu-guest


where *Chuck* says :



   1. Create the u-boot shell commands that will be used to boot Xen and
   dom0.

Create a file in /home/user (or any other directory) named bootxen.source
with these contents :


mmc dev 1 && mmc rescan 1
ext2load mmc 1:3 0x42000000 zImage-6.1.61-stb-xen-cbe+
ext2load mmc 1:3 0x51000000 xen-4.17-armhf-armmp-0x51004000.ub
ext2load mmc 1:3 0x5ffec000 exynos5250-snow-6.1.61-stb-xen-cbe+.dtb
fdt addr 0x5ffec000
fdt resize 1024
fdt set /chosen \#address-cells <0x2>
fdt set /chosen \#size-cells <0x2>
fdt set /chosen xen,xen-bootargs "console=dtuart dtuart=serial0
dom0_mem=1G dom0_max_vcpus=2 bootscrub=0 vwfi=native"
fdt mknod /chosen dom0
fdt set /chosen/dom0 compatible  "xen,linux-zimage"
"xen,multiboot-module" "multiboot,module"
fdt set /chosen/dom0 reg <0x0 0x42000000 0x0 0x7D7200 >
fdt set /chosen xen,dom0-bootargs "console=tty1 root=/dev/mmcblk1p4 rw
rootwait clk_ignore_unused"
bootm 0x51000000 - 0x5ffec000

The hex value 0x7D7200 is the size of the zImage-6.1.61-stb-xen-cbe+ file,
and that value is computed from the uboot-script-gen script available from
here :


https://gitlab.com/ViryaOS/imagebuilder


This is the interesting point :


*Please note that most of the other values in the script generated by the
ViryaOS uboot-script-gen do not work correctly with the Chromebook Snow*,
but the script does correctly calculate the size of the dom0 Linux kernel
image.


Some time ago Stefano suggested to put the values below for MEMORY_START
and MEMORY_END inside the xen-config file :


nano xen-config file :


MEMORY_START="0x41e00000"
MEMORY_END="0x60000000"
LOAD_CMD="ext2load mmc 1:3"
BOOT_CMD="bootm"
DEVICE_TREE="exynos5250-snow.dtb"
XEN="xen-4.17-armhf"
XEN_CMD="console=dtuart dtuart=serial0 dom0_mem=768M dom0_max_vcpus=2
bootscrub=0 vwfi=native sched=null"
DOM0_KERNEL="zImage-6.6.0-xen-dma-mapping"
DOM0_CMD="console=tty earlycon=xen earlyprintk=xen root=/dev/mmcblk1p4 rw
rootwait clk_ignore_unused"
UBOOT_SOURCE="xen.source"


bash ./uboot-script-gen -c xen-config -d .


Image Name:
Created:      Thu Nov  2 20:59:24 2023
Image Type:   ARM Linux Kernel Image (uncompressed)
Data Size:    884744 Bytes = 864.01 KiB = 0.84 MiB
Load Address: 42c00000
Entry Point:  42c00000


Generated uboot script xen.scr, to be loaded at address 0x42000000:
ext2load mmc 1:3 0x42000000 xen.scr; source 0x42000000


and I tried to boot Xen and Linux 6.6 as dom0 :

SMDK5250 # mmc dev 1
SMDK5250 # ext2load mmc 1:3 0x42000000 xen.scr; source 0x42000000


but it did not work : it reboots on the verification screen.

-- 
Mario.

--000000000000da1659060a06fd8a
Content-Type: text/html; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr"><div>Hello.</div><div><br></div><div>I&#39;m trying to fin=
d an easier way to the problem that you can read here :</div><div><br></div=
><div><a href=3D"https://github.com/mobile-virt/u-boot-chromebook-xe303c12/=
tree/chromebook/xen#starting-a-domu-guest" target=3D"_blank">https://github=
.com/mobile-virt/u-boot-chromebook-xe303c12/tree/chromebook/xen#starting-a-=
domu-guest</a></div><div><pre><br>where <b><font size=3D"4">Chuck</font></b=
> says :<br></pre><pre><code></code><br></pre><div>
    </div><ol start=3D"6" dir=3D"auto"><li>Create the u-boot shell commands=
 that will be used to boot Xen and dom0.</li></ol>
<p dir=3D"auto">Create a file in /home/user (or any other directory) named =
bootxen.source with these contents :</p><p dir=3D"auto"><br></p>
<div><pre><code>mmc dev 1 &amp;&amp; mmc rescan 1
ext2load mmc 1:3 0x42000000 zImage-6.1.61-stb-xen-cbe+
ext2load mmc 1:3 0x51000000 xen-4.17-armhf-armmp-0x51004000.ub
ext2load mmc 1:3 0x5ffec000 exynos5250-snow-6.1.61-stb-xen-cbe+.dtb
fdt addr 0x5ffec000
fdt resize 1024
fdt set /chosen \#address-cells &lt;0x2&gt;
fdt set /chosen \#size-cells &lt;0x2&gt;
fdt set /chosen xen,xen-bootargs &quot;console=3Ddtuart dtuart=3Dserial0 do=
m0_mem=3D1G dom0_max_vcpus=3D2 bootscrub=3D0 vwfi=3Dnative&quot;
fdt mknod /chosen dom0
fdt set /chosen/dom0 compatible  &quot;xen,linux-zimage&quot; &quot;xen,mul=
tiboot-module&quot; &quot;multiboot,module&quot;
fdt set /chosen/dom0 reg &lt;0x0 0x42000000 0x0 0x7D7200 &gt;
fdt set /chosen xen,dom0-bootargs &quot;console=3Dtty1 root=3D/dev/mmcblk1p=
4 rw rootwait clk_ignore_unused&quot;
bootm 0x51000000 - 0x5ffec000<br>
</code></pre><div>
    </div></div><p dir=3D"auto">The hex value 0x7D7200 is the size of the=
=20
zImage-6.1.61-stb-xen-cbe+ file, and that value is computed from the=20
uboot-script-gen script available from here : <br></p><p dir=3D"auto"><br><=
/p><p dir=3D"auto"><a href=3D"https://gitlab.com/ViryaOS/imagebuilder" rel=
=3D"nofollow" target=3D"_blank">https://gitlab.com/ViryaOS/imagebuilder</a>=
</p>
<p><br></p><p>This is the interesting point :</p><p><br></p><p dir=3D"auto"=
><b>Please note that most of the other values in the script=20
generated by the ViryaOS uboot-script-gen do not work correctly with the
 Chromebook Snow</b>, but the script does correctly calculate the size of=
=20
the dom0 Linux kernel image.</p><p><span><span style=3D"font-family:monospa=
ce"><span style=3D"color:rgb(0,0,0);background-color:rgb(255,255,255)"><br>=
</span></span></span></p><p><span><span style=3D"font-family:monospace"><sp=
an style=3D"color:rgb(0,0,0);background-color:rgb(255,255,255)">Some time a=
go Stefano suggested to put the values below for MEMORY_START and MEMORY_EN=
D inside the xen-config file :<br></span></span></span></p><p><span><span s=
tyle=3D"font-family:monospace"><span style=3D"color:rgb(0,0,0);background-c=
olor:rgb(255,255,255)"><br></span></span></span></p><p><span><span style=3D=
"font-family:monospace"><span style=3D"color:rgb(0,0,0);background-color:rg=
b(255,255,255)">nano xen-config file :</span></span></span></p><p><span><sp=
an style=3D"font-family:monospace"><span style=3D"color:rgb(0,0,0);backgrou=
nd-color:rgb(255,255,255)"><br></span></span></span></p><div><span class=3D=
"gmail-im"><span style=3D"font-family:monospace"><span style=3D"color:rgb(0=
,0,0);background-color:rgb(255,255,255)">MEMORY_START=3D&quot;0x41e00000&qu=
ot;
</span><br>MEMORY_END=3D&quot;0x60000000&quot;
<br>LOAD_CMD=3D&quot;ext2load mmc 1:3&quot;
<br>BOOT_CMD=3D&quot;bootm&quot;
<br>
DEVICE_TREE=3D&quot;exynos5250-snow.dtb&quot;
<br>XEN=3D&quot;xen-4.17-armhf&quot;
<br>XEN_CMD=3D&quot;console=3Ddtuart dtuart=3Dserial0 dom0_mem=3D768M dom0_=
max_vcpus=3D2 bootscrub=3D0 vwfi=3Dnative sched=3Dnull&quot;
<br>DOM0_KERNEL=3D&quot;zImage-6.6.0-xen-dma-mapping&quot;
<br>DOM0_CMD=3D&quot;console=3Dtty earlycon=3Dxen earlyprintk=3Dxen root=3D=
/dev/mmcblk1p4 rw rootwait clk_ignore_unused&quot;
<br>UBOOT_SOURCE=3D&quot;xen.source&quot;</span></span></div><div><span sty=
le=3D"font-family:monospace"><br></span></div><div><span style=3D"font-fami=
ly:monospace"><br></span></div><div><span style=3D"font-family:monospace"><=
span style=3D"color:rgb(0,0,0);background-color:rgb(255,255,255)"></span></=
span></div><div><span style=3D"font-family:monospace"><span style=3D"color:=
rgb(0,0,0);background-color:rgb(255,255,255)">bash ./uboot-script-gen -c xe=
n-config -d .</span><br></span></div><div><span style=3D"font-family:monosp=
ace"><span style=3D"color:rgb(0,0,0);background-color:rgb(255,255,255)"></s=
pan></span></div><div><span style=3D"font-family:monospace"><span style=3D"=
color:rgb(0,0,0);background-color:rgb(255,255,255)"></span></span></div><di=
v><span style=3D"font-family:monospace"><span style=3D"color:rgb(0,0,0);bac=
kground-color:rgb(255,255,255)"><br></span></span></div><div><span style=3D=
"font-family:monospace"><span style=3D"color:rgb(0,0,0);background-color:rg=
b(255,255,255)"><br>
</span></span></div><div><span style=3D"font-family:monospace"></span></div=
><span style=3D"font-family:monospace">Image Name: =C2=A0=C2=A0=C2=A0<br>Cr=
eated: =C2=A0=C2=A0=C2=A0=C2=A0=C2=A0Thu Nov =C2=A02 20:59:24 2023
<br><span class=3D"gmail-im">Image Type: =C2=A0=C2=A0ARM Linux Kernel Image=
 (uncompressed)
<br>Data Size: =C2=A0=C2=A0=C2=A0884744 Bytes =3D 864.01 KiB =3D 0.84 MiB
<br></span>Load Address: 42c00000
<br>Entry Point: =C2=A042c00000</span></div><div><br><span style=3D"font-fa=
mily:monospace"></span></div><div><span style=3D"font-family:monospace"><br=
></span></div><div><span style=3D"font-family:monospace">Generated uboot sc=
ript xen.scr, to be loaded at address 0x42000000:
<br></span><div><span style=3D"font-family:monospace">ext2load mmc 1:3 0x42=
000000 xen.scr; source 0x42000000</span></div><div><span style=3D"font-fami=
ly:monospace"><br></span></div></div><div><br></div><div>and I tried to boo=
t Xen and Linux 6.6 as dom0 :</div><div><br></div><div><div><pre class=3D"g=
mail-notranslate"><code>SMDK5250 # mmc dev 1
SMDK5250 # ext2load mmc 1:3 0x42000000 xen.scr; source 0x42000000<br><br><b=
r></code></pre><span style=3D"font-family:monospace">but it did not work : =
it reboots on the verification screen.</span></div><div><br><span class=3D"=
gmail_signature_prefix">-- </span><br><div dir=3D"ltr" class=3D"gmail_signa=
ture" data-smartmail=3D"gmail_signature">Mario.<br></div></div></div></div>

--000000000000da1659060a06fd8a--


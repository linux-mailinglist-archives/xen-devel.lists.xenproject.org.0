Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 15A6FF19DA
	for <lists+xen-devel@lfdr.de>; Wed,  6 Nov 2019 16:21:21 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iSN5T-0003a0-N2; Wed, 06 Nov 2019 15:19:11 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=cVPj=Y6=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1iSN5S-0003Zs-N8
 for xen-devel@lists.xenproject.org; Wed, 06 Nov 2019 15:19:10 +0000
X-Inumbo-ID: c6db8ec6-00a8-11ea-a1ad-12813bfff9fa
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id c6db8ec6-00a8-11ea-a1ad-12813bfff9fa;
 Wed, 06 Nov 2019 15:19:08 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 837A2B071;
 Wed,  6 Nov 2019 15:19:07 +0000 (UTC)
From: Jan Beulich <jbeulich@suse.com>
To: "xen-devel@lists.xenproject.org" <xen-devel@lists.xenproject.org>
References: <db66edf2-ca66-4127-8920-ba55f4aee14e@suse.com>
Message-ID: <7045df66-009d-6c9f-8e8d-cfd058c29131@suse.com>
Date: Wed, 6 Nov 2019 16:19:16 +0100
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:60.0) Gecko/20100101
 Thunderbird/60.9.0
MIME-Version: 1.0
In-Reply-To: <db66edf2-ca66-4127-8920-ba55f4aee14e@suse.com>
Content-Language: en-US
Subject: [Xen-devel] [PATCH 2/3] introduce GFN notification for translated
 domains
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Julien Grall <julien@xen.org>,
 Wei Liu <wl@xen.org>, Konrad Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Sander Eikelenboom <linux@eikelenboom.it>,
 Ian Jackson <ian.jackson@citrix.com>,
 =?UTF-8?Q?Roger_Pau_Monn=c3=a9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SW4gb3JkZXIgZm9yIGluZGl2aWR1YWwgSU9NTVUgZHJpdmVycyAoYW5kIGZyb20gYW4gYWJzdHJh
Y3QgcG92IGFsc28KYXJjaGl0ZWN0dXJlcykgdG8gYmUgYWJsZSB0byBhZGp1c3QgdGhlaXIgZGF0
YSBzdHJ1Y3R1cmVzIGFoZWFkIG9mIHRpbWUKd2hlbiB0aGV5IG1pZ2h0IGNvdmVyIG9ubHkgYSBz
dWItcmFuZ2Ugb2YgYWxsIHBvc3NpYmxlIEdGTnMsIGludHJvZHVjZQphIG5vdGlmaWNhdGlvbiBj
YWxsIHVzZWQgYnkgdmFyaW91cyBjb2RlIHBhdGhzIHBvdGVudGlhbGx5IGluc3RhbGxpbmcgYQpm
cmVzaCBtYXBwaW5nIG9mIGEgbmV2ZXIgdXNlZCBHRk4gKGZvciBhIHBhcnRpY3VsYXIgZG9tYWlu
KS4KCk5vdGUgdGhhdCBpbiBnbnR0YWJfdHJhbnNmZXIoKSB0aGUgbm90aWZpY2F0aW9uIGFuZCBs
b2NrIHJlLWFjcXVpcmUKaGFuZGxpbmcgaXMgYmVzdCBlZmZvcnQgb25seSAodGhlIGd1ZXN0IG1h
eSBub3QgYmUgYWJsZSB0byBtYWtlIHVzZSBvZgp0aGUgbmV3IHBhZ2UgaW4gY2FzZSBvZiBmYWls
dXJlLCBidXQgdGhhdCdzIGluIGxpbmUgd2l0aCB0aGUgbGFjayBvZiBhCnJldHVybiB2YWx1ZSBj
aGVjayBvZiBndWVzdF9waHlzbWFwX2FkZF9wYWdlKCkgaXRzZWxmKS4KClNpZ25lZC1vZmYtYnk6
IEphbiBCZXVsaWNoIDxqYmV1bGljaEBzdXNlLmNvbT4KCi0tLSBhL3hlbi9hcmNoL3g4Ni9odm0v
ZG9tMF9idWlsZC5jCisrKyBiL3hlbi9hcmNoL3g4Ni9odm0vZG9tMF9idWlsZC5jCkBAIC0xNzMs
NyArMTczLDggQEAgc3RhdGljIGludCBfX2luaXQgcHZoX3BvcHVsYXRlX21lbW9yeV9yYQogICAg
ICAgICAgICAgY29udGludWU7CiAgICAgICAgIH0KIAotICAgICAgICByYyA9IGd1ZXN0X3BoeXNt
YXBfYWRkX3BhZ2UoZCwgX2dmbihzdGFydCksIHBhZ2VfdG9fbWZuKHBhZ2UpLAorICAgICAgICBy
YyA9IG5vdGlmeV9nZm4oZCwgX2dmbihzdGFydCArICgxVUwgPDwgb3JkZXIpIC0gMSkpID86Cisg
ICAgICAgICAgICAgZ3Vlc3RfcGh5c21hcF9hZGRfcGFnZShkLCBfZ2ZuKHN0YXJ0KSwgcGFnZV90
b19tZm4ocGFnZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmRlcik7
CiAgICAgICAgIGlmICggcmMgIT0gMCApCiAgICAgICAgIHsKLS0tIGEveGVuL2FyY2gveDg2L2h2
bS9odm0uYworKysgYi94ZW4vYXJjaC94ODYvaHZtL2h2bS5jCkBAIC00Mjg2LDkgKzQyODYsMTcg
QEAgc3RhdGljIGludCBodm1vcF9zZXRfcGFyYW0oCiAgICAgICAgIGlmICggYS52YWx1ZSA+IFNI
VVRET1dOX01BWCApCiAgICAgICAgICAgICByYyA9IC1FSU5WQUw7CiAgICAgICAgIGJyZWFrOwor
CiAgICAgY2FzZSBIVk1fUEFSQU1fSU9SRVFfU0VSVkVSX1BGTjoKLSAgICAgICAgZC0+YXJjaC5o
dm0uaW9yZXFfZ2ZuLmJhc2UgPSBhLnZhbHVlOworICAgICAgICBpZiAoIGQtPmFyY2guaHZtLnBh
cmFtc1tIVk1fUEFSQU1fTlJfSU9SRVFfU0VSVkVSX1BBR0VTXSApCisgICAgICAgICAgICByYyA9
IG5vdGlmeV9nZm4oCisgICAgICAgICAgICAgICAgICAgICBkLAorICAgICAgICAgICAgICAgICAg
ICAgX2dmbihhLnZhbHVlICsgZC0+YXJjaC5odm0ucGFyYW1zCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBbSFZNX1BBUkFNX05SX0lPUkVRX1NFUlZFUl9QQUdFU10gLSAxKSk7
CisgICAgICAgIGlmICggIXJjICkKKyAgICAgICAgICAgICBkLT5hcmNoLmh2bS5pb3JlcV9nZm4u
YmFzZSA9IGEudmFsdWU7CiAgICAgICAgIGJyZWFrOworCiAgICAgY2FzZSBIVk1fUEFSQU1fTlJf
SU9SRVFfU0VSVkVSX1BBR0VTOgogICAgIHsKICAgICAgICAgdW5zaWduZWQgaW50IGk7CkBAIC00
Mjk5LDYgKzQzMDcsOSBAQCBzdGF0aWMgaW50IGh2bW9wX3NldF9wYXJhbSgKICAgICAgICAgICAg
IHJjID0gLUVJTlZBTDsKICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICB9CisgICAgICAgIHJj
ID0gbm90aWZ5X2dmbihkLCBfZ2ZuKGQtPmFyY2guaHZtLmlvcmVxX2dmbi5iYXNlICsgYS52YWx1
ZSAtIDEpKTsKKyAgICAgICAgaWYgKCByYyApCisgICAgICAgICAgICBicmVhazsKICAgICAgICAg
Zm9yICggaSA9IDA7IGkgPCBhLnZhbHVlOyBpKysgKQogICAgICAgICAgICAgc2V0X2JpdChpLCAm
ZC0+YXJjaC5odm0uaW9yZXFfZ2ZuLm1hc2spOwogCkBAIC00MzEyLDcgKzQzMjMsMTEgQEAgc3Rh
dGljIGludCBodm1vcF9zZXRfcGFyYW0oCiAgICAgICAgIEJVSUxEX0JVR19PTihIVk1fUEFSQU1f
QlVGSU9SRVFfUEZOID4KICAgICAgICAgICAgICAgICAgICAgIHNpemVvZihkLT5hcmNoLmh2bS5p
b3JlcV9nZm4ubGVnYWN5X21hc2spICogOCk7CiAgICAgICAgIGlmICggYS52YWx1ZSApCi0gICAg
ICAgICAgICBzZXRfYml0KGEuaW5kZXgsICZkLT5hcmNoLmh2bS5pb3JlcV9nZm4ubGVnYWN5X21h
c2spOworICAgICAgICB7CisgICAgICAgICAgICByYyA9IG5vdGlmeV9nZm4oZCwgX2dmbihhLnZh
bHVlKSk7CisgICAgICAgICAgICBpZiAoICFyYyApCisgICAgICAgICAgICAgICAgc2V0X2JpdChh
LmluZGV4LCAmZC0+YXJjaC5odm0uaW9yZXFfZ2ZuLmxlZ2FjeV9tYXNrKTsKKyAgICAgICAgfQog
ICAgICAgICBicmVhazsKIAogICAgIGNhc2UgSFZNX1BBUkFNX1g4N19GSVBfV0lEVEg6Ci0tLSBh
L3hlbi9jb21tb24vZ3JhbnRfdGFibGUuYworKysgYi94ZW4vY29tbW9uL2dyYW50X3RhYmxlLmMK
QEAgLTk0Niw2ICs5NDYsMTYgQEAgbWFwX2dyYW50X3JlZigKICAgICAgICAgcmV0dXJuOwogICAg
IH0KIAorICAgIGlmICggcGFnaW5nX21vZGVfdHJhbnNsYXRlKGxkKSAvKiAmJiAob3AtPmZsYWdz
ICYgR05UTUFQX2hvc3RfbWFwKSAqLyAmJgorICAgICAgICAgKHJjID0gbm90aWZ5X2dmbihsZCwg
Z2FkZHJfdG9fZ2ZuKG9wLT5ob3N0X2FkZHIpKSkgKQorICAgIHsKKyAgICAgICAgZ2RwcmludGso
WEVOTE9HX0lORk8sICJub3RpZnkoJSJQUklfZ2ZuIikgLT4gJWRcbiIsCisgICAgICAgICAgICAg
ICAgIGdmbl94KGdhZGRyX3RvX2dmbihvcC0+aG9zdF9hZGRyKSksIHJjKTsKKyAgICAgICAgb3At
PnN0YXR1cyA9IEdOVFNUX2dlbmVyYWxfZXJyb3I7CisgICAgICAgIHJldHVybjsKKyAgICAgICAg
QlVJTERfQlVHX09OKEdOVFNUX29rYXkpOworICAgIH0KKwogICAgIGlmICggdW5saWtlbHkoKHJk
ID0gcmN1X2xvY2tfZG9tYWluX2J5X2lkKG9wLT5kb20pKSA9PSBOVUxMKSApCiAgICAgewogICAg
ICAgICBnZHByaW50ayhYRU5MT0dfSU5GTywgIkNvdWxkIG5vdCBmaW5kIGRvbWFpbiAlZFxuIiwg
b3AtPmRvbSk7CkBAIC0yMTIzLDYgKzIxMzMsNyBAQCBnbnR0YWJfdHJhbnNmZXIoCiAgICAgewog
ICAgICAgICBib29sX3Qgb2theTsKICAgICAgICAgaW50IHJjOworICAgICAgICBnZm5fdCBnZm47
CiAKICAgICAgICAgaWYgKCBpICYmIGh5cGVyY2FsbF9wcmVlbXB0X2NoZWNrKCkgKQogICAgICAg
ICAgICAgcmV0dXJuIGk7CkBAIC0yMzAwLDIxICsyMzExLDUyIEBAIGdudHRhYl90cmFuc2ZlcigK
ICAgICAgICAgYWN0ID0gYWN0aXZlX2VudHJ5X2FjcXVpcmUoZS0+Z3JhbnRfdGFibGUsIGdvcC5y
ZWYpOwogCiAgICAgICAgIGlmICggZXZhbHVhdGVfbm9zcGVjKGUtPmdyYW50X3RhYmxlLT5ndF92
ZXJzaW9uID09IDEpICkKKyAgICAgICAgICAgIGdmbiA9IF9nZm4oc2hhcmVkX2VudHJ5X3YxKGUt
PmdyYW50X3RhYmxlLCBnb3AucmVmKS5mcmFtZSk7CisgICAgICAgIGVsc2UKKyAgICAgICAgICAg
IGdmbiA9IF9nZm4oc2hhcmVkX2VudHJ5X3YyKGUtPmdyYW50X3RhYmxlLCBnb3AucmVmKS5mdWxs
X3BhZ2UuZnJhbWUpOworCisgICAgICAgIGlmICggcGFnaW5nX21vZGVfdHJhbnNsYXRlKGUpICkK
ICAgICAgICAgewotICAgICAgICAgICAgZ3JhbnRfZW50cnlfdjFfdCAqc2hhID0gJnNoYXJlZF9l
bnRyeV92MShlLT5ncmFudF90YWJsZSwgZ29wLnJlZik7CisgICAgICAgICAgICBnZm5fdCBnZm4y
OworCisgICAgICAgICAgICBhY3RpdmVfZW50cnlfcmVsZWFzZShhY3QpOworICAgICAgICAgICAg
Z3JhbnRfcmVhZF91bmxvY2soZS0+Z3JhbnRfdGFibGUpOworCisgICAgICAgICAgICByYyA9IG5v
dGlmeV9nZm4oZSwgZ2ZuKTsKKyAgICAgICAgICAgIGlmICggcmMgKQorICAgICAgICAgICAgICAg
IHByaW50ayhYRU5MT0dfR19XQVJOSU5HCisgICAgICAgICAgICAgICAgICAgICAgICIlcGQ6IGdy
ZWYgJXU6IHhmZXIgR0ZOICUiUFJJX2dmbiIgbWF5IGJlIGluYWNjZXNzaWJsZSAoJWQpXG4iLAor
ICAgICAgICAgICAgICAgICAgICAgICBlLCBnb3AucmVmLCBnZm5feChnZm4pLCByYyk7CisKKyAg
ICAgICAgICAgIGdyYW50X3JlYWRfbG9jayhlLT5ncmFudF90YWJsZSk7CisgICAgICAgICAgICBh
Y3QgPSBhY3RpdmVfZW50cnlfYWNxdWlyZShlLT5ncmFudF90YWJsZSwgZ29wLnJlZik7CiAKLSAg
ICAgICAgICAgIGd1ZXN0X3BoeXNtYXBfYWRkX3BhZ2UoZSwgX2dmbihzaGEtPmZyYW1lKSwgbWZu
LCAwKTsKLSAgICAgICAgICAgIGlmICggIXBhZ2luZ19tb2RlX3RyYW5zbGF0ZShlKSApCi0gICAg
ICAgICAgICAgICAgc2hhLT5mcmFtZSA9IG1mbl94KG1mbik7CisgICAgICAgICAgICBpZiAoIGV2
YWx1YXRlX25vc3BlYyhlLT5ncmFudF90YWJsZS0+Z3RfdmVyc2lvbiA9PSAxKSApCisgICAgICAg
ICAgICAgICAgZ2ZuMiA9IF9nZm4oc2hhcmVkX2VudHJ5X3YxKGUtPmdyYW50X3RhYmxlLCBnb3Au
cmVmKS5mcmFtZSk7CisgICAgICAgICAgICBlbHNlCisgICAgICAgICAgICAgICAgZ2ZuMiA9IF9n
Zm4oc2hhcmVkX2VudHJ5X3YyKGUtPmdyYW50X3RhYmxlLCBnb3AucmVmKS4KKyAgICAgICAgICAg
ICAgICAgICAgZnVsbF9wYWdlLmZyYW1lKTsKKworICAgICAgICAgICAgaWYgKCAhZ2ZuX2VxKGdm
biwgZ2ZuMikgKQorICAgICAgICAgICAgeworICAgICAgICAgICAgICAgIHByaW50ayhYRU5MT0df
R19XQVJOSU5HCisgICAgICAgICAgICAgICAgICAgICAgICIlcGQ6IGdyZWYgJXU6IHhmZXIgR0ZO
IHdlbnQgJSJQUklfZ2ZuIiAtPiAlIlBSSV9nZm4iXG4iLAorICAgICAgICAgICAgICAgICAgICAg
ICBlLCBnb3AucmVmLCBnZm5feChnZm4pLCBnZm5feChnZm4yKSk7CisgICAgICAgICAgICAgICAg
Z2ZuID0gZ2ZuMjsKKyAgICAgICAgICAgIH0KICAgICAgICAgfQotICAgICAgICBlbHNlCi0gICAg
ICAgIHsKLSAgICAgICAgICAgIGdyYW50X2VudHJ5X3YyX3QgKnNoYSA9ICZzaGFyZWRfZW50cnlf
djIoZS0+Z3JhbnRfdGFibGUsIGdvcC5yZWYpOwogCi0gICAgICAgICAgICBndWVzdF9waHlzbWFw
X2FkZF9wYWdlKGUsIF9nZm4oc2hhLT5mdWxsX3BhZ2UuZnJhbWUpLCBtZm4sIDApOwotICAgICAg
ICAgICAgaWYgKCAhcGFnaW5nX21vZGVfdHJhbnNsYXRlKGUpICkKLSAgICAgICAgICAgICAgICBz
aGEtPmZ1bGxfcGFnZS5mcmFtZSA9IG1mbl94KG1mbik7CisgICAgICAgIGd1ZXN0X3BoeXNtYXBf
YWRkX3BhZ2UoZSwgZ2ZuLCBtZm4sIDApOworCisgICAgICAgIGlmICggIXBhZ2luZ19tb2RlX3Ry
YW5zbGF0ZShlKSApCisgICAgICAgIHsKKyAgICAgICAgICAgIGlmICggZXZhbHVhdGVfbm9zcGVj
KGUtPmdyYW50X3RhYmxlLT5ndF92ZXJzaW9uID09IDEpICkKKyAgICAgICAgICAgICAgICBzaGFy
ZWRfZW50cnlfdjEoZS0+Z3JhbnRfdGFibGUsIGdvcC5yZWYpLmZyYW1lID0gbWZuX3gobWZuKTsK
KyAgICAgICAgICAgIGVsc2UKKyAgICAgICAgICAgICAgICBzaGFyZWRfZW50cnlfdjIoZS0+Z3Jh
bnRfdGFibGUsIGdvcC5yZWYpLmZ1bGxfcGFnZS5mcmFtZSA9CisgICAgICAgICAgICAgICAgICAg
IG1mbl94KG1mbik7CiAgICAgICAgIH0KKwogICAgICAgICBzbXBfd21iKCk7CiAgICAgICAgIHNo
YXJlZF9lbnRyeV9oZWFkZXIoZS0+Z3JhbnRfdGFibGUsIGdvcC5yZWYpLT5mbGFncyB8PQogICAg
ICAgICAgICAgR1RGX3RyYW5zZmVyX2NvbXBsZXRlZDsKLS0tIGEveGVuL2NvbW1vbi9tZW1vcnku
YworKysgYi94ZW4vY29tbW9uL21lbW9yeS5jCkBAIC0yMDMsNiArMjAzLDEwIEBAIHN0YXRpYyB2
b2lkIHBvcHVsYXRlX3BoeXNtYXAoc3RydWN0IG1lbW8KICAgICAgICAgaWYgKCB1bmxpa2VseShf
X2NvcHlfZnJvbV9ndWVzdF9vZmZzZXQoJmdwZm4sIGEtPmV4dGVudF9saXN0LCBpLCAxKSkgKQog
ICAgICAgICAgICAgZ290byBvdXQ7CiAKKyAgICAgICAgaWYgKCBwYWdpbmdfbW9kZV90cmFuc2xh
dGUoZCkgJiYKKyAgICAgICAgICAgICBub3RpZnlfZ2ZuKGQsIF9nZm4oZ3BmbiArICgxVSA8PCBh
LT5leHRlbnRfb3JkZXIpIC0gMSkpICkKKyAgICAgICAgICAgIGdvdG8gb3V0OworCiAgICAgICAg
IGlmICggYS0+bWVtZmxhZ3MgJiBNRU1GX3BvcHVsYXRlX29uX2RlbWFuZCApCiAgICAgICAgIHsK
ICAgICAgICAgICAgIC8qIERpc2FsbG93IHBvcHVsYXRpbmcgUG9EIHBhZ2VzIG9uIG9uZXNlbGYu
ICovCkBAIC03NDUsNiArNzQ5LDEwIEBAIHN0YXRpYyBsb25nIG1lbW9yeV9leGNoYW5nZShYRU5f
R1VFU1RfSEEKICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgIH0KIAorICAg
ICAgICAgICAgaWYgKCBwYWdpbmdfbW9kZV90cmFuc2xhdGUoZCkgKQorICAgICAgICAgICAgICAg
IHJjID0gbm90aWZ5X2dmbihkLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfZ2Zu
KGdwZm4gKyAoMVUgPDwgZXhjaC5vdXQuZXh0ZW50X29yZGVyKSAtIDEpKTsKKwogICAgICAgICAg
ICAgbWZuID0gcGFnZV90b19tZm4ocGFnZSk7CiAgICAgICAgICAgICBndWVzdF9waHlzbWFwX2Fk
ZF9wYWdlKGQsIF9nZm4oZ3BmbiksIG1mbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgZXhjaC5vdXQuZXh0ZW50X29yZGVyKTsKQEAgLTgxMywxMiArODIxLDIwIEBAIGludCB4
ZW5tZW1fYWRkX3RvX3BoeXNtYXAoc3RydWN0IGRvbWFpbgogICAgICAgICBleHRyYS5mb3JlaWdu
X2RvbWlkID0gRE9NSURfSU5WQUxJRDsKIAogICAgIGlmICggeGF0cC0+c3BhY2UgIT0gWEVOTUFQ
U1BBQ0VfZ21mbl9yYW5nZSApCi0gICAgICAgIHJldHVybiB4ZW5tZW1fYWRkX3RvX3BoeXNtYXBf
b25lKGQsIHhhdHAtPnNwYWNlLCBleHRyYSwKKyAgICAgICAgcmV0dXJuIG5vdGlmeV9nZm4oZCwg
X2dmbih4YXRwLT5ncGZuKSkgPzoKKyAgICAgICAgICAgICAgIHhlbm1lbV9hZGRfdG9fcGh5c21h
cF9vbmUoZCwgeGF0cC0+c3BhY2UsIGV4dHJhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICB4YXRwLT5pZHgsIF9nZm4oeGF0cC0+Z3BmbikpOwogCiAgICAgaWYgKCB4
YXRwLT5zaXplIDwgc3RhcnQgKQogICAgICAgICByZXR1cm4gLUVJTFNFUTsKIAorICAgIGlmICgg
IXN0YXJ0ICYmIHhhdHAtPnNpemUgKQorICAgIHsKKyAgICAgICAgcmMgPSBub3RpZnlfZ2ZuKGQs
IF9nZm4oeGF0cC0+Z3BmbiArIHhhdHAtPnNpemUgLSAxKSk7CisgICAgICAgIGlmICggcmMgKQor
ICAgICAgICAgICAgcmV0dXJuIHJjOworICAgIH0KKwogICAgIHhhdHAtPmlkeCArPSBzdGFydDsK
ICAgICB4YXRwLT5ncGZuICs9IHN0YXJ0OwogICAgIHhhdHAtPnNpemUgLT0gc3RhcnQ7CkBAIC04
OTEsNyArOTA3LDggQEAgc3RhdGljIGludCB4ZW5tZW1fYWRkX3RvX3BoeXNtYXBfYmF0Y2gocwog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRlbnQsIDEp
KSApCiAgICAgICAgICAgICByZXR1cm4gLUVGQVVMVDsKIAotICAgICAgICByYyA9IHhlbm1lbV9h
ZGRfdG9fcGh5c21hcF9vbmUoZCwgeGF0cGItPnNwYWNlLAorICAgICAgICByYyA9IG5vdGlmeV9n
Zm4oZCwgX2dmbihncGZuKSkgPzoKKyAgICAgICAgICAgICB4ZW5tZW1fYWRkX3RvX3BoeXNtYXBf
b25lKGQsIHhhdHBiLT5zcGFjZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHhhdHBiLT51LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWR4
LCBfZ2ZuKGdwZm4pKTsKIAotLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9pb21tdS5jCisr
KyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2lvbW11LmMKQEAgLTUzMCw2ICs1MzAsMTQgQEAg
dm9pZCBpb21tdV9zaGFyZV9wMm1fdGFibGUoc3RydWN0IGRvbWFpbgogICAgICAgICBpb21tdV9n
ZXRfb3BzKCktPnNoYXJlX3AybShkKTsKIH0KIAoraW50IGlvbW11X25vdGlmeV9nZm4oc3RydWN0
IGRvbWFpbiAqZCwgZ2ZuX3QgZ2ZuKQoreworICAgIGNvbnN0IHN0cnVjdCBpb21tdV9vcHMgKm9w
cyA9IGRvbV9pb21tdShkKS0+cGxhdGZvcm1fb3BzOworCisgICAgcmV0dXJuIG5lZWRfaW9tbXVf
cHRfc3luYyhkKSAmJiBvcHMtPm5vdGlmeV9kZm4KKyAgICAgICAgICAgPyBpb21tdV9jYWxsKG9w
cywgbm90aWZ5X2RmbiwgZCwgX2RmbihnZm5feChnZm4pKSkgOiAwOworfQorCiB2b2lkIGlvbW11
X2NyYXNoX3NodXRkb3duKHZvaWQpCiB7CiAgICAgaWYgKCAhaW9tbXVfY3Jhc2hfZGlzYWJsZSAp
Ci0tLSBhL3hlbi9pbmNsdWRlL3hlbi9pb21tdS5oCisrKyBiL3hlbi9pbmNsdWRlL3hlbi9pb21t
dS5oCkBAIC0yMzcsNiArMjM3LDggQEAgc3RydWN0IGlvbW11X29wcyB7CiAgICAgaW50IF9fbXVz
dF9jaGVjayAoKmxvb2t1cF9wYWdlKShzdHJ1Y3QgZG9tYWluICpkLCBkZm5fdCBkZm4sIG1mbl90
ICptZm4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQg
KmZsYWdzKTsKIAorICAgIGludCBfX211c3RfY2hlY2sgKCpub3RpZnlfZGZuKShzdHJ1Y3QgZG9t
YWluICpkLCBkZm5fdCBkZm4pOworCiAgICAgdm9pZCAoKmZyZWVfcGFnZV90YWJsZSkoc3RydWN0
IHBhZ2VfaW5mbyAqKTsKIAogI2lmZGVmIENPTkZJR19YODYKQEAgLTMzMSw2ICszMzMsNyBAQCB2
b2lkIGlvbW11X2NyYXNoX3NodXRkb3duKHZvaWQpOwogaW50IGlvbW11X2dldF9yZXNlcnZlZF9k
ZXZpY2VfbWVtb3J5KGlvbW11X2dyZG1fdCAqLCB2b2lkICopOwogCiB2b2lkIGlvbW11X3NoYXJl
X3AybV90YWJsZShzdHJ1Y3QgZG9tYWluICpkKTsKK2ludCBfX211c3RfY2hlY2sgaW9tbXVfbm90
aWZ5X2dmbihzdHJ1Y3QgZG9tYWluICpkLCBnZm5fdCBnZm4pOwogCiAjaWZkZWYgQ09ORklHX0hB
U19QQ0kKIGludCBpb21tdV9kb19wY2lfZG9tY3RsKHN0cnVjdCB4ZW5fZG9tY3RsICosIHN0cnVj
dCBkb21haW4gKmQsCi0tLSBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCisrKyBiL3hlbi9pbmNs
dWRlL3hlbi9zY2hlZC5oCkBAIC0xMDM5LDYgKzEwMzksMTEgQEAgc3RhdGljIGFsd2F5c19pbmxp
bmUgYm9vbCBpc19pb21tdV9lbmFibAogICAgIHJldHVybiBldmFsdWF0ZV9ub3NwZWMoZC0+b3B0
aW9ucyAmIFhFTl9ET01DVExfQ0RGX2lvbW11KTsKIH0KIAorc3RhdGljIGlubGluZSBpbnQgX19t
dXN0X2NoZWNrIG5vdGlmeV9nZm4oc3RydWN0IGRvbWFpbiAqZCwgZ2ZuX3QgZ2ZuKQoreworICAg
IHJldHVybiAvKiBhcmNoX25vdGlmeV9nZm4oZCwgZ2ZuKSA/OiAqLyBpb21tdV9ub3RpZnlfZ2Zu
KGQsIGdmbik7Cit9CisKIGV4dGVybiBib29sIHNjaGVkX3NtdF9wb3dlcl9zYXZpbmdzOwogZXh0
ZXJuIGJvb2wgc2NoZWRfZGlzYWJsZV9zbXRfc3dpdGNoaW5nOwogCgoKX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApY
ZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9y
Zy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

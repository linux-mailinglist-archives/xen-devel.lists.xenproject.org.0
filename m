Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 1950E8325C
	for <lists+xen-devel@lfdr.de>; Tue,  6 Aug 2019 15:10:49 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1huz9t-0003FM-1y; Tue, 06 Aug 2019 13:05:45 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=jalH=WC=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1huz9q-0003FG-W2
 for xen-devel@lists.xenproject.org; Tue, 06 Aug 2019 13:05:43 +0000
X-Inumbo-ID: e28c7b18-b84a-11e9-877e-7bd250368eac
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id e28c7b18-b84a-11e9-877e-7bd250368eac;
 Tue, 06 Aug 2019 13:05:38 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 549F5B061;
 Tue,  6 Aug 2019 13:05:37 +0000 (UTC)
From: Jan Beulich <jbeulich@suse.com>
To: "xen-devel@lists.xenproject.org" <xen-devel@lists.xenproject.org>
Message-ID: <5a4d4a61-a543-c657-8458-cbc6b5a8a633@suse.com>
Date: Tue, 6 Aug 2019 15:05:36 +0200
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:60.0) Gecko/20100101
 Thunderbird/60.8.0
MIME-Version: 1.0
Content-Type: multipart/mixed; boundary="------------3B7AC5CFE503A3FAD31D6CF7"
Content-Language: en-US
Subject: [Xen-devel] [PATCH v5 00/10] AMD IOMMU: further improvements
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>,
 Brian Woods <brian.woods@amd.com>,
 Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

This is a multi-part message in MIME format.
--------------3B7AC5CFE503A3FAD31D6CF7
Content-Type: text/plain; charset=utf-8; format=flowed
Content-Transfer-Encoding: 7bit

Only the first patch here is left from v4, everything else is new,
yet still related. The main goal is to reduce the huge memory
overhead that we've noticed. On the way there a number of other
things were once again noticed. Unfortunately before I was able to
also test the last two patches there, my Rome box broke again.
Hence these two patches have been tested on a (less affected)
Fam15 system only.

01: miscellaneous DTE handling adjustments
02: drop stray "else"
03: don't free shared IRT multiple times
04: introduce a "valid" flag for IVRS mappings
05: let callers of amd_iommu_alloc_intremap_table() handle errors
06: don't blindly allocate interrupt remapping tables
07: make phantom functions share interrupt remapping tables
08: x86/PCI: read MSI-X table entry count early
09: replace INTREMAP_ENTRIES
10: restrict interrupt remapping table sizes

Full set of patches once again attached here due to still unresolved
email issues over here.

Jan



--------------3B7AC5CFE503A3FAD31D6CF7
Content-Type: text/plain; charset=UTF-8;
 name="01-AMD-IOMMU-misc-DTE.patch"
Content-Transfer-Encoding: base64
Content-Disposition: attachment;
 filename="01-AMD-IOMMU-misc-DTE.patch"

QU1EL0lPTU1VOiBtaXNjZWxsYW5lb3VzIERURSBoYW5kbGluZyBhZGp1c3RtZW50cwoKRmly
c3QgYW5kIGZvcmVtb3N0IHN3aXRjaCBib29sZWFuIGZpZWxkcyB0byBib29sLiBBZGp1c3Qg
YSBmZXcgcmVsYXRlZApmdW5jdGlvbiBwYXJhbWV0ZXJzIGFzIHdlbGwuIFRoZW4KLSBpbiBh
bWRfaW9tbXVfc2V0X2ludHJlbWFwX3RhYmxlKCkgZG9uJ3QgdXNlIGxpdGVyYWwgbnVtYmVy
cywKLSBpbiBpb21tdV9kdGVfYWRkX2RldmljZV9lbnRyeSgpIHVzZSBhIGNvbXBvdW5kIGxp
dGVyYWwgaW5zdGVhZCBvZiBtYW55CiAgYXNzaWdubWVudHMsCi0gaW4gYW1kX2lvbW11X3Nl
dHVwX2RvbWFpbl9kZXZpY2UoKQogIC0gZWxpbWluYXRlIGEgcG9pbnRsZXNzIGxvY2FsIHZh
cmlhYmxlLAogIC0gdXNlIHx8IGluc3RlYWQgb2YgJiYgd2hlbiBkZWNpZGluZyB3aGV0aGVy
IHRvIGNsZWFyIGFuIGVudHJ5LAogIC0gY2xlYXIgdGhlIEkgZmllbGQgd2l0aG91dCBhbnkg
Y2hlY2tpbmcgb2YgQVRTIC8gSU9UTEIgc3RhdGUsCi0gbGVhdmUgcmVzZXJ2ZWQgZmllbGRz
IHVubmFtZWQuCgpTaWduZWQtb2ZmLWJ5OiBKYW4gQmV1bGljaCA8amJldWxpY2hAc3VzZS5j
b20+CkFja2VkLWJ5OiBBbmRyZXcgQ29vcGVyIDxhbmRyZXcuY29vcGVyM0BjaXRyaXguY29t
PgotLS0KdjU6IElPTU1VX0lOVFJFTUFQX0xFTkdUSCAtPiBJT01NVV9JTlRSRU1BUF9PUkRF
Ui4gQWRqdXN0IGNvbW1lbnQuCnY0OiBOZXcuCgotLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhy
b3VnaC9hbWQvaW9tbXVfaW50ci5jCisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2Ft
ZC9pb21tdV9pbnRyLmMKQEAgLTY5LDggKzY5LDcgQEAgdW5pb24gaXJ0ZV9jcHRyIHsKICAg
ICBjb25zdCB1bmlvbiBpcnRlMTI4ICpwdHIxMjg7CiB9IF9fdHJhbnNwYXJlbnRfXzsKIAot
I2RlZmluZSBJTlRSRU1BUF9MRU5HVEggMHhCCi0jZGVmaW5lIElOVFJFTUFQX0VOVFJJRVMg
KDEgPDwgSU5UUkVNQVBfTEVOR1RIKQorI2RlZmluZSBJTlRSRU1BUF9FTlRSSUVTICgxIDw8
IElPTU1VX0lOVFJFTUFQX09SREVSKQogCiBzdHJ1Y3QgaW9hcGljX3NiZGYgaW9hcGljX3Ni
ZGZbTUFYX0lPX0FQSUNTXTsKIHN0cnVjdCBocGV0X3NiZGYgaHBldF9zYmRmOwotLS0gYS94
ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfbWFwLmMKKysrIGIveGVuL2RyaXZl
cnMvcGFzc3Rocm91Z2gvYW1kL2lvbW11X21hcC5jCkBAIC0xMDEsNTEgKzEwMSw1MiBAQCBz
dGF0aWMgdW5zaWduZWQgaW50IHNldF9pb21tdV9wdGVfcHJlc2VuCiAKIHZvaWQgYW1kX2lv
bW11X3NldF9yb290X3BhZ2VfdGFibGUoc3RydWN0IGFtZF9pb21tdV9kdGUgKmR0ZSwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDY0X3Qgcm9vdF9wdHIsIHVp
bnQxNl90IGRvbWFpbl9pZCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
dWludDhfdCBwYWdpbmdfbW9kZSwgdWludDhfdCB2YWxpZCkKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgdWludDhfdCBwYWdpbmdfbW9kZSwgYm9vbCB2YWxpZCkKIHsK
ICAgICBkdGUtPmRvbWFpbl9pZCA9IGRvbWFpbl9pZDsKICAgICBkdGUtPnB0X3Jvb3QgPSBw
YWRkcl90b19wZm4ocm9vdF9wdHIpOwotICAgIGR0ZS0+aXcgPSAxOwotICAgIGR0ZS0+aXIg
PSAxOworICAgIGR0ZS0+aXcgPSB0cnVlOworICAgIGR0ZS0+aXIgPSB0cnVlOwogICAgIGR0
ZS0+cGFnaW5nX21vZGUgPSBwYWdpbmdfbW9kZTsKLSAgICBkdGUtPnR2ID0gMTsKKyAgICBk
dGUtPnR2ID0gdHJ1ZTsKICAgICBkdGUtPnYgPSB2YWxpZDsKIH0KIAogdm9pZCBfX2luaXQg
YW1kX2lvbW11X3NldF9pbnRyZW1hcF90YWJsZSgKLSAgICBzdHJ1Y3QgYW1kX2lvbW11X2R0
ZSAqZHRlLCB1aW50NjRfdCBpbnRyZW1hcF9wdHIsIHVpbnQ4X3QgaW50X3ZhbGlkKQorICAg
IHN0cnVjdCBhbWRfaW9tbXVfZHRlICpkdGUsIHVpbnQ2NF90IGludHJlbWFwX3B0ciwgYm9v
bCB2YWxpZCkKIHsKICAgICBkdGUtPml0X3Jvb3QgPSBpbnRyZW1hcF9wdHIgPj4gNjsKLSAg
ICBkdGUtPmludF90YWJfbGVuID0gMHhiOyAvKiAyMDQ4IGVudHJpZXMgKi8KLSAgICBkdGUt
PmludF9jdGwgPSAyOyAvKiBmaXhlZCBhbmQgYXJiaXRyYXRlZCBpbnRlcnJ1cHRzIHJlbWFw
cGVkICovCi0gICAgZHRlLT5pZyA9IDA7IC8qIHVubWFwcGVkIGludGVycnVwdCByZXN1bHRz
IGlvIHBhZ2UgZmF1bHRzICovCi0gICAgZHRlLT5pdiA9IGludF92YWxpZDsKKyAgICBkdGUt
PmludF90YWJfbGVuID0gSU9NTVVfSU5UUkVNQVBfT1JERVI7CisgICAgZHRlLT5pbnRfY3Rs
ID0gSU9NTVVfREVWX1RBQkxFX0lOVF9DT05UUk9MX1RSQU5TTEFURUQ7CisgICAgZHRlLT5p
ZyA9IGZhbHNlOyAvKiB1bm1hcHBlZCBpbnRlcnJ1cHRzIHJlc3VsdCBpbiBpL28gcGFnZSBm
YXVsdHMgKi8KKyAgICBkdGUtPml2ID0gdmFsaWQ7CiB9CiAKIHZvaWQgX19pbml0IGlvbW11
X2R0ZV9hZGRfZGV2aWNlX2VudHJ5KHN0cnVjdCBhbWRfaW9tbXVfZHRlICpkdGUsCi0gICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgaXZyc19tYXBwaW5n
cyAqaXZyc19kZXYpCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBj
b25zdCBzdHJ1Y3QgaXZyc19tYXBwaW5ncyAqaXZyc19kZXYpCiB7CiAgICAgdWludDhfdCBm
bGFncyA9IGl2cnNfZGV2LT5kZXZpY2VfZmxhZ3M7CiAKLSAgICBtZW1zZXQoZHRlLCAwLCBz
aXplb2YoKmR0ZSkpOwotCi0gICAgZHRlLT5pbml0X3Bhc3MgPSBNQVNLX0VYVFIoZmxhZ3Ms
IEFDUElfSVZIRF9JTklUX1BBU1MpOwotICAgIGR0ZS0+ZXh0X2ludF9wYXNzID0gTUFTS19F
WFRSKGZsYWdzLCBBQ1BJX0lWSERfRUlOVF9QQVNTKTsKLSAgICBkdGUtPm5taV9wYXNzID0g
TUFTS19FWFRSKGZsYWdzLCBBQ1BJX0lWSERfTk1JX1BBU1MpOwotICAgIGR0ZS0+bGludDBf
cGFzcyA9IE1BU0tfRVhUUihmbGFncywgQUNQSV9JVkhEX0xJTlQwX1BBU1MpOwotICAgIGR0
ZS0+bGludDFfcGFzcyA9IE1BU0tfRVhUUihmbGFncywgQUNQSV9JVkhEX0xJTlQxX1BBU1Mp
OwotICAgIGR0ZS0+c3lzX21ndCA9IE1BU0tfRVhUUihmbGFncywgQUNQSV9JVkhEX1NZU1RF
TV9NR01UKTsKLSAgICBkdGUtPmV4ID0gaXZyc19kZXYtPmR0ZV9hbGxvd19leGNsdXNpb247
CisgICAgKmR0ZSA9IChzdHJ1Y3QgYW1kX2lvbW11X2R0ZSl7CisgICAgICAgIC5pbml0X3Bh
c3MgPSBmbGFncyAmIEFDUElfSVZIRF9JTklUX1BBU1MsCisgICAgICAgIC5leHRfaW50X3Bh
c3MgPSBmbGFncyAmIEFDUElfSVZIRF9FSU5UX1BBU1MsCisgICAgICAgIC5ubWlfcGFzcyA9
IGZsYWdzICYgQUNQSV9JVkhEX05NSV9QQVNTLAorICAgICAgICAubGludDBfcGFzcyA9IGZs
YWdzICYgQUNQSV9JVkhEX0xJTlQwX1BBU1MsCisgICAgICAgIC5saW50MV9wYXNzID0gZmxh
Z3MgJiBBQ1BJX0lWSERfTElOVDFfUEFTUywKKyAgICAgICAgLmlvY3RsID0gSU9NTVVfREVW
X1RBQkxFX0lPX0NPTlRST0xfQUJPUlRFRCwKKyAgICAgICAgLnN5c19tZ3QgPSBNQVNLX0VY
VFIoZmxhZ3MsIEFDUElfSVZIRF9TWVNURU1fTUdNVCksCisgICAgICAgIC5leCA9IGl2cnNf
ZGV2LT5kdGVfYWxsb3dfZXhjbHVzaW9uLAorICAgIH07CiB9CiAKIHZvaWQgaW9tbXVfZHRl
X3NldF9ndWVzdF9jcjMoc3RydWN0IGFtZF9pb21tdV9kdGUgKmR0ZSwgdWludDE2X3QgZG9t
X2lkLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50NjRfdCBnY3IzX21mbiwg
dWludDhfdCBndiwgdWludDhfdCBnbHgpCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHVpbnQ2NF90IGdjcjNfbWZuLCBib29sIGd2LCB1aW50OF90IGdseCkKIHsKICNkZWZpbmUg
R0NSM19NQVNLKGhpLCBsbykgKCgoMXVsIDw8ICgoaGkpICsgMSkpIC0gMSkgJiB+KCgxdWwg
PDwgKGxvKSkgLSAxKSkKICNkZWZpbmUgR0NSM19TSElGVChsbykgKChsbykgLSBQQUdFX1NI
SUZUKQogCiAgICAgLyogSSBiaXQgbXVzdCBiZSBzZXQgd2hlbiBnY3IzIGlzIGVuYWJsZWQg
Ki8KLSAgICBkdGUtPmkgPSAxOworICAgIGR0ZS0+aSA9IHRydWU7CiAKICAgICBkdGUtPmdj
cjNfdHJwXzE0XzEyID0gKGdjcjNfbWZuICYgR0NSM19NQVNLKDE0LCAxMikpID4+IEdDUjNf
U0hJRlQoMTIpOwogICAgIGR0ZS0+Z2NyM190cnBfMzBfMTUgPSAoZ2NyM19tZm4gJiBHQ1Iz
X01BU0soMzAsIDE1KSkgPj4gR0NSM19TSElGVCgxNSk7Ci0tLSBhL3hlbi9kcml2ZXJzL3Bh
c3N0aHJvdWdoL2FtZC9wY2lfYW1kX2lvbW11LmMKKysrIGIveGVuL2RyaXZlcnMvcGFzc3Ro
cm91Z2gvYW1kL3BjaV9hbWRfaW9tbXUuYwpAQCAtOTMsNyArOTMsNiBAQCBzdGF0aWMgdm9p
ZCBhbWRfaW9tbXVfc2V0dXBfZG9tYWluX2RldmljCiAgICAgc3RydWN0IGFtZF9pb21tdV9k
dGUgKnRhYmxlLCAqZHRlOwogICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAgICAgaW50IHJl
cV9pZCwgdmFsaWQgPSAxOwotICAgIGludCBkdGVfaSA9IDA7CiAgICAgdTggYnVzID0gcGRl
di0+YnVzOwogICAgIGNvbnN0IHN0cnVjdCBkb21haW5faW9tbXUgKmhkID0gZG9tX2lvbW11
KGRvbWFpbik7CiAKQEAgLTEwMyw5ICsxMDIsNiBAQCBzdGF0aWMgdm9pZCBhbWRfaW9tbXVf
c2V0dXBfZG9tYWluX2RldmljCiAgICAgaWYgKCBpb21tdV9od2RvbV9wYXNzdGhyb3VnaCAm
JiBpc19oYXJkd2FyZV9kb21haW4oZG9tYWluKSApCiAgICAgICAgIHZhbGlkID0gMDsKIAot
ICAgIGlmICggYXRzX2VuYWJsZWQgKQotICAgICAgICBkdGVfaSA9IDE7Ci0KICAgICAvKiBn
ZXQgZGV2aWNlLXRhYmxlIGVudHJ5ICovCiAgICAgcmVxX2lkID0gZ2V0X2RtYV9yZXF1ZXN0
b3JfaWQoaW9tbXUtPnNlZywgUENJX0JERjIoYnVzLCBkZXZmbikpOwogICAgIHRhYmxlID0g
aW9tbXUtPmRldl90YWJsZS5idWZmZXI7CkBAIC0xMjIsNyArMTE4LDcgQEAgc3RhdGljIHZv
aWQgYW1kX2lvbW11X3NldHVwX2RvbWFpbl9kZXZpYwogCiAgICAgICAgIGlmICggcGNpX2F0
c19kZXZpY2UoaW9tbXUtPnNlZywgYnVzLCBwZGV2LT5kZXZmbikgJiYKICAgICAgICAgICAg
ICBpb21tdV9oYXNfY2FwKGlvbW11LCBQQ0lfQ0FQX0lPVExCX1NISUZUKSApCi0gICAgICAg
ICAgICBkdGUtPmkgPSBkdGVfaTsKKyAgICAgICAgICAgIGR0ZS0+aSA9IGF0c19lbmFibGVk
OwogCiAgICAgICAgIGFtZF9pb21tdV9mbHVzaF9kZXZpY2UoaW9tbXUsIHJlcV9pZCk7CiAK
QEAgLTI4OCwxNCArMjg0LDExIEBAIHZvaWQgYW1kX2lvbW11X2Rpc2FibGVfZG9tYWluX2Rl
dmljZShzdHIKICAgICBkdGUgPSAmdGFibGVbcmVxX2lkXTsKIAogICAgIHNwaW5fbG9ja19p
cnFzYXZlKCZpb21tdS0+bG9jaywgZmxhZ3MpOwotICAgIGlmICggZHRlLT50diAmJiBkdGUt
PnYgKQorICAgIGlmICggZHRlLT50diB8fCBkdGUtPnYgKQogICAgIHsKLSAgICAgICAgZHRl
LT50diA9IDA7Ci0gICAgICAgIGR0ZS0+diA9IDA7Ci0KLSAgICAgICAgaWYgKCBwY2lfYXRz
X2RldmljZShpb21tdS0+c2VnLCBidXMsIHBkZXYtPmRldmZuKSAmJgotICAgICAgICAgICAg
IGlvbW11X2hhc19jYXAoaW9tbXUsIFBDSV9DQVBfSU9UTEJfU0hJRlQpICkKLSAgICAgICAg
ICAgIGR0ZS0+aSA9IDA7CisgICAgICAgIGR0ZS0+dHYgPSBmYWxzZTsKKyAgICAgICAgZHRl
LT52ID0gZmFsc2U7CisgICAgICAgIGR0ZS0+aSA9IGZhbHNlOwogCiAgICAgICAgIGFtZF9p
b21tdV9mbHVzaF9kZXZpY2UoaW9tbXUsIHJlcV9pZCk7CiAKLS0tIGEveGVuL2luY2x1ZGUv
YXNtLXg4Ni9odm0vc3ZtL2FtZC1pb21tdS1kZWZzLmgKKysrIGIveGVuL2luY2x1ZGUvYXNt
LXg4Ni9odm0vc3ZtL2FtZC1pb21tdS1kZWZzLmgKQEAgLTEwNyw1NyArMTA3LDYwIEBACiAj
ZGVmaW5lIElPTU1VX0RFVl9UQUJMRV9JTlRfQ09OVFJPTF9GT1JXQVJERUQJMHgxCiAjZGVm
aW5lIElPTU1VX0RFVl9UQUJMRV9JTlRfQ09OVFJPTF9UUkFOU0xBVEVECTB4MgogCisvKiBG
b3Igbm93LCB3ZSBhbHdheXMgYWxsb2NhdGUgdGhlIG1heGltdW06IDIwNDggZW50cmllcy4g
Ki8KKyNkZWZpbmUgSU9NTVVfSU5UUkVNQVBfT1JERVIJCQkweEIKKwogc3RydWN0IGFtZF9p
b21tdV9kdGUgewogICAgIC8qIDAgLSA2MyAqLwotICAgIHVpbnQ2NF90IHY6MTsKLSAgICB1
aW50NjRfdCB0djoxOwotICAgIHVpbnQ2NF90IHJlc2VydmVkMDo1OwotICAgIHVpbnQ2NF90
IGhhZDoyOwotICAgIHVpbnQ2NF90IHBhZ2luZ19tb2RlOjM7CisgICAgYm9vbCB2OjE7Cisg
ICAgYm9vbCB0djoxOworICAgIHVuc2lnbmVkIGludCA6NTsKKyAgICB1bnNpZ25lZCBpbnQg
aGFkOjI7CisgICAgdW5zaWduZWQgaW50IHBhZ2luZ19tb2RlOjM7CiAgICAgdWludDY0X3Qg
cHRfcm9vdDo0MDsKLSAgICB1aW50NjRfdCBwcHI6MTsKLSAgICB1aW50NjRfdCBncHJwOjE7
Ci0gICAgdWludDY0X3QgZ2lvdjoxOwotICAgIHVpbnQ2NF90IGd2OjE7Ci0gICAgdWludDY0
X3QgZ2x4OjI7Ci0gICAgdWludDY0X3QgZ2NyM190cnBfMTRfMTI6MzsKLSAgICB1aW50NjRf
dCBpcjoxOwotICAgIHVpbnQ2NF90IGl3OjE7Ci0gICAgdWludDY0X3QgcmVzZXJ2ZWQxOjE7
CisgICAgYm9vbCBwcHI6MTsKKyAgICBib29sIGdwcnA6MTsKKyAgICBib29sIGdpb3Y6MTsK
KyAgICBib29sIGd2OjE7CisgICAgdW5zaWduZWQgaW50IGdseDoyOworICAgIHVuc2lnbmVk
IGludCBnY3IzX3RycF8xNF8xMjozOworICAgIGJvb2wgaXI6MTsKKyAgICBib29sIGl3OjE7
CisgICAgdW5zaWduZWQgaW50IDoxOwogCiAgICAgLyogNjQgLSAxMjcgKi8KLSAgICB1aW50
NjRfdCBkb21haW5faWQ6MTY7Ci0gICAgdWludDY0X3QgZ2NyM190cnBfMzBfMTU6MTY7Ci0g
ICAgdWludDY0X3QgaToxOwotICAgIHVpbnQ2NF90IHNlOjE7Ci0gICAgdWludDY0X3Qgc2E6
MTsKLSAgICB1aW50NjRfdCBpb2N0bDoyOwotICAgIHVpbnQ2NF90IGNhY2hlOjE7Ci0gICAg
dWludDY0X3Qgc2Q6MTsKLSAgICB1aW50NjRfdCBleDoxOwotICAgIHVpbnQ2NF90IHN5c19t
Z3Q6MjsKLSAgICB1aW50NjRfdCByZXNlcnZlZDI6MTsKLSAgICB1aW50NjRfdCBnY3IzX3Ry
cF81MV8zMToyMTsKKyAgICB1bnNpZ25lZCBpbnQgZG9tYWluX2lkOjE2OworICAgIHVuc2ln
bmVkIGludCBnY3IzX3RycF8zMF8xNToxNjsKKyAgICBib29sIGk6MTsKKyAgICBib29sIHNl
OjE7CisgICAgYm9vbCBzYToxOworICAgIHVuc2lnbmVkIGludCBpb2N0bDoyOworICAgIGJv
b2wgY2FjaGU6MTsKKyAgICBib29sIHNkOjE7CisgICAgYm9vbCBleDoxOworICAgIHVuc2ln
bmVkIGludCBzeXNfbWd0OjI7CisgICAgdW5zaWduZWQgaW50IDoxOworICAgIHVuc2lnbmVk
IGludCBnY3IzX3RycF81MV8zMToyMTsKIAogICAgIC8qIDEyOCAtIDE5MSAqLwotICAgIHVp
bnQ2NF90IGl2OjE7Ci0gICAgdWludDY0X3QgaW50X3RhYl9sZW46NDsKLSAgICB1aW50NjRf
dCBpZzoxOworICAgIGJvb2wgaXY6MTsKKyAgICB1bnNpZ25lZCBpbnQgaW50X3RhYl9sZW46
NDsKKyAgICBib29sIGlnOjE7CiAgICAgdWludDY0X3QgaXRfcm9vdDo0NjsKLSAgICB1aW50
NjRfdCByZXNlcnZlZDM6NDsKLSAgICB1aW50NjRfdCBpbml0X3Bhc3M6MTsKLSAgICB1aW50
NjRfdCBleHRfaW50X3Bhc3M6MTsKLSAgICB1aW50NjRfdCBubWlfcGFzczoxOwotICAgIHVp
bnQ2NF90IHJlc2VydmVkNDoxOwotICAgIHVpbnQ2NF90IGludF9jdGw6MjsKLSAgICB1aW50
NjRfdCBsaW50MF9wYXNzOjE7Ci0gICAgdWludDY0X3QgbGludDFfcGFzczoxOworICAgIHVu
c2lnbmVkIGludCA6NDsKKyAgICBib29sIGluaXRfcGFzczoxOworICAgIGJvb2wgZXh0X2lu
dF9wYXNzOjE7CisgICAgYm9vbCBubWlfcGFzczoxOworICAgIHVuc2lnbmVkIGludCA6MTsK
KyAgICB1bnNpZ25lZCBpbnQgaW50X2N0bDoyOworICAgIGJvb2wgbGludDBfcGFzczoxOwor
ICAgIGJvb2wgbGludDFfcGFzczoxOwogCiAgICAgLyogMTkyIC0gMjU1ICovCi0gICAgdWlu
dDY0X3QgcmVzZXJ2ZWQ1OjU0OwotICAgIHVpbnQ2NF90IGF0dHJfdjoxOwotICAgIHVpbnQ2
NF90IG1vZGUwX2ZjOjE7Ci0gICAgdWludDY0X3Qgc25vb3BfYXR0cjo4OworICAgIHVpbnQ2
NF90IDo1NDsKKyAgICBib29sIGF0dHJfdjoxOworICAgIGJvb2wgbW9kZTBfZmM6MTsKKyAg
ICB1bnNpZ25lZCBpbnQgc25vb3BfYXR0cjo4OwogfTsKIAogLyogQ29tbWFuZCBCdWZmZXIg
Ki8KLS0tIGEveGVuL2luY2x1ZGUvYXNtLXg4Ni9odm0vc3ZtL2FtZC1pb21tdS1wcm90by5o
CisrKyBiL3hlbi9pbmNsdWRlL2FzbS14ODYvaHZtL3N2bS9hbWQtaW9tbXUtcHJvdG8uaApA
QCAtNzMsMTQgKzczLDE0IEBAIGludCBfX211c3RfY2hlY2sgYW1kX2lvbW11X2ZsdXNoX2lv
dGxiX2EKIGludCBnZXRfZG1hX3JlcXVlc3Rvcl9pZCh1aW50MTZfdCBzZWcsIHVpbnQxNl90
IGJkZik7CiB2b2lkIGFtZF9pb21tdV9zZXRfaW50cmVtYXBfdGFibGUoc3RydWN0IGFtZF9p
b21tdV9kdGUgKmR0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50
NjRfdCBpbnRyZW1hcF9wdHIsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
dWludDhfdCBpbnRfdmFsaWQpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGJvb2wgdmFsaWQpOwogdm9pZCBhbWRfaW9tbXVfc2V0X3Jvb3RfcGFnZV90YWJsZShzdHJ1
Y3QgYW1kX2lvbW11X2R0ZSAqZHRlLAogCQkJCSAgIHVpbnQ2NF90IHJvb3RfcHRyLCB1aW50
MTZfdCBkb21haW5faWQsCi0JCQkJICAgdWludDhfdCBwYWdpbmdfbW9kZSwgdWludDhfdCB2
YWxpZCk7CisJCQkJICAgdWludDhfdCBwYWdpbmdfbW9kZSwgYm9vbCB2YWxpZCk7CiB2b2lk
IGlvbW11X2R0ZV9hZGRfZGV2aWNlX2VudHJ5KHN0cnVjdCBhbWRfaW9tbXVfZHRlICpkdGUs
Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBpdnJzX21hcHBpbmdz
ICppdnJzX2Rldik7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0
cnVjdCBpdnJzX21hcHBpbmdzICppdnJzX2Rldik7CiB2b2lkIGlvbW11X2R0ZV9zZXRfZ3Vl
c3RfY3IzKHN0cnVjdCBhbWRfaW9tbXVfZHRlICpkdGUsIHVpbnQxNl90IGRvbV9pZCwKLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDY0X3QgZ2NyM19tZm4sIHVpbnQ4X3Qg
Z3YsIHVpbnQ4X3QgZ2x4KTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDY0
X3QgZ2NyM19tZm4sIGJvb2wgZ3YsIHVpbnQ4X3QgZ2x4KTsKIAogLyogc2VuZCBjbWQgdG8g
aW9tbXUgKi8KIHZvaWQgYW1kX2lvbW11X2ZsdXNoX2FsbF9wYWdlcyhzdHJ1Y3QgZG9tYWlu
ICpkKTsK
--------------3B7AC5CFE503A3FAD31D6CF7
Content-Type: text/plain; charset=UTF-8;
 name="02-AMD-IOMMU-stray-else.patch"
Content-Transfer-Encoding: base64
Content-Disposition: attachment;
 filename="02-AMD-IOMMU-stray-else.patch"

QU1EL0lPTU1VOiBkcm9wIHN0cmF5ICJlbHNlIgoKVGhlIGJsYW5rIGxpbmUgYmV0d2VlbiBp
dCBhbmQgdGhlIHByaW9yIGlmKCkgY2xlYXJseSBpbmRpY2F0ZXMgdGhhdCB0aGlzCndhcyBt
ZWFudCB0byBiZSBhIHN0YW5kYWxvbmUgaWYoKS4KClNpZ25lZC1vZmYtYnk6IEphbiBCZXVs
aWNoIDxqYmV1bGljaEBzdXNlLmNvbT4KLS0tCnY1OiBOZXcuCgotLS0gYS94ZW4vZHJpdmVy
cy9wYXNzdGhyb3VnaC9hbWQvcGNpX2FtZF9pb21tdS5jCisrKyBiL3hlbi9kcml2ZXJzL3Bh
c3N0aHJvdWdoL2FtZC9wY2lfYW1kX2lvbW11LmMKQEAgLTE2Niw4ICsxNjYsOCBAQCBzdGF0
aWMgaW50IF9faW5pdCBpb3ZfZGV0ZWN0KHZvaWQpCiAgICAgaWYgKCAhaW9tbXVfZW5hYmxl
ICYmICFpb21tdV9pbnRyZW1hcCApCiAgICAgICAgIHJldHVybiAwOwogCi0gICAgZWxzZSBp
ZiAoIChpbml0X2RvbmUgPyBhbWRfaW9tbXVfaW5pdF9pbnRlcnJ1cHQoKQotICAgICAgICAg
ICAgICAgICAgICAgICAgIDogYW1kX2lvbW11X2luaXQoZmFsc2UpKSAhPSAwICkKKyAgICBp
ZiAoIChpbml0X2RvbmUgPyBhbWRfaW9tbXVfaW5pdF9pbnRlcnJ1cHQoKQorICAgICAgICAg
ICAgICAgICAgICA6IGFtZF9pb21tdV9pbml0KGZhbHNlKSkgIT0gMCApCiAgICAgewogICAg
ICAgICBwcmludGsoIkFNRC1WaTogRXJyb3IgaW5pdGlhbGl6YXRpb25cbiIpOwogICAgICAg
ICByZXR1cm4gLUVOT0RFVjsK
--------------3B7AC5CFE503A3FAD31D6CF7
Content-Type: text/plain; charset=UTF-8;
 name="03-AMD-IOMMU-free-IRTs-shared.patch"
Content-Transfer-Encoding: base64
Content-Disposition: attachment;
 filename="03-AMD-IOMMU-free-IRTs-shared.patch"

QU1EL0lPTU1VOiBkb24ndCBmcmVlIHNoYXJlZCBJUlQgbXVsdGlwbGUgdGltZXMKCkNhbGxp
bmcgYW1kX2lvbW11X2ZyZWVfaW50cmVtYXBfdGFibGUoKSBmb3IgZXZlcnkgSVZSUyBlbnRy
eSBpcyBjb3JyZWN0Cm9ubHkgaW4gcGVyLWRldmljZS1JUlQgbW9kZS4gVXNlIGEgTlVMTCAy
bmQgYXJndW1lbnQgdG8gaW5kaWNhdGUgdGhhdAp0aGUgc2hhcmVkIHRhYmxlIHNob3VsZCBi
ZSBmcmVlZCwgYW5kIGNhbGwgdGhlIGZ1bmN0aW9uIGV4YWN0bHkgb25jZSBpbgpzaGFyZWQg
bW9kZS4KClNpZ25lZC1vZmYtYnk6IEphbiBCZXVsaWNoIDxqYmV1bGljaEBzdXNlLmNvbT4K
LS0tCnY1OiBOZXcuCgotLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVf
aW5pdC5jCisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9pb21tdV9pbml0LmMK
QEAgLTExMDYsNiArMTEwNiwxNSBAQCBzdGF0aWMgdm9pZCBfX2luaXQgYW1kX2lvbW11X2lu
aXRfY2xlYW51CiB7CiAgICAgc3RydWN0IGFtZF9pb21tdSAqaW9tbXUsICpuZXh0OwogCisg
ICAgLyogZnJlZSBpbnRlcnJ1cHQgcmVtYXBwaW5nIHRhYmxlICovCisgICAgaWYgKCBhbWRf
aW9tbXVfcGVyZGV2X2ludHJlbWFwICkKKyAgICAgICAgaXRlcmF0ZV9pdnJzX2VudHJpZXMo
YW1kX2lvbW11X2ZyZWVfaW50cmVtYXBfdGFibGUpOworICAgIGVsc2UgaWYgKCBzaGFyZWRf
aW50cmVtYXBfdGFibGUgKQorICAgICAgICBhbWRfaW9tbXVfZnJlZV9pbnRyZW1hcF90YWJs
ZShsaXN0X2ZpcnN0X2VudHJ5KCZhbWRfaW9tbXVfaGVhZCwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgYW1kX2lvbW11
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGxpc3QpLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOVUxM
KTsKKwogICAgIC8qIGZyZWUgYW1kIGlvbW11IGxpc3QgKi8KICAgICBsaXN0X2Zvcl9lYWNo
X2VudHJ5X3NhZmUgKCBpb21tdSwgbmV4dCwgJmFtZF9pb21tdV9oZWFkLCBsaXN0ICkKICAg
ICB7CkBAIC0xMTI4LDkgKzExMzcsNiBAQCBzdGF0aWMgdm9pZCBfX2luaXQgYW1kX2lvbW11
X2luaXRfY2xlYW51CiAgICAgICAgIHhmcmVlKGlvbW11KTsKICAgICB9CiAKLSAgICAvKiBm
cmVlIGludGVycnVwdCByZW1hcHBpbmcgdGFibGUgKi8KLSAgICBpdGVyYXRlX2l2cnNfZW50
cmllcyhhbWRfaW9tbXVfZnJlZV9pbnRyZW1hcF90YWJsZSk7Ci0KICAgICAvKiBmcmVlIGRl
dmljZSB0YWJsZSAqLwogICAgIGRlYWxsb2NhdGVfZGV2aWNlX3RhYmxlKCZkZXZpY2VfdGFi
bGUpOwogCi0tLSBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9pb21tdV9pbnRyLmMK
KysrIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL2lvbW11X2ludHIuYwpAQCAtNzky
LDE0ICs3OTIsMjMgQEAgdm9pZCBhbWRfaW9tbXVfcmVhZF9tc2lfZnJvbV9pcmUoCiBpbnQg
X19pbml0IGFtZF9pb21tdV9mcmVlX2ludHJlbWFwX3RhYmxlKAogICAgIGNvbnN0IHN0cnVj
dCBhbWRfaW9tbXUgKmlvbW11LCBzdHJ1Y3QgaXZyc19tYXBwaW5ncyAqaXZyc19tYXBwaW5n
KQogewotICAgIHZvaWQgKnRiID0gaXZyc19tYXBwaW5nLT5pbnRyZW1hcF90YWJsZTsKKyAg
ICB2b2lkICoqdGJscDsKIAotICAgIFhGUkVFKGl2cnNfbWFwcGluZy0+aW50cmVtYXBfaW51
c2UpOworICAgIGlmICggaXZyc19tYXBwaW5nICkKKyAgICB7CisgICAgICAgIFhGUkVFKGl2
cnNfbWFwcGluZy0+aW50cmVtYXBfaW51c2UpOworICAgICAgICB0YmxwID0gJml2cnNfbWFw
cGluZy0+aW50cmVtYXBfdGFibGU7CisgICAgfQorICAgIGVsc2UKKyAgICB7CisgICAgICAg
IFhGUkVFKHNoYXJlZF9pbnRyZW1hcF9pbnVzZSk7CisgICAgICAgIHRibHAgPSAmc2hhcmVk
X2ludHJlbWFwX3RhYmxlOworICAgIH0KIAotICAgIGlmICggdGIgKQorICAgIGlmICggKnRi
bHAgKQogICAgIHsKLSAgICAgICAgX19mcmVlX2FtZF9pb21tdV90YWJsZXModGIsIGludHJl
bWFwX3RhYmxlX29yZGVyKGlvbW11KSk7Ci0gICAgICAgIGl2cnNfbWFwcGluZy0+aW50cmVt
YXBfdGFibGUgPSBOVUxMOworICAgICAgICBfX2ZyZWVfYW1kX2lvbW11X3RhYmxlcygqdGJs
cCwgaW50cmVtYXBfdGFibGVfb3JkZXIoaW9tbXUpKTsKKyAgICAgICAgKnRibHAgPSBOVUxM
OwogICAgIH0KIAogICAgIHJldHVybiAwOwo=
--------------3B7AC5CFE503A3FAD31D6CF7
Content-Type: text/plain; charset=UTF-8;
 name="04-AMD-IOMMU-ivrs_mappings-valid.patch"
Content-Transfer-Encoding: base64
Content-Disposition: attachment;
 filename="04-AMD-IOMMU-ivrs_mappings-valid.patch"

QU1EL0lPTU1VOiBpbnRyb2R1Y2UgYSAidmFsaWQiIGZsYWcgZm9yIElWUlMgbWFwcGluZ3MK
CkZvciB1cyB0byBubyBsb25nZXIgYmxpbmRseSBhbGxvY2F0ZSBpbnRlcnJ1cHQgcmVtYXBw
aW5nIHRhYmxlcyBmb3IKZXZlcnl0aGluZyB0aGUgQUNQSSB0YWJsZXMgbmFtZSwgd2UgY2Fu
J3QgdXNlIHN0cnVjdCBpdnJzX21hcHBpbmdzJwppbnRyZW1hcF90YWJsZSBmaWVsZCBhbnlt
b3JlIHRvIGFsc28gaGF2ZSB0aGUgbWVhbmluZyBvZiAidGhpcyBlbnRyeQppcyB2YWxpZCIu
IEFkZCBhIHNlcGFyYXRlIGJvb2xlYW4gZmllbGQgaW5zdGVhZC4KClNpZ25lZC1vZmYtYnk6
IEphbiBCZXVsaWNoIDxqYmV1bGljaEBzdXNlLmNvbT4KLS0tCnY1OiBOZXcuCgotLS0gYS94
ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfYWNwaS5jCisrKyBiL3hlbi9kcml2
ZXJzL3Bhc3N0aHJvdWdoL2FtZC9pb21tdV9hY3BpLmMKQEAgLTg4LDYgKzg4LDggQEAgc3Rh
dGljIHZvaWQgX19pbml0IGFkZF9pdnJzX21hcHBpbmdfZW50cgogICAgICAgICAgfQogICAg
IH0KIAorICAgIGl2cnNfbWFwcGluZ3NbYWxpYXNfaWRdLnZhbGlkID0gdHJ1ZTsKKwogICAg
IC8qIEFzc2lnbiBJT01NVSBoYXJkd2FyZS4gKi8KICAgICBpdnJzX21hcHBpbmdzW2JkZl0u
aW9tbXUgPSBpb21tdTsKIH0KLS0tIGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL2lv
bW11X2luaXQuYworKysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfaW5p
dC5jCkBAIC0xMjQ0LDcgKzEyNDQsNiBAQCBzdGF0aWMgaW50IF9faW5pdCBhbWRfaW9tbXVf
c2V0dXBfZGV2aWNlCiAgICAgdTE2IHNlZywgc3RydWN0IGl2cnNfbWFwcGluZ3MgKml2cnNf
bWFwcGluZ3MpCiB7CiAgICAgdW5zaWduZWQgaW50IGJkZjsKLSAgICB2b2lkICppbnRyX3Ri
LCAqZHRlOwogCiAgICAgQlVHX09OKCAoaXZyc19iZGZfZW50cmllcyA9PSAwKSApOwogCkBA
IC0xMjY0LDE2ICsxMjYzLDE3IEBAIHN0YXRpYyBpbnQgX19pbml0IGFtZF9pb21tdV9zZXR1
cF9kZXZpY2UKICAgICAvKiBBZGQgZGV2aWNlIHRhYmxlIGVudHJpZXMgKi8KICAgICBmb3Ig
KCBiZGYgPSAwOyBiZGYgPCBpdnJzX2JkZl9lbnRyaWVzOyBiZGYrKyApCiAgICAgewotICAg
ICAgICBpbnRyX3RiID0gaXZyc19tYXBwaW5nc1tiZGZdLmludHJlbWFwX3RhYmxlOwotCi0g
ICAgICAgIGlmICggaW50cl90YiApCisgICAgICAgIGlmICggaXZyc19tYXBwaW5nc1tiZGZd
LnZhbGlkICkKICAgICAgICAgeworICAgICAgICAgICAgdm9pZCAqZHRlOworCiAgICAgICAg
ICAgICAvKiBhZGQgZGV2aWNlIHRhYmxlIGVudHJ5ICovCiAgICAgICAgICAgICBkdGUgPSBk
ZXZpY2VfdGFibGUuYnVmZmVyICsgKGJkZiAqIElPTU1VX0RFVl9UQUJMRV9FTlRSWV9TSVpF
KTsKICAgICAgICAgICAgIGlvbW11X2R0ZV9hZGRfZGV2aWNlX2VudHJ5KGR0ZSwgJml2cnNf
bWFwcGluZ3NbYmRmXSk7CiAKICAgICAgICAgICAgIGFtZF9pb21tdV9zZXRfaW50cmVtYXBf
dGFibGUoCi0gICAgICAgICAgICAgICAgZHRlLCAodTY0KXZpcnRfdG9fbWFkZHIoaW50cl90
YiksIGlvbW11X2ludHJlbWFwKTsKKyAgICAgICAgICAgICAgICBkdGUsIHZpcnRfdG9fbWFk
ZHIoaXZyc19tYXBwaW5nc1tiZGZdLmludHJlbWFwX3RhYmxlKSwKKyAgICAgICAgICAgICAg
ICBpb21tdV9pbnRyZW1hcCk7CiAgICAgICAgIH0KICAgICB9CiAKLS0tIGEveGVuL2RyaXZl
cnMvcGFzc3Rocm91Z2gvYW1kL3BjaV9hbWRfaW9tbXUuYworKysgYi94ZW4vZHJpdmVycy9w
YXNzdGhyb3VnaC9hbWQvcGNpX2FtZF9pb21tdS5jCkBAIC02OSw4ICs2OSw4IEBAIHN0cnVj
dCBhbWRfaW9tbXUgKmZpbmRfaW9tbXVfZm9yX2RldmljZSgKICAqIHRhYmxlIGFuZCBJL08g
cGFnZSB0YWJsZSByZXNwZWN0aXZlbHkuIFN1Y2ggZGV2aWNlcyB3aWxsIGhhdmUKICAqIGJv
dGggYWxpYXMgZW50cnkgYW5kIHNlbGVjdCBlbnRyeSBpbiBJVlJTIHN0cnVjdHVyZS4KICAq
Ci0gKiBSZXR1cm4gb3JpZ2luYWwgZGV2aWNlIGlkLCBpZiBkZXZpY2UgaGFzIHZhbGlkIGlu
dGVycnVwdCByZW1hcHBpbmcKLSAqIHRhYmxlIHNldHVwIGZvciBib3RoIHNlbGVjdCBlbnRy
eSBhbmQgYWxpYXMgZW50cnkuCisgKiBSZXR1cm4gb3JpZ2luYWwgZGV2aWNlIGlkIGlmIGJv
dGggdGhlIHNwZWNpZmljIGVudHJ5IGFuZCB0aGUgYWxpYXMgZW50cnkKKyAqIGhhdmUgYmVl
biBtYXJrZWQgdmFsaWQuCiAgKi8KIGludCBnZXRfZG1hX3JlcXVlc3Rvcl9pZCh1aW50MTZf
dCBzZWcsIHVpbnQxNl90IGJkZikKIHsKQEAgLTc5LDggKzc5LDcgQEAgaW50IGdldF9kbWFf
cmVxdWVzdG9yX2lkKHVpbnQxNl90IHNlZywgdQogCiAgICAgQlVHX09OICggYmRmID49IGl2
cnNfYmRmX2VudHJpZXMgKTsKICAgICByZXFfaWQgPSBpdnJzX21hcHBpbmdzW2JkZl0uZHRl
X3JlcXVlc3Rvcl9pZDsKLSAgICBpZiAoIChpdnJzX21hcHBpbmdzW2JkZl0uaW50cmVtYXBf
dGFibGUgIT0gTlVMTCkgJiYKLSAgICAgICAgIChpdnJzX21hcHBpbmdzW3JlcV9pZF0uaW50
cmVtYXBfdGFibGUgIT0gTlVMTCkgKQorICAgIGlmICggaXZyc19tYXBwaW5nc1tiZGZdLnZh
bGlkICYmIGl2cnNfbWFwcGluZ3NbcmVxX2lkXS52YWxpZCApCiAgICAgICAgIHJlcV9pZCA9
IGJkZjsKIAogICAgIHJldHVybiByZXFfaWQ7Ci0tLSBhL3hlbi9pbmNsdWRlL2FzbS14ODYv
YW1kLWlvbW11LmgKKysrIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9hbWQtaW9tbXUuaApAQCAt
MTExLDYgKzExMSw3IEBAIHN0cnVjdCBpdnJzX21hcHBpbmdzIHsKICAgICB1OCB1bml0eV9t
YXBfZW5hYmxlOwogICAgIHU4IHdyaXRlX3Blcm1pc3Npb247CiAgICAgdTggcmVhZF9wZXJt
aXNzaW9uOworICAgIGJvb2wgdmFsaWQ7CiAgICAgdW5zaWduZWQgbG9uZyBhZGRyX3Jhbmdl
X3N0YXJ0OwogICAgIHVuc2lnbmVkIGxvbmcgYWRkcl9yYW5nZV9sZW5ndGg7CiAgICAgc3Ry
dWN0IGFtZF9pb21tdSAqaW9tbXU7Cg==
--------------3B7AC5CFE503A3FAD31D6CF7
Content-Type: text/plain; charset=UTF-8;
 name="05-AMD-IOMMU-IRT-alloc-fail.patch"
Content-Transfer-Encoding: base64
Content-Disposition: attachment;
 filename="05-AMD-IOMMU-IRT-alloc-fail.patch"

QU1EL0lPTU1VOiBsZXQgY2FsbGVycyBvZiBhbWRfaW9tbXVfYWxsb2NfaW50cmVtYXBfdGFi
bGUoKSBoYW5kbGUgZXJyb3JzCgpBZGRpdGlvbmFsIHVzZXJzIG9mIHRoZSBmdW5jdGlvbiB3
aWxsIHdhbnQgdG8gaGFuZGxlIGVycm9ycyBtb3JlCmdyYWNlZnVsbHkuIFJlbW92ZSB0aGUg
QlVHX09OKClzIGFuZCBtYWtlIHRoZSBjdXJyZW50IGNhbGxlciBwYW5pYygpCmluc3RlYWQu
CgpTaWduZWQtb2ZmLWJ5OiBKYW4gQmV1bGljaCA8amJldWxpY2hAc3VzZS5jb20+Ci0tLQp2
NTogTmV3LgoKLS0tIGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL2lvbW11X2FjcGku
YworKysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfYWNwaS5jCkBAIC04
Niw2ICs4NiwxMCBAQCBzdGF0aWMgdm9pZCBfX2luaXQgYWRkX2l2cnNfbWFwcGluZ19lbnRy
CiAgICAgICAgICAgICAgaXZyc19tYXBwaW5nc1thbGlhc19pZF0uaW50cmVtYXBfdGFibGUg
PSBzaGFyZWRfaW50cmVtYXBfdGFibGU7CiAgICAgICAgICAgICAgaXZyc19tYXBwaW5nc1th
bGlhc19pZF0uaW50cmVtYXBfaW51c2UgPSBzaGFyZWRfaW50cmVtYXBfaW51c2U7CiAgICAg
ICAgICB9CisKKyAgICAgICAgIGlmICggIWl2cnNfbWFwcGluZ3NbYWxpYXNfaWRdLmludHJl
bWFwX3RhYmxlICkKKyAgICAgICAgICAgICBwYW5pYygiTm8gbWVtb3J5IGZvciAlMDR4OiUw
Mng6JTAyeC4ldSdzIElSVFxuIiwgaW9tbXUtPnNlZywKKyAgICAgICAgICAgICAgICAgICBQ
Q0lfQlVTKGFsaWFzX2lkKSwgUENJX1NMT1QoYWxpYXNfaWQpLCBQQ0lfRlVOQyhhbGlhc19p
ZCkpOwogICAgIH0KIAogICAgIGl2cnNfbWFwcGluZ3NbYWxpYXNfaWRdLnZhbGlkID0gdHJ1
ZTsKLS0tIGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL2lvbW11X2ludHIuYworKysg
Yi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfaW50ci5jCkBAIC04MTcsMTIg
KzgxNywyMiBAQCBpbnQgX19pbml0IGFtZF9pb21tdV9mcmVlX2ludHJlbWFwX3RhYmxlCiB2
b2lkICpfX2luaXQgYW1kX2lvbW11X2FsbG9jX2ludHJlbWFwX3RhYmxlKAogICAgIGNvbnN0
IHN0cnVjdCBhbWRfaW9tbXUgKmlvbW11LCB1bnNpZ25lZCBsb25nICoqaW51c2VfbWFwKQog
ewotICAgIHZvaWQgKnRiID0gX19hbGxvY19hbWRfaW9tbXVfdGFibGVzKGludHJlbWFwX3Rh
YmxlX29yZGVyKGlvbW11KSk7CisgICAgdW5zaWduZWQgaW50IG9yZGVyID0gaW50cmVtYXBf
dGFibGVfb3JkZXIoaW9tbXUpOworICAgIHZvaWQgKnRiID0gX19hbGxvY19hbWRfaW9tbXVf
dGFibGVzKG9yZGVyKTsKKworICAgIGlmICggdGIgKQorICAgIHsKKyAgICAgICAgKmludXNl
X21hcCA9IHh6YWxsb2NfYXJyYXkodW5zaWduZWQgbG9uZywKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgQklUU19UT19MT05HUyhJTlRSRU1BUF9FTlRSSUVTKSk7Cisg
ICAgICAgIGlmICggKmludXNlX21hcCApCisgICAgICAgICAgICBtZW1zZXQodGIsIDAsIFBB
R0VfU0laRSA8PCBvcmRlcik7CisgICAgICAgIGVsc2UKKyAgICAgICAgeworICAgICAgICAg
ICAgX19mcmVlX2FtZF9pb21tdV90YWJsZXModGIsIG9yZGVyKTsKKyAgICAgICAgICAgIHRi
ID0gTlVMTDsKKyAgICAgICAgfQorICAgIH0KIAotICAgIEJVR19PTih0YiA9PSBOVUxMKTsK
LSAgICBtZW1zZXQodGIsIDAsIFBBR0VfU0laRSA8PCBpbnRyZW1hcF90YWJsZV9vcmRlcihp
b21tdSkpOwotICAgICppbnVzZV9tYXAgPSB4emFsbG9jX2FycmF5KHVuc2lnbmVkIGxvbmcs
IEJJVFNfVE9fTE9OR1MoSU5UUkVNQVBfRU5UUklFUykpOwotICAgIEJVR19PTigqaW51c2Vf
bWFwID09IE5VTEwpOwogICAgIHJldHVybiB0YjsKIH0KIAo=
--------------3B7AC5CFE503A3FAD31D6CF7
Content-Type: text/plain; charset=UTF-8;
 name="06-AMD-IOMMU-limit-IRT-allocs.patch"
Content-Transfer-Encoding: base64
Content-Disposition: attachment;
 filename="06-AMD-IOMMU-limit-IRT-allocs.patch"

QU1EL0lPTU1VOiBkb24ndCBibGluZGx5IGFsbG9jYXRlIGludGVycnVwdCByZW1hcHBpbmcg
dGFibGVzCgpBQ1BJIHRhYmxlcyBhcmUgZnJlZSB0byBsaXN0IGZhciBtb3JlIGRldmljZSBj
b29yZGluYXRlcyB0aGFuIHRoZXJlIGFyZQphY3R1YWwgZGV2aWNlcy4gQnkgZGVsYXlpbmcg
dGhlIHRhYmxlIGFsbG9jYXRpb25zIGZvciBtb3N0IGNhc2VzLCBhbmQKZG9pbmcgdGhlbSBv
bmx5IHdoZW4gYW4gYWN0dWFsIGRldmljZSBpcyBrbm93biB0byBiZSBwcmVzZW50IGF0IGEg
Z2l2ZW4KcG9zaXRpb24sIG92ZXJhbGwgbWVtb3J5IHVzZWQgZm9yIHRoZSB0YWJsZXMgZ29l
cyBkb3duIGZyb20gb3ZlciA1MDBrCnBhZ2VzIHRvIGp1c3Qgb3ZlciAxayBvbmVzLgoKVGFi
bGVzIGNvbnRpbnVlIHRvIGdldCBhbGxvY2F0ZWQgcmlnaHQgYXdheSBmb3Igc3BlY2lhbCBl
bnRyaWVzCihJTy1BUElDLCBIUEVUKSBhcyB3ZWxsIGFzIGZvciBhbGlhcyBJRHMuIFdoaWxl
IGluIHRoZSBmb3JtZXIgY2FzZQp0aGF0J3Mgc2ltcGx5IGJlY2F1c2UgdGhlcmUgbWF5IG5v
dCBiZSBhbnkgZGV2aWNlIGF0IGEgZ2l2ZW4gcG9zaXRpb24sCmluIHRoZSBsYXR0ZXIgY2Fz
ZSB0aGlzIGlzIHRvIGF2b2lkIGhhdmluZyB0byBpbnRyb2R1Y2UgcmVmLWNvdW50aW5nIG9m
CnRhYmxlIHVzYWdlLgoKVGhlIGNoYW5nZSBpbnZvbHZlcyBpbnZva2luZwppdGVyYXRlX2l2
cnNfbWFwcGluZ3MoYW1kX2lvbW11X3NldHVwX2RldmljZV90YWJsZSkgYSBzZWNvbmQgdGlt
ZSwKYmVjYXVzZSB0aGUgZnVuY3Rpb24gbm93IHdhbnRzIHRvIGJlIGFibGUgdG8gZmluZCBQ
Q0kgZGV2aWNlcywgd2hpY2gKaXNuJ3QgcG9zc2libGUgeWV0IHdoZW4gSU9NTVUgc2V0dXAg
aGFwcGVucyB2ZXJ5IGVhcmx5IGR1cmluZyB4MkFQSUMKbW9kZSBzZXR1cC4gSW4gdGhpcyBj
b250ZXh0IGFtZF9pb21tdV9pbml0X2ludGVycnVwdCgpIGdldHMgcmVuYW1lZCBhcwp3ZWxs
LgoKVGhlIGxvZ2ljIGFkanVzdGluZyBhIERURSdzIGludGVycnVwdCByZW1hcHBpbmcgYXR0
cmlidXRlcyBhbHNvIGdldHMKY2hhbmdlZCwgc3VjaCB0aGF0IHRoZSBsYWNrIG9mIGFuIElS
VCB3b3VsZCByZXN1bHQgaW4gdGFyZ2V0IGFib3J0ZWQKcmF0aGVyIHRoYW4gbm90IHJlbWFw
cGVkIGludGVycnVwdHMgKHNob3VsZCBhbnkgb2NjdXIpLgoKTm90ZSB0aGF0IGZvciBub3cg
cGhhbnRvbSBmdW5jdGlvbnMgZ2V0IHNlcGFyYXRlIElSVHMgYWxsb2NhdGVkLCBhcyB3YXMK
dGhlIGNhc2UgYmVmb3JlLgoKU2lnbmVkLW9mZi1ieTogSmFuIEJldWxpY2ggPGpiZXVsaWNo
QHN1c2UuY29tPgotLS0KdjU6IE5ldy4KLS0tClRCRDogVGhpcyByZXRhaW5zIHByaW9yIChi
dXQgc3VzcGljaW91cykgYmVoYXZpb3Igb2Ygbm90IGNhbGxpbmcKICAgICBhbWRfaW9tbXVf
c2V0X2ludHJlbWFwX3RhYmxlKCkgZm9yICJpbnZhbGlkIiBJVlJTIG1hcHBpbmcgZW50cmll
cy4KICAgICBTaW5jZSBEVEUuSVY9MCBtZWFucyB1bi1yZW1hcHBlZCBpbnRlcnJ1cHRzLCBJ
IHdvbmRlciBpZiB0aGlzIG5lZWRzCiAgICAgY2hhbmdpbmcuCgpCYWNrcG9ydGluZyBub3Rl
OiBUaGlzIGRlcGVuZHMgb24gYjVmYmU4MTE5NiAiaW9tbXUgLyB4ODY6IG1vdmUgY2FsbCB0
bwpzY2FuX3BjaV9kZXZpY2VzKCkgb3V0IG9mIHZlbmRvciBjb2RlIiEKCi0tLSBhL3hlbi9k
cml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9pb21tdV9hY3BpLmMKKysrIGIveGVuL2RyaXZlcnMv
cGFzc3Rocm91Z2gvYW1kL2lvbW11X2FjcGkuYwpAQCAtNTMsNyArNTMsOCBAQCB1bmlvbiBh
Y3BpX2l2aGRfZGV2aWNlIHsKIH07CiAKIHN0YXRpYyB2b2lkIF9faW5pdCBhZGRfaXZyc19t
YXBwaW5nX2VudHJ5KAotICAgIHUxNiBiZGYsIHUxNiBhbGlhc19pZCwgdTggZmxhZ3MsIHN0
cnVjdCBhbWRfaW9tbXUgKmlvbW11KQorICAgIHVpbnQxNl90IGJkZiwgdWludDE2X3QgYWxp
YXNfaWQsIHVpbnQ4X3QgZmxhZ3MsIGJvb2wgYWxsb2NfaXJ0LAorICAgIHN0cnVjdCBhbWRf
aW9tbXUgKmlvbW11KQogewogICAgIHN0cnVjdCBpdnJzX21hcHBpbmdzICppdnJzX21hcHBp
bmdzID0gZ2V0X2l2cnNfbWFwcGluZ3MoaW9tbXUtPnNlZyk7CiAKQEAgLTY5LDI3ICs3MCwz
MiBAQCBzdGF0aWMgdm9pZCBfX2luaXQgYWRkX2l2cnNfbWFwcGluZ19lbnRyCiAgICAgaWYg
KCBpb21tdS0+YmRmID09IGJkZiApCiAgICAgICAgIHJldHVybjsKIAotICAgIGlmICggIWl2
cnNfbWFwcGluZ3NbYWxpYXNfaWRdLmludHJlbWFwX3RhYmxlICkKKyAgICAvKiBBbGxvY2F0
ZSBpbnRlcnJ1cHQgcmVtYXBwaW5nIHRhYmxlIGlmIG5lZWRlZC4gKi8KKyAgICBpZiAoIGlv
bW11X2ludHJlbWFwICYmICFpdnJzX21hcHBpbmdzW2FsaWFzX2lkXS5pbnRyZW1hcF90YWJs
ZSApCiAgICAgewotICAgICAgICAgLyogYWxsb2NhdGUgcGVyLWRldmljZSBpbnRlcnJ1cHQg
cmVtYXBwaW5nIHRhYmxlICovCi0gICAgICAgICBpZiAoIGFtZF9pb21tdV9wZXJkZXZfaW50
cmVtYXAgKQotICAgICAgICAgICAgIGl2cnNfbWFwcGluZ3NbYWxpYXNfaWRdLmludHJlbWFw
X3RhYmxlID0KLSAgICAgICAgICAgICAgICAgYW1kX2lvbW11X2FsbG9jX2ludHJlbWFwX3Rh
YmxlKAotICAgICAgICAgICAgICAgICAgICAgaW9tbXUsCi0gICAgICAgICAgICAgICAgICAg
ICAmaXZyc19tYXBwaW5nc1thbGlhc19pZF0uaW50cmVtYXBfaW51c2UpOwotICAgICAgICAg
ZWxzZQotICAgICAgICAgewotICAgICAgICAgICAgIGlmICggc2hhcmVkX2ludHJlbWFwX3Rh
YmxlID09IE5VTEwgICkKLSAgICAgICAgICAgICAgICAgc2hhcmVkX2ludHJlbWFwX3RhYmxl
ID0gYW1kX2lvbW11X2FsbG9jX2ludHJlbWFwX3RhYmxlKAotICAgICAgICAgICAgICAgICAg
ICAgaW9tbXUsCi0gICAgICAgICAgICAgICAgICAgICAmc2hhcmVkX2ludHJlbWFwX2ludXNl
KTsKLSAgICAgICAgICAgICBpdnJzX21hcHBpbmdzW2FsaWFzX2lkXS5pbnRyZW1hcF90YWJs
ZSA9IHNoYXJlZF9pbnRyZW1hcF90YWJsZTsKLSAgICAgICAgICAgICBpdnJzX21hcHBpbmdz
W2FsaWFzX2lkXS5pbnRyZW1hcF9pbnVzZSA9IHNoYXJlZF9pbnRyZW1hcF9pbnVzZTsKLSAg
ICAgICAgIH0KLQotICAgICAgICAgaWYgKCAhaXZyc19tYXBwaW5nc1thbGlhc19pZF0uaW50
cmVtYXBfdGFibGUgKQotICAgICAgICAgICAgIHBhbmljKCJObyBtZW1vcnkgZm9yICUwNHg6
JTAyeDolMDJ4LiV1J3MgSVJUXG4iLCBpb21tdS0+c2VnLAotICAgICAgICAgICAgICAgICAg
IFBDSV9CVVMoYWxpYXNfaWQpLCBQQ0lfU0xPVChhbGlhc19pZCksIFBDSV9GVU5DKGFsaWFz
X2lkKSk7CisgICAgICAgIGlmICggIWFtZF9pb21tdV9wZXJkZXZfaW50cmVtYXAgKQorICAg
ICAgICB7CisgICAgICAgICAgICBpZiAoICFzaGFyZWRfaW50cmVtYXBfdGFibGUgKQorICAg
ICAgICAgICAgICAgIHNoYXJlZF9pbnRyZW1hcF90YWJsZSA9IGFtZF9pb21tdV9hbGxvY19p
bnRyZW1hcF90YWJsZSgKKyAgICAgICAgICAgICAgICAgICAgaW9tbXUsICZzaGFyZWRfaW50
cmVtYXBfaW51c2UpOworCisgICAgICAgICAgICBpZiAoICFzaGFyZWRfaW50cmVtYXBfdGFi
bGUgKQorICAgICAgICAgICAgICAgIHBhbmljKCJObyBtZW1vcnkgZm9yIHNoYXJlZCBJUlRc
biIpOworCisgICAgICAgICAgICBpdnJzX21hcHBpbmdzW2FsaWFzX2lkXS5pbnRyZW1hcF90
YWJsZSA9IHNoYXJlZF9pbnRyZW1hcF90YWJsZTsKKyAgICAgICAgICAgIGl2cnNfbWFwcGlu
Z3NbYWxpYXNfaWRdLmludHJlbWFwX2ludXNlID0gc2hhcmVkX2ludHJlbWFwX2ludXNlOwor
ICAgICAgICB9CisgICAgICAgIGVsc2UgaWYgKCBhbGxvY19pcnQgKQorICAgICAgICB7Cisg
ICAgICAgICAgICBpdnJzX21hcHBpbmdzW2FsaWFzX2lkXS5pbnRyZW1hcF90YWJsZSA9Cisg
ICAgICAgICAgICAgICAgYW1kX2lvbW11X2FsbG9jX2ludHJlbWFwX3RhYmxlKAorICAgICAg
ICAgICAgICAgICAgICBpb21tdSwgJml2cnNfbWFwcGluZ3NbYWxpYXNfaWRdLmludHJlbWFw
X2ludXNlKTsKKworICAgICAgICAgICAgaWYgKCAhaXZyc19tYXBwaW5nc1thbGlhc19pZF0u
aW50cmVtYXBfdGFibGUgKQorICAgICAgICAgICAgICAgIHBhbmljKCJObyBtZW1vcnkgZm9y
ICUwNHg6JTAyeDolMDJ4LiV1J3MgSVJUXG4iLAorICAgICAgICAgICAgICAgICAgICAgIGlv
bW11LT5zZWcsIFBDSV9CVVMoYWxpYXNfaWQpLCBQQ0lfU0xPVChhbGlhc19pZCksCisgICAg
ICAgICAgICAgICAgICAgICAgUENJX0ZVTkMoYWxpYXNfaWQpKTsKKyAgICAgICAgfQogICAg
IH0KIAogICAgIGl2cnNfbWFwcGluZ3NbYWxpYXNfaWRdLnZhbGlkID0gdHJ1ZTsKQEAgLTQz
Myw3ICs0MzksOCBAQCBzdGF0aWMgdTE2IF9faW5pdCBwYXJzZV9pdmhkX2RldmljZV9zZWxl
CiAgICAgICAgIHJldHVybiAwOwogICAgIH0KIAotICAgIGFkZF9pdnJzX21hcHBpbmdfZW50
cnkoYmRmLCBiZGYsIHNlbGVjdC0+aGVhZGVyLmRhdGFfc2V0dGluZywgaW9tbXUpOworICAg
IGFkZF9pdnJzX21hcHBpbmdfZW50cnkoYmRmLCBiZGYsIHNlbGVjdC0+aGVhZGVyLmRhdGFf
c2V0dGluZywgZmFsc2UsCisgICAgICAgICAgICAgICAgICAgICAgICAgICBpb21tdSk7CiAK
ICAgICByZXR1cm4gc2l6ZW9mKCpzZWxlY3QpOwogfQpAQCAtNDc5LDcgKzQ4Niw3IEBAIHN0
YXRpYyB1MTYgX19pbml0IHBhcnNlX2l2aGRfZGV2aWNlX3JhbmcKIAogICAgIGZvciAoIGJk
ZiA9IGZpcnN0X2JkZjsgYmRmIDw9IGxhc3RfYmRmOyBiZGYrKyApCiAgICAgICAgIGFkZF9p
dnJzX21hcHBpbmdfZW50cnkoYmRmLCBiZGYsIHJhbmdlLT5zdGFydC5oZWFkZXIuZGF0YV9z
ZXR0aW5nLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlvbW11KTsKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSwgaW9tbXUpOwogCiAgICAgcmV0dXJu
IGRldl9sZW5ndGg7CiB9CkBAIC01MTMsNyArNTIwLDggQEAgc3RhdGljIHUxNiBfX2luaXQg
cGFyc2VfaXZoZF9kZXZpY2VfYWxpYQogCiAgICAgQU1EX0lPTU1VX0RFQlVHKCIgRGV2X0lk
IEFsaWFzOiAlI3hcbiIsIGFsaWFzX2lkKTsKIAotICAgIGFkZF9pdnJzX21hcHBpbmdfZW50
cnkoYmRmLCBhbGlhc19pZCwgYWxpYXMtPmhlYWRlci5kYXRhX3NldHRpbmcsIGlvbW11KTsK
KyAgICBhZGRfaXZyc19tYXBwaW5nX2VudHJ5KGJkZiwgYWxpYXNfaWQsIGFsaWFzLT5oZWFk
ZXIuZGF0YV9zZXR0aW5nLCB0cnVlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgaW9t
bXUpOwogCiAgICAgcmV0dXJuIGRldl9sZW5ndGg7CiB9CkBAIC01NjgsNyArNTc2LDcgQEAg
c3RhdGljIHUxNiBfX2luaXQgcGFyc2VfaXZoZF9kZXZpY2VfYWxpYQogCiAgICAgZm9yICgg
YmRmID0gZmlyc3RfYmRmOyBiZGYgPD0gbGFzdF9iZGY7IGJkZisrICkKICAgICAgICAgYWRk
X2l2cnNfbWFwcGluZ19lbnRyeShiZGYsIGFsaWFzX2lkLCByYW5nZS0+YWxpYXMuaGVhZGVy
LmRhdGFfc2V0dGluZywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpb21tdSk7
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ1ZSwgaW9tbXUpOwogCiAgICAg
cmV0dXJuIGRldl9sZW5ndGg7CiB9CkBAIC01OTMsNyArNjAxLDcgQEAgc3RhdGljIHUxNiBf
X2luaXQgcGFyc2VfaXZoZF9kZXZpY2VfZXh0ZQogICAgICAgICByZXR1cm4gMDsKICAgICB9
CiAKLSAgICBhZGRfaXZyc19tYXBwaW5nX2VudHJ5KGJkZiwgYmRmLCBleHQtPmhlYWRlci5k
YXRhX3NldHRpbmcsIGlvbW11KTsKKyAgICBhZGRfaXZyc19tYXBwaW5nX2VudHJ5KGJkZiwg
YmRmLCBleHQtPmhlYWRlci5kYXRhX3NldHRpbmcsIGZhbHNlLCBpb21tdSk7CiAKICAgICBy
ZXR1cm4gZGV2X2xlbmd0aDsKIH0KQEAgLTY0MCw3ICs2NDgsNyBAQCBzdGF0aWMgdTE2IF9f
aW5pdCBwYXJzZV9pdmhkX2RldmljZV9leHRlCiAKICAgICBmb3IgKCBiZGYgPSBmaXJzdF9i
ZGY7IGJkZiA8PSBsYXN0X2JkZjsgYmRmKysgKQogICAgICAgICBhZGRfaXZyc19tYXBwaW5n
X2VudHJ5KGJkZiwgYmRmLCByYW5nZS0+ZXh0ZW5kZWQuaGVhZGVyLmRhdGFfc2V0dGluZywK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpb21tdSk7CisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgZmFsc2UsIGlvbW11KTsKIAogICAgIHJldHVybiBkZXZfbGVu
Z3RoOwogfQpAQCAtNzMzLDcgKzc0MSw4IEBAIHN0YXRpYyB1MTYgX19pbml0IHBhcnNlX2l2
aGRfZGV2aWNlX3NwZWMKICAgICBBTURfSU9NTVVfREVCVUcoIklWSEQgU3BlY2lhbDogJTA0
eDolMDJ4OiUwMnguJXUgdmFyaWV0eSAlI3ggaGFuZGxlICUjeFxuIiwKICAgICAgICAgICAg
ICAgICAgICAgc2VnLCBQQ0lfQlVTKGJkZiksIFBDSV9TTE9UKGJkZiksIFBDSV9GVU5DKGJk
ZiksCiAgICAgICAgICAgICAgICAgICAgIHNwZWNpYWwtPnZhcmlldHksIHNwZWNpYWwtPmhh
bmRsZSk7Ci0gICAgYWRkX2l2cnNfbWFwcGluZ19lbnRyeShiZGYsIGJkZiwgc3BlY2lhbC0+
aGVhZGVyLmRhdGFfc2V0dGluZywgaW9tbXUpOworICAgIGFkZF9pdnJzX21hcHBpbmdfZW50
cnkoYmRmLCBiZGYsIHNwZWNpYWwtPmhlYWRlci5kYXRhX3NldHRpbmcsIHRydWUsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICBpb21tdSk7CiAKICAgICBzd2l0Y2ggKCBzcGVjaWFs
LT52YXJpZXR5ICkKICAgICB7Ci0tLSBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9p
b21tdV9pbml0LmMKKysrIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL2lvbW11X2lu
aXQuYwpAQCAtMzAsNiArMzAsNyBAQAogI2luY2x1ZGUgPHhlbi9kZWxheS5oPgogCiBzdGF0
aWMgaW50IF9faW5pdGRhdGEgbnJfYW1kX2lvbW11czsKK3N0YXRpYyBib29sIF9faW5pdGRh
dGEgcGNpX2luaXQ7CiAKIHN0YXRpYyB2b2lkIGRvX2FtZF9pb21tdV9pcnEodW5zaWduZWQg
bG9uZyBkYXRhKTsKIHN0YXRpYyBERUNMQVJFX1NPRlRJUlFfVEFTS0xFVChhbWRfaW9tbXVf
aXJxX3Rhc2tsZXQsIGRvX2FtZF9pb21tdV9pcnEsIDApOwpAQCAtMTI0NywxNyArMTI0OCwy
MCBAQCBzdGF0aWMgaW50IF9faW5pdCBhbWRfaW9tbXVfc2V0dXBfZGV2aWNlCiAKICAgICBC
VUdfT04oIChpdnJzX2JkZl9lbnRyaWVzID09IDApICk7CiAKLSAgICAvKiBhbGxvY2F0ZSAn
ZGV2aWNlIHRhYmxlJyBvbiBhIDRLIGJvdW5kYXJ5ICovCi0gICAgZGV2aWNlX3RhYmxlLmFs
bG9jX3NpemUgPSBQQUdFX1NJWkUgPDwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGdldF9vcmRlcl9mcm9tX2J5dGVzKAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
UEFHRV9BTElHTihpdnJzX2JkZl9lbnRyaWVzICoKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIElPTU1VX0RFVl9UQUJMRV9FTlRSWV9TSVpFKSk7Ci0gICAgZGV2aWNlX3RhYmxl
LmVudHJpZXMgPSBkZXZpY2VfdGFibGUuYWxsb2Nfc2l6ZSAvCi0gICAgICAgICAgICAgICAg
ICAgICAgICAgICBJT01NVV9ERVZfVEFCTEVfRU5UUllfU0laRTsKLQotICAgIGRldmljZV90
YWJsZS5idWZmZXIgPSBhbGxvY2F0ZV9idWZmZXIoZGV2aWNlX3RhYmxlLmFsbG9jX3NpemUs
Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiRGV2aWNlIFRh
YmxlIik7Ci0gICAgaWYgICggZGV2aWNlX3RhYmxlLmJ1ZmZlciA9PSBOVUxMICkKKyAgICBp
ZiAoICFkZXZpY2VfdGFibGUuYnVmZmVyICkKKyAgICB7CisgICAgICAgIC8qIGFsbG9jYXRl
ICdkZXZpY2UgdGFibGUnIG9uIGEgNEsgYm91bmRhcnkgKi8KKyAgICAgICAgZGV2aWNlX3Rh
YmxlLmFsbG9jX3NpemUgPSBQQUdFX1NJWkUgPDwKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBnZXRfb3JkZXJfZnJvbV9ieXRlcygKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBQQUdFX0FMSUdOKGl2cnNfYmRmX2VudHJpZXMgKgorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIElPTU1VX0RFVl9UQUJMRV9FTlRSWV9TSVpFKSk7
CisgICAgICAgIGRldmljZV90YWJsZS5lbnRyaWVzID0gZGV2aWNlX3RhYmxlLmFsbG9jX3Np
emUgLworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElPTU1VX0RFVl9UQUJMRV9F
TlRSWV9TSVpFOworCisgICAgICAgIGRldmljZV90YWJsZS5idWZmZXIgPSBhbGxvY2F0ZV9i
dWZmZXIoZGV2aWNlX3RhYmxlLmFsbG9jX3NpemUsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIkRldmljZSBUYWJsZSIpOworICAgIH0KKyAgICBp
ZiAoICFkZXZpY2VfdGFibGUuYnVmZmVyICkKICAgICAgICAgcmV0dXJuIC1FTk9NRU07CiAK
ICAgICAvKiBBZGQgZGV2aWNlIHRhYmxlIGVudHJpZXMgKi8KQEAgLTEyNjYsMTMgKzEyNzAs
NDYgQEAgc3RhdGljIGludCBfX2luaXQgYW1kX2lvbW11X3NldHVwX2RldmljZQogICAgICAg
ICBpZiAoIGl2cnNfbWFwcGluZ3NbYmRmXS52YWxpZCApCiAgICAgICAgIHsKICAgICAgICAg
ICAgIHZvaWQgKmR0ZTsKKyAgICAgICAgICAgIGNvbnN0IHN0cnVjdCBwY2lfZGV2ICpwZGV2
ID0gTlVMTDsKIAogICAgICAgICAgICAgLyogYWRkIGRldmljZSB0YWJsZSBlbnRyeSAqLwog
ICAgICAgICAgICAgZHRlID0gZGV2aWNlX3RhYmxlLmJ1ZmZlciArIChiZGYgKiBJT01NVV9E
RVZfVEFCTEVfRU5UUllfU0laRSk7CiAgICAgICAgICAgICBpb21tdV9kdGVfYWRkX2Rldmlj
ZV9lbnRyeShkdGUsICZpdnJzX21hcHBpbmdzW2JkZl0pOwogCisgICAgICAgICAgICBpZiAo
IGlvbW11X2ludHJlbWFwICYmCisgICAgICAgICAgICAgICAgIGl2cnNfbWFwcGluZ3NbYmRm
XS5kdGVfcmVxdWVzdG9yX2lkID09IGJkZiAmJgorICAgICAgICAgICAgICAgICAhaXZyc19t
YXBwaW5nc1tiZGZdLmludHJlbWFwX3RhYmxlICkKKyAgICAgICAgICAgIHsKKyAgICAgICAg
ICAgICAgICBpZiAoICFwY2lfaW5pdCApCisgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVl
OworICAgICAgICAgICAgICAgIHBjaWRldnNfbG9jaygpOworICAgICAgICAgICAgICAgIHBk
ZXYgPSBwY2lfZ2V0X3BkZXYoc2VnLCBQQ0lfQlVTKGJkZiksIFBDSV9ERVZGTjIoYmRmKSk7
CisgICAgICAgICAgICAgICAgcGNpZGV2c191bmxvY2soKTsKKyAgICAgICAgICAgIH0KKwor
ICAgICAgICAgICAgaWYgKCBwZGV2ICkKKyAgICAgICAgICAgIHsKKyAgICAgICAgICAgICAg
ICB1bnNpZ25lZCBpbnQgcmVxX2lkID0gYmRmOworCisgICAgICAgICAgICAgICAgZG8gewor
ICAgICAgICAgICAgICAgICAgICBpdnJzX21hcHBpbmdzW3JlcV9pZF0uaW50cmVtYXBfdGFi
bGUgPQorICAgICAgICAgICAgICAgICAgICAgICAgYW1kX2lvbW11X2FsbG9jX2ludHJlbWFw
X3RhYmxlKAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl2cnNfbWFwcGluZ3NbYmRm
XS5pb21tdSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAmaXZyc19tYXBwaW5nc1ty
ZXFfaWRdLmludHJlbWFwX2ludXNlKTsKKyAgICAgICAgICAgICAgICAgICAgaWYgKCAhaXZy
c19tYXBwaW5nc1tyZXFfaWRdLmludHJlbWFwX3RhYmxlICkKKyAgICAgICAgICAgICAgICAg
ICAgICAgIHJldHVybiAtRU5PTUVNOworCisgICAgICAgICAgICAgICAgICAgIGlmICggIXBk
ZXYtPnBoYW50b21fc3RyaWRlICkKKyAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwor
ICAgICAgICAgICAgICAgICAgICByZXFfaWQgKz0gcGRldi0+cGhhbnRvbV9zdHJpZGU7Cisg
ICAgICAgICAgICAgICAgfSB3aGlsZSAoIFBDSV9TTE9UKHJlcV9pZCkgPT0gcGRldi0+c2Jk
Zi5kZXYgKTsKKyAgICAgICAgICAgIH0KKwogICAgICAgICAgICAgYW1kX2lvbW11X3NldF9p
bnRyZW1hcF90YWJsZSgKLSAgICAgICAgICAgICAgICBkdGUsIHZpcnRfdG9fbWFkZHIoaXZy
c19tYXBwaW5nc1tiZGZdLmludHJlbWFwX3RhYmxlKSwKKyAgICAgICAgICAgICAgICBkdGUs
CisgICAgICAgICAgICAgICAgaXZyc19tYXBwaW5nc1tiZGZdLmludHJlbWFwX3RhYmxlCisg
ICAgICAgICAgICAgICAgPyB2aXJ0X3RvX21hZGRyKGl2cnNfbWFwcGluZ3NbYmRmXS5pbnRy
ZW1hcF90YWJsZSkKKyAgICAgICAgICAgICAgICA6IDAsCiAgICAgICAgICAgICAgICAgaW9t
bXVfaW50cmVtYXApOwogICAgICAgICB9CiAgICAgfQpAQCAtMTQwNSw3ICsxNDQyLDggQEAg
aW50IF9faW5pdCBhbWRfaW9tbXVfaW5pdChib29sIHh0KQogICAgIGlmICggcmMgKQogICAg
ICAgICBnb3RvIGVycm9yX291dDsKIAotICAgIC8qIGFsbG9jYXRlIGFuZCBpbml0aWFsaXpl
IGEgZ2xvYmFsIGRldmljZSB0YWJsZSBzaGFyZWQgYnkgYWxsIGlvbW11cyAqLworICAgIC8q
IEFsbG9jYXRlIGFuZCBpbml0aWFsaXplIGRldmljZSB0YWJsZShzKS4gKi8KKyAgICBwY2lf
aW5pdCA9ICF4dDsKICAgICByYyA9IGl0ZXJhdGVfaXZyc19tYXBwaW5ncyhhbWRfaW9tbXVf
c2V0dXBfZGV2aWNlX3RhYmxlKTsKICAgICBpZiAoIHJjICkKICAgICAgICAgZ290byBlcnJv
cl9vdXQ7CkBAIC0xNDI0LDcgKzE0NjIsNyBAQCBpbnQgX19pbml0IGFtZF9pb21tdV9pbml0
KGJvb2wgeHQpCiAgICAgICAgIC8qCiAgICAgICAgICAqIFNldHRpbmcgdXAgb2YgdGhlIElP
TU1VIGludGVycnVwdHMgY2Fubm90IG9jY3VyIHlldCBhdCB0aGUgKHZlcnkKICAgICAgICAg
ICogZWFybHkpIHRpbWUgd2UgZ2V0IGhlcmUgd2hlbiBlbmFibGluZyB4MkFQSUMgbW9kZS4g
U3VwcHJlc3MgaXQKLSAgICAgICAgICogaGVyZSwgYW5kIGRvIGl0IGV4cGxpY2l0bHkgaW4g
YW1kX2lvbW11X2luaXRfaW50ZXJydXB0KCkuCisgICAgICAgICAqIGhlcmUsIGFuZCBkbyBp
dCBleHBsaWNpdGx5IGluIGFtZF9pb21tdV9pbml0X2xhdGUoKS4KICAgICAgICAgICovCiAg
ICAgICAgIHJjID0gYW1kX2lvbW11X2luaXRfb25lKGlvbW11LCAheHQpOwogICAgICAgICBp
ZiAoIHJjICkKQEAgLTE0MzgsMTEgKzE0NzYsMTYgQEAgZXJyb3Jfb3V0OgogICAgIHJldHVy
biByYzsKIH0KIAotaW50IF9faW5pdCBhbWRfaW9tbXVfaW5pdF9pbnRlcnJ1cHQodm9pZCkK
K2ludCBfX2luaXQgYW1kX2lvbW11X2luaXRfbGF0ZSh2b2lkKQogewogICAgIHN0cnVjdCBh
bWRfaW9tbXUgKmlvbW11OwogICAgIGludCByYyA9IDA7CiAKKyAgICAvKiBGdXJ0aGVyIGlu
aXRpYWxpemUgdGhlIGRldmljZSB0YWJsZShzKS4gKi8KKyAgICBwY2lfaW5pdCA9IHRydWU7
CisgICAgaWYgKCBpb21tdV9pbnRyZW1hcCApCisgICAgICAgIHJjID0gaXRlcmF0ZV9pdnJz
X21hcHBpbmdzKGFtZF9pb21tdV9zZXR1cF9kZXZpY2VfdGFibGUpOworCiAgICAgZm9yX2Vh
Y2hfYW1kX2lvbW11ICggaW9tbXUgKQogICAgIHsKICAgICAgICAgc3RydWN0IGlycV9kZXNj
ICpkZXNjOwotLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfaW50ci5j
CisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9pb21tdV9pbnRyLmMKQEAgLTc4
OSw3ICs3ODksNyBAQCB2b2lkIGFtZF9pb21tdV9yZWFkX21zaV9mcm9tX2lyZSgKICAgICB9
CiB9CiAKLWludCBfX2luaXQgYW1kX2lvbW11X2ZyZWVfaW50cmVtYXBfdGFibGUoCitpbnQg
YW1kX2lvbW11X2ZyZWVfaW50cmVtYXBfdGFibGUoCiAgICAgY29uc3Qgc3RydWN0IGFtZF9p
b21tdSAqaW9tbXUsIHN0cnVjdCBpdnJzX21hcHBpbmdzICppdnJzX21hcHBpbmcpCiB7CiAg
ICAgdm9pZCAqKnRibHA7CkBAIC04MTQsNyArODE0LDcgQEAgaW50IF9faW5pdCBhbWRfaW9t
bXVfZnJlZV9pbnRyZW1hcF90YWJsZQogICAgIHJldHVybiAwOwogfQogCi12b2lkICpfX2lu
aXQgYW1kX2lvbW11X2FsbG9jX2ludHJlbWFwX3RhYmxlKAordm9pZCAqYW1kX2lvbW11X2Fs
bG9jX2ludHJlbWFwX3RhYmxlKAogICAgIGNvbnN0IHN0cnVjdCBhbWRfaW9tbXUgKmlvbW11
LCB1bnNpZ25lZCBsb25nICoqaW51c2VfbWFwKQogewogICAgIHVuc2lnbmVkIGludCBvcmRl
ciA9IGludHJlbWFwX3RhYmxlX29yZGVyKGlvbW11KTsKLS0tIGEveGVuL2RyaXZlcnMvcGFz
c3Rocm91Z2gvYW1kL2lvbW11X21hcC5jCisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdo
L2FtZC9pb21tdV9tYXAuYwpAQCAtMTE2LDggKzExNiw5IEBAIHZvaWQgX19pbml0IGFtZF9p
b21tdV9zZXRfaW50cmVtYXBfdGFibGUKICAgICBzdHJ1Y3QgYW1kX2lvbW11X2R0ZSAqZHRl
LCB1aW50NjRfdCBpbnRyZW1hcF9wdHIsIGJvb2wgdmFsaWQpCiB7CiAgICAgZHRlLT5pdF9y
b290ID0gaW50cmVtYXBfcHRyID4+IDY7Ci0gICAgZHRlLT5pbnRfdGFiX2xlbiA9IElPTU1V
X0lOVFJFTUFQX09SREVSOwotICAgIGR0ZS0+aW50X2N0bCA9IElPTU1VX0RFVl9UQUJMRV9J
TlRfQ09OVFJPTF9UUkFOU0xBVEVEOworICAgIGR0ZS0+aW50X3RhYl9sZW4gPSBpbnRyZW1h
cF9wdHIgPyBJT01NVV9JTlRSRU1BUF9PUkRFUiA6IDA7CisgICAgZHRlLT5pbnRfY3RsID0g
aW50cmVtYXBfcHRyID8gSU9NTVVfREVWX1RBQkxFX0lOVF9DT05UUk9MX1RSQU5TTEFURUQK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBJT01NVV9ERVZfVEFCTEVfSU5U
X0NPTlRST0xfQUJPUlRFRDsKICAgICBkdGUtPmlnID0gZmFsc2U7IC8qIHVubWFwcGVkIGlu
dGVycnVwdHMgcmVzdWx0IGluIGkvbyBwYWdlIGZhdWx0cyAqLwogICAgIGR0ZS0+aXYgPSB2
YWxpZDsKIH0KLS0tIGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL3BjaV9hbWRfaW9t
bXUuYworKysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvcGNpX2FtZF9pb21tdS5j
CkBAIC0xNjUsNyArMTY1LDcgQEAgc3RhdGljIGludCBfX2luaXQgaW92X2RldGVjdCh2b2lk
KQogICAgIGlmICggIWlvbW11X2VuYWJsZSAmJiAhaW9tbXVfaW50cmVtYXAgKQogICAgICAg
ICByZXR1cm4gMDsKIAotICAgIGlmICggKGluaXRfZG9uZSA/IGFtZF9pb21tdV9pbml0X2lu
dGVycnVwdCgpCisgICAgaWYgKCAoaW5pdF9kb25lID8gYW1kX2lvbW11X2luaXRfbGF0ZSgp
CiAgICAgICAgICAgICAgICAgICAgIDogYW1kX2lvbW11X2luaXQoZmFsc2UpKSAhPSAwICkK
ICAgICB7CiAgICAgICAgIHByaW50aygiQU1ELVZpOiBFcnJvciBpbml0aWFsaXphdGlvblxu
Iik7CkBAIC00MjksNiArNDI5LDcgQEAgc3RhdGljIGludCBhbWRfaW9tbXVfYWRkX2Rldmlj
ZSh1OCBkZXZmbgogewogICAgIHN0cnVjdCBhbWRfaW9tbXUgKmlvbW11OwogICAgIHUxNiBi
ZGY7CisgICAgc3RydWN0IGl2cnNfbWFwcGluZ3MgKml2cnNfbWFwcGluZ3M7CiAKICAgICBp
ZiAoICFwZGV2LT5kb21haW4gKQogICAgICAgICByZXR1cm4gLUVJTlZBTDsKQEAgLTQ1OCw2
ICs0NTksMzIgQEAgc3RhdGljIGludCBhbWRfaW9tbXVfYWRkX2RldmljZSh1OCBkZXZmbgog
ICAgICAgICByZXR1cm4gLUVOT0RFVjsKICAgICB9CiAKKyAgICBpdnJzX21hcHBpbmdzID0g
Z2V0X2l2cnNfbWFwcGluZ3MocGRldi0+c2VnKTsKKyAgICBiZGYgPSBQQ0lfQkRGMihwZGV2
LT5idXMsIGRldmZuKTsKKyAgICBpZiAoICFpdnJzX21hcHBpbmdzIHx8CisgICAgICAgICAh
aXZyc19tYXBwaW5nc1tpdnJzX21hcHBpbmdzW2JkZl0uZHRlX3JlcXVlc3Rvcl9pZF0udmFs
aWQgKQorICAgICAgICByZXR1cm4gLUVQRVJNOworCisgICAgaWYgKCBpb21tdV9pbnRyZW1h
cCAmJgorICAgICAgICAgaXZyc19tYXBwaW5nc1tiZGZdLmR0ZV9yZXF1ZXN0b3JfaWQgPT0g
YmRmICYmCisgICAgICAgICAhaXZyc19tYXBwaW5nc1tiZGZdLmludHJlbWFwX3RhYmxlICkK
KyAgICB7CisgICAgICAgIGl2cnNfbWFwcGluZ3NbYmRmXS5pbnRyZW1hcF90YWJsZSA9Cisg
ICAgICAgICAgICBhbWRfaW9tbXVfYWxsb2NfaW50cmVtYXBfdGFibGUoCisgICAgICAgICAg
ICAgICAgaW9tbXUsICZpdnJzX21hcHBpbmdzW2JkZl0uaW50cmVtYXBfaW51c2UpOworICAg
ICAgICBpZiAoICFpdnJzX21hcHBpbmdzW2JkZl0uaW50cmVtYXBfdGFibGUgKQorICAgICAg
ICAgICAgcmV0dXJuIC1FTk9NRU07CisKKyAgICAgICAgYW1kX2lvbW11X3NldF9pbnRyZW1h
cF90YWJsZSgKKyAgICAgICAgICAgIGlvbW11LT5kZXZfdGFibGUuYnVmZmVyICsgKGJkZiAq
IElPTU1VX0RFVl9UQUJMRV9FTlRSWV9TSVpFKSwKKyAgICAgICAgICAgIGl2cnNfbWFwcGlu
Z3NbYmRmXS5pbnRyZW1hcF90YWJsZQorICAgICAgICAgICAgPyB2aXJ0X3RvX21hZGRyKGl2
cnNfbWFwcGluZ3NbYmRmXS5pbnRyZW1hcF90YWJsZSkKKyAgICAgICAgICAgIDogMCwKKyAg
ICAgICAgICAgIGlvbW11X2ludHJlbWFwKTsKKworICAgICAgICBhbWRfaW9tbXVfZmx1c2hf
ZGV2aWNlKGlvbW11LCBiZGYpOworICAgIH0KKwogICAgIGFtZF9pb21tdV9zZXR1cF9kb21h
aW5fZGV2aWNlKHBkZXYtPmRvbWFpbiwgaW9tbXUsIGRldmZuLCBwZGV2KTsKICAgICByZXR1
cm4gMDsKIH0KQEAgLTQ2Niw2ICs0OTMsOCBAQCBzdGF0aWMgaW50IGFtZF9pb21tdV9yZW1v
dmVfZGV2aWNlKHU4IGRlCiB7CiAgICAgc3RydWN0IGFtZF9pb21tdSAqaW9tbXU7CiAgICAg
dTE2IGJkZjsKKyAgICBzdHJ1Y3QgaXZyc19tYXBwaW5ncyAqaXZyc19tYXBwaW5nczsKKwog
ICAgIGlmICggIXBkZXYtPmRvbWFpbiApCiAgICAgICAgIHJldHVybiAtRUlOVkFMOwogCkBA
IC00ODEsNiArNTEwLDE0IEBAIHN0YXRpYyBpbnQgYW1kX2lvbW11X3JlbW92ZV9kZXZpY2Uo
dTggZGUKICAgICB9CiAKICAgICBhbWRfaW9tbXVfZGlzYWJsZV9kb21haW5fZGV2aWNlKHBk
ZXYtPmRvbWFpbiwgaW9tbXUsIGRldmZuLCBwZGV2KTsKKworICAgIGl2cnNfbWFwcGluZ3Mg
PSBnZXRfaXZyc19tYXBwaW5ncyhwZGV2LT5zZWcpOworICAgIGJkZiA9IFBDSV9CREYyKHBk
ZXYtPmJ1cywgZGV2Zm4pOworICAgIGlmICggYW1kX2lvbW11X3BlcmRldl9pbnRyZW1hcCAm
JgorICAgICAgICAgaXZyc19tYXBwaW5nc1tiZGZdLmR0ZV9yZXF1ZXN0b3JfaWQgPT0gYmRm
ICYmCisgICAgICAgICBpdnJzX21hcHBpbmdzW2JkZl0uaW50cmVtYXBfdGFibGUgKQorICAg
ICAgICBhbWRfaW9tbXVfZnJlZV9pbnRyZW1hcF90YWJsZShpb21tdSwgJml2cnNfbWFwcGlu
Z3NbYmRmXSk7CisKICAgICByZXR1cm4gMDsKIH0KIAotLS0gYS94ZW4vaW5jbHVkZS9hc20t
eDg2L2h2bS9zdm0vYW1kLWlvbW11LXByb3RvLmgKKysrIGIveGVuL2luY2x1ZGUvYXNtLXg4
Ni9odm0vc3ZtL2FtZC1pb21tdS1wcm90by5oCkBAIC01MCw3ICs1MCw3IEBAIHZvaWQgZ2V0
X2lvbW11X2ZlYXR1cmVzKHN0cnVjdCBhbWRfaW9tbXUKIC8qIGFtZC1pb21tdS1pbml0IGZ1
bmN0aW9ucyAqLwogaW50IGFtZF9pb21tdV9wcmVwYXJlKGJvb2wgeHQpOwogaW50IGFtZF9p
b21tdV9pbml0KGJvb2wgeHQpOwotaW50IGFtZF9pb21tdV9pbml0X2ludGVycnVwdCh2b2lk
KTsKK2ludCBhbWRfaW9tbXVfaW5pdF9sYXRlKHZvaWQpOwogaW50IGFtZF9pb21tdV91cGRh
dGVfaXZyc19tYXBwaW5nX2FjcGkodm9pZCk7CiBpbnQgaW92X2FkanVzdF9pcnFfYWZmaW5p
dGllcyh2b2lkKTsKIAo=
--------------3B7AC5CFE503A3FAD31D6CF7
Content-Type: text/plain; charset=UTF-8;
 name="07-AMD-IOMMU-limit-IRT-phantom-funcs.patch"
Content-Transfer-Encoding: base64
Content-Disposition: attachment;
 filename="07-AMD-IOMMU-limit-IRT-phantom-funcs.patch"

QU1EL0lPTU1VOiBtYWtlIHBoYW50b20gZnVuY3Rpb25zIHNoYXJlIGludGVycnVwdCByZW1h
cHBpbmcgdGFibGVzCgpSYXRoZXIgdGhhbiBkdXBsaWNhdGluZyBlbnRyaWVzIGluIGFtZF9p
b21tdV9tc2lfbXNnX3VwZGF0ZV9pcmUoKSwgc2hhcmUKdGhlIHRhYmxlcy4gVGhpcyBtYWlu
bHkgcmVxdWlyZXMgc29tZSBjYXJlIHdoaWxlIGZyZWVpbmcgdGhlbSwgdG8gYXZvaWQKZnJl
ZWluZyBtZW1vcnkgYmxvY2tzIHR3aWNlLgoKU2lnbmVkLW9mZi1ieTogSmFuIEJldWxpY2gg
PGpiZXVsaWNoQHN1c2UuY29tPgotLS0KdjU6IE5ldy4KCi0tLSBhL3hlbi9kcml2ZXJzL3Bh
c3N0aHJvdWdoL2FtZC9pb21tdV9pbml0LmMKKysrIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91
Z2gvYW1kL2lvbW11X2luaXQuYwpAQCAtMTExNCw3ICsxMTE0LDcgQEAgc3RhdGljIHZvaWQg
X19pbml0IGFtZF9pb21tdV9pbml0X2NsZWFudQogICAgICAgICBhbWRfaW9tbXVfZnJlZV9p
bnRyZW1hcF90YWJsZShsaXN0X2ZpcnN0X2VudHJ5KCZhbWRfaW9tbXVfaGVhZCwKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1
Y3QgYW1kX2lvbW11LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGxpc3QpLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBOVUxMKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
TlVMTCwgMCk7CiAKICAgICAvKiBmcmVlIGFtZCBpb21tdSBsaXN0ICovCiAgICAgbGlzdF9m
b3JfZWFjaF9lbnRyeV9zYWZlICggaW9tbXUsIG5leHQsICZhbWRfaW9tbXVfaGVhZCwgbGlz
dCApCkBAIC0xMTc5LDcgKzExNzksNyBAQCBpbnQgaXRlcmF0ZV9pdnJzX21hcHBpbmdzKGlu
dCAoKmhhbmRsZXIpCiB9CiAKIGludCBpdGVyYXRlX2l2cnNfZW50cmllcyhpbnQgKCpoYW5k
bGVyKShjb25zdCBzdHJ1Y3QgYW1kX2lvbW11ICosCi0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgc3RydWN0IGl2cnNfbWFwcGluZ3MgKikpCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGl2cnNfbWFwcGluZ3MgKiwg
dWludDE2X3QgYmRmKSkKIHsKICAgICB1MTYgc2VnID0gMDsKICAgICBpbnQgcmMgPSAwOwpA
QCAtMTE5Niw3ICsxMTk2LDcgQEAgaW50IGl0ZXJhdGVfaXZyc19lbnRyaWVzKGludCAoKmhh
bmRsZXIpKAogICAgICAgICAgICAgY29uc3Qgc3RydWN0IGFtZF9pb21tdSAqaW9tbXUgPSBt
YXBbYmRmXS5pb21tdTsKIAogICAgICAgICAgICAgaWYgKCBpb21tdSAmJiBtYXBbYmRmXS5k
dGVfcmVxdWVzdG9yX2lkID09IGJkZiApCi0gICAgICAgICAgICAgICAgcmMgPSBoYW5kbGVy
KGlvbW11LCAmbWFwW2JkZl0pOworICAgICAgICAgICAgICAgIHJjID0gaGFuZGxlcihpb21t
dSwgJm1hcFtiZGZdLCBiZGYpOwogICAgICAgICB9CiAgICAgfSB3aGlsZSAoICFyYyAmJiAr
K3NlZyApOwogCkBAIC0xMjg5LDIwICsxMjg5LDI5IEBAIHN0YXRpYyBpbnQgX19pbml0IGFt
ZF9pb21tdV9zZXR1cF9kZXZpY2UKIAogICAgICAgICAgICAgaWYgKCBwZGV2ICkKICAgICAg
ICAgICAgIHsKLSAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgcmVxX2lkID0gYmRmOwot
Ci0gICAgICAgICAgICAgICAgZG8gewotICAgICAgICAgICAgICAgICAgICBpdnJzX21hcHBp
bmdzW3JlcV9pZF0uaW50cmVtYXBfdGFibGUgPQotICAgICAgICAgICAgICAgICAgICAgICAg
YW1kX2lvbW11X2FsbG9jX2ludHJlbWFwX3RhYmxlKAotICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGl2cnNfbWFwcGluZ3NbYmRmXS5pb21tdSwKLSAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAmaXZyc19tYXBwaW5nc1tyZXFfaWRdLmludHJlbWFwX2ludXNlKTsKLSAgICAg
ICAgICAgICAgICAgICAgaWYgKCAhaXZyc19tYXBwaW5nc1tyZXFfaWRdLmludHJlbWFwX3Rh
YmxlICkKLSAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtRU5PTUVNOwotCi0gICAg
ICAgICAgICAgICAgICAgIGlmICggIXBkZXYtPnBoYW50b21fc3RyaWRlICkKLSAgICAgICAg
ICAgICAgICAgICAgICAgIGJyZWFrOwotICAgICAgICAgICAgICAgICAgICByZXFfaWQgKz0g
cGRldi0+cGhhbnRvbV9zdHJpZGU7Ci0gICAgICAgICAgICAgICAgfSB3aGlsZSAoIFBDSV9T
TE9UKHJlcV9pZCkgPT0gcGRldi0+c2JkZi5kZXYgKTsKKyAgICAgICAgICAgICAgICBpdnJz
X21hcHBpbmdzW2JkZl0uaW50cmVtYXBfdGFibGUgPQorICAgICAgICAgICAgICAgICAgICBh
bWRfaW9tbXVfYWxsb2NfaW50cmVtYXBfdGFibGUoCisgICAgICAgICAgICAgICAgICAgICAg
ICBpdnJzX21hcHBpbmdzW2JkZl0uaW9tbXUsCisgICAgICAgICAgICAgICAgICAgICAgICAm
aXZyc19tYXBwaW5nc1tiZGZdLmludHJlbWFwX2ludXNlKTsKKyAgICAgICAgICAgICAgICBp
ZiAoICFpdnJzX21hcHBpbmdzW2JkZl0uaW50cmVtYXBfdGFibGUgKQorICAgICAgICAgICAg
ICAgICAgICByZXR1cm4gLUVOT01FTTsKKworICAgICAgICAgICAgICAgIGlmICggcGRldi0+
cGhhbnRvbV9zdHJpZGUgKQorICAgICAgICAgICAgICAgIHsKKyAgICAgICAgICAgICAgICAg
ICAgdW5zaWduZWQgaW50IHJlcV9pZCA9IGJkZjsKKworICAgICAgICAgICAgICAgICAgICBm
b3IgKCA7IDsgKQorICAgICAgICAgICAgICAgICAgICB7CisgICAgICAgICAgICAgICAgICAg
ICAgICByZXFfaWQgKz0gcGRldi0+cGhhbnRvbV9zdHJpZGU7CisgICAgICAgICAgICAgICAg
ICAgICAgICBpZiAoIFBDSV9TTE9UKHJlcV9pZCkgIT0gcGRldi0+c2JkZi5kZXYgKQorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOworCisgICAgICAgICAgICAgICAgICAg
ICAgICBpdnJzX21hcHBpbmdzW3JlcV9pZF0uaW50cmVtYXBfdGFibGUgPQorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGl2cnNfbWFwcGluZ3NbYmRmXS5pbnRyZW1hcF90YWJsZTsK
KyAgICAgICAgICAgICAgICAgICAgICAgIGl2cnNfbWFwcGluZ3NbcmVxX2lkXS5pbnRyZW1h
cF9pbnVzZSA9CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXZyc19tYXBwaW5nc1ti
ZGZdLmludHJlbWFwX2ludXNlOworICAgICAgICAgICAgICAgICAgICB9CisgICAgICAgICAg
ICAgICAgfQogICAgICAgICAgICAgfQogCiAgICAgICAgICAgICBhbWRfaW9tbXVfc2V0X2lu
dHJlbWFwX3RhYmxlKAotLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVf
aW50ci5jCisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9pb21tdV9pbnRyLmMK
QEAgLTcxMSwzMyArNzExLDIwIEBAIGludCBhbWRfaW9tbXVfbXNpX21zZ191cGRhdGVfaXJl
KAogCiAgICAgaWYgKCBtc2lfZGVzYy0+cmVtYXBfaW5kZXggPj0gMCAmJiAhbXNnICkKICAg
ICB7Ci0gICAgICAgIGRvIHsKLSAgICAgICAgICAgIHVwZGF0ZV9pbnRyZW1hcF9lbnRyeV9m
cm9tX21zaV9tc2coaW9tbXUsIGJkZiwgbnIsCi0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICZtc2lfZGVzYy0+cmVtYXBfaW5kZXgsCi0gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5VTEwsIE5VTEwpOwot
ICAgICAgICAgICAgaWYgKCAhcGRldiB8fCAhcGRldi0+cGhhbnRvbV9zdHJpZGUgKQotICAg
ICAgICAgICAgICAgIGJyZWFrOwotICAgICAgICAgICAgYmRmICs9IHBkZXYtPnBoYW50b21f
c3RyaWRlOwotICAgICAgICB9IHdoaWxlICggUENJX1NMT1QoYmRmKSA9PSBQQ0lfU0xPVChw
ZGV2LT5kZXZmbikgKTsKKyAgICAgICAgdXBkYXRlX2ludHJlbWFwX2VudHJ5X2Zyb21fbXNp
X21zZyhpb21tdSwgYmRmLCBuciwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAmbXNpX2Rlc2MtPnJlbWFwX2luZGV4LAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIE5VTEwsIE5VTEwpOwogCiAgICAgICAgIGZvciAo
IGkgPSAwOyBpIDwgbnI7ICsraSApCiAgICAgICAgICAgICBtc2lfZGVzY1tpXS5yZW1hcF9p
bmRleCA9IC0xOwotICAgICAgICBpZiAoIHBkZXYgKQotICAgICAgICAgICAgYmRmID0gUENJ
X0JERjIocGRldi0+YnVzLCBwZGV2LT5kZXZmbik7CiAgICAgfQogCiAgICAgaWYgKCAhbXNn
ICkKICAgICAgICAgcmV0dXJuIDA7CiAKLSAgICBkbyB7Ci0gICAgICAgIHJjID0gdXBkYXRl
X2ludHJlbWFwX2VudHJ5X2Zyb21fbXNpX21zZyhpb21tdSwgYmRmLCBuciwKLSAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZtc2lfZGVzYy0+cmVt
YXBfaW5kZXgsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBtc2csICZkYXRhKTsKLSAgICAgICAgaWYgKCByYyB8fCAhcGRldiB8fCAhcGRldi0+
cGhhbnRvbV9zdHJpZGUgKQotICAgICAgICAgICAgYnJlYWs7Ci0gICAgICAgIGJkZiArPSBw
ZGV2LT5waGFudG9tX3N0cmlkZTsKLSAgICB9IHdoaWxlICggUENJX1NMT1QoYmRmKSA9PSBQ
Q0lfU0xPVChwZGV2LT5kZXZmbikgKTsKLQorICAgIHJjID0gdXBkYXRlX2ludHJlbWFwX2Vu
dHJ5X2Zyb21fbXNpX21zZyhpb21tdSwgYmRmLCBuciwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgJm1zaV9kZXNjLT5yZW1hcF9pbmRleCwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNnLCAmZGF0YSk7CiAg
ICAgaWYgKCAhcmMgKQogICAgIHsKICAgICAgICAgZm9yICggaSA9IDE7IGkgPCBucjsgKytp
ICkKQEAgLTc5MCwxMiArNzc3LDI3IEBAIHZvaWQgYW1kX2lvbW11X3JlYWRfbXNpX2Zyb21f
aXJlKAogfQogCiBpbnQgYW1kX2lvbW11X2ZyZWVfaW50cmVtYXBfdGFibGUoCi0gICAgY29u
c3Qgc3RydWN0IGFtZF9pb21tdSAqaW9tbXUsIHN0cnVjdCBpdnJzX21hcHBpbmdzICppdnJz
X21hcHBpbmcpCisgICAgY29uc3Qgc3RydWN0IGFtZF9pb21tdSAqaW9tbXUsIHN0cnVjdCBp
dnJzX21hcHBpbmdzICppdnJzX21hcHBpbmcsCisgICAgdWludDE2X3QgYmRmKQogewogICAg
IHZvaWQgKip0YmxwOwogCiAgICAgaWYgKCBpdnJzX21hcHBpbmcgKQogICAgIHsKKyAgICAg
ICAgdW5zaWduZWQgaW50IGk7CisKKyAgICAgICAgLyoKKyAgICAgICAgICogUENJIGRldmlj
ZSBwaGFudG9tIGZ1bmN0aW9ucyB1c2UgdGhlIHNhbWUgdGFibGVzIGFzIHRoZWlyICJiYXNl
IgorICAgICAgICAgKiBmdW5jdGlvbjogTG9vayBhaGVhZCB0byB6YXAgdGhlIHBvaW50ZXJz
LgorICAgICAgICAgKi8KKyAgICAgICAgZm9yICggaSA9IDE7IFBDSV9GVU5DKGJkZiArIGkp
ICYmIGJkZiArIGkgPCBpdnJzX2JkZl9lbnRyaWVzOyArK2kgKQorICAgICAgICAgICAgaWYg
KCBpdnJzX21hcHBpbmdbaV0uaW50cmVtYXBfdGFibGUgPT0KKyAgICAgICAgICAgICAgICAg
aXZyc19tYXBwaW5nLT5pbnRyZW1hcF90YWJsZSApCisgICAgICAgICAgICB7CisgICAgICAg
ICAgICAgICAgaXZyc19tYXBwaW5nW2ldLmludHJlbWFwX3RhYmxlID0gTlVMTDsKKyAgICAg
ICAgICAgICAgICBpdnJzX21hcHBpbmdbaV0uaW50cmVtYXBfaW51c2UgPSBOVUxMOworICAg
ICAgICAgICAgfQorCiAgICAgICAgIFhGUkVFKGl2cnNfbWFwcGluZy0+aW50cmVtYXBfaW51
c2UpOwogICAgICAgICB0YmxwID0gJml2cnNfbWFwcGluZy0+aW50cmVtYXBfdGFibGU7CiAg
ICAgfQpAQCAtOTM0LDcgKzkzNiw4IEBAIHN0YXRpYyB2b2lkIGR1bXBfaW50cmVtYXBfdGFi
bGUoY29uc3Qgc3QKIH0KIAogc3RhdGljIGludCBkdW1wX2ludHJlbWFwX21hcHBpbmcoY29u
c3Qgc3RydWN0IGFtZF9pb21tdSAqaW9tbXUsCi0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBzdHJ1Y3QgaXZyc19tYXBwaW5ncyAqaXZyc19tYXBwaW5nKQorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGl2cnNfbWFwcGluZ3MgKml2cnNfbWFw
cGluZywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQxNl90IHVudXNl
ZCkKIHsKICAgICB1bnNpZ25lZCBsb25nIGZsYWdzOwogCi0tLSBhL3hlbi9kcml2ZXJzL3Bh
c3N0aHJvdWdoL2FtZC9wY2lfYW1kX2lvbW11LmMKKysrIGIveGVuL2RyaXZlcnMvcGFzc3Ro
cm91Z2gvYW1kL3BjaV9hbWRfaW9tbXUuYwpAQCAtNTE2LDcgKzUxNiw3IEBAIHN0YXRpYyBp
bnQgYW1kX2lvbW11X3JlbW92ZV9kZXZpY2UodTggZGUKICAgICBpZiAoIGFtZF9pb21tdV9w
ZXJkZXZfaW50cmVtYXAgJiYKICAgICAgICAgIGl2cnNfbWFwcGluZ3NbYmRmXS5kdGVfcmVx
dWVzdG9yX2lkID09IGJkZiAmJgogICAgICAgICAgaXZyc19tYXBwaW5nc1tiZGZdLmludHJl
bWFwX3RhYmxlICkKLSAgICAgICAgYW1kX2lvbW11X2ZyZWVfaW50cmVtYXBfdGFibGUoaW9t
bXUsICZpdnJzX21hcHBpbmdzW2JkZl0pOworICAgICAgICBhbWRfaW9tbXVfZnJlZV9pbnRy
ZW1hcF90YWJsZShpb21tdSwgJml2cnNfbWFwcGluZ3NbYmRmXSwgYmRmKTsKIAogICAgIHJl
dHVybiAwOwogfQotLS0gYS94ZW4vaW5jbHVkZS9hc20teDg2L2FtZC1pb21tdS5oCisrKyBi
L3hlbi9pbmNsdWRlL2FzbS14ODYvYW1kLWlvbW11LmgKQEAgLTEzMSw3ICsxMzEsNyBAQCBl
eHRlcm4gdTggaXZoZF90eXBlOwogc3RydWN0IGl2cnNfbWFwcGluZ3MgKmdldF9pdnJzX21h
cHBpbmdzKHUxNiBzZWcpOwogaW50IGl0ZXJhdGVfaXZyc19tYXBwaW5ncyhpbnQgKCopKHUx
NiBzZWcsIHN0cnVjdCBpdnJzX21hcHBpbmdzICopKTsKIGludCBpdGVyYXRlX2l2cnNfZW50
cmllcyhpbnQgKCopKGNvbnN0IHN0cnVjdCBhbWRfaW9tbXUgKiwKLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHN0cnVjdCBpdnJzX21hcHBpbmdzICopKTsKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBpdnJzX21hcHBpbmdzICosIHVpbnQx
Nl90KSk7CiAKIC8qIGlvbW11IHRhYmxlcyBpbiBndWVzdCBzcGFjZSAqLwogc3RydWN0IG1t
aW9fcmVnIHsKLS0tIGEveGVuL2luY2x1ZGUvYXNtLXg4Ni9odm0vc3ZtL2FtZC1pb21tdS1w
cm90by5oCisrKyBiL3hlbi9pbmNsdWRlL2FzbS14ODYvaHZtL3N2bS9hbWQtaW9tbXUtcHJv
dG8uaApAQCAtMTAxLDcgKzEwMSw3IEBAIGludCBhbWRfaW9tbXVfc2V0dXBfaW9hcGljX3Jl
bWFwcGluZyh2b2kKIHZvaWQgKmFtZF9pb21tdV9hbGxvY19pbnRyZW1hcF90YWJsZSgKICAg
ICBjb25zdCBzdHJ1Y3QgYW1kX2lvbW11ICosIHVuc2lnbmVkIGxvbmcgKiopOwogaW50IGFt
ZF9pb21tdV9mcmVlX2ludHJlbWFwX3RhYmxlKAotICAgIGNvbnN0IHN0cnVjdCBhbWRfaW9t
bXUgKiwgc3RydWN0IGl2cnNfbWFwcGluZ3MgKik7CisgICAgY29uc3Qgc3RydWN0IGFtZF9p
b21tdSAqLCBzdHJ1Y3QgaXZyc19tYXBwaW5ncyAqLCB1aW50MTZfdCk7CiB2b2lkIGFtZF9p
b21tdV9pb2FwaWNfdXBkYXRlX2lyZSgKICAgICB1bnNpZ25lZCBpbnQgYXBpYywgdW5zaWdu
ZWQgaW50IHJlZywgdW5zaWduZWQgaW50IHZhbHVlKTsKIHVuc2lnbmVkIGludCBhbWRfaW9t
bXVfcmVhZF9pb2FwaWNfZnJvbV9pcmUoCg==
--------------3B7AC5CFE503A3FAD31D6CF7
Content-Type: text/plain; charset=UTF-8;
 name="08-PCI-read-MSI-X-nr.patch"
Content-Transfer-Encoding: base64
Content-Disposition: attachment;
 filename="08-PCI-read-MSI-X-nr.patch"

eDg2L1BDSTogcmVhZCBNU0ktWCB0YWJsZSBlbnRyeSBjb3VudCBlYXJseQoKUmF0aGVyIHRo
YW4gZG9pbmcgdGhpcyBldmVyeSB0aW1lIHdlIHNldCB1cCBpbnRlcnJ1cHRzIGZvciBhIGRl
dmljZQphbmV3IChhbmQgdGhlbiBpbiB0d28gZGlzdGluY3QgcGxhY2VzKSBmaWxsIHRoaXMg
aW52YXJpYW50IGZpZWxkCnJpZ2h0IGFmdGVyIGFsbG9jYXRpbmcgc3RydWN0IGFyY2hfbXNp
eC4KCldoaWxlIGF0IGl0IGFsc28gb2J0YWluIHRoZSBNU0ktWCBjYXBhYmlsaXR5IHN0cnVj
dHVyZSBwb3NpdGlvbiBqdXN0Cm9uY2UsIGluIG1zaXhfY2FwYWJpbGl0eV9pbml0KCksIHJh
dGhlciB0aGFuIGluIGVhY2ggY2FsbGVyLgoKRnVydGhlcm1vcmUgdGFrZSB0aGUgb3Bwb3J0
dW5pdHkgYW5kIGVsaW1pbmF0ZSB0aGUgbXVsdGlfbXNpeF9jYXBhYmxlKCkKYWxpYXMgb2Yg
bXNpeF90YWJsZV9zaXplKCkuCgpTaWduZWQtb2ZmLWJ5OiBKYW4gQmV1bGljaCA8amJldWxp
Y2hAc3VzZS5jb20+Ci0tLQp2NTogTmV3LgoKLS0tIGEveGVuL2FyY2gveDg2L21zaS5jCisr
KyBiL3hlbi9hcmNoL3g4Ni9tc2kuYwpAQCAtODIxLDEwICs4MjEsOCBAQCBzdGF0aWMgdTY0
IHJlYWRfcGNpX21lbV9iYXIodTE2IHNlZywgdTgKICAqIHJlcXVlc3RlZCBNU0ktWCBlbnRy
aWVzIHdpdGggYWxsb2NhdGVkIGlycXMgb3Igbm9uLXplcm8gZm9yIG90aGVyd2lzZS4KICAq
Ki8KIHN0YXRpYyBpbnQgbXNpeF9jYXBhYmlsaXR5X2luaXQoc3RydWN0IHBjaV9kZXYgKmRl
diwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IHBvcywK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IG1zaV9pbmZvICptc2ks
Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBtc2lfZGVzYyAqKmRl
c2MsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCBucl9l
bnRyaWVzKQorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgbXNpX2Rl
c2MgKipkZXNjKQogewogICAgIHN0cnVjdCBhcmNoX21zaXggKm1zaXggPSBkZXYtPm1zaXg7
CiAgICAgc3RydWN0IG1zaV9kZXNjICplbnRyeSA9IE5VTEw7CkBAIC04MzgsNiArODM2LDEx
IEBAIHN0YXRpYyBpbnQgbXNpeF9jYXBhYmlsaXR5X2luaXQoc3RydWN0IHAKICAgICB1OCBz
bG90ID0gUENJX1NMT1QoZGV2LT5kZXZmbik7CiAgICAgdTggZnVuYyA9IFBDSV9GVU5DKGRl
di0+ZGV2Zm4pOwogICAgIGJvb2wgbWFza2FsbCA9IG1zaXgtPmhvc3RfbWFza2FsbDsKKyAg
ICB1bnNpZ25lZCBpbnQgcG9zID0gcGNpX2ZpbmRfY2FwX29mZnNldChzZWcsIGJ1cywgc2xv
dCwgZnVuYywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQ
Q0lfQ0FQX0lEX01TSVgpOworCisgICAgaWYgKCAhcG9zICkKKyAgICAgICAgcmV0dXJuIC1F
Tk9ERVY7CiAKICAgICBBU1NFUlQocGNpZGV2c19sb2NrZWQoKSk7CiAKQEAgLTkxMiwxMCAr
OTE1LDkgQEAgc3RhdGljIGludCBtc2l4X2NhcGFiaWxpdHlfaW5pdChzdHJ1Y3QgcAogICAg
ICAgICB1NjQgcGJhX3BhZGRyOwogICAgICAgICB1MzIgcGJhX29mZnNldDsKIAotICAgICAg
ICBtc2l4LT5ucl9lbnRyaWVzID0gbnJfZW50cmllczsKICAgICAgICAgbXNpeC0+dGFibGUu
Zmlyc3QgPSBQRk5fRE9XTih0YWJsZV9wYWRkcik7CiAgICAgICAgIG1zaXgtPnRhYmxlLmxh
c3QgPSBQRk5fRE9XTih0YWJsZV9wYWRkciArCi0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBucl9lbnRyaWVzICogUENJX01TSVhfRU5UUllfU0laRSAtIDEpOworICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNpeC0+bnJfZW50cmllcyAqIFBD
SV9NU0lYX0VOVFJZX1NJWkUgLSAxKTsKICAgICAgICAgV0FSTl9PTihyYW5nZXNldF9vdmVy
bGFwc19yYW5nZShtbWlvX3JvX3JhbmdlcywgbXNpeC0+dGFibGUuZmlyc3QsCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNpeC0+dGFibGUubGFzdCkpOwog
CkBAIC05MjcsNyArOTI5LDcgQEAgc3RhdGljIGludCBtc2l4X2NhcGFiaWxpdHlfaW5pdChz
dHJ1Y3QgcAogCiAgICAgICAgIG1zaXgtPnBiYS5maXJzdCA9IFBGTl9ET1dOKHBiYV9wYWRk
cik7CiAgICAgICAgIG1zaXgtPnBiYS5sYXN0ID0gUEZOX0RPV04ocGJhX3BhZGRyICsKLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCSVRTX1RPX0xPTkdTKG5yX2VudHJp
ZXMpIC0gMSk7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQklUU19UT19M
T05HUyhtc2l4LT5ucl9lbnRyaWVzKSAtIDEpOwogICAgICAgICBXQVJOX09OKHJhbmdlc2V0
X292ZXJsYXBzX3JhbmdlKG1taW9fcm9fcmFuZ2VzLCBtc2l4LT5wYmEuZmlyc3QsCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNpeC0+cGJhLmxhc3QpKTsK
ICAgICB9CkBAIC05OTksNyArMTAwMSw2IEBAIHN0YXRpYyBpbnQgbXNpeF9jYXBhYmlsaXR5
X2luaXQoc3RydWN0IHAKICAgICAgICAgICAgIC8qIFhYWCBIb3cgdG8gZGVhbCB3aXRoIGV4
aXN0aW5nIG1hcHBpbmdzPyAqLwogICAgICAgICB9CiAgICAgfQotICAgIFdBUk5fT04obXNp
eC0+bnJfZW50cmllcyAhPSBucl9lbnRyaWVzKTsKICAgICBXQVJOX09OKG1zaXgtPnRhYmxl
LmZpcnN0ICE9ICh0YWJsZV9wYWRkciA+PiBQQUdFX1NISUZUKSk7CiAgICAgKyttc2l4LT51
c2VkX2VudHJpZXM7CiAKQEAgLTEwOTMsMjIgKzEwOTQsMTcgQEAgc3RhdGljIHZvaWQgX19w
Y2lfZGlzYWJsZV9tc2koc3RydWN0IG1zaQogICoqLwogc3RhdGljIGludCBfX3BjaV9lbmFi
bGVfbXNpeChzdHJ1Y3QgbXNpX2luZm8gKm1zaSwgc3RydWN0IG1zaV9kZXNjICoqZGVzYykK
IHsKLSAgICBpbnQgcG9zLCBucl9lbnRyaWVzOwogICAgIHN0cnVjdCBwY2lfZGV2ICpwZGV2
OwotICAgIHUxNiBjb250cm9sOwogICAgIHU4IHNsb3QgPSBQQ0lfU0xPVChtc2ktPmRldmZu
KTsKICAgICB1OCBmdW5jID0gUENJX0ZVTkMobXNpLT5kZXZmbik7CiAgICAgc3RydWN0IG1z
aV9kZXNjICpvbGRfZGVzYzsKIAogICAgIEFTU0VSVChwY2lkZXZzX2xvY2tlZCgpKTsKICAg
ICBwZGV2ID0gcGNpX2dldF9wZGV2KG1zaS0+c2VnLCBtc2ktPmJ1cywgbXNpLT5kZXZmbik7
Ci0gICAgcG9zID0gcGNpX2ZpbmRfY2FwX29mZnNldChtc2ktPnNlZywgbXNpLT5idXMsIHNs
b3QsIGZ1bmMsIFBDSV9DQVBfSURfTVNJWCk7Ci0gICAgaWYgKCAhcGRldiB8fCAhcG9zICkK
KyAgICBpZiAoICFwZGV2IHx8ICFwZGV2LT5tc2l4ICkKICAgICAgICAgcmV0dXJuIC1FTk9E
RVY7CiAKLSAgICBjb250cm9sID0gcGNpX2NvbmZfcmVhZDE2KHBkZXYtPnNiZGYsIG1zaXhf
Y29udHJvbF9yZWcocG9zKSk7Ci0gICAgbnJfZW50cmllcyA9IG11bHRpX21zaXhfY2FwYWJs
ZShjb250cm9sKTsKLSAgICBpZiAoIG1zaS0+ZW50cnlfbnIgPj0gbnJfZW50cmllcyApCisg
ICAgaWYgKCBtc2ktPmVudHJ5X25yID49IHBkZXYtPm1zaXgtPm5yX2VudHJpZXMgKQogICAg
ICAgICByZXR1cm4gLUVJTlZBTDsKIAogICAgIG9sZF9kZXNjID0gZmluZF9tc2lfZW50cnko
cGRldiwgbXNpLT5pcnEsIFBDSV9DQVBfSURfTVNJWCk7CkBAIC0xMTI3LDcgKzExMjMsNyBA
QCBzdGF0aWMgaW50IF9fcGNpX2VuYWJsZV9tc2l4KHN0cnVjdCBtc2lfCiAgICAgICAgIF9f
cGNpX2Rpc2FibGVfbXNpKG9sZF9kZXNjKTsKICAgICB9CiAKLSAgICByZXR1cm4gbXNpeF9j
YXBhYmlsaXR5X2luaXQocGRldiwgcG9zLCBtc2ksIGRlc2MsIG5yX2VudHJpZXMpOworICAg
IHJldHVybiBtc2l4X2NhcGFiaWxpdHlfaW5pdChwZGV2LCBtc2ksIGRlc2MpOwogfQogCiBz
dGF0aWMgdm9pZCBfcGNpX2NsZWFudXBfbXNpeChzdHJ1Y3QgYXJjaF9tc2l4ICptc2l4KQpA
QCAtMTE4NywxNiArMTE4MywxMCBAQCBpbnQgcGNpX3ByZXBhcmVfbXNpeCh1MTYgc2VnLCB1
OCBidXMsIHU4CiB7CiAgICAgaW50IHJjOwogICAgIHN0cnVjdCBwY2lfZGV2ICpwZGV2Owot
ICAgIHU4IHNsb3QgPSBQQ0lfU0xPVChkZXZmbiksIGZ1bmMgPSBQQ0lfRlVOQyhkZXZmbik7
Ci0gICAgdW5zaWduZWQgaW50IHBvcyA9IHBjaV9maW5kX2NhcF9vZmZzZXQoc2VnLCBidXMs
IHNsb3QsIGZ1bmMsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgUENJX0NBUF9JRF9NU0lYKTsKIAogICAgIGlmICggIXVzZV9tc2kgKQogICAgICAgICBy
ZXR1cm4gMDsKIAotICAgIGlmICggIXBvcyApCi0gICAgICAgIHJldHVybiAtRU5PREVWOwot
CiAgICAgcGNpZGV2c19sb2NrKCk7CiAgICAgcGRldiA9IHBjaV9nZXRfcGRldihzZWcsIGJ1
cywgZGV2Zm4pOwogICAgIGlmICggIXBkZXYgKQpAQCAtMTIwOSwxMyArMTE5OSw3IEBAIGlu
dCBwY2lfcHJlcGFyZV9tc2l4KHUxNiBzZWcsIHU4IGJ1cywgdTgKICAgICAgICAgcmMgPSAw
OwogICAgIH0KICAgICBlbHNlCi0gICAgewotICAgICAgICB1aW50MTZfdCBjb250cm9sID0g
cGNpX2NvbmZfcmVhZDE2KFBDSV9TQkRGMyhzZWcsIGJ1cywgZGV2Zm4pLAotICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1zaXhfY29udHJvbF9yZWcocG9z
KSk7Ci0KLSAgICAgICAgcmMgPSBtc2l4X2NhcGFiaWxpdHlfaW5pdChwZGV2LCBwb3MsIE5V
TEwsIE5VTEwsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXVsdGlfbXNp
eF9jYXBhYmxlKGNvbnRyb2wpKTsKLSAgICB9CisgICAgICAgIHJjID0gbXNpeF9jYXBhYmls
aXR5X2luaXQocGRldiwgTlVMTCwgTlVMTCk7CiAgICAgcGNpZGV2c191bmxvY2soKTsKIAog
ICAgIHJldHVybiByYzsKLS0tIGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvcGNpLmMKKysr
IGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvcGNpLmMKQEAgLTMyNCw2ICszMjQsNyBAQCBz
dGF0aWMgdm9pZCBhcHBseV9xdWlya3Moc3RydWN0IHBjaV9kZXYKIHN0YXRpYyBzdHJ1Y3Qg
cGNpX2RldiAqYWxsb2NfcGRldihzdHJ1Y3QgcGNpX3NlZyAqcHNlZywgdTggYnVzLCB1OCBk
ZXZmbikKIHsKICAgICBzdHJ1Y3QgcGNpX2RldiAqcGRldjsKKyAgICB1bnNpZ25lZCBpbnQg
cG9zOwogCiAgICAgbGlzdF9mb3JfZWFjaF9lbnRyeSAoIHBkZXYsICZwc2VnLT5hbGxkZXZz
X2xpc3QsIGFsbGRldnNfbGlzdCApCiAgICAgICAgIGlmICggcGRldi0+YnVzID09IGJ1cyAm
JiBwZGV2LT5kZXZmbiA9PSBkZXZmbiApCkBAIC0zMzksMTAgKzM0MCwxMiBAQCBzdGF0aWMg
c3RydWN0IHBjaV9kZXYgKmFsbG9jX3BkZXYoc3RydWN0CiAgICAgcGRldi0+ZG9tYWluID0g
TlVMTDsKICAgICBJTklUX0xJU1RfSEVBRCgmcGRldi0+bXNpX2xpc3QpOwogCi0gICAgaWYg
KCBwY2lfZmluZF9jYXBfb2Zmc2V0KHBzZWctPm5yLCBidXMsIFBDSV9TTE9UKGRldmZuKSwg
UENJX0ZVTkMoZGV2Zm4pLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lfQ0FQ
X0lEX01TSVgpICkKKyAgICBwb3MgPSBwY2lfZmluZF9jYXBfb2Zmc2V0KHBzZWctPm5yLCBi
dXMsIFBDSV9TTE9UKGRldmZuKSwgUENJX0ZVTkMoZGV2Zm4pLAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgUENJX0NBUF9JRF9NU0lYKTsKKyAgICBpZiAoIHBvcyApCiAgICAg
ewogICAgICAgICBzdHJ1Y3QgYXJjaF9tc2l4ICptc2l4ID0geHphbGxvYyhzdHJ1Y3QgYXJj
aF9tc2l4KTsKKyAgICAgICAgdWludDE2X3QgY3RybDsKIAogICAgICAgICBpZiAoICFtc2l4
ICkKICAgICAgICAgewpAQCAtMzUwLDYgKzM1MywxMCBAQCBzdGF0aWMgc3RydWN0IHBjaV9k
ZXYgKmFsbG9jX3BkZXYoc3RydWN0CiAgICAgICAgICAgICByZXR1cm4gTlVMTDsKICAgICAg
ICAgfQogICAgICAgICBzcGluX2xvY2tfaW5pdCgmbXNpeC0+dGFibGVfbG9jayk7CisKKyAg
ICAgICAgY3RybCA9IHBjaV9jb25mX3JlYWQxNihwZGV2LT5zYmRmLCBtc2l4X2NvbnRyb2xf
cmVnKHBvcykpOworICAgICAgICBtc2l4LT5ucl9lbnRyaWVzID0gbXNpeF90YWJsZV9zaXpl
KGN0cmwpOworCiAgICAgICAgIHBkZXYtPm1zaXggPSBtc2l4OwogICAgIH0KIApAQCAtMzU4
LDcgKzM2NSw2IEBAIHN0YXRpYyBzdHJ1Y3QgcGNpX2RldiAqYWxsb2NfcGRldihzdHJ1Y3QK
ICAgICAvKiB1cGRhdGUgYnVzMmJyaWRnZSAqLwogICAgIHN3aXRjaCAoIHBkZXYtPnR5cGUg
PSBwZGV2X3R5cGUocHNlZy0+bnIsIGJ1cywgZGV2Zm4pICkKICAgICB7Ci0gICAgICAgIGlu
dCBwb3M7CiAgICAgICAgIHUxNiBjYXA7CiAgICAgICAgIHU4IHNlY19idXMsIHN1Yl9idXM7
CiAKLS0tIGEveGVuL2luY2x1ZGUvYXNtLXg4Ni9tc2kuaAorKysgYi94ZW4vaW5jbHVkZS9h
c20teDg2L21zaS5oCkBAIC0xNzEsNyArMTcxLDYgQEAgaW50IG1zaV9mcmVlX2lycShzdHJ1
Y3QgbXNpX2Rlc2MgKmVudHJ5KQogI2RlZmluZSBtc2l4X2VuYWJsZShjb250cm9sKQkgCWNv
bnRyb2wgfD0gUENJX01TSVhfRkxBR1NfRU5BQkxFCiAjZGVmaW5lIG1zaXhfZGlzYWJsZShj
b250cm9sKQkgCWNvbnRyb2wgJj0gflBDSV9NU0lYX0ZMQUdTX0VOQUJMRQogI2RlZmluZSBt
c2l4X3RhYmxlX3NpemUoY29udHJvbCkgCSgoY29udHJvbCAmIFBDSV9NU0lYX0ZMQUdTX1FT
SVpFKSsxKQotI2RlZmluZSBtdWx0aV9tc2l4X2NhcGFibGUJCW1zaXhfdGFibGVfc2l6ZQog
I2RlZmluZSBtc2l4X3VubWFzayhhZGRyZXNzKQkgCShhZGRyZXNzICYgflBDSV9NU0lYX1ZF
Q1RPUl9CSVRNQVNLKQogI2RlZmluZSBtc2l4X21hc2soYWRkcmVzcykJCShhZGRyZXNzIHwg
UENJX01TSVhfVkVDVE9SX0JJVE1BU0spCiAK
--------------3B7AC5CFE503A3FAD31D6CF7
Content-Type: text/plain; charset=UTF-8;
 name="09-AMD-IOMMU-replace-INTREMAP_ENTRIES.patch"
Content-Transfer-Encoding: base64
Content-Disposition: attachment;
 filename="09-AMD-IOMMU-replace-INTREMAP_ENTRIES.patch"

QU1EL0lPTU1VOiByZXBsYWNlIElOVFJFTUFQX0VOVFJJRVMKClByZXBhcmUgZm9yIHRoZSBu
dW1iZXIgb2YgZW50cmllcyB0byBub3QgYmUgdGhlIG1heGltdW0gcG9zc2libGUsIGJ5CnNl
cGFyYXRpbmcgY2hlY2tzIGFnYWluc3QgbWF4aW11bSBzaXplIGZyb20gb25lcyBhZ2FpbnN0
IGFjdHVhbCBzaXplLgpGb3IgY2FsbGVyIHNpZGUgc2ltcGxpY2l0eSBoYXZlIGFsbG9jX2lu
dHJlbWFwX2VudHJ5KCkgcmV0dXJuIHRoZQptYXhpbXVtIHBvc3NpYmxlIHZhbHVlIHVwb24g
YWxsb2NhdGlvbiBmYWlsdXJlLCByYXRoZXIgdGhhbiB0aGUgZmlyc3QKanVzdCBvdXQtb2Yt
Ym91bmRzIG9uZS4KCkhhdmUgdGhlIGludm9sdmVkIGZ1bmN0aW9ucyBhbHJlYWR5IHRha2Ug
YWxsIHRoZSBzdWJzZXF1ZW50bHkgbmVlZGVkCmFyZ3VtZW50cyBoZXJlIGFscmVhZHksIHRv
IHJlZHVjZSBjb2RlIGNodXJuIGluIHRoZSBwYXRjaCBhY3R1YWxseQptYWtpbmcgdGhlIGFs
bG9jYXRpb24gc2l6ZSBkeW5hbWljLgoKU2lnbmVkLW9mZi1ieTogSmFuIEJldWxpY2ggPGpi
ZXVsaWNoQHN1c2UuY29tPgotLS0KdjU6IE5ldy4KCi0tLSBhL3hlbi9kcml2ZXJzL3Bhc3N0
aHJvdWdoL2FtZC9pb21tdV9pbnRyLmMKKysrIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gv
YW1kL2lvbW11X2ludHIuYwpAQCAtNjksNyArNjksNyBAQCB1bmlvbiBpcnRlX2NwdHIgewog
ICAgIGNvbnN0IHVuaW9uIGlydGUxMjggKnB0cjEyODsKIH0gX190cmFuc3BhcmVudF9fOwog
Ci0jZGVmaW5lIElOVFJFTUFQX0VOVFJJRVMgKDEgPDwgSU9NTVVfSU5UUkVNQVBfT1JERVIp
CisjZGVmaW5lIElOVFJFTUFQX01BWF9FTlRSSUVTICgxIDw8IElPTU1VX0lOVFJFTUFQX09S
REVSKQogCiBzdHJ1Y3QgaW9hcGljX3NiZGYgaW9hcGljX3NiZGZbTUFYX0lPX0FQSUNTXTsK
IHN0cnVjdCBocGV0X3NiZGYgaHBldF9zYmRmOwpAQCAtODMsOCArODMsMjAgQEAgc3RhdGlj
IHZvaWQgZHVtcF9pbnRyZW1hcF90YWJsZXModW5zaWduZQogc3RhdGljIHVuc2lnbmVkIGlu
dCBfX2luaXQgaW50cmVtYXBfdGFibGVfb3JkZXIoY29uc3Qgc3RydWN0IGFtZF9pb21tdSAq
aW9tbXUpCiB7CiAgICAgcmV0dXJuIGlvbW11LT5jdHJsLmdhX2VuCi0gICAgICAgICAgID8g
Z2V0X29yZGVyX2Zyb21fYnl0ZXMoSU5UUkVNQVBfRU5UUklFUyAqIHNpemVvZih1bmlvbiBp
cnRlMTI4KSkKLSAgICAgICAgICAgOiBnZXRfb3JkZXJfZnJvbV9ieXRlcyhJTlRSRU1BUF9F
TlRSSUVTICogc2l6ZW9mKHVuaW9uIGlydGUzMikpOworICAgICAgICAgICA/IGdldF9vcmRl
cl9mcm9tX2J5dGVzKElOVFJFTUFQX01BWF9FTlRSSUVTICogc2l6ZW9mKHVuaW9uIGlydGUx
MjgpKQorICAgICAgICAgICA6IGdldF9vcmRlcl9mcm9tX2J5dGVzKElOVFJFTUFQX01BWF9F
TlRSSUVTICogc2l6ZW9mKHVuaW9uIGlydGUzMikpOworfQorCit1bnNpZ25lZCBpbnQgYW1k
X2lvbW11X2ludHJlbWFwX3RhYmxlX29yZGVyKAorICAgIGNvbnN0IHZvaWQgKmlydCwgY29u
c3Qgc3RydWN0IGFtZF9pb21tdSAqaW9tbXUpCit7CisgICAgcmV0dXJuIElPTU1VX0lOVFJF
TUFQX09SREVSOworfQorCitzdGF0aWMgdW5zaWduZWQgaW50IGludHJlbWFwX3RhYmxlX2Vu
dHJpZXMoCisgICAgY29uc3Qgdm9pZCAqaXJ0LCBjb25zdCBzdHJ1Y3QgYW1kX2lvbW11ICpp
b21tdSkKK3sKKyAgICByZXR1cm4gMXUgPDwgYW1kX2lvbW11X2ludHJlbWFwX3RhYmxlX29y
ZGVyKGlydCwgaW9tbXUpOwogfQogCiB1bnNpZ25lZCBpbnQgaW9hcGljX2lkX3RvX2luZGV4
KHVuc2lnbmVkIGludCBhcGljX2lkKQpAQCAtMTIyLDIwICsxMzQsMjQgQEAgc3RhdGljIGlu
dCBnZXRfaW50cmVtYXBfcmVxdWVzdG9yX2lkKGludAogICAgIHJldHVybiBnZXRfaXZyc19t
YXBwaW5ncyhzZWcpW2JkZl0uZHRlX3JlcXVlc3Rvcl9pZDsKIH0KIAotc3RhdGljIHVuc2ln
bmVkIGludCBhbGxvY19pbnRyZW1hcF9lbnRyeShpbnQgc2VnLCBpbnQgYmRmLCB1bnNpZ25l
ZCBpbnQgbnIpCitzdGF0aWMgdW5zaWduZWQgaW50IGFsbG9jX2ludHJlbWFwX2VudHJ5KGNv
bnN0IHN0cnVjdCBhbWRfaW9tbXUgKmlvbW11LAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgYmRmLCB1bnNpZ25lZCBpbnQgbnIpCiB7
Ci0gICAgdW5zaWduZWQgbG9uZyAqaW51c2UgPSBnZXRfaXZyc19tYXBwaW5ncyhzZWcpW2Jk
Zl0uaW50cmVtYXBfaW51c2U7Ci0gICAgdW5zaWduZWQgaW50IHNsb3QgPSBmaW5kX2ZpcnN0
X3plcm9fYml0KGludXNlLCBJTlRSRU1BUF9FTlRSSUVTKTsKKyAgICBjb25zdCBzdHJ1Y3Qg
aXZyc19tYXBwaW5ncyAqaXZyc19tYXBwaW5ncyA9IGdldF9pdnJzX21hcHBpbmdzKGlvbW11
LT5zZWcpOworICAgIHVuc2lnbmVkIGxvbmcgKmludXNlID0gaXZyc19tYXBwaW5nc1tiZGZd
LmludHJlbWFwX2ludXNlOworICAgIHVuc2lnbmVkIGludCBucl9lbnRzID0KKyAgICAgICAg
aW50cmVtYXBfdGFibGVfZW50cmllcyhpdnJzX21hcHBpbmdzW2JkZl0uaW50cmVtYXBfdGFi
bGUsIGlvbW11KTsKKyAgICB1bnNpZ25lZCBpbnQgc2xvdCA9IGZpbmRfZmlyc3RfemVyb19i
aXQoaW51c2UsIG5yX2VudHMpOwogCiAgICAgZm9yICggOyA7ICkKICAgICB7CiAgICAgICAg
IHVuc2lnbmVkIGludCBlbmQ7CiAKLSAgICAgICAgaWYgKCBzbG90ID49IElOVFJFTUFQX0VO
VFJJRVMgKQorICAgICAgICBpZiAoIHNsb3QgPj0gbnJfZW50cyApCiAgICAgICAgICAgICBi
cmVhazsKLSAgICAgICAgZW5kID0gZmluZF9uZXh0X2JpdChpbnVzZSwgSU5UUkVNQVBfRU5U
UklFUywgc2xvdCArIDEpOwotICAgICAgICBpZiAoIGVuZCA+IElOVFJFTUFQX0VOVFJJRVMg
KQotICAgICAgICAgICAgZW5kID0gSU5UUkVNQVBfRU5UUklFUzsKKyAgICAgICAgZW5kID0g
ZmluZF9uZXh0X2JpdChpbnVzZSwgbnJfZW50cywgc2xvdCArIDEpOworICAgICAgICBpZiAo
IGVuZCA+IG5yX2VudHMgKQorICAgICAgICAgICAgZW5kID0gbnJfZW50czsKICAgICAgICAg
c2xvdCA9IChzbG90ICsgbnIgLSAxKSAmIH4obnIgLSAxKTsKICAgICAgICAgaWYgKCBzbG90
ICsgbnIgPD0gZW5kICkKICAgICAgICAgewpAQCAtMTQ0LDEyICsxNjAsMTIgQEAgc3RhdGlj
IHVuc2lnbmVkIGludCBhbGxvY19pbnRyZW1hcF9lbnRyeQogICAgICAgICAgICAgYnJlYWs7
CiAgICAgICAgIH0KICAgICAgICAgc2xvdCA9IChlbmQgKyBucikgJiB+KG5yIC0gMSk7Ci0g
ICAgICAgIGlmICggc2xvdCA+PSBJTlRSRU1BUF9FTlRSSUVTICkKKyAgICAgICAgaWYgKCBz
bG90ID49IG5yX2VudHMgKQogICAgICAgICAgICAgYnJlYWs7Ci0gICAgICAgIHNsb3QgPSBm
aW5kX25leHRfemVyb19iaXQoaW51c2UsIElOVFJFTUFQX0VOVFJJRVMsIHNsb3QpOworICAg
ICAgICBzbG90ID0gZmluZF9uZXh0X3plcm9fYml0KGludXNlLCBucl9lbnRzLCBzbG90KTsK
ICAgICB9CiAKLSAgICByZXR1cm4gc2xvdDsKKyAgICByZXR1cm4gc2xvdCA8IG5yX2VudHMg
PyBzbG90IDogSU5UUkVNQVBfTUFYX0VOVFJJRVM7CiB9CiAKIHN0YXRpYyB1bmlvbiBpcnRl
X3B0ciBnZXRfaW50cmVtYXBfZW50cnkoY29uc3Qgc3RydWN0IGFtZF9pb21tdSAqaW9tbXUs
CkBAIC0xNTksNyArMTc1LDcgQEAgc3RhdGljIHVuaW9uIGlydGVfcHRyIGdldF9pbnRyZW1h
cF9lbnRyeQogICAgICAgICAucHRyID0gZ2V0X2l2cnNfbWFwcGluZ3MoaW9tbXUtPnNlZylb
YmRmXS5pbnRyZW1hcF90YWJsZQogICAgIH07CiAKLSAgICBBU1NFUlQodGFibGUucHRyICYm
IChpbmRleCA8IElOVFJFTUFQX0VOVFJJRVMpKTsKKyAgICBBU1NFUlQodGFibGUucHRyICYm
IChpbmRleCA8IGludHJlbWFwX3RhYmxlX2VudHJpZXModGFibGUucHRyLCBpb21tdSkpKTsK
IAogICAgIGlmICggaW9tbXUtPmN0cmwuZ2FfZW4gKQogICAgICAgICB0YWJsZS5wdHIxMjgg
Kz0gaW5kZXg7CkBAIC0yNzksMTAgKzI5NSwxMCBAQCBzdGF0aWMgaW50IHVwZGF0ZV9pbnRy
ZW1hcF9lbnRyeV9mcm9tX2lvCiAgICAgc3Bpbl9sb2NrX2lycXNhdmUobG9jaywgZmxhZ3Mp
OwogCiAgICAgb2Zmc2V0ID0gKmluZGV4OwotICAgIGlmICggb2Zmc2V0ID49IElOVFJFTUFQ
X0VOVFJJRVMgKQorICAgIGlmICggb2Zmc2V0ID49IElOVFJFTUFQX01BWF9FTlRSSUVTICkK
ICAgICB7Ci0gICAgICAgIG9mZnNldCA9IGFsbG9jX2ludHJlbWFwX2VudHJ5KGlvbW11LT5z
ZWcsIHJlcV9pZCwgMSk7Ci0gICAgICAgIGlmICggb2Zmc2V0ID49IElOVFJFTUFQX0VOVFJJ
RVMgKQorICAgICAgICBvZmZzZXQgPSBhbGxvY19pbnRyZW1hcF9lbnRyeShpb21tdSwgcmVx
X2lkLCAxKTsKKyAgICAgICAgaWYgKCBvZmZzZXQgPj0gSU5UUkVNQVBfTUFYX0VOVFJJRVMg
KQogICAgICAgICB7CiAgICAgICAgICAgICBzcGluX3VubG9ja19pcnFyZXN0b3JlKGxvY2ss
IGZsYWdzKTsKICAgICAgICAgICAgIHJ0ZS0+bWFzayA9IDE7CkBAIC00MDAsOCArNDE2LDgg
QEAgaW50IF9faW5pdCBhbWRfaW9tbXVfc2V0dXBfaW9hcGljX3JlbWFwcAogICAgICAgICAg
ICAgfQogCiAgICAgICAgICAgICBzcGluX2xvY2tfaXJxc2F2ZShsb2NrLCBmbGFncyk7Ci0g
ICAgICAgICAgICBvZmZzZXQgPSBhbGxvY19pbnRyZW1hcF9lbnRyeShzZWcsIHJlcV9pZCwg
MSk7Ci0gICAgICAgICAgICBCVUdfT04ob2Zmc2V0ID49IElOVFJFTUFQX0VOVFJJRVMpOwor
ICAgICAgICAgICAgb2Zmc2V0ID0gYWxsb2NfaW50cmVtYXBfZW50cnkoaW9tbXUsIHJlcV9p
ZCwgMSk7CisgICAgICAgICAgICBCVUdfT04ob2Zmc2V0ID49IElOVFJFTUFQX01BWF9FTlRS
SUVTKTsKICAgICAgICAgICAgIGVudHJ5ID0gZ2V0X2ludHJlbWFwX2VudHJ5KGlvbW11LCBy
ZXFfaWQsIG9mZnNldCk7CiAgICAgICAgICAgICB1cGRhdGVfaW50cmVtYXBfZW50cnkoaW9t
bXUsIGVudHJ5LCB2ZWN0b3IsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ZGVsaXZlcnlfbW9kZSwgZGVzdF9tb2RlLCBkZXN0KTsKQEAgLTQ3Niw3ICs0OTIsNyBAQCB2
b2lkIGFtZF9pb21tdV9pb2FwaWNfdXBkYXRlX2lyZSgKICAgICAgICAgKigoKHUzMiAqKSZu
ZXdfcnRlKSArIDEpID0gdmFsdWU7CiAgICAgfQogCi0gICAgaWYgKCBpb2FwaWNfc2JkZltp
ZHhdLnBpbl8yX2lkeFtwaW5dID49IElOVFJFTUFQX0VOVFJJRVMgKQorICAgIGlmICggaW9h
cGljX3NiZGZbaWR4XS5waW5fMl9pZHhbcGluXSA+PSBJTlRSRU1BUF9NQVhfRU5UUklFUyAp
CiAgICAgewogICAgICAgICBBU1NFUlQoc2F2ZWRfbWFzayk7CiAKQEAgLTU0OCw3ICs1NjQs
NyBAQCB1bnNpZ25lZCBpbnQgYW1kX2lvbW11X3JlYWRfaW9hcGljX2Zyb21fCiAgICAgICAg
IHJldHVybiB2YWw7CiAKICAgICBvZmZzZXQgPSBpb2FwaWNfc2JkZltpZHhdLnBpbl8yX2lk
eFtwaW5dOwotICAgIGlmICggb2Zmc2V0ID49IElOVFJFTUFQX0VOVFJJRVMgKQorICAgIGlm
ICggb2Zmc2V0ID49IElOVFJFTUFQX01BWF9FTlRSSUVTICkKICAgICAgICAgcmV0dXJuIHZh
bDsKIAogICAgIHNlZyA9IGlvYXBpY19zYmRmW2lkeF0uc2VnOwpAQCAtNTYxLDggKzU3Nyw4
IEBAIHVuc2lnbmVkIGludCBhbWRfaW9tbXVfcmVhZF9pb2FwaWNfZnJvbV8KIAogICAgIGlm
ICggIShyZWcgJiAxKSApCiAgICAgewotICAgICAgICBBU1NFUlQob2Zmc2V0ID09ICh2YWwg
JiAoSU5UUkVNQVBfRU5UUklFUyAtIDEpKSk7Ci0gICAgICAgIHZhbCAmPSB+KElOVFJFTUFQ
X0VOVFJJRVMgLSAxKTsKKyAgICAgICAgQVNTRVJUKG9mZnNldCA9PSAodmFsICYgKElOVFJF
TUFQX01BWF9FTlRSSUVTIC0gMSkpKTsKKyAgICAgICAgdmFsICY9IH4oSU5UUkVNQVBfTUFY
X0VOVFJJRVMgLSAxKTsKICAgICAgICAgLyogVGhlIEludFR5cGUgZmllbGRzIG1hdGNoIGZv
ciBib3RoIGZvcm1hdHMuICovCiAgICAgICAgIHZhbCB8PSBNQVNLX0lOU1IoZW50cnkucHRy
MzItPmZsZHMuaW50X3R5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgSU9fQVBJQ19S
RURJUl9ERUxJVl9NT0RFX01BU0spOwpAQCAtNjIyLDExICs2MzgsMTEgQEAgc3RhdGljIGlu
dCB1cGRhdGVfaW50cmVtYXBfZW50cnlfZnJvbV9tcwogICAgICAgICBkZXN0ID0gTUFTS19F
WFRSKG1zZy0+YWRkcmVzc19sbywgTVNJX0FERFJfREVTVF9JRF9NQVNLKTsKIAogICAgIG9m
ZnNldCA9ICpyZW1hcF9pbmRleDsKLSAgICBpZiAoIG9mZnNldCA+PSBJTlRSRU1BUF9FTlRS
SUVTICkKKyAgICBpZiAoIG9mZnNldCA+PSBJTlRSRU1BUF9NQVhfRU5UUklFUyApCiAgICAg
ewogICAgICAgICBBU1NFUlQobnIpOwotICAgICAgICBvZmZzZXQgPSBhbGxvY19pbnRyZW1h
cF9lbnRyeShpb21tdS0+c2VnLCBiZGYsIG5yKTsKLSAgICAgICAgaWYgKCBvZmZzZXQgPj0g
SU5UUkVNQVBfRU5UUklFUyApCisgICAgICAgIG9mZnNldCA9IGFsbG9jX2ludHJlbWFwX2Vu
dHJ5KGlvbW11LCBiZGYsIG5yKTsKKyAgICAgICAgaWYgKCBvZmZzZXQgPj0gSU5UUkVNQVBf
TUFYX0VOVFJJRVMgKQogICAgICAgICB7CiAgICAgICAgICAgICBzcGluX3VubG9ja19pcnFy
ZXN0b3JlKGxvY2ssIGZsYWdzKTsKICAgICAgICAgICAgIHJldHVybiAtRU5PU1BDOwpAQCAt
NjU0LDcgKzY3MCw3IEBAIHN0YXRpYyBpbnQgdXBkYXRlX2ludHJlbWFwX2VudHJ5X2Zyb21f
bXMKICAgICB1cGRhdGVfaW50cmVtYXBfZW50cnkoaW9tbXUsIGVudHJ5LCB2ZWN0b3IsIGRl
bGl2ZXJ5X21vZGUsIGRlc3RfbW9kZSwgZGVzdCk7CiAgICAgc3Bpbl91bmxvY2tfaXJxcmVz
dG9yZShsb2NrLCBmbGFncyk7CiAKLSAgICAqZGF0YSA9IChtc2ctPmRhdGEgJiB+KElOVFJF
TUFQX0VOVFJJRVMgLSAxKSkgfCBvZmZzZXQ7CisgICAgKmRhdGEgPSAobXNnLT5kYXRhICYg
fihJTlRSRU1BUF9NQVhfRU5UUklFUyAtIDEpKSB8IG9mZnNldDsKIAogICAgIC8qCiAgICAg
ICogSW4gc29tZSBzcGVjaWFsIGNhc2VzLCBhIHBjaS1lIGRldmljZShlLmcgU0FUQSBjb250
cm9sbGVyIGluIElERSBtb2RlKQpAQCAtNzM4LDcgKzc1NCw3IEBAIGludCBhbWRfaW9tbXVf
bXNpX21zZ191cGRhdGVfaXJlKAogdm9pZCBhbWRfaW9tbXVfcmVhZF9tc2lfZnJvbV9pcmUo
CiAgICAgc3RydWN0IG1zaV9kZXNjICptc2lfZGVzYywgc3RydWN0IG1zaV9tc2cgKm1zZykK
IHsKLSAgICB1bnNpZ25lZCBpbnQgb2Zmc2V0ID0gbXNnLT5kYXRhICYgKElOVFJFTUFQX0VO
VFJJRVMgLSAxKTsKKyAgICB1bnNpZ25lZCBpbnQgb2Zmc2V0ID0gbXNnLT5kYXRhICYgKElO
VFJFTUFQX01BWF9FTlRSSUVTIC0gMSk7CiAgICAgY29uc3Qgc3RydWN0IHBjaV9kZXYgKnBk
ZXYgPSBtc2lfZGVzYy0+ZGV2OwogICAgIHUxNiBiZGYgPSBwZGV2ID8gUENJX0JERjIocGRl
di0+YnVzLCBwZGV2LT5kZXZmbikgOiBocGV0X3NiZGYuYmRmOwogICAgIHUxNiBzZWcgPSBw
ZGV2ID8gcGRldi0+c2VnIDogaHBldF9zYmRmLnNlZzsKQEAgLTc1OCw3ICs3NzQsNyBAQCB2
b2lkIGFtZF9pb21tdV9yZWFkX21zaV9mcm9tX2lyZSgKICAgICAgICAgb2Zmc2V0IHw9IG5y
OwogICAgIH0KIAotICAgIG1zZy0+ZGF0YSAmPSB+KElOVFJFTUFQX0VOVFJJRVMgLSAxKTsK
KyAgICBtc2ctPmRhdGEgJj0gfihJTlRSRU1BUF9NQVhfRU5UUklFUyAtIDEpOwogICAgIC8q
IFRoZSBJbnRUeXBlIGZpZWxkcyBtYXRjaCBmb3IgYm90aCBmb3JtYXRzLiAqLwogICAgIG1z
Zy0+ZGF0YSB8PSBNQVNLX0lOU1IoZW50cnkucHRyMzItPmZsZHMuaW50X3R5cGUsCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBNU0lfREFUQV9ERUxJVkVSWV9NT0RFX01BU0spOwpA
QCAtODI0LDggKzg0MCw5IEBAIHZvaWQgKmFtZF9pb21tdV9hbGxvY19pbnRyZW1hcF90YWJs
ZSgKIAogICAgIGlmICggdGIgKQogICAgIHsKLSAgICAgICAgKmludXNlX21hcCA9IHh6YWxs
b2NfYXJyYXkodW5zaWduZWQgbG9uZywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgQklUU19UT19MT05HUyhJTlRSRU1BUF9FTlRSSUVTKSk7CisgICAgICAgIHVuc2ln
bmVkIGludCBuciA9IGludHJlbWFwX3RhYmxlX2VudHJpZXModGIsIGlvbW11KTsKKworICAg
ICAgICAqaW51c2VfbWFwID0geHphbGxvY19hcnJheSh1bnNpZ25lZCBsb25nLCBCSVRTX1RP
X0xPTkdTKG5yKSk7CiAgICAgICAgIGlmICggKmludXNlX21hcCApCiAgICAgICAgICAgICBt
ZW1zZXQodGIsIDAsIFBBR0VfU0laRSA8PCBvcmRlcik7CiAgICAgICAgIGVsc2UKQEAgLTg2
OSw2ICs4ODYsNyBAQCBib29sIF9faW5pdCBpb3Zfc3VwcG9ydHNfeHQodm9pZCkKIAogaW50
IF9faW5pdCBhbWRfc2V0dXBfaHBldF9tc2koc3RydWN0IG1zaV9kZXNjICptc2lfZGVzYykK
IHsKKyAgICBjb25zdCBzdHJ1Y3QgYW1kX2lvbW11ICppb21tdTsKICAgICBzcGlubG9ja190
ICpsb2NrOwogICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAgICAgaW50IHJjID0gMDsKQEAg
LTg4NiwxMiArOTA0LDE1IEBAIGludCBfX2luaXQgYW1kX3NldHVwX2hwZXRfbXNpKHN0cnVj
dCBtc2kKICAgICAgICAgcmV0dXJuIC1FTk9ERVY7CiAgICAgfQogCisgICAgaW9tbXUgPSBm
aW5kX2lvbW11X2Zvcl9kZXZpY2UoaHBldF9zYmRmLnNlZywgaHBldF9zYmRmLmJkZik7Cisg
ICAgaWYgKCAhaW9tbXUgKQorICAgICAgICByZXR1cm4gLUVOWElPOworCiAgICAgbG9jayA9
IGdldF9pbnRyZW1hcF9sb2NrKGhwZXRfc2JkZi5zZWcsIGhwZXRfc2JkZi5iZGYpOwogICAg
IHNwaW5fbG9ja19pcnFzYXZlKGxvY2ssIGZsYWdzKTsKIAotICAgIG1zaV9kZXNjLT5yZW1h
cF9pbmRleCA9IGFsbG9jX2ludHJlbWFwX2VudHJ5KGhwZXRfc2JkZi5zZWcsCi0gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaHBldF9zYmRmLmJk
ZiwgMSk7Ci0gICAgaWYgKCBtc2lfZGVzYy0+cmVtYXBfaW5kZXggPj0gSU5UUkVNQVBfRU5U
UklFUyApCisgICAgbXNpX2Rlc2MtPnJlbWFwX2luZGV4ID0gYWxsb2NfaW50cmVtYXBfZW50
cnkoaW9tbXUsIGhwZXRfc2JkZi5iZGYsIDEpOworICAgIGlmICggbXNpX2Rlc2MtPnJlbWFw
X2luZGV4ID49IElOVFJFTUFQX01BWF9FTlRSSUVTICkKICAgICB7CiAgICAgICAgIG1zaV9k
ZXNjLT5yZW1hcF9pbmRleCA9IC0xOwogICAgICAgICByYyA9IC1FTlhJTzsKQEAgLTkwNiwx
MiArOTI3LDEyIEBAIHN0YXRpYyB2b2lkIGR1bXBfaW50cmVtYXBfdGFibGUoY29uc3Qgc3QK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5pb24gaXJ0ZV9jcHRyIHRibCwK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RydWN0IGl2cnNfbWFw
cGluZ3MgKml2cnNfbWFwcGluZykKIHsKLSAgICB1bnNpZ25lZCBpbnQgY291bnQ7CisgICAg
dW5zaWduZWQgaW50IGNvdW50LCBuciA9IGludHJlbWFwX3RhYmxlX2VudHJpZXModGJsLnB0
ciwgaW9tbXUpOwogCiAgICAgaWYgKCAhdGJsLnB0ciApCiAgICAgICAgIHJldHVybjsKIAot
ICAgIGZvciAoIGNvdW50ID0gMDsgY291bnQgPCBJTlRSRU1BUF9FTlRSSUVTOyBjb3VudCsr
ICkKKyAgICBmb3IgKCBjb3VudCA9IDA7IGNvdW50IDwgbnI7IGNvdW50KysgKQogICAgIHsK
ICAgICAgICAgaWYgKCBpb21tdS0+Y3RybC5nYV9lbgogICAgICAgICAgICAgID8gIXRibC5w
dHIxMjhbY291bnRdLnJhd1swXSAmJiAhdGJsLnB0cjEyOFtjb3VudF0ucmF3WzFdCi0tLSBh
L3hlbi9pbmNsdWRlL2FzbS14ODYvaHZtL3N2bS9hbWQtaW9tbXUtcHJvdG8uaAorKysgYi94
ZW4vaW5jbHVkZS9hc20teDg2L2h2bS9zdm0vYW1kLWlvbW11LXByb3RvLmgKQEAgLTEwMiw2
ICsxMDIsOCBAQCB2b2lkICphbWRfaW9tbXVfYWxsb2NfaW50cmVtYXBfdGFibGUoCiAgICAg
Y29uc3Qgc3RydWN0IGFtZF9pb21tdSAqLCB1bnNpZ25lZCBsb25nICoqKTsKIGludCBhbWRf
aW9tbXVfZnJlZV9pbnRyZW1hcF90YWJsZSgKICAgICBjb25zdCBzdHJ1Y3QgYW1kX2lvbW11
ICosIHN0cnVjdCBpdnJzX21hcHBpbmdzICosIHVpbnQxNl90KTsKK3Vuc2lnbmVkIGludCBh
bWRfaW9tbXVfaW50cmVtYXBfdGFibGVfb3JkZXIoCisgICAgY29uc3Qgdm9pZCAqaXJ0LCBj
b25zdCBzdHJ1Y3QgYW1kX2lvbW11ICppb21tdSk7CiB2b2lkIGFtZF9pb21tdV9pb2FwaWNf
dXBkYXRlX2lyZSgKICAgICB1bnNpZ25lZCBpbnQgYXBpYywgdW5zaWduZWQgaW50IHJlZywg
dW5zaWduZWQgaW50IHZhbHVlKTsKIHVuc2lnbmVkIGludCBhbWRfaW9tbXVfcmVhZF9pb2Fw
aWNfZnJvbV9pcmUoCg==
--------------3B7AC5CFE503A3FAD31D6CF7
Content-Type: text/plain; charset=UTF-8;
 name="10-AMD-IOMMU-limit-IRT-alloc-order.patch"
Content-Transfer-Encoding: base64
Content-Disposition: attachment;
 filename="10-AMD-IOMMU-limit-IRT-alloc-order.patch"

QU1EL0lPTU1VOiByZXN0cmljdCBpbnRlcnJ1cHQgcmVtYXBwaW5nIHRhYmxlIHNpemVzCgpU
aGVyZSdzIG5vIHBvaW50IHNldHRpbmcgdXAgdGFibGVzIHdpdGggbW9yZSBzcGFjZSB0aGFu
IGEgUENJIGRldmljZSBjYW4KdXNlLiBGb3IgYm90aCBNU0kgYW5kIE1TSS1YIHdlIGNhbiBk
ZXRlcm1pbmUgaG93IG1hbnkgaW50ZXJydXB0cyBjb3VsZApiZSBzZXQgdXAgYXQgbW9zdC4g
VGFibGVzIGFsbG9jYXRlZCBkdXJpbmcgQUNQSSB0YWJsZSBwYXJzaW5nLCBob3dldmVyLAp3
aWxsIChmb3Igbm93IGF0IGxlYXN0KSBjb250aW51ZSB0byBiZSBzZXQgdXAgdG8gaGF2ZSBt
YXhpbXVtIHNpemUuCgpOb3RlIHRoYXQgdW50aWwgd2Ugd291bGQgd2FudCB0byB1c2Ugc3Vi
LXBhZ2UgYWxsb2NhdGlvbnMgaGVyZSB0aGVyZSdzCm5vIHBvaW50IGNoZWNraW5nIHdoZXRo
ZXIgTVNJIGlzIHN1cHBvcnRlZCBieSBhIGRldmljZSAtIDEgb3IgdXAgdG8gMzIKKG9yIGFj
dHVhbGx5IDEyOCwgZHVlIHRvIHRoZSBjaGFuZ2UgZWZmZWN0aXZlbHkgdXNpbmcgYSByZXNl
cnZlZAplbmNvZGluZykgSVJURXMgYWx3YXlzIG1lYW4gYW4gb3JkZXItMCBhbGxvY2F0aW9u
IGFueXdheS4KClN1Z2dlc3RlZC1ieTogQW5kcmV3IENvb3BlciA8YW5kcmV3LmNvb3BlcjNA
Y2l0cml4LmNvbT4KU2lnbmVkLW9mZi1ieTogSmFuIEJldWxpY2ggPGpiZXVsaWNoQHN1c2Uu
Y29tPgotLS0KdjU6IE5ldy4KCi0tLSBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9p
b21tdV9hY3BpLmMKKysrIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL2lvbW11X2Fj
cGkuYwpAQCAtNzcsNyArNzcsNyBAQCBzdGF0aWMgdm9pZCBfX2luaXQgYWRkX2l2cnNfbWFw
cGluZ19lbnRyCiAgICAgICAgIHsKICAgICAgICAgICAgIGlmICggIXNoYXJlZF9pbnRyZW1h
cF90YWJsZSApCiAgICAgICAgICAgICAgICAgc2hhcmVkX2ludHJlbWFwX3RhYmxlID0gYW1k
X2lvbW11X2FsbG9jX2ludHJlbWFwX3RhYmxlKAotICAgICAgICAgICAgICAgICAgICBpb21t
dSwgJnNoYXJlZF9pbnRyZW1hcF9pbnVzZSk7CisgICAgICAgICAgICAgICAgICAgIGlvbW11
LCAmc2hhcmVkX2ludHJlbWFwX2ludXNlLCAwKTsKIAogICAgICAgICAgICAgaWYgKCAhc2hh
cmVkX2ludHJlbWFwX3RhYmxlICkKICAgICAgICAgICAgICAgICBwYW5pYygiTm8gbWVtb3J5
IGZvciBzaGFyZWQgSVJUXG4iKTsKQEAgLTg5LDcgKzg5LDcgQEAgc3RhdGljIHZvaWQgX19p
bml0IGFkZF9pdnJzX21hcHBpbmdfZW50cgogICAgICAgICB7CiAgICAgICAgICAgICBpdnJz
X21hcHBpbmdzW2FsaWFzX2lkXS5pbnRyZW1hcF90YWJsZSA9CiAgICAgICAgICAgICAgICAg
YW1kX2lvbW11X2FsbG9jX2ludHJlbWFwX3RhYmxlKAotICAgICAgICAgICAgICAgICAgICBp
b21tdSwgJml2cnNfbWFwcGluZ3NbYWxpYXNfaWRdLmludHJlbWFwX2ludXNlKTsKKyAgICAg
ICAgICAgICAgICAgICAgaW9tbXUsICZpdnJzX21hcHBpbmdzW2FsaWFzX2lkXS5pbnRyZW1h
cF9pbnVzZSwgMCk7CiAKICAgICAgICAgICAgIGlmICggIWl2cnNfbWFwcGluZ3NbYWxpYXNf
aWRdLmludHJlbWFwX3RhYmxlICkKICAgICAgICAgICAgICAgICBwYW5pYygiTm8gbWVtb3J5
IGZvciAlMDR4OiUwMng6JTAyeC4ldSdzIElSVFxuIiwKLS0tIGEveGVuL2RyaXZlcnMvcGFz
c3Rocm91Z2gvYW1kL2lvbW11X2luaXQuYworKysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3Vn
aC9hbWQvaW9tbXVfaW5pdC5jCkBAIC0xMjkyLDcgKzEyOTIsOSBAQCBzdGF0aWMgaW50IF9f
aW5pdCBhbWRfaW9tbXVfc2V0dXBfZGV2aWNlCiAgICAgICAgICAgICAgICAgaXZyc19tYXBw
aW5nc1tiZGZdLmludHJlbWFwX3RhYmxlID0KICAgICAgICAgICAgICAgICAgICAgYW1kX2lv
bW11X2FsbG9jX2ludHJlbWFwX3RhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICAgaXZy
c19tYXBwaW5nc1tiZGZdLmlvbW11LAotICAgICAgICAgICAgICAgICAgICAgICAgJml2cnNf
bWFwcGluZ3NbYmRmXS5pbnRyZW1hcF9pbnVzZSk7CisgICAgICAgICAgICAgICAgICAgICAg
ICAmaXZyc19tYXBwaW5nc1tiZGZdLmludHJlbWFwX2ludXNlLAorICAgICAgICAgICAgICAg
ICAgICAgICAgcGRldi0+bXNpeCA/IHBkZXYtPm1zaXgtPm5yX2VudHJpZXMKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBtdWx0aV9tc2lfY2FwYWJsZSh+MHUpKTsK
ICAgICAgICAgICAgICAgICBpZiAoICFpdnJzX21hcHBpbmdzW2JkZl0uaW50cmVtYXBfdGFi
bGUgKQogICAgICAgICAgICAgICAgICAgICByZXR1cm4gLUVOT01FTTsKIApAQCAtMTMxNSwx
MSArMTMxNyw4IEBAIHN0YXRpYyBpbnQgX19pbml0IGFtZF9pb21tdV9zZXR1cF9kZXZpY2UK
ICAgICAgICAgICAgIH0KIAogICAgICAgICAgICAgYW1kX2lvbW11X3NldF9pbnRyZW1hcF90
YWJsZSgKLSAgICAgICAgICAgICAgICBkdGUsCi0gICAgICAgICAgICAgICAgaXZyc19tYXBw
aW5nc1tiZGZdLmludHJlbWFwX3RhYmxlCi0gICAgICAgICAgICAgICAgPyB2aXJ0X3RvX21h
ZGRyKGl2cnNfbWFwcGluZ3NbYmRmXS5pbnRyZW1hcF90YWJsZSkKLSAgICAgICAgICAgICAg
ICA6IDAsCi0gICAgICAgICAgICAgICAgaW9tbXVfaW50cmVtYXApOworICAgICAgICAgICAg
ICAgIGR0ZSwgaXZyc19tYXBwaW5nc1tiZGZdLmludHJlbWFwX3RhYmxlLAorICAgICAgICAg
ICAgICAgIGl2cnNfbWFwcGluZ3NbYmRmXS5pb21tdSwgaW9tbXVfaW50cmVtYXApOwogICAg
ICAgICB9CiAgICAgfQogCi0tLSBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9pb21t
dV9pbnRyLmMKKysrIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL2lvbW11X2ludHIu
YwpAQCAtNjksNyArNjksOCBAQCB1bmlvbiBpcnRlX2NwdHIgewogICAgIGNvbnN0IHVuaW9u
IGlydGUxMjggKnB0cjEyODsKIH0gX190cmFuc3BhcmVudF9fOwogCi0jZGVmaW5lIElOVFJF
TUFQX01BWF9FTlRSSUVTICgxIDw8IElPTU1VX0lOVFJFTUFQX09SREVSKQorI2RlZmluZSBJ
TlRSRU1BUF9NQVhfT1JERVIgICAweEIKKyNkZWZpbmUgSU5UUkVNQVBfTUFYX0VOVFJJRVMg
KDEgPDwgSU5UUkVNQVBfTUFYX09SREVSKQogCiBzdHJ1Y3QgaW9hcGljX3NiZGYgaW9hcGlj
X3NiZGZbTUFYX0lPX0FQSUNTXTsKIHN0cnVjdCBocGV0X3NiZGYgaHBldF9zYmRmOwpAQCAt
ODAsMTcgKzgxLDEzIEBAIHVuc2lnbmVkIGludCBucl9pb2FwaWNfc2JkZjsKIAogc3RhdGlj
IHZvaWQgZHVtcF9pbnRyZW1hcF90YWJsZXModW5zaWduZWQgY2hhciBrZXkpOwogCi1zdGF0
aWMgdW5zaWduZWQgaW50IF9faW5pdCBpbnRyZW1hcF90YWJsZV9vcmRlcihjb25zdCBzdHJ1
Y3QgYW1kX2lvbW11ICppb21tdSkKLXsKLSAgICByZXR1cm4gaW9tbXUtPmN0cmwuZ2FfZW4K
LSAgICAgICAgICAgPyBnZXRfb3JkZXJfZnJvbV9ieXRlcyhJTlRSRU1BUF9NQVhfRU5UUklF
UyAqIHNpemVvZih1bmlvbiBpcnRlMTI4KSkKLSAgICAgICAgICAgOiBnZXRfb3JkZXJfZnJv
bV9ieXRlcyhJTlRSRU1BUF9NQVhfRU5UUklFUyAqIHNpemVvZih1bmlvbiBpcnRlMzIpKTsK
LX0KKyNkZWZpbmUgaW50cmVtYXBfcGFnZV9vcmRlcihpcnQpIFBGTl9PUkRFUih2aXJ0X3Rv
X3BhZ2UoaXJ0KSkKIAogdW5zaWduZWQgaW50IGFtZF9pb21tdV9pbnRyZW1hcF90YWJsZV9v
cmRlcigKICAgICBjb25zdCB2b2lkICppcnQsIGNvbnN0IHN0cnVjdCBhbWRfaW9tbXUgKmlv
bW11KQogewotICAgIHJldHVybiBJT01NVV9JTlRSRU1BUF9PUkRFUjsKKyAgICByZXR1cm4g
aW50cmVtYXBfcGFnZV9vcmRlcihpcnQpICsgUEFHRV9TSElGVCAtCisgICAgICAgICAgIChp
b21tdS0+Y3RybC5nYV9lbiA/IDQgOiAyKTsKIH0KIAogc3RhdGljIHVuc2lnbmVkIGludCBp
bnRyZW1hcF90YWJsZV9lbnRyaWVzKApAQCAtODI1LDcgKzgyMiwxMCBAQCBpbnQgYW1kX2lv
bW11X2ZyZWVfaW50cmVtYXBfdGFibGUoCiAKICAgICBpZiAoICp0YmxwICkKICAgICB7Ci0g
ICAgICAgIF9fZnJlZV9hbWRfaW9tbXVfdGFibGVzKCp0YmxwLCBpbnRyZW1hcF90YWJsZV9v
cmRlcihpb21tdSkpOworICAgICAgICB1bnNpZ25lZCBpbnQgb3JkZXIgPSBpbnRyZW1hcF9w
YWdlX29yZGVyKCp0YmxwKTsKKworICAgICAgICBpbnRyZW1hcF9wYWdlX29yZGVyKCp0Ymxw
KSA9IDA7CisgICAgICAgIF9fZnJlZV9hbWRfaW9tbXVfdGFibGVzKCp0YmxwLCBvcmRlcik7
CiAgICAgICAgICp0YmxwID0gTlVMTDsKICAgICB9CiAKQEAgLTgzMywxNSArODMzLDIzIEBA
IGludCBhbWRfaW9tbXVfZnJlZV9pbnRyZW1hcF90YWJsZSgKIH0KIAogdm9pZCAqYW1kX2lv
bW11X2FsbG9jX2ludHJlbWFwX3RhYmxlKAotICAgIGNvbnN0IHN0cnVjdCBhbWRfaW9tbXUg
KmlvbW11LCB1bnNpZ25lZCBsb25nICoqaW51c2VfbWFwKQorICAgIGNvbnN0IHN0cnVjdCBh
bWRfaW9tbXUgKmlvbW11LCB1bnNpZ25lZCBsb25nICoqaW51c2VfbWFwLCB1bnNpZ25lZCBp
bnQgbnIpCiB7Ci0gICAgdW5zaWduZWQgaW50IG9yZGVyID0gaW50cmVtYXBfdGFibGVfb3Jk
ZXIoaW9tbXUpOwotICAgIHZvaWQgKnRiID0gX19hbGxvY19hbWRfaW9tbXVfdGFibGVzKG9y
ZGVyKTsKKyAgICB1bnNpZ25lZCBpbnQgb3JkZXI7CisgICAgdm9pZCAqdGI7CiAKKyAgICBp
ZiAoICFuciApCisgICAgICAgIG5yID0gSU5UUkVNQVBfTUFYX0VOVFJJRVM7CisKKyAgICBv
cmRlciA9IGlvbW11LT5jdHJsLmdhX2VuCisgICAgICAgICAgICA/IGdldF9vcmRlcl9mcm9t
X2J5dGVzKG5yICogc2l6ZW9mKHVuaW9uIGlydGUxMjgpKQorICAgICAgICAgICAgOiBnZXRf
b3JkZXJfZnJvbV9ieXRlcyhuciAqIHNpemVvZih1bmlvbiBpcnRlMzIpKTsKKworICAgIHRi
ID0gX19hbGxvY19hbWRfaW9tbXVfdGFibGVzKG9yZGVyKTsKICAgICBpZiAoIHRiICkKICAg
ICB7Ci0gICAgICAgIHVuc2lnbmVkIGludCBuciA9IGludHJlbWFwX3RhYmxlX2VudHJpZXMo
dGIsIGlvbW11KTsKLQorICAgICAgICBpbnRyZW1hcF9wYWdlX29yZGVyKHRiKSA9IG9yZGVy
OworICAgICAgICBuciA9IGludHJlbWFwX3RhYmxlX2VudHJpZXModGIsIGlvbW11KTsKICAg
ICAgICAgKmludXNlX21hcCA9IHh6YWxsb2NfYXJyYXkodW5zaWduZWQgbG9uZywgQklUU19U
T19MT05HUyhucikpOwogICAgICAgICBpZiAoICppbnVzZV9tYXAgKQogICAgICAgICAgICAg
bWVtc2V0KHRiLCAwLCBQQUdFX1NJWkUgPDwgb3JkZXIpOwotLS0gYS94ZW4vZHJpdmVycy9w
YXNzdGhyb3VnaC9hbWQvaW9tbXVfbWFwLmMKKysrIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91
Z2gvYW1kL2lvbW11X21hcC5jCkBAIC0xMTMsMTIgKzExMywyMiBAQCB2b2lkIGFtZF9pb21t
dV9zZXRfcm9vdF9wYWdlX3RhYmxlKHN0cnVjCiB9CiAKIHZvaWQgX19pbml0IGFtZF9pb21t
dV9zZXRfaW50cmVtYXBfdGFibGUoCi0gICAgc3RydWN0IGFtZF9pb21tdV9kdGUgKmR0ZSwg
dWludDY0X3QgaW50cmVtYXBfcHRyLCBib29sIHZhbGlkKQorICAgIHN0cnVjdCBhbWRfaW9t
bXVfZHRlICpkdGUsIGNvbnN0IHZvaWQgKnB0ciwKKyAgICBjb25zdCBzdHJ1Y3QgYW1kX2lv
bW11ICppb21tdSwgYm9vbCB2YWxpZCkKIHsKLSAgICBkdGUtPml0X3Jvb3QgPSBpbnRyZW1h
cF9wdHIgPj4gNjsKLSAgICBkdGUtPmludF90YWJfbGVuID0gaW50cmVtYXBfcHRyID8gSU9N
TVVfSU5UUkVNQVBfT1JERVIgOiAwOwotICAgIGR0ZS0+aW50X2N0bCA9IGludHJlbWFwX3B0
ciA/IElPTU1VX0RFVl9UQUJMRV9JTlRfQ09OVFJPTF9UUkFOU0xBVEVECi0gICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIDogSU9NTVVfREVWX1RBQkxFX0lOVF9DT05UUk9MX0FC
T1JURUQ7CisgICAgaWYgKCBwdHIgKQorICAgIHsKKyAgICAgICAgZHRlLT5pdF9yb290ID0g
dmlydF90b19tYWRkcihwdHIpID4+IDY7CisgICAgICAgIGR0ZS0+aW50X3RhYl9sZW4gPSBh
bWRfaW9tbXVfaW50cmVtYXBfdGFibGVfb3JkZXIocHRyLCBpb21tdSk7CisgICAgICAgIGR0
ZS0+aW50X2N0bCA9IElPTU1VX0RFVl9UQUJMRV9JTlRfQ09OVFJPTF9UUkFOU0xBVEVEOwor
ICAgIH0KKyAgICBlbHNlCisgICAgeworICAgICAgICBkdGUtPml0X3Jvb3QgPSAwOworICAg
ICAgICBkdGUtPmludF90YWJfbGVuID0gMDsKKyAgICAgICAgZHRlLT5pbnRfY3RsID0gSU9N
TVVfREVWX1RBQkxFX0lOVF9DT05UUk9MX0FCT1JURUQ7CisgICAgfQorCiAgICAgZHRlLT5p
ZyA9IGZhbHNlOyAvKiB1bm1hcHBlZCBpbnRlcnJ1cHRzIHJlc3VsdCBpbiBpL28gcGFnZSBm
YXVsdHMgKi8KICAgICBkdGUtPml2ID0gdmFsaWQ7CiB9Ci0tLSBhL3hlbi9kcml2ZXJzL3Bh
c3N0aHJvdWdoL2FtZC9wY2lfYW1kX2lvbW11LmMKKysrIGIveGVuL2RyaXZlcnMvcGFzc3Ro
cm91Z2gvYW1kL3BjaV9hbWRfaW9tbXUuYwpAQCAtNDcxLDE2ICs0NzEsMTUgQEAgc3RhdGlj
IGludCBhbWRfaW9tbXVfYWRkX2RldmljZSh1OCBkZXZmbgogICAgIHsKICAgICAgICAgaXZy
c19tYXBwaW5nc1tiZGZdLmludHJlbWFwX3RhYmxlID0KICAgICAgICAgICAgIGFtZF9pb21t
dV9hbGxvY19pbnRyZW1hcF90YWJsZSgKLSAgICAgICAgICAgICAgICBpb21tdSwgJml2cnNf
bWFwcGluZ3NbYmRmXS5pbnRyZW1hcF9pbnVzZSk7CisgICAgICAgICAgICAgICAgaW9tbXUs
ICZpdnJzX21hcHBpbmdzW2JkZl0uaW50cmVtYXBfaW51c2UsCisgICAgICAgICAgICAgICAg
cGRldi0+bXNpeCA/IHBkZXYtPm1zaXgtPm5yX2VudHJpZXMKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgIDogbXVsdGlfbXNpX2NhcGFibGUofjB1KSk7CiAgICAgICAgIGlmICggIWl2
cnNfbWFwcGluZ3NbYmRmXS5pbnRyZW1hcF90YWJsZSApCiAgICAgICAgICAgICByZXR1cm4g
LUVOT01FTTsKIAogICAgICAgICBhbWRfaW9tbXVfc2V0X2ludHJlbWFwX3RhYmxlKAogICAg
ICAgICAgICAgaW9tbXUtPmRldl90YWJsZS5idWZmZXIgKyAoYmRmICogSU9NTVVfREVWX1RB
QkxFX0VOVFJZX1NJWkUpLAotICAgICAgICAgICAgaXZyc19tYXBwaW5nc1tiZGZdLmludHJl
bWFwX3RhYmxlCi0gICAgICAgICAgICA/IHZpcnRfdG9fbWFkZHIoaXZyc19tYXBwaW5nc1ti
ZGZdLmludHJlbWFwX3RhYmxlKQotICAgICAgICAgICAgOiAwLAotICAgICAgICAgICAgaW9t
bXVfaW50cmVtYXApOworICAgICAgICAgICAgaXZyc19tYXBwaW5nc1tiZGZdLmludHJlbWFw
X3RhYmxlLCBpb21tdSwgaW9tbXVfaW50cmVtYXApOwogCiAgICAgICAgIGFtZF9pb21tdV9m
bHVzaF9kZXZpY2UoaW9tbXUsIGJkZik7CiAgICAgfQotLS0gYS94ZW4vaW5jbHVkZS9hc20t
eDg2L2h2bS9zdm0vYW1kLWlvbW11LWRlZnMuaAorKysgYi94ZW4vaW5jbHVkZS9hc20teDg2
L2h2bS9zdm0vYW1kLWlvbW11LWRlZnMuaApAQCAtMTA3LDkgKzEwNyw2IEBACiAjZGVmaW5l
IElPTU1VX0RFVl9UQUJMRV9JTlRfQ09OVFJPTF9GT1JXQVJERUQJMHgxCiAjZGVmaW5lIElP
TU1VX0RFVl9UQUJMRV9JTlRfQ09OVFJPTF9UUkFOU0xBVEVECTB4MgogCi0vKiBGb3Igbm93
LCB3ZSBhbHdheXMgYWxsb2NhdGUgdGhlIG1heGltdW06IDIwNDggZW50cmllcy4gKi8KLSNk
ZWZpbmUgSU9NTVVfSU5UUkVNQVBfT1JERVIJCQkweEIKLQogc3RydWN0IGFtZF9pb21tdV9k
dGUgewogICAgIC8qIDAgLSA2MyAqLwogICAgIGJvb2wgdjoxOwotLS0gYS94ZW4vaW5jbHVk
ZS9hc20teDg2L2h2bS9zdm0vYW1kLWlvbW11LXByb3RvLmgKKysrIGIveGVuL2luY2x1ZGUv
YXNtLXg4Ni9odm0vc3ZtL2FtZC1pb21tdS1wcm90by5oCkBAIC03Miw3ICs3Miw4IEBAIGlu
dCBfX211c3RfY2hlY2sgYW1kX2lvbW11X2ZsdXNoX2lvdGxiX2EKIC8qIGRldmljZSB0YWJs
ZSBmdW5jdGlvbnMgKi8KIGludCBnZXRfZG1hX3JlcXVlc3Rvcl9pZCh1aW50MTZfdCBzZWcs
IHVpbnQxNl90IGJkZik7CiB2b2lkIGFtZF9pb21tdV9zZXRfaW50cmVtYXBfdGFibGUoc3Ry
dWN0IGFtZF9pb21tdV9kdGUgKmR0ZSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICB1aW50NjRfdCBpbnRyZW1hcF9wdHIsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgY29uc3Qgdm9pZCAqcHRyLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGNvbnN0IHN0cnVjdCBhbWRfaW9tbXUgKmlvbW11LAogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGJvb2wgdmFsaWQpOwogdm9pZCBhbWRfaW9tbXVfc2V0X3Jv
b3RfcGFnZV90YWJsZShzdHJ1Y3QgYW1kX2lvbW11X2R0ZSAqZHRlLAogCQkJCSAgIHVpbnQ2
NF90IHJvb3RfcHRyLCB1aW50MTZfdCBkb21haW5faWQsCkBAIC05OSw3ICsxMDAsNyBAQCBz
dHJ1Y3QgYW1kX2lvbW11ICpmaW5kX2lvbW11X2Zvcl9kZXZpY2UoCiBib29sIGlvdl9zdXBw
b3J0c194dCh2b2lkKTsKIGludCBhbWRfaW9tbXVfc2V0dXBfaW9hcGljX3JlbWFwcGluZyh2
b2lkKTsKIHZvaWQgKmFtZF9pb21tdV9hbGxvY19pbnRyZW1hcF90YWJsZSgKLSAgICBjb25z
dCBzdHJ1Y3QgYW1kX2lvbW11ICosIHVuc2lnbmVkIGxvbmcgKiopOworICAgIGNvbnN0IHN0
cnVjdCBhbWRfaW9tbXUgKiwgdW5zaWduZWQgbG9uZyAqKiwgdW5zaWduZWQgaW50IG5yKTsK
IGludCBhbWRfaW9tbXVfZnJlZV9pbnRyZW1hcF90YWJsZSgKICAgICBjb25zdCBzdHJ1Y3Qg
YW1kX2lvbW11ICosIHN0cnVjdCBpdnJzX21hcHBpbmdzICosIHVpbnQxNl90KTsKIHVuc2ln
bmVkIGludCBhbWRfaW9tbXVfaW50cmVtYXBfdGFibGVfb3JkZXIoCg==
--------------3B7AC5CFE503A3FAD31D6CF7
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: base64
Content-Disposition: inline

X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVs
IG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0
cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

--------------3B7AC5CFE503A3FAD31D6CF7--


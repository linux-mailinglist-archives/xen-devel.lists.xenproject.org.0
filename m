Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id BBAA8144CC
	for <lists+xen-devel@lfdr.de>; Mon,  6 May 2019 09:00:33 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hNXYZ-0001uY-EN; Mon, 06 May 2019 06:56:59 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=XZcu=TG=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1hNXYX-0001tL-9b
 for xen-devel@lists.xenproject.org; Mon, 06 May 2019 06:56:57 +0000
X-Inumbo-ID: 220b4e55-6fcc-11e9-843c-bc764e045a96
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 220b4e55-6fcc-11e9-843c-bc764e045a96;
 Mon, 06 May 2019 06:56:55 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 1DBB7AEF7;
 Mon,  6 May 2019 06:56:52 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Mon,  6 May 2019 08:56:11 +0200
Message-Id: <20190506065644.7415-13-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190506065644.7415-1-jgross@suse.com>
References: <20190506065644.7415-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH RFC V2 12/45] xen/sched: add scheduler helpers
 hiding vcpu
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Tim Deegan <tim@xen.org>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wei.liu2@citrix.com>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Dario Faggioli <dfaggioli@suse.com>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

QWRkIHRoZSBmb2xsb3dpbmcgaGVscGVycyB1c2luZyBhIHNjaGVkX2l0ZW0gYXMgaW5wdXQgaW5z
dGVhZCBvZiBhCnZjcHU6CgotIGlzX2lkbGVfaXRlbSgpIHNpbWlsYXIgdG8gaXNfaWRsZV92Y3B1
KCkKLSBpdGVtX3J1bm5hYmxlKCkgbGlrZSB2Y3B1X3J1bm5hYmxlKCkKLSBzY2hlZF9zZXRfcmVz
KCkgdG8gc2V0IHRoZSBjdXJyZW50IHByb2Nlc3NvciBvZiBhbiBpdGVtCi0gc2NoZWRfaXRlbV9j
cHUoKSB0byBnZXQgdGhlIGN1cnJlbnQgcHJvY2Vzc29yIG9mIGFuIGl0ZW0KLSBzY2hlZF97c2V0
fGNsZWFyfV9wYXVzZV9mbGFnc1tfYXRvbWljXSgpIHRvIG1vZGlmeSBwYXVzZV9mbGFncyBvZiB0
aGUKICBhc3NvY2lhdGVkIHZjcHUocykKLSBzY2hlZF9pZGxlX2l0ZW0oKSB0byBnZXQgdGhlIHNj
aGVkX2l0ZW0gcG9pbnRlciBvZiB0aGUgaWRsZSB2Y3B1IG9mIGEKICBzcGVjaWZpYyBwaHlzaWNh
bCBjcHUKClNpZ25lZC1vZmYtYnk6IEp1ZXJnZW4gR3Jvc3MgPGpncm9zc0BzdXNlLmNvbT4KLS0t
CiB4ZW4vY29tbW9uL3NjaGVkX2NyZWRpdC5jICB8ICAzICstLQogeGVuL2NvbW1vbi9zY2hlZHVs
ZS5jICAgICAgfCAxOSArKysrKysrKy0tLS0tLS0tCiB4ZW4vaW5jbHVkZS94ZW4vc2NoZWQtaWYu
aCB8IDU2ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKy0tLS0KIDMg
ZmlsZXMgY2hhbmdlZCwgNjIgaW5zZXJ0aW9ucygrKSwgMTYgZGVsZXRpb25zKC0pCgpkaWZmIC0t
Z2l0IGEveGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQuYyBiL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0
LmMKaW5kZXggOWU3Yzg0OWI5NC4uOGNmZTU0ZWMzNiAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9z
Y2hlZF9jcmVkaXQuYworKysgYi94ZW4vY29tbW9uL3NjaGVkX2NyZWRpdC5jCkBAIC0xNjczLDgg
KzE2NzMsNyBAQCBjc2NoZWRfcnVucV9zdGVhbChpbnQgcGVlcl9jcHUsIGludCBjcHUsIGludCBw
cmksIGludCBiYWxhbmNlX3N0ZXApCiAgICAgICAgICAgICBTQ0hFRF9TVEFUX0NSQU5LKG1pZ3Jh
dGVfcXVldWVkKTsKICAgICAgICAgICAgIFdBUk5fT04odmMtPmlzX3VyZ2VudCk7CiAgICAgICAg
ICAgICBydW5xX3JlbW92ZShzcGVlcik7Ci0gICAgICAgICAgICB2Yy0+cHJvY2Vzc29yID0gY3B1
OwotICAgICAgICAgICAgdmMtPnNjaGVkX2l0ZW0tPnJlcyA9IHBlcl9jcHUoc2NoZWRfcmVzLCBj
cHUpOworICAgICAgICAgICAgc2NoZWRfc2V0X3Jlcyh2Yy0+c2NoZWRfaXRlbSwgcGVyX2NwdShz
Y2hlZF9yZXMsIGNwdSkpOwogICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAqIHNwZWVyIHdp
bGwgc3RhcnQgZXhlY3V0aW5nIGRpcmVjdGx5IG9uIGNwdSwgd2l0aG91dCBoYXZpbmcgdG8KICAg
ICAgICAgICAgICAqIGdvIHRocm91Z2ggcnVucV9pbnNlcnQoKS4gU28gd2UgbXVzdCB1cGRhdGUg
dGhlIHJ1bm5hYmxlIGNvdW50CmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3NjaGVkdWxlLmMgYi94
ZW4vY29tbW9uL3NjaGVkdWxlLmMKaW5kZXggZjQ4NTBhNTdmNi4uZDU2ZGM1NjdhYyAxMDA2NDQK
LS0tIGEveGVuL2NvbW1vbi9zY2hlZHVsZS5jCisrKyBiL3hlbi9jb21tb24vc2NoZWR1bGUuYwpA
QCAtMzE3LDEyICszMTcsMTEgQEAgaW50IHNjaGVkX2luaXRfdmNwdShzdHJ1Y3QgdmNwdSAqdiwg
dW5zaWduZWQgaW50IHByb2Nlc3NvcikKICAgICBzdHJ1Y3QgZG9tYWluICpkID0gdi0+ZG9tYWlu
OwogICAgIHN0cnVjdCBzY2hlZF9pdGVtICppdGVtOwogCi0gICAgdi0+cHJvY2Vzc29yID0gcHJv
Y2Vzc29yOwotCiAgICAgaWYgKCAoaXRlbSA9IHNjaGVkX2FsbG9jX2l0ZW0odikpID09IE5VTEwg
KQogICAgICAgICByZXR1cm4gMTsKIAotICAgIGl0ZW0tPnJlcyA9IHBlcl9jcHUoc2NoZWRfcmVz
LCBwcm9jZXNzb3IpOworICAgIHNjaGVkX3NldF9yZXMoaXRlbSwgcGVyX2NwdShzY2hlZF9yZXMs
IHByb2Nlc3NvcikpOworCiAgICAgLyogSW5pdGlhbGlzZSB0aGUgcGVyLXZjcHUgdGltZXJzLiAq
LwogICAgIGluaXRfdGltZXIoJnYtPnBlcmlvZGljX3RpbWVyLCB2Y3B1X3BlcmlvZGljX3RpbWVy
X2ZuLAogICAgICAgICAgICAgICAgdiwgdi0+cHJvY2Vzc29yKTsKQEAgLTQzNiw4ICs0MzUsNyBA
QCBpbnQgc2NoZWRfbW92ZV9kb21haW4oc3RydWN0IGRvbWFpbiAqZCwgc3RydWN0IGNwdXBvb2wg
KmMpCiAKICAgICAgICAgc2NoZWRfc2V0X2FmZmluaXR5KHYsICZjcHVtYXNrX2FsbCwgJmNwdW1h
c2tfYWxsKTsKIAotICAgICAgICB2LT5wcm9jZXNzb3IgPSBuZXdfcDsKLQl2LT5zY2hlZF9pdGVt
LT5yZXMgPSBwZXJfY3B1KHNjaGVkX3JlcywgbmV3X3ApOworICAgICAgICBzY2hlZF9zZXRfcmVz
KHYtPnNjaGVkX2l0ZW0sIHBlcl9jcHUoc2NoZWRfcmVzLCBuZXdfcCkpOwogICAgICAgICAvKgog
ICAgICAgICAgKiBXaXRoIHYtPnByb2Nlc3NvciBtb2RpZmllZCB3ZSBtdXN0IG5vdAogICAgICAg
ICAgKiAtIG1ha2UgYW55IGZ1cnRoZXIgY2hhbmdlcyBhc3N1bWluZyB3ZSBob2xkIHRoZSBzY2hl
ZHVsZXIgbG9jaywKQEAgLTc3NSw4ICs3NzMsOSBAQCB2b2lkIHJlc3RvcmVfdmNwdV9hZmZpbml0
eShzdHJ1Y3QgZG9tYWluICpkKQogICAgICAgICBzcGlubG9ja190ICpsb2NrOwogICAgICAgICB1
bnNpZ25lZCBpbnQgb2xkX2NwdSA9IHYtPnByb2Nlc3NvcjsKICAgICAgICAgc3RydWN0IHNjaGVk
X2l0ZW0gKml0ZW0gPSB2LT5zY2hlZF9pdGVtOworICAgICAgICBzdHJ1Y3Qgc2NoZWRfcmVzb3Vy
Y2UgKnJlczsKIAotICAgICAgICBBU1NFUlQoIXZjcHVfcnVubmFibGUodikpOworICAgICAgICBB
U1NFUlQoIWl0ZW1fcnVubmFibGUoaXRlbSkpOwogCiAgICAgICAgIC8qCiAgICAgICAgICAqIFJl
LWFzc2lnbiB0aGUgaW5pdGlhbCBwcm9jZXNzb3IgYXMgYWZ0ZXIgcmVzdW1lIHdlIGhhdmUgbm8K
QEAgLTgwNywxMiArODA2LDEyIEBAIHZvaWQgcmVzdG9yZV92Y3B1X2FmZmluaXR5KHN0cnVjdCBk
b21haW4gKmQpCiAgICAgICAgICAgICB9CiAgICAgICAgIH0KIAotICAgICAgICB2LT5wcm9jZXNz
b3IgPSBjcHVtYXNrX2FueShjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSkpOwotICAgICAgICBpdGVt
LT5yZXMgPSBwZXJfY3B1KHNjaGVkX3Jlcywgdi0+cHJvY2Vzc29yKTsKKyAgICAgICAgcmVzID0g
cGVyX2NwdShzY2hlZF9yZXMsIGNwdW1hc2tfYW55KGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSkp
OworICAgICAgICBzY2hlZF9zZXRfcmVzKGl0ZW0sIHJlcyk7CiAKICAgICAgICAgbG9jayA9IGl0
ZW1fc2NoZWR1bGVfbG9ja19pcnEoaXRlbSk7Ci0gICAgICAgIGl0ZW0tPnJlcyA9IHNjaGVkX3Bp
Y2tfcmVzb3VyY2UodmNwdV9zY2hlZHVsZXIodiksIGl0ZW0pOwotICAgICAgICB2LT5wcm9jZXNz
b3IgPSBpdGVtLT5yZXMtPnByb2Nlc3NvcjsKKyAgICAgICAgcmVzID0gc2NoZWRfcGlja19yZXNv
dXJjZSh2Y3B1X3NjaGVkdWxlcih2KSwgaXRlbSk7CisgICAgICAgIHNjaGVkX3NldF9yZXMoaXRl
bSwgcmVzKTsKICAgICAgICAgc3Bpbl91bmxvY2tfaXJxKGxvY2spOwogCiAgICAgICAgIGlmICgg
b2xkX2NwdSAhPSB2LT5wcm9jZXNzb3IgKQpkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUveGVuL3Nj
aGVkLWlmLmggYi94ZW4vaW5jbHVkZS94ZW4vc2NoZWQtaWYuaAppbmRleCA1ZTAyNGRjZWIwLi41
MWMzNDc3NTgwIDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQtaWYuaAorKysgYi94
ZW4vaW5jbHVkZS94ZW4vc2NoZWQtaWYuaApAQCAtNDksNiArNDksNTcgQEAgREVDTEFSRV9QRVJf
Q1BVKHN0cnVjdCBzY2hlZHVsZXIgKiwgc2NoZWR1bGVyKTsKIERFQ0xBUkVfUEVSX0NQVShzdHJ1
Y3QgY3B1cG9vbCAqLCBjcHVwb29sKTsKIERFQ0xBUkVfUEVSX0NQVShzdHJ1Y3Qgc2NoZWRfcmVz
b3VyY2UgKiwgc2NoZWRfcmVzKTsKIAorc3RhdGljIGlubGluZSBib29sIGlzX2lkbGVfaXRlbShj
b25zdCBzdHJ1Y3Qgc2NoZWRfaXRlbSAqaXRlbSkKK3sKKyAgICByZXR1cm4gaXNfaWRsZV92Y3B1
KGl0ZW0tPnZjcHUpOworfQorCitzdGF0aWMgaW5saW5lIGJvb2wgaXRlbV9ydW5uYWJsZShjb25z
dCBzdHJ1Y3Qgc2NoZWRfaXRlbSAqaXRlbSkKK3sKKyAgICByZXR1cm4gdmNwdV9ydW5uYWJsZShp
dGVtLT52Y3B1KTsKK30KKworc3RhdGljIGlubGluZSB2b2lkIHNjaGVkX3NldF9yZXMoc3RydWN0
IHNjaGVkX2l0ZW0gKml0ZW0sCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1
Y3Qgc2NoZWRfcmVzb3VyY2UgKnJlcykKK3sKKyAgICBpdGVtLT52Y3B1LT5wcm9jZXNzb3IgPSBy
ZXMtPnByb2Nlc3NvcjsKKyAgICBpdGVtLT5yZXMgPSByZXM7Cit9CisKK3N0YXRpYyBpbmxpbmUg
dW5zaWduZWQgaW50IHNjaGVkX2l0ZW1fY3B1KHN0cnVjdCBzY2hlZF9pdGVtICppdGVtKQorewor
ICAgIHJldHVybiBpdGVtLT5yZXMtPnByb2Nlc3NvcjsKK30KKworc3RhdGljIGlubGluZSB2b2lk
IHNjaGVkX3NldF9wYXVzZV9mbGFncyhzdHJ1Y3Qgc2NoZWRfaXRlbSAqaXRlbSwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IGJpdCkKK3sKKyAg
ICBfX3NldF9iaXQoYml0LCAmaXRlbS0+dmNwdS0+cGF1c2VfZmxhZ3MpOworfQorCitzdGF0aWMg
aW5saW5lIHZvaWQgc2NoZWRfY2xlYXJfcGF1c2VfZmxhZ3Moc3RydWN0IHNjaGVkX2l0ZW0gKml0
ZW0sCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQg
aW50IGJpdCkKK3sKKyAgICBfX2NsZWFyX2JpdChiaXQsICZpdGVtLT52Y3B1LT5wYXVzZV9mbGFn
cyk7Cit9CisKK3N0YXRpYyBpbmxpbmUgdm9pZCBzY2hlZF9zZXRfcGF1c2VfZmxhZ3NfYXRvbWlj
KHN0cnVjdCBzY2hlZF9pdGVtICppdGVtLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IGJpdCkKK3sKKyAgICBzZXRfYml0KGJpdCwg
Jml0ZW0tPnZjcHUtPnBhdXNlX2ZsYWdzKTsKK30KKworc3RhdGljIGlubGluZSB2b2lkIHNjaGVk
X2NsZWFyX3BhdXNlX2ZsYWdzX2F0b21pYyhzdHJ1Y3Qgc2NoZWRfaXRlbSAqaXRlbSwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50
IGJpdCkKK3sKKyAgICBjbGVhcl9iaXQoYml0LCAmaXRlbS0+dmNwdS0+cGF1c2VfZmxhZ3MpOwor
fQorCitzdGF0aWMgaW5saW5lIHN0cnVjdCBzY2hlZF9pdGVtICpzY2hlZF9pZGxlX2l0ZW0odW5z
aWduZWQgaW50IGNwdSkKK3sKKyAgICByZXR1cm4gaWRsZV92Y3B1W2NwdV0tPnNjaGVkX2l0ZW07
Cit9CisKIC8qCiAgKiBTY3JhdGNoIHNwYWNlLCBmb3IgYXZvaWRpbmcgaGF2aW5nIHRvbyBtYW55
IGNwdW1hc2tfdCBvbiB0aGUgc3RhY2suCiAgKiBXaXRoaW4gZWFjaCBzY2hlZHVsZXIsIHdoZW4g
dXNpbmcgdGhlIHNjcmF0Y2ggbWFzayBvZiBvbmUgcENQVToKQEAgLTM2MywxMCArNDE0LDcgQEAg
c3RhdGljIGlubGluZSB2b2lkIHNjaGVkX21pZ3JhdGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAq
cywKICAgICBpZiAoIHMtPm1pZ3JhdGUgKQogICAgICAgICBzLT5taWdyYXRlKHMsIGl0ZW0sIGNw
dSk7CiAgICAgZWxzZQotICAgIHsKLSAgICAgICAgaXRlbS0+dmNwdS0+cHJvY2Vzc29yID0gY3B1
OwotICAgICAgICBpdGVtLT5yZXMgPSBwZXJfY3B1KHNjaGVkX3JlcywgY3B1KTsKLSAgICB9Cisg
ICAgICAgIHNjaGVkX3NldF9yZXMoaXRlbSwgcGVyX2NwdShzY2hlZF9yZXMsIGNwdSkpOwogfQog
CiBzdGF0aWMgaW5saW5lIHN0cnVjdCBzY2hlZF9yZXNvdXJjZSAqc2NoZWRfcGlja19yZXNvdXJj
ZSgKLS0gCjIuMTYuNAoKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qu
b3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2
ZWw=

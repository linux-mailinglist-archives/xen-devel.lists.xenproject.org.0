Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 8D7721843A2
	for <lists+xen-devel@lfdr.de>; Fri, 13 Mar 2020 10:29:13 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1jCgad-0002nL-S3; Fri, 13 Mar 2020 09:26:47 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=9TpK=46=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1jCgac-0002n5-Kf
 for xen-devel@lists.xenproject.org; Fri, 13 Mar 2020 09:26:46 +0000
X-Inumbo-ID: c16f72fe-650c-11ea-b2af-12813bfff9fa
Received: from mx2.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id c16f72fe-650c-11ea-b2af-12813bfff9fa;
 Fri, 13 Mar 2020 09:26:45 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx2.suse.de (Postfix) with ESMTP id 7CCE0B0BA;
 Fri, 13 Mar 2020 09:26:44 +0000 (UTC)
From: Jan Beulich <jbeulich@suse.com>
To: "xen-devel@lists.xenproject.org" <xen-devel@lists.xenproject.org>
References: <60130f14-3fc5-e40d-fec6-2448fefa6fc4@suse.com>
Message-ID: <513e4f93-a8a0-ae72-abcc-aa28531eca97@suse.com>
Date: Fri, 13 Mar 2020 10:26:47 +0100
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:68.0) Gecko/20100101
 Thunderbird/68.5.0
MIME-Version: 1.0
In-Reply-To: <60130f14-3fc5-e40d-fec6-2448fefa6fc4@suse.com>
Content-Language: en-US
Subject: [Xen-devel] [PATCH 4/4] x86/APIC: restrict certain messages to BSP
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>, Wei Liu <wl@xen.org>,
 =?UTF-8?Q?Roger_Pau_Monn=c3=a9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

QWxsIENQVXMgZ2V0IGFuIGVxdWFsIHNldHRpbmcgb2YgRU9JIGJyb2FkY2FzdCBzdXBwcmVzc2lv
bjsgbm8gbmVlZCB0bwpsb2cgb25lIG1lc3NhZ2UgcGVyIENQVSwgZXZlbiBpZiBpdCdzIG9ubHkg
aW4gdmVyYm9zZSBBUElDIG1vZGUuCgpPbmx5IHRoZSBCU1AgaXMgZWxpZ2libGUgdG8gcG9zc2li
bHkgZ2V0IEV4dElOVCBlbmFibGVkOyBubyBuZWVkIHRvIGxvZwp0aGF0IGl0IGdldHMgZGlzYWJs
ZWQgb24gYWxsIEFQcywgZXZlbiBpZiAtIGFnYWluIC0gaXQncyBvbmx5IGluIHZlcmJvc2UKQVBJ
QyBtb2RlLgoKVGFrZSB0aGUgb3Bwb3J0dW5pdHkgYW5kIGludHJvZHVjZSBhICJic3AiIHBhcmFt
ZXRlciB0byB0aGUgZnVuY3Rpb24sIHRvCnN0b3AgdXNpbmcgc21wX3Byb2Nlc3Nvcl9pZCgpIHRv
IHRlbGwgQlNQIGZyb20gQVBzLgoKU2lnbmVkLW9mZi1ieTogSmFuIEJldWxpY2ggPGpiZXVsaWNo
QHN1c2UuY29tPgoKLS0tIGEveGVuL2FyY2gveDg2L2FwaWMuYworKysgYi94ZW4vYXJjaC94ODYv
YXBpYy5jCkBAIC00OTksNyArNDk5LDcgQEAgc3RhdGljIHZvaWQgcmVzdW1lX3gyYXBpYyh2b2lk
KQogICAgIF9fZW5hYmxlX3gyYXBpYygpOwogfQogCi12b2lkIHNldHVwX2xvY2FsX0FQSUModm9p
ZCkKK3ZvaWQgc2V0dXBfbG9jYWxfQVBJQyhib29sIGJzcCkKIHsKICAgICB1bnNpZ25lZCBsb25n
IG9sZHZhbHVlLCB2YWx1ZSwgbWF4bHZ0OwogICAgIGludCBpLCBqOwpAQCAtNTk4LDggKzU5OCw4
IEBAIHZvaWQgc2V0dXBfbG9jYWxfQVBJQyh2b2lkKQogICAgIGlmICggZGlyZWN0ZWRfZW9pX2Vu
YWJsZWQgKQogICAgIHsKICAgICAgICAgdmFsdWUgfD0gQVBJQ19TUElWX0RJUkVDVEVEX0VPSTsK
LSAgICAgICAgYXBpY19wcmludGsoQVBJQ19WRVJCT1NFLCAiU3VwcHJlc3MgRU9JIGJyb2FkY2Fz
dCBvbiBDUFUjJWRcbiIsCi0gICAgICAgICAgICAgICAgICAgIHNtcF9wcm9jZXNzb3JfaWQoKSk7
CisgICAgICAgIGlmICggYnNwICkKKyAgICAgICAgICAgIGFwaWNfcHJpbnRrKEFQSUNfVkVSQk9T
RSwgIlN1cHByZXNzaW5nIEVPSSBicm9hZGNhc3RcbiIpOwogICAgIH0KIAogICAgIGFwaWNfd3Jp
dGUoQVBJQ19TUElWLCB2YWx1ZSk7CkBAIC02MTUsMjEgKzYxNSwyMiBAQCB2b2lkIHNldHVwX2xv
Y2FsX0FQSUModm9pZCkKICAgICAgKiBUT0RPOiBzZXQgdXAgdGhyb3VnaC1sb2NhbC1BUElDIGZy
b20gdGhyb3VnaC1JL08tQVBJQz8gLS1tYWNybwogICAgICAqLwogICAgIHZhbHVlID0gYXBpY19y
ZWFkKEFQSUNfTFZUMCkgJiBBUElDX0xWVF9NQVNLRUQ7Ci0gICAgaWYgKCFzbXBfcHJvY2Vzc29y
X2lkKCkgJiYgKHBpY19tb2RlIHx8ICF2YWx1ZSkpIHsKKyAgICBpZiAoYnNwICYmIChwaWNfbW9k
ZSB8fCAhdmFsdWUpKSB7CiAgICAgICAgIHZhbHVlID0gQVBJQ19ETV9FWFRJTlQ7CiAgICAgICAg
IGFwaWNfcHJpbnRrKEFQSUNfVkVSQk9TRSwgImVuYWJsZWQgRXh0SU5UIG9uIENQVSMlZFxuIiwK
ICAgICAgICAgICAgICAgICAgICAgc21wX3Byb2Nlc3Nvcl9pZCgpKTsKICAgICB9IGVsc2Ugewog
ICAgICAgICB2YWx1ZSA9IEFQSUNfRE1fRVhUSU5UIHwgQVBJQ19MVlRfTUFTS0VEOwotICAgICAg
ICBhcGljX3ByaW50ayhBUElDX1ZFUkJPU0UsICJtYXNrZWQgRXh0SU5UIG9uIENQVSMlZFxuIiwK
LSAgICAgICAgICAgICAgICAgICAgc21wX3Byb2Nlc3Nvcl9pZCgpKTsKKyAgICAgICAgaWYgKGJz
cCkKKyAgICAgICAgICAgIGFwaWNfcHJpbnRrKEFQSUNfVkVSQk9TRSwgIm1hc2tlZCBFeHRJTlQg
b24gQ1BVIyVkXG4iLAorICAgICAgICAgICAgICAgICAgICAgICAgc21wX3Byb2Nlc3Nvcl9pZCgp
KTsKICAgICB9CiAgICAgYXBpY193cml0ZShBUElDX0xWVDAsIHZhbHVlKTsKIAogICAgIC8qCiAg
ICAgICogb25seSB0aGUgQlAgc2hvdWxkIHNlZSB0aGUgTElOVDEgTk1JIHNpZ25hbCwgb2J2aW91
c2x5LgogICAgICAqLwotICAgIGlmICghc21wX3Byb2Nlc3Nvcl9pZCgpKQorICAgIGlmIChic3Ap
CiAgICAgICAgIHZhbHVlID0gQVBJQ19ETV9OTUk7CiAgICAgZWxzZQogICAgICAgICB2YWx1ZSA9
IEFQSUNfRE1fTk1JIHwgQVBJQ19MVlRfTUFTS0VEOwpAQCAtNjYzLDcgKzY2NCw3IEBAIHZvaWQg
c2V0dXBfbG9jYWxfQVBJQyh2b2lkKQogICAgICAgICBwcmludGsoIkxlYXZpbmcgRVNSIGRpc2Fi
bGVkLlxuIik7CiAgICAgfQogCi0gICAgaWYgKG5taV93YXRjaGRvZyA9PSBOTUlfTE9DQUxfQVBJ
QyAmJiBzbXBfcHJvY2Vzc29yX2lkKCkpCisgICAgaWYgKG5taV93YXRjaGRvZyA9PSBOTUlfTE9D
QUxfQVBJQyAmJiAhYnNwKQogICAgICAgICBzZXR1cF9hcGljX25taV93YXRjaGRvZygpOwogICAg
IGFwaWNfcG1fYWN0aXZhdGUoKTsKIH0KQEAgLTE0NzQsNyArMTQ3NSw3IEBAIGludCBfX2luaXQg
QVBJQ19pbml0X3VuaXByb2Nlc3NvciAodm9pZCkKICAgICBwaHlzaWRzX2NsZWFyKHBoeXNfY3B1
X3ByZXNlbnRfbWFwKTsKICAgICBwaHlzaWRfc2V0KGJvb3RfY3B1X3BoeXNpY2FsX2FwaWNpZCwg
cGh5c19jcHVfcHJlc2VudF9tYXApOwogCi0gICAgc2V0dXBfbG9jYWxfQVBJQygpOworICAgIHNl
dHVwX2xvY2FsX0FQSUModHJ1ZSk7CiAKICAgICBpZiAobm1pX3dhdGNoZG9nID09IE5NSV9MT0NB
TF9BUElDKQogICAgICAgICBjaGVja19ubWlfd2F0Y2hkb2coKTsKLS0tIGEveGVuL2FyY2gveDg2
L3NtcGJvb3QuYworKysgYi94ZW4vYXJjaC94ODYvc21wYm9vdC5jCkBAIC0xOTEsNyArMTkxLDcg
QEAgc3RhdGljIHZvaWQgc21wX2NhbGxpbih2b2lkKQogICAgICAqLwogICAgIERwcmludGsoIkNB
TExJTiwgYmVmb3JlIHNldHVwX2xvY2FsX0FQSUMoKS5cbiIpOwogICAgIHgyYXBpY19hcF9zZXR1
cCgpOwotICAgIHNldHVwX2xvY2FsX0FQSUMoKTsKKyAgICBzZXR1cF9sb2NhbF9BUElDKGZhbHNl
KTsKIAogICAgIC8qIFNhdmUgb3VyIHByb2Nlc3NvciBwYXJhbWV0ZXJzLiAqLwogICAgIGlmICgg
IXNtcF9zdG9yZV9jcHVfaW5mbyhjcHUpICkKQEAgLTExNjUsNyArMTE2NSw3IEBAIHZvaWQgX19p
bml0IHNtcF9wcmVwYXJlX2NwdXModm9pZCkKICAgICB2ZXJpZnlfbG9jYWxfQVBJQygpOwogCiAg
ICAgY29ubmVjdF9ic3BfQVBJQygpOwotICAgIHNldHVwX2xvY2FsX0FQSUMoKTsKKyAgICBzZXR1
cF9sb2NhbF9BUElDKHRydWUpOwogCiAgICAgaWYgKCAhc2tpcF9pb2FwaWNfc2V0dXAgJiYgbnJf
aW9hcGljcyApCiAgICAgICAgIHNldHVwX0lPX0FQSUMoKTsKLS0tIGEveGVuL2luY2x1ZGUvYXNt
LXg4Ni9hcGljLmgKKysrIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9hcGljLmgKQEAgLTE2OSw3ICsx
NjksNyBAQCBleHRlcm4gaW50IHZlcmlmeV9sb2NhbF9BUElDICh2b2lkKTsKIGV4dGVybiB2b2lk
IGNhY2hlX0FQSUNfcmVnaXN0ZXJzICh2b2lkKTsKIGV4dGVybiB2b2lkIHN5bmNfQXJiX0lEcyAo
dm9pZCk7CiBleHRlcm4gdm9pZCBpbml0X2JzcF9BUElDICh2b2lkKTsKLWV4dGVybiB2b2lkIHNl
dHVwX2xvY2FsX0FQSUMgKHZvaWQpOworZXh0ZXJuIHZvaWQgc2V0dXBfbG9jYWxfQVBJQyhib29s
IGJzcCk7CiBleHRlcm4gdm9pZCBpbml0X2FwaWNfbWFwcGluZ3MgKHZvaWQpOwogZXh0ZXJuIHZv
aWQgc21wX2xvY2FsX3RpbWVyX2ludGVycnVwdCAoc3RydWN0IGNwdV91c2VyX3JlZ3MgKnJlZ3Mp
OwogZXh0ZXJuIHZvaWQgc2V0dXBfYm9vdF9BUElDX2Nsb2NrICh2b2lkKTsKCgpfX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBs
aXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2pl
Y3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

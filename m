Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 6834A87D94
	for <lists+xen-devel@lfdr.de>; Fri,  9 Aug 2019 17:03:29 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hw6M6-0006iU-Mt; Fri, 09 Aug 2019 14:58:58 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=yG4W=WF=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1hw6M0-0006YS-Ga
 for xen-devel@lists.xenproject.org; Fri, 09 Aug 2019 14:58:52 +0000
X-Inumbo-ID: 32cc028f-bab6-11e9-8980-bc764e045a96
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 32cc028f-bab6-11e9-8980-bc764e045a96;
 Fri, 09 Aug 2019 14:58:51 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id B9C04B077;
 Fri,  9 Aug 2019 14:58:50 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Fri,  9 Aug 2019 16:58:21 +0200
Message-Id: <20190809145833.1020-37-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190809145833.1020-1-jgross@suse.com>
References: <20190809145833.1020-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v2 36/48] xen/sched: make vcpu_wake() and
 vcpu_sleep() core scheduling aware
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Tim Deegan <tim@xen.org>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Dario Faggioli <dfaggioli@suse.com>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

dmNwdV93YWtlKCkgYW5kIHZjcHVfc2xlZXAoKSBuZWVkIHRvIGJlIG1hZGUgY29yZSBzY2hlZHVs
aW5nIGF3YXJlOgp0aGV5IG1pZ2h0IG5lZWQgdG8gc3dpdGNoIGEgc2luZ2xlIHZjcHUgb2YgYW4g
YWxyZWFkeSBzY2hlZHVsZWQgdW5pdApiZXR3ZWVuIHJ1bm5pbmcgYW5kIG5vdCBydW5uaW5nLgoK
RXNwZWNpYWxseSB3aGVuIHZjcHVfc2xlZXAoKSBmb3IgYSB2Y3B1IGlzIGJlaW5nIGNhbGxlZCBi
eSBhIHZjcHUgb2YKdGhlIHNhbWUgc2NoZWR1bGluZyB1bml0IHNwZWNpYWwgY2FyZSBtdXN0IGJl
IHRha2VuIGluIG9yZGVyIHRvIGF2b2lkCmEgZGVhZGxvY2s6IHRoZSB2Y3B1IHRvIGJlIHB1dCBh
c2xlZXAgbXVzdCBiZSBmb3JjZWQgdGhyb3VnaCBhCmNvbnRleHQgc3dpdGNoIHdpdGhvdXQgZG9p
bmcgc28gZm9yIHRoZSBjYWxsaW5nIHZjcHUuIEZvciB0aGlzCnB1cnBvc2UgYWRkIGEgdmNwdSBm
bGFnIGhhbmRsZWQgaW4gc2NoZWRfc2xhdmUoKSBhbmQgaW4Kc2NoZWRfd2FpdF9yZW5kZXp2b3Vz
X2luKCkgYWxsb3dpbmcgYSB2Y3B1IG9mIHRoZSBjdXJyZW50bHkgcnVubmluZwp1bml0IHRvIHN3
aXRjaCBzdGF0ZSBhdCBhIGhpZ2hlciBwcmlvcml0eSB0aGFuIGEgbm9ybWFsIHNjaGVkdWxlCmV2
ZW50LgoKVXNlIHRoZSBzYW1lIG1lY2hhbmlzbSB3aGVuIHdha2luZyB1cCBhIHZjcHUgb2YgYSBj
dXJyZW50bHkgYWN0aXZlCnVuaXQuCgpXaGlsZSBhdCBpdCBtYWtlIHZjcHVfc2xlZXBfbm9zeW5j
X2xvY2tlZCgpIHN0YXRpYyBhcyBpdCBpcyB1c2VkIGluCnNjaGVkdWxlLmMgb25seS4KClNpZ25l
ZC1vZmYtYnk6IEp1ZXJnZW4gR3Jvc3MgPGpncm9zc0BzdXNlLmNvbT4KLS0tClJGQyBWMjogYWRk
IHZjcHVfc2xlZXAoKSBoYW5kbGluZyBhbmQgZm9yY2VfY29udGV4dF9zd2l0Y2ggZmxhZwpWMjog
Zml4IHJ1bnN0YXRlIGNoYW5nZSBpbiBzY2hlZF9mb3JjZV9jb250ZXh0X3N3aXRjaCgpCi0tLQog
eGVuL2NvbW1vbi9zY2hlZHVsZS5jICAgICAgfCAxMjUgKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrLS0tCiB4ZW4vaW5jbHVkZS94ZW4vc2NoZWQtaWYuaCB8ICAgOSAr
Ky0tCiB4ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaCAgICB8ICAgMiArCiAzIGZpbGVzIGNoYW5nZWQs
IDEyNyBpbnNlcnRpb25zKCspLCA5IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3hlbi9jb21t
b24vc2NoZWR1bGUuYyBiL3hlbi9jb21tb24vc2NoZWR1bGUuYwppbmRleCA1Y2Q3ZDJkODU3Li5m
ZTdhYjFiNGRlIDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL3NjaGVkdWxlLmMKKysrIGIveGVuL2Nv
bW1vbi9zY2hlZHVsZS5jCkBAIC03MTQsOCArNzE0LDEwIEBAIHZvaWQgc2NoZWRfZGVzdHJveV9k
b21haW4oc3RydWN0IGRvbWFpbiAqZCkKICAgICB9CiB9CiAKLXZvaWQgdmNwdV9zbGVlcF9ub3N5
bmNfbG9ja2VkKHN0cnVjdCB2Y3B1ICp2KQorc3RhdGljIHZvaWQgdmNwdV9zbGVlcF9ub3N5bmNf
bG9ja2VkKHN0cnVjdCB2Y3B1ICp2KQogeworICAgIHN0cnVjdCBzY2hlZF91bml0ICp1bml0ID0g
di0+c2NoZWRfdW5pdDsKKwogICAgIEFTU0VSVChzcGluX2lzX2xvY2tlZChnZXRfc2NoZWRfcmVz
KHYtPnByb2Nlc3NvciktPnNjaGVkdWxlX2xvY2spKTsKIAogICAgIGlmICggbGlrZWx5KCF2Y3B1
X3J1bm5hYmxlKHYpKSApCkBAIC03MjMsNyArNzI1LDE0IEBAIHZvaWQgdmNwdV9zbGVlcF9ub3N5
bmNfbG9ja2VkKHN0cnVjdCB2Y3B1ICp2KQogICAgICAgICBpZiAoIHYtPnJ1bnN0YXRlLnN0YXRl
ID09IFJVTlNUQVRFX3J1bm5hYmxlICkKICAgICAgICAgICAgIHZjcHVfcnVuc3RhdGVfY2hhbmdl
KHYsIFJVTlNUQVRFX29mZmxpbmUsIE5PVygpKTsKIAotICAgICAgICBzY2hlZF9zbGVlcCh2Y3B1
X3NjaGVkdWxlcih2KSwgdi0+c2NoZWRfdW5pdCk7CisgICAgICAgIGlmICggbGlrZWx5KCF1bml0
X3J1bm5hYmxlKHVuaXQpKSApCisgICAgICAgICAgICBzY2hlZF9zbGVlcCh2Y3B1X3NjaGVkdWxl
cih2KSwgdW5pdCk7CisgICAgICAgIGVsc2UgaWYgKCB1bml0X3J1bm5pbmcodW5pdCkgPiAxICYm
IHYtPmlzX3J1bm5pbmcgJiYKKyAgICAgICAgICAgICAgICAgICF2LT5mb3JjZV9jb250ZXh0X3N3
aXRjaCApCisgICAgICAgIHsKKyAgICAgICAgICAgIHYtPmZvcmNlX2NvbnRleHRfc3dpdGNoID0g
dHJ1ZTsKKyAgICAgICAgICAgIGNwdV9yYWlzZV9zb2Z0aXJxKHYtPnByb2Nlc3NvciwgU0NIRURf
U0xBVkVfU09GVElSUSk7CisgICAgICAgIH0KICAgICB9CiB9CiAKQEAgLTc1NSwxNiArNzY0LDIy
IEBAIHZvaWQgdmNwdV93YWtlKHN0cnVjdCB2Y3B1ICp2KQogewogICAgIHVuc2lnbmVkIGxvbmcg
ZmxhZ3M7CiAgICAgc3BpbmxvY2tfdCAqbG9jazsKKyAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5p
dCA9IHYtPnNjaGVkX3VuaXQ7CiAKICAgICBUUkFDRV8yRChUUkNfU0NIRURfV0FLRSwgdi0+ZG9t
YWluLT5kb21haW5faWQsIHYtPnZjcHVfaWQpOwogCi0gICAgbG9jayA9IHVuaXRfc2NoZWR1bGVf
bG9ja19pcnFzYXZlKHYtPnNjaGVkX3VuaXQsICZmbGFncyk7CisgICAgbG9jayA9IHVuaXRfc2No
ZWR1bGVfbG9ja19pcnFzYXZlKHVuaXQsICZmbGFncyk7CiAKICAgICBpZiAoIGxpa2VseSh2Y3B1
X3J1bm5hYmxlKHYpKSApCiAgICAgewogICAgICAgICBpZiAoIHYtPnJ1bnN0YXRlLnN0YXRlID49
IFJVTlNUQVRFX2Jsb2NrZWQgKQogICAgICAgICAgICAgdmNwdV9ydW5zdGF0ZV9jaGFuZ2Uodiwg
UlVOU1RBVEVfcnVubmFibGUsIE5PVygpKTsKLSAgICAgICAgc2NoZWRfd2FrZSh2Y3B1X3NjaGVk
dWxlcih2KSwgdi0+c2NoZWRfdW5pdCk7CisgICAgICAgIHNjaGVkX3dha2UodmNwdV9zY2hlZHVs
ZXIodiksIHVuaXQpOworICAgICAgICBpZiAoIHVuaXQtPmlzX3J1bm5pbmcgJiYgIXYtPmlzX3J1
bm5pbmcgJiYgIXYtPmZvcmNlX2NvbnRleHRfc3dpdGNoICkKKyAgICAgICAgeworICAgICAgICAg
ICAgdi0+Zm9yY2VfY29udGV4dF9zd2l0Y2ggPSB0cnVlOworICAgICAgICAgICAgY3B1X3JhaXNl
X3NvZnRpcnEodi0+cHJvY2Vzc29yLCBTQ0hFRF9TTEFWRV9TT0ZUSVJRKTsKKyAgICAgICAgfQog
ICAgIH0KICAgICBlbHNlIGlmICggISh2LT5wYXVzZV9mbGFncyAmIFZQRl9ibG9ja2VkKSApCiAg
ICAgewpAQCAtNzcyLDcgKzc4Nyw3IEBAIHZvaWQgdmNwdV93YWtlKHN0cnVjdCB2Y3B1ICp2KQog
ICAgICAgICAgICAgdmNwdV9ydW5zdGF0ZV9jaGFuZ2UodiwgUlVOU1RBVEVfb2ZmbGluZSwgTk9X
KCkpOwogICAgIH0KIAotICAgIHVuaXRfc2NoZWR1bGVfdW5sb2NrX2lycXJlc3RvcmUobG9jaywg
ZmxhZ3MsIHYtPnNjaGVkX3VuaXQpOworICAgIHVuaXRfc2NoZWR1bGVfdW5sb2NrX2lycXJlc3Rv
cmUobG9jaywgZmxhZ3MsIHVuaXQpOwogfQogCiB2b2lkIHZjcHVfdW5ibG9jayhzdHJ1Y3QgdmNw
dSAqdikKQEAgLTE5ODEsNiArMTk5Niw2MiBAQCBzdGF0aWMgdm9pZCBzY2hlZF9jb250ZXh0X3N3
aXRjaChzdHJ1Y3QgdmNwdSAqdnByZXYsIHN0cnVjdCB2Y3B1ICp2bmV4dCwKICAgICBjb250ZXh0
X3N3aXRjaCh2cHJldiwgdm5leHQpOwogfQogCisvKgorICogRm9yY2UgYSBjb250ZXh0IHN3aXRj
aCBvZiBhIHNpbmdsZSB2Y3B1IG9mIGFuIHVuaXQuCisgKiBNaWdodCBiZSBjYWxsZWQgZWl0aGVy
IGlmIGEgdmNwdSBvZiBhbiBhbHJlYWR5IHJ1bm5pbmcgdW5pdCBpcyB3b2tlbiB1cAorICogb3Ig
aWYgYSB2Y3B1IG9mIGEgcnVubmluZyB1bml0IGlzIHB1dCBhc2xlZXAgd2l0aCBvdGhlciB2Y3B1
cyBvZiB0aGUgc2FtZQorICogdW5pdCBzdGlsbCBydW5uaW5nLgorICovCitzdGF0aWMgc3RydWN0
IHZjcHUgKnNjaGVkX2ZvcmNlX2NvbnRleHRfc3dpdGNoKHN0cnVjdCB2Y3B1ICp2cHJldiwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHZjcHUg
KnYsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBj
cHUsIHNfdGltZV90IG5vdykKK3sKKyAgICB2LT5mb3JjZV9jb250ZXh0X3N3aXRjaCA9IGZhbHNl
OworCisgICAgaWYgKCB2Y3B1X3J1bm5hYmxlKHYpID09IHYtPmlzX3J1bm5pbmcgKQorICAgICAg
ICByZXR1cm4gTlVMTDsKKworICAgIGlmICggdmNwdV9ydW5uYWJsZSh2KSApCisgICAgeworICAg
ICAgICBpZiAoIGlzX2lkbGVfdmNwdSh2cHJldikgKQorICAgICAgICB7CisgICAgICAgICAgICB2
Y3B1X3J1bnN0YXRlX2NoYW5nZSh2cHJldiwgUlVOU1RBVEVfcnVubmFibGUsIG5vdyk7CisgICAg
ICAgICAgICB2cHJldi0+c2NoZWRfdW5pdCA9IGdldF9zY2hlZF9yZXMoY3B1KS0+c2NoZWRfdW5p
dF9pZGxlOworICAgICAgICB9CisgICAgICAgIHZjcHVfcnVuc3RhdGVfY2hhbmdlKHYsIFJVTlNU
QVRFX3J1bm5pbmcsIG5vdyk7CisgICAgfQorICAgIGVsc2UKKyAgICB7CisgICAgICAgIC8qIE1h
a2Ugc3VyZSBub3QgdG8gc3dpdGNoIGxhc3QgdmNwdSBvZiBhbiB1bml0IGF3YXkuICovCisgICAg
ICAgIGlmICggdW5pdF9ydW5uaW5nKHYtPnNjaGVkX3VuaXQpID09IDEgKQorICAgICAgICAgICAg
cmV0dXJuIE5VTEw7CisKKyAgICAgICAgdi0+bmV3X3N0YXRlID0gdmNwdV9ydW5zdGF0ZV9ibG9j
a2VkKHYpOworICAgICAgICB2Y3B1X3J1bnN0YXRlX2NoYW5nZSh2LCB2LT5uZXdfc3RhdGUsIG5v
dyk7CisgICAgICAgIHYgPSBzY2hlZF91bml0MnZjcHVfY3B1KHZwcmV2LT5zY2hlZF91bml0LCBj
cHUpOworICAgICAgICBpZiAoIHYgIT0gdnByZXYgKQorICAgICAgICB7CisgICAgICAgICAgICBp
ZiAoIGlzX2lkbGVfdmNwdSh2cHJldikgKQorICAgICAgICAgICAgeworICAgICAgICAgICAgICAg
IHZjcHVfcnVuc3RhdGVfY2hhbmdlKHZwcmV2LCBSVU5TVEFURV9ydW5uYWJsZSwgbm93KTsKKyAg
ICAgICAgICAgICAgICB2cHJldi0+c2NoZWRfdW5pdCA9IGdldF9zY2hlZF9yZXMoY3B1KS0+c2No
ZWRfdW5pdF9pZGxlOworICAgICAgICAgICAgfQorICAgICAgICAgICAgZWxzZQorICAgICAgICAg
ICAgeworICAgICAgICAgICAgICAgIHYtPnNjaGVkX3VuaXQgPSB2cHJldi0+c2NoZWRfdW5pdDsK
KyAgICAgICAgICAgICAgICB2Y3B1X3J1bnN0YXRlX2NoYW5nZSh2LCBSVU5TVEFURV9ydW5uaW5n
LCBub3cpOworICAgICAgICAgICAgfQorICAgICAgICB9CisgICAgfQorCisgICAgdi0+aXNfcnVu
bmluZyA9IDE7CisKKyAgICAvKiBNYWtlIHN1cmUgbm90IHRvIGxvb3NlIGFub3RoZXIgc2xhdmUg
Y2FsbC4gKi8KKyAgICByYWlzZV9zb2Z0aXJxKFNDSEVEX1NMQVZFX1NPRlRJUlEpOworCisgICAg
cmV0dXJuIHY7Cit9CisKIC8qCiAgKiBSZW5kZXp2b3VzIGJlZm9yZSB0YWtpbmcgYSBzY2hlZHVs
aW5nIGRlY2lzaW9uLgogICogQ2FsbGVkIHdpdGggc2NoZWR1bGUgbG9jayBoZWxkLCBzbyBhbGwg
YWNjZXNzZXMgdG8gdGhlIHJlbmRlenZvdXMgY291bnRlcgpAQCAtMTk5Niw2ICsyMDY3LDcgQEAg
c3RhdGljIHN0cnVjdCBzY2hlZF91bml0ICpzY2hlZF93YWl0X3JlbmRlenZvdXNfaW4oc3RydWN0
IHNjaGVkX3VuaXQgKnByZXYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBzX3RpbWVfdCBub3cpCiB7CiAgICAgc3RydWN0IHNjaGVkX3VuaXQgKm5l
eHQ7CisgICAgc3RydWN0IHZjcHUgKnY7CiAKICAgICBpZiAoICEtLXByZXYtPnJlbmRlenZvdXNf
aW5fY250ICkKICAgICB7CkBAIC0yMDA0LDggKzIwNzYsMjggQEAgc3RhdGljIHN0cnVjdCBzY2hl
ZF91bml0ICpzY2hlZF93YWl0X3JlbmRlenZvdXNfaW4oc3RydWN0IHNjaGVkX3VuaXQgKnByZXYs
CiAgICAgICAgIHJldHVybiBuZXh0OwogICAgIH0KIAorICAgIHYgPSB1bml0MnZjcHVfY3B1KHBy
ZXYsIGNwdSk7CiAgICAgd2hpbGUgKCBwcmV2LT5yZW5kZXp2b3VzX2luX2NudCApCiAgICAgewor
ICAgICAgICBpZiAoIHYgJiYgdi0+Zm9yY2VfY29udGV4dF9zd2l0Y2ggKQorICAgICAgICB7Cisg
ICAgICAgICAgICBzdHJ1Y3QgdmNwdSAqdnByZXYgPSBjdXJyZW50OworCisgICAgICAgICAgICB2
ID0gc2NoZWRfZm9yY2VfY29udGV4dF9zd2l0Y2godnByZXYsIHYsIGNwdSwgbm93KTsKKworICAg
ICAgICAgICAgaWYgKCB2ICkKKyAgICAgICAgICAgIHsKKyAgICAgICAgICAgICAgICAvKiBXZSds
bCBjb21lIGJhY2sgYW5vdGhlciB0aW1lLCBzbyBhZGp1c3QgcmVuZGV6dm91c19pbl9jbnQuICov
CisgICAgICAgICAgICAgICAgcHJldi0+cmVuZGV6dm91c19pbl9jbnQrKzsKKyAgICAgICAgICAg
ICAgICBhdG9taWNfc2V0KCZwcmV2LT5yZW5kZXp2b3VzX291dF9jbnQsIDApOworCisgICAgICAg
ICAgICAgICAgcGNwdV9zY2hlZHVsZV91bmxvY2tfaXJxKCpsb2NrLCBjcHUpOworCisgICAgICAg
ICAgICAgICAgc2NoZWRfY29udGV4dF9zd2l0Y2godnByZXYsIHYsIGZhbHNlLCBub3cpOworICAg
ICAgICAgICAgfQorCisgICAgICAgICAgICB2ID0gdW5pdDJ2Y3B1X2NwdShwcmV2LCBjcHUpOwor
ICAgICAgICB9CiAgICAgICAgIC8qCiAgICAgICAgICAqIENvbWluZyBmcm9tIGlkbGUgbWlnaHQg
bmVlZCB0byBkbyB0YXNrbGV0IHdvcmsuCiAgICAgICAgICAqIEluIG9yZGVyIHRvIGF2b2lkIGRl
YWRsb2NrcyB3ZSBjYW4ndCBkbyB0aGF0IGhlcmUsIGJ1dCBoYXZlIHRvCkBAIC0yMDM4LDEwICsy
MTMwLDExIEBAIHN0YXRpYyBzdHJ1Y3Qgc2NoZWRfdW5pdCAqc2NoZWRfd2FpdF9yZW5kZXp2b3Vz
X2luKHN0cnVjdCBzY2hlZF91bml0ICpwcmV2LAogCiBzdGF0aWMgdm9pZCBzY2hlZF9zbGF2ZSh2
b2lkKQogewotICAgIHN0cnVjdCB2Y3B1ICAgICAgICAgICp2cHJldiA9IGN1cnJlbnQ7CisgICAg
c3RydWN0IHZjcHUgICAgICAgICAgKnYsICp2cHJldiA9IGN1cnJlbnQ7CiAgICAgc3RydWN0IHNj
aGVkX3VuaXQgICAgKnByZXYgPSB2cHJldi0+c2NoZWRfdW5pdCwgKm5leHQ7CiAgICAgc190aW1l
X3QgICAgICAgICAgICAgIG5vdzsKICAgICBzcGlubG9ja190ICAgICAgICAgICAqbG9jazsKKyAg
ICBib29sICAgICAgICAgICAgICAgICAgZG9fc29mdGlycSA9IGZhbHNlOwogICAgIGludCBjcHUg
PSBzbXBfcHJvY2Vzc29yX2lkKCk7CiAKICAgICBBU1NFUlRfTk9UX0lOX0FUT01JQygpOwpAQCAt
MjA1MCw5ICsyMTQzLDI5IEBAIHN0YXRpYyB2b2lkIHNjaGVkX3NsYXZlKHZvaWQpCiAKICAgICBu
b3cgPSBOT1coKTsKIAorICAgIHYgPSB1bml0MnZjcHVfY3B1KHByZXYsIGNwdSk7CisgICAgaWYg
KCB2ICYmIHYtPmZvcmNlX2NvbnRleHRfc3dpdGNoICkKKyAgICB7CisgICAgICAgIHYgPSBzY2hl
ZF9mb3JjZV9jb250ZXh0X3N3aXRjaCh2cHJldiwgdiwgY3B1LCBub3cpOworCisgICAgICAgIGlm
ICggdiApCisgICAgICAgIHsKKyAgICAgICAgICAgIHBjcHVfc2NoZWR1bGVfdW5sb2NrX2lycShs
b2NrLCBjcHUpOworCisgICAgICAgICAgICBzY2hlZF9jb250ZXh0X3N3aXRjaCh2cHJldiwgdiwg
ZmFsc2UsIG5vdyk7CisgICAgICAgIH0KKworICAgICAgICBkb19zb2Z0aXJxID0gdHJ1ZTsKKyAg
ICB9CisKICAgICBpZiAoICFwcmV2LT5yZW5kZXp2b3VzX2luX2NudCApCiAgICAgewogICAgICAg
ICBwY3B1X3NjaGVkdWxlX3VubG9ja19pcnEobG9jaywgY3B1KTsKKworICAgICAgICAvKiBDaGVj
ayBmb3IgZmFpbGVkIGZvcmNlZCBjb250ZXh0IHN3aXRjaC4gKi8KKyAgICAgICAgaWYgKCBkb19z
b2Z0aXJxICkKKyAgICAgICAgICAgIHJhaXNlX3NvZnRpcnEoU0NIRURVTEVfU09GVElSUSk7CisK
ICAgICAgICAgcmV0dXJuOwogICAgIH0KIApkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUveGVuL3Nj
aGVkLWlmLmggYi94ZW4vaW5jbHVkZS94ZW4vc2NoZWQtaWYuaAppbmRleCAzYWM3NzU3YzBkLi5l
YjZiOWVmNTVjIDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQtaWYuaAorKysgYi94
ZW4vaW5jbHVkZS94ZW4vc2NoZWQtaWYuaApAQCAtOTksNiArOTksMTEgQEAgc3RhdGljIGlubGlu
ZSBib29sIHVuaXRfcnVubmFibGUoY29uc3Qgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiAgICAg
cmV0dXJuIGZhbHNlOwogfQogCitzdGF0aWMgaW5saW5lIGludCB2Y3B1X3J1bnN0YXRlX2Jsb2Nr
ZWQoc3RydWN0IHZjcHUgKnYpCit7CisgICAgcmV0dXJuICh2LT5wYXVzZV9mbGFncyAmIFZQRl9i
bG9ja2VkKSA/IFJVTlNUQVRFX2Jsb2NrZWQgOiBSVU5TVEFURV9vZmZsaW5lOworfQorCiBzdGF0
aWMgaW5saW5lIGJvb2wgdW5pdF9ydW5uYWJsZV9zdGF0ZShjb25zdCBzdHJ1Y3Qgc2NoZWRfdW5p
dCAqdW5pdCkKIHsKICAgICBzdHJ1Y3QgdmNwdSAqdjsKQEAgLTExMSw5ICsxMTYsNyBAQCBzdGF0
aWMgaW5saW5lIGJvb2wgdW5pdF9ydW5uYWJsZV9zdGF0ZShjb25zdCBzdHJ1Y3Qgc2NoZWRfdW5p
dCAqdW5pdCkKICAgICB7CiAgICAgICAgIHJ1bm5hYmxlID0gdmNwdV9ydW5uYWJsZSh2KTsKIAot
ICAgICAgICB2LT5uZXdfc3RhdGUgPSBydW5uYWJsZSA/IFJVTlNUQVRFX3J1bm5pbmcKLSAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAodi0+cGF1c2VfZmxhZ3MgJiBWUEZfYmxvY2tl
ZCkKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IFJVTlNUQVRFX2Jsb2NrZWQg
OiBSVU5TVEFURV9vZmZsaW5lOworICAgICAgICB2LT5uZXdfc3RhdGUgPSBydW5uYWJsZSA/IFJV
TlNUQVRFX3J1bm5pbmcgOiB2Y3B1X3J1bnN0YXRlX2Jsb2NrZWQodik7CiAKICAgICAgICAgaWYg
KCBydW5uYWJsZSApCiAgICAgICAgICAgICByZXQgPSB0cnVlOwpkaWZmIC0tZ2l0IGEveGVuL2lu
Y2x1ZGUveGVuL3NjaGVkLmggYi94ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaAppbmRleCBlZDA1MzU5
NDZmLi5lODY4NjQ2ZjBlIDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaAorKysg
Yi94ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaApAQCAtMTg2LDYgKzE4Niw4IEBAIHN0cnVjdCB2Y3B1
CiAgICAgYm9vbCAgICAgICAgICAgICBpc19ydW5uaW5nOwogICAgIC8qIFZDUFUgc2hvdWxkIHdh
a2UgZmFzdCAoZG8gbm90IGRlZXAgc2xlZXAgdGhlIENQVSkuICovCiAgICAgYm9vbCAgICAgICAg
ICAgICBpc191cmdlbnQ7CisgICAgLyogVkNQVSBtdXN0IGNvbnRleHRfc3dpdGNoIHdpdGhvdXQg
c2NoZWR1bGluZyB1bml0LiAqLworICAgIGJvb2wgICAgICAgICAgICAgZm9yY2VfY29udGV4dF9z
d2l0Y2g7CiAKICNpZmRlZiBWQ1BVX1RSQVBfTEFTVAogI2RlZmluZSBWQ1BVX1RSQVBfTk9ORSAg
ICAwCi0tIAoyLjE2LjQKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0
Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRl
dmVs

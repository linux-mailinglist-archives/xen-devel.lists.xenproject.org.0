Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id E9EA218A9B1
	for <lists+xen-devel@lfdr.de>; Thu, 19 Mar 2020 01:16:09 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1jEin1-0006hX-P7; Thu, 19 Mar 2020 00:11:59 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=qcPS=5E=gmail.com=raistlin.df@srs-us1.protection.inumbo.net>)
 id 1jEimz-0006gi-Mq
 for xen-devel@lists.xenproject.org; Thu, 19 Mar 2020 00:11:57 +0000
X-Inumbo-ID: 3e0c1124-6976-11ea-bba2-12813bfff9fa
Received: from mail-wm1-f66.google.com (unknown [209.85.128.66])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 3e0c1124-6976-11ea-bba2-12813bfff9fa;
 Thu, 19 Mar 2020 00:11:56 +0000 (UTC)
Received: by mail-wm1-f66.google.com with SMTP id c187so175142wme.1
 for <xen-devel@lists.xenproject.org>; Wed, 18 Mar 2020 17:11:56 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:subject:from:to:cc:date:message-id:in-reply-to
 :references:user-agent:mime-version:content-transfer-encoding;
 bh=y1kRVxDY+nl7SvNgqvrXz449PSZNYDfGzpNCJISLgjk=;
 b=Ig+2538wIaZo/Z8TkUbwt0Zt7AuiP98l0F+tBK8TRFTsQILMjLbPRX5q6ic44xpa8z
 QhLopQIgT6Kop/He/SPgrsl3KsgZYRoOfBdOBJ9DlZxJX1Z3ajvrsty/hboiq6KchsMP
 BxhOyOnDzh70hTQaJBFrxTwOqV74jy/7nfHVNhEnYVMw32RMQum5xj7plge6YJaB4Qq+
 5PzjazEJMNDCom2efZ4njiIpLqlwSPZbhqL0cpTNlBri7hz2XARSbaoY71wjjI8W3Jgk
 NOqGnqg9fu1y0WvQhvoJNj1hqJNqQrJfoZgXJdfGCItJyFad1m/7AjHE0/gCI3ipRAW/
 IqlA==
X-Gm-Message-State: ANhLgQ0L2L+K3yOJAmWQN9cmDacCtud/GwnTSOAMsnO+ahxoiEEPgW7P
 W/TX0hP1bE87XTnFDF0/go0=
X-Google-Smtp-Source: ADFU+vtV5NRKGFQMtR74+Ce8BjPV7ZH0A/WuSpC/IdBwpZtCfBu7+QN7fDIvcH/jq9bIREtAhzI7xQ==
X-Received: by 2002:a1c:bb86:: with SMTP id l128mr264938wmf.41.1584576715144; 
 Wed, 18 Mar 2020 17:11:55 -0700 (PDT)
Received: from [192.168.0.36] (87.78.186.89.cust.ip.kpnqwest.it.
 [89.186.78.87])
 by smtp.gmail.com with ESMTPSA id k3sm605947wmf.16.2020.03.18.17.11.54
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Wed, 18 Mar 2020 17:11:54 -0700 (PDT)
From: Dario Faggioli <dfaggioli@suse.com>
To: xen-devel@lists.xenproject.org
Date: Thu, 19 Mar 2020 01:11:53 +0100
Message-ID: <158457671301.11355.1086453211878144633.stgit@Palanthas>
In-Reply-To: <158457508246.11355.6457403441669388939.stgit@Palanthas>
References: <158457508246.11355.6457403441669388939.stgit@Palanthas>
User-Agent: StGit/0.21
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v2 1/2] xen: credit2: avoid vCPUs to ever reach
 lower credits than idle
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Charles Arnold <carnold@suse.com>,
 Tomas Mozes <hydrapolic@gmail.com>, Glen <glenbarney@gmail.com>,
 George Dunlap <george.dunlap@citrix.com>, Jan Beulich <jbeulich@suse.com>,
 Sarah Newman <srn@prgmr.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhlcmUgaGF2ZSBiZWVuIHJlcG9ydCBvZiBzdGFsbHMgb2YgZ3Vlc3QgdkNQVXMsIHdoZW4gQ3Jl
ZGl0MiB3YXMgdXNlZC4KSXQgc2VlbWVkIGxpa2UgdGhlc2UgdkNQVXMgd2VyZSBub3QgZ2V0dGlu
ZyBzY2hlZHVsZWQgZm9yIHZlcnkgbG9uZwp0aW1lLCBldmVuIHVuZGVyIGxpZ2h0IGxvYWQgY29u
ZGl0aW9ucyAoZS5nLiwgZHVyaW5nIGRvbTAgYm9vdCkuCgpJbnZlc3RpZ2F0aW9ucyBsZWQgdG8g
dGhlIGRpc2NvdmVyeSB0aGF0IC0tYWx0aG91Z2ggcmFyZWx5LS0gaXQgY2FuCmhhcHBlbiB0aGF0
IGEgdkNQVSBtYW5hZ2VzIHRvIHJ1biBmb3IgdmVyeSBsb25nIHRpbWVzbGljZXMuIEluIENyZWRp
dDIsCnRoaXMgbWVhbnMgdGhhdCwgd2hlbiBydW50aW1lIGFjY291bnRpbmcgaGFwcGVucywgdGhl
IHZDUFUgd2lsbCBsb3NlIGEKbGFyZ2UgcXVhbnRpdHkgb2YgY3JlZGl0cy4gVGhpcyBpbiB0dXJu
IG1heSBsZWFkIHRvIHRoZSB2Q1BVIGhhdmluZyBsZXNzCmNyZWRpdHMgdGhhbiB0aGUgaWRsZSB2
Q1BVcyAoLTJeMzApLiBBdCB0aGlzIHBvaW50LCB0aGUgc2NoZWR1bGVyIHdpbGwKcGljayB0aGUg
aWRsZSB2Q1BVLCBpbnN0ZWFkIG9mIHRoZSByZWFkeSB0byBydW4gdkNQVSwgZm9yIGEgZmV3CiJl
cG9jaHMiLCB3aGljaCBvZnRlbiB0aW1lcyBpcyBlbm91Z2ggZm9yIHRoZSBndWVzdCBrZXJuZWwg
dG8gdGhpbmsgdGhlCnZDUFUgaXMgbm90IHJlc3BvbmRpbmcgYW5kIGNyYXNoaW5nLgoKQW4gZXhh
bXBsZSBvZiB0aGlzIHNpdHVhdGlvbiBpcyBzaG93biBoZXJlLiBJbiBmYWN0LCB3ZSBjYW4gc2Vl
IGQwdjEKc2l0dGluZyBpbiB0aGUgcnVucXVldWUgd2hpbGUgYWxsIHRoZSBDUFVzIGFyZSBpZGxl
LCBhcyBpdCBoYXMKLTEyNTQyMzgyNzAgY3JlZGl0cywgd2hpY2ggaXMgc21hbGxlciB0aGFuIC0y
XjMwID0g4oiSMTA3Mzc0MTgyNDoKCiAgICAoWEVOKSBSdW5xdWV1ZSAwOgogICAgKFhFTikgICBu
Y3B1cyAgICAgICAgICAgICAgPSAyOAogICAgKFhFTikgICBjcHVzICAgICAgICAgICAgICAgPSAw
LTI3CiAgICAoWEVOKSAgIG1heF93ZWlnaHQgICAgICAgICA9IDI1NgogICAgKFhFTikgICBwaWNr
X2JpYXMgICAgICAgICAgPSAyMgogICAgKFhFTikgICBpbnN0bG9hZCAgICAgICAgICAgPSAxCiAg
ICAoWEVOKSAgIGF2ZWxvYWQgICAgICAgICAgICA9IDI5MzM5MSAofjExMSUpCiAgICAoWEVOKSAg
IGlkbGVyczogMDAsMDAwMDAwMDAsMDAwMDAwMDAsMDAwMDAwMDAsMDAwMDAwMDAsMDAwMDAwMDAs
MGZmZmZmZmYKICAgIChYRU4pICAgdGlja2xlZDogMDAsMDAwMDAwMDAsMDAwMDAwMDAsMDAwMDAw
MDAsMDAwMDAwMDAsMDAwMDAwMDAsMDAwMDAwMDAKICAgIChYRU4pICAgZnVsbHkgaWRsZSBjb3Jl
czogMDAsMDAwMDAwMDAsMDAwMDAwMDAsMDAwMDAwMDAsMDAwMDAwMDAsMDAwMDAwMDAsMGZmZmZm
ZmYKICAgIFsuLi5dCiAgICAoWEVOKSBSdW5xdWV1ZSAwOgogICAgKFhFTikgQ1BVWzAwXSBydW5x
PTAsIHNpYmxpbmc9MDAsLi4uLCBjb3JlPTAwLC4uLgogICAgKFhFTikgQ1BVWzAxXSBydW5xPTAs
IHNpYmxpbmc9MDAsLi4uLCBjb3JlPTAwLC4uLgogICAgWy4uLl0KICAgIChYRU4pIENQVVsyNl0g
cnVucT0wLCBzaWJsaW5nPTAwLC4uLiwgY29yZT0wMCwuLi4KICAgIChYRU4pIENQVVsyN10gcnVu
cT0wLCBzaWJsaW5nPTAwLC4uLiwgY29yZT0wMCwuLi4KICAgIChYRU4pIFJVTlE6CiAgICAoWEVO
KSAgICAgMDogWzAuMV0gZmxhZ3M9MCBjcHU9NSBjcmVkaXQ9LTEyNTQyMzgyNzAgW3c9MjU2XSBs
b2FkPTI2MjE0NCAofjEwMCUpCgpXZSBjZXJ0YWlubHkgZG9uJ3Qgd2FudCwgdW5kZXIgYW55IGNp
cmN1bXN0YW5jZSwgdGhpcyB0byBoYXBwZW4uCkxldCdzLCB0aGVyZWZvcmUsIGRlZmluZSBhIG1p
bmltdW0gYW1vdW50IG9mIGNyZWRpdHMgYSB2Q1BVIGNhbiBoYXZlLgpEdXJpbmcgYWNjb3VudGlu
Zywgd2UgbWFrZSBzdXJlIHRoYXQsIGZvciBob3dldmVyIGxvbmcgdGhlIHZDUFUgaGFzCnJ1biwg
aXQgd2lsbCBuZXZlciBnZXQgdG8gaGF2ZSBsZXNzIHRoYW4gc3VjaCBtaW5pbXVtIGFtb3VudCBv
ZgpjcmVkaXRzLiBUaGVuLCB3ZSBzZXQgdGhlIGNyZWRpdHMgb2YgdGhlIGlkbGUgdkNQVSB0byBh
biBldmVuCnNtYWxsZXIgdmFsdWUuCgpOT1RFOiBpbnZlc3RpZ2F0aW9ucyBoYXZlIGJlZW4gZG9u
ZSBhYm91dCBfaG93XyBpdCBpcyBwb3NzaWJsZSBmb3IgYQp2Q1BVIHRvIGV4ZWN1dGUgZm9yIHNv
IG11Y2ggdGltZSB0aGF0IGl0cyBjcmVkaXRzIGJlY29tZXMgc28gbG93LiBXaGlsZQpzdGlsbCBu
b3QgY29tcGxldGVseSBjbGVhciwgdGhlcmUgYXJlIGV2aWRlbmNlIHRoYXQ6Ci0gaXQgb25seSBo
YXBwZW5zIHZlcnkgcmFyZWx5LAotIGl0IGFwcGVhcnMgdG8gYmUgYm90aCBtYWNoaW5lIGFuZCB3
b3JrbG9hZCBzcGVjaWZpYywKLSBpdCBkb2VzIG5vdCBsb29rIHRvIGJlIGEgQ3JlZGl0MiAoZS5n
LiwgYXMgaXQgaGFwcGVucyB3aGVuCiAgcnVubmluZyB3aXRoIENyZWRpdDEgYXMgd2VsbCkgaXNz
dWUsIG9yIGEgc2NoZWR1bGVyIGlzc3VlLgoKVGhpcyBwYXRjaCBtYWtlcyBDcmVkaXQyIG1vcmUg
cm9idXN0IHRvIGV2ZW50cyBsaWtlIHRoaXMsIHdoYXRldmVyCnRoZSBjYXVzZSBpcywgYW5kIHNo
b3VsZCBoZW5jZSBiZSBiYWNrcG9ydGVkIChhcyBmYXIgYXMgcG9zc2libGUpLgoKUmVwb3J0ZWQt
Ynk6IEdsZW4gPGdsZW5iYXJuZXlAZ21haWwuY29tPgpSZXBvcnRlZC1ieTogVG9tYXMgTW96ZXMg
PGh5ZHJhcG9saWNAZ21haWwuY29tPgpTaWduZWQtb2ZmLWJ5OiBEYXJpbyBGYWdnaW9saSA8ZGZh
Z2dpb2xpQHN1c2UuY29tPgotLS0KQ2M6IEdlb3JnZSBEdW5sYXAgPGdlb3JnZS5kdW5sYXBAY2l0
cml4LmNvbT4KQ2M6IEp1ZXJnZW4gR3Jvc3MgPGpncm9zc0BzdXNlLmNvbT4KQ2M6IEphbiBCZXVs
aWNoIDxqYmV1bGljaEBzdXNlLmNvbT4KQ2M6IENoYXJsZXMgQXJub2xkIDxjYXJub2xkQHN1c2Uu
Y29tPgpDYzogU2FyYWggTmV3bWFuIDxzcm5AcHJnbXIuY29tPgotLS0KQ2hhbmdlcyBmcm9tIHYx
OgotIGRpZmZlcmVudCBhcHByb2FjaC4gSW5zdGVhZCB0aGFuIHVzaW5nIElOVF9NSU4gZm9yIGlk
bGUgdkNQVXMnCiAgY3JlZGl0cywgbGltaXQgdGhlIG1pbmltdW0gbnVtYmVyIG9mIGNyZWRpdHMg
cmVndWxhciB2Q1BVcyBjYW4gaGF2ZS4KLS0tCkkgd2lsbCBwcm92aWRlIHRoZSBiYWNrcG9ydHMg
bXlzZWxmLCBhdCBsZWFzdCBmb3IgNC4xMyBhbmQgNC4xMi54IChhbmQKZmVlbCBmcmVlIHRvIGFz
ayBmb3IgbW9yZSkuCi0tLQpGb3IgU2FyYWgsIGxvb2tpbmcgYmFjayBhdCB0aGUgdmFyaW91cyB0
aHJlYWRzLCBJIGFtIG5vdCBxdWl0ZSBzdXJlCndoZXRoZXIgeW91IGFsc28gZXhwZXJpZW5jZWQg
dGhlIGlzc3VlIGFuZCByZXBvcnRlZCBpdC4gSWYgeWVzLCBJJ20KaGFwcHkgdG8gYWRkIGEgIlJl
cG9ydGVkLWJ5OiIgbGluZSBhYm91dCB5b3UgdG9vIChvciwgaWYgdGhpcyBpcyBmaW5lIHRvCmdv
IGluLCBmb3IgdGhpcyB0byBiZSBkb25lIHdoaWxlIGNvbW1pdHRpbmcsIGlmIHBvc3NpYmxlKS4K
LS0tCiB0b29scy94ZW50cmFjZS9mb3JtYXRzICAgICB8ICAgIDIgKy0KIHRvb2xzL3hlbnRyYWNl
L3hlbmFseXplLmMgIHwgICAgNSArKy0tCiB4ZW4vY29tbW9uL3NjaGVkL2NyZWRpdDIuYyB8ICAg
NTMgKysrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLS0tLS0KIDMgZmlsZXMg
Y2hhbmdlZCwgMzEgaW5zZXJ0aW9ucygrKSwgMjkgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEv
dG9vbHMveGVudHJhY2UvZm9ybWF0cyBiL3Rvb2xzL3hlbnRyYWNlL2Zvcm1hdHMKaW5kZXggZDZl
N2UzZjgwMC4uOGYxMjZmNjVmMSAxMDA2NDQKLS0tIGEvdG9vbHMveGVudHJhY2UvZm9ybWF0cwor
KysgYi90b29scy94ZW50cmFjZS9mb3JtYXRzCkBAIC01NSw3ICs1NSw3IEBACiAweDAwMDIyMjA0
ICBDUFUlKGNwdSlkICAlKHRzYylkICgrJShyZWx0c2MpOGQpICBjc2NoZWQyOmNyZWRpdF9hZGQK
IDB4MDAwMjIyMDUgIENQVSUoY3B1KWQgICUodHNjKWQgKCslKHJlbHRzYyk4ZCkgIGNzY2hlZDI6
dGlja2xlX2NoZWNrICAgWyBkb206dmNwdSA9IDB4JSgxKTA4eCwgY3JlZGl0ID0gJSgyKWQsIHNj
b3JlID0gJSgzKWQgXQogMHgwMDAyMjIwNiAgQ1BVJShjcHUpZCAgJSh0c2MpZCAoKyUocmVsdHNj
KThkKSAgY3NjaGVkMjp0aWNrbGUgICAgICAgICBbIGNwdSA9ICUoMSlkIF0KLTB4MDAwMjIyMDcg
IENQVSUoY3B1KWQgICUodHNjKWQgKCslKHJlbHRzYyk4ZCkgIGNzY2hlZDI6Y3JlZGl0X3Jlc2V0
ICAgWyBkb206dmNwdSA9IDB4JSgxKTA4eCwgY3Jfc3RhcnQgPSAlKDIpZCwgY3JfZW5kID0gJSgz
KWQsIG11bHQgPSAlKDQpZCBdCisweDAwMDIyMjA3ICBDUFUlKGNwdSlkICAlKHRzYylkICgrJShy
ZWx0c2MpOGQpICBjc2NoZWQyOmNyZWRpdF9yZXNldCAgIFsgZG9tOnZjcHUgPSAweCUoMSkwOHgs
IGNyX3N0YXJ0ID0gJSgyKWQsIGNyX2VuZCA9ICUoMylkIF0KIDB4MDAwMjIyMDggIENQVSUoY3B1
KWQgICUodHNjKWQgKCslKHJlbHRzYyk4ZCkgIGNzY2hlZDI6c2NoZWRfdGFza2xldAogMHgwMDAy
MjIwOSAgQ1BVJShjcHUpZCAgJSh0c2MpZCAoKyUocmVsdHNjKThkKSAgY3NjaGVkMjp1cGRhdGVf
bG9hZAogMHgwMDAyMjIwYSAgQ1BVJShjcHUpZCAgJSh0c2MpZCAoKyUocmVsdHNjKThkKSAgY3Nj
aGVkMjpydW5xX2Fzc2lnbiAgICBbIGRvbTp2Y3B1ID0gMHglKDEpMDh4LCBycV9pZCA9ICUoMilk
IF0KZGlmZiAtLWdpdCBhL3Rvb2xzL3hlbnRyYWNlL3hlbmFseXplLmMgYi90b29scy94ZW50cmFj
ZS94ZW5hbHl6ZS5jCmluZGV4IGFhODk0NjczYWQuLmQzYzgzNjhlOWQgMTAwNjQ0Ci0tLSBhL3Rv
b2xzL3hlbnRyYWNlL3hlbmFseXplLmMKKysrIGIvdG9vbHMveGVudHJhY2UveGVuYWx5emUuYwpA
QCAtNzcxOCwxMyArNzcxOCwxMiBAQCB2b2lkIHNjaGVkX3Byb2Nlc3Moc3RydWN0IHBjcHVfaW5m
byAqcCkKICAgICAgICAgICAgICAgICBzdHJ1Y3QgewogICAgICAgICAgICAgICAgICAgICB1bnNp
Z25lZCBpbnQgdmNwdWlkOjE2LCBkb21pZDoxNjsKICAgICAgICAgICAgICAgICAgICAgaW50IGNy
ZWRpdF9zdGFydCwgY3JlZGl0X2VuZDsKLSAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50
IG11bHRpcGxpZXI7CiAgICAgICAgICAgICAgICAgfSAqciA9ICh0eXBlb2YocikpcmktPmQ7CiAK
ICAgICAgICAgICAgICAgICBwcmludGYoIiAlcyBjc2NoZWQyOnJlc2V0X2NyZWRpdHMgZCV1diV1
LCAiCi0gICAgICAgICAgICAgICAgICAgICAgICJjcmVkaXRfc3RhcnQgPSAlZCwgY3JlZGl0X2Vu
ZCA9ICVkLCBtdWx0ID0gJXVcbiIsCisgICAgICAgICAgICAgICAgICAgICAgICJjcmVkaXRfc3Rh
cnQgPSAlZCwgY3JlZGl0X2VuZCA9ICVkXG4iLAogICAgICAgICAgICAgICAgICAgICAgICByaS0+
ZHVtcF9oZWFkZXIsIHItPmRvbWlkLCByLT52Y3B1aWQsCi0gICAgICAgICAgICAgICAgICAgICAg
IHItPmNyZWRpdF9zdGFydCwgci0+Y3JlZGl0X2VuZCwgci0+bXVsdGlwbGllcik7CisgICAgICAg
ICAgICAgICAgICAgICAgIHItPmNyZWRpdF9zdGFydCwgci0+Y3JlZGl0X2VuZCk7CiAgICAgICAg
ICAgICB9CiAgICAgICAgICAgICBicmVhazsKICAgICAgICAgY2FzZSBUUkNfU0NIRURfQ0xBU1Nf
RVZUKENTQ0hFRDIsIDgpOiAgLyogU0NIRURfVEFTS0xFVCAgICAqLwpkaWZmIC0tZ2l0IGEveGVu
L2NvbW1vbi9zY2hlZC9jcmVkaXQyLmMgYi94ZW4vY29tbW9uL3NjaGVkL2NyZWRpdDIuYwppbmRl
eCBjNzI0MTk0NGE4Li5jYmY5Y2UyYjk3IDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL3NjaGVkL2Ny
ZWRpdDIuYworKysgYi94ZW4vY29tbW9uL3NjaGVkL2NyZWRpdDIuYwpAQCAtMjI5LDEyICsyMjks
MjIgQEAKICAqIGJlZm9yZSBhIHJlc2V0IGV2ZW50LgogICovCiAjZGVmaW5lIENTQ0hFRDJfQ1JF
RElUX0lOSVQgICAgICAgICAgTUlMTElTRUNTKDEwKQorLyoKKyAqIE1pbmltdW0gYW1vdW50IG9m
IGNyZWRpdHMgVk1zIGNhbiBoYXZlLiBJZGVhbGx5LCBubyBWTSB3b3VsZCBnZXQKKyAqIGNsb3Nl
IHRvIHRoaXMgKHVubGVzcyBhIHZDUFUgbWFuYWdlcyB0byBleGVjdXRlIGZvciByZWFsbHkgbG9u
ZworICogdGltZSB1bmludGVycnVwdGVkKS4gSW4gY2FzZSBpdCBoYXBwZW5zLCBpdCBtYWtlcyBu
byBzZW5zZSB0bworICogdHJhY2sgZXZlbiBkZWVwZXIgdW5kZXJzaG9vdHMuCisgKgorICogTk9U
RTogSWYgbWFraW5nIHRoaXMgc21hbGxlciB0aGFuIC1DU0NIRUQyX0NSRURJVF9JTklULCBhZGp1
c3QKKyAqIHJlc2V0X2NyZWRpdCgpIGFjY29yZGluZ2x5LgorICovCisjZGVmaW5lIENTQ0hFRDJf
Q1JFRElUX01JTiAgICAgICAgICAgKC1DU0NIRUQyX0NSRURJVF9JTklUKQogLyoKICAqIEFtb3Vu
dCBvZiBjcmVkaXQgdGhlIGlkbGUgdW5pdHMgaGF2ZS4gSXQgbmV2ZXIgY2hhbmdlcywgYXMgaWRs
ZQogICogdW5pdHMgZG9lcyBub3QgY29uc3VtZSBjcmVkaXRzLCBhbmQgaXQgbXVzdCBiZSBsb3dl
ciB0aGFuIHdoYXRldmVyCiAgKiBhbW91bnQgb2YgY3JlZGl0ICdyZWd1bGFyJyB1bml0IHdvdWxk
IGVuZCB1cCB3aXRoLgogICovCi0jZGVmaW5lIENTQ0hFRDJfSURMRV9DUkVESVQgICAgICAgICAg
KC0oMVU8PDMwKSkKKyNkZWZpbmUgQ1NDSEVEMl9JRExFX0NSRURJVCAgICAgICAgICAoQ1NDSEVE
Ml9DUkVESVRfTUlOLTEpCiAvKgogICogQ2FycnlvdmVyOiBIb3cgbXVjaCAiZXh0cmEiIGNyZWRp
dCBtYXkgYmUgY2FycmllZCBvdmVyIGFmdGVyCiAgKiBhIHJlc2V0LgpAQCAtNzgxLDEwICs3OTEs
MTUgQEAgc3RhdGljIGludCBnZXRfZmFsbGJhY2tfY3B1KHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2
YykKIHN0YXRpYyB2b2lkIHQyY191cGRhdGUoY29uc3Qgc3RydWN0IGNzY2hlZDJfcnVucXVldWVf
ZGF0YSAqcnFkLCBzX3RpbWVfdCB0aW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1
Y3QgY3NjaGVkMl91bml0ICpzdmMpCiB7Ci0gICAgdWludDY0X3QgdmFsID0gdGltZSAqIHJxZC0+
bWF4X3dlaWdodCArIHN2Yy0+cmVzaWR1YWw7CisgICAgaW50NjRfdCB2YWwgPSB0aW1lICogcnFk
LT5tYXhfd2VpZ2h0ICsgc3ZjLT5yZXNpZHVhbDsKIAogICAgIHN2Yy0+cmVzaWR1YWwgPSBkb19k
aXYodmFsLCBzdmMtPndlaWdodCk7Ci0gICAgc3ZjLT5jcmVkaXQgLT0gdmFsOworICAgIC8qIEdl
dHRpbmcgdG8gbG93ZXIgY3JlZGl0IHRoYW4gQ1NDSEVEMl9DUkVESVRfTUlOIG1ha2VzIG5vIHNl
bnNlLiAqLworICAgIHZhbCA9IHN2Yy0+Y3JlZGl0IC0gdmFsOworICAgIGlmICggdW5saWtlbHko
dmFsIDwgQ1NDSEVEMl9DUkVESVRfTUlOKSApCisgICAgICAgIHN2Yy0+Y3JlZGl0ID0gQ1NDSEVE
Ml9DUkVESVRfTUlOOworICAgIGVsc2UKKyAgICAgICAgc3ZjLT5jcmVkaXQgPSB2YWw7CiB9CiAK
IHN0YXRpYyBzX3RpbWVfdCBjMnQoY29uc3Qgc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAq
cnFkLCBzX3RpbWVfdCBjcmVkaXQsCkBAIC0xNjE2LDI4ICsxNjMxLDI1IEBAIHN0YXRpYyB2b2lk
IHJlc2V0X2NyZWRpdChpbnQgY3B1LCBzX3RpbWVfdCBub3csIHN0cnVjdCBjc2NoZWQyX3VuaXQg
KnNuZXh0KQogewogICAgIHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCA9IGMycnFk
KGNwdSk7CiAgICAgc3RydWN0IGxpc3RfaGVhZCAqaXRlcjsKLSAgICBpbnQgbTsKKyAgICBpbnQg
cmVzZXQgPSBDU0NIRUQyX0NSRURJVF9JTklUOwogCiAgICAgLyoKICAgICAgKiBVbmRlciBub3Jt
YWwgY2lyY3Vtc3RhbmNlcywgc25leHQtPmNyZWRpdCBzaG91bGQgbmV2ZXIgYmUgbGVzcwogICAg
ICAqIHRoYW4gLUNTQ0hFRDJfTUlOX1RJTUVSLiAgSG93ZXZlciwgdW5kZXIgc29tZSBjaXJjdW1z
dGFuY2VzLCBhbgogICAgICAqIHVuaXQgd2l0aCBsb3cgY3JlZGl0cyBtYXkgYmUgYWxsb3dlZCB0
byBydW4gbG9uZyBlbm91Z2ggdGhhdAotICAgICAqIGl0cyBjcmVkaXRzIGFyZSBhY3R1YWxseSBs
ZXNzIHRoYW4gLUNTQ0hFRDJfQ1JFRElUX0lOSVQuCisgICAgICogaXRzIGNyZWRpdHMgYXJlIGFj
dHVhbGx5IG11Y2ggbG93ZXIgdGhhbiB0aGF0LgogICAgICAqIChJbnN0YW5jZXMgaGF2ZSBiZWVu
IG9ic2VydmVkLCBmb3IgZXhhbXBsZSwgd2hlcmUgYW4gdW5pdCB3aXRoCiAgICAgICogMjAwdXMg
b2YgY3JlZGl0IHdhcyBhbGxvd2VkIHRvIHJ1biBmb3IgMTFtcywgZ2l2aW5nIGl0IC0xMC44bXMK
ICAgICAgKiBvZiBjcmVkaXQuICBUaHVzIGl0IHdhcyBzdGlsbCBuZWdhdGl2ZSBldmVuIGFmdGVy
IHRoZSByZXNldC4pCiAgICAgICoKICAgICAgKiBJZiB0aGlzIGlzIHRoZSBjYXNlIGZvciBzbmV4
dCwgd2Ugc2ltcGx5IHdhbnQgdG8ga2VlcCBtb3ZpbmcKLSAgICAgKiBldmVyeW9uZSB1cCB1bnRp
bCBpdCBpcyBpbiB0aGUgYmxhY2sgYWdhaW4uICBUaGlzIGZhaXIgYmVjYXVzZQotICAgICAqIG5v
bmUgb2YgdGhlIG90aGVyIHVuaXRzIHdhbnQgdG8gcnVuIGF0IHRoZSBtb21lbnQuCi0gICAgICoK
LSAgICAgKiBSYXRoZXIgdGhhbiBsb29waW5nLCBob3dldmVyLCB3ZSBqdXN0IGNhbGN1bGF0ZSBh
IG11bHRpcGxpZXIsCi0gICAgICogYXZvaWRpbmcgYW4gaW50ZWdlciBkaXZpc2lvbiBhbmQgbXVs
dGlwbGljYXRpb24gaW4gdGhlIGNvbW1vbgotICAgICAqIGNhc2UuCisgICAgICogZXZlcnlvbmUg
dXAgdW50aWwgaXQgaXMgaW4gdGhlIGJsYWNrIGFnYWluLiBUaGlzIG1lYW5zIHRoYXQsCisgICAg
ICogc2luY2UgQ1NDSEVEMl9DUkVESVRfTUlOIGlzIC1DU0NIRUQyX0NSRURJVF9JTklULCB3ZSBu
ZWVkIHRvCisgICAgICogYWN0dWFsbHkgYWRkIDIqQ1NDSEVEMl9DUkVESVRfSU5JVC4KICAgICAg
Ki8KLSAgICBtID0gMTsKLSAgICBpZiAoIHNuZXh0LT5jcmVkaXQgPCAtQ1NDSEVEMl9DUkVESVRf
SU5JVCApCi0gICAgICAgIG0gKz0gKC1zbmV4dC0+Y3JlZGl0KSAvIENTQ0hFRDJfQ1JFRElUX0lO
SVQ7CisgICAgQVNTRVJUKHNuZXh0LT5jcmVkaXQgPj0gQ1NDSEVEMl9DUkVESVRfTUlOKTsKKyAg
ICBpZiAoIHVubGlrZWx5KHNuZXh0LT5jcmVkaXQgPT0gQ1NDSEVEMl9DUkVESVRfTUlOKSApCisg
ICAgICAgIHJlc2V0ICs9IENTQ0hFRDJfQ1JFRElUX0lOSVQ7CiAKICAgICBsaXN0X2Zvcl9lYWNo
KCBpdGVyLCAmcnFkLT5zdmMgKQogICAgIHsKQEAgLTE2NjgsMTUgKzE2ODAsNyBAQCBzdGF0aWMg
dm9pZCByZXNldF9jcmVkaXQoaW50IGNwdSwgc190aW1lX3Qgbm93LCBzdHJ1Y3QgY3NjaGVkMl91
bml0ICpzbmV4dCkKICAgICAgICAgfQogCiAgICAgICAgIHN0YXJ0X2NyZWRpdCA9IHN2Yy0+Y3Jl
ZGl0OwotCi0gICAgICAgIC8qCi0gICAgICAgICAqIEFkZCBJTklUICogbSwgYXZvaWRpbmcgaW50
ZWdlciBtdWx0aXBsaWNhdGlvbiBpbiB0aGUgY29tbW9uIGNhc2UuCi0gICAgICAgICAqLwotICAg
ICAgICBpZiAoIGxpa2VseShtPT0xKSApCi0gICAgICAgICAgICBzdmMtPmNyZWRpdCArPSBDU0NI
RUQyX0NSRURJVF9JTklUOwotICAgICAgICBlbHNlCi0gICAgICAgICAgICBzdmMtPmNyZWRpdCAr
PSBtICogQ1NDSEVEMl9DUkVESVRfSU5JVDsKLQorICAgICAgICBzdmMtPmNyZWRpdCArPSByZXNl
dDsKICAgICAgICAgLyogIkNsaXAiIGNyZWRpdHMgdG8gbWF4IGNhcnJ5b3ZlciAqLwogICAgICAg
ICBpZiAoIHN2Yy0+Y3JlZGl0ID4gQ1NDSEVEMl9DUkVESVRfSU5JVCArIENTQ0hFRDJfQ0FSUllP
VkVSX01BWCApCiAgICAgICAgICAgICBzdmMtPmNyZWRpdCA9IENTQ0hFRDJfQ1JFRElUX0lOSVQg
KyBDU0NIRUQyX0NBUlJZT1ZFUl9NQVg7CkBAIC0xNjg4LDE5ICsxNjkyLDE4IEBAIHN0YXRpYyB2
b2lkIHJlc2V0X2NyZWRpdChpbnQgY3B1LCBzX3RpbWVfdCBub3csIHN0cnVjdCBjc2NoZWQyX3Vu
aXQgKnNuZXh0KQogICAgICAgICAgICAgc3RydWN0IHsKICAgICAgICAgICAgICAgICB1bnNpZ25l
ZCB1bml0OjE2LCBkb206MTY7CiAgICAgICAgICAgICAgICAgaW50IGNyZWRpdF9zdGFydCwgY3Jl
ZGl0X2VuZDsKLSAgICAgICAgICAgICAgICB1bnNpZ25lZCBtdWx0aXBsaWVyOwogICAgICAgICAg
ICAgfSBkOwogICAgICAgICAgICAgZC5kb20gPSBzdmMtPnVuaXQtPmRvbWFpbi0+ZG9tYWluX2lk
OwogICAgICAgICAgICAgZC51bml0ID0gc3ZjLT51bml0LT51bml0X2lkOwogICAgICAgICAgICAg
ZC5jcmVkaXRfc3RhcnQgPSBzdGFydF9jcmVkaXQ7CiAgICAgICAgICAgICBkLmNyZWRpdF9lbmQg
PSBzdmMtPmNyZWRpdDsKLSAgICAgICAgICAgIGQubXVsdGlwbGllciA9IG07CiAgICAgICAgICAg
ICBfX3RyYWNlX3ZhcihUUkNfQ1NDSEVEMl9DUkVESVRfUkVTRVQsIDEsCiAgICAgICAgICAgICAg
ICAgICAgICAgICBzaXplb2YoZCksCiAgICAgICAgICAgICAgICAgICAgICAgICAodW5zaWduZWQg
Y2hhciAqKSZkKTsKICAgICAgICAgfQogICAgIH0KIAorICAgIEFTU0VSVChzbmV4dC0+Y3JlZGl0
ID4gMCk7CiAgICAgU0NIRURfU1RBVF9DUkFOSyhjcmVkaXRfcmVzZXQpOwogCiAgICAgLyogTm8g
bmVlZCB0byByZXNvcnQgcnVucXVldWUsIGFzIGV2ZXJ5b25lJ3Mgb3JkZXIgc2hvdWxkIGJlIHRo
ZSBzYW1lLiAqLwoKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3Jn
Cmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

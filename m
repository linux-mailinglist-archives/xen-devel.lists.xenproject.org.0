Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id C4F3D6AD63
	for <lists+xen-devel@lfdr.de>; Tue, 16 Jul 2019 19:09:19 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hnQuN-0005nz-UT; Tue, 16 Jul 2019 17:06:31 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=v+lg=VN=bitdefender.com=ppircalabu@srs-us1.protection.inumbo.net>)
 id 1hnQuL-0005nQ-S0
 for xen-devel@lists.xenproject.org; Tue, 16 Jul 2019 17:06:29 +0000
X-Inumbo-ID: 0c00d5a5-a7ec-11e9-8980-bc764e045a96
Received: from mx01.bbu.dsd.mx.bitdefender.com (unknown [91.199.104.161])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 0c00d5a5-a7ec-11e9-8980-bc764e045a96;
 Tue, 16 Jul 2019 17:06:27 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp02.buh.bitdefender.net [10.17.80.76])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 D73DB305FFA2; Tue, 16 Jul 2019 20:06:25 +0300 (EEST)
Received: from bitdefender.com (unknown [195.189.155.70])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id CA0F7305B7B5;
 Tue, 16 Jul 2019 20:06:25 +0300 (EEST)
From: Petre Pircalabu <ppircalabu@bitdefender.com>
To: xen-devel@lists.xenproject.org
Date: Tue, 16 Jul 2019 20:06:18 +0300
Message-Id: <46863526d6b28433a75914399d52954c4ca19950.1563293545.git.ppircalabu@bitdefender.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <cover.1563293545.git.ppircalabu@bitdefender.com>
References: <cover.1563293545.git.ppircalabu@bitdefender.com>
In-Reply-To: <cover.1563293545.git.ppircalabu@bitdefender.com>
References: <cover.1563293545.git.ppircalabu@bitdefender.com>
Subject: [Xen-devel] [PATCH v2 04/10] vm_event: Simplify vm_event interface
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Petre Pircalabu <ppircalabu@bitdefender.com>,
 Tamas K Lengyel <tamas@tklengyel.com>,
 Razvan Cojocaru <rcojocaru@bitdefender.com>, Wei Liu <wl@xen.org>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>, Jan Beulich <jbeulich@suse.com>,
 Alexandru Isaila <aisaila@bitdefender.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

UmVtb3ZlIHRoZSBkb21haW4gcmVmZXJlbmNlIGZyb20gY2FsbHMgdG8gdm1fZXZlbnQgaW50ZXJm
YWNlIGZ1bmN0aW9uCmFuZCB1c2UgdGhlIGJhY2twb2ludGVyIGZyb20gdm1fZXZlbnRfZG9tYWlu
LgoKQWZmZWN0ZWQgZnVuY3Rpb25zOgotIF9fdm1fZXZlbnRfY2xhaW1fc2xvdCAvIHZtX2V2ZW50
X2NsYWltX3Nsb3QgLyB2bV9ldmVudF9jbGFpbV9zbG90X25vc2xlZXAKLSB2bV9ldmVudF9jYW5j
ZWxfc2xvdAotIHZtX2V2ZW50X3B1dF9yZXF1ZXN0CgpTaWduZWQtb2ZmLWJ5OiBQZXRyZSBQaXJj
YWxhYnUgPHBwaXJjYWxhYnVAYml0ZGVmZW5kZXIuY29tPgotLS0KIHhlbi9hcmNoL3g4Ni9tbS9t
ZW1fc2hhcmluZy5jIHwgIDUgKystLS0KIHhlbi9hcmNoL3g4Ni9tbS9wMm0uYyAgICAgICAgIHwg
MTAgKysrKystLS0tLQogeGVuL2NvbW1vbi9tb25pdG9yLmMgICAgICAgICAgfCAgNCArKy0tCiB4
ZW4vY29tbW9uL3ZtX2V2ZW50LmMgICAgICAgICB8IDM3ICsrKysrKysrKysrKysrKysrKy0tLS0t
LS0tLS0tLS0tLS0tLS0KIHhlbi9pbmNsdWRlL3hlbi92bV9ldmVudC5oICAgIHwgMTcgKysrKysr
Ky0tLS0tLS0tLS0KIDUgZmlsZXMgY2hhbmdlZCwgMzQgaW5zZXJ0aW9ucygrKSwgMzkgZGVsZXRp
b25zKC0pCgpkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L21tL21lbV9zaGFyaW5nLmMgYi94ZW4v
YXJjaC94ODYvbW0vbWVtX3NoYXJpbmcuYwppbmRleCBmMTZhM2Y1Li45ZDgwMzg5IDEwMDY0NAot
LS0gYS94ZW4vYXJjaC94ODYvbW0vbWVtX3NoYXJpbmcuYworKysgYi94ZW4vYXJjaC94ODYvbW0v
bWVtX3NoYXJpbmcuYwpAQCAtNTU3LDggKzU1Nyw3IEBAIGludCBtZW1fc2hhcmluZ19ub3RpZnlf
ZW5vbWVtKHN0cnVjdCBkb21haW4gKmQsIHVuc2lnbmVkIGxvbmcgZ2ZuLAogICAgICAgICAudS5t
ZW1fc2hhcmluZy5wMm10ID0gcDJtX3JhbV9zaGFyZWQKICAgICB9OwogCi0gICAgaWYgKCAocmMg
PSBfX3ZtX2V2ZW50X2NsYWltX3Nsb3QoZCwgCi0gICAgICAgICAgICAgICAgICAgICAgICBkLT52
bV9ldmVudF9zaGFyZSwgYWxsb3dfc2xlZXApKSA8IDAgKQorICAgIGlmICggKHJjID0gX192bV9l
dmVudF9jbGFpbV9zbG90KGQtPnZtX2V2ZW50X3NoYXJlLCBhbGxvd19zbGVlcCkpIDwgMCApCiAg
ICAgICAgIHJldHVybiByYzsKIAogICAgIGlmICggdi0+ZG9tYWluID09IGQgKQpAQCAtNTY3LDcg
KzU2Niw3IEBAIGludCBtZW1fc2hhcmluZ19ub3RpZnlfZW5vbWVtKHN0cnVjdCBkb21haW4gKmQs
IHVuc2lnbmVkIGxvbmcgZ2ZuLAogICAgICAgICB2bV9ldmVudF92Y3B1X3BhdXNlKHYpOwogICAg
IH0KIAotICAgIHZtX2V2ZW50X3B1dF9yZXF1ZXN0KGQsIGQtPnZtX2V2ZW50X3NoYXJlLCAmcmVx
KTsKKyAgICB2bV9ldmVudF9wdXRfcmVxdWVzdChkLT52bV9ldmVudF9zaGFyZSwgJnJlcSk7CiAK
ICAgICByZXR1cm4gMDsKIH0KZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9tbS9wMm0uYyBiL3hl
bi9hcmNoL3g4Ni9tbS9wMm0uYwppbmRleCA0Yzk5NTQ4Li44NWRlNjRmIDEwMDY0NAotLS0gYS94
ZW4vYXJjaC94ODYvbW0vcDJtLmMKKysrIGIveGVuL2FyY2gveDg2L21tL3AybS5jCkBAIC0xNjUy
LDcgKzE2NTIsNyBAQCB2b2lkIHAybV9tZW1fcGFnaW5nX2Ryb3BfcGFnZShzdHJ1Y3QgZG9tYWlu
ICpkLCB1bnNpZ25lZCBsb25nIGdmbiwKICAgICAgKiBjb3JyZWN0bmVzcyBvZiB0aGUgZ3Vlc3Qg
ZXhlY3V0aW9uIGF0IHRoaXMgcG9pbnQuICBJZiB0aGlzIGlzIHRoZSBvbmx5CiAgICAgICogcGFn
ZSB0aGF0IGhhcHBlbnMgdG8gYmUgcGFnZWQtb3V0LCB3ZSdsbCBiZSBva2F5Li4gIGJ1dCBpdCdz
IGxpa2VseSB0aGUKICAgICAgKiBndWVzdCB3aWxsIGNyYXNoIHNob3J0bHkgYW55d2F5cy4gKi8K
LSAgICBpbnQgcmMgPSB2bV9ldmVudF9jbGFpbV9zbG90KGQsIGQtPnZtX2V2ZW50X3BhZ2luZyk7
CisgICAgaW50IHJjID0gdm1fZXZlbnRfY2xhaW1fc2xvdChkLT52bV9ldmVudF9wYWdpbmcpOwog
ICAgIGlmICggcmMgPCAwICkKICAgICAgICAgcmV0dXJuOwogCkBAIC0xNjY2LDcgKzE2NjYsNyBA
QCB2b2lkIHAybV9tZW1fcGFnaW5nX2Ryb3BfcGFnZShzdHJ1Y3QgZG9tYWluICpkLCB1bnNpZ25l
ZCBsb25nIGdmbiwKICAgICAgICAgLyogRXZpY3Qgd2lsbCBmYWlsIG5vdywgdGFnIHRoaXMgcmVx
dWVzdCBmb3IgcGFnZXIgKi8KICAgICAgICAgcmVxLnUubWVtX3BhZ2luZy5mbGFncyB8PSBNRU1f
UEFHSU5HX0VWSUNUX0ZBSUw7CiAKLSAgICB2bV9ldmVudF9wdXRfcmVxdWVzdChkLCBkLT52bV9l
dmVudF9wYWdpbmcsICZyZXEpOworICAgIHZtX2V2ZW50X3B1dF9yZXF1ZXN0KGQtPnZtX2V2ZW50
X3BhZ2luZywgJnJlcSk7CiB9CiAKIC8qKgpAQCAtMTcwNCw3ICsxNzA0LDcgQEAgdm9pZCBwMm1f
bWVtX3BhZ2luZ19wb3B1bGF0ZShzdHJ1Y3QgZG9tYWluICpkLCB1bnNpZ25lZCBsb25nIGdmbl9s
KQogICAgIHN0cnVjdCBwMm1fZG9tYWluICpwMm0gPSBwMm1fZ2V0X2hvc3RwMm0oZCk7CiAKICAg
ICAvKiBXZSdyZSBwYWdpbmcuIFRoZXJlIHNob3VsZCBiZSBhIHJpbmcgKi8KLSAgICBpbnQgcmMg
PSB2bV9ldmVudF9jbGFpbV9zbG90KGQsIGQtPnZtX2V2ZW50X3BhZ2luZyk7CisgICAgaW50IHJj
ID0gdm1fZXZlbnRfY2xhaW1fc2xvdChkLT52bV9ldmVudF9wYWdpbmcpOwogCiAgICAgaWYgKCBy
YyA9PSAtRU9QTk9UU1VQUCApCiAgICAgewpAQCAtMTc0Niw3ICsxNzQ2LDcgQEAgdm9pZCBwMm1f
bWVtX3BhZ2luZ19wb3B1bGF0ZShzdHJ1Y3QgZG9tYWluICpkLCB1bnNpZ25lZCBsb25nIGdmbl9s
KQogICAgIHsKICAgICAgICAgLyogZ2ZuIGlzIGFscmVhZHkgb24gaXRzIHdheSBiYWNrIGFuZCB2
Y3B1IGlzIG5vdCBwYXVzZWQgKi8KICAgICBvdXRfY2FuY2VsOgotICAgICAgICB2bV9ldmVudF9j
YW5jZWxfc2xvdChkLCBkLT52bV9ldmVudF9wYWdpbmcpOworICAgICAgICB2bV9ldmVudF9jYW5j
ZWxfc2xvdChkLT52bV9ldmVudF9wYWdpbmcpOwogICAgICAgICByZXR1cm47CiAgICAgfQogCkBA
IC0xNzU0LDcgKzE3NTQsNyBAQCB2b2lkIHAybV9tZW1fcGFnaW5nX3BvcHVsYXRlKHN0cnVjdCBk
b21haW4gKmQsIHVuc2lnbmVkIGxvbmcgZ2ZuX2wpCiAgICAgcmVxLnUubWVtX3BhZ2luZy5wMm10
ID0gcDJtdDsKICAgICByZXEudmNwdV9pZCA9IHYtPnZjcHVfaWQ7CiAKLSAgICB2bV9ldmVudF9w
dXRfcmVxdWVzdChkLCBkLT52bV9ldmVudF9wYWdpbmcsICZyZXEpOworICAgIHZtX2V2ZW50X3B1
dF9yZXF1ZXN0KGQtPnZtX2V2ZW50X3BhZ2luZywgJnJlcSk7CiB9CiAKIC8qKgpkaWZmIC0tZ2l0
IGEveGVuL2NvbW1vbi9tb25pdG9yLmMgYi94ZW4vY29tbW9uL21vbml0b3IuYwppbmRleCBkNWM5
ZmYxLi5iOGQzM2M0IDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL21vbml0b3IuYworKysgYi94ZW4v
Y29tbW9uL21vbml0b3IuYwpAQCAtOTMsNyArOTMsNyBAQCBpbnQgbW9uaXRvcl90cmFwcyhzdHJ1
Y3QgdmNwdSAqdiwgYm9vbCBzeW5jLCB2bV9ldmVudF9yZXF1ZXN0X3QgKnJlcSkKICAgICBpbnQg
cmM7CiAgICAgc3RydWN0IGRvbWFpbiAqZCA9IHYtPmRvbWFpbjsKIAotICAgIHJjID0gdm1fZXZl
bnRfY2xhaW1fc2xvdChkLCBkLT52bV9ldmVudF9tb25pdG9yKTsKKyAgICByYyA9IHZtX2V2ZW50
X2NsYWltX3Nsb3QoZC0+dm1fZXZlbnRfbW9uaXRvcik7CiAgICAgc3dpdGNoICggcmMgKQogICAg
IHsKICAgICBjYXNlIDA6CkBAIC0xMjUsNyArMTI1LDcgQEAgaW50IG1vbml0b3JfdHJhcHMoc3Ry
dWN0IHZjcHUgKnYsIGJvb2wgc3luYywgdm1fZXZlbnRfcmVxdWVzdF90ICpyZXEpCiAgICAgfQog
CiAgICAgdm1fZXZlbnRfZmlsbF9yZWdzKHJlcSk7Ci0gICAgdm1fZXZlbnRfcHV0X3JlcXVlc3Qo
ZCwgZC0+dm1fZXZlbnRfbW9uaXRvciwgcmVxKTsKKyAgICB2bV9ldmVudF9wdXRfcmVxdWVzdChk
LT52bV9ldmVudF9tb25pdG9yLCByZXEpOwogCiAgICAgcmV0dXJuIHJjOwogfQpkaWZmIC0tZ2l0
IGEveGVuL2NvbW1vbi92bV9ldmVudC5jIGIveGVuL2NvbW1vbi92bV9ldmVudC5jCmluZGV4IDc4
N2M2MWMuLmEyMzVkMjUgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vdm1fZXZlbnQuYworKysgYi94
ZW4vY29tbW9uL3ZtX2V2ZW50LmMKQEAgLTExOSwxMCArMTE5LDExIEBAIHN0YXRpYyB1bnNpZ25l
ZCBpbnQgdm1fZXZlbnRfcmluZ19hdmFpbGFibGUoc3RydWN0IHZtX2V2ZW50X2RvbWFpbiAqdmVk
KQogICogYnV0IG5lZWQgdG8gYmUgcmVzdW1lZCB3aGVyZSB0aGUgcmluZyBpcyBjYXBhYmxlIG9m
IHByb2Nlc3NpbmcgYXQgbGVhc3QKICAqIG9uZSBldmVudCBmcm9tIHRoZW0uCiAgKi8KLXN0YXRp
YyB2b2lkIHZtX2V2ZW50X3dha2VfYmxvY2tlZChzdHJ1Y3QgZG9tYWluICpkLCBzdHJ1Y3Qgdm1f
ZXZlbnRfZG9tYWluICp2ZWQpCitzdGF0aWMgdm9pZCB2bV9ldmVudF93YWtlX2Jsb2NrZWQoc3Ry
dWN0IHZtX2V2ZW50X2RvbWFpbiAqdmVkKQogewogICAgIHN0cnVjdCB2Y3B1ICp2OwogICAgIHVu
c2lnbmVkIGludCBpLCBqLCBrLCBhdmFpbF9yZXEgPSB2bV9ldmVudF9yaW5nX2F2YWlsYWJsZSh2
ZWQpOworICAgIHN0cnVjdCBkb21haW4gKmQgPSB2ZWQtPmQ7CiAKICAgICBpZiAoIGF2YWlsX3Jl
cSA9PSAwIHx8IHZlZC0+YmxvY2tlZCA9PSAwICkKICAgICAgICAgcmV0dXJuOwpAQCAtMTU0LDcg
KzE1NSw3IEBAIHN0YXRpYyB2b2lkIHZtX2V2ZW50X3dha2VfYmxvY2tlZChzdHJ1Y3QgZG9tYWlu
ICpkLCBzdHJ1Y3Qgdm1fZXZlbnRfZG9tYWluICp2ZWQpCiAgKiB3YXMgdW5hYmxlIHRvIGRvIHNv
LCBpdCBpcyBxdWV1ZWQgb24gYSB3YWl0IHF1ZXVlLiAgVGhlc2UgYXJlIHdva2VuIGFzCiAgKiBu
ZWVkZWQsIGFuZCB0YWtlIHByZWNlZGVuY2Ugb3ZlciB0aGUgYmxvY2tlZCB2Q1BVcy4KICAqLwot
c3RhdGljIHZvaWQgdm1fZXZlbnRfd2FrZV9xdWV1ZWQoc3RydWN0IGRvbWFpbiAqZCwgc3RydWN0
IHZtX2V2ZW50X2RvbWFpbiAqdmVkKQorc3RhdGljIHZvaWQgdm1fZXZlbnRfd2FrZV9xdWV1ZWQo
c3RydWN0IHZtX2V2ZW50X2RvbWFpbiAqdmVkKQogewogICAgIHVuc2lnbmVkIGludCBhdmFpbF9y
ZXEgPSB2bV9ldmVudF9yaW5nX2F2YWlsYWJsZSh2ZWQpOwogCkBAIC0xNjksMTIgKzE3MCwxMiBA
QCBzdGF0aWMgdm9pZCB2bV9ldmVudF93YWtlX3F1ZXVlZChzdHJ1Y3QgZG9tYWluICpkLCBzdHJ1
Y3Qgdm1fZXZlbnRfZG9tYWluICp2ZWQpCiAgKiBjYWxsIHZtX2V2ZW50X3dha2UoKSBhZ2Fpbiwg
ZW5zdXJpbmcgdGhhdCBhbnkgYmxvY2tlZCB2Q1BVcyB3aWxsIGdldAogICogdW5wYXVzZWQgb25j
ZSBhbGwgdGhlIHF1ZXVlZCB2Q1BVcyBoYXZlIG1hZGUgaXQgdGhyb3VnaC4KICAqLwotdm9pZCB2
bV9ldmVudF93YWtlKHN0cnVjdCBkb21haW4gKmQsIHN0cnVjdCB2bV9ldmVudF9kb21haW4gKnZl
ZCkKK3ZvaWQgdm1fZXZlbnRfd2FrZShzdHJ1Y3Qgdm1fZXZlbnRfZG9tYWluICp2ZWQpCiB7CiAg
ICAgaWYgKCAhbGlzdF9lbXB0eSgmdmVkLT53cS5saXN0KSApCi0gICAgICAgIHZtX2V2ZW50X3dh
a2VfcXVldWVkKGQsIHZlZCk7CisgICAgICAgIHZtX2V2ZW50X3dha2VfcXVldWVkKHZlZCk7CiAg
ICAgZWxzZQotICAgICAgICB2bV9ldmVudF93YWtlX2Jsb2NrZWQoZCwgdmVkKTsKKyAgICAgICAg
dm1fZXZlbnRfd2FrZV9ibG9ja2VkKHZlZCk7CiB9CiAKIHN0YXRpYyBpbnQgdm1fZXZlbnRfZGlz
YWJsZShzdHJ1Y3QgZG9tYWluICpkLCBzdHJ1Y3Qgdm1fZXZlbnRfZG9tYWluICoqcF92ZWQpCkBA
IC0yMTksMTcgKzIyMCwxNiBAQCBzdGF0aWMgaW50IHZtX2V2ZW50X2Rpc2FibGUoc3RydWN0IGRv
bWFpbiAqZCwgc3RydWN0IHZtX2V2ZW50X2RvbWFpbiAqKnBfdmVkKQogICAgIHJldHVybiAwOwog
fQogCi1zdGF0aWMgdm9pZCB2bV9ldmVudF9yZWxlYXNlX3Nsb3Qoc3RydWN0IGRvbWFpbiAqZCwK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3Qgdm1fZXZlbnRfZG9tYWlu
ICp2ZWQpCitzdGF0aWMgdm9pZCB2bV9ldmVudF9yZWxlYXNlX3Nsb3Qoc3RydWN0IHZtX2V2ZW50
X2RvbWFpbiAqdmVkKQogewogICAgIC8qIFVwZGF0ZSB0aGUgYWNjb3VudGluZyAqLwotICAgIGlm
ICggY3VycmVudC0+ZG9tYWluID09IGQgKQorICAgIGlmICggY3VycmVudC0+ZG9tYWluID09IHZl
ZC0+ZCApCiAgICAgICAgIHZlZC0+dGFyZ2V0X3Byb2R1Y2Vycy0tOwogICAgIGVsc2UKICAgICAg
ICAgdmVkLT5mb3JlaWduX3Byb2R1Y2Vycy0tOwogCiAgICAgLyogS2ljayBhbnkgd2FpdGVycyAq
LwotICAgIHZtX2V2ZW50X3dha2UoZCwgdmVkKTsKKyAgICB2bV9ldmVudF93YWtlKHZlZCk7CiB9
CiAKIC8qCkBAIC0yNTEsOCArMjUxLDcgQEAgc3RhdGljIHZvaWQgdm1fZXZlbnRfbWFya19hbmRf
cGF1c2Uoc3RydWN0IHZjcHUgKnYsIHN0cnVjdCB2bV9ldmVudF9kb21haW4gKnZlZCkKICAqIG92
ZXJseSBmdWxsIGFuZCBpdHMgY29udGludWVkIGV4ZWN1dGlvbiB3b3VsZCBjYXVzZSBzdGFsbGlu
ZyBhbmQgZXhjZXNzaXZlCiAgKiB3YWl0aW5nLiAgVGhlIHZDUFUgd2lsbCBiZSBhdXRvbWF0aWNh
bGx5IHVucGF1c2VkIHdoZW4gdGhlIHJpbmcgY2xlYXJzLgogICovCi12b2lkIHZtX2V2ZW50X3B1
dF9yZXF1ZXN0KHN0cnVjdCBkb21haW4gKmQsCi0gICAgICAgICAgICAgICAgICAgICAgICAgIHN0
cnVjdCB2bV9ldmVudF9kb21haW4gKnZlZCwKK3ZvaWQgdm1fZXZlbnRfcHV0X3JlcXVlc3Qoc3Ry
dWN0IHZtX2V2ZW50X2RvbWFpbiAqdmVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICB2bV9l
dmVudF9yZXF1ZXN0X3QgKnJlcSkKIHsKICAgICB2bV9ldmVudF9mcm9udF9yaW5nX3QgKmZyb250
X3Jpbmc7CkBAIC0yNjAsNiArMjU5LDcgQEAgdm9pZCB2bV9ldmVudF9wdXRfcmVxdWVzdChzdHJ1
Y3QgZG9tYWluICpkLAogICAgIHVuc2lnbmVkIGludCBhdmFpbF9yZXE7CiAgICAgUklOR19JRFgg
cmVxX3Byb2Q7CiAgICAgc3RydWN0IHZjcHUgKmN1cnIgPSBjdXJyZW50OworICAgIHN0cnVjdCBk
b21haW4gKmQgPSB2ZWQtPmQ7CiAKICAgICBpZiggIXZtX2V2ZW50X2NoZWNrKHZlZCkgKQogICAg
ICAgICByZXR1cm47CkBAIC0yOTIsNyArMjkyLDcgQEAgdm9pZCB2bV9ldmVudF9wdXRfcmVxdWVz
dChzdHJ1Y3QgZG9tYWluICpkLAogICAgIFJJTkdfUFVTSF9SRVFVRVNUUyhmcm9udF9yaW5nKTsK
IAogICAgIC8qIFdlJ3ZlIGFjdHVhbGx5ICp1c2VkKiBvdXIgcmVzZXJ2YXRpb24sIHNvIHJlbGVh
c2UgdGhlIHNsb3QuICovCi0gICAgdm1fZXZlbnRfcmVsZWFzZV9zbG90KGQsIHZlZCk7CisgICAg
dm1fZXZlbnRfcmVsZWFzZV9zbG90KHZlZCk7CiAKICAgICAvKiBHaXZlIHRoaXMgdkNQVSBhIGJs
YWNrIGV5ZSBpZiBuZWNlc3NhcnksIG9uIHRoZSB3YXkgb3V0LgogICAgICAqIFNlZSB0aGUgY29t
bWVudHMgYWJvdmUgd2FrZV9ibG9ja2VkKCkgZm9yIG1vcmUgaW5mb3JtYXRpb24KQEAgLTMzMiw3
ICszMzIsNyBAQCBzdGF0aWMgaW50IHZtX2V2ZW50X2dldF9yZXNwb25zZShzdHJ1Y3QgZG9tYWlu
ICpkLCBzdHJ1Y3Qgdm1fZXZlbnRfZG9tYWluICp2ZWQsCiAKICAgICAvKiBLaWNrIGFueSB3YWl0
ZXJzIC0tIHNpbmNlIHdlJ3ZlIGp1c3QgY29uc3VtZWQgYW4gZXZlbnQsCiAgICAgICogdGhlcmUg
bWF5IGJlIGFkZGl0aW9uYWwgc3BhY2UgYXZhaWxhYmxlIGluIHRoZSByaW5nLiAqLwotICAgIHZt
X2V2ZW50X3dha2UoZCwgdmVkKTsKKyAgICB2bV9ldmVudF93YWtlKHZlZCk7CiAKICAgICByYyA9
IDE7CiAKQEAgLTQzMywxMyArNDMzLDEzIEBAIHN0YXRpYyBpbnQgdm1fZXZlbnRfcmVzdW1lKHN0
cnVjdCBkb21haW4gKmQsIHN0cnVjdCB2bV9ldmVudF9kb21haW4gKnZlZCkKICAgICByZXR1cm4g
MDsKIH0KIAotdm9pZCB2bV9ldmVudF9jYW5jZWxfc2xvdChzdHJ1Y3QgZG9tYWluICpkLCBzdHJ1
Y3Qgdm1fZXZlbnRfZG9tYWluICp2ZWQpCit2b2lkIHZtX2V2ZW50X2NhbmNlbF9zbG90KHN0cnVj
dCB2bV9ldmVudF9kb21haW4gKnZlZCkKIHsKICAgICBpZiggIXZtX2V2ZW50X2NoZWNrKHZlZCkg
KQogICAgICAgICByZXR1cm47CiAKICAgICBzcGluX2xvY2soJnZlZC0+bG9jayk7Ci0gICAgdm1f
ZXZlbnRfcmVsZWFzZV9zbG90KGQsIHZlZCk7CisgICAgdm1fZXZlbnRfcmVsZWFzZV9zbG90KHZl
ZCk7CiAgICAgc3Bpbl91bmxvY2soJnZlZC0+bG9jayk7CiB9CiAKQEAgLTUwNywxNiArNTA3LDE1
IEBAIGJvb2wgdm1fZXZlbnRfY2hlY2soc3RydWN0IHZtX2V2ZW50X2RvbWFpbiAqdmVkKQogICog
ICAgICAgICAgICAgICAwOiBhIHNwb3QgaGFzIGJlZW4gcmVzZXJ2ZWQKICAqCiAgKi8KLWludCBf
X3ZtX2V2ZW50X2NsYWltX3Nsb3Qoc3RydWN0IGRvbWFpbiAqZCwgc3RydWN0IHZtX2V2ZW50X2Rv
bWFpbiAqdmVkLAotICAgICAgICAgICAgICAgICAgICAgICAgICBib29sIGFsbG93X3NsZWVwKQor
aW50IF9fdm1fZXZlbnRfY2xhaW1fc2xvdChzdHJ1Y3Qgdm1fZXZlbnRfZG9tYWluICp2ZWQsIGJv
b2wgYWxsb3dfc2xlZXApCiB7CiAgICAgaWYgKCAhdm1fZXZlbnRfY2hlY2sodmVkKSApCiAgICAg
ICAgIHJldHVybiAtRU9QTk9UU1VQUDsKIAotICAgIGlmICggKGN1cnJlbnQtPmRvbWFpbiA9PSBk
KSAmJiBhbGxvd19zbGVlcCApCisgICAgaWYgKCAoY3VycmVudC0+ZG9tYWluID09IHZlZC0+ZCkg
JiYgYWxsb3dfc2xlZXAgKQogICAgICAgICByZXR1cm4gdm1fZXZlbnRfd2FpdF9zbG90KHZlZCk7
CiAgICAgZWxzZQotICAgICAgICByZXR1cm4gdm1fZXZlbnRfZ3JhYl9zbG90KHZlZCwgY3VycmVu
dC0+ZG9tYWluICE9IGQpOworICAgICAgICByZXR1cm4gdm1fZXZlbnRfZ3JhYl9zbG90KHZlZCwg
Y3VycmVudC0+ZG9tYWluICE9IHZlZC0+ZCk7CiB9CiAKICNpZmRlZiBDT05GSUdfSEFTX01FTV9Q
QUdJTkcKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL3hlbi92bV9ldmVudC5oIGIveGVuL2luY2x1
ZGUveGVuL3ZtX2V2ZW50LmgKaW5kZXggMzgxYmUwYi4uZmYzMDk5OSAxMDA2NDQKLS0tIGEveGVu
L2luY2x1ZGUveGVuL3ZtX2V2ZW50LmgKKysrIGIveGVuL2luY2x1ZGUveGVuL3ZtX2V2ZW50LmgK
QEAgLTQ1LDIzICs0NSwyMCBAQCBib29sIHZtX2V2ZW50X2NoZWNrKHN0cnVjdCB2bV9ldmVudF9k
b21haW4gKnZlZCk7CiAgKiBjYW5jZWxfc2xvdCgpLCBib3RoIG9mIHdoaWNoIGFyZSBndWFyYW50
ZWVkIHRvCiAgKiBzdWNjZWVkLgogICovCi1pbnQgX192bV9ldmVudF9jbGFpbV9zbG90KHN0cnVj
dCBkb21haW4gKmQsIHN0cnVjdCB2bV9ldmVudF9kb21haW4gKnZlZCwKLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgYm9vbCBhbGxvd19zbGVlcCk7Ci1zdGF0aWMgaW5saW5lIGludCB2bV9ldmVu
dF9jbGFpbV9zbG90KHN0cnVjdCBkb21haW4gKmQsCi0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHN0cnVjdCB2bV9ldmVudF9kb21haW4gKnZlZCkKK2ludCBfX3ZtX2V2ZW50
X2NsYWltX3Nsb3Qoc3RydWN0IHZtX2V2ZW50X2RvbWFpbiAqdmVkLCBib29sIGFsbG93X3NsZWVw
KTsKK3N0YXRpYyBpbmxpbmUgaW50IHZtX2V2ZW50X2NsYWltX3Nsb3Qoc3RydWN0IHZtX2V2ZW50
X2RvbWFpbiAqdmVkKQogewotICAgIHJldHVybiBfX3ZtX2V2ZW50X2NsYWltX3Nsb3QoZCwgdmVk
LCB0cnVlKTsKKyAgICByZXR1cm4gX192bV9ldmVudF9jbGFpbV9zbG90KHZlZCwgdHJ1ZSk7CiB9
CiAKLXN0YXRpYyBpbmxpbmUgaW50IHZtX2V2ZW50X2NsYWltX3Nsb3Rfbm9zbGVlcChzdHJ1Y3Qg
ZG9tYWluICpkLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHN0cnVjdCB2bV9ldmVudF9kb21haW4gKnZlZCkKK3N0YXRpYyBpbmxpbmUgaW50IHZtX2V2ZW50
X2NsYWltX3Nsb3Rfbm9zbGVlcChzdHJ1Y3Qgdm1fZXZlbnRfZG9tYWluICp2ZWQpCiB7Ci0gICAg
cmV0dXJuIF9fdm1fZXZlbnRfY2xhaW1fc2xvdChkLCB2ZWQsIGZhbHNlKTsKKyAgICByZXR1cm4g
X192bV9ldmVudF9jbGFpbV9zbG90KHZlZCwgZmFsc2UpOwogfQogCi12b2lkIHZtX2V2ZW50X2Nh
bmNlbF9zbG90KHN0cnVjdCBkb21haW4gKmQsIHN0cnVjdCB2bV9ldmVudF9kb21haW4gKnZlZCk7
Cit2b2lkIHZtX2V2ZW50X2NhbmNlbF9zbG90KHN0cnVjdCB2bV9ldmVudF9kb21haW4gKnZlZCk7
CiAKLXZvaWQgdm1fZXZlbnRfcHV0X3JlcXVlc3Qoc3RydWN0IGRvbWFpbiAqZCwgc3RydWN0IHZt
X2V2ZW50X2RvbWFpbiAqdmVkLAordm9pZCB2bV9ldmVudF9wdXRfcmVxdWVzdChzdHJ1Y3Qgdm1f
ZXZlbnRfZG9tYWluICp2ZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtX2V2ZW50X3Jl
cXVlc3RfdCAqcmVxKTsKIAogaW50IHZtX2V2ZW50X2RvbWN0bChzdHJ1Y3QgZG9tYWluICpkLCBz
dHJ1Y3QgeGVuX2RvbWN0bF92bV9ldmVudF9vcCAqdmVjKTsKLS0gCjIuNy40CgoKX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcg
bGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9q
ZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

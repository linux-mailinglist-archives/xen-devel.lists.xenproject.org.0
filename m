Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 9DB9B64694
	for <lists+xen-devel@lfdr.de>; Wed, 10 Jul 2019 14:59:00 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hlC9Q-0002zs-Su; Wed, 10 Jul 2019 12:56:48 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=dFy6=VH=amazon.de=prvs=087c1bc88=nmanthey@srs-us1.protection.inumbo.net>)
 id 1hlC9P-0002ze-0e
 for xen-devel@lists.xenproject.org; Wed, 10 Jul 2019 12:56:47 +0000
X-Inumbo-ID: 2be88d22-a312-11e9-b798-7b7ba7ac6368
Received: from smtp-fw-9101.amazon.com (unknown [207.171.184.25])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 2be88d22-a312-11e9-b798-7b7ba7ac6368;
 Wed, 10 Jul 2019 12:56:45 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amazon.de; i=@amazon.de; q=dns/txt; s=amazon201209;
 t=1562763406; x=1594299406;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version;
 bh=EH64tr4ZTZOlavnwkK9YoZxAynIy4c9UhRkVmZm0TXk=;
 b=kF7h2S6Naj+xnTJ1Kb2yQFq0wmINpdpzsFjgSVRbOyTDuFKO92kLR4zK
 Ep/OC7uBKTa/ogD31TN7/s7/p20JKbvRMSmb3k7Jr9/w1rqIGcfmKgG8N
 LNBqqDVrBxJdR6WB6t/OV11HRsiKFCmqTz91suv6hEooK0ZMAMNti0Wbt 8=;
X-IronPort-AV: E=Sophos;i="5.62,474,1554768000"; d="scan'208";a="815390045"
Received: from sea3-co-svc-lb6-vlan2.sea.amazon.com (HELO
 email-inbound-relay-1a-af6a10df.us-east-1.amazon.com) ([10.47.22.34])
 by smtp-border-fw-out-9101.sea19.amazon.com with ESMTP;
 10 Jul 2019 12:56:43 +0000
Received: from EX13MTAUEB001.ant.amazon.com
 (iad55-ws-svc-p15-lb9-vlan3.iad.amazon.com [10.40.159.166])
 by email-inbound-relay-1a-af6a10df.us-east-1.amazon.com (Postfix) with ESMTPS
 id 6364EA2362; Wed, 10 Jul 2019 12:56:39 +0000 (UTC)
Received: from EX13D08UEB001.ant.amazon.com (10.43.60.245) by
 EX13MTAUEB001.ant.amazon.com (10.43.60.129) with Microsoft SMTP Server (TLS)
 id 15.0.1367.3; Wed, 10 Jul 2019 12:56:18 +0000
Received: from EX13MTAUEB001.ant.amazon.com (10.43.60.96) by
 EX13D08UEB001.ant.amazon.com (10.43.60.245) with Microsoft SMTP Server (TLS)
 id 15.0.1367.3; Wed, 10 Jul 2019 12:56:17 +0000
Received: from uc1a35a69ae4659.ant.amazon.com (10.95.156.35) by
 mail-relay.amazon.com (10.43.60.129) with Microsoft SMTP Server id
 15.0.1367.3 via Frontend Transport; Wed, 10 Jul 2019 12:56:14 +0000
From: Norbert Manthey <nmanthey@amazon.de>
To: <xen-devel@lists.xenproject.org>
Date: Wed, 10 Jul 2019 14:54:37 +0200
Message-ID: <1562763277-11674-3-git-send-email-nmanthey@amazon.de>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1562763277-11674-1-git-send-email-nmanthey@amazon.de>
References: <1562763277-11674-1-git-send-email-nmanthey@amazon.de>
MIME-Version: 1.0
Precedence: Bulk
Subject: [Xen-devel] [PATCH L1TF MDS GT v2 2/2] common/grant_table: harden
 version dependent accesses
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Tim Deegan <tim@xen.org>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wei.liu2@citrix.com>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>, Ian
 Jackson <ian.jackson@eu.citrix.com>, Dario Faggioli <dfaggioli@suse.com>,
 Martin Pohlack <mpohlack@amazon.de>, Pawel Wieczorkiewicz <wipawel@amazon.de>,
 Julien Grall <julien.grall@arm.com>, David Woodhouse <dwmw@amazon.co.uk>,
 Jan Beulich <jbeulich@suse.com>, Martin Mazein <amazein@amazon.de>,
 Bjoern Doebel <doebel@amazon.de>, Norbert Manthey <nmanthey@amazon.de>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

R3Vlc3RzIGNhbiBpc3N1ZSBncmFudCB0YWJsZSBvcGVyYXRpb25zIGFuZCBwcm92aWRlIGd1ZXN0
IGNvbnRyb2xsZWQKZGF0YSB0byB0aGVtLiBUaGlzIGRhdGEgaXMgdXNlZCBhcyBpbmRleCBmb3Ig
bWVtb3J5IGxvYWRzIGFmdGVyIGJvdW5kCmNoZWNrcyBoYXZlIGJlZW4gZG9uZS4gRGVwZW5kaW5n
IG9uIHRoZSBncmFudCB0YWJsZSB2ZXJzaW9uLCB0aGUKc2l6ZSBvZiBlbGVtZW50cyBpbiBjb250
YWluZXJzIGRpZmZlci4gQXMgdGhlIGJhc2UgZGF0YSBzdHJ1Y3R1cmUgaXMKYSBwYWdlLCB0aGUg
bnVtYmVyIG9mIGVsZW1lbnRzIHBlciBwYWdlIGFsc28gZGlmZmVycy4gQ29uc2VxdWVudGx5LApi
b3VuZCBjaGVja3MgYXJlIHZlcnNpb24gZGVwZW5kZW50LCBzbyB0aGF0IHNwZWN1bGF0aXZlIGV4
ZWN1dGlvbiBjYW4KaGFwcGVuIGluIHNldmVyYWwgc3RhZ2VzLCB0aGUgYm91bmQgY2hlY2sgYXMg
d2VsbCBhcyB0aGUgdmVyc2lvbiBjaGVjay4KClRoaXMgY29tbWl0IG1pdGlnYXRlcyBjYXNlcyB3
aGVyZSBvdXQtb2YtYm91bmQgYWNjZXNzZXMgY291bGQgaGFwcGVuCmR1ZSB0byB0aGUgdmVyc2lv
biBjb21wYXJpc29uLiBJbiBjYXNlcywgd2hlcmUgbm8gZGlmZmVyZW50IG1lbW9yeQpsb2NhdGlv
bnMgYXJlIGFjY2Vzc2VkIG9uIHRoZSBjb2RlIHBhdGggdGhhdCBmb2xsb3cgYW4gaWYgc3RhdGVt
ZW50LApubyBwcm90ZWN0aW9uIGlzIHJlcXVpcmVkLiBObyBkaWZmZXJlbnQgbWVtb3J5IGxvY2F0
aW9ucyBhcmUgYWNjZXNzZWQKaW4gdGhlIGZvbGxvd2luZyBmdW5jdGlvbnMgYWZ0ZXIgYSB2ZXJz
aW9uIGNoZWNrOgoKICogZ250dGFiX3NldHVwX3RhYmxlOiBvbmx5IGNhbGN1bGF0ZWQgbnVtYmVy
c2kgYXJlIHVzZWQsIGFuZCB0aGVuCiAgICAgICAgZnVuY3Rpb24gZ250dGFiX2dyb3dfdGFibGUg
aXMgY2FsbGVkLCB3aGljaCBpcyB2ZXJzaW9uIHByb3RlY3RlZAoKICogZ250dGFiX3RyYW5zZmVy
OiB0aGUgY2FzZSB0aGF0IGRlcGVuZHMgb24gdGhlIHZlcnNpb24gY2hlY2sganVzdCBnZXRzCiAg
ICAgICAgaW50byBjb3B5aW5nIGEgcGFnZSBvciBub3QKCiAqIGFjcXVpcmVfZ3JhbnRfZm9yX2Nv
cHk6IHRoZSBub3QgZml4ZWQgY29tcGFyaXNvbiBpcyBvbiB0aGUgYWJvcnQgcGF0aAogICAgICAg
IGFuZCBkb2VzIG5vdCBhY2Nlc3Mgb3RoZXIgc3RydWN0dXJlcywgYW5kIG9uIHRoZSBlbHNlIGJy
YW5jaAogICAgICAgIGFjY2Vzc2VzIG9ubHkgc3RydWN0dXJlcyB0aGF0IGhhdmUgYmVlbiB2YWxp
ZGF0ZWQgYmVmb3JlCgogKiBnbnR0YWJfc2V0X3ZlcnNpb246IGFsbCBhY2Nlc3NpYmxlIGRhdGEg
aXMgYWxsb2NhdGVkIGZvciBib3RoIHZlcnNpb25zCiAgICAgICAgRnVydGhlcm1vcmUsIHRoZSBm
dW5jdGlvbnMgZ250dGFiX3BvcHVsYXRlX3N0YXR1c19mcmFtZXMgYW5kCiAgICAgICAgZ250dGFi
X3VucG9wdWxhdGVfc3RhdHVzX2ZyYW1lcyByZWNlaXZlZCBhIGJsb2NrX3NwZWN1bGF0aW9uCiAg
ICAgICAgbWFjcm8uIEhlbmNlLCB0aGlzIGNvZGUgd2lsbCBvbmx5IGJlIGV4ZWN1dGVkIG9uY2Ug
dGhlIGNvcnJlY3QKICAgICAgICB2ZXJzaW9uIGlzIHZpc2libGUgaW4gdGhlIGFyY2hpdGVjdHVy
YWwgc3RhdGUuCgogKiBnbnR0YWJfcmVsZWFzZV9tYXBwaW5nczogdGhpcyBmdW5jdGlvbiBpcyBj
YWxsZWQgb25seSBkdXJpbmcgZG9tYWluCiAgICAgICBkZXN0cnVjdGlvbiBhbmQgY29udHJvbCBp
cyBub3QgcmV0dXJuZWQgdG8gdGhlIGd1ZXN0CgogKiBtZW1fc2hhcmluZ19ncmVmX3RvX2dmbjog
c3BlY3VsYXRpb24gd2lsbCBiZSBzdG9wZWQgYnkgdGhlIHNlY29uZCBpZgogICAgICAgc3RhdGVt
ZW50LCBhcyB0aGF0IHBsYWNlcyBhIGJhcnJpZXIgb24gYW55IHBhdGggdG8gYmUgZXhlY3V0ZWQu
CgogKiBnbnR0YWJfZ2V0X3N0YXR1c19mcmFtZV9tZm46IG5vIHZlcnNpb24gZGVwZW5kZW50IGNo
ZWNrLCBiZWNhdXNlIGFsbAogICAgICAgYWNjZXNzZXMsIGV4Y2VwdCB0aGUgZ3QtPnN0YXR1c1tp
ZHhdLCBkbyBub3QgcGVyZm9ybSBpbmRleC1iYXNlZAogICAgICAgYWNjZXNzZXMsIG9yIHNwZWN1
bGF0aXZlIG91dC1vZi1ib3VuZCBhY2Nlc3NlcyBpbiB0aGUKICAgICAgIGdudHRhYl9ncm93X3Rh
YmxlIGZ1bmN0aW9uIGNhbGwuCgogKiBnbnR0YWJfdXNhZ2VfcHJpbnQ6IGNhbm5vdCBiZSB0cmln
Z2VyZWQgYnkgdGhlIGd1ZXN0CgpUaGlzIGlzIHBhcnQgb2YgdGhlIHNwZWN1bGF0aXZlIGhhcmRl
bmluZyBlZmZvcnQuCgpTaWduZWQtb2ZmLWJ5OiBOb3JiZXJ0IE1hbnRoZXkgPG5tYW50aGV5QGFt
YXpvbi5kZT4KLS0tCgpOb3RlczoKICB2MjogIEFkZCBibG9ja19zcGVjdWxhdGlvbiB0byBnbnR0
YWJfcG9wdWxhdGVfc3RhdHVzX2ZyYW1lcyBhbmQKICAgICAgICAgICBnbnR0YWJfdW5wb3B1bGF0
ZV9zdGF0dXNfZnJhbWVzCiAgICAgICBBZGQgYmxvY2tfc3BlY3VsYXRpb24gaW4gZ250dGFiX2dl
dF9zdGF0dXNfZnJhbWVfbWZuLCB0byBtYWtlIHN1cmUKICAgICAgICAgICB3ZSBhY3R1YWxseSB3
b3JrIHdpdGggYSB2ZXJzaW9uIDIgZ3JhbnQgdGFibGUKCiB4ZW4vY29tbW9uL2dyYW50X3RhYmxl
LmMgfCAzNyArKysrKysrKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tCiAxIGZpbGUgY2hh
bmdlZCwgMjUgaW5zZXJ0aW9ucygrKSwgMTIgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEveGVu
L2NvbW1vbi9ncmFudF90YWJsZS5jIGIveGVuL2NvbW1vbi9ncmFudF90YWJsZS5jCi0tLSBhL3hl
bi9jb21tb24vZ3JhbnRfdGFibGUuYworKysgYi94ZW4vY29tbW9uL2dyYW50X3RhYmxlLmMKQEAg
LTgyOCw3ICs4MjgsNyBAQCBzdGF0aWMgaW50IF9zZXRfc3RhdHVzKGNvbnN0IGdyYW50X2VudHJ5
X2hlYWRlcl90ICpzaGFoLAogICAgICAgICAgICAgICAgICAgICAgICBkb21pZF90IGxkb21pZCkK
IHsKIAotICAgIGlmICggcmd0X3ZlcnNpb24gPT0gMSApCisgICAgaWYgKCBldmFsdWF0ZV9ub3Nw
ZWMocmd0X3ZlcnNpb24gPT0gMSkgKQogICAgICAgICByZXR1cm4gX3NldF9zdGF0dXNfdjEoc2hh
aCwgcmQsIGFjdCwgcmVhZG9ubHksIG1hcGZsYWcsIGxkb21pZCk7CiAgICAgZWxzZQogICAgICAg
ICByZXR1cm4gX3NldF9zdGF0dXNfdjIoc2hhaCwgc3RhdHVzLCByZCwgYWN0LCByZWFkb25seSwg
bWFwZmxhZywgbGRvbWlkKTsKQEAgLTk4Myw5ICs5ODMsMTIgQEAgbWFwX2dyYW50X3JlZigKIAog
ICAgIC8qIFRoaXMgY2FsbCBhbHNvIGVuc3VyZXMgdGhlIGFib3ZlIGNoZWNrIGNhbm5vdCBiZSBw
YXNzZWQgc3BlY3VsYXRpdmVseSAqLwogICAgIHNoYWggPSBzaGFyZWRfZW50cnlfaGVhZGVyKHJn
dCwgcmVmKTsKLSAgICBzdGF0dXMgPSByZ3QtPmd0X3ZlcnNpb24gPT0gMSA/ICZzaGFoLT5mbGFn
cyA6ICZzdGF0dXNfZW50cnkocmd0LCByZWYpOwogICAgIGFjdCA9IGFjdGl2ZV9lbnRyeV9hY3F1
aXJlKHJndCwgcmVmKTsKIAorICAgIC8qIE1ha2Ugc3VyZSB3ZSBkbyBub3QgYWNjZXNzIG1lbW9y
eSBzcGVjdWxhdGl2ZWx5ICovCisgICAgc3RhdHVzID0gZXZhbHVhdGVfbm9zcGVjKHJndC0+Z3Rf
dmVyc2lvbiA9PSAxKSA/ICZzaGFoLT5mbGFncworICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIDogJnN0YXR1c19lbnRyeShyZ3QsIHJlZik7CisKICAgICAv
KiBJZiBhbHJlYWR5IHBpbm5lZCwgY2hlY2sgdGhlIGFjdGl2ZSBkb21pZCBhbmQgYXZvaWQgcmVm
Y250IG92ZXJmbG93LiAqLwogICAgIGlmICggYWN0LT5waW4gJiYKICAgICAgICAgICgoYWN0LT5k
b21pZCAhPSBsZC0+ZG9tYWluX2lkKSB8fApAQCAtMTAwNiw3ICsxMDA5LDcgQEAgbWFwX2dyYW50
X3JlZigKIAogICAgICAgICBpZiAoICFhY3QtPnBpbiApCiAgICAgICAgIHsKLSAgICAgICAgICAg
IHVuc2lnbmVkIGxvbmcgZ2ZuID0gcmd0LT5ndF92ZXJzaW9uID09IDEgPworICAgICAgICAgICAg
dW5zaWduZWQgbG9uZyBnZm4gPSBldmFsdWF0ZV9ub3NwZWMocmd0LT5ndF92ZXJzaW9uID09IDEp
ID8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hhcmVkX2VudHJ5X3YxKHJndCwg
cmVmKS5mcmFtZSA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoYXJlZF9lbnRy
eV92MihyZ3QsIHJlZikuZnVsbF9wYWdlLmZyYW1lOwogCkBAIC0xNDU4LDcgKzE0NjEsNyBAQCB1
bm1hcF9jb21tb25fY29tcGxldGUoc3RydWN0IGdudHRhYl91bm1hcF9jb21tb24gKm9wKQogICAg
IGFjdCA9IGFjdGl2ZV9lbnRyeV9hY3F1aXJlKHJndCwgb3AtPnJlZik7CiAgICAgc2hhID0gc2hh
cmVkX2VudHJ5X2hlYWRlcihyZ3QsIG9wLT5yZWYpOwogCi0gICAgaWYgKCByZ3QtPmd0X3ZlcnNp
b24gPT0gMSApCisgICAgaWYgKCBldmFsdWF0ZV9ub3NwZWMocmd0LT5ndF92ZXJzaW9uID09IDEp
ICkKICAgICAgICAgc3RhdHVzID0gJnNoYS0+ZmxhZ3M7CiAgICAgZWxzZQogICAgICAgICBzdGF0
dXMgPSAmc3RhdHVzX2VudHJ5KHJndCwgb3AtPnJlZik7CkBAIC0xNjUxLDYgKzE2NTQsMTAgQEAg
Z250dGFiX3BvcHVsYXRlX3N0YXR1c19mcmFtZXMoc3RydWN0IGRvbWFpbiAqZCwgc3RydWN0IGdy
YW50X3RhYmxlICpndCwKICAgICB1bnNpZ25lZCByZXFfc3RhdHVzX2ZyYW1lczsKIAogICAgIHJl
cV9zdGF0dXNfZnJhbWVzID0gZ3JhbnRfdG9fc3RhdHVzX2ZyYW1lcyhyZXFfbnJfZnJhbWVzKTsK
KworICAgIC8qIE1ha2Ugc3VyZSwgcHJpb3IgdmVyc2lvbiBjaGVja3MgYXJlIGFyY2hpdGVjdHVy
YWwgdmlzaWJsZSAqLworICAgIGJsb2NrX3NwZWN1bGF0aW9uKCk7CisKICAgICBmb3IgKCBpID0g
bnJfc3RhdHVzX2ZyYW1lcyhndCk7IGkgPCByZXFfc3RhdHVzX2ZyYW1lczsgaSsrICkKICAgICB7
CiAgICAgICAgIGlmICggKGd0LT5zdGF0dXNbaV0gPSBhbGxvY194ZW5oZWFwX3BhZ2UoKSkgPT0g
TlVMTCApCkBAIC0xNjc5LDYgKzE2ODYsOSBAQCBnbnR0YWJfdW5wb3B1bGF0ZV9zdGF0dXNfZnJh
bWVzKHN0cnVjdCBkb21haW4gKmQsIHN0cnVjdCBncmFudF90YWJsZSAqZ3QpCiB7CiAgICAgdW5z
aWduZWQgaW50IGk7CiAKKyAgICAvKiBNYWtlIHN1cmUsIHByaW9yIHZlcnNpb24gY2hlY2tzIGFy
ZSBhcmNoaXRlY3R1cmFsIHZpc2libGUgKi8KKyAgICBibG9ja19zcGVjdWxhdGlvbigpOworCiAg
ICAgZm9yICggaSA9IDA7IGkgPCBucl9zdGF0dXNfZnJhbWVzKGd0KTsgaSsrICkKICAgICB7CiAg
ICAgICAgIHN0cnVjdCBwYWdlX2luZm8gKnBnID0gdmlydF90b19wYWdlKGd0LT5zdGF0dXNbaV0p
OwpAQCAtMTc5MCw3ICsxODAwLDcgQEAgZ250dGFiX2dyb3dfdGFibGUoc3RydWN0IGRvbWFpbiAq
ZCwgdW5zaWduZWQgaW50IHJlcV9ucl9mcmFtZXMpCiAgICAgfQogCiAgICAgLyogU3RhdHVzIHBh
Z2VzIC0gdmVyc2lvbiAyICovCi0gICAgaWYgKCBndC0+Z3RfdmVyc2lvbiA+IDEgKQorICAgIGlm
ICggZXZhbHVhdGVfbm9zcGVjKGd0LT5ndF92ZXJzaW9uID4gMSkgKQogICAgIHsKICAgICAgICAg
aWYgKCBnbnR0YWJfcG9wdWxhdGVfc3RhdHVzX2ZyYW1lcyhkLCBndCwgcmVxX25yX2ZyYW1lcykg
KQogICAgICAgICAgICAgZ290byBzaGFyZWRfYWxsb2NfZmFpbGVkOwpAQCAtMjI4Niw3ICsyMjk2
LDcgQEAgZ250dGFiX3RyYW5zZmVyKAogICAgICAgICBncmFudF9yZWFkX2xvY2soZS0+Z3JhbnRf
dGFibGUpOwogICAgICAgICBhY3QgPSBhY3RpdmVfZW50cnlfYWNxdWlyZShlLT5ncmFudF90YWJs
ZSwgcmVmKTsKIAotICAgICAgICBpZiAoIGUtPmdyYW50X3RhYmxlLT5ndF92ZXJzaW9uID09IDEg
KQorICAgICAgICBpZiAoIGV2YWx1YXRlX25vc3BlYyhlLT5ncmFudF90YWJsZS0+Z3RfdmVyc2lv
biA9PSAxKSApCiAgICAgICAgIHsKICAgICAgICAgICAgIGdyYW50X2VudHJ5X3YxX3QgKnNoYSA9
ICZzaGFyZWRfZW50cnlfdjEoZS0+Z3JhbnRfdGFibGUsIHJlZik7CiAKQEAgLTIzNDcsNyArMjM1
Nyw3IEBAIHJlbGVhc2VfZ3JhbnRfZm9yX2NvcHkoCiAgICAgc2hhID0gc2hhcmVkX2VudHJ5X2hl
YWRlcihyZ3QsIGdyZWYpOwogICAgIG1mbiA9IGFjdC0+bWZuOwogCi0gICAgaWYgKCByZ3QtPmd0
X3ZlcnNpb24gPT0gMSApCisgICAgaWYgKCBldmFsdWF0ZV9ub3NwZWMocmd0LT5ndF92ZXJzaW9u
ID09IDEpICkKICAgICB7CiAgICAgICAgIHN0YXR1cyA9ICZzaGEtPmZsYWdzOwogICAgICAgICB0
ZCA9IHJkOwpAQCAtMjQ0Niw3ICsyNDU2LDcgQEAgYWNxdWlyZV9ncmFudF9mb3JfY29weSgKICAg
ICBzaGFoID0gc2hhcmVkX2VudHJ5X2hlYWRlcihyZ3QsIGdyZWYpOwogICAgIGFjdCA9IGFjdGl2
ZV9lbnRyeV9hY3F1aXJlKHJndCwgZ3JlZik7CiAKLSAgICBpZiAoIHJndC0+Z3RfdmVyc2lvbiA9
PSAxICkKKyAgICBpZiAoIGV2YWx1YXRlX25vc3BlYyhyZ3QtPmd0X3ZlcnNpb24gPT0gMSkgKQog
ICAgIHsKICAgICAgICAgc2hhMiA9IE5VTEw7CiAgICAgICAgIHN0YXR1cyA9ICZzaGFoLT5mbGFn
czsKQEAgLTMyNjUsNyArMzI3NSw3IEBAIHN3YXBfZ3JhbnRfcmVmKGdyYW50X3JlZl90IHJlZl9h
LCBncmFudF9yZWZfdCByZWZfYikKICAgICBpZiAoIGFjdF9iLT5waW4gKQogICAgICAgICBQSU5f
RkFJTChvdXQsIEdOVFNUX2VhZ2FpbiwgInJlZiBiICUjeCBidXN5XG4iLCByZWZfYik7CiAKLSAg
ICBpZiAoIGd0LT5ndF92ZXJzaW9uID09IDEgKQorICAgIGlmICggZXZhbHVhdGVfbm9zcGVjKGd0
LT5ndF92ZXJzaW9uID09IDEpICkKICAgICB7CiAgICAgICAgIGdyYW50X2VudHJ5X3YxX3Qgc2hh
cmVkOwogCkBAIC0zODE0LDcgKzM4MjQsNyBAQCBpbnQgbWVtX3NoYXJpbmdfZ3JlZl90b19nZm4o
c3RydWN0IGdyYW50X3RhYmxlICpndCwgZ3JhbnRfcmVmX3QgcmVmLAogICAgICAgICByYyA9IC1F
SU5WQUw7CiAgICAgZWxzZSBpZiAoIHJlZiA+PSBucl9ncmFudF9lbnRyaWVzKGd0KSApCiAgICAg
ICAgIHJjID0gLUVOT0VOVDsKLSAgICBlbHNlIGlmICggZ3QtPmd0X3ZlcnNpb24gPT0gMSApCisg
ICAgZWxzZSBpZiAoIGV2YWx1YXRlX25vc3BlYyhndC0+Z3RfdmVyc2lvbiA9PSAxKSApCiAgICAg
ewogICAgICAgICBjb25zdCBncmFudF9lbnRyeV92MV90ICpzaGExID0gJnNoYXJlZF9lbnRyeV92
MShndCwgcmVmKTsKIApAQCAtMzgzNiw3ICszODQ2LDcgQEAgaW50IG1lbV9zaGFyaW5nX2dyZWZf
dG9fZ2ZuKHN0cnVjdCBncmFudF90YWJsZSAqZ3QsIGdyYW50X3JlZl90IHJlZiwKICAgICAgICAg
cmMgPSAtRU5YSU87CiAgICAgZWxzZSBpZiAoICFyYyAmJiBzdGF0dXMgKQogICAgIHsKLSAgICAg
ICAgaWYgKCBndC0+Z3RfdmVyc2lvbiA9PSAxICkKKyAgICAgICAgaWYgKCBldmFsdWF0ZV9ub3Nw
ZWMoZ3QtPmd0X3ZlcnNpb24gPT0gMSkgKQogICAgICAgICAgICAgKnN0YXR1cyA9IGZsYWdzOwog
ICAgICAgICBlbHNlCiAgICAgICAgICAgICAqc3RhdHVzID0gc3RhdHVzX2VudHJ5KGd0LCByZWYp
OwpAQCAtMzg1Niw2ICszODY2LDkgQEAgc3RhdGljIGludCBnbnR0YWJfZ2V0X3N0YXR1c19mcmFt
ZV9tZm4oc3RydWN0IGRvbWFpbiAqZCwKIAogICAgIEFTU0VSVChndC0+Z3RfdmVyc2lvbiA9PSAy
KTsKIAorICAgIC8qIE1ha2Ugc3VyZSB3ZSBoYXZlIHZlcnNpb24gZXF1YWwgdG8gMiBldmVuIHVu
ZGVyIHNwZWN1bGF0aW9uICovCisgICAgYmxvY2tfc3BlY3VsYXRpb24oKTsKKwogICAgIGlmICgg
aWR4ID49IG5yX3N0YXR1c19mcmFtZXMoZ3QpICkKICAgICB7CiAgICAgICAgIHVuc2lnbmVkIGxv
bmcgbnJfc3RhdHVzOwpAQCAtMzkyMiw3ICszOTM1LDcgQEAgaW50IGdudHRhYl9tYXBfZnJhbWUo
c3RydWN0IGRvbWFpbiAqZCwgdW5zaWduZWQgbG9uZyBpZHgsIGdmbl90IGdmbiwgbWZuX3QgKm1m
bikKIAogICAgIGdyYW50X3dyaXRlX2xvY2soZ3QpOwogCi0gICAgaWYgKCBndC0+Z3RfdmVyc2lv
biA9PSAyICYmIChpZHggJiBYRU5NQVBJRFhfZ3JhbnRfdGFibGVfc3RhdHVzKSApCisgICAgaWYg
KCBldmFsdWF0ZV9ub3NwZWMoZ3QtPmd0X3ZlcnNpb24gPT0gMikgJiYgKGlkeCAmIFhFTk1BUElE
WF9ncmFudF90YWJsZV9zdGF0dXMpICkKICAgICB7CiAgICAgICAgIGlkeCAmPSB+WEVOTUFQSURY
X2dyYW50X3RhYmxlX3N0YXR1czsKICAgICAgICAgc3RhdHVzID0gdHJ1ZTsKLS0gCjIuNy40CgoK
CgpBbWF6b24gRGV2ZWxvcG1lbnQgQ2VudGVyIEdlcm1hbnkgR21iSApLcmF1c2Vuc3RyLiAzOAox
MDExNyBCZXJsaW4KR2VzY2hhZWZ0c2Z1ZWhydW5nOiBDaHJpc3RpYW4gU2NobGFlZ2VyLCBSYWxm
IEhlcmJyaWNoCkVpbmdldHJhZ2VuIGFtIEFtdHNnZXJpY2h0IENoYXJsb3R0ZW5idXJnIHVudGVy
IEhSQiAxNDkxNzMgQgpTaXR6OiBCZXJsaW4KVXN0LUlEOiBERSAyODkgMjM3IDg3OQoKCgoKX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1h
aWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54
ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

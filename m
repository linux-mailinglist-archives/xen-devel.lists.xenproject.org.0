Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 8BFA9EA30A
	for <lists+xen-devel@lfdr.de>; Wed, 30 Oct 2019 19:09:38 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iPsNb-0003dN-4Y; Wed, 30 Oct 2019 18:07:35 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=Jdra=YX=citrix.com=anthony.perard@srs-us1.protection.inumbo.net>)
 id 1iPsNZ-0003cf-Hz
 for xen-devel@lists.xenproject.org; Wed, 30 Oct 2019 18:07:33 +0000
X-Inumbo-ID: 1723b28c-fb40-11e9-9534-12813bfff9fa
Received: from esa2.hc3370-68.iphmx.com (unknown [216.71.145.153])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 1723b28c-fb40-11e9-9534-12813bfff9fa;
 Wed, 30 Oct 2019 18:07:09 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1572458830;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=OfOXjorivbLT4PbaawAwzKLX6dVbZ6pTYAMsz1FPAE4=;
 b=J+caZEMSUWyopP7u3mYL3PsTtTeWdQlaeroiiK2m8quPZZQdIrSsc7+F
 mBVdlA2rcbtKTFP56kQDgPKFzJRRTOQ8Np61GPnMqe4tRzWiACz85Dbku
 oz9ThzRv3cLBOQXSudr7gNTpWUD6jpTuNDbEX1QUQ4jN1A+0mGO3itZqh Y=;
Authentication-Results: esa2.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=anthony.perard@citrix.com;
 spf=Pass smtp.mailfrom=anthony.perard@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa2.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 anthony.perard@citrix.com) identity=pra;
 client-ip=162.221.158.21; receiver=esa2.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="anthony.perard@citrix.com";
 x-conformance=sidf_compatible
Received-SPF: Pass (esa2.hc3370-68.iphmx.com: domain of
 anthony.perard@citrix.com designates 162.221.158.21 as
 permitted sender) identity=mailfrom;
 client-ip=162.221.158.21; receiver=esa2.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="anthony.perard@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83
 ip4:168.245.78.127 ~all"
Received-SPF: None (esa2.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa2.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: FKnDAV7oJ2RF9VcWb3UYAYcEfsGUL6QPahW8AOYF+pPmSq2j6p8Bdl2jgzJsH6Hk/Ekbtp3tdN
 eIxVidQh9/cBlaPMirHGpkxE9+FwDilxh2r8mGEjQemFckX859l8W88Cq6LJmqDSNtkXzvfpEb
 pj0aerQ1QmulfLj6TfwnJ+t3br63XiZ1/DprYYGwfgoUkX8JbAWJrZToEoSd9Xx23wI+QL0l6p
 hb+1QvOsLTMsrSjPNr4ipYQ6W9iv6rp6B//zcLNZUXCKHYl2sszSeAPTz3ec6RY2q/rJl/miBb
 QfY=
X-SBRS: 2.7
X-MesageID: 7637912
X-Ironport-Server: esa2.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.68,248,1569297600"; 
   d="scan'208";a="7637912"
From: Anthony PERARD <anthony.perard@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Wed, 30 Oct 2019 18:07:04 +0000
Message-ID: <20191030180704.261320-7-anthony.perard@citrix.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191030180704.261320-1-anthony.perard@citrix.com>
References: <20191030180704.261320-1-anthony.perard@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [XEN PATCH for-4.13 v2 6/6] libxl_qmp: Have a lock for
 QMP socket access
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Anthony PERARD <anthony.perard@citrix.com>,
 =?UTF-8?q?J=C3=BCrgen=20Gro=C3=9F?= <jgross@suse.com>, Ian
 Jackson <ian.jackson@eu.citrix.com>, Wei Liu <wl@xen.org>,
 Sander Eikelenboom <linux@eikelenboom.it>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhpcyBwYXRjaCB3b3JrYXJvdW5kIHRoZSBmYWN0IHRoYXQgaXQncyBub3QgcG9zc2libGUgdG8g
Y29ubmVjdAptdWx0aXBsZSB0aW1lIHRvIGEgc2luZ2xlIFFNUCBzb2NrZXQuIFFFTVUgbGlzdGVu
IG9uIHRoZSBzb2NrZXQgd2l0aAphIGJhY2tsb2cgdmFsdWUgb2YgMSwgd2hpY2ggbWVhbiB0aGF0
IG9uIExpbnV4IHdoZW4gY29uY3VycmVudCB0aHJlYWQKY2FsbCBjb25uZWN0KCkgb24gdGhlIHNv
Y2tldCwgdGhleSBnZXQgRUFHQUlOLgoKQmFja2dyb3VuZDoKICAgIFRoaXMgaGFwcGVucyB3aGVu
IGF0dGVtcHRpbmcgdG8gY3JlYXRlIGEgZ3Vlc3Qgd2l0aCBtdWx0aXBsZQogICAgcGNpIGRldmlj
ZXMgcGFzc3Rocm91Z2gsIGxpYnhsIGNyZWF0ZXMgb25lIGNvbm5lY3Rpb24gcGVyIGRldmljZSB0
bwogICAgYXR0YWNoIGFuZCBleGVjdXRlIGNvbm5lY3QoKSBvbiBhbGwgYXQgb25jZSBiZWZvcmUg
YW55IHNpbmdsZQogICAgY29ubmVjdGlvbiBoYXMgZmluaXNoZWQuCgpUbyB3b3JrIGFyb3VuZCB0
aGlzLCB3ZSB1c2UgYSBuZXcgbG9jay4KCkVycm9yIGhhbmRsaW5nIG9mIGNvbm5lY3QoKSBhbmQg
bG9jaygpIGlzIGEgYml0IGF3a3dhcmQgYXMKbGlieGxfX2V2X3FtcF9zZW5kKCkgZG9lc24ndCBh
bGxvdyB0byBjYWxsIHRoZSBjYWxsYmFjayBzeW5jaHJvbm91c2x5LgpTbyB3ZSBzZXR1cCBhIHRp
bWVyIHRvIGhhdmUgYSBjYWxsYmFjayB0aGF0IGhhcyBiZWVuIGNhbGxlZAphc3luY2hyb25vdXNs
eS4gV2UgdXNlIHRoZSBfYWJzIHZhcmlhbnQgaXQgZG9lcyBzdHJpY3RseSBsZXNzIHRoYW4KX3Jl
bCwgdGh1cyBhdm9pZGluZyB1bm5lY2Vzc2FyeSBjb2RlIHRoYXQgY291bGQgcmV0dXJuIGFuIGVy
cm9yCih1bm5lY2Vzc2FyeSBiZWNhdXNlIHdlIG9ubHkgbmVlZCB0byBoYXZlIHRoZSBjYWxsYmFj
ayBiZWVuIGNhbGxlZApBU0FQKS4KClJlcG9ydGVkLWJ5OiBTYW5kZXIgRWlrZWxlbmJvb20gPGxp
bnV4QGVpa2VsZW5ib29tLml0PgpTaWduZWQtb2ZmLWJ5OiBBbnRob255IFBFUkFSRCA8YW50aG9u
eS5wZXJhcmRAY2l0cml4LmNvbT4KLS0tCgpOb3RlczoKICAgIHYyOgogICAgLSBIYW5kbGUgZXJy
b3IgcGF0aAoKIHRvb2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmMgfCAgIDUgKysKIHRvb2xzL2xp
YnhsL2xpYnhsX2ludGVybmFsLmggfCAgIDkgKysrCiB0b29scy9saWJ4bC9saWJ4bF9xbXAuYyAg
ICAgIHwgMTA5ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKy0tLS0tCiAzIGZpbGVzIGNo
YW5nZWQsIDEwOCBpbnNlcnRpb25zKCspLCAxNSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS90
b29scy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5jIGIvdG9vbHMvbGlieGwvbGlieGxfaW50ZXJuYWwu
YwppbmRleCBiMjA4NDE1N2U0Y2QuLmJhNTYzNzM1OGU3YyAxMDA2NDQKLS0tIGEvdG9vbHMvbGli
eGwvbGlieGxfaW50ZXJuYWwuYworKysgYi90b29scy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5jCkBA
IC01OTAsNiArNTkwLDExIEBAIHZvaWQgbGlieGxfX2V2X2RldmxvY2tfaW5pdChsaWJ4bF9fZXZf
c2xvd2xvY2sgKmxvY2spCiAgICAgZXZfc2xvd2xvY2tfaW5pdF9pbnRlcm5hbChsb2NrLCAibGli
eGwtZGV2aWNlLWNoYW5nZXMtbG9jayIpOwogfQogCit2b2lkIGxpYnhsX19ldl9xbXBsb2NrX2lu
aXQobGlieGxfX2V2X3Nsb3dsb2NrICpsb2NrKQoreworICAgIGV2X3Nsb3dsb2NrX2luaXRfaW50
ZXJuYWwobG9jaywgInFtcC1zb2NrZXQtbG9jayIpOworfQorCiBzdGF0aWMgdm9pZCBldl9sb2Nr
X3ByZXBhcmVfZm9yayhsaWJ4bF9fZWdjICplZ2MsIGxpYnhsX19ldl9zbG93bG9jayAqbG9jayk7
CiBzdGF0aWMgdm9pZCBldl9sb2NrX2NoaWxkX2NhbGxiYWNrKGxpYnhsX19lZ2MgKmVnYywgbGli
eGxfX2V2X2NoaWxkICpjaGlsZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
cGlkX3QgcGlkLCBpbnQgc3RhdHVzKTsKZGlmZiAtLWdpdCBhL3Rvb2xzL2xpYnhsL2xpYnhsX2lu
dGVybmFsLmggYi90b29scy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5oCmluZGV4IGY5NTg5NWVhZTE3
ZC4uYjI0NGI1MDhmNGM2IDEwMDY0NAotLS0gYS90b29scy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5o
CisrKyBiL3Rvb2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmgKQEAgLTM3MSw2ICszNzEsOSBAQCBz
dHJ1Y3QgbGlieGxfX2V2X2NoaWxkIHsKICAqIHdoaWNoIG1heSB0YWtlIGEgc2lnbmlmaWNhbnQg
YW1vdW50IHRpbWUuCiAgKiBJdCBpcyB0byBiZSBhY3F1aXJlZCBieSBhbiBhbyBldmVudCBjYWxs
YmFjay4KICAqCisgKiBJZiBsaWJ4bF9fZXZfZGV2bG9jayBpcyBuZWVkZWQsIGl0IHNob3VsZCBi
ZSBhY3F1aXJlZCB3aGlsZSBldmVyeQorICogbGlieGxfX2V2X3FtcCBhcmUgSWRsZSBmb3IgdGhl
IGN1cnJlbnQgZG9tYWluLgorICoKICAqIEl0IGlzIHRvIGJlIGFjcXVpcmVkIHdoZW4gYWRkaW5n
L3JlbW92aW5nIGRldmljZXMgb3IgbWFraW5nIGNoYW5nZXMKICAqIHRvIHRoZW0gd2hlbiB0aGlz
IGlzIGEgc2xvdyBvcGVyYXRpb24gYW5kIGpzb25fbG9jayBpc24ndCBhcHByb3ByaWF0ZS4KICAq
CkBAIC00MTEsNiArNDE0LDcgQEAgc3RydWN0IGxpYnhsX19ldl9zbG93bG9jayB7CiAgICAgYm9v
bCBoZWxkOwogfTsKIF9oaWRkZW4gdm9pZCBsaWJ4bF9fZXZfZGV2bG9ja19pbml0KGxpYnhsX19l
dl9zbG93bG9jayAqKTsKK19oaWRkZW4gdm9pZCBsaWJ4bF9fZXZfcW1wbG9ja19pbml0KGxpYnhs
X19ldl9zbG93bG9jayAqKTsKIF9oaWRkZW4gdm9pZCBsaWJ4bF9fZXZfc2xvd2xvY2tfbG9jayhs
aWJ4bF9fZWdjICosIGxpYnhsX19ldl9zbG93bG9jayAqKTsKIF9oaWRkZW4gdm9pZCBsaWJ4bF9f
ZXZfc2xvd2xvY2tfdW5sb2NrKGxpYnhsX19nYyAqLCBsaWJ4bF9fZXZfc2xvd2xvY2sgKik7CiBf
aGlkZGVuIHZvaWQgbGlieGxfX2V2X3Nsb3dsb2NrX2Rpc3Bvc2UobGlieGxfX2djICosIGxpYnhs
X19ldl9zbG93bG9jayAqKTsKQEAgLTQ3OSw2ICs0ODMsOCBAQCBfaGlkZGVuIHZvaWQgbGlieGxf
X2V2X3FtcF9kaXNwb3NlKGxpYnhsX19nYyAqZ2MsIGxpYnhsX19ldl9xbXAgKmV2KTsKIHR5cGVk
ZWYgZW51bSB7CiAgICAgLyogaW5pdGlhbCBzdGF0ZSAqLwogICAgIHFtcF9zdGF0ZV9kaXNjb25u
ZWN0ZWQgPSAxLAorICAgIC8qIHdhaXRpbmcgZm9yIGxvY2sgKi8KKyAgICBxbXBfc3RhdGVfd2Fp
dGluZ19sb2NrLAogICAgIC8qIGNvbm5lY3RlZCB0byBRTVAgc29ja2V0LCB3YWl0aW5nIGZvciBn
cmVldGluZyBtZXNzYWdlICovCiAgICAgcW1wX3N0YXRlX2Nvbm5lY3RpbmcsCiAgICAgLyogcW1w
X2NhcGFiaWxpdGllcyBjb21tYW5kIHNlbnQsIHdhaXRpbmcgZm9yIHJlcGx5ICovCkBAIC01MTIs
NiArNTE4LDkgQEAgc3RydWN0IGxpYnhsX19ldl9xbXAgewogICAgIGxpYnhsX19jYXJlZmQgKmNm
ZDsKICAgICBsaWJ4bF9fZXZfZmQgZWZkOwogICAgIGxpYnhsX19xbXBfc3RhdGUgc3RhdGU7Cisg
ICAgbGlieGxfX2V2X3Nsb3dsb2NrIGxvY2s7CisgICAgbGlieGxfX2V2X3RpbWUgZXRpbWU7Cisg
ICAgaW50IHJjOwogICAgIGludCBpZDsKICAgICBpbnQgbmV4dF9pZDsgICAgICAgIC8qIG5leHQg
aWQgdG8gdXNlICovCiAgICAgLyogcmVjZWl2ZSBidWZmZXIgKi8KZGlmZiAtLWdpdCBhL3Rvb2xz
L2xpYnhsL2xpYnhsX3FtcC5jIGIvdG9vbHMvbGlieGwvbGlieGxfcW1wLmMKaW5kZXggZjBlMGI1
MGJkMWM1Li4yMDg3YTg1ZTMyMWQgMTAwNjQ0Ci0tLSBhL3Rvb2xzL2xpYnhsL2xpYnhsX3FtcC5j
CisrKyBiL3Rvb2xzL2xpYnhsL2xpYnhsX3FtcC5jCkBAIC0xMDg0LDYgKzEwODQsNyBAQCBzdGF0
aWMgdm9pZCBkbV9zdGF0ZV9zYXZlZChsaWJ4bF9fZWdjICplZ2MsIGxpYnhsX19ldl9xbXAgKmV2
LAogICoKICAqIHFtcF9zdGF0ZSAgICAgRXh0ZXJuYWwgICBjZmQgICAgZWZkICAgICBpZCAgICAg
cnhfYnVmKiB0eF9idWYqIG1zZyoKICAqIGRpc2Nvbm5lY3RlZCAgIElkbGUgICAgICAgTlVMTCAg
IElkbGUgICAgcmVzZXQgIGZyZWUgICAgZnJlZSAgICBmcmVlCisgKiB3YWl0aW5nX2xvY2sgICBB
Y3RpdmUgICAgIG9wZW4gICBJZGxlICAgIHJlc2V0ICB1c2VkICAgIGZyZWUgICAgc2V0CiAgKiBj
b25uZWN0aW5nICAgICBBY3RpdmUgICAgIG9wZW4gICBJTiAgICAgIHJlc2V0ICB1c2VkICAgIGZy
ZWUgICAgc2V0CiAgKiBjYXAubmVnICAgICAgICBBY3RpdmUgICAgIG9wZW4gICBJTnxPVVQgIHNl
bnQgICB1c2VkICAgIGNhcF9uZWcgc2V0CiAgKiBjYXAubmVnICAgICAgICBBY3RpdmUgICAgIG9w
ZW4gICBJTiAgICAgIHNlbnQgICB1c2VkICAgIGZyZWUgICAgc2V0CkBAIC0xMTE4LDcgKzExMTks
OCBAQCBzdGF0aWMgdm9pZCBkbV9zdGF0ZV9zYXZlZChsaWJ4bF9fZWdjICplZ2MsIGxpYnhsX19l
dl9xbXAgKmV2LAogICogICAgIG1zZ19pZCAgICAgICAgICAgMCAgICAgaWQgYXNzb2N0aWF0ZWQg
d2l0aCB0aGUgY29tbWFuZCBpbiBgbXNnYAogICoKICAqIC0gQWxsb3dlZCBpbnRlcm5hbCBzdGF0
ZSB0cmFuc2l0aW9uOgotICogZGlzY29ubmVjdGVkICAgICAgICAgICAgICAgICAgICAgLT4gY29u
bmVjdGluZworICogZGlzY29ubmVjdGVkICAgICAgICAgICAgICAgICAgICAgLT4gd2FpdGluZ19s
b2NrCisgKiB3YWl0aW5nX2xvY2sgICAgICAgICAgICAgICAgICAgICAtPiBjb25uZWN0aW5nCiAg
KiBjb25uZWN0aW9uICAgICAgICAgICAgICAgICAgICAgICAtPiBjYXBhYmlsaXR5X25lZ290aWF0
aW9uCiAgKiBjYXBhYmlsaXR5X25lZ290aWF0aW9uL2Nvbm5lY3RlZCAtPiB3YWl0aW5nX3JlcGx5
CiAgKiB3YWl0aW5nX3JlcGx5ICAgICAgICAgICAgICAgICAgICAtPiBjb25uZWN0ZWQKQEAgLTEx
NTMsNiArMTE1NSwxMCBAQCBzdGF0aWMgdm9pZCBxbXBfZXZfZW5zdXJlX3JlYWRpbmdfd3JpdGlu
ZyhsaWJ4bF9fZ2MgKmdjLCBsaWJ4bF9fZXZfcW1wICpldikKIHsKICAgICBzaG9ydCBldmVudHMg
PSBQT0xMSU47CiAKKyAgICBpZiAoZXYtPnN0YXRlID09IHFtcF9zdGF0ZV93YWl0aW5nX2xvY2sp
CisgICAgICAgIC8qIFdlIGNhbid0IG1vZGlmaWUgdGhlIGVmZCB5ZXQsIGFzIGl0IGlzbid0IHJl
Z2lzdGVyZWQuICovCisgICAgICAgIHJldHVybjsKKwogICAgIGlmIChldi0+dHhfYnVmKQogICAg
ICAgICBldmVudHMgfD0gUE9MTE9VVDsKICAgICBlbHNlIGlmICgoZXYtPnN0YXRlID09IHFtcF9z
dGF0ZV93YWl0aW5nX3JlcGx5KSAmJiBldi0+bXNnKQpAQCAtMTE2OCw5ICsxMTc0LDEyIEBAIHN0
YXRpYyB2b2lkIHFtcF9ldl9zZXRfc3RhdGUobGlieGxfX2djICpnYywgbGlieGxfX2V2X3FtcCAq
ZXYsCiAgICAgc3dpdGNoIChuZXdfc3RhdGUpIHsKICAgICBjYXNlIHFtcF9zdGF0ZV9kaXNjb25u
ZWN0ZWQ6CiAgICAgICAgIGJyZWFrOwotICAgIGNhc2UgcW1wX3N0YXRlX2Nvbm5lY3Rpbmc6Cisg
ICAgY2FzZSBxbXBfc3RhdGVfd2FpdGluZ19sb2NrOgogICAgICAgICBhc3NlcnQoZXYtPnN0YXRl
ID09IHFtcF9zdGF0ZV9kaXNjb25uZWN0ZWQpOwogICAgICAgICBicmVhazsKKyAgICBjYXNlIHFt
cF9zdGF0ZV9jb25uZWN0aW5nOgorICAgICAgICBhc3NlcnQoZXYtPnN0YXRlID09IHFtcF9zdGF0
ZV93YWl0aW5nX2xvY2spOworICAgICAgICBicmVhazsKICAgICBjYXNlIHFtcF9zdGF0ZV9jYXBh
YmlsaXR5X25lZ290aWF0aW9uOgogICAgICAgICBhc3NlcnQoZXYtPnN0YXRlID09IHFtcF9zdGF0
ZV9jb25uZWN0aW5nKTsKICAgICAgICAgYnJlYWs7CkBAIC0xMjMxLDIwICsxMjQwLDIzIEBAIHN0
YXRpYyBpbnQgcW1wX2Vycm9yX2NsYXNzX3RvX2xpYnhsX2Vycm9yX2NvZGUobGlieGxfX2djICpn
YywKIAogLyogU2V0dXAgY29ubmVjdGlvbiAqLwogCi1zdGF0aWMgaW50IHFtcF9ldl9jb25uZWN0
KGxpYnhsX19nYyAqZ2MsIGxpYnhsX19ldl9xbXAgKmV2KQotICAgIC8qIGRpc2Nvbm5lY3RlZCAt
PiBjb25uZWN0aW5nIGJ1dCB3aXRoIGBtc2dgIGZyZWUKK3N0YXRpYyB2b2lkIHFtcF9ldl9sb2Nr
X2FxdWlyZWQobGlieGxfX2VnYyAqLCBsaWJ4bF9fZXZfc2xvd2xvY2sgKiwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgaW50IHJjKTsKK3N0YXRpYyB2b2lkIGxvY2tfZXJyb3JfY2Fs
bGJhY2sobGlieGxfX2VnYyAqLCBsaWJ4bF9fZXZfdGltZSAqLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBjb25zdCBzdHJ1Y3QgdGltZXZhbCAqLCBpbnQgcmMpOworCitzdGF0aWMg
aW50IHFtcF9ldl9jb25uZWN0KGxpYnhsX19lZ2MgKmVnYywgbGlieGxfX2V2X3FtcCAqZXYpCisg
ICAgLyogZGlzY29ubmVjdGVkIC0+IHdhaXRpbmdfbG9jay9jb25uZWN0aW5nIGJ1dCB3aXRoIGBt
c2dgIGZyZWUKICAgICAgKiBvbiBlcnJvcjogYnJva2VuICovCiB7CisgICAgRUdDX0dDOwogICAg
IGludCBmZDsKLSAgICBpbnQgcmMsIHI7Ci0gICAgc3RydWN0IHNvY2thZGRyX3VuIHVuOwotICAg
IGNvbnN0IGNoYXIgKnFtcF9zb2NrZXRfcGF0aDsKLQotICAgIGFzc2VydChldi0+c3RhdGUgPT0g
cW1wX3N0YXRlX2Rpc2Nvbm5lY3RlZCk7CisgICAgaW50IHJjOwogCi0gICAgcW1wX3NvY2tldF9w
YXRoID0gbGlieGxfX3FlbXVfcW1wX3BhdGgoZ2MsIGV2LT5kb21pZCk7CisgICAgLyogQ29udmVu
aWVuY2UgYWxpYXNlcyAqLworICAgIGxpYnhsX19ldl9zbG93bG9jayAqbG9jayA9ICZldi0+bG9j
azsKIAotICAgIExPR0QoREVCVUcsIGV2LT5kb21pZCwgIkNvbm5lY3RpbmcgdG8gJXMiLCBxbXBf
c29ja2V0X3BhdGgpOworICAgIGFzc2VydChldi0+c3RhdGUgPT0gcW1wX3N0YXRlX2Rpc2Nvbm5l
Y3RlZCk7CiAKICAgICBsaWJ4bF9fY2FyZWZkX2JlZ2luKCk7CiAgICAgZmQgPSBzb2NrZXQoQUZf
VU5JWCwgU09DS19TVFJFQU0sIDApOwpAQCAtMTI1OCw2ICsxMjcwLDM0IEBAIHN0YXRpYyBpbnQg
cW1wX2V2X2Nvbm5lY3QobGlieGxfX2djICpnYywgbGlieGxfX2V2X3FtcCAqZXYpCiAgICAgaWYg
KHJjKQogICAgICAgICBnb3RvIG91dDsKIAorICAgIHFtcF9ldl9zZXRfc3RhdGUoZ2MsIGV2LCBx
bXBfc3RhdGVfd2FpdGluZ19sb2NrKTsKKworICAgIGxvY2stPmFvID0gZXYtPmFvOworICAgIGxv
Y2stPmRvbWlkID0gZXYtPmRvbWlkOworICAgIGxvY2stPmNhbGxiYWNrID0gcW1wX2V2X2xvY2tf
YXF1aXJlZDsKKyAgICBsaWJ4bF9fZXZfc2xvd2xvY2tfbG9jayhlZ2MsICZldi0+bG9jayk7CisK
KyAgICByZXR1cm4gMDsKKworb3V0OgorICAgIHJldHVybiByYzsKK30KKworc3RhdGljIHZvaWQg
cW1wX2V2X2xvY2tfYXF1aXJlZChsaWJ4bF9fZWdjICplZ2MsIGxpYnhsX19ldl9zbG93bG9jayAq
bG9jaywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IHJjKQoreworICAgIGxp
YnhsX19ldl9xbXAgKmV2ID0gQ09OVEFJTkVSX09GKGxvY2ssICpldiwgbG9jayk7CisgICAgRUdD
X0dDOworICAgIGNvbnN0IGNoYXIgKnFtcF9zb2NrZXRfcGF0aDsKKyAgICBzdHJ1Y3Qgc29ja2Fk
ZHJfdW4gdW47CisgICAgaW50IHI7CisKKyAgICBpZiAocmMpIGdvdG8gb3V0OworCisgICAgcW1w
X3NvY2tldF9wYXRoID0gbGlieGxfX3FlbXVfcW1wX3BhdGgoZ2MsIGV2LT5kb21pZCk7CisKKyAg
ICBMT0dEKERFQlVHLCBldi0+ZG9taWQsICJDb25uZWN0aW5nIHRvICVzIiwgcW1wX3NvY2tldF9w
YXRoKTsKKwogICAgIHJjID0gbGlieGxfX3ByZXBhcmVfc29ja2FkZHJfdW4oZ2MsICZ1biwgcW1w
X3NvY2tldF9wYXRoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIlFNUCBz
b2NrZXQiKTsKICAgICBpZiAocmMpCkBAIC0xMjc5LDEwICsxMzE5LDQzIEBAIHN0YXRpYyBpbnQg
cW1wX2V2X2Nvbm5lY3QobGlieGxfX2djICpnYywgbGlieGxfX2V2X3FtcCAqZXYpCiAKICAgICBx
bXBfZXZfc2V0X3N0YXRlKGdjLCBldiwgcW1wX3N0YXRlX2Nvbm5lY3RpbmcpOwogCi0gICAgcmV0
dXJuIDA7CisgICAgcmV0dXJuOwogCiBvdXQ6Ci0gICAgcmV0dXJuIHJjOworICAgIC8qIEFuIGVy
cm9yIG9jY3VycmVkIGFuZCB3ZSBuZWVkIHRvIGxldCB0aGUgY2FsbGVyIGtub3cuICBBdCB0aGlz
CisgICAgICogcG9pbnQsIHdlIGNhbiBvbmx5IGRvIHNvIHZpYSB0aGUgY2FsbGJhY2suIFVuZm9y
dHVuYXRlbHksIHRoZQorICAgICAqIGNhbGxiYWNrIG9mIGxpYnhsX19ldl9zbG93bG9ja19sb2Nr
KCkgbWlnaHQgYmUgY2FsbGVkIHN5bmNocm9ub3VzbHksCisgICAgICogYnV0IGxpYnhsX19ldl9x
bXBfc2VuZCgpIHByb21pc2UgdGhhdCBpdCB3aWxsIG5vdCBjYWxsIHRoZSBjYWxsYmFjaworICAg
ICAqIHN5bmNocm9ub3VzbHkuIFNvIHdlIGhhdmUgdG8gYXJyYW5nZSB0byBjYWxsIHRoZSBjYWxs
YmFjaworICAgICAqIGFzeW5jaHJvbm91c2x5LiAqLworICAgIGV2LT5yYyA9IHJjOworICAgIHN0
cnVjdCB0aW1ldmFsIG5vdyA9IHsgMCB9OworICAgIHJjID0gbGlieGxfX2V2X3RpbWVfcmVnaXN0
ZXJfYWJzKGV2LT5hbywgJmV2LT5ldGltZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBsb2NrX2Vycm9yX2NhbGxiYWNrLCBub3cpOworICAgIC8qIElmIHNldHRpbmcgdXAg
dGhlIHRpbWVyIGZhaWxlZCwgdGhlcmUgaXMgbm8gd2F5IHRvIHRlbGwgdGhlIGNhbGxlcgorICAg
ICAqIG9mIGxpYnhsX19ldl9xbXBfc2VuZCgpIHRoYXQgdGhlIGNvbm5lY3Rpb24gdG8gdGhlIFFN
UCBzb2NrZXQKKyAgICAgKiBmYWlsZWQuIEJ1dCB0aGV5IGFyZSBzdXBwb3NlZCB0byBoYXZlIGEg
dGltZXIgb2YgdGhlaXIgb3duLiAqLworICAgIGlmIChyYykKKyAgICAgICAgTE9HRChFUlJPUiwg
ZXYtPmRvbWlkLAorICAgICAgICAgICAgICJGYWlsZWQgdG8gc2V0dXAgYSBjYWxsYmFjayBjYWxs
LiByYz0lZCIsIHJjKTsKK30KKworc3RhdGljIHZvaWQgbG9ja19lcnJvcl9jYWxsYmFjayhsaWJ4
bF9fZWdjICplZ2MsIGxpYnhsX19ldl90aW1lICp0LAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBjb25zdCBzdHJ1Y3QgdGltZXZhbCAqcmVxdWVzdGVkX2FicywKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgaW50IHJjKQoreworICAgIEVHQ19HQzsKKyAgICBsaWJ4bF9f
ZXZfcW1wICpldiA9IENPTlRBSU5FUl9PRih0LCAqZXYsIGV0aW1lKTsKKworICAgIC8qIFdlIGFy
ZSBvbmx5IGludGVyZXN0ZWQgYnkgdGhlIGByYycgc2V0IGR1cmluZyB0aGUgc2V0dXAgb2YgdGhl
CisgICAgICogY29ubmVjdGlvbiB0byB0aGUgUU1QIHNvY2tldC4gKi8KKyAgICByYyA9IGV2LT5y
YzsKKworICAgIC8qIE9uIGVycm9yLCBkZWFsbG9jYXRlIGFsbCBwcml2YXRlIHJlc291cmNlcyAq
LworICAgIGxpYnhsX19ldl9xbXBfZGlzcG9zZShnYywgZXYpOworCisgICAgLyogQW5kIHRlbGwg
bGlieGxfX2V2X3FtcCB1c2VyIGFib3V0IHRoZSBlcnJvciAqLworICAgIGV2LT5jYWxsYmFjayhl
Z2MsIGV2LCBOVUxMLCByYyk7IC8qIG11c3QgYmUgbGFzdCAqLwogfQogCiAvKiBRTVAgRkQgY2Fs
bGJhY2tzICovCkBAIC0xNzc5LDExICsxODUyLDE1IEBAIHZvaWQgbGlieGxfX2V2X3FtcF9pbml0
KGxpYnhsX19ldl9xbXAgKmV2KQogICAgIGV2LT5xZW11X3ZlcnNpb24ubWFqb3IgPSAtMTsKICAg
ICBldi0+cWVtdV92ZXJzaW9uLm1pbm9yID0gLTE7CiAgICAgZXYtPnFlbXVfdmVyc2lvbi5taWNy
byA9IC0xOworCisgICAgbGlieGxfX2V2X3FtcGxvY2tfaW5pdCgmZXYtPmxvY2spOworICAgIGV2
LT5yYyA9IDA7CisgICAgbGlieGxfX2V2X3RpbWVfaW5pdCgmZXYtPmV0aW1lKTsKIH0KIAogaW50
IGxpYnhsX19ldl9xbXBfc2VuZChsaWJ4bF9fZWdjICplZ2MsIGxpYnhsX19ldl9xbXAgKmV2LAog
ICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGFyICpjbWQsIGxpYnhsX19qc29uX29iamVj
dCAqYXJncykKLSAgICAvKiBkaXNjb25uZWN0ZWQgLT4gY29ubmVjdGluZworICAgIC8qIGRpc2Nv
bm5lY3RlZCAtPiB3YWl0aW5nX2xvY2svY29ubmVjdGluZwogICAgICAqIGNvbm5lY3RlZCAtPiB3
YWl0aW5nX3JlcGx5ICh3aXRoIG1zZyBzZXQpCiAgICAgICogb24gZXJyb3I6IGRpc2Nvbm5lY3Rl
ZCAqLwogewpAQCAtMTc5OCw3ICsxODc1LDcgQEAgaW50IGxpYnhsX19ldl9xbXBfc2VuZChsaWJ4
bF9fZWdjICplZ2MsIGxpYnhsX19ldl9xbXAgKmV2LAogCiAgICAgLyogQ29ubmVjdCB0byBRRU1V
IGlmIG5vdCBhbHJlYWR5IGNvbm5lY3RlZCAqLwogICAgIGlmIChldi0+c3RhdGUgPT0gcW1wX3N0
YXRlX2Rpc2Nvbm5lY3RlZCkgewotICAgICAgICByYyA9IHFtcF9ldl9jb25uZWN0KGdjLCBldik7
CisgICAgICAgIHJjID0gcW1wX2V2X2Nvbm5lY3QoZWdjLCBldik7CiAgICAgICAgIGlmIChyYykK
ICAgICAgICAgICAgIGdvdG8gZXJyb3I7CiAgICAgfQpAQCAtMTgzMCw2ICsxOTA3LDggQEAgdm9p
ZCBsaWJ4bF9fZXZfcW1wX2Rpc3Bvc2UobGlieGxfX2djICpnYywgbGlieGxfX2V2X3FtcCAqZXYp
CiAKICAgICBsaWJ4bF9fZXZfZmRfZGVyZWdpc3RlcihnYywgJmV2LT5lZmQpOwogICAgIGxpYnhs
X19jYXJlZmRfY2xvc2UoZXYtPmNmZCk7CisgICAgbGlieGxfX2V2X3RpbWVfZGVyZWdpc3Rlcihn
YywgJmV2LT5ldGltZSk7CisgICAgbGlieGxfX2V2X3Nsb3dsb2NrX2Rpc3Bvc2UoZ2MsICZldi0+
bG9jayk7CiAKICAgICBsaWJ4bF9fZXZfcW1wX2luaXQoZXYpOwogfQotLSAKQW50aG9ueSBQRVJB
UkQKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4t
ZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczov
L2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 98418BB20A
	for <lists+xen-devel@lfdr.de>; Mon, 23 Sep 2019 12:14:27 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iCLID-000791-3W; Mon, 23 Sep 2019 10:10:05 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=iV5N=XS=gmail.com=wei.liu.xen@srs-us1.protection.inumbo.net>)
 id 1iCLIB-00071D-9F
 for xen-devel@lists.xenproject.org; Mon, 23 Sep 2019 10:10:03 +0000
X-Inumbo-ID: 42083da6-ddea-11e9-b76c-bc764e2007e4
Received: from mail-wm1-x341.google.com (unknown [2a00:1450:4864:20::341])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 42083da6-ddea-11e9-b76c-bc764e2007e4;
 Mon, 23 Sep 2019 10:09:41 +0000 (UTC)
Received: by mail-wm1-x341.google.com with SMTP id a6so9172509wma.5
 for <xen-devel@lists.xenproject.org>; Mon, 23 Sep 2019 03:09:41 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=sender:from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=faSPq0/FgKeXO1cnxCD0/aZRNuNgVtyb3U2iGwfHW2c=;
 b=Ix3DCsHFPzP3J3dL6O2hVzBd3LE9Un/nuiFBQcrq1KWyUftPQGzwsbLXnXk/5RAdbp
 rdEhtMpSeSdluGv1LAnaOzhr7lVx4ipZuODr5bXFRQtXWbfeM7SQBYGMGaN3JOK+AEIE
 iXD9VlYk0AfyBSGnjo/hUavTwnxilY5NsODhfTA2Dc7H7kJOxXVp0WSczR5p1s6xS4IN
 RuaV2/Mh44LqeSWJGyStcUtjq392q5QaSCnuvCqfsizgyMP6eoibIEya9lMa/b/w4ezf
 3aTPETLb9tcIVqH1TnbP1tRgLcc1l1u5pwPZ9VOvAEr7geJr4uP9fRVcHFSjp9Z7vszq
 VWaw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:sender:from:to:cc:subject:date:message-id
 :in-reply-to:references:mime-version:content-transfer-encoding;
 bh=faSPq0/FgKeXO1cnxCD0/aZRNuNgVtyb3U2iGwfHW2c=;
 b=QJnitIT5TtuhCcFrJvzDxVc+F5VdO2ezLw1BfOlrYYckfrU32sa819IYFbtUEdGfrh
 D4sptlAtMXbFg2EXjTHVpHJiF66UWM3qH9mV5x083XMzRx062nrfPhwNe/6X66tFVMUP
 EjpE1cXgGoFp7qJn4/R8F1DxcnAHMEnXDG1LkMLu9kZg6v2c7lJnKWTiDFvSecplVGQh
 HOtiGqF3mX/4Nhmu/WyV4ov+QO+dzR/uUfuWEgdB24Ly1QrJpDzwpBDY/f3W0faHq4vL
 fiAWQxkIe6ac6SM8/+ZmHk8qlyMBXwUvLioYxD+uzcb5nRdDenKOQQDa/pvbYOiezaIM
 f8Nw==
X-Gm-Message-State: APjAAAVgV0Roa8P7Wpf7IsCg530GI0P++pNEtJ7kv8XzoDblMD4mlSix
 f+jZNGIBcXmtmS5unSuEZDz6Gl87
X-Google-Smtp-Source: APXvYqwjh0Q6C3SRY+SzsVrgkwn4+OS9/PS6Ifq2LiKwvhdg3lABmd4ip5XFWOoA1xChqGi44NWjWg==
X-Received: by 2002:a7b:cd83:: with SMTP id y3mr13582130wmj.165.1569233380548; 
 Mon, 23 Sep 2019 03:09:40 -0700 (PDT)
Received: from debian.mshome.net (207.148.159.143.dyn.plus.net.
 [143.159.148.207])
 by smtp.gmail.com with ESMTPSA id s10sm18241662wmf.48.2019.09.23.03.09.39
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Mon, 23 Sep 2019 03:09:40 -0700 (PDT)
From: Wei Liu <wl@xen.org>
X-Google-Original-From: Wei Liu <liuwe@microsoft.com>
To: Xen Development List <xen-devel@lists.xenproject.org>
Date: Mon, 23 Sep 2019 11:09:28 +0100
Message-Id: <20190923100931.29670-6-liuwe@microsoft.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190923100931.29670-1-liuwe@microsoft.com>
References: <20190923100931.29670-1-liuwe@microsoft.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH for-next RFC 5/8] x86: factor out hypervisor
 agnostic code
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Wei Liu <liuwe@microsoft.com>, Wei Liu <wl@xen.org>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Michael Kelley <mikelley@microsoft.com>, Jan Beulich <jbeulich@suse.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhlIG9ubHkgaW1wbGVtZW50YXRpb24gdGhlcmUgaXMgWGVuLgoKTm8gZnVuY3Rpb25hbCBjaGFu
Z2UuCgpTaWduZWQtb2ZmLWJ5OiBXZWkgTGl1IDxsaXV3ZUBtaWNyb3NvZnQuY29tPgotLS0KIHhl
bi9hcmNoL3g4Ni9ndWVzdC9NYWtlZmlsZSAgICAgICAgICAgIHwgICAyICsKIHhlbi9hcmNoL3g4
Ni9ndWVzdC9oeXBlcnZpc29yLmMgICAgICAgIHwgMTEyICsrKysrKysrKysrKysrKysrKysrKysr
KysKIHhlbi9hcmNoL3g4Ni9ndWVzdC94ZW4veGVuLmMgICAgICAgICAgIHwgIDgxICstLS0tLS0t
LS0tLS0tLS0tLQogeGVuL2luY2x1ZGUvYXNtLXg4Ni9ndWVzdC5oICAgICAgICAgICAgfCAgIDEg
KwogeGVuL2luY2x1ZGUvYXNtLXg4Ni9ndWVzdC9oeXBlcnZpc29yLmggfCAgNTggKysrKysrKysr
KysrKwogeGVuL2luY2x1ZGUvYXNtLXg4Ni9ndWVzdC94ZW4uaCAgICAgICAgfCAgMjEgKystLS0K
IDYgZmlsZXMgY2hhbmdlZCwgMTgyIGluc2VydGlvbnMoKyksIDkzIGRlbGV0aW9ucygtKQogY3Jl
YXRlIG1vZGUgMTAwNjQ0IHhlbi9hcmNoL3g4Ni9ndWVzdC9oeXBlcnZpc29yLmMKIGNyZWF0ZSBt
b2RlIDEwMDY0NCB4ZW4vaW5jbHVkZS9hc20teDg2L2d1ZXN0L2h5cGVydmlzb3IuaAoKZGlmZiAt
LWdpdCBhL3hlbi9hcmNoL3g4Ni9ndWVzdC9NYWtlZmlsZSBiL3hlbi9hcmNoL3g4Ni9ndWVzdC9N
YWtlZmlsZQppbmRleCA2ODA2ZjA0OTQ3Li5mNjNkNjRiYmVlIDEwMDY0NAotLS0gYS94ZW4vYXJj
aC94ODYvZ3Vlc3QvTWFrZWZpbGUKKysrIGIveGVuL2FyY2gveDg2L2d1ZXN0L01ha2VmaWxlCkBA
IC0xICsxLDMgQEAKK29iai15ICs9IGh5cGVydmlzb3IubworCiBzdWJkaXItJChDT05GSUdfWEVO
X0dVRVNUKSArPSB4ZW4KZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9ndWVzdC9oeXBlcnZpc29y
LmMgYi94ZW4vYXJjaC94ODYvZ3Vlc3QvaHlwZXJ2aXNvci5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0
CmluZGV4IDAwMDAwMDAwMDAuLmIwYTcyNGJmMTMKLS0tIC9kZXYvbnVsbAorKysgYi94ZW4vYXJj
aC94ODYvZ3Vlc3QvaHlwZXJ2aXNvci5jCkBAIC0wLDAgKzEsMTEyIEBACisvKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqCisgKiBhcmNoL3g4Ni9ndWVzdC9oeXBlcnZpc29yLmMKKyAqCisgKiBTdXBwb3J0
IGZvciBkZXRlY3RpbmcgYW5kIHJ1bm5pbmcgdW5kZXIgYSBoeXBlcnZpc29yLgorICoKKyAqIFRo
aXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQv
b3IgbW9kaWZ5CisgKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1Ymxp
YyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQorICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlv
bjsgZWl0aGVyIHZlcnNpb24gMiBvZiB0aGUgTGljZW5zZSwgb3IKKyAqIChhdCB5b3VyIG9wdGlv
bikgYW55IGxhdGVyIHZlcnNpb24uCisgKgorICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVk
IGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCisgKiBidXQgV0lUSE9VVCBBTlkg
V0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgorICogTUVSQ0hB
TlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQor
ICogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KKyAqCisgKiBZ
b3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMg
TGljZW5zZQorICogYWxvbmcgd2l0aCB0aGlzIHByb2dyYW07IElmIG5vdCwgc2VlIDxodHRwOi8v
d3d3LmdudS5vcmcvbGljZW5zZXMvPi4KKyAqCisgKiBDb3B5cmlnaHQgKGMpIDIwMTcgQ2l0cml4
IFN5c3RlbXMgTHRkLgorICovCisKKyNpbmNsdWRlIDx4ZW4vaW5pdC5oPgorI2luY2x1ZGUgPHhl
bi9tbS5oPgorI2luY2x1ZGUgPHhlbi9yYW5nZXNldC5oPgorCisjaW5jbHVkZSA8YXNtL2d1ZXN0
Lmg+CisjaW5jbHVkZSA8YXNtL3Byb2Nlc3Nvci5oPgorCitzdGF0aWMgc3RydWN0IHJhbmdlc2V0
ICptZW07CisKK3ZvaWQgX19pbml0IHByb2JlX2h5cGVydmlzb3Iodm9pZCkKK3sKKyAgICAvKiBU
b28gZWFybHkgdG8gdXNlIGNwdV9oYXNfaHlwZXJ2aXNvciAqLworICAgIGlmICggIShjcHVpZF9l
Y3goMSkgJiBjcHVmZWF0X21hc2soWDg2X0ZFQVRVUkVfSFlQRVJWSVNPUikpICkKKyAgICAgICAg
cmV0dXJuOworCisgICAgcHJvYmVfeGVuKCk7Cit9CisKK3N0YXRpYyB2b2lkIF9faW5pdCBpbml0
X21lbW1hcCh2b2lkKQoreworICAgIHVuc2lnbmVkIGludCBpOworCisgICAgbWVtID0gcmFuZ2Vz
ZXRfbmV3KE5VTEwsICJob3N0IG1lbW9yeSBtYXAiLCAwKTsKKyAgICBpZiAoICFtZW0gKQorICAg
ICAgICBwYW5pYygiZmFpbGVkIHRvIGFsbG9jYXRlIFBGTiB1c2FnZSByYW5nZXNldFxuIik7CisK
KyAgICAvKgorICAgICAqIE1hcmsgdXAgdG8gdGhlIGxhc3QgbWVtb3J5IHBhZ2UgKG9yIDRHaUIp
IGFzIFJBTS4gVGhpcyBpcyBkb25lIGJlY2F1c2UKKyAgICAgKiBYZW4gZG9lc24ndCBrbm93IHRo
ZSBwb3NpdGlvbiBvZiBwb3NzaWJsZSBNTUlPIGhvbGVzLCBzbyBhdCBsZWFzdCB0cnkgdG8KKyAg
ICAgKiBhdm9pZCB0aGUga25vdyBNTUlPIGhvbGUgYmVsb3cgNEdpQi4gTm90ZSB0aGF0IHRoaXMg
aXMgc3ViamVjdCB0byBmdXR1cmUKKyAgICAgKiBkaXNjdXNzaW9uIGFuZCBpbXByb3ZlbWVudHMu
CisgICAgICovCisgICAgaWYgKCByYW5nZXNldF9hZGRfcmFuZ2UobWVtLCAwLCBtYXhfdCh1bnNp
Z25lZCBsb25nLCBtYXhfcGFnZSAtIDEsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBQRk5fRE9XTihHQig0KSAtIDEpKSkgKQorICAgICAgICBwYW5pYygidW5hYmxl
IHRvIGFkZCBSQU0gdG8gaW4tdXNlIFBGTiByYW5nZXNldFxuIik7CisKKyAgICBmb3IgKCBpID0g
MDsgaSA8IGU4MjAubnJfbWFwOyBpKysgKQorICAgIHsKKyAgICAgICAgc3RydWN0IGU4MjBlbnRy
eSAqZSA9ICZlODIwLm1hcFtpXTsKKworICAgICAgICBpZiAoIHJhbmdlc2V0X2FkZF9yYW5nZSht
ZW0sIFBGTl9ET1dOKGUtPmFkZHIpLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQ
Rk5fVVAoZS0+YWRkciArIGUtPnNpemUgLSAxKSkgKQorICAgICAgICAgICAgcGFuaWMoInVuYWJs
ZSB0byBhZGQgcmFuZ2UgWyUjbHgsICUjbHhdIHRvIGluLXVzZSBQRk4gcmFuZ2VzZXRcbiIsCisg
ICAgICAgICAgICAgICAgICBQRk5fRE9XTihlLT5hZGRyKSwgUEZOX1VQKGUtPmFkZHIgKyBlLT5z
aXplIC0gMSkpOworICAgIH0KK30KKwordm9pZCBfX2luaXQgaHlwZXJ2aXNvcl9zZXR1cCh2b2lk
KQoreworICAgIGluaXRfbWVtbWFwKCk7CisKKyAgICB4ZW5fc2V0dXAoKTsKK30KKwordm9pZCBo
eXBlcnZpc29yX2FwX3NldHVwKHZvaWQpCit7CisgICAgeGVuX2FwX3NldHVwKCk7Cit9CisKK2lu
dCBoeXBlcnZpc29yX2FsbG9jX3VudXNlZF9wYWdlKG1mbl90ICptZm4pCit7CisgICAgdW5zaWdu
ZWQgbG9uZyBtOworICAgIGludCByYzsKKworICAgIHJjID0gcmFuZ2VzZXRfY2xhaW1fcmFuZ2Uo
bWVtLCAxLCAmbSk7CisgICAgaWYgKCAhcmMgKQorICAgICAgICAqbWZuID0gX21mbihtKTsKKwor
ICAgIHJldHVybiByYzsKK30KKworaW50IGh5cGVydmlzb3JfZnJlZV91bnVzZWRfcGFnZShtZm5f
dCBtZm4pCit7CisgICAgcmV0dXJuIHJhbmdlc2V0X3JlbW92ZV9yYW5nZShtZW0sIG1mbl94KG1m
biksIG1mbl94KG1mbikpOworfQorCit2b2lkIGh5cGVydmlzb3JfcmVzdW1lKHZvaWQpCit7Cisg
ICAgeGVuX3Jlc3VtZSgpOworfQorCisvKgorICogTG9jYWwgdmFyaWFibGVzOgorICogbW9kZTog
QworICogYy1maWxlLXN0eWxlOiAiQlNEIgorICogYy1iYXNpYy1vZmZzZXQ6IDQKKyAqIHRhYi13
aWR0aDogNAorICogaW5kZW50LXRhYnMtbW9kZTogbmlsCisgKiBFbmQ6CisgKi8KKwpkaWZmIC0t
Z2l0IGEveGVuL2FyY2gveDg2L2d1ZXN0L3hlbi94ZW4uYyBiL3hlbi9hcmNoL3g4Ni9ndWVzdC94
ZW4veGVuLmMKaW5kZXggZjkzYzhmYmQxYy4uYTczMGU2YWQxYiAxMDA2NDQKLS0tIGEveGVuL2Fy
Y2gveDg2L2d1ZXN0L3hlbi94ZW4uYworKysgYi94ZW4vYXJjaC94ODYvZ3Vlc3QveGVuL3hlbi5j
CkBAIC0zOSw3ICszOSw2IEBAIGJvb2wgX19yZWFkX21vc3RseSB4ZW5fZ3Vlc3Q7CiAKIF9fcmVh
ZF9tb3N0bHkgdWludDMyX3QgeGVuX2NwdWlkX2Jhc2U7CiBleHRlcm4gY2hhciBoeXBlcmNhbGxf
cGFnZVtdOwotc3RhdGljIHN0cnVjdCByYW5nZXNldCAqbWVtOwogCiBERUZJTkVfUEVSX0NQVSh1
bnNpZ25lZCBpbnQsIHZjcHVfaWQpOwogCkBAIC02NywxNSArNjYsMTEgQEAgc3RhdGljIHZvaWQg
X19pbml0IGZpbmRfeGVuX2xlYXZlcyh2b2lkKQogICAgIH0KIH0KIAotc3RhdGljIHZvaWQgX19p
bml0IHByb2JlX3hlbih2b2lkKQordm9pZCBfX2luaXQgcHJvYmVfeGVuKHZvaWQpCiB7CiAgICAg
aWYgKCB4ZW5fZ3Vlc3QgKQogICAgICAgICByZXR1cm47CiAKLSAgICAvKiBUb28gZWFybHkgdG8g
dXNlIGNwdV9oYXNfaHlwZXJ2aXNvciAqLwotICAgIGlmICggIShjcHVpZF9lY3goMSkgJiBjcHVm
ZWF0X21hc2soWDg2X0ZFQVRVUkVfSFlQRVJWSVNPUikpICkKLSAgICAgICAgcmV0dXJuOwotCiAg
ICAgZmluZF94ZW5fbGVhdmVzKCk7CiAKICAgICBpZiAoICF4ZW5fY3B1aWRfYmFzZSApCkBAIC04
NywxMSArODIsNiBAQCBzdGF0aWMgdm9pZCBfX2luaXQgcHJvYmVfeGVuKHZvaWQpCiAgICAgeGVu
X2d1ZXN0ID0gdHJ1ZTsKIH0KIAotdm9pZCBfX2luaXQgcHJvYmVfaHlwZXJ2aXNvcih2b2lkKQot
ewotICAgIHByb2JlX3hlbigpOwotfQotCiBzdGF0aWMgdm9pZCBtYXBfc2hhcmVkX2luZm8odm9p
ZCkKIHsKICAgICBtZm5fdCBtZm47CkBAIC0xNjYsMzUgKzE1Niw2IEBAIHN0YXRpYyB2b2lkIHNl
dF92Y3B1X2lkKHZvaWQpCiAgICAgICAgIHRoaXNfY3B1KHZjcHVfaWQpID0gc21wX3Byb2Nlc3Nv
cl9pZCgpOwogfQogCi1zdGF0aWMgdm9pZCBfX2luaXQgaW5pdF9tZW1tYXAodm9pZCkKLXsKLSAg
ICB1bnNpZ25lZCBpbnQgaTsKLQotICAgIG1lbSA9IHJhbmdlc2V0X25ldyhOVUxMLCAiaG9zdCBt
ZW1vcnkgbWFwIiwgMCk7Ci0gICAgaWYgKCAhbWVtICkKLSAgICAgICAgcGFuaWMoImZhaWxlZCB0
byBhbGxvY2F0ZSBQRk4gdXNhZ2UgcmFuZ2VzZXRcbiIpOwotCi0gICAgLyoKLSAgICAgKiBNYXJr
IHVwIHRvIHRoZSBsYXN0IG1lbW9yeSBwYWdlIChvciA0R2lCKSBhcyBSQU0uIFRoaXMgaXMgZG9u
ZSBiZWNhdXNlCi0gICAgICogWGVuIGRvZXNuJ3Qga25vdyB0aGUgcG9zaXRpb24gb2YgcG9zc2li
bGUgTU1JTyBob2xlcywgc28gYXQgbGVhc3QgdHJ5IHRvCi0gICAgICogYXZvaWQgdGhlIGtub3cg
TU1JTyBob2xlIGJlbG93IDRHaUIuIE5vdGUgdGhhdCB0aGlzIGlzIHN1YmplY3QgdG8gZnV0dXJl
Ci0gICAgICogZGlzY3Vzc2lvbiBhbmQgaW1wcm92ZW1lbnRzLgotICAgICAqLwotICAgIGlmICgg
cmFuZ2VzZXRfYWRkX3JhbmdlKG1lbSwgMCwgbWF4X3QodW5zaWduZWQgbG9uZywgbWF4X3BhZ2Ug
LSAxLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUEZOX0RPV04o
R0IoNCkgLSAxKSkpICkKLSAgICAgICAgcGFuaWMoInVuYWJsZSB0byBhZGQgUkFNIHRvIGluLXVz
ZSBQRk4gcmFuZ2VzZXRcbiIpOwotCi0gICAgZm9yICggaSA9IDA7IGkgPCBlODIwLm5yX21hcDsg
aSsrICkKLSAgICB7Ci0gICAgICAgIHN0cnVjdCBlODIwZW50cnkgKmUgPSAmZTgyMC5tYXBbaV07
Ci0KLSAgICAgICAgaWYgKCByYW5nZXNldF9hZGRfcmFuZ2UobWVtLCBQRk5fRE9XTihlLT5hZGRy
KSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUEZOX1VQKGUtPmFkZHIgKyBlLT5z
aXplIC0gMSkpICkKLSAgICAgICAgICAgIHBhbmljKCJ1bmFibGUgdG8gYWRkIHJhbmdlIFslI2x4
LCAlI2x4XSB0byBpbi11c2UgUEZOIHJhbmdlc2V0XG4iLAotICAgICAgICAgICAgICAgICAgUEZO
X0RPV04oZS0+YWRkciksIFBGTl9VUChlLT5hZGRyICsgZS0+c2l6ZSAtIDEpKTsKLSAgICB9Ci19
Ci0KIHN0YXRpYyB2b2lkIHhlbl9ldnRjaG5fdXBjYWxsKHN0cnVjdCBjcHVfdXNlcl9yZWdzICpy
ZWdzKQogewogICAgIHN0cnVjdCB2Y3B1X2luZm8gKnZjcHVfaW5mbyA9IHRoaXNfY3B1KHZjcHVf
aW5mbyk7CkBAIC0yNTQsNyArMjE1LDcgQEAgc3RhdGljIHZvaWQgaW5pdF9ldnRjaG4odm9pZCkK
ICAgICB9CiB9CiAKLXN0YXRpYyB2b2lkIF9faW5pdCB4ZW5fc2V0dXAodm9pZCkKK3ZvaWQgX19p
bml0IHhlbl9zZXR1cCh2b2lkKQogewogICAgIG1hcF9zaGFyZWRfaW5mbygpOwogCkBAIC0yODAs
NDkgKzI0MSwyMCBAQCBzdGF0aWMgdm9pZCBfX2luaXQgeGVuX3NldHVwKHZvaWQpCiAgICAgaW5p
dF9ldnRjaG4oKTsKIH0KIAotdm9pZCBfX2luaXQgaHlwZXJ2aXNvcl9zZXR1cCh2b2lkKQotewot
ICAgIGluaXRfbWVtbWFwKCk7Ci0KLSAgICB4ZW5fc2V0dXAoKTsKLX0KLQotc3RhdGljIHZvaWQg
eGVuX2FwX3NldHVwKHZvaWQpCit2b2lkIHhlbl9hcF9zZXR1cCh2b2lkKQogewogICAgIHNldF92
Y3B1X2lkKCk7CiAgICAgbWFwX3ZjcHVpbmZvKCk7CiAgICAgaW5pdF9ldnRjaG4oKTsKIH0KIAot
dm9pZCBoeXBlcnZpc29yX2FwX3NldHVwKHZvaWQpCi17Ci0gICAgeGVuX2FwX3NldHVwKCk7Ci19
Ci0KLWludCBoeXBlcnZpc29yX2FsbG9jX3VudXNlZF9wYWdlKG1mbl90ICptZm4pCi17Ci0gICAg
dW5zaWduZWQgbG9uZyBtOwotICAgIGludCByYzsKLQotICAgIHJjID0gcmFuZ2VzZXRfY2xhaW1f
cmFuZ2UobWVtLCAxLCAmbSk7Ci0gICAgaWYgKCAhcmMgKQotICAgICAgICAqbWZuID0gX21mbiht
KTsKLQotICAgIHJldHVybiByYzsKLX0KLQotaW50IGh5cGVydmlzb3JfZnJlZV91bnVzZWRfcGFn
ZShtZm5fdCBtZm4pCi17Ci0gICAgcmV0dXJuIHJhbmdlc2V0X3JlbW92ZV9yYW5nZShtZW0sIG1m
bl94KG1mbiksIG1mbl94KG1mbikpOwotfQotCiBzdGF0aWMgdm9pZCBhcF9yZXN1bWUodm9pZCAq
dW51c2VkKQogewogICAgIG1hcF92Y3B1aW5mbygpOwogICAgIGluaXRfZXZ0Y2huKCk7CiB9CiAK
LXN0YXRpYyB2b2lkIHhlbl9yZXN1bWUodm9pZCkKK3ZvaWQgeGVuX3Jlc3VtZSh2b2lkKQogewog
ICAgIC8qIFJlc2V0IHNoYXJlZCBpbmZvIHBhZ2UuICovCiAgICAgbWFwX3NoYXJlZF9pbmZvKCk7
CkBAIC0zNDUsMTEgKzI3Nyw2IEBAIHN0YXRpYyB2b2lkIHhlbl9yZXN1bWUodm9pZCkKICAgICAg
ICAgcHZfY29uc29sZV9pbml0KCk7CiB9CiAKLXZvaWQgaHlwZXJ2aXNvcl9yZXN1bWUodm9pZCkK
LXsKLSAgICB4ZW5fcmVzdW1lKCk7Ci19Ci0KIC8qCiAgKiBMb2NhbCB2YXJpYWJsZXM6CiAgKiBt
b2RlOiBDCmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS9hc20teDg2L2d1ZXN0LmggYi94ZW4vaW5j
bHVkZS9hc20teDg2L2d1ZXN0LmgKaW5kZXggYTM4YzZiNWIzZi4uOGUxNjcxNjVhZSAxMDA2NDQK
LS0tIGEveGVuL2luY2x1ZGUvYXNtLXg4Ni9ndWVzdC5oCisrKyBiL3hlbi9pbmNsdWRlL2FzbS14
ODYvZ3Vlc3QuaApAQCAtMjAsNiArMjAsNyBAQAogI2RlZmluZSBfX1g4Nl9HVUVTVF9IX18KIAog
I2luY2x1ZGUgPGFzbS9ndWVzdC9oeXBlcmNhbGwuaD4KKyNpbmNsdWRlIDxhc20vZ3Vlc3QvaHlw
ZXJ2aXNvci5oPgogI2luY2x1ZGUgPGFzbS9ndWVzdC9wdmgtYm9vdC5oPgogI2luY2x1ZGUgPGFz
bS9ndWVzdC94ZW4uaD4KICNpbmNsdWRlIDxhc20vcHYvc2hpbS5oPgpkaWZmIC0tZ2l0IGEveGVu
L2luY2x1ZGUvYXNtLXg4Ni9ndWVzdC9oeXBlcnZpc29yLmggYi94ZW4vaW5jbHVkZS9hc20teDg2
L2d1ZXN0L2h5cGVydmlzb3IuaApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAw
Li4xMzVhZDM2ZjcyCi0tLSAvZGV2L251bGwKKysrIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9ndWVz
dC9oeXBlcnZpc29yLmgKQEAgLTAsMCArMSw1OCBAQAorLyoqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgor
ICogYXNtLXg4Ni9ndWVzdC9oeXBlcnZpc29yLmgKKyAqCisgKiBUaGlzIHByb2dyYW0gaXMgZnJl
ZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yCisgKiBtb2RpZnkgaXQg
dW5kZXIgdGhlIHRlcm1zIGFuZCBjb25kaXRpb25zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMK
KyAqIExpY2Vuc2UsIHZlcnNpb24gMiwgYXMgcHVibGlzaGVkIGJ5IHRoZSBGcmVlIFNvZnR3YXJl
IEZvdW5kYXRpb24uCisgKgorICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBo
b3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCisgKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7
IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgorICogTUVSQ0hBTlRBQklMSVRZ
IG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZSBHTlUKKyAqIEdl
bmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KKyAqCisgKiBZb3Ugc2hvdWxk
IGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMKKyAqIExpY2Vu
c2UgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW07IElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5v
cmcvbGljZW5zZXMvPi4KKyAqLworCisjaWZuZGVmIF9fWDg2X0dVRVNUX0hZUEVSVklTT1JfSF9f
CisjZGVmaW5lIF9fWDg2X0dVRVNUX0hZUEVSVklTT1JfSF9fCisKKyNpZmRlZiBDT05GSUdfR1VF
U1QKKworI2luY2x1ZGUgPHhlbi9tbS5oPgorCit2b2lkIHByb2JlX2h5cGVydmlzb3Iodm9pZCk7
Cit2b2lkIGh5cGVydmlzb3Jfc2V0dXAodm9pZCk7Cit2b2lkIGh5cGVydmlzb3JfYXBfc2V0dXAo
dm9pZCk7CitpbnQgaHlwZXJ2aXNvcl9hbGxvY191bnVzZWRfcGFnZShtZm5fdCAqbWZuKTsKK2lu
dCBoeXBlcnZpc29yX2ZyZWVfdW51c2VkX3BhZ2UobWZuX3QgbWZuKTsKK3VpbnQzMl90IGh5cGVy
dmlzb3JfY3B1aWRfYmFzZSh2b2lkKTsKK3ZvaWQgaHlwZXJ2aXNvcl9yZXN1bWUodm9pZCk7CisK
KyNlbHNlCisKKyNpbmNsdWRlIDx4ZW4vbGliLmg+CisKK3N0YXRpYyBpbmxpbmUgdm9pZCBwcm9i
ZV9oeXBlcnZpc29yKHZvaWQpIHt9CisKK3N0YXRpYyBpbmxpbmUgdm9pZCBoeXBlcnZpc29yX3Nl
dHVwKHZvaWQpCit7CisgICAgQVNTRVJUX1VOUkVBQ0hBQkxFKCk7Cit9CitzdGF0aWMgaW5saW5l
IHZvaWQgaHlwZXJ2aXNvcl9hcF9zZXR1cCh2b2lkKQoreworICAgIEFTU0VSVF9VTlJFQUNIQUJM
RSgpOworfQorCisjZW5kaWYgLyogQ09ORklHX0dVRVNUICovCisjZW5kaWYgLyogX19YODZfR1VF
U1RfSFlQRVJWSVNPUl9IX18gKi8KKworLyoKKyAqIExvY2FsIHZhcmlhYmxlczoKKyAqIG1vZGU6
IEMKKyAqIGMtZmlsZS1zdHlsZTogIkJTRCIKKyAqIGMtYmFzaWMtb2Zmc2V0OiA0CisgKiB0YWIt
d2lkdGg6IDQKKyAqIGluZGVudC10YWJzLW1vZGU6IG5pbAorICogRW5kOgorICovCmRpZmYgLS1n
aXQgYS94ZW4vaW5jbHVkZS9hc20teDg2L2d1ZXN0L3hlbi5oIGIveGVuL2luY2x1ZGUvYXNtLXg4
Ni9ndWVzdC94ZW4uaAppbmRleCBiMDE1ZWQxODgzLi5kMDMxZjFmNzBkIDEwMDY0NAotLS0gYS94
ZW4vaW5jbHVkZS9hc20teDg2L2d1ZXN0L3hlbi5oCisrKyBiL3hlbi9pbmNsdWRlL2FzbS14ODYv
Z3Vlc3QveGVuLmgKQEAgLTMyLDEyICszMiwxMCBAQCBleHRlcm4gYm9vbCB4ZW5fZ3Vlc3Q7CiBl
eHRlcm4gYm9vbCBwdl9jb25zb2xlOwogZXh0ZXJuIHVpbnQzMl90IHhlbl9jcHVpZF9iYXNlOwog
Ci12b2lkIHByb2JlX2h5cGVydmlzb3Iodm9pZCk7Ci12b2lkIGh5cGVydmlzb3Jfc2V0dXAodm9p
ZCk7Ci12b2lkIGh5cGVydmlzb3JfYXBfc2V0dXAodm9pZCk7Ci1pbnQgaHlwZXJ2aXNvcl9hbGxv
Y191bnVzZWRfcGFnZShtZm5fdCAqbWZuKTsKLWludCBoeXBlcnZpc29yX2ZyZWVfdW51c2VkX3Bh
Z2UobWZuX3QgbWZuKTsKLXZvaWQgaHlwZXJ2aXNvcl9yZXN1bWUodm9pZCk7Cit2b2lkIHByb2Jl
X3hlbih2b2lkKTsKK3ZvaWQgeGVuX3NldHVwKHZvaWQpOwordm9pZCB4ZW5fYXBfc2V0dXAodm9p
ZCk7Cit2b2lkIHhlbl9yZXN1bWUodm9pZCk7CiAKIERFQ0xBUkVfUEVSX0NQVSh1bnNpZ25lZCBp
bnQsIHZjcHVfaWQpOwogREVDTEFSRV9QRVJfQ1BVKHN0cnVjdCB2Y3B1X2luZm8gKiwgdmNwdV9p
bmZvKTsKQEAgLTQ3LDE2ICs0NSw3IEBAIERFQ0xBUkVfUEVSX0NQVShzdHJ1Y3QgdmNwdV9pbmZv
ICosIHZjcHVfaW5mbyk7CiAjZGVmaW5lIHhlbl9ndWVzdCAwCiAjZGVmaW5lIHB2X2NvbnNvbGUg
MAogCi1zdGF0aWMgaW5saW5lIHZvaWQgcHJvYmVfaHlwZXJ2aXNvcih2b2lkKSB7fQotCi1zdGF0
aWMgaW5saW5lIHZvaWQgaHlwZXJ2aXNvcl9zZXR1cCh2b2lkKQotewotICAgIEFTU0VSVF9VTlJF
QUNIQUJMRSgpOwotfQotc3RhdGljIGlubGluZSB2b2lkIGh5cGVydmlzb3JfYXBfc2V0dXAodm9p
ZCkKLXsKLSAgICBBU1NFUlRfVU5SRUFDSEFCTEUoKTsKLX0KK3N0YXRpYyBpbmxpbmUgdm9pZCBw
cm9iZV94ZW4odm9pZCkge30KIAogI2VuZGlmIC8qIENPTkZJR19YRU5fR1VFU1QgKi8KICNlbmRp
ZiAvKiBfX1g4Nl9HVUVTVF9YRU5fSF9fICovCi0tIAoyLjIwLjEKCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhl
bi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3Jn
L21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

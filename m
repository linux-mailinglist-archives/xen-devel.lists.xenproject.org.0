Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 8F56F15BECB
	for <lists+xen-devel@lfdr.de>; Thu, 13 Feb 2020 13:57:15 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1j2E1U-0006A8-IB; Thu, 13 Feb 2020 12:55:16 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=06QY=4B=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1j2E1S-000694-IF
 for xen-devel@lists.xenproject.org; Thu, 13 Feb 2020 12:55:14 +0000
X-Inumbo-ID: 07fa8cc3-4e60-11ea-b898-12813bfff9fa
Received: from mx2.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 07fa8cc3-4e60-11ea-b898-12813bfff9fa;
 Thu, 13 Feb 2020 12:54:55 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx2.suse.de (Postfix) with ESMTP id AD057ACB9;
 Thu, 13 Feb 2020 12:54:53 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Thu, 13 Feb 2020 13:54:47 +0100
Message-Id: <20200213125449.14226-7-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20200213125449.14226-1-jgross@suse.com>
References: <20200213125449.14226-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH 6/8] xen/common: use keyhandler locks when
 dumping data to console
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Julien Grall <julien@xen.org>,
 Wei Liu <wl@xen.org>, Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>,
 Ross Lagerwall <ross.lagerwall@citrix.com>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SW5zdGVhZCBvZiB1c2luZyB0aGUgbm9ybWFsIGxvY2tzIHVzZSB0aGUga2V5aGFuZGxlciBwcm92
aWRlZCB0cnlsb2Nrcwp3aXRoIHRpbWVvdXRzLiBUaGlzIHJlcXVpcmVzIGFkZGluZyBhIHBlcmNw
dSByZWFkX3RyeWxvY2sgYW5kIGEgc3BlY2lhbApwcmltaXRpdmUgZm9yIHRoZSBncmFudCBsb2Nr
LgoKU2lnbmVkLW9mZi1ieTogSnVlcmdlbiBHcm9zcyA8amdyb3NzQHN1c2UuY29tPgotLS0KIHhl
bi9jb21tb24vZXZlbnRfY2hhbm5lbC5jIHwgIDMgKystCiB4ZW4vY29tbW9uL2dyYW50X3RhYmxl
LmMgICB8IDMyICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrLS0tCiB4ZW4vY29tbW9uL2xp
dmVwYXRjaC5jICAgICB8IDExICsrKy0tLS0tLS0tCiB4ZW4vY29tbW9uL3NwaW5sb2NrLmMgICAg
ICB8IDE4ICsrKysrKysrKysrKysrKy0tLQogeGVuL2NvbW1vbi90aW1lci5jICAgICAgICAgfCAx
NSArKysrKysrKystLS0tLS0KIHhlbi9pbmNsdWRlL3hlbi9yd2xvY2suaCAgIHwgMzcgKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwogNiBmaWxlcyBjaGFuZ2VkLCA5NSBpbnNl
cnRpb25zKCspLCAyMSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL2V2ZW50
X2NoYW5uZWwuYyBiL3hlbi9jb21tb24vZXZlbnRfY2hhbm5lbC5jCmluZGV4IGU4NmUyYmZhYjAu
LmE4ZmQ0ODFjYjggMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vZXZlbnRfY2hhbm5lbC5jCisrKyBi
L3hlbi9jb21tb24vZXZlbnRfY2hhbm5lbC5jCkBAIC0xMzg3LDcgKzEzODcsOCBAQCBzdGF0aWMg
dm9pZCBkb21haW5fZHVtcF9ldnRjaG5faW5mbyhzdHJ1Y3QgZG9tYWluICpkKQogICAgICAgICAg
ICAiUG9sbGluZyB2Q1BVczogeyUqcGJsfVxuIgogICAgICAgICAgICAiICAgIHBvcnQgW3AvbS9z
XVxuIiwgZC0+ZG9tYWluX2lkLCBkLT5tYXhfdmNwdXMsIGQtPnBvbGxfbWFzayk7CiAKLSAgICBz
cGluX2xvY2soJmQtPmV2ZW50X2xvY2spOworICAgIGlmICggIWtleWhhbmRsZXJfc3Bpbl9sb2Nr
KCZkLT5ldmVudF9sb2NrLCAiY291bGQgbm90IGdldCBldmVudCBsb2NrIikgKQorICAgICAgICBy
ZXR1cm47CiAKICAgICBmb3IgKCBwb3J0ID0gMTsgcG9ydCA8IGQtPm1heF9ldnRjaG5zOyArK3Bv
cnQgKQogICAgIHsKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vZ3JhbnRfdGFibGUuYyBiL3hlbi9j
b21tb24vZ3JhbnRfdGFibGUuYwppbmRleCBjNzkzOTI3Y2Q2Li4xNGQwMTk1MGFiIDEwMDY0NAot
LS0gYS94ZW4vY29tbW9uL2dyYW50X3RhYmxlLmMKKysrIGIveGVuL2NvbW1vbi9ncmFudF90YWJs
ZS5jCkBAIC0zMzUsNiArMzM1LDExIEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBncmFudF9yZWFkX2xv
Y2soc3RydWN0IGdyYW50X3RhYmxlICpndCkKICAgICBwZXJjcHVfcmVhZF9sb2NrKGdyYW50X3J3
bG9jaywgJmd0LT5sb2NrKTsKIH0KIAorc3RhdGljIGlubGluZSBpbnQgZ3JhbnRfcmVhZF90cnls
b2NrKHN0cnVjdCBncmFudF90YWJsZSAqZ3QpCit7CisgICAgcmV0dXJuIHBlcmNwdV9yZWFkX3Ry
eWxvY2soZ3JhbnRfcndsb2NrLCAmZ3QtPmxvY2spOworfQorCiBzdGF0aWMgaW5saW5lIHZvaWQg
Z3JhbnRfcmVhZF91bmxvY2soc3RydWN0IGdyYW50X3RhYmxlICpndCkKIHsKICAgICBwZXJjcHVf
cmVhZF91bmxvY2soZ3JhbnRfcndsb2NrLCAmZ3QtPmxvY2spOwpAQCAtNDA0MCw2ICs0MDQ1LDI0
IEBAIGludCBnbnR0YWJfZ2V0X3N0YXR1c19mcmFtZShzdHJ1Y3QgZG9tYWluICpkLCB1bnNpZ25l
ZCBsb25nIGlkeCwKICAgICByZXR1cm4gcmM7CiB9CiAKK3N0YXRpYyBpbnQga2V5aGFuZGxlcl9n
cmFudF9yZWFkX2xvY2soc3RydWN0IGRvbWFpbiAqZCkKK3sKKyAgICBrZXloYW5kbGVyX2xvY2tf
Ym9keShpbnQsIGdyYW50X3JlYWRfdHJ5bG9jayhkLT5ncmFudF90YWJsZSksCisgICAgICAgICAg
ICAgICAgICAgICAgICAgImNvdWxkIG5vdCBnZXQgZ3JhbnQgbG9jayBmb3IgJXBkXG4iLCBkKTsK
K30KKworc3RhdGljIGlubGluZSBzdHJ1Y3QgYWN0aXZlX2dyYW50X2VudHJ5ICoKK2tleWhhbmRs
ZXJfYWN0aXZlX2VudHJ5X2FjcXVpcmUoc3RydWN0IGdyYW50X3RhYmxlICp0LCBncmFudF9yZWZf
dCBlKQoreworICAgIHN0cnVjdCBhY3RpdmVfZ3JhbnRfZW50cnkgKmFjdDsKKworICAgIGFjdCA9
ICZfYWN0aXZlX2VudHJ5KHQsIGUpOworICAgIGlmICggIWtleWhhbmRsZXJfc3Bpbl9sb2NrKCZh
Y3QtPmxvY2ssICJjb3VsZCBub3QgYWNxdWlyZSBhY3RpdmUgZW50cnkiKSApCisgICAgICAgIHJl
dHVybiBOVUxMOworCisgICAgcmV0dXJuIGFjdDsKK30KKwogc3RhdGljIHZvaWQgZ250dGFiX3Vz
YWdlX3ByaW50KHN0cnVjdCBkb21haW4gKnJkKQogewogICAgIGludCBmaXJzdCA9IDE7CkBAIC00
MDQ3LDExICs0MDcwLDEyIEBAIHN0YXRpYyB2b2lkIGdudHRhYl91c2FnZV9wcmludChzdHJ1Y3Qg
ZG9tYWluICpyZCkKICAgICBzdHJ1Y3QgZ3JhbnRfdGFibGUgKmd0ID0gcmQtPmdyYW50X3RhYmxl
OwogICAgIHVuc2lnbmVkIGludCBucl9lbnRzOwogCisgICAgaWYgKCAha2V5aGFuZGxlcl9ncmFu
dF9yZWFkX2xvY2socmQpICkKKyAgICAgICAgcmV0dXJuOworCiAgICAgcHJpbnRrKCIgICAgICAt
LS0tLS0tLSBhY3RpdmUgLS0tLS0tLS0gICAgICAgLS0tLS0tLS0gc2hhcmVkIC0tLS0tLS0tXG4i
KTsKICAgICBwcmludGsoIltyZWZdIGxvY2FsZG9tIG1mbiAgICAgIHBpbiAgICAgICAgICBsb2Nh
bGRvbSBnbWZuICAgICBmbGFnc1xuIik7CiAKLSAgICBncmFudF9yZWFkX2xvY2soZ3QpOwotCiAg
ICAgcHJpbnRrKCJncmFudC10YWJsZSBmb3IgcmVtb3RlIGQlZCAodiV1KVxuIgogICAgICAgICAg
ICAiICAldSBmcmFtZXMgKCV1IG1heCksICV1IG1hcHRyYWNrIGZyYW1lcyAoJXUgbWF4KVxuIiwK
ICAgICAgICAgICAgcmQtPmRvbWFpbl9pZCwgZ3QtPmd0X3ZlcnNpb24sCkBAIC00MDY2LDcgKzQw
OTAsOSBAQCBzdGF0aWMgdm9pZCBnbnR0YWJfdXNhZ2VfcHJpbnQoc3RydWN0IGRvbWFpbiAqcmQp
CiAgICAgICAgIHVpbnQxNl90IHN0YXR1czsKICAgICAgICAgdWludDY0X3QgZnJhbWU7CiAKLSAg
ICAgICAgYWN0ID0gYWN0aXZlX2VudHJ5X2FjcXVpcmUoZ3QsIHJlZik7CisgICAgICAgIGFjdCA9
IGtleWhhbmRsZXJfYWN0aXZlX2VudHJ5X2FjcXVpcmUoZ3QsIHJlZik7CisgICAgICAgIGlmICgg
IWFjdCApCisgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgaWYgKCAhYWN0LT5waW4gKQog
ICAgICAgICB7CiAgICAgICAgICAgICBhY3RpdmVfZW50cnlfcmVsZWFzZShhY3QpOwpkaWZmIC0t
Z2l0IGEveGVuL2NvbW1vbi9saXZlcGF0Y2guYyBiL3hlbi9jb21tb24vbGl2ZXBhdGNoLmMKaW5k
ZXggNWUwOWRjOTkwYi4uMGYwYTg3NzcwNCAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9saXZlcGF0
Y2guYworKysgYi94ZW4vY29tbW9uL2xpdmVwYXRjaC5jCkBAIC0yMDcyLDExICsyMDcyLDggQEAg
c3RhdGljIHZvaWQgbGl2ZXBhdGNoX3ByaW50YWxsKHVuc2lnbmVkIGNoYXIga2V5KQogICAgIGlm
ICggIXhlbl9idWlsZF9pZCgmYmluYXJ5X2lkLCAmbGVuKSApCiAgICAgICAgIHByaW50aygiYnVp
bGQtaWQ6ICUqcGhOXG4iLCBsZW4sIGJpbmFyeV9pZCk7CiAKLSAgICBpZiAoICFzcGluX3RyeWxv
Y2soJnBheWxvYWRfbG9jaykgKQotICAgIHsKLSAgICAgICAgcHJpbnRrKCJMb2NrIGhlbGQuIFRy
eSBhZ2Fpbi5cbiIpOworICAgIGlmICggIWtleWhhbmRsZXJfc3Bpbl9sb2NrKCZwYXlsb2FkX2xv
Y2ssICJjb3VsZCBub3QgZ2V0IHBheWxvYWQgbG9jayIpICkKICAgICAgICAgcmV0dXJuOwotICAg
IH0KIAogICAgIGxpc3RfZm9yX2VhY2hfZW50cnkgKCBkYXRhLCAmcGF5bG9hZF9saXN0LCBsaXN0
ICkKICAgICB7CkBAIC0yMDk2LDExICsyMDkzLDkgQEAgc3RhdGljIHZvaWQgbGl2ZXBhdGNoX3By
aW50YWxsKHVuc2lnbmVkIGNoYXIga2V5KQogICAgICAgICAgICAgewogICAgICAgICAgICAgICAg
IHNwaW5fdW5sb2NrKCZwYXlsb2FkX2xvY2spOwogICAgICAgICAgICAgICAgIHByb2Nlc3NfcGVu
ZGluZ19zb2Z0aXJxcygpOwotICAgICAgICAgICAgICAgIGlmICggIXNwaW5fdHJ5bG9jaygmcGF5
bG9hZF9sb2NrKSApCi0gICAgICAgICAgICAgICAgewotICAgICAgICAgICAgICAgICAgICBwcmlu
dGsoIkNvdWxkbid0IHJlYWNxdWlyZSBsb2NrLiBUcnkgYWdhaW4uXG4iKTsKKyAgICAgICAgICAg
ICAgICBpZiAoICFrZXloYW5kbGVyX3NwaW5fbG9jaygmcGF5bG9hZF9sb2NrLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJjb3VsZCBub3QgcmVhY3F1aXJlIHBh
eWxvYWQgbG9jayIpICkKICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwotICAgICAgICAgICAg
ICAgIH0KICAgICAgICAgICAgIH0KICAgICAgICAgfQogICAgICAgICBpZiAoIGRhdGEtPmlkLmxl
biApCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3NwaW5sb2NrLmMgYi94ZW4vY29tbW9uL3NwaW5s
b2NrLmMKaW5kZXggMzQ0OTgxYzU0YS4uMzIwNGQyNGRmYSAxMDA2NDQKLS0tIGEveGVuL2NvbW1v
bi9zcGlubG9jay5jCisrKyBiL3hlbi9jb21tb24vc3BpbmxvY2suYwpAQCAtMzQ5LDE3ICszNDks
MjMgQEAgc3RhdGljIHN0cnVjdCBsb2NrX3Byb2ZpbGVfYW5jIGxvY2tfcHJvZmlsZV9hbmNzW0xP
Q0tQUk9GX1RZUEVfTl07CiBzdGF0aWMgc3RydWN0IGxvY2tfcHJvZmlsZV9xaGVhZCBsb2NrX3By
b2ZpbGVfZ2xiX3E7CiBzdGF0aWMgc3BpbmxvY2tfdCBsb2NrX3Byb2ZpbGVfbG9jayA9IFNQSU5f
TE9DS19VTkxPQ0tFRDsKIAotc3RhdGljIHZvaWQgc3BpbmxvY2tfcHJvZmlsZV9pdGVyYXRlKGxv
Y2tfcHJvZmlsZV9zdWJmdW5jICpzdWIsIHZvaWQgKnBhcikKK3N0YXRpYyB2b2lkIHNwaW5sb2Nr
X3Byb2ZpbGVfaXRlcmF0ZV9sb2NrZWQobG9ja19wcm9maWxlX3N1YmZ1bmMgKnN1YiwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqcGFyKQogewogICAg
IGludCBpOwogICAgIHN0cnVjdCBsb2NrX3Byb2ZpbGVfcWhlYWQgKmhxOwogICAgIHN0cnVjdCBs
b2NrX3Byb2ZpbGUgKmVxOwogCi0gICAgc3Bpbl9sb2NrKCZsb2NrX3Byb2ZpbGVfbG9jayk7CiAg
ICAgZm9yICggaSA9IDA7IGkgPCBMT0NLUFJPRl9UWVBFX047IGkrKyApCiAgICAgICAgIGZvciAo
IGhxID0gbG9ja19wcm9maWxlX2FuY3NbaV0uaGVhZF9xOyBocTsgaHEgPSBocS0+aGVhZF9xICkK
ICAgICAgICAgICAgIGZvciAoIGVxID0gaHEtPmVsZW1fcTsgZXE7IGVxID0gZXEtPm5leHQgKQog
ICAgICAgICAgICAgICAgIHN1YihlcSwgaSwgaHEtPmlkeCwgcGFyKTsKK30KKworc3RhdGljIHZv
aWQgc3BpbmxvY2tfcHJvZmlsZV9pdGVyYXRlKGxvY2tfcHJvZmlsZV9zdWJmdW5jICpzdWIsIHZv
aWQgKnBhcikKK3sKKyAgICBzcGluX2xvY2soJmxvY2tfcHJvZmlsZV9sb2NrKTsKKyAgICBzcGlu
bG9ja19wcm9maWxlX2l0ZXJhdGVfbG9ja2VkKHN1YiwgcGFyKTsKICAgICBzcGluX3VubG9jaygm
bG9ja19wcm9maWxlX2xvY2spOwogfQogCkBAIC0zODksNyArMzk1LDEzIEBAIHZvaWQgc3Bpbmxv
Y2tfcHJvZmlsZV9wcmludGFsbCh1bnNpZ25lZCBjaGFyIGtleSkKICAgICBkaWZmID0gbm93IC0g
bG9ja19wcm9maWxlX3N0YXJ0OwogICAgIHByaW50aygiWGVuIGxvY2sgcHJvZmlsZSBpbmZvIFNI
T1cgIChub3cgPSAlIlBSSV9zdGltZSIgdG90YWwgPSAiCiAgICAgICAgICAgICIlIlBSSV9zdGlt
ZSIpXG4iLCBub3csIGRpZmYpOwotICAgIHNwaW5sb2NrX3Byb2ZpbGVfaXRlcmF0ZShzcGlubG9j
a19wcm9maWxlX3ByaW50X2VsZW0sIE5VTEwpOworCisgICAgaWYgKCAha2V5aGFuZGxlcl9zcGlu
X2xvY2soJmxvY2tfcHJvZmlsZV9sb2NrLCAiY291bGQgbm90IGdldCBsb2NrIikgKQorICAgICAg
ICByZXR1cm47CisKKyAgICBzcGlubG9ja19wcm9maWxlX2l0ZXJhdGVfbG9ja2VkKHNwaW5sb2Nr
X3Byb2ZpbGVfcHJpbnRfZWxlbSwgTlVMTCk7CisKKyAgICBzcGluX3VubG9jaygmbG9ja19wcm9m
aWxlX2xvY2spOwogfQogCiBzdGF0aWMgdm9pZCBzcGlubG9ja19wcm9maWxlX3Jlc2V0X2VsZW0o
c3RydWN0IGxvY2tfcHJvZmlsZSAqZGF0YSwKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vdGltZXIu
YyBiL3hlbi9jb21tb24vdGltZXIuYwppbmRleCAxYmIyNjVjZWVhLi4wYTAwODU3ZTJkIDEwMDY0
NAotLS0gYS94ZW4vY29tbW9uL3RpbWVyLmMKKysrIGIveGVuL2NvbW1vbi90aW1lci5jCkBAIC01
NjEsMTIgKzU2MSwxNSBAQCBzdGF0aWMgdm9pZCBkdW1wX3RpbWVycSh1bnNpZ25lZCBjaGFyIGtl
eSkKICAgICAgICAgdHMgPSAmcGVyX2NwdSh0aW1lcnMsIGkpOwogCiAgICAgICAgIHByaW50aygi
Q1BVJTAyZDpcbiIsIGkpOwotICAgICAgICBzcGluX2xvY2tfaXJxc2F2ZSgmdHMtPmxvY2ssIGZs
YWdzKTsKLSAgICAgICAgZm9yICggaiA9IDE7IGogPD0gaGVhcF9tZXRhZGF0YSh0cy0+aGVhcCkt
PnNpemU7IGorKyApCi0gICAgICAgICAgICBkdW1wX3RpbWVyKHRzLT5oZWFwW2pdLCBub3cpOwot
ICAgICAgICBmb3IgKCB0ID0gdHMtPmxpc3Q7IHQgIT0gTlVMTDsgdCA9IHQtPmxpc3RfbmV4dCAp
Ci0gICAgICAgICAgICBkdW1wX3RpbWVyKHQsIG5vdyk7Ci0gICAgICAgIHNwaW5fdW5sb2NrX2ly
cXJlc3RvcmUoJnRzLT5sb2NrLCBmbGFncyk7CisgICAgICAgIGlmICgga2V5aGFuZGxlcl9zcGlu
X2xvY2tfaXJxc2F2ZSgmdHMtPmxvY2ssICZmbGFncywKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICJjb3VsZCBub3QgZ2V0IGxvY2siKSApCisgICAgICAgIHsKKyAg
ICAgICAgICAgIGZvciAoIGogPSAxOyBqIDw9IGhlYXBfbWV0YWRhdGEodHMtPmhlYXApLT5zaXpl
OyBqKysgKQorICAgICAgICAgICAgICAgIGR1bXBfdGltZXIodHMtPmhlYXBbal0sIG5vdyk7Cisg
ICAgICAgICAgICBmb3IgKCB0ID0gdHMtPmxpc3Q7IHQgIT0gTlVMTDsgdCA9IHQtPmxpc3RfbmV4
dCApCisgICAgICAgICAgICAgICAgZHVtcF90aW1lcih0LCBub3cpOworICAgICAgICAgICAgc3Bp
bl91bmxvY2tfaXJxcmVzdG9yZSgmdHMtPmxvY2ssIGZsYWdzKTsKKyAgICAgICAgfQogICAgIH0K
IH0KIApkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUveGVuL3J3bG9jay5oIGIveGVuL2luY2x1ZGUv
eGVuL3J3bG9jay5oCmluZGV4IDNkZmVhMWFjMmEuLmFkZDg1Nzc0MjkgMTAwNjQ0Ci0tLSBhL3hl
bi9pbmNsdWRlL3hlbi9yd2xvY2suaAorKysgYi94ZW4vaW5jbHVkZS94ZW4vcndsb2NrLmgKQEAg
LTI3OCw2ICsyNzgsNDEgQEAgc3RhdGljIGlubGluZSB2b2lkIF9wZXJjcHVfcmVhZF9sb2NrKHBl
cmNwdV9yd2xvY2tfdCAqKnBlcl9jcHVkYXRhLAogICAgIH0KIH0KIAorc3RhdGljIGlubGluZSBp
bnQgX3BlcmNwdV9yZWFkX3RyeWxvY2socGVyY3B1X3J3bG9ja190ICoqcGVyX2NwdWRhdGEsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlcmNwdV9yd2xvY2tfdCAq
cGVyY3B1X3J3bG9jaykKK3sKKyAgICAvKiBWYWxpZGF0ZSB0aGUgY29ycmVjdCBwZXJfY3B1ZGF0
YSB2YXJpYWJsZSBoYXMgYmVlbiBwcm92aWRlZC4gKi8KKyAgICBfcGVyY3B1X3J3bG9ja19vd25l
cl9jaGVjayhwZXJfY3B1ZGF0YSwgcGVyY3B1X3J3bG9jayk7CisKKyAgICAvKiBXZSBjYW5ub3Qg
c3VwcG9ydCByZWN1cnNpb24gb24gdGhlIHNhbWUgbG9jay4gKi8KKyAgICBBU1NFUlQodGhpc19j
cHVfcHRyKHBlcl9jcHVkYXRhKSAhPSBwZXJjcHVfcndsb2NrKTsKKyAgICAvKgorICAgICAqIERl
dGVjdCB1c2luZyBhIHNlY29uZCBwZXJjcHVfcndsb2NrX3Qgc2ltdWxhdGVub3VzbHkgYW5kIGZh
bGxiYWNrCisgICAgICogdG8gc3RhbmRhcmQgcmVhZF90cnlsb2NrLgorICAgICAqLworICAgIGlm
ICggdW5saWtlbHkodGhpc19jcHVfcHRyKHBlcl9jcHVkYXRhKSAhPSBOVUxMICkgKQorICAgICAg
ICByZXR1cm4gcmVhZF90cnlsb2NrKCZwZXJjcHVfcndsb2NrLT5yd2xvY2spOworCisgICAgLyog
SW5kaWNhdGUgdGhpcyBjcHUgaXMgcmVhZGluZy4gKi8KKyAgICB0aGlzX2NwdV9wdHIocGVyX2Nw
dWRhdGEpID0gcGVyY3B1X3J3bG9jazsKKyAgICBzbXBfbWIoKTsKKyAgICAvKiBDaGVjayBpZiBh
IHdyaXRlciBpcyB3YWl0aW5nLiAqLworICAgIGlmICggdW5saWtlbHkocGVyY3B1X3J3bG9jay0+
d3JpdGVyX2FjdGl2YXRpbmcpICkKKyAgICB7CisgICAgICAgIC8qIExldCB0aGUgd2FpdGluZyB3
cml0ZXIga25vdyB3ZSBhcmVuJ3QgaG9sZGluZyB0aGUgbG9jay4gKi8KKyAgICAgICAgdGhpc19j
cHVfcHRyKHBlcl9jcHVkYXRhKSA9IE5VTEw7CisgICAgICAgIC8qIFRyeSB1c2luZyB0aGUgcmVh
ZCBsb2NrIHRvIGtlZXAgdGhlIGxvY2sgZmFpci4gKi8KKyAgICAgICAgaWYgKCAhcmVhZF90cnls
b2NrKCZwZXJjcHVfcndsb2NrLT5yd2xvY2spICkKKyAgICAgICAgICAgIHJldHVybiAwOworICAg
ICAgICAvKiBTZXQgdGhlIHBlciBDUFUgZGF0YSBhZ2FpbiBhbmQgY29udGludWUuICovCisgICAg
ICAgIHRoaXNfY3B1X3B0cihwZXJfY3B1ZGF0YSkgPSBwZXJjcHVfcndsb2NrOworICAgICAgICAv
KiBEcm9wIHRoZSByZWFkIGxvY2sgYmVjYXVzZSB3ZSBkb24ndCBuZWVkIGl0IGFueW1vcmUuICov
CisgICAgICAgIHJlYWRfdW5sb2NrKCZwZXJjcHVfcndsb2NrLT5yd2xvY2spOworICAgIH0KKwor
ICAgIHJldHVybiAxOworfQorCiBzdGF0aWMgaW5saW5lIHZvaWQgX3BlcmNwdV9yZWFkX3VubG9j
ayhwZXJjcHVfcndsb2NrX3QgKipwZXJfY3B1ZGF0YSwKICAgICAgICAgICAgICAgICBwZXJjcHVf
cndsb2NrX3QgKnBlcmNwdV9yd2xvY2spCiB7CkBAIC0zMTgsNiArMzUzLDggQEAgc3RhdGljIGlu
bGluZSB2b2lkIF9wZXJjcHVfd3JpdGVfdW5sb2NrKHBlcmNwdV9yd2xvY2tfdCAqKnBlcl9jcHVk
YXRhLAogCiAjZGVmaW5lIHBlcmNwdV9yZWFkX2xvY2socGVyY3B1LCBsb2NrKSBcCiAgICAgX3Bl
cmNwdV9yZWFkX2xvY2soJmdldF9wZXJfY3B1X3ZhcihwZXJjcHUpLCBsb2NrKQorI2RlZmluZSBw
ZXJjcHVfcmVhZF90cnlsb2NrKHBlcmNwdSwgbG9jaykgXAorICAgIF9wZXJjcHVfcmVhZF90cnls
b2NrKCZnZXRfcGVyX2NwdV92YXIocGVyY3B1KSwgbG9jaykKICNkZWZpbmUgcGVyY3B1X3JlYWRf
dW5sb2NrKHBlcmNwdSwgbG9jaykgXAogICAgIF9wZXJjcHVfcmVhZF91bmxvY2soJmdldF9wZXJf
Y3B1X3ZhcihwZXJjcHUpLCBsb2NrKQogI2RlZmluZSBwZXJjcHVfd3JpdGVfbG9jayhwZXJjcHUs
IGxvY2spIFwKLS0gCjIuMTYuNAoKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnBy
b2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94
ZW4tZGV2ZWw=

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id DF8E446315
	for <lists+xen-devel@lfdr.de>; Fri, 14 Jun 2019 17:40:40 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hboGd-0006Zb-Ny; Fri, 14 Jun 2019 15:37:27 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=Gode=UN=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1hboGc-0006ZV-LA
 for xen-devel@lists.xenproject.org; Fri, 14 Jun 2019 15:37:26 +0000
X-Inumbo-ID: 4ef55ee1-8eba-11e9-8980-bc764e045a96
Received: from prv1-mh.provo.novell.com (unknown [137.65.248.33])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 4ef55ee1-8eba-11e9-8980-bc764e045a96;
 Fri, 14 Jun 2019 15:37:25 +0000 (UTC)
Received: from INET-PRV1-MTA by prv1-mh.provo.novell.com
 with Novell_GroupWise; Fri, 14 Jun 2019 09:37:24 -0600
Message-Id: <5D03BF330200007800238616@prv1-mh.provo.novell.com>
X-Mailer: Novell GroupWise Internet Agent 18.1.1 
Date: Fri, 14 Jun 2019 09:37:23 -0600
From: "Jan Beulich" <JBeulich@suse.com>
To: "xen-devel" <xen-devel@lists.xenproject.org>
References: <5D03BE5102000078002385FE@prv1-mh.provo.novell.com>
In-Reply-To: <5D03BE5102000078002385FE@prv1-mh.provo.novell.com>
Mime-Version: 1.0
Content-Disposition: inline
Subject: [Xen-devel] [PATCH 2/4] x86/mcheck: replace remaining uses of
 __get_cpu_var()
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>, WeiLiu <wl@xen.org>,
 Roger Pau Monne <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

dGhpc19jcHUoKSBpcyBzaG9ydGVyLCBhbmQgd2hlbiB0aGVyZSBhcmUgbXVsdGlwbGUgdXNlcyBp
biBhIGZ1bmN0aW9uCnBlcl9jcHUoKSBpdCdzIGFsc28gbW9yZSBlZmZpY2llbnQuCgpTaWduZWQt
b2ZmLWJ5OiBKYW4gQmV1bGljaCA8amJldWxpY2hAc3VzZS5jb20+CgotLS0gYS94ZW4vYXJjaC94
ODYvY3B1L21jaGVjay9tY2UuYworKysgYi94ZW4vYXJjaC94ODYvY3B1L21jaGVjay9tY2UuYwpA
QCAtNDczLDcgKzQ3Myw4IEBAIHZvaWQgbWNoZWNrX2Ntbl9oYW5kbGVyKGNvbnN0IHN0cnVjdCBj
cHUKICAgICBzdGF0aWMgYXRvbWljX3QgZm91bmRfZXJyb3IgPSBBVE9NSUNfSU5JVCgwKTsKICAg
ICBzdGF0aWMgY3B1bWFza190IG1jZV9mYXRhbF9jcHVzOwogICAgIHN0cnVjdCBtY2FfYmFua3Mg
KmJhbmttYXNrID0gbWNhX2FsbGJhbmtzOwotICAgIHN0cnVjdCBtY2FfYmFua3MgKmNsZWFyX2Jh
bmsgPSBfX2dldF9jcHVfdmFyKG1jZV9jbGVhcl9iYW5rcyk7CisgICAgdW5zaWduZWQgaW50IGNw
dSA9IHNtcF9wcm9jZXNzb3JfaWQoKTsKKyAgICBzdHJ1Y3QgbWNhX2JhbmtzICpjbGVhcl9iYW5r
ID0gcGVyX2NwdShtY2VfY2xlYXJfYmFua3MsIGNwdSk7CiAgICAgdWludDY0X3QgZ3N0YXR1czsK
ICAgICBtY3RlbGVtX2Nvb2tpZV90IG1jdGMgPSBOVUxMOwogICAgIHN0cnVjdCBtY2Ffc3VtbWFy
eSBiczsKQEAgLTUwNCwxNyArNTA1LDE3IEBAIHZvaWQgbWNoZWNrX2Ntbl9oYW5kbGVyKGNvbnN0
IHN0cnVjdCBjcHUKICAgICAgICAgICAgICAqIHRoZSB0ZWxlbWV0cnkgYWZ0ZXIgcmVib290ICh0
aGUgTVNScyBhcmUgc3RpY2t5KQogICAgICAgICAgICAgICovCiAgICAgICAgICAgICBpZiAoIGJz
LnBjYyB8fCAhYnMucmVjb3ZlcmFibGUgKQotICAgICAgICAgICAgICAgIGNwdW1hc2tfc2V0X2Nw
dShzbXBfcHJvY2Vzc29yX2lkKCksICZtY2VfZmF0YWxfY3B1cyk7CisgICAgICAgICAgICAgICAg
Y3B1bWFza19zZXRfY3B1KGNwdSwgJm1jZV9mYXRhbF9jcHVzKTsKICAgICAgICAgfQogICAgICAg
ICBlbHNlIGlmICggbWN0YyAhPSBOVUxMICkKICAgICAgICAgICAgIG1jdGVsZW1fY29tbWl0KG1j
dGMpOwogICAgICAgICBhdG9taWNfc2V0KCZmb3VuZF9lcnJvciwgMSk7CiAKICAgICAgICAgLyog
VGhlIGxhc3QgQ1BVIHdpbGwgYmUgdGFrZSBjaGVjay9jbGVhbi11cCBldGMgKi8KLSAgICAgICAg
YXRvbWljX3NldCgmc2V2ZXJpdHlfY3B1LCBzbXBfcHJvY2Vzc29yX2lkKCkpOworICAgICAgICBh
dG9taWNfc2V0KCZzZXZlcml0eV9jcHUsIGNwdSk7CiAKLSAgICAgICAgbWNlX3ByaW50ayhNQ0Vf
Q1JJVElDQUwsICJNQ0U6IGNsZWFyX2JhbmsgbWFwICVseCBvbiBDUFUlZFxuIiwKLSAgICAgICAg
ICAgICAgICAgICAqKCh1bnNpZ25lZCBsb25nICopY2xlYXJfYmFuayksIHNtcF9wcm9jZXNzb3Jf
aWQoKSk7CisgICAgICAgIG1jZV9wcmludGsoTUNFX0NSSVRJQ0FMLCAiTUNFOiBjbGVhcl9iYW5r
IG1hcCAlbHggb24gQ1BVJXVcbiIsCisgICAgICAgICAgICAgICAgICAgKigodW5zaWduZWQgbG9u
ZyAqKWNsZWFyX2JhbmspLCBjcHUpOwogICAgICAgICBpZiAoIGNsZWFyX2JhbmsgIT0gTlVMTCAp
CiAgICAgICAgICAgICBtY2hlY2tfbWNhX2NsZWFyYmFua3MoY2xlYXJfYmFuayk7CiAgICAgfQpA
QCAtNTI0LDE0ICs1MjUsMTQgQEAgdm9pZCBtY2hlY2tfY21uX2hhbmRsZXIoY29uc3Qgc3RydWN0
IGNwdQogCiAgICAgbWNlX2JhcnJpZXJfZW50ZXIoJm1jZV90cmFwX2JhciwgYmNhc3QpOwogICAg
IGlmICggbWN0YyAhPSBOVUxMICYmIG1jZV91cmdlbnRfYWN0aW9uKHJlZ3MsIG1jdGMpICkKLSAg
ICAgICAgY3B1bWFza19zZXRfY3B1KHNtcF9wcm9jZXNzb3JfaWQoKSwgJm1jZV9mYXRhbF9jcHVz
KTsKKyAgICAgICAgY3B1bWFza19zZXRfY3B1KGNwdSwgJm1jZV9mYXRhbF9jcHVzKTsKICAgICBt
Y2VfYmFycmllcl9leGl0KCZtY2VfdHJhcF9iYXIsIGJjYXN0KTsKIAogICAgIC8qCiAgICAgICog
V2FpdCB1bnRpbCBldmVyeWJvZHkgaGFzIHByb2Nlc3NlZCB0aGUgdHJhcC4KICAgICAgKi8KICAg
ICBtY2VfYmFycmllcl9lbnRlcigmbWNlX3RyYXBfYmFyLCBiY2FzdCk7Ci0gICAgaWYgKCBsbWNl
IHx8IGF0b21pY19yZWFkKCZzZXZlcml0eV9jcHUpID09IHNtcF9wcm9jZXNzb3JfaWQoKSApCisg
ICAgaWYgKCBsbWNlIHx8IGF0b21pY19yZWFkKCZzZXZlcml0eV9jcHUpID09IGNwdSApCiAgICAg
ewogICAgICAgICAvKgogICAgICAgICAgKiBBY2NvcmRpbmcgdG8gU0RNLCBpZiBubyBlcnJvciBi
YW5rIGZvdW5kIG9uIGFueSBjcHVzLAotLS0gYS94ZW4vYXJjaC94ODYvY3B1L21jaGVjay9tY2Vf
aW50ZWwuYworKysgYi94ZW4vYXJjaC94ODYvY3B1L21jaGVjay9tY2VfaW50ZWwuYwpAQCAtNDky
LDYgKzQ5Miw3IEBAIHN0YXRpYyBpbnQgZG9fY21jaV9kaXNjb3ZlcihpbnQgaSkKICAgICB1bnNp
Z25lZCBtc3IgPSBNU1JfSUEzMl9NQ3hfQ1RMMihpKTsKICAgICB1NjQgdmFsOwogICAgIHVuc2ln
bmVkIGludCB0aHJlc2hvbGQsIG1heF90aHJlc2hvbGQ7CisgICAgdW5zaWduZWQgaW50IGNwdSA9
IHNtcF9wcm9jZXNzb3JfaWQoKTsKICAgICBzdGF0aWMgdW5zaWduZWQgaW50IGNtY2lfdGhyZXNo
b2xkID0gMjsKICAgICBpbnRlZ2VyX3BhcmFtKCJjbWNpLXRocmVzaG9sZCIsIGNtY2lfdGhyZXNo
b2xkKTsKIApAQCAtNDk5LDcgKzUwMCw3IEBAIHN0YXRpYyBpbnQgZG9fY21jaV9kaXNjb3Zlcihp
bnQgaSkKICAgICAvKiBTb21lIG90aGVyIENQVSBhbHJlYWR5IG93bnMgdGhpcyBiYW5rLiAqLwog
ICAgIGlmICggdmFsICYgQ01DSV9FTiApCiAgICAgewotICAgICAgICBtY2FiYW5rc19jbGVhcihp
LCBfX2dldF9jcHVfdmFyKG1jZV9iYW5rc19vd25lZCkpOworICAgICAgICBtY2FiYW5rc19jbGVh
cihpLCBwZXJfY3B1KG1jZV9iYW5rc19vd25lZCwgY3B1KSk7CiAgICAgICAgIGdvdG8gb3V0Owog
ICAgIH0KIApAQCAtNTEyLDcgKzUxMyw3IEBAIHN0YXRpYyBpbnQgZG9fY21jaV9kaXNjb3Zlcihp
bnQgaSkKICAgICBpZiAoICEodmFsICYgQ01DSV9FTikgKQogICAgIHsKICAgICAgICAgLyogVGhp
cyBiYW5rIGRvZXMgbm90IHN1cHBvcnQgQ01DSS4gUG9sbGluZyB0aW1lciBoYXMgdG8gaGFuZGxl
IGl0LiAqLwotICAgICAgICBtY2FiYW5rc19zZXQoaSwgX19nZXRfY3B1X3Zhcihub19jbWNpX2Jh
bmtzKSk7CisgICAgICAgIG1jYWJhbmtzX3NldChpLCBwZXJfY3B1KG5vX2NtY2lfYmFua3MsIGNw
dSkpOwogICAgICAgICB3cm1zcmwobXNyLCB2YWwgJiB+Q01DSV9USFJFU0hPTERfTUFTSyk7CiAg
ICAgICAgIHJldHVybiAwOwogICAgIH0KQEAgLTUyMiwxMyArNTIzLDEzIEBAIHN0YXRpYyBpbnQg
ZG9fY21jaV9kaXNjb3ZlcihpbnQgaSkKICAgICB7CiAgICAgICAgIG1jZV9wcmludGsoTUNFX1FV
SUVULAogICAgICAgICAgICAgICAgICAgICJDTUNJOiB0aHJlc2hvbGQgJSN4IHRvbyBsYXJnZSBm
b3IgQ1BVJXUgYmFuayAldSwgdXNpbmcgJSN4XG4iLAotICAgICAgICAgICAgICAgICAgIHRocmVz
aG9sZCwgc21wX3Byb2Nlc3Nvcl9pZCgpLCBpLCBtYXhfdGhyZXNob2xkKTsKKyAgICAgICAgICAg
ICAgICAgICB0aHJlc2hvbGQsIGNwdSwgaSwgbWF4X3RocmVzaG9sZCk7CiAgICAgICAgIHRocmVz
aG9sZCA9IG1heF90aHJlc2hvbGQ7CiAgICAgfQogICAgIHdybXNybChtc3IsICh2YWwgJiB+Q01D
SV9USFJFU0hPTERfTUFTSykgfCBDTUNJX0VOIHwgdGhyZXNob2xkKTsKLSAgICBtY2FiYW5rc19z
ZXQoaSwgX19nZXRfY3B1X3ZhcihtY2VfYmFua3Nfb3duZWQpKTsKKyAgICBtY2FiYW5rc19zZXQo
aSwgcGVyX2NwdShtY2VfYmFua3Nfb3duZWQsIGNwdSkpOwogb3V0OgotICAgIG1jYWJhbmtzX2Ns
ZWFyKGksIF9fZ2V0X2NwdV92YXIobm9fY21jaV9iYW5rcykpOworICAgIG1jYWJhbmtzX2NsZWFy
KGksIHBlcl9jcHUobm9fY21jaV9iYW5rcywgY3B1KSk7CiAgICAgcmV0dXJuIDE7CiB9CiAKQEAg
LTY0OCw3ICs2NDksNyBAQCBzdGF0aWMgdm9pZCBjbWNpX2ludGVycnVwdChzdHJ1Y3QgY3B1X3Vz
CiAgICAgYWNrX0FQSUNfaXJxKCk7CiAKICAgICBtY3RjID0gbWNoZWNrX21jYV9sb2dvdXQoCi0g
ICAgICAgIE1DQV9DTUNJX0hBTkRMRVIsIF9fZ2V0X2NwdV92YXIobWNlX2JhbmtzX293bmVkKSwg
JmJzLCBOVUxMKTsKKyAgICAgICAgTUNBX0NNQ0lfSEFORExFUiwgdGhpc19jcHUobWNlX2Jhbmtz
X293bmVkKSwgJmJzLCBOVUxMKTsKIAogICAgIGlmICggYnMuZXJyY250ICYmIG1jdGMgIT0gTlVM
TCApCiAgICAgewotLS0gYS94ZW4vYXJjaC94ODYvY3B1L21jaGVjay9ub24tZmF0YWwuYworKysg
Yi94ZW4vYXJjaC94ODYvY3B1L21jaGVjay9ub24tZmF0YWwuYwpAQCAtMzgsNyArMzgsOCBAQCBz
dGF0aWMgdm9pZCBtY2VfY2hlY2tyZWdzICh2b2lkICppbmZvKQogCXN0cnVjdCBtY2Ffc3VtbWFy
eSBiczsKIAlzdGF0aWMgdWludDY0X3QgZHVtcGNvdW50ID0gMDsKIAotCW1jdGMgPSBtY2hlY2tf
bWNhX2xvZ291dChNQ0FfUE9MTEVSLCBfX2dldF9jcHVfdmFyKHBvbGxfYmFua21hc2spLCAmYnMs
IE5VTEwpOworCW1jdGMgPSBtY2hlY2tfbWNhX2xvZ291dChNQ0FfUE9MTEVSLCB0aGlzX2NwdShw
b2xsX2JhbmttYXNrKSwKKwkJCQkgJmJzLCBOVUxMKTsKIAogCWlmIChicy5lcnJjbnQgJiYgbWN0
YyAhPSBOVUxMKSB7CiAJCWFkanVzdCsrOwpAQCAtOTMsNyArOTQsNyBAQCBzdGF0aWMgaW50IF9f
aW5pdCBpbml0X25vbmZhdGFsX21jZV9jaGVjCiAJaWYgKCFvcHRfbWNlIHx8ICFtY2VfYXZhaWxh
YmxlKGMpKQogCQlyZXR1cm4gLUVOT0RFVjsKIAotCWlmIChfX2dldF9jcHVfdmFyKHBvbGxfYmFu
a21hc2spID09IE5VTEwpCisJaWYgKCF0aGlzX2NwdShwb2xsX2JhbmttYXNrKSkKIAkJcmV0dXJu
IC1FSU5WQUw7CiAKIAkvKgoKCgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJv
amVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hl
bi1kZXZlbA==

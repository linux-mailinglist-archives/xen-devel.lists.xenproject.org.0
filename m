Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id D5C8014DECD
	for <lists+xen-devel@lfdr.de>; Thu, 30 Jan 2020 17:17:15 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1ixCTS-0005K8-I8; Thu, 30 Jan 2020 16:15:22 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=RwoG=3T=merlin.srs.infradead.org=batv+f9651308fc69d1c188a8+6003+infradead.org+dwmw2@srs-us1.protection.inumbo.net>)
 id 1ixCTQ-0005Iv-Q3
 for xen-devel@lists.xenproject.org; Thu, 30 Jan 2020 16:15:20 +0000
X-Inumbo-ID: 78cae798-437b-11ea-a933-bc764e2007e4
Received: from merlin.infradead.org (unknown [2001:8b0:10b:1231::1])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 78cae798-437b-11ea-a933-bc764e2007e4;
 Thu, 30 Jan 2020 16:13:38 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
 d=infradead.org; s=merlin.20170209; h=Sender:Content-Transfer-Encoding:
 MIME-Version:References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:
 Reply-To:Content-Type:Content-ID:Content-Description:Resent-Date:Resent-From:
 Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:List-Id:List-Help:
 List-Unsubscribe:List-Subscribe:List-Post:List-Owner:List-Archive;
 bh=h+oTXoHnIIrP6hDWy90HME6sh9qFOM8efyxFfaYTYHA=; b=ml6Qa2BimcK1mSml0OacL9n6Ci
 OHEbZKZxl2PzoHdT/i7lLXwsXFpA7qBIm96O5ZlLJBeOom17RbIHLBThzFTP6ySgnnLrxII7DCHMJ
 m0Q7uNQVI+NjN0Kh2O73PI5BGDzXheyy53ucPa0rYr00hOxDvT6zL+CqfsaGxSZHMBBSvG9Jrtijd
 vUX2QFX7ay7KEcw8oK8qLYQ1esmj2fXxxm95o2PTN/azprEaRsdJlhQY78DOqIHwnPxsttEaQTMFm
 87u89PjdSuV7THXAkZ2fAdtN22UGjEHjaMaUt9iqwEDPzhnzG++T35K2DYxRazAbV/IC8DLDcpre1
 P3HpAyRA==;
Received: from i7.infradead.org ([2001:8b0:10b:1:21e:67ff:fecb:7a92])
 by merlin.infradead.org with esmtpsa (Exim 4.92.3 #3 (Red Hat Linux))
 id 1ixCRf-0005Tp-Dt; Thu, 30 Jan 2020 16:13:31 +0000
Received: from dwoodhou by i7.infradead.org with local (Exim 4.92 #3 (Red Hat
 Linux)) id 1ixCRe-009keM-K6; Thu, 30 Jan 2020 16:13:30 +0000
From: David Woodhouse <dwmw2@infradead.org>
To: Xen-devel <xen-devel@lists.xenproject.org>
Date: Thu, 30 Jan 2020 16:13:28 +0000
Message-Id: <20200130161330.2324143-20-dwmw2@infradead.org>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20200130161330.2324143-1-dwmw2@infradead.org>
References: <a92287c03fed310e08ba40063e370038569b94ac.camel@infradead.org>
 <20200130161330.2324143-1-dwmw2@infradead.org>
MIME-Version: 1.0
X-SRS-Rewrite: SMTP reverse-path rewritten from <dwmw2@infradead.org> by
 merlin.infradead.org. See http://www.infradead.org/rpr.html
Subject: [Xen-devel] [RFC PATCH v3 20/22] x86/setup: lift dom0 creation out
 into create_dom0 function
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Stefano Stabellini <sstabellini@kernel.org>, Julien Grall <julien@xen.org>,
 Wei Liu <wl@xen.org>, Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>, Varad Gautam <vrd@amazon.de>,
 paul@xen.org, Ian Jackson <ian.jackson@eu.citrix.com>,
 Hongyan Xia <hongyxia@amazon.com>, Amit Shah <aams@amazon.de>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

RnJvbTogRGF2aWQgV29vZGhvdXNlIDxkd213QGFtYXpvbi5jby51az4KCkl0J3MgYWJvdXQgdG8g
YmVjb21lIG9wdGlvbmFsIGFzIF9fc3RhcnRfeGVuKCkgZ3Jvd3MgYSBkaWZmZXJlbnQgcGF0aApm
b3IgbGl2ZSB1cGRhdGUsIHNvIG1vdmUgaXQgb3V0IG9mIHRoZSB3YXkuCgpTaWduZWQtb2ZmLWJ5
OiBEYXZpZCBXb29kaG91c2UgPGR3bXdAYW1hem9uLmNvLnVrPgotLS0KIHhlbi9hcmNoL3g4Ni9z
ZXR1cC5jIHwgMTczICsrKysrKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tLS0tLS0tLS0K
IDEgZmlsZSBjaGFuZ2VkLCA5NCBpbnNlcnRpb25zKCspLCA3OSBkZWxldGlvbnMoLSkKCmRpZmYg
LS1naXQgYS94ZW4vYXJjaC94ODYvc2V0dXAuYyBiL3hlbi9hcmNoL3g4Ni9zZXR1cC5jCmluZGV4
IGY3ODk3MTNiMWIuLmFjOTM5NjViZTQgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9zZXR1cC5j
CisrKyBiL3hlbi9hcmNoL3g4Ni9zZXR1cC5jCkBAIC02NzksNiArNjc5LDkyIEBAIHN0YXRpYyB1
bnNpZ25lZCBpbnQgX19pbml0IGNvcHlfYmlvc19lODIwKHN0cnVjdCBlODIwZW50cnkgKm1hcCwg
dW5zaWduZWQgaW50IGxpCiAgICAgcmV0dXJuIG47CiB9CiAKK3N0YXRpYyBzdHJ1Y3QgZG9tYWlu
ICogX19pbml0IGNyZWF0ZV9kb20wKGNvbnN0IG1vZHVsZV90ICppbWFnZSwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGxvbmcgaGVhZHJvb20sCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2R1bGVfdCAqaW5pdHJk
LCBjaGFyICprZXh0cmEsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBjaGFyICpsb2FkZXIpCit7CisgICAgc3RydWN0IHhlbl9kb21jdGxfY3JlYXRlZG9tYWluIGRv
bTBfY2ZnID0geworICAgICAgICAuZmxhZ3MgPSBJU19FTkFCTEVEKENPTkZJR19UQk9PVCkgPyBY
RU5fRE9NQ1RMX0NERl9zM19pbnRlZ3JpdHkgOiAwLAorICAgICAgICAubWF4X2V2dGNobl9wb3J0
ID0gLTEsCisgICAgICAgIC5tYXhfZ3JhbnRfZnJhbWVzID0gLTEsCisgICAgICAgIC5tYXhfbWFw
dHJhY2tfZnJhbWVzID0gLTEsCisgICAgfTsKKyAgICBzdHJ1Y3QgZG9tYWluICpkOworICAgIGNo
YXIgKmNtZGxpbmU7CisKKyAgICBpZiAoIG9wdF9kb20wX3B2aCApCisgICAgeworICAgICAgICBk
b20wX2NmZy5mbGFncyB8PSAoWEVOX0RPTUNUTF9DREZfaHZtIHwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICgoaHZtX2hhcF9zdXBwb3J0ZWQoKSAmJiAhb3B0X2RvbTBfc2hhZG93KSA/Cisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgWEVOX0RPTUNUTF9DREZfaGFwIDogMCkpOworCisg
ICAgICAgIGRvbTBfY2ZnLmFyY2guZW11bGF0aW9uX2ZsYWdzIHw9CisgICAgICAgICAgICBYRU5f
WDg2X0VNVV9MQVBJQyB8IFhFTl9YODZfRU1VX0lPQVBJQyB8IFhFTl9YODZfRU1VX1ZQQ0k7Cisg
ICAgfQorICAgIGRvbTBfY2ZnLm1heF92Y3B1cyA9IGRvbTBfbWF4X3ZjcHVzKCk7CisKKyAgICBp
ZiAoIGlvbW11X2VuYWJsZWQgKQorICAgICAgICBkb20wX2NmZy5mbGFncyB8PSBYRU5fRE9NQ1RM
X0NERl9pb21tdTsKKworICAgIC8qIENyZWF0ZSBpbml0aWFsIGRvbWFpbiAwLiAqLworICAgIGQg
PSBkb21haW5fY3JlYXRlKGdldF9pbml0aWFsX2RvbWFpbl9pZCgpLCAmZG9tMF9jZmcsICFwdl9z
aGltKTsKKyAgICBpZiAoIElTX0VSUihkKSB8fCAoYWxsb2NfZG9tMF92Y3B1MChkKSA9PSBOVUxM
KSApCisgICAgICAgIHBhbmljKCJFcnJvciBjcmVhdGluZyBkb21haW4gMFxuIik7CisKKyAgICAv
KiBHcmFiIHRoZSBET00wIGNvbW1hbmQgbGluZS4gKi8KKyAgICBjbWRsaW5lID0gKGNoYXIgKiko
aW1hZ2UtPnN0cmluZyA/IF9fdmEoaW1hZ2UtPnN0cmluZykgOiBOVUxMKTsKKyAgICBpZiAoIChj
bWRsaW5lICE9IE5VTEwpIHx8IChrZXh0cmEgIT0gTlVMTCkgKQorICAgIHsKKyAgICAgICAgc3Rh
dGljIGNoYXIgX19pbml0ZGF0YSBkb20wX2NtZGxpbmVbTUFYX0dVRVNUX0NNRExJTkVdOworCisg
ICAgICAgIGNtZGxpbmUgPSBjbWRsaW5lX2Nvb2soY21kbGluZSwgbG9hZGVyKTsKKyAgICAgICAg
c2FmZV9zdHJjcHkoZG9tMF9jbWRsaW5lLCBjbWRsaW5lKTsKKworICAgICAgICBpZiAoIGtleHRy
YSAhPSBOVUxMICkKKyAgICAgICAgICAgIC8qIGtleHRyYSBhbHdheXMgaW5jbHVkZXMgZXhhY3Rs
eSBvbmUgbGVhZGluZyBzcGFjZS4gKi8KKyAgICAgICAgICAgIHNhZmVfc3RyY2F0KGRvbTBfY21k
bGluZSwga2V4dHJhKTsKKworICAgICAgICAvKiBBcHBlbmQgYW55IGV4dHJhIHBhcmFtZXRlcnMu
ICovCisgICAgICAgIGlmICggc2tpcF9pb2FwaWNfc2V0dXAgJiYgIXN0cnN0cihkb20wX2NtZGxp
bmUsICJub2FwaWMiKSApCisgICAgICAgICAgICBzYWZlX3N0cmNhdChkb20wX2NtZGxpbmUsICIg
bm9hcGljIik7CisgICAgICAgIGlmICggKHN0cmxlbihhY3BpX3BhcmFtKSA9PSAwKSAmJiBhY3Bp
X2Rpc2FibGVkICkKKyAgICAgICAgeworICAgICAgICAgICAgcHJpbnRrKCJBQ1BJIGlzIGRpc2Fi
bGVkLCBub3RpZnlpbmcgRG9tYWluIDAgKGFjcGk9b2ZmKVxuIik7CisgICAgICAgICAgICBzYWZl
X3N0cmNweShhY3BpX3BhcmFtLCAib2ZmIik7CisgICAgICAgIH0KKyAgICAgICAgaWYgKCAoc3Ry
bGVuKGFjcGlfcGFyYW0pICE9IDApICYmICFzdHJzdHIoZG9tMF9jbWRsaW5lLCAiYWNwaT0iKSAp
CisgICAgICAgIHsKKyAgICAgICAgICAgIHNhZmVfc3RyY2F0KGRvbTBfY21kbGluZSwgIiBhY3Bp
PSIpOworICAgICAgICAgICAgc2FmZV9zdHJjYXQoZG9tMF9jbWRsaW5lLCBhY3BpX3BhcmFtKTsK
KyAgICAgICAgfQorCisgICAgICAgIGNtZGxpbmUgPSBkb20wX2NtZGxpbmU7CisgICAgfQorCisg
ICAgLyoKKyAgICAgKiBUZW1wb3JhcmlseSBjbGVhciBTTUFQIGluIENSNCB0byBhbGxvdyB1c2Vy
LWFjY2Vzc2VzIGluIGNvbnN0cnVjdF9kb20wKCkuCisgICAgICogVGhpcyBzYXZlcyBhIGxhcmdl
IG51bWJlciBvZiBjb3JuZXIgY2FzZXMgaW50ZXJhY3Rpb25zIHdpdGgKKyAgICAgKiBjb3B5X2Zy
b21fdXNlcigpLgorICAgICAqLworICAgIGlmICggY3B1X2hhc19zbWFwICkKKyAgICB7CisgICAg
ICAgIGNyNF9wdjMyX21hc2sgJj0gflg4Nl9DUjRfU01BUDsKKyAgICAgICAgd3JpdGVfY3I0KHJl
YWRfY3I0KCkgJiB+WDg2X0NSNF9TTUFQKTsKKyAgICB9CisKKyAgICBpZiAoIGNvbnN0cnVjdF9k
b20wKGQsIGltYWdlLCBoZWFkcm9vbSwgaW5pdHJkLCBjbWRsaW5lKSAhPSAwICkKKyAgICAgICAg
cGFuaWMoIkNvdWxkIG5vdCBjb25zdHJ1Y3QgZG9tYWluIDBcbiIpOworCisgICAgaWYgKCBjcHVf
aGFzX3NtYXAgKQorICAgIHsKKyAgICAgICAgd3JpdGVfY3I0KHJlYWRfY3I0KCkgfCBYODZfQ1I0
X1NNQVApOworICAgICAgICBjcjRfcHYzMl9tYXNrIHw9IFg4Nl9DUjRfU01BUDsKKyAgICB9CisK
KyAgICByZXR1cm4gZDsKK30KKwogLyogSG93IG11Y2ggb2YgdGhlIGRpcmVjdG1hcCBpcyBwcmVi
dWlsdCBhdCBjb21waWxlIHRpbWUuICovCiAjZGVmaW5lIFBSRUJVSUxUX01BUF9MSU1JVCAoMSA8
PCBMMl9QQUdFVEFCTEVfU0hJRlQpCiAKQEAgLTczOSwxMiArODI1LDYgQEAgdm9pZCBfX2luaXQg
bm9yZXR1cm4gX19zdGFydF94ZW4odW5zaWduZWQgbG9uZyBtYmlfcCkKICAgICAgICAgLnBhcml0
eSAgICA9ICduJywKICAgICAgICAgLnN0b3BfYml0cyA9IDEKICAgICB9OwotICAgIHN0cnVjdCB4
ZW5fZG9tY3RsX2NyZWF0ZWRvbWFpbiBkb20wX2NmZyA9IHsKLSAgICAgICAgLmZsYWdzID0gSVNf
RU5BQkxFRChDT05GSUdfVEJPT1QpID8gWEVOX0RPTUNUTF9DREZfczNfaW50ZWdyaXR5IDogMCwK
LSAgICAgICAgLm1heF9ldnRjaG5fcG9ydCA9IC0xLAotICAgICAgICAubWF4X2dyYW50X2ZyYW1l
cyA9IC0xLAotICAgICAgICAubWF4X21hcHRyYWNrX2ZyYW1lcyA9IC0xLAotICAgIH07CiAgICAg
Y29uc3QgY2hhciAqaHlwZXJ2aXNvcl9uYW1lOwogICAgIHVpbnQ2NF90IGx1X21mbmxpc3RfcGh5
cyA9IDAsIGx1X25yX3BhZ2VzID0gMDsKICAgICBzdHJ1Y3QgbHVfc3RyZWFtIGx1X3N0cmVhbTsK
QEAgLTE4ODksOTQgKzE5NjksMjkgQEAgdm9pZCBfX2luaXQgbm9yZXR1cm4gX19zdGFydF94ZW4o
dW5zaWduZWQgbG9uZyBtYmlfcCkKICAgICBpbml0X2d1ZXN0X2NwdWlkKCk7CiAgICAgaW5pdF9n
dWVzdF9tc3JfcG9saWN5KCk7CiAKLSAgICBpZiAoIG9wdF9kb20wX3B2aCApCi0gICAgewotICAg
ICAgICBkb20wX2NmZy5mbGFncyB8PSAoWEVOX0RPTUNUTF9DREZfaHZtIHwKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICgoaHZtX2hhcF9zdXBwb3J0ZWQoKSAmJiAhb3B0X2RvbTBfc2hhZG93
KSA/Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgWEVOX0RPTUNUTF9DREZfaGFwIDogMCkp
OwotCi0gICAgICAgIGRvbTBfY2ZnLmFyY2guZW11bGF0aW9uX2ZsYWdzIHw9Ci0gICAgICAgICAg
ICBYRU5fWDg2X0VNVV9MQVBJQyB8IFhFTl9YODZfRU1VX0lPQVBJQyB8IFhFTl9YODZfRU1VX1ZQ
Q0k7Ci0gICAgfQotICAgIGRvbTBfY2ZnLm1heF92Y3B1cyA9IGRvbTBfbWF4X3ZjcHVzKCk7Ci0K
LSAgICBpZiAoIGlvbW11X2VuYWJsZWQgKQotICAgICAgICBkb20wX2NmZy5mbGFncyB8PSBYRU5f
RE9NQ1RMX0NERl9pb21tdTsKLQotICAgIC8qIENyZWF0ZSBpbml0aWFsIGRvbWFpbiAwLiAqLwot
ICAgIGRvbTAgPSBkb21haW5fY3JlYXRlKGdldF9pbml0aWFsX2RvbWFpbl9pZCgpLCAmZG9tMF9j
ZmcsICFwdl9zaGltKTsKLSAgICBpZiAoIElTX0VSUihkb20wKSB8fCAoYWxsb2NfZG9tMF92Y3B1
MChkb20wKSA9PSBOVUxMKSApCi0gICAgICAgIHBhbmljKCJFcnJvciBjcmVhdGluZyBkb21haW4g
MFxuIik7Ci0KLSAgICAvKiBHcmFiIHRoZSBET00wIGNvbW1hbmQgbGluZS4gKi8KLSAgICBjbWRs
aW5lID0gKGNoYXIgKikobW9kWzBdLnN0cmluZyA/IF9fdmEobW9kWzBdLnN0cmluZykgOiBOVUxM
KTsKLSAgICBpZiAoIChjbWRsaW5lICE9IE5VTEwpIHx8IChrZXh0cmEgIT0gTlVMTCkgKQotICAg
IHsKLSAgICAgICAgc3RhdGljIGNoYXIgX19pbml0ZGF0YSBkb20wX2NtZGxpbmVbTUFYX0dVRVNU
X0NNRExJTkVdOwotCi0gICAgICAgIGNtZGxpbmUgPSBjbWRsaW5lX2Nvb2soY21kbGluZSwgbG9h
ZGVyKTsKLSAgICAgICAgc2FmZV9zdHJjcHkoZG9tMF9jbWRsaW5lLCBjbWRsaW5lKTsKLQotICAg
ICAgICBpZiAoIGtleHRyYSAhPSBOVUxMICkKLSAgICAgICAgICAgIC8qIGtleHRyYSBhbHdheXMg
aW5jbHVkZXMgZXhhY3RseSBvbmUgbGVhZGluZyBzcGFjZS4gKi8KLSAgICAgICAgICAgIHNhZmVf
c3RyY2F0KGRvbTBfY21kbGluZSwga2V4dHJhKTsKLQotICAgICAgICAvKiBBcHBlbmQgYW55IGV4
dHJhIHBhcmFtZXRlcnMuICovCi0gICAgICAgIGlmICggc2tpcF9pb2FwaWNfc2V0dXAgJiYgIXN0
cnN0cihkb20wX2NtZGxpbmUsICJub2FwaWMiKSApCi0gICAgICAgICAgICBzYWZlX3N0cmNhdChk
b20wX2NtZGxpbmUsICIgbm9hcGljIik7Ci0gICAgICAgIGlmICggKHN0cmxlbihhY3BpX3BhcmFt
KSA9PSAwKSAmJiBhY3BpX2Rpc2FibGVkICkKLSAgICAgICAgewotICAgICAgICAgICAgcHJpbnRr
KCJBQ1BJIGlzIGRpc2FibGVkLCBub3RpZnlpbmcgRG9tYWluIDAgKGFjcGk9b2ZmKVxuIik7Ci0g
ICAgICAgICAgICBzYWZlX3N0cmNweShhY3BpX3BhcmFtLCAib2ZmIik7Ci0gICAgICAgIH0KLSAg
ICAgICAgaWYgKCAoc3RybGVuKGFjcGlfcGFyYW0pICE9IDApICYmICFzdHJzdHIoZG9tMF9jbWRs
aW5lLCAiYWNwaT0iKSApCi0gICAgICAgIHsKLSAgICAgICAgICAgIHNhZmVfc3RyY2F0KGRvbTBf
Y21kbGluZSwgIiBhY3BpPSIpOwotICAgICAgICAgICAgc2FmZV9zdHJjYXQoZG9tMF9jbWRsaW5l
LCBhY3BpX3BhcmFtKTsKLSAgICAgICAgfQotCi0gICAgICAgIGNtZGxpbmUgPSBkb20wX2NtZGxp
bmU7Ci0gICAgfQotCiAgICAgaWYgKCB4ZW5fY3B1aWRsZSApCiAgICAgICAgIHhlbl9wcm9jZXNz
b3JfcG1iaXRzIHw9IFhFTl9QUk9DRVNTT1JfUE1fQ1g7CiAKKyAgICBwcmludGsoIiVzTlggKEV4
ZWN1dGUgRGlzYWJsZSkgcHJvdGVjdGlvbiAlc2FjdGl2ZVxuIiwKKyAgICAgICAgICAgY3B1X2hh
c19ueCA/IFhFTkxPR19JTkZPIDogWEVOTE9HX1dBUk5JTkcgIldhcm5pbmc6ICIsCisgICAgICAg
ICAgIGNwdV9oYXNfbnggPyAiIiA6ICJub3QgIik7CisKICAgICBpbml0cmRpZHggPSBmaW5kX2Zp
cnN0X2JpdChtb2R1bGVfbWFwLCBtYmktPm1vZHNfY291bnQpOwogICAgIGlmICggYml0bWFwX3dl
aWdodChtb2R1bGVfbWFwLCBtYmktPm1vZHNfY291bnQpID4gMSApCiAgICAgICAgIHByaW50ayhY
RU5MT0dfV0FSTklORwogICAgICAgICAgICAgICAgIk11bHRpcGxlIGluaXRyZCBjYW5kaWRhdGVz
LCBwaWNraW5nIG1vZHVsZSAjJXVcbiIsCiAgICAgICAgICAgICAgICBpbml0cmRpZHgpOwogCi0g
ICAgLyoKLSAgICAgKiBUZW1wb3JhcmlseSBjbGVhciBTTUFQIGluIENSNCB0byBhbGxvdyB1c2Vy
LWFjY2Vzc2VzIGluIGNvbnN0cnVjdF9kb20wKCkuCi0gICAgICogVGhpcyBzYXZlcyBhIGxhcmdl
IG51bWJlciBvZiBjb3JuZXIgY2FzZXMgaW50ZXJhY3Rpb25zIHdpdGgKLSAgICAgKiBjb3B5X2Zy
b21fdXNlcigpLgotICAgICAqLwotICAgIGlmICggY3B1X2hhc19zbWFwICkKLSAgICB7Ci0gICAg
ICAgIGNyNF9wdjMyX21hc2sgJj0gflg4Nl9DUjRfU01BUDsKLSAgICAgICAgd3JpdGVfY3I0KHJl
YWRfY3I0KCkgJiB+WDg2X0NSNF9TTUFQKTsKLSAgICB9Ci0KLSAgICBwcmludGsoIiVzTlggKEV4
ZWN1dGUgRGlzYWJsZSkgcHJvdGVjdGlvbiAlc2FjdGl2ZVxuIiwKLSAgICAgICAgICAgY3B1X2hh
c19ueCA/IFhFTkxPR19JTkZPIDogWEVOTE9HX1dBUk5JTkcgIldhcm5pbmc6ICIsCi0gICAgICAg
ICAgIGNwdV9oYXNfbnggPyAiIiA6ICJub3QgIik7Ci0KICAgICAvKgogICAgICAqIFdlJ3JlIGdv
aW5nIHRvIHNldHVwIGRvbWFpbjAgdXNpbmcgdGhlIG1vZHVsZShzKSB0aGF0IHdlIHN0YXNoZWQg
c2FmZWx5CiAgICAgICogYWJvdmUgb3VyIGhlYXAuIFRoZSBzZWNvbmQgbW9kdWxlLCBpZiBwcmVz
ZW50LCBpcyBhbiBpbml0cmQgcmFtZGlzay4KICAgICAgKi8KLSAgICBpZiAoIGNvbnN0cnVjdF9k
b20wKGRvbTAsIG1vZCwgbW9kdWxlc19oZWFkcm9vbSwKLSAgICAgICAgICAgICAgICAgICAgICAg
IChpbml0cmRpZHggPiAwKSAmJiAoaW5pdHJkaWR4IDwgbWJpLT5tb2RzX2NvdW50KQotICAgICAg
ICAgICAgICAgICAgICAgICAgPyBtb2QgKyBpbml0cmRpZHggOiBOVUxMLCBjbWRsaW5lKSAhPSAw
KQorICAgIGRvbTAgPSBjcmVhdGVfZG9tMChtb2QsIG1vZHVsZXNfaGVhZHJvb20sCisgICAgICAg
ICAgICAgICAgICAgICAgIChpbml0cmRpZHggPiAwKSAmJiAoaW5pdHJkaWR4IDwgbWJpLT5tb2Rz
X2NvdW50KQorICAgICAgICAgICAgICAgICAgICAgICA/IG1vZCArIGluaXRyZGlkeCA6IE5VTEws
IGtleHRyYSwgbG9hZGVyKTsKKyAgICBpZiAoIGRvbTAgPT0gTlVMTCApCiAgICAgICAgIHBhbmlj
KCJDb3VsZCBub3Qgc2V0IHVwIERPTTAgZ3Vlc3QgT1NcbiIpOwogCi0gICAgaWYgKCBjcHVfaGFz
X3NtYXAgKQotICAgIHsKLSAgICAgICAgd3JpdGVfY3I0KHJlYWRfY3I0KCkgfCBYODZfQ1I0X1NN
QVApOwotICAgICAgICBjcjRfcHYzMl9tYXNrIHw9IFg4Nl9DUjRfU01BUDsKLSAgICB9Ci0KICAg
ICBoZWFwX2luaXRfbGF0ZSgpOwogCiAgICAgaW5pdF90cmFjZV9idWZzKCk7Ci0tIAoyLjIxLjAK
CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2
ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xp
c3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id B45E42C494
	for <lists+xen-devel@lfdr.de>; Tue, 28 May 2019 12:39:30 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hVZRn-0008Jf-V7; Tue, 28 May 2019 10:35:11 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=31/0=T4=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1hVZQR-0005Kt-Cg
 for xen-devel@lists.xenproject.org; Tue, 28 May 2019 10:33:47 +0000
X-Inumbo-ID: 03839c1e-8134-11e9-b28c-83aa87c1b324
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 03839c1e-8134-11e9-b28c-83aa87c1b324;
 Tue, 28 May 2019 10:33:36 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id E9C08B030;
 Tue, 28 May 2019 10:33:18 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Tue, 28 May 2019 12:32:23 +0200
Message-Id: <20190528103313.1343-11-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190528103313.1343-1-jgross@suse.com>
References: <20190528103313.1343-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH 10/60] xen/sched: switch schedule_data.curr to
 point at sched_unit
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Tim Deegan <tim@xen.org>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>,
 Robert VanVossen <robert.vanvossen@dornerworks.com>,
 Dario Faggioli <dfaggioli@suse.com>, Julien Grall <julien.grall@arm.com>,
 Josh Whitehead <josh.whitehead@dornerworks.com>,
 Meng Xu <mengxu@cis.upenn.edu>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SW4gcHJlcGFyYXRpb24gb2YgY29yZSBzY2hlZHVsaW5nIGxldCB0aGUgcGVyY3B1IHBvaW50ZXIK
c2NoZWR1bGVfZGF0YS5jdXJyIHBvaW50IHRvIGEgc3RyY3Qgc2NoZWRfdW5pdCBpbnN0ZWFkIG9m
IHRoZSByZWxhdGVkCnZjcHUuIEF0IHRoZSBzYW1lIHRpbWUgcmVuYW1lIHRoZSBwZXItdmNwdSBz
Y2hlZHVsZXIgc3BlY2lmaWMgc3RydWN0cwp0byBwZXItdW5pdCBvbmVzLgoKU2lnbmVkLW9mZi1i
eTogSnVlcmdlbiBHcm9zcyA8amdyb3NzQHN1c2UuY29tPgotLS0KIHhlbi9jb21tb24vc2NoZWRf
YXJpbmM2NTMuYyB8ICAgMiArLQogeGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQuYyAgIHwgMTAxICsr
KysrKysrKysrKystLS0tLS0tLS0tLS0tCiB4ZW4vY29tbW9uL3NjaGVkX2NyZWRpdDIuYyAgfCAx
NjggKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIHhlbi9jb21t
b24vc2NoZWRfbnVsbC5jICAgICB8ICA0NCArKysrKystLS0tLS0KIHhlbi9jb21tb24vc2NoZWRf
cnQuYyAgICAgICB8IDExOCArKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tCiB4ZW4vY29t
bW9uL3NjaGVkdWxlLmMgICAgICAgfCAgIDggKystCiB4ZW4vaW5jbHVkZS94ZW4vc2NoZWQtaWYu
aCAgfCAgIDIgKy0KIDcgZmlsZXMgY2hhbmdlZCwgMjIwIGluc2VydGlvbnMoKyksIDIyMyBkZWxl
dGlvbnMoLSkKCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3NjaGVkX2FyaW5jNjUzLmMgYi94ZW4v
Y29tbW9uL3NjaGVkX2FyaW5jNjUzLmMKaW5kZXggMzgzZGY3NTBiMC4uN2YyNmU2YTBiMCAxMDA2
NDQKLS0tIGEveGVuL2NvbW1vbi9zY2hlZF9hcmluYzY1My5jCisrKyBiL3hlbi9jb21tb24vc2No
ZWRfYXJpbmM2NTMuYwpAQCAtNDc1LDcgKzQ3NSw3IEBAIGE2NTNzY2hlZF91bml0X3NsZWVwKGNv
bnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiAgICAg
ICogSWYgdGhlIFZDUFUgYmVpbmcgcHV0IHRvIHNsZWVwIGlzIHRoZSBzYW1lIG9uZSB0aGF0IGlz
IGN1cnJlbnRseQogICAgICAqIHJ1bm5pbmcsIHJhaXNlIGEgc29mdGlycSB0byBpbnZva2UgdGhl
IHNjaGVkdWxlciB0byBzd2l0Y2ggZG9tYWlucy4KICAgICAgKi8KLSAgICBpZiAoIHBlcl9jcHUo
c2NoZWR1bGVfZGF0YSwgdmMtPnByb2Nlc3NvcikuY3VyciA9PSB2YyApCisgICAgaWYgKCBwZXJf
Y3B1KHNjaGVkdWxlX2RhdGEsIHZjLT5wcm9jZXNzb3IpLmN1cnIgPT0gdW5pdCApCiAgICAgICAg
IGNwdV9yYWlzZV9zb2Z0aXJxKHZjLT5wcm9jZXNzb3IsIFNDSEVEVUxFX1NPRlRJUlEpOwogfQog
CmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3NjaGVkX2NyZWRpdC5jIGIveGVuL2NvbW1vbi9zY2hl
ZF9jcmVkaXQuYwppbmRleCA3Zjc1OTZiM2JmLi5iYzg3YjgxM2RjIDEwMDY0NAotLS0gYS94ZW4v
Y29tbW9uL3NjaGVkX2NyZWRpdC5jCisrKyBiL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0LmMKQEAg
LTgzLDcgKzgzLDcgQEAKICAgICAoKHN0cnVjdCBjc2NoZWRfcHJpdmF0ZSAqKSgoX29wcyktPnNj
aGVkX2RhdGEpKQogI2RlZmluZSBDU0NIRURfUENQVShfYykgICAgIFwKICAgICAoKHN0cnVjdCBj
c2NoZWRfcGNwdSAqKXBlcl9jcHUoc2NoZWR1bGVfZGF0YSwgX2MpLnNjaGVkX3ByaXYpCi0jZGVm
aW5lIENTQ0hFRF9WQ1BVKF92Y3B1KSAgKChzdHJ1Y3QgY3NjaGVkX3ZjcHUgKikgKF92Y3B1KS0+
c2NoZWRfdW5pdC0+cHJpdikKKyNkZWZpbmUgQ1NDSEVEX1VOSVQodW5pdCkgICAoKHN0cnVjdCBj
c2NoZWRfdW5pdCAqKSAodW5pdCktPnByaXYpCiAjZGVmaW5lIENTQ0hFRF9ET00oX2RvbSkgICAg
KChzdHJ1Y3QgY3NjaGVkX2RvbSAqKSAoX2RvbSktPnNjaGVkX3ByaXYpCiAjZGVmaW5lIFJVTlEo
X2NwdSkgICAgICAgICAgKCYoQ1NDSEVEX1BDUFUoX2NwdSktPnJ1bnEpKQogCkBAIC0xNjAsNyAr
MTYwLDcgQEAgc3RydWN0IGNzY2hlZF9wY3B1IHsKIC8qCiAgKiBWaXJ0dWFsIENQVQogICovCi1z
dHJ1Y3QgY3NjaGVkX3ZjcHUgeworc3RydWN0IGNzY2hlZF91bml0IHsKICAgICBzdHJ1Y3QgbGlz
dF9oZWFkIHJ1bnFfZWxlbTsKICAgICBzdHJ1Y3QgbGlzdF9oZWFkIGFjdGl2ZV92Y3B1X2VsZW07
CiAKQEAgLTIzMSwxNSArMjMxLDE1IEBAIHN0YXRpYyB2b2lkIGNzY2hlZF90aWNrKHZvaWQgKl9j
cHUpOwogc3RhdGljIHZvaWQgY3NjaGVkX2FjY3Qodm9pZCAqZHVtbXkpOwogCiBzdGF0aWMgaW5s
aW5lIGludAotX192Y3B1X29uX3J1bnEoc3RydWN0IGNzY2hlZF92Y3B1ICpzdmMpCitfX3ZjcHVf
b25fcnVucShzdHJ1Y3QgY3NjaGVkX3VuaXQgKnN2YykKIHsKICAgICByZXR1cm4gIWxpc3RfZW1w
dHkoJnN2Yy0+cnVucV9lbGVtKTsKIH0KIAotc3RhdGljIGlubGluZSBzdHJ1Y3QgY3NjaGVkX3Zj
cHUgKgorc3RhdGljIGlubGluZSBzdHJ1Y3QgY3NjaGVkX3VuaXQgKgogX19ydW5xX2VsZW0oc3Ry
dWN0IGxpc3RfaGVhZCAqZWxlbSkKIHsKLSAgICByZXR1cm4gbGlzdF9lbnRyeShlbGVtLCBzdHJ1
Y3QgY3NjaGVkX3ZjcHUsIHJ1bnFfZWxlbSk7CisgICAgcmV0dXJuIGxpc3RfZW50cnkoZWxlbSwg
c3RydWN0IGNzY2hlZF91bml0LCBydW5xX2VsZW0pOwogfQogCiAvKiBJcyB0aGUgZmlyc3QgZWxl
bWVudCBvZiBjcHUncyBydW5xIChpZiBhbnkpIGNwdSdzIGlkbGUgdmNwdT8gKi8KQEAgLTI3MSw3
ICsyNzEsNyBAQCBkZWNfbnJfcnVubmFibGUodW5zaWduZWQgaW50IGNwdSkKIH0KIAogc3RhdGlj
IGlubGluZSB2b2lkCi1fX3J1bnFfaW5zZXJ0KHN0cnVjdCBjc2NoZWRfdmNwdSAqc3ZjKQorX19y
dW5xX2luc2VydChzdHJ1Y3QgY3NjaGVkX3VuaXQgKnN2YykKIHsKICAgICB1bnNpZ25lZCBpbnQg
Y3B1ID0gc3ZjLT52Y3B1LT5wcm9jZXNzb3I7CiAgICAgY29uc3Qgc3RydWN0IGxpc3RfaGVhZCAq
IGNvbnN0IHJ1bnEgPSBSVU5RKGNwdSk7CkBAIC0yODEsNyArMjgxLDcgQEAgX19ydW5xX2luc2Vy
dChzdHJ1Y3QgY3NjaGVkX3ZjcHUgKnN2YykKIAogICAgIGxpc3RfZm9yX2VhY2goIGl0ZXIsIHJ1
bnEgKQogICAgIHsKLSAgICAgICAgY29uc3Qgc3RydWN0IGNzY2hlZF92Y3B1ICogY29uc3QgaXRl
cl9zdmMgPSBfX3J1bnFfZWxlbShpdGVyKTsKKyAgICAgICAgY29uc3Qgc3RydWN0IGNzY2hlZF91
bml0ICogY29uc3QgaXRlcl9zdmMgPSBfX3J1bnFfZWxlbShpdGVyKTsKICAgICAgICAgaWYgKCBz
dmMtPnByaSA+IGl0ZXJfc3ZjLT5wcmkgKQogICAgICAgICAgICAgYnJlYWs7CiAgICAgfQpAQCAt
MzAyLDM0ICszMDIsMzQgQEAgX19ydW5xX2luc2VydChzdHJ1Y3QgY3NjaGVkX3ZjcHUgKnN2YykK
IH0KIAogc3RhdGljIGlubGluZSB2b2lkCi1ydW5xX2luc2VydChzdHJ1Y3QgY3NjaGVkX3ZjcHUg
KnN2YykKK3J1bnFfaW5zZXJ0KHN0cnVjdCBjc2NoZWRfdW5pdCAqc3ZjKQogewogICAgIF9fcnVu
cV9pbnNlcnQoc3ZjKTsKICAgICBpbmNfbnJfcnVubmFibGUoc3ZjLT52Y3B1LT5wcm9jZXNzb3Ip
OwogfQogCiBzdGF0aWMgaW5saW5lIHZvaWQKLV9fcnVucV9yZW1vdmUoc3RydWN0IGNzY2hlZF92
Y3B1ICpzdmMpCitfX3J1bnFfcmVtb3ZlKHN0cnVjdCBjc2NoZWRfdW5pdCAqc3ZjKQogewogICAg
IEJVR19PTiggIV9fdmNwdV9vbl9ydW5xKHN2YykgKTsKICAgICBsaXN0X2RlbF9pbml0KCZzdmMt
PnJ1bnFfZWxlbSk7CiB9CiAKIHN0YXRpYyBpbmxpbmUgdm9pZAotcnVucV9yZW1vdmUoc3RydWN0
IGNzY2hlZF92Y3B1ICpzdmMpCitydW5xX3JlbW92ZShzdHJ1Y3QgY3NjaGVkX3VuaXQgKnN2YykK
IHsKICAgICBkZWNfbnJfcnVubmFibGUoc3ZjLT52Y3B1LT5wcm9jZXNzb3IpOwogICAgIF9fcnVu
cV9yZW1vdmUoc3ZjKTsKIH0KIAotc3RhdGljIHZvaWQgYnVybl9jcmVkaXRzKHN0cnVjdCBjc2No
ZWRfdmNwdSAqc3ZjLCBzX3RpbWVfdCBub3cpCitzdGF0aWMgdm9pZCBidXJuX2NyZWRpdHMoc3Ry
dWN0IGNzY2hlZF91bml0ICpzdmMsIHNfdGltZV90IG5vdykKIHsKICAgICBzX3RpbWVfdCBkZWx0
YTsKICAgICB1aW50NjRfdCB2YWw7CiAgICAgdW5zaWduZWQgaW50IGNyZWRpdHM7CiAKICAgICAv
KiBBc3NlcnQgc3ZjIGlzIGN1cnJlbnQgKi8KLSAgICBBU1NFUlQoIHN2YyA9PSBDU0NIRURfVkNQ
VShjdXJyX29uX2NwdShzdmMtPnZjcHUtPnByb2Nlc3NvcikpICk7CisgICAgQVNTRVJUKCBzdmMg
PT0gQ1NDSEVEX1VOSVQoY3Vycl9vbl9jcHUoc3ZjLT52Y3B1LT5wcm9jZXNzb3IpKSApOwogCiAg
ICAgaWYgKCAoZGVsdGEgPSBub3cgLSBzdmMtPnN0YXJ0X3RpbWUpIDw9IDAgKQogICAgICAgICBy
ZXR1cm47CkBAIC0zNDcsMTAgKzM0NywxMCBAQCBib29sZWFuX3BhcmFtKCJ0aWNrbGVfb25lX2lk
bGVfY3B1Iiwgb3B0X3RpY2tsZV9vbmVfaWRsZSk7CiAKIERFRklORV9QRVJfQ1BVKHVuc2lnbmVk
IGludCwgbGFzdF90aWNrbGVfY3B1KTsKIAotc3RhdGljIGlubGluZSB2b2lkIF9fcnVucV90aWNr
bGUoc3RydWN0IGNzY2hlZF92Y3B1ICpuZXcpCitzdGF0aWMgaW5saW5lIHZvaWQgX19ydW5xX3Rp
Y2tsZShzdHJ1Y3QgY3NjaGVkX3VuaXQgKm5ldykKIHsKICAgICB1bnNpZ25lZCBpbnQgY3B1ID0g
bmV3LT52Y3B1LT5wcm9jZXNzb3I7Ci0gICAgc3RydWN0IGNzY2hlZF92Y3B1ICogY29uc3QgY3Vy
ID0gQ1NDSEVEX1ZDUFUoY3Vycl9vbl9jcHUoY3B1KSk7CisgICAgc3RydWN0IGNzY2hlZF91bml0
ICogY29uc3QgY3VyID0gQ1NDSEVEX1VOSVQoY3Vycl9vbl9jcHUoY3B1KSk7CiAgICAgc3RydWN0
IGNzY2hlZF9wcml2YXRlICpwcnYgPSBDU0NIRURfUFJJVihwZXJfY3B1KHNjaGVkdWxlciwgY3B1
KSk7CiAgICAgY3B1bWFza190IG1hc2ssIGlkbGVfbWFzaywgKm9ubGluZTsKICAgICBpbnQgYmFs
YW5jZV9zdGVwLCBpZGxlcnNfZW1wdHk7CkBAIC02MDUsNyArNjA1LDcgQEAgaW5pdF9wZGF0YShz
dHJ1Y3QgY3NjaGVkX3ByaXZhdGUgKnBydiwgc3RydWN0IGNzY2hlZF9wY3B1ICpzcGMsIGludCBj
cHUpCiAgICAgc3BjLT5pZGxlX2JpYXMgPSBucl9jcHVfaWRzIC0gMTsKIAogICAgIC8qIFN0YXJ0
IG9mZiBpZGxpbmcuLi4gKi8KLSAgICBCVUdfT04oIWlzX2lkbGVfdmNwdShjdXJyX29uX2NwdShj
cHUpKSk7CisgICAgQlVHX09OKCFpc19pZGxlX3ZjcHUoY3Vycl9vbl9jcHUoY3B1KS0+dmNwdSkp
OwogICAgIGNwdW1hc2tfc2V0X2NwdShjcHUsIHBydi0+aWRsZXJzKTsKICAgICBzcGMtPm5yX3J1
bm5hYmxlID0gMDsKIH0KQEAgLTYzNyw3ICs2MzcsNyBAQCBjc2NoZWRfc3dpdGNoX3NjaGVkKHN0
cnVjdCBzY2hlZHVsZXIgKm5ld19vcHMsIHVuc2lnbmVkIGludCBjcHUsCiB7CiAgICAgc3RydWN0
IHNjaGVkdWxlX2RhdGEgKnNkID0gJnBlcl9jcHUoc2NoZWR1bGVfZGF0YSwgY3B1KTsKICAgICBz
dHJ1Y3QgY3NjaGVkX3ByaXZhdGUgKnBydiA9IENTQ0hFRF9QUklWKG5ld19vcHMpOwotICAgIHN0
cnVjdCBjc2NoZWRfdmNwdSAqc3ZjID0gdmRhdGE7CisgICAgc3RydWN0IGNzY2hlZF91bml0ICpz
dmMgPSB2ZGF0YTsKIAogICAgIEFTU0VSVChzdmMgJiYgaXNfaWRsZV92Y3B1KHN2Yy0+dmNwdSkp
OwogCkBAIC02NjAsNyArNjYwLDcgQEAgY3NjaGVkX3N3aXRjaF9zY2hlZChzdHJ1Y3Qgc2NoZWR1
bGVyICpuZXdfb3BzLCB1bnNpZ25lZCBpbnQgY3B1LAogc3RhdGljIGlubGluZSB2b2lkCiBfX2Nz
Y2hlZF92Y3B1X2NoZWNrKHN0cnVjdCB2Y3B1ICp2YykKIHsKLSAgICBzdHJ1Y3QgY3NjaGVkX3Zj
cHUgKiBjb25zdCBzdmMgPSBDU0NIRURfVkNQVSh2Yyk7CisgICAgc3RydWN0IGNzY2hlZF91bml0
ICogY29uc3Qgc3ZjID0gQ1NDSEVEX1VOSVQodmMtPnNjaGVkX3VuaXQpOwogICAgIHN0cnVjdCBj
c2NoZWRfZG9tICogY29uc3Qgc2RvbSA9IHN2Yy0+c2RvbTsKIAogICAgIEJVR19PTiggc3ZjLT52
Y3B1ICE9IHZjICk7CkBAIC04NjIsNyArODYyLDcgQEAgc3RhdGljIHN0cnVjdCBzY2hlZF9yZXNv
dXJjZSAqCiBjc2NoZWRfcmVzX3BpY2soY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1
Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIHsKICAgICBzdHJ1Y3QgdmNwdSAqdmMgPSB1bml0LT52Y3B1
OwotICAgIHN0cnVjdCBjc2NoZWRfdmNwdSAqc3ZjID0gQ1NDSEVEX1ZDUFUodmMpOworICAgIHN0
cnVjdCBjc2NoZWRfdW5pdCAqc3ZjID0gQ1NDSEVEX1VOSVQodW5pdCk7CiAKICAgICAvKgogICAg
ICAqIFdlIGhhdmUgYmVlbiBjYWxsZWQgYnkgdmNwdV9taWdyYXRlKCkgKGluIHNjaGVkdWxlLmMp
LCBhcyBwYXJ0CkBAIC04NzYsNyArODc2LDcgQEAgY3NjaGVkX3Jlc19waWNrKGNvbnN0IHN0cnVj
dCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiB9CiAKIHN0YXRpYyBp
bmxpbmUgdm9pZAotX19jc2NoZWRfdmNwdV9hY2N0X3N0YXJ0KHN0cnVjdCBjc2NoZWRfcHJpdmF0
ZSAqcHJ2LCBzdHJ1Y3QgY3NjaGVkX3ZjcHUgKnN2YykKK19fY3NjaGVkX3ZjcHVfYWNjdF9zdGFy
dChzdHJ1Y3QgY3NjaGVkX3ByaXZhdGUgKnBydiwgc3RydWN0IGNzY2hlZF91bml0ICpzdmMpCiB7
CiAgICAgc3RydWN0IGNzY2hlZF9kb20gKiBjb25zdCBzZG9tID0gc3ZjLT5zZG9tOwogICAgIHVu
c2lnbmVkIGxvbmcgZmxhZ3M7CkBAIC05MDYsNyArOTA2LDcgQEAgX19jc2NoZWRfdmNwdV9hY2N0
X3N0YXJ0KHN0cnVjdCBjc2NoZWRfcHJpdmF0ZSAqcHJ2LCBzdHJ1Y3QgY3NjaGVkX3ZjcHUgKnN2
YykKIAogc3RhdGljIGlubGluZSB2b2lkCiBfX2NzY2hlZF92Y3B1X2FjY3Rfc3RvcF9sb2NrZWQo
c3RydWN0IGNzY2hlZF9wcml2YXRlICpwcnYsCi0gICAgc3RydWN0IGNzY2hlZF92Y3B1ICpzdmMp
CisgICAgc3RydWN0IGNzY2hlZF91bml0ICpzdmMpCiB7CiAgICAgc3RydWN0IGNzY2hlZF9kb20g
KiBjb25zdCBzZG9tID0gc3ZjLT5zZG9tOwogCkBAIC05MzEsNyArOTMxLDcgQEAgX19jc2NoZWRf
dmNwdV9hY2N0X3N0b3BfbG9ja2VkKHN0cnVjdCBjc2NoZWRfcHJpdmF0ZSAqcHJ2LAogc3RhdGlj
IHZvaWQKIGNzY2hlZF92Y3B1X2FjY3Qoc3RydWN0IGNzY2hlZF9wcml2YXRlICpwcnYsIHVuc2ln
bmVkIGludCBjcHUpCiB7Ci0gICAgc3RydWN0IGNzY2hlZF92Y3B1ICogY29uc3Qgc3ZjID0gQ1ND
SEVEX1ZDUFUoY3VycmVudCk7CisgICAgc3RydWN0IGNzY2hlZF91bml0ICogY29uc3Qgc3ZjID0g
Q1NDSEVEX1VOSVQoY3VycmVudC0+c2NoZWRfdW5pdCk7CiAgICAgY29uc3Qgc3RydWN0IHNjaGVk
dWxlciAqb3BzID0gcGVyX2NwdShzY2hlZHVsZXIsIGNwdSk7CiAKICAgICBBU1NFUlQoIGN1cnJl
bnQtPnByb2Nlc3NvciA9PSBjcHUgKTsKQEAgLTEwMDAsMTAgKzEwMDAsMTAgQEAgY3NjaGVkX2Fs
bG9jX3ZkYXRhKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX3VuaXQg
KnVuaXQsCiAgICAgICAgICAgICAgICAgICAgdm9pZCAqZGQpCiB7CiAgICAgc3RydWN0IHZjcHUg
KnZjID0gdW5pdC0+dmNwdTsKLSAgICBzdHJ1Y3QgY3NjaGVkX3ZjcHUgKnN2YzsKKyAgICBzdHJ1
Y3QgY3NjaGVkX3VuaXQgKnN2YzsKIAogICAgIC8qIEFsbG9jYXRlIHBlci1WQ1BVIGluZm8gKi8K
LSAgICBzdmMgPSB4emFsbG9jKHN0cnVjdCBjc2NoZWRfdmNwdSk7CisgICAgc3ZjID0geHphbGxv
YyhzdHJ1Y3QgY3NjaGVkX3VuaXQpOwogICAgIGlmICggc3ZjID09IE5VTEwgKQogICAgICAgICBy
ZXR1cm4gTlVMTDsKIApAQCAtMTAyMiw3ICsxMDIyLDcgQEAgc3RhdGljIHZvaWQKIGNzY2hlZF91
bml0X2luc2VydChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0
ICp1bml0KQogewogICAgIHN0cnVjdCB2Y3B1ICp2YyA9IHVuaXQtPnZjcHU7Ci0gICAgc3RydWN0
IGNzY2hlZF92Y3B1ICpzdmMgPSB1bml0LT5wcml2OworICAgIHN0cnVjdCBjc2NoZWRfdW5pdCAq
c3ZjID0gdW5pdC0+cHJpdjsKICAgICBzcGlubG9ja190ICpsb2NrOwogCiAgICAgQlVHX09OKCBp
c19pZGxlX3ZjcHUodmMpICk7CkBAIC0xMDQ4LDcgKzEwNDgsNyBAQCBjc2NoZWRfdW5pdF9pbnNl
cnQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkK
IHN0YXRpYyB2b2lkCiBjc2NoZWRfZnJlZV92ZGF0YShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpv
cHMsIHZvaWQgKnByaXYpCiB7Ci0gICAgc3RydWN0IGNzY2hlZF92Y3B1ICpzdmMgPSBwcml2Owor
ICAgIHN0cnVjdCBjc2NoZWRfdW5pdCAqc3ZjID0gcHJpdjsKIAogICAgIEJVR19PTiggIWxpc3Rf
ZW1wdHkoJnN2Yy0+cnVucV9lbGVtKSApOwogCkBAIC0xMDU5LDggKzEwNTksNyBAQCBzdGF0aWMg
dm9pZAogY3NjaGVkX3VuaXRfcmVtb3ZlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3Ry
dWN0IHNjaGVkX3VuaXQgKnVuaXQpCiB7CiAgICAgc3RydWN0IGNzY2hlZF9wcml2YXRlICpwcnYg
PSBDU0NIRURfUFJJVihvcHMpOwotICAgIHN0cnVjdCB2Y3B1ICp2YyA9IHVuaXQtPnZjcHU7Ci0g
ICAgc3RydWN0IGNzY2hlZF92Y3B1ICogY29uc3Qgc3ZjID0gQ1NDSEVEX1ZDUFUodmMpOworICAg
IHN0cnVjdCBjc2NoZWRfdW5pdCAqIGNvbnN0IHN2YyA9IENTQ0hFRF9VTklUKHVuaXQpOwogICAg
IHN0cnVjdCBjc2NoZWRfZG9tICogY29uc3Qgc2RvbSA9IHN2Yy0+c2RvbTsKIAogICAgIFNDSEVE
X1NUQVRfQ1JBTksodmNwdV9yZW1vdmUpOwpAQCAtMTA4NywxNCArMTA4NiwxNCBAQCBzdGF0aWMg
dm9pZAogY3NjaGVkX3VuaXRfc2xlZXAoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1
Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIHsKICAgICBzdHJ1Y3QgdmNwdSAqdmMgPSB1bml0LT52Y3B1
OwotICAgIHN0cnVjdCBjc2NoZWRfdmNwdSAqIGNvbnN0IHN2YyA9IENTQ0hFRF9WQ1BVKHZjKTsK
KyAgICBzdHJ1Y3QgY3NjaGVkX3VuaXQgKiBjb25zdCBzdmMgPSBDU0NIRURfVU5JVCh1bml0KTsK
ICAgICB1bnNpZ25lZCBpbnQgY3B1ID0gdmMtPnByb2Nlc3NvcjsKIAogICAgIFNDSEVEX1NUQVRf
Q1JBTksodmNwdV9zbGVlcCk7CiAKICAgICBCVUdfT04oIGlzX2lkbGVfdmNwdSh2YykgKTsKIAot
ICAgIGlmICggY3Vycl9vbl9jcHUoY3B1KSA9PSB2YyApCisgICAgaWYgKCBjdXJyX29uX2NwdShj
cHUpID09IHVuaXQgKQogICAgIHsKICAgICAgICAgLyoKICAgICAgICAgICogV2UgYXJlIGFib3V0
IHRvIHRpY2tsZSBjcHUsIHNvIHdlIHNob3VsZCBjbGVhciBpdHMgYml0IGluIGlkbGVycy4KQEAg
LTExMTIsMTIgKzExMTEsMTIgQEAgc3RhdGljIHZvaWQKIGNzY2hlZF91bml0X3dha2UoY29uc3Qg
c3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIHsKICAgICBz
dHJ1Y3QgdmNwdSAqdmMgPSB1bml0LT52Y3B1OwotICAgIHN0cnVjdCBjc2NoZWRfdmNwdSAqIGNv
bnN0IHN2YyA9IENTQ0hFRF9WQ1BVKHZjKTsKKyAgICBzdHJ1Y3QgY3NjaGVkX3VuaXQgKiBjb25z
dCBzdmMgPSBDU0NIRURfVU5JVCh1bml0KTsKICAgICBib29sX3QgbWlncmF0aW5nOwogCiAgICAg
QlVHX09OKCBpc19pZGxlX3ZjcHUodmMpICk7CiAKLSAgICBpZiAoIHVubGlrZWx5KGN1cnJfb25f
Y3B1KHZjLT5wcm9jZXNzb3IpID09IHZjKSApCisgICAgaWYgKCB1bmxpa2VseShjdXJyX29uX2Nw
dSh2Yy0+cHJvY2Vzc29yKSA9PSB1bml0KSApCiAgICAgewogICAgICAgICBTQ0hFRF9TVEFUX0NS
QU5LKHZjcHVfd2FrZV9ydW5uaW5nKTsKICAgICAgICAgcmV0dXJuOwpAQCAtMTE3Myw4ICsxMTcy
LDcgQEAgY3NjaGVkX3VuaXRfd2FrZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVj
dCBzY2hlZF91bml0ICp1bml0KQogc3RhdGljIHZvaWQKIGNzY2hlZF91bml0X3lpZWxkKGNvbnN0
IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiB7Ci0gICAg
c3RydWN0IHZjcHUgKnZjID0gdW5pdC0+dmNwdTsKLSAgICBzdHJ1Y3QgY3NjaGVkX3ZjcHUgKiBj
b25zdCBzdmMgPSBDU0NIRURfVkNQVSh2Yyk7CisgICAgc3RydWN0IGNzY2hlZF91bml0ICogY29u
c3Qgc3ZjID0gQ1NDSEVEX1VOSVQodW5pdCk7CiAKICAgICAvKiBMZXQgdGhlIHNjaGVkdWxlciBr
bm93IHRoYXQgdGhpcyB2Y3B1IGlzIHRyeWluZyB0byB5aWVsZCAqLwogICAgIHNldF9iaXQoQ1ND
SEVEX0ZMQUdfVkNQVV9ZSUVMRCwgJnN2Yy0+ZmxhZ3MpOwpAQCAtMTIyOSw4ICsxMjI3LDcgQEAg
c3RhdGljIHZvaWQKIGNzY2hlZF9hZmZfY250bChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMs
IHN0cnVjdCBzY2hlZF91bml0ICp1bml0LAogICAgICAgICAgICAgICAgIGNvbnN0IGNwdW1hc2tf
dCAqaGFyZCwgY29uc3QgY3B1bWFza190ICpzb2Z0KQogewotICAgIHN0cnVjdCB2Y3B1ICp2ID0g
dW5pdC0+dmNwdTsKLSAgICBzdHJ1Y3QgY3NjaGVkX3ZjcHUgKnN2YyA9IENTQ0hFRF9WQ1BVKHYp
OworICAgIHN0cnVjdCBjc2NoZWRfdW5pdCAqc3ZjID0gQ1NDSEVEX1VOSVQodW5pdCk7CiAKICAg
ICBpZiAoICFoYXJkICkKICAgICAgICAgcmV0dXJuOwpAQCAtMTMzMyw3ICsxMzMwLDcgQEAgY3Nj
aGVkX3J1bnFfc29ydChzdHJ1Y3QgY3NjaGVkX3ByaXZhdGUgKnBydiwgdW5zaWduZWQgaW50IGNw
dSkKIHsKICAgICBzdHJ1Y3QgY3NjaGVkX3BjcHUgKiBjb25zdCBzcGMgPSBDU0NIRURfUENQVShj
cHUpOwogICAgIHN0cnVjdCBsaXN0X2hlYWQgKnJ1bnEsICplbGVtLCAqbmV4dCwgKmxhc3RfdW5k
ZXI7Ci0gICAgc3RydWN0IGNzY2hlZF92Y3B1ICpzdmNfZWxlbTsKKyAgICBzdHJ1Y3QgY3NjaGVk
X3VuaXQgKnN2Y19lbGVtOwogICAgIHNwaW5sb2NrX3QgKmxvY2s7CiAgICAgdW5zaWduZWQgbG9u
ZyBmbGFnczsKICAgICBpbnQgc29ydF9lcG9jaDsKQEAgLTEzNzksNyArMTM3Niw3IEBAIGNzY2hl
ZF9hY2N0KHZvaWQqIGR1bW15KQogICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAgICAgc3RydWN0
IGxpc3RfaGVhZCAqaXRlcl92Y3B1LCAqbmV4dF92Y3B1OwogICAgIHN0cnVjdCBsaXN0X2hlYWQg
Kml0ZXJfc2RvbSwgKm5leHRfc2RvbTsKLSAgICBzdHJ1Y3QgY3NjaGVkX3ZjcHUgKnN2YzsKKyAg
ICBzdHJ1Y3QgY3NjaGVkX3VuaXQgKnN2YzsKICAgICBzdHJ1Y3QgY3NjaGVkX2RvbSAqc2RvbTsK
ICAgICB1aW50MzJfdCBjcmVkaXRfdG90YWw7CiAgICAgdWludDMyX3Qgd2VpZ2h0X3RvdGFsOwpA
QCAtMTUwMiw3ICsxNDk5LDcgQEAgY3NjaGVkX2FjY3Qodm9pZCogZHVtbXkpCiAKICAgICAgICAg
bGlzdF9mb3JfZWFjaF9zYWZlKCBpdGVyX3ZjcHUsIG5leHRfdmNwdSwgJnNkb20tPmFjdGl2ZV92
Y3B1ICkKICAgICAgICAgewotICAgICAgICAgICAgc3ZjID0gbGlzdF9lbnRyeShpdGVyX3ZjcHUs
IHN0cnVjdCBjc2NoZWRfdmNwdSwgYWN0aXZlX3ZjcHVfZWxlbSk7CisgICAgICAgICAgICBzdmMg
PSBsaXN0X2VudHJ5KGl0ZXJfdmNwdSwgc3RydWN0IGNzY2hlZF91bml0LCBhY3RpdmVfdmNwdV9l
bGVtKTsKICAgICAgICAgICAgIEJVR19PTiggc2RvbSAhPSBzdmMtPnNkb20gKTsKIAogICAgICAg
ICAgICAgLyogSW5jcmVtZW50IGNyZWRpdCAqLwpAQCAtMTYwNiwxMiArMTYwMywxMiBAQCBjc2No
ZWRfdGljayh2b2lkICpfY3B1KQogICAgIHNldF90aW1lcigmc3BjLT50aWNrZXIsIE5PVygpICsg
TUlDUk9TRUNTKHBydi0+dGlja19wZXJpb2RfdXMpICk7CiB9CiAKLXN0YXRpYyBzdHJ1Y3QgY3Nj
aGVkX3ZjcHUgKgorc3RhdGljIHN0cnVjdCBjc2NoZWRfdW5pdCAqCiBjc2NoZWRfcnVucV9zdGVh
bChpbnQgcGVlcl9jcHUsIGludCBjcHUsIGludCBwcmksIGludCBiYWxhbmNlX3N0ZXApCiB7CiAg
ICAgY29uc3Qgc3RydWN0IGNzY2hlZF9wcml2YXRlICogY29uc3QgcHJ2ID0gQ1NDSEVEX1BSSVYo
cGVyX2NwdShzY2hlZHVsZXIsIGNwdSkpOwogICAgIGNvbnN0IHN0cnVjdCBjc2NoZWRfcGNwdSAq
IGNvbnN0IHBlZXJfcGNwdSA9IENTQ0hFRF9QQ1BVKHBlZXJfY3B1KTsKLSAgICBzdHJ1Y3QgY3Nj
aGVkX3ZjcHUgKnNwZWVyOworICAgIHN0cnVjdCBjc2NoZWRfdW5pdCAqc3BlZXI7CiAgICAgc3Ry
dWN0IGxpc3RfaGVhZCAqaXRlcjsKICAgICBzdHJ1Y3QgdmNwdSAqdmM7CiAKQEAgLTE2MjEsNyAr
MTYxOCw3IEBAIGNzY2hlZF9ydW5xX3N0ZWFsKGludCBwZWVyX2NwdSwgaW50IGNwdSwgaW50IHBy
aSwgaW50IGJhbGFuY2Vfc3RlcCkKICAgICAgKiBEb24ndCBzdGVhbCBmcm9tIGFuIGlkbGUgQ1BV
J3MgcnVucSBiZWNhdXNlIGl0J3MgYWJvdXQgdG8KICAgICAgKiBwaWNrIHVwIHdvcmsgZnJvbSBp
dCBpdHNlbGYuCiAgICAgICovCi0gICAgaWYgKCB1bmxpa2VseShpc19pZGxlX3ZjcHUoY3Vycl9v
bl9jcHUocGVlcl9jcHUpKSkgKQorICAgIGlmICggdW5saWtlbHkoaXNfaWRsZV92Y3B1KGN1cnJf
b25fY3B1KHBlZXJfY3B1KS0+dmNwdSkpICkKICAgICAgICAgZ290byBvdXQ7CiAKICAgICBsaXN0
X2Zvcl9lYWNoKCBpdGVyLCAmcGVlcl9wY3B1LT5ydW5xICkKQEAgLTE2ODMsMTIgKzE2ODAsMTIg
QEAgY3NjaGVkX3J1bnFfc3RlYWwoaW50IHBlZXJfY3B1LCBpbnQgY3B1LCBpbnQgcHJpLCBpbnQg
YmFsYW5jZV9zdGVwKQogICAgIHJldHVybiBOVUxMOwogfQogCi1zdGF0aWMgc3RydWN0IGNzY2hl
ZF92Y3B1ICoKK3N0YXRpYyBzdHJ1Y3QgY3NjaGVkX3VuaXQgKgogY3NjaGVkX2xvYWRfYmFsYW5j
ZShzdHJ1Y3QgY3NjaGVkX3ByaXZhdGUgKnBydiwgaW50IGNwdSwKLSAgICBzdHJ1Y3QgY3NjaGVk
X3ZjcHUgKnNuZXh0LCBib29sX3QgKnN0b2xlbikKKyAgICBzdHJ1Y3QgY3NjaGVkX3VuaXQgKnNu
ZXh0LCBib29sX3QgKnN0b2xlbikKIHsKICAgICBzdHJ1Y3QgY3B1cG9vbCAqYyA9IHBlcl9jcHUo
Y3B1cG9vbCwgY3B1KTsKLSAgICBzdHJ1Y3QgY3NjaGVkX3ZjcHUgKnNwZWVyOworICAgIHN0cnVj
dCBjc2NoZWRfdW5pdCAqc3BlZXI7CiAgICAgY3B1bWFza190IHdvcmtlcnM7CiAgICAgY3B1bWFz
a190ICpvbmxpbmU7CiAgICAgaW50IHBlZXJfY3B1LCBmaXJzdF9jcHUsIHBlZXJfbm9kZSwgYnN0
ZXA7CkBAIC0xODM3LDkgKzE4MzQsOSBAQCBjc2NoZWRfc2NoZWR1bGUoCiB7CiAgICAgY29uc3Qg
aW50IGNwdSA9IHNtcF9wcm9jZXNzb3JfaWQoKTsKICAgICBzdHJ1Y3QgbGlzdF9oZWFkICogY29u
c3QgcnVucSA9IFJVTlEoY3B1KTsKLSAgICBzdHJ1Y3QgY3NjaGVkX3ZjcHUgKiBjb25zdCBzY3Vy
ciA9IENTQ0hFRF9WQ1BVKGN1cnJlbnQpOworICAgIHN0cnVjdCBjc2NoZWRfdW5pdCAqIGNvbnN0
IHNjdXJyID0gQ1NDSEVEX1VOSVQoY3VycmVudC0+c2NoZWRfdW5pdCk7CiAgICAgc3RydWN0IGNz
Y2hlZF9wcml2YXRlICpwcnYgPSBDU0NIRURfUFJJVihvcHMpOwotICAgIHN0cnVjdCBjc2NoZWRf
dmNwdSAqc25leHQ7CisgICAgc3RydWN0IGNzY2hlZF91bml0ICpzbmV4dDsKICAgICBzdHJ1Y3Qg
dGFza19zbGljZSByZXQ7CiAgICAgc190aW1lX3QgcnVudGltZSwgdHNsaWNlOwogCkBAIC0xOTU1
LDcgKzE5NTIsNyBAQCBjc2NoZWRfc2NoZWR1bGUoCiAgICAgaWYgKCB0YXNrbGV0X3dvcmtfc2No
ZWR1bGVkICkKICAgICB7CiAgICAgICAgIFRSQUNFXzBEKFRSQ19DU0NIRURfU0NIRURfVEFTS0xF
VCk7Ci0gICAgICAgIHNuZXh0ID0gQ1NDSEVEX1ZDUFUoaWRsZV92Y3B1W2NwdV0pOworICAgICAg
ICBzbmV4dCA9IENTQ0hFRF9VTklUKGlkbGVfdmNwdVtjcHVdLT5zY2hlZF91bml0KTsKICAgICAg
ICAgc25leHQtPnByaSA9IENTQ0hFRF9QUklfVFNfQk9PU1Q7CiAgICAgfQogCkBAIC0yMDA3LDcg
KzIwMDQsNyBAQCBvdXQ6CiB9CiAKIHN0YXRpYyB2b2lkCi1jc2NoZWRfZHVtcF92Y3B1KHN0cnVj
dCBjc2NoZWRfdmNwdSAqc3ZjKQorY3NjaGVkX2R1bXBfdmNwdShzdHJ1Y3QgY3NjaGVkX3VuaXQg
KnN2YykKIHsKICAgICBzdHJ1Y3QgY3NjaGVkX2RvbSAqIGNvbnN0IHNkb20gPSBzdmMtPnNkb207
CiAKQEAgLTIwNDMsNyArMjA0MCw3IEBAIGNzY2hlZF9kdW1wX3BjcHUoY29uc3Qgc3RydWN0IHNj
aGVkdWxlciAqb3BzLCBpbnQgY3B1KQogICAgIHN0cnVjdCBsaXN0X2hlYWQgKnJ1bnEsICppdGVy
OwogICAgIHN0cnVjdCBjc2NoZWRfcHJpdmF0ZSAqcHJ2ID0gQ1NDSEVEX1BSSVYob3BzKTsKICAg
ICBzdHJ1Y3QgY3NjaGVkX3BjcHUgKnNwYzsKLSAgICBzdHJ1Y3QgY3NjaGVkX3ZjcHUgKnN2YzsK
KyAgICBzdHJ1Y3QgY3NjaGVkX3VuaXQgKnN2YzsKICAgICBzcGlubG9ja190ICpsb2NrOwogICAg
IHVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAgICAgaW50IGxvb3A7CkBAIC0yMDY3LDcgKzIwNjQsNyBA
QCBjc2NoZWRfZHVtcF9wY3B1KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgaW50IGNwdSkK
ICAgICAgICAgICAgbnJfY3B1X2lkcywgY3B1bWFza19iaXRzKHBlcl9jcHUoY3B1X2NvcmVfbWFz
aywgY3B1KSkpOwogCiAgICAgLyogY3VycmVudCBWQ1BVIChub3RoaW5nIHRvIHNheSBpZiB0aGF0
J3MgdGhlIGlkbGUgdmNwdSkuICovCi0gICAgc3ZjID0gQ1NDSEVEX1ZDUFUoY3Vycl9vbl9jcHUo
Y3B1KSk7CisgICAgc3ZjID0gQ1NDSEVEX1VOSVQoY3Vycl9vbl9jcHUoY3B1KSk7CiAgICAgaWYg
KCBzdmMgJiYgIWlzX2lkbGVfdmNwdShzdmMtPnZjcHUpICkKICAgICB7CiAgICAgICAgIHByaW50
aygiXHRydW46ICIpOwpAQCAtMjEzNiwxMCArMjEzMywxMCBAQCBjc2NoZWRfZHVtcChjb25zdCBz
dHJ1Y3Qgc2NoZWR1bGVyICpvcHMpCiAKICAgICAgICAgbGlzdF9mb3JfZWFjaCggaXRlcl9zdmMs
ICZzZG9tLT5hY3RpdmVfdmNwdSApCiAgICAgICAgIHsKLSAgICAgICAgICAgIHN0cnVjdCBjc2No
ZWRfdmNwdSAqc3ZjOworICAgICAgICAgICAgc3RydWN0IGNzY2hlZF91bml0ICpzdmM7CiAgICAg
ICAgICAgICBzcGlubG9ja190ICpsb2NrOwogCi0gICAgICAgICAgICBzdmMgPSBsaXN0X2VudHJ5
KGl0ZXJfc3ZjLCBzdHJ1Y3QgY3NjaGVkX3ZjcHUsIGFjdGl2ZV92Y3B1X2VsZW0pOworICAgICAg
ICAgICAgc3ZjID0gbGlzdF9lbnRyeShpdGVyX3N2Yywgc3RydWN0IGNzY2hlZF91bml0LCBhY3Rp
dmVfdmNwdV9lbGVtKTsKICAgICAgICAgICAgIGxvY2sgPSB2Y3B1X3NjaGVkdWxlX2xvY2soc3Zj
LT52Y3B1KTsKIAogICAgICAgICAgICAgcHJpbnRrKCJcdCUzZDogIiwgKytsb29wKTsKZGlmZiAt
LWdpdCBhL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0Mi5jIGIveGVuL2NvbW1vbi9zY2hlZF9jcmVk
aXQyLmMKaW5kZXggYjcxODAyYmJhMi4uMzYyMDE4MTVlMyAxMDA2NDQKLS0tIGEveGVuL2NvbW1v
bi9zY2hlZF9jcmVkaXQyLmMKKysrIGIveGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQyLmMKQEAgLTE3
Niw3ICsxNzYsNyBAQAogICogICAgIGxvYWQgYmFsYW5jaW5nOwogICogICsgc2VyaWFsaXplcyBy
dW5xdWV1ZSBvcGVyYXRpb25zIChyZW1vdmluZyBhbmQgaW5zZXJ0aW5nIHZjcHVzKTsKICAqICAr
IHByb3RlY3RzIHJ1bnF1ZXVlLXdpZGUgZGF0YSBpbiBjc2NoZWQyX3J1bnF1ZXVlX2RhdGE7Ci0g
KiAgKyBwcm90ZWN0cyB2Y3B1IHBhcmFtZXRlcnMgaW4gY3NjaGVkMl92Y3B1IGZvciB0aGUgdmNw
dSBpbiB0aGUKKyAqICArIHByb3RlY3RzIHZjcHUgcGFyYW1ldGVycyBpbiBjc2NoZWQyX3VuaXQg
Zm9yIHRoZSB2Y3B1IGluIHRoZQogICogICAgcnVucXVldWUuCiAgKgogICogLSBQcml2YXRlIHNj
aGVkdWxlciBsb2NrCkBAIC01MTEsNyArNTExLDcgQEAgc3RydWN0IGNzY2hlZDJfcGNwdSB7CiAv
KgogICogVmlydHVhbCBDUFUKICAqLwotc3RydWN0IGNzY2hlZDJfdmNwdSB7CitzdHJ1Y3QgY3Nj
aGVkMl91bml0IHsKICAgICBzdHJ1Y3QgY3NjaGVkMl9kb20gKnNkb207ICAgICAgICAgIC8qIFVw
LXBvaW50ZXIgdG8gZG9tYWluICAgICAgICAgICAgICAgICovCiAgICAgc3RydWN0IHZjcHUgKnZj
cHU7ICAgICAgICAgICAgICAgICAvKiBVcC1wb2ludGVyLCB0byB2Y3B1ICAgICAgICAgICAgICAg
ICAqLwogICAgIHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZDsgLyogVXAtcG9pbnRl
ciB0byB0aGUgcnVucXVldWUgICAgICAgICAgKi8KQEAgLTU3MCw5ICs1NzAsOSBAQCBzdGF0aWMg
aW5saW5lIHN0cnVjdCBjc2NoZWQyX3BjcHUgKmNzY2hlZDJfcGNwdSh1bnNpZ25lZCBpbnQgY3B1
KQogICAgIHJldHVybiBwZXJfY3B1KHNjaGVkdWxlX2RhdGEsIGNwdSkuc2NoZWRfcHJpdjsKIH0K
IAotc3RhdGljIGlubGluZSBzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpjc2NoZWQyX3ZjcHUoY29uc3Qg
c3RydWN0IHZjcHUgKnYpCitzdGF0aWMgaW5saW5lIHN0cnVjdCBjc2NoZWQyX3VuaXQgKmNzY2hl
ZDJfdW5pdChjb25zdCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIHsKLSAgICByZXR1cm4gdi0+
c2NoZWRfdW5pdC0+cHJpdjsKKyAgICByZXR1cm4gdW5pdC0+cHJpdjsKIH0KIAogc3RhdGljIGlu
bGluZSBzdHJ1Y3QgY3NjaGVkMl9kb20gKmNzY2hlZDJfZG9tKGNvbnN0IHN0cnVjdCBkb21haW4g
KmQpCkBAIC01OTQsNyArNTk0LDcgQEAgc3RhdGljIGlubGluZSBzdHJ1Y3QgY3NjaGVkMl9ydW5x
dWV1ZV9kYXRhICpjMnJxZChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiB9CiAKIC8qIERv
ZXMgdGhlIGRvbWFpbiBvZiB0aGlzIHZDUFUgaGF2ZSBhIGNhcD8gKi8KLXN0YXRpYyBpbmxpbmUg
Ym9vbCBoYXNfY2FwKGNvbnN0IHN0cnVjdCBjc2NoZWQyX3ZjcHUgKnN2YykKK3N0YXRpYyBpbmxp
bmUgYm9vbCBoYXNfY2FwKGNvbnN0IHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YykKIHsKICAgICBy
ZXR1cm4gc3ZjLT5idWRnZXQgIT0gU1RJTUVfTUFYOwogfQpAQCAtNjg4LDcgKzY4OCw3IEBAIHZv
aWQgc210X2lkbGVfbWFza19jbGVhcih1bnNpZ25lZCBpbnQgY3B1LCBjcHVtYXNrX3QgKm1hc2sp
CiAgKiBPZiBjb3Vyc2UsIDEsIDIgYW5kIDMgbWFrZXMgc2Vuc2Ugb25seSBpZiBzdmMgaGFzIGEg
c29mdCBhZmZpbml0eS4gQWxzbwogICogbm90ZSB0aGF0IGF0IGxlYXN0IDUgaXMgZ3VhcmFudGVl
ZCB0byBfYWx3YXlzXyByZXR1cm4gYXQgbGVhc3Qgb25lIHBjcHUuCiAgKi8KLXN0YXRpYyBpbnQg
Z2V0X2ZhbGxiYWNrX2NwdShzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpzdmMpCitzdGF0aWMgaW50IGdl
dF9mYWxsYmFja19jcHUoc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQogewogICAgIHN0cnVjdCB2
Y3B1ICp2ID0gc3ZjLT52Y3B1OwogICAgIHVuc2lnbmVkIGludCBiczsKQEAgLTc3Myw3ICs3NzMs
NyBAQCBzdGF0aWMgaW50IGdldF9mYWxsYmFja19jcHUoc3RydWN0IGNzY2hlZDJfdmNwdSAqc3Zj
KQogICogRklYTUU6IERvIHByZS1jYWxjdWxhdGVkIGRpdmlzaW9uPwogICovCiBzdGF0aWMgdm9p
ZCB0MmNfdXBkYXRlKHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCwgc190aW1lX3Qg
dGltZSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGNzY2hlZDJfdmNwdSAqc3Zj
KQorICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMpCiB7
CiAgICAgdWludDY0X3QgdmFsID0gdGltZSAqIHJxZC0+bWF4X3dlaWdodCArIHN2Yy0+cmVzaWR1
YWw7CiAKQEAgLTc4MSw3ICs3ODEsNyBAQCBzdGF0aWMgdm9pZCB0MmNfdXBkYXRlKHN0cnVjdCBj
c2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCwgc190aW1lX3QgdGltZSwKICAgICBzdmMtPmNyZWRp
dCAtPSB2YWw7CiB9CiAKLXN0YXRpYyBzX3RpbWVfdCBjMnQoc3RydWN0IGNzY2hlZDJfcnVucXVl
dWVfZGF0YSAqcnFkLCBzX3RpbWVfdCBjcmVkaXQsIHN0cnVjdCBjc2NoZWQyX3ZjcHUgKnN2YykK
K3N0YXRpYyBzX3RpbWVfdCBjMnQoc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFkLCBz
X3RpbWVfdCBjcmVkaXQsIHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YykKIHsKICAgICByZXR1cm4g
Y3JlZGl0ICogc3ZjLT53ZWlnaHQgLyBycWQtPm1heF93ZWlnaHQ7CiB9CkBAIC03OTAsMTQgKzc5
MCwxNCBAQCBzdGF0aWMgc190aW1lX3QgYzJ0KHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEg
KnJxZCwgc190aW1lX3QgY3JlZGl0LCBzdHJ1Y3QgYwogICogUnVucXVldWUgcmVsYXRlZCBjb2Rl
LgogICovCiAKLXN0YXRpYyBpbmxpbmUgaW50IHZjcHVfb25fcnVucShzdHJ1Y3QgY3NjaGVkMl92
Y3B1ICpzdmMpCitzdGF0aWMgaW5saW5lIGludCB2Y3B1X29uX3J1bnEoc3RydWN0IGNzY2hlZDJf
dW5pdCAqc3ZjKQogewogICAgIHJldHVybiAhbGlzdF9lbXB0eSgmc3ZjLT5ydW5xX2VsZW0pOwog
fQogCi1zdGF0aWMgaW5saW5lIHN0cnVjdCBjc2NoZWQyX3ZjcHUgKiBydW5xX2VsZW0oc3RydWN0
IGxpc3RfaGVhZCAqZWxlbSkKK3N0YXRpYyBpbmxpbmUgc3RydWN0IGNzY2hlZDJfdW5pdCAqIHJ1
bnFfZWxlbShzdHJ1Y3QgbGlzdF9oZWFkICplbGVtKQogewotICAgIHJldHVybiBsaXN0X2VudHJ5
KGVsZW0sIHN0cnVjdCBjc2NoZWQyX3ZjcHUsIHJ1bnFfZWxlbSk7CisgICAgcmV0dXJuIGxpc3Rf
ZW50cnkoZWxlbSwgc3RydWN0IGNzY2hlZDJfdW5pdCwgcnVucV9lbGVtKTsKIH0KIAogc3RhdGlj
IHZvaWQgYWN0aXZhdGVfcnVucXVldWUoc3RydWN0IGNzY2hlZDJfcHJpdmF0ZSAqcHJ2LCBpbnQg
cnFpKQpAQCAtOTE1LDcgKzkxNSw3IEBAIHN0YXRpYyB2b2lkIHVwZGF0ZV9tYXhfd2VpZ2h0KHN0
cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCwgaW50IG5ld193ZWlnaHQsCiAKICAgICAg
ICAgbGlzdF9mb3JfZWFjaCggaXRlciwgJnJxZC0+c3ZjICkKICAgICAgICAgewotICAgICAgICAg
ICAgc3RydWN0IGNzY2hlZDJfdmNwdSAqIHN2YyA9IGxpc3RfZW50cnkoaXRlciwgc3RydWN0IGNz
Y2hlZDJfdmNwdSwgcnFkX2VsZW0pOworICAgICAgICAgICAgc3RydWN0IGNzY2hlZDJfdW5pdCAq
IHN2YyA9IGxpc3RfZW50cnkoaXRlciwgc3RydWN0IGNzY2hlZDJfdW5pdCwgcnFkX2VsZW0pOwog
CiAgICAgICAgICAgICBpZiAoIHN2Yy0+d2VpZ2h0ID4gbWF4X3dlaWdodCApCiAgICAgICAgICAg
ICAgICAgbWF4X3dlaWdodCA9IHN2Yy0+d2VpZ2h0OwpAQCAtOTQwLDcgKzk0MCw3IEBAIHN0YXRp
YyB2b2lkIHVwZGF0ZV9tYXhfd2VpZ2h0KHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJx
ZCwgaW50IG5ld193ZWlnaHQsCiAKIC8qIEFkZCBhbmQgcmVtb3ZlIGZyb20gcnVucXVldWUgYXNz
aWdubWVudCAobm90IGFjdGl2ZSBydW4gcXVldWUpICovCiBzdGF0aWMgdm9pZAotX3J1bnFfYXNz
aWduKHN0cnVjdCBjc2NoZWQyX3ZjcHUgKnN2Yywgc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0
YSAqcnFkKQorX3J1bnFfYXNzaWduKHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2Yywgc3RydWN0IGNz
Y2hlZDJfcnVucXVldWVfZGF0YSAqcnFkKQogewogCiAgICAgc3ZjLT5ycWQgPSBycWQ7CkBAIC05
NzAsNyArOTcwLDcgQEAgX3J1bnFfYXNzaWduKHN0cnVjdCBjc2NoZWQyX3ZjcHUgKnN2Yywgc3Ry
dWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFkKQogc3RhdGljIHZvaWQKIHJ1bnFfYXNzaWdu
KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHZjcHUgKnZjKQogewotICAgIHN0
cnVjdCBjc2NoZWQyX3ZjcHUgKnN2YyA9IHZjLT5zY2hlZF91bml0LT5wcml2OworICAgIHN0cnVj
dCBjc2NoZWQyX3VuaXQgKnN2YyA9IHZjLT5zY2hlZF91bml0LT5wcml2OwogCiAgICAgQVNTRVJU
KHN2Yy0+cnFkID09IE5VTEwpOwogCkBAIC05NzgsNyArOTc4LDcgQEAgcnVucV9hc3NpZ24oY29u
c3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgdmNwdSAqdmMpCiB9CiAKIHN0YXRpYyB2
b2lkCi1fcnVucV9kZWFzc2lnbihzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpzdmMpCitfcnVucV9kZWFz
c2lnbihzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMpCiB7CiAgICAgc3RydWN0IGNzY2hlZDJfcnVu
cXVldWVfZGF0YSAqcnFkID0gc3ZjLT5ycWQ7CiAKQEAgLTk5Nyw3ICs5OTcsNyBAQCBfcnVucV9k
ZWFzc2lnbihzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpzdmMpCiBzdGF0aWMgdm9pZAogcnVucV9kZWFz
c2lnbihjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCB2Y3B1ICp2YykKIHsKLSAg
ICBzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpzdmMgPSB2Yy0+c2NoZWRfdW5pdC0+cHJpdjsKKyAgICBz
dHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMgPSB2Yy0+c2NoZWRfdW5pdC0+cHJpdjsKIAogICAgIEFT
U0VSVChzdmMtPnJxZCA9PSBjMnJxZChvcHMsIHZjLT5wcm9jZXNzb3IpKTsKIApAQCAtMTE5OSw3
ICsxMTk5LDcgQEAgdXBkYXRlX3J1bnFfbG9hZChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMs
CiAKIHN0YXRpYyB2b2lkCiB1cGRhdGVfc3ZjX2xvYWQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAq
b3BzLAotICAgICAgICAgICAgICAgIHN0cnVjdCBjc2NoZWQyX3ZjcHUgKnN2YywgaW50IGNoYW5n
ZSwgc190aW1lX3Qgbm93KQorICAgICAgICAgICAgICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2
YywgaW50IGNoYW5nZSwgc190aW1lX3Qgbm93KQogewogICAgIHN0cnVjdCBjc2NoZWQyX3ByaXZh
dGUgKnBydiA9IGNzY2hlZDJfcHJpdihvcHMpOwogICAgIHNfdGltZV90IGRlbHRhLCB2Y3B1X2xv
YWQ7CkBAIC0xMjU5LDcgKzEyNTksNyBAQCB1cGRhdGVfc3ZjX2xvYWQoY29uc3Qgc3RydWN0IHNj
aGVkdWxlciAqb3BzLAogc3RhdGljIHZvaWQKIHVwZGF0ZV9sb2FkKGNvbnN0IHN0cnVjdCBzY2hl
ZHVsZXIgKm9wcywKICAgICAgICAgICAgIHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJx
ZCwKLSAgICAgICAgICAgIHN0cnVjdCBjc2NoZWQyX3ZjcHUgKnN2YywgaW50IGNoYW5nZSwgc190
aW1lX3Qgbm93KQorICAgICAgICAgICAgc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjLCBpbnQgY2hh
bmdlLCBzX3RpbWVfdCBub3cpCiB7CiAgICAgdHJhY2VfdmFyKFRSQ19DU0NIRUQyX1VQREFURV9M
T0FELCAxLCAwLCAgTlVMTCk7CiAKQEAgLTEyNjksNyArMTI2OSw3IEBAIHVwZGF0ZV9sb2FkKGNv
bnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKIH0KIAogc3RhdGljIHZvaWQKLXJ1bnFfaW5zZXJ0
KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IGNzY2hlZDJfdmNwdSAqc3ZjKQor
cnVucV9pbnNlcnQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgY3NjaGVkMl91
bml0ICpzdmMpCiB7CiAgICAgc3RydWN0IGxpc3RfaGVhZCAqaXRlcjsKICAgICB1bnNpZ25lZCBp
bnQgY3B1ID0gc3ZjLT52Y3B1LT5wcm9jZXNzb3I7CkBAIC0xMjg4LDcgKzEyODgsNyBAQCBydW5x
X2luc2VydChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBjc2NoZWQyX3ZjcHUg
KnN2YykKIAogICAgIGxpc3RfZm9yX2VhY2goIGl0ZXIsIHJ1bnEgKQogICAgIHsKLSAgICAgICAg
c3RydWN0IGNzY2hlZDJfdmNwdSAqIGl0ZXJfc3ZjID0gcnVucV9lbGVtKGl0ZXIpOworICAgICAg
ICBzdHJ1Y3QgY3NjaGVkMl91bml0ICogaXRlcl9zdmMgPSBydW5xX2VsZW0oaXRlcik7CiAKICAg
ICAgICAgaWYgKCBzdmMtPmNyZWRpdCA+IGl0ZXJfc3ZjLT5jcmVkaXQgKQogICAgICAgICAgICAg
YnJlYWs7CkBAIC0xMzEyLDEzICsxMzEyLDEzIEBAIHJ1bnFfaW5zZXJ0KGNvbnN0IHN0cnVjdCBz
Y2hlZHVsZXIgKm9wcywgc3RydWN0IGNzY2hlZDJfdmNwdSAqc3ZjKQogICAgIH0KIH0KIAotc3Rh
dGljIGlubGluZSB2b2lkIHJ1bnFfcmVtb3ZlKHN0cnVjdCBjc2NoZWQyX3ZjcHUgKnN2YykKK3N0
YXRpYyBpbmxpbmUgdm9pZCBydW5xX3JlbW92ZShzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMpCiB7
CiAgICAgQVNTRVJUKHZjcHVfb25fcnVucShzdmMpKTsKICAgICBsaXN0X2RlbF9pbml0KCZzdmMt
PnJ1bnFfZWxlbSk7CiB9CiAKLXZvaWQgYnVybl9jcmVkaXRzKHN0cnVjdCBjc2NoZWQyX3J1bnF1
ZXVlX2RhdGEgKnJxZCwgc3RydWN0IGNzY2hlZDJfdmNwdSAqLCBzX3RpbWVfdCk7Cit2b2lkIGJ1
cm5fY3JlZGl0cyhzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQsIHN0cnVjdCBjc2No
ZWQyX3VuaXQgKiwgc190aW1lX3QpOwogCiBzdGF0aWMgaW5saW5lIHZvaWQKIHRpY2tsZV9jcHUo
dW5zaWduZWQgaW50IGNwdSwgc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFkKQpAQCAt
MTMzNCw3ICsxMzM0LDcgQEAgdGlja2xlX2NwdSh1bnNpZ25lZCBpbnQgY3B1LCBzdHJ1Y3QgY3Nj
aGVkMl9ydW5xdWV1ZV9kYXRhICpycWQpCiAgKiB3aGV0aGVyIG9yIG5vdCBpdCBhbHJlYWR5IHJ1
biBmb3IgbW9yZSB0aGFuIHRoZSByYXRlbGltaXQsIHRvIHdoaWNoIHdlCiAgKiBhcHBseSBzb21l
IHRvbGVyYW5jZSkuCiAgKi8KLXN0YXRpYyBpbmxpbmUgYm9vbCBpc19wcmVlbXB0YWJsZShjb25z
dCBzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpzdmMsCitzdGF0aWMgaW5saW5lIGJvb2wgaXNfcHJlZW1w
dGFibGUoY29uc3Qgc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjLAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgc190aW1lX3Qgbm93LCBzX3RpbWVfdCByYXRlbGltaXQpCiB7CiAg
ICAgaWYgKCByYXRlbGltaXQgPD0gQ1NDSEVEMl9SQVRFTElNSVRfVElDS0xFX1RPTEVSQU5DRSAp
CkBAIC0xMzYwLDEwICsxMzYwLDEwIEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBpc19wcmVlbXB0YWJs
ZShjb25zdCBzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpzdmMsCiAgKiBXaXRoaW4gdGhlIHNhbWUgY2xh
c3MsIHRoZSBoaWdoZXN0IGRpZmZlcmVuY2Ugb2YgY3JlZGl0LgogICovCiBzdGF0aWMgc190aW1l
X3QgdGlja2xlX3Njb3JlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc190aW1lX3Qgbm93
LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpuZXcs
IHVuc2lnbmVkIGludCBjcHUpCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBj
c2NoZWQyX3VuaXQgKm5ldywgdW5zaWduZWQgaW50IGNwdSkKIHsKICAgICBzdHJ1Y3QgY3NjaGVk
Ml9ydW5xdWV1ZV9kYXRhICpycWQgPSBjMnJxZChvcHMsIGNwdSk7Ci0gICAgc3RydWN0IGNzY2hl
ZDJfdmNwdSAqIGN1ciA9IGNzY2hlZDJfdmNwdShjdXJyX29uX2NwdShjcHUpKTsKKyAgICBzdHJ1
Y3QgY3NjaGVkMl91bml0ICogY3VyID0gY3NjaGVkMl91bml0KGN1cnJfb25fY3B1KGNwdSkpOwog
ICAgIHN0cnVjdCBjc2NoZWQyX3ByaXZhdGUgKnBydiA9IGNzY2hlZDJfcHJpdihvcHMpOwogICAg
IHNfdGltZV90IHNjb3JlOwogCkBAIC0xNDMyLDcgKzE0MzIsNyBAQCBzdGF0aWMgc190aW1lX3Qg
dGlja2xlX3Njb3JlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc190aW1lX3Qgbm93LAog
ICogcGljayB1cCBzb21lIHdvcmssIHNvIGl0IHdvdWxkIGJlIHdyb25nIHRvIGNvbnNpZGVyIGl0
IGlkbGUuCiAgKi8KIHN0YXRpYyB2b2lkCi1ydW5xX3RpY2tsZShjb25zdCBzdHJ1Y3Qgc2NoZWR1
bGVyICpvcHMsIHN0cnVjdCBjc2NoZWQyX3ZjcHUgKm5ldywgc190aW1lX3Qgbm93KQorcnVucV90
aWNrbGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgY3NjaGVkMl91bml0ICpu
ZXcsIHNfdGltZV90IG5vdykKIHsKICAgICBpbnQgaSwgaXBpZCA9IC0xOwogICAgIHNfdGltZV90
IG1heCA9IDA7CkBAIC0xNTg3LDcgKzE1ODcsNyBAQCBydW5xX3RpY2tsZShjb25zdCBzdHJ1Y3Qg
c2NoZWR1bGVyICpvcHMsIHN0cnVjdCBjc2NoZWQyX3ZjcHUgKm5ldywgc190aW1lX3Qgbm93KQog
ICAgICAgICByZXR1cm47CiAgICAgfQogCi0gICAgQVNTRVJUKCFpc19pZGxlX3ZjcHUoY3Vycl9v
bl9jcHUoaXBpZCkpKTsKKyAgICBBU1NFUlQoIWlzX2lkbGVfdmNwdShjdXJyX29uX2NwdShpcGlk
KS0+dmNwdSkpOwogICAgIFNDSEVEX1NUQVRfQ1JBTksodGlja2xlZF9idXN5X2NwdSk7CiAgdGlj
a2xlOgogICAgIEJVR19PTihpcGlkID09IC0xKTsKQEAgLTE2MTQsNyArMTYxNCw3IEBAIHJ1bnFf
dGlja2xlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IGNzY2hlZDJfdmNwdSAq
bmV3LCBzX3RpbWVfdCBub3cpCiAgKiBDcmVkaXQtcmVsYXRlZCBjb2RlCiAgKi8KIHN0YXRpYyB2
b2lkIHJlc2V0X2NyZWRpdChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGludCBjcHUsIHNf
dGltZV90IG5vdywKLSAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl92Y3B1
ICpzbmV4dCkKKyAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICpz
bmV4dCkKIHsKICAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQgPSBjMnJxZChv
cHMsIGNwdSk7CiAgICAgc3RydWN0IGxpc3RfaGVhZCAqaXRlcjsKQEAgLTE2NDQsMTAgKzE2NDQs
MTAgQEAgc3RhdGljIHZvaWQgcmVzZXRfY3JlZGl0KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9w
cywgaW50IGNwdSwgc190aW1lX3Qgbm93LAogICAgIGxpc3RfZm9yX2VhY2goIGl0ZXIsICZycWQt
PnN2YyApCiAgICAgewogICAgICAgICB1bnNpZ25lZCBpbnQgc3ZjX2NwdTsKLSAgICAgICAgc3Ry
dWN0IGNzY2hlZDJfdmNwdSAqIHN2YzsKKyAgICAgICAgc3RydWN0IGNzY2hlZDJfdW5pdCAqIHN2
YzsKICAgICAgICAgaW50IHN0YXJ0X2NyZWRpdDsKIAotICAgICAgICBzdmMgPSBsaXN0X2VudHJ5
KGl0ZXIsIHN0cnVjdCBjc2NoZWQyX3ZjcHUsIHJxZF9lbGVtKTsKKyAgICAgICAgc3ZjID0gbGlz
dF9lbnRyeShpdGVyLCBzdHJ1Y3QgY3NjaGVkMl91bml0LCBycWRfZWxlbSk7CiAgICAgICAgIHN2
Y19jcHUgPSBzdmMtPnZjcHUtPnByb2Nlc3NvcjsKIAogICAgICAgICBBU1NFUlQoIWlzX2lkbGVf
dmNwdShzdmMtPnZjcHUpKTsKQEAgLTE2NTcsNyArMTY1Nyw3IEBAIHN0YXRpYyB2b2lkIHJlc2V0
X2NyZWRpdChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGludCBjcHUsIHNfdGltZV90IG5v
dywKICAgICAgICAgICogSWYgc3ZjIGlzIHJ1bm5pbmcsIGl0IGlzIG91ciByZXNwb25zaWJpbGl0
eSB0byBtYWtlIHN1cmUsIGhlcmUsCiAgICAgICAgICAqIHRoYXQgdGhlIGNyZWRpdCBpdCBoYXMg
c3BlbnQgc28gZmFyIGdldCBhY2NvdW50ZWQuCiAgICAgICAgICAqLwotICAgICAgICBpZiAoIHN2
Yy0+dmNwdSA9PSBjdXJyX29uX2NwdShzdmNfY3B1KSApCisgICAgICAgIGlmICggc3ZjLT52Y3B1
ID09IGN1cnJfb25fY3B1KHN2Y19jcHUpLT52Y3B1ICkKICAgICAgICAgewogICAgICAgICAgICAg
YnVybl9jcmVkaXRzKHJxZCwgc3ZjLCBub3cpOwogICAgICAgICAgICAgLyoKQEAgLTE3MDksMTEg
KzE3MDksMTEgQEAgc3RhdGljIHZvaWQgcmVzZXRfY3JlZGl0KGNvbnN0IHN0cnVjdCBzY2hlZHVs
ZXIgKm9wcywgaW50IGNwdSwgc190aW1lX3Qgbm93LAogfQogCiB2b2lkIGJ1cm5fY3JlZGl0cyhz
dHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQsCi0gICAgICAgICAgICAgICAgICBzdHJ1
Y3QgY3NjaGVkMl92Y3B1ICpzdmMsIHNfdGltZV90IG5vdykKKyAgICAgICAgICAgICAgICAgIHN0
cnVjdCBjc2NoZWQyX3VuaXQgKnN2Yywgc190aW1lX3Qgbm93KQogewogICAgIHNfdGltZV90IGRl
bHRhOwogCi0gICAgQVNTRVJUKHN2YyA9PSBjc2NoZWQyX3ZjcHUoY3Vycl9vbl9jcHUoc3ZjLT52
Y3B1LT5wcm9jZXNzb3IpKSk7CisgICAgQVNTRVJUKHN2YyA9PSBjc2NoZWQyX3VuaXQoY3Vycl9v
bl9jcHUoc3ZjLT52Y3B1LT5wcm9jZXNzb3IpKSk7CiAKICAgICBpZiAoIHVubGlrZWx5KGlzX2lk
bGVfdmNwdShzdmMtPnZjcHUpKSApCiAgICAgewpAQCAtMTc2Myw3ICsxNzYzLDcgQEAgdm9pZCBi
dXJuX2NyZWRpdHMoc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFkLAogICogQnVkZ2V0
LXJlbGF0ZWQgY29kZS4KICAqLwogCi1zdGF0aWMgdm9pZCBwYXJrX3ZjcHUoc3RydWN0IGNzY2hl
ZDJfdmNwdSAqc3ZjKQorc3RhdGljIHZvaWQgcGFya192Y3B1KHN0cnVjdCBjc2NoZWQyX3VuaXQg
KnN2YykKIHsKICAgICBzdHJ1Y3QgdmNwdSAqdiA9IHN2Yy0+dmNwdTsKIApAQCAtMTc5Miw3ICsx
NzkyLDcgQEAgc3RhdGljIHZvaWQgcGFya192Y3B1KHN0cnVjdCBjc2NoZWQyX3ZjcHUgKnN2YykK
ICAgICBsaXN0X2FkZCgmc3ZjLT5wYXJrZWRfZWxlbSwgJnN2Yy0+c2RvbS0+cGFya2VkX3ZjcHVz
KTsKIH0KIAotc3RhdGljIGJvb2wgdmNwdV9ncmFiX2J1ZGdldChzdHJ1Y3QgY3NjaGVkMl92Y3B1
ICpzdmMpCitzdGF0aWMgYm9vbCB2Y3B1X2dyYWJfYnVkZ2V0KHN0cnVjdCBjc2NoZWQyX3VuaXQg
KnN2YykKIHsKICAgICBzdHJ1Y3QgY3NjaGVkMl9kb20gKnNkb20gPSBzdmMtPnNkb207CiAgICAg
dW5zaWduZWQgaW50IGNwdSA9IHN2Yy0+dmNwdS0+cHJvY2Vzc29yOwpAQCAtMTgzOSw3ICsxODM5
LDcgQEAgc3RhdGljIGJvb2wgdmNwdV9ncmFiX2J1ZGdldChzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpz
dmMpCiB9CiAKIHN0YXRpYyB2b2lkCi12Y3B1X3JldHVybl9idWRnZXQoc3RydWN0IGNzY2hlZDJf
dmNwdSAqc3ZjLCBzdHJ1Y3QgbGlzdF9oZWFkICpwYXJrZWQpCit2Y3B1X3JldHVybl9idWRnZXQo
c3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjLCBzdHJ1Y3QgbGlzdF9oZWFkICpwYXJrZWQpCiB7CiAg
ICAgc3RydWN0IGNzY2hlZDJfZG9tICpzZG9tID0gc3ZjLT5zZG9tOwogICAgIHVuc2lnbmVkIGlu
dCBjcHUgPSBzdmMtPnZjcHUtPnByb2Nlc3NvcjsKQEAgLTE4ODIsNyArMTg4Miw3IEBAIHZjcHVf
cmV0dXJuX2J1ZGdldChzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpzdmMsIHN0cnVjdCBsaXN0X2hlYWQg
KnBhcmtlZCkKIHN0YXRpYyB2b2lkCiB1bnBhcmtfcGFya2VkX3ZjcHVzKGNvbnN0IHN0cnVjdCBz
Y2hlZHVsZXIgKm9wcywgc3RydWN0IGxpc3RfaGVhZCAqdmNwdXMpCiB7Ci0gICAgc3RydWN0IGNz
Y2hlZDJfdmNwdSAqc3ZjLCAqdG1wOworICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YywgKnRt
cDsKICAgICBzcGlubG9ja190ICpsb2NrOwogCiAgICAgbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZl
KHN2YywgdG1wLCB2Y3B1cywgcGFya2VkX2VsZW0pCkBAIC0yMDA0LDcgKzIwMDQsNyBAQCBzdGF0
aWMgdm9pZCByZXBsZW5pc2hfZG9tYWluX2J1ZGdldCh2b2lkKiBkYXRhKQogc3RhdGljIGlubGlu
ZSB2b2lkCiBjc2NoZWQyX3ZjcHVfY2hlY2soc3RydWN0IHZjcHUgKnZjKQogewotICAgIHN0cnVj
dCBjc2NoZWQyX3ZjcHUgKiBjb25zdCBzdmMgPSBjc2NoZWQyX3ZjcHUodmMpOworICAgIHN0cnVj
dCBjc2NoZWQyX3VuaXQgKiBjb25zdCBzdmMgPSBjc2NoZWQyX3VuaXQodmMtPnNjaGVkX3VuaXQp
OwogICAgIHN0cnVjdCBjc2NoZWQyX2RvbSAqIGNvbnN0IHNkb20gPSBzdmMtPnNkb207CiAKICAg
ICBCVUdfT04oIHN2Yy0+dmNwdSAhPSB2YyApOwpAQCAtMjAzMCwxMCArMjAzMCwxMCBAQCBjc2No
ZWQyX2FsbG9jX3ZkYXRhKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVk
X3VuaXQgKnVuaXQsCiAgICAgICAgICAgICAgICAgICAgIHZvaWQgKmRkKQogewogICAgIHN0cnVj
dCB2Y3B1ICp2YyA9IHVuaXQtPnZjcHU7Ci0gICAgc3RydWN0IGNzY2hlZDJfdmNwdSAqc3ZjOwor
ICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YzsKIAogICAgIC8qIEFsbG9jYXRlIHBlci1WQ1BV
IGluZm8gKi8KLSAgICBzdmMgPSB4emFsbG9jKHN0cnVjdCBjc2NoZWQyX3ZjcHUpOworICAgIHN2
YyA9IHh6YWxsb2Moc3RydWN0IGNzY2hlZDJfdW5pdCk7CiAgICAgaWYgKCBzdmMgPT0gTlVMTCAp
CiAgICAgICAgIHJldHVybiBOVUxMOwogCkBAIC0yMDc0LDEyICsyMDc0LDEyIEBAIHN0YXRpYyB2
b2lkCiBjc2NoZWQyX3VuaXRfc2xlZXAoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1
Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIHsKICAgICBzdHJ1Y3QgdmNwdSAqdmMgPSB1bml0LT52Y3B1
OwotICAgIHN0cnVjdCBjc2NoZWQyX3ZjcHUgKiBjb25zdCBzdmMgPSBjc2NoZWQyX3ZjcHUodmMp
OworICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKiBjb25zdCBzdmMgPSBjc2NoZWQyX3VuaXQodW5p
dCk7CiAKICAgICBBU1NFUlQoIWlzX2lkbGVfdmNwdSh2YykpOwogICAgIFNDSEVEX1NUQVRfQ1JB
TksodmNwdV9zbGVlcCk7CiAKLSAgICBpZiAoIGN1cnJfb25fY3B1KHZjLT5wcm9jZXNzb3IpID09
IHZjICkKKyAgICBpZiAoIGN1cnJfb25fY3B1KHZjLT5wcm9jZXNzb3IpID09IHVuaXQgKQogICAg
IHsKICAgICAgICAgdGlja2xlX2NwdSh2Yy0+cHJvY2Vzc29yLCBzdmMtPnJxZCk7CiAgICAgfQpA
QCAtMjA5Nyw3ICsyMDk3LDcgQEAgc3RhdGljIHZvaWQKIGNzY2hlZDJfdW5pdF93YWtlKGNvbnN0
IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiB7CiAgICAg
c3RydWN0IHZjcHUgKnZjID0gdW5pdC0+dmNwdTsKLSAgICBzdHJ1Y3QgY3NjaGVkMl92Y3B1ICog
Y29uc3Qgc3ZjID0gY3NjaGVkMl92Y3B1KHZjKTsKKyAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICog
Y29uc3Qgc3ZjID0gY3NjaGVkMl91bml0KHVuaXQpOwogICAgIHVuc2lnbmVkIGludCBjcHUgPSB2
Yy0+cHJvY2Vzc29yOwogICAgIHNfdGltZV90IG5vdzsKIApAQCAtMjEwNSw3ICsyMTA1LDcgQEAg
Y3NjaGVkMl91bml0X3dha2UoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2No
ZWRfdW5pdCAqdW5pdCkKIAogICAgIEFTU0VSVCghaXNfaWRsZV92Y3B1KHZjKSk7CiAKLSAgICBp
ZiAoIHVubGlrZWx5KGN1cnJfb25fY3B1KGNwdSkgPT0gdmMpICkKKyAgICBpZiAoIHVubGlrZWx5
KGN1cnJfb25fY3B1KGNwdSkgPT0gdW5pdCkgKQogICAgIHsKICAgICAgICAgU0NIRURfU1RBVF9D
UkFOSyh2Y3B1X3dha2VfcnVubmluZyk7CiAgICAgICAgIGdvdG8gb3V0OwpAQCAtMjE1Miw4ICsy
MTUyLDcgQEAgb3V0Ogogc3RhdGljIHZvaWQKIGNzY2hlZDJfdW5pdF95aWVsZChjb25zdCBzdHJ1
Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogewotICAgIHN0cnVj
dCB2Y3B1ICp2ID0gdW5pdC0+dmNwdTsKLSAgICBzdHJ1Y3QgY3NjaGVkMl92Y3B1ICogY29uc3Qg
c3ZjID0gY3NjaGVkMl92Y3B1KHYpOworICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKiBjb25zdCBz
dmMgPSBjc2NoZWQyX3VuaXQodW5pdCk7CiAKICAgICBfX3NldF9iaXQoX19DU0ZMQUdfdmNwdV95
aWVsZCwgJnN2Yy0+ZmxhZ3MpOwogfQpAQCAtMjE2Miw3ICsyMTYxLDcgQEAgc3RhdGljIHZvaWQK
IGNzY2hlZDJfY29udGV4dF9zYXZlZChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVj
dCBzY2hlZF91bml0ICp1bml0KQogewogICAgIHN0cnVjdCB2Y3B1ICp2YyA9IHVuaXQtPnZjcHU7
Ci0gICAgc3RydWN0IGNzY2hlZDJfdmNwdSAqIGNvbnN0IHN2YyA9IGNzY2hlZDJfdmNwdSh2Yyk7
CisgICAgc3RydWN0IGNzY2hlZDJfdW5pdCAqIGNvbnN0IHN2YyA9IGNzY2hlZDJfdW5pdCh1bml0
KTsKICAgICBzcGlubG9ja190ICpsb2NrID0gdmNwdV9zY2hlZHVsZV9sb2NrX2lycSh2Yyk7CiAg
ICAgc190aW1lX3Qgbm93ID0gTk9XKCk7CiAgICAgTElTVF9IRUFEKHdlcmVfcGFya2VkKTsKQEAg
LTIyMDgsNyArMjIwNyw3IEBAIGNzY2hlZDJfcmVzX3BpY2soY29uc3Qgc3RydWN0IHNjaGVkdWxl
ciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKICAgICBzdHJ1Y3QgdmNwdSAqdmMgPSB1
bml0LT52Y3B1OwogICAgIGludCBpLCBtaW5fcnFpID0gLTEsIG1pbl9zX3JxaSA9IC0xOwogICAg
IHVuc2lnbmVkIGludCBuZXdfY3B1LCBjcHUgPSB2Yy0+cHJvY2Vzc29yOwotICAgIHN0cnVjdCBj
c2NoZWQyX3ZjcHUgKnN2YyA9IGNzY2hlZDJfdmNwdSh2Yyk7CisgICAgc3RydWN0IGNzY2hlZDJf
dW5pdCAqc3ZjID0gY3NjaGVkMl91bml0KHVuaXQpOwogICAgIHNfdGltZV90IG1pbl9hdmdsb2Fk
ID0gTUFYX0xPQUQsIG1pbl9zX2F2Z2xvYWQgPSBNQVhfTE9BRDsKICAgICBib29sIGhhc19zb2Z0
OwogCkBAIC0yNDMwLDE1ICsyNDI5LDE1IEBAIGNzY2hlZDJfcmVzX3BpY2soY29uc3Qgc3RydWN0
IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIHR5cGVkZWYgc3RydWN0
IHsKICAgICAvKiBOQjogTW9kaWZpZWQgYnkgY29uc2lkZXIoKSAqLwogICAgIHNfdGltZV90IGxv
YWRfZGVsdGE7Ci0gICAgc3RydWN0IGNzY2hlZDJfdmNwdSAqIGJlc3RfcHVzaF9zdmMsICpiZXN0
X3B1bGxfc3ZjOworICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKiBiZXN0X3B1c2hfc3ZjLCAqYmVz
dF9wdWxsX3N2YzsKICAgICAvKiBOQjogUmVhZCBieSBjb25zaWRlcigpICovCiAgICAgc3RydWN0
IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqbHJxZDsKICAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1
ZV9kYXRhICpvcnFkOyAgICAgICAgICAgICAgICAgIAogfSBiYWxhbmNlX3N0YXRlX3Q7CiAKIHN0
YXRpYyB2b2lkIGNvbnNpZGVyKGJhbGFuY2Vfc3RhdGVfdCAqc3QsIAotICAgICAgICAgICAgICAg
ICAgICAgc3RydWN0IGNzY2hlZDJfdmNwdSAqcHVzaF9zdmMsCi0gICAgICAgICAgICAgICAgICAg
ICBzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpwdWxsX3N2YykKKyAgICAgICAgICAgICAgICAgICAgIHN0
cnVjdCBjc2NoZWQyX3VuaXQgKnB1c2hfc3ZjLAorICAgICAgICAgICAgICAgICAgICAgc3RydWN0
IGNzY2hlZDJfdW5pdCAqcHVsbF9zdmMpCiB7CiAgICAgc190aW1lX3QgbF9sb2FkLCBvX2xvYWQs
IGRlbHRhOwogCkBAIC0yNDcxLDggKzI0NzAsOCBAQCBzdGF0aWMgdm9pZCBjb25zaWRlcihiYWxh
bmNlX3N0YXRlX3QgKnN0LAogCiAKIHN0YXRpYyB2b2lkIG1pZ3JhdGUoY29uc3Qgc3RydWN0IHNj
aGVkdWxlciAqb3BzLAotICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpz
dmMsIAotICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICp0
cnFkLCAKKyAgICAgICAgICAgICAgICAgICAgc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjLAorICAg
ICAgICAgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICp0cnFkLAogICAg
ICAgICAgICAgICAgICAgICBzX3RpbWVfdCBub3cpCiB7CiAgICAgaW50IGNwdSA9IHN2Yy0+dmNw
dS0+cHJvY2Vzc29yOwpAQCAtMjU0MSw3ICsyNTQwLDcgQEAgc3RhdGljIHZvaWQgbWlncmF0ZShj
b25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAgKiAgLSBzdmMgaXMgbm90IGFscmVhZHkgZmxh
Z2dlZCB0byBtaWdyYXRlLAogICogIC0gaWYgc3ZjIGlzIGFsbG93ZWQgdG8gcnVuIG9uIGF0IGxl
YXN0IG9uZSBvZiB0aGUgcGNwdXMgb2YgcnFkLgogICovCi1zdGF0aWMgYm9vbCB2Y3B1X2lzX21p
Z3JhdGVhYmxlKHN0cnVjdCBjc2NoZWQyX3ZjcHUgKnN2YywKK3N0YXRpYyBib29sIHZjcHVfaXNf
bWlncmF0ZWFibGUoc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjLAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCkKIHsKICAg
ICBzdHJ1Y3QgdmNwdSAqdiA9IHN2Yy0+dmNwdTsKQEAgLTI2OTEsNyArMjY5MCw3IEBAIHJldHJ5
OgogICAgIC8qIFJldXNlIGxvYWQgZGVsdGEgKGFzIHdlJ3JlIHRyeWluZyB0byBtaW5pbWl6ZSBp
dCkgKi8KICAgICBsaXN0X2Zvcl9lYWNoKCBwdXNoX2l0ZXIsICZzdC5scnFkLT5zdmMgKQogICAg
IHsKLSAgICAgICAgc3RydWN0IGNzY2hlZDJfdmNwdSAqIHB1c2hfc3ZjID0gbGlzdF9lbnRyeShw
dXNoX2l0ZXIsIHN0cnVjdCBjc2NoZWQyX3ZjcHUsIHJxZF9lbGVtKTsKKyAgICAgICAgc3RydWN0
IGNzY2hlZDJfdW5pdCAqIHB1c2hfc3ZjID0gbGlzdF9lbnRyeShwdXNoX2l0ZXIsIHN0cnVjdCBj
c2NoZWQyX3VuaXQsIHJxZF9lbGVtKTsKIAogICAgICAgICB1cGRhdGVfc3ZjX2xvYWQob3BzLCBw
dXNoX3N2YywgMCwgbm93KTsKIApAQCAtMjcwMCw3ICsyNjk5LDcgQEAgcmV0cnk6CiAKICAgICAg
ICAgbGlzdF9mb3JfZWFjaCggcHVsbF9pdGVyLCAmc3Qub3JxZC0+c3ZjICkKICAgICAgICAgewot
ICAgICAgICAgICAgc3RydWN0IGNzY2hlZDJfdmNwdSAqIHB1bGxfc3ZjID0gbGlzdF9lbnRyeShw
dWxsX2l0ZXIsIHN0cnVjdCBjc2NoZWQyX3ZjcHUsIHJxZF9lbGVtKTsKKyAgICAgICAgICAgIHN0
cnVjdCBjc2NoZWQyX3VuaXQgKiBwdWxsX3N2YyA9IGxpc3RfZW50cnkocHVsbF9pdGVyLCBzdHJ1
Y3QgY3NjaGVkMl91bml0LCBycWRfZWxlbSk7CiAgICAgICAgICAgICAKICAgICAgICAgICAgIGlm
ICggIWlubmVyX2xvYWRfdXBkYXRlZCApCiAgICAgICAgICAgICAgICAgdXBkYXRlX3N2Y19sb2Fk
KG9wcywgcHVsbF9zdmMsIDAsIG5vdyk7CkBAIC0yNzE5LDcgKzI3MTgsNyBAQCByZXRyeToKIAog
ICAgIGxpc3RfZm9yX2VhY2goIHB1bGxfaXRlciwgJnN0Lm9ycWQtPnN2YyApCiAgICAgewotICAg
ICAgICBzdHJ1Y3QgY3NjaGVkMl92Y3B1ICogcHVsbF9zdmMgPSBsaXN0X2VudHJ5KHB1bGxfaXRl
ciwgc3RydWN0IGNzY2hlZDJfdmNwdSwgcnFkX2VsZW0pOworICAgICAgICBzdHJ1Y3QgY3NjaGVk
Ml91bml0ICogcHVsbF9zdmMgPSBsaXN0X2VudHJ5KHB1bGxfaXRlciwgc3RydWN0IGNzY2hlZDJf
dW5pdCwgcnFkX2VsZW0pOwogICAgICAgICAKICAgICAgICAgaWYgKCAhdmNwdV9pc19taWdyYXRl
YWJsZShwdWxsX3N2Yywgc3QubHJxZCkgKQogICAgICAgICAgICAgY29udGludWU7CkBAIC0yNzQ2
LDcgKzI3NDUsNyBAQCBjc2NoZWQyX3VuaXRfbWlncmF0ZSgKIHsKICAgICBzdHJ1Y3QgdmNwdSAq
dmMgPSB1bml0LT52Y3B1OwogICAgIHN0cnVjdCBkb21haW4gKmQgPSB2Yy0+ZG9tYWluOwotICAg
IHN0cnVjdCBjc2NoZWQyX3ZjcHUgKiBjb25zdCBzdmMgPSBjc2NoZWQyX3ZjcHUodmMpOworICAg
IHN0cnVjdCBjc2NoZWQyX3VuaXQgKiBjb25zdCBzdmMgPSBjc2NoZWQyX3VuaXQodW5pdCk7CiAg
ICAgc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqdHJxZDsKICAgICBzX3RpbWVfdCBub3cg
PSBOT1coKTsKIApAQCAtMjg0Nyw3ICsyODQ2LDcgQEAgY3NjaGVkMl9kb21fY250bCgKICAgICAg
ICAgICAgIC8qIFVwZGF0ZSB3ZWlnaHRzIGZvciB2Y3B1cywgYW5kIG1heF93ZWlnaHQgZm9yIHJ1
bnF1ZXVlcyBvbiB3aGljaCB0aGV5IHJlc2lkZSAqLwogICAgICAgICAgICAgZm9yX2VhY2hfdmNw
dSAoIGQsIHYgKQogICAgICAgICAgICAgewotICAgICAgICAgICAgICAgIHN0cnVjdCBjc2NoZWQy
X3ZjcHUgKnN2YyA9IGNzY2hlZDJfdmNwdSh2KTsKKyAgICAgICAgICAgICAgICBzdHJ1Y3QgY3Nj
aGVkMl91bml0ICpzdmMgPSBjc2NoZWQyX3VuaXQodi0+c2NoZWRfdW5pdCk7CiAgICAgICAgICAg
ICAgICAgc3BpbmxvY2tfdCAqbG9jayA9IHZjcHVfc2NoZWR1bGVfbG9jayhzdmMtPnZjcHUpOwog
CiAgICAgICAgICAgICAgICAgQVNTRVJUKHN2Yy0+cnFkID09IGMycnFkKG9wcywgc3ZjLT52Y3B1
LT5wcm9jZXNzb3IpKTsKQEAgLTI4NjEsNyArMjg2MCw3IEBAIGNzY2hlZDJfZG9tX2NudGwoCiAg
ICAgICAgIC8qIENhcCAqLwogICAgICAgICBpZiAoIG9wLT51LmNyZWRpdDIuY2FwICE9IDAgKQog
ICAgICAgICB7Ci0gICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpzdmM7CisgICAgICAg
ICAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmM7CiAgICAgICAgICAgICBzcGlubG9ja190ICps
b2NrOwogCiAgICAgICAgICAgICAvKiBDYXAgaXMgb25seSB2YWxpZCBpZiBpdCdzIGJlbG93IDEw
MCAqIG5yX29mX3ZDUFVTICovCkBAIC0yODg1LDcgKzI4ODQsNyBAQCBjc2NoZWQyX2RvbV9jbnRs
KAogICAgICAgICAgICAgICovCiAgICAgICAgICAgICBmb3JfZWFjaF92Y3B1ICggZCwgdiApCiAg
ICAgICAgICAgICB7Ci0gICAgICAgICAgICAgICAgc3ZjID0gY3NjaGVkMl92Y3B1KHYpOworICAg
ICAgICAgICAgICAgIHN2YyA9IGNzY2hlZDJfdW5pdCh2LT5zY2hlZF91bml0KTsKICAgICAgICAg
ICAgICAgICBsb2NrID0gdmNwdV9zY2hlZHVsZV9sb2NrKHN2Yy0+dmNwdSk7CiAgICAgICAgICAg
ICAgICAgLyoKICAgICAgICAgICAgICAgICAgKiBUb28gc21hbGwgcXVvdGFzIHdvdWxkIGluIHRo
ZW9yeSBjYXVzZSBhIGxvdCBvZiBvdmVyaGVhZCwKQEAgLTI5MjgsMTQgKzI5MjcsMTQgQEAgY3Nj
aGVkMl9kb21fY250bCgKICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICBmb3Jf
ZWFjaF92Y3B1ICggZCwgdiApCiAgICAgICAgICAgICAgICAgewotICAgICAgICAgICAgICAgICAg
ICBzdmMgPSBjc2NoZWQyX3ZjcHUodik7CisgICAgICAgICAgICAgICAgICAgIHN2YyA9IGNzY2hl
ZDJfdW5pdCh2LT5zY2hlZF91bml0KTsKICAgICAgICAgICAgICAgICAgICAgbG9jayA9IHZjcHVf
c2NoZWR1bGVfbG9jayhzdmMtPnZjcHUpOwogICAgICAgICAgICAgICAgICAgICBpZiAoIHYtPmlz
X3J1bm5pbmcgKQogICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAg
ICB1bnNpZ25lZCBpbnQgY3B1ID0gdi0+cHJvY2Vzc29yOwogICAgICAgICAgICAgICAgICAgICAg
ICAgc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFkID0gYzJycWQob3BzLCBjcHUpOwog
Ci0gICAgICAgICAgICAgICAgICAgICAgICBBU1NFUlQoY3Vycl9vbl9jcHUoY3B1KSA9PSB2KTsK
KyAgICAgICAgICAgICAgICAgICAgICAgIEFTU0VSVChjdXJyX29uX2NwdShjcHUpLT52Y3B1ID09
IHYpOwogCiAgICAgICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAg
ICAgICogV2UgYXJlIHRyaWdnZXJpbmcgYSByZXNjaGVkdWxlIG9uIHRoZSB2Q1BVJ3MKQEAgLTI5
NzUsNyArMjk3NCw3IEBAIGNzY2hlZDJfZG9tX2NudGwoCiAgICAgICAgICAgICAvKiBEaXNhYmxl
IGJ1ZGdldCBhY2NvdW50aW5nIGZvciBhbGwgdGhlIHZDUFVzLiAqLwogICAgICAgICAgICAgZm9y
X2VhY2hfdmNwdSAoIGQsIHYgKQogICAgICAgICAgICAgewotICAgICAgICAgICAgICAgIHN0cnVj
dCBjc2NoZWQyX3ZjcHUgKnN2YyA9IGNzY2hlZDJfdmNwdSh2KTsKKyAgICAgICAgICAgICAgICBz
dHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMgPSBjc2NoZWQyX3VuaXQodi0+c2NoZWRfdW5pdCk7CiAg
ICAgICAgICAgICAgICAgc3BpbmxvY2tfdCAqbG9jayA9IHZjcHVfc2NoZWR1bGVfbG9jayhzdmMt
PnZjcHUpOwogCiAgICAgICAgICAgICAgICAgc3ZjLT5idWRnZXQgPSBTVElNRV9NQVg7CkBAIC0z
MDEyLDggKzMwMTEsNyBAQCBzdGF0aWMgdm9pZAogY3NjaGVkMl9hZmZfY250bChjb25zdCBzdHJ1
Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0LAogICAgICAgICAgICAg
ICAgICBjb25zdCBjcHVtYXNrX3QgKmhhcmQsIGNvbnN0IGNwdW1hc2tfdCAqc29mdCkKIHsKLSAg
ICBzdHJ1Y3QgdmNwdSAqdiA9IHVuaXQtPnZjcHU7Ci0gICAgc3RydWN0IGNzY2hlZDJfdmNwdSAq
c3ZjID0gY3NjaGVkMl92Y3B1KHYpOworICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YyA9IGNz
Y2hlZDJfdW5pdCh1bml0KTsKIAogICAgIGlmICggIWhhcmQgKQogICAgICAgICByZXR1cm47CkBA
IC0zMTEzLDcgKzMxMTEsNyBAQCBzdGF0aWMgdm9pZAogY3NjaGVkMl91bml0X2luc2VydChjb25z
dCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogewogICAg
IHN0cnVjdCB2Y3B1ICp2YyA9IHVuaXQtPnZjcHU7Ci0gICAgc3RydWN0IGNzY2hlZDJfdmNwdSAq
c3ZjID0gdW5pdC0+cHJpdjsKKyAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMgPSB1bml0LT5w
cml2OwogICAgIHN0cnVjdCBjc2NoZWQyX2RvbSAqIGNvbnN0IHNkb20gPSBzdmMtPnNkb207CiAg
ICAgc3BpbmxvY2tfdCAqbG9jazsKIApAQCAtMzE0NSw3ICszMTQzLDcgQEAgY3NjaGVkMl91bml0
X2luc2VydChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICp1
bml0KQogc3RhdGljIHZvaWQKIGNzY2hlZDJfZnJlZV92ZGF0YShjb25zdCBzdHJ1Y3Qgc2NoZWR1
bGVyICpvcHMsIHZvaWQgKnByaXYpCiB7Ci0gICAgc3RydWN0IGNzY2hlZDJfdmNwdSAqc3ZjID0g
cHJpdjsKKyAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMgPSBwcml2OwogCiAgICAgeGZyZWUo
c3ZjKTsKIH0KQEAgLTMxNTQsNyArMzE1Miw3IEBAIHN0YXRpYyB2b2lkCiBjc2NoZWQyX3VuaXRf
cmVtb3ZlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX3VuaXQgKnVu
aXQpCiB7CiAgICAgc3RydWN0IHZjcHUgKnZjID0gdW5pdC0+dmNwdTsKLSAgICBzdHJ1Y3QgY3Nj
aGVkMl92Y3B1ICogY29uc3Qgc3ZjID0gY3NjaGVkMl92Y3B1KHZjKTsKKyAgICBzdHJ1Y3QgY3Nj
aGVkMl91bml0ICogY29uc3Qgc3ZjID0gY3NjaGVkMl91bml0KHVuaXQpOwogICAgIHNwaW5sb2Nr
X3QgKmxvY2s7CiAKICAgICBBU1NFUlQoIWlzX2lkbGVfdmNwdSh2YykpOwpAQCAtMzE3NSw3ICsz
MTczLDcgQEAgY3NjaGVkMl91bml0X3JlbW92ZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMs
IHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogLyogSG93IGxvbmcgc2hvdWxkIHdlIGxldCB0aGlz
IHZjcHUgcnVuIGZvcj8gKi8KIHN0YXRpYyBzX3RpbWVfdAogY3NjaGVkMl9ydW50aW1lKGNvbnN0
IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgaW50IGNwdSwKLSAgICAgICAgICAgICAgICBzdHJ1Y3Qg
Y3NjaGVkMl92Y3B1ICpzbmV4dCwgc190aW1lX3Qgbm93KQorICAgICAgICAgICAgICAgIHN0cnVj
dCBjc2NoZWQyX3VuaXQgKnNuZXh0LCBzX3RpbWVfdCBub3cpCiB7CiAgICAgc190aW1lX3QgdGlt
ZSwgbWluX3RpbWU7CiAgICAgaW50IHJ0X2NyZWRpdDsgLyogUHJvcG9zZWQgcnVudGltZSBtZWFz
dXJlZCBpbiBjcmVkaXRzICovCkBAIC0zMjIwLDcgKzMyMTgsNyBAQCBjc2NoZWQyX3J1bnRpbWUo
Y29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBpbnQgY3B1LAogICAgICAqLwogICAgIGlmICgg
ISBsaXN0X2VtcHR5KHJ1bnEpICkKICAgICB7Ci0gICAgICAgIHN0cnVjdCBjc2NoZWQyX3ZjcHUg
KnN3YWl0ID0gcnVucV9lbGVtKHJ1bnEtPm5leHQpOworICAgICAgICBzdHJ1Y3QgY3NjaGVkMl91
bml0ICpzd2FpdCA9IHJ1bnFfZWxlbShydW5xLT5uZXh0KTsKIAogICAgICAgICBpZiAoICEgaXNf
aWRsZV92Y3B1KHN3YWl0LT52Y3B1KQogICAgICAgICAgICAgICYmIHN3YWl0LT5jcmVkaXQgPiAw
ICkKQEAgLTMyNzEsMTQgKzMyNjksMTQgQEAgY3NjaGVkMl9ydW50aW1lKGNvbnN0IHN0cnVjdCBz
Y2hlZHVsZXIgKm9wcywgaW50IGNwdSwKIC8qCiAgKiBGaW5kIGEgY2FuZGlkYXRlLgogICovCi1z
dGF0aWMgc3RydWN0IGNzY2hlZDJfdmNwdSAqCitzdGF0aWMgc3RydWN0IGNzY2hlZDJfdW5pdCAq
CiBydW5xX2NhbmRpZGF0ZShzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQsCi0gICAg
ICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpzY3VyciwKKyAgICAgICAgICAgICAgIHN0
cnVjdCBjc2NoZWQyX3VuaXQgKnNjdXJyLAogICAgICAgICAgICAgICAgaW50IGNwdSwgc190aW1l
X3Qgbm93LAogICAgICAgICAgICAgICAgdW5zaWduZWQgaW50ICpza2lwcGVkKQogewogICAgIHN0
cnVjdCBsaXN0X2hlYWQgKml0ZXIsICp0ZW1wOwotICAgIHN0cnVjdCBjc2NoZWQyX3ZjcHUgKnNu
ZXh0ID0gTlVMTDsKKyAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICpzbmV4dCA9IE5VTEw7CiAgICAg
c3RydWN0IGNzY2hlZDJfcHJpdmF0ZSAqcHJ2ID0gY3NjaGVkMl9wcml2KHBlcl9jcHUoc2NoZWR1
bGVyLCBjcHUpKTsKICAgICBib29sIHlpZWxkID0gZmFsc2UsIHNvZnRfYWZmX3ByZWVtcHQgPSBm
YWxzZTsKIApAQCAtMzM1OSwxMiArMzM1NywxMiBAQCBydW5xX2NhbmRpZGF0ZShzdHJ1Y3QgY3Nj
aGVkMl9ydW5xdWV1ZV9kYXRhICpycWQsCiAgICAgaWYgKCB2Y3B1X3J1bm5hYmxlKHNjdXJyLT52
Y3B1KSAmJiAhc29mdF9hZmZfcHJlZW1wdCApCiAgICAgICAgIHNuZXh0ID0gc2N1cnI7CiAgICAg
ZWxzZQotICAgICAgICBzbmV4dCA9IGNzY2hlZDJfdmNwdShpZGxlX3ZjcHVbY3B1XSk7CisgICAg
ICAgIHNuZXh0ID0gY3NjaGVkMl91bml0KGlkbGVfdmNwdVtjcHVdLT5zY2hlZF91bml0KTsKIAog
IGNoZWNrX3J1bnE6CiAgICAgbGlzdF9mb3JfZWFjaF9zYWZlKCBpdGVyLCB0ZW1wLCAmcnFkLT5y
dW5xICkKICAgICB7Ci0gICAgICAgIHN0cnVjdCBjc2NoZWQyX3ZjcHUgKiBzdmMgPSBsaXN0X2Vu
dHJ5KGl0ZXIsIHN0cnVjdCBjc2NoZWQyX3ZjcHUsIHJ1bnFfZWxlbSk7CisgICAgICAgIHN0cnVj
dCBjc2NoZWQyX3VuaXQgKiBzdmMgPSBsaXN0X2VudHJ5KGl0ZXIsIHN0cnVjdCBjc2NoZWQyX3Vu
aXQsIHJ1bnFfZWxlbSk7CiAKICAgICAgICAgaWYgKCB1bmxpa2VseSh0Yl9pbml0X2RvbmUpICkK
ICAgICAgICAgewpAQCAtMzQ2Myw4ICszNDYxLDggQEAgY3NjaGVkMl9zY2hlZHVsZSgKIHsKICAg
ICBjb25zdCBpbnQgY3B1ID0gc21wX3Byb2Nlc3Nvcl9pZCgpOwogICAgIHN0cnVjdCBjc2NoZWQy
X3J1bnF1ZXVlX2RhdGEgKnJxZDsKLSAgICBzdHJ1Y3QgY3NjaGVkMl92Y3B1ICogY29uc3Qgc2N1
cnIgPSBjc2NoZWQyX3ZjcHUoY3VycmVudCk7Ci0gICAgc3RydWN0IGNzY2hlZDJfdmNwdSAqc25l
eHQgPSBOVUxMOworICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKiBjb25zdCBzY3VyciA9IGNzY2hl
ZDJfdW5pdChjdXJyZW50LT5zY2hlZF91bml0KTsKKyAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICpz
bmV4dCA9IE5VTEw7CiAgICAgdW5zaWduZWQgaW50IHNraXBwZWRfdmNwdXMgPSAwOwogICAgIHN0
cnVjdCB0YXNrX3NsaWNlIHJldDsKICAgICBib29sIHRpY2tsZWQ7CkBAIC0zNTQwLDcgKzM1Mzgs
NyBAQCBjc2NoZWQyX3NjaGVkdWxlKAogICAgIHsKICAgICAgICAgX19jbGVhcl9iaXQoX19DU0ZM
QUdfdmNwdV95aWVsZCwgJnNjdXJyLT5mbGFncyk7CiAgICAgICAgIHRyYWNlX3ZhcihUUkNfQ1ND
SEVEMl9TQ0hFRF9UQVNLTEVULCAxLCAwLCBOVUxMKTsKLSAgICAgICAgc25leHQgPSBjc2NoZWQy
X3ZjcHUoaWRsZV92Y3B1W2NwdV0pOworICAgICAgICBzbmV4dCA9IGNzY2hlZDJfdW5pdChpZGxl
X3ZjcHVbY3B1XS0+c2NoZWRfdW5pdCk7CiAgICAgfQogICAgIGVsc2UKICAgICAgICAgc25leHQg
PSBydW5xX2NhbmRpZGF0ZShycWQsIHNjdXJyLCBjcHUsIG5vdywgJnNraXBwZWRfdmNwdXMpOwpA
QCAtMzY0Myw3ICszNjQxLDcgQEAgY3NjaGVkMl9zY2hlZHVsZSgKIH0KIAogc3RhdGljIHZvaWQK
LWNzY2hlZDJfZHVtcF92Y3B1KHN0cnVjdCBjc2NoZWQyX3ByaXZhdGUgKnBydiwgc3RydWN0IGNz
Y2hlZDJfdmNwdSAqc3ZjKQorY3NjaGVkMl9kdW1wX3ZjcHUoc3RydWN0IGNzY2hlZDJfcHJpdmF0
ZSAqcHJ2LCBzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMpCiB7CiAgICAgcHJpbnRrKCJbJWkuJWld
IGZsYWdzPSV4IGNwdT0laSIsCiAgICAgICAgICAgICBzdmMtPnZjcHUtPmRvbWFpbi0+ZG9tYWlu
X2lkLApAQCAtMzY2Nyw3ICszNjY1LDcgQEAgc3RhdGljIGlubGluZSB2b2lkCiBkdW1wX3BjcHUo
Y29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBpbnQgY3B1KQogewogICAgIHN0cnVjdCBjc2No
ZWQyX3ByaXZhdGUgKnBydiA9IGNzY2hlZDJfcHJpdihvcHMpOwotICAgIHN0cnVjdCBjc2NoZWQy
X3ZjcHUgKnN2YzsKKyAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmM7CiAKICAgICBwcmludGso
IkNQVVslMDJkXSBydW5xPSVkLCBzaWJsaW5nPSUqcGIsIGNvcmU9JSpwYlxuIiwKICAgICAgICAg
ICAgY3B1LCBjMnIoY3B1KSwKQEAgLTM2NzUsNyArMzY3Myw3IEBAIGR1bXBfcGNwdShjb25zdCBz
dHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGludCBjcHUpCiAgICAgICAgICAgIG5yX2NwdV9pZHMsIGNw
dW1hc2tfYml0cyhwZXJfY3B1KGNwdV9jb3JlX21hc2ssIGNwdSkpKTsKIAogICAgIC8qIGN1cnJl
bnQgVkNQVSAobm90aGluZyB0byBzYXkgaWYgdGhhdCdzIHRoZSBpZGxlIHZjcHUpICovCi0gICAg
c3ZjID0gY3NjaGVkMl92Y3B1KGN1cnJfb25fY3B1KGNwdSkpOworICAgIHN2YyA9IGNzY2hlZDJf
dW5pdChjdXJyX29uX2NwdShjcHUpKTsKICAgICBpZiAoIHN2YyAmJiAhaXNfaWRsZV92Y3B1KHN2
Yy0+dmNwdSkgKQogICAgIHsKICAgICAgICAgcHJpbnRrKCJcdHJ1bjogIik7CkBAIC0zNzQ4LDcg
KzM3NDYsNyBAQCBjc2NoZWQyX2R1bXAoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzKQogCiAg
ICAgICAgIGZvcl9lYWNoX3ZjcHUoIHNkb20tPmRvbSwgdiApCiAgICAgICAgIHsKLSAgICAgICAg
ICAgIHN0cnVjdCBjc2NoZWQyX3ZjcHUgKiBjb25zdCBzdmMgPSBjc2NoZWQyX3ZjcHUodik7Cisg
ICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICogY29uc3Qgc3ZjID0gY3NjaGVkMl91bml0
KHYtPnNjaGVkX3VuaXQpOwogICAgICAgICAgICAgc3BpbmxvY2tfdCAqbG9jazsKIAogICAgICAg
ICAgICAgbG9jayA9IHZjcHVfc2NoZWR1bGVfbG9jayhzdmMtPnZjcHUpOwpAQCAtMzc3Nyw3ICsz
Nzc1LDcgQEAgY3NjaGVkMl9kdW1wKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcykKICAgICAg
ICAgcHJpbnRrKCJSVU5ROlxuIik7CiAgICAgICAgIGxpc3RfZm9yX2VhY2goIGl0ZXIsIHJ1bnEg
KQogICAgICAgICB7Ci0gICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpzdmMgPSBydW5x
X2VsZW0oaXRlcik7CisgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMgPSBydW5x
X2VsZW0oaXRlcik7CiAKICAgICAgICAgICAgIGlmICggc3ZjICkKICAgICAgICAgICAgIHsKQEAg
LTM4NzgsNyArMzg3Niw3IEBAIGNzY2hlZDJfc3dpdGNoX3NjaGVkKHN0cnVjdCBzY2hlZHVsZXIg
Km5ld19vcHMsIHVuc2lnbmVkIGludCBjcHUsCiAgICAgICAgICAgICAgICAgICAgICB2b2lkICpw
ZGF0YSwgdm9pZCAqdmRhdGEpCiB7CiAgICAgc3RydWN0IGNzY2hlZDJfcHJpdmF0ZSAqcHJ2ID0g
Y3NjaGVkMl9wcml2KG5ld19vcHMpOwotICAgIHN0cnVjdCBjc2NoZWQyX3ZjcHUgKnN2YyA9IHZk
YXRhOworICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YyA9IHZkYXRhOwogICAgIHVuc2lnbmVk
IHJxaTsKIAogICAgIEFTU0VSVChwZGF0YSAmJiBzdmMgJiYgaXNfaWRsZV92Y3B1KHN2Yy0+dmNw
dSkpOwpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZF9udWxsLmMgYi94ZW4vY29tbW9uL3Nj
aGVkX251bGwuYwppbmRleCAxZWE4NjQzYTljLi5kZWZjZGZjZjFlIDEwMDY0NAotLS0gYS94ZW4v
Y29tbW9uL3NjaGVkX251bGwuYworKysgYi94ZW4vY29tbW9uL3NjaGVkX251bGwuYwpAQCAtOTQs
NyArOTQsNyBAQCBERUZJTkVfUEVSX0NQVShzdHJ1Y3QgbnVsbF9wY3B1LCBucGMpOwogLyoKICAq
IFZpcnR1YWwgQ1BVCiAgKi8KLXN0cnVjdCBudWxsX3ZjcHUgeworc3RydWN0IG51bGxfdW5pdCB7
CiAgICAgc3RydWN0IGxpc3RfaGVhZCB3YWl0cV9lbGVtOwogICAgIHN0cnVjdCB2Y3B1ICp2Y3B1
OwogfTsKQEAgLTExNSw5ICsxMTUsOSBAQCBzdGF0aWMgaW5saW5lIHN0cnVjdCBudWxsX3ByaXZh
dGUgKm51bGxfcHJpdihjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMpCiAgICAgcmV0dXJuIG9w
cy0+c2NoZWRfZGF0YTsKIH0KIAotc3RhdGljIGlubGluZSBzdHJ1Y3QgbnVsbF92Y3B1ICpudWxs
X3ZjcHUoY29uc3Qgc3RydWN0IHZjcHUgKnYpCitzdGF0aWMgaW5saW5lIHN0cnVjdCBudWxsX3Vu
aXQgKm51bGxfdW5pdChjb25zdCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIHsKLSAgICByZXR1
cm4gdi0+c2NoZWRfdW5pdC0+cHJpdjsKKyAgICByZXR1cm4gdW5pdC0+cHJpdjsKIH0KIAogc3Rh
dGljIGlubGluZSBib29sIHZjcHVfY2hlY2tfYWZmaW5pdHkoc3RydWN0IHZjcHUgKnYsIHVuc2ln
bmVkIGludCBjcHUsCkBAIC0xOTcsOSArMTk3LDkgQEAgc3RhdGljIHZvaWQgKm51bGxfYWxsb2Nf
dmRhdGEoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQsIHZvaWQgKmRkKQogewogICAgIHN0cnVj
dCB2Y3B1ICp2ID0gdW5pdC0+dmNwdTsKLSAgICBzdHJ1Y3QgbnVsbF92Y3B1ICpudmM7CisgICAg
c3RydWN0IG51bGxfdW5pdCAqbnZjOwogCi0gICAgbnZjID0geHphbGxvYyhzdHJ1Y3QgbnVsbF92
Y3B1KTsKKyAgICBudmMgPSB4emFsbG9jKHN0cnVjdCBudWxsX3VuaXQpOwogICAgIGlmICggbnZj
ID09IE5VTEwgKQogICAgICAgICByZXR1cm4gTlVMTDsKIApAQCAtMjEzLDcgKzIxMyw3IEBAIHN0
YXRpYyB2b2lkICpudWxsX2FsbG9jX3ZkYXRhKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywK
IAogc3RhdGljIHZvaWQgbnVsbF9mcmVlX3ZkYXRhKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9w
cywgdm9pZCAqcHJpdikKIHsKLSAgICBzdHJ1Y3QgbnVsbF92Y3B1ICpudmMgPSBwcml2OworICAg
IHN0cnVjdCBudWxsX3VuaXQgKm52YyA9IHByaXY7CiAKICAgICB4ZnJlZShudmMpOwogfQpAQCAt
MzkxLDcgKzM5MSw3IEBAIHN0YXRpYyBzcGlubG9ja190ICpudWxsX3N3aXRjaF9zY2hlZChzdHJ1
Y3Qgc2NoZWR1bGVyICpuZXdfb3BzLAogewogICAgIHN0cnVjdCBzY2hlZHVsZV9kYXRhICpzZCA9
ICZwZXJfY3B1KHNjaGVkdWxlX2RhdGEsIGNwdSk7CiAgICAgc3RydWN0IG51bGxfcHJpdmF0ZSAq
cHJ2ID0gbnVsbF9wcml2KG5ld19vcHMpOwotICAgIHN0cnVjdCBudWxsX3ZjcHUgKm52YyA9IHZk
YXRhOworICAgIHN0cnVjdCBudWxsX3VuaXQgKm52YyA9IHZkYXRhOwogCiAgICAgQVNTRVJUKG52
YyAmJiBpc19pZGxlX3ZjcHUobnZjLT52Y3B1KSk7CiAKQEAgLTQxNCw3ICs0MTQsNyBAQCBzdGF0
aWMgdm9pZCBudWxsX3VuaXRfaW5zZXJ0KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKIHsK
ICAgICBzdHJ1Y3QgdmNwdSAqdiA9IHVuaXQtPnZjcHU7CiAgICAgc3RydWN0IG51bGxfcHJpdmF0
ZSAqcHJ2ID0gbnVsbF9wcml2KG9wcyk7Ci0gICAgc3RydWN0IG51bGxfdmNwdSAqbnZjID0gbnVs
bF92Y3B1KHYpOworICAgIHN0cnVjdCBudWxsX3VuaXQgKm52YyA9IG51bGxfdW5pdCh1bml0KTsK
ICAgICB1bnNpZ25lZCBpbnQgY3B1OwogICAgIHNwaW5sb2NrX3QgKmxvY2s7CiAKQEAgLTQ3MSw5
ICs0NzEsOSBAQCBzdGF0aWMgdm9pZCBfdmNwdV9yZW1vdmUoc3RydWN0IG51bGxfcHJpdmF0ZSAq
cHJ2LCBzdHJ1Y3QgdmNwdSAqdikKIHsKICAgICB1bnNpZ25lZCBpbnQgYnM7CiAgICAgdW5zaWdu
ZWQgaW50IGNwdSA9IHYtPnByb2Nlc3NvcjsKLSAgICBzdHJ1Y3QgbnVsbF92Y3B1ICp3dmM7Cisg
ICAgc3RydWN0IG51bGxfdW5pdCAqd3ZjOwogCi0gICAgQVNTRVJUKGxpc3RfZW1wdHkoJm51bGxf
dmNwdSh2KS0+d2FpdHFfZWxlbSkpOworICAgIEFTU0VSVChsaXN0X2VtcHR5KCZudWxsX3VuaXQo
di0+c2NoZWRfdW5pdCktPndhaXRxX2VsZW0pKTsKIAogICAgIHZjcHVfZGVhc3NpZ24ocHJ2LCB2
LCBjcHUpOwogCkBAIC01MDksNyArNTA5LDcgQEAgc3RhdGljIHZvaWQgbnVsbF91bml0X3JlbW92
ZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiB7CiAgICAgc3RydWN0IHZjcHUgKnYgPSB1
bml0LT52Y3B1OwogICAgIHN0cnVjdCBudWxsX3ByaXZhdGUgKnBydiA9IG51bGxfcHJpdihvcHMp
OwotICAgIHN0cnVjdCBudWxsX3ZjcHUgKm52YyA9IG51bGxfdmNwdSh2KTsKKyAgICBzdHJ1Y3Qg
bnVsbF91bml0ICpudmMgPSBudWxsX3VuaXQodW5pdCk7CiAgICAgc3BpbmxvY2tfdCAqbG9jazsK
IAogICAgIEFTU0VSVCghaXNfaWRsZV92Y3B1KHYpKTsKQEAgLTU0NCwxMyArNTQ0LDEzIEBAIHN0
YXRpYyB2b2lkIG51bGxfdW5pdF93YWtlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKIAog
ICAgIEFTU0VSVCghaXNfaWRsZV92Y3B1KHYpKTsKIAotICAgIGlmICggdW5saWtlbHkoY3Vycl9v
bl9jcHUodi0+cHJvY2Vzc29yKSA9PSB2KSApCisgICAgaWYgKCB1bmxpa2VseShjdXJyX29uX2Nw
dSh2LT5wcm9jZXNzb3IpID09IHVuaXQpICkKICAgICB7CiAgICAgICAgIFNDSEVEX1NUQVRfQ1JB
TksodmNwdV93YWtlX3J1bm5pbmcpOwogICAgICAgICByZXR1cm47CiAgICAgfQogCi0gICAgaWYg
KCB1bmxpa2VseSghbGlzdF9lbXB0eSgmbnVsbF92Y3B1KHYpLT53YWl0cV9lbGVtKSkgKQorICAg
IGlmICggdW5saWtlbHkoIWxpc3RfZW1wdHkoJm51bGxfdW5pdCh1bml0KS0+d2FpdHFfZWxlbSkp
ICkKICAgICB7CiAgICAgICAgIC8qIE5vdCBleGFjdGx5ICJvbiBydW5xIiwgYnV0IGNsb3NlIGVu
b3VnaCBmb3IgcmV1c2luZyB0aGUgY291bnRlciAqLwogICAgICAgICBTQ0hFRF9TVEFUX0NSQU5L
KHZjcHVfd2FrZV9vbnJ1bnEpOwpAQCAtNTc0LDcgKzU3NCw3IEBAIHN0YXRpYyB2b2lkIG51bGxf
dW5pdF9zbGVlcChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAgICAgQVNTRVJUKCFpc19p
ZGxlX3ZjcHUodikpOwogCiAgICAgLyogSWYgdiBpcyBub3QgYXNzaWduZWQgdG8gYSBwQ1BVLCBv
ciBpcyBub3QgcnVubmluZywgbm8gbmVlZCB0byBib3RoZXIgKi8KLSAgICBpZiAoIGN1cnJfb25f
Y3B1KHYtPnByb2Nlc3NvcikgPT0gdiApCisgICAgaWYgKCBjdXJyX29uX2NwdSh2LT5wcm9jZXNz
b3IpID09IHVuaXQgKQogICAgICAgICBjcHVfcmFpc2Vfc29mdGlycSh2LT5wcm9jZXNzb3IsIFND
SEVEVUxFX1NPRlRJUlEpOwogCiAgICAgU0NIRURfU1RBVF9DUkFOSyh2Y3B1X3NsZWVwKTsKQEAg
LTU5Miw3ICs1OTIsNyBAQCBzdGF0aWMgdm9pZCBudWxsX3VuaXRfbWlncmF0ZShjb25zdCBzdHJ1
Y3Qgc2NoZWR1bGVyICpvcHMsCiB7CiAgICAgc3RydWN0IHZjcHUgKnYgPSB1bml0LT52Y3B1Owog
ICAgIHN0cnVjdCBudWxsX3ByaXZhdGUgKnBydiA9IG51bGxfcHJpdihvcHMpOwotICAgIHN0cnVj
dCBudWxsX3ZjcHUgKm52YyA9IG51bGxfdmNwdSh2KTsKKyAgICBzdHJ1Y3QgbnVsbF91bml0ICpu
dmMgPSBudWxsX3VuaXQodW5pdCk7CiAKICAgICBBU1NFUlQoIWlzX2lkbGVfdmNwdSh2KSk7CiAK
QEAgLTY3Nyw3ICs2NzcsNyBAQCBzdGF0aWMgdm9pZCBudWxsX3VuaXRfbWlncmF0ZShjb25zdCBz
dHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAjaWZuZGVmIE5ERUJVRwogc3RhdGljIGlubGluZSB2b2lk
IG51bGxfdmNwdV9jaGVjayhzdHJ1Y3QgdmNwdSAqdikKIHsKLSAgICBzdHJ1Y3QgbnVsbF92Y3B1
ICogY29uc3QgbnZjID0gbnVsbF92Y3B1KHYpOworICAgIHN0cnVjdCBudWxsX3VuaXQgKiBjb25z
dCBudmMgPSBudWxsX3VuaXQodi0+c2NoZWRfdW5pdCk7CiAgICAgc3RydWN0IG51bGxfZG9tICog
Y29uc3QgbmRvbSA9IHYtPmRvbWFpbi0+c2NoZWRfcHJpdjsKIAogICAgIEJVR19PTihudmMtPnZj
cHUgIT0gdik7CkBAIC03MDcsNyArNzA3LDcgQEAgc3RhdGljIHN0cnVjdCB0YXNrX3NsaWNlIG51
bGxfc2NoZWR1bGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAgIHVuc2lnbmVkIGlu
dCBiczsKICAgICBjb25zdCB1bnNpZ25lZCBpbnQgY3B1ID0gc21wX3Byb2Nlc3Nvcl9pZCgpOwog
ICAgIHN0cnVjdCBudWxsX3ByaXZhdGUgKnBydiA9IG51bGxfcHJpdihvcHMpOwotICAgIHN0cnVj
dCBudWxsX3ZjcHUgKnd2YzsKKyAgICBzdHJ1Y3QgbnVsbF91bml0ICp3dmM7CiAgICAgc3RydWN0
IHRhc2tfc2xpY2UgcmV0OwogCiAgICAgU0NIRURfU1RBVF9DUkFOSyhzY2hlZHVsZSk7CkBAIC03
OTAsNyArNzkwLDcgQEAgc3RhdGljIHN0cnVjdCB0YXNrX3NsaWNlIG51bGxfc2NoZWR1bGUoY29u
c3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAgIHJldHVybiByZXQ7CiB9CiAKLXN0YXRpYyBp
bmxpbmUgdm9pZCBkdW1wX3ZjcHUoc3RydWN0IG51bGxfcHJpdmF0ZSAqcHJ2LCBzdHJ1Y3QgbnVs
bF92Y3B1ICpudmMpCitzdGF0aWMgaW5saW5lIHZvaWQgZHVtcF92Y3B1KHN0cnVjdCBudWxsX3By
aXZhdGUgKnBydiwgc3RydWN0IG51bGxfdW5pdCAqbnZjKQogewogICAgIHByaW50aygiWyVpLiVp
XSBwY3B1PSVkIiwgbnZjLT52Y3B1LT5kb21haW4tPmRvbWFpbl9pZCwKICAgICAgICAgICAgIG52
Yy0+dmNwdS0+dmNwdV9pZCwgbGlzdF9lbXB0eSgmbnZjLT53YWl0cV9lbGVtKSA/CkBAIC04MDAs
NyArODAwLDcgQEAgc3RhdGljIGlubGluZSB2b2lkIGR1bXBfdmNwdShzdHJ1Y3QgbnVsbF9wcml2
YXRlICpwcnYsIHN0cnVjdCBudWxsX3ZjcHUgKm52YykKIHN0YXRpYyB2b2lkIG51bGxfZHVtcF9w
Y3B1KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgaW50IGNwdSkKIHsKICAgICBzdHJ1Y3Qg
bnVsbF9wcml2YXRlICpwcnYgPSBudWxsX3ByaXYob3BzKTsKLSAgICBzdHJ1Y3QgbnVsbF92Y3B1
ICpudmM7CisgICAgc3RydWN0IG51bGxfdW5pdCAqbnZjOwogICAgIHNwaW5sb2NrX3QgKmxvY2s7
CiAgICAgdW5zaWduZWQgbG9uZyBmbGFnczsKIApAQCAtODE1LDcgKzgxNSw3IEBAIHN0YXRpYyB2
b2lkIG51bGxfZHVtcF9wY3B1KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgaW50IGNwdSkK
ICAgICBwcmludGsoIlxuIik7CiAKICAgICAvKiBjdXJyZW50IFZDUFUgKG5vdGhpbmcgdG8gc2F5
IGlmIHRoYXQncyB0aGUgaWRsZSB2Y3B1KSAqLwotICAgIG52YyA9IG51bGxfdmNwdShjdXJyX29u
X2NwdShjcHUpKTsKKyAgICBudmMgPSBudWxsX3VuaXQoY3Vycl9vbl9jcHUoY3B1KSk7CiAgICAg
aWYgKCBudmMgJiYgIWlzX2lkbGVfdmNwdShudmMtPnZjcHUpICkKICAgICB7CiAgICAgICAgIHBy
aW50aygiXHRydW46ICIpOwpAQCAtODQ5LDcgKzg0OSw3IEBAIHN0YXRpYyB2b2lkIG51bGxfZHVt
cChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMpCiAgICAgICAgIHByaW50aygiXHREb21haW46
ICVkXG4iLCBuZG9tLT5kb20tPmRvbWFpbl9pZCk7CiAgICAgICAgIGZvcl9lYWNoX3ZjcHUoIG5k
b20tPmRvbSwgdiApCiAgICAgICAgIHsKLSAgICAgICAgICAgIHN0cnVjdCBudWxsX3ZjcHUgKiBj
b25zdCBudmMgPSBudWxsX3ZjcHUodik7CisgICAgICAgICAgICBzdHJ1Y3QgbnVsbF91bml0ICog
Y29uc3QgbnZjID0gbnVsbF91bml0KHYtPnNjaGVkX3VuaXQpOwogICAgICAgICAgICAgc3Bpbmxv
Y2tfdCAqbG9jazsKIAogICAgICAgICAgICAgbG9jayA9IHZjcHVfc2NoZWR1bGVfbG9jayhudmMt
PnZjcHUpOwpAQCAtODY3LDcgKzg2Nyw3IEBAIHN0YXRpYyB2b2lkIG51bGxfZHVtcChjb25zdCBz
dHJ1Y3Qgc2NoZWR1bGVyICpvcHMpCiAgICAgc3Bpbl9sb2NrKCZwcnYtPndhaXRxX2xvY2spOwog
ICAgIGxpc3RfZm9yX2VhY2goIGl0ZXIsICZwcnYtPndhaXRxICkKICAgICB7Ci0gICAgICAgIHN0
cnVjdCBudWxsX3ZjcHUgKm52YyA9IGxpc3RfZW50cnkoaXRlciwgc3RydWN0IG51bGxfdmNwdSwg
d2FpdHFfZWxlbSk7CisgICAgICAgIHN0cnVjdCBudWxsX3VuaXQgKm52YyA9IGxpc3RfZW50cnko
aXRlciwgc3RydWN0IG51bGxfdW5pdCwgd2FpdHFfZWxlbSk7CiAKICAgICAgICAgaWYgKCBsb29w
KysgIT0gMCApCiAgICAgICAgICAgICBwcmludGsoIiwgIik7CmRpZmYgLS1naXQgYS94ZW4vY29t
bW9uL3NjaGVkX3J0LmMgYi94ZW4vY29tbW9uL3NjaGVkX3J0LmMKaW5kZXggYjgwYmMwMjM1Ny4u
OGNhZWM1YzVkYyAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9zY2hlZF9ydC5jCisrKyBiL3hlbi9j
b21tb24vc2NoZWRfcnQuYwpAQCAtMTk1LDcgKzE5NSw3IEBAIHN0cnVjdCBydF9wcml2YXRlIHsK
IC8qCiAgKiBWaXJ0dWFsIENQVQogICovCi1zdHJ1Y3QgcnRfdmNwdSB7CitzdHJ1Y3QgcnRfdW5p
dCB7CiAgICAgc3RydWN0IGxpc3RfaGVhZCBxX2VsZW07ICAgICAvKiBvbiB0aGUgcnVucS9kZXBs
ZXRlZHEgbGlzdCAqLwogICAgIHN0cnVjdCBsaXN0X2hlYWQgcmVwbHFfZWxlbTsgLyogb24gdGhl
IHJlcGxlbmlzaG1lbnQgZXZlbnRzIGxpc3QgKi8KIApAQCAtMjMzLDkgKzIzMyw5IEBAIHN0YXRp
YyBpbmxpbmUgc3RydWN0IHJ0X3ByaXZhdGUgKnJ0X3ByaXYoY29uc3Qgc3RydWN0IHNjaGVkdWxl
ciAqb3BzKQogICAgIHJldHVybiBvcHMtPnNjaGVkX2RhdGE7CiB9CiAKLXN0YXRpYyBpbmxpbmUg
c3RydWN0IHJ0X3ZjcHUgKnJ0X3ZjcHUoY29uc3Qgc3RydWN0IHZjcHUgKnZjcHUpCitzdGF0aWMg
aW5saW5lIHN0cnVjdCBydF91bml0ICpydF91bml0KGNvbnN0IHN0cnVjdCBzY2hlZF91bml0ICp1
bml0KQogewotICAgIHJldHVybiB2Y3B1LT5zY2hlZF91bml0LT5wcml2OworICAgIHJldHVybiB1
bml0LT5wcml2OwogfQogCiBzdGF0aWMgaW5saW5lIHN0cnVjdCBsaXN0X2hlYWQgKnJ0X3J1bnEo
Y29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzKQpAQCAtMjUzLDcgKzI1Myw3IEBAIHN0YXRpYyBp
bmxpbmUgc3RydWN0IGxpc3RfaGVhZCAqcnRfcmVwbHEoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAq
b3BzKQogICAgIHJldHVybiAmcnRfcHJpdihvcHMpLT5yZXBscTsKIH0KIAotc3RhdGljIGlubGlu
ZSBib29sIGhhc19leHRyYXRpbWUoY29uc3Qgc3RydWN0IHJ0X3ZjcHUgKnN2YykKK3N0YXRpYyBp
bmxpbmUgYm9vbCBoYXNfZXh0cmF0aW1lKGNvbnN0IHN0cnVjdCBydF91bml0ICpzdmMpCiB7CiAg
ICAgcmV0dXJuIHN2Yy0+ZmxhZ3MgJiBSVERTX2V4dHJhdGltZTsKIH0KQEAgLTI2MywyNSArMjYz
LDI1IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBoYXNfZXh0cmF0aW1lKGNvbnN0IHN0cnVjdCBydF92
Y3B1ICpzdmMpCiAgKiBhbmQgdGhlIHJlcGxlbmlzaG1lbnQgZXZlbnRzIHF1ZXVlLgogICovCiBz
dGF0aWMgaW50Ci12Y3B1X29uX3EoY29uc3Qgc3RydWN0IHJ0X3ZjcHUgKnN2YykKK3ZjcHVfb25f
cShjb25zdCBzdHJ1Y3QgcnRfdW5pdCAqc3ZjKQogewogICAgcmV0dXJuICFsaXN0X2VtcHR5KCZz
dmMtPnFfZWxlbSk7CiB9CiAKLXN0YXRpYyBzdHJ1Y3QgcnRfdmNwdSAqCitzdGF0aWMgc3RydWN0
IHJ0X3VuaXQgKgogcV9lbGVtKHN0cnVjdCBsaXN0X2hlYWQgKmVsZW0pCiB7Ci0gICAgcmV0dXJu
IGxpc3RfZW50cnkoZWxlbSwgc3RydWN0IHJ0X3ZjcHUsIHFfZWxlbSk7CisgICAgcmV0dXJuIGxp
c3RfZW50cnkoZWxlbSwgc3RydWN0IHJ0X3VuaXQsIHFfZWxlbSk7CiB9CiAKLXN0YXRpYyBzdHJ1
Y3QgcnRfdmNwdSAqCitzdGF0aWMgc3RydWN0IHJ0X3VuaXQgKgogcmVwbHFfZWxlbShzdHJ1Y3Qg
bGlzdF9oZWFkICplbGVtKQogewotICAgIHJldHVybiBsaXN0X2VudHJ5KGVsZW0sIHN0cnVjdCBy
dF92Y3B1LCByZXBscV9lbGVtKTsKKyAgICByZXR1cm4gbGlzdF9lbnRyeShlbGVtLCBzdHJ1Y3Qg
cnRfdW5pdCwgcmVwbHFfZWxlbSk7CiB9CiAKIHN0YXRpYyBpbnQKLXZjcHVfb25fcmVwbHEoY29u
c3Qgc3RydWN0IHJ0X3ZjcHUgKnN2YykKK3ZjcHVfb25fcmVwbHEoY29uc3Qgc3RydWN0IHJ0X3Vu
aXQgKnN2YykKIHsKICAgICByZXR1cm4gIWxpc3RfZW1wdHkoJnN2Yy0+cmVwbHFfZWxlbSk7CiB9
CkBAIC0yOTEsNyArMjkxLDcgQEAgdmNwdV9vbl9yZXBscShjb25zdCBzdHJ1Y3QgcnRfdmNwdSAq
c3ZjKQogICogT3RoZXJ3aXNlLCByZXR1cm4gdmFsdWUgPCAwCiAgKi8KIHN0YXRpYyBzX3RpbWVf
dAotY29tcGFyZV92Y3B1X3ByaW9yaXR5KGNvbnN0IHN0cnVjdCBydF92Y3B1ICp2MSwgY29uc3Qg
c3RydWN0IHJ0X3ZjcHUgKnYyKQorY29tcGFyZV92Y3B1X3ByaW9yaXR5KGNvbnN0IHN0cnVjdCBy
dF91bml0ICp2MSwgY29uc3Qgc3RydWN0IHJ0X3VuaXQgKnYyKQogewogICAgIGludCBwcmlvID0g
djItPnByaW9yaXR5X2xldmVsIC0gdjEtPnByaW9yaXR5X2xldmVsOwogCkBAIC0zMDUsNyArMzA1
LDcgQEAgY29tcGFyZV92Y3B1X3ByaW9yaXR5KGNvbnN0IHN0cnVjdCBydF92Y3B1ICp2MSwgY29u
c3Qgc3RydWN0IHJ0X3ZjcHUgKnYyKQogICogRGVidWcgcmVsYXRlZCBjb2RlLCBkdW1wIHZjcHUv
Y3B1IGluZm9ybWF0aW9uCiAgKi8KIHN0YXRpYyB2b2lkCi1ydF9kdW1wX3ZjcHUoY29uc3Qgc3Ry
dWN0IHNjaGVkdWxlciAqb3BzLCBjb25zdCBzdHJ1Y3QgcnRfdmNwdSAqc3ZjKQorcnRfZHVtcF92
Y3B1KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgY29uc3Qgc3RydWN0IHJ0X3VuaXQgKnN2
YykKIHsKICAgICBjcHVtYXNrX3QgKmNwdXBvb2xfbWFzaywgKm1hc2s7CiAKQEAgLTM1MiwxMyAr
MzUyLDEzIEBAIHN0YXRpYyB2b2lkCiBydF9kdW1wX3BjcHUoY29uc3Qgc3RydWN0IHNjaGVkdWxl
ciAqb3BzLCBpbnQgY3B1KQogewogICAgIHN0cnVjdCBydF9wcml2YXRlICpwcnYgPSBydF9wcml2
KG9wcyk7Ci0gICAgc3RydWN0IHJ0X3ZjcHUgKnN2YzsKKyAgICBzdHJ1Y3QgcnRfdW5pdCAqc3Zj
OwogICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAKICAgICBzcGluX2xvY2tfaXJxc2F2ZSgmcHJ2
LT5sb2NrLCBmbGFncyk7CiAgICAgcHJpbnRrKCJDUFVbJTAyZF1cbiIsIGNwdSk7CiAgICAgLyog
Y3VycmVudCBWQ1BVIChub3RoaW5nIHRvIHNheSBpZiB0aGF0J3MgdGhlIGlkbGUgdmNwdSkuICov
Ci0gICAgc3ZjID0gcnRfdmNwdShjdXJyX29uX2NwdShjcHUpKTsKKyAgICBzdmMgPSBydF91bml0
KGN1cnJfb25fY3B1KGNwdSkpOwogICAgIGlmICggc3ZjICYmICFpc19pZGxlX3ZjcHUoc3ZjLT52
Y3B1KSApCiAgICAgewogICAgICAgICBydF9kdW1wX3ZjcHUob3BzLCBzdmMpOwpAQCAtMzcxLDcg
KzM3MSw3IEBAIHJ0X2R1bXAoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzKQogewogICAgIHN0
cnVjdCBsaXN0X2hlYWQgKnJ1bnEsICpkZXBsZXRlZHEsICpyZXBscSwgKml0ZXI7CiAgICAgc3Ry
dWN0IHJ0X3ByaXZhdGUgKnBydiA9IHJ0X3ByaXYob3BzKTsKLSAgICBzdHJ1Y3QgcnRfdmNwdSAq
c3ZjOworICAgIHN0cnVjdCBydF91bml0ICpzdmM7CiAgICAgc3RydWN0IHJ0X2RvbSAqc2RvbTsK
ICAgICB1bnNpZ25lZCBsb25nIGZsYWdzOwogCkBAIC00MTUsNyArNDE1LDcgQEAgcnRfZHVtcChj
b25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMpCiAKICAgICAgICAgZm9yX2VhY2hfdmNwdSAoIHNk
b20tPmRvbSwgdiApCiAgICAgICAgIHsKLSAgICAgICAgICAgIHN2YyA9IHJ0X3ZjcHUodik7Cisg
ICAgICAgICAgICBzdmMgPSBydF91bml0KHYtPnNjaGVkX3VuaXQpOwogICAgICAgICAgICAgcnRf
ZHVtcF92Y3B1KG9wcywgc3ZjKTsKICAgICAgICAgfQogICAgIH0KQEAgLTQyOSw3ICs0MjksNyBA
QCBydF9kdW1wKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcykKICAqIGl0IG5lZWRzIHRvIGJl
IHVwZGF0ZWQgdG8gdGhlIGRlYWRsaW5lIG9mIHRoZSBjdXJyZW50IHBlcmlvZAogICovCiBzdGF0
aWMgdm9pZAotcnRfdXBkYXRlX2RlYWRsaW5lKHNfdGltZV90IG5vdywgc3RydWN0IHJ0X3ZjcHUg
KnN2YykKK3J0X3VwZGF0ZV9kZWFkbGluZShzX3RpbWVfdCBub3csIHN0cnVjdCBydF91bml0ICpz
dmMpCiB7CiAgICAgQVNTRVJUKG5vdyA+PSBzdmMtPmN1cl9kZWFkbGluZSk7CiAgICAgQVNTRVJU
KHN2Yy0+cGVyaW9kICE9IDApOwpAQCAtNTAwLDggKzUwMCw4IEBAIGRlYWRsaW5lX3F1ZXVlX3Jl
bW92ZShzdHJ1Y3QgbGlzdF9oZWFkICpxdWV1ZSwgc3RydWN0IGxpc3RfaGVhZCAqZWxlbSkKIH0K
IAogc3RhdGljIGlubGluZSBib29sCi1kZWFkbGluZV9xdWV1ZV9pbnNlcnQoc3RydWN0IHJ0X3Zj
cHUgKiAoKnFlbGVtKShzdHJ1Y3QgbGlzdF9oZWFkICopLAotICAgICAgICAgICAgICAgICAgICAg
IHN0cnVjdCBydF92Y3B1ICpzdmMsIHN0cnVjdCBsaXN0X2hlYWQgKmVsZW0sCitkZWFkbGluZV9x
dWV1ZV9pbnNlcnQoc3RydWN0IHJ0X3VuaXQgKiAoKnFlbGVtKShzdHJ1Y3QgbGlzdF9oZWFkICop
LAorICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBydF91bml0ICpzdmMsIHN0cnVjdCBsaXN0
X2hlYWQgKmVsZW0sCiAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGxpc3RfaGVhZCAqcXVl
dWUpCiB7CiAgICAgc3RydWN0IGxpc3RfaGVhZCAqaXRlcjsKQEAgLTUwOSw3ICs1MDksNyBAQCBk
ZWFkbGluZV9xdWV1ZV9pbnNlcnQoc3RydWN0IHJ0X3ZjcHUgKiAoKnFlbGVtKShzdHJ1Y3QgbGlz
dF9oZWFkICopLAogCiAgICAgbGlzdF9mb3JfZWFjaCAoIGl0ZXIsIHF1ZXVlICkKICAgICB7Ci0g
ICAgICAgIHN0cnVjdCBydF92Y3B1ICogaXRlcl9zdmMgPSAoKnFlbGVtKShpdGVyKTsKKyAgICAg
ICAgc3RydWN0IHJ0X3VuaXQgKiBpdGVyX3N2YyA9ICgqcWVsZW0pKGl0ZXIpOwogICAgICAgICBp
ZiAoIGNvbXBhcmVfdmNwdV9wcmlvcml0eShzdmMsIGl0ZXJfc3ZjKSA+IDAgKQogICAgICAgICAg
ICAgYnJlYWs7CiAgICAgICAgIHBvcysrOwpAQCAtNTIzLDE0ICs1MjMsMTQgQEAgZGVhZGxpbmVf
cXVldWVfaW5zZXJ0KHN0cnVjdCBydF92Y3B1ICogKCpxZWxlbSkoc3RydWN0IGxpc3RfaGVhZCAq
KSwKICAgZGVhZGxpbmVfcXVldWVfaW5zZXJ0KCZyZXBscV9lbGVtLCAjI19fVkFfQVJHU19fKQog
CiBzdGF0aWMgaW5saW5lIHZvaWQKLXFfcmVtb3ZlKHN0cnVjdCBydF92Y3B1ICpzdmMpCitxX3Jl
bW92ZShzdHJ1Y3QgcnRfdW5pdCAqc3ZjKQogewogICAgIEFTU0VSVCggdmNwdV9vbl9xKHN2Yykg
KTsKICAgICBsaXN0X2RlbF9pbml0KCZzdmMtPnFfZWxlbSk7CiB9CiAKIHN0YXRpYyBpbmxpbmUg
dm9pZAotcmVwbHFfcmVtb3ZlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHJ0
X3ZjcHUgKnN2YykKK3JlcGxxX3JlbW92ZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0
cnVjdCBydF91bml0ICpzdmMpCiB7CiAgICAgc3RydWN0IHJ0X3ByaXZhdGUgKnBydiA9IHJ0X3By
aXYob3BzKTsKICAgICBzdHJ1Y3QgbGlzdF9oZWFkICpyZXBscSA9IHJ0X3JlcGxxKG9wcyk7CkBA
IC01NDcsNyArNTQ3LDcgQEAgcmVwbHFfcmVtb3ZlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9w
cywgc3RydWN0IHJ0X3ZjcHUgKnN2YykKICAgICAgICAgICovCiAgICAgICAgIGlmICggIWxpc3Rf
ZW1wdHkocmVwbHEpICkKICAgICAgICAgewotICAgICAgICAgICAgc3RydWN0IHJ0X3ZjcHUgKnN2
Y19uZXh0ID0gcmVwbHFfZWxlbShyZXBscS0+bmV4dCk7CisgICAgICAgICAgICBzdHJ1Y3QgcnRf
dW5pdCAqc3ZjX25leHQgPSByZXBscV9lbGVtKHJlcGxxLT5uZXh0KTsKICAgICAgICAgICAgIHNl
dF90aW1lcigmcHJ2LT5yZXBsX3RpbWVyLCBzdmNfbmV4dC0+Y3VyX2RlYWRsaW5lKTsKICAgICAg
ICAgfQogICAgICAgICBlbHNlCkBAIC01NjEsNyArNTYxLDcgQEAgcmVwbHFfcmVtb3ZlKGNvbnN0
IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHJ0X3ZjcHUgKnN2YykKICAqIEluc2VydCBz
dmMgd2l0aG91dCBidWRnZXQgaW4gRGVwbGV0ZWRRIHVuc29ydGVkOwogICovCiBzdGF0aWMgdm9p
ZAotcnVucV9pbnNlcnQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgcnRfdmNw
dSAqc3ZjKQorcnVucV9pbnNlcnQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qg
cnRfdW5pdCAqc3ZjKQogewogICAgIHN0cnVjdCBydF9wcml2YXRlICpwcnYgPSBydF9wcml2KG9w
cyk7CiAgICAgc3RydWN0IGxpc3RfaGVhZCAqcnVucSA9IHJ0X3J1bnEob3BzKTsKQEAgLTU3OSw3
ICs1NzksNyBAQCBydW5xX2luc2VydChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVj
dCBydF92Y3B1ICpzdmMpCiB9CiAKIHN0YXRpYyB2b2lkCi1yZXBscV9pbnNlcnQoY29uc3Qgc3Ry
dWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgcnRfdmNwdSAqc3ZjKQorcmVwbHFfaW5zZXJ0KGNv
bnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHJ0X3VuaXQgKnN2YykKIHsKICAgICBz
dHJ1Y3QgbGlzdF9oZWFkICpyZXBscSA9IHJ0X3JlcGxxKG9wcyk7CiAgICAgc3RydWN0IHJ0X3By
aXZhdGUgKnBydiA9IHJ0X3ByaXYob3BzKTsKQEAgLTYwMSwxMCArNjAxLDEwIEBAIHJlcGxxX2lu
c2VydChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBydF92Y3B1ICpzdmMpCiAg
KiBjaGFuZ2VkLgogICovCiBzdGF0aWMgdm9pZAotcmVwbHFfcmVpbnNlcnQoY29uc3Qgc3RydWN0
IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgcnRfdmNwdSAqc3ZjKQorcmVwbHFfcmVpbnNlcnQoY29u
c3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgcnRfdW5pdCAqc3ZjKQogewogICAgIHN0
cnVjdCBsaXN0X2hlYWQgKnJlcGxxID0gcnRfcmVwbHEob3BzKTsKLSAgICBzdHJ1Y3QgcnRfdmNw
dSAqcmVhcm1fc3ZjID0gc3ZjOworICAgIHN0cnVjdCBydF91bml0ICpyZWFybV9zdmMgPSBzdmM7
CiAgICAgYm9vbF90IHJlYXJtID0gMDsKIAogICAgIEFTU0VSVCggdmNwdV9vbl9yZXBscShzdmMp
ICk7CkBAIC03MzUsNyArNzM1LDcgQEAgcnRfc3dpdGNoX3NjaGVkKHN0cnVjdCBzY2hlZHVsZXIg
Km5ld19vcHMsIHVuc2lnbmVkIGludCBjcHUsCiAgICAgICAgICAgICAgICAgdm9pZCAqcGRhdGEs
IHZvaWQgKnZkYXRhKQogewogICAgIHN0cnVjdCBydF9wcml2YXRlICpwcnYgPSBydF9wcml2KG5l
d19vcHMpOwotICAgIHN0cnVjdCBydF92Y3B1ICpzdmMgPSB2ZGF0YTsKKyAgICBzdHJ1Y3QgcnRf
dW5pdCAqc3ZjID0gdmRhdGE7CiAKICAgICBBU1NFUlQoIXBkYXRhICYmIHN2YyAmJiBpc19pZGxl
X3ZjcHUoc3ZjLT52Y3B1KSk7CiAKQEAgLTg0MiwxMCArODQyLDEwIEBAIHN0YXRpYyB2b2lkICoK
IHJ0X2FsbG9jX3ZkYXRhKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVk
X3VuaXQgKnVuaXQsIHZvaWQgKmRkKQogewogICAgIHN0cnVjdCB2Y3B1ICp2YyA9IHVuaXQtPnZj
cHU7Ci0gICAgc3RydWN0IHJ0X3ZjcHUgKnN2YzsKKyAgICBzdHJ1Y3QgcnRfdW5pdCAqc3ZjOwog
CiAgICAgLyogQWxsb2NhdGUgcGVyLVZDUFUgaW5mbyAqLwotICAgIHN2YyA9IHh6YWxsb2Moc3Ry
dWN0IHJ0X3ZjcHUpOworICAgIHN2YyA9IHh6YWxsb2Moc3RydWN0IHJ0X3VuaXQpOwogICAgIGlm
ICggc3ZjID09IE5VTEwgKQogICAgICAgICByZXR1cm4gTlVMTDsKIApAQCAtODcwLDcgKzg3MCw3
IEBAIHJ0X2FsbG9jX3ZkYXRhKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNj
aGVkX3VuaXQgKnVuaXQsIHZvaWQgKmRkKQogc3RhdGljIHZvaWQKIHJ0X2ZyZWVfdmRhdGEoY29u
c3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCB2b2lkICpwcml2KQogewotICAgIHN0cnVjdCBydF92
Y3B1ICpzdmMgPSBwcml2OworICAgIHN0cnVjdCBydF91bml0ICpzdmMgPSBwcml2OwogCiAgICAg
eGZyZWUoc3ZjKTsKIH0KQEAgLTg4Niw3ICs4ODYsNyBAQCBzdGF0aWMgdm9pZAogcnRfdW5pdF9p
bnNlcnQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5p
dCkKIHsKICAgICBzdHJ1Y3QgdmNwdSAqdmMgPSB1bml0LT52Y3B1OwotICAgIHN0cnVjdCBydF92
Y3B1ICpzdmMgPSBydF92Y3B1KHZjKTsKKyAgICBzdHJ1Y3QgcnRfdW5pdCAqc3ZjID0gcnRfdW5p
dCh1bml0KTsKICAgICBzX3RpbWVfdCBub3c7CiAgICAgc3BpbmxvY2tfdCAqbG9jazsKIApAQCAt
OTE1LDEzICs5MTUsMTMgQEAgcnRfdW5pdF9pbnNlcnQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAq
b3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIH0KIAogLyoKLSAqIFJlbW92ZSBydF92Y3B1
IHN2YyBmcm9tIHRoZSBvbGQgc2NoZWR1bGVyIGluIHNvdXJjZSBjcHVwb29sLgorICogUmVtb3Zl
IHJ0X3VuaXQgc3ZjIGZyb20gdGhlIG9sZCBzY2hlZHVsZXIgaW4gc291cmNlIGNwdXBvb2wuCiAg
Ki8KIHN0YXRpYyB2b2lkCiBydF91bml0X3JlbW92ZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpv
cHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogewogICAgIHN0cnVjdCB2Y3B1ICp2YyA9IHVu
aXQtPnZjcHU7Ci0gICAgc3RydWN0IHJ0X3ZjcHUgKiBjb25zdCBzdmMgPSBydF92Y3B1KHZjKTsK
KyAgICBzdHJ1Y3QgcnRfdW5pdCAqIGNvbnN0IHN2YyA9IHJ0X3VuaXQodW5pdCk7CiAgICAgc3Ry
dWN0IHJ0X2RvbSAqIGNvbnN0IHNkb20gPSBzdmMtPnNkb207CiAgICAgc3BpbmxvY2tfdCAqbG9j
azsKIApAQCAtOTQzLDcgKzk0Myw3IEBAIHJ0X3VuaXRfcmVtb3ZlKGNvbnN0IHN0cnVjdCBzY2hl
ZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiAgKiBCdXJuIGJ1ZGdldCBpbiBu
YW5vc2Vjb25kIGdyYW51bGFyaXR5CiAgKi8KIHN0YXRpYyB2b2lkCi1idXJuX2J1ZGdldChjb25z
dCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBydF92Y3B1ICpzdmMsIHNfdGltZV90IG5v
dykKK2J1cm5fYnVkZ2V0KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHJ0X3Vu
aXQgKnN2Yywgc190aW1lX3Qgbm93KQogewogICAgIHNfdGltZV90IGRlbHRhOwogCkBAIC0xMDA3
LDEzICsxMDA3LDEzIEBAIGJ1cm5fYnVkZ2V0KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywg
c3RydWN0IHJ0X3ZjcHUgKnN2Yywgc190aW1lX3Qgbm93KQogICogUnVuUSBpcyBzb3J0ZWQuIFBp
Y2sgZmlyc3Qgb25lIHdpdGhpbiBjcHVtYXNrLiBJZiBubyBvbmUsIHJldHVybiBOVUxMCiAgKiBs
b2NrIGlzIGdyYWJiZWQgYmVmb3JlIGNhbGxpbmcgdGhpcyBmdW5jdGlvbgogICovCi1zdGF0aWMg
c3RydWN0IHJ0X3ZjcHUgKgorc3RhdGljIHN0cnVjdCBydF91bml0ICoKIHJ1bnFfcGljayhjb25z
dCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGNvbnN0IGNwdW1hc2tfdCAqbWFzaykKIHsKICAgICBz
dHJ1Y3QgbGlzdF9oZWFkICpydW5xID0gcnRfcnVucShvcHMpOwogICAgIHN0cnVjdCBsaXN0X2hl
YWQgKml0ZXI7Ci0gICAgc3RydWN0IHJ0X3ZjcHUgKnN2YyA9IE5VTEw7Ci0gICAgc3RydWN0IHJ0
X3ZjcHUgKml0ZXJfc3ZjID0gTlVMTDsKKyAgICBzdHJ1Y3QgcnRfdW5pdCAqc3ZjID0gTlVMTDsK
KyAgICBzdHJ1Y3QgcnRfdW5pdCAqaXRlcl9zdmMgPSBOVUxMOwogICAgIGNwdW1hc2tfdCBjcHVf
Y29tbW9uOwogICAgIGNwdW1hc2tfdCAqb25saW5lOwogCkBAIC0xMDY0LDggKzEwNjQsOCBAQCBy
dF9zY2hlZHVsZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHNfdGltZV90IG5vdywgYm9v
bF90IHRhc2tsZXRfd29ya19zY2hlZAogewogICAgIGNvbnN0IGludCBjcHUgPSBzbXBfcHJvY2Vz
c29yX2lkKCk7CiAgICAgc3RydWN0IHJ0X3ByaXZhdGUgKnBydiA9IHJ0X3ByaXYob3BzKTsKLSAg
ICBzdHJ1Y3QgcnRfdmNwdSAqY29uc3Qgc2N1cnIgPSBydF92Y3B1KGN1cnJlbnQpOwotICAgIHN0
cnVjdCBydF92Y3B1ICpzbmV4dCA9IE5VTEw7CisgICAgc3RydWN0IHJ0X3VuaXQgKmNvbnN0IHNj
dXJyID0gcnRfdW5pdChjdXJyZW50LT5zY2hlZF91bml0KTsKKyAgICBzdHJ1Y3QgcnRfdW5pdCAq
c25leHQgPSBOVUxMOwogICAgIHN0cnVjdCB0YXNrX3NsaWNlIHJldCA9IHsgLm1pZ3JhdGVkID0g
MCB9OwogCiAgICAgLyogVFJBQ0UgKi8KQEAgLTEwOTEsMTMgKzEwOTEsMTMgQEAgcnRfc2NoZWR1
bGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzX3RpbWVfdCBub3csIGJvb2xfdCB0YXNr
bGV0X3dvcmtfc2NoZWQKICAgICBpZiAoIHRhc2tsZXRfd29ya19zY2hlZHVsZWQgKQogICAgIHsK
ICAgICAgICAgdHJhY2VfdmFyKFRSQ19SVERTX1NDSEVEX1RBU0tMRVQsIDEsIDAsICBOVUxMKTsK
LSAgICAgICAgc25leHQgPSBydF92Y3B1KGlkbGVfdmNwdVtjcHVdKTsKKyAgICAgICAgc25leHQg
PSBydF91bml0KGlkbGVfdmNwdVtjcHVdLT5zY2hlZF91bml0KTsKICAgICB9CiAgICAgZWxzZQog
ICAgIHsKICAgICAgICAgc25leHQgPSBydW5xX3BpY2sob3BzLCBjcHVtYXNrX29mKGNwdSkpOwog
ICAgICAgICBpZiAoIHNuZXh0ID09IE5VTEwgKQotICAgICAgICAgICAgc25leHQgPSBydF92Y3B1
KGlkbGVfdmNwdVtjcHVdKTsKKyAgICAgICAgICAgIHNuZXh0ID0gcnRfdW5pdChpZGxlX3ZjcHVb
Y3B1XS0+c2NoZWRfdW5pdCk7CiAKICAgICAgICAgLyogaWYgc2N1cnIgaGFzIGhpZ2hlciBwcmlv
cml0eSBhbmQgYnVkZ2V0LCBzdGlsbCBwaWNrIHNjdXJyICovCiAgICAgICAgIGlmICggIWlzX2lk
bGVfdmNwdShjdXJyZW50KSAmJgpAQCAtMTE0MywxMiArMTE0MywxMiBAQCBzdGF0aWMgdm9pZAog
cnRfdW5pdF9zbGVlcChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91
bml0ICp1bml0KQogewogICAgIHN0cnVjdCB2Y3B1ICp2YyA9IHVuaXQtPnZjcHU7Ci0gICAgc3Ry
dWN0IHJ0X3ZjcHUgKiBjb25zdCBzdmMgPSBydF92Y3B1KHZjKTsKKyAgICBzdHJ1Y3QgcnRfdW5p
dCAqIGNvbnN0IHN2YyA9IHJ0X3VuaXQodW5pdCk7CiAKICAgICBCVUdfT04oIGlzX2lkbGVfdmNw
dSh2YykgKTsKICAgICBTQ0hFRF9TVEFUX0NSQU5LKHZjcHVfc2xlZXApOwogCi0gICAgaWYgKCBj
dXJyX29uX2NwdSh2Yy0+cHJvY2Vzc29yKSA9PSB2YyApCisgICAgaWYgKCBjdXJyX29uX2NwdSh2
Yy0+cHJvY2Vzc29yKSA9PSB1bml0ICkKICAgICAgICAgY3B1X3JhaXNlX3NvZnRpcnEodmMtPnBy
b2Nlc3NvciwgU0NIRURVTEVfU09GVElSUSk7CiAgICAgZWxzZSBpZiAoIHZjcHVfb25fcShzdmMp
ICkKICAgICB7CkBAIC0xMTc4LDExICsxMTc4LDExIEBAIHJ0X3VuaXRfc2xlZXAoY29uc3Qgc3Ry
dWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKICAqIGxvY2sgaXMg
Z3JhYmJlZCBiZWZvcmUgY2FsbGluZyB0aGlzIGZ1bmN0aW9uCiAgKi8KIHN0YXRpYyB2b2lkCi1y
dW5xX3RpY2tsZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBydF92Y3B1ICpu
ZXcpCitydW5xX3RpY2tsZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBydF91
bml0ICpuZXcpCiB7CiAgICAgc3RydWN0IHJ0X3ByaXZhdGUgKnBydiA9IHJ0X3ByaXYob3BzKTsK
LSAgICBzdHJ1Y3QgcnRfdmNwdSAqbGF0ZXN0X2RlYWRsaW5lX3ZjcHUgPSBOVUxMOyAvKiBsb3dl
c3QgcHJpb3JpdHkgKi8KLSAgICBzdHJ1Y3QgcnRfdmNwdSAqaXRlcl9zdmM7CisgICAgc3RydWN0
IHJ0X3VuaXQgKmxhdGVzdF9kZWFkbGluZV92Y3B1ID0gTlVMTDsgLyogbG93ZXN0IHByaW9yaXR5
ICovCisgICAgc3RydWN0IHJ0X3VuaXQgKml0ZXJfc3ZjOwogICAgIHN0cnVjdCB2Y3B1ICppdGVy
X3ZjOwogICAgIGludCBjcHUgPSAwLCBjcHVfdG9fdGlja2xlID0gMDsKICAgICBjcHVtYXNrX3Qg
bm90X3RpY2tsZWQ7CkBAIC0xMjAzLDE0ICsxMjAzLDE0IEBAIHJ1bnFfdGlja2xlKGNvbnN0IHN0
cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHJ0X3ZjcHUgKm5ldykKICAgICBjcHUgPSBjcHVt
YXNrX3Rlc3Rfb3JfY3ljbGUobmV3LT52Y3B1LT5wcm9jZXNzb3IsICZub3RfdGlja2xlZCk7CiAg
ICAgd2hpbGUgKCBjcHUhPSBucl9jcHVfaWRzICkKICAgICB7Ci0gICAgICAgIGl0ZXJfdmMgPSBj
dXJyX29uX2NwdShjcHUpOworICAgICAgICBpdGVyX3ZjID0gY3Vycl9vbl9jcHUoY3B1KS0+dmNw
dTsKICAgICAgICAgaWYgKCBpc19pZGxlX3ZjcHUoaXRlcl92YykgKQogICAgICAgICB7CiAgICAg
ICAgICAgICBTQ0hFRF9TVEFUX0NSQU5LKHRpY2tsZWRfaWRsZV9jcHUpOwogICAgICAgICAgICAg
Y3B1X3RvX3RpY2tsZSA9IGNwdTsKICAgICAgICAgICAgIGdvdG8gb3V0OwogICAgICAgICB9Ci0g
ICAgICAgIGl0ZXJfc3ZjID0gcnRfdmNwdShpdGVyX3ZjKTsKKyAgICAgICAgaXRlcl9zdmMgPSBy
dF91bml0KGl0ZXJfdmMtPnNjaGVkX3VuaXQpOwogICAgICAgICBpZiAoIGxhdGVzdF9kZWFkbGlu
ZV92Y3B1ID09IE5VTEwgfHwKICAgICAgICAgICAgICBjb21wYXJlX3ZjcHVfcHJpb3JpdHkoaXRl
cl9zdmMsIGxhdGVzdF9kZWFkbGluZV92Y3B1KSA8IDAgKQogICAgICAgICAgICAgbGF0ZXN0X2Rl
YWRsaW5lX3ZjcHUgPSBpdGVyX3N2YzsKQEAgLTEyNTksMTMgKzEyNTksMTMgQEAgc3RhdGljIHZv
aWQKIHJ0X3VuaXRfd2FrZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hl
ZF91bml0ICp1bml0KQogewogICAgIHN0cnVjdCB2Y3B1ICp2YyA9IHVuaXQtPnZjcHU7Ci0gICAg
c3RydWN0IHJ0X3ZjcHUgKiBjb25zdCBzdmMgPSBydF92Y3B1KHZjKTsKKyAgICBzdHJ1Y3QgcnRf
dW5pdCAqIGNvbnN0IHN2YyA9IHJ0X3VuaXQodW5pdCk7CiAgICAgc190aW1lX3Qgbm93OwogICAg
IGJvb2xfdCBtaXNzZWQ7CiAKICAgICBCVUdfT04oIGlzX2lkbGVfdmNwdSh2YykgKTsKIAotICAg
IGlmICggdW5saWtlbHkoY3Vycl9vbl9jcHUodmMtPnByb2Nlc3NvcikgPT0gdmMpICkKKyAgICBp
ZiAoIHVubGlrZWx5KGN1cnJfb25fY3B1KHZjLT5wcm9jZXNzb3IpID09IHVuaXQpICkKICAgICB7
CiAgICAgICAgIFNDSEVEX1NUQVRfQ1JBTksodmNwdV93YWtlX3J1bm5pbmcpOwogICAgICAgICBy
ZXR1cm47CkBAIC0xMzMwLDcgKzEzMzAsNyBAQCBzdGF0aWMgdm9pZAogcnRfY29udGV4dF9zYXZl
ZChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQog
ewogICAgIHN0cnVjdCB2Y3B1ICp2YyA9IHVuaXQtPnZjcHU7Ci0gICAgc3RydWN0IHJ0X3ZjcHUg
KnN2YyA9IHJ0X3ZjcHUodmMpOworICAgIHN0cnVjdCBydF91bml0ICpzdmMgPSBydF91bml0KHVu
aXQpOwogICAgIHNwaW5sb2NrX3QgKmxvY2sgPSB2Y3B1X3NjaGVkdWxlX2xvY2tfaXJxKHZjKTsK
IAogICAgIF9fY2xlYXJfYml0KF9fUlREU19zY2hlZHVsZWQsICZzdmMtPmZsYWdzKTsKQEAgLTEz
NjEsNyArMTM2MSw3IEBAIHJ0X2RvbV9jbnRsKAogICAgIHN0cnVjdCB4ZW5fZG9tY3RsX3NjaGVk
dWxlcl9vcCAqb3ApCiB7CiAgICAgc3RydWN0IHJ0X3ByaXZhdGUgKnBydiA9IHJ0X3ByaXYob3Bz
KTsKLSAgICBzdHJ1Y3QgcnRfdmNwdSAqc3ZjOworICAgIHN0cnVjdCBydF91bml0ICpzdmM7CiAg
ICAgc3RydWN0IHZjcHUgKnY7CiAgICAgdW5zaWduZWQgbG9uZyBmbGFnczsKICAgICBpbnQgcmMg
PSAwOwpAQCAtMTM4NSw3ICsxMzg1LDcgQEAgcnRfZG9tX2NudGwoCiAgICAgICAgIHNwaW5fbG9j
a19pcnFzYXZlKCZwcnYtPmxvY2ssIGZsYWdzKTsKICAgICAgICAgZm9yX2VhY2hfdmNwdSAoIGQs
IHYgKQogICAgICAgICB7Ci0gICAgICAgICAgICBzdmMgPSBydF92Y3B1KHYpOworICAgICAgICAg
ICAgc3ZjID0gcnRfdW5pdCh2LT5zY2hlZF91bml0KTsKICAgICAgICAgICAgIHN2Yy0+cGVyaW9k
ID0gTUlDUk9TRUNTKG9wLT51LnJ0ZHMucGVyaW9kKTsgLyogdHJhbnNmZXIgdG8gbmFub3NlYyAq
LwogICAgICAgICAgICAgc3ZjLT5idWRnZXQgPSBNSUNST1NFQ1Mob3AtPnUucnRkcy5idWRnZXQp
OwogICAgICAgICB9CkBAIC0xNDExLDcgKzE0MTEsNyBAQCBydF9kb21fY250bCgKICAgICAgICAg
ICAgIGlmICggb3AtPmNtZCA9PSBYRU5fRE9NQ1RMX1NDSEVET1BfZ2V0dmNwdWluZm8gKQogICAg
ICAgICAgICAgewogICAgICAgICAgICAgICAgIHNwaW5fbG9ja19pcnFzYXZlKCZwcnYtPmxvY2ss
IGZsYWdzKTsKLSAgICAgICAgICAgICAgICBzdmMgPSBydF92Y3B1KGQtPnZjcHVbbG9jYWxfc2No
ZWQudmNwdWlkXSk7CisgICAgICAgICAgICAgICAgc3ZjID0gcnRfdW5pdChkLT52Y3B1W2xvY2Fs
X3NjaGVkLnZjcHVpZF0tPnNjaGVkX3VuaXQpOwogICAgICAgICAgICAgICAgIGxvY2FsX3NjaGVk
LnUucnRkcy5idWRnZXQgPSBzdmMtPmJ1ZGdldCAvIE1JQ1JPU0VDUygxKTsKICAgICAgICAgICAg
ICAgICBsb2NhbF9zY2hlZC51LnJ0ZHMucGVyaW9kID0gc3ZjLT5wZXJpb2QgLyBNSUNST1NFQ1Mo
MSk7CiAgICAgICAgICAgICAgICAgaWYgKCBoYXNfZXh0cmF0aW1lKHN2YykgKQpAQCAtMTQzOSw3
ICsxNDM5LDcgQEAgcnRfZG9tX2NudGwoCiAgICAgICAgICAgICAgICAgfQogCiAgICAgICAgICAg
ICAgICAgc3Bpbl9sb2NrX2lycXNhdmUoJnBydi0+bG9jaywgZmxhZ3MpOwotICAgICAgICAgICAg
ICAgIHN2YyA9IHJ0X3ZjcHUoZC0+dmNwdVtsb2NhbF9zY2hlZC52Y3B1aWRdKTsKKyAgICAgICAg
ICAgICAgICBzdmMgPSBydF91bml0KGQtPnZjcHVbbG9jYWxfc2NoZWQudmNwdWlkXS0+c2NoZWRf
dW5pdCk7CiAgICAgICAgICAgICAgICAgc3ZjLT5wZXJpb2QgPSBwZXJpb2Q7CiAgICAgICAgICAg
ICAgICAgc3ZjLT5idWRnZXQgPSBidWRnZXQ7CiAgICAgICAgICAgICAgICAgaWYgKCBsb2NhbF9z
Y2hlZC51LnJ0ZHMuZmxhZ3MgJiBYRU5fRE9NQ1RMX1NDSEVEUlRfZXh0cmEgKQpAQCAtMTQ3Miw3
ICsxNDcyLDcgQEAgc3RhdGljIHZvaWQgcmVwbF90aW1lcl9oYW5kbGVyKHZvaWQgKmRhdGEpewog
ICAgIHN0cnVjdCBsaXN0X2hlYWQgKnJlcGxxID0gcnRfcmVwbHEob3BzKTsKICAgICBzdHJ1Y3Qg
bGlzdF9oZWFkICpydW5xID0gcnRfcnVucShvcHMpOwogICAgIHN0cnVjdCBsaXN0X2hlYWQgKml0
ZXIsICp0bXA7Ci0gICAgc3RydWN0IHJ0X3ZjcHUgKnN2YzsKKyAgICBzdHJ1Y3QgcnRfdW5pdCAq
c3ZjOwogICAgIExJU1RfSEVBRCh0bXBfcmVwbHEpOwogCiAgICAgc3Bpbl9sb2NrX2lycSgmcHJ2
LT5sb2NrKTsKQEAgLTE1MTQsMTAgKzE1MTQsMTAgQEAgc3RhdGljIHZvaWQgcmVwbF90aW1lcl9o
YW5kbGVyKHZvaWQgKmRhdGEpewogICAgIHsKICAgICAgICAgc3ZjID0gcmVwbHFfZWxlbShpdGVy
KTsKIAotICAgICAgICBpZiAoIGN1cnJfb25fY3B1KHN2Yy0+dmNwdS0+cHJvY2Vzc29yKSA9PSBz
dmMtPnZjcHUgJiYKKyAgICAgICAgaWYgKCBjdXJyX29uX2NwdShzdmMtPnZjcHUtPnByb2Nlc3Nv
cikgPT0gc3ZjLT52Y3B1LT5zY2hlZF91bml0ICYmCiAgICAgICAgICAgICAgIWxpc3RfZW1wdHko
cnVucSkgKQogICAgICAgICB7Ci0gICAgICAgICAgICBzdHJ1Y3QgcnRfdmNwdSAqbmV4dF9vbl9y
dW5xID0gcV9lbGVtKHJ1bnEtPm5leHQpOworICAgICAgICAgICAgc3RydWN0IHJ0X3VuaXQgKm5l
eHRfb25fcnVucSA9IHFfZWxlbShydW5xLT5uZXh0KTsKIAogICAgICAgICAgICAgaWYgKCBjb21w
YXJlX3ZjcHVfcHJpb3JpdHkoc3ZjLCBuZXh0X29uX3J1bnEpIDwgMCApCiAgICAgICAgICAgICAg
ICAgcnVucV90aWNrbGUob3BzLCBuZXh0X29uX3J1bnEpOwpkaWZmIC0tZ2l0IGEveGVuL2NvbW1v
bi9zY2hlZHVsZS5jIGIveGVuL2NvbW1vbi9zY2hlZHVsZS5jCmluZGV4IDVkZmRhYWVjZTIuLmMw
Y2VjMGI2Y2EgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWR1bGUuYworKysgYi94ZW4vY29t
bW9uL3NjaGVkdWxlLmMKQEAgLTMzNCw3ICszMzQsNyBAQCBpbnQgc2NoZWRfaW5pdF92Y3B1KHN0
cnVjdCB2Y3B1ICp2LCB1bnNpZ25lZCBpbnQgcHJvY2Vzc29yKQogICAgIC8qIElkbGUgVkNQVXMg
YXJlIHNjaGVkdWxlZCBpbW1lZGlhdGVseSwgc28gZG9uJ3QgcHV0IHRoZW0gaW4gcnVucXVldWUu
ICovCiAgICAgaWYgKCBpc19pZGxlX2RvbWFpbihkKSApCiAgICAgewotICAgICAgICBwZXJfY3B1
KHNjaGVkdWxlX2RhdGEsIHYtPnByb2Nlc3NvcikuY3VyciA9IHY7CisgICAgICAgIHBlcl9jcHUo
c2NoZWR1bGVfZGF0YSwgdi0+cHJvY2Vzc29yKS5jdXJyID0gdW5pdDsKICAgICAgICAgdi0+aXNf
cnVubmluZyA9IDE7CiAgICAgfQogICAgIGVsc2UKQEAgLTE1MTMsNyArMTUxMyw3IEBAIHN0YXRp
YyB2b2lkIHNjaGVkdWxlKHZvaWQpCiAKICAgICBuZXh0ID0gbmV4dF9zbGljZS50YXNrOwogCi0g
ICAgc2QtPmN1cnIgPSBuZXh0OworICAgIHNkLT5jdXJyID0gbmV4dC0+c2NoZWRfdW5pdDsKIAog
ICAgIGlmICggbmV4dF9zbGljZS50aW1lID49IDAgKSAvKiAtdmUgbWVhbnMgbm8gbGltaXQgKi8K
ICAgICAgICAgc2V0X3RpbWVyKCZzZC0+c190aW1lciwgbm93ICsgbmV4dF9zbGljZS50aW1lKTsK
QEAgLTE2MzYsNyArMTYzNiw2IEBAIHN0YXRpYyBpbnQgY3B1X3NjaGVkdWxlX3VwKHVuc2lnbmVk
IGludCBjcHUpCiAgICAgcGVyX2NwdShzY2hlZHVsZXIsIGNwdSkgPSAmb3BzOwogICAgIHNwaW5f
bG9ja19pbml0KCZzZC0+X2xvY2spOwogICAgIHNkLT5zY2hlZHVsZV9sb2NrID0gJnNkLT5fbG9j
azsKLSAgICBzZC0+Y3VyciA9IGlkbGVfdmNwdVtjcHVdOwogICAgIGluaXRfdGltZXIoJnNkLT5z
X3RpbWVyLCBzX3RpbWVyX2ZuLCBOVUxMLCBjcHUpOwogICAgIGF0b21pY19zZXQoJnNkLT51cmdl
bnRfY291bnQsIDApOwogCkBAIC0xNjcwLDYgKzE2NjksOCBAQCBzdGF0aWMgaW50IGNwdV9zY2hl
ZHVsZV91cCh1bnNpZ25lZCBpbnQgY3B1KQogICAgIGlmICggaWRsZV92Y3B1W2NwdV0gPT0gTlVM
TCApCiAgICAgICAgIHJldHVybiAtRU5PTUVNOwogCisgICAgc2QtPmN1cnIgPSBpZGxlX3ZjcHVb
Y3B1XS0+c2NoZWRfdW5pdDsKKwogICAgIC8qCiAgICAgICogV2UgZG9uJ3Qgd2FudCB0byByaXNr
IGNhbGxpbmcgeGZyZWUoKSBvbiBhbiBzZC0+c2NoZWRfcHJpdgogICAgICAqIChlLmcuLCBpbnNp
ZGUgZnJlZV9wZGF0YSwgZnJvbSBjcHVfc2NoZWR1bGVfZG93bigpIGNhbGxlZApAQCAtMTg2Myw2
ICsxODY0LDcgQEAgdm9pZCBfX2luaXQgc2NoZWR1bGVyX2luaXQodm9pZCkKICAgICBpZGxlX2Rv
bWFpbi0+bWF4X3ZjcHVzID0gbnJfY3B1X2lkczsKICAgICBpZiAoIHZjcHVfY3JlYXRlKGlkbGVf
ZG9tYWluLCAwLCAwKSA9PSBOVUxMICkKICAgICAgICAgQlVHKCk7CisgICAgdGhpc19jcHUoc2No
ZWR1bGVfZGF0YSkuY3VyciA9IGlkbGVfdmNwdVswXS0+c2NoZWRfdW5pdDsKICAgICB0aGlzX2Nw
dShzY2hlZHVsZV9kYXRhKS5zY2hlZF9wcml2ID0gc2NoZWRfYWxsb2NfcGRhdGEoJm9wcywgMCk7
CiAgICAgQlVHX09OKElTX0VSUih0aGlzX2NwdShzY2hlZHVsZV9kYXRhKS5zY2hlZF9wcml2KSk7
CiAgICAgc2NoZWRfaW5pdF9wZGF0YSgmb3BzLCB0aGlzX2NwdShzY2hlZHVsZV9kYXRhKS5zY2hl
ZF9wcml2LCAwKTsKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5oIGIveGVu
L2luY2x1ZGUveGVuL3NjaGVkLWlmLmgKaW5kZXggZGMxNDliYzEwMi4uOWI3ODU1ZTc3NSAxMDA2
NDQKLS0tIGEveGVuL2luY2x1ZGUveGVuL3NjaGVkLWlmLmgKKysrIGIveGVuL2luY2x1ZGUveGVu
L3NjaGVkLWlmLmgKQEAgLTM2LDcgKzM2LDcgQEAgZXh0ZXJuIGludCBzY2hlZF9yYXRlbGltaXRf
dXM7CiBzdHJ1Y3Qgc2NoZWR1bGVfZGF0YSB7CiAgICAgc3BpbmxvY2tfdCAgICAgICAgICpzY2hl
ZHVsZV9sb2NrLAogICAgICAgICAgICAgICAgICAgICAgICBfbG9jazsKLSAgICBzdHJ1Y3QgdmNw
dSAgICAgICAgKmN1cnI7ICAgICAgICAgICAvKiBjdXJyZW50IHRhc2sgICAgICAgICAgICAgICAg
ICAgICovCisgICAgc3RydWN0IHNjaGVkX3VuaXQgICpjdXJyOyAgICAgICAgICAgLyogY3VycmVu
dCB0YXNrICAgICAgICAgICAgICAgICAgICAqLwogICAgIHZvaWQgICAgICAgICAgICAgICAqc2No
ZWRfcHJpdjsKICAgICBzdHJ1Y3QgdGltZXIgICAgICAgIHNfdGltZXI7ICAgICAgICAvKiBzY2hl
ZHVsaW5nIHRpbWVyICAgICAgICAgICAgICAgICovCiAgICAgYXRvbWljX3QgICAgICAgICAgICB1
cmdlbnRfY291bnQ7ICAgLyogaG93IG1hbnkgdXJnZW50IHZjcHVzICAgICAgICAgICAqLwotLSAK
Mi4xNi40CgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18K
WGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0
cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

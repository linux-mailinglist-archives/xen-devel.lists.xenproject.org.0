Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 02258714F6
	for <lists+xen-devel@lfdr.de>; Tue, 23 Jul 2019 11:24:07 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hpqyo-0003rA-8E; Tue, 23 Jul 2019 09:21:06 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=bPW/=VU=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1hpqym-0003qz-JJ
 for xen-devel@lists.xenproject.org; Tue, 23 Jul 2019 09:21:04 +0000
X-Inumbo-ID: 2f5f1944-ad2b-11e9-9c20-034c0d07280a
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 2f5f1944-ad2b-11e9-9c20-034c0d07280a;
 Tue, 23 Jul 2019 09:21:00 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 59D3DB018;
 Tue, 23 Jul 2019 09:20:59 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Tue, 23 Jul 2019 11:20:56 +0200
Message-Id: <20190723092056.15045-3-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190723092056.15045-1-jgross@suse.com>
References: <20190723092056.15045-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH 2/2] xen: merge temporary vcpu pinning scenarios
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>,
 Dario Faggioli <dfaggioli@suse.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VG9kYXkgdGhlcmUgYXJlIHRocmVlIHNjZW5hcmlvcyB3aGljaCBhcmUgcGlubmluZyB2Y3B1cyB0
ZW1wb3JhcmlseSB0bwphIHNpbmdsZSBwaHlzaWNhbCBjcHU6CgotIE5NSS9NQ0UgaW5qZWN0aW9u
IGludG8gUFYgZG9tYWlucwotIHdhaXRfZXZlbnQoKSBoYW5kbGluZwotIHZjcHVfcGluX292ZXJy
aWRlKCkgaGFuZGxpbmcKCkVhY2ggb2YgdGhvc2UgY2FzZXMgYXJlIGhhbmRsZWQgaW5kZXBlbmRl
bnRseSB0b2RheSB1c2luZyB0aGVpciBvd24KdGVtcG9yYXJ5IGNwdW1hc2sgdG8gc2F2ZSB0aGUg
b2xkIGFmZmluaXR5IHNldHRpbmdzLgoKVGhlIHRocmVlIGNhc2VzIGNhbiBiZSBjb21iaW5lZCBh
cyB0aGUgdHdvIGxhdHRlciBjYXNlcyB3aWxsIG9ubHkgcGluCmEgdmNwdSB0byB0aGUgcGh5c2lj
YWwgY3B1IGl0IGlzIGFscmVhZHkgcnVubmluZyBvbiwgd2hpbGUKdmNwdV9waW5fb3ZlcnJpZGUo
KSBpcyBhbGxvd2VkIHRvIGZhaWwuCgpTbyBtZXJnZSB0aGUgdGhyZWUgdGVtcG9yYXJ5IHBpbm5p
bmcgc2NlbmFyaW9zIGJ5IG9ubHkgdXNpbmcgb25lCmNwdW1hc2sgYW5kIGEgcGVyLXZjcHUgYml0
bWFzayBmb3Igc3BlY2lmeWluZyB3aGljaCBvZiB0aGUgdGhyZWUKc2NlbmFyaW9zIGlzIGN1cnJl
bnRseSBhY3RpdmUgKHRoZXkgYXJlIGFsbG93ZWQgdG8gbmVzdCkuCgpOb3RlIHRoYXQgd2UgZG9u
J3QgbmVlZCB0byBjYWxsIGRvbWFpbl91cGRhdGVfbm9kZV9hZmZpbml0eSgpIGFzIHdlCmFyZSBv
bmx5IHBpbm5pbmcgZm9yIGEgYnJpZWYgcGVyaW9kIG9mIHRpbWUuCgpTaWduZWQtb2ZmLWJ5OiBK
dWVyZ2VuIEdyb3NzIDxqZ3Jvc3NAc3VzZS5jb20+Ci0tLQogeGVuL2FyY2gveDg2L3B2L3RyYXBz
LmMgfCAyMCArLS0tLS0tLS0tLS0tLS0tLS0tLQogeGVuL2FyY2gveDg2L3RyYXBzLmMgICAgfCAg
OCArKy0tLS0tLQogeGVuL2NvbW1vbi9kb21haW4uYyAgICAgfCAgNCArLS0tCiB4ZW4vY29tbW9u
L3NjaGVkdWxlLmMgICB8IDM1ICsrKysrKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tCiB4
ZW4vY29tbW9uL3dhaXQuYyAgICAgICB8IDI2ICsrKysrKysrLS0tLS0tLS0tLS0tLS0tLS0tCiB4
ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaCB8ICA4ICsrKysrLS0tCiA2IGZpbGVzIGNoYW5nZWQsIDQw
IGluc2VydGlvbnMoKyksIDYxIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4
Ni9wdi90cmFwcy5jIGIveGVuL2FyY2gveDg2L3B2L3RyYXBzLmMKaW5kZXggMTc0MDc4NGZmMi4u
MzdkYWMzMDBiYSAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L3B2L3RyYXBzLmMKKysrIGIveGVu
L2FyY2gveDg2L3B2L3RyYXBzLmMKQEAgLTE1MSwyNSArMTUxLDcgQEAgc3RhdGljIHZvaWQgbm1p
X21jZV9zb2Z0aXJxKHZvaWQpCiAKICAgICBCVUdfT04oc3QtPnZjcHUgPT0gTlVMTCk7CiAKLSAg
ICAvKgotICAgICAqIFNldCB0aGUgdG1wIHZhbHVlIHVuY29uZGl0aW9uYWxseSwgc28gdGhhdCB0
aGUgY2hlY2sgaW4gdGhlIGlyZXQKLSAgICAgKiBoeXBlcmNhbGwgd29ya3MuCi0gICAgICovCi0g
ICAgY3B1bWFza19jb3B5KHN0LT52Y3B1LT5jcHVfaGFyZF9hZmZpbml0eV90bXAsCi0gICAgICAg
ICAgICAgICAgIHN0LT52Y3B1LT5jcHVfaGFyZF9hZmZpbml0eSk7Ci0KLSAgICBpZiAoIChjcHUg
IT0gc3QtPnByb2Nlc3NvcikgfHwKLSAgICAgICAgIChzdC0+cHJvY2Vzc29yICE9IHN0LT52Y3B1
LT5wcm9jZXNzb3IpICkKLSAgICB7Ci0KLSAgICAgICAgLyoKLSAgICAgICAgICogV2UgYXJlIG9u
IGEgZGlmZmVyZW50IHBoeXNpY2FsIGNwdS4gIE1ha2Ugc3VyZSB0byB3YWtldXAgdGhlIHZjcHUg
b24KLSAgICAgICAgICogdGhlIHNwZWNpZmllZCBwcm9jZXNzb3IuCi0gICAgICAgICAqLwotICAg
ICAgICB2Y3B1X3NldF9oYXJkX2FmZmluaXR5KHN0LT52Y3B1LCBjcHVtYXNrX29mKHN0LT5wcm9j
ZXNzb3IpKTsKLQotICAgICAgICAvKiBBZmZpbml0eSBpcyByZXN0b3JlZCBpbiB0aGUgaXJldCBo
eXBlcmNhbGwuICovCi0gICAgfQorICAgIHZjcHVfc2V0X3RtcF9hZmZpbml0eShzdC0+dmNwdSwg
c3QtPnByb2Nlc3NvciwgVkNQVV9BRkZJTklUWV9OTUkpOwogCiAgICAgLyoKICAgICAgKiBPbmx5
IHVzZWQgdG8gZGVmZXIgd2FrZXVwIG9mIGRvbWFpbi92Y3B1IHRvIGEgc2FmZSAobm9uLU5NSS9N
Q0UpCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvdHJhcHMuYyBiL3hlbi9hcmNoL3g4Ni90cmFw
cy5jCmluZGV4IDI1YjRiNDdlNWUuLjIyYmI3OTA4NTggMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4
Ni90cmFwcy5jCisrKyBiL3hlbi9hcmNoL3g4Ni90cmFwcy5jCkBAIC0xNjAxLDEyICsxNjAxLDgg
QEAgdm9pZCBhc3luY19leGNlcHRpb25fY2xlYW51cChzdHJ1Y3QgdmNwdSAqY3VycikKICAgICAg
ICAgcmV0dXJuOwogCiAgICAgLyogUmVzdG9yZSBhZmZpbml0eS4gICovCi0gICAgaWYgKCAhY3B1
bWFza19lbXB0eShjdXJyLT5jcHVfaGFyZF9hZmZpbml0eV90bXApICYmCi0gICAgICAgICAhY3B1
bWFza19lcXVhbChjdXJyLT5jcHVfaGFyZF9hZmZpbml0eV90bXAsIGN1cnItPmNwdV9oYXJkX2Fm
ZmluaXR5KSApCi0gICAgewotICAgICAgICB2Y3B1X3NldF9oYXJkX2FmZmluaXR5KGN1cnIsIGN1
cnItPmNwdV9oYXJkX2FmZmluaXR5X3RtcCk7Ci0gICAgICAgIGNwdW1hc2tfY2xlYXIoY3Vyci0+
Y3B1X2hhcmRfYWZmaW5pdHlfdG1wKTsKLSAgICB9CisgICAgaWYgKCBjdXJyLT5hZmZpbml0eV9i
cm9rZW4gJiBWQ1BVX0FGRklOSVRZX05NSSApCisgICAgICAgIHZjcHVfc2V0X3RtcF9hZmZpbml0
eShjdXJyLCAtMSwgVkNQVV9BRkZJTklUWV9OTUkpOwogCiAgICAgaWYgKCAhKGN1cnItPmFzeW5j
X2V4Y2VwdGlvbl9tYXNrICYgKGN1cnItPmFzeW5jX2V4Y2VwdGlvbl9tYXNrIC0gMSkpICkKICAg
ICAgICAgdHJhcCA9IF9fc2NhbmJpdChjdXJyLT5hc3luY19leGNlcHRpb25fbWFzaywgVkNQVV9U
UkFQX05PTkUpOwpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9kb21haW4uYyBiL3hlbi9jb21tb24v
ZG9tYWluLmMKaW5kZXggNTVhYTc1OWI3NS4uZThlODUwNzk2ZSAxMDA2NDQKLS0tIGEveGVuL2Nv
bW1vbi9kb21haW4uYworKysgYi94ZW4vY29tbW9uL2RvbWFpbi5jCkBAIC0xMzMsNyArMTMzLDYg
QEAgc3RhdGljIHZvaWQgdmNwdV9pbmZvX3Jlc2V0KHN0cnVjdCB2Y3B1ICp2KQogc3RhdGljIHZv
aWQgdmNwdV9kZXN0cm95KHN0cnVjdCB2Y3B1ICp2KQogewogICAgIGZyZWVfY3B1bWFza192YXIo
di0+Y3B1X2hhcmRfYWZmaW5pdHkpOwotICAgIGZyZWVfY3B1bWFza192YXIodi0+Y3B1X2hhcmRf
YWZmaW5pdHlfdG1wKTsKICAgICBmcmVlX2NwdW1hc2tfdmFyKHYtPmNwdV9oYXJkX2FmZmluaXR5
X3NhdmVkKTsKICAgICBmcmVlX2NwdW1hc2tfdmFyKHYtPmNwdV9zb2Z0X2FmZmluaXR5KTsKIApA
QCAtMTYxLDcgKzE2MCw2IEBAIHN0cnVjdCB2Y3B1ICp2Y3B1X2NyZWF0ZSgKICAgICBncmFudF90
YWJsZV9pbml0X3ZjcHUodik7CiAKICAgICBpZiAoICF6YWxsb2NfY3B1bWFza192YXIoJnYtPmNw
dV9oYXJkX2FmZmluaXR5KSB8fAotICAgICAgICAgIXphbGxvY19jcHVtYXNrX3Zhcigmdi0+Y3B1
X2hhcmRfYWZmaW5pdHlfdG1wKSB8fAogICAgICAgICAgIXphbGxvY19jcHVtYXNrX3Zhcigmdi0+
Y3B1X2hhcmRfYWZmaW5pdHlfc2F2ZWQpIHx8CiAgICAgICAgICAhemFsbG9jX2NwdW1hc2tfdmFy
KCZ2LT5jcHVfc29mdF9hZmZpbml0eSkgKQogICAgICAgICBnb3RvIGZhaWw7CkBAIC0xMjY5LDcg
KzEyNjcsNyBAQCBpbnQgdmNwdV9yZXNldChzdHJ1Y3QgdmNwdSAqdikKICAgICB2LT5hc3luY19l
eGNlcHRpb25fbWFzayA9IDA7CiAgICAgbWVtc2V0KHYtPmFzeW5jX2V4Y2VwdGlvbl9zdGF0ZSwg
MCwgc2l6ZW9mKHYtPmFzeW5jX2V4Y2VwdGlvbl9zdGF0ZSkpOwogI2VuZGlmCi0gICAgY3B1bWFz
a19jbGVhcih2LT5jcHVfaGFyZF9hZmZpbml0eV90bXApOworICAgIHYtPmFmZmluaXR5X2Jyb2tl
biA9IDA7CiAgICAgY2xlYXJfYml0KF9WUEZfYmxvY2tlZCwgJnYtPnBhdXNlX2ZsYWdzKTsKICAg
ICBjbGVhcl9iaXQoX1ZQRl9pbl9yZXNldCwgJnYtPnBhdXNlX2ZsYWdzKTsKIApkaWZmIC0tZ2l0
IGEveGVuL2NvbW1vbi9zY2hlZHVsZS5jIGIveGVuL2NvbW1vbi9zY2hlZHVsZS5jCmluZGV4IDg5
YmMyNTlhZTQuLmQ0ZGU3NGY5YzggMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWR1bGUuYwor
KysgYi94ZW4vY29tbW9uL3NjaGVkdWxlLmMKQEAgLTExMDYsNDcgKzExMDYsNTggQEAgdm9pZCB3
YXRjaGRvZ19kb21haW5fZGVzdHJveShzdHJ1Y3QgZG9tYWluICpkKQogICAgICAgICBraWxsX3Rp
bWVyKCZkLT53YXRjaGRvZ190aW1lcltpXSk7CiB9CiAKLWludCB2Y3B1X3Bpbl9vdmVycmlkZShz
dHJ1Y3QgdmNwdSAqdiwgaW50IGNwdSkKK2ludCB2Y3B1X3NldF90bXBfYWZmaW5pdHkoc3RydWN0
IHZjcHUgKnYsIGludCBjcHUsIHVpbnQ4X3QgcmVhc29uKQogewogICAgIHNwaW5sb2NrX3QgKmxv
Y2s7CiAgICAgaW50IHJldCA9IC1FSU5WQUw7CisgICAgYm9vbCBtaWdyYXRlOwogCiAgICAgbG9j
ayA9IHZjcHVfc2NoZWR1bGVfbG9ja19pcnEodik7CiAKICAgICBpZiAoIGNwdSA8IDAgKQogICAg
IHsKLSAgICAgICAgaWYgKCB2LT5hZmZpbml0eV9icm9rZW4gKQorICAgICAgICBpZiAoIHYtPmFm
ZmluaXR5X2Jyb2tlbiAmIHJlYXNvbiApCiAgICAgICAgIHsKLSAgICAgICAgICAgIHNjaGVkX3Nl
dF9hZmZpbml0eSh2LCB2LT5jcHVfaGFyZF9hZmZpbml0eV9zYXZlZCwgTlVMTCk7Ci0gICAgICAg
ICAgICB2LT5hZmZpbml0eV9icm9rZW4gPSAwOwogICAgICAgICAgICAgcmV0ID0gMDsKKyAgICAg
ICAgICAgIHYtPmFmZmluaXR5X2Jyb2tlbiAmPSB+cmVhc29uOwogICAgICAgICB9CisgICAgICAg
IGlmICggIXJldCAmJiAhdi0+YWZmaW5pdHlfYnJva2VuICkKKyAgICAgICAgICAgIHNjaGVkX3Nl
dF9hZmZpbml0eSh2LCB2LT5jcHVfaGFyZF9hZmZpbml0eV9zYXZlZCwgTlVMTCk7CiAgICAgfQog
ICAgIGVsc2UgaWYgKCBjcHUgPCBucl9jcHVfaWRzICkKICAgICB7Ci0gICAgICAgIGlmICggdi0+
YWZmaW5pdHlfYnJva2VuICkKKyAgICAgICAgaWYgKCAodi0+YWZmaW5pdHlfYnJva2VuICYgcmVh
c29uKSB8fAorICAgICAgICAgICAgICh2LT5hZmZpbml0eV9icm9rZW4gJiYgdi0+cHJvY2Vzc29y
ICE9IGNwdSkgKQogICAgICAgICAgICAgcmV0ID0gLUVCVVNZOwogICAgICAgICBlbHNlIGlmICgg
Y3B1bWFza190ZXN0X2NwdShjcHUsIFZDUFUyT05MSU5FKHYpKSApCiAgICAgICAgIHsKLSAgICAg
ICAgICAgIGNwdW1hc2tfY29weSh2LT5jcHVfaGFyZF9hZmZpbml0eV9zYXZlZCwgdi0+Y3B1X2hh
cmRfYWZmaW5pdHkpOwotICAgICAgICAgICAgdi0+YWZmaW5pdHlfYnJva2VuID0gMTsKLSAgICAg
ICAgICAgIHNjaGVkX3NldF9hZmZpbml0eSh2LCBjcHVtYXNrX29mKGNwdSksIE5VTEwpOworICAg
ICAgICAgICAgaWYgKCAhdi0+YWZmaW5pdHlfYnJva2VuICkKKyAgICAgICAgICAgIHsKKyAgICAg
ICAgICAgICAgICBjcHVtYXNrX2NvcHkodi0+Y3B1X2hhcmRfYWZmaW5pdHlfc2F2ZWQsIHYtPmNw
dV9oYXJkX2FmZmluaXR5KTsKKyAgICAgICAgICAgICAgICBzY2hlZF9zZXRfYWZmaW5pdHkodiwg
Y3B1bWFza19vZihjcHUpLCBOVUxMKTsKKyAgICAgICAgICAgIH0KKyAgICAgICAgICAgIHYtPmFm
ZmluaXR5X2Jyb2tlbiB8PSByZWFzb247CiAgICAgICAgICAgICByZXQgPSAwOwogICAgICAgICB9
CiAgICAgfQogCi0gICAgaWYgKCByZXQgPT0gMCApCisgICAgbWlncmF0ZSA9ICFyZXQgJiYgIWNw
dW1hc2tfdGVzdF9jcHUodi0+cHJvY2Vzc29yLCB2LT5jcHVfaGFyZF9hZmZpbml0eSk7CisgICAg
aWYgKCBtaWdyYXRlICkKICAgICAgICAgdmNwdV9taWdyYXRlX3N0YXJ0KHYpOwogCiAgICAgdmNw
dV9zY2hlZHVsZV91bmxvY2tfaXJxKGxvY2ssIHYpOwogCi0gICAgZG9tYWluX3VwZGF0ZV9ub2Rl
X2FmZmluaXR5KHYtPmRvbWFpbik7Ci0KLSAgICB2Y3B1X21pZ3JhdGVfZmluaXNoKHYpOworICAg
IGlmICggbWlncmF0ZSApCisgICAgICAgIHZjcHVfbWlncmF0ZV9maW5pc2godik7CiAKICAgICBy
ZXR1cm4gcmV0OwogfQogCitpbnQgdmNwdV9waW5fb3ZlcnJpZGUoc3RydWN0IHZjcHUgKnYsIGlu
dCBjcHUpCit7CisgICAgcmV0dXJuIHZjcHVfc2V0X3RtcF9hZmZpbml0eSh2LCBjcHUsIFZDUFVf
QUZGSU5JVFlfT1ZFUlJJREUpOworfQorCiB0eXBlZGVmIGxvbmcgcmV0X3Q7CiAKICNlbmRpZiAv
KiAhQ09NUEFUICovCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3dhaXQuYyBiL3hlbi9jb21tb24v
d2FpdC5jCmluZGV4IDRmODMwYTE0ZTguLjlmOWFkMDMzYjMgMTAwNjQ0Ci0tLSBhL3hlbi9jb21t
b24vd2FpdC5jCisrKyBiL3hlbi9jb21tb24vd2FpdC5jCkBAIC0zNCw4ICszNCw2IEBAIHN0cnVj
dCB3YWl0cXVldWVfdmNwdSB7CiAgICAgICovCiAgICAgdm9pZCAqZXNwOwogICAgIGNoYXIgKnN0
YWNrOwotICAgIGNwdW1hc2tfdCBzYXZlZF9hZmZpbml0eTsKLSAgICB1bnNpZ25lZCBpbnQgd2Fr
ZXVwX2NwdTsKICNlbmRpZgogfTsKIApAQCAtMTMxLDkgKzEyOSw3IEBAIHN0YXRpYyB2b2lkIF9f
cHJlcGFyZV90b193YWl0KHN0cnVjdCB3YWl0cXVldWVfdmNwdSAqd3F2KQogICAgIEFTU0VSVCh3
cXYtPmVzcCA9PSAwKTsKIAogICAgIC8qIFNhdmUgY3VycmVudCBWQ1BVIGFmZmluaXR5OyBmb3Jj
ZSB3YWtldXAgb24gKnRoaXMqIENQVSBvbmx5LiAqLwotICAgIHdxdi0+d2FrZXVwX2NwdSA9IHNt
cF9wcm9jZXNzb3JfaWQoKTsKLSAgICBjcHVtYXNrX2NvcHkoJndxdi0+c2F2ZWRfYWZmaW5pdHks
IGN1cnItPmNwdV9oYXJkX2FmZmluaXR5KTsKLSAgICBpZiAoIHZjcHVfc2V0X2hhcmRfYWZmaW5p
dHkoY3VyciwgY3B1bWFza19vZih3cXYtPndha2V1cF9jcHUpKSApCisgICAgaWYgKCB2Y3B1X3Nl
dF90bXBfYWZmaW5pdHkoY3Vyciwgc21wX3Byb2Nlc3Nvcl9pZCgpLCBWQ1BVX0FGRklOSVRZX1dB
SVQpICkKICAgICB7CiAgICAgICAgIGdkcHJpbnRrKFhFTkxPR19FUlIsICJVbmFibGUgdG8gc2V0
IHZjcHUgYWZmaW5pdHlcbiIpOwogICAgICAgICBkb21haW5fY3Jhc2goY3VycmVudC0+ZG9tYWlu
KTsKQEAgLTE4MiwzMCArMTc4LDI0IEBAIHN0YXRpYyB2b2lkIF9fcHJlcGFyZV90b193YWl0KHN0
cnVjdCB3YWl0cXVldWVfdmNwdSAqd3F2KQogc3RhdGljIHZvaWQgX19maW5pc2hfd2FpdChzdHJ1
Y3Qgd2FpdHF1ZXVlX3ZjcHUgKndxdikKIHsKICAgICB3cXYtPmVzcCA9IE5VTEw7Ci0gICAgKHZv
aWQpdmNwdV9zZXRfaGFyZF9hZmZpbml0eShjdXJyZW50LCAmd3F2LT5zYXZlZF9hZmZpbml0eSk7
CisgICAgdmNwdV9zZXRfdG1wX2FmZmluaXR5KGN1cnJlbnQsIC0xLCBWQ1BVX0FGRklOSVRZX1dB
SVQpOwogfQogCiB2b2lkIGNoZWNrX3dha2V1cF9mcm9tX3dhaXQodm9pZCkKIHsKLSAgICBzdHJ1
Y3Qgd2FpdHF1ZXVlX3ZjcHUgKndxdiA9IGN1cnJlbnQtPndhaXRxdWV1ZV92Y3B1OworICAgIHN0
cnVjdCB2Y3B1ICpjdXJyID0gY3VycmVudDsKKyAgICBzdHJ1Y3Qgd2FpdHF1ZXVlX3ZjcHUgKndx
diA9IGN1cnItPndhaXRxdWV1ZV92Y3B1OwogCiAgICAgQVNTRVJUKGxpc3RfZW1wdHkoJndxdi0+
bGlzdCkpOwogCiAgICAgaWYgKCBsaWtlbHkod3F2LT5lc3AgPT0gTlVMTCkgKQogICAgICAgICBy
ZXR1cm47CiAKLSAgICAvKiBDaGVjayBpZiB3ZSB3b2tlIHVwIG9uIHRoZSB3cm9uZyBDUFUuICov
Ci0gICAgaWYgKCB1bmxpa2VseShzbXBfcHJvY2Vzc29yX2lkKCkgIT0gd3F2LT53YWtldXBfY3B1
KSApCisgICAgLyogQ2hlY2sgaWYgd2UgYXJlIHN0aWxsIHBpbm5lZC4gKi8KKyAgICBpZiAoIHVu
bGlrZWx5KCEoY3Vyci0+YWZmaW5pdHlfYnJva2VuICYgVkNQVV9BRkZJTklUWV9XQUlUKSkgKQog
ICAgIHsKLSAgICAgICAgLyogUmUtc2V0IFZDUFUgYWZmaW5pdHkgYW5kIHJlLWVudGVyIHRoZSBz
Y2hlZHVsZXIuICovCi0gICAgICAgIHN0cnVjdCB2Y3B1ICpjdXJyID0gY3VycmVudDsKLSAgICAg
ICAgY3B1bWFza19jb3B5KCZ3cXYtPnNhdmVkX2FmZmluaXR5LCBjdXJyLT5jcHVfaGFyZF9hZmZp
bml0eSk7Ci0gICAgICAgIGlmICggdmNwdV9zZXRfaGFyZF9hZmZpbml0eShjdXJyLCBjcHVtYXNr
X29mKHdxdi0+d2FrZXVwX2NwdSkpICkKLSAgICAgICAgewotICAgICAgICAgICAgZ2RwcmludGso
WEVOTE9HX0VSUiwgIlVuYWJsZSB0byBzZXQgdmNwdSBhZmZpbml0eVxuIik7Ci0gICAgICAgICAg
ICBkb21haW5fY3Jhc2goY3VycmVudC0+ZG9tYWluKTsKLSAgICAgICAgfQotICAgICAgICB3YWl0
KCk7IC8qIHRha2VzIHVzIGJhY2sgaW50byB0aGUgc2NoZWR1bGVyICovCisgICAgICAgIGdkcHJp
bnRrKFhFTkxPR19FUlIsICJ2Y3B1IGFmZmluaXR5IGxvc3RcbiIpOworICAgICAgICBkb21haW5f
Y3Jhc2goY3VycmVudC0+ZG9tYWluKTsKICAgICB9CiAKICAgICAvKgpkaWZmIC0tZ2l0IGEveGVu
L2luY2x1ZGUveGVuL3NjaGVkLmggYi94ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaAppbmRleCBiNDBj
OGZkMTM4Li43MjFjNDI5NDU0IDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaAor
KysgYi94ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaApAQCAtMjAwLDcgKzIwMCwxMCBAQCBzdHJ1Y3Qg
dmNwdQogICAgIC8qIFZDUFUgaXMgcGF1c2VkIGZvbGxvd2luZyBzaHV0ZG93biByZXF1ZXN0IChk
LT5pc19zaHV0dGluZ19kb3duKT8gKi8KICAgICBib29sICAgICAgICAgICAgIHBhdXNlZF9mb3Jf
c2h1dGRvd247CiAgICAgLyogVkNQVSBuZWVkIGFmZmluaXR5IHJlc3RvcmVkICovCi0gICAgYm9v
bCAgICAgICAgICAgICBhZmZpbml0eV9icm9rZW47CisgICAgdWludDhfdCAgICAgICAgICBhZmZp
bml0eV9icm9rZW47CisjZGVmaW5lIFZDUFVfQUZGSU5JVFlfT1ZFUlJJREUgICAgMHgwMQorI2Rl
ZmluZSBWQ1BVX0FGRklOSVRZX05NSSAgICAgICAgIDB4MDIKKyNkZWZpbmUgVkNQVV9BRkZJTklU
WV9XQUlUICAgICAgICAweDA0CiAKICAgICAvKiBBIGh5cGVyY2FsbCBoYXMgYmVlbiBwcmVlbXB0
ZWQuICovCiAgICAgYm9vbCAgICAgICAgICAgICBoY2FsbF9wcmVlbXB0ZWQ7CkBAIC0yNDYsOCAr
MjQ5LDYgQEAgc3RydWN0IHZjcHUKICAgICAvKiBCaXRtYXNrIG9mIENQVXMgb24gd2hpY2ggdGhp
cyBWQ1BVIG1heSBydW4uICovCiAgICAgY3B1bWFza192YXJfdCAgICBjcHVfaGFyZF9hZmZpbml0
eTsKICAgICAvKiBVc2VkIHRvIGNoYW5nZSBhZmZpbml0eSB0ZW1wb3JhcmlseS4gKi8KLSAgICBj
cHVtYXNrX3Zhcl90ICAgIGNwdV9oYXJkX2FmZmluaXR5X3RtcDsKLSAgICAvKiBVc2VkIHRvIHJl
c3RvcmUgYWZmaW5pdHkgYWNyb3NzIFMzLiAqLwogICAgIGNwdW1hc2tfdmFyX3QgICAgY3B1X2hh
cmRfYWZmaW5pdHlfc2F2ZWQ7CiAKICAgICAvKiBCaXRtYXNrIG9mIENQVXMgb24gd2hpY2ggdGhp
cyBWQ1BVIHByZWZlcnMgdG8gcnVuLiAqLwpAQCAtODc1LDYgKzg3Niw3IEBAIGludCBjcHVfZGlz
YWJsZV9zY2hlZHVsZXIodW5zaWduZWQgaW50IGNwdSk7CiAvKiBXZSBuZWVkIGl0IGluIGRvbTBf
c2V0dXBfdmNwdSAqLwogdm9pZCBzY2hlZF9zZXRfYWZmaW5pdHkoc3RydWN0IHZjcHUgKnYsIGNv
bnN0IGNwdW1hc2tfdCAqaGFyZCwKICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNwdW1h
c2tfdCAqc29mdCk7CitpbnQgdmNwdV9zZXRfdG1wX2FmZmluaXR5KHN0cnVjdCB2Y3B1ICp2LCBp
bnQgY3B1LCB1aW50OF90IHJlYXNvbik7CiBpbnQgdmNwdV9zZXRfaGFyZF9hZmZpbml0eShzdHJ1
Y3QgdmNwdSAqdiwgY29uc3QgY3B1bWFza190ICphZmZpbml0eSk7CiBpbnQgdmNwdV9zZXRfc29m
dF9hZmZpbml0eShzdHJ1Y3QgdmNwdSAqdiwgY29uc3QgY3B1bWFza190ICphZmZpbml0eSk7CiB2
b2lkIHJlc3RvcmVfdmNwdV9hZmZpbml0eShzdHJ1Y3QgZG9tYWluICpkKTsKLS0gCjIuMTYuNAoK
Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZl
bCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlz
dHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

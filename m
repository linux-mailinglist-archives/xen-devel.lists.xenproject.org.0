Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id EE180150A9E
	for <lists+xen-devel@lfdr.de>; Mon,  3 Feb 2020 17:15:38 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iyeKw-0007aG-BF; Mon, 03 Feb 2020 16:12:34 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=ZuA2=3X=intel.com=tamas.lengyel@srs-us1.protection.inumbo.net>)
 id 1iyeKt-0007Yr-Pa
 for xen-devel@lists.xenproject.org; Mon, 03 Feb 2020 16:12:31 +0000
X-Inumbo-ID: f663d814-469f-11ea-8e75-12813bfff9fa
Received: from mga02.intel.com (unknown [134.134.136.20])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id f663d814-469f-11ea-8e75-12813bfff9fa;
 Mon, 03 Feb 2020 16:12:23 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga001.fm.intel.com ([10.253.24.23])
 by orsmga101.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 03 Feb 2020 08:12:23 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.70,398,1574150400"; d="scan'208";a="337726698"
Received: from kchen27-mobl.amr.corp.intel.com (HELO localhost.localdomain)
 ([10.251.20.224])
 by fmsmga001.fm.intel.com with ESMTP; 03 Feb 2020 08:12:22 -0800
From: Tamas K Lengyel <tamas.lengyel@intel.com>
To: xen-devel@lists.xenproject.org
Date: Mon,  3 Feb 2020 08:12:09 -0800
Message-Id: <73413543304941d06b9d681acc15000027b38a68.1580746020.git.tamas.lengyel@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <cover.1580746020.git.tamas.lengyel@intel.com>
References: <cover.1580746020.git.tamas.lengyel@intel.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v7 7/7] xen/tools: VM forking toolstack side
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Anthony PERARD <anthony.perard@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>,
 Tamas K Lengyel <tamas.lengyel@intel.com>, Wei Liu <wl@xen.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

QWRkIG5lY2Vzc2FyeSBiaXRzIHRvIGltcGxlbWVudCAieGwgZm9yay12bSIgY29tbWFuZHMuIFRo
ZSBjb21tYW5kIGFsbG93cyB0aGUKdXNlciB0byBzcGVjaWZ5IGhvdyB0byBsYXVuY2ggdGhlIGRl
dmljZSBtb2RlbCBhbGxvd2luZyBmb3IgYSBsYXRlLWxhdW5jaCBtb2RlbAppbiB3aGljaCB0aGUg
dXNlciBjYW4gZXhlY3V0ZSB0aGUgZm9yayB3aXRob3V0IHRoZSBkZXZpY2UgbW9kZWwgYW5kIGRl
Y2lkZSB0bwpvbmx5IGxhdGVyIGxhdW5jaCBpdC4KClNpZ25lZC1vZmYtYnk6IFRhbWFzIEsgTGVu
Z3llbCA8dGFtYXMubGVuZ3llbEBpbnRlbC5jb20+Ci0tLQogZG9jcy9tYW4veGwuMS5wb2QuaW4g
ICAgICAgICAgfCAgMzYgKysrKysKIHRvb2xzL2xpYnhjL2luY2x1ZGUveGVuY3RybC5oIHwgIDEz
ICsrCiB0b29scy9saWJ4Yy94Y19tZW1zaHIuYyAgICAgICB8ICAyMiArKysKIHRvb2xzL2xpYnhs
L2xpYnhsLmggICAgICAgICAgIHwgICA3ICsKIHRvb2xzL2xpYnhsL2xpYnhsX2NyZWF0ZS5jICAg
IHwgMjU2ICsrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0KIHRvb2xzL2xpYnhsL2xp
YnhsX2RtLmMgICAgICAgIHwgICAyICstCiB0b29scy9saWJ4bC9saWJ4bF9kb20uYyAgICAgICB8
ICA0MyArKysrKy0KIHRvb2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmggIHwgICAxICsKIHRvb2xz
L2xpYnhsL2xpYnhsX3R5cGVzLmlkbCAgIHwgICAxICsKIHRvb2xzL3hsL3hsLmggICAgICAgICAg
ICAgICAgIHwgICA1ICsKIHRvb2xzL3hsL3hsX2NtZHRhYmxlLmMgICAgICAgIHwgIDEyICsrCiB0
b29scy94bC94bF9zYXZlcmVzdG9yZS5jICAgICB8ICA5NSArKysrKysrKysrKysrCiB0b29scy94
bC94bF92bWNvbnRyb2wuYyAgICAgICB8ICAgOCArKwogMTMgZmlsZXMgY2hhbmdlZCwgNDA3IGlu
c2VydGlvbnMoKyksIDk0IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RvY3MvbWFuL3hsLjEu
cG9kLmluIGIvZG9jcy9tYW4veGwuMS5wb2QuaW4KaW5kZXggMzNhZDJlYmQ3MS4uYzQwMTI5Mzlm
NSAxMDA2NDQKLS0tIGEvZG9jcy9tYW4veGwuMS5wb2QuaW4KKysrIGIvZG9jcy9tYW4veGwuMS5w
b2QuaW4KQEAgLTY5NCw2ICs2OTQsNDIgQEAgTGVhdmUgdGhlIGRvbWFpbiBwYXVzZWQgYWZ0ZXIg
Y3JlYXRpbmcgdGhlIHNuYXBzaG90LgogCiA9YmFjawogCis9aXRlbSBCPGZvcmstdm0+IFtJPE9Q
VElPTlM+XSBJPGRvbWFpbi1pZD4KKworQ3JlYXRlIGEgZm9yayBvZiBhIHJ1bm5pbmcgVk0uIFRo
ZSBkb21haW4gd2lsbCBiZSBwYXVzZWQgYWZ0ZXIgdGhlIG9wZXJhdGlvbgorYW5kIG5lZWRzIHRv
IHJlbWFpbiBwYXVzZWQgd2hpbGUgZm9ya3Mgb2YgaXQgZXhpc3QuCisKK0I8T1BUSU9OUz4KKwor
PW92ZXIgNAorCis9aXRlbSBCPC1wPgorCitMZWF2ZSB0aGUgZm9yayBwYXVzZWQgYWZ0ZXIgY3Jl
YXRpbmcgaXQuCisKKz1pdGVtIEI8LS1sYXVuY2gtZG0+CisKK1NwZWNpZnkgd2hldGhlciB0aGUg
ZGV2aWNlIG1vZGVsIChRRU1VKSBzaG91bGQgYmUgbGF1bmNoZWQgZm9yIHRoZSBmb3JrLiBMYXRl
CitsYXVuY2ggYWxsb3dzIHRvIHN0YXJ0IHRoZSBkZXZpY2UgbW9kZWwgZm9yIGFuIGFscmVhZHkg
cnVubmluZyBmb3JrLgorCis9aXRlbSBCPC1DPgorCitUaGUgY29uZmlnIGZpbGUgdG8gdXNlIHdo
ZW4gbGF1bmNoaW5nIHRoZSBkZXZpY2UgbW9kZWwuIEN1cnJlbnRseSByZXF1aXJlZCB3aGVuCits
YXVuY2hpbmcgdGhlIGRldmljZSBtb2RlbC4KKworPWl0ZW0gQjwtUT4KKworVGhlIHFlbXUgc2F2
ZSBmaWxlIHRvIHVzZSB3aGVuIGxhdW5jaGluZyB0aGUgZGV2aWNlIG1vZGVsLiAgQ3VycmVudGx5
IHJlcXVpcmVkCit3aGVuIGxhdW5jaGluZyB0aGUgZGV2aWNlIG1vZGVsLgorCis9aXRlbSBCPC0t
Zm9yay1yZXNldD4KKworUGVyZm9ybSBhIHJlc2V0IG9wZXJhdGlvbiBvZiBhbiBhbHJlYWR5IHJ1
bm5pbmcgZm9yay4gTm90ZSB0aGF0IHJlc2V0dGluZyBtYXkKK2JlIGxlc3MgcGVyZm9ybWFudCB0
aGVuIGNyZWF0aW5nIGEgbmV3IGZvcmsgZGVwZW5kaW5nIG9uIGhvdyBtdWNoIG1lbW9yeSB0aGUK
K2ZvcmsgaGFzIGRlZHVwbGljYXRlZCBkdXJpbmcgaXRzIHJ1bnRpbWUuCisKKz1iYWNrCisKID1p
dGVtIEI8c2hhcmluZz4gW0k8ZG9tYWluLWlkPl0KIAogRGlzcGxheSB0aGUgbnVtYmVyIG9mIHNo
YXJlZCBwYWdlcyBmb3IgYSBzcGVjaWZpZWQgZG9tYWluLiBJZiBubyBkb21haW4gaXMKZGlmZiAt
LWdpdCBhL3Rvb2xzL2xpYnhjL2luY2x1ZGUveGVuY3RybC5oIGIvdG9vbHMvbGlieGMvaW5jbHVk
ZS94ZW5jdHJsLmgKaW5kZXggY2M0ZWIxZTNkMy4uNmY2NTg4OGRkMCAxMDA2NDQKLS0tIGEvdG9v
bHMvbGlieGMvaW5jbHVkZS94ZW5jdHJsLmgKKysrIGIvdG9vbHMvbGlieGMvaW5jbHVkZS94ZW5j
dHJsLmgKQEAgLTIyMjUsNiArMjIyNSwxOSBAQCBpbnQgeGNfbWVtc2hyX3JhbmdlX3NoYXJlKHhj
X2ludGVyZmFjZSAqeGNoLAogICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50NjRfdCBmaXJz
dF9nZm4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQ2NF90IGxhc3RfZ2ZuKTsKIAor
aW50IHhjX21lbXNocl9mb3JrKHhjX2ludGVyZmFjZSAqeGNoLAorICAgICAgICAgICAgICAgICAg
IHVpbnQzMl90IHNvdXJjZV9kb21haW4sCisgICAgICAgICAgICAgICAgICAgdWludDMyX3QgY2xp
ZW50X2RvbWFpbik7CisKKy8qCisgKiBOb3RlOiB0aGlzIGZ1bmN0aW9uIGlzIG9ubHkgaW50ZW5k
ZWQgdG8gYmUgdXNlZCBvbiBzaG9ydC1saXZlZCBmb3JrcyB0aGF0CisgKiBoYXZlbid0IHlldCBh
cXVpcmVkIGEgbG90IG9mIG1lbW9yeS4gSW4gY2FzZSB0aGUgZm9yayBoYXMgYSBsb3Qgb2YgbWVt
b3J5CisgKiBpdCBpcyBsaWtlbHkgbW9yZSBwZXJmb3JtYW50IHRvIGNyZWF0ZSBhIG5ldyBmb3Jr
IHdpdGggeGNfbWVtc2hyX2ZvcmsuCisgKgorICogV2l0aCBWTXMgdGhhdCBoYXZlIGEgbG90IG9m
IG1lbW9yeSB0aGlzIGNhbGwgbWF5IGJsb2NrIGZvciBhIGxvbmcgdGltZS4KKyAqLworaW50IHhj
X21lbXNocl9mb3JrX3Jlc2V0KHhjX2ludGVyZmFjZSAqeGNoLCB1aW50MzJfdCBmb3JrZWRfZG9t
YWluKTsKKwogLyogRGVidWcgY2FsbHM6IHJldHVybiB0aGUgbnVtYmVyIG9mIHBhZ2VzIHJlZmVy
ZW5jaW5nIHRoZSBzaGFyZWQgZnJhbWUgYmFja2luZwogICogdGhlIGlucHV0IGFyZ3VtZW50LiBT
aG91bGQgYmUgb25lIG9yIGdyZWF0ZXIuCiAgKgpkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGMveGNf
bWVtc2hyLmMgYi90b29scy9saWJ4Yy94Y19tZW1zaHIuYwppbmRleCA5N2UyZTZhOGQ5Li5kMGU0
ZWUyMjViIDEwMDY0NAotLS0gYS90b29scy9saWJ4Yy94Y19tZW1zaHIuYworKysgYi90b29scy9s
aWJ4Yy94Y19tZW1zaHIuYwpAQCAtMjM5LDYgKzIzOSwyOCBAQCBpbnQgeGNfbWVtc2hyX2RlYnVn
X2dyZWYoeGNfaW50ZXJmYWNlICp4Y2gsCiAgICAgcmV0dXJuIHhjX21lbXNocl9tZW1vcCh4Y2gs
IGRvbWlkLCAmbXNvKTsKIH0KIAoraW50IHhjX21lbXNocl9mb3JrKHhjX2ludGVyZmFjZSAqeGNo
LCB1aW50MzJfdCBwZG9taWQsIHVpbnQzMl90IGRvbWlkKQoreworICAgIHhlbl9tZW1fc2hhcmlu
Z19vcF90IG1zbzsKKworICAgIG1lbXNldCgmbXNvLCAwLCBzaXplb2YobXNvKSk7CisKKyAgICBt
c28ub3AgPSBYRU5NRU1fc2hhcmluZ19vcF9mb3JrOworICAgIG1zby51LmZvcmsucGFyZW50X2Rv
bWFpbiA9IHBkb21pZDsKKworICAgIHJldHVybiB4Y19tZW1zaHJfbWVtb3AoeGNoLCBkb21pZCwg
Jm1zbyk7Cit9CisKK2ludCB4Y19tZW1zaHJfZm9ya19yZXNldCh4Y19pbnRlcmZhY2UgKnhjaCwg
dWludDMyX3QgZG9taWQpCit7CisgICAgeGVuX21lbV9zaGFyaW5nX29wX3QgbXNvOworCisgICAg
bWVtc2V0KCZtc28sIDAsIHNpemVvZihtc28pKTsKKyAgICBtc28ub3AgPSBYRU5NRU1fc2hhcmlu
Z19vcF9mb3JrX3Jlc2V0OworCisgICAgcmV0dXJuIHhjX21lbXNocl9tZW1vcCh4Y2gsIGRvbWlk
LCAmbXNvKTsKK30KKwogaW50IHhjX21lbXNocl9hdWRpdCh4Y19pbnRlcmZhY2UgKnhjaCkKIHsK
ICAgICB4ZW5fbWVtX3NoYXJpbmdfb3BfdCBtc287CmRpZmYgLS1naXQgYS90b29scy9saWJ4bC9s
aWJ4bC5oIGIvdG9vbHMvbGlieGwvbGlieGwuaAppbmRleCAxOGMxYTJkNmJmLi4wOTRhYjBkMjA1
IDEwMDY0NAotLS0gYS90b29scy9saWJ4bC9saWJ4bC5oCisrKyBiL3Rvb2xzL2xpYnhsL2xpYnhs
LmgKQEAgLTE1MzgsNiArMTUzOCwxMyBAQCBpbnQgbGlieGxfZG9tYWluX2NyZWF0ZV9uZXcobGli
eGxfY3R4ICpjdHgsIGxpYnhsX2RvbWFpbl9jb25maWcgKmRfY29uZmlnLAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGNvbnN0IGxpYnhsX2FzeW5jb3BfaG93ICphb19ob3csCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGlieGxfYXN5bmNwcm9ncmVzc19ob3cgKmFvcF9j
b25zb2xlX2hvdykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMSUJYTF9FWFRFUk5BTF9D
QUxMRVJTX09OTFk7CitpbnQgbGlieGxfZG9tYWluX2Zvcmtfdm0obGlieGxfY3R4ICpjdHgsIHVp
bnQzMl90IHBkb21pZCwgdWludDMyX3QgKmRvbWlkKQorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBMSUJYTF9FWFRFUk5BTF9DQUxMRVJTX09OTFk7CitpbnQgbGlieGxfZG9tYWluX2Zvcmtf
bGF1bmNoX2RtKGxpYnhsX2N0eCAqY3R4LCBsaWJ4bF9kb21haW5fY29uZmlnICpkX2NvbmZpZywK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgZG9taWQsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxpYnhsX2FzeW5jcHJvZ3Jlc3NfaG93ICph
b3BfY29uc29sZV9ob3cpCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExJQlhMX0VY
VEVSTkFMX0NBTExFUlNfT05MWTsKK2ludCBsaWJ4bF9kb21haW5fZm9ya19yZXNldChsaWJ4bF9j
dHggKmN0eCwgdWludDMyX3QgZG9taWQpOwogaW50IGxpYnhsX2RvbWFpbl9jcmVhdGVfcmVzdG9y
ZShsaWJ4bF9jdHggKmN0eCwgbGlieGxfZG9tYWluX2NvbmZpZyAqZF9jb25maWcsCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90ICpkb21pZCwgaW50IHJlc3RvcmVfZmQs
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBzZW5kX2JhY2tfZmQsCmRpZmYg
LS1naXQgYS90b29scy9saWJ4bC9saWJ4bF9jcmVhdGUuYyBiL3Rvb2xzL2xpYnhsL2xpYnhsX2Ny
ZWF0ZS5jCmluZGV4IDNhNzM2NGUyYWMuLjlkZDk4MDJmYzcgMTAwNjQ0Ci0tLSBhL3Rvb2xzL2xp
YnhsL2xpYnhsX2NyZWF0ZS5jCisrKyBiL3Rvb2xzL2xpYnhsL2xpYnhsX2NyZWF0ZS5jCkBAIC01
MzYsMTIgKzUzNiwxMiBAQCBvdXQ6CiAgICAgcmV0dXJuIHJldDsKIH0KIAotaW50IGxpYnhsX19k
b21haW5fbWFrZShsaWJ4bF9fZ2MgKmdjLCBsaWJ4bF9kb21haW5fY29uZmlnICpkX2NvbmZpZywK
LSAgICAgICAgICAgICAgICAgICAgICAgbGlieGxfX2RvbWFpbl9idWlsZF9zdGF0ZSAqc3RhdGUs
Ci0gICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90ICpkb21pZCwgYm9vbCBzb2Z0X3Jlc2V0
KQorc3RhdGljIGludCBsaWJ4bF9fZG9tYWluX21ha2VfeHNfZW50cmllcyhsaWJ4bF9fZ2MgKmdj
LCBsaWJ4bF9kb21haW5fY29uZmlnICpkX2NvbmZpZywKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgbGlieGxfX2RvbWFpbl9idWlsZF9zdGF0ZSAqc3RhdGUsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90IGRvbWlkKQogewog
ICAgIGxpYnhsX2N0eCAqY3R4ID0gbGlieGxfX2djX293bmVyKGdjKTsKLSAgICBpbnQgcmV0LCBy
YywgbmJfdm07CisgICAgaW50IHJjLCBuYl92bTsKICAgICBjb25zdCBjaGFyICpkb21fdHlwZTsK
ICAgICBjaGFyICp1dWlkX3N0cmluZzsKICAgICBjaGFyICpkb21fcGF0aCwgKnZtX3BhdGgsICps
aWJ4bF9wYXRoOwpAQCAtNTUzLDkgKzU1Myw2IEBAIGludCBsaWJ4bF9fZG9tYWluX21ha2UobGli
eGxfX2djICpnYywgbGlieGxfZG9tYWluX2NvbmZpZyAqZF9jb25maWcsCiAKICAgICAvKiBjb252
ZW5pZW5jZSBhbGlhc2VzICovCiAgICAgbGlieGxfZG9tYWluX2NyZWF0ZV9pbmZvICppbmZvID0g
JmRfY29uZmlnLT5jX2luZm87Ci0gICAgbGlieGxfZG9tYWluX2J1aWxkX2luZm8gKmJfaW5mbyA9
ICZkX2NvbmZpZy0+Yl9pbmZvOwotCi0gICAgYXNzZXJ0KHNvZnRfcmVzZXQgfHwgKmRvbWlkID09
IElOVkFMSURfRE9NSUQpOwogCiAgICAgdXVpZF9zdHJpbmcgPSBsaWJ4bF9fdXVpZDJzdHJpbmco
Z2MsIGluZm8tPnV1aWQpOwogICAgIGlmICghdXVpZF9zdHJpbmcpIHsKQEAgLTU2Myw3MSArNTYw
LDcgQEAgaW50IGxpYnhsX19kb21haW5fbWFrZShsaWJ4bF9fZ2MgKmdjLCBsaWJ4bF9kb21haW5f
Y29uZmlnICpkX2NvbmZpZywKICAgICAgICAgZ290byBvdXQ7CiAgICAgfQogCi0gICAgaWYgKCFz
b2Z0X3Jlc2V0KSB7Ci0gICAgICAgIHN0cnVjdCB4ZW5fZG9tY3RsX2NyZWF0ZWRvbWFpbiBjcmVh
dGUgPSB7Ci0gICAgICAgICAgICAuc3NpZHJlZiA9IGluZm8tPnNzaWRyZWYsCi0gICAgICAgICAg
ICAubWF4X3ZjcHVzID0gYl9pbmZvLT5tYXhfdmNwdXMsCi0gICAgICAgICAgICAubWF4X2V2dGNo
bl9wb3J0ID0gYl9pbmZvLT5ldmVudF9jaGFubmVscywKLSAgICAgICAgICAgIC5tYXhfZ3JhbnRf
ZnJhbWVzID0gYl9pbmZvLT5tYXhfZ3JhbnRfZnJhbWVzLAotICAgICAgICAgICAgLm1heF9tYXB0
cmFja19mcmFtZXMgPSBiX2luZm8tPm1heF9tYXB0cmFja19mcmFtZXMsCi0gICAgICAgIH07Ci0K
LSAgICAgICAgaWYgKGluZm8tPnR5cGUgIT0gTElCWExfRE9NQUlOX1RZUEVfUFYpIHsKLSAgICAg
ICAgICAgIGNyZWF0ZS5mbGFncyB8PSBYRU5fRE9NQ1RMX0NERl9odm07Ci0gICAgICAgICAgICBj
cmVhdGUuZmxhZ3MgfD0KLSAgICAgICAgICAgICAgICBsaWJ4bF9kZWZib29sX3ZhbChpbmZvLT5o
YXApID8gWEVOX0RPTUNUTF9DREZfaGFwIDogMDsKLSAgICAgICAgICAgIGNyZWF0ZS5mbGFncyB8
PQotICAgICAgICAgICAgICAgIGxpYnhsX2RlZmJvb2xfdmFsKGluZm8tPm9vcykgPyAwIDogWEVO
X0RPTUNUTF9DREZfb29zX29mZjsKLSAgICAgICAgfQotCi0gICAgICAgIGFzc2VydChpbmZvLT5w
YXNzdGhyb3VnaCAhPSBMSUJYTF9QQVNTVEhST1VHSF9ERUZBVUxUKTsKLSAgICAgICAgTE9HKERF
VEFJTCwgInBhc3N0aHJvdWdoOiAlcyIsCi0gICAgICAgICAgICBsaWJ4bF9wYXNzdGhyb3VnaF90
b19zdHJpbmcoaW5mby0+cGFzc3Rocm91Z2gpKTsKLQotICAgICAgICBpZiAoaW5mby0+cGFzc3Ro
cm91Z2ggIT0gTElCWExfUEFTU1RIUk9VR0hfRElTQUJMRUQpCi0gICAgICAgICAgICBjcmVhdGUu
ZmxhZ3MgfD0gWEVOX0RPTUNUTF9DREZfaW9tbXU7Ci0KLSAgICAgICAgaWYgKGluZm8tPnBhc3N0
aHJvdWdoID09IExJQlhMX1BBU1NUSFJPVUdIX1NZTkNfUFQpCi0gICAgICAgICAgICBjcmVhdGUu
aW9tbXVfb3B0cyB8PSBYRU5fRE9NQ1RMX0lPTU1VX25vX3NoYXJlcHQ7Ci0KLSAgICAgICAgLyog
VWx0aW1hdGVseSwgaGFuZGxlIGlzIGFuIGFycmF5IG9mIDE2IHVpbnQ4X3QsIHNhbWUgYXMgdXVp
ZCAqLwotICAgICAgICBsaWJ4bF91dWlkX2NvcHkoY3R4LCAobGlieGxfdXVpZCAqKSZjcmVhdGUu
aGFuZGxlLCAmaW5mby0+dXVpZCk7Ci0KLSAgICAgICAgcmV0ID0gbGlieGxfX2FyY2hfZG9tYWlu
X3ByZXBhcmVfY29uZmlnKGdjLCBkX2NvbmZpZywgJmNyZWF0ZSk7Ci0gICAgICAgIGlmIChyZXQg
PCAwKSB7Ci0gICAgICAgICAgICBMT0dFRChFUlJPUiwgKmRvbWlkLCAiZmFpbCB0byBnZXQgZG9t
YWluIGNvbmZpZyIpOwotICAgICAgICAgICAgcmMgPSBFUlJPUl9GQUlMOwotICAgICAgICAgICAg
Z290byBvdXQ7Ci0gICAgICAgIH0KLQotICAgICAgICByZXQgPSB4Y19kb21haW5fY3JlYXRlKGN0
eC0+eGNoLCBkb21pZCwgJmNyZWF0ZSk7Ci0gICAgICAgIGlmIChyZXQgPCAwKSB7Ci0gICAgICAg
ICAgICBMT0dFRChFUlJPUiwgKmRvbWlkLCAiZG9tYWluIGNyZWF0aW9uIGZhaWwiKTsKLSAgICAg
ICAgICAgIHJjID0gRVJST1JfRkFJTDsKLSAgICAgICAgICAgIGdvdG8gb3V0OwotICAgICAgICB9
Ci0KLSAgICAgICAgcmMgPSBsaWJ4bF9fYXJjaF9kb21haW5fc2F2ZV9jb25maWcoZ2MsIGRfY29u
ZmlnLCBzdGF0ZSwgJmNyZWF0ZSk7Ci0gICAgICAgIGlmIChyYyA8IDApCi0gICAgICAgICAgICBn
b3RvIG91dDsKLSAgICB9Ci0KLSAgICAvKgotICAgICAqIElmIHNvZnRfcmVzZXQgaXMgc2V0IHRo
ZSB0aGUgZG9taWQgd2lsbCBoYXZlIGJlZW4gdmFsaWQgb24gZW50cnkuCi0gICAgICogSWYgaXQg
d2FzIG5vdCBzZXQgdGhlbiB4Y19kb21haW5fY3JlYXRlKCkgc2hvdWxkIGhhdmUgYXNzaWduZWQg
YQotICAgICAqIHZhbGlkIHZhbHVlLiBFaXRoZXIgd2F5LCBpZiB3ZSByZWFjaCB0aGlzIHBvaW50
LCBkb21pZCBzaG91bGQgYmUKLSAgICAgKiB2YWxpZC4KLSAgICAgKi8KLSAgICBhc3NlcnQobGli
eGxfZG9taWRfdmFsaWRfZ3Vlc3QoKmRvbWlkKSk7Ci0KLSAgICByZXQgPSB4Y19jcHVwb29sX21v
dmVkb21haW4oY3R4LT54Y2gsIGluZm8tPnBvb2xpZCwgKmRvbWlkKTsKLSAgICBpZiAocmV0IDwg
MCkgewotICAgICAgICBMT0dFRChFUlJPUiwgKmRvbWlkLCAiZG9tYWluIG1vdmUgZmFpbCIpOwot
ICAgICAgICByYyA9IEVSUk9SX0ZBSUw7Ci0gICAgICAgIGdvdG8gb3V0OwotICAgIH0KLQotICAg
IGRvbV9wYXRoID0gbGlieGxfX3hzX2dldF9kb21wYXRoKGdjLCAqZG9taWQpOworICAgIGRvbV9w
YXRoID0gbGlieGxfX3hzX2dldF9kb21wYXRoKGdjLCBkb21pZCk7CiAgICAgaWYgKCFkb21fcGF0
aCkgewogICAgICAgICByYyA9IEVSUk9SX0ZBSUw7CiAgICAgICAgIGdvdG8gb3V0OwpAQCAtNjM1
LDEyICs1NjgsMTIgQEAgaW50IGxpYnhsX19kb21haW5fbWFrZShsaWJ4bF9fZ2MgKmdjLCBsaWJ4
bF9kb21haW5fY29uZmlnICpkX2NvbmZpZywKIAogICAgIHZtX3BhdGggPSBHQ1NQUklOVEYoIi92
bS8lcyIsIHV1aWRfc3RyaW5nKTsKICAgICBpZiAoIXZtX3BhdGgpIHsKLSAgICAgICAgTE9HRChF
UlJPUiwgKmRvbWlkLCAiY2Fubm90IGFsbG9jYXRlIGNyZWF0ZSBwYXRocyIpOworICAgICAgICBM
T0dEKEVSUk9SLCBkb21pZCwgImNhbm5vdCBhbGxvY2F0ZSBjcmVhdGUgcGF0aHMiKTsKICAgICAg
ICAgcmMgPSBFUlJPUl9GQUlMOwogICAgICAgICBnb3RvIG91dDsKICAgICB9CiAKLSAgICBsaWJ4
bF9wYXRoID0gbGlieGxfX3hzX2xpYnhsX3BhdGgoZ2MsICpkb21pZCk7CisgICAgbGlieGxfcGF0
aCA9IGxpYnhsX194c19saWJ4bF9wYXRoKGdjLCBkb21pZCk7CiAgICAgaWYgKCFsaWJ4bF9wYXRo
KSB7CiAgICAgICAgIHJjID0gRVJST1JfRkFJTDsKICAgICAgICAgZ290byBvdXQ7CkBAIC02NTEs
MTAgKzU4NCwxMCBAQCBpbnQgbGlieGxfX2RvbWFpbl9tYWtlKGxpYnhsX19nYyAqZ2MsIGxpYnhs
X2RvbWFpbl9jb25maWcgKmRfY29uZmlnLAogCiAgICAgcm9wZXJtWzBdLmlkID0gMDsKICAgICBy
b3Blcm1bMF0ucGVybXMgPSBYU19QRVJNX05PTkU7Ci0gICAgcm9wZXJtWzFdLmlkID0gKmRvbWlk
OworICAgIHJvcGVybVsxXS5pZCA9IGRvbWlkOwogICAgIHJvcGVybVsxXS5wZXJtcyA9IFhTX1BF
Uk1fUkVBRDsKIAotICAgIHJ3cGVybVswXS5pZCA9ICpkb21pZDsKKyAgICByd3Blcm1bMF0uaWQg
PSBkb21pZDsKICAgICByd3Blcm1bMF0ucGVybXMgPSBYU19QRVJNX05PTkU7CiAKIHJldHJ5X3Ry
YW5zYWN0aW9uOgpAQCAtNjcyLDcgKzYwNSw3IEBAIHJldHJ5X3RyYW5zYWN0aW9uOgogICAgICAg
ICAgICAgICAgICAgICBub3Blcm0sIEFSUkFZX1NJWkUobm9wZXJtKSk7CiAKICAgICB4c193cml0
ZShjdHgtPnhzaCwgdCwgR0NTUFJJTlRGKCIlcy92bSIsIGRvbV9wYXRoKSwgdm1fcGF0aCwgc3Ry
bGVuKHZtX3BhdGgpKTsKLSAgICByYyA9IGxpYnhsX19kb21haW5fcmVuYW1lKGdjLCAqZG9taWQs
IDAsIGluZm8tPm5hbWUsIHQpOworICAgIHJjID0gbGlieGxfX2RvbWFpbl9yZW5hbWUoZ2MsIGRv
bWlkLCAwLCBpbmZvLT5uYW1lLCB0KTsKICAgICBpZiAocmMpCiAgICAgICAgIGdvdG8gb3V0Owog
CkBAIC03NDksNyArNjgyLDcgQEAgcmV0cnlfdHJhbnNhY3Rpb246CiAKICAgICB2bV9saXN0ID0g
bGlieGxfbGlzdF92bShjdHgsICZuYl92bSk7CiAgICAgaWYgKCF2bV9saXN0KSB7Ci0gICAgICAg
IExPR0QoRVJST1IsICpkb21pZCwgImNhbm5vdCBnZXQgbnVtYmVyIG9mIHJ1bm5pbmcgZ3Vlc3Rz
Iik7CisgICAgICAgIExPR0QoRVJST1IsIGRvbWlkLCAiY2Fubm90IGdldCBudW1iZXIgb2YgcnVu
bmluZyBndWVzdHMiKTsKICAgICAgICAgcmMgPSBFUlJPUl9GQUlMOwogICAgICAgICBnb3RvIG91
dDsKICAgICB9CkBAIC03NzMsNyArNzA2LDcgQEAgcmV0cnlfdHJhbnNhY3Rpb246CiAgICAgICAg
ICAgICB0ID0gMDsKICAgICAgICAgICAgIGdvdG8gcmV0cnlfdHJhbnNhY3Rpb247CiAgICAgICAg
IH0KLSAgICAgICAgTE9HRUQoRVJST1IsICpkb21pZCwgImRvbWFpbiBjcmVhdGlvbiAiInhlbnN0
b3JlIHRyYW5zYWN0aW9uIGNvbW1pdCBmYWlsZWQiKTsKKyAgICAgICAgTE9HRUQoRVJST1IsIGRv
bWlkLCAiZG9tYWluIGNyZWF0aW9uICIieGVuc3RvcmUgdHJhbnNhY3Rpb24gY29tbWl0IGZhaWxl
ZCIpOwogICAgICAgICByYyA9IEVSUk9SX0ZBSUw7CiAgICAgICAgIGdvdG8gb3V0OwogICAgIH0K
QEAgLTc4NSw2ICs3MTgsODkgQEAgcmV0cnlfdHJhbnNhY3Rpb246CiAgICAgcmV0dXJuIHJjOwog
fQogCitpbnQgbGlieGxfX2RvbWFpbl9tYWtlKGxpYnhsX19nYyAqZ2MsIGxpYnhsX2RvbWFpbl9j
b25maWcgKmRfY29uZmlnLAorICAgICAgICAgICAgICAgICAgICAgICBsaWJ4bF9fZG9tYWluX2J1
aWxkX3N0YXRlICpzdGF0ZSwKKyAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgKmRvbWlk
LCBib29sIHNvZnRfcmVzZXQpCit7CisgICAgbGlieGxfY3R4ICpjdHggPSBsaWJ4bF9fZ2Nfb3du
ZXIoZ2MpOworICAgIGludCByZXQsIHJjOworCisgICAgLyogY29udmVuaWVuY2UgYWxpYXNlcyAq
LworICAgIGxpYnhsX2RvbWFpbl9jcmVhdGVfaW5mbyAqaW5mbyA9ICZkX2NvbmZpZy0+Y19pbmZv
OworICAgIGxpYnhsX2RvbWFpbl9idWlsZF9pbmZvICpiX2luZm8gPSAmZF9jb25maWctPmJfaW5m
bzsKKworICAgIGFzc2VydChzb2Z0X3Jlc2V0IHx8ICpkb21pZCA9PSBJTlZBTElEX0RPTUlEKTsK
KworICAgIGlmICghc29mdF9yZXNldCkgeworICAgICAgICBzdHJ1Y3QgeGVuX2RvbWN0bF9jcmVh
dGVkb21haW4gY3JlYXRlID0geworICAgICAgICAgICAgLnNzaWRyZWYgPSBpbmZvLT5zc2lkcmVm
LAorICAgICAgICAgICAgLm1heF92Y3B1cyA9IGJfaW5mby0+bWF4X3ZjcHVzLAorICAgICAgICAg
ICAgLm1heF9ldnRjaG5fcG9ydCA9IGJfaW5mby0+ZXZlbnRfY2hhbm5lbHMsCisgICAgICAgICAg
ICAubWF4X2dyYW50X2ZyYW1lcyA9IGJfaW5mby0+bWF4X2dyYW50X2ZyYW1lcywKKyAgICAgICAg
ICAgIC5tYXhfbWFwdHJhY2tfZnJhbWVzID0gYl9pbmZvLT5tYXhfbWFwdHJhY2tfZnJhbWVzLAor
ICAgICAgICB9OworCisgICAgICAgIGlmIChpbmZvLT50eXBlICE9IExJQlhMX0RPTUFJTl9UWVBF
X1BWKSB7CisgICAgICAgICAgICBjcmVhdGUuZmxhZ3MgfD0gWEVOX0RPTUNUTF9DREZfaHZtOwor
ICAgICAgICAgICAgY3JlYXRlLmZsYWdzIHw9CisgICAgICAgICAgICAgICAgbGlieGxfZGVmYm9v
bF92YWwoaW5mby0+aGFwKSA/IFhFTl9ET01DVExfQ0RGX2hhcCA6IDA7CisgICAgICAgICAgICBj
cmVhdGUuZmxhZ3MgfD0KKyAgICAgICAgICAgICAgICBsaWJ4bF9kZWZib29sX3ZhbChpbmZvLT5v
b3MpID8gMCA6IFhFTl9ET01DVExfQ0RGX29vc19vZmY7CisgICAgICAgIH0KKworICAgICAgICBh
c3NlcnQoaW5mby0+cGFzc3Rocm91Z2ggIT0gTElCWExfUEFTU1RIUk9VR0hfREVGQVVMVCk7Cisg
ICAgICAgIExPRyhERVRBSUwsICJwYXNzdGhyb3VnaDogJXMiLAorICAgICAgICAgICAgbGlieGxf
cGFzc3Rocm91Z2hfdG9fc3RyaW5nKGluZm8tPnBhc3N0aHJvdWdoKSk7CisKKyAgICAgICAgaWYg
KGluZm8tPnBhc3N0aHJvdWdoICE9IExJQlhMX1BBU1NUSFJPVUdIX0RJU0FCTEVEKQorICAgICAg
ICAgICAgY3JlYXRlLmZsYWdzIHw9IFhFTl9ET01DVExfQ0RGX2lvbW11OworCisgICAgICAgIGlm
IChpbmZvLT5wYXNzdGhyb3VnaCA9PSBMSUJYTF9QQVNTVEhST1VHSF9TWU5DX1BUKQorICAgICAg
ICAgICAgY3JlYXRlLmlvbW11X29wdHMgfD0gWEVOX0RPTUNUTF9JT01NVV9ub19zaGFyZXB0Owor
CisgICAgICAgIC8qIFVsdGltYXRlbHksIGhhbmRsZSBpcyBhbiBhcnJheSBvZiAxNiB1aW50OF90
LCBzYW1lIGFzIHV1aWQgKi8KKyAgICAgICAgbGlieGxfdXVpZF9jb3B5KGN0eCwgKGxpYnhsX3V1
aWQgKikmY3JlYXRlLmhhbmRsZSwgJmluZm8tPnV1aWQpOworCisgICAgICAgIHJldCA9IGxpYnhs
X19hcmNoX2RvbWFpbl9wcmVwYXJlX2NvbmZpZyhnYywgZF9jb25maWcsICZjcmVhdGUpOworICAg
ICAgICBpZiAocmV0IDwgMCkgeworICAgICAgICAgICAgTE9HRUQoRVJST1IsICpkb21pZCwgImZh
aWwgdG8gZ2V0IGRvbWFpbiBjb25maWciKTsKKyAgICAgICAgICAgIHJjID0gRVJST1JfRkFJTDsK
KyAgICAgICAgICAgIGdvdG8gb3V0OworICAgICAgICB9CisKKyAgICAgICAgcmV0ID0geGNfZG9t
YWluX2NyZWF0ZShjdHgtPnhjaCwgZG9taWQsICZjcmVhdGUpOworICAgICAgICBpZiAocmV0IDwg
MCkgeworICAgICAgICAgICAgTE9HRUQoRVJST1IsICpkb21pZCwgImRvbWFpbiBjcmVhdGlvbiBm
YWlsIik7CisgICAgICAgICAgICByYyA9IEVSUk9SX0ZBSUw7CisgICAgICAgICAgICBnb3RvIG91
dDsKKyAgICAgICAgfQorCisgICAgICAgIHJjID0gbGlieGxfX2FyY2hfZG9tYWluX3NhdmVfY29u
ZmlnKGdjLCBkX2NvbmZpZywgc3RhdGUsICZjcmVhdGUpOworICAgICAgICBpZiAocmMgPCAwKQor
ICAgICAgICAgICAgZ290byBvdXQ7CisgICAgfQorCisgICAgLyoKKyAgICAgKiBJZiBzb2Z0X3Jl
c2V0IGlzIHNldCB0aGUgdGhlIGRvbWlkIHdpbGwgaGF2ZSBiZWVuIHZhbGlkIG9uIGVudHJ5Lgor
ICAgICAqIElmIGl0IHdhcyBub3Qgc2V0IHRoZW4geGNfZG9tYWluX2NyZWF0ZSgpIHNob3VsZCBo
YXZlIGFzc2lnbmVkIGEKKyAgICAgKiB2YWxpZCB2YWx1ZS4gRWl0aGVyIHdheSwgaWYgd2UgcmVh
Y2ggdGhpcyBwb2ludCwgZG9taWQgc2hvdWxkIGJlCisgICAgICogdmFsaWQuCisgICAgICovCisg
ICAgYXNzZXJ0KGxpYnhsX2RvbWlkX3ZhbGlkX2d1ZXN0KCpkb21pZCkpOworCisgICAgcmV0ID0g
eGNfY3B1cG9vbF9tb3ZlZG9tYWluKGN0eC0+eGNoLCBpbmZvLT5wb29saWQsICpkb21pZCk7Cisg
ICAgaWYgKHJldCA8IDApIHsKKyAgICAgICAgTE9HRUQoRVJST1IsICpkb21pZCwgImRvbWFpbiBt
b3ZlIGZhaWwiKTsKKyAgICAgICAgcmMgPSBFUlJPUl9GQUlMOworICAgICAgICBnb3RvIG91dDsK
KyAgICB9CisKKyAgICByYyA9IGxpYnhsX19kb21haW5fbWFrZV94c19lbnRyaWVzKGdjLCBkX2Nv
bmZpZywgc3RhdGUsICpkb21pZCk7CisKK291dDoKKyAgICByZXR1cm4gcmM7Cit9CisKIHN0YXRp
YyBpbnQgc3RvcmVfbGlieGxfZW50cnkobGlieGxfX2djICpnYywgdWludDMyX3QgZG9taWQsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnhsX2RvbWFpbl9idWlsZF9pbmZvICpiX2lu
Zm8pCiB7CkBAIC0xMTA2LDE2ICsxMTIyLDMyIEBAIHN0YXRpYyB2b2lkIGluaXRpYXRlX2RvbWFp
bl9jcmVhdGUobGlieGxfX2VnYyAqZWdjLAogICAgIHJldCA9IGxpYnhsX19kb21haW5fY29uZmln
X3NldGRlZmF1bHQoZ2MsZF9jb25maWcsZG9taWQpOwogICAgIGlmIChyZXQpIGdvdG8gZXJyb3Jf
b3V0OwogCi0gICAgcmV0ID0gbGlieGxfX2RvbWFpbl9tYWtlKGdjLCBkX2NvbmZpZywgJmRjcy0+
YnVpbGRfc3RhdGUsICZkb21pZCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGNzLT5z
b2Z0X3Jlc2V0KTsKLSAgICBpZiAocmV0KSB7Ci0gICAgICAgIExPR0QoRVJST1IsIGRvbWlkLCAi
Y2Fubm90IG1ha2UgZG9tYWluOiAlZCIsIHJldCk7CisgICAgaWYgKCAhZF9jb25maWctPmRtX3Jl
c3RvcmVfZmlsZSApCisgICAgeworICAgICAgICByZXQgPSBsaWJ4bF9fZG9tYWluX21ha2UoZ2Ms
IGRfY29uZmlnLCAmZGNzLT5idWlsZF9zdGF0ZSwgJmRvbWlkLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgZGNzLT5zb2Z0X3Jlc2V0KTsKICAgICAgICAgZGNzLT5ndWVzdF9kb21p
ZCA9IGRvbWlkOworCisgICAgICAgIGlmIChyZXQpIHsKKyAgICAgICAgICAgIExPR0QoRVJST1Is
IGRvbWlkLCAiY2Fubm90IG1ha2UgZG9tYWluOiAlZCIsIHJldCk7CisgICAgICAgICAgICByZXQg
PSBFUlJPUl9GQUlMOworICAgICAgICAgICAgZ290byBlcnJvcl9vdXQ7CisgICAgICAgIH0KKyAg
ICB9IGVsc2UgaWYgKCBkY3MtPmd1ZXN0X2RvbWlkICE9IElOVkFMSURfRE9NSUQgKSB7CisgICAg
ICAgIGRvbWlkID0gZGNzLT5ndWVzdF9kb21pZDsKKworICAgICAgICByZXQgPSBsaWJ4bF9fZG9t
YWluX21ha2VfeHNfZW50cmllcyhnYywgZF9jb25maWcsICZkY3MtPmJ1aWxkX3N0YXRlLCBkb21p
ZCk7CisgICAgICAgIGlmIChyZXQpIHsKKyAgICAgICAgICAgIExPR0QoRVJST1IsIGRvbWlkLCAi
Y2Fubm90IG1ha2UgZG9tYWluOiAlZCIsIHJldCk7CisgICAgICAgICAgICByZXQgPSBFUlJPUl9G
QUlMOworICAgICAgICAgICAgZ290byBlcnJvcl9vdXQ7CisgICAgICAgIH0KKyAgICB9IGVsc2Ug
eworICAgICAgICBMT0dEKEVSUk9SLCBkb21pZCwgImNhbm5vdCBtYWtlIGRvbWFpbiIpOwogICAg
ICAgICByZXQgPSBFUlJPUl9GQUlMOwogICAgICAgICBnb3RvIGVycm9yX291dDsKICAgICB9CiAK
LSAgICBkY3MtPmd1ZXN0X2RvbWlkID0gZG9taWQ7CiAgICAgZGNzLT5zZHNzLmRtLmd1ZXN0X2Rv
bWlkID0gMDsgLyogbWVhbnMgd2UgaGF2ZW4ndCBzcGF3bmVkICovCiAKICAgICAvKiBwb3N0LTQu
MTMgdG9kbzogbW92ZSB0aGVzZSBuZXh0IGJpdHMgb2YgZGVmYXVsdGluZyB0bwpAQCAtMTE1MSw3
ICsxMTgzLDcgQEAgc3RhdGljIHZvaWQgaW5pdGlhdGVfZG9tYWluX2NyZWF0ZShsaWJ4bF9fZWdj
ICplZ2MsCiAgICAgaWYgKHJldCkKICAgICAgICAgZ290byBlcnJvcl9vdXQ7CiAKLSAgICBpZiAo
cmVzdG9yZV9mZCA+PSAwIHx8IGRjcy0+c29mdF9yZXNldCkgeworICAgIGlmIChyZXN0b3JlX2Zk
ID49IDAgfHwgZGNzLT5zb2Z0X3Jlc2V0IHx8IGRfY29uZmlnLT5kbV9yZXN0b3JlX2ZpbGUpIHsK
ICAgICAgICAgTE9HRChERUJVRywgZG9taWQsICJyZXN0b3JpbmcsIG5vdCBydW5uaW5nIGJvb3Rs
b2FkZXIiKTsKICAgICAgICAgZG9tY3JlYXRlX2Jvb3Rsb2FkZXJfZG9uZShlZ2MsICZkY3MtPmJs
LCAwKTsKICAgICB9IGVsc2UgIHsKQEAgLTEyMjcsNyArMTI1OSwxNiBAQCBzdGF0aWMgdm9pZCBk
b21jcmVhdGVfYm9vdGxvYWRlcl9kb25lKGxpYnhsX19lZ2MgKmVnYywKICAgICBkY3MtPnNkc3Mu
ZG0uY2FsbGJhY2sgPSBkb21jcmVhdGVfZGV2bW9kZWxfc3RhcnRlZDsKICAgICBkY3MtPnNkc3Mu
Y2FsbGJhY2sgPSBkb21jcmVhdGVfZGV2bW9kZWxfc3RhcnRlZDsKIAotICAgIGlmIChyZXN0b3Jl
X2ZkIDwgMCAmJiAhZGNzLT5zb2Z0X3Jlc2V0KSB7CisgICAgaWYgKHJlc3RvcmVfZmQgPCAwICYm
ICFkY3MtPnNvZnRfcmVzZXQgJiYgIWRfY29uZmlnLT5kbV9yZXN0b3JlX2ZpbGUpIHsKKyAgICAg
ICAgcmMgPSBsaWJ4bF9fZG9tYWluX2J1aWxkKGdjLCBkX2NvbmZpZywgZG9taWQsIHN0YXRlKTsK
KyAgICAgICAgZG9tY3JlYXRlX3JlYnVpbGRfZG9uZShlZ2MsIGRjcywgcmMpOworICAgICAgICBy
ZXR1cm47CisgICAgfQorCisgICAgaWYgKCBkX2NvbmZpZy0+ZG1fcmVzdG9yZV9maWxlICkgewor
ICAgICAgICBkY3MtPnNycy5kY3MgPSBkY3M7CisgICAgICAgIGRjcy0+c3JzLmFvID0gYW87Cisg
ICAgICAgIHN0YXRlLT5mb3JrZWRfdm0gPSB0cnVlOwogICAgICAgICByYyA9IGxpYnhsX19kb21h
aW5fYnVpbGQoZ2MsIGRfY29uZmlnLCBkb21pZCwgc3RhdGUpOwogICAgICAgICBkb21jcmVhdGVf
cmVidWlsZF9kb25lKGVnYywgZGNzLCByYyk7CiAgICAgICAgIHJldHVybjsKQEAgLTE0MjUsNiAr
MTQ2Niw3IEBAIHN0YXRpYyB2b2lkIGRvbWNyZWF0ZV9yZWJ1aWxkX2RvbmUobGlieGxfX2VnYyAq
ZWdjLAogICAgIC8qIGNvbnZlbmllbmNlIGFsaWFzZXMgKi8KICAgICBjb25zdCB1aW50MzJfdCBk
b21pZCA9IGRjcy0+Z3Vlc3RfZG9taWQ7CiAgICAgbGlieGxfZG9tYWluX2NvbmZpZyAqY29uc3Qg
ZF9jb25maWcgPSBkY3MtPmd1ZXN0X2NvbmZpZzsKKyAgICBsaWJ4bF9fZG9tYWluX2J1aWxkX3N0
YXRlICpjb25zdCBzdGF0ZSA9ICZkY3MtPmJ1aWxkX3N0YXRlOwogCiAgICAgaWYgKHJldCkgewog
ICAgICAgICBMT0dEKEVSUk9SLCBkb21pZCwgImNhbm5vdCAocmUtKWJ1aWxkIGRvbWFpbjogJWQi
LCByZXQpOwpAQCAtMTQzMiw2ICsxNDc0LDkgQEAgc3RhdGljIHZvaWQgZG9tY3JlYXRlX3JlYnVp
bGRfZG9uZShsaWJ4bF9fZWdjICplZ2MsCiAgICAgICAgIGdvdG8gZXJyb3Jfb3V0OwogICAgIH0K
IAorICAgIGlmICggZF9jb25maWctPmRtX3Jlc3RvcmVfZmlsZSApCisgICAgICAgIHN0YXRlLT5z
YXZlZF9zdGF0ZSA9IEdDU1BSSU5URigiJXMiLCBkX2NvbmZpZy0+ZG1fcmVzdG9yZV9maWxlKTsK
KwogICAgIHN0b3JlX2xpYnhsX2VudHJ5KGdjLCBkb21pZCwgJmRfY29uZmlnLT5iX2luZm8pOwog
CiAgICAgbGlieGxfX211bHRpZGV2X2JlZ2luKGFvLCAmZGNzLT5tdWx0aWRldik7CkBAIC0xODMz
LDYgKzE4NzgsOCBAQCBzdGF0aWMgaW50IGRvX2RvbWFpbl9jcmVhdGUobGlieGxfY3R4ICpjdHgs
IGxpYnhsX2RvbWFpbl9jb25maWcgKmRfY29uZmlnLAogICAgIEdDTkVXKGNkY3MpOwogICAgIGNk
Y3MtPmRjcy5hbyA9IGFvOwogICAgIGNkY3MtPmRjcy5ndWVzdF9jb25maWcgPSBkX2NvbmZpZzsK
KyAgICBjZGNzLT5kY3MuZ3Vlc3RfZG9taWQgPSAqZG9taWQ7CisKICAgICBsaWJ4bF9kb21haW5f
Y29uZmlnX2luaXQoJmNkY3MtPmRjcy5ndWVzdF9jb25maWdfc2F2ZWQpOwogICAgIGxpYnhsX2Rv
bWFpbl9jb25maWdfY29weShjdHgsICZjZGNzLT5kY3MuZ3Vlc3RfY29uZmlnX3NhdmVkLCBkX2Nv
bmZpZyk7CiAgICAgY2Rjcy0+ZGNzLnJlc3RvcmVfZmQgPSBjZGNzLT5kY3MubGlieGNfZmQgPSBy
ZXN0b3JlX2ZkOwpAQCAtMjA4MSw2ICsyMTI4LDQzIEBAIGludCBsaWJ4bF9kb21haW5fY3JlYXRl
X25ldyhsaWJ4bF9jdHggKmN0eCwgbGlieGxfZG9tYWluX2NvbmZpZyAqZF9jb25maWcsCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgYW9faG93LCBhb3BfY29uc29sZV9ob3cpOwogfQogCitp
bnQgbGlieGxfZG9tYWluX2Zvcmtfdm0obGlieGxfY3R4ICpjdHgsIHVpbnQzMl90IHBkb21pZCwg
dWludDMyX3QgKmRvbWlkKQoreworICAgIGludCByYzsKKyAgICBzdHJ1Y3QgeGVuX2RvbWN0bF9j
cmVhdGVkb21haW4gY3JlYXRlID0gezB9OworICAgIGNyZWF0ZS5mbGFncyB8PSBYRU5fRE9NQ1RM
X0NERl9odm07CisgICAgY3JlYXRlLmZsYWdzIHw9IFhFTl9ET01DVExfQ0RGX2hhcDsKKyAgICBj
cmVhdGUuZmxhZ3MgfD0gWEVOX0RPTUNUTF9DREZfb29zX29mZjsKKyAgICBjcmVhdGUuYXJjaC5l
bXVsYXRpb25fZmxhZ3MgPSAoWEVOX1g4Nl9FTVVfQUxMICYgflhFTl9YODZfRU1VX1ZQQ0kpOwor
CisgICAgY3JlYXRlLnNzaWRyZWYgPSBTRUNJTklUU0lEX0RPTVU7CisgICAgY3JlYXRlLm1heF92
Y3B1cyA9IDE7IC8vIHBsYWNlaG9sZGVyLCB3aWxsIGJlIGNsb25lZCBmcm9tIHBkb21pZAorICAg
IGNyZWF0ZS5tYXhfZXZ0Y2huX3BvcnQgPSAxMDIzOworICAgIGNyZWF0ZS5tYXhfZ3JhbnRfZnJh
bWVzID0gTElCWExfTUFYX0dSQU5UX0ZSQU1FU19ERUZBVUxUOworICAgIGNyZWF0ZS5tYXhfbWFw
dHJhY2tfZnJhbWVzID0gTElCWExfTUFYX01BUFRSQUNLX0ZSQU1FU19ERUZBVUxUOworCisgICAg
aWYgKCAocmMgPSB4Y19kb21haW5fY3JlYXRlKGN0eC0+eGNoLCBkb21pZCwgJmNyZWF0ZSkpICkK
KyAgICAgICAgcmV0dXJuIHJjOworCisgICAgaWYgKCAocmMgPSB4Y19tZW1zaHJfZm9yayhjdHgt
PnhjaCwgcGRvbWlkLCAqZG9taWQpKSApCisgICAgICAgIHhjX2RvbWFpbl9kZXN0cm95KGN0eC0+
eGNoLCAqZG9taWQpOworCisgICAgcmV0dXJuIHJjOworfQorCitpbnQgbGlieGxfZG9tYWluX2Zv
cmtfbGF1bmNoX2RtKGxpYnhsX2N0eCAqY3R4LCBsaWJ4bF9kb21haW5fY29uZmlnICpkX2NvbmZp
ZywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgZG9taWQsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxpYnhsX2FzeW5jcHJvZ3Jlc3NfaG93
ICphb3BfY29uc29sZV9ob3cpCit7CisgICAgdW5zZXRfZGlza19jb2xvX3Jlc3RvcmUoZF9jb25m
aWcpOworICAgIHJldHVybiBkb19kb21haW5fY3JlYXRlKGN0eCwgZF9jb25maWcsICZkb21pZCwg
LTEsIC0xLCAwLCAwLCBhb3BfY29uc29sZV9ob3cpOworfQorCitpbnQgbGlieGxfZG9tYWluX2Zv
cmtfcmVzZXQobGlieGxfY3R4ICpjdHgsIHVpbnQzMl90IGRvbWlkKQoreworICAgIHJldHVybiB4
Y19tZW1zaHJfZm9ya19yZXNldChjdHgtPnhjaCwgZG9taWQpOworfQorCiBpbnQgbGlieGxfZG9t
YWluX2NyZWF0ZV9yZXN0b3JlKGxpYnhsX2N0eCAqY3R4LCBsaWJ4bF9kb21haW5fY29uZmlnICpk
X2NvbmZpZywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgKmRvbWlk
LCBpbnQgcmVzdG9yZV9mZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IHNl
bmRfYmFja19mZCwKZGlmZiAtLWdpdCBhL3Rvb2xzL2xpYnhsL2xpYnhsX2RtLmMgYi90b29scy9s
aWJ4bC9saWJ4bF9kbS5jCmluZGV4IGY3NThkYWYzYjYuLmMzMDk2ZjhmOGYgMTAwNjQ0Ci0tLSBh
L3Rvb2xzL2xpYnhsL2xpYnhsX2RtLmMKKysrIGIvdG9vbHMvbGlieGwvbGlieGxfZG0uYwpAQCAt
Mjc4Nyw3ICsyNzg3LDcgQEAgc3RhdGljIHZvaWQgZGV2aWNlX21vZGVsX3NwYXduX291dGNvbWUo
bGlieGxfX2VnYyAqZWdjLAogCiAgICAgbGlieGxfX2RvbWFpbl9idWlsZF9zdGF0ZSAqc3RhdGUg
PSBkbXNzLT5idWlsZF9zdGF0ZTsKIAotICAgIGlmIChzdGF0ZS0+c2F2ZWRfc3RhdGUpIHsKKyAg
ICBpZiAoc3RhdGUtPnNhdmVkX3N0YXRlICYmICFzdGF0ZS0+Zm9ya2VkX3ZtKSB7CiAgICAgICAg
IHJldDIgPSB1bmxpbmsoc3RhdGUtPnNhdmVkX3N0YXRlKTsKICAgICAgICAgaWYgKHJldDIpIHsK
ICAgICAgICAgICAgIExPR0VEKEVSUk9SLCBkbXNzLT5ndWVzdF9kb21pZCwgIiVzOiBmYWlsZWQg
dG8gcmVtb3ZlIGRldmljZS1tb2RlbCBzdGF0ZSAlcyIsCmRpZmYgLS1naXQgYS90b29scy9saWJ4
bC9saWJ4bF9kb20uYyBiL3Rvb2xzL2xpYnhsL2xpYnhsX2RvbS5jCmluZGV4IGQ5YWRhOGE0MjIu
LmU3YzU0ZGRmNjMgMTAwNjQ0Ci0tLSBhL3Rvb2xzL2xpYnhsL2xpYnhsX2RvbS5jCisrKyBiL3Rv
b2xzL2xpYnhsL2xpYnhsX2RvbS5jCkBAIC0yNDksOSArMjQ5LDEyIEBAIGludCBsaWJ4bF9fYnVp
bGRfcHJlKGxpYnhsX19nYyAqZ2MsIHVpbnQzMl90IGRvbWlkLAogICAgIGxpYnhsX2RvbWFpbl9i
dWlsZF9pbmZvICpjb25zdCBpbmZvID0gJmRfY29uZmlnLT5iX2luZm87CiAgICAgbGlieGxfY3R4
ICpjdHggPSBsaWJ4bF9fZ2Nfb3duZXIoZ2MpOwogICAgIGNoYXIgKnhzX2RvbWlkLCAqY29uX2Rv
bWlkOwotICAgIGludCByYzsKKyAgICBpbnQgcmMgPSAwOwogICAgIHVpbnQ2NF90IHNpemU7CiAK
KyAgICBpZiAoIHN0YXRlLT5mb3JrZWRfdm0gKQorICAgICAgICBnb3RvIHNraXBfZm9yazsKKwog
ICAgIGlmICh4Y19kb21haW5fbWF4X3ZjcHVzKGN0eC0+eGNoLCBkb21pZCwgaW5mby0+bWF4X3Zj
cHVzKSAhPSAwKSB7CiAgICAgICAgIExPRyhFUlJPUiwgIkNvdWxkbid0IHNldCBtYXggdmNwdSBj
b3VudCIpOwogICAgICAgICByZXR1cm4gRVJST1JfRkFJTDsKQEAgLTM2Miw3ICszNjUsNiBAQCBp
bnQgbGlieGxfX2J1aWxkX3ByZShsaWJ4bF9fZ2MgKmdjLCB1aW50MzJfdCBkb21pZCwKICAgICAg
ICAgfQogICAgIH0KIAotCiAgICAgcmMgPSBsaWJ4bF9fYXJjaF9leHRyYV9tZW1vcnkoZ2MsIGlu
Zm8sICZzaXplKTsKICAgICBpZiAocmMgPCAwKSB7CiAgICAgICAgIExPR0UoRVJST1IsICJDb3Vs
ZG4ndCBnZXQgYXJjaCBleHRyYSBjb25zdGFudCBtZW1vcnkgc2l6ZSIpOwpAQCAtMzc0LDYgKzM3
NiwxMSBAQCBpbnQgbGlieGxfX2J1aWxkX3ByZShsaWJ4bF9fZ2MgKmdjLCB1aW50MzJfdCBkb21p
ZCwKICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUw7CiAgICAgfQogCisgICAgcmMgPSBsaWJ4bF9f
YXJjaF9kb21haW5fY3JlYXRlKGdjLCBkX2NvbmZpZywgZG9taWQpOworICAgIGlmICggcmMgKQor
ICAgICAgICBnb3RvIG91dDsKKworc2tpcF9mb3JrOgogICAgIHhzX2RvbWlkID0geHNfcmVhZChj
dHgtPnhzaCwgWEJUX05VTEwsICIvdG9vbC94ZW5zdG9yZWQvZG9taWQiLCBOVUxMKTsKICAgICBz
dGF0ZS0+c3RvcmVfZG9taWQgPSB4c19kb21pZCA/IGF0b2koeHNfZG9taWQpIDogMDsKICAgICBm
cmVlKHhzX2RvbWlkKTsKQEAgLTM4NSw4ICszOTIsNyBAQCBpbnQgbGlieGxfX2J1aWxkX3ByZShs
aWJ4bF9fZ2MgKmdjLCB1aW50MzJfdCBkb21pZCwKICAgICBzdGF0ZS0+c3RvcmVfcG9ydCA9IHhj
X2V2dGNobl9hbGxvY191bmJvdW5kKGN0eC0+eGNoLCBkb21pZCwgc3RhdGUtPnN0b3JlX2RvbWlk
KTsKICAgICBzdGF0ZS0+Y29uc29sZV9wb3J0ID0geGNfZXZ0Y2huX2FsbG9jX3VuYm91bmQoY3R4
LT54Y2gsIGRvbWlkLCBzdGF0ZS0+Y29uc29sZV9kb21pZCk7CiAKLSAgICByYyA9IGxpYnhsX19h
cmNoX2RvbWFpbl9jcmVhdGUoZ2MsIGRfY29uZmlnLCBkb21pZCk7Ci0KK291dDoKICAgICByZXR1
cm4gcmM7CiB9CiAKQEAgLTQ0NCw2ICs0NTAsOSBAQCBpbnQgbGlieGxfX2J1aWxkX3Bvc3QobGli
eGxfX2djICpnYywgdWludDMyX3QgZG9taWQsCiAgICAgY2hhciAqKmVudHM7CiAgICAgaW50IGks
IHJjOwogCisgICAgaWYgKCBzdGF0ZS0+Zm9ya2VkX3ZtICkKKyAgICAgICAgZ290byBza2lwX2Zv
cms7CisKICAgICBpZiAoaW5mby0+bnVtX3ZudW1hX25vZGVzICYmICFpbmZvLT5udW1fdmNwdV9z
b2Z0X2FmZmluaXR5KSB7CiAgICAgICAgIHJjID0gc2V0X3ZudW1hX2FmZmluaXR5KGdjLCBkb21p
ZCwgaW5mbyk7CiAgICAgICAgIGlmIChyYykKQEAgLTQ2OCw2ICs0NzcsNyBAQCBpbnQgbGlieGxf
X2J1aWxkX3Bvc3QobGlieGxfX2djICpnYywgdWludDMyX3QgZG9taWQsCiAgICAgICAgIH0KICAg
ICB9CiAKK3NraXBfZm9yazoKICAgICBlbnRzID0gbGlieGxfX2NhbGxvYyhnYywgMTIgKyAoaW5m
by0+bWF4X3ZjcHVzICogMikgKyAyLCBzaXplb2YoY2hhciAqKSk7CiAgICAgZW50c1swXSA9ICJt
ZW1vcnkvc3RhdGljLW1heCI7CiAgICAgZW50c1sxXSA9IEdDU1BSSU5URigiJSJQUklkNjQsIGlu
Zm8tPm1heF9tZW1rYik7CkBAIC03MzAsMTQgKzc0MCwxNiBAQCBzdGF0aWMgaW50IGh2bV9idWls
ZF9zZXRfcGFyYW1zKHhjX2ludGVyZmFjZSAqaGFuZGxlLCB1aW50MzJfdCBkb21pZCwKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlieGxfZG9tYWluX2J1aWxkX2luZm8gKmluZm8s
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBzdG9yZV9ldnRjaG4sIHVuc2ln
bmVkIGxvbmcgKnN0b3JlX21mbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50
IGNvbnNvbGVfZXZ0Y2huLCB1bnNpZ25lZCBsb25nICpjb25zb2xlX21mbiwKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgZG9taWRfdCBzdG9yZV9kb21pZCwgZG9taWRfdCBjb25zb2xl
X2RvbWlkKQorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb21pZF90IHN0b3JlX2Rv
bWlkLCBkb21pZF90IGNvbnNvbGVfZG9taWQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGJvb2wgZm9ya2VkX3ZtKQogewogICAgIHN0cnVjdCBodm1faW5mb190YWJsZSAqdmFfaHZt
OwogICAgIHVpbnQ4X3QgKnZhX21hcCwgc3VtOwogICAgIHVpbnQ2NF90IHN0cl9tZm4sIGNvbnNf
bWZuOwogICAgIGludCBpOwogCi0gICAgaWYgKGluZm8tPnR5cGUgPT0gTElCWExfRE9NQUlOX1RZ
UEVfSFZNKSB7CisgICAgaWYgKCBpbmZvLT50eXBlID09IExJQlhMX0RPTUFJTl9UWVBFX0hWTSAm
JiAhZm9ya2VkX3ZtICkKKyAgICB7CiAgICAgICAgIHZhX21hcCA9IHhjX21hcF9mb3JlaWduX3Jh
bmdlKGhhbmRsZSwgZG9taWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IFhDX1BBR0VfU0laRSwgUFJPVF9SRUFEIHwgUFJPVF9XUklURSwKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgSFZNX0lORk9fUEZOKTsKQEAgLTEwNTMsNiArMTA2NSwyMyBA
QCBpbnQgbGlieGxfX2J1aWxkX2h2bShsaWJ4bF9fZ2MgKmdjLCB1aW50MzJfdCBkb21pZCwKICAg
ICBzdHJ1Y3QgeGNfZG9tX2ltYWdlICpkb20gPSBOVUxMOwogICAgIGJvb2wgZGV2aWNlX21vZGVs
ID0gaW5mby0+dHlwZSA9PSBMSUJYTF9ET01BSU5fVFlQRV9IVk0gPyB0cnVlIDogZmFsc2U7CiAK
KyAgICBpZiAoIHN0YXRlLT5mb3JrZWRfdm0gKQorICAgIHsKKyAgICAgICAgcmMgPSBodm1fYnVp
bGRfc2V0X3BhcmFtcyhjdHgtPnhjaCwgZG9taWQsIGluZm8sIHN0YXRlLT5zdG9yZV9wb3J0LAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZzdGF0ZS0+c3RvcmVfbWZuLCBzdGF0
ZS0+Y29uc29sZV9wb3J0LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZzdGF0
ZS0+Y29uc29sZV9tZm4sIHN0YXRlLT5zdG9yZV9kb21pZCwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBzdGF0ZS0+Y29uc29sZV9kb21pZCwgc3RhdGUtPmZvcmtlZF92bSk7CisK
KyAgICAgICAgaWYgKCByYyApCisgICAgICAgICAgICByZXR1cm4gcmM7CisKKyAgICAgICAgcmV0
dXJuIHhjX2RvbV9nbnR0YWJfc2VlZChjdHgtPnhjaCwgZG9taWQsIHRydWUsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUtPmNvbnNvbGVfbWZuLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLT5zdG9yZV9tZm4sCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgc3RhdGUtPmNvbnNvbGVfZG9taWQsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgc3RhdGUtPnN0b3JlX2RvbWlkKTsKKyAgICB9CisKICAgICB4Y19k
b21fbG9naW5pdChjdHgtPnhjaCk7CiAKICAgICAvKgpAQCAtMTE3Nyw3ICsxMjA2LDcgQEAgaW50
IGxpYnhsX19idWlsZF9odm0obGlieGxfX2djICpnYywgdWludDMyX3QgZG9taWQsCiAgICAgcmMg
PSBodm1fYnVpbGRfc2V0X3BhcmFtcyhjdHgtPnhjaCwgZG9taWQsIGluZm8sIHN0YXRlLT5zdG9y
ZV9wb3J0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZzdGF0ZS0+c3RvcmVfbWZu
LCBzdGF0ZS0+Y29uc29sZV9wb3J0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZz
dGF0ZS0+Y29uc29sZV9tZm4sIHN0YXRlLT5zdG9yZV9kb21pZCwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBzdGF0ZS0+Y29uc29sZV9kb21pZCk7CisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgc3RhdGUtPmNvbnNvbGVfZG9taWQsIGZhbHNlKTsKICAgICBpZiAocmMgIT0g
MCkgewogICAgICAgICBMT0coRVJST1IsICJodm0gYnVpbGQgc2V0IHBhcmFtcyBmYWlsZWQiKTsK
ICAgICAgICAgZ290byBvdXQ7CmRpZmYgLS1naXQgYS90b29scy9saWJ4bC9saWJ4bF9pbnRlcm5h
bC5oIGIvdG9vbHMvbGlieGwvbGlieGxfaW50ZXJuYWwuaAppbmRleCBkZDNjMDhiYzE0Li5mNjlh
ODM4N2VkIDEwMDY0NAotLS0gYS90b29scy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5oCisrKyBiL3Rv
b2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmgKQEAgLTEzNzQsNiArMTM3NCw3IEBAIHR5cGVkZWYg
c3RydWN0IHsKIAogICAgIGNoYXIgKnNhdmVkX3N0YXRlOwogICAgIGludCBkbV9tb25pdG9yX2Zk
OworICAgIGJvb2wgZm9ya2VkX3ZtOwogCiAgICAgbGlieGxfX2ZpbGVfcmVmZXJlbmNlIHB2X2tl
cm5lbDsKICAgICBsaWJ4bF9fZmlsZV9yZWZlcmVuY2UgcHZfcmFtZGlzazsKZGlmZiAtLWdpdCBh
L3Rvb2xzL2xpYnhsL2xpYnhsX3R5cGVzLmlkbCBiL3Rvb2xzL2xpYnhsL2xpYnhsX3R5cGVzLmlk
bAppbmRleCA3OTIxOTUwZjZhLi43YzRjNDA1N2E5IDEwMDY0NAotLS0gYS90b29scy9saWJ4bC9s
aWJ4bF90eXBlcy5pZGwKKysrIGIvdG9vbHMvbGlieGwvbGlieGxfdHlwZXMuaWRsCkBAIC05NTYs
NiArOTU2LDcgQEAgbGlieGxfZG9tYWluX2NvbmZpZyA9IFN0cnVjdCgiZG9tYWluX2NvbmZpZyIs
IFsKICAgICAoIm9uX3dhdGNoZG9nIiwgbGlieGxfYWN0aW9uX29uX3NodXRkb3duKSwKICAgICAo
Im9uX2NyYXNoIiwgbGlieGxfYWN0aW9uX29uX3NodXRkb3duKSwKICAgICAoIm9uX3NvZnRfcmVz
ZXQiLCBsaWJ4bF9hY3Rpb25fb25fc2h1dGRvd24pLAorICAgICgiZG1fcmVzdG9yZV9maWxlIiwg
c3RyaW5nLCB7J2NvbnN0JzogVHJ1ZX0pLAogICAgIF0sIGRpcj1ESVJfSU4pCiAKIGxpYnhsX2Rp
c2tpbmZvID0gU3RydWN0KCJkaXNraW5mbyIsIFsKZGlmZiAtLWdpdCBhL3Rvb2xzL3hsL3hsLmgg
Yi90b29scy94bC94bC5oCmluZGV4IDYwYmRhZDhmZmIuLjliZGFkNjUyNmUgMTAwNjQ0Ci0tLSBh
L3Rvb2xzL3hsL3hsLmgKKysrIGIvdG9vbHMveGwveGwuaApAQCAtMzEsNiArMzEsNyBAQCBzdHJ1
Y3QgY21kX3NwZWMgewogfTsKIAogc3RydWN0IGRvbWFpbl9jcmVhdGUgeworICAgIHVpbnQzMl90
IGRkb21pZDsgLyogZm9yayBsYXVuY2ggZG0gZm9yIHRoaXMgZG9taWQgKi8KICAgICBpbnQgZGVi
dWc7CiAgICAgaW50IGRhZW1vbml6ZTsKICAgICBpbnQgbW9uaXRvcjsgLyogaGFuZGxlIGd1ZXN0
IHJlYm9vdHMgZXRjICovCkBAIC00NSw2ICs0Niw3IEBAIHN0cnVjdCBkb21haW5fY3JlYXRlIHsK
ICAgICBjb25zdCBjaGFyICpjb25maWdfZmlsZTsKICAgICBjaGFyICpleHRyYV9jb25maWc7IC8q
IGV4dHJhIGNvbmZpZyBzdHJpbmcgKi8KICAgICBjb25zdCBjaGFyICpyZXN0b3JlX2ZpbGU7Cisg
ICAgY29uc3QgY2hhciAqZG1fcmVzdG9yZV9maWxlOwogICAgIGNoYXIgKmNvbG9fcHJveHlfc2Ny
aXB0OwogICAgIGJvb2wgdXNlcnNwYWNlX2NvbG9fcHJveHk7CiAgICAgaW50IG1pZ3JhdGVfZmQ7
IC8qIC0xIG1lYW5zIG5vbmUgKi8KQEAgLTEyNyw2ICsxMjksOSBAQCBpbnQgbWFpbl9wY2lhc3Np
Z25hYmxlX3JlbW92ZShpbnQgYXJnYywgY2hhciAqKmFyZ3YpOwogaW50IG1haW5fcGNpYXNzaWdu
YWJsZV9saXN0KGludCBhcmdjLCBjaGFyICoqYXJndik7CiAjaWZuZGVmIExJQlhMX0hBVkVfTk9f
U1VTUEVORF9SRVNVTUUKIGludCBtYWluX3Jlc3RvcmUoaW50IGFyZ2MsIGNoYXIgKiphcmd2KTsK
K2ludCBtYWluX2Zvcmtfdm0oaW50IGFyZ2MsIGNoYXIgKiphcmd2KTsKK2ludCBtYWluX2Zvcmtf
bGF1bmNoX2RtKGludCBhcmdjLCBjaGFyICoqYXJndik7CitpbnQgbWFpbl9mb3JrX3Jlc2V0KGlu
dCBhcmdjLCBjaGFyICoqYXJndik7CiBpbnQgbWFpbl9taWdyYXRlX3JlY2VpdmUoaW50IGFyZ2Ms
IGNoYXIgKiphcmd2KTsKIGludCBtYWluX3NhdmUoaW50IGFyZ2MsIGNoYXIgKiphcmd2KTsKIGlu
dCBtYWluX21pZ3JhdGUoaW50IGFyZ2MsIGNoYXIgKiphcmd2KTsKZGlmZiAtLWdpdCBhL3Rvb2xz
L3hsL3hsX2NtZHRhYmxlLmMgYi90b29scy94bC94bF9jbWR0YWJsZS5jCmluZGV4IDNiMzAyYjJm
MjAuLjNhNWQzNzEwNTcgMTAwNjQ0Ci0tLSBhL3Rvb2xzL3hsL3hsX2NtZHRhYmxlLmMKKysrIGIv
dG9vbHMveGwveGxfY21kdGFibGUuYwpAQCAtMTg1LDYgKzE4NSwxOCBAQCBzdHJ1Y3QgY21kX3Nw
ZWMgY21kX3RhYmxlW10gPSB7CiAgICAgICAiUmVzdG9yZSBhIGRvbWFpbiBmcm9tIGEgc2F2ZWQg
c3RhdGUiLAogICAgICAgIi0gZm9yIGludGVybmFsIHVzZSBvbmx5IiwKICAgICB9LAorICAgIHsg
ImZvcmstdm0iLAorICAgICAgJm1haW5fZm9ya192bSwgMCwgMSwKKyAgICAgICJGb3JrIGEgZG9t
YWluIGZyb20gdGhlIHJ1bm5pbmcgcGFyZW50IGRvbWlkIiwKKyAgICAgICJbb3B0aW9uc10gPERv
bWlkPiIsCisgICAgICAiLWggICAgICAgICAgICAgICAgICAgICAgICAgICBQcmludCB0aGlzIGhl
bHAuXG4iCisgICAgICAiLUMgPGNvbmZpZz4gICAgICAgICAgICAgICAgICBVc2UgY29uZmlnIGZp
bGUgZm9yIFZNIGZvcmsuXG4iCisgICAgICAiLVEgPHFlbXUtc2F2ZS1maWxlPiAgICAgICAgICBV
c2UgcWVtdSBzYXZlIGZpbGUgZm9yIFZNIGZvcmsuXG4iCisgICAgICAiLS1sYXVuY2gtZG0gPHll
c3xub3xsYXRlPiAgICBMYXVuY2ggZGV2aWNlIG1vZGVsIChRRU1VKSBmb3IgVk0gZm9yay5cbiIK
KyAgICAgICItLWZvcmstcmVzZXQgICAgICAgICAgICAgICAgIFJlc2V0IFZNIGZvcmsuXG4iCisg
ICAgICAiLXAgICAgICAgICAgICAgICAgICAgICAgICAgICBEbyBub3QgdW5wYXVzZSBmb3JrIFZN
IGFmdGVyIG9wZXJhdGlvbi5cbiIKKyAgICAgICItZCAgICAgICAgICAgICAgICAgICAgICAgICAg
IEVuYWJsZSBkZWJ1ZyBtZXNzYWdlcy5cbiIKKyAgICB9LAogI2VuZGlmCiAgICAgeyAiZHVtcC1j
b3JlIiwKICAgICAgICZtYWluX2R1bXBfY29yZSwgMCwgMSwKZGlmZiAtLWdpdCBhL3Rvb2xzL3hs
L3hsX3NhdmVyZXN0b3JlLmMgYi90b29scy94bC94bF9zYXZlcmVzdG9yZS5jCmluZGV4IDliZTAz
M2ZlNjUuLjI1YzIwZDJmMWIgMTAwNjQ0Ci0tLSBhL3Rvb2xzL3hsL3hsX3NhdmVyZXN0b3JlLmMK
KysrIGIvdG9vbHMveGwveGxfc2F2ZXJlc3RvcmUuYwpAQCAtMjI5LDYgKzIyOSwxMDEgQEAgaW50
IG1haW5fcmVzdG9yZShpbnQgYXJnYywgY2hhciAqKmFyZ3YpCiAgICAgcmV0dXJuIEVYSVRfU1VD
Q0VTUzsKIH0KIAoraW50IG1haW5fZm9ya192bShpbnQgYXJnYywgY2hhciAqKmFyZ3YpCit7Cisg
ICAgaW50IHJjLCBkZWJ1ZyA9IDA7CisgICAgdWludDMyX3QgZG9taWRfaW4gPSBJTlZBTElEX0RP
TUlELCBkb21pZF9vdXQgPSBJTlZBTElEX0RPTUlEOworICAgIGludCBsYXVuY2hfZG0gPSAxOwor
ICAgIGJvb2wgcmVzZXQgPSAwOworICAgIGJvb2wgcGF1c2UgPSAwOworICAgIGNvbnN0IGNoYXIg
KmNvbmZpZ19maWxlID0gTlVMTDsKKyAgICBjb25zdCBjaGFyICpkbV9yZXN0b3JlX2ZpbGUgPSBO
VUxMOworCisgICAgaW50IG9wdDsKKyAgICBzdGF0aWMgc3RydWN0IG9wdGlvbiBvcHRzW10gPSB7
CisgICAgICAgIHsibGF1bmNoLWRtIiwgMSwgMCwgJ2wnfSwKKyAgICAgICAgeyJmb3JrLXJlc2V0
IiwgMCwgMCwgJ3InfSwKKyAgICAgICAgQ09NTU9OX0xPTkdfT1BUUworICAgIH07CisKKyAgICBT
V0lUQ0hfRk9SRUFDSF9PUFQob3B0LCAicGhkQzpROmw6ck46RDpCOlY6Iiwgb3B0cywgImZvcmst
dm0iLCAxKSB7CisgICAgY2FzZSAnZCc6CisgICAgICAgIGRlYnVnID0gMTsKKyAgICAgICAgYnJl
YWs7CisgICAgY2FzZSAncCc6CisgICAgICAgIHBhdXNlID0gMTsKKyAgICAgICAgYnJlYWs7Cisg
ICAgY2FzZSAnQyc6CisgICAgICAgIGNvbmZpZ19maWxlID0gb3B0YXJnOworICAgICAgICBicmVh
azsKKyAgICBjYXNlICdRJzoKKyAgICAgICAgZG1fcmVzdG9yZV9maWxlID0gb3B0YXJnOworICAg
ICAgICBicmVhazsKKyAgICBjYXNlICdsJzoKKyAgICAgICAgaWYgKCAhc3RyY21wKG9wdGFyZywg
Im5vIikgKQorICAgICAgICAgICAgbGF1bmNoX2RtID0gMDsKKyAgICAgICAgaWYgKCAhc3RyY21w
KG9wdGFyZywgInllcyIpICkKKyAgICAgICAgICAgIGxhdW5jaF9kbSA9IDE7CisgICAgICAgIGlm
ICggIXN0cmNtcChvcHRhcmcsICJsYXRlIikgKQorICAgICAgICAgICAgbGF1bmNoX2RtID0gMjsK
KyAgICAgICAgYnJlYWs7CisgICAgY2FzZSAncic6CisgICAgICAgIHJlc2V0ID0gMTsKKyAgICAg
ICAgYnJlYWs7CisgICAgY2FzZSAnTic6IC8qIGZhbGwtdGhyb3VnaCAqLworICAgIGNhc2UgJ0Qn
OiAvKiBmYWxsLXRocm91Z2ggKi8KKyAgICBjYXNlICdCJzogLyogZmFsbC10aHJvdWdoICovCisg
ICAgY2FzZSAnVic6CisgICAgICAgIGZwcmludGYoc3RkZXJyLCAiVW5pbXBsZW1lbnRlZCBvcHRp
b24ocylcbiIpOworICAgICAgICByZXR1cm4gRVhJVF9GQUlMVVJFOworICAgIH0KKworICAgIGlm
IChhcmdjLW9wdGluZCA9PSAxKSB7CisgICAgICAgIGRvbWlkX2luID0gYXRvaShhcmd2W29wdGlu
ZF0pOworICAgIH0gZWxzZSB7CisgICAgICAgIGhlbHAoImZvcmstdm0iKTsKKyAgICAgICAgcmV0
dXJuIEVYSVRfRkFJTFVSRTsKKyAgICB9CisKKyAgICBpZiAobGF1bmNoX2RtICYmICghY29uZmln
X2ZpbGUgfHwgIWRtX3Jlc3RvcmVfZmlsZSkpIHsKKyAgICAgICAgZnByaW50ZihzdGRlcnIsICJD
dXJyZW50bHkgeW91IG11c3QgcHJvdmlkZSBib3RoIC1DIGFuZCAtUSBvcHRpb25zXG4iKTsKKyAg
ICAgICAgcmV0dXJuIEVYSVRfRkFJTFVSRTsKKyAgICB9CisKKyAgICBpZiAocmVzZXQpIHsKKyAg
ICAgICAgZG9taWRfb3V0ID0gZG9taWRfaW47CisgICAgICAgIGlmIChsaWJ4bF9kb21haW5fZm9y
a19yZXNldChjdHgsIGRvbWlkX2luKSA9PSBFWElUX0ZBSUxVUkUpCisgICAgICAgICAgICByZXR1
cm4gRVhJVF9GQUlMVVJFOworICAgIH0KKworICAgIGlmIChsYXVuY2hfZG0gPT0gMiB8fCByZXNl
dCkgeworICAgICAgICBkb21pZF9vdXQgPSBkb21pZF9pbjsKKyAgICAgICAgcmMgPSBFWElUX1NV
Q0NFU1M7CisgICAgfSBlbHNlCisgICAgICAgIHJjID0gbGlieGxfZG9tYWluX2Zvcmtfdm0oY3R4
LCBkb21pZF9pbiwgJmRvbWlkX291dCk7CisKKyAgICBpZiAocmMgPT0gRVhJVF9TVUNDRVNTICYm
IGxhdW5jaF9kbSkgeworICAgICAgICBzdHJ1Y3QgZG9tYWluX2NyZWF0ZSBkb21faW5mbzsKKyAg
ICAgICAgbWVtc2V0KCZkb21faW5mbywgMCwgc2l6ZW9mKGRvbV9pbmZvKSk7CisgICAgICAgIGRv
bV9pbmZvLmRkb21pZCA9IGRvbWlkX291dDsKKyAgICAgICAgZG9tX2luZm8uZG1fcmVzdG9yZV9m
aWxlID0gZG1fcmVzdG9yZV9maWxlOworICAgICAgICBkb21faW5mby5kZWJ1ZyA9IGRlYnVnOwor
ICAgICAgICBkb21faW5mby5wYXVzZWQgPSBwYXVzZTsKKyAgICAgICAgZG9tX2luZm8uY29uZmln
X2ZpbGUgPSBjb25maWdfZmlsZTsKKyAgICAgICAgZG9tX2luZm8ubWlncmF0ZV9mZCA9IC0xOwor
ICAgICAgICBkb21faW5mby5zZW5kX2JhY2tfZmQgPSAtMTsKKyAgICAgICAgcmMgPSBjcmVhdGVf
ZG9tYWluKCZkb21faW5mbykgPCAwID8gRVhJVF9GQUlMVVJFIDogRVhJVF9TVUNDRVNTOworICAg
IH0KKworICAgIGlmIChyYyA9PSBFWElUX1NVQ0NFU1MgJiYgIXBhdXNlKQorICAgICAgICByYyA9
IGxpYnhsX2RvbWFpbl91bnBhdXNlKGN0eCwgZG9taWRfb3V0LCBOVUxMKTsKKworICAgIGlmIChy
YyA9PSBFWElUX1NVQ0NFU1MpCisgICAgICAgIGZwcmludGYoc3RkZXJyLCAiZm9yay12bSBjb21t
YW5kIHN1Y2Nlc3NmdWxseSByZXR1cm5lZCBkb21pZDogJXVcbiIsIGRvbWlkX291dCk7CisKKyAg
ICByZXR1cm4gcmM7Cit9CisKIGludCBtYWluX3NhdmUoaW50IGFyZ2MsIGNoYXIgKiphcmd2KQog
ewogICAgIHVpbnQzMl90IGRvbWlkOwpkaWZmIC0tZ2l0IGEvdG9vbHMveGwveGxfdm1jb250cm9s
LmMgYi90b29scy94bC94bF92bWNvbnRyb2wuYwppbmRleCBlNTIwYjFkYTc5Li5kOWNiMTljNTk5
IDEwMDY0NAotLS0gYS90b29scy94bC94bF92bWNvbnRyb2wuYworKysgYi90b29scy94bC94bF92
bWNvbnRyb2wuYwpAQCAtNjQ1LDYgKzY0NSw3IEBAIGludCBjcmVhdGVfZG9tYWluKHN0cnVjdCBk
b21haW5fY3JlYXRlICpkb21faW5mbykKIAogICAgIGxpYnhsX2RvbWFpbl9jb25maWcgZF9jb25m
aWc7CiAKKyAgICB1aW50MzJfdCBkZG9taWQgPSBkb21faW5mby0+ZGRvbWlkOyAvLyBsYXVuY2gg
ZG0gZm9yIHRoaXMgZG9tYWluIGlmZiBzZXQKICAgICBpbnQgZGVidWcgPSBkb21faW5mby0+ZGVi
dWc7CiAgICAgaW50IGRhZW1vbml6ZSA9IGRvbV9pbmZvLT5kYWVtb25pemU7CiAgICAgaW50IG1v
bml0b3IgPSBkb21faW5mby0+bW9uaXRvcjsKQEAgLTY1NSw2ICs2NTYsNyBAQCBpbnQgY3JlYXRl
X2RvbWFpbihzdHJ1Y3QgZG9tYWluX2NyZWF0ZSAqZG9tX2luZm8pCiAgICAgY29uc3QgY2hhciAq
cmVzdG9yZV9maWxlID0gZG9tX2luZm8tPnJlc3RvcmVfZmlsZTsKICAgICBjb25zdCBjaGFyICpj
b25maWdfc291cmNlID0gTlVMTDsKICAgICBjb25zdCBjaGFyICpyZXN0b3JlX3NvdXJjZSA9IE5V
TEw7CisgICAgY29uc3QgY2hhciAqZG1fcmVzdG9yZV9maWxlID0gZG9tX2luZm8tPmRtX3Jlc3Rv
cmVfZmlsZTsKICAgICBpbnQgbWlncmF0ZV9mZCA9IGRvbV9pbmZvLT5taWdyYXRlX2ZkOwogICAg
IGJvb2wgY29uZmlnX2luX2pzb247CiAKQEAgLTkyMyw2ICs5MjUsMTIgQEAgc3RhcnQ6CiAgICAg
ICAgICAqIHJlc3RvcmUvbWlncmF0ZS1yZWNlaXZlIGl0IGFnYWluLgogICAgICAgICAgKi8KICAg
ICAgICAgcmVzdG9yaW5nID0gMDsKKyAgICB9IGVsc2UgaWYgKCBkZG9taWQgKSB7CisgICAgICAg
IGRfY29uZmlnLmRtX3Jlc3RvcmVfZmlsZSA9IGRtX3Jlc3RvcmVfZmlsZTsKKyAgICAgICAgcmV0
ID0gbGlieGxfZG9tYWluX2ZvcmtfbGF1bmNoX2RtKGN0eCwgJmRfY29uZmlnLCBkZG9taWQsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvY29ubmVjdF9jb25z
b2xlX2hvdyk7CisgICAgICAgIGRvbWlkID0gZGRvbWlkOworICAgICAgICBkZG9taWQgPSBJTlZB
TElEX0RPTUlEOwogICAgIH0gZWxzZSBpZiAoZG9taWRfc29mdF9yZXNldCAhPSBJTlZBTElEX0RP
TUlEKSB7CiAgICAgICAgIC8qIERvIHNvZnQgcmVzZXQuICovCiAgICAgICAgIHJldCA9IGxpYnhs
X2RvbWFpbl9zb2Z0X3Jlc2V0KGN0eCwgJmRfY29uZmlnLCBkb21pZF9zb2Z0X3Jlc2V0LAotLSAK
Mi4yMC4xCgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18K
WGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0
cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

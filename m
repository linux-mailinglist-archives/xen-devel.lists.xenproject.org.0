Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 66B36B93B4
	for <lists+xen-devel@lfdr.de>; Fri, 20 Sep 2019 17:09:12 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iBKTr-0007Iy-GJ; Fri, 20 Sep 2019 15:05:55 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=qXnC=XP=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1iBKTp-0007It-Tl
 for xen-devel@lists.xenproject.org; Fri, 20 Sep 2019 15:05:53 +0000
X-Inumbo-ID: 2345ab4e-dbb8-11e9-9592-12813bfff9fa
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 2345ab4e-dbb8-11e9-9592-12813bfff9fa;
 Fri, 20 Sep 2019 15:05:52 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id A8534AD12;
 Fri, 20 Sep 2019 15:05:51 +0000 (UTC)
To: Juergen Gross <jgross@suse.com>,
 Joshua Whitehead <josh.whitehead@dornerworks.com>,
 Robert VanVossen <Robert.VanVossen@dornerworks.com>
References: <20190914085251.18816-1-jgross@suse.com>
 <20190914085251.18816-25-jgross@suse.com>
From: Jan Beulich <jbeulich@suse.com>
Message-ID: <73c41851-cba3-c8aa-b031-dcfb3dcff6a4@suse.com>
Date: Fri, 20 Sep 2019 17:05:59 +0200
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:60.0) Gecko/20100101
 Thunderbird/60.9.0
MIME-Version: 1.0
In-Reply-To: <20190914085251.18816-25-jgross@suse.com>
Content-Language: en-US
Subject: Re: [Xen-devel] [PATCH v3 24/47] xen: switch from for_each_vcpu()
 to for_each_sched_unit()
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, xen-devel@lists.xenproject.org,
 Dario Faggioli <dfaggioli@suse.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

T24gMTQuMDkuMjAxOSAxMDo1MiwgSnVlcmdlbiBHcm9zcyB3cm90ZToKPiBAQCAtNTA4LDI1ICs1
MTUsMjcgQEAgaW50IHNjaGVkX21vdmVfZG9tYWluKHN0cnVjdCBkb21haW4gKmQsIHN0cnVjdCBj
cHVwb29sICpjKQo+ICAgICAgaWYgKCBJU19FUlIoZG9tZGF0YSkgKQo+ICAgICAgICAgIHJldHVy
biBQVFJfRVJSKGRvbWRhdGEpOwo+ICAKPiAtICAgIHZjcHVfcHJpdiA9IHh6YWxsb2NfYXJyYXko
dm9pZCAqLCBkLT5tYXhfdmNwdXMpOwo+IC0gICAgaWYgKCB2Y3B1X3ByaXYgPT0gTlVMTCApCj4g
KyAgICAvKiBUT0RPOiBmaXggYXJyYXkgc2l6ZSB3aXRoIG11bHRpcGxlIHZjcHVzIHBlciB1bml0
LiAqLwo+ICsgICAgdW5pdF9wcml2ID0geHphbGxvY19hcnJheSh2b2lkICosIGQtPm1heF92Y3B1
cyk7Cj4gKyAgICBpZiAoIHVuaXRfcHJpdiA9PSBOVUxMICkKPiAgICAgIHsKPiAgICAgICAgICBz
Y2hlZF9mcmVlX2RvbWRhdGEoYy0+c2NoZWQsIGRvbWRhdGEpOwo+ICAgICAgICAgIHJldHVybiAt
RU5PTUVNOwo+ICAgICAgfQo+ICAKPiAtICAgIGZvcl9lYWNoX3ZjcHUgKCBkLCB2ICkKPiArICAg
IHVuaXRfaWR4ID0gMDsKPiArICAgIGZvcl9lYWNoX3NjaGVkX3VuaXQgKCBkLCB1bml0ICkKPiAg
ICAgIHsKPiAtICAgICAgICB2Y3B1X3ByaXZbdi0+dmNwdV9pZF0gPSBzY2hlZF9hbGxvY192ZGF0
YShjLT5zY2hlZCwgdi0+c2NoZWRfdW5pdCwKPiAtICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBkb21kYXRhKTsKPiAtICAgICAgICBpZiAoIHZjcHVfcHJp
dlt2LT52Y3B1X2lkXSA9PSBOVUxMICkKPiArICAgICAgICB1bml0X3ByaXZbdW5pdF9pZHhdID0g
c2NoZWRfYWxsb2NfdmRhdGEoYy0+c2NoZWQsIHVuaXQsIGRvbWRhdGEpOwo+ICsgICAgICAgIGlm
ICggdW5pdF9wcml2W3VuaXRfaWR4XSA9PSBOVUxMICkKPiAgICAgICAgICB7Cj4gLSAgICAgICAg
ICAgIGZvcl9lYWNoX3ZjcHUgKCBkLCB2ICkKPiAtICAgICAgICAgICAgICAgIHhmcmVlKHZjcHVf
cHJpdlt2LT52Y3B1X2lkXSk7Cj4gLSAgICAgICAgICAgIHhmcmVlKHZjcHVfcHJpdik7Cj4gKyAg
ICAgICAgICAgIGZvciAoIHVuaXRfaWR4ID0gMDsgdW5pdF9wcml2W3VuaXRfaWR4XTsgdW5pdF9p
ZHgrKyApCj4gKyAgICAgICAgICAgICAgICBzY2hlZF9mcmVlX3ZkYXRhKGMtPnNjaGVkLCB1bml0
X3ByaXZbdW5pdF9pZHhdKTsKClRoaXMgaXMgYW4gdW5leHBlY3RlZCBjaGFuZ2UgZnJvbSB4ZnJl
ZSgpIHRvIHNjaGVkX2ZyZWVfdmRhdGEoKS4gSWYKaXQgcmVhbGx5IGlzIGNvcnJlY3QsIGl0IHNo
b3VsZCBiZSBtZW50aW9uZWQgaW4gdGhlIGRlc2NyaXB0aW9uLiBJCmNhbiBzZWUgd2h5IHRoaXMg
bWlnaHQgYmUgYmV0dGVyIGZyb20gYW4gYWJzdHJhY3QgcG92LCBidXQgaXQncwpxdWVzdGlvbmFi
bGUgd2hldGhlciBhcmluYzY1MydzIHVwZGF0ZV9zY2hlZHVsZV92Y3B1cygpIHJlYWxseSB3YW50
cwpjYWxsaW5nIGF0IHRoaXMgcG9pbnQgKHBlcmhhcHMgaXQgZG9lcywgYXMgYTY1M3NjaGVkX2Fs
bG9jX3ZkYXRhKCkKYWxzbyBjYWxscyBpdCkuCgpKb3NoLCBSb2JlcnQ6IEJlc2lkZXMgdGhpcyBp
bW1lZGlhdGUgYXNwZWN0IEkgYWxzbyB3b25kZXIgd2hldGhlcgpzYWlkIGNhbGwgaXMgY29ycmVj
dCB0byBtYWtlIG91dHNpZGUgb2YgYSBzY2hlZF9wcml2LT5sb2NrJ2VkCnJlZ2lvbiwgd2hlbiBi
b3RoIG90aGVyIGluc3RhbmNlcyBvY2N1ciBpbnNpZGUgb2Ygb25lIChhbmQgaW4gb25lCmNhc2Ug
aW1tZWRpYXRlbHkgYmVmb3JlIGFuIHVubG9jaywgaS5lLiBpZiB0aGUgbG9jayB3YXNuJ3QgbmVl
ZGVkCnRoZSB0d28gc3RlcHMgY291bGQgd2VsbCBiZSByZS1vcmRlcmVkKS4KCkZpbmFsbHksIGF0
IHRoaXMgcG9pbnQsIHNob3VsZG4ndCB0aGUgZnVuY3Rpb25zIGFuZCBob29rcyAoYWxyZWFkeSkK
YmUgbmFtZWQge2FsbG9jLGZyZWV9X3VkYXRhKCk/Cgo+IEBAIC04OTYsMTggKzkyOSwyMiBAQCB2
b2lkIHJlc3RvcmVfdmNwdV9hZmZpbml0eShzdHJ1Y3QgZG9tYWluICpkKQo+ICAgICAgICAgICAg
ICAgICAgICAgIGNwdXBvb2xfZG9tYWluX2NwdW1hc2soZCkpOwo+ICAgICAgICAgIGlmICggY3B1
bWFza19lbXB0eShjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSkpICkKPiAgICAgICAgICB7Cj4gLSAg
ICAgICAgICAgIGlmICggdi0+YWZmaW5pdHlfYnJva2VuICkKPiArICAgICAgICAgICAgaWYgKCBz
Y2hlZF9jaGVja19hZmZpbml0eV9icm9rZW4odW5pdCkgKQo+ICAgICAgICAgICAgICB7Cj4gLSAg
ICAgICAgICAgICAgICBzY2hlZF9zZXRfYWZmaW5pdHkodiwgdW5pdC0+Y3B1X2hhcmRfYWZmaW5p
dHlfc2F2ZWQsIE5VTEwpOwo+IC0gICAgICAgICAgICAgICAgdi0+YWZmaW5pdHlfYnJva2VuID0g
MDsKPiArICAgICAgICAgICAgICAgIC8qIEFmZmluaXR5IHNldHRpbmdzIG9mIG9uZSB2Y3B1IGFy
ZSBmb3IgdGhlIGNvbXBsZXRlIHVuaXQuICovCj4gKyAgICAgICAgICAgICAgICBzY2hlZF9zZXRf
YWZmaW5pdHkodW5pdC0+dmNwdV9saXN0LAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5X3NhdmVkLCBOVUxMKTsKCllldCBkZXNwaXRl
IHRoZSBjb21tZW50IHRoZSBmdW5jdGlvbiBnZXRzIHBhc3NlZCBhIHN0cnVjdCB2Y3B1ICosCmFu
ZCB0aGlzIGRvZXNuJ3QgbG9vayB0byBjaGFuZ2UgYnkgdGhlIGVuZCBvZiB0aGUgc2VyaWVzLiBJ
cyB0aGVyZQphIHJlYXNvbiBmb3IgdGhpcz8KCj4gQEAgLTk1MCwxNyArOTg2LDE5IEBAIGludCBj
cHVfZGlzYWJsZV9zY2hlZHVsZXIodW5zaWduZWQgaW50IGNwdSkKPiAgCj4gICAgICBmb3JfZWFj
aF9kb21haW5faW5fY3B1cG9vbCAoIGQsIGMgKQo+ICAgICAgewo+IC0gICAgICAgIGZvcl9lYWNo
X3ZjcHUgKCBkLCB2ICkKPiArICAgICAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdDsKPiArCj4g
KyAgICAgICAgZm9yX2VhY2hfc2NoZWRfdW5pdCAoIGQsIHVuaXQgKQo+ICAgICAgICAgIHsKPiAg
ICAgICAgICAgICAgdW5zaWduZWQgbG9uZyBmbGFnczsKPiAtICAgICAgICAgICAgc3RydWN0IHNj
aGVkX3VuaXQgKnVuaXQgPSB2LT5zY2hlZF91bml0Owo+ICAgICAgICAgICAgICBzcGlubG9ja190
ICpsb2NrID0gdW5pdF9zY2hlZHVsZV9sb2NrX2lycXNhdmUodW5pdCwgJmZsYWdzKTsKPiAgCj4g
ICAgICAgICAgICAgIGNwdW1hc2tfYW5kKCZvbmxpbmVfYWZmaW5pdHksIHVuaXQtPmNwdV9oYXJk
X2FmZmluaXR5LCBjLT5jcHVfdmFsaWQpOwo+ICAgICAgICAgICAgICBpZiAoIGNwdW1hc2tfZW1w
dHkoJm9ubGluZV9hZmZpbml0eSkgJiYKPiAgICAgICAgICAgICAgICAgICBjcHVtYXNrX3Rlc3Rf
Y3B1KGNwdSwgdW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHkpICkKPiAgICAgICAgICAgICAgewo+IC0g
ICAgICAgICAgICAgICAgaWYgKCB2LT5hZmZpbml0eV9icm9rZW4gKQo+ICsgICAgICAgICAgICAg
ICAgLyogVE9ETzogbXVsdGlwbGUgdmNwdXMgcGVyIHVuaXQuICovCj4gKyAgICAgICAgICAgICAg
ICBpZiAoIHVuaXQtPnZjcHVfbGlzdC0+YWZmaW5pdHlfYnJva2VuICkKCldoeSBub3Qgc2NoZWRf
Y2hlY2tfYWZmaW5pdHlfYnJva2VuKHVuaXQpPyBRdWl0ZSBwb3NzaWJseSB0aGlzIHdvdWxkCm1h
a2UgdGhlIFRPRE8gaXRlbSB1bm5lY2Vzc2FyeT8KCj4gQEAgLTk2OCwxNCArMTAwNiwxNSBAQCBp
bnQgY3B1X2Rpc2FibGVfc2NoZWR1bGVyKHVuc2lnbmVkIGludCBjcHUpCj4gICAgICAgICAgICAg
ICAgICAgICAgYnJlYWs7Cj4gICAgICAgICAgICAgICAgICB9Cj4gIAo+IC0gICAgICAgICAgICAg
ICAgcHJpbnRrKFhFTkxPR19ERUJVRyAiQnJlYWtpbmcgYWZmaW5pdHkgZm9yICVwdlxuIiwgdik7
Cj4gKyAgICAgICAgICAgICAgICBwcmludGsoWEVOTE9HX0RFQlVHICJCcmVha2luZyBhZmZpbml0
eSBmb3IgJXB2XG4iLAo+ICsgICAgICAgICAgICAgICAgICAgICAgIHVuaXQtPnZjcHVfbGlzdCk7
Cj4gIAo+IC0gICAgICAgICAgICAgICAgc2NoZWRfc2V0X2FmZmluaXR5KHYsICZjcHVtYXNrX2Fs
bCwgTlVMTCk7Cj4gKyAgICAgICAgICAgICAgICBzY2hlZF9zZXRfYWZmaW5pdHkodW5pdC0+dmNw
dV9saXN0LCAmY3B1bWFza19hbGwsIE5VTEwpOwo+ICAgICAgICAgICAgICB9Cj4gIAo+IC0gICAg
ICAgICAgICBpZiAoIHYtPnByb2Nlc3NvciAhPSBjcHUgKQo+ICsgICAgICAgICAgICBpZiAoIHNj
aGVkX3VuaXRfY3B1KHVuaXQpICE9IHNjaGVkX2dldF9yZXNvdXJjZV9jcHUoY3B1KSApCgpEaWRu
J3QgeW91IGFncmVlIHRoYXQgdGhpcyBjYW4gYmUgaGFkIGNoZWFwZXI/IFF1aXRlIGxpa2VseSBt
eSB2MgpyZXZpZXcgcmVtYXJrIHdhcyBvbiBhIGRpZmZlcmVudCBpbnN0YW5jZSwgYnV0IHRoZSBw
YXR0ZXJuIG91Z2h0CnRvIGJlIHJlbGF0aXZlbHkgc2ltcGxlIHRvIGZpbmQgaW4gdGhlIGVudGly
ZSBzZXJpZXMgKGFuZCBieSB0aGUKZW5kIG9mIHRoZSBzZXJpZXMgdGhlcmUncyBvbmUgb3RoZXIg
aW5zdGFuY2UgaW4gc2NoZWR1bGUuYyAuLi4KCj4gQEAgLTk4OCwxNyArMTAyNywxOCBAQCBpbnQg
Y3B1X2Rpc2FibGVfc2NoZWR1bGVyKHVuc2lnbmVkIGludCBjcHUpCj4gICAgICAgICAgICAgICAq
ICAqIHRoZSBzY2hlZHVsZXIgd2lsbCBhbHdheXMgZmluZCBhIHN1aXRhYmxlIHNvbHV0aW9uLCBv
cgo+ICAgICAgICAgICAgICAgKiAgICB0aGluZ3Mgd291bGQgaGF2ZSBmYWlsZWQgYmVmb3JlIGdl
dHRpbmcgaW4gaGVyZS4KPiAgICAgICAgICAgICAgICovCj4gLSAgICAgICAgICAgIHZjcHVfbWln
cmF0ZV9zdGFydCh2KTsKPiArICAgICAgICAgICAgLyogVE9ETzogbXVsdGlwbGUgdmNwdXMgcGVy
IHVuaXQuICovCj4gKyAgICAgICAgICAgIHZjcHVfbWlncmF0ZV9zdGFydCh1bml0LT52Y3B1X2xp
c3QpOwo+ICAgICAgICAgICAgICB1bml0X3NjaGVkdWxlX3VubG9ja19pcnFyZXN0b3JlKGxvY2ss
IGZsYWdzLCB1bml0KTsKPiAgCj4gLSAgICAgICAgICAgIHZjcHVfbWlncmF0ZV9maW5pc2godik7
Cj4gKyAgICAgICAgICAgIHZjcHVfbWlncmF0ZV9maW5pc2godW5pdC0+dmNwdV9saXN0KTsKPiAg
Cj4gICAgICAgICAgICAgIC8qCj4gICAgICAgICAgICAgICAqIFRoZSBvbmx5IGNhdmVhdCwgaW4g
dGhpcyBjYXNlLCBpcyB0aGF0IGlmIGEgdmNwdSBhY3RpdmUgaW4KPiAgICAgICAgICAgICAgICog
dGhlIGh5cGVydmlzb3IgaXNuJ3QgbWlncmF0YWJsZS4gSW4gdGhpcyBjYXNlLCB0aGUgY2FsbGVy
Cj4gICAgICAgICAgICAgICAqIHNob3VsZCB0cnkgYWdhaW4gYWZ0ZXIgcmVsZWFzaW5nIGFuZCBy
ZWFxdWlyaW5nIGFsbCBsb2Nrcy4KPiAgICAgICAgICAgICAgICovCj4gLSAgICAgICAgICAgIGlm
ICggdi0+cHJvY2Vzc29yID09IGNwdSApCj4gKyAgICAgICAgICAgIGlmICggc2NoZWRfdW5pdF9j
cHUodW5pdCkgPT0gc2NoZWRfZ2V0X3Jlc291cmNlX2NwdShjcHUpICkKCi4uLiBoZXJlOyBJIGRp
ZG4ndCBjaGVjayBvdGhlciBmaWxlcykuCgo+IEBAIC0xMDA5LDggKzEwNDksOCBAQCBpbnQgY3B1
X2Rpc2FibGVfc2NoZWR1bGVyKHVuc2lnbmVkIGludCBjcHUpCj4gIHN0YXRpYyBpbnQgY3B1X2Rp
c2FibGVfc2NoZWR1bGVyX2NoZWNrKHVuc2lnbmVkIGludCBjcHUpCj4gIHsKPiAgICAgIHN0cnVj
dCBkb21haW4gKmQ7Cj4gLSAgICBzdHJ1Y3QgdmNwdSAqdjsKPiAgICAgIHN0cnVjdCBjcHVwb29s
ICpjOwo+ICsgICAgc3RydWN0IHZjcHUgKnY7CgpVbm5lY2Vzc2FyeSBjaGFuZ2U/CgpKYW4KCl9f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBt
YWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMu
eGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

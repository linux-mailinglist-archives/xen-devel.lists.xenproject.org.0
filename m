Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 9692BBB85B
	for <lists+xen-devel@lfdr.de>; Mon, 23 Sep 2019 17:48:04 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iCQVv-0005mi-CW; Mon, 23 Sep 2019 15:44:35 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=cYas=XS=citrix.com=paul.durrant@srs-us1.protection.inumbo.net>)
 id 1iCQVt-0005mb-Lz
 for xen-devel@lists.xenproject.org; Mon, 23 Sep 2019 15:44:33 +0000
X-Inumbo-ID: 08e28ff2-de19-11e9-b299-bc764e2007e4
Received: from esa2.hc3370-68.iphmx.com (unknown [216.71.145.153])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 08e28ff2-de19-11e9-b299-bc764e2007e4;
 Mon, 23 Sep 2019 15:44:32 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1569253472;
 h=from:to:cc:subject:date:message-id:references:
 in-reply-to:content-transfer-encoding:mime-version;
 bh=tdcwRGw3aMIyLedjiLEZojEv3bRpDbO8LemTrIuFZzI=;
 b=R3GcOPAGgHqqecOhLladMcaS8Ug9Bj0afHzsGOhaaDqYlcmxp8Y+yuOu
 QEazHV8SOrkyrCgJNWtwPNPgsGgeiVPBEnQDBH/9EmdhEtdQ9Ul6lL+sc
 l69NTvKk8Ex8qzMvOCZew7bNwdDvOUcZ5QkBNTSDmQe475j7je4HflkRh s=;
Authentication-Results: esa2.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=Paul.Durrant@citrix.com;
 spf=Pass smtp.mailfrom=Paul.Durrant@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa2.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 Paul.Durrant@citrix.com) identity=pra;
 client-ip=162.221.158.21; receiver=esa2.hc3370-68.iphmx.com;
 envelope-from="Paul.Durrant@citrix.com";
 x-sender="Paul.Durrant@citrix.com"; x-conformance=sidf_compatible
Received-SPF: Pass (esa2.hc3370-68.iphmx.com: domain of
 Paul.Durrant@citrix.com designates 162.221.158.21 as
 permitted sender) identity=mailfrom;
 client-ip=162.221.158.21; receiver=esa2.hc3370-68.iphmx.com;
 envelope-from="Paul.Durrant@citrix.com";
 x-sender="Paul.Durrant@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83 ~all"
Received-SPF: None (esa2.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa2.hc3370-68.iphmx.com;
 envelope-from="Paul.Durrant@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: RXqXUANnY4n6JWi7AvGV6caouTCmbJgw63eXNoP83xF7biypvofgiMTHZkIt4oZvsJ9FpYaBfx
 NF4sPTfX4YLVYbFEJkc/IuIkG+U/nV0vgqdZ9OBIWMHM64eossj4KnPAa9T1iAB/28LgAy4bug
 IrF+cTsQa4mFhazEtObwE9XQNIuuwiNao69G06WVKjxEarPZw1C43Rn9Tx/fJ9RnHlS/2QmZgK
 icxB4RDSBolO2X1ZmEjc/w0YKN3SRxvX+JEDgRZbBHNjFUZ7bINWjWlpG/I8anlBDz5h8VxyQb
 fVk=
X-SBRS: 2.7
X-MesageID: 5936272
X-Ironport-Server: esa2.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.64,540,1559534400"; 
   d="scan'208";a="5936272"
From: Paul Durrant <Paul.Durrant@citrix.com>
To: 'Jan Beulich' <jbeulich@suse.com>, "xen-devel@lists.xenproject.org"
 <xen-devel@lists.xenproject.org>
Thread-Topic: [Xen-devel] [PATCH v6 2/8] AMD/IOMMU: make phantom functions
 share interrupt remapping tables
Thread-Index: AQHVbu1q4lZTEzcxd0ivqPr6FWq1q6c5bZqg
Date: Mon, 23 Sep 2019 15:44:27 +0000
Message-ID: <9ad3b3efed48473f93a02c6f44c3af80@AMSPEX02CL03.citrite.net>
References: <aa62726c-5aa4-8bcd-dc35-61eb8dfeaee3@suse.com>
 <06a35251-013f-d215-d70c-70a4c98ac86e@suse.com>
In-Reply-To: <06a35251-013f-d215-d70c-70a4c98ac86e@suse.com>
Accept-Language: en-GB, en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-ms-exchange-transport-fromentityheader: Hosted
MIME-Version: 1.0
Subject: Re: [Xen-devel] [PATCH v6 2/8] AMD/IOMMU: make phantom functions
 share interrupt remapping tables
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <Andrew.Cooper3@citrix.com>,
 Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

PiAtLS0tLU9yaWdpbmFsIE1lc3NhZ2UtLS0tLQ0KPiBGcm9tOiBYZW4tZGV2ZWwgPHhlbi1kZXZl
bC1ib3VuY2VzQGxpc3RzLnhlbnByb2plY3Qub3JnPiBPbiBCZWhhbGYgT2YgSmFuIEJldWxpY2gN
Cj4gU2VudDogMTkgU2VwdGVtYmVyIDIwMTkgMTQ6MjINCj4gVG86IHhlbi1kZXZlbEBsaXN0cy54
ZW5wcm9qZWN0Lm9yZw0KPiBDYzogQW5kcmV3IENvb3BlciA8QW5kcmV3LkNvb3BlcjNAY2l0cml4
LmNvbT47IFN1cmF2ZWUgU3V0aGlrdWxwYW5pdCA8c3VyYXZlZS5zdXRoaWt1bHBhbml0QGFtZC5j
b20+DQo+IFN1YmplY3Q6IFtYZW4tZGV2ZWxdIFtQQVRDSCB2NiAyLzhdIEFNRC9JT01NVTogbWFr
ZSBwaGFudG9tIGZ1bmN0aW9ucyBzaGFyZSBpbnRlcnJ1cHQgcmVtYXBwaW5nIHRhYmxlcw0KPiAN
Cj4gUmF0aGVyIHRoYW4gZHVwbGljYXRpbmcgZW50cmllcyBpbiBhbWRfaW9tbXVfbXNpX21zZ191
cGRhdGVfaXJlKCksIHNoYXJlDQo+IHRoZSB0YWJsZXMuIFRoaXMgbWFpbmx5IHJlcXVpcmVzIHNv
bWUgY2FyZSB3aGlsZSBmcmVlaW5nIHRoZW0sIHRvIGF2b2lkDQo+IGZyZWVpbmcgbWVtb3J5IGJs
b2NrcyB0d2ljZS4NCj4gDQo+IFNpZ25lZC1vZmYtYnk6IEphbiBCZXVsaWNoIDxqYmV1bGljaEBz
dXNlLmNvbT4NCj4gQWNrZWQtYnk6IEFuZHJldyBDb29wZXIgPGFuZHJldy5jb29wZXIzQGNpdHJp
eC5jb20+DQoNClJldmlld2VkLWJ5OiBQYXVsIER1cnJhbnQgPHBhdWwuZHVycmFudEBjaXRyaXgu
Y29tPg0KDQo+IC0tLQ0KPiB2NTogTmV3Lg0KPiANCj4gLS0tDQo+ICB4ZW4vZHJpdmVycy9wYXNz
dGhyb3VnaC9hbWQvaW9tbXVfaW5pdC5jICAgICAgfCAgIDQzICsrKysrKysrKysrKysrKy0tLS0t
LS0tLQ0KPiAgeGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL2lvbW11X2ludHIuYyAgICAgIHwg
ICA0NSArKysrKysrKysrKysrLS0tLS0tLS0tLS0tLQ0KPiAgeGVuL2RyaXZlcnMvcGFzc3Rocm91
Z2gvYW1kL3BjaV9hbWRfaW9tbXUuYyAgIHwgICAgMiAtDQo+ICB4ZW4vaW5jbHVkZS9hc20teDg2
L2FtZC1pb21tdS5oICAgICAgICAgICAgICAgfCAgICAyIC0NCj4gIHhlbi9pbmNsdWRlL2FzbS14
ODYvaHZtL3N2bS9hbWQtaW9tbXUtcHJvdG8uaCB8ICAgIDIgLQ0KPiAgNSBmaWxlcyBjaGFuZ2Vk
LCA1MyBpbnNlcnRpb25zKCspLCA0MSBkZWxldGlvbnMoLSkNCj4gDQo+IC0tLSBhL3hlbi9kcml2
ZXJzL3Bhc3N0aHJvdWdoL2FtZC9pb21tdV9pbml0LmMNCj4gKysrIGIveGVuL2RyaXZlcnMvcGFz
c3Rocm91Z2gvYW1kL2lvbW11X2luaXQuYw0KPiBAQCAtMTExMSw3ICsxMTExLDcgQEAgc3RhdGlj
IHZvaWQgX19pbml0IGFtZF9pb21tdV9pbml0X2NsZWFudQ0KPiAgICAgICAgICBhbWRfaW9tbXVf
ZnJlZV9pbnRyZW1hcF90YWJsZShsaXN0X2ZpcnN0X2VudHJ5KCZhbWRfaW9tbXVfaGVhZCwNCj4g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBz
dHJ1Y3QgYW1kX2lvbW11LA0KPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGxpc3QpLA0KPiAtICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBOVUxMKTsNCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgTlVMTCwgMCk7DQo+IA0KPiAgICAgIC8qIGZyZWUgYW1kIGlvbW11IGxpc3QgKi8NCj4gICAg
ICBsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUgKCBpb21tdSwgbmV4dCwgJmFtZF9pb21tdV9oZWFk
LCBsaXN0ICkNCj4gQEAgLTExNzYsNyArMTE3Niw3IEBAIGludCBpdGVyYXRlX2l2cnNfbWFwcGlu
Z3MoaW50ICgqaGFuZGxlcikNCj4gIH0NCj4gDQo+ICBpbnQgaXRlcmF0ZV9pdnJzX2VudHJpZXMo
aW50ICgqaGFuZGxlcikoY29uc3Qgc3RydWN0IGFtZF9pb21tdSAqLA0KPiAtICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBpdnJzX21hcHBpbmdzICopKQ0KPiAr
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBpdnJzX21hcHBp
bmdzICosIHVpbnQxNl90IGJkZikpDQo+ICB7DQo+ICAgICAgdTE2IHNlZyA9IDA7DQo+ICAgICAg
aW50IHJjID0gMDsNCj4gQEAgLTExOTMsNyArMTE5Myw3IEBAIGludCBpdGVyYXRlX2l2cnNfZW50
cmllcyhpbnQgKCpoYW5kbGVyKSgNCj4gICAgICAgICAgICAgIGNvbnN0IHN0cnVjdCBhbWRfaW9t
bXUgKmlvbW11ID0gbWFwW2JkZl0uaW9tbXU7DQo+IA0KPiAgICAgICAgICAgICAgaWYgKCBpb21t
dSAmJiBtYXBbYmRmXS5kdGVfcmVxdWVzdG9yX2lkID09IGJkZiApDQo+IC0gICAgICAgICAgICAg
ICAgcmMgPSBoYW5kbGVyKGlvbW11LCAmbWFwW2JkZl0pOw0KPiArICAgICAgICAgICAgICAgIHJj
ID0gaGFuZGxlcihpb21tdSwgJm1hcFtiZGZdLCBiZGYpOw0KPiAgICAgICAgICB9DQo+ICAgICAg
fSB3aGlsZSAoICFyYyAmJiArK3NlZyApOw0KPiANCj4gQEAgLTEyODYsMjAgKzEyODYsMjkgQEAg
c3RhdGljIGludCBfX2luaXQgYW1kX2lvbW11X3NldHVwX2RldmljZQ0KPiANCj4gICAgICAgICAg
ICAgIGlmICggcGRldiApDQo+ICAgICAgICAgICAgICB7DQo+IC0gICAgICAgICAgICAgICAgdW5z
aWduZWQgaW50IHJlcV9pZCA9IGJkZjsNCj4gLQ0KPiAtICAgICAgICAgICAgICAgIGRvIHsNCj4g
LSAgICAgICAgICAgICAgICAgICAgaXZyc19tYXBwaW5nc1tyZXFfaWRdLmludHJlbWFwX3RhYmxl
ID0NCj4gLSAgICAgICAgICAgICAgICAgICAgICAgIGFtZF9pb21tdV9hbGxvY19pbnRyZW1hcF90
YWJsZSgNCj4gLSAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdnJzX21hcHBpbmdzW2JkZl0u
aW9tbXUsDQo+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAgJml2cnNfbWFwcGluZ3NbcmVx
X2lkXS5pbnRyZW1hcF9pbnVzZSk7DQo+IC0gICAgICAgICAgICAgICAgICAgIGlmICggIWl2cnNf
bWFwcGluZ3NbcmVxX2lkXS5pbnRyZW1hcF90YWJsZSApDQo+IC0gICAgICAgICAgICAgICAgICAg
ICAgICByZXR1cm4gLUVOT01FTTsNCj4gLQ0KPiAtICAgICAgICAgICAgICAgICAgICBpZiAoICFw
ZGV2LT5waGFudG9tX3N0cmlkZSApDQo+IC0gICAgICAgICAgICAgICAgICAgICAgICBicmVhazsN
Cj4gLSAgICAgICAgICAgICAgICAgICAgcmVxX2lkICs9IHBkZXYtPnBoYW50b21fc3RyaWRlOw0K
PiAtICAgICAgICAgICAgICAgIH0gd2hpbGUgKCBQQ0lfU0xPVChyZXFfaWQpID09IHBkZXYtPnNi
ZGYuZGV2ICk7DQo+ICsgICAgICAgICAgICAgICAgaXZyc19tYXBwaW5nc1tiZGZdLmludHJlbWFw
X3RhYmxlID0NCj4gKyAgICAgICAgICAgICAgICAgICAgYW1kX2lvbW11X2FsbG9jX2ludHJlbWFw
X3RhYmxlKA0KPiArICAgICAgICAgICAgICAgICAgICAgICAgaXZyc19tYXBwaW5nc1tiZGZdLmlv
bW11LA0KPiArICAgICAgICAgICAgICAgICAgICAgICAgJml2cnNfbWFwcGluZ3NbYmRmXS5pbnRy
ZW1hcF9pbnVzZSk7DQo+ICsgICAgICAgICAgICAgICAgaWYgKCAhaXZyc19tYXBwaW5nc1tiZGZd
LmludHJlbWFwX3RhYmxlICkNCj4gKyAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC1FTk9NRU07
DQo+ICsNCj4gKyAgICAgICAgICAgICAgICBpZiAoIHBkZXYtPnBoYW50b21fc3RyaWRlICkNCj4g
KyAgICAgICAgICAgICAgICB7DQo+ICsgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCBy
ZXFfaWQgPSBiZGY7DQo+ICsNCj4gKyAgICAgICAgICAgICAgICAgICAgZm9yICggOyA7ICkNCj4g
KyAgICAgICAgICAgICAgICAgICAgew0KPiArICAgICAgICAgICAgICAgICAgICAgICAgcmVxX2lk
ICs9IHBkZXYtPnBoYW50b21fc3RyaWRlOw0KPiArICAgICAgICAgICAgICAgICAgICAgICAgaWYg
KCBQQ0lfU0xPVChyZXFfaWQpICE9IHBkZXYtPnNiZGYuZGV2ICkNCj4gKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBicmVhazsNCj4gKw0KPiArICAgICAgICAgICAgICAgICAgICAgICAgaXZy
c19tYXBwaW5nc1tyZXFfaWRdLmludHJlbWFwX3RhYmxlID0NCj4gKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBpdnJzX21hcHBpbmdzW2JkZl0uaW50cmVtYXBfdGFibGU7DQo+ICsgICAgICAg
ICAgICAgICAgICAgICAgICBpdnJzX21hcHBpbmdzW3JlcV9pZF0uaW50cmVtYXBfaW51c2UgPQ0K
PiArICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl2cnNfbWFwcGluZ3NbYmRmXS5pbnRyZW1h
cF9pbnVzZTsNCj4gKyAgICAgICAgICAgICAgICAgICAgfQ0KPiArICAgICAgICAgICAgICAgIH0N
Cj4gICAgICAgICAgICAgIH0NCj4gDQo+ICAgICAgICAgICAgICBhbWRfaW9tbXVfc2V0X2ludHJl
bWFwX3RhYmxlKA0KPiAtLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfaW50
ci5jDQo+ICsrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9pb21tdV9pbnRyLmMNCj4g
QEAgLTcxMSwzMyArNzExLDIwIEBAIGludCBhbWRfaW9tbXVfbXNpX21zZ191cGRhdGVfaXJlKA0K
PiANCj4gICAgICBpZiAoIG1zaV9kZXNjLT5yZW1hcF9pbmRleCA+PSAwICYmICFtc2cgKQ0KPiAg
ICAgIHsNCj4gLSAgICAgICAgZG8gew0KPiAtICAgICAgICAgICAgdXBkYXRlX2ludHJlbWFwX2Vu
dHJ5X2Zyb21fbXNpX21zZyhpb21tdSwgYmRmLCBuciwNCj4gLSAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgJm1zaV9kZXNjLT5yZW1hcF9pbmRleCwNCj4gLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTlVMTCwgTlVMTCk7
DQo+IC0gICAgICAgICAgICBpZiAoICFwZGV2IHx8ICFwZGV2LT5waGFudG9tX3N0cmlkZSApDQo+
IC0gICAgICAgICAgICAgICAgYnJlYWs7DQo+IC0gICAgICAgICAgICBiZGYgKz0gcGRldi0+cGhh
bnRvbV9zdHJpZGU7DQo+IC0gICAgICAgIH0gd2hpbGUgKCBQQ0lfU0xPVChiZGYpID09IFBDSV9T
TE9UKHBkZXYtPmRldmZuKSApOw0KPiArICAgICAgICB1cGRhdGVfaW50cmVtYXBfZW50cnlfZnJv
bV9tc2lfbXNnKGlvbW11LCBiZGYsIG5yLA0KPiArICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICZtc2lfZGVzYy0+cmVtYXBfaW5kZXgsDQo+ICsgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTlVMTCwgTlVMTCk7DQo+IA0KPiAgICAgICAg
ICBmb3IgKCBpID0gMDsgaSA8IG5yOyArK2kgKQ0KPiAgICAgICAgICAgICAgbXNpX2Rlc2NbaV0u
cmVtYXBfaW5kZXggPSAtMTsNCj4gLSAgICAgICAgaWYgKCBwZGV2ICkNCj4gLSAgICAgICAgICAg
IGJkZiA9IFBDSV9CREYyKHBkZXYtPmJ1cywgcGRldi0+ZGV2Zm4pOw0KPiAgICAgIH0NCj4gDQo+
ICAgICAgaWYgKCAhbXNnICkNCj4gICAgICAgICAgcmV0dXJuIDA7DQo+IA0KPiAtICAgIGRvIHsN
Cj4gLSAgICAgICAgcmMgPSB1cGRhdGVfaW50cmVtYXBfZW50cnlfZnJvbV9tc2lfbXNnKGlvbW11
LCBiZGYsIG5yLA0KPiAtICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgJm1zaV9kZXNjLT5yZW1hcF9pbmRleCwNCj4gLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIG1zZywgJmRhdGEpOw0KPiAtICAgICAgICBpZiAoIHJj
IHx8ICFwZGV2IHx8ICFwZGV2LT5waGFudG9tX3N0cmlkZSApDQo+IC0gICAgICAgICAgICBicmVh
azsNCj4gLSAgICAgICAgYmRmICs9IHBkZXYtPnBoYW50b21fc3RyaWRlOw0KPiAtICAgIH0gd2hp
bGUgKCBQQ0lfU0xPVChiZGYpID09IFBDSV9TTE9UKHBkZXYtPmRldmZuKSApOw0KPiAtDQo+ICsg
ICAgcmMgPSB1cGRhdGVfaW50cmVtYXBfZW50cnlfZnJvbV9tc2lfbXNnKGlvbW11LCBiZGYsIG5y
LA0KPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmbXNpX2Rl
c2MtPnJlbWFwX2luZGV4LA0KPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBtc2csICZkYXRhKTsNCj4gICAgICBpZiAoICFyYyApDQo+ICAgICAgew0KPiAgICAg
ICAgICBmb3IgKCBpID0gMTsgaSA8IG5yOyArK2kgKQ0KPiBAQCAtNzkwLDEyICs3NzcsMjcgQEAg
dm9pZCBhbWRfaW9tbXVfcmVhZF9tc2lfZnJvbV9pcmUoDQo+ICB9DQo+IA0KPiAgaW50IGFtZF9p
b21tdV9mcmVlX2ludHJlbWFwX3RhYmxlKA0KPiAtICAgIGNvbnN0IHN0cnVjdCBhbWRfaW9tbXUg
KmlvbW11LCBzdHJ1Y3QgaXZyc19tYXBwaW5ncyAqaXZyc19tYXBwaW5nKQ0KPiArICAgIGNvbnN0
IHN0cnVjdCBhbWRfaW9tbXUgKmlvbW11LCBzdHJ1Y3QgaXZyc19tYXBwaW5ncyAqaXZyc19tYXBw
aW5nLA0KPiArICAgIHVpbnQxNl90IGJkZikNCj4gIHsNCj4gICAgICB2b2lkICoqdGJscDsNCj4g
DQo+ICAgICAgaWYgKCBpdnJzX21hcHBpbmcgKQ0KPiAgICAgIHsNCj4gKyAgICAgICAgdW5zaWdu
ZWQgaW50IGk7DQo+ICsNCj4gKyAgICAgICAgLyoNCj4gKyAgICAgICAgICogUENJIGRldmljZSBw
aGFudG9tIGZ1bmN0aW9ucyB1c2UgdGhlIHNhbWUgdGFibGVzIGFzIHRoZWlyICJiYXNlIg0KPiAr
ICAgICAgICAgKiBmdW5jdGlvbjogTG9vayBhaGVhZCB0byB6YXAgdGhlIHBvaW50ZXJzLg0KPiAr
ICAgICAgICAgKi8NCj4gKyAgICAgICAgZm9yICggaSA9IDE7IFBDSV9GVU5DKGJkZiArIGkpICYm
IGJkZiArIGkgPCBpdnJzX2JkZl9lbnRyaWVzOyArK2kgKQ0KPiArICAgICAgICAgICAgaWYgKCBp
dnJzX21hcHBpbmdbaV0uaW50cmVtYXBfdGFibGUgPT0NCj4gKyAgICAgICAgICAgICAgICAgaXZy
c19tYXBwaW5nLT5pbnRyZW1hcF90YWJsZSApDQo+ICsgICAgICAgICAgICB7DQo+ICsgICAgICAg
ICAgICAgICAgaXZyc19tYXBwaW5nW2ldLmludHJlbWFwX3RhYmxlID0gTlVMTDsNCj4gKyAgICAg
ICAgICAgICAgICBpdnJzX21hcHBpbmdbaV0uaW50cmVtYXBfaW51c2UgPSBOVUxMOw0KPiArICAg
ICAgICAgICAgfQ0KPiArDQo+ICAgICAgICAgIFhGUkVFKGl2cnNfbWFwcGluZy0+aW50cmVtYXBf
aW51c2UpOw0KPiAgICAgICAgICB0YmxwID0gJml2cnNfbWFwcGluZy0+aW50cmVtYXBfdGFibGU7
DQo+ICAgICAgfQ0KPiBAQCAtOTM0LDcgKzkzNiw4IEBAIHN0YXRpYyB2b2lkIGR1bXBfaW50cmVt
YXBfdGFibGUoY29uc3Qgc3QNCj4gIH0NCj4gDQo+ICBzdGF0aWMgaW50IGR1bXBfaW50cmVtYXBf
bWFwcGluZyhjb25zdCBzdHJ1Y3QgYW1kX2lvbW11ICppb21tdSwNCj4gLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHN0cnVjdCBpdnJzX21hcHBpbmdzICppdnJzX21hcHBpbmcpDQo+
ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgaXZyc19tYXBwaW5ncyAq
aXZyc19tYXBwaW5nLA0KPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDE2
X3QgdW51c2VkKQ0KPiAgew0KPiAgICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7DQo+IA0KPiAtLS0g
YS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvcGNpX2FtZF9pb21tdS5jDQo+ICsrKyBiL3hl
bi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9wY2lfYW1kX2lvbW11LmMNCj4gQEAgLTUxOSw3ICs1
MTksNyBAQCBzdGF0aWMgaW50IGFtZF9pb21tdV9yZW1vdmVfZGV2aWNlKHU4IGRlDQo+ICAgICAg
aWYgKCBhbWRfaW9tbXVfcGVyZGV2X2ludHJlbWFwICYmDQo+ICAgICAgICAgICBpdnJzX21hcHBp
bmdzW2JkZl0uZHRlX3JlcXVlc3Rvcl9pZCA9PSBiZGYgJiYNCj4gICAgICAgICAgIGl2cnNfbWFw
cGluZ3NbYmRmXS5pbnRyZW1hcF90YWJsZSApDQo+IC0gICAgICAgIGFtZF9pb21tdV9mcmVlX2lu
dHJlbWFwX3RhYmxlKGlvbW11LCAmaXZyc19tYXBwaW5nc1tiZGZdKTsNCj4gKyAgICAgICAgYW1k
X2lvbW11X2ZyZWVfaW50cmVtYXBfdGFibGUoaW9tbXUsICZpdnJzX21hcHBpbmdzW2JkZl0sIGJk
Zik7DQo+IA0KPiAgICAgIHJldHVybiAwOw0KPiAgfQ0KPiAtLS0gYS94ZW4vaW5jbHVkZS9hc20t
eDg2L2FtZC1pb21tdS5oDQo+ICsrKyBiL3hlbi9pbmNsdWRlL2FzbS14ODYvYW1kLWlvbW11LmgN
Cj4gQEAgLTEzMSw3ICsxMzEsNyBAQCBleHRlcm4gdTggaXZoZF90eXBlOw0KPiAgc3RydWN0IGl2
cnNfbWFwcGluZ3MgKmdldF9pdnJzX21hcHBpbmdzKHUxNiBzZWcpOw0KPiAgaW50IGl0ZXJhdGVf
aXZyc19tYXBwaW5ncyhpbnQgKCopKHUxNiBzZWcsIHN0cnVjdCBpdnJzX21hcHBpbmdzICopKTsN
Cj4gIGludCBpdGVyYXRlX2l2cnNfZW50cmllcyhpbnQgKCopKGNvbnN0IHN0cnVjdCBhbWRfaW9t
bXUgKiwNCj4gLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBpdnJzX21h
cHBpbmdzICopKTsNCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBp
dnJzX21hcHBpbmdzICosIHVpbnQxNl90KSk7DQo+IA0KPiAgLyogaW9tbXUgdGFibGVzIGluIGd1
ZXN0IHNwYWNlICovDQo+ICBzdHJ1Y3QgbW1pb19yZWcgew0KPiAtLS0gYS94ZW4vaW5jbHVkZS9h
c20teDg2L2h2bS9zdm0vYW1kLWlvbW11LXByb3RvLmgNCj4gKysrIGIveGVuL2luY2x1ZGUvYXNt
LXg4Ni9odm0vc3ZtL2FtZC1pb21tdS1wcm90by5oDQo+IEBAIC0xMDEsNyArMTAxLDcgQEAgaW50
IGFtZF9pb21tdV9zZXR1cF9pb2FwaWNfcmVtYXBwaW5nKHZvaQ0KPiAgdm9pZCAqYW1kX2lvbW11
X2FsbG9jX2ludHJlbWFwX3RhYmxlKA0KPiAgICAgIGNvbnN0IHN0cnVjdCBhbWRfaW9tbXUgKiwg
dW5zaWduZWQgbG9uZyAqKik7DQo+ICBpbnQgYW1kX2lvbW11X2ZyZWVfaW50cmVtYXBfdGFibGUo
DQo+IC0gICAgY29uc3Qgc3RydWN0IGFtZF9pb21tdSAqLCBzdHJ1Y3QgaXZyc19tYXBwaW5ncyAq
KTsNCj4gKyAgICBjb25zdCBzdHJ1Y3QgYW1kX2lvbW11ICosIHN0cnVjdCBpdnJzX21hcHBpbmdz
ICosIHVpbnQxNl90KTsNCj4gIHZvaWQgYW1kX2lvbW11X2lvYXBpY191cGRhdGVfaXJlKA0KPiAg
ICAgIHVuc2lnbmVkIGludCBhcGljLCB1bnNpZ25lZCBpbnQgcmVnLCB1bnNpZ25lZCBpbnQgdmFs
dWUpOw0KPiAgdW5zaWduZWQgaW50IGFtZF9pb21tdV9yZWFkX2lvYXBpY19mcm9tX2lyZSgNCj4g
DQo+IA0KPiBfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXw0K
PiBYZW4tZGV2ZWwgbWFpbGluZyBsaXN0DQo+IFhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9y
Zw0KPiBodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRl
dmVsDQpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4t
ZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczov
L2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

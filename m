Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id DBF31A59C9
	for <lists+xen-devel@lfdr.de>; Mon,  2 Sep 2019 16:53:00 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i4nfG-0006Uz-Nl; Mon, 02 Sep 2019 14:50:42 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=R1Xd=W5=citrix.com=paul.durrant@srs-us1.protection.inumbo.net>)
 id 1i4nfF-0006UL-Bj
 for xen-devel@lists.xenproject.org; Mon, 02 Sep 2019 14:50:41 +0000
X-Inumbo-ID: 00095f70-cd91-11e9-b95f-bc764e2007e4
Received: from esa6.hc3370-68.iphmx.com (unknown [216.71.155.175])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 00095f70-cd91-11e9-b95f-bc764e2007e4;
 Mon, 02 Sep 2019 14:50:27 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1567435827;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=C4M2NrTfw4xNPQGteqUoFyG0XrCoExJE0pWId0MBDQ0=;
 b=bxhp/8C+wyHYzfnRv+iO9A4bE1GX8wZb74+JTG2g/TuKUp85InrYmrT5
 sDgDTGB9kXmToj0dsqBIPudekr6OJkAVdchvu2YBgpUIZ2bWAHTuuw1yz
 2T2z4NVnCvz5ZoZpY306sQ2+18P/962DachhkA8fYOpV7s16T/ysBzmA2 I=;
Authentication-Results: esa6.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=paul.durrant@citrix.com;
 spf=Pass smtp.mailfrom=Paul.Durrant@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa6.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 paul.durrant@citrix.com) identity=pra;
 client-ip=162.221.158.21; receiver=esa6.hc3370-68.iphmx.com;
 envelope-from="Paul.Durrant@citrix.com";
 x-sender="paul.durrant@citrix.com"; x-conformance=sidf_compatible
Received-SPF: Pass (esa6.hc3370-68.iphmx.com: domain of
 Paul.Durrant@citrix.com designates 162.221.158.21 as
 permitted sender) identity=mailfrom;
 client-ip=162.221.158.21; receiver=esa6.hc3370-68.iphmx.com;
 envelope-from="Paul.Durrant@citrix.com";
 x-sender="Paul.Durrant@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83 ~all"
Received-SPF: None (esa6.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa6.hc3370-68.iphmx.com;
 envelope-from="Paul.Durrant@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: /r6E1CCU4c5nQUwTzVo+CBY07r0WAwFmUsmBa427n6OUsVFinX9vIhZb+nedwd4Ad/WESpXXsd
 Ione1FpyZPYei0Vq+lx0gaYWMgsJwFiF5Wcn0ZT2q/zv9mC5etMzIU1ek3GIlowElPO1qXQpGb
 z74Kd9j3cW2MmYmmbLppRQ9A3WW/NWhDcn34E3qzHfPPWzSDt78KDf+/uQwVJcxELI6RLcibn/
 QeVp9kaJe99b9Sbn1JoxwFYREzdqWQDBGjx6ODAVMKOjCC8+imlp0l6/jVDsSpw5PQz6mDGimA
 OXA=
X-SBRS: 2.7
X-MesageID: 5242804
X-Ironport-Server: esa6.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.64,459,1559534400"; 
   d="scan'208";a="5242804"
From: Paul Durrant <paul.durrant@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Mon, 2 Sep 2019 15:50:12 +0100
Message-ID: <20190902145014.36442-5-paul.durrant@citrix.com>
X-Mailer: git-send-email 2.20.1.2.gb21ebb671
In-Reply-To: <20190902145014.36442-1-paul.durrant@citrix.com>
References: <20190902145014.36442-1-paul.durrant@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v8 4/6] remove late (on-demand) construction of
 IOMMU page tables
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Petre Pircalabu <ppircalabu@bitdefender.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Razvan Cojocaru <rcojocaru@bitdefender.com>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Paul Durrant <paul.durrant@citrix.com>,
 Tamas K Lengyel <tamas@tklengyel.com>, Jan
 Beulich <jbeulich@suse.com>, Alexandru Isaila <aisaila@bitdefender.com>,
 Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

Tm93IHRoYXQgdGhlcmUgaXMgYSBwZXItZG9tYWluIElPTU1VLWVuYWJsZSBmbGFnLCB3aGljaCBz
aG91bGQgYmUgc2V0IGlmCmFueSBkZXZpY2UgaXMgZ29pbmcgdG8gYmUgcGFzc2VkIHRocm91Z2gs
IHN0b3AgZGVmZXJyaW5nIHBhZ2UgdGFibGUKY29uc3RydWN0aW9uIHVudGlsIHRoZSBhc3NpZ25t
ZW50IGlzIGRvbmUuIEFsc28gZG9uJ3QgdGVhciBkb3duIHRoZSB0YWJsZXMKYWdhaW4gd2hlbiB0
aGUgbGFzdCBkZXZpY2UgaXMgZGUtYXNzaWduZWQ7IGRlZmVyIHRoYXQgdGFzayB1bnRpbCBkb21h
aW4KZGVzdHJ1Y3Rpb24uCgpUaGlzIGFsbG93cyB0aGUgaGFzX2lvbW11X3B0KCkgaGVscGVyIGFu
ZCBpb21tdV9zdGF0dXMgZW51bWVyYXRpb24gdG8gYmUKcmVtb3ZlZC4gQ2FsbHMgdG8gaGFzX2lv
bW11X3B0KCkgYXJlIHNpbXBseSByZXBsYWNlZCBieSBjYWxscyB0bwppc19pb21tdV9lbmFibGVk
KCkuIFJlbWFpbmluZyBvcGVuLWNvZGVkIHRlc3RzIG9mIGlvbW11X2hhcF9wdF9zaGFyZSBjYW4K
YWxzbyBiZSByZXBsYWNlZCBieSBjYWxscyB0byBpb21tdV91c2VfaGFwX3B0KCkuClRoZSBhcmNo
X2lvbW11X3BvcHVsYXRlX3BhZ2VfdGFibGUoKSBhbmQgaW9tbXVfY29uc3RydWN0KCkgZnVuY3Rp
b25zIGJlY29tZQpyZWR1bmRhbnQsIGFzIGRvZXMgdGhlICdzdHJpY3QgbW9kZScgZG9tMCBwYWdl
X2xpc3QgbWFwcGluZyBjb2RlIGluCmlvbW11X2h3ZG9tX2luaXQoKSwgYW5kIGlvbW11X3RlYXJk
b3duKCkgY2FuIGJlIG1hZGUgc3RhdGljIGlzIGl0cyBvbmx5CnJlbWFpbmluZyBjYWxsZXIsIGlv
bW11X2RvbWFpbl9kZXN0cm95KCksIGlzIHdpdGhpbiB0aGUgc2FtZSBzb3VyY2UKbW9kdWxlLgoK
QWxsIGluIGFsbCwgYWJvdXQgMjIwIGxpbmVzIG9mIGNvZGUgYXJlIHJlbW92ZWQgZnJvbSB0aGUg
aHlwZXJ2aXNvci4KCk5PVEU6IFRoaXMgcGF0Y2ggd2lsbCBjYXVzZSBhIHNtYWxsIGFtb3VudCBv
ZiBleHRyYSByZXNvdXJjZSB0byBiZSB1c2VkCiAgICAgIHRvIGFjY29tbW9kYXRlIElPTU1VIHBh
Z2UgdGFibGVzIHRoYXQgbWF5IG5ldmVyIGJlIHVzZWQsIHNpbmNlIHRoZQogICAgICBwZXItZG9t
YWluIElPTU1VLWVuYWJsZSBmbGFnIGlzIGN1cnJlbnRseSBzZXQgdG8gdGhlIHZhbHVlIG9mIHRo
ZQogICAgICBnbG9iYWwgaW9tbXVfZW5hYmxlIGZsYWcuIEEgc3Vic2VxdWVudCBwYXRjaCB3aWxs
IGFkZCBhbiBvcHRpb24gdG8KICAgICAgdGhlIHRvb2xzdGFjayB0byBhbGxvdyBpdCB0byBiZSB0
dXJuZWQgb2ZmIGlmIHRoZXJlIGlzIG5vIGludGVudGlvbgogICAgICB0byBhc3NpZ24gcGFzc3Ro
cm91Z2ggaGFyZHdhcmUgdG8gdGhlIGRvbWFpbi4KICAgICAgVG8gYWNjb3VudCBmb3IgdGhlIGV4
dHJhIHJlc291cmNlLCAnaW9tbXVfbWVta2InIGhhcyBiZWVuIGFkZGVkIHRvCiAgICAgIGRvbWFp
bl9idWlsZF9pbmZvLiBUaGlzIHBhdGNoIHNldHMgaXQgdW5jb25kaXRpb25hbGx5IHRvIGEgdmFs
dWUKICAgICAgY2FsY3VsYXRlZCBiYXNlZCBvbiB0aGUgZG9tYWluJ3MgbWF4aW11bSBtZW1vcnkg
YnV0LCB3aGVuIHRoZQogICAgICB0b29sc3RhY2sgb3B0aW9uIG1lbnRpb25lZCBhYm92ZSBpcyBh
ZGRlZCwgaXQgY2FuIGJlIHNldCB0byB6ZXJvCiAgICAgIGlmIHRoZSBwZXItZG9tYWluIElPTU1V
LWVuYWJsZSBmbGFnIGlzIHR1cm5lZCBvZmYuCgpTaWduZWQtb2ZmLWJ5OiBQYXVsIER1cnJhbnQg
PHBhdWwuZHVycmFudEBjaXRyaXguY29tPgpSZXZpZXdlZC1ieTogQWxleGFuZHJ1IElzYWlsYSA8
YWlzYWlsYUBiaXRkZWZlbmRlci5jb20+CkFja2VkLWJ5OiBSYXp2YW4gQ29qb2NhcnUgPHJjb2pv
Y2FydUBiaXRkZWZlbmRlci5jb20+ClJldmlld2VkLWJ5OiBKYW4gQmV1bGljaCA8amJldWxpY2hA
c3VzZS5jb20+Ci0tLQpDYzogU3RlZmFubyBTdGFiZWxsaW5pIDxzc3RhYmVsbGluaUBrZXJuZWwu
b3JnPgpDYzogSnVsaWVuIEdyYWxsIDxqdWxpZW4uZ3JhbGxAYXJtLmNvbT4KQ2M6IFZvbG9keW15
ciBCYWJjaHVrIDxWb2xvZHlteXJfQmFiY2h1a0BlcGFtLmNvbT4KQ2M6IEFuZHJldyBDb29wZXIg
PGFuZHJldy5jb29wZXIzQGNpdHJpeC5jb20+CkNjOiBHZW9yZ2UgRHVubGFwIDxHZW9yZ2UuRHVu
bGFwQGV1LmNpdHJpeC5jb20+CkNjOiBJYW4gSmFja3NvbiA8aWFuLmphY2tzb25AZXUuY2l0cml4
LmNvbT4KQ2M6IEtvbnJhZCBSemVzenV0ZWsgV2lsayA8a29ucmFkLndpbGtAb3JhY2xlLmNvbT4K
Q2M6IFRpbSBEZWVnYW4gPHRpbUB4ZW4ub3JnPgpDYzogV2VpIExpdSA8d2xAeGVuLm9yZz4KQ2M6
ICJSb2dlciBQYXUgTW9ubsOpIiA8cm9nZXIucGF1QGNpdHJpeC5jb20+CkNjOiBUYW1hcyBLIExl
bmd5ZWwgPHRhbWFzQHRrbGVuZ3llbC5jb20+CkNjOiBHZW9yZ2UgRHVubGFwIDxnZW9yZ2UuZHVu
bGFwQGV1LmNpdHJpeC5jb20+CkNjOiBQZXRyZSBQaXJjYWxhYnUgPHBwaXJjYWxhYnVAYml0ZGVm
ZW5kZXIuY29tPgoKUHJldmlvdXNseSBwYXJ0IG9mIHNlcmllcyBodHRwczovL2xpc3RzLnhlbnBy
b2plY3Qub3JnL2FyY2hpdmVzL2h0bWwveGVuLWRldmVsLzIwMTktMDcvbXNnMDIyNjcuaHRtbAoK
djc6CiAtIEFkZCB0b29sc3RhY2sgbWVtb3J5IHJlc2VydmF0aW9uIGZvciBJT01NVSBwYWdlIHRh
Ymxlcy4uLiBSZS11c2Ugb2YKICAgc2hhZG93IGNhbGN1bGF0aW9uIGRpZG4ndCBzZWVtIGFwcHJv
cHJpYXRlIHNvIGEgbmV3IGhlbHBlciBmdW5jdGlvbiBpcwogICBhZGRlZAoKdjU6CiAtIE1pbm9y
IHN0eWxlIGZpeGVzCi0tLQogdG9vbHMvbGlieGwvbGlieGxfbWVtLmMgICAgICAgICAgICAgICB8
ICAgNiArLQogdG9vbHMvbGlieGwvbGlieGxfdHlwZXMuaWRsICAgICAgICAgICB8ICAgMSArCiB0
b29scy9saWJ4bC9saWJ4bF91dGlscy5jICAgICAgICAgICAgIHwgIDE1ICsrKwogdG9vbHMvbGli
eGwvbGlieGxfdXRpbHMuaCAgICAgICAgICAgICB8ICAgMSArCiB0b29scy94bC94bF9wYXJzZS5j
ICAgICAgICAgICAgICAgICAgIHwgICA3ICstCiB4ZW4vYXJjaC9hcm0vcDJtLmMgICAgICAgICAg
ICAgICAgICAgIHwgICAyICstCiB4ZW4vYXJjaC94ODYvZG9tMF9idWlsZC5jICAgICAgICAgICAg
IHwgICAyICstCiB4ZW4vYXJjaC94ODYvaHZtL210cnIuYyAgICAgICAgICAgICAgIHwgICA1ICst
CiB4ZW4vYXJjaC94ODYvbW0vbWVtX3NoYXJpbmcuYyAgICAgICAgIHwgICAyICstCiB4ZW4vYXJj
aC94ODYvbW0vcDJtLmMgICAgICAgICAgICAgICAgIHwgICA0ICstCiB4ZW4vYXJjaC94ODYvbW0v
cGFnaW5nLmMgICAgICAgICAgICAgIHwgICAyICstCiB4ZW4vYXJjaC94ODYveDg2XzY0L21tLmMg
ICAgICAgICAgICAgIHwgICAyICstCiB4ZW4vY29tbW9uL21lbW9yeS5jICAgICAgICAgICAgICAg
ICAgIHwgICA0ICstCiB4ZW4vY29tbW9uL3ZtX2V2ZW50LmMgICAgICAgICAgICAgICAgIHwgICAy
ICstCiB4ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9kZXZpY2VfdHJlZS5jIHwgIDExIC0tLQogeGVu
L2RyaXZlcnMvcGFzc3Rocm91Z2gvaW9tbXUuYyAgICAgICB8IDEzNCArKysrKystLS0tLS0tLS0t
LS0tLS0tLS0tLQogeGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvcGNpLmMgICAgICAgICB8ICAxMiAt
LS0KIHhlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9pb21tdS5jICAgfCAgMTAgKy0KIHhlbi9k
cml2ZXJzL3Bhc3N0aHJvdWdoL3g4Ni9pb21tdS5jICAgfCAgOTcgLS0tLS0tLS0tLS0tLS0tLS0t
LQogeGVuL2luY2x1ZGUvYXNtLWFybS9pb21tdS5oICAgICAgICAgICB8ICAgMiArLQogeGVuL2lu
Y2x1ZGUvYXNtLXg4Ni9pb21tdS5oICAgICAgICAgICB8ICAgMiArLQogeGVuL2luY2x1ZGUveGVu
L2lvbW11LmggICAgICAgICAgICAgICB8ICAxNiAtLS0KIHhlbi9pbmNsdWRlL3hlbi9zY2hlZC5o
ICAgICAgICAgICAgICAgfCAgIDIgLQogMjMgZmlsZXMgY2hhbmdlZCwgNzAgaW5zZXJ0aW9ucygr
KSwgMjcxIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3Rvb2xzL2xpYnhsL2xpYnhsX21lbS5j
IGIvdG9vbHMvbGlieGwvbGlieGxfbWVtLmMKaW5kZXggNDQ4YTJhZjhmZC4uZmQ2ZjMzMzEyZSAx
MDA2NDQKLS0tIGEvdG9vbHMvbGlieGwvbGlieGxfbWVtLmMKKysrIGIvdG9vbHMvbGlieGwvbGli
eGxfbWVtLmMKQEAgLTQ2MSwxNSArNDYxLDE3IEBAIGludCBsaWJ4bF9kb21haW5fbmVlZF9tZW1v
cnkobGlieGxfY3R4ICpjdHgsCiAgICAgaWYgKHJjKSBnb3RvIG91dDsKIAogICAgICpuZWVkX21l
bWtiID0gYl9pbmZvLT50YXJnZXRfbWVta2I7CisgICAgKm5lZWRfbWVta2IgKz0gYl9pbmZvLT5z
aGFkb3dfbWVta2IgKyBiX2luZm8tPmlvbW11X21lbWtiOworCiAgICAgc3dpdGNoIChiX2luZm8t
PnR5cGUpIHsKICAgICBjYXNlIExJQlhMX0RPTUFJTl9UWVBFX1BWSDoKICAgICBjYXNlIExJQlhM
X0RPTUFJTl9UWVBFX0hWTToKLSAgICAgICAgKm5lZWRfbWVta2IgKz0gYl9pbmZvLT5zaGFkb3df
bWVta2IgKyBMSUJYTF9IVk1fRVhUUkFfTUVNT1JZOworICAgICAgICAqbmVlZF9tZW1rYiArPSBM
SUJYTF9IVk1fRVhUUkFfTUVNT1JZOwogICAgICAgICBpZiAobGlieGxfZGVmYm9vbF92YWwoYl9p
bmZvLT5kZXZpY2VfbW9kZWxfc3R1YmRvbWFpbikpCiAgICAgICAgICAgICAqbmVlZF9tZW1rYiAr
PSAzMiAqIDEwMjQ7CiAgICAgICAgIGJyZWFrOwogICAgIGNhc2UgTElCWExfRE9NQUlOX1RZUEVf
UFY6Ci0gICAgICAgICpuZWVkX21lbWtiICs9IGJfaW5mby0+c2hhZG93X21lbWtiICsgTElCWExf
UFZfRVhUUkFfTUVNT1JZOworICAgICAgICAqbmVlZF9tZW1rYiArPSBMSUJYTF9QVl9FWFRSQV9N
RU1PUlk7CiAgICAgICAgIGJyZWFrOwogICAgIGRlZmF1bHQ6CiAgICAgICAgIHJjID0gRVJST1Jf
SU5WQUw7CmRpZmYgLS1naXQgYS90b29scy9saWJ4bC9saWJ4bF90eXBlcy5pZGwgYi90b29scy9s
aWJ4bC9saWJ4bF90eXBlcy5pZGwKaW5kZXggYjYxMzk5Y2UzNi4uZDk0Yjc0NTNjYiAxMDA2NDQK
LS0tIGEvdG9vbHMvbGlieGwvbGlieGxfdHlwZXMuaWRsCisrKyBiL3Rvb2xzL2xpYnhsL2xpYnhs
X3R5cGVzLmlkbApAQCAtNDg2LDYgKzQ4Niw3IEBAIGxpYnhsX2RvbWFpbl9idWlsZF9pbmZvID0g
U3RydWN0KCJkb21haW5fYnVpbGRfaW5mbyIsWwogICAgICgidGFyZ2V0X21lbWtiIiwgICAgTWVt
S0IpLAogICAgICgidmlkZW9fbWVta2IiLCAgICAgTWVtS0IpLAogICAgICgic2hhZG93X21lbWti
IiwgICAgTWVtS0IpLAorICAgICgiaW9tbXVfbWVta2IiLCAgICAgTWVtS0IpLAogICAgICgicnRj
X3RpbWVvZmZzZXQiLCAgdWludDMyKSwKICAgICAoImV4ZWNfc3NpZHJlZiIsICAgIHVpbnQzMiks
CiAgICAgKCJleGVjX3NzaWRfbGFiZWwiLCBzdHJpbmcpLApkaWZmIC0tZ2l0IGEvdG9vbHMvbGli
eGwvbGlieGxfdXRpbHMuYyBiL3Rvb2xzL2xpYnhsL2xpYnhsX3V0aWxzLmMKaW5kZXggZjM2MGY1
ZTIyOC4uNDA1NzMzYjdlMSAxMDA2NDQKLS0tIGEvdG9vbHMvbGlieGwvbGlieGxfdXRpbHMuYwor
KysgYi90b29scy9saWJ4bC9saWJ4bF91dGlscy5jCkBAIC00OCw2ICs0OCwyMSBAQCB1bnNpZ25l
ZCBsb25nIGxpYnhsX2dldF9yZXF1aXJlZF9zaGFkb3dfbWVtb3J5KHVuc2lnbmVkIGxvbmcgbWF4
bWVtX2tiLCB1bnNpZ25lZAogICAgIHJldHVybiA0ICogKDI1NiAqIHNtcF9jcHVzICsgMiAqICht
YXhtZW1fa2IgLyAxMDI0KSk7CiB9CiAKK3Vuc2lnbmVkIGxvbmcgbGlieGxfZ2V0X3JlcXVpcmVk
X2lvbW11X21lbW9yeSh1bnNpZ25lZCBsb25nIG1heG1lbV9rYikKK3sKKyAgICB1bnNpZ25lZCBs
b25nIGlvbW11X3BhZ2VzID0gMCwgbWVtX3BhZ2VzID0gbWF4bWVtX2tiIC8gNDsKKyAgICB1bnNp
Z25lZCBpbnQgbGV2ZWw7CisKKyAgICAvKiBBc3N1bWUgYSA0IGxldmVsIHBhZ2UgdGFibGUgd2l0
aCA1MTIgZW50cmllcyBwZXIgbGV2ZWwgKi8KKyAgICBmb3IgKGxldmVsID0gMDsgbGV2ZWwgPCA0
OyBsZXZlbCsrKQorICAgIHsKKyAgICAgICAgbWVtX3BhZ2VzID0gRElWX1JPVU5EVVAobWVtX3Bh
Z2VzLCA1MTIpOworICAgICAgICBpb21tdV9wYWdlcyArPSBtZW1fcGFnZXM7CisgICAgfQorCisg
ICAgcmV0dXJuIGlvbW11X3BhZ2VzICogNDsKK30KKwogY2hhciAqbGlieGxfZG9taWRfdG9fbmFt
ZShsaWJ4bF9jdHggKmN0eCwgdWludDMyX3QgZG9taWQpCiB7CiAgICAgdW5zaWduZWQgaW50IGxl
bjsKZGlmZiAtLWdpdCBhL3Rvb2xzL2xpYnhsL2xpYnhsX3V0aWxzLmggYi90b29scy9saWJ4bC9s
aWJ4bF91dGlscy5oCmluZGV4IDQ0NDA5YWZkYzQuLjYzMGNjYmUyOGEgMTAwNjQ0Ci0tLSBhL3Rv
b2xzL2xpYnhsL2xpYnhsX3V0aWxzLmgKKysrIGIvdG9vbHMvbGlieGwvbGlieGxfdXRpbHMuaApA
QCAtMjQsNiArMjQsNyBAQCBjb25zdAogY2hhciAqbGlieGxfYmFzZW5hbWUoY29uc3QgY2hhciAq
bmFtZSk7IC8qIHJldHVybnMgc3RyaW5nIGZyb20gc3RyZHVwICovCiAKIHVuc2lnbmVkIGxvbmcg
bGlieGxfZ2V0X3JlcXVpcmVkX3NoYWRvd19tZW1vcnkodW5zaWduZWQgbG9uZyBtYXhtZW1fa2Is
IHVuc2lnbmVkIGludCBzbXBfY3B1cyk7Cit1bnNpZ25lZCBsb25nIGxpYnhsX2dldF9yZXF1aXJl
ZF9pb21tdV9tZW1vcnkodW5zaWduZWQgbG9uZyBtYXhtZW1fa2IpOwogaW50IGxpYnhsX25hbWVf
dG9fZG9taWQobGlieGxfY3R4ICpjdHgsIGNvbnN0IGNoYXIgKm5hbWUsIHVpbnQzMl90ICpkb21p
ZCk7CiBpbnQgbGlieGxfZG9tYWluX3F1YWxpZmllcl90b19kb21pZChsaWJ4bF9jdHggKmN0eCwg
Y29uc3QgY2hhciAqbmFtZSwgdWludDMyX3QgKmRvbWlkKTsKIGNoYXIgKmxpYnhsX2RvbWlkX3Rv
X25hbWUobGlieGxfY3R4ICpjdHgsIHVpbnQzMl90IGRvbWlkKTsKZGlmZiAtLWdpdCBhL3Rvb2xz
L3hsL3hsX3BhcnNlLmMgYi90b29scy94bC94bF9wYXJzZS5jCmluZGV4IGUxMDViZGEyYmIuLmMx
OTNmZTliYTQgMTAwNjQ0Ci0tLSBhL3Rvb2xzL3hsL3hsX3BhcnNlLmMKKysrIGIvdG9vbHMveGwv
eGxfcGFyc2UuYwpAQCAtMTQ0OCwxNCArMTQ0OCwxNyBAQCB2b2lkIHBhcnNlX2NvbmZpZ19kYXRh
KGNvbnN0IGNoYXIgKmNvbmZpZ19zb3VyY2UsCiAgICAgICAgIGV4aXQoMSk7CiAgICAgfQogCi0g
ICAgLyogbGlieGxfZ2V0X3JlcXVpcmVkX3NoYWRvd19tZW1vcnkoKSBtdXN0IGJlIGNhbGxlZCBh
ZnRlciBmaW5hbCB2YWx1ZXMKKyAgICAvKiBsaWJ4bF9nZXRfcmVxdWlyZWRfc2hhZG93X21lbW9y
eSgpIGFuZAorICAgICAqIGxpYnhsX2dldF9yZXF1aXJlZF9pb21tdV9tZW1vcnkoKSBtdXN0IGJl
IGNhbGxlZCBhZnRlciBmaW5hbCB2YWx1ZXMKICAgICAgKiAoZGVmYXVsdCBvciBzcGVjaWZpZWQp
IGZvciB2Y3B1cyBhbmQgbWVtb3J5IGFyZSBzZXQsIGJlY2F1c2UgdGhlCi0gICAgICogY2FsY3Vs
YXRpb24gZGVwZW5kcyBvbiB0aG9zZSB2YWx1ZXMuICovCisgICAgICogY2FsY3VsYXRpb25zIGRl
cGVuZCBvbiB0aG9zZSB2YWx1ZXMuICovCiAgICAgYl9pbmZvLT5zaGFkb3dfbWVta2IgPSAheGx1
X2NmZ19nZXRfbG9uZyhjb25maWcsICJzaGFkb3dfbWVtb3J5IiwgJmwsIDApCiAgICAgICAgID8g
bCAqIDEwMjQKICAgICAgICAgOiBsaWJ4bF9nZXRfcmVxdWlyZWRfc2hhZG93X21lbW9yeShiX2lu
Zm8tPm1heF9tZW1rYiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBiX2luZm8tPm1heF92Y3B1cyk7CiAKKyAgICBiX2luZm8tPmlvbW11X21lbWtiID0gbGlieGxf
Z2V0X3JlcXVpcmVkX2lvbW11X21lbW9yeShiX2luZm8tPm1heF9tZW1rYik7CisKICAgICB4bHVf
Y2ZnX2dldF9kZWZib29sKGNvbmZpZywgIm5vbWlncmF0ZSIsICZiX2luZm8tPmRpc2FibGVfbWln
cmF0ZSwgMCk7CiAKICAgICBpZiAoIXhsdV9jZmdfZ2V0X2xvbmcoY29uZmlnLCAidHNjX21vZGUi
LCAmbCwgMSkpIHsKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL2FybS9wMm0uYyBiL3hlbi9hcmNoL2Fy
bS9wMm0uYwppbmRleCA3ZjE0NDI5MzJhLi42OTI1NjU3NTdlIDEwMDY0NAotLS0gYS94ZW4vYXJj
aC9hcm0vcDJtLmMKKysrIGIveGVuL2FyY2gvYXJtL3AybS5jCkBAIC0xMDU2LDcgKzEwNTYsNyBA
QCBzdGF0aWMgaW50IF9fcDJtX3NldF9lbnRyeShzdHJ1Y3QgcDJtX2RvbWFpbiAqcDJtLAogICAg
ICAgICAgIW1mbl9lcShscGFlX2dldF9tZm4oKmVudHJ5KSwgbHBhZV9nZXRfbWZuKG9yaWdfcHRl
KSkgKQogICAgICAgICBwMm1fZnJlZV9lbnRyeShwMm0sIG9yaWdfcHRlLCBsZXZlbCk7CiAKLSAg
ICBpZiAoIGhhc19pb21tdV9wdChwMm0tPmRvbWFpbikgJiYKKyAgICBpZiAoIGlzX2lvbW11X2Vu
YWJsZWQocDJtLT5kb21haW4pICYmCiAgICAgICAgICAobHBhZV9pc192YWxpZChvcmlnX3B0ZSkg
fHwgbHBhZV9pc192YWxpZCgqZW50cnkpKSApCiAgICAgewogICAgICAgICB1bnNpZ25lZCBpbnQg
Zmx1c2hfZmxhZ3MgPSAwOwpkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L2RvbTBfYnVpbGQuYyBi
L3hlbi9hcmNoL3g4Ni9kb20wX2J1aWxkLmMKaW5kZXggZDM4MTc4NGVkZC4uN2NmYWIyZGMyNSAx
MDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L2RvbTBfYnVpbGQuYworKysgYi94ZW4vYXJjaC94ODYv
ZG9tMF9idWlsZC5jCkBAIC0zNjUsNyArMzY1LDcgQEAgdW5zaWduZWQgbG9uZyBfX2luaXQgZG9t
MF9jb21wdXRlX25yX3BhZ2VzKAogICAgIH0KIAogICAgIG5lZWRfcGFnaW5nID0gaXNfaHZtX2Rv
bWFpbihkKSAmJgotICAgICAgICAoIWlvbW11X2hhcF9wdF9zaGFyZSB8fCAhcGFnaW5nX21vZGVf
aGFwKGQpKTsKKyAgICAgICAgKCFpb21tdV91c2VfaGFwX3B0KGQpIHx8ICFwYWdpbmdfbW9kZV9o
YXAoZCkpOwogICAgIGZvciAoIDsgOyBuZWVkX3BhZ2luZyA9IGZhbHNlICkKICAgICB7CiAgICAg
ICAgIG5yX3BhZ2VzID0gZ2V0X21lbXNpemUoJmRvbTBfc2l6ZSwgYXZhaWwpOwpkaWZmIC0tZ2l0
IGEveGVuL2FyY2gveDg2L2h2bS9tdHJyLmMgYi94ZW4vYXJjaC94ODYvaHZtL210cnIuYwppbmRl
eCA3Y2NkODViY2VhLi41YWQxNWVhZmUwIDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYvaHZtL210
cnIuYworKysgYi94ZW4vYXJjaC94ODYvaHZtL210cnIuYwpAQCAtNzgzLDcgKzc4Myw4IEBAIEhW
TV9SRUdJU1RFUl9TQVZFX1JFU1RPUkUoTVRSUiwgaHZtX3NhdmVfbXRycl9tc3IsIGh2bV9sb2Fk
X210cnJfbXNyLCAxLAogCiB2b2lkIG1lbW9yeV90eXBlX2NoYW5nZWQoc3RydWN0IGRvbWFpbiAq
ZCkKIHsKLSAgICBpZiAoIChoYXNfaW9tbXVfcHQoZCkgfHwgY2FjaGVfZmx1c2hfcGVybWl0dGVk
KGQpKSAmJiBkLT52Y3B1ICYmIGQtPnZjcHVbMF0gKQorICAgIGlmICggKGlzX2lvbW11X2VuYWJs
ZWQoZCkgfHwgY2FjaGVfZmx1c2hfcGVybWl0dGVkKGQpKSAmJgorICAgICAgICAgZC0+dmNwdSAm
JiBkLT52Y3B1WzBdICkKICAgICB7CiAgICAgICAgIHAybV9tZW1vcnlfdHlwZV9jaGFuZ2VkKGQp
OwogICAgICAgICBmbHVzaF9hbGwoRkxVU0hfQ0FDSEUpOwpAQCAtODMxLDcgKzgzMiw3IEBAIGlu
dCBlcHRlX2dldF9lbnRyeV9lbXQoc3RydWN0IGRvbWFpbiAqZCwgdW5zaWduZWQgbG9uZyBnZm4s
IG1mbl90IG1mbiwKICAgICAgICAgcmV0dXJuIE1UUlJfVFlQRV9VTkNBQ0hBQkxFOwogICAgIH0K
IAotICAgIGlmICggIWhhc19pb21tdV9wdChkKSAmJiAhY2FjaGVfZmx1c2hfcGVybWl0dGVkKGQp
ICkKKyAgICBpZiAoICFpc19pb21tdV9lbmFibGVkKGQpICYmICFjYWNoZV9mbHVzaF9wZXJtaXR0
ZWQoZCkgKQogICAgIHsKICAgICAgICAgKmlwYXQgPSAxOwogICAgICAgICByZXR1cm4gTVRSUl9U
WVBFX1dSQkFDSzsKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9tbS9tZW1fc2hhcmluZy5jIGIv
eGVuL2FyY2gveDg2L21tL21lbV9zaGFyaW5nLmMKaW5kZXggYTVmZTg5ZTMzOS4uZWZiODgyMTc2
OCAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L21tL21lbV9zaGFyaW5nLmMKKysrIGIveGVuL2Fy
Y2gveDg2L21tL21lbV9zaGFyaW5nLmMKQEAgLTE2NjQsNyArMTY2NCw3IEBAIGludCBtZW1fc2hh
cmluZ19kb21jdGwoc3RydWN0IGRvbWFpbiAqZCwgc3RydWN0IHhlbl9kb21jdGxfbWVtX3NoYXJp
bmdfb3AgKm1lYykKICAgICAgICAgY2FzZSBYRU5fRE9NQ1RMX01FTV9TSEFSSU5HX0NPTlRST0w6
CiAgICAgICAgIHsKICAgICAgICAgICAgIHJjID0gMDsKLSAgICAgICAgICAgIGlmICggdW5saWtl
bHkoaGFzX2lvbW11X3B0KGQpICYmIG1lYy0+dS5lbmFibGUpICkKKyAgICAgICAgICAgIGlmICgg
dW5saWtlbHkoaXNfaW9tbXVfZW5hYmxlZChkKSAmJiBtZWMtPnUuZW5hYmxlKSApCiAgICAgICAg
ICAgICAgICAgcmMgPSAtRVhERVY7CiAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAg
ZC0+YXJjaC5odm0ubWVtX3NoYXJpbmdfZW5hYmxlZCA9IG1lYy0+dS5lbmFibGU7CmRpZmYgLS1n
aXQgYS94ZW4vYXJjaC94ODYvbW0vcDJtLmMgYi94ZW4vYXJjaC94ODYvbW0vcDJtLmMKaW5kZXgg
OGE1MjI5ZWUyMS4uZTVlNDM0OWRlYSAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L21tL3AybS5j
CisrKyBiL3hlbi9hcmNoL3g4Ni9tbS9wMm0uYwpAQCAtMTM0MSw3ICsxMzQxLDcgQEAgaW50IHNl
dF9pZGVudGl0eV9wMm1fZW50cnkoc3RydWN0IGRvbWFpbiAqZCwgdW5zaWduZWQgbG9uZyBnZm5f
bCwKIAogICAgIGlmICggIXBhZ2luZ19tb2RlX3RyYW5zbGF0ZShwMm0tPmRvbWFpbikgKQogICAg
IHsKLSAgICAgICAgaWYgKCAhaGFzX2lvbW11X3B0KGQpICkKKyAgICAgICAgaWYgKCAhaXNfaW9t
bXVfZW5hYmxlZChkKSApCiAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgcmV0dXJuIGlv
bW11X2xlZ2FjeV9tYXAoZCwgX2RmbihnZm5fbCksIF9tZm4oZ2ZuX2wpLCBQQUdFX09SREVSXzRL
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJT01NVUZfcmVhZGFibGUgfCBJT01N
VUZfd3JpdGFibGUpOwpAQCAtMTQzMiw3ICsxNDMyLDcgQEAgaW50IGNsZWFyX2lkZW50aXR5X3Ay
bV9lbnRyeShzdHJ1Y3QgZG9tYWluICpkLCB1bnNpZ25lZCBsb25nIGdmbl9sKQogCiAgICAgaWYg
KCAhcGFnaW5nX21vZGVfdHJhbnNsYXRlKGQpICkKICAgICB7Ci0gICAgICAgIGlmICggIWhhc19p
b21tdV9wdChkKSApCisgICAgICAgIGlmICggIWlzX2lvbW11X2VuYWJsZWQoZCkgKQogICAgICAg
ICAgICAgcmV0dXJuIDA7CiAgICAgICAgIHJldHVybiBpb21tdV9sZWdhY3lfdW5tYXAoZCwgX2Rm
bihnZm5fbCksIFBBR0VfT1JERVJfNEspOwogICAgIH0KZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4
Ni9tbS9wYWdpbmcuYyBiL3hlbi9hcmNoL3g4Ni9tbS9wYWdpbmcuYwppbmRleCA2OWFhMjI4ZTQ2
Li5kOWE1MmM0ZGI0IDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYvbW0vcGFnaW5nLmMKKysrIGIv
eGVuL2FyY2gveDg2L21tL3BhZ2luZy5jCkBAIC0yMTMsNyArMjEzLDcgQEAgaW50IHBhZ2luZ19s
b2dfZGlydHlfZW5hYmxlKHN0cnVjdCBkb21haW4gKmQsIGJvb2xfdCBsb2dfZ2xvYmFsKQogewog
ICAgIGludCByZXQ7CiAKLSAgICBpZiAoIGhhc19pb21tdV9wdChkKSAmJiBsb2dfZ2xvYmFsICkK
KyAgICBpZiAoIGlzX2lvbW11X2VuYWJsZWQoZCkgJiYgbG9nX2dsb2JhbCApCiAgICAgewogICAg
ICAgICAvKgogICAgICAgICAgKiBSZWZ1c2UgdG8gdHVybiBvbiBnbG9iYWwgbG9nLWRpcnR5IG1v
ZGUKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni94ODZfNjQvbW0uYyBiL3hlbi9hcmNoL3g4Ni94
ODZfNjQvbW0uYwppbmRleCA3OTVhNDY3NDYyLi5mYTU1ZjM0NzRlIDEwMDY0NAotLS0gYS94ZW4v
YXJjaC94ODYveDg2XzY0L21tLmMKKysrIGIveGVuL2FyY2gveDg2L3g4Nl82NC9tbS5jCkBAIC0x
NDM0LDcgKzE0MzQsNyBAQCBpbnQgbWVtb3J5X2FkZCh1bnNpZ25lZCBsb25nIHNwZm4sIHVuc2ln
bmVkIGxvbmcgZXBmbiwgdW5zaWduZWQgaW50IHB4bSkKICAgICAgKiBzaGFyZWQgb3IgYmVpbmcg
a2VwdCBpbiBzeW5jIHRoZW4gbmV3bHkgYWRkZWQgbWVtb3J5IG5lZWRzIHRvIGJlCiAgICAgICog
bWFwcGVkIGhlcmUuCiAgICAgICovCi0gICAgaWYgKCBoYXNfaW9tbXVfcHQoaGFyZHdhcmVfZG9t
YWluKSAmJgorICAgIGlmICggaXNfaW9tbXVfZW5hYmxlZChoYXJkd2FyZV9kb21haW4pICYmCiAg
ICAgICAgICAhaW9tbXVfdXNlX2hhcF9wdChoYXJkd2FyZV9kb21haW4pICYmCiAgICAgICAgICAh
bmVlZF9pb21tdV9wdF9zeW5jKGhhcmR3YXJlX2RvbWFpbikgKQogICAgIHsKZGlmZiAtLWdpdCBh
L3hlbi9jb21tb24vbWVtb3J5LmMgYi94ZW4vY29tbW9uL21lbW9yeS5jCmluZGV4IGQ1YWZmODNm
MmQuLjczNjRmZDJjMzMgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vbWVtb3J5LmMKKysrIGIveGVu
L2NvbW1vbi9tZW1vcnkuYwpAQCAtODIzLDcgKzgyMyw3IEBAIGludCB4ZW5tZW1fYWRkX3RvX3Bo
eXNtYXAoc3RydWN0IGRvbWFpbiAqZCwgc3RydWN0IHhlbl9hZGRfdG9fcGh5c21hcCAqeGF0cCwK
ICAgICB4YXRwLT5ncGZuICs9IHN0YXJ0OwogICAgIHhhdHAtPnNpemUgLT0gc3RhcnQ7CiAKLSAg
ICBpZiAoIGhhc19pb21tdV9wdChkKSApCisgICAgaWYgKCBpc19pb21tdV9lbmFibGVkKGQpICkK
ICAgICAgICB0aGlzX2NwdShpb21tdV9kb250X2ZsdXNoX2lvdGxiKSA9IDE7CiAKICAgICB3aGls
ZSAoIHhhdHAtPnNpemUgPiBkb25lICkKQEAgLTg0NCw3ICs4NDQsNyBAQCBpbnQgeGVubWVtX2Fk
ZF90b19waHlzbWFwKHN0cnVjdCBkb21haW4gKmQsIHN0cnVjdCB4ZW5fYWRkX3RvX3BoeXNtYXAg
KnhhdHAsCiAgICAgICAgIH0KICAgICB9CiAKLSAgICBpZiAoIGhhc19pb21tdV9wdChkKSApCisg
ICAgaWYgKCBpc19pb21tdV9lbmFibGVkKGQpICkKICAgICB7CiAgICAgICAgIGludCByZXQ7CiAK
ZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vdm1fZXZlbnQuYyBiL3hlbi9jb21tb24vdm1fZXZlbnQu
YwppbmRleCAyYTFjODdlNDRiLi4zYjE4MTk1ZWJmIDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL3Zt
X2V2ZW50LmMKKysrIGIveGVuL2NvbW1vbi92bV9ldmVudC5jCkBAIC02MzAsNyArNjMwLDcgQEAg
aW50IHZtX2V2ZW50X2RvbWN0bChzdHJ1Y3QgZG9tYWluICpkLCBzdHJ1Y3QgeGVuX2RvbWN0bF92
bV9ldmVudF9vcCAqdmVjKQogCiAgICAgICAgICAgICAvKiBObyBwYWdpbmcgaWYgaW9tbXUgaXMg
dXNlZCAqLwogICAgICAgICAgICAgcmMgPSAtRU1MSU5LOwotICAgICAgICAgICAgaWYgKCB1bmxp
a2VseShoYXNfaW9tbXVfcHQoZCkpICkKKyAgICAgICAgICAgIGlmICggdW5saWtlbHkoaXNfaW9t
bXVfZW5hYmxlZChkKSkgKQogICAgICAgICAgICAgICAgIGJyZWFrOwogCiAgICAgICAgICAgICBy
YyA9IC1FWERFVjsKZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2RldmljZV90
cmVlLmMgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9kZXZpY2VfdHJlZS5jCmluZGV4IDEyZjJj
NGMzZjIuLmVhOWZkNTRlM2IgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2Rl
dmljZV90cmVlLmMKKysrIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvZGV2aWNlX3RyZWUuYwpA
QCAtNDAsMTcgKzQwLDYgQEAgaW50IGlvbW11X2Fzc2lnbl9kdF9kZXZpY2Uoc3RydWN0IGRvbWFp
biAqZCwgc3RydWN0IGR0X2RldmljZV9ub2RlICpkZXYpCiAgICAgaWYgKCAhbGlzdF9lbXB0eSgm
ZGV2LT5kb21haW5fbGlzdCkgKQogICAgICAgICBnb3RvIGZhaWw7CiAKLSAgICAvKgotICAgICAq
IFRoZSBod2RvbSBpcyBmb3JjZWQgdG8gdXNlIElPTU1VIGZvciBwcm90ZWN0aW5nIGFzc2lnbmVk
Ci0gICAgICogZGV2aWNlLiBUaGVyZWZvcmUgdGhlIElPTU1VIGRhdGEgaXMgYWxyZWFkeSBzZXQg
dXAuCi0gICAgICovCi0gICAgQVNTRVJUKCFpc19oYXJkd2FyZV9kb21haW4oZCkgfHwKLSAgICAg
ICAgICAgaGQtPnN0YXR1cyA9PSBJT01NVV9TVEFUVVNfaW5pdGlhbGl6ZWQpOwotCi0gICAgcmMg
PSBpb21tdV9jb25zdHJ1Y3QoZCk7Ci0gICAgaWYgKCByYyApCi0gICAgICAgIGdvdG8gZmFpbDsK
LQogICAgIC8qIFRoZSBmbGFnIGZpZWxkIGRvZXNuJ3QgbWF0dGVyIHRvIERUIGRldmljZS4gKi8K
ICAgICByYyA9IGhkLT5wbGF0Zm9ybV9vcHMtPmFzc2lnbl9kZXZpY2UoZCwgMCwgZHRfdG9fZGV2
KGRldiksIDApOwogCmRpZmYgLS1naXQgYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9pb21tdS5j
IGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvaW9tbXUuYwppbmRleCA5ZGFjZTY0YWY5Li40Zjcx
ZGI5NWVhIDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9pb21tdS5jCisrKyBi
L3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2lvbW11LmMKQEAgLTE0Niw2ICsxNDYsMTcgQEAgc3Rh
dGljIGludCBfX2luaXQgcGFyc2VfZG9tMF9pb21tdV9wYXJhbShjb25zdCBjaGFyICpzKQogfQog
Y3VzdG9tX3BhcmFtKCJkb20wLWlvbW11IiwgcGFyc2VfZG9tMF9pb21tdV9wYXJhbSk7CiAKK3N0
YXRpYyB2b2lkIF9faHdkb21faW5pdCBjaGVja19od2RvbV9yZXFzKHN0cnVjdCBkb21haW4gKmQp
Cit7CisgICAgaWYgKCBpb21tdV9od2RvbV9ub25lIHx8ICFwYWdpbmdfbW9kZV90cmFuc2xhdGUo
ZCkgKQorICAgICAgICByZXR1cm47CisKKyAgICBhcmNoX2lvbW11X2NoZWNrX2F1dG90cmFuc2xh
dGVkX2h3ZG9tKGQpOworCisgICAgaW9tbXVfaHdkb21fcGFzc3Rocm91Z2ggPSBmYWxzZTsKKyAg
ICBpb21tdV9od2RvbV9zdHJpY3QgPSB0cnVlOworfQorCiBpbnQgaW9tbXVfZG9tYWluX2luaXQo
c3RydWN0IGRvbWFpbiAqZCkKIHsKICAgICBzdHJ1Y3QgZG9tYWluX2lvbW11ICpoZCA9IGRvbV9p
b21tdShkKTsKQEAgLTE1OSwxMjkgKzE3MCw0NCBAQCBpbnQgaW9tbXVfZG9tYWluX2luaXQoc3Ry
dWN0IGRvbWFpbiAqZCkKICAgICAgICAgcmV0dXJuIHJldDsKIAogICAgIGhkLT5wbGF0Zm9ybV9v
cHMgPSBpb21tdV9nZXRfb3BzKCk7Ci0gICAgcmV0dXJuIGhkLT5wbGF0Zm9ybV9vcHMtPmluaXQo
ZCk7Ci19CisgICAgcmV0ID0gaGQtPnBsYXRmb3JtX29wcy0+aW5pdChkKTsKKyAgICBpZiAoIHJl
dCApCisgICAgICAgIHJldHVybiByZXQ7CiAKLXN0YXRpYyB2b2lkIF9faHdkb21faW5pdCBjaGVj
a19od2RvbV9yZXFzKHN0cnVjdCBkb21haW4gKmQpCi17Ci0gICAgaWYgKCBpb21tdV9od2RvbV9u
b25lIHx8ICFwYWdpbmdfbW9kZV90cmFuc2xhdGUoZCkgKQotICAgICAgICByZXR1cm47CisgICAg
aWYgKCBpc19oYXJkd2FyZV9kb21haW4oZCkgKQorICAgICAgICBjaGVja19od2RvbV9yZXFzKGQp
OyAvKiBtYXkgbW9kaWZ5IGlvbW11X2h3ZG9tX3N0cmljdCAqLwogCi0gICAgYXJjaF9pb21tdV9j
aGVja19hdXRvdHJhbnNsYXRlZF9od2RvbShkKTsKKyAgICAvKgorICAgICAqIE5COiAncmVsYXhl
ZCcgaC93IGRvbWFpbnMgZG9uJ3QgbmVlZCB0aGUgSU9NTVUgbWFwcGluZ3MgdG8gYmUga2VwdAor
ICAgICAqICAgICBpbi1zeW5jIHdpdGggdGhlaXIgYXNzaWduZWQgcGFnZXMgYmVjYXVzZSBhbGwg
aG9zdCBSQU0gd2lsbCBiZQorICAgICAqICAgICBtYXBwZWQgZHVyaW5nIGh3ZG9tX2luaXQoKS4K
KyAgICAgKi8KKyAgICBpZiAoICFpc19oYXJkd2FyZV9kb21haW4oZCkgfHwgaW9tbXVfaHdkb21f
c3RyaWN0ICkKKyAgICAgICAgaGQtPm5lZWRfc3luYyA9ICFpb21tdV91c2VfaGFwX3B0KGQpOwog
Ci0gICAgaW9tbXVfaHdkb21fcGFzc3Rocm91Z2ggPSBmYWxzZTsKLSAgICBpb21tdV9od2RvbV9z
dHJpY3QgPSB0cnVlOworICAgIHJldHVybiAwOwogfQogCiB2b2lkIF9faHdkb21faW5pdCBpb21t
dV9od2RvbV9pbml0KHN0cnVjdCBkb21haW4gKmQpCiB7CiAgICAgc3RydWN0IGRvbWFpbl9pb21t
dSAqaGQgPSBkb21faW9tbXUoZCk7CiAKLSAgICBjaGVja19od2RvbV9yZXFzKGQpOwotCiAgICAg
aWYgKCAhaXNfaW9tbXVfZW5hYmxlZChkKSApCiAgICAgICAgIHJldHVybjsKIAogICAgIHJlZ2lz
dGVyX2tleWhhbmRsZXIoJ28nLCAmaW9tbXVfZHVtcF9wMm1fdGFibGUsICJkdW1wIGlvbW11IHAy
bSB0YWJsZSIsIDApOwogCi0gICAgaGQtPnN0YXR1cyA9IElPTU1VX1NUQVRVU19pbml0aWFsaXpp
bmc7Ci0gICAgLyoKLSAgICAgKiBOQjogcmVsYXhlZCBodyBkb21haW5zIGRvbid0IG5lZWQgc3lu
YyBiZWNhdXNlIGFsbCByYW0gaXMgYWxyZWFkeQotICAgICAqIG1hcHBlZCBpbiB0aGUgaW9tbXUg
cGFnZSB0YWJsZXMuCi0gICAgICovCi0gICAgaGQtPm5lZWRfc3luYyA9IGlvbW11X2h3ZG9tX3N0
cmljdCAmJiAhaW9tbXVfdXNlX2hhcF9wdChkKTsKLSAgICBpZiAoIG5lZWRfaW9tbXVfcHRfc3lu
YyhkKSApCi0gICAgewotICAgICAgICBzdHJ1Y3QgcGFnZV9pbmZvICpwYWdlOwotICAgICAgICB1
bnNpZ25lZCBpbnQgaSA9IDAsIGZsdXNoX2ZsYWdzID0gMDsKLSAgICAgICAgaW50IHJjID0gMDsK
LQotICAgICAgICBwYWdlX2xpc3RfZm9yX2VhY2ggKCBwYWdlLCAmZC0+cGFnZV9saXN0ICkKLSAg
ICAgICAgewotICAgICAgICAgICAgdW5zaWduZWQgbG9uZyBtZm4gPSBtZm5feChwYWdlX3RvX21m
bihwYWdlKSk7Ci0gICAgICAgICAgICB1bnNpZ25lZCBsb25nIGRmbiA9IG1mbl90b19nbWZuKGQs
IG1mbik7Ci0gICAgICAgICAgICB1bnNpZ25lZCBpbnQgbWFwcGluZyA9IElPTU1VRl9yZWFkYWJs
ZTsKLSAgICAgICAgICAgIGludCByZXQ7Ci0KLSAgICAgICAgICAgIGlmICggKChwYWdlLT51Lmlu
dXNlLnR5cGVfaW5mbyAmIFBHVF9jb3VudF9tYXNrKSA9PSAwKSB8fAotICAgICAgICAgICAgICAg
ICAoKHBhZ2UtPnUuaW51c2UudHlwZV9pbmZvICYgUEdUX3R5cGVfbWFzaykKLSAgICAgICAgICAg
ICAgICAgID09IFBHVF93cml0YWJsZV9wYWdlKSApCi0gICAgICAgICAgICAgICAgbWFwcGluZyB8
PSBJT01NVUZfd3JpdGFibGU7Ci0KLSAgICAgICAgICAgIHJldCA9IGlvbW11X21hcChkLCBfZGZu
KGRmbiksIF9tZm4obWZuKSwgMCwgbWFwcGluZywKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAmZmx1c2hfZmxhZ3MpOwotCi0gICAgICAgICAgICBpZiAoICFyYyApCi0gICAgICAgICAgICAg
ICAgcmMgPSByZXQ7Ci0KLSAgICAgICAgICAgIGlmICggIShpKysgJiAweGZmZmZmKSApCi0gICAg
ICAgICAgICAgICAgcHJvY2Vzc19wZW5kaW5nX3NvZnRpcnFzKCk7Ci0gICAgICAgIH0KLQotICAg
ICAgICAvKiBVc2Ugd2hpbGUtYnJlYWsgdG8gYXZvaWQgY29tcGlsZXIgd2FybmluZyAqLwotICAg
ICAgICB3aGlsZSAoIGlvbW11X2lvdGxiX2ZsdXNoX2FsbChkLCBmbHVzaF9mbGFncykgKQotICAg
ICAgICAgICAgYnJlYWs7Ci0KLSAgICAgICAgaWYgKCByYyApCi0gICAgICAgICAgICBwcmludGso
WEVOTE9HX1dBUk5JTkcgImQlZDogSU9NTVUgbWFwcGluZyBmYWlsZWQ6ICVkXG4iLAotICAgICAg
ICAgICAgICAgICAgIGQtPmRvbWFpbl9pZCwgcmMpOwotICAgIH0KLQogICAgIGhkLT5wbGF0Zm9y
bV9vcHMtPmh3ZG9tX2luaXQoZCk7Ci0KLSAgICBoZC0+c3RhdHVzID0gSU9NTVVfU1RBVFVTX2lu
aXRpYWxpemVkOwogfQogCi12b2lkIGlvbW11X3RlYXJkb3duKHN0cnVjdCBkb21haW4gKmQpCitz
dGF0aWMgdm9pZCBpb21tdV90ZWFyZG93bihzdHJ1Y3QgZG9tYWluICpkKQogewogICAgIHN0cnVj
dCBkb21haW5faW9tbXUgKmhkID0gZG9tX2lvbW11KGQpOwogCi0gICAgaGQtPnN0YXR1cyA9IElP
TU1VX1NUQVRVU19kaXNhYmxlZDsKICAgICBoZC0+cGxhdGZvcm1fb3BzLT50ZWFyZG93bihkKTsK
ICAgICB0YXNrbGV0X3NjaGVkdWxlKCZpb21tdV9wdF9jbGVhbnVwX3Rhc2tsZXQpOwogfQogCi1p
bnQgaW9tbXVfY29uc3RydWN0KHN0cnVjdCBkb21haW4gKmQpCi17Ci0gICAgc3RydWN0IGRvbWFp
bl9pb21tdSAqaGQgPSBkb21faW9tbXUoZCk7Ci0KLSAgICBpZiAoIGhkLT5zdGF0dXMgPT0gSU9N
TVVfU1RBVFVTX2luaXRpYWxpemVkICkKLSAgICAgICAgcmV0dXJuIDA7Ci0KLSAgICBoZC0+c3Rh
dHVzID0gSU9NTVVfU1RBVFVTX2luaXRpYWxpemluZzsKLQotICAgIGlmICggIWlvbW11X3VzZV9o
YXBfcHQoZCkgKQotICAgIHsKLSAgICAgICAgaW50IHJjOwotCi0gICAgICAgIGhkLT5uZWVkX3N5
bmMgPSB0cnVlOwotCi0gICAgICAgIHJjID0gYXJjaF9pb21tdV9wb3B1bGF0ZV9wYWdlX3RhYmxl
KGQpOwotICAgICAgICBpZiAoIHJjICkKLSAgICAgICAgewotICAgICAgICAgICAgaWYgKCByYyAh
PSAtRVJFU1RBUlQgKQotICAgICAgICAgICAgewotICAgICAgICAgICAgICAgIGhkLT5uZWVkX3N5
bmMgPSBmYWxzZTsKLSAgICAgICAgICAgICAgICBoZC0+c3RhdHVzID0gSU9NTVVfU1RBVFVTX2Rp
c2FibGVkOwotICAgICAgICAgICAgfQotCi0gICAgICAgICAgICByZXR1cm4gcmM7Ci0gICAgICAg
IH0KLSAgICB9Ci0KLSAgICBoZC0+c3RhdHVzID0gSU9NTVVfU1RBVFVTX2luaXRpYWxpemVkOwot
Ci0gICAgLyoKLSAgICAgKiBUaGVyZSBtYXkgYmUgZGlydHkgY2FjaGUgbGluZXMgd2hlbiBhIGRl
dmljZSBpcyBhc3NpZ25lZAotICAgICAqIGFuZCBiZWZvcmUgaGFzX2lvbW11X3B0KGQpIGJlY29t
aW5nIHRydWUsIHRoaXMgd2lsbCBjYXVzZQotICAgICAqIG1lbW9yeV90eXBlX2NoYW5nZWQgbG9z
ZSBlZmZlY3QgaWYgbWVtb3J5IHR5cGUgY2hhbmdlcy4KLSAgICAgKiBDYWxsIG1lbW9yeV90eXBl
X2NoYW5nZWQgaGVyZSB0byBhbWVuZCB0aGlzLgotICAgICAqLwotICAgIG1lbW9yeV90eXBlX2No
YW5nZWQoZCk7Ci0KLSAgICByZXR1cm4gMDsKLX0KLQogdm9pZCBpb21tdV9kb21haW5fZGVzdHJv
eShzdHJ1Y3QgZG9tYWluICpkKQogewogICAgIGlmICggIWlzX2lvbW11X2VuYWJsZWQoZCkgKQpA
QCAtNTc0LDExICs1MDAsOCBAQCBpbnQgaW9tbXVfZG9fZG9tY3RsKAogdm9pZCBpb21tdV9zaGFy
ZV9wMm1fdGFibGUoc3RydWN0IGRvbWFpbiogZCkKIHsKICAgICBBU1NFUlQoaGFwX2VuYWJsZWQo
ZCkpOwotICAgIC8qCi0gICAgICogaW9tbXVfdXNlX2hhcF9wdChkKSBjYW5ub3QgYmUgdXNlZCBo
ZXJlIGJlY2F1c2UgZHVyaW5nIGRvbWFpbgotICAgICAqIGNvbnN0cnVjdGlvbiBoYXNfaW9tbXVf
cHQoZCkgd2lsbCBhbHdheXMgcmV0dXJuIGZhbHNlIGhlcmUuCi0gICAgICovCi0gICAgaWYgKCBp
c19pb21tdV9lbmFibGVkKGQpICYmIGlvbW11X2hhcF9wdF9zaGFyZSApCisKKyAgICBpZiAoIGlv
bW11X3VzZV9oYXBfcHQoZCkgKQogICAgICAgICBpb21tdV9nZXRfb3BzKCktPnNoYXJlX3AybShk
KTsKIH0KIApAQCAtNjI1LDggKzU0OCw3IEBAIHN0YXRpYyB2b2lkIGlvbW11X2R1bXBfcDJtX3Rh
YmxlKHVuc2lnbmVkIGNoYXIga2V5KQogICAgIG9wcyA9IGlvbW11X2dldF9vcHMoKTsKICAgICBm
b3JfZWFjaF9kb21haW4oZCkKICAgICB7Ci0gICAgICAgIGlmICggaXNfaGFyZHdhcmVfZG9tYWlu
KGQpIHx8Ci0gICAgICAgICAgICAgZG9tX2lvbW11KGQpLT5zdGF0dXMgPCBJT01NVV9TVEFUVVNf
aW5pdGlhbGl6ZWQgKQorICAgICAgICBpZiAoIGlzX2hhcmR3YXJlX2RvbWFpbihkKSB8fCAhaXNf
aW9tbXVfZW5hYmxlZChkKSApCiAgICAgICAgICAgICBjb250aW51ZTsKIAogICAgICAgICBpZiAo
IGlvbW11X3VzZV9oYXBfcHQoZCkgKQpkaWZmIC0tZ2l0IGEveGVuL2RyaXZlcnMvcGFzc3Rocm91
Z2gvcGNpLmMgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9wY2kuYwppbmRleCA4MTQxMDY2Nzlm
Li4yMzE1ZDQ5MGRjIDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9wY2kuYwor
KysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9wY2kuYwpAQCAtOTMzLDkgKzkzMyw2IEBAIHN0
YXRpYyBpbnQgZGVhc3NpZ25fZGV2aWNlKHN0cnVjdCBkb21haW4gKmQsIHVpbnQxNl90IHNlZywg
dWludDhfdCBidXMsCiAKICAgICBwZGV2LT5mYXVsdC5jb3VudCA9IDA7CiAKLSAgICBpZiAoICFo
YXNfYXJjaF9wZGV2cyhkKSAmJiBoYXNfaW9tbXVfcHQoZCkgKQotICAgICAgICBpb21tdV90ZWFy
ZG93bihkKTsKLQogICAgIHJldHVybiByZXQ7CiB9CiAKQEAgLTE0ODQsMTMgKzE0ODEsNiBAQCBz
dGF0aWMgaW50IGFzc2lnbl9kZXZpY2Uoc3RydWN0IGRvbWFpbiAqZCwgdTE2IHNlZywgdTggYnVz
LCB1OCBkZXZmbiwgdTMyIGZsYWcpCiAgICAgaWYgKCAhcGNpZGV2c190cnlsb2NrKCkgKQogICAg
ICAgICByZXR1cm4gLUVSRVNUQVJUOwogCi0gICAgcmMgPSBpb21tdV9jb25zdHJ1Y3QoZCk7Ci0g
ICAgaWYgKCByYyApCi0gICAgewotICAgICAgICBwY2lkZXZzX3VubG9jaygpOwotICAgICAgICBy
ZXR1cm4gcmM7Ci0gICAgfQotCiAgICAgcGRldiA9IHBjaV9nZXRfcGRldl9ieV9kb21haW4oaGFy
ZHdhcmVfZG9tYWluLCBzZWcsIGJ1cywgZGV2Zm4pOwogICAgIGlmICggIXBkZXYgKQogICAgIHsK
QEAgLTE1MTksOCArMTUwOSw2IEBAIHN0YXRpYyBpbnQgYXNzaWduX2RldmljZShzdHJ1Y3QgZG9t
YWluICpkLCB1MTYgc2VnLCB1OCBidXMsIHU4IGRldmZuLCB1MzIgZmxhZykKICAgICB9CiAKICBk
b25lOgotICAgIGlmICggIWhhc19hcmNoX3BkZXZzKGQpICYmIGhhc19pb21tdV9wdChkKSApCi0g
ICAgICAgIGlvbW11X3RlYXJkb3duKGQpOwogICAgIHBjaWRldnNfdW5sb2NrKCk7CiAKICAgICBy
ZXR1cm4gcmM7CmRpZmYgLS1naXQgYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC92dGQvaW9tbXUu
YyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9pb21tdS5jCmluZGV4IGU1NmQ3YmVmYjQu
LmFlNDYwOGZlMTQgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9pb21t
dS5jCisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9pb21tdS5jCkBAIC0xNzU5LDE1
ICsxNzU5LDcgQEAgc3RhdGljIHZvaWQgaW9tbXVfZG9tYWluX3RlYXJkb3duKHN0cnVjdCBkb21h
aW4gKmQpCiAKICAgICBBU1NFUlQoaXNfaW9tbXVfZW5hYmxlZChkKSk7CiAKLSAgICAvKgotICAg
ICAqIFdlIGNhbid0IHVzZSBpb21tdV91c2VfaGFwX3B0IGhlcmUgYmVjYXVzZSBlaXRoZXIgSU9N
TVUgc3RhdGUKLSAgICAgKiBpcyBhbHJlYWR5IGNoYW5nZWQgdG8gSU9NTVVfU1RBVFVTX2Rpc2Fi
bGVkIGF0IHRoaXMgcG9pbnQgb3IKLSAgICAgKiBoYXMgYWx3YXlzIGJlZW4gSU9NTVVfU1RBVFVT
X2Rpc2FibGVkLgotICAgICAqCi0gICAgICogV2UgYWxzbyBuZWVkIHRvIHRlc3QgaWYgSEFQIGlz
IGVuYWJsZWQgYmVjYXVzZSBQViBndWVzdHMgY2FuCi0gICAgICogZW50ZXIgdGhpcyBwYXRoIHRv
by4KLSAgICAgKi8KLSAgICBpZiAoIGhhcF9lbmFibGVkKGQpICYmIGlvbW11X2hhcF9wdF9zaGFy
ZSApCisgICAgaWYgKCBpb21tdV91c2VfaGFwX3B0KGQpICkKICAgICAgICAgcmV0dXJuOwogCiAg
ICAgc3Bpbl9sb2NrKCZoZC0+YXJjaC5tYXBwaW5nX2xvY2spOwpkaWZmIC0tZ2l0IGEveGVuL2Ry
aXZlcnMvcGFzc3Rocm91Z2gveDg2L2lvbW11LmMgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC94
ODYvaW9tbXUuYwppbmRleCA4MzE5ZmUwYTY5Li40N2EzZTU1MjEzIDEwMDY0NAotLS0gYS94ZW4v
ZHJpdmVycy9wYXNzdGhyb3VnaC94ODYvaW9tbXUuYworKysgYi94ZW4vZHJpdmVycy9wYXNzdGhy
b3VnaC94ODYvaW9tbXUuYwpAQCAtODEsMTAzICs4MSw2IEBAIGludCBfX2luaXQgaW9tbXVfc2V0
dXBfaHBldF9tc2koc3RydWN0IG1zaV9kZXNjICptc2kpCiAgICAgcmV0dXJuIG9wcy0+c2V0dXBf
aHBldF9tc2kgPyBvcHMtPnNldHVwX2hwZXRfbXNpKG1zaSkgOiAtRU5PREVWOwogfQogCi1pbnQg
YXJjaF9pb21tdV9wb3B1bGF0ZV9wYWdlX3RhYmxlKHN0cnVjdCBkb21haW4gKmQpCi17Ci0gICAg
c3RydWN0IHBhZ2VfaW5mbyAqcGFnZTsKLSAgICBpbnQgcmMgPSAwLCBuID0gMDsKLQotICAgIHNw
aW5fbG9jaygmZC0+cGFnZV9hbGxvY19sb2NrKTsKLQotICAgIGlmICggdW5saWtlbHkoZC0+aXNf
ZHlpbmcpICkKLSAgICAgICAgcmMgPSAtRVNSQ0g7Ci0KLSAgICB3aGlsZSAoICFyYyAmJiAocGFn
ZSA9IHBhZ2VfbGlzdF9yZW1vdmVfaGVhZCgmZC0+cGFnZV9saXN0KSkgKQotICAgIHsKLSAgICAg
ICAgaWYgKCBpc19odm1fZG9tYWluKGQpIHx8Ci0gICAgICAgICAgICAocGFnZS0+dS5pbnVzZS50
eXBlX2luZm8gJiBQR1RfdHlwZV9tYXNrKSA9PSBQR1Rfd3JpdGFibGVfcGFnZSApCi0gICAgICAg
IHsKLSAgICAgICAgICAgIG1mbl90IG1mbiA9IHBhZ2VfdG9fbWZuKHBhZ2UpOwotICAgICAgICAg
ICAgZ2ZuX3QgZ2ZuID0gbWZuX3RvX2dmbihkLCBtZm4pOwotICAgICAgICAgICAgdW5zaWduZWQg
aW50IGZsdXNoX2ZsYWdzID0gMDsKLQotICAgICAgICAgICAgaWYgKCAhZ2ZuX2VxKGdmbiwgSU5W
QUxJRF9HRk4pICkKLSAgICAgICAgICAgIHsKLSAgICAgICAgICAgICAgICBkZm5fdCBkZm4gPSBf
ZGZuKGdmbl94KGdmbikpOwotCi0gICAgICAgICAgICAgICAgQVNTRVJUKCEoZ2ZuX3goZ2ZuKSA+
PiBERUZBVUxUX0RPTUFJTl9BRERSRVNTX1dJRFRIKSk7Ci0gICAgICAgICAgICAgICAgQlVHX09O
KFNIQVJFRF9NMlAoZ2ZuX3goZ2ZuKSkpOwotICAgICAgICAgICAgICAgIHJjID0gaW9tbXVfbWFw
KGQsIGRmbiwgbWZuLCBQQUdFX09SREVSXzRLLAotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIElPTU1VRl9yZWFkYWJsZSB8IElPTU1VRl93cml0YWJsZSwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAmZmx1c2hfZmxhZ3MpOwotCi0gICAgICAgICAgICAgICAgLyoKLSAgICAg
ICAgICAgICAgICAgKiBXZSBtYXkgYmUgd29ya2luZyBiZWhpbmQgdGhlIGJhY2sgb2YgYSBydW5u
aW5nIGd1ZXN0LCB3aGljaAotICAgICAgICAgICAgICAgICAqIG1heSBjaGFuZ2UgdGhlIHR5cGUg
b2YgYSBwYWdlIGF0IGFueSB0aW1lLiAgV2UgY2FuJ3QgcHJldmVudAotICAgICAgICAgICAgICAg
ICAqIHRoaXMgKGZvciBpbnN0YW5jZSwgYnkgYnVtcGluZyB0aGUgdHlwZSBjb3VudCB3aGlsZSBt
YXBwaW5nCi0gICAgICAgICAgICAgICAgICogdGhlIHBhZ2UpIHdpdGhvdXQgY2F1c2luZyBsZWdp
dGltYXRlIGd1ZXN0IHR5cGUtY2hhbmdlCi0gICAgICAgICAgICAgICAgICogb3BlcmF0aW9ucyB0
byBmYWlsLiAgU28gYWZ0ZXIgYWRkaW5nIHRoZSBwYWdlIHRvIHRoZSBJT01NVSwKLSAgICAgICAg
ICAgICAgICAgKiBjaGVjayBhZ2FpbiB0byBtYWtlIHN1cmUgdGhpcyBpcyBzdGlsbCB2YWxpZC4g
IE5CIHRoYXQgdGhlCi0gICAgICAgICAgICAgICAgICogd3JpdGFibGUgZW50cnkgaW4gdGhlIGlv
bW11IGlzIGhhcm1sZXNzIHVudGlsIGxhdGVyLCB3aGVuCi0gICAgICAgICAgICAgICAgICogdGhl
IGFjdHVhbCBkZXZpY2UgZ2V0cyBhc3NpZ25lZC4KLSAgICAgICAgICAgICAgICAgKi8KLSAgICAg
ICAgICAgICAgICBpZiAoICFyYyAmJiAhaXNfaHZtX2RvbWFpbihkKSAmJgotICAgICAgICAgICAg
ICAgICAgICAgKChwYWdlLT51LmludXNlLnR5cGVfaW5mbyAmIFBHVF90eXBlX21hc2spICE9Ci0g
ICAgICAgICAgICAgICAgICAgICAgUEdUX3dyaXRhYmxlX3BhZ2UpICkKLSAgICAgICAgICAgICAg
ICB7Ci0gICAgICAgICAgICAgICAgICAgIHJjID0gaW9tbXVfdW5tYXAoZCwgZGZuLCBQQUdFX09S
REVSXzRLLCAmZmx1c2hfZmxhZ3MpOwotICAgICAgICAgICAgICAgICAgICAvKiBJZiB0aGUgdHlw
ZSBjaGFuZ2VkIHlldCBhZ2Fpbiwgc2ltcGx5IGZvcmNlIGEgcmV0cnkuICovCi0gICAgICAgICAg
ICAgICAgICAgIGlmICggIXJjICYmICgocGFnZS0+dS5pbnVzZS50eXBlX2luZm8gJiBQR1RfdHlw
ZV9tYXNrKSA9PQotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUEdUX3dyaXRhYmxl
X3BhZ2UpICkKLSAgICAgICAgICAgICAgICAgICAgICAgIHJjID0gLUVSRVNUQVJUOwotICAgICAg
ICAgICAgICAgIH0KLSAgICAgICAgICAgIH0KLSAgICAgICAgICAgIGlmICggcmMgKQotICAgICAg
ICAgICAgewotICAgICAgICAgICAgICAgIHBhZ2VfbGlzdF9hZGQocGFnZSwgJmQtPnBhZ2VfbGlz
dCk7Ci0gICAgICAgICAgICAgICAgYnJlYWs7Ci0gICAgICAgICAgICB9Ci0gICAgICAgIH0KLSAg
ICAgICAgcGFnZV9saXN0X2FkZF90YWlsKHBhZ2UsICZkLT5hcmNoLnJlbG1lbV9saXN0KTsKLSAg
ICAgICAgaWYgKCAhKCsrbiAmIDB4ZmYpICYmICFwYWdlX2xpc3RfZW1wdHkoJmQtPnBhZ2VfbGlz
dCkgJiYKLSAgICAgICAgICAgICBoeXBlcmNhbGxfcHJlZW1wdF9jaGVjaygpICkKLSAgICAgICAg
ICAgIHJjID0gLUVSRVNUQVJUOwotICAgIH0KLQotICAgIGlmICggIXJjICkKLSAgICB7Ci0gICAg
ICAgIC8qCi0gICAgICAgICAqIFRoZSBleHBlY3RhdGlvbiBoZXJlIGlzIHRoYXQgZ2VuZXJhbGx5
IHRoZXJlIGFyZSBtYW55IG5vcm1hbCBwYWdlcwotICAgICAgICAgKiBvbiByZWxtZW1fbGlzdCAo
dGhlIG9uZXMgd2UgcHV0IHRoZXJlKSBhbmQgb25seSBmZXcgYmVpbmcgaW4gYW4KLSAgICAgICAg
ICogb2ZmbGluZS9icm9rZW4gc3RhdGUuIFRoZSBsYXR0ZXIgb25lcyBhcmUgYWx3YXlzIGF0IHRo
ZSBoZWFkIG9mIHRoZQotICAgICAgICAgKiBsaXN0LiBIZW5jZSB3ZSBmaXJzdCBtb3ZlIHRoZSB3
aG9sZSBsaXN0LCBhbmQgdGhlbiBtb3ZlIGJhY2sgdGhlCi0gICAgICAgICAqIGZpcnN0IGZldyBl
bnRyaWVzLgotICAgICAgICAgKi8KLSAgICAgICAgcGFnZV9saXN0X21vdmUoJmQtPnBhZ2VfbGlz
dCwgJmQtPmFyY2gucmVsbWVtX2xpc3QpOwotICAgICAgICB3aGlsZSAoICFwYWdlX2xpc3RfZW1w
dHkoJmQtPnBhZ2VfbGlzdCkgJiYKLSAgICAgICAgICAgICAgICAocGFnZSA9IHBhZ2VfbGlzdF9m
aXJzdCgmZC0+cGFnZV9saXN0KSwKLSAgICAgICAgICAgICAgICAgKHBhZ2UtPmNvdW50X2luZm8g
JiAoUEdDX3N0YXRlfFBHQ19icm9rZW4pKSkgKQotICAgICAgICB7Ci0gICAgICAgICAgICBwYWdl
X2xpc3RfZGVsKHBhZ2UsICZkLT5wYWdlX2xpc3QpOwotICAgICAgICAgICAgcGFnZV9saXN0X2Fk
ZF90YWlsKHBhZ2UsICZkLT5hcmNoLnJlbG1lbV9saXN0KTsKLSAgICAgICAgfQotICAgIH0KLQot
ICAgIHNwaW5fdW5sb2NrKCZkLT5wYWdlX2FsbG9jX2xvY2spOwotCi0gICAgaWYgKCAhcmMgKQot
ICAgICAgICAvKgotICAgICAgICAgKiBmbHVzaF9mbGFncyBhcmUgbm90IHRyYWNrZWQgYWNyb3Nz
IGh5cGVyY2FsbCBwcmUtZW1wdGlvbiBzbwotICAgICAgICAgKiBhc3N1bWUgYSBmdWxsIGZsdXNo
IGlzIG5lY2Vzc2FyeS4KLSAgICAgICAgICovCi0gICAgICAgIHJjID0gaW9tbXVfaW90bGJfZmx1
c2hfYWxsKAotICAgICAgICAgICAgZCwgSU9NTVVfRkxVU0hGX2FkZGVkIHwgSU9NTVVfRkxVU0hG
X21vZGlmaWVkKTsKLQotICAgIGlmICggcmMgJiYgcmMgIT0gLUVSRVNUQVJUICkKLSAgICAgICAg
aW9tbXVfdGVhcmRvd24oZCk7Ci0KLSAgICByZXR1cm4gcmM7Ci19Ci0KIHZvaWQgX19od2RvbV9p
bml0IGFyY2hfaW9tbXVfY2hlY2tfYXV0b3RyYW5zbGF0ZWRfaHdkb20oc3RydWN0IGRvbWFpbiAq
ZCkKIHsKICAgICBpZiAoICFpc19pb21tdV9lbmFibGVkKGQpICkKZGlmZiAtLWdpdCBhL3hlbi9p
bmNsdWRlL2FzbS1hcm0vaW9tbXUuaCBiL3hlbi9pbmNsdWRlL2FzbS1hcm0vaW9tbXUuaAppbmRl
eCA5MDRjOWFlYzExLi4xNTc3ZTgzZDJiIDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS9hc20tYXJt
L2lvbW11LmgKKysrIGIveGVuL2luY2x1ZGUvYXNtLWFybS9pb21tdS5oCkBAIC0yMSw3ICsyMSw3
IEBAIHN0cnVjdCBhcmNoX2lvbW11CiB9OwogCiAvKiBBbHdheXMgc2hhcmUgUDJNIFRhYmxlIGJl
dHdlZW4gdGhlIENQVSBhbmQgdGhlIElPTU1VICovCi0jZGVmaW5lIGlvbW11X3VzZV9oYXBfcHQo
ZCkgKGhhc19pb21tdV9wdChkKSkKKyNkZWZpbmUgaW9tbXVfdXNlX2hhcF9wdChkKSBpc19pb21t
dV9lbmFibGVkKGQpCiAKIGNvbnN0IHN0cnVjdCBpb21tdV9vcHMgKmlvbW11X2dldF9vcHModm9p
ZCk7CiB2b2lkIGlvbW11X3NldF9vcHMoY29uc3Qgc3RydWN0IGlvbW11X29wcyAqb3BzKTsKZGlm
ZiAtLWdpdCBhL3hlbi9pbmNsdWRlL2FzbS14ODYvaW9tbXUuaCBiL3hlbi9pbmNsdWRlL2FzbS14
ODYvaW9tbXUuaAppbmRleCAzMWZkYTRiMGNmLi41MDcxYWZkNmE1IDEwMDY0NAotLS0gYS94ZW4v
aW5jbHVkZS9hc20teDg2L2lvbW11LmgKKysrIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9pb21tdS5o
CkBAIC04OCw3ICs4OCw3IEBAIGV4dGVybiBjb25zdCBzdHJ1Y3QgaW9tbXVfaW5pdF9vcHMgKmlv
bW11X2luaXRfb3BzOwogCiAvKiBBcmUgd2UgdXNpbmcgdGhlIGRvbWFpbiBQMk0gdGFibGUgYXMg
aXRzIElPTU1VIHBhZ2V0YWJsZT8gKi8KICNkZWZpbmUgaW9tbXVfdXNlX2hhcF9wdChkKSBcCi0g
ICAgKGhhcF9lbmFibGVkKGQpICYmIGhhc19pb21tdV9wdChkKSAmJiBpb21tdV9oYXBfcHRfc2hh
cmUpCisgICAgKGhhcF9lbmFibGVkKGQpICYmIGlzX2lvbW11X2VuYWJsZWQoZCkgJiYgaW9tbXVf
aGFwX3B0X3NoYXJlKQogCiB2b2lkIGlvbW11X3VwZGF0ZV9pcmVfZnJvbV9hcGljKHVuc2lnbmVk
IGludCBhcGljLCB1bnNpZ25lZCBpbnQgcmVnLCB1bnNpZ25lZCBpbnQgdmFsdWUpOwogdW5zaWdu
ZWQgaW50IGlvbW11X3JlYWRfYXBpY19mcm9tX2lyZSh1bnNpZ25lZCBpbnQgYXBpYywgdW5zaWdu
ZWQgaW50IHJlZyk7CmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS94ZW4vaW9tbXUuaCBiL3hlbi9p
bmNsdWRlL3hlbi9pb21tdS5oCmluZGV4IDMxNGYyOGYzMjMuLjRiNjg3MTkzNmMgMTAwNjQ0Ci0t
LSBhL3hlbi9pbmNsdWRlL3hlbi9pb21tdS5oCisrKyBiL3hlbi9pbmNsdWRlL3hlbi9pb21tdS5o
CkBAIC03MywxNSArNzMsOSBAQCB2b2lkIGlvbW11X2RvbWFpbl9kZXN0cm95KHN0cnVjdCBkb21h
aW4gKmQpOwogCiB2b2lkIGFyY2hfaW9tbXVfZG9tYWluX2Rlc3Ryb3koc3RydWN0IGRvbWFpbiAq
ZCk7CiBpbnQgYXJjaF9pb21tdV9kb21haW5faW5pdChzdHJ1Y3QgZG9tYWluICpkKTsKLWludCBh
cmNoX2lvbW11X3BvcHVsYXRlX3BhZ2VfdGFibGUoc3RydWN0IGRvbWFpbiAqZCk7CiB2b2lkIGFy
Y2hfaW9tbXVfY2hlY2tfYXV0b3RyYW5zbGF0ZWRfaHdkb20oc3RydWN0IGRvbWFpbiAqZCk7CiB2
b2lkIGFyY2hfaW9tbXVfaHdkb21faW5pdChzdHJ1Y3QgZG9tYWluICpkKTsKIAotaW50IGlvbW11
X2NvbnN0cnVjdChzdHJ1Y3QgZG9tYWluICpkKTsKLQotLyogRnVuY3Rpb24gdXNlZCBpbnRlcm5h
bGx5LCB1c2UgaW9tbXVfZG9tYWluX2Rlc3Ryb3kgKi8KLXZvaWQgaW9tbXVfdGVhcmRvd24oc3Ry
dWN0IGRvbWFpbiAqZCk7Ci0KIC8qCiAgKiBUaGUgZm9sbG93aW5nIGZsYWdzIGFyZSBwYXNzZWQg
dG8gbWFwIG9wZXJhdGlvbnMgYW5kIHBhc3NlZCBieSBsb29rdXAKICAqIG9wZXJhdGlvbnMuCkBA
IC0yNDgsMTMgKzI0Miw2IEBAIHN0cnVjdCBpb21tdV9vcHMgewogIyBkZWZpbmUgaW9tbXVfdmNh
bGwgaW9tbXVfY2FsbAogI2VuZGlmCiAKLWVudW0gaW9tbXVfc3RhdHVzCi17Ci0gICAgSU9NTVVf
U1RBVFVTX2Rpc2FibGVkLAotICAgIElPTU1VX1NUQVRVU19pbml0aWFsaXppbmcsCi0gICAgSU9N
TVVfU1RBVFVTX2luaXRpYWxpemVkCi19OwotCiBzdHJ1Y3QgZG9tYWluX2lvbW11IHsKICAgICBz
dHJ1Y3QgYXJjaF9pb21tdSBhcmNoOwogCkBAIC0yNjksOSArMjU2LDYgQEAgc3RydWN0IGRvbWFp
bl9pb21tdSB7CiAgICAgLyogRmVhdHVyZXMgc3VwcG9ydGVkIGJ5IHRoZSBJT01NVSAqLwogICAg
IERFQ0xBUkVfQklUTUFQKGZlYXR1cmVzLCBJT01NVV9GRUFUX2NvdW50KTsKIAotICAgIC8qIFN0
YXR1cyBvZiBndWVzdCBJT01NVSBtYXBwaW5ncyAqLwotICAgIGVudW0gaW9tbXVfc3RhdHVzIHN0
YXR1czsKLQogICAgIC8qCiAgICAgICogRG9lcyB0aGUgZ3Vlc3QgcmVxaXJlIG1hcHBpbmdzIHRv
IGJlIHN5bmNob25pemVkLCB0byBtYWludGFpbgogICAgICAqIHRoZSBkZWZhdWx0IGRmbiA9PSBw
Zm4gbWFwLiAoU2VlIGNvbW1lbnQgb24gZGZuIGF0IHRoZSB0b3Agb2YKZGlmZiAtLWdpdCBhL3hl
bi9pbmNsdWRlL3hlbi9zY2hlZC5oIGIveGVuL2luY2x1ZGUveGVuL3NjaGVkLmgKaW5kZXggM2Mw
ZGI0MmI4Mi4uM2Y4YWQ1NjY1NSAxMDA2NDQKLS0tIGEveGVuL2luY2x1ZGUveGVuL3NjaGVkLmgK
KysrIGIveGVuL2luY2x1ZGUveGVuL3NjaGVkLmgKQEAgLTk2NiwxMCArOTY2LDggQEAgc3RhdGlj
IGlubGluZSBib29sIGlzX2h3ZG9tX3Bpbm5lZF92Y3B1KGNvbnN0IHN0cnVjdCB2Y3B1ICp2KQog
fQogCiAjaWZkZWYgQ09ORklHX0hBU19QQVNTVEhST1VHSAotI2RlZmluZSBoYXNfaW9tbXVfcHQo
ZCkgKGRvbV9pb21tdShkKS0+c3RhdHVzICE9IElPTU1VX1NUQVRVU19kaXNhYmxlZCkKICNkZWZp
bmUgbmVlZF9pb21tdV9wdF9zeW5jKGQpIChkb21faW9tbXUoZCktPm5lZWRfc3luYykKICNlbHNl
Ci0jZGVmaW5lIGhhc19pb21tdV9wdChkKSBmYWxzZQogI2RlZmluZSBuZWVkX2lvbW11X3B0X3N5
bmMoZCkgZmFsc2UKICNlbmRpZgogCi0tIAoyLjIwLjEuMi5nYjIxZWJiNjcxCgoKX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcg
bGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9q
ZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

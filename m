Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 7CE1E9FC8C
	for <lists+xen-devel@lfdr.de>; Wed, 28 Aug 2019 10:04:15 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i2ssj-0001iN-5M; Wed, 28 Aug 2019 08:00:41 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=laXa=WY=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1i2ssh-0001iB-B7
 for xen-devel@lists.xenproject.org; Wed, 28 Aug 2019 08:00:39 +0000
X-Inumbo-ID: eb238b24-c969-11e9-8980-bc764e2007e4
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id eb238b24-c969-11e9-8980-bc764e2007e4;
 Wed, 28 Aug 2019 08:00:37 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 2CCCBAC7F;
 Wed, 28 Aug 2019 08:00:36 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Wed, 28 Aug 2019 10:00:26 +0200
Message-Id: <20190828080028.18205-3-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190828080028.18205-1-jgross@suse.com>
References: <20190828080028.18205-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v3 2/4] xen: move debugtrace coding to
 common/debugtrace.c
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SW5zdGVhZCBvZiBsaXZpbmcgaW4gZHJpdmVycy9jaGFyL2NvbnNvbGUuYyBtb3ZlIHRoZSBkZWJ1
Z3RyYWNlCnJlbGF0ZWQgY29kaW5nIHRvIGEgbmV3IGZpbGUgY29tbW9uL2RlYnVndHJhY2UuYwoK
Tm8gZnVuY3Rpb25hbCBjaGFuZ2UsIGNvZGUgbW92ZW1lbnQgb25seS4KClNpZ25lZC1vZmYtYnk6
IEp1ZXJnZW4gR3Jvc3MgPGpncm9zc0BzdXNlLmNvbT4KLS0tCiB4ZW4vY29tbW9uL01ha2VmaWxl
ICAgICAgICB8ICAgMSArCiB4ZW4vY29tbW9uL2RlYnVndHJhY2UuYyAgICB8IDE4MSArKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKIHhlbi9kcml2ZXJzL2NoYXIv
Y29uc29sZS5jIHwgMTc4ICstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tCiAzIGZpbGVzIGNoYW5nZWQsIDE4MyBpbnNlcnRpb25zKCspLCAxNzcgZGVsZXRpb25zKC0p
CiBjcmVhdGUgbW9kZSAxMDA2NDQgeGVuL2NvbW1vbi9kZWJ1Z3RyYWNlLmMKCmRpZmYgLS1naXQg
YS94ZW4vY29tbW9uL01ha2VmaWxlIGIveGVuL2NvbW1vbi9NYWtlZmlsZQppbmRleCBlZGRkYTVk
YWE2Li42MmIzNGU2OWU5IDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL01ha2VmaWxlCisrKyBiL3hl
bi9jb21tb24vTWFrZWZpbGUKQEAgLTQsNiArNCw3IEBAIG9iai15ICs9IGJzZWFyY2gubwogb2Jq
LSQoQ09ORklHX0NPUkVfUEFSS0lORykgKz0gY29yZV9wYXJraW5nLm8KIG9iai15ICs9IGNwdS5v
CiBvYmoteSArPSBjcHVwb29sLm8KK29iai0kKENPTkZJR19ERUJVR19UUkFDRSkgKz0gZGVidWd0
cmFjZS5vCiBvYmotJChDT05GSUdfSEFTX0RFVklDRV9UUkVFKSArPSBkZXZpY2VfdHJlZS5vCiBv
YmoteSArPSBkb21jdGwubwogb2JqLXkgKz0gZG9tYWluLm8KZGlmZiAtLWdpdCBhL3hlbi9jb21t
b24vZGVidWd0cmFjZS5jIGIveGVuL2NvbW1vbi9kZWJ1Z3RyYWNlLmMKbmV3IGZpbGUgbW9kZSAx
MDA2NDQKaW5kZXggMDAwMDAwMDAwMC4uYTJmYWIwZDcyYwotLS0gL2Rldi9udWxsCisrKyBiL3hl
bi9jb21tb24vZGVidWd0cmFjZS5jCkBAIC0wLDAgKzEsMTgxIEBACisvKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqCisgKiBkZWJ1Z3RyYWNlLmMKKyAqCisgKiBEZWJ1Z3RyYWNlIGZvciBYZW4KKyAqLwor
CisKKyNpbmNsdWRlIDx4ZW4vY29uc29sZS5oPgorI2luY2x1ZGUgPHhlbi9pbml0Lmg+CisjaW5j
bHVkZSA8eGVuL2tleWhhbmRsZXIuaD4KKyNpbmNsdWRlIDx4ZW4vbGliLmg+CisjaW5jbHVkZSA8
eGVuL21tLmg+CisjaW5jbHVkZSA8eGVuL3NlcmlhbC5oPgorI2luY2x1ZGUgPHhlbi9zcGlubG9j
ay5oPgorI2luY2x1ZGUgPHhlbi93YXRjaGRvZy5oPgorCisvKiBTZW5kIG91dHB1dCBkaXJlY3Qg
dG8gY29uc29sZSwgb3IgYnVmZmVyIGl0PyAqLworc3RhdGljIHZvbGF0aWxlIGludCBkZWJ1Z3Ry
YWNlX3NlbmRfdG9fY29uc29sZTsKKworc3RhdGljIGNoYXIgICAgICAgICpkZWJ1Z3RyYWNlX2J1
ZjsgLyogRGVidWctdHJhY2UgYnVmZmVyICovCitzdGF0aWMgdW5zaWduZWQgaW50IGRlYnVndHJh
Y2VfcHJkOyAvKiBQcm9kdWNlciBpbmRleCAgICAgKi8KK3N0YXRpYyB1bnNpZ25lZCBpbnQgZGVi
dWd0cmFjZV9raWxvYnl0ZXMgPSAxMjgsIGRlYnVndHJhY2VfYnl0ZXM7CitzdGF0aWMgdW5zaWdu
ZWQgaW50IGRlYnVndHJhY2VfdXNlZDsKK3N0YXRpYyBERUZJTkVfU1BJTkxPQ0soZGVidWd0cmFj
ZV9sb2NrKTsKK2ludGVnZXJfcGFyYW0oImRlYnVndHJhY2UiLCBkZWJ1Z3RyYWNlX2tpbG9ieXRl
cyk7CisKK3N0YXRpYyB2b2lkIGRlYnVndHJhY2VfZHVtcF93b3JrZXIodm9pZCkKK3sKKyAgICBp
ZiAoIChkZWJ1Z3RyYWNlX2J5dGVzID09IDApIHx8ICFkZWJ1Z3RyYWNlX3VzZWQgKQorICAgICAg
ICByZXR1cm47CisKKyAgICBwcmludGsoImRlYnVndHJhY2VfZHVtcCgpIHN0YXJ0aW5nXG4iKTsK
KworICAgIC8qIFByaW50IG9sZGVzdCBwb3J0aW9uIG9mIHRoZSByaW5nLiAqLworICAgIEFTU0VS
VChkZWJ1Z3RyYWNlX2J1ZltkZWJ1Z3RyYWNlX2J5dGVzIC0gMV0gPT0gMCk7CisgICAgaWYgKCBk
ZWJ1Z3RyYWNlX2J1ZltkZWJ1Z3RyYWNlX3ByZF0gIT0gJ1wwJyApCisgICAgICAgIGNvbnNvbGVf
c2VyaWFsX3B1dHMoJmRlYnVndHJhY2VfYnVmW2RlYnVndHJhY2VfcHJkXSwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBkZWJ1Z3RyYWNlX2J5dGVzIC0gZGVidWd0cmFjZV9wcmQgLSAxKTsK
KworICAgIC8qIFByaW50IHlvdW5nZXN0IHBvcnRpb24gb2YgdGhlIHJpbmcuICovCisgICAgZGVi
dWd0cmFjZV9idWZbZGVidWd0cmFjZV9wcmRdID0gJ1wwJzsKKyAgICBjb25zb2xlX3NlcmlhbF9w
dXRzKCZkZWJ1Z3RyYWNlX2J1ZlswXSwgZGVidWd0cmFjZV9wcmQpOworCisgICAgbWVtc2V0KGRl
YnVndHJhY2VfYnVmLCAnXDAnLCBkZWJ1Z3RyYWNlX2J5dGVzKTsKKworICAgIHByaW50aygiZGVi
dWd0cmFjZV9kdW1wKCkgZmluaXNoZWRcbiIpOworfQorCitzdGF0aWMgdm9pZCBkZWJ1Z3RyYWNl
X3RvZ2dsZSh2b2lkKQoreworICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7CisKKyAgICB3YXRjaGRv
Z19kaXNhYmxlKCk7CisgICAgc3Bpbl9sb2NrX2lycXNhdmUoJmRlYnVndHJhY2VfbG9jaywgZmxh
Z3MpOworCisgICAgLyoKKyAgICAgKiBEdW1wIHRoZSBidWZmZXIgKmJlZm9yZSogdG9nZ2xpbmcs
IGluIGNhc2UgdGhlIGFjdCBvZiBkdW1waW5nIHRoZQorICAgICAqIGJ1ZmZlciBpdHNlbGYgY2F1
c2VzIG1vcmUgcHJpbnRrKCkgaW52b2NhdGlvbnMuCisgICAgICovCisgICAgcHJpbnRrKCJkZWJ1
Z3RyYWNlX3ByaW50ayBub3cgd3JpdGluZyB0byAlcy5cbiIsCisgICAgICAgICAgICFkZWJ1Z3Ry
YWNlX3NlbmRfdG9fY29uc29sZSA/ICJjb25zb2xlIjogImJ1ZmZlciIpOworICAgIGlmICggIWRl
YnVndHJhY2Vfc2VuZF90b19jb25zb2xlICkKKyAgICAgICAgZGVidWd0cmFjZV9kdW1wX3dvcmtl
cigpOworCisgICAgZGVidWd0cmFjZV9zZW5kX3RvX2NvbnNvbGUgPSAhZGVidWd0cmFjZV9zZW5k
X3RvX2NvbnNvbGU7CisKKyAgICBzcGluX3VubG9ja19pcnFyZXN0b3JlKCZkZWJ1Z3RyYWNlX2xv
Y2ssIGZsYWdzKTsKKyAgICB3YXRjaGRvZ19lbmFibGUoKTsKKworfQorCit2b2lkIGRlYnVndHJh
Y2VfZHVtcCh2b2lkKQoreworICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7CisKKyAgICB3YXRjaGRv
Z19kaXNhYmxlKCk7CisgICAgc3Bpbl9sb2NrX2lycXNhdmUoJmRlYnVndHJhY2VfbG9jaywgZmxh
Z3MpOworCisgICAgZGVidWd0cmFjZV9kdW1wX3dvcmtlcigpOworCisgICAgc3Bpbl91bmxvY2tf
aXJxcmVzdG9yZSgmZGVidWd0cmFjZV9sb2NrLCBmbGFncyk7CisgICAgd2F0Y2hkb2dfZW5hYmxl
KCk7Cit9CisKK3N0YXRpYyB2b2lkIGRlYnVndHJhY2VfYWRkX3RvX2J1ZihjaGFyICpidWYpCit7
CisgICAgY2hhciAqcDsKKworICAgIGZvciAoIHAgPSBidWY7ICpwICE9ICdcMCc7IHArKyApCisg
ICAgeworICAgICAgICBkZWJ1Z3RyYWNlX2J1ZltkZWJ1Z3RyYWNlX3ByZCsrXSA9ICpwOworICAg
ICAgICAvKiBBbHdheXMgbGVhdmUgYSBudWwgYnl0ZSBhdCB0aGUgZW5kIG9mIHRoZSBidWZmZXIu
ICovCisgICAgICAgIGlmICggZGVidWd0cmFjZV9wcmQgPT0gKGRlYnVndHJhY2VfYnl0ZXMgLSAx
KSApCisgICAgICAgICAgICBkZWJ1Z3RyYWNlX3ByZCA9IDA7CisgICAgfQorfQorCit2b2lkIGRl
YnVndHJhY2VfcHJpbnRrKGNvbnN0IGNoYXIgKmZtdCwgLi4uKQoreworICAgIHN0YXRpYyBjaGFy
IGJ1ZlsxMDI0XSwgbGFzdF9idWZbMTAyNF07CisgICAgc3RhdGljIHVuc2lnbmVkIGludCBjb3Vu
dCwgbGFzdF9jb3VudCwgbGFzdF9wcmQ7CisKKyAgICBjaGFyICAgICAgICAgIGNudGJ1ZlsyNF07
CisgICAgdmFfbGlzdCAgICAgICBhcmdzOworICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7CisgICAg
dW5zaWduZWQgaW50IG5yOworCisgICAgaWYgKCBkZWJ1Z3RyYWNlX2J5dGVzID09IDAgKQorICAg
ICAgICByZXR1cm47CisKKyAgICBkZWJ1Z3RyYWNlX3VzZWQgPSAxOworCisgICAgc3Bpbl9sb2Nr
X2lycXNhdmUoJmRlYnVndHJhY2VfbG9jaywgZmxhZ3MpOworCisgICAgQVNTRVJUKGRlYnVndHJh
Y2VfYnVmW2RlYnVndHJhY2VfYnl0ZXMgLSAxXSA9PSAwKTsKKworICAgIHZhX3N0YXJ0KGFyZ3Ms
IGZtdCk7CisgICAgbnIgPSB2c25wcmludGYoYnVmLCBzaXplb2YoYnVmKSwgZm10LCBhcmdzKTsK
KyAgICB2YV9lbmQoYXJncyk7CisKKyAgICBpZiAoIGRlYnVndHJhY2Vfc2VuZF90b19jb25zb2xl
ICkKKyAgICB7CisgICAgICAgIHVuc2lnbmVkIGludCBuID0gc2NucHJpbnRmKGNudGJ1Ziwgc2l6
ZW9mKGNudGJ1ZiksICIldSAiLCArK2NvdW50KTsKKworICAgICAgICBjb25zb2xlX3NlcmlhbF9w
dXRzKGNudGJ1Ziwgbik7CisgICAgICAgIGNvbnNvbGVfc2VyaWFsX3B1dHMoYnVmLCBucik7Cisg
ICAgfQorICAgIGVsc2UKKyAgICB7CisgICAgICAgIGlmICggc3RyY21wKGJ1ZiwgbGFzdF9idWYp
ICkKKyAgICAgICAgeworICAgICAgICAgICAgbGFzdF9wcmQgPSBkZWJ1Z3RyYWNlX3ByZDsKKyAg
ICAgICAgICAgIGxhc3RfY291bnQgPSArK2NvdW50OworICAgICAgICAgICAgc2FmZV9zdHJjcHko
bGFzdF9idWYsIGJ1Zik7CisgICAgICAgICAgICBzbnByaW50ZihjbnRidWYsIHNpemVvZihjbnRi
dWYpLCAiJXUgIiwgY291bnQpOworICAgICAgICB9CisgICAgICAgIGVsc2UKKyAgICAgICAgewor
ICAgICAgICAgICAgZGVidWd0cmFjZV9wcmQgPSBsYXN0X3ByZDsKKyAgICAgICAgICAgIHNucHJp
bnRmKGNudGJ1Ziwgc2l6ZW9mKGNudGJ1ZiksICIldS0ldSAiLCBsYXN0X2NvdW50LCArK2NvdW50
KTsKKyAgICAgICAgfQorICAgICAgICBkZWJ1Z3RyYWNlX2FkZF90b19idWYoY250YnVmKTsKKyAg
ICAgICAgZGVidWd0cmFjZV9hZGRfdG9fYnVmKGJ1Zik7CisgICAgfQorCisgICAgc3Bpbl91bmxv
Y2tfaXJxcmVzdG9yZSgmZGVidWd0cmFjZV9sb2NrLCBmbGFncyk7Cit9CisKK3N0YXRpYyB2b2lk
IGRlYnVndHJhY2Vfa2V5KHVuc2lnbmVkIGNoYXIga2V5KQoreworICAgIGRlYnVndHJhY2VfdG9n
Z2xlKCk7Cit9CisKK3N0YXRpYyBpbnQgX19pbml0IGRlYnVndHJhY2VfaW5pdCh2b2lkKQorewor
ICAgIGludCBvcmRlcjsKKyAgICB1bnNpZ25lZCBpbnQga2J5dGVzLCBieXRlczsKKworICAgIC8q
IFJvdW5kIHNpemUgZG93biB0byBuZXh0IHBvd2VyIG9mIHR3by4gKi8KKyAgICB3aGlsZSAoIChr
Ynl0ZXMgPSAoZGVidWd0cmFjZV9raWxvYnl0ZXMgJiAoZGVidWd0cmFjZV9raWxvYnl0ZXMtMSkp
KSAhPSAwICkKKyAgICAgICAgZGVidWd0cmFjZV9raWxvYnl0ZXMgPSBrYnl0ZXM7CisKKyAgICBi
eXRlcyA9IGRlYnVndHJhY2Vfa2lsb2J5dGVzIDw8IDEwOworICAgIGlmICggYnl0ZXMgPT0gMCAp
CisgICAgICAgIHJldHVybiAwOworCisgICAgb3JkZXIgPSBnZXRfb3JkZXJfZnJvbV9ieXRlcyhi
eXRlcyk7CisgICAgZGVidWd0cmFjZV9idWYgPSBhbGxvY194ZW5oZWFwX3BhZ2VzKG9yZGVyLCAw
KTsKKyAgICBBU1NFUlQoZGVidWd0cmFjZV9idWYgIT0gTlVMTCk7CisKKyAgICBtZW1zZXQoZGVi
dWd0cmFjZV9idWYsICdcMCcsIGJ5dGVzKTsKKworICAgIGRlYnVndHJhY2VfYnl0ZXMgPSBieXRl
czsKKworICAgIHJlZ2lzdGVyX2tleWhhbmRsZXIoJ1QnLCBkZWJ1Z3RyYWNlX2tleSwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICJ0b2dnbGUgZGVidWd0cmFjZSB0byBjb25zb2xlL2J1ZmZlciIs
IDApOworCisgICAgcmV0dXJuIDA7Cit9CitfX2luaXRjYWxsKGRlYnVndHJhY2VfaW5pdCk7CisK
ZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL2NoYXIvY29uc29sZS5jIGIveGVuL2RyaXZlcnMvY2hh
ci9jb25zb2xlLmMKaW5kZXggZjQ5YzZmMjlhOC4uN2YyOTE5MGVhZiAxMDA2NDQKLS0tIGEveGVu
L2RyaXZlcnMvY2hhci9jb25zb2xlLmMKKysrIGIveGVuL2RyaXZlcnMvY2hhci9jb25zb2xlLmMK
QEAgLTExNjAsMTgzICsxMTYwLDcgQEAgaW50IHByaW50a19yYXRlbGltaXQodm9pZCkKIAogLyoK
ICAqICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqCi0gKiAqKioqKioqKioqKioqKiogU2VyaWFsIGNvbnNvbGUgcmluZyBidWZmZXIg
KioqKioqKioqKioqKioqKioqKgotICogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioKLSAqLwotCi0jaWZkZWYgQ09ORklHX0RFQlVH
X1RSQUNFCi0KLS8qIFNlbmQgb3V0cHV0IGRpcmVjdCB0byBjb25zb2xlLCBvciBidWZmZXIgaXQ/
ICovCi1zdGF0aWMgdm9sYXRpbGUgaW50IGRlYnVndHJhY2Vfc2VuZF90b19jb25zb2xlOwotCi1z
dGF0aWMgY2hhciAgICAgICAgKmRlYnVndHJhY2VfYnVmOyAvKiBEZWJ1Zy10cmFjZSBidWZmZXIg
Ki8KLXN0YXRpYyB1bnNpZ25lZCBpbnQgZGVidWd0cmFjZV9wcmQ7IC8qIFByb2R1Y2VyIGluZGV4
ICAgICAqLwotc3RhdGljIHVuc2lnbmVkIGludCBkZWJ1Z3RyYWNlX2tpbG9ieXRlcyA9IDEyOCwg
ZGVidWd0cmFjZV9ieXRlczsKLXN0YXRpYyB1bnNpZ25lZCBpbnQgZGVidWd0cmFjZV91c2VkOwot
c3RhdGljIERFRklORV9TUElOTE9DSyhkZWJ1Z3RyYWNlX2xvY2spOwotaW50ZWdlcl9wYXJhbSgi
ZGVidWd0cmFjZSIsIGRlYnVndHJhY2Vfa2lsb2J5dGVzKTsKLQotc3RhdGljIHZvaWQgZGVidWd0
cmFjZV9kdW1wX3dvcmtlcih2b2lkKQotewotICAgIGlmICggKGRlYnVndHJhY2VfYnl0ZXMgPT0g
MCkgfHwgIWRlYnVndHJhY2VfdXNlZCApCi0gICAgICAgIHJldHVybjsKLQotICAgIHByaW50aygi
ZGVidWd0cmFjZV9kdW1wKCkgc3RhcnRpbmdcbiIpOwotCi0gICAgLyogUHJpbnQgb2xkZXN0IHBv
cnRpb24gb2YgdGhlIHJpbmcuICovCi0gICAgQVNTRVJUKGRlYnVndHJhY2VfYnVmW2RlYnVndHJh
Y2VfYnl0ZXMgLSAxXSA9PSAwKTsKLSAgICBpZiAoIGRlYnVndHJhY2VfYnVmW2RlYnVndHJhY2Vf
cHJkXSAhPSAnXDAnICkKLSAgICAgICAgY29uc29sZV9zZXJpYWxfcHV0cygmZGVidWd0cmFjZV9i
dWZbZGVidWd0cmFjZV9wcmRdLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlYnVndHJh
Y2VfYnl0ZXMgLSBkZWJ1Z3RyYWNlX3ByZCAtIDEpOwotCi0gICAgLyogUHJpbnQgeW91bmdlc3Qg
cG9ydGlvbiBvZiB0aGUgcmluZy4gKi8KLSAgICBkZWJ1Z3RyYWNlX2J1ZltkZWJ1Z3RyYWNlX3By
ZF0gPSAnXDAnOwotICAgIGNvbnNvbGVfc2VyaWFsX3B1dHMoJmRlYnVndHJhY2VfYnVmWzBdLCBk
ZWJ1Z3RyYWNlX3ByZCk7Ci0KLSAgICBtZW1zZXQoZGVidWd0cmFjZV9idWYsICdcMCcsIGRlYnVn
dHJhY2VfYnl0ZXMpOwotCi0gICAgcHJpbnRrKCJkZWJ1Z3RyYWNlX2R1bXAoKSBmaW5pc2hlZFxu
Iik7Ci19Ci0KLXN0YXRpYyB2b2lkIGRlYnVndHJhY2VfdG9nZ2xlKHZvaWQpCi17Ci0gICAgdW5z
aWduZWQgbG9uZyBmbGFnczsKLQotICAgIHdhdGNoZG9nX2Rpc2FibGUoKTsKLSAgICBzcGluX2xv
Y2tfaXJxc2F2ZSgmZGVidWd0cmFjZV9sb2NrLCBmbGFncyk7Ci0KLSAgICAvKgotICAgICAqIER1
bXAgdGhlIGJ1ZmZlciAqYmVmb3JlKiB0b2dnbGluZywgaW4gY2FzZSB0aGUgYWN0IG9mIGR1bXBp
bmcgdGhlCi0gICAgICogYnVmZmVyIGl0c2VsZiBjYXVzZXMgbW9yZSBwcmludGsoKSBpbnZvY2F0
aW9ucy4KLSAgICAgKi8KLSAgICBwcmludGsoImRlYnVndHJhY2VfcHJpbnRrIG5vdyB3cml0aW5n
IHRvICVzLlxuIiwKLSAgICAgICAgICAgIWRlYnVndHJhY2Vfc2VuZF90b19jb25zb2xlID8gImNv
bnNvbGUiOiAiYnVmZmVyIik7Ci0gICAgaWYgKCAhZGVidWd0cmFjZV9zZW5kX3RvX2NvbnNvbGUg
KQotICAgICAgICBkZWJ1Z3RyYWNlX2R1bXBfd29ya2VyKCk7Ci0KLSAgICBkZWJ1Z3RyYWNlX3Nl
bmRfdG9fY29uc29sZSA9ICFkZWJ1Z3RyYWNlX3NlbmRfdG9fY29uc29sZTsKLQotICAgIHNwaW5f
dW5sb2NrX2lycXJlc3RvcmUoJmRlYnVndHJhY2VfbG9jaywgZmxhZ3MpOwotICAgIHdhdGNoZG9n
X2VuYWJsZSgpOwotCi19Ci0KLXZvaWQgZGVidWd0cmFjZV9kdW1wKHZvaWQpCi17Ci0gICAgdW5z
aWduZWQgbG9uZyBmbGFnczsKLQotICAgIHdhdGNoZG9nX2Rpc2FibGUoKTsKLSAgICBzcGluX2xv
Y2tfaXJxc2F2ZSgmZGVidWd0cmFjZV9sb2NrLCBmbGFncyk7Ci0KLSAgICBkZWJ1Z3RyYWNlX2R1
bXBfd29ya2VyKCk7Ci0KLSAgICBzcGluX3VubG9ja19pcnFyZXN0b3JlKCZkZWJ1Z3RyYWNlX2xv
Y2ssIGZsYWdzKTsKLSAgICB3YXRjaGRvZ19lbmFibGUoKTsKLX0KLQotc3RhdGljIHZvaWQgZGVi
dWd0cmFjZV9hZGRfdG9fYnVmKGNoYXIgKmJ1ZikKLXsKLSAgICBjaGFyICpwOwotCi0gICAgZm9y
ICggcCA9IGJ1ZjsgKnAgIT0gJ1wwJzsgcCsrICkKLSAgICB7Ci0gICAgICAgIGRlYnVndHJhY2Vf
YnVmW2RlYnVndHJhY2VfcHJkKytdID0gKnA7Ci0gICAgICAgIC8qIEFsd2F5cyBsZWF2ZSBhIG51
bCBieXRlIGF0IHRoZSBlbmQgb2YgdGhlIGJ1ZmZlci4gKi8KLSAgICAgICAgaWYgKCBkZWJ1Z3Ry
YWNlX3ByZCA9PSAoZGVidWd0cmFjZV9ieXRlcyAtIDEpICkKLSAgICAgICAgICAgIGRlYnVndHJh
Y2VfcHJkID0gMDsKLSAgICB9Ci19Ci0KLXZvaWQgZGVidWd0cmFjZV9wcmludGsoY29uc3QgY2hh
ciAqZm10LCAuLi4pCi17Ci0gICAgc3RhdGljIGNoYXIgYnVmWzEwMjRdLCBsYXN0X2J1ZlsxMDI0
XTsKLSAgICBzdGF0aWMgdW5zaWduZWQgaW50IGNvdW50LCBsYXN0X2NvdW50LCBsYXN0X3ByZDsK
LQotICAgIGNoYXIgICAgICAgICAgY250YnVmWzI0XTsKLSAgICB2YV9saXN0ICAgICAgIGFyZ3M7
Ci0gICAgdW5zaWduZWQgbG9uZyBmbGFnczsKLSAgICB1bnNpZ25lZCBpbnQgbnI7Ci0KLSAgICBp
ZiAoIGRlYnVndHJhY2VfYnl0ZXMgPT0gMCApCi0gICAgICAgIHJldHVybjsKLQotICAgIGRlYnVn
dHJhY2VfdXNlZCA9IDE7Ci0KLSAgICBzcGluX2xvY2tfaXJxc2F2ZSgmZGVidWd0cmFjZV9sb2Nr
LCBmbGFncyk7Ci0KLSAgICBBU1NFUlQoZGVidWd0cmFjZV9idWZbZGVidWd0cmFjZV9ieXRlcyAt
IDFdID09IDApOwotCi0gICAgdmFfc3RhcnQoYXJncywgZm10KTsKLSAgICBuciA9IHZzY25wcmlu
dGYoYnVmLCBzaXplb2YoYnVmKSwgZm10LCBhcmdzKTsKLSAgICB2YV9lbmQoYXJncyk7Ci0KLSAg
ICBpZiAoIGRlYnVndHJhY2Vfc2VuZF90b19jb25zb2xlICkKLSAgICB7Ci0gICAgICAgIHVuc2ln
bmVkIGludCBuID0gc2NucHJpbnRmKGNudGJ1Ziwgc2l6ZW9mKGNudGJ1ZiksICIldSAiLCArK2Nv
dW50KTsKLQotICAgICAgICBjb25zb2xlX3NlcmlhbF9wdXRzKGNudGJ1Ziwgbik7Ci0gICAgICAg
IGNvbnNvbGVfc2VyaWFsX3B1dHMoYnVmLCBucik7Ci0gICAgfQotICAgIGVsc2UKLSAgICB7Ci0g
ICAgICAgIGlmICggc3RyY21wKGJ1ZiwgbGFzdF9idWYpICkKLSAgICAgICAgewotICAgICAgICAg
ICAgbGFzdF9wcmQgPSBkZWJ1Z3RyYWNlX3ByZDsKLSAgICAgICAgICAgIGxhc3RfY291bnQgPSAr
K2NvdW50OwotICAgICAgICAgICAgc2FmZV9zdHJjcHkobGFzdF9idWYsIGJ1Zik7Ci0gICAgICAg
ICAgICBzbnByaW50ZihjbnRidWYsIHNpemVvZihjbnRidWYpLCAiJXUgIiwgY291bnQpOwotICAg
ICAgICB9Ci0gICAgICAgIGVsc2UKLSAgICAgICAgewotICAgICAgICAgICAgZGVidWd0cmFjZV9w
cmQgPSBsYXN0X3ByZDsKLSAgICAgICAgICAgIHNucHJpbnRmKGNudGJ1Ziwgc2l6ZW9mKGNudGJ1
ZiksICIldS0ldSAiLCBsYXN0X2NvdW50LCArK2NvdW50KTsKLSAgICAgICAgfQotICAgICAgICBk
ZWJ1Z3RyYWNlX2FkZF90b19idWYoY250YnVmKTsKLSAgICAgICAgZGVidWd0cmFjZV9hZGRfdG9f
YnVmKGJ1Zik7Ci0gICAgfQotCi0gICAgc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZGVidWd0cmFj
ZV9sb2NrLCBmbGFncyk7Ci19Ci0KLXN0YXRpYyB2b2lkIGRlYnVndHJhY2Vfa2V5KHVuc2lnbmVk
IGNoYXIga2V5KQotewotICAgIGRlYnVndHJhY2VfdG9nZ2xlKCk7Ci19Ci0KLXN0YXRpYyBpbnQg
X19pbml0IGRlYnVndHJhY2VfaW5pdCh2b2lkKQotewotICAgIGludCBvcmRlcjsKLSAgICB1bnNp
Z25lZCBpbnQga2J5dGVzLCBieXRlczsKLQotICAgIC8qIFJvdW5kIHNpemUgZG93biB0byBuZXh0
IHBvd2VyIG9mIHR3by4gKi8KLSAgICB3aGlsZSAoIChrYnl0ZXMgPSAoZGVidWd0cmFjZV9raWxv
Ynl0ZXMgJiAoZGVidWd0cmFjZV9raWxvYnl0ZXMtMSkpKSAhPSAwICkKLSAgICAgICAgZGVidWd0
cmFjZV9raWxvYnl0ZXMgPSBrYnl0ZXM7Ci0KLSAgICBieXRlcyA9IGRlYnVndHJhY2Vfa2lsb2J5
dGVzIDw8IDEwOwotICAgIGlmICggYnl0ZXMgPT0gMCApCi0gICAgICAgIHJldHVybiAwOwotCi0g
ICAgb3JkZXIgPSBnZXRfb3JkZXJfZnJvbV9ieXRlcyhieXRlcyk7Ci0gICAgZGVidWd0cmFjZV9i
dWYgPSBhbGxvY194ZW5oZWFwX3BhZ2VzKG9yZGVyLCAwKTsKLSAgICBBU1NFUlQoZGVidWd0cmFj
ZV9idWYgIT0gTlVMTCk7Ci0KLSAgICBtZW1zZXQoZGVidWd0cmFjZV9idWYsICdcMCcsIGJ5dGVz
KTsKLQotICAgIGRlYnVndHJhY2VfYnl0ZXMgPSBieXRlczsKLQotICAgIHJlZ2lzdGVyX2tleWhh
bmRsZXIoJ1QnLCBkZWJ1Z3RyYWNlX2tleSwKLSAgICAgICAgICAgICAgICAgICAgICAgICJ0b2dn
bGUgZGVidWd0cmFjZSB0byBjb25zb2xlL2J1ZmZlciIsIDApOwotCi0gICAgcmV0dXJuIDA7Ci19
Ci1fX2luaXRjYWxsKGRlYnVndHJhY2VfaW5pdCk7Ci0KLSNlbmRpZiAvKiAhQ09ORklHX0RFQlVH
X1RSQUNFICovCi0KLQotLyoKLSAqICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqCi0gKiAqKioqKioqKioqKioqKiogRGVidWdnaW5n
L3RyYWNpbmcvZXJyb3ItcmVwb3J0ICoqKioqKioqKioqKioqKgorICogKioqKioqKioqKioqKioq
KioqKioqKiBFcnJvci1yZXBvcnQgKioqKioqKioqKioqKioqKioqKioqKioqKioKICAqICoqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
CiAgKi8KIAotLSAKMi4xNi40CgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJv
amVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hl
bi1kZXZlbA==

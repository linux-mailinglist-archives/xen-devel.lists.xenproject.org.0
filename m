Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id B880FA6DE2
	for <lists+xen-devel@lfdr.de>; Tue,  3 Sep 2019 18:18:08 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i5BSH-0001tU-Ko; Tue, 03 Sep 2019 16:14:53 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=4NVN=W6=citrix.com=roger.pau@srs-us1.protection.inumbo.net>)
 id 1i5BSF-0001ss-Jy
 for xen-devel@lists.xenproject.org; Tue, 03 Sep 2019 16:14:51 +0000
X-Inumbo-ID: f49add0a-ce65-11e9-ab97-12813bfff9fa
Received: from esa2.hc3370-68.iphmx.com (unknown [216.71.145.153])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id f49add0a-ce65-11e9-ab97-12813bfff9fa;
 Tue, 03 Sep 2019 16:14:50 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1567527291;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=aWZABy/i9B5DGCC5tc4gS/wgzUInYjMNWvjcV6vkaiY=;
 b=Ggrk6KZSrHaAw8722WTgnCu6EYdXte509oWUvtLWIBfPuWfVzTmq7xZY
 RgRp7pMVguSb2G7GRGPIzbY/X9aGJFDcuGDuoli3DQ7NoXk9jXgHLi3mT
 vmYSAYmZ1Gt/rhh7XVx+YHd6Ap05tE/dRkotW2UvxJ5F6ySCsyTPkmij0 A=;
Authentication-Results: esa2.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=roger.pau@citrix.com;
 spf=Pass smtp.mailfrom=roger.pau@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa2.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 roger.pau@citrix.com) identity=pra; client-ip=162.221.158.21;
 receiver=esa2.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="roger.pau@citrix.com"; x-conformance=sidf_compatible
Received-SPF: Pass (esa2.hc3370-68.iphmx.com: domain of
 roger.pau@citrix.com designates 162.221.158.21 as permitted
 sender) identity=mailfrom; client-ip=162.221.158.21;
 receiver=esa2.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="roger.pau@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83 ~all"
Received-SPF: None (esa2.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa2.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: pafoqxmZTwFemsXBsiJ4wWkz4IJH4xM5LuKibUdmMSTSMRDcbz/b5ArkMdccd2RS6nZ2S7Yups
 oK6hqk9Mv+1RhfAzn1CXt4N2Nc/0TGsfeHTfS2On6xy6nP5QfxIySP7vC3nWRkpQ4wVVdZg95/
 3Ntzg0LZOgJwx0KcGw5Spi0a/8t1PcdGGolMsJB9SHylBu5jj3F6fxw8a72QPZ6UuHfMAlUBUs
 Erv75eAonoyAgqLQF14KBYXt5t4GWxZEi9tG+TuU6UdS3M9rm/g53kwQjjd763zHPrIuE9gXb6
 RzA=
X-SBRS: 2.7
X-MesageID: 5068896
X-Ironport-Server: esa2.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.64,463,1559534400"; 
   d="scan'208";a="5068896"
From: Roger Pau Monne <roger.pau@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Tue, 3 Sep 2019 18:14:22 +0200
Message-ID: <20190903161428.7159-6-roger.pau@citrix.com>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190903161428.7159-1-roger.pau@citrix.com>
References: <20190903161428.7159-1-roger.pau@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v2 05/11] ioreq: add internal ioreq
 initialization support
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>,
 Paul Durrant <paul.durrant@citrix.com>, Wei Liu <wl@xen.org>,
 Jan Beulich <jbeulich@suse.com>, Roger Pau Monne <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

QWRkIHN1cHBvcnQgZm9yIGludGVybmFsIGlvcmVxIHNlcnZlcnMgdG8gaW5pdGlhbGl6YXRpb24g
YW5kCmRlaW5pdGlhbGl6YXRpb24gcm91dGluZXMsIHByZXZlbnQgc29tZSBmdW5jdGlvbnMgZnJv
bSBiZWluZyBleGVjdXRlZAphZ2FpbnN0IGludGVybmFsIGlvcmVxIHNlcnZlcnMgYW5kIGFkZCBn
dWFyZHMgdG8gb25seSBhbGxvdyBpbnRlcm5hbApjYWxsZXJzIHRvIG1vZGlmeSBpbnRlcm5hbCBp
b3JlcSBzZXJ2ZXJzLiBFeHRlcm5hbCBjYWxsZXJzIChpZTogZnJvbQpoeXBlcmNhbGxzKSBhcmUg
b25seSBhbGxvd2VkIHRvIGRlYWwgd2l0aCBleHRlcm5hbCBpb3JlcSBzZXJ2ZXJzLgoKU2lnbmVk
LW9mZi1ieTogUm9nZXIgUGF1IE1vbm7DqSA8cm9nZXIucGF1QGNpdHJpeC5jb20+Ci0tLQpDaGFu
Z2VzIHNpbmNlIHYxOgogLSBEbyBub3QgcGFzcyBhbiAnaW50ZXJuYWwnIHBhcmFtZXRlciB0byBt
b3N0IGZ1bmN0aW9ucywgYW5kIGluc3RlYWQKICAgdXNlIHRoZSBpZCB0byBrZXkgd2hldGhlciBh
biBpb3JlcSBzZXJ2ZXIgaXMgaW50ZXJuYWwgb3IgZXh0ZXJuYWwuCiAtIFByZXZlbnQgZW5hYmxp
bmcgYW4gaW50ZXJuYWwgc2VydmVyIHdpdGhvdXQgYSBoYW5kbGVyLgotLS0KIHhlbi9hcmNoL3g4
Ni9odm0vZG0uYyAgICAgICAgICAgIHwgIDE3ICsrLQogeGVuL2FyY2gveDg2L2h2bS9pb3JlcS5j
ICAgICAgICAgfCAxNzMgKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLQogeGVuL2luY2x1
ZGUvYXNtLXg4Ni9odm0vZG9tYWluLmggfCAgIDUgKy0KIHhlbi9pbmNsdWRlL2FzbS14ODYvaHZt
L2lvcmVxLmggIHwgICA4ICstCiA0IGZpbGVzIGNoYW5nZWQsIDEzNSBpbnNlcnRpb25zKCspLCA2
OCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvaHZtL2RtLmMgYi94ZW4v
YXJjaC94ODYvaHZtL2RtLmMKaW5kZXggYzJmY2E5ZjcyOS4uNmEzNjgyZTU4YyAxMDA2NDQKLS0t
IGEveGVuL2FyY2gveDg2L2h2bS9kbS5jCisrKyBiL3hlbi9hcmNoL3g4Ni9odm0vZG0uYwpAQCAt
NDE3LDcgKzQxNyw3IEBAIHN0YXRpYyBpbnQgZG1fb3AoY29uc3Qgc3RydWN0IGRtb3BfYXJncyAq
b3BfYXJncykKICAgICAgICAgICAgIGJyZWFrOwogCiAgICAgICAgIHJjID0gaHZtX2NyZWF0ZV9p
b3JlcV9zZXJ2ZXIoZCwgZGF0YS0+aGFuZGxlX2J1ZmlvcmVxLAotICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICZkYXRhLT5pZCk7CisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgJmRhdGEtPmlkLCBmYWxzZSk7CiAgICAgICAgIGJyZWFrOwogICAgIH0KIApA
QCAtNDUwLDYgKzQ1MCw5IEBAIHN0YXRpYyBpbnQgZG1fb3AoY29uc3Qgc3RydWN0IGRtb3BfYXJn
cyAqb3BfYXJncykKICAgICAgICAgcmMgPSAtRUlOVkFMOwogICAgICAgICBpZiAoIGRhdGEtPnBh
ZCApCiAgICAgICAgICAgICBicmVhazsKKyAgICAgICAgcmMgPSAtRVBFUk07CisgICAgICAgIGlm
ICggaHZtX2lvcmVxX2lzX2ludGVybmFsKGRhdGEtPmlkKSApCisgICAgICAgICAgICBicmVhazsK
IAogICAgICAgICByYyA9IGh2bV9tYXBfaW9fcmFuZ2VfdG9faW9yZXFfc2VydmVyKGQsIGRhdGEt
PmlkLCBkYXRhLT50eXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGRhdGEtPnN0YXJ0LCBkYXRhLT5lbmQpOwpAQCAtNDY0LDYgKzQ2Nyw5IEBAIHN0YXRp
YyBpbnQgZG1fb3AoY29uc3Qgc3RydWN0IGRtb3BfYXJncyAqb3BfYXJncykKICAgICAgICAgcmMg
PSAtRUlOVkFMOwogICAgICAgICBpZiAoIGRhdGEtPnBhZCApCiAgICAgICAgICAgICBicmVhazsK
KyAgICAgICAgcmMgPSAtRVBFUk07CisgICAgICAgIGlmICggaHZtX2lvcmVxX2lzX2ludGVybmFs
KGRhdGEtPmlkKSApCisgICAgICAgICAgICBicmVhazsKIAogICAgICAgICByYyA9IGh2bV91bm1h
cF9pb19yYW5nZV9mcm9tX2lvcmVxX3NlcnZlcihkLCBkYXRhLT5pZCwgZGF0YS0+dHlwZSwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS0+c3Rh
cnQsIGRhdGEtPmVuZCk7CkBAIC00ODEsNiArNDg3LDkgQEAgc3RhdGljIGludCBkbV9vcChjb25z
dCBzdHJ1Y3QgZG1vcF9hcmdzICpvcF9hcmdzKQogICAgICAgICByYyA9IC1FT1BOT1RTVVBQOwog
ICAgICAgICBpZiAoICFoYXBfZW5hYmxlZChkKSApCiAgICAgICAgICAgICBicmVhazsKKyAgICAg
ICAgcmMgPSAtRVBFUk07CisgICAgICAgIGlmICggaHZtX2lvcmVxX2lzX2ludGVybmFsKGRhdGEt
PmlkKSApCisgICAgICAgICAgICBicmVhazsKIAogICAgICAgICBpZiAoIGZpcnN0X2dmbiA9PSAw
ICkKICAgICAgICAgICAgIHJjID0gaHZtX21hcF9tZW1fdHlwZV90b19pb3JlcV9zZXJ2ZXIoZCwg
ZGF0YS0+aWQsCkBAIC01MjgsNiArNTM3LDkgQEAgc3RhdGljIGludCBkbV9vcChjb25zdCBzdHJ1
Y3QgZG1vcF9hcmdzICpvcF9hcmdzKQogICAgICAgICByYyA9IC1FSU5WQUw7CiAgICAgICAgIGlm
ICggZGF0YS0+cGFkICkKICAgICAgICAgICAgIGJyZWFrOworICAgICAgICByYyA9IC1FUEVSTTsK
KyAgICAgICAgaWYgKCBodm1faW9yZXFfaXNfaW50ZXJuYWwoZGF0YS0+aWQpICkKKyAgICAgICAg
ICAgIGJyZWFrOwogCiAgICAgICAgIHJjID0gaHZtX3NldF9pb3JlcV9zZXJ2ZXJfc3RhdGUoZCwg
ZGF0YS0+aWQsICEhZGF0YS0+ZW5hYmxlZCk7CiAgICAgICAgIGJyZWFrOwpAQCAtNTQxLDYgKzU1
Myw5IEBAIHN0YXRpYyBpbnQgZG1fb3AoY29uc3Qgc3RydWN0IGRtb3BfYXJncyAqb3BfYXJncykK
ICAgICAgICAgcmMgPSAtRUlOVkFMOwogICAgICAgICBpZiAoIGRhdGEtPnBhZCApCiAgICAgICAg
ICAgICBicmVhazsKKyAgICAgICAgcmMgPSAtRVBFUk07CisgICAgICAgIGlmICggaHZtX2lvcmVx
X2lzX2ludGVybmFsKGRhdGEtPmlkKSApCisgICAgICAgICAgICBicmVhazsKIAogICAgICAgICBy
YyA9IGh2bV9kZXN0cm95X2lvcmVxX3NlcnZlcihkLCBkYXRhLT5pZCk7CiAgICAgICAgIGJyZWFr
OwpkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L2h2bS9pb3JlcS5jIGIveGVuL2FyY2gveDg2L2h2
bS9pb3JlcS5jCmluZGV4IDk1NDkyYmMxMTEuLmRiYzVlNmI0YzUgMTAwNjQ0Ci0tLSBhL3hlbi9h
cmNoL3g4Ni9odm0vaW9yZXEuYworKysgYi94ZW4vYXJjaC94ODYvaHZtL2lvcmVxLmMKQEAgLTU5
LDEwICs1OSwxMSBAQCBzdGF0aWMgc3RydWN0IGh2bV9pb3JlcV9zZXJ2ZXIgKmdldF9pb3JlcV9z
ZXJ2ZXIoY29uc3Qgc3RydWN0IGRvbWFpbiAqZCwKIC8qCiAgKiBJdGVyYXRlIG92ZXIgYWxsIHBv
c3NpYmxlIGlvcmVxIHNlcnZlcnMuCiAgKgotICogTk9URTogVGhlIGl0ZXJhdGlvbiBpcyBiYWNr
d2FyZHMgc3VjaCB0aGF0IG1vcmUgcmVjZW50bHkgY3JlYXRlZAotICogICAgICAgaW9yZXEgc2Vy
dmVycyBhcmUgZmF2b3VyZWQgaW4gaHZtX3NlbGVjdF9pb3JlcV9zZXJ2ZXIoKS4KLSAqICAgICAg
IFRoaXMgaXMgYSBzZW1hbnRpYyB0aGF0IHByZXZpb3VzbHkgZXhpc3RlZCB3aGVuIGlvcmVxIHNl
cnZlcnMKLSAqICAgICAgIHdlcmUgaGVsZCBpbiBhIGxpbmtlZCBsaXN0LgorICogTk9URTogVGhl
IGl0ZXJhdGlvbiBpcyBiYWNrd2FyZHMgc3VjaCB0aGF0IGludGVybmFsIGFuZCBtb3JlIHJlY2Vu
dGx5CisgKiAgICAgICBjcmVhdGVkIGV4dGVybmFsIGlvcmVxIHNlcnZlcnMgYXJlIGZhdm91cmVk
IGluCisgKiAgICAgICBodm1fc2VsZWN0X2lvcmVxX3NlcnZlcigpLgorICogICAgICAgVGhpcyBp
cyBhIHNlbWFudGljIHRoYXQgcHJldmlvdXNseSBleGlzdGVkIGZvciBleHRlcm5hbCBzZXJ2ZXJz
IHdoZW4KKyAqICAgICAgIGlvcmVxIHNlcnZlcnMgd2VyZSBoZWxkIGluIGEgbGlua2VkIGxpc3Qu
CiAgKi8KICNkZWZpbmUgRk9SX0VBQ0hfSU9SRVFfU0VSVkVSKGQsIGlkLCBzKSBcCiAgICAgZm9y
ICggKGlkKSA9IE1BWF9OUl9JT1JFUV9TRVJWRVJTOyAoaWQpICE9IDA7ICkgXApAQCAtNzAsNiAr
NzEsMTIgQEAgc3RhdGljIHN0cnVjdCBodm1faW9yZXFfc2VydmVyICpnZXRfaW9yZXFfc2VydmVy
KGNvbnN0IHN0cnVjdCBkb21haW4gKmQsCiAgICAgICAgICAgICBjb250aW51ZTsgXAogICAgICAg
ICBlbHNlCiAKKyNkZWZpbmUgRk9SX0VBQ0hfRVhURVJOQUxfSU9SRVFfU0VSVkVSKGQsIGlkLCBz
KSBcCisgICAgZm9yICggKGlkKSA9IE1BWF9OUl9FWFRFUk5BTF9JT1JFUV9TRVJWRVJTOyAoaWQp
ICE9IDA7ICkgXAorICAgICAgICBpZiAoICEocyA9IEdFVF9JT1JFUV9TRVJWRVIoZCwgLS0oaWQp
KSkgKSBcCisgICAgICAgICAgICBjb250aW51ZTsgXAorICAgICAgICBlbHNlCisKIHN0YXRpYyBp
b3JlcV90ICpnZXRfaW9yZXEoc3RydWN0IGh2bV9pb3JlcV9zZXJ2ZXIgKnMsIHN0cnVjdCB2Y3B1
ICp2KQogewogICAgIHNoYXJlZF9pb3BhZ2VfdCAqcCA9IHMtPmlvcmVxLnZhOwpAQCAtODYsNyAr
OTMsNyBAQCBib29sIGh2bV9pb19wZW5kaW5nKHN0cnVjdCB2Y3B1ICp2KQogICAgIHN0cnVjdCBo
dm1faW9yZXFfc2VydmVyICpzOwogICAgIHVuc2lnbmVkIGludCBpZDsKIAotICAgIEZPUl9FQUNI
X0lPUkVRX1NFUlZFUihkLCBpZCwgcykKKyAgICBGT1JfRUFDSF9FWFRFUk5BTF9JT1JFUV9TRVJW
RVIoZCwgaWQsIHMpCiAgICAgewogICAgICAgICBzdHJ1Y3QgaHZtX2lvcmVxX3ZjcHUgKnN2Owog
CkBAIC0xOTAsNyArMTk3LDcgQEAgYm9vbCBoYW5kbGVfaHZtX2lvX2NvbXBsZXRpb24oc3RydWN0
IHZjcHUgKnYpCiAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICB9CiAKLSAgICBGT1JfRUFDSF9J
T1JFUV9TRVJWRVIoZCwgaWQsIHMpCisgICAgRk9SX0VBQ0hfRVhURVJOQUxfSU9SRVFfU0VSVkVS
KGQsIGlkLCBzKQogICAgIHsKICAgICAgICAgc3RydWN0IGh2bV9pb3JlcV92Y3B1ICpzdjsKIApA
QCAtNDMwLDcgKzQzNyw3IEBAIGJvb2wgaXNfaW9yZXFfc2VydmVyX3BhZ2Uoc3RydWN0IGRvbWFp
biAqZCwgY29uc3Qgc3RydWN0IHBhZ2VfaW5mbyAqcGFnZSkKIAogICAgIHNwaW5fbG9ja19yZWN1
cnNpdmUoJmQtPmFyY2guaHZtLmlvcmVxX3NlcnZlci5sb2NrKTsKIAotICAgIEZPUl9FQUNIX0lP
UkVRX1NFUlZFUihkLCBpZCwgcykKKyAgICBGT1JfRUFDSF9FWFRFUk5BTF9JT1JFUV9TRVJWRVIo
ZCwgaWQsIHMpCiAgICAgewogICAgICAgICBpZiAoIChzLT5pb3JlcS5wYWdlID09IHBhZ2UpIHx8
IChzLT5idWZpb3JlcS5wYWdlID09IHBhZ2UpICkKICAgICAgICAgewpAQCAtNjg4LDcgKzY5NSw3
IEBAIHN0YXRpYyBpbnQgaHZtX2lvcmVxX3NlcnZlcl9hbGxvY19yYW5nZXNldHMoc3RydWN0IGh2
bV9pb3JlcV9zZXJ2ZXIgKnMsCiAgICAgcmV0dXJuIHJjOwogfQogCi1zdGF0aWMgdm9pZCBodm1f
aW9yZXFfc2VydmVyX2VuYWJsZShzdHJ1Y3QgaHZtX2lvcmVxX3NlcnZlciAqcykKK3N0YXRpYyB2
b2lkIGh2bV9pb3JlcV9zZXJ2ZXJfZW5hYmxlKHN0cnVjdCBodm1faW9yZXFfc2VydmVyICpzLCBi
b29sIGludGVybmFsKQogewogICAgIHN0cnVjdCBodm1faW9yZXFfdmNwdSAqc3Y7CiAKQEAgLTY5
NywyOSArNzA0LDQwIEBAIHN0YXRpYyB2b2lkIGh2bV9pb3JlcV9zZXJ2ZXJfZW5hYmxlKHN0cnVj
dCBodm1faW9yZXFfc2VydmVyICpzKQogICAgIGlmICggcy0+ZW5hYmxlZCApCiAgICAgICAgIGdv
dG8gZG9uZTsKIAotICAgIGh2bV9yZW1vdmVfaW9yZXFfZ2ZuKHMsIGZhbHNlKTsKLSAgICBodm1f
cmVtb3ZlX2lvcmVxX2dmbihzLCB0cnVlKTsKKyAgICBpZiAoICFpbnRlcm5hbCApCisgICAgewor
ICAgICAgICBodm1fcmVtb3ZlX2lvcmVxX2dmbihzLCBmYWxzZSk7CisgICAgICAgIGh2bV9yZW1v
dmVfaW9yZXFfZ2ZuKHMsIHRydWUpOwogCi0gICAgcy0+ZW5hYmxlZCA9IHRydWU7CisgICAgICAg
IGxpc3RfZm9yX2VhY2hfZW50cnkgKCBzdiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICZzLT5pb3JlcV92Y3B1X2xpc3QsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0
X2VudHJ5ICkKKyAgICAgICAgICAgIGh2bV91cGRhdGVfaW9yZXFfZXZ0Y2huKHMsIHN2KTsKKyAg
ICB9CisgICAgZWxzZSBpZiAoICFzLT5oYW5kbGVyICkKKyAgICB7CisgICAgICAgIEFTU0VSVF9V
TlJFQUNIQUJMRSgpOworICAgICAgICBnb3RvIGRvbmU7CisgICAgfQogCi0gICAgbGlzdF9mb3Jf
ZWFjaF9lbnRyeSAoIHN2LAotICAgICAgICAgICAgICAgICAgICAgICAgICAmcy0+aW9yZXFfdmNw
dV9saXN0LAotICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0X2VudHJ5ICkKLSAgICAgICAg
aHZtX3VwZGF0ZV9pb3JlcV9ldnRjaG4ocywgc3YpOworICAgIHMtPmVuYWJsZWQgPSB0cnVlOwog
CiAgIGRvbmU6CiAgICAgc3Bpbl91bmxvY2soJnMtPmxvY2spOwogfQogCi1zdGF0aWMgdm9pZCBo
dm1faW9yZXFfc2VydmVyX2Rpc2FibGUoc3RydWN0IGh2bV9pb3JlcV9zZXJ2ZXIgKnMpCitzdGF0
aWMgdm9pZCBodm1faW9yZXFfc2VydmVyX2Rpc2FibGUoc3RydWN0IGh2bV9pb3JlcV9zZXJ2ZXIg
KnMsIGJvb2wgaW50ZXJuYWwpCiB7CiAgICAgc3Bpbl9sb2NrKCZzLT5sb2NrKTsKIAogICAgIGlm
ICggIXMtPmVuYWJsZWQgKQogICAgICAgICBnb3RvIGRvbmU7CiAKLSAgICBodm1fYWRkX2lvcmVx
X2dmbihzLCB0cnVlKTsKLSAgICBodm1fYWRkX2lvcmVxX2dmbihzLCBmYWxzZSk7CisgICAgaWYg
KCAhaW50ZXJuYWwgKQorICAgIHsKKyAgICAgICAgaHZtX2FkZF9pb3JlcV9nZm4ocywgdHJ1ZSk7
CisgICAgICAgIGh2bV9hZGRfaW9yZXFfZ2ZuKHMsIGZhbHNlKTsKKyAgICB9CiAKICAgICBzLT5l
bmFibGVkID0gZmFsc2U7CiAKQEAgLTczNiwzMyArNzU0LDM5IEBAIHN0YXRpYyBpbnQgaHZtX2lv
cmVxX3NlcnZlcl9pbml0KHN0cnVjdCBodm1faW9yZXFfc2VydmVyICpzLAogICAgIGludCByYzsK
IAogICAgIHMtPnRhcmdldCA9IGQ7Ci0KLSAgICBnZXRfa25vd25hbGl2ZV9kb21haW4oY3VycmQp
OwotICAgIHMtPmVtdWxhdG9yID0gY3VycmQ7Ci0KICAgICBzcGluX2xvY2tfaW5pdCgmcy0+bG9j
ayk7Ci0gICAgSU5JVF9MSVNUX0hFQUQoJnMtPmlvcmVxX3ZjcHVfbGlzdCk7Ci0gICAgc3Bpbl9s
b2NrX2luaXQoJnMtPmJ1ZmlvcmVxX2xvY2spOwotCi0gICAgcy0+aW9yZXEuZ2ZuID0gSU5WQUxJ
RF9HRk47Ci0gICAgcy0+YnVmaW9yZXEuZ2ZuID0gSU5WQUxJRF9HRk47CiAKICAgICByYyA9IGh2
bV9pb3JlcV9zZXJ2ZXJfYWxsb2NfcmFuZ2VzZXRzKHMsIGlkKTsKICAgICBpZiAoIHJjICkKICAg
ICAgICAgcmV0dXJuIHJjOwogCi0gICAgcy0+YnVmaW9yZXFfaGFuZGxpbmcgPSBidWZpb3JlcV9o
YW5kbGluZzsKLQotICAgIGZvcl9lYWNoX3ZjcHUgKCBkLCB2ICkKKyAgICBpZiAoICFodm1faW9y
ZXFfaXNfaW50ZXJuYWwoaWQpICkKICAgICB7Ci0gICAgICAgIHJjID0gaHZtX2lvcmVxX3NlcnZl
cl9hZGRfdmNwdShzLCB2KTsKLSAgICAgICAgaWYgKCByYyApCi0gICAgICAgICAgICBnb3RvIGZh
aWxfYWRkOworICAgICAgICBnZXRfa25vd25hbGl2ZV9kb21haW4oY3VycmQpOworCisgICAgICAg
IHMtPmVtdWxhdG9yID0gY3VycmQ7CisgICAgICAgIElOSVRfTElTVF9IRUFEKCZzLT5pb3JlcV92
Y3B1X2xpc3QpOworICAgICAgICBzcGluX2xvY2tfaW5pdCgmcy0+YnVmaW9yZXFfbG9jayk7CisK
KyAgICAgICAgcy0+aW9yZXEuZ2ZuID0gSU5WQUxJRF9HRk47CisgICAgICAgIHMtPmJ1ZmlvcmVx
LmdmbiA9IElOVkFMSURfR0ZOOworCisgICAgICAgIHMtPmJ1ZmlvcmVxX2hhbmRsaW5nID0gYnVm
aW9yZXFfaGFuZGxpbmc7CisKKyAgICAgICAgZm9yX2VhY2hfdmNwdSAoIGQsIHYgKQorICAgICAg
ICB7CisgICAgICAgICAgICByYyA9IGh2bV9pb3JlcV9zZXJ2ZXJfYWRkX3ZjcHUocywgdik7Cisg
ICAgICAgICAgICBpZiAoIHJjICkKKyAgICAgICAgICAgICAgICBnb3RvIGZhaWxfYWRkOworICAg
ICAgICB9CiAgICAgfQorICAgIGVsc2UKKyAgICAgICAgcy0+aGFuZGxlciA9IE5VTEw7CiAKICAg
ICByZXR1cm4gMDsKIAogIGZhaWxfYWRkOgorICAgIEFTU0VSVCghaHZtX2lvcmVxX2lzX2ludGVy
bmFsKGlkKSk7CiAgICAgaHZtX2lvcmVxX3NlcnZlcl9yZW1vdmVfYWxsX3ZjcHVzKHMpOwogICAg
IGh2bV9pb3JlcV9zZXJ2ZXJfdW5tYXBfcGFnZXMocyk7CiAKQEAgLTc3MiwzMCArNzk2LDM0IEBA
IHN0YXRpYyBpbnQgaHZtX2lvcmVxX3NlcnZlcl9pbml0KHN0cnVjdCBodm1faW9yZXFfc2VydmVy
ICpzLAogICAgIHJldHVybiByYzsKIH0KIAotc3RhdGljIHZvaWQgaHZtX2lvcmVxX3NlcnZlcl9k
ZWluaXQoc3RydWN0IGh2bV9pb3JlcV9zZXJ2ZXIgKnMpCitzdGF0aWMgdm9pZCBodm1faW9yZXFf
c2VydmVyX2RlaW5pdChzdHJ1Y3QgaHZtX2lvcmVxX3NlcnZlciAqcywgYm9vbCBpbnRlcm5hbCkK
IHsKICAgICBBU1NFUlQoIXMtPmVuYWJsZWQpOwotICAgIGh2bV9pb3JlcV9zZXJ2ZXJfcmVtb3Zl
X2FsbF92Y3B1cyhzKTsKLQotICAgIC8qCi0gICAgICogTk9URTogSXQgaXMgc2FmZSB0byBjYWxs
IGJvdGggaHZtX2lvcmVxX3NlcnZlcl91bm1hcF9wYWdlcygpIGFuZAotICAgICAqICAgICAgIGh2
bV9pb3JlcV9zZXJ2ZXJfZnJlZV9wYWdlcygpIGluIHRoYXQgb3JkZXIuCi0gICAgICogICAgICAg
VGhpcyBpcyBiZWNhdXNlIHRoZSBmb3JtZXIgd2lsbCBkbyBub3RoaW5nIGlmIHRoZSBwYWdlcwot
ICAgICAqICAgICAgIGFyZSBub3QgbWFwcGVkLCBsZWF2aW5nIHRoZSBwYWdlIHRvIGJlIGZyZWVk
IGJ5IHRoZSBsYXR0ZXIuCi0gICAgICogICAgICAgSG93ZXZlciBpZiB0aGUgcGFnZXMgYXJlIG1h
cHBlZCB0aGVuIHRoZSBmb3JtZXIgd2lsbCBzZXQKLSAgICAgKiAgICAgICB0aGUgcGFnZV9pbmZv
IHBvaW50ZXIgdG8gTlVMTCwgbWVhbmluZyB0aGUgbGF0dGVyIHdpbGwgZG8KLSAgICAgKiAgICAg
ICBub3RoaW5nLgotICAgICAqLwotICAgIGh2bV9pb3JlcV9zZXJ2ZXJfdW5tYXBfcGFnZXMocyk7
Ci0gICAgaHZtX2lvcmVxX3NlcnZlcl9mcmVlX3BhZ2VzKHMpOwogCiAgICAgaHZtX2lvcmVxX3Nl
cnZlcl9mcmVlX3Jhbmdlc2V0cyhzKTsKIAotICAgIHB1dF9kb21haW4ocy0+ZW11bGF0b3IpOwor
ICAgIGlmICggIWludGVybmFsICkKKyAgICB7CisgICAgICAgIGh2bV9pb3JlcV9zZXJ2ZXJfcmVt
b3ZlX2FsbF92Y3B1cyhzKTsKKworICAgICAgICAvKgorICAgICAgICAgKiBOT1RFOiBJdCBpcyBz
YWZlIHRvIGNhbGwgYm90aCBodm1faW9yZXFfc2VydmVyX3VubWFwX3BhZ2VzKCkgYW5kCisgICAg
ICAgICAqICAgICAgIGh2bV9pb3JlcV9zZXJ2ZXJfZnJlZV9wYWdlcygpIGluIHRoYXQgb3JkZXIu
CisgICAgICAgICAqICAgICAgIFRoaXMgaXMgYmVjYXVzZSB0aGUgZm9ybWVyIHdpbGwgZG8gbm90
aGluZyBpZiB0aGUgcGFnZXMKKyAgICAgICAgICogICAgICAgYXJlIG5vdCBtYXBwZWQsIGxlYXZp
bmcgdGhlIHBhZ2UgdG8gYmUgZnJlZWQgYnkgdGhlIGxhdHRlci4KKyAgICAgICAgICogICAgICAg
SG93ZXZlciBpZiB0aGUgcGFnZXMgYXJlIG1hcHBlZCB0aGVuIHRoZSBmb3JtZXIgd2lsbCBzZXQK
KyAgICAgICAgICogICAgICAgdGhlIHBhZ2VfaW5mbyBwb2ludGVyIHRvIE5VTEwsIG1lYW5pbmcg
dGhlIGxhdHRlciB3aWxsIGRvCisgICAgICAgICAqICAgICAgIG5vdGhpbmcuCisgICAgICAgICAq
LworICAgICAgICBodm1faW9yZXFfc2VydmVyX3VubWFwX3BhZ2VzKHMpOworICAgICAgICBodm1f
aW9yZXFfc2VydmVyX2ZyZWVfcGFnZXMocyk7CisKKyAgICAgICAgcHV0X2RvbWFpbihzLT5lbXVs
YXRvcik7CisgICAgfQogfQogCiBpbnQgaHZtX2NyZWF0ZV9pb3JlcV9zZXJ2ZXIoc3RydWN0IGRv
bWFpbiAqZCwgaW50IGJ1ZmlvcmVxX2hhbmRsaW5nLAotICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGlvc2VydmlkX3QgKmlkKQorICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlvc2Vydmlk
X3QgKmlkLCBib29sIGludGVybmFsKQogewogICAgIHN0cnVjdCBodm1faW9yZXFfc2VydmVyICpz
OwogICAgIHVuc2lnbmVkIGludCBpOwpAQCAtODExLDcgKzgzOSw5IEBAIGludCBodm1fY3JlYXRl
X2lvcmVxX3NlcnZlcihzdHJ1Y3QgZG9tYWluICpkLCBpbnQgYnVmaW9yZXFfaGFuZGxpbmcsCiAg
ICAgZG9tYWluX3BhdXNlKGQpOwogICAgIHNwaW5fbG9ja19yZWN1cnNpdmUoJmQtPmFyY2guaHZt
LmlvcmVxX3NlcnZlci5sb2NrKTsKIAotICAgIGZvciAoIGkgPSAwOyBpIDwgTUFYX05SX0lPUkVR
X1NFUlZFUlM7IGkrKyApCisgICAgZm9yICggaSA9IChpbnRlcm5hbCA/IE1BWF9OUl9FWFRFUk5B
TF9JT1JFUV9TRVJWRVJTIDogMCk7CisgICAgICAgICAgaSA8IChpbnRlcm5hbCA/IE1BWF9OUl9J
T1JFUV9TRVJWRVJTIDogTUFYX05SX0VYVEVSTkFMX0lPUkVRX1NFUlZFUlMpOworICAgICAgICAg
IGkrKyApCiAgICAgewogICAgICAgICBpZiAoICFHRVRfSU9SRVFfU0VSVkVSKGQsIGkpICkKICAg
ICAgICAgICAgIGJyZWFrOwpAQCAtODIxLDYgKzg1MSw5IEBAIGludCBodm1fY3JlYXRlX2lvcmVx
X3NlcnZlcihzdHJ1Y3QgZG9tYWluICpkLCBpbnQgYnVmaW9yZXFfaGFuZGxpbmcsCiAgICAgaWYg
KCBpID49IE1BWF9OUl9JT1JFUV9TRVJWRVJTICkKICAgICAgICAgZ290byBmYWlsOwogCisgICAg
QVNTRVJUKChpbnRlcm5hbCAmJgorICAgICAgICAgICAgaSA+PSBNQVhfTlJfRVhURVJOQUxfSU9S
RVFfU0VSVkVSUyAmJiBpIDwgTUFYX05SX0lPUkVRX1NFUlZFUlMpIHx8CisgICAgICAgICAgICgh
aW50ZXJuYWwgJiYgaSA8IE1BWF9OUl9FWFRFUk5BTF9JT1JFUV9TRVJWRVJTKSk7CiAgICAgLyoK
ICAgICAgKiBJdCBpcyBzYWZlIHRvIGNhbGwgc2V0X2lvcmVxX3NlcnZlcigpIHByaW9yIHRvCiAg
ICAgICogaHZtX2lvcmVxX3NlcnZlcl9pbml0KCkgc2luY2UgdGhlIHRhcmdldCBkb21haW4gaXMg
cGF1c2VkLgpAQCAtODY0LDIwICs4OTcsMjEgQEAgaW50IGh2bV9kZXN0cm95X2lvcmVxX3NlcnZl
cihzdHJ1Y3QgZG9tYWluICpkLCBpb3NlcnZpZF90IGlkKQogICAgICAgICBnb3RvIG91dDsKIAog
ICAgIHJjID0gLUVQRVJNOwotICAgIGlmICggcy0+ZW11bGF0b3IgIT0gY3VycmVudC0+ZG9tYWlu
ICkKKyAgICAvKiBOQjogaW50ZXJuYWwgc2VydmVycyBjYW5ub3QgYmUgZGVzdHJveWVkLiAqLwor
ICAgIGlmICggaHZtX2lvcmVxX2lzX2ludGVybmFsKGlkKSB8fCBzLT5lbXVsYXRvciAhPSBjdXJy
ZW50LT5kb21haW4gKQogICAgICAgICBnb3RvIG91dDsKIAogICAgIGRvbWFpbl9wYXVzZShkKTsK
IAogICAgIHAybV9zZXRfaW9yZXFfc2VydmVyKGQsIDAsIGlkKTsKIAotICAgIGh2bV9pb3JlcV9z
ZXJ2ZXJfZGlzYWJsZShzKTsKKyAgICBodm1faW9yZXFfc2VydmVyX2Rpc2FibGUocywgaHZtX2lv
cmVxX2lzX2ludGVybmFsKGlkKSk7CiAKICAgICAvKgogICAgICAqIEl0IGlzIHNhZmUgdG8gY2Fs
bCBodm1faW9yZXFfc2VydmVyX2RlaW5pdCgpIHByaW9yIHRvCiAgICAgICogc2V0X2lvcmVxX3Nl
cnZlcigpIHNpbmNlIHRoZSB0YXJnZXQgZG9tYWluIGlzIHBhdXNlZC4KICAgICAgKi8KLSAgICBo
dm1faW9yZXFfc2VydmVyX2RlaW5pdChzKTsKKyAgICBodm1faW9yZXFfc2VydmVyX2RlaW5pdChz
LCBodm1faW9yZXFfaXNfaW50ZXJuYWwoaWQpKTsKICAgICBzZXRfaW9yZXFfc2VydmVyKGQsIGlk
LCBOVUxMKTsKIAogICAgIGRvbWFpbl91bnBhdXNlKGQpOwpAQCAtOTA5LDcgKzk0Myw4IEBAIGlu
dCBodm1fZ2V0X2lvcmVxX3NlcnZlcl9pbmZvKHN0cnVjdCBkb21haW4gKmQsIGlvc2VydmlkX3Qg
aWQsCiAgICAgICAgIGdvdG8gb3V0OwogCiAgICAgcmMgPSAtRVBFUk07Ci0gICAgaWYgKCBzLT5l
bXVsYXRvciAhPSBjdXJyZW50LT5kb21haW4gKQorICAgIC8qIE5COiBkb24ndCBhbGxvdyBmZXRj
aGluZyBpbmZvcm1hdGlvbiBmcm9tIGludGVybmFsIGlvcmVxIHNlcnZlcnMuICovCisgICAgaWYg
KCBodm1faW9yZXFfaXNfaW50ZXJuYWwoaWQpIHx8IHMtPmVtdWxhdG9yICE9IGN1cnJlbnQtPmRv
bWFpbiApCiAgICAgICAgIGdvdG8gb3V0OwogCiAgICAgaWYgKCBpb3JlcV9nZm4gfHwgYnVmaW9y
ZXFfZ2ZuICkKQEAgLTk1Niw3ICs5OTEsNyBAQCBpbnQgaHZtX2dldF9pb3JlcV9zZXJ2ZXJfZnJh
bWUoc3RydWN0IGRvbWFpbiAqZCwgaW9zZXJ2aWRfdCBpZCwKICAgICAgICAgZ290byBvdXQ7CiAK
ICAgICByYyA9IC1FUEVSTTsKLSAgICBpZiAoIHMtPmVtdWxhdG9yICE9IGN1cnJlbnQtPmRvbWFp
biApCisgICAgaWYgKCBodm1faW9yZXFfaXNfaW50ZXJuYWwoaWQpIHx8IHMtPmVtdWxhdG9yICE9
IGN1cnJlbnQtPmRvbWFpbiApCiAgICAgICAgIGdvdG8gb3V0OwogCiAgICAgcmMgPSBodm1faW9y
ZXFfc2VydmVyX2FsbG9jX3BhZ2VzKHMpOwpAQCAtMTAxMCw3ICsxMDQ1LDcgQEAgaW50IGh2bV9t
YXBfaW9fcmFuZ2VfdG9faW9yZXFfc2VydmVyKHN0cnVjdCBkb21haW4gKmQsIGlvc2VydmlkX3Qg
aWQsCiAgICAgICAgIGdvdG8gb3V0OwogCiAgICAgcmMgPSAtRVBFUk07Ci0gICAgaWYgKCBzLT5l
bXVsYXRvciAhPSBjdXJyZW50LT5kb21haW4gKQorICAgIGlmICggIWh2bV9pb3JlcV9pc19pbnRl
cm5hbChpZCkgJiYgcy0+ZW11bGF0b3IgIT0gY3VycmVudC0+ZG9tYWluICkKICAgICAgICAgZ290
byBvdXQ7CiAKICAgICBzd2l0Y2ggKCB0eXBlICkKQEAgLTEwNjgsNyArMTEwMyw3IEBAIGludCBo
dm1fdW5tYXBfaW9fcmFuZ2VfZnJvbV9pb3JlcV9zZXJ2ZXIoc3RydWN0IGRvbWFpbiAqZCwgaW9z
ZXJ2aWRfdCBpZCwKICAgICAgICAgZ290byBvdXQ7CiAKICAgICByYyA9IC1FUEVSTTsKLSAgICBp
ZiAoIHMtPmVtdWxhdG9yICE9IGN1cnJlbnQtPmRvbWFpbiApCisgICAgaWYgKCAhaHZtX2lvcmVx
X2lzX2ludGVybmFsKGlkKSAmJiBzLT5lbXVsYXRvciAhPSBjdXJyZW50LT5kb21haW4gKQogICAg
ICAgICBnb3RvIG91dDsKIAogICAgIHN3aXRjaCAoIHR5cGUgKQpAQCAtMTEyOCw2ICsxMTYzLDE0
IEBAIGludCBodm1fbWFwX21lbV90eXBlX3RvX2lvcmVxX3NlcnZlcihzdHJ1Y3QgZG9tYWluICpk
LCBpb3NlcnZpZF90IGlkLAogICAgIGlmICggIXMgKQogICAgICAgICBnb3RvIG91dDsKIAorICAg
IC8qCisgICAgICogTkI6IGRvIG5vdCBzdXBwb3J0IG1hcHBpbmcgaW50ZXJuYWwgaW9yZXEgc2Vy
dmVycyB0byBtZW1vcnkgdHlwZXMsIGFzCisgICAgICogdGhlIGN1cnJlbnQgaW50ZXJuYWwgaW9y
ZXEgc2VydmVycyBkb24ndCBuZWVkIHRoaXMgZmVhdHVyZSBhbmQgaXQncyBub3QKKyAgICAgKiBi
ZWVuIHRlc3RlZC4KKyAgICAgKi8KKyAgICByYyA9IC1FSU5WQUw7CisgICAgaWYgKCBodm1faW9y
ZXFfaXNfaW50ZXJuYWwoaWQpICkKKyAgICAgICAgZ290byBvdXQ7CiAgICAgcmMgPSAtRVBFUk07
CiAgICAgaWYgKCBzLT5lbXVsYXRvciAhPSBjdXJyZW50LT5kb21haW4gKQogICAgICAgICBnb3Rv
IG91dDsKQEAgLTExNjMsMTUgKzEyMDYsMTUgQEAgaW50IGh2bV9zZXRfaW9yZXFfc2VydmVyX3N0
YXRlKHN0cnVjdCBkb21haW4gKmQsIGlvc2VydmlkX3QgaWQsCiAgICAgICAgIGdvdG8gb3V0Owog
CiAgICAgcmMgPSAtRVBFUk07Ci0gICAgaWYgKCBzLT5lbXVsYXRvciAhPSBjdXJyZW50LT5kb21h
aW4gKQorICAgIGlmICggIWh2bV9pb3JlcV9pc19pbnRlcm5hbChpZCkgJiYgcy0+ZW11bGF0b3Ig
IT0gY3VycmVudC0+ZG9tYWluICkKICAgICAgICAgZ290byBvdXQ7CiAKICAgICBkb21haW5fcGF1
c2UoZCk7CiAKICAgICBpZiAoIGVuYWJsZWQgKQotICAgICAgICBodm1faW9yZXFfc2VydmVyX2Vu
YWJsZShzKTsKKyAgICAgICAgaHZtX2lvcmVxX3NlcnZlcl9lbmFibGUocywgaHZtX2lvcmVxX2lz
X2ludGVybmFsKGlkKSk7CiAgICAgZWxzZQotICAgICAgICBodm1faW9yZXFfc2VydmVyX2Rpc2Fi
bGUocyk7CisgICAgICAgIGh2bV9pb3JlcV9zZXJ2ZXJfZGlzYWJsZShzLCBodm1faW9yZXFfaXNf
aW50ZXJuYWwoaWQpKTsKIAogICAgIGRvbWFpbl91bnBhdXNlKGQpOwogCkBAIC0xMTkwLDcgKzEy
MzMsNyBAQCBpbnQgaHZtX2FsbF9pb3JlcV9zZXJ2ZXJzX2FkZF92Y3B1KHN0cnVjdCBkb21haW4g
KmQsIHN0cnVjdCB2Y3B1ICp2KQogCiAgICAgc3Bpbl9sb2NrX3JlY3Vyc2l2ZSgmZC0+YXJjaC5o
dm0uaW9yZXFfc2VydmVyLmxvY2spOwogCi0gICAgRk9SX0VBQ0hfSU9SRVFfU0VSVkVSKGQsIGlk
LCBzKQorICAgIEZPUl9FQUNIX0VYVEVSTkFMX0lPUkVRX1NFUlZFUihkLCBpZCwgcykKICAgICB7
CiAgICAgICAgIHJjID0gaHZtX2lvcmVxX3NlcnZlcl9hZGRfdmNwdShzLCB2KTsKICAgICAgICAg
aWYgKCByYyApCkBAIC0xMjAyLDcgKzEyNDUsNyBAQCBpbnQgaHZtX2FsbF9pb3JlcV9zZXJ2ZXJz
X2FkZF92Y3B1KHN0cnVjdCBkb21haW4gKmQsIHN0cnVjdCB2Y3B1ICp2KQogICAgIHJldHVybiAw
OwogCiAgZmFpbDoKLSAgICB3aGlsZSAoIGlkKysgIT0gTUFYX05SX0lPUkVRX1NFUlZFUlMgKQor
ICAgIHdoaWxlICggaWQrKyAhPSBNQVhfTlJfRVhURVJOQUxfSU9SRVFfU0VSVkVSUyApCiAgICAg
ewogICAgICAgICBzID0gR0VUX0lPUkVRX1NFUlZFUihkLCBpZCk7CiAKQEAgLTEyMjQsNyArMTI2
Nyw3IEBAIHZvaWQgaHZtX2FsbF9pb3JlcV9zZXJ2ZXJzX3JlbW92ZV92Y3B1KHN0cnVjdCBkb21h
aW4gKmQsIHN0cnVjdCB2Y3B1ICp2KQogCiAgICAgc3Bpbl9sb2NrX3JlY3Vyc2l2ZSgmZC0+YXJj
aC5odm0uaW9yZXFfc2VydmVyLmxvY2spOwogCi0gICAgRk9SX0VBQ0hfSU9SRVFfU0VSVkVSKGQs
IGlkLCBzKQorICAgIEZPUl9FQUNIX0VYVEVSTkFMX0lPUkVRX1NFUlZFUihkLCBpZCwgcykKICAg
ICAgICAgaHZtX2lvcmVxX3NlcnZlcl9yZW1vdmVfdmNwdShzLCB2KTsKIAogICAgIHNwaW5fdW5s
b2NrX3JlY3Vyc2l2ZSgmZC0+YXJjaC5odm0uaW9yZXFfc2VydmVyLmxvY2spOwpAQCAtMTI0MSwx
MyArMTI4NCwxMyBAQCB2b2lkIGh2bV9kZXN0cm95X2FsbF9pb3JlcV9zZXJ2ZXJzKHN0cnVjdCBk
b21haW4gKmQpCiAKICAgICBGT1JfRUFDSF9JT1JFUV9TRVJWRVIoZCwgaWQsIHMpCiAgICAgewot
ICAgICAgICBodm1faW9yZXFfc2VydmVyX2Rpc2FibGUocyk7CisgICAgICAgIGh2bV9pb3JlcV9z
ZXJ2ZXJfZGlzYWJsZShzLCBodm1faW9yZXFfaXNfaW50ZXJuYWwoaWQpKTsKIAogICAgICAgICAv
KgogICAgICAgICAgKiBJdCBpcyBzYWZlIHRvIGNhbGwgaHZtX2lvcmVxX3NlcnZlcl9kZWluaXQo
KSBwcmlvciB0bwogICAgICAgICAgKiBzZXRfaW9yZXFfc2VydmVyKCkgc2luY2UgdGhlIHRhcmdl
dCBkb21haW4gaXMgYmVpbmcgZGVzdHJveWVkLgogICAgICAgICAgKi8KLSAgICAgICAgaHZtX2lv
cmVxX3NlcnZlcl9kZWluaXQocyk7CisgICAgICAgIGh2bV9pb3JlcV9zZXJ2ZXJfZGVpbml0KHMs
IGh2bV9pb3JlcV9pc19pbnRlcm5hbChpZCkpOwogICAgICAgICBzZXRfaW9yZXFfc2VydmVyKGQs
IGlkLCBOVUxMKTsKIAogICAgICAgICB4ZnJlZShzKTsKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRl
L2FzbS14ODYvaHZtL2RvbWFpbi5oIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9odm0vZG9tYWluLmgK
aW5kZXggOWZiZTgzZjQ1YS4uOWY5MjgzOGI2ZSAxMDA2NDQKLS0tIGEveGVuL2luY2x1ZGUvYXNt
LXg4Ni9odm0vZG9tYWluLmgKKysrIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9odm0vZG9tYWluLmgK
QEAgLTk3LDcgKzk3LDEwIEBAIHN0cnVjdCBodm1fcGlfb3BzIHsKICAgICB2b2lkICgqdmNwdV9i
bG9jaykoc3RydWN0IHZjcHUgKik7CiB9OwogCi0jZGVmaW5lIE1BWF9OUl9JT1JFUV9TRVJWRVJT
IDgKKyNkZWZpbmUgTUFYX05SX0VYVEVSTkFMX0lPUkVRX1NFUlZFUlMgOAorI2RlZmluZSBNQVhf
TlJfSU5URVJOQUxfSU9SRVFfU0VSVkVSUyAxCisjZGVmaW5lIE1BWF9OUl9JT1JFUV9TRVJWRVJT
IFwKKyAgICAoTUFYX05SX0VYVEVSTkFMX0lPUkVRX1NFUlZFUlMgKyBNQVhfTlJfSU5URVJOQUxf
SU9SRVFfU0VSVkVSUykKIAogc3RydWN0IGh2bV9kb21haW4gewogICAgIC8qIEd1ZXN0IHBhZ2Ug
cmFuZ2UgdXNlZCBmb3Igbm9uLWRlZmF1bHQgaW9yZXEgc2VydmVycyAqLwpkaWZmIC0tZ2l0IGEv
eGVuL2luY2x1ZGUvYXNtLXg4Ni9odm0vaW9yZXEuaCBiL3hlbi9pbmNsdWRlL2FzbS14ODYvaHZt
L2lvcmVxLmgKaW5kZXggNjU0OTFjNDhkMi4uYzM5MTdhYTc0ZCAxMDA2NDQKLS0tIGEveGVuL2lu
Y2x1ZGUvYXNtLXg4Ni9odm0vaW9yZXEuaAorKysgYi94ZW4vaW5jbHVkZS9hc20teDg2L2h2bS9p
b3JlcS5oCkBAIC0yNCw3ICsyNCw3IEBAIGJvb2wgaGFuZGxlX2h2bV9pb19jb21wbGV0aW9uKHN0
cnVjdCB2Y3B1ICp2KTsKIGJvb2wgaXNfaW9yZXFfc2VydmVyX3BhZ2Uoc3RydWN0IGRvbWFpbiAq
ZCwgY29uc3Qgc3RydWN0IHBhZ2VfaW5mbyAqcGFnZSk7CiAKIGludCBodm1fY3JlYXRlX2lvcmVx
X3NlcnZlcihzdHJ1Y3QgZG9tYWluICpkLCBpbnQgYnVmaW9yZXFfaGFuZGxpbmcsCi0gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgaW9zZXJ2aWRfdCAqaWQpOworICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGlvc2VydmlkX3QgKmlkLCBib29sIGludGVybmFsKTsKIGludCBodm1fZGVzdHJv
eV9pb3JlcV9zZXJ2ZXIoc3RydWN0IGRvbWFpbiAqZCwgaW9zZXJ2aWRfdCBpZCk7CiBpbnQgaHZt
X2dldF9pb3JlcV9zZXJ2ZXJfaW5mbyhzdHJ1Y3QgZG9tYWluICpkLCBpb3NlcnZpZF90IGlkLAog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgbG9uZyAqaW9yZXFfZ2ZuLApA
QCAtNTQsNiArNTQsMTIgQEAgdW5zaWduZWQgaW50IGh2bV9icm9hZGNhc3RfaW9yZXEoaW9yZXFf
dCAqcCwgYm9vbCBidWZmZXJlZCk7CiAKIHZvaWQgaHZtX2lvcmVxX2luaXQoc3RydWN0IGRvbWFp
biAqZCk7CiAKK3N0YXRpYyBpbmxpbmUgYm9vbCBodm1faW9yZXFfaXNfaW50ZXJuYWwodW5zaWdu
ZWQgaW50IGlkKQoreworICAgIEFTU0VSVChpZCA8IE1BWF9OUl9JT1JFUV9TRVJWRVJTKTsKKyAg
ICByZXR1cm4gaWQgPj0gTUFYX05SX0VYVEVSTkFMX0lPUkVRX1NFUlZFUlM7Cit9CisKICNlbmRp
ZiAvKiBfX0FTTV9YODZfSFZNX0lPUkVRX0hfXyAqLwogCiAvKgotLSAKMi4yMi4wCgoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxp
bmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5w
cm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

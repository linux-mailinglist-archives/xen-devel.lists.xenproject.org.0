Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 42116B2ABE
	for <lists+xen-devel@lfdr.de>; Sat, 14 Sep 2019 10:57:52 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i93pY-0001yA-55; Sat, 14 Sep 2019 08:54:56 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=rDpt=XJ=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1i93pV-0001uk-PD
 for xen-devel@lists.xenproject.org; Sat, 14 Sep 2019 08:54:53 +0000
X-Inumbo-ID: 0e37f867-d6cd-11e9-95c1-12813bfff9fa
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 0e37f867-d6cd-11e9-95c1-12813bfff9fa;
 Sat, 14 Sep 2019 08:53:02 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 1D3E4B667;
 Sat, 14 Sep 2019 08:53:00 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Sat, 14 Sep 2019 10:52:21 +0200
Message-Id: <20190914085251.18816-18-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190914085251.18816-1-jgross@suse.com>
References: <20190914085251.18816-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v3 17/47] xen/sched: make credit2 scheduler vcpu
 agnostic.
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Dario Faggioli <dfaggioli@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

U3dpdGNoIGNyZWRpdDIgc2NoZWR1bGVyIGNvbXBsZXRlbHkgZnJvbSB2Y3B1IHRvIHNjaGVkX3Vu
aXQgdXNhZ2UuCgpBcyB3ZSBhcmUgdG91Y2hpbmcgbG90cyBvZiBsaW5lcyByZW1vdmUgc29tZSB3
aGl0ZSBzcGFjZSBhdCB0aGUgZW5kIG9mCnRoZSBsaW5lLCB0b28uCgpTaWduZWQtb2ZmLWJ5OiBK
dWVyZ2VuIEdyb3NzIDxqZ3Jvc3NAc3VzZS5jb20+Ci0tLQogeGVuL2NvbW1vbi9zY2hlZF9jcmVk
aXQyLmMgfCA4MjAgKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
CiAxIGZpbGUgY2hhbmdlZCwgNDAzIGluc2VydGlvbnMoKyksIDQxNyBkZWxldGlvbnMoLSkKCmRp
ZmYgLS1naXQgYS94ZW4vY29tbW9uL3NjaGVkX2NyZWRpdDIuYyBiL3hlbi9jb21tb24vc2NoZWRf
Y3JlZGl0Mi5jCmluZGV4IGE2MDgzMjg5ZjYuLjBkMWJhOTdkYmMgMTAwNjQ0Ci0tLSBhL3hlbi9j
b21tb24vc2NoZWRfY3JlZGl0Mi5jCisrKyBiL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0Mi5jCkBA
IC00NSw3ICs0NSw3IEBACiAjZGVmaW5lIFRSQ19DU0NIRUQyX1NDSEVEX1RBU0tMRVQgICAgVFJD
X1NDSEVEX0NMQVNTX0VWVChDU0NIRUQyLCA4KQogI2RlZmluZSBUUkNfQ1NDSEVEMl9VUERBVEVf
TE9BRCAgICAgIFRSQ19TQ0hFRF9DTEFTU19FVlQoQ1NDSEVEMiwgOSkKICNkZWZpbmUgVFJDX0NT
Q0hFRDJfUlVOUV9BU1NJR04gICAgICBUUkNfU0NIRURfQ0xBU1NfRVZUKENTQ0hFRDIsIDEwKQot
I2RlZmluZSBUUkNfQ1NDSEVEMl9VUERBVEVfVkNQVV9MT0FEIFRSQ19TQ0hFRF9DTEFTU19FVlQo
Q1NDSEVEMiwgMTEpCisjZGVmaW5lIFRSQ19DU0NIRUQyX1VQREFURV9VTklUX0xPQUQgVFJDX1ND
SEVEX0NMQVNTX0VWVChDU0NIRUQyLCAxMSkKICNkZWZpbmUgVFJDX0NTQ0hFRDJfVVBEQVRFX1JV
TlFfTE9BRCBUUkNfU0NIRURfQ0xBU1NfRVZUKENTQ0hFRDIsIDEyKQogI2RlZmluZSBUUkNfQ1ND
SEVEMl9USUNLTEVfTkVXICAgICAgIFRSQ19TQ0hFRF9DTEFTU19FVlQoQ1NDSEVEMiwgMTMpCiAj
ZGVmaW5lIFRSQ19DU0NIRUQyX1JVTlFfTUFYX1dFSUdIVCAgVFJDX1NDSEVEX0NMQVNTX0VWVChD
U0NIRUQyLCAxNCkKQEAgLTc0LDEzICs3NCwxMyBAQAogICogRGVzaWduOgogICoKICAqIFZNcyAi
YnVybiIgY3JlZGl0cyBiYXNlZCBvbiB0aGVpciB3ZWlnaHQ7IGhpZ2hlciB3ZWlnaHQgbWVhbnMK
LSAqIGNyZWRpdHMgYnVybiBtb3JlIHNsb3dseS4gIFRoZSBoaWdoZXN0IHdlaWdodCB2Y3B1IGJ1
cm5zIGNyZWRpdHMgYXQKKyAqIGNyZWRpdHMgYnVybiBtb3JlIHNsb3dseS4gIFRoZSBoaWdoZXN0
IHdlaWdodCB1bml0IGJ1cm5zIGNyZWRpdHMgYXQKICAqIGEgcmF0ZSBvZiAxIGNyZWRpdCBwZXIg
bmFub3NlY29uZC4gIE90aGVycyBidXJuIHByb3BvcnRpb25hbGx5CiAgKiBtb3JlLgogICoKLSAq
IHZjcHVzIGFyZSBpbnNlcnRlZCBpbnRvIHRoZSBydW5xdWV1ZSBieSBjcmVkaXQgb3JkZXIuCisg
KiB1bml0cyBhcmUgaW5zZXJ0ZWQgaW50byB0aGUgcnVucXVldWUgYnkgY3JlZGl0IG9yZGVyLgog
ICoKLSAqIENyZWRpdHMgYXJlICJyZXNldCIgd2hlbiB0aGUgbmV4dCB2Y3B1IGluIHRoZSBydW5x
dWV1ZSBpcyBsZXNzIHRoYW4KKyAqIENyZWRpdHMgYXJlICJyZXNldCIgd2hlbiB0aGUgbmV4dCB1
bml0IGluIHRoZSBydW5xdWV1ZSBpcyBsZXNzIHRoYW4KICAqIG9yIGVxdWFsIHRvIHplcm8uICBB
dCB0aGF0IHBvaW50LCBldmVyeW9uZSdzIGNyZWRpdHMgYXJlICJjbGlwcGVkIgogICogdG8gYSBz
bWFsbCB2YWx1ZSwgYW5kIGEgZml4ZWQgY3JlZGl0IGlzIGFkZGVkIHRvIGV2ZXJ5b25lLgogICov
CkBAIC05NSwzMyArOTUsMzMgQEAKICAqICAgYmUgZ2l2ZW4gYSBjYXAgb2YgMjUlOyBhIGRvbWFp
biB0aGF0IG11c3Qgbm90IHVzZSBtb3JlIHRoYW4gMSsxLzIgb2YKICAqICAgcGh5c2ljYWwgQ1BV
IHRpbWUsIHdpbGwgYmUgZ2l2ZW4gYSBjYXAgb2YgMTUwJTsKICAqCi0gKiAtIGNhcHMgYXJlIHBl
ci1kb21haW4gKG5vdCBwZXItdkNQVSkuIElmIGEgZG9tYWluIGhhcyBvbmx5IDEgdkNQVSwgYW5k
Ci0gKiAgIGEgNDAlIGNhcCwgdGhhdCBvbmUgdkNQVSB3aWxsIHVzZSA0MCUgb2Ygb25lIHBDUFUu
IElmIGEgc29tYWluIGhhcyA0Ci0gKiAgIHZDUFVzLCBhbmQgYSAyMDAlIGNhcCwgdGhlIGVxdWl2
YWxlbnQgb2YgMTAwJSB0aW1lIG9uIDIgcENQVXMgd2lsbCBiZQotICogICBzcGxpdCBhbW9uZyB0
aGUgdiB2Q1BVcy4gSG93IG11Y2ggZWFjaCBvZiB0aGUgdkNQVXMgd2lsbCBhY3R1YWxseSBnZXQs
CisgKiAtIGNhcHMgYXJlIHBlci1kb21haW4gKG5vdCBwZXItdW5pdCkuIElmIGEgZG9tYWluIGhh
cyBvbmx5IDEgdW5pdCwgYW5kCisgKiAgIGEgNDAlIGNhcCwgdGhhdCBvbmUgdW5pdCB3aWxsIHVz
ZSA0MCUgb2Ygb25lIHBDUFUuIElmIGEgc29tYWluIGhhcyA0CisgKiAgIHVuaXRzLCBhbmQgYSAy
MDAlIGNhcCwgdGhlIGVxdWl2YWxlbnQgb2YgMTAwJSB0aW1lIG9uIDIgcENQVXMgd2lsbCBiZQor
ICogICBzcGxpdCBhbW9uZyB0aGUgdiB1bml0cy4gSG93IG11Y2ggZWFjaCBvZiB0aGUgdW5pdHMg
d2lsbCBhY3R1YWxseSBnZXQsCiAgKiAgIGR1cmluZyBhbnkgZ2l2ZW4gaW50ZXJ2YWwgb2YgdGlt
ZSwgaXMgdW5zcGVjaWZpZWQgKGFzIGl0IGRlcGVuZHMgb24KICAqICAgdmFyaW91cyBhc3BlY3Rz
OiB3b3JrbG9hZCwgc3lzdGVtIGxvYWQsIGV0Yy4pLiBGb3IgaW5zdGFuY2UsIGl0IGlzCi0gKiAg
IHBvc3NpYmxlIHRoYXQsIGR1cmluZyBhIGdpdmVuIHRpbWUgaW50ZXJ2YWwsIDIgdkNQVXMgdXNl
IDEwMCUgZWFjaCwKKyAqICAgcG9zc2libGUgdGhhdCwgZHVyaW5nIGEgZ2l2ZW4gdGltZSBpbnRl
cnZhbCwgMiB1bml0cyB1c2UgMTAwJSBlYWNoLAogICogICBhbmQgdGhlIG90aGVyIHR3byB1c2Ug
bm90aGluZzsgd2hpbGUgZHVyaW5nIGFub3RoZXIgdGltZSBpbnRlcnZhbCwKLSAqICAgdHdvIHZD
UFVzIHVzZSA4MCUsIG9uZSB1c2VzIDEwJSBhbmQgdGhlIG90aGVyIDMwJTsgb3IgdGhhdCBlYWNo
IHVzZQorICogICB0d28gdW5pdHMgdXNlIDgwJSwgb25lIHVzZXMgMTAlIGFuZCB0aGUgb3RoZXIg
MzAlOyBvciB0aGF0IGVhY2ggdXNlCiAgKiAgIDUwJSAoYW5kIHNvIG9uIGFuZCBzbyBmb3J0aCku
CiAgKgogICogRm9yIGltcGxlbWVudGluZyB0aGlzLCB3ZSB1c2UgdGhlIGZvbGxvd2luZyBhcHBy
b2FjaDoKICAqCiAgKiAtIGVhY2ggZG9tYWluIGlzIGdpdmVuIGEgJ2J1ZGdldCcsIGFuIGVhY2gg
ZG9tYWluIGhhcyBhIHRpbWVyLCB3aGljaAogICogICByZXBsZW5pc2hlcyB0aGUgZG9tYWluJ3Mg
YnVkZ2V0IHBlcmlvZGljYWxseS4gVGhlIGJ1ZGdldCBpcyB0aGUgYW1vdW50Ci0gKiAgIG9mIHRp
bWUgdGhlIHZDUFVzIG9mIHRoZSBkb21haW4gY2FuIHVzZSBldmVyeSAncGVyaW9kJzsKKyAqICAg
b2YgdGltZSB0aGUgdW5pdHMgb2YgdGhlIGRvbWFpbiBjYW4gdXNlIGV2ZXJ5ICdwZXJpb2QnOwog
ICoKICAqIC0gdGhlIHBlcmlvZCBpcyBDU0NIRUQyX0JER1RfUkVQTF9QRVJJT0QsIGFuZCBpcyB0
aGUgc2FtZSBmb3IgYWxsIGRvbWFpbnMKICAqICAgKGJ1dCBlYWNoIGRvbWFpbiBoYXMgaXRzIG93
biB0aW1lcjsgc28gdGhlIGFsbCBhcmUgcGVyaW9kaWMgYnkgdGhlIHNhbWUKICAqICAgcGVyaW9k
LCBidXQgcmVwbGVuaXNobWVudCBvZiB0aGUgYnVkZ2V0cyBvZiB0aGUgdmFyaW91cyBkb21haW5z
LCBhdAogICogICBwZXJpb2RzIGJvdW5kYXJpZXMsIGFyZSBub3Qgc3luY2hyb25vdXMpOwogICoK
LSAqIC0gd2hlbiB2Q1BVcyBydW4sIHRoZXkgY29uc3VtZSBidWRnZXQuIFdoZW4gdGhleSBkb24n
dCBydW4sIHRoZXkgZG9uJ3QKLSAqICAgY29uc3VtZSBidWRnZXQuIElmIHRoZXJlIGlzIG5vIGJ1
ZGdldCBsZWZ0IGZvciB0aGUgZG9tYWluLCBubyB2Q1BVIG9mCi0gKiAgIHRoYXQgZG9tYWluIGNh
biBydW4uIElmIGEgdkNQVSB0cmllcyB0byBydW4gYW5kIGZpbmRzIHRoYXQgdGhlcmUgaXMgbm8K
KyAqIC0gd2hlbiB1bml0cyBydW4sIHRoZXkgY29uc3VtZSBidWRnZXQuIFdoZW4gdGhleSBkb24n
dCBydW4sIHRoZXkgZG9uJ3QKKyAqICAgY29uc3VtZSBidWRnZXQuIElmIHRoZXJlIGlzIG5vIGJ1
ZGdldCBsZWZ0IGZvciB0aGUgZG9tYWluLCBubyB1bml0IG9mCisgKiAgIHRoYXQgZG9tYWluIGNh
biBydW4uIElmIGFuIHVuaXQgdHJpZXMgdG8gcnVuIGFuZCBmaW5kcyB0aGF0IHRoZXJlIGlzIG5v
CiAgKiAgIGJ1ZGdldCwgaXQgYmxvY2tzLgotICogICBBdCB3aGF0ZXZlciB0aW1lIGEgdkNQVSB3
YW50cyB0byBydW4sIGl0IG11c3QgY2hlY2sgdGhlIGRvbWFpbidzIGJ1ZGdldCwKKyAqICAgQXQg
d2hhdGV2ZXIgdGltZSBhbiB1bml0IHdhbnRzIHRvIHJ1biwgaXQgbXVzdCBjaGVjayB0aGUgZG9t
YWluJ3MgYnVkZ2V0LAogICogICBhbmQgaWYgdGhlcmUgaXMgc29tZSwgaXQgY2FuIHVzZSBpdC4K
ICAqCiAgKiAtIGJ1ZGdldCBpcyByZXBsZW5pc2hlZCB0byB0aGUgdG9wIG9mIHRoZSBjYXBhY2l0
eSBmb3IgdGhlIGRvbWFpbiBvbmNlCkBAIC0xMjksMzkgKzEyOSwzOSBAQAogICogICB0aG91Z2gs
IHRoZSBidWRnZXQgYWZ0ZXIgYSByZXBsZW5pc2htZW50IHdpbGwgYWx3YXlzIGJlIGF0IG1vc3Qg
ZXF1YWwKICAqICAgdG8gdGhlIHRvdGFsIGNhcGFjaWZ5IG9mIHRoZSBkb21haW4gKCd0b3RfYnVk
Z2V0Jyk7CiAgKgotICogLSB3aGVuIGEgYnVkZ2V0IHJlcGxlbmlzaG1lbnQgb2NjdXJzLCBpZiB0
aGVyZSBhcmUgdkNQVXMgdGhhdCBoYWQgYmVlbgorICogLSB3aGVuIGEgYnVkZ2V0IHJlcGxlbmlz
aG1lbnQgb2NjdXJzLCBpZiB0aGVyZSBhcmUgdW5pdHMgdGhhdCBoYWQgYmVlbgogICogICBibG9j
a2VkIGJlY2F1c2Ugb2YgbGFjayBvZiBidWRnZXQsIHRoZXknbGwgYmUgdW5ibG9ja2VkLCBhbmQg
dGhleSB3aWxsCiAgKiAgIChwb3RlbnRpYWxseSkgYmUgYWJsZSB0byBydW4gYWdhaW4uCiAgKgog
ICogRmluYWxseSwgc29tZSBldmVuIG1vcmUgaW1wbGVtZW50YXRpb24gcmVsYXRlZCBkZXRhaWw6
CiAgKgotICogLSBidWRnZXQgaXMgc3RvcmVkIGluIGEgZG9tYWluLXdpZGUgcG9vbC4gdkNQVXMg
b2YgdGhlIGRvbWFpbiB0aGF0IHdhbnQKKyAqIC0gYnVkZ2V0IGlzIHN0b3JlZCBpbiBhIGRvbWFp
bi13aWRlIHBvb2wuIEl0ZW1zIG9mIHRoZSBkb21haW4gdGhhdCB3YW50CiAgKiAgIHRvIHJ1biBn
byB0byBzdWNoIHBvb2wsIGFuZCBncnViIHNvbWUuIFdoZW4gdGhleSBkbyBzbywgdGhlIGFtb3Vu
dAogICogICB0aGV5IGdyYWJiZWQgaXMgX2ltbWVkaWF0ZWx5XyByZW1vdmVkIGZyb20gdGhlIHBv
b2wuIFRoaXMgaGFwcGVucyBpbgotICogICB2Y3B1X2dyYWJfYnVkZ2V0KCk7CisgKiAgIHVuaXRf
Z3JhYl9idWRnZXQoKTsKICAqCi0gKiAtIHdoZW4gdkNQVXMgc3RvcCBydW5uaW5nLCBpZiB0aGV5
J3ZlIG5vdCBjb25zdW1lZCBhbGwgdGhlIGJ1ZGdldCB0aGV5CisgKiAtIHdoZW4gdW5pdHMgc3Rv
cCBydW5uaW5nLCBpZiB0aGV5J3ZlIG5vdCBjb25zdW1lZCBhbGwgdGhlIGJ1ZGdldCB0aGV5CiAg
KiAgIHRvb2ssIHRoZSBsZWZ0b3ZlciBpcyBwdXQgYmFjayBpbiB0aGUgcG9vbC4gVGhpcyBoYXBw
ZW5zIGluCi0gKiAgIHZjcHVfcmV0dXJuX2J1ZGdldCgpOworICogICB1bml0X3JldHVybl9idWRn
ZXQoKTsKICAqCi0gKiAtIHRoZSBhYm92ZSBtZWFucyB0aGF0IGEgdkNQVSBjYW4gZmluZCBvdXQg
dGhhdCB0aGVyZSBpcyBubyBidWRnZXQgYW5kCisgKiAtIHRoZSBhYm92ZSBtZWFucyB0aGF0IGFu
IHVuaXQgY2FuIGZpbmQgb3V0IHRoYXQgdGhlcmUgaXMgbm8gYnVkZ2V0IGFuZAogICogICBibG9j
aywgbm90IG9ubHkgaWYgdGhlIGNhcCBoYXMgYWN0dWFsbHkgYmVlbiByZWFjaGVkIChmb3IgdGhp
cyBwZXJpb2QpLAotICogICBidXQgYWxzbyBpZiBzb21lIG90aGVyIHZDUFVzLCBpbiBvcmRlciB0
byBydW4sIGhhdmUgZ3JhYmJlZCBhIGNlcnRhaW4KKyAqICAgYnV0IGFsc28gaWYgc29tZSBvdGhl
ciB1bml0cywgaW4gb3JkZXIgdG8gcnVuLCBoYXZlIGdyYWJiZWQgYSBjZXJ0YWluCiAgKiAgIHF1
b3RhIG9mIGJ1ZGdldCwgbm8gbWF0dGVyIHdoZXRoZXIgdGhleSd2ZSBhbHJlYWR5IHVzZWQgaXQg
YWxsIG9yIG5vdC4KLSAqICAgQSB2Q1BVIGJsb2NraW5nIGJlY2F1c2UgKGFueSBmb3JtIG9mKSBs
YWNrIG9mIGJ1ZGdldCBpcyBzYWlkIHRvIGJlCi0gKiAgICJwYXJrZWQiLCBhbmQgc3VjaCBibG9j
a2luZyBoYXBwZW5zIGluIHBhcmtfdmNwdSgpOworICogICBBbiB1bml0IGJsb2NraW5nIGJlY2F1
c2UgKGFueSBmb3JtIG9mKSBsYWNrIG9mIGJ1ZGdldCBpcyBzYWlkIHRvIGJlCisgKiAgICJwYXJr
ZWQiLCBhbmQgc3VjaCBibG9ja2luZyBoYXBwZW5zIGluIHBhcmtfdW5pdCgpOwogICoKLSAqIC0g
d2hlbiBhIHZDUFUgc3RvcHMgcnVubmluZywgYW5kIHB1dHMgYmFjayBzb21lIGJ1ZGdldCBpbiB0
aGUgZG9tYWluIHBvb2wsCisgKiAtIHdoZW4gYW4gdW5pdCBzdG9wcyBydW5uaW5nLCBhbmQgcHV0
cyBiYWNrIHNvbWUgYnVkZ2V0IGluIHRoZSBkb21haW4gcG9vbCwKICAqICAgd2UgbmVlZCB0byBj
aGVjayB3aGV0aGVyIHRoZXJlIGlzIHNvbWVvbmUgd2hpY2ggaGFzIGJlZW4gcGFya2VkIGFuZCB0
aGF0Ci0gKiAgIGNhbiBiZSB1bnBhcmtlZC4gVGhpcyBoYXBwZW5zIGluIHVucGFya19wYXJrZWRf
dmNwdXMoKSwgY2FsbGVkIGZyb20KKyAqICAgY2FuIGJlIHVucGFya2VkLiBUaGlzIGhhcHBlbnMg
aW4gdW5wYXJrX3BhcmtlZF91bml0cygpLCBjYWxsZWQgZnJvbQogICogICBjc2NoZWQyX2NvbnRl
eHRfc2F2ZWQoKTsKICAqCiAgKiAtIG9mIGNvdXJzZSwgdW5wYXJraW5nIGhhcHBlbnMgYWxzbyBh
cyBhIGNvbnNlcXVlbmNlIG9mIHRoZSBkb21haW4ncyBidWRnZXQKICAqICAgYmVpbmcgcmVwbGVu
aXNoZWQgYnkgdGhlIHBlcmlvZGljIHRpbWVyLiBUaGlzIGFsc28gb2NjdXJzIGJ5IG1lYW5zIG9m
CiAgKiAgIGNhbGxpbmcgY3NjaGVkMl9jb250ZXh0X3NhdmVkKCkgKGJ1dCBmcm9tIHJlcGxlbmlz
aF9kb21haW5fYnVkZ2V0KCkpOwogICoKLSAqIC0gcGFya2VkIHZDUFVzIG9mIGEgZG9tYWluIGFy
ZSBrZXB0IGluIGEgKHBlci1kb21haW4pIGxpc3QsIGNhbGxlZAotICogICAncGFya2VkX3ZjcHVz
JykuIE1hbmlwdWxhdGlvbiBvZiB0aGUgbGlzdCBhbmQgb2YgdGhlIGRvbWFpbi13aWRlIGJ1ZGdl
dAorICogLSBwYXJrZWQgdW5pdHMgb2YgYSBkb21haW4gYXJlIGtlcHQgaW4gYSAocGVyLWRvbWFp
bikgbGlzdCwgY2FsbGVkCisgKiAgICdwYXJrZWRfdW5pdHMnKS4gTWFuaXB1bGF0aW9uIG9mIHRo
ZSBsaXN0IGFuZCBvZiB0aGUgZG9tYWluLXdpZGUgYnVkZ2V0CiAgKiAgIHBvb2wsIG11c3Qgb2Nj
dXIgb25seSB3aGVuIGhvbGRpbmcgdGhlICdidWRnZXRfbG9jaycuCiAgKi8KIApAQCAtMTc0LDkg
KzE3NCw5IEBACiAgKiAgICAgcGNwdV9zY2hlZHVsZV9sb2NrKCkgLyB1bml0X3NjaGVkdWxlX2xv
Y2soKSAoYW5kIGZyaWVuZHMpLAogICogICAqIGEgY3B1IG1heSAodHJ5IHRvKSB0YWtlIGEgInJl
bW90ZSIgcnVucXVldWUgbG9jaywgZS5nLiwgZm9yCiAgKiAgICAgbG9hZCBiYWxhbmNpbmc7Ci0g
KiAgKyBzZXJpYWxpemVzIHJ1bnF1ZXVlIG9wZXJhdGlvbnMgKHJlbW92aW5nIGFuZCBpbnNlcnRp
bmcgdmNwdXMpOworICogICsgc2VyaWFsaXplcyBydW5xdWV1ZSBvcGVyYXRpb25zIChyZW1vdmlu
ZyBhbmQgaW5zZXJ0aW5nIHVuaXRzKTsKICAqICArIHByb3RlY3RzIHJ1bnF1ZXVlLXdpZGUgZGF0
YSBpbiBjc2NoZWQyX3J1bnF1ZXVlX2RhdGE7Ci0gKiAgKyBwcm90ZWN0cyB2Y3B1IHBhcmFtZXRl
cnMgaW4gY3NjaGVkMl91bml0IGZvciB0aGUgdmNwdSBpbiB0aGUKKyAqICArIHByb3RlY3RzIHVu
aXQgcGFyYW1ldGVycyBpbiBjc2NoZWQyX3VuaXQgZm9yIHRoZSB1bml0IGluIHRoZQogICogICAg
cnVucXVldWUuCiAgKgogICogLSBQcml2YXRlIHNjaGVkdWxlciBsb2NrCkBAIC0xOTAsOCArMTkw
LDggQEAKICAqICArIGl0IGlzIHBlci1kb21haW47CiAgKiAgKyBwcm90ZWN0cywgaW4gZG9tYWlu
cyB0aGF0IGhhdmUgYW4gdXRpbGl6YXRpb24gY2FwOwogICogICAqIG1hbmlwdWxhdGlvbiBvZiB0
aGUgdG90YWwgYnVkZ2V0IG9mIHRoZSBkb21haW4gKGFzIGl0IGlzIHNoYXJlZAotICogICAgIGFt
b25nIGFsbCB2Q1BVcyBvZiB0aGUgZG9tYWluKSwKLSAqICAgKiBtYW5pcHVsYXRpb24gb2YgdGhl
IGxpc3Qgb2YgdkNQVXMgdGhhdCBhcmUgYmxvY2tlZCB3YWl0aW5nIGZvcgorICogICAgIGFtb25n
IGFsbCB1bml0cyBvZiB0aGUgZG9tYWluKSwKKyAqICAgKiBtYW5pcHVsYXRpb24gb2YgdGhlIGxp
c3Qgb2YgdW5pdHMgdGhhdCBhcmUgYmxvY2tlZCB3YWl0aW5nIGZvcgogICogICAgIHNvbWUgYnVk
Z2V0IHRvIGJlIGF2YWlsYWJsZS4KICAqCiAgKiAtIFR5cGU6CkBAIC0yMjgsOSArMjI4LDkgQEAK
ICAqLwogI2RlZmluZSBDU0NIRUQyX0NSRURJVF9JTklUICAgICAgICAgIE1JTExJU0VDUygxMCkK
IC8qCi0gKiBBbW91bnQgb2YgY3JlZGl0IHRoZSBpZGxlIHZjcHVzIGhhdmUuIEl0IG5ldmVyIGNo
YW5nZXMsIGFzIGlkbGUKLSAqIHZjcHVzIGRvZXMgbm90IGNvbnN1bWUgY3JlZGl0cywgYW5kIGl0
IG11c3QgYmUgbG93ZXIgdGhhbiB3aGF0ZXZlcgotICogYW1vdW50IG9mIGNyZWRpdCAncmVndWxh
cicgdmNwdSB3b3VsZCBlbmQgdXAgd2l0aC4KKyAqIEFtb3VudCBvZiBjcmVkaXQgdGhlIGlkbGUg
dW5pdHMgaGF2ZS4gSXQgbmV2ZXIgY2hhbmdlcywgYXMgaWRsZQorICogdW5pdHMgZG9lcyBub3Qg
Y29uc3VtZSBjcmVkaXRzLCBhbmQgaXQgbXVzdCBiZSBsb3dlciB0aGFuIHdoYXRldmVyCisgKiBh
bW91bnQgb2YgY3JlZGl0ICdyZWd1bGFyJyB1bml0IHdvdWxkIGVuZCB1cCB3aXRoLgogICovCiAj
ZGVmaW5lIENTQ0hFRDJfSURMRV9DUkVESVQgICAgICAgICAgKC0oMVU8PDMwKSkKIC8qCkBAIC0y
NDMsOSArMjQzLDkgQEAKICAqIE1JTl9USU1FUi4KICAqLwogI2RlZmluZSBDU0NIRUQyX01JR1JB
VEVfUkVTSVNUICAgICAgICgob3B0X21pZ3JhdGVfcmVzaXN0KSpNSUNST1NFQ1MoMSkpCi0vKiBI
b3cgbXVjaCB0byAiY29tcGVuc2F0ZSIgYSB2Y3B1IGZvciBMMiBtaWdyYXRpb24uICovCisvKiBI
b3cgbXVjaCB0byAiY29tcGVuc2F0ZSIgYW4gdW5pdCBmb3IgTDIgbWlncmF0aW9uLiAqLwogI2Rl
ZmluZSBDU0NIRUQyX01JR1JBVEVfQ09NUEVOU0FUSU9OIE1JQ1JPU0VDUyg1MCkKLS8qIEhvdyB0
b2xlcmFudCB3ZSBzaG91bGQgYmUgd2hlbiBwZWVraW5nIGF0IHJ1bnRpbWUgb2YgdmNwdXMgb24g
b3RoZXIgY3B1cyAqLworLyogSG93IHRvbGVyYW50IHdlIHNob3VsZCBiZSB3aGVuIHBlZWtpbmcg
YXQgcnVudGltZSBvZiB1bml0cyBvbiBvdGhlciBjcHVzICovCiAjZGVmaW5lIENTQ0hFRDJfUkFU
RUxJTUlUX1RJQ0tMRV9UT0xFUkFOQ0UgTUlDUk9TRUNTKDUwKQogLyogUmVzZXQ6IFZhbHVlIGJl
bG93IHdoaWNoIGNyZWRpdCB3aWxsIGJlIHJlc2V0LiAqLwogI2RlZmluZSBDU0NIRUQyX0NSRURJ
VF9SRVNFVCAgICAgICAgIDAKQEAgLTI1OCw3ICsyNTgsNyBAQAogICogRmxhZ3MKICAqLwogLyoK
LSAqIENTRkxBR19zY2hlZHVsZWQ6IElzIHRoaXMgdmNwdSBlaXRoZXIgcnVubmluZyBvbiwgb3Ig
Y29udGV4dC1zd2l0Y2hpbmcgb2ZmLAorICogQ1NGTEFHX3NjaGVkdWxlZDogSXMgdGhpcyB1bml0
IGVpdGhlciBydW5uaW5nIG9uLCBvciBjb250ZXh0LXN3aXRjaGluZyBvZmYsCiAgKiBhIHBoeXNp
Y2FsIGNwdT8KICAqICsgQWNjZXNzZWQgb25seSB3aXRoIHJ1bnF1ZXVlIGxvY2sgaGVsZAogICog
KyBTZXQgd2hlbiBjaG9zZW4gYXMgbmV4dCBpbiBjc2NoZWQyX3NjaGVkdWxlKCkuCkBAIC0yODAs
MjEgKzI4MCwyMSBAQAogI2RlZmluZSBfX0NTRkxBR19kZWxheWVkX3J1bnFfYWRkIDIKICNkZWZp
bmUgQ1NGTEFHX2RlbGF5ZWRfcnVucV9hZGQgKDFVPDxfX0NTRkxBR19kZWxheWVkX3J1bnFfYWRk
KQogLyoKLSAqIENTRkxBR19ydW5xX21pZ3JhdGVfcmVxdWVzdDogVGhpcyB2Y3B1IGlzIGJlaW5n
IG1pZ3JhdGVkIGFzIGEgcmVzdWx0IG9mIGEKKyAqIENTRkxBR19ydW5xX21pZ3JhdGVfcmVxdWVz
dDogVGhpcyB1bml0IGlzIGJlaW5nIG1pZ3JhdGVkIGFzIGEgcmVzdWx0IG9mIGEKICAqIGNyZWRp
dDItaW5pdGlhdGVkIHJ1bnEgbWlncmF0ZSByZXF1ZXN0OyBtaWdyYXRlIGl0IHRvIHRoZSBydW5x
dWV1ZSBpbmRpY2F0ZWQKLSAqIGluIHRoZSBzdmMgc3RydWN0LiAKKyAqIGluIHRoZSBzdmMgc3Ry
dWN0LgogICovCiAjZGVmaW5lIF9fQ1NGTEFHX3J1bnFfbWlncmF0ZV9yZXF1ZXN0IDMKICNkZWZp
bmUgQ1NGTEFHX3J1bnFfbWlncmF0ZV9yZXF1ZXN0ICgxVTw8X19DU0ZMQUdfcnVucV9taWdyYXRl
X3JlcXVlc3QpCiAvKgotICogQ1NGTEFHX3ZjcHVfeWllbGQ6IHRoaXMgdmNwdSB3YXMgcnVubmlu
ZywgYW5kIGhhcyBjYWxsZWQgdmNwdV95aWVsZCgpLiBUaGUKKyAqIENTRkxBR191bml0X3lpZWxk
OiB0aGlzIHVuaXQgd2FzIHJ1bm5pbmcsIGFuZCBoYXMgY2FsbGVkIHZjcHVfeWllbGQoKS4gVGhl
CiAgKiBzY2hlZHVsZXIgaXMgaW52b2tlZCB0byBzZWUgaWYgd2UgY2FuIGdpdmUgdGhlIGNwdSB0
byBzb21lb25lIGVsc2UsIGFuZAotICogZ2V0IGJhY2sgdG8gdGhlIHlpZWxkaW5nIHZjcHUgaW4g
YSB3aGlsZS4KKyAqIGdldCBiYWNrIHRvIHRoZSB5aWVsZGluZyB1bml0IGluIGEgd2hpbGUuCiAg
Ki8KLSNkZWZpbmUgX19DU0ZMQUdfdmNwdV95aWVsZCA0Ci0jZGVmaW5lIENTRkxBR192Y3B1X3lp
ZWxkICgxVTw8X19DU0ZMQUdfdmNwdV95aWVsZCkKKyNkZWZpbmUgX19DU0ZMQUdfdW5pdF95aWVs
ZCA0CisjZGVmaW5lIENTRkxBR191bml0X3lpZWxkICgxVTw8X19DU0ZMQUdfdW5pdF95aWVsZCkK
IC8qCi0gKiBDU0ZMQUdTX3Bpbm5lZDogdGhpcyB2Y3B1IGlzIGN1cnJlbnRseSAncGlubmVkJywg
aS5lLiwgaGFzIGl0cyBoYXJkCisgKiBDU0ZMQUdTX3Bpbm5lZDogdGhpcyB1bml0IGlzIGN1cnJl
bnRseSAncGlubmVkJywgaS5lLiwgaGFzIGl0cyBoYXJkCiAgKiBhZmZpbml0eSBzZXQgdG8gb25l
IGFuZCBvbmx5IDEgY3B1IChhbmQsIGhlbmNlLCBjYW4gb25seSBydW4gdGhlcmUpLgogICovCiAj
ZGVmaW5lIF9fQ1NGTEFHX3Bpbm5lZCA1CkBAIC0zMDYsNyArMzA2LDcgQEAgaW50ZWdlcl9wYXJh
bSgic2NoZWRfY3JlZGl0Ml9taWdyYXRlX3Jlc2lzdCIsIG9wdF9taWdyYXRlX3Jlc2lzdCk7CiAv
KgogICogTG9hZCB0cmFja2luZyBhbmQgbG9hZCBiYWxhbmNpbmcKICAqCi0gKiBMb2FkIGhpc3Rv
cnkgb2YgcnVucXVldWVzIGFuZCB2Y3B1cyBpcyBhY2NvdW50ZWQgZm9yIGJ5IHVzaW5nIGFuCisg
KiBMb2FkIGhpc3Rvcnkgb2YgcnVucXVldWVzIGFuZCB1bml0cyBpcyBhY2NvdW50ZWQgZm9yIGJ5
IHVzaW5nIGFuCiAgKiBleHBvbmVudGlhbCB3ZWlnaHRlZCBtb3ZpbmcgYXZlcmFnZSBhbGdvcml0
aG0uIEhvd2V2ZXIsIGluc3RlYWQgb2YgdXNpbmcKICAqIGZyYWN0aW9ucyx3ZSBzaGlmdCBldmVy
eXRoaW5nIHRvIGxlZnQgYnkgdGhlIG51bWJlciBvZiBiaXRzIHdlIHdhbnQgdG8KICAqIHVzZSBm
b3IgcmVwcmVzZW50aW5nIHRoZSBmcmFjdGlvbmFsIHBhcnQgKFEtZm9ybWF0KS4KQEAgLTMyNiw3
ICszMjYsNyBAQCBpbnRlZ2VyX3BhcmFtKCJzY2hlZF9jcmVkaXQyX21pZ3JhdGVfcmVzaXN0Iiwg
b3B0X21pZ3JhdGVfcmVzaXN0KTsKICAqCiAgKiB3aGVyZSBXIGlzIHRoZSBsZW5ndGggb2YgdGhl
IHdpbmRvdywgUCB0aGUgbXVsdGlwbGllciBmb3IgdHJhbnNpdGlvbmcgaW50bwogICogUS1mb3Jt
YXQgZml4ZWQgcG9pbnQgYXJpdGhtZXRpYyBhbmQgbG9hZCBpcyB0aGUgaW5zdGFudGFuZW91cyBs
b2FkIG9mIGEKLSAqIHJ1bnF1ZXVlLCB3aGljaCBiYXNpY2FsbHkgaXMgdGhlIG51bWJlciBvZiBy
dW5uYWJsZSB2Y3B1cyB0aGVyZSBhcmUgb24gdGhlCisgKiBydW5xdWV1ZSwgd2hpY2ggYmFzaWNh
bGx5IGlzIHRoZSBudW1iZXIgb2YgcnVubmFibGUgdW5pdHMgdGhlcmUgYXJlIG9uIHRoZQogICog
cnVucXVldWUgKGZvciB0aGUgbWVhbmluZyBvZiB0aGUgb3RoZXIgdGVybXMsIGxvb2sgYXQgdGhl
IGRvYyBjb21tZW50IHRvCiAgKiAgdXBkYXRlX3J1bnFfbG9hZCgpKS4KICAqCkBAIC0zMzgsNyAr
MzM4LDcgQEAgaW50ZWdlcl9wYXJhbSgic2NoZWRfY3JlZGl0Ml9taWdyYXRlX3Jlc2lzdCIsIG9w
dF9taWdyYXRlX3Jlc2lzdCk7CiAgKiBUaGUgbWF4aW11bSBwb3NzaWJsZSB2YWx1ZSBmb3IgdGhl
IGF2ZXJhZ2UgbG9hZCwgd2hpY2ggd2Ugd2FudCB0byBzdG9yZSBpbgogICogc190aW1lX3QgdHlw
ZSB2YXJpYWJsZXMgKGkuZS4sIHdlIGhhdmUgNjMgYml0cyBhdmFpbGFibGUpIGlzIGxvYWQqUC4g
VGhpcwogICogbWVhbnMgdGhhdCwgd2l0aCBQIDE4IGJpdHMgd2lkZSwgbG9hZCBjYW4gb2NjdXB5
IDQ1IGJpdHMuIFRoaXMgaW4gdHVybgotICogbWVhbnMgd2UgY2FuIGhhdmUgMl40NSB2Y3B1cyBp
biBlYWNoIHJ1bnF1ZXVlLCBiZWZvcmUgb3ZlcmZsb3cgb2NjdXJzIQorICogbWVhbnMgd2UgY2Fu
IGhhdmUgMl40NSB1bml0cyBpbiBlYWNoIHJ1bnF1ZXVlLCBiZWZvcmUgb3ZlcmZsb3cgb2NjdXJz
IQogICoKICAqIEhvd2V2ZXIsIGl0IGNhbiBoYXBwZW4gdGhhdCwgYXQgc3RlcCBqKzEsIGlmOgog
ICoKQEAgLTM1NCwxMyArMzU0LDEzIEBAIGludGVnZXJfcGFyYW0oInNjaGVkX2NyZWRpdDJfbWln
cmF0ZV9yZXNpc3QiLCBvcHRfbWlncmF0ZV9yZXNpc3QpOwogICoKICAqICAyXig2MyAtIDMwIC0g
MTgpID0gMl4xNSA9IDMyNzY4CiAgKgotICogU28gMzI3NjggaXMgdGhlIG1heGltdW0gbnVtYmVy
IG9mIHZjcHVzIHRoZSB3ZSBjYW4gaGF2ZSBpbiBhIHJ1bnF1ZXVlLAorICogU28gMzI3NjggaXMg
dGhlIG1heGltdW0gbnVtYmVyIG9mIHVuaXRzIHRoZSB3ZSBjYW4gaGF2ZSBpbiBhIHJ1bnF1ZXVl
LAogICogYXQgYW55IGdpdmVuIHRpbWUsIGFuZCBzdGlsbCBub3QgaGF2ZSBwcm9ibGVtcyB3aXRo
IHRoZSBsb2FkIHRyYWNraW5nCiAgKiBjYWxjdWxhdGlvbnMuLi4gYW5kIHRoaXMgaXMgbW9yZSB0
aGFuIGZpbmUuCiAgKgogICogQXMgYSBtYXR0ZXIgb2YgZmFjdCwgc2luY2Ugd2UgYXJlIHVzaW5n
IG1pY3Jvc2Vjb25kcyBncmFudWxhcml0eSwgd2UgaGF2ZQogICogVz0yXjIwLiBTbywgc3RpbGwg
d2l0aCAxOCBmcmFjdGlvbmFsIGJpdHMgYW5kIGEgMSBzZWNvbmQgbG9uZyB3aW5kb3csIHRoZXJl
Ci0gKiBtYXkgYmUgMl4yNSA9IDMzNTU0NDMyIHZjcHVzIGluIGEgcnVucSBiZWZvcmUgd2UgaGF2
ZSB0byBzdGFydCB0aGlua2luZworICogbWF5IGJlIDJeMjUgPSAzMzU1NDQzMiB1bml0cyBpbiBh
IHJ1bnEgYmVmb3JlIHdlIGhhdmUgdG8gc3RhcnQgdGhpbmtpbmcKICAqIGFib3V0IG92ZXJmbG93
LgogICovCiAKQEAgLTQ2OSw3ICs0NjksNyBAQCBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRh
IHsKICAgICB1bnNpZ25lZCBpbnQgbnJfY3B1czsgICAgICAvKiBIb3cgbWFueSBDUFVzIGFyZSBz
aGFyaW5nIHRoaXMgcnVucXVldWUgICAgKi8KICAgICBpbnQgaWQ7ICAgICAgICAgICAgICAgICAg
ICAvKiBJRCBvZiB0aGlzIHJ1bnF1ZXVlICgtMSBpZiBpbnZhbGlkKSAgICAgICAgKi8KIAotICAg
IGludCBsb2FkOyAgICAgICAgICAgICAgICAgIC8qIEluc3RhbnRhbmVvdXMgbG9hZCAobnVtIG9m
IG5vbi1pZGxlIHZjcHVzKSAqLworICAgIGludCBsb2FkOyAgICAgICAgICAgICAgICAgIC8qIElu
c3RhbnRhbmVvdXMgbG9hZCAobnVtIG9mIG5vbi1pZGxlIHVuaXRzKSAqLwogICAgIHNfdGltZV90
IGxvYWRfbGFzdF91cGRhdGU7IC8qIExhc3QgdGltZSBhdmVyYWdlIHdhcyB1cGRhdGVkICAgICAg
ICAgICAgICAqLwogICAgIHNfdGltZV90IGF2Z2xvYWQ7ICAgICAgICAgIC8qIERlY2F5aW5nIHF1
ZXVlIGxvYWQgICAgICAgICAgICAgICAgICAgICAgICAqLwogICAgIHNfdGltZV90IGJfYXZnbG9h
ZDsgICAgICAgIC8qIERlY2F5aW5nIHF1ZXVlIGxvYWQgbW9kaWZpZWQgYnkgYmFsYW5jaW5nICAq
LwpAQCAtNDc5LDggKzQ3OSw4IEBAIHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgewogICAg
ICAgICB0aWNrbGVkLCAgICAgICAgICAgICAgIC8qIEhhdmUgYmVlbiBhc2tlZCB0byBnbyB0aHJv
dWdoIHNjaGVkdWxlICAgICAqLwogICAgICAgICBpZGxlOyAgICAgICAgICAgICAgICAgIC8qIEN1
cnJlbnRseSBpZGxlIHBjcHVzICAgICAgICAgICAgICAgICAgICAgICAqLwogCi0gICAgc3RydWN0
IGxpc3RfaGVhZCBzdmM7ICAgICAgLyogTGlzdCBvZiBhbGwgdmNwdXMgYXNzaWduZWQgdG8gdGhl
IHJ1bnF1ZXVlICovCi0gICAgdW5zaWduZWQgaW50IG1heF93ZWlnaHQ7ICAgLyogTWF4IHdlaWdo
dCBvZiB0aGUgdmNwdXMgaW4gdGhpcyBydW5xdWV1ZSAgICovCisgICAgc3RydWN0IGxpc3RfaGVh
ZCBzdmM7ICAgICAgLyogTGlzdCBvZiBhbGwgdW5pdHMgYXNzaWduZWQgdG8gdGhlIHJ1bnF1ZXVl
ICovCisgICAgdW5zaWduZWQgaW50IG1heF93ZWlnaHQ7ICAgLyogTWF4IHdlaWdodCBvZiB0aGUg
dW5pdHMgaW4gdGhpcyBydW5xdWV1ZSAgICovCiAgICAgdW5zaWduZWQgaW50IHBpY2tfYmlhczsg
ICAgLyogTGFzdCBwaWNrZWQgcGNwdS4gU3RhcnQgZnJvbSBpdCBuZXh0IHRpbWUgICovCiB9Owog
CkBAIC01MTAsMjAgKzUxMCwyMCBAQCBzdHJ1Y3QgY3NjaGVkMl9wY3B1IHsKIH07CiAKIC8qCi0g
KiBWaXJ0dWFsIENQVQorICogU2NoZWR1bGUgSXRlbQogICovCiBzdHJ1Y3QgY3NjaGVkMl91bml0
IHsKICAgICBzdHJ1Y3QgY3NjaGVkMl9kb20gKnNkb207ICAgICAgICAgIC8qIFVwLXBvaW50ZXIg
dG8gZG9tYWluICAgICAgICAgICAgICAgICovCi0gICAgc3RydWN0IHZjcHUgKnZjcHU7ICAgICAg
ICAgICAgICAgICAvKiBVcC1wb2ludGVyLCB0byB2Y3B1ICAgICAgICAgICAgICAgICAqLworICAg
IHN0cnVjdCBzY2hlZF91bml0ICp1bml0OyAgICAgICAgICAgLyogVXAtcG9pbnRlciwgdG8gc2No
ZWR1bGUgdW5pdCAgICAgICAgKi8KICAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpy
cWQ7IC8qIFVwLXBvaW50ZXIgdG8gdGhlIHJ1bnF1ZXVlICAgICAgICAgICovCiAKICAgICBpbnQg
Y3JlZGl0OyAgICAgICAgICAgICAgICAgICAgICAgIC8qIEN1cnJlbnQgYW1vdW50IG9mIGNyZWRp
dCAgICAgICAgICAgICovCi0gICAgdW5zaWduZWQgaW50IHdlaWdodDsgICAgICAgICAgICAgICAv
KiBXZWlnaHQgb2YgdGhpcyB2Y3B1ICAgICAgICAgICAgICAgICAqLworICAgIHVuc2lnbmVkIGlu
dCB3ZWlnaHQ7ICAgICAgICAgICAgICAgLyogV2VpZ2h0IG9mIHRoaXMgdW5pdCAgICAgICAgICAg
ICAgICAgKi8KICAgICB1bnNpZ25lZCBpbnQgcmVzaWR1YWw7ICAgICAgICAgICAgIC8qIFJlbWlu
ZGVyIG9mIGRpdihtYXhfd2VpZ2h0L3dlaWdodCkgICovCiAgICAgdW5zaWduZWQgZmxhZ3M7ICAg
ICAgICAgICAgICAgICAgICAvKiBTdGF0dXMgZmxhZ3MgKDE2IGJpdHMgd291bGQgYmUgb2ssICAq
LwogICAgIHNfdGltZV90IGJ1ZGdldDsgICAgICAgICAgICAgICAgICAgLyogQ3VycmVudCBidWRn
ZXQgKGlmIGRvbWFpbnMgaGFzIGNhcCkgKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIC8qIGJ1dCBjbGVhcl9iaXQoKSBkb2VzIG5vdCBsaWtlIHRoYXQpICovCi0gICAg
c190aW1lX3QgYnVkZ2V0X3F1b3RhOyAgICAgICAgICAgICAvKiBCdWRnZXQgdG8gd2hpY2ggdkNQ
VSBpcyBlbnRpdGxlZCAgICAqLworICAgIHNfdGltZV90IGJ1ZGdldF9xdW90YTsgICAgICAgICAg
ICAgLyogQnVkZ2V0IHRvIHdoaWNoIHVuaXQgaXMgZW50aXRsZWQgICAgKi8KIAogICAgIHNfdGlt
ZV90IHN0YXJ0X3RpbWU7ICAgICAgICAgICAgICAgLyogVGltZSB3ZSB3ZXJlIHNjaGVkdWxlZCAo
Zm9yIGNyZWRpdCkgKi8KIApAQCAtNTMyLDcgKzUzMiw3IEBAIHN0cnVjdCBjc2NoZWQyX3VuaXQg
ewogICAgIHNfdGltZV90IGF2Z2xvYWQ7ICAgICAgICAgICAgICAgICAgLyogRGVjYXlpbmcgcXVl
dWUgbG9hZCAgICAgICAgICAgICAgICAgKi8KIAogICAgIHN0cnVjdCBsaXN0X2hlYWQgcnVucV9l
bGVtOyAgICAgICAgLyogT24gdGhlIHJ1bnF1ZXVlIChycWQtPnJ1bnEpICAgICAgICAgKi8KLSAg
ICBzdHJ1Y3QgbGlzdF9oZWFkIHBhcmtlZF9lbGVtOyAgICAgIC8qIE9uIHRoZSBwYXJrZWRfdmNw
dXMgbGlzdCAgICAgICAgICAgICovCisgICAgc3RydWN0IGxpc3RfaGVhZCBwYXJrZWRfZWxlbTsg
ICAgICAvKiBPbiB0aGUgcGFya2VkX3VuaXRzIGxpc3QgICAgICAgICAgICAqLwogICAgIHN0cnVj
dCBsaXN0X2hlYWQgcnFkX2VsZW07ICAgICAgICAgLyogT24gY3NjaGVkMl9ydW5xdWV1ZV9kYXRh
J3Mgc3ZjIGxpc3QgKi8KICAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICptaWdyYXRl
X3JxZDsgLyogUHJlLWRldGVybWluZWQgbWlnci4gdGFyZ2V0ICovCiAgICAgaW50IHRpY2tsZWRf
Y3B1OyAgICAgICAgICAgICAgICAgICAvKiBDcHUgdGhhdCB3aWxsIHBpY2sgdXMgKC0xIGlmIG5v
bmUpICAqLwpAQCAtNTUwLDEyICs1NTAsMTIgQEAgc3RydWN0IGNzY2hlZDJfZG9tIHsKIAogICAg
IHN0cnVjdCB0aW1lciByZXBsX3RpbWVyOyAgICAvKiBUaW1lciBmb3IgcGVyaW9kaWMgcmVwbGVu
aXNobWVudCBvZiBidWRnZXQgKi8KICAgICBzX3RpbWVfdCBuZXh0X3JlcGw7ICAgICAgICAgLyog
VGltZSBhdCB3aGljaCBuZXh0IHJlcGxlbmlzaG1lbnQgb2NjdXJzICAgICovCi0gICAgc3RydWN0
IGxpc3RfaGVhZCBwYXJrZWRfdmNwdXM7IC8qIExpc3Qgb2YgQ1BVcyB3YWl0aW5nIGZvciBidWRn
ZXQgICAgICAgICAqLworICAgIHN0cnVjdCBsaXN0X2hlYWQgcGFya2VkX3VuaXRzOyAvKiBMaXN0
IG9mIENQVXMgd2FpdGluZyBmb3IgYnVkZ2V0ICAgICAgICAgKi8KIAogICAgIHN0cnVjdCBsaXN0
X2hlYWQgc2RvbV9lbGVtOyAvKiBPbiBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEncyBzZG9tIGxpc3Qg
ICAgICAgKi8KICAgICB1aW50MTZfdCB3ZWlnaHQ7ICAgICAgICAgICAgLyogVXNlciBzcGVjaWZp
ZWQgd2VpZ2h0ICAgICAgICAgICAgICAgICAgICAgICovCiAgICAgdWludDE2X3QgY2FwOyAgICAg
ICAgICAgICAgIC8qIFVzZXIgc3BlY2lmaWVkIGNhcCAgICAgICAgICAgICAgICAgICAgICAgICAq
LwotICAgIHVpbnQxNl90IG5yX3ZjcHVzOyAgICAgICAgICAvKiBOdW1iZXIgb2YgdmNwdXMgb2Yg
dGhpcyBkb21haW4gICAgICAgICAgICAgKi8KKyAgICB1aW50MTZfdCBucl91bml0czsgICAgICAg
ICAgLyogTnVtYmVyIG9mIHVuaXRzIG9mIHRoaXMgZG9tYWluICAgICAgICAgICAgICovCiB9Owog
CiAvKgpAQCAtNTk0LDcgKzU5NCw3IEBAIHN0YXRpYyBpbmxpbmUgc3RydWN0IGNzY2hlZDJfcnVu
cXVldWVfZGF0YSAqYzJycWQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAgIHJldHVy
biAmY3NjaGVkMl9wcml2KG9wcyktPnJxZFtjMnIoY3B1KV07CiB9CiAKLS8qIERvZXMgdGhlIGRv
bWFpbiBvZiB0aGlzIHZDUFUgaGF2ZSBhIGNhcD8gKi8KKy8qIERvZXMgdGhlIGRvbWFpbiBvZiB0
aGlzIHVuaXQgaGF2ZSBhIGNhcD8gKi8KIHN0YXRpYyBpbmxpbmUgYm9vbCBoYXNfY2FwKGNvbnN0
IHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YykKIHsKICAgICByZXR1cm4gc3ZjLT5idWRnZXQgIT0g
U1RJTUVfTUFYOwpAQCAtNjEyLDI0ICs2MTIsMjQgQEAgc3RhdGljIGlubGluZSBib29sIGhhc19j
YXAoY29uc3Qgc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQogICogICAgc210X2lkbGUgbWFzay4K
ICAqCiAgKiBPbmNlIHdlIGhhdmUgc3VjaCBhIG1hc2ssIGl0IGlzIGVhc3kgdG8gaW1wbGVtZW50
IGEgcG9saWN5IHRoYXQsIGVpdGhlcjoKLSAqICAtIHVzZXMgZnVsbHkgaWRsZSBjb3JlcyBmaXJz
dDogaXQgaXMgZW5vdWdoIHRvIHRyeSB0byBzY2hlZHVsZSB0aGUgdmNwdXMKKyAqICAtIHVzZXMg
ZnVsbHkgaWRsZSBjb3JlcyBmaXJzdDogaXQgaXMgZW5vdWdoIHRvIHRyeSB0byBzY2hlZHVsZSB0
aGUgdW5pdHMKICAqICAgIG9uIHBjcHVzIGZyb20gc210X2lkbGUgbWFzayBmaXJzdC4gVGhpcyBp
cyB3aGF0IGhhcHBlbnMgaWYKICAqICAgIHNjaGVkX3NtdF9wb3dlcl9zYXZpbmdzIHdhcyBub3Qg
c2V0IGF0IGJvb3QgKGRlZmF1bHQpLCBhbmQgaXQgbWF4aW1pemVzCiAgKiAgICB0cnVlIHBhcmFs
bGVsaXNtLCBhbmQgaGVuY2UgcGVyZm9ybWFuY2U7Ci0gKiAgLSB1c2VzIGFscmVhZHkgYnVzeSBj
b3JlcyBmaXJzdDogaXQgaXMgZW5vdWdoIHRvIHRyeSB0byBzY2hlZHVsZSB0aGUgdmNwdXMKKyAq
ICAtIHVzZXMgYWxyZWFkeSBidXN5IGNvcmVzIGZpcnN0OiBpdCBpcyBlbm91Z2ggdG8gdHJ5IHRv
IHNjaGVkdWxlIHRoZSB1bml0cwogICogICAgb24gcGNwdXMgdGhhdCBhcmUgaWRsZSwgYnV0IGFy
ZSBub3QgaW4gc210X2lkbGUuIFRoaXMgaXMgd2hhdCBoYXBwZW5zIGlmCiAgKiAgICBzY2hlZF9z
bXRfcG93ZXJfc2F2aW5ncyBpcyBzZXQgYXQgYm9vdCwgYW5kIGl0IGFsbG93cyBhcyBtb3JlIGNv
cmVzIGFzCiAgKiAgICBwb3NzaWJsZSB0byBzdGF5IGluIGxvdyBwb3dlciBzdGF0ZXMsIG1pbmlt
aXppbmcgcG93ZXIgY29uc3VtcHRpb24uCiAgKgogICogVGhpcyBsb2dpYyBpcyBlbnRpcmVseSBp
bXBsZW1lbnRlZCBpbiBydW5xX3RpY2tsZSgpLCBhbmQgdGhhdCBpcyBlbm91Z2guCi0gKiBJbiBm
YWN0LCBpbiB0aGlzIHNjaGVkdWxlciwgcGxhY2VtZW50IG9mIGEgdmNwdSBvbiBvbmUgb2YgdGhl
IHBjcHVzIG9mIGEKKyAqIEluIGZhY3QsIGluIHRoaXMgc2NoZWR1bGVyLCBwbGFjZW1lbnQgb2Yg
YW4gdW5pdCBvbiBvbmUgb2YgdGhlIHBjcHVzIG9mIGEKICAqIHJ1bnEsIF9hbHdheXNfIGhhcHBl
bnMgYnkgbWVhbnMgb2YgdGlja2xpbmc6Ci0gKiAgLSB3aGVuIGEgdmNwdSB3YWtlcyB1cCwgaXQg
Y2FsbHMgY3NjaGVkMl91bml0X3dha2UoKSwgd2hpY2ggY2FsbHMKKyAqICAtIHdoZW4gYW4gdW5p
dCB3YWtlcyB1cCwgaXQgY2FsbHMgY3NjaGVkMl91bml0X3dha2UoKSwgd2hpY2ggY2FsbHMKICAq
ICAgIHJ1bnFfdGlja2xlKCk7CiAgKiAgLSB3aGVuIGEgbWlncmF0aW9uIGlzIGluaXRpYXRlZCBp
biBzY2hlZHVsZS5jLCB3ZSBjYWxsIGNzY2hlZDJfcmVzX3BpY2soKSwKICAqICAgIGNzY2hlZDJf
dW5pdF9taWdyYXRlKCkgKHdoaWNoIGNhbGxzIG1pZ3JhdGUoKSkgYW5kIGNzY2hlZDJfdW5pdF93
YWtlKCkuCiAgKiAgICBjc2NoZWQyX3Jlc19waWNrKCkgbG9va3MgZm9yIHRoZSBsZWFzdCBsb2Fk
ZWQgcnVucSBhbmQgcmV0dXJuIGp1c3QgYW55Ci0gKiAgICBvZiBpdHMgcHJvY2Vzc29ycy4gVGhl
biwgY3NjaGVkMl91bml0X21pZ3JhdGUoKSBqdXN0IG1vdmVzIHRoZSB2Y3B1IHRvCisgKiAgICBv
ZiBpdHMgcHJvY2Vzc29ycy4gVGhlbiwgY3NjaGVkMl91bml0X21pZ3JhdGUoKSBqdXN0IG1vdmVz
IHRoZSB1bml0IHRvCiAgKiAgICB0aGUgY2hvc2VuIHJ1bnEsIGFuZCBpdCBpcyBhZ2FpbiBydW5x
X3RpY2tsZSgpLCBjYWxsZWQgYnkKICAqICAgIGNzY2hlZDJfdW5pdF93YWtlKCkgdGhhdCBhY3R1
YWxseSBkZWNpZGVzIHdoYXQgcGNwdSB0byB1c2Ugd2l0aGluIHRoZQogICogICAgY2hvc2VuIHJ1
bnE7CkBAIC02NDQsNyArNjQ0LDcgQEAgc3RhdGljIGlubGluZSBib29sIGhhc19jYXAoY29uc3Qg
c3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQogICoKICAqIE5CIHRoYXQgcnFkLT5zbXRfaWRsZSBp
cyBkaWZmZXJlbnQgdGhhbiBycWQtPmlkbGUuICBycWQtPmlkbGUKICAqIHJlY29yZHMgcGNwdXMg
dGhhdCBhdCBhcmUgbWVyZWx5IGlkbGUgKGkuZS4sIGF0IHRoZSBtb21lbnQgZG8gbm90Ci0gKiBo
YXZlIGEgdmNwdSBydW5uaW5nIG9uIHRoZW0pLiAgQnV0IHlvdSBoYXZlIHRvIG1hbnVhbGx5IGZp
bHRlciBvdXQKKyAqIGhhdmUgYW4gdW5pdCBydW5uaW5nIG9uIHRoZW0pLiAgQnV0IHlvdSBoYXZl
IHRvIG1hbnVhbGx5IGZpbHRlciBvdXQKICAqIHdoaWNoIHBjcHVzIGhhdmUgYmVlbiB0aWNrbGVk
IGluIG9yZGVyIHRvIGZpbmQgY29yZXMgdGhhdCBhcmUgbm90CiAgKiBnb2luZyB0byBiZSBidXN5
IHNvb24uICBGaWx0ZXJpbmcgb3V0IHRpY2tsZWQgY3B1cyBwYWlyd2lzZSBpcyBhCiAgKiBsb3Qg
b2YgZXh0cmEgcGFpbjsgc28gZm9yIHJxZC0+c210X2lkbGUsIHdlIGV4cGxpY2l0bHkgbWFrZSBz
byB0aGF0CkBAIC02OTEsMjQgKzY5MSwyNCBAQCB2b2lkIHNtdF9pZGxlX21hc2tfY2xlYXIodW5z
aWduZWQgaW50IGNwdSwgY3B1bWFza190ICptYXNrKQogICovCiBzdGF0aWMgaW50IGdldF9mYWxs
YmFja19jcHUoc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQogewotICAgIHN0cnVjdCB2Y3B1ICp2
ID0gc3ZjLT52Y3B1OworICAgIHN0cnVjdCBzY2hlZF91bml0ICp1bml0ID0gc3ZjLT51bml0Owog
ICAgIHVuc2lnbmVkIGludCBiczsKIAogICAgIFNDSEVEX1NUQVRfQ1JBTksobmVlZF9mYWxsYmFj
a19jcHUpOwogCiAgICAgZm9yX2VhY2hfYWZmaW5pdHlfYmFsYW5jZV9zdGVwKCBicyApCiAgICAg
ewotICAgICAgICBpbnQgY3B1ID0gdi0+cHJvY2Vzc29yOworICAgICAgICBpbnQgY3B1ID0gc2No
ZWRfdW5pdF9jcHUodW5pdCk7CiAKLSAgICAgICAgaWYgKCBicyA9PSBCQUxBTkNFX1NPRlRfQUZG
SU5JVFkgJiYgIWhhc19zb2Z0X2FmZmluaXR5KHYtPnNjaGVkX3VuaXQpICkKKyAgICAgICAgaWYg
KCBicyA9PSBCQUxBTkNFX1NPRlRfQUZGSU5JVFkgJiYgIWhhc19zb2Z0X2FmZmluaXR5KHVuaXQp
ICkKICAgICAgICAgICAgIGNvbnRpbnVlOwogCi0gICAgICAgIGFmZmluaXR5X2JhbGFuY2VfY3B1
bWFzayh2LT5zY2hlZF91bml0LCBicywgY3B1bWFza19zY3JhdGNoX2NwdShjcHUpKTsKKyAgICAg
ICAgYWZmaW5pdHlfYmFsYW5jZV9jcHVtYXNrKHVuaXQsIGJzLCBjcHVtYXNrX3NjcmF0Y2hfY3B1
KGNwdSkpOwogICAgICAgICBjcHVtYXNrX2FuZChjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksIGNw
dW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwKLSAgICAgICAgICAgICAgICAgICAgY3B1cG9vbF9kb21h
aW5fY3B1bWFzayh2LT5kb21haW4pKTsKKyAgICAgICAgICAgICAgICAgICAgY3B1cG9vbF9kb21h
aW5fY3B1bWFzayh1bml0LT5kb21haW4pKTsKIAogICAgICAgICAvKgotICAgICAgICAgKiBUaGlz
IGlzIGNhc2VzIDEgb3IgMyAoZGVwZW5kaW5nIG9uIGJzKTogaWYgdi0+cHJvY2Vzc29yIGlzIChz
dGlsbCkKKyAgICAgICAgICogVGhpcyBpcyBjYXNlcyAxIG9yIDMgKGRlcGVuZGluZyBvbiBicyk6
IGlmIHByb2Nlc3NvciBpcyAoc3RpbGwpCiAgICAgICAgICAqIGluIG91ciBhZmZpbml0eSwgZ28g
Zm9yIGl0LCBmb3IgY2FjaGUgYmV0dGVybmVzcy4KICAgICAgICAgICovCiAgICAgICAgIGlmICgg
bGlrZWx5KGNwdW1hc2tfdGVzdF9jcHUoY3B1LCBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSkpKSAp
CkBAIC03MzAsNyArNzMwLDcgQEAgc3RhdGljIGludCBnZXRfZmFsbGJhY2tfY3B1KHN0cnVjdCBj
c2NoZWQyX3VuaXQgKnN2YykKICAgICAgICAgICogV2UgbWF5IHdlbGwgcGljayBhbnkgdmFsaWQg
cGNwdSBmcm9tIG91ciBzb2Z0LWFmZmluaXR5LCBvdXRzaWRlCiAgICAgICAgICAqIG9mIG91ciBj
dXJyZW50IHJ1bnF1ZXVlLCBidXQgd2UgZGVjaWRlIG5vdCB0by4gSW4gZmFjdCwgY2hhbmdpbmcK
ICAgICAgICAgICogcnVucXVldWUgaXMgc2xvdywgYWZmZWN0cyBsb2FkIGRpc3RyaWJ1dGlvbiwg
YW5kIGlzIGEgc291cmNlIG9mCi0gICAgICAgICAqIG92ZXJoZWFkIGZvciB0aGUgdmNwdXMgcnVu
bmluZyBvbiB0aGUgb3RoZXIgcnVucXVldWUgKHdlIG5lZWQgdGhlCisgICAgICAgICAqIG92ZXJo
ZWFkIGZvciB0aGUgdW5pdHMgcnVubmluZyBvbiB0aGUgb3RoZXIgcnVucXVldWUgKHdlIG5lZWQg
dGhlCiAgICAgICAgICAqIGxvY2spLiBTbywgYmV0dGVyIGRvIHRoYXQgYXMgYSBjb25zZXF1ZW5j
ZSBvZiBhIHdlbGwgaW5mb3JtZWQKICAgICAgICAgICogZGVjaXNpb24gKG9yIGlmIHdlIHJlYWxs
eSBkb24ndCBoYXZlIGFueSBvdGhlciBjaGFuY2UsIGFzIHdlIHdpbGwsCiAgICAgICAgICAqIGF0
IHN0ZXAgNSwgaWYgd2UgZ2V0IHRvIHRoZXJlKS4KQEAgLTc2Miw3ICs3NjIsNyBAQCBzdGF0aWMg
aW50IGdldF9mYWxsYmFja19jcHUoc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQogICAgICAqIFdl
IGNhbid0IGJlIGhlcmUuICBCdXQgaWYgdGhhdCBzb21laG93IGhhcHBlbiAoaW4gbm9uLWRlYnVn
IGJ1aWxkcyksCiAgICAgICogYXQgbGVhc3QgcmV0dXJuIHNvbWV0aGluZyB3aGljaCBib3RoIG9u
bGluZSBhbmQgaW4gb3VyIGhhcmQtYWZmaW5pdHkuCiAgICAgICovCi0gICAgcmV0dXJuIGNwdW1h
c2tfYW55KGNwdW1hc2tfc2NyYXRjaF9jcHUodi0+cHJvY2Vzc29yKSk7CisgICAgcmV0dXJuIGNw
dW1hc2tfYW55KGNwdW1hc2tfc2NyYXRjaF9jcHUoc2NoZWRfdW5pdF9jcHUodW5pdCkpKTsKIH0K
IAogLyoKQEAgLTc5MSw3ICs3OTEsNyBAQCBzdGF0aWMgc190aW1lX3QgYzJ0KHN0cnVjdCBjc2No
ZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCwgc190aW1lX3QgY3JlZGl0LCBzdHJ1Y3QgYwogICogUnVu
cXVldWUgcmVsYXRlZCBjb2RlLgogICovCiAKLXN0YXRpYyBpbmxpbmUgaW50IHZjcHVfb25fcnVu
cShzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMpCitzdGF0aWMgaW5saW5lIGludCB1bml0X29uX3J1
bnEoc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQogewogICAgIHJldHVybiAhbGlzdF9lbXB0eSgm
c3ZjLT5ydW5xX2VsZW0pOwogfQpAQCAtOTQ5LDE3ICs5NDksMTcgQEAgX3J1bnFfYXNzaWduKHN0
cnVjdCBjc2NoZWQyX3VuaXQgKnN2Yywgc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFk
KQogCiAgICAgdXBkYXRlX21heF93ZWlnaHQoc3ZjLT5ycWQsIHN2Yy0+d2VpZ2h0LCAwKTsKIAot
ICAgIC8qIEV4cGVjdGVkIG5ldyBsb2FkIGJhc2VkIG9uIGFkZGluZyB0aGlzIHZjcHUgKi8KKyAg
ICAvKiBFeHBlY3RlZCBuZXcgbG9hZCBiYXNlZCBvbiBhZGRpbmcgdGhpcyB1bml0ICovCiAgICAg
cnFkLT5iX2F2Z2xvYWQgKz0gc3ZjLT5hdmdsb2FkOwogCiAgICAgaWYgKCB1bmxpa2VseSh0Yl9p
bml0X2RvbmUpICkKICAgICB7CiAgICAgICAgIHN0cnVjdCB7Ci0gICAgICAgICAgICB1bnNpZ25l
ZCB2Y3B1OjE2LCBkb206MTY7CisgICAgICAgICAgICB1bnNpZ25lZCB1bml0OjE2LCBkb206MTY7
CiAgICAgICAgICAgICB1bnNpZ25lZCBycWk6MTY7CiAgICAgICAgIH0gZDsKLSAgICAgICAgZC5k
b20gPSBzdmMtPnZjcHUtPmRvbWFpbi0+ZG9tYWluX2lkOwotICAgICAgICBkLnZjcHUgPSBzdmMt
PnZjcHUtPnZjcHVfaWQ7CisgICAgICAgIGQuZG9tID0gc3ZjLT51bml0LT5kb21haW4tPmRvbWFp
bl9pZDsKKyAgICAgICAgZC51bml0ID0gc3ZjLT51bml0LT51bml0X2lkOwogICAgICAgICBkLnJx
aT1ycWQtPmlkOwogICAgICAgICBfX3RyYWNlX3ZhcihUUkNfQ1NDSEVEMl9SVU5RX0FTU0lHTiwg
MSwKICAgICAgICAgICAgICAgICAgICAgc2l6ZW9mKGQpLApAQCAtOTY5LDEzICs5NjksMTMgQEAg
X3J1bnFfYXNzaWduKHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2Yywgc3RydWN0IGNzY2hlZDJfcnVu
cXVldWVfZGF0YSAqcnFkKQogfQogCiBzdGF0aWMgdm9pZAotcnVucV9hc3NpZ24oY29uc3Qgc3Ry
dWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgdmNwdSAqdmMpCitydW5xX2Fzc2lnbihjb25zdCBz
dHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogewotICAgIHN0
cnVjdCBjc2NoZWQyX3VuaXQgKnN2YyA9IHZjLT5zY2hlZF91bml0LT5wcml2OworICAgIHN0cnVj
dCBjc2NoZWQyX3VuaXQgKnN2YyA9IHVuaXQtPnByaXY7CiAKICAgICBBU1NFUlQoc3ZjLT5ycWQg
PT0gTlVMTCk7CiAKLSAgICBfcnVucV9hc3NpZ24oc3ZjLCBjMnJxZChvcHMsIHZjLT5wcm9jZXNz
b3IpKTsKKyAgICBfcnVucV9hc3NpZ24oc3ZjLCBjMnJxZChvcHMsIHNjaGVkX3VuaXRfY3B1KHVu
aXQpKSk7CiB9CiAKIHN0YXRpYyB2b2lkCkBAIC05ODMsMjQgKzk4MywyNCBAQCBfcnVucV9kZWFz
c2lnbihzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMpCiB7CiAgICAgc3RydWN0IGNzY2hlZDJfcnVu
cXVldWVfZGF0YSAqcnFkID0gc3ZjLT5ycWQ7CiAKLSAgICBBU1NFUlQoIXZjcHVfb25fcnVucShz
dmMpKTsKKyAgICBBU1NFUlQoIXVuaXRfb25fcnVucShzdmMpKTsKICAgICBBU1NFUlQoIShzdmMt
PmZsYWdzICYgQ1NGTEFHX3NjaGVkdWxlZCkpOwogCiAgICAgbGlzdF9kZWxfaW5pdCgmc3ZjLT5y
cWRfZWxlbSk7CiAgICAgdXBkYXRlX21heF93ZWlnaHQocnFkLCAwLCBzdmMtPndlaWdodCk7CiAK
LSAgICAvKiBFeHBlY3RlZCBuZXcgbG9hZCBiYXNlZCBvbiByZW1vdmluZyB0aGlzIHZjcHUgKi8K
KyAgICAvKiBFeHBlY3RlZCBuZXcgbG9hZCBiYXNlZCBvbiByZW1vdmluZyB0aGlzIHVuaXQgKi8K
ICAgICBycWQtPmJfYXZnbG9hZCA9IG1heF90KHNfdGltZV90LCBycWQtPmJfYXZnbG9hZCAtIHN2
Yy0+YXZnbG9hZCwgMCk7CiAKICAgICBzdmMtPnJxZCA9IE5VTEw7CiB9CiAKIHN0YXRpYyB2b2lk
Ci1ydW5xX2RlYXNzaWduKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHZjcHUg
KnZjKQorcnVucV9kZWFzc2lnbihjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBz
Y2hlZF91bml0ICp1bml0KQogewotICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YyA9IHZjLT5z
Y2hlZF91bml0LT5wcml2OworICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YyA9IHVuaXQtPnBy
aXY7CiAKLSAgICBBU1NFUlQoc3ZjLT5ycWQgPT0gYzJycWQob3BzLCB2Yy0+cHJvY2Vzc29yKSk7
CisgICAgQVNTRVJUKHN2Yy0+cnFkID09IGMycnFkKG9wcywgc2NoZWRfdW5pdF9jcHUodW5pdCkp
KTsKIAogICAgIF9ydW5xX2RlYXNzaWduKHN2Yyk7CiB9CkBAIC0xMjAzLDE1ICsxMjAzLDE1IEBA
IHVwZGF0ZV9zdmNfbG9hZChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAgICAgICAgICAg
ICAgICAgc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjLCBpbnQgY2hhbmdlLCBzX3RpbWVfdCBub3cp
CiB7CiAgICAgc3RydWN0IGNzY2hlZDJfcHJpdmF0ZSAqcHJ2ID0gY3NjaGVkMl9wcml2KG9wcyk7
Ci0gICAgc190aW1lX3QgZGVsdGEsIHZjcHVfbG9hZDsKKyAgICBzX3RpbWVfdCBkZWx0YSwgdW5p
dF9sb2FkOwogICAgIHVuc2lnbmVkIGludCBQLCBXOwogCiAgICAgaWYgKCBjaGFuZ2UgPT0gLTEg
KQotICAgICAgICB2Y3B1X2xvYWQgPSAxOworICAgICAgICB1bml0X2xvYWQgPSAxOwogICAgIGVs
c2UgaWYgKCBjaGFuZ2UgPT0gMSApCi0gICAgICAgIHZjcHVfbG9hZCA9IDA7CisgICAgICAgIHVu
aXRfbG9hZCA9IDA7CiAgICAgZWxzZQotICAgICAgICB2Y3B1X2xvYWQgPSB2Y3B1X3J1bm5hYmxl
KHN2Yy0+dmNwdSk7CisgICAgICAgIHVuaXRfbG9hZCA9IHVuaXRfcnVubmFibGUoc3ZjLT51bml0
KTsKIAogICAgIFcgPSBwcnYtPmxvYWRfd2luZG93X3NoaWZ0OwogICAgIFAgPSBwcnYtPmxvYWRf
cHJlY2lzaW9uX3NoaWZ0OwpAQCAtMTIxOSw3ICsxMjE5LDcgQEAgdXBkYXRlX3N2Y19sb2FkKGNv
bnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKIAogICAgIGlmICggc3ZjLT5sb2FkX2xhc3RfdXBk
YXRlICsgKDFVTEwgPDwgVykgPCBub3cgKQogICAgIHsKLSAgICAgICAgc3ZjLT5hdmdsb2FkID0g
dmNwdV9sb2FkIDw8IFA7CisgICAgICAgIHN2Yy0+YXZnbG9hZCA9IHVuaXRfbG9hZCA8PCBQOwog
ICAgIH0KICAgICBlbHNlCiAgICAgewpAQCAtMTIzMiw3ICsxMjMyLDcgQEAgdXBkYXRlX3N2Y19s
b2FkKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKICAgICAgICAgfQogCiAgICAgICAgIHN2
Yy0+YXZnbG9hZCA9IHN2Yy0+YXZnbG9hZCArCi0gICAgICAgICAgICAgICAgICAgICAgICgoZGVs
dGEgKiAodmNwdV9sb2FkIDw8IFApKSA+PiBXKSAtCisgICAgICAgICAgICAgICAgICAgICAgICgo
ZGVsdGEgKiAodW5pdF9sb2FkIDw8IFApKSA+PiBXKSAtCiAgICAgICAgICAgICAgICAgICAgICAg
ICgoZGVsdGEgKiBzdmMtPmF2Z2xvYWQpID4+IFcpOwogICAgIH0KICAgICBzdmMtPmxvYWRfbGFz
dF91cGRhdGUgPSBub3c7CkBAIC0xMjQ0LDE0ICsxMjQ0LDE0IEBAIHVwZGF0ZV9zdmNfbG9hZChj
b25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAgICAgewogICAgICAgICBzdHJ1Y3QgewogICAg
ICAgICAgICAgdWludDY0X3Qgdl9hdmdsb2FkOwotICAgICAgICAgICAgdW5zaWduZWQgdmNwdTox
NiwgZG9tOjE2OworICAgICAgICAgICAgdW5zaWduZWQgdW5pdDoxNiwgZG9tOjE2OwogICAgICAg
ICAgICAgdW5zaWduZWQgc2hpZnQ7CiAgICAgICAgIH0gZDsKLSAgICAgICAgZC5kb20gPSBzdmMt
PnZjcHUtPmRvbWFpbi0+ZG9tYWluX2lkOwotICAgICAgICBkLnZjcHUgPSBzdmMtPnZjcHUtPnZj
cHVfaWQ7CisgICAgICAgIGQuZG9tID0gc3ZjLT51bml0LT5kb21haW4tPmRvbWFpbl9pZDsKKyAg
ICAgICAgZC51bml0ID0gc3ZjLT51bml0LT51bml0X2lkOwogICAgICAgICBkLnZfYXZnbG9hZCA9
IHN2Yy0+YXZnbG9hZDsKICAgICAgICAgZC5zaGlmdCA9IFA7Ci0gICAgICAgIF9fdHJhY2VfdmFy
KFRSQ19DU0NIRUQyX1VQREFURV9WQ1BVX0xPQUQsIDEsCisgICAgICAgIF9fdHJhY2VfdmFyKFRS
Q19DU0NIRUQyX1VQREFURV9VTklUX0xPQUQsIDEsCiAgICAgICAgICAgICAgICAgICAgIHNpemVv
ZihkKSwKICAgICAgICAgICAgICAgICAgICAgKHVuc2lnbmVkIGNoYXIgKikmZCk7CiAgICAgfQpA
QCAtMTI3MywxOCArMTI3MywxOCBAQCBzdGF0aWMgdm9pZAogcnVucV9pbnNlcnQoY29uc3Qgc3Ry
dWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMpCiB7CiAgICAgc3Ry
dWN0IGxpc3RfaGVhZCAqaXRlcjsKLSAgICB1bnNpZ25lZCBpbnQgY3B1ID0gc3ZjLT52Y3B1LT5w
cm9jZXNzb3I7CisgICAgdW5zaWduZWQgaW50IGNwdSA9IHNjaGVkX3VuaXRfY3B1KHN2Yy0+dW5p
dCk7CiAgICAgc3RydWN0IGxpc3RfaGVhZCAqIHJ1bnEgPSAmYzJycWQob3BzLCBjcHUpLT5ydW5x
OwogICAgIGludCBwb3MgPSAwOwogCiAgICAgQVNTRVJUKHNwaW5faXNfbG9ja2VkKGdldF9zY2hl
ZF9yZXMoY3B1KS0+c2NoZWR1bGVfbG9jaykpOwogCi0gICAgQVNTRVJUKCF2Y3B1X29uX3J1bnEo
c3ZjKSk7Ci0gICAgQVNTRVJUKGMycihjcHUpID09IGMycihzdmMtPnZjcHUtPnByb2Nlc3Nvcikp
OworICAgIEFTU0VSVCghdW5pdF9vbl9ydW5xKHN2YykpOworICAgIEFTU0VSVChjMnIoY3B1KSA9
PSBjMnIoc2NoZWRfdW5pdF9jcHUoc3ZjLT51bml0KSkpOwogCiAgICAgQVNTRVJUKCZzdmMtPnJx
ZC0+cnVucSA9PSBydW5xKTsKLSAgICBBU1NFUlQoIWlzX2lkbGVfdmNwdShzdmMtPnZjcHUpKTsK
LSAgICBBU1NFUlQoIXN2Yy0+dmNwdS0+c2NoZWRfdW5pdC0+aXNfcnVubmluZyk7CisgICAgQVNT
RVJUKCFpc19pZGxlX3VuaXQoc3ZjLT51bml0KSk7CisgICAgQVNTRVJUKCFzdmMtPnVuaXQtPmlz
X3J1bm5pbmcpOwogICAgIEFTU0VSVCghKHN2Yy0+ZmxhZ3MgJiBDU0ZMQUdfc2NoZWR1bGVkKSk7
CiAKICAgICBsaXN0X2Zvcl9lYWNoKCBpdGVyLCBydW5xICkKQEAgLTEzMDEsMTEgKzEzMDEsMTEg
QEAgcnVucV9pbnNlcnQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgY3NjaGVk
Ml91bml0ICpzdmMpCiAgICAgaWYgKCB1bmxpa2VseSh0Yl9pbml0X2RvbmUpICkKICAgICB7CiAg
ICAgICAgIHN0cnVjdCB7Ci0gICAgICAgICAgICB1bnNpZ25lZCB2Y3B1OjE2LCBkb206MTY7Cisg
ICAgICAgICAgICB1bnNpZ25lZCB1bml0OjE2LCBkb206MTY7CiAgICAgICAgICAgICB1bnNpZ25l
ZCBwb3M7CiAgICAgICAgIH0gZDsKLSAgICAgICAgZC5kb20gPSBzdmMtPnZjcHUtPmRvbWFpbi0+
ZG9tYWluX2lkOwotICAgICAgICBkLnZjcHUgPSBzdmMtPnZjcHUtPnZjcHVfaWQ7CisgICAgICAg
IGQuZG9tID0gc3ZjLT51bml0LT5kb21haW4tPmRvbWFpbl9pZDsKKyAgICAgICAgZC51bml0ID0g
c3ZjLT51bml0LT51bml0X2lkOwogICAgICAgICBkLnBvcyA9IHBvczsKICAgICAgICAgX190cmFj
ZV92YXIoVFJDX0NTQ0hFRDJfUlVOUV9QT1MsIDEsCiAgICAgICAgICAgICAgICAgICAgIHNpemVv
ZihkKSwKQEAgLTEzMTUsNyArMTMxNSw3IEBAIHJ1bnFfaW5zZXJ0KGNvbnN0IHN0cnVjdCBzY2hl
ZHVsZXIgKm9wcywgc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQogCiBzdGF0aWMgaW5saW5lIHZv
aWQgcnVucV9yZW1vdmUoc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQogewotICAgIEFTU0VSVCh2
Y3B1X29uX3J1bnEoc3ZjKSk7CisgICAgQVNTRVJUKHVuaXRfb25fcnVucShzdmMpKTsKICAgICBs
aXN0X2RlbF9pbml0KCZzdmMtPnJ1bnFfZWxlbSk7CiB9CiAKQEAgLTEzNDEsOCArMTM0MSw4IEBA
IHN0YXRpYyBpbmxpbmUgYm9vbCBpc19wcmVlbXB0YWJsZShjb25zdCBzdHJ1Y3QgY3NjaGVkMl91
bml0ICpzdmMsCiAgICAgaWYgKCByYXRlbGltaXQgPD0gQ1NDSEVEMl9SQVRFTElNSVRfVElDS0xF
X1RPTEVSQU5DRSApCiAgICAgICAgIHJldHVybiB0cnVlOwogCi0gICAgQVNTRVJUKHN2Yy0+dmNw
dS0+c2NoZWRfdW5pdC0+aXNfcnVubmluZyk7Ci0gICAgcmV0dXJuIG5vdyAtIHN2Yy0+dmNwdS0+
c2NoZWRfdW5pdC0+c3RhdGVfZW50cnlfdGltZSA+CisgICAgQVNTRVJUKHN2Yy0+dW5pdC0+aXNf
cnVubmluZyk7CisgICAgcmV0dXJuIG5vdyAtIHN2Yy0+dW5pdC0+c3RhdGVfZW50cnlfdGltZSA+
CiAgICAgICAgICAgIHJhdGVsaW1pdCAtIENTQ0hFRDJfUkFURUxJTUlUX1RJQ0tMRV9UT0xFUkFO
Q0U7CiB9CiAKQEAgLTEzNzAsMTcgKzEzNzAsMTcgQEAgc3RhdGljIHNfdGltZV90IHRpY2tsZV9z
Y29yZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHNfdGltZV90IG5vdywKIAogICAgIC8q
CiAgICAgICogV2UgYXJlIGRlYWxpbmcgd2l0aCBjcHVzIHRoYXQgYXJlIG1hcmtlZCBub24taWRs
ZSAoaS5lLiwgdGhhdCBhcmUgbm90Ci0gICAgICogaW4gcnFkLT5pZGxlKS4gSG93ZXZlciwgc29t
ZSBvZiB0aGVtIG1heSBiZSBydW5uaW5nIHRoZWlyIGlkbGUgdmNwdSwKKyAgICAgKiBpbiBycWQt
PmlkbGUpLiBIb3dldmVyLCBzb21lIG9mIHRoZW0gbWF5IGJlIHJ1bm5pbmcgdGhlaXIgaWRsZSB1
bml0LAogICAgICAqIGlmIHRha2luZyBjYXJlIG9mIHRhc2tsZXRzLiBJbiB0aGF0IGNhc2UsIHdl
IHdhbnQgdG8gbGVhdmUgaXQgYWxvbmUuCiAgICAgICovCi0gICAgaWYgKCB1bmxpa2VseShpc19p
ZGxlX3ZjcHUoY3VyLT52Y3B1KSB8fAorICAgIGlmICggdW5saWtlbHkoaXNfaWRsZV91bml0KGN1
ci0+dW5pdCkgfHwKICAgICAgICAgICFpc19wcmVlbXB0YWJsZShjdXIsIG5vdywgTUlDUk9TRUNT
KHBydi0+cmF0ZWxpbWl0X3VzKSkpICkKICAgICAgICAgcmV0dXJuIC0xOwogCiAgICAgYnVybl9j
cmVkaXRzKHJxZCwgY3VyLCBub3cpOwogCiAgICAgc2NvcmUgPSBuZXctPmNyZWRpdCAtIGN1ci0+
Y3JlZGl0OwotICAgIGlmICggbmV3LT52Y3B1LT5wcm9jZXNzb3IgIT0gY3B1ICkKKyAgICBpZiAo
IHNjaGVkX3VuaXRfY3B1KG5ldy0+dW5pdCkgIT0gY3B1ICkKICAgICAgICAgc2NvcmUgLT0gQ1ND
SEVEMl9NSUdSQVRFX1JFU0lTVDsKIAogICAgIC8qCkBAIC0xMzkxLDIxICsxMzkxLDIxIEBAIHN0
YXRpYyBzX3RpbWVfdCB0aWNrbGVfc2NvcmUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBz
X3RpbWVfdCBub3csCiAgICAgICovCiAgICAgaWYgKCBzY29yZSA+IDAgKQogICAgIHsKLSAgICAg
ICAgaWYgKCBjcHVtYXNrX3Rlc3RfY3B1KGNwdSwgbmV3LT52Y3B1LT5zY2hlZF91bml0LT5jcHVf
c29mdF9hZmZpbml0eSkgKQorICAgICAgICBpZiAoIGNwdW1hc2tfdGVzdF9jcHUoY3B1LCBuZXct
PnVuaXQtPmNwdV9zb2Z0X2FmZmluaXR5KSApCiAgICAgICAgICAgICBzY29yZSArPSBDU0NIRUQy
X0NSRURJVF9JTklUOwogCi0gICAgICAgIGlmICggIWNwdW1hc2tfdGVzdF9jcHUoY3B1LCBjdXIt
PnZjcHUtPnNjaGVkX3VuaXQtPmNwdV9zb2Z0X2FmZmluaXR5KSApCisgICAgICAgIGlmICggIWNw
dW1hc2tfdGVzdF9jcHUoY3B1LCBjdXItPnVuaXQtPmNwdV9zb2Z0X2FmZmluaXR5KSApCiAgICAg
ICAgICAgICBzY29yZSArPSBDU0NIRUQyX0NSRURJVF9JTklUOwogICAgIH0KIAogICAgIGlmICgg
dW5saWtlbHkodGJfaW5pdF9kb25lKSApCiAgICAgewogICAgICAgICBzdHJ1Y3QgewotICAgICAg
ICAgICAgdW5zaWduZWQgdmNwdToxNiwgZG9tOjE2OworICAgICAgICAgICAgdW5zaWduZWQgdW5p
dDoxNiwgZG9tOjE2OwogICAgICAgICAgICAgaW50IGNyZWRpdCwgc2NvcmU7CiAgICAgICAgIH0g
ZDsKLSAgICAgICAgZC5kb20gPSBjdXItPnZjcHUtPmRvbWFpbi0+ZG9tYWluX2lkOwotICAgICAg
ICBkLnZjcHUgPSBjdXItPnZjcHUtPnZjcHVfaWQ7CisgICAgICAgIGQuZG9tID0gY3VyLT51bml0
LT5kb21haW4tPmRvbWFpbl9pZDsKKyAgICAgICAgZC51bml0ID0gY3VyLT51bml0LT51bml0X2lk
OwogICAgICAgICBkLmNyZWRpdCA9IGN1ci0+Y3JlZGl0OwogICAgICAgICBkLnNjb3JlID0gc2Nv
cmU7CiAgICAgICAgIF9fdHJhY2VfdmFyKFRSQ19DU0NIRUQyX1RJQ0tMRV9DSEVDSywgMSwKQEAg
LTE0MTcsMTQgKzE0MTcsMTQgQEAgc3RhdGljIHNfdGltZV90IHRpY2tsZV9zY29yZShjb25zdCBz
dHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHNfdGltZV90IG5vdywKIH0KIAogLyoKLSAqIENoZWNrIHdo
YXQgcHJvY2Vzc29yIGl0IGlzIGJlc3QgdG8gJ3dha2UnLCBmb3IgcGlja2luZyB1cCBhIHZjcHUg
dGhhdCBoYXMKKyAqIENoZWNrIHdoYXQgcHJvY2Vzc29yIGl0IGlzIGJlc3QgdG8gJ3dha2UnLCBm
b3IgcGlja2luZyB1cCBhbiB1bml0IHRoYXQgaGFzCiAgKiBqdXN0IGJlZW4gcHV0IChiYWNrKSBp
biB0aGUgcnVucXVldWUuIExvZ2ljIGlzIGFzIGZvbGxvd3M6CiAgKiAgMS4gaWYgdGhlcmUgYXJl
IGlkbGUgcHJvY2Vzc29ycyBpbiB0aGUgcnVucSwgd2FrZSBvbmUgb2YgdGhlbTsKLSAqICAyLiBp
ZiB0aGVyZSBhcmVuJ3QgaWRsZSBwcm9jZXNzb3IsIGNoZWNrIHRoZSBvbmUgd2VyZSB0aGUgdmNw
dSB3YXMKKyAqICAyLiBpZiB0aGVyZSBhcmVuJ3QgaWRsZSBwcm9jZXNzb3IsIGNoZWNrIHRoZSBv
bmUgd2VyZSB0aGUgdW5pdCB3YXMKICAqICAgICBydW5uaW5nIGJlZm9yZSB0byBzZWUgaWYgd2Ug
Y2FuIHByZWVtcHQgd2hhdCdzIHJ1bm5pbmcgdGhlcmUgbm93CiAgKiAgICAgKGFuZCBoZW5jZSBk
b2luZyBqdXN0IG9uZSBtaWdyYXRpb24pOwotICogIDMuIGxhc3Qgc3RhbmQ6IGNoZWNrIGFsbCBw
cm9jZXNzb3JzIGFuZCBzZWUgaWYgdGhlIHZjcHUgaXMgaW4gcmlnaHQKLSAqICAgICBvZiBwcmVl
bXB0aW5nIGFueSBvZiB0aGUgb3RoZXIgdmNwdXMgcnVubmluZyBvbiB0aGVtICh0aGlzIHJlcXVp
cmVzCisgKiAgMy4gbGFzdCBzdGFuZDogY2hlY2sgYWxsIHByb2Nlc3NvcnMgYW5kIHNlZSBpZiB0
aGUgdW5pdCBpcyBpbiByaWdodAorICogICAgIG9mIHByZWVtcHRpbmcgYW55IG9mIHRoZSBvdGhl
ciB1bml0cyBydW5uaW5nIG9uIHRoZW0gKHRoaXMgcmVxdWlyZXMKICAqICAgICB0d28gbWlncmF0
aW9ucywgYW5kIHRoYXQncyBpbmRlZWQgd2h5IGl0IGlzIGxlZnQgYXMgdGhlIGxhc3Qgc3RhbmQp
LgogICoKICAqIE5vdGUgdGhhdCB3aGVuIHdlIHNheSAnaWRsZSBwcm9jZXNzb3JzJyB3aGF0IHdl
IHJlYWxseSBtZWFuIGlzIChwcmV0dHkKQEAgLTE0MzcsMTAgKzE0MzcsMTAgQEAgcnVucV90aWNr
bGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgY3NjaGVkMl91bml0ICpuZXcs
IHNfdGltZV90IG5vdykKIHsKICAgICBpbnQgaSwgaXBpZCA9IC0xOwogICAgIHNfdGltZV90IG1h
eCA9IDA7Ci0gICAgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQgPSBuZXctPnZjcHUtPnNjaGVkX3Vu
aXQ7Ci0gICAgdW5zaWduZWQgaW50IGJzLCBjcHUgPSBuZXctPnZjcHUtPnByb2Nlc3NvcjsKKyAg
ICBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCA9IG5ldy0+dW5pdDsKKyAgICB1bnNpZ25lZCBpbnQg
YnMsIGNwdSA9IHNjaGVkX3VuaXRfY3B1KHVuaXQpOwogICAgIHN0cnVjdCBjc2NoZWQyX3J1bnF1
ZXVlX2RhdGEgKnJxZCA9IGMycnFkKG9wcywgY3B1KTsKLSAgICBjcHVtYXNrX3QgKm9ubGluZSA9
IGNwdXBvb2xfZG9tYWluX2NwdW1hc2sobmV3LT52Y3B1LT5kb21haW4pOworICAgIGNwdW1hc2tf
dCAqb25saW5lID0gY3B1cG9vbF9kb21haW5fY3B1bWFzayh1bml0LT5kb21haW4pOwogICAgIGNw
dW1hc2tfdCBtYXNrOwogCiAgICAgQVNTRVJUKG5ldy0+cnFkID09IHJxZCk7CkBAIC0xNDQ4LDEz
ICsxNDQ4LDEzIEBAIHJ1bnFfdGlja2xlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3Ry
dWN0IGNzY2hlZDJfdW5pdCAqbmV3LCBzX3RpbWVfdCBub3cpCiAgICAgaWYgKCB1bmxpa2VseSh0
Yl9pbml0X2RvbmUpICkKICAgICB7CiAgICAgICAgIHN0cnVjdCB7Ci0gICAgICAgICAgICB1bnNp
Z25lZCB2Y3B1OjE2LCBkb206MTY7CisgICAgICAgICAgICB1bnNpZ25lZCB1bml0OjE2LCBkb206
MTY7CiAgICAgICAgICAgICB1bnNpZ25lZCBwcm9jZXNzb3I7CiAgICAgICAgICAgICBpbnQgY3Jl
ZGl0OwogICAgICAgICB9IGQ7Ci0gICAgICAgIGQuZG9tID0gbmV3LT52Y3B1LT5kb21haW4tPmRv
bWFpbl9pZDsKLSAgICAgICAgZC52Y3B1ID0gbmV3LT52Y3B1LT52Y3B1X2lkOwotICAgICAgICBk
LnByb2Nlc3NvciA9IG5ldy0+dmNwdS0+cHJvY2Vzc29yOworICAgICAgICBkLmRvbSA9IHVuaXQt
PmRvbWFpbi0+ZG9tYWluX2lkOworICAgICAgICBkLnVuaXQgPSB1bml0LT51bml0X2lkOworICAg
ICAgICBkLnByb2Nlc3NvciA9IGNwdTsKICAgICAgICAgZC5jcmVkaXQgPSBuZXctPmNyZWRpdDsK
ICAgICAgICAgX190cmFjZV92YXIoVFJDX0NTQ0hFRDJfVElDS0xFX05FVywgMSwKICAgICAgICAg
ICAgICAgICAgICAgc2l6ZW9mKGQpLApAQCAtMTQ2MiwxMSArMTQ2MiwxMSBAQCBydW5xX3RpY2ts
ZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBjc2NoZWQyX3VuaXQgKm5ldywg
c190aW1lX3Qgbm93KQogICAgIH0KIAogICAgIC8qCi0gICAgICogRXhjbHVzaXZlIHBpbm5pbmcg
aXMgd2hlbiBhIHZjcHUgaGFzIGhhcmQtYWZmaW5pdHkgd2l0aCBvbmx5IG9uZQotICAgICAqIGNw
dSwgYW5kIHRoZXJlIGlzIG5vIG90aGVyIHZjcHUgdGhhdCBoYXMgaGFyZC1hZmZpbml0eSB3aXRo
IHRoYXQKKyAgICAgKiBFeGNsdXNpdmUgcGlubmluZyBpcyB3aGVuIGFuIHVuaXQgaGFzIGhhcmQt
YWZmaW5pdHkgd2l0aCBvbmx5IG9uZQorICAgICAqIGNwdSwgYW5kIHRoZXJlIGlzIG5vIG90aGVy
IHVuaXQgdGhhdCBoYXMgaGFyZC1hZmZpbml0eSB3aXRoIHRoYXQKICAgICAgKiBzYW1lIGNwdS4g
VGhpcyBpcyBpbmZyZXF1ZW50LCBidXQgaWYgaXQgaGFwcGVucywgaXMgZm9yIGFjaGlldmluZwog
ICAgICAqIHRoZSBtb3N0IHBvc3NpYmxlIGRldGVybWluaXNtLCBhbmQgbGVhc3QgcG9zc2libGUg
b3ZlcmhlYWQgZm9yCi0gICAgICogdGhlIHZjcHVzIGluIHF1ZXN0aW9uLgorICAgICAqIHRoZSB1
bml0cyBpbiBxdWVzdGlvbi4KICAgICAgKgogICAgICAqIFRyeSB0byBpZGVudGlmeSB0aGUgdmFz
dCBtYWpvcml0eSBvZiB0aGVzZSBzaXR1YXRpb25zLCBhbmQgZGVhbAogICAgICAqIHdpdGggdGhl
bSBxdWlja2x5LgpAQCAtMTUzMyw3ICsxNTMzLDcgQEAgcnVucV90aWNrbGUoY29uc3Qgc3RydWN0
IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgY3NjaGVkMl91bml0ICpuZXcsIHNfdGltZV90IG5vdykK
ICAgICAvKgogICAgICAqIE5vdGUgdGhhdCwgaWYgd2UgYXJlIGhlcmUsIGl0IG1lYW5zIHdlIGhh
dmUgZG9uZSB0aGUgaGFyZC1hZmZpbml0eQogICAgICAqIGJhbGFuY2luZyBzdGVwIG9mIHRoZSBs
b29wLCBhbmQgaGVuY2Ugd2hhdCB3ZSBoYXZlIGluIGNwdW1hc2tfc2NyYXRjaAotICAgICAqIGlz
IHdoYXQgd2UgcHV0IHRoZXJlIGZvciBsYXN0LCBpLmUuLCBuZXcncyB2Y3B1X2hhcmRfYWZmaW5p
dHkgJiBvbmxpbmUKKyAgICAgKiBpcyB3aGF0IHdlIHB1dCB0aGVyZSBmb3IgbGFzdCwgaS5lLiwg
bmV3J3MgdW5pdF9oYXJkX2FmZmluaXR5ICYgb25saW5lCiAgICAgICogd2hpY2ggaXMgZXhhY3Rs
eSB3aGF0IHdlIG5lZWQgZm9yIHRoZSBuZXh0IHBhcnQgb2YgdGhlIGZ1bmN0aW9uLgogICAgICAq
LwogCkBAIC0xNTQ0LDcgKzE1NDQsNyBAQCBydW5xX3RpY2tsZShjb25zdCBzdHJ1Y3Qgc2NoZWR1
bGVyICpvcHMsIHN0cnVjdCBjc2NoZWQyX3VuaXQgKm5ldywgc190aW1lX3Qgbm93KQogICAgICAq
CiAgICAgICogRm9yIGRlY2lkaW5nIHdoaWNoIGNwdSB0byB0aWNrbGUsIHdlIHVzZSB0aWNrbGVf
c2NvcmUoKSwgd2hpY2ggd2lsbAogICAgICAqIGZhY3RvciBpbiBib3RoIG5ldydzIHNvZnQtYWZm
aW5pdHksIGFuZCB0aGUgc29mdC1hZmZpbml0eSBvZiB0aGUKLSAgICAgKiB2Y3B1IHJ1bm5pbmcg
b24gZWFjaCBjcHUgdGhhdCB3ZSBjb25zaWRlci4KKyAgICAgKiB1bml0IHJ1bm5pbmcgb24gZWFj
aCBjcHUgdGhhdCB3ZSBjb25zaWRlci4KICAgICAgKi8KICAgICBjcHVtYXNrX2FuZG5vdCgmbWFz
aywgJnJxZC0+YWN0aXZlLCAmcnFkLT5pZGxlKTsKICAgICBjcHVtYXNrX2FuZG5vdCgmbWFzaywg
Jm1hc2ssICZycWQtPnRpY2tsZWQpOwpAQCAtMTU4OSw3ICsxNTg5LDcgQEAgcnVucV90aWNrbGUo
Y29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgY3NjaGVkMl91bml0ICpuZXcsIHNf
dGltZV90IG5vdykKICAgICAgICAgcmV0dXJuOwogICAgIH0KIAotICAgIEFTU0VSVCghaXNfaWRs
ZV92Y3B1KGN1cnJfb25fY3B1KGlwaWQpLT52Y3B1X2xpc3QpKTsKKyAgICBBU1NFUlQoIWlzX2lk
bGVfdW5pdChjdXJyX29uX2NwdShpcGlkKSkpOwogICAgIFNDSEVEX1NUQVRfQ1JBTksodGlja2xl
ZF9idXN5X2NwdSk7CiAgdGlja2xlOgogICAgIEJVR19PTihpcGlkID09IC0xKTsKQEAgLTE2MjQs
MTYgKzE2MjQsMTYgQEAgc3RhdGljIHZvaWQgcmVzZXRfY3JlZGl0KGNvbnN0IHN0cnVjdCBzY2hl
ZHVsZXIgKm9wcywgaW50IGNwdSwgc190aW1lX3Qgbm93LAogCiAgICAgLyoKICAgICAgKiBVbmRl
ciBub3JtYWwgY2lyY3Vtc3RhbmNlcywgc25leHQtPmNyZWRpdCBzaG91bGQgbmV2ZXIgYmUgbGVz
cwotICAgICAqIHRoYW4gLUNTQ0hFRDJfTUlOX1RJTUVSLiAgSG93ZXZlciwgdW5kZXIgc29tZSBj
aXJjdW1zdGFuY2VzLCBhCi0gICAgICogdmNwdSB3aXRoIGxvdyBjcmVkaXRzIG1heSBiZSBhbGxv
d2VkIHRvIHJ1biBsb25nIGVub3VnaCB0aGF0CisgICAgICogdGhhbiAtQ1NDSEVEMl9NSU5fVElN
RVIuICBIb3dldmVyLCB1bmRlciBzb21lIGNpcmN1bXN0YW5jZXMsIGFuCisgICAgICogdW5pdCB3
aXRoIGxvdyBjcmVkaXRzIG1heSBiZSBhbGxvd2VkIHRvIHJ1biBsb25nIGVub3VnaCB0aGF0CiAg
ICAgICogaXRzIGNyZWRpdHMgYXJlIGFjdHVhbGx5IGxlc3MgdGhhbiAtQ1NDSEVEMl9DUkVESVRf
SU5JVC4KLSAgICAgKiAoSW5zdGFuY2VzIGhhdmUgYmVlbiBvYnNlcnZlZCwgZm9yIGV4YW1wbGUs
IHdoZXJlIGEgdmNwdSB3aXRoCisgICAgICogKEluc3RhbmNlcyBoYXZlIGJlZW4gb2JzZXJ2ZWQs
IGZvciBleGFtcGxlLCB3aGVyZSBhbiB1bml0IHdpdGgKICAgICAgKiAyMDB1cyBvZiBjcmVkaXQg
d2FzIGFsbG93ZWQgdG8gcnVuIGZvciAxMW1zLCBnaXZpbmcgaXQgLTEwLjhtcwogICAgICAqIG9m
IGNyZWRpdC4gIFRodXMgaXQgd2FzIHN0aWxsIG5lZ2F0aXZlIGV2ZW4gYWZ0ZXIgdGhlIHJlc2V0
LikKICAgICAgKgogICAgICAqIElmIHRoaXMgaXMgdGhlIGNhc2UgZm9yIHNuZXh0LCB3ZSBzaW1w
bHkgd2FudCB0byBrZWVwIG1vdmluZwogICAgICAqIGV2ZXJ5b25lIHVwIHVudGlsIGl0IGlzIGlu
IHRoZSBibGFjayBhZ2Fpbi4gIFRoaXMgZmFpciBiZWNhdXNlCi0gICAgICogbm9uZSBvZiB0aGUg
b3RoZXIgdmNwdXMgd2FudCB0byBydW4gYXQgdGhlIG1vbWVudC4KKyAgICAgKiBub25lIG9mIHRo
ZSBvdGhlciB1bml0cyB3YW50IHRvIHJ1biBhdCB0aGUgbW9tZW50LgogICAgICAqCiAgICAgICog
UmF0aGVyIHRoYW4gbG9vcGluZywgaG93ZXZlciwgd2UganVzdCBjYWxjdWxhdGUgYSBtdWx0aXBs
aWVyLAogICAgICAqIGF2b2lkaW5nIGFuIGludGVnZXIgZGl2aXNpb24gYW5kIG11bHRpcGxpY2F0
aW9uIGluIHRoZSBjb21tb24KQEAgLTE2NTAsMTYgKzE2NTAsMTYgQEAgc3RhdGljIHZvaWQgcmVz
ZXRfY3JlZGl0KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgaW50IGNwdSwgc190aW1lX3Qg
bm93LAogICAgICAgICBpbnQgc3RhcnRfY3JlZGl0OwogCiAgICAgICAgIHN2YyA9IGxpc3RfZW50
cnkoaXRlciwgc3RydWN0IGNzY2hlZDJfdW5pdCwgcnFkX2VsZW0pOwotICAgICAgICBzdmNfY3B1
ID0gc3ZjLT52Y3B1LT5wcm9jZXNzb3I7CisgICAgICAgIHN2Y19jcHUgPSBzY2hlZF91bml0X2Nw
dShzdmMtPnVuaXQpOwogCi0gICAgICAgIEFTU0VSVCghaXNfaWRsZV92Y3B1KHN2Yy0+dmNwdSkp
OworICAgICAgICBBU1NFUlQoIWlzX2lkbGVfdW5pdChzdmMtPnVuaXQpKTsKICAgICAgICAgQVNT
RVJUKHN2Yy0+cnFkID09IHJxZCk7CiAKICAgICAgICAgLyoKICAgICAgICAgICogSWYgc3ZjIGlz
IHJ1bm5pbmcsIGl0IGlzIG91ciByZXNwb25zaWJpbGl0eSB0byBtYWtlIHN1cmUsIGhlcmUsCiAg
ICAgICAgICAqIHRoYXQgdGhlIGNyZWRpdCBpdCBoYXMgc3BlbnQgc28gZmFyIGdldCBhY2NvdW50
ZWQuCiAgICAgICAgICAqLwotICAgICAgICBpZiAoIHN2Yy0+dmNwdSA9PSBjdXJyX29uX2NwdShz
dmNfY3B1KS0+dmNwdV9saXN0ICkKKyAgICAgICAgaWYgKCBzdmMtPnVuaXQgPT0gY3Vycl9vbl9j
cHUoc3ZjX2NwdSkgKQogICAgICAgICB7CiAgICAgICAgICAgICBidXJuX2NyZWRpdHMocnFkLCBz
dmMsIG5vdyk7CiAgICAgICAgICAgICAvKgpAQCAtMTY5MCwxMiArMTY5MCwxMiBAQCBzdGF0aWMg
dm9pZCByZXNldF9jcmVkaXQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBpbnQgY3B1LCBz
X3RpbWVfdCBub3csCiAgICAgICAgIGlmICggdW5saWtlbHkodGJfaW5pdF9kb25lKSApCiAgICAg
ICAgIHsKICAgICAgICAgICAgIHN0cnVjdCB7Ci0gICAgICAgICAgICAgICAgdW5zaWduZWQgdmNw
dToxNiwgZG9tOjE2OworICAgICAgICAgICAgICAgIHVuc2lnbmVkIHVuaXQ6MTYsIGRvbToxNjsK
ICAgICAgICAgICAgICAgICBpbnQgY3JlZGl0X3N0YXJ0LCBjcmVkaXRfZW5kOwogICAgICAgICAg
ICAgICAgIHVuc2lnbmVkIG11bHRpcGxpZXI7CiAgICAgICAgICAgICB9IGQ7Ci0gICAgICAgICAg
ICBkLmRvbSA9IHN2Yy0+dmNwdS0+ZG9tYWluLT5kb21haW5faWQ7Ci0gICAgICAgICAgICBkLnZj
cHUgPSBzdmMtPnZjcHUtPnZjcHVfaWQ7CisgICAgICAgICAgICBkLmRvbSA9IHN2Yy0+dW5pdC0+
ZG9tYWluLT5kb21haW5faWQ7CisgICAgICAgICAgICBkLnVuaXQgPSBzdmMtPnVuaXQtPnVuaXRf
aWQ7CiAgICAgICAgICAgICBkLmNyZWRpdF9zdGFydCA9IHN0YXJ0X2NyZWRpdDsKICAgICAgICAg
ICAgIGQuY3JlZGl0X2VuZCA9IHN2Yy0+Y3JlZGl0OwogICAgICAgICAgICAgZC5tdWx0aXBsaWVy
ID0gbTsKQEAgLTE3MTUsOSArMTcxNSw5IEBAIHZvaWQgYnVybl9jcmVkaXRzKHN0cnVjdCBjc2No
ZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCwKIHsKICAgICBzX3RpbWVfdCBkZWx0YTsKIAotICAgIEFT
U0VSVChzdmMgPT0gY3NjaGVkMl91bml0KGN1cnJfb25fY3B1KHN2Yy0+dmNwdS0+cHJvY2Vzc29y
KSkpOworICAgIEFTU0VSVChzdmMgPT0gY3NjaGVkMl91bml0KGN1cnJfb25fY3B1KHNjaGVkX3Vu
aXRfY3B1KHN2Yy0+dW5pdCkpKSk7CiAKLSAgICBpZiAoIHVubGlrZWx5KGlzX2lkbGVfdmNwdShz
dmMtPnZjcHUpKSApCisgICAgaWYgKCB1bmxpa2VseShpc19pZGxlX3VuaXQoc3ZjLT51bml0KSkg
KQogICAgIHsKICAgICAgICAgQVNTRVJUKHN2Yy0+Y3JlZGl0ID09IENTQ0hFRDJfSURMRV9DUkVE
SVQpOwogICAgICAgICByZXR1cm47CkBAIC0xNzQ2LDEyICsxNzQ2LDEyIEBAIHZvaWQgYnVybl9j
cmVkaXRzKHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCwKICAgICBpZiAoIHVubGlr
ZWx5KHRiX2luaXRfZG9uZSkgKQogICAgIHsKICAgICAgICAgc3RydWN0IHsKLSAgICAgICAgICAg
IHVuc2lnbmVkIHZjcHU6MTYsIGRvbToxNjsKKyAgICAgICAgICAgIHVuc2lnbmVkIHVuaXQ6MTYs
IGRvbToxNjsKICAgICAgICAgICAgIGludCBjcmVkaXQsIGJ1ZGdldDsKICAgICAgICAgICAgIGlu
dCBkZWx0YTsKICAgICAgICAgfSBkOwotICAgICAgICBkLmRvbSA9IHN2Yy0+dmNwdS0+ZG9tYWlu
LT5kb21haW5faWQ7Ci0gICAgICAgIGQudmNwdSA9IHN2Yy0+dmNwdS0+dmNwdV9pZDsKKyAgICAg
ICAgZC5kb20gPSBzdmMtPnVuaXQtPmRvbWFpbi0+ZG9tYWluX2lkOworICAgICAgICBkLnVuaXQg
PSBzdmMtPnVuaXQtPnVuaXRfaWQ7CiAgICAgICAgIGQuY3JlZGl0ID0gc3ZjLT5jcmVkaXQ7CiAg
ICAgICAgIGQuYnVkZ2V0ID0gaGFzX2NhcChzdmMpID8gIHN2Yy0+YnVkZ2V0IDogSU5UX01JTjsK
ICAgICAgICAgZC5kZWx0YSA9IGRlbHRhOwpAQCAtMTc2NSwzOSArMTc2NSwzOSBAQCB2b2lkIGJ1
cm5fY3JlZGl0cyhzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQsCiAgKiBCdWRnZXQt
cmVsYXRlZCBjb2RlLgogICovCiAKLXN0YXRpYyB2b2lkIHBhcmtfdmNwdShzdHJ1Y3QgY3NjaGVk
Ml91bml0ICpzdmMpCitzdGF0aWMgdm9pZCBwYXJrX3VuaXQoc3RydWN0IGNzY2hlZDJfdW5pdCAq
c3ZjKQogewotICAgIHN0cnVjdCB2Y3B1ICp2ID0gc3ZjLT52Y3B1OworICAgIHN0cnVjdCBzY2hl
ZF91bml0ICp1bml0ID0gc3ZjLT51bml0OwogCiAgICAgQVNTRVJUKHNwaW5faXNfbG9ja2VkKCZz
dmMtPnNkb20tPmJ1ZGdldF9sb2NrKSk7CiAKICAgICAvKgotICAgICAqIEl0IHdhcyBpbXBvc3Np
YmxlIHRvIGZpbmQgYnVkZ2V0IGZvciB0aGlzIHZDUFUsIHNvIGl0IGhhcyB0byBiZQorICAgICAq
IEl0IHdhcyBpbXBvc3NpYmxlIHRvIGZpbmQgYnVkZ2V0IGZvciB0aGlzIHVuaXQsIHNvIGl0IGhh
cyB0byBiZQogICAgICAqICJwYXJrZWQiLiBUaGlzIGltcGxpZXMgaXQgaXMgbm90IHJ1bm5hYmxl
LCBzbyB3ZSBtYXJrIGl0IGFzIHN1Y2ggaW4KLSAgICAgKiBpdHMgcGF1c2VfZmxhZ3MuIElmIHRo
ZSB2Q1BVIGlzIGN1cnJlbnRseSBzY2hlZHVsZWQgKHdoaWNoIG1lYW5zIHdlCisgICAgICogaXRz
IHBhdXNlX2ZsYWdzLiBJZiB0aGUgdW5pdCBpcyBjdXJyZW50bHkgc2NoZWR1bGVkICh3aGljaCBt
ZWFucyB3ZQogICAgICAqIGFyZSBoZXJlIGFmdGVyIGJlaW5nIGNhbGxlZCBmcm9tIHdpdGhpbiBj
c2NoZWRfc2NoZWR1bGUoKSksIGZsYWdnaW5nCiAgICAgICogaXMgZW5vdWdoLCBhcyB3ZSdsbCBj
aG9vc2Ugc29tZW9uZSBlbHNlLCBhbmQgdGhlbiBjb250ZXh0X3NhdmVkKCkKICAgICAgKiB3aWxs
IHRha2UgY2FyZSBvZiB1cGRhdGluZyB0aGUgbG9hZCBwcm9wZXJseS4KICAgICAgKgotICAgICAq
IElmLCBPVE9ILCB0aGUgdkNQVSBpcyBzaXR0aW5nIGluIHRoZSBydW5xdWV1ZSAod2hpY2ggbWVh
bnMgd2UgYXJlIGhlcmUKKyAgICAgKiBJZiwgT1RPSCwgdGhlIHVuaXQgaXMgc2l0dGluZyBpbiB0
aGUgcnVucXVldWUgKHdoaWNoIG1lYW5zIHdlIGFyZSBoZXJlCiAgICAgICogYWZ0ZXIgYmVpbmcg
Y2FsbGVkIGZyb20gd2l0aGluIHJ1bnFfY2FuZGlkYXRlKCkpLCB3ZSBtdXN0IGdvIGFsbCB0aGUK
ICAgICAgKiB3YXkgZG93biB0byB0YWtpbmcgaXQgb3V0IG9mIHRoZXJlLCBhbmQgdXBkYXRpbmcg
dGhlIGxvYWQgYWNjb3JkaW5nbHkuCiAgICAgICoKLSAgICAgKiBJbiBib3RoIGNhc2VzLCB3ZSBh
bHNvIGFkZCBpdCB0byB0aGUgbGlzdCBvZiBwYXJrZWQgdkNQVXMgb2YgdGhlIGRvbWFpbi4KKyAg
ICAgKiBJbiBib3RoIGNhc2VzLCB3ZSBhbHNvIGFkZCBpdCB0byB0aGUgbGlzdCBvZiBwYXJrZWQg
dW5pdHMgb2YgdGhlIGRvbWFpbi4KICAgICAgKi8KLSAgICBfX3NldF9iaXQoX1ZQRl9wYXJrZWQs
ICZ2LT5wYXVzZV9mbGFncyk7Ci0gICAgaWYgKCB2Y3B1X29uX3J1bnEoc3ZjKSApCisgICAgc2No
ZWRfc2V0X3BhdXNlX2ZsYWdzKHVuaXQsIF9WUEZfcGFya2VkKTsKKyAgICBpZiAoIHVuaXRfb25f
cnVucShzdmMpICkKICAgICB7CiAgICAgICAgIHJ1bnFfcmVtb3ZlKHN2Yyk7CiAgICAgICAgIHVw
ZGF0ZV9sb2FkKHN2Yy0+c2RvbS0+ZG9tLT5jcHVwb29sLT5zY2hlZCwgc3ZjLT5ycWQsIHN2Yywg
LTEsIE5PVygpKTsKICAgICB9Ci0gICAgbGlzdF9hZGQoJnN2Yy0+cGFya2VkX2VsZW0sICZzdmMt
PnNkb20tPnBhcmtlZF92Y3B1cyk7CisgICAgbGlzdF9hZGQoJnN2Yy0+cGFya2VkX2VsZW0sICZz
dmMtPnNkb20tPnBhcmtlZF91bml0cyk7CiB9CiAKLXN0YXRpYyBib29sIHZjcHVfZ3JhYl9idWRn
ZXQoc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQorc3RhdGljIGJvb2wgdW5pdF9ncmFiX2J1ZGdl
dChzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMpCiB7CiAgICAgc3RydWN0IGNzY2hlZDJfZG9tICpz
ZG9tID0gc3ZjLT5zZG9tOwotICAgIHVuc2lnbmVkIGludCBjcHUgPSBzdmMtPnZjcHUtPnByb2Nl
c3NvcjsKKyAgICB1bnNpZ25lZCBpbnQgY3B1ID0gc2NoZWRfdW5pdF9jcHUoc3ZjLT51bml0KTsK
IAogICAgIEFTU0VSVChzcGluX2lzX2xvY2tlZChnZXRfc2NoZWRfcmVzKGNwdSktPnNjaGVkdWxl
X2xvY2spKTsKIApAQCAtMTgwOSw5ICsxODA5LDkgQEAgc3RhdGljIGJvb2wgdmNwdV9ncmFiX2J1
ZGdldChzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMpCiAKICAgICAvKgogICAgICAqIEhlcmUsIHN2
Yy0+YnVkZ2V0IGlzIDw9IDAgKGFzLCBpZiBpdCB3YXMgPiAwLCB3ZSdkIGhhdmUgdGFrZW4gdGhl
IGlmCi0gICAgICogYWJvdmUhKS4gVGhhdCBiYXNpY2FsbHkgbWVhbnMgdGhlIHZDUFUgaGFzIG92
ZXJydW4gYSBiaXQgLS1iZWNhdXNlIG9mCisgICAgICogYWJvdmUhKS4gVGhhdCBiYXNpY2FsbHkg
bWVhbnMgdGhlIHVuaXQgaGFzIG92ZXJydW4gYSBiaXQgLS1iZWNhdXNlIG9mCiAgICAgICogdmFy
aW91cyByZWFzb25zLS0gYW5kIHdlIHdhbnQgdG8gdGFrZSB0aGF0IGludG8gYWNjb3VudC4gV2l0
aCB0aGUgKz0sCi0gICAgICogd2UgYXJlIGFjdHVhbGx5IHN1YnRyYWN0aW5nIHRoZSBhbW91bnQg
b2YgYnVkZ2V0IHRoZSB2Q1BVIGhhcworICAgICAqIHdlIGFyZSBhY3R1YWxseSBzdWJ0cmFjdGlu
ZyB0aGUgYW1vdW50IG9mIGJ1ZGdldCB0aGUgdW5pdCBoYXMKICAgICAgKiBvdmVyY29uc3VtZWQs
IGZyb20gdGhlIHRvdGFsIGRvbWFpbiBidWRnZXQuCiAgICAgICovCiAgICAgc2RvbS0+YnVkZ2V0
ICs9IHN2Yy0+YnVkZ2V0OwpAQCAtMTgzMiw3ICsxODMyLDcgQEAgc3RhdGljIGJvb2wgdmNwdV9n
cmFiX2J1ZGdldChzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMpCiAgICAgZWxzZQogICAgIHsKICAg
ICAgICAgc3ZjLT5idWRnZXQgPSAwOwotICAgICAgICBwYXJrX3ZjcHUoc3ZjKTsKKyAgICAgICAg
cGFya191bml0KHN2Yyk7CiAgICAgfQogCiAgICAgc3Bpbl91bmxvY2soJnNkb20tPmJ1ZGdldF9s
b2NrKTsKQEAgLTE4NDEsMTAgKzE4NDEsMTAgQEAgc3RhdGljIGJvb2wgdmNwdV9ncmFiX2J1ZGdl
dChzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMpCiB9CiAKIHN0YXRpYyB2b2lkCi12Y3B1X3JldHVy
bl9idWRnZXQoc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjLCBzdHJ1Y3QgbGlzdF9oZWFkICpwYXJr
ZWQpCit1bml0X3JldHVybl9idWRnZXQoc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjLCBzdHJ1Y3Qg
bGlzdF9oZWFkICpwYXJrZWQpCiB7CiAgICAgc3RydWN0IGNzY2hlZDJfZG9tICpzZG9tID0gc3Zj
LT5zZG9tOwotICAgIHVuc2lnbmVkIGludCBjcHUgPSBzdmMtPnZjcHUtPnByb2Nlc3NvcjsKKyAg
ICB1bnNpZ25lZCBpbnQgY3B1ID0gc2NoZWRfdW5pdF9jcHUoc3ZjLT51bml0KTsKIAogICAgIEFT
U0VSVChzcGluX2lzX2xvY2tlZChnZXRfc2NoZWRfcmVzKGNwdSktPnNjaGVkdWxlX2xvY2spKTsK
ICAgICBBU1NFUlQobGlzdF9lbXB0eShwYXJrZWQpKTsKQEAgLTE4NTMsNyArMTg1Myw3IEBAIHZj
cHVfcmV0dXJuX2J1ZGdldChzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMsIHN0cnVjdCBsaXN0X2hl
YWQgKnBhcmtlZCkKICAgICBzcGluX2xvY2soJnNkb20tPmJ1ZGdldF9sb2NrKTsKIAogICAgIC8q
Ci0gICAgICogVGhlIHZDUFUgaXMgc3RvcHBpbmcgcnVubmluZyAoZS5nLiwgYmVjYXVzZSBpdCdz
IGJsb2NraW5nLCBvciBpdCBoYXMKKyAgICAgKiBUaGUgdW5pdCBpcyBzdG9wcGluZyBydW5uaW5n
IChlLmcuLCBiZWNhdXNlIGl0J3MgYmxvY2tpbmcsIG9yIGl0IGhhcwogICAgICAqIGJlZW4gcHJl
ZW1wdGVkKS4gSWYgaXQgaGFzbid0IGNvbnN1bWVkIGFsbCB0aGUgYnVkZ2V0IGl0IGdvdCB3aGVu
LAogICAgICAqIHN0YXJ0aW5nIHRvIHJ1biwgcHV0IHRoYXQgcmVtYWluaW5nIGFtb3VudCBiYWNr
IGluIHRoZSBkb21haW4ncyBidWRnZXQKICAgICAgKiBwb29sLgpAQCAtMTg2Miw1OCArMTg2Miw1
OCBAQCB2Y3B1X3JldHVybl9idWRnZXQoc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjLCBzdHJ1Y3Qg
bGlzdF9oZWFkICpwYXJrZWQpCiAgICAgc3ZjLT5idWRnZXQgPSAwOwogCiAgICAgLyoKLSAgICAg
KiBNYWtpbmcgYnVkZ2V0IGF2YWlsYWJsZSBhZ2FpbiB0byB0aGUgZG9tYWluIG1lYW5zIHRoYXQg
cGFya2VkIHZDUFVzCi0gICAgICogbWF5IGJlIHVucGFya2VkIGFuZCBydW4uIFRoZXkgYXJlLCBp
ZiBhbnksIGluIHRoZSBkb21haW4ncyBwYXJrZWRfdmNwdXMKKyAgICAgKiBNYWtpbmcgYnVkZ2V0
IGF2YWlsYWJsZSBhZ2FpbiB0byB0aGUgZG9tYWluIG1lYW5zIHRoYXQgcGFya2VkIHVuaXRzCisg
ICAgICogbWF5IGJlIHVucGFya2VkIGFuZCBydW4uIFRoZXkgYXJlLCBpZiBhbnksIGluIHRoZSBk
b21haW4ncyBwYXJrZWRfdW5pdHMKICAgICAgKiBsaXN0LCBzbyB3ZSB3YW50IHRvIGdvIHRocm91
Z2ggdGhhdCBhbmQgdW5wYXJrIHRoZW0gKHNvIHRoZXkgY2FuIHRyeQogICAgICAqIHRvIGdldCBz
b21lIGJ1ZGdldCkuCiAgICAgICoKICAgICAgKiBUb3VjaGluZyB0aGUgbGlzdCByZXF1aXJlcyB0
aGUgYnVkZ2V0X2xvY2ssIHdoaWNoIHdlIGhvbGQuIExldCdzCiAgICAgICogdGhlcmVmb3JlIHB1
dCBldmVyeW9uZSBpbiB0aGF0IGxpc3QgaW4gYW5vdGhlciwgdGVtcG9yYXJ5IGxpc3QsIHdoaWNo
Ci0gICAgICogdGhlbiB0aGUgY2FsbGVyIHdpbGwgdHJhdmVyc2UsIHVucGFya2luZyB0aGUgdkNQ
VXMgaXQgZmluZHMgdGhlcmUuCisgICAgICogdGhlbiB0aGUgY2FsbGVyIHdpbGwgdHJhdmVyc2Us
IHVucGFya2luZyB0aGUgdW5pdHMgaXQgZmluZHMgdGhlcmUuCiAgICAgICoKICAgICAgKiBJbiBm
YWN0LCB3ZSBjYW4ndCBkbyB0aGUgYWN0dWFsIHVucGFya2luZyBoZXJlLCBiZWNhdXNlIHRoYXQg
cmVxdWlyZXMKLSAgICAgKiB0YWtpbmcgdGhlIHJ1bnF1ZXVlIGxvY2sgb2YgdGhlIHZDUFVzIGJl
aW5nIHVucGFya2VkLCBhbmQgd2UgY2FuJ3QKKyAgICAgKiB0YWtpbmcgdGhlIHJ1bnF1ZXVlIGxv
Y2sgb2YgdGhlIHVuaXRzIGJlaW5nIHVucGFya2VkLCBhbmQgd2UgY2FuJ3QKICAgICAgKiB0YWtl
IGFueSBydW5xdWV1ZSBsb2NrcyB3aGlsZSB3ZSBob2xkIGEgYnVkZ2V0X2xvY2suCiAgICAgICov
CiAgICAgaWYgKCBzZG9tLT5idWRnZXQgPiAwICkKLSAgICAgICAgbGlzdF9zcGxpY2VfaW5pdCgm
c2RvbS0+cGFya2VkX3ZjcHVzLCBwYXJrZWQpOworICAgICAgICBsaXN0X3NwbGljZV9pbml0KCZz
ZG9tLT5wYXJrZWRfdW5pdHMsIHBhcmtlZCk7CiAKICAgICBzcGluX3VubG9jaygmc2RvbS0+YnVk
Z2V0X2xvY2spOwogfQogCiBzdGF0aWMgdm9pZAotdW5wYXJrX3BhcmtlZF92Y3B1cyhjb25zdCBz
dHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBsaXN0X2hlYWQgKnZjcHVzKQordW5wYXJrX3Bh
cmtlZF91bml0cyhjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBsaXN0X2hlYWQg
KnVuaXRzKQogewogICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YywgKnRtcDsKICAgICBzcGlu
bG9ja190ICpsb2NrOwogCi0gICAgbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKHN2YywgdG1wLCB2
Y3B1cywgcGFya2VkX2VsZW0pCisgICAgbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlICggc3ZjLCB0
bXAsIHVuaXRzLCBwYXJrZWRfZWxlbSApCiAgICAgewogICAgICAgICB1bnNpZ25lZCBsb25nIGZs
YWdzOwogICAgICAgICBzX3RpbWVfdCBub3c7CiAKLSAgICAgICAgbG9jayA9IHVuaXRfc2NoZWR1
bGVfbG9ja19pcnFzYXZlKHN2Yy0+dmNwdS0+c2NoZWRfdW5pdCwgJmZsYWdzKTsKKyAgICAgICAg
bG9jayA9IHVuaXRfc2NoZWR1bGVfbG9ja19pcnFzYXZlKHN2Yy0+dW5pdCwgJmZsYWdzKTsKIAot
ICAgICAgICBfX2NsZWFyX2JpdChfVlBGX3BhcmtlZCwgJnN2Yy0+dmNwdS0+cGF1c2VfZmxhZ3Mp
OworICAgICAgICBzY2hlZF9jbGVhcl9wYXVzZV9mbGFncyhzdmMtPnVuaXQsIF9WUEZfcGFya2Vk
KTsKICAgICAgICAgaWYgKCB1bmxpa2VseShzdmMtPmZsYWdzICYgQ1NGTEFHX3NjaGVkdWxlZCkg
KQogICAgICAgICB7CiAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICogV2UgZW5kIGhlcmUg
aWYgYSBidWRnZXQgcmVwbGVuaXNobWVudCBhcnJpdmVkIGJldHdlZW4KICAgICAgICAgICAgICAq
IGNzY2hlZDJfc2NoZWR1bGUoKSAoYW5kLCBpbiBwYXJ0aWN1bGFyLCBhZnRlciBhIGNhbGwgdG8K
LSAgICAgICAgICAgICAqIHZjcHVfZ3JhYl9idWRnZXQoKSB0aGF0IHJldHVybmVkIGZhbHNlKSwg
YW5kCisgICAgICAgICAgICAgKiB1bml0X2dyYWJfYnVkZ2V0KCkgdGhhdCByZXR1cm5lZCBmYWxz
ZSksIGFuZAogICAgICAgICAgICAgICogY29udGV4dF9zYXZlZCgpLiBCeSBzZXR0aW5nIF9fQ1NG
TEFHX2RlbGF5ZWRfcnVucV9hZGQsCi0gICAgICAgICAgICAgKiB3ZSB0ZWxsIGNvbnRleHRfc2F2
ZWQoKSB0byBwdXQgdGhlIHZDUFUgYmFjayBpbiB0aGUKKyAgICAgICAgICAgICAqIHdlIHRlbGwg
Y29udGV4dF9zYXZlZCgpIHRvIHB1dCB0aGUgdW5pdCBiYWNrIGluIHRoZQogICAgICAgICAgICAg
ICogcnVucXVldWUsIGZyb20gd2hlcmUgaXQgd2lsbCBjb21wZXRlIHdpdGggdGhlIG90aGVycwog
ICAgICAgICAgICAgICogZm9yIHRoZSBuZXdseSByZXBsZW5pc2hlZCBidWRnZXQuCiAgICAgICAg
ICAgICAgKi8KICAgICAgICAgICAgIEFTU0VSVCggc3ZjLT5ycWQgIT0gTlVMTCApOwotICAgICAg
ICAgICAgQVNTRVJUKCBjMnJxZChvcHMsIHN2Yy0+dmNwdS0+cHJvY2Vzc29yKSA9PSBzdmMtPnJx
ZCApOworICAgICAgICAgICAgQVNTRVJUKCBjMnJxZChvcHMsIHNjaGVkX3VuaXRfY3B1KHN2Yy0+
dW5pdCkpID09IHN2Yy0+cnFkICk7CiAgICAgICAgICAgICBfX3NldF9iaXQoX19DU0ZMQUdfZGVs
YXllZF9ydW5xX2FkZCwgJnN2Yy0+ZmxhZ3MpOwogICAgICAgICB9Ci0gICAgICAgIGVsc2UgaWYg
KCB2Y3B1X3J1bm5hYmxlKHN2Yy0+dmNwdSkgKQorICAgICAgICBlbHNlIGlmICggdW5pdF9ydW5u
YWJsZShzdmMtPnVuaXQpICkKICAgICAgICAgewogICAgICAgICAgICAgLyoKLSAgICAgICAgICAg
ICAqIFRoZSB2Q1BVIHNob3VsZCBnbyBiYWNrIHRvIHRoZSBydW5xdWV1ZSwgYW5kIGNvbXBldGUg
Zm9yCisgICAgICAgICAgICAgKiBUaGUgdW5pdCBzaG91bGQgZ28gYmFjayB0byB0aGUgcnVucXVl
dWUsIGFuZCBjb21wZXRlIGZvcgogICAgICAgICAgICAgICogdGhlIG5ld2x5IHJlcGxlbmlzaGVk
IGJ1ZGdldCwgYnV0IG9ubHkgaWYgaXQgaXMgYWN0dWFsbHkKICAgICAgICAgICAgICAqIHJ1bm5h
YmxlIChhbmQgd2FzIHRoZXJlZm9yZSBvZmZsaW5lIG9ubHkgYmVjYXVzZSBvZiB0aGUKICAgICAg
ICAgICAgICAqIGxhY2sgb2YgYnVkZ2V0KS4KQEAgLTE5MjUsNyArMTkyNSw3IEBAIHVucGFya19w
YXJrZWRfdmNwdXMoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgbGlzdF9oZWFk
ICp2Y3B1cykKICAgICAgICAgfQogICAgICAgICBsaXN0X2RlbF9pbml0KCZzdmMtPnBhcmtlZF9l
bGVtKTsKIAotICAgICAgICB1bml0X3NjaGVkdWxlX3VubG9ja19pcnFyZXN0b3JlKGxvY2ssIGZs
YWdzLCBzdmMtPnZjcHUtPnNjaGVkX3VuaXQpOworICAgICAgICB1bml0X3NjaGVkdWxlX3VubG9j
a19pcnFyZXN0b3JlKGxvY2ssIGZsYWdzLCBzdmMtPnVuaXQpOwogICAgIH0KIH0KIApAQCAtMTk1
NSw3ICsxOTU1LDcgQEAgc3RhdGljIHZvaWQgcmVwbGVuaXNoX2RvbWFpbl9idWRnZXQodm9pZCog
ZGF0YSkKICAgICAgKgogICAgICAqIEV2ZW4gaW4gY2FzZXMgb2Ygb3ZlcnJ1biBvciBkZWxheSwg
aG93ZXZlciwgd2UgZXhwZWN0IHRoYXQgaW4gOTklIG9mCiAgICAgICogY2FzZXMsIGRvaW5nIGp1
c3Qgb25lIHJlcGxlbmlzaG1lbnQgd2lsbCBiZSBnb29kIGVub3VnaCBmb3IgYmVpbmcgYWJsZQot
ICAgICAqIHRvIHVucGFyayB0aGUgdkNQVXMgdGhhdCBhcmUgd2FpdGluZyBmb3Igc29tZSBidWRn
ZXQuCisgICAgICogdG8gdW5wYXJrIHRoZSB1bml0cyB0aGF0IGFyZSB3YWl0aW5nIGZvciBzb21l
IGJ1ZGdldC4KICAgICAgKi8KICAgICBkb19yZXBsZW5pc2goc2RvbSk7CiAKQEAgLTE5NzUsNyAr
MTk3NSw3IEBAIHN0YXRpYyB2b2lkIHJlcGxlbmlzaF9kb21haW5fYnVkZ2V0KHZvaWQqIGRhdGEp
CiAgICAgfQogICAgIC8qCiAgICAgICogMikgaWYgd2Ugb3ZlcnJ1biBieSBtb3JlIHRoYW4gdG90
X2J1ZGdldCwgdGhlbiBidWRnZXQrdG90X2J1ZGdldCBpcwotICAgICAqIHN0aWxsIDwgMCwgd2hp
Y2ggbWVhbnMgdGhhdCB3ZSBjYW4ndCB1bnBhcmsgdGhlIHZDUFVzLiBMZXQncyBiYWlsLAorICAg
ICAqIHN0aWxsIDwgMCwgd2hpY2ggbWVhbnMgdGhhdCB3ZSBjYW4ndCB1bnBhcmsgdGhlIHVuaXRz
LiBMZXQncyBiYWlsLAogICAgICAqIGFuZCB3YWl0IGZvciBmdXR1cmUgcmVwbGVuaXNobWVudHMu
CiAgICAgICovCiAgICAgaWYgKCB1bmxpa2VseShzZG9tLT5idWRnZXQgPD0gMCkgKQpAQCAtMTk4
OSwxNCArMTk4OSwxNCBAQCBzdGF0aWMgdm9pZCByZXBsZW5pc2hfZG9tYWluX2J1ZGdldCh2b2lk
KiBkYXRhKQogCiAgICAgLyoKICAgICAgKiBBcyBhYm92ZSwgbGV0J3MgcHJlcGFyZSB0aGUgdGVt
cG9yYXJ5IGxpc3QsIG91dCBvZiB0aGUgZG9tYWluJ3MKLSAgICAgKiBwYXJrZWRfdmNwdXMgbGlz
dCwgbm93IHRoYXQgd2UgaG9sZCB0aGUgYnVkZ2V0X2xvY2suIFRoZW4sIGRyb3Agc3VjaAorICAg
ICAqIHBhcmtlZF91bml0cyBsaXN0LCBub3cgdGhhdCB3ZSBob2xkIHRoZSBidWRnZXRfbG9jay4g
VGhlbiwgZHJvcCBzdWNoCiAgICAgICogbG9jaywgYW5kIHBhc3MgdGhlIGxpc3QgdG8gdGhlIHVu
cGFya2luZyBmdW5jdGlvbi4KICAgICAgKi8KLSAgICBsaXN0X3NwbGljZV9pbml0KCZzZG9tLT5w
YXJrZWRfdmNwdXMsICZwYXJrZWQpOworICAgIGxpc3Rfc3BsaWNlX2luaXQoJnNkb20tPnBhcmtl
ZF91bml0cywgJnBhcmtlZCk7CiAKICAgICBzcGluX3VubG9ja19pcnFyZXN0b3JlKCZzZG9tLT5i
dWRnZXRfbG9jaywgZmxhZ3MpOwogCi0gICAgdW5wYXJrX3BhcmtlZF92Y3B1cyhzZG9tLT5kb20t
PmNwdXBvb2wtPnNjaGVkLCAmcGFya2VkKTsKKyAgICB1bnBhcmtfcGFya2VkX3VuaXRzKHNkb20t
PmRvbS0+Y3B1cG9vbC0+c2NoZWQsICZwYXJrZWQpOwogCiAgb3V0OgogICAgIHNldF90aW1lcigm
c2RvbS0+cmVwbF90aW1lciwgc2RvbS0+bmV4dF9yZXBsKTsKQEAgLTIwMDQsMzcgKzIwMDQsMzYg
QEAgc3RhdGljIHZvaWQgcmVwbGVuaXNoX2RvbWFpbl9idWRnZXQodm9pZCogZGF0YSkKIAogI2lm
bmRlZiBOREVCVUcKIHN0YXRpYyBpbmxpbmUgdm9pZAotY3NjaGVkMl92Y3B1X2NoZWNrKHN0cnVj
dCB2Y3B1ICp2YykKK2NzY2hlZDJfdW5pdF9jaGVjayhzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkK
IHsKLSAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICogY29uc3Qgc3ZjID0gY3NjaGVkMl91bml0KHZj
LT5zY2hlZF91bml0KTsKKyAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICogY29uc3Qgc3ZjID0gY3Nj
aGVkMl91bml0KHVuaXQpOwogICAgIHN0cnVjdCBjc2NoZWQyX2RvbSAqIGNvbnN0IHNkb20gPSBz
dmMtPnNkb207CiAKLSAgICBCVUdfT04oIHN2Yy0+dmNwdSAhPSB2YyApOwotICAgIEJVR19PTigg
c2RvbSAhPSBjc2NoZWQyX2RvbSh2Yy0+ZG9tYWluKSApOworICAgIEJVR19PTiggc3ZjLT51bml0
ICE9IHVuaXQgKTsKKyAgICBCVUdfT04oIHNkb20gIT0gY3NjaGVkMl9kb20odW5pdC0+ZG9tYWlu
KSApOwogICAgIGlmICggc2RvbSApCiAgICAgewotICAgICAgICBCVUdfT04oIGlzX2lkbGVfdmNw
dSh2YykgKTsKLSAgICAgICAgQlVHX09OKCBzZG9tLT5kb20gIT0gdmMtPmRvbWFpbiApOworICAg
ICAgICBCVUdfT04oIGlzX2lkbGVfdW5pdCh1bml0KSApOworICAgICAgICBCVUdfT04oIHNkb20t
PmRvbSAhPSB1bml0LT5kb21haW4gKTsKICAgICB9CiAgICAgZWxzZQogICAgIHsKLSAgICAgICAg
QlVHX09OKCAhaXNfaWRsZV92Y3B1KHZjKSApOworICAgICAgICBCVUdfT04oICFpc19pZGxlX3Vu
aXQodW5pdCkgKTsKICAgICB9CiAgICAgU0NIRURfU1RBVF9DUkFOSyh1bml0X2NoZWNrKTsKIH0K
LSNkZWZpbmUgQ1NDSEVEMl9WQ1BVX0NIRUNLKF92YykgIChjc2NoZWQyX3ZjcHVfY2hlY2soX3Zj
KSkKKyNkZWZpbmUgQ1NDSEVEMl9VTklUX0NIRUNLKHVuaXQpICAoY3NjaGVkMl91bml0X2NoZWNr
KHVuaXQpKQogI2Vsc2UKLSNkZWZpbmUgQ1NDSEVEMl9WQ1BVX0NIRUNLKF92YykKKyNkZWZpbmUg
Q1NDSEVEMl9VTklUX0NIRUNLKHVuaXQpCiAjZW5kaWYKIAogc3RhdGljIHZvaWQgKgogY3NjaGVk
Ml9hbGxvY192ZGF0YShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91
bml0ICp1bml0LAogICAgICAgICAgICAgICAgICAgICB2b2lkICpkZCkKIHsKLSAgICBzdHJ1Y3Qg
dmNwdSAqdmMgPSB1bml0LT52Y3B1X2xpc3Q7CiAgICAgc3RydWN0IGNzY2hlZDJfdW5pdCAqc3Zj
OwogCi0gICAgLyogQWxsb2NhdGUgcGVyLVZDUFUgaW5mbyAqLworICAgIC8qIEFsbG9jYXRlIHBl
ci1VTklUIGluZm8gKi8KICAgICBzdmMgPSB4emFsbG9jKHN0cnVjdCBjc2NoZWQyX3VuaXQpOwog
ICAgIGlmICggc3ZjID09IE5VTEwgKQogICAgICAgICByZXR1cm4gTlVMTDsKQEAgLTIwNDMsMTAg
KzIwNDIsMTAgQEAgY3NjaGVkMl9hbGxvY192ZGF0YShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpv
cHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0LAogICAgIElOSVRfTElTVF9IRUFEKCZzdmMtPnJ1
bnFfZWxlbSk7CiAKICAgICBzdmMtPnNkb20gPSBkZDsKLSAgICBzdmMtPnZjcHUgPSB2YzsKKyAg
ICBzdmMtPnVuaXQgPSB1bml0OwogICAgIHN2Yy0+ZmxhZ3MgPSAwVTsKIAotICAgIGlmICggISBp
c19pZGxlX3ZjcHUodmMpICkKKyAgICBpZiAoICEgaXNfaWRsZV91bml0KHVuaXQpICkKICAgICB7
CiAgICAgICAgIEFTU0VSVChzdmMtPnNkb20gIT0gTlVMTCk7CiAgICAgICAgIHN2Yy0+Y3JlZGl0
ID0gQ1NDSEVEMl9DUkVESVRfSU5JVDsKQEAgLTIwNzUsMTkgKzIwNzQsMTggQEAgY3NjaGVkMl9h
bGxvY192ZGF0YShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0
ICp1bml0LAogc3RhdGljIHZvaWQKIGNzY2hlZDJfdW5pdF9zbGVlcChjb25zdCBzdHJ1Y3Qgc2No
ZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogewotICAgIHN0cnVjdCB2Y3B1
ICp2YyA9IHVuaXQtPnZjcHVfbGlzdDsKICAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICogY29uc3Qg
c3ZjID0gY3NjaGVkMl91bml0KHVuaXQpOwogCi0gICAgQVNTRVJUKCFpc19pZGxlX3ZjcHUodmMp
KTsKKyAgICBBU1NFUlQoIWlzX2lkbGVfdW5pdCh1bml0KSk7CiAgICAgU0NIRURfU1RBVF9DUkFO
Syh1bml0X3NsZWVwKTsKIAotICAgIGlmICggY3Vycl9vbl9jcHUodmMtPnByb2Nlc3NvcikgPT0g
dW5pdCApCisgICAgaWYgKCBjdXJyX29uX2NwdShzY2hlZF91bml0X2NwdSh1bml0KSkgPT0gdW5p
dCApCiAgICAgewotICAgICAgICB0aWNrbGVfY3B1KHZjLT5wcm9jZXNzb3IsIHN2Yy0+cnFkKTsK
KyAgICAgICAgdGlja2xlX2NwdShzY2hlZF91bml0X2NwdSh1bml0KSwgc3ZjLT5ycWQpOwogICAg
IH0KLSAgICBlbHNlIGlmICggdmNwdV9vbl9ydW5xKHN2YykgKQorICAgIGVsc2UgaWYgKCB1bml0
X29uX3J1bnEoc3ZjKSApCiAgICAgewotICAgICAgICBBU1NFUlQoc3ZjLT5ycWQgPT0gYzJycWQo
b3BzLCB2Yy0+cHJvY2Vzc29yKSk7CisgICAgICAgIEFTU0VSVChzdmMtPnJxZCA9PSBjMnJxZChv
cHMsIHNjaGVkX3VuaXRfY3B1KHVuaXQpKSk7CiAgICAgICAgIHVwZGF0ZV9sb2FkKG9wcywgc3Zj
LT5ycWQsIHN2YywgLTEsIE5PVygpKTsKICAgICAgICAgcnVucV9yZW1vdmUoc3ZjKTsKICAgICB9
CkBAIC0yMDk4LDE0ICsyMDk2LDEzIEBAIGNzY2hlZDJfdW5pdF9zbGVlcChjb25zdCBzdHJ1Y3Qg
c2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogc3RhdGljIHZvaWQKIGNz
Y2hlZDJfdW5pdF93YWtlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVk
X3VuaXQgKnVuaXQpCiB7Ci0gICAgc3RydWN0IHZjcHUgKnZjID0gdW5pdC0+dmNwdV9saXN0Owog
ICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKiBjb25zdCBzdmMgPSBjc2NoZWQyX3VuaXQodW5pdCk7
Ci0gICAgdW5zaWduZWQgaW50IGNwdSA9IHZjLT5wcm9jZXNzb3I7CisgICAgdW5zaWduZWQgaW50
IGNwdSA9IHNjaGVkX3VuaXRfY3B1KHVuaXQpOwogICAgIHNfdGltZV90IG5vdzsKIAogICAgIEFT
U0VSVChzcGluX2lzX2xvY2tlZChnZXRfc2NoZWRfcmVzKGNwdSktPnNjaGVkdWxlX2xvY2spKTsK
IAotICAgIEFTU0VSVCghaXNfaWRsZV92Y3B1KHZjKSk7CisgICAgQVNTRVJUKCFpc19pZGxlX3Vu
aXQodW5pdCkpOwogCiAgICAgaWYgKCB1bmxpa2VseShjdXJyX29uX2NwdShjcHUpID09IHVuaXQp
ICkKICAgICB7CkBAIC0yMTEzLDE4ICsyMTEwLDE4IEBAIGNzY2hlZDJfdW5pdF93YWtlKGNvbnN0
IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiAgICAgICAg
IGdvdG8gb3V0OwogICAgIH0KIAotICAgIGlmICggdW5saWtlbHkodmNwdV9vbl9ydW5xKHN2Yykp
ICkKKyAgICBpZiAoIHVubGlrZWx5KHVuaXRfb25fcnVucShzdmMpKSApCiAgICAgewogICAgICAg
ICBTQ0hFRF9TVEFUX0NSQU5LKHVuaXRfd2FrZV9vbnJ1bnEpOwogICAgICAgICBnb3RvIG91dDsK
ICAgICB9CiAKLSAgICBpZiAoIGxpa2VseSh2Y3B1X3J1bm5hYmxlKHZjKSkgKQorICAgIGlmICgg
bGlrZWx5KHVuaXRfcnVubmFibGUodW5pdCkpICkKICAgICAgICAgU0NIRURfU1RBVF9DUkFOSyh1
bml0X3dha2VfcnVubmFibGUpOwogICAgIGVsc2UKICAgICAgICAgU0NIRURfU1RBVF9DUkFOSyh1
bml0X3dha2Vfbm90X3J1bm5hYmxlKTsKIAotICAgIC8qIElmIHRoZSBjb250ZXh0IGhhc24ndCBi
ZWVuIHNhdmVkIGZvciB0aGlzIHZjcHUgeWV0LCB3ZSBjYW4ndCBwdXQgaXQgb24KKyAgICAvKiBJ
ZiB0aGUgY29udGV4dCBoYXNuJ3QgYmVlbiBzYXZlZCBmb3IgdGhpcyB1bml0IHlldCwgd2UgY2Fu
J3QgcHV0IGl0IG9uCiAgICAgICogYW5vdGhlciBydW5xdWV1ZS4gIEluc3RlYWQsIHdlIHNldCBh
IGZsYWcgc28gdGhhdCBpdCB3aWxsIGJlIHB1dCBvbiB0aGUgcnVucXVldWUKICAgICAgKiBhZnRl
ciB0aGUgY29udGV4dCBoYXMgYmVlbiBzYXZlZC4gKi8KICAgICBpZiAoIHVubGlrZWx5KHN2Yy0+
ZmxhZ3MgJiBDU0ZMQUdfc2NoZWR1bGVkKSApCkBAIC0yMTM1LDE1ICsyMTMyLDE1IEBAIGNzY2hl
ZDJfdW5pdF93YWtlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX3Vu
aXQgKnVuaXQpCiAKICAgICAvKiBBZGQgaW50byB0aGUgbmV3IHJ1bnF1ZXVlIGlmIG5lY2Vzc2Fy
eSAqLwogICAgIGlmICggc3ZjLT5ycWQgPT0gTlVMTCApCi0gICAgICAgIHJ1bnFfYXNzaWduKG9w
cywgdmMpOworICAgICAgICBydW5xX2Fzc2lnbihvcHMsIHVuaXQpOwogICAgIGVsc2UKLSAgICAg
ICAgQVNTRVJUKGMycnFkKG9wcywgdmMtPnByb2Nlc3NvcikgPT0gc3ZjLT5ycWQgKTsKKyAgICAg
ICAgQVNTRVJUKGMycnFkKG9wcywgc2NoZWRfdW5pdF9jcHUodW5pdCkpID09IHN2Yy0+cnFkICk7
CiAKICAgICBub3cgPSBOT1coKTsKIAogICAgIHVwZGF0ZV9sb2FkKG9wcywgc3ZjLT5ycWQsIHN2
YywgMSwgbm93KTsKLSAgICAgICAgCi0gICAgLyogUHV0IHRoZSBWQ1BVIG9uIHRoZSBydW5xICov
CisKKyAgICAvKiBQdXQgdGhlIFVOSVQgb24gdGhlIHJ1bnEgKi8KICAgICBydW5xX2luc2VydChv
cHMsIHN2Yyk7CiAgICAgcnVucV90aWNrbGUob3BzLCBzdmMsIG5vdyk7CiAKQEAgLTIxNTYsNDkg
KzIxNTMsNDggQEAgY3NjaGVkMl91bml0X3lpZWxkKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9w
cywgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiB7CiAgICAgc3RydWN0IGNzY2hlZDJfdW5pdCAq
IGNvbnN0IHN2YyA9IGNzY2hlZDJfdW5pdCh1bml0KTsKIAotICAgIF9fc2V0X2JpdChfX0NTRkxB
R192Y3B1X3lpZWxkLCAmc3ZjLT5mbGFncyk7CisgICAgX19zZXRfYml0KF9fQ1NGTEFHX3VuaXRf
eWllbGQsICZzdmMtPmZsYWdzKTsKIH0KIAogc3RhdGljIHZvaWQKIGNzY2hlZDJfY29udGV4dF9z
YXZlZChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0
KQogewotICAgIHN0cnVjdCB2Y3B1ICp2YyA9IHVuaXQtPnZjcHVfbGlzdDsKICAgICBzdHJ1Y3Qg
Y3NjaGVkMl91bml0ICogY29uc3Qgc3ZjID0gY3NjaGVkMl91bml0KHVuaXQpOwogICAgIHNwaW5s
b2NrX3QgKmxvY2sgPSB1bml0X3NjaGVkdWxlX2xvY2tfaXJxKHVuaXQpOwogICAgIHNfdGltZV90
IG5vdyA9IE5PVygpOwogICAgIExJU1RfSEVBRCh3ZXJlX3BhcmtlZCk7CiAKLSAgICBCVUdfT04o
ICFpc19pZGxlX3ZjcHUodmMpICYmIHN2Yy0+cnFkICE9IGMycnFkKG9wcywgdmMtPnByb2Nlc3Nv
cikpOwotICAgIEFTU0VSVChpc19pZGxlX3ZjcHUodmMpIHx8IHN2Yy0+cnFkID09IGMycnFkKG9w
cywgdmMtPnByb2Nlc3NvcikpOworICAgIEJVR19PTiggIWlzX2lkbGVfdW5pdCh1bml0KSAmJiBz
dmMtPnJxZCAhPSBjMnJxZChvcHMsIHNjaGVkX3VuaXRfY3B1KHVuaXQpKSk7CisgICAgQVNTRVJU
KGlzX2lkbGVfdW5pdCh1bml0KSB8fCBzdmMtPnJxZCA9PSBjMnJxZChvcHMsIHNjaGVkX3VuaXRf
Y3B1KHVuaXQpKSk7CiAKLSAgICAvKiBUaGlzIHZjcHUgaXMgbm93IGVsaWdpYmxlIHRvIGJlIHB1
dCBvbiB0aGUgcnVucXVldWUgYWdhaW4gKi8KKyAgICAvKiBUaGlzIHVuaXQgaXMgbm93IGVsaWdp
YmxlIHRvIGJlIHB1dCBvbiB0aGUgcnVucXVldWUgYWdhaW4gKi8KICAgICBfX2NsZWFyX2JpdChf
X0NTRkxBR19zY2hlZHVsZWQsICZzdmMtPmZsYWdzKTsKIAogICAgIGlmICggdW5saWtlbHkoaGFz
X2NhcChzdmMpICYmIHN2Yy0+YnVkZ2V0ID4gMCkgKQotICAgICAgICB2Y3B1X3JldHVybl9idWRn
ZXQoc3ZjLCAmd2VyZV9wYXJrZWQpOworICAgICAgICB1bml0X3JldHVybl9idWRnZXQoc3ZjLCAm
d2VyZV9wYXJrZWQpOwogCiAgICAgLyogSWYgc29tZW9uZSB3YW50cyBpdCBvbiB0aGUgcnVucXVl
dWUsIHB1dCBpdCB0aGVyZS4gKi8KICAgICAvKgogICAgICAqIE5COiBXZSBjYW4gZ2V0IHJpZCBv
ZiBDU0ZMQUdfc2NoZWR1bGVkIGJ5IGNoZWNraW5nIGZvcgotICAgICAqIHZjLT5pc19ydW5uaW5n
IGFuZCB2Y3B1X29uX3J1bnEoc3ZjKSBoZXJlLiAgSG93ZXZlciwKKyAgICAgKiB2Yy0+aXNfcnVu
bmluZyBhbmQgdW5pdF9vbl9ydW5xKHN2YykgaGVyZS4gIEhvd2V2ZXIsCiAgICAgICogc2luY2Ug
d2UncmUgYWNjZXNzaW5nIHRoZSBmbGFncyBjYWNoZWxpbmUgYW55d2F5LAogICAgICAqIGl0IHNl
ZW1zIGEgYml0IHBvaW50bGVzczsgZXNwZWNpYWxseSBhcyB3ZSBoYXZlIHBsZW50eSBvZgogICAg
ICAqIGJpdHMgZnJlZS4KICAgICAgKi8KICAgICBpZiAoIF9fdGVzdF9hbmRfY2xlYXJfYml0KF9f
Q1NGTEFHX2RlbGF5ZWRfcnVucV9hZGQsICZzdmMtPmZsYWdzKQotICAgICAgICAgJiYgbGlrZWx5
KHZjcHVfcnVubmFibGUodmMpKSApCisgICAgICAgICAmJiBsaWtlbHkodW5pdF9ydW5uYWJsZSh1
bml0KSkgKQogICAgIHsKLSAgICAgICAgQVNTRVJUKCF2Y3B1X29uX3J1bnEoc3ZjKSk7CisgICAg
ICAgIEFTU0VSVCghdW5pdF9vbl9ydW5xKHN2YykpOwogCiAgICAgICAgIHJ1bnFfaW5zZXJ0KG9w
cywgc3ZjKTsKICAgICAgICAgcnVucV90aWNrbGUob3BzLCBzdmMsIG5vdyk7CiAgICAgfQotICAg
IGVsc2UgaWYgKCAhaXNfaWRsZV92Y3B1KHZjKSApCisgICAgZWxzZSBpZiAoICFpc19pZGxlX3Vu
aXQodW5pdCkgKQogICAgICAgICB1cGRhdGVfbG9hZChvcHMsIHN2Yy0+cnFkLCBzdmMsIC0xLCBu
b3cpOwogCiAgICAgdW5pdF9zY2hlZHVsZV91bmxvY2tfaXJxKGxvY2ssIHVuaXQpOwogCi0gICAg
dW5wYXJrX3BhcmtlZF92Y3B1cyhvcHMsICZ3ZXJlX3BhcmtlZCk7CisgICAgdW5wYXJrX3Bhcmtl
ZF91bml0cyhvcHMsICZ3ZXJlX3BhcmtlZCk7CiB9CiAKICNkZWZpbmUgTUFYX0xPQUQgKFNUSU1F
X01BWCkKQEAgLTIyMDYsOSArMjIwMiw4IEBAIHN0YXRpYyBzdHJ1Y3Qgc2NoZWRfcmVzb3VyY2Ug
KgogY3NjaGVkMl9yZXNfcGljayhjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGNvbnN0IHN0
cnVjdCBzY2hlZF91bml0ICp1bml0KQogewogICAgIHN0cnVjdCBjc2NoZWQyX3ByaXZhdGUgKnBy
diA9IGNzY2hlZDJfcHJpdihvcHMpOwotICAgIHN0cnVjdCB2Y3B1ICp2YyA9IHVuaXQtPnZjcHVf
bGlzdDsKICAgICBpbnQgaSwgbWluX3JxaSA9IC0xLCBtaW5fc19ycWkgPSAtMTsKLSAgICB1bnNp
Z25lZCBpbnQgbmV3X2NwdSwgY3B1ID0gdmMtPnByb2Nlc3NvcjsKKyAgICB1bnNpZ25lZCBpbnQg
bmV3X2NwdSwgY3B1ID0gc2NoZWRfdW5pdF9jcHUodW5pdCk7CiAgICAgc3RydWN0IGNzY2hlZDJf
dW5pdCAqc3ZjID0gY3NjaGVkMl91bml0KHVuaXQpOwogICAgIHNfdGltZV90IG1pbl9hdmdsb2Fk
ID0gTUFYX0xPQUQsIG1pbl9zX2F2Z2xvYWQgPSBNQVhfTE9BRDsKICAgICBib29sIGhhc19zb2Z0
OwpAQCAtMjI0Niw3ICsyMjQxLDcgQEAgY3NjaGVkMl9yZXNfcGljayhjb25zdCBzdHJ1Y3Qgc2No
ZWR1bGVyICpvcHMsIGNvbnN0IHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogICAgIH0KIAogICAg
IGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwgdW5pdC0+Y3B1X2hhcmRfYWZm
aW5pdHksCi0gICAgICAgICAgICAgICAgY3B1cG9vbF9kb21haW5fY3B1bWFzayh2Yy0+ZG9tYWlu
KSk7CisgICAgICAgICAgICAgICAgY3B1cG9vbF9kb21haW5fY3B1bWFzayh1bml0LT5kb21haW4p
KTsKIAogICAgIC8qCiAgICAgICogRmlyc3QgY2hlY2sgdG8gc2VlIGlmIHdlJ3JlIGhlcmUgYmVj
YXVzZSBzb21lb25lIGVsc2Ugc3VnZ2VzdGVkIGEgcGxhY2UKQEAgLTIzNTcsNyArMjM1Miw3IEBA
IGNzY2hlZDJfcmVzX3BpY2soY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBjb25zdCBzdHJ1
Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKICAgICAgICAgICogV2UgaGF2ZSBzb2Z0IGFmZmluaXR5LCBh
bmQgd2UgaGF2ZSBhIGNhbmRpZGF0ZSBydW5xLCBzbyBnbyBmb3IgaXQuCiAgICAgICAgICAqCiAg
ICAgICAgICAqIE5vdGUgdGhhdCwgdG8gb2J0YWluIHRoZSBzb2Z0LWFmZmluaXR5IG1hc2ssIHdl
ICJqdXN0IiBwdXQgd2hhdCB3ZQotICAgICAgICAgKiBoYXZlIGluIGNwdW1hc2tfc2NyYXRjaCBp
biAmJiB3aXRoIHZjLT5jcHVfc29mdF9hZmZpbml0eS4gVGhpcyBpcworICAgICAgICAgKiBoYXZl
IGluIGNwdW1hc2tfc2NyYXRjaCBpbiAmJiB3aXRoIHVuaXQtPmNwdV9zb2Z0X2FmZmluaXR5LiBU
aGlzIGlzCiAgICAgICAgICAqIG9rIGJlY2F1c2U6CiAgICAgICAgICAqIC0gd2Uga25vdyB0aGF0
IHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5IGFuZCAtPmNwdV9zb2Z0X2FmZmluaXR5IGhhdmUKICAg
ICAgICAgICogICBhIG5vbi1lbXB0eSBpbnRlcnNlY3Rpb24gKGJlY2F1c2UgaGFzX3NvZnQgaXMg
dHJ1ZSk7CkBAIC0yMzgwLDcgKzIzNzUsNyBAQCBjc2NoZWQyX3Jlc19waWNrKGNvbnN0IHN0cnVj
dCBzY2hlZHVsZXIgKm9wcywgY29uc3Qgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiAgICAgICAg
ICAqIGFueSBzdWl0YWJsZSBydW5xLiBCdXQgd2UgZGlkIGZpbmQgb25lIHdoZW4gY29uc2lkZXJp
bmcgaGFyZAogICAgICAgICAgKiBhZmZpbml0eSwgc28gZ28gZm9yIGl0LgogICAgICAgICAgKgot
ICAgICAgICAgKiBjcHVtYXNrX3NjcmF0Y2ggYWxyZWFkeSBoYXMgdmMtPmNwdV9oYXJkX2FmZmlu
aXR5ICYKKyAgICAgICAgICogY3B1bWFza19zY3JhdGNoIGFscmVhZHkgaGFzIHVuaXQtPmNwdV9o
YXJkX2FmZmluaXR5ICYKICAgICAgICAgICogY3B1cG9vbF9kb21haW5fY3B1bWFzaygpIGluIGl0
LCBzbyBpdCdzIGVub3VnaCB0aGF0IHdlIGZpbHRlcgogICAgICAgICAgKiB3aXRoIHRoZSBjcHVz
IG9mIHRoZSBydW5xLgogICAgICAgICAgKi8KQEAgLTI0MTEsMTEgKzI0MDYsMTEgQEAgY3NjaGVk
Ml9yZXNfcGljayhjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGNvbnN0IHN0cnVjdCBzY2hl
ZF91bml0ICp1bml0KQogICAgIHsKICAgICAgICAgc3RydWN0IHsKICAgICAgICAgICAgIHVpbnQ2
NF90IGJfYXZnbG9hZDsKLSAgICAgICAgICAgIHVuc2lnbmVkIHZjcHU6MTYsIGRvbToxNjsKKyAg
ICAgICAgICAgIHVuc2lnbmVkIHVuaXQ6MTYsIGRvbToxNjsKICAgICAgICAgICAgIHVuc2lnbmVk
IHJxX2lkOjE2LCBuZXdfY3B1OjE2OwogICAgICAgICB9IGQ7Ci0gICAgICAgIGQuZG9tID0gdmMt
PmRvbWFpbi0+ZG9tYWluX2lkOwotICAgICAgICBkLnZjcHUgPSB2Yy0+dmNwdV9pZDsKKyAgICAg
ICAgZC5kb20gPSB1bml0LT5kb21haW4tPmRvbWFpbl9pZDsKKyAgICAgICAgZC51bml0ID0gdW5p
dC0+dW5pdF9pZDsKICAgICAgICAgZC5ycV9pZCA9IG1pbl9ycWk7CiAgICAgICAgIGQuYl9hdmds
b2FkID0gbWluX2F2Z2xvYWQ7CiAgICAgICAgIGQubmV3X2NwdSA9IG5ld19jcHU7CkBAIC0yNDM0
LDEwICsyNDI5LDEwIEBAIHR5cGVkZWYgc3RydWN0IHsKICAgICBzdHJ1Y3QgY3NjaGVkMl91bml0
ICogYmVzdF9wdXNoX3N2YywgKmJlc3RfcHVsbF9zdmM7CiAgICAgLyogTkI6IFJlYWQgYnkgY29u
c2lkZXIoKSAqLwogICAgIHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKmxycWQ7Ci0gICAg
c3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqb3JxZDsgICAgICAgICAgICAgICAgICAKKyAg
ICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpvcnFkOwogfSBiYWxhbmNlX3N0YXRlX3Q7
CiAKLXN0YXRpYyB2b2lkIGNvbnNpZGVyKGJhbGFuY2Vfc3RhdGVfdCAqc3QsIAorc3RhdGljIHZv
aWQgY29uc2lkZXIoYmFsYW5jZV9zdGF0ZV90ICpzdCwKICAgICAgICAgICAgICAgICAgICAgIHN0
cnVjdCBjc2NoZWQyX3VuaXQgKnB1c2hfc3ZjLAogICAgICAgICAgICAgICAgICAgICAgc3RydWN0
IGNzY2hlZDJfdW5pdCAqcHVsbF9zdmMpCiB7CkBAIC0yNDc2LDE3ICsyNDcxLDE3IEBAIHN0YXRp
YyB2b2lkIG1pZ3JhdGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAgICAgICAgICAg
ICAgICAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICp0cnFkLAogICAgICAgICAgICAg
ICAgICAgICBzX3RpbWVfdCBub3cpCiB7Ci0gICAgaW50IGNwdSA9IHN2Yy0+dmNwdS0+cHJvY2Vz
c29yOwotICAgIHN0cnVjdCBzY2hlZF91bml0ICp1bml0ID0gc3ZjLT52Y3B1LT5zY2hlZF91bml0
OworICAgIHN0cnVjdCBzY2hlZF91bml0ICp1bml0ID0gc3ZjLT51bml0OworICAgIGludCBjcHUg
PSBzY2hlZF91bml0X2NwdSh1bml0KTsKIAogICAgIGlmICggdW5saWtlbHkodGJfaW5pdF9kb25l
KSApCiAgICAgewogICAgICAgICBzdHJ1Y3QgewotICAgICAgICAgICAgdW5zaWduZWQgdmNwdTox
NiwgZG9tOjE2OworICAgICAgICAgICAgdW5zaWduZWQgdW5pdDoxNiwgZG9tOjE2OwogICAgICAg
ICAgICAgdW5zaWduZWQgcnFpOjE2LCB0cnFpOjE2OwogICAgICAgICB9IGQ7Ci0gICAgICAgIGQu
ZG9tID0gc3ZjLT52Y3B1LT5kb21haW4tPmRvbWFpbl9pZDsKLSAgICAgICAgZC52Y3B1ID0gc3Zj
LT52Y3B1LT52Y3B1X2lkOworICAgICAgICBkLmRvbSA9IHVuaXQtPmRvbWFpbi0+ZG9tYWluX2lk
OworICAgICAgICBkLnVuaXQgPSB1bml0LT51bml0X2lkOwogICAgICAgICBkLnJxaSA9IHN2Yy0+
cnFkLT5pZDsKICAgICAgICAgZC50cnFpID0gdHJxZC0+aWQ7CiAgICAgICAgIF9fdHJhY2VfdmFy
KFRSQ19DU0NIRUQyX01JR1JBVEUsIDEsCkBAIC0yNDk4LDcgKzI0OTMsNyBAQCBzdGF0aWMgdm9p
ZCBtaWdyYXRlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKICAgICB7CiAgICAgICAgIC8q
IEl0J3MgcnVubmluZzsgbWFyayBpdCB0byBtaWdyYXRlLiAqLwogICAgICAgICBzdmMtPm1pZ3Jh
dGVfcnFkID0gdHJxZDsKLSAgICAgICAgX19zZXRfYml0KF9WUEZfbWlncmF0aW5nLCAmc3ZjLT52
Y3B1LT5wYXVzZV9mbGFncyk7CisgICAgICAgIHNjaGVkX3NldF9wYXVzZV9mbGFncyh1bml0LCBf
VlBGX21pZ3JhdGluZyk7CiAgICAgICAgIF9fc2V0X2JpdChfX0NTRkxBR19ydW5xX21pZ3JhdGVf
cmVxdWVzdCwgJnN2Yy0+ZmxhZ3MpOwogICAgICAgICBTQ0hFRF9TVEFUX0NSQU5LKG1pZ3JhdGVf
cmVxdWVzdGVkKTsKICAgICAgICAgdGlja2xlX2NwdShjcHUsIHN2Yy0+cnFkKTsKQEAgLTI1MDcs
NyArMjUwMiw3IEBAIHN0YXRpYyB2b2lkIG1pZ3JhdGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAq
b3BzLAogICAgIHsKICAgICAgICAgaW50IG9uX3J1bnEgPSAwOwogICAgICAgICAvKiBJdCdzIG5v
dCBydW5uaW5nOyBqdXN0IG1vdmUgaXQgKi8KLSAgICAgICAgaWYgKCB2Y3B1X29uX3J1bnEoc3Zj
KSApCisgICAgICAgIGlmICggdW5pdF9vbl9ydW5xKHN2YykgKQogICAgICAgICB7CiAgICAgICAg
ICAgICBydW5xX3JlbW92ZShzdmMpOwogICAgICAgICAgICAgdXBkYXRlX2xvYWQob3BzLCBzdmMt
PnJxZCwgTlVMTCwgLTEsIG5vdyk7CkBAIC0yNTE2LDE0ICsyNTExLDE0IEBAIHN0YXRpYyB2b2lk
IG1pZ3JhdGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAgICAgICBfcnVucV9kZWFz
c2lnbihzdmMpOwogCiAgICAgICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1
KSwgdW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHksCi0gICAgICAgICAgICAgICAgICAgIGNwdXBvb2xf
ZG9tYWluX2NwdW1hc2soc3ZjLT52Y3B1LT5kb21haW4pKTsKKyAgICAgICAgICAgICAgICAgICAg
Y3B1cG9vbF9kb21haW5fY3B1bWFzayh1bml0LT5kb21haW4pKTsKICAgICAgICAgY3B1bWFza19h
bmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksCiAg
ICAgICAgICAgICAgICAgICAgICZ0cnFkLT5hY3RpdmUpOwotICAgICAgICBzdmMtPnZjcHUtPnBy
b2Nlc3NvciA9IGNwdW1hc2tfY3ljbGUodHJxZC0+cGlja19iaWFzLAotICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3B1bWFza19zY3JhdGNoX2NwdShjcHUpKTsK
LSAgICAgICAgc3ZjLT52Y3B1LT5zY2hlZF91bml0LT5yZXMgPSBnZXRfc2NoZWRfcmVzKHN2Yy0+
dmNwdS0+cHJvY2Vzc29yKTsKLSAgICAgICAgdHJxZC0+cGlja19iaWFzID0gc3ZjLT52Y3B1LT5w
cm9jZXNzb3I7Ci0gICAgICAgIEFTU0VSVChzdmMtPnZjcHUtPnByb2Nlc3NvciA8IG5yX2NwdV9p
ZHMpOworICAgICAgICBzY2hlZF9zZXRfcmVzKHVuaXQsCisgICAgICAgICAgICAgICAgICAgICAg
Z2V0X3NjaGVkX3JlcyhjcHVtYXNrX2N5Y2xlKHRycWQtPnBpY2tfYmlhcywKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3B1bWFza19zY3JhdGNoX2Nw
dShjcHUpKSkpOworICAgICAgICB0cnFkLT5waWNrX2JpYXMgPSBzY2hlZF91bml0X2NwdSh1bml0
KTsKKyAgICAgICAgQVNTRVJUKHNjaGVkX3VuaXRfY3B1KHVuaXQpIDwgbnJfY3B1X2lkcyk7CiAK
ICAgICAgICAgX3J1bnFfYXNzaWduKHN2YywgdHJxZCk7CiAgICAgICAgIGlmICggb25fcnVucSAp
CkBAIC0yNTQzLDE0ICsyNTM4LDE0IEBAIHN0YXRpYyB2b2lkIG1pZ3JhdGUoY29uc3Qgc3RydWN0
IHNjaGVkdWxlciAqb3BzLAogICogIC0gc3ZjIGlzIG5vdCBhbHJlYWR5IGZsYWdnZWQgdG8gbWln
cmF0ZSwKICAqICAtIGlmIHN2YyBpcyBhbGxvd2VkIHRvIHJ1biBvbiBhdCBsZWFzdCBvbmUgb2Yg
dGhlIHBjcHVzIG9mIHJxZC4KICAqLwotc3RhdGljIGJvb2wgdmNwdV9pc19taWdyYXRlYWJsZShz
dHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMsCitzdGF0aWMgYm9vbCB1bml0X2lzX21pZ3JhdGVhYmxl
KHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQpCiB7Ci0gICAgc3RydWN0IHZj
cHUgKnYgPSBzdmMtPnZjcHU7Ci0gICAgaW50IGNwdSA9IHN2Yy0+dmNwdS0+cHJvY2Vzc29yOwor
ICAgIHN0cnVjdCBzY2hlZF91bml0ICp1bml0ID0gc3ZjLT51bml0OworICAgIGludCBjcHUgPSBz
Y2hlZF91bml0X2NwdSh1bml0KTsKIAotICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9j
cHUoY3B1KSwgdi0+c2NoZWRfdW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHksCi0gICAgICAgICAgICAg
ICAgY3B1cG9vbF9kb21haW5fY3B1bWFzayh2LT5kb21haW4pKTsKKyAgICBjcHVtYXNrX2FuZChj
cHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksIHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5LAorICAgICAg
ICAgICAgICAgIGNwdXBvb2xfZG9tYWluX2NwdW1hc2sodW5pdC0+ZG9tYWluKSk7CiAKICAgICBy
ZXR1cm4gIShzdmMtPmZsYWdzICYgQ1NGTEFHX3J1bnFfbWlncmF0ZV9yZXF1ZXN0KSAmJgogICAg
ICAgICAgICBjcHVtYXNrX2ludGVyc2VjdHMoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCAmcnFk
LT5hY3RpdmUpOwpAQCAtMjU4Nyw3ICsyNTgyLDcgQEAgcmV0cnk6CiAgICAgZm9yX2VhY2hfY3B1
KGksICZwcnYtPmFjdGl2ZV9xdWV1ZXMpCiAgICAgewogICAgICAgICBzX3RpbWVfdCBkZWx0YTsK
LSAgICAgICAgCisKICAgICAgICAgc3Qub3JxZCA9IHBydi0+cnFkICsgaTsKIAogICAgICAgICBp
ZiAoIHN0Lm9ycWQgPT0gc3QubHJxZApAQCAtMjU5NSw3ICsyNTkwLDcgQEAgcmV0cnk6CiAgICAg
ICAgICAgICBjb250aW51ZTsKIAogICAgICAgICB1cGRhdGVfcnVucV9sb2FkKG9wcywgc3Qub3Jx
ZCwgMCwgbm93KTsKLSAgICAKKwogICAgICAgICBkZWx0YSA9IHN0LmxycWQtPmJfYXZnbG9hZCAt
IHN0Lm9ycWQtPmJfYXZnbG9hZDsKICAgICAgICAgaWYgKCBkZWx0YSA8IDAgKQogICAgICAgICAg
ICAgZGVsdGEgPSAtZGVsdGE7CkBAIC0yNjE4LDcgKzI2MTMsNyBAQCByZXRyeToKICAgICAgICAg
c190aW1lX3QgbG9hZF9tYXg7CiAgICAgICAgIGludCBjcHVzX21heDsKIAotICAgICAgICAKKwog
ICAgICAgICBsb2FkX21heCA9IHN0LmxycWQtPmJfYXZnbG9hZDsKICAgICAgICAgaWYgKCBzdC5v
cnFkLT5iX2F2Z2xvYWQgPiBsb2FkX21heCApCiAgICAgICAgICAgICBsb2FkX21heCA9IHN0Lm9y
cWQtPmJfYXZnbG9hZDsKQEAgLTI2NTcsNyArMjY1Miw3IEBAIHJldHJ5OgogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdF9vdmVybG9hZF9iYWxhbmNlX3RvbGVy
YW5jZSkpICkKICAgICAgICAgICAgICAgICBnb3RvIG91dDsKICAgICB9Ci0gICAgICAgICAgICAg
CisKICAgICAvKiBUcnkgdG8gZ3JhYiB0aGUgb3RoZXIgcnVucXVldWUgbG9jazsgaWYgaXQncyBi
ZWVuIHRha2VuIGluIHRoZQogICAgICAqIG1lYW50aW1lLCB0cnkgdGhlIHByb2Nlc3Mgb3ZlciBh
Z2Fpbi4gIFRoaXMgY2FuJ3QgZGVhZGxvY2sKICAgICAgKiBiZWNhdXNlIGlmIGl0IGRvZXNuJ3Qg
Z2V0IGFueSBvdGhlciBycWQgbG9ja3MsIGl0IHdpbGwgc2ltcGx5CkBAIC0yNjk3LDE3ICsyNjky
LDE3IEBAIHJldHJ5OgogCiAgICAgICAgIHVwZGF0ZV9zdmNfbG9hZChvcHMsIHB1c2hfc3ZjLCAw
LCBub3cpOwogCi0gICAgICAgIGlmICggIXZjcHVfaXNfbWlncmF0ZWFibGUocHVzaF9zdmMsIHN0
Lm9ycWQpICkKKyAgICAgICAgaWYgKCAhdW5pdF9pc19taWdyYXRlYWJsZShwdXNoX3N2Yywgc3Qu
b3JxZCkgKQogICAgICAgICAgICAgY29udGludWU7CiAKICAgICAgICAgbGlzdF9mb3JfZWFjaCgg
cHVsbF9pdGVyLCAmc3Qub3JxZC0+c3ZjICkKICAgICAgICAgewogICAgICAgICAgICAgc3RydWN0
IGNzY2hlZDJfdW5pdCAqIHB1bGxfc3ZjID0gbGlzdF9lbnRyeShwdWxsX2l0ZXIsIHN0cnVjdCBj
c2NoZWQyX3VuaXQsIHJxZF9lbGVtKTsKLSAgICAgICAgICAgIAorCiAgICAgICAgICAgICBpZiAo
ICFpbm5lcl9sb2FkX3VwZGF0ZWQgKQogICAgICAgICAgICAgICAgIHVwZGF0ZV9zdmNfbG9hZChv
cHMsIHB1bGxfc3ZjLCAwLCBub3cpOwotICAgICAgICAKLSAgICAgICAgICAgIGlmICggIXZjcHVf
aXNfbWlncmF0ZWFibGUocHVsbF9zdmMsIHN0LmxycWQpICkKKworICAgICAgICAgICAgaWYgKCAh
dW5pdF9pc19taWdyYXRlYWJsZShwdWxsX3N2Yywgc3QubHJxZCkgKQogICAgICAgICAgICAgICAg
IGNvbnRpbnVlOwogCiAgICAgICAgICAgICBjb25zaWRlcigmc3QsIHB1c2hfc3ZjLCBwdWxsX3N2
Yyk7CkBAIC0yNzIyLDggKzI3MTcsOCBAQCByZXRyeToKICAgICBsaXN0X2Zvcl9lYWNoKCBwdWxs
X2l0ZXIsICZzdC5vcnFkLT5zdmMgKQogICAgIHsKICAgICAgICAgc3RydWN0IGNzY2hlZDJfdW5p
dCAqIHB1bGxfc3ZjID0gbGlzdF9lbnRyeShwdWxsX2l0ZXIsIHN0cnVjdCBjc2NoZWQyX3VuaXQs
IHJxZF9lbGVtKTsKLSAgICAgICAgCi0gICAgICAgIGlmICggIXZjcHVfaXNfbWlncmF0ZWFibGUo
cHVsbF9zdmMsIHN0LmxycWQpICkKKworICAgICAgICBpZiAoICF1bml0X2lzX21pZ3JhdGVhYmxl
KHB1bGxfc3ZjLCBzdC5scnFkKSApCiAgICAgICAgICAgICBjb250aW51ZTsKIAogICAgICAgICAv
KiBDb25zaWRlciBwdWxsIG9ubHkgKi8KQEAgLTI3NDYsOCArMjc0MSw3IEBAIHN0YXRpYyB2b2lk
CiBjc2NoZWQyX3VuaXRfbWlncmF0ZSgKICAgICBjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMs
IHN0cnVjdCBzY2hlZF91bml0ICp1bml0LCB1bnNpZ25lZCBpbnQgbmV3X2NwdSkKIHsKLSAgICBz
dHJ1Y3QgdmNwdSAqdmMgPSB1bml0LT52Y3B1X2xpc3Q7Ci0gICAgc3RydWN0IGRvbWFpbiAqZCA9
IHZjLT5kb21haW47CisgICAgc3RydWN0IGRvbWFpbiAqZCA9IHVuaXQtPmRvbWFpbjsKICAgICBz
dHJ1Y3QgY3NjaGVkMl91bml0ICogY29uc3Qgc3ZjID0gY3NjaGVkMl91bml0KHVuaXQpOwogICAg
IHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnRycWQ7CiAgICAgc190aW1lX3Qgbm93ID0g
Tk9XKCk7CkBAIC0yNzU5LDI1ICsyNzUzLDI0IEBAIGNzY2hlZDJfdW5pdF9taWdyYXRlKAogICAg
ICAqIGNwdXBvb2wuCiAgICAgICoKICAgICAgKiBBbmQgc2luY2UgdGhlcmUgaW5kZWVkIGlzIHRo
ZSBjaGFuY2UgdGhhdCBpdCBpcyBub3QgcGFydCBvZiBpdCwgYWxsCi0gICAgICogd2UgbXVzdCBk
byBpcyByZW1vdmUgX2FuZF8gdW5hc3NpZ24gdGhlIHZDUFUgZnJvbSBhbnkgcnVucXVldWUsIGFz
CisgICAgICogd2UgbXVzdCBkbyBpcyByZW1vdmUgX2FuZF8gdW5hc3NpZ24gdGhlIHVuaXQgZnJv
bSBhbnkgcnVucXVldWUsIGFzCiAgICAgICogd2VsbCBhcyB1cGRhdGluZyB2LT5wcm9jZXNzb3Ig
d2l0aCB0aGUgdGFyZ2V0LCBzbyB0aGF0IHRoZSBzdXNwZW5kCiAgICAgICogcHJvY2VzcyBjYW4g
Y29udGludWUuCiAgICAgICoKICAgICAgKiBJdCB3aWxsIHRoZW4gYmUgZHVyaW5nIHJlc3VtZSB0
aGF0IGEgbmV3LCBtZWFuaW5nZnVsLCB2YWx1ZSBmb3IKICAgICAgKiB2LT5wcm9jZXNzb3Igd2ls
bCBiZSBjaG9zZW4sIGFuZCBkdXJpbmcgYWN0dWFsIGRvbWFpbiB1bnBhdXNlIHRoYXQKLSAgICAg
KiB0aGUgdkNQVSB3aWxsIGJlIGFzc2lnbmVkIHRvIGFuZCBhZGRlZCB0byB0aGUgcHJvcGVyIHJ1
bnF1ZXVlLgorICAgICAqIHRoZSB1bml0IHdpbGwgYmUgYXNzaWduZWQgdG8gYW5kIGFkZGVkIHRv
IHRoZSBwcm9wZXIgcnVucXVldWUuCiAgICAgICovCiAgICAgaWYgKCB1bmxpa2VseSghY3B1bWFz
a190ZXN0X2NwdShuZXdfY3B1LCBjcHVwb29sX2RvbWFpbl9jcHVtYXNrKGQpKSkgKQogICAgIHsK
ICAgICAgICAgQVNTRVJUKHN5c3RlbV9zdGF0ZSA9PSBTWVNfU1RBVEVfc3VzcGVuZCk7Ci0gICAg
ICAgIGlmICggdmNwdV9vbl9ydW5xKHN2YykgKQorICAgICAgICBpZiAoIHVuaXRfb25fcnVucShz
dmMpICkKICAgICAgICAgewogICAgICAgICAgICAgcnVucV9yZW1vdmUoc3ZjKTsKICAgICAgICAg
ICAgIHVwZGF0ZV9sb2FkKG9wcywgc3ZjLT5ycWQsIE5VTEwsIC0xLCBub3cpOwogICAgICAgICB9
CiAgICAgICAgIF9ydW5xX2RlYXNzaWduKHN2Yyk7Ci0gICAgICAgIHZjLT5wcm9jZXNzb3IgPSBu
ZXdfY3B1OwotICAgICAgICB1bml0LT5yZXMgPSBnZXRfc2NoZWRfcmVzKG5ld19jcHUpOworICAg
ICAgICBzY2hlZF9zZXRfcmVzKHVuaXQsIGdldF9zY2hlZF9yZXMobmV3X2NwdSkpOwogICAgICAg
ICByZXR1cm47CiAgICAgfQogCkBAIC0yNzkxLDE3ICsyNzg0LDE0IEBAIGNzY2hlZDJfdW5pdF9t
aWdyYXRlKAogICAgICAqIERvIHRoZSBhY3R1YWwgbW92ZW1lbnQgdG93YXJkIG5ld19jcHUsIGFu
ZCB1cGRhdGUgdmMtPnByb2Nlc3Nvci4KICAgICAgKiBJZiB3ZSBhcmUgY2hhbmdpbmcgcnVucXVl
dWUsIG1pZ3JhdGUoKSB0YWtlcyBjYXJlIG9mIGV2ZXJ5dGhpbmcuCiAgICAgICogSWYgd2UgYXJl
IG5vdCBjaGFuZ2luZyBydW5xdWV1ZSwgd2UgbmVlZCB0byB1cGRhdGUgdmMtPnByb2Nlc3Nvcgot
ICAgICAqIGhlcmUuIEluIGZhY3QsIGlmLCBmb3IgaW5zdGFuY2UsIHdlIGFyZSBoZXJlIGJlY2F1
c2UgdGhlIHZjcHUncworICAgICAqIGhlcmUuIEluIGZhY3QsIGlmLCBmb3IgaW5zdGFuY2UsIHdl
IGFyZSBoZXJlIGJlY2F1c2UgdGhlIHVuaXQncwogICAgICAqIGhhcmQgYWZmaW5pdHkgY2hhbmdl
ZCwgd2UgZG9uJ3Qgd2FudCB0byByaXNrIGxlYXZpbmcgdmMtPnByb2Nlc3NvcgogICAgICAqIHBv
aW50aW5nIHRvIGEgcGNwdSB3aGVyZSB3ZSBjYW4ndCBydW4gYW55IGxvbmdlci4KICAgICAgKi8K
ICAgICBpZiAoIHRycWQgIT0gc3ZjLT5ycWQgKQogICAgICAgICBtaWdyYXRlKG9wcywgc3ZjLCB0
cnFkLCBub3cpOwogICAgIGVsc2UKLSAgICB7Ci0gICAgICAgIHZjLT5wcm9jZXNzb3IgPSBuZXdf
Y3B1OwotICAgICAgICB1bml0LT5yZXMgPSBnZXRfc2NoZWRfcmVzKG5ld19jcHUpOwotICAgIH0K
KyAgICAgICAgc2NoZWRfc2V0X3Jlcyh1bml0LCBnZXRfc2NoZWRfcmVzKG5ld19jcHUpKTsKIH0K
IAogc3RhdGljIGludApAQCAtMjgxMywxOCArMjgwMywxOCBAQCBjc2NoZWQyX2RvbV9jbnRsKAog
ICAgIHN0cnVjdCBjc2NoZWQyX2RvbSAqIGNvbnN0IHNkb20gPSBjc2NoZWQyX2RvbShkKTsKICAg
ICBzdHJ1Y3QgY3NjaGVkMl9wcml2YXRlICpwcnYgPSBjc2NoZWQyX3ByaXYob3BzKTsKICAgICB1
bnNpZ25lZCBsb25nIGZsYWdzOwotICAgIHN0cnVjdCB2Y3B1ICp2OworICAgIHN0cnVjdCBzY2hl
ZF91bml0ICp1bml0OwogICAgIGludCByYyA9IDA7CiAKICAgICAvKgogICAgICAqIExvY2tpbmc6
CiAgICAgICogIC0gd2UgbXVzdCB0YWtlIHRoZSBwcml2YXRlIGxvY2sgZm9yIGFjY2Vzc2luZyB0
aGUgd2VpZ2h0cyBvZiB0aGUKLSAgICAgKiAgICB2Y3B1cyBvZiBkLCBhbmQvb3IgdGhlIGNhcDsK
KyAgICAgKiAgICB1bml0cyBvZiBkLCBhbmQvb3IgdGhlIGNhcDsKICAgICAgKiAgLSBpbiB0aGUg
cHV0aW5mbyBjYXNlLCB3ZSBhbHNvIG5lZWQgdGhlIHJ1bnF1ZXVlIGxvY2socyksIGZvcgogICAg
ICAqICAgIHVwZGF0aW5nIHRoZSBtYXggd2FpZ2h0IG9mIHRoZSBydW5xdWV1ZShzKS4KICAgICAg
KiAgICBJZiBjaGFuZ2luZyB0aGUgY2FwLCB3ZSBhbHNvIG5lZWQgdGhlIGJ1ZGdldF9sb2NrLCBm
b3IgdXBkYXRpbmcKICAgICAgKiAgICB0aGUgdmFsdWUgb2YgdGhlIGRvbWFpbiBidWRnZXQgcG9v
bCAoYW5kIHRoZSBydW5xdWV1ZSBsb2NrLAotICAgICAqICAgIGZvciBhZGp1c3RpbmcgdGhlIHBh
cmFtZXRlcnMgYW5kIHJlc2NoZWR1bGluZyBhbnkgdkNQVSB0aGF0IGlzCisgICAgICogICAgZm9y
IGFkanVzdGluZyB0aGUgcGFyYW1ldGVycyBhbmQgcmVzY2hlZHVsaW5nIGFueSB1bml0IHRoYXQg
aXMKICAgICAgKiAgICBydW5uaW5nIGF0IHRoZSB0aW1lIG9mIHRoZSBjaGFuZ2UpLgogICAgICAq
LwogICAgIHN3aXRjaCAoIG9wLT5jbWQgKQpAQCAtMjg0NiwxOCArMjgzNiwxOCBAQCBjc2NoZWQy
X2RvbV9jbnRsKAogCiAgICAgICAgICAgICBzZG9tLT53ZWlnaHQgPSBvcC0+dS5jcmVkaXQyLndl
aWdodDsKIAotICAgICAgICAgICAgLyogVXBkYXRlIHdlaWdodHMgZm9yIHZjcHVzLCBhbmQgbWF4
X3dlaWdodCBmb3IgcnVucXVldWVzIG9uIHdoaWNoIHRoZXkgcmVzaWRlICovCi0gICAgICAgICAg
ICBmb3JfZWFjaF92Y3B1ICggZCwgdiApCisgICAgICAgICAgICAvKiBVcGRhdGUgd2VpZ2h0cyBm
b3IgdW5pdHMsIGFuZCBtYXhfd2VpZ2h0IGZvciBydW5xdWV1ZXMgb24gd2hpY2ggdGhleSByZXNp
ZGUgKi8KKyAgICAgICAgICAgIGZvcl9lYWNoX3NjaGVkX3VuaXQgKCBkLCB1bml0ICkKICAgICAg
ICAgICAgIHsKLSAgICAgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMgPSBjc2No
ZWQyX3VuaXQodi0+c2NoZWRfdW5pdCk7Ci0gICAgICAgICAgICAgICAgc3BpbmxvY2tfdCAqbG9j
ayA9IHVuaXRfc2NoZWR1bGVfbG9jayhzdmMtPnZjcHUtPnNjaGVkX3VuaXQpOworICAgICAgICAg
ICAgICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YyA9IGNzY2hlZDJfdW5pdCh1bml0KTsKKyAg
ICAgICAgICAgICAgICBzcGlubG9ja190ICpsb2NrID0gdW5pdF9zY2hlZHVsZV9sb2NrKHVuaXQp
OwogCi0gICAgICAgICAgICAgICAgQVNTRVJUKHN2Yy0+cnFkID09IGMycnFkKG9wcywgc3ZjLT52
Y3B1LT5wcm9jZXNzb3IpKTsKKyAgICAgICAgICAgICAgICBBU1NFUlQoc3ZjLT5ycWQgPT0gYzJy
cWQob3BzLCBzY2hlZF91bml0X2NwdSh1bml0KSkpOwogCiAgICAgICAgICAgICAgICAgc3ZjLT53
ZWlnaHQgPSBzZG9tLT53ZWlnaHQ7CiAgICAgICAgICAgICAgICAgdXBkYXRlX21heF93ZWlnaHQo
c3ZjLT5ycWQsIHN2Yy0+d2VpZ2h0LCBvbGRfd2VpZ2h0KTsKIAotICAgICAgICAgICAgICAgIHVu
aXRfc2NoZWR1bGVfdW5sb2NrKGxvY2ssIHN2Yy0+dmNwdS0+c2NoZWRfdW5pdCk7CisgICAgICAg
ICAgICAgICAgdW5pdF9zY2hlZHVsZV91bmxvY2sobG9jaywgdW5pdCk7CiAgICAgICAgICAgICB9
CiAgICAgICAgIH0KICAgICAgICAgLyogQ2FwICovCkBAIC0yODY2LDggKzI4NTYsOCBAQCBjc2No
ZWQyX2RvbV9jbnRsKAogICAgICAgICAgICAgc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjOwogICAg
ICAgICAgICAgc3BpbmxvY2tfdCAqbG9jazsKIAotICAgICAgICAgICAgLyogQ2FwIGlzIG9ubHkg
dmFsaWQgaWYgaXQncyBiZWxvdyAxMDAgKiBucl9vZl92Q1BVUyAqLwotICAgICAgICAgICAgaWYg
KCBvcC0+dS5jcmVkaXQyLmNhcCA+IDEwMCAqIHNkb20tPm5yX3ZjcHVzICkKKyAgICAgICAgICAg
IC8qIENhcCBpcyBvbmx5IHZhbGlkIGlmIGl0J3MgYmVsb3cgMTAwICogbnJfb2ZfdW5pdHMgKi8K
KyAgICAgICAgICAgIGlmICggb3AtPnUuY3JlZGl0Mi5jYXAgPiAxMDAgKiBzZG9tLT5ucl91bml0
cyApCiAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgcmMgPSAtRUlOVkFMOwogICAgICAg
ICAgICAgICAgIHdyaXRlX3VubG9ja19pcnFyZXN0b3JlKCZwcnYtPmxvY2ssIGZsYWdzKTsKQEAg
LTI4ODAsMjMgKzI4NzAsMjMgQEAgY3NjaGVkMl9kb21fY250bCgKICAgICAgICAgICAgIHNwaW5f
dW5sb2NrKCZzZG9tLT5idWRnZXRfbG9jayk7CiAKICAgICAgICAgICAgIC8qCi0gICAgICAgICAg
ICAgKiBXaGVuIHRyeWluZyB0byBnZXQgc29tZSBidWRnZXQgYW5kIHJ1biwgZWFjaCB2Q1BVIHdp
bGwgZ3JhYgotICAgICAgICAgICAgICogZnJvbSB0aGUgcG9vbCAxL04gKHdpdGggTiA9IG5yIG9m
IHZDUFVzIG9mIHRoZSBkb21haW4pIG9mCi0gICAgICAgICAgICAgKiB0aGUgdG90YWwgYnVkZ2V0
LiBSb3VnaGx5IHNwZWFraW5nLCB0aGlzIG1lYW5zIGVhY2ggdkNQVSB3aWxsCisgICAgICAgICAg
ICAgKiBXaGVuIHRyeWluZyB0byBnZXQgc29tZSBidWRnZXQgYW5kIHJ1biwgZWFjaCB1bml0IHdp
bGwgZ3JhYgorICAgICAgICAgICAgICogZnJvbSB0aGUgcG9vbCAxL04gKHdpdGggTiA9IG5yIG9m
IHVuaXRzIG9mIHRoZSBkb21haW4pIG9mCisgICAgICAgICAgICAgKiB0aGUgdG90YWwgYnVkZ2V0
LiBSb3VnaGx5IHNwZWFraW5nLCB0aGlzIG1lYW5zIGVhY2ggdW5pdCB3aWxsCiAgICAgICAgICAg
ICAgKiBoYXZlIGF0IGxlYXN0IG9uZSBjaGFuY2UgdG8gcnVuIGR1cmluZyBldmVyeSBwZXJpb2Qu
CiAgICAgICAgICAgICAgKi8KLSAgICAgICAgICAgIGZvcl9lYWNoX3ZjcHUgKCBkLCB2ICkKKyAg
ICAgICAgICAgIGZvcl9lYWNoX3NjaGVkX3VuaXQgKCBkLCB1bml0ICkKICAgICAgICAgICAgIHsK
LSAgICAgICAgICAgICAgICBzdmMgPSBjc2NoZWQyX3VuaXQodi0+c2NoZWRfdW5pdCk7Ci0gICAg
ICAgICAgICAgICAgbG9jayA9IHVuaXRfc2NoZWR1bGVfbG9jayhzdmMtPnZjcHUtPnNjaGVkX3Vu
aXQpOworICAgICAgICAgICAgICAgIHN2YyA9IGNzY2hlZDJfdW5pdCh1bml0KTsKKyAgICAgICAg
ICAgICAgICBsb2NrID0gdW5pdF9zY2hlZHVsZV9sb2NrKHVuaXQpOwogICAgICAgICAgICAgICAg
IC8qCiAgICAgICAgICAgICAgICAgICogVG9vIHNtYWxsIHF1b3RhcyB3b3VsZCBpbiB0aGVvcnkg
Y2F1c2UgYSBsb3Qgb2Ygb3ZlcmhlYWQsCiAgICAgICAgICAgICAgICAgICogd2hpY2ggdGhlbiB3
b24ndCBoYXBwZW4gYmVjYXVzZSwgaW4gY3NjaGVkMl9ydW50aW1lKCksCiAgICAgICAgICAgICAg
ICAgICogQ1NDSEVEMl9NSU5fVElNRVIgaXMgd2hhdCB3b3VsZCBiZSB1c2VkIGFueXdheS4KICAg
ICAgICAgICAgICAgICAgKi8KLSAgICAgICAgICAgICAgICBzdmMtPmJ1ZGdldF9xdW90YSA9IG1h
eChzZG9tLT50b3RfYnVkZ2V0IC8gc2RvbS0+bnJfdmNwdXMsCisgICAgICAgICAgICAgICAgc3Zj
LT5idWRnZXRfcXVvdGEgPSBtYXgoc2RvbS0+dG90X2J1ZGdldCAvIHNkb20tPm5yX3VuaXRzLAog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENTQ0hFRDJfTUlOX1RJTUVS
KTsKLSAgICAgICAgICAgICAgICB1bml0X3NjaGVkdWxlX3VubG9jayhsb2NrLCBzdmMtPnZjcHUt
PnNjaGVkX3VuaXQpOworICAgICAgICAgICAgICAgIHVuaXRfc2NoZWR1bGVfdW5sb2NrKGxvY2ss
IHVuaXQpOwogICAgICAgICAgICAgfQogCiAgICAgICAgICAgICBpZiAoIHNkb20tPmNhcCA9PSAw
ICkKQEAgLTI5MDYsNyArMjg5Niw3IEBAIGNzY2hlZDJfZG9tX2NudGwoCiAgICAgICAgICAgICAg
ICAgICogYW5kIHF1ZXVlIGl0cyBmaXJzdCByZXBsZW5pc2htZW50IGV2ZW50LgogICAgICAgICAg
ICAgICAgICAqCiAgICAgICAgICAgICAgICAgICogU2luY2UgY2FwIGlzIGN1cnJlbnRseSBkaXNh
YmxlZCBmb3IgdGhpcyBkb21haW4sIHdlCi0gICAgICAgICAgICAgICAgICoga25vdyBubyB2Q1BV
IGlzIG1lc3Npbmcgd2l0aCB0aGUgZG9tYWluJ3MgYnVkZ2V0LCBhbmQKKyAgICAgICAgICAgICAg
ICAgKiBrbm93IG5vIHVuaXQgaXMgbWVzc2luZyB3aXRoIHRoZSBkb21haW4ncyBidWRnZXQsIGFu
ZAogICAgICAgICAgICAgICAgICAqIHRoZSByZXBsZW5pc2htZW50IHRpbWVyIGlzIHN0aWxsIG9m
Zi4KICAgICAgICAgICAgICAgICAgKiBGb3IgdGhlc2UgcmVhc29ucywgaXQgaXMgc2FmZSB0byBk
byB0aGUgZm9sbG93aW5nIHdpdGhvdXQKICAgICAgICAgICAgICAgICAgKiB0YWtpbmcgdGhlIGJ1
ZGdldF9sb2NrLgpAQCAtMjkxNiw0MiArMjkwNiw0MiBAQCBjc2NoZWQyX2RvbV9jbnRsKAogICAg
ICAgICAgICAgICAgIHNldF90aW1lcigmc2RvbS0+cmVwbF90aW1lciwgc2RvbS0+bmV4dF9yZXBs
KTsKIAogICAgICAgICAgICAgICAgIC8qCi0gICAgICAgICAgICAgICAgICogTm93LCBsZXQncyBl
bmFibGUgYnVkZ2V0IGFjY291bnRpbmcgZm9yIGFsbCB0aGUgdkNQVXMuCisgICAgICAgICAgICAg
ICAgICogTm93LCBsZXQncyBlbmFibGUgYnVkZ2V0IGFjY291bnRpbmcgZm9yIGFsbCB0aGUgdW5p
dHMuCiAgICAgICAgICAgICAgICAgICogRm9yIG1ha2luZyBzdXJlIHRoYXQgdGhleSB3aWxsIHN0
YXJ0IHRvIGhvbm91ciB0aGUgZG9tYWluJ3MKICAgICAgICAgICAgICAgICAgKiBjYXAsIHdlIHNl
dCB0aGVpciBidWRnZXQgdG8gMC4KICAgICAgICAgICAgICAgICAgKiBUaGlzIHdheSwgYXMgc29v
biBhcyB0aGV5IHdpbGwgdHJ5IHRvIHJ1biwgdGhleSB3aWxsIGhhdmUKICAgICAgICAgICAgICAg
ICAgKiB0byBnZXQgc29tZSBidWRnZXQuCiAgICAgICAgICAgICAgICAgICoKLSAgICAgICAgICAg
ICAgICAgKiBGb3IgdGhlIHZDUFVzIHRoYXQgYXJlIGFscmVhZHkgcnVubmluZywgd2UgdHJpZ2dl
ciB0aGUKKyAgICAgICAgICAgICAgICAgKiBGb3IgdGhlIHVuaXRzIHRoYXQgYXJlIGFscmVhZHkg
cnVubmluZywgd2UgdHJpZ2dlciB0aGUKICAgICAgICAgICAgICAgICAgKiBzY2hlZHVsZXIgb24g
dGhlaXIgcENQVS4gV2hlbiwgYXMgYSBjb25zZXF1ZW5jZSBvZiB0aGlzLAogICAgICAgICAgICAg
ICAgICAqIGNzY2hlZDJfc2NoZWR1bGUoKSB3aWxsIHJ1biwgaXQgd2lsbCBmaWd1cmUgb3V0IHRo
ZXJlIGlzCi0gICAgICAgICAgICAgICAgICogbm8gYnVkZ2V0LCBhbmQgdGhlIHZDUFUgd2lsbCB0
cnkgdG8gZ2V0IHNvbWUgKGFuZCBiZSBwYXJrZWQsCisgICAgICAgICAgICAgICAgICogbm8gYnVk
Z2V0LCBhbmQgdGhlIHVuaXQgd2lsbCB0cnkgdG8gZ2V0IHNvbWUgKGFuZCBiZSBwYXJrZWQsCiAg
ICAgICAgICAgICAgICAgICogaWYgdGhlcmUncyBub25lLCBhbmQgd2UnbGwgc3dpdGNoIHRvIHNv
bWVvbmUgZWxzZSkuCiAgICAgICAgICAgICAgICAgICovCi0gICAgICAgICAgICAgICAgZm9yX2Vh
Y2hfdmNwdSAoIGQsIHYgKQorICAgICAgICAgICAgICAgIGZvcl9lYWNoX3NjaGVkX3VuaXQgKCBk
LCB1bml0ICkKICAgICAgICAgICAgICAgICB7Ci0gICAgICAgICAgICAgICAgICAgIHN2YyA9IGNz
Y2hlZDJfdW5pdCh2LT5zY2hlZF91bml0KTsKLSAgICAgICAgICAgICAgICAgICAgbG9jayA9IHVu
aXRfc2NoZWR1bGVfbG9jayhzdmMtPnZjcHUtPnNjaGVkX3VuaXQpOwotICAgICAgICAgICAgICAg
ICAgICBpZiAoIHYtPnNjaGVkX3VuaXQtPmlzX3J1bm5pbmcgKQorICAgICAgICAgICAgICAgICAg
ICBzdmMgPSBjc2NoZWQyX3VuaXQodW5pdCk7CisgICAgICAgICAgICAgICAgICAgIGxvY2sgPSB1
bml0X3NjaGVkdWxlX2xvY2sodW5pdCk7CisgICAgICAgICAgICAgICAgICAgIGlmICggdW5pdC0+
aXNfcnVubmluZyApCiAgICAgICAgICAgICAgICAgICAgIHsKLSAgICAgICAgICAgICAgICAgICAg
ICAgIHVuc2lnbmVkIGludCBjcHUgPSB2LT5wcm9jZXNzb3I7CisgICAgICAgICAgICAgICAgICAg
ICAgICB1bnNpZ25lZCBpbnQgY3B1ID0gc2NoZWRfdW5pdF9jcHUodW5pdCk7CiAgICAgICAgICAg
ICAgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQgPSBjMnJxZChv
cHMsIGNwdSk7CiAKLSAgICAgICAgICAgICAgICAgICAgICAgIEFTU0VSVChjdXJyX29uX2NwdShj
cHUpLT52Y3B1X2xpc3QgPT0gdik7CisgICAgICAgICAgICAgICAgICAgICAgICBBU1NFUlQoY3Vy
cl9vbl9jcHUoY3B1KSA9PSB1bml0KTsKIAogICAgICAgICAgICAgICAgICAgICAgICAgLyoKLSAg
ICAgICAgICAgICAgICAgICAgICAgICAqIFdlIGFyZSB0cmlnZ2VyaW5nIGEgcmVzY2hlZHVsZSBv
biB0aGUgdkNQVSdzCisgICAgICAgICAgICAgICAgICAgICAgICAgKiBXZSBhcmUgdHJpZ2dlcmlu
ZyBhIHJlc2NoZWR1bGUgb24gdGhlIHVuaXQncwogICAgICAgICAgICAgICAgICAgICAgICAgICog
cENQVS4gVGhhdCB3aWxsIHJ1biBidXJuX2NyZWRpdHMoKSBhbmQsIHNpbmNlCi0gICAgICAgICAg
ICAgICAgICAgICAgICAgKiB0aGUgdkNQVSBpcyBjYXBwZWQgbm93LCBpdCB3b3VsZCBjaGFyZ2Ug
YWxsIHRoZQorICAgICAgICAgICAgICAgICAgICAgICAgICogdGhlIHVuaXQgaXMgY2FwcGVkIG5v
dywgaXQgd291bGQgY2hhcmdlIGFsbCB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgICAqIGV4
ZWN1dGlvbiB0aW1lIG9mIHRoaXMgbGFzdCByb3VuZCBhcyBidWRnZXQgYXMKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAqIHdlbGwuIFRoYXQgd2lsbCBtYWtlIHRoZSB2Q1BVIGJ1ZGdldCBnbyBu
ZWdhdGl2ZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAqIHdlbGwuIFRoYXQgd2lsbCBtYWtl
IHRoZSB1bml0IGJ1ZGdldCBnbyBuZWdhdGl2ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAq
IHBvdGVudGlhbGx5IGJ5IGEgbGFyZ2UgYW1vdW50LCBhbmQgaXQncyB1bmZhaXIuCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICAgICAgICAgICogVG8gYXZvaWQg
dGhhdCwgY2FsbCBidXJuX2NyZWRpdCgpIGhlcmUsIHRvIGRvIHRoZQogICAgICAgICAgICAgICAg
ICAgICAgICAgICogYWNjb3VudGluZyBvZiB0aGlzIGN1cnJlbnQgcnVubmluZyBpbnN0YW5jZSBu
b3csCiAgICAgICAgICAgICAgICAgICAgICAgICAgKiB3aXRoIGJ1ZGdldHRpbmcgc3RpbGwgZGlz
YWJsZWQuIFRoaXMgZG9lcyBub3QKICAgICAgICAgICAgICAgICAgICAgICAgICAqIHByZXZlbnQg
c29tZSBzbWFsbCBhbW91bnQgb2YgYnVkZ2V0IGJlaW5nIGNoYXJnZWQKLSAgICAgICAgICAgICAg
ICAgICAgICAgICAqIHRvIHRoZSB2Q1BVIChpLmUuLCB0aGUgYW1vdW50IG9mIHRpbWUgaXQgcnVu
cyBmcm9tCisgICAgICAgICAgICAgICAgICAgICAgICAgKiB0byB0aGUgdW5pdCAoaS5lLiwgdGhl
IGFtb3VudCBvZiB0aW1lIGl0IHJ1bnMgZnJvbQogICAgICAgICAgICAgICAgICAgICAgICAgICog
bm93LCB0byB3aGVuIHNjaGVkdWxpbmcgaGFwcGVucykuIFRoZSBidWRnZXQgd2lsbAogICAgICAg
ICAgICAgICAgICAgICAgICAgICogYWxzbyBnbyBiZWxvdyAwLCBidXQgYSBsb3QgbGVzcyB0aGFu
IGhvdyBpdCB3b3VsZAogICAgICAgICAgICAgICAgICAgICAgICAgICogaWYgd2UgZG9uJ3QgZG8g
dGhpcy4KQEAgLTI5NjIsNyArMjk1Miw3IEBAIGNzY2hlZDJfZG9tX2NudGwoCiAgICAgICAgICAg
ICAgICAgICAgICAgICBjcHVfcmFpc2Vfc29mdGlycShjcHUsIFNDSEVEVUxFX1NPRlRJUlEpOwog
ICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgIHN2Yy0+YnVkZ2V0ID0g
MDsKLSAgICAgICAgICAgICAgICAgICAgdW5pdF9zY2hlZHVsZV91bmxvY2sobG9jaywgc3ZjLT52
Y3B1LT5zY2hlZF91bml0KTsKKyAgICAgICAgICAgICAgICAgICAgdW5pdF9zY2hlZHVsZV91bmxv
Y2sobG9jaywgdW5pdCk7CiAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgfQogCkBAIC0y
OTc0LDMwICsyOTY0LDMwIEBAIGNzY2hlZDJfZG9tX2NudGwoCiAKICAgICAgICAgICAgIHN0b3Bf
dGltZXIoJnNkb20tPnJlcGxfdGltZXIpOwogCi0gICAgICAgICAgICAvKiBEaXNhYmxlIGJ1ZGdl
dCBhY2NvdW50aW5nIGZvciBhbGwgdGhlIHZDUFVzLiAqLwotICAgICAgICAgICAgZm9yX2VhY2hf
dmNwdSAoIGQsIHYgKQorICAgICAgICAgICAgLyogRGlzYWJsZSBidWRnZXQgYWNjb3VudGluZyBm
b3IgYWxsIHRoZSB1bml0cy4gKi8KKyAgICAgICAgICAgIGZvcl9lYWNoX3NjaGVkX3VuaXQgKCBk
LCB1bml0ICkKICAgICAgICAgICAgIHsKLSAgICAgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl91
bml0ICpzdmMgPSBjc2NoZWQyX3VuaXQodi0+c2NoZWRfdW5pdCk7Ci0gICAgICAgICAgICAgICAg
c3BpbmxvY2tfdCAqbG9jayA9IHVuaXRfc2NoZWR1bGVfbG9jayhzdmMtPnZjcHUtPnNjaGVkX3Vu
aXQpOworICAgICAgICAgICAgICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YyA9IGNzY2hlZDJf
dW5pdCh1bml0KTsKKyAgICAgICAgICAgICAgICBzcGlubG9ja190ICpsb2NrID0gdW5pdF9zY2hl
ZHVsZV9sb2NrKHVuaXQpOwogCiAgICAgICAgICAgICAgICAgc3ZjLT5idWRnZXQgPSBTVElNRV9N
QVg7CiAgICAgICAgICAgICAgICAgc3ZjLT5idWRnZXRfcXVvdGEgPSAwOwogCi0gICAgICAgICAg
ICAgICAgdW5pdF9zY2hlZHVsZV91bmxvY2sobG9jaywgc3ZjLT52Y3B1LT5zY2hlZF91bml0KTsK
KyAgICAgICAgICAgICAgICB1bml0X3NjaGVkdWxlX3VubG9jayhsb2NrLCB1bml0KTsKICAgICAg
ICAgICAgIH0KICAgICAgICAgICAgIHNkb20tPmNhcCA9IDA7CiAgICAgICAgICAgICAvKgogICAg
ICAgICAgICAgICogV2UgYXJlIGRpc2FibGluZyB0aGUgY2FwIGZvciB0aGlzIGRvbWFpbiwgd2hp
Y2ggbWF5IGhhdmUKLSAgICAgICAgICAgICAqIHZDUFVzIHdhaXRpbmcgZm9yIGEgcmVwbGVuaXNo
bWVudCwgc28gd2UgdW5wYXJrIHRoZW0gYWxsLgorICAgICAgICAgICAgICogdW5pdHMgd2FpdGlu
ZyBmb3IgYSByZXBsZW5pc2htZW50LCBzbyB3ZSB1bnBhcmsgdGhlbSBhbGwuCiAgICAgICAgICAg
ICAgKiBOb3RlIHRoYXQsIHNpbmNlIHdlIGhhdmUgYWxyZWFkeSBkaXNhYmxlZCBidWRnZXQgYWNj
b3VudGluZwotICAgICAgICAgICAgICogZm9yIGFsbCB0aGUgdkNQVXMgb2YgdGhlIGRvbWFpbiwg
bm8gY3VycmVudGx5IHJ1bm5pbmcgdkNQVQotICAgICAgICAgICAgICogd2lsbCBiZSBhZGRlZCB0
byB0aGUgcGFya2VkIHZDUFVzIGxpc3QgYW55IGxvbmdlci4KKyAgICAgICAgICAgICAqIGZvciBh
bGwgdGhlIHVuaXRzIG9mIHRoZSBkb21haW4sIG5vIGN1cnJlbnRseSBydW5uaW5nIHVuaXQKKyAg
ICAgICAgICAgICAqIHdpbGwgYmUgYWRkZWQgdG8gdGhlIHBhcmtlZCB1bml0cyBsaXN0IGFueSBs
b25nZXIuCiAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgIHNwaW5fbG9jaygmc2RvbS0+YnVk
Z2V0X2xvY2spOwotICAgICAgICAgICAgbGlzdF9zcGxpY2VfaW5pdCgmc2RvbS0+cGFya2VkX3Zj
cHVzLCAmcGFya2VkKTsKKyAgICAgICAgICAgIGxpc3Rfc3BsaWNlX2luaXQoJnNkb20tPnBhcmtl
ZF91bml0cywgJnBhcmtlZCk7CiAgICAgICAgICAgICBzcGluX3VubG9jaygmc2RvbS0+YnVkZ2V0
X2xvY2spOwogCi0gICAgICAgICAgICB1bnBhcmtfcGFya2VkX3ZjcHVzKG9wcywgJnBhcmtlZCk7
CisgICAgICAgICAgICB1bnBhcmtfcGFya2VkX3VuaXRzKG9wcywgJnBhcmtlZCk7CiAgICAgICAg
IH0KICAgICAgICAgd3JpdGVfdW5sb2NrX2lycXJlc3RvcmUoJnBydi0+bG9jaywgZmxhZ3MpOwog
ICAgICAgICBicmVhazsKQEAgLTMwNzQsMTIgKzMwNjQsMTIgQEAgY3NjaGVkMl9hbGxvY19kb21k
YXRhKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IGRvbWFpbiAqZG9tKQogICAg
IHNkb20tPmRvbSA9IGRvbTsKICAgICBzZG9tLT53ZWlnaHQgPSBDU0NIRUQyX0RFRkFVTFRfV0VJ
R0hUOwogICAgIHNkb20tPmNhcCA9IDBVOwotICAgIHNkb20tPm5yX3ZjcHVzID0gMDsKKyAgICBz
ZG9tLT5ucl91bml0cyA9IDA7CiAKICAgICBpbml0X3RpbWVyKCZzZG9tLT5yZXBsX3RpbWVyLCBy
ZXBsZW5pc2hfZG9tYWluX2J1ZGdldCwgc2RvbSwKICAgICAgICAgICAgICAgIGNwdW1hc2tfYW55
KGNwdXBvb2xfZG9tYWluX2NwdW1hc2soZG9tKSkpOwogICAgIHNwaW5fbG9ja19pbml0KCZzZG9t
LT5idWRnZXRfbG9jayk7Ci0gICAgSU5JVF9MSVNUX0hFQUQoJnNkb20tPnBhcmtlZF92Y3B1cyk7
CisgICAgSU5JVF9MSVNUX0hFQUQoJnNkb20tPnBhcmtlZF91bml0cyk7CiAKICAgICB3cml0ZV9s
b2NrX2lycXNhdmUoJnBydi0+bG9jaywgZmxhZ3MpOwogCkBAIC0zMTEzLDM0ICszMTAzLDMyIEBA
IGNzY2hlZDJfZnJlZV9kb21kYXRhKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgdm9pZCAq
ZGF0YSkKIHN0YXRpYyB2b2lkCiBjc2NoZWQyX3VuaXRfaW5zZXJ0KGNvbnN0IHN0cnVjdCBzY2hl
ZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiB7Ci0gICAgc3RydWN0IHZjcHUg
KnZjID0gdW5pdC0+dmNwdV9saXN0OwogICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YyA9IHVu
aXQtPnByaXY7CiAgICAgc3RydWN0IGNzY2hlZDJfZG9tICogY29uc3Qgc2RvbSA9IHN2Yy0+c2Rv
bTsKICAgICBzcGlubG9ja190ICpsb2NrOwogCi0gICAgQVNTRVJUKCFpc19pZGxlX3ZjcHUodmMp
KTsKKyAgICBBU1NFUlQoIWlzX2lkbGVfdW5pdCh1bml0KSk7CiAgICAgQVNTRVJUKGxpc3RfZW1w
dHkoJnN2Yy0+cnVucV9lbGVtKSk7CiAKICAgICAvKiBjc2NoZWQyX3Jlc19waWNrKCkgZXhwZWN0
cyB0aGUgcGNwdSBsb2NrIHRvIGJlIGhlbGQgKi8KICAgICBsb2NrID0gdW5pdF9zY2hlZHVsZV9s
b2NrX2lycSh1bml0KTsKIAotICAgIHVuaXQtPnJlcyA9IGNzY2hlZDJfcmVzX3BpY2sob3BzLCB1
bml0KTsKLSAgICB2Yy0+cHJvY2Vzc29yID0gdW5pdC0+cmVzLT5tYXN0ZXJfY3B1OworICAgIHNj
aGVkX3NldF9yZXModW5pdCwgY3NjaGVkMl9yZXNfcGljayhvcHMsIHVuaXQpKTsKIAogICAgIHNw
aW5fdW5sb2NrX2lycShsb2NrKTsKIAogICAgIGxvY2sgPSB1bml0X3NjaGVkdWxlX2xvY2tfaXJx
KHVuaXQpOwogCi0gICAgLyogQWRkIHZjcHUgdG8gcnVucXVldWUgb2YgaW5pdGlhbCBwcm9jZXNz
b3IgKi8KLSAgICBydW5xX2Fzc2lnbihvcHMsIHZjKTsKKyAgICAvKiBBZGQgdW5pdCB0byBydW5x
dWV1ZSBvZiBpbml0aWFsIHByb2Nlc3NvciAqLworICAgIHJ1bnFfYXNzaWduKG9wcywgdW5pdCk7
CiAKICAgICB1bml0X3NjaGVkdWxlX3VubG9ja19pcnEobG9jaywgdW5pdCk7CiAKLSAgICBzZG9t
LT5ucl92Y3B1cysrOworICAgIHNkb20tPm5yX3VuaXRzKys7CiAKICAgICBTQ0hFRF9TVEFUX0NS
QU5LKHVuaXRfaW5zZXJ0KTsKIAotICAgIENTQ0hFRDJfVkNQVV9DSEVDSyh2Yyk7CisgICAgQ1ND
SEVEMl9VTklUX0NIRUNLKHVuaXQpOwogfQogCiBzdGF0aWMgdm9pZApAQCAtMzE1NCwxMSArMzE0
MiwxMCBAQCBjc2NoZWQyX2ZyZWVfdmRhdGEoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCB2
b2lkICpwcml2KQogc3RhdGljIHZvaWQKIGNzY2hlZDJfdW5pdF9yZW1vdmUoY29uc3Qgc3RydWN0
IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIHsKLSAgICBzdHJ1Y3Qg
dmNwdSAqdmMgPSB1bml0LT52Y3B1X2xpc3Q7CiAgICAgc3RydWN0IGNzY2hlZDJfdW5pdCAqIGNv
bnN0IHN2YyA9IGNzY2hlZDJfdW5pdCh1bml0KTsKICAgICBzcGlubG9ja190ICpsb2NrOwogCi0g
ICAgQVNTRVJUKCFpc19pZGxlX3ZjcHUodmMpKTsKKyAgICBBU1NFUlQoIWlzX2lkbGVfdW5pdCh1
bml0KSk7CiAgICAgQVNTRVJUKGxpc3RfZW1wdHkoJnN2Yy0+cnVucV9lbGVtKSk7CiAKICAgICBT
Q0hFRF9TVEFUX0NSQU5LKHVuaXRfcmVtb3ZlKTsKQEAgLTMxNjYsMTQgKzMxNTMsMTQgQEAgY3Nj
aGVkMl91bml0X3JlbW92ZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hl
ZF91bml0ICp1bml0KQogICAgIC8qIFJlbW92ZSBmcm9tIHJ1bnF1ZXVlICovCiAgICAgbG9jayA9
IHVuaXRfc2NoZWR1bGVfbG9ja19pcnEodW5pdCk7CiAKLSAgICBydW5xX2RlYXNzaWduKG9wcywg
dmMpOworICAgIHJ1bnFfZGVhc3NpZ24ob3BzLCB1bml0KTsKIAogICAgIHVuaXRfc2NoZWR1bGVf
dW5sb2NrX2lycShsb2NrLCB1bml0KTsKIAotICAgIHN2Yy0+c2RvbS0+bnJfdmNwdXMtLTsKKyAg
ICBzdmMtPnNkb20tPm5yX3VuaXRzLS07CiB9CiAKLS8qIEhvdyBsb25nIHNob3VsZCB3ZSBsZXQg
dGhpcyB2Y3B1IHJ1biBmb3I/ICovCisvKiBIb3cgbG9uZyBzaG91bGQgd2UgbGV0IHRoaXMgdW5p
dCBydW4gZm9yPyAqLwogc3RhdGljIHNfdGltZV90CiBjc2NoZWQyX3J1bnRpbWUoY29uc3Qgc3Ry
dWN0IHNjaGVkdWxlciAqb3BzLCBpbnQgY3B1LAogICAgICAgICAgICAgICAgIHN0cnVjdCBjc2No
ZWQyX3VuaXQgKnNuZXh0LCBzX3RpbWVfdCBub3cpCkBAIC0zMTg4LDcgKzMxNzUsNyBAQCBjc2No
ZWQyX3J1bnRpbWUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBpbnQgY3B1LAogICAgICAq
IElmIHdlJ3JlIGlkbGUsIGp1c3Qgc3RheSBzby4gT3RoZXJzIChvciBleHRlcm5hbCBldmVudHMp
CiAgICAgICogd2lsbCBwb2tlIHVzIHdoZW4gbmVjZXNzYXJ5LgogICAgICAqLwotICAgIGlmICgg
aXNfaWRsZV92Y3B1KHNuZXh0LT52Y3B1KSApCisgICAgaWYgKCBpc19pZGxlX3VuaXQoc25leHQt
PnVuaXQpICkKICAgICAgICAgcmV0dXJuIC0xOwogCiAgICAgLyogR2VuZXJhbCBhbGdvcml0aG06
CkBAIC0zMjA1LDggKzMxOTIsOCBAQCBjc2NoZWQyX3J1bnRpbWUoY29uc3Qgc3RydWN0IHNjaGVk
dWxlciAqb3BzLCBpbnQgY3B1LAogICAgIGlmICggcHJ2LT5yYXRlbGltaXRfdXMgKQogICAgIHsK
ICAgICAgICAgc190aW1lX3QgcmF0ZWxpbWl0X21pbiA9IE1JQ1JPU0VDUyhwcnYtPnJhdGVsaW1p
dF91cyk7Ci0gICAgICAgIGlmICggc25leHQtPnZjcHUtPnNjaGVkX3VuaXQtPmlzX3J1bm5pbmcg
KQotICAgICAgICAgICAgcmF0ZWxpbWl0X21pbiA9IHNuZXh0LT52Y3B1LT5zY2hlZF91bml0LT5z
dGF0ZV9lbnRyeV90aW1lICsKKyAgICAgICAgaWYgKCBzbmV4dC0+dW5pdC0+aXNfcnVubmluZyAp
CisgICAgICAgICAgICByYXRlbGltaXRfbWluID0gc25leHQtPnVuaXQtPnN0YXRlX2VudHJ5X3Rp
bWUgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1JQ1JPU0VDUyhwcnYtPnJhdGVsaW1p
dF91cykgLSBub3c7CiAgICAgICAgIGlmICggcmF0ZWxpbWl0X21pbiA+IG1pbl90aW1lICkKICAg
ICAgICAgICAgIG1pbl90aW1lID0gcmF0ZWxpbWl0X21pbjsKQEAgLTMyMjMsNyArMzIxMCw3IEBA
IGNzY2hlZDJfcnVudGltZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGludCBjcHUsCiAg
ICAgewogICAgICAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICpzd2FpdCA9IHJ1bnFfZWxlbShydW5x
LT5uZXh0KTsKIAotICAgICAgICBpZiAoICEgaXNfaWRsZV92Y3B1KHN3YWl0LT52Y3B1KQorICAg
ICAgICBpZiAoICEgaXNfaWRsZV91bml0KHN3YWl0LT51bml0KQogICAgICAgICAgICAgICYmIHN3
YWl0LT5jcmVkaXQgPiAwICkKICAgICAgICAgewogICAgICAgICAgICAgcnRfY3JlZGl0ID0gc25l
eHQtPmNyZWRpdCAtIHN3YWl0LT5jcmVkaXQ7CkBAIC0zMjM3LDcgKzMyMjQsNyBAQCBjc2NoZWQy
X3J1bnRpbWUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBpbnQgY3B1LAogICAgICAqCiAg
ICAgICogRklYTUU6IFNlZSBpZiB3ZSBjYW4gZWxpbWluYXRlIHRoaXMgY29udmVyc2lvbiBpZiB3
ZSBrbm93IHRpbWUKICAgICAgKiB3aWxsIGJlIG91dHNpZGUgKE1JTixNQVgpLiAgUHJvYmFibHkg
cmVxdWlyZXMgcHJlLWNhbGN1bGF0aW5nCi0gICAgICogY3JlZGl0IHZhbHVlcyBvZiBNSU4sTUFY
IHBlciB2Y3B1LCBzaW5jZSBlYWNoIHZjcHUgYnVybnMgY3JlZGl0CisgICAgICogY3JlZGl0IHZh
bHVlcyBvZiBNSU4sTUFYIHBlciB1bml0LCBzaW5jZSBlYWNoIHVuaXQgYnVybnMgY3JlZGl0CiAg
ICAgICogYXQgYSBkaWZmZXJlbnQgcmF0ZS4KICAgICAgKi8KICAgICBpZiAoIHJ0X2NyZWRpdCA+
IDAgKQpAQCAtMzI4NSwzNiArMzI3MiwzNSBAQCBydW5xX2NhbmRpZGF0ZShzdHJ1Y3QgY3NjaGVk
Ml9ydW5xdWV1ZV9kYXRhICpycWQsCiAKICAgICAqc2tpcHBlZCA9IDA7CiAKLSAgICBpZiAoIHVu
bGlrZWx5KGlzX2lkbGVfdmNwdShzY3Vyci0+dmNwdSkpICkKKyAgICBpZiAoIHVubGlrZWx5KGlz
X2lkbGVfdW5pdChzY3Vyci0+dW5pdCkpICkKICAgICB7CiAgICAgICAgIHNuZXh0ID0gc2N1cnI7
CiAgICAgICAgIGdvdG8gY2hlY2tfcnVucTsKICAgICB9CiAKLSAgICB5aWVsZCA9IF9fdGVzdF9h
bmRfY2xlYXJfYml0KF9fQ1NGTEFHX3ZjcHVfeWllbGQsICZzY3Vyci0+ZmxhZ3MpOworICAgIHlp
ZWxkID0gX190ZXN0X2FuZF9jbGVhcl9iaXQoX19DU0ZMQUdfdW5pdF95aWVsZCwgJnNjdXJyLT5m
bGFncyk7CiAKICAgICAvKgotICAgICAqIFJldHVybiB0aGUgY3VycmVudCB2Y3B1IGlmIGl0IGhh
cyBleGVjdXRlZCBmb3IgbGVzcyB0aGFuIHJhdGVsaW1pdC4KLSAgICAgKiBBZGp1c3RzdG1lbnQg
Zm9yIHRoZSBzZWxlY3RlZCB2Y3B1J3MgY3JlZGl0IGFuZCBkZWNpc2lvbgorICAgICAqIFJldHVy
biB0aGUgY3VycmVudCB1bml0IGlmIGl0IGhhcyBleGVjdXRlZCBmb3IgbGVzcyB0aGFuIHJhdGVs
aW1pdC4KKyAgICAgKiBBZGp1c3RzdG1lbnQgZm9yIHRoZSBzZWxlY3RlZCB1bml0J3MgY3JlZGl0
IGFuZCBkZWNpc2lvbgogICAgICAqIGZvciBob3cgbG9uZyBpdCB3aWxsIHJ1biB3aWxsIGJlIHRh
a2VuIGluIGNzY2hlZDJfcnVudGltZS4KICAgICAgKgogICAgICAqIE5vdGUgdGhhdCwgaWYgc2N1
cnIgaXMgeWllbGRpbmcsIHdlIGRvbid0IGxldCByYXRlIGxpbWl0aW5nIGtpY2sgaW4uCiAgICAg
ICogSW4gZmFjdCwgaXQgbWF5IGJlIHRoZSBjYXNlIHRoYXQgc2N1cnIgaXMgYWJvdXQgdG8gc3Bp
biwgYW5kIHRoZXJlJ3MKICAgICAgKiBubyBwb2ludCBmb3JjaW5nIGl0IHRvIGRvIHNvIHVudGls
IHJhdGUgbGltaXRpbmcgZXhwaXJlcy4KICAgICAgKi8KLSAgICBpZiAoICF5aWVsZCAmJiBwcnYt
PnJhdGVsaW1pdF91cyAmJiB2Y3B1X3J1bm5hYmxlKHNjdXJyLT52Y3B1KSAmJgotICAgICAgICAg
KG5vdyAtIHNjdXJyLT52Y3B1LT5zY2hlZF91bml0LT5zdGF0ZV9lbnRyeV90aW1lKSA8Ci0gICAg
ICAgICAgTUlDUk9TRUNTKHBydi0+cmF0ZWxpbWl0X3VzKSApCisgICAgaWYgKCAheWllbGQgJiYg
cHJ2LT5yYXRlbGltaXRfdXMgJiYgdW5pdF9ydW5uYWJsZShzY3Vyci0+dW5pdCkgJiYKKyAgICAg
ICAgIChub3cgLSBzY3Vyci0+dW5pdC0+c3RhdGVfZW50cnlfdGltZSkgPCBNSUNST1NFQ1MocHJ2
LT5yYXRlbGltaXRfdXMpICkKICAgICB7CiAgICAgICAgIGlmICggdW5saWtlbHkodGJfaW5pdF9k
b25lKSApCiAgICAgICAgIHsKICAgICAgICAgICAgIHN0cnVjdCB7Ci0gICAgICAgICAgICAgICAg
dW5zaWduZWQgdmNwdToxNiwgZG9tOjE2OworICAgICAgICAgICAgICAgIHVuc2lnbmVkIHVuaXQ6
MTYsIGRvbToxNjsKICAgICAgICAgICAgICAgICB1bnNpZ25lZCBydW50aW1lOwogICAgICAgICAg
ICAgfSBkOwotICAgICAgICAgICAgZC5kb20gPSBzY3Vyci0+dmNwdS0+ZG9tYWluLT5kb21haW5f
aWQ7Ci0gICAgICAgICAgICBkLnZjcHUgPSBzY3Vyci0+dmNwdS0+dmNwdV9pZDsKLSAgICAgICAg
ICAgIGQucnVudGltZSA9IG5vdyAtIHNjdXJyLT52Y3B1LT5zY2hlZF91bml0LT5zdGF0ZV9lbnRy
eV90aW1lOworICAgICAgICAgICAgZC5kb20gPSBzY3Vyci0+dW5pdC0+ZG9tYWluLT5kb21haW5f
aWQ7CisgICAgICAgICAgICBkLnVuaXQgPSBzY3Vyci0+dW5pdC0+dW5pdF9pZDsKKyAgICAgICAg
ICAgIGQucnVudGltZSA9IG5vdyAtIHNjdXJyLT51bml0LT5zdGF0ZV9lbnRyeV90aW1lOwogICAg
ICAgICAgICAgX190cmFjZV92YXIoVFJDX0NTQ0hFRDJfUkFURUxJTUlULCAxLAogICAgICAgICAg
ICAgICAgICAgICAgICAgc2l6ZW9mKGQpLAogICAgICAgICAgICAgICAgICAgICAgICAgKHVuc2ln
bmVkIGNoYXIgKikmZCk7CkBAIC0zMzIzLDEzICszMzA5LDEzIEBAIHJ1bnFfY2FuZGlkYXRlKHN0
cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCwKICAgICB9CiAKICAgICAvKiBJZiBzY3Vy
ciBoYXMgYSBzb2Z0LWFmZmluaXR5LCBsZXQncyBjaGVjayB3aGV0aGVyIGNwdSBpcyBwYXJ0IG9m
IGl0ICovCi0gICAgaWYgKCBoYXNfc29mdF9hZmZpbml0eShzY3Vyci0+dmNwdS0+c2NoZWRfdW5p
dCkgKQorICAgIGlmICggaGFzX3NvZnRfYWZmaW5pdHkoc2N1cnItPnVuaXQpICkKICAgICB7Ci0g
ICAgICAgIGFmZmluaXR5X2JhbGFuY2VfY3B1bWFzayhzY3Vyci0+dmNwdS0+c2NoZWRfdW5pdCwg
QkFMQU5DRV9TT0ZUX0FGRklOSVRZLAorICAgICAgICBhZmZpbml0eV9iYWxhbmNlX2NwdW1hc2so
c2N1cnItPnVuaXQsIEJBTEFOQ0VfU09GVF9BRkZJTklUWSwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIGNwdW1hc2tfc2NyYXRjaCk7CiAgICAgICAgIGlmICggdW5saWtlbHkoIWNw
dW1hc2tfdGVzdF9jcHUoY3B1LCBjcHVtYXNrX3NjcmF0Y2gpKSApCiAgICAgICAgIHsKLSAgICAg
ICAgICAgIGNwdW1hc2tfdCAqb25saW5lID0gY3B1cG9vbF9kb21haW5fY3B1bWFzayhzY3Vyci0+
dmNwdS0+ZG9tYWluKTsKKyAgICAgICAgICAgIGNwdW1hc2tfdCAqb25saW5lID0gY3B1cG9vbF9k
b21haW5fY3B1bWFzayhzY3Vyci0+dW5pdC0+ZG9tYWluKTsKIAogICAgICAgICAgICAgLyogT2ss
IGlzIGFueSBvZiB0aGUgcGNwdXMgaW4gc2N1cnIgc29mdC1hZmZpbml0eSBpZGxlPyAqLwogICAg
ICAgICAgICAgY3B1bWFza19hbmQoY3B1bWFza19zY3JhdGNoLCBjcHVtYXNrX3NjcmF0Y2gsICZy
cWQtPmlkbGUpOwpAQCAtMzM1NywxMCArMzM0MywxMCBAQCBydW5xX2NhbmRpZGF0ZShzdHJ1Y3Qg
Y3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQsCiAgICAgICoKICAgICAgKiBPZiBjb3Vyc2UsIHdl
IGFsc28gZGVmYXVsdCB0byBpZGxlIGFsc28gaWYgc2N1cnIgaXMgbm90IHJ1bm5hYmxlLgogICAg
ICAqLwotICAgIGlmICggdmNwdV9ydW5uYWJsZShzY3Vyci0+dmNwdSkgJiYgIXNvZnRfYWZmX3By
ZWVtcHQgKQorICAgIGlmICggdW5pdF9ydW5uYWJsZShzY3Vyci0+dW5pdCkgJiYgIXNvZnRfYWZm
X3ByZWVtcHQgKQogICAgICAgICBzbmV4dCA9IHNjdXJyOwogICAgIGVsc2UKLSAgICAgICAgc25l
eHQgPSBjc2NoZWQyX3VuaXQoaWRsZV92Y3B1W2NwdV0tPnNjaGVkX3VuaXQpOworICAgICAgICBz
bmV4dCA9IGNzY2hlZDJfdW5pdChzY2hlZF9pZGxlX3VuaXQoY3B1KSk7CiAKICBjaGVja19ydW5x
OgogICAgIGxpc3RfZm9yX2VhY2hfc2FmZSggaXRlciwgdGVtcCwgJnJxZC0+cnVucSApCkBAIC0z
MzcwLDI0ICszMzU2LDI0IEBAIHJ1bnFfY2FuZGlkYXRlKHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVl
X2RhdGEgKnJxZCwKICAgICAgICAgaWYgKCB1bmxpa2VseSh0Yl9pbml0X2RvbmUpICkKICAgICAg
ICAgewogICAgICAgICAgICAgc3RydWN0IHsKLSAgICAgICAgICAgICAgICB1bnNpZ25lZCB2Y3B1
OjE2LCBkb206MTY7CisgICAgICAgICAgICAgICAgdW5zaWduZWQgdW5pdDoxNiwgZG9tOjE2Owog
ICAgICAgICAgICAgfSBkOwotICAgICAgICAgICAgZC5kb20gPSBzdmMtPnZjcHUtPmRvbWFpbi0+
ZG9tYWluX2lkOwotICAgICAgICAgICAgZC52Y3B1ID0gc3ZjLT52Y3B1LT52Y3B1X2lkOworICAg
ICAgICAgICAgZC5kb20gPSBzdmMtPnVuaXQtPmRvbWFpbi0+ZG9tYWluX2lkOworICAgICAgICAg
ICAgZC51bml0ID0gc3ZjLT51bml0LT51bml0X2lkOwogICAgICAgICAgICAgX190cmFjZV92YXIo
VFJDX0NTQ0hFRDJfUlVOUV9DQU5EX0NIRUNLLCAxLAogICAgICAgICAgICAgICAgICAgICAgICAg
c2l6ZW9mKGQpLAogICAgICAgICAgICAgICAgICAgICAgICAgKHVuc2lnbmVkIGNoYXIgKikmZCk7
CiAgICAgICAgIH0KIAotICAgICAgICAvKiBPbmx5IGNvbnNpZGVyIHZjcHVzIHRoYXQgYXJlIGFs
bG93ZWQgdG8gcnVuIG9uIHRoaXMgcHJvY2Vzc29yLiAqLwotICAgICAgICBpZiAoICFjcHVtYXNr
X3Rlc3RfY3B1KGNwdSwgc3ZjLT52Y3B1LT5zY2hlZF91bml0LT5jcHVfaGFyZF9hZmZpbml0eSkg
KQorICAgICAgICAvKiBPbmx5IGNvbnNpZGVyIHVuaXRzIHRoYXQgYXJlIGFsbG93ZWQgdG8gcnVu
IG9uIHRoaXMgcHJvY2Vzc29yLiAqLworICAgICAgICBpZiAoICFjcHVtYXNrX3Rlc3RfY3B1KGNw
dSwgc3ZjLT51bml0LT5jcHVfaGFyZF9hZmZpbml0eSkgKQogICAgICAgICB7CiAgICAgICAgICAg
ICAoKnNraXBwZWQpKys7CiAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgfQogCiAgICAg
ICAgIC8qCi0gICAgICAgICAqIElmIGEgdmNwdSBpcyBtZWFudCB0byBiZSBwaWNrZWQgdXAgYnkg
YW5vdGhlciBwcm9jZXNzb3IsIGFuZCBzdWNoCisgICAgICAgICAqIElmIGFuIHVuaXQgaXMgbWVh
bnQgdG8gYmUgcGlja2VkIHVwIGJ5IGFub3RoZXIgcHJvY2Vzc29yLCBhbmQgc3VjaAogICAgICAg
ICAgKiBwcm9jZXNzb3IgaGFzIG5vdCBzY2hlZHVsZWQgeWV0LCBsZWF2ZSBpdCBpbiB0aGUgcnVu
cXVldWUgZm9yIGhpbS4KICAgICAgICAgICovCiAgICAgICAgIGlmICggc3ZjLT50aWNrbGVkX2Nw
dSAhPSAtMSAmJiBzdmMtPnRpY2tsZWRfY3B1ICE9IGNwdSAmJgpAQCAtMzQwMiw3ICszMzg4LDcg
QEAgcnVucV9jYW5kaWRhdGUoc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFkLAogICAg
ICAgICAgKiBJZiB0aGlzIGlzIG9uIGEgZGlmZmVyZW50IHByb2Nlc3NvciwgZG9uJ3QgcHVsbCBp
dCB1bmxlc3MKICAgICAgICAgICogaXRzIGNyZWRpdCBpcyBhdCBsZWFzdCBDU0NIRUQyX01JR1JB
VEVfUkVTSVNUIGhpZ2hlci4KICAgICAgICAgICovCi0gICAgICAgIGlmICggc3ZjLT52Y3B1LT5w
cm9jZXNzb3IgIT0gY3B1CisgICAgICAgIGlmICggc2NoZWRfdW5pdF9jcHUoc3ZjLT51bml0KSAh
PSBjcHUKICAgICAgICAgICAgICAmJiBzbmV4dC0+Y3JlZGl0ICsgQ1NDSEVEMl9NSUdSQVRFX1JF
U0lTVCA+IHN2Yy0+Y3JlZGl0ICkKICAgICAgICAgewogICAgICAgICAgICAgKCpza2lwcGVkKSsr
OwpAQCAtMzQxNyw3ICszNDAzLDcgQEAgcnVucV9jYW5kaWRhdGUoc3RydWN0IGNzY2hlZDJfcnVu
cXVldWVfZGF0YSAqcnFkLAogICAgICAgICAgKiBzb21lIGJ1ZGdldCwgdGhlbiBjaG9vc2UgaXQu
CiAgICAgICAgICAqLwogICAgICAgICBpZiAoICh5aWVsZCB8fCBzdmMtPmNyZWRpdCA+IHNuZXh0
LT5jcmVkaXQpICYmCi0gICAgICAgICAgICAgKCFoYXNfY2FwKHN2YykgfHwgdmNwdV9ncmFiX2J1
ZGdldChzdmMpKSApCisgICAgICAgICAgICAgKCFoYXNfY2FwKHN2YykgfHwgdW5pdF9ncmFiX2J1
ZGdldChzdmMpKSApCiAgICAgICAgICAgICBzbmV4dCA9IHN2YzsKIAogICAgICAgICAvKiBJbiBh
bnkgY2FzZSwgaWYgd2UgZ290IHRoaXMgZmFyLCBicmVhay4gKi8KQEAgLTM0MjcsMTIgKzM0MTMs
MTIgQEAgcnVucV9jYW5kaWRhdGUoc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFkLAog
ICAgIGlmICggdW5saWtlbHkodGJfaW5pdF9kb25lKSApCiAgICAgewogICAgICAgICBzdHJ1Y3Qg
ewotICAgICAgICAgICAgdW5zaWduZWQgdmNwdToxNiwgZG9tOjE2OworICAgICAgICAgICAgdW5z
aWduZWQgdW5pdDoxNiwgZG9tOjE2OwogICAgICAgICAgICAgdW5zaWduZWQgdGlja2xlZF9jcHUs
IHNraXBwZWQ7CiAgICAgICAgICAgICBpbnQgY3JlZGl0OwogICAgICAgICB9IGQ7Ci0gICAgICAg
IGQuZG9tID0gc25leHQtPnZjcHUtPmRvbWFpbi0+ZG9tYWluX2lkOwotICAgICAgICBkLnZjcHUg
PSBzbmV4dC0+dmNwdS0+dmNwdV9pZDsKKyAgICAgICAgZC5kb20gPSBzbmV4dC0+dW5pdC0+ZG9t
YWluLT5kb21haW5faWQ7CisgICAgICAgIGQudW5pdCA9IHNuZXh0LT51bml0LT51bml0X2lkOwog
ICAgICAgICBkLmNyZWRpdCA9IHNuZXh0LT5jcmVkaXQ7CiAgICAgICAgIGQudGlja2xlZF9jcHUg
PSBzbmV4dC0+dGlja2xlZF9jcHU7CiAgICAgICAgIGQuc2tpcHBlZCA9ICpza2lwcGVkOwpAQCAt
MzQ2NCwxNCArMzQ1MCwxNSBAQCBjc2NoZWQyX3NjaGVkdWxlKAogewogICAgIGNvbnN0IGludCBj
cHUgPSBzbXBfcHJvY2Vzc29yX2lkKCk7CiAgICAgc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0
YSAqcnFkOwotICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKiBjb25zdCBzY3VyciA9IGNzY2hlZDJf
dW5pdChjdXJyZW50LT5zY2hlZF91bml0KTsKKyAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCAqY3VycnVu
aXQgPSBjdXJyZW50LT5zY2hlZF91bml0OworICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKiBjb25z
dCBzY3VyciA9IGNzY2hlZDJfdW5pdChjdXJydW5pdCk7CiAgICAgc3RydWN0IGNzY2hlZDJfdW5p
dCAqc25leHQgPSBOVUxMOwotICAgIHVuc2lnbmVkIGludCBza2lwcGVkX3ZjcHVzID0gMDsKKyAg
ICB1bnNpZ25lZCBpbnQgc2tpcHBlZF91bml0cyA9IDA7CiAgICAgc3RydWN0IHRhc2tfc2xpY2Ug
cmV0OwogICAgIGJvb2wgdGlja2xlZDsKIAogICAgIFNDSEVEX1NUQVRfQ1JBTksoc2NoZWR1bGUp
OwotICAgIENTQ0hFRDJfVkNQVV9DSEVDSyhjdXJyZW50KTsKKyAgICBDU0NIRUQyX1VOSVRfQ0hF
Q0soY3VycnVuaXQpOwogCiAgICAgQlVHX09OKCFjcHVtYXNrX3Rlc3RfY3B1KGNwdSwgJmNzY2hl
ZDJfcHJpdihvcHMpLT5pbml0aWFsaXplZCkpOwogCkBAIC0zNDgwLDcgKzM0NjcsNyBAQCBjc2No
ZWQyX3NjaGVkdWxlKAogCiAgICAgQVNTRVJUKHNwaW5faXNfbG9ja2VkKGdldF9zY2hlZF9yZXMo
Y3B1KS0+c2NoZWR1bGVfbG9jaykpOwogCi0gICAgQlVHX09OKCFpc19pZGxlX3ZjcHUoc2N1cnIt
PnZjcHUpICYmIHNjdXJyLT5ycWQgIT0gcnFkKTsKKyAgICBCVUdfT04oIWlzX2lkbGVfdW5pdChj
dXJydW5pdCkgJiYgc2N1cnItPnJxZCAhPSBycWQpOwogCiAgICAgLyogQ2xlYXIgInRpY2tsZWQi
IGJpdCBub3cgdGhhdCB3ZSd2ZSBiZWVuIHNjaGVkdWxlZCAqLwogICAgIHRpY2tsZWQgPSBjcHVt
YXNrX3Rlc3RfY3B1KGNwdSwgJnJxZC0+dGlja2xlZCk7CkBAIC0zNTAwLDcgKzM0ODcsNyBAQCBj
c2NoZWQyX3NjaGVkdWxlKAogICAgICAgICBkLmNwdSA9IGNwdTsKICAgICAgICAgZC5ycV9pZCA9
IGMycihjcHUpOwogICAgICAgICBkLnRhc2tsZXQgPSB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkOwot
ICAgICAgICBkLmlkbGUgPSBpc19pZGxlX3ZjcHUoY3VycmVudCk7CisgICAgICAgIGQuaWRsZSA9
IGlzX2lkbGVfdW5pdChjdXJydW5pdCk7CiAgICAgICAgIGQuc210X2lkbGUgPSBjcHVtYXNrX3Rl
c3RfY3B1KGNwdSwgJnJxZC0+c210X2lkbGUpOwogICAgICAgICBkLnRpY2tsZWQgPSB0aWNrbGVk
OwogICAgICAgICBfX3RyYWNlX3ZhcihUUkNfQ1NDSEVEMl9TQ0hFRFVMRSwgMSwKQEAgLTM1MTQs
NTUgKzM1MDEsNTUgQEAgY3NjaGVkMl9zY2hlZHVsZSgKICAgICAvKgogICAgICAqICBCZWxvdyAw
LCBtZWFucyB0aGF0IHdlIGFyZSBjYXBwZWQgYW5kIHdlIGhhdmUgb3ZlcnJ1biBvdXIgIGJ1ZGdl
dC4KICAgICAgKiAgTGV0J3MgdHJ5IHRvIGdldCBzb21lIG1vcmUgYnV0LCBpZiB3ZSBmYWlsIChl
LmcuLCBiZWNhdXNlIG9mIHRoZQotICAgICAqICBvdGhlciBydW5uaW5nIHZjcHVzKSwgd2Ugd2ls
bCBiZSBwYXJrZWQuCisgICAgICogIG90aGVyIHJ1bm5pbmcgdW5pdHMpLCB3ZSB3aWxsIGJlIHBh
cmtlZC4KICAgICAgKi8KICAgICBpZiAoIHVubGlrZWx5KHNjdXJyLT5idWRnZXQgPD0gMCkgKQot
ICAgICAgICB2Y3B1X2dyYWJfYnVkZ2V0KHNjdXJyKTsKKyAgICAgICAgdW5pdF9ncmFiX2J1ZGdl
dChzY3Vycik7CiAKICAgICAvKgotICAgICAqIFNlbGVjdCBuZXh0IHJ1bm5hYmxlIGxvY2FsIFZD
UFUgKGllIHRvcCBvZiBsb2NhbCBydW5xKS4KKyAgICAgKiBTZWxlY3QgbmV4dCBydW5uYWJsZSBs
b2NhbCBVTklUIChpZSB0b3Agb2YgbG9jYWwgcnVucSkuCiAgICAgICoKLSAgICAgKiBJZiB0aGUg
Y3VycmVudCB2Y3B1IGlzIHJ1bm5hYmxlLCBhbmQgaGFzIGhpZ2hlciBjcmVkaXQgdGhhbgorICAg
ICAqIElmIHRoZSBjdXJyZW50IHVuaXQgaXMgcnVubmFibGUsIGFuZCBoYXMgaGlnaGVyIGNyZWRp
dCB0aGFuCiAgICAgICogdGhlIG5leHQgZ3V5IG9uIHRoZSBxdWV1ZSAob3IgdGhlcmUgaXMgbm9v
bmUgZWxzZSksIHdlIHdhbnQgdG8KICAgICAgKiBydW4gaGltIGFnYWluLgogICAgICAqCi0gICAg
ICogSWYgdGhlcmUncyB0YXNrbGV0IHdvcmsgdG8gZG8sIHdlIHdhbnQgdG8gY2hvc2UgdGhlIGlk
bGUgdmNwdQorICAgICAqIElmIHRoZXJlJ3MgdGFza2xldCB3b3JrIHRvIGRvLCB3ZSB3YW50IHRv
IGNob3NlIHRoZSBpZGxlIHVuaXQKICAgICAgKiBmb3IgdGhpcyBwcm9jZXNzb3IsIGFuZCBtYXJr
IHRoZSBjdXJyZW50IGZvciBkZWxheWVkIHJ1bnF1ZXVlCiAgICAgICogYWRkLgogICAgICAqCi0g
ICAgICogSWYgdGhlIGN1cnJlbnQgdmNwdSBpcyBydW5uYWJsZSwgYW5kIHRoZXJlJ3MgYW5vdGhl
ciBydW5uYWJsZQorICAgICAqIElmIHRoZSBjdXJyZW50IHVuaXQgaXMgcnVubmFibGUsIGFuZCB0
aGVyZSdzIGFub3RoZXIgcnVubmFibGUKICAgICAgKiBjYW5kaWRhdGUsIHdlIHdhbnQgdG8gbWFy
ayBjdXJyZW50IGZvciBkZWxheWVkIHJ1bnF1ZXVlIGFkZCwKICAgICAgKiBhbmQgcmVtb3ZlIHRo
ZSBuZXh0IGd1eSBmcm9tIHRoZSBxdWV1ZS4KICAgICAgKgotICAgICAqIElmIHRoZSBjdXJyZW50
IHZjcHUgaXMgbm90IHJ1bm5hYmxlLCB3ZSB3YW50IHRvIGNob3NlIHRoZSBpZGxlCi0gICAgICog
dmNwdSBmb3IgdGhpcyBwcm9jZXNzb3IuCisgICAgICogSWYgdGhlIGN1cnJlbnQgdW5pdCBpcyBu
b3QgcnVubmFibGUsIHdlIHdhbnQgdG8gY2hvc2UgdGhlIGlkbGUKKyAgICAgKiB1bml0IGZvciB0
aGlzIHByb2Nlc3Nvci4KICAgICAgKi8KICAgICBpZiAoIHRhc2tsZXRfd29ya19zY2hlZHVsZWQg
KQogICAgIHsKLSAgICAgICAgX19jbGVhcl9iaXQoX19DU0ZMQUdfdmNwdV95aWVsZCwgJnNjdXJy
LT5mbGFncyk7CisgICAgICAgIF9fY2xlYXJfYml0KF9fQ1NGTEFHX3VuaXRfeWllbGQsICZzY3Vy
ci0+ZmxhZ3MpOwogICAgICAgICB0cmFjZV92YXIoVFJDX0NTQ0hFRDJfU0NIRURfVEFTS0xFVCwg
MSwgMCwgTlVMTCk7Ci0gICAgICAgIHNuZXh0ID0gY3NjaGVkMl91bml0KGlkbGVfdmNwdVtjcHVd
LT5zY2hlZF91bml0KTsKKyAgICAgICAgc25leHQgPSBjc2NoZWQyX3VuaXQoc2NoZWRfaWRsZV91
bml0KGNwdSkpOwogICAgIH0KICAgICBlbHNlCi0gICAgICAgIHNuZXh0ID0gcnVucV9jYW5kaWRh
dGUocnFkLCBzY3VyciwgY3B1LCBub3csICZza2lwcGVkX3ZjcHVzKTsKKyAgICAgICAgc25leHQg
PSBydW5xX2NhbmRpZGF0ZShycWQsIHNjdXJyLCBjcHUsIG5vdywgJnNraXBwZWRfdW5pdHMpOwog
Ci0gICAgLyogSWYgc3dpdGNoaW5nIGZyb20gYSBub24taWRsZSBydW5uYWJsZSB2Y3B1LCBwdXQg
aXQKKyAgICAvKiBJZiBzd2l0Y2hpbmcgZnJvbSBhIG5vbi1pZGxlIHJ1bm5hYmxlIHVuaXQsIHB1
dCBpdAogICAgICAqIGJhY2sgb24gdGhlIHJ1bnF1ZXVlLiAqLwogICAgIGlmICggc25leHQgIT0g
c2N1cnIKLSAgICAgICAgICYmICFpc19pZGxlX3ZjcHUoc2N1cnItPnZjcHUpCi0gICAgICAgICAm
JiB2Y3B1X3J1bm5hYmxlKGN1cnJlbnQpICkKKyAgICAgICAgICYmICFpc19pZGxlX3VuaXQoY3Vy
cnVuaXQpCisgICAgICAgICAmJiB1bml0X3J1bm5hYmxlKGN1cnJ1bml0KSApCiAgICAgICAgIF9f
c2V0X2JpdChfX0NTRkxBR19kZWxheWVkX3J1bnFfYWRkLCAmc2N1cnItPmZsYWdzKTsKIAogICAg
IHJldC5taWdyYXRlZCA9IDA7CiAKICAgICAvKiBBY2NvdW50aW5nIGZvciBub24taWRsZSB0YXNr
cyAqLwotICAgIGlmICggIWlzX2lkbGVfdmNwdShzbmV4dC0+dmNwdSkgKQorICAgIGlmICggIWlz
X2lkbGVfdW5pdChzbmV4dC0+dW5pdCkgKQogICAgIHsKICAgICAgICAgLyogSWYgc3dpdGNoaW5n
LCByZW1vdmUgdGhpcyBmcm9tIHRoZSBydW5xdWV1ZSBhbmQgbWFyayBpdCBzY2hlZHVsZWQgKi8K
ICAgICAgICAgaWYgKCBzbmV4dCAhPSBzY3VyciApCiAgICAgICAgIHsKICAgICAgICAgICAgIEFT
U0VSVChzbmV4dC0+cnFkID09IHJxZCk7Ci0gICAgICAgICAgICBBU1NFUlQoIXNuZXh0LT52Y3B1
LT5zY2hlZF91bml0LT5pc19ydW5uaW5nKTsKKyAgICAgICAgICAgIEFTU0VSVCghc25leHQtPnVu
aXQtPmlzX3J1bm5pbmcpOwogCiAgICAgICAgICAgICBydW5xX3JlbW92ZShzbmV4dCk7CiAgICAg
ICAgICAgICBfX3NldF9iaXQoX19DU0ZMQUdfc2NoZWR1bGVkLCAmc25leHQtPmZsYWdzKTsKQEAg
LTM1NzcsMTkgKzM1NjQsMTkgQEAgY3NjaGVkMl9zY2hlZHVsZSgKIAogICAgICAgICAvKgogICAg
ICAgICAgKiBUaGUgcmVzZXQgY29uZGl0aW9uIGlzICJoYXMgYSBzY2hlZHVsZXIgZXBvY2ggY29t
ZSB0byBhbiBlbmQ/Ii4KLSAgICAgICAgICogVGhlIHdheSB0aGlzIGlzIGVuZm9yY2VkIGlzIGNo
ZWNraW5nIHdoZXRoZXIgdGhlIHZjcHUgYXQgdGhlIHRvcAorICAgICAgICAgKiBUaGUgd2F5IHRo
aXMgaXMgZW5mb3JjZWQgaXMgY2hlY2tpbmcgd2hldGhlciB0aGUgdW5pdCBhdCB0aGUgdG9wCiAg
ICAgICAgICAqIG9mIHRoZSBydW5xdWV1ZSBoYXMgbmVnYXRpdmUgY3JlZGl0cy4gVGhpcyBtZWFu
cyB0aGUgZXBvY2hzIGhhdmUKICAgICAgICAgICogdmFyaWFibGUgbGVuZ3RoLCBhcyBpbiBvbmUg
ZXBvY2ggZXhwb3JlcyB3aGVuOgotICAgICAgICAgKiAgMSkgdGhlIHZjcHUgYXQgdGhlIHRvcCBv
ZiB0aGUgcnVucXVldWUgaGFzIGV4ZWN1dGVkIGZvcgorICAgICAgICAgKiAgMSkgdGhlIHVuaXQg
YXQgdGhlIHRvcCBvZiB0aGUgcnVucXVldWUgaGFzIGV4ZWN1dGVkIGZvcgogICAgICAgICAgKiAg
ICAgYXJvdW5kIDEwIG1zICh3aXRoIGRlZmF1bHQgcGFyYW1ldGVycyk7Ci0gICAgICAgICAqICAy
KSBubyBvdGhlciB2Y3B1IHdpdGggaGlnaGVyIGNyZWRpdHMgd2FudHMgdG8gcnVuLgorICAgICAg
ICAgKiAgMikgbm8gb3RoZXIgdW5pdCB3aXRoIGhpZ2hlciBjcmVkaXRzIHdhbnRzIHRvIHJ1bi4K
ICAgICAgICAgICoKICAgICAgICAgICogSGVyZSwgd2hlcmUgd2Ugd2FudCB0byBjaGVjayBmb3Ig
cmVzZXQsIHdlIG5lZWQgdG8gbWFrZSBzdXJlIHRoZQotICAgICAgICAgKiBwcm9wZXIgdmNwdSBp
cyBiZWluZyB1c2VkLiBJbiBmYWN0LCBydW5xdWV1ZV9jYW5kaWRhdGUoKSBtYXkgaGF2ZQotICAg
ICAgICAgKiBub3QgcmV0dXJuZWQgdGhlIGZpcnN0IHZjcHUgaW4gdGhlIHJ1bnF1ZXVlLCBmb3Ig
dmFyaW91cyByZWFzb25zCisgICAgICAgICAqIHByb3BlciB1bml0IGlzIGJlaW5nIHVzZWQuIElu
IGZhY3QsIHJ1bnF1ZXVlX2NhbmRpZGF0ZSgpIG1heSBoYXZlCisgICAgICAgICAqIG5vdCByZXR1
cm5lZCB0aGUgZmlyc3QgdW5pdCBpbiB0aGUgcnVucXVldWUsIGZvciB2YXJpb3VzIHJlYXNvbnMK
ICAgICAgICAgICogKGUuZy4sIGFmZmluaXR5KS4gT25seSB0cmlnZ2VyIGEgcmVzZXQgd2hlbiBp
dCBkb2VzLgogICAgICAgICAgKi8KLSAgICAgICAgaWYgKCBza2lwcGVkX3ZjcHVzID09IDAgJiYg
c25leHQtPmNyZWRpdCA8PSBDU0NIRUQyX0NSRURJVF9SRVNFVCApCisgICAgICAgIGlmICggc2tp
cHBlZF91bml0cyA9PSAwICYmIHNuZXh0LT5jcmVkaXQgPD0gQ1NDSEVEMl9DUkVESVRfUkVTRVQg
KQogICAgICAgICB7CiAgICAgICAgICAgICByZXNldF9jcmVkaXQob3BzLCBjcHUsIG5vdywgc25l
eHQpOwogICAgICAgICAgICAgYmFsYW5jZV9sb2FkKG9wcywgY3B1LCBub3cpOwpAQCAtMzU5OSwx
MSArMzU4NiwxMCBAQCBjc2NoZWQyX3NjaGVkdWxlKAogICAgICAgICBzbmV4dC0+dGlja2xlZF9j
cHUgPSAtMTsKIAogICAgICAgICAvKiBTYWZlIGJlY2F1c2UgbG9jayBmb3Igb2xkIHByb2Nlc3Nv
ciBpcyBoZWxkICovCi0gICAgICAgIGlmICggc25leHQtPnZjcHUtPnByb2Nlc3NvciAhPSBjcHUg
KQorICAgICAgICBpZiAoIHNjaGVkX3VuaXRfY3B1KHNuZXh0LT51bml0KSAhPSBjcHUgKQogICAg
ICAgICB7CiAgICAgICAgICAgICBzbmV4dC0+Y3JlZGl0ICs9IENTQ0hFRDJfTUlHUkFURV9DT01Q
RU5TQVRJT047Ci0gICAgICAgICAgICBzbmV4dC0+dmNwdS0+cHJvY2Vzc29yID0gY3B1OwotICAg
ICAgICAgICAgc25leHQtPnZjcHUtPnNjaGVkX3VuaXQtPnJlcyA9IGdldF9zY2hlZF9yZXMoY3B1
KTsKKyAgICAgICAgICAgIHNjaGVkX3NldF9yZXMoc25leHQtPnVuaXQsIGdldF9zY2hlZF9yZXMo
Y3B1KSk7CiAgICAgICAgICAgICBTQ0hFRF9TVEFUX0NSQU5LKG1pZ3JhdGVkKTsKICAgICAgICAg
ICAgIHJldC5taWdyYXRlZCA9IDE7CiAgICAgICAgIH0KQEAgLTM2MzcsMjAgKzM2MjMsMjAgQEAg
Y3NjaGVkMl9zY2hlZHVsZSgKICAgICAgKiBSZXR1cm4gdGFzayB0byBydW4gbmV4dC4uLgogICAg
ICAqLwogICAgIHJldC50aW1lID0gY3NjaGVkMl9ydW50aW1lKG9wcywgY3B1LCBzbmV4dCwgbm93
KTsKLSAgICByZXQudGFzayA9IHNuZXh0LT52Y3B1LT5zY2hlZF91bml0OworICAgIHJldC50YXNr
ID0gc25leHQtPnVuaXQ7CiAKLSAgICBDU0NIRUQyX1ZDUFVfQ0hFQ0socmV0LnRhc2stPnZjcHVf
bGlzdCk7CisgICAgQ1NDSEVEMl9VTklUX0NIRUNLKHJldC50YXNrKTsKICAgICByZXR1cm4gcmV0
OwogfQogCiBzdGF0aWMgdm9pZAotY3NjaGVkMl9kdW1wX3ZjcHUoc3RydWN0IGNzY2hlZDJfcHJp
dmF0ZSAqcHJ2LCBzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMpCitjc2NoZWQyX2R1bXBfdW5pdChz
dHJ1Y3QgY3NjaGVkMl9wcml2YXRlICpwcnYsIHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YykKIHsK
ICAgICBwcmludGsoIlslaS4laV0gZmxhZ3M9JXggY3B1PSVpIiwKLSAgICAgICAgICAgIHN2Yy0+
dmNwdS0+ZG9tYWluLT5kb21haW5faWQsCi0gICAgICAgICAgICBzdmMtPnZjcHUtPnZjcHVfaWQs
CisgICAgICAgICAgICBzdmMtPnVuaXQtPmRvbWFpbi0+ZG9tYWluX2lkLAorICAgICAgICAgICAg
c3ZjLT51bml0LT51bml0X2lkLAogICAgICAgICAgICAgc3ZjLT5mbGFncywKLSAgICAgICAgICAg
IHN2Yy0+dmNwdS0+cHJvY2Vzc29yKTsKKyAgICAgICAgICAgIHNjaGVkX3VuaXRfY3B1KHN2Yy0+
dW5pdCkpOwogCiAgICAgcHJpbnRrKCIgY3JlZGl0PSUiIFBSSWkzMiIgW3c9JXVdIiwgc3ZjLT5j
cmVkaXQsIHN2Yy0+d2VpZ2h0KTsKIApAQCAtMzY3NSwxMiArMzY2MSwxMiBAQCBkdW1wX3BjcHUo
Y29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBpbnQgY3B1KQogICAgICAgICAgICBDUFVNQVNL
X1BSKHBlcl9jcHUoY3B1X3NpYmxpbmdfbWFzaywgY3B1KSksCiAgICAgICAgICAgIENQVU1BU0tf
UFIocGVyX2NwdShjcHVfY29yZV9tYXNrLCBjcHUpKSk7CiAKLSAgICAvKiBjdXJyZW50IFZDUFUg
KG5vdGhpbmcgdG8gc2F5IGlmIHRoYXQncyB0aGUgaWRsZSB2Y3B1KSAqLworICAgIC8qIGN1cnJl
bnQgVU5JVCAobm90aGluZyB0byBzYXkgaWYgdGhhdCdzIHRoZSBpZGxlIHVuaXQpICovCiAgICAg
c3ZjID0gY3NjaGVkMl91bml0KGN1cnJfb25fY3B1KGNwdSkpOwotICAgIGlmICggc3ZjICYmICFp
c19pZGxlX3ZjcHUoc3ZjLT52Y3B1KSApCisgICAgaWYgKCBzdmMgJiYgIWlzX2lkbGVfdW5pdChz
dmMtPnVuaXQpICkKICAgICB7CiAgICAgICAgIHByaW50aygiXHRydW46ICIpOwotICAgICAgICBj
c2NoZWQyX2R1bXBfdmNwdShwcnYsIHN2Yyk7CisgICAgICAgIGNzY2hlZDJfZHVtcF91bml0KHBy
diwgc3ZjKTsKICAgICB9CiB9CiAKQEAgLTM3MzcsNyArMzcyMyw3IEBAIGNzY2hlZDJfZHVtcChj
b25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMpCiAgICAgbGlzdF9mb3JfZWFjaCggaXRlcl9zZG9t
LCAmcHJ2LT5zZG9tICkKICAgICB7CiAgICAgICAgIHN0cnVjdCBjc2NoZWQyX2RvbSAqc2RvbTsK
LSAgICAgICAgc3RydWN0IHZjcHUgKnY7CisgICAgICAgIHN0cnVjdCBzY2hlZF91bml0ICp1bml0
OwogCiAgICAgICAgIHNkb20gPSBsaXN0X2VudHJ5KGl0ZXJfc2RvbSwgc3RydWN0IGNzY2hlZDJf
ZG9tLCBzZG9tX2VsZW0pOwogCkBAIC0zNzQ1LDE5ICszNzMxLDE5IEBAIGNzY2hlZDJfZHVtcChj
b25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMpCiAgICAgICAgICAgICAgICBzZG9tLT5kb20tPmRv
bWFpbl9pZCwKICAgICAgICAgICAgICAgIHNkb20tPndlaWdodCwKICAgICAgICAgICAgICAgIHNk
b20tPmNhcCwKLSAgICAgICAgICAgICAgIHNkb20tPm5yX3ZjcHVzKTsKKyAgICAgICAgICAgICAg
IHNkb20tPm5yX3VuaXRzKTsKIAotICAgICAgICBmb3JfZWFjaF92Y3B1KCBzZG9tLT5kb20sIHYg
KQorICAgICAgICBmb3JfZWFjaF9zY2hlZF91bml0ICggc2RvbS0+ZG9tLCB1bml0ICkKICAgICAg
ICAgewotICAgICAgICAgICAgc3RydWN0IGNzY2hlZDJfdW5pdCAqIGNvbnN0IHN2YyA9IGNzY2hl
ZDJfdW5pdCh2LT5zY2hlZF91bml0KTsKKyAgICAgICAgICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQg
KiBjb25zdCBzdmMgPSBjc2NoZWQyX3VuaXQodW5pdCk7CiAgICAgICAgICAgICBzcGlubG9ja190
ICpsb2NrOwogCi0gICAgICAgICAgICBsb2NrID0gdW5pdF9zY2hlZHVsZV9sb2NrKHN2Yy0+dmNw
dS0+c2NoZWRfdW5pdCk7CisgICAgICAgICAgICBsb2NrID0gdW5pdF9zY2hlZHVsZV9sb2NrKHVu
aXQpOwogCiAgICAgICAgICAgICBwcmludGsoIlx0JTNkOiAiLCArK2xvb3ApOwotICAgICAgICAg
ICAgY3NjaGVkMl9kdW1wX3ZjcHUocHJ2LCBzdmMpOworICAgICAgICAgICAgY3NjaGVkMl9kdW1w
X3VuaXQocHJ2LCBzdmMpOwogCi0gICAgICAgICAgICB1bml0X3NjaGVkdWxlX3VubG9jayhsb2Nr
LCBzdmMtPnZjcHUtPnNjaGVkX3VuaXQpOworICAgICAgICAgICAgdW5pdF9zY2hlZHVsZV91bmxv
Y2sobG9jaywgdW5pdCk7CiAgICAgICAgIH0KICAgICB9CiAKQEAgLTM3ODMsNyArMzc2OSw3IEBA
IGNzY2hlZDJfZHVtcChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMpCiAgICAgICAgICAgICBp
ZiAoIHN2YyApCiAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgcHJpbnRrKCJcdCUzZDog
IiwgbG9vcCsrKTsKLSAgICAgICAgICAgICAgICBjc2NoZWQyX2R1bXBfdmNwdShwcnYsIHN2Yyk7
CisgICAgICAgICAgICAgICAgY3NjaGVkMl9kdW1wX3VuaXQocHJ2LCBzdmMpOwogICAgICAgICAg
ICAgfQogICAgICAgICB9CiAgICAgICAgIHNwaW5fdW5sb2NrKCZycWQtPmxvY2spOwpAQCAtMzg4
Niw3ICszODcyLDcgQEAgY3NjaGVkMl9zd2l0Y2hfc2NoZWQoc3RydWN0IHNjaGVkdWxlciAqbmV3
X29wcywgdW5zaWduZWQgaW50IGNwdSwKICAgICBzdHJ1Y3Qgc2NoZWRfcmVzb3VyY2UgKnNkID0g
Z2V0X3NjaGVkX3JlcyhjcHUpOwogICAgIHVuc2lnbmVkIHJxaTsKIAotICAgIEFTU0VSVChwZGF0
YSAmJiBzdmMgJiYgaXNfaWRsZV92Y3B1KHN2Yy0+dmNwdSkpOworICAgIEFTU0VSVChwZGF0YSAm
JiBzdmMgJiYgaXNfaWRsZV91bml0KHN2Yy0+dW5pdCkpOwogCiAgICAgLyoKICAgICAgKiBXZSBv
d24gb25lIHJ1bnF1ZXVlIGxvY2sgYWxyZWFkeSAoZnJvbSBzY2hlZHVsZV9jcHVfc3dpdGNoKCkp
LiBUaGlzCkBAIC0zODk5LDcgKzM4ODUsNyBAQCBjc2NoZWQyX3N3aXRjaF9zY2hlZChzdHJ1Y3Qg
c2NoZWR1bGVyICpuZXdfb3BzLCB1bnNpZ25lZCBpbnQgY3B1LAogICAgIEFTU0VSVCghbG9jYWxf
aXJxX2lzX2VuYWJsZWQoKSk7CiAgICAgd3JpdGVfbG9jaygmcHJ2LT5sb2NrKTsKIAotICAgIGlk
bGVfdmNwdVtjcHVdLT5zY2hlZF91bml0LT5wcml2ID0gdmRhdGE7CisgICAgc2NoZWRfaWRsZV91
bml0KGNwdSktPnByaXYgPSB2ZGF0YTsKIAogICAgIHJxaSA9IGluaXRfcGRhdGEocHJ2LCBwZGF0
YSwgY3B1KTsKIApAQCAtMzk0MSw3ICszOTI3LDcgQEAgY3NjaGVkMl9kZWluaXRfcGRhdGEoY29u
c3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCB2b2lkICpwY3B1LCBpbnQgY3B1KQogICAgICAqLwog
ICAgIEFTU0VSVChzcGMgJiYgc3BjLT5ydW5xX2lkICE9IC0xKTsKICAgICBBU1NFUlQoY3B1bWFz
a190ZXN0X2NwdShjcHUsICZwcnYtPmluaXRpYWxpemVkKSk7Ci0gICAgCisKICAgICAvKiBGaW5k
IHRoZSBvbGQgcnVucXVldWUgYW5kIHJlbW92ZSB0aGlzIGNwdSBmcm9tIGl0ICovCiAgICAgcnFk
ID0gcHJ2LT5ycWQgKyBzcGMtPnJ1bnFfaWQ7CiAKLS0gCjIuMTYuNAoKCl9fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QK
WGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5v
cmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

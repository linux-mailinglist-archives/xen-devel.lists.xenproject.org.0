Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 8640374FE6
	for <lists+xen-devel@lfdr.de>; Thu, 25 Jul 2019 15:44:16 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hqdzx-0001MY-H8; Thu, 25 Jul 2019 13:41:33 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=dOpT=VW=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1hqdzv-0001MG-HC
 for xen-devel@lists.xenproject.org; Thu, 25 Jul 2019 13:41:31 +0000
X-Inumbo-ID: e788afb4-aee1-11e9-8980-bc764e045a96
Received: from m4a0041g.houston.softwaregrp.com (unknown [15.124.2.87])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id e788afb4-aee1-11e9-8980-bc764e045a96;
 Thu, 25 Jul 2019 13:41:29 +0000 (UTC)
Received: FROM m4a0041g.houston.softwaregrp.com (15.120.17.147) BY
 m4a0041g.houston.softwaregrp.com WITH ESMTP; 
 Thu, 25 Jul 2019 13:41:17 +0000
Received: from M9W0068.microfocus.com (2002:f79:bf::f79:bf) by
 M4W0335.microfocus.com (2002:f78:1193::f78:1193) with Microsoft SMTP Server
 (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256) id
 15.1.1591.10; Thu, 25 Jul 2019 13:31:04 +0000
Received: from NAM02-SN1-obe.outbound.protection.outlook.com (15.124.72.10) by
 M9W0068.microfocus.com (15.121.0.191) with Microsoft SMTP Server
 (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256) id
 15.1.1591.10 via Frontend Transport; Thu, 25 Jul 2019 13:31:04 +0000
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=Xe3kS4D9d16SZYdxGEWlicxEVF7Vm/QB1rXjnXEIjUCm1+hyD0wxhvkYz2GEkZ8+hRW8zL02lGM8Kq1TxVe+FXVcAjIdwrEh6VPhxYn1BqPPvB1cHxnuOXQQBW4GPjIer+CpPA9L9QC2Sr4W4L5/62ekwHO/3InGeL3KCBfroTOp9yvK057/FRWTIPTD0gxUXxTnbaVIRMxfbVmns8eohbfwXd9OdxzCIMt7/oRijnTrOUgcETLCaJry1z/ghhCCviDgeS4IW23tMfdZ8VSwC1hzzkMSYRLRPx9ntaYRnUBcOjlnkowxTPwCGZlvfsytSnl1NTYuQzNiFD3jbpgbIA==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=+zh98d6thDeQImEsK5yLnZTY62bUwqMS08Q/s60r4NE=;
 b=ZFQCwsuRLakXvlOhX++rJkaaPJZwU/futGponwFLuvs2sPV9FkgjQTdPweGucmvuJKyoNlF+drz9gurCQndmh49Yj/v0T/y1x/1CRUoH5BT8i4XaGKremhjQek5MGMqLqIdDgnHIodHPFGDcLnJyLwkZiWnc1JyfOSDWYK6F74ogmoUdi0POpJU++CjUfeacgfHYmhn4uJOfqCoOyl02blmCmp6r6EUc2DEP0iTUPsqGXW/ExBUrGGbfrdpE1Rj7pGJlUT0lzxBwiwadmc8HggwkoICIPeGQ/YfiIauebDGjE8SOWD0ndOfeQS+ON/irY2Aft3L1IoCrNPGyUgwpgw==
ARC-Authentication-Results: i=1; mx.microsoft.com 1;spf=pass
 smtp.mailfrom=suse.com;dmarc=pass action=none header.from=suse.com;dkim=pass
 header.d=suse.com;arc=none
Received: from BY5PR18MB3394.namprd18.prod.outlook.com (10.255.139.95) by
 BY5PR18MB3171.namprd18.prod.outlook.com (10.255.137.24) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2094.17; Thu, 25 Jul 2019 13:31:02 +0000
Received: from BY5PR18MB3394.namprd18.prod.outlook.com
 ([fe80::a4f0:4f46:c076:f74b]) by BY5PR18MB3394.namprd18.prod.outlook.com
 ([fe80::a4f0:4f46:c076:f74b%7]) with mapi id 15.20.2115.005; Thu, 25 Jul 2019
 13:31:02 +0000
From: Jan Beulich <JBeulich@suse.com>
To: "xen-devel@lists.xenproject.org" <xen-devel@lists.xenproject.org>
Thread-Topic: [PATCH v4 05/12] AMD/IOMMU: introduce 128-bit IRTE
 non-guest-APIC IRTE format
Thread-Index: AQHVQu00/BCS+FuYJES+dnnfBcl/1g==
Date: Thu, 25 Jul 2019 13:31:02 +0000
Message-ID: <193f3db9-5731-6841-4723-fa547f89db07@suse.com>
References: <b8ae110a-f94a-4ed2-5cf9-c00ff1c0cb81@suse.com>
In-Reply-To: <b8ae110a-f94a-4ed2-5cf9-c00ff1c0cb81@suse.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-clientproxiedby: LNXP123CA0016.GBRP123.PROD.OUTLOOK.COM
 (2603:10a6:600:d2::28) To BY5PR18MB3394.namprd18.prod.outlook.com
 (2603:10b6:a03:194::31)
authentication-results: spf=none (sender IP is )
 smtp.mailfrom=JBeulich@suse.com; 
x-ms-exchange-messagesentrepresentingtype: 1
x-originating-ip: [87.234.252.170]
x-ms-publictraffictype: Email
x-ms-office365-filtering-correlation-id: 59f90d83-dc14-4f45-29fa-08d711045692
x-microsoft-antispam: BCL:0; PCL:0;
 RULEID:(2390118)(7020095)(4652040)(8989299)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(5600148)(711020)(4605104)(1401327)(2017052603328)(7193020);
 SRVR:BY5PR18MB3171; 
x-ms-traffictypediagnostic: BY5PR18MB3171:
x-microsoft-antispam-prvs: <BY5PR18MB31714879B0F88EBED36190CFB3C10@BY5PR18MB3171.namprd18.prod.outlook.com>
x-ms-oob-tlc-oobclassifiers: OLM:6790;
x-forefront-prvs: 0109D382B0
x-forefront-antispam-report: SFV:NSPM;
 SFS:(10019020)(4636009)(396003)(376002)(366004)(136003)(346002)(39860400002)(54094003)(199004)(189003)(81166006)(11346002)(26005)(6116002)(478600001)(446003)(256004)(52116002)(186003)(316002)(30864003)(2501003)(81156014)(476003)(5640700003)(2351001)(5660300002)(3846002)(486006)(2616005)(54906003)(66066001)(8676002)(6436002)(80792005)(66946007)(76176011)(71200400001)(31686004)(86362001)(71190400001)(99286004)(6486002)(8936002)(64756008)(66556008)(53936002)(6506007)(66446008)(2906002)(14454004)(6916009)(102836004)(7736002)(53946003)(31696002)(6512007)(36756003)(305945005)(68736007)(4326008)(66476007)(14444005)(25786009)(386003);
 DIR:OUT; SFP:1102; SCL:1; SRVR:BY5PR18MB3171;
 H:BY5PR18MB3394.namprd18.prod.outlook.com; FPR:; SPF:None; LANG:en;
 PTR:InfoNoRecords; A:1; MX:1; 
received-spf: None (protection.outlook.com: suse.com does not designate
 permitted sender hosts)
x-ms-exchange-senderadcheck: 1
x-microsoft-antispam-message-info: VItwl2fZ/amt8dRXnGUzJ4//WTJ/BSyeXsz4GCxKHObC8EWYu4FPGfPuXn3ubFnIg4j7WhTNm4zGVrwu1k8rYInOLDOPYTsv3R0LgLZDogPasAl4xXsEHfAvLrlZzbQOQQ/1Hlyqw+t7/ws9H2LjO6UklvVTrjdPbfp4uhHnzm/zuNSEUQnLjN6LIWyALJ0ENnDO0ZSGZLICSr3WdR12J33CPJ6YJkA/7KjYr72Ly1aXiix26GzAFB24sgGnFmopo2x3Vc3ccl7/TBWtcqI54YfhSMXX0Q9zLykhFCMbrHPgHsG5hJCYhmtfcV+xdAkhdyCQL1N8ZLW1UlUK+8L10Lz15zXojDUGbl/vtiotpw8p28wFM1g+PLvdx+0/yoPvg90c/IPXEQgjYMfbSI5ThAaocSYr5iIpObJh/i4zMkE=
Content-ID: <CB6E42BFA0575C4ABC9EFF09A587B721@namprd18.prod.outlook.com>
MIME-Version: 1.0
X-MS-Exchange-CrossTenant-Network-Message-Id: 59f90d83-dc14-4f45-29fa-08d711045692
X-MS-Exchange-CrossTenant-originalarrivaltime: 25 Jul 2019 13:31:02.7854 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: 856b813c-16e5-49a5-85ec-6f081e13b527
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: JBeulich@suse.com
X-MS-Exchange-Transport-CrossTenantHeadersStamped: BY5PR18MB3171
X-OriginatorOrg: suse.com
Subject: [Xen-devel] [PATCH v4 05/12] AMD/IOMMU: introduce 128-bit IRTE
 non-guest-APIC IRTE format
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>,
 Brian Woods <brian.woods@amd.com>,
 Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhpcyBpcyBpbiBwcmVwYXJhdGlvbiBvZiBhY3R1YWxseSBlbmFibGluZyB4MkFQSUMgbW9kZSwg
d2hpY2ggcmVxdWlyZXMNCnRoaXMgd2lkZXIgSVJURSBmb3JtYXQgdG8gYmUgdXNlZC4NCg0KQSBz
cGVjaWZpYyByZW1hcmsgcmVnYXJkaW5nIHRoZSBmaXJzdCBodW5rIGNoYW5naW5nDQphbWRfaW9t
bXVfaW9hcGljX3VwZGF0ZV9pcmUoKTogVGhpcyBieXBhc3Mgd2FzIGludHJvZHVjZWQgZm9yIFhT
QS0zNiwNCmkuZS4gYnkgOTRkNGExMTE5ZCAoIkFNRCxJT01NVTogQ2xlYW4gdXAgb2xkIGVudHJp
ZXMgaW4gcmVtYXBwaW5nDQp0YWJsZXMgd2hlbiBjcmVhdGluZyBuZXcgb25lIikuIE90aGVyIGNv
ZGUgaW50cm9kdWNlZCBieSB0aGF0IGNoYW5nZSBoYXMNCm1lYW53aGlsZSBkaXNhcHBlYXJlZCBv
ciBmdXJ0aGVyIGNoYW5nZWQsIGFuZCBJIHdvbmRlciBpZiAtIHJhdGhlciB0aGFuDQphZGRpbmcg
YW4geDJhcGljX2VuYWJsZWQgY2hlY2sgdG8gdGhlIGNvbmRpdGlvbmFsIC0gdGhlIGJ5cGFzcyBj
b3VsZG4ndA0KYmUgZGVsZXRlZCBhbHRvZ2V0aGVyLiBGb3Igbm93IHRoZSBnb2FsIGlzIHRvIGFm
ZmVjdCB0aGUgbm9uLXgyQVBJQw0KcGF0aHMgYXMgbGl0dGxlIGFzIHBvc3NpYmxlLg0KDQpUYWtl
IHRoZSBsaWJlcnR5IGFuZCB1c2UgdGhlIG5ldyAiZnJlc2giIGZsYWcgdG8gc3VwcHJlc3MgYW4g
dW5uZWVkZWQNCmZsdXNoIGluIHVwZGF0ZV9pbnRyZW1hcF9lbnRyeV9mcm9tX2lvYXBpYygpLg0K
DQpTaWduZWQtb2ZmLWJ5OiBKYW4gQmV1bGljaCA8amJldWxpY2hAc3VzZS5jb20+DQotLS0NCnY0
OiBSZS1iYXNlLiBEbyBhd2F5IHdpdGggc3RhbmRhbG9uZSBzdHJ1Y3QgaXJ0ZV9mdWxsLiBVc2Ug
c21wX3dtYigpLg0KdjM6IEF2b2lkIHVucmVsYXRlZCB0eXBlIGNoYW5nZXMgaW4gdXBkYXRlX2lu
dHJlbWFwX2VudHJ5X2Zyb21faW9hcGljKCkuDQogICAgIERyb3AgaXJ0ZV9tb2RlIGVudW0gYW5k
IHZhcmlhYmxlLiBDb252ZXJ0IElOVFJFTUFQX1RBQkxFX09SREVSIGludG8NCiAgICAgYSBzdGF0
aWMgaGVscGVyLiBDb21tZW50IGJhcnJpZXIoKSB1c2VzLiBTd2l0Y2ggYm9vbGVhbiBiaXRmaWVs
ZHMgdG8NCiAgICAgYm9vbC4NCnYyOiBBZGQgY2FzdCBpbiBnZXRfZnVsbF9kZXN0KCkuIFJlLWJh
c2Ugb3ZlciBjaGFuZ2VzIGVhcmxpZXIgaW4gdGhlDQogICAgIHNlcmllcy4gRG9uJ3QgdXNlIGNt
cHhjaGcxNmIuIFVzZSBiYXJyaWVyKCkgaW5zdGVhZCBvZiB3bWIoKS4NCi0tLQ0KTm90ZSB0aGF0
IEFNRCdzIGRvYyBzYXlzIExvd2VzdCBQcmlvcml0eSAoIkFyYml0cmF0ZWQiIGJ5IHRoZWlyIG5h
bWluZykNCm1vZGUgaXMgdW5hdmFpbGFibGUgaW4geDJBUElDIG1vZGUsIGJ1dCB0aGV5J3ZlIGNv
bmZpcm1lZCB0aGlzIHRvIGJlIGENCm1pc3Rha2Ugb24gdGhlaXIgcGFydC4NCg0KLS0tIGEveGVu
L2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL2lvbW11X2ludHIuYw0KKysrIGIveGVuL2RyaXZlcnMv
cGFzc3Rocm91Z2gvYW1kL2lvbW11X2ludHIuYw0KQEAgLTM5LDEyICszOSwzNiBAQCB1bmlvbiBp
cnRlMzIgew0KICAgICAgfSBmbGRzOw0KICB9Ow0KICANCit1bmlvbiBpcnRlMTI4IHsNCisgICAg
dWludDY0X3QgcmF3WzJdOw0KKyAgICBzdHJ1Y3Qgew0KKyAgICAgICAgYm9vbCByZW1hcF9lbjox
Ow0KKyAgICAgICAgYm9vbCBzdXBfaW9fcGY6MTsNCisgICAgICAgIHVuc2lnbmVkIGludCBpbnRf
dHlwZTozOw0KKyAgICAgICAgYm9vbCBycV9lb2k6MTsNCisgICAgICAgIGJvb2wgZG06MTsNCisg
ICAgICAgIGJvb2wgZ3Vlc3RfbW9kZToxOyAvKiBNQlogKi8NCisgICAgICAgIHVuc2lnbmVkIGlu
dCBkZXN0X2xvOjI0Ow0KKyAgICAgICAgdW5zaWduZWQgaW50IDozMjsNCisgICAgICAgIHVuc2ln
bmVkIGludCB2ZWN0b3I6ODsNCisgICAgICAgIHVuc2lnbmVkIGludCA6MjQ7DQorICAgICAgICB1
bnNpZ25lZCBpbnQgOjI0Ow0KKyAgICAgICAgdW5zaWduZWQgaW50IGRlc3RfaGk6ODsNCisgICAg
fSBmdWxsOw0KK307DQorDQogIHVuaW9uIGlydGVfcHRyIHsNCiAgICAgIHZvaWQgKnB0cjsNCiAg
ICAgIHVuaW9uIGlydGUzMiAqcHRyMzI7DQorICAgIHVuaW9uIGlydGUxMjggKnB0cjEyODsNCiAg
fTsNCiAgDQotI2RlZmluZSBJTlRSRU1BUF9UQUJMRV9PUkRFUiAgICAxDQordW5pb24gaXJ0ZV9j
cHRyIHsNCisgICAgY29uc3Qgdm9pZCAqcHRyOw0KKyAgICBjb25zdCB1bmlvbiBpcnRlMzIgKnB0
cjMyOw0KKyAgICBjb25zdCB1bmlvbiBpcnRlMTI4ICpwdHIxMjg7DQorfSBfX3RyYW5zcGFyZW50
X187DQorDQogICNkZWZpbmUgSU5UUkVNQVBfTEVOR1RIIDB4Qg0KICAjZGVmaW5lIElOVFJFTUFQ
X0VOVFJJRVMgKDEgPDwgSU5UUkVNQVBfTEVOR1RIKQ0KICANCkBAIC01Nyw2ICs4MSwxMyBAQCB1
bnNpZ25lZCBpbnQgbnJfaW9hcGljX3NiZGY7DQogIA0KICBzdGF0aWMgdm9pZCBkdW1wX2ludHJl
bWFwX3RhYmxlcyh1bnNpZ25lZCBjaGFyIGtleSk7DQogIA0KK3N0YXRpYyB1bnNpZ25lZCBpbnQg
X19pbml0IGludHJlbWFwX3RhYmxlX29yZGVyKGNvbnN0IHN0cnVjdCBhbWRfaW9tbXUgKmlvbW11
KQ0KK3sNCisgICAgcmV0dXJuIGlvbW11LT5jdHJsLmdhX2VuDQorICAgICAgICAgICA/IGdldF9v
cmRlcl9mcm9tX2J5dGVzKElOVFJFTUFQX0VOVFJJRVMgKiBzaXplb2YodW5pb24gaXJ0ZTEyOCkp
DQorICAgICAgICAgICA6IGdldF9vcmRlcl9mcm9tX2J5dGVzKElOVFJFTUFQX0VOVFJJRVMgKiBz
aXplb2YodW5pb24gaXJ0ZTMyKSk7DQorfQ0KKw0KICB1bnNpZ25lZCBpbnQgaW9hcGljX2lkX3Rv
X2luZGV4KHVuc2lnbmVkIGludCBhcGljX2lkKQ0KICB7DQogICAgICB1bnNpZ25lZCBpbnQgaWR4
Ow0KQEAgLTEzMSw3ICsxNjIsMTAgQEAgc3RhdGljIHVuaW9uIGlydGVfcHRyIGdldF9pbnRyZW1h
cF9lbnRyeQ0KICANCiAgICAgIEFTU0VSVCh0YWJsZS5wdHIgJiYgKGluZGV4IDwgSU5UUkVNQVBf
RU5UUklFUykpOw0KICANCi0gICAgdGFibGUucHRyMzIgKz0gaW5kZXg7DQorICAgIGlmICggaW9t
bXUtPmN0cmwuZ2FfZW4gKQ0KKyAgICAgICAgdGFibGUucHRyMTI4ICs9IGluZGV4Ow0KKyAgICBl
bHNlDQorICAgICAgICB0YWJsZS5wdHIzMiArPSBpbmRleDsNCiAgDQogICAgICByZXR1cm4gdGFi
bGU7DQogIH0NCkBAIC0xNDEsNyArMTc1LDIyIEBAIHN0YXRpYyB2b2lkIGZyZWVfaW50cmVtYXBf
ZW50cnkoY29uc3Qgc3QNCiAgew0KICAgICAgdW5pb24gaXJ0ZV9wdHIgZW50cnkgPSBnZXRfaW50
cmVtYXBfZW50cnkoaW9tbXUsIGJkZiwgaW5kZXgpOw0KICANCi0gICAgQUNDRVNTX09OQ0UoZW50
cnkucHRyMzItPnJhdykgPSAwOw0KKyAgICBpZiAoIGlvbW11LT5jdHJsLmdhX2VuICkNCisgICAg
ew0KKyAgICAgICAgQUNDRVNTX09OQ0UoZW50cnkucHRyMTI4LT5yYXdbMF0pID0gMDsNCisgICAg
ICAgIC8qDQorICAgICAgICAgKiBMb3cgaGFsZiAoY29udGFpbmluZyBSZW1hcEVuKSBuZWVkcyB0
byBiZSBjbGVhcmVkIGZpcnN0LiAgTm90ZSB0aGF0DQorICAgICAgICAgKiBzdHJpY3RseSBzcGVh
a2luZyBzbXBfd21iKCkgaXNuJ3QgZW5vdWdoLCBhcyBjb25jZXB0dWFsbHkgaXQgZXhwYW5kcw0K
KyAgICAgICAgICogdG8ganVzdCBiYXJyaWVyKCkgd2hlbiAhQ09ORklHX1NNUC4gIEJ1dCB3bWIo
KSB3b3VsZCBiZSBtb3JlIHRoYW4gd2UNCisgICAgICAgICAqIG5lZWQsIHNpbmNlIHRoZSBJT01N
VSBpcyBhIGNhY2hlLWNvaGVyZW50IGVudGl0eSBvbiB0aGUgYnVzLiAgQW5kDQorICAgICAgICAg
KiBnaXZlbiB0aGF0IHdlIGRvbid0IGFsbG93IENPTkZJR19TTVAgdG8gYmUgdHVybmVkIG9mZiwg
dGhlIFNNUA0KKyAgICAgICAgICogdmFyaWFudCB3aWxsIGRvLg0KKyAgICAgICAgICovDQorICAg
ICAgICBzbXBfd21iKCk7DQorICAgICAgICBlbnRyeS5wdHIxMjgtPnJhd1sxXSA9IDA7DQorICAg
IH0NCisgICAgZWxzZQ0KKyAgICAgICAgQUNDRVNTX09OQ0UoZW50cnkucHRyMzItPnJhdykgPSAw
Ow0KICANCiAgICAgIF9fY2xlYXJfYml0KGluZGV4LCBnZXRfaXZyc19tYXBwaW5ncyhpb21tdS0+
c2VnKVtiZGZdLmludHJlbWFwX2ludXNlKTsNCiAgfQ0KQEAgLTE1MSwxNyArMjAwLDQ0IEBAIHN0
YXRpYyB2b2lkIHVwZGF0ZV9pbnRyZW1hcF9lbnRyeShjb25zdA0KICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IHZlY3RvciwgdW5zaWduZWQgaW50IGludF90
eXBlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IGRl
c3RfbW9kZSwgdW5zaWduZWQgaW50IGRlc3QpDQogIHsNCi0gICAgdW5pb24gaXJ0ZTMyIGlydGUg
PSB7DQotICAgICAgICAuZmxkcyA9IHsNCi0gICAgICAgICAgICAucmVtYXBfZW4gPSB0cnVlLA0K
LSAgICAgICAgICAgIC5pbnRfdHlwZSA9IGludF90eXBlLA0KLSAgICAgICAgICAgIC5kbSA9IGRl
c3RfbW9kZSwNCi0gICAgICAgICAgICAuZGVzdCA9IGRlc3QsDQotICAgICAgICAgICAgLnZlY3Rv
ciA9IHZlY3RvciwNCi0gICAgICAgIH0sDQotICAgIH07DQorICAgIGlmICggaW9tbXUtPmN0cmwu
Z2FfZW4gKQ0KKyAgICB7DQorICAgICAgICB1bmlvbiBpcnRlMTI4IGlydGUgPSB7DQorICAgICAg
ICAgICAgLmZ1bGwgPSB7DQorICAgICAgICAgICAgICAgIC5yZW1hcF9lbiA9IHRydWUsDQorICAg
ICAgICAgICAgICAgIC5pbnRfdHlwZSA9IGludF90eXBlLA0KKyAgICAgICAgICAgICAgICAuZG0g
PSBkZXN0X21vZGUsDQorICAgICAgICAgICAgICAgIC5kZXN0X2xvID0gZGVzdCwNCisgICAgICAg
ICAgICAgICAgLmRlc3RfaGkgPSBkZXN0ID4+IDI0LA0KKyAgICAgICAgICAgICAgICAudmVjdG9y
ID0gdmVjdG9yLA0KKyAgICAgICAgICAgIH0sDQorICAgICAgICB9Ow0KKw0KKyAgICAgICAgQUND
RVNTX09OQ0UoZW50cnkucHRyMTI4LT5yYXdbMF0pID0gMDsNCisgICAgICAgIC8qDQorICAgICAg
ICAgKiBMb3cgaGFsZiwgaW4gcGFydGljdWxhciBSZW1hcEVuLCBuZWVkcyB0byBiZSBjbGVhcmVk
IGZpcnN0LiAgU2VlDQorICAgICAgICAgKiBjb21tZW50IGluIGZyZWVfaW50cmVtYXBfZW50cnko
KSByZWdhcmRpbmcgdGhlIGNob2ljZSBvZiBiYXJyaWVyLg0KKyAgICAgICAgICovDQorICAgICAg
ICBzbXBfd21iKCk7DQorICAgICAgICBlbnRyeS5wdHIxMjgtPnJhd1sxXSA9IGlydGUucmF3WzFd
Ow0KKyAgICAgICAgLyogSGlnaCBoYWxmIG5lZWRzIHRvIGJlIHNldCBiZWZvcmUgbG93IG9uZSAo
Y29udGFpbmluZyBSZW1hcEVuKS4gKi8NCisgICAgICAgIHNtcF93bWIoKTsNCisgICAgICAgIEFD
Q0VTU19PTkNFKGVudHJ5LnB0cjEyOC0+cmF3WzBdKSA9IGlydGUucmF3WzBdOw0KKyAgICB9DQor
ICAgIGVsc2UNCisgICAgew0KKyAgICAgICAgdW5pb24gaXJ0ZTMyIGlydGUgPSB7DQorICAgICAg
ICAgICAgLmZsZHMgPSB7DQorICAgICAgICAgICAgICAgIC5yZW1hcF9lbiA9IHRydWUsDQorICAg
ICAgICAgICAgICAgIC5pbnRfdHlwZSA9IGludF90eXBlLA0KKyAgICAgICAgICAgICAgICAuZG0g
PSBkZXN0X21vZGUsDQorICAgICAgICAgICAgICAgIC5kZXN0ID0gZGVzdCwNCisgICAgICAgICAg
ICAgICAgLnZlY3RvciA9IHZlY3RvciwNCisgICAgICAgICAgICB9LA0KKyAgICAgICAgfTsNCiAg
DQotICAgIEFDQ0VTU19PTkNFKGVudHJ5LnB0cjMyLT5yYXcpID0gaXJ0ZS5yYXc7DQorICAgICAg
ICBBQ0NFU1NfT05DRShlbnRyeS5wdHIzMi0+cmF3KSA9IGlydGUucmF3Ow0KKyAgICB9DQogIH0N
CiAgDQogIHN0YXRpYyBpbmxpbmUgaW50IGdldF9ydGVfaW5kZXgoY29uc3Qgc3RydWN0IElPX0FQ
SUNfcm91dGVfZW50cnkgKnJ0ZSkNCkBAIC0xNzUsNiArMjUxLDExIEBAIHN0YXRpYyBpbmxpbmUg
dm9pZCBzZXRfcnRlX2luZGV4KHN0cnVjdA0KICAgICAgcnRlLT5kZWxpdmVyeV9tb2RlID0gb2Zm
c2V0ID4+IDg7DQogIH0NCiAgDQorc3RhdGljIGlubGluZSB1bnNpZ25lZCBpbnQgZ2V0X2Z1bGxf
ZGVzdChjb25zdCB1bmlvbiBpcnRlMTI4ICplbnRyeSkNCit7DQorICAgIHJldHVybiBlbnRyeS0+
ZnVsbC5kZXN0X2xvIHwgKCh1bnNpZ25lZCBpbnQpZW50cnktPmZ1bGwuZGVzdF9oaSA8PCAyNCk7
DQorfQ0KKw0KICBzdGF0aWMgaW50IHVwZGF0ZV9pbnRyZW1hcF9lbnRyeV9mcm9tX2lvYXBpYygN
CiAgICAgIGludCBiZGYsDQogICAgICBzdHJ1Y3QgYW1kX2lvbW11ICppb21tdSwNCkBAIC0xODQs
MTAgKzI2NSwxMSBAQCBzdGF0aWMgaW50IHVwZGF0ZV9pbnRyZW1hcF9lbnRyeV9mcm9tX2lvDQog
IHsNCiAgICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7DQogICAgICB1bmlvbiBpcnRlX3B0ciBlbnRy
eTsNCi0gICAgdTggZGVsaXZlcnlfbW9kZSwgZGVzdCwgdmVjdG9yLCBkZXN0X21vZGU7DQorICAg
IHVpbnQ4X3QgZGVsaXZlcnlfbW9kZSwgdmVjdG9yLCBkZXN0X21vZGU7DQogICAgICBpbnQgcmVx
X2lkOw0KICAgICAgc3BpbmxvY2tfdCAqbG9jazsNCi0gICAgdW5zaWduZWQgaW50IG9mZnNldDsN
CisgICAgdW5zaWduZWQgaW50IGRlc3QsIG9mZnNldDsNCisgICAgYm9vbCBmcmVzaCA9IGZhbHNl
Ow0KICANCiAgICAgIHJlcV9pZCA9IGdldF9pbnRyZW1hcF9yZXF1ZXN0b3JfaWQoaW9tbXUtPnNl
ZywgYmRmKTsNCiAgICAgIGxvY2sgPSBnZXRfaW50cmVtYXBfbG9jayhpb21tdS0+c2VnLCByZXFf
aWQpOw0KQEAgLTE5NSw3ICsyNzcsNyBAQCBzdGF0aWMgaW50IHVwZGF0ZV9pbnRyZW1hcF9lbnRy
eV9mcm9tX2lvDQogICAgICBkZWxpdmVyeV9tb2RlID0gcnRlLT5kZWxpdmVyeV9tb2RlOw0KICAg
ICAgdmVjdG9yID0gcnRlLT52ZWN0b3I7DQogICAgICBkZXN0X21vZGUgPSBydGUtPmRlc3RfbW9k
ZTsNCi0gICAgZGVzdCA9IHJ0ZS0+ZGVzdC5sb2dpY2FsLmxvZ2ljYWxfZGVzdDsNCisgICAgZGVz
dCA9IHgyYXBpY19lbmFibGVkID8gcnRlLT5kZXN0LmRlc3QzMiA6IHJ0ZS0+ZGVzdC5sb2dpY2Fs
LmxvZ2ljYWxfZGVzdDsNCiAgDQogICAgICBzcGluX2xvY2tfaXJxc2F2ZShsb2NrLCBmbGFncyk7
DQogIA0KQEAgLTIxMCwyNSArMjkyLDQwIEBAIHN0YXRpYyBpbnQgdXBkYXRlX2ludHJlbWFwX2Vu
dHJ5X2Zyb21faW8NCiAgICAgICAgICAgICAgcmV0dXJuIC1FTk9TUEM7DQogICAgICAgICAgfQ0K
ICAgICAgICAgICppbmRleCA9IG9mZnNldDsNCi0gICAgICAgIGxvX3VwZGF0ZSA9IDE7DQorICAg
ICAgICBmcmVzaCA9IHRydWU7DQogICAgICB9DQogIA0KICAgICAgZW50cnkgPSBnZXRfaW50cmVt
YXBfZW50cnkoaW9tbXUsIHJlcV9pZCwgb2Zmc2V0KTsNCi0gICAgaWYgKCAhbG9fdXBkYXRlICkN
CisgICAgaWYgKCBmcmVzaCApDQorICAgICAgICAvKiBub3RoaW5nICovOw0KKyAgICBlbHNlIGlm
ICggIWxvX3VwZGF0ZSApDQogICAgICB7DQogICAgICAgICAgLyoNCiAgICAgICAgICAgKiBMb3cg
aGFsZiBvZiBpbmNvbWluZyBSVEUgaXMgYWxyZWFkeSBpbiByZW1hcHBlZCBmb3JtYXQsDQogICAg
ICAgICAgICogc28gbmVlZCB0byByZWNvdmVyIHZlY3RvciBhbmQgZGVsaXZlcnkgbW9kZSBmcm9t
IElSVEUuDQogICAgICAgICAgICovDQogICAgICAgICAgQVNTRVJUKGdldF9ydGVfaW5kZXgocnRl
KSA9PSBvZmZzZXQpOw0KLSAgICAgICAgdmVjdG9yID0gZW50cnkucHRyMzItPmZsZHMudmVjdG9y
Ow0KKyAgICAgICAgaWYgKCBpb21tdS0+Y3RybC5nYV9lbiApDQorICAgICAgICAgICAgdmVjdG9y
ID0gZW50cnkucHRyMTI4LT5mdWxsLnZlY3RvcjsNCisgICAgICAgIGVsc2UNCisgICAgICAgICAg
ICB2ZWN0b3IgPSBlbnRyeS5wdHIzMi0+Zmxkcy52ZWN0b3I7DQorICAgICAgICAvKiBUaGUgSW50
VHlwZSBmaWVsZHMgbWF0Y2ggZm9yIGJvdGggZm9ybWF0cy4gKi8NCiAgICAgICAgICBkZWxpdmVy
eV9tb2RlID0gZW50cnkucHRyMzItPmZsZHMuaW50X3R5cGU7DQogICAgICB9DQorICAgIGVsc2Ug
aWYgKCB4MmFwaWNfZW5hYmxlZCApDQorICAgIHsNCisgICAgICAgIC8qDQorICAgICAgICAgKiBI
aWdoIGhhbGYgb2YgaW5jb21pbmcgUlRFIHdhcyByZWFkIGZyb20gdGhlIEkvTyBBUElDIGFuZCBo
ZW5jZSBtYXkNCisgICAgICAgICAqIG5vdCBob2xkIHRoZSBmdWxsIGRlc3RpbmF0aW9uLCBzbyBu
ZWVkIHRvIHJlY292ZXIgZnVsbCBkZXN0aW5hdGlvbg0KKyAgICAgICAgICogZnJvbSBJUlRFLg0K
KyAgICAgICAgICovDQorICAgICAgICBkZXN0ID0gZ2V0X2Z1bGxfZGVzdChlbnRyeS5wdHIxMjgp
Ow0KKyAgICB9DQogICAgICB1cGRhdGVfaW50cmVtYXBfZW50cnkoaW9tbXUsIGVudHJ5LCB2ZWN0
b3IsIGRlbGl2ZXJ5X21vZGUsIGRlc3RfbW9kZSwgZGVzdCk7DQogIA0KICAgICAgc3Bpbl91bmxv
Y2tfaXJxcmVzdG9yZShsb2NrLCBmbGFncyk7DQogIA0KLSAgICBpZiAoIGlvbW11LT5lbmFibGVk
ICkNCisgICAgaWYgKCBpb21tdS0+ZW5hYmxlZCAmJiAhZnJlc2ggKQ0KICAgICAgew0KICAgICAg
ICAgIHNwaW5fbG9ja19pcnFzYXZlKCZpb21tdS0+bG9jaywgZmxhZ3MpOw0KICAgICAgICAgIGFt
ZF9pb21tdV9mbHVzaF9pbnRyZW1hcChpb21tdSwgcmVxX2lkKTsNCkBAIC0yODYsNiArMzgzLDE4
IEBAIGludCBfX2luaXQgYW1kX2lvbW11X3NldHVwX2lvYXBpY19yZW1hcHANCiAgICAgICAgICAg
ICAgZGVzdF9tb2RlID0gcnRlLmRlc3RfbW9kZTsNCiAgICAgICAgICAgICAgZGVzdCA9IHJ0ZS5k
ZXN0LmxvZ2ljYWwubG9naWNhbF9kZXN0Ow0KICANCisgICAgICAgICAgICBpZiAoIGlvbW11LT5j
dHJsLnh0X2VuICkNCisgICAgICAgICAgICB7DQorICAgICAgICAgICAgICAgIC8qDQorICAgICAg
ICAgICAgICAgICAqIEluIHgyQVBJQyBtb2RlIHdlIGhhdmUgbm8gd2F5IG9mIGRpc2NvdmVyaW5n
IHRoZSBoaWdoIDI0DQorICAgICAgICAgICAgICAgICAqIGJpdHMgb2YgdGhlIGRlc3RpbmF0aW9u
IG9mIGFuIGFscmVhZHkgZW5hYmxlZCBpbnRlcnJ1cHQuDQorICAgICAgICAgICAgICAgICAqIFdl
IGNvbWUgaGVyZSBlYXJsaWVyIHRoYW4gZm9yIHhBUElDIG1vZGUsIHNvIG5vIGludGVycnVwdHMN
CisgICAgICAgICAgICAgICAgICogc2hvdWxkIGhhdmUgYmVlbiBzZXQgdXAgYmVmb3JlLg0KKyAg
ICAgICAgICAgICAgICAgKi8NCisgICAgICAgICAgICAgICAgQU1EX0lPTU1VX0RFQlVHKCJVbm1h
c2tlZCBJTy1BUElDIyV1IGVudHJ5ICV1IGluIHgyQVBJQyBtb2RlXG4iLA0KKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgSU9fQVBJQ19JRChhcGljKSwgcGluKTsNCisgICAgICAgICAg
ICB9DQorDQogICAgICAgICAgICAgIHNwaW5fbG9ja19pcnFzYXZlKGxvY2ssIGZsYWdzKTsNCiAg
ICAgICAgICAgICAgb2Zmc2V0ID0gYWxsb2NfaW50cmVtYXBfZW50cnkoc2VnLCByZXFfaWQsIDEp
Ow0KICAgICAgICAgICAgICBCVUdfT04ob2Zmc2V0ID49IElOVFJFTUFQX0VOVFJJRVMpOw0KQEAg
LTMyMCw3ICs0MjksOCBAQCB2b2lkIGFtZF9pb21tdV9pb2FwaWNfdXBkYXRlX2lyZSgNCiAgICAg
IHN0cnVjdCBJT19BUElDX3JvdXRlX2VudHJ5IG5ld19ydGUgPSB7IDAgfTsNCiAgICAgIHVuc2ln
bmVkIGludCBydGVfbG8gPSAocmVnICYgMSkgPyByZWcgLSAxIDogcmVnOw0KICAgICAgdW5zaWdu
ZWQgaW50IHBpbiA9IChyZWcgLSAweDEwKSAvIDI7DQotICAgIGludCBzYXZlZF9tYXNrLCBzZWcs
IGJkZiwgcmM7DQorICAgIGludCBzZWcsIGJkZiwgcmM7DQorICAgIGJvb2wgc2F2ZWRfbWFzaywg
ZnJlc2ggPSBmYWxzZTsNCiAgICAgIHN0cnVjdCBhbWRfaW9tbXUgKmlvbW11Ow0KICAgICAgdW5z
aWduZWQgaW50IGlkeDsNCiAgDQpAQCAtMzYyLDEyICs0NzIsMjIgQEAgdm9pZCBhbWRfaW9tbXVf
aW9hcGljX3VwZGF0ZV9pcmUoDQogICAgICAgICAgKigoKHUzMiAqKSZuZXdfcnRlKSArIDEpID0g
dmFsdWU7DQogICAgICB9DQogIA0KLSAgICBpZiAoIG5ld19ydGUubWFzayAmJg0KLSAgICAgICAg
IGlvYXBpY19zYmRmW2lkeF0ucGluXzJfaWR4W3Bpbl0gPj0gSU5UUkVNQVBfRU5UUklFUyApDQor
ICAgIGlmICggaW9hcGljX3NiZGZbaWR4XS5waW5fMl9pZHhbcGluXSA+PSBJTlRSRU1BUF9FTlRS
SUVTICkNCiAgICAgIHsNCiAgICAgICAgICBBU1NFUlQoc2F2ZWRfbWFzayk7DQotICAgICAgICBf
X2lvX2FwaWNfd3JpdGUoYXBpYywgcmVnLCB2YWx1ZSk7DQotICAgICAgICByZXR1cm47DQorDQor
ICAgICAgICAvKg0KKyAgICAgICAgICogVGhlcmUncyBub3doZXJlIGV4Y2VwdCB0aGUgSVJURSB0
byBzdG9yZSBhIGZ1bGwgMzItYml0IGRlc3RpbmF0aW9uLA0KKyAgICAgICAgICogc28gd2UgbWF5
IG5vdCBieXBhc3MgZW50cnkgYWxsb2NhdGlvbiBhbmQgdXBkYXRpbmcgb2YgdGhlIGxvdyBSVEUN
CisgICAgICAgICAqIGhhbGYgaW4gdGhlICh1c3VhbCkgY2FzZSBvZiB0aGUgaGlnaCBSVEUgaGFs
ZiBnZXR0aW5nIHdyaXR0ZW4gZmlyc3QuDQorICAgICAgICAgKi8NCisgICAgICAgIGlmICggbmV3
X3J0ZS5tYXNrICYmICF4MmFwaWNfZW5hYmxlZCApDQorICAgICAgICB7DQorICAgICAgICAgICAg
X19pb19hcGljX3dyaXRlKGFwaWMsIHJlZywgdmFsdWUpOw0KKyAgICAgICAgICAgIHJldHVybjsN
CisgICAgICAgIH0NCisNCisgICAgICAgIGZyZXNoID0gdHJ1ZTsNCiAgICAgIH0NCiAgDQogICAg
ICAvKiBtYXNrIHRoZSBpbnRlcnJ1cHQgd2hpbGUgd2UgY2hhbmdlIHRoZSBpbnRyZW1hcCB0YWJs
ZSAqLw0KQEAgLTM5Niw4ICs1MTYsMTIgQEAgdm9pZCBhbWRfaW9tbXVfaW9hcGljX3VwZGF0ZV9p
cmUoDQogICAgICBpZiAoIHJlZyA9PSBydGVfbG8gKQ0KICAgICAgICAgIHJldHVybjsNCiAgDQot
ICAgIC8qIHVubWFzayB0aGUgaW50ZXJydXB0IGFmdGVyIHdlIGhhdmUgdXBkYXRlZCB0aGUgaW50
cmVtYXAgdGFibGUgKi8NCi0gICAgaWYgKCAhc2F2ZWRfbWFzayApDQorICAgIC8qDQorICAgICAq
IFVubWFzayB0aGUgaW50ZXJydXB0IGFmdGVyIHdlIGhhdmUgdXBkYXRlZCB0aGUgaW50cmVtYXAg
dGFibGUuIEFsc28NCisgICAgICogd3JpdGUgdGhlIGxvdyBoYWxmIGlmIGEgZnJlc2ggZW50cnkg
d2FzIGFsbG9jYXRlZCBmb3IgYSBoaWdoIGhhbGYNCisgICAgICogdXBkYXRlIGluIHgyQVBJQyBt
b2RlLg0KKyAgICAgKi8NCisgICAgaWYgKCAhc2F2ZWRfbWFzayB8fCAoeDJhcGljX2VuYWJsZWQg
JiYgZnJlc2gpICkNCiAgICAgIHsNCiAgICAgICAgICBvbGRfcnRlLm1hc2sgPSBzYXZlZF9tYXNr
Ow0KICAgICAgICAgIF9faW9fYXBpY193cml0ZShhcGljLCBydGVfbG8sICooKHUzMiAqKSZvbGRf
cnRlKSk7DQpAQCAtNDExLDMxICs1MzUsNDAgQEAgdW5zaWduZWQgaW50IGFtZF9pb21tdV9yZWFk
X2lvYXBpY19mcm9tXw0KICAgICAgdW5zaWduZWQgaW50IG9mZnNldDsNCiAgICAgIHVuc2lnbmVk
IGludCB2YWwgPSBfX2lvX2FwaWNfcmVhZChhcGljLCByZWcpOw0KICAgICAgdW5zaWduZWQgaW50
IHBpbiA9IChyZWcgLSAweDEwKSAvIDI7DQorICAgIHVpbnQxNl90IHNlZywgYmRmLCByZXFfaWQ7
DQorICAgIGNvbnN0IHN0cnVjdCBhbWRfaW9tbXUgKmlvbW11Ow0KKyAgICB1bmlvbiBpcnRlX3B0
ciBlbnRyeTsNCiAgDQogICAgICBpZHggPSBpb2FwaWNfaWRfdG9faW5kZXgoSU9fQVBJQ19JRChh
cGljKSk7DQogICAgICBpZiAoIGlkeCA9PSBNQVhfSU9fQVBJQ1MgKQ0KICAgICAgICAgIHJldHVy
biB2YWw7DQogIA0KICAgICAgb2Zmc2V0ID0gaW9hcGljX3NiZGZbaWR4XS5waW5fMl9pZHhbcGlu
XTsNCisgICAgaWYgKCBvZmZzZXQgPj0gSU5UUkVNQVBfRU5UUklFUyApDQorICAgICAgICByZXR1
cm4gdmFsOw0KICANCi0gICAgaWYgKCAhKHJlZyAmIDEpICYmIG9mZnNldCA8IElOVFJFTUFQX0VO
VFJJRVMgKQ0KLSAgICB7DQotICAgICAgICB1MTYgYmRmID0gaW9hcGljX3NiZGZbaWR4XS5iZGY7
DQotICAgICAgICB1MTYgc2VnID0gaW9hcGljX3NiZGZbaWR4XS5zZWc7DQotICAgICAgICB1MTYg
cmVxX2lkID0gZ2V0X2ludHJlbWFwX3JlcXVlc3Rvcl9pZChzZWcsIGJkZik7DQotICAgICAgICBj
b25zdCBzdHJ1Y3QgYW1kX2lvbW11ICppb21tdSA9IGZpbmRfaW9tbXVfZm9yX2RldmljZShzZWcs
IGJkZik7DQotICAgICAgICB1bmlvbiBpcnRlX3B0ciBlbnRyeTsNCisgICAgc2VnID0gaW9hcGlj
X3NiZGZbaWR4XS5zZWc7DQorICAgIGJkZiA9IGlvYXBpY19zYmRmW2lkeF0uYmRmOw0KKyAgICBp
b21tdSA9IGZpbmRfaW9tbXVfZm9yX2RldmljZShzZWcsIGJkZik7DQorICAgIGlmICggIWlvbW11
ICkNCisgICAgICAgIHJldHVybiB2YWw7DQorICAgIHJlcV9pZCA9IGdldF9pbnRyZW1hcF9yZXF1
ZXN0b3JfaWQoc2VnLCBiZGYpOw0KKyAgICBlbnRyeSA9IGdldF9pbnRyZW1hcF9lbnRyeShpb21t
dSwgcmVxX2lkLCBvZmZzZXQpOw0KICANCi0gICAgICAgIGlmICggIWlvbW11ICkNCi0gICAgICAg
ICAgICByZXR1cm4gdmFsOw0KKyAgICBpZiAoICEocmVnICYgMSkgKQ0KKyAgICB7DQogICAgICAg
ICAgQVNTRVJUKG9mZnNldCA9PSAodmFsICYgKElOVFJFTUFQX0VOVFJJRVMgLSAxKSkpOw0KLSAg
ICAgICAgZW50cnkgPSBnZXRfaW50cmVtYXBfZW50cnkoaW9tbXUsIHJlcV9pZCwgb2Zmc2V0KTsN
CiAgICAgICAgICB2YWwgJj0gfihJTlRSRU1BUF9FTlRSSUVTIC0gMSk7DQorICAgICAgICAvKiBU
aGUgSW50VHlwZSBmaWVsZHMgbWF0Y2ggZm9yIGJvdGggZm9ybWF0cy4gKi8NCiAgICAgICAgICB2
YWwgfD0gTUFTS19JTlNSKGVudHJ5LnB0cjMyLT5mbGRzLmludF90eXBlLA0KICAgICAgICAgICAg
ICAgICAgICAgICAgICAgSU9fQVBJQ19SRURJUl9ERUxJVl9NT0RFX01BU0spOw0KLSAgICAgICAg
dmFsIHw9IE1BU0tfSU5TUihlbnRyeS5wdHIzMi0+Zmxkcy52ZWN0b3IsDQorICAgICAgICB2YWwg
fD0gTUFTS19JTlNSKGlvbW11LT5jdHJsLmdhX2VuDQorICAgICAgICAgICAgICAgICAgICAgICAg
ID8gZW50cnkucHRyMTI4LT5mdWxsLnZlY3Rvcg0KKyAgICAgICAgICAgICAgICAgICAgICAgICA6
IGVudHJ5LnB0cjMyLT5mbGRzLnZlY3RvciwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgIElP
X0FQSUNfUkVESVJfVkVDVE9SX01BU0spOw0KICAgICAgfQ0KKyAgICBlbHNlIGlmICggeDJhcGlj
X2VuYWJsZWQgKQ0KKyAgICAgICAgdmFsID0gZ2V0X2Z1bGxfZGVzdChlbnRyeS5wdHIxMjgpOw0K
ICANCiAgICAgIHJldHVybiB2YWw7DQogIH0NCkBAIC00NDcsOSArNTgwLDkgQEAgc3RhdGljIGlu
dCB1cGRhdGVfaW50cmVtYXBfZW50cnlfZnJvbV9tcw0KICAgICAgdW5zaWduZWQgbG9uZyBmbGFn
czsNCiAgICAgIHVuaW9uIGlydGVfcHRyIGVudHJ5Ow0KICAgICAgdTE2IHJlcV9pZCwgYWxpYXNf
aWQ7DQotICAgIHU4IGRlbGl2ZXJ5X21vZGUsIGRlc3QsIHZlY3RvciwgZGVzdF9tb2RlOw0KKyAg
ICB1aW50OF90IGRlbGl2ZXJ5X21vZGUsIHZlY3RvciwgZGVzdF9tb2RlOw0KICAgICAgc3Bpbmxv
Y2tfdCAqbG9jazsNCi0gICAgdW5zaWduZWQgaW50IG9mZnNldCwgaTsNCisgICAgdW5zaWduZWQg
aW50IGRlc3QsIG9mZnNldCwgaTsNCiAgDQogICAgICByZXFfaWQgPSBnZXRfZG1hX3JlcXVlc3Rv
cl9pZChpb21tdS0+c2VnLCBiZGYpOw0KICAgICAgYWxpYXNfaWQgPSBnZXRfaW50cmVtYXBfcmVx
dWVzdG9yX2lkKGlvbW11LT5zZWcsIGJkZik7DQpAQCAtNDcwLDcgKzYwMywxMiBAQCBzdGF0aWMg
aW50IHVwZGF0ZV9pbnRyZW1hcF9lbnRyeV9mcm9tX21zDQogICAgICBkZXN0X21vZGUgPSAobXNn
LT5hZGRyZXNzX2xvID4+IE1TSV9BRERSX0RFU1RNT0RFX1NISUZUKSAmIDB4MTsNCiAgICAgIGRl
bGl2ZXJ5X21vZGUgPSAobXNnLT5kYXRhID4+IE1TSV9EQVRBX0RFTElWRVJZX01PREVfU0hJRlQp
ICYgMHgxOw0KICAgICAgdmVjdG9yID0gKG1zZy0+ZGF0YSA+PiBNU0lfREFUQV9WRUNUT1JfU0hJ
RlQpICYgTVNJX0RBVEFfVkVDVE9SX01BU0s7DQotICAgIGRlc3QgPSAobXNnLT5hZGRyZXNzX2xv
ID4+IE1TSV9BRERSX0RFU1RfSURfU0hJRlQpICYgMHhmZjsNCisNCisgICAgaWYgKCB4MmFwaWNf
ZW5hYmxlZCApDQorICAgICAgICBkZXN0ID0gbXNnLT5kZXN0MzI7DQorICAgIGVsc2UNCisgICAg
ICAgIGRlc3QgPSBNQVNLX0VYVFIobXNnLT5hZGRyZXNzX2xvLCBNU0lfQUREUl9ERVNUX0lEX01B
U0spOw0KKw0KICAgICAgb2Zmc2V0ID0gKnJlbWFwX2luZGV4Ow0KICAgICAgaWYgKCBvZmZzZXQg
Pj0gSU5UUkVNQVBfRU5UUklFUyApDQogICAgICB7DQpAQCAtNjE2LDEwICs3NTQsMjEgQEAgdm9p
ZCBhbWRfaW9tbXVfcmVhZF9tc2lfZnJvbV9pcmUoDQogICAgICB9DQogIA0KICAgICAgbXNnLT5k
YXRhICY9IH4oSU5UUkVNQVBfRU5UUklFUyAtIDEpOw0KKyAgICAvKiBUaGUgSW50VHlwZSBmaWVs
ZHMgbWF0Y2ggZm9yIGJvdGggZm9ybWF0cy4gKi8NCiAgICAgIG1zZy0+ZGF0YSB8PSBNQVNLX0lO
U1IoZW50cnkucHRyMzItPmZsZHMuaW50X3R5cGUsDQogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIE1TSV9EQVRBX0RFTElWRVJZX01PREVfTUFTSyk7DQotICAgIG1zZy0+ZGF0YSB8PSBNQVNL
X0lOU1IoZW50cnkucHRyMzItPmZsZHMudmVjdG9yLA0KLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgIE1TSV9EQVRBX1ZFQ1RPUl9NQVNLKTsNCisgICAgaWYgKCBpb21tdS0+Y3RybC5nYV9lbiAp
DQorICAgIHsNCisgICAgICAgIG1zZy0+ZGF0YSB8PSBNQVNLX0lOU1IoZW50cnkucHRyMTI4LT5m
dWxsLnZlY3RvciwNCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTVNJX0RBVEFfVkVD
VE9SX01BU0spOw0KKyAgICAgICAgbXNnLT5kZXN0MzIgPSBnZXRfZnVsbF9kZXN0KGVudHJ5LnB0
cjEyOCk7DQorICAgIH0NCisgICAgZWxzZQ0KKyAgICB7DQorICAgICAgICBtc2ctPmRhdGEgfD0g
TUFTS19JTlNSKGVudHJ5LnB0cjMyLT5mbGRzLnZlY3RvciwNCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgTVNJX0RBVEFfVkVDVE9SX01BU0spOw0KKyAgICAgICAgbXNnLT5kZXN0MzIg
PSBlbnRyeS5wdHIzMi0+Zmxkcy5kZXN0Ow0KKyAgICB9DQogIH0NCiAgDQogIGludCBfX2luaXQg
YW1kX2lvbW11X2ZyZWVfaW50cmVtYXBfdGFibGUoDQpAQCAtNjMxLDcgKzc4MCw3IEBAIGludCBf
X2luaXQgYW1kX2lvbW11X2ZyZWVfaW50cmVtYXBfdGFibGUNCiAgDQogICAgICBpZiAoIHRiICkN
CiAgICAgIHsNCi0gICAgICAgIF9fZnJlZV9hbWRfaW9tbXVfdGFibGVzKHRiLCBJTlRSRU1BUF9U
QUJMRV9PUkRFUik7DQorICAgICAgICBfX2ZyZWVfYW1kX2lvbW11X3RhYmxlcyh0YiwgaW50cmVt
YXBfdGFibGVfb3JkZXIoaW9tbXUpKTsNCiAgICAgICAgICBpdnJzX21hcHBpbmctPmludHJlbWFw
X3RhYmxlID0gTlVMTDsNCiAgICAgIH0NCiAgDQpAQCAtNjQxLDEwICs3OTAsMTAgQEAgaW50IF9f
aW5pdCBhbWRfaW9tbXVfZnJlZV9pbnRyZW1hcF90YWJsZQ0KICB2b2lkICpfX2luaXQgYW1kX2lv
bW11X2FsbG9jX2ludHJlbWFwX3RhYmxlKA0KICAgICAgY29uc3Qgc3RydWN0IGFtZF9pb21tdSAq
aW9tbXUsIHVuc2lnbmVkIGxvbmcgKippbnVzZV9tYXApDQogIHsNCi0gICAgdm9pZCAqdGI7DQot
ICAgIHRiID0gX19hbGxvY19hbWRfaW9tbXVfdGFibGVzKElOVFJFTUFQX1RBQkxFX09SREVSKTsN
CisgICAgdm9pZCAqdGIgPSBfX2FsbG9jX2FtZF9pb21tdV90YWJsZXMoaW50cmVtYXBfdGFibGVf
b3JkZXIoaW9tbXUpKTsNCisNCiAgICAgIEJVR19PTih0YiA9PSBOVUxMKTsNCi0gICAgbWVtc2V0
KHRiLCAwLCBQQUdFX1NJWkUgKiAoMVVMIDw8IElOVFJFTUFQX1RBQkxFX09SREVSKSk7DQorICAg
IG1lbXNldCh0YiwgMCwgUEFHRV9TSVpFIDw8IGludHJlbWFwX3RhYmxlX29yZGVyKGlvbW11KSk7
DQogICAgICAqaW51c2VfbWFwID0geHphbGxvY19hcnJheSh1bnNpZ25lZCBsb25nLCBCSVRTX1RP
X0xPTkdTKElOVFJFTUFQX0VOVFJJRVMpKTsNCiAgICAgIEJVR19PTigqaW51c2VfbWFwID09IE5V
TEwpOw0KICAgICAgcmV0dXJuIHRiOw0KQEAgLTY4NSwxOCArODM0LDI5IEBAIGludCBfX2luaXQg
YW1kX3NldHVwX2hwZXRfbXNpKHN0cnVjdCBtc2kNCiAgICAgIHJldHVybiByYzsNCiAgfQ0KICAN
Ci1zdGF0aWMgdm9pZCBkdW1wX2ludHJlbWFwX3RhYmxlKGNvbnN0IHUzMiAqdGFibGUpDQorc3Rh
dGljIHZvaWQgZHVtcF9pbnRyZW1hcF90YWJsZShjb25zdCBzdHJ1Y3QgYW1kX2lvbW11ICppb21t
dSwNCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuaW9uIGlydGVfY3B0ciB0Ymwp
DQogIHsNCi0gICAgdTMyIGNvdW50Ow0KKyAgICB1bnNpZ25lZCBpbnQgY291bnQ7DQogIA0KLSAg
ICBpZiAoICF0YWJsZSApDQorICAgIGlmICggIXRibC5wdHIgKQ0KICAgICAgICAgIHJldHVybjsN
CiAgDQogICAgICBmb3IgKCBjb3VudCA9IDA7IGNvdW50IDwgSU5UUkVNQVBfRU5UUklFUzsgY291
bnQrKyApDQogICAgICB7DQotICAgICAgICBpZiAoICF0YWJsZVtjb3VudF0gKQ0KLSAgICAgICAg
ICAgIGNvbnRpbnVlOw0KLSAgICAgICAgcHJpbnRrKCIgICAgSVJURVslMDN4XSAlMDh4XG4iLCBj
b3VudCwgdGFibGVbY291bnRdKTsNCisgICAgICAgIGlmICggaW9tbXUtPmN0cmwuZ2FfZW4gKQ0K
KyAgICAgICAgew0KKyAgICAgICAgICAgIGlmICggIXRibC5wdHIxMjhbY291bnRdLnJhd1swXSAm
JiAhdGJsLnB0cjEyOFtjb3VudF0ucmF3WzFdICkNCisgICAgICAgICAgICAgICAgY29udGludWU7
DQorICAgICAgICAgICAgcHJpbnRrKCIgICAgSVJURVslMDN4XSAlMDE2bHhfJTAxNmx4XG4iLA0K
KyAgICAgICAgICAgICAgICAgICBjb3VudCwgdGJsLnB0cjEyOFtjb3VudF0ucmF3WzFdLCB0Ymwu
cHRyMTI4W2NvdW50XS5yYXdbMF0pOw0KKyAgICAgICAgfQ0KKyAgICAgICAgZWxzZQ0KKyAgICAg
ICAgew0KKyAgICAgICAgICAgIGlmICggIXRibC5wdHIzMltjb3VudF0ucmF3ICkNCisgICAgICAg
ICAgICAgICAgY29udGludWU7DQorICAgICAgICAgICAgcHJpbnRrKCIgICAgSVJURVslMDN4XSAl
MDh4XG4iLCBjb3VudCwgdGJsLnB0cjMyW2NvdW50XS5yYXcpOw0KKyAgICAgICAgfQ0KICAgICAg
fQ0KICB9DQogIA0KQEAgLTcxNCw3ICs4NzQsNyBAQCBzdGF0aWMgaW50IGR1bXBfaW50cmVtYXBf
bWFwcGluZyhjb25zdCBzDQogICAgICAgICAgICAgUENJX0ZVTkMoaXZyc19tYXBwaW5nLT5kdGVf
cmVxdWVzdG9yX2lkKSk7DQogIA0KICAgICAgc3Bpbl9sb2NrX2lycXNhdmUoJihpdnJzX21hcHBp
bmctPmludHJlbWFwX2xvY2spLCBmbGFncyk7DQotICAgIGR1bXBfaW50cmVtYXBfdGFibGUoaXZy
c19tYXBwaW5nLT5pbnRyZW1hcF90YWJsZSk7DQorICAgIGR1bXBfaW50cmVtYXBfdGFibGUoaW9t
bXUsIGl2cnNfbWFwcGluZy0+aW50cmVtYXBfdGFibGUpOw0KICAgICAgc3Bpbl91bmxvY2tfaXJx
cmVzdG9yZSgmKGl2cnNfbWFwcGluZy0+aW50cmVtYXBfbG9jayksIGZsYWdzKTsNCiAgDQogICAg
ICBwcm9jZXNzX3BlbmRpbmdfc29mdGlycXMoKTsNCkBAIC03MzMsNiArODkzLDggQEAgc3RhdGlj
IHZvaWQgZHVtcF9pbnRyZW1hcF90YWJsZXModW5zaWduZQ0KICAgICAgcHJpbnRrKCItLS0gRHVt
cGluZyBTaGFyZWQgSU9NTVUgSW50ZXJydXB0IFJlbWFwcGluZyBUYWJsZSAtLS1cbiIpOw0KICAN
CiAgICAgIHNwaW5fbG9ja19pcnFzYXZlKCZzaGFyZWRfaW50cmVtYXBfbG9jaywgZmxhZ3MpOw0K
LSAgICBkdW1wX2ludHJlbWFwX3RhYmxlKHNoYXJlZF9pbnRyZW1hcF90YWJsZSk7DQorICAgIGR1
bXBfaW50cmVtYXBfdGFibGUobGlzdF9maXJzdF9lbnRyeSgmYW1kX2lvbW11X2hlYWQsIHN0cnVj
dCBhbWRfaW9tbXUsDQorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBs
aXN0KSwNCisgICAgICAgICAgICAgICAgICAgICAgICBzaGFyZWRfaW50cmVtYXBfdGFibGUpOw0K
ICAgICAgc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmc2hhcmVkX2ludHJlbWFwX2xvY2ssIGZsYWdz
KTsNCiAgfQ0KDQpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
XwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpo
dHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

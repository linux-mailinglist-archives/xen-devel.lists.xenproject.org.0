Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id D541D1A113
	for <lists+xen-devel@lfdr.de>; Fri, 10 May 2019 18:14:45 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hP87s-0004aT-B9; Fri, 10 May 2019 16:12:00 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=35pT=TK=citrix.com=prvs=026e1af23=roger.pau@srs-us1.protection.inumbo.net>)
 id 1hP87q-0004Zu-HX
 for xen-devel@lists.xenproject.org; Fri, 10 May 2019 16:11:58 +0000
X-Inumbo-ID: 53189c88-733e-11e9-8980-bc764e045a96
Received: from SMTP03.CITRIX.COM (unknown [162.221.156.55])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 53189c88-733e-11e9-8980-bc764e045a96;
 Fri, 10 May 2019 16:11:53 +0000 (UTC)
X-IronPort-AV: E=Sophos;i="5.60,453,1549929600"; d="scan'208";a="85330717"
From: Roger Pau Monne <roger.pau@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Fri, 10 May 2019 18:10:54 +0200
Message-ID: <20190510161056.48648-4-roger.pau@citrix.com>
X-Mailer: git-send-email 2.17.2 (Apple Git-113)
In-Reply-To: <20190510161056.48648-1-roger.pau@citrix.com>
References: <20190510161056.48648-1-roger.pau@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH 3/5] pci: switch pci_conf_{read/write} to use
 pci_sbdf_t
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Kevin Tian <kevin.tian@intel.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wei.liu2@citrix.com>,
 Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>,
 Brian Woods <brian.woods@amd.com>, Roger Pau Monne <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

cGNpX2RldiBhbHJlYWR5IHVzZXMgcGNpX3NiZGZfdCwgc28gcHJvcGFnYXRlIHRoZSB1c2FnZSBv
ZiB0aGUgdHlwZSB0bwpwY2lfY29uZiBmdW5jdGlvbnMgaW4gb3JkZXIgdG8gc2hvcnRlbiB0aGUg
Y2FsbHMgd2hlbiBtYWRlIGZyb20gYQpwY2lfZGV2IHN0cnVjdC4KCk5vIGZ1bmN0aW9uYWwgY2hh
bmdlIGludGVuZGVkLgoKU2lnbmVkLW9mZi1ieTogUm9nZXIgUGF1IE1vbm7DqSA8cm9nZXIucGF1
QGNpdHJpeC5jb20+Ci0tLQpDYzogSmFuIEJldWxpY2ggPGpiZXVsaWNoQHN1c2UuY29tPgpDYzog
QW5kcmV3IENvb3BlciA8YW5kcmV3LmNvb3BlcjNAY2l0cml4LmNvbT4KQ2M6IFdlaSBMaXUgPHdl
aS5saXUyQGNpdHJpeC5jb20+CkNjOiBHZW9yZ2UgRHVubGFwIDxHZW9yZ2UuRHVubGFwQGV1LmNp
dHJpeC5jb20+CkNjOiBJYW4gSmFja3NvbiA8aWFuLmphY2tzb25AZXUuY2l0cml4LmNvbT4KQ2M6
IEp1bGllbiBHcmFsbCA8anVsaWVuLmdyYWxsQGFybS5jb20+CkNjOiBLb25yYWQgUnplc3p1dGVr
IFdpbGsgPGtvbnJhZC53aWxrQG9yYWNsZS5jb20+CkNjOiBTdGVmYW5vIFN0YWJlbGxpbmkgPHNz
dGFiZWxsaW5pQGtlcm5lbC5vcmc+CkNjOiBUaW0gRGVlZ2FuIDx0aW1AeGVuLm9yZz4KQ2M6IFN1
cmF2ZWUgU3V0aGlrdWxwYW5pdCA8c3VyYXZlZS5zdXRoaWt1bHBhbml0QGFtZC5jb20+CkNjOiBC
cmlhbiBXb29kcyA8YnJpYW4ud29vZHNAYW1kLmNvbT4KQ2M6IEtldmluIFRpYW4gPGtldmluLnRp
YW5AaW50ZWwuY29tPgotLS0KIHhlbi9hcmNoL3g4Ni9jcHUvYW1kLmMgICAgICAgICAgICAgICAg
ICAgICB8ICAyNyArKy0tCiB4ZW4vYXJjaC94ODYvZG1pX3NjYW4uYyAgICAgICAgICAgICAgICAg
ICAgfCAgIDkgKy0KIHhlbi9hcmNoL3g4Ni9tbS5jICAgICAgICAgICAgICAgICAgICAgICAgICB8
ICAgMiArLQogeGVuL2FyY2gveDg2L21zaS5jICAgICAgICAgICAgICAgICAgICAgICAgIHwgMTc3
ICsrKysrKysrKy0tLS0tLS0tLS0tLQogeGVuL2FyY2gveDg2L29wcm9maWxlL29wX21vZGVsX2F0
aGxvbi5jICAgIHwgIDEyICstCiB4ZW4vYXJjaC94ODYveDg2XzY0L21tY29uZi1mYW0xMGguYyAg
ICAgICAgfCAgMTMgKy0KIHhlbi9hcmNoL3g4Ni94ODZfNjQvbW1jb25maWctc2hhcmVkLmMgICAg
ICB8ICAyNiArLS0KIHhlbi9hcmNoL3g4Ni94ODZfNjQvcGNpLmMgICAgICAgICAgICAgICAgICB8
ICAzMiArKy0tCiB4ZW4vZHJpdmVycy9hY3BpL3JlYm9vdC5jICAgICAgICAgICAgICAgICAgfCAg
IDggKy0KIHhlbi9kcml2ZXJzL2NoYXIvZWhjaS1kYmdwLmMgICAgICAgICAgICAgICB8ICA3NSAr
KysrKy0tLS0KIHhlbi9kcml2ZXJzL2NoYXIvbnMxNjU1MC5jICAgICAgICAgICAgICAgICB8ICA4
MCArKysrKy0tLS0tCiB4ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfZGV0ZWN0LmMg
fCAgIDMgKy0KIHhlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9pb21tdV9pbml0LmMgICB8ICAy
NiArLS0KIHhlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2F0cy5oICAgICAgICAgICAgICB8ICAgNCAr
LQogeGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvcGNpLmMgICAgICAgICAgICAgIHwgMTA2ICsrKysr
LS0tLS0tLQogeGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvdnRkL2RtYXIuYyAgICAgICAgIHwgIDE4
ICsrLQogeGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvdnRkL3F1aXJrcy5jICAgICAgIHwgIDY5ICsr
KystLS0tCiB4ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC94ODYvYXRzLmMgICAgICAgICAgfCAgMTUg
Ky0KIHhlbi9kcml2ZXJzL3BjaS9wY2kuYyAgICAgICAgICAgICAgICAgICAgICB8ICA0MyArKyst
LQogeGVuL2RyaXZlcnMvdmlkZW8vdmdhLmMgICAgICAgICAgICAgICAgICAgIHwgIDIxICstLQog
eGVuL2RyaXZlcnMvdnBjaS9oZWFkZXIuYyAgICAgICAgICAgICAgICAgIHwgIDUzICsrLS0tLQog
eGVuL2RyaXZlcnMvdnBjaS9tc2kuYyAgICAgICAgICAgICAgICAgICAgIHwgICA2ICstCiB4ZW4v
ZHJpdmVycy92cGNpL21zaXguYyAgICAgICAgICAgICAgICAgICAgfCAgMTIgKy0KIHhlbi9kcml2
ZXJzL3ZwY2kvdnBjaS5jICAgICAgICAgICAgICAgICAgICB8ICA0MiArKy0tLQogeGVuL2luY2x1
ZGUveGVuL3BjaS5oICAgICAgICAgICAgICAgICAgICAgIHwgIDI5ICsrLS0KIDI1IGZpbGVzIGNo
YW5nZWQsIDQ0NCBpbnNlcnRpb25zKCspLCA0NjQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEv
eGVuL2FyY2gveDg2L2NwdS9hbWQuYyBiL3hlbi9hcmNoL3g4Ni9jcHUvYW1kLmMKaW5kZXggZTE5
YTVlYWQzZS4uMDE0ZDg4OTI1YyAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L2NwdS9hbWQuYwor
KysgYi94ZW4vYXJjaC94ODYvY3B1L2FtZC5jCkBAIC00MTcsMTUgKzQxNywyMSBAQCBzdGF0aWMg
dm9pZCBkaXNhYmxlX2MxX3JhbXBpbmcodm9pZCkKIAlpbnQgbm9kZSwgbnJfbm9kZXM7CiAKIAkv
KiBSZWFkIHRoZSBudW1iZXIgb2Ygbm9kZXMgZnJvbSB0aGUgZmlyc3QgTm9ydGhicmlkZ2UuICov
Ci0JbnJfbm9kZXMgPSAoKHBjaV9jb25mX3JlYWQzMigwLCAwLCAweDE4LCAweDAsIDB4NjApPj40
KSYweDA3KSsxOworCW5yX25vZGVzID0gKChwY2lfY29uZl9yZWFkMzIoUENJX1NCREZfVCgwLCAw
LCAweDE4LCAwKSwKKwkJCQkgICAgIDB4NjApPj40KSYweDA3KSsxOwogCWZvciAobm9kZSA9IDA7
IG5vZGUgPCBucl9ub2Rlczsgbm9kZSsrKSB7CisJCWNvbnN0IHBjaV9zYmRmX3Qgc2JkZiA9IHsK
KwkJCS5kZXYgPSAweDE4ICArIG5vZGUsCisJCQkuZnVuYyA9IDB4MworCQl9OworCiAJCS8qIFBN
TTc6IGJ1cz0wLCBkZXY9MHgxOCtub2RlLCBmdW5jdGlvbj0weDMsIHJlZ2lzdGVyPTB4ODcuICov
Ci0JCXBtbTcgPSBwY2lfY29uZl9yZWFkOCgwLCAwLCAweDE4K25vZGUsIDB4MywgMHg4Nyk7CisJ
CXBtbTcgPSBwY2lfY29uZl9yZWFkOChzYmRmLCAweDg3KTsKIAkJLyogSW52YWxpZCByZWFkIG1l
YW5zIHdlJ3ZlIHVwZGF0ZWQgZXZlcnkgTm9ydGhicmlkZ2UuICovCiAJCWlmIChwbW03ID09IDB4
RkYpCiAJCQlicmVhazsKIAkJcG1tNyAmPSAweEZDOyAvKiBjbGVhciBwbW03WzE6MF0gKi8KLQkJ
cGNpX2NvbmZfd3JpdGU4KDAsIDAsIDB4MTgrbm9kZSwgMHgzLCAweDg3LCBwbW03KTsKKwkJcGNp
X2NvbmZfd3JpdGU4KHNiZGYsIDB4ODcsIHBtbTcpOwogCQlwcmludGsgKCJBTUQ6IERpc2FibGlu
ZyBDMSBDbG9jayBSYW1waW5nIE5vZGUgIyV4XG4iLCBub2RlKTsKIAl9CiB9CkBAIC02OTYsOCAr
NzAyLDEzIEBAIHN0YXRpYyB2b2lkIGluaXRfYW1kKHN0cnVjdCBjcHVpbmZvX3g4NiAqYykKIAog
CWlmIChjLT54ODYgPT0gMHgxNiAmJiBjLT54ODZfbW9kZWwgPD0gMHhmKSB7CiAJCWlmIChjID09
ICZib290X2NwdV9kYXRhKSB7Ci0JCQlsID0gcGNpX2NvbmZfcmVhZDMyKDAsIDAsIDB4MTgsIDB4
MywgMHg1OCk7Ci0JCQloID0gcGNpX2NvbmZfcmVhZDMyKDAsIDAsIDB4MTgsIDB4MywgMHg1Yyk7
CisJCQljb25zdCBwY2lfc2JkZl90IHNiZGYgPSB7CisJCQkJLmRldiA9IDB4MTgsCisJCQkJLmZ1
bmMgPSAweDMsCisJCQl9OworCisJCQlsID0gcGNpX2NvbmZfcmVhZDMyKHNiZGYsIDB4NTgpOwor
CQkJaCA9IHBjaV9jb25mX3JlYWQzMihzYmRmLCAweDVjKTsKIAkJCWlmICgobCAmIDB4MWYpIHwg
KGggJiAweDEpKQogCQkJCXByaW50ayhLRVJOX1dBUk5JTkcKIAkJCQkgICAgICAgIkFwcGx5aW5n
IHdvcmthcm91bmQgZm9yIGVycmF0dW0gNzkyOiAlcyVzJXNcbiIsCkBAIC03MDYsMTIgKzcxNywx
MCBAQCBzdGF0aWMgdm9pZCBpbml0X2FtZChzdHJ1Y3QgY3B1aW5mb194ODYgKmMpCiAJCQkJICAg
ICAgIChoICYgMHgxKSA/ICJjbGVhcmluZyBEMThGM3g1Q1swXSIgOiAiIik7CiAKIAkJCWlmIChs
ICYgMHgxZikKLQkJCQlwY2lfY29uZl93cml0ZTMyKDAsIDAsIDB4MTgsIDB4MywgMHg1OCwKLQkJ
CQkJCSBsICYgfjB4MWYpOworCQkJCXBjaV9jb25mX3dyaXRlMzIoc2JkZiwgMHg1OCwgbCAmIH4w
eDFmKTsKIAogCQkJaWYgKGggJiAweDEpCi0JCQkJcGNpX2NvbmZfd3JpdGUzMigwLCAwLCAweDE4
LCAweDMsIDB4NWMsCi0JCQkJCQkgaCAmIH4weDEpOworCQkJCXBjaV9jb25mX3dyaXRlMzIoc2Jk
ZiwgMHg1YywgaCAmIH4weDEpOwogCQl9CiAKIAkJcmRtc3JsKE1TUl9BTUQ2NF9MU19DRkcsIHZh
bHVlKTsKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9kbWlfc2Nhbi5jIGIveGVuL2FyY2gveDg2
L2RtaV9zY2FuLmMKaW5kZXggZmNkZjJkMzk1Mi4uNTk1NTdmYTU3YiAxMDA2NDQKLS0tIGEveGVu
L2FyY2gveDg2L2RtaV9zY2FuLmMKKysrIGIveGVuL2FyY2gveDg2L2RtaV9zY2FuLmMKQEAgLTQ2
OCwxNiArNDY4LDE5IEBAIHN0YXRpYyBfX2luaXQgaW50IGJyb2tlbl90b3NoaWJhX2tleWJvYXJk
KHN0cnVjdCBkbWlfYmxhY2tsaXN0ICpkKQogc3RhdGljIGludCBfX2luaXQgaWNoMTBfYmlvc19x
dWlyayhzdHJ1Y3QgZG1pX3N5c3RlbV9pZCAqZCkKIHsKICAgICB1MzIgcG9ydCwgc21pY3RsOwor
ICAgIGNvbnN0IHBjaV9zYmRmX3Qgc2JkZiA9IHsKKwkuZGV2ID0gMHgxZiwKKyAgICB9OwogCi0g
ICAgaWYgKCBwY2lfY29uZl9yZWFkMTYoMCwgMCwgMHgxZiwgMCwgUENJX1ZFTkRPUl9JRCkgIT0g
MHg4MDg2ICkKKyAgICBpZiAoIHBjaV9jb25mX3JlYWQxNihzYmRmLCBQQ0lfVkVORE9SX0lEKSAh
PSAweDgwODYgKQogICAgICAgICByZXR1cm4gMDsKIAotICAgIHN3aXRjaCAoIHBjaV9jb25mX3Jl
YWQxNigwLCAwLCAweDFmLCAwLCBQQ0lfREVWSUNFX0lEKSApIHsKKyAgICBzd2l0Y2ggKCBwY2lf
Y29uZl9yZWFkMTYoc2JkZiwgUENJX0RFVklDRV9JRCkgKSB7CiAgICAgY2FzZSAweDNhMTQ6CiAg
ICAgY2FzZSAweDNhMTY6CiAgICAgY2FzZSAweDNhMTg6CiAgICAgY2FzZSAweDNhMWE6Ci0gICAg
ICAgIHBvcnQgPSAocGNpX2NvbmZfcmVhZDE2KDAsIDAsIDB4MWYsIDAsIDB4NDApICYgMHhmZjgw
KSArIDB4MzA7CisgICAgICAgIHBvcnQgPSAocGNpX2NvbmZfcmVhZDE2KHNiZGYsIDB4NDApICYg
MHhmZjgwKSArIDB4MzA7CiAgICAgICAgIHNtaWN0bCA9IGlubChwb3J0KTsKICAgICAgICAgLyog
dHVybiBvZmYgTEVHQUNZX1VTQnssMn1fRU4gaWYgZW5hYmxlZCAqLwogICAgICAgICBpZiAoIHNt
aWN0bCAmIDB4MjAwMDggKQpkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L21tLmMgYi94ZW4vYXJj
aC94ODYvbW0uYwppbmRleCA0NWZhZGJhYjYxLi4zN2Q4MTQxZWQyIDEwMDY0NAotLS0gYS94ZW4v
YXJjaC94ODYvbW0uYworKysgYi94ZW4vYXJjaC94ODYvbW0uYwpAQCAtNTk4NCw3ICs1OTg0LDcg
QEAgY29uc3Qgc3RydWN0IHBsYXRmb3JtX2JhZF9wYWdlICpfX2luaXQgZ2V0X3BsYXRmb3JtX2Jh
ZHBhZ2VzKHVuc2lnbmVkIGludCAqYXJyYXkKICAgICB9CiAKICAgICAqYXJyYXlfc2l6ZSA9IEFS
UkFZX1NJWkUoc25iX2JhZF9wYWdlcyk7Ci0gICAgaWdkX2lkID0gcGNpX2NvbmZfcmVhZDMyKDAs
IDAsIDIsIDAsIDApOworICAgIGlnZF9pZCA9IHBjaV9jb25mX3JlYWQzMihQQ0lfU0JERl9UKDAs
IDAsIDIsIDApLCAwKTsKICAgICBpZiAoIElTX1NOQl9HRlgoaWdkX2lkKSApCiAgICAgICAgIHJl
dHVybiBzbmJfYmFkX3BhZ2VzOwogCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvbXNpLmMgYi94
ZW4vYXJjaC94ODYvbXNpLmMKaW5kZXggZjMwZjU5MmVlMi4uYWQ0YTcyZDU2YiAxMDA2NDQKLS0t
IGEveGVuL2FyY2gveDg2L21zaS5jCisrKyBiL3hlbi9hcmNoL3g4Ni9tc2kuYwpAQCAtMTI0LDI5
ICsxMjQsMjAgQEAgc3RhdGljIHZvaWQgbXNpeF9wdXRfZml4bWFwKHN0cnVjdCBhcmNoX21zaXgg
Km1zaXgsIGludCBpZHgpCiAKIHN0YXRpYyBib29sIG1lbW9yeV9kZWNvZGVkKGNvbnN0IHN0cnVj
dCBwY2lfZGV2ICpkZXYpCiB7Ci0gICAgdWludDhfdCBidXMsIHNsb3QsIGZ1bmM7CisgICAgcGNp
X3NiZGZfdCBzYmRmID0gZGV2LT5zYmRmOwogCi0gICAgaWYgKCAhZGV2LT5pbmZvLmlzX3ZpcnRm
biApCisgICAgaWYgKCBkZXYtPmluZm8uaXNfdmlydGZuICkKICAgICB7Ci0gICAgICAgIGJ1cyA9
IGRldi0+c2JkZi5idXM7Ci0gICAgICAgIHNsb3QgPSBkZXYtPnNiZGYuZGV2OwotICAgICAgICBm
dW5jID0gZGV2LT5zYmRmLmZ1bmM7Ci0gICAgfQotICAgIGVsc2UKLSAgICB7Ci0gICAgICAgIGJ1
cyA9IGRldi0+aW5mby5waHlzZm4uYnVzOwotICAgICAgICBzbG90ID0gUENJX1NMT1QoZGV2LT5p
bmZvLnBoeXNmbi5kZXZmbik7Ci0gICAgICAgIGZ1bmMgPSBQQ0lfRlVOQyhkZXYtPmluZm8ucGh5
c2ZuLmRldmZuKTsKKyAgICAgICAgc2JkZi5idXMgPSBkZXYtPmluZm8ucGh5c2ZuLmJ1czsKKyAg
ICAgICAgc2JkZi5leHRmdW5jID0gZGV2LT5pbmZvLnBoeXNmbi5kZXZmbjsKICAgICB9CiAKLSAg
ICByZXR1cm4gISEocGNpX2NvbmZfcmVhZDE2KGRldi0+c2JkZi5zZWcsIGJ1cywgc2xvdCwgZnVu
YywgUENJX0NPTU1BTkQpICYKLSAgICAgICAgICAgICAgUENJX0NPTU1BTkRfTUVNT1JZKTsKKyAg
ICByZXR1cm4gISEocGNpX2NvbmZfcmVhZDE2KHNiZGYsIFBDSV9DT01NQU5EKSAmIFBDSV9DT01N
QU5EX01FTU9SWSk7CiB9CiAKIHN0YXRpYyBib29sIG1zaXhfbWVtb3J5X2RlY29kZWQoY29uc3Qg
c3RydWN0IHBjaV9kZXYgKmRldiwgdW5zaWduZWQgaW50IHBvcykKIHsKLSAgICB1MTYgY29udHJv
bCA9IHBjaV9jb25mX3JlYWQxNihkZXYtPnNiZGYuc2VnLCBkZXYtPnNiZGYuYnVzLCBkZXYtPnNi
ZGYuZGV2LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldi0+c2JkZi5mdW5j
LCBtc2l4X2NvbnRyb2xfcmVnKHBvcykpOworICAgIHUxNiBjb250cm9sID0gcGNpX2NvbmZfcmVh
ZDE2KGRldi0+c2JkZiwgbXNpeF9jb250cm9sX3JlZyhwb3MpKTsKIAogICAgIGlmICggIShjb250
cm9sICYgUENJX01TSVhfRkxBR1NfRU5BQkxFKSApCiAgICAgICAgIHJldHVybiBmYWxzZTsKQEAg
LTIwMCwyNSArMTkxLDIwIEBAIHN0YXRpYyBib29sIHJlYWRfbXNpX21zZyhzdHJ1Y3QgbXNpX2Rl
c2MgKmVudHJ5LCBzdHJ1Y3QgbXNpX21zZyAqbXNnKQogICAgIHsKICAgICAgICAgc3RydWN0IHBj
aV9kZXYgKmRldiA9IGVudHJ5LT5kZXY7CiAgICAgICAgIGludCBwb3MgPSBlbnRyeS0+bXNpX2F0
dHJpYi5wb3M7Ci0gICAgICAgIHVpbnQxNl90IGRhdGEsIHNlZyA9IGRldi0+c2JkZi5zZWc7Ci0g
ICAgICAgIHVpbnQ4X3QgYnVzID0gZGV2LT5zYmRmLmJ1czsKLSAgICAgICAgdWludDhfdCBzbG90
ID0gZGV2LT5zYmRmLmRldjsKLSAgICAgICAgdWludDhfdCBmdW5jID0gZGV2LT5zYmRmLmZ1bmM7
CisgICAgICAgIHVpbnQxNl90IGRhdGE7CiAKLSAgICAgICAgbXNnLT5hZGRyZXNzX2xvID0gcGNp
X2NvbmZfcmVhZDMyKHNlZywgYnVzLCBzbG90LCBmdW5jLAorICAgICAgICBtc2ctPmFkZHJlc3Nf
bG8gPSBwY2lfY29uZl9yZWFkMzIoZGV2LT5zYmRmLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgbXNpX2xvd2VyX2FkZHJlc3NfcmVnKHBvcykpOwogICAgICAgICBp
ZiAoIGVudHJ5LT5tc2lfYXR0cmliLmlzXzY0ICkKICAgICAgICAgewotICAgICAgICAgICAgbXNn
LT5hZGRyZXNzX2hpID0gcGNpX2NvbmZfcmVhZDMyKHNlZywgYnVzLCBzbG90LCBmdW5jLAorICAg
ICAgICAgICAgbXNnLT5hZGRyZXNzX2hpID0gcGNpX2NvbmZfcmVhZDMyKGRldi0+c2JkZiwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2lfdXBwZXJfYWRk
cmVzc19yZWcocG9zKSk7Ci0gICAgICAgICAgICBkYXRhID0gcGNpX2NvbmZfcmVhZDE2KHNlZywg
YnVzLCBzbG90LCBmdW5jLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2lf
ZGF0YV9yZWcocG9zLCAxKSk7CisgICAgICAgICAgICBkYXRhID0gcGNpX2NvbmZfcmVhZDE2KGRl
di0+c2JkZiwgbXNpX2RhdGFfcmVnKHBvcywgMSkpOwogICAgICAgICB9CiAgICAgICAgIGVsc2UK
ICAgICAgICAgewogICAgICAgICAgICAgbXNnLT5hZGRyZXNzX2hpID0gMDsKLSAgICAgICAgICAg
IGRhdGEgPSBwY2lfY29uZl9yZWFkMTYoc2VnLCBidXMsIHNsb3QsIGZ1bmMsCi0gICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIG1zaV9kYXRhX3JlZyhwb3MsIDApKTsKKyAgICAgICAg
ICAgIGRhdGEgPSBwY2lfY29uZl9yZWFkMTYoZGV2LT5zYmRmLCBtc2lfZGF0YV9yZWcocG9zLCAw
KSk7CiAgICAgICAgIH0KICAgICAgICAgbXNnLT5kYXRhID0gZGF0YTsKICAgICAgICAgYnJlYWs7
CkBAIC0yNjUsMjggKzI1MSwyMiBAQCBzdGF0aWMgaW50IHdyaXRlX21zaV9tc2coc3RydWN0IG1z
aV9kZXNjICplbnRyeSwgc3RydWN0IG1zaV9tc2cgKm1zZykKICAgICB7CiAgICAgICAgIHN0cnVj
dCBwY2lfZGV2ICpkZXYgPSBlbnRyeS0+ZGV2OwogICAgICAgICBpbnQgcG9zID0gZW50cnktPm1z
aV9hdHRyaWIucG9zOwotICAgICAgICB1aW50MTZfdCBzZWcgPSBkZXYtPnNiZGYuc2VnOwotICAg
ICAgICB1aW50OF90IGJ1cyA9IGRldi0+c2JkZi5idXM7Ci0gICAgICAgIHVpbnQ4X3Qgc2xvdCA9
IGRldi0+c2JkZi5kZXY7Ci0gICAgICAgIHVpbnQ4X3QgZnVuYyA9IGRldi0+c2JkZi5mdW5jOwog
ICAgICAgICBpbnQgbnIgPSBlbnRyeS0+bXNpX2F0dHJpYi5lbnRyeV9ucjsKIAogICAgICAgICBB
U1NFUlQoKG1zZy0+ZGF0YSAmIChlbnRyeVstbnJdLm1zaS5udmVjIC0gMSkpID09IG5yKTsKICAg
ICAgICAgaWYgKCBuciApCiAgICAgICAgICAgICByZXR1cm4gMDsKIAotICAgICAgICBwY2lfY29u
Zl93cml0ZTMyKHNlZywgYnVzLCBzbG90LCBmdW5jLCBtc2lfbG93ZXJfYWRkcmVzc19yZWcocG9z
KSwKLSAgICAgICAgICAgICAgICAgICAgICAgICBtc2ctPmFkZHJlc3NfbG8pOworICAgICAgICBw
Y2lfY29uZl93cml0ZTMyKGRldi0+c2JkZiwgbXNpX2xvd2VyX2FkZHJlc3NfcmVnKHBvcyksIG1z
Zy0+YWRkcmVzc19sbyk7CiAgICAgICAgIGlmICggZW50cnktPm1zaV9hdHRyaWIuaXNfNjQgKQog
ICAgICAgICB7Ci0gICAgICAgICAgICBwY2lfY29uZl93cml0ZTMyKHNlZywgYnVzLCBzbG90LCBm
dW5jLCBtc2lfdXBwZXJfYWRkcmVzc19yZWcocG9zKSwKKyAgICAgICAgICAgIHBjaV9jb25mX3dy
aXRlMzIoZGV2LT5zYmRmLCBtc2lfdXBwZXJfYWRkcmVzc19yZWcocG9zKSwKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgbXNnLT5hZGRyZXNzX2hpKTsKLSAgICAgICAgICAgIHBjaV9jb25m
X3dyaXRlMTYoc2VnLCBidXMsIHNsb3QsIGZ1bmMsIG1zaV9kYXRhX3JlZyhwb3MsIDEpLAorICAg
ICAgICAgICAgcGNpX2NvbmZfd3JpdGUxNihkZXYtPnNiZGYsIG1zaV9kYXRhX3JlZyhwb3MsIDEp
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2ctPmRhdGEpOwogICAgICAgICB9CiAg
ICAgICAgIGVsc2UKLSAgICAgICAgICAgIHBjaV9jb25mX3dyaXRlMTYoc2VnLCBidXMsIHNsb3Qs
IGZ1bmMsIG1zaV9kYXRhX3JlZyhwb3MsIDApLAotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBtc2ctPmRhdGEpOworICAgICAgICAgICAgcGNpX2NvbmZfd3JpdGUxNihkZXYtPnNiZGYsIG1z
aV9kYXRhX3JlZyhwb3MsIDApLCBtc2ctPmRhdGEpOwogICAgICAgICBicmVhazsKICAgICB9CiAg
ICAgY2FzZSBQQ0lfQ0FQX0lEX01TSVg6CkBAIC0zMzcsMTIgKzMxNywxOCBAQCB2b2lkIHNldF9t
c2lfYWZmaW5pdHkoc3RydWN0IGlycV9kZXNjICpkZXNjLCBjb25zdCBjcHVtYXNrX3QgKm1hc2sp
CiAKIHZvaWQgX19tc2lfc2V0X2VuYWJsZSh1MTYgc2VnLCB1OCBidXMsIHU4IHNsb3QsIHU4IGZ1
bmMsIGludCBwb3MsIGludCBlbmFibGUpCiB7Ci0gICAgdTE2IGNvbnRyb2wgPSBwY2lfY29uZl9y
ZWFkMTYoc2VnLCBidXMsIHNsb3QsIGZ1bmMsIHBvcyArIFBDSV9NU0lfRkxBR1MpOworICAgIGNv
bnN0IHBjaV9zYmRmX3Qgc2JkZiA9IHsKKyAgICAgICAgLnNlZyA9IHNlZywKKyAgICAgICAgLmJ1
cyA9IGJ1cywKKyAgICAgICAgLmRldiA9IHNsb3QsCisgICAgICAgIC5mdW5jID0gZnVuYywKKyAg
ICB9OworICAgIHVpbnQxNl90IGNvbnRyb2wgPSBwY2lfY29uZl9yZWFkMTYoc2JkZiwgcG9zICsg
UENJX01TSV9GTEFHUyk7CiAKICAgICBjb250cm9sICY9IH5QQ0lfTVNJX0ZMQUdTX0VOQUJMRTsK
ICAgICBpZiAoIGVuYWJsZSApCiAgICAgICAgIGNvbnRyb2wgfD0gUENJX01TSV9GTEFHU19FTkFC
TEU7Ci0gICAgcGNpX2NvbmZfd3JpdGUxNihzZWcsIGJ1cywgc2xvdCwgZnVuYywgcG9zICsgUENJ
X01TSV9GTEFHUywgY29udHJvbCk7CisgICAgcGNpX2NvbmZfd3JpdGUxNihzYmRmLCBwb3MgKyBQ
Q0lfTVNJX0ZMQUdTLCBjb250cm9sKTsKIH0KIAogc3RhdGljIHZvaWQgbXNpX3NldF9lbmFibGUo
c3RydWN0IHBjaV9kZXYgKmRldiwgaW50IGVuYWJsZSkKQEAgLTM2OSwxMSArMzU1LDExIEBAIHN0
YXRpYyB2b2lkIG1zaXhfc2V0X2VuYWJsZShzdHJ1Y3QgcGNpX2RldiAqZGV2LCBpbnQgZW5hYmxl
KQogICAgIHBvcyA9IHBjaV9maW5kX2NhcF9vZmZzZXQoc2VnLCBidXMsIHNsb3QsIGZ1bmMsIFBD
SV9DQVBfSURfTVNJWCk7CiAgICAgaWYgKCBwb3MgKQogICAgIHsKLSAgICAgICAgY29udHJvbCA9
IHBjaV9jb25mX3JlYWQxNihzZWcsIGJ1cywgc2xvdCwgZnVuYywgbXNpeF9jb250cm9sX3JlZyhw
b3MpKTsKKyAgICAgICAgY29udHJvbCA9IHBjaV9jb25mX3JlYWQxNihkZXYtPnNiZGYsIG1zaXhf
Y29udHJvbF9yZWcocG9zKSk7CiAgICAgICAgIGNvbnRyb2wgJj0gflBDSV9NU0lYX0ZMQUdTX0VO
QUJMRTsKICAgICAgICAgaWYgKCBlbmFibGUgKQogICAgICAgICAgICAgY29udHJvbCB8PSBQQ0lf
TVNJWF9GTEFHU19FTkFCTEU7Ci0gICAgICAgIHBjaV9jb25mX3dyaXRlMTYoc2VnLCBidXMsIHNs
b3QsIGZ1bmMsIG1zaXhfY29udHJvbF9yZWcocG9zKSwgY29udHJvbCk7CisgICAgICAgIHBjaV9j
b25mX3dyaXRlMTYoZGV2LT5zYmRmLCBtc2l4X2NvbnRyb2xfcmVnKHBvcyksIGNvbnRyb2wpOwog
ICAgIH0KIH0KIApAQCAtNDA2LDIwICszOTIsMjAgQEAgc3RhdGljIGJvb2wgbXNpX3NldF9tYXNr
X2JpdChzdHJ1Y3QgaXJxX2Rlc2MgKmRlc2MsIGJvb2wgaG9zdCwgYm9vbCBndWVzdCkKICAgICAg
ICAgewogICAgICAgICAgICAgdTMyIG1hc2tfYml0czsKIAotICAgICAgICAgICAgbWFza19iaXRz
ID0gcGNpX2NvbmZfcmVhZDMyKHNlZywgYnVzLCBzbG90LCBmdW5jLCBlbnRyeS0+bXNpLm1wb3Mp
OworICAgICAgICAgICAgbWFza19iaXRzID0gcGNpX2NvbmZfcmVhZDMyKHBkZXYtPnNiZGYsIGVu
dHJ5LT5tc2kubXBvcyk7CiAgICAgICAgICAgICBtYXNrX2JpdHMgJj0gfigodTMyKTEgPDwgZW50
cnktPm1zaV9hdHRyaWIuZW50cnlfbnIpOwogICAgICAgICAgICAgbWFza19iaXRzIHw9ICh1MzIp
ZmxhZyA8PCBlbnRyeS0+bXNpX2F0dHJpYi5lbnRyeV9ucjsKLSAgICAgICAgICAgIHBjaV9jb25m
X3dyaXRlMzIoc2VnLCBidXMsIHNsb3QsIGZ1bmMsIGVudHJ5LT5tc2kubXBvcywgbWFza19iaXRz
KTsKKyAgICAgICAgICAgIHBjaV9jb25mX3dyaXRlMzIocGRldi0+c2JkZiwgZW50cnktPm1zaS5t
cG9zLCBtYXNrX2JpdHMpOwogICAgICAgICB9CiAgICAgICAgIGJyZWFrOwogICAgIGNhc2UgUENJ
X0NBUF9JRF9NU0lYOgogICAgICAgICBtYXNrYWxsID0gcGRldi0+bXNpeC0+aG9zdF9tYXNrYWxs
OwotICAgICAgICBjb250cm9sID0gcGNpX2NvbmZfcmVhZDE2KHNlZywgYnVzLCBzbG90LCBmdW5j
LAorICAgICAgICBjb250cm9sID0gcGNpX2NvbmZfcmVhZDE2KHBkZXYtPnNiZGYsCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNpeF9jb250cm9sX3JlZyhlbnRyeS0+bXNpX2F0
dHJpYi5wb3MpKTsKICAgICAgICAgaWYgKCB1bmxpa2VseSghKGNvbnRyb2wgJiBQQ0lfTVNJWF9G
TEFHU19FTkFCTEUpKSApCiAgICAgICAgIHsKICAgICAgICAgICAgIHBkZXYtPm1zaXgtPmhvc3Rf
bWFza2FsbCA9IDE7Ci0gICAgICAgICAgICBwY2lfY29uZl93cml0ZTE2KHNlZywgYnVzLCBzbG90
LCBmdW5jLAorICAgICAgICAgICAgcGNpX2NvbmZfd3JpdGUxNihwZGV2LT5zYmRmLAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBtc2l4X2NvbnRyb2xfcmVnKGVudHJ5LT5tc2lfYXR0cmli
LnBvcyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2wgfCAoUENJX01TSVhf
RkxBR1NfRU5BQkxFIHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQ
Q0lfTVNJWF9GTEFHU19NQVNLQUxMKSk7CkBAIC00NTMsNyArNDM5LDcgQEAgc3RhdGljIGJvb2wg
bXNpX3NldF9tYXNrX2JpdChzdHJ1Y3QgaXJxX2Rlc2MgKmRlc2MsIGJvb2wgaG9zdCwgYm9vbCBn
dWVzdCkKICAgICAgICAgcGRldi0+bXNpeC0+aG9zdF9tYXNrYWxsID0gbWFza2FsbDsKICAgICAg
ICAgaWYgKCBtYXNrYWxsIHx8IHBkZXYtPm1zaXgtPmd1ZXN0X21hc2thbGwgKQogICAgICAgICAg
ICAgY29udHJvbCB8PSBQQ0lfTVNJWF9GTEFHU19NQVNLQUxMOwotICAgICAgICBwY2lfY29uZl93
cml0ZTE2KHNlZywgYnVzLCBzbG90LCBmdW5jLAorICAgICAgICBwY2lfY29uZl93cml0ZTE2KHBk
ZXYtPnNiZGYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgbXNpeF9jb250cm9sX3JlZyhlbnRy
eS0+bXNpX2F0dHJpYi5wb3MpLCBjb250cm9sKTsKICAgICAgICAgcmV0dXJuIGZsYWc7CiAgICAg
ZGVmYXVsdDoKQEAgLTQ3NSw5ICs0NjEsNyBAQCBzdGF0aWMgaW50IG1zaV9nZXRfbWFza19iaXQo
Y29uc3Qgc3RydWN0IG1zaV9kZXNjICplbnRyeSkKICAgICBjYXNlIFBDSV9DQVBfSURfTVNJOgog
ICAgICAgICBpZiAoICFlbnRyeS0+bXNpX2F0dHJpYi5tYXNrYml0ICkKICAgICAgICAgICAgIGJy
ZWFrOwotICAgICAgICByZXR1cm4gKHBjaV9jb25mX3JlYWQzMihlbnRyeS0+ZGV2LT5zYmRmLnNl
ZywgZW50cnktPmRldi0+c2JkZi5idXMsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGVudHJ5LT5kZXYtPnNiZGYuZGV2LCBlbnRyeS0+ZGV2LT5zYmRmLmZ1bmMsCi0gICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGVudHJ5LT5tc2kubXBvcykgPj4KKyAgICAgICAgcmV0dXJu
IChwY2lfY29uZl9yZWFkMzIoZW50cnktPmRldi0+c2JkZiwgZW50cnktPm1zaS5tcG9zKSA+Pgog
ICAgICAgICAgICAgICAgIGVudHJ5LT5tc2lfYXR0cmliLmVudHJ5X25yKSAmIDE7CiAgICAgY2Fz
ZSBQQ0lfQ0FQX0lEX01TSVg6CiAgICAgICAgIGlmICggdW5saWtlbHkoIW1zaXhfbWVtb3J5X2Rl
Y29kZWQoZW50cnktPmRldiwKQEAgLTU5MywxMSArNTc3LDkgQEAgaW50IHNldHVwX21zaV9pcnEo
c3RydWN0IGlycV9kZXNjICpkZXNjLCBzdHJ1Y3QgbXNpX2Rlc2MgKm1zaWRlc2MpCiAKICAgICBp
ZiAoIG1zaWRlc2MtPm1zaV9hdHRyaWIudHlwZSA9PSBQQ0lfQ0FQX0lEX01TSVggKQogICAgIHsK
LSAgICAgICAgY29udHJvbCA9IHBjaV9jb25mX3JlYWQxNihwZGV2LT5zYmRmLnNlZywgcGRldi0+
c2JkZi5idXMsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGRldi0+c2JkZi5k
ZXYsIHBkZXYtPnNiZGYuZnVuYywgY3Bvcyk7CisgICAgICAgIGNvbnRyb2wgPSBwY2lfY29uZl9y
ZWFkMTYocGRldi0+c2JkZiwgY3Bvcyk7CiAgICAgICAgIGlmICggIShjb250cm9sICYgUENJX01T
SVhfRkxBR1NfRU5BQkxFKSApCi0gICAgICAgICAgICBwY2lfY29uZl93cml0ZTE2KHBkZXYtPnNi
ZGYuc2VnLCBwZGV2LT5zYmRmLmJ1cywgcGRldi0+c2JkZi5kZXYsCi0gICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHBkZXYtPnNiZGYuZnVuYywgY3BvcywKKyAgICAgICAgICAgIHBjaV9jb25m
X3dyaXRlMTYocGRldi0+c2JkZiwgY3BvcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
Y29udHJvbCB8IChQQ0lfTVNJWF9GTEFHU19FTkFCTEUgfAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIFBDSV9NU0lYX0ZMQUdTX01BU0tBTEwpKTsKICAgICB9CkBAIC02
MDcsOCArNTg5LDcgQEAgaW50IHNldHVwX21zaV9pcnEoc3RydWN0IGlycV9kZXNjICpkZXNjLCBz
dHJ1Y3QgbXNpX2Rlc2MgKm1zaWRlc2MpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICA6ICZwY2lfbXNpX25vbm1hc2thYmxlKTsKIAogICAgIGlmICgg
IShjb250cm9sICYgUENJX01TSVhfRkxBR1NfRU5BQkxFKSApCi0gICAgICAgIHBjaV9jb25mX3dy
aXRlMTYocGRldi0+c2JkZi5zZWcsIHBkZXYtPnNiZGYuYnVzLCBwZGV2LT5zYmRmLmRldiwKLSAg
ICAgICAgICAgICAgICAgICAgICAgICBwZGV2LT5zYmRmLmZ1bmMsIGNwb3MsIGNvbnRyb2wpOwor
ICAgICAgICBwY2lfY29uZl93cml0ZTE2KHBkZXYtPnNiZGYsIGNwb3MsIGNvbnRyb2wpOwogCiAg
ICAgcmV0dXJuIHJjOwogfQpAQCAtNjk3LDcgKzY3OCw3IEBAIHN0YXRpYyBpbnQgbXNpX2NhcGFi
aWxpdHlfaW5pdChzdHJ1Y3QgcGNpX2RldiAqZGV2LAogICAgIHBvcyA9IHBjaV9maW5kX2NhcF9v
ZmZzZXQoc2VnLCBidXMsIHNsb3QsIGZ1bmMsIFBDSV9DQVBfSURfTVNJKTsKICAgICBpZiAoICFw
b3MgKQogICAgICAgICByZXR1cm4gLUVOT0RFVjsKLSAgICBjb250cm9sID0gcGNpX2NvbmZfcmVh
ZDE2KHNlZywgYnVzLCBzbG90LCBmdW5jLCBtc2lfY29udHJvbF9yZWcocG9zKSk7CisgICAgY29u
dHJvbCA9IHBjaV9jb25mX3JlYWQxNihkZXYtPnNiZGYsIG1zaV9jb250cm9sX3JlZyhwb3MpKTsK
ICAgICBtYXh2ZWMgPSBtdWx0aV9tc2lfY2FwYWJsZShjb250cm9sKTsKICAgICBpZiAoIG52ZWMg
PiBtYXh2ZWMgKQogICAgICAgICByZXR1cm4gbWF4dmVjOwpAQCAtNzMzLDkgKzcxNCw5IEBAIHN0
YXRpYyBpbnQgbXNpX2NhcGFiaWxpdHlfaW5pdChzdHJ1Y3QgcGNpX2RldiAqZGV2LAogICAgICAg
ICB1MzIgbWFza2JpdHM7CiAKICAgICAgICAgLyogQWxsIE1TSXMgYXJlIHVubWFza2VkIGJ5IGRl
ZmF1bHQsIE1hc2sgdGhlbSBhbGwgKi8KLSAgICAgICAgbWFza2JpdHMgPSBwY2lfY29uZl9yZWFk
MzIoc2VnLCBidXMsIHNsb3QsIGZ1bmMsIG1wb3MpOworICAgICAgICBtYXNrYml0cyA9IHBjaV9j
b25mX3JlYWQzMihkZXYtPnNiZGYsIG1wb3MpOwogICAgICAgICBtYXNrYml0cyB8PSB+KHUzMikw
ID4+ICgzMiAtIG1heHZlYyk7Ci0gICAgICAgIHBjaV9jb25mX3dyaXRlMzIoc2VnLCBidXMsIHNs
b3QsIGZ1bmMsIG1wb3MsIG1hc2tiaXRzKTsKKyAgICAgICAgcGNpX2NvbmZfd3JpdGUzMihkZXYt
PnNiZGYsIG1wb3MsIG1hc2tiaXRzKTsKICAgICB9CiAgICAgbGlzdF9hZGRfdGFpbCgmZW50cnkt
Pmxpc3QsICZkZXYtPm1zaV9saXN0KTsKIApAQCAtNzUxLDcgKzczMiw3IEBAIHN0YXRpYyBpbnQg
bXNpX2NhcGFiaWxpdHlfaW5pdChzdHJ1Y3QgcGNpX2RldiAqZGV2LAogICAgICAgICBwY2lfaW50
eChkZXYsIGZhbHNlKTsKICAgICAgICAgY29udHJvbCB8PSBQQ0lfTVNJX0ZMQUdTX0VOQUJMRTsK
ICAgICB9Ci0gICAgcGNpX2NvbmZfd3JpdGUxNihzZWcsIGJ1cywgc2xvdCwgZnVuYywgbXNpX2Nv
bnRyb2xfcmVnKHBvcyksIGNvbnRyb2wpOworICAgIHBjaV9jb25mX3dyaXRlMTYoZGV2LT5zYmRm
LCBtc2lfY29udHJvbF9yZWcocG9zKSwgY29udHJvbCk7CiAKICAgICByZXR1cm4gMDsKIH0KQEAg
LTc2MSw2ICs3NDIsMTIgQEAgc3RhdGljIHU2NCByZWFkX3BjaV9tZW1fYmFyKHUxNiBzZWcsIHU4
IGJ1cywgdTggc2xvdCwgdTggZnVuYywgdTggYmlyLCBpbnQgdmYpCiAgICAgdTggbGltaXQ7CiAg
ICAgdTMyIGFkZHIsIGJhc2UgPSBQQ0lfQkFTRV9BRERSRVNTXzA7CiAgICAgdTY0IGRpc3AgPSAw
OworICAgIGNvbnN0IHBjaV9zYmRmX3Qgc2JkZiA9IHsKKyAgICAgICAgLnNlZyA9IHNlZywKKyAg
ICAgICAgLmJ1cyA9IGJ1cywKKyAgICAgICAgLmRldiA9IHNsb3QsCisgICAgICAgIC5mdW5jID0g
ZnVuYywKKyAgICB9OwogCiAgICAgaWYgKCB2ZiA+PSAwICkKICAgICB7CkBAIC03NjgsMTMgKzc1
NSwxMCBAQCBzdGF0aWMgdTY0IHJlYWRfcGNpX21lbV9iYXIodTE2IHNlZywgdTggYnVzLCB1OCBz
bG90LCB1OCBmdW5jLCB1OCBiaXIsIGludCB2ZikKICAgICAgICAgdW5zaWduZWQgaW50IHBvcyA9
IHBjaV9maW5kX2V4dF9jYXBhYmlsaXR5KHNlZywgYnVzLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX0RFVkZOKHNsb3QsIGZ1bmMpLAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX0VYVF9D
QVBfSURfU1JJT1YpOwotICAgICAgICB1MTYgY3RybCA9IHBjaV9jb25mX3JlYWQxNihzZWcsIGJ1
cywgc2xvdCwgZnVuYywgcG9zICsgUENJX1NSSU9WX0NUUkwpOwotICAgICAgICB1MTYgbnVtX3Zm
ID0gcGNpX2NvbmZfcmVhZDE2KHNlZywgYnVzLCBzbG90LCBmdW5jLAotICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHBvcyArIFBDSV9TUklPVl9OVU1fVkYpOwotICAgICAgICB1
MTYgb2Zmc2V0ID0gcGNpX2NvbmZfcmVhZDE2KHNlZywgYnVzLCBzbG90LCBmdW5jLAotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvcyArIFBDSV9TUklPVl9WRl9PRkZTRVQp
OwotICAgICAgICB1MTYgc3RyaWRlID0gcGNpX2NvbmZfcmVhZDE2KHNlZywgYnVzLCBzbG90LCBm
dW5jLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvcyArIFBDSV9TUklP
Vl9WRl9TVFJJREUpOworICAgICAgICB1MTYgY3RybCA9IHBjaV9jb25mX3JlYWQxNihzYmRmLCBw
b3MgKyBQQ0lfU1JJT1ZfQ1RSTCk7CisgICAgICAgIHUxNiBudW1fdmYgPSBwY2lfY29uZl9yZWFk
MTYoc2JkZiwgcG9zICsgUENJX1NSSU9WX05VTV9WRik7CisgICAgICAgIHUxNiBvZmZzZXQgPSBw
Y2lfY29uZl9yZWFkMTYoc2JkZiwgcG9zICsgUENJX1NSSU9WX1ZGX09GRlNFVCk7CisgICAgICAg
IHUxNiBzdHJpZGUgPSBwY2lfY29uZl9yZWFkMTYoc2JkZiwgcG9zICsgUENJX1NSSU9WX1ZGX1NU
UklERSk7CiAKICAgICAgICAgaWYgKCAhcGRldiB8fCAhcG9zIHx8CiAgICAgICAgICAgICAgIShj
dHJsICYgUENJX1NSSU9WX0NUUkxfVkZFKSB8fApAQCAtNzk5LDggKzc4Myw3IEBAIHN0YXRpYyB1
NjQgcmVhZF9wY2lfbWVtX2Jhcih1MTYgc2VnLCB1OCBidXMsIHU4IHNsb3QsIHU4IGZ1bmMsIHU4
IGJpciwgaW50IHZmKQogICAgICAgICBkaXNwID0gdmYgKiBwZGV2LT52Zl9ybGVuW2Jpcl07CiAg
ICAgICAgIGxpbWl0ID0gUENJX1NSSU9WX05VTV9CQVJTOwogICAgIH0KLSAgICBlbHNlIHN3aXRj
aCAoIHBjaV9jb25mX3JlYWQ4KHNlZywgYnVzLCBzbG90LCBmdW5jLAotICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgUENJX0hFQURFUl9UWVBFKSAmIDB4N2YgKQorICAgIGVsc2Ugc3dp
dGNoICggcGNpX2NvbmZfcmVhZDgoc2JkZiwgUENJX0hFQURFUl9UWVBFKSAmIDB4N2YgKQogICAg
IHsKICAgICBjYXNlIFBDSV9IRUFERVJfVFlQRV9OT1JNQUw6CiAgICAgICAgIGxpbWl0ID0gNjsK
QEAgLTgxNyw3ICs4MDAsNyBAQCBzdGF0aWMgdTY0IHJlYWRfcGNpX21lbV9iYXIodTE2IHNlZywg
dTggYnVzLCB1OCBzbG90LCB1OCBmdW5jLCB1OCBiaXIsIGludCB2ZikKIAogICAgIGlmICggYmly
ID49IGxpbWl0ICkKICAgICAgICAgcmV0dXJuIDA7Ci0gICAgYWRkciA9IHBjaV9jb25mX3JlYWQz
MihzZWcsIGJ1cywgc2xvdCwgZnVuYywgYmFzZSArIGJpciAqIDQpOworICAgIGFkZHIgPSBwY2lf
Y29uZl9yZWFkMzIoc2JkZiwgYmFzZSArIGJpciAqIDQpOwogICAgIGlmICggKGFkZHIgJiBQQ0lf
QkFTRV9BRERSRVNTX1NQQUNFKSA9PSBQQ0lfQkFTRV9BRERSRVNTX1NQQUNFX0lPICkKICAgICAg
ICAgcmV0dXJuIDA7CiAgICAgaWYgKCAoYWRkciAmIFBDSV9CQVNFX0FERFJFU1NfTUVNX1RZUEVf
TUFTSykgPT0gUENJX0JBU0VfQUREUkVTU19NRU1fVFlQRV82NCApCkBAIC04MjYsOCArODA5LDcg
QEAgc3RhdGljIHU2NCByZWFkX3BjaV9tZW1fYmFyKHUxNiBzZWcsIHU4IGJ1cywgdTggc2xvdCwg
dTggZnVuYywgdTggYmlyLCBpbnQgdmYpCiAgICAgICAgIGlmICggKytiaXIgPj0gbGltaXQgKQog
ICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgIHJldHVybiBhZGRyICsgZGlzcCArCi0gICAg
ICAgICAgICAgICAoKHU2NClwY2lfY29uZl9yZWFkMzIoc2VnLCBidXMsIHNsb3QsIGZ1bmMsCi0g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFzZSArIGJpciAqIDQpIDw8IDMy
KTsKKyAgICAgICAgICAgICAgICgodWludDY0X3QpcGNpX2NvbmZfcmVhZDMyKHNiZGYsIGJhc2Ug
KyBiaXIgKiA0KSA8PCAzMik7CiAgICAgfQogICAgIHJldHVybiAoYWRkciAmIFBDSV9CQVNFX0FE
RFJFU1NfTUVNX01BU0spICsgZGlzcDsKIH0KQEAgLTg2Myw3ICs4NDUsNyBAQCBzdGF0aWMgaW50
IG1zaXhfY2FwYWJpbGl0eV9pbml0KHN0cnVjdCBwY2lfZGV2ICpkZXYsCiAKICAgICBBU1NFUlQo
cGNpZGV2c19sb2NrZWQoKSk7CiAKLSAgICBjb250cm9sID0gcGNpX2NvbmZfcmVhZDE2KHNlZywg
YnVzLCBzbG90LCBmdW5jLCBtc2l4X2NvbnRyb2xfcmVnKHBvcykpOworICAgIGNvbnRyb2wgPSBw
Y2lfY29uZl9yZWFkMTYoZGV2LT5zYmRmLCBtc2l4X2NvbnRyb2xfcmVnKHBvcykpOwogICAgIC8q
CiAgICAgICogRW5zdXJlIE1TSS1YIGludGVycnVwdHMgYXJlIG1hc2tlZCBkdXJpbmcgc2V0dXAu
IFNvbWUgZGV2aWNlcyByZXF1aXJlCiAgICAgICogTVNJLVggdG8gYmUgZW5hYmxlZCBiZWZvcmUg
d2UgY2FuIHRvdWNoIHRoZSBNU0ktWCByZWdpc3RlcnMuIFdlIG5lZWQKQEAgLTg3MSwxMyArODUz
LDEzIEBAIHN0YXRpYyBpbnQgbXNpeF9jYXBhYmlsaXR5X2luaXQoc3RydWN0IHBjaV9kZXYgKmRl
diwKICAgICAgKiBmdWxseSBzZXQgdXAuCiAgICAgICovCiAgICAgbXNpeC0+aG9zdF9tYXNrYWxs
ID0gMTsKLSAgICBwY2lfY29uZl93cml0ZTE2KHNlZywgYnVzLCBzbG90LCBmdW5jLCBtc2l4X2Nv
bnRyb2xfcmVnKHBvcyksCisgICAgcGNpX2NvbmZfd3JpdGUxNihkZXYtPnNiZGYsIG1zaXhfY29u
dHJvbF9yZWcocG9zKSwKICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2wgfCAoUENJX01TSVhf
RkxBR1NfRU5BQkxFIHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX01TSVhf
RkxBR1NfTUFTS0FMTCkpOwogCiAgICAgaWYgKCB1bmxpa2VseSghbWVtb3J5X2RlY29kZWQoZGV2
KSkgKQogICAgIHsKLSAgICAgICAgcGNpX2NvbmZfd3JpdGUxNihzZWcsIGJ1cywgc2xvdCwgZnVu
YywgbXNpeF9jb250cm9sX3JlZyhwb3MpLAorICAgICAgICBwY2lfY29uZl93cml0ZTE2KGRldi0+
c2JkZiwgbXNpeF9jb250cm9sX3JlZyhwb3MpLAogICAgICAgICAgICAgICAgICAgICAgICAgIGNv
bnRyb2wgJiB+UENJX01TSVhfRkxBR1NfRU5BQkxFKTsKICAgICAgICAgcmV0dXJuIC1FTlhJTzsK
ICAgICB9CkBAIC04ODcsNyArODY5LDcgQEAgc3RhdGljIGludCBtc2l4X2NhcGFiaWxpdHlfaW5p
dChzdHJ1Y3QgcGNpX2RldiAqZGV2LAogICAgICAgICBlbnRyeSA9IGFsbG9jX21zaV9lbnRyeSgx
KTsKICAgICAgICAgaWYgKCAhZW50cnkgKQogICAgICAgICB7Ci0gICAgICAgICAgICBwY2lfY29u
Zl93cml0ZTE2KHNlZywgYnVzLCBzbG90LCBmdW5jLCBtc2l4X2NvbnRyb2xfcmVnKHBvcyksCisg
ICAgICAgICAgICBwY2lfY29uZl93cml0ZTE2KGRldi0+c2JkZiwgbXNpeF9jb250cm9sX3JlZyhw
b3MpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sICYgflBDSV9NU0lYX0ZM
QUdTX0VOQUJMRSk7CiAgICAgICAgICAgICByZXR1cm4gLUVOT01FTTsKICAgICAgICAgfQpAQCAt
ODk1LDggKzg3Nyw3IEBAIHN0YXRpYyBpbnQgbXNpeF9jYXBhYmlsaXR5X2luaXQoc3RydWN0IHBj
aV9kZXYgKmRldiwKICAgICB9CiAKICAgICAvKiBMb2NhdGUgTVNJLVggdGFibGUgcmVnaW9uICov
Ci0gICAgdGFibGVfb2Zmc2V0ID0gcGNpX2NvbmZfcmVhZDMyKHNlZywgYnVzLCBzbG90LCBmdW5j
LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2l4X3RhYmxlX29mZnNldF9y
ZWcocG9zKSk7CisgICAgdGFibGVfb2Zmc2V0ID0gcGNpX2NvbmZfcmVhZDMyKGRldi0+c2JkZiwg
bXNpeF90YWJsZV9vZmZzZXRfcmVnKHBvcykpOwogICAgIGJpciA9ICh1OCkodGFibGVfb2Zmc2V0
ICYgUENJX01TSVhfQklSTUFTSyk7CiAgICAgdGFibGVfb2Zmc2V0ICY9IH5QQ0lfTVNJWF9CSVJN
QVNLOwogCkBAIC05MjEsNyArOTAyLDcgQEAgc3RhdGljIGludCBtc2l4X2NhcGFiaWxpdHlfaW5p
dChzdHJ1Y3QgcGNpX2RldiAqZGV2LAogICAgIHsKICAgICAgICAgaWYgKCAhbXNpIHx8ICFtc2kt
PnRhYmxlX2Jhc2UgKQogICAgICAgICB7Ci0gICAgICAgICAgICBwY2lfY29uZl93cml0ZTE2KHNl
ZywgYnVzLCBzbG90LCBmdW5jLCBtc2l4X2NvbnRyb2xfcmVnKHBvcyksCisgICAgICAgICAgICBw
Y2lfY29uZl93cml0ZTE2KGRldi0+c2JkZiwgbXNpeF9jb250cm9sX3JlZyhwb3MpLAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sICYgflBDSV9NU0lYX0ZMQUdTX0VOQUJMRSk7
CiAgICAgICAgICAgICB4ZnJlZShlbnRyeSk7CiAgICAgICAgICAgICByZXR1cm4gLUVOWElPOwpA
QCAtOTQyLDggKzkyMyw3IEBAIHN0YXRpYyBpbnQgbXNpeF9jYXBhYmlsaXR5X2luaXQoc3RydWN0
IHBjaV9kZXYgKmRldiwKICAgICAgICAgV0FSTl9PTihyYW5nZXNldF9vdmVybGFwc19yYW5nZSht
bWlvX3JvX3JhbmdlcywgbXNpeC0+dGFibGUuZmlyc3QsCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgbXNpeC0+dGFibGUubGFzdCkpOwogCi0gICAgICAgIHBiYV9vZmZz
ZXQgPSBwY2lfY29uZl9yZWFkMzIoc2VnLCBidXMsIHNsb3QsIGZ1bmMsCi0gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgbXNpeF9wYmFfb2Zmc2V0X3JlZyhwb3MpKTsKKyAgICAg
ICAgcGJhX29mZnNldCA9IHBjaV9jb25mX3JlYWQzMihkZXYtPnNiZGYsIG1zaXhfcGJhX29mZnNl
dF9yZWcocG9zKSk7CiAgICAgICAgIGJpciA9ICh1OCkocGJhX29mZnNldCAmIFBDSV9NU0lYX0JJ
Uk1BU0spOwogICAgICAgICBwYmFfcGFkZHIgPSByZWFkX3BjaV9tZW1fYmFyKHNlZywgcGJ1cywg
cHNsb3QsIHBmdW5jLCBiaXIsIHZmKTsKICAgICAgICAgV0FSTl9PTighcGJhX3BhZGRyKTsKQEAg
LTk2NSw3ICs5NDUsNyBAQCBzdGF0aWMgaW50IG1zaXhfY2FwYWJpbGl0eV9pbml0KHN0cnVjdCBw
Y2lfZGV2ICpkZXYsCiAKICAgICAgICAgaWYgKCBpZHggPCAwICkKICAgICAgICAgewotICAgICAg
ICAgICAgcGNpX2NvbmZfd3JpdGUxNihzZWcsIGJ1cywgc2xvdCwgZnVuYywgbXNpeF9jb250cm9s
X3JlZyhwb3MpLAorICAgICAgICAgICAgcGNpX2NvbmZfd3JpdGUxNihkZXYtPnNiZGYsIG1zaXhf
Y29udHJvbF9yZWcocG9zKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbCAm
IH5QQ0lfTVNJWF9GTEFHU19FTkFCTEUpOwogICAgICAgICAgICAgeGZyZWUoZW50cnkpOwogICAg
ICAgICAgICAgcmV0dXJuIGlkeDsKQEAgLTEwNDEsNyArMTAyMSw3IEBAIHN0YXRpYyBpbnQgbXNp
eF9jYXBhYmlsaXR5X2luaXQoc3RydWN0IHBjaV9kZXYgKmRldiwKICAgICAgICAgbWFza2FsbCA9
IDA7CiAgICAgfQogICAgIG1zaXgtPmhvc3RfbWFza2FsbCA9IG1hc2thbGw7Ci0gICAgcGNpX2Nv
bmZfd3JpdGUxNihzZWcsIGJ1cywgc2xvdCwgZnVuYywgbXNpeF9jb250cm9sX3JlZyhwb3MpLCBj
b250cm9sKTsKKyAgICBwY2lfY29uZl93cml0ZTE2KGRldi0+c2JkZiwgbXNpeF9jb250cm9sX3Jl
Zyhwb3MpLCBjb250cm9sKTsKIAogICAgIHJldHVybiAwOwogfQpAQCAtMTEzMCw4ICsxMTEwLDcg
QEAgc3RhdGljIGludCBfX3BjaV9lbmFibGVfbXNpeChzdHJ1Y3QgbXNpX2luZm8gKm1zaSwgc3Ry
dWN0IG1zaV9kZXNjICoqZGVzYykKICAgICBpZiAoICFwZGV2IHx8ICFwb3MgKQogICAgICAgICBy
ZXR1cm4gLUVOT0RFVjsKIAotICAgIGNvbnRyb2wgPSBwY2lfY29uZl9yZWFkMTYobXNpLT5zZWcs
IG1zaS0+YnVzLCBzbG90LCBmdW5jLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNp
eF9jb250cm9sX3JlZyhwb3MpKTsKKyAgICBjb250cm9sID0gcGNpX2NvbmZfcmVhZDE2KHBkZXYt
PnNiZGYsIG1zaXhfY29udHJvbF9yZWcocG9zKSk7CiAgICAgbnJfZW50cmllcyA9IG11bHRpX21z
aXhfY2FwYWJsZShjb250cm9sKTsKICAgICBpZiAoIG1zaS0+ZW50cnlfbnIgPj0gbnJfZW50cmll
cyApCiAgICAgICAgIHJldHVybiAtRUlOVkFMOwpAQCAtMTE3NywxNCArMTE1NiwxNCBAQCBzdGF0
aWMgdm9pZCBfX3BjaV9kaXNhYmxlX21zaXgoc3RydWN0IG1zaV9kZXNjICplbnRyeSkKICAgICB1
aW50OF90IGZ1bmMgPSBkZXYtPnNiZGYuZnVuYzsKICAgICB1bnNpZ25lZCBpbnQgcG9zID0gcGNp
X2ZpbmRfY2FwX29mZnNldChzZWcsIGJ1cywgc2xvdCwgZnVuYywKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lfQ0FQX0lEX01TSVgpOwotICAgIHUxNiBjb250
cm9sID0gcGNpX2NvbmZfcmVhZDE2KHNlZywgYnVzLCBzbG90LCBmdW5jLAotICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIG1zaXhfY29udHJvbF9yZWcoZW50cnktPm1zaV9hdHRyaWIu
cG9zKSk7CisgICAgdWludDE2X3QgY29udHJvbCA9IHBjaV9jb25mX3JlYWQxNihkZXYtPnNiZGYs
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2l4X2NvbnRyb2xfcmVn
KGVudHJ5LT5tc2lfYXR0cmliLnBvcykpOwogICAgIGJvb2wgbWFza2FsbCA9IGRldi0+bXNpeC0+
aG9zdF9tYXNrYWxsOwogCiAgICAgaWYgKCB1bmxpa2VseSghKGNvbnRyb2wgJiBQQ0lfTVNJWF9G
TEFHU19FTkFCTEUpKSApCiAgICAgewogICAgICAgICBkZXYtPm1zaXgtPmhvc3RfbWFza2FsbCA9
IDE7Ci0gICAgICAgIHBjaV9jb25mX3dyaXRlMTYoc2VnLCBidXMsIHNsb3QsIGZ1bmMsIG1zaXhf
Y29udHJvbF9yZWcocG9zKSwKKyAgICAgICAgcGNpX2NvbmZfd3JpdGUxNihkZXYtPnNiZGYsIG1z
aXhfY29udHJvbF9yZWcocG9zKSwKICAgICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sIHwg
KFBDSV9NU0lYX0ZMQUdTX0VOQUJMRSB8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBQQ0lfTVNJWF9GTEFHU19NQVNLQUxMKSk7CiAgICAgfQpAQCAtMTIwMyw3ICsxMTgyLDcg
QEAgc3RhdGljIHZvaWQgX19wY2lfZGlzYWJsZV9tc2l4KHN0cnVjdCBtc2lfZGVzYyAqZW50cnkp
CiAgICAgZGV2LT5tc2l4LT5ob3N0X21hc2thbGwgPSBtYXNrYWxsOwogICAgIGlmICggbWFza2Fs
bCB8fCBkZXYtPm1zaXgtPmd1ZXN0X21hc2thbGwgKQogICAgICAgICBjb250cm9sIHw9IFBDSV9N
U0lYX0ZMQUdTX01BU0tBTEw7Ci0gICAgcGNpX2NvbmZfd3JpdGUxNihzZWcsIGJ1cywgc2xvdCwg
ZnVuYywgbXNpeF9jb250cm9sX3JlZyhwb3MpLCBjb250cm9sKTsKKyAgICBwY2lfY29uZl93cml0
ZTE2KGRldi0+c2JkZiwgbXNpeF9jb250cm9sX3JlZyhwb3MpLCBjb250cm9sKTsKIAogICAgIF9w
Y2lfY2xlYW51cF9tc2l4KGRldi0+bXNpeCk7CiB9CkBAIC0xMjM1LDggKzEyMTQsNyBAQCBpbnQg
cGNpX3ByZXBhcmVfbXNpeCh1MTYgc2VnLCB1OCBidXMsIHU4IGRldmZuLCBib29sIG9mZikKICAg
ICB9CiAgICAgZWxzZQogICAgIHsKLSAgICAgICAgdTE2IGNvbnRyb2wgPSBwY2lfY29uZl9yZWFk
MTYoc2VnLCBidXMsIHNsb3QsIGZ1bmMsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIG1zaXhfY29udHJvbF9yZWcocG9zKSk7CisgICAgICAgIHVpbnQxNl90IGNvbnRyb2wg
PSBwY2lfY29uZl9yZWFkMTYocGRldi0+c2JkZiwgbXNpeF9jb250cm9sX3JlZyhwb3MpKTsKIAog
ICAgICAgICByYyA9IG1zaXhfY2FwYWJpbGl0eV9pbml0KHBkZXYsIHBvcywgTlVMTCwgTlVMTCwK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtdWx0aV9tc2l4X2NhcGFibGUoY29u
dHJvbCkpOwpAQCAtMTMzNyw3ICsxMzE1LDcgQEAgaW50IHBjaV9tc2lfY29uZl93cml0ZV9pbnRl
cmNlcHQoc3RydWN0IHBjaV9kZXYgKnBkZXYsIHVuc2lnbmVkIGludCByZWcsCiAgICAgICAgIGlm
ICggcmVnIDwgZW50cnktPm1zaS5tcG9zIHx8IHJlZyA+PSBlbnRyeS0+bXNpLm1wb3MgKyA0IHx8
IHNpemUgIT0gNCApCiAgICAgICAgICAgICByZXR1cm4gLUVBQ0NFUzsKIAotICAgICAgICBjbnRs
ID0gcGNpX2NvbmZfcmVhZDE2KHNlZywgYnVzLCBzbG90LCBmdW5jLCBtc2lfY29udHJvbF9yZWco
cG9zKSk7CisgICAgICAgIGNudGwgPSBwY2lfY29uZl9yZWFkMTYocGRldi0+c2JkZiwgbXNpX2Nv
bnRyb2xfcmVnKHBvcykpOwogICAgICAgICB1bnVzZWQgPSB+KHVpbnQzMl90KTAgPj4gKDMyIC0g
bXVsdGlfbXNpX2NhcGFibGUoY250bCkpOwogICAgICAgICBmb3IgKCBwb3MgPSAwOyBwb3MgPCBl
bnRyeS0+bXNpLm52ZWM7ICsrcG9zLCArK2VudHJ5ICkKICAgICAgICAgewpAQCAtMTM5Niw4ICsx
Mzc0LDcgQEAgaW50IHBjaV9yZXN0b3JlX21zaV9zdGF0ZShzdHJ1Y3QgcGNpX2RldiAqcGRldikK
ICAgICAgICAgICAgICAgICAgICAgcGRldi0+c2JkZi5zZWcsIHBkZXYtPnNiZGYuYnVzLCBzbG90
LCBmdW5jLCBpKTsKICAgICAgICAgICAgIHNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmRlc2MtPmxv
Y2ssIGZsYWdzKTsKICAgICAgICAgICAgIGlmICggdHlwZSA9PSBQQ0lfQ0FQX0lEX01TSVggKQot
ICAgICAgICAgICAgICAgIHBjaV9jb25mX3dyaXRlMTYocGRldi0+c2JkZi5zZWcsIHBkZXYtPnNi
ZGYuYnVzLCBzbG90LCBmdW5jLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNp
eF9jb250cm9sX3JlZyhwb3MpLAorICAgICAgICAgICAgICAgIHBjaV9jb25mX3dyaXRlMTYocGRl
di0+c2JkZiwgbXNpeF9jb250cm9sX3JlZyhwb3MpLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgY29udHJvbCAmIH5QQ0lfTVNJWF9GTEFHU19FTkFCTEUpOwogICAgICAgICAgICAg
cmV0dXJuIC1FSU5WQUw7CiAgICAgICAgIH0KQEAgLTE0MTEsMTcgKzEzODgsMTQgQEAgaW50IHBj
aV9yZXN0b3JlX21zaV9zdGF0ZShzdHJ1Y3QgcGNpX2RldiAqcGRldikKICAgICAgICAgfQogICAg
ICAgICBlbHNlIGlmICggIXR5cGUgJiYgZW50cnktPm1zaV9hdHRyaWIudHlwZSA9PSBQQ0lfQ0FQ
X0lEX01TSVggKQogICAgICAgICB7Ci0gICAgICAgICAgICBjb250cm9sID0gcGNpX2NvbmZfcmVh
ZDE2KHBkZXYtPnNiZGYuc2VnLCBwZGV2LT5zYmRmLmJ1cywgc2xvdCwKLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgZnVuYywgbXNpeF9jb250cm9sX3JlZyhwb3MpKTsKLSAg
ICAgICAgICAgIHBjaV9jb25mX3dyaXRlMTYocGRldi0+c2JkZi5zZWcsIHBkZXYtPnNiZGYuYnVz
LCBzbG90LCBmdW5jLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2l4X2NvbnRyb2xf
cmVnKHBvcyksCisgICAgICAgICAgICBjb250cm9sID0gcGNpX2NvbmZfcmVhZDE2KHBkZXYtPnNi
ZGYsIG1zaXhfY29udHJvbF9yZWcocG9zKSk7CisgICAgICAgICAgICBwY2lfY29uZl93cml0ZTE2
KHBkZXYtPnNiZGYsIG1zaXhfY29udHJvbF9yZWcocG9zKSwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgY29udHJvbCB8IChQQ0lfTVNJWF9GTEFHU19FTkFCTEUgfAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9NU0lYX0ZMQUdTX01BU0tBTEwpKTsKICAg
ICAgICAgICAgIGlmICggdW5saWtlbHkoIW1lbW9yeV9kZWNvZGVkKHBkZXYpKSApCiAgICAgICAg
ICAgICB7CiAgICAgICAgICAgICAgICAgc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZGVzYy0+bG9j
aywgZmxhZ3MpOwotICAgICAgICAgICAgICAgIHBjaV9jb25mX3dyaXRlMTYocGRldi0+c2JkZi5z
ZWcsIHBkZXYtPnNiZGYuYnVzLCBzbG90LCBmdW5jLAotICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgbXNpeF9jb250cm9sX3JlZyhwb3MpLAorICAgICAgICAgICAgICAgIHBjaV9jb25m
X3dyaXRlMTYocGRldi0+c2JkZiwgbXNpeF9jb250cm9sX3JlZyhwb3MpLAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgY29udHJvbCAmIH5QQ0lfTVNJWF9GTEFHU19FTkFCTEUpOwog
ICAgICAgICAgICAgICAgIHJldHVybiAtRU5YSU87CiAgICAgICAgICAgICB9CkBAIC0xNDU0LDE5
ICsxNDI4LDE2IEBAIGludCBwY2lfcmVzdG9yZV9tc2lfc3RhdGUoc3RydWN0IHBjaV9kZXYgKnBk
ZXYpCiAgICAgICAgIHsKICAgICAgICAgICAgIHVuc2lnbmVkIGludCBjcG9zID0gbXNpX2NvbnRy
b2xfcmVnKHBvcyk7CiAKLSAgICAgICAgICAgIGNvbnRyb2wgPSBwY2lfY29uZl9yZWFkMTYocGRl
di0+c2JkZi5zZWcsIHBkZXYtPnNiZGYuYnVzLCBzbG90LAotICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBmdW5jLCBjcG9zKSAmIH5QQ0lfTVNJX0ZMQUdTX1FTSVpFOworICAg
ICAgICAgICAgY29udHJvbCA9IHBjaV9jb25mX3JlYWQxNihwZGV2LT5zYmRmLCBjcG9zKSAmIH5Q
Q0lfTVNJX0ZMQUdTX1FTSVpFOwogICAgICAgICAgICAgbXVsdGlfbXNpX2VuYWJsZShjb250cm9s
LCBlbnRyeS0+bXNpLm52ZWMpOwotICAgICAgICAgICAgcGNpX2NvbmZfd3JpdGUxNihwZGV2LT5z
YmRmLnNlZywgcGRldi0+c2JkZi5idXMsIHNsb3QsIGZ1bmMsIGNwb3MsCi0gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGNvbnRyb2wpOworICAgICAgICAgICAgcGNpX2NvbmZfd3JpdGUxNihw
ZGV2LT5zYmRmLCBjcG9zLCBjb250cm9sKTsKIAogICAgICAgICAgICAgbXNpX3NldF9lbmFibGUo
cGRldiwgMSk7CiAgICAgICAgIH0KICAgICB9CiAKICAgICBpZiAoIHR5cGUgPT0gUENJX0NBUF9J
RF9NU0lYICkKLSAgICAgICAgcGNpX2NvbmZfd3JpdGUxNihwZGV2LT5zYmRmLnNlZywgcGRldi0+
c2JkZi5idXMsIHNsb3QsIGZ1bmMsCi0gICAgICAgICAgICAgICAgICAgICAgICAgbXNpeF9jb250
cm9sX3JlZyhwb3MpLAorICAgICAgICBwY2lfY29uZl93cml0ZTE2KHBkZXYtPnNiZGYsIG1zaXhf
Y29udHJvbF9yZWcocG9zKSwKICAgICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sIHwgUENJ
X01TSVhfRkxBR1NfRU5BQkxFKTsKIAogICAgIHJldHVybiAwOwpkaWZmIC0tZ2l0IGEveGVuL2Fy
Y2gveDg2L29wcm9maWxlL29wX21vZGVsX2F0aGxvbi5jIGIveGVuL2FyY2gveDg2L29wcm9maWxl
L29wX21vZGVsX2F0aGxvbi5jCmluZGV4IDNkNmUyNmY2MzYuLjMzZjczOTQ5NzkgMTAwNjQ0Ci0t
LSBhL3hlbi9hcmNoL3g4Ni9vcHJvZmlsZS9vcF9tb2RlbF9hdGhsb24uYworKysgYi94ZW4vYXJj
aC94ODYvb3Byb2ZpbGUvb3BfbW9kZWxfYXRobG9uLmMKQEAgLTQ2Myw3ICs0NjMsMTMgQEAgc3Rh
dGljIGludCBfX2luaXQgaW5pdF9pYnNfbm1pKHZvaWQpCiAJZm9yIChidXMgPSAwOyBidXMgPCAy
NTY7IGJ1cysrKSB7CiAJCWZvciAoZGV2ID0gMDsgZGV2IDwgMzI7IGRldisrKSB7CiAJCQlmb3Ig
KGZ1bmMgPSAwOyBmdW5jIDwgODsgZnVuYysrKSB7Ci0JCQkJaWQgPSBwY2lfY29uZl9yZWFkMzIo
MCwgYnVzLCBkZXYsIGZ1bmMsIFBDSV9WRU5ET1JfSUQpOworCQkJCWNvbnN0IHBjaV9zYmRmX3Qg
c2JkZiA9IHsKKwkJCQkgICAgLmJ1cyA9IGJ1cywKKwkJCQkgICAgLmRldiA9IGRldiwKKwkJCQkg
ICAgLmZ1bmMgPSBmdW5jLAorCQkJCX07CisgICAgCisJCQkJaWQgPSBwY2lfY29uZl9yZWFkMzIo
c2JkZiwgUENJX1ZFTkRPUl9JRCk7CiAKIAkJCQl2ZW5kb3JfaWQgPSBpZCAmIDB4ZmZmZjsKIAkJ
CQlkZXZfaWQgPSAoaWQgPj4gMTYpICYgMHhmZmZmOwpAQCAtNDcxLDEwICs0NzcsMTAgQEAgc3Rh
dGljIGludCBfX2luaXQgaW5pdF9pYnNfbm1pKHZvaWQpCiAJCQkJaWYgKCh2ZW5kb3JfaWQgPT0g
UENJX1ZFTkRPUl9JRF9BTUQpICYmCiAJCQkJCShkZXZfaWQgPT0gUENJX0RFVklDRV9JRF9BTURf
MTBIX05CX01JU0MpKSB7CiAKLQkJCQkJcGNpX2NvbmZfd3JpdGUzMigwLCBidXMsIGRldiwgZnVu
YywgSUJTQ1RMLAorCQkJCQlwY2lfY29uZl93cml0ZTMyKHNiZGYsIElCU0NUTCwKIAkJCQkJCUlC
U0NUTF9MVlRPRkZTRVRWQUwgfCBBUElDX0VJTFZUX0xWVE9GRl9JQlMpOwogCi0JCQkJCXZhbHVl
ID0gcGNpX2NvbmZfcmVhZDMyKDAsIGJ1cywgZGV2LCBmdW5jLCBJQlNDVEwpOworCQkJCQl2YWx1
ZSA9IHBjaV9jb25mX3JlYWQzMihzYmRmLCBJQlNDVEwpOwogCiAJCQkJCWlmICh2YWx1ZSAhPSAo
SUJTQ1RMX0xWVE9GRlNFVFZBTCB8CiAJCQkJCQlBUElDX0VJTFZUX0xWVE9GRl9JQlMpKSB7CmRp
ZmYgLS1naXQgYS94ZW4vYXJjaC94ODYveDg2XzY0L21tY29uZi1mYW0xMGguYyBiL3hlbi9hcmNo
L3g4Ni94ODZfNjQvbW1jb25mLWZhbTEwaC5jCmluZGV4IGVkMGFjYjk5NjguLmU3ZjAyZGU4OTQg
MTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni94ODZfNjQvbW1jb25mLWZhbTEwaC5jCisrKyBiL3hl
bi9hcmNoL3g4Ni94ODZfNjQvbW1jb25mLWZhbTEwaC5jCkBAIC0zOCwyMSArMzgsMjIgQEAgc3Rh
dGljIHN0cnVjdCBwY2lfaG9zdGJyaWRnZV9wcm9iZSBwY2lfcHJvYmVzW10gPSB7CiAjZGVmaW5l
IEJBU0VfVkFMSUQoYikgKChiKSArIFNJWkUgPD0gKDB4ZmRVTEw8PDMyKSB8fCAoYikgPj0gKDFV
TEw8PDQwKSkKIHN0YXRpYyB2b2lkIF9faW5pdCBnZXRfZmFtMTBoX3BjaV9tbWNvbmZfYmFzZSh2
b2lkKQogewotCXVuc2lnbmVkIGludCBpLCBqLCBidXMsIHNsb3QsIGhpX21taW9fbnVtOworCXVu
c2lnbmVkIGludCBpLCBqLCBoaV9tbWlvX251bTsKIAl1MzIgYWRkcmVzczsKIAl1NjQgdmFsLCB0
b20yLCBzdGFydCwgZW5kOwogCXN0cnVjdCByYW5nZSB7CiAJCXU2NCBzdGFydCwgZW5kOwogCX0g
cmFuZ2VbOF07CisJcGNpX3NiZGZfdCBzYmRmID0geyB9OwogCiAJZm9yIChpID0gMDsgaSA8IEFS
UkFZX1NJWkUocGNpX3Byb2Jlcyk7IGkrKykgewogCQl1MzIgaWQ7CiAJCXUxNiBkZXZpY2U7CiAJ
CXUxNiB2ZW5kb3I7CiAKLQkJYnVzID0gcGNpX3Byb2Jlc1tpXS5idXM7Ci0JCXNsb3QgPSBwY2lf
cHJvYmVzW2ldLnNsb3Q7Ci0JCWlkID0gcGNpX2NvbmZfcmVhZDMyKDAsIGJ1cywgc2xvdCwgMCwg
UENJX1ZFTkRPUl9JRCk7CisJCXNiZGYuYnVzID0gcGNpX3Byb2Jlc1tpXS5idXM7CisJCXNiZGYu
ZGV2ID0gcGNpX3Byb2Jlc1tpXS5zbG90OworCQlpZCA9IHBjaV9jb25mX3JlYWQzMihzYmRmLCBQ
Q0lfVkVORE9SX0lEKTsKIAogCQl2ZW5kb3IgPSBpZCAmIDB4ZmZmZjsKIAkJZGV2aWNlID0gKGlk
Pj4xNikgJiAweGZmZmY7CkBAIC04MywxMiArODQsMTIgQEAgc3RhdGljIHZvaWQgX19pbml0IGdl
dF9mYW0xMGhfcGNpX21tY29uZl9iYXNlKHZvaWQpCiAJICogYWJvdmUgNEcKIAkgKi8KIAlmb3Ig
KGhpX21taW9fbnVtID0gaSA9IDA7IGkgPCA4OyBpKyspIHsKLQkJdmFsID0gcGNpX2NvbmZfcmVh
ZDMyKDAsIGJ1cywgc2xvdCwgMSwgMHg4MCArIChpIDw8IDMpKTsKKwkJdmFsID0gcGNpX2NvbmZf
cmVhZDMyKHNiZGYsIDB4ODAgKyAoaSA8PCAzKSk7CiAJCWlmICghKHZhbCAmIDMpKQogCQkJY29u
dGludWU7CiAKIAkJc3RhcnQgPSAodmFsICYgMHhmZmZmZmYwMCkgPDwgODsgLyogMzk6MTYgb24g
MzE6OCovCi0JCXZhbCA9IHBjaV9jb25mX3JlYWQzMigwLCBidXMsIHNsb3QsIDEsIDB4ODQgKyAo
aSA8PCAzKSk7CisJCXZhbCA9IHBjaV9jb25mX3JlYWQzMihzYmRmLCAweDg0ICsgKGkgPDwgMykp
OwogCQllbmQgPSAoKHZhbCAmIDB4ZmZmZmZmMDApIDw8IDgpIHwgMHhmZmZmOyAvKiAzOToxNiBv
biAzMTo4Ki8KIAogCQlpZiAoZW5kIDwgdG9tMikKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni94
ODZfNjQvbW1jb25maWctc2hhcmVkLmMgYi94ZW4vYXJjaC94ODYveDg2XzY0L21tY29uZmlnLXNo
YXJlZC5jCmluZGV4IDllMWM4MWRjZDIuLjI4NGE3ODhmY2QgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNo
L3g4Ni94ODZfNjQvbW1jb25maWctc2hhcmVkLmMKKysrIGIveGVuL2FyY2gveDg2L3g4Nl82NC9t
bWNvbmZpZy1zaGFyZWQuYwpAQCAtNjMsMTAgKzYzLDggQEAgY3VzdG9tX3BhcmFtKCJtbWNmZyIs
IHBhcnNlX21tY2ZnKTsKIAogc3RhdGljIGNvbnN0IGNoYXIgX19pbml0ICpwY2lfbW1jZmdfZTc1
MjAodm9pZCkKIHsKLSAgICB1MzIgd2luOwotICAgIHdpbiA9IHBjaV9jb25mX3JlYWQxNigwLCAw
LCAwLCAwLCAweGNlKTsKKyAgICB1aW50MzJfdCB3aW4gPSBwY2lfY29uZl9yZWFkMTYoUENJX1NC
REZfVCgwLCAwLCAwLCAwKSwgMHhjZSkgJiAweGYwMDA7CiAKLSAgICB3aW4gPSB3aW4gJiAweGYw
MDA7CiAgICAgaWYod2luID09IDB4MDAwMCB8fCB3aW4gPT0gMHhmMDAwKQogICAgICAgICBwY2lf
bW1jZmdfY29uZmlnX251bSA9IDA7CiAgICAgZWxzZSB7CkBAIC04OSw3ICs4Nyw3IEBAIHN0YXRp
YyBjb25zdCBjaGFyIF9faW5pdCAqcGNpX21tY2ZnX2ludGVsXzk0NSh2b2lkKQogCiAgICAgcGNp
X21tY2ZnX2NvbmZpZ19udW0gPSAxOwogCi0gICAgcGNpZXhiYXIgPSBwY2lfY29uZl9yZWFkMzIo
MCwgMCwgMCwgMCwgMHg0OCk7CisgICAgcGNpZXhiYXIgPSBwY2lfY29uZl9yZWFkMzIoUENJX1NC
REZfVCgwLCAwLCAwLCAwKSwgMHg0OCk7CiAKICAgICAvKiBFbmFibGUgYml0ICovCiAgICAgaWYg
KCEocGNpZXhiYXIgJiAxKSkKQEAgLTIxMiwxNSArMjEwLDE4IEBAIHN0YXRpYyBjb25zdCBjaGFy
IF9faW5pdCAqcGNpX21tY2ZnX252aWRpYV9tY3A1NSh2b2lkKQogICAgIGZvciAoaSA9IGJ1cyA9
IDA7IGJ1cyA8IDI1NjsgYnVzKyspIHsKICAgICAgICAgdTMyIGwsIGV4dGNmZzsKICAgICAgICAg
dTE2IHZlbmRvciwgZGV2aWNlOworICAgICAgICBjb25zdCBwY2lfc2JkZl90IHNiZGYgPSB7Cisg
ICAgICAgICAgICAuYnVzID0gYnVzLAorICAgICAgICB9OwogCi0gICAgICAgIGwgPSBwY2lfY29u
Zl9yZWFkMzIoMCwgYnVzLCAwLCAwLCAwKTsKKyAgICAgICAgbCA9IHBjaV9jb25mX3JlYWQzMihz
YmRmLCAwKTsKICAgICAgICAgdmVuZG9yID0gbCAmIDB4ZmZmZjsKICAgICAgICAgZGV2aWNlID0g
KGwgPj4gMTYpICYgMHhmZmZmOwogCiAgICAgICAgIGlmIChQQ0lfVkVORE9SX0lEX05WSURJQSAh
PSB2ZW5kb3IgfHwgMHgwMzY5ICE9IGRldmljZSkKICAgICAgICAgICAgIGNvbnRpbnVlOwogCi0g
ICAgICAgIGV4dGNmZyA9IHBjaV9jb25mX3JlYWQzMigwLCBidXMsIDAsIDAsIGV4dGNmZ19yZWdu
dW0pOworICAgICAgICBleHRjZmcgPSBwY2lfY29uZl9yZWFkMzIoc2JkZiwgZXh0Y2ZnX3JlZ251
bSk7CiAKICAgICAgICAgaWYgKGV4dGNmZyAmIGV4dGNmZ19lbmFibGVfbWFzaykKICAgICAgICAg
ICAgIGkrKzsKQEAgLTIzOCwxNSArMjM5LDE4IEBAIHN0YXRpYyBjb25zdCBjaGFyIF9faW5pdCAq
cGNpX21tY2ZnX252aWRpYV9tY3A1NSh2b2lkKQogICAgICAgICB1MzIgbCwgZXh0Y2ZnOwogICAg
ICAgICB1MTYgdmVuZG9yLCBkZXZpY2U7CiAgICAgICAgIGludCBzaXplX2luZGV4OworICAgICAg
ICBjb25zdCBwY2lfc2JkZl90IHNiZGYgPSB7CisgICAgICAgICAgICAuYnVzID0gYnVzLAorICAg
ICAgICB9OwogCi0gICAgICAgIGwgPSBwY2lfY29uZl9yZWFkMzIoMCwgYnVzLCAwLCAwLCAwKTsK
KyAgICAgICAgbCA9IHBjaV9jb25mX3JlYWQzMihzYmRmLCAwKTsKICAgICAgICAgdmVuZG9yID0g
bCAmIDB4ZmZmZjsKICAgICAgICAgZGV2aWNlID0gKGwgPj4gMTYpICYgMHhmZmZmOwogCiAgICAg
ICAgIGlmIChQQ0lfVkVORE9SX0lEX05WSURJQSAhPSB2ZW5kb3IgfHwgMHgwMzY5ICE9IGRldmlj
ZSkKICAgICAgICAgICAgIGNvbnRpbnVlOwogCi0gICAgICAgIGV4dGNmZyA9IHBjaV9jb25mX3Jl
YWQzMigwLCBidXMsIDAsIDAsIGV4dGNmZ19yZWdudW0pOworICAgICAgICBleHRjZmcgPSBwY2lf
Y29uZl9yZWFkMzIoc2JkZiwgZXh0Y2ZnX3JlZ251bSk7CiAKICAgICAgICAgaWYgKCEoZXh0Y2Zn
ICYgZXh0Y2ZnX2VuYWJsZV9tYXNrKSkKICAgICAgICAgICAgIGNvbnRpbnVlOwpAQCAtMzAwLDcg
KzMwNCw2IEBAIHN0YXRpYyBzdHJ1Y3QgcGNpX21tY2ZnX2hvc3RicmlkZ2VfcHJvYmUgcGNpX21t
Y2ZnX3Byb2Jlc1tdIF9faW5pdGRhdGEgPSB7CiBzdGF0aWMgaW50IF9faW5pdCBwY2lfbW1jZmdf
Y2hlY2tfaG9zdGJyaWRnZSh2b2lkKQogewogICAgIHUzMiBsOwotICAgIHUzMiBidXMsIGRldmZu
OwogICAgIHUxNiB2ZW5kb3IsIGRldmljZTsKICAgICBpbnQgaTsKICAgICBjb25zdCBjaGFyICpu
YW1lOwpAQCAtMzEwLDkgKzMxMyw4IEBAIHN0YXRpYyBpbnQgX19pbml0IHBjaV9tbWNmZ19jaGVj
a19ob3N0YnJpZGdlKHZvaWQpCiAgICAgbmFtZSA9IE5VTEw7CiAKICAgICBmb3IgKGkgPSAwOyAh
bmFtZSAmJiBpIDwgQVJSQVlfU0laRShwY2lfbW1jZmdfcHJvYmVzKTsgaSsrKSB7Ci0gICAgICAg
IGJ1cyA9ICBwY2lfbW1jZmdfcHJvYmVzW2ldLmJ1czsKLSAgICAgICAgZGV2Zm4gPSBwY2lfbW1j
ZmdfcHJvYmVzW2ldLmRldmZuOwotICAgICAgICBsID0gcGNpX2NvbmZfcmVhZDMyKDAsIGJ1cywg
UENJX1NMT1QoZGV2Zm4pLCBQQ0lfRlVOQyhkZXZmbiksIDApOworICAgICAgICBsID0gcGNpX2Nv
bmZfcmVhZDMyKFBDSV9TQkRGM19UKDAsIHBjaV9tbWNmZ19wcm9iZXNbaV0uYnVzLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBjaV9tbWNmZ19wcm9iZXNbaV0uZGV2
Zm4pLCAwKTsKICAgICAgICAgdmVuZG9yID0gbCAmIDB4ZmZmZjsKICAgICAgICAgZGV2aWNlID0g
KGwgPj4gMTYpICYgMHhmZmZmOwogCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYveDg2XzY0L3Bj
aS5jIGIveGVuL2FyY2gveDg2L3g4Nl82NC9wY2kuYwppbmRleCA0Zjc3YmViMTE5Li4zNDJjMmFh
OGU2IDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYveDg2XzY0L3BjaS5jCisrKyBiL3hlbi9hcmNo
L3g4Ni94ODZfNjQvcGNpLmMKQEAgLTgsMjUgKzgsMjAgQEAKICNpbmNsdWRlIDx4ZW4vcGNpLmg+
CiAjaW5jbHVkZSA8YXNtL2lvLmg+CiAKLSNkZWZpbmUgUENJX0NPTkZfQUREUkVTUyhidXMsIGRl
diwgZnVuYywgcmVnKSBcCi0gICAgKDB4ODAwMDAwMDAgfCAoYnVzIDw8IDE2KSB8IChkZXYgPDwg
MTEpIHwgKGZ1bmMgPDwgOCkgfCAocmVnICYgfjMpKQorI2RlZmluZSBQQ0lfQ09ORl9BRERSRVNT
KGJkZiwgcmVnKSAoMHg4MDAwMDAwMCB8IChiZGYgPDwgOCkgfCAocmVnICYgfjMpKQogCiAjZGVm
aW5lIEdFTl9QQ0lfQ09ORl9SRUFEKHMpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgXAotICAgIHVpbnQgIyMgcyAjIyBfdCBwY2lfY29uZl9yZWFkICMj
IHMgKHVuc2lnbmVkIGludCBzZWcsIHVuc2lnbmVkIGludCBidXMsICAgIFwKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgZGV2LCB1bnNpZ25lZCBp
bnQgZnVuYywgICBcCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5z
aWduZWQgaW50IHJlZykgICAgICAgICAgICAgICAgICAgICAgXAorICAgIHVpbnQgIyMgcyAjIyBf
dCBwY2lfY29uZl9yZWFkICMjIHMgKHBjaV9zYmRmX3Qgc2JkZiwgdW5zaWduZWQgIGludCByZWcp
ICAgIFwKICAgICB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCiAgICAgICAgIHVpbnQzMl90IHZhbHVlOyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIFwKICAgICAgICAgQlVJTERfQlVHX09OKHMgIT0gOCAmJiBz
ICE9IDE2ICYmIHMgIT0gMzIpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCi0gICAgICAg
IGlmICggc2VnIHx8IHJlZyA+IDI1NSApICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgXAotICAgICAgICAgICAgcGNpX21tY2ZnX3JlYWQoc2VnLCBidXMsIFBD
SV9ERVZGTihkZXYsIGZ1bmMpLCByZWcsIHMgLyA4LCAmdmFsdWUpO1wKKyAgICAgICAgaWYgKCBz
YmRmLnNlZyB8fCByZWcgPiAyNTUgKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBcCisgICAgICAgICAgICBwY2lfbW1jZmdfcmVhZChzYmRmLnNlZywgc2JkZi5idXMs
IHNiZGYuZXh0ZnVuYywgcmVnLCBzIC8gOCwgICAgICAgXAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgJnZhbHVlKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IFwKICAgICAgICAgZWxzZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBcCi0gICAgICAgIHsgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAotICAg
ICAgICAgICAgQlVHX09OKChidXMgPiAyNTUpIHx8IChkZXYgPiAzMSkgfHwgKGZ1bmMgPiA3KSk7
ICAgICAgICAgICAgICAgICAgIFwKLSAgICAgICAgICAgIHZhbHVlID0gcGNpX2NvbmZfcmVhZChQ
Q0lfQ09ORl9BRERSRVNTKGJ1cywgZGV2LCBmdW5jLCByZWcpLCAgICAgICBcCisgICAgICAgICAg
ICB2YWx1ZSA9IHBjaV9jb25mX3JlYWQoUENJX0NPTkZfQUREUkVTUyhzYmRmLmJkZiwgcmVnKSwg
ICAgICAgICAgICAgXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZyAmICg0
IC0gcyAvIDgpLCBzIC8gOCk7ICAgICAgICAgICAgICAgICAgIFwKLSAgICAgICAgfSAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAogICAgICAgICByZXR1cm4gdmFsdWU7ICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwK
ICAgICB9CkBAIC00NywxOSArNDIsMTYgQEAgR0VOX1BDSV9DT05GX1JFQUQoMzIpCiAjdW5kZWYg
R0VOX1BDSV9DT05GX1JFQUQKIAogI2RlZmluZSBHRU5fUENJX0NPTkZfV1JJVEUocykgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwKLSAgICB2b2lkIHBj
aV9jb25mX3dyaXRlICMjIHMgKHVuc2lnbmVkIGludCBzZWcsIHVuc2lnbmVkIGludCBidXMsICAg
ICAgICAgICAgICBcCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQg
ZGV2LCB1bnNpZ25lZCBpbnQgZnVuYywgICAgICAgICAgICAgXAotICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgdW5zaWduZWQgaW50IHJlZywgdWludCAjIyBzICMjIF90IGRhdGEpICAgICAg
ICAgIFwKKyAgICB2b2lkIHBjaV9jb25mX3dyaXRlICMjIHMgKHBjaV9zYmRmX3Qgc2JkZiwgdW5z
aWduZWQgaW50IHJlZywgICAgICAgICAgICAgICBcCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICB1aW50ICMjIHMgIyMgX3QgZGF0YSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAog
ICAgIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIFwKICAgICAgICAgQlVJTERfQlVHX09OKHMgIT0gOCAmJiBz
ICE9IDE2ICYmIHMgIT0gMzIpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCi0gICAgICAg
IGlmICggc2VnIHx8IHJlZyA+IDI1NSApICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgXAotICAgICAgICAgICAgcGNpX21tY2ZnX3dyaXRlKHNlZywgYnVzLCBQ
Q0lfREVWRk4oZGV2LCBmdW5jKSwgcmVnLCBzIC8gOCwgZGF0YSk7IFwKKyAgICAgICAgaWYgKCBz
YmRmLnNlZyB8fCByZWcgPiAyNTUgKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBcCisgICAgICAgICAgICBwY2lfbW1jZmdfd3JpdGUoc2JkZi5zZWcsIHNiZGYuYnVz
LCBzYmRmLmV4dGZ1bmMsIHJlZywgcyAvIDgsICAgICAgXAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGRhdGEpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IFwKICAgICAgICAgZWxzZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBcCi0gICAgICAgIHsgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAotICAg
ICAgICAgICAgQlVHX09OKChidXMgPiAyNTUpIHx8IChkZXYgPiAzMSkgfHwgKGZ1bmMgPiA3KSk7
ICAgICAgICAgICAgICAgICAgIFwKLSAgICAgICAgICAgIHBjaV9jb25mX3dyaXRlKFBDSV9DT05G
X0FERFJFU1MoYnVzLCBkZXYsIGZ1bmMsIHJlZyksICAgICAgICAgICAgICBcCisgICAgICAgICAg
ICBwY2lfY29uZl93cml0ZShQQ0lfQ09ORl9BRERSRVNTKHNiZGYuYmRmLCByZWcpLCAgICAgICAg
ICAgICAgICAgICAgXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnICYgKDQgLSBzIC8g
OCksIHMgLyA4LCBkYXRhKTsgICAgICAgICAgICAgICAgICAgIFwKLSAgICAgICAgfSAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBcCiAgICAgfQogCiAvKiBHcmVwIGZvZGRlciAqLwpkaWZmIC0tZ2l0IGEveGVuL2RyaXZl
cnMvYWNwaS9yZWJvb3QuYyBiL3hlbi9kcml2ZXJzL2FjcGkvcmVib290LmMKaW5kZXggNzJkMDZm
ZDhlNS4uOTE5MjM5ZmFhMSAxMDA2NDQKLS0tIGEveGVuL2RyaXZlcnMvYWNwaS9yZWJvb3QuYwor
KysgYi94ZW4vZHJpdmVycy9hY3BpL3JlYm9vdC5jCkBAIC0yMywxMSArMjMsOSBAQCB2b2lkIGFj
cGlfcmVib290KHZvaWQpCiAJY2FzZSBBQ1BJX0FEUl9TUEFDRV9QQ0lfQ09ORklHOgogCQlwcmlu
dGsoIlJlc2V0dGluZyB3aXRoIEFDUEkgUENJIFJFU0VUX1JFRy5cbiIpOwogCQkvKiBXcml0ZSB0
aGUgdmFsdWUgdGhhdCByZXNldHMgdXMuICovCi0JCXBjaV9jb25mX3dyaXRlOCgwLCAwLAotCQkJ
CShyci0+YWRkcmVzcyA+PiAzMikgJiAzMSwKLQkJCQkocnItPmFkZHJlc3MgPj4gMTYpICYgNywK
LQkJCQkocnItPmFkZHJlc3MgJiAyNTUpLAotCQkJCXJlc2V0X3ZhbHVlKTsKKwkJcGNpX2NvbmZf
d3JpdGU4KFBDSV9TQkRGX1QoMCwgMCwgKHJyLT5hZGRyZXNzID4+IDMyKSAmIDMxLAorCQkJCQkg
ICAocnItPmFkZHJlc3MgPj4gMTYpICYgNyksCisJCQkJKHJyLT5hZGRyZXNzICYgMjU1KSwgcmVz
ZXRfdmFsdWUpOwogCQlicmVhazsKIAljYXNlIEFDUElfQURSX1NQQUNFX1NZU1RFTV9NRU1PUlk6
CiAJY2FzZSBBQ1BJX0FEUl9TUEFDRV9TWVNURU1fSU86CmRpZmYgLS1naXQgYS94ZW4vZHJpdmVy
cy9jaGFyL2VoY2ktZGJncC5jIGIveGVuL2RyaXZlcnMvY2hhci9laGNpLWRiZ3AuYwppbmRleCA0
NzVkYzQxNzY3Li40Y2Q0MTU3MzUzIDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy9jaGFyL2VoY2kt
ZGJncC5jCisrKyBiL3hlbi9kcml2ZXJzL2NoYXIvZWhjaS1kYmdwLmMKQEAgLTY4Miw3ICs2ODIs
OCBAQCBzdGF0aWMgaW50IGRiZ3BfY29udHJvbF9tc2coc3RydWN0IGVoY2lfZGJncCAqZGJncCwg
dW5zaWduZWQgaW50IGRldm51bSwKIAogc3RhdGljIHVuc2lnbmVkIGludCBfX2luaXQgX19maW5k
X2RiZ3AodTggYnVzLCB1OCBzbG90LCB1OCBmdW5jKQogewotICAgIHUzMiBjbGFzcyA9IHBjaV9j
b25mX3JlYWQzMigwLCBidXMsIHNsb3QsIGZ1bmMsIFBDSV9DTEFTU19SRVZJU0lPTik7CisgICAg
dWludDMyX3QgY2xhc3MgPSBwY2lfY29uZl9yZWFkMzIoUENJX1NCREZfVCgwLCBidXMsIHNsb3Qs
IGZ1bmMpLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9DTEFTU19S
RVZJU0lPTik7CiAKICAgICBpZiAoIChjbGFzcyA+PiA4KSAhPSBQQ0lfQ0xBU1NfU0VSSUFMX1VT
Ql9FSENJICkKICAgICAgICAgcmV0dXJuIDA7CkBAIC03MTMsOCArNzE0LDkgQEAgc3RhdGljIHVu
c2lnbmVkIGludCBfX2luaXQgZmluZF9kYmdwKHN0cnVjdCBlaGNpX2RiZ3AgKmRiZ3AsCiAgICAg
ICAgICAgICAgICAgY2FwID0gX19maW5kX2RiZ3AoYnVzLCBzbG90LCBmdW5jKTsKICAgICAgICAg
ICAgICAgICBpZiAoICFjYXAgfHwgZWhjaV9udW0tLSApCiAgICAgICAgICAgICAgICAgewotICAg
ICAgICAgICAgICAgICAgICBpZiAoICFmdW5jICYmICEocGNpX2NvbmZfcmVhZDgoMCwgYnVzLCBz
bG90LCBmdW5jLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgUENJX0hFQURFUl9UWVBFKSAmIDB4ODApICkKKyAgICAgICAgICAgICAgICAgICAgaWYg
KCAhZnVuYyAmJgorICAgICAgICAgICAgICAgICAgICAgICAgICEocGNpX2NvbmZfcmVhZDgoUENJ
X1NCREZfVCgwLCBidXMsIHNsb3QsIGZ1bmMpLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgUENJX0hFQURFUl9UWVBFKSAmIDB4ODApICkKICAgICAgICAgICAgICAg
ICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAg
ICAgICAgICB9CkBAIC0xMDA2LDE3ICsxMDA4LDIyIEBAIHN0YXRpYyBzZXRfZGVidWdfcG9ydF90
IF9fcmVhZF9tb3N0bHkgc2V0X2RlYnVnX3BvcnQgPSBkZWZhdWx0X3NldF9kZWJ1Z19wb3J0Owog
CiBzdGF0aWMgdm9pZCBudmlkaWFfc2V0X2RlYnVnX3BvcnQoc3RydWN0IGVoY2lfZGJncCAqZGJn
cCwgdW5zaWduZWQgaW50IHBvcnQpCiB7Ci0gICAgdTMyIGR3b3JkID0gcGNpX2NvbmZfcmVhZDMy
KDAsIGRiZ3AtPmJ1cywgZGJncC0+c2xvdCwgZGJncC0+ZnVuYywgMHg3NCk7CisgICAgY29uc3Qg
cGNpX3NiZGZfdCBzYmRmID0geworICAgICAgICAuYnVzID0gZGJncC0+YnVzLAorICAgICAgICAu
ZGV2ID0gZGJncC0+c2xvdCwKKyAgICAgICAgLmZ1bmMgPSBkYmdwLT5mdW5jLAorICAgIH07Cisg
ICAgdWludDMyX3QgZHdvcmQgPSBwY2lfY29uZl9yZWFkMzIoc2JkZiwgMHg3NCk7CiAKICAgICBk
d29yZCAmPSB+KDB4MGYgPDwgMTIpOwogICAgIGR3b3JkIHw9IChwb3J0ICYgMHgwZikgPDwgMTI7
Ci0gICAgcGNpX2NvbmZfd3JpdGUzMigwLCBkYmdwLT5idXMsIGRiZ3AtPnNsb3QsIGRiZ3AtPmZ1
bmMsIDB4NzQsIGR3b3JkKTsKKyAgICBwY2lfY29uZl93cml0ZTMyKHNiZGYsIDB4NzQsIGR3b3Jk
KTsKICAgICBkYmdwX3ByaW50aygic2V0IGRlYnVnIHBvcnQgdG8gJXVcbiIsIHBvcnQpOwogfQog
CiBzdGF0aWMgdm9pZCBfX2luaXQgZGV0ZWN0X3NldF9kZWJ1Z19wb3J0KHN0cnVjdCBlaGNpX2Ri
Z3AgKmRiZ3ApCiB7Ci0gICAgaWYgKCBwY2lfY29uZl9yZWFkMTYoMCwgZGJncC0+YnVzLCBkYmdw
LT5zbG90LCBkYmdwLT5mdW5jLAorICAgIGlmICggcGNpX2NvbmZfcmVhZDE2KFBDSV9TQkRGX1Qo
MCwgZGJncC0+YnVzLCBkYmdwLT5zbG90LCBkYmdwLT5mdW5jKSwKICAgICAgICAgICAgICAgICAg
ICAgICAgICBQQ0lfVkVORE9SX0lEKSA9PSAweDEwZGUgKQogICAgIHsKICAgICAgICAgZGJncF9w
cmludGsoInVzaW5nIG52aWRpYSBzZXRfZGVidWdfcG9ydFxuIik7CkBAIC0xMDM1LDE3ICsxMDQy
LDIyIEBAIHN0YXRpYyB2b2lkIGVoY2lfZGJncF9iaW9zX2hhbmRvZmYoc3RydWN0IGVoY2lfZGJn
cCAqZGJncCwgdTMyIGhjY19wYXJhbXMpCiAgICAgdTMyIGNhcDsKICAgICB1bnNpZ25lZCBpbnQg
b2Zmc2V0ID0gSENDX0VYVF9DQVBTKGhjY19wYXJhbXMpOwogICAgIGludCBtc2VjOworICAgIGNv
bnN0IHBjaV9zYmRmX3Qgc2JkZiA9IHsKKyAgICAgICAgLmJ1cyA9IGRiZ3AtPmJ1cywKKyAgICAg
ICAgLmRldiA9IGRiZ3AtPnNsb3QsCisgICAgICAgIC5mdW5jID0gZGJncC0+ZnVuYywKKyAgICB9
OwogCiAgICAgaWYgKCAhb2Zmc2V0ICkKICAgICAgICAgcmV0dXJuOwogCi0gICAgY2FwID0gcGNp
X2NvbmZfcmVhZDMyKDAsIGRiZ3AtPmJ1cywgZGJncC0+c2xvdCwgZGJncC0+ZnVuYywgb2Zmc2V0
KTsKKyAgICBjYXAgPSBwY2lfY29uZl9yZWFkMzIoc2JkZiwgb2Zmc2V0KTsKICAgICBkYmdwX3By
aW50aygiZGJncDogRUhDSSBCSU9TIHN0YXRlICUwOHhcbiIsIGNhcCk7CiAKICAgICBpZiAoIChj
YXAgJiAweGZmKSA9PSAxICYmIChjYXAgJiBFSENJX1VTQkxFR1NVUF9CSU9TKSApCiAgICAgewog
ICAgICAgICBkYmdwX3ByaW50aygiZGJncDogQklPUyBoYW5kb2ZmXG4iKTsKLSAgICAgICAgcGNp
X2NvbmZfd3JpdGU4KDAsIGRiZ3AtPmJ1cywgZGJncC0+c2xvdCwgZGJncC0+ZnVuYywgb2Zmc2V0
ICsgMywgMSk7CisgICAgICAgIHBjaV9jb25mX3dyaXRlOChzYmRmLCBvZmZzZXQgKyAzLCAxKTsK
ICAgICB9CiAKICAgICAvKiBpZiBib290IGZpcm13YXJlIG5vdyBvd25zIEVIQ0ksIHNwaW4gdGls
bCBpdCBoYW5kcyBpdCBvdmVyLiAqLwpAQCAtMTA1NCw3ICsxMDY2LDcgQEAgc3RhdGljIHZvaWQg
ZWhjaV9kYmdwX2Jpb3NfaGFuZG9mZihzdHJ1Y3QgZWhjaV9kYmdwICpkYmdwLCB1MzIgaGNjX3Bh
cmFtcykKICAgICB7CiAgICAgICAgIG1kZWxheSgxMCk7CiAgICAgICAgIG1zZWMgLT0gMTA7Ci0g
ICAgICAgIGNhcCA9IHBjaV9jb25mX3JlYWQzMigwLCBkYmdwLT5idXMsIGRiZ3AtPnNsb3QsIGRi
Z3AtPmZ1bmMsIG9mZnNldCk7CisgICAgICAgIGNhcCA9IHBjaV9jb25mX3JlYWQzMihzYmRmLCBv
ZmZzZXQpOwogICAgIH0KIAogICAgIGlmICggY2FwICYgRUhDSV9VU0JMRUdTVVBfQklPUyApCkBA
IC0xMDYyLDEyICsxMDc0LDExIEBAIHN0YXRpYyB2b2lkIGVoY2lfZGJncF9iaW9zX2hhbmRvZmYo
c3RydWN0IGVoY2lfZGJncCAqZGJncCwgdTMyIGhjY19wYXJhbXMpCiAgICAgICAgIC8qIHdlbGws
IHBvc3NpYmx5IGJ1Z2d5IEJJT1MuLi4gdHJ5IHRvIHNodXQgaXQgZG93biwKICAgICAgICAgICog
YW5kIGhvcGUgbm90aGluZyBnb2VzIHRvbyB3cm9uZyAqLwogICAgICAgICBkYmdwX3ByaW50aygi
ZGJncDogQklPUyBoYW5kb2ZmIGZhaWxlZDogJTA4eFxuIiwgY2FwKTsKLSAgICAgICAgcGNpX2Nv
bmZfd3JpdGU4KDAsIGRiZ3AtPmJ1cywgZGJncC0+c2xvdCwgZGJncC0+ZnVuYywgb2Zmc2V0ICsg
MiwgMCk7CisgICAgICAgIHBjaV9jb25mX3dyaXRlOChzYmRmLCBvZmZzZXQgKyAyLCAwKTsKICAg
ICB9CiAKICAgICAvKiBqdXN0IGluIGNhc2UsIGFsd2F5cyBkaXNhYmxlIEVIQ0kgU01JcyAqLwot
ICAgIHBjaV9jb25mX3dyaXRlOCgwLCBkYmdwLT5idXMsIGRiZ3AtPnNsb3QsIGRiZ3AtPmZ1bmMs
Ci0gICAgICAgICAgICAgICAgICAgIG9mZnNldCArIEVIQ0lfVVNCTEVHQ1RMU1RTLCAwKTsKKyAg
ICBwY2lfY29uZl93cml0ZTgoc2JkZiwgb2Zmc2V0ICsgRUhDSV9VU0JMRUdDVExTVFMsIDApOwog
fQogCiBzdGF0aWMgaW50IGVoY2lfZGJncF9zZXR1cChzdHJ1Y3QgZWhjaV9kYmdwICpkYmdwKQpA
QCAtMTMwNiwxOSArMTMxNywyMSBAQCBzdGF0aWMgdm9pZCBfX2luaXQgZWhjaV9kYmdwX2luaXRf
cHJlaXJxKHN0cnVjdCBzZXJpYWxfcG9ydCAqcG9ydCkKICAgICBzdHJ1Y3QgZWhjaV9kYmdwICpk
YmdwID0gcG9ydC0+dWFydDsKICAgICB1MzIgZGVidWdfcG9ydCwgb2Zmc2V0OwogICAgIHZvaWQg
X19pb21lbSAqZWhjaV9iYXI7CisgICAgY29uc3QgcGNpX3NiZGZfdCBzYmRmID0geworICAgICAg
ICAuYnVzICA9IGRiZ3AtPmJ1cywKKyAgICAgICAgLmRldiA9IGRiZ3AtPnNsb3QsCisgICAgICAg
IC5mdW5jID0gZGJncC0+ZnVuYywKKyAgICB9OwogCi0gICAgZGVidWdfcG9ydCA9IHBjaV9jb25m
X3JlYWQzMigwLCBkYmdwLT5idXMsIGRiZ3AtPnNsb3QsIGRiZ3AtPmZ1bmMsCi0gICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBkYmdwLT5jYXApOworICAgIGRlYnVnX3BvcnQgPSBwY2lf
Y29uZl9yZWFkMzIoc2JkZiwgZGJncC0+Y2FwKTsKICAgICBvZmZzZXQgPSAoZGVidWdfcG9ydCA+
PiAxNikgJiAweGZmZjsKIAogICAgIC8qIGRvdWJsZSBjaGVjayBpZiB0aGUgbWVtIHNwYWNlIGlz
IGVuYWJsZWQgKi8KLSAgICBkYmdwLT5wY2lfY3IgPSBwY2lfY29uZl9yZWFkOCgwLCBkYmdwLT5i
dXMsIGRiZ3AtPnNsb3QsIGRiZ3AtPmZ1bmMsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgUENJX0NPTU1BTkQpOworICAgIGRiZ3AtPnBjaV9jciA9IHBjaV9jb25mX3JlYWQ4KHNi
ZGYsIFBDSV9DT01NQU5EKTsKICAgICBpZiAoICEoZGJncC0+cGNpX2NyICYgUENJX0NPTU1BTkRf
TUVNT1JZKSApCiAgICAgewogICAgICAgICBkYmdwLT5wY2lfY3IgfD0gUENJX0NPTU1BTkRfTUVN
T1JZOwotICAgICAgICBwY2lfY29uZl93cml0ZTE2KDAsIGRiZ3AtPmJ1cywgZGJncC0+c2xvdCwg
ZGJncC0+ZnVuYywgUENJX0NPTU1BTkQsCi0gICAgICAgICAgICAgICAgICAgICAgICAgZGJncC0+
cGNpX2NyKTsKKyAgICAgICAgcGNpX2NvbmZfd3JpdGUxNihzYmRmLCBQQ0lfQ09NTUFORCwgZGJn
cC0+cGNpX2NyKTsKICAgICAgICAgZGJncF9wcmludGsoIk1NSU8gZm9yIEVIQ0kgZW5hYmxlZFxu
Iik7CiAgICAgfQogCkBAIC0xNDE1LDggKzE0MjgsOCBAQCBzdGF0aWMgdm9pZCBlaGNpX2RiZ3Bf
c3VzcGVuZChzdHJ1Y3Qgc2VyaWFsX3BvcnQgKnBvcnQpCiAgICAgc3RvcF90aW1lcigmZGJncC0+
dGltZXIpOwogICAgIGRiZ3AtPnRpbWVyLmV4cGlyZXMgPSAwOwogCi0gICAgZGJncC0+cGNpX2Ny
ID0gcGNpX2NvbmZfcmVhZDE2KDAsIGRiZ3AtPmJ1cywgZGJncC0+c2xvdCwgZGJncC0+ZnVuYywK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX0NPTU1BTkQpOworICAgIGRi
Z3AtPnBjaV9jciA9IHBjaV9jb25mX3JlYWQxNihQQ0lfU0JERl9UKDAsIGRiZ3AtPmJ1cywgZGJn
cC0+c2xvdCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBk
YmdwLT5mdW5jKSwgUENJX0NPTU1BTkQpOwogCiAgICAgZGJncC0+c3RhdGUgPSBkYmdwX3Vuc2Fm
ZTsKIH0KQEAgLTE0MjQsMTQgKzE0MzcsMTcgQEAgc3RhdGljIHZvaWQgZWhjaV9kYmdwX3N1c3Bl
bmQoc3RydWN0IHNlcmlhbF9wb3J0ICpwb3J0KQogc3RhdGljIHZvaWQgZWhjaV9kYmdwX3Jlc3Vt
ZShzdHJ1Y3Qgc2VyaWFsX3BvcnQgKnBvcnQpCiB7CiAgICAgc3RydWN0IGVoY2lfZGJncCAqZGJn
cCA9IHBvcnQtPnVhcnQ7CisgICAgY29uc3QgcGNpX3NiZGZfdCBzYmRmID0geworICAgICAgICAu
YnVzID0gZGJncC0+YnVzLAorICAgICAgICAuZGV2ID0gZGJncC0+c2xvdCwKKyAgICAgICAgLmZ1
bmMgPSBkYmdwLT5mdW5jLAorICAgIH07CiAKICAgICBpZiAoICFkYmdwLT5laGNpX2RlYnVnICkK
ICAgICAgICAgcmV0dXJuOwogCi0gICAgcGNpX2NvbmZfd3JpdGUzMigwLCBkYmdwLT5idXMsIGRi
Z3AtPnNsb3QsIGRiZ3AtPmZ1bmMsIGRiZ3AtPmJhciwKLSAgICAgICAgICAgICAgICAgICAgIGRi
Z3AtPmJhcl92YWwpOwotICAgIHBjaV9jb25mX3dyaXRlMTYoMCwgZGJncC0+YnVzLCBkYmdwLT5z
bG90LCBkYmdwLT5mdW5jLAotICAgICAgICAgICAgICAgICAgICAgUENJX0NPTU1BTkQsIGRiZ3At
PnBjaV9jcik7CisgICAgcGNpX2NvbmZfd3JpdGUzMihzYmRmLCBkYmdwLT5iYXIsIGRiZ3AtPmJh
cl92YWwpOworICAgIHBjaV9jb25mX3dyaXRlMTYoc2JkZiwgUENJX0NPTU1BTkQsIGRiZ3AtPnBj
aV9jcik7CiAKICAgICBlaGNpX2RiZ3Bfc2V0dXBfcHJlaXJxKGRiZ3ApOwogICAgIGVoY2lfZGJn
cF9zZXR1cF9wb3N0aXJxKGRiZ3ApOwpAQCAtMTQ1OSw2ICsxNDc1LDExIEBAIHZvaWQgX19pbml0
IGVoY2lfZGJncF9pbml0KHZvaWQpCiAgICAgc3RydWN0IGVoY2lfZGJncCAqZGJncCA9ICZlaGNp
X2RiZ3A7CiAgICAgdTMyIGRlYnVnX3BvcnQsIG9mZnNldCwgYmFyX3ZhbDsKICAgICBjb25zdCBj
aGFyICplOworICAgIGNvbnN0IHBjaV9zYmRmX3Qgc2JkZiA9IHsKKyAgICAgICAgLmJ1cyA9IGRi
Z3AtPmJ1cywKKyAgICAgICAgLmRldiA9IGRiZ3AtPnNsb3QsCisgICAgICAgIC5mdW5jID0gZGJn
cC0+ZnVuYywKKyAgICB9OwogCiAgICAgaWYgKCBzdHJuY21wKG9wdF9kYmdwLCAiZWhjaSIsIDQp
ICkKICAgICAgICAgcmV0dXJuOwpAQCAtMTUwMiw4ICsxNTIzLDcgQEAgdm9pZCBfX2luaXQgZWhj
aV9kYmdwX2luaXQodm9pZCkKICAgICBlbHNlCiAgICAgICAgIHJldHVybjsKIAotICAgIGRlYnVn
X3BvcnQgPSBwY2lfY29uZl9yZWFkMzIoMCwgZGJncC0+YnVzLCBkYmdwLT5zbG90LCBkYmdwLT5m
dW5jLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGJncC0+Y2FwKTsKKyAgICBk
ZWJ1Z19wb3J0ID0gcGNpX2NvbmZfcmVhZDMyKHNiZGYsIGRiZ3AtPmNhcCk7CiAgICAgZGJncC0+
YmFyID0gKGRlYnVnX3BvcnQgPj4gMjkpICYgMHg3OwogICAgIGRiZ3AtPmJhciA9ICgoZGJncC0+
YmFyIC0gMSkgKiA0KSArIFBDSV9CQVNFX0FERFJFU1NfMDsKICAgICBvZmZzZXQgPSAoZGVidWdf
cG9ydCA+PiAxNikgJiAweGZmZjsKQEAgLTE1MTQsOCArMTUzNCw3IEBAIHZvaWQgX19pbml0IGVo
Y2lfZGJncF9pbml0KHZvaWQpCiAgICAgICAgIHJldHVybjsKICAgICB9CiAKLSAgICBkYmdwLT5i
YXJfdmFsID0gYmFyX3ZhbCA9IHBjaV9jb25mX3JlYWQzMigwLCBkYmdwLT5idXMsIGRiZ3AtPnNs
b3QsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGJncC0+
ZnVuYywgZGJncC0+YmFyKTsKKyAgICBkYmdwLT5iYXJfdmFsID0gYmFyX3ZhbCA9IHBjaV9jb25m
X3JlYWQzMihzYmRmLCBkYmdwLT5iYXIpOwogICAgIGRiZ3BfcHJpbnRrKCJiYXJfdmFsOiAlMDh4
XG4iLCBiYXJfdmFsKTsKICAgICBpZiAoIGJhcl92YWwgJiB+UENJX0JBU0VfQUREUkVTU19NRU1f
TUFTSyApCiAgICAgewpkaWZmIC0tZ2l0IGEveGVuL2RyaXZlcnMvY2hhci9uczE2NTUwLmMgYi94
ZW4vZHJpdmVycy9jaGFyL25zMTY1NTAuYwppbmRleCAxODllMTIxYjdlLi42OTg5ODRkODc5IDEw
MDY0NAotLS0gYS94ZW4vZHJpdmVycy9jaGFyL25zMTY1NTAuYworKysgYi94ZW4vZHJpdmVycy9j
aGFyL25zMTY1NTAuYwpAQCAtNjIwLDIwICs2MjAsMjMgQEAgc3RhdGljIGludCBuczE2NTUwX2dl
dGMoc3RydWN0IHNlcmlhbF9wb3J0ICpwb3J0LCBjaGFyICpwYykKIHN0YXRpYyB2b2lkIHBjaV9z
ZXJpYWxfZWFybHlfaW5pdChzdHJ1Y3QgbnMxNjU1MCAqdWFydCkKIHsKICNpZmRlZiBDT05GSUdf
SEFTX1BDSQorICAgIGNvbnN0IHBjaV9zYmRmX3Qgc2JkZiA9IHsKKyAgICAgICAgLmJ1cyA9IHVh
cnQtPnBiX2JkZlswXSwKKyAgICAgICAgLmRldiA9IHVhcnQtPnBiX2JkZlsxXSwKKyAgICAgICAg
LmZ1bmMgPSB1YXJ0LT5wYl9iZGZbMl0sCisgICAgfTsKKwogICAgIGlmICggIXVhcnQtPnBzX2Jk
Zl9lbmFibGUgfHwgdWFydC0+aW9fYmFzZSA+PSAweDEwMDAwICkKICAgICAgICAgcmV0dXJuOwog
CiAgICAgaWYgKCB1YXJ0LT5wYl9iZGZfZW5hYmxlICkKLSAgICAgICAgcGNpX2NvbmZfd3JpdGUx
NigwLCB1YXJ0LT5wYl9iZGZbMF0sIHVhcnQtPnBiX2JkZlsxXSwgdWFydC0+cGJfYmRmWzJdLAot
ICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9JT19CQVNFLAorICAgICAgICBwY2lfY29uZl93
cml0ZTE2KHNiZGYsIFBDSV9JT19CQVNFLAogICAgICAgICAgICAgICAgICAgICAgICAgICh1YXJ0
LT5pb19iYXNlICYgMHhGMDAwKSB8CiAgICAgICAgICAgICAgICAgICAgICAgICAgKCh1YXJ0LT5p
b19iYXNlICYgMHhGMDAwKSA+PiA4KSk7CiAKLSAgICBwY2lfY29uZl93cml0ZTMyKDAsIHVhcnQt
PnBzX2JkZlswXSwgdWFydC0+cHNfYmRmWzFdLCB1YXJ0LT5wc19iZGZbMl0sCi0gICAgICAgICAg
ICAgICAgICAgICBQQ0lfQkFTRV9BRERSRVNTXzAsCisgICAgcGNpX2NvbmZfd3JpdGUzMihzYmRm
LCBQQ0lfQkFTRV9BRERSRVNTXzAsCiAgICAgICAgICAgICAgICAgICAgICB1YXJ0LT5pb19iYXNl
IHwgUENJX0JBU0VfQUREUkVTU19TUEFDRV9JTyk7Ci0gICAgcGNpX2NvbmZfd3JpdGUxNigwLCB1
YXJ0LT5wc19iZGZbMF0sIHVhcnQtPnBzX2JkZlsxXSwgdWFydC0+cHNfYmRmWzJdLAotICAgICAg
ICAgICAgICAgICAgICAgUENJX0NPTU1BTkQsIFBDSV9DT01NQU5EX0lPKTsKKyAgICBwY2lfY29u
Zl93cml0ZTE2KHNiZGYsIFBDSV9DT01NQU5ELCBQQ0lfQ09NTUFORF9JTyk7CiAjZW5kaWYKIH0K
IApAQCAtODQ2LDggKzg0OSw5IEBAIHN0YXRpYyB2b2lkIG5zMTY1NTBfc3VzcGVuZChzdHJ1Y3Qg
c2VyaWFsX3BvcnQgKnBvcnQpCiAKICNpZmRlZiBDT05GSUdfSEFTX1BDSQogICAgIGlmICggdWFy
dC0+YmFyICkKLSAgICAgICB1YXJ0LT5jciA9IHBjaV9jb25mX3JlYWQxNigwLCB1YXJ0LT5wc19i
ZGZbMF0sIHVhcnQtPnBzX2JkZlsxXSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICB1YXJ0LT5wc19iZGZbMl0sIFBDSV9DT01NQU5EKTsKKyAgICAgICAgdWFydC0+Y3IgPSBwY2lf
Y29uZl9yZWFkMTYoUENJX1NCREZfVCgwLCB1YXJ0LT5wc19iZGZbMF0sCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWFydC0+cHNfYmRmWzFdLCB1YXJ0LT5w
c19iZGZbMl0pLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lfQ09NTUFO
RCk7CiAjZW5kaWYKIH0KIApAQCAtODU1LDIwICs4NTksMjIgQEAgc3RhdGljIHZvaWQgX25zMTY1
NTBfcmVzdW1lKHN0cnVjdCBzZXJpYWxfcG9ydCAqcG9ydCkKIHsKICNpZmRlZiBDT05GSUdfSEFT
X1BDSQogICAgIHN0cnVjdCBuczE2NTUwICp1YXJ0ID0gcG9ydC0+dWFydDsKKyAgICBjb25zdCBw
Y2lfc2JkZl90IHNiZGYgPSB7CisgICAgICAgIC5idXMgPSB1YXJ0LT5wc19iZGZbMF0sCisgICAg
ICAgIC5kZXYgPSB1YXJ0LT5wc19iZGZbMV0sCisgICAgICAgIC5mdW5jID0gdWFydC0+cHNfYmRm
WzJdLAorICAgIH07CiAKICAgICBpZiAoIHVhcnQtPmJhciApCiAgICAgewotICAgICAgIHBjaV9j
b25mX3dyaXRlMzIoMCwgdWFydC0+cHNfYmRmWzBdLCB1YXJ0LT5wc19iZGZbMV0sIHVhcnQtPnBz
X2JkZlsyXSwKLSAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9CQVNFX0FERFJFU1NfMCArIHVh
cnQtPmJhcl9pZHgqNCwgdWFydC0+YmFyKTsKKyAgICAgICBwY2lfY29uZl93cml0ZTMyKHNiZGYs
IFBDSV9CQVNFX0FERFJFU1NfMCArIHVhcnQtPmJhcl9pZHgqNCwgdWFydC0+YmFyKTsKIAogICAg
ICAgICAvKiBJZiA2NCBiaXQgQkFSLCB3cml0ZSBoaWdoZXIgMzIgYml0cyB0byBCQVIrNCAqLwog
ICAgICAgICBpZiAoIHVhcnQtPmJhciAmIFBDSV9CQVNFX0FERFJFU1NfTUVNX1RZUEVfNjQgKQot
ICAgICAgICAgICAgcGNpX2NvbmZfd3JpdGUzMigwLCB1YXJ0LT5wc19iZGZbMF0sCi0gICAgICAg
ICAgICAgICAgICAgICAgICB1YXJ0LT5wc19iZGZbMV0sIHVhcnQtPnBzX2JkZlsyXSwKLSAgICAg
ICAgICAgICAgICAgICAgICAgIFBDSV9CQVNFX0FERFJFU1NfMCArICh1YXJ0LT5iYXJfaWR4KzEp
KjQsIHVhcnQtPmJhcjY0KTsKKyAgICAgICAgICAgIHBjaV9jb25mX3dyaXRlMzIoc2JkZiwgUENJ
X0JBU0VfQUREUkVTU18wICsgKHVhcnQtPmJhcl9pZHgrMSkqNCwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgdWFydC0+YmFyNjQpOwogCi0gICAgICAgcGNpX2NvbmZfd3JpdGUxNigwLCB1
YXJ0LT5wc19iZGZbMF0sIHVhcnQtPnBzX2JkZlsxXSwgdWFydC0+cHNfYmRmWzJdLAotICAgICAg
ICAgICAgICAgICAgICAgICAgUENJX0NPTU1BTkQsIHVhcnQtPmNyKTsKKyAgICAgICBwY2lfY29u
Zl93cml0ZTE2KHNiZGYsIFBDSV9DT01NQU5ELCB1YXJ0LT5jcik7CiAgICAgfQogI2VuZGlmCiAK
QEAgLTEwNjMsMTEgKzEwNjksMTYgQEAgcGNpX3VhcnRfY29uZmlnKHN0cnVjdCBuczE2NTUwICp1
YXJ0LCBib29sX3Qgc2tpcF9hbXQsIHVuc2lnbmVkIGludCBpZHgpCiAgICAgICAgICAgICAgICAg
dWludDMyX3QgYmFyLCBiYXJfNjQgPSAwLCBsZW4sIGxlbl82NDsKICAgICAgICAgICAgICAgICB1
NjQgc2l6ZSA9IDA7CiAgICAgICAgICAgICAgICAgY29uc3Qgc3RydWN0IG5zMTY1NTBfY29uZmln
X3BhcmFtICpwYXJhbSA9IHVhcnRfcGFyYW07CisgICAgICAgICAgICAgICAgY29uc3QgcGNpX3Ni
ZGZfdCBzYmRmID0geworICAgICAgICAgICAgICAgICAgICAuYnVzID0gYiwKKyAgICAgICAgICAg
ICAgICAgICAgLmRldiA9IGQsCisgICAgICAgICAgICAgICAgICAgIC5mdW5jID0gZiwKKyAgICAg
ICAgICAgICAgICB9OwogCi0gICAgICAgICAgICAgICAgbmV4dGYgPSAoZiB8fCAocGNpX2NvbmZf
cmVhZDE2KDAsIGIsIGQsIGYsIFBDSV9IRUFERVJfVFlQRSkgJgorICAgICAgICAgICAgICAgIG5l
eHRmID0gKGYgfHwgKHBjaV9jb25mX3JlYWQxNihzYmRmLCBQQ0lfSEVBREVSX1RZUEUpICYKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAweDgwKSkgPyBmICsgMSA6IDg7CiAKLSAgICAg
ICAgICAgICAgICBzd2l0Y2ggKCBwY2lfY29uZl9yZWFkMTYoMCwgYiwgZCwgZiwgUENJX0NMQVNT
X0RFVklDRSkgKQorICAgICAgICAgICAgICAgIHN3aXRjaCAoIHBjaV9jb25mX3JlYWQxNihzYmRm
LCBQQ0lfQ0xBU1NfREVWSUNFKSApCiAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAg
IGNhc2UgMHgwNzAwOiAvKiBzaW5nbGUgcG9ydCBzZXJpYWwgKi8KICAgICAgICAgICAgICAgICBj
YXNlIDB4MDcwMjogLyogbXVsdGkgcG9ydCBzZXJpYWwgKi8KQEAgLTEwODQsOCArMTA5NSw4IEBA
IHBjaV91YXJ0X2NvbmZpZyhzdHJ1Y3QgbnMxNjU1MCAqdWFydCwgYm9vbF90IHNraXBfYW10LCB1
bnNpZ25lZCBpbnQgaWR4KQogICAgICAgICAgICAgICAgIC8qIENoZWNrIGZvciBwYXJhbXMgaW4g
dWFydF9jb25maWcgbG9va3VwIHRhYmxlICovCiAgICAgICAgICAgICAgICAgZm9yICggaSA9IDA7
IGkgPCBBUlJBWV9TSVpFKHVhcnRfY29uZmlnKTsgaSsrICkKICAgICAgICAgICAgICAgICB7Ci0g
ICAgICAgICAgICAgICAgICAgIHUxNiB2ZW5kb3IgPSBwY2lfY29uZl9yZWFkMTYoMCwgYiwgZCwg
ZiwgUENJX1ZFTkRPUl9JRCk7Ci0gICAgICAgICAgICAgICAgICAgIHUxNiBkZXZpY2UgPSBwY2lf
Y29uZl9yZWFkMTYoMCwgYiwgZCwgZiwgUENJX0RFVklDRV9JRCk7CisgICAgICAgICAgICAgICAg
ICAgIHVpbnQxNl90IHZlbmRvciA9IHBjaV9jb25mX3JlYWQxNihzYmRmLCBQQ0lfVkVORE9SX0lE
KTsKKyAgICAgICAgICAgICAgICAgICAgdWludDE2X3QgZGV2aWNlID0gcGNpX2NvbmZfcmVhZDE2
KHNiZGYsIFBDSV9ERVZJQ0VfSUQpOwogCiAgICAgICAgICAgICAgICAgICAgIGlmICggdWFydF9j
b25maWdbaV0udmVuZG9yX2lkID09IHZlbmRvciAmJgogICAgICAgICAgICAgICAgICAgICAgICAg
IHVhcnRfY29uZmlnW2ldLmRldl9pZCA9PSBkZXZpY2UgKQpAQCAtMTEwOCwyOCArMTExOSwyNSBA
QCBwY2lfdWFydF9jb25maWcoc3RydWN0IG5zMTY1NTAgKnVhcnQsIGJvb2xfdCBza2lwX2FtdCwg
dW5zaWduZWQgaW50IGlkeCkKICAgICAgICAgICAgICAgICB9CiAKICAgICAgICAgICAgICAgICB1
YXJ0LT5pb19iYXNlID0gMDsKLSAgICAgICAgICAgICAgICBiYXIgPSBwY2lfY29uZl9yZWFkMzIo
MCwgYiwgZCwgZiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX0JB
U0VfQUREUkVTU18wICsgYmFyX2lkeCo0KTsKKyAgICAgICAgICAgICAgICBiYXIgPSBwY2lfY29u
Zl9yZWFkMzIoc2JkZiwgUENJX0JBU0VfQUREUkVTU18wICsgYmFyX2lkeCo0KTsKIAogICAgICAg
ICAgICAgICAgIC8qIE1NSU8gYmFzZWQgKi8KICAgICAgICAgICAgICAgICBpZiAoIHBhcmFtLT5t
bWlvICYmICEoYmFyICYgUENJX0JBU0VfQUREUkVTU19TUEFDRV9JTykgKQogICAgICAgICAgICAg
ICAgIHsKLSAgICAgICAgICAgICAgICAgICAgcGNpX2NvbmZfd3JpdGUzMigwLCBiLCBkLCBmLAot
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9CQVNFX0FERFJFU1NfMCAr
IGJhcl9pZHgqNCwgfjB1KTsKLSAgICAgICAgICAgICAgICAgICAgbGVuID0gcGNpX2NvbmZfcmVh
ZDMyKDAsIGIsIGQsIGYsIFBDSV9CQVNFX0FERFJFU1NfMCArIGJhcl9pZHgqNCk7Ci0gICAgICAg
ICAgICAgICAgICAgIHBjaV9jb25mX3dyaXRlMzIoMCwgYiwgZCwgZiwKLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBQQ0lfQkFTRV9BRERSRVNTXzAgKyBiYXJfaWR4KjQsIGJh
cik7CisgICAgICAgICAgICAgICAgICAgIHBjaV9jb25mX3dyaXRlMzIoc2JkZiwgUENJX0JBU0Vf
QUREUkVTU18wICsgYmFyX2lkeCo0LCB+MHUpOworICAgICAgICAgICAgICAgICAgICBsZW4gPSBw
Y2lfY29uZl9yZWFkMzIoc2JkZiwgUENJX0JBU0VfQUREUkVTU18wICsgYmFyX2lkeCo0KTsKKyAg
ICAgICAgICAgICAgICAgICAgcGNpX2NvbmZfd3JpdGUzMihzYmRmLCBQQ0lfQkFTRV9BRERSRVNT
XzAgKyBiYXJfaWR4KjQsIGJhcik7CiAKICAgICAgICAgICAgICAgICAgICAgLyogSGFuZGxlIDY0
IGJpdCBCQVIgaWYgZm91bmQgKi8KICAgICAgICAgICAgICAgICAgICAgaWYgKCBiYXIgJiBQQ0lf
QkFTRV9BRERSRVNTX01FTV9UWVBFXzY0ICkKICAgICAgICAgICAgICAgICAgICAgewotICAgICAg
ICAgICAgICAgICAgICAgICAgYmFyXzY0ID0gcGNpX2NvbmZfcmVhZDMyKDAsIGIsIGQsIGYsCisg
ICAgICAgICAgICAgICAgICAgICAgICBiYXJfNjQgPSBwY2lfY29uZl9yZWFkMzIoc2JkZiwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX0JBU0VfQUREUkVTU18wICsg
KGJhcl9pZHgrMSkqNCk7Ci0gICAgICAgICAgICAgICAgICAgICAgICBwY2lfY29uZl93cml0ZTMy
KDAsIGIsIGQsIGYsCisgICAgICAgICAgICAgICAgICAgICAgICBwY2lfY29uZl93cml0ZTMyKHNi
ZGYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lfQkFTRV9BRERSRVNT
XzAgKyAoYmFyX2lkeCsxKSo0LCB+MHUpOwotICAgICAgICAgICAgICAgICAgICAgICAgbGVuXzY0
ID0gcGNpX2NvbmZfcmVhZDMyKDAsIGIsIGQsIGYsCisgICAgICAgICAgICAgICAgICAgICAgICBs
ZW5fNjQgPSBwY2lfY29uZl9yZWFkMzIoc2JkZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIFBDSV9CQVNFX0FERFJFU1NfMCArIChiYXJfaWR4KzEpKjQpOwotICAgICAgICAg
ICAgICAgICAgICAgICAgcGNpX2NvbmZfd3JpdGUzMigwLCBiLCBkLCBmLAorICAgICAgICAgICAg
ICAgICAgICAgICAgcGNpX2NvbmZfd3JpdGUzMihzYmRmLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgUENJX0JBU0VfQUREUkVTU18wICsgKGJhcl9pZHgrMSkqNCwgYmFyXzY0
KTsKICAgICAgICAgICAgICAgICAgICAgICAgIHNpemUgID0gKCh1NjQpfjAgPDwgMzIpIHwgUENJ
X0JBU0VfQUREUkVTU19NRU1fTUFTSzsKICAgICAgICAgICAgICAgICAgICAgICAgIHNpemUgJj0g
KCh1NjQpbGVuXzY0IDw8IDMyKSB8IGxlbjsKQEAgLTExNDMsMTEgKzExNTEsOSBAQCBwY2lfdWFy
dF9jb25maWcoc3RydWN0IG5zMTY1NTAgKnVhcnQsIGJvb2xfdCBza2lwX2FtdCwgdW5zaWduZWQg
aW50IGlkeCkKICAgICAgICAgICAgICAgICAvKiBJTyBiYXNlZCAqLwogICAgICAgICAgICAgICAg
IGVsc2UgaWYgKCAhcGFyYW0tPm1taW8gJiYgKGJhciAmIFBDSV9CQVNFX0FERFJFU1NfU1BBQ0Vf
SU8pICkKICAgICAgICAgICAgICAgICB7Ci0gICAgICAgICAgICAgICAgICAgIHBjaV9jb25mX3dy
aXRlMzIoMCwgYiwgZCwgZiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQ
Q0lfQkFTRV9BRERSRVNTXzAgKyBiYXJfaWR4KjQsIH4wdSk7Ci0gICAgICAgICAgICAgICAgICAg
IGxlbiA9IHBjaV9jb25mX3JlYWQzMigwLCBiLCBkLCBmLCBQQ0lfQkFTRV9BRERSRVNTXzApOwot
ICAgICAgICAgICAgICAgICAgICBwY2lfY29uZl93cml0ZTMyKDAsIGIsIGQsIGYsCi0gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX0JBU0VfQUREUkVTU18wICsgYmFyX2lk
eCo0LCBiYXIpOworICAgICAgICAgICAgICAgICAgICBwY2lfY29uZl93cml0ZTMyKHNiZGYsIFBD
SV9CQVNFX0FERFJFU1NfMCArIGJhcl9pZHgqNCwgfjB1KTsKKyAgICAgICAgICAgICAgICAgICAg
bGVuID0gcGNpX2NvbmZfcmVhZDMyKHNiZGYsIFBDSV9CQVNFX0FERFJFU1NfMCk7CisgICAgICAg
ICAgICAgICAgICAgIHBjaV9jb25mX3dyaXRlMzIoc2JkZiwgUENJX0JBU0VfQUREUkVTU18wICsg
YmFyX2lkeCo0LCBiYXIpOwogICAgICAgICAgICAgICAgICAgICBzaXplID0gbGVuICYgUENJX0JB
U0VfQUREUkVTU19JT19NQVNLOwogCiAgICAgICAgICAgICAgICAgICAgIHVhcnQtPmlvX2Jhc2Ug
PSBiYXIgJiB+UENJX0JBU0VfQUREUkVTU19TUEFDRV9JTzsKQEAgLTExODgsOCArMTE5NCw4IEBA
IHBjaV91YXJ0X2NvbmZpZyhzdHJ1Y3QgbnMxNjU1MCAqdWFydCwgYm9vbF90IHNraXBfYW10LCB1
bnNpZ25lZCBpbnQgaWR4KQogICAgICAgICAgICAgICAgIHVhcnQtPmJhcjY0ID0gYmFyXzY0Owog
ICAgICAgICAgICAgICAgIHVhcnQtPmlvX3NpemUgPSBtYXgoOFUgPDwgcGFyYW0tPnJlZ19zaGlm
dCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtLT51YXJ0X29mZnNl
dCk7Ci0gICAgICAgICAgICAgICAgdWFydC0+aXJxID0gcGNpX2NvbmZfcmVhZDgoMCwgYiwgZCwg
ZiwgUENJX0lOVEVSUlVQVF9QSU4pID8KLSAgICAgICAgICAgICAgICAgICAgcGNpX2NvbmZfcmVh
ZDgoMCwgYiwgZCwgZiwgUENJX0lOVEVSUlVQVF9MSU5FKSA6IDA7CisgICAgICAgICAgICAgICAg
dWFydC0+aXJxID0gcGNpX2NvbmZfcmVhZDgoc2JkZiwgUENJX0lOVEVSUlVQVF9QSU4pID8KKyAg
ICAgICAgICAgICAgICAgICAgcGNpX2NvbmZfcmVhZDgoc2JkZiwgUENJX0lOVEVSUlVQVF9MSU5F
KSA6IDA7CiAKICAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgIH0KZGlmZiAt
LWdpdCBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9pb21tdV9kZXRlY3QuYyBiL3hlbi9k
cml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9pb21tdV9kZXRlY3QuYwppbmRleCAzYzVkNGRlMWEzLi5l
OGQ4ZWM1OWJkIDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVf
ZGV0ZWN0LmMKKysrIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL2lvbW11X2RldGVjdC5j
CkBAIC00OCw3ICs0OCw4IEBAIHN0YXRpYyBpbnQgX19pbml0IGdldF9pb21tdV9jYXBhYmlsaXRp
ZXMoCiB7CiAgICAgdTggdHlwZTsKIAotICAgIGlvbW11LT5jYXAuaGVhZGVyID0gcGNpX2NvbmZf
cmVhZDMyKHNlZywgYnVzLCBkZXYsIGZ1bmMsIGNhcF9wdHIpOworICAgIGlvbW11LT5jYXAuaGVh
ZGVyID0gcGNpX2NvbmZfcmVhZDMyKFBDSV9TQkRGX1Qoc2VnLCBidXMsIGRldiwgZnVuYyksCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FwX3B0cik7CiAgICAgdHlw
ZSA9IGdldF9maWVsZF9mcm9tX3JlZ191MzIoaW9tbXUtPmNhcC5oZWFkZXIsIFBDSV9DQVBfVFlQ
RV9NQVNLLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9DQVBfVFlQRV9T
SElGVCk7CiAKZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9pb21tdV9p
bml0LmMgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfaW5pdC5jCmluZGV4IDE3
ZjM5NTUyYTkuLmZlMDUxNmY3ODggMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdo
L2FtZC9pb21tdV9pbml0LmMKKysrIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL2lvbW11
X2luaXQuYwpAQCAtNzk4LDggKzc5OCw3IEBAIHN0YXRpYyBib29sX3QgX19pbml0IHNldF9pb21t
dV9pbnRlcnJ1cHRfaGFuZGxlcihzdHJ1Y3QgYW1kX2lvbW11ICppb21tdSkKICAgICAgICAgICAg
ICAgICAgICAgICAgIFBDSV9TTE9UKGlvbW11LT5iZGYpLCBQQ0lfRlVOQyhpb21tdS0+YmRmKSk7
CiAgICAgICAgIHJldHVybiAwOwogICAgIH0KLSAgICBjb250cm9sID0gcGNpX2NvbmZfcmVhZDE2
KGlvbW11LT5zZWcsIFBDSV9CVVMoaW9tbXUtPmJkZiksCi0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBQQ0lfU0xPVChpb21tdS0+YmRmKSwgUENJX0ZVTkMoaW9tbXUtPmJkZiksCisgICAg
Y29udHJvbCA9IHBjaV9jb25mX3JlYWQxNihpb21tdS0+bXNpLmRldi0+c2JkZiwKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGlvbW11LT5tc2kubXNpX2F0dHJpYi5wb3MgKyBQQ0lfTVNJ
X0ZMQUdTKTsKICAgICBpb21tdS0+bXNpLm1zaS5udmVjID0gMTsKICAgICBpZiAoIGlzX21hc2tf
Yml0X3N1cHBvcnQoY29udHJvbCkgKQpAQCAtODM1LDYgKzgzNCwxMCBAQCBzdGF0aWMgYm9vbF90
IF9faW5pdCBzZXRfaW9tbXVfaW50ZXJydXB0X2hhbmRsZXIoc3RydWN0IGFtZF9pb21tdSAqaW9t
bXUpCiBzdGF0aWMgdm9pZCBhbWRfaW9tbXVfZXJyYXR1bV83NDZfd29ya2Fyb3VuZChzdHJ1Y3Qg
YW1kX2lvbW11ICppb21tdSkKIHsKICAgICB1MzIgdmFsdWU7CisgICAgY29uc3QgcGNpX3NiZGZf
dCBzYmRmID0geworICAgICAgICAuc2VnID0gaW9tbXUtPnNlZywKKyAgICAgICAgLmJkZiA9IGlv
bW11LT5iZGYsCisgICAgfTsKICAgICB1OCBidXMgPSBQQ0lfQlVTKGlvbW11LT5iZGYpOwogICAg
IHU4IGRldiA9IFBDSV9TTE9UKGlvbW11LT5iZGYpOwogICAgIHU4IGZ1bmMgPSBQQ0lfRlVOQyhp
b21tdS0+YmRmKTsKQEAgLTg0NCwyMiArODQ3LDIyIEBAIHN0YXRpYyB2b2lkIGFtZF9pb21tdV9l
cnJhdHVtXzc0Nl93b3JrYXJvdW5kKHN0cnVjdCBhbWRfaW9tbXUgKmlvbW11KQogICAgICAgICAg
KGJvb3RfY3B1X2RhdGEueDg2X21vZGVsID4gMHgxZikgKQogICAgICAgICByZXR1cm47CiAKLSAg
ICBwY2lfY29uZl93cml0ZTMyKGlvbW11LT5zZWcsIGJ1cywgZGV2LCBmdW5jLCAweGYwLCAweDkw
KTsKLSAgICB2YWx1ZSA9IHBjaV9jb25mX3JlYWQzMihpb21tdS0+c2VnLCBidXMsIGRldiwgZnVu
YywgMHhmNCk7CisgICAgcGNpX2NvbmZfd3JpdGUzMihzYmRmLCAweGYwLCAweDkwKTsKKyAgICB2
YWx1ZSA9IHBjaV9jb25mX3JlYWQzMihzYmRmLCAweGY0KTsKIAogICAgIGlmICggdmFsdWUgJiAo
MSA8PCAyKSApCiAgICAgICAgIHJldHVybjsKIAogICAgIC8qIFNlbGVjdCBOQiBpbmRpcmVjdCBy
ZWdpc3RlciAweDkwIGFuZCBlbmFibGUgd3JpdGluZyAqLwotICAgIHBjaV9jb25mX3dyaXRlMzIo
aW9tbXUtPnNlZywgYnVzLCBkZXYsIGZ1bmMsIDB4ZjAsIDB4OTAgfCAoMSA8PCA4KSk7CisgICAg
cGNpX2NvbmZfd3JpdGUzMihzYmRmLCAweGYwLCAweDkwIHwgKDEgPDwgOCkpOwogCi0gICAgcGNp
X2NvbmZfd3JpdGUzMihpb21tdS0+c2VnLCBidXMsIGRldiwgZnVuYywgMHhmNCwgdmFsdWUgfCAo
MSA8PCAyKSk7CisgICAgcGNpX2NvbmZfd3JpdGUzMihzYmRmLCAweGY0LCB2YWx1ZSB8ICgxIDw8
IDIpKTsKICAgICBwcmludGsoWEVOTE9HX0lORk8KICAgICAgICAgICAgIkFNRC1WaTogQXBwbHlp
bmcgZXJyYXR1bSA3NDYgd29ya2Fyb3VuZCBmb3IgSU9NTVUgYXQgJTA0eDolMDJ4OiUwMnguJXVc
biIsCiAgICAgICAgICAgIGlvbW11LT5zZWcsIGJ1cywgZGV2LCBmdW5jKTsKIAogICAgIC8qIENs
ZWFyIHRoZSBlbmFibGUgd3JpdGluZyBiaXQgKi8KLSAgICBwY2lfY29uZl93cml0ZTMyKGlvbW11
LT5zZWcsIGJ1cywgZGV2LCBmdW5jLCAweGYwLCAweDkwKTsKKyAgICBwY2lfY29uZl93cml0ZTMy
KHNiZGYsIDB4ZjAsIDB4OTApOwogfQogCiBzdGF0aWMgdm9pZCBlbmFibGVfaW9tbXUoc3RydWN0
IGFtZF9pb21tdSAqaW9tbXUpCkBAIC0xMjAzLDcgKzEyMDYsMTIgQEAgc3RhdGljIGJvb2xfdCBf
X2luaXQgYW1kX3NwNTEwMF9lcnJhdHVtMjgodm9pZCkKIAogICAgIGZvciAoYnVzID0gMDsgYnVz
IDwgMjU2OyBidXMrKykKICAgICB7Ci0gICAgICAgIGlkID0gcGNpX2NvbmZfcmVhZDMyKDAsIGJ1
cywgMHgxNCwgMCwgUENJX1ZFTkRPUl9JRCk7CisgICAgICAgIGNvbnN0IHBjaV9zYmRmX3Qgc2Jk
ZiA9IHsKKyAgICAgICAgICAgIC5idXMgPSBidXMsCisgICAgICAgICAgICAuZGV2ID0gMHgxNCwK
KyAgICAgICAgfTsKKworICAgICAgICBpZCA9IHBjaV9jb25mX3JlYWQzMihzYmRmLCBQQ0lfVkVO
RE9SX0lEKTsKIAogICAgICAgICB2ZW5kb3JfaWQgPSBpZCAmIDB4ZmZmZjsKICAgICAgICAgZGV2
X2lkID0gKGlkID4+IDE2KSAmIDB4ZmZmZjsKQEAgLTEyMTIsNyArMTIyMCw3IEBAIHN0YXRpYyBi
b29sX3QgX19pbml0IGFtZF9zcDUxMDBfZXJyYXR1bTI4KHZvaWQpCiAgICAgICAgIGlmICh2ZW5k
b3JfaWQgIT0gMHgxMDAyIHx8IGRldl9pZCAhPSAweDQzODUpCiAgICAgICAgICAgICBjb250aW51
ZTsKIAotICAgICAgICBieXRlID0gcGNpX2NvbmZfcmVhZDgoMCwgYnVzLCAweDE0LCAwLCAweGFk
KTsKKyAgICAgICAgYnl0ZSA9IHBjaV9jb25mX3JlYWQ4KHNiZGYsIDB4YWQpOwogICAgICAgICBp
ZiAoIChieXRlID4+IDMpICYgMSApCiAgICAgICAgIHsKICAgICAgICAgICAgIHByaW50ayhYRU5M
T0dfV0FSTklORyAiQU1ELVZpOiBTUDUxMDAgZXJyYXR1bSAyOCBkZXRlY3RlZCwgZGlzYWJsaW5n
IElPTU1VLlxuIgpkaWZmIC0tZ2l0IGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYXRzLmggYi94
ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hdHMuaAppbmRleCBiZWUxMzkxMWMwLi5lODNhNDVkMTZl
IDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hdHMuaAorKysgYi94ZW4vZHJp
dmVycy9wYXNzdGhyb3VnaC9hdHMuaApAQCAtMzUsOCArMzUsOCBAQCBzdGF0aWMgaW5saW5lIGlu
dCBwY2lfYXRzX2VuYWJsZWQoaW50IHNlZywgaW50IGJ1cywgaW50IGRldmZuKQogICAgIHBvcyA9
IHBjaV9maW5kX2V4dF9jYXBhYmlsaXR5KHNlZywgYnVzLCBkZXZmbiwgUENJX0VYVF9DQVBfSURf
QVRTKTsKICAgICBCVUdfT04oIXBvcyk7CiAKLSAgICB2YWx1ZSA9IHBjaV9jb25mX3JlYWQxNihz
ZWcsIGJ1cywgUENJX1NMT1QoZGV2Zm4pLCBQQ0lfRlVOQyhkZXZmbiksCi0gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgcG9zICsgQVRTX1JFR19DVEwpOworICAgIHZhbHVlID0gcGNpX2NvbmZf
cmVhZDE2KFBDSV9TQkRGM19UKHNlZywgYnVzLCBkZXZmbiksIHBvcyArIEFUU19SRUdfQ1RMKTsK
KwogICAgIHJldHVybiB2YWx1ZSAmIEFUU19FTkFCTEU7CiB9CiAKZGlmZiAtLWdpdCBhL3hlbi9k
cml2ZXJzL3Bhc3N0aHJvdWdoL3BjaS5jIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvcGNpLmMK
aW5kZXggOGRlOGQ4ZTExMC4uOTRmYjNhMTgzZCAxMDA2NDQKLS0tIGEveGVuL2RyaXZlcnMvcGFz
c3Rocm91Z2gvcGNpLmMKKysrIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvcGNpLmMKQEAgLTI0
NiwzNiArMjQ2LDM0IEBAIHN0YXRpYyB2b2lkIGNoZWNrX3BkZXYoY29uc3Qgc3RydWN0IHBjaV9k
ZXYgKnBkZXYpCiAKICAgICBpZiAoIGNvbW1hbmRfbWFzayApCiAgICAgewotICAgICAgICB2YWwg
PSBwY2lfY29uZl9yZWFkMTYoc2VnLCBidXMsIGRldiwgZnVuYywgUENJX0NPTU1BTkQpOworICAg
ICAgICB2YWwgPSBwY2lfY29uZl9yZWFkMTYocGRldi0+c2JkZiwgUENJX0NPTU1BTkQpOwogICAg
ICAgICBpZiAoIHZhbCAmIGNvbW1hbmRfbWFzayApCi0gICAgICAgICAgICBwY2lfY29uZl93cml0
ZTE2KHNlZywgYnVzLCBkZXYsIGZ1bmMsIFBDSV9DT01NQU5ELAotICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICB2YWwgJiB+Y29tbWFuZF9tYXNrKTsKLSAgICAgICAgdmFsID0gcGNpX2NvbmZf
cmVhZDE2KHNlZywgYnVzLCBkZXYsIGZ1bmMsIFBDSV9TVEFUVVMpOworICAgICAgICAgICAgcGNp
X2NvbmZfd3JpdGUxNihwZGV2LT5zYmRmLCBQQ0lfQ09NTUFORCwgdmFsICYgfmNvbW1hbmRfbWFz
ayk7CisgICAgICAgIHZhbCA9IHBjaV9jb25mX3JlYWQxNihwZGV2LT5zYmRmLCBQQ0lfU1RBVFVT
KTsKICAgICAgICAgaWYgKCB2YWwgJiBQQ0lfU1RBVFVTX0NIRUNLICkKICAgICAgICAgewogICAg
ICAgICAgICAgcHJpbnRrKFhFTkxPR19JTkZPICIlMDR4OiUwMng6JTAyeC4ldSBzdGF0dXMgJTA0
eCAtPiAlMDR4XG4iLAogICAgICAgICAgICAgICAgICAgIHNlZywgYnVzLCBkZXYsIGZ1bmMsIHZh
bCwgdmFsICYgflBDSV9TVEFUVVNfQ0hFQ0spOwotICAgICAgICAgICAgcGNpX2NvbmZfd3JpdGUx
NihzZWcsIGJ1cywgZGV2LCBmdW5jLCBQQ0lfU1RBVFVTLAotICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICB2YWwgJiBQQ0lfU1RBVFVTX0NIRUNLKTsKKyAgICAgICAgICAgIHBjaV9jb25mX3dy
aXRlMTYocGRldi0+c2JkZiwgUENJX1NUQVRVUywgdmFsICYgUENJX1NUQVRVU19DSEVDSyk7CiAg
ICAgICAgIH0KICAgICB9CiAKLSAgICBzd2l0Y2ggKCBwY2lfY29uZl9yZWFkOChzZWcsIGJ1cywg
ZGV2LCBmdW5jLCBQQ0lfSEVBREVSX1RZUEUpICYgMHg3ZiApCisgICAgc3dpdGNoICggcGNpX2Nv
bmZfcmVhZDgocGRldi0+c2JkZiwgUENJX0hFQURFUl9UWVBFKSAmIDB4N2YgKQogICAgIHsKICAg
ICBjYXNlIFBDSV9IRUFERVJfVFlQRV9CUklER0U6CiAgICAgICAgIGlmICggIWJyaWRnZV9jdGxf
bWFzayApCiAgICAgICAgICAgICBicmVhazsKLSAgICAgICAgdmFsID0gcGNpX2NvbmZfcmVhZDE2
KHNlZywgYnVzLCBkZXYsIGZ1bmMsIFBDSV9CUklER0VfQ09OVFJPTCk7CisgICAgICAgIHZhbCA9
IHBjaV9jb25mX3JlYWQxNihwZGV2LT5zYmRmLCBQQ0lfQlJJREdFX0NPTlRST0wpOwogICAgICAg
ICBpZiAoIHZhbCAmIGJyaWRnZV9jdGxfbWFzayApCi0gICAgICAgICAgICBwY2lfY29uZl93cml0
ZTE2KHNlZywgYnVzLCBkZXYsIGZ1bmMsIFBDSV9CUklER0VfQ09OVFJPTCwKKyAgICAgICAgICAg
IHBjaV9jb25mX3dyaXRlMTYocGRldi0+c2JkZiwgUENJX0JSSURHRV9DT05UUk9MLAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICB2YWwgJiB+YnJpZGdlX2N0bF9tYXNrKTsKLSAgICAgICAg
dmFsID0gcGNpX2NvbmZfcmVhZDE2KHNlZywgYnVzLCBkZXYsIGZ1bmMsIFBDSV9TRUNfU1RBVFVT
KTsKKyAgICAgICAgdmFsID0gcGNpX2NvbmZfcmVhZDE2KHBkZXYtPnNiZGYsIFBDSV9TRUNfU1RB
VFVTKTsKICAgICAgICAgaWYgKCB2YWwgJiBQQ0lfU1RBVFVTX0NIRUNLICkKICAgICAgICAgewog
ICAgICAgICAgICAgcHJpbnRrKFhFTkxPR19JTkZPCiAgICAgICAgICAgICAgICAgICAgIiUwNHg6
JTAyeDolMDJ4LiV1IHNlY29uZGFyeSBzdGF0dXMgJTA0eCAtPiAlMDR4XG4iLAogICAgICAgICAg
ICAgICAgICAgIHNlZywgYnVzLCBkZXYsIGZ1bmMsIHZhbCwgdmFsICYgflBDSV9TVEFUVVNfQ0hF
Q0spOwotICAgICAgICAgICAgcGNpX2NvbmZfd3JpdGUxNihzZWcsIGJ1cywgZGV2LCBmdW5jLCBQ
Q0lfU0VDX1NUQVRVUywKKyAgICAgICAgICAgIHBjaV9jb25mX3dyaXRlMTYocGRldi0+c2JkZiwg
UENJX1NFQ19TVEFUVVMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbCAmIFBDSV9T
VEFUVVNfQ0hFQ0spOwogICAgICAgICB9CiAgICAgICAgIGJyZWFrOwpAQCAtMjg5LDEyICsyODcs
OCBAQCBzdGF0aWMgdm9pZCBjaGVja19wZGV2KGNvbnN0IHN0cnVjdCBwY2lfZGV2ICpwZGV2KQog
CiBzdGF0aWMgdm9pZCBhcHBseV9xdWlya3Moc3RydWN0IHBjaV9kZXYgKnBkZXYpCiB7Ci0gICAg
dWludDE2X3QgdmVuZG9yID0gcGNpX2NvbmZfcmVhZDE2KHBkZXYtPnNiZGYuc2VnLCBwZGV2LT5z
YmRmLmJ1cywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGRldi0+c2Jk
Zi5kZXYsIHBkZXYtPnNiZGYuZnVuYywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgUENJX1ZFTkRPUl9JRCk7Ci0gICAgdWludDE2X3QgZGV2aWNlID0gcGNpX2NvbmZfcmVh
ZDE2KHBkZXYtPnNiZGYuc2VnLCBwZGV2LT5zYmRmLmJ1cywKLSAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgcGRldi0+c2JkZi5kZXYsIHBkZXYtPnNiZGYuZnVuYywKLSAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX0RFVklDRV9JRCk7CisgICAgdWlu
dDE2X3QgdmVuZG9yID0gcGNpX2NvbmZfcmVhZDE2KHBkZXYtPnNiZGYsIFBDSV9WRU5ET1JfSUQp
OworICAgIHVpbnQxNl90IGRldmljZSA9IHBjaV9jb25mX3JlYWQxNihwZGV2LT5zYmRmLCBQQ0lf
REVWSUNFX0lEKTsKICAgICBzdGF0aWMgY29uc3Qgc3RydWN0IHsKICAgICAgICAgdWludDE2X3Qg
dmVuZG9yLCBkZXZpY2U7CiAgICAgfSBpZ25vcmVfYmFyc1tdID0gewpAQCAtMzY4LDEwICszNjIs
OCBAQCBzdGF0aWMgc3RydWN0IHBjaV9kZXYgKmFsbG9jX3BkZXYoc3RydWN0IHBjaV9zZWcgKnBz
ZWcsIHU4IGJ1cywgdTggZGV2Zm4pCiAKICAgICAgICAgY2FzZSBERVZfVFlQRV9QQ0llMlBDSV9C
UklER0U6CiAgICAgICAgIGNhc2UgREVWX1RZUEVfTEVHQUNZX1BDSV9CUklER0U6Ci0gICAgICAg
ICAgICBzZWNfYnVzID0gcGNpX2NvbmZfcmVhZDgocHNlZy0+bnIsIGJ1cywgUENJX1NMT1QoZGV2
Zm4pLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9GVU5DKGRldmZu
KSwgUENJX1NFQ09OREFSWV9CVVMpOwotICAgICAgICAgICAgc3ViX2J1cyA9IHBjaV9jb25mX3Jl
YWQ4KHBzZWctPm5yLCBidXMsIFBDSV9TTE9UKGRldmZuKSwKLSAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBQQ0lfRlVOQyhkZXZmbiksIFBDSV9TVUJPUkRJTkFURV9CVVMpOwor
ICAgICAgICAgICAgc2VjX2J1cyA9IHBjaV9jb25mX3JlYWQ4KHBkZXYtPnNiZGYsIFBDSV9TRUNP
TkRBUllfQlVTKTsKKyAgICAgICAgICAgIHN1Yl9idXMgPSBwY2lfY29uZl9yZWFkOChwZGV2LT5z
YmRmLCBQQ0lfU1VCT1JESU5BVEVfQlVTKTsKIAogICAgICAgICAgICAgc3Bpbl9sb2NrKCZwc2Vn
LT5idXMyYnJpZGdlX2xvY2spOwogICAgICAgICAgICAgZm9yICggOyBzZWNfYnVzIDw9IHN1Yl9i
dXM7IHNlY19idXMrKyApCkBAIC0zODcsOCArMzc5LDcgQEAgc3RhdGljIHN0cnVjdCBwY2lfZGV2
ICphbGxvY19wZGV2KHN0cnVjdCBwY2lfc2VnICpwc2VnLCB1OCBidXMsIHU4IGRldmZuKQogICAg
ICAgICAgICAgcG9zID0gcGNpX2ZpbmRfY2FwX29mZnNldChwc2VnLT5uciwgYnVzLCBQQ0lfU0xP
VChkZXZmbiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9GVU5D
KGRldmZuKSwgUENJX0NBUF9JRF9FWFApOwogICAgICAgICAgICAgQlVHX09OKCFwb3MpOwotICAg
ICAgICAgICAgY2FwID0gcGNpX2NvbmZfcmVhZDE2KHBzZWctPm5yLCBidXMsIFBDSV9TTE9UKGRl
dmZuKSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lfRlVOQyhkZXZmbiks
IHBvcyArIFBDSV9FWFBfREVWQ0FQKTsKKyAgICAgICAgICAgIGNhcCA9IHBjaV9jb25mX3JlYWQx
NihwZGV2LT5zYmRmLCBwb3MgKyBQQ0lfRVhQX0RFVkNBUCk7CiAgICAgICAgICAgICBpZiAoIGNh
cCAmIFBDSV9FWFBfREVWQ0FQX1BIQU5UT00gKQogICAgICAgICAgICAgewogICAgICAgICAgICAg
ICAgIHBkZXYtPnBoYW50b21fc3RyaWRlID0gOCA+PiBNQVNLX0VYVFIoY2FwLApAQCAtNDM4LDEw
ICs0MjksOCBAQCBzdGF0aWMgdm9pZCBmcmVlX3BkZXYoc3RydWN0IHBjaV9zZWcgKnBzZWcsIHN0
cnVjdCBwY2lfZGV2ICpwZGV2KQogCiAgICAgICAgIGNhc2UgREVWX1RZUEVfUENJZTJQQ0lfQlJJ
REdFOgogICAgICAgICBjYXNlIERFVl9UWVBFX0xFR0FDWV9QQ0lfQlJJREdFOgotICAgICAgICAg
ICAgc2VjX2J1cyA9IHBjaV9jb25mX3JlYWQ4KHBzZWctPm5yLCBwZGV2LT5zYmRmLmJ1cywgcGRl
di0+c2JkZi5kZXYsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGRldi0+
c2JkZi5mdW5jLCBQQ0lfU0VDT05EQVJZX0JVUyk7Ci0gICAgICAgICAgICBzdWJfYnVzID0gcGNp
X2NvbmZfcmVhZDgocHNlZy0+bnIsIHBkZXYtPnNiZGYuYnVzLCBwZGV2LT5zYmRmLmRldiwKLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZGV2LT5zYmRmLmZ1bmMsIFBDSV9T
VUJPUkRJTkFURV9CVVMpOworICAgICAgICAgICAgc2VjX2J1cyA9IHBjaV9jb25mX3JlYWQ4KHBk
ZXYtPnNiZGYsIFBDSV9TRUNPTkRBUllfQlVTKTsKKyAgICAgICAgICAgIHN1Yl9idXMgPSBwY2lf
Y29uZl9yZWFkOChwZGV2LT5zYmRmLCBQQ0lfU1VCT1JESU5BVEVfQlVTKTsKIAogICAgICAgICAg
ICAgc3Bpbl9sb2NrKCZwc2VnLT5idXMyYnJpZGdlX2xvY2spOwogICAgICAgICAgICAgZm9yICgg
OyBzZWNfYnVzIDw9IHN1Yl9idXM7IHNlY19idXMrKyApCkBAIC02MDMsOCArNTkyLDYgQEAgc3Rh
dGljIHZvaWQgcGNpX2VuYWJsZV9hY3Moc3RydWN0IHBjaV9kZXYgKnBkZXYpCiAgICAgaW50IHBv
czsKICAgICB1aW50MTZfdCBjYXAsIGN0cmwsIHNlZyA9IHBkZXYtPnNiZGYuc2VnOwogICAgIHVp
bnQ4X3QgYnVzID0gcGRldi0+c2JkZi5idXM7Ci0gICAgdWludDhfdCBkZXYgPSBwZGV2LT5zYmRm
LmRldjsKLSAgICB1aW50OF90IGZ1bmMgPSBwZGV2LT5zYmRmLmZ1bmM7CiAKICAgICBpZiAoICFp
b21tdV9lbmFibGVkICkKICAgICAgICAgcmV0dXJuOwpAQCAtNjEzLDggKzYwMCw4IEBAIHN0YXRp
YyB2b2lkIHBjaV9lbmFibGVfYWNzKHN0cnVjdCBwY2lfZGV2ICpwZGV2KQogICAgIGlmICghcG9z
KQogICAgICAgICByZXR1cm47CiAKLSAgICBjYXAgPSBwY2lfY29uZl9yZWFkMTYoc2VnLCBidXMs
IGRldiwgZnVuYywgcG9zICsgUENJX0FDU19DQVApOwotICAgIGN0cmwgPSBwY2lfY29uZl9yZWFk
MTYoc2VnLCBidXMsIGRldiwgZnVuYywgcG9zICsgUENJX0FDU19DVFJMKTsKKyAgICBjYXAgPSBw
Y2lfY29uZl9yZWFkMTYocGRldi0+c2JkZiwgcG9zICsgUENJX0FDU19DQVApOworICAgIGN0cmwg
PSBwY2lfY29uZl9yZWFkMTYocGRldi0+c2JkZiwgcG9zICsgUENJX0FDU19DVFJMKTsKIAogICAg
IC8qIFNvdXJjZSBWYWxpZGF0aW9uICovCiAgICAgY3RybCB8PSAoY2FwICYgUENJX0FDU19TVik7
CkBAIC02MjgsNyArNjE1LDcgQEAgc3RhdGljIHZvaWQgcGNpX2VuYWJsZV9hY3Moc3RydWN0IHBj
aV9kZXYgKnBkZXYpCiAgICAgLyogVXBzdHJlYW0gRm9yd2FyZGluZyAqLwogICAgIGN0cmwgfD0g
KGNhcCAmIFBDSV9BQ1NfVUYpOwogCi0gICAgcGNpX2NvbmZfd3JpdGUxNihzZWcsIGJ1cywgZGV2
LCBmdW5jLCBwb3MgKyBQQ0lfQUNTX0NUUkwsIGN0cmwpOworICAgIHBjaV9jb25mX3dyaXRlMTYo
cGRldi0+c2JkZiwgcG9zICsgUENJX0FDU19DVFJMLCBjdHJsKTsKIH0KIAogc3RhdGljIGludCBp
b21tdV9hZGRfZGV2aWNlKHN0cnVjdCBwY2lfZGV2ICpwZGV2KTsKQEAgLTYzOSw4ICs2MjYsNyBA
QCB1bnNpZ25lZCBpbnQgcGNpX3NpemVfbWVtX2JhcihwY2lfc2JkZl90IHNiZGYsIHVuc2lnbmVk
IGludCBwb3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50NjRfdCAqcGFkZHIs
IHVpbnQ2NF90ICpwc2l6ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVk
IGludCBmbGFncykKIHsKLSAgICB1aW50MzJfdCBoaSA9IDAsIGJhciA9IHBjaV9jb25mX3JlYWQz
MihzYmRmLnNlZywgc2JkZi5idXMsIHNiZGYuZGV2LAotICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHNiZGYuZnVuYywgcG9zKTsKKyAgICB1aW50MzJfdCBoaSA9IDAs
IGJhciA9IHBjaV9jb25mX3JlYWQzMihzYmRmLCBwb3MpOwogICAgIHVpbnQ2NF90IHNpemU7CiAg
ICAgYm9vbCBpczY0Yml0cyA9ICEoZmxhZ3MgJiBQQ0lfQkFSX1JPTSkgJiYKICAgICAgICAgKGJh
ciAmIFBDSV9CQVNFX0FERFJFU1NfTUVNX1RZUEVfTUFTSykgPT0gUENJX0JBU0VfQUREUkVTU19N
RU1fVFlQRV82NDsKQEAgLTY1MCw3ICs2MzYsNyBAQCB1bnNpZ25lZCBpbnQgcGNpX3NpemVfbWVt
X2JhcihwY2lfc2JkZl90IHNiZGYsIHVuc2lnbmVkIGludCBwb3MsCiAgICAgQVNTRVJUKCEoKGZs
YWdzICYgUENJX0JBUl9WRikgJiYgKGZsYWdzICYgUENJX0JBUl9ST00pKSk7CiAgICAgQVNTRVJU
KChmbGFncyAmIFBDSV9CQVJfUk9NKSB8fAogICAgICAgICAgICAoYmFyICYgUENJX0JBU0VfQURE
UkVTU19TUEFDRSkgPT0gUENJX0JBU0VfQUREUkVTU19TUEFDRV9NRU1PUlkpOwotICAgIHBjaV9j
b25mX3dyaXRlMzIoc2JkZi5zZWcsIHNiZGYuYnVzLCBzYmRmLmRldiwgc2JkZi5mdW5jLCBwb3Ms
IH4wKTsKKyAgICBwY2lfY29uZl93cml0ZTMyKHNiZGYsIHBvcywgfjApOwogICAgIGlmICggaXM2
NGJpdHMgKQogICAgIHsKICAgICAgICAgaWYgKCBmbGFncyAmIFBDSV9CQVJfTEFTVCApCkBAIC02
NjIsMjAgKzY0OCwxOCBAQCB1bnNpZ25lZCBpbnQgcGNpX3NpemVfbWVtX2JhcihwY2lfc2JkZl90
IHNiZGYsIHVuc2lnbmVkIGludCBwb3MsCiAgICAgICAgICAgICAqcHNpemUgPSAwOwogICAgICAg
ICAgICAgcmV0dXJuIDE7CiAgICAgICAgIH0KLSAgICAgICAgaGkgPSBwY2lfY29uZl9yZWFkMzIo
c2JkZi5zZWcsIHNiZGYuYnVzLCBzYmRmLmRldiwgc2JkZi5mdW5jLCBwb3MgKyA0KTsKLSAgICAg
ICAgcGNpX2NvbmZfd3JpdGUzMihzYmRmLnNlZywgc2JkZi5idXMsIHNiZGYuZGV2LCBzYmRmLmZ1
bmMsIHBvcyArIDQsIH4wKTsKKyAgICAgICAgaGkgPSBwY2lfY29uZl9yZWFkMzIoc2JkZiwgcG9z
ICsgNCk7CisgICAgICAgIHBjaV9jb25mX3dyaXRlMzIoc2JkZiwgcG9zICsgNCwgfjApOwogICAg
IH0KLSAgICBzaXplID0gcGNpX2NvbmZfcmVhZDMyKHNiZGYuc2VnLCBzYmRmLmJ1cywgc2JkZi5k
ZXYsIHNiZGYuZnVuYywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvcykgJiBtYXNrOwor
ICAgIHNpemUgPSBwY2lfY29uZl9yZWFkMzIoc2JkZiwgcG9zKSAmIG1hc2s7CiAgICAgaWYgKCBp
czY0Yml0cyApCiAgICAgewotICAgICAgICBzaXplIHw9ICh1aW50NjRfdClwY2lfY29uZl9yZWFk
MzIoc2JkZi5zZWcsIHNiZGYuYnVzLCBzYmRmLmRldiwKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHNiZGYuZnVuYywgcG9zICsgNCkgPDwgMzI7Ci0gICAgICAgIHBj
aV9jb25mX3dyaXRlMzIoc2JkZi5zZWcsIHNiZGYuYnVzLCBzYmRmLmRldiwgc2JkZi5mdW5jLCBw
b3MgKyA0LCBoaSk7CisgICAgICAgIHNpemUgfD0gKHVpbnQ2NF90KXBjaV9jb25mX3JlYWQzMihz
YmRmLCBwb3MgKyA0KSA8PCAzMjsKKyAgICAgICAgcGNpX2NvbmZfd3JpdGUzMihzYmRmLCBwb3Mg
KyA0LCBoaSk7CiAgICAgfQogICAgIGVsc2UgaWYgKCBzaXplICkKICAgICAgICAgc2l6ZSB8PSAo
dWludDY0X3QpfjAgPDwgMzI7Ci0gICAgcGNpX2NvbmZfd3JpdGUzMihzYmRmLnNlZywgc2JkZi5i
dXMsIHNiZGYuZGV2LCBzYmRmLmZ1bmMsIHBvcywgYmFyKTsKKyAgICBwY2lfY29uZl93cml0ZTMy
KHNiZGYsIHBvcywgYmFyKTsKICAgICBzaXplID0gLXNpemU7CiAKICAgICBpZiAoIHBhZGRyICkK
QEAgLTc0NSw3ICs3MjksNyBAQCBpbnQgcGNpX2FkZF9kZXZpY2UodTE2IHNlZywgdTggYnVzLCB1
OCBkZXZmbiwKICAgICB7CiAgICAgICAgIHVuc2lnbmVkIGludCBwb3MgPSBwY2lfZmluZF9leHRf
Y2FwYWJpbGl0eShzZWcsIGJ1cywgZGV2Zm4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBQQ0lfRVhUX0NBUF9JRF9TUklPVik7Ci0gICAgICAgIHUx
NiBjdHJsID0gcGNpX2NvbmZfcmVhZDE2KHNlZywgYnVzLCBzbG90LCBmdW5jLCBwb3MgKyBQQ0lf
U1JJT1ZfQ1RSTCk7CisgICAgICAgIHUxNiBjdHJsID0gcGNpX2NvbmZfcmVhZDE2KHBkZXYtPnNi
ZGYsIHBvcyArIFBDSV9TUklPVl9DVFJMKTsKIAogICAgICAgICBpZiAoICFwb3MgKQogICAgICAg
ICAgICAgLyogTm90aGluZyAqLzsKQEAgLTc1NywxMCArNzQxLDcgQEAgaW50IHBjaV9hZGRfZGV2
aWNlKHUxNiBzZWcsIHU4IGJ1cywgdTggZGV2Zm4sCiAgICAgICAgICAgICBmb3IgKCBpID0gMDsg
aSA8IFBDSV9TUklPVl9OVU1fQkFSUzsgKQogICAgICAgICAgICAgewogICAgICAgICAgICAgICAg
IHVuc2lnbmVkIGludCBpZHggPSBwb3MgKyBQQ0lfU1JJT1ZfQkFSICsgaSAqIDQ7Ci0gICAgICAg
ICAgICAgICAgdTMyIGJhciA9IHBjaV9jb25mX3JlYWQzMihzZWcsIGJ1cywgc2xvdCwgZnVuYywg
aWR4KTsKLSAgICAgICAgICAgICAgICBwY2lfc2JkZl90IHNiZGYgPSB7Ci0gICAgICAgICAgICAg
ICAgICAgIC5zYmRmID0gUENJX1NCREYzKHNlZywgYnVzLCBkZXZmbiksCi0gICAgICAgICAgICAg
ICAgfTsKKyAgICAgICAgICAgICAgICB1aW50MzJfdCBiYXIgPSBwY2lfY29uZl9yZWFkMzIocGRl
di0+c2JkZiwgaWR4KTsKIAogICAgICAgICAgICAgICAgIGlmICggKGJhciAmIFBDSV9CQVNFX0FE
RFJFU1NfU1BBQ0UpID09CiAgICAgICAgICAgICAgICAgICAgICBQQ0lfQkFTRV9BRERSRVNTX1NQ
QUNFX0lPICkKQEAgLTc3MSw3ICs3NTIsNyBAQCBpbnQgcGNpX2FkZF9kZXZpY2UodTE2IHNlZywg
dTggYnVzLCB1OCBkZXZmbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlZywgYnVzLCBz
bG90LCBmdW5jLCBpKTsKICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAg
ICAgICAgfQotICAgICAgICAgICAgICAgIHJldCA9IHBjaV9zaXplX21lbV9iYXIoc2JkZiwgaWR4
LCBOVUxMLCAmcGRldi0+dmZfcmxlbltpXSwKKyAgICAgICAgICAgICAgICByZXQgPSBwY2lfc2l6
ZV9tZW1fYmFyKHBkZXYtPnNiZGYsIGlkeCwgTlVMTCwgJnBkZXYtPnZmX3JsZW5baV0sCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lfQkFSX1ZGIHwKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgoaSA9PSBQQ0lfU1JJT1ZfTlVNX0JBUlMg
LSAxKSA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX0JBUl9M
QVNUIDogMCkpOwpAQCAtOTQwLDE0ICs5MjEsMjAgQEAgZW51bSBwZGV2X3R5cGUgcGRldl90eXBl
KHUxNiBzZWcsIHU4IGJ1cywgdTggZGV2Zm4pCiAgICAgdTE2IGNsYXNzX2RldmljZSwgY3JlZzsK
ICAgICB1OCBkID0gUENJX1NMT1QoZGV2Zm4pLCBmID0gUENJX0ZVTkMoZGV2Zm4pOwogICAgIGlu
dCBwb3MgPSBwY2lfZmluZF9jYXBfb2Zmc2V0KHNlZywgYnVzLCBkLCBmLCBQQ0lfQ0FQX0lEX0VY
UCk7CisgICAgY29uc3QgcGNpX3NiZGZfdCBzYmRmID0geworICAgICAgICAuc2VnID0gc2VnLAor
ICAgICAgICAuYnVzID0gYnVzLAorICAgICAgICAuZGV2ID0gZCwKKyAgICAgICAgLmZ1bmMgPSBm
LAorICAgIH07CiAKLSAgICBjbGFzc19kZXZpY2UgPSBwY2lfY29uZl9yZWFkMTYoc2VnLCBidXMs
IGQsIGYsIFBDSV9DTEFTU19ERVZJQ0UpOworICAgIGNsYXNzX2RldmljZSA9IHBjaV9jb25mX3Jl
YWQxNihzYmRmLCBQQ0lfQ0xBU1NfREVWSUNFKTsKICAgICBzd2l0Y2ggKCBjbGFzc19kZXZpY2Ug
KQogICAgIHsKICAgICBjYXNlIFBDSV9DTEFTU19CUklER0VfUENJOgogICAgICAgICBpZiAoICFw
b3MgKQogICAgICAgICAgICAgcmV0dXJuIERFVl9UWVBFX0xFR0FDWV9QQ0lfQlJJREdFOwotICAg
ICAgICBjcmVnID0gcGNpX2NvbmZfcmVhZDE2KHNlZywgYnVzLCBkLCBmLCBwb3MgKyBQQ0lfRVhQ
X0ZMQUdTKTsKKyAgICAgICAgY3JlZyA9IHBjaV9jb25mX3JlYWQxNihzYmRmLCBwb3MgKyBQQ0lf
RVhQX0ZMQUdTKTsKICAgICAgICAgc3dpdGNoICggKGNyZWcgJiBQQ0lfRVhQX0ZMQUdTX1RZUEUp
ID4+IDQgKQogICAgICAgICB7CiAgICAgICAgIGNhc2UgUENJX0VYUF9UWVBFX1BDSV9CUklER0U6
CkBAIC0xMDExLDcgKzk5OCw3IEBAIGJvb2xfdCBfX2luaXQgcGNpX2RldmljZV9kZXRlY3QodTE2
IHNlZywgdTggYnVzLCB1OCBkZXYsIHU4IGZ1bmMpCiB7CiAgICAgdTMyIHZlbmRvcjsKIAotICAg
IHZlbmRvciA9IHBjaV9jb25mX3JlYWQzMihzZWcsIGJ1cywgZGV2LCBmdW5jLCBQQ0lfVkVORE9S
X0lEKTsKKyAgICB2ZW5kb3IgPSBwY2lfY29uZl9yZWFkMzIoUENJX1NCREZfVChzZWcsIGJ1cywg
ZGV2LCBmdW5jKSwgUENJX1ZFTkRPUl9JRCk7CiAgICAgLyogc29tZSBicm9rZW4gYm9hcmRzIHJl
dHVybiAwIG9yIH4wIGlmIGEgc2xvdCBpcyBlbXB0eTogKi8KICAgICBpZiAoICh2ZW5kb3IgPT0g
MHhmZmZmZmZmZikgfHwgKHZlbmRvciA9PSAweDAwMDAwMDAwKSB8fAogICAgICAgICAgKHZlbmRv
ciA9PSAweDAwMDBmZmZmKSB8fCAodmVuZG9yID09IDB4ZmZmZjAwMDApICkKQEAgLTEwNDMsMTAg
KzEwMzAsOCBAQCB2b2lkIHBjaV9jaGVja19kaXNhYmxlX2RldmljZSh1MTYgc2VnLCB1OCBidXMs
IHU4IGRldmZuKQogCiAgICAgLyogVGVsbCB0aGUgZGV2aWNlIHRvIHN0b3AgRE1BaW5nOyB3ZSBj
YW4ndCByZWx5IG9uIHRoZSBndWVzdCB0bwogICAgICAqIGNvbnRyb2wgaXQgZm9yIHVzLiAqLwot
ICAgIGN3b3JkID0gcGNpX2NvbmZfcmVhZDE2KHNlZywgYnVzLCBwZGV2LT5zYmRmLmRldiwgcGRl
di0+c2JkZi5mdW5jLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9DT01NQU5EKTsK
LSAgICBwY2lfY29uZl93cml0ZTE2KHNlZywgYnVzLCBwZGV2LT5zYmRmLmRldiwgcGRldi0+c2Jk
Zi5mdW5jLAotICAgICAgICAgICAgICAgICAgICAgUENJX0NPTU1BTkQsIGN3b3JkICYgflBDSV9D
T01NQU5EX01BU1RFUik7CisgICAgY3dvcmQgPSBwY2lfY29uZl9yZWFkMTYocGRldi0+c2JkZiwg
UENJX0NPTU1BTkQpOworICAgIHBjaV9jb25mX3dyaXRlMTYocGRldi0+c2JkZiwgUENJX0NPTU1B
TkQsIGN3b3JkICYgflBDSV9DT01NQU5EX01BU1RFUik7CiB9CiAKIC8qCkBAIC0xMDc5LDcgKzEw
NjQsNyBAQCBzdGF0aWMgaW50IF9faW5pdCBfc2Nhbl9wY2lfZGV2aWNlcyhzdHJ1Y3QgcGNpX3Nl
ZyAqcHNlZywgdm9pZCAqYXJnKQogICAgICAgICAgICAgICAgICAgICByZXR1cm4gLUVOT01FTTsK
ICAgICAgICAgICAgICAgICB9CiAKLSAgICAgICAgICAgICAgICBpZiAoICFmdW5jICYmICEocGNp
X2NvbmZfcmVhZDgocHNlZy0+bnIsIGJ1cywgZGV2LCBmdW5jLAorICAgICAgICAgICAgICAgIGlm
ICggIWZ1bmMgJiYgIShwY2lfY29uZl9yZWFkOChwZGV2LT5zYmRmLAogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lfSEVBREVSX1RZUEUpICYgMHg4MCkg
KQogICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgIH0KQEAgLTEyMTAsOSAr
MTE5NSw3IEBAIHN0YXRpYyBib29sX3QgaGVzdF9tYXRjaF90eXBlKGNvbnN0IHN0cnVjdCBhY3Bp
X2hlc3RfaGVhZGVyICpoZXN0X2hkciwKICAgICB1bnNpZ25lZCBpbnQgcG9zID0gcGNpX2ZpbmRf
Y2FwX29mZnNldChwZGV2LT5zYmRmLnNlZywgcGRldi0+c2JkZi5idXMsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGRldi0+c2JkZi5kZXYsIHBkZXYtPnNiZGYu
ZnVuYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lfQ0FQ
X0lEX0VYUCk7Ci0gICAgdWludDhfdCBwY2llID0gTUFTS19FWFRSKHBjaV9jb25mX3JlYWQxNihw
ZGV2LT5zYmRmLnNlZywgcGRldi0+c2JkZi5idXMsCi0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBwZGV2LT5zYmRmLmRldiwgcGRldi0+c2JkZi5mdW5jLAotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zICsgUENJX0VYUF9G
TEFHUyksCisgICAgdWludDhfdCBwY2llID0gTUFTS19FWFRSKHBjaV9jb25mX3JlYWQxNihwZGV2
LT5zYmRmLCBwb3MgKyBQQ0lfRVhQX0ZMQUdTKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgUENJX0VYUF9GTEFHU19UWVBFKTsKIAogICAgIHN3aXRjaCAoIGhlc3RfaGRyLT50eXBlICkK
QEAgLTEyMjIsOCArMTIwNSw3IEBAIHN0YXRpYyBib29sX3QgaGVzdF9tYXRjaF90eXBlKGNvbnN0
IHN0cnVjdCBhY3BpX2hlc3RfaGVhZGVyICpoZXN0X2hkciwKICAgICBjYXNlIEFDUElfSEVTVF9U
WVBFX0FFUl9FTkRQT0lOVDoKICAgICAgICAgcmV0dXJuIHBjaWUgPT0gUENJX0VYUF9UWVBFX0VO
RFBPSU5UOwogICAgIGNhc2UgQUNQSV9IRVNUX1RZUEVfQUVSX0JSSURHRToKLSAgICAgICAgcmV0
dXJuIHBjaV9jb25mX3JlYWQxNihwZGV2LT5zYmRmLnNlZywgcGRldi0+c2JkZi5idXMsIHBkZXYt
PnNiZGYuZGV2LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBkZXYtPnNiZGYuZnVu
YywgUENJX0NMQVNTX0RFVklDRSkgPT0KKyAgICAgICAgcmV0dXJuIHBjaV9jb25mX3JlYWQxNihw
ZGV2LT5zYmRmLCBQQ0lfQ0xBU1NfREVWSUNFKSA9PQogICAgICAgICAgICAgICAgUENJX0NMQVNT
X0JSSURHRV9QQ0k7CiAgICAgfQogCmRpZmYgLS1naXQgYS94ZW4vZHJpdmVycy9wYXNzdGhyb3Vn
aC92dGQvZG1hci5jIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvdnRkL2RtYXIuYwppbmRleCBl
ZmZhZjkzMjIyLi45ZDMwMTg4YWI5IDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3Vn
aC92dGQvZG1hci5jCisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9kbWFyLmMKQEAg
LTM0OCw3ICszNDgsNyBAQCBzdGF0aWMgaW50IF9faW5pdCBhY3BpX3BhcnNlX2Rldl9zY29wZSgK
IAogICAgICAgICB3aGlsZSAoIC0tZGVwdGggPiAwICkKICAgICAgICAgewotICAgICAgICAgICAg
YnVzID0gcGNpX2NvbmZfcmVhZDgoc2VnLCBidXMsIHBhdGgtPmRldiwgcGF0aC0+Zm4sCisgICAg
ICAgICAgICBidXMgPSBwY2lfY29uZl9yZWFkOChQQ0lfU0JERl9UKHNlZywgYnVzLCBwYXRoLT5k
ZXYsIHBhdGgtPmZuKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9TRUNP
TkRBUllfQlVTKTsKICAgICAgICAgICAgIHBhdGgrKzsKICAgICAgICAgfQpAQCAtMzU2LDEwICsz
NTYsMTYgQEAgc3RhdGljIGludCBfX2luaXQgYWNwaV9wYXJzZV9kZXZfc2NvcGUoCiAgICAgICAg
IHN3aXRjaCAoIGFjcGlfc2NvcGUtPmVudHJ5X3R5cGUgKQogICAgICAgICB7CiAgICAgICAgIGNh
c2UgQUNQSV9ETUFSX1NDT1BFX1RZUEVfQlJJREdFOgotICAgICAgICAgICAgc2VjX2J1cyA9IHBj
aV9jb25mX3JlYWQ4KHNlZywgYnVzLCBwYXRoLT5kZXYsIHBhdGgtPmZuLAotICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9TRUNPTkRBUllfQlVTKTsKLSAgICAgICAgICAg
IHN1Yl9idXMgPSBwY2lfY29uZl9yZWFkOChzZWcsIGJ1cywgcGF0aC0+ZGV2LCBwYXRoLT5mbiwK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lfU1VCT1JESU5BVEVfQlVT
KTsKKyAgICAgICAgeworICAgICAgICAgICAgY29uc3QgcGNpX3NiZGZfdCBzYmRmID0geworICAg
ICAgICAgICAgICAgIC5zZWcgPSBzZWcsCisgICAgICAgICAgICAgICAgLmJ1cyA9IGJ1cywKKyAg
ICAgICAgICAgICAgICAuZGV2ID0gcGF0aC0+ZGV2LAorICAgICAgICAgICAgICAgIC5mdW5jID0g
cGF0aC0+Zm4sCisgICAgICAgICAgICB9OworCisgICAgICAgICAgICBzZWNfYnVzID0gcGNpX2Nv
bmZfcmVhZDgoc2JkZiwgUENJX1NFQ09OREFSWV9CVVMpOworICAgICAgICAgICAgc3ViX2J1cyA9
IHBjaV9jb25mX3JlYWQ4KHNiZGYsIFBDSV9TVUJPUkRJTkFURV9CVVMpOwogICAgICAgICAgICAg
aWYgKCBpb21tdV92ZXJib3NlICkKICAgICAgICAgICAgICAgICBwcmludGsoVlREUFJFRklYCiAg
ICAgICAgICAgICAgICAgICAgICAgICIgYnJpZGdlOiAlMDR4OiUwMng6JTAyeC4ldSBzdGFydD0l
eCBzZWM9JXggc3ViPSV4XG4iLApAQCAtMzY4LDcgKzM3NCw3IEBAIHN0YXRpYyBpbnQgX19pbml0
IGFjcGlfcGFyc2VfZGV2X3Njb3BlKAogCiAgICAgICAgICAgICBkbWFyX3Njb3BlX2FkZF9idXNl
cyhzY29wZSwgc2VjX2J1cywgc3ViX2J1cyk7CiAgICAgICAgICAgICBicmVhazsKLQorICAgICAg
ICB9CiAgICAgICAgIGNhc2UgQUNQSV9ETUFSX1NDT1BFX1RZUEVfSFBFVDoKICAgICAgICAgICAg
IGlmICggaW9tbXVfdmVyYm9zZSApCiAgICAgICAgICAgICAgICAgcHJpbnRrKFZURFBSRUZJWCAi
IE1TSSBIUEVUOiAlMDR4OiUwMng6JTAyeC4ldVxuIiwKZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJz
L3Bhc3N0aHJvdWdoL3Z0ZC9xdWlya3MuYyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9x
dWlya3MuYwppbmRleCBmYTgxMTYwNWVlLi40OGM3Mzg0YjgyIDEwMDY0NAotLS0gYS94ZW4vZHJp
dmVycy9wYXNzdGhyb3VnaC92dGQvcXVpcmtzLmMKKysrIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91
Z2gvdnRkL3F1aXJrcy5jCkBAIC02MSw2ICs2MSwxNCBAQCBzdGF0aWMgYm9vbF90IF9fcmVhZF9t
b3N0bHkgaXNfc25iX2dmeDsKIHN0YXRpYyB1OCAqX19yZWFkX21vc3RseSBpZ2RfcmVnX3ZhOwog
c3RhdGljIHNwaW5sb2NrX3QgaWdkX2xvY2s7CiAKK3N0YXRpYyBjb25zdCBwY2lfc2JkZl90IGln
ZF9zYmRmID0geworICAgIC5kZXYgPSBJR0RfREVWLAorfTsKKworc3RhdGljIGNvbnN0IHBjaV9z
YmRmX3QgaW9oX3NiZGYgPSB7CisgICAgLmRldiA9IElPSF9ERVYsCit9OworCiAvKgogICogUVVJ
UksgdG8gd29ya2Fyb3VuZCBYZW4gYm9vdCBpc3N1ZSBvbiBDYWxwZWxsYS9Jcm9ubGFrZSBPRU0g
QklPUwogICogbm90IGVuYWJsaW5nIFZULWQgcHJvcGVybHkgaW4gSUdELiAgVGhlIHdvcmthcm91
bmQgaXMgdG8gbm90IGVuYWJsaW5nCkBAIC03NCw3ICs4Miw3IEBAIGludCBpc19pZ2RfdnRfZW5h
YmxlZF9xdWlyayh2b2lkKQogICAgICAgICByZXR1cm4gMTsKIAogICAgIC8qIGludGVncmF0ZWQg
Z3JhcGhpY3Mgb24gSW50ZWwgcGxhdGZvcm1zIGlzIGxvY2F0ZWQgYXQgMDoyLjAgKi8KLSAgICBn
Z2MgPSBwY2lfY29uZl9yZWFkMTYoMCwgMCwgSUdEX0RFViwgMCwgR0dDKTsKKyAgICBnZ2MgPSBw
Y2lfY29uZl9yZWFkMTYoaWdkX3NiZGYsIEdHQyk7CiAgICAgcmV0dXJuICggZ2djICYgR0dDX01F
TU9SWV9WVF9FTkFCTEVEID8gMSA6IDAgKTsKIH0KIApAQCAtODgsMTIgKzk2LDEyIEBAIHN0YXRp
YyB2b2lkIF9faW5pdCBjYW50aWdhX2IzX2VycmF0YV9pbml0KHZvaWQpCiAgICAgdTE2IHZpZDsK
ICAgICB1OCBkaWRfaGksIHJpZDsKIAotICAgIHZpZCA9IHBjaV9jb25mX3JlYWQxNigwLCAwLCBJ
R0RfREVWLCAwLCAwKTsKKyAgICB2aWQgPSBwY2lfY29uZl9yZWFkMTYoaWdkX3NiZGYsIDApOwog
ICAgIGlmICggdmlkICE9IDB4ODA4NiApCiAgICAgICAgIHJldHVybjsKIAotICAgIGRpZF9oaSA9
IHBjaV9jb25mX3JlYWQ4KDAsIDAsIElHRF9ERVYsIDAsIDMpOwotICAgIHJpZCA9IHBjaV9jb25m
X3JlYWQ4KDAsIDAsIElHRF9ERVYsIDAsIDgpOworICAgIGRpZF9oaSA9IHBjaV9jb25mX3JlYWQ4
KGlnZF9zYmRmLCAzKTsKKyAgICByaWQgPSBwY2lfY29uZl9yZWFkOChpZ2Rfc2JkZiwgOCk7CiAK
ICAgICBpZiAoIChkaWRfaGkgPT0gMHgyQSkgJiYgKHJpZCA9PSAweDcpICkKICAgICAgICAgaXNf
Y2FudGlnYV9iMyA9IDE7CkBAIC0xMjgsOSArMTM2LDkgQEAgc3RhdGljIHZvaWQgX19pbml0IG1h
cF9pZ2RfcmVnKHZvaWQpCiAgICAgaWYgKCBpZ2RfcmVnX3ZhICkKICAgICAgICAgcmV0dXJuOwog
Ci0gICAgaWdkX21taW8gICA9IHBjaV9jb25mX3JlYWQzMigwLCAwLCBJR0RfREVWLCAwLCBQQ0lf
QkFTRV9BRERSRVNTXzEpOworICAgIGlnZF9tbWlvICAgPSBwY2lfY29uZl9yZWFkMzIoaWdkX3Ni
ZGYsIFBDSV9CQVNFX0FERFJFU1NfMSk7CiAgICAgaWdkX21taW8gPDw9IDMyOwotICAgIGlnZF9t
bWlvICArPSBwY2lfY29uZl9yZWFkMzIoMCwgMCwgSUdEX0RFViwgMCwgUENJX0JBU0VfQUREUkVT
U18wKTsKKyAgICBpZ2RfbW1pbyAgKz0gcGNpX2NvbmZfcmVhZDMyKGlnZF9zYmRmLCBQQ0lfQkFT
RV9BRERSRVNTXzApOwogICAgIGlnZF9yZWdfdmEgPSBpb3JlbWFwKGlnZF9tbWlvICYgSUdEX0JB
Ul9NQVNLLCAweDMwMDApOwogfQogCkBAIC0yNzksOSArMjg3LDE0IEBAIHN0YXRpYyB2b2lkIF9f
aW5pdCB0eWxlcnNidXJnX2ludHJlbWFwX3F1aXJrKHZvaWQpCiAKICAgICBmb3IgKCBidXMgPSAw
OyBidXMgPCAweDEwMDsgYnVzKysgKQogICAgIHsKKyAgICAgICAgY29uc3QgcGNpX3NiZGZfdCBz
YmRmID0geworICAgICAgICAgICAgLmJ1cyA9IGJ1cywKKyAgICAgICAgICAgIC5kZXYgPSAyMCwK
KyAgICAgICAgfTsKKwogICAgICAgICAvKiBNYXRjaCBvbiBTeXN0ZW0gTWFuYWdlbWVudCBSZWdp
c3RlcnMgb24gRGV2aWNlIDIwIEZ1bmN0aW9uIDAgKi8KLSAgICAgICAgZGV2aWNlID0gcGNpX2Nv
bmZfcmVhZDMyKDAsIGJ1cywgMjAsIDAsIFBDSV9WRU5ET1JfSUQpOwotICAgICAgICByZXYgPSBw
Y2lfY29uZl9yZWFkOCgwLCBidXMsIDIwLCAwLCBQQ0lfUkVWSVNJT05fSUQpOworICAgICAgICBk
ZXZpY2UgPSBwY2lfY29uZl9yZWFkMzIoc2JkZiwgUENJX1ZFTkRPUl9JRCk7CisgICAgICAgIHJl
diA9IHBjaV9jb25mX3JlYWQ4KHNiZGYsIFBDSV9SRVZJU0lPTl9JRCk7CiAKICAgICAgICAgaWYg
KCByZXYgPT0gMHgxMyAmJiBkZXZpY2UgPT0gMHgzNDJlODA4NiApCiAgICAgICAgIHsKQEAgLTI5
Niw4ICszMDksOCBAQCBzdGF0aWMgdm9pZCBfX2luaXQgdHlsZXJzYnVyZ19pbnRyZW1hcF9xdWly
ayh2b2lkKQogLyogaW5pdGlhbGl6ZSBwbGF0Zm9ybSBpZGVudGlmaWNhdGlvbiBmbGFncyAqLwog
dm9pZCBfX2luaXQgcGxhdGZvcm1fcXVpcmtzX2luaXQodm9pZCkKIHsKLSAgICBpb2hfaWQgPSBw
Y2lfY29uZl9yZWFkMzIoMCwgMCwgSU9IX0RFViwgMCwgMCk7Ci0gICAgaWdkX2lkID0gcGNpX2Nv
bmZfcmVhZDMyKDAsIDAsIElHRF9ERVYsIDAsIDApOworICAgIGlvaF9pZCA9IHBjaV9jb25mX3Jl
YWQzMihpb2hfc2JkZiwgMCk7CisgICAgaWdkX2lkID0gcGNpX2NvbmZfcmVhZDMyKGlnZF9zYmRm
LCAwKTsKIAogICAgIC8qIE1vYmlsZSA0IFNlcmllcyBDaGlwc2V0IG5lZ2xlY3RzIHRvIHNldCBS
V0JGIGNhcGFiaWxpdHkuICovCiAgICAgaWYgKCBpb2hfaWQgPT0gMHgyYTQwODA4NiApCkBAIC0z
NTYsMTUgKzM2OSwxNSBAQCBpbnQgbWVfd2lmaV9xdWlyayhzdHJ1Y3QgZG9tYWluICpkb21haW4s
IHU4IGJ1cywgdTggZGV2Zm4sIGludCBtYXApCiAgICAgdTMyIGlkOwogICAgIGludCByYyA9IDA7
CiAKLSAgICBpZCA9IHBjaV9jb25mX3JlYWQzMigwLCAwLCAwLCAwLCAwKTsKKyAgICBpZCA9IHBj
aV9jb25mX3JlYWQzMihQQ0lfU0JERl9UKDAsIDAsIDAsIDApLCAwKTsKICAgICBpZiAoIElTX0NU
RyhpZCkgKQogICAgIHsKICAgICAgICAgLyogcXVpdCBpZiBNRSBkb2VzIG5vdCBleGlzdCAqLwot
ICAgICAgICBpZiAoIHBjaV9jb25mX3JlYWQzMigwLCAwLCAzLCAwLCAwKSA9PSAweGZmZmZmZmZm
ICkKKyAgICAgICAgaWYgKCBwY2lfY29uZl9yZWFkMzIoUENJX1NCREZfVCgwLCAwLCAzLCAwKSwg
MCkgPT0gMHhmZmZmZmZmZiApCiAgICAgICAgICAgICByZXR1cm4gMDsKIAogICAgICAgICAvKiBp
ZiBkZXZpY2UgaXMgV0xBTiBkZXZpY2UsIG1hcCBNRSBwaGFudG9tIGRldmljZSAwOjMuNyAqLwot
ICAgICAgICBpZCA9IHBjaV9jb25mX3JlYWQzMigwLCBidXMsIFBDSV9TTE9UKGRldmZuKSwgUENJ
X0ZVTkMoZGV2Zm4pLCAwKTsKKyAgICAgICAgaWQgPSBwY2lfY29uZl9yZWFkMzIoUENJX1NCREYz
X1QoMCwgYnVzLCBkZXZmbiksIDApOwogICAgICAgICBzd2l0Y2ggKGlkKQogICAgICAgICB7CiAg
ICAgICAgICAgICBjYXNlIDB4NDIzMjgwODY6CkBAIC0zODQsMTEgKzM5NywxMSBAQCBpbnQgbWVf
d2lmaV9xdWlyayhzdHJ1Y3QgZG9tYWluICpkb21haW4sIHU4IGJ1cywgdTggZGV2Zm4sIGludCBt
YXApCiAgICAgZWxzZSBpZiAoIElTX0lMSyhpZCkgfHwgSVNfQ1BUKGlkKSApCiAgICAgewogICAg
ICAgICAvKiBxdWl0IGlmIE1FIGRvZXMgbm90IGV4aXN0ICovCi0gICAgICAgIGlmICggcGNpX2Nv
bmZfcmVhZDMyKDAsIDAsIDIyLCAwLCAwKSA9PSAweGZmZmZmZmZmICkKKyAgICAgICAgaWYgKCBw
Y2lfY29uZl9yZWFkMzIoUENJX1NCREZfVCgwLCAwLCAyMiwgMCksIDApID09IDB4ZmZmZmZmZmYg
KQogICAgICAgICAgICAgcmV0dXJuIDA7CiAKICAgICAgICAgLyogaWYgZGV2aWNlIGlzIFdMQU4g
ZGV2aWNlLCBtYXAgTUUgcGhhbnRvbSBkZXZpY2UgMDoyMi43ICovCi0gICAgICAgIGlkID0gcGNp
X2NvbmZfcmVhZDMyKDAsIGJ1cywgUENJX1NMT1QoZGV2Zm4pLCBQQ0lfRlVOQyhkZXZmbiksIDAp
OworICAgICAgICBpZCA9IHBjaV9jb25mX3JlYWQzMihQQ0lfU0JERjNfVCgwLCBidXMsIGRldmZu
KSwgMCk7CiAgICAgICAgIHN3aXRjaCAoaWQpCiAgICAgICAgIHsKICAgICAgICAgICAgIGNhc2Ug
MHgwMDg3ODA4NjogICAgICAgIC8qIEtpbG1lciBQZWFrICovCkBAIC00MjQsMTEgKzQzNywxMSBA
QCB2b2lkIHBjaV92dGRfcXVpcmsoY29uc3Qgc3RydWN0IHBjaV9kZXYgKnBkZXYpCiAgICAgcGFk
ZHJfdCBwYTsKICAgICBjb25zdCBjaGFyICphY3Rpb247CiAKLSAgICBpZiAoIHBjaV9jb25mX3Jl
YWQxNihzZWcsIGJ1cywgZGV2LCBmdW5jLCBQQ0lfVkVORE9SX0lEKSAhPQorICAgIGlmICggcGNp
X2NvbmZfcmVhZDE2KHBkZXYtPnNiZGYsIFBDSV9WRU5ET1JfSUQpICE9CiAgICAgICAgICBQQ0lf
VkVORE9SX0lEX0lOVEVMICkKICAgICAgICAgcmV0dXJuOwogCi0gICAgc3dpdGNoICggcGNpX2Nv
bmZfcmVhZDE2KHNlZywgYnVzLCBkZXYsIGZ1bmMsIFBDSV9ERVZJQ0VfSUQpICkKKyAgICBzd2l0
Y2ggKCBwY2lfY29uZl9yZWFkMTYocGRldi0+c2JkZiwgUENJX0RFVklDRV9JRCkgKQogICAgIHsK
ICAgICAvKgogICAgICAqIE1hc2sgcmVwb3J0aW5nIEludGVsIFZULWQgZmF1bHRzIHRvIElPSCBj
b3JlIGxvZ2ljOgpAQCAtNDM5LDggKzQ1Miw4IEBAIHZvaWQgcGNpX3Z0ZF9xdWlyayhjb25zdCBz
dHJ1Y3QgcGNpX2RldiAqcGRldikKICAgICBjYXNlIDB4MzQyZTogLyogVHlsZXJzYnVyZyBjaGlw
c2V0IChOZWhhbGVtIC8gV2VzdG1lcmUgc3lzdGVtcykgKi8KICAgICBjYXNlIDB4MzcyODogLyog
WGVvbiBDNTUwMC9DMzUwMCAoSmFzcGVyRm9yZXN0KSAqLwogICAgIGNhc2UgMHgzYzI4OiAvKiBT
YW5keWJyaWRnZSAqLwotICAgICAgICB2YWwgPSBwY2lfY29uZl9yZWFkMzIoc2VnLCBidXMsIGRl
diwgZnVuYywgMHgxQUMpOwotICAgICAgICBwY2lfY29uZl93cml0ZTMyKHNlZywgYnVzLCBkZXYs
IGZ1bmMsIDB4MUFDLCB2YWwgfCAoMSA8PCAzMSkpOworICAgICAgICB2YWwgPSBwY2lfY29uZl9y
ZWFkMzIocGRldi0+c2JkZiwgMHgxQUMpOworICAgICAgICBwY2lfY29uZl93cml0ZTMyKHBkZXYt
PnNiZGYsIDB4MUFDLCB2YWwgfCAoMSA8PCAzMSkpOwogICAgICAgICBwcmludGsoWEVOTE9HX0lO
Rk8gIk1hc2tlZCBWVC1kIGVycm9yIHNpZ25hbGluZyBvbiAlMDR4OiUwMng6JTAyeC4ldVxuIiwK
ICAgICAgICAgICAgICAgIHNlZywgYnVzLCBkZXYsIGZ1bmMpOwogICAgICAgICBicmVhazsKQEAg
LTQ2Miw3ICs0NzUsNyBAQCB2b2lkIHBjaV92dGRfcXVpcmsoY29uc3Qgc3RydWN0IHBjaV9kZXYg
KnBkZXYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lfRVhU
X0NBUF9JRF9WTkRSKTsKICAgICAgICAgICAgIHdoaWxlICggcG9zICkKICAgICAgICAgICAgIHsK
LSAgICAgICAgICAgICAgICB2YWwgPSBwY2lfY29uZl9yZWFkMzIoc2VnLCBidXMsIGRldiwgZnVu
YywgcG9zICsgUENJX1ZORFJfSEVBREVSKTsKKyAgICAgICAgICAgICAgICB2YWwgPSBwY2lfY29u
Zl9yZWFkMzIocGRldi0+c2JkZiwgcG9zICsgUENJX1ZORFJfSEVBREVSKTsKICAgICAgICAgICAg
ICAgICBpZiAoIFBDSV9WTkRSX0hFQURFUl9JRCh2YWwpID09IDQgJiYgUENJX1ZORFJfSEVBREVS
X1JFVih2YWwpID09IDEgKQogICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAg
cG9zICs9IFBDSV9WTkRSX0hFQURFUjsKQEAgLTQ4MiwxNSArNDk1LDE1IEBAIHZvaWQgcGNpX3Z0
ZF9xdWlyayhjb25zdCBzdHJ1Y3QgcGNpX2RldiAqcGRldikKICAgICAgICAgICAgIGJyZWFrOwog
ICAgICAgICB9CiAKLSAgICAgICAgdmFsID0gcGNpX2NvbmZfcmVhZDMyKHNlZywgYnVzLCBkZXYs
IGZ1bmMsIHBvcyArIFBDSV9FUlJfVU5DT1JfTUFTSyk7Ci0gICAgICAgIHZhbDIgPSBwY2lfY29u
Zl9yZWFkMzIoc2VnLCBidXMsIGRldiwgZnVuYywgcG9zICsgUENJX0VSUl9DT1JfTUFTSyk7Cisg
ICAgICAgIHZhbCA9IHBjaV9jb25mX3JlYWQzMihwZGV2LT5zYmRmLCBwb3MgKyBQQ0lfRVJSX1VO
Q09SX01BU0spOworICAgICAgICB2YWwyID0gcGNpX2NvbmZfcmVhZDMyKHBkZXYtPnNiZGYsIHBv
cyArIFBDSV9FUlJfQ09SX01BU0spOwogICAgICAgICBpZiAoICh2YWwgJiBQQ0lfRVJSX1VOQ19V
TlNVUCkgJiYgKHZhbDIgJiBQQ0lfRVJSX0NPUl9BRFZfTkZBVCkgKQogICAgICAgICAgICAgYWN0
aW9uID0gIkZvdW5kIG1hc2tlZCI7CiAgICAgICAgIGVsc2UgaWYgKCAhZmYgKQogICAgICAgICB7
Ci0gICAgICAgICAgICBwY2lfY29uZl93cml0ZTMyKHNlZywgYnVzLCBkZXYsIGZ1bmMsIHBvcyAr
IFBDSV9FUlJfVU5DT1JfTUFTSywKKyAgICAgICAgICAgIHBjaV9jb25mX3dyaXRlMzIocGRldi0+
c2JkZiwgcG9zICsgUENJX0VSUl9VTkNPUl9NQVNLLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICB2YWwgfCBQQ0lfRVJSX1VOQ19VTlNVUCk7Ci0gICAgICAgICAgICBwY2lfY29uZl93cml0
ZTMyKHNlZywgYnVzLCBkZXYsIGZ1bmMsIHBvcyArIFBDSV9FUlJfQ09SX01BU0ssCisgICAgICAg
ICAgICBwY2lfY29uZl93cml0ZTMyKHBkZXYtPnNiZGYsIHBvcyArIFBDSV9FUlJfQ09SX01BU0ss
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbDIgfCBQQ0lfRVJSX0NPUl9BRFZfTkZB
VCk7CiAgICAgICAgICAgICBhY3Rpb24gPSAiTWFza2VkIjsKICAgICAgICAgfQpAQCAtNDk4LDgg
KzUxMSw4IEBAIHZvaWQgcGNpX3Z0ZF9xdWlyayhjb25zdCBzdHJ1Y3QgcGNpX2RldiAqcGRldikK
ICAgICAgICAgICAgIGFjdGlvbiA9ICJNdXN0IG5vdCBtYXNrIjsKIAogICAgICAgICAvKiBYUFVO
Q0VSUk1TSyBTZW5kIENvbXBsZXRpb24gd2l0aCBVbnN1cHBvcnRlZCBSZXF1ZXN0ICovCi0gICAg
ICAgIHZhbCA9IHBjaV9jb25mX3JlYWQzMihzZWcsIGJ1cywgZGV2LCBmdW5jLCAweDIwYyk7Ci0g
ICAgICAgIHBjaV9jb25mX3dyaXRlMzIoc2VnLCBidXMsIGRldiwgZnVuYywgMHgyMGMsIHZhbCB8
ICgxIDw8IDQpKTsKKyAgICAgICAgdmFsID0gcGNpX2NvbmZfcmVhZDMyKHBkZXYtPnNiZGYsIDB4
MjBjKTsKKyAgICAgICAgcGNpX2NvbmZfd3JpdGUzMihwZGV2LT5zYmRmLCAweDIwYywgdmFsIHwg
KDEgPDwgNCkpOwogCiAgICAgICAgIHByaW50ayhYRU5MT0dfSU5GTyAiJXMgVVIgc2lnbmFsaW5n
IG9uICUwNHg6JTAyeDolMDJ4LiV1XG4iLAogICAgICAgICAgICAgICAgYWN0aW9uLCBzZWcsIGJ1
cywgZGV2LCBmdW5jKTsKQEAgLTUxNSw4ICs1MjgsOCBAQCB2b2lkIHBjaV92dGRfcXVpcmsoY29u
c3Qgc3RydWN0IHBjaV9kZXYgKnBkZXYpCiAgICAgY2FzZSAweDE2MTA6IGNhc2UgMHgxNjE0OiBj
YXNlIDB4MTYxODogLyogQnJvYWR3ZWxsICovCiAgICAgY2FzZSAweDE5MDA6IGNhc2UgMHgxOTA0
OiBjYXNlIDB4MTkwODogY2FzZSAweDE5MGM6IGNhc2UgMHgxOTBmOiAvKiBTa3lsYWtlICovCiAg
ICAgY2FzZSAweDE5MTA6IGNhc2UgMHgxOTE4OiBjYXNlIDB4MTkxZjogLyogU2t5bGFrZSAqLwot
ICAgICAgICBiYXIgPSBwY2lfY29uZl9yZWFkMzIoc2VnLCBidXMsIGRldiwgZnVuYywgMHg2Yyk7
Ci0gICAgICAgIGJhciA9IChiYXIgPDwgMzIpIHwgcGNpX2NvbmZfcmVhZDMyKHNlZywgYnVzLCBk
ZXYsIGZ1bmMsIDB4NjgpOworICAgICAgICBiYXIgPSBwY2lfY29uZl9yZWFkMzIocGRldi0+c2Jk
ZiwgMHg2Yyk7CisgICAgICAgIGJhciA9IChiYXIgPDwgMzIpIHwgcGNpX2NvbmZfcmVhZDMyKHBk
ZXYtPnNiZGYsIDB4NjgpOwogICAgICAgICBwYSA9IGJhciAmIDB4N2ZmZmZmZjAwMFVMOyAvKiBi
aXRzIDEyLi4uMzggKi8KICAgICAgICAgaWYgKCAoYmFyICYgMSkgJiYgcGEgJiYKICAgICAgICAg
ICAgICBwYWdlX2lzX3JhbV90eXBlKHBhZGRyX3RvX3BmbihwYSksIFJBTV9UWVBFX1JFU0VSVkVE
KSApCmRpZmYgLS1naXQgYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC94ODYvYXRzLmMgYi94ZW4v
ZHJpdmVycy9wYXNzdGhyb3VnaC94ODYvYXRzLmMKaW5kZXggZGRhZWM3MmQxOS4uYzMyMDM3OTNh
NiAxMDA2NDQKLS0tIGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gveDg2L2F0cy5jCisrKyBiL3hl
bi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3g4Ni9hdHMuYwpAQCAtMzQsOCArMzQsNyBAQCBpbnQgZW5h
YmxlX2F0c19kZXZpY2Uoc3RydWN0IHBjaV9kZXYgKnBkZXYsIHN0cnVjdCBsaXN0X2hlYWQgKmF0
c19saXN0KQogICAgICAgICBkcHJpbnRrKFhFTkxPR19JTkZPLCAiJTA0eDolMDJ4OiUwMnguJXU6
IEFUUyBjYXBhYmlsaXR5IGZvdW5kXG4iLAogICAgICAgICAgICAgICAgIHNlZywgYnVzLCBQQ0lf
U0xPVChkZXZmbiksIFBDSV9GVU5DKGRldmZuKSk7CiAKLSAgICB2YWx1ZSA9IHBjaV9jb25mX3Jl
YWQxNihzZWcsIGJ1cywgUENJX1NMT1QoZGV2Zm4pLAotICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIFBDSV9GVU5DKGRldmZuKSwgcG9zICsgQVRTX1JFR19DVEwpOworICAgIHZhbHVlID0gcGNp
X2NvbmZfcmVhZDE2KHBkZXYtPnNiZGYsIHBvcyArIEFUU19SRUdfQ1RMKTsKICAgICBpZiAoIHZh
bHVlICYgQVRTX0VOQUJMRSApCiAgICAgewogICAgICAgICBzdHJ1Y3QgcGNpX2RldiAqb3RoZXI7
CkBAIC01MSwxNSArNTAsMTMgQEAgaW50IGVuYWJsZV9hdHNfZGV2aWNlKHN0cnVjdCBwY2lfZGV2
ICpwZGV2LCBzdHJ1Y3QgbGlzdF9oZWFkICphdHNfbGlzdCkKICAgICBpZiAoICEodmFsdWUgJiBB
VFNfRU5BQkxFKSApCiAgICAgewogICAgICAgICB2YWx1ZSB8PSBBVFNfRU5BQkxFOwotICAgICAg
ICBwY2lfY29uZl93cml0ZTE2KHNlZywgYnVzLCBQQ0lfU0xPVChkZXZmbiksIFBDSV9GVU5DKGRl
dmZuKSwKLSAgICAgICAgICAgICAgICAgICAgICAgICBwb3MgKyBBVFNfUkVHX0NUTCwgdmFsdWUp
OworICAgICAgICBwY2lfY29uZl93cml0ZTE2KHBkZXYtPnNiZGYsIHBvcyArIEFUU19SRUdfQ1RM
LCB2YWx1ZSk7CiAgICAgfQogCiAgICAgaWYgKCBwb3MgKQogICAgIHsKICAgICAgICAgcGRldi0+
YXRzLmNhcF9wb3MgPSBwb3M7Ci0gICAgICAgIHZhbHVlID0gcGNpX2NvbmZfcmVhZDE2KHNlZywg
YnVzLCBQQ0lfU0xPVChkZXZmbiksCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBD
SV9GVU5DKGRldmZuKSwgcG9zICsgQVRTX1JFR19DQVApOworICAgICAgICB2YWx1ZSA9IHBjaV9j
b25mX3JlYWQxNihwZGV2LT5zYmRmLCBwb3MgKyBBVFNfUkVHX0NBUCk7CiAgICAgICAgIHBkZXYt
PmF0cy5xdWV1ZV9kZXB0aCA9IHZhbHVlICYgQVRTX1FVRVVFX0RFUFRIX01BU0sgPzoKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgQVRTX1FVRVVFX0RFUFRIX01BU0sgKyAxOwogICAg
ICAgICBsaXN0X2FkZCgmcGRldi0+YXRzLmxpc3QsIGF0c19saXN0KTsKQEAgLTgxLDExICs3OCw5
IEBAIHZvaWQgZGlzYWJsZV9hdHNfZGV2aWNlKHN0cnVjdCBwY2lfZGV2ICpwZGV2KQogCiAgICAg
QlVHX09OKCFwZGV2LT5hdHMuY2FwX3Bvcyk7CiAKLSAgICB2YWx1ZSA9IHBjaV9jb25mX3JlYWQx
NihzZWcsIGJ1cywgUENJX1NMT1QoZGV2Zm4pLCBQQ0lfRlVOQyhkZXZmbiksCi0gICAgICAgICAg
ICAgICAgICAgICAgICAgICAgcGRldi0+YXRzLmNhcF9wb3MgKyBBVFNfUkVHX0NUTCk7CisgICAg
dmFsdWUgPSBwY2lfY29uZl9yZWFkMTYocGRldi0+c2JkZiwgcGRldi0+YXRzLmNhcF9wb3MgKyBB
VFNfUkVHX0NUTCk7CiAgICAgdmFsdWUgJj0gfkFUU19FTkFCTEU7Ci0gICAgcGNpX2NvbmZfd3Jp
dGUxNihzZWcsIGJ1cywgUENJX1NMT1QoZGV2Zm4pLCBQQ0lfRlVOQyhkZXZmbiksCi0gICAgICAg
ICAgICAgICAgICAgICBwZGV2LT5hdHMuY2FwX3BvcyArIEFUU19SRUdfQ1RMLCB2YWx1ZSk7Cisg
ICAgcGNpX2NvbmZfd3JpdGUxNihwZGV2LT5zYmRmLCBwZGV2LT5hdHMuY2FwX3BvcyArIEFUU19S
RUdfQ1RMLCB2YWx1ZSk7CiAKICAgICBsaXN0X2RlbCgmcGRldi0+YXRzLmxpc3QpOwogCmRpZmYg
LS1naXQgYS94ZW4vZHJpdmVycy9wY2kvcGNpLmMgYi94ZW4vZHJpdmVycy9wY2kvcGNpLmMKaW5k
ZXggYTMyMjNhMmIyOS4uM2QyYWNmNmY3NyAxMDA2NDQKLS0tIGEveGVuL2RyaXZlcnMvcGNpL3Bj
aS5jCisrKyBiL3hlbi9kcml2ZXJzL3BjaS9wY2kuYwpAQCAtMTQsMTkgKzE0LDI1IEBAIGludCBw
Y2lfZmluZF9jYXBfb2Zmc2V0KHUxNiBzZWcsIHU4IGJ1cywgdTggZGV2LCB1OCBmdW5jLCB1OCBj
YXApCiAgICAgaW50IG1heF9jYXAgPSA0ODsKICAgICB1OCBwb3MgPSBQQ0lfQ0FQQUJJTElUWV9M
SVNUOwogICAgIHUxNiBzdGF0dXM7Ci0KLSAgICBzdGF0dXMgPSBwY2lfY29uZl9yZWFkMTYoc2Vn
LCBidXMsIGRldiwgZnVuYywgUENJX1NUQVRVUyk7CisgICAgY29uc3QgcGNpX3NiZGZfdCBzYmRm
ID0geworICAgICAgICAuc2VnID0gc2VnLAorICAgICAgICAuYnVzID0gYnVzLAorICAgICAgICAu
ZGV2ID0gZGV2LAorICAgICAgICAuZnVuYyA9IGZ1bmMsCisgICAgfTsKKworICAgIHN0YXR1cyA9
IHBjaV9jb25mX3JlYWQxNihzYmRmLCBQQ0lfU1RBVFVTKTsKICAgICBpZiAoIChzdGF0dXMgJiBQ
Q0lfU1RBVFVTX0NBUF9MSVNUKSA9PSAwICkKICAgICAgICAgcmV0dXJuIDA7CiAKICAgICB3aGls
ZSAoIG1heF9jYXAtLSApCiAgICAgewotICAgICAgICBwb3MgPSBwY2lfY29uZl9yZWFkOChzZWcs
IGJ1cywgZGV2LCBmdW5jLCBwb3MpOworICAgICAgICBwb3MgPSBwY2lfY29uZl9yZWFkOChzYmRm
LCBwb3MpOwogICAgICAgICBpZiAoIHBvcyA8IDB4NDAgKQogICAgICAgICAgICAgYnJlYWs7CiAK
ICAgICAgICAgcG9zICY9IH4zOwotICAgICAgICBpZCA9IHBjaV9jb25mX3JlYWQ4KHNlZywgYnVz
LCBkZXYsIGZ1bmMsIHBvcyArIFBDSV9DQVBfTElTVF9JRCk7CisgICAgICAgIGlkID0gcGNpX2Nv
bmZfcmVhZDgoc2JkZiwgcG9zICsgUENJX0NBUF9MSVNUX0lEKTsKIAogICAgICAgICBpZiAoIGlk
ID09IDB4ZmYgKQogICAgICAgICAgICAgYnJlYWs7CkBAIC00MywxNiArNDksMjAgQEAgaW50IHBj
aV9maW5kX25leHRfY2FwKHUxNiBzZWcsIHU4IGJ1cywgdW5zaWduZWQgaW50IGRldmZuLCB1OCBw
b3MsIGludCBjYXApCiB7CiAgICAgdTggaWQ7CiAgICAgaW50IHR0bCA9IDQ4OworICAgIGNvbnN0
IHBjaV9zYmRmX3Qgc2JkZiA9IHsKKyAgICAgICAgLnNlZyA9IHNlZywKKyAgICAgICAgLmJ1cyA9
IGJ1cywKKyAgICAgICAgLmV4dGZ1bmMgPSBkZXZmbiwKKyAgICB9OwogCiAgICAgd2hpbGUgKCB0
dGwtLSApCiAgICAgewotICAgICAgICBwb3MgPSBwY2lfY29uZl9yZWFkOChzZWcsIGJ1cywgUENJ
X1NMT1QoZGV2Zm4pLCBQQ0lfRlVOQyhkZXZmbiksIHBvcyk7CisgICAgICAgIHBvcyA9IHBjaV9j
b25mX3JlYWQ4KHNiZGYsIHBvcyk7CiAgICAgICAgIGlmICggcG9zIDwgMHg0MCApCiAgICAgICAg
ICAgICBicmVhazsKIAogICAgICAgICBwb3MgJj0gfjM7Ci0gICAgICAgIGlkID0gcGNpX2NvbmZf
cmVhZDgoc2VnLCBidXMsIFBDSV9TTE9UKGRldmZuKSwgUENJX0ZVTkMoZGV2Zm4pLAotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHBvcyArIFBDSV9DQVBfTElTVF9JRCk7CisgICAgICAgIGlk
ID0gcGNpX2NvbmZfcmVhZDgoc2JkZiwgcG9zICsgUENJX0NBUF9MSVNUX0lEKTsKIAogICAgICAg
ICBpZiAoIGlkID09IDB4ZmYgKQogICAgICAgICAgICAgYnJlYWs7CkBAIC05MCwxMSArMTAwLDE0
IEBAIGludCBwY2lfZmluZF9leHRfY2FwYWJpbGl0eShpbnQgc2VnLCBpbnQgYnVzLCBpbnQgZGV2
Zm4sIGludCBjYXApCiAgKi8KIGludCBwY2lfZmluZF9uZXh0X2V4dF9jYXBhYmlsaXR5KGludCBz
ZWcsIGludCBidXMsIGludCBkZXZmbiwgaW50IHN0YXJ0LCBpbnQgY2FwKQogewotICAgIHUzMiBo
ZWFkZXI7CiAgICAgaW50IHR0bCA9IDQ4MDsgLyogMzg0MCBieXRlcywgbWluaW11bSA4IGJ5dGVz
IHBlciBjYXBhYmlsaXR5ICovCiAgICAgaW50IHBvcyA9IG1heChzdGFydCwgMHgxMDApOwotCi0g
ICAgaGVhZGVyID0gcGNpX2NvbmZfcmVhZDMyKHNlZywgYnVzLCBQQ0lfU0xPVChkZXZmbiksIFBD
SV9GVU5DKGRldmZuKSwgcG9zKTsKKyAgICBjb25zdCBwY2lfc2JkZl90IHNiZGYgPSB7CisgICAg
ICAgIC5zZWcgPSBzZWcsCisgICAgICAgIC5idXMgPSBidXMsCisgICAgICAgIC5leHRmdW5jID0g
ZGV2Zm4sCisgICAgfTsKKyAgICB1aW50MzJfdCBoZWFkZXIgPSBwY2lfY29uZl9yZWFkMzIoc2Jk
ZiwgcG9zKTsKIAogICAgIC8qCiAgICAgICogSWYgd2UgaGF2ZSBubyBjYXBhYmlsaXRpZXMsIHRo
aXMgaXMgaW5kaWNhdGVkIGJ5IGNhcCBJRCwKQEAgLTExMCwyNCArMTIzLDIwIEBAIGludCBwY2lf
ZmluZF9uZXh0X2V4dF9jYXBhYmlsaXR5KGludCBzZWcsIGludCBidXMsIGludCBkZXZmbiwgaW50
IHN0YXJ0LCBpbnQgY2FwCiAgICAgICAgIHBvcyA9IFBDSV9FWFRfQ0FQX05FWFQoaGVhZGVyKTsK
ICAgICAgICAgaWYgKCBwb3MgPCAweDEwMCApCiAgICAgICAgICAgICBicmVhazsKLSAgICAgICAg
aGVhZGVyID0gcGNpX2NvbmZfcmVhZDMyKHNlZywgYnVzLCBQQ0lfU0xPVChkZXZmbiksIFBDSV9G
VU5DKGRldmZuKSwgcG9zKTsKKyAgICAgICAgaGVhZGVyID0gcGNpX2NvbmZfcmVhZDMyKHNiZGYs
IHBvcyk7CiAgICAgfQogICAgIHJldHVybiAwOwogfQogCiB2b2lkIHBjaV9pbnR4KGNvbnN0IHN0
cnVjdCBwY2lfZGV2ICpwZGV2LCBib29sIGVuYWJsZSkKIHsKLSAgICB1aW50MTZfdCBzZWcgPSBw
ZGV2LT5zYmRmLnNlZzsKLSAgICB1aW50OF90IGJ1cyA9IHBkZXYtPnNiZGYuYnVzOwotICAgIHVp
bnQ4X3Qgc2xvdCA9IHBkZXYtPnNiZGYuZGV2OwotICAgIHVpbnQ4X3QgZnVuYyA9IHBkZXYtPnNi
ZGYuZnVuYzsKLSAgICB1aW50MTZfdCBjbWQgPSBwY2lfY29uZl9yZWFkMTYoc2VnLCBidXMsIHNs
b3QsIGZ1bmMsIFBDSV9DT01NQU5EKTsKKyAgICB1aW50MTZfdCBjbWQgPSBwY2lfY29uZl9yZWFk
MTYocGRldi0+c2JkZiwgUENJX0NPTU1BTkQpOwogCiAgICAgaWYgKCBlbmFibGUgKQogICAgICAg
ICBjbWQgJj0gflBDSV9DT01NQU5EX0lOVFhfRElTQUJMRTsKICAgICBlbHNlCiAgICAgICAgIGNt
ZCB8PSBQQ0lfQ09NTUFORF9JTlRYX0RJU0FCTEU7Ci0gICAgcGNpX2NvbmZfd3JpdGUxNihzZWcs
IGJ1cywgc2xvdCwgZnVuYywgUENJX0NPTU1BTkQsIGNtZCk7CisgICAgcGNpX2NvbmZfd3JpdGUx
NihwZGV2LT5zYmRmLCBQQ0lfQ09NTUFORCwgY21kKTsKIH0KIAogY29uc3QgY2hhciAqX19pbml0
IHBhcnNlX3BjaShjb25zdCBjaGFyICpzLCB1bnNpZ25lZCBpbnQgKnNlZ19wLApkaWZmIC0tZ2l0
IGEveGVuL2RyaXZlcnMvdmlkZW8vdmdhLmMgYi94ZW4vZHJpdmVycy92aWRlby92Z2EuYwppbmRl
eCA2YTY0ZmQ5MDEzLi41OWY5YzlkZTZmIDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy92aWRlby92
Z2EuYworKysgYi94ZW4vZHJpdmVycy92aWRlby92Z2EuYwpAQCAtMTIxLDEwICsxMjEsOCBAQCB2
b2lkIF9faW5pdCB2aWRlb19lbmRib290KHZvaWQpCiAgICAgICAgICAgICAgICAgcGNpZGV2c191
bmxvY2soKTsKIAogICAgICAgICAgICAgICAgIGlmICggIXBkZXYgfHwKLSAgICAgICAgICAgICAg
ICAgICAgIHBjaV9jb25mX3JlYWQxNigwLCBidXMsIFBDSV9TTE9UKGRldmZuKSwgUENJX0ZVTkMo
ZGV2Zm4pLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9DTEFTU19E
RVZJQ0UpICE9IDB4MDMwMCB8fAotICAgICAgICAgICAgICAgICAgICAgIShwY2lfY29uZl9yZWFk
MTYoMCwgYnVzLCBQQ0lfU0xPVChkZXZmbiksCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBQQ0lfRlVOQyhkZXZmbiksIFBDSV9DT01NQU5EKSAmCisgICAgICAgICAgICAg
ICAgICAgICBwY2lfY29uZl9yZWFkMTYocGRldi0+c2JkZiwgUENJX0NMQVNTX0RFVklDRSkgIT0g
MHgwMzAwIHx8CisgICAgICAgICAgICAgICAgICAgICAhKHBjaV9jb25mX3JlYWQxNihwZGV2LT5z
YmRmLCBQQ0lfQ09NTUFORCkgJgogICAgICAgICAgICAgICAgICAgICAgICAoUENJX0NPTU1BTkRf
SU8gfCBQQ0lfQ09NTUFORF9NRU1PUlkpKSApCiAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVl
OwogCkBAIC0xMzYsMjEgKzEzNCwyNCBAQCB2b2lkIF9faW5pdCB2aWRlb19lbmRib290KHZvaWQp
CiAgICAgICAgICAgICAgICAgICAgICAgICBiID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAg
IGJyZWFrOwogICAgICAgICAgICAgICAgICAgICBjYXNlIDE6Ci0gICAgICAgICAgICAgICAgICAg
ICAgICBzd2l0Y2ggKCBwY2lfY29uZl9yZWFkOCgwLCBiLCBQQ0lfU0xPVChkZiksCi0gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lfRlVOQyhkZiksCi0g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lfSEVBREVS
X1RZUEUpICkKKyAgICAgICAgICAgICAgICAgICAgeworICAgICAgICAgICAgICAgICAgICAgICAg
Y29uc3QgcGNpX3NiZGZfdCBzYmRmID0geworICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5i
dXMgPSBiLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5leHRmdW5jID0gZGYsCisgICAg
ICAgICAgICAgICAgICAgICAgICB9OworCisgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2gg
KCBwY2lfY29uZl9yZWFkOChzYmRmLCBQQ0lfSEVBREVSX1RZUEUpICkKICAgICAgICAgICAgICAg
ICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgUENJX0hFQURFUl9UWVBF
X0JSSURHRToKICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgUENJX0hFQURFUl9UWVBFX0NB
UkRCVVM6Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBwY2lfY29uZl9yZWFkMTYo
MCwgYiwgUENJX1NMT1QoZGYpLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIFBDSV9GVU5DKGRmKSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBQQ0lfQlJJREdFX0NPTlRST0wpICYKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBpZiAoIHBjaV9jb25mX3JlYWQxNihzYmRmLCBQQ0lfQlJJREdFX0NPTlRS
T0wpICYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9CUklER0VfQ1RMX1ZH
QSApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg
ICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgIH0KKyAgICAg
ICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg
ICAgICB9CiAgICAgICAgICAgICAgICAgaWYgKCAhYiApCmRpZmYgLS1naXQgYS94ZW4vZHJpdmVy
cy92cGNpL2hlYWRlci5jIGIveGVuL2RyaXZlcnMvdnBjaS9oZWFkZXIuYwppbmRleCA3NGQ3MGE0
Mjc4Li5kNjkzYjEzNzZjIDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy92cGNpL2hlYWRlci5jCisr
KyBiL3hlbi9kcml2ZXJzL3ZwY2kvaGVhZGVyLmMKQEAgLTExMiw4ICsxMTIsNyBAQCBzdGF0aWMg
dm9pZCBtb2RpZnlfZGVjb2RpbmcoY29uc3Qgc3RydWN0IHBjaV9kZXYgKnBkZXYsIHVpbnQxNl90
IGNtZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChtYXAgPyBQQ0lfUk9NX0FERFJFU1Nf
RU5BQkxFIDogMCk7CiAKICAgICAgICAgICAgIGhlYWRlci0+YmFyc1tpXS5lbmFibGVkID0gaGVh
ZGVyLT5yb21fZW5hYmxlZCA9IG1hcDsKLSAgICAgICAgICAgIHBjaV9jb25mX3dyaXRlMzIocGRl
di0+c2JkZi5zZWcsIHBkZXYtPnNiZGYuYnVzLCBwZGV2LT5zYmRmLmRldiwKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgcGRldi0+c2JkZi5mdW5jLCByb21fcG9zLCB2YWwpOworICAgICAg
ICAgICAgcGNpX2NvbmZfd3JpdGUzMihwZGV2LT5zYmRmLCByb21fcG9zLCB2YWwpOwogICAgICAg
ICAgICAgcmV0dXJuOwogICAgICAgICB9CiAKQEAgLTEyMyw4ICsxMjIsNyBAQCBzdGF0aWMgdm9p
ZCBtb2RpZnlfZGVjb2RpbmcoY29uc3Qgc3RydWN0IHBjaV9kZXYgKnBkZXYsIHVpbnQxNl90IGNt
ZCwKICAgICB9CiAKICAgICBpZiAoICFyb21fb25seSApCi0gICAgICAgIHBjaV9jb25mX3dyaXRl
MTYocGRldi0+c2JkZi5zZWcsIHBkZXYtPnNiZGYuYnVzLCBwZGV2LT5zYmRmLmRldiwKLSAgICAg
ICAgICAgICAgICAgICAgICAgICBwZGV2LT5zYmRmLmZ1bmMsIFBDSV9DT01NQU5ELCBjbWQpOwor
ICAgICAgICBwY2lfY29uZl93cml0ZTE2KHBkZXYtPnNiZGYsIFBDSV9DT01NQU5ELCBjbWQpOwog
ICAgIGVsc2UKICAgICAgICAgQVNTRVJUX1VOUkVBQ0hBQkxFKCk7CiB9CkBAIC0zMzUsOSArMzMz
LDcgQEAgc3RhdGljIGludCBtb2RpZnlfYmFycyhjb25zdCBzdHJ1Y3QgcGNpX2RldiAqcGRldiwg
dWludDE2X3QgY21kLCBib29sIHJvbV9vbmx5KQogc3RhdGljIHZvaWQgY21kX3dyaXRlKGNvbnN0
IHN0cnVjdCBwY2lfZGV2ICpwZGV2LCB1bnNpZ25lZCBpbnQgcmVnLAogICAgICAgICAgICAgICAg
ICAgICAgIHVpbnQzMl90IGNtZCwgdm9pZCAqZGF0YSkKIHsKLSAgICB1aW50MTZfdCBjdXJyZW50
X2NtZCA9IHBjaV9jb25mX3JlYWQxNihwZGV2LT5zYmRmLnNlZywgcGRldi0+c2JkZi5idXMsCi0g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGRldi0+c2JkZi5kZXYs
IHBkZXYtPnNiZGYuZnVuYywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICByZWcpOworICAgIHVpbnQxNl90IGN1cnJlbnRfY21kID0gcGNpX2NvbmZfcmVhZDE2KHBk
ZXYtPnNiZGYsIHJlZyk7CiAKICAgICAvKgogICAgICAqIExldCBEb20wIHBsYXkgd2l0aCBhbGwg
dGhlIGJpdHMgZGlyZWN0bHkgZXhjZXB0IGZvciB0aGUgbWVtb3J5CkBAIC0zNTIsOCArMzQ4LDcg
QEAgc3RhdGljIHZvaWQgY21kX3dyaXRlKGNvbnN0IHN0cnVjdCBwY2lfZGV2ICpwZGV2LCB1bnNp
Z25lZCBpbnQgcmVnLAogICAgICAgICAgKi8KICAgICAgICAgbW9kaWZ5X2JhcnMocGRldiwgY21k
LCBmYWxzZSk7CiAgICAgZWxzZQotICAgICAgICBwY2lfY29uZl93cml0ZTE2KHBkZXYtPnNiZGYu
c2VnLCBwZGV2LT5zYmRmLmJ1cywgcGRldi0+c2JkZi5kZXYsCi0gICAgICAgICAgICAgICAgICAg
ICAgICAgcGRldi0+c2JkZi5mdW5jLCByZWcsIGNtZCk7CisgICAgICAgIHBjaV9jb25mX3dyaXRl
MTYocGRldi0+c2JkZiwgcmVnLCBjbWQpOwogfQogCiBzdGF0aWMgdm9pZCBiYXJfd3JpdGUoY29u
c3Qgc3RydWN0IHBjaV9kZXYgKnBkZXYsIHVuc2lnbmVkIGludCByZWcsCkBAIC0zNzEsOCArMzY2
LDcgQEAgc3RhdGljIHZvaWQgYmFyX3dyaXRlKGNvbnN0IHN0cnVjdCBwY2lfZGV2ICpwZGV2LCB1
bnNpZ25lZCBpbnQgcmVnLAogICAgIGVsc2UKICAgICAgICAgdmFsICY9IFBDSV9CQVNFX0FERFJF
U1NfTUVNX01BU0s7CiAKLSAgICBpZiAoIHBjaV9jb25mX3JlYWQxNihwZGV2LT5zYmRmLnNlZywg
cGRldi0+c2JkZi5idXMsIHBkZXYtPnNiZGYuZGV2LAotICAgICAgICAgICAgICAgICAgICAgICAg
IHBkZXYtPnNiZGYuZnVuYywgUENJX0NPTU1BTkQpICYgUENJX0NPTU1BTkRfTUVNT1JZICkKKyAg
ICBpZiAoIHBjaV9jb25mX3JlYWQxNihwZGV2LT5zYmRmLCBQQ0lfQ09NTUFORCkgJiBQQ0lfQ09N
TUFORF9NRU1PUlkgKQogICAgIHsKICAgICAgICAgLyogSWYgdGhlIHZhbHVlIHdyaXR0ZW4gaXMg
dGhlIGN1cnJlbnQgb25lIGF2b2lkIHByaW50aW5nIGEgd2FybmluZy4gKi8KICAgICAgICAgaWYg
KCB2YWwgIT0gKHVpbnQzMl90KShiYXItPmFkZHIgPj4gKGhpID8gMzIgOiAwKSkgKQpAQCAtMzk5
LDggKzM5Myw3IEBAIHN0YXRpYyB2b2lkIGJhcl93cml0ZShjb25zdCBzdHJ1Y3QgcGNpX2RldiAq
cGRldiwgdW5zaWduZWQgaW50IHJlZywKICAgICAgICAgdmFsIHw9IGJhci0+cHJlZmV0Y2hhYmxl
ID8gUENJX0JBU0VfQUREUkVTU19NRU1fUFJFRkVUQ0ggOiAwOwogICAgIH0KIAotICAgIHBjaV9j
b25mX3dyaXRlMzIocGRldi0+c2JkZi5zZWcsIHBkZXYtPnNiZGYuYnVzLCBwZGV2LT5zYmRmLmRl
diwKLSAgICAgICAgICAgICAgICAgICAgIHBkZXYtPnNiZGYuZnVuYywgcmVnLCB2YWwpOworICAg
IHBjaV9jb25mX3dyaXRlMzIocGRldi0+c2JkZiwgcmVnLCB2YWwpOwogfQogCiBzdGF0aWMgdm9p
ZCByb21fd3JpdGUoY29uc3Qgc3RydWN0IHBjaV9kZXYgKnBkZXYsIHVuc2lnbmVkIGludCByZWcs
CkBAIC00MDgsOSArNDAxLDcgQEAgc3RhdGljIHZvaWQgcm9tX3dyaXRlKGNvbnN0IHN0cnVjdCBw
Y2lfZGV2ICpwZGV2LCB1bnNpZ25lZCBpbnQgcmVnLAogewogICAgIHN0cnVjdCB2cGNpX2hlYWRl
ciAqaGVhZGVyID0gJnBkZXYtPnZwY2ktPmhlYWRlcjsKICAgICBzdHJ1Y3QgdnBjaV9iYXIgKnJv
bSA9IGRhdGE7Ci0gICAgdWludDE2X3QgY21kID0gcGNpX2NvbmZfcmVhZDE2KHBkZXYtPnNiZGYu
c2VnLCBwZGV2LT5zYmRmLmJ1cywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
cGRldi0+c2JkZi5kZXYsIHBkZXYtPnNiZGYuZnVuYywKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgUENJX0NPTU1BTkQpOworICAgIHVpbnQxNl90IGNtZCA9IHBjaV9jb25mX3Jl
YWQxNihwZGV2LT5zYmRmLCBQQ0lfQ09NTUFORCk7CiAgICAgYm9vbCBuZXdfZW5hYmxlZCA9IHZh
bCAmIFBDSV9ST01fQUREUkVTU19FTkFCTEU7CiAKICAgICBpZiAoIChjbWQgJiBQQ0lfQ09NTUFO
RF9NRU1PUlkpICYmIGhlYWRlci0+cm9tX2VuYWJsZWQgJiYgbmV3X2VuYWJsZWQgKQpAQCAtNDMz
LDggKzQyNCw3IEBAIHN0YXRpYyB2b2lkIHJvbV93cml0ZShjb25zdCBzdHJ1Y3QgcGNpX2RldiAq
cGRldiwgdW5zaWduZWQgaW50IHJlZywKICAgICB7CiAgICAgICAgIC8qIEp1c3QgdXBkYXRlIHRo
ZSBST00gQkFSIGZpZWxkLiAqLwogICAgICAgICBoZWFkZXItPnJvbV9lbmFibGVkID0gbmV3X2Vu
YWJsZWQ7Ci0gICAgICAgIHBjaV9jb25mX3dyaXRlMzIocGRldi0+c2JkZi5zZWcsIHBkZXYtPnNi
ZGYuYnVzLCBwZGV2LT5zYmRmLmRldiwKLSAgICAgICAgICAgICAgICAgICAgICAgICBwZGV2LT5z
YmRmLmZ1bmMsIHJlZywgdmFsKTsKKyAgICAgICAgcGNpX2NvbmZfd3JpdGUzMihwZGV2LT5zYmRm
LCByZWcsIHZhbCk7CiAgICAgfQogICAgIC8qCiAgICAgICogUGFzcyBQQ0lfQ09NTUFORF9NRU1P
Ulkgb3IgMCB0byBzaWduYWwgYSBtYXAvdW5tYXAgcmVxdWVzdCwgbm90ZSB0aGF0CkBAIC00NjQs
OCArNDU0LDcgQEAgc3RhdGljIGludCBpbml0X2JhcnMoc3RydWN0IHBjaV9kZXYgKnBkZXYpCiAg
ICAgc3RydWN0IHZwY2lfYmFyICpiYXJzID0gaGVhZGVyLT5iYXJzOwogICAgIGludCByYzsKIAot
ICAgIHN3aXRjaCAoIHBjaV9jb25mX3JlYWQ4KHBkZXYtPnNiZGYuc2VnLCBwZGV2LT5zYmRmLmJ1
cywgcGRldi0+c2JkZi5kZXYsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGRldi0+c2Jk
Zi5mdW5jLCBQQ0lfSEVBREVSX1RZUEUpICYgMHg3ZiApCisgICAgc3dpdGNoICggcGNpX2NvbmZf
cmVhZDgocGRldi0+c2JkZiwgUENJX0hFQURFUl9UWVBFKSAmIDB4N2YgKQogICAgIHsKICAgICBj
YXNlIFBDSV9IRUFERVJfVFlQRV9OT1JNQUw6CiAgICAgICAgIG51bV9iYXJzID0gUENJX0hFQURF
Ul9OT1JNQUxfTlJfQkFSUzsKQEAgLTQ5MSwxMiArNDgwLDkgQEAgc3RhdGljIGludCBpbml0X2Jh
cnMoc3RydWN0IHBjaV9kZXYgKnBkZXYpCiAgICAgICAgIHJldHVybiAwOwogCiAgICAgLyogRGlz
YWJsZSBtZW1vcnkgZGVjb2RpbmcgYmVmb3JlIHNpemluZy4gKi8KLSAgICBjbWQgPSBwY2lfY29u
Zl9yZWFkMTYocGRldi0+c2JkZi5zZWcsIHBkZXYtPnNiZGYuYnVzLCBwZGV2LT5zYmRmLmRldiwK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgcGRldi0+c2JkZi5mdW5jLCBQQ0lfQ09NTUFORCk7
CisgICAgY21kID0gcGNpX2NvbmZfcmVhZDE2KHBkZXYtPnNiZGYsIFBDSV9DT01NQU5EKTsKICAg
ICBpZiAoIGNtZCAmIFBDSV9DT01NQU5EX01FTU9SWSApCi0gICAgICAgIHBjaV9jb25mX3dyaXRl
MTYocGRldi0+c2JkZi5zZWcsIHBkZXYtPnNiZGYuYnVzLCBwZGV2LT5zYmRmLmRldiwKLSAgICAg
ICAgICAgICAgICAgICAgICAgICBwZGV2LT5zYmRmLmZ1bmMsIFBDSV9DT01NQU5ELAotICAgICAg
ICAgICAgICAgICAgICAgICAgIGNtZCAmIH5QQ0lfQ09NTUFORF9NRU1PUlkpOworICAgICAgICBw
Y2lfY29uZl93cml0ZTE2KHBkZXYtPnNiZGYsIFBDSV9DT01NQU5ELCBjbWQgJiB+UENJX0NPTU1B
TkRfTUVNT1JZKTsKIAogICAgIGZvciAoIGkgPSAwOyBpIDwgbnVtX2JhcnM7IGkrKyApCiAgICAg
ewpAQCAtNTEwLDE2ICs0OTYsMTQgQEAgc3RhdGljIGludCBpbml0X2JhcnMoc3RydWN0IHBjaV9k
ZXYgKnBkZXYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDQsICZiYXJzW2ld
KTsKICAgICAgICAgICAgIGlmICggcmMgKQogICAgICAgICAgICAgewotICAgICAgICAgICAgICAg
IHBjaV9jb25mX3dyaXRlMTYocGRldi0+c2JkZi5zZWcsIHBkZXYtPnNiZGYuYnVzLCBwZGV2LT5z
YmRmLmRldiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBkZXYtPnNiZGYuZnVu
YywgUENJX0NPTU1BTkQsIGNtZCk7CisgICAgICAgICAgICAgICAgcGNpX2NvbmZfd3JpdGUxNihw
ZGV2LT5zYmRmLCBQQ0lfQ09NTUFORCwgY21kKTsKICAgICAgICAgICAgICAgICByZXR1cm4gcmM7
CiAgICAgICAgICAgICB9CiAKICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICB9CiAKLSAg
ICAgICAgdmFsID0gcGNpX2NvbmZfcmVhZDMyKHBkZXYtPnNiZGYuc2VnLCBwZGV2LT5zYmRmLmJ1
cywgcGRldi0+c2JkZi5kZXYsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZGV2LT5z
YmRmLmZ1bmMsIHJlZyk7CisgICAgICAgIHZhbCA9IHBjaV9jb25mX3JlYWQzMihwZGV2LT5zYmRm
LCByZWcpOwogICAgICAgICBpZiAoICh2YWwgJiBQQ0lfQkFTRV9BRERSRVNTX1NQQUNFKSA9PSBQ
Q0lfQkFTRV9BRERSRVNTX1NQQUNFX0lPICkKICAgICAgICAgewogICAgICAgICAgICAgYmFyc1tp
XS50eXBlID0gVlBDSV9CQVJfSU87CkBAIC01MzUsOCArNTE5LDcgQEAgc3RhdGljIGludCBpbml0
X2JhcnMoc3RydWN0IHBjaV9kZXYgKnBkZXYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAoaSA9PSBudW1fYmFycyAtIDEpID8gUENJX0JBUl9MQVNUIDogMCk7CiAgICAgICAgIGlmICgg
cmMgPCAwICkKICAgICAgICAgewotICAgICAgICAgICAgcGNpX2NvbmZfd3JpdGUxNihwZGV2LT5z
YmRmLnNlZywgcGRldi0+c2JkZi5idXMsIHBkZXYtPnNiZGYuZGV2LAotICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBwZGV2LT5zYmRmLmZ1bmMsIFBDSV9DT01NQU5ELCBjbWQpOworICAgICAg
ICAgICAgcGNpX2NvbmZfd3JpdGUxNihwZGV2LT5zYmRmLCBQQ0lfQ09NTUFORCwgY21kKTsKICAg
ICAgICAgICAgIHJldHVybiByYzsKICAgICAgICAgfQogCkBAIC01NTQsOCArNTM3LDcgQEAgc3Rh
dGljIGludCBpbml0X2JhcnMoc3RydWN0IHBjaV9kZXYgKnBkZXYpCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgJmJhcnNbaV0pOwogICAgICAgICBpZiAoIHJjICkKICAgICAgICAgewot
ICAgICAgICAgICAgcGNpX2NvbmZfd3JpdGUxNihwZGV2LT5zYmRmLnNlZywgcGRldi0+c2JkZi5i
dXMsIHBkZXYtPnNiZGYuZGV2LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZGV2LT5z
YmRmLmZ1bmMsIFBDSV9DT01NQU5ELCBjbWQpOworICAgICAgICAgICAgcGNpX2NvbmZfd3JpdGUx
NihwZGV2LT5zYmRmLCBQQ0lfQ09NTUFORCwgY21kKTsKICAgICAgICAgICAgIHJldHVybiByYzsK
ICAgICAgICAgfQogICAgIH0KQEAgLTU2OSw5ICs1NTEsOCBAQCBzdGF0aWMgaW50IGluaXRfYmFy
cyhzdHJ1Y3QgcGNpX2RldiAqcGRldikKICAgICAgICAgcm9tLT50eXBlID0gVlBDSV9CQVJfUk9N
OwogICAgICAgICByb20tPnNpemUgPSBzaXplOwogICAgICAgICByb20tPmFkZHIgPSBhZGRyOwot
ICAgICAgICBoZWFkZXItPnJvbV9lbmFibGVkID0gcGNpX2NvbmZfcmVhZDMyKHBkZXYtPnNiZGYu
c2VnLCBwZGV2LT5zYmRmLmJ1cywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBwZGV2LT5zYmRmLmRldiwgcGRldi0+c2JkZi5mdW5jLAotICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvbV9yZWcpICYgUENJX1JPTV9BRERS
RVNTX0VOQUJMRTsKKyAgICAgICAgaGVhZGVyLT5yb21fZW5hYmxlZCA9IHBjaV9jb25mX3JlYWQz
MihwZGV2LT5zYmRmLCByb21fcmVnKSAmCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQ
Q0lfUk9NX0FERFJFU1NfRU5BQkxFOwogCiAgICAgICAgIHJjID0gdnBjaV9hZGRfcmVnaXN0ZXIo
cGRldi0+dnBjaSwgdnBjaV9od19yZWFkMzIsIHJvbV93cml0ZSwgcm9tX3JlZywKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICA0LCByb20pOwpkaWZmIC0tZ2l0IGEveGVuL2RyaXZlcnMv
dnBjaS9tc2kuYyBiL3hlbi9kcml2ZXJzL3ZwY2kvbXNpLmMKaW5kZXggZGZjODk0ZGNjNi4uNGYy
ZTU1ZjNmZCAxMDA2NDQKLS0tIGEveGVuL2RyaXZlcnMvdnBjaS9tc2kuYworKysgYi94ZW4vZHJp
dmVycy92cGNpL21zaS5jCkBAIC03Nyw4ICs3Nyw3IEBAIHN0YXRpYyB2b2lkIGNvbnRyb2xfd3Jp
dGUoY29uc3Qgc3RydWN0IHBjaV9kZXYgKnBkZXYsIHVuc2lnbmVkIGludCByZWcsCiAgICAgbXNp
LT52ZWN0b3JzID0gdmVjdG9yczsKICAgICBtc2ktPmVuYWJsZWQgPSBuZXdfZW5hYmxlZDsKIAot
ICAgIHBjaV9jb25mX3dyaXRlMTYocGRldi0+c2JkZi5zZWcsIHBkZXYtPnNiZGYuYnVzLCBwZGV2
LT5zYmRmLmRldiwKLSAgICAgICAgICAgICAgICAgICAgIHBkZXYtPnNiZGYuZnVuYywgcmVnLCBj
b250cm9sX3JlYWQocGRldiwgcmVnLCBkYXRhKSk7CisgICAgcGNpX2NvbmZfd3JpdGUxNihwZGV2
LT5zYmRmLCByZWcsIGNvbnRyb2xfcmVhZChwZGV2LCByZWcsIGRhdGEpKTsKIH0KIAogc3RhdGlj
IHZvaWQgdXBkYXRlX21zaShjb25zdCBzdHJ1Y3QgcGNpX2RldiAqcGRldiwgc3RydWN0IHZwY2lf
bXNpICptc2kpCkBAIC0yMTAsOCArMjA5LDcgQEAgc3RhdGljIGludCBpbml0X21zaShzdHJ1Y3Qg
cGNpX2RldiAqcGRldikKICAgICAgICAgcmV0dXJuIHJldDsKIAogICAgIC8qIEdldCB0aGUgbWF4
aW11bSBudW1iZXIgb2YgdmVjdG9ycyB0aGUgZGV2aWNlIHN1cHBvcnRzLiAqLwotICAgIGNvbnRy
b2wgPSBwY2lfY29uZl9yZWFkMTYocGRldi0+c2JkZi5zZWcsIHBkZXYtPnNiZGYuYnVzLCBwZGV2
LT5zYmRmLmRldiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBkZXYtPnNiZGYuZnVu
YywgbXNpX2NvbnRyb2xfcmVnKHBvcykpOworICAgIGNvbnRyb2wgPSBwY2lfY29uZl9yZWFkMTYo
cGRldi0+c2JkZiwgbXNpX2NvbnRyb2xfcmVnKHBvcykpOwogCiAgICAgLyoKICAgICAgKiBGSVhN
RTogSSd2ZSBvbmx5IGJlZW4gYWJsZSB0byB0ZXN0IHRoaXMgY29kZSB3aXRoIGRldmljZXMgdXNp
bmcgYSBzaW5nbGUKZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL3ZwY2kvbXNpeC5jIGIveGVuL2Ry
aXZlcnMvdnBjaS9tc2l4LmMKaW5kZXggMDQ0MzE3MTVmNS4uNDdkNTY5MTIxZiAxMDA2NDQKLS0t
IGEveGVuL2RyaXZlcnMvdnBjaS9tc2l4LmMKKysrIGIveGVuL2RyaXZlcnMvdnBjaS9tc2l4LmMK
QEAgLTE0Nyw4ICsxNDcsNyBAQCBzdGF0aWMgdm9pZCBjb250cm9sX3dyaXRlKGNvbnN0IHN0cnVj
dCBwY2lfZGV2ICpwZGV2LCB1bnNpZ25lZCBpbnQgcmVnLAogCiAgICAgdmFsID0gY29udHJvbF9y
ZWFkKHBkZXYsIHJlZywgZGF0YSk7CiAgICAgaWYgKCBwY2lfbXNpX2NvbmZfd3JpdGVfaW50ZXJj
ZXB0KG1zaXgtPnBkZXYsIHJlZywgMiwgJnZhbCkgPj0gMCApCi0gICAgICAgIHBjaV9jb25mX3dy
aXRlMTYocGRldi0+c2JkZi5zZWcsIHBkZXYtPnNiZGYuYnVzLCBwZGV2LT5zYmRmLmRldiwKLSAg
ICAgICAgICAgICAgICAgICAgICAgICBwZGV2LT5zYmRmLmZ1bmMsIHJlZywgdmFsKTsKKyAgICAg
ICAgcGNpX2NvbmZfd3JpdGUxNihwZGV2LT5zYmRmLCByZWcsIHZhbCk7CiB9CiAKIHN0YXRpYyBz
dHJ1Y3QgdnBjaV9tc2l4ICptc2l4X2ZpbmQoY29uc3Qgc3RydWN0IGRvbWFpbiAqZCwgdW5zaWdu
ZWQgbG9uZyBhZGRyKQpAQCAtNDU5LDggKzQ1OCw3IEBAIHN0YXRpYyBpbnQgaW5pdF9tc2l4KHN0
cnVjdCBwY2lfZGV2ICpwZGV2KQogICAgIGlmICggIW1zaXhfb2Zmc2V0ICkKICAgICAgICAgcmV0
dXJuIDA7CiAKLSAgICBjb250cm9sID0gcGNpX2NvbmZfcmVhZDE2KHBkZXYtPnNiZGYuc2VnLCBw
ZGV2LT5zYmRmLmJ1cywgcGRldi0+c2JkZi5kZXYsCi0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBwZGV2LT5zYmRmLmZ1bmMsIG1zaXhfY29udHJvbF9yZWcobXNpeF9vZmZzZXQpKTsKKyAg
ICBjb250cm9sID0gcGNpX2NvbmZfcmVhZDE2KHBkZXYtPnNiZGYsIG1zaXhfY29udHJvbF9yZWco
bXNpeF9vZmZzZXQpKTsKIAogICAgIG1heF9lbnRyaWVzID0gbXNpeF90YWJsZV9zaXplKGNvbnRy
b2wpOwogCkBAIC00NzIsMTEgKzQ3MCw5IEBAIHN0YXRpYyBpbnQgaW5pdF9tc2l4KHN0cnVjdCBw
Y2lfZGV2ICpwZGV2KQogICAgIHBkZXYtPnZwY2ktPm1zaXgtPnBkZXYgPSBwZGV2OwogCiAgICAg
cGRldi0+dnBjaS0+bXNpeC0+dGFibGVzW1ZQQ0lfTVNJWF9UQUJMRV0gPQotICAgICAgICBwY2lf
Y29uZl9yZWFkMzIocGRldi0+c2JkZi5zZWcsIHBkZXYtPnNiZGYuYnVzLCBwZGV2LT5zYmRmLmRl
diwKLSAgICAgICAgICAgICAgICAgICAgICAgIHBkZXYtPnNiZGYuZnVuYywgbXNpeF90YWJsZV9v
ZmZzZXRfcmVnKG1zaXhfb2Zmc2V0KSk7CisgICAgICAgIHBjaV9jb25mX3JlYWQzMihwZGV2LT5z
YmRmLCBtc2l4X3RhYmxlX29mZnNldF9yZWcobXNpeF9vZmZzZXQpKTsKICAgICBwZGV2LT52cGNp
LT5tc2l4LT50YWJsZXNbVlBDSV9NU0lYX1BCQV0gPQotICAgICAgICBwY2lfY29uZl9yZWFkMzIo
cGRldi0+c2JkZi5zZWcsIHBkZXYtPnNiZGYuYnVzLCBwZGV2LT5zYmRmLmRldiwKLSAgICAgICAg
ICAgICAgICAgICAgICAgIHBkZXYtPnNiZGYuZnVuYywgbXNpeF9wYmFfb2Zmc2V0X3JlZyhtc2l4
X29mZnNldCkpOworICAgICAgICBwY2lfY29uZl9yZWFkMzIocGRldi0+c2JkZiwgbXNpeF9wYmFf
b2Zmc2V0X3JlZyhtc2l4X29mZnNldCkpOwogCiAgICAgZm9yICggaSA9IDA7IGkgPCBwZGV2LT52
cGNpLT5tc2l4LT5tYXhfZW50cmllczsgaSsrKQogICAgIHsKZGlmZiAtLWdpdCBhL3hlbi9kcml2
ZXJzL3ZwY2kvdnBjaS5jIGIveGVuL2RyaXZlcnMvdnBjaS92cGNpLmMKaW5kZXggOWEwNjBjMTA4
ZS4uYWZlMGMzODM5NiAxMDA2NDQKLS0tIGEveGVuL2RyaXZlcnMvdnBjaS92cGNpLmMKKysrIGIv
eGVuL2RyaXZlcnMvdnBjaS92cGNpLmMKQEAgLTExNCwxNSArMTE0LDEzIEBAIHN0YXRpYyB2b2lk
IHZwY2lfaWdub3JlZF93cml0ZShjb25zdCBzdHJ1Y3QgcGNpX2RldiAqcGRldiwgdW5zaWduZWQg
aW50IHJlZywKIHVpbnQzMl90IHZwY2lfaHdfcmVhZDE2KGNvbnN0IHN0cnVjdCBwY2lfZGV2ICpw
ZGV2LCB1bnNpZ25lZCBpbnQgcmVnLAogICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqZGF0
YSkKIHsKLSAgICByZXR1cm4gcGNpX2NvbmZfcmVhZDE2KHBkZXYtPnNiZGYuc2VnLCBwZGV2LT5z
YmRmLmJ1cywgcGRldi0+c2JkZi5kZXYsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICBwZGV2
LT5zYmRmLmZ1bmMsIHJlZyk7CisgICAgcmV0dXJuIHBjaV9jb25mX3JlYWQxNihwZGV2LT5zYmRm
LCByZWcpOwogfQogCiB1aW50MzJfdCB2cGNpX2h3X3JlYWQzMihjb25zdCBzdHJ1Y3QgcGNpX2Rl
diAqcGRldiwgdW5zaWduZWQgaW50IHJlZywKICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQg
KmRhdGEpCiB7Ci0gICAgcmV0dXJuIHBjaV9jb25mX3JlYWQzMihwZGV2LT5zYmRmLnNlZywgcGRl
di0+c2JkZi5idXMsIHBkZXYtPnNiZGYuZGV2LAotICAgICAgICAgICAgICAgICAgICAgICAgICAg
cGRldi0+c2JkZi5mdW5jLCByZWcpOworICAgIHJldHVybiBwY2lfY29uZl9yZWFkMzIocGRldi0+
c2JkZiwgcmVnKTsKIH0KIAogaW50IHZwY2lfYWRkX3JlZ2lzdGVyKHN0cnVjdCB2cGNpICp2cGNp
LCB2cGNpX3JlYWRfdCAqcmVhZF9oYW5kbGVyLApAQCAtMjEyLDcgKzIxMCw3IEBAIHN0YXRpYyB1
aW50MzJfdCB2cGNpX3JlYWRfaHcocGNpX3NiZGZfdCBzYmRmLCB1bnNpZ25lZCBpbnQgcmVnLAog
ICAgIHN3aXRjaCAoIHNpemUgKQogICAgIHsKICAgICBjYXNlIDQ6Ci0gICAgICAgIGRhdGEgPSBw
Y2lfY29uZl9yZWFkMzIoc2JkZi5zZWcsIHNiZGYuYnVzLCBzYmRmLmRldiwgc2JkZi5mdW5jLCBy
ZWcpOworICAgICAgICBkYXRhID0gcGNpX2NvbmZfcmVhZDMyKHNiZGYsIHJlZyk7CiAgICAgICAg
IGJyZWFrOwogCiAgICAgY2FzZSAzOgpAQCAtMjIyLDI2ICsyMjAsMjIgQEAgc3RhdGljIHVpbnQz
Ml90IHZwY2lfcmVhZF9odyhwY2lfc2JkZl90IHNiZGYsIHVuc2lnbmVkIGludCByZWcsCiAgICAg
ICAgICAqLwogICAgICAgICBpZiAoIHJlZyAmIDEgKQogICAgICAgICB7Ci0gICAgICAgICAgICBk
YXRhID0gcGNpX2NvbmZfcmVhZDgoc2JkZi5zZWcsIHNiZGYuYnVzLCBzYmRmLmRldiwgc2JkZi5m
dW5jLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZyk7Ci0gICAgICAgICAg
ICBkYXRhIHw9IHBjaV9jb25mX3JlYWQxNihzYmRmLnNlZywgc2JkZi5idXMsIHNiZGYuZGV2LCBz
YmRmLmZ1bmMsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWcgKyAxKSA8
PCA4OworICAgICAgICAgICAgZGF0YSA9IHBjaV9jb25mX3JlYWQ4KHNiZGYsIHJlZyk7CisgICAg
ICAgICAgICBkYXRhIHw9IHBjaV9jb25mX3JlYWQxNihzYmRmLCByZWcgKyAxKSA8PCA4OwogICAg
ICAgICB9CiAgICAgICAgIGVsc2UKICAgICAgICAgewotICAgICAgICAgICAgZGF0YSA9IHBjaV9j
b25mX3JlYWQxNihzYmRmLnNlZywgc2JkZi5idXMsIHNiZGYuZGV2LCBzYmRmLmZ1bmMsCi0gICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZyk7Ci0gICAgICAgICAgICBkYXRhIHw9
IHBjaV9jb25mX3JlYWQ4KHNiZGYuc2VnLCBzYmRmLmJ1cywgc2JkZi5kZXYsIHNiZGYuZnVuYywK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnICsgMikgPDwgMTY7CisgICAg
ICAgICAgICBkYXRhID0gcGNpX2NvbmZfcmVhZDE2KHNiZGYsIHJlZyk7CisgICAgICAgICAgICBk
YXRhIHw9IHBjaV9jb25mX3JlYWQ4KHNiZGYsIHJlZyArIDIpIDw8IDE2OwogICAgICAgICB9CiAg
ICAgICAgIGJyZWFrOwogCiAgICAgY2FzZSAyOgotICAgICAgICBkYXRhID0gcGNpX2NvbmZfcmVh
ZDE2KHNiZGYuc2VnLCBzYmRmLmJ1cywgc2JkZi5kZXYsIHNiZGYuZnVuYywgcmVnKTsKKyAgICAg
ICAgZGF0YSA9IHBjaV9jb25mX3JlYWQxNihzYmRmLCByZWcpOwogICAgICAgICBicmVhazsKIAog
ICAgIGNhc2UgMToKLSAgICAgICAgZGF0YSA9IHBjaV9jb25mX3JlYWQ4KHNiZGYuc2VnLCBzYmRm
LmJ1cywgc2JkZi5kZXYsIHNiZGYuZnVuYywgcmVnKTsKKyAgICAgICAgZGF0YSA9IHBjaV9jb25m
X3JlYWQ4KHNiZGYsIHJlZyk7CiAgICAgICAgIGJyZWFrOwogCiAgICAgZGVmYXVsdDoKQEAgLTI1
OSw3ICsyNTMsNyBAQCBzdGF0aWMgdm9pZCB2cGNpX3dyaXRlX2h3KHBjaV9zYmRmX3Qgc2JkZiwg
dW5zaWduZWQgaW50IHJlZywgdW5zaWduZWQgaW50IHNpemUsCiAgICAgc3dpdGNoICggc2l6ZSAp
CiAgICAgewogICAgIGNhc2UgNDoKLSAgICAgICAgcGNpX2NvbmZfd3JpdGUzMihzYmRmLnNlZywg
c2JkZi5idXMsIHNiZGYuZGV2LCBzYmRmLmZ1bmMsIHJlZywgZGF0YSk7CisgICAgICAgIHBjaV9j
b25mX3dyaXRlMzIoc2JkZiwgcmVnLCBkYXRhKTsKICAgICAgICAgYnJlYWs7CiAKICAgICBjYXNl
IDM6CkBAIC0yNjksMjYgKzI2MywyMiBAQCBzdGF0aWMgdm9pZCB2cGNpX3dyaXRlX2h3KHBjaV9z
YmRmX3Qgc2JkZiwgdW5zaWduZWQgaW50IHJlZywgdW5zaWduZWQgaW50IHNpemUsCiAgICAgICAg
ICAqLwogICAgICAgICBpZiAoIHJlZyAmIDEgKQogICAgICAgICB7Ci0gICAgICAgICAgICBwY2lf
Y29uZl93cml0ZTgoc2JkZi5zZWcsIHNiZGYuYnVzLCBzYmRmLmRldiwgc2JkZi5mdW5jLCByZWcs
Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSk7Ci0gICAgICAgICAgICBwY2lfY29u
Zl93cml0ZTE2KHNiZGYuc2VnLCBzYmRmLmJ1cywgc2JkZi5kZXYsIHNiZGYuZnVuYywgcmVnICsg
MSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA+PiA4KTsKKyAgICAgICAgICAg
IHBjaV9jb25mX3dyaXRlOChzYmRmLCByZWcsIGRhdGEpOworICAgICAgICAgICAgcGNpX2NvbmZf
d3JpdGUxNihzYmRmLCByZWcgKyAxLCBkYXRhID4+IDgpOwogICAgICAgICB9CiAgICAgICAgIGVs
c2UKICAgICAgICAgewotICAgICAgICAgICAgcGNpX2NvbmZfd3JpdGUxNihzYmRmLnNlZywgc2Jk
Zi5idXMsIHNiZGYuZGV2LCBzYmRmLmZ1bmMsIHJlZywKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgZGF0YSk7Ci0gICAgICAgICAgICBwY2lfY29uZl93cml0ZTgoc2JkZi5zZWcsIHNiZGYu
YnVzLCBzYmRmLmRldiwgc2JkZi5mdW5jLCByZWcgKyAyLAotICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGRhdGEgPj4gMTYpOworICAgICAgICAgICAgcGNpX2NvbmZfd3JpdGUxNihzYmRmLCBy
ZWcsIGRhdGEpOworICAgICAgICAgICAgcGNpX2NvbmZfd3JpdGU4KHNiZGYsIHJlZyArIDIsIGRh
dGEgPj4gMTYpOwogICAgICAgICB9CiAgICAgICAgIGJyZWFrOwogCiAgICAgY2FzZSAyOgotICAg
ICAgICBwY2lfY29uZl93cml0ZTE2KHNiZGYuc2VnLCBzYmRmLmJ1cywgc2JkZi5kZXYsIHNiZGYu
ZnVuYywgcmVnLCBkYXRhKTsKKyAgICAgICAgcGNpX2NvbmZfd3JpdGUxNihzYmRmLCByZWcsIGRh
dGEpOwogICAgICAgICBicmVhazsKIAogICAgIGNhc2UgMToKLSAgICAgICAgcGNpX2NvbmZfd3Jp
dGU4KHNiZGYuc2VnLCBzYmRmLmJ1cywgc2JkZi5kZXYsIHNiZGYuZnVuYywgcmVnLCBkYXRhKTsK
KyAgICAgICAgcGNpX2NvbmZfd3JpdGU4KHNiZGYsIHJlZywgZGF0YSk7CiAgICAgICAgIGJyZWFr
OwogCiAgICAgZGVmYXVsdDoKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL3hlbi9wY2kuaCBiL3hl
bi9pbmNsdWRlL3hlbi9wY2kuaAppbmRleCAxY2Y1NGViNDY2Li45OTA4ZDBmZTVkIDEwMDY0NAot
LS0gYS94ZW4vaW5jbHVkZS94ZW4vcGNpLmgKKysrIGIveGVuL2luY2x1ZGUveGVuL3BjaS5oCkBA
IC01OCw2ICs1OCwxMSBAQCB0eXBlZGVmIHVuaW9uIHsKICAgICB9OwogfSBwY2lfc2JkZl90Owog
CisjZGVmaW5lIFBDSV9TQkRGX1QocywgYiwgZCwgZikgXAorICAgICgocGNpX3NiZGZfdCkgeyAu
c2VnID0gKHMpLCAuYnVzID0gKGIpLCAuZGV2ID0gKGQpLCAuZnVuYyA9IChmKSB9KQorI2RlZmlu
ZSBQQ0lfU0JERjNfVChzLCBiLCBlKSBcCisgICAgKChwY2lfc2JkZl90KSB7IC5zZWcgPSAocyks
IC5idXMgPSAoYiksIC5leHRmdW5jID0gKGUpIH0pCisKIHN0cnVjdCBwY2lfZGV2X2luZm8gewog
ICAgIC8qCiAgICAgICogVkYncyAnaXNfZXh0Zm4nIGZpZWxkIGlzIHVzZWQgdG8gaW5kaWNhdGUg
d2hldGhlciBpdHMgUEYgaXMgYW4gZXh0ZW5kZWQKQEAgLTE1OSwyNCArMTY0LDEyIEBAIHN0cnVj
dCBwY2lfZGV2ICpwY2lfZ2V0X3BkZXZfYnlfZG9tYWluKGNvbnN0IHN0cnVjdCBkb21haW4gKiwg
aW50IHNlZywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBidXMs
IGludCBkZXZmbik7CiB2b2lkIHBjaV9jaGVja19kaXNhYmxlX2RldmljZSh1MTYgc2VnLCB1OCBi
dXMsIHU4IGRldmZuKTsKIAotdWludDhfdCBwY2lfY29uZl9yZWFkOCgKLSAgICB1bnNpZ25lZCBp
bnQgc2VnLCB1bnNpZ25lZCBpbnQgYnVzLCB1bnNpZ25lZCBpbnQgZGV2LCB1bnNpZ25lZCBpbnQg
ZnVuYywKLSAgICB1bnNpZ25lZCBpbnQgcmVnKTsKLXVpbnQxNl90IHBjaV9jb25mX3JlYWQxNigK
LSAgICB1bnNpZ25lZCBpbnQgc2VnLCB1bnNpZ25lZCBpbnQgYnVzLCB1bnNpZ25lZCBpbnQgZGV2
LCB1bnNpZ25lZCBpbnQgZnVuYywKLSAgICB1bnNpZ25lZCBpbnQgcmVnKTsKLXVpbnQzMl90IHBj
aV9jb25mX3JlYWQzMigKLSAgICB1bnNpZ25lZCBpbnQgc2VnLCB1bnNpZ25lZCBpbnQgYnVzLCB1
bnNpZ25lZCBpbnQgZGV2LCB1bnNpZ25lZCBpbnQgZnVuYywKLSAgICB1bnNpZ25lZCBpbnQgcmVn
KTsKLXZvaWQgcGNpX2NvbmZfd3JpdGU4KAotICAgIHVuc2lnbmVkIGludCBzZWcsIHVuc2lnbmVk
IGludCBidXMsIHVuc2lnbmVkIGludCBkZXYsIHVuc2lnbmVkIGludCBmdW5jLAotICAgIHVuc2ln
bmVkIGludCByZWcsIHVpbnQ4X3QgZGF0YSk7Ci12b2lkIHBjaV9jb25mX3dyaXRlMTYoCi0gICAg
dW5zaWduZWQgaW50IHNlZywgdW5zaWduZWQgaW50IGJ1cywgdW5zaWduZWQgaW50IGRldiwgdW5z
aWduZWQgaW50IGZ1bmMsCi0gICAgdW5zaWduZWQgaW50IHJlZywgdWludDE2X3QgZGF0YSk7Ci12
b2lkIHBjaV9jb25mX3dyaXRlMzIoCi0gICAgdW5zaWduZWQgaW50IHNlZywgdW5zaWduZWQgaW50
IGJ1cywgdW5zaWduZWQgaW50IGRldiwgdW5zaWduZWQgaW50IGZ1bmMsCi0gICAgdW5zaWduZWQg
aW50IHJlZywgdWludDMyX3QgZGF0YSk7Cit1aW50OF90IHBjaV9jb25mX3JlYWQ4KHBjaV9zYmRm
X3Qgc2JkZiwgdW5zaWduZWQgaW50IHJlZyk7Cit1aW50MTZfdCBwY2lfY29uZl9yZWFkMTYocGNp
X3NiZGZfdCBzYmRmLCB1bnNpZ25lZCBpbnQgcmVnKTsKK3VpbnQzMl90IHBjaV9jb25mX3JlYWQz
MihwY2lfc2JkZl90IHNiZGYsIHVuc2lnbmVkIGludCByZWcpOwordm9pZCBwY2lfY29uZl93cml0
ZTgocGNpX3NiZGZfdCBzYmRmLCB1bnNpZ25lZCBpbnQgcmVnLCB1aW50OF90IGRhdGEpOwordm9p
ZCBwY2lfY29uZl93cml0ZTE2KHBjaV9zYmRmX3Qgc2JkZiwgdW5zaWduZWQgaW50IHJlZywgdWlu
dDE2X3QgZGF0YSk7Cit2b2lkIHBjaV9jb25mX3dyaXRlMzIocGNpX3NiZGZfdCBzYmRmLCB1bnNp
Z25lZCBpbnQgcmVnLCB1aW50MzJfdCBkYXRhKTsKIHVpbnQzMl90IHBjaV9jb25mX3JlYWQodWlu
dDMyX3QgY2Y4LCB1aW50OF90IG9mZnNldCwgdWludDhfdCBieXRlcyk7CiB2b2lkIHBjaV9jb25m
X3dyaXRlKHVpbnQzMl90IGNmOCwgdWludDhfdCBvZmZzZXQsIHVpbnQ4X3QgYnl0ZXMsIHVpbnQz
Ml90IGRhdGEpOwogaW50IHBjaV9tbWNmZ19yZWFkKHVuc2lnbmVkIGludCBzZWcsIHVuc2lnbmVk
IGludCBidXMsCi0tIAoyLjE3LjIgKEFwcGxlIEdpdC0xMTMpCgoKX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4t
ZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9t
YWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

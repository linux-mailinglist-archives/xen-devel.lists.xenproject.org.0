Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 856C418EA2B
	for <lists+xen-devel@lfdr.de>; Sun, 22 Mar 2020 17:17:14 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1jG3Fk-00056B-OF; Sun, 22 Mar 2020 16:15:08 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=0EiK=5H=gmail.com=julien.grall.oss@srs-us1.protection.inumbo.net>)
 id 1jG3Fj-000548-8X
 for xen-devel@lists.xenproject.org; Sun, 22 Mar 2020 16:15:07 +0000
X-Inumbo-ID: 3ca8282e-6c58-11ea-8134-12813bfff9fa
Received: from mail-ed1-f66.google.com (unknown [209.85.208.66])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 3ca8282e-6c58-11ea-8134-12813bfff9fa;
 Sun, 22 Mar 2020 16:14:42 +0000 (UTC)
Received: by mail-ed1-f66.google.com with SMTP id a20so13525871edj.2
 for <xen-devel@lists.xenproject.org>; Sun, 22 Mar 2020 09:14:42 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=mApuAxVqoNL0AJrg7IhfRhEE4AAZrv5zScEqKjeYVHA=;
 b=SsEGYGhlr2+tOZz6l1Mq5xw2ENc6S5JPQBiJojDw5kYAP5UP63NDi8NdJPNDek5wB3
 OBa364Xy8lWHWxRz+JmZQ9sQe+6u5Lj/aDQQFzGzkspese+zMGLIPOTfvgtGOdEJR7bC
 ++u+L07wEbFfgXQVvCY3Ukrmw+vZSysJAiaivYewTYSOKaoNcwxONVysRiToQRv5lMex
 FVrrYuYHa++dtuAjWdTXB6IX00TAgfc83r9bUauHrp8wfdnHKWKr72t0ty0u/oqXEwMp
 YpeQUQCb+0mbJnTVENHz3ebwvD5f8JlcIJ3PgxtDlRrUVfmrRKxtYxB5jPwOqyYPkqas
 uodA==
X-Gm-Message-State: ANhLgQ3CFa2VuOrAkXbHty7/nuHKT41Pj/087MkBjkZINt5KmnA7reiq
 PQa8dZ0DQcA9W7h57rXRjLV++0Mgkd89FA==
X-Google-Smtp-Source: ADFU+vtviWxPf8i29iJJYhAPDo62/ZehU61jnW8XxgECDaObW9w42GVhESNCMnJUxNTYXWAVvYmG4A==
X-Received: by 2002:a50:e716:: with SMTP id a22mr17288833edn.358.1584893680855; 
 Sun, 22 Mar 2020 09:14:40 -0700 (PDT)
Received: from ufe34d9ed68d054.ant.amazon.com (54-240-197-235.amazon.com.
 [54.240.197.235])
 by smtp.gmail.com with ESMTPSA id v13sm106693edj.62.2020.03.22.09.14.39
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Sun, 22 Mar 2020 09:14:40 -0700 (PDT)
From: julien@xen.org
To: xen-devel@lists.xenproject.org
Date: Sun, 22 Mar 2020 16:14:17 +0000
Message-Id: <20200322161418.31606-17-julien@xen.org>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20200322161418.31606-1-julien@xen.org>
References: <20200322161418.31606-1-julien@xen.org>
Subject: [Xen-devel] [PATCH 16/17] xen/mm: Convert {s,
 g}et_gpfn_from_mfn() to use typesafe MFN
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Stefano Stabellini <sstabellini@kernel.org>, julien@xen.org,
 Wei Liu <wl@xen.org>, Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>,
 George Dunlap <george.dunlap@citrix.com>, Julien Grall <julien.grall@arm.com>,
 Tamas K Lengyel <tamas@tklengyel.com>, Jan Beulich <jbeulich@suse.com>,
 Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

RnJvbTogSnVsaWVuIEdyYWxsIDxqdWxpZW4uZ3JhbGxAYXJtLmNvbT4KClRoZSBmaXJzdCBwYXJh
bWV0ZXIgb2Yge3MsZ31ldF9ncGZuX2Zyb21fbWZuKCkgaXMgYW4gTUZOLCBzbyBpdCBjYW4gYmUK
c3dpdGNoZWQgdG8gdXNlIHRoZSB0eXBlc2FmZS4KCkF0IHRoZSBzYW1lIHRpbWUsIHJlcGxhY2Ug
Z3BmbiB3aXRoIHBmbiBpbiB0aGUgaGVscGVycyBhcyB0aGV5IGFsbCBkZWFsCndpdGggUEZOIGFu
ZCBhbHNvIHR1cm4gdGhlIG1hY3JvcyB0byBzdGF0aWMgaW5saW5lLgoKTm90ZSB0aGF0IHRoZSBy
ZXR1cm4gb2YgdGhlIGdldHRlciBhbmQgdGhlIDJuZCBwYXJhbWV0ZXIgb2YgdGhlIHNldHRlcgpo
YXZlIG5vdCBiZWVuIGNvbnZlcnRlZCB0byB1c2UgdHlwZXNhZmUgUEZOIGJlY2F1c2UgaXQgd2Fz
IHJlcXVpcmluZwptb3JlIGNoYW5nZXMgdGhhbiBleHBlY3RlZC4KClNpZ25lZC1vZmYtYnk6IEp1
bGllbiBHcmFsbCA8anVsaWVuLmdyYWxsQGFybS5jb20+CgotLS0KICAgIFRoaXMgd2FzIG9yaWdp
bmFsbHkgc2VudCBhcyBwYXJ0IG9mICJ4ZW4vYXJtOiBQcm9wZXJseSBkaXNhYmxlIE0yUAogICAg
b24gQXJtIiBbMV0uCgogICAgQ2hhbmdlcyBzaW5jZSB0aGUgb3JpZ2luYWwgdmVyc2lvbjoKICAg
ICAgICAtIG1mbl90b19nbWZuKCkgaXMgc3RpbGwgcHJlc2VudCBmb3Igbm93IHNvIHVwZGF0ZSBp
dAogICAgICAgIC0gUmVtb3ZlIHN0cmF5ICsKICAgICAgICAtIEF2b2lkIGNodXJuIGluIHNldF9w
Zm5fZnJvbV9tZm4oKSBieSBpbnZlcnRpbmcgbWZuIGFuZCBtZm5fCiAgICAgICAgLSBSZW1vdmUg
dGFncwogICAgICAgIC0gRml4IGJ1aWxkIGluIG1lbV9zaGFyaW5nCgogICAgWzFdIDwyMDE5MDYw
MzE2MDM1MC4yOTgwNi0xLWp1bGllbi5ncmFsbEBhcm0uY29tPgotLS0KIHhlbi9hcmNoL3g4Ni9j
cHUvbWNoZWNrL21jYWN0aW9uLmMgfCAgMiArLQogeGVuL2FyY2gveDg2L21tLmMgICAgICAgICAg
ICAgICAgICB8IDE0ICsrKy0tLS0KIHhlbi9hcmNoL3g4Ni9tbS9tZW1fc2hhcmluZy5jICAgICAg
fCAyMCArKysrLS0tLS0KIHhlbi9hcmNoL3g4Ni9tbS9wMm0tcG9kLmMgICAgICAgICAgfCAgNCAr
LQogeGVuL2FyY2gveDg2L21tL3AybS1wdC5jICAgICAgICAgICB8IDM1ICsrKysrKysrLS0tLS0t
LS0KIHhlbi9hcmNoL3g4Ni9tbS9wMm0uYyAgICAgICAgICAgICAgfCA2NiArKysrKysrKysrKysr
KystLS0tLS0tLS0tLS0tLS0KIHhlbi9hcmNoL3g4Ni9tbS9wYWdpbmcuYyAgICAgICAgICAgfCAg
NCArLQogeGVuL2FyY2gveDg2L3B2L2RvbTBfYnVpbGQuYyAgICAgICB8ICA2ICstLQogeGVuL2Fy
Y2gveDg2L3g4Nl82NC90cmFwcy5jICAgICAgICB8ICA4ICsrLS0KIHhlbi9jb21tb24vcGFnZV9h
bGxvYy5jICAgICAgICAgICAgfCAgMiArLQogeGVuL2luY2x1ZGUvYXNtLWFybS9tbS5oICAgICAg
ICAgICB8ICAyICstCiB4ZW4vaW5jbHVkZS9hc20teDg2L2dyYW50X3RhYmxlLmggIHwgIDIgKy0K
IHhlbi9pbmNsdWRlL2FzbS14ODYvbW0uaCAgICAgICAgICAgfCAxMiArKysrLS0KIHhlbi9pbmNs
dWRlL2FzbS14ODYvcDJtLmggICAgICAgICAgfCAgMiArLQogMTQgZmlsZXMgY2hhbmdlZCwgOTMg
aW5zZXJ0aW9ucygrKSwgODYgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2
L2NwdS9tY2hlY2svbWNhY3Rpb24uYyBiL3hlbi9hcmNoL3g4Ni9jcHUvbWNoZWNrL21jYWN0aW9u
LmMKaW5kZXggNjkzMzJmYjg0ZC4uNWU3OGZiNzcwMyAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2
L2NwdS9tY2hlY2svbWNhY3Rpb24uYworKysgYi94ZW4vYXJjaC94ODYvY3B1L21jaGVjay9tY2Fj
dGlvbi5jCkBAIC04OSw3ICs4OSw3IEBAIG1jX21lbWVycl9kaGFuZGxlcihzdHJ1Y3QgbWNhX2Jp
bmZvICpiaW5mbywKICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICBkID0gZ2V0X2RvbWFp
bl9ieV9pZChiYW5rLT5tY19kb21pZCk7CiAgICAgICAgICAgICAgICAgQVNTRVJUKGQpOwotICAg
ICAgICAgICAgICAgIGdmbiA9IGdldF9ncGZuX2Zyb21fbWZuKChiYW5rLT5tY19hZGRyKSA+PiBQ
QUdFX1NISUZUKTsKKyAgICAgICAgICAgICAgICBnZm4gPSBnZXRfcGZuX2Zyb21fbWZuKG1hZGRy
X3RvX21mbihiYW5rLT5tY19hZGRyKSk7CiAKICAgICAgICAgICAgICAgICBpZiAoIHVubW1hcF9i
cm9rZW5fcGFnZShkLCBtZm4sIGdmbikgKQogICAgICAgICAgICAgICAgIHsKZGlmZiAtLWdpdCBh
L3hlbi9hcmNoL3g4Ni9tbS5jIGIveGVuL2FyY2gveDg2L21tLmMKaW5kZXggMjUxNjU0OGU0OS4u
MmZlYjdhNTk5MyAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L21tLmMKKysrIGIveGVuL2FyY2gv
eDg2L21tLmMKQEAgLTQ3Niw3ICs0NzYsNyBAQCB2b2lkIHNoYXJlX3hlbl9wYWdlX3dpdGhfZ3Vl
c3Qoc3RydWN0IHBhZ2VfaW5mbyAqcGFnZSwgc3RydWN0IGRvbWFpbiAqZCwKICAgICBpZiAoIHBh
Z2VfZ2V0X293bmVyKHBhZ2UpID09IGQgKQogICAgICAgICByZXR1cm47CiAKLSAgICBzZXRfZ3Bm
bl9mcm9tX21mbihtZm5feChwYWdlX3RvX21mbihwYWdlKSksIElOVkFMSURfTTJQX0VOVFJZKTsK
KyAgICBzZXRfcGZuX2Zyb21fbWZuKHBhZ2VfdG9fbWZuKHBhZ2UpLCBJTlZBTElEX00yUF9FTlRS
WSk7CiAKICAgICBzcGluX2xvY2soJmQtPnBhZ2VfYWxsb2NfbG9jayk7CiAKQEAgLTEwNDAsNyAr
MTA0MCw3IEBAIGdldF9wYWdlX2Zyb21fbDFlKAogCiAgICAgICAgICAgICBnZHByaW50ayhYRU5M
T0dfV0FSTklORywgIkVycm9yIHVwZGF0aW5nIG1hcHBpbmdzIGZvciBtZm4gJSIgUFJJX21mbgog
ICAgICAgICAgICAgICAgICAgICAgIiAocGZuICUiIFBSSV9wZm4gIiwgZnJvbSBMMSBlbnRyeSAl
IiBQUklwdGUgIikgZm9yIGQlZFxuIiwKLSAgICAgICAgICAgICAgICAgICAgIG1mbiwgZ2V0X2dw
Zm5fZnJvbV9tZm4obWZuKSwKKyAgICAgICAgICAgICAgICAgICAgIG1mbiwgZ2V0X3Bmbl9mcm9t
X21mbihfbWZuKG1mbikpLAogICAgICAgICAgICAgICAgICAgICAgbDFlX2dldF9pbnRwdGUobDFl
KSwgbDFlX293bmVyLT5kb21haW5faWQpOwogICAgICAgICAgICAgcmV0dXJuIGVycjsKICAgICAg
ICAgfQpAQCAtMTA1MSw3ICsxMDUxLDcgQEAgZ2V0X3BhZ2VfZnJvbV9sMWUoCiAgY291bGRfbm90
X3BpbjoKICAgICBnZHByaW50ayhYRU5MT0dfV0FSTklORywgIkVycm9yIGdldHRpbmcgbWZuICUi
IFBSSV9tZm4gIiAocGZuICUiIFBSSV9wZm4KICAgICAgICAgICAgICAiKSBmcm9tIEwxIGVudHJ5
ICUiIFBSSXB0ZSAiIGZvciBsMWVfb3duZXIgZCVkLCBwZ19vd25lciBkJWRcbiIsCi0gICAgICAg
ICAgICAgbWZuLCBnZXRfZ3Bmbl9mcm9tX21mbihtZm4pLAorICAgICAgICAgICAgIG1mbiwgZ2V0
X3Bmbl9mcm9tX21mbihfbWZuKG1mbikpLAogICAgICAgICAgICAgIGwxZV9nZXRfaW50cHRlKGwx
ZSksIGwxZV9vd25lci0+ZG9tYWluX2lkLCBwZ19vd25lci0+ZG9tYWluX2lkKTsKICAgICBpZiAo
IHJlYWxfcGdfb3duZXIgIT0gTlVMTCApCiAgICAgICAgIHB1dF9wYWdlKHBhZ2UpOwpAQCAtMjYz
Niw3ICsyNjM2LDcgQEAgc3RhdGljIGludCB2YWxpZGF0ZV9wYWdlKHN0cnVjdCBwYWdlX2luZm8g
KnBhZ2UsIHVuc2lnbmVkIGxvbmcgdHlwZSwKICAgICAgICAgICAgICAgICAgIiAocGZuICUiIFBS
SV9wZm4gIikgZm9yIHR5cGUgJSIgUFJ0eXBlX2luZm8KICAgICAgICAgICAgICAgICAgIjogY2Fm
PSUwOGx4IHRhZj0lIiBQUnR5cGVfaW5mbyAiXG4iLAogICAgICAgICAgICAgICAgICBtZm5feChw
YWdlX3RvX21mbihwYWdlKSksCi0gICAgICAgICAgICAgICAgIGdldF9ncGZuX2Zyb21fbWZuKG1m
bl94KHBhZ2VfdG9fbWZuKHBhZ2UpKSksCisgICAgICAgICAgICAgICAgIGdldF9wZm5fZnJvbV9t
Zm4ocGFnZV90b19tZm4ocGFnZSkpLAogICAgICAgICAgICAgICAgICB0eXBlLCBwYWdlLT5jb3Vu
dF9pbmZvLCBwYWdlLT51LmludXNlLnR5cGVfaW5mbyk7CiAgICAgICAgIGlmICggcGFnZSAhPSBj
dXJyZW50LT5hcmNoLm9sZF9ndWVzdF90YWJsZSApCiAgICAgICAgICAgICBwYWdlLT51LmludXNl
LnR5cGVfaW5mbyA9IDA7CkBAIC0yOTQ2LDcgKzI5NDYsNyBAQCBzdGF0aWMgaW50IF9nZXRfcGFn
ZV90eXBlKHN0cnVjdCBwYWdlX2luZm8gKnBhZ2UsIHVuc2lnbmVkIGxvbmcgdHlwZSwKICAgICAg
ICAgICAgICAgICAgICAgICJCYWQgdHlwZSAoc2F3ICUiIFBSdHlwZV9pbmZvICIgIT0gZXhwICUi
IFBSdHlwZV9pbmZvICIpICIKICAgICAgICAgICAgICAgICAgICAgICJmb3IgbWZuICUiIFBSSV9t
Zm4gIiAocGZuICUiIFBSSV9wZm4gIilcbiIsCiAgICAgICAgICAgICAgICAgICAgICB4LCB0eXBl
LCBtZm5feChwYWdlX3RvX21mbihwYWdlKSksCi0gICAgICAgICAgICAgICAgICAgICBnZXRfZ3Bm
bl9mcm9tX21mbihtZm5feChwYWdlX3RvX21mbihwYWdlKSkpKTsKKyAgICAgICAgICAgICAgICAg
ICAgIGdldF9wZm5fZnJvbV9tZm4ocGFnZV90b19tZm4ocGFnZSkpKTsKICAgICAgICAgICAgIHJl
dHVybiAtRUlOVkFMOwogICAgICAgICB9CiAgICAgICAgIGVsc2UgaWYgKCB1bmxpa2VseSghKHgg
JiBQR1RfdmFsaWRhdGVkKSkgKQpAQCAtNDEwNiw3ICs0MTA2LDcgQEAgbG9uZyBkb19tbXVfdXBk
YXRlKAogICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgfQogCi0gICAgICAgICAg
ICBzZXRfZ3Bmbl9mcm9tX21mbihtZm5feChtZm4pLCBncGZuKTsKKyAgICAgICAgICAgIHNldF9w
Zm5fZnJvbV9tZm4obWZuLCBncGZuKTsKICAgICAgICAgICAgIHBhZ2luZ19tYXJrX3Bmbl9kaXJ0
eShwZ19vd25lciwgX3BmbihncGZuKSk7CiAKICAgICAgICAgICAgIHB1dF9wYWdlKHBhZ2UpOwpA
QCAtNDU5MCw3ICs0NTkwLDcgQEAgaW50IHhlbm1lbV9hZGRfdG9fcGh5c21hcF9vbmUoCiAgICAg
ICAgIGdvdG8gcHV0X2JvdGg7CiAKICAgICAvKiBVbm1hcCBmcm9tIG9sZCBsb2NhdGlvbiwgaWYg
YW55LiAqLwotICAgIG9sZF9ncGZuID0gZ2V0X2dwZm5fZnJvbV9tZm4obWZuX3gobWZuKSk7Cisg
ICAgb2xkX2dwZm4gPSBnZXRfcGZuX2Zyb21fbWZuKG1mbik7CiAgICAgQVNTRVJUKCFTSEFSRURf
TTJQKG9sZF9ncGZuKSk7CiAgICAgaWYgKCBzcGFjZSA9PSBYRU5NQVBTUEFDRV9nbWZuICYmIG9s
ZF9ncGZuICE9IGdmbiApCiAgICAgewpkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L21tL21lbV9z
aGFyaW5nLmMgYi94ZW4vYXJjaC94ODYvbW0vbWVtX3NoYXJpbmcuYwppbmRleCAzODM1YmM5Mjhm
Li4wMThiZWVjMTBmIDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYvbW0vbWVtX3NoYXJpbmcuYwor
KysgYi94ZW4vYXJjaC94ODYvbW0vbWVtX3NoYXJpbmcuYwpAQCAtNDI2LDE1ICs0MjYsMTUgQEAg
c3RhdGljIHZvaWQgbWVtX3NoYXJpbmdfZ2ZuX2Rlc3Ryb3koc3RydWN0IHBhZ2VfaW5mbyAqcGFn
ZSwgc3RydWN0IGRvbWFpbiAqZCwKICAgICB4ZnJlZShnZm5faW5mbyk7CiB9CiAKLXN0YXRpYyBz
dHJ1Y3QgcGFnZV9pbmZvICptZW1fc2hhcmluZ19sb29rdXAodW5zaWduZWQgbG9uZyBtZm4pCitz
dGF0aWMgc3RydWN0IHBhZ2VfaW5mbyAqbWVtX3NoYXJpbmdfbG9va3VwKG1mbl90IG1mbikKIHsK
ICAgICBzdHJ1Y3QgcGFnZV9pbmZvICpwYWdlOwogICAgIHVuc2lnbmVkIGxvbmcgdDsKIAotICAg
IGlmICggIW1mbl92YWxpZChfbWZuKG1mbikpICkKKyAgICBpZiAoICFtZm5fdmFsaWQobWZuKSAp
CiAgICAgICAgIHJldHVybiBOVUxMOwogCi0gICAgcGFnZSA9IG1mbl90b19wYWdlKF9tZm4obWZu
KSk7CisgICAgcGFnZSA9IG1mbl90b19wYWdlKG1mbik7CiAgICAgaWYgKCBwYWdlX2dldF9vd25l
cihwYWdlKSAhPSBkb21fY293ICkKICAgICAgICAgcmV0dXJuIE5VTEw7CiAKQEAgLTQ0Niw3ICs0
NDYsNyBAQCBzdGF0aWMgc3RydWN0IHBhZ2VfaW5mbyAqbWVtX3NoYXJpbmdfbG9va3VwKHVuc2ln
bmVkIGxvbmcgbWZuKQogICAgIHQgPSByZWFkX2F0b21pYygmcGFnZS0+dS5pbnVzZS50eXBlX2lu
Zm8pOwogICAgIEFTU0VSVCgodCAmIFBHVF90eXBlX21hc2spID09IFBHVF9zaGFyZWRfcGFnZSk7
CiAgICAgQVNTRVJUKCh0ICYgUEdUX2NvdW50X21hc2spID49IDIpOwotICAgIEFTU0VSVChTSEFS
RURfTTJQKGdldF9ncGZuX2Zyb21fbWZuKG1mbikpKTsKKyAgICBBU1NFUlQoU0hBUkVEX00yUChn
ZXRfcGZuX2Zyb21fbWZuKG1mbikpKTsKIAogICAgIHJldHVybiBwYWdlOwogfQpAQCAtNTA1LDEw
ICs1MDUsMTAgQEAgc3RhdGljIGludCBhdWRpdCh2b2lkKQogICAgICAgICB9CiAKICAgICAgICAg
LyogQ2hlY2sgdGhlIG0ycCBlbnRyeSAqLwotICAgICAgICBpZiAoICFTSEFSRURfTTJQKGdldF9n
cGZuX2Zyb21fbWZuKG1mbl94KG1mbikpKSApCisgICAgICAgIGlmICggIVNIQVJFRF9NMlAoZ2V0
X3Bmbl9mcm9tX21mbihtZm4pKSApCiAgICAgICAgIHsKLSAgICAgICAgICAgIGdkcHJpbnRrKFhF
TkxPR19FUlIsICJtZm4gJWx4IHNoYXJlZCwgYnV0IHdyb25nIG0ycCBlbnRyeSAoJWx4KSFcbiIs
Ci0gICAgICAgICAgICAgICAgICAgICBtZm5feChtZm4pLCBnZXRfZ3Bmbl9mcm9tX21mbihtZm5f
eChtZm4pKSk7CisgICAgICAgICAgICBnZHByaW50ayhYRU5MT0dfRVJSLCAibWZuICUiUFJJX21m
biIgc2hhcmVkLCBidXQgd3JvbmcgbTJwIGVudHJ5ICglbHgpIVxuIiwKKyAgICAgICAgICAgICAg
ICAgICAgIG1mbl94KG1mbiksIGdldF9wZm5fZnJvbV9tZm4obWZuKSk7CiAgICAgICAgICAgICBl
cnJvcnMrKzsKICAgICAgICAgfQogCkBAIC03MzYsNyArNzM2LDcgQEAgc3RhdGljIHN0cnVjdCBw
YWdlX2luZm8gKl9fZ3JhYl9zaGFyZWRfcGFnZShtZm5fdCBtZm4pCiAgICAgaWYgKCAhbWVtX3No
YXJpbmdfcGFnZV9sb2NrKHBnKSApCiAgICAgICAgIHJldHVybiBOVUxMOwogCi0gICAgaWYgKCBt
ZW1fc2hhcmluZ19sb29rdXAobWZuX3gobWZuKSkgPT0gTlVMTCApCisgICAgaWYgKCBtZW1fc2hh
cmluZ19sb29rdXAobWZuKSA9PSBOVUxMICkKICAgICB7CiAgICAgICAgIG1lbV9zaGFyaW5nX3Bh
Z2VfdW5sb2NrKHBnKTsKICAgICAgICAgcmV0dXJuIE5VTEw7CkBAIC05MTgsNyArOTE4LDcgQEAg
c3RhdGljIGludCBub21pbmF0ZV9wYWdlKHN0cnVjdCBkb21haW4gKmQsIGdmbl90IGdmbiwKICAg
ICBhdG9taWNfaW5jKCZucl9zaGFyZWRfbWZucyk7CiAKICAgICAvKiBVcGRhdGUgbTJwIGVudHJ5
IHRvIFNIQVJFRF9NMlBfRU5UUlkgKi8KLSAgICBzZXRfZ3Bmbl9mcm9tX21mbihtZm5feChtZm4p
LCBTSEFSRURfTTJQX0VOVFJZKTsKKyAgICBzZXRfcGZuX2Zyb21fbWZuKG1mbiwgU0hBUkVEX00y
UF9FTlRSWSk7CiAKICAgICAqcGhhbmRsZSA9IHBhZ2UtPnNoYXJpbmctPmhhbmRsZTsKICAgICBh
dWRpdF9hZGRfbGlzdChwYWdlKTsKQEAgLTEzMDYsNyArMTMwNiw3IEBAIGludCBfX21lbV9zaGFy
aW5nX3Vuc2hhcmVfcGFnZShzdHJ1Y3QgZG9tYWluICpkLAogICAgIH0KIAogICAgIC8qIFVwZGF0
ZSBtMnAgZW50cnkgKi8KLSAgICBzZXRfZ3Bmbl9mcm9tX21mbihtZm5feChwYWdlX3RvX21mbihw
YWdlKSksIGdmbik7CisgICAgc2V0X3Bmbl9mcm9tX21mbihwYWdlX3RvX21mbihwYWdlKSwgZ2Zu
KTsKIAogICAgIC8qCiAgICAgICogTm93IHRoYXQgdGhlIGdmbjwtPm1mbiBtYXAgaXMgcHJvcGVy
bHkgZXN0YWJsaXNoZWQsCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvbW0vcDJtLXBvZC5jIGIv
eGVuL2FyY2gveDg2L21tL3AybS1wb2QuYwppbmRleCAyYTdiOGMxMTdiLi5hOWFjNDRhNjVjIDEw
MDY0NAotLS0gYS94ZW4vYXJjaC94ODYvbW0vcDJtLXBvZC5jCisrKyBiL3hlbi9hcmNoL3g4Ni9t
bS9wMm0tcG9kLmMKQEAgLTY0NCw3ICs2NDQsNyBAQCBwMm1fcG9kX2RlY3JlYXNlX3Jlc2VydmF0
aW9uKHN0cnVjdCBkb21haW4gKmQsIGdmbl90IGdmbiwgdW5zaWduZWQgaW50IG9yZGVyKQogICAg
ICAgICAgICAgfQogICAgICAgICAgICAgcDJtX3RsYl9mbHVzaF9zeW5jKHAybSk7CiAgICAgICAg
ICAgICBmb3IgKCBqID0gMDsgaiA8IG47ICsraiApCi0gICAgICAgICAgICAgICAgc2V0X2dwZm5f
ZnJvbV9tZm4obWZuX3gobWZuKSwgSU5WQUxJRF9NMlBfRU5UUlkpOworICAgICAgICAgICAgICAg
IHNldF9wZm5fZnJvbV9tZm4obWZuLCBJTlZBTElEX00yUF9FTlRSWSk7CiAgICAgICAgICAgICBw
Mm1fcG9kX2NhY2hlX2FkZChwMm0sIHBhZ2UsIGN1cl9vcmRlcik7CiAKICAgICAgICAgICAgIHN0
ZWFsX2Zvcl9jYWNoZSA9ICAoIHAybS0+cG9kLmVudHJ5X2NvdW50ID4gcDJtLT5wb2QuY291bnQg
KTsKQEAgLTExOTQsNyArMTE5NCw3IEBAIHAybV9wb2RfZGVtYW5kX3BvcHVsYXRlKHN0cnVjdCBw
Mm1fZG9tYWluICpwMm0sIGdmbl90IGdmbiwKIAogICAgIGZvciggaSA9IDA7IGkgPCAoMVVMIDw8
IG9yZGVyKTsgaSsrICkKICAgICB7Ci0gICAgICAgIHNldF9ncGZuX2Zyb21fbWZuKG1mbl94KG1m
bikgKyBpLCBnZm5feChnZm5fYWxpZ25lZCkgKyBpKTsKKyAgICAgICAgc2V0X3Bmbl9mcm9tX21m
bihtZm5fYWRkKG1mbiwgaSksIGdmbl94KGdmbl9hbGlnbmVkKSArIGkpOwogICAgICAgICBwYWdp
bmdfbWFya19wZm5fZGlydHkoZCwgX3BmbihnZm5feChnZm5fYWxpZ25lZCkgKyBpKSk7CiAgICAg
fQogCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvbW0vcDJtLXB0LmMgYi94ZW4vYXJjaC94ODYv
bW0vcDJtLXB0LmMKaW5kZXggZTlkYTM0ZDY2OC4uMTYwMWU5ZTVlOSAxMDA2NDQKLS0tIGEveGVu
L2FyY2gveDg2L21tL3AybS1wdC5jCisrKyBiL3hlbi9hcmNoL3g4Ni9tbS9wMm0tcHQuYwpAQCAt
OTQ0LDcgKzk0NCw4IEBAIHN0YXRpYyBpbnQgcDJtX3B0X2NoYW5nZV9lbnRyeV90eXBlX3Jhbmdl
KHN0cnVjdCBwMm1fZG9tYWluICpwMm0sCiBsb25nIHAybV9wdF9hdWRpdF9wMm0oc3RydWN0IHAy
bV9kb21haW4gKnAybSkKIHsKICAgICB1bnNpZ25lZCBsb25nIGVudHJ5X2NvdW50ID0gMCwgcG1i
YWQgPSAwOwotICAgIHVuc2lnbmVkIGxvbmcgbWZuLCBnZm4sIG0ycGZuOworICAgIHVuc2lnbmVk
IGxvbmcgZ2ZuLCBtMnBmbjsKKyAgICBtZm5fdCBtZm47CiAKICAgICBBU1NFUlQocDJtX2xvY2tl
ZF9ieV9tZShwMm0pKTsKICAgICBBU1NFUlQocG9kX2xvY2tlZF9ieV9tZShwMm0pKTsKQEAgLTk4
MywxOSArOTg0LDIwIEBAIGxvbmcgcDJtX3B0X2F1ZGl0X3AybShzdHJ1Y3QgcDJtX2RvbWFpbiAq
cDJtKQogICAgICAgICAgICAgICAgIC8qIGNoZWNrIGZvciAxR0Igc3VwZXIgcGFnZSAqLwogICAg
ICAgICAgICAgICAgIGlmICggbDNlX2dldF9mbGFncyhsM2VbaTNdKSAmIF9QQUdFX1BTRSApCiAg
ICAgICAgICAgICAgICAgewotICAgICAgICAgICAgICAgICAgICBtZm4gPSBsM2VfZ2V0X3Bmbihs
M2VbaTNdKTsKLSAgICAgICAgICAgICAgICAgICAgQVNTRVJUKG1mbl92YWxpZChfbWZuKG1mbikp
KTsKKyAgICAgICAgICAgICAgICAgICAgbWZuID0gbDNlX2dldF9tZm4obDNlW2kzXSk7CisgICAg
ICAgICAgICAgICAgICAgIEFTU0VSVChtZm5fdmFsaWQobWZuKSk7CiAgICAgICAgICAgICAgICAg
ICAgIC8qIHdlIGhhdmUgdG8gY292ZXIgNTEyeDUxMiA0SyBwYWdlcyAqLwogICAgICAgICAgICAg
ICAgICAgICBmb3IgKCBpMiA9IDA7IAogICAgICAgICAgICAgICAgICAgICAgICAgICBpMiA8IChM
Ml9QQUdFVEFCTEVfRU5UUklFUyAqIEwxX1BBR0VUQUJMRV9FTlRSSUVTKTsKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgaTIrKykKICAgICAgICAgICAgICAgICAgICAgewotICAgICAgICAgICAg
ICAgICAgICAgICAgbTJwZm4gPSBnZXRfZ3Bmbl9mcm9tX21mbihtZm4raTIpOworICAgICAgICAg
ICAgICAgICAgICAgICAgbTJwZm4gPSBnZXRfcGZuX2Zyb21fbWZuKG1mbl9hZGQobWZuLCBpMikp
OwogICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBtMnBmbiAhPSAoZ2ZuICsgaTIpICkKICAg
ICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbWJh
ZCsrOwotICAgICAgICAgICAgICAgICAgICAgICAgICAgIFAyTV9QUklOVEsoIm1pc21hdGNoOiBn
Zm4gJSNseCAtPiBtZm4gJSNseCAtPiBnZm4gJSNseFxuIiwKLSAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGdmbiArIGkyLCBtZm4gKyBpMiwgbTJwZm4pOworICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIFAyTV9QUklOVEsoIm1pc21hdGNoOiBnZm4gJSNseCAtPiBtZm4g
JSJQUklfbWZuIiBnZm4gJSNseFxuIiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGdmbiArIGkyLCBtZm5feChtZm5fYWRkKG1mbiwgaTIpKSwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIG0ycGZuKTsKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBCVUcoKTsKICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg
ICAgICAgIGdmbiArPSAxIDw8IChMM19QQUdFVEFCTEVfU0hJRlQgLSBQQUdFX1NISUZUKTsKQEAg
LTEwMTksMTcgKzEwMjEsMTggQEAgbG9uZyBwMm1fcHRfYXVkaXRfcDJtKHN0cnVjdCBwMm1fZG9t
YWluICpwMm0pCiAgICAgICAgICAgICAgICAgICAgIC8qIGNoZWNrIGZvciBzdXBlciBwYWdlICov
CiAgICAgICAgICAgICAgICAgICAgIGlmICggbDJlX2dldF9mbGFncyhsMmVbaTJdKSAmIF9QQUdF
X1BTRSApCiAgICAgICAgICAgICAgICAgICAgIHsKLSAgICAgICAgICAgICAgICAgICAgICAgIG1m
biA9IGwyZV9nZXRfcGZuKGwyZVtpMl0pOwotICAgICAgICAgICAgICAgICAgICAgICAgQVNTRVJU
KG1mbl92YWxpZChfbWZuKG1mbikpKTsKKyAgICAgICAgICAgICAgICAgICAgICAgIG1mbiA9IGwy
ZV9nZXRfbWZuKGwyZVtpMl0pOworICAgICAgICAgICAgICAgICAgICAgICAgQVNTRVJUKG1mbl92
YWxpZChtZm4pKTsKICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoIGkxID0gMDsgaTEgPCBM
MV9QQUdFVEFCTEVfRU5UUklFUzsgaTErKykKICAgICAgICAgICAgICAgICAgICAgICAgIHsKLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBtMnBmbiA9IGdldF9ncGZuX2Zyb21fbWZuKG1mbitp
MSk7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgbTJwZm4gPSBnZXRfcGZuX2Zyb21fbWZu
KG1mbl9hZGQobWZuLCBpMSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIEFsbG93
IHNoYXJlZCBNMlBzICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAobTJwZm4g
IT0gKGdmbiArIGkxKSkgJiYgIVNIQVJFRF9NMlAobTJwZm4pICkKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBtYmFkKys7Ci0g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFAyTV9QUklOVEsoIm1pc21hdGNoOiBnZm4g
JSNseCAtPiBtZm4gJSNseCAtPiBnZm4gJSNseFxuIiwKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBnZm4gKyBpMSwgbWZuICsgaTEsIG0ycGZuKTsKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgUDJNX1BSSU5USygibWlzbWF0Y2g6IGdmbiAlI2x4IC0+
IG1mbiAlIlBSSV9tZm4iIC0+IGdmbiAlI2x4XG4iLAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGdmbiArIGkxLCBtZm5feChtZm5fYWRkKG1mbiwgaTEpKSwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtMnBmbik7CiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIEJVRygpOwogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgIH0KQEAgLTEwNTAsMTcgKzEwNTMsMTcgQEAg
bG9uZyBwMm1fcHRfYXVkaXRfcDJtKHN0cnVjdCBwMm1fZG9tYWluICpwMm0pCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGVudHJ5X2NvdW50Kys7CiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgICAgICB9Ci0gICAgICAgICAg
ICAgICAgICAgICAgICBtZm4gPSBsMWVfZ2V0X3BmbihsMWVbaTFdKTsKLSAgICAgICAgICAgICAg
ICAgICAgICAgIEFTU0VSVChtZm5fdmFsaWQoX21mbihtZm4pKSk7Ci0gICAgICAgICAgICAgICAg
ICAgICAgICBtMnBmbiA9IGdldF9ncGZuX2Zyb21fbWZuKG1mbik7CisgICAgICAgICAgICAgICAg
ICAgICAgICBtZm4gPSBsMWVfZ2V0X21mbihsMWVbaTFdKTsKKyAgICAgICAgICAgICAgICAgICAg
ICAgIEFTU0VSVChtZm5fdmFsaWQobWZuKSk7CisgICAgICAgICAgICAgICAgICAgICAgICBtMnBm
biA9IGdldF9wZm5fZnJvbV9tZm4obWZuKTsKICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgg
bTJwZm4gIT0gZ2ZuICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgIT0gcDJt
X21taW9fZGlyZWN0ICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICFwMm1faXNfZ3Jh
bnQodHlwZSkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIXAybV9pc19zaGFyZWQo
dHlwZSkgKQogICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHBtYmFkKys7Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgUDJNX1BSSU5USygi
bWlzbWF0Y2g6IGdmbiAlI2x4IC0+IG1mbiAlI2x4IC0+IGdmbiAlI2x4XG4iLAotICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2ZuLCBtZm4sIG0ycGZuKTsKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBQMk1fUFJJTlRLKCJtaXNtYXRjaDogZ2ZuICUjbHggLT4gbWZu
ICUiUFJJX21mbiIgLT4gZ2ZuICUjbHhcbiIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBnZm4sIG1mbl94KG1mbiksIG0ycGZuKTsKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBCVUcoKTsKICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg
ICAgICAgfQpkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L21tL3AybS5jIGIveGVuL2FyY2gveDg2
L21tL3AybS5jCmluZGV4IGI2YjAxYTcxYzguLjU4N2MwNjI0ODEgMTAwNjQ0Ci0tLSBhL3hlbi9h
cmNoL3g4Ni9tbS9wMm0uYworKysgYi94ZW4vYXJjaC94ODYvbW0vcDJtLmMKQEAgLTc2OSw3ICs3
NjksNyBAQCB2b2lkIHAybV9maW5hbF90ZWFyZG93bihzdHJ1Y3QgZG9tYWluICpkKQogCiAKIHN0
YXRpYyBpbnQKLXAybV9yZW1vdmVfcGFnZShzdHJ1Y3QgcDJtX2RvbWFpbiAqcDJtLCB1bnNpZ25l
ZCBsb25nIGdmbl9sLCB1bnNpZ25lZCBsb25nIG1mbiwKK3AybV9yZW1vdmVfcGFnZShzdHJ1Y3Qg
cDJtX2RvbWFpbiAqcDJtLCB1bnNpZ25lZCBsb25nIGdmbl9sLCBtZm5fdCBtZm4sCiAgICAgICAg
ICAgICAgICAgdW5zaWduZWQgaW50IHBhZ2Vfb3JkZXIpCiB7CiAgICAgdW5zaWduZWQgbG9uZyBp
OwpAQCAtNzgzLDE3ICs3ODMsMTcgQEAgcDJtX3JlbW92ZV9wYWdlKHN0cnVjdCBwMm1fZG9tYWlu
ICpwMm0sIHVuc2lnbmVkIGxvbmcgZ2ZuX2wsIHVuc2lnbmVkIGxvbmcgbWZuLAogICAgICAgICBy
ZXR1cm4gMDsKIAogICAgIEFTU0VSVChnZm5fbG9ja2VkX2J5X21lKHAybSwgZ2ZuKSk7Ci0gICAg
UDJNX0RFQlVHKCJyZW1vdmluZyBnZm49JSNseCBtZm49JSNseFxuIiwgZ2ZuX2wsIG1mbik7Cisg
ICAgUDJNX0RFQlVHKCJyZW1vdmluZyBnZm49JSNseCBtZm49JSJQUklfbWZuIlxuIiwgZ2ZuX2ws
IG1mbl94KG1mbikpOwogCi0gICAgaWYgKCBtZm5fdmFsaWQoX21mbihtZm4pKSApCisgICAgaWYg
KCBtZm5fdmFsaWQobWZuKSApCiAgICAgewogICAgICAgICBmb3IgKCBpID0gMDsgaSA8ICgxVUwg
PDwgcGFnZV9vcmRlcik7IGkrKyApCiAgICAgICAgIHsKICAgICAgICAgICAgIG1mbl9yZXR1cm4g
PSBwMm0tPmdldF9lbnRyeShwMm0sIGdmbl9hZGQoZ2ZuLCBpKSwgJnQsICZhLCAwLAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5VTEwsIE5VTEwpOwogICAgICAgICAg
ICAgaWYgKCAhcDJtX2lzX2dyYW50KHQpICYmICFwMm1faXNfc2hhcmVkKHQpICYmICFwMm1faXNf
Zm9yZWlnbih0KSApCi0gICAgICAgICAgICAgICAgc2V0X2dwZm5fZnJvbV9tZm4obWZuK2ksIElO
VkFMSURfTTJQX0VOVFJZKTsKLSAgICAgICAgICAgIEFTU0VSVCggIXAybV9pc192YWxpZCh0KSB8
fCBtZm4gKyBpID09IG1mbl94KG1mbl9yZXR1cm4pICk7CisgICAgICAgICAgICAgICAgc2V0X3Bm
bl9mcm9tX21mbihtZm5fYWRkKG1mbiwgaSksIElOVkFMSURfTTJQX0VOVFJZKTsKKyAgICAgICAg
ICAgIEFTU0VSVCggIXAybV9pc192YWxpZCh0KSB8fCBtZm5fZXEobWZuX2FkZChtZm4sIGkpLCBt
Zm5fcmV0dXJuKSApOwogICAgICAgICB9CiAgICAgfQogICAgIHJldHVybiBwMm1fc2V0X2VudHJ5
KHAybSwgZ2ZuLCBJTlZBTElEX01GTiwgcGFnZV9vcmRlciwgcDJtX2ludmFsaWQsCkBAIC04MDcs
NyArODA3LDcgQEAgZ3Vlc3RfcGh5c21hcF9yZW1vdmVfcGFnZShzdHJ1Y3QgZG9tYWluICpkLCBn
Zm5fdCBnZm4sCiAgICAgc3RydWN0IHAybV9kb21haW4gKnAybSA9IHAybV9nZXRfaG9zdHAybShk
KTsKICAgICBpbnQgcmM7CiAgICAgZ2ZuX2xvY2socDJtLCBnZm4sIHBhZ2Vfb3JkZXIpOwotICAg
IHJjID0gcDJtX3JlbW92ZV9wYWdlKHAybSwgZ2ZuX3goZ2ZuKSwgbWZuX3gobWZuKSwgcGFnZV9v
cmRlcik7CisgICAgcmMgPSBwMm1fcmVtb3ZlX3BhZ2UocDJtLCBnZm5feChnZm4pLCBtZm4sIHBh
Z2Vfb3JkZXIpOwogICAgIGdmbl91bmxvY2socDJtLCBnZm4sIHBhZ2Vfb3JkZXIpOwogICAgIHJl
dHVybiByYzsKIH0KQEAgLTg0Miw3ICs4NDIsNyBAQCBndWVzdF9waHlzbWFwX2FkZF9wYWdlKHN0
cnVjdCBkb21haW4gKmQsIGdmbl90IGdmbiwgbWZuX3QgbWZuLAogICAgICAgICAgICAgZWxzZQog
ICAgICAgICAgICAgICAgIHJldHVybiAtRUlOVkFMOwogCi0gICAgICAgICAgICBzZXRfZ3Bmbl9m
cm9tX21mbihtZm5feChtZm4pICsgaSwgZ2ZuX3goZ2ZuKSArIGkpOworICAgICAgICAgICAgc2V0
X3Bmbl9mcm9tX21mbihtZm5fYWRkKG1mbiwgaSksIGdmbl94KGdmbikgKyBpKTsKICAgICAgICAg
fQogCiAgICAgICAgIHJldHVybiAwOwpAQCAtOTMwLDcgKzkzMCw3IEBAIGd1ZXN0X3BoeXNtYXBf
YWRkX2VudHJ5KHN0cnVjdCBkb21haW4gKmQsIGdmbl90IGdmbiwgbWZuX3QgbWZuLAogICAgICAg
ICBlbHNlIGlmICggcDJtX2lzX3JhbShvdCkgJiYgIXAybV9pc19wYWdlZChvdCkgKQogICAgICAg
ICB7CiAgICAgICAgICAgICBBU1NFUlQobWZuX3ZhbGlkKG9tZm4pKTsKLSAgICAgICAgICAgIHNl
dF9ncGZuX2Zyb21fbWZuKG1mbl94KG9tZm4pLCBJTlZBTElEX00yUF9FTlRSWSk7CisgICAgICAg
ICAgICBzZXRfcGZuX2Zyb21fbWZuKG9tZm4sIElOVkFMSURfTTJQX0VOVFJZKTsKICAgICAgICAg
fQogICAgICAgICBlbHNlIGlmICggb3QgPT0gcDJtX3BvcHVsYXRlX29uX2RlbWFuZCApCiAgICAg
ICAgIHsKQEAgLTk3NCw3ICs5NzQsNyBAQCBndWVzdF9waHlzbWFwX2FkZF9lbnRyeShzdHJ1Y3Qg
ZG9tYWluICpkLCBnZm5fdCBnZm4sIG1mbl90IG1mbiwKICAgICAgICAgICAgICAgICBQMk1fREVC
VUcoIm9sZCBnZm49JSNseCAtPiBtZm4gJSNseFxuIiwKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgZ2ZuX3gob2dmbikgLCBtZm5feChvbWZuKSk7CiAgICAgICAgICAgICAgICAgaWYgKCBtZm5f
ZXEob21mbiwgbWZuX2FkZChtZm4sIGkpKSApCi0gICAgICAgICAgICAgICAgICAgIHAybV9yZW1v
dmVfcGFnZShwMm0sIGdmbl94KG9nZm4pLCBtZm5feChtZm5fYWRkKG1mbiwgaSkpLAorICAgICAg
ICAgICAgICAgICAgICBwMm1fcmVtb3ZlX3BhZ2UocDJtLCBnZm5feChvZ2ZuKSwgbWZuX2FkZCht
Zm4sIGkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMCk7CiAgICAgICAg
ICAgICB9CiAgICAgICAgIH0KQEAgLTk5Miw4ICs5OTIsOCBAQCBndWVzdF9waHlzbWFwX2FkZF9l
bnRyeShzdHJ1Y3QgZG9tYWluICpkLCBnZm5fdCBnZm4sIG1mbl90IG1mbiwKICAgICAgICAgaWYg
KCAhcDJtX2lzX2dyYW50KHQpICkKICAgICAgICAgewogICAgICAgICAgICAgZm9yICggaSA9IDA7
IGkgPCAoMVVMIDw8IHBhZ2Vfb3JkZXIpOyBpKysgKQotICAgICAgICAgICAgICAgIHNldF9ncGZu
X2Zyb21fbWZuKG1mbl94KG1mbl9hZGQobWZuLCBpKSksCi0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgZ2ZuX3goZ2ZuX2FkZChnZm4sIGkpKSk7CisgICAgICAgICAgICAgICAgc2V0
X3Bmbl9mcm9tX21mbihtZm5fYWRkKG1mbiwgaSksCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBnZm5feChnZm5fYWRkKGdmbiwgaSkpKTsKICAgICAgICAgfQogICAgIH0KIApAQCAt
MTI3OSw3ICsxMjc5LDcgQEAgc3RhdGljIGludCBzZXRfdHlwZWRfcDJtX2VudHJ5KHN0cnVjdCBk
b21haW4gKmQsIHVuc2lnbmVkIGxvbmcgZ2ZuX2wsCiAgICAgICAgIGZvciAoIGkgPSAwOyBpIDwg
KDFVTCA8PCBvcmRlcik7ICsraSApCiAgICAgICAgIHsKICAgICAgICAgICAgIEFTU0VSVChtZm5f
dmFsaWQobWZuX2FkZChvbWZuLCBpKSkpOwotICAgICAgICAgICAgc2V0X2dwZm5fZnJvbV9tZm4o
bWZuX3gob21mbikgKyBpLCBJTlZBTElEX00yUF9FTlRSWSk7CisgICAgICAgICAgICBzZXRfcGZu
X2Zyb21fbWZuKG1mbl9hZGQob21mbiwgaSksIElOVkFMSURfTTJQX0VOVFJZKTsKICAgICAgICAg
fQogICAgIH0KIApAQCAtMTQ3NSw3ICsxNDc1LDcgQEAgaW50IHNldF9zaGFyZWRfcDJtX2VudHJ5
KHN0cnVjdCBkb21haW4gKmQsIHVuc2lnbmVkIGxvbmcgZ2ZuX2wsIG1mbl90IG1mbikKICAgICBw
Z190eXBlID0gcmVhZF9hdG9taWMoJihtZm5fdG9fcGFnZShvbWZuKS0+dS5pbnVzZS50eXBlX2lu
Zm8pKTsKICAgICBpZiAoIChwZ190eXBlICYgUEdUX2NvdW50X21hc2spID09IDAKICAgICAgICAg
IHx8IChwZ190eXBlICYgUEdUX3R5cGVfbWFzaykgIT0gUEdUX3NoYXJlZF9wYWdlICkKLSAgICAg
ICAgc2V0X2dwZm5fZnJvbV9tZm4obWZuX3gob21mbiksIElOVkFMSURfTTJQX0VOVFJZKTsKKyAg
ICAgICAgc2V0X3Bmbl9mcm9tX21mbihvbWZuLCBJTlZBTElEX00yUF9FTlRSWSk7CiAKICAgICBQ
Mk1fREVCVUcoInNldCBzaGFyZWQgJWx4ICVseFxuIiwgZ2ZuX2wsIG1mbl94KG1mbikpOwogICAg
IHJjID0gcDJtX3NldF9lbnRyeShwMm0sIGdmbiwgbWZuLCBQQUdFX09SREVSXzRLLCBwMm1fcmFt
X3NoYXJlZCwKQEAgLTE4MjksNyArMTgyOSw3IEBAIGludCBwMm1fbWVtX3BhZ2luZ19wcmVwKHN0
cnVjdCBkb21haW4gKmQsIHVuc2lnbmVkIGxvbmcgZ2ZuX2wsIHVpbnQ2NF90IGJ1ZmZlcikKICAg
ICByZXQgPSBwMm1fc2V0X2VudHJ5KHAybSwgZ2ZuLCBtZm4sIFBBR0VfT1JERVJfNEssCiAgICAg
ICAgICAgICAgICAgICAgICAgICBwYWdpbmdfbW9kZV9sb2dfZGlydHkoZCkgPyBwMm1fcmFtX2xv
Z2RpcnR5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
OiBwMm1fcmFtX3J3LCBhKTsKLSAgICBzZXRfZ3Bmbl9mcm9tX21mbihtZm5feChtZm4pLCBnZm5f
bCk7CisgICAgc2V0X3Bmbl9mcm9tX21mbihtZm4sIGdmbl9sKTsKIAogICAgIGlmICggIXBhZ2Vf
ZXh0YW50ICkKICAgICAgICAgYXRvbWljX2RlYygmZC0+cGFnZWRfcGFnZXMpOwpAQCAtMTg4MCw3
ICsxODgwLDcgQEAgdm9pZCBwMm1fbWVtX3BhZ2luZ19yZXN1bWUoc3RydWN0IGRvbWFpbiAqZCwg
dm1fZXZlbnRfcmVzcG9uc2VfdCAqcnNwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBwMm1fcmFtX3J3LCBhKTsKIAogICAgICAgICAgICAgaWYgKCAhcmMgKQotICAgICAgICAg
ICAgICAgIHNldF9ncGZuX2Zyb21fbWZuKG1mbl94KG1mbiksIGdmbl94KGdmbikpOworICAgICAg
ICAgICAgICAgIHNldF9wZm5fZnJvbV9tZm4obWZuLCBnZm5feChnZm4pKTsKICAgICAgICAgfQog
ICAgICAgICBnZm5fdW5sb2NrKHAybSwgZ2ZuLCAwKTsKICAgICB9CkBAIC0yNzA2LDcgKzI3MDYs
NyBAQCBpbnQgcDJtX2NoYW5nZV9hbHRwMm1fZ2ZuKHN0cnVjdCBkb21haW4gKmQsIHVuc2lnbmVk
IGludCBpZHgsCiAgICAgewogICAgICAgICBtZm4gPSBhcDJtLT5nZXRfZW50cnkoYXAybSwgb2xk
X2dmbiwgJnQsICZhLCAwLCBOVUxMLCBOVUxMKTsKICAgICAgICAgaWYgKCBtZm5fdmFsaWQobWZu
KSApCi0gICAgICAgICAgICBwMm1fcmVtb3ZlX3BhZ2UoYXAybSwgZ2ZuX3gob2xkX2dmbiksIG1m
bl94KG1mbiksIFBBR0VfT1JERVJfNEspOworICAgICAgICAgICAgcDJtX3JlbW92ZV9wYWdlKGFw
Mm0sIGdmbl94KG9sZF9nZm4pLCBtZm4sIFBBR0VfT1JERVJfNEspOwogICAgICAgICByYyA9IDA7
CiAgICAgICAgIGdvdG8gb3V0OwogICAgIH0KQEAgLTI4MjAsOCArMjgyMCw4IEBAIHZvaWQgYXVk
aXRfcDJtKHN0cnVjdCBkb21haW4gKmQsCiB7CiAgICAgc3RydWN0IHBhZ2VfaW5mbyAqcGFnZTsK
ICAgICBzdHJ1Y3QgZG9tYWluICpvZDsKLSAgICB1bnNpZ25lZCBsb25nIG1mbiwgZ2ZuOwotICAg
IG1mbl90IHAybWZuOworICAgIHVuc2lnbmVkIGxvbmcgZ2ZuOworICAgIG1mbl90IHAybWZuLCBt
Zm47CiAgICAgdW5zaWduZWQgbG9uZyBvcnBoYW5zX2NvdW50ID0gMCwgbXBiYWQgPSAwLCBwbWJh
ZCA9IDA7CiAgICAgcDJtX2FjY2Vzc190IHAybWE7CiAgICAgcDJtX3R5cGVfdCB0eXBlOwpAQCAt
Mjg0Myw1MyArMjg0Myw1MyBAQCB2b2lkIGF1ZGl0X3AybShzdHJ1Y3QgZG9tYWluICpkLAogICAg
IHNwaW5fbG9jaygmZC0+cGFnZV9hbGxvY19sb2NrKTsKICAgICBwYWdlX2xpc3RfZm9yX2VhY2gg
KCBwYWdlLCAmZC0+cGFnZV9saXN0ICkKICAgICB7Ci0gICAgICAgIG1mbiA9IG1mbl94KHBhZ2Vf
dG9fbWZuKHBhZ2UpKTsKKyAgICAgICAgbWZuID0gcGFnZV90b19tZm4ocGFnZSk7CiAKLSAgICAg
ICAgUDJNX1BSSU5USygiYXVkaXRpbmcgZ3Vlc3QgcGFnZSwgbWZuPSUjbHhcbiIsIG1mbik7Cisg
ICAgICAgIFAyTV9QUklOVEsoImF1ZGl0aW5nIGd1ZXN0IHBhZ2UsIG1mbj0lIlBSSV9tZm4iXG4i
LCBtZm5feChtZm4pKTsKIAogICAgICAgICBvZCA9IHBhZ2VfZ2V0X293bmVyKHBhZ2UpOwogCiAg
ICAgICAgIGlmICggb2QgIT0gZCApCiAgICAgICAgIHsKLSAgICAgICAgICAgIFAyTV9QUklOVEso
Im1mbiAlIlBSSV9tZm4iIG93bmVyICVwZCAhPSAlcGRcbiIsIG1mbiwgb2QsIGQpOworICAgICAg
ICAgICAgUDJNX1BSSU5USygibWZuICUiUFJJX21mbiIgb3duZXIgJXBkICE9ICVwZFxuIiwgbWZu
X3gobWZuKSwgb2QsIGQpOwogICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgIH0KIAotICAg
ICAgICBnZm4gPSBnZXRfZ3Bmbl9mcm9tX21mbihtZm4pOworICAgICAgICBnZm4gPSBnZXRfcGZu
X2Zyb21fbWZuKG1mbik7CiAgICAgICAgIGlmICggZ2ZuID09IElOVkFMSURfTTJQX0VOVFJZICkK
ICAgICAgICAgewogICAgICAgICAgICAgb3JwaGFuc19jb3VudCsrOwotICAgICAgICAgICAgUDJN
X1BSSU5USygib3JwaGFuZWQgZ3Vlc3QgcGFnZTogbWZuPSUjbHggaGFzIGludmFsaWQgZ2ZuXG4i
LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgbWZuKTsKKyAgICAgICAgICAgIFAyTV9QUklO
VEsoIm9ycGhhbmVkIGd1ZXN0IHBhZ2U6IG1mbj0lIlBSSV9tZm4iIGhhcyBpbnZhbGlkIGdmblxu
IiwKKyAgICAgICAgICAgICAgICAgICAgICAgbWZuX3gobWZuKSk7CiAgICAgICAgICAgICBjb250
aW51ZTsKICAgICAgICAgfQogCiAgICAgICAgIGlmICggU0hBUkVEX00yUChnZm4pICkKICAgICAg
ICAgewotICAgICAgICAgICAgUDJNX1BSSU5USygic2hhcmVkIG1mbiAoJWx4KSBvbiBkb21haW4g
cGFnZSBsaXN0IVxuIiwKLSAgICAgICAgICAgICAgICAgICAgbWZuKTsKKyAgICAgICAgICAgIFAy
TV9QUklOVEsoInNoYXJlZCBtZm4gKCUiUFJJX21mbiIpIG9uIGRvbWFpbiBwYWdlIGxpc3QhXG4i
LAorICAgICAgICAgICAgICAgICAgICAgICBtZm5feChtZm4pKTsKICAgICAgICAgICAgIGNvbnRp
bnVlOwogICAgICAgICB9CiAKICAgICAgICAgcDJtZm4gPSBnZXRfZ2ZuX3R5cGVfYWNjZXNzKHAy
bSwgZ2ZuLCAmdHlwZSwgJnAybWEsIDAsIE5VTEwpOwotICAgICAgICBpZiAoIG1mbl94KHAybWZu
KSAhPSBtZm4gKQorICAgICAgICBpZiAoICFtZm5fZXEocDJtZm4sIG1mbikgKQogICAgICAgICB7
CiAgICAgICAgICAgICBtcGJhZCsrOwotICAgICAgICAgICAgUDJNX1BSSU5USygibWFwIG1pc21h
dGNoIG1mbiAlI2x4IC0+IGdmbiAlI2x4IC0+IG1mbiAlI2x4IgorICAgICAgICAgICAgUDJNX1BS
SU5USygibWFwIG1pc21hdGNoIG1mbiAlIlBSSV9tZm4iIC0+IGdmbiAlI2x4IC0+IG1mbiAlIlBS
SV9tZm4iIgogICAgICAgICAgICAgICAgICAgICAgICAiICgtPiBnZm4gJSNseClcbiIsCi0gICAg
ICAgICAgICAgICAgICAgICAgIG1mbiwgZ2ZuLCBtZm5feChwMm1mbiksCisgICAgICAgICAgICAg
ICAgICAgICAgIG1mbl94KG1mbiksIGdmbiwgbWZuX3gocDJtZm4pLAogICAgICAgICAgICAgICAg
ICAgICAgICAobWZuX3ZhbGlkKHAybWZuKQotICAgICAgICAgICAgICAgICAgICAgICAgPyBnZXRf
Z3Bmbl9mcm9tX21mbihtZm5feChwMm1mbikpCisgICAgICAgICAgICAgICAgICAgICAgICA/IGdl
dF9wZm5fZnJvbV9tZm4ocDJtZm4pCiAgICAgICAgICAgICAgICAgICAgICAgICA6IC0xdSkpOwog
ICAgICAgICAgICAgLyogVGhpcyBtMnAgZW50cnkgaXMgc3RhbGU6IHRoZSBkb21haW4gaGFzIGFu
b3RoZXIgZnJhbWUgaW4KICAgICAgICAgICAgICAqIHRoaXMgcGh5c2ljYWwgc2xvdC4gIE5vIGdy
ZWF0IGRpc2FzdGVyLCBidXQgZm9yIG5lYXRuZXNzLAogICAgICAgICAgICAgICogYmxvdyBhd2F5
IHRoZSBtMnAgZW50cnkuICovCi0gICAgICAgICAgICBzZXRfZ3Bmbl9mcm9tX21mbihtZm4sIElO
VkFMSURfTTJQX0VOVFJZKTsKKyAgICAgICAgICAgIHNldF9wZm5fZnJvbV9tZm4obWZuLCBJTlZB
TElEX00yUF9FTlRSWSk7CiAgICAgICAgIH0KICAgICAgICAgX19wdXRfZ2ZuKHAybSwgZ2ZuKTsK
IAotICAgICAgICBQMk1fUFJJTlRLKCJPSzogbWZuPSUjbHgsIGdmbj0lI2x4LCBwMm1mbj0lI2x4
XG4iLAotICAgICAgICAgICAgICAgICAgICAgICBtZm4sIGdmbiwgbWZuX3gocDJtZm4pKTsKKyAg
ICAgICAgUDJNX1BSSU5USygiT0s6IG1mbj0lIlBSSV9tZm4iLCBnZm49JSNseCwgcDJtZm49JSJQ
UklfbWZuIlxuIiwKKyAgICAgICAgICAgICAgICAgICBtZm5feChtZm4pLCBnZm4sIG1mbl94KHAy
bWZuKSk7CiAgICAgfQogICAgIHNwaW5fdW5sb2NrKCZkLT5wYWdlX2FsbG9jX2xvY2spOwogCmRp
ZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvbW0vcGFnaW5nLmMgYi94ZW4vYXJjaC94ODYvbW0vcGFn
aW5nLmMKaW5kZXggNDY5YmI3NjQyOS4uMmY2ZGY3NDEzNSAxMDA2NDQKLS0tIGEveGVuL2FyY2gv
eDg2L21tL3BhZ2luZy5jCisrKyBiL3hlbi9hcmNoL3g4Ni9tbS9wYWdpbmcuYwpAQCAtMzQ0LDcg
KzM0NCw3IEBAIHZvaWQgcGFnaW5nX21hcmtfZGlydHkoc3RydWN0IGRvbWFpbiAqZCwgbWZuX3Qg
Z21mbikKICAgICAgICAgcmV0dXJuOwogCiAgICAgLyogV2UgL3JlYWxseS8gbWVhbiBQRk4gaGVy
ZSwgZXZlbiBmb3Igbm9uLXRyYW5zbGF0ZWQgZ3Vlc3RzLiAqLwotICAgIHBmbiA9IF9wZm4oZ2V0
X2dwZm5fZnJvbV9tZm4obWZuX3goZ21mbikpKTsKKyAgICBwZm4gPSBfcGZuKGdldF9wZm5fZnJv
bV9tZm4oZ21mbikpOwogCiAgICAgcGFnaW5nX21hcmtfcGZuX2RpcnR5KGQsIHBmbik7CiB9CkBA
IC0zNjIsNyArMzYyLDcgQEAgaW50IHBhZ2luZ19tZm5faXNfZGlydHkoc3RydWN0IGRvbWFpbiAq
ZCwgbWZuX3QgZ21mbikKICAgICBBU1NFUlQocGFnaW5nX21vZGVfbG9nX2RpcnR5KGQpKTsKIAog
ICAgIC8qIFdlIC9yZWFsbHkvIG1lYW4gUEZOIGhlcmUsIGV2ZW4gZm9yIG5vbi10cmFuc2xhdGVk
IGd1ZXN0cy4gKi8KLSAgICBwZm4gPSBfcGZuKGdldF9ncGZuX2Zyb21fbWZuKG1mbl94KGdtZm4p
KSk7CisgICAgcGZuID0gX3BmbihnZXRfcGZuX2Zyb21fbWZuKGdtZm4pKTsKICAgICAvKiBJbnZh
bGlkIHBhZ2VzIGNhbid0IGJlIGRpcnR5LiAqLwogICAgIGlmICggdW5saWtlbHkoIVZBTElEX00y
UChwZm5feChwZm4pKSkgKQogICAgICAgICByZXR1cm4gMDsKZGlmZiAtLWdpdCBhL3hlbi9hcmNo
L3g4Ni9wdi9kb20wX2J1aWxkLmMgYi94ZW4vYXJjaC94ODYvcHYvZG9tMF9idWlsZC5jCmluZGV4
IDhhYmQ1ZDI1NWMuLjlmNTU4YjI5MzIgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9wdi9kb20w
X2J1aWxkLmMKKysrIGIveGVuL2FyY2gveDg2L3B2L2RvbTBfYnVpbGQuYwpAQCAtMzksNyArMzks
NyBAQCB2b2lkIF9faW5pdCBkb20wX3VwZGF0ZV9waHlzbWFwKHN0cnVjdCBkb21haW4gKmQsIHVu
c2lnbmVkIGxvbmcgcGZuLAogICAgIGVsc2UKICAgICAgICAgKCh1bnNpZ25lZCBpbnQgKil2cGh5
c21hcF9zKVtwZm5dID0gbWZuOwogCi0gICAgc2V0X2dwZm5fZnJvbV9tZm4obWZuLCBwZm4pOwor
ICAgIHNldF9wZm5fZnJvbV9tZm4oX21mbihtZm4pLCBwZm4pOwogfQogCiBzdGF0aWMgX19pbml0
IHZvaWQgbWFya19wdl9wdF9wYWdlc19yZG9ubHkoc3RydWN0IGRvbWFpbiAqZCwKQEAgLTc4OSw4
ICs3ODksOCBAQCBpbnQgX19pbml0IGRvbTBfY29uc3RydWN0X3B2KHN0cnVjdCBkb21haW4gKmQs
CiAgICAgcGFnZV9saXN0X2Zvcl9lYWNoICggcGFnZSwgJmQtPnBhZ2VfbGlzdCApCiAgICAgewog
ICAgICAgICBtZm4gPSBtZm5feChwYWdlX3RvX21mbihwYWdlKSk7Ci0gICAgICAgIEJVR19PTihT
SEFSRURfTTJQKGdldF9ncGZuX2Zyb21fbWZuKG1mbikpKTsKLSAgICAgICAgaWYgKCBnZXRfZ3Bm
bl9mcm9tX21mbihtZm4pID49IGNvdW50ICkKKyAgICAgICAgQlVHX09OKFNIQVJFRF9NMlAoZ2V0
X3Bmbl9mcm9tX21mbihfbWZuKG1mbikpKSk7CisgICAgICAgIGlmICggZ2V0X3Bmbl9mcm9tX21m
bihfbWZuKG1mbikpID49IGNvdW50ICkKICAgICAgICAgewogICAgICAgICAgICAgQlVHX09OKGlz
X3B2XzMyYml0X2RvbWFpbihkKSk7CiAgICAgICAgICAgICBpZiAoICFwYWdlLT51LmludXNlLnR5
cGVfaW5mbyAmJgpkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L3g4Nl82NC90cmFwcy5jIGIveGVu
L2FyY2gveDg2L3g4Nl82NC90cmFwcy5jCmluZGV4IDgxMWMyY2IzN2IuLmJmNWMyMDYwZTcgMTAw
NjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni94ODZfNjQvdHJhcHMuYworKysgYi94ZW4vYXJjaC94ODYv
eDg2XzY0L3RyYXBzLmMKQEAgLTIwMCw3ICsyMDAsNyBAQCB2b2lkIHNob3dfcGFnZV93YWxrKHVu
c2lnbmVkIGxvbmcgYWRkcikKICAgICB1bm1hcF9kb21haW5fcGFnZShsNHQpOwogICAgIG1mbiA9
IGw0ZV9nZXRfbWZuKGw0ZSk7CiAgICAgcGZuID0gbWZuX3ZhbGlkKG1mbikgJiYgbWFjaGluZV90
b19waHlzX21hcHBpbmdfdmFsaWQgPwotICAgICAgICAgIGdldF9ncGZuX2Zyb21fbWZuKG1mbl94
KG1mbikpIDogSU5WQUxJRF9NMlBfRU5UUlk7CisgICAgICAgICAgZ2V0X3Bmbl9mcm9tX21mbiht
Zm4pIDogSU5WQUxJRF9NMlBfRU5UUlk7CiAgICAgcHJpbnRrKCIgTDRbMHglMDNseF0gPSAlIlBS
SXB0ZSIgJTAxNmx4XG4iLAogICAgICAgICAgICBsNF90YWJsZV9vZmZzZXQoYWRkciksIGw0ZV9n
ZXRfaW50cHRlKGw0ZSksIHBmbik7CiAgICAgaWYgKCAhKGw0ZV9nZXRfZmxhZ3MobDRlKSAmIF9Q
QUdFX1BSRVNFTlQpIHx8ICFtZm5fdmFsaWQobWZuKSApCkBAIC0yMTEsNyArMjExLDcgQEAgdm9p
ZCBzaG93X3BhZ2Vfd2Fsayh1bnNpZ25lZCBsb25nIGFkZHIpCiAgICAgdW5tYXBfZG9tYWluX3Bh
Z2UobDN0KTsKICAgICBtZm4gPSBsM2VfZ2V0X21mbihsM2UpOwogICAgIHBmbiA9IG1mbl92YWxp
ZChtZm4pICYmIG1hY2hpbmVfdG9fcGh5c19tYXBwaW5nX3ZhbGlkID8KLSAgICAgICAgICBnZXRf
Z3Bmbl9mcm9tX21mbihtZm5feChtZm4pKSA6IElOVkFMSURfTTJQX0VOVFJZOworICAgICAgICAg
IGdldF9wZm5fZnJvbV9tZm4obWZuKSA6IElOVkFMSURfTTJQX0VOVFJZOwogICAgIHByaW50aygi
IEwzWzB4JTAzbHhdID0gJSJQUklwdGUiICUwMTZseCVzXG4iLAogICAgICAgICAgICBsM190YWJs
ZV9vZmZzZXQoYWRkciksIGwzZV9nZXRfaW50cHRlKGwzZSksIHBmbiwKICAgICAgICAgICAgKGwz
ZV9nZXRfZmxhZ3MobDNlKSAmIF9QQUdFX1BTRSkgPyAiIChQU0UpIiA6ICIiKTsKQEAgLTIyNSw3
ICsyMjUsNyBAQCB2b2lkIHNob3dfcGFnZV93YWxrKHVuc2lnbmVkIGxvbmcgYWRkcikKICAgICB1
bm1hcF9kb21haW5fcGFnZShsMnQpOwogICAgIG1mbiA9IGwyZV9nZXRfbWZuKGwyZSk7CiAgICAg
cGZuID0gbWZuX3ZhbGlkKG1mbikgJiYgbWFjaGluZV90b19waHlzX21hcHBpbmdfdmFsaWQgPwot
ICAgICAgICAgIGdldF9ncGZuX2Zyb21fbWZuKG1mbl94KG1mbikpIDogSU5WQUxJRF9NMlBfRU5U
Ulk7CisgICAgICAgICAgZ2V0X3Bmbl9mcm9tX21mbihtZm4pIDogSU5WQUxJRF9NMlBfRU5UUlk7
CiAgICAgcHJpbnRrKCIgTDJbMHglMDNseF0gPSAlIlBSSXB0ZSIgJTAxNmx4JXNcbiIsCiAgICAg
ICAgICAgIGwyX3RhYmxlX29mZnNldChhZGRyKSwgbDJlX2dldF9pbnRwdGUobDJlKSwgcGZuLAog
ICAgICAgICAgICAobDJlX2dldF9mbGFncyhsMmUpICYgX1BBR0VfUFNFKSA/ICIgKFBTRSkiIDog
IiIpOwpAQCAtMjM5LDcgKzIzOSw3IEBAIHZvaWQgc2hvd19wYWdlX3dhbGsodW5zaWduZWQgbG9u
ZyBhZGRyKQogICAgIHVubWFwX2RvbWFpbl9wYWdlKGwxdCk7CiAgICAgbWZuID0gbDFlX2dldF9t
Zm4obDFlKTsKICAgICBwZm4gPSBtZm5fdmFsaWQobWZuKSAmJiBtYWNoaW5lX3RvX3BoeXNfbWFw
cGluZ192YWxpZCA/Ci0gICAgICAgICAgZ2V0X2dwZm5fZnJvbV9tZm4obWZuX3gobWZuKSkgOiBJ
TlZBTElEX00yUF9FTlRSWTsKKyAgICAgICAgICBnZXRfcGZuX2Zyb21fbWZuKG1mbikgOiBJTlZB
TElEX00yUF9FTlRSWTsKICAgICBwcmludGsoIiBMMVsweCUwM2x4XSA9ICUiUFJJcHRlIiAlMDE2
bHhcbiIsCiAgICAgICAgICAgIGwxX3RhYmxlX29mZnNldChhZGRyKSwgbDFlX2dldF9pbnRwdGUo
bDFlKSwgcGZuKTsKIH0KZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vcGFnZV9hbGxvYy5jIGIveGVu
L2NvbW1vbi9wYWdlX2FsbG9jLmMKaW5kZXggNDFlNGZhODk5ZC4uMjM5YWFjMThkZCAxMDA2NDQK
LS0tIGEveGVuL2NvbW1vbi9wYWdlX2FsbG9jLmMKKysrIGIveGVuL2NvbW1vbi9wYWdlX2FsbG9j
LmMKQEAgLTE0MzAsNyArMTQzMCw3IEBAIHN0YXRpYyB2b2lkIGZyZWVfaGVhcF9wYWdlcygKIAog
ICAgICAgICAvKiBUaGlzIHBhZ2UgaXMgbm90IGEgZ3Vlc3QgZnJhbWUgYW55IG1vcmUuICovCiAg
ICAgICAgIHBhZ2Vfc2V0X293bmVyKCZwZ1tpXSwgTlVMTCk7IC8qIHNldF9ncGZuX2Zyb21fbWZu
IHNub29wcyBwZyBvd25lciAqLwotICAgICAgICBzZXRfZ3Bmbl9mcm9tX21mbihtZm5feChtZm4p
ICsgaSwgSU5WQUxJRF9NMlBfRU5UUlkpOworICAgICAgICBzZXRfcGZuX2Zyb21fbWZuKG1mbl9h
ZGQobWZuLCBpKSwgSU5WQUxJRF9NMlBfRU5UUlkpOwogCiAgICAgICAgIGlmICggbmVlZF9zY3J1
YiApCiAgICAgICAgIHsKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL2FzbS1hcm0vbW0uaCBiL3hl
bi9pbmNsdWRlL2FzbS1hcm0vbW0uaAppbmRleCBhYmY0Y2MyM2U0Li4xMTYxNGY5MTA3IDEwMDY0
NAotLS0gYS94ZW4vaW5jbHVkZS9hc20tYXJtL21tLmgKKysrIGIveGVuL2luY2x1ZGUvYXNtLWFy
bS9tbS5oCkBAIC0zMTksNyArMzE5LDcgQEAgc3RydWN0IHBhZ2VfaW5mbyAqZ2V0X3BhZ2VfZnJv
bV9ndmEoc3RydWN0IHZjcHUgKnYsIHZhZGRyX3QgdmEsCiAjZGVmaW5lIFNIQVJFRF9NMlAoX2Up
ICAgICAgICAgICAoKF9lKSA9PSBTSEFSRURfTTJQX0VOVFJZKQogCiAvKiBYZW4gYWx3YXlzIG93
bnMgUDJNIG9uIEFSTSAqLwotI2RlZmluZSBzZXRfZ3Bmbl9mcm9tX21mbihtZm4sIHBmbikgZG8g
eyAodm9pZCkgKG1mbiksICh2b2lkKShwZm4pOyB9IHdoaWxlICgwKQorc3RhdGljIGlubGluZSB2
b2lkIHNldF9wZm5fZnJvbV9tZm4obWZuX3QgbWZuLCB1bnNpZ25lZCBsb25nIHBmbikge30KICNk
ZWZpbmUgbWZuX3RvX2dtZm4oX2QsIG1mbikgIChtZm4pCiAKIApkaWZmIC0tZ2l0IGEveGVuL2lu
Y2x1ZGUvYXNtLXg4Ni9ncmFudF90YWJsZS5oIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9ncmFudF90
YWJsZS5oCmluZGV4IDU4NzEyMzhmNmQuLmI2YTA5YzRjNmMgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNs
dWRlL2FzbS14ODYvZ3JhbnRfdGFibGUuaAorKysgYi94ZW4vaW5jbHVkZS9hc20teDg2L2dyYW50
X3RhYmxlLmgKQEAgLTQxLDcgKzQxLDcgQEAgc3RhdGljIGlubGluZSBpbnQgcmVwbGFjZV9ncmFu
dF9ob3N0X21hcHBpbmcodWludDY0X3QgYWRkciwgbWZuX3QgZnJhbWUsCiAjZGVmaW5lIGdudHRh
Yl9nZXRfZnJhbWVfZ2ZuKGd0LCBzdCwgaWR4KSAoeyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgXAogICAgIG1mbl90IG1mbl8gPSAoc3QpID8gZ250dGFiX3N0YXR1c19tZm4oZ3QsIGlkeCkg
ICAgICAgICAgICAgICAgICAgICAgIFwKICAgICAgICAgICAgICAgICAgICAgICA6IGdudHRhYl9z
aGFyZWRfbWZuKGd0LCBpZHgpOyAgICAgICAgICAgICAgICAgICAgICBcCi0gICAgdW5zaWduZWQg
bG9uZyBncGZuXyA9IGdldF9ncGZuX2Zyb21fbWZuKG1mbl94KG1mbl8pKTsgICAgICAgICAgICAg
ICAgXAorICAgIHVuc2lnbmVkIGxvbmcgZ3Bmbl8gPSBnZXRfcGZuX2Zyb21fbWZuKG1mbl8pOyAg
ICAgICAgICAgICAgICAgICAgICAgIFwKICAgICBWQUxJRF9NMlAoZ3Bmbl8pID8gX2dmbihncGZu
XykgOiBJTlZBTElEX0dGTjsgICAgICAgICAgICAgICAgICAgICAgICBcCiB9KQogCmRpZmYgLS1n
aXQgYS94ZW4vaW5jbHVkZS9hc20teDg2L21tLmggYi94ZW4vaW5jbHVkZS9hc20teDg2L21tLmgK
aW5kZXggNTNmMmVkN2M3ZC4uMmE0ZjQyZTc4ZiAxMDA2NDQKLS0tIGEveGVuL2luY2x1ZGUvYXNt
LXg4Ni9tbS5oCisrKyBiL3hlbi9pbmNsdWRlL2FzbS14ODYvbW0uaApAQCAtNTAwLDkgKzUwMCwx
MCBAQCBleHRlcm4gcGFkZHJfdCBtZW1faG90cGx1ZzsKICAqLwogZXh0ZXJuIGJvb2wgbWFjaGlu
ZV90b19waHlzX21hcHBpbmdfdmFsaWQ7CiAKLXN0YXRpYyBpbmxpbmUgdm9pZCBzZXRfZ3Bmbl9m
cm9tX21mbih1bnNpZ25lZCBsb25nIG1mbiwgdW5zaWduZWQgbG9uZyBwZm4pCitzdGF0aWMgaW5s
aW5lIHZvaWQgc2V0X3Bmbl9mcm9tX21mbihtZm5fdCBtZm5fLCB1bnNpZ25lZCBsb25nIHBmbikK
IHsKLSAgICBjb25zdCBzdHJ1Y3QgZG9tYWluICpkID0gcGFnZV9nZXRfb3duZXIobWZuX3RvX3Bh
Z2UoX21mbihtZm4pKSk7CisgICAgY29uc3QgdW5zaWduZWQgbG9uZyBtZm4gPSBtZm5feChtZm5f
KTsKKyAgICBjb25zdCBzdHJ1Y3QgZG9tYWluICpkID0gcGFnZV9nZXRfb3duZXIobWZuX3RvX3Bh
Z2UobWZuXykpOwogICAgIHVuc2lnbmVkIGxvbmcgZW50cnkgPSAoZCAmJiAoZCA9PSBkb21fY293
KSkgPyBTSEFSRURfTTJQX0VOVFJZIDogcGZuOwogCiAgICAgaWYgKCAhbWFjaGluZV90b19waHlz
X21hcHBpbmdfdmFsaWQgKQpAQCAtNTE1LDExICs1MTYsMTQgQEAgc3RhdGljIGlubGluZSB2b2lk
IHNldF9ncGZuX2Zyb21fbWZuKHVuc2lnbmVkIGxvbmcgbWZuLCB1bnNpZ25lZCBsb25nIHBmbikK
IAogZXh0ZXJuIHN0cnVjdCByYW5nZXNldCAqbW1pb19yb19yYW5nZXM7CiAKLSNkZWZpbmUgZ2V0
X2dwZm5fZnJvbV9tZm4obWZuKSAgICAgIChtYWNoaW5lX3RvX3BoeXNfbWFwcGluZ1sobWZuKV0p
CitzdGF0aWMgaW5saW5lIHVuc2lnbmVkIGxvbmcgZ2V0X3Bmbl9mcm9tX21mbihtZm5fdCBtZm4p
Cit7CisgICAgcmV0dXJuIG1hY2hpbmVfdG9fcGh5c19tYXBwaW5nW21mbl94KG1mbildOworfQog
CiAjZGVmaW5lIG1mbl90b19nbWZuKF9kLCBtZm4pICAgICAgICAgICAgICAgICAgICAgICAgICAg
IFwKICAgICAoIChwYWdpbmdfbW9kZV90cmFuc2xhdGUoX2QpKSAgICAgICAgICAgICAgICAgICAg
ICAgXAotICAgICAgPyBnZXRfZ3Bmbl9mcm9tX21mbihtZm4pICAgICAgICAgICAgICAgICAgICAg
ICAgICBcCisgICAgICA/IGdldF9wZm5fZnJvbV9tZm4oX21mbihtZm4pKSAgICAgICAgICAgICAg
ICAgICAgIFwKICAgICAgIDogKG1mbikgKQogCiAjZGVmaW5lIGNvbXBhdF9wZm5fdG9fY3IzKHBm
bikgKCgodW5zaWduZWQpKHBmbikgPDwgMTIpIHwgKCh1bnNpZ25lZCkocGZuKSA+PiAyMCkpCmRp
ZmYgLS1naXQgYS94ZW4vaW5jbHVkZS9hc20teDg2L3AybS5oIGIveGVuL2luY2x1ZGUvYXNtLXg4
Ni9wMm0uaAppbmRleCBhMmM2MDQ5ODM0Li4zOWRhZTI0MmIwIDEwMDY0NAotLS0gYS94ZW4vaW5j
bHVkZS9hc20teDg2L3AybS5oCisrKyBiL3hlbi9pbmNsdWRlL2FzbS14ODYvcDJtLmgKQEAgLTUw
NSw3ICs1MDUsNyBAQCBzdGF0aWMgaW5saW5lIHN0cnVjdCBwYWdlX2luZm8gKmdldF9wYWdlX2Zy
b21fZ2ZuKAogc3RhdGljIGlubGluZSBnZm5fdCBtZm5fdG9fZ2ZuKGNvbnN0IHN0cnVjdCBkb21h
aW4gKmQsIG1mbl90IG1mbikKIHsKICAgICBpZiAoIHBhZ2luZ19tb2RlX3RyYW5zbGF0ZShkKSAp
Ci0gICAgICAgIHJldHVybiBfZ2ZuKGdldF9ncGZuX2Zyb21fbWZuKG1mbl94KG1mbikpKTsKKyAg
ICAgICAgcmV0dXJuIF9nZm4oZ2V0X3Bmbl9mcm9tX21mbihtZm4pKTsKICAgICBlbHNlCiAgICAg
ICAgIHJldHVybiBfZ2ZuKG1mbl94KG1mbikpOwogfQotLSAKMi4xNy4xCgoKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlz
dApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0
Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

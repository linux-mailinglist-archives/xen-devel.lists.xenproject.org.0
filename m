Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id A055A14EF18
	for <lists+xen-devel@lfdr.de>; Fri, 31 Jan 2020 16:04:34 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1ixXoQ-00066S-OS; Fri, 31 Jan 2020 15:02:26 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=Qch3=3U=amazon.co.uk=prvs=292a3fd2f=pdurrant@srs-us1.protection.inumbo.net>)
 id 1ixXoP-00065x-Q5
 for xen-devel@lists.xenproject.org; Fri, 31 Jan 2020 15:02:25 +0000
X-Inumbo-ID: b0cd9d24-443a-11ea-8bd7-12813bfff9fa
Received: from smtp-fw-2101.amazon.com (unknown [72.21.196.25])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id b0cd9d24-443a-11ea-8bd7-12813bfff9fa;
 Fri, 31 Jan 2020 15:02:25 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amazon.com; i=@amazon.com; q=dns/txt; s=amazon201209;
 t=1580482945; x=1612018945;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=5x+OENu68t6YZffN+G3PY+oToIv5fD8CxlNpVlIv3fc=;
 b=T4unkfINuX7LFirhB6U7r2nRMK45sj3B/Kn3bFcZ1kj9PcTSLtxZKxhd
 eh9USUdFGjlBLFwLolzpRraxkM3YhjIghhmm4Kj8ZO+pnGsfPW825xmV0
 ohngyMofo6Car/ihrImVO4qhRFbft5elLjWAc9E/UdVWn/snkjbzcEIlK I=;
IronPort-SDR: oTYv0VWnUJrX8Yo8jEGvGKrz3yOgIQxE6QfZn5Fe4EkDEYjhkl7HZdzuRxQ+MZYw0Ehc1Aik9Y
 203++rGT1IYw==
X-IronPort-AV: E=Sophos;i="5.70,386,1574121600"; d="scan'208";a="15104689"
Received: from iad12-co-svc-p1-lb1-vlan2.amazon.com (HELO
 email-inbound-relay-2a-53356bf6.us-west-2.amazon.com) ([10.43.8.2])
 by smtp-border-fw-out-2101.iad2.amazon.com with ESMTP;
 31 Jan 2020 15:02:25 +0000
Received: from EX13MTAUEA002.ant.amazon.com
 (pdx4-ws-svc-p6-lb7-vlan2.pdx.amazon.com [10.170.41.162])
 by email-inbound-relay-2a-53356bf6.us-west-2.amazon.com (Postfix) with ESMTPS
 id 95026A2D20; Fri, 31 Jan 2020 15:02:23 +0000 (UTC)
Received: from EX13D32EUC001.ant.amazon.com (10.43.164.159) by
 EX13MTAUEA002.ant.amazon.com (10.43.61.77) with Microsoft SMTP Server (TLS)
 id 15.0.1236.3; Fri, 31 Jan 2020 15:02:05 +0000
Received: from EX13MTAUEE002.ant.amazon.com (10.43.62.24) by
 EX13D32EUC001.ant.amazon.com (10.43.164.159) with Microsoft SMTP Server (TLS)
 id 15.0.1367.3; Fri, 31 Jan 2020 15:02:04 +0000
Received: from u2f063a87eabd5f.cbg10.amazon.com (10.125.106.135) by
 mail-relay.amazon.com (10.43.62.224) with Microsoft SMTP Server id
 15.0.1367.3 via Frontend Transport; Fri, 31 Jan 2020 15:02:03 +0000
From: Paul Durrant <pdurrant@amazon.com>
To: <xen-devel@lists.xenproject.org>
Date: Fri, 31 Jan 2020 15:01:49 +0000
Message-ID: <20200131150149.2008-8-pdurrant@amazon.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20200131150149.2008-1-pdurrant@amazon.com>
References: <20200131150149.2008-1-pdurrant@amazon.com>
MIME-Version: 1.0
Precedence: Bulk
Subject: [Xen-devel] [PATCH v5 7/7] xl: allow domid to be preserved on
 save/restore or migrate
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Anthony PERARD <anthony.perard@citrix.com>,
 Paul Durrant <pdurrant@amazon.com>, Ian Jackson <ian.jackson@eu.citrix.com>,
 Wei Liu <wl@xen.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhpcyBwYXRjaCBhZGRzIGEgJy1EJyBjb21tYW5kIGxpbmUgb3B0aW9uIHRvIHNhdmUgYW5kIG1p
Z3JhdGUgdG8gYWxsb3cKdGhlIGRvbWFpbiBpZCB0byBiZSBpbmNvcnBvcmF0ZWQgaW50byB0aGUg
c2F2ZWQgZG9tYWluIGNvbmZpZ3VyYXRpb24gYW5kCmhlbmNlIGJlIHByZXNlcnZlZC4KCk5PVEU6
IExvZ2ljYWxseSBpdCBtYXkgc2VlbSBhcyB0aG91Z2ggcHJlc2VydmF0aW9uIG9mIGRvbWlkIHNo
b3VsZCBiZQogICAgICBkZWFsdCB3aXRoIGJ5IGxpYnhsLCBidXQgdGhlIGxpYnhsIG1pZ3JhdGlv
biBzdHJlYW0gaGFzIG5vIHJlY29yZAogICAgICBpbiB3aGljaCB0byB0cmFuc2ZlciBkb21pZCBh
bmQgcmVtb3RlIGRvbWFpbiBjcmVhdGlvbiBvY2N1cnMgYmVmb3JlCiAgICAgIHRoZSBtaWdyYXRp
b24gc3RyZWFtIGlzIHBhcnNlZC4gSGVuY2UgdGhpcyBwYXRjaCBtb2RpZmllcyB4bCByYXRoZXIK
ICAgICAgdGhlbiBsaWJ4bC4KClNpZ25lZC1vZmYtYnk6IFBhdWwgRHVycmFudCA8cGR1cnJhbnRA
YW1hem9uLmNvbT4KLS0tCkNjOiBJYW4gSmFja3NvbiA8aWFuLmphY2tzb25AZXUuY2l0cml4LmNv
bT4KQ2M6IFdlaSBMaXUgPHdsQHhlbi5vcmc+CkNjOiBBbnRob255IFBFUkFSRCA8YW50aG9ueS5w
ZXJhcmRAY2l0cml4LmNvbT4KCnY1OgogLSBFeHBhbmQgdGhlIGNvbW1pdCBjb21tZW50IHRvIHNh
eSB3aHkgaXQgaXMgeGwgYmVpbmcgcGF0Y2hlZCByYXRoZXIKICAgdGhhbiBsaWJ4bAoKdjI6CiAt
IEhlYXZpbHkgcmUtd29ya2VkIGJhc2VkIG9uIG5ldyBsaWJ4bF9kb21haW5fY3JlYXRlX2luZm8K
LS0tCiBkb2NzL21hbi94bC4xLnBvZC5pbiAgICAgIHwgMTQgKysrKysrKysrKysrKysKIHRvb2xz
L3hsL3hsLmggICAgICAgICAgICAgfCAgMSArCiB0b29scy94bC94bF9jbWR0YWJsZS5jICAgIHwg
IDYgKysrKy0tCiB0b29scy94bC94bF9taWdyYXRlLmMgICAgIHwgMTUgKysrKysrKysrKy0tLS0t
CiB0b29scy94bC94bF9zYXZlcmVzdG9yZS5jIHwgMTkgKysrKysrKysrKysrKystLS0tLQogdG9v
bHMveGwveGxfdm1jb250cm9sLmMgICB8ICAzICsrLQogNiBmaWxlcyBjaGFuZ2VkLCA0NSBpbnNl
cnRpb25zKCspLCAxMyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kb2NzL21hbi94bC4xLnBv
ZC5pbiBiL2RvY3MvbWFuL3hsLjEucG9kLmluCmluZGV4IDMzYWQyZWJkNzEuLjA5MzM5MjgyZTYg
MTAwNjQ0Ci0tLSBhL2RvY3MvbWFuL3hsLjEucG9kLmluCisrKyBiL2RvY3MvbWFuL3hsLjEucG9k
LmluCkBAIC00OTAsNiArNDkwLDEzIEBAIERpc3BsYXkgaHVnZSAoISkgYW1vdW50IG9mIGRlYnVn
IGluZm9ybWF0aW9uIGR1cmluZyB0aGUgbWlncmF0aW9uIHByb2Nlc3MuCiAKIExlYXZlIHRoZSBk
b21haW4gb24gdGhlIHJlY2VpdmUgc2lkZSBwYXVzZWQgYWZ0ZXIgbWlncmF0aW9uLgogCis9aXRl
bSBCPC1EPgorCitQcmVzZXJ2ZSB0aGUgQjxkb21haW4taWQ+IGluIHRoZSBkb21haW4gY29uaWd1
cmF0aW9uIHRoYXQgaXMgdHJhbnNmZXJyZWQKK3N1Y2ggdGhhdCBpdCB3aWxsIGJlIGlkZW50aWNh
bCBvbiB0aGUgZGVzdGluYXRpb24gaG9zdCwgdW5sZXNzIHRoYXQKK2NvbmZpZ3VyYXRpb24gaXMg
b3ZlcnJpZGRlbiB1c2luZyB0aGUgQjwtQz4gb3B0aW9uLiBOb3RlIHRoYXQgaXQgaXMgbm90Citw
b3NzaWJsZSB0byB1c2UgdGhpcyBvcHRpb24gZm9yIGEgJ2xvY2FsaG9zdCcgbWlncmF0aW9uLgor
CiA9YmFjawogCiA9aXRlbSBCPHJlbXVzPiBbSTxPUFRJT05TPl0gSTxkb21haW4taWQ+IEk8aG9z
dD4KQEAgLTY5Miw2ICs2OTksMTMgQEAgTGVhdmUgdGhlIGRvbWFpbiBydW5uaW5nIGFmdGVyIGNy
ZWF0aW5nIHRoZSBzbmFwc2hvdC4KIAogTGVhdmUgdGhlIGRvbWFpbiBwYXVzZWQgYWZ0ZXIgY3Jl
YXRpbmcgdGhlIHNuYXBzaG90LgogCis9aXRlbSBCPC1EPgorCitQcmVzZXJ2ZSB0aGUgQjxkb21h
aW4taWQ+IGluIHRoZSBkb21haW4gY29uaWd1cmF0aW9uIHRoYXQgaXMgZW1iZWRkZWQgaW4KK3Ro
ZSBzdGF0ZSBmaWxlIHN1Y2ggdGhhdCBpdCB3aWxsIGJlIGlkZW50aWNhbCB3aGVuIHRoZSBkb21h
aW4gaXMgcmVzdG9yZWQsCit1bmxlc3MgdGhhdCBjb25maWd1cmF0aW9uIGlzIG92ZXJyaWRkZW4u
IChTZWUgdGhlIEI8cmVzdG9yZT4gb3BlcmF0aW9uCithYm92ZSkuCisKID1iYWNrCiAKID1pdGVt
IEI8c2hhcmluZz4gW0k8ZG9tYWluLWlkPl0KZGlmZiAtLWdpdCBhL3Rvb2xzL3hsL3hsLmggYi90
b29scy94bC94bC5oCmluZGV4IDJiNDcwOWVmYjIuLjA2NTY5YzZjNGEgMTAwNjQ0Ci0tLSBhL3Rv
b2xzL3hsL3hsLmgKKysrIGIvdG9vbHMveGwveGwuaApAQCAtOTksNiArOTksNyBAQCBzdHJ1Y3Qg
c2F2ZV9maWxlX2hlYWRlciB7CiAjZGVmaW5lIFNBVkVGSUxFX0JZVEVPUkRFUl9WQUxVRSAoKHVp
bnQzMl90KTB4MDEwMjAzMDRVTCkKIAogdm9pZCBzYXZlX2RvbWFpbl9jb3JlX2JlZ2luKHVpbnQz
Ml90IGRvbWlkLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBwcmVzZXJ2ZV9kb21p
ZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGFyICpvdmVycmlkZV9jb25m
aWdfZmlsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50OF90ICoqY29uZmlnX2Rh
dGFfciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgKmNvbmZpZ19sZW5fcik7CmRp
ZmYgLS1naXQgYS90b29scy94bC94bF9jbWR0YWJsZS5jIGIvdG9vbHMveGwveGxfY21kdGFibGUu
YwppbmRleCAzYjMwMmIyZjIwLi4wODMzNTM5NGU1IDEwMDY0NAotLS0gYS90b29scy94bC94bF9j
bWR0YWJsZS5jCisrKyBiL3Rvb2xzL3hsL3hsX2NtZHRhYmxlLmMKQEAgLTE1Myw3ICsxNTMsOCBA
QCBzdHJ1Y3QgY21kX3NwZWMgY21kX3RhYmxlW10gPSB7CiAgICAgICAiW29wdGlvbnNdIDxEb21h
aW4+IDxDaGVja3BvaW50RmlsZT4gWzxDb25maWdGaWxlPl0iLAogICAgICAgIi1oICBQcmludCB0
aGlzIGhlbHAuXG4iCiAgICAgICAiLWMgIExlYXZlIGRvbWFpbiBydW5uaW5nIGFmdGVyIGNyZWF0
aW5nIHRoZSBzbmFwc2hvdC5cbiIKLSAgICAgICItcCAgTGVhdmUgZG9tYWluIHBhdXNlZCBhZnRl
ciBjcmVhdGluZyB0aGUgc25hcHNob3QuIgorICAgICAgIi1wICBMZWF2ZSBkb21haW4gcGF1c2Vk
IGFmdGVyIGNyZWF0aW5nIHRoZSBzbmFwc2hvdC5cbiIKKyAgICAgICItRCAgU3RvcmUgdGhlIGRv
bWFpbiBpZCBpbiB0aGUgY29uZmlncmF0aW9uLiIKICAgICB9LAogICAgIHsgIm1pZ3JhdGUiLAog
ICAgICAgJm1haW5fbWlncmF0ZSwgMCwgMSwKQEAgLTE2Nyw3ICsxNjgsOCBAQCBzdHJ1Y3QgY21k
X3NwZWMgY21kX3RhYmxlW10gPSB7CiAgICAgICAiLWUgICAgICAgICAgICAgIERvIG5vdCB3YWl0
IGluIHRoZSBiYWNrZ3JvdW5kIChvbiA8aG9zdD4pIGZvciB0aGUgZGVhdGhcbiIKICAgICAgICIg
ICAgICAgICAgICAgICAgb2YgdGhlIGRvbWFpbi5cbiIKICAgICAgICItLWRlYnVnICAgICAgICAg
UHJpbnQgaHVnZSAoISkgYW1vdW50IG9mIGRlYnVnIGR1cmluZyB0aGUgbWlncmF0aW9uIHByb2Nl
c3MuXG4iCi0gICAgICAiLXAgICAgICAgICAgICAgIERvIG5vdCB1bnBhdXNlIGRvbWFpbiBhZnRl
ciBtaWdyYXRpbmcgaXQuIgorICAgICAgIi1wICAgICAgICAgICAgICBEbyBub3QgdW5wYXVzZSBk
b21haW4gYWZ0ZXIgbWlncmF0aW5nIGl0LlxuIgorICAgICAgIi1EICAgICAgICAgICAgICBQcmVz
ZXJ2ZSB0aGUgZG9tYWluIGlkIgogICAgIH0sCiAgICAgeyAicmVzdG9yZSIsCiAgICAgICAmbWFp
bl9yZXN0b3JlLCAwLCAxLApkaWZmIC0tZ2l0IGEvdG9vbHMveGwveGxfbWlncmF0ZS5jIGIvdG9v
bHMveGwveGxfbWlncmF0ZS5jCmluZGV4IDIyZjA0MjliODQuLjA4MTNiZWI4MDEgMTAwNjQ0Ci0t
LSBhL3Rvb2xzL3hsL3hsX21pZ3JhdGUuYworKysgYi90b29scy94bC94bF9taWdyYXRlLmMKQEAg
LTE3Niw3ICsxNzYsOCBAQCBzdGF0aWMgdm9pZCBtaWdyYXRlX2RvX3ByZWFtYmxlKGludCBzZW5k
X2ZkLCBpbnQgcmVjdl9mZCwgcGlkX3QgY2hpbGQsCiAKIH0KIAotc3RhdGljIHZvaWQgbWlncmF0
ZV9kb21haW4odWludDMyX3QgZG9taWQsIGNvbnN0IGNoYXIgKnJ1bmUsIGludCBkZWJ1ZywKK3N0
YXRpYyB2b2lkIG1pZ3JhdGVfZG9tYWluKHVpbnQzMl90IGRvbWlkLCBpbnQgcHJlc2VydmVfZG9t
aWQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGFyICpydW5lLCBpbnQgZGVi
dWcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGFyICpvdmVycmlkZV9jb25m
aWdfZmlsZSkKIHsKICAgICBwaWRfdCBjaGlsZCA9IC0xOwpAQCAtMTg3LDcgKzE4OCw3IEBAIHN0
YXRpYyB2b2lkIG1pZ3JhdGVfZG9tYWluKHVpbnQzMl90IGRvbWlkLCBjb25zdCBjaGFyICpydW5l
LCBpbnQgZGVidWcsCiAgICAgdWludDhfdCAqY29uZmlnX2RhdGE7CiAgICAgaW50IGNvbmZpZ19s
ZW4sIGZsYWdzID0gTElCWExfU1VTUEVORF9MSVZFOwogCi0gICAgc2F2ZV9kb21haW5fY29yZV9i
ZWdpbihkb21pZCwgb3ZlcnJpZGVfY29uZmlnX2ZpbGUsCisgICAgc2F2ZV9kb21haW5fY29yZV9i
ZWdpbihkb21pZCwgcHJlc2VydmVfZG9taWQsIG92ZXJyaWRlX2NvbmZpZ19maWxlLAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgJmNvbmZpZ19kYXRhLCAmY29uZmlnX2xlbik7CiAKICAgICBp
ZiAoIWNvbmZpZ19sZW4pIHsKQEAgLTUzNywxMyArNTM4LDE0IEBAIGludCBtYWluX21pZ3JhdGUo
aW50IGFyZ2MsIGNoYXIgKiphcmd2KQogICAgIGNoYXIgKnJ1bmUgPSBOVUxMOwogICAgIGNoYXIg
Kmhvc3Q7CiAgICAgaW50IG9wdCwgZGFlbW9uaXplID0gMSwgbW9uaXRvciA9IDEsIGRlYnVnID0g
MCwgcGF1c2VfYWZ0ZXJfbWlncmF0aW9uID0gMDsKKyAgICBpbnQgcHJlc2VydmVfZG9taWQgPSAw
OwogICAgIHN0YXRpYyBzdHJ1Y3Qgb3B0aW9uIG9wdHNbXSA9IHsKICAgICAgICAgeyJkZWJ1ZyIs
IDAsIDAsIDB4MTAwfSwKICAgICAgICAgeyJsaXZlIiwgMCwgMCwgMHgyMDB9LAogICAgICAgICBD
T01NT05fTE9OR19PUFRTCiAgICAgfTsKIAotICAgIFNXSVRDSF9GT1JFQUNIX09QVChvcHQsICJG
QzpzOmVwIiwgb3B0cywgIm1pZ3JhdGUiLCAyKSB7CisgICAgU1dJVENIX0ZPUkVBQ0hfT1BUKG9w
dCwgIkZDOnM6ZXBEIiwgb3B0cywgIm1pZ3JhdGUiLCAyKSB7CiAgICAgY2FzZSAnQyc6CiAgICAg
ICAgIGNvbmZpZ19maWxlbmFtZSA9IG9wdGFyZzsKICAgICAgICAgYnJlYWs7CkBAIC01NjAsNiAr
NTYyLDkgQEAgaW50IG1haW5fbWlncmF0ZShpbnQgYXJnYywgY2hhciAqKmFyZ3YpCiAgICAgY2Fz
ZSAncCc6CiAgICAgICAgIHBhdXNlX2FmdGVyX21pZ3JhdGlvbiA9IDE7CiAgICAgICAgIGJyZWFr
OworICAgIGNhc2UgJ0QnOgorICAgICAgICBwcmVzZXJ2ZV9kb21pZCA9IDE7CisgICAgICAgIGJy
ZWFrOwogICAgIGNhc2UgMHgxMDA6IC8qIC0tZGVidWcgKi8KICAgICAgICAgZGVidWcgPSAxOwog
ICAgICAgICBicmVhazsKQEAgLTU5Niw3ICs2MDEsNyBAQCBpbnQgbWFpbl9taWdyYXRlKGludCBh
cmdjLCBjaGFyICoqYXJndikKICAgICAgICAgICAgICAgICAgIHBhdXNlX2FmdGVyX21pZ3JhdGlv
biA/ICIgLXAiIDogIiIpOwogICAgIH0KIAotICAgIG1pZ3JhdGVfZG9tYWluKGRvbWlkLCBydW5l
LCBkZWJ1ZywgY29uZmlnX2ZpbGVuYW1lKTsKKyAgICBtaWdyYXRlX2RvbWFpbihkb21pZCwgcHJl
c2VydmVfZG9taWQsIHJ1bmUsIGRlYnVnLCBjb25maWdfZmlsZW5hbWUpOwogICAgIHJldHVybiBF
WElUX1NVQ0NFU1M7CiB9CiAKQEAgLTcxNiw3ICs3MjEsNyBAQCBpbnQgbWFpbl9yZW11cyhpbnQg
YXJnYywgY2hhciAqKmFyZ3YpCiAgICAgICAgICAgICB9CiAgICAgICAgIH0KIAotICAgICAgICBz
YXZlX2RvbWFpbl9jb3JlX2JlZ2luKGRvbWlkLCBOVUxMLCAmY29uZmlnX2RhdGEsICZjb25maWdf
bGVuKTsKKyAgICAgICAgc2F2ZV9kb21haW5fY29yZV9iZWdpbihkb21pZCwgMCwgTlVMTCwgJmNv
bmZpZ19kYXRhLCAmY29uZmlnX2xlbik7CiAKICAgICAgICAgaWYgKCFjb25maWdfbGVuKSB7CiAg
ICAgICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIk5vIGNvbmZpZyBmaWxlIHN0b3JlZCBmb3IgcnVu
bmluZyBkb21haW4gYW5kICIKZGlmZiAtLWdpdCBhL3Rvb2xzL3hsL3hsX3NhdmVyZXN0b3JlLmMg
Yi90b29scy94bC94bF9zYXZlcmVzdG9yZS5jCmluZGV4IDliZTAzM2ZlNjUuLjk1M2Q3OTFkMWEg
MTAwNjQ0Ci0tLSBhL3Rvb2xzL3hsL3hsX3NhdmVyZXN0b3JlLmMKKysrIGIvdG9vbHMveGwveGxf
c2F2ZXJlc3RvcmUuYwpAQCAtMzIsNiArMzIsNyBAQAogI2lmbmRlZiBMSUJYTF9IQVZFX05PX1NV
U1BFTkRfUkVTVU1FCiAKIHZvaWQgc2F2ZV9kb21haW5fY29yZV9iZWdpbih1aW50MzJfdCBkb21p
ZCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgcHJlc2VydmVfZG9taWQsCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hhciAqb3ZlcnJpZGVfY29uZmlnX2ZpbGUs
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDhfdCAqKmNvbmZpZ19kYXRhX3IsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ICpjb25maWdfbGVuX3IpCkBAIC02Miw2ICs2
Myw4IEBAIHZvaWQgc2F2ZV9kb21haW5fY29yZV9iZWdpbih1aW50MzJfdCBkb21pZCwKICAgICAg
ICAgICAgIGZwcmludGYoc3RkZXJyLCAidW5hYmxlIHRvIHJldHJpZXZlIGRvbWFpbiBjb25maWd1
cmF0aW9uXG4iKTsKICAgICAgICAgICAgIGV4aXQoRVhJVF9GQUlMVVJFKTsKICAgICAgICAgfQor
CisgICAgICAgIGRfY29uZmlnLmNfaW5mby5kb21pZCA9IHByZXNlcnZlX2RvbWlkID8gZG9taWQg
OiAwOwogICAgIH0KIAogICAgIGNvbmZpZ19jID0gbGlieGxfZG9tYWluX2NvbmZpZ190b19qc29u
KGN0eCwgJmRfY29uZmlnKTsKQEAgLTEyMCwxNCArMTIzLDE1IEBAIHZvaWQgc2F2ZV9kb21haW5f
Y29yZV93cml0ZWNvbmZpZyhpbnQgZmQsIGNvbnN0IGNoYXIgKnNvdXJjZSwKICAgICAgICAgICAg
IGhkci5vcHRpb25hbF9kYXRhX2xlbik7CiB9CiAKLXN0YXRpYyBpbnQgc2F2ZV9kb21haW4odWlu
dDMyX3QgZG9taWQsIGNvbnN0IGNoYXIgKmZpbGVuYW1lLCBpbnQgY2hlY2twb2ludCwKLSAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBpbnQgbGVhdmVwYXVzZWQsIGNvbnN0IGNoYXIgKm92ZXJy
aWRlX2NvbmZpZ19maWxlKQorc3RhdGljIGludCBzYXZlX2RvbWFpbih1aW50MzJfdCBkb21pZCwg
aW50IHByZXNlcnZlX2RvbWlkLAorICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGFyICpm
aWxlbmFtZSwgaW50IGNoZWNrcG9pbnQsCisgICAgICAgICAgICAgICAgICAgICAgIGludCBsZWF2
ZXBhdXNlZCwgY29uc3QgY2hhciAqb3ZlcnJpZGVfY29uZmlnX2ZpbGUpCiB7CiAgICAgaW50IGZk
OwogICAgIHVpbnQ4X3QgKmNvbmZpZ19kYXRhOwogICAgIGludCBjb25maWdfbGVuOwogCi0gICAg
c2F2ZV9kb21haW5fY29yZV9iZWdpbihkb21pZCwgb3ZlcnJpZGVfY29uZmlnX2ZpbGUsCisgICAg
c2F2ZV9kb21haW5fY29yZV9iZWdpbihkb21pZCwgcHJlc2VydmVfZG9taWQsIG92ZXJyaWRlX2Nv
bmZpZ19maWxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJmNvbmZpZ19kYXRhLCAmY29u
ZmlnX2xlbik7CiAKICAgICBpZiAoIWNvbmZpZ19sZW4pIHsKQEAgLTIzNiwxNSArMjQwLDE5IEBA
IGludCBtYWluX3NhdmUoaW50IGFyZ2MsIGNoYXIgKiphcmd2KQogICAgIGNvbnN0IGNoYXIgKmNv
bmZpZ19maWxlbmFtZSA9IE5VTEw7CiAgICAgaW50IGNoZWNrcG9pbnQgPSAwOwogICAgIGludCBs
ZWF2ZXBhdXNlZCA9IDA7CisgICAgaW50IHByZXNlcnZlX2RvbWlkID0gMDsKICAgICBpbnQgb3B0
OwogCi0gICAgU1dJVENIX0ZPUkVBQ0hfT1BUKG9wdCwgImNwIiwgTlVMTCwgInNhdmUiLCAyKSB7
CisgICAgU1dJVENIX0ZPUkVBQ0hfT1BUKG9wdCwgImNwRCIsIE5VTEwsICJzYXZlIiwgMikgewog
ICAgIGNhc2UgJ2MnOgogICAgICAgICBjaGVja3BvaW50ID0gMTsKICAgICAgICAgYnJlYWs7CiAg
ICAgY2FzZSAncCc6CiAgICAgICAgIGxlYXZlcGF1c2VkID0gMTsKICAgICAgICAgYnJlYWs7Cisg
ICAgY2FzZSAnRCc6CisgICAgICAgIHByZXNlcnZlX2RvbWlkID0gMTsKKyAgICAgICAgYnJlYWs7
CiAgICAgfQogCiAgICAgaWYgKGFyZ2Mtb3B0aW5kID4gMykgewpAQCAtMjU3LDcgKzI2NSw4IEBA
IGludCBtYWluX3NhdmUoaW50IGFyZ2MsIGNoYXIgKiphcmd2KQogICAgIGlmICggYXJnYyAtIG9w
dGluZCA+PSAzICkKICAgICAgICAgY29uZmlnX2ZpbGVuYW1lID0gYXJndltvcHRpbmQgKyAyXTsK
IAotICAgIHNhdmVfZG9tYWluKGRvbWlkLCBmaWxlbmFtZSwgY2hlY2twb2ludCwgbGVhdmVwYXVz
ZWQsIGNvbmZpZ19maWxlbmFtZSk7CisgICAgc2F2ZV9kb21haW4oZG9taWQsIHByZXNlcnZlX2Rv
bWlkLCBmaWxlbmFtZSwgY2hlY2twb2ludCwgbGVhdmVwYXVzZWQsCisgICAgICAgICAgICAgICAg
Y29uZmlnX2ZpbGVuYW1lKTsKICAgICByZXR1cm4gRVhJVF9TVUNDRVNTOwogfQogCmRpZmYgLS1n
aXQgYS90b29scy94bC94bF92bWNvbnRyb2wuYyBiL3Rvb2xzL3hsL3hsX3ZtY29udHJvbC5jCmlu
ZGV4IDM5MjkyYWNmZTYuLjJlMmQ0Mjc0OTIgMTAwNjQ0Ci0tLSBhL3Rvb2xzL3hsL3hsX3ZtY29u
dHJvbC5jCisrKyBiL3Rvb2xzL3hsL3hsX3ZtY29udHJvbC5jCkBAIC04OTksNyArODk5LDggQEAg
c3RhcnQ6CiAgICAgICAgIGF1dG9jb25uZWN0X2NvbnNvbGVfaG93ID0gMDsKICAgICB9CiAKLSAg
ICBkX2NvbmZpZy5jX2luZm8uZG9taWQgPSBkb21pZF9wb2xpY3k7CisgICAgaWYgKCFsaWJ4bF9k
b21pZF92YWxpZF9ndWVzdChkX2NvbmZpZy5jX2luZm8uZG9taWQpKQorICAgICAgICBkX2NvbmZp
Zy5jX2luZm8uZG9taWQgPSBkb21pZF9wb2xpY3k7CiAKICAgICBpZiAoIHJlc3RvcmluZyApIHsK
ICAgICAgICAgbGlieGxfZG9tYWluX3Jlc3RvcmVfcGFyYW1zIHBhcmFtczsKLS0gCjIuMjAuMQoK
Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZl
bCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlz
dHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

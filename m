Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 45A6A12409B
	for <lists+xen-devel@lfdr.de>; Wed, 18 Dec 2019 08:52:23 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1ihU5A-0003gu-OR; Wed, 18 Dec 2019 07:49:20 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=NgR6=2I=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1ihU59-0003g6-5J
 for xen-devel@lists.xenproject.org; Wed, 18 Dec 2019 07:49:19 +0000
X-Inumbo-ID: debd0fbe-216a-11ea-b6f1-bc764e2007e4
Received: from mx2.suse.de (unknown [195.135.220.15])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id debd0fbe-216a-11ea-b6f1-bc764e2007e4;
 Wed, 18 Dec 2019 07:49:08 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx2.suse.de (Postfix) with ESMTP id CD2CAAD95;
 Wed, 18 Dec 2019 07:49:03 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Wed, 18 Dec 2019 08:48:55 +0100
Message-Id: <20191218074859.21665-6-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20191218074859.21665-1-jgross@suse.com>
References: <20191218074859.21665-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH 5/9] xen/sched: use scratch cpumask instead of
 allocating it on the stack
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 George Dunlap <george.dunlap@eu.citrix.com>, Meng Xu <mengxu@cis.upenn.edu>,
 Dario Faggioli <dfaggioli@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SW4gc2NoZWRfcnQgdGhlcmUgYXJlIHRocmVlIGluc3RhbmNlcyBvZiBjcHVtYXNrcyBhbGxvY2F0
ZWQgb24gdGhlCnN0YWNrLiBSZXBsYWNlIHRoZW0gYnkgdXNpbmcgY3B1bWFza19zY3JhdGNoLgoK
U2lnbmVkLW9mZi1ieTogSnVlcmdlbiBHcm9zcyA8amdyb3NzQHN1c2UuY29tPgotLS0KIHhlbi9j
b21tb24vc2NoZWQvc2NoZWRfcnQuYyB8IDU2ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysr
Ky0tLS0tLS0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDM3IGluc2VydGlvbnMoKyksIDE5IGRl
bGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vc2NoZWQvc2NoZWRfcnQuYyBiL3hl
bi9jb21tb24vc2NoZWQvc2NoZWRfcnQuYwppbmRleCAzNzliNTZiYzJhLi4yNjRhNzUzMTE2IDEw
MDY0NAotLS0gYS94ZW4vY29tbW9uL3NjaGVkL3NjaGVkX3J0LmMKKysrIGIveGVuL2NvbW1vbi9z
Y2hlZC9zY2hlZF9ydC5jCkBAIC02MzcsMjMgKzYzNywzOCBAQCByZXBscV9yZWluc2VydChjb25z
dCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBydF91bml0ICpzdmMpCiAgKiBhbmQgYXZh
aWxhYmxlIHJlc291cmNlcwogICovCiBzdGF0aWMgc3RydWN0IHNjaGVkX3Jlc291cmNlICoKLXJ0
X3Jlc19waWNrKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgY29uc3Qgc3RydWN0IHNjaGVk
X3VuaXQgKnVuaXQpCitydF9yZXNfcGlja19sb2NrZWQoY29uc3Qgc3RydWN0IHNjaGVkX3VuaXQg
KnVuaXQsIHVuc2lnbmVkIGludCBsb2NrZWRfY3B1KQogewotICAgIGNwdW1hc2tfdCBjcHVzOwor
ICAgIGNwdW1hc2tfdCAqY3B1cyA9IGNwdW1hc2tfc2NyYXRjaF9jcHUobG9ja2VkX2NwdSk7CiAg
ICAgY3B1bWFza190ICpvbmxpbmU7CiAgICAgaW50IGNwdTsKIAogICAgIG9ubGluZSA9IGNwdXBv
b2xfZG9tYWluX21hc3Rlcl9jcHVtYXNrKHVuaXQtPmRvbWFpbik7Ci0gICAgY3B1bWFza19hbmQo
JmNwdXMsIG9ubGluZSwgdW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHkpOworICAgIGNwdW1hc2tfYW5k
KGNwdXMsIG9ubGluZSwgdW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHkpOwogCi0gICAgY3B1ID0gY3B1
bWFza190ZXN0X2NwdShzY2hlZF91bml0X21hc3Rlcih1bml0KSwgJmNwdXMpCisgICAgY3B1ID0g
Y3B1bWFza190ZXN0X2NwdShzY2hlZF91bml0X21hc3Rlcih1bml0KSwgY3B1cykKICAgICAgICAg
ICAgID8gc2NoZWRfdW5pdF9tYXN0ZXIodW5pdCkKLSAgICAgICAgICAgIDogY3B1bWFza19jeWNs
ZShzY2hlZF91bml0X21hc3Rlcih1bml0KSwgJmNwdXMpOwotICAgIEFTU0VSVCggIWNwdW1hc2tf
ZW1wdHkoJmNwdXMpICYmIGNwdW1hc2tfdGVzdF9jcHUoY3B1LCAmY3B1cykgKTsKKyAgICAgICAg
ICAgIDogY3B1bWFza19jeWNsZShzY2hlZF91bml0X21hc3Rlcih1bml0KSwgY3B1cyk7CisgICAg
QVNTRVJUKCAhY3B1bWFza19lbXB0eShjcHVzKSAmJiBjcHVtYXNrX3Rlc3RfY3B1KGNwdSwgY3B1
cykgKTsKIAogICAgIHJldHVybiBnZXRfc2NoZWRfcmVzKGNwdSk7CiB9CiAKKy8qCisgKiBQaWNr
IGEgdmFsaWQgcmVzb3VyY2UgZm9yIHRoZSB1bml0IHZjCisgKiBWYWxpZCByZXNvdXJjZSBvZiBh
biB1bml0IGlzIGludGVzZWN0aW9uIG9mIHVuaXQncyBhZmZpbml0eQorICogYW5kIGF2YWlsYWJs
ZSByZXNvdXJjZXMKKyAqLworc3RhdGljIHN0cnVjdCBzY2hlZF9yZXNvdXJjZSAqCitydF9yZXNf
cGljayhjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGNvbnN0IHN0cnVjdCBzY2hlZF91bml0
ICp1bml0KQoreworICAgIHN0cnVjdCBzY2hlZF9yZXNvdXJjZSAqcmVzOworCisgICAgcmVzID0g
cnRfcmVzX3BpY2tfbG9ja2VkKHVuaXQsIHVuaXQtPnJlcy0+bWFzdGVyX2NwdSk7CisKKyAgICBy
ZXR1cm4gcmVzOworfQorCiAvKgogICogSW5pdC9GcmVlIHJlbGF0ZWQgY29kZQogICovCkBAIC04
ODYsMTEgKzkwMSwxNCBAQCBydF91bml0X2luc2VydChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpv
cHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogICAgIHN0cnVjdCBydF91bml0ICpzdmMgPSBy
dF91bml0KHVuaXQpOwogICAgIHNfdGltZV90IG5vdzsKICAgICBzcGlubG9ja190ICpsb2NrOwor
ICAgIHVuc2lnbmVkIGludCBjcHUgPSBzbXBfcHJvY2Vzc29yX2lkKCk7CiAKICAgICBCVUdfT04o
IGlzX2lkbGVfdW5pdCh1bml0KSApOwogCiAgICAgLyogVGhpcyBpcyBzYWZlIGJlY2F1c2UgdW5p
dCBpc24ndCB5ZXQgYmVpbmcgc2NoZWR1bGVkICovCi0gICAgc2NoZWRfc2V0X3Jlcyh1bml0LCBy
dF9yZXNfcGljayhvcHMsIHVuaXQpKTsKKyAgICBsb2NrID0gcGNwdV9zY2hlZHVsZV9sb2NrX2ly
cShjcHUpOworICAgIHNjaGVkX3NldF9yZXModW5pdCwgcnRfcmVzX3BpY2tfbG9ja2VkKHVuaXQs
IGNwdSkpOworICAgIHBjcHVfc2NoZWR1bGVfdW5sb2NrX2lycShsb2NrLCBjcHUpOwogCiAgICAg
bG9jayA9IHVuaXRfc2NoZWR1bGVfbG9ja19pcnEodW5pdCk7CiAKQEAgLTEwMDMsMTMgKzEwMjEs
MTMgQEAgYnVybl9idWRnZXQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgcnRf
dW5pdCAqc3ZjLCBzX3RpbWVfdCBub3cpCiAgKiBsb2NrIGlzIGdyYWJiZWQgYmVmb3JlIGNhbGxp
bmcgdGhpcyBmdW5jdGlvbgogICovCiBzdGF0aWMgc3RydWN0IHJ0X3VuaXQgKgotcnVucV9waWNr
KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgY29uc3QgY3B1bWFza190ICptYXNrKQorcnVu
cV9waWNrKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgY29uc3QgY3B1bWFza190ICptYXNr
LCB1bnNpZ25lZCBpbnQgY3B1KQogewogICAgIHN0cnVjdCBsaXN0X2hlYWQgKnJ1bnEgPSBydF9y
dW5xKG9wcyk7CiAgICAgc3RydWN0IGxpc3RfaGVhZCAqaXRlcjsKICAgICBzdHJ1Y3QgcnRfdW5p
dCAqc3ZjID0gTlVMTDsKICAgICBzdHJ1Y3QgcnRfdW5pdCAqaXRlcl9zdmMgPSBOVUxMOwotICAg
IGNwdW1hc2tfdCBjcHVfY29tbW9uOworICAgIGNwdW1hc2tfdCAqY3B1X2NvbW1vbiA9IGNwdW1h
c2tfc2NyYXRjaF9jcHUoY3B1KTsKICAgICBjcHVtYXNrX3QgKm9ubGluZTsKIAogICAgIGxpc3Rf
Zm9yX2VhY2ggKCBpdGVyLCBydW5xICkKQEAgLTEwMTgsOSArMTAzNiw5IEBAIHJ1bnFfcGljayhj
b25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGNvbnN0IGNwdW1hc2tfdCAqbWFzaykKIAogICAg
ICAgICAvKiBtYXNrIGNwdV9oYXJkX2FmZmluaXR5ICYgY3B1cG9vbCAmIG1hc2sgKi8KICAgICAg
ICAgb25saW5lID0gY3B1cG9vbF9kb21haW5fbWFzdGVyX2NwdW1hc2soaXRlcl9zdmMtPnVuaXQt
PmRvbWFpbik7Ci0gICAgICAgIGNwdW1hc2tfYW5kKCZjcHVfY29tbW9uLCBvbmxpbmUsIGl0ZXJf
c3ZjLT51bml0LT5jcHVfaGFyZF9hZmZpbml0eSk7Ci0gICAgICAgIGNwdW1hc2tfYW5kKCZjcHVf
Y29tbW9uLCBtYXNrLCAmY3B1X2NvbW1vbik7Ci0gICAgICAgIGlmICggY3B1bWFza19lbXB0eSgm
Y3B1X2NvbW1vbikgKQorICAgICAgICBjcHVtYXNrX2FuZChjcHVfY29tbW9uLCBvbmxpbmUsIGl0
ZXJfc3ZjLT51bml0LT5jcHVfaGFyZF9hZmZpbml0eSk7CisgICAgICAgIGNwdW1hc2tfYW5kKGNw
dV9jb21tb24sIG1hc2ssIGNwdV9jb21tb24pOworICAgICAgICBpZiAoIGNwdW1hc2tfZW1wdHko
Y3B1X2NvbW1vbikgKQogICAgICAgICAgICAgY29udGludWU7CiAKICAgICAgICAgQVNTRVJUKCBp
dGVyX3N2Yy0+Y3VyX2J1ZGdldCA+IDAgKTsKQEAgLTEwOTIsNyArMTExMCw3IEBAIHJ0X3NjaGVk
dWxlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX3VuaXQgKmN1cnJ1
bml0LAogICAgIH0KICAgICBlbHNlCiAgICAgewotICAgICAgICBzbmV4dCA9IHJ1bnFfcGljayhv
cHMsIGNwdW1hc2tfb2Yoc2NoZWRfY3B1KSk7CisgICAgICAgIHNuZXh0ID0gcnVucV9waWNrKG9w
cywgY3B1bWFza19vZihzY2hlZF9jcHUpLCBjdXJfY3B1KTsKIAogICAgICAgICBpZiAoIHNuZXh0
ID09IE5VTEwgKQogICAgICAgICAgICAgc25leHQgPSBydF91bml0KHNjaGVkX2lkbGVfdW5pdChz
Y2hlZF9jcHUpKTsKQEAgLTExODYsMjIgKzEyMDQsMjIgQEAgcnVucV90aWNrbGUoY29uc3Qgc3Ry
dWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgcnRfdW5pdCAqbmV3KQogICAgIHN0cnVjdCBydF91
bml0ICppdGVyX3N2YzsKICAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCAqaXRlcl91bml0OwogICAgIGlu
dCBjcHUgPSAwLCBjcHVfdG9fdGlja2xlID0gMDsKLSAgICBjcHVtYXNrX3Qgbm90X3RpY2tsZWQ7
CisgICAgY3B1bWFza190ICpub3RfdGlja2xlZCA9IGNwdW1hc2tfc2NyYXRjaF9jcHUoc21wX3By
b2Nlc3Nvcl9pZCgpKTsKICAgICBjcHVtYXNrX3QgKm9ubGluZTsKIAogICAgIGlmICggbmV3ID09
IE5VTEwgfHwgaXNfaWRsZV91bml0KG5ldy0+dW5pdCkgKQogICAgICAgICByZXR1cm47CiAKICAg
ICBvbmxpbmUgPSBjcHVwb29sX2RvbWFpbl9tYXN0ZXJfY3B1bWFzayhuZXctPnVuaXQtPmRvbWFp
bik7Ci0gICAgY3B1bWFza19hbmQoJm5vdF90aWNrbGVkLCBvbmxpbmUsIG5ldy0+dW5pdC0+Y3B1
X2hhcmRfYWZmaW5pdHkpOwotICAgIGNwdW1hc2tfYW5kbm90KCZub3RfdGlja2xlZCwgJm5vdF90
aWNrbGVkLCAmcHJ2LT50aWNrbGVkKTsKKyAgICBjcHVtYXNrX2FuZChub3RfdGlja2xlZCwgb25s
aW5lLCBuZXctPnVuaXQtPmNwdV9oYXJkX2FmZmluaXR5KTsKKyAgICBjcHVtYXNrX2FuZG5vdChu
b3RfdGlja2xlZCwgbm90X3RpY2tsZWQsICZwcnYtPnRpY2tsZWQpOwogCiAgICAgLyoKICAgICAg
KiAxKSBJZiB0aGVyZSBhcmUgYW55IGlkbGUgQ1BVcywga2ljayBvbmUuCiAgICAgICogICAgRm9y
IGNhY2hlIGJlbmVmaXQsd2UgZmlyc3Qgc2VhcmNoIG5ldy0+Y3B1LgogICAgICAqICAgIFRoZSBz
YW1lIGxvb3AgYWxzbyBmaW5kIHRoZSBvbmUgd2l0aCBsb3dlc3QgcHJpb3JpdHkuCiAgICAgICov
Ci0gICAgY3B1ID0gY3B1bWFza190ZXN0X29yX2N5Y2xlKHNjaGVkX3VuaXRfbWFzdGVyKG5ldy0+
dW5pdCksICZub3RfdGlja2xlZCk7CisgICAgY3B1ID0gY3B1bWFza190ZXN0X29yX2N5Y2xlKHNj
aGVkX3VuaXRfbWFzdGVyKG5ldy0+dW5pdCksIG5vdF90aWNrbGVkKTsKICAgICB3aGlsZSAoIGNw
dSE9IG5yX2NwdV9pZHMgKQogICAgIHsKICAgICAgICAgaXRlcl91bml0ID0gY3Vycl9vbl9jcHUo
Y3B1KTsKQEAgLTEyMTYsOCArMTIzNCw4IEBAIHJ1bnFfdGlja2xlKGNvbnN0IHN0cnVjdCBzY2hl
ZHVsZXIgKm9wcywgc3RydWN0IHJ0X3VuaXQgKm5ldykKICAgICAgICAgICAgICBjb21wYXJlX3Vu
aXRfcHJpb3JpdHkoaXRlcl9zdmMsIGxhdGVzdF9kZWFkbGluZV91bml0KSA8IDAgKQogICAgICAg
ICAgICAgbGF0ZXN0X2RlYWRsaW5lX3VuaXQgPSBpdGVyX3N2YzsKIAotICAgICAgICBjcHVtYXNr
X2NsZWFyX2NwdShjcHUsICZub3RfdGlja2xlZCk7Ci0gICAgICAgIGNwdSA9IGNwdW1hc2tfY3lj
bGUoY3B1LCAmbm90X3RpY2tsZWQpOworICAgICAgICBjcHVtYXNrX2NsZWFyX2NwdShjcHUsIG5v
dF90aWNrbGVkKTsKKyAgICAgICAgY3B1ID0gY3B1bWFza19jeWNsZShjcHUsIG5vdF90aWNrbGVk
KTsKICAgICB9CiAKICAgICAvKiAyKSBjYW5kaWNhdGUgaGFzIGhpZ2hlciBwcmlvcml0eSwga2lj
ayBvdXQgbG93ZXN0IHByaW9yaXR5IHVuaXQgKi8KLS0gCjIuMTYuNAoKCl9fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QK
WGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5v
cmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

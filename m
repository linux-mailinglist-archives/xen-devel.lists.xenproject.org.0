Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 0E541BF471
	for <lists+xen-devel@lfdr.de>; Thu, 26 Sep 2019 15:52:39 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iDU9S-00022Q-UI; Thu, 26 Sep 2019 13:49:46 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=njQ1=XV=intel.com=chao.gao@srs-us1.protection.inumbo.net>)
 id 1iDU9R-00022D-8P
 for xen-devel@lists.xenproject.org; Thu, 26 Sep 2019 13:49:45 +0000
X-Inumbo-ID: 7c129f88-e064-11e9-97fb-bc764e2007e4
Received: from mga04.intel.com (unknown [192.55.52.120])
 by localhost (Halon) with ESMTPS
 id 7c129f88-e064-11e9-97fb-bc764e2007e4;
 Thu, 26 Sep 2019 13:49:39 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga008.fm.intel.com ([10.253.24.58])
 by fmsmga104.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 26 Sep 2019 06:49:39 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,552,1559545200"; d="scan'208";a="189126020"
Received: from gao-cwp.sh.intel.com ([10.239.159.26])
 by fmsmga008.fm.intel.com with ESMTP; 26 Sep 2019 06:49:37 -0700
From: Chao Gao <chao.gao@intel.com>
To: xen-devel@lists.xenproject.org
Date: Thu, 26 Sep 2019 21:53:29 +0800
Message-Id: <1569506015-26938-2-git-send-email-chao.gao@intel.com>
X-Mailer: git-send-email 1.9.1
In-Reply-To: <1569506015-26938-1-git-send-email-chao.gao@intel.com>
References: <1569506015-26938-1-git-send-email-chao.gao@intel.com>
Subject: [Xen-devel] [PATCH v11 1/7] microcode: split out apply_microcode()
 from cpu_request_microcode()
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Sergey Dyasli <sergey.dyasli@citrix.com>, Ashok Raj <ashok.raj@intel.com>,
 Wei Liu <wl@xen.org>, Andrew Cooper <andrew.cooper3@citrix.com>,
 Jan Beulich <jbeulich@suse.com>, Chao Gao <chao.gao@intel.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

RHVyaW5nIGxhdGUgbWljcm9jb2RlIGxvYWRpbmcsIGFwcGx5X21pY3JvY29kZSgpIGlzIGludm9r
ZWQgaW4KY3B1X3JlcXVlc3RfbWljcm9jb2RlKCkuIFRvIG1ha2UgbGF0ZSBtaWNyb2NvZGUgdXBk
YXRlIG1vcmUgcmVsaWFibGUsCndlIHdhbnQgdG8gcHV0IHRoZSBhcHBseV9taWNyb2NvZGUoKSBp
bnRvIHN0b3BfbWFjaGluZSBjb250ZXh0LiBTbwp3ZSBzcGxpdCBvdXQgaXQgZnJvbSBjcHVfcmVx
dWVzdF9taWNyb2NvZGUoKS4gSW4gZ2VuZXJhbCwgZm9yIGJvdGgKZWFybHkgbG9hZGluZyBvbiBC
U1AgYW5kIGxhdGUgbG9hZGluZywgY3B1X3JlcXVlc3RfbWljcm9jb2RlKCkgaXMKY2FsbGVkIGZp
cnN0IHRvIGdldCB0aGUgbWF0Y2hpbmcgbWljcm9jb2RlIHVwZGF0ZSBjb250YWluZWQgYnkKdGhl
IGJsb2IgYW5kIHRoZW4gYXBwbHlfbWljcm9jb2RlKCkgaXMgaW52b2tlZCBleHBsaWNpdGx5IG9u
IGVhY2gKY3B1IGluIGNvbW1vbiBjb2RlLgoKR2l2ZW4gdGhhdCBhbGwgQ1BVcyBhcmUgc3VwcG9z
ZWQgdG8gaGF2ZSB0aGUgc2FtZSBzaWduYXR1cmUsIHBhcnNpbmcKbWljcm9jb2RlIG9ubHkgbmVl
ZHMgdG8gYmUgZG9uZSBvbmNlLiBTbyBjcHVfcmVxdWVzdF9taWNyb2NvZGUoKSBpcwphbHNvIG1v
dmVkIG91dCBvZiBtaWNyb2NvZGVfdXBkYXRlX2NwdSgpLgoKSW4gc29tZSBjYXNlcyAoZS5nLiBh
IGJyb2tlbiBiaW9zKSwgdGhlIHN5c3RlbSBtYXkgaGF2ZSBtdWx0aXBsZQpyZXZpc2lvbnMgb2Yg
bWljcm9jb2RlIHVwZGF0ZS4gU28gd2Ugd291bGQgdHJ5IHRvIGxvYWQgYSBtaWNyb2NvZGUKdXBk
YXRlIGFzIGxvbmcgYXMgaXQgY292ZXJzIGN1cnJlbnQgY3B1LiBBbmQgaWYgYSBjcHUgbG9hZHMg
dGhpcyBwYXRjaApzdWNjZXNzZnVsbHksIHRoZSBwYXRjaCB3b3VsZCBiZSBzdG9yZWQgaW50byB0
aGUgcGF0Y2ggY2FjaGUuCgpOb3RlIHRoYXQgY2FsbGluZyAtPmFwcGx5X21pY3JvY29kZSgpIGl0
c2VsZiBkb2Vzbid0IHJlcXVpcmUgYW55CmxvY2sgYmVpbmcgaGVsZC4gQnV0IHRoZSBwYXJhbWV0
ZXIgcGFzc2VkIHRvIGl0IG1heSBiZSBwcm90ZWN0ZWQKYnkgc29tZSBsb2Nrcy4gRS5nLiBtaWNy
b2NvZGVfdXBkYXRlX2NwdSgpIGFjcXVpcmVzIG1pY3JvY29kZV9tdXRleAp0byBhdm9pZCBtaWNy
b2NvZGVfY2FjaGUgYmVpbmcgdXBkYXRlZCBieSBvdGhlcnMuCgpTaWduZWQtb2ZmLWJ5OiBDaGFv
IEdhbyA8Y2hhby5nYW9AaW50ZWwuY29tPgotLS0KQ2hhbmdlcyBpbiB2MTE6CiAtIGRyb3AgUm9n
ZXIncyBSQi4KIC0gYWNxdWlyZSBtaWNyb2NvZGVfbXV0ZXggYmVmb3JlIGNoZWNraW5nIHdoZXRo
ZXIgbWljcm9jb2RlX2NhY2hlIGlzCiBOVUxMCiAtIGlnbm9yZSAtRUlOVkFMIHdoaWNoIGluZGlj
YXRlcyBhIGVxdWFsL25ld2VyIHVjb2RlIGlzIGFscmVhZHkgbG9hZGVkLgogLSBmcmVlICdidWZm
ZXInIGVhcmxpZXIgdG8gYXZvaWQgZ290byBjbGF1c2VzIGluIG1pY3JvY29kZV91cGRhdGUoKQoK
Q2hhbmdlcyBpbiB2MTA6CiAtIG1ha2UgbWljcm9jb2RlX3VwZGF0ZV9jYWNoZSBzdGF0aWMKIC0g
cmFpc2UgYW4gZXJyb3IgaWYgbG9hZGluZyB1Y29kZSBmYWlsZWQgd2l0aCAtRUlPCiAtIGVuc3Vy
ZSBlbmRfdXBkYXRlX3BlcmNwdSgpIGlzIGNhbGxlZCBmb2xsb3dpbmcgYSBzdWNjZXNzZnVsIGNh
bGwgb2YKIHN0YXJ0X3VwZGF0ZSgpCgpDaGFuZ2VzIGluIHY5OgogLSByZW1vdmUgdGhlIGNhbGxp
bmcgb2YgLT5jb21wYXJlX3BhdGNoIGluIG1pY3JvY29kZV91cGRhdGVfY3B1KCkuCiAtIGRyb3Ag
Im1pY3JvY29kZV8iIHByZWZpeCBmb3Igc3RhdGljIGZ1bmN0aW9uIC0gbWljcm9jb2RlX3BhcnNl
X2Jsb2IoKS4KIC0gcmViYXNlIGFuZCBmaXggY29uZmxpY3QKCkNoYW5nZXMgaW4gdjg6CiAtIGRp
dmlkZSB0aGUgb3JpZ2luYWwgcGF0Y2ggaW50byB0aHJlZSBwYXRjaGVzIHRvIGltcHJvdmUgcmVh
ZGFiaWxpdHkKIC0gbG9hZCBhbiB1cGRhdGUgb24gZWFjaCBjcHUgYXMgbG9uZyBhcyB0aGUgdXBk
YXRlIGNvdmVycyBjdXJyZW50IGNwdQogLSBzdG9yZSBhbiB1cGRhdGUgYWZ0ZXIgdGhlIGZpcnN0
IHN1Y2Nlc3NmdWwgbG9hZGluZyBvbiBhIENQVQogLSBNYWtlIHN1cmUgdGhlIGN1cnJlbnQgQ1BV
IChlc3BlY2lhbGx5IHBmIHZhbHVlKSBpcyBjb3ZlcmVkCiBieSB1cGRhdGVzLgoKY2hhbmdlcyBp
biB2NzoKIC0gdG8gaGFuZGxlIGxvYWQgZmFpbHVyZSwgdW52YWxpZGF0ZWQgcGF0Y2hlcyB3b24n
dCBiZSBjYWNoZWQuIFRoZXkKIGFyZSBwYXNzZWQgYXMgZnVuY3Rpb24gYXJndW1lbnRzLiBTbyBp
ZiB1cGRhdGUgZmFpbGVkLCB3ZSBuZWVkbid0CiBhbnkgY2xlYW51cCB0byBtaWNyb2NvZGUgY2Fj
aGUuCi0tLQogeGVuL2FyY2gveDg2L21pY3JvY29kZS5jICAgICAgICB8IDE3MyArKysrKysrKysr
KysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tCiB4ZW4vYXJjaC94ODYvbWljcm9jb2RlX2Ft
ZC5jICAgIHwgIDM4ICsrKystLS0tLQogeGVuL2FyY2gveDg2L21pY3JvY29kZV9pbnRlbC5jICB8
ICA2NiArKysrKysrLS0tLS0tLS0KIHhlbi9pbmNsdWRlL2FzbS14ODYvbWljcm9jb2RlLmggfCAg
IDUgKy0KIDQgZmlsZXMgY2hhbmdlZCwgMTcyIGluc2VydGlvbnMoKyksIDExMCBkZWxldGlvbnMo
LSkKCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvbWljcm9jb2RlLmMgYi94ZW4vYXJjaC94ODYv
bWljcm9jb2RlLmMKaW5kZXggYjQ0ZTRkNy4uM2VhMmE2ZSAxMDA2NDQKLS0tIGEveGVuL2FyY2gv
eDg2L21pY3JvY29kZS5jCisrKyBiL3hlbi9hcmNoL3g4Ni9taWNyb2NvZGUuYwpAQCAtMTg5LDEy
ICsxODksMTkgQEAgc3RhdGljIERFRklORV9TUElOTE9DSyhtaWNyb2NvZGVfbXV0ZXgpOwogCiBE
RUZJTkVfUEVSX0NQVShzdHJ1Y3QgY3B1X3NpZ25hdHVyZSwgY3B1X3NpZyk7CiAKLXN0cnVjdCBt
aWNyb2NvZGVfaW5mbyB7Ci0gICAgdW5zaWduZWQgaW50IGNwdTsKLSAgICB1aW50MzJfdCBidWZm
ZXJfc2l6ZTsKLSAgICBpbnQgZXJyb3I7Ci0gICAgY2hhciBidWZmZXJbMV07Ci19OworLyoKKyAq
IFJldHVybiBhIHBhdGNoIHRoYXQgY292ZXJzIGN1cnJlbnQgQ1BVLiBJZiB0aGVyZSBhcmUgbXVs
dGlwbGUgcGF0Y2hlcywKKyAqIHJldHVybiB0aGUgb25lIHdpdGggdGhlIGhpZ2hlc3QgcmV2aXNp
b24gbnVtYmVyLiBSZXR1cm4gZXJyb3IgSWYgbm8KKyAqIHBhdGNoIGlzIGZvdW5kIGFuZCBhbiBl
cnJvciBvY2N1cnMgZHVyaW5nIHRoZSBwYXJzaW5nIHByb2Nlc3MuIE90aGVyd2lzZQorICogcmV0
dXJuIE5VTEwuCisgKi8KK3N0YXRpYyBzdHJ1Y3QgbWljcm9jb2RlX3BhdGNoICpwYXJzZV9ibG9i
KGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGxlbikKK3sKKyAgICBpZiAoIGxpa2VseSghbWljcm9j
b2RlX29wcy0+Y29sbGVjdF9jcHVfaW5mbygmdGhpc19jcHUoY3B1X3NpZykpKSApCisgICAgICAg
IHJldHVybiBtaWNyb2NvZGVfb3BzLT5jcHVfcmVxdWVzdF9taWNyb2NvZGUoYnVmLCBsZW4pOwor
CisgICAgcmV0dXJuIE5VTEw7Cit9CiAKIGludCBtaWNyb2NvZGVfcmVzdW1lX2NwdSh2b2lkKQog
ewpAQCAtMjIwLDE1ICsyMjcsOCBAQCB2b2lkIG1pY3JvY29kZV9mcmVlX3BhdGNoKHN0cnVjdCBt
aWNyb2NvZGVfcGF0Y2ggKm1pY3JvY29kZV9wYXRjaCkKICAgICB4ZnJlZShtaWNyb2NvZGVfcGF0
Y2gpOwogfQogCi1jb25zdCBzdHJ1Y3QgbWljcm9jb2RlX3BhdGNoICptaWNyb2NvZGVfZ2V0X2Nh
Y2hlKHZvaWQpCi17Ci0gICAgQVNTRVJUKHNwaW5faXNfbG9ja2VkKCZtaWNyb2NvZGVfbXV0ZXgp
KTsKLQotICAgIHJldHVybiBtaWNyb2NvZGVfY2FjaGU7Ci19Ci0KIC8qIFJldHVybiB0cnVlIGlm
IGNhY2hlIGdldHMgdXBkYXRlZC4gT3RoZXJ3aXNlLCByZXR1cm4gZmFsc2UgKi8KLWJvb2wgbWlj
cm9jb2RlX3VwZGF0ZV9jYWNoZShzdHJ1Y3QgbWljcm9jb2RlX3BhdGNoICpwYXRjaCkKK3N0YXRp
YyBib29sIG1pY3JvY29kZV91cGRhdGVfY2FjaGUoc3RydWN0IG1pY3JvY29kZV9wYXRjaCAqcGF0
Y2gpCiB7CiAgICAgQVNTRVJUKHNwaW5faXNfbG9ja2VkKCZtaWNyb2NvZGVfbXV0ZXgpKTsKIApA
QCAtMjQ5LDQ5ICsyNDksODIgQEAgYm9vbCBtaWNyb2NvZGVfdXBkYXRlX2NhY2hlKHN0cnVjdCBt
aWNyb2NvZGVfcGF0Y2ggKnBhdGNoKQogICAgIHJldHVybiB0cnVlOwogfQogCi1zdGF0aWMgaW50
IG1pY3JvY29kZV91cGRhdGVfY3B1KGNvbnN0IHZvaWQgKmJ1Ziwgc2l6ZV90IHNpemUpCisvKgor
ICogTG9hZCBhIG1pY3JvY29kZSB1cGRhdGUgdG8gY3VycmVudCBDUFUuCisgKgorICogSWYgbm8g
cGF0Y2ggaXMgcHJvdmlkZWQsIHRoZSBjYWNoZWQgcGF0Y2ggd2lsbCBiZSBsb2FkZWQuIE1pY3Jv
Y29kZSB1cGRhdGUKKyAqIGR1cmluZyBBUHMgYnJpbmd1cCBhbmQgQ1BVIHJlc3VtaW5nIGZhbGxz
IGludG8gdGhpcyBjYXNlLgorICovCitzdGF0aWMgaW50IG1pY3JvY29kZV91cGRhdGVfY3B1KGNv
bnN0IHN0cnVjdCBtaWNyb2NvZGVfcGF0Y2ggKnBhdGNoKQogewotICAgIGludCBlcnI7Ci0gICAg
dW5zaWduZWQgaW50IGNwdSA9IHNtcF9wcm9jZXNzb3JfaWQoKTsKLSAgICBzdHJ1Y3QgY3B1X3Np
Z25hdHVyZSAqc2lnID0gJnBlcl9jcHUoY3B1X3NpZywgY3B1KTsKKyAgICBpbnQgZXJyID0gbWlj
cm9jb2RlX29wcy0+Y29sbGVjdF9jcHVfaW5mbygmdGhpc19jcHUoY3B1X3NpZykpOwogCi0gICAg
c3Bpbl9sb2NrKCZtaWNyb2NvZGVfbXV0ZXgpOworICAgIGlmICggdW5saWtlbHkoZXJyKSApCisg
ICAgICAgIHJldHVybiBlcnI7CiAKLSAgICBlcnIgPSBtaWNyb2NvZGVfb3BzLT5jb2xsZWN0X2Nw
dV9pbmZvKHNpZyk7Ci0gICAgaWYgKCBsaWtlbHkoIWVycikgKQotICAgICAgICBlcnIgPSBtaWNy
b2NvZGVfb3BzLT5jcHVfcmVxdWVzdF9taWNyb2NvZGUoYnVmLCBzaXplKTsKKyAgICBzcGluX2xv
Y2soJm1pY3JvY29kZV9tdXRleCk7CisgICAgaWYgKCBwYXRjaCApCisgICAgICAgIGVyciA9IG1p
Y3JvY29kZV9vcHMtPmFwcGx5X21pY3JvY29kZShwYXRjaCk7CisgICAgZWxzZSBpZiAoIG1pY3Jv
Y29kZV9jYWNoZSApCisgICAgeworICAgICAgICBlcnIgPSBtaWNyb2NvZGVfb3BzLT5hcHBseV9t
aWNyb2NvZGUobWljcm9jb2RlX2NhY2hlKTsKKyAgICAgICAgaWYgKCBlcnIgPT0gLUVJTyApCisg
ICAgICAgIHsKKyAgICAgICAgICAgIG1pY3JvY29kZV9mcmVlX3BhdGNoKG1pY3JvY29kZV9jYWNo
ZSk7CisgICAgICAgICAgICBtaWNyb2NvZGVfY2FjaGUgPSBOVUxMOworICAgICAgICB9CisgICAg
fQorICAgIGVsc2UKKyAgICAgICAgLyogTm8gcGF0Y2ggdG8gdXBkYXRlICovCisgICAgICAgIGVy
ciA9IC1FTk9FTlQ7CiAgICAgc3Bpbl91bmxvY2soJm1pY3JvY29kZV9tdXRleCk7CiAKICAgICBy
ZXR1cm4gZXJyOwogfQogCi1zdGF0aWMgbG9uZyBkb19taWNyb2NvZGVfdXBkYXRlKHZvaWQgKl9p
bmZvKQorc3RhdGljIGxvbmcgZG9fbWljcm9jb2RlX3VwZGF0ZSh2b2lkICpwYXRjaCkKIHsKLSAg
ICBzdHJ1Y3QgbWljcm9jb2RlX2luZm8gKmluZm8gPSBfaW5mbzsKLSAgICBpbnQgZXJyb3I7Ci0K
LSAgICBCVUdfT04oaW5mby0+Y3B1ICE9IHNtcF9wcm9jZXNzb3JfaWQoKSk7CisgICAgdW5zaWdu
ZWQgaW50IGNwdTsKKyAgICBpbnQgcmV0ID0gbWljcm9jb2RlX3VwZGF0ZV9jcHUocGF0Y2gpOwog
Ci0gICAgZXJyb3IgPSBtaWNyb2NvZGVfdXBkYXRlX2NwdShpbmZvLT5idWZmZXIsIGluZm8tPmJ1
ZmZlcl9zaXplKTsKLSAgICBpZiAoIGVycm9yICkKLSAgICAgICAgaW5mby0+ZXJyb3IgPSBlcnJv
cjsKKyAgICAvKiBTdG9yZSB0aGUgcGF0Y2ggYWZ0ZXIgYSBzdWNjZXNzZnVsIGxvYWRpbmcgKi8K
KyAgICBpZiAoICFyZXQgJiYgcGF0Y2ggKQorICAgIHsKKyAgICAgICAgc3Bpbl9sb2NrKCZtaWNy
b2NvZGVfbXV0ZXgpOworICAgICAgICBtaWNyb2NvZGVfdXBkYXRlX2NhY2hlKHBhdGNoKTsKKyAg
ICAgICAgc3Bpbl91bmxvY2soJm1pY3JvY29kZV9tdXRleCk7CisgICAgICAgIHBhdGNoID0gTlVM
TDsKKyAgICB9CiAKICAgICBpZiAoIG1pY3JvY29kZV9vcHMtPmVuZF91cGRhdGVfcGVyY3B1ICkK
ICAgICAgICAgbWljcm9jb2RlX29wcy0+ZW5kX3VwZGF0ZV9wZXJjcHUoKTsKIAotICAgIGluZm8t
PmNwdSA9IGNwdW1hc2tfbmV4dChpbmZvLT5jcHUsICZjcHVfb25saW5lX21hcCk7Ci0gICAgaWYg
KCBpbmZvLT5jcHUgPCBucl9jcHVfaWRzICkKLSAgICAgICAgcmV0dXJuIGNvbnRpbnVlX2h5cGVy
Y2FsbF9vbl9jcHUoaW5mby0+Y3B1LCBkb19taWNyb2NvZGVfdXBkYXRlLCBpbmZvKTsKKyAgICAv
KgorICAgICAqIEVhY2ggdGhyZWFkIHRyaWVzIHRvIGxvYWQgdWNvZGUuIE9ubHkgdGhlIGZpcnN0
IHRocmVhZCBvZiBhIGNvcmUKKyAgICAgKiB3b3VsZCBzdWNjZWVkIHdoaWxlIG90aGVyIHRocmVh
ZHMgd291bGQgZW5jb3VudGVyIC1FSU5WQUwgd2hpY2gKKyAgICAgKiBpbmRpY2F0ZXMgY3VycmVu
dCB1Y29kZSByZXZpc2lvbiBpcyBlcXVhbCB0byBvciBuZXdlciB0aGFuIHRoZQorICAgICAqIGdp
dmVuIHBhdGNoLiBJdCBpcyBhY3R1YWxseSBleHBlY3RlZDsgc28gaWdub3JlIHRoaXMgZXJyb3Iu
CisgICAgICovCisgICAgaWYgKCByZXQgPT0gLUVJTlZBTCApCisgICAgICAgIHJldCA9IDA7CisK
KyAgICBjcHUgPSBjcHVtYXNrX25leHQoc21wX3Byb2Nlc3Nvcl9pZCgpLCAmY3B1X29ubGluZV9t
YXApOworICAgIGlmICggY3B1IDwgbnJfY3B1X2lkcyApCisgICAgICAgIHJldHVybiBjb250aW51
ZV9oeXBlcmNhbGxfb25fY3B1KGNwdSwgZG9fbWljcm9jb2RlX3VwZGF0ZSwgcGF0Y2gpID86Cisg
ICAgICAgICAgICAgICByZXQ7CisKKyAgICAvKiBGcmVlIHRoZSBwYXRjaCBpZiBubyBDUFUgaGFz
IGxvYWRlZCBpdCBzdWNjZXNzZnVsbHkuICovCisgICAgaWYgKCBwYXRjaCApCisgICAgICAgIG1p
Y3JvY29kZV9mcmVlX3BhdGNoKHBhdGNoKTsKIAotICAgIGVycm9yID0gaW5mby0+ZXJyb3I7Ci0g
ICAgeGZyZWUoaW5mbyk7Ci0gICAgcmV0dXJuIGVycm9yOworICAgIHJldHVybiByZXQ7CiB9CiAK
IGludCBtaWNyb2NvZGVfdXBkYXRlKFhFTl9HVUVTVF9IQU5ETEVfUEFSQU0oY29uc3Rfdm9pZCkg
YnVmLCB1bnNpZ25lZCBsb25nIGxlbikKIHsKICAgICBpbnQgcmV0OwotICAgIHN0cnVjdCBtaWNy
b2NvZGVfaW5mbyAqaW5mbzsKKyAgICB2b2lkICpidWZmZXI7CisgICAgc3RydWN0IG1pY3JvY29k
ZV9wYXRjaCAqcGF0Y2g7CiAKICAgICBpZiAoIGxlbiAhPSAodWludDMyX3QpbGVuICkKICAgICAg
ICAgcmV0dXJuIC1FMkJJRzsKQEAgLTI5OSwzMiArMzMyLDQxIEBAIGludCBtaWNyb2NvZGVfdXBk
YXRlKFhFTl9HVUVTVF9IQU5ETEVfUEFSQU0oY29uc3Rfdm9pZCkgYnVmLCB1bnNpZ25lZCBsb25n
IGxlbikKICAgICBpZiAoIG1pY3JvY29kZV9vcHMgPT0gTlVMTCApCiAgICAgICAgIHJldHVybiAt
RUlOVkFMOwogCi0gICAgaW5mbyA9IHhtYWxsb2NfYnl0ZXMoc2l6ZW9mKCppbmZvKSArIGxlbik7
Ci0gICAgaWYgKCBpbmZvID09IE5VTEwgKQorICAgIGJ1ZmZlciA9IHhtYWxsb2NfYnl0ZXMobGVu
KTsKKyAgICBpZiAoICFidWZmZXIgKQogICAgICAgICByZXR1cm4gLUVOT01FTTsKIAotICAgIHJl
dCA9IGNvcHlfZnJvbV9ndWVzdChpbmZvLT5idWZmZXIsIGJ1ZiwgbGVuKTsKLSAgICBpZiAoIHJl
dCAhPSAwICkKKyAgICByZXQgPSBjb3B5X2Zyb21fZ3Vlc3QoYnVmZmVyLCBidWYsIGxlbik7Cisg
ICAgaWYgKCByZXQgKQorICAgIHsKKyAgICAgICAgeGZyZWUoYnVmZmVyKTsKKyAgICAgICAgcmV0
dXJuIC1FRkFVTFQ7CisgICAgfQorCisgICAgcGF0Y2ggPSBwYXJzZV9ibG9iKGJ1ZmZlciwgbGVu
KTsKKyAgICB4ZnJlZShidWZmZXIpOworICAgIGlmICggSVNfRVJSKHBhdGNoKSApCiAgICAgewot
ICAgICAgICB4ZnJlZShpbmZvKTsKKyAgICAgICAgcmV0ID0gUFRSX0VSUihwYXRjaCk7CisgICAg
ICAgIHByaW50ayhYRU5MT0dfV0FSTklORyAiUGFyc2luZyBtaWNyb2NvZGUgYmxvYiBlcnJvciAl
ZFxuIiwgcmV0KTsKICAgICAgICAgcmV0dXJuIHJldDsKICAgICB9CiAKLSAgICBpbmZvLT5idWZm
ZXJfc2l6ZSA9IGxlbjsKLSAgICBpbmZvLT5lcnJvciA9IDA7Ci0gICAgaW5mby0+Y3B1ID0gY3B1
bWFza19maXJzdCgmY3B1X29ubGluZV9tYXApOworICAgIGlmICggIXBhdGNoICkKKyAgICAgICAg
cmV0dXJuIC1FTk9FTlQ7CiAKICAgICBpZiAoIG1pY3JvY29kZV9vcHMtPnN0YXJ0X3VwZGF0ZSAp
CiAgICAgewogICAgICAgICByZXQgPSBtaWNyb2NvZGVfb3BzLT5zdGFydF91cGRhdGUoKTsKICAg
ICAgICAgaWYgKCByZXQgIT0gMCApCiAgICAgICAgIHsKLSAgICAgICAgICAgIHhmcmVlKGluZm8p
OworICAgICAgICAgICAgbWljcm9jb2RlX2ZyZWVfcGF0Y2gocGF0Y2gpOwogICAgICAgICAgICAg
cmV0dXJuIHJldDsKICAgICAgICAgfQogICAgIH0KIAotICAgIHJldHVybiBjb250aW51ZV9oeXBl
cmNhbGxfb25fY3B1KGluZm8tPmNwdSwgZG9fbWljcm9jb2RlX3VwZGF0ZSwgaW5mbyk7CisgICAg
cmV0dXJuIGNvbnRpbnVlX2h5cGVyY2FsbF9vbl9jcHUoY3B1bWFza19maXJzdCgmY3B1X29ubGlu
ZV9tYXApLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvX21pY3JvY29k
ZV91cGRhdGUsIHBhdGNoKTsKIH0KIAogc3RhdGljIGludCBfX2luaXQgbWljcm9jb2RlX2luaXQo
dm9pZCkKQEAgLTM3MSwyMyArNDEzLDQyIEBAIGludCBfX2luaXQgZWFybHlfbWljcm9jb2RlX3Vw
ZGF0ZV9jcHUoYm9vbCBzdGFydF91cGRhdGUpCiAKICAgICBtaWNyb2NvZGVfb3BzLT5jb2xsZWN0
X2NwdV9pbmZvKCZ0aGlzX2NwdShjcHVfc2lnKSk7CiAKLSAgICBpZiAoIGRhdGEgKQorICAgIGlm
ICggIWRhdGEgKQorICAgICAgICByZXR1cm4gLUVOT01FTTsKKworICAgIGlmICggc3RhcnRfdXBk
YXRlICkKICAgICB7Ci0gICAgICAgIGlmICggc3RhcnRfdXBkYXRlICYmIG1pY3JvY29kZV9vcHMt
PnN0YXJ0X3VwZGF0ZSApCisgICAgICAgIHN0cnVjdCBtaWNyb2NvZGVfcGF0Y2ggKnBhdGNoOwor
CisgICAgICAgIHBhdGNoID0gcGFyc2VfYmxvYihkYXRhLCBsZW4pOworICAgICAgICBpZiAoIElT
X0VSUihwYXRjaCkgKQorICAgICAgICB7CisgICAgICAgICAgICBwcmludGsoWEVOTE9HX1dBUk5J
TkcgIlBhcnNpbmcgbWljcm9jb2RlIGJsb2IgZXJyb3IgJWxkXG4iLAorICAgICAgICAgICAgICAg
ICAgIFBUUl9FUlIocGF0Y2gpKTsKKyAgICAgICAgICAgIHJldHVybiBQVFJfRVJSKHBhdGNoKTsK
KyAgICAgICAgfQorCisgICAgICAgIGlmICggIXBhdGNoICkKKyAgICAgICAgICAgIHJldHVybiAt
RU5PRU5UOworCisgICAgICAgIHNwaW5fbG9jaygmbWljcm9jb2RlX211dGV4KTsKKyAgICAgICAg
cmMgPSBtaWNyb2NvZGVfdXBkYXRlX2NhY2hlKHBhdGNoKTsKKyAgICAgICAgc3Bpbl91bmxvY2so
Jm1pY3JvY29kZV9tdXRleCk7CisgICAgICAgIEFTU0VSVChyYyk7CisKKyAgICAgICAgaWYgKCBt
aWNyb2NvZGVfb3BzLT5zdGFydF91cGRhdGUgKQogICAgICAgICAgICAgcmMgPSBtaWNyb2NvZGVf
b3BzLT5zdGFydF91cGRhdGUoKTsKIAogICAgICAgICBpZiAoIHJjICkKICAgICAgICAgICAgIHJl
dHVybiByYzsKKyAgICB9CiAKLSAgICAgICAgcmMgPSBtaWNyb2NvZGVfdXBkYXRlX2NwdShkYXRh
LCBsZW4pOworICAgIHJjID0gbWljcm9jb2RlX3VwZGF0ZV9jcHUoTlVMTCk7CiAKLSAgICAgICAg
aWYgKCBtaWNyb2NvZGVfb3BzLT5lbmRfdXBkYXRlX3BlcmNwdSApCi0gICAgICAgICAgICBtaWNy
b2NvZGVfb3BzLT5lbmRfdXBkYXRlX3BlcmNwdSgpOworICAgIGlmICggbWljcm9jb2RlX29wcy0+
ZW5kX3VwZGF0ZV9wZXJjcHUgKQorICAgICAgICBtaWNyb2NvZGVfb3BzLT5lbmRfdXBkYXRlX3Bl
cmNwdSgpOwogCi0gICAgICAgIHJldHVybiByYzsKLSAgICB9Ci0gICAgZWxzZQotICAgICAgICBy
ZXR1cm4gLUVOT01FTTsKKyAgICByZXR1cm4gcmM7CiB9CiAKIGludCBfX2luaXQgZWFybHlfbWlj
cm9jb2RlX2luaXQodm9pZCkKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9taWNyb2NvZGVfYW1k
LmMgYi94ZW4vYXJjaC94ODYvbWljcm9jb2RlX2FtZC5jCmluZGV4IDhlNGNkYWIuLjAxOTkzMDgg
MTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9taWNyb2NvZGVfYW1kLmMKKysrIGIveGVuL2FyY2gv
eDg2L21pY3JvY29kZV9hbWQuYwpAQCAtNDU1LDkgKzQ1NSwxMSBAQCBzdGF0aWMgYm9vbF90IGNo
ZWNrX2ZpbmFsX3BhdGNoX2xldmVscyh1bnNpZ25lZCBpbnQgY3B1KQogICAgIHJldHVybiAwOwog
fQogCi1zdGF0aWMgaW50IGNwdV9yZXF1ZXN0X21pY3JvY29kZShjb25zdCB2b2lkICpidWYsIHNp
emVfdCBidWZzaXplKQorc3RhdGljIHN0cnVjdCBtaWNyb2NvZGVfcGF0Y2ggKmNwdV9yZXF1ZXN0
X21pY3JvY29kZShjb25zdCB2b2lkICpidWYsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHNpemVfdCBidWZzaXplKQogewogICAgIHN0cnVjdCBt
aWNyb2NvZGVfYW1kICptY19hbWQ7CisgICAgc3RydWN0IG1pY3JvY29kZV9wYXRjaCAqcGF0Y2gg
PSBOVUxMOwogICAgIHNpemVfdCBvZmZzZXQgPSAwOwogICAgIGludCBlcnJvciA9IDA7CiAgICAg
dW5zaWduZWQgaW50IGN1cnJlbnRfY3B1X2lkOwpAQCAtNTU2LDE5ICs1NTgsMjIgQEAgc3RhdGlj
IGludCBjcHVfcmVxdWVzdF9taWNyb2NvZGUoY29uc3Qgdm9pZCAqYnVmLCBzaXplX3QgYnVmc2l6
ZSkKICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICB9CiAKLSAgICAgICAgLyogVXBkYXRlIGNh
Y2hlIGlmIHRoaXMgcGF0Y2ggY292ZXJzIGN1cnJlbnQgQ1BVICovCi0gICAgICAgIGlmICggbWlj
cm9jb2RlX2ZpdHMobmV3X3BhdGNoLT5tY19hbWQpICE9IE1JU19VQ09ERSApCi0gICAgICAgICAg
ICBtaWNyb2NvZGVfdXBkYXRlX2NhY2hlKG5ld19wYXRjaCk7Ci0gICAgICAgIGVsc2UKLSAgICAg
ICAgICAgIG1pY3JvY29kZV9mcmVlX3BhdGNoKG5ld19wYXRjaCk7Ci0KLSAgICAgICAgaWYgKCBt
YXRjaF9jcHUobWljcm9jb2RlX2dldF9jYWNoZSgpKSApCisgICAgICAgIC8qCisgICAgICAgICAq
IElmIHRoZSBuZXcgcGF0Y2ggY292ZXJzIGN1cnJlbnQgQ1BVLCBjb21wYXJlIHBhdGNoZXMgYW5k
IHN0b3JlIHRoZQorICAgICAgICAgKiBvbmUgd2l0aCBoaWdoZXIgcmV2aXNpb24uCisgICAgICAg
ICAqLworICAgICAgICBpZiAoIChtaWNyb2NvZGVfZml0cyhuZXdfcGF0Y2gtPm1jX2FtZCkgIT0g
TUlTX1VDT0RFKSAmJgorICAgICAgICAgICAgICghcGF0Y2ggfHwgKGNvbXBhcmVfcGF0Y2gobmV3
X3BhdGNoLCBwYXRjaCkgPT0gTkVXX1VDT0RFKSkgKQogICAgICAgICB7Ci0gICAgICAgICAgICBl
cnJvciA9IGFwcGx5X21pY3JvY29kZShtaWNyb2NvZGVfZ2V0X2NhY2hlKCkpOwotICAgICAgICAg
ICAgaWYgKCBlcnJvciApCi0gICAgICAgICAgICAgICAgYnJlYWs7CisgICAgICAgICAgICBzdHJ1
Y3QgbWljcm9jb2RlX3BhdGNoICp0bXAgPSBwYXRjaDsKKworICAgICAgICAgICAgcGF0Y2ggPSBu
ZXdfcGF0Y2g7CisgICAgICAgICAgICBuZXdfcGF0Y2ggPSB0bXA7CiAgICAgICAgIH0KIAorICAg
ICAgICBpZiAoIG5ld19wYXRjaCApCisgICAgICAgICAgICBtaWNyb2NvZGVfZnJlZV9wYXRjaChu
ZXdfcGF0Y2gpOworCiAgICAgICAgIGlmICggb2Zmc2V0ID49IGJ1ZnNpemUgKQogICAgICAgICAg
ICAgYnJlYWs7CiAKQEAgLTU5OSwxMyArNjA0LDEwIEBAIHN0YXRpYyBpbnQgY3B1X3JlcXVlc3Rf
bWljcm9jb2RlKGNvbnN0IHZvaWQgKmJ1Ziwgc2l6ZV90IGJ1ZnNpemUpCiAgICAgZnJlZV9wYXRj
aChtY19hbWQpOwogCiAgIG91dDoKLSAgICAvKgotICAgICAqIEluIHNvbWUgY2FzZXMgd2UgbWF5
IHJldHVybiBhbiBlcnJvciBldmVuIGlmIHByb2Nlc3NvcidzIG1pY3JvY29kZSBoYXMKLSAgICAg
KiBiZWVuIHVwZGF0ZWQuIEZvciBleGFtcGxlLCB0aGUgZmlyc3QgcGF0Y2ggaW4gYSBjb250YWlu
ZXIgZmlsZSBpcyBsb2FkZWQKLSAgICAgKiBzdWNjZXNzZnVsbHkgYnV0IHN1YnNlcXVlbnQgY29u
dGFpbmVyIGZpbGUgcHJvY2Vzc2luZyBlbmNvdW50ZXJzIGEKLSAgICAgKiBmYWlsdXJlLgotICAg
ICAqLwotICAgIHJldHVybiBlcnJvcjsKKyAgICBpZiAoIGVycm9yICYmICFwYXRjaCApCisgICAg
ICAgIHBhdGNoID0gRVJSX1BUUihlcnJvcik7CisKKyAgICByZXR1cm4gcGF0Y2g7CiB9CiAKICNp
ZmRlZiBDT05GSUdfSFZNCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvbWljcm9jb2RlX2ludGVs
LmMgYi94ZW4vYXJjaC94ODYvbWljcm9jb2RlX2ludGVsLmMKaW5kZXggMjMxOTdjYS4uMWIzYWM5
MyAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L21pY3JvY29kZV9pbnRlbC5jCisrKyBiL3hlbi9h
cmNoL3g4Ni9taWNyb2NvZGVfaW50ZWwuYwpAQCAtMjg1LDE0ICsyODUsOSBAQCBzdGF0aWMgZW51
bSBtaWNyb2NvZGVfbWF0Y2hfcmVzdWx0IGNvbXBhcmVfcGF0Y2goCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBPTERfVUNPREU7
CiB9CiAKLS8qCi0gKiByZXR1cm4gMCAtIG5vIHVwZGF0ZSBmb3VuZAotICogcmV0dXJuIDEgLSBm
b3VuZCB1cGRhdGUKLSAqIHJldHVybiA8IDAgLSBlcnJvcgotICovCi1zdGF0aWMgaW50IGdldF9t
YXRjaGluZ19taWNyb2NvZGUoY29uc3Qgdm9pZCAqbWMpCitzdGF0aWMgc3RydWN0IG1pY3JvY29k
ZV9wYXRjaCAqYWxsb2NfbWljcm9jb2RlX3BhdGNoKAorICAgIGNvbnN0IHN0cnVjdCBtaWNyb2Nv
ZGVfaGVhZGVyX2ludGVsICptY19oZWFkZXIpCiB7Ci0gICAgY29uc3Qgc3RydWN0IG1pY3JvY29k
ZV9oZWFkZXJfaW50ZWwgKm1jX2hlYWRlciA9IG1jOwogICAgIHVuc2lnbmVkIGxvbmcgdG90YWxf
c2l6ZSA9IGdldF90b3RhbHNpemUobWNfaGVhZGVyKTsKICAgICB2b2lkICpuZXdfbWMgPSB4bWFs
bG9jX2J5dGVzKHRvdGFsX3NpemUpOwogICAgIHN0cnVjdCBtaWNyb2NvZGVfcGF0Y2ggKm5ld19w
YXRjaCA9IHhtYWxsb2Moc3RydWN0IG1pY3JvY29kZV9wYXRjaCk7CkBAIC0zMDEsMjUgKzI5Niwx
MiBAQCBzdGF0aWMgaW50IGdldF9tYXRjaGluZ19taWNyb2NvZGUoY29uc3Qgdm9pZCAqbWMpCiAg
ICAgewogICAgICAgICB4ZnJlZShuZXdfcGF0Y2gpOwogICAgICAgICB4ZnJlZShuZXdfbWMpOwot
ICAgICAgICByZXR1cm4gLUVOT01FTTsKKyAgICAgICAgcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7
CiAgICAgfQotICAgIG1lbWNweShuZXdfbWMsIG1jLCB0b3RhbF9zaXplKTsKKyAgICBtZW1jcHko
bmV3X21jLCBtY19oZWFkZXIsIHRvdGFsX3NpemUpOwogICAgIG5ld19wYXRjaC0+bWNfaW50ZWwg
PSBuZXdfbWM7CiAKLSAgICAvKiBNYWtlIHN1cmUgdGhhdCB0aGlzIHBhdGNoIGNvdmVycyBjdXJy
ZW50IENQVSAqLwotICAgIGlmICggbWljcm9jb2RlX3VwZGF0ZV9tYXRjaChtYykgPT0gTUlTX1VD
T0RFICkKLSAgICB7Ci0gICAgICAgIG1pY3JvY29kZV9mcmVlX3BhdGNoKG5ld19wYXRjaCk7Ci0g
ICAgICAgIHJldHVybiAwOwotICAgIH0KLQotICAgIG1pY3JvY29kZV91cGRhdGVfY2FjaGUobmV3
X3BhdGNoKTsKLQotICAgIHByX2RlYnVnKCJtaWNyb2NvZGU6IENQVSVkIGZvdW5kIGEgbWF0Y2hp
bmcgbWljcm9jb2RlIHVwZGF0ZSB3aXRoIgotICAgICAgICAgICAgICIgdmVyc2lvbiAlI3ggKGN1
cnJlbnQ9JSN4KVxuIiwKLSAgICAgICAgICAgICBzbXBfcHJvY2Vzc29yX2lkKCksIG1jX2hlYWRl
ci0+cmV2LCB0aGlzX2NwdShjcHVfc2lnKS5yZXYpOwotCi0gICAgcmV0dXJuIDE7CisgICAgcmV0
dXJuIG5ld19wYXRjaDsKIH0KIAogc3RhdGljIGludCBhcHBseV9taWNyb2NvZGUoY29uc3Qgc3Ry
dWN0IG1pY3JvY29kZV9wYXRjaCAqcGF0Y2gpCkBAIC0zOTgsMjYgKzM4MCw0NCBAQCBzdGF0aWMg
bG9uZyBnZXRfbmV4dF91Y29kZV9mcm9tX2J1ZmZlcih2b2lkICoqbWMsIGNvbnN0IHU4ICpidWYs
CiAgICAgcmV0dXJuIG9mZnNldCArIHRvdGFsX3NpemU7CiB9CiAKLXN0YXRpYyBpbnQgY3B1X3Jl
cXVlc3RfbWljcm9jb2RlKGNvbnN0IHZvaWQgKmJ1Ziwgc2l6ZV90IHNpemUpCitzdGF0aWMgc3Ry
dWN0IG1pY3JvY29kZV9wYXRjaCAqY3B1X3JlcXVlc3RfbWljcm9jb2RlKGNvbnN0IHZvaWQgKmJ1
ZiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
c2l6ZV90IHNpemUpCiB7CiAgICAgbG9uZyBvZmZzZXQgPSAwOwogICAgIGludCBlcnJvciA9IDA7
CiAgICAgdm9pZCAqbWM7CisgICAgc3RydWN0IG1pY3JvY29kZV9wYXRjaCAqcGF0Y2ggPSBOVUxM
OwogCiAgICAgd2hpbGUgKCAob2Zmc2V0ID0gZ2V0X25leHRfdWNvZGVfZnJvbV9idWZmZXIoJm1j
LCBidWYsIHNpemUsIG9mZnNldCkpID4gMCApCiAgICAgeworICAgICAgICBzdHJ1Y3QgbWljcm9j
b2RlX3BhdGNoICpuZXdfcGF0Y2g7CisKICAgICAgICAgZXJyb3IgPSBtaWNyb2NvZGVfc2FuaXR5
X2NoZWNrKG1jKTsKICAgICAgICAgaWYgKCBlcnJvciApCiAgICAgICAgICAgICBicmVhazsKLSAg
ICAgICAgZXJyb3IgPSBnZXRfbWF0Y2hpbmdfbWljcm9jb2RlKG1jKTsKLSAgICAgICAgaWYgKCBl
cnJvciA8IDAgKQorCisgICAgICAgIG5ld19wYXRjaCA9IGFsbG9jX21pY3JvY29kZV9wYXRjaCht
Yyk7CisgICAgICAgIGlmICggSVNfRVJSKG5ld19wYXRjaCkgKQorICAgICAgICB7CisgICAgICAg
ICAgICBlcnJvciA9IFBUUl9FUlIobmV3X3BhdGNoKTsKICAgICAgICAgICAgIGJyZWFrOworICAg
ICAgICB9CisKICAgICAgICAgLyoKLSAgICAgICAgICogSXQncyBwb3NzaWJsZSB0aGUgZGF0YSBm
aWxlIGhhcyBtdWx0aXBsZSBtYXRjaGluZyB1Y29kZSwKLSAgICAgICAgICogbGV0cyBrZWVwIHNl
YXJjaGluZyB0aWxsIHRoZSBsYXRlc3QgdmVyc2lvbgorICAgICAgICAgKiBJZiB0aGUgbmV3IHBh
dGNoIGNvdmVycyBjdXJyZW50IENQVSwgY29tcGFyZSBwYXRjaGVzIGFuZCBzdG9yZSB0aGUKKyAg
ICAgICAgICogb25lIHdpdGggaGlnaGVyIHJldmlzaW9uLgogICAgICAgICAgKi8KLSAgICAgICAg
aWYgKCBlcnJvciA9PSAxICkKLSAgICAgICAgICAgIGVycm9yID0gMDsKKyAgICAgICAgaWYgKCAo
bWljcm9jb2RlX3VwZGF0ZV9tYXRjaCgmbmV3X3BhdGNoLT5tY19pbnRlbC0+aGRyKSAhPSBNSVNf
VUNPREUpICYmCisgICAgICAgICAgICAgKCFwYXRjaCB8fCAoY29tcGFyZV9wYXRjaChuZXdfcGF0
Y2gsIHBhdGNoKSA9PSBORVdfVUNPREUpKSApCisgICAgICAgIHsKKyAgICAgICAgICAgIHN0cnVj
dCBtaWNyb2NvZGVfcGF0Y2ggKnRtcCA9IHBhdGNoOworCisgICAgICAgICAgICBwYXRjaCA9IG5l
d19wYXRjaDsKKyAgICAgICAgICAgIG5ld19wYXRjaCA9IHRtcDsKKyAgICAgICAgfQorCisgICAg
ICAgIGlmICggbmV3X3BhdGNoICkKKyAgICAgICAgICAgIG1pY3JvY29kZV9mcmVlX3BhdGNoKG5l
d19wYXRjaCk7CiAKICAgICAgICAgeGZyZWUobWMpOwogICAgIH0KQEAgLTQyNiwxMCArNDI2LDEw
IEBAIHN0YXRpYyBpbnQgY3B1X3JlcXVlc3RfbWljcm9jb2RlKGNvbnN0IHZvaWQgKmJ1Ziwgc2l6
ZV90IHNpemUpCiAgICAgaWYgKCBvZmZzZXQgPCAwICkKICAgICAgICAgZXJyb3IgPSBvZmZzZXQ7
CiAKLSAgICBpZiAoICFlcnJvciAmJiBtYXRjaF9jcHUobWljcm9jb2RlX2dldF9jYWNoZSgpKSAp
Ci0gICAgICAgIGVycm9yID0gYXBwbHlfbWljcm9jb2RlKG1pY3JvY29kZV9nZXRfY2FjaGUoKSk7
CisgICAgaWYgKCBlcnJvciAmJiAhcGF0Y2ggKQorICAgICAgICBwYXRjaCA9IEVSUl9QVFIoZXJy
b3IpOwogCi0gICAgcmV0dXJuIGVycm9yOworICAgIHJldHVybiBwYXRjaDsKIH0KIAogc3RhdGlj
IGNvbnN0IHN0cnVjdCBtaWNyb2NvZGVfb3BzIG1pY3JvY29kZV9pbnRlbF9vcHMgPSB7CmRpZmYg
LS1naXQgYS94ZW4vaW5jbHVkZS9hc20teDg2L21pY3JvY29kZS5oIGIveGVuL2luY2x1ZGUvYXNt
LXg4Ni9taWNyb2NvZGUuaAppbmRleCAwMmZlYjA5Li43ZDVhMWY4IDEwMDY0NAotLS0gYS94ZW4v
aW5jbHVkZS9hc20teDg2L21pY3JvY29kZS5oCisrKyBiL3hlbi9pbmNsdWRlL2FzbS14ODYvbWlj
cm9jb2RlLmgKQEAgLTIwLDcgKzIwLDggQEAgc3RydWN0IG1pY3JvY29kZV9wYXRjaCB7CiB9Owog
CiBzdHJ1Y3QgbWljcm9jb2RlX29wcyB7Ci0gICAgaW50ICgqY3B1X3JlcXVlc3RfbWljcm9jb2Rl
KShjb25zdCB2b2lkICpidWYsIHNpemVfdCBzaXplKTsKKyAgICBzdHJ1Y3QgbWljcm9jb2RlX3Bh
dGNoICooKmNwdV9yZXF1ZXN0X21pY3JvY29kZSkoY29uc3Qgdm9pZCAqYnVmLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplX3Qgc2l6ZSk7
CiAgICAgaW50ICgqY29sbGVjdF9jcHVfaW5mbykoc3RydWN0IGNwdV9zaWduYXR1cmUgKmNzaWcp
OwogICAgIGludCAoKmFwcGx5X21pY3JvY29kZSkoY29uc3Qgc3RydWN0IG1pY3JvY29kZV9wYXRj
aCAqcGF0Y2gpOwogICAgIGludCAoKnN0YXJ0X3VwZGF0ZSkodm9pZCk7CkBAIC00MCw4ICs0MSw2
IEBAIHN0cnVjdCBjcHVfc2lnbmF0dXJlIHsKIERFQ0xBUkVfUEVSX0NQVShzdHJ1Y3QgY3B1X3Np
Z25hdHVyZSwgY3B1X3NpZyk7CiBleHRlcm4gY29uc3Qgc3RydWN0IG1pY3JvY29kZV9vcHMgKm1p
Y3JvY29kZV9vcHM7CiAKLWNvbnN0IHN0cnVjdCBtaWNyb2NvZGVfcGF0Y2ggKm1pY3JvY29kZV9n
ZXRfY2FjaGUodm9pZCk7Ci1ib29sIG1pY3JvY29kZV91cGRhdGVfY2FjaGUoc3RydWN0IG1pY3Jv
Y29kZV9wYXRjaCAqcGF0Y2gpOwogdm9pZCBtaWNyb2NvZGVfZnJlZV9wYXRjaChzdHJ1Y3QgbWlj
cm9jb2RlX3BhdGNoICpwYXRjaCk7CiAKICNlbmRpZiAvKiBBU01fWDg2X19NSUNST0NPREVfSCAq
LwotLSAKMS44LjMuMQoKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qu
b3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2
ZWw=

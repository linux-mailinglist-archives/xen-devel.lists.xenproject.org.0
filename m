Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id DD598C2227
	for <lists+xen-devel@lfdr.de>; Mon, 30 Sep 2019 15:36:05 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iEvne-0005PD-Sm; Mon, 30 Sep 2019 13:33:14 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=znM2=XZ=citrix.com=roger.pau@srs-us1.protection.inumbo.net>)
 id 1iEvnd-0005P3-5R
 for xen-devel@lists.xenproject.org; Mon, 30 Sep 2019 13:33:13 +0000
X-Inumbo-ID: d8b3e466-e386-11e9-97fb-bc764e2007e4
Received: from esa4.hc3370-68.iphmx.com (unknown [216.71.155.144])
 by localhost (Halon) with ESMTPS
 id d8b3e466-e386-11e9-97fb-bc764e2007e4;
 Mon, 30 Sep 2019 13:33:11 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1569850391;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=of/yyAIAxm+0TP/Swh4+PPiPARUlmHFzJANhoR72Gd8=;
 b=NmxdMoIbIkJYZx15wLbUaTPsbTsGOjcJRmb4xbB9HhWQhimIMCuz8edp
 rogv8l9NEfGxg4ngTRVIXjXseGQ04jVzr7JzKl2bwutnhvod7MPNdUTZb
 obW4l4cVtxxDWphVQtqb1nQobe8TuhMCso3W7v/2j+JivyGL79BKxh1BY 4=;
Authentication-Results: esa4.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=roger.pau@citrix.com;
 spf=Pass smtp.mailfrom=roger.pau@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa4.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 roger.pau@citrix.com) identity=pra; client-ip=162.221.158.21;
 receiver=esa4.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="roger.pau@citrix.com"; x-conformance=sidf_compatible
Received-SPF: Pass (esa4.hc3370-68.iphmx.com: domain of
 roger.pau@citrix.com designates 162.221.158.21 as permitted
 sender) identity=mailfrom; client-ip=162.221.158.21;
 receiver=esa4.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="roger.pau@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83 ~all"
Received-SPF: None (esa4.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa4.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: SC1WPeLCkDlV2y1n9KqtoxMvoVcs+/sgciqtOstY8Kg3rF3bNbSp4ZmNwKTrJeWmU+nEVfzoUn
 LbAMnIGXXDPUMPRaOCL1hRiwFr2+HvzbhasnbhoIIGneGlshFmGoiXiSANu/KXDmwJbGzusa5/
 m5qxFuHp0CDnBM5QvmA6yyPIKeJGrsifO3i16AA2YPDR9eOh0cZ+zldY8IEEunb/WpQCcfN8Iy
 rxVU0NS46DXbPNKfB2clM8enQjN0Wqj2dmnoHOkmYtkzV/XkLmUbouORGBITEgc4am3UctDRE6
 uPo=
X-SBRS: 2.7
X-MesageID: 6602528
X-Ironport-Server: esa4.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.64,567,1559534400"; 
   d="scan'208";a="6602528"
From: Roger Pau Monne <roger.pau@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Mon, 30 Sep 2019 15:32:30 +0200
Message-ID: <20190930133238.49868-3-roger.pau@citrix.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190930133238.49868-1-roger.pau@citrix.com>
References: <20190930133238.49868-1-roger.pau@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v3 02/10] ioreq: switch selection and forwarding
 to use ioservid_t
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>, Konrad
 Rzeszutek Wilk <konrad.wilk@oracle.com>, George
 Dunlap <George.Dunlap@eu.citrix.com>, Andrew Cooper <andrew.cooper3@citrix.com>,
 Paul Durrant <paul@xen.org>, Ian Jackson <ian.jackson@eu.citrix.com>,
 Tim Deegan <tim@xen.org>, Julien Grall <julien.grall@arm.com>,
 Paul Durrant <paul.durrant@citrix.com>, Jan Beulich <jbeulich@suse.com>,
 Roger Pau Monne <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

aHZtX3NlbGVjdF9pb3JlcV9zZXJ2ZXIgYW5kIGh2bV9zZW5kX2lvcmVxIHdoZXJlIGJvdGggdXNp
bmcKaHZtX2lvcmVxX3NlcnZlciBkaXJlY3RseSwgc3dpdGNoIHRvIHVzZSBpb3NlcnZpZF90IGlu
IG9yZGVyIHRvIHNlbGVjdAphbmQgZm9yd2FyZCBpb3JlcXMuCgpUaGlzIGlzIGEgcHJlcGFyYXRv
cnkgY2hhbmdlLCBzaW5jZSBmdXR1cmUgcGF0Y2hlcyB3aWxsIHVzZSB0aGUgaW9yZXEKc2VydmVy
IGlkIGluIG9yZGVyIHRvIGRpZmZlcmVudGlhdGUgYmV0d2VlbiBpbnRlcm5hbCBhbmQgZXh0ZXJu
YWwKaW9yZXEgc2VydmVycy4KClNpZ25lZC1vZmYtYnk6IFJvZ2VyIFBhdSBNb25uw6kgPHJvZ2Vy
LnBhdUBjaXRyaXguY29tPgpSZXZpZXdlZC1ieTogUGF1bCBEdXJyYW50IDxwYXVsLmR1cnJhbnRA
Y2l0cml4LmNvbT4KQWNrZWQtYnk6IEphbiBCZXVsaWNoIDxqYmV1bGljaEBzdXNlLmNvbT4KLS0t
CkNoYW5nZXMgc2luY2UgdjI6CiAtIERvbid0IGhhcmRjb2RlIDB4ZmZmZiBmb3IgWEVOX0lOVkFM
SURfSU9TRVJWSUQuCgpDaGFuZ2VzIHNpbmNlIHYxOgogLSBOZXcgaW4gdGhpcyB2ZXJzaW9uLgot
LS0KIHhlbi9hcmNoL3g4Ni9odm0vZG0uYyAgICAgICAgICAgfCAgMiArLQogeGVuL2FyY2gveDg2
L2h2bS9lbXVsYXRlLmMgICAgICB8IDE0ICsrKysrKystLS0tLS0tCiB4ZW4vYXJjaC94ODYvaHZt
L2lvcmVxLmMgICAgICAgIHwgMjQgKysrKysrKysrKysrLS0tLS0tLS0tLS0tCiB4ZW4vYXJjaC94
ODYvaHZtL3N0ZHZnYS5jICAgICAgIHwgIDggKysrKy0tLS0KIHhlbi9hcmNoL3g4Ni9tbS9wMm0u
YyAgICAgICAgICAgfCAyMCArKysrKysrKysrLS0tLS0tLS0tLQogeGVuL2luY2x1ZGUvYXNtLXg4
Ni9odm0vaW9yZXEuaCB8ICA1ICsrLS0tCiB4ZW4vaW5jbHVkZS9hc20teDg2L3AybS5oICAgICAg
IHwgIDkgKysrKy0tLS0tCiB4ZW4vaW5jbHVkZS9wdWJsaWMvaHZtL2RtX29wLmggIHwgIDEgKwog
OCBmaWxlcyBjaGFuZ2VkLCA0MSBpbnNlcnRpb25zKCspLCA0MiBkZWxldGlvbnMoLSkKCmRpZmYg
LS1naXQgYS94ZW4vYXJjaC94ODYvaHZtL2RtLmMgYi94ZW4vYXJjaC94ODYvaHZtL2RtLmMKaW5k
ZXggZDZkMGU4YmU4OS4uYzJmY2E5ZjcyOSAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L2h2bS9k
bS5jCisrKyBiL3hlbi9hcmNoL3g4Ni9odm0vZG0uYwpAQCAtMjYzLDcgKzI2Myw3IEBAIHN0YXRp
YyBpbnQgc2V0X21lbV90eXBlKHN0cnVjdCBkb21haW4gKmQsCiAgICAgICAgICAgICByZXR1cm4g
LUVPUE5PVFNVUFA7CiAKICAgICAgICAgLyogRG8gbm90IGNoYW5nZSB0byBIVk1NRU1faW9yZXFf
c2VydmVyIGlmIG5vIGlvcmVxIHNlcnZlciBtYXBwZWQuICovCi0gICAgICAgIGlmICggIXAybV9n
ZXRfaW9yZXFfc2VydmVyKGQsICZmbGFncykgKQorICAgICAgICBpZiAoIHAybV9nZXRfaW9yZXFf
c2VydmVyKGQsICZmbGFncykgPT0gWEVOX0lOVkFMSURfSU9TRVJWSUQgKQogICAgICAgICAgICAg
cmV0dXJuIC1FSU5WQUw7CiAgICAgfQogCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvaHZtL2Vt
dWxhdGUuYyBiL3hlbi9hcmNoL3g4Ni9odm0vZW11bGF0ZS5jCmluZGV4IDYzNzAzNGI2YTEuLmMz
N2JkMDIwYzggMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9odm0vZW11bGF0ZS5jCisrKyBiL3hl
bi9hcmNoL3g4Ni9odm0vZW11bGF0ZS5jCkBAIC0yNTUsNyArMjU1LDcgQEAgc3RhdGljIGludCBo
dm1lbXVsX2RvX2lvKAogICAgICAgICAgKiBIb3dldmVyLCB0aGVyZSdzIG5vIGNoZWFwIGFwcHJv
YWNoIHRvIGF2b2lkIGFib3ZlIHNpdHVhdGlvbnMgaW4geGVuLAogICAgICAgICAgKiBzbyB0aGUg
ZGV2aWNlIG1vZGVsIHNpZGUgbmVlZHMgdG8gY2hlY2sgdGhlIGluY29taW5nIGlvcmVxIGV2ZW50
LgogICAgICAgICAgKi8KLSAgICAgICAgc3RydWN0IGh2bV9pb3JlcV9zZXJ2ZXIgKnMgPSBOVUxM
OworICAgICAgICBpb3NlcnZpZF90IGlkID0gWEVOX0lOVkFMSURfSU9TRVJWSUQ7CiAgICAgICAg
IHAybV90eXBlX3QgcDJtdCA9IHAybV9pbnZhbGlkOwogCiAgICAgICAgIGlmICggaXNfbW1pbyAp
CkBAIC0yNjgsOSArMjY4LDkgQEAgc3RhdGljIGludCBodm1lbXVsX2RvX2lvKAogICAgICAgICAg
ICAgewogICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCBmbGFnczsKIAotICAgICAgICAgICAg
ICAgIHMgPSBwMm1fZ2V0X2lvcmVxX3NlcnZlcihjdXJyZCwgJmZsYWdzKTsKKyAgICAgICAgICAg
ICAgICBpZCA9IHAybV9nZXRfaW9yZXFfc2VydmVyKGN1cnJkLCAmZmxhZ3MpOwogCi0gICAgICAg
ICAgICAgICAgaWYgKCBzID09IE5VTEwgKQorICAgICAgICAgICAgICAgIGlmICggaWQgPT0gWEVO
X0lOVkFMSURfSU9TRVJWSUQgKQogICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAg
ICAgcmMgPSBYODZFTVVMX1JFVFJZOwogICAgICAgICAgICAgICAgICAgICB2aW8tPmlvX3JlcS5z
dGF0ZSA9IFNUQVRFX0lPUkVRX05PTkU7CkBAIC0yOTAsMTggKzI5MCwxOCBAQCBzdGF0aWMgaW50
IGh2bWVtdWxfZG9faW8oCiAgICAgICAgICAgICB9CiAgICAgICAgIH0KIAotICAgICAgICBpZiAo
ICFzICkKLSAgICAgICAgICAgIHMgPSBodm1fc2VsZWN0X2lvcmVxX3NlcnZlcihjdXJyZCwgJnAp
OworICAgICAgICBpZiAoIGlkID09IFhFTl9JTlZBTElEX0lPU0VSVklEICkKKyAgICAgICAgICAg
IGlkID0gaHZtX3NlbGVjdF9pb3JlcV9zZXJ2ZXIoY3VycmQsICZwKTsKIAogICAgICAgICAvKiBJ
ZiB0aGVyZSBpcyBubyBzdWl0YWJsZSBiYWNraW5nIERNLCBqdXN0IGlnbm9yZSBhY2Nlc3NlcyAq
LwotICAgICAgICBpZiAoICFzICkKKyAgICAgICAgaWYgKCBpZCA9PSBYRU5fSU5WQUxJRF9JT1NF
UlZJRCApCiAgICAgICAgIHsKICAgICAgICAgICAgIHJjID0gaHZtX3Byb2Nlc3NfaW9faW50ZXJj
ZXB0KCZudWxsX2hhbmRsZXIsICZwKTsKICAgICAgICAgICAgIHZpby0+aW9fcmVxLnN0YXRlID0g
U1RBVEVfSU9SRVFfTk9ORTsKICAgICAgICAgfQogICAgICAgICBlbHNlCiAgICAgICAgIHsKLSAg
ICAgICAgICAgIHJjID0gaHZtX3NlbmRfaW9yZXEocywgJnAsIDApOworICAgICAgICAgICAgcmMg
PSBodm1fc2VuZF9pb3JlcShpZCwgJnAsIDApOwogICAgICAgICAgICAgaWYgKCByYyAhPSBYODZF
TVVMX1JFVFJZIHx8IGN1cnJkLT5pc19zaHV0dGluZ19kb3duICkKICAgICAgICAgICAgICAgICB2
aW8tPmlvX3JlcS5zdGF0ZSA9IFNUQVRFX0lPUkVRX05PTkU7CiAgICAgICAgICAgICBlbHNlIGlm
ICggIWh2bV9pb3JlcV9uZWVkc19jb21wbGV0aW9uKCZ2aW8tPmlvX3JlcSkgKQpkaWZmIC0tZ2l0
IGEveGVuL2FyY2gveDg2L2h2bS9pb3JlcS5jIGIveGVuL2FyY2gveDg2L2h2bS9pb3JlcS5jCmlu
ZGV4IDVlNTAzY2U0OTguLmVkMDE0MmM0ZTEgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9odm0v
aW9yZXEuYworKysgYi94ZW4vYXJjaC94ODYvaHZtL2lvcmVxLmMKQEAgLTM5LDYgKzM5LDcgQEAg
c3RhdGljIHZvaWQgc2V0X2lvcmVxX3NlcnZlcihzdHJ1Y3QgZG9tYWluICpkLCB1bnNpZ25lZCBp
bnQgaWQsCiB7CiAgICAgQVNTRVJUKGlkIDwgTUFYX05SX0lPUkVRX1NFUlZFUlMpOwogICAgIEFT
U0VSVCghcyB8fCAhZC0+YXJjaC5odm0uaW9yZXFfc2VydmVyLnNlcnZlcltpZF0pOworICAgIEJV
SUxEX0JVR19PTihNQVhfTlJfSU9SRVFfU0VSVkVSUyA+PSBYRU5fSU5WQUxJRF9JT1NFUlZJRCk7
CiAKICAgICBkLT5hcmNoLmh2bS5pb3JlcV9zZXJ2ZXIuc2VydmVyW2lkXSA9IHM7CiB9CkBAIC04
NjgsNyArODY5LDcgQEAgaW50IGh2bV9kZXN0cm95X2lvcmVxX3NlcnZlcihzdHJ1Y3QgZG9tYWlu
ICpkLCBpb3NlcnZpZF90IGlkKQogCiAgICAgZG9tYWluX3BhdXNlKGQpOwogCi0gICAgcDJtX3Nl
dF9pb3JlcV9zZXJ2ZXIoZCwgMCwgcyk7CisgICAgcDJtX3NldF9pb3JlcV9zZXJ2ZXIoZCwgMCwg
aWQpOwogCiAgICAgaHZtX2lvcmVxX3NlcnZlcl9kaXNhYmxlKHMpOwogCkBAIC0xMTI1LDcgKzEx
MjYsNyBAQCBpbnQgaHZtX21hcF9tZW1fdHlwZV90b19pb3JlcV9zZXJ2ZXIoc3RydWN0IGRvbWFp
biAqZCwgaW9zZXJ2aWRfdCBpZCwKICAgICBpZiAoIHMtPmVtdWxhdG9yICE9IGN1cnJlbnQtPmRv
bWFpbiApCiAgICAgICAgIGdvdG8gb3V0OwogCi0gICAgcmMgPSBwMm1fc2V0X2lvcmVxX3NlcnZl
cihkLCBmbGFncywgcyk7CisgICAgcmMgPSBwMm1fc2V0X2lvcmVxX3NlcnZlcihkLCBmbGFncywg
aWQpOwogCiAgb3V0OgogICAgIHNwaW5fdW5sb2NrX3JlY3Vyc2l2ZSgmZC0+YXJjaC5odm0uaW9y
ZXFfc2VydmVyLmxvY2spOwpAQCAtMTI0OSw4ICsxMjUwLDcgQEAgdm9pZCBodm1fZGVzdHJveV9h
bGxfaW9yZXFfc2VydmVycyhzdHJ1Y3QgZG9tYWluICpkKQogICAgIHNwaW5fdW5sb2NrX3JlY3Vy
c2l2ZSgmZC0+YXJjaC5odm0uaW9yZXFfc2VydmVyLmxvY2spOwogfQogCi1zdHJ1Y3QgaHZtX2lv
cmVxX3NlcnZlciAqaHZtX3NlbGVjdF9pb3JlcV9zZXJ2ZXIoc3RydWN0IGRvbWFpbiAqZCwKLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpb3JlcV90ICpw
KQoraW9zZXJ2aWRfdCBodm1fc2VsZWN0X2lvcmVxX3NlcnZlcihzdHJ1Y3QgZG9tYWluICpkLCBp
b3JlcV90ICpwKQogewogICAgIHN0cnVjdCBodm1faW9yZXFfc2VydmVyICpzOwogICAgIHVpbnQz
Ml90IGNmODsKQEAgLTEyNTksNyArMTI1OSw3IEBAIHN0cnVjdCBodm1faW9yZXFfc2VydmVyICpo
dm1fc2VsZWN0X2lvcmVxX3NlcnZlcihzdHJ1Y3QgZG9tYWluICpkLAogICAgIHVuc2lnbmVkIGlu
dCBpZDsKIAogICAgIGlmICggcC0+dHlwZSAhPSBJT1JFUV9UWVBFX0NPUFkgJiYgcC0+dHlwZSAh
PSBJT1JFUV9UWVBFX1BJTyApCi0gICAgICAgIHJldHVybiBOVUxMOworICAgICAgICByZXR1cm4g
WEVOX0lOVkFMSURfSU9TRVJWSUQ7CiAKICAgICBjZjggPSBkLT5hcmNoLmh2bS5wY2lfY2Y4Owog
CkBAIC0xMzE0LDcgKzEzMTQsNyBAQCBzdHJ1Y3QgaHZtX2lvcmVxX3NlcnZlciAqaHZtX3NlbGVj
dF9pb3JlcV9zZXJ2ZXIoc3RydWN0IGRvbWFpbiAqZCwKICAgICAgICAgICAgIHN0YXJ0ID0gYWRk
cjsKICAgICAgICAgICAgIGVuZCA9IHN0YXJ0ICsgcC0+c2l6ZSAtIDE7CiAgICAgICAgICAgICBp
ZiAoIHJhbmdlc2V0X2NvbnRhaW5zX3JhbmdlKHIsIHN0YXJ0LCBlbmQpICkKLSAgICAgICAgICAg
ICAgICByZXR1cm4gczsKKyAgICAgICAgICAgICAgICByZXR1cm4gaWQ7CiAKICAgICAgICAgICAg
IGJyZWFrOwogCkBAIC0xMzIzLDcgKzEzMjMsNyBAQCBzdHJ1Y3QgaHZtX2lvcmVxX3NlcnZlciAq
aHZtX3NlbGVjdF9pb3JlcV9zZXJ2ZXIoc3RydWN0IGRvbWFpbiAqZCwKICAgICAgICAgICAgIGVu
ZCA9IGh2bV9tbWlvX2xhc3RfYnl0ZShwKTsKIAogICAgICAgICAgICAgaWYgKCByYW5nZXNldF9j
b250YWluc19yYW5nZShyLCBzdGFydCwgZW5kKSApCi0gICAgICAgICAgICAgICAgcmV0dXJuIHM7
CisgICAgICAgICAgICAgICAgcmV0dXJuIGlkOwogCiAgICAgICAgICAgICBicmVhazsKIApAQCAt
MTMzMiwxNCArMTMzMiwxNCBAQCBzdHJ1Y3QgaHZtX2lvcmVxX3NlcnZlciAqaHZtX3NlbGVjdF9p
b3JlcV9zZXJ2ZXIoc3RydWN0IGRvbWFpbiAqZCwKICAgICAgICAgICAgIHsKICAgICAgICAgICAg
ICAgICBwLT50eXBlID0gSU9SRVFfVFlQRV9QQ0lfQ09ORklHOwogICAgICAgICAgICAgICAgIHAt
PmFkZHIgPSBhZGRyOwotICAgICAgICAgICAgICAgIHJldHVybiBzOworICAgICAgICAgICAgICAg
IHJldHVybiBpZDsKICAgICAgICAgICAgIH0KIAogICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg
IH0KICAgICB9CiAKLSAgICByZXR1cm4gTlVMTDsKKyAgICByZXR1cm4gWEVOX0lOVkFMSURfSU9T
RVJWSUQ7CiB9CiAKIHN0YXRpYyBpbnQgaHZtX3NlbmRfYnVmZmVyZWRfaW9yZXEoc3RydWN0IGh2
bV9pb3JlcV9zZXJ2ZXIgKnMsIGlvcmVxX3QgKnApCkBAIC0xNDM1LDEyICsxNDM1LDEyIEBAIHN0
YXRpYyBpbnQgaHZtX3NlbmRfYnVmZmVyZWRfaW9yZXEoc3RydWN0IGh2bV9pb3JlcV9zZXJ2ZXIg
KnMsIGlvcmVxX3QgKnApCiAgICAgcmV0dXJuIFg4NkVNVUxfT0tBWTsKIH0KIAotaW50IGh2bV9z
ZW5kX2lvcmVxKHN0cnVjdCBodm1faW9yZXFfc2VydmVyICpzLCBpb3JlcV90ICpwcm90b19wLAot
ICAgICAgICAgICAgICAgICAgIGJvb2wgYnVmZmVyZWQpCitpbnQgaHZtX3NlbmRfaW9yZXEoaW9z
ZXJ2aWRfdCBpZCwgaW9yZXFfdCAqcHJvdG9fcCwgYm9vbCBidWZmZXJlZCkKIHsKICAgICBzdHJ1
Y3QgdmNwdSAqY3VyciA9IGN1cnJlbnQ7CiAgICAgc3RydWN0IGRvbWFpbiAqZCA9IGN1cnItPmRv
bWFpbjsKICAgICBzdHJ1Y3QgaHZtX2lvcmVxX3ZjcHUgKnN2OworICAgIHN0cnVjdCBodm1faW9y
ZXFfc2VydmVyICpzID0gZ2V0X2lvcmVxX3NlcnZlcihkLCBpZCk7CiAKICAgICBBU1NFUlQocyk7
CiAKQEAgLTE1MDYsNyArMTUwNiw3IEBAIHVuc2lnbmVkIGludCBodm1fYnJvYWRjYXN0X2lvcmVx
KGlvcmVxX3QgKnAsIGJvb2wgYnVmZmVyZWQpCiAgICAgICAgIGlmICggIXMtPmVuYWJsZWQgKQog
ICAgICAgICAgICAgY29udGludWU7CiAKLSAgICAgICAgaWYgKCBodm1fc2VuZF9pb3JlcShzLCBw
LCBidWZmZXJlZCkgPT0gWDg2RU1VTF9VTkhBTkRMRUFCTEUgKQorICAgICAgICBpZiAoIGh2bV9z
ZW5kX2lvcmVxKGlkLCBwLCBidWZmZXJlZCkgPT0gWDg2RU1VTF9VTkhBTkRMRUFCTEUgKQogICAg
ICAgICAgICAgZmFpbGVkKys7CiAgICAgfQogCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvaHZt
L3N0ZHZnYS5jIGIveGVuL2FyY2gveDg2L2h2bS9zdGR2Z2EuYwppbmRleCBiZDM5OGRiYjFiLi5h
Njg5MjY5NzEyIDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYvaHZtL3N0ZHZnYS5jCisrKyBiL3hl
bi9hcmNoL3g4Ni9odm0vc3RkdmdhLmMKQEAgLTQ2Niw3ICs0NjYsNyBAQCBzdGF0aWMgaW50IHN0
ZHZnYV9tZW1fd3JpdGUoY29uc3Qgc3RydWN0IGh2bV9pb19oYW5kbGVyICpoYW5kbGVyLAogICAg
ICAgICAuZGlyID0gSU9SRVFfV1JJVEUsCiAgICAgICAgIC5kYXRhID0gZGF0YSwKICAgICB9Owot
ICAgIHN0cnVjdCBodm1faW9yZXFfc2VydmVyICpzcnY7CisgICAgaW9zZXJ2aWRfdCBpZDsKIAog
ICAgIGlmICggIXN0ZHZnYV9jYWNoZV9pc19lbmFibGVkKHMpIHx8ICFzLT5zdGR2Z2EgKQogICAg
ICAgICBnb3RvIGRvbmU7CkBAIC01MDcsMTEgKzUwNywxMSBAQCBzdGF0aWMgaW50IHN0ZHZnYV9t
ZW1fd3JpdGUoY29uc3Qgc3RydWN0IGh2bV9pb19oYW5kbGVyICpoYW5kbGVyLAogICAgIH0KIAog
IGRvbmU6Ci0gICAgc3J2ID0gaHZtX3NlbGVjdF9pb3JlcV9zZXJ2ZXIoY3VycmVudC0+ZG9tYWlu
LCAmcCk7Ci0gICAgaWYgKCAhc3J2ICkKKyAgICBpZCA9IGh2bV9zZWxlY3RfaW9yZXFfc2VydmVy
KGN1cnJlbnQtPmRvbWFpbiwgJnApOworICAgIGlmICggaWQgPT0gWEVOX0lOVkFMSURfSU9TRVJW
SUQgKQogICAgICAgICByZXR1cm4gWDg2RU1VTF9VTkhBTkRMRUFCTEU7CiAKLSAgICByZXR1cm4g
aHZtX3NlbmRfaW9yZXEoc3J2LCAmcCwgMSk7CisgICAgcmV0dXJuIGh2bV9zZW5kX2lvcmVxKGlk
LCAmcCwgMSk7CiB9CiAKIHN0YXRpYyBib29sX3Qgc3RkdmdhX21lbV9hY2NlcHQoY29uc3Qgc3Ry
dWN0IGh2bV9pb19oYW5kbGVyICpoYW5kbGVyLApkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L21t
L3AybS5jIGIveGVuL2FyY2gveDg2L21tL3AybS5jCmluZGV4IGU1ZTQzNDlkZWEuLmMwZWRiOWEz
MTkgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9tbS9wMm0uYworKysgYi94ZW4vYXJjaC94ODYv
bW0vcDJtLmMKQEAgLTEwMiw2ICsxMDIsNyBAQCBzdGF0aWMgaW50IHAybV9pbml0aWFsaXNlKHN0
cnVjdCBkb21haW4gKmQsIHN0cnVjdCBwMm1fZG9tYWluICpwMm0pCiAgICAgICAgIHAybV9wdF9p
bml0KHAybSk7CiAKICAgICBzcGluX2xvY2tfaW5pdCgmcDJtLT5pb3JlcS5sb2NrKTsKKyAgICBw
Mm0tPmlvcmVxLnNlcnZlciA9IFhFTl9JTlZBTElEX0lPU0VSVklEOwogCiAgICAgcmV0dXJuIHJl
dDsKIH0KQEAgLTM2MSw3ICszNjIsNyBAQCB2b2lkIHAybV9tZW1vcnlfdHlwZV9jaGFuZ2VkKHN0
cnVjdCBkb21haW4gKmQpCiAKIGludCBwMm1fc2V0X2lvcmVxX3NlcnZlcihzdHJ1Y3QgZG9tYWlu
ICpkLAogICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCBmbGFncywKLSAgICAg
ICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgaHZtX2lvcmVxX3NlcnZlciAqcykKKyAgICAgICAg
ICAgICAgICAgICAgICAgICBpb3NlcnZpZF90IGlkKQogewogICAgIHN0cnVjdCBwMm1fZG9tYWlu
ICpwMm0gPSBwMm1fZ2V0X2hvc3RwMm0oZCk7CiAgICAgaW50IHJjOwpAQCAtMzc2LDE2ICszNzcs
MTYgQEAgaW50IHAybV9zZXRfaW9yZXFfc2VydmVyKHN0cnVjdCBkb21haW4gKmQsCiAgICAgaWYg
KCBmbGFncyA9PSAwICkKICAgICB7CiAgICAgICAgIHJjID0gLUVJTlZBTDsKLSAgICAgICAgaWYg
KCBwMm0tPmlvcmVxLnNlcnZlciAhPSBzICkKKyAgICAgICAgaWYgKCBwMm0tPmlvcmVxLnNlcnZl
ciAhPSBpZCApCiAgICAgICAgICAgICBnb3RvIG91dDsKIAotICAgICAgICBwMm0tPmlvcmVxLnNl
cnZlciA9IE5VTEw7CisgICAgICAgIHAybS0+aW9yZXEuc2VydmVyID0gWEVOX0lOVkFMSURfSU9T
RVJWSUQ7CiAgICAgICAgIHAybS0+aW9yZXEuZmxhZ3MgPSAwOwogICAgIH0KICAgICBlbHNlCiAg
ICAgewogICAgICAgICByYyA9IC1FQlVTWTsKLSAgICAgICAgaWYgKCBwMm0tPmlvcmVxLnNlcnZl
ciAhPSBOVUxMICkKKyAgICAgICAgaWYgKCBwMm0tPmlvcmVxLnNlcnZlciAhPSBYRU5fSU5WQUxJ
RF9JT1NFUlZJRCApCiAgICAgICAgICAgICBnb3RvIG91dDsKIAogICAgICAgICAvKgpAQCAtMzk3
LDcgKzM5OCw3IEBAIGludCBwMm1fc2V0X2lvcmVxX3NlcnZlcihzdHJ1Y3QgZG9tYWluICpkLAog
ICAgICAgICBpZiAoIHJlYWRfYXRvbWljKCZwMm0tPmlvcmVxLmVudHJ5X2NvdW50KSApCiAgICAg
ICAgICAgICBnb3RvIG91dDsKIAotICAgICAgICBwMm0tPmlvcmVxLnNlcnZlciA9IHM7CisgICAg
ICAgIHAybS0+aW9yZXEuc2VydmVyID0gaWQ7CiAgICAgICAgIHAybS0+aW9yZXEuZmxhZ3MgPSBm
bGFnczsKICAgICB9CiAKQEAgLTQwOSwxOSArNDEwLDE4IEBAIGludCBwMm1fc2V0X2lvcmVxX3Nl
cnZlcihzdHJ1Y3QgZG9tYWluICpkLAogICAgIHJldHVybiByYzsKIH0KIAotc3RydWN0IGh2bV9p
b3JlcV9zZXJ2ZXIgKnAybV9nZXRfaW9yZXFfc2VydmVyKHN0cnVjdCBkb21haW4gKmQsCi0gICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50ICpm
bGFncykKK2lvc2VydmlkX3QgcDJtX2dldF9pb3JlcV9zZXJ2ZXIoc3RydWN0IGRvbWFpbiAqZCwg
dW5zaWduZWQgaW50ICpmbGFncykKIHsKICAgICBzdHJ1Y3QgcDJtX2RvbWFpbiAqcDJtID0gcDJt
X2dldF9ob3N0cDJtKGQpOwotICAgIHN0cnVjdCBodm1faW9yZXFfc2VydmVyICpzOworICAgIGlv
c2VydmlkX3QgaWQ7CiAKICAgICBzcGluX2xvY2soJnAybS0+aW9yZXEubG9jayk7CiAKLSAgICBz
ID0gcDJtLT5pb3JlcS5zZXJ2ZXI7CisgICAgaWQgPSBwMm0tPmlvcmVxLnNlcnZlcjsKICAgICAq
ZmxhZ3MgPSBwMm0tPmlvcmVxLmZsYWdzOwogCiAgICAgc3Bpbl91bmxvY2soJnAybS0+aW9yZXEu
bG9jayk7Ci0gICAgcmV0dXJuIHM7CisgICAgcmV0dXJuIGlkOwogfQogCiB2b2lkIHAybV9lbmFi
bGVfaGFyZHdhcmVfbG9nX2RpcnR5KHN0cnVjdCBkb21haW4gKmQpCmRpZmYgLS1naXQgYS94ZW4v
aW5jbHVkZS9hc20teDg2L2h2bS9pb3JlcS5oIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9odm0vaW9y
ZXEuaAppbmRleCBlMjU4OGU5MTJmLi42NTQ5MWM0OGQyIDEwMDY0NAotLS0gYS94ZW4vaW5jbHVk
ZS9hc20teDg2L2h2bS9pb3JlcS5oCisrKyBiL3hlbi9pbmNsdWRlL2FzbS14ODYvaHZtL2lvcmVx
LmgKQEAgLTQ3LDkgKzQ3LDggQEAgaW50IGh2bV9hbGxfaW9yZXFfc2VydmVyc19hZGRfdmNwdShz
dHJ1Y3QgZG9tYWluICpkLCBzdHJ1Y3QgdmNwdSAqdik7CiB2b2lkIGh2bV9hbGxfaW9yZXFfc2Vy
dmVyc19yZW1vdmVfdmNwdShzdHJ1Y3QgZG9tYWluICpkLCBzdHJ1Y3QgdmNwdSAqdik7CiB2b2lk
IGh2bV9kZXN0cm95X2FsbF9pb3JlcV9zZXJ2ZXJzKHN0cnVjdCBkb21haW4gKmQpOwogCi1zdHJ1
Y3QgaHZtX2lvcmVxX3NlcnZlciAqaHZtX3NlbGVjdF9pb3JlcV9zZXJ2ZXIoc3RydWN0IGRvbWFp
biAqZCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBp
b3JlcV90ICpwKTsKLWludCBodm1fc2VuZF9pb3JlcShzdHJ1Y3QgaHZtX2lvcmVxX3NlcnZlciAq
cywgaW9yZXFfdCAqcHJvdG9fcCwKK2lvc2VydmlkX3QgaHZtX3NlbGVjdF9pb3JlcV9zZXJ2ZXIo
c3RydWN0IGRvbWFpbiAqZCwgaW9yZXFfdCAqcCk7CitpbnQgaHZtX3NlbmRfaW9yZXEoaW9zZXJ2
aWRfdCBpZCwgaW9yZXFfdCAqcHJvdG9fcCwKICAgICAgICAgICAgICAgICAgICBib29sIGJ1ZmZl
cmVkKTsKIHVuc2lnbmVkIGludCBodm1fYnJvYWRjYXN0X2lvcmVxKGlvcmVxX3QgKnAsIGJvb2wg
YnVmZmVyZWQpOwogCmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS9hc20teDg2L3AybS5oIGIveGVu
L2luY2x1ZGUvYXNtLXg4Ni9wMm0uaAppbmRleCA5NDI4NWRiMWI0Li45OWExZGFiMzExIDEwMDY0
NAotLS0gYS94ZW4vaW5jbHVkZS9hc20teDg2L3AybS5oCisrKyBiL3hlbi9pbmNsdWRlL2FzbS14
ODYvcDJtLmgKQEAgLTM1NCw3ICszNTQsNyBAQCBzdHJ1Y3QgcDJtX2RvbWFpbiB7CiAgICAgICAg
ICAgKiBpb3JlcSBzZXJ2ZXIgd2hvJ3MgcmVzcG9uc2libGUgZm9yIHRoZSBlbXVsYXRpb24gb2YK
ICAgICAgICAgICAqIGdmbnMgd2l0aCBzcGVjaWZpYyBwMm0gdHlwZShmb3Igbm93LCBwMm1faW9y
ZXFfc2VydmVyKS4KICAgICAgICAgICAqLwotICAgICAgICAgc3RydWN0IGh2bV9pb3JlcV9zZXJ2
ZXIgKnNlcnZlcjsKKyAgICAgICAgIGlvc2VydmlkX3Qgc2VydmVyOwogICAgICAgICAgLyoKICAg
ICAgICAgICAqIGZsYWdzIHNwZWNpZmllcyB3aGV0aGVyIHJlYWQsIHdyaXRlIG9yIGJvdGggb3Bl
cmF0aW9ucwogICAgICAgICAgICogYXJlIHRvIGJlIGVtdWxhdGVkIGJ5IGFuIGlvcmVxIHNlcnZl
ci4KQEAgLTgxOSw3ICs4MTksNyBAQCBzdGF0aWMgaW5saW5lIHAybV90eXBlX3QgcDJtX3JlY2Fs
Y190eXBlX3JhbmdlKGJvb2wgcmVjYWxjLCBwMm1fdHlwZV90IHQsCiAgICAgaWYgKCAhcmVjYWxj
IHx8ICFwMm1faXNfY2hhbmdlYWJsZSh0KSApCiAgICAgICAgIHJldHVybiB0OwogCi0gICAgaWYg
KCB0ID09IHAybV9pb3JlcV9zZXJ2ZXIgJiYgcDJtLT5pb3JlcS5zZXJ2ZXIgIT0gTlVMTCApCisg
ICAgaWYgKCB0ID09IHAybV9pb3JlcV9zZXJ2ZXIgJiYgcDJtLT5pb3JlcS5zZXJ2ZXIgIT0gWEVO
X0lOVkFMSURfSU9TRVJWSUQgKQogICAgICAgICByZXR1cm4gdDsKIAogICAgIHJldHVybiBwMm1f
aXNfbG9nZGlydHlfcmFuZ2UocDJtLCBnZm5fc3RhcnQsIGdmbl9lbmQpID8gcDJtX3JhbV9sb2dk
aXJ0eQpAQCAtOTM4LDkgKzkzOCw4IEBAIHN0YXRpYyBpbmxpbmUgdW5zaWduZWQgaW50IHAybV9n
ZXRfaW9tbXVfZmxhZ3MocDJtX3R5cGVfdCBwMm10LCBtZm5fdCBtZm4pCiB9CiAKIGludCBwMm1f
c2V0X2lvcmVxX3NlcnZlcihzdHJ1Y3QgZG9tYWluICpkLCB1bnNpZ25lZCBpbnQgZmxhZ3MsCi0g
ICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGh2bV9pb3JlcV9zZXJ2ZXIgKnMpOwotc3Ry
dWN0IGh2bV9pb3JlcV9zZXJ2ZXIgKnAybV9nZXRfaW9yZXFfc2VydmVyKHN0cnVjdCBkb21haW4g
KmQsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWdu
ZWQgaW50ICpmbGFncyk7CisgICAgICAgICAgICAgICAgICAgICAgICAgaW9zZXJ2aWRfdCBpZCk7
Citpb3NlcnZpZF90IHAybV9nZXRfaW9yZXFfc2VydmVyKHN0cnVjdCBkb21haW4gKmQsIHVuc2ln
bmVkIGludCAqZmxhZ3MpOwogCiBzdGF0aWMgaW5saW5lIGludCBwMm1fZW50cnlfbW9kaWZ5KHN0
cnVjdCBwMm1fZG9tYWluICpwMm0sIHAybV90eXBlX3QgbnQsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHAybV90eXBlX3Qgb3QsIG1mbl90IG5mbiwgbWZuX3Qgb2ZuLApkaWZm
IC0tZ2l0IGEveGVuL2luY2x1ZGUvcHVibGljL2h2bS9kbV9vcC5oIGIveGVuL2luY2x1ZGUvcHVi
bGljL2h2bS9kbV9vcC5oCmluZGV4IGQzYjU1NGQwMTkuLmVlMzk2M2U1NGYgMTAwNjQ0Ci0tLSBh
L3hlbi9pbmNsdWRlL3B1YmxpYy9odm0vZG1fb3AuaAorKysgYi94ZW4vaW5jbHVkZS9wdWJsaWMv
aHZtL2RtX29wLmgKQEAgLTU0LDYgKzU0LDcgQEAKICAqLwogCiB0eXBlZGVmIHVpbnQxNl90IGlv
c2VydmlkX3Q7CisjZGVmaW5lIFhFTl9JTlZBTElEX0lPU0VSVklEICgoaW9zZXJ2aWRfdCl+MCkK
IAogLyoKICAqIFhFTl9ETU9QX2NyZWF0ZV9pb3JlcV9zZXJ2ZXI6IEluc3RhbnRpYXRlIGEgbmV3
IElPUkVRIFNlcnZlciBmb3IgYQotLSAKMi4yMy4wCgoKX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxA
bGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFu
L2xpc3RpbmZvL3hlbi1kZXZlbA==

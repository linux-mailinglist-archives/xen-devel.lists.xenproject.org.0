Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 38E2C1686FE
	for <lists+xen-devel@lfdr.de>; Fri, 21 Feb 2020 19:52:01 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1j5DMy-0006iz-U7; Fri, 21 Feb 2020 18:49:48 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=JJS4=4J=intel.com=tamas.lengyel@srs-us1.protection.inumbo.net>)
 id 1j5DMw-0006i1-Pk
 for xen-devel@lists.xenproject.org; Fri, 21 Feb 2020 18:49:46 +0000
X-Inumbo-ID: e972d922-54da-11ea-86d8-12813bfff9fa
Received: from mga12.intel.com (unknown [192.55.52.136])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id e972d922-54da-11ea-86d8-12813bfff9fa;
 Fri, 21 Feb 2020 18:49:38 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga004.fm.intel.com ([10.253.24.48])
 by fmsmga106.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 21 Feb 2020 10:49:37 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.70,469,1574150400"; d="scan'208";a="259709297"
Received: from btraw-mobl.amr.corp.intel.com (HELO localhost.localdomain)
 ([10.251.1.240])
 by fmsmga004.fm.intel.com with ESMTP; 21 Feb 2020 10:49:36 -0800
From: Tamas K Lengyel <tamas.lengyel@intel.com>
To: xen-devel@lists.xenproject.org
Date: Fri, 21 Feb 2020 10:49:23 -0800
Message-Id: <532a499f00b42299d8035b4ca9c6d7bfcbdc6e1f.1582310142.git.tamas.lengyel@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <cover.1582310142.git.tamas.lengyel@intel.com>
References: <cover.1582310142.git.tamas.lengyel@intel.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v9 5/5] xen/tools: VM forking toolstack side
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Anthony PERARD <anthony.perard@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>,
 Tamas K Lengyel <tamas.lengyel@intel.com>, Wei Liu <wl@xen.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

QWRkIG5lY2Vzc2FyeSBiaXRzIHRvIGltcGxlbWVudCAieGwgZm9yay12bSIgY29tbWFuZHMuIFRo
ZSBjb21tYW5kIGFsbG93cyB0aGUKdXNlciB0byBzcGVjaWZ5IGhvdyB0byBsYXVuY2ggdGhlIGRl
dmljZSBtb2RlbCBhbGxvd2luZyBmb3IgYSBsYXRlLWxhdW5jaCBtb2RlbAppbiB3aGljaCB0aGUg
dXNlciBjYW4gZXhlY3V0ZSB0aGUgZm9yayB3aXRob3V0IHRoZSBkZXZpY2UgbW9kZWwgYW5kIGRl
Y2lkZSB0bwpvbmx5IGxhdGVyIGxhdW5jaCBpdC4KClNpZ25lZC1vZmYtYnk6IFRhbWFzIEsgTGVu
Z3llbCA8dGFtYXMubGVuZ3llbEBpbnRlbC5jb20+Ci0tLQogZG9jcy9tYW4veGwuMS5wb2QuaW4g
ICAgICAgICAgfCAgMzYgKysrKysKIHRvb2xzL2xpYnhjL2luY2x1ZGUveGVuY3RybC5oIHwgIDEz
ICsrCiB0b29scy9saWJ4Yy94Y19tZW1zaHIuYyAgICAgICB8ICAyMiArKysKIHRvb2xzL2xpYnhs
L2xpYnhsLmggICAgICAgICAgIHwgICA3ICsKIHRvb2xzL2xpYnhsL2xpYnhsX2NyZWF0ZS5jICAg
IHwgMjU2ICsrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0KIHRvb2xzL2xpYnhsL2xp
YnhsX2RtLmMgICAgICAgIHwgICAyICstCiB0b29scy9saWJ4bC9saWJ4bF9kb20uYyAgICAgICB8
ICA0MyArKysrKy0KIHRvb2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmggIHwgICAxICsKIHRvb2xz
L2xpYnhsL2xpYnhsX3R5cGVzLmlkbCAgIHwgICAxICsKIHRvb2xzL3hsL3hsLmggICAgICAgICAg
ICAgICAgIHwgICA1ICsKIHRvb2xzL3hsL3hsX2NtZHRhYmxlLmMgICAgICAgIHwgIDEyICsrCiB0
b29scy94bC94bF9zYXZlcmVzdG9yZS5jICAgICB8ICA5NyArKysrKysrKysrKysrCiB0b29scy94
bC94bF92bWNvbnRyb2wuYyAgICAgICB8ICAgOCArKwogMTMgZmlsZXMgY2hhbmdlZCwgNDA5IGlu
c2VydGlvbnMoKyksIDk0IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RvY3MvbWFuL3hsLjEu
cG9kLmluIGIvZG9jcy9tYW4veGwuMS5wb2QuaW4KaW5kZXggMzNhZDJlYmQ3MS4uYzQwMTI5Mzlm
NSAxMDA2NDQKLS0tIGEvZG9jcy9tYW4veGwuMS5wb2QuaW4KKysrIGIvZG9jcy9tYW4veGwuMS5w
b2QuaW4KQEAgLTY5NCw2ICs2OTQsNDIgQEAgTGVhdmUgdGhlIGRvbWFpbiBwYXVzZWQgYWZ0ZXIg
Y3JlYXRpbmcgdGhlIHNuYXBzaG90LgogCiA9YmFjawogCis9aXRlbSBCPGZvcmstdm0+IFtJPE9Q
VElPTlM+XSBJPGRvbWFpbi1pZD4KKworQ3JlYXRlIGEgZm9yayBvZiBhIHJ1bm5pbmcgVk0uIFRo
ZSBkb21haW4gd2lsbCBiZSBwYXVzZWQgYWZ0ZXIgdGhlIG9wZXJhdGlvbgorYW5kIG5lZWRzIHRv
IHJlbWFpbiBwYXVzZWQgd2hpbGUgZm9ya3Mgb2YgaXQgZXhpc3QuCisKK0I8T1BUSU9OUz4KKwor
PW92ZXIgNAorCis9aXRlbSBCPC1wPgorCitMZWF2ZSB0aGUgZm9yayBwYXVzZWQgYWZ0ZXIgY3Jl
YXRpbmcgaXQuCisKKz1pdGVtIEI8LS1sYXVuY2gtZG0+CisKK1NwZWNpZnkgd2hldGhlciB0aGUg
ZGV2aWNlIG1vZGVsIChRRU1VKSBzaG91bGQgYmUgbGF1bmNoZWQgZm9yIHRoZSBmb3JrLiBMYXRl
CitsYXVuY2ggYWxsb3dzIHRvIHN0YXJ0IHRoZSBkZXZpY2UgbW9kZWwgZm9yIGFuIGFscmVhZHkg
cnVubmluZyBmb3JrLgorCis9aXRlbSBCPC1DPgorCitUaGUgY29uZmlnIGZpbGUgdG8gdXNlIHdo
ZW4gbGF1bmNoaW5nIHRoZSBkZXZpY2UgbW9kZWwuIEN1cnJlbnRseSByZXF1aXJlZCB3aGVuCits
YXVuY2hpbmcgdGhlIGRldmljZSBtb2RlbC4KKworPWl0ZW0gQjwtUT4KKworVGhlIHFlbXUgc2F2
ZSBmaWxlIHRvIHVzZSB3aGVuIGxhdW5jaGluZyB0aGUgZGV2aWNlIG1vZGVsLiAgQ3VycmVudGx5
IHJlcXVpcmVkCit3aGVuIGxhdW5jaGluZyB0aGUgZGV2aWNlIG1vZGVsLgorCis9aXRlbSBCPC0t
Zm9yay1yZXNldD4KKworUGVyZm9ybSBhIHJlc2V0IG9wZXJhdGlvbiBvZiBhbiBhbHJlYWR5IHJ1
bm5pbmcgZm9yay4gTm90ZSB0aGF0IHJlc2V0dGluZyBtYXkKK2JlIGxlc3MgcGVyZm9ybWFudCB0
aGVuIGNyZWF0aW5nIGEgbmV3IGZvcmsgZGVwZW5kaW5nIG9uIGhvdyBtdWNoIG1lbW9yeSB0aGUK
K2ZvcmsgaGFzIGRlZHVwbGljYXRlZCBkdXJpbmcgaXRzIHJ1bnRpbWUuCisKKz1iYWNrCisKID1p
dGVtIEI8c2hhcmluZz4gW0k8ZG9tYWluLWlkPl0KIAogRGlzcGxheSB0aGUgbnVtYmVyIG9mIHNo
YXJlZCBwYWdlcyBmb3IgYSBzcGVjaWZpZWQgZG9tYWluLiBJZiBubyBkb21haW4gaXMKZGlmZiAt
LWdpdCBhL3Rvb2xzL2xpYnhjL2luY2x1ZGUveGVuY3RybC5oIGIvdG9vbHMvbGlieGMvaW5jbHVk
ZS94ZW5jdHJsLmgKaW5kZXggOTk1NTJhNWY3My4uOTBmY2U4MzE5NiAxMDA2NDQKLS0tIGEvdG9v
bHMvbGlieGMvaW5jbHVkZS94ZW5jdHJsLmgKKysrIGIvdG9vbHMvbGlieGMvaW5jbHVkZS94ZW5j
dHJsLmgKQEAgLTIyMjUsNiArMjIyNSwxOSBAQCBpbnQgeGNfbWVtc2hyX3JhbmdlX3NoYXJlKHhj
X2ludGVyZmFjZSAqeGNoLAogICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50NjRfdCBmaXJz
dF9nZm4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQ2NF90IGxhc3RfZ2ZuKTsKIAor
aW50IHhjX21lbXNocl9mb3JrKHhjX2ludGVyZmFjZSAqeGNoLAorICAgICAgICAgICAgICAgICAg
IHVpbnQzMl90IHNvdXJjZV9kb21haW4sCisgICAgICAgICAgICAgICAgICAgdWludDMyX3QgY2xp
ZW50X2RvbWFpbik7CisKKy8qCisgKiBOb3RlOiB0aGlzIGZ1bmN0aW9uIGlzIG9ubHkgaW50ZW5k
ZWQgdG8gYmUgdXNlZCBvbiBzaG9ydC1saXZlZCBmb3JrcyB0aGF0CisgKiBoYXZlbid0IHlldCBh
cXVpcmVkIGEgbG90IG9mIG1lbW9yeS4gSW4gY2FzZSB0aGUgZm9yayBoYXMgYSBsb3Qgb2YgbWVt
b3J5CisgKiBpdCBpcyBsaWtlbHkgbW9yZSBwZXJmb3JtYW50IHRvIGNyZWF0ZSBhIG5ldyBmb3Jr
IHdpdGggeGNfbWVtc2hyX2ZvcmsuCisgKgorICogV2l0aCBWTXMgdGhhdCBoYXZlIGEgbG90IG9m
IG1lbW9yeSB0aGlzIGNhbGwgbWF5IGJsb2NrIGZvciBhIGxvbmcgdGltZS4KKyAqLworaW50IHhj
X21lbXNocl9mb3JrX3Jlc2V0KHhjX2ludGVyZmFjZSAqeGNoLCB1aW50MzJfdCBmb3JrZWRfZG9t
YWluKTsKKwogLyogRGVidWcgY2FsbHM6IHJldHVybiB0aGUgbnVtYmVyIG9mIHBhZ2VzIHJlZmVy
ZW5jaW5nIHRoZSBzaGFyZWQgZnJhbWUgYmFja2luZwogICogdGhlIGlucHV0IGFyZ3VtZW50LiBT
aG91bGQgYmUgb25lIG9yIGdyZWF0ZXIuCiAgKgpkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGMveGNf
bWVtc2hyLmMgYi90b29scy9saWJ4Yy94Y19tZW1zaHIuYwppbmRleCA5N2UyZTZhOGQ5Li5kMGU0
ZWUyMjViIDEwMDY0NAotLS0gYS90b29scy9saWJ4Yy94Y19tZW1zaHIuYworKysgYi90b29scy9s
aWJ4Yy94Y19tZW1zaHIuYwpAQCAtMjM5LDYgKzIzOSwyOCBAQCBpbnQgeGNfbWVtc2hyX2RlYnVn
X2dyZWYoeGNfaW50ZXJmYWNlICp4Y2gsCiAgICAgcmV0dXJuIHhjX21lbXNocl9tZW1vcCh4Y2gs
IGRvbWlkLCAmbXNvKTsKIH0KIAoraW50IHhjX21lbXNocl9mb3JrKHhjX2ludGVyZmFjZSAqeGNo
LCB1aW50MzJfdCBwZG9taWQsIHVpbnQzMl90IGRvbWlkKQoreworICAgIHhlbl9tZW1fc2hhcmlu
Z19vcF90IG1zbzsKKworICAgIG1lbXNldCgmbXNvLCAwLCBzaXplb2YobXNvKSk7CisKKyAgICBt
c28ub3AgPSBYRU5NRU1fc2hhcmluZ19vcF9mb3JrOworICAgIG1zby51LmZvcmsucGFyZW50X2Rv
bWFpbiA9IHBkb21pZDsKKworICAgIHJldHVybiB4Y19tZW1zaHJfbWVtb3AoeGNoLCBkb21pZCwg
Jm1zbyk7Cit9CisKK2ludCB4Y19tZW1zaHJfZm9ya19yZXNldCh4Y19pbnRlcmZhY2UgKnhjaCwg
dWludDMyX3QgZG9taWQpCit7CisgICAgeGVuX21lbV9zaGFyaW5nX29wX3QgbXNvOworCisgICAg
bWVtc2V0KCZtc28sIDAsIHNpemVvZihtc28pKTsKKyAgICBtc28ub3AgPSBYRU5NRU1fc2hhcmlu
Z19vcF9mb3JrX3Jlc2V0OworCisgICAgcmV0dXJuIHhjX21lbXNocl9tZW1vcCh4Y2gsIGRvbWlk
LCAmbXNvKTsKK30KKwogaW50IHhjX21lbXNocl9hdWRpdCh4Y19pbnRlcmZhY2UgKnhjaCkKIHsK
ICAgICB4ZW5fbWVtX3NoYXJpbmdfb3BfdCBtc287CmRpZmYgLS1naXQgYS90b29scy9saWJ4bC9s
aWJ4bC5oIGIvdG9vbHMvbGlieGwvbGlieGwuaAppbmRleCBmZGU4NTQ4ODQ3Li5kY2RhYmU4Zjgw
IDEwMDY0NAotLS0gYS90b29scy9saWJ4bC9saWJ4bC5oCisrKyBiL3Rvb2xzL2xpYnhsL2xpYnhs
LmgKQEAgLTE1MzgsNiArMTUzOCwxMyBAQCBpbnQgbGlieGxfZG9tYWluX2NyZWF0ZV9uZXcobGli
eGxfY3R4ICpjdHgsIGxpYnhsX2RvbWFpbl9jb25maWcgKmRfY29uZmlnLAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGNvbnN0IGxpYnhsX2FzeW5jb3BfaG93ICphb19ob3csCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGlieGxfYXN5bmNwcm9ncmVzc19ob3cgKmFvcF9j
b25zb2xlX2hvdykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMSUJYTF9FWFRFUk5BTF9D
QUxMRVJTX09OTFk7CitpbnQgbGlieGxfZG9tYWluX2Zvcmtfdm0obGlieGxfY3R4ICpjdHgsIHVp
bnQzMl90IHBkb21pZCwgdWludDMyX3QgKmRvbWlkKQorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBMSUJYTF9FWFRFUk5BTF9DQUxMRVJTX09OTFk7CitpbnQgbGlieGxfZG9tYWluX2Zvcmtf
bGF1bmNoX2RtKGxpYnhsX2N0eCAqY3R4LCBsaWJ4bF9kb21haW5fY29uZmlnICpkX2NvbmZpZywK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgZG9taWQsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxpYnhsX2FzeW5jcHJvZ3Jlc3NfaG93ICph
b3BfY29uc29sZV9ob3cpCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExJQlhMX0VY
VEVSTkFMX0NBTExFUlNfT05MWTsKK2ludCBsaWJ4bF9kb21haW5fZm9ya19yZXNldChsaWJ4bF9j
dHggKmN0eCwgdWludDMyX3QgZG9taWQpOwogaW50IGxpYnhsX2RvbWFpbl9jcmVhdGVfcmVzdG9y
ZShsaWJ4bF9jdHggKmN0eCwgbGlieGxfZG9tYWluX2NvbmZpZyAqZF9jb25maWcsCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90ICpkb21pZCwgaW50IHJlc3RvcmVfZmQs
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBzZW5kX2JhY2tfZmQsCmRpZmYg
LS1naXQgYS90b29scy9saWJ4bC9saWJ4bF9jcmVhdGUuYyBiL3Rvb2xzL2xpYnhsL2xpYnhsX2Ny
ZWF0ZS5jCmluZGV4IDNhNzM2NGUyYWMuLjliNGVkOTIwYjcgMTAwNjQ0Ci0tLSBhL3Rvb2xzL2xp
YnhsL2xpYnhsX2NyZWF0ZS5jCisrKyBiL3Rvb2xzL2xpYnhsL2xpYnhsX2NyZWF0ZS5jCkBAIC01
MzYsMTIgKzUzNiwxMiBAQCBvdXQ6CiAgICAgcmV0dXJuIHJldDsKIH0KIAotaW50IGxpYnhsX19k
b21haW5fbWFrZShsaWJ4bF9fZ2MgKmdjLCBsaWJ4bF9kb21haW5fY29uZmlnICpkX2NvbmZpZywK
LSAgICAgICAgICAgICAgICAgICAgICAgbGlieGxfX2RvbWFpbl9idWlsZF9zdGF0ZSAqc3RhdGUs
Ci0gICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90ICpkb21pZCwgYm9vbCBzb2Z0X3Jlc2V0
KQorc3RhdGljIGludCBsaWJ4bF9fZG9tYWluX21ha2VfeHNfZW50cmllcyhsaWJ4bF9fZ2MgKmdj
LCBsaWJ4bF9kb21haW5fY29uZmlnICpkX2NvbmZpZywKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgbGlieGxfX2RvbWFpbl9idWlsZF9zdGF0ZSAqc3RhdGUsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90IGRvbWlkKQogewog
ICAgIGxpYnhsX2N0eCAqY3R4ID0gbGlieGxfX2djX293bmVyKGdjKTsKLSAgICBpbnQgcmV0LCBy
YywgbmJfdm07CisgICAgaW50IHJjLCBuYl92bTsKICAgICBjb25zdCBjaGFyICpkb21fdHlwZTsK
ICAgICBjaGFyICp1dWlkX3N0cmluZzsKICAgICBjaGFyICpkb21fcGF0aCwgKnZtX3BhdGgsICps
aWJ4bF9wYXRoOwpAQCAtNTUzLDkgKzU1Myw2IEBAIGludCBsaWJ4bF9fZG9tYWluX21ha2UobGli
eGxfX2djICpnYywgbGlieGxfZG9tYWluX2NvbmZpZyAqZF9jb25maWcsCiAKICAgICAvKiBjb252
ZW5pZW5jZSBhbGlhc2VzICovCiAgICAgbGlieGxfZG9tYWluX2NyZWF0ZV9pbmZvICppbmZvID0g
JmRfY29uZmlnLT5jX2luZm87Ci0gICAgbGlieGxfZG9tYWluX2J1aWxkX2luZm8gKmJfaW5mbyA9
ICZkX2NvbmZpZy0+Yl9pbmZvOwotCi0gICAgYXNzZXJ0KHNvZnRfcmVzZXQgfHwgKmRvbWlkID09
IElOVkFMSURfRE9NSUQpOwogCiAgICAgdXVpZF9zdHJpbmcgPSBsaWJ4bF9fdXVpZDJzdHJpbmco
Z2MsIGluZm8tPnV1aWQpOwogICAgIGlmICghdXVpZF9zdHJpbmcpIHsKQEAgLTU2Myw3MSArNTYw
LDcgQEAgaW50IGxpYnhsX19kb21haW5fbWFrZShsaWJ4bF9fZ2MgKmdjLCBsaWJ4bF9kb21haW5f
Y29uZmlnICpkX2NvbmZpZywKICAgICAgICAgZ290byBvdXQ7CiAgICAgfQogCi0gICAgaWYgKCFz
b2Z0X3Jlc2V0KSB7Ci0gICAgICAgIHN0cnVjdCB4ZW5fZG9tY3RsX2NyZWF0ZWRvbWFpbiBjcmVh
dGUgPSB7Ci0gICAgICAgICAgICAuc3NpZHJlZiA9IGluZm8tPnNzaWRyZWYsCi0gICAgICAgICAg
ICAubWF4X3ZjcHVzID0gYl9pbmZvLT5tYXhfdmNwdXMsCi0gICAgICAgICAgICAubWF4X2V2dGNo
bl9wb3J0ID0gYl9pbmZvLT5ldmVudF9jaGFubmVscywKLSAgICAgICAgICAgIC5tYXhfZ3JhbnRf
ZnJhbWVzID0gYl9pbmZvLT5tYXhfZ3JhbnRfZnJhbWVzLAotICAgICAgICAgICAgLm1heF9tYXB0
cmFja19mcmFtZXMgPSBiX2luZm8tPm1heF9tYXB0cmFja19mcmFtZXMsCi0gICAgICAgIH07Ci0K
LSAgICAgICAgaWYgKGluZm8tPnR5cGUgIT0gTElCWExfRE9NQUlOX1RZUEVfUFYpIHsKLSAgICAg
ICAgICAgIGNyZWF0ZS5mbGFncyB8PSBYRU5fRE9NQ1RMX0NERl9odm07Ci0gICAgICAgICAgICBj
cmVhdGUuZmxhZ3MgfD0KLSAgICAgICAgICAgICAgICBsaWJ4bF9kZWZib29sX3ZhbChpbmZvLT5o
YXApID8gWEVOX0RPTUNUTF9DREZfaGFwIDogMDsKLSAgICAgICAgICAgIGNyZWF0ZS5mbGFncyB8
PQotICAgICAgICAgICAgICAgIGxpYnhsX2RlZmJvb2xfdmFsKGluZm8tPm9vcykgPyAwIDogWEVO
X0RPTUNUTF9DREZfb29zX29mZjsKLSAgICAgICAgfQotCi0gICAgICAgIGFzc2VydChpbmZvLT5w
YXNzdGhyb3VnaCAhPSBMSUJYTF9QQVNTVEhST1VHSF9ERUZBVUxUKTsKLSAgICAgICAgTE9HKERF
VEFJTCwgInBhc3N0aHJvdWdoOiAlcyIsCi0gICAgICAgICAgICBsaWJ4bF9wYXNzdGhyb3VnaF90
b19zdHJpbmcoaW5mby0+cGFzc3Rocm91Z2gpKTsKLQotICAgICAgICBpZiAoaW5mby0+cGFzc3Ro
cm91Z2ggIT0gTElCWExfUEFTU1RIUk9VR0hfRElTQUJMRUQpCi0gICAgICAgICAgICBjcmVhdGUu
ZmxhZ3MgfD0gWEVOX0RPTUNUTF9DREZfaW9tbXU7Ci0KLSAgICAgICAgaWYgKGluZm8tPnBhc3N0
aHJvdWdoID09IExJQlhMX1BBU1NUSFJPVUdIX1NZTkNfUFQpCi0gICAgICAgICAgICBjcmVhdGUu
aW9tbXVfb3B0cyB8PSBYRU5fRE9NQ1RMX0lPTU1VX25vX3NoYXJlcHQ7Ci0KLSAgICAgICAgLyog
VWx0aW1hdGVseSwgaGFuZGxlIGlzIGFuIGFycmF5IG9mIDE2IHVpbnQ4X3QsIHNhbWUgYXMgdXVp
ZCAqLwotICAgICAgICBsaWJ4bF91dWlkX2NvcHkoY3R4LCAobGlieGxfdXVpZCAqKSZjcmVhdGUu
aGFuZGxlLCAmaW5mby0+dXVpZCk7Ci0KLSAgICAgICAgcmV0ID0gbGlieGxfX2FyY2hfZG9tYWlu
X3ByZXBhcmVfY29uZmlnKGdjLCBkX2NvbmZpZywgJmNyZWF0ZSk7Ci0gICAgICAgIGlmIChyZXQg
PCAwKSB7Ci0gICAgICAgICAgICBMT0dFRChFUlJPUiwgKmRvbWlkLCAiZmFpbCB0byBnZXQgZG9t
YWluIGNvbmZpZyIpOwotICAgICAgICAgICAgcmMgPSBFUlJPUl9GQUlMOwotICAgICAgICAgICAg
Z290byBvdXQ7Ci0gICAgICAgIH0KLQotICAgICAgICByZXQgPSB4Y19kb21haW5fY3JlYXRlKGN0
eC0+eGNoLCBkb21pZCwgJmNyZWF0ZSk7Ci0gICAgICAgIGlmIChyZXQgPCAwKSB7Ci0gICAgICAg
ICAgICBMT0dFRChFUlJPUiwgKmRvbWlkLCAiZG9tYWluIGNyZWF0aW9uIGZhaWwiKTsKLSAgICAg
ICAgICAgIHJjID0gRVJST1JfRkFJTDsKLSAgICAgICAgICAgIGdvdG8gb3V0OwotICAgICAgICB9
Ci0KLSAgICAgICAgcmMgPSBsaWJ4bF9fYXJjaF9kb21haW5fc2F2ZV9jb25maWcoZ2MsIGRfY29u
ZmlnLCBzdGF0ZSwgJmNyZWF0ZSk7Ci0gICAgICAgIGlmIChyYyA8IDApCi0gICAgICAgICAgICBn
b3RvIG91dDsKLSAgICB9Ci0KLSAgICAvKgotICAgICAqIElmIHNvZnRfcmVzZXQgaXMgc2V0IHRo
ZSB0aGUgZG9taWQgd2lsbCBoYXZlIGJlZW4gdmFsaWQgb24gZW50cnkuCi0gICAgICogSWYgaXQg
d2FzIG5vdCBzZXQgdGhlbiB4Y19kb21haW5fY3JlYXRlKCkgc2hvdWxkIGhhdmUgYXNzaWduZWQg
YQotICAgICAqIHZhbGlkIHZhbHVlLiBFaXRoZXIgd2F5LCBpZiB3ZSByZWFjaCB0aGlzIHBvaW50
LCBkb21pZCBzaG91bGQgYmUKLSAgICAgKiB2YWxpZC4KLSAgICAgKi8KLSAgICBhc3NlcnQobGli
eGxfZG9taWRfdmFsaWRfZ3Vlc3QoKmRvbWlkKSk7Ci0KLSAgICByZXQgPSB4Y19jcHVwb29sX21v
dmVkb21haW4oY3R4LT54Y2gsIGluZm8tPnBvb2xpZCwgKmRvbWlkKTsKLSAgICBpZiAocmV0IDwg
MCkgewotICAgICAgICBMT0dFRChFUlJPUiwgKmRvbWlkLCAiZG9tYWluIG1vdmUgZmFpbCIpOwot
ICAgICAgICByYyA9IEVSUk9SX0ZBSUw7Ci0gICAgICAgIGdvdG8gb3V0OwotICAgIH0KLQotICAg
IGRvbV9wYXRoID0gbGlieGxfX3hzX2dldF9kb21wYXRoKGdjLCAqZG9taWQpOworICAgIGRvbV9w
YXRoID0gbGlieGxfX3hzX2dldF9kb21wYXRoKGdjLCBkb21pZCk7CiAgICAgaWYgKCFkb21fcGF0
aCkgewogICAgICAgICByYyA9IEVSUk9SX0ZBSUw7CiAgICAgICAgIGdvdG8gb3V0OwpAQCAtNjM1
LDEyICs1NjgsMTIgQEAgaW50IGxpYnhsX19kb21haW5fbWFrZShsaWJ4bF9fZ2MgKmdjLCBsaWJ4
bF9kb21haW5fY29uZmlnICpkX2NvbmZpZywKIAogICAgIHZtX3BhdGggPSBHQ1NQUklOVEYoIi92
bS8lcyIsIHV1aWRfc3RyaW5nKTsKICAgICBpZiAoIXZtX3BhdGgpIHsKLSAgICAgICAgTE9HRChF
UlJPUiwgKmRvbWlkLCAiY2Fubm90IGFsbG9jYXRlIGNyZWF0ZSBwYXRocyIpOworICAgICAgICBM
T0dEKEVSUk9SLCBkb21pZCwgImNhbm5vdCBhbGxvY2F0ZSBjcmVhdGUgcGF0aHMiKTsKICAgICAg
ICAgcmMgPSBFUlJPUl9GQUlMOwogICAgICAgICBnb3RvIG91dDsKICAgICB9CiAKLSAgICBsaWJ4
bF9wYXRoID0gbGlieGxfX3hzX2xpYnhsX3BhdGgoZ2MsICpkb21pZCk7CisgICAgbGlieGxfcGF0
aCA9IGxpYnhsX194c19saWJ4bF9wYXRoKGdjLCBkb21pZCk7CiAgICAgaWYgKCFsaWJ4bF9wYXRo
KSB7CiAgICAgICAgIHJjID0gRVJST1JfRkFJTDsKICAgICAgICAgZ290byBvdXQ7CkBAIC02NTEs
MTAgKzU4NCwxMCBAQCBpbnQgbGlieGxfX2RvbWFpbl9tYWtlKGxpYnhsX19nYyAqZ2MsIGxpYnhs
X2RvbWFpbl9jb25maWcgKmRfY29uZmlnLAogCiAgICAgcm9wZXJtWzBdLmlkID0gMDsKICAgICBy
b3Blcm1bMF0ucGVybXMgPSBYU19QRVJNX05PTkU7Ci0gICAgcm9wZXJtWzFdLmlkID0gKmRvbWlk
OworICAgIHJvcGVybVsxXS5pZCA9IGRvbWlkOwogICAgIHJvcGVybVsxXS5wZXJtcyA9IFhTX1BF
Uk1fUkVBRDsKIAotICAgIHJ3cGVybVswXS5pZCA9ICpkb21pZDsKKyAgICByd3Blcm1bMF0uaWQg
PSBkb21pZDsKICAgICByd3Blcm1bMF0ucGVybXMgPSBYU19QRVJNX05PTkU7CiAKIHJldHJ5X3Ry
YW5zYWN0aW9uOgpAQCAtNjcyLDcgKzYwNSw3IEBAIHJldHJ5X3RyYW5zYWN0aW9uOgogICAgICAg
ICAgICAgICAgICAgICBub3Blcm0sIEFSUkFZX1NJWkUobm9wZXJtKSk7CiAKICAgICB4c193cml0
ZShjdHgtPnhzaCwgdCwgR0NTUFJJTlRGKCIlcy92bSIsIGRvbV9wYXRoKSwgdm1fcGF0aCwgc3Ry
bGVuKHZtX3BhdGgpKTsKLSAgICByYyA9IGxpYnhsX19kb21haW5fcmVuYW1lKGdjLCAqZG9taWQs
IDAsIGluZm8tPm5hbWUsIHQpOworICAgIHJjID0gbGlieGxfX2RvbWFpbl9yZW5hbWUoZ2MsIGRv
bWlkLCAwLCBpbmZvLT5uYW1lLCB0KTsKICAgICBpZiAocmMpCiAgICAgICAgIGdvdG8gb3V0Owog
CkBAIC03NDksNyArNjgyLDcgQEAgcmV0cnlfdHJhbnNhY3Rpb246CiAKICAgICB2bV9saXN0ID0g
bGlieGxfbGlzdF92bShjdHgsICZuYl92bSk7CiAgICAgaWYgKCF2bV9saXN0KSB7Ci0gICAgICAg
IExPR0QoRVJST1IsICpkb21pZCwgImNhbm5vdCBnZXQgbnVtYmVyIG9mIHJ1bm5pbmcgZ3Vlc3Rz
Iik7CisgICAgICAgIExPR0QoRVJST1IsIGRvbWlkLCAiY2Fubm90IGdldCBudW1iZXIgb2YgcnVu
bmluZyBndWVzdHMiKTsKICAgICAgICAgcmMgPSBFUlJPUl9GQUlMOwogICAgICAgICBnb3RvIG91
dDsKICAgICB9CkBAIC03NzMsNyArNzA2LDcgQEAgcmV0cnlfdHJhbnNhY3Rpb246CiAgICAgICAg
ICAgICB0ID0gMDsKICAgICAgICAgICAgIGdvdG8gcmV0cnlfdHJhbnNhY3Rpb247CiAgICAgICAg
IH0KLSAgICAgICAgTE9HRUQoRVJST1IsICpkb21pZCwgImRvbWFpbiBjcmVhdGlvbiAiInhlbnN0
b3JlIHRyYW5zYWN0aW9uIGNvbW1pdCBmYWlsZWQiKTsKKyAgICAgICAgTE9HRUQoRVJST1IsIGRv
bWlkLCAiZG9tYWluIGNyZWF0aW9uICIieGVuc3RvcmUgdHJhbnNhY3Rpb24gY29tbWl0IGZhaWxl
ZCIpOwogICAgICAgICByYyA9IEVSUk9SX0ZBSUw7CiAgICAgICAgIGdvdG8gb3V0OwogICAgIH0K
QEAgLTc4NSw2ICs3MTgsODkgQEAgcmV0cnlfdHJhbnNhY3Rpb246CiAgICAgcmV0dXJuIHJjOwog
fQogCitpbnQgbGlieGxfX2RvbWFpbl9tYWtlKGxpYnhsX19nYyAqZ2MsIGxpYnhsX2RvbWFpbl9j
b25maWcgKmRfY29uZmlnLAorICAgICAgICAgICAgICAgICAgICAgICBsaWJ4bF9fZG9tYWluX2J1
aWxkX3N0YXRlICpzdGF0ZSwKKyAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgKmRvbWlk
LCBib29sIHNvZnRfcmVzZXQpCit7CisgICAgbGlieGxfY3R4ICpjdHggPSBsaWJ4bF9fZ2Nfb3du
ZXIoZ2MpOworICAgIGludCByZXQsIHJjOworCisgICAgLyogY29udmVuaWVuY2UgYWxpYXNlcyAq
LworICAgIGxpYnhsX2RvbWFpbl9jcmVhdGVfaW5mbyAqaW5mbyA9ICZkX2NvbmZpZy0+Y19pbmZv
OworICAgIGxpYnhsX2RvbWFpbl9idWlsZF9pbmZvICpiX2luZm8gPSAmZF9jb25maWctPmJfaW5m
bzsKKworICAgIGFzc2VydChzb2Z0X3Jlc2V0IHx8ICpkb21pZCA9PSBJTlZBTElEX0RPTUlEKTsK
KworICAgIGlmICghc29mdF9yZXNldCkgeworICAgICAgICBzdHJ1Y3QgeGVuX2RvbWN0bF9jcmVh
dGVkb21haW4gY3JlYXRlID0geworICAgICAgICAgICAgLnNzaWRyZWYgPSBpbmZvLT5zc2lkcmVm
LAorICAgICAgICAgICAgLm1heF92Y3B1cyA9IGJfaW5mby0+bWF4X3ZjcHVzLAorICAgICAgICAg
ICAgLm1heF9ldnRjaG5fcG9ydCA9IGJfaW5mby0+ZXZlbnRfY2hhbm5lbHMsCisgICAgICAgICAg
ICAubWF4X2dyYW50X2ZyYW1lcyA9IGJfaW5mby0+bWF4X2dyYW50X2ZyYW1lcywKKyAgICAgICAg
ICAgIC5tYXhfbWFwdHJhY2tfZnJhbWVzID0gYl9pbmZvLT5tYXhfbWFwdHJhY2tfZnJhbWVzLAor
ICAgICAgICB9OworCisgICAgICAgIGlmIChpbmZvLT50eXBlICE9IExJQlhMX0RPTUFJTl9UWVBF
X1BWKSB7CisgICAgICAgICAgICBjcmVhdGUuZmxhZ3MgfD0gWEVOX0RPTUNUTF9DREZfaHZtOwor
ICAgICAgICAgICAgY3JlYXRlLmZsYWdzIHw9CisgICAgICAgICAgICAgICAgbGlieGxfZGVmYm9v
bF92YWwoaW5mby0+aGFwKSA/IFhFTl9ET01DVExfQ0RGX2hhcCA6IDA7CisgICAgICAgICAgICBj
cmVhdGUuZmxhZ3MgfD0KKyAgICAgICAgICAgICAgICBsaWJ4bF9kZWZib29sX3ZhbChpbmZvLT5v
b3MpID8gMCA6IFhFTl9ET01DVExfQ0RGX29vc19vZmY7CisgICAgICAgIH0KKworICAgICAgICBh
c3NlcnQoaW5mby0+cGFzc3Rocm91Z2ggIT0gTElCWExfUEFTU1RIUk9VR0hfREVGQVVMVCk7Cisg
ICAgICAgIExPRyhERVRBSUwsICJwYXNzdGhyb3VnaDogJXMiLAorICAgICAgICAgICAgbGlieGxf
cGFzc3Rocm91Z2hfdG9fc3RyaW5nKGluZm8tPnBhc3N0aHJvdWdoKSk7CisKKyAgICAgICAgaWYg
KGluZm8tPnBhc3N0aHJvdWdoICE9IExJQlhMX1BBU1NUSFJPVUdIX0RJU0FCTEVEKQorICAgICAg
ICAgICAgY3JlYXRlLmZsYWdzIHw9IFhFTl9ET01DVExfQ0RGX2lvbW11OworCisgICAgICAgIGlm
IChpbmZvLT5wYXNzdGhyb3VnaCA9PSBMSUJYTF9QQVNTVEhST1VHSF9TWU5DX1BUKQorICAgICAg
ICAgICAgY3JlYXRlLmlvbW11X29wdHMgfD0gWEVOX0RPTUNUTF9JT01NVV9ub19zaGFyZXB0Owor
CisgICAgICAgIC8qIFVsdGltYXRlbHksIGhhbmRsZSBpcyBhbiBhcnJheSBvZiAxNiB1aW50OF90
LCBzYW1lIGFzIHV1aWQgKi8KKyAgICAgICAgbGlieGxfdXVpZF9jb3B5KGN0eCwgKGxpYnhsX3V1
aWQgKikmY3JlYXRlLmhhbmRsZSwgJmluZm8tPnV1aWQpOworCisgICAgICAgIHJldCA9IGxpYnhs
X19hcmNoX2RvbWFpbl9wcmVwYXJlX2NvbmZpZyhnYywgZF9jb25maWcsICZjcmVhdGUpOworICAg
ICAgICBpZiAocmV0IDwgMCkgeworICAgICAgICAgICAgTE9HRUQoRVJST1IsICpkb21pZCwgImZh
aWwgdG8gZ2V0IGRvbWFpbiBjb25maWciKTsKKyAgICAgICAgICAgIHJjID0gRVJST1JfRkFJTDsK
KyAgICAgICAgICAgIGdvdG8gb3V0OworICAgICAgICB9CisKKyAgICAgICAgcmV0ID0geGNfZG9t
YWluX2NyZWF0ZShjdHgtPnhjaCwgZG9taWQsICZjcmVhdGUpOworICAgICAgICBpZiAocmV0IDwg
MCkgeworICAgICAgICAgICAgTE9HRUQoRVJST1IsICpkb21pZCwgImRvbWFpbiBjcmVhdGlvbiBm
YWlsIik7CisgICAgICAgICAgICByYyA9IEVSUk9SX0ZBSUw7CisgICAgICAgICAgICBnb3RvIG91
dDsKKyAgICAgICAgfQorCisgICAgICAgIHJjID0gbGlieGxfX2FyY2hfZG9tYWluX3NhdmVfY29u
ZmlnKGdjLCBkX2NvbmZpZywgc3RhdGUsICZjcmVhdGUpOworICAgICAgICBpZiAocmMgPCAwKQor
ICAgICAgICAgICAgZ290byBvdXQ7CisgICAgfQorCisgICAgLyoKKyAgICAgKiBJZiBzb2Z0X3Jl
c2V0IGlzIHNldCB0aGUgdGhlIGRvbWlkIHdpbGwgaGF2ZSBiZWVuIHZhbGlkIG9uIGVudHJ5Lgor
ICAgICAqIElmIGl0IHdhcyBub3Qgc2V0IHRoZW4geGNfZG9tYWluX2NyZWF0ZSgpIHNob3VsZCBo
YXZlIGFzc2lnbmVkIGEKKyAgICAgKiB2YWxpZCB2YWx1ZS4gRWl0aGVyIHdheSwgaWYgd2UgcmVh
Y2ggdGhpcyBwb2ludCwgZG9taWQgc2hvdWxkIGJlCisgICAgICogdmFsaWQuCisgICAgICovCisg
ICAgYXNzZXJ0KGxpYnhsX2RvbWlkX3ZhbGlkX2d1ZXN0KCpkb21pZCkpOworCisgICAgcmV0ID0g
eGNfY3B1cG9vbF9tb3ZlZG9tYWluKGN0eC0+eGNoLCBpbmZvLT5wb29saWQsICpkb21pZCk7Cisg
ICAgaWYgKHJldCA8IDApIHsKKyAgICAgICAgTE9HRUQoRVJST1IsICpkb21pZCwgImRvbWFpbiBt
b3ZlIGZhaWwiKTsKKyAgICAgICAgcmMgPSBFUlJPUl9GQUlMOworICAgICAgICBnb3RvIG91dDsK
KyAgICB9CisKKyAgICByYyA9IGxpYnhsX19kb21haW5fbWFrZV94c19lbnRyaWVzKGdjLCBkX2Nv
bmZpZywgc3RhdGUsICpkb21pZCk7CisKK291dDoKKyAgICByZXR1cm4gcmM7Cit9CisKIHN0YXRp
YyBpbnQgc3RvcmVfbGlieGxfZW50cnkobGlieGxfX2djICpnYywgdWludDMyX3QgZG9taWQsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnhsX2RvbWFpbl9idWlsZF9pbmZvICpiX2lu
Zm8pCiB7CkBAIC0xMTA2LDE2ICsxMTIyLDMyIEBAIHN0YXRpYyB2b2lkIGluaXRpYXRlX2RvbWFp
bl9jcmVhdGUobGlieGxfX2VnYyAqZWdjLAogICAgIHJldCA9IGxpYnhsX19kb21haW5fY29uZmln
X3NldGRlZmF1bHQoZ2MsZF9jb25maWcsZG9taWQpOwogICAgIGlmIChyZXQpIGdvdG8gZXJyb3Jf
b3V0OwogCi0gICAgcmV0ID0gbGlieGxfX2RvbWFpbl9tYWtlKGdjLCBkX2NvbmZpZywgJmRjcy0+
YnVpbGRfc3RhdGUsICZkb21pZCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGNzLT5z
b2Z0X3Jlc2V0KTsKLSAgICBpZiAocmV0KSB7Ci0gICAgICAgIExPR0QoRVJST1IsIGRvbWlkLCAi
Y2Fubm90IG1ha2UgZG9tYWluOiAlZCIsIHJldCk7CisgICAgaWYgKCAhZF9jb25maWctPmRtX3Jl
c3RvcmVfZmlsZSApCisgICAgeworICAgICAgICByZXQgPSBsaWJ4bF9fZG9tYWluX21ha2UoZ2Ms
IGRfY29uZmlnLCAmZGNzLT5idWlsZF9zdGF0ZSwgJmRvbWlkLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgZGNzLT5zb2Z0X3Jlc2V0KTsKICAgICAgICAgZGNzLT5ndWVzdF9kb21p
ZCA9IGRvbWlkOworCisgICAgICAgIGlmIChyZXQpIHsKKyAgICAgICAgICAgIExPR0QoRVJST1Is
IGRvbWlkLCAiY2Fubm90IG1ha2UgZG9tYWluOiAlZCIsIHJldCk7CisgICAgICAgICAgICByZXQg
PSBFUlJPUl9GQUlMOworICAgICAgICAgICAgZ290byBlcnJvcl9vdXQ7CisgICAgICAgIH0KKyAg
ICB9IGVsc2UgaWYgKCBkY3MtPmd1ZXN0X2RvbWlkICE9IElOVkFMSURfRE9NSUQgKSB7CisgICAg
ICAgIGRvbWlkID0gZGNzLT5ndWVzdF9kb21pZDsKKworICAgICAgICByZXQgPSBsaWJ4bF9fZG9t
YWluX21ha2VfeHNfZW50cmllcyhnYywgZF9jb25maWcsICZkY3MtPmJ1aWxkX3N0YXRlLCBkb21p
ZCk7CisgICAgICAgIGlmIChyZXQpIHsKKyAgICAgICAgICAgIExPR0QoRVJST1IsIGRvbWlkLCAi
Y2Fubm90IG1ha2UgZG9tYWluOiAlZCIsIHJldCk7CisgICAgICAgICAgICByZXQgPSBFUlJPUl9G
QUlMOworICAgICAgICAgICAgZ290byBlcnJvcl9vdXQ7CisgICAgICAgIH0KKyAgICB9IGVsc2Ug
eworICAgICAgICBMT0dEKEVSUk9SLCBkb21pZCwgImNhbm5vdCBtYWtlIGRvbWFpbiIpOwogICAg
ICAgICByZXQgPSBFUlJPUl9GQUlMOwogICAgICAgICBnb3RvIGVycm9yX291dDsKICAgICB9CiAK
LSAgICBkY3MtPmd1ZXN0X2RvbWlkID0gZG9taWQ7CiAgICAgZGNzLT5zZHNzLmRtLmd1ZXN0X2Rv
bWlkID0gMDsgLyogbWVhbnMgd2UgaGF2ZW4ndCBzcGF3bmVkICovCiAKICAgICAvKiBwb3N0LTQu
MTMgdG9kbzogbW92ZSB0aGVzZSBuZXh0IGJpdHMgb2YgZGVmYXVsdGluZyB0bwpAQCAtMTE1MSw3
ICsxMTgzLDcgQEAgc3RhdGljIHZvaWQgaW5pdGlhdGVfZG9tYWluX2NyZWF0ZShsaWJ4bF9fZWdj
ICplZ2MsCiAgICAgaWYgKHJldCkKICAgICAgICAgZ290byBlcnJvcl9vdXQ7CiAKLSAgICBpZiAo
cmVzdG9yZV9mZCA+PSAwIHx8IGRjcy0+c29mdF9yZXNldCkgeworICAgIGlmIChyZXN0b3JlX2Zk
ID49IDAgfHwgZGNzLT5zb2Z0X3Jlc2V0IHx8IGRfY29uZmlnLT5kbV9yZXN0b3JlX2ZpbGUpIHsK
ICAgICAgICAgTE9HRChERUJVRywgZG9taWQsICJyZXN0b3JpbmcsIG5vdCBydW5uaW5nIGJvb3Rs
b2FkZXIiKTsKICAgICAgICAgZG9tY3JlYXRlX2Jvb3Rsb2FkZXJfZG9uZShlZ2MsICZkY3MtPmJs
LCAwKTsKICAgICB9IGVsc2UgIHsKQEAgLTEyMjcsNyArMTI1OSwxNiBAQCBzdGF0aWMgdm9pZCBk
b21jcmVhdGVfYm9vdGxvYWRlcl9kb25lKGxpYnhsX19lZ2MgKmVnYywKICAgICBkY3MtPnNkc3Mu
ZG0uY2FsbGJhY2sgPSBkb21jcmVhdGVfZGV2bW9kZWxfc3RhcnRlZDsKICAgICBkY3MtPnNkc3Mu
Y2FsbGJhY2sgPSBkb21jcmVhdGVfZGV2bW9kZWxfc3RhcnRlZDsKIAotICAgIGlmIChyZXN0b3Jl
X2ZkIDwgMCAmJiAhZGNzLT5zb2Z0X3Jlc2V0KSB7CisgICAgaWYgKHJlc3RvcmVfZmQgPCAwICYm
ICFkY3MtPnNvZnRfcmVzZXQgJiYgIWRfY29uZmlnLT5kbV9yZXN0b3JlX2ZpbGUpIHsKKyAgICAg
ICAgcmMgPSBsaWJ4bF9fZG9tYWluX2J1aWxkKGdjLCBkX2NvbmZpZywgZG9taWQsIHN0YXRlKTsK
KyAgICAgICAgZG9tY3JlYXRlX3JlYnVpbGRfZG9uZShlZ2MsIGRjcywgcmMpOworICAgICAgICBy
ZXR1cm47CisgICAgfQorCisgICAgaWYgKCBkX2NvbmZpZy0+ZG1fcmVzdG9yZV9maWxlICkgewor
ICAgICAgICBkY3MtPnNycy5kY3MgPSBkY3M7CisgICAgICAgIGRjcy0+c3JzLmFvID0gYW87Cisg
ICAgICAgIHN0YXRlLT5mb3JrZWRfdm0gPSB0cnVlOwogICAgICAgICByYyA9IGxpYnhsX19kb21h
aW5fYnVpbGQoZ2MsIGRfY29uZmlnLCBkb21pZCwgc3RhdGUpOwogICAgICAgICBkb21jcmVhdGVf
cmVidWlsZF9kb25lKGVnYywgZGNzLCByYyk7CiAgICAgICAgIHJldHVybjsKQEAgLTE0MjUsNiAr
MTQ2Niw3IEBAIHN0YXRpYyB2b2lkIGRvbWNyZWF0ZV9yZWJ1aWxkX2RvbmUobGlieGxfX2VnYyAq
ZWdjLAogICAgIC8qIGNvbnZlbmllbmNlIGFsaWFzZXMgKi8KICAgICBjb25zdCB1aW50MzJfdCBk
b21pZCA9IGRjcy0+Z3Vlc3RfZG9taWQ7CiAgICAgbGlieGxfZG9tYWluX2NvbmZpZyAqY29uc3Qg
ZF9jb25maWcgPSBkY3MtPmd1ZXN0X2NvbmZpZzsKKyAgICBsaWJ4bF9fZG9tYWluX2J1aWxkX3N0
YXRlICpjb25zdCBzdGF0ZSA9ICZkY3MtPmJ1aWxkX3N0YXRlOwogCiAgICAgaWYgKHJldCkgewog
ICAgICAgICBMT0dEKEVSUk9SLCBkb21pZCwgImNhbm5vdCAocmUtKWJ1aWxkIGRvbWFpbjogJWQi
LCByZXQpOwpAQCAtMTQzMiw2ICsxNDc0LDkgQEAgc3RhdGljIHZvaWQgZG9tY3JlYXRlX3JlYnVp
bGRfZG9uZShsaWJ4bF9fZWdjICplZ2MsCiAgICAgICAgIGdvdG8gZXJyb3Jfb3V0OwogICAgIH0K
IAorICAgIGlmICggZF9jb25maWctPmRtX3Jlc3RvcmVfZmlsZSApCisgICAgICAgIHN0YXRlLT5z
YXZlZF9zdGF0ZSA9IEdDU1BSSU5URigiJXMiLCBkX2NvbmZpZy0+ZG1fcmVzdG9yZV9maWxlKTsK
KwogICAgIHN0b3JlX2xpYnhsX2VudHJ5KGdjLCBkb21pZCwgJmRfY29uZmlnLT5iX2luZm8pOwog
CiAgICAgbGlieGxfX211bHRpZGV2X2JlZ2luKGFvLCAmZGNzLT5tdWx0aWRldik7CkBAIC0xODMz
LDYgKzE4NzgsOCBAQCBzdGF0aWMgaW50IGRvX2RvbWFpbl9jcmVhdGUobGlieGxfY3R4ICpjdHgs
IGxpYnhsX2RvbWFpbl9jb25maWcgKmRfY29uZmlnLAogICAgIEdDTkVXKGNkY3MpOwogICAgIGNk
Y3MtPmRjcy5hbyA9IGFvOwogICAgIGNkY3MtPmRjcy5ndWVzdF9jb25maWcgPSBkX2NvbmZpZzsK
KyAgICBjZGNzLT5kY3MuZ3Vlc3RfZG9taWQgPSAqZG9taWQ7CisKICAgICBsaWJ4bF9kb21haW5f
Y29uZmlnX2luaXQoJmNkY3MtPmRjcy5ndWVzdF9jb25maWdfc2F2ZWQpOwogICAgIGxpYnhsX2Rv
bWFpbl9jb25maWdfY29weShjdHgsICZjZGNzLT5kY3MuZ3Vlc3RfY29uZmlnX3NhdmVkLCBkX2Nv
bmZpZyk7CiAgICAgY2Rjcy0+ZGNzLnJlc3RvcmVfZmQgPSBjZGNzLT5kY3MubGlieGNfZmQgPSBy
ZXN0b3JlX2ZkOwpAQCAtMjA4MSw2ICsyMTI4LDQzIEBAIGludCBsaWJ4bF9kb21haW5fY3JlYXRl
X25ldyhsaWJ4bF9jdHggKmN0eCwgbGlieGxfZG9tYWluX2NvbmZpZyAqZF9jb25maWcsCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgYW9faG93LCBhb3BfY29uc29sZV9ob3cpOwogfQogCitp
bnQgbGlieGxfZG9tYWluX2Zvcmtfdm0obGlieGxfY3R4ICpjdHgsIHVpbnQzMl90IHBkb21pZCwg
dWludDMyX3QgKmRvbWlkKQoreworICAgIGludCByYzsKKyAgICBzdHJ1Y3QgeGVuX2RvbWN0bF9j
cmVhdGVkb21haW4gY3JlYXRlID0gezB9OworICAgIGNyZWF0ZS5mbGFncyB8PSBYRU5fRE9NQ1RM
X0NERl9odm07CisgICAgY3JlYXRlLmZsYWdzIHw9IFhFTl9ET01DVExfQ0RGX2hhcDsKKyAgICBj
cmVhdGUuZmxhZ3MgfD0gWEVOX0RPTUNUTF9DREZfb29zX29mZjsKKyAgICBjcmVhdGUuYXJjaC5l
bXVsYXRpb25fZmxhZ3MgPSAoWEVOX1g4Nl9FTVVfQUxMICYgflhFTl9YODZfRU1VX1ZQQ0kpOwor
CisgICAgY3JlYXRlLnNzaWRyZWYgPSBTRUNJTklUU0lEX0RPTVU7CisgICAgY3JlYXRlLnBhcmVu
dF9kb21pZCA9IHBkb21pZDsKKyAgICBjcmVhdGUubWF4X2V2dGNobl9wb3J0ID0gMTAyMzsKKyAg
ICBjcmVhdGUubWF4X2dyYW50X2ZyYW1lcyA9IExJQlhMX01BWF9HUkFOVF9GUkFNRVNfREVGQVVM
VDsKKyAgICBjcmVhdGUubWF4X21hcHRyYWNrX2ZyYW1lcyA9IExJQlhMX01BWF9NQVBUUkFDS19G
UkFNRVNfREVGQVVMVDsKKworICAgIGlmICggKHJjID0geGNfZG9tYWluX2NyZWF0ZShjdHgtPnhj
aCwgZG9taWQsICZjcmVhdGUpKSApCisgICAgICAgIHJldHVybiByYzsKKworICAgIGlmICggKHJj
ID0geGNfbWVtc2hyX2ZvcmsoY3R4LT54Y2gsIHBkb21pZCwgKmRvbWlkKSkgKQorICAgICAgICB4
Y19kb21haW5fZGVzdHJveShjdHgtPnhjaCwgKmRvbWlkKTsKKworICAgIHJldHVybiByYzsKK30K
KworaW50IGxpYnhsX2RvbWFpbl9mb3JrX2xhdW5jaF9kbShsaWJ4bF9jdHggKmN0eCwgbGlieGxf
ZG9tYWluX2NvbmZpZyAqZF9jb25maWcsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHVpbnQzMl90IGRvbWlkLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBs
aWJ4bF9hc3luY3Byb2dyZXNzX2hvdyAqYW9wX2NvbnNvbGVfaG93KQoreworICAgIHVuc2V0X2Rp
c2tfY29sb19yZXN0b3JlKGRfY29uZmlnKTsKKyAgICByZXR1cm4gZG9fZG9tYWluX2NyZWF0ZShj
dHgsIGRfY29uZmlnLCAmZG9taWQsIC0xLCAtMSwgMCwgMCwgYW9wX2NvbnNvbGVfaG93KTsKK30K
KworaW50IGxpYnhsX2RvbWFpbl9mb3JrX3Jlc2V0KGxpYnhsX2N0eCAqY3R4LCB1aW50MzJfdCBk
b21pZCkKK3sKKyAgICByZXR1cm4geGNfbWVtc2hyX2ZvcmtfcmVzZXQoY3R4LT54Y2gsIGRvbWlk
KTsKK30KKwogaW50IGxpYnhsX2RvbWFpbl9jcmVhdGVfcmVzdG9yZShsaWJ4bF9jdHggKmN0eCwg
bGlieGxfZG9tYWluX2NvbmZpZyAqZF9jb25maWcsCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHVpbnQzMl90ICpkb21pZCwgaW50IHJlc3RvcmVfZmQsCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGludCBzZW5kX2JhY2tfZmQsCmRpZmYgLS1naXQgYS90b29scy9saWJ4
bC9saWJ4bF9kbS5jIGIvdG9vbHMvbGlieGwvbGlieGxfZG0uYwppbmRleCAzYjFkYTkwMTY3Li44
N2FlMTQ3OGNmIDEwMDY0NAotLS0gYS90b29scy9saWJ4bC9saWJ4bF9kbS5jCisrKyBiL3Rvb2xz
L2xpYnhsL2xpYnhsX2RtLmMKQEAgLTI3ODcsNyArMjc4Nyw3IEBAIHN0YXRpYyB2b2lkIGRldmlj
ZV9tb2RlbF9zcGF3bl9vdXRjb21lKGxpYnhsX19lZ2MgKmVnYywKIAogICAgIGxpYnhsX19kb21h
aW5fYnVpbGRfc3RhdGUgKnN0YXRlID0gZG1zcy0+YnVpbGRfc3RhdGU7CiAKLSAgICBpZiAoc3Rh
dGUtPnNhdmVkX3N0YXRlKSB7CisgICAgaWYgKHN0YXRlLT5zYXZlZF9zdGF0ZSAmJiAhc3RhdGUt
PmZvcmtlZF92bSkgewogICAgICAgICByZXQyID0gdW5saW5rKHN0YXRlLT5zYXZlZF9zdGF0ZSk7
CiAgICAgICAgIGlmIChyZXQyKSB7CiAgICAgICAgICAgICBMT0dFRChFUlJPUiwgZG1zcy0+Z3Vl
c3RfZG9taWQsICIlczogZmFpbGVkIHRvIHJlbW92ZSBkZXZpY2UtbW9kZWwgc3RhdGUgJXMiLApk
aWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGlieGxfZG9tLmMgYi90b29scy9saWJ4bC9saWJ4bF9k
b20uYwppbmRleCA3MWNiNTc4OTIzLi4zYmM3MTE3Yjk5IDEwMDY0NAotLS0gYS90b29scy9saWJ4
bC9saWJ4bF9kb20uYworKysgYi90b29scy9saWJ4bC9saWJ4bF9kb20uYwpAQCAtMjQ5LDkgKzI0
OSwxMiBAQCBpbnQgbGlieGxfX2J1aWxkX3ByZShsaWJ4bF9fZ2MgKmdjLCB1aW50MzJfdCBkb21p
ZCwKICAgICBsaWJ4bF9kb21haW5fYnVpbGRfaW5mbyAqY29uc3QgaW5mbyA9ICZkX2NvbmZpZy0+
Yl9pbmZvOwogICAgIGxpYnhsX2N0eCAqY3R4ID0gbGlieGxfX2djX293bmVyKGdjKTsKICAgICBj
aGFyICp4c19kb21pZCwgKmNvbl9kb21pZDsKLSAgICBpbnQgcmM7CisgICAgaW50IHJjID0gMDsK
ICAgICB1aW50NjRfdCBzaXplOwogCisgICAgaWYgKCBzdGF0ZS0+Zm9ya2VkX3ZtICkKKyAgICAg
ICAgZ290byBza2lwX2Zvcms7CisKICAgICBpZiAoeGNfZG9tYWluX21heF92Y3B1cyhjdHgtPnhj
aCwgZG9taWQsIGluZm8tPm1heF92Y3B1cykgIT0gMCkgewogICAgICAgICBMT0coRVJST1IsICJD
b3VsZG4ndCBzZXQgbWF4IHZjcHUgY291bnQiKTsKICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUw7
CkBAIC0zNjIsNyArMzY1LDYgQEAgaW50IGxpYnhsX19idWlsZF9wcmUobGlieGxfX2djICpnYywg
dWludDMyX3QgZG9taWQsCiAgICAgICAgIH0KICAgICB9CiAKLQogICAgIHJjID0gbGlieGxfX2Fy
Y2hfZXh0cmFfbWVtb3J5KGdjLCBpbmZvLCAmc2l6ZSk7CiAgICAgaWYgKHJjIDwgMCkgewogICAg
ICAgICBMT0dFKEVSUk9SLCAiQ291bGRuJ3QgZ2V0IGFyY2ggZXh0cmEgY29uc3RhbnQgbWVtb3J5
IHNpemUiKTsKQEAgLTM3NCw2ICszNzYsMTEgQEAgaW50IGxpYnhsX19idWlsZF9wcmUobGlieGxf
X2djICpnYywgdWludDMyX3QgZG9taWQsCiAgICAgICAgIHJldHVybiBFUlJPUl9GQUlMOwogICAg
IH0KIAorICAgIHJjID0gbGlieGxfX2FyY2hfZG9tYWluX2NyZWF0ZShnYywgZF9jb25maWcsIGRv
bWlkKTsKKyAgICBpZiAoIHJjICkKKyAgICAgICAgZ290byBvdXQ7CisKK3NraXBfZm9yazoKICAg
ICB4c19kb21pZCA9IHhzX3JlYWQoY3R4LT54c2gsIFhCVF9OVUxMLCAiL3Rvb2wveGVuc3RvcmVk
L2RvbWlkIiwgTlVMTCk7CiAgICAgc3RhdGUtPnN0b3JlX2RvbWlkID0geHNfZG9taWQgPyBhdG9p
KHhzX2RvbWlkKSA6IDA7CiAgICAgZnJlZSh4c19kb21pZCk7CkBAIC0zODUsOCArMzkyLDcgQEAg
aW50IGxpYnhsX19idWlsZF9wcmUobGlieGxfX2djICpnYywgdWludDMyX3QgZG9taWQsCiAgICAg
c3RhdGUtPnN0b3JlX3BvcnQgPSB4Y19ldnRjaG5fYWxsb2NfdW5ib3VuZChjdHgtPnhjaCwgZG9t
aWQsIHN0YXRlLT5zdG9yZV9kb21pZCk7CiAgICAgc3RhdGUtPmNvbnNvbGVfcG9ydCA9IHhjX2V2
dGNobl9hbGxvY191bmJvdW5kKGN0eC0+eGNoLCBkb21pZCwgc3RhdGUtPmNvbnNvbGVfZG9taWQp
OwogCi0gICAgcmMgPSBsaWJ4bF9fYXJjaF9kb21haW5fY3JlYXRlKGdjLCBkX2NvbmZpZywgZG9t
aWQpOwotCitvdXQ6CiAgICAgcmV0dXJuIHJjOwogfQogCkBAIC00NDQsNiArNDUwLDkgQEAgaW50
IGxpYnhsX19idWlsZF9wb3N0KGxpYnhsX19nYyAqZ2MsIHVpbnQzMl90IGRvbWlkLAogICAgIGNo
YXIgKiplbnRzOwogICAgIGludCBpLCByYzsKIAorICAgIGlmICggc3RhdGUtPmZvcmtlZF92bSAp
CisgICAgICAgIGdvdG8gc2tpcF9mb3JrOworCiAgICAgaWYgKGluZm8tPm51bV92bnVtYV9ub2Rl
cyAmJiAhaW5mby0+bnVtX3ZjcHVfc29mdF9hZmZpbml0eSkgewogICAgICAgICByYyA9IHNldF92
bnVtYV9hZmZpbml0eShnYywgZG9taWQsIGluZm8pOwogICAgICAgICBpZiAocmMpCkBAIC00NjYs
NiArNDc1LDcgQEAgaW50IGxpYnhsX19idWlsZF9wb3N0KGxpYnhsX19nYyAqZ2MsIHVpbnQzMl90
IGRvbWlkLAogICAgICAgICB9CiAgICAgfQogCitza2lwX2Zvcms6CiAgICAgZW50cyA9IGxpYnhs
X19jYWxsb2MoZ2MsIDEyICsgKGluZm8tPm1heF92Y3B1cyAqIDIpICsgMiwgc2l6ZW9mKGNoYXIg
KikpOwogICAgIGVudHNbMF0gPSAibWVtb3J5L3N0YXRpYy1tYXgiOwogICAgIGVudHNbMV0gPSBH
Q1NQUklOVEYoIiUiUFJJZDY0LCBpbmZvLT5tYXhfbWVta2IpOwpAQCAtNzI4LDE0ICs3MzgsMTYg
QEAgc3RhdGljIGludCBodm1fYnVpbGRfc2V0X3BhcmFtcyh4Y19pbnRlcmZhY2UgKmhhbmRsZSwg
dWludDMyX3QgZG9taWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnhsX2Rv
bWFpbl9idWlsZF9pbmZvICppbmZvLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBp
bnQgc3RvcmVfZXZ0Y2huLCB1bnNpZ25lZCBsb25nICpzdG9yZV9tZm4sCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGludCBjb25zb2xlX2V2dGNobiwgdW5zaWduZWQgbG9uZyAqY29u
c29sZV9tZm4sCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvbWlkX3Qgc3RvcmVf
ZG9taWQsIGRvbWlkX3QgY29uc29sZV9kb21pZCkKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgZG9taWRfdCBzdG9yZV9kb21pZCwgZG9taWRfdCBjb25zb2xlX2RvbWlkLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBib29sIGZvcmtlZF92bSkKIHsKICAgICBzdHJ1Y3Qg
aHZtX2luZm9fdGFibGUgKnZhX2h2bTsKICAgICB1aW50OF90ICp2YV9tYXAsIHN1bTsKICAgICB1
aW50NjRfdCBzdHJfbWZuLCBjb25zX21mbjsKICAgICBpbnQgaTsKIAotICAgIGlmIChpbmZvLT50
eXBlID09IExJQlhMX0RPTUFJTl9UWVBFX0hWTSkgeworICAgIGlmICggaW5mby0+dHlwZSA9PSBM
SUJYTF9ET01BSU5fVFlQRV9IVk0gJiYgIWZvcmtlZF92bSApCisgICAgewogICAgICAgICB2YV9t
YXAgPSB4Y19tYXBfZm9yZWlnbl9yYW5nZShoYW5kbGUsIGRvbWlkLAogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBYQ19QQUdFX1NJWkUsIFBST1RfUkVBRCB8IFBST1RfV1JJ
VEUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhWTV9JTkZPX1BGTik7
CkBAIC0xMDUxLDYgKzEwNjMsMjMgQEAgaW50IGxpYnhsX19idWlsZF9odm0obGlieGxfX2djICpn
YywgdWludDMyX3QgZG9taWQsCiAgICAgc3RydWN0IHhjX2RvbV9pbWFnZSAqZG9tID0gTlVMTDsK
ICAgICBib29sIGRldmljZV9tb2RlbCA9IGluZm8tPnR5cGUgPT0gTElCWExfRE9NQUlOX1RZUEVf
SFZNID8gdHJ1ZSA6IGZhbHNlOwogCisgICAgaWYgKCBzdGF0ZS0+Zm9ya2VkX3ZtICkKKyAgICB7
CisgICAgICAgIHJjID0gaHZtX2J1aWxkX3NldF9wYXJhbXMoY3R4LT54Y2gsIGRvbWlkLCBpbmZv
LCBzdGF0ZS0+c3RvcmVfcG9ydCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAm
c3RhdGUtPnN0b3JlX21mbiwgc3RhdGUtPmNvbnNvbGVfcG9ydCwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAmc3RhdGUtPmNvbnNvbGVfbWZuLCBzdGF0ZS0+c3RvcmVfZG9taWQs
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUtPmNvbnNvbGVfZG9taWQs
IHN0YXRlLT5mb3JrZWRfdm0pOworCisgICAgICAgIGlmICggcmMgKQorICAgICAgICAgICAgcmV0
dXJuIHJjOworCisgICAgICAgIHJldHVybiB4Y19kb21fZ250dGFiX3NlZWQoY3R4LT54Y2gsIGRv
bWlkLCB0cnVlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLT5jb25z
b2xlX21mbiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS0+c3RvcmVf
bWZuLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLT5jb25zb2xlX2Rv
bWlkLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLT5zdG9yZV9kb21p
ZCk7CisgICAgfQorCiAgICAgeGNfZG9tX2xvZ2luaXQoY3R4LT54Y2gpOwogCiAgICAgLyoKQEAg
LTExNzUsNyArMTIwNCw3IEBAIGludCBsaWJ4bF9fYnVpbGRfaHZtKGxpYnhsX19nYyAqZ2MsIHVp
bnQzMl90IGRvbWlkLAogICAgIHJjID0gaHZtX2J1aWxkX3NldF9wYXJhbXMoY3R4LT54Y2gsIGRv
bWlkLCBpbmZvLCBzdGF0ZS0+c3RvcmVfcG9ydCwKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAmc3RhdGUtPnN0b3JlX21mbiwgc3RhdGUtPmNvbnNvbGVfcG9ydCwKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAmc3RhdGUtPmNvbnNvbGVfbWZuLCBzdGF0ZS0+c3RvcmVfZG9t
aWQsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUtPmNvbnNvbGVfZG9taWQp
OworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLT5jb25zb2xlX2RvbWlkLCBm
YWxzZSk7CiAgICAgaWYgKHJjICE9IDApIHsKICAgICAgICAgTE9HKEVSUk9SLCAiaHZtIGJ1aWxk
IHNldCBwYXJhbXMgZmFpbGVkIik7CiAgICAgICAgIGdvdG8gb3V0OwpkaWZmIC0tZ2l0IGEvdG9v
bHMvbGlieGwvbGlieGxfaW50ZXJuYWwuaCBiL3Rvb2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmgK
aW5kZXggNDkzNjQ0NjA2OS4uZDdhN2NlMTYzZCAxMDA2NDQKLS0tIGEvdG9vbHMvbGlieGwvbGli
eGxfaW50ZXJuYWwuaAorKysgYi90b29scy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5oCkBAIC0xMzc0
LDYgKzEzNzQsNyBAQCB0eXBlZGVmIHN0cnVjdCB7CiAKICAgICBjaGFyICpzYXZlZF9zdGF0ZTsK
ICAgICBpbnQgZG1fbW9uaXRvcl9mZDsKKyAgICBib29sIGZvcmtlZF92bTsKIAogICAgIGxpYnhs
X19maWxlX3JlZmVyZW5jZSBwdl9rZXJuZWw7CiAgICAgbGlieGxfX2ZpbGVfcmVmZXJlbmNlIHB2
X3JhbWRpc2s7CmRpZmYgLS1naXQgYS90b29scy9saWJ4bC9saWJ4bF90eXBlcy5pZGwgYi90b29s
cy9saWJ4bC9saWJ4bF90eXBlcy5pZGwKaW5kZXggNzkyMTk1MGY2YS4uN2M0YzQwNTdhOSAxMDA2
NDQKLS0tIGEvdG9vbHMvbGlieGwvbGlieGxfdHlwZXMuaWRsCisrKyBiL3Rvb2xzL2xpYnhsL2xp
YnhsX3R5cGVzLmlkbApAQCAtOTU2LDYgKzk1Niw3IEBAIGxpYnhsX2RvbWFpbl9jb25maWcgPSBT
dHJ1Y3QoImRvbWFpbl9jb25maWciLCBbCiAgICAgKCJvbl93YXRjaGRvZyIsIGxpYnhsX2FjdGlv
bl9vbl9zaHV0ZG93biksCiAgICAgKCJvbl9jcmFzaCIsIGxpYnhsX2FjdGlvbl9vbl9zaHV0ZG93
biksCiAgICAgKCJvbl9zb2Z0X3Jlc2V0IiwgbGlieGxfYWN0aW9uX29uX3NodXRkb3duKSwKKyAg
ICAoImRtX3Jlc3RvcmVfZmlsZSIsIHN0cmluZywgeydjb25zdCc6IFRydWV9KSwKICAgICBdLCBk
aXI9RElSX0lOKQogCiBsaWJ4bF9kaXNraW5mbyA9IFN0cnVjdCgiZGlza2luZm8iLCBbCmRpZmYg
LS1naXQgYS90b29scy94bC94bC5oIGIvdG9vbHMveGwveGwuaAppbmRleCA2MGJkYWQ4ZmZiLi45
YmRhZDY1MjZlIDEwMDY0NAotLS0gYS90b29scy94bC94bC5oCisrKyBiL3Rvb2xzL3hsL3hsLmgK
QEAgLTMxLDYgKzMxLDcgQEAgc3RydWN0IGNtZF9zcGVjIHsKIH07CiAKIHN0cnVjdCBkb21haW5f
Y3JlYXRlIHsKKyAgICB1aW50MzJfdCBkZG9taWQ7IC8qIGZvcmsgbGF1bmNoIGRtIGZvciB0aGlz
IGRvbWlkICovCiAgICAgaW50IGRlYnVnOwogICAgIGludCBkYWVtb25pemU7CiAgICAgaW50IG1v
bml0b3I7IC8qIGhhbmRsZSBndWVzdCByZWJvb3RzIGV0YyAqLwpAQCAtNDUsNiArNDYsNyBAQCBz
dHJ1Y3QgZG9tYWluX2NyZWF0ZSB7CiAgICAgY29uc3QgY2hhciAqY29uZmlnX2ZpbGU7CiAgICAg
Y2hhciAqZXh0cmFfY29uZmlnOyAvKiBleHRyYSBjb25maWcgc3RyaW5nICovCiAgICAgY29uc3Qg
Y2hhciAqcmVzdG9yZV9maWxlOworICAgIGNvbnN0IGNoYXIgKmRtX3Jlc3RvcmVfZmlsZTsKICAg
ICBjaGFyICpjb2xvX3Byb3h5X3NjcmlwdDsKICAgICBib29sIHVzZXJzcGFjZV9jb2xvX3Byb3h5
OwogICAgIGludCBtaWdyYXRlX2ZkOyAvKiAtMSBtZWFucyBub25lICovCkBAIC0xMjcsNiArMTI5
LDkgQEAgaW50IG1haW5fcGNpYXNzaWduYWJsZV9yZW1vdmUoaW50IGFyZ2MsIGNoYXIgKiphcmd2
KTsKIGludCBtYWluX3BjaWFzc2lnbmFibGVfbGlzdChpbnQgYXJnYywgY2hhciAqKmFyZ3YpOwog
I2lmbmRlZiBMSUJYTF9IQVZFX05PX1NVU1BFTkRfUkVTVU1FCiBpbnQgbWFpbl9yZXN0b3JlKGlu
dCBhcmdjLCBjaGFyICoqYXJndik7CitpbnQgbWFpbl9mb3JrX3ZtKGludCBhcmdjLCBjaGFyICoq
YXJndik7CitpbnQgbWFpbl9mb3JrX2xhdW5jaF9kbShpbnQgYXJnYywgY2hhciAqKmFyZ3YpOwor
aW50IG1haW5fZm9ya19yZXNldChpbnQgYXJnYywgY2hhciAqKmFyZ3YpOwogaW50IG1haW5fbWln
cmF0ZV9yZWNlaXZlKGludCBhcmdjLCBjaGFyICoqYXJndik7CiBpbnQgbWFpbl9zYXZlKGludCBh
cmdjLCBjaGFyICoqYXJndik7CiBpbnQgbWFpbl9taWdyYXRlKGludCBhcmdjLCBjaGFyICoqYXJn
dik7CmRpZmYgLS1naXQgYS90b29scy94bC94bF9jbWR0YWJsZS5jIGIvdG9vbHMveGwveGxfY21k
dGFibGUuYwppbmRleCAzYjMwMmIyZjIwLi4zYTVkMzcxMDU3IDEwMDY0NAotLS0gYS90b29scy94
bC94bF9jbWR0YWJsZS5jCisrKyBiL3Rvb2xzL3hsL3hsX2NtZHRhYmxlLmMKQEAgLTE4NSw2ICsx
ODUsMTggQEAgc3RydWN0IGNtZF9zcGVjIGNtZF90YWJsZVtdID0gewogICAgICAgIlJlc3RvcmUg
YSBkb21haW4gZnJvbSBhIHNhdmVkIHN0YXRlIiwKICAgICAgICItIGZvciBpbnRlcm5hbCB1c2Ug
b25seSIsCiAgICAgfSwKKyAgICB7ICJmb3JrLXZtIiwKKyAgICAgICZtYWluX2Zvcmtfdm0sIDAs
IDEsCisgICAgICAiRm9yayBhIGRvbWFpbiBmcm9tIHRoZSBydW5uaW5nIHBhcmVudCBkb21pZCIs
CisgICAgICAiW29wdGlvbnNdIDxEb21pZD4iLAorICAgICAgIi1oICAgICAgICAgICAgICAgICAg
ICAgICAgICAgUHJpbnQgdGhpcyBoZWxwLlxuIgorICAgICAgIi1DIDxjb25maWc+ICAgICAgICAg
ICAgICAgICAgVXNlIGNvbmZpZyBmaWxlIGZvciBWTSBmb3JrLlxuIgorICAgICAgIi1RIDxxZW11
LXNhdmUtZmlsZT4gICAgICAgICAgVXNlIHFlbXUgc2F2ZSBmaWxlIGZvciBWTSBmb3JrLlxuIgor
ICAgICAgIi0tbGF1bmNoLWRtIDx5ZXN8bm98bGF0ZT4gICAgTGF1bmNoIGRldmljZSBtb2RlbCAo
UUVNVSkgZm9yIFZNIGZvcmsuXG4iCisgICAgICAiLS1mb3JrLXJlc2V0ICAgICAgICAgICAgICAg
ICBSZXNldCBWTSBmb3JrLlxuIgorICAgICAgIi1wICAgICAgICAgICAgICAgICAgICAgICAgICAg
RG8gbm90IHVucGF1c2UgZm9yayBWTSBhZnRlciBvcGVyYXRpb24uXG4iCisgICAgICAiLWQgICAg
ICAgICAgICAgICAgICAgICAgICAgICBFbmFibGUgZGVidWcgbWVzc2FnZXMuXG4iCisgICAgfSwK
ICNlbmRpZgogICAgIHsgImR1bXAtY29yZSIsCiAgICAgICAmbWFpbl9kdW1wX2NvcmUsIDAsIDEs
CmRpZmYgLS1naXQgYS90b29scy94bC94bF9zYXZlcmVzdG9yZS5jIGIvdG9vbHMveGwveGxfc2F2
ZXJlc3RvcmUuYwppbmRleCA5YmUwMzNmZTY1Li5kOTlkM2VjZWIyIDEwMDY0NAotLS0gYS90b29s
cy94bC94bF9zYXZlcmVzdG9yZS5jCisrKyBiL3Rvb2xzL3hsL3hsX3NhdmVyZXN0b3JlLmMKQEAg
LTIyOSw2ICsyMjksMTAzIEBAIGludCBtYWluX3Jlc3RvcmUoaW50IGFyZ2MsIGNoYXIgKiphcmd2
KQogICAgIHJldHVybiBFWElUX1NVQ0NFU1M7CiB9CiAKK2ludCBtYWluX2Zvcmtfdm0oaW50IGFy
Z2MsIGNoYXIgKiphcmd2KQoreworICAgIGludCByYywgZGVidWcgPSAwOworICAgIHVpbnQzMl90
IGRvbWlkX2luID0gSU5WQUxJRF9ET01JRCwgZG9taWRfb3V0ID0gSU5WQUxJRF9ET01JRDsKKyAg
ICBpbnQgbGF1bmNoX2RtID0gMTsKKyAgICBib29sIHJlc2V0ID0gMDsKKyAgICBib29sIHBhdXNl
ID0gMDsKKyAgICBjb25zdCBjaGFyICpjb25maWdfZmlsZSA9IE5VTEw7CisgICAgY29uc3QgY2hh
ciAqZG1fcmVzdG9yZV9maWxlID0gTlVMTDsKKworICAgIGludCBvcHQ7CisgICAgc3RhdGljIHN0
cnVjdCBvcHRpb24gb3B0c1tdID0geworICAgICAgICB7ImxhdW5jaC1kbSIsIDEsIDAsICdsJ30s
CisgICAgICAgIHsiZm9yay1yZXNldCIsIDAsIDAsICdyJ30sCisgICAgICAgIENPTU1PTl9MT05H
X09QVFMKKyAgICB9OworCisgICAgU1dJVENIX0ZPUkVBQ0hfT1BUKG9wdCwgInBoZEM6UTpsOnJO
OkQ6QjpWOiIsIG9wdHMsICJmb3JrLXZtIiwgMSkgeworICAgIGNhc2UgJ2QnOgorICAgICAgICBk
ZWJ1ZyA9IDE7CisgICAgICAgIGJyZWFrOworICAgIGNhc2UgJ3AnOgorICAgICAgICBwYXVzZSA9
IDE7CisgICAgICAgIGJyZWFrOworICAgIGNhc2UgJ0MnOgorICAgICAgICBjb25maWdfZmlsZSA9
IG9wdGFyZzsKKyAgICAgICAgYnJlYWs7CisgICAgY2FzZSAnUSc6CisgICAgICAgIGRtX3Jlc3Rv
cmVfZmlsZSA9IG9wdGFyZzsKKyAgICAgICAgYnJlYWs7CisgICAgY2FzZSAnbCc6CisgICAgICAg
IGlmICggIXN0cmNtcChvcHRhcmcsICJubyIpICkKKyAgICAgICAgICAgIGxhdW5jaF9kbSA9IDA7
CisgICAgICAgIGlmICggIXN0cmNtcChvcHRhcmcsICJ5ZXMiKSApCisgICAgICAgICAgICBsYXVu
Y2hfZG0gPSAxOworICAgICAgICBpZiAoICFzdHJjbXAob3B0YXJnLCAibGF0ZSIpICkKKyAgICAg
ICAgICAgIGxhdW5jaF9kbSA9IDI7CisgICAgICAgIGJyZWFrOworICAgIGNhc2UgJ3InOgorICAg
ICAgICByZXNldCA9IDE7CisgICAgICAgIGJyZWFrOworICAgIGNhc2UgJ04nOiAvKiBmYWxsLXRo
cm91Z2ggKi8KKyAgICBjYXNlICdEJzogLyogZmFsbC10aHJvdWdoICovCisgICAgY2FzZSAnQic6
IC8qIGZhbGwtdGhyb3VnaCAqLworICAgIGNhc2UgJ1YnOgorICAgICAgICBmcHJpbnRmKHN0ZGVy
ciwgIlVuaW1wbGVtZW50ZWQgb3B0aW9uKHMpXG4iKTsKKyAgICAgICAgcmV0dXJuIEVYSVRfRkFJ
TFVSRTsKKyAgICB9CisKKyAgICBpZiAoYXJnYy1vcHRpbmQgPT0gMSkgeworICAgICAgICBkb21p
ZF9pbiA9IGF0b2koYXJndltvcHRpbmRdKTsKKyAgICB9IGVsc2UgeworICAgICAgICBoZWxwKCJm
b3JrLXZtIik7CisgICAgICAgIHJldHVybiBFWElUX0ZBSUxVUkU7CisgICAgfQorCisgICAgaWYg
KGxhdW5jaF9kbSAmJiAoIWNvbmZpZ19maWxlIHx8ICFkbV9yZXN0b3JlX2ZpbGUpKSB7CisgICAg
ICAgIGZwcmludGYoc3RkZXJyLCAiQ3VycmVudGx5IHlvdSBtdXN0IHByb3ZpZGUgYm90aCAtQyBh
bmQgLVEgb3B0aW9uc1xuIik7CisgICAgICAgIHJldHVybiBFWElUX0ZBSUxVUkU7CisgICAgfQor
CisgICAgaWYgKHJlc2V0KSB7CisgICAgICAgIGRvbWlkX291dCA9IGRvbWlkX2luOworICAgICAg
ICBpZiAobGlieGxfZG9tYWluX2ZvcmtfcmVzZXQoY3R4LCBkb21pZF9pbikgPT0gRVhJVF9GQUlM
VVJFKQorICAgICAgICAgICAgcmV0dXJuIEVYSVRfRkFJTFVSRTsKKyAgICB9CisKKyAgICBpZiAo
bGF1bmNoX2RtID09IDIgfHwgcmVzZXQpIHsKKyAgICAgICAgZG9taWRfb3V0ID0gZG9taWRfaW47
CisgICAgICAgIHJjID0gRVhJVF9TVUNDRVNTOworICAgIH0gZWxzZQorICAgICAgICByYyA9IGxp
YnhsX2RvbWFpbl9mb3JrX3ZtKGN0eCwgZG9taWRfaW4sICZkb21pZF9vdXQpOworCisgICAgaWYg
KHJjID09IEVYSVRfU1VDQ0VTUykgeworICAgICAgICBpZiAoIGxhdW5jaF9kbSApIHsKKyAgICAg
ICAgICAgIHN0cnVjdCBkb21haW5fY3JlYXRlIGRvbV9pbmZvOworICAgICAgICAgICAgbWVtc2V0
KCZkb21faW5mbywgMCwgc2l6ZW9mKGRvbV9pbmZvKSk7CisgICAgICAgICAgICBkb21faW5mby5k
ZG9taWQgPSBkb21pZF9vdXQ7CisgICAgICAgICAgICBkb21faW5mby5kbV9yZXN0b3JlX2ZpbGUg
PSBkbV9yZXN0b3JlX2ZpbGU7CisgICAgICAgICAgICBkb21faW5mby5kZWJ1ZyA9IGRlYnVnOwor
ICAgICAgICAgICAgZG9tX2luZm8ucGF1c2VkID0gcGF1c2U7CisgICAgICAgICAgICBkb21faW5m
by5jb25maWdfZmlsZSA9IGNvbmZpZ19maWxlOworICAgICAgICAgICAgZG9tX2luZm8ubWlncmF0
ZV9mZCA9IC0xOworICAgICAgICAgICAgZG9tX2luZm8uc2VuZF9iYWNrX2ZkID0gLTE7CisgICAg
ICAgICAgICByYyA9IGNyZWF0ZV9kb21haW4oJmRvbV9pbmZvKSA8IDAgPyBFWElUX0ZBSUxVUkUg
OiBFWElUX1NVQ0NFU1M7CisgICAgICAgIH0gZWxzZSBpZiAoICFwYXVzZSApCisgICAgICAgICAg
ICByYyA9IGxpYnhsX2RvbWFpbl91bnBhdXNlKGN0eCwgZG9taWRfb3V0LCBOVUxMKTsKKyAgICB9
CisKKyAgICBpZiAocmMgPT0gRVhJVF9TVUNDRVNTKQorICAgICAgICBmcHJpbnRmKHN0ZGVyciwg
ImZvcmstdm0gY29tbWFuZCBzdWNjZXNzZnVsbHkgcmV0dXJuZWQgZG9taWQ6ICV1XG4iLCBkb21p
ZF9vdXQpOworICAgIGVsc2UgaWYgKCBkb21pZF9vdXQgIT0gSU5WQUxJRF9ET01JRCApCisgICAg
ICAgIGxpYnhsX2RvbWFpbl9kZXN0cm95KGN0eCwgZG9taWRfb3V0LCAwKTsKKworICAgIHJldHVy
biByYzsKK30KKwogaW50IG1haW5fc2F2ZShpbnQgYXJnYywgY2hhciAqKmFyZ3YpCiB7CiAgICAg
dWludDMyX3QgZG9taWQ7CmRpZmYgLS1naXQgYS90b29scy94bC94bF92bWNvbnRyb2wuYyBiL3Rv
b2xzL3hsL3hsX3ZtY29udHJvbC5jCmluZGV4IGU1MjBiMWRhNzkuLmQ5Y2IxOWM1OTkgMTAwNjQ0
Ci0tLSBhL3Rvb2xzL3hsL3hsX3ZtY29udHJvbC5jCisrKyBiL3Rvb2xzL3hsL3hsX3ZtY29udHJv
bC5jCkBAIC02NDUsNiArNjQ1LDcgQEAgaW50IGNyZWF0ZV9kb21haW4oc3RydWN0IGRvbWFpbl9j
cmVhdGUgKmRvbV9pbmZvKQogCiAgICAgbGlieGxfZG9tYWluX2NvbmZpZyBkX2NvbmZpZzsKIAor
ICAgIHVpbnQzMl90IGRkb21pZCA9IGRvbV9pbmZvLT5kZG9taWQ7IC8vIGxhdW5jaCBkbSBmb3Ig
dGhpcyBkb21haW4gaWZmIHNldAogICAgIGludCBkZWJ1ZyA9IGRvbV9pbmZvLT5kZWJ1ZzsKICAg
ICBpbnQgZGFlbW9uaXplID0gZG9tX2luZm8tPmRhZW1vbml6ZTsKICAgICBpbnQgbW9uaXRvciA9
IGRvbV9pbmZvLT5tb25pdG9yOwpAQCAtNjU1LDYgKzY1Niw3IEBAIGludCBjcmVhdGVfZG9tYWlu
KHN0cnVjdCBkb21haW5fY3JlYXRlICpkb21faW5mbykKICAgICBjb25zdCBjaGFyICpyZXN0b3Jl
X2ZpbGUgPSBkb21faW5mby0+cmVzdG9yZV9maWxlOwogICAgIGNvbnN0IGNoYXIgKmNvbmZpZ19z
b3VyY2UgPSBOVUxMOwogICAgIGNvbnN0IGNoYXIgKnJlc3RvcmVfc291cmNlID0gTlVMTDsKKyAg
ICBjb25zdCBjaGFyICpkbV9yZXN0b3JlX2ZpbGUgPSBkb21faW5mby0+ZG1fcmVzdG9yZV9maWxl
OwogICAgIGludCBtaWdyYXRlX2ZkID0gZG9tX2luZm8tPm1pZ3JhdGVfZmQ7CiAgICAgYm9vbCBj
b25maWdfaW5fanNvbjsKIApAQCAtOTIzLDYgKzkyNSwxMiBAQCBzdGFydDoKICAgICAgICAgICog
cmVzdG9yZS9taWdyYXRlLXJlY2VpdmUgaXQgYWdhaW4uCiAgICAgICAgICAqLwogICAgICAgICBy
ZXN0b3JpbmcgPSAwOworICAgIH0gZWxzZSBpZiAoIGRkb21pZCApIHsKKyAgICAgICAgZF9jb25m
aWcuZG1fcmVzdG9yZV9maWxlID0gZG1fcmVzdG9yZV9maWxlOworICAgICAgICByZXQgPSBsaWJ4
bF9kb21haW5fZm9ya19sYXVuY2hfZG0oY3R4LCAmZF9jb25maWcsIGRkb21pZCwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9jb25uZWN0X2NvbnNvbGVfaG93
KTsKKyAgICAgICAgZG9taWQgPSBkZG9taWQ7CisgICAgICAgIGRkb21pZCA9IElOVkFMSURfRE9N
SUQ7CiAgICAgfSBlbHNlIGlmIChkb21pZF9zb2Z0X3Jlc2V0ICE9IElOVkFMSURfRE9NSUQpIHsK
ICAgICAgICAgLyogRG8gc29mdCByZXNldC4gKi8KICAgICAgICAgcmV0ID0gbGlieGxfZG9tYWlu
X3NvZnRfcmVzZXQoY3R4LCAmZF9jb25maWcsIGRvbWlkX3NvZnRfcmVzZXQsCi0tIAoyLjIwLjEK
CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2
ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xp
c3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

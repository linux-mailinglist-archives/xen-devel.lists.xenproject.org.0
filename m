Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 065D12C476
	for <lists+xen-devel@lfdr.de>; Tue, 28 May 2019 12:36:37 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hVZQx-0006OY-7p; Tue, 28 May 2019 10:34:19 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=31/0=T4=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1hVZQF-0004ui-8G
 for xen-devel@lists.xenproject.org; Tue, 28 May 2019 10:33:35 +0000
X-Inumbo-ID: 06acaade-8134-11e9-92ff-fff9d7d73903
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 06acaade-8134-11e9-92ff-fff9d7d73903;
 Tue, 28 May 2019 10:33:26 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id A9768B062;
 Tue, 28 May 2019 10:33:25 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Tue, 28 May 2019 12:32:48 +0200
Message-Id: <20190528103313.1343-36-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190528103313.1343-1-jgross@suse.com>
References: <20190528103313.1343-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH 35/60] xen/sched: add code to sync scheduling of
 all vcpus of a sched unit
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>,
 Dario Faggioli <dfaggioli@suse.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

V2hlbiBzd2l0Y2hpbmcgc2NoZWQgdW5pdHMgc3luY2hyb25pemUgYWxsIHZjcHVzIG9mIHRoZSBu
ZXcgdW5pdCB0byBiZQpzY2hlZHVsZWQgYXQgdGhlIHNhbWUgdGltZS4KCkEgdmFyaWFibGUgc2No
ZWRfZ3JhbnVsYXJpdHkgaXMgYWRkZWQgd2hpY2ggaG9sZHMgdGhlIG51bWJlciBvZiB2Y3B1cwpw
ZXIgc2NoZWR1bGUgdW5pdC4KCkFzIHRhc2tsZXRzIHJlcXVpcmUgdG8gc2NoZWR1bGUgdGhlIGlk
bGUgdW5pdCBpdCBpcyByZXF1aXJlZCB0byBzZXQgdGhlCnRhc2tsZXRfd29ya19zY2hlZHVsZWQg
cGFyYW1ldGVyIG9mIGRvX3NjaGVkdWxlKCkgdG8gdHJ1ZSBpZiBhbnkgY3B1CmNvdmVyZWQgYnkg
dGhlIGN1cnJlbnQgc2NoZWR1bGUoKSBjYWxsIGhhcyBhbnkgcGVuZGluZyB0YXNrbGV0IHdvcmsu
CgpGb3Igam9pbmluZyBvdGhlciB2Y3B1cyBvZiB0aGUgc2NoZWR1bGUgdW5pdCB3ZSBuZWVkIHRv
IGFkZCBhIG5ldwpzb2Z0aXJxIFNDSEVEX1NMQVZFX1NPRlRJUlEgaW4gb3JkZXIgdG8gaGF2ZSBh
IHdheSB0byBpbml0aWF0ZSBhCmNvbnRleHQgc3dpdGNoIHdpdGhvdXQgY2FsbGluZyB0aGUgZ2Vu
ZXJpYyBzY2hlZHVsZSgpIGZ1bmN0aW9uCnNlbGVjdGluZyB0aGUgdmNwdSB0byBzd2l0Y2ggdG8s
IGFzIHdlIGFscmVhZHkga25vdyB3aGljaCB2Y3B1IHdlCndhbnQgdG8gcnVuLiBUaGlzIGhhcyB0
aGUgb3RoZXIgYWR2YW50YWdlIG5vdCB0byBsb29zZSBhbnkgb3RoZXIKY29uY3VycmVudCBTQ0hF
RFVMRV9TT0ZUSVJRIGV2ZW50cy4KClNpZ25lZC1vZmYtYnk6IEp1ZXJnZW4gR3Jvc3MgPGpncm9z
c0BzdXNlLmNvbT4KLS0tClJGQyBWMjogbW92ZSBzeW5jaW5nIGFmdGVyIGNvbnRleHRfc3dpdGNo
KCkgdG8gc2NoZWR1bGUuYwotLS0KIHhlbi9hcmNoL2FybS9kb21haW4uYyAgICAgIHwgICAyICst
CiB4ZW4vYXJjaC94ODYvZG9tYWluLmMgICAgICB8ICAgMyArLQogeGVuL2NvbW1vbi9zY2hlZHVs
ZS5jICAgICAgfCAzMjYgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0t
LS0tCiB4ZW4vY29tbW9uL3NvZnRpcnEuYyAgICAgICB8ICAgNiArLQogeGVuL2luY2x1ZGUveGVu
L3NjaGVkLWlmLmggfCAgIDEgKwogeGVuL2luY2x1ZGUveGVuL3NjaGVkLmggICAgfCAgMTYgKyst
CiB4ZW4vaW5jbHVkZS94ZW4vc29mdGlycS5oICB8ICAgMSArCiA3IGZpbGVzIGNoYW5nZWQsIDI2
OSBpbnNlcnRpb25zKCspLCA4NiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS94ZW4vYXJjaC9h
cm0vZG9tYWluLmMgYi94ZW4vYXJjaC9hcm0vZG9tYWluLmMKaW5kZXggZmYzMzBiMzVlNi4uOTE0
MGE3OWM2MCAxMDA2NDQKLS0tIGEveGVuL2FyY2gvYXJtL2RvbWFpbi5jCisrKyBiL3hlbi9hcmNo
L2FybS9kb21haW4uYwpAQCAtMzEzLDcgKzMxMyw3IEBAIHN0YXRpYyB2b2lkIHNjaGVkdWxlX3Rh
aWwoc3RydWN0IHZjcHUgKnByZXYpCiAKICAgICBsb2NhbF9pcnFfZW5hYmxlKCk7CiAKLSAgICBj
b250ZXh0X3NhdmVkKHByZXYpOworICAgIHNjaGVkX2NvbnRleHRfc3dpdGNoZWQocHJldiwgY3Vy
cmVudCk7CiAKICAgICB1cGRhdGVfcnVuc3RhdGVfYXJlYShjdXJyZW50KTsKIApkaWZmIC0tZ2l0
IGEveGVuL2FyY2gveDg2L2RvbWFpbi5jIGIveGVuL2FyY2gveDg2L2RvbWFpbi5jCmluZGV4IGFj
OTYwZGRkNDAuLmQzZWU2OTlkYTYgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9kb21haW4uYwor
KysgYi94ZW4vYXJjaC94ODYvZG9tYWluLmMKQEAgLTE3MjEsNyArMTcyMSw2IEBAIHN0YXRpYyB2
b2lkIF9fY29udGV4dF9zd2l0Y2godm9pZCkKICAgICBwZXJfY3B1KGN1cnJfdmNwdSwgY3B1KSA9
IG47CiB9CiAKLQogdm9pZCBjb250ZXh0X3N3aXRjaChzdHJ1Y3QgdmNwdSAqcHJldiwgc3RydWN0
IHZjcHUgKm5leHQpCiB7CiAgICAgdW5zaWduZWQgaW50IGNwdSA9IHNtcF9wcm9jZXNzb3JfaWQo
KTsKQEAgLTE3OTcsNyArMTc5Niw3IEBAIHZvaWQgY29udGV4dF9zd2l0Y2goc3RydWN0IHZjcHUg
KnByZXYsIHN0cnVjdCB2Y3B1ICpuZXh0KQogICAgICAgICB9CiAgICAgfQogCi0gICAgY29udGV4
dF9zYXZlZChwcmV2KTsKKyAgICBzY2hlZF9jb250ZXh0X3N3aXRjaGVkKHByZXYsIG5leHQpOwog
CiAgICAgX3VwZGF0ZV9ydW5zdGF0ZV9hcmVhKG5leHQpOwogICAgIC8qIE11c3QgYmUgZG9uZSB3
aXRoIGludGVycnVwdHMgZW5hYmxlZCAqLwpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZHVs
ZS5jIGIveGVuL2NvbW1vbi9zY2hlZHVsZS5jCmluZGV4IGMyM2E1NjI5ZGUuLjlkZTMxNWFkYTEg
MTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWR1bGUuYworKysgYi94ZW4vY29tbW9uL3NjaGVk
dWxlLmMKQEAgLTU0LDYgKzU0LDEwIEBAIGJvb2xlYW5fcGFyYW0oInNjaGVkX3NtdF9wb3dlcl9z
YXZpbmdzIiwgc2NoZWRfc210X3Bvd2VyX3NhdmluZ3MpOwogICogKi8KIGludCBzY2hlZF9yYXRl
bGltaXRfdXMgPSBTQ0hFRF9ERUZBVUxUX1JBVEVMSU1JVF9VUzsKIGludGVnZXJfcGFyYW0oInNj
aGVkX3JhdGVsaW1pdF91cyIsIHNjaGVkX3JhdGVsaW1pdF91cyk7CisKKy8qIE51bWJlciBvZiB2
Y3B1cyBwZXIgc3RydWN0IHNjaGVkX3VuaXQuICovCitzdGF0aWMgdW5zaWduZWQgaW50IHNjaGVk
X2dyYW51bGFyaXR5ID0gMTsKKwogLyogVmFyaW91cyB0aW1lciBoYW5kbGVycy4gKi8KIHN0YXRp
YyB2b2lkIHNfdGltZXJfZm4odm9pZCAqdW51c2VkKTsKIHN0YXRpYyB2b2lkIHZjcHVfcGVyaW9k
aWNfdGltZXJfZm4odm9pZCAqZGF0YSk7CkBAIC0xNTc0LDEzNCArMTU3OCwzMDQgQEAgc3RhdGlj
IHZvaWQgdmNwdV9wZXJpb2RpY190aW1lcl93b3JrKHN0cnVjdCB2Y3B1ICp2KQogICAgIHNldF90
aW1lcigmdi0+cGVyaW9kaWNfdGltZXIsIHBlcmlvZGljX25leHRfZXZlbnQpOwogfQogCi0vKgot
ICogVGhlIG1haW4gZnVuY3Rpb24KLSAqIC0gZGVzY2hlZHVsZSB0aGUgY3VycmVudCBkb21haW4g
KHNjaGVkdWxlciBpbmRlcGVuZGVudCkuCi0gKiAtIHBpY2sgYSBuZXcgZG9tYWluIChzY2hlZHVs
ZXIgZGVwZW5kZW50KS4KLSAqLwotc3RhdGljIHZvaWQgc2NoZWR1bGUodm9pZCkKK3N0YXRpYyB2
b2lkIHNjaGVkX3N3aXRjaF91bml0cyhzdHJ1Y3Qgc2NoZWRfcmVzb3VyY2UgKnNkLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBzY2hlZF91bml0ICpuZXh0LCBzdHJ1Y3Qg
c2NoZWRfdW5pdCAqcHJldiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzX3RpbWVf
dCBub3cpCiB7Ci0gICAgc3RydWN0IHNjaGVkX3VuaXQgICAgKnByZXYgPSBjdXJyZW50LT5zY2hl
ZF91bml0LCAqbmV4dCA9IE5VTEw7Ci0gICAgc190aW1lX3QgICAgICAgICAgICAgIG5vdzsKLSAg
ICBzdHJ1Y3Qgc2NoZWR1bGVyICAgICAqc2NoZWQ7Ci0gICAgdW5zaWduZWQgbG9uZyAgICAgICAg
KnRhc2tsZXRfd29yayA9ICZ0aGlzX2NwdSh0YXNrbGV0X3dvcmtfdG9fZG8pOwotICAgIGJvb2wg
ICAgICAgICAgICAgICAgICB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkID0gZmFsc2U7Ci0gICAgc3Ry
dWN0IHNjaGVkX3Jlc291cmNlICpzZDsKLSAgICBzcGlubG9ja190ICAgICAgICAgICAqbG9jazsK
LSAgICBpbnQgY3B1ID0gc21wX3Byb2Nlc3Nvcl9pZCgpOworICAgIHNkLT5jdXJyID0gbmV4dDsK
IAotICAgIEFTU0VSVF9OT1RfSU5fQVRPTUlDKCk7CisgICAgVFJBQ0VfM0QoVFJDX1NDSEVEX1NX
SVRDSF9JTkZQUkVWLCBwcmV2LT5kb21haW4tPmRvbWFpbl9pZCwgcHJldi0+dW5pdF9pZCwKKyAg
ICAgICAgICAgICBub3cgLSBwcmV2LT5zdGF0ZV9lbnRyeV90aW1lKTsKKyAgICBUUkFDRV80RChU
UkNfU0NIRURfU1dJVENIX0lORk5FWFQsIG5leHQtPmRvbWFpbi0+ZG9tYWluX2lkLCBuZXh0LT51
bml0X2lkLAorICAgICAgICAgICAgIChuZXh0LT52Y3B1LT5ydW5zdGF0ZS5zdGF0ZSA9PSBSVU5T
VEFURV9ydW5uYWJsZSkgPworICAgICAgICAgICAgIChub3cgLSBuZXh0LT5zdGF0ZV9lbnRyeV90
aW1lKSA6IDAsIHByZXYtPm5leHRfdGltZSk7CiAKLSAgICBTQ0hFRF9TVEFUX0NSQU5LKHNjaGVk
X3J1bik7CisgICAgQVNTRVJUKHByZXYtPnZjcHUtPnJ1bnN0YXRlLnN0YXRlID09IFJVTlNUQVRF
X3J1bm5pbmcpOwogCi0gICAgc2QgPSBnZXRfc2NoZWRfcmVzKGNwdSk7CisgICAgVFJBQ0VfNEQo
VFJDX1NDSEVEX1NXSVRDSCwgcHJldi0+ZG9tYWluLT5kb21haW5faWQsIHByZXYtPnVuaXRfaWQs
CisgICAgICAgICAgICAgbmV4dC0+ZG9tYWluLT5kb21haW5faWQsIG5leHQtPnVuaXRfaWQpOwor
CisgICAgc2NoZWRfdW5pdF9ydW5zdGF0ZV9jaGFuZ2UocHJldiwgZmFsc2UsIG5vdyk7CisgICAg
cHJldi0+bGFzdF9ydW5fdGltZSA9IG5vdzsKKworICAgIEFTU0VSVChuZXh0LT52Y3B1LT5ydW5z
dGF0ZS5zdGF0ZSAhPSBSVU5TVEFURV9ydW5uaW5nKTsKKyAgICBzY2hlZF91bml0X3J1bnN0YXRl
X2NoYW5nZShuZXh0LCB0cnVlLCBub3cpOworCisgICAgLyoKKyAgICAgKiBOQi4gRG9uJ3QgYWRk
IGFueSB0cmFjZSByZWNvcmRzIGZyb20gaGVyZSB1bnRpbCB0aGUgYWN0dWFsIGNvbnRleHQKKyAg
ICAgKiBzd2l0Y2gsIGVsc2UgbG9zdF9yZWNvcmRzIHJlc3VtZSB3aWxsIG5vdCB3b3JrIHByb3Bl
cmx5LgorICAgICAqLworCisgICAgQVNTRVJUKCFuZXh0LT5pc19ydW5uaW5nKTsKKyAgICBuZXh0
LT52Y3B1LT5pc19ydW5uaW5nID0gMTsKKyAgICBuZXh0LT5pc19ydW5uaW5nID0gMTsKK30KKwor
c3RhdGljIGJvb2wgc2NoZWRfdGFza2xldF9jaGVja19jcHUodW5zaWduZWQgaW50IGNwdSkKK3sK
KyAgICB1bnNpZ25lZCBsb25nICp0YXNrbGV0X3dvcmsgPSAmcGVyX2NwdSh0YXNrbGV0X3dvcmtf
dG9fZG8sIGNwdSk7CiAKLSAgICAvKiBVcGRhdGUgdGFza2xldCBzY2hlZHVsaW5nIHN0YXR1cy4g
Ki8KICAgICBzd2l0Y2ggKCAqdGFza2xldF93b3JrICkKICAgICB7CiAgICAgY2FzZSBUQVNLTEVU
X2VucXVldWVkOgogICAgICAgICBzZXRfYml0KF9UQVNLTEVUX3NjaGVkdWxlZCwgdGFza2xldF93
b3JrKTsKICAgICAgICAgLyogZmFsbHRocm91Z2ggKi8KICAgICBjYXNlIFRBU0tMRVRfZW5xdWV1
ZWR8VEFTS0xFVF9zY2hlZHVsZWQ6Ci0gICAgICAgIHRhc2tsZXRfd29ya19zY2hlZHVsZWQgPSB0
cnVlOworICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgYnJlYWs7CiAgICAgY2FzZSBUQVNL
TEVUX3NjaGVkdWxlZDoKICAgICAgICAgY2xlYXJfYml0KF9UQVNLTEVUX3NjaGVkdWxlZCwgdGFz
a2xldF93b3JrKTsKKyAgICAgICAgLyogZmFsbHRocm91Z2ggKi8KICAgICBjYXNlIDA6Ci0gICAg
ICAgIC8qdGFza2xldF93b3JrX3NjaGVkdWxlZCA9IGZhbHNlOyovCisgICAgICAgIC8qIHJldHVy
biBmYWxzZTsgKi8KICAgICAgICAgYnJlYWs7CiAgICAgZGVmYXVsdDoKICAgICAgICAgQlVHKCk7
CiAgICAgfQogCi0gICAgbG9jayA9IHBjcHVfc2NoZWR1bGVfbG9ja19pcnEoY3B1KTsKKyAgICBy
ZXR1cm4gZmFsc2U7Cit9CiAKLSAgICBub3cgPSBOT1coKTsKK3N0YXRpYyBib29sIHNjaGVkX3Rh
c2tsZXRfY2hlY2sodW5zaWduZWQgaW50IGNwdSkKK3sKKyAgICBib29sIHRhc2tsZXRfd29ya19z
Y2hlZHVsZWQgPSBmYWxzZTsKKyAgICBjb25zdCBjcHVtYXNrX3QgKm1hc2sgPSBnZXRfc2NoZWRf
cmVzKGNwdSktPmNwdXM7CisgICAgaW50IGNwdV9pdGVyOwogCi0gICAgc3RvcF90aW1lcigmc2Qt
PnNfdGltZXIpOworICAgIGZvcl9lYWNoX2NwdSAoIGNwdV9pdGVyLCBtYXNrICkKKyAgICAgICAg
aWYgKCBzY2hlZF90YXNrbGV0X2NoZWNrX2NwdShjcHVfaXRlcikgKQorICAgICAgICAgICAgdGFz
a2xldF93b3JrX3NjaGVkdWxlZCA9IHRydWU7CisKKyAgICByZXR1cm4gdGFza2xldF93b3JrX3Nj
aGVkdWxlZDsKK30KKworc3RhdGljIHN0cnVjdCBzY2hlZF91bml0ICpkb19zY2hlZHVsZShzdHJ1
Y3Qgc2NoZWRfdW5pdCAqcHJldiwgc190aW1lX3Qgbm93LAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgY3B1KQoreworICAgIHN0cnVjdCBzY2hlZHVs
ZXIgKnNjaGVkID0gcGVyX2NwdShzY2hlZHVsZXIsIGNwdSk7CisgICAgc3RydWN0IHNjaGVkX3Jl
c291cmNlICpzZCA9IGdldF9zY2hlZF9yZXMoY3B1KTsKKyAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCAq
bmV4dDsKIAogICAgIC8qIGdldCBwb2xpY3ktc3BlY2lmaWMgZGVjaXNpb24gb24gc2NoZWR1bGlu
Zy4uLiAqLwotICAgIHNjaGVkID0gdGhpc19jcHUoc2NoZWR1bGVyKTsKLSAgICBzY2hlZC0+ZG9f
c2NoZWR1bGUoc2NoZWQsIHByZXYsIG5vdywgdGFza2xldF93b3JrX3NjaGVkdWxlZCk7CisgICAg
c2NoZWQtPmRvX3NjaGVkdWxlKHNjaGVkLCBwcmV2LCBub3csIHNjaGVkX3Rhc2tsZXRfY2hlY2so
Y3B1KSk7CiAKICAgICBuZXh0ID0gcHJldi0+bmV4dF90YXNrOwogCi0gICAgc2QtPmN1cnIgPSBu
ZXh0OwotCiAgICAgaWYgKCBwcmV2LT5uZXh0X3RpbWUgPj0gMCApIC8qIC12ZSBtZWFucyBubyBs
aW1pdCAqLwogICAgICAgICBzZXRfdGltZXIoJnNkLT5zX3RpbWVyLCBub3cgKyBwcmV2LT5uZXh0
X3RpbWUpOwogCi0gICAgaWYgKCB1bmxpa2VseShwcmV2ID09IG5leHQpICkKKyAgICBpZiAoIGxp
a2VseShwcmV2ICE9IG5leHQpICkKKyAgICAgICAgc2NoZWRfc3dpdGNoX3VuaXRzKHNkLCBuZXh0
LCBwcmV2LCBub3cpOworCisgICAgcmV0dXJuIG5leHQ7Cit9CisKK3N0YXRpYyB2b2lkIGNvbnRl
eHRfc2F2ZWQoc3RydWN0IHZjcHUgKnByZXYpCit7CisgICAgc3RydWN0IHNjaGVkX3VuaXQgKnVu
aXQgPSBwcmV2LT5zY2hlZF91bml0OworCisgICAgdW5pdC0+aXNfcnVubmluZyA9IDA7CisgICAg
dW5pdC0+c3RhdGVfZW50cnlfdGltZSA9IE5PVygpOworCisgICAgLyogQ2hlY2sgZm9yIG1pZ3Jh
dGlvbiByZXF1ZXN0IC9hZnRlci8gY2xlYXJpbmcgcnVubmluZyBmbGFnLiAqLworICAgIHNtcF9t
YigpOworCisgICAgc2NoZWRfY29udGV4dF9zYXZlZCh2Y3B1X3NjaGVkdWxlcihwcmV2KSwgdW5p
dCk7CisKKyAgICBzY2hlZF91bml0X21pZ3JhdGVfZmluaXNoKHVuaXQpOworfQorCisvKgorICog
UmVuZGV6dm91cyBvbiBlbmQgb2YgY29udGV4dCBzd2l0Y2guCisgKiBBcyBubyBsb2NrIGlzIHBy
b3RlY3RpbmcgdGhpcyByZW5kZXp2b3VzIGZ1bmN0aW9uIHdlIG5lZWQgdG8gdXNlIGF0b21pYwor
ICogYWNjZXNzIGZ1bmN0aW9ucyBvbiB0aGUgY291bnRlci4KKyAqIFRoZSBjb3VudGVyIHdpbGwg
YmUgMCBpbiBjYXNlIG5vIHJlbmRlenZvdXMgaXMgbmVlZGVkLiBGb3IgdGhlIHJlbmRlenZvdXMK
KyAqIGNhc2UgaXQgaXMgaW5pdGlhbGlzZWQgdG8gdGhlIG51bWJlciBvZiBjcHVzIHRvIHJlbmRl
enZvdXMgcGx1cyAxLiBFYWNoCisgKiBtZW1iZXIgZW50ZXJpbmcgZGVjcmVtZW50cyB0aGUgY291
bnRlci4gVGhlIGxhc3Qgb25lIHdpbGwgZGVjcmVtZW50IGl0IHRvCisgKiAxIGFuZCBwZXJmb3Jt
IHRoZSBmaW5hbCBuZWVkZWQgYWN0aW9uIGluIHRoYXQgY2FzZSAoY2FsbCBvZiBjb250ZXh0X3Nh
dmVkKCkKKyAqIGlmIHZjcHUgd2FzIHN3aXRjaGVkKSwgYW5kIHRoZW4gc2V0IHRoZSBjb3VudGVy
IHRvIHplcm8uIFRoZSBvdGhlciBtZW1iZXJzCisgKiB3aWxsIHdhaXQgdW50aWwgdGhlIGNvdW50
ZXIgYmVjb21lcyB6ZXJvIHVudGlsIHRoZXkgcHJvY2VlZC4KKyAqLwordm9pZCBzY2hlZF9jb250
ZXh0X3N3aXRjaGVkKHN0cnVjdCB2Y3B1ICp2cHJldiwgc3RydWN0IHZjcHUgKnZuZXh0KQorewor
ICAgIHN0cnVjdCBzY2hlZF91bml0ICpuZXh0ID0gdm5leHQtPnNjaGVkX3VuaXQ7CisKKyAgICAv
KiBDbGVhciBydW5uaW5nIGZsYWcgL2FmdGVyLyB3cml0aW5nIGNvbnRleHQgdG8gbWVtb3J5LiAq
LworICAgIHNtcF93bWIoKTsKKworICAgIHZwcmV2LT5pc19ydW5uaW5nID0gMDsKKworICAgIGlm
ICggYXRvbWljX3JlYWQoJm5leHQtPnJlbmRlenZvdXNfb3V0X2NudCkgKQorICAgIHsKKyAgICAg
ICAgaW50IGNudCA9IGF0b21pY19kZWNfcmV0dXJuKCZuZXh0LT5yZW5kZXp2b3VzX291dF9jbnQp
OworCisgICAgICAgIC8qIENhbGwgY29udGV4dF9zYXZlZCgpIGJlZm9yZSByZWxlYXNpbmcgb3Ro
ZXIgd2FpdGVycy4gKi8KKyAgICAgICAgaWYgKCBjbnQgPT0gMSApCisgICAgICAgIHsKKyAgICAg
ICAgICAgIGlmICggdnByZXYgIT0gdm5leHQgKQorICAgICAgICAgICAgICAgIGNvbnRleHRfc2F2
ZWQodnByZXYpOworICAgICAgICAgICAgYXRvbWljX3NldCgmbmV4dC0+cmVuZGV6dm91c19vdXRf
Y250LCAwKTsKKyAgICAgICAgfQorICAgICAgICBlbHNlCisgICAgICAgICAgICB3aGlsZSAoIGF0
b21pY19yZWFkKCZuZXh0LT5yZW5kZXp2b3VzX291dF9jbnQpICkKKyAgICAgICAgICAgICAgICBj
cHVfcmVsYXgoKTsKKyAgICB9CisgICAgZWxzZSBpZiAoIHZwcmV2ICE9IHZuZXh0ICkKKyAgICAg
ICAgY29udGV4dF9zYXZlZCh2cHJldik7Cit9CisKK3N0YXRpYyB2b2lkIHNjaGVkX2NvbnRleHRf
c3dpdGNoKHN0cnVjdCB2Y3B1ICp2cHJldiwgc3RydWN0IHZjcHUgKnZuZXh0LAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgc190aW1lX3Qgbm93KQoreworICAgIGlmICggdW5saWtl
bHkodnByZXYgPT0gdm5leHQpICkKICAgICB7Ci0gICAgICAgIHBjcHVfc2NoZWR1bGVfdW5sb2Nr
X2lycShsb2NrLCBjcHUpOwogICAgICAgICBUUkFDRV80RChUUkNfU0NIRURfU1dJVENIX0lORkNP
TlQsCi0gICAgICAgICAgICAgICAgIG5leHQtPmRvbWFpbi0+ZG9tYWluX2lkLCBuZXh0LT51bml0
X2lkLAotICAgICAgICAgICAgICAgICBub3cgLSBwcmV2LT5zdGF0ZV9lbnRyeV90aW1lLAotICAg
ICAgICAgICAgICAgICBwcmV2LT5uZXh0X3RpbWUpOwotICAgICAgICB0cmFjZV9jb250aW51ZV9y
dW5uaW5nKG5leHQtPnZjcHUpOwotICAgICAgICByZXR1cm4gY29udGludWVfcnVubmluZyhwcmV2
LT52Y3B1KTsKKyAgICAgICAgICAgICAgICAgdm5leHQtPmRvbWFpbi0+ZG9tYWluX2lkLCB2bmV4
dC0+c2NoZWRfdW5pdC0+dW5pdF9pZCwKKyAgICAgICAgICAgICAgICAgbm93IC0gdnByZXYtPnJ1
bnN0YXRlLnN0YXRlX2VudHJ5X3RpbWUsCisgICAgICAgICAgICAgICAgIHZwcmV2LT5zY2hlZF91
bml0LT5uZXh0X3RpbWUpOworICAgICAgICBzY2hlZF9jb250ZXh0X3N3aXRjaGVkKHZwcmV2LCB2
bmV4dCk7CisgICAgICAgIHRyYWNlX2NvbnRpbnVlX3J1bm5pbmcodm5leHQpOworICAgICAgICBy
ZXR1cm4gY29udGludWVfcnVubmluZyh2cHJldik7CiAgICAgfQogCi0gICAgVFJBQ0VfM0QoVFJD
X1NDSEVEX1NXSVRDSF9JTkZQUkVWLAotICAgICAgICAgICAgIHByZXYtPmRvbWFpbi0+ZG9tYWlu
X2lkLCBwcmV2LT51bml0X2lkLAotICAgICAgICAgICAgIG5vdyAtIHByZXYtPnN0YXRlX2VudHJ5
X3RpbWUpOwotICAgIFRSQUNFXzREKFRSQ19TQ0hFRF9TV0lUQ0hfSU5GTkVYVCwKLSAgICAgICAg
ICAgICBuZXh0LT5kb21haW4tPmRvbWFpbl9pZCwgbmV4dC0+dW5pdF9pZCwKLSAgICAgICAgICAg
ICAobmV4dC0+dmNwdS0+cnVuc3RhdGUuc3RhdGUgPT0gUlVOU1RBVEVfcnVubmFibGUpID8KLSAg
ICAgICAgICAgICAobm93IC0gbmV4dC0+c3RhdGVfZW50cnlfdGltZSkgOiAwLAotICAgICAgICAg
ICAgIHByZXYtPm5leHRfdGltZSk7CisgICAgU0NIRURfU1RBVF9DUkFOSyhzY2hlZF9jdHgpOwog
Ci0gICAgQVNTRVJUKHByZXYtPnZjcHUtPnJ1bnN0YXRlLnN0YXRlID09IFJVTlNUQVRFX3J1bm5p
bmcpOworICAgIHN0b3BfdGltZXIoJnZwcmV2LT5wZXJpb2RpY190aW1lcik7CiAKLSAgICBUUkFD
RV80RChUUkNfU0NIRURfU1dJVENILAotICAgICAgICAgICAgIHByZXYtPmRvbWFpbi0+ZG9tYWlu
X2lkLCBwcmV2LT51bml0X2lkLAotICAgICAgICAgICAgIG5leHQtPmRvbWFpbi0+ZG9tYWluX2lk
LCBuZXh0LT51bml0X2lkKTsKKyAgICBpZiAoIHZuZXh0LT5zY2hlZF91bml0LT5taWdyYXRlZCAp
CisgICAgICAgIHZjcHVfbW92ZV9pcnFzKHZuZXh0KTsKIAotICAgIHNjaGVkX3VuaXRfcnVuc3Rh
dGVfY2hhbmdlKHByZXYsIGZhbHNlLCBub3cpOwotICAgIHByZXYtPmxhc3RfcnVuX3RpbWUgPSBu
b3c7CisgICAgdmNwdV9wZXJpb2RpY190aW1lcl93b3JrKHZuZXh0KTsKIAotICAgIEFTU0VSVChu
ZXh0LT52Y3B1LT5ydW5zdGF0ZS5zdGF0ZSAhPSBSVU5TVEFURV9ydW5uaW5nKTsKLSAgICBzY2hl
ZF91bml0X3J1bnN0YXRlX2NoYW5nZShuZXh0LCB0cnVlLCBub3cpOworICAgIGNvbnRleHRfc3dp
dGNoKHZwcmV2LCB2bmV4dCk7Cit9CiAKLSAgICAvKgotICAgICAqIE5CLiBEb24ndCBhZGQgYW55
IHRyYWNlIHJlY29yZHMgZnJvbSBoZXJlIHVudGlsIHRoZSBhY3R1YWwgY29udGV4dAotICAgICAq
IHN3aXRjaCwgZWxzZSBsb3N0X3JlY29yZHMgcmVzdW1lIHdpbGwgbm90IHdvcmsgcHJvcGVybHku
Ci0gICAgICovCisvKgorICogUmVuZGV6dm91cyBiZWZvcmUgdGFraW5nIGEgc2NoZWR1bGluZyBk
ZWNpc2lvbi4KKyAqIENhbGxlZCB3aXRoIHNjaGVkdWxlIGxvY2sgaGVsZCwgc28gYWxsIGFjY2Vz
c2VzIHRvIHRoZSByZW5kZXp2b3VzIGNvdW50ZXIKKyAqIGNhbiBiZSBub3JtYWwgb25lcyAobm8g
YXRvbWljIGFjY2Vzc2VzIG5lZWRlZCkuCisgKiBUaGUgY291bnRlciBpcyBpbml0aWFsaXplZCB0
byB0aGUgbnVtYmVyIG9mIGNwdXMgdG8gcmVuZGV6dm91cyBpbml0aWFsbHkuCisgKiBFYWNoIGNw
dSBlbnRlcmluZyB3aWxsIGRlY3JlbWVudCB0aGUgY291bnRlci4gSW4gY2FzZSB0aGUgY291bnRl
ciBiZWNvbWVzCisgKiB6ZXJvIGRvX3NjaGVkdWxlKCkgaXMgY2FsbGVkIGFuZCB0aGUgcmVuZGV6
dm91cyBjb3VudGVyIGZvciBsZWF2aW5nCisgKiBjb250ZXh0X3N3aXRjaCgpIGlzIHNldC4gQWxs
IG90aGVyIG1lbWJlcnMgd2lsbCB3YWl0IHVudGlsIHRoZSBjb3VudGVyIGlzCisgKiBiZWNvbWlu
ZyB6ZXJvLCBkcm9wcGluZyB0aGUgc2NoZWR1bGUgbG9jayBpbiBiZXR3ZWVuLgorICovCitzdGF0
aWMgc3RydWN0IHNjaGVkX3VuaXQgKnNjaGVkX3dhaXRfcmVuZGV6dm91c19pbihzdHJ1Y3Qgc2No
ZWRfdW5pdCAqcHJldiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHNwaW5sb2NrX3QgKmxvY2ssIGludCBjcHUsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzX3RpbWVfdCBub3cpCit7CisgICAgc3Ry
dWN0IHNjaGVkX3VuaXQgKm5leHQ7CiAKLSAgICBBU1NFUlQoIW5leHQtPmlzX3J1bm5pbmcpOwot
ICAgIG5leHQtPnZjcHUtPmlzX3J1bm5pbmcgPSAxOwotICAgIG5leHQtPmlzX3J1bm5pbmcgPSAx
OwotICAgIG5leHQtPnN0YXRlX2VudHJ5X3RpbWUgPSBub3c7CisgICAgaWYgKCAhLS1wcmV2LT5y
ZW5kZXp2b3VzX2luX2NudCApCisgICAgeworICAgICAgICBuZXh0ID0gZG9fc2NoZWR1bGUocHJl
diwgbm93LCBjcHUpOworICAgICAgICBhdG9taWNfc2V0KCZuZXh0LT5yZW5kZXp2b3VzX291dF9j
bnQsIHNjaGVkX2dyYW51bGFyaXR5ICsgMSk7CisgICAgICAgIHJldHVybiBuZXh0OworICAgIH0K
IAotICAgIHBjcHVfc2NoZWR1bGVfdW5sb2NrX2lycShsb2NrLCBjcHUpOworICAgIHdoaWxlICgg
cHJldi0+cmVuZGV6dm91c19pbl9jbnQgKQorICAgIHsKKyAgICAgICAgcGNwdV9zY2hlZHVsZV91
bmxvY2tfaXJxKGxvY2ssIGNwdSk7CiAKLSAgICBTQ0hFRF9TVEFUX0NSQU5LKHNjaGVkX2N0eCk7
CisgICAgICAgIC8qIENvbWluZyBmcm9tIGlkbGUgbWlnaHQgbmVlZCB0byBkbyB0YXNrbGV0IHdv
cmsuICovCisgICAgICAgIGlmICggaXNfaWRsZV91bml0KHByZXYpICYmIHNjaGVkX3Rhc2tsZXRf
Y2hlY2tfY3B1KGNwdSkgKQorICAgICAgICAgICAgZG9fdGFza2xldCgpOworICAgICAgICBlbHNl
CisgICAgICAgICAgICBjcHVfcmVsYXgoKTsKKworICAgICAgICBwY3B1X3NjaGVkdWxlX2xvY2tf
aXJxKGNwdSk7CisgICAgfQorCisgICAgcmV0dXJuIHByZXYtPm5leHRfdGFzazsKK30KKworc3Rh
dGljIHZvaWQgc2NoZWRfc2xhdmUodm9pZCkKK3sKKyAgICBzdHJ1Y3QgdmNwdSAgICAgICAgICAq
dnByZXYgPSBjdXJyZW50OworICAgIHN0cnVjdCBzY2hlZF91bml0ICAgICpwcmV2ID0gdnByZXYt
PnNjaGVkX3VuaXQsICpuZXh0OworICAgIHNfdGltZV90ICAgICAgICAgICAgICBub3c7CisgICAg
c3BpbmxvY2tfdCAgICAgICAgICAgKmxvY2s7CisgICAgaW50IGNwdSA9IHNtcF9wcm9jZXNzb3Jf
aWQoKTsKIAotICAgIHN0b3BfdGltZXIoJnByZXYtPnZjcHUtPnBlcmlvZGljX3RpbWVyKTsKKyAg
ICBBU1NFUlRfTk9UX0lOX0FUT01JQygpOworCisgICAgbG9jayA9IHBjcHVfc2NoZWR1bGVfbG9j
a19pcnEoY3B1KTsKKworICAgIG5vdyA9IE5PVygpOworCisgICAgaWYgKCAhcHJldi0+cmVuZGV6
dm91c19pbl9jbnQgKQorICAgIHsKKyAgICAgICAgcGNwdV9zY2hlZHVsZV91bmxvY2tfaXJxKGxv
Y2ssIGNwdSk7CisgICAgICAgIHJldHVybjsKKyAgICB9CiAKLSAgICBpZiAoIG5leHQtPm1pZ3Jh
dGVkICkKLSAgICAgICAgdmNwdV9tb3ZlX2lycXMobmV4dC0+dmNwdSk7CisgICAgc3RvcF90aW1l
cigmZ2V0X3NjaGVkX3JlcyhjcHUpLT5zX3RpbWVyKTsKIAotICAgIHZjcHVfcGVyaW9kaWNfdGlt
ZXJfd29yayhuZXh0LT52Y3B1KTsKKyAgICBuZXh0ID0gc2NoZWRfd2FpdF9yZW5kZXp2b3VzX2lu
KHByZXYsIGxvY2ssIGNwdSwgbm93KTsKIAotICAgIGNvbnRleHRfc3dpdGNoKHByZXYtPnZjcHUs
IG5leHQtPnZjcHUpOworICAgIHBjcHVfc2NoZWR1bGVfdW5sb2NrX2lycShsb2NrLCBjcHUpOwor
CisgICAgc2NoZWRfY29udGV4dF9zd2l0Y2godnByZXYsIG5leHQtPnZjcHUsIG5vdyk7CiB9CiAK
LXZvaWQgY29udGV4dF9zYXZlZChzdHJ1Y3QgdmNwdSAqcHJldikKKy8qCisgKiBUaGUgbWFpbiBm
dW5jdGlvbgorICogLSBkZXNjaGVkdWxlIHRoZSBjdXJyZW50IGRvbWFpbiAoc2NoZWR1bGVyIGlu
ZGVwZW5kZW50KS4KKyAqIC0gcGljayBhIG5ldyBkb21haW4gKHNjaGVkdWxlciBkZXBlbmRlbnQp
LgorICovCitzdGF0aWMgdm9pZCBzY2hlZHVsZSh2b2lkKQogewotICAgIC8qIENsZWFyIHJ1bm5p
bmcgZmxhZyAvYWZ0ZXIvIHdyaXRpbmcgY29udGV4dCB0byBtZW1vcnkuICovCi0gICAgc21wX3dt
YigpOworICAgIHN0cnVjdCB2Y3B1ICAgICAgICAgICp2bmV4dCwgKnZwcmV2ID0gY3VycmVudDsK
KyAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCAgICAqcHJldiA9IHZwcmV2LT5zY2hlZF91bml0LCAqbmV4
dCA9IE5VTEw7CisgICAgc190aW1lX3QgICAgICAgICAgICAgIG5vdzsKKyAgICBzdHJ1Y3Qgc2No
ZWRfcmVzb3VyY2UgKnNkOworICAgIHNwaW5sb2NrX3QgICAgICAgICAgICpsb2NrOworICAgIGlu
dCBjcHUgPSBzbXBfcHJvY2Vzc29yX2lkKCk7CiAKLSAgICBwcmV2LT5pc19ydW5uaW5nID0gMDsK
LSAgICBwcmV2LT5zY2hlZF91bml0LT5pc19ydW5uaW5nID0gMDsKLSAgICBwcmV2LT5zY2hlZF91
bml0LT5zdGF0ZV9lbnRyeV90aW1lID0gTk9XKCk7CisgICAgQVNTRVJUX05PVF9JTl9BVE9NSUMo
KTsKIAotICAgIC8qIENoZWNrIGZvciBtaWdyYXRpb24gcmVxdWVzdCAvYWZ0ZXIvIGNsZWFyaW5n
IHJ1bm5pbmcgZmxhZy4gKi8KLSAgICBzbXBfbWIoKTsKKyAgICBTQ0hFRF9TVEFUX0NSQU5LKHNj
aGVkX3J1bik7CisKKyAgICBzZCA9IGdldF9zY2hlZF9yZXMoY3B1KTsKKworICAgIGxvY2sgPSBw
Y3B1X3NjaGVkdWxlX2xvY2tfaXJxKGNwdSk7CisKKyAgICBpZiAoIHByZXYtPnJlbmRlenZvdXNf
aW5fY250ICkKKyAgICB7CisgICAgICAgIC8qCisgICAgICAgICAqIFdlIGhhdmUgYSByYWNlOiBz
Y2hlZF9zbGF2ZSgpIHNob3VsZCBiZSBjYWxsZWQsIHNvIHJhaXNlIGEgc29mdGlycQorICAgICAg
ICAgKiBpbiBvcmRlciB0byByZS1lbnRlciBzY2hlZHVsZSgpIGxhdGVyIGFuZCBjYWxsIHNjaGVk
X3NsYXZlKCkgbm93LgorICAgICAgICAgKi8KKyAgICAgICAgcGNwdV9zY2hlZHVsZV91bmxvY2tf
aXJxKGxvY2ssIGNwdSk7CisKKyAgICAgICAgcmFpc2Vfc29mdGlycShTQ0hFRFVMRV9TT0ZUSVJR
KTsKKyAgICAgICAgcmV0dXJuIHNjaGVkX3NsYXZlKCk7CisgICAgfQorCisgICAgbm93ID0gTk9X
KCk7CiAKLSAgICBzY2hlZF9jb250ZXh0X3NhdmVkKHZjcHVfc2NoZWR1bGVyKHByZXYpLCBwcmV2
LT5zY2hlZF91bml0KTsKKyAgICBzdG9wX3RpbWVyKCZzZC0+c190aW1lcik7CisKKyAgICBpZiAo
IHNjaGVkX2dyYW51bGFyaXR5ID4gMSApCisgICAgeworICAgICAgICBjcHVtYXNrX3QgbWFzazsK
KworICAgICAgICBwcmV2LT5yZW5kZXp2b3VzX2luX2NudCA9IHNjaGVkX2dyYW51bGFyaXR5Owor
ICAgICAgICBjcHVtYXNrX2FuZG5vdCgmbWFzaywgc2QtPmNwdXMsIGNwdW1hc2tfb2YoY3B1KSk7
CisgICAgICAgIGNwdW1hc2tfcmFpc2Vfc29mdGlycSgmbWFzaywgU0NIRURfU0xBVkVfU09GVElS
USk7CisgICAgICAgIG5leHQgPSBzY2hlZF93YWl0X3JlbmRlenZvdXNfaW4ocHJldiwgbG9jaywg
Y3B1LCBub3cpOworICAgIH0KKyAgICBlbHNlCisgICAgeworICAgICAgICBwcmV2LT5yZW5kZXp2
b3VzX2luX2NudCA9IDA7CisgICAgICAgIG5leHQgPSBkb19zY2hlZHVsZShwcmV2LCBub3csIGNw
dSk7CisgICAgICAgIGF0b21pY19zZXQoJm5leHQtPnJlbmRlenZvdXNfb3V0X2NudCwgMCk7Cisg
ICAgfQorCisgICAgcGNwdV9zY2hlZHVsZV91bmxvY2tfaXJxKGxvY2ssIGNwdSk7CiAKLSAgICBz
Y2hlZF91bml0X21pZ3JhdGVfZmluaXNoKHByZXYtPnNjaGVkX3VuaXQpOworICAgIHZuZXh0ID0g
bmV4dC0+dmNwdTsKKyAgICBzY2hlZF9jb250ZXh0X3N3aXRjaCh2cHJldiwgdm5leHQsIG5vdyk7
CiB9CiAKIC8qIFRoZSBzY2hlZHVsZXIgdGltZXI6IGZvcmNlIGEgcnVuIHRocm91Z2ggdGhlIHNj
aGVkdWxlciAqLwpAQCAtMTc0Myw2ICsxOTE3LDcgQEAgc3RhdGljIGludCBjcHVfc2NoZWR1bGVf
dXAodW5zaWduZWQgaW50IGNwdSkKICAgICBpZiAoIHNkID09IE5VTEwgKQogICAgICAgICByZXR1
cm4gLUVOT01FTTsKICAgICBzZC0+cHJvY2Vzc29yID0gY3B1OworICAgIHNkLT5jcHVzID0gY3B1
bWFza19vZihjcHUpOwogICAgIHNldF9zY2hlZF9yZXMoY3B1LCBzZCk7CiAKICAgICBwZXJfY3B1
KHNjaGVkdWxlciwgY3B1KSA9ICZvcHM7CkBAIC0xOTA1LDYgKzIwODAsNyBAQCB2b2lkIF9faW5p
dCBzY2hlZHVsZXJfaW5pdCh2b2lkKQogICAgIGludCBpOwogCiAgICAgb3Blbl9zb2Z0aXJxKFND
SEVEVUxFX1NPRlRJUlEsIHNjaGVkdWxlKTsKKyAgICBvcGVuX3NvZnRpcnEoU0NIRURfU0xBVkVf
U09GVElSUSwgc2NoZWRfc2xhdmUpOwogCiAgICAgZm9yICggaSA9IDA7IGkgPCBOVU1fU0NIRURV
TEVSUzsgaSsrKQogICAgIHsKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vc29mdGlycS5jIGIveGVu
L2NvbW1vbi9zb2Z0aXJxLmMKaW5kZXggODNjM2MwOWJkNS4uMmQ2NjE5MzIwMyAxMDA2NDQKLS0t
IGEveGVuL2NvbW1vbi9zb2Z0aXJxLmMKKysrIGIveGVuL2NvbW1vbi9zb2Z0aXJxLmMKQEAgLTMz
LDggKzMzLDggQEAgc3RhdGljIHZvaWQgX19kb19zb2Z0aXJxKHVuc2lnbmVkIGxvbmcgaWdub3Jl
X21hc2spCiAgICAgZm9yICggOyA7ICkKICAgICB7CiAgICAgICAgIC8qCi0gICAgICAgICAqIElu
aXRpYWxpc2UgQGNwdSBvbiBldmVyeSBpdGVyYXRpb246IFNDSEVEVUxFX1NPRlRJUlEgbWF5IG1v
dmUKLSAgICAgICAgICogdXMgdG8gYW5vdGhlciBwcm9jZXNzb3IuCisgICAgICAgICAqIEluaXRp
YWxpc2UgQGNwdSBvbiBldmVyeSBpdGVyYXRpb246IFNDSEVEVUxFX1NPRlRJUlEgb3IKKyAgICAg
ICAgICogU0NIRURfU0xBVkVfU09GVElSUSBtYXkgbW92ZSB1cyB0byBhbm90aGVyIHByb2Nlc3Nv
ci4KICAgICAgICAgICovCiAgICAgICAgIGNwdSA9IHNtcF9wcm9jZXNzb3JfaWQoKTsKIApAQCAt
NTUsNyArNTUsNyBAQCB2b2lkIHByb2Nlc3NfcGVuZGluZ19zb2Z0aXJxcyh2b2lkKQogewogICAg
IEFTU0VSVCghaW5faXJxKCkgJiYgbG9jYWxfaXJxX2lzX2VuYWJsZWQoKSk7CiAgICAgLyogRG8g
bm90IGVudGVyIHNjaGVkdWxlciBhcyBpdCBjYW4gcHJlZW1wdCB0aGUgY2FsbGluZyBjb250ZXh0
LiAqLwotICAgIF9fZG9fc29mdGlycSgxdWw8PFNDSEVEVUxFX1NPRlRJUlEpOworICAgIF9fZG9f
c29mdGlycSgoMXVsIDw8IFNDSEVEVUxFX1NPRlRJUlEpIHwgKDF1bCA8PCBTQ0hFRF9TTEFWRV9T
T0ZUSVJRKSk7CiB9CiAKIHZvaWQgZG9fc29mdGlycSh2b2lkKQpkaWZmIC0tZ2l0IGEveGVuL2lu
Y2x1ZGUveGVuL3NjaGVkLWlmLmggYi94ZW4vaW5jbHVkZS94ZW4vc2NoZWQtaWYuaAppbmRleCA3
MTYzZWU4NjliLi5lNjZkODY2ZjQxIDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQt
aWYuaAorKysgYi94ZW4vaW5jbHVkZS94ZW4vc2NoZWQtaWYuaApAQCAtNDEsNiArNDEsNyBAQCBz
dHJ1Y3Qgc2NoZWRfcmVzb3VyY2UgewogICAgIHN0cnVjdCB0aW1lciAgICAgICAgc190aW1lcjsg
ICAgICAgIC8qIHNjaGVkdWxpbmcgdGltZXIgICAgICAgICAgICAgICAgKi8KICAgICBhdG9taWNf
dCAgICAgICAgICAgIHVyZ2VudF9jb3VudDsgICAvKiBob3cgbWFueSB1cmdlbnQgdmNwdXMgICAg
ICAgICAgICovCiAgICAgdW5zaWduZWQgaW50ICAgICAgICBwcm9jZXNzb3I7CisgICAgY29uc3Qg
Y3B1bWFza190ICAgICpjcHVzOyAgICAgICAgICAgLyogY3B1cyBjb3ZlcmVkIGJ5IHRoaXMgc3Ry
dWN0ICAgICAqLwogfTsKIAogI2RlZmluZSBjdXJyX29uX2NwdShjKSAgICAoZ2V0X3NjaGVkX3Jl
cyhjKS0+Y3VycikKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oIGIveGVuL2lu
Y2x1ZGUveGVuL3NjaGVkLmgKaW5kZXggZDAwNDg3MTFjZi4uOWZmOWNiMTQ4ZCAxMDA2NDQKLS0t
IGEveGVuL2luY2x1ZGUveGVuL3NjaGVkLmgKKysrIGIveGVuL2luY2x1ZGUveGVuL3NjaGVkLmgK
QEAgLTI5NSw2ICsyOTUsMTIgQEAgc3RydWN0IHNjaGVkX3VuaXQgewogICAgIC8qIE5leHQgdW5p
dCB0byBydW4uICovCiAgICAgc3RydWN0IHNjaGVkX3VuaXQgICAgICAqbmV4dF90YXNrOwogICAg
IHNfdGltZV90ICAgICAgICAgICAgICAgIG5leHRfdGltZTsKKworICAgIC8qIE51bWJlciBvZiB2
Y3B1cyBub3QgeWV0IGpvaW5lZCBmb3IgY29udGV4dCBzd2l0Y2guICovCisgICAgdW5zaWduZWQg
aW50ICAgICAgICAgICAgcmVuZGV6dm91c19pbl9jbnQ7CisKKyAgICAvKiBOdW1iZXIgb2YgdmNw
dXMgbm90IHlldCBmaW5pc2hlZCB3aXRoIGNvbnRleHQgc3dpdGNoLiAqLworICAgIGF0b21pY190
ICAgICAgICAgICAgICAgIHJlbmRlenZvdXNfb3V0X2NudDsKIH07CiAKICNkZWZpbmUgZm9yX2Vh
Y2hfc2NoZWRfdW5pdChkLCBlKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgXApAQCAtNjk1LDEwICs3MDEsMTAgQEAgdm9pZCBzeW5jX2xvY2FsX2V4ZWNzdGF0ZSh2b2lk
KTsKIAogLyoKICAqIENhbGxlZCBieSB0aGUgc2NoZWR1bGVyIHRvIHN3aXRjaCB0byBhbm90aGVy
IFZDUFUuIFRoaXMgZnVuY3Rpb24gbXVzdAotICogY2FsbCBjb250ZXh0X3NhdmVkKEBwcmV2KSB3
aGVuIHRoZSBsb2NhbCBDUFUgaXMgbm8gbG9uZ2VyIHJ1bm5pbmcgaW4KLSAqIEBwcmV2J3MgY29u
dGV4dCwgYW5kIHRoYXQgY29udGV4dCBpcyBzYXZlZCB0byBtZW1vcnkuIEFsdGVybmF0aXZlbHks
IGlmCi0gKiBpbXBsZW1lbnRpbmcgbGF6eSBjb250ZXh0IHN3aXRjaGluZywgaXQgc3VmZmljZXMg
dG8gZW5zdXJlIHRoYXQgaW52b2tpbmcKLSAqIHN5bmNfdmNwdV9leGVjc3RhdGUoKSB3aWxsIHN3
aXRjaCBhbmQgY29tbWl0IEBwcmV2J3Mgc3RhdGUuCisgKiBjYWxsIHNjaGVkX2NvbnRleHRfc3dp
dGNoZWQoQHByZXYsIEBuZXh0KSB3aGVuIHRoZSBsb2NhbCBDUFUgaXMgbm8gbG9uZ2VyCisgKiBy
dW5uaW5nIGluIEBwcmV2J3MgY29udGV4dCwgYW5kIHRoYXQgY29udGV4dCBpcyBzYXZlZCB0byBt
ZW1vcnkuCisgKiBBbHRlcm5hdGl2ZWx5LCBpZiBpbXBsZW1lbnRpbmcgbGF6eSBjb250ZXh0IHN3
aXRjaGluZywgaXQgc3VmZmljZXMgdG8gZW5zdXJlCisgKiB0aGF0IGludm9raW5nIHN5bmNfdmNw
dV9leGVjc3RhdGUoKSB3aWxsIHN3aXRjaCBhbmQgY29tbWl0IEBwcmV2J3Mgc3RhdGUuCiAgKi8K
IHZvaWQgY29udGV4dF9zd2l0Y2goCiAgICAgc3RydWN0IHZjcHUgKnByZXYsCkBAIC03MTAsNyAr
NzE2LDcgQEAgdm9pZCBjb250ZXh0X3N3aXRjaCgKICAqIHNhdmVkIHRvIG1lbW9yeS4gQWx0ZXJu
YXRpdmVseSwgaWYgaW1wbGVtZW50aW5nIGxhenkgY29udGV4dCBzd2l0Y2hpbmcsCiAgKiBlbnN1
cmUgdGhhdCBpbnZva2luZyBzeW5jX3ZjcHVfZXhlY3N0YXRlKCkgd2lsbCBzd2l0Y2ggYW5kIGNv
bW1pdCBAcHJldi4KICAqLwotdm9pZCBjb250ZXh0X3NhdmVkKHN0cnVjdCB2Y3B1ICpwcmV2KTsK
K3ZvaWQgc2NoZWRfY29udGV4dF9zd2l0Y2hlZChzdHJ1Y3QgdmNwdSAqcHJldiwgc3RydWN0IHZj
cHUgKnZuZXh0KTsKIAogLyogQ2FsbGVkIGJ5IHRoZSBzY2hlZHVsZXIgdG8gY29udGludWUgcnVu
bmluZyB0aGUgY3VycmVudCBWQ1BVLiAqLwogdm9pZCBjb250aW51ZV9ydW5uaW5nKApkaWZmIC0t
Z2l0IGEveGVuL2luY2x1ZGUveGVuL3NvZnRpcnEuaCBiL3hlbi9pbmNsdWRlL3hlbi9zb2Z0aXJx
LmgKaW5kZXggYzMyN2M5YjZjZC4uZDcyNzNiMzg5YiAxMDA2NDQKLS0tIGEveGVuL2luY2x1ZGUv
eGVuL3NvZnRpcnEuaAorKysgYi94ZW4vaW5jbHVkZS94ZW4vc29mdGlycS5oCkBAIC00LDYgKzQs
NyBAQAogLyogTG93LWxhdGVuY3kgc29mdGlycXMgY29tZSBmaXJzdCBpbiB0aGUgZm9sbG93aW5n
IGxpc3QuICovCiBlbnVtIHsKICAgICBUSU1FUl9TT0ZUSVJRID0gMCwKKyAgICBTQ0hFRF9TTEFW
RV9TT0ZUSVJRLAogICAgIFNDSEVEVUxFX1NPRlRJUlEsCiAgICAgTkVXX1RMQkZMVVNIX0NMT0NL
X1BFUklPRF9TT0ZUSVJRLAogICAgIFJDVV9TT0ZUSVJRLAotLSAKMi4xNi40CgoKX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcg
bGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9q
ZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

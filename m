Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 7E6ED17A8E
	for <lists+xen-devel@lfdr.de>; Wed,  8 May 2019 15:26:14 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hOMYU-0000ek-5w; Wed, 08 May 2019 13:24:18 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=6Ps6=TI=citrix.com=prvs=0248bffa7=paul.durrant@srs-us1.protection.inumbo.net>)
 id 1hOMYS-0000dh-5Y
 for xen-devel@lists.xenproject.org; Wed, 08 May 2019 13:24:16 +0000
X-Inumbo-ID: 914338ca-7194-11e9-a4bf-abcea8b8197d
Received: from SMTP03.CITRIX.COM (unknown [162.221.156.55])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 914338ca-7194-11e9-a4bf-abcea8b8197d;
 Wed, 08 May 2019 13:24:11 +0000 (UTC)
X-IronPort-AV: E=Sophos;i="5.60,446,1549929600"; d="scan'208";a="85265425"
From: Paul Durrant <paul.durrant@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Wed, 8 May 2019 14:24:02 +0100
Message-ID: <20190508132403.1454-5-paul.durrant@citrix.com>
X-Mailer: git-send-email 2.11.0
In-Reply-To: <20190508132403.1454-1-paul.durrant@citrix.com>
References: <20190508132403.1454-1-paul.durrant@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH 4/5] iommu: introduce iommu_groups
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wei.liu2@citrix.com>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Paul Durrant <paul.durrant@citrix.com>,
 Jan Beulich <jbeulich@suse.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

U29tZSBkZXZpY2VzIG1heSBzaGFyZSBhIHNpbmdsZSBQQ0llIGluaXRpYXRvciBpZCwgZS5nLiBp
ZiB0aGV5IGFyZSBhY3R1YWxseQpsZWdhY3kgUENJIGRldmljZXMgYmVoaW5kIGEgYnJpZGdlLCBh
bmQgaGVuY2UgRE1BIGZyb20gc3VjaCBkZXZpY2VzIHdpbGwKYmUgc3ViamVjdCB0byB0aGUgc2Ft
ZSBhZGRyZXNzIHRyYW5zbGF0aW9uIGluIHRoZSBJT01NVS4gSGVuY2UgdGhlc2UgZGV2aWNlcwpz
aG91bGQgYmUgdHJlYXRlZCBhcyBhIHVuaXQgZm9yIHRoZSBwdXJwb3NlcyBvZiBhc3NpZ25tZW50
LiBUaGVyZSBhcmUgYWxzbwpvdGhlciByZWFzb25zIHdoeSBtdWx0aXBsZSBkZXZpY2VzIHNob3Vs
ZCBiZSB0cmVhdGVkIGFzIGEgdW5pdCwgZS5nLiB0aG9zZQpzdWJqZWN0IHRvIGEgc2hhcmVkIFJN
UlIgb3IgdGhvc2UgZG93bnN0cmVhbSBvZiBhIGJyaWRnZSB0aGF0IGRvZXMgbm90CnN1cHBvcnQg
QUNTLgoKVGhpcyBwYXRjaCBpbnRyb2R1Y2VzIGEgbmV3IHN0cnVjdCBpb21tdV9ncm91cCB0byBh
Y3QgYXMgYSBjb250YWluZXIgZm9yCmRldmljZXMgdGhhdCBzaG91bGQgYmUgdHJlYXRlZCBhcyBh
IHVuaXQsIGFuZCBidWlsZHMgYSBsaXN0IG9mIHRoZW0gYXMKUENJIGRldmljZXMgYXJlIHNjYW5u
ZWQuIFRoZSBpb21tdV9vcHMgYWxyZWFkeSBpbXBsZW1lbnQgYSBtZXRob2QsCmdldF9kZXZpY2Vf
Z3JvdXBfaWQoKSwgdGhhdCBpcyBzZWVtaW5nbHkgaW50ZW5kZWQgdG8gcmV0dXJuIHRoZSBpbml0
aWF0b3IKaWQgZm9yIGEgZ2l2ZW4gU0JERiBzbyB1c2UgdGhpcyBhcyB0aGUgbWVjaGFuaXNtIGZv
ciBncm91cCBhc3NpZ25tZW50IGluCnRoZSBmaXJzdCBpbnN0YW5jZS4gQXNzaWdubWVudCBiYXNl
ZCBvbiBzaGFyZWQgUk1SUiBvciBsYWNrIG9mIEFDUyB3aWxsIGJlCmRlYWx0IHdpdGggaW4gc3Vi
c2VxdWVudCBwYXRjaGVzLCBhcyB3aWxsIG1vZGlmaWNhdGlvbnMgdG8gdGhlIGRldmljZQphc3Np
Z25tZW50IGNvZGUuCgpTaWduZWQtb2ZmLWJ5OiBQYXVsIER1cnJhbnQgPHBhdWwuZHVycmFudEBj
aXRyaXguY29tPgotLS0KQ2M6IEphbiBCZXVsaWNoIDxqYmV1bGljaEBzdXNlLmNvbT4KQ2M6IEFu
ZHJldyBDb29wZXIgPGFuZHJldy5jb29wZXIzQGNpdHJpeC5jb20+CkNjOiBHZW9yZ2UgRHVubGFw
IDxHZW9yZ2UuRHVubGFwQGV1LmNpdHJpeC5jb20+CkNjOiBJYW4gSmFja3NvbiA8aWFuLmphY2tz
b25AZXUuY2l0cml4LmNvbT4KQ2M6IEp1bGllbiBHcmFsbCA8anVsaWVuLmdyYWxsQGFybS5jb20+
CkNjOiBLb25yYWQgUnplc3p1dGVrIFdpbGsgPGtvbnJhZC53aWxrQG9yYWNsZS5jb20+CkNjOiBT
dGVmYW5vIFN0YWJlbGxpbmkgPHNzdGFiZWxsaW5pQGtlcm5lbC5vcmc+CkNjOiBUaW0gRGVlZ2Fu
IDx0aW1AeGVuLm9yZz4KQ2M6IFdlaSBMaXUgPHdlaS5saXUyQGNpdHJpeC5jb20+Ci0tLQogeGVu
L2RyaXZlcnMvcGFzc3Rocm91Z2gvaW9tbXUuYyB8IDc2ICsrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrCiB4ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9wY2kuYyAgIHwgIDMg
KysKIHhlbi9pbmNsdWRlL3hlbi9pb21tdS5oICAgICAgICAgfCAgNyArKysrCiB4ZW4vaW5jbHVk
ZS94ZW4vcGNpLmggICAgICAgICAgIHwgIDMgKysKIDQgZmlsZXMgY2hhbmdlZCwgODkgaW5zZXJ0
aW9ucygrKQoKZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2lvbW11LmMgYi94
ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9pb21tdS5jCmluZGV4IGQzYTYxOTliNzcuLjExMzE5ZmJh
YWUgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2lvbW11LmMKKysrIGIveGVu
L2RyaXZlcnMvcGFzc3Rocm91Z2gvaW9tbXUuYwpAQCAtNjU1LDYgKzY1NSw4MiBAQCBzdGF0aWMg
dm9pZCBpb21tdV9kdW1wX3AybV90YWJsZSh1bnNpZ25lZCBjaGFyIGtleSkKICAgICB9CiB9CiAK
KyNpZmRlZiBDT05GSUdfSEFTX1BDSQorCitzdHJ1Y3QgaW9tbXVfZ3JvdXAgeworICAgIHVuc2ln
bmVkIGludCBpZDsKKyAgICB1bnNpZ25lZCBpbnQgaW5kZXg7CisgICAgc3RydWN0IGxpc3RfaGVh
ZCBkZXZzX2xpc3Q7Cit9OworCitzdGF0aWMgc3RydWN0IHJhZGl4X3RyZWVfcm9vdCBpb21tdV9n
cm91cHM7CisKK3ZvaWQgX19pbml0IGlvbW11X2dyb3Vwc19pbml0KHZvaWQpCit7CisgICAgcmFk
aXhfdHJlZV9pbml0KCZpb21tdV9ncm91cHMpOworfQorCitzdGF0aWMgc3RydWN0IGlvbW11X2dy
b3VwICphbGxvY19pb21tdV9ncm91cCh1bnNpZ25lZCBpbnQgaWQpCit7CisgICAgc3RydWN0IGlv
bW11X2dyb3VwICpncnA7CisgICAgc3RhdGljIHVuc2lnbmVkIGludCBpbmRleDsKKworICAgIGdy
cCA9IHh6YWxsb2Moc3RydWN0IGlvbW11X2dyb3VwKTsKKyAgICBpZiAoICFncnAgKQorICAgICAg
ICByZXR1cm4gTlVMTDsKKworICAgIGdycC0+aWQgPSBpZDsKKyAgICBncnAtPmluZGV4ID0gaW5k
ZXgrKzsKKyAgICBJTklUX0xJU1RfSEVBRCgmZ3JwLT5kZXZzX2xpc3QpOworCisgICAgaWYgKCBy
YWRpeF90cmVlX2luc2VydCgmaW9tbXVfZ3JvdXBzLCBpZCwgZ3JwKSApCisgICAgeworICAgICAg
ICB4ZnJlZShncnApOworICAgICAgICBncnAgPSBOVUxMOworICAgIH0KKworICAgIHJldHVybiBn
cnA7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgaW9tbXVfZ3JvdXAgKmdldF9pb21tdV9ncm91cCh1bnNp
Z25lZCBpbnQgaWQpCit7CisgICAgc3RydWN0IGlvbW11X2dyb3VwICpncnAgPSByYWRpeF90cmVl
X2xvb2t1cCgmaW9tbXVfZ3JvdXBzLCBpZCk7CisKKyAgICBpZiAoICFncnAgKQorICAgICAgICBn
cnAgPSBhbGxvY19pb21tdV9ncm91cChpZCk7CisKKyAgICByZXR1cm4gZ3JwOworfQorCitpbnQg
aW9tbXVfZ3JvdXBfYXNzaWduKHN0cnVjdCBwY2lfZGV2ICpwZGV2KQoreworICAgIGNvbnN0IHN0
cnVjdCBpb21tdV9vcHMgKm9wczsKKyAgICB1bnNpZ25lZCBpbnQgaWQ7CisgICAgc3RydWN0IGlv
bW11X2dyb3VwICpncnA7CisKKyAgICBvcHMgPSBpb21tdV9nZXRfb3BzKCk7CisgICAgaWYgKCAh
b3BzIHx8ICFvcHMtPmdldF9kZXZpY2VfZ3JvdXBfaWQgKQorICAgICAgICByZXR1cm4gMDsKKwor
ICAgIGlkID0gb3BzLT5nZXRfZGV2aWNlX2dyb3VwX2lkKHBkZXYtPnNlZywgcGRldi0+YnVzLCBw
ZGV2LT5kZXZmbik7CisgICAgZ3JwID0gZ2V0X2lvbW11X2dyb3VwKGlkKTsKKworICAgIGlmICgg
ISBncnAgKQorICAgICAgICByZXR1cm4gLUVOT01FTTsKKworICAgIGlmICggaW9tbXVfdmVyYm9z
ZSApCisgICAgICAgIHByaW50ayhYRU5MT0dfSU5GTyAiQXNzaWduICUwNHg6JTAyeDolMDJ4LiV1
IC0+IElPTU1VIGdyb3VwICV1XG4iLAorICAgICAgICAgICAgICAgcGRldi0+c2VnLCBwZGV2LT5i
dXMsIFBDSV9TTE9UKHBkZXYtPmRldmZuKSwKKyAgICAgICAgICAgICAgIFBDSV9GVU5DKHBkZXYt
PmRldmZuKSwgZ3JwLT5pbmRleCk7CisKKyAgICBsaXN0X2FkZCgmcGRldi0+Z3JwZGV2c19saXN0
LCAmZ3JwLT5kZXZzX2xpc3QpOworICAgIHBkZXYtPmdycCA9IGdycDsKKworICAgIHJldHVybiAw
OworfQorCisjZW5kaWYgLyogQ09ORklHX0hBU19QQ0kgKi8KKwogLyoKICAqIExvY2FsIHZhcmlh
YmxlczoKICAqIG1vZGU6IEMKZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Bj
aS5jIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvcGNpLmMKaW5kZXggODEwOGVkNWY5YS4uNjIx
MDQwOTc0MSAxMDA2NDQKLS0tIGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvcGNpLmMKKysrIGIv
eGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvcGNpLmMKQEAgLTQyNyw2ICs0MjcsNyBAQCBzdGF0aWMg
c3RydWN0IHBjaV9kZXYgKmFsbG9jX3BkZXYoc3RydWN0IHBjaV9zZWcgKnBzZWcsIHU4IGJ1cywg
dTggZGV2Zm4pCiAKICAgICBjaGVja19wZGV2KHBkZXYpOwogICAgIGFwcGx5X3F1aXJrcyhwZGV2
KTsKKyAgICBpb21tdV9ncm91cF9hc3NpZ24ocGRldik7CiAKICAgICByZXR1cm4gcGRldjsKIH0K
QEAgLTEwOTgsNiArMTA5OSw4IEBAIGludCBfX2luaXQgc2Nhbl9wY2lfZGV2aWNlcyh2b2lkKQog
ewogICAgIGludCByZXQ7CiAKKyAgICBpb21tdV9ncm91cHNfaW5pdCgpOworCiAgICAgcGNpZGV2
c19sb2NrKCk7CiAgICAgcmV0ID0gcGNpX3NlZ21lbnRzX2l0ZXJhdGUoX3NjYW5fcGNpX2Rldmlj
ZXMsIE5VTEwpOwogICAgIHBjaWRldnNfdW5sb2NrKCk7CmRpZmYgLS1naXQgYS94ZW4vaW5jbHVk
ZS94ZW4vaW9tbXUuaCBiL3hlbi9pbmNsdWRlL3hlbi9pb21tdS5oCmluZGV4IGIyZDQyOWE2ZWYu
LjZkNmFhMTIzMTQgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL3hlbi9pb21tdS5oCisrKyBiL3hl
bi9pbmNsdWRlL3hlbi9pb21tdS5oCkBAIC0zMTUsNiArMzE1LDEzIEBAIERFQ0xBUkVfUEVSX0NQ
VShib29sX3QsIGlvbW11X2RvbnRfZmx1c2hfaW90bGIpOwogZXh0ZXJuIHN0cnVjdCBzcGlubG9j
ayBpb21tdV9wdF9jbGVhbnVwX2xvY2s7CiBleHRlcm4gc3RydWN0IHBhZ2VfbGlzdF9oZWFkIGlv
bW11X3B0X2NsZWFudXBfbGlzdDsKIAorI2lmZGVmIENPTkZJR19IQVNfUENJCisKK3ZvaWQgaW9t
bXVfZ3JvdXBzX2luaXQodm9pZCk7CitpbnQgaW9tbXVfZ3JvdXBfYXNzaWduKHN0cnVjdCBwY2lf
ZGV2ICpwZGV2KTsKKworI2VuZGlmIC8qIENPTkZJR19IQVNfUENJICovCisKICNlbmRpZiAvKiBf
SU9NTVVfSF8gKi8KIAogLyoKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL3hlbi9wY2kuaCBiL3hl
bi9pbmNsdWRlL3hlbi9wY2kuaAppbmRleCA4YjIxZThkYzg0Li41ZmU3NTI1ZGI2IDEwMDY0NAot
LS0gYS94ZW4vaW5jbHVkZS94ZW4vcGNpLmgKKysrIGIveGVuL2luY2x1ZGUveGVuL3BjaS5oCkBA
IC03NSw2ICs3NSw5IEBAIHN0cnVjdCBwY2lfZGV2IHsKICAgICBzdHJ1Y3QgbGlzdF9oZWFkIGFs
bGRldnNfbGlzdDsKICAgICBzdHJ1Y3QgbGlzdF9oZWFkIGRvbWFpbl9saXN0OwogCisgICAgc3Ry
dWN0IGxpc3RfaGVhZCBncnBkZXZzX2xpc3Q7CisgICAgc3RydWN0IGlvbW11X2dyb3VwICpncnA7
CisKICAgICBzdHJ1Y3QgbGlzdF9oZWFkIG1zaV9saXN0OwogCiAgICAgc3RydWN0IGFyY2hfbXNp
eCAqbXNpeDsKLS0gCjIuMTEuMAoKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnBy
b2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94
ZW4tZGV2ZWw=

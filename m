Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 69617BBA57
	for <lists+xen-devel@lfdr.de>; Mon, 23 Sep 2019 19:21:39 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iCRwf-0006Kc-LB; Mon, 23 Sep 2019 17:16:17 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=Kgmz=XS=virtuozzo.com=vsementsov@srs-us1.protection.inumbo.net>)
 id 1iCR0Q-00010j-4K
 for xen-devel@lists.xenproject.org; Mon, 23 Sep 2019 16:16:06 +0000
X-Inumbo-ID: 70364730-de1d-11e9-978d-bc764e2007e4
Received: from relay.sw.ru (unknown [185.231.240.75])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 70364730-de1d-11e9-978d-bc764e2007e4;
 Mon, 23 Sep 2019 16:16:03 +0000 (UTC)
Received: from [10.94.3.0] (helo=kvm.qa.sw.ru)
 by relay.sw.ru with esmtp (Exim 4.92.2)
 (envelope-from <vsementsov@virtuozzo.com>)
 id 1iCQx0-0001Fp-SR; Mon, 23 Sep 2019 19:12:35 +0300
From: Vladimir Sementsov-Ogievskiy <vsementsov@virtuozzo.com>
To: qemu-devel@nongnu.org
Date: Mon, 23 Sep 2019 19:12:29 +0300
Message-Id: <20190923161231.22028-8-vsementsov@virtuozzo.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190923161231.22028-1-vsementsov@virtuozzo.com>
References: <20190923161231.22028-1-vsementsov@virtuozzo.com>
MIME-Version: 1.0
X-Mailman-Approved-At: Mon, 23 Sep 2019 17:16:12 +0000
Subject: [Xen-devel] [RFC v2 7/9] Use auto-propagated errp
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: stefanha@redhat.com, codyprime@gmail.com, jan.kiszka@siemens.com,
 eblake@redhat.com, berto@igalia.com, zhang.zhanghailiang@huawei.com,
 qemu-block@nongnu.org, arikalo@wavecomp.com, pasic@linux.ibm.com,
 hpoussin@reactos.org, anthony.perard@citrix.com, samuel.thibault@ens-lyon.org,
 philmd@redhat.com, green@moxielogic.com, lvivier@redhat.com,
 ehabkost@redhat.com, xiechanglong.d@gmail.com, pl@kamp.de, dgilbert@redhat.com,
 b.galvani@gmail.com, eric.auger@redhat.com, alex.williamson@redhat.com,
 ronniesahlberg@gmail.com, jsnow@redhat.com, rth@twiddle.net, kwolf@redhat.com,
 vsementsov@virtuozzo.com, andrew@aj.id.au, crwulff@gmail.com,
 sundeep.lkml@gmail.com, michael@walle.cc, qemu-ppc@nongnu.org,
 kbastian@mail.uni-paderborn.de, imammedo@redhat.com, fam@euphon.net,
 peter.maydell@linaro.org, sheepdog@lists.wpkg.org, david@redhat.com,
 palmer@sifive.com, thuth@redhat.com, jcmvbkbc@gmail.com, den@openvz.org,
 hare@suse.com, sstabellini@kernel.org, arei.gonglei@huawei.com,
 marcel.apfelbaum@gmail.com, namei.unix@gmail.com, atar4qemu@gmail.com,
 farman@linux.ibm.com, amit@kernel.org, sw@weilnetz.de, groug@kaod.org,
 qemu-s390x@nongnu.org, qemu-arm@nongnu.org, peter.chubb@nicta.com.au,
 clg@kaod.org, shorne@gmail.com, qemu-riscv@nongnu.org, cohuck@redhat.com,
 amarkovic@wavecomp.com, aurelien@aurel32.net, pburton@wavecomp.com,
 sagark@eecs.berkeley.edu, jasowang@redhat.com, kraxel@redhat.com,
 edgar.iglesias@gmail.com, gxt@mprc.pku.edu.cn, ari@tuxera.com,
 quintela@redhat.com, mdroth@linux.vnet.ibm.com, lersek@redhat.com,
 borntraeger@de.ibm.com, antonynpavlov@gmail.com, dillaman@redhat.com,
 joel@jms.id.au, xen-devel@lists.xenproject.org, integration@gluster.org,
 balrogg@gmail.com, rjones@redhat.com, Andrew.Baumann@microsoft.com,
 mreitz@redhat.com, walling@linux.ibm.com, mst@redhat.com,
 mark.cave-ayland@ilande.co.uk, v.maffione@gmail.com, marex@denx.de,
 armbru@redhat.com, marcandre.lureau@redhat.com, alistair@alistair23.me,
 paul.durrant@citrix.com, pavel.dovgaluk@ispras.ru, g.lettieri@iet.unipi.it,
 rizzo@iet.unipi.it, david@gibson.dropbear.id.au, akrowiak@linux.ibm.com,
 berrange@redhat.com, xiaoguangrong.eric@gmail.com, pmorel@linux.ibm.com,
 wencongyang2@huawei.com, jcd@tribudubois.net, pbonzini@redhat.com,
 stefanb@linux.ibm.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhpcyBjb21taXQgaXMgZ2VuZXJhdGVkIGJ5IGNvbW1hbmQKCmdpdCBncmVwIC1sICdFcnJvciBc
KlwqZXJycCcgfCB3aGlsZSByZWFkIGY7IFwKZG8gc3BhdGNoIC0tc3AtZmlsZSBcCnNjcmlwdHMv
Y29jY2luZWxsZS9hdXRvLXByb3BhZ2F0ZWQtZXJycC5jb2NjaSAtLWluLXBsYWNlICRmOyBkb25l
CgpTaWduZWQtb2ZmLWJ5OiBWbGFkaW1pciBTZW1lbnRzb3YtT2dpZXZza2l5IDx2c2VtZW50c292
QHZpcnR1b3p6by5jb20+Ci0tLQogaW5jbHVkZS9ody9wY2ktaG9zdC9zcGFwci5oICAgICAgICAg
fCAgIDIgKwogdGFyZ2V0L3BwYy9rdm1fcHBjLmggICAgICAgICAgICAgICAgfCAgIDEgKwogdGFy
Z2V0L3MzOTB4L2NwdV9tb2RlbHMuaCAgICAgICAgICAgfCAgIDIgKwogYXVkaW8vYXVkaW8uYyAg
ICAgICAgICAgICAgICAgICAgICAgfCAgMTIgKy0KIGF1dGh6L3BhbWFjY3QuYyAgICAgICAgICAg
ICAgICAgICAgIHwgICAxICsKIGJhY2tlbmRzL2NyeXB0b2Rldi12aG9zdC11c2VyLmMgICAgIHwg
ICA5ICstCiBiYWNrZW5kcy9jcnlwdG9kZXYuYyAgICAgICAgICAgICAgICB8ICAxOSArLS0KIGJh
Y2tlbmRzL2hvc3RtZW0tZmlsZS5jICAgICAgICAgICAgIHwgIDE5ICstLQogYmFja2VuZHMvaG9z
dG1lbS1tZW1mZC5jICAgICAgICAgICAgfCAgMTcgKy0tCiBiYWNrZW5kcy9ob3N0bWVtLmMgICAg
ICAgICAgICAgICAgICB8ICAzOCArKy0tLQogYmFja2VuZHMvcm5nLmMgICAgICAgICAgICAgICAg
ICAgICAgfCAgIDYgKy0KIGJsb2NrLmMgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgMjA4
ICsrKysrKysrKystLS0tLS0tLS0tLS0tLS0tCiBibG9jay9ibGtkZWJ1Zy5jICAgICAgICAgICAg
ICAgICAgICB8ICAzMyArKy0tLQogYmxvY2svYmxrbG9nd3JpdGVzLmMgICAgICAgICAgICAgICAg
fCAgMjEgKy0tCiBibG9jay9ibGtyZXBsYXkuYyAgICAgICAgICAgICAgICAgICB8ICAgNiArLQog
YmxvY2svYmxrdmVyaWZ5LmMgICAgICAgICAgICAgICAgICAgfCAgMTYgKy0KIGJsb2NrL2Jsb2Nr
LWJhY2tlbmQuYyAgICAgICAgICAgICAgIHwgIDE3ICstLQogYmxvY2svY29tbWl0LmMgICAgICAg
ICAgICAgICAgICAgICAgfCAgIDYgKy0KIGJsb2NrL2NyeXB0by5jICAgICAgICAgICAgICAgICAg
ICAgIHwgIDEyICstCiBibG9jay9jdXJsLmMgICAgICAgICAgICAgICAgICAgICAgICB8ICAgNiAr
LQogYmxvY2svZmlsZS1wb3NpeC5jICAgICAgICAgICAgICAgICAgfCAgNzEgKysrKy0tLS0tCiBi
bG9jay9maWxlLXdpbjMyLmMgICAgICAgICAgICAgICAgICB8ICAyNyArKy0tCiBibG9jay9nbHVz
dGVyLmMgICAgICAgICAgICAgICAgICAgICB8ICA2NCArKysrLS0tLQogYmxvY2svaW8uYyAgICAg
ICAgICAgICAgICAgICAgICAgICAgfCAgMTEgKy0KIGJsb2NrL2lzY3NpLmMgICAgICAgICAgICAg
ICAgICAgICAgIHwgIDMzICsrLS0tCiBibG9jay9taXJyb3IuYyAgICAgICAgICAgICAgICAgICAg
ICB8ICAxNyArLS0KIGJsb2NrL25iZC5jICAgICAgICAgICAgICAgICAgICAgICAgIHwgIDQ0ICsr
Ky0tLQogYmxvY2svbmZzLmMgICAgICAgICAgICAgICAgICAgICAgICAgfCAgIDYgKy0KIGJsb2Nr
L252bWUuYyAgICAgICAgICAgICAgICAgICAgICAgIHwgIDE3ICstLQogYmxvY2svcGFyYWxsZWxz
LmMgICAgICAgICAgICAgICAgICAgfCAgMjggKystLQogYmxvY2svcWFwaS5jICAgICAgICAgICAg
ICAgICAgICAgICAgfCAgMjMgKy0tCiBibG9jay9xY293LmMgICAgICAgICAgICAgICAgICAgICAg
ICB8ICAxNSArLQogYmxvY2svcWNvdzItYml0bWFwLmMgICAgICAgICAgICAgICAgfCAgIDYgKy0K
IGJsb2NrL3Fjb3cyLmMgICAgICAgICAgICAgICAgICAgICAgIHwgIDkwICsrKysrLS0tLS0tLQog
YmxvY2svcWVkLmMgICAgICAgICAgICAgICAgICAgICAgICAgfCAgMTYgKy0KIGJsb2NrL3F1b3J1
bS5jICAgICAgICAgICAgICAgICAgICAgIHwgIDIyICsrLQogYmxvY2svcmF3LWZvcm1hdC5jICAg
ICAgICAgICAgICAgICAgfCAgIDYgKy0KIGJsb2NrL3JiZC5jICAgICAgICAgICAgICAgICAgICAg
ICAgIHwgIDI1ICstLS0KIGJsb2NrL3JlcGxpY2F0aW9uLmMgICAgICAgICAgICAgICAgIHwgIDM2
ICsrLS0tCiBibG9jay9zaGVlcGRvZy5jICAgICAgICAgICAgICAgICAgICB8ICA2NiArKysrLS0t
LS0KIGJsb2NrL3NuYXBzaG90LmMgICAgICAgICAgICAgICAgICAgIHwgIDE0ICstCiBibG9jay9z
c2guYyAgICAgICAgICAgICAgICAgICAgICAgICB8ICAxMSArLQogYmxvY2svdGhyb3R0bGUtZ3Jv
dXBzLmMgICAgICAgICAgICAgfCAgMjIgKystCiBibG9jay90aHJvdHRsZS5jICAgICAgICAgICAg
ICAgICAgICB8ICAgNiArLQogYmxvY2svdmRpLmMgICAgICAgICAgICAgICAgICAgICAgICAgfCAg
MTIgKy0KIGJsb2NrL3ZoZHguYyAgICAgICAgICAgICAgICAgICAgICAgIHwgIDIwICstLQogYmxv
Y2svdm1kay5jICAgICAgICAgICAgICAgICAgICAgICAgfCAgMzYgKystLS0KIGJsb2NrL3ZwYy5j
ICAgICAgICAgICAgICAgICAgICAgICAgIHwgIDI1ICsrLS0KIGJsb2NrL3Z2ZmF0LmMgICAgICAg
ICAgICAgICAgICAgICAgIHwgIDExICstCiBibG9jay92eGhzLmMgICAgICAgICAgICAgICAgICAg
ICAgICB8ICAyMiArKy0KIGJsb2NrZGV2LmMgICAgICAgICAgICAgICAgICAgICAgICAgIHwgMjIw
ICsrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLS0KIGJsb2Nram9iLmMgICAgICAgICAgICAgICAg
ICAgICAgICAgIHwgICA3ICstCiBib290ZGV2aWNlLmMgICAgICAgICAgICAgICAgICAgICAgICB8
ICAyOSArKy0tCiBjaGFyZGV2L2NoYXItc29ja2V0LmMgICAgICAgICAgICAgICB8ICAgNiArLQog
Y2hhcmRldi9jaGFyLmMgICAgICAgICAgICAgICAgICAgICAgfCAgMTggKy0tCiBjcnlwdG8vYmxv
Y2stbHVrcy5jICAgICAgICAgICAgICAgICB8ICAzMSArKy0tCiBjcnlwdG8vc2VjcmV0LmMgICAg
ICAgICAgICAgICAgICAgICB8ICAxNiArLQogY3J5cHRvL3Rsc3Nlc3Npb24uYyAgICAgICAgICAg
ICAgICAgfCAgIDYgKy0KIGR1bXAvZHVtcC5jICAgICAgICAgICAgICAgICAgICAgICAgIHwgMTQy
ICsrKysrKystLS0tLS0tLS0tLQogZHVtcC93aW5fZHVtcC5jICAgICAgICAgICAgICAgICAgICAg
fCAgMjcgKystLQogZXhlYy5jICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgMTIgKy0K
IGh3LzlwZnMvOXAtbG9jYWwuYyAgICAgICAgICAgICAgICAgIHwgICA3ICstCiBody9hY3BpL2Nv
cmUuYyAgICAgICAgICAgICAgICAgICAgICB8ICAxNyArLS0KIGh3L2FjcGkvaWNoOS5jICAgICAg
ICAgICAgICAgICAgICAgIHwgIDI3ICsrLS0KIGh3L2FjcGkvbWVtb3J5X2hvdHBsdWcuYyAgICAg
ICAgICAgIHwgICA2ICstCiBody9hcm0vYWxsd2lubmVyLWExMC5jICAgICAgICAgICAgICB8ICAy
NiArKy0tCiBody9hcm0vYXJtdjdtLmMgICAgICAgICAgICAgICAgICAgICB8ICA1MSArKystLS0t
CiBody9hcm0vYmNtMjgzNV9wZXJpcGhlcmFscy5jICAgICAgICB8ICA4NCArKysrKy0tLS0tLQog
aHcvYXJtL2JjbTI4MzYuYyAgICAgICAgICAgICAgICAgICAgfCAgNDAgKystLS0KIGh3L2FybS9k
aWdpYy5jICAgICAgICAgICAgICAgICAgICAgIHwgIDIxICstLQogaHcvYXJtL2ZzbC1pbXgyNS5j
ICAgICAgICAgICAgICAgICAgfCAgNjEgKysrLS0tLS0KIGh3L2FybS9mc2wtaW14MzEuYyAgICAg
ICAgICAgICAgICAgIHwgIDU2ICsrKy0tLS0KIGh3L2FybS9mc2wtaW14Ni5jICAgICAgICAgICAg
ICAgICAgIHwgIDgwICsrKystLS0tLS0KIGh3L2FybS9pbnRlZ3JhdG9yY3AuYyAgICAgICAgICAg
ICAgIHwgICA2ICstCiBody9hcm0vbXNmMi1zb2MuYyAgICAgICAgICAgICAgICAgICB8ICAyMSAr
LS0KIGh3L2FybS9ucmY1MV9zb2MuYyAgICAgICAgICAgICAgICAgIHwgIDQ2ICsrKy0tLQogaHcv
YXJtL3NtbXUtY29tbW9uLmMgICAgICAgICAgICAgICAgfCAgIDYgKy0KIGh3L2FybS9zbW11djMu
YyAgICAgICAgICAgICAgICAgICAgIHwgICA2ICstCiBody9hcm0vc3RtMzJmMjA1X3NvYy5jICAg
ICAgICAgICAgICB8ICAzOCArKy0tLQogaHcvYXJtL3Rvc2EuYyAgICAgICAgICAgICAgICAgICAg
ICAgfCAgIDEgKwogaHcvYXJtL3hsbngtdmVyc2FsLXZpcnQuYyAgICAgICAgICAgfCAgIDYgKy0K
IGh3L2FybS94bG54LXp5bnFtcC5jICAgICAgICAgICAgICAgIHwgIDg0ICsrKysrLS0tLS0tCiBo
dy9hdWRpby9pbnRlbC1oZGEuYyAgICAgICAgICAgICAgICB8ICAxMiArLQogaHcvYmxvY2svZGF0
YXBsYW5lL3hlbi1ibG9jay5jICAgICAgfCAgMTYgKy0KIGh3L2Jsb2NrL2ZkYy5jICAgICAgICAg
ICAgICAgICAgICAgIHwgIDE3ICstLQogaHcvYmxvY2svb25lbmFuZC5jICAgICAgICAgICAgICAg
ICAgfCAgIDYgKy0KIGh3L2Jsb2NrL3BmbGFzaF9jZmkwMS5jICAgICAgICAgICAgIHwgICA2ICst
CiBody9ibG9jay9wZmxhc2hfY2ZpMDIuYyAgICAgICAgICAgICB8ICAgNiArLQogaHcvYmxvY2sv
dmhvc3QtdXNlci1ibGsuYyAgICAgICAgICAgfCAgIDUgKy0KIGh3L2Jsb2NrL3ZpcnRpby1ibGsu
YyAgICAgICAgICAgICAgIHwgICA2ICstCiBody9ibG9jay94ZW4tYmxvY2suYyAgICAgICAgICAg
ICAgICB8IDExNCArKysrKystLS0tLS0tLQogaHcvY2hhci9kZWJ1Z2Nvbi5jICAgICAgICAgICAg
ICAgICAgfCAgIDYgKy0KIGh3L2NoYXIvc2VyaWFsLXBjaS1tdWx0aS5jICAgICAgICAgIHwgICA2
ICstCiBody9jaGFyL3NlcmlhbC1wY2kuYyAgICAgICAgICAgICAgICB8ICAgNiArLQogaHcvY2hh
ci92aXJ0aW8tc2VyaWFsLWJ1cy5jICAgICAgICAgfCAgIDYgKy0KIGh3L2NvcmUvYnVzLmMgICAg
ICAgICAgICAgICAgICAgICAgIHwgIDE0ICstCiBody9jb3JlL21hY2hpbmUuYyAgICAgICAgICAg
ICAgICAgICB8ICAxOCArLS0KIGh3L2NvcmUvbnVtYS5jICAgICAgICAgICAgICAgICAgICAgIHwg
IDQ4ICsrKy0tLQogaHcvY29yZS9xZGV2LXByb3BlcnRpZXMtc3lzdGVtLmMgICAgfCAgMjQgKy0t
CiBody9jb3JlL3FkZXYtcHJvcGVydGllcy5jICAgICAgICAgICB8ICA3OCArKysrLS0tLS0tCiBo
dy9jb3JlL3FkZXYuYyAgICAgICAgICAgICAgICAgICAgICB8ICAzNiArKy0tLQogaHcvY29yZS9z
eXNidXMuYyAgICAgICAgICAgICAgICAgICAgfCAgIDEgKwogaHcvY3B1L2ExNW1wY29yZS5jICAg
ICAgICAgICAgICAgICAgfCAgIDYgKy0KIGh3L2NwdS9hOW1wY29yZS5jICAgICAgICAgICAgICAg
ICAgIHwgIDI2ICsrLS0KIGh3L2NwdS9hcm0xMW1wY29yZS5jICAgICAgICAgICAgICAgIHwgIDIx
ICstLQogaHcvY3B1L2NvcmUuYyAgICAgICAgICAgICAgICAgICAgICAgfCAgMTIgKy0KIGh3L2Nw
dS9yZWFsdmlld19tcGNvcmUuYyAgICAgICAgICAgIHwgIDExICstCiBody9kaXNwbGF5L2JjbTI4
MzVfZmIuYyAgICAgICAgICAgICB8ICAgNSArLQogaHcvZGlzcGxheS9xeGwuYyAgICAgICAgICAg
ICAgICAgICAgfCAgIDYgKy0KIGh3L2Rpc3BsYXkvdmlydGlvLWdwdS1iYXNlLmMgICAgICAgIHwg
ICA2ICstCiBody9kaXNwbGF5L3ZpcnRpby1ncHUtcGNpLmMgICAgICAgICB8ICAgNiArLQogaHcv
ZGlzcGxheS92aXJ0aW8tdmdhLmMgICAgICAgICAgICAgfCAgIDYgKy0KIGh3L2RtYS9iY20yODM1
X2RtYS5jICAgICAgICAgICAgICAgIHwgICA1ICstCiBody9kbWEveGlsaW54X2F4aWRtYS5jICAg
ICAgICAgICAgICB8ICAxNCArLQogaHcvZ3Bpby9hc3BlZWRfZ3Bpby5jICAgICAgICAgICAgICAg
fCAgIDYgKy0KIGh3L2dwaW8vYmNtMjgzNV9ncGlvLmMgICAgICAgICAgICAgIHwgICA5ICstCiBo
dy9pMzg2L2t2bS9hcGljLmMgICAgICAgICAgICAgICAgICB8ICAgMSArCiBody9pMzg2L3BjLmMg
ICAgICAgICAgICAgICAgICAgICAgICB8IDEwOSArKysrKy0tLS0tLS0tLQogaHcvaWRlL3FkZXYu
YyAgICAgICAgICAgICAgICAgICAgICAgfCAgMTUgKy0KIGh3L2lucHV0L3ZpcnRpby1pbnB1dC5j
ICAgICAgICAgICAgIHwgIDEyICstCiBody9pbnRjL2FwaWNfY29tbW9uLmMgICAgICAgICAgICAg
ICB8ICAgNiArLQogaHcvaW50Yy9hcm1fZ2ljLmMgICAgICAgICAgICAgICAgICAgfCAgIDYgKy0K
IGh3L2ludGMvYXJtX2dpY19rdm0uYyAgICAgICAgICAgICAgIHwgIDExICstCiBody9pbnRjL2Fy
bV9naWN2My5jICAgICAgICAgICAgICAgICB8ICAxMSArLQogaHcvaW50Yy9hcm1fZ2ljdjNfaXRz
X2t2bS5jICAgICAgICAgfCAgIDYgKy0KIGh3L2ludGMvYXJtX2dpY3YzX2t2bS5jICAgICAgICAg
ICAgIHwgIDE2ICstCiBody9pbnRjL2FybXY3bV9udmljLmMgICAgICAgICAgICAgICB8ICAxMSAr
LQogaHcvaW50Yy9uaW9zMl9paWMuYyAgICAgICAgICAgICAgICAgfCAgIDUgKy0KIGh3L2ludGMv
cG52X3hpdmUuYyAgICAgICAgICAgICAgICAgIHwgIDE0ICstCiBody9pbnRjL3JlYWx2aWV3X2dp
Yy5jICAgICAgICAgICAgICB8ICAgNiArLQogaHcvaW50Yy9zMzkwX2ZsaWNfa3ZtLmMgICAgICAg
ICAgICAgfCAgMTAgKy0KIGh3L2ludGMvc3BhcHJfeGl2ZS5jICAgICAgICAgICAgICAgIHwgIDEx
ICstCiBody9pbnRjL3NwYXByX3hpdmVfa3ZtLmMgICAgICAgICAgICB8ICA0OSArKystLS0tCiBo
dy9pbnRjL3hpY3MuYyAgICAgICAgICAgICAgICAgICAgICB8ICAzMSArKy0tCiBody9pbnRjL3hp
Y3Nfa3ZtLmMgICAgICAgICAgICAgICAgICB8ICAyOCArKy0tCiBody9pbnRjL3hpY3NfcG52LmMg
ICAgICAgICAgICAgICAgICB8ICAgNiArLQogaHcvaW50Yy94aXZlLmMgICAgICAgICAgICAgICAg
ICAgICAgfCAgMjMgKy0tCiBody9pcGFjay9pcGFjay5jICAgICAgICAgICAgICAgICAgICB8ICAg
NCArLQogaHcvaXNhL3BjODczMTIuYyAgICAgICAgICAgICAgICAgICAgfCAgIDYgKy0KIGh3L21l
bS9tZW1vcnktZGV2aWNlLmMgICAgICAgICAgICAgIHwgIDE5ICstLQogaHcvbWVtL252ZGltbS5j
ICAgICAgICAgICAgICAgICAgICAgfCAgMjMgKystCiBody9tZW0vcGMtZGltbS5jICAgICAgICAg
ICAgICAgICAgICB8ICAyMSArLS0KIGh3L21pY3JvYmxhemUveGxueC16eW5xbXAtcG11LmMgICAg
IHwgIDExICstCiBody9taXBzL2Nwcy5jICAgICAgICAgICAgICAgICAgICAgICB8ICA0NSArKyst
LS0KIGh3L21pc2MvYXJtMTFzY3UuYyAgICAgICAgICAgICAgICAgIHwgICAxICsKIGh3L21pc2Mv
YmNtMjgzNV9tYm94LmMgICAgICAgICAgICAgIHwgICA1ICstCiBody9taXNjL2JjbTI4MzVfcHJv
cGVydHkuYyAgICAgICAgICB8ICAgOSArLQogaHcvbWlzYy9pdnNobWVtLmMgICAgICAgICAgICAg
ICAgICAgfCAgMzMgKystLS0KIGh3L21pc2MvbWFjaW8vbWFjaW8uYyAgICAgICAgICAgICAgIHwg
IDY1ICsrKystLS0tCiBody9taXNjL21wczItc2NjLmMgICAgICAgICAgICAgICAgICB8ICAgMSAr
CiBody9taXNjL3RtcDEwNS5jICAgICAgICAgICAgICAgICAgICB8ICAgNiArLQogaHcvbWlzYy90
bXA0MjEuYyAgICAgICAgICAgICAgICAgICAgfCAgIDYgKy0KIGh3L25ldC9kcDgzOTN4LmMgICAg
ICAgICAgICAgICAgICAgIHwgICA2ICstCiBody9uZXQvZWVwcm8xMDAuYyAgICAgICAgICAgICAg
ICAgICB8ICAgNiArLQogaHcvbmV0L25lMjAwMC1pc2EuYyAgICAgICAgICAgICAgICAgfCAgMTYg
Ky0KIGh3L25ldC94aWxpbnhfYXhpZW5ldC5jICAgICAgICAgICAgIHwgIDE0ICstCiBody9udnJh
bS9md19jZmcuYyAgICAgICAgICAgICAgICAgICB8ICAxMiArLQogaHcvbnZyYW0vbnJmNTFfbnZt
LmMgICAgICAgICAgICAgICAgfCAgIDYgKy0KIGh3L3BjaS1icmlkZ2UvZGVjLmMgICAgICAgICAg
ICAgICAgIHwgICAxICsKIGh3L3BjaS1icmlkZ2UvZ2VuX3BjaWVfcm9vdF9wb3J0LmMgIHwgICA2
ICstCiBody9wY2ktYnJpZGdlL3BjaV9icmlkZ2VfZGV2LmMgICAgICB8ICAxMiArLQogaHcvcGNp
LWJyaWRnZS9wY2lfZXhwYW5kZXJfYnJpZGdlLmMgfCAgIDYgKy0KIGh3L3BjaS1icmlkZ2UvcGNp
ZV9wY2lfYnJpZGdlLmMgICAgIHwgICA3ICstCiBody9wY2ktaG9zdC9waWl4LmMgICAgICAgICAg
ICAgICAgICB8ICAgNiArLQogaHcvcGNpL3BjaS5jICAgICAgICAgICAgICAgICAgICAgICAgfCAg
MTcgKy0tCiBody9wY2kvcGNpZS5jICAgICAgICAgICAgICAgICAgICAgICB8ICAgNiArLQogaHcv
cGNpL3NocGMuYyAgICAgICAgICAgICAgICAgICAgICAgfCAgMTIgKy0KIGh3L3BwYy9lNTAwLmMg
ICAgICAgICAgICAgICAgICAgICAgIHwgICA2ICstCiBody9wcGMvcG52LmMgICAgICAgICAgICAg
ICAgICAgICAgICB8ICA5MiArKysrKy0tLS0tLS0KIGh3L3BwYy9wbnZfY29yZS5jICAgICAgICAg
ICAgICAgICAgIHwgIDIxICstLQogaHcvcHBjL3Budl9scGMuYyAgICAgICAgICAgICAgICAgICAg
fCAgMjIgKy0tCiBody9wcGMvcG52X29jYy5jICAgICAgICAgICAgICAgICAgICB8ICAgNCArLQog
aHcvcHBjL3Budl9wc2kuYyAgICAgICAgICAgICAgICAgICAgfCAgMjEgKy0tCiBody9wcGMvc3Bh
cHIuYyAgICAgICAgICAgICAgICAgICAgICB8IDEyMSArKysrKysrLS0tLS0tLS0KIGh3L3BwYy9z
cGFwcl9jYXBzLmMgICAgICAgICAgICAgICAgIHwgIDUwICsrKy0tLS0KIGh3L3BwYy9zcGFwcl9j
cHVfY29yZS5jICAgICAgICAgICAgIHwgIDMwICsrLS0KIGh3L3BwYy9zcGFwcl9kcmMuYyAgICAg
ICAgICAgICAgICAgIHwgIDQ0ICsrLS0tLQogaHcvcHBjL3NwYXByX2lycS5jICAgICAgICAgICAg
ICAgICAgfCAgOTUgKysrKystLS0tLS0tCiBody9wcGMvc3BhcHJfcGNpLmMgICAgICAgICAgICAg
ICAgICB8ICA4OCArKysrKy0tLS0tLQogaHcvcHBjL3NwYXByX3Zpby5jICAgICAgICAgICAgICAg
ICAgfCAgMTEgKy0KIGh3L3Jpc2N2L3Jpc2N2X2hhcnQuYyAgICAgICAgICAgICAgIHwgICA3ICst
CiBody9yaXNjdi9zaWZpdmVfZS5jICAgICAgICAgICAgICAgICB8ICAgNiArLQogaHcvcmlzY3Yv
c2lmaXZlX3UuYyAgICAgICAgICAgICAgICAgfCAgMTAgKy0KIGh3L3MzOTB4LzMyNzAtY2N3LmMg
ICAgICAgICAgICAgICAgIHwgIDEyICstCiBody9zMzkweC9jc3MtYnJpZGdlLmMgICAgICAgICAg
ICAgICB8ICAgNiArLQogaHcvczM5MHgvY3NzLmMgICAgICAgICAgICAgICAgICAgICAgfCAgIDYg
Ky0KIGh3L3MzOTB4L2lwbC5jICAgICAgICAgICAgICAgICAgICAgIHwgIDIzICsrLQogaHcvczM5
MHgvczM5MC1jY3cuYyAgICAgICAgICAgICAgICAgfCAgMTQgKy0KIGh3L3MzOTB4L3MzOTAtcGNp
LWJ1cy5jICAgICAgICAgICAgIHwgIDM0ICsrLS0tCiBody9zMzkweC9zMzkwLXNrZXlzLmMgICAg
ICAgICAgICAgICB8ICAgNiArLQogaHcvczM5MHgvczM5MC12aXJ0aW8tY2N3LmMgICAgICAgICAg
fCAgMTAgKy0KIGh3L3MzOTB4L3NjbHAuYyAgICAgICAgICAgICAgICAgICAgIHwgIDE0ICstCiBo
dy9zMzkweC90b2Qta3ZtLmMgICAgICAgICAgICAgICAgICB8ICAxMyArLQogaHcvczM5MHgvdmly
dGlvLWNjdy1jcnlwdG8uYyAgICAgICAgfCAgIDYgKy0KIGh3L3MzOTB4L3ZpcnRpby1jY3ctcm5n
LmMgICAgICAgICAgIHwgICA2ICstCiBody9zMzkweC92aXJ0aW8tY2N3LmMgICAgICAgICAgICAg
ICB8ICAxMiArLQogaHcvc2NzaS9lc3AtcGNpLmMgICAgICAgICAgICAgICAgICAgfCAgIDYgKy0K
IGh3L3Njc2kvbWVnYXNhcy5jICAgICAgICAgICAgICAgICAgIHwgIDEwICstCiBody9zY3NpL21w
dHNhcy5jICAgICAgICAgICAgICAgICAgICB8ICAxMiArLQogaHcvc2NzaS9zY3NpLWJ1cy5jICAg
ICAgICAgICAgICAgICAgfCAgMjIgKy0tCiBody9zY3NpL3Njc2ktZGlzay5jICAgICAgICAgICAg
ICAgICB8ICAgNiArLQogaHcvc2NzaS92aG9zdC1zY3NpLmMgICAgICAgICAgICAgICAgfCAgMTEg
Ky0KIGh3L3Njc2kvdmhvc3QtdXNlci1zY3NpLmMgICAgICAgICAgIHwgICA2ICstCiBody9zY3Np
L3ZpcnRpby1zY3NpLmMgICAgICAgICAgICAgICB8ICAgNiArLQogaHcvc2QvbWlsa3ltaXN0LW1l
bWNhcmQuYyAgICAgICAgICAgfCAgMTAgKy0KIGh3L3NkL3NkaGNpLXBjaS5jICAgICAgICAgICAg
ICAgICAgIHwgICA2ICstCiBody9zZC9zZGhjaS5jICAgICAgICAgICAgICAgICAgICAgICB8ICAy
MCArLS0KIGh3L3NkL3NzaS1zZC5jICAgICAgICAgICAgICAgICAgICAgIHwgIDEzICstCiBody9z
bWJpb3Mvc21iaW9zLmMgICAgICAgICAgICAgICAgICB8ICA0MSArKy0tLS0KIGh3L3NwYXJjL3N1
bjRtLmMgICAgICAgICAgICAgICAgICAgIHwgIDE4ICstLQogaHcvc3BhcmM2NC9zdW40dS5jICAg
ICAgICAgICAgICAgICAgfCAgIDYgKy0KIGh3L3RpbWVyL2FzcGVlZF90aW1lci5jICAgICAgICAg
ICAgIHwgICA2ICstCiBody90cG0vdHBtX3V0aWwuYyAgICAgICAgICAgICAgICAgICB8ICAgNiAr
LQogaHcvdXNiL2J1cy5jICAgICAgICAgICAgICAgICAgICAgICAgfCAgMzMgKystLS0KIGh3L3Vz
Yi9kZXYtc2VyaWFsLmMgICAgICAgICAgICAgICAgIHwgICA2ICstCiBody91c2IvZGV2LXNtYXJ0
Y2FyZC1yZWFkZXIuYyAgICAgICB8ICAxMiArLQogaHcvdXNiL2Rldi1zdG9yYWdlLmMgICAgICAg
ICAgICAgICAgfCAgMTYgKy0KIGh3L3VzYi9oY2Qtb2hjaS1wY2kuYyAgICAgICAgICAgICAgIHwg
ICA2ICstCiBody91c2IvaGNkLW9oY2kuYyAgICAgICAgICAgICAgICAgICB8ICAxMiArLQogaHcv
dXNiL2hjZC11aGNpLmMgICAgICAgICAgICAgICAgICAgfCAgIDYgKy0KIGh3L3VzYi9oY2QteGhj
aS5jICAgICAgICAgICAgICAgICAgIHwgIDEyICstCiBody92ZmlvL2FwLmMgICAgICAgICAgICAg
ICAgICAgICAgICB8ICAgNiArLQogaHcvdmZpby9jY3cuYyAgICAgICAgICAgICAgICAgICAgICAg
fCAgMjAgKystCiBody92ZmlvL3BjaS1xdWlya3MuYyAgICAgICAgICAgICAgICB8ICAgNiArLQog
aHcvdmZpby9wY2kuYyAgICAgICAgICAgICAgICAgICAgICAgfCAgMzYgKystLS0KIGh3L3ZpcnRp
by92aXJ0aW8tYmFsbG9vbi5jICAgICAgICAgIHwgIDMzICsrLS0tCiBody92aXJ0aW8vdmlydGlv
LWJ1cy5jICAgICAgICAgICAgICB8ICAxNiArLQogaHcvdmlydGlvL3ZpcnRpby1ybmctcGNpLmMg
ICAgICAgICAgfCAgIDYgKy0KIGh3L3ZpcnRpby92aXJ0aW8tcm5nLmMgICAgICAgICAgICAgIHwg
ICA2ICstCiBody92aXJ0aW8vdmlydGlvLmMgICAgICAgICAgICAgICAgICB8ICAxNyArLS0KIGh3
L3dhdGNoZG9nL3dkdF9hc3BlZWQuYyAgICAgICAgICAgIHwgICA0ICstCiBody94ZW4veGVuLWJh
Y2tlbmQuYyAgICAgICAgICAgICAgICB8ICAgNiArLQogaHcveGVuL3hlbi1idXMuYyAgICAgICAg
ICAgICAgICAgICAgfCAgODUgKysrKystLS0tLS0KIGh3L3hlbi94ZW4taG9zdC1wY2ktZGV2aWNl
LmMgICAgICAgIHwgIDI2ICsrLS0KIGh3L3hlbi94ZW5fcHQuYyAgICAgICAgICAgICAgICAgICAg
IHwgIDI0ICsrLQogaHcveGVuL3hlbl9wdF9jb25maWdfaW5pdC5jICAgICAgICAgfCAgMTkgKyst
CiBpby9kbnMtcmVzb2x2ZXIuYyAgICAgICAgICAgICAgICAgICB8ICAgNiArLQogaW8vbmV0LWxp
c3RlbmVyLmMgICAgICAgICAgICAgICAgICAgfCAgIDYgKy0KIGlvdGhyZWFkLmMgICAgICAgICAg
ICAgICAgICAgICAgICAgIHwgIDI1ICsrLS0KIGpvYi5jICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHwgICA2ICstCiBtZW1vcnkuYyAgICAgICAgICAgICAgICAgICAgICAgICAgICB8ICA1
NCArKystLS0tCiBtZW1vcnlfbWFwcGluZy5jICAgICAgICAgICAgICAgICAgICB8ICAgNiArLQog
bWlncmF0aW9uL2NvbG8uYyAgICAgICAgICAgICAgICAgICAgfCAgMzMgKystLS0KIG1pZ3JhdGlv
bi9taWdyYXRpb24uYyAgICAgICAgICAgICAgIHwgIDM1ICsrLS0tCiBtaWdyYXRpb24vcmFtLmMg
ICAgICAgICAgICAgICAgICAgICB8ICAxMiArLQogbWlncmF0aW9uL3JkbWEuYyAgICAgICAgICAg
ICAgICAgICAgfCAgMTEgKy0KIG1pZ3JhdGlvbi9zb2NrZXQuYyAgICAgICAgICAgICAgICAgIHwg
IDE2ICstCiBtb25pdG9yL21pc2MuYyAgICAgICAgICAgICAgICAgICAgICB8ICAgOCArLQogbW9u
aXRvci9xbXAtY21kcy5jICAgICAgICAgICAgICAgICAgfCAgIDYgKy0KIG5ldC9jYW4vY2FuX2hv
c3QuYyAgICAgICAgICAgICAgICAgIHwgICA2ICstCiBuZXQvZHVtcC5jICAgICAgICAgICAgICAg
ICAgICAgICAgICB8ICAxNCArLQogbmV0L2ZpbHRlci1idWZmZXIuYyAgICAgICAgICAgICAgICAg
fCAgMTQgKy0KIG5ldC9maWx0ZXIuYyAgICAgICAgICAgICAgICAgICAgICAgIHwgICA2ICstCiBu
ZXQvbmV0LmMgICAgICAgICAgICAgICAgICAgICAgICAgICB8ICAzOCArKy0tLQogbmV0L25ldG1h
cC5jICAgICAgICAgICAgICAgICAgICAgICAgfCAgIDYgKy0KIG5ldC9zbGlycC5jICAgICAgICAg
ICAgICAgICAgICAgICAgIHwgICA2ICstCiBuZXQvdGFwLWJzZC5jICAgICAgICAgICAgICAgICAg
ICAgICB8ICAgMSArCiBuZXQvdGFwLXNvbGFyaXMuYyAgICAgICAgICAgICAgICAgICB8ICAgMSAr
CiBuZXQvdGFwLXN0dWIuYyAgICAgICAgICAgICAgICAgICAgICB8ICAgMSArCiBuZXQvdGFwLmMg
ICAgICAgICAgICAgICAgICAgICAgICAgICB8ICA0NCArKy0tLS0KIHFhcGkvb3B0cy12aXNpdG9y
LmMgICAgICAgICAgICAgICAgIHwgICAxICsKIHFhcGkvcWFwaS1kZWFsbG9jLXZpc2l0b3IuYyAg
ICAgICAgIHwgICA3ICsKIHFhcGkvcWFwaS12aXNpdC1jb3JlLmMgICAgICAgICAgICAgIHwgIDUz
ICsrLS0tLS0KIHFhcGkvcW1wLWRpc3BhdGNoLmMgICAgICAgICAgICAgICAgIHwgICA2ICstCiBx
YXBpL3N0cmluZy1pbnB1dC12aXNpdG9yLmMgICAgICAgICB8ICAgNiArLQogcWRldi1tb25pdG9y
LmMgICAgICAgICAgICAgICAgICAgICAgfCAgMzcgKystLS0KIHFnYS9jb21tYW5kcy1wb3NpeC5j
ICAgICAgICAgICAgICAgIHwgMTk3ICsrKysrKysrKystLS0tLS0tLS0tLS0tLS0KIHFnYS9jb21t
YW5kcy13aW4zMi5jICAgICAgICAgICAgICAgIHwgMTI3ICsrKysrKy0tLS0tLS0tLS0KIHFvbS9v
YmplY3QuYyAgICAgICAgICAgICAgICAgICAgICAgIHwgMTg3ICsrKysrKysrKy0tLS0tLS0tLS0t
LS0tCiBxb20vb2JqZWN0X2ludGVyZmFjZXMuYyAgICAgICAgICAgICB8ICAyNiArKy0tCiBxb20v
cW9tLXFvYmplY3QuYyAgICAgICAgICAgICAgICAgICB8ICAgNiArLQogcmVwbGljYXRpb24uYyAg
ICAgICAgICAgICAgICAgICAgICAgfCAgMjQgKy0tCiBzY3NpL3ByLW1hbmFnZXItaGVscGVyLmMg
ICAgICAgICAgICB8ICAgNiArLQogc3R1YnMveGVuLWh2bS5jICAgICAgICAgICAgICAgICAgICAg
fCAgIDIgKwogdGFyZ2V0L2FscGhhL2NwdS5jICAgICAgICAgICAgICAgICAgfCAgIDYgKy0KIHRh
cmdldC9hcm0vY3B1LmMgICAgICAgICAgICAgICAgICAgIHwgICA2ICstCiB0YXJnZXQvYXJtL2Nw
dTY0LmMgICAgICAgICAgICAgICAgICB8ICAxMCArLQogdGFyZ2V0L2NyaXMvY3B1LmMgICAgICAg
ICAgICAgICAgICAgfCAgIDYgKy0KIHRhcmdldC9ocHBhL2NwdS5jICAgICAgICAgICAgICAgICAg
IHwgICA2ICstCiB0YXJnZXQvaTM4Ni9jcHUuYyAgICAgICAgICAgICAgICAgICB8IDEwNyArKysr
KystLS0tLS0tLQogdGFyZ2V0L2xtMzIvY3B1LmMgICAgICAgICAgICAgICAgICAgfCAgIDYgKy0K
IHRhcmdldC9tNjhrL2NwdS5jICAgICAgICAgICAgICAgICAgIHwgICA2ICstCiB0YXJnZXQvbWlj
cm9ibGF6ZS9jcHUuYyAgICAgICAgICAgICB8ICAgNiArLQogdGFyZ2V0L21pcHMvY3B1LmMgICAg
ICAgICAgICAgICAgICAgfCAgIDYgKy0KIHRhcmdldC9tb3hpZS9jcHUuYyAgICAgICAgICAgICAg
ICAgIHwgICA2ICstCiB0YXJnZXQvbmlvczIvY3B1LmMgICAgICAgICAgICAgICAgICB8ICAgNiAr
LQogdGFyZ2V0L29wZW5yaXNjL2NwdS5jICAgICAgICAgICAgICAgfCAgIDYgKy0KIHRhcmdldC9w
cGMvY29tcGF0LmMgICAgICAgICAgICAgICAgIHwgIDE4ICstLQogdGFyZ2V0L3BwYy9rdm0uYyAg
ICAgICAgICAgICAgICAgICAgfCAgIDYgKy0KIHRhcmdldC9wcGMvdHJhbnNsYXRlX2luaXQuaW5j
LmMgICAgIHwgIDIzICstLQogdGFyZ2V0L3Jpc2N2L2NwdS5jICAgICAgICAgICAgICAgICAgfCAg
IDYgKy0KIHRhcmdldC9zMzkweC9jcHUuYyAgICAgICAgICAgICAgICAgIHwgIDI1ICsrLS0KIHRh
cmdldC9zMzkweC9rdm0tc3R1Yi5jICAgICAgICAgICAgIHwgICAxICsKIHRhcmdldC9zaDQvY3B1
LmMgICAgICAgICAgICAgICAgICAgIHwgICA2ICstCiB0YXJnZXQvc3BhcmMvY3B1LmMgICAgICAg
ICAgICAgICAgICB8ICAxMiArLQogdGFyZ2V0L3RpbGVneC9jcHUuYyAgICAgICAgICAgICAgICAg
fCAgIDYgKy0KIHRhcmdldC90cmljb3JlL2NwdS5jICAgICAgICAgICAgICAgIHwgICA2ICstCiB0
YXJnZXQvdW5pY29yZTMyL2NwdS5jICAgICAgICAgICAgICB8ICAgNiArLQogdGFyZ2V0L3h0ZW5z
YS9jcHUuYyAgICAgICAgICAgICAgICAgfCAgIDYgKy0KIHRlc3RzL3Rlc3QtaW1hZ2UtbG9ja2lu
Zy5jICAgICAgICAgIHwgICA2ICstCiB0ZXN0cy90ZXN0LXFtcC1jbWRzLmMgICAgICAgICAgICAg
ICB8ICAgNyArCiB0cG0uYyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8ICAgNiArLQog
dHJhY2UvcW1wLmMgICAgICAgICAgICAgICAgICAgICAgICAgfCAgMTIgKy0KIHVpL2lucHV0LWJh
cnJpZXIuYyAgICAgICAgICAgICAgICAgIHwgICA2ICstCiB1aS9pbnB1dC5jICAgICAgICAgICAg
ICAgICAgICAgICAgICB8ICAxMiArLQogdWkvdm5jLmMgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgfCAgMTcgKy0tCiB1dGlsL21haW4tbG9vcC5jICAgICAgICAgICAgICAgICAgICB8ICAgNCAr
LQogdXRpbC9vc2xpYi1wb3NpeC5jICAgICAgICAgICAgICAgICAgfCAgIDUgKy0KIHV0aWwvcWVt
dS1jb25maWcuYyAgICAgICAgICAgICAgICAgIHwgIDI3ICsrLS0KIHV0aWwvcWVtdS1vcHRpb24u
YyAgICAgICAgICAgICAgICAgIHwgIDUwICsrKy0tLS0KIHV0aWwvcWVtdS1zb2NrZXRzLmMgICAg
ICAgICAgICAgICAgIHwgIDI1ICstLS0KIHZsLmMgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHwgIDEzICstCiAzMTIgZmlsZXMgY2hhbmdlZCwgMjU1MSBpbnNlcnRpb25zKCspLCA0MTk5
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2luY2x1ZGUvaHcvcGNpLWhvc3Qvc3BhcHIuaCBi
L2luY2x1ZGUvaHcvcGNpLWhvc3Qvc3BhcHIuaAppbmRleCBhYmQ4NzYwNWIyLi4zNDk4NjM1MzAy
IDEwMDY0NAotLS0gYS9pbmNsdWRlL2h3L3BjaS1ob3N0L3NwYXByLmgKKysrIGIvaW5jbHVkZS9o
dy9wY2ktaG9zdC9zcGFwci5oCkBAIC0xOTMsNiArMTkzLDcgQEAgc3RhdGljIGlubGluZSB2b2lk
IHNwYXByX3BoYl92ZmlvX3Jlc2V0KERldmljZVN0YXRlICpxZGV2KQogfQogc3RhdGljIGlubGlu
ZSB2b2lkIHNwYXByX3BoYl9udmdwdV9zZXR1cChTcGFwclBoYlN0YXRlICpzcGhiLCBFcnJvciAq
KmVycnApCiB7CisJRVJSUF9GVU5DVElPTl9CRUdJTigpOwogfQogc3RhdGljIGlubGluZSB2b2lk
IHNwYXByX3BoYl9udmdwdV9mcmVlKFNwYXByUGhiU3RhdGUgKnNwaGIpCiB7CkBAIC0yMDAsNiAr
MjAxLDcgQEAgc3RhdGljIGlubGluZSB2b2lkIHNwYXByX3BoYl9udmdwdV9mcmVlKFNwYXByUGhi
U3RhdGUgKnNwaGIpCiBzdGF0aWMgaW5saW5lIHZvaWQgc3BhcHJfcGhiX252Z3B1X3BvcHVsYXRl
X2R0KFNwYXByUGhiU3RhdGUgKnNwaGIsIHZvaWQgKmZkdCwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IGJ1c19vZmYsIEVycm9yICoqZXJycCkKIHsK
KwlFUlJQX0ZVTkNUSU9OX0JFR0lOKCk7CiB9CiBzdGF0aWMgaW5saW5lIHZvaWQgc3BhcHJfcGhi
X252Z3B1X3JhbV9wb3B1bGF0ZV9kdChTcGFwclBoYlN0YXRlICpzcGhiLAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqZmR0KQpkaWZmIC0t
Z2l0IGEvdGFyZ2V0L3BwYy9rdm1fcHBjLmggYi90YXJnZXQvcHBjL2t2bV9wcGMuaAppbmRleCA5
OGJkN2Q1ZGE2Li44MDdjMjQ1ZTkwIDEwMDY0NAotLS0gYS90YXJnZXQvcHBjL2t2bV9wcGMuaAor
KysgYi90YXJnZXQvcHBjL2t2bV9wcGMuaApAQCAtMjU0LDYgKzI1NCw3IEBAIHN0YXRpYyBpbmxp
bmUgYm9vbCBrdm1wcGNfaHB0X25lZWRzX2hvc3RfY29udGlndW91c19wYWdlcyh2b2lkKQogCiBz
dGF0aWMgaW5saW5lIHZvaWQga3ZtX2NoZWNrX21tdShQb3dlclBDQ1BVICpjcHUsIEVycm9yICoq
ZXJycCkKIHsKKwlFUlJQX0ZVTkNUSU9OX0JFR0lOKCk7CiB9CiAKIHN0YXRpYyBpbmxpbmUgYm9v
bCBrdm1wcGNfaGFzX2NhcF9zcGFwcl92ZmlvKHZvaWQpCmRpZmYgLS1naXQgYS90YXJnZXQvczM5
MHgvY3B1X21vZGVscy5oIGIvdGFyZ2V0L3MzOTB4L2NwdV9tb2RlbHMuaAppbmRleCA4OGJkMDFh
NjE2Li41MzI5MDQ1YTcxIDEwMDY0NAotLS0gYS90YXJnZXQvczM5MHgvY3B1X21vZGVscy5oCisr
KyBiL3RhcmdldC9zMzkweC9jcHVfbW9kZWxzLmgKQEAgLTExNCwxMCArMTE0LDEyIEBAIHZvaWQg
a3ZtX3MzOTBfYXBwbHlfY3B1X21vZGVsKGNvbnN0IFMzOTBDUFVNb2RlbCAqbW9kZWwsICBFcnJv
ciAqKmVycnApOwogc3RhdGljIGlubGluZSB2b2lkIGt2bV9zMzkwX2dldF9ob3N0X2NwdV9tb2Rl
bChTMzkwQ1BVTW9kZWwgKm1vZGVsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBFcnJvciAqKmVycnApCiB7CisJRVJSUF9GVU5DVElPTl9CRUdJTigpOwog
fQogc3RhdGljIGlubGluZSB2b2lkIGt2bV9zMzkwX2FwcGx5X2NwdV9tb2RlbChjb25zdCBTMzkw
Q1BVTW9kZWwgKm1vZGVsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBFcnJvciAqKmVycnApCiB7CisJRVJSUF9GVU5DVElPTl9CRUdJTigpOwogfQogc3RhdGlj
IGlubGluZSBib29sIGt2bV9zMzkwX2NwdV9tb2RlbHNfc3VwcG9ydGVkKHZvaWQpCiB7CmRpZmYg
LS1naXQgYS9hdWRpby9hdWRpby5jIGIvYXVkaW8vYXVkaW8uYwppbmRleCBlOTlmY2QwNjk0Li5i
YzVkZDg2NTIyIDEwMDY0NAotLS0gYS9hdWRpby9hdWRpby5jCisrKyBiL2F1ZGlvL2F1ZGlvLmMK
QEAgLTE3MzksMTkgKzE3MzksMTUgQEAgc3RhdGljIHZvaWQgYXVkaW9fdmFsaWRhdGVfcGVyX2Rp
cmVjdGlvbl9vcHRzKAogCiBzdGF0aWMgdm9pZCBhdWRpb192YWxpZGF0ZV9vcHRzKEF1ZGlvZGV2
ICpkZXYsIEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKLQogICAgIGF1
ZGlvX2NyZWF0ZV9wZG9zKGRldik7CiAKLSAgICBhdWRpb192YWxpZGF0ZV9wZXJfZGlyZWN0aW9u
X29wdHMoYXVkaW9fZ2V0X3Bkb19pbihkZXYpLCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7Ci0gICAg
ICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgIGF1ZGlvX3ZhbGlkYXRlX3Blcl9k
aXJlY3Rpb25fb3B0cyhhdWRpb19nZXRfcGRvX2luKGRldiksIGVycnApOworICAgIGlmICgqZXJy
cCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCi0gICAgYXVkaW9fdmFsaWRhdGVfcGVyX2Rp
cmVjdGlvbl9vcHRzKGF1ZGlvX2dldF9wZG9fb3V0KGRldiksICZlcnIpOwotICAgIGlmIChlcnIp
IHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgYXVkaW9fdmFsaWRh
dGVfcGVyX2RpcmVjdGlvbl9vcHRzKGF1ZGlvX2dldF9wZG9fb3V0KGRldiksIGVycnApOworICAg
IGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCmRpZmYgLS1naXQgYS9hdXRo
ei9wYW1hY2N0LmMgYi9hdXRoei9wYW1hY2N0LmMKaW5kZXggYThhZDI1YjZjNy4uYmY5MDNiNjcz
NiAxMDA2NDQKLS0tIGEvYXV0aHovcGFtYWNjdC5jCisrKyBiL2F1dGh6L3BhbWFjY3QuYwpAQCAt
ODQsNiArODQsNyBAQCBxYXV0aHpfcGFtX3Byb3BfZ2V0X3NlcnZpY2UoT2JqZWN0ICpvYmosCiBz
dGF0aWMgdm9pZAogcWF1dGh6X3BhbV9jb21wbGV0ZShVc2VyQ3JlYXRhYmxlICp1YywgRXJyb3Ig
KiplcnJwKQogeworCUVSUlBfRlVOQ1RJT05fQkVHSU4oKTsKIH0KIAogCmRpZmYgLS1naXQgYS9i
YWNrZW5kcy9jcnlwdG9kZXYtdmhvc3QtdXNlci5jIGIvYmFja2VuZHMvY3J5cHRvZGV2LXZob3N0
LXVzZXIuYwppbmRleCBiMzQ0MjgzOTQwLi5kYjMyMzkxZGYwIDEwMDY0NAotLS0gYS9iYWNrZW5k
cy9jcnlwdG9kZXYtdmhvc3QtdXNlci5jCisrKyBiL2JhY2tlbmRzL2NyeXB0b2Rldi12aG9zdC11
c2VyLmMKQEAgLTE3OSwxNSArMTc5LDEzIEBAIHN0YXRpYyB2b2lkIGNyeXB0b2Rldl92aG9zdF91
c2VyX2luaXQoCiB7CiAgICAgaW50IHF1ZXVlcyA9IGJhY2tlbmQtPmNvbmYucGVlcnMucXVldWVz
OwogICAgIHNpemVfdCBpOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIENoYXJk
ZXYgKmNocjsKICAgICBDcnlwdG9EZXZCYWNrZW5kQ2xpZW50ICpjYzsKICAgICBDcnlwdG9EZXZC
YWNrZW5kVmhvc3RVc2VyICpzID0KICAgICAgICAgICAgICAgICAgICAgICBDUllQVE9ERVZfQkFD
S0VORF9WSE9TVF9VU0VSKGJhY2tlbmQpOwogCi0gICAgY2hyID0gY3J5cHRvZGV2X3Zob3N0X2Ns
YWltX2NoYXJkZXYocywgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAg
ICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBjaHIgPSBjcnlwdG9kZXZf
dmhvc3RfY2xhaW1fY2hhcmRldihzLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAg
cmV0dXJuOwogICAgIH0KIApAQCAtMjA0LDggKzIwMiw3IEBAIHN0YXRpYyB2b2lkIGNyeXB0b2Rl
dl92aG9zdF91c2VyX2luaXQoCiAgICAgICAgIGJhY2tlbmQtPmNvbmYucGVlcnMuY2NzW2ldID0g
Y2M7CiAKICAgICAgICAgaWYgKGkgPT0gMCkgewotICAgICAgICAgICAgaWYgKCFxZW11X2Nocl9m
ZV9pbml0KCZzLT5jaHIsIGNociwgJmxvY2FsX2VycikpIHsKLSAgICAgICAgICAgICAgICBlcnJv
cl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgICAgIGlmICghcWVtdV9jaHJf
ZmVfaW5pdCgmcy0+Y2hyLCBjaHIsIGVycnApKSB7CiAgICAgICAgICAgICAgICAgcmV0dXJuOwog
ICAgICAgICAgICAgfQogICAgICAgICB9CmRpZmYgLS1naXQgYS9iYWNrZW5kcy9jcnlwdG9kZXYu
YyBiL2JhY2tlbmRzL2NyeXB0b2Rldi5jCmluZGV4IDNjMDcxZWFiOTUuLmRjZGI4NDgxYjIgMTAw
NjQ0Ci0tLSBhL2JhY2tlbmRzL2NyeXB0b2Rldi5jCisrKyBiL2JhY2tlbmRzL2NyeXB0b2Rldi5j
CkBAIC0xNTQsMjEgKzE1NCwxOCBAQCBjcnlwdG9kZXZfYmFja2VuZF9zZXRfcXVldWVzKE9iamVj
dCAqb2JqLCBWaXNpdG9yICp2LCBjb25zdCBjaGFyICpuYW1lLAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICB2b2lkICpvcGFxdWUsIEVycm9yICoqZXJycCkKIHsKICAgICBDcnlwdG9EZXZC
YWNrZW5kICpiYWNrZW5kID0gQ1JZUFRPREVWX0JBQ0tFTkQob2JqKTsKLSAgICBFcnJvciAqbG9j
YWxfZXJyID0gTlVMTDsKICAgICB1aW50MzJfdCB2YWx1ZTsKIAotICAgIHZpc2l0X3R5cGVfdWlu
dDMyKHYsIG5hbWUsICZ2YWx1ZSwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2Vycikgewot
ICAgICAgICBnb3RvIG91dDsKKyAgICB2aXNpdF90eXBlX3VpbnQzMih2LCBuYW1lLCAmdmFsdWUs
IGVycnApOworICAgIGlmICgqZXJycCkgeworICAgICAgICByZXR1cm47CiAgICAgfQogICAgIGlm
ICghdmFsdWUpIHsKLSAgICAgICAgZXJyb3Jfc2V0ZygmbG9jYWxfZXJyLCAiUHJvcGVydHkgJyVz
LiVzJyBkb2Vzbid0IHRha2UgdmFsdWUgJyUiCisgICAgICAgIGVycm9yX3NldGcoZXJycCwgIlBy
b3BlcnR5ICclcy4lcycgZG9lc24ndCB0YWtlIHZhbHVlICclIgogICAgICAgICAgICAgICAgICAg
IFBSSXUzMiAiJyIsIG9iamVjdF9nZXRfdHlwZW5hbWUob2JqKSwgbmFtZSwgdmFsdWUpOwotICAg
ICAgICBnb3RvIG91dDsKKyAgICAgICAgcmV0dXJuOwogICAgIH0KICAgICBiYWNrZW5kLT5jb25m
LnBlZXJzLnF1ZXVlcyA9IHZhbHVlOwotb3V0OgotICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBs
b2NhbF9lcnIpOwogfQogCiBzdGF0aWMgdm9pZApAQCAtMTc2LDExICsxNzMsMTAgQEAgY3J5cHRv
ZGV2X2JhY2tlbmRfY29tcGxldGUoVXNlckNyZWF0YWJsZSAqdWMsIEVycm9yICoqZXJycCkKIHsK
ICAgICBDcnlwdG9EZXZCYWNrZW5kICpiYWNrZW5kID0gQ1JZUFRPREVWX0JBQ0tFTkQodWMpOwog
ICAgIENyeXB0b0RldkJhY2tlbmRDbGFzcyAqYmMgPSBDUllQVE9ERVZfQkFDS0VORF9HRVRfQ0xB
U1ModWMpOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgaWYgKGJjLT5pbml0
KSB7Ci0gICAgICAgIGJjLT5pbml0KGJhY2tlbmQsICZsb2NhbF9lcnIpOwotICAgICAgICBpZiAo
bG9jYWxfZXJyKSB7CisgICAgICAgIGJjLT5pbml0KGJhY2tlbmQsIGVycnApOworICAgICAgICBp
ZiAoKmVycnApIHsKICAgICAgICAgICAgIGdvdG8gb3V0OwogICAgICAgICB9CiAgICAgfQpAQCAt
MTg4LDcgKzE4NCw2IEBAIGNyeXB0b2Rldl9iYWNrZW5kX2NvbXBsZXRlKFVzZXJDcmVhdGFibGUg
KnVjLCBFcnJvciAqKmVycnApCiAgICAgcmV0dXJuOwogCiBvdXQ6Ci0gICAgZXJyb3JfcHJvcGFn
YXRlKGVycnAsIGxvY2FsX2Vycik7CiB9CiAKIHZvaWQgY3J5cHRvZGV2X2JhY2tlbmRfc2V0X3Vz
ZWQoQ3J5cHRvRGV2QmFja2VuZCAqYmFja2VuZCwgYm9vbCB1c2VkKQpkaWZmIC0tZ2l0IGEvYmFj
a2VuZHMvaG9zdG1lbS1maWxlLmMgYi9iYWNrZW5kcy9ob3N0bWVtLWZpbGUuYwppbmRleCBiZTY0
MDIwNzQ2Li5jNTljOTJhMDMxIDEwMDY0NAotLS0gYS9iYWNrZW5kcy9ob3N0bWVtLWZpbGUuYwor
KysgYi9iYWNrZW5kcy9ob3N0bWVtLWZpbGUuYwpAQCAtMTE4LDIzICsxMTgsMTkgQEAgc3RhdGlj
IHZvaWQgZmlsZV9tZW1vcnlfYmFja2VuZF9zZXRfYWxpZ24oT2JqZWN0ICpvLCBWaXNpdG9yICp2
LAogewogICAgIEhvc3RNZW1vcnlCYWNrZW5kICpiYWNrZW5kID0gTUVNT1JZX0JBQ0tFTkQobyk7
CiAgICAgSG9zdE1lbW9yeUJhY2tlbmRGaWxlICpmYiA9IE1FTU9SWV9CQUNLRU5EX0ZJTEUobyk7
Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgdWludDY0X3QgdmFsOwogCiAgICAg
aWYgKGhvc3RfbWVtb3J5X2JhY2tlbmRfbXJfaW5pdGVkKGJhY2tlbmQpKSB7Ci0gICAgICAgIGVy
cm9yX3NldGcoJmxvY2FsX2VyciwgImNhbm5vdCBjaGFuZ2UgcHJvcGVydHkgJyVzJyBvZiAlcyIs
CisgICAgICAgIGVycm9yX3NldGcoZXJycCwgImNhbm5vdCBjaGFuZ2UgcHJvcGVydHkgJyVzJyBv
ZiAlcyIsCiAgICAgICAgICAgICAgICAgICAgbmFtZSwgb2JqZWN0X2dldF90eXBlbmFtZShvKSk7
Ci0gICAgICAgIGdvdG8gb3V0OworICAgICAgICByZXR1cm47CiAgICAgfQogCi0gICAgdmlzaXRf
dHlwZV9zaXplKHYsIG5hbWUsICZ2YWwsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIp
IHsKLSAgICAgICAgZ290byBvdXQ7CisgICAgdmlzaXRfdHlwZV9zaXplKHYsIG5hbWUsICZ2YWws
IGVycnApOworICAgIGlmICgqZXJycCkgeworICAgICAgICByZXR1cm47CiAgICAgfQogICAgIGZi
LT5hbGlnbiA9IHZhbDsKLQotIG91dDoKLSAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxf
ZXJyKTsKIH0KIAogc3RhdGljIGJvb2wgZmlsZV9tZW1vcnlfYmFja2VuZF9nZXRfcG1lbShPYmpl
Y3QgKm8sIEVycm9yICoqZXJycCkKQEAgLTE1NiwxMyArMTUyLDEwIEBAIHN0YXRpYyB2b2lkIGZp
bGVfbWVtb3J5X2JhY2tlbmRfc2V0X3BtZW0oT2JqZWN0ICpvLCBib29sIHZhbHVlLCBFcnJvciAq
KmVycnApCiAKICNpZm5kZWYgQ09ORklHX0xJQlBNRU0KICAgICBpZiAodmFsdWUpIHsKLSAgICAg
ICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7Ci0KLSAgICAgICAgZXJyb3Jfc2V0ZygmbG9jYWxf
ZXJyLAorICAgICAgICBlcnJvcl9zZXRnKGVycnAsCiAgICAgICAgICAgICAgICAgICAgIkxhY2sg
b2YgbGlicG1lbSBzdXBwb3J0IHdoaWxlIHNldHRpbmcgdGhlICdwbWVtPW9uJyIKICAgICAgICAg
ICAgICAgICAgICAiIG9mICVzLiBXZSBjYW4ndCBlbnN1cmUgZGF0YSBwZXJzaXN0ZW5jZS4iLAog
ICAgICAgICAgICAgICAgICAgIG9iamVjdF9nZXRfdHlwZW5hbWUobykpOwotICAgICAgICBlcnJv
cl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKICAgICAgICAgcmV0dXJuOwogICAgIH0KICNl
bmRpZgpkaWZmIC0tZ2l0IGEvYmFja2VuZHMvaG9zdG1lbS1tZW1mZC5jIGIvYmFja2VuZHMvaG9z
dG1lbS1tZW1mZC5jCmluZGV4IDI2MDcwYjQyNWUuLjJkZTdlODY4N2IgMTAwNjQ0Ci0tLSBhL2Jh
Y2tlbmRzL2hvc3RtZW0tbWVtZmQuYworKysgYi9iYWNrZW5kcy9ob3N0bWVtLW1lbWZkLmMKQEAg
LTc4LDI2ICs3OCwyMyBAQCBtZW1mZF9iYWNrZW5kX3NldF9odWdldGxic2l6ZShPYmplY3QgKm9i
aiwgVmlzaXRvciAqdiwgY29uc3QgY2hhciAqbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHZvaWQgKm9wYXF1ZSwgRXJyb3IgKiplcnJwKQogewogICAgIEhvc3RNZW1vcnlCYWNr
ZW5kTWVtZmQgKm0gPSBNRU1PUllfQkFDS0VORF9NRU1GRChvYmopOwotICAgIEVycm9yICpsb2Nh
bF9lcnIgPSBOVUxMOwogICAgIHVpbnQ2NF90IHZhbHVlOwogCiAgICAgaWYgKGhvc3RfbWVtb3J5
X2JhY2tlbmRfbXJfaW5pdGVkKE1FTU9SWV9CQUNLRU5EKG9iaikpKSB7Ci0gICAgICAgIGVycm9y
X3NldGcoJmxvY2FsX2VyciwgImNhbm5vdCBjaGFuZ2UgcHJvcGVydHkgdmFsdWUiKTsKLSAgICAg
ICAgZ290byBvdXQ7CisgICAgICAgIGVycm9yX3NldGcoZXJycCwgImNhbm5vdCBjaGFuZ2UgcHJv
cGVydHkgdmFsdWUiKTsKKyAgICAgICAgcmV0dXJuOwogICAgIH0KIAotICAgIHZpc2l0X3R5cGVf
c2l6ZSh2LCBuYW1lLCAmdmFsdWUsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsK
LSAgICAgICAgZ290byBvdXQ7CisgICAgdmlzaXRfdHlwZV9zaXplKHYsIG5hbWUsICZ2YWx1ZSwg
ZXJycCk7CisgICAgaWYgKCplcnJwKSB7CisgICAgICAgIHJldHVybjsKICAgICB9CiAgICAgaWYg
KCF2YWx1ZSkgewotICAgICAgICBlcnJvcl9zZXRnKCZsb2NhbF9lcnIsICJQcm9wZXJ0eSAnJXMu
JXMnIGRvZXNuJ3QgdGFrZSB2YWx1ZSAnJSIKKyAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAiUHJv
cGVydHkgJyVzLiVzJyBkb2Vzbid0IHRha2UgdmFsdWUgJyUiCiAgICAgICAgICAgICAgICAgICAg
UFJJdTY0ICInIiwgb2JqZWN0X2dldF90eXBlbmFtZShvYmopLCBuYW1lLCB2YWx1ZSk7Ci0gICAg
ICAgIGdvdG8gb3V0OworICAgICAgICByZXR1cm47CiAgICAgfQogICAgIG0tPmh1Z2V0bGJzaXpl
ID0gdmFsdWU7Ci1vdXQ6Ci0gICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CiB9
CiAKIHN0YXRpYyB2b2lkCmRpZmYgLS1naXQgYS9iYWNrZW5kcy9ob3N0bWVtLmMgYi9iYWNrZW5k
cy9ob3N0bWVtLmMKaW5kZXggNmQzMzNkYzIzYy4uNDdmZjA4ZTc3MCAxMDA2NDQKLS0tIGEvYmFj
a2VuZHMvaG9zdG1lbS5jCisrKyBiL2JhY2tlbmRzL2hvc3RtZW0uYwpAQCAtNTQsMjggKzU0LDI1
IEBAIGhvc3RfbWVtb3J5X2JhY2tlbmRfc2V0X3NpemUoT2JqZWN0ICpvYmosIFZpc2l0b3IgKnYs
IGNvbnN0IGNoYXIgKm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgKm9w
YXF1ZSwgRXJyb3IgKiplcnJwKQogewogICAgIEhvc3RNZW1vcnlCYWNrZW5kICpiYWNrZW5kID0g
TUVNT1JZX0JBQ0tFTkQob2JqKTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICB1
aW50NjRfdCB2YWx1ZTsKIAogICAgIGlmIChob3N0X21lbW9yeV9iYWNrZW5kX21yX2luaXRlZChi
YWNrZW5kKSkgewotICAgICAgICBlcnJvcl9zZXRnKCZsb2NhbF9lcnIsICJjYW5ub3QgY2hhbmdl
IHByb3BlcnR5ICVzIG9mICVzICIsCisgICAgICAgIGVycm9yX3NldGcoZXJycCwgImNhbm5vdCBj
aGFuZ2UgcHJvcGVydHkgJXMgb2YgJXMgIiwKICAgICAgICAgICAgICAgICAgICBuYW1lLCBvYmpl
Y3RfZ2V0X3R5cGVuYW1lKG9iaikpOwotICAgICAgICBnb3RvIG91dDsKKyAgICAgICAgcmV0dXJu
OwogICAgIH0KIAotICAgIHZpc2l0X3R5cGVfc2l6ZSh2LCBuYW1lLCAmdmFsdWUsICZsb2NhbF9l
cnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZ290byBvdXQ7CisgICAgdmlzaXRf
dHlwZV9zaXplKHYsIG5hbWUsICZ2YWx1ZSwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CisgICAg
ICAgIHJldHVybjsKICAgICB9CiAgICAgaWYgKCF2YWx1ZSkgewotICAgICAgICBlcnJvcl9zZXRn
KCZsb2NhbF9lcnIsCisgICAgICAgIGVycm9yX3NldGcoZXJycCwKICAgICAgICAgICAgICAgICAg
ICAicHJvcGVydHkgJyVzJyBvZiAlcyBkb2Vzbid0IHRha2UgdmFsdWUgJyUiIFBSSXU2NCAiJyIs
CiAgICAgICAgICAgICAgICAgICAgbmFtZSwgb2JqZWN0X2dldF90eXBlbmFtZShvYmopLCB2YWx1
ZSk7Ci0gICAgICAgIGdvdG8gb3V0OworICAgICAgICByZXR1cm47CiAgICAgfQogICAgIGJhY2tl
bmQtPnNpemUgPSB2YWx1ZTsKLW91dDoKLSAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxf
ZXJyKTsKIH0KIAogc3RhdGljIHZvaWQKQEAgLTIyMSw3ICsyMTgsNiBAQCBzdGF0aWMgYm9vbCBo
b3N0X21lbW9yeV9iYWNrZW5kX2dldF9wcmVhbGxvYyhPYmplY3QgKm9iaiwgRXJyb3IgKiplcnJw
KQogc3RhdGljIHZvaWQgaG9zdF9tZW1vcnlfYmFja2VuZF9zZXRfcHJlYWxsb2MoT2JqZWN0ICpv
YmosIGJvb2wgdmFsdWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAg
SG9zdE1lbW9yeUJhY2tlbmQgKmJhY2tlbmQgPSBNRU1PUllfQkFDS0VORChvYmopOwogICAgIE1h
Y2hpbmVTdGF0ZSAqbXMgPSBNQUNISU5FKHFkZXZfZ2V0X21hY2hpbmUoKSk7CiAKQEAgLTI0Myw5
ICsyMzksOCBAQCBzdGF0aWMgdm9pZCBob3N0X21lbW9yeV9iYWNrZW5kX3NldF9wcmVhbGxvYyhP
YmplY3QgKm9iaiwgYm9vbCB2YWx1ZSwKICAgICAgICAgdm9pZCAqcHRyID0gbWVtb3J5X3JlZ2lv
bl9nZXRfcmFtX3B0cigmYmFja2VuZC0+bXIpOwogICAgICAgICB1aW50NjRfdCBzeiA9IG1lbW9y
eV9yZWdpb25fc2l6ZSgmYmFja2VuZC0+bXIpOwogCi0gICAgICAgIG9zX21lbV9wcmVhbGxvYyhm
ZCwgcHRyLCBzeiwgbXMtPnNtcC5jcHVzLCAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYgKGxvY2Fs
X2VycikgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7Cisg
ICAgICAgIG9zX21lbV9wcmVhbGxvYyhmZCwgcHRyLCBzeiwgbXMtPnNtcC5jcHVzLCBlcnJwKTsK
KyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgIH0KICAg
ICAgICAgYmFja2VuZC0+cHJlYWxsb2MgPSB0cnVlOwpAQCAtMzE0LDE0ICszMDksMTMgQEAgaG9z
dF9tZW1vcnlfYmFja2VuZF9tZW1vcnlfY29tcGxldGUoVXNlckNyZWF0YWJsZSAqdWMsIEVycm9y
ICoqZXJycCkKICAgICBIb3N0TWVtb3J5QmFja2VuZCAqYmFja2VuZCA9IE1FTU9SWV9CQUNLRU5E
KHVjKTsKICAgICBIb3N0TWVtb3J5QmFja2VuZENsYXNzICpiYyA9IE1FTU9SWV9CQUNLRU5EX0dF
VF9DTEFTUyh1Yyk7CiAgICAgTWFjaGluZVN0YXRlICptcyA9IE1BQ0hJTkUocWRldl9nZXRfbWFj
aGluZSgpKTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICB2b2lkICpwdHI7CiAg
ICAgdWludDY0X3Qgc3o7CiAKICAgICBpZiAoYmMtPmFsbG9jKSB7Ci0gICAgICAgIGJjLT5hbGxv
YyhiYWNrZW5kLCAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAgICAg
ICAgICAgZ290byBvdXQ7CisgICAgICAgIGJjLT5hbGxvYyhiYWNrZW5kLCBlcnJwKTsKKyAgICAg
ICAgaWYgKCplcnJwKSB7CisgICAgICAgICAgICByZXR1cm47CiAgICAgICAgIH0KIAogICAgICAg
ICBwdHIgPSBtZW1vcnlfcmVnaW9uX2dldF9yYW1fcHRyKCZiYWNrZW5kLT5tcik7CkBAIC0zNzgs
MTQgKzM3MiwxMiBAQCBob3N0X21lbW9yeV9iYWNrZW5kX21lbW9yeV9jb21wbGV0ZShVc2VyQ3Jl
YXRhYmxlICp1YywgRXJyb3IgKiplcnJwKQogICAgICAgICAgKi8KICAgICAgICAgaWYgKGJhY2tl
bmQtPnByZWFsbG9jKSB7CiAgICAgICAgICAgICBvc19tZW1fcHJlYWxsb2MobWVtb3J5X3JlZ2lv
bl9nZXRfZmQoJmJhY2tlbmQtPm1yKSwgcHRyLCBzeiwKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBtcy0+c21wLmNwdXMsICZsb2NhbF9lcnIpOwotICAgICAgICAgICAgaWYgKGxvY2FsX2Vy
cikgewotICAgICAgICAgICAgICAgIGdvdG8gb3V0OworICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIG1zLT5zbXAuY3B1cywgZXJycCk7CisgICAgICAgICAgICBpZiAoKmVycnApIHsKKyAgICAg
ICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICB9CiAgICAgICAgIH0KICAgICB9Ci1vdXQ6
Ci0gICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CiB9CiAKIHN0YXRpYyBib29s
CmRpZmYgLS1naXQgYS9iYWNrZW5kcy9ybmcuYyBiL2JhY2tlbmRzL3JuZy5jCmluZGV4IDM5MTg4
OGI4YjMuLjc2ZTgwOTdhNjYgMTAwNjQ0Ci0tLSBhL2JhY2tlbmRzL3JuZy5jCisrKyBiL2JhY2tl
bmRzL3JuZy5jCkBAIC01NSw3ICs1NSw2IEBAIHN0YXRpYyB2b2lkIHJuZ19iYWNrZW5kX3Byb3Bf
c2V0X29wZW5lZChPYmplY3QgKm9iaiwgYm9vbCB2YWx1ZSwgRXJyb3IgKiplcnJwKQogewogICAg
IFJuZ0JhY2tlbmQgKnMgPSBSTkdfQkFDS0VORChvYmopOwogICAgIFJuZ0JhY2tlbmRDbGFzcyAq
ayA9IFJOR19CQUNLRU5EX0dFVF9DTEFTUyhzKTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVM
TDsKIAogICAgIGlmICh2YWx1ZSA9PSBzLT5vcGVuZWQpIHsKICAgICAgICAgcmV0dXJuOwpAQCAt
NjcsOSArNjYsOCBAQCBzdGF0aWMgdm9pZCBybmdfYmFja2VuZF9wcm9wX3NldF9vcGVuZWQoT2Jq
ZWN0ICpvYmosIGJvb2wgdmFsdWUsIEVycm9yICoqZXJycCkKICAgICB9CiAKICAgICBpZiAoay0+
b3BlbmVkKSB7Ci0gICAgICAgIGstPm9wZW5lZChzLCAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYg
KGxvY2FsX2VycikgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vy
cik7CisgICAgICAgIGstPm9wZW5lZChzLCBlcnJwKTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAg
ICAgICAgICAgICByZXR1cm47CiAgICAgICAgIH0KICAgICB9CmRpZmYgLS1naXQgYS9ibG9jay5j
IGIvYmxvY2suYwppbmRleCA1OTQ0MTI0ODQ1Li5mMjlmZDZjMTI4IDEwMDY0NAotLS0gYS9ibG9j
ay5jCisrKyBiL2Jsb2NrLmMKQEAgLTUzNSw3ICs1MzUsNiBAQCBvdXQ6CiBpbnQgYmRydl9jcmVh
dGVfZmlsZShjb25zdCBjaGFyICpmaWxlbmFtZSwgUWVtdU9wdHMgKm9wdHMsIEVycm9yICoqZXJy
cCkKIHsKICAgICBCbG9ja0RyaXZlciAqZHJ2OwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxM
OwogICAgIGludCByZXQ7CiAKICAgICBkcnYgPSBiZHJ2X2ZpbmRfcHJvdG9jb2woZmlsZW5hbWUs
IHRydWUsIGVycnApOwpAQCAtNTQzLDggKzU0Miw3IEBAIGludCBiZHJ2X2NyZWF0ZV9maWxlKGNv
bnN0IGNoYXIgKmZpbGVuYW1lLCBRZW11T3B0cyAqb3B0cywgRXJyb3IgKiplcnJwKQogICAgICAg
ICByZXR1cm4gLUVOT0VOVDsKICAgICB9CiAKLSAgICByZXQgPSBiZHJ2X2NyZWF0ZShkcnYsIGZp
bGVuYW1lLCBvcHRzLCAmbG9jYWxfZXJyKTsKLSAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9j
YWxfZXJyKTsKKyAgICByZXQgPSBiZHJ2X2NyZWF0ZShkcnYsIGZpbGVuYW1lLCBvcHRzLCBlcnJw
KTsKICAgICByZXR1cm4gcmV0OwogfQogCkBAIC04MjQsMTQgKzgyMiwxMiBAQCBzdGF0aWMgQmxv
Y2tkZXZEZXRlY3RaZXJvZXNPcHRpb25zIGJkcnZfcGFyc2VfZGV0ZWN0X3plcm9lcyhRZW11T3B0
cyAqb3B0cywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIGludCBvcGVuX2ZsYWdzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJwKQogewotICAgIEVy
cm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIGNoYXIgKnZhbHVlID0gcWVtdV9vcHRfZ2V0X2Rl
bChvcHRzLCAiZGV0ZWN0LXplcm9lcyIpOwogICAgIEJsb2NrZGV2RGV0ZWN0WmVyb2VzT3B0aW9u
cyBkZXRlY3RfemVyb2VzID0KICAgICAgICAgcWFwaV9lbnVtX3BhcnNlKCZCbG9ja2RldkRldGVj
dFplcm9lc09wdGlvbnNfbG9va3VwLCB2YWx1ZSwKLSAgICAgICAgICAgICAgICAgICAgICAgIEJM
T0NLREVWX0RFVEVDVF9aRVJPRVNfT1BUSU9OU19PRkYsICZsb2NhbF9lcnIpOworICAgICAgICAg
ICAgICAgICAgICAgICAgQkxPQ0tERVZfREVURUNUX1pFUk9FU19PUFRJT05TX09GRiwgZXJycCk7
CiAgICAgZ19mcmVlKHZhbHVlKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIGlmICgqZXJycCkgewogICAgICAgICBy
ZXR1cm4gZGV0ZWN0X3plcm9lczsKICAgICB9CiAKQEAgLTEyNzUsMTIgKzEyNzEsMTAgQEAgc3Rh
dGljIGludCBiZHJ2X29wZW5fZHJpdmVyKEJsb2NrRHJpdmVyU3RhdGUgKmJzLCBCbG9ja0RyaXZl
ciAqZHJ2LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoYXIgKm5vZGVfbmFt
ZSwgUURpY3QgKm9wdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IG9wZW5f
ZmxhZ3MsIEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAg
ICBpbnQgaSwgcmV0OwogCi0gICAgYmRydl9hc3NpZ25fbm9kZV9uYW1lKGJzLCBub2RlX25hbWUs
ICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFn
YXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgYmRydl9hc3NpZ25fbm9kZV9uYW1lKGJzLCBub2Rl
X25hbWUsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm4gLUVJTlZBTDsK
ICAgICB9CiAKQEAgLTEyOTAsMTYgKzEyODQsMTUgQEAgc3RhdGljIGludCBiZHJ2X29wZW5fZHJp
dmVyKEJsb2NrRHJpdmVyU3RhdGUgKmJzLCBCbG9ja0RyaXZlciAqZHJ2LAogCiAgICAgaWYgKGRy
di0+YmRydl9maWxlX29wZW4pIHsKICAgICAgICAgYXNzZXJ0KCFkcnYtPmJkcnZfbmVlZHNfZmls
ZW5hbWUgfHwgYnMtPmZpbGVuYW1lWzBdKTsKLSAgICAgICAgcmV0ID0gZHJ2LT5iZHJ2X2ZpbGVf
b3Blbihicywgb3B0aW9ucywgb3Blbl9mbGFncywgJmxvY2FsX2Vycik7CisgICAgICAgIHJldCA9
IGRydi0+YmRydl9maWxlX29wZW4oYnMsIG9wdGlvbnMsIG9wZW5fZmxhZ3MsIGVycnApOwogICAg
IH0gZWxzZSBpZiAoZHJ2LT5iZHJ2X29wZW4pIHsKLSAgICAgICAgcmV0ID0gZHJ2LT5iZHJ2X29w
ZW4oYnMsIG9wdGlvbnMsIG9wZW5fZmxhZ3MsICZsb2NhbF9lcnIpOworICAgICAgICByZXQgPSBk
cnYtPmJkcnZfb3Blbihicywgb3B0aW9ucywgb3Blbl9mbGFncywgZXJycCk7CiAgICAgfSBlbHNl
IHsKICAgICAgICAgcmV0ID0gMDsKICAgICB9CiAKICAgICBpZiAocmV0IDwgMCkgewotICAgICAg
ICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9j
YWxfZXJyKTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIH0gZWxzZSBpZiAoYnMtPmZp
bGVuYW1lWzBdKSB7CiAgICAgICAgICAgICBlcnJvcl9zZXRnX2Vycm5vKGVycnAsIC1yZXQsICJD
b3VsZCBub3Qgb3BlbiAnJXMnIiwgYnMtPmZpbGVuYW1lKTsKICAgICAgICAgfSBlbHNlIHsKQEAg
LTEzMTQsOSArMTMwNyw4IEBAIHN0YXRpYyBpbnQgYmRydl9vcGVuX2RyaXZlcihCbG9ja0RyaXZl
clN0YXRlICpicywgQmxvY2tEcml2ZXIgKmRydiwKICAgICAgICAgcmV0dXJuIHJldDsKICAgICB9
CiAKLSAgICBiZHJ2X3JlZnJlc2hfbGltaXRzKGJzLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9j
YWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAg
IGJkcnZfcmVmcmVzaF9saW1pdHMoYnMsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAg
ICByZXR1cm4gLUVJTlZBTDsKICAgICB9CiAKQEAgLTE0MzcsMTUgKzE0MjksMTMgQEAgc3RhdGlj
IGludCBiZHJ2X29wZW5fY29tbW9uKEJsb2NrRHJpdmVyU3RhdGUgKmJzLCBCbG9ja0JhY2tlbmQg
KmZpbGUsCiAgICAgY29uc3QgY2hhciAqZGlzY2FyZDsKICAgICBRZW11T3B0cyAqb3B0czsKICAg
ICBCbG9ja0RyaXZlciAqZHJ2OwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAg
YXNzZXJ0KGJzLT5maWxlID09IE5VTEwpOwogICAgIGFzc2VydChvcHRpb25zICE9IE5VTEwgJiYg
YnMtPm9wdGlvbnMgIT0gb3B0aW9ucyk7CiAKICAgICBvcHRzID0gcWVtdV9vcHRzX2NyZWF0ZSgm
YmRydl9ydW50aW1lX29wdHMsIE5VTEwsIDAsICZlcnJvcl9hYm9ydCk7Ci0gICAgcWVtdV9vcHRz
X2Fic29yYl9xZGljdChvcHRzLCBvcHRpb25zLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxf
ZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHFl
bXVfb3B0c19hYnNvcmJfcWRpY3Qob3B0cywgb3B0aW9ucywgZXJycCk7CisgICAgaWYgKCplcnJw
KSB7CiAgICAgICAgIHJldCA9IC1FSU5WQUw7CiAgICAgICAgIGdvdG8gZmFpbF9vcHRzOwogICAg
IH0KQEAgLTE1MzEsOSArMTUyMSw4IEBAIHN0YXRpYyBpbnQgYmRydl9vcGVuX2NvbW1vbihCbG9j
a0RyaXZlclN0YXRlICpicywgQmxvY2tCYWNrZW5kICpmaWxlLAogICAgIH0KIAogICAgIGJzLT5k
ZXRlY3RfemVyb2VzID0KLSAgICAgICAgYmRydl9wYXJzZV9kZXRlY3RfemVyb2VzKG9wdHMsIGJz
LT5vcGVuX2ZsYWdzLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAg
IGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICBiZHJ2X3BhcnNlX2Rl
dGVjdF96ZXJvZXMob3B0cywgYnMtPm9wZW5fZmxhZ3MsIGVycnApOworICAgIGlmICgqZXJycCkg
ewogICAgICAgICByZXQgPSAtRUlOVkFMOwogICAgICAgICBnb3RvIGZhaWxfb3B0czsKICAgICB9
CkBAIC0xNTk0LDE2ICsxNTgzLDE0IEBAIHN0YXRpYyB2b2lkIHBhcnNlX2pzb25fcHJvdG9jb2wo
UURpY3QgKm9wdGlvbnMsIGNvbnN0IGNoYXIgKipwZmlsZW5hbWUsCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIEVycm9yICoqZXJycCkKIHsKICAgICBRRGljdCAqanNvbl9vcHRpb25z
OwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgLyogUGFyc2UganNvbjogcHNl
dWRvLXByb3RvY29sICovCiAgICAgaWYgKCEqcGZpbGVuYW1lIHx8ICFnX3N0cl9oYXNfcHJlZml4
KCpwZmlsZW5hbWUsICJqc29uOiIpKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKLSAgICBq
c29uX29wdGlvbnMgPSBwYXJzZV9qc29uX2ZpbGVuYW1lKCpwZmlsZW5hbWUsICZsb2NhbF9lcnIp
OwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxv
Y2FsX2Vycik7CisgICAganNvbl9vcHRpb25zID0gcGFyc2VfanNvbl9maWxlbmFtZSgqcGZpbGVu
YW1lLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApA
QCAtMTYyNyw3ICsxNjE0LDYgQEAgc3RhdGljIGludCBiZHJ2X2ZpbGxfb3B0aW9ucyhRRGljdCAq
Km9wdGlvbnMsIGNvbnN0IGNoYXIgKmZpbGVuYW1lLAogICAgIGJvb2wgcHJvdG9jb2wgPSAqZmxh
Z3MgJiBCRFJWX09fUFJPVE9DT0w7CiAgICAgYm9vbCBwYXJzZV9maWxlbmFtZSA9IGZhbHNlOwog
ICAgIEJsb2NrRHJpdmVyICpkcnYgPSBOVUxMOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxM
OwogCiAgICAgLyoKICAgICAgKiBDYXV0aW9uOiB3aGlsZSBxZGljdF9nZXRfdHJ5X3N0cigpIGlz
IGZpbmUsIGdldHRpbmcgbm9uLXN0cmluZwpAQCAtMTY5Miw5ICsxNjc4LDggQEAgc3RhdGljIGlu
dCBiZHJ2X2ZpbGxfb3B0aW9ucyhRRGljdCAqKm9wdGlvbnMsIGNvbnN0IGNoYXIgKmZpbGVuYW1l
LAogCiAgICAgLyogRHJpdmVyLXNwZWNpZmljIGZpbGVuYW1lIHBhcnNpbmcgKi8KICAgICBpZiAo
ZHJ2ICYmIGRydi0+YmRydl9wYXJzZV9maWxlbmFtZSAmJiBwYXJzZV9maWxlbmFtZSkgewotICAg
ICAgICBkcnYtPmJkcnZfcGFyc2VfZmlsZW5hbWUoZmlsZW5hbWUsICpvcHRpb25zLCAmbG9jYWxf
ZXJyKTsKLSAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFn
YXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgIGRydi0+YmRydl9wYXJzZV9maWxlbmFtZShm
aWxlbmFtZSwgKm9wdGlvbnMsIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAg
ICAgIHJldHVybiAtRUlOVkFMOwogICAgICAgICB9CiAKQEAgLTIxMjMsMTYgKzIxMDgsMTQgQEAg
c3RhdGljIHZvaWQgYmRydl9jaGlsZF9hYm9ydF9wZXJtX3VwZGF0ZShCZHJ2Q2hpbGQgKmMpCiBp
bnQgYmRydl9jaGlsZF90cnlfc2V0X3Blcm0oQmRydkNoaWxkICpjLCB1aW50NjRfdCBwZXJtLCB1
aW50NjRfdCBzaGFyZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJw
KQogewotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIGludCByZXQ7CiAgICAgYm9v
bCB0aWdodGVuX3Jlc3RyaWN0aW9uczsKIAogICAgIHJldCA9IGJkcnZfY2hpbGRfY2hlY2tfcGVy
bShjLCBOVUxMLCBwZXJtLCBzaGFyZWQsIE5VTEwsCi0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICZ0aWdodGVuX3Jlc3RyaWN0aW9ucywgJmxvY2FsX2Vycik7CisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICZ0aWdodGVuX3Jlc3RyaWN0aW9ucywgZXJycCk7CiAgICAgaWYg
KHJldCA8IDApIHsKICAgICAgICAgYmRydl9jaGlsZF9hYm9ydF9wZXJtX3VwZGF0ZShjKTsKICAg
ICAgICAgaWYgKHRpZ2h0ZW5fcmVzdHJpY3Rpb25zKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9w
YWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgIC8q
CiAgICAgICAgICAgICAgKiBPdXIgY2FsbGVyIG1heSBpbnRlbmQgdG8gb25seSBsb29zZW4gcmVz
dHJpY3Rpb25zIGFuZApAQCAtMjE0MCw3ICsyMTIzLDcgQEAgaW50IGJkcnZfY2hpbGRfdHJ5X3Nl
dF9wZXJtKEJkcnZDaGlsZCAqYywgdWludDY0X3QgcGVybSwgdWludDY0X3Qgc2hhcmVkLAogICAg
ICAgICAgICAgICogZmF0YWwgaW4gc3VjaCBhIGNhc2UsIHNvIHdlIGNhbiBqdXN0IGhpZGUgdGhl
bSBmcm9tIG91cgogICAgICAgICAgICAgICogY2FsbGVyLgogICAgICAgICAgICAgICovCi0gICAg
ICAgICAgICBlcnJvcl9mcmVlKGxvY2FsX2Vycik7CisgICAgICAgICAgICBlcnJvcl9mcmVlX2Vy
cnAoZXJycCk7CiAgICAgICAgICAgICByZXQgPSAwOwogICAgICAgICB9CiAgICAgICAgIHJldHVy
biByZXQ7CkBAIC0yMzY3LDcgKzIzNTAsNiBAQCBCZHJ2Q2hpbGQgKmJkcnZfcm9vdF9hdHRhY2hf
Y2hpbGQoQmxvY2tEcml2ZXJTdGF0ZSAqY2hpbGRfYnMsCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgdm9pZCAqb3BhcXVlLCBFcnJvciAqKmVycnApCiB7CiAgICAgQmRydkNoaWxk
ICpjaGlsZDsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBpbnQgcmV0OwogCiAg
ICAgcmV0ID0gYmRydl9jaGVja191cGRhdGVfcGVybShjaGlsZF9icywgTlVMTCwgcGVybSwgc2hh
cmVkX3Blcm0sIE5VTEwsIE5VTEwsCkBAIC0yMzkyLDEyICsyMzc0LDEyIEBAIEJkcnZDaGlsZCAq
YmRydl9yb290X2F0dGFjaF9jaGlsZChCbG9ja0RyaXZlclN0YXRlICpjaGlsZF9icywKICAgICAg
KiBjaGlsZF9icyBpbnRvIHRoZSBBaW9Db250ZXh0IG9mIHRoZSBuZXcgcGFyZW50LiBJZiB0aGlz
IGRvZXNuJ3Qgd29yaywKICAgICAgKiB0cnkgbW92aW5nIHRoZSBwYXJlbnQgaW50byB0aGUgQWlv
Q29udGV4dCBvZiBjaGlsZF9icyBpbnN0ZWFkLiAqLwogICAgIGlmIChiZHJ2X2dldF9haW9fY29u
dGV4dChjaGlsZF9icykgIT0gY3R4KSB7Ci0gICAgICAgIHJldCA9IGJkcnZfdHJ5X3NldF9haW9f
Y29udGV4dChjaGlsZF9icywgY3R4LCAmbG9jYWxfZXJyKTsKKyAgICAgICAgcmV0ID0gYmRydl90
cnlfc2V0X2Fpb19jb250ZXh0KGNoaWxkX2JzLCBjdHgsIGVycnApOwogICAgICAgICBpZiAocmV0
IDwgMCAmJiBjaGlsZF9yb2xlLT5jYW5fc2V0X2Fpb19jdHgpIHsKICAgICAgICAgICAgIEdTTGlz
dCAqaWdub3JlID0gZ19zbGlzdF9wcmVwZW5kKE5VTEwsIGNoaWxkKTs7CiAgICAgICAgICAgICBj
dHggPSBiZHJ2X2dldF9haW9fY29udGV4dChjaGlsZF9icyk7CiAgICAgICAgICAgICBpZiAoY2hp
bGRfcm9sZS0+Y2FuX3NldF9haW9fY3R4KGNoaWxkLCBjdHgsICZpZ25vcmUsIE5VTEwpKSB7Ci0g
ICAgICAgICAgICAgICAgZXJyb3JfZnJlZShsb2NhbF9lcnIpOworICAgICAgICAgICAgICAgIGVy
cm9yX2ZyZWVfZXJycChlcnJwKTsKICAgICAgICAgICAgICAgICByZXQgPSAwOwogICAgICAgICAg
ICAgICAgIGdfc2xpc3RfZnJlZShpZ25vcmUpOwogICAgICAgICAgICAgICAgIGlnbm9yZSA9IGdf
c2xpc3RfcHJlcGVuZChOVUxMLCBjaGlsZCk7OwpAQCAtMjQwNiw3ICsyMzg4LDYgQEAgQmRydkNo
aWxkICpiZHJ2X3Jvb3RfYXR0YWNoX2NoaWxkKEJsb2NrRHJpdmVyU3RhdGUgKmNoaWxkX2JzLAog
ICAgICAgICAgICAgZ19zbGlzdF9mcmVlKGlnbm9yZSk7CiAgICAgICAgIH0KICAgICAgICAgaWYg
KHJldCA8IDApIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIp
OwogICAgICAgICAgICAgZ19mcmVlKGNoaWxkKTsKICAgICAgICAgICAgIGJkcnZfYWJvcnRfcGVy
bV91cGRhdGUoY2hpbGRfYnMpOwogICAgICAgICAgICAgcmV0dXJuIE5VTEw7CkBAIC0yNjAwLDcg
KzI1ODEsNiBAQCBpbnQgYmRydl9vcGVuX2JhY2tpbmdfZmlsZShCbG9ja0RyaXZlclN0YXRlICpi
cywgUURpY3QgKnBhcmVudF9vcHRpb25zLAogICAgIEJsb2NrRHJpdmVyU3RhdGUgKmJhY2tpbmdf
aGQ7CiAgICAgUURpY3QgKm9wdGlvbnM7CiAgICAgUURpY3QgKnRtcF9wYXJlbnRfb3B0aW9ucyA9
IE5VTEw7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICBpZiAoYnMtPmJhY2tp
bmcgIT0gTlVMTCkgewogICAgICAgICBnb3RvIGZyZWVfZXhpdDsKQEAgLTI2NDIsMTAgKzI2MjIs
OSBAQCBpbnQgYmRydl9vcGVuX2JhY2tpbmdfZmlsZShCbG9ja0RyaXZlclN0YXRlICpicywgUURp
Y3QgKnBhcmVudF9vcHRpb25zLAogICAgICAgICAgICAgaW1wbGljaXRfYmFja2luZyA9ICFzdHJj
bXAoYnMtPmF1dG9fYmFja2luZ19maWxlLCBicy0+YmFja2luZ19maWxlKTsKICAgICAgICAgfQog
Ci0gICAgICAgIGJhY2tpbmdfZmlsZW5hbWUgPSBiZHJ2X2dldF9mdWxsX2JhY2tpbmdfZmlsZW5h
bWUoYnMsICZsb2NhbF9lcnIpOwotICAgICAgICBpZiAobG9jYWxfZXJyKSB7CisgICAgICAgIGJh
Y2tpbmdfZmlsZW5hbWUgPSBiZHJ2X2dldF9mdWxsX2JhY2tpbmdfZmlsZW5hbWUoYnMsIGVycnAp
OworICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIHJldCA9IC1FSU5WQUw7Ci0gICAg
ICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKICAgICAgICAgICAgIHFv
YmplY3RfdW5yZWYob3B0aW9ucyk7CiAgICAgICAgICAgICBnb3RvIGZyZWVfZXhpdDsKICAgICAg
ICAgfQpAQCAtMjY4MCwxMCArMjY1OSw5IEBAIGludCBiZHJ2X29wZW5fYmFja2luZ19maWxlKEJs
b2NrRHJpdmVyU3RhdGUgKmJzLCBRRGljdCAqcGFyZW50X29wdGlvbnMsCiAKICAgICAvKiBIb29r
IHVwIHRoZSBiYWNraW5nIGZpbGUgbGluazsgZHJvcCBvdXIgcmVmZXJlbmNlLCBicyBvd25zIHRo
ZQogICAgICAqIGJhY2tpbmdfaGQgcmVmZXJlbmNlIG5vdyAqLwotICAgIGJkcnZfc2V0X2JhY2tp
bmdfaGQoYnMsIGJhY2tpbmdfaGQsICZsb2NhbF9lcnIpOworICAgIGJkcnZfc2V0X2JhY2tpbmdf
aGQoYnMsIGJhY2tpbmdfaGQsIGVycnApOwogICAgIGJkcnZfdW5yZWYoYmFja2luZ19oZCk7Ci0g
ICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxf
ZXJyKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0ID0gLUVJTlZBTDsKICAgICAgICAg
Z290byBmcmVlX2V4aXQ7CiAgICAgfQpAQCAtMjc3Niw3ICsyNzU0LDYgQEAgQmRydkNoaWxkICpi
ZHJ2X29wZW5fY2hpbGQoY29uc3QgY2hhciAqZmlsZW5hbWUsCiBCbG9ja0RyaXZlclN0YXRlICpi
ZHJ2X29wZW5fYmxvY2tkZXZfcmVmKEJsb2NrZGV2UmVmICpyZWYsIEVycm9yICoqZXJycCkKIHsK
ICAgICBCbG9ja0RyaXZlclN0YXRlICpicyA9IE5VTEw7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9
IE5VTEw7CiAgICAgUU9iamVjdCAqb2JqID0gTlVMTDsKICAgICBRRGljdCAqcWRpY3QgPSBOVUxM
OwogICAgIGNvbnN0IGNoYXIgKnJlZmVyZW5jZSA9IE5VTEw7CkBAIC0yNzg5LDkgKzI3NjYsOCBA
QCBCbG9ja0RyaXZlclN0YXRlICpiZHJ2X29wZW5fYmxvY2tkZXZfcmVmKEJsb2NrZGV2UmVmICpy
ZWYsIEVycm9yICoqZXJycCkKICAgICAgICAgYXNzZXJ0KHJlZi0+dHlwZSA9PSBRVFlQRV9RRElD
VCk7CiAKICAgICAgICAgdiA9IHFvYmplY3Rfb3V0cHV0X3Zpc2l0b3JfbmV3KCZvYmopOwotICAg
ICAgICB2aXNpdF90eXBlX0Jsb2NrZGV2T3B0aW9ucyh2LCBOVUxMLCAmb3B0aW9ucywgJmxvY2Fs
X2Vycik7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3Bh
Z2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICB2aXNpdF90eXBlX0Jsb2NrZGV2T3B0aW9u
cyh2LCBOVUxMLCAmb3B0aW9ucywgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAg
ICAgICAgZ290byBmYWlsOwogICAgICAgICB9CiAgICAgICAgIHZpc2l0X2NvbXBsZXRlKHYsICZv
YmopOwpAQCAtMjgyOCw3ICsyODA0LDYgQEAgc3RhdGljIEJsb2NrRHJpdmVyU3RhdGUgKmJkcnZf
YXBwZW5kX3RlbXBfc25hcHNob3QoQmxvY2tEcml2ZXJTdGF0ZSAqYnMsCiAgICAgaW50NjRfdCB0
b3RhbF9zaXplOwogICAgIFFlbXVPcHRzICpvcHRzID0gTlVMTDsKICAgICBCbG9ja0RyaXZlclN0
YXRlICpic19zbmFwc2hvdCA9IE5VTEw7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAg
ICAgaW50IHJldDsKIAogICAgIC8qIGlmIHNuYXBzaG90LCB3ZSBjcmVhdGUgYSB0ZW1wb3Jhcnkg
YmFja2luZyBmaWxlIGFuZCBvcGVuIGl0CkBAIC0yODc1LDkgKzI4NTAsOCBAQCBzdGF0aWMgQmxv
Y2tEcml2ZXJTdGF0ZSAqYmRydl9hcHBlbmRfdGVtcF9zbmFwc2hvdChCbG9ja0RyaXZlclN0YXRl
ICpicywKICAgICAgKiBvcmRlciB0byBiZSBhYmxlIHRvIHJldHVybiBvbmUsIHdlIGhhdmUgdG8g
aW5jcmVhc2UKICAgICAgKiBic19zbmFwc2hvdCdzIHJlZmNvdW50IGhlcmUgKi8KICAgICBiZHJ2
X3JlZihic19zbmFwc2hvdCk7Ci0gICAgYmRydl9hcHBlbmQoYnNfc25hcHNob3QsIGJzLCAmbG9j
YWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShl
cnJwLCBsb2NhbF9lcnIpOworICAgIGJkcnZfYXBwZW5kKGJzX3NuYXBzaG90LCBicywgZXJycCk7
CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGJzX3NuYXBzaG90ID0gTlVMTDsKICAgICAgICAg
Z290byBvdXQ7CiAgICAgfQpAQCAtMjkxNyw3ICsyODkxLDYgQEAgc3RhdGljIEJsb2NrRHJpdmVy
U3RhdGUgKmJkcnZfb3Blbl9pbmhlcml0KGNvbnN0IGNoYXIgKmZpbGVuYW1lLAogICAgIEJkcnZD
aGlsZCAqY2hpbGQ7CiAgICAgY29uc3QgY2hhciAqZHJ2bmFtZTsKICAgICBjb25zdCBjaGFyICpi
YWNraW5nOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIFFEaWN0ICpzbmFwc2hv
dF9vcHRpb25zID0gTlVMTDsKICAgICBpbnQgc25hcHNob3RfZmxhZ3MgPSAwOwogCkBAIC0yOTUx
LDggKzI5MjQsOCBAQCBzdGF0aWMgQmxvY2tEcml2ZXJTdGF0ZSAqYmRydl9vcGVuX2luaGVyaXQo
Y29uc3QgY2hhciAqZmlsZW5hbWUsCiAgICAgfQogCiAgICAgLyoganNvbjogc3ludGF4IGNvdW50
cyBhcyBleHBsaWNpdCBvcHRpb25zLCBhcyBpZiBpbiB0aGUgUURpY3QgKi8KLSAgICBwYXJzZV9q
c29uX3Byb3RvY29sKG9wdGlvbnMsICZmaWxlbmFtZSwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxv
Y2FsX2VycikgeworICAgIHBhcnNlX2pzb25fcHJvdG9jb2wob3B0aW9ucywgJmZpbGVuYW1lLCBl
cnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ290byBmYWlsOwogICAgIH0KIApAQCAt
Mjk2NCw4ICsyOTM3LDggQEAgc3RhdGljIEJsb2NrRHJpdmVyU3RhdGUgKmJkcnZfb3Blbl9pbmhl
cml0KGNvbnN0IGNoYXIgKmZpbGVuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgcGFyZW50LT5vcGVuX2ZsYWdzLCBwYXJlbnQtPm9wdGlvbnMpOwogICAgIH0KIAotICAg
IHJldCA9IGJkcnZfZmlsbF9vcHRpb25zKCZvcHRpb25zLCBmaWxlbmFtZSwgJmZsYWdzLCAmbG9j
YWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7CisgICAgcmV0ID0gYmRydl9maWxsX29wdGlv
bnMoJm9wdGlvbnMsIGZpbGVuYW1lLCAmZmxhZ3MsIGVycnApOworICAgIGlmICgqZXJycCkgewog
ICAgICAgICBnb3RvIGZhaWw7CiAgICAgfQogCkBAIC0zMDI5LDggKzMwMDIsOCBAQCBzdGF0aWMg
QmxvY2tEcml2ZXJTdGF0ZSAqYmRydl9vcGVuX2luaGVyaXQoY29uc3QgY2hhciAqZmlsZW5hbWUs
CiAgICAgICAgIEJsb2NrRHJpdmVyU3RhdGUgKmZpbGVfYnM7CiAKICAgICAgICAgZmlsZV9icyA9
IGJkcnZfb3Blbl9jaGlsZF9icyhmaWxlbmFtZSwgb3B0aW9ucywgImZpbGUiLCBicywKLSAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmY2hpbGRfZmlsZSwgdHJ1ZSwgJmxvY2Fs
X2Vycik7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAmY2hpbGRfZmlsZSwgdHJ1ZSwgZXJycCk7CisgICAgICAgIGlmICgqZXJy
cCkgewogICAgICAgICAgICAgZ290byBmYWlsOwogICAgICAgICB9CiAgICAgICAgIGlmIChmaWxl
X2JzICE9IE5VTEwpIHsKQEAgLTMwMzgsOSArMzAxMSw5IEBAIHN0YXRpYyBCbG9ja0RyaXZlclN0
YXRlICpiZHJ2X29wZW5faW5oZXJpdChjb25zdCBjaGFyICpmaWxlbmFtZSwKICAgICAgICAgICAg
ICAqIGxvb2tpbmcgYXQgdGhlIGhlYWRlciB0byBndWVzcyB0aGUgaW1hZ2UgZm9ybWF0LiBUaGlz
IHdvcmtzIGV2ZW4KICAgICAgICAgICAgICAqIGluIGNhc2VzIHdoZXJlIGEgZ3Vlc3Qgd291bGQg
bm90IHNlZSBhIGNvbnNpc3RlbnQgc3RhdGUuICovCiAgICAgICAgICAgICBmaWxlID0gYmxrX25l
dyhiZHJ2X2dldF9haW9fY29udGV4dChmaWxlX2JzKSwgMCwgQkxLX1BFUk1fQUxMKTsKLSAgICAg
ICAgICAgIGJsa19pbnNlcnRfYnMoZmlsZSwgZmlsZV9icywgJmxvY2FsX2Vycik7CisgICAgICAg
ICAgICBibGtfaW5zZXJ0X2JzKGZpbGUsIGZpbGVfYnMsIGVycnApOwogICAgICAgICAgICAgYmRy
dl91bnJlZihmaWxlX2JzKTsKLSAgICAgICAgICAgIGlmIChsb2NhbF9lcnIpIHsKKyAgICAgICAg
ICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgICAgIGdvdG8gZmFpbDsKICAgICAgICAgICAg
IH0KIApAQCAtMzA1MSw3ICszMDI0LDcgQEAgc3RhdGljIEJsb2NrRHJpdmVyU3RhdGUgKmJkcnZf
b3Blbl9pbmhlcml0KGNvbnN0IGNoYXIgKmZpbGVuYW1lLAogICAgIC8qIEltYWdlIGZvcm1hdCBw
cm9iaW5nICovCiAgICAgYnMtPnByb2JlZCA9ICFkcnY7CiAgICAgaWYgKCFkcnYgJiYgZmlsZSkg
ewotICAgICAgICByZXQgPSBmaW5kX2ltYWdlX2Zvcm1hdChmaWxlLCBmaWxlbmFtZSwgJmRydiwg
JmxvY2FsX2Vycik7CisgICAgICAgIHJldCA9IGZpbmRfaW1hZ2VfZm9ybWF0KGZpbGUsIGZpbGVu
YW1lLCAmZHJ2LCBlcnJwKTsKICAgICAgICAgaWYgKHJldCA8IDApIHsKICAgICAgICAgICAgIGdv
dG8gZmFpbDsKICAgICAgICAgfQpAQCAtMzA4MCw3ICszMDUzLDcgQEAgc3RhdGljIEJsb2NrRHJp
dmVyU3RhdGUgKmJkcnZfb3Blbl9pbmhlcml0KGNvbnN0IGNoYXIgKmZpbGVuYW1lLAogICAgIGFz
c2VydCghKGZsYWdzICYgQkRSVl9PX1BST1RPQ09MKSB8fCAhZmlsZSk7CiAKICAgICAvKiBPcGVu
IHRoZSBpbWFnZSAqLwotICAgIHJldCA9IGJkcnZfb3Blbl9jb21tb24oYnMsIGZpbGUsIG9wdGlv
bnMsICZsb2NhbF9lcnIpOworICAgIHJldCA9IGJkcnZfb3Blbl9jb21tb24oYnMsIGZpbGUsIG9w
dGlvbnMsIGVycnApOwogICAgIGlmIChyZXQgPCAwKSB7CiAgICAgICAgIGdvdG8gZmFpbDsKICAg
ICB9CkBAIC0zMDkyLDcgKzMwNjUsNyBAQCBzdGF0aWMgQmxvY2tEcml2ZXJTdGF0ZSAqYmRydl9v
cGVuX2luaGVyaXQoY29uc3QgY2hhciAqZmlsZW5hbWUsCiAKICAgICAvKiBJZiB0aGVyZSBpcyBh
IGJhY2tpbmcgZmlsZSwgdXNlIGl0ICovCiAgICAgaWYgKChmbGFncyAmIEJEUlZfT19OT19CQUNL
SU5HKSA9PSAwKSB7Ci0gICAgICAgIHJldCA9IGJkcnZfb3Blbl9iYWNraW5nX2ZpbGUoYnMsIG9w
dGlvbnMsICJiYWNraW5nIiwgJmxvY2FsX2Vycik7CisgICAgICAgIHJldCA9IGJkcnZfb3Blbl9i
YWNraW5nX2ZpbGUoYnMsIG9wdGlvbnMsICJiYWNraW5nIiwgZXJycCk7CiAgICAgICAgIGlmIChy
ZXQgPCAwKSB7CiAgICAgICAgICAgICBnb3RvIGNsb3NlX2FuZF9mYWlsOwogICAgICAgICB9CkBA
IC0zMTM1LDkgKzMxMDgsOSBAQCBzdGF0aWMgQmxvY2tEcml2ZXJTdGF0ZSAqYmRydl9vcGVuX2lu
aGVyaXQoY29uc3QgY2hhciAqZmlsZW5hbWUsCiAgICAgaWYgKHNuYXBzaG90X2ZsYWdzKSB7CiAg
ICAgICAgIEJsb2NrRHJpdmVyU3RhdGUgKnNuYXBzaG90X2JzOwogICAgICAgICBzbmFwc2hvdF9i
cyA9IGJkcnZfYXBwZW5kX3RlbXBfc25hcHNob3QoYnMsIHNuYXBzaG90X2ZsYWdzLAotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc25hcHNob3Rfb3B0aW9u
cywgJmxvY2FsX2Vycik7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBzbmFwc2hvdF9vcHRpb25zLCBlcnJwKTsKICAgICAgICAgc25hcHNob3Rfb3B0aW9u
cyA9IE5VTEw7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsKKyAgICAgICAgaWYgKCplcnJwKSB7
CiAgICAgICAgICAgICBnb3RvIGNsb3NlX2FuZF9mYWlsOwogICAgICAgICB9CiAgICAgICAgIC8q
IFdlIGFyZSBub3QgZ29pbmcgdG8gcmV0dXJuIGJzIGJ1dCB0aGUgb3ZlcmxheSBvbiB0b3Agb2Yg
aXQKQEAgLTMxNTksMTQgKzMxMzIsMTIgQEAgZmFpbDoKICAgICBicy0+b3B0aW9ucyA9IE5VTEw7
CiAgICAgYnMtPmV4cGxpY2l0X29wdGlvbnMgPSBOVUxMOwogICAgIGJkcnZfdW5yZWYoYnMpOwot
ICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogICAgIHJldHVybiBOVUxMOwog
CiBjbG9zZV9hbmRfZmFpbDoKICAgICBiZHJ2X3VucmVmKGJzKTsKICAgICBxb2JqZWN0X3VucmVm
KHNuYXBzaG90X29wdGlvbnMpOwogICAgIHFvYmplY3RfdW5yZWYob3B0aW9ucyk7Ci0gICAgZXJy
b3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CiAgICAgcmV0dXJuIE5VTEw7CiB9CiAKQEAg
LTM3MTEsNyArMzY4Miw2IEBAIGludCBiZHJ2X3Jlb3Blbl9wcmVwYXJlKEJEUlZSZW9wZW5TdGF0
ZSAqcmVvcGVuX3N0YXRlLCBCbG9ja1Jlb3BlblF1ZXVlICpxdWV1ZSwKIHsKICAgICBpbnQgcmV0
ID0gLTE7CiAgICAgaW50IG9sZF9mbGFnczsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsK
ICAgICBCbG9ja0RyaXZlciAqZHJ2OwogICAgIFFlbXVPcHRzICpvcHRzOwogICAgIFFEaWN0ICpv
cmlnX3Jlb3Blbl9vcHRzOwpAQCAtMzczMCw5ICszNzAwLDggQEAgaW50IGJkcnZfcmVvcGVuX3By
ZXBhcmUoQkRSVlJlb3BlblN0YXRlICpyZW9wZW5fc3RhdGUsIEJsb2NrUmVvcGVuUXVldWUgKnF1
ZXVlLAogCiAgICAgLyogUHJvY2VzcyBnZW5lcmljIGJsb2NrIGxheWVyIG9wdGlvbnMgKi8KICAg
ICBvcHRzID0gcWVtdV9vcHRzX2NyZWF0ZSgmYmRydl9ydW50aW1lX29wdHMsIE5VTEwsIDAsICZl
cnJvcl9hYm9ydCk7Ci0gICAgcWVtdV9vcHRzX2Fic29yYl9xZGljdChvcHRzLCByZW9wZW5fc3Rh
dGUtPm9wdGlvbnMsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAg
ZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgcWVtdV9vcHRzX2Fic29yYl9x
ZGljdChvcHRzLCByZW9wZW5fc3RhdGUtPm9wdGlvbnMsIGVycnApOworICAgIGlmICgqZXJycCkg
ewogICAgICAgICByZXQgPSAtRUlOVkFMOwogICAgICAgICBnb3RvIGVycm9yOwogICAgIH0KQEAg
LTM3NTQsOSArMzcyMyw4IEBAIGludCBiZHJ2X3Jlb3Blbl9wcmVwYXJlKEJEUlZSZW9wZW5TdGF0
ZSAqcmVvcGVuX3N0YXRlLCBCbG9ja1Jlb3BlblF1ZXVlICpxdWV1ZSwKICAgICB9CiAKICAgICBy
ZW9wZW5fc3RhdGUtPmRldGVjdF96ZXJvZXMgPQotICAgICAgICBiZHJ2X3BhcnNlX2RldGVjdF96
ZXJvZXMob3B0cywgcmVvcGVuX3N0YXRlLT5mbGFncywgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxv
Y2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAg
ICAgICAgYmRydl9wYXJzZV9kZXRlY3RfemVyb2VzKG9wdHMsIHJlb3Blbl9zdGF0ZS0+ZmxhZ3Ms
IGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXQgPSAtRUlOVkFMOwogICAgICAg
ICBnb3RvIGVycm9yOwogICAgIH0KQEAgLTM3NzAsOSArMzczOCw4IEBAIGludCBiZHJ2X3Jlb3Bl
bl9wcmVwYXJlKEJEUlZSZW9wZW5TdGF0ZSAqcmVvcGVuX3N0YXRlLCBCbG9ja1Jlb3BlblF1ZXVl
ICpxdWV1ZSwKICAgICAgKiB0byByL3cuIEF0dGVtcHRpbmcgdG8gc2V0IHRvIHIvdyBtYXkgZmFp
bCBpZiBlaXRoZXIgQkRSVl9PX0FMTE9XX1JEV1IgaXMKICAgICAgKiBub3Qgc2V0LCBvciBpZiB0
aGUgQkRTIHN0aWxsIGhhcyBjb3B5X29uX3JlYWQgZW5hYmxlZCAqLwogICAgIHJlYWRfb25seSA9
ICEocmVvcGVuX3N0YXRlLT5mbGFncyAmIEJEUlZfT19SRFdSKTsKLSAgICByZXQgPSBiZHJ2X2Nh
bl9zZXRfcmVhZF9vbmx5KHJlb3Blbl9zdGF0ZS0+YnMsIHJlYWRfb25seSwgdHJ1ZSwgJmxvY2Fs
X2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJy
cCwgbG9jYWxfZXJyKTsKKyAgICByZXQgPSBiZHJ2X2Nhbl9zZXRfcmVhZF9vbmx5KHJlb3Blbl9z
dGF0ZS0+YnMsIHJlYWRfb25seSwgdHJ1ZSwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAg
ICAgIGdvdG8gZXJyb3I7CiAgICAgfQogCkBAIC0zNzk4LDEwICszNzY1LDkgQEAgaW50IGJkcnZf
cmVvcGVuX3ByZXBhcmUoQkRSVlJlb3BlblN0YXRlICpyZW9wZW5fc3RhdGUsIEJsb2NrUmVvcGVu
UXVldWUgKnF1ZXVlLAogICAgICAgICAgICAgZ290byBlcnJvcjsKICAgICAgICAgfQogCi0gICAg
ICAgIHJldCA9IGRydi0+YmRydl9yZW9wZW5fcHJlcGFyZShyZW9wZW5fc3RhdGUsIHF1ZXVlLCAm
bG9jYWxfZXJyKTsKKyAgICAgICAgcmV0ID0gZHJ2LT5iZHJ2X3Jlb3Blbl9wcmVwYXJlKHJlb3Bl
bl9zdGF0ZSwgcXVldWUsIGVycnApOwogICAgICAgICBpZiAocmV0KSB7Ci0gICAgICAgICAgICBp
ZiAobG9jYWxfZXJyICE9IE5VTEwpIHsKLSAgICAgICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUo
ZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgICAgIGlmICgqZXJycCAhPSBOVUxMKSB7CiAgICAg
ICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgIGJkcnZfcmVmcmVzaF9maWxlbmFtZShy
ZW9wZW5fc3RhdGUtPmJzKTsKICAgICAgICAgICAgICAgICBlcnJvcl9zZXRnKGVycnAsICJmYWls
ZWQgd2hpbGUgcHJlcGFyaW5nIHRvIHJlb3BlbiBpbWFnZSAnJXMnIiwKQEAgLTQyMzgsMTcgKzQy
MDQsMTMgQEAgb3V0Ogogdm9pZCBiZHJ2X2FwcGVuZChCbG9ja0RyaXZlclN0YXRlICpic19uZXcs
IEJsb2NrRHJpdmVyU3RhdGUgKmJzX3RvcCwKICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJw
KQogewotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwotCi0gICAgYmRydl9zZXRfYmFja2lu
Z19oZChic19uZXcsIGJzX3RvcCwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2Vycikgewot
ICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBiZHJ2X3NldF9i
YWNraW5nX2hkKGJzX25ldywgYnNfdG9wLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAg
ICAgZ290byBvdXQ7CiAgICAgfQogCi0gICAgYmRydl9yZXBsYWNlX25vZGUoYnNfdG9wLCBic19u
ZXcsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJv
cGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgYmRydl9yZXBsYWNlX25vZGUoYnNfdG9wLCBi
c19uZXcsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICBiZHJ2X3NldF9iYWNraW5n
X2hkKGJzX25ldywgTlVMTCwgJmVycm9yX2Fib3J0KTsKICAgICAgICAgZ290byBvdXQ7CiAgICAg
fQpAQCAtNTMxMSw3ICs1MjczLDYgQEAgc3RhdGljIHZvaWQgY29yb3V0aW5lX2ZuIGJkcnZfY29f
aW52YWxpZGF0ZV9jYWNoZShCbG9ja0RyaXZlclN0YXRlICpicywKIHsKICAgICBCZHJ2Q2hpbGQg
KmNoaWxkLCAqcGFyZW50OwogICAgIHVpbnQ2NF90IHBlcm0sIHNoYXJlZF9wZXJtOwotICAgIEVy
cm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIGludCByZXQ7CiAgICAgQmRydkRpcnR5Qml0bWFw
ICpibTsKIApAQCAtNTMyNCw5ICs1Mjg1LDggQEAgc3RhdGljIHZvaWQgY29yb3V0aW5lX2ZuIGJk
cnZfY29faW52YWxpZGF0ZV9jYWNoZShCbG9ja0RyaXZlclN0YXRlICpicywKICAgICB9CiAKICAg
ICBRTElTVF9GT1JFQUNIKGNoaWxkLCAmYnMtPmNoaWxkcmVuLCBuZXh0KSB7Ci0gICAgICAgIGJk
cnZfY29faW52YWxpZGF0ZV9jYWNoZShjaGlsZC0+YnMsICZsb2NhbF9lcnIpOwotICAgICAgICBp
ZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxf
ZXJyKTsKKyAgICAgICAgYmRydl9jb19pbnZhbGlkYXRlX2NhY2hlKGNoaWxkLT5icywgZXJycCk7
CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CiAg
ICAgfQpAQCAtNTM0NiwxOSArNTMwNiwxNyBAQCBzdGF0aWMgdm9pZCBjb3JvdXRpbmVfZm4gYmRy
dl9jb19pbnZhbGlkYXRlX2NhY2hlKEJsb2NrRHJpdmVyU3RhdGUgKmJzLAogICAgICAqLwogICAg
IGJzLT5vcGVuX2ZsYWdzICY9IH5CRFJWX09fSU5BQ1RJVkU7CiAgICAgYmRydl9nZXRfY3VtdWxh
dGl2ZV9wZXJtKGJzLCAmcGVybSwgJnNoYXJlZF9wZXJtKTsKLSAgICByZXQgPSBiZHJ2X2NoZWNr
X3Blcm0oYnMsIE5VTEwsIHBlcm0sIHNoYXJlZF9wZXJtLCBOVUxMLCBOVUxMLCAmbG9jYWxfZXJy
KTsKKyAgICByZXQgPSBiZHJ2X2NoZWNrX3Blcm0oYnMsIE5VTEwsIHBlcm0sIHNoYXJlZF9wZXJt
LCBOVUxMLCBOVUxMLCBlcnJwKTsKICAgICBpZiAocmV0IDwgMCkgewogICAgICAgICBicy0+b3Bl
bl9mbGFncyB8PSBCRFJWX09fSU5BQ1RJVkU7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJw
LCBsb2NhbF9lcnIpOwogICAgICAgICByZXR1cm47CiAgICAgfQogICAgIGJkcnZfc2V0X3Blcm0o
YnMsIHBlcm0sIHNoYXJlZF9wZXJtKTsKIAogICAgIGlmIChicy0+ZHJ2LT5iZHJ2X2NvX2ludmFs
aWRhdGVfY2FjaGUpIHsKLSAgICAgICAgYnMtPmRydi0+YmRydl9jb19pbnZhbGlkYXRlX2NhY2hl
KGJzLCAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYgKGxvY2FsX2VycikgeworICAgICAgICBicy0+
ZHJ2LT5iZHJ2X2NvX2ludmFsaWRhdGVfY2FjaGUoYnMsIGVycnApOworICAgICAgICBpZiAoKmVy
cnApIHsKICAgICAgICAgICAgIGJzLT5vcGVuX2ZsYWdzIHw9IEJEUlZfT19JTkFDVElWRTsKLSAg
ICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogICAgICAgICAgICAg
cmV0dXJuOwogICAgICAgICB9CiAgICAgfQpAQCAtNTM3OCwxMCArNTMzNiw5IEBAIHN0YXRpYyB2
b2lkIGNvcm91dGluZV9mbiBiZHJ2X2NvX2ludmFsaWRhdGVfY2FjaGUoQmxvY2tEcml2ZXJTdGF0
ZSAqYnMsCiAKICAgICBRTElTVF9GT1JFQUNIKHBhcmVudCwgJmJzLT5wYXJlbnRzLCBuZXh0X3Bh
cmVudCkgewogICAgICAgICBpZiAocGFyZW50LT5yb2xlLT5hY3RpdmF0ZSkgewotICAgICAgICAg
ICAgcGFyZW50LT5yb2xlLT5hY3RpdmF0ZShwYXJlbnQsICZsb2NhbF9lcnIpOwotICAgICAgICAg
ICAgaWYgKGxvY2FsX2VycikgeworICAgICAgICAgICAgcGFyZW50LT5yb2xlLT5hY3RpdmF0ZShw
YXJlbnQsIGVycnApOworICAgICAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICAgICAg
YnMtPm9wZW5fZmxhZ3MgfD0gQkRSVl9PX0lOQUNUSVZFOwotICAgICAgICAgICAgICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogICAgICAgICAgICAgICAgIHJldHVybjsKICAg
ICAgICAgICAgIH0KICAgICAgICAgfQpAQCAtNTQyNCwxNyArNTM4MSwxNSBAQCB2b2lkIGJkcnZf
aW52YWxpZGF0ZV9jYWNoZShCbG9ja0RyaXZlclN0YXRlICpicywgRXJyb3IgKiplcnJwKQogdm9p
ZCBiZHJ2X2ludmFsaWRhdGVfY2FjaGVfYWxsKEVycm9yICoqZXJycCkKIHsKICAgICBCbG9ja0Ry
aXZlclN0YXRlICpiczsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBCZHJ2TmV4
dEl0ZXJhdG9yIGl0OwogCiAgICAgZm9yIChicyA9IGJkcnZfZmlyc3QoJml0KTsgYnM7IGJzID0g
YmRydl9uZXh0KCZpdCkpIHsKICAgICAgICAgQWlvQ29udGV4dCAqYWlvX2NvbnRleHQgPSBiZHJ2
X2dldF9haW9fY29udGV4dChicyk7CiAKICAgICAgICAgYWlvX2NvbnRleHRfYWNxdWlyZShhaW9f
Y29udGV4dCk7Ci0gICAgICAgIGJkcnZfaW52YWxpZGF0ZV9jYWNoZShicywgJmxvY2FsX2Vycik7
CisgICAgICAgIGJkcnZfaW52YWxpZGF0ZV9jYWNoZShicywgZXJycCk7CiAgICAgICAgIGFpb19j
b250ZXh0X3JlbGVhc2UoYWlvX2NvbnRleHQpOwotICAgICAgICBpZiAobG9jYWxfZXJyKSB7Ci0g
ICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgaWYg
KCplcnJwKSB7CiAgICAgICAgICAgICBiZHJ2X25leHRfY2xlYW51cCgmaXQpOwogICAgICAgICAg
ICAgcmV0dXJuOwogICAgICAgICB9CkBAIC01NzEwLDcgKzU2NjUsNiBAQCB2b2lkIGJkcnZfaW1n
X2NyZWF0ZShjb25zdCBjaGFyICpmaWxlbmFtZSwgY29uc3QgY2hhciAqZm10LAogICAgIGNvbnN0
IGNoYXIgKmJhY2tpbmdfZm10LCAqYmFja2luZ19maWxlOwogICAgIGludDY0X3Qgc2l6ZTsKICAg
ICBCbG9ja0RyaXZlciAqZHJ2LCAqcHJvdG9fZHJ2OwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBO
VUxMOwogICAgIGludCByZXQgPSAwOwogCiAgICAgLyogRmluZCBkcml2ZXIgYW5kIHBhcnNlIGl0
cyBvcHRpb25zICovCkBAIC01NzQ2LDE1ICs1NzAwLDE1IEBAIHZvaWQgYmRydl9pbWdfY3JlYXRl
KGNvbnN0IGNoYXIgKmZpbGVuYW1lLCBjb25zdCBjaGFyICpmbXQsCiAKICAgICAvKiBQYXJzZSAt
byBvcHRpb25zICovCiAgICAgaWYgKG9wdGlvbnMpIHsKLSAgICAgICAgcWVtdV9vcHRzX2RvX3Bh
cnNlKG9wdHMsIG9wdGlvbnMsIE5VTEwsICZsb2NhbF9lcnIpOwotICAgICAgICBpZiAobG9jYWxf
ZXJyKSB7CisgICAgICAgIHFlbXVfb3B0c19kb19wYXJzZShvcHRzLCBvcHRpb25zLCBOVUxMLCBl
cnJwKTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICBnb3RvIG91dDsKICAgICAg
ICAgfQogICAgIH0KIAogICAgIGlmIChiYXNlX2ZpbGVuYW1lKSB7Ci0gICAgICAgIHFlbXVfb3B0
X3NldChvcHRzLCBCTE9DS19PUFRfQkFDS0lOR19GSUxFLCBiYXNlX2ZpbGVuYW1lLCAmbG9jYWxf
ZXJyKTsKLSAgICAgICAgaWYgKGxvY2FsX2VycikgeworICAgICAgICBxZW11X29wdF9zZXQob3B0
cywgQkxPQ0tfT1BUX0JBQ0tJTkdfRklMRSwgYmFzZV9maWxlbmFtZSwgZXJycCk7CisgICAgICAg
IGlmICgqZXJycCkgewogICAgICAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAiQmFja2luZyBmaWxl
IG5vdCBzdXBwb3J0ZWQgZm9yIGZpbGUgZm9ybWF0ICclcyciLAogICAgICAgICAgICAgICAgICAg
ICAgICBmbXQpOwogICAgICAgICAgICAgZ290byBvdXQ7CkBAIC01NzYyLDggKzU3MTYsOCBAQCB2
b2lkIGJkcnZfaW1nX2NyZWF0ZShjb25zdCBjaGFyICpmaWxlbmFtZSwgY29uc3QgY2hhciAqZm10
LAogICAgIH0KIAogICAgIGlmIChiYXNlX2ZtdCkgewotICAgICAgICBxZW11X29wdF9zZXQob3B0
cywgQkxPQ0tfT1BUX0JBQ0tJTkdfRk1ULCBiYXNlX2ZtdCwgJmxvY2FsX2Vycik7Ci0gICAgICAg
IGlmIChsb2NhbF9lcnIpIHsKKyAgICAgICAgcWVtdV9vcHRfc2V0KG9wdHMsIEJMT0NLX09QVF9C
QUNLSU5HX0ZNVCwgYmFzZV9mbXQsIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKICAgICAg
ICAgICAgIGVycm9yX3NldGcoZXJycCwgIkJhY2tpbmcgZmlsZSBmb3JtYXQgbm90IHN1cHBvcnRl
ZCBmb3IgZmlsZSAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJmb3JtYXQgJyVzJyIs
IGZtdCk7CiAgICAgICAgICAgICBnb3RvIG91dDsKQEAgLTU3OTIsOCArNTc0Niw4IEBAIHZvaWQg
YmRydl9pbWdfY3JlYXRlKGNvbnN0IGNoYXIgKmZpbGVuYW1lLCBjb25zdCBjaGFyICpmbXQsCiAK
ICAgICAgICAgZnVsbF9iYWNraW5nID0KICAgICAgICAgICAgIGJkcnZfZ2V0X2Z1bGxfYmFja2lu
Z19maWxlbmFtZV9mcm9tX2ZpbGVuYW1lKGZpbGVuYW1lLCBiYWNraW5nX2ZpbGUsCi0gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmbG9jYWxf
ZXJyKTsKLSAgICAgICAgaWYgKGxvY2FsX2VycikgeworICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJycCk7CisgICAgICAgIGlmICgqZXJy
cCkgewogICAgICAgICAgICAgZ290byBvdXQ7CiAgICAgICAgIH0KICAgICAgICAgYXNzZXJ0KGZ1
bGxfYmFja2luZyk7CkBAIC01ODA5LDE3ICs1NzYzLDE3IEBAIHZvaWQgYmRydl9pbWdfY3JlYXRl
KGNvbnN0IGNoYXIgKmZpbGVuYW1lLCBjb25zdCBjaGFyICpmbXQsCiAgICAgICAgIHFkaWN0X3B1
dF9ib29sKGJhY2tpbmdfb3B0aW9ucywgQkRSVl9PUFRfRk9SQ0VfU0hBUkUsIHRydWUpOwogCiAg
ICAgICAgIGJzID0gYmRydl9vcGVuKGZ1bGxfYmFja2luZywgTlVMTCwgYmFja2luZ19vcHRpb25z
LCBiYWNrX2ZsYWdzLAotICAgICAgICAgICAgICAgICAgICAgICAmbG9jYWxfZXJyKTsKKyAgICAg
ICAgICAgICAgICAgICAgICAgZXJycCk7CiAgICAgICAgIGdfZnJlZShmdWxsX2JhY2tpbmcpOwog
ICAgICAgICBpZiAoIWJzICYmIHNpemUgIT0gLTEpIHsKICAgICAgICAgICAgIC8qIENvdWxkbid0
IG9wZW4gQlMsIGJ1dCB3ZSBoYXZlIGEgc2l6ZSwgc28gaXQncyBub25mYXRhbCAqLwotICAgICAg
ICAgICAgd2Fybl9yZXBvcnRmX2Vycihsb2NhbF9lcnIsCi0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIkNvdWxkIG5vdCB2ZXJpZnkgYmFja2luZyBpbWFnZS4gIgotICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICJUaGlzIG1heSBiZWNvbWUgYW4gZXJyb3IgaW4gZnV0dXJlIHZlcnNpb25z
LlxuIik7Ci0gICAgICAgICAgICBsb2NhbF9lcnIgPSBOVUxMOworICAgICAgICAgICAgd2Fybl9y
ZXBvcnRmX2VycigqZXJycCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIkNvdWxkIG5v
dCB2ZXJpZnkgYmFja2luZyBpbWFnZS4gIgorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAi
VGhpcyBtYXkgYmVjb21lIGFuIGVycm9yIGluIGZ1dHVyZSB2ZXJzaW9ucy5cbiIpOworICAgICAg
ICAgICAgKmVycnAgPSBOVUxMOwogICAgICAgICB9IGVsc2UgaWYgKCFicykgewogICAgICAgICAg
ICAgLyogQ291bGRuJ3Qgb3BlbiBicywgZG8gbm90IGhhdmUgc2l6ZSAqLwotICAgICAgICAgICAg
ZXJyb3JfYXBwZW5kX2hpbnQoJmxvY2FsX2VyciwKKyAgICAgICAgICAgIGVycm9yX2FwcGVuZF9o
aW50KGVycnAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQ291bGQgbm90IG9wZW4g
YmFja2luZyBpbWFnZSB0byBkZXRlcm1pbmUgc2l6ZS5cbiIpOwogICAgICAgICAgICAgZ290byBv
dXQ7CiAgICAgICAgIH0gZWxzZSB7CkBAIC01ODQ5LDcgKzU4MDMsNyBAQCB2b2lkIGJkcnZfaW1n
X2NyZWF0ZShjb25zdCBjaGFyICpmaWxlbmFtZSwgY29uc3QgY2hhciAqZm10LAogICAgICAgICBw
dXRzKCIiKTsKICAgICB9CiAKLSAgICByZXQgPSBiZHJ2X2NyZWF0ZShkcnYsIGZpbGVuYW1lLCBv
cHRzLCAmbG9jYWxfZXJyKTsKKyAgICByZXQgPSBiZHJ2X2NyZWF0ZShkcnYsIGZpbGVuYW1lLCBv
cHRzLCBlcnJwKTsKIAogICAgIGlmIChyZXQgPT0gLUVGQklHKSB7CiAgICAgICAgIC8qIFRoaXMg
aXMgZ2VuZXJhbGx5IGEgYmV0dGVyIG1lc3NhZ2UgdGhhbiB3aGF0ZXZlciB0aGUgZHJpdmVyIHdv
dWxkCkBAIC01ODYxLDE0ICs1ODE1LDEyIEBAIHZvaWQgYmRydl9pbWdfY3JlYXRlKGNvbnN0IGNo
YXIgKmZpbGVuYW1lLCBjb25zdCBjaGFyICpmbXQsCiAgICAgICAgIH0KICAgICAgICAgZXJyb3Jf
c2V0ZyhlcnJwLCAiVGhlIGltYWdlIHNpemUgaXMgdG9vIGxhcmdlIGZvciBmaWxlIGZvcm1hdCAn
JXMnIgogICAgICAgICAgICAgICAgICAgICIlcyIsIGZtdCwgY2x1c3Rlcl9zaXplX2hpbnQpOwot
ICAgICAgICBlcnJvcl9mcmVlKGxvY2FsX2Vycik7Ci0gICAgICAgIGxvY2FsX2VyciA9IE5VTEw7
CisgICAgICAgIGVycm9yX2ZyZWVfZXJycChlcnJwKTsKICAgICB9CiAKIG91dDoKICAgICBxZW11
X29wdHNfZGVsKG9wdHMpOwogICAgIHFlbXVfb3B0c19mcmVlKGNyZWF0ZV9vcHRzKTsKLSAgICBl
cnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKIH0KIAogQWlvQ29udGV4dCAqYmRydl9n
ZXRfYWlvX2NvbnRleHQoQmxvY2tEcml2ZXJTdGF0ZSAqYnMpCmRpZmYgLS1naXQgYS9ibG9jay9i
bGtkZWJ1Zy5jIGIvYmxvY2svYmxrZGVidWcuYwppbmRleCA1YWU5NmM1MmIwLi45MThjY2Y1NzA0
IDEwMDY0NAotLS0gYS9ibG9jay9ibGtkZWJ1Zy5jCisrKyBiL2Jsb2NrL2Jsa2RlYnVnLmMKQEAg
LTE3MSw3ICsxNzEsNiBAQCBzdGF0aWMgaW50IGFkZF9ydWxlKHZvaWQgKm9wYXF1ZSwgUWVtdU9w
dHMgKm9wdHMsIEVycm9yICoqZXJycCkKICAgICBzdHJ1Y3QgQmxrZGVidWdSdWxlICpydWxlOwog
ICAgIGludDY0X3Qgc2VjdG9yOwogICAgIEJsa2RlYnVnSU9UeXBlIGlvdHlwZTsKLSAgICBFcnJv
ciAqbG9jYWxfZXJyb3IgPSBOVUxMOwogCiAgICAgLyogRmluZCB0aGUgcmlnaHQgZXZlbnQgZm9y
IHRoZSBydWxlICovCiAgICAgZXZlbnRfbmFtZSA9IHFlbXVfb3B0X2dldChvcHRzLCAiZXZlbnQi
KTsKQEAgLTIwNSw5ICsyMDQsOCBAQCBzdGF0aWMgaW50IGFkZF9ydWxlKHZvaWQgKm9wYXF1ZSwg
UWVtdU9wdHMgKm9wdHMsIEVycm9yICoqZXJycCkKIAogICAgICAgICBpb3R5cGUgPSBxYXBpX2Vu
dW1fcGFyc2UoJkJsa2RlYnVnSU9UeXBlX2xvb2t1cCwKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHFlbXVfb3B0X2dldChvcHRzLCAiaW90eXBlIiksCi0gICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBCTEtERUJVR19JT19UWVBFX19NQVgsICZsb2NhbF9lcnJvcik7Ci0g
ICAgICAgIGlmIChsb2NhbF9lcnJvcikgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVy
cnAsIGxvY2FsX2Vycm9yKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJMS0RF
QlVHX0lPX1RZUEVfX01BWCwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAg
ICAgcmV0dXJuIC0xOwogICAgICAgICB9CiAgICAgICAgIGlmIChpb3R5cGUgIT0gQkxLREVCVUdf
SU9fVFlQRV9fTUFYKSB7CkBAIC0yNjIsNyArMjYwLDYgQEAgc3RhdGljIGludCByZWFkX2NvbmZp
ZyhCRFJWQmxrZGVidWdTdGF0ZSAqcywgY29uc3QgY2hhciAqZmlsZW5hbWUsCiAgICAgRklMRSAq
ZiA9IE5VTEw7CiAgICAgaW50IHJldDsKICAgICBzdHJ1Y3QgYWRkX3J1bGVfZGF0YSBkOwotICAg
IEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgaWYgKGZpbGVuYW1lKSB7CiAgICAgICAg
IGYgPSBmb3BlbihmaWxlbmFtZSwgInIiKTsKQEAgLTI3OCwyNiArMjc1LDIzIEBAIHN0YXRpYyBp
bnQgcmVhZF9jb25maWcoQkRSVkJsa2RlYnVnU3RhdGUgKnMsIGNvbnN0IGNoYXIgKmZpbGVuYW1l
LAogICAgICAgICB9CiAgICAgfQogCi0gICAgcWVtdV9jb25maWdfcGFyc2VfcWRpY3Qob3B0aW9u
cywgY29uZmlnX2dyb3VwcywgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAg
ICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBxZW11X2NvbmZpZ19w
YXJzZV9xZGljdChvcHRpb25zLCBjb25maWdfZ3JvdXBzLCBlcnJwKTsKKyAgICBpZiAoKmVycnAp
IHsKICAgICAgICAgcmV0ID0gLUVJTlZBTDsKICAgICAgICAgZ290byBmYWlsOwogICAgIH0KIAog
ICAgIGQucyA9IHM7CiAgICAgZC5hY3Rpb24gPSBBQ1RJT05fSU5KRUNUX0VSUk9SOwotICAgIHFl
bXVfb3B0c19mb3JlYWNoKCZpbmplY3RfZXJyb3Jfb3B0cywgYWRkX3J1bGUsICZkLCAmbG9jYWxf
ZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJw
LCBsb2NhbF9lcnIpOworICAgIHFlbXVfb3B0c19mb3JlYWNoKCZpbmplY3RfZXJyb3Jfb3B0cywg
YWRkX3J1bGUsICZkLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0ID0gLUVJ
TlZBTDsKICAgICAgICAgZ290byBmYWlsOwogICAgIH0KIAogICAgIGQuYWN0aW9uID0gQUNUSU9O
X1NFVF9TVEFURTsKLSAgICBxZW11X29wdHNfZm9yZWFjaCgmc2V0X3N0YXRlX29wdHMsIGFkZF9y
dWxlLCAmZCwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJv
cl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBxZW11X29wdHNfZm9yZWFjaCgmc2V0
X3N0YXRlX29wdHMsIGFkZF9ydWxlLCAmZCwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAg
ICAgIHJldCA9IC1FSU5WQUw7CiAgICAgICAgIGdvdG8gZmFpbDsKICAgICB9CkBAIC0zOTcsMTQg
KzM5MSwxMiBAQCBzdGF0aWMgaW50IGJsa2RlYnVnX29wZW4oQmxvY2tEcml2ZXJTdGF0ZSAqYnMs
IFFEaWN0ICpvcHRpb25zLCBpbnQgZmxhZ3MsCiB7CiAgICAgQkRSVkJsa2RlYnVnU3RhdGUgKnMg
PSBicy0+b3BhcXVlOwogICAgIFFlbXVPcHRzICpvcHRzOwotICAgIEVycm9yICpsb2NhbF9lcnIg
PSBOVUxMOwogICAgIGludCByZXQ7CiAgICAgdWludDY0X3QgYWxpZ247CiAKICAgICBvcHRzID0g
cWVtdV9vcHRzX2NyZWF0ZSgmcnVudGltZV9vcHRzLCBOVUxMLCAwLCAmZXJyb3JfYWJvcnQpOwot
ICAgIHFlbXVfb3B0c19hYnNvcmJfcWRpY3Qob3B0cywgb3B0aW9ucywgJmxvY2FsX2Vycik7Ci0g
ICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxf
ZXJyKTsKKyAgICBxZW11X29wdHNfYWJzb3JiX3FkaWN0KG9wdHMsIG9wdGlvbnMsIGVycnApOwor
ICAgIGlmICgqZXJycCkgewogICAgICAgICByZXQgPSAtRUlOVkFMOwogICAgICAgICBnb3RvIG91
dDsKICAgICB9CkBAIC00MjEsMTAgKzQxMyw5IEBAIHN0YXRpYyBpbnQgYmxrZGVidWdfb3BlbihC
bG9ja0RyaXZlclN0YXRlICpicywgUURpY3QgKm9wdGlvbnMsIGludCBmbGFncywKIAogICAgIC8q
IE9wZW4gdGhlIGltYWdlIGZpbGUgKi8KICAgICBicy0+ZmlsZSA9IGJkcnZfb3Blbl9jaGlsZChx
ZW11X29wdF9nZXQob3B0cywgIngtaW1hZ2UiKSwgb3B0aW9ucywgImltYWdlIiwKLSAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBicywgJmNoaWxkX2ZpbGUsIGZhbHNlLCAmbG9jYWxfZXJy
KTsKLSAgICBpZiAobG9jYWxfZXJyKSB7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
YnMsICZjaGlsZF9maWxlLCBmYWxzZSwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAg
IHJldCA9IC1FSU5WQUw7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIp
OwogICAgICAgICBnb3RvIG91dDsKICAgICB9CiAKZGlmZiAtLWdpdCBhL2Jsb2NrL2Jsa2xvZ3dy
aXRlcy5jIGIvYmxvY2svYmxrbG9nd3JpdGVzLmMKaW5kZXggMDRkOGIzMzYwNy4uNjI0NTVkYzY4
NCAxMDA2NDQKLS0tIGEvYmxvY2svYmxrbG9nd3JpdGVzLmMKKysrIGIvYmxvY2svYmxrbG9nd3Jp
dGVzLmMKQEAgLTE0MywzNCArMTQzLDMwIEBAIHN0YXRpYyBpbnQgYmxrX2xvZ193cml0ZXNfb3Bl
bihCbG9ja0RyaXZlclN0YXRlICpicywgUURpY3QgKm9wdGlvbnMsIGludCBmbGFncywKIHsKICAg
ICBCRFJWQmxrTG9nV3JpdGVzU3RhdGUgKnMgPSBicy0+b3BhcXVlOwogICAgIFFlbXVPcHRzICpv
cHRzOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIGludCByZXQ7CiAgICAgdWlu
dDY0X3QgbG9nX3NlY3Rvcl9zaXplOwogICAgIGJvb2wgbG9nX2FwcGVuZDsKIAogICAgIG9wdHMg
PSBxZW11X29wdHNfY3JlYXRlKCZydW50aW1lX29wdHMsIE5VTEwsIDAsICZlcnJvcl9hYm9ydCk7
Ci0gICAgcWVtdV9vcHRzX2Fic29yYl9xZGljdChvcHRzLCBvcHRpb25zLCAmbG9jYWxfZXJyKTsK
LSAgICBpZiAobG9jYWxfZXJyKSB7CisgICAgcWVtdV9vcHRzX2Fic29yYl9xZGljdChvcHRzLCBv
cHRpb25zLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0ID0gLUVJTlZBTDsK
LSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CiAgICAgICAgIGdvdG8g
ZmFpbDsKICAgICB9CiAKICAgICAvKiBPcGVuIHRoZSBmaWxlICovCiAgICAgYnMtPmZpbGUgPSBi
ZHJ2X29wZW5fY2hpbGQoTlVMTCwgb3B0aW9ucywgImZpbGUiLCBicywgJmNoaWxkX2ZpbGUsIGZh
bHNlLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZsb2NhbF9lcnIpOwotICAgIGlm
IChsb2NhbF9lcnIpIHsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJwKTsKKyAg
ICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0ID0gLUVJTlZBTDsKLSAgICAgICAgZXJyb3JfcHJv
cGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CiAgICAgICAgIGdvdG8gZmFpbDsKICAgICB9CiAKICAg
ICAvKiBPcGVuIHRoZSBsb2cgZmlsZSAqLwogICAgIHMtPmxvZ19maWxlID0gYmRydl9vcGVuX2No
aWxkKE5VTEwsIG9wdGlvbnMsICJsb2ciLCBicywgJmNoaWxkX2ZpbGUsIGZhbHNlLAotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9l
cnIpIHsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJwKTsKKyAgICBpZiAo
KmVycnApIHsKICAgICAgICAgcmV0ID0gLUVJTlZBTDsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRl
KGVycnAsIGxvY2FsX2Vycik7CiAgICAgICAgIGdvdG8gZmFpbDsKICAgICB9CiAKQEAgLTIyMCwx
MCArMjE2LDkgQEAgc3RhdGljIGludCBibGtfbG9nX3dyaXRlc19vcGVuKEJsb2NrRHJpdmVyU3Rh
dGUgKmJzLCBRRGljdCAqb3B0aW9ucywgaW50IGZsYWdzLAogICAgICAgICBpZiAoYmxrX2xvZ193
cml0ZXNfc2VjdG9yX3NpemVfdmFsaWQobG9nX3NlY3Rvcl9zaXplKSkgewogICAgICAgICAgICAg
cy0+Y3VyX2xvZ19zZWN0b3IgPQogICAgICAgICAgICAgICAgIGJsa19sb2dfd3JpdGVzX2ZpbmRf
Y3VyX2xvZ19zZWN0b3Iocy0+bG9nX2ZpbGUsIGxvZ19zZWN0b3Jfc2l6ZSwKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGxlNjRfdG9fY3B1KGxvZ19zYi5ucl9lbnRyaWVzKSwg
JmxvY2FsX2Vycik7Ci0gICAgICAgICAgICBpZiAobG9jYWxfZXJyKSB7CisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBsZTY0X3RvX2NwdShsb2dfc2IubnJfZW50cmllcyksIGVy
cnApOworICAgICAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICAgICAgcmV0ID0gLUVJ
TlZBTDsKLSAgICAgICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsK
ICAgICAgICAgICAgICAgICBnb3RvIGZhaWxfbG9nOwogICAgICAgICAgICAgfQogCmRpZmYgLS1n
aXQgYS9ibG9jay9ibGtyZXBsYXkuYyBiL2Jsb2NrL2Jsa3JlcGxheS5jCmluZGV4IDJiNzkzMWI5
NDAuLjc0ZDJiYTdmOWIgMTAwNjQ0Ci0tLSBhL2Jsb2NrL2Jsa3JlcGxheS5jCisrKyBiL2Jsb2Nr
L2Jsa3JlcGxheS5jCkBAIC0yMywxNSArMjMsMTMgQEAgdHlwZWRlZiBzdHJ1Y3QgUmVxdWVzdCB7
CiBzdGF0aWMgaW50IGJsa3JlcGxheV9vcGVuKEJsb2NrRHJpdmVyU3RhdGUgKmJzLCBRRGljdCAq
b3B0aW9ucywgaW50IGZsYWdzLAogICAgICAgICAgICAgICAgICAgICAgICAgICBFcnJvciAqKmVy
cnApCiB7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgaW50IHJldDsKIAogICAg
IC8qIE9wZW4gdGhlIGltYWdlIGZpbGUgKi8KICAgICBicy0+ZmlsZSA9IGJkcnZfb3Blbl9jaGls
ZChOVUxMLCBvcHRpb25zLCAiaW1hZ2UiLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGJzLCAmY2hpbGRfZmlsZSwgZmFsc2UsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIp
IHsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicywgJmNoaWxkX2ZpbGUsIGZhbHNl
LCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0ID0gLUVJTlZBTDsKLSAgICAg
ICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CiAgICAgICAgIGdvdG8gZmFpbDsK
ICAgICB9CiAKZGlmZiAtLWdpdCBhL2Jsb2NrL2Jsa3ZlcmlmeS5jIGIvYmxvY2svYmxrdmVyaWZ5
LmMKaW5kZXggMzA0YjBhMTM2OC4uMGZkZGY5NGYwZiAxMDA2NDQKLS0tIGEvYmxvY2svYmxrdmVy
aWZ5LmMKKysrIGIvYmxvY2svYmxrdmVyaWZ5LmMKQEAgLTExMiwzMyArMTEyLDI5IEBAIHN0YXRp
YyBpbnQgYmxrdmVyaWZ5X29wZW4oQmxvY2tEcml2ZXJTdGF0ZSAqYnMsIFFEaWN0ICpvcHRpb25z
LCBpbnQgZmxhZ3MsCiB7CiAgICAgQkRSVkJsa3ZlcmlmeVN0YXRlICpzID0gYnMtPm9wYXF1ZTsK
ICAgICBRZW11T3B0cyAqb3B0czsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBp
bnQgcmV0OwogCiAgICAgb3B0cyA9IHFlbXVfb3B0c19jcmVhdGUoJnJ1bnRpbWVfb3B0cywgTlVM
TCwgMCwgJmVycm9yX2Fib3J0KTsKLSAgICBxZW11X29wdHNfYWJzb3JiX3FkaWN0KG9wdHMsIG9w
dGlvbnMsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3Jf
cHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgcWVtdV9vcHRzX2Fic29yYl9xZGljdChv
cHRzLCBvcHRpb25zLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0ID0gLUVJ
TlZBTDsKICAgICAgICAgZ290byBmYWlsOwogICAgIH0KIAogICAgIC8qIE9wZW4gdGhlIHJhdyBm
aWxlICovCiAgICAgYnMtPmZpbGUgPSBiZHJ2X29wZW5fY2hpbGQocWVtdV9vcHRfZ2V0KG9wdHMs
ICJ4LXJhdyIpLCBvcHRpb25zLCAicmF3IiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBicywgJmNoaWxkX2ZpbGUsIGZhbHNlLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJy
KSB7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnMsICZjaGlsZF9maWxlLCBmYWxz
ZSwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldCA9IC1FSU5WQUw7Ci0gICAg
ICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogICAgICAgICBnb3RvIGZhaWw7
CiAgICAgfQogCiAgICAgLyogT3BlbiB0aGUgdGVzdCBmaWxlICovCiAgICAgcy0+dGVzdF9maWxl
ID0gYmRydl9vcGVuX2NoaWxkKHFlbXVfb3B0X2dldChvcHRzLCAieC1pbWFnZSIpLCBvcHRpb25z
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidGVzdCIsIGJzLCAmY2hpbGRf
Zm9ybWF0LCBmYWxzZSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJmxvY2Fs
X2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgeworICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0ID0gLUVJTlZBTDsK
LSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CiAgICAgICAgIGdvdG8g
ZmFpbDsKICAgICB9CiAKZGlmZiAtLWdpdCBhL2Jsb2NrL2Jsb2NrLWJhY2tlbmQuYyBiL2Jsb2Nr
L2Jsb2NrLWJhY2tlbmQuYwppbmRleCAxYzYwNWQ1NDQ0Li4zNzFlZmViMWM4IDEwMDY0NAotLS0g
YS9ibG9jay9ibG9jay1iYWNrZW5kLmMKKysrIGIvYmxvY2svYmxvY2stYmFja2VuZC5jCkBAIC0x
ODcsNyArMTg3LDYgQEAgc3RhdGljIHZvaWQgYmxrX3ZtX3N0YXRlX2NoYW5nZWQodm9pZCAqb3Bh
cXVlLCBpbnQgcnVubmluZywgUnVuU3RhdGUgc3RhdGUpCiBzdGF0aWMgdm9pZCBibGtfcm9vdF9h
Y3RpdmF0ZShCZHJ2Q2hpbGQgKmNoaWxkLCBFcnJvciAqKmVycnApCiB7CiAgICAgQmxvY2tCYWNr
ZW5kICpibGsgPSBjaGlsZC0+b3BhcXVlOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwog
CiAgICAgaWYgKCFibGstPmRpc2FibGVfcGVybSkgewogICAgICAgICByZXR1cm47CkBAIC0xOTUs
OSArMTk0LDggQEAgc3RhdGljIHZvaWQgYmxrX3Jvb3RfYWN0aXZhdGUoQmRydkNoaWxkICpjaGls
ZCwgRXJyb3IgKiplcnJwKQogCiAgICAgYmxrLT5kaXNhYmxlX3Blcm0gPSBmYWxzZTsKIAotICAg
IGJsa19zZXRfcGVybShibGssIGJsay0+cGVybSwgQkxLX1BFUk1fQUxMLCAmbG9jYWxfZXJyKTsK
LSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2Nh
bF9lcnIpOworICAgIGJsa19zZXRfcGVybShibGssIGJsay0+cGVybSwgQkxLX1BFUk1fQUxMLCBl
cnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgYmxrLT5kaXNhYmxlX3Blcm0gPSB0cnVl
OwogICAgICAgICByZXR1cm47CiAgICAgfQpAQCAtMjEzLDkgKzIxMSw4IEBAIHN0YXRpYyB2b2lk
IGJsa19yb290X2FjdGl2YXRlKEJkcnZDaGlsZCAqY2hpbGQsIEVycm9yICoqZXJycCkKICAgICAg
ICAgcmV0dXJuOwogICAgIH0KIAotICAgIGJsa19zZXRfcGVybShibGssIGJsay0+cGVybSwgYmxr
LT5zaGFyZWRfcGVybSwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAg
ICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBibGtfc2V0X3Blcm0oYmxr
LCBibGstPnBlcm0sIGJsay0+c2hhcmVkX3Blcm0sIGVycnApOworICAgIGlmICgqZXJycCkgewog
ICAgICAgICBibGstPmRpc2FibGVfcGVybSA9IHRydWU7CiAgICAgICAgIHJldHVybjsKICAgICB9
CkBAIC05NjMsMTMgKzk2MCwxMSBAQCB2b2lkIGJsa19kZXZfY2hhbmdlX21lZGlhX2NiKEJsb2Nr
QmFja2VuZCAqYmxrLCBib29sIGxvYWQsIEVycm9yICoqZXJycCkKIHsKICAgICBpZiAoYmxrLT5k
ZXZfb3BzICYmIGJsay0+ZGV2X29wcy0+Y2hhbmdlX21lZGlhX2NiKSB7CiAgICAgICAgIGJvb2wg
dHJheV93YXNfb3BlbiwgdHJheV9pc19vcGVuOwotICAgICAgICBFcnJvciAqbG9jYWxfZXJyID0g
TlVMTDsKIAogICAgICAgICB0cmF5X3dhc19vcGVuID0gYmxrX2Rldl9pc190cmF5X29wZW4oYmxr
KTsKLSAgICAgICAgYmxrLT5kZXZfb3BzLT5jaGFuZ2VfbWVkaWFfY2IoYmxrLT5kZXZfb3BhcXVl
LCBsb2FkLCAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYgKGxvY2FsX2VycikgeworICAgICAgICBi
bGstPmRldl9vcHMtPmNoYW5nZV9tZWRpYV9jYihibGstPmRldl9vcGFxdWUsIGxvYWQsIGVycnAp
OworICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIGFzc2VydChsb2FkID09IHRydWUp
OwotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CiAgICAgICAg
ICAgICByZXR1cm47CiAgICAgICAgIH0KICAgICAgICAgdHJheV9pc19vcGVuID0gYmxrX2Rldl9p
c190cmF5X29wZW4oYmxrKTsKZGlmZiAtLWdpdCBhL2Jsb2NrL2NvbW1pdC5jIGIvYmxvY2svY29t
bWl0LmMKaW5kZXggYmM4NDU0NDYzZC4uYWE1NTQxZWNmMSAxMDA2NDQKLS0tIGEvYmxvY2svY29t
bWl0LmMKKysrIGIvYmxvY2svY29tbWl0LmMKQEAgLTI2NCw3ICsyNjQsNiBAQCB2b2lkIGNvbW1p
dF9zdGFydChjb25zdCBjaGFyICpqb2JfaWQsIEJsb2NrRHJpdmVyU3RhdGUgKmJzLAogICAgIENv
bW1pdEJsb2NrSm9iICpzOwogICAgIEJsb2NrRHJpdmVyU3RhdGUgKml0ZXI7CiAgICAgQmxvY2tE
cml2ZXJTdGF0ZSAqY29tbWl0X3RvcF9icyA9IE5VTEw7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9
IE5VTEw7CiAgICAgaW50IHJldDsKIAogICAgIGFzc2VydCh0b3AgIT0gYnMpOwpAQCAtMzAzLDEw
ICszMDIsOSBAQCB2b2lkIGNvbW1pdF9zdGFydChjb25zdCBjaGFyICpqb2JfaWQsIEJsb2NrRHJp
dmVyU3RhdGUgKmJzLAogCiAgICAgY29tbWl0X3RvcF9icy0+dG90YWxfc2VjdG9ycyA9IHRvcC0+
dG90YWxfc2VjdG9yczsKIAotICAgIGJkcnZfYXBwZW5kKGNvbW1pdF90b3BfYnMsIHRvcCwgJmxv
Y2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgeworICAgIGJkcnZfYXBwZW5kKGNvbW1pdF90
b3BfYnMsIHRvcCwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGNvbW1pdF90b3Bf
YnMgPSBOVUxMOwotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKICAg
ICAgICAgZ290byBmYWlsOwogICAgIH0KIApkaWZmIC0tZ2l0IGEvYmxvY2svY3J5cHRvLmMgYi9i
bG9jay9jcnlwdG8uYwppbmRleCA3ZWI2OTg3NzRlLi4zODk5NWY3NDkwIDEwMDY0NAotLS0gYS9i
bG9jay9jcnlwdG8uYworKysgYi9ibG9jay9jcnlwdG8uYwpAQCAtMTk0LDcgKzE5NCw2IEBAIHN0
YXRpYyBpbnQgYmxvY2tfY3J5cHRvX29wZW5fZ2VuZXJpYyhRQ3J5cHRvQmxvY2tGb3JtYXQgZm9y
bWF0LAogewogICAgIEJsb2NrQ3J5cHRvICpjcnlwdG8gPSBicy0+b3BhcXVlOwogICAgIFFlbXVP
cHRzICpvcHRzID0gTlVMTDsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBpbnQg
cmV0ID0gLUVJTlZBTDsKICAgICBRQ3J5cHRvQmxvY2tPcGVuT3B0aW9ucyAqb3Blbl9vcHRzID0g
TlVMTDsKICAgICB1bnNpZ25lZCBpbnQgY2ZsYWdzID0gMDsKQEAgLTIxMCw5ICsyMDksOCBAQCBz
dGF0aWMgaW50IGJsb2NrX2NyeXB0b19vcGVuX2dlbmVyaWMoUUNyeXB0b0Jsb2NrRm9ybWF0IGZv
cm1hdCwKICAgICAgICAgYnMtPmZpbGUtPmJzLT5zdXBwb3J0ZWRfd3JpdGVfZmxhZ3M7CiAKICAg
ICBvcHRzID0gcWVtdV9vcHRzX2NyZWF0ZShvcHRzX3NwZWMsIE5VTEwsIDAsICZlcnJvcl9hYm9y
dCk7Ci0gICAgcWVtdV9vcHRzX2Fic29yYl9xZGljdChvcHRzLCBvcHRpb25zLCAmbG9jYWxfZXJy
KTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBs
b2NhbF9lcnIpOworICAgIHFlbXVfb3B0c19hYnNvcmJfcWRpY3Qob3B0cywgb3B0aW9ucywgZXJy
cCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8gY2xlYW51cDsKICAgICB9CiAKQEAg
LTU1MCwxNyArNTQ4LDE1IEBAIHN0YXRpYyBpbnQgY29yb3V0aW5lX2ZuIGJsb2NrX2NyeXB0b19j
b19jcmVhdGVfb3B0c19sdWtzKGNvbnN0IGNoYXIgKmZpbGVuYW1lLAogICAgIGNoYXIgKmJ1ZiA9
IE5VTEw7CiAgICAgaW50NjRfdCBzaXplOwogICAgIGludCByZXQ7Ci0gICAgRXJyb3IgKmxvY2Fs
X2VyciA9IE5VTEw7CiAKICAgICAvKiBQYXJzZSBvcHRpb25zICovCiAgICAgc2l6ZSA9IHFlbXVf
b3B0X2dldF9zaXplX2RlbChvcHRzLCBCTE9DS19PUFRfU0laRSwgMCk7CiAKICAgICBidWYgPSBx
ZW11X29wdF9nZXRfZGVsKG9wdHMsIEJMT0NLX09QVF9QUkVBTExPQyk7CiAgICAgcHJlYWxsb2Mg
PSBxYXBpX2VudW1fcGFyc2UoJlByZWFsbG9jTW9kZV9sb29rdXAsIGJ1ZiwKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBQUkVBTExPQ19NT0RFX09GRiwgJmxvY2FsX2Vycik7CisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgUFJFQUxMT0NfTU9ERV9PRkYsIGVycnApOwogICAg
IGdfZnJlZShidWYpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFn
YXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybiAt
RUlOVkFMOwogICAgIH0KIApkaWZmIC0tZ2l0IGEvYmxvY2svY3VybC5jIGIvYmxvY2svY3VybC5j
CmluZGV4IGY4NjI5OTM3OGUuLjczYzcwMDYwOTYgMTAwNjQ0Ci0tLSBhL2Jsb2NrL2N1cmwuYwor
KysgYi9ibG9jay9jdXJsLmMKQEAgLTY0NSw3ICs2NDUsNiBAQCBzdGF0aWMgaW50IGN1cmxfb3Bl
bihCbG9ja0RyaXZlclN0YXRlICpicywgUURpY3QgKm9wdGlvbnMsIGludCBmbGFncywKICAgICBC
RFJWQ1VSTFN0YXRlICpzID0gYnMtPm9wYXF1ZTsKICAgICBDVVJMU3RhdGUgKnN0YXRlID0gTlVM
TDsKICAgICBRZW11T3B0cyAqb3B0czsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAg
ICBjb25zdCBjaGFyICpmaWxlOwogICAgIGNvbnN0IGNoYXIgKmNvb2tpZTsKICAgICBjb25zdCBj
aGFyICpjb29raWVfc2VjcmV0OwpAQCAtNjcxLDkgKzY3MCw4IEBAIHN0YXRpYyBpbnQgY3VybF9v
cGVuKEJsb2NrRHJpdmVyU3RhdGUgKmJzLCBRRGljdCAqb3B0aW9ucywgaW50IGZsYWdzLAogCiAg
ICAgcWVtdV9tdXRleF9pbml0KCZzLT5tdXRleCk7CiAgICAgb3B0cyA9IHFlbXVfb3B0c19jcmVh
dGUoJnJ1bnRpbWVfb3B0cywgTlVMTCwgMCwgJmVycm9yX2Fib3J0KTsKLSAgICBxZW11X29wdHNf
YWJzb3JiX3FkaWN0KG9wdHMsIG9wdGlvbnMsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9l
cnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgcWVt
dV9vcHRzX2Fic29yYl9xZGljdChvcHRzLCBvcHRpb25zLCBlcnJwKTsKKyAgICBpZiAoKmVycnAp
IHsKICAgICAgICAgZ290byBvdXRfbm9jbGVhbjsKICAgICB9CiAKZGlmZiAtLWdpdCBhL2Jsb2Nr
L2ZpbGUtcG9zaXguYyBiL2Jsb2NrL2ZpbGUtcG9zaXguYwppbmRleCBmMTJjMDZkZTJkLi5mZjM0
NjVhZjI0IDEwMDY0NAotLS0gYS9ibG9jay9maWxlLXBvc2l4LmMKKysrIGIvYmxvY2svZmlsZS1w
b3NpeC5jCkBAIC00NzUsNyArNDc1LDYgQEAgc3RhdGljIGludCByYXdfb3Blbl9jb21tb24oQmxv
Y2tEcml2ZXJTdGF0ZSAqYnMsIFFEaWN0ICpvcHRpb25zLAogewogICAgIEJEUlZSYXdTdGF0ZSAq
cyA9IGJzLT5vcGFxdWU7CiAgICAgUWVtdU9wdHMgKm9wdHM7Ci0gICAgRXJyb3IgKmxvY2FsX2Vy
ciA9IE5VTEw7CiAgICAgY29uc3QgY2hhciAqZmlsZW5hbWUgPSBOVUxMOwogICAgIGNvbnN0IGNo
YXIgKnN0cjsKICAgICBCbG9ja2RldkFpb09wdGlvbnMgYWlvLCBhaW9fZGVmYXVsdDsKQEAgLTQ4
NCw5ICs0ODMsOCBAQCBzdGF0aWMgaW50IHJhd19vcGVuX2NvbW1vbihCbG9ja0RyaXZlclN0YXRl
ICpicywgUURpY3QgKm9wdGlvbnMsCiAgICAgT25PZmZBdXRvIGxvY2tpbmc7CiAKICAgICBvcHRz
ID0gcWVtdV9vcHRzX2NyZWF0ZSgmcmF3X3J1bnRpbWVfb3B0cywgTlVMTCwgMCwgJmVycm9yX2Fi
b3J0KTsKLSAgICBxZW11X29wdHNfYWJzb3JiX3FkaWN0KG9wdHMsIG9wdGlvbnMsICZsb2NhbF9l
cnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAs
IGxvY2FsX2Vycik7CisgICAgcWVtdV9vcHRzX2Fic29yYl9xZGljdChvcHRzLCBvcHRpb25zLCBl
cnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0ID0gLUVJTlZBTDsKICAgICAgICAg
Z290byBmYWlsOwogICAgIH0KQEAgLTUwMyw5ICs1MDEsOCBAQCBzdGF0aWMgaW50IHJhd19vcGVu
X2NvbW1vbihCbG9ja0RyaXZlclN0YXRlICpicywgUURpY3QgKm9wdGlvbnMsCiAgICAgICAgICAg
ICAgICAgICA6IEJMT0NLREVWX0FJT19PUFRJT05TX1RIUkVBRFM7CiAgICAgYWlvID0gcWFwaV9l
bnVtX3BhcnNlKCZCbG9ja2RldkFpb09wdGlvbnNfbG9va3VwLAogICAgICAgICAgICAgICAgICAg
ICAgICAgICBxZW11X29wdF9nZXQob3B0cywgImFpbyIpLAotICAgICAgICAgICAgICAgICAgICAg
ICAgICBhaW9fZGVmYXVsdCwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAg
ICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgYWlvX2RlZmF1bHQsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICBy
ZXQgPSAtRUlOVkFMOwogICAgICAgICBnb3RvIGZhaWw7CiAgICAgfQpAQCAtNTEzLDkgKzUxMCw4
IEBAIHN0YXRpYyBpbnQgcmF3X29wZW5fY29tbW9uKEJsb2NrRHJpdmVyU3RhdGUgKmJzLCBRRGlj
dCAqb3B0aW9ucywKIAogICAgIGxvY2tpbmcgPSBxYXBpX2VudW1fcGFyc2UoJk9uT2ZmQXV0b19s
b29rdXAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxZW11X29wdF9nZXQob3B0cywg
ImxvY2tpbmciKSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9OX09GRl9BVVRPX0FV
VE8sICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJv
cGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBP
Tl9PRkZfQVVUT19BVVRPLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0ID0g
LUVJTlZBTDsKICAgICAgICAgZ290byBmYWlsOwogICAgIH0KQEAgLTU0MSw5ICs1MzcsOCBAQCBz
dGF0aWMgaW50IHJhd19vcGVuX2NvbW1vbihCbG9ja0RyaXZlclN0YXRlICpicywgUURpY3QgKm9w
dGlvbnMsCiAKICAgICBzdHIgPSBxZW11X29wdF9nZXQob3B0cywgInByLW1hbmFnZXIiKTsKICAg
ICBpZiAoc3RyKSB7Ci0gICAgICAgIHMtPnByX21nciA9IHByX21hbmFnZXJfbG9va3VwKHN0ciwg
JmxvY2FsX2Vycik7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICBzLT5wcl9tZ3IgPSBwcl9tYW5h
Z2VyX2xvb2t1cChzdHIsIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAg
IHJldCA9IC1FSU5WQUw7CiAgICAgICAgICAgICBnb3RvIGZhaWw7CiAgICAgICAgIH0KQEAgLTgx
OSw3ICs4MTQsNiBAQCBzdGF0aWMgaW50IHJhd19oYW5kbGVfcGVybV9sb2NrKEJsb2NrRHJpdmVy
U3RhdGUgKmJzLAogewogICAgIEJEUlZSYXdTdGF0ZSAqcyA9IGJzLT5vcGFxdWU7CiAgICAgaW50
IHJldCA9IDA7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICBpZiAoIXMtPnVz
ZV9sb2NrKSB7CiAgICAgICAgIHJldHVybiAwOwpAQCAtODU5LDIyICs4NTMsMjIgQEAgc3RhdGlj
IGludCByYXdfaGFuZGxlX3Blcm1fbG9jayhCbG9ja0RyaXZlclN0YXRlICpicywKICAgICAgICAg
LyogZmFsbCB0aHJvdWdoIHRvIHVubG9jayBieXRlcy4gKi8KICAgICBjYXNlIFJBV19QTF9BQk9S
VDoKICAgICAgICAgcmF3X2FwcGx5X2xvY2tfYnl0ZXMocywgcy0+ZmQsIHMtPnBlcm0sIH5zLT5z
aGFyZWRfcGVybSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ1ZSwgJmxvY2FsX2Vy
cik7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgdHJ1ZSwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgLyogVGhl
b3JldGljYWxseSB0aGUgYWJvdmUgY2FsbCBvbmx5IHVubG9ja3MgYnl0ZXMgYW5kIGl0IGNhbm5v
dAogICAgICAgICAgICAgICogZmFpbC4gU29tZXRoaW5nIHdlaXJkIGhhcHBlbmVkLCByZXBvcnQg
aXQuCiAgICAgICAgICAgICAgKi8KLSAgICAgICAgICAgIHdhcm5fcmVwb3J0X2Vycihsb2NhbF9l
cnIpOworICAgICAgICAgICAgd2Fybl9yZXBvcnRfZXJycChlcnJwKTsKICAgICAgICAgfQogICAg
ICAgICBicmVhazsKICAgICBjYXNlIFJBV19QTF9DT01NSVQ6CiAgICAgICAgIHJhd19hcHBseV9s
b2NrX2J5dGVzKHMsIHMtPmZkLCBuZXdfcGVybSwgfm5ld19zaGFyZWQsCi0gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHRydWUsICZsb2NhbF9lcnIpOwotICAgICAgICBpZiAobG9jYWxfZXJy
KSB7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRydWUsIGVycnApOworICAgICAgICBp
ZiAoKmVycnApIHsKICAgICAgICAgICAgIC8qIFRoZW9yZXRpY2FsbHkgdGhlIGFib3ZlIGNhbGwg
b25seSB1bmxvY2tzIGJ5dGVzIGFuZCBpdCBjYW5ub3QKICAgICAgICAgICAgICAqIGZhaWwuIFNv
bWV0aGluZyB3ZWlyZCBoYXBwZW5lZCwgcmVwb3J0IGl0LgogICAgICAgICAgICAgICovCi0gICAg
ICAgICAgICB3YXJuX3JlcG9ydF9lcnIobG9jYWxfZXJyKTsKKyAgICAgICAgICAgIHdhcm5fcmVw
b3J0X2VycnAoZXJycCk7CiAgICAgICAgIH0KICAgICAgICAgYnJlYWs7CiAgICAgfQpAQCAtOTUy
LDcgKzk0Niw2IEBAIHN0YXRpYyBpbnQgcmF3X3Jlb3Blbl9wcmVwYXJlKEJEUlZSZW9wZW5TdGF0
ZSAqc3RhdGUsCiAgICAgQkRSVlJhd1Jlb3BlblN0YXRlICpyczsKICAgICBRZW11T3B0cyAqb3B0
czsKICAgICBpbnQgcmV0OwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgYXNz
ZXJ0KHN0YXRlICE9IE5VTEwpOwogICAgIGFzc2VydChzdGF0ZS0+YnMgIT0gTlVMTCk7CkBAIC05
NjQsOSArOTU3LDggQEAgc3RhdGljIGludCByYXdfcmVvcGVuX3ByZXBhcmUoQkRSVlJlb3BlblN0
YXRlICpzdGF0ZSwKIAogICAgIC8qIEhhbmRsZSBvcHRpb25zIGNoYW5nZXMgKi8KICAgICBvcHRz
ID0gcWVtdV9vcHRzX2NyZWF0ZSgmcmF3X3J1bnRpbWVfb3B0cywgTlVMTCwgMCwgJmVycm9yX2Fi
b3J0KTsKLSAgICBxZW11X29wdHNfYWJzb3JiX3FkaWN0KG9wdHMsIHN0YXRlLT5vcHRpb25zLCAm
bG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0
ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHFlbXVfb3B0c19hYnNvcmJfcWRpY3Qob3B0cywgc3Rh
dGUtPm9wdGlvbnMsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXQgPSAtRUlO
VkFMOwogICAgICAgICBnb3RvIG91dDsKICAgICB9CkBAIC05ODEsOSArOTczLDggQEAgc3RhdGlj
IGludCByYXdfcmVvcGVuX3ByZXBhcmUoQkRSVlJlb3BlblN0YXRlICpzdGF0ZSwKICAgICBxZW11
X29wdHNfdG9fcWRpY3Qob3B0cywgc3RhdGUtPm9wdGlvbnMpOwogCiAgICAgcnMtPmZkID0gcmF3
X3JlY29uZmlndXJlX2dldGZkKHN0YXRlLT5icywgc3RhdGUtPmZsYWdzLCAmcnMtPm9wZW5fZmxh
Z3MsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLT5wZXJtLCB0cnVl
LCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3Bh
Z2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBzdGF0ZS0+cGVybSwgdHJ1ZSwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJl
dCA9IC0xOwogICAgICAgICBnb3RvIG91dDsKICAgICB9CkBAIC05OTEsOSArOTgyLDggQEAgc3Rh
dGljIGludCByYXdfcmVvcGVuX3ByZXBhcmUoQkRSVlJlb3BlblN0YXRlICpzdGF0ZSwKICAgICAv
KiBGYWlsIGFscmVhZHkgcmVvcGVuX3ByZXBhcmUoKSBpZiB3ZSBjYW4ndCBnZXQgYSB3b3JraW5n
IE9fRElSRUNUCiAgICAgICogYWxpZ25tZW50IHdpdGggdGhlIG5ldyBmZC4gKi8KICAgICBpZiAo
cnMtPmZkICE9IC0xKSB7Ci0gICAgICAgIHJhd19wcm9iZV9hbGlnbm1lbnQoc3RhdGUtPmJzLCBy
cy0+ZmQsICZsb2NhbF9lcnIpOwotICAgICAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgICAg
ICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgcmF3X3Byb2JlX2Fs
aWdubWVudChzdGF0ZS0+YnMsIHJzLT5mZCwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewog
ICAgICAgICAgICAgcmV0ID0gLUVJTlZBTDsKICAgICAgICAgICAgIGdvdG8gb3V0X2ZkOwogICAg
ICAgICB9CkBAIC0yMjMzLDcgKzIyMjMsNiBAQCBzdGF0aWMgaW50IGNvcm91dGluZV9mbgogcmF3
X2NvX2NyZWF0ZShCbG9ja2RldkNyZWF0ZU9wdGlvbnMgKm9wdGlvbnMsIEVycm9yICoqZXJycCkK
IHsKICAgICBCbG9ja2RldkNyZWF0ZU9wdGlvbnNGaWxlICpmaWxlX29wdHM7Ci0gICAgRXJyb3Ig
KmxvY2FsX2VyciA9IE5VTEw7CiAgICAgaW50IGZkOwogICAgIHVpbnQ2NF90IHBlcm0sIHNoYXJl
ZDsKICAgICBpbnQgcmVzdWx0ID0gMDsKQEAgLTIzMTUsMTMgKzIzMDQsMTMgQEAgcmF3X2NvX2Ny
ZWF0ZShCbG9ja2RldkNyZWF0ZU9wdGlvbnMgKm9wdGlvbnMsIEVycm9yICoqZXJycCkKICAgICB9
CiAKIG91dF91bmxvY2s6Ci0gICAgcmF3X2FwcGx5X2xvY2tfYnl0ZXMoTlVMTCwgZmQsIDAsIDAs
IHRydWUsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKKyAgICByYXdfYXBwbHlf
bG9ja19ieXRlcyhOVUxMLCBmZCwgMCwgMCwgdHJ1ZSwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7
CiAgICAgICAgIC8qIFRoZSBhYm92ZSBjYWxsIHNob3VsZCBub3QgZmFpbCwgYW5kIGlmIGl0IGRv
ZXMsIHRoYXQgZG9lcwogICAgICAgICAgKiBub3QgbWVhbiB0aGUgd2hvbGUgY3JlYXRpb24gb3Bl
cmF0aW9uIGhhcyBmYWlsZWQuICBTbwogICAgICAgICAgKiByZXBvcnQgaXQgdGhlIHVzZXIgZm9y
IHRoZWlyIGNvbnZlbmllbmNlLCBidXQgZG8gbm90IHJlcG9ydAogICAgICAgICAgKiBpdCB0byB0
aGUgY2FsbGVyLiAqLwotICAgICAgICB3YXJuX3JlcG9ydF9lcnIobG9jYWxfZXJyKTsKKyAgICAg
ICAgd2Fybl9yZXBvcnRfZXJycChlcnJwKTsKICAgICB9CiAKIG91dF9jbG9zZToKQEAgLTIzNDEs
NyArMjMzMCw2IEBAIHN0YXRpYyBpbnQgY29yb3V0aW5lX2ZuIHJhd19jb19jcmVhdGVfb3B0cyhj
b25zdCBjaGFyICpmaWxlbmFtZSwgUWVtdU9wdHMgKm9wdHMsCiAgICAgYm9vbCBub2NvdyA9IGZh
bHNlOwogICAgIFByZWFsbG9jTW9kZSBwcmVhbGxvYzsKICAgICBjaGFyICpidWYgPSBOVUxMOwot
ICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgLyogU2tpcCBmaWxlOiBwcm90b2Nv
bCBwcmVmaXggKi8KICAgICBzdHJzdGFydChmaWxlbmFtZSwgImZpbGU6IiwgJmZpbGVuYW1lKTsK
QEAgLTIzNTIsMTAgKzIzNDAsOSBAQCBzdGF0aWMgaW50IGNvcm91dGluZV9mbiByYXdfY29fY3Jl
YXRlX29wdHMoY29uc3QgY2hhciAqZmlsZW5hbWUsIFFlbXVPcHRzICpvcHRzLAogICAgIG5vY293
ID0gcWVtdV9vcHRfZ2V0X2Jvb2wob3B0cywgQkxPQ0tfT1BUX05PQ09XLCBmYWxzZSk7CiAgICAg
YnVmID0gcWVtdV9vcHRfZ2V0X2RlbChvcHRzLCBCTE9DS19PUFRfUFJFQUxMT0MpOwogICAgIHBy
ZWFsbG9jID0gcWFwaV9lbnVtX3BhcnNlKCZQcmVhbGxvY01vZGVfbG9va3VwLCBidWYsCi0gICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgUFJFQUxMT0NfTU9ERV9PRkYsICZsb2NhbF9lcnIp
OworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBSRUFMTE9DX01PREVfT0ZGLCBlcnJw
KTsKICAgICBnX2ZyZWUoYnVmKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIGlmICgqZXJycCkgewogICAgICAgICBy
ZXR1cm4gLUVJTlZBTDsKICAgICB9CiAKQEAgLTMxNTYsNyArMzE0Myw2IEBAIHN0YXRpYyBpbnQg
aGRldl9vcGVuKEJsb2NrRHJpdmVyU3RhdGUgKmJzLCBRRGljdCAqb3B0aW9ucywgaW50IGZsYWdz
LAogICAgICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJwKQogewogICAgIEJEUlZSYXdTdGF0
ZSAqcyA9IGJzLT5vcGFxdWU7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgaW50
IHJldDsKIAogI2lmIGRlZmluZWQoX19BUFBMRV9fKSAmJiBkZWZpbmVkKF9fTUFDSF9fKQpAQCAt
MzIyMSw5ICszMjA3LDggQEAgaGRldl9vcGVuX01hY19lcnJvcjoKIAogICAgIHMtPnR5cGUgPSBG
VFlQRV9GSUxFOwogCi0gICAgcmV0ID0gcmF3X29wZW5fY29tbW9uKGJzLCBvcHRpb25zLCBmbGFn
cywgMCwgdHJ1ZSwgJmxvY2FsX2Vycik7CisgICAgcmV0ID0gcmF3X29wZW5fY29tbW9uKGJzLCBv
cHRpb25zLCBmbGFncywgMCwgdHJ1ZSwgZXJycCk7CiAgICAgaWYgKHJldCA8IDApIHsKLSAgICAg
ICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CiAjaWYgZGVmaW5lZChfX0FQUExF
X18pICYmIGRlZmluZWQoX19NQUNIX18pCiAgICAgICAgIGlmICgqYnNkX3BhdGgpIHsKICAgICAg
ICAgICAgIGZpbGVuYW1lID0gYnNkX3BhdGg7CkBAIC0zNTU4LDE0ICszNTQzLDEyIEBAIHN0YXRp
YyBpbnQgY2Ryb21fb3BlbihCbG9ja0RyaXZlclN0YXRlICpicywgUURpY3QgKm9wdGlvbnMsIGlu
dCBmbGFncywKICAgICAgICAgICAgICAgICAgICAgICBFcnJvciAqKmVycnApCiB7CiAgICAgQkRS
VlJhd1N0YXRlICpzID0gYnMtPm9wYXF1ZTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsK
ICAgICBpbnQgcmV0OwogCiAgICAgcy0+dHlwZSA9IEZUWVBFX0NEOwogCi0gICAgcmV0ID0gcmF3
X29wZW5fY29tbW9uKGJzLCBvcHRpb25zLCBmbGFncywgMCwgdHJ1ZSwgJmxvY2FsX2Vycik7Cisg
ICAgcmV0ID0gcmF3X29wZW5fY29tbW9uKGJzLCBvcHRpb25zLCBmbGFncywgMCwgdHJ1ZSwgZXJy
cCk7CiAgICAgaWYgKHJldCkgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxf
ZXJyKTsKICAgICAgICAgcmV0dXJuIHJldDsKICAgICB9CiAKZGlmZiAtLWdpdCBhL2Jsb2NrL2Zp
bGUtd2luMzIuYyBiL2Jsb2NrL2ZpbGUtd2luMzIuYwppbmRleCA0MWY1NWRmZWNlLi4yNmFlMGYx
MTRjIDEwMDY0NAotLS0gYS9ibG9jay9maWxlLXdpbjMyLmMKKysrIGIvYmxvY2svZmlsZS13aW4z
Mi5jCkBAIC0zMzAsNyArMzMwLDYgQEAgc3RhdGljIGludCByYXdfb3BlbihCbG9ja0RyaXZlclN0
YXRlICpicywgUURpY3QgKm9wdGlvbnMsIGludCBmbGFncywKICAgICBpbnQgYWNjZXNzX2ZsYWdz
OwogICAgIERXT1JEIG92ZXJsYXBwZWQ7CiAgICAgUWVtdU9wdHMgKm9wdHM7Ci0gICAgRXJyb3Ig
KmxvY2FsX2VyciA9IE5VTEw7CiAgICAgY29uc3QgY2hhciAqZmlsZW5hbWU7CiAgICAgYm9vbCB1
c2VfYWlvOwogICAgIGludCByZXQ7CkBAIC0zMzgsOSArMzM3LDggQEAgc3RhdGljIGludCByYXdf
b3BlbihCbG9ja0RyaXZlclN0YXRlICpicywgUURpY3QgKm9wdGlvbnMsIGludCBmbGFncywKICAg
ICBzLT50eXBlID0gRlRZUEVfRklMRTsKIAogICAgIG9wdHMgPSBxZW11X29wdHNfY3JlYXRlKCZy
YXdfcnVudGltZV9vcHRzLCBOVUxMLCAwLCAmZXJyb3JfYWJvcnQpOwotICAgIHFlbXVfb3B0c19h
YnNvcmJfcWRpY3Qob3B0cywgb3B0aW9ucywgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2Vy
cikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBxZW11
X29wdHNfYWJzb3JiX3FkaWN0KG9wdHMsIG9wdGlvbnMsIGVycnApOworICAgIGlmICgqZXJycCkg
ewogICAgICAgICByZXQgPSAtRUlOVkFMOwogICAgICAgICBnb3RvIGZhaWw7CiAgICAgfQpAQCAt
MzUzLDkgKzM1MSw4IEBAIHN0YXRpYyBpbnQgcmF3X29wZW4oQmxvY2tEcml2ZXJTdGF0ZSAqYnMs
IFFEaWN0ICpvcHRpb25zLCBpbnQgZmxhZ3MsCiAKICAgICBmaWxlbmFtZSA9IHFlbXVfb3B0X2dl
dChvcHRzLCAiZmlsZW5hbWUiKTsKIAotICAgIHVzZV9haW8gPSBnZXRfYWlvX29wdGlvbihvcHRz
LCBmbGFncywgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJv
cl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICB1c2VfYWlvID0gZ2V0X2Fpb19vcHRp
b24ob3B0cywgZmxhZ3MsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXQgPSAt
RUlOVkFMOwogICAgICAgICBnb3RvIGZhaWw7CiAgICAgfQpAQCAtNzI3LDI4ICs3MjQsMjQgQEAg
c3RhdGljIGludCBoZGV2X29wZW4oQmxvY2tEcml2ZXJTdGF0ZSAqYnMsIFFEaWN0ICpvcHRpb25z
LCBpbnQgZmxhZ3MsCiAgICAgaW50IHJldCA9IDA7CiAgICAgRFdPUkQgb3ZlcmxhcHBlZDsKICAg
ICBjaGFyIGRldmljZV9uYW1lWzY0XTsKLQotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwog
ICAgIGNvbnN0IGNoYXIgKmZpbGVuYW1lOwogICAgIGJvb2wgdXNlX2FpbzsKIAogICAgIFFlbXVP
cHRzICpvcHRzID0gcWVtdV9vcHRzX2NyZWF0ZSgmcmF3X3J1bnRpbWVfb3B0cywgTlVMTCwgMCwK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJmVycm9yX2Fib3J0KTsKLSAg
ICBxZW11X29wdHNfYWJzb3JiX3FkaWN0KG9wdHMsIG9wdGlvbnMsICZsb2NhbF9lcnIpOwotICAg
IGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vy
cik7CisgICAgcWVtdV9vcHRzX2Fic29yYl9xZGljdChvcHRzLCBvcHRpb25zLCBlcnJwKTsKKyAg
ICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0ID0gLUVJTlZBTDsKICAgICAgICAgZ290byBkb25l
OwogICAgIH0KIAogICAgIGZpbGVuYW1lID0gcWVtdV9vcHRfZ2V0KG9wdHMsICJmaWxlbmFtZSIp
OwogCi0gICAgdXNlX2FpbyA9IGdldF9haW9fb3B0aW9uKG9wdHMsIGZsYWdzLCAmbG9jYWxfZXJy
KTsKLSAgICBpZiAoIWxvY2FsX2VyciAmJiB1c2VfYWlvKSB7Ci0gICAgICAgIGVycm9yX3NldGco
JmxvY2FsX2VyciwgIkFJTyBpcyBub3Qgc3VwcG9ydGVkIG9uIFdpbmRvd3MgaG9zdCBkZXZpY2Vz
Iik7CisgICAgdXNlX2FpbyA9IGdldF9haW9fb3B0aW9uKG9wdHMsIGZsYWdzLCBlcnJwKTsKKyAg
ICBpZiAoISplcnJwICYmIHVzZV9haW8pIHsKKyAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAiQUlP
IGlzIG5vdCBzdXBwb3J0ZWQgb24gV2luZG93cyBob3N0IGRldmljZXMiKTsKICAgICB9Ci0gICAg
aWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJy
KTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0ID0gLUVJTlZBTDsKICAgICAgICAgZ290
byBkb25lOwogICAgIH0KZGlmZiAtLWdpdCBhL2Jsb2NrL2dsdXN0ZXIuYyBiL2Jsb2NrL2dsdXN0
ZXIuYwppbmRleCA2NDAyOGIyY2JhLi5mM2Q3NGQ5Y2QyIDEwMDY0NAotLS0gYS9ibG9jay9nbHVz
dGVyLmMKKysrIGIvYmxvY2svZ2x1c3Rlci5jCkBAIC01MTYsMzQgKzUxNiwzMyBAQCBzdGF0aWMg
aW50IHFlbXVfZ2x1c3Rlcl9wYXJzZV9qc29uKEJsb2NrZGV2T3B0aW9uc0dsdXN0ZXIgKmdjb25m
LAogICAgIFNvY2tldEFkZHJlc3MgKmdzY29uZiA9IE5VTEw7CiAgICAgU29ja2V0QWRkcmVzc0xp
c3QgKmN1cnIgPSBOVUxMOwogICAgIFFEaWN0ICpiYWNraW5nX29wdGlvbnMgPSBOVUxMOwotICAg
IEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIGNoYXIgKnN0ciA9IE5VTEw7CiAgICAgY29u
c3QgY2hhciAqcHRyOwogICAgIGludCBpLCB0eXBlLCBudW1fc2VydmVyczsKIAogICAgIC8qIGNy
ZWF0ZSBvcHRzIGluZm8gZnJvbSBydW50aW1lX2pzb25fb3B0cyBsaXN0ICovCiAgICAgb3B0cyA9
IHFlbXVfb3B0c19jcmVhdGUoJnJ1bnRpbWVfanNvbl9vcHRzLCBOVUxMLCAwLCAmZXJyb3JfYWJv
cnQpOwotICAgIHFlbXVfb3B0c19hYnNvcmJfcWRpY3Qob3B0cywgb3B0aW9ucywgJmxvY2FsX2Vy
cik7Ci0gICAgaWYgKGxvY2FsX2VycikgeworICAgIHFlbXVfb3B0c19hYnNvcmJfcWRpY3Qob3B0
cywgb3B0aW9ucywgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8gb3V0Owog
ICAgIH0KIAogICAgIG51bV9zZXJ2ZXJzID0gcWRpY3RfYXJyYXlfZW50cmllcyhvcHRpb25zLCBH
TFVTVEVSX09QVF9TRVJWRVJfUEFUVEVSTik7CiAgICAgaWYgKG51bV9zZXJ2ZXJzIDwgMSkgewot
ICAgICAgICBlcnJvcl9zZXRnKCZsb2NhbF9lcnIsIFFFUlJfTUlTU0lOR19QQVJBTUVURVIsICJz
ZXJ2ZXIiKTsKKyAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCBRRVJSX01JU1NJTkdfUEFSQU1FVEVS
LCAic2VydmVyIik7CiAgICAgICAgIGdvdG8gb3V0OwogICAgIH0KIAogICAgIHB0ciA9IHFlbXVf
b3B0X2dldChvcHRzLCBHTFVTVEVSX09QVF9WT0xVTUUpOwogICAgIGlmICghcHRyKSB7Ci0gICAg
ICAgIGVycm9yX3NldGcoJmxvY2FsX2VyciwgUUVSUl9NSVNTSU5HX1BBUkFNRVRFUiwgR0xVU1RF
Ul9PUFRfVk9MVU1FKTsKKyAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCBRRVJSX01JU1NJTkdfUEFS
QU1FVEVSLCBHTFVTVEVSX09QVF9WT0xVTUUpOwogICAgICAgICBnb3RvIG91dDsKICAgICB9CiAg
ICAgZ2NvbmYtPnZvbHVtZSA9IGdfc3RyZHVwKHB0cik7CiAKICAgICBwdHIgPSBxZW11X29wdF9n
ZXQob3B0cywgR0xVU1RFUl9PUFRfUEFUSCk7CiAgICAgaWYgKCFwdHIpIHsKLSAgICAgICAgZXJy
b3Jfc2V0ZygmbG9jYWxfZXJyLCBRRVJSX01JU1NJTkdfUEFSQU1FVEVSLCBHTFVTVEVSX09QVF9Q
QVRIKTsKKyAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCBRRVJSX01JU1NJTkdfUEFSQU1FVEVSLCBH
TFVTVEVSX09QVF9QQVRIKTsKICAgICAgICAgZ290byBvdXQ7CiAgICAgfQogICAgIGdjb25mLT5w
YXRoID0gZ19zdHJkdXAocHRyKTsKQEAgLTU1NSwxNSArNTU0LDE1IEBAIHN0YXRpYyBpbnQgcWVt
dV9nbHVzdGVyX3BhcnNlX2pzb24oQmxvY2tkZXZPcHRpb25zR2x1c3RlciAqZ2NvbmYsCiAKICAg
ICAgICAgLyogY3JlYXRlIG9wdHMgaW5mbyBmcm9tIHJ1bnRpbWVfdHlwZV9vcHRzIGxpc3QgKi8K
ICAgICAgICAgb3B0cyA9IHFlbXVfb3B0c19jcmVhdGUoJnJ1bnRpbWVfdHlwZV9vcHRzLCBOVUxM
LCAwLCAmZXJyb3JfYWJvcnQpOwotICAgICAgICBxZW11X29wdHNfYWJzb3JiX3FkaWN0KG9wdHMs
IGJhY2tpbmdfb3B0aW9ucywgJmxvY2FsX2Vycik7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsK
KyAgICAgICAgcWVtdV9vcHRzX2Fic29yYl9xZGljdChvcHRzLCBiYWNraW5nX29wdGlvbnMsIGVy
cnApOworICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIGdvdG8gb3V0OwogICAgICAg
ICB9CiAKICAgICAgICAgcHRyID0gcWVtdV9vcHRfZ2V0KG9wdHMsIEdMVVNURVJfT1BUX1RZUEUp
OwogICAgICAgICBpZiAoIXB0cikgewotICAgICAgICAgICAgZXJyb3Jfc2V0ZygmbG9jYWxfZXJy
LCBRRVJSX01JU1NJTkdfUEFSQU1FVEVSLCBHTFVTVEVSX09QVF9UWVBFKTsKLSAgICAgICAgICAg
IGVycm9yX2FwcGVuZF9oaW50KCZsb2NhbF9lcnIsIEdFUlJfSU5ERVhfSElOVCwgaSk7CisgICAg
ICAgICAgICBlcnJvcl9zZXRnKGVycnAsIFFFUlJfTUlTU0lOR19QQVJBTUVURVIsIEdMVVNURVJf
T1BUX1RZUEUpOworICAgICAgICAgICAgZXJyb3JfYXBwZW5kX2hpbnQoZXJycCwgR0VSUl9JTkRF
WF9ISU5ULCBpKTsKICAgICAgICAgICAgIGdvdG8gb3V0OwogCiAgICAgICAgIH0KQEAgLTU3NCwx
MCArNTczLDEwIEBAIHN0YXRpYyBpbnQgcWVtdV9nbHVzdGVyX3BhcnNlX2pzb24oQmxvY2tkZXZP
cHRpb25zR2x1c3RlciAqZ2NvbmYsCiAgICAgICAgIHR5cGUgPSBxYXBpX2VudW1fcGFyc2UoJlNv
Y2tldEFkZHJlc3NUeXBlX2xvb2t1cCwgcHRyLCAtMSwgTlVMTCk7CiAgICAgICAgIGlmICh0eXBl
ICE9IFNPQ0tFVF9BRERSRVNTX1RZUEVfSU5FVAogICAgICAgICAgICAgJiYgdHlwZSAhPSBTT0NL
RVRfQUREUkVTU19UWVBFX1VOSVgpIHsKLSAgICAgICAgICAgIGVycm9yX3NldGcoJmxvY2FsX2Vy
ciwKKyAgICAgICAgICAgIGVycm9yX3NldGcoZXJycCwKICAgICAgICAgICAgICAgICAgICAgICAg
IlBhcmFtZXRlciAnJXMnIG1heSBiZSAnaW5ldCcgb3IgJ3VuaXgnIiwKICAgICAgICAgICAgICAg
ICAgICAgICAgR0xVU1RFUl9PUFRfVFlQRSk7Ci0gICAgICAgICAgICBlcnJvcl9hcHBlbmRfaGlu
dCgmbG9jYWxfZXJyLCBHRVJSX0lOREVYX0hJTlQsIGkpOworICAgICAgICAgICAgZXJyb3JfYXBw
ZW5kX2hpbnQoZXJycCwgR0VSUl9JTkRFWF9ISU5ULCBpKTsKICAgICAgICAgICAgIGdvdG8gb3V0
OwogICAgICAgICB9CiAgICAgICAgIGdzY29uZi0+dHlwZSA9IHR5cGU7CkBAIC01ODYsMjQgKzU4
NSwyNCBAQCBzdGF0aWMgaW50IHFlbXVfZ2x1c3Rlcl9wYXJzZV9qc29uKEJsb2NrZGV2T3B0aW9u
c0dsdXN0ZXIgKmdjb25mLAogICAgICAgICBpZiAoZ3Njb25mLT50eXBlID09IFNPQ0tFVF9BRERS
RVNTX1RZUEVfSU5FVCkgewogICAgICAgICAgICAgLyogY3JlYXRlIG9wdHMgaW5mbyBmcm9tIHJ1
bnRpbWVfaW5ldF9vcHRzIGxpc3QgKi8KICAgICAgICAgICAgIG9wdHMgPSBxZW11X29wdHNfY3Jl
YXRlKCZydW50aW1lX2luZXRfb3B0cywgTlVMTCwgMCwgJmVycm9yX2Fib3J0KTsKLSAgICAgICAg
ICAgIHFlbXVfb3B0c19hYnNvcmJfcWRpY3Qob3B0cywgYmFja2luZ19vcHRpb25zLCAmbG9jYWxf
ZXJyKTsKLSAgICAgICAgICAgIGlmIChsb2NhbF9lcnIpIHsKKyAgICAgICAgICAgIHFlbXVfb3B0
c19hYnNvcmJfcWRpY3Qob3B0cywgYmFja2luZ19vcHRpb25zLCBlcnJwKTsKKyAgICAgICAgICAg
IGlmICgqZXJycCkgewogICAgICAgICAgICAgICAgIGdvdG8gb3V0OwogICAgICAgICAgICAgfQog
CiAgICAgICAgICAgICBwdHIgPSBxZW11X29wdF9nZXQob3B0cywgR0xVU1RFUl9PUFRfSE9TVCk7
CiAgICAgICAgICAgICBpZiAoIXB0cikgewotICAgICAgICAgICAgICAgIGVycm9yX3NldGcoJmxv
Y2FsX2VyciwgUUVSUl9NSVNTSU5HX1BBUkFNRVRFUiwKKyAgICAgICAgICAgICAgICBlcnJvcl9z
ZXRnKGVycnAsIFFFUlJfTUlTU0lOR19QQVJBTUVURVIsCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBHTFVTVEVSX09QVF9IT1NUKTsKLSAgICAgICAgICAgICAgICBlcnJvcl9hcHBlbmRfaGlu
dCgmbG9jYWxfZXJyLCBHRVJSX0lOREVYX0hJTlQsIGkpOworICAgICAgICAgICAgICAgIGVycm9y
X2FwcGVuZF9oaW50KGVycnAsIEdFUlJfSU5ERVhfSElOVCwgaSk7CiAgICAgICAgICAgICAgICAg
Z290byBvdXQ7CiAgICAgICAgICAgICB9CiAgICAgICAgICAgICBnc2NvbmYtPnUuaW5ldC5ob3N0
ID0gZ19zdHJkdXAocHRyKTsKICAgICAgICAgICAgIHB0ciA9IHFlbXVfb3B0X2dldChvcHRzLCBH
TFVTVEVSX09QVF9QT1JUKTsKICAgICAgICAgICAgIGlmICghcHRyKSB7Ci0gICAgICAgICAgICAg
ICAgZXJyb3Jfc2V0ZygmbG9jYWxfZXJyLCBRRVJSX01JU1NJTkdfUEFSQU1FVEVSLAorICAgICAg
ICAgICAgICAgIGVycm9yX3NldGcoZXJycCwgUUVSUl9NSVNTSU5HX1BBUkFNRVRFUiwKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIEdMVVNURVJfT1BUX1BPUlQpOwotICAgICAgICAgICAgICAg
IGVycm9yX2FwcGVuZF9oaW50KCZsb2NhbF9lcnIsIEdFUlJfSU5ERVhfSElOVCwgaSk7CisgICAg
ICAgICAgICAgICAgZXJyb3JfYXBwZW5kX2hpbnQoZXJycCwgR0VSUl9JTkRFWF9ISU5ULCBpKTsK
ICAgICAgICAgICAgICAgICBnb3RvIG91dDsKICAgICAgICAgICAgIH0KICAgICAgICAgICAgIGdz
Y29uZi0+dS5pbmV0LnBvcnQgPSBnX3N0cmR1cChwdHIpOwpAQCAtNjI0LDE5ICs2MjMsMTkgQEAg
c3RhdGljIGludCBxZW11X2dsdXN0ZXJfcGFyc2VfanNvbihCbG9ja2Rldk9wdGlvbnNHbHVzdGVy
ICpnY29uZiwKICAgICAgICAgICAgICAgICBnc2NvbmYtPnUuaW5ldC5oYXNfaXB2NiA9IHRydWU7
CiAgICAgICAgICAgICB9CiAgICAgICAgICAgICBpZiAoZ3Njb25mLT51LmluZXQuaGFzX3RvKSB7
Ci0gICAgICAgICAgICAgICAgZXJyb3Jfc2V0ZygmbG9jYWxfZXJyLCAiUGFyYW1ldGVyICd0bycg
bm90IHN1cHBvcnRlZCIpOworICAgICAgICAgICAgICAgIGVycm9yX3NldGcoZXJycCwgIlBhcmFt
ZXRlciAndG8nIG5vdCBzdXBwb3J0ZWQiKTsKICAgICAgICAgICAgICAgICBnb3RvIG91dDsKICAg
ICAgICAgICAgIH0KICAgICAgICAgICAgIGlmIChnc2NvbmYtPnUuaW5ldC5oYXNfaXB2NCB8fCBn
c2NvbmYtPnUuaW5ldC5oYXNfaXB2NikgewotICAgICAgICAgICAgICAgIGVycm9yX3NldGcoJmxv
Y2FsX2VyciwgIlBhcmFtZXRlcnMgJ2lwdjQvaXB2Nicgbm90IHN1cHBvcnRlZCIpOworICAgICAg
ICAgICAgICAgIGVycm9yX3NldGcoZXJycCwgIlBhcmFtZXRlcnMgJ2lwdjQvaXB2Nicgbm90IHN1
cHBvcnRlZCIpOwogICAgICAgICAgICAgICAgIGdvdG8gb3V0OwogICAgICAgICAgICAgfQogICAg
ICAgICAgICAgcWVtdV9vcHRzX2RlbChvcHRzKTsKICAgICAgICAgfSBlbHNlIHsKICAgICAgICAg
ICAgIC8qIGNyZWF0ZSBvcHRzIGluZm8gZnJvbSBydW50aW1lX3VuaXhfb3B0cyBsaXN0ICovCiAg
ICAgICAgICAgICBvcHRzID0gcWVtdV9vcHRzX2NyZWF0ZSgmcnVudGltZV91bml4X29wdHMsIE5V
TEwsIDAsICZlcnJvcl9hYm9ydCk7Ci0gICAgICAgICAgICBxZW11X29wdHNfYWJzb3JiX3FkaWN0
KG9wdHMsIGJhY2tpbmdfb3B0aW9ucywgJmxvY2FsX2Vycik7Ci0gICAgICAgICAgICBpZiAobG9j
YWxfZXJyKSB7CisgICAgICAgICAgICBxZW11X29wdHNfYWJzb3JiX3FkaWN0KG9wdHMsIGJhY2tp
bmdfb3B0aW9ucywgZXJycCk7CisgICAgICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAg
ICAgICBnb3RvIG91dDsKICAgICAgICAgICAgIH0KIApAQCAtNjQ0LDE1ICs2NDMsMTUgQEAgc3Rh
dGljIGludCBxZW11X2dsdXN0ZXJfcGFyc2VfanNvbihCbG9ja2Rldk9wdGlvbnNHbHVzdGVyICpn
Y29uZiwKICAgICAgICAgICAgIGlmICghcHRyKSB7CiAgICAgICAgICAgICAgICAgcHRyID0gcWVt
dV9vcHRfZ2V0KG9wdHMsIEdMVVNURVJfT1BUX1NPQ0tFVCk7CiAgICAgICAgICAgICB9IGVsc2Ug
aWYgKHFlbXVfb3B0X2dldChvcHRzLCBHTFVTVEVSX09QVF9TT0NLRVQpKSB7Ci0gICAgICAgICAg
ICAgICAgZXJyb3Jfc2V0ZygmbG9jYWxfZXJyLAorICAgICAgICAgICAgICAgIGVycm9yX3NldGco
ZXJycCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJDb25mbGljdGluZyBwYXJhbWV0ZXJz
ICdwYXRoJyBhbmQgJ3NvY2tldCciKTsKLSAgICAgICAgICAgICAgICBlcnJvcl9hcHBlbmRfaGlu
dCgmbG9jYWxfZXJyLCBHRVJSX0lOREVYX0hJTlQsIGkpOworICAgICAgICAgICAgICAgIGVycm9y
X2FwcGVuZF9oaW50KGVycnAsIEdFUlJfSU5ERVhfSElOVCwgaSk7CiAgICAgICAgICAgICAgICAg
Z290byBvdXQ7CiAgICAgICAgICAgICB9CiAgICAgICAgICAgICBpZiAoIXB0cikgewotICAgICAg
ICAgICAgICAgIGVycm9yX3NldGcoJmxvY2FsX2VyciwgUUVSUl9NSVNTSU5HX1BBUkFNRVRFUiwK
KyAgICAgICAgICAgICAgICBlcnJvcl9zZXRnKGVycnAsIFFFUlJfTUlTU0lOR19QQVJBTUVURVIs
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBHTFVTVEVSX09QVF9QQVRIKTsKLSAgICAgICAg
ICAgICAgICBlcnJvcl9hcHBlbmRfaGludCgmbG9jYWxfZXJyLCBHRVJSX0lOREVYX0hJTlQsIGkp
OworICAgICAgICAgICAgICAgIGVycm9yX2FwcGVuZF9oaW50KGVycnAsIEdFUlJfSU5ERVhfSElO
VCwgaSk7CiAgICAgICAgICAgICAgICAgZ290byBvdXQ7CiAgICAgICAgICAgICB9CiAgICAgICAg
ICAgICBnc2NvbmYtPnUucV91bml4LnBhdGggPSBnX3N0cmR1cChwdHIpOwpAQCAtNjc5LDcgKzY3
OCw2IEBAIHN0YXRpYyBpbnQgcWVtdV9nbHVzdGVyX3BhcnNlX2pzb24oQmxvY2tkZXZPcHRpb25z
R2x1c3RlciAqZ2NvbmYsCiAgICAgcmV0dXJuIDA7CiAKIG91dDoKLSAgICBlcnJvcl9wcm9wYWdh
dGUoZXJycCwgbG9jYWxfZXJyKTsKICAgICBxYXBpX2ZyZWVfU29ja2V0QWRkcmVzcyhnc2NvbmYp
OwogICAgIHFlbXVfb3B0c19kZWwob3B0cyk7CiAgICAgZ19mcmVlKHN0cik7CkBAIC04MTUsMTMg
KzgxMywxMSBAQCBzdGF0aWMgaW50IHFlbXVfZ2x1c3Rlcl9vcGVuKEJsb2NrRHJpdmVyU3RhdGUg
KmJzLCAgUURpY3QgKm9wdGlvbnMsCiAgICAgaW50IHJldCA9IDA7CiAgICAgQmxvY2tkZXZPcHRp
b25zR2x1c3RlciAqZ2NvbmYgPSBOVUxMOwogICAgIFFlbXVPcHRzICpvcHRzOwotICAgIEVycm9y
ICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIGNvbnN0IGNoYXIgKmZpbGVuYW1lLCAqbG9nZmlsZTsK
IAogICAgIG9wdHMgPSBxZW11X29wdHNfY3JlYXRlKCZydW50aW1lX29wdHMsIE5VTEwsIDAsICZl
cnJvcl9hYm9ydCk7Ci0gICAgcWVtdV9vcHRzX2Fic29yYl9xZGljdChvcHRzLCBvcHRpb25zLCAm
bG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0
ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHFlbXVfb3B0c19hYnNvcmJfcWRpY3Qob3B0cywgb3B0
aW9ucywgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldCA9IC1FSU5WQUw7CiAg
ICAgICAgIGdvdG8gb3V0OwogICAgIH0KQEAgLTExMzgsNyArMTEzNCw2IEBAIHN0YXRpYyBpbnQg
Y29yb3V0aW5lX2ZuIHFlbXVfZ2x1c3Rlcl9jb19jcmVhdGVfb3B0cyhjb25zdCBjaGFyICpmaWxl
bmFtZSwKICAgICBCbG9ja2RldkNyZWF0ZU9wdGlvbnNHbHVzdGVyICpnb3B0czsKICAgICBCbG9j
a2Rldk9wdGlvbnNHbHVzdGVyICpnY29uZjsKICAgICBjaGFyICp0bXAgPSBOVUxMOwotICAgIEVy
cm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIGludCByZXQ7CiAKICAgICBvcHRpb25zID0gZ19u
ZXcwKEJsb2NrZGV2Q3JlYXRlT3B0aW9ucywgMSk7CkBAIC0xMTUzLDEwICsxMTQ4LDkgQEAgc3Rh
dGljIGludCBjb3JvdXRpbmVfZm4gcWVtdV9nbHVzdGVyX2NvX2NyZWF0ZV9vcHRzKGNvbnN0IGNo
YXIgKmZpbGVuYW1lLAogCiAgICAgdG1wID0gcWVtdV9vcHRfZ2V0X2RlbChvcHRzLCBCTE9DS19P
UFRfUFJFQUxMT0MpOwogICAgIGdvcHRzLT5wcmVhbGxvY2F0aW9uID0gcWFwaV9lbnVtX3BhcnNl
KCZQcmVhbGxvY01vZGVfbG9va3VwLCB0bXAsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgUFJFQUxMT0NfTU9ERV9PRkYsICZsb2NhbF9lcnIpOworICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBSRUFMTE9DX01PREVfT0ZGLCBlcnJw
KTsKICAgICBnX2ZyZWUodG1wKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIGlmICgqZXJycCkgewogICAgICAgICBy
ZXQgPSAtRUlOVkFMOwogICAgICAgICBnb3RvIGZhaWw7CiAgICAgfQpkaWZmIC0tZ2l0IGEvYmxv
Y2svaW8uYyBiL2Jsb2NrL2lvLmMKaW5kZXggZjhjMzU5NjEzMS4uY2ViZjc2YmVkNSAxMDA2NDQK
LS0tIGEvYmxvY2svaW8uYworKysgYi9ibG9jay9pby5jCkBAIC0xMzYsNyArMTM2LDYgQEAgc3Rh
dGljIHZvaWQgYmRydl9tZXJnZV9saW1pdHMoQmxvY2tMaW1pdHMgKmRzdCwgY29uc3QgQmxvY2tM
aW1pdHMgKnNyYykKIHZvaWQgYmRydl9yZWZyZXNoX2xpbWl0cyhCbG9ja0RyaXZlclN0YXRlICpi
cywgRXJyb3IgKiplcnJwKQogewogICAgIEJsb2NrRHJpdmVyICpkcnYgPSBicy0+ZHJ2OwotICAg
IEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgbWVtc2V0KCZicy0+YmwsIDAsIHNpemVv
Zihicy0+YmwpKTsKIApAQCAtMTUxLDkgKzE1MCw4IEBAIHZvaWQgYmRydl9yZWZyZXNoX2xpbWl0
cyhCbG9ja0RyaXZlclN0YXRlICpicywgRXJyb3IgKiplcnJwKQogCiAgICAgLyogVGFrZSBzb21l
IGxpbWl0cyBmcm9tIHRoZSBjaGlsZHJlbiBhcyBhIGRlZmF1bHQgKi8KICAgICBpZiAoYnMtPmZp
bGUpIHsKLSAgICAgICAgYmRydl9yZWZyZXNoX2xpbWl0cyhicy0+ZmlsZS0+YnMsICZsb2NhbF9l
cnIpOwotICAgICAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdh
dGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgYmRydl9yZWZyZXNoX2xpbWl0cyhicy0+Zmls
ZS0+YnMsIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIHJldHVybjsK
ICAgICAgICAgfQogICAgICAgICBiZHJ2X21lcmdlX2xpbWl0cygmYnMtPmJsLCAmYnMtPmZpbGUt
PmJzLT5ibCk7CkBAIC0xNjYsOSArMTY0LDggQEAgdm9pZCBiZHJ2X3JlZnJlc2hfbGltaXRzKEJs
b2NrRHJpdmVyU3RhdGUgKmJzLCBFcnJvciAqKmVycnApCiAgICAgfQogCiAgICAgaWYgKGJzLT5i
YWNraW5nKSB7Ci0gICAgICAgIGJkcnZfcmVmcmVzaF9saW1pdHMoYnMtPmJhY2tpbmctPmJzLCAm
bG9jYWxfZXJyKTsKLSAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICAgICAgZXJyb3Jf
cHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgIGJkcnZfcmVmcmVzaF9saW1pdHMo
YnMtPmJhY2tpbmctPmJzLCBlcnJwKTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAg
ICByZXR1cm47CiAgICAgICAgIH0KICAgICAgICAgYmRydl9tZXJnZV9saW1pdHMoJmJzLT5ibCwg
JmJzLT5iYWNraW5nLT5icy0+YmwpOwpkaWZmIC0tZ2l0IGEvYmxvY2svaXNjc2kuYyBiL2Jsb2Nr
L2lzY3NpLmMKaW5kZXggNTA2YmY1Zjg3NS4uZjE1MDU1MDUwMSAxMDA2NDQKLS0tIGEvYmxvY2sv
aXNjc2kuYworKysgYi9ibG9jay9pc2NzaS5jCkBAIC0xNzg2LDcgKzE3ODYsNiBAQCBzdGF0aWMg
aW50IGlzY3NpX29wZW4oQmxvY2tEcml2ZXJTdGF0ZSAqYnMsIFFEaWN0ICpvcHRpb25zLCBpbnQg
ZmxhZ3MsCiAgICAgc3RydWN0IHNjc2lfaW5xdWlyeV9zdXBwb3J0ZWRfcGFnZXMgKmlucV92cGQ7
CiAgICAgY2hhciAqaW5pdGlhdG9yX25hbWUgPSBOVUxMOwogICAgIFFlbXVPcHRzICpvcHRzOwot
ICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIGNvbnN0IGNoYXIgKnRyYW5zcG9ydF9u
YW1lLCAqcG9ydGFsLCAqdGFyZ2V0OwogI2lmIExJQklTQ1NJX0FQSV9WRVJTSU9OID49ICgyMDE2
MDYwMykKICAgICBlbnVtIGlzY3NpX3RyYW5zcG9ydF90eXBlIHRyYW5zcG9ydDsKQEAgLTE3OTQs
OSArMTc5Myw4IEBAIHN0YXRpYyBpbnQgaXNjc2lfb3BlbihCbG9ja0RyaXZlclN0YXRlICpicywg
UURpY3QgKm9wdGlvbnMsIGludCBmbGFncywKICAgICBpbnQgaSwgcmV0ID0gMCwgdGltZW91dCA9
IDAsIGx1bjsKIAogICAgIG9wdHMgPSBxZW11X29wdHNfY3JlYXRlKCZydW50aW1lX29wdHMsIE5V
TEwsIDAsICZlcnJvcl9hYm9ydCk7Ci0gICAgcWVtdV9vcHRzX2Fic29yYl9xZGljdChvcHRzLCBv
cHRpb25zLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHFlbXVfb3B0c19hYnNvcmJfcWRpY3Qo
b3B0cywgb3B0aW9ucywgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldCA9IC1F
SU5WQUw7CiAgICAgICAgIGdvdG8gb3V0OwogICAgIH0KQEAgLTE4NTAsOSArMTg0OCw4IEBAIHN0
YXRpYyBpbnQgaXNjc2lfb3BlbihCbG9ja0RyaXZlclN0YXRlICpicywgUURpY3QgKm9wdGlvbnMs
IGludCBmbGFncywKICAgICB9CiAKICAgICAvKiBjaGVjayBpZiB3ZSBnb3QgQ0hBUCB1c2VybmFt
ZS9wYXNzd29yZCB2aWEgdGhlIG9wdGlvbnMgKi8KLSAgICBhcHBseV9jaGFwKGlzY3NpLCBvcHRz
LCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyICE9IE5VTEwpIHsKLSAgICAgICAgZXJy
b3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgYXBwbHlfY2hhcChpc2NzaSwgb3B0
cywgZXJycCk7CisgICAgaWYgKCplcnJwICE9IE5VTEwpIHsKICAgICAgICAgcmV0ID0gLUVJTlZB
TDsKICAgICAgICAgZ290byBvdXQ7CiAgICAgfQpAQCAtMTg2NCw5ICsxODYxLDggQEAgc3RhdGlj
IGludCBpc2NzaV9vcGVuKEJsb2NrRHJpdmVyU3RhdGUgKmJzLCBRRGljdCAqb3B0aW9ucywgaW50
IGZsYWdzLAogICAgIH0KIAogICAgIC8qIGNoZWNrIGlmIHdlIGdvdCBIRUFERVJfRElHRVNUIHZp
YSB0aGUgb3B0aW9ucyAqLwotICAgIGFwcGx5X2hlYWRlcl9kaWdlc3QoaXNjc2ksIG9wdHMsICZs
b2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIgIT0gTlVMTCkgewotICAgICAgICBlcnJvcl9w
cm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBhcHBseV9oZWFkZXJfZGlnZXN0KGlzY3Np
LCBvcHRzLCBlcnJwKTsKKyAgICBpZiAoKmVycnAgIT0gTlVMTCkgewogICAgICAgICByZXQgPSAt
RUlOVkFMOwogICAgICAgICBnb3RvIG91dDsKICAgICB9CkBAIC0xOTE4LDkgKzE5MTQsOCBAQCBz
dGF0aWMgaW50IGlzY3NpX29wZW4oQmxvY2tEcml2ZXJTdGF0ZSAqYnMsIFFEaWN0ICpvcHRpb25z
LCBpbnQgZmxhZ3MsCiAgICAgICAgIGZsYWdzICY9IH5CRFJWX09fUkRXUjsKICAgICB9CiAKLSAg
ICBpc2NzaV9yZWFkY2FwYWNpdHlfc3luYyhpc2NzaWx1biwgJmxvY2FsX2Vycik7Ci0gICAgaWYg
KGxvY2FsX2VyciAhPSBOVUxMKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2Nh
bF9lcnIpOworICAgIGlzY3NpX3JlYWRjYXBhY2l0eV9zeW5jKGlzY3NpbHVuLCBlcnJwKTsKKyAg
ICBpZiAoKmVycnAgIT0gTlVMTCkgewogICAgICAgICByZXQgPSAtRUlOVkFMOwogICAgICAgICBn
b3RvIG91dDsKICAgICB9CkBAIC0yMTI1LDcgKzIxMjAsNiBAQCBzdGF0aWMgaW50IGNvcm91dGlu
ZV9mbiBpc2NzaV9jb190cnVuY2F0ZShCbG9ja0RyaXZlclN0YXRlICpicywgaW50NjRfdCBvZmZz
ZXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQcmVhbGxvY01v
ZGUgcHJlYWxsb2MsIEVycm9yICoqZXJycCkKIHsKICAgICBJc2NzaUx1biAqaXNjc2lsdW4gPSBi
cy0+b3BhcXVlOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgaWYgKHByZWFs
bG9jICE9IFBSRUFMTE9DX01PREVfT0ZGKSB7CiAgICAgICAgIGVycm9yX3NldGcoZXJycCwgIlVu
c3VwcG9ydGVkIHByZWFsbG9jYXRpb24gbW9kZSAnJXMnIiwKQEAgLTIxMzgsOSArMjEzMiw4IEBA
IHN0YXRpYyBpbnQgY29yb3V0aW5lX2ZuIGlzY3NpX2NvX3RydW5jYXRlKEJsb2NrRHJpdmVyU3Rh
dGUgKmJzLCBpbnQ2NF90IG9mZnNldCwKICAgICAgICAgcmV0dXJuIC1FTk9UU1VQOwogICAgIH0K
IAotICAgIGlzY3NpX3JlYWRjYXBhY2l0eV9zeW5jKGlzY3NpbHVuLCAmbG9jYWxfZXJyKTsKLSAg
ICBpZiAobG9jYWxfZXJyICE9IE5VTEwpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAs
IGxvY2FsX2Vycik7CisgICAgaXNjc2lfcmVhZGNhcGFjaXR5X3N5bmMoaXNjc2lsdW4sIGVycnAp
OworICAgIGlmICgqZXJycCAhPSBOVUxMKSB7CiAgICAgICAgIHJldHVybiAtRUlPOwogICAgIH0K
IApAQCAtMjE2NCw3ICsyMTU3LDYgQEAgc3RhdGljIGludCBjb3JvdXRpbmVfZm4gaXNjc2lfY29f
Y3JlYXRlX29wdHMoY29uc3QgY2hhciAqZmlsZW5hbWUsIFFlbXVPcHRzICpvcHQKICAgICBCbG9j
a0RyaXZlclN0YXRlICpiczsKICAgICBJc2NzaUx1biAqaXNjc2lsdW4gPSBOVUxMOwogICAgIFFE
aWN0ICpic19vcHRpb25zOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgYnMg
PSBiZHJ2X25ldygpOwogCkBAIC0yMTc1LDkgKzIxNjcsOCBAQCBzdGF0aWMgaW50IGNvcm91dGlu
ZV9mbiBpc2NzaV9jb19jcmVhdGVfb3B0cyhjb25zdCBjaGFyICpmaWxlbmFtZSwgUWVtdU9wdHMg
Km9wdAogICAgIGlzY3NpbHVuID0gYnMtPm9wYXF1ZTsKIAogICAgIGJzX29wdGlvbnMgPSBxZGlj
dF9uZXcoKTsKLSAgICBpc2NzaV9wYXJzZV9maWxlbmFtZShmaWxlbmFtZSwgYnNfb3B0aW9ucywg
JmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdh
dGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBpc2NzaV9wYXJzZV9maWxlbmFtZShmaWxlbmFtZSwg
YnNfb3B0aW9ucywgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldCA9IC1FSU5W
QUw7CiAgICAgfSBlbHNlIHsKICAgICAgICAgcmV0ID0gaXNjc2lfb3BlbihicywgYnNfb3B0aW9u
cywgMCwgTlVMTCk7CmRpZmYgLS1naXQgYS9ibG9jay9taXJyb3IuYyBiL2Jsb2NrL21pcnJvci5j
CmluZGV4IGZlOTg0ZWZiOTAuLmMxYmVhZjlmOGEgMTAwNjQ0Ci0tLSBhL2Jsb2NrL21pcnJvci5j
CisrKyBiL2Jsb2NrL21pcnJvci5jCkBAIC0xNTEyLDcgKzE1MTIsNiBAQCBzdGF0aWMgQmxvY2tK
b2IgKm1pcnJvcl9zdGFydF9qb2IoCiAgICAgQmxvY2tEcml2ZXJTdGF0ZSAqbWlycm9yX3RvcF9i
czsKICAgICBib29sIHRhcmdldF9ncmFwaF9tb2Q7CiAgICAgYm9vbCB0YXJnZXRfaXNfYmFja2lu
ZzsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBpbnQgcmV0OwogCiAgICAgaWYg
KGdyYW51bGFyaXR5ID09IDApIHsKQEAgLTE1NjEsMTIgKzE1NjAsMTEgQEAgc3RhdGljIEJsb2Nr
Sm9iICptaXJyb3Jfc3RhcnRfam9iKAogICAgICAqIGl0IGFsaXZlIHVudGlsIGJsb2NrX2pvYl9j
cmVhdGUoKSBzdWNjZWVkcyBldmVuIGlmIGJzIGhhcyBubyBwYXJlbnQuICovCiAgICAgYmRydl9y
ZWYobWlycm9yX3RvcF9icyk7CiAgICAgYmRydl9kcmFpbmVkX2JlZ2luKGJzKTsKLSAgICBiZHJ2
X2FwcGVuZChtaXJyb3JfdG9wX2JzLCBicywgJmxvY2FsX2Vycik7CisgICAgYmRydl9hcHBlbmQo
bWlycm9yX3RvcF9icywgYnMsIGVycnApOwogICAgIGJkcnZfZHJhaW5lZF9lbmQoYnMpOwogCi0g
ICAgaWYgKGxvY2FsX2VycikgeworICAgIGlmICgqZXJycCkgewogICAgICAgICBiZHJ2X3VucmVm
KG1pcnJvcl90b3BfYnMpOwotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJy
KTsKICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAgfQogCkBAIC0xNjQ3LDkgKzE2NDUsOCBAQCBz
dGF0aWMgQmxvY2tKb2IgKm1pcnJvcl9zdGFydF9qb2IoCiAgICAgICogKFdlIHN0YXJ0IHRyYWNr
aW5nIHdyaXRlcyBhcyBvZiB0aGUgZm9sbG93aW5nCiAgICAgICogYmRydl9jcmVhdGVfZGlydHlf
Yml0bWFwKCkgY2FsbC4pCiAgICAgICovCi0gICAgYmRydl9yZWZyZXNoX2xpbWl0cyhtaXJyb3Jf
dG9wX2JzLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIGJkcnZfcmVmcmVzaF9saW1pdHMobWly
cm9yX3RvcF9icywgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8gZmFpbDsK
ICAgICB9CiAKQEAgLTE3NjEsNyArMTc1OCw2IEBAIEJsb2NrSm9iICpjb21taXRfYWN0aXZlX3N0
YXJ0KGNvbnN0IGNoYXIgKmpvYl9pZCwgQmxvY2tEcml2ZXJTdGF0ZSAqYnMsCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBib29sIGF1dG9fY29tcGxldGUsIEVycm9yICoqZXJycCkKIHsK
ICAgICBib29sIGJhc2VfcmVhZF9vbmx5OwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwog
ICAgIEJsb2NrSm9iICpyZXQ7CiAKICAgICBiYXNlX3JlYWRfb25seSA9IGJkcnZfaXNfcmVhZF9v
bmx5KGJhc2UpOwpAQCAtMTc3OCw5ICsxNzc0LDggQEAgQmxvY2tKb2IgKmNvbW1pdF9hY3RpdmVf
c3RhcnQoY29uc3QgY2hhciAqam9iX2lkLCBCbG9ja0RyaXZlclN0YXRlICpicywKICAgICAgICAg
ICAgICAgICAgICAgIG9uX2Vycm9yLCBvbl9lcnJvciwgdHJ1ZSwgY2IsIG9wYXF1ZSwKICAgICAg
ICAgICAgICAgICAgICAgICZjb21taXRfYWN0aXZlX2pvYl9kcml2ZXIsIGZhbHNlLCBiYXNlLCBh
dXRvX2NvbXBsZXRlLAogICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX25vZGVfbmFtZSwgZmFs
c2UsIE1JUlJPUl9DT1BZX01PREVfQkFDS0dST1VORCwKLSAgICAgICAgICAgICAgICAgICAgICZs
b2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRl
KGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgICAgICAgICAgICAgICBlcnJwKTsKKyAgICBpZiAo
KmVycnApIHsKICAgICAgICAgZ290byBlcnJvcl9yZXN0b3JlX2ZsYWdzOwogICAgIH0KIApkaWZm
IC0tZ2l0IGEvYmxvY2svbmJkLmMgYi9ibG9jay9uYmQuYwppbmRleCA4MTNjNDBkOGYwLi4xZWNh
MGEwODUwIDEwMDY0NAotLS0gYS9ibG9jay9uYmQuYworKysgYi9ibG9jay9uYmQuYwpAQCAtODA4
LDcgKzgwOCw2IEBAIHN0YXRpYyBpbnQgbmJkX2NvX3JlY2VpdmVfY21kcmVhZF9yZXBseShCRFJW
TkJEU3RhdGUgKnMsIHVpbnQ2NF90IGhhbmRsZSwKICAgICBOQkRSZXBseUNodW5rSXRlciBpdGVy
OwogICAgIE5CRFJlcGx5IHJlcGx5OwogICAgIHZvaWQgKnBheWxvYWQgPSBOVUxMOwotICAgIEVy
cm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgTkJEX0ZPUkVBQ0hfUkVQTFlfQ0hVTksocywg
aXRlciwgaGFuZGxlLCBzLT5pbmZvLnN0cnVjdHVyZWRfcmVwbHksCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgcWlvdiwgJnJlcGx5LCAmcGF5bG9hZCkKQEAgLTgyNywyMCArODI2LDIwIEBA
IHN0YXRpYyBpbnQgbmJkX2NvX3JlY2VpdmVfY21kcmVhZF9yZXBseShCRFJWTkJEU3RhdGUgKnMs
IHVpbnQ2NF90IGhhbmRsZSwKICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICBjYXNlIE5CRF9S
RVBMWV9UWVBFX09GRlNFVF9IT0xFOgogICAgICAgICAgICAgcmV0ID0gbmJkX3BhcnNlX29mZnNl
dF9ob2xlX3BheWxvYWQocywgJnJlcGx5LnN0cnVjdHVyZWQsIHBheWxvYWQsCi0gICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQsIHFpb3YsICZsb2Nh
bF9lcnIpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
b2Zmc2V0LCBxaW92LCBlcnJwKTsKICAgICAgICAgICAgIGlmIChyZXQgPCAwKSB7CiAgICAgICAg
ICAgICAgICAgbmJkX2NoYW5uZWxfZXJyb3IocywgcmV0KTsKLSAgICAgICAgICAgICAgICBuYmRf
aXRlcl9jaGFubmVsX2Vycm9yKCZpdGVyLCByZXQsICZsb2NhbF9lcnIpOworICAgICAgICAgICAg
ICAgIG5iZF9pdGVyX2NoYW5uZWxfZXJyb3IoJml0ZXIsIHJldCwgZXJycCk7CiAgICAgICAgICAg
ICB9CiAgICAgICAgICAgICBicmVhazsKICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgIGlm
ICghbmJkX3JlcGx5X3R5cGVfaXNfZXJyb3IoY2h1bmstPnR5cGUpKSB7CiAgICAgICAgICAgICAg
ICAgLyogbm90IGFsbG93ZWQgcmVwbHkgdHlwZSAqLwogICAgICAgICAgICAgICAgIG5iZF9jaGFu
bmVsX2Vycm9yKHMsIC1FSU5WQUwpOwotICAgICAgICAgICAgICAgIGVycm9yX3NldGcoJmxvY2Fs
X2VyciwKKyAgICAgICAgICAgICAgICBlcnJvcl9zZXRnKGVycnAsCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAiVW5leHBlY3RlZCByZXBseSB0eXBlOiAlZCAoJXMpIGZvciBDTURfUkVBRCIs
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVuay0+dHlwZSwgbmJkX3JlcGx5X3R5cGVf
bG9va3VwKGNodW5rLT50eXBlKSk7Ci0gICAgICAgICAgICAgICAgbmJkX2l0ZXJfY2hhbm5lbF9l
cnJvcigmaXRlciwgLUVJTlZBTCwgJmxvY2FsX2Vycik7CisgICAgICAgICAgICAgICAgbmJkX2l0
ZXJfY2hhbm5lbF9lcnJvcigmaXRlciwgLUVJTlZBTCwgZXJycCk7CiAgICAgICAgICAgICB9CiAg
ICAgICAgIH0KIApAQCAtODYxLDcgKzg2MCw2IEBAIHN0YXRpYyBpbnQgbmJkX2NvX3JlY2VpdmVf
YmxvY2tzdGF0dXNfcmVwbHkoQkRSVk5CRFN0YXRlICpzLAogICAgIE5CRFJlcGx5Q2h1bmtJdGVy
IGl0ZXI7CiAgICAgTkJEUmVwbHkgcmVwbHk7CiAgICAgdm9pZCAqcGF5bG9hZCA9IE5VTEw7Ci0g
ICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgYm9vbCByZWNlaXZlZCA9IGZhbHNlOwog
CiAgICAgYXNzZXJ0KCFleHRlbnQtPmxlbmd0aCk7CkBAIC04NzUsMjcgKzg3MywyNyBAQCBzdGF0
aWMgaW50IG5iZF9jb19yZWNlaXZlX2Jsb2Nrc3RhdHVzX3JlcGx5KEJEUlZOQkRTdGF0ZSAqcywK
ICAgICAgICAgY2FzZSBOQkRfUkVQTFlfVFlQRV9CTE9DS19TVEFUVVM6CiAgICAgICAgICAgICBp
ZiAocmVjZWl2ZWQpIHsKICAgICAgICAgICAgICAgICBuYmRfY2hhbm5lbF9lcnJvcihzLCAtRUlO
VkFMKTsKLSAgICAgICAgICAgICAgICBlcnJvcl9zZXRnKCZsb2NhbF9lcnIsICJTZXZlcmFsIEJM
T0NLX1NUQVRVUyBjaHVua3MgaW4gcmVwbHkiKTsKLSAgICAgICAgICAgICAgICBuYmRfaXRlcl9j
aGFubmVsX2Vycm9yKCZpdGVyLCAtRUlOVkFMLCAmbG9jYWxfZXJyKTsKKyAgICAgICAgICAgICAg
ICBlcnJvcl9zZXRnKGVycnAsICJTZXZlcmFsIEJMT0NLX1NUQVRVUyBjaHVua3MgaW4gcmVwbHki
KTsKKyAgICAgICAgICAgICAgICBuYmRfaXRlcl9jaGFubmVsX2Vycm9yKCZpdGVyLCAtRUlOVkFM
LCBlcnJwKTsKICAgICAgICAgICAgIH0KICAgICAgICAgICAgIHJlY2VpdmVkID0gdHJ1ZTsKIAog
ICAgICAgICAgICAgcmV0ID0gbmJkX3BhcnNlX2Jsb2Nrc3RhdHVzX3BheWxvYWQocywgJnJlcGx5
LnN0cnVjdHVyZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBwYXlsb2FkLCBsZW5ndGgsIGV4dGVudCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICZsb2NhbF9lcnIpOworICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJycCk7CiAgICAgICAgICAgICBpZiAocmV0IDwg
MCkgewogICAgICAgICAgICAgICAgIG5iZF9jaGFubmVsX2Vycm9yKHMsIHJldCk7Ci0gICAgICAg
ICAgICAgICAgbmJkX2l0ZXJfY2hhbm5lbF9lcnJvcigmaXRlciwgcmV0LCAmbG9jYWxfZXJyKTsK
KyAgICAgICAgICAgICAgICBuYmRfaXRlcl9jaGFubmVsX2Vycm9yKCZpdGVyLCByZXQsIGVycnAp
OwogICAgICAgICAgICAgfQogICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgIGRlZmF1bHQ6CiAg
ICAgICAgICAgICBpZiAoIW5iZF9yZXBseV90eXBlX2lzX2Vycm9yKGNodW5rLT50eXBlKSkgewog
ICAgICAgICAgICAgICAgIG5iZF9jaGFubmVsX2Vycm9yKHMsIC1FSU5WQUwpOwotICAgICAgICAg
ICAgICAgIGVycm9yX3NldGcoJmxvY2FsX2VyciwKKyAgICAgICAgICAgICAgICBlcnJvcl9zZXRn
KGVycnAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiVW5leHBlY3RlZCByZXBseSB0eXBl
OiAlZCAoJXMpICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJmb3IgQ01EX0JMT0NLX1NU
QVRVUyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVuay0+dHlwZSwgbmJkX3JlcGx5
X3R5cGVfbG9va3VwKGNodW5rLT50eXBlKSk7Ci0gICAgICAgICAgICAgICAgbmJkX2l0ZXJfY2hh
bm5lbF9lcnJvcigmaXRlciwgLUVJTlZBTCwgJmxvY2FsX2Vycik7CisgICAgICAgICAgICAgICAg
bmJkX2l0ZXJfY2hhbm5lbF9lcnJvcigmaXRlciwgLUVJTlZBTCwgZXJycCk7CiAgICAgICAgICAg
ICB9CiAgICAgICAgIH0KIApAQCAtOTA0LDggKzkwMiw4IEBAIHN0YXRpYyBpbnQgbmJkX2NvX3Jl
Y2VpdmVfYmxvY2tzdGF0dXNfcmVwbHkoQkRSVk5CRFN0YXRlICpzLAogICAgIH0KIAogICAgIGlm
ICghZXh0ZW50LT5sZW5ndGggJiYgIWl0ZXIucmVxdWVzdF9yZXQpIHsKLSAgICAgICAgZXJyb3Jf
c2V0ZygmbG9jYWxfZXJyLCAiU2VydmVyIGRpZCBub3QgcmVwbHkgd2l0aCBhbnkgc3RhdHVzIGV4
dGVudHMiKTsKLSAgICAgICAgbmJkX2l0ZXJfY2hhbm5lbF9lcnJvcigmaXRlciwgLUVJTywgJmxv
Y2FsX2Vycik7CisgICAgICAgIGVycm9yX3NldGcoZXJycCwgIlNlcnZlciBkaWQgbm90IHJlcGx5
IHdpdGggYW55IHN0YXR1cyBleHRlbnRzIik7CisgICAgICAgIG5iZF9pdGVyX2NoYW5uZWxfZXJy
b3IoJml0ZXIsIC1FSU8sIGVycnApOwogICAgIH0KIAogICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJw
LCBpdGVyLmVycik7CkBAIC0xMTc0LDE1ICsxMTcyLDEzIEBAIHN0YXRpYyBRSU9DaGFubmVsU29j
a2V0ICpuYmRfZXN0YWJsaXNoX2Nvbm5lY3Rpb24oU29ja2V0QWRkcmVzcyAqc2FkZHIsCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVycm9yICoqZXJy
cCkKIHsKICAgICBRSU9DaGFubmVsU29ja2V0ICpzaW9jOwotICAgIEVycm9yICpsb2NhbF9lcnIg
PSBOVUxMOwogCiAgICAgc2lvYyA9IHFpb19jaGFubmVsX3NvY2tldF9uZXcoKTsKICAgICBxaW9f
Y2hhbm5lbF9zZXRfbmFtZShRSU9fQ0hBTk5FTChzaW9jKSwgIm5iZC1jbGllbnQiKTsKIAotICAg
IHFpb19jaGFubmVsX3NvY2tldF9jb25uZWN0X3N5bmMoc2lvYywgc2FkZHIsICZsb2NhbF9lcnIp
OwotICAgIGlmIChsb2NhbF9lcnIpIHsKKyAgICBxaW9fY2hhbm5lbF9zb2NrZXRfY29ubmVjdF9z
eW5jKHNpb2MsIHNhZGRyLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgb2JqZWN0
X3VucmVmKE9CSkVDVChzaW9jKSk7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2Nh
bF9lcnIpOwogICAgICAgICByZXR1cm4gTlVMTDsKICAgICB9CiAKQEAgLTE0ODksNyArMTQ4NSw2
IEBAIHN0YXRpYyBTb2NrZXRBZGRyZXNzICpuYmRfY29uZmlnKEJEUlZOQkRTdGF0ZSAqcywgUURp
Y3QgKm9wdGlvbnMsCiAgICAgU29ja2V0QWRkcmVzcyAqc2FkZHIgPSBOVUxMOwogICAgIFFEaWN0
ICphZGRyID0gTlVMTDsKICAgICBWaXNpdG9yICppdiA9IE5VTEw7Ci0gICAgRXJyb3IgKmxvY2Fs
X2VyciA9IE5VTEw7CiAKICAgICBxZGljdF9leHRyYWN0X3N1YnFkaWN0KG9wdGlvbnMsICZhZGRy
LCAic2VydmVyLiIpOwogICAgIGlmICghcWRpY3Rfc2l6ZShhZGRyKSkgewpAQCAtMTUwMiw5ICsx
NDk3LDggQEAgc3RhdGljIFNvY2tldEFkZHJlc3MgKm5iZF9jb25maWcoQkRSVk5CRFN0YXRlICpz
LCBRRGljdCAqb3B0aW9ucywKICAgICAgICAgZ290byBkb25lOwogICAgIH0KIAotICAgIHZpc2l0
X3R5cGVfU29ja2V0QWRkcmVzcyhpdiwgTlVMTCwgJnNhZGRyLCAmbG9jYWxfZXJyKTsKLSAgICBp
ZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIp
OworICAgIHZpc2l0X3R5cGVfU29ja2V0QWRkcmVzcyhpdiwgTlVMTCwgJnNhZGRyLCBlcnJwKTsK
KyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ290byBkb25lOwogICAgIH0KIApAQCAtMTU5OSwx
MyArMTU5MywxMSBAQCBzdGF0aWMgaW50IG5iZF9wcm9jZXNzX29wdGlvbnMoQmxvY2tEcml2ZXJT
dGF0ZSAqYnMsIFFEaWN0ICpvcHRpb25zLAogewogICAgIEJEUlZOQkRTdGF0ZSAqcyA9IGJzLT5v
cGFxdWU7CiAgICAgUWVtdU9wdHMgKm9wdHM7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7
CiAgICAgaW50IHJldCA9IC1FSU5WQUw7CiAKICAgICBvcHRzID0gcWVtdV9vcHRzX2NyZWF0ZSgm
bmJkX3J1bnRpbWVfb3B0cywgTlVMTCwgMCwgJmVycm9yX2Fib3J0KTsKLSAgICBxZW11X29wdHNf
YWJzb3JiX3FkaWN0KG9wdHMsIG9wdGlvbnMsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9l
cnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgcWVt
dV9vcHRzX2Fic29yYl9xZGljdChvcHRzLCBvcHRpb25zLCBlcnJwKTsKKyAgICBpZiAoKmVycnAp
IHsKICAgICAgICAgZ290byBlcnJvcjsKICAgICB9CiAKZGlmZiAtLWdpdCBhL2Jsb2NrL25mcy5j
IGIvYmxvY2svbmZzLmMKaW5kZXggZjM5YWNmZGIyOC4uZDFjNDE2MjVkZSAxMDA2NDQKLS0tIGEv
YmxvY2svbmZzLmMKKysrIGIvYmxvY2svbmZzLmMKQEAgLTU2NCwxOCArNTY0LDE2IEBAIHN0YXRp
YyBCbG9ja2Rldk9wdGlvbnNOZnMgKm5mc19vcHRpb25zX3FkaWN0X3RvX3FhcGkoUURpY3QgKm9w
dGlvbnMsCiAgICAgQmxvY2tkZXZPcHRpb25zTmZzICpvcHRzID0gTlVMTDsKICAgICBWaXNpdG9y
ICp2OwogICAgIGNvbnN0IFFEaWN0RW50cnkgKmU7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5V
TEw7CiAKICAgICB2ID0gcW9iamVjdF9pbnB1dF92aXNpdG9yX25ld19mbGF0X2NvbmZ1c2VkKG9w
dGlvbnMsIGVycnApOwogICAgIGlmICghdikgewogICAgICAgICByZXR1cm4gTlVMTDsKICAgICB9
CiAKLSAgICB2aXNpdF90eXBlX0Jsb2NrZGV2T3B0aW9uc05mcyh2LCBOVUxMLCAmb3B0cywgJmxv
Y2FsX2Vycik7CisgICAgdmlzaXRfdHlwZV9CbG9ja2Rldk9wdGlvbnNOZnModiwgTlVMTCwgJm9w
dHMsIGVycnApOwogICAgIHZpc2l0X2ZyZWUodik7CiAKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0g
ICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIGlmICgqZXJycCkg
ewogICAgICAgICByZXR1cm4gTlVMTDsKICAgICB9CiAKZGlmZiAtLWdpdCBhL2Jsb2NrL252bWUu
YyBiL2Jsb2NrL252bWUuYwppbmRleCA1YmUzYTM5YjYzLi4xYjU1ZDY0MGVmIDEwMDY0NAotLS0g
YS9ibG9jay9udm1lLmMKKysrIGIvYmxvY2svbnZtZS5jCkBAIC0xODksNyArMTg5LDYgQEAgc3Rh
dGljIE5WTWVRdWV1ZVBhaXIgKm52bWVfY3JlYXRlX3F1ZXVlX3BhaXIoQmxvY2tEcml2ZXJTdGF0
ZSAqYnMsCiB7CiAgICAgaW50IGksIHI7CiAgICAgQkRSVk5WTWVTdGF0ZSAqcyA9IGJzLT5vcGFx
dWU7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgTlZNZVF1ZXVlUGFpciAqcSA9
IGdfbmV3MChOVk1lUXVldWVQYWlyLCAxKTsKICAgICB1aW50NjRfdCBwcnBfbGlzdF9pb3ZhOwog
CkBAIC0yMDksMTYgKzIwOCwxNCBAQCBzdGF0aWMgTlZNZVF1ZXVlUGFpciAqbnZtZV9jcmVhdGVf
cXVldWVfcGFpcihCbG9ja0RyaXZlclN0YXRlICpicywKICAgICAgICAgcmVxLT5wcnBfbGlzdF9w
YWdlID0gcS0+cHJwX2xpc3RfcGFnZXMgKyBpICogcy0+cGFnZV9zaXplOwogICAgICAgICByZXEt
PnBycF9saXN0X2lvdmEgPSBwcnBfbGlzdF9pb3ZhICsgaSAqIHMtPnBhZ2Vfc2l6ZTsKICAgICB9
Ci0gICAgbnZtZV9pbml0X3F1ZXVlKGJzLCAmcS0+c3EsIHNpemUsIE5WTUVfU1FfRU5UUllfQllU
RVMsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJv
cGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgbnZtZV9pbml0X3F1ZXVlKGJzLCAmcS0+c3Es
IHNpemUsIE5WTUVfU1FfRU5UUllfQllURVMsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAg
ICAgICBnb3RvIGZhaWw7CiAgICAgfQogICAgIHEtPnNxLmRvb3JiZWxsID0gJnMtPnJlZ3MtPmRv
b3JiZWxsc1tpZHggKiAyICogcy0+ZG9vcmJlbGxfc2NhbGVdOwogCi0gICAgbnZtZV9pbml0X3F1
ZXVlKGJzLCAmcS0+Y3EsIHNpemUsIE5WTUVfQ1FfRU5UUllfQllURVMsICZsb2NhbF9lcnIpOwot
ICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2Fs
X2Vycik7CisgICAgbnZtZV9pbml0X3F1ZXVlKGJzLCAmcS0+Y3EsIHNpemUsIE5WTUVfQ1FfRU5U
UllfQllURVMsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICBnb3RvIGZhaWw7CiAg
ICAgfQogICAgIHEtPmNxLmRvb3JiZWxsID0gJnMtPnJlZ3MtPmRvb3JiZWxsc1soaWR4ICogMiAr
IDEpICogcy0+ZG9vcmJlbGxfc2NhbGVdOwpAQCAtNTc0LDcgKzU3MSw2IEBAIHN0YXRpYyBpbnQg
bnZtZV9pbml0KEJsb2NrRHJpdmVyU3RhdGUgKmJzLCBjb25zdCBjaGFyICpkZXZpY2UsIGludCBu
YW1lc3BhY2UsCiAgICAgdWludDY0X3QgY2FwOwogICAgIHVpbnQ2NF90IHRpbWVvdXRfbXM7CiAg
ICAgdWludDY0X3QgZGVhZGxpbmUsIG5vdzsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsK
IAogICAgIHFlbXVfY29fbXV0ZXhfaW5pdCgmcy0+ZG1hX21hcF9sb2NrKTsKICAgICBxZW11X2Nv
X3F1ZXVlX2luaXQoJnMtPmRtYV9mbHVzaF9xdWV1ZSk7CkBAIC02NjYsOSArNjYyLDggQEAgc3Rh
dGljIGludCBudm1lX2luaXQoQmxvY2tEcml2ZXJTdGF0ZSAqYnMsIGNvbnN0IGNoYXIgKmRldmlj
ZSwgaW50IG5hbWVzcGFjZSwKICAgICBhaW9fc2V0X2V2ZW50X25vdGlmaWVyKGJkcnZfZ2V0X2Fp
b19jb250ZXh0KGJzKSwgJnMtPmlycV9ub3RpZmllciwKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGZhbHNlLCBudm1lX2hhbmRsZV9ldmVudCwgbnZtZV9wb2xsX2NiKTsKIAotICAgIG52bWVf
aWRlbnRpZnkoYnMsIG5hbWVzcGFjZSwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2Vycikg
ewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBudm1lX2lk
ZW50aWZ5KGJzLCBuYW1lc3BhY2UsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICBy
ZXQgPSAtRUlPOwogICAgICAgICBnb3RvIG91dDsKICAgICB9CmRpZmYgLS1naXQgYS9ibG9jay9w
YXJhbGxlbHMuYyBiL2Jsb2NrL3BhcmFsbGVscy5jCmluZGV4IDdjZDI3MTRiNjkuLmMzMmFjMDkz
OTEgMTAwNjQ0Ci0tLSBhL2Jsb2NrL3BhcmFsbGVscy5jCisrKyBiL2Jsb2NrL3BhcmFsbGVscy5j
CkBAIC02MTQsNyArNjE0LDYgQEAgc3RhdGljIGludCBjb3JvdXRpbmVfZm4gcGFyYWxsZWxzX2Nv
X2NyZWF0ZV9vcHRzKGNvbnN0IGNoYXIgKmZpbGVuYW1lLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVycm9yICoqZXJycCkKIHsKICAgICBCbG9ja2Rl
dkNyZWF0ZU9wdGlvbnMgKmNyZWF0ZV9vcHRpb25zID0gTlVMTDsKLSAgICBFcnJvciAqbG9jYWxf
ZXJyID0gTlVMTDsKICAgICBCbG9ja0RyaXZlclN0YXRlICpicyA9IE5VTEw7CiAgICAgUURpY3Qg
KnFkaWN0OwogICAgIFZpc2l0b3IgKnY7CkBAIC02MzUsOSArNjM0LDggQEAgc3RhdGljIGludCBj
b3JvdXRpbmVfZm4gcGFyYWxsZWxzX2NvX2NyZWF0ZV9vcHRzKGNvbnN0IGNoYXIgKmZpbGVuYW1l
LAogICAgIH0KIAogICAgIC8qIENyZWF0ZSBhbmQgb3BlbiB0aGUgZmlsZSAocHJvdG9jb2wgbGF5
ZXIpICovCi0gICAgcmV0ID0gYmRydl9jcmVhdGVfZmlsZShmaWxlbmFtZSwgb3B0cywgJmxvY2Fs
X2Vycik7CisgICAgcmV0ID0gYmRydl9jcmVhdGVfZmlsZShmaWxlbmFtZSwgb3B0cywgZXJycCk7
CiAgICAgaWYgKHJldCA8IDApIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2Fs
X2Vycik7CiAgICAgICAgIGdvdG8gZG9uZTsKICAgICB9CiAKQEAgLTY1OCwxMSArNjU2LDEwIEBA
IHN0YXRpYyBpbnQgY29yb3V0aW5lX2ZuIHBhcmFsbGVsc19jb19jcmVhdGVfb3B0cyhjb25zdCBj
aGFyICpmaWxlbmFtZSwKICAgICAgICAgZ290byBkb25lOwogICAgIH0KIAotICAgIHZpc2l0X3R5
cGVfQmxvY2tkZXZDcmVhdGVPcHRpb25zKHYsIE5VTEwsICZjcmVhdGVfb3B0aW9ucywgJmxvY2Fs
X2Vycik7CisgICAgdmlzaXRfdHlwZV9CbG9ja2RldkNyZWF0ZU9wdGlvbnModiwgTlVMTCwgJmNy
ZWF0ZV9vcHRpb25zLCBlcnJwKTsKICAgICB2aXNpdF9mcmVlKHYpOwogCi0gICAgaWYgKGxvY2Fs
X2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBp
ZiAoKmVycnApIHsKICAgICAgICAgcmV0ID0gLUVJTlZBTDsKICAgICAgICAgZ290byBkb25lOwog
ICAgIH0KQEAgLTcyNSw3ICs3MjIsNiBAQCBzdGF0aWMgaW50IHBhcmFsbGVsc19vcGVuKEJsb2Nr
RHJpdmVyU3RhdGUgKmJzLCBRRGljdCAqb3B0aW9ucywgaW50IGZsYWdzLAogICAgIFBhcmFsbGVs
c0hlYWRlciBwaDsKICAgICBpbnQgcmV0LCBzaXplLCBpOwogICAgIFFlbXVPcHRzICpvcHRzID0g
TlVMTDsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBjaGFyICpidWY7CiAKICAg
ICBicy0+ZmlsZSA9IGJkcnZfb3Blbl9jaGlsZChOVUxMLCBvcHRpb25zLCAiZmlsZSIsIGJzLCAm
Y2hpbGRfZmlsZSwKQEAgLTgxMywxMyArODA5LDEzIEBAIHN0YXRpYyBpbnQgcGFyYWxsZWxzX29w
ZW4oQmxvY2tEcml2ZXJTdGF0ZSAqYnMsIFFEaWN0ICpvcHRpb25zLCBpbnQgZmxhZ3MsCiAgICAg
ICAgIH0KICAgICB9CiAKLSAgICBvcHRzID0gcWVtdV9vcHRzX2NyZWF0ZSgmcGFyYWxsZWxzX3J1
bnRpbWVfb3B0cywgTlVMTCwgMCwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VyciAhPSBO
VUxMKSB7CisgICAgb3B0cyA9IHFlbXVfb3B0c19jcmVhdGUoJnBhcmFsbGVsc19ydW50aW1lX29w
dHMsIE5VTEwsIDAsIGVycnApOworICAgIGlmICgqZXJycCAhPSBOVUxMKSB7CiAgICAgICAgIGdv
dG8gZmFpbF9vcHRpb25zOwogICAgIH0KIAotICAgIHFlbXVfb3B0c19hYnNvcmJfcWRpY3Qob3B0
cywgb3B0aW9ucywgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VyciAhPSBOVUxMKSB7Cisg
ICAgcWVtdV9vcHRzX2Fic29yYl9xZGljdChvcHRzLCBvcHRpb25zLCBlcnJwKTsKKyAgICBpZiAo
KmVycnAgIT0gTlVMTCkgewogICAgICAgICBnb3RvIGZhaWxfb3B0aW9uczsKICAgICB9CiAKQEAg
LTgyOSw5ICs4MjUsOSBAQCBzdGF0aWMgaW50IHBhcmFsbGVsc19vcGVuKEJsb2NrRHJpdmVyU3Rh
dGUgKmJzLCBRRGljdCAqb3B0aW9ucywgaW50IGZsYWdzLAogICAgIGJ1ZiA9IHFlbXVfb3B0X2dl
dF9kZWwob3B0cywgUEFSQUxMRUxTX09QVF9QUkVBTExPQ19NT0RFKTsKICAgICBzLT5wcmVhbGxv
Y19tb2RlID0gcWFwaV9lbnVtX3BhcnNlKCZwcmVhbGxvY19tb2RlX2xvb2t1cCwgYnVmLAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUFJMX1BSRUFMTE9DX01PREVfRkFM
TE9DQVRFLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJmxvY2FsX2Vy
cik7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJwKTsKICAgICBn
X2ZyZWUoYnVmKTsKLSAgICBpZiAobG9jYWxfZXJyICE9IE5VTEwpIHsKKyAgICBpZiAoKmVycnAg
IT0gTlVMTCkgewogICAgICAgICBnb3RvIGZhaWxfb3B0aW9uczsKICAgICB9CiAKQEAgLTg1NSw5
ICs4NTEsOCBAQCBzdGF0aWMgaW50IHBhcmFsbGVsc19vcGVuKEJsb2NrRHJpdmVyU3RhdGUgKmJz
LCBRRGljdCAqb3B0aW9ucywgaW50IGZsYWdzLAogICAgIGVycm9yX3NldGcoJnMtPm1pZ3JhdGlv
bl9ibG9ja2VyLCAiVGhlIFBhcmFsbGVscyBmb3JtYXQgdXNlZCBieSBub2RlICclcycgIgogICAg
ICAgICAgICAgICAgImRvZXMgbm90IHN1cHBvcnQgbGl2ZSBtaWdyYXRpb24iLAogICAgICAgICAg
ICAgICAgYmRydl9nZXRfZGV2aWNlX29yX25vZGVfbmFtZShicykpOwotICAgIHJldCA9IG1pZ3Jh
dGVfYWRkX2Jsb2NrZXIocy0+bWlncmF0aW9uX2Jsb2NrZXIsICZsb2NhbF9lcnIpOwotICAgIGlm
IChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7
CisgICAgcmV0ID0gbWlncmF0ZV9hZGRfYmxvY2tlcihzLT5taWdyYXRpb25fYmxvY2tlciwgZXJy
cCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGVycm9yX2ZyZWUocy0+bWlncmF0aW9uX2Js
b2NrZXIpOwogICAgICAgICBnb3RvIGZhaWw7CiAgICAgfQpAQCAtODcyLDcgKzg2Nyw2IEBAIGZh
aWw6CiAgICAgcmV0dXJuIHJldDsKIAogZmFpbF9vcHRpb25zOgotICAgIGVycm9yX3Byb3BhZ2F0
ZShlcnJwLCBsb2NhbF9lcnIpOwogICAgIHJldCA9IC1FSU5WQUw7CiAgICAgZ290byBmYWlsOwog
fQpkaWZmIC0tZ2l0IGEvYmxvY2svcWFwaS5jIGIvYmxvY2svcWFwaS5jCmluZGV4IDE1ZjEwMzAy
NjQuLjMwODk4YzYwYjcgMTAwNjQ0Ci0tLSBhL2Jsb2NrL3FhcGkuYworKysgYi9ibG9jay9xYXBp
LmMKQEAgLTE0OCwxMCArMTQ4LDggQEAgQmxvY2tEZXZpY2VJbmZvICpiZHJ2X2Jsb2NrX2Rldmlj
ZV9pbmZvKEJsb2NrQmFja2VuZCAqYmxrLAogICAgIHBfaW1hZ2VfaW5mbyA9ICZpbmZvLT5pbWFn
ZTsKICAgICBpbmZvLT5iYWNraW5nX2ZpbGVfZGVwdGggPSAwOwogICAgIHdoaWxlICgxKSB7Ci0g
ICAgICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwotICAgICAgICBiZHJ2X3F1ZXJ5X2ltYWdl
X2luZm8oYnMwLCBwX2ltYWdlX2luZm8sICZsb2NhbF9lcnIpOwotICAgICAgICBpZiAobG9jYWxf
ZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAg
ICAgICAgYmRydl9xdWVyeV9pbWFnZV9pbmZvKGJzMCwgcF9pbWFnZV9pbmZvLCBlcnJwKTsKKyAg
ICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICBxYXBpX2ZyZWVfQmxvY2tEZXZpY2VJbmZv
KGluZm8pOwogICAgICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAgICAgIH0KQEAgLTI2MSw3ICsy
NTksNiBAQCB2b2lkIGJkcnZfcXVlcnlfaW1hZ2VfaW5mbyhCbG9ja0RyaXZlclN0YXRlICpicywK
ICAgICBjb25zdCBjaGFyICpiYWNraW5nX2ZpbGVuYW1lOwogICAgIEJsb2NrRHJpdmVySW5mbyBi
ZGk7CiAgICAgaW50IHJldDsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKICAgICBJbWFnZUluZm8g
KmluZm87CiAKICAgICBhaW9fY29udGV4dF9hY3F1aXJlKGJkcnZfZ2V0X2Fpb19jb250ZXh0KGJz
KSk7CkBAIC0yOTMsOSArMjkwLDggQEAgdm9pZCBiZHJ2X3F1ZXJ5X2ltYWdlX2luZm8oQmxvY2tE
cml2ZXJTdGF0ZSAqYnMsCiAgICAgICAgIGluZm8tPmRpcnR5X2ZsYWcgPSBiZGkuaXNfZGlydHk7
CiAgICAgICAgIGluZm8tPmhhc19kaXJ0eV9mbGFnID0gdHJ1ZTsKICAgICB9Ci0gICAgaW5mby0+
Zm9ybWF0X3NwZWNpZmljID0gYmRydl9nZXRfc3BlY2lmaWNfaW5mbyhicywgJmVycik7Ci0gICAg
aWYgKGVycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICBpbmZv
LT5mb3JtYXRfc3BlY2lmaWMgPSBiZHJ2X2dldF9zcGVjaWZpY19pbmZvKGJzLCBlcnJwKTsKKyAg
ICBpZiAoKmVycnApIHsKICAgICAgICAgcWFwaV9mcmVlX0ltYWdlSW5mbyhpbmZvKTsKICAgICAg
ICAgZ290byBvdXQ7CiAgICAgfQpAQCAtMzIyLDcgKzMxOCw3IEBAIHZvaWQgYmRydl9xdWVyeV9p
bWFnZV9pbmZvKEJsb2NrRHJpdmVyU3RhdGUgKmJzLAogICAgICAgICBnX2ZyZWUoYmFja2luZ19m
aWxlbmFtZTIpOwogICAgIH0KIAotICAgIHJldCA9IGJkcnZfcXVlcnlfc25hcHNob3RfaW5mb19s
aXN0KGJzLCAmaW5mby0+c25hcHNob3RzLCAmZXJyKTsKKyAgICByZXQgPSBiZHJ2X3F1ZXJ5X3Nu
YXBzaG90X2luZm9fbGlzdChicywgJmluZm8tPnNuYXBzaG90cywgZXJycCk7CiAgICAgc3dpdGNo
IChyZXQpIHsKICAgICBjYXNlIDA6CiAgICAgICAgIGlmIChpbmZvLT5zbmFwc2hvdHMpIHsKQEAg
LTMzMiwxMCArMzI4LDkgQEAgdm9pZCBiZHJ2X3F1ZXJ5X2ltYWdlX2luZm8oQmxvY2tEcml2ZXJT
dGF0ZSAqYnMsCiAgICAgLyogcmVjb3ZlcmFibGUgZXJyb3IgKi8KICAgICBjYXNlIC1FTk9NRURJ
VU06CiAgICAgY2FzZSAtRU5PVFNVUDoKLSAgICAgICAgZXJyb3JfZnJlZShlcnIpOworICAgICAg
ICBlcnJvcl9mcmVlX2VycnAoZXJycCk7CiAgICAgICAgIGJyZWFrOwogICAgIGRlZmF1bHQ6Ci0g
ICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOwogICAgICAgICBxYXBpX2ZyZWVfSW1h
Z2VJbmZvKGluZm8pOwogICAgICAgICBnb3RvIG91dDsKICAgICB9CkBAIC01NTQsNyArNTQ5LDYg
QEAgQmxvY2tJbmZvTGlzdCAqcW1wX3F1ZXJ5X2Jsb2NrKEVycm9yICoqZXJycCkKIHsKICAgICBC
bG9ja0luZm9MaXN0ICpoZWFkID0gTlVMTCwgKipwX25leHQgPSAmaGVhZDsKICAgICBCbG9ja0Jh
Y2tlbmQgKmJsazsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAogICAgIGZvciAoYmxr
ID0gYmxrX2FsbF9uZXh0KE5VTEwpOyBibGs7IGJsayA9IGJsa19hbGxfbmV4dChibGspKSB7CiAg
ICAgICAgIEJsb2NrSW5mb0xpc3QgKmluZm87CkBAIC01NjQsOSArNTU4LDggQEAgQmxvY2tJbmZv
TGlzdCAqcW1wX3F1ZXJ5X2Jsb2NrKEVycm9yICoqZXJycCkKICAgICAgICAgfQogCiAgICAgICAg
IGluZm8gPSBnX21hbGxvYzAoc2l6ZW9mKCppbmZvKSk7Ci0gICAgICAgIGJkcnZfcXVlcnlfaW5m
byhibGssICZpbmZvLT52YWx1ZSwgJmxvY2FsX2Vycik7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIp
IHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAg
ICBiZHJ2X3F1ZXJ5X2luZm8oYmxrLCAmaW5mby0+dmFsdWUsIGVycnApOworICAgICAgICBpZiAo
KmVycnApIHsKICAgICAgICAgICAgIGdfZnJlZShpbmZvKTsKICAgICAgICAgICAgIHFhcGlfZnJl
ZV9CbG9ja0luZm9MaXN0KGhlYWQpOwogICAgICAgICAgICAgcmV0dXJuIE5VTEw7CmRpZmYgLS1n
aXQgYS9ibG9jay9xY293LmMgYi9ibG9jay9xY293LmMKaW5kZXggNWJkZjcyYmEzMy4uZmNmMWZi
MDgxMiAxMDA2NDQKLS0tIGEvYmxvY2svcWNvdy5jCisrKyBiL2Jsb2NrL3Fjb3cuYwpAQCAtMTIx
LDcgKzEyMSw2IEBAIHN0YXRpYyBpbnQgcWNvd19vcGVuKEJsb2NrRHJpdmVyU3RhdGUgKmJzLCBR
RGljdCAqb3B0aW9ucywgaW50IGZsYWdzLAogICAgIHVuc2lnbmVkIGludCBsZW4sIGksIHNoaWZ0
OwogICAgIGludCByZXQ7CiAgICAgUUNvd0hlYWRlciBoZWFkZXI7Ci0gICAgRXJyb3IgKmxvY2Fs
X2VyciA9IE5VTEw7CiAgICAgUUNyeXB0b0Jsb2NrT3Blbk9wdGlvbnMgKmNyeXB0b19vcHRzID0g
TlVMTDsKICAgICB1bnNpZ25lZCBpbnQgY2ZsYWdzID0gMDsKICAgICBRRGljdCAqZW5jcnlwdG9w
dHMgPSBOVUxMOwpAQCAtMzE0LDkgKzMxMyw4IEBAIHN0YXRpYyBpbnQgcWNvd19vcGVuKEJsb2Nr
RHJpdmVyU3RhdGUgKmJzLCBRRGljdCAqb3B0aW9ucywgaW50IGZsYWdzLAogICAgIGVycm9yX3Nl
dGcoJnMtPm1pZ3JhdGlvbl9ibG9ja2VyLCAiVGhlIHFjb3cgZm9ybWF0IHVzZWQgYnkgbm9kZSAn
JXMnICIKICAgICAgICAgICAgICAgICJkb2VzIG5vdCBzdXBwb3J0IGxpdmUgbWlncmF0aW9uIiwK
ICAgICAgICAgICAgICAgIGJkcnZfZ2V0X2RldmljZV9vcl9ub2RlX25hbWUoYnMpKTsKLSAgICBy
ZXQgPSBtaWdyYXRlX2FkZF9ibG9ja2VyKHMtPm1pZ3JhdGlvbl9ibG9ja2VyLCAmbG9jYWxfZXJy
KTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBs
b2NhbF9lcnIpOworICAgIHJldCA9IG1pZ3JhdGVfYWRkX2Jsb2NrZXIocy0+bWlncmF0aW9uX2Js
b2NrZXIsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICBlcnJvcl9mcmVlKHMtPm1p
Z3JhdGlvbl9ibG9ja2VyKTsKICAgICAgICAgZ290byBmYWlsOwogICAgIH0KQEAgLTk0Nyw3ICs5
NDUsNiBAQCBzdGF0aWMgaW50IGNvcm91dGluZV9mbiBxY293X2NvX2NyZWF0ZV9vcHRzKGNvbnN0
IGNoYXIgKmZpbGVuYW1lLAogICAgIFFEaWN0ICpxZGljdDsKICAgICBWaXNpdG9yICp2OwogICAg
IGNvbnN0IGNoYXIgKnZhbDsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBpbnQg
cmV0OwogCiAgICAgc3RhdGljIGNvbnN0IFFEaWN0UmVuYW1lcyBvcHRfcmVuYW1lc1tdID0gewpA
QCAtOTc3LDkgKzk3NCw4IEBAIHN0YXRpYyBpbnQgY29yb3V0aW5lX2ZuIHFjb3dfY29fY3JlYXRl
X29wdHMoY29uc3QgY2hhciAqZmlsZW5hbWUsCiAgICAgfQogCiAgICAgLyogQ3JlYXRlIGFuZCBv
cGVuIHRoZSBmaWxlIChwcm90b2NvbCBsYXllcikgKi8KLSAgICByZXQgPSBiZHJ2X2NyZWF0ZV9m
aWxlKGZpbGVuYW1lLCBvcHRzLCAmbG9jYWxfZXJyKTsKKyAgICByZXQgPSBiZHJ2X2NyZWF0ZV9m
aWxlKGZpbGVuYW1lLCBvcHRzLCBlcnJwKTsKICAgICBpZiAocmV0IDwgMCkgewotICAgICAgICBl
cnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKICAgICAgICAgZ290byBmYWlsOwogICAg
IH0KIApAQCAtMTAwMCwxMSArOTk2LDEwIEBAIHN0YXRpYyBpbnQgY29yb3V0aW5lX2ZuIHFjb3df
Y29fY3JlYXRlX29wdHMoY29uc3QgY2hhciAqZmlsZW5hbWUsCiAgICAgICAgIGdvdG8gZmFpbDsK
ICAgICB9CiAKLSAgICB2aXNpdF90eXBlX0Jsb2NrZGV2Q3JlYXRlT3B0aW9ucyh2LCBOVUxMLCAm
Y3JlYXRlX29wdGlvbnMsICZsb2NhbF9lcnIpOworICAgIHZpc2l0X3R5cGVfQmxvY2tkZXZDcmVh
dGVPcHRpb25zKHYsIE5VTEwsICZjcmVhdGVfb3B0aW9ucywgZXJycCk7CiAgICAgdmlzaXRfZnJl
ZSh2KTsKIAotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVy
cnAsIGxvY2FsX2Vycik7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldCA9IC1FSU5WQUw7
CiAgICAgICAgIGdvdG8gZmFpbDsKICAgICB9CmRpZmYgLS1naXQgYS9ibG9jay9xY293Mi1iaXRt
YXAuYyBiL2Jsb2NrL3Fjb3cyLWJpdG1hcC5jCmluZGV4IGIyNDg3MTAxZWQuLjkwMjM0NWE4ZTMg
MTAwNjQ0Ci0tLSBhL2Jsb2NrL3Fjb3cyLWJpdG1hcC5jCisrKyBiL2Jsb2NrL3Fjb3cyLWJpdG1h
cC5jCkBAIC0xNTk0LDExICsxNTk0LDkgQEAgZmFpbDoKIGludCBxY293Ml9yZW9wZW5fYml0bWFw
c19ybyhCbG9ja0RyaXZlclN0YXRlICpicywgRXJyb3IgKiplcnJwKQogewogICAgIEJkcnZEaXJ0
eUJpdG1hcCAqYml0bWFwOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCi0gICAgcWNv
dzJfc3RvcmVfcGVyc2lzdGVudF9kaXJ0eV9iaXRtYXBzKGJzLCAmbG9jYWxfZXJyKTsKLSAgICBp
ZiAobG9jYWxfZXJyICE9IE5VTEwpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxv
Y2FsX2Vycik7CisgICAgcWNvdzJfc3RvcmVfcGVyc2lzdGVudF9kaXJ0eV9iaXRtYXBzKGJzLCBl
cnJwKTsKKyAgICBpZiAoKmVycnAgIT0gTlVMTCkgewogICAgICAgICByZXR1cm4gLUVJTlZBTDsK
ICAgICB9CiAKZGlmZiAtLWdpdCBhL2Jsb2NrL3Fjb3cyLmMgYi9ibG9jay9xY293Mi5jCmluZGV4
IDRkMTYzOTNlNjEuLjIxYzMyZTRmNjYgMTAwNjQ0Ci0tLSBhL2Jsb2NrL3Fjb3cyLmMKKysrIGIv
YmxvY2svcWNvdzIuYwpAQCAtOTMxLDI1ICs5MzEsMjIgQEAgc3RhdGljIGludCBxY293Ml91cGRh
dGVfb3B0aW9uc19wcmVwYXJlKEJsb2NrRHJpdmVyU3RhdGUgKmJzLAogICAgIGludCBpOwogICAg
IGNvbnN0IGNoYXIgKmVuY3J5cHRmbXQ7CiAgICAgUURpY3QgKmVuY3J5cHRvcHRzID0gTlVMTDsK
LSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBpbnQgcmV0OwogCiAgICAgcWRpY3Rf
ZXh0cmFjdF9zdWJxZGljdChvcHRpb25zLCAmZW5jcnlwdG9wdHMsICJlbmNyeXB0LiIpOwogICAg
IGVuY3J5cHRmbXQgPSBxZGljdF9nZXRfdHJ5X3N0cihlbmNyeXB0b3B0cywgImZvcm1hdCIpOwog
CiAgICAgb3B0cyA9IHFlbXVfb3B0c19jcmVhdGUoJnFjb3cyX3J1bnRpbWVfb3B0cywgTlVMTCwg
MCwgJmVycm9yX2Fib3J0KTsKLSAgICBxZW11X29wdHNfYWJzb3JiX3FkaWN0KG9wdHMsIG9wdGlv
bnMsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJv
cGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgcWVtdV9vcHRzX2Fic29yYl9xZGljdChvcHRz
LCBvcHRpb25zLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0ID0gLUVJTlZB
TDsKICAgICAgICAgZ290byBmYWlsOwogICAgIH0KIAogICAgIC8qIGdldCBMMiB0YWJsZS9yZWZj
b3VudCBibG9jayBjYWNoZSBzaXplIGZyb20gY29tbWFuZCBsaW5lIG9wdGlvbnMgKi8KICAgICBy
ZWFkX2NhY2hlX3NpemVzKGJzLCBvcHRzLCAmbDJfY2FjaGVfc2l6ZSwgJmwyX2NhY2hlX2VudHJ5
X3NpemUsCi0gICAgICAgICAgICAgICAgICAgICAmcmVmY291bnRfY2FjaGVfc2l6ZSwgJmxvY2Fs
X2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJy
cCwgbG9jYWxfZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICZyZWZjb3VudF9jYWNoZV9zaXpl
LCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0ID0gLUVJTlZBTDsKICAgICAg
ICAgZ290byBmYWlsOwogICAgIH0KQEAgLTEyMTEsNyArMTIwOCw2IEBAIHN0YXRpYyBpbnQgY29y
b3V0aW5lX2ZuIHFjb3cyX2RvX29wZW4oQmxvY2tEcml2ZXJTdGF0ZSAqYnMsIFFEaWN0ICpvcHRp
b25zLAogICAgIHVuc2lnbmVkIGludCBsZW4sIGk7CiAgICAgaW50IHJldCA9IDA7CiAgICAgUUNv
d0hlYWRlciBoZWFkZXI7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgdWludDY0
X3QgZXh0X2VuZDsKICAgICB1aW50NjRfdCBsMV92bV9zdGF0ZV9pbmRleDsKICAgICBib29sIHVw
ZGF0ZV9oZWFkZXIgPSBmYWxzZTsKQEAgLTE0ODYsMTcgKzE0ODIsMTUgQEAgc3RhdGljIGludCBj
b3JvdXRpbmVfZm4gcWNvdzJfZG9fb3BlbihCbG9ja0RyaXZlclN0YXRlICpicywgUURpY3QgKm9w
dGlvbnMsCiAKICAgICAvKiByZWFkIHFjb3cyIGV4dGVuc2lvbnMgKi8KICAgICBpZiAocWNvdzJf
cmVhZF9leHRlbnNpb25zKGJzLCBoZWFkZXIuaGVhZGVyX2xlbmd0aCwgZXh0X2VuZCwgTlVMTCwK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZsYWdzLCAmdXBkYXRlX2hlYWRlciwgJmxv
Y2FsX2VycikpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7Cisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbGFncywgJnVwZGF0ZV9oZWFkZXIsIGVycnAp
KSB7CiAgICAgICAgIHJldCA9IC1FSU5WQUw7CiAgICAgICAgIGdvdG8gZmFpbDsKICAgICB9CiAK
ICAgICAvKiBPcGVuIGV4dGVybmFsIGRhdGEgZmlsZSAqLwogICAgIHMtPmRhdGFfZmlsZSA9IGJk
cnZfb3Blbl9jaGlsZChOVUxMLCBvcHRpb25zLCAiZGF0YS1maWxlIiwgYnMsICZjaGlsZF9maWxl
LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVlLCAmbG9jYWxfZXJyKTsK
LSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2Nh
bF9lcnIpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVlLCBlcnJwKTsK
KyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0ID0gLUVJTlZBTDsKICAgICAgICAgZ290byBm
YWlsOwogICAgIH0KQEAgLTE2NTcsMTIgKzE2NTEsMTEgQEAgc3RhdGljIGludCBjb3JvdXRpbmVf
Zm4gcWNvdzJfZG9fb3BlbihCbG9ja0RyaXZlclN0YXRlICpicywgUURpY3QgKm9wdGlvbnMsCiAK
ICAgICBpZiAoIShiZHJ2X2dldF9mbGFncyhicykgJiBCRFJWX09fSU5BQ1RJVkUpKSB7CiAgICAg
ICAgIC8qIEl0J3MgY2FzZSAxLCAyIG9yIDMuMi4gT3IgMy4xIHdoaWNoIGlzIEJVRyBpbiBtYW5h
Z2VtZW50IGxheWVyLiAqLwotICAgICAgICBib29sIGhlYWRlcl91cGRhdGVkID0gcWNvdzJfbG9h
ZF9kaXJ0eV9iaXRtYXBzKGJzLCAmbG9jYWxfZXJyKTsKKyAgICAgICAgYm9vbCBoZWFkZXJfdXBk
YXRlZCA9IHFjb3cyX2xvYWRfZGlydHlfYml0bWFwcyhicywgZXJycCk7CiAKICAgICAgICAgdXBk
YXRlX2hlYWRlciA9IHVwZGF0ZV9oZWFkZXIgJiYgIWhlYWRlcl91cGRhdGVkOwogICAgIH0KLSAg
ICBpZiAobG9jYWxfZXJyICE9IE5VTEwpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAs
IGxvY2FsX2Vycik7CisgICAgaWYgKCplcnJwICE9IE5VTEwpIHsKICAgICAgICAgcmV0ID0gLUVJ
TlZBTDsKICAgICAgICAgZ290byBmYWlsOwogICAgIH0KQEAgLTI0MjgsNyArMjQyMSw2IEBAIHN0
YXRpYyB2b2lkIGNvcm91dGluZV9mbiBxY293Ml9jb19pbnZhbGlkYXRlX2NhY2hlKEJsb2NrRHJp
dmVyU3RhdGUgKmJzLAogICAgIGludCBmbGFncyA9IHMtPmZsYWdzOwogICAgIFFDcnlwdG9CbG9j
ayAqY3J5cHRvID0gTlVMTDsKICAgICBRRGljdCAqb3B0aW9uczsKLSAgICBFcnJvciAqbG9jYWxf
ZXJyID0gTlVMTDsKICAgICBpbnQgcmV0OwogCiAgICAgLyoKQEAgLTI0NDYsMTEgKzI0MzgsMTEg
QEAgc3RhdGljIHZvaWQgY29yb3V0aW5lX2ZuIHFjb3cyX2NvX2ludmFsaWRhdGVfY2FjaGUoQmxv
Y2tEcml2ZXJTdGF0ZSAqYnMsCiAKICAgICBmbGFncyAmPSB+QkRSVl9PX0lOQUNUSVZFOwogICAg
IHFlbXVfY29fbXV0ZXhfbG9jaygmcy0+bG9jayk7Ci0gICAgcmV0ID0gcWNvdzJfZG9fb3Blbihi
cywgb3B0aW9ucywgZmxhZ3MsICZsb2NhbF9lcnIpOworICAgIHJldCA9IHFjb3cyX2RvX29wZW4o
YnMsIG9wdGlvbnMsIGZsYWdzLCBlcnJwKTsKICAgICBxZW11X2NvX211dGV4X3VubG9jaygmcy0+
bG9jayk7CiAgICAgcW9iamVjdF91bnJlZihvcHRpb25zKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7
Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZV9wcmVwZW5kKGVycnAsIGxvY2FsX2VyciwKKyAgICBp
ZiAoKmVycnApIHsKKyAgICAgICAgZXJyb3JfcHJvcGFnYXRlX3ByZXBlbmQoZXJycCwgKmVycnAs
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJDb3VsZCBub3QgcmVvcGVuIHFjb3cy
IGxheWVyOiAiKTsKICAgICAgICAgYnMtPmRydiA9IE5VTEw7CiAgICAgICAgIHJldHVybjsKQEAg
LTMwNTksNyArMzA1MSw2IEBAIHFjb3cyX2NvX2NyZWF0ZShCbG9ja2RldkNyZWF0ZU9wdGlvbnMg
KmNyZWF0ZV9vcHRpb25zLCBFcnJvciAqKmVycnApCiAgICAgaW50IHZlcnNpb247CiAgICAgaW50
IHJlZmNvdW50X29yZGVyOwogICAgIHVpbnQ2NF90KiByZWZjb3VudF90YWJsZTsKLSAgICBFcnJv
ciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBpbnQgcmV0OwogCiAgICAgYXNzZXJ0KGNyZWF0ZV9v
cHRpb25zLT5kcml2ZXIgPT0gQkxPQ0tERVZfRFJJVkVSX1FDT1cyKTsKQEAgLTMyNTgsOSArMzI0
OSw4IEBAIHFjb3cyX2NvX2NyZWF0ZShCbG9ja2RldkNyZWF0ZU9wdGlvbnMgKmNyZWF0ZV9vcHRp
b25zLCBFcnJvciAqKmVycnApCiAgICAgfQogICAgIGJsayA9IGJsa19uZXdfb3BlbihOVUxMLCBO
VUxMLCBvcHRpb25zLAogICAgICAgICAgICAgICAgICAgICAgICBCRFJWX09fUkRXUiB8IEJEUlZf
T19SRVNJWkUgfCBCRFJWX09fTk9fRkxVU0gsCi0gICAgICAgICAgICAgICAgICAgICAgICZsb2Nh
bF9lcnIpOworICAgICAgICAgICAgICAgICAgICAgICBlcnJwKTsKICAgICBpZiAoYmxrID09IE5V
TEwpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CiAgICAgICAg
IHJldCA9IC1FSU87CiAgICAgICAgIGdvdG8gb3V0OwogICAgIH0KQEAgLTMzMzksOSArMzMyOSw4
IEBAIHFjb3cyX2NvX2NyZWF0ZShCbG9ja2RldkNyZWF0ZU9wdGlvbnMgKmNyZWF0ZV9vcHRpb25z
LCBFcnJvciAqKmVycnApCiAgICAgfQogICAgIGJsayA9IGJsa19uZXdfb3BlbihOVUxMLCBOVUxM
LCBvcHRpb25zLAogICAgICAgICAgICAgICAgICAgICAgICBCRFJWX09fUkRXUiB8IEJEUlZfT19O
T19CQUNLSU5HIHwgQkRSVl9PX05PX0lPLAotICAgICAgICAgICAgICAgICAgICAgICAmbG9jYWxf
ZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAgZXJycCk7CiAgICAgaWYgKGJsayA9PSBOVUxM
KSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogICAgICAgICBy
ZXQgPSAtRUlPOwogICAgICAgICBnb3RvIG91dDsKICAgICB9CkBAIC0zMzYyLDcgKzMzNTEsNiBA
QCBzdGF0aWMgaW50IGNvcm91dGluZV9mbiBxY293Ml9jb19jcmVhdGVfb3B0cyhjb25zdCBjaGFy
ICpmaWxlbmFtZSwgUWVtdU9wdHMgKm9wdAogICAgIFZpc2l0b3IgKnY7CiAgICAgQmxvY2tEcml2
ZXJTdGF0ZSAqYnMgPSBOVUxMOwogICAgIEJsb2NrRHJpdmVyU3RhdGUgKmRhdGFfYnMgPSBOVUxM
OwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIGNvbnN0IGNoYXIgKnZhbDsKICAg
ICBpbnQgcmV0OwogCkBAIC0zNDU3LDExICszNDQ1LDEwIEBAIHN0YXRpYyBpbnQgY29yb3V0aW5l
X2ZuIHFjb3cyX2NvX2NyZWF0ZV9vcHRzKGNvbnN0IGNoYXIgKmZpbGVuYW1lLCBRZW11T3B0cyAq
b3B0CiAgICAgICAgIGdvdG8gZmluaXNoOwogICAgIH0KIAotICAgIHZpc2l0X3R5cGVfQmxvY2tk
ZXZDcmVhdGVPcHRpb25zKHYsIE5VTEwsICZjcmVhdGVfb3B0aW9ucywgJmxvY2FsX2Vycik7Cisg
ICAgdmlzaXRfdHlwZV9CbG9ja2RldkNyZWF0ZU9wdGlvbnModiwgTlVMTCwgJmNyZWF0ZV9vcHRp
b25zLCBlcnJwKTsKICAgICB2aXNpdF9mcmVlKHYpOwogCi0gICAgaWYgKGxvY2FsX2Vycikgewot
ICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBpZiAoKmVycnAp
IHsKICAgICAgICAgcmV0ID0gLUVJTlZBTDsKICAgICAgICAgZ290byBmaW5pc2g7CiAgICAgfQpA
QCAtMzgyNCwxMiArMzgxMSwxMCBAQCBzdGF0aWMgaW50IGNvcm91dGluZV9mbiBxY293Ml9jb190
cnVuY2F0ZShCbG9ja0RyaXZlclN0YXRlICpicywgaW50NjRfdCBvZmZzZXQsCiAgICAgICAgICAg
ICBnb3RvIGZhaWw7CiAgICAgICAgIH0KICAgICAgICAgaWYgKChsYXN0X2NsdXN0ZXIgKyAxKSAq
IHMtPmNsdXN0ZXJfc2l6ZSA8IG9sZF9maWxlX3NpemUpIHsKLSAgICAgICAgICAgIEVycm9yICps
b2NhbF9lcnIgPSBOVUxMOwotCiAgICAgICAgICAgICBiZHJ2X2NvX3RydW5jYXRlKGJzLT5maWxl
LCAobGFzdF9jbHVzdGVyICsgMSkgKiBzLT5jbHVzdGVyX3NpemUsCi0gICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIFBSRUFMTE9DX01PREVfT0ZGLCAmbG9jYWxfZXJyKTsKLSAgICAgICAgICAg
IGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgICAgICAgICB3YXJuX3JlcG9ydGZfZXJyKGxvY2Fs
X2VyciwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUFJFQUxMT0NfTU9ERV9PRkYsIGVy
cnApOworICAgICAgICAgICAgaWYgKCplcnJwKSB7CisgICAgICAgICAgICAgICAgd2Fybl9yZXBv
cnRmX2VycigqZXJycCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJGYWlsZWQg
dG8gdHJ1bmNhdGUgdGhlIHRhaWwgb2YgdGhlIGltYWdlOiAiKTsKICAgICAgICAgICAgIH0KICAg
ICAgICAgfQpAQCAtNDQwNSw3ICs0MzkwLDYgQEAgc3RhdGljIGJvb2wgcWNvdzJfbWVhc3VyZV9s
dWtzX2hlYWRlcmxlbihRZW11T3B0cyAqb3B0cywgc2l6ZV90ICpsZW4sCiBzdGF0aWMgQmxvY2tN
ZWFzdXJlSW5mbyAqcWNvdzJfbWVhc3VyZShRZW11T3B0cyAqb3B0cywgQmxvY2tEcml2ZXJTdGF0
ZSAqaW5fYnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcnJvciAq
KmVycnApCiB7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgQmxvY2tNZWFzdXJl
SW5mbyAqaW5mbzsKICAgICB1aW50NjRfdCByZXF1aXJlZCA9IDA7IC8qIGJ5dGVzIHRoYXQgY29u
dHJpYnV0ZSB0byByZXF1aXJlZCBzaXplICovCiAgICAgdWludDY0X3QgdmlydHVhbF9zaXplOyAv
KiBkaXNrIHNpemUgYXMgc2VlbiBieSBndWVzdCAqLwpAQCAtNDQyMCwyNiArNDQwNCwyNiBAQCBz
dGF0aWMgQmxvY2tNZWFzdXJlSW5mbyAqcWNvdzJfbWVhc3VyZShRZW11T3B0cyAqb3B0cywgQmxv
Y2tEcml2ZXJTdGF0ZSAqaW5fYnMsCiAgICAgYm9vbCBoYXNfbHVrczsKIAogICAgIC8qIFBhcnNl
IGltYWdlIGNyZWF0aW9uIG9wdGlvbnMgKi8KLSAgICBjbHVzdGVyX3NpemUgPSBxY293Ml9vcHRf
Z2V0X2NsdXN0ZXJfc2l6ZV9kZWwob3B0cywgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2Vy
cikgeworICAgIGNsdXN0ZXJfc2l6ZSA9IHFjb3cyX29wdF9nZXRfY2x1c3Rlcl9zaXplX2RlbChv
cHRzLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ290byBlcnI7CiAgICAgfQog
Ci0gICAgdmVyc2lvbiA9IHFjb3cyX29wdF9nZXRfdmVyc2lvbl9kZWwob3B0cywgJmxvY2FsX2Vy
cik7Ci0gICAgaWYgKGxvY2FsX2VycikgeworICAgIHZlcnNpb24gPSBxY293Ml9vcHRfZ2V0X3Zl
cnNpb25fZGVsKG9wdHMsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICBnb3RvIGVy
cjsKICAgICB9CiAKLSAgICByZWZjb3VudF9iaXRzID0gcWNvdzJfb3B0X2dldF9yZWZjb3VudF9i
aXRzX2RlbChvcHRzLCB2ZXJzaW9uLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7
CisgICAgcmVmY291bnRfYml0cyA9IHFjb3cyX29wdF9nZXRfcmVmY291bnRfYml0c19kZWwob3B0
cywgdmVyc2lvbiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8gZXJyOwog
ICAgIH0KIAogICAgIG9wdHN0ciA9IHFlbXVfb3B0X2dldF9kZWwob3B0cywgQkxPQ0tfT1BUX1BS
RUFMTE9DKTsKICAgICBwcmVhbGxvYyA9IHFhcGlfZW51bV9wYXJzZSgmUHJlYWxsb2NNb2RlX2xv
b2t1cCwgb3B0c3RyLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBSRUFMTE9DX01P
REVfT0ZGLCAmbG9jYWxfZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQUkVB
TExPQ19NT0RFX09GRiwgZXJycCk7CiAgICAgZ19mcmVlKG9wdHN0cik7Ci0gICAgaWYgKGxvY2Fs
X2VycikgeworICAgIGlmICgqZXJycCkgewogICAgICAgICBnb3RvIGVycjsKICAgICB9CiAKQEAg
LTQ0NTQsNyArNDQzOCw3IEBAIHN0YXRpYyBCbG9ja01lYXN1cmVJbmZvICpxY293Ml9tZWFzdXJl
KFFlbXVPcHRzICpvcHRzLCBCbG9ja0RyaXZlclN0YXRlICppbl9icywKICAgICBpZiAoaGFzX2x1
a3MpIHsKICAgICAgICAgc2l6ZV90IGhlYWRlcmxlbjsKIAotICAgICAgICBpZiAoIXFjb3cyX21l
YXN1cmVfbHVrc19oZWFkZXJsZW4ob3B0cywgJmhlYWRlcmxlbiwgJmxvY2FsX2VycikpIHsKKyAg
ICAgICAgaWYgKCFxY293Ml9tZWFzdXJlX2x1a3NfaGVhZGVybGVuKG9wdHMsICZoZWFkZXJsZW4s
IGVycnApKSB7CiAgICAgICAgICAgICBnb3RvIGVycjsKICAgICAgICAgfQogCkBAIC00NDY4LDcg
KzQ0NTIsNyBAQCBzdGF0aWMgQmxvY2tNZWFzdXJlSW5mbyAqcWNvdzJfbWVhc3VyZShRZW11T3B0
cyAqb3B0cywgQmxvY2tEcml2ZXJTdGF0ZSAqaW5fYnMsCiAgICAgbDJfdGFibGVzID0gRElWX1JP
VU5EX1VQKHZpcnR1YWxfc2l6ZSAvIGNsdXN0ZXJfc2l6ZSwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgY2x1c3Rlcl9zaXplIC8gc2l6ZW9mKHVpbnQ2NF90KSk7CiAgICAgaWYgKGwyX3Rh
YmxlcyAqIHNpemVvZih1aW50NjRfdCkgPiBRQ09XX01BWF9MMV9TSVpFKSB7Ci0gICAgICAgIGVy
cm9yX3NldGcoJmxvY2FsX2VyciwgIlRoZSBpbWFnZSBzaXplIGlzIHRvbyBsYXJnZSAiCisgICAg
ICAgIGVycm9yX3NldGcoZXJycCwgIlRoZSBpbWFnZSBzaXplIGlzIHRvbyBsYXJnZSAiCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIih0cnkgdXNpbmcgYSBsYXJnZXIgY2x1c3RlciBz
aXplKSIpOwogICAgICAgICBnb3RvIGVycjsKICAgICB9CkBAIC00NDc3LDcgKzQ0NjEsNyBAQCBz
dGF0aWMgQmxvY2tNZWFzdXJlSW5mbyAqcWNvdzJfbWVhc3VyZShRZW11T3B0cyAqb3B0cywgQmxv
Y2tEcml2ZXJTdGF0ZSAqaW5fYnMsCiAgICAgaWYgKGluX2JzKSB7CiAgICAgICAgIGludDY0X3Qg
c3NpemUgPSBiZHJ2X2dldGxlbmd0aChpbl9icyk7CiAgICAgICAgIGlmIChzc2l6ZSA8IDApIHsK
LSAgICAgICAgICAgIGVycm9yX3NldGdfZXJybm8oJmxvY2FsX2VyciwgLXNzaXplLAorICAgICAg
ICAgICAgZXJyb3Jfc2V0Z19lcnJubyhlcnJwLCAtc3NpemUsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICJVbmFibGUgdG8gZ2V0IGltYWdlIHZpcnR1YWxfc2l6ZSIpOwogICAgICAgICAg
ICAgZ290byBlcnI7CiAgICAgICAgIH0KQEAgLTQ1MDIsNyArNDQ4Niw3IEBAIHN0YXRpYyBCbG9j
a01lYXN1cmVJbmZvICpxY293Ml9tZWFzdXJlKFFlbXVPcHRzICpvcHRzLCBCbG9ja0RyaXZlclN0
YXRlICppbl9icywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBzc2l6ZSAtIG9mZnNldCwgJnBudW0sIE5VTEwsCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgTlVMTCk7CiAgICAgICAgICAgICAgICAgaWYgKHJldCA8IDAp
IHsKLSAgICAgICAgICAgICAgICAgICAgZXJyb3Jfc2V0Z19lcnJubygmbG9jYWxfZXJyLCAtcmV0
LAorICAgICAgICAgICAgICAgICAgICBlcnJvcl9zZXRnX2Vycm5vKGVycnAsIC1yZXQsCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIlVuYWJsZSB0byBnZXQgYmxvY2sgc3Rh
dHVzIik7CiAgICAgICAgICAgICAgICAgICAgIGdvdG8gZXJyOwogICAgICAgICAgICAgICAgIH0K
QEAgLTQ1NDEsNyArNDUyNSw2IEBAIHN0YXRpYyBCbG9ja01lYXN1cmVJbmZvICpxY293Ml9tZWFz
dXJlKFFlbXVPcHRzICpvcHRzLCBCbG9ja0RyaXZlclN0YXRlICppbl9icywKICAgICByZXR1cm4g
aW5mbzsKIAogZXJyOgotICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogICAg
IHJldHVybiBOVUxMOwogfQogCkBAIC00NTYwLDEyICs0NTQzLDEwIEBAIHN0YXRpYyBJbWFnZUlu
Zm9TcGVjaWZpYyAqcWNvdzJfZ2V0X3NwZWNpZmljX2luZm8oQmxvY2tEcml2ZXJTdGF0ZSAqYnMs
CiAgICAgQkRSVlFjb3cyU3RhdGUgKnMgPSBicy0+b3BhcXVlOwogICAgIEltYWdlSW5mb1NwZWNp
ZmljICpzcGVjX2luZm87CiAgICAgUUNyeXB0b0Jsb2NrSW5mbyAqZW5jcnlwdF9pbmZvID0gTlVM
TDsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAogICAgIGlmIChzLT5jcnlwdG8gIT0g
TlVMTCkgewotICAgICAgICBlbmNyeXB0X2luZm8gPSBxY3J5cHRvX2Jsb2NrX2dldF9pbmZvKHMt
PmNyeXB0bywgJmxvY2FsX2Vycik7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAg
ICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICBlbmNyeXB0X2lu
Zm8gPSBxY3J5cHRvX2Jsb2NrX2dldF9pbmZvKHMtPmNyeXB0bywgZXJycCk7CisgICAgICAgIGlm
ICgqZXJycCkgewogICAgICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAgICAgIH0KICAgICB9CkBA
IC00NTgyLDkgKzQ1NjMsOCBAQCBzdGF0aWMgSW1hZ2VJbmZvU3BlY2lmaWMgKnFjb3cyX2dldF9z
cGVjaWZpY19pbmZvKEJsb2NrRHJpdmVyU3RhdGUgKmJzLAogICAgICAgICB9OwogICAgIH0gZWxz
ZSBpZiAocy0+cWNvd192ZXJzaW9uID09IDMpIHsKICAgICAgICAgUWNvdzJCaXRtYXBJbmZvTGlz
dCAqYml0bWFwczsKLSAgICAgICAgYml0bWFwcyA9IHFjb3cyX2dldF9iaXRtYXBfaW5mb19saXN0
KGJzLCAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICAgICAg
ZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgIGJpdG1hcHMgPSBxY293
Ml9nZXRfYml0bWFwX2luZm9fbGlzdChicywgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewog
ICAgICAgICAgICAgcWFwaV9mcmVlX0ltYWdlSW5mb1NwZWNpZmljKHNwZWNfaW5mbyk7CiAgICAg
ICAgICAgICByZXR1cm4gTlVMTDsKICAgICAgICAgfQpkaWZmIC0tZ2l0IGEvYmxvY2svcWVkLmMg
Yi9ibG9jay9xZWQuYwppbmRleCAwZDhmZDUwN2FhLi43Njk3ZGQwZjRjIDEwMDY0NAotLS0gYS9i
bG9jay9xZWQuYworKysgYi9ibG9jay9xZWQuYwpAQCAtNzI1LDcgKzcyNSw2IEBAIHN0YXRpYyBp
bnQgY29yb3V0aW5lX2ZuIGJkcnZfcWVkX2NvX2NyZWF0ZV9vcHRzKGNvbnN0IGNoYXIgKmZpbGVu
YW1lLAogICAgIFFEaWN0ICpxZGljdDsKICAgICBWaXNpdG9yICp2OwogICAgIEJsb2NrRHJpdmVy
U3RhdGUgKmJzID0gTlVMTDsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBpbnQg
cmV0OwogCiAgICAgc3RhdGljIGNvbnN0IFFEaWN0UmVuYW1lcyBvcHRfcmVuYW1lc1tdID0gewpA
QCAtNzQ1LDkgKzc0NCw4IEBAIHN0YXRpYyBpbnQgY29yb3V0aW5lX2ZuIGJkcnZfcWVkX2NvX2Ny
ZWF0ZV9vcHRzKGNvbnN0IGNoYXIgKmZpbGVuYW1lLAogICAgIH0KIAogICAgIC8qIENyZWF0ZSBh
bmQgb3BlbiB0aGUgZmlsZSAocHJvdG9jb2wgbGF5ZXIpICovCi0gICAgcmV0ID0gYmRydl9jcmVh
dGVfZmlsZShmaWxlbmFtZSwgb3B0cywgJmxvY2FsX2Vycik7CisgICAgcmV0ID0gYmRydl9jcmVh
dGVfZmlsZShmaWxlbmFtZSwgb3B0cywgZXJycCk7CiAgICAgaWYgKHJldCA8IDApIHsKLSAgICAg
ICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CiAgICAgICAgIGdvdG8gZmFpbDsK
ICAgICB9CiAKQEAgLTc2OCwxMSArNzY2LDEwIEBAIHN0YXRpYyBpbnQgY29yb3V0aW5lX2ZuIGJk
cnZfcWVkX2NvX2NyZWF0ZV9vcHRzKGNvbnN0IGNoYXIgKmZpbGVuYW1lLAogICAgICAgICBnb3Rv
IGZhaWw7CiAgICAgfQogCi0gICAgdmlzaXRfdHlwZV9CbG9ja2RldkNyZWF0ZU9wdGlvbnModiwg
TlVMTCwgJmNyZWF0ZV9vcHRpb25zLCAmbG9jYWxfZXJyKTsKKyAgICB2aXNpdF90eXBlX0Jsb2Nr
ZGV2Q3JlYXRlT3B0aW9ucyh2LCBOVUxMLCAmY3JlYXRlX29wdGlvbnMsIGVycnApOwogICAgIHZp
c2l0X2ZyZWUodik7CiAKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3Bh
Z2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXQgPSAt
RUlOVkFMOwogICAgICAgICBnb3RvIGZhaWw7CiAgICAgfQpAQCAtMTU4OCwxNyArMTU4NSwxNiBA
QCBzdGF0aWMgdm9pZCBjb3JvdXRpbmVfZm4gYmRydl9xZWRfY29faW52YWxpZGF0ZV9jYWNoZShC
bG9ja0RyaXZlclN0YXRlICpicywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIEVycm9yICoqZXJycCkKIHsKICAgICBCRFJWUUVEU3RhdGUgKnMg
PSBicy0+b3BhcXVlOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIGludCByZXQ7
CiAKICAgICBiZHJ2X3FlZF9jbG9zZShicyk7CiAKICAgICBiZHJ2X3FlZF9pbml0X3N0YXRlKGJz
KTsKICAgICBxZW11X2NvX211dGV4X2xvY2soJnMtPnRhYmxlX2xvY2spOwotICAgIHJldCA9IGJk
cnZfcWVkX2RvX29wZW4oYnMsIE5VTEwsIGJzLT5vcGVuX2ZsYWdzLCAmbG9jYWxfZXJyKTsKKyAg
ICByZXQgPSBiZHJ2X3FlZF9kb19vcGVuKGJzLCBOVUxMLCBicy0+b3Blbl9mbGFncywgZXJycCk7
CiAgICAgcWVtdV9jb19tdXRleF91bmxvY2soJnMtPnRhYmxlX2xvY2spOwotICAgIGlmIChsb2Nh
bF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlX3ByZXBlbmQoZXJycCwgbG9jYWxfZXJy
LAorICAgIGlmICgqZXJycCkgeworICAgICAgICBlcnJvcl9wcm9wYWdhdGVfcHJlcGVuZChlcnJw
LCAqZXJycCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIkNvdWxkIG5vdCByZW9w
ZW4gcWVkIGxheWVyOiAiKTsKICAgICAgICAgcmV0dXJuOwogICAgIH0gZWxzZSBpZiAocmV0IDwg
MCkgewpkaWZmIC0tZ2l0IGEvYmxvY2svcXVvcnVtLmMgYi9ibG9jay9xdW9ydW0uYwppbmRleCBk
ZjY4YWRjZmFhLi4wYjZiMDlhZmM3IDEwMDY0NAotLS0gYS9ibG9jay9xdW9ydW0uYworKysgYi9i
bG9jay9xdW9ydW0uYwpAQCAtODYyLDcgKzg2Miw2IEBAIHN0YXRpYyBpbnQgcXVvcnVtX29wZW4o
QmxvY2tEcml2ZXJTdGF0ZSAqYnMsIFFEaWN0ICpvcHRpb25zLCBpbnQgZmxhZ3MsCiAgICAgICAg
ICAgICAgICAgICAgICAgIEVycm9yICoqZXJycCkKIHsKICAgICBCRFJWUXVvcnVtU3RhdGUgKnMg
PSBicy0+b3BhcXVlOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIFFlbXVPcHRz
ICpvcHRzID0gTlVMTDsKICAgICBjb25zdCBjaGFyICpwYXR0ZXJuX3N0cjsKICAgICBib29sICpv
cGVuZWQ7CkBAIC04NzQsMjcgKzg3MywyNyBAQCBzdGF0aWMgaW50IHF1b3J1bV9vcGVuKEJsb2Nr
RHJpdmVyU3RhdGUgKmJzLCBRRGljdCAqb3B0aW9ucywgaW50IGZsYWdzLAogICAgIC8qIGNvdW50
IGhvdyBtYW55IGRpZmZlcmVudCBjaGlsZHJlbiBhcmUgcHJlc2VudCAqLwogICAgIHMtPm51bV9j
aGlsZHJlbiA9IHFkaWN0X2FycmF5X2VudHJpZXMob3B0aW9ucywgImNoaWxkcmVuLiIpOwogICAg
IGlmIChzLT5udW1fY2hpbGRyZW4gPCAwKSB7Ci0gICAgICAgIGVycm9yX3NldGcoJmxvY2FsX2Vy
ciwgIk9wdGlvbiBjaGlsZHJlbiBpcyBub3QgYSB2YWxpZCBhcnJheSIpOworICAgICAgICBlcnJv
cl9zZXRnKGVycnAsICJPcHRpb24gY2hpbGRyZW4gaXMgbm90IGEgdmFsaWQgYXJyYXkiKTsKICAg
ICAgICAgcmV0ID0gLUVJTlZBTDsKICAgICAgICAgZ290byBleGl0OwogICAgIH0KICAgICBpZiAo
cy0+bnVtX2NoaWxkcmVuIDwgMSkgewotICAgICAgICBlcnJvcl9zZXRnKCZsb2NhbF9lcnIsCisg
ICAgICAgIGVycm9yX3NldGcoZXJycCwKICAgICAgICAgICAgICAgICAgICAiTnVtYmVyIG9mIHBy
b3ZpZGVkIGNoaWxkcmVuIG11c3QgYmUgMSBvciBtb3JlIik7CiAgICAgICAgIHJldCA9IC1FSU5W
QUw7CiAgICAgICAgIGdvdG8gZXhpdDsKICAgICB9CiAKICAgICBvcHRzID0gcWVtdV9vcHRzX2Ny
ZWF0ZSgmcXVvcnVtX3J1bnRpbWVfb3B0cywgTlVMTCwgMCwgJmVycm9yX2Fib3J0KTsKLSAgICBx
ZW11X29wdHNfYWJzb3JiX3FkaWN0KG9wdHMsIG9wdGlvbnMsICZsb2NhbF9lcnIpOwotICAgIGlm
IChsb2NhbF9lcnIpIHsKKyAgICBxZW11X29wdHNfYWJzb3JiX3FkaWN0KG9wdHMsIG9wdGlvbnMs
IGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXQgPSAtRUlOVkFMOwogICAgICAg
ICBnb3RvIGV4aXQ7CiAgICAgfQogCiAgICAgcy0+dGhyZXNob2xkID0gcWVtdV9vcHRfZ2V0X251
bWJlcihvcHRzLCBRVU9SVU1fT1BUX1ZPVEVfVEhSRVNIT0xELCAwKTsKICAgICAvKiBhbmQgdmFs
aWRhdGUgaXQgYWdhaW5zdCBzLT5udW1fY2hpbGRyZW4gKi8KLSAgICByZXQgPSBxdW9ydW1fdmFs
aWRfdGhyZXNob2xkKHMtPnRocmVzaG9sZCwgcy0+bnVtX2NoaWxkcmVuLCAmbG9jYWxfZXJyKTsK
KyAgICByZXQgPSBxdW9ydW1fdmFsaWRfdGhyZXNob2xkKHMtPnRocmVzaG9sZCwgcy0+bnVtX2No
aWxkcmVuLCBlcnJwKTsKICAgICBpZiAocmV0IDwgMCkgewogICAgICAgICBnb3RvIGV4aXQ7CiAg
ICAgfQpAQCAtOTA3LDcgKzkwNiw3IEBAIHN0YXRpYyBpbnQgcXVvcnVtX29wZW4oQmxvY2tEcml2
ZXJTdGF0ZSAqYnMsIFFEaWN0ICpvcHRpb25zLCBpbnQgZmxhZ3MsCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAtRUlOVkFMLCBOVUxMKTsKICAgICB9CiAgICAgaWYgKHJldCA8IDApIHsK
LSAgICAgICAgZXJyb3Jfc2V0ZygmbG9jYWxfZXJyLCAiUGxlYXNlIHNldCByZWFkLXBhdHRlcm4g
YXMgZmlmbyBvciBxdW9ydW0iKTsKKyAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAiUGxlYXNlIHNl
dCByZWFkLXBhdHRlcm4gYXMgZmlmbyBvciBxdW9ydW0iKTsKICAgICAgICAgZ290byBleGl0Owog
ICAgIH0KICAgICBzLT5yZWFkX3BhdHRlcm4gPSByZXQ7CkBAIC05MTUsNyArOTE0LDcgQEAgc3Rh
dGljIGludCBxdW9ydW1fb3BlbihCbG9ja0RyaXZlclN0YXRlICpicywgUURpY3QgKm9wdGlvbnMs
IGludCBmbGFncywKICAgICBpZiAocy0+cmVhZF9wYXR0ZXJuID09IFFVT1JVTV9SRUFEX1BBVFRF
Uk5fUVVPUlVNKSB7CiAgICAgICAgIHMtPmlzX2Jsa3ZlcmlmeSA9IHFlbXVfb3B0X2dldF9ib29s
KG9wdHMsIFFVT1JVTV9PUFRfQkxLVkVSSUZZLCBmYWxzZSk7CiAgICAgICAgIGlmIChzLT5pc19i
bGt2ZXJpZnkgJiYgKHMtPm51bV9jaGlsZHJlbiAhPSAyIHx8IHMtPnRocmVzaG9sZCAhPSAyKSkg
ewotICAgICAgICAgICAgZXJyb3Jfc2V0ZygmbG9jYWxfZXJyLCAiYmxrdmVyaWZ5PW9uIGNhbiBv
bmx5IGJlIHNldCBpZiB0aGVyZSBhcmUgIgorICAgICAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAi
YmxrdmVyaWZ5PW9uIGNhbiBvbmx5IGJlIHNldCBpZiB0aGVyZSBhcmUgIgogICAgICAgICAgICAg
ICAgICAgICAgICAiZXhhY3RseSB0d28gZmlsZXMgYW5kIHZvdGUtdGhyZXNob2xkIGlzIDIiKTsK
ICAgICAgICAgICAgIHJldCA9IC1FSU5WQUw7CiAgICAgICAgICAgICBnb3RvIGV4aXQ7CkBAIC05
MjQsNyArOTIzLDcgQEAgc3RhdGljIGludCBxdW9ydW1fb3BlbihCbG9ja0RyaXZlclN0YXRlICpi
cywgUURpY3QgKm9wdGlvbnMsIGludCBmbGFncywKICAgICAgICAgcy0+cmV3cml0ZV9jb3JydXB0
ZWQgPSBxZW11X29wdF9nZXRfYm9vbChvcHRzLCBRVU9SVU1fT1BUX1JFV1JJVEUsCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UpOwogICAgICAg
ICBpZiAocy0+cmV3cml0ZV9jb3JydXB0ZWQgJiYgcy0+aXNfYmxrdmVyaWZ5KSB7Ci0gICAgICAg
ICAgICBlcnJvcl9zZXRnKCZsb2NhbF9lcnIsCisgICAgICAgICAgICBlcnJvcl9zZXRnKGVycnAs
CiAgICAgICAgICAgICAgICAgICAgICAgICJyZXdyaXRlLWNvcnJ1cHRlZD1vbiBjYW5ub3QgYmUg
dXNlZCB3aXRoIGJsa3ZlcmlmeT1vbiIpOwogICAgICAgICAgICAgcmV0ID0gLUVJTlZBTDsKICAg
ICAgICAgICAgIGdvdG8gZXhpdDsKQEAgLTk0MSw4ICs5NDAsOCBAQCBzdGF0aWMgaW50IHF1b3J1
bV9vcGVuKEJsb2NrRHJpdmVyU3RhdGUgKmJzLCBRRGljdCAqb3B0aW9ucywgaW50IGZsYWdzLAog
ICAgICAgICBhc3NlcnQocmV0IDwgMzIpOwogCiAgICAgICAgIHMtPmNoaWxkcmVuW2ldID0gYmRy
dl9vcGVuX2NoaWxkKE5VTEwsIG9wdGlvbnMsIGluZGV4c3RyLCBicywKLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgJmNoaWxkX2Zvcm1hdCwgZmFsc2UsICZsb2NhbF9l
cnIpOwotICAgICAgICBpZiAobG9jYWxfZXJyKSB7CisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICZjaGlsZF9mb3JtYXQsIGZhbHNlLCBlcnJwKTsKKyAgICAgICAgaWYg
KCplcnJwKSB7CiAgICAgICAgICAgICByZXQgPSAtRUlOVkFMOwogICAgICAgICAgICAgZ290byBj
bG9zZV9leGl0OwogICAgICAgICB9CkBAIC05NjksNyArOTY4LDYgQEAgY2xvc2VfZXhpdDoKIGV4
aXQ6CiAgICAgcWVtdV9vcHRzX2RlbChvcHRzKTsKICAgICAvKiBwcm9wYWdhdGUgZXJyb3IgKi8K
LSAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKICAgICByZXR1cm4gcmV0Owog
fQogCmRpZmYgLS1naXQgYS9ibG9jay9yYXctZm9ybWF0LmMgYi9ibG9jay9yYXctZm9ybWF0LmMK
aW5kZXggNDJjMjhjYzI5YS4uZTgzYTMwYzNiNSAxMDA2NDQKLS0tIGEvYmxvY2svcmF3LWZvcm1h
dC5jCisrKyBiL2Jsb2NrL3Jhdy1mb3JtYXQuYwpAQCAtNzQsNyArNzQsNiBAQCBzdGF0aWMgUWVt
dU9wdHNMaXN0IHJhd19jcmVhdGVfb3B0cyA9IHsKIHN0YXRpYyBpbnQgcmF3X3JlYWRfb3B0aW9u
cyhRRGljdCAqb3B0aW9ucywgQmxvY2tEcml2ZXJTdGF0ZSAqYnMsCiAgICAgQkRSVlJhd1N0YXRl
ICpzLCBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAg
UWVtdU9wdHMgKm9wdHMgPSBOVUxMOwogICAgIGludDY0X3QgcmVhbF9zaXplID0gMDsKICAgICBp
bnQgcmV0OwpAQCAtODYsOSArODUsOCBAQCBzdGF0aWMgaW50IHJhd19yZWFkX29wdGlvbnMoUURp
Y3QgKm9wdGlvbnMsIEJsb2NrRHJpdmVyU3RhdGUgKmJzLAogICAgIH0KIAogICAgIG9wdHMgPSBx
ZW11X29wdHNfY3JlYXRlKCZyYXdfcnVudGltZV9vcHRzLCBOVUxMLCAwLCAmZXJyb3JfYWJvcnQp
OwotICAgIHFlbXVfb3B0c19hYnNvcmJfcWRpY3Qob3B0cywgb3B0aW9ucywgJmxvY2FsX2Vycik7
Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9j
YWxfZXJyKTsKKyAgICBxZW11X29wdHNfYWJzb3JiX3FkaWN0KG9wdHMsIG9wdGlvbnMsIGVycnAp
OworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXQgPSAtRUlOVkFMOwogICAgICAgICBnb3Rv
IGVuZDsKICAgICB9CmRpZmYgLS1naXQgYS9ibG9jay9yYmQuYyBiL2Jsb2NrL3JiZC5jCmluZGV4
IDA1N2FmNDNkNDguLmFlNGRkOWU3MDUgMTAwNjQ0Ci0tLSBhL2Jsb2NrL3JiZC5jCisrKyBiL2Js
b2NrL3JiZC5jCkBAIC00MzEsNyArNDMxLDYgQEAgc3RhdGljIGludCBjb3JvdXRpbmVfZm4gcWVt
dV9yYmRfY29fY3JlYXRlX29wdHMoY29uc3QgY2hhciAqZmlsZW5hbWUsCiAgICAgQmxvY2tkZXZD
cmVhdGVPcHRpb25zICpjcmVhdGVfb3B0aW9uczsKICAgICBCbG9ja2RldkNyZWF0ZU9wdGlvbnNS
YmQgKnJiZF9vcHRzOwogICAgIEJsb2NrZGV2T3B0aW9uc1JiZCAqbG9jOwotICAgIEVycm9yICps
b2NhbF9lcnIgPSBOVUxMOwogICAgIGNvbnN0IGNoYXIgKmtleXBhaXJzLCAqcGFzc3dvcmRfc2Vj
cmV0OwogICAgIFFEaWN0ICpvcHRpb25zID0gTlVMTDsKICAgICBpbnQgcmV0ID0gMDsKQEAgLTQ1
MiwxMCArNDUxLDkgQEAgc3RhdGljIGludCBjb3JvdXRpbmVfZm4gcWVtdV9yYmRfY29fY3JlYXRl
X29wdHMoY29uc3QgY2hhciAqZmlsZW5hbWUsCiAgICAgcmJkX29wdHMtPmhhc19jbHVzdGVyX3Np
emUgPSAocmJkX29wdHMtPmNsdXN0ZXJfc2l6ZSAhPSAwKTsKIAogICAgIG9wdGlvbnMgPSBxZGlj
dF9uZXcoKTsKLSAgICBxZW11X3JiZF9wYXJzZV9maWxlbmFtZShmaWxlbmFtZSwgb3B0aW9ucywg
JmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgeworICAgIHFlbXVfcmJkX3BhcnNlX2Zp
bGVuYW1lKGZpbGVuYW1lLCBvcHRpb25zLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAg
ICAgcmV0ID0gLUVJTlZBTDsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vy
cik7CiAgICAgICAgIGdvdG8gZXhpdDsKICAgICB9CiAKQEAgLTU3Myw3ICs1NzEsNiBAQCBzdGF0
aWMgaW50IHFlbXVfcmJkX2Nvbm5lY3QocmFkb3NfdCAqY2x1c3RlciwgcmFkb3NfaW9jdHhfdCAq
aW9fY3R4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVycm9yICoqZXJycCkKIHsKICAg
ICBjaGFyICptb25faG9zdCA9IE5VTEw7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAg
ICAgaW50IHI7CiAKICAgICBpZiAoc2VjcmV0aWQpIHsKQEAgLTU4Niw5ICs1ODMsOCBAQCBzdGF0
aWMgaW50IHFlbXVfcmJkX2Nvbm5lY3QocmFkb3NfdCAqY2x1c3RlciwgcmFkb3NfaW9jdHhfdCAq
aW9fY3R4LAogICAgICAgICBvcHRzLT5oYXNfa2V5X3NlY3JldCA9IHRydWU7CiAgICAgfQogCi0g
ICAgbW9uX2hvc3QgPSBxZW11X3JiZF9tb25faG9zdChvcHRzLCAmbG9jYWxfZXJyKTsKLSAgICBp
ZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIp
OworICAgIG1vbl9ob3N0ID0gcWVtdV9yYmRfbW9uX2hvc3Qob3B0cywgZXJycCk7CisgICAgaWYg
KCplcnJwKSB7CiAgICAgICAgIHIgPSAtRUlOVkFMOwogICAgICAgICBnb3RvIGZhaWxlZF9vcHRz
OwogICAgIH0KQEAgLTY2MSw3ICs2NTcsNiBAQCBzdGF0aWMgaW50IHFlbXVfcmJkX2NvbnZlcnRf
b3B0aW9ucyhRRGljdCAqb3B0aW9ucywgQmxvY2tkZXZPcHRpb25zUmJkICoqb3B0cywKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVycm9yICoqZXJycCkKIHsKICAgICBWaXNp
dG9yICp2OwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgLyogQ29udmVydCB0
aGUgcmVtYWluaW5nIG9wdGlvbnMgaW50byBhIFFBUEkgb2JqZWN0ICovCiAgICAgdiA9IHFvYmpl
Y3RfaW5wdXRfdmlzaXRvcl9uZXdfZmxhdF9jb25mdXNlZChvcHRpb25zLCBlcnJwKTsKQEAgLTY2
OSwxMSArNjY0LDEwIEBAIHN0YXRpYyBpbnQgcWVtdV9yYmRfY29udmVydF9vcHRpb25zKFFEaWN0
ICpvcHRpb25zLCBCbG9ja2Rldk9wdGlvbnNSYmQgKipvcHRzLAogICAgICAgICByZXR1cm4gLUVJ
TlZBTDsKICAgICB9CiAKLSAgICB2aXNpdF90eXBlX0Jsb2NrZGV2T3B0aW9uc1JiZCh2LCBOVUxM
LCBvcHRzLCAmbG9jYWxfZXJyKTsKKyAgICB2aXNpdF90eXBlX0Jsb2NrZGV2T3B0aW9uc1JiZCh2
LCBOVUxMLCBvcHRzLCBlcnJwKTsKICAgICB2aXNpdF9mcmVlKHYpOwogCi0gICAgaWYgKGxvY2Fs
X2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBp
ZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuIC1FSU5WQUw7CiAgICAgfQogCkBAIC03MTMsNyAr
NzA3LDYgQEAgc3RhdGljIGludCBxZW11X3JiZF9vcGVuKEJsb2NrRHJpdmVyU3RhdGUgKmJzLCBR
RGljdCAqb3B0aW9ucywgaW50IGZsYWdzLAogICAgIEJEUlZSQkRTdGF0ZSAqcyA9IGJzLT5vcGFx
dWU7CiAgICAgQmxvY2tkZXZPcHRpb25zUmJkICpvcHRzID0gTlVMTDsKICAgICBjb25zdCBRRGlj
dEVudHJ5ICplOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIGNoYXIgKmtleXBh
aXJzLCAqc2VjcmV0aWQ7CiAgICAgaW50IHI7CiAKQEAgLTcyNywxMyArNzIwLDEyIEBAIHN0YXRp
YyBpbnQgcWVtdV9yYmRfb3BlbihCbG9ja0RyaXZlclN0YXRlICpicywgUURpY3QgKm9wdGlvbnMs
IGludCBmbGFncywKICAgICAgICAgcWRpY3RfZGVsKG9wdGlvbnMsICJwYXNzd29yZC1zZWNyZXQi
KTsKICAgICB9CiAKLSAgICByID0gcWVtdV9yYmRfY29udmVydF9vcHRpb25zKG9wdGlvbnMsICZv
cHRzLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7CisgICAgciA9IHFlbXVfcmJk
X2NvbnZlcnRfb3B0aW9ucyhvcHRpb25zLCAmb3B0cywgZXJycCk7CisgICAgaWYgKCplcnJwKSB7
CiAgICAgICAgIC8qIElmIGtleXBhaXJzIGFyZSBwcmVzZW50LCB0aGF0IG1lYW5zIHNvbWUgb3B0
aW9ucyBhcmUgcHJlc2VudCBpbgogICAgICAgICAgKiB0aGUgbW9kZXJuIG9wdGlvbiBmb3JtYXQu
ICBEb24ndCBhdHRlbXB0IHRvIHBhcnNlIGxlZ2FjeSBvcHRpb24KICAgICAgICAgICogZm9ybWF0
cywgYXMgd2Ugd29uJ3Qgc3VwcG9ydCBtaXhlZCB1c2FnZS4gKi8KICAgICAgICAgaWYgKGtleXBh
aXJzKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKICAg
ICAgICAgICAgIGdvdG8gb3V0OwogICAgICAgICB9CiAKQEAgLTc0Niw3ICs3MzgsNiBAQCBzdGF0
aWMgaW50IHFlbXVfcmJkX29wZW4oQmxvY2tEcml2ZXJTdGF0ZSAqYnMsIFFEaWN0ICpvcHRpb25z
LCBpbnQgZmxhZ3MsCiAgICAgICAgIGlmIChyIDwgMCkgewogICAgICAgICAgICAgLyogUHJvcGFn
YXRlIHRoZSBvcmlnaW5hbCBlcnJvciwgbm90IHRoZSBsZWdhY3kgcGFyc2luZyBmYWxsYmFjawog
ICAgICAgICAgICAgICogZXJyb3IsIGFzIHRoZSBsYXR0ZXIgd2FzIGp1c3QgYSBiZXN0LWVmZm9y
dCBhdHRlbXB0LiAqLwotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vy
cik7CiAgICAgICAgICAgICBnb3RvIG91dDsKICAgICAgICAgfQogICAgICAgICAvKiBUYWtlIGNh
cmUgd2hlbmV2ZXIgZGVjaWRpbmcgdG8gYWN0dWFsbHkgZGVwcmVjYXRlOyBvbmNlIHRoaXMgYWJp
bGl0eQpkaWZmIC0tZ2l0IGEvYmxvY2svcmVwbGljYXRpb24uYyBiL2Jsb2NrL3JlcGxpY2F0aW9u
LmMKaW5kZXggOTM2YjJmOGI1YS4uMjJhZTEwNjdlYyAxMDA2NDQKLS0tIGEvYmxvY2svcmVwbGlj
YXRpb24uYworKysgYi9ibG9jay9yZXBsaWNhdGlvbi5jCkBAIC04NSw3ICs4NSw2IEBAIHN0YXRp
YyBpbnQgcmVwbGljYXRpb25fb3BlbihCbG9ja0RyaXZlclN0YXRlICpicywgUURpY3QgKm9wdGlv
bnMsCiB7CiAgICAgaW50IHJldDsKICAgICBCRFJWUmVwbGljYXRpb25TdGF0ZSAqcyA9IGJzLT5v
cGFxdWU7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgUWVtdU9wdHMgKm9wdHMg
PSBOVUxMOwogICAgIGNvbnN0IGNoYXIgKm1vZGU7CiAgICAgY29uc3QgY2hhciAqdG9wX2lkOwpA
QCAtOTgsMTQgKzk3LDE0IEBAIHN0YXRpYyBpbnQgcmVwbGljYXRpb25fb3BlbihCbG9ja0RyaXZl
clN0YXRlICpicywgUURpY3QgKm9wdGlvbnMsCiAKICAgICByZXQgPSAtRUlOVkFMOwogICAgIG9w
dHMgPSBxZW11X29wdHNfY3JlYXRlKCZyZXBsaWNhdGlvbl9ydW50aW1lX29wdHMsIE5VTEwsIDAs
ICZlcnJvcl9hYm9ydCk7Ci0gICAgcWVtdV9vcHRzX2Fic29yYl9xZGljdChvcHRzLCBvcHRpb25z
LCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7CisgICAgcWVtdV9vcHRzX2Fic29y
Yl9xZGljdChvcHRzLCBvcHRpb25zLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAg
Z290byBmYWlsOwogICAgIH0KIAogICAgIG1vZGUgPSBxZW11X29wdF9nZXQob3B0cywgUkVQTElD
QVRJT05fTU9ERSk7CiAgICAgaWYgKCFtb2RlKSB7Ci0gICAgICAgIGVycm9yX3NldGcoJmxvY2Fs
X2VyciwgIk1pc3NpbmcgdGhlIG9wdGlvbiBtb2RlIik7CisgICAgICAgIGVycm9yX3NldGcoZXJy
cCwgIk1pc3NpbmcgdGhlIG9wdGlvbiBtb2RlIik7CiAgICAgICAgIGdvdG8gZmFpbDsKICAgICB9
CiAKQEAgLTExMyw3ICsxMTIsOCBAQCBzdGF0aWMgaW50IHJlcGxpY2F0aW9uX29wZW4oQmxvY2tE
cml2ZXJTdGF0ZSAqYnMsIFFEaWN0ICpvcHRpb25zLAogICAgICAgICBzLT5tb2RlID0gUkVQTElD
QVRJT05fTU9ERV9QUklNQVJZOwogICAgICAgICB0b3BfaWQgPSBxZW11X29wdF9nZXQob3B0cywg
UkVQTElDQVRJT05fVE9QX0lEKTsKICAgICAgICAgaWYgKHRvcF9pZCkgewotICAgICAgICAgICAg
ZXJyb3Jfc2V0ZygmbG9jYWxfZXJyLCAiVGhlIHByaW1hcnkgc2lkZSBkb2VzIG5vdCBzdXBwb3J0
IG9wdGlvbiB0b3AtaWQiKTsKKyAgICAgICAgICAgIGVycm9yX3NldGcoZXJycCwKKyAgICAgICAg
ICAgICAgICAgICAgICAgIlRoZSBwcmltYXJ5IHNpZGUgZG9lcyBub3Qgc3VwcG9ydCBvcHRpb24g
dG9wLWlkIik7CiAgICAgICAgICAgICBnb3RvIGZhaWw7CiAgICAgICAgIH0KICAgICB9IGVsc2Ug
aWYgKCFzdHJjbXAobW9kZSwgInNlY29uZGFyeSIpKSB7CkBAIC0xMjEsMTEgKzEyMSwxMSBAQCBz
dGF0aWMgaW50IHJlcGxpY2F0aW9uX29wZW4oQmxvY2tEcml2ZXJTdGF0ZSAqYnMsIFFEaWN0ICpv
cHRpb25zLAogICAgICAgICB0b3BfaWQgPSBxZW11X29wdF9nZXQob3B0cywgUkVQTElDQVRJT05f
VE9QX0lEKTsKICAgICAgICAgcy0+dG9wX2lkID0gZ19zdHJkdXAodG9wX2lkKTsKICAgICAgICAg
aWYgKCFzLT50b3BfaWQpIHsKLSAgICAgICAgICAgIGVycm9yX3NldGcoJmxvY2FsX2VyciwgIk1p
c3NpbmcgdGhlIG9wdGlvbiB0b3AtaWQiKTsKKyAgICAgICAgICAgIGVycm9yX3NldGcoZXJycCwg
Ik1pc3NpbmcgdGhlIG9wdGlvbiB0b3AtaWQiKTsKICAgICAgICAgICAgIGdvdG8gZmFpbDsKICAg
ICAgICAgfQogICAgIH0gZWxzZSB7Ci0gICAgICAgIGVycm9yX3NldGcoJmxvY2FsX2VyciwKKyAg
ICAgICAgZXJyb3Jfc2V0ZyhlcnJwLAogICAgICAgICAgICAgICAgICAgICJUaGUgb3B0aW9uIG1v
ZGUncyB2YWx1ZSBzaG91bGQgYmUgcHJpbWFyeSBvciBzZWNvbmRhcnkiKTsKICAgICAgICAgZ290
byBmYWlsOwogICAgIH0KQEAgLTEzNiw3ICsxMzYsNiBAQCBzdGF0aWMgaW50IHJlcGxpY2F0aW9u
X29wZW4oQmxvY2tEcml2ZXJTdGF0ZSAqYnMsIFFEaWN0ICpvcHRpb25zLAogCiBmYWlsOgogICAg
IHFlbXVfb3B0c19kZWwob3B0cyk7Ci0gICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vy
cik7CiAKICAgICByZXR1cm4gcmV0OwogfQpAQCAtMzE0LDcgKzMxMyw2IEBAIHN0YXRpYyBib29s
IHJlcGxpY2F0aW9uX3JlY3Vyc2VfaXNfZmlyc3Rfbm9uX2ZpbHRlcihCbG9ja0RyaXZlclN0YXRl
ICpicywKIAogc3RhdGljIHZvaWQgc2Vjb25kYXJ5X2RvX2NoZWNrcG9pbnQoQkRSVlJlcGxpY2F0
aW9uU3RhdGUgKnMsIEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVM
TDsKICAgICBpbnQgcmV0OwogCiAgICAgaWYgKCFzLT5iYWNrdXBfam9iKSB7CkBAIC0zMjIsOSAr
MzIwLDggQEAgc3RhdGljIHZvaWQgc2Vjb25kYXJ5X2RvX2NoZWNrcG9pbnQoQkRSVlJlcGxpY2F0
aW9uU3RhdGUgKnMsIEVycm9yICoqZXJycCkKICAgICAgICAgcmV0dXJuOwogICAgIH0KIAotICAg
IGJhY2t1cF9kb19jaGVja3BvaW50KHMtPmJhY2t1cF9qb2IsICZsb2NhbF9lcnIpOwotICAgIGlm
IChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7
CisgICAgYmFja3VwX2RvX2NoZWNrcG9pbnQocy0+YmFja3VwX2pvYiwgZXJycCk7CisgICAgaWYg
KCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKQEAgLTM2Myw3ICszNjAsNiBAQCBz
dGF0aWMgdm9pZCByZW9wZW5fYmFja2luZ19maWxlKEJsb2NrRHJpdmVyU3RhdGUgKmJzLCBib29s
IHdyaXRhYmxlLAogewogICAgIEJEUlZSZXBsaWNhdGlvblN0YXRlICpzID0gYnMtPm9wYXF1ZTsK
ICAgICBCbG9ja1Jlb3BlblF1ZXVlICpyZW9wZW5fcXVldWUgPSBOVUxMOwotICAgIEVycm9yICps
b2NhbF9lcnIgPSBOVUxMOwogCiAgICAgaWYgKHdyaXRhYmxlKSB7CiAgICAgICAgIHMtPm9yaWdf
aGlkZGVuX3JlYWRfb25seSA9IGJkcnZfaXNfcmVhZF9vbmx5KHMtPmhpZGRlbl9kaXNrLT5icyk7
CkBAIC0zODgsOCArMzg0LDcgQEAgc3RhdGljIHZvaWQgcmVvcGVuX2JhY2tpbmdfZmlsZShCbG9j
a0RyaXZlclN0YXRlICpicywgYm9vbCB3cml0YWJsZSwKICAgICB9CiAKICAgICBpZiAocmVvcGVu
X3F1ZXVlKSB7Ci0gICAgICAgIGJkcnZfcmVvcGVuX211bHRpcGxlKHJlb3Blbl9xdWV1ZSwgJmxv
Y2FsX2Vycik7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAg
ICAgICBiZHJ2X3Jlb3Blbl9tdWx0aXBsZShyZW9wZW5fcXVldWUsIGVycnApOwogICAgIH0KIAog
ICAgIGJkcnZfc3VidHJlZV9kcmFpbmVkX2VuZChzLT5oaWRkZW5fZGlzay0+YnMpOwpAQCAtNDUw
LDcgKzQ0NSw2IEBAIHN0YXRpYyB2b2lkIHJlcGxpY2F0aW9uX3N0YXJ0KFJlcGxpY2F0aW9uU3Rh
dGUgKnJzLCBSZXBsaWNhdGlvbk1vZGUgbW9kZSwKICAgICBCbG9ja0RyaXZlclN0YXRlICp0b3Bf
YnM7CiAgICAgaW50NjRfdCBhY3RpdmVfbGVuZ3RoLCBoaWRkZW5fbGVuZ3RoLCBkaXNrX2xlbmd0
aDsKICAgICBBaW9Db250ZXh0ICphaW9fY29udGV4dDsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0g
TlVMTDsKIAogICAgIGFpb19jb250ZXh0ID0gYmRydl9nZXRfYWlvX2NvbnRleHQoYnMpOwogICAg
IGFpb19jb250ZXh0X2FjcXVpcmUoYWlvX2NvbnRleHQpOwpAQCAtNTE5LDkgKzUxMyw4IEBAIHN0
YXRpYyB2b2lkIHJlcGxpY2F0aW9uX3N0YXJ0KFJlcGxpY2F0aW9uU3RhdGUgKnJzLCBSZXBsaWNh
dGlvbk1vZGUgbW9kZSwKICAgICAgICAgfQogCiAgICAgICAgIC8qIHJlb3BlbiB0aGUgYmFja2lu
ZyBmaWxlIGluIHIvdyBtb2RlICovCi0gICAgICAgIHJlb3Blbl9iYWNraW5nX2ZpbGUoYnMsIHRy
dWUsICZsb2NhbF9lcnIpOwotICAgICAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgICAgICBl
cnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgcmVvcGVuX2JhY2tpbmdf
ZmlsZShicywgdHJ1ZSwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAg
YWlvX2NvbnRleHRfcmVsZWFzZShhaW9fY29udGV4dCk7CiAgICAgICAgICAgICByZXR1cm47CiAg
ICAgICAgIH0KQEAgLTU0Niw5ICs1MzksOCBAQCBzdGF0aWMgdm9pZCByZXBsaWNhdGlvbl9zdGFy
dChSZXBsaWNhdGlvblN0YXRlICpycywgUmVwbGljYXRpb25Nb2RlIG1vZGUsCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIDAsIE1JUlJPUl9TWU5DX01PREVfTk9ORSwgTlVMTCwgMCwg
ZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJMT0NLREVWX09OX0VSUk9S
X1JFUE9SVCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQkxPQ0tERVZfT05fRVJS
T1JfUkVQT1JULCBKT0JfSU5URVJOQUwsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGJhY2t1cF9qb2JfY29tcGxldGVkLCBicywgTlVMTCwgJmxvY2FsX2Vycik7Ci0gICAgICAgIGlm
IChsb2NhbF9lcnIpIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9l
cnIpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrdXBfam9iX2NvbXBsZXRl
ZCwgYnMsIE5VTEwsIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIGJh
Y2t1cF9qb2JfY2xlYW51cChicyk7CiAgICAgICAgICAgICBhaW9fY29udGV4dF9yZWxlYXNlKGFp
b19jb250ZXh0KTsKICAgICAgICAgICAgIHJldHVybjsKZGlmZiAtLWdpdCBhL2Jsb2NrL3NoZWVw
ZG9nLmMgYi9ibG9jay9zaGVlcGRvZy5jCmluZGV4IDc3M2RmYzZhYjEuLjA4NjE5NGY5NzUgMTAw
NjQ0Ci0tLSBhL2Jsb2NrL3NoZWVwZG9nLmMKKysrIGIvYmxvY2svc2hlZXBkb2cuYwpAQCAtNTMy
LDcgKzUzMiw2IEBAIHN0YXRpYyBTb2NrZXRBZGRyZXNzICpzZF9zZXJ2ZXJfY29uZmlnKFFEaWN0
ICpvcHRpb25zLCBFcnJvciAqKmVycnApCiAgICAgUURpY3QgKnNlcnZlciA9IE5VTEw7CiAgICAg
VmlzaXRvciAqaXYgPSBOVUxMOwogICAgIFNvY2tldEFkZHJlc3MgKnNhZGRyID0gTlVMTDsKLSAg
ICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAogICAgIHFkaWN0X2V4dHJhY3Rfc3VicWRpY3Qo
b3B0aW9ucywgJnNlcnZlciwgInNlcnZlci4iKTsKIApAQCAtNTQxLDkgKzU0MCw4IEBAIHN0YXRp
YyBTb2NrZXRBZGRyZXNzICpzZF9zZXJ2ZXJfY29uZmlnKFFEaWN0ICpvcHRpb25zLCBFcnJvciAq
KmVycnApCiAgICAgICAgIGdvdG8gZG9uZTsKICAgICB9CiAKLSAgICB2aXNpdF90eXBlX1NvY2tl
dEFkZHJlc3MoaXYsIE5VTEwsICZzYWRkciwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2Vy
cikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICB2aXNp
dF90eXBlX1NvY2tldEFkZHJlc3MoaXYsIE5VTEwsICZzYWRkciwgZXJycCk7CisgICAgaWYgKCpl
cnJwKSB7CiAgICAgICAgIGdvdG8gZG9uZTsKICAgICB9CiAKQEAgLTEwMDgsNyArMTAwNiw2IEBA
IHN0YXRpYyB2b2lkIHNkX2NvbmZpZ19kb25lKFNoZWVwZG9nQ29uZmlnICpjZmcpCiBzdGF0aWMg
dm9pZCBzZF9wYXJzZV91cmkoU2hlZXBkb2dDb25maWcgKmNmZywgY29uc3QgY2hhciAqZmlsZW5h
bWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJwKQogewotICAgIEVycm9y
ICplcnIgPSBOVUxMOwogICAgIFF1ZXJ5UGFyYW1zICpxcCA9IE5VTEw7CiAgICAgYm9vbCBpc191
bml4OwogICAgIFVSSSAqdXJpOwpAQCAtMTAxNyw3ICsxMDE0LDcgQEAgc3RhdGljIHZvaWQgc2Rf
cGFyc2VfdXJpKFNoZWVwZG9nQ29uZmlnICpjZmcsIGNvbnN0IGNoYXIgKmZpbGVuYW1lLAogCiAg
ICAgY2ZnLT51cmkgPSB1cmkgPSB1cmlfcGFyc2UoZmlsZW5hbWUpOwogICAgIGlmICghdXJpKSB7
Ci0gICAgICAgIGVycm9yX3NldGcoJmVyciwgImludmFsaWQgVVJJICclcyciLCBmaWxlbmFtZSk7
CisgICAgICAgIGVycm9yX3NldGcoZXJycCwgImludmFsaWQgVVJJICclcyciLCBmaWxlbmFtZSk7
CiAgICAgICAgIGdvdG8gb3V0OwogICAgIH0KIApAQCAtMTAyOSwxOCArMTAyNiwxOCBAQCBzdGF0
aWMgdm9pZCBzZF9wYXJzZV91cmkoU2hlZXBkb2dDb25maWcgKmNmZywgY29uc3QgY2hhciAqZmls
ZW5hbWUsCiAgICAgfSBlbHNlIGlmICghZ19zdHJjbXAwKHVyaS0+c2NoZW1lLCAic2hlZXBkb2cr
dW5peCIpKSB7CiAgICAgICAgIGlzX3VuaXggPSB0cnVlOwogICAgIH0gZWxzZSB7Ci0gICAgICAg
IGVycm9yX3NldGcoJmVyciwgIlVSSSBzY2hlbWUgbXVzdCBiZSAnc2hlZXBkb2cnLCAnc2hlZXBk
b2crdGNwJywiCisgICAgICAgIGVycm9yX3NldGcoZXJycCwgIlVSSSBzY2hlbWUgbXVzdCBiZSAn
c2hlZXBkb2cnLCAnc2hlZXBkb2crdGNwJywiCiAgICAgICAgICAgICAgICAgICAgIiBvciAnc2hl
ZXBkb2crdW5peCciKTsKICAgICAgICAgZ290byBvdXQ7CiAgICAgfQogCiAgICAgaWYgKHVyaS0+
cGF0aCA9PSBOVUxMIHx8ICFzdHJjbXAodXJpLT5wYXRoLCAiLyIpKSB7Ci0gICAgICAgIGVycm9y
X3NldGcoJmVyciwgIm1pc3NpbmcgZmlsZSBwYXRoIGluIFVSSSIpOworICAgICAgICBlcnJvcl9z
ZXRnKGVycnAsICJtaXNzaW5nIGZpbGUgcGF0aCBpbiBVUkkiKTsKICAgICAgICAgZ290byBvdXQ7
CiAgICAgfQogICAgIGlmIChnX3N0cmxjcHkoY2ZnLT52ZGksIHVyaS0+cGF0aCArIDEsIFNEX01B
WF9WRElfTEVOKQogICAgICAgICA+PSBTRF9NQVhfVkRJX0xFTikgewotICAgICAgICBlcnJvcl9z
ZXRnKCZlcnIsICJWREkgbmFtZSBpcyB0b28gbG9uZyIpOworICAgICAgICBlcnJvcl9zZXRnKGVy
cnAsICJWREkgbmFtZSBpcyB0b28gbG9uZyIpOwogICAgICAgICBnb3RvIG91dDsKICAgICB9CiAK
QEAgLTEwNDksMjUgKzEwNDYsMjUgQEAgc3RhdGljIHZvaWQgc2RfcGFyc2VfdXJpKFNoZWVwZG9n
Q29uZmlnICpjZmcsIGNvbnN0IGNoYXIgKmZpbGVuYW1lLAogICAgIGlmIChpc191bml4KSB7CiAg
ICAgICAgIC8qIHNoZWVwZG9nK3VuaXg6Ly8vdmRpbmFtZT9zb2NrZXQ9cGF0aCAqLwogICAgICAg
ICBpZiAodXJpLT5zZXJ2ZXIgfHwgdXJpLT5wb3J0KSB7Ci0gICAgICAgICAgICBlcnJvcl9zZXRn
KCZlcnIsICJVUkkgc2NoZW1lICVzIGRvZXNuJ3QgYWNjZXB0IGEgc2VydmVyIGFkZHJlc3MiLAor
ICAgICAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAiVVJJIHNjaGVtZSAlcyBkb2Vzbid0IGFjY2Vw
dCBhIHNlcnZlciBhZGRyZXNzIiwKICAgICAgICAgICAgICAgICAgICAgICAgdXJpLT5zY2hlbWUp
OwogICAgICAgICAgICAgZ290byBvdXQ7CiAgICAgICAgIH0KICAgICAgICAgaWYgKCFxcC0+bikg
ewotICAgICAgICAgICAgZXJyb3Jfc2V0ZygmZXJyLAorICAgICAgICAgICAgZXJyb3Jfc2V0Zyhl
cnJwLAogICAgICAgICAgICAgICAgICAgICAgICAiVVJJIHNjaGVtZSAlcyByZXF1aXJlcyBxdWVy
eSBwYXJhbWV0ZXIgJ3NvY2tldCciLAogICAgICAgICAgICAgICAgICAgICAgICB1cmktPnNjaGVt
ZSk7CiAgICAgICAgICAgICBnb3RvIG91dDsKICAgICAgICAgfQogICAgICAgICBpZiAocXAtPm4g
IT0gMSB8fCBzdHJjbXAocXAtPnBbMF0ubmFtZSwgInNvY2tldCIpKSB7Ci0gICAgICAgICAgICBl
cnJvcl9zZXRnKCZlcnIsICJ1bmV4cGVjdGVkIHF1ZXJ5IHBhcmFtZXRlcnMiKTsKKyAgICAgICAg
ICAgIGVycm9yX3NldGcoZXJycCwgInVuZXhwZWN0ZWQgcXVlcnkgcGFyYW1ldGVycyIpOwogICAg
ICAgICAgICAgZ290byBvdXQ7CiAgICAgICAgIH0KICAgICAgICAgY2ZnLT5wYXRoID0gcXAtPnBb
MF0udmFsdWU7CiAgICAgfSBlbHNlIHsKICAgICAgICAgLyogc2hlZXBkb2dbK3RjcF06Ly9baG9z
dDpwb3J0XS92ZGluYW1lICovCiAgICAgICAgIGlmIChxcC0+bikgewotICAgICAgICAgICAgZXJy
b3Jfc2V0ZygmZXJyLCAidW5leHBlY3RlZCBxdWVyeSBwYXJhbWV0ZXJzIik7CisgICAgICAgICAg
ICBlcnJvcl9zZXRnKGVycnAsICJ1bmV4cGVjdGVkIHF1ZXJ5IHBhcmFtZXRlcnMiKTsKICAgICAg
ICAgICAgIGdvdG8gb3V0OwogICAgICAgICB9CiAgICAgICAgIGNmZy0+aG9zdCA9IHVyaS0+c2Vy
dmVyOwpAQCAtMTA3OCw3ICsxMDc1LDcgQEAgc3RhdGljIHZvaWQgc2RfcGFyc2VfdXJpKFNoZWVw
ZG9nQ29uZmlnICpjZmcsIGNvbnN0IGNoYXIgKmZpbGVuYW1lLAogICAgIGlmICh1cmktPmZyYWdt
ZW50KSB7CiAgICAgICAgIGlmICghc2RfcGFyc2Vfc25hcGlkX29yX3RhZyh1cmktPmZyYWdtZW50
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJmNmZy0+c25hcF9pZCwgY2Zn
LT50YWcpKSB7Ci0gICAgICAgICAgICBlcnJvcl9zZXRnKCZlcnIsICInJXMnIGlzIG5vdCBhIHZh
bGlkIHNuYXBzaG90IElEIiwKKyAgICAgICAgICAgIGVycm9yX3NldGcoZXJycCwgIiclcycgaXMg
bm90IGEgdmFsaWQgc25hcHNob3QgSUQiLAogICAgICAgICAgICAgICAgICAgICAgICB1cmktPmZy
YWdtZW50KTsKICAgICAgICAgICAgIGdvdG8gb3V0OwogICAgICAgICB9CkBAIC0xMDg3LDggKzEw
ODQsNyBAQCBzdGF0aWMgdm9pZCBzZF9wYXJzZV91cmkoU2hlZXBkb2dDb25maWcgKmNmZywgY29u
c3QgY2hhciAqZmlsZW5hbWUsCiAgICAgfQogCiBvdXQ6Ci0gICAgaWYgKGVycikgewotICAgICAg
ICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAg
c2RfY29uZmlnX2RvbmUoY2ZnKTsKICAgICB9CiB9CkBAIC0xMTEzLDcgKzExMDksNiBAQCBvdXQ6
CiBzdGF0aWMgdm9pZCBwYXJzZV92ZGluYW1lKFNoZWVwZG9nQ29uZmlnICpjZmcsIGNvbnN0IGNo
YXIgKmZpbGVuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICBFcnJvciAqKmVycnApCiB7
Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7CiAgICAgY2hhciAqcCwgKnEsICp1cmk7CiAgICAgY29u
c3QgY2hhciAqaG9zdF9zcGVjLCAqdmRpX3NwZWM7CiAgICAgaW50IG5yX3NlcDsKQEAgLTExNTUs
MTQgKzExNTAsMTQgQEAgc3RhdGljIHZvaWQgcGFyc2VfdmRpbmFtZShTaGVlcGRvZ0NvbmZpZyAq
Y2ZnLCBjb25zdCBjaGFyICpmaWxlbmFtZSwKICAgICAgKiBGSVhNRSBXZSB0byBlc2NhcGUgVVJJ
IG1ldGEtY2hhcmFjdGVycywgZS5nLiAieD95PXoiCiAgICAgICogcHJvZHVjZXMgInNoZWVwZG9n
Oi8veD95PXoiLiAgQmVjYXVzZSBvZiB0aGF0IC4uLgogICAgICAqLwotICAgIHNkX3BhcnNlX3Vy
aShjZmcsIHVyaSwgJmVycik7Ci0gICAgaWYgKGVycikgeworICAgIHNkX3BhcnNlX3VyaShjZmcs
IHVyaSwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIC8qCiAgICAgICAgICAqIC4u
LiB0aGlzIGNhbiBmYWlsLCBidXQgdGhlIGVycm9yIG1lc3NhZ2UgaXMgbWlzbGVhZGluZy4KICAg
ICAgICAgICogUmVwbGFjZSBpdCBieSB0aGUgdHJhZGl0aW9uYWwgdXNlbGVzcyBvbmUgdW50aWwg
dGhlCiAgICAgICAgICAqIGVzY2FwaW5nIGlzIGZpeGVkLgogICAgICAgICAgKi8KLSAgICAgICAg
ZXJyb3JfZnJlZShlcnIpOworICAgICAgICBlcnJvcl9mcmVlX2VycnAoZXJycCk7CiAgICAgICAg
IGVycm9yX3NldGcoZXJycCwgIkNhbid0IHBhcnNlIGZpbGVuYW1lIik7CiAgICAgfQogCkBAIC0x
MTczLDE3ICsxMTY4LDE1IEBAIHN0YXRpYyB2b2lkIHBhcnNlX3ZkaW5hbWUoU2hlZXBkb2dDb25m
aWcgKmNmZywgY29uc3QgY2hhciAqZmlsZW5hbWUsCiBzdGF0aWMgdm9pZCBzZF9wYXJzZV9maWxl
bmFtZShjb25zdCBjaGFyICpmaWxlbmFtZSwgUURpY3QgKm9wdGlvbnMsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7
CiAgICAgU2hlZXBkb2dDb25maWcgY2ZnOwogICAgIGNoYXIgYnVmWzMyXTsKIAogICAgIGlmIChz
dHJzdHIoZmlsZW5hbWUsICI6Ly8iKSkgewotICAgICAgICBzZF9wYXJzZV91cmkoJmNmZywgZmls
ZW5hbWUsICZlcnIpOworICAgICAgICBzZF9wYXJzZV91cmkoJmNmZywgZmlsZW5hbWUsIGVycnAp
OwogICAgIH0gZWxzZSB7Ci0gICAgICAgIHBhcnNlX3ZkaW5hbWUoJmNmZywgZmlsZW5hbWUsICZl
cnIpOworICAgICAgICBwYXJzZV92ZGluYW1lKCZjZmcsIGZpbGVuYW1lLCBlcnJwKTsKICAgICB9
Ci0gICAgaWYgKGVycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAg
ICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApAQCAtMTU1MCwxNSArMTU0
MywxMyBAQCBzdGF0aWMgaW50IHNkX29wZW4oQmxvY2tEcml2ZXJTdGF0ZSAqYnMsIFFEaWN0ICpv
cHRpb25zLCBpbnQgZmxhZ3MsCiAgICAgdWludDY0X3Qgc25hcF9pZDsKICAgICBjaGFyICpidWYg
PSBOVUxMOwogICAgIFFlbXVPcHRzICpvcHRzOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxM
OwogCiAgICAgcy0+YnMgPSBiczsKICAgICBzLT5haW9fY29udGV4dCA9IGJkcnZfZ2V0X2Fpb19j
b250ZXh0KGJzKTsKIAogICAgIG9wdHMgPSBxZW11X29wdHNfY3JlYXRlKCZydW50aW1lX29wdHMs
IE5VTEwsIDAsICZlcnJvcl9hYm9ydCk7Ci0gICAgcWVtdV9vcHRzX2Fic29yYl9xZGljdChvcHRz
LCBvcHRpb25zLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVy
cm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHFlbXVfb3B0c19hYnNvcmJfcWRp
Y3Qob3B0cywgb3B0aW9ucywgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldCA9
IC1FSU5WQUw7CiAgICAgICAgIGdvdG8gZXJyX25vX2ZkOwogICAgIH0KQEAgLTE4NTQsMTUgKzE4
NDUsMTMgQEAgc3RhdGljIGludCBzZF9jcmVhdGVfcHJlYWxsb2MoQmxvY2tkZXZPcHRpb25zU2hl
ZXBkb2cgKmxvY2F0aW9uLCBpbnQ2NF90IHNpemUsCiAgICAgVmlzaXRvciAqdjsKICAgICBRT2Jq
ZWN0ICpvYmogPSBOVUxMOwogICAgIFFEaWN0ICpxZGljdDsKLSAgICBFcnJvciAqbG9jYWxfZXJy
ID0gTlVMTDsKICAgICBpbnQgcmV0OwogCiAgICAgdiA9IHFvYmplY3Rfb3V0cHV0X3Zpc2l0b3Jf
bmV3KCZvYmopOwotICAgIHZpc2l0X3R5cGVfQmxvY2tkZXZPcHRpb25zU2hlZXBkb2codiwgTlVM
TCwgJmxvY2F0aW9uLCAmbG9jYWxfZXJyKTsKKyAgICB2aXNpdF90eXBlX0Jsb2NrZGV2T3B0aW9u
c1NoZWVwZG9nKHYsIE5VTEwsICZsb2NhdGlvbiwgZXJycCk7CiAgICAgdmlzaXRfZnJlZSh2KTsK
IAotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxv
Y2FsX2Vycik7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHFvYmplY3RfdW5yZWYob2JqKTsK
ICAgICAgICAgcmV0dXJuIC1FSU5WQUw7CiAgICAgfQpAQCAtMjE2NCw3ICsyMTUzLDYgQEAgc3Rh
dGljIGludCBjb3JvdXRpbmVfZm4gc2RfY29fY3JlYXRlX29wdHMoY29uc3QgY2hhciAqZmlsZW5h
bWUsIFFlbXVPcHRzICpvcHRzLAogICAgIFFEaWN0ICpxZGljdCwgKmxvY2F0aW9uX3FkaWN0Owog
ICAgIFZpc2l0b3IgKnY7CiAgICAgY2hhciAqcmVkdW5kYW5jeTsKLSAgICBFcnJvciAqbG9jYWxf
ZXJyID0gTlVMTDsKICAgICBpbnQgcmV0OwogCiAgICAgcmVkdW5kYW5jeSA9IHFlbXVfb3B0X2dl
dF9kZWwob3B0cywgQkxPQ0tfT1BUX1JFRFVOREFOQ1kpOwpAQCAtMjE3NSw5ICsyMTYzLDggQEAg
c3RhdGljIGludCBjb3JvdXRpbmVfZm4gc2RfY29fY3JlYXRlX29wdHMoY29uc3QgY2hhciAqZmls
ZW5hbWUsIFFlbXVPcHRzICpvcHRzLAogICAgIGxvY2F0aW9uX3FkaWN0ID0gcWRpY3RfbmV3KCk7
CiAgICAgcWRpY3RfcHV0KHFkaWN0LCAibG9jYXRpb24iLCBsb2NhdGlvbl9xZGljdCk7CiAKLSAg
ICBzZF9wYXJzZV9maWxlbmFtZShmaWxlbmFtZSwgbG9jYXRpb25fcWRpY3QsICZsb2NhbF9lcnIp
OwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxv
Y2FsX2Vycik7CisgICAgc2RfcGFyc2VfZmlsZW5hbWUoZmlsZW5hbWUsIGxvY2F0aW9uX3FkaWN0
LCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0ID0gLUVJTlZBTDsKICAgICAg
ICAgZ290byBmYWlsOwogICAgIH0KQEAgLTIyMDMsMTEgKzIxOTAsMTAgQEAgc3RhdGljIGludCBj
b3JvdXRpbmVfZm4gc2RfY29fY3JlYXRlX29wdHMoY29uc3QgY2hhciAqZmlsZW5hbWUsIFFlbXVP
cHRzICpvcHRzLAogICAgICAgICBnb3RvIGZhaWw7CiAgICAgfQogCi0gICAgdmlzaXRfdHlwZV9C
bG9ja2RldkNyZWF0ZU9wdGlvbnModiwgTlVMTCwgJmNyZWF0ZV9vcHRpb25zLCAmbG9jYWxfZXJy
KTsKKyAgICB2aXNpdF90eXBlX0Jsb2NrZGV2Q3JlYXRlT3B0aW9ucyh2LCBOVUxMLCAmY3JlYXRl
X29wdGlvbnMsIGVycnApOwogICAgIHZpc2l0X2ZyZWUodik7CiAKLSAgICBpZiAobG9jYWxfZXJy
KSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIGlmICgq
ZXJycCkgewogICAgICAgICByZXQgPSAtRUlOVkFMOwogICAgICAgICBnb3RvIGZhaWw7CiAgICAg
fQpkaWZmIC0tZ2l0IGEvYmxvY2svc25hcHNob3QuYyBiL2Jsb2NrL3NuYXBzaG90LmMKaW5kZXgg
ZjJmNDhmOTI2YS4uY2ExYzc5ZjgwZiAxMDA2NDQKLS0tIGEvYmxvY2svc25hcHNob3QuYworKysg
Yi9ibG9jay9zbmFwc2hvdC5jCkBAIC0yMDgsNyArMjA4LDYgQEAgaW50IGJkcnZfc25hcHNob3Rf
Z290byhCbG9ja0RyaXZlclN0YXRlICpicywKICAgICAgICAgQmxvY2tEcml2ZXJTdGF0ZSAqZmls
ZTsKICAgICAgICAgUURpY3QgKm9wdGlvbnMgPSBxZGljdF9jbG9uZV9zaGFsbG93KGJzLT5vcHRp
b25zKTsKICAgICAgICAgUURpY3QgKmZpbGVfb3B0aW9uczsKLSAgICAgICAgRXJyb3IgKmxvY2Fs
X2VyciA9IE5VTEw7CiAKICAgICAgICAgZmlsZSA9IGJzLT5maWxlLT5iczsKICAgICAgICAgLyog
UHJldmVudCBpdCBmcm9tIGdldHRpbmcgZGVsZXRlZCB3aGVuIGRldGFjaGVkIGZyb20gYnMgKi8K
QEAgLTIyNSwxMyArMjI0LDEyIEBAIGludCBiZHJ2X3NuYXBzaG90X2dvdG8oQmxvY2tEcml2ZXJT
dGF0ZSAqYnMsCiAgICAgICAgIGJzLT5maWxlID0gTlVMTDsKIAogICAgICAgICByZXQgPSBiZHJ2
X3NuYXBzaG90X2dvdG8oZmlsZSwgc25hcHNob3RfaWQsIGVycnApOwotICAgICAgICBvcGVuX3Jl
dCA9IGRydi0+YmRydl9vcGVuKGJzLCBvcHRpb25zLCBicy0+b3Blbl9mbGFncywgJmxvY2FsX2Vy
cik7CisgICAgICAgIG9wZW5fcmV0ID0gZHJ2LT5iZHJ2X29wZW4oYnMsIG9wdGlvbnMsIGJzLT5v
cGVuX2ZsYWdzLCBlcnJwKTsKICAgICAgICAgcW9iamVjdF91bnJlZihvcHRpb25zKTsKICAgICAg
ICAgaWYgKG9wZW5fcmV0IDwgMCkgewogICAgICAgICAgICAgYmRydl91bnJlZihmaWxlKTsKICAg
ICAgICAgICAgIGJzLT5kcnYgPSBOVUxMOwogICAgICAgICAgICAgLyogQSBiZHJ2X3NuYXBzaG90
X2dvdG8oKSBlcnJvciB0YWtlcyBwcmVjZWRlbmNlICovCi0gICAgICAgICAgICBlcnJvcl9wcm9w
YWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKICAgICAgICAgICAgIHJldHVybiByZXQgPCAwID8gcmV0
IDogb3Blbl9yZXQ7CiAgICAgICAgIH0KIApAQCAtMzcwLDE3ICszNjgsMTMgQEAgaW50IGJkcnZf
c25hcHNob3RfbG9hZF90bXBfYnlfaWRfb3JfbmFtZShCbG9ja0RyaXZlclN0YXRlICpicywKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJwKQogewog
ICAgIGludCByZXQ7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKLSAgICByZXQgPSBi
ZHJ2X3NuYXBzaG90X2xvYWRfdG1wKGJzLCBpZF9vcl9uYW1lLCBOVUxMLCAmbG9jYWxfZXJyKTsK
KyAgICByZXQgPSBiZHJ2X3NuYXBzaG90X2xvYWRfdG1wKGJzLCBpZF9vcl9uYW1lLCBOVUxMLCBl
cnJwKTsKICAgICBpZiAocmV0ID09IC1FTk9FTlQgfHwgcmV0ID09IC1FSU5WQUwpIHsKLSAgICAg
ICAgZXJyb3JfZnJlZShsb2NhbF9lcnIpOwotICAgICAgICBsb2NhbF9lcnIgPSBOVUxMOwotICAg
ICAgICByZXQgPSBiZHJ2X3NuYXBzaG90X2xvYWRfdG1wKGJzLCBOVUxMLCBpZF9vcl9uYW1lLCAm
bG9jYWxfZXJyKTsKKyAgICAgICAgZXJyb3JfZnJlZV9lcnJwKGVycnApOworICAgICAgICByZXQg
PSBiZHJ2X3NuYXBzaG90X2xvYWRfdG1wKGJzLCBOVUxMLCBpZF9vcl9uYW1lLCBlcnJwKTsKICAg
ICB9CiAKLSAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKLQogICAgIHJldHVy
biByZXQ7CiB9CiAKZGlmZiAtLWdpdCBhL2Jsb2NrL3NzaC5jIGIvYmxvY2svc3NoLmMKaW5kZXgg
ODRkMDFlODkyYi4uN2M0MWIyYTQxNiAxMDA2NDQKLS0tIGEvYmxvY2svc3NoLmMKKysrIGIvYmxv
Y2svc3NoLmMKQEAgLTYxNiwxNSArNjE2LDEzIEBAIHN0YXRpYyBCbG9ja2Rldk9wdGlvbnNTc2gg
KnNzaF9wYXJzZV9vcHRpb25zKFFEaWN0ICpvcHRpb25zLCBFcnJvciAqKmVycnApCiB7CiAgICAg
QmxvY2tkZXZPcHRpb25zU3NoICpyZXN1bHQgPSBOVUxMOwogICAgIFFlbXVPcHRzICpvcHRzID0g
TlVMTDsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBjb25zdCBRRGljdEVudHJ5
ICplOwogICAgIFZpc2l0b3IgKnY7CiAKICAgICAvKiBUcmFuc2xhdGUgbGVnYWN5IG9wdGlvbnMg
Ki8KICAgICBvcHRzID0gcWVtdV9vcHRzX2NyZWF0ZSgmc3NoX3J1bnRpbWVfb3B0cywgTlVMTCwg
MCwgJmVycm9yX2Fib3J0KTsKLSAgICBxZW11X29wdHNfYWJzb3JiX3FkaWN0KG9wdHMsIG9wdGlv
bnMsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJv
cGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgcWVtdV9vcHRzX2Fic29yYl9xZGljdChvcHRz
LCBvcHRpb25zLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ290byBmYWlsOwog
ICAgIH0KIApAQCAtNjM4LDExICs2MzYsMTAgQEAgc3RhdGljIEJsb2NrZGV2T3B0aW9uc1NzaCAq
c3NoX3BhcnNlX29wdGlvbnMoUURpY3QgKm9wdGlvbnMsIEVycm9yICoqZXJycCkKICAgICAgICAg
Z290byBmYWlsOwogICAgIH0KIAotICAgIHZpc2l0X3R5cGVfQmxvY2tkZXZPcHRpb25zU3NoKHYs
IE5VTEwsICZyZXN1bHQsICZsb2NhbF9lcnIpOworICAgIHZpc2l0X3R5cGVfQmxvY2tkZXZPcHRp
b25zU3NoKHYsIE5VTEwsICZyZXN1bHQsIGVycnApOwogICAgIHZpc2l0X2ZyZWUodik7CiAKLSAg
ICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9l
cnIpOworICAgIGlmICgqZXJycCkgewogICAgICAgICBnb3RvIGZhaWw7CiAgICAgfQogCmRpZmYg
LS1naXQgYS9ibG9jay90aHJvdHRsZS1ncm91cHMuYyBiL2Jsb2NrL3Rocm90dGxlLWdyb3Vwcy5j
CmluZGV4IDc3MDE0Yzc0MWIuLjkwODM0ZTMxZWUgMTAwNjQ0Ci0tLSBhL2Jsb2NrL3Rocm90dGxl
LWdyb3Vwcy5jCisrKyBiL2Jsb2NrL3Rocm90dGxlLWdyb3Vwcy5jCkBAIC04MTEsNyArODExLDYg
QEAgc3RhdGljIHZvaWQgdGhyb3R0bGVfZ3JvdXBfc2V0KE9iamVjdCAqb2JqLCBWaXNpdG9yICp2
LCBjb25zdCBjaGFyICogbmFtZSwKICAgICBUaHJvdHRsZUdyb3VwICp0ZyA9IFRIUk9UVExFX0dS
T1VQKG9iaik7CiAgICAgVGhyb3R0bGVDb25maWcgKmNmZzsKICAgICBUaHJvdHRsZVBhcmFtSW5m
byAqaW5mbyA9IG9wYXF1ZTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBpbnQ2
NF90IHZhbHVlOwogCiAgICAgLyogSWYgd2UgaGF2ZSBmaW5pc2hlZCBpbml0aWFsaXphdGlvbiwg
ZG9uJ3QgYWNjZXB0IGluZGl2aWR1YWwgcHJvcGVydHkKQEAgLTgxOSwxNiArODE4LDE2IEBAIHN0
YXRpYyB2b2lkIHRocm90dGxlX2dyb3VwX3NldChPYmplY3QgKm9iaiwgVmlzaXRvciAqdiwgY29u
c3QgY2hhciAqIG5hbWUsCiAgICAgICogdHJhbnNhY3Rpb24sIGFzIGNlcnRhaW4gY29tYmluYXRp
b25zIGFyZSBpbnZhbGlkLgogICAgICAqLwogICAgIGlmICh0Zy0+aXNfaW5pdGlhbGl6ZWQpIHsK
LSAgICAgICAgZXJyb3Jfc2V0ZygmbG9jYWxfZXJyLCAiUHJvcGVydHkgY2Fubm90IGJlIHNldCBh
ZnRlciBpbml0aWFsaXphdGlvbiIpOworICAgICAgICBlcnJvcl9zZXRnKGVycnAsICJQcm9wZXJ0
eSBjYW5ub3QgYmUgc2V0IGFmdGVyIGluaXRpYWxpemF0aW9uIik7CiAgICAgICAgIGdvdG8gcmV0
OwogICAgIH0KIAotICAgIHZpc2l0X3R5cGVfaW50NjQodiwgbmFtZSwgJnZhbHVlLCAmbG9jYWxf
ZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7CisgICAgdmlzaXRfdHlwZV9pbnQ2NCh2LCBuYW1l
LCAmdmFsdWUsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICBnb3RvIHJldDsKICAg
ICB9CiAgICAgaWYgKHZhbHVlIDwgMCkgewotICAgICAgICBlcnJvcl9zZXRnKCZsb2NhbF9lcnIs
ICJQcm9wZXJ0eSB2YWx1ZXMgY2Fubm90IGJlIG5lZ2F0aXZlIik7CisgICAgICAgIGVycm9yX3Nl
dGcoZXJycCwgIlByb3BlcnR5IHZhbHVlcyBjYW5ub3QgYmUgbmVnYXRpdmUiKTsKICAgICAgICAg
Z290byByZXQ7CiAgICAgfQogCkBAIC04NDIsNyArODQxLDcgQEAgc3RhdGljIHZvaWQgdGhyb3R0
bGVfZ3JvdXBfc2V0KE9iamVjdCAqb2JqLCBWaXNpdG9yICp2LCBjb25zdCBjaGFyICogbmFtZSwK
ICAgICAgICAgYnJlYWs7CiAgICAgY2FzZSBCVVJTVF9MRU5HVEg6CiAgICAgICAgIGlmICh2YWx1
ZSA+IFVJTlRfTUFYKSB7Ci0gICAgICAgICAgICBlcnJvcl9zZXRnKCZsb2NhbF9lcnIsICIlcyB2
YWx1ZSBtdXN0IGJlIGluIHRoZSIKKyAgICAgICAgICAgIGVycm9yX3NldGcoZXJycCwgIiVzIHZh
bHVlIG11c3QgYmUgaW4gdGhlIgogICAgICAgICAgICAgICAgICAgICAgICAicmFuZ2UgWzAsICV1
XSIsIGluZm8tPm5hbWUsIFVJTlRfTUFYKTsKICAgICAgICAgICAgIGdvdG8gcmV0OwogICAgICAg
ICB9CkBAIC04NTQsNyArODUzLDYgQEAgc3RhdGljIHZvaWQgdGhyb3R0bGVfZ3JvdXBfc2V0KE9i
amVjdCAqb2JqLCBWaXNpdG9yICp2LCBjb25zdCBjaGFyICogbmFtZSwKICAgICB9CiAKIHJldDoK
LSAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKICAgICByZXR1cm47CiAKIH0K
QEAgLTg5NSwxNiArODkzLDE1IEBAIHN0YXRpYyB2b2lkIHRocm90dGxlX2dyb3VwX3NldF9saW1p
dHMoT2JqZWN0ICpvYmosIFZpc2l0b3IgKnYsCiAgICAgVGhyb3R0bGVDb25maWcgY2ZnOwogICAg
IFRocm90dGxlTGltaXRzIGFyZyA9IHsgMCB9OwogICAgIFRocm90dGxlTGltaXRzICphcmdwID0g
JmFyZzsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAotICAgIHZpc2l0X3R5cGVfVGhy
b3R0bGVMaW1pdHModiwgbmFtZSwgJmFyZ3AsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9l
cnIpIHsKKyAgICB2aXNpdF90eXBlX1Rocm90dGxlTGltaXRzKHYsIG5hbWUsICZhcmdwLCBlcnJw
KTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ290byByZXQ7CiAgICAgfQogICAgIHFlbXVf
bXV0ZXhfbG9jaygmdGctPmxvY2spOwogICAgIHRocm90dGxlX2dldF9jb25maWcoJnRnLT50cywg
JmNmZyk7Ci0gICAgdGhyb3R0bGVfbGltaXRzX3RvX2NvbmZpZyhhcmdwLCAmY2ZnLCAmbG9jYWxf
ZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7CisgICAgdGhyb3R0bGVfbGltaXRzX3RvX2NvbmZp
ZyhhcmdwLCAmY2ZnLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ290byB1bmxv
Y2s7CiAgICAgfQogICAgIHRocm90dGxlX2NvbmZpZygmdGctPnRzLCB0Zy0+Y2xvY2tfdHlwZSwg
JmNmZyk7CkBAIC05MTIsNyArOTA5LDYgQEAgc3RhdGljIHZvaWQgdGhyb3R0bGVfZ3JvdXBfc2V0
X2xpbWl0cyhPYmplY3QgKm9iaiwgVmlzaXRvciAqdiwKIHVubG9jazoKICAgICBxZW11X211dGV4
X3VubG9jaygmdGctPmxvY2spOwogcmV0OgotICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2Nh
bF9lcnIpOwogICAgIHJldHVybjsKIH0KIApkaWZmIC0tZ2l0IGEvYmxvY2svdGhyb3R0bGUuYyBi
L2Jsb2NrL3Rocm90dGxlLmMKaW5kZXggMDM0OWY0MjI1Ny4uYjNhOWNlZWM1NSAxMDA2NDQKLS0t
IGEvYmxvY2svdGhyb3R0bGUuYworKysgYi9ibG9jay90aHJvdHRsZS5jCkBAIC00NiwxMiArNDYs
MTAgQEAgc3RhdGljIGludCB0aHJvdHRsZV9wYXJzZV9vcHRpb25zKFFEaWN0ICpvcHRpb25zLCBj
aGFyICoqZ3JvdXAsIEVycm9yICoqZXJycCkKIHsKICAgICBpbnQgcmV0OwogICAgIGNvbnN0IGNo
YXIgKmdyb3VwX25hbWU7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgUWVtdU9w
dHMgKm9wdHMgPSBxZW11X29wdHNfY3JlYXRlKCZ0aHJvdHRsZV9vcHRzLCBOVUxMLCAwLCAmZXJy
b3JfYWJvcnQpOwogCi0gICAgcWVtdV9vcHRzX2Fic29yYl9xZGljdChvcHRzLCBvcHRpb25zLCAm
bG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0
ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHFlbXVfb3B0c19hYnNvcmJfcWRpY3Qob3B0cywgb3B0
aW9ucywgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldCA9IC1FSU5WQUw7CiAg
ICAgICAgIGdvdG8gZmluOwogICAgIH0KZGlmZiAtLWdpdCBhL2Jsb2NrL3ZkaS5jIGIvYmxvY2sv
dmRpLmMKaW5kZXggODA2YmE3ZjUzYy4uMmQ0MDVkNmNmOSAxMDA2NDQKLS0tIGEvYmxvY2svdmRp
LmMKKysrIGIvYmxvY2svdmRpLmMKQEAgLTM3NSw3ICszNzUsNiBAQCBzdGF0aWMgaW50IHZkaV9v
cGVuKEJsb2NrRHJpdmVyU3RhdGUgKmJzLCBRRGljdCAqb3B0aW9ucywgaW50IGZsYWdzLAogICAg
IFZkaUhlYWRlciBoZWFkZXI7CiAgICAgc2l6ZV90IGJtYXBfc2l6ZTsKICAgICBpbnQgcmV0Owot
ICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIFFlbXVVVUlEIHV1aWRfbGluaywgdXVp
ZF9wYXJlbnQ7CiAKICAgICBicy0+ZmlsZSA9IGJkcnZfb3Blbl9jaGlsZChOVUxMLCBvcHRpb25z
LCAiZmlsZSIsIGJzLCAmY2hpbGRfZmlsZSwKQEAgLTQ5Niw5ICs0OTUsOCBAQCBzdGF0aWMgaW50
IHZkaV9vcGVuKEJsb2NrRHJpdmVyU3RhdGUgKmJzLCBRRGljdCAqb3B0aW9ucywgaW50IGZsYWdz
LAogICAgIGVycm9yX3NldGcoJnMtPm1pZ3JhdGlvbl9ibG9ja2VyLCAiVGhlIHZkaSBmb3JtYXQg
dXNlZCBieSBub2RlICclcycgIgogICAgICAgICAgICAgICAgImRvZXMgbm90IHN1cHBvcnQgbGl2
ZSBtaWdyYXRpb24iLAogICAgICAgICAgICAgICAgYmRydl9nZXRfZGV2aWNlX29yX25vZGVfbmFt
ZShicykpOwotICAgIHJldCA9IG1pZ3JhdGVfYWRkX2Jsb2NrZXIocy0+bWlncmF0aW9uX2Jsb2Nr
ZXIsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJv
cGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgcmV0ID0gbWlncmF0ZV9hZGRfYmxvY2tlcihz
LT5taWdyYXRpb25fYmxvY2tlciwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGVy
cm9yX2ZyZWUocy0+bWlncmF0aW9uX2Jsb2NrZXIpOwogICAgICAgICBnb3RvIGZhaWxfZnJlZV9i
bWFwOwogICAgIH0KQEAgLTkwNSw3ICs5MDMsNiBAQCBzdGF0aWMgaW50IGNvcm91dGluZV9mbiB2
ZGlfY29fY3JlYXRlX29wdHMoY29uc3QgY2hhciAqZmlsZW5hbWUsIFFlbXVPcHRzICpvcHRzLAog
ICAgIHVpbnQ2NF90IGJsb2NrX3NpemUgPSBERUZBVUxUX0NMVVNURVJfU0laRTsKICAgICBib29s
IGlzX3N0YXRpYyA9IGZhbHNlOwogICAgIFZpc2l0b3IgKnY7Ci0gICAgRXJyb3IgKmxvY2FsX2Vy
ciA9IE5VTEw7CiAgICAgaW50IHJldDsKIAogICAgIC8qIFBhcnNlIG9wdGlvbnMgYW5kIGNvbnZl
cnQgbGVnYWN5IHN5bnRheC4KQEAgLTk1NiwxMSArOTUzLDEwIEBAIHN0YXRpYyBpbnQgY29yb3V0
aW5lX2ZuIHZkaV9jb19jcmVhdGVfb3B0cyhjb25zdCBjaGFyICpmaWxlbmFtZSwgUWVtdU9wdHMg
Km9wdHMsCiAgICAgICAgIHJldCA9IC1FSU5WQUw7CiAgICAgICAgIGdvdG8gZG9uZTsKICAgICB9
Ci0gICAgdmlzaXRfdHlwZV9CbG9ja2RldkNyZWF0ZU9wdGlvbnModiwgTlVMTCwgJmNyZWF0ZV9v
cHRpb25zLCAmbG9jYWxfZXJyKTsKKyAgICB2aXNpdF90eXBlX0Jsb2NrZGV2Q3JlYXRlT3B0aW9u
cyh2LCBOVUxMLCAmY3JlYXRlX29wdGlvbnMsIGVycnApOwogICAgIHZpc2l0X2ZyZWUodik7CiAK
LSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2Nh
bF9lcnIpOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXQgPSAtRUlOVkFMOwogICAgICAg
ICBnb3RvIGRvbmU7CiAgICAgfQpkaWZmIC0tZ2l0IGEvYmxvY2svdmhkeC5jIGIvYmxvY2svdmhk
eC5jCmluZGV4IDZhMDlkMGE1NWMuLjFkZmY0MDkzMmUgMTAwNjQ0Ci0tLSBhL2Jsb2NrL3ZoZHgu
YworKysgYi9ibG9jay92aGR4LmMKQEAgLTkwMiw3ICs5MDIsNiBAQCBzdGF0aWMgaW50IHZoZHhf
b3BlbihCbG9ja0RyaXZlclN0YXRlICpicywgUURpY3QgKm9wdGlvbnMsIGludCBmbGFncywKICAg
ICBpbnQgcmV0ID0gMDsKICAgICB1aW50MzJfdCBpOwogICAgIHVpbnQ2NF90IHNpZ25hdHVyZTsK
LSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAogICAgIGJzLT5maWxlID0gYmRydl9vcGVu
X2NoaWxkKE5VTEwsIG9wdGlvbnMsICJmaWxlIiwgYnMsICZjaGlsZF9maWxlLAogICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGZhbHNlLCBlcnJwKTsKQEAgLTkzMSw5ICs5MzAsOCBAQCBz
dGF0aWMgaW50IHZoZHhfb3BlbihCbG9ja0RyaXZlclN0YXRlICpicywgUURpY3QgKm9wdGlvbnMs
IGludCBmbGFncywKICAgICAgKiBoZWFkZXIgdXBkYXRlICovCiAgICAgdmhkeF9ndWlkX2dlbmVy
YXRlKCZzLT5zZXNzaW9uX2d1aWQpOwogCi0gICAgdmhkeF9wYXJzZV9oZWFkZXIoYnMsIHMsICZs
b2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIgIT0gTlVMTCkgewotICAgICAgICBlcnJvcl9w
cm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICB2aGR4X3BhcnNlX2hlYWRlcihicywgcywg
ZXJycCk7CisgICAgaWYgKCplcnJwICE9IE5VTEwpIHsKICAgICAgICAgcmV0ID0gLUVJTlZBTDsK
ICAgICAgICAgZ290byBmYWlsOwogICAgIH0KQEAgLTEwMDcsOSArMTAwNSw4IEBAIHN0YXRpYyBp
bnQgdmhkeF9vcGVuKEJsb2NrRHJpdmVyU3RhdGUgKmJzLCBRRGljdCAqb3B0aW9ucywgaW50IGZs
YWdzLAogICAgIGVycm9yX3NldGcoJnMtPm1pZ3JhdGlvbl9ibG9ja2VyLCAiVGhlIHZoZHggZm9y
bWF0IHVzZWQgYnkgbm9kZSAnJXMnICIKICAgICAgICAgICAgICAgICJkb2VzIG5vdCBzdXBwb3J0
IGxpdmUgbWlncmF0aW9uIiwKICAgICAgICAgICAgICAgIGJkcnZfZ2V0X2RldmljZV9vcl9ub2Rl
X25hbWUoYnMpKTsKLSAgICByZXQgPSBtaWdyYXRlX2FkZF9ibG9ja2VyKHMtPm1pZ3JhdGlvbl9i
bG9ja2VyLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHJldCA9IG1pZ3JhdGVfYWRkX2Jsb2Nr
ZXIocy0+bWlncmF0aW9uX2Jsb2NrZXIsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAg
ICBlcnJvcl9mcmVlKHMtPm1pZ3JhdGlvbl9ibG9ja2VyKTsKICAgICAgICAgZ290byBmYWlsOwog
ICAgIH0KQEAgLTE5NzAsNyArMTk2Nyw2IEBAIHN0YXRpYyBpbnQgY29yb3V0aW5lX2ZuIHZoZHhf
Y29fY3JlYXRlX29wdHMoY29uc3QgY2hhciAqZmlsZW5hbWUsCiAgICAgUURpY3QgKnFkaWN0Owog
ICAgIFZpc2l0b3IgKnY7CiAgICAgQmxvY2tEcml2ZXJTdGF0ZSAqYnMgPSBOVUxMOwotICAgIEVy
cm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIGludCByZXQ7CiAKICAgICBzdGF0aWMgY29uc3Qg
UURpY3RSZW5hbWVzIG9wdF9yZW5hbWVzW10gPSB7CkBAIC0xOTg5LDkgKzE5ODUsOCBAQCBzdGF0
aWMgaW50IGNvcm91dGluZV9mbiB2aGR4X2NvX2NyZWF0ZV9vcHRzKGNvbnN0IGNoYXIgKmZpbGVu
YW1lLAogICAgIH0KIAogICAgIC8qIENyZWF0ZSBhbmQgb3BlbiB0aGUgZmlsZSAocHJvdG9jb2wg
bGF5ZXIpICovCi0gICAgcmV0ID0gYmRydl9jcmVhdGVfZmlsZShmaWxlbmFtZSwgb3B0cywgJmxv
Y2FsX2Vycik7CisgICAgcmV0ID0gYmRydl9jcmVhdGVfZmlsZShmaWxlbmFtZSwgb3B0cywgZXJy
cCk7CiAgICAgaWYgKHJldCA8IDApIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxv
Y2FsX2Vycik7CiAgICAgICAgIGdvdG8gZmFpbDsKICAgICB9CiAKQEAgLTIwMTIsMTEgKzIwMDcs
MTAgQEAgc3RhdGljIGludCBjb3JvdXRpbmVfZm4gdmhkeF9jb19jcmVhdGVfb3B0cyhjb25zdCBj
aGFyICpmaWxlbmFtZSwKICAgICAgICAgZ290byBmYWlsOwogICAgIH0KIAotICAgIHZpc2l0X3R5
cGVfQmxvY2tkZXZDcmVhdGVPcHRpb25zKHYsIE5VTEwsICZjcmVhdGVfb3B0aW9ucywgJmxvY2Fs
X2Vycik7CisgICAgdmlzaXRfdHlwZV9CbG9ja2RldkNyZWF0ZU9wdGlvbnModiwgTlVMTCwgJmNy
ZWF0ZV9vcHRpb25zLCBlcnJwKTsKICAgICB2aXNpdF9mcmVlKHYpOwogCi0gICAgaWYgKGxvY2Fs
X2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBp
ZiAoKmVycnApIHsKICAgICAgICAgcmV0ID0gLUVJTlZBTDsKICAgICAgICAgZ290byBmYWlsOwog
ICAgIH0KZGlmZiAtLWdpdCBhL2Jsb2NrL3ZtZGsuYyBiL2Jsb2NrL3ZtZGsuYwppbmRleCBmZWQz
YjUwYzhhLi4zYTAxNzAzMTJjIDEwMDY0NAotLS0gYS9ibG9jay92bWRrLmMKKysrIGIvYmxvY2sv
dm1kay5jCkBAIC0xMDkyLDcgKzEwOTIsNiBAQCBzdGF0aWMgaW50IHZtZGtfcGFyc2VfZXh0ZW50
cyhjb25zdCBjaGFyICpkZXNjLCBCbG9ja0RyaXZlclN0YXRlICpicywKICAgICBCRFJWVm1ka1N0
YXRlICpzID0gYnMtPm9wYXF1ZTsKICAgICBWbWRrRXh0ZW50ICpleHRlbnQ7CiAgICAgY2hhciBl
eHRlbnRfb3B0X3ByZWZpeFszMl07Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAg
ICBmb3IgKHAgPSBkZXNjOyAqcDsgcCA9IG5leHRfbGluZShwKSkgewogICAgICAgICAvKiBwYXJz
ZSBleHRlbnQgbGluZSBpbiBvbmUgb2YgYmVsb3cgZm9ybWF0czoKQEAgLTExNTIsMTAgKzExNTEs
OSBAQCBzdGF0aWMgaW50IHZtZGtfcGFyc2VfZXh0ZW50cyhjb25zdCBjaGFyICpkZXNjLCBCbG9j
a0RyaXZlclN0YXRlICpicywKICAgICAgICAgYXNzZXJ0KHJldCA8IDMyKTsKIAogICAgICAgICBl
eHRlbnRfZmlsZSA9IGJkcnZfb3Blbl9jaGlsZChleHRlbnRfcGF0aCwgb3B0aW9ucywgZXh0ZW50
X29wdF9wcmVmaXgsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJzLCAm
Y2hpbGRfZmlsZSwgZmFsc2UsICZsb2NhbF9lcnIpOworICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBicywgJmNoaWxkX2ZpbGUsIGZhbHNlLCBlcnJwKTsKICAgICAgICAgZ19m
cmVlKGV4dGVudF9wYXRoKTsKLSAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICAgICAg
ZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgIGlmICgqZXJycCkgewog
ICAgICAgICAgICAgcmV0ID0gLUVJTlZBTDsKICAgICAgICAgICAgIGdvdG8gb3V0OwogICAgICAg
ICB9CkBAIC0xMjU1LDcgKzEyNTMsNiBAQCBzdGF0aWMgaW50IHZtZGtfb3BlbihCbG9ja0RyaXZl
clN0YXRlICpicywgUURpY3QgKm9wdGlvbnMsIGludCBmbGFncywKICAgICBpbnQgcmV0OwogICAg
IEJEUlZWbWRrU3RhdGUgKnMgPSBicy0+b3BhcXVlOwogICAgIHVpbnQzMl90IG1hZ2ljOwotICAg
IEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgYnMtPmZpbGUgPSBiZHJ2X29wZW5fY2hp
bGQoTlVMTCwgb3B0aW9ucywgImZpbGUiLCBicywgJmNoaWxkX2ZpbGUsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgZmFsc2UsIGVycnApOwpAQCAtMTMwMyw5ICsxMzAwLDggQEAgc3Rh
dGljIGludCB2bWRrX29wZW4oQmxvY2tEcml2ZXJTdGF0ZSAqYnMsIFFEaWN0ICpvcHRpb25zLCBp
bnQgZmxhZ3MsCiAgICAgZXJyb3Jfc2V0Zygmcy0+bWlncmF0aW9uX2Jsb2NrZXIsICJUaGUgdm1k
ayBmb3JtYXQgdXNlZCBieSBub2RlICclcycgIgogICAgICAgICAgICAgICAgImRvZXMgbm90IHN1
cHBvcnQgbGl2ZSBtaWdyYXRpb24iLAogICAgICAgICAgICAgICAgYmRydl9nZXRfZGV2aWNlX29y
X25vZGVfbmFtZShicykpOwotICAgIHJldCA9IG1pZ3JhdGVfYWRkX2Jsb2NrZXIocy0+bWlncmF0
aW9uX2Jsb2NrZXIsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAg
ZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgcmV0ID0gbWlncmF0ZV9hZGRf
YmxvY2tlcihzLT5taWdyYXRpb25fYmxvY2tlciwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAg
ICAgICAgIGVycm9yX2ZyZWUocy0+bWlncmF0aW9uX2Jsb2NrZXIpOwogICAgICAgICBnb3RvIGZh
aWw7CiAgICAgfQpAQCAtMjIyNSwxOSArMjIyMSwxNiBAQCBzdGF0aWMgaW50IHZtZGtfY3JlYXRl
X2V4dGVudChjb25zdCBjaGFyICpmaWxlbmFtZSwgaW50NjRfdCBmaWxlc2l6ZSwKIHsKICAgICBp
bnQgcmV0OwogICAgIEJsb2NrQmFja2VuZCAqYmxrID0gTlVMTDsKLSAgICBFcnJvciAqbG9jYWxf
ZXJyID0gTlVMTDsKIAotICAgIHJldCA9IGJkcnZfY3JlYXRlX2ZpbGUoZmlsZW5hbWUsIG9wdHMs
ICZsb2NhbF9lcnIpOworICAgIHJldCA9IGJkcnZfY3JlYXRlX2ZpbGUoZmlsZW5hbWUsIG9wdHMs
IGVycnApOwogICAgIGlmIChyZXQgPCAwKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJw
LCBsb2NhbF9lcnIpOwogICAgICAgICBnb3RvIGV4aXQ7CiAgICAgfQogCiAgICAgYmxrID0gYmxr
X25ld19vcGVuKGZpbGVuYW1lLCBOVUxMLCBOVUxMLAogICAgICAgICAgICAgICAgICAgICAgICBC
RFJWX09fUkRXUiB8IEJEUlZfT19SRVNJWkUgfCBCRFJWX09fUFJPVE9DT0wsCi0gICAgICAgICAg
ICAgICAgICAgICAgICZsb2NhbF9lcnIpOworICAgICAgICAgICAgICAgICAgICAgICBlcnJwKTsK
ICAgICBpZiAoYmxrID09IE5VTEwpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxv
Y2FsX2Vycik7CiAgICAgICAgIHJldCA9IC1FSU87CiAgICAgICAgIGdvdG8gZXhpdDsKICAgICB9
CkBAIC0yMzM2LDcgKzIzMjksNiBAQCBzdGF0aWMgaW50IGNvcm91dGluZV9mbiB2bWRrX2NvX2Rv
X2NyZWF0ZShpbnQ2NF90IHNpemUsCiAgICAgaW50IGV4dGVudF9pZHg7CiAgICAgQmxvY2tCYWNr
ZW5kICpibGsgPSBOVUxMOwogICAgIEJsb2NrQmFja2VuZCAqZXh0ZW50X2JsazsKLSAgICBFcnJv
ciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBjaGFyICpkZXNjID0gTlVMTDsKICAgICBpbnQgcmV0
ID0gMDsKICAgICBib29sIGZsYXQsIHNwbGl0LCBjb21wcmVzczsKQEAgLTI0NDAsOSArMjQzMiw4
IEBAIHN0YXRpYyBpbnQgY29yb3V0aW5lX2ZuIHZtZGtfY29fZG9fY3JlYXRlKGludDY0X3Qgc2l6
ZSwKICAgICAgICAgY2hhciAqZnVsbF9iYWNraW5nID0KICAgICAgICAgICAgIGJkcnZfZ2V0X2Z1
bGxfYmFja2luZ19maWxlbmFtZV9mcm9tX2ZpbGVuYW1lKGJsa19icyhibGspLT5maWxlbmFtZSwK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGJhY2tpbmdfZmlsZSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICZsb2NhbF9lcnIpOwotICAgICAgICBpZiAobG9jYWxfZXJyKSB7Ci0g
ICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycnApOworICAg
ICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIHJldCA9IC1FTk9FTlQ7CiAgICAgICAgICAg
ICBnb3RvIGV4aXQ7CiAgICAgICAgIH0KQEAgLTI1OTEsNyArMjU4Miw2IEBAIGV4aXQ6CiBzdGF0
aWMgaW50IGNvcm91dGluZV9mbiB2bWRrX2NvX2NyZWF0ZV9vcHRzKGNvbnN0IGNoYXIgKmZpbGVu
YW1lLCBRZW11T3B0cyAqb3B0cywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgRXJyb3IgKiplcnJwKQogewotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwog
ICAgIGNoYXIgKmRlc2MgPSBOVUxMOwogICAgIGludDY0X3QgdG90YWxfc2l6ZSA9IDA7CiAgICAg
Y2hhciAqYWRhcHRlcl90eXBlID0gTlVMTDsKQEAgLTI2MzQsOSArMjYyNCw4IEBAIHN0YXRpYyBp
bnQgY29yb3V0aW5lX2ZuIHZtZGtfY29fY3JlYXRlX29wdHMoY29uc3QgY2hhciAqZmlsZW5hbWUs
IFFlbXVPcHRzICpvcHRzCiAgICAgICAgIGFkYXB0ZXJfdHlwZV9lbnVtID0gcWFwaV9lbnVtX3Bh
cnNlKCZCbG9ja2RldlZtZGtBZGFwdGVyVHlwZV9sb29rdXAsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGFkYXB0ZXJfdHlwZSwKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgQkxPQ0tERVZfVk1ES19BREFQVEVSX1RZUEVfSURF
LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmbG9jYWxfZXJy
KTsKLSAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRl
KGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIHJldCA9IC1F
SU5WQUw7CiAgICAgICAgICAgICBnb3RvIGV4aXQ7CiAgICAgICAgIH0KQEAgLTI2NTEsOSArMjY0
MCw4IEBAIHN0YXRpYyBpbnQgY29yb3V0aW5lX2ZuIHZtZGtfY29fY3JlYXRlX29wdHMoY29uc3Qg
Y2hhciAqZmlsZW5hbWUsIFFlbXVPcHRzICpvcHRzCiAgICAgICAgIHN1YmZvcm1hdCA9IHFhcGlf
ZW51bV9wYXJzZSgmQmxvY2tkZXZWbWRrU3ViZm9ybWF0X2xvb2t1cCwKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGZtdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIEJMT0NLREVWX1ZNREtfU1VCRk9STUFUX01PTk9MSVRISUNTUEFSU0UsCi0gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYgKGxv
Y2FsX2VycikgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJwKTsKKyAgICAgICAgaWYg
KCplcnJwKSB7CiAgICAgICAgICAgICByZXQgPSAtRUlOVkFMOwogICAgICAgICAgICAgZ290byBl
eGl0OwogICAgICAgICB9CmRpZmYgLS1naXQgYS9ibG9jay92cGMuYyBiL2Jsb2NrL3ZwYy5jCmlu
ZGV4IDVjZDM4OTA3ODAuLjJkZTRmODNlNGYgMTAwNjQ0Ci0tLSBhL2Jsb2NrL3ZwYy5jCisrKyBi
L2Jsb2NrL3ZwYy5jCkBAIC0yMTgsNyArMjE4LDYgQEAgc3RhdGljIGludCB2cGNfb3BlbihCbG9j
a0RyaXZlclN0YXRlICpicywgUURpY3QgKm9wdGlvbnMsIGludCBmbGFncywKICAgICBWSERGb290
ZXIgKmZvb3RlcjsKICAgICBWSEREeW5EaXNrSGVhZGVyICpkeW5kaXNrX2hlYWRlcjsKICAgICBR
ZW11T3B0cyAqb3B0cyA9IE5VTEw7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAg
Ym9vbCB1c2VfY2hzOwogICAgIHVpbnQ4X3QgYnVmW0hFQURFUl9TSVpFXTsKICAgICB1aW50MzJf
dCBjaGVja3N1bTsKQEAgLTIzNSwxNiArMjM0LDE0IEBAIHN0YXRpYyBpbnQgdnBjX29wZW4oQmxv
Y2tEcml2ZXJTdGF0ZSAqYnMsIFFEaWN0ICpvcHRpb25zLCBpbnQgZmxhZ3MsCiAgICAgfQogCiAg
ICAgb3B0cyA9IHFlbXVfb3B0c19jcmVhdGUoJnZwY19ydW50aW1lX29wdHMsIE5VTEwsIDAsICZl
cnJvcl9hYm9ydCk7Ci0gICAgcWVtdV9vcHRzX2Fic29yYl9xZGljdChvcHRzLCBvcHRpb25zLCAm
bG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0
ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHFlbXVfb3B0c19hYnNvcmJfcWRpY3Qob3B0cywgb3B0
aW9ucywgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldCA9IC1FSU5WQUw7CiAg
ICAgICAgIGdvdG8gZmFpbDsKICAgICB9CiAKLSAgICB2cGNfcGFyc2Vfb3B0aW9ucyhicywgb3B0
cywgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9w
YWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICB2cGNfcGFyc2Vfb3B0aW9ucyhicywgb3B0cywg
ZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldCA9IC1FSU5WQUw7CiAgICAgICAg
IGdvdG8gZmFpbDsKICAgICB9CkBAIC00NDgsOSArNDQ1LDggQEAgc3RhdGljIGludCB2cGNfb3Bl
bihCbG9ja0RyaXZlclN0YXRlICpicywgUURpY3QgKm9wdGlvbnMsIGludCBmbGFncywKICAgICBl
cnJvcl9zZXRnKCZzLT5taWdyYXRpb25fYmxvY2tlciwgIlRoZSB2cGMgZm9ybWF0IHVzZWQgYnkg
bm9kZSAnJXMnICIKICAgICAgICAgICAgICAgICJkb2VzIG5vdCBzdXBwb3J0IGxpdmUgbWlncmF0
aW9uIiwKICAgICAgICAgICAgICAgIGJkcnZfZ2V0X2RldmljZV9vcl9ub2RlX25hbWUoYnMpKTsK
LSAgICByZXQgPSBtaWdyYXRlX2FkZF9ibG9ja2VyKHMtPm1pZ3JhdGlvbl9ibG9ja2VyLCAmbG9j
YWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShl
cnJwLCBsb2NhbF9lcnIpOworICAgIHJldCA9IG1pZ3JhdGVfYWRkX2Jsb2NrZXIocy0+bWlncmF0
aW9uX2Jsb2NrZXIsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICBlcnJvcl9mcmVl
KHMtPm1pZ3JhdGlvbl9ibG9ja2VyKTsKICAgICAgICAgZ290byBmYWlsOwogICAgIH0KQEAgLTEw
OTYsNyArMTA5Miw2IEBAIHN0YXRpYyBpbnQgY29yb3V0aW5lX2ZuIHZwY19jb19jcmVhdGVfb3B0
cyhjb25zdCBjaGFyICpmaWxlbmFtZSwKICAgICBRRGljdCAqcWRpY3Q7CiAgICAgVmlzaXRvciAq
djsKICAgICBCbG9ja0RyaXZlclN0YXRlICpicyA9IE5VTEw7Ci0gICAgRXJyb3IgKmxvY2FsX2Vy
ciA9IE5VTEw7CiAgICAgaW50IHJldDsKIAogICAgIHN0YXRpYyBjb25zdCBRRGljdFJlbmFtZXMg
b3B0X3JlbmFtZXNbXSA9IHsKQEAgLTExMTMsOSArMTEwOCw4IEBAIHN0YXRpYyBpbnQgY29yb3V0
aW5lX2ZuIHZwY19jb19jcmVhdGVfb3B0cyhjb25zdCBjaGFyICpmaWxlbmFtZSwKICAgICB9CiAK
ICAgICAvKiBDcmVhdGUgYW5kIG9wZW4gdGhlIGZpbGUgKHByb3RvY29sIGxheWVyKSAqLwotICAg
IHJldCA9IGJkcnZfY3JlYXRlX2ZpbGUoZmlsZW5hbWUsIG9wdHMsICZsb2NhbF9lcnIpOworICAg
IHJldCA9IGJkcnZfY3JlYXRlX2ZpbGUoZmlsZW5hbWUsIG9wdHMsIGVycnApOwogICAgIGlmIChy
ZXQgPCAwKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogICAg
ICAgICBnb3RvIGZhaWw7CiAgICAgfQogCkBAIC0xMTM2LDExICsxMTMwLDEwIEBAIHN0YXRpYyBp
bnQgY29yb3V0aW5lX2ZuIHZwY19jb19jcmVhdGVfb3B0cyhjb25zdCBjaGFyICpmaWxlbmFtZSwK
ICAgICAgICAgZ290byBmYWlsOwogICAgIH0KIAotICAgIHZpc2l0X3R5cGVfQmxvY2tkZXZDcmVh
dGVPcHRpb25zKHYsIE5VTEwsICZjcmVhdGVfb3B0aW9ucywgJmxvY2FsX2Vycik7CisgICAgdmlz
aXRfdHlwZV9CbG9ja2RldkNyZWF0ZU9wdGlvbnModiwgTlVMTCwgJmNyZWF0ZV9vcHRpb25zLCBl
cnJwKTsKICAgICB2aXNpdF9mcmVlKHYpOwogCi0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAg
ICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBpZiAoKmVycnApIHsKICAg
ICAgICAgcmV0ID0gLUVJTlZBTDsKICAgICAgICAgZ290byBmYWlsOwogICAgIH0KZGlmZiAtLWdp
dCBhL2Jsb2NrL3Z2ZmF0LmMgYi9ibG9jay92dmZhdC5jCmluZGV4IDAxOWI4ZjEzNDEuLjcxNDI4
ZWE1YTQgMTAwNjQ0Ci0tLSBhL2Jsb2NrL3Z2ZmF0LmMKKysrIGIvYmxvY2svdnZmYXQuYwpAQCAt
MTE1NCw3ICsxMTU0LDYgQEAgc3RhdGljIGludCB2dmZhdF9vcGVuKEJsb2NrRHJpdmVyU3RhdGUg
KmJzLCBRRGljdCAqb3B0aW9ucywgaW50IGZsYWdzLAogICAgIGJvb2wgZmxvcHB5OwogICAgIGNv
bnN0IGNoYXIgKmRpcm5hbWUsICpsYWJlbDsKICAgICBRZW11T3B0cyAqb3B0czsKLSAgICBFcnJv
ciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBpbnQgcmV0OwogCiAjaWZkZWYgREVCVUcKQEAgLTEx
NjIsOSArMTE2MSw4IEBAIHN0YXRpYyBpbnQgdnZmYXRfb3BlbihCbG9ja0RyaXZlclN0YXRlICpi
cywgUURpY3QgKm9wdGlvbnMsIGludCBmbGFncywKICNlbmRpZgogCiAgICAgb3B0cyA9IHFlbXVf
b3B0c19jcmVhdGUoJnJ1bnRpbWVfb3B0cywgTlVMTCwgMCwgJmVycm9yX2Fib3J0KTsKLSAgICBx
ZW11X29wdHNfYWJzb3JiX3FkaWN0KG9wdHMsIG9wdGlvbnMsICZsb2NhbF9lcnIpOwotICAgIGlm
IChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7
CisgICAgcWVtdV9vcHRzX2Fic29yYl9xZGljdChvcHRzLCBvcHRpb25zLCBlcnJwKTsKKyAgICBp
ZiAoKmVycnApIHsKICAgICAgICAgcmV0ID0gLUVJTlZBTDsKICAgICAgICAgZ290byBmYWlsOwog
ICAgIH0KQEAgLTEyODIsOSArMTI4MCw4IEBAIHN0YXRpYyBpbnQgdnZmYXRfb3BlbihCbG9ja0Ry
aXZlclN0YXRlICpicywgUURpY3QgKm9wdGlvbnMsIGludCBmbGFncywKICAgICAgICAgICAgICAg
ICAgICAiVGhlIHZ2ZmF0IChydykgZm9ybWF0IHVzZWQgYnkgbm9kZSAnJXMnICIKICAgICAgICAg
ICAgICAgICAgICAiZG9lcyBub3Qgc3VwcG9ydCBsaXZlIG1pZ3JhdGlvbiIsCiAgICAgICAgICAg
ICAgICAgICAgYmRydl9nZXRfZGV2aWNlX29yX25vZGVfbmFtZShicykpOwotICAgICAgICByZXQg
PSBtaWdyYXRlX2FkZF9ibG9ja2VyKHMtPm1pZ3JhdGlvbl9ibG9ja2VyLCAmbG9jYWxfZXJyKTsK
LSAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVy
cnAsIGxvY2FsX2Vycik7CisgICAgICAgIHJldCA9IG1pZ3JhdGVfYWRkX2Jsb2NrZXIocy0+bWln
cmF0aW9uX2Jsb2NrZXIsIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAg
IGVycm9yX2ZyZWUocy0+bWlncmF0aW9uX2Jsb2NrZXIpOwogICAgICAgICAgICAgZ290byBmYWls
OwogICAgICAgICB9CmRpZmYgLS1naXQgYS9ibG9jay92eGhzLmMgYi9ibG9jay92eGhzLmMKaW5k
ZXggNzdmZDVlYjIwZC4uNmU5OGQ0MzM4ZiAxMDA2NDQKLS0tIGEvYmxvY2svdnhocy5jCisrKyBi
L2Jsb2NrL3Z4aHMuYwpAQCAtMjk5LDcgKzI5OSw2IEBAIHN0YXRpYyBpbnQgdnhoc19vcGVuKEJs
b2NrRHJpdmVyU3RhdGUgKmJzLCBRRGljdCAqb3B0aW9ucywKICAgICBRZW11T3B0cyAqb3B0cyA9
IE5VTEw7CiAgICAgUWVtdU9wdHMgKnRjcF9vcHRzID0gTlVMTDsKICAgICBjaGFyICpvZl92c2Ff
YWRkciA9IE5VTEw7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgY29uc3QgY2hh
ciAqdmRpc2tfaWRfb3B0OwogICAgIGNvbnN0IGNoYXIgKnNlcnZlcl9ob3N0X29wdDsKICAgICBp
bnQgcmV0ID0gMDsKQEAgLTMxNyw4ICszMTYsOCBAQCBzdGF0aWMgaW50IHZ4aHNfb3BlbihCbG9j
a0RyaXZlclN0YXRlICpicywgUURpY3QgKm9wdGlvbnMsCiAgICAgb3B0cyA9IHFlbXVfb3B0c19j
cmVhdGUoJnJ1bnRpbWVfb3B0cywgTlVMTCwgMCwgJmVycm9yX2Fib3J0KTsKICAgICB0Y3Bfb3B0
cyA9IHFlbXVfb3B0c19jcmVhdGUoJnJ1bnRpbWVfdGNwX29wdHMsIE5VTEwsIDAsICZlcnJvcl9h
Ym9ydCk7CiAKLSAgICBxZW11X29wdHNfYWJzb3JiX3FkaWN0KG9wdHMsIG9wdGlvbnMsICZsb2Nh
bF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKKyAgICBxZW11X29wdHNfYWJzb3JiX3FkaWN0
KG9wdHMsIG9wdGlvbnMsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXQgPSAt
RUlOVkFMOwogICAgICAgICBnb3RvIG91dDsKICAgICB9CkBAIC0zMjYsMTQgKzMyNSwxNCBAQCBz
dGF0aWMgaW50IHZ4aHNfb3BlbihCbG9ja0RyaXZlclN0YXRlICpicywgUURpY3QgKm9wdGlvbnMs
CiAgICAgLyogdmRpc2staWQgaXMgdGhlIGRpc2sgVVVJRCAqLwogICAgIHZkaXNrX2lkX29wdCA9
IHFlbXVfb3B0X2dldChvcHRzLCBWWEhTX09QVF9WRElTS19JRCk7CiAgICAgaWYgKCF2ZGlza19p
ZF9vcHQpIHsKLSAgICAgICAgZXJyb3Jfc2V0ZygmbG9jYWxfZXJyLCBRRVJSX01JU1NJTkdfUEFS
QU1FVEVSLCBWWEhTX09QVF9WRElTS19JRCk7CisgICAgICAgIGVycm9yX3NldGcoZXJycCwgUUVS
Ul9NSVNTSU5HX1BBUkFNRVRFUiwgVlhIU19PUFRfVkRJU0tfSUQpOwogICAgICAgICByZXQgPSAt
RUlOVkFMOwogICAgICAgICBnb3RvIG91dDsKICAgICB9CiAKICAgICAvKiB2ZGlzay1pZCBtYXkg
Y29udGFpbiBhIGxlYWRpbmcgJy8nICovCiAgICAgaWYgKHN0cmxlbih2ZGlza19pZF9vcHQpID4g
VVVJRF9GTVRfTEVOICsgMSkgewotICAgICAgICBlcnJvcl9zZXRnKCZsb2NhbF9lcnIsICJ2ZGlz
ay1pZCBjYW5ub3QgYmUgbW9yZSB0aGFuICVkIGNoYXJhY3RlcnMiLAorICAgICAgICBlcnJvcl9z
ZXRnKGVycnAsICJ2ZGlzay1pZCBjYW5ub3QgYmUgbW9yZSB0aGFuICVkIGNoYXJhY3RlcnMiLAog
ICAgICAgICAgICAgICAgICAgIFVVSURfRk1UX0xFTik7CiAgICAgICAgIHJldCA9IC1FSU5WQUw7
CiAgICAgICAgIGdvdG8gb3V0OwpAQCAtMzQ1LDIyICszNDQsMjIgQEAgc3RhdGljIGludCB2eGhz
X29wZW4oQmxvY2tEcml2ZXJTdGF0ZSAqYnMsIFFEaWN0ICpvcHRpb25zLAogICAgIC8qIGdldCB0
aGUgJ3NlcnZlci4nIGFyZ3VtZW50cyAqLwogICAgIHFkaWN0X2V4dHJhY3Rfc3VicWRpY3Qob3B0
aW9ucywgJmJhY2tpbmdfb3B0aW9ucywgVlhIU19PUFRfU0VSVkVSIi4iKTsKIAotICAgIHFlbXVf
b3B0c19hYnNvcmJfcWRpY3QodGNwX29wdHMsIGJhY2tpbmdfb3B0aW9ucywgJmxvY2FsX2Vycik7
Ci0gICAgaWYgKGxvY2FsX2VyciAhPSBOVUxMKSB7CisgICAgcWVtdV9vcHRzX2Fic29yYl9xZGlj
dCh0Y3Bfb3B0cywgYmFja2luZ19vcHRpb25zLCBlcnJwKTsKKyAgICBpZiAoKmVycnAgIT0gTlVM
TCkgewogICAgICAgICByZXQgPSAtRUlOVkFMOwogICAgICAgICBnb3RvIG91dDsKICAgICB9CiAK
ICAgICBzZXJ2ZXJfaG9zdF9vcHQgPSBxZW11X29wdF9nZXQodGNwX29wdHMsIFZYSFNfT1BUX0hP
U1QpOwogICAgIGlmICghc2VydmVyX2hvc3Rfb3B0KSB7Ci0gICAgICAgIGVycm9yX3NldGcoJmxv
Y2FsX2VyciwgUUVSUl9NSVNTSU5HX1BBUkFNRVRFUiwKKyAgICAgICAgZXJyb3Jfc2V0ZyhlcnJw
LCBRRVJSX01JU1NJTkdfUEFSQU1FVEVSLAogICAgICAgICAgICAgICAgICAgIFZYSFNfT1BUX1NF
UlZFUiIuIlZYSFNfT1BUX0hPU1QpOwogICAgICAgICByZXQgPSAtRUlOVkFMOwogICAgICAgICBn
b3RvIG91dDsKICAgICB9CiAKICAgICBpZiAoc3RybGVuKHNlcnZlcl9ob3N0X29wdCkgPiBNQVhI
T1NUTkFNRUxFTikgewotICAgICAgICBlcnJvcl9zZXRnKCZsb2NhbF9lcnIsICJzZXJ2ZXIuaG9z
dCBjYW5ub3QgYmUgbW9yZSB0aGFuICVkIGNoYXJhY3RlcnMiLAorICAgICAgICBlcnJvcl9zZXRn
KGVycnAsICJzZXJ2ZXIuaG9zdCBjYW5ub3QgYmUgbW9yZSB0aGFuICVkIGNoYXJhY3RlcnMiLAog
ICAgICAgICAgICAgICAgICAgIE1BWEhPU1ROQU1FTEVOKTsKICAgICAgICAgcmV0ID0gLUVJTlZB
TDsKICAgICAgICAgZ290byBvdXQ7CkBAIC0zNzAsOCArMzY5LDggQEAgc3RhdGljIGludCB2eGhz
X29wZW4oQmxvY2tEcml2ZXJTdGF0ZSAqYnMsIFFEaWN0ICpvcHRpb25zLAogICAgIHMtPnRsc2Ny
ZWRzaWQgPSBnX3N0cmR1cChxZW11X29wdF9nZXQob3B0cywgInRscy1jcmVkcyIpKTsKICAgICBp
ZiAocy0+dGxzY3JlZHNpZCkgewogICAgICAgICB2eGhzX2dldF90bHNfY3JlZHMocy0+dGxzY3Jl
ZHNpZCwgJmNhY2VydCwgJmNsaWVudF9rZXksCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAm
Y2xpZW50X2NlcnQsICZsb2NhbF9lcnIpOwotICAgICAgICBpZiAobG9jYWxfZXJyICE9IE5VTEwp
IHsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICZjbGllbnRfY2VydCwgZXJycCk7CisgICAg
ICAgIGlmICgqZXJycCAhPSBOVUxMKSB7CiAgICAgICAgICAgICByZXQgPSAtRUlOVkFMOwogICAg
ICAgICAgICAgZ290byBvdXQ7CiAgICAgICAgIH0KQEAgLTQxMyw3ICs0MTIsNiBAQCBvdXQ6CiAK
ICAgICBpZiAocmV0IDwgMCkgewogICAgICAgICB2eGhzX3VucmVmKCk7Ci0gICAgICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogICAgICAgICBnX2ZyZWUocy0+dmRpc2tfaG9z
dGluZm8uaG9zdCk7CiAgICAgICAgIGdfZnJlZShzLT52ZGlza19ndWlkKTsKICAgICAgICAgZ19m
cmVlKHMtPnRsc2NyZWRzaWQpOwpkaWZmIC0tZ2l0IGEvYmxvY2tkZXYuYyBiL2Jsb2NrZGV2LmMK
aW5kZXggZmJlZjY4NDVjOC4uNzkwMWZlYThjZCAxMDA2NDQKLS0tIGEvYmxvY2tkZXYuYworKysg
Yi9ibG9ja2Rldi5jCkBAIC0zNzYsNyArMzc2LDYgQEAgc3RhdGljIHZvaWQgZXh0cmFjdF9jb21t
b25fYmxvY2tkZXZfb3B0aW9ucyhRZW11T3B0cyAqb3B0cywgaW50ICpiZHJ2X2ZsYWdzLAogICAg
IGNvbnN0IGNoYXIgKip0aHJvdHRsaW5nX2dyb3VwLCBUaHJvdHRsZUNvbmZpZyAqdGhyb3R0bGVf
Y2ZnLAogICAgIEJsb2NrZGV2RGV0ZWN0WmVyb2VzT3B0aW9ucyAqZGV0ZWN0X3plcm9lcywgRXJy
b3IgKiplcnJwKQogewotICAgIEVycm9yICpsb2NhbF9lcnJvciA9IE5VTEw7CiAgICAgY29uc3Qg
Y2hhciAqYWlvOwogCiAgICAgaWYgKGJkcnZfZmxhZ3MpIHsKQEAgLTQ1NSw5ICs0NTQsOCBAQCBz
dGF0aWMgdm9pZCBleHRyYWN0X2NvbW1vbl9ibG9ja2Rldl9vcHRpb25zKFFlbXVPcHRzICpvcHRz
LCBpbnQgKmJkcnZfZmxhZ3MsCiAgICAgICAgICAgICBxYXBpX2VudW1fcGFyc2UoJkJsb2NrZGV2
RGV0ZWN0WmVyb2VzT3B0aW9uc19sb29rdXAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
cWVtdV9vcHRfZ2V0KG9wdHMsICJkZXRlY3QtemVyb2VzIiksCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgQkxPQ0tERVZfREVURUNUX1pFUk9FU19PUFRJT05TX09GRiwKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAmbG9jYWxfZXJyb3IpOwotICAgICAgICBpZiAobG9jYWxfZXJyb3Ip
IHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnJvcik7CisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAg
ICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgfQpAQCAtNDc2LDcgKzQ3NCw2IEBAIHN0
YXRpYyBCbG9ja0JhY2tlbmQgKmJsb2NrZGV2X2luaXQoY29uc3QgY2hhciAqZmlsZSwgUURpY3Qg
KmJzX29wdHMsCiAgICAgQmxvY2tEcml2ZXJTdGF0ZSAqYnM7CiAgICAgVGhyb3R0bGVDb25maWcg
Y2ZnOwogICAgIGludCBzbmFwc2hvdCA9IDA7Ci0gICAgRXJyb3IgKmVycm9yID0gTlVMTDsKICAg
ICBRZW11T3B0cyAqb3B0czsKICAgICBRRGljdCAqaW50ZXJ2YWxfZGljdCA9IE5VTEw7CiAgICAg
UUxpc3QgKmludGVydmFsX2xpc3QgPSBOVUxMOwpAQCAtNDg4LDE1ICs0ODUsMTMgQEAgc3RhdGlj
IEJsb2NrQmFja2VuZCAqYmxvY2tkZXZfaW5pdChjb25zdCBjaGFyICpmaWxlLCBRRGljdCAqYnNf
b3B0cywKICAgICAvKiBDaGVjayBjb21tb24gb3B0aW9ucyBieSBjb3B5aW5nIGZyb20gYnNfb3B0
cyB0byBvcHRzLCBhbGwgb3RoZXIgb3B0aW9ucwogICAgICAqIHN0YXkgaW4gYnNfb3B0cyBmb3Ig
cHJvY2Vzc2luZyBieSBiZHJ2X29wZW4oKS4gKi8KICAgICBpZCA9IHFkaWN0X2dldF90cnlfc3Ry
KGJzX29wdHMsICJpZCIpOwotICAgIG9wdHMgPSBxZW11X29wdHNfY3JlYXRlKCZxZW11X2NvbW1v
bl9kcml2ZV9vcHRzLCBpZCwgMSwgJmVycm9yKTsKLSAgICBpZiAoZXJyb3IpIHsKLSAgICAgICAg
ZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycm9yKTsKKyAgICBvcHRzID0gcWVtdV9vcHRzX2NyZWF0
ZSgmcWVtdV9jb21tb25fZHJpdmVfb3B0cywgaWQsIDEsIGVycnApOworICAgIGlmICgqZXJycCkg
ewogICAgICAgICBnb3RvIGVycl9ub19vcHRzOwogICAgIH0KIAotICAgIHFlbXVfb3B0c19hYnNv
cmJfcWRpY3Qob3B0cywgYnNfb3B0cywgJmVycm9yKTsKLSAgICBpZiAoZXJyb3IpIHsKLSAgICAg
ICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycm9yKTsKKyAgICBxZW11X29wdHNfYWJzb3JiX3Fk
aWN0KG9wdHMsIGJzX29wdHMsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICBnb3Rv
IGVhcmx5X2VycjsKICAgICB9CiAKQEAgLTUyNCw5ICs1MTksOCBAQCBzdGF0aWMgQmxvY2tCYWNr
ZW5kICpibG9ja2Rldl9pbml0KGNvbnN0IGNoYXIgKmZpbGUsIFFEaWN0ICpic19vcHRzLAogICAg
IH0KIAogICAgIGV4dHJhY3RfY29tbW9uX2Jsb2NrZGV2X29wdGlvbnMob3B0cywgJmJkcnZfZmxh
Z3MsICZ0aHJvdHRsaW5nX2dyb3VwLCAmY2ZnLAotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgJmRldGVjdF96ZXJvZXMsICZlcnJvcik7Ci0gICAgaWYgKGVycm9yKSB7Ci0gICAg
ICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnJvcik7CisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAmZGV0ZWN0X3plcm9lcywgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAg
ICAgICAgIGdvdG8gZWFybHlfZXJyOwogICAgIH0KIApAQCAtNTQ5LDE4ICs1NDMsMTYgQEAgc3Rh
dGljIEJsb2NrQmFja2VuZCAqYmxvY2tkZXZfaW5pdChjb25zdCBjaGFyICpmaWxlLCBRRGljdCAq
YnNfb3B0cywKIAogICAgIG9uX3dyaXRlX2Vycm9yID0gQkxPQ0tERVZfT05fRVJST1JfRU5PU1BD
OwogICAgIGlmICgoYnVmID0gcWVtdV9vcHRfZ2V0KG9wdHMsICJ3ZXJyb3IiKSkgIT0gTlVMTCkg
ewotICAgICAgICBvbl93cml0ZV9lcnJvciA9IHBhcnNlX2Jsb2NrX2Vycm9yX2FjdGlvbihidWYs
IDAsICZlcnJvcik7Ci0gICAgICAgIGlmIChlcnJvcikgewotICAgICAgICAgICAgZXJyb3JfcHJv
cGFnYXRlKGVycnAsIGVycm9yKTsKKyAgICAgICAgb25fd3JpdGVfZXJyb3IgPSBwYXJzZV9ibG9j
a19lcnJvcl9hY3Rpb24oYnVmLCAwLCBlcnJwKTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAg
ICAgICAgICBnb3RvIGVhcmx5X2VycjsKICAgICAgICAgfQogICAgIH0KIAogICAgIG9uX3JlYWRf
ZXJyb3IgPSBCTE9DS0RFVl9PTl9FUlJPUl9SRVBPUlQ7CiAgICAgaWYgKChidWYgPSBxZW11X29w
dF9nZXQob3B0cywgInJlcnJvciIpKSAhPSBOVUxMKSB7Ci0gICAgICAgIG9uX3JlYWRfZXJyb3Ig
PSBwYXJzZV9ibG9ja19lcnJvcl9hY3Rpb24oYnVmLCAxLCAmZXJyb3IpOwotICAgICAgICBpZiAo
ZXJyb3IpIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnJvcik7CisgICAg
ICAgIG9uX3JlYWRfZXJyb3IgPSBwYXJzZV9ibG9ja19lcnJvcl9hY3Rpb24oYnVmLCAxLCBlcnJw
KTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICBnb3RvIGVhcmx5X2VycjsKICAg
ICAgICAgfQogICAgIH0KQEAgLTc3OSw3ICs3NzEsNiBAQCBEcml2ZUluZm8gKmRyaXZlX25ldyhR
ZW11T3B0cyAqYWxsX29wdHMsIEJsb2NrSW50ZXJmYWNlVHlwZSBibG9ja19kZWZhdWx0X3R5cGUs
CiAgICAgYm9vbCByZWFkX29ubHkgPSBmYWxzZTsKICAgICBib29sIGNvcHlfb25fcmVhZDsKICAg
ICBjb25zdCBjaGFyICpmaWxlbmFtZTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAg
ICBpbnQgaTsKIAogICAgIC8qIENoYW5nZSBsZWdhY3kgY29tbWFuZCBsaW5lIG9wdGlvbnMgaW50
byBRTVAgb25lcyAqLwpAQCAtODEyLDkgKzgwMyw4IEBAIERyaXZlSW5mbyAqZHJpdmVfbmV3KFFl
bXVPcHRzICphbGxfb3B0cywgQmxvY2tJbnRlcmZhY2VUeXBlIGJsb2NrX2RlZmF1bHRfdHlwZSwK
IAogICAgIGZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKG9wdF9yZW5hbWVzKTsgaSsrKSB7CiAg
ICAgICAgIHFlbXVfb3B0X3JlbmFtZShhbGxfb3B0cywgb3B0X3JlbmFtZXNbaV0uZnJvbSwgb3B0
X3JlbmFtZXNbaV0udG8sCi0gICAgICAgICAgICAgICAgICAgICAgICAmbG9jYWxfZXJyKTsKLSAg
ICAgICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAs
IGxvY2FsX2Vycik7CisgICAgICAgICAgICAgICAgICAgICAgICBlcnJwKTsKKyAgICAgICAgaWYg
KCplcnJwKSB7CiAgICAgICAgICAgICByZXR1cm4gTlVMTDsKICAgICAgICAgfQogICAgIH0KQEAg
LTg1MSw5ICs4NDEsOCBAQCBEcml2ZUluZm8gKmRyaXZlX25ldyhRZW11T3B0cyAqYWxsX29wdHMs
IEJsb2NrSW50ZXJmYWNlVHlwZSBibG9ja19kZWZhdWx0X3R5cGUsCiAKICAgICBsZWdhY3lfb3B0
cyA9IHFlbXVfb3B0c19jcmVhdGUoJnFlbXVfbGVnYWN5X2RyaXZlX29wdHMsIE5VTEwsIDAsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZlcnJvcl9hYm9ydCk7Ci0gICAgcWVt
dV9vcHRzX2Fic29yYl9xZGljdChsZWdhY3lfb3B0cywgYnNfb3B0cywgJmxvY2FsX2Vycik7Ci0g
ICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxf
ZXJyKTsKKyAgICBxZW11X29wdHNfYWJzb3JiX3FkaWN0KGxlZ2FjeV9vcHRzLCBic19vcHRzLCBl
cnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ290byBmYWlsOwogICAgIH0KIApAQCAt
OTkzLDEzICs5ODIsMTIgQEAgRHJpdmVJbmZvICpkcml2ZV9uZXcoUWVtdU9wdHMgKmFsbF9vcHRz
LCBCbG9ja0ludGVyZmFjZVR5cGUgYmxvY2tfZGVmYXVsdF90eXBlLAogICAgIH0KIAogICAgIC8q
IEFjdHVhbCBibG9jayBkZXZpY2UgaW5pdDogRnVuY3Rpb25hbGl0eSBzaGFyZWQgd2l0aCBibG9j
a2Rldi1hZGQgKi8KLSAgICBibGsgPSBibG9ja2Rldl9pbml0KGZpbGVuYW1lLCBic19vcHRzLCAm
bG9jYWxfZXJyKTsKKyAgICBibGsgPSBibG9ja2Rldl9pbml0KGZpbGVuYW1lLCBic19vcHRzLCBl
cnJwKTsKICAgICBic19vcHRzID0gTlVMTDsKICAgICBpZiAoIWJsaykgewotICAgICAgICBlcnJv
cl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKICAgICAgICAgZ290byBmYWlsOwogICAgIH0g
ZWxzZSB7Ci0gICAgICAgIGFzc2VydCghbG9jYWxfZXJyKTsKKyAgICAgICAgYXNzZXJ0KCEqZXJy
cCk7CiAgICAgfQogCiAgICAgLyogQ3JlYXRlIGxlZ2FjeSBEcml2ZUluZm8gKi8KQEAgLTExODYs
NyArMTE3NCw2IEBAIFNuYXBzaG90SW5mbyAqcW1wX2Jsb2NrZGV2X3NuYXBzaG90X2RlbGV0ZV9p
bnRlcm5hbF9zeW5jKGNvbnN0IGNoYXIgKmRldmljZSwKICAgICBCbG9ja0RyaXZlclN0YXRlICpi
czsKICAgICBBaW9Db250ZXh0ICphaW9fY29udGV4dDsKICAgICBRRU1VU25hcHNob3RJbmZvIHNu
OwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIFNuYXBzaG90SW5mbyAqaW5mbyA9
IE5VTEw7CiAgICAgaW50IHJldDsKIApAQCAtMTIxNCw5ICsxMjAxLDggQEAgU25hcHNob3RJbmZv
ICpxbXBfYmxvY2tkZXZfc25hcHNob3RfZGVsZXRlX2ludGVybmFsX3N5bmMoY29uc3QgY2hhciAq
ZGV2aWNlLAogICAgICAgICBnb3RvIG91dF9haW9fY29udGV4dDsKICAgICB9CiAKLSAgICByZXQg
PSBiZHJ2X3NuYXBzaG90X2ZpbmRfYnlfaWRfYW5kX25hbWUoYnMsIGlkLCBuYW1lLCAmc24sICZs
b2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRl
KGVycnAsIGxvY2FsX2Vycik7CisgICAgcmV0ID0gYmRydl9zbmFwc2hvdF9maW5kX2J5X2lkX2Fu
ZF9uYW1lKGJzLCBpZCwgbmFtZSwgJnNuLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAg
ICAgZ290byBvdXRfYWlvX2NvbnRleHQ7CiAgICAgfQogICAgIGlmICghcmV0KSB7CkBAIC0xMjI3
LDkgKzEyMTMsOCBAQCBTbmFwc2hvdEluZm8gKnFtcF9ibG9ja2Rldl9zbmFwc2hvdF9kZWxldGVf
aW50ZXJuYWxfc3luYyhjb25zdCBjaGFyICpkZXZpY2UsCiAgICAgICAgIGdvdG8gb3V0X2Fpb19j
b250ZXh0OwogICAgIH0KIAotICAgIGJkcnZfc25hcHNob3RfZGVsZXRlKGJzLCBpZCwgbmFtZSwg
JmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdh
dGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBiZHJ2X3NuYXBzaG90X2RlbGV0ZShicywgaWQsIG5h
bWUsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICBnb3RvIG91dF9haW9fY29udGV4
dDsKICAgICB9CiAKQEAgLTEzNzAsNyArMTM1NSw2IEBAIHN0YXRpYyBpbnQgYWN0aW9uX2NoZWNr
X2NvbXBsZXRpb25fbW9kZShCbGtBY3Rpb25TdGF0ZSAqcywgRXJyb3IgKiplcnJwKQogc3RhdGlj
IHZvaWQgaW50ZXJuYWxfc25hcHNob3RfcHJlcGFyZShCbGtBY3Rpb25TdGF0ZSAqY29tbW9uLAog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcnJvciAqKmVycnApCiB7Ci0g
ICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgY29uc3QgY2hhciAqZGV2aWNlOwogICAg
IGNvbnN0IGNoYXIgKm5hbWU7CiAgICAgQmxvY2tEcml2ZXJTdGF0ZSAqYnM7CkBAIC0xNDMyLDkg
KzE0MTYsOCBAQCBzdGF0aWMgdm9pZCBpbnRlcm5hbF9zbmFwc2hvdF9wcmVwYXJlKEJsa0FjdGlv
blN0YXRlICpjb21tb24sCiAKICAgICAvKiBjaGVjayB3aGV0aGVyIGEgc25hcHNob3Qgd2l0aCBu
YW1lIGV4aXN0ICovCiAgICAgcmV0ID0gYmRydl9zbmFwc2hvdF9maW5kX2J5X2lkX2FuZF9uYW1l
KGJzLCBOVUxMLCBuYW1lLCAmb2xkX3NuLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAg
IGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAg
Z290byBvdXQ7CiAgICAgfSBlbHNlIGlmIChyZXQpIHsKICAgICAgICAgZXJyb3Jfc2V0ZyhlcnJw
LApAQCAtMTUyNCw3ICsxNTA3LDYgQEAgc3RhdGljIHZvaWQgZXh0ZXJuYWxfc25hcHNob3RfcHJl
cGFyZShCbGtBY3Rpb25TdGF0ZSAqY29tbW9uLAogewogICAgIGludCBmbGFncyA9IDA7CiAgICAg
UURpY3QgKm9wdGlvbnMgPSBOVUxMOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAg
IC8qIERldmljZSBhbmQgbm9kZSBuYW1lIG9mIHRoZSBpbWFnZSB0byBnZW5lcmF0ZSB0aGUgc25h
cHNob3QgZnJvbSAqLwogICAgIGNvbnN0IGNoYXIgKmRldmljZTsKICAgICBjb25zdCBjaGFyICpu
b2RlX25hbWU7CkBAIC0xNjM1LDkgKzE2MTcsOCBAQCBzdGF0aWMgdm9pZCBleHRlcm5hbF9zbmFw
c2hvdF9wcmVwYXJlKEJsa0FjdGlvblN0YXRlICpjb21tb24sCiAgICAgICAgICAgICBiZHJ2X2lt
Z19jcmVhdGUobmV3X2ltYWdlX2ZpbGUsIGZvcm1hdCwKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBzdGF0ZS0+b2xkX2JzLT5maWxlbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBzdGF0ZS0+b2xkX2JzLT5kcnYtPmZvcm1hdF9uYW1lLAotICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIE5VTEwsIHNpemUsIGZsYWdzLCBmYWxzZSwgJmxvY2FsX2Vycik7Ci0gICAgICAgICAg
ICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAs
IGxvY2FsX2Vycik7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgTlVMTCwgc2l6ZSwgZmxh
Z3MsIGZhbHNlLCBlcnJwKTsKKyAgICAgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAg
ICAgIGdvdG8gb3V0OwogICAgICAgICAgICAgfQogICAgICAgICB9CkBAIC0xNjg1LDkgKzE2NjYs
OCBAQCBzdGF0aWMgdm9pZCBleHRlcm5hbF9zbmFwc2hvdF9wcmVwYXJlKEJsa0FjdGlvblN0YXRl
ICpjb21tb24sCiAgICAgICogY2FuIGZhaWwsIHNvIHdlIG5lZWQgdG8gZG8gaXQgaW4gLnByZXBh
cmU7IHVuZG9pbmcgaXQgZm9yIGFib3J0IGlzCiAgICAgICogYWx3YXlzIHBvc3NpYmxlLiAqLwog
ICAgIGJkcnZfcmVmKHN0YXRlLT5uZXdfYnMpOwotICAgIGJkcnZfYXBwZW5kKHN0YXRlLT5uZXdf
YnMsIHN0YXRlLT5vbGRfYnMsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAg
ICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgYmRydl9hcHBlbmQo
c3RhdGUtPm5ld19icywgc3RhdGUtPm9sZF9icywgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAg
ICAgICAgIGdvdG8gb3V0OwogICAgIH0KICAgICBzdGF0ZS0+b3ZlcmxheV9hcHBlbmRlZCA9IHRy
dWU7CkBAIC0xNzcxLDcgKzE3NTEsNiBAQCBzdGF0aWMgdm9pZCBkcml2ZV9iYWNrdXBfcHJlcGFy
ZShCbGtBY3Rpb25TdGF0ZSAqY29tbW9uLCBFcnJvciAqKmVycnApCiAgICAgQmxvY2tEcml2ZXJT
dGF0ZSAqYnM7CiAgICAgRHJpdmVCYWNrdXAgKmJhY2t1cDsKICAgICBBaW9Db250ZXh0ICphaW9f
Y29udGV4dDsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAogICAgIGFzc2VydChjb21t
b24tPmFjdGlvbi0+dHlwZSA9PSBUUkFOU0FDVElPTl9BQ1RJT05fS0lORF9EUklWRV9CQUNLVVAp
OwogICAgIGJhY2t1cCA9IGNvbW1vbi0+YWN0aW9uLT51LmRyaXZlX2JhY2t1cC5kYXRhOwpAQCAt
MTc4OSw5ICsxNzY4LDggQEAgc3RhdGljIHZvaWQgZHJpdmVfYmFja3VwX3ByZXBhcmUoQmxrQWN0
aW9uU3RhdGUgKmNvbW1vbiwgRXJyb3IgKiplcnJwKQogCiAgICAgc3RhdGUtPmJzID0gYnM7CiAK
LSAgICBzdGF0ZS0+am9iID0gZG9fZHJpdmVfYmFja3VwKGJhY2t1cCwgY29tbW9uLT5ibG9ja19q
b2JfdHhuLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHN0YXRlLT5qb2IgPSBkb19kcml2ZV9i
YWNrdXAoYmFja3VwLCBjb21tb24tPmJsb2NrX2pvYl90eG4sIGVycnApOworICAgIGlmICgqZXJy
cCkgewogICAgICAgICBnb3RvIG91dDsKICAgICB9CiAKQEAgLTE4NjEsNyArMTgzOSw2IEBAIHN0
YXRpYyB2b2lkIGJsb2NrZGV2X2JhY2t1cF9wcmVwYXJlKEJsa0FjdGlvblN0YXRlICpjb21tb24s
IEVycm9yICoqZXJycCkKICAgICBCbG9ja2RldkJhY2t1cCAqYmFja3VwOwogICAgIEJsb2NrRHJp
dmVyU3RhdGUgKmJzLCAqdGFyZ2V0OwogICAgIEFpb0NvbnRleHQgKmFpb19jb250ZXh0OwotICAg
IEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgYXNzZXJ0KGNvbW1vbi0+YWN0aW9uLT50
eXBlID09IFRSQU5TQUNUSU9OX0FDVElPTl9LSU5EX0JMT0NLREVWX0JBQ0tVUCk7CiAgICAgYmFj
a3VwID0gY29tbW9uLT5hY3Rpb24tPnUuYmxvY2tkZXZfYmFja3VwLmRhdGE7CkBAIC0xODgzLDkg
KzE4NjAsOCBAQCBzdGF0aWMgdm9pZCBibG9ja2Rldl9iYWNrdXBfcHJlcGFyZShCbGtBY3Rpb25T
dGF0ZSAqY29tbW9uLCBFcnJvciAqKmVycnApCiAgICAgLyogUGFpcmVkIHdpdGggLmNsZWFuKCkg
Ki8KICAgICBiZHJ2X2RyYWluZWRfYmVnaW4oc3RhdGUtPmJzKTsKIAotICAgIHN0YXRlLT5qb2Ig
PSBkb19ibG9ja2Rldl9iYWNrdXAoYmFja3VwLCBjb21tb24tPmJsb2NrX2pvYl90eG4sICZsb2Nh
bF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVy
cnAsIGxvY2FsX2Vycik7CisgICAgc3RhdGUtPmpvYiA9IGRvX2Jsb2NrZGV2X2JhY2t1cChiYWNr
dXAsIGNvbW1vbi0+YmxvY2tfam9iX3R4biwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAg
ICAgIGdvdG8gb3V0OwogICAgIH0KIApAQCAtMTk1Miw3ICsxOTI4LDYgQEAgdHlwZWRlZiBzdHJ1
Y3QgQmxvY2tEaXJ0eUJpdG1hcFN0YXRlIHsKIHN0YXRpYyB2b2lkIGJsb2NrX2RpcnR5X2JpdG1h
cF9hZGRfcHJlcGFyZShCbGtBY3Rpb25TdGF0ZSAqY29tbW9uLAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqbG9j
YWxfZXJyID0gTlVMTDsKICAgICBCbG9ja0RpcnR5Qml0bWFwQWRkICphY3Rpb247CiAgICAgQmxv
Y2tEaXJ0eUJpdG1hcFN0YXRlICpzdGF0ZSA9IERPX1VQQ0FTVChCbG9ja0RpcnR5Qml0bWFwU3Rh
dGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tb24s
IGNvbW1vbik7CkBAIC0xOTY4LDEyICsxOTQzLDExIEBAIHN0YXRpYyB2b2lkIGJsb2NrX2RpcnR5
X2JpdG1hcF9hZGRfcHJlcGFyZShCbGtBY3Rpb25TdGF0ZSAqY29tbW9uLAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGFjdGlvbi0+aGFzX3BlcnNpc3RlbnQsIGFjdGlvbi0+cGVyc2lz
dGVudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb24tPmhhc19hdXRvbG9h
ZCwgYWN0aW9uLT5hdXRvbG9hZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rp
b24tPmhhc19kaXNhYmxlZCwgYWN0aW9uLT5kaXNhYmxlZCwKLSAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAmbG9jYWxfZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBl
cnJwKTsKIAotICAgIGlmICghbG9jYWxfZXJyKSB7CisgICAgaWYgKCEqZXJycCkgewogICAgICAg
ICBzdGF0ZS0+cHJlcGFyZWQgPSB0cnVlOwogICAgIH0gZWxzZSB7Ci0gICAgICAgIGVycm9yX3By
b3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogICAgIH0KIH0KIApAQCAtMjM3OSw3ICsyMzUzLDYg
QEAgdm9pZCBxbXBfZWplY3QoYm9vbCBoYXNfZGV2aWNlLCBjb25zdCBjaGFyICpkZXZpY2UsCiAg
ICAgICAgICAgICAgICBib29sIGhhc19pZCwgY29uc3QgY2hhciAqaWQsCiAgICAgICAgICAgICAg
ICBib29sIGhhc19mb3JjZSwgYm9vbCBmb3JjZSwgRXJyb3IgKiplcnJwKQogewotICAgIEVycm9y
ICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIGludCByYzsKIAogICAgIGlmICghaGFzX2ZvcmNlKSB7
CkBAIC0yMzg4LDEyICsyMzYxLDExIEBAIHZvaWQgcW1wX2VqZWN0KGJvb2wgaGFzX2RldmljZSwg
Y29uc3QgY2hhciAqZGV2aWNlLAogCiAgICAgcmMgPSBkb19vcGVuX3RyYXkoaGFzX2RldmljZSA/
IGRldmljZSA6IE5VTEwsCiAgICAgICAgICAgICAgICAgICAgICAgaGFzX2lkID8gaWQgOiBOVUxM
LAotICAgICAgICAgICAgICAgICAgICAgIGZvcmNlLCAmbG9jYWxfZXJyKTsKKyAgICAgICAgICAg
ICAgICAgICAgICBmb3JjZSwgZXJycCk7CiAgICAgaWYgKHJjICYmIHJjICE9IC1FTk9TWVMpIHsK
LSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CiAgICAgICAgIHJldHVy
bjsKICAgICB9Ci0gICAgZXJyb3JfZnJlZShsb2NhbF9lcnIpOworICAgIGVycm9yX2ZyZWVfZXJy
cChlcnJwKTsKIAogICAgIGJsb2NrZGV2X3JlbW92ZV9tZWRpdW0oaGFzX2RldmljZSwgZGV2aWNl
LCBoYXNfaWQsIGlkLCBlcnJwKTsKIH0KQEAgLTI0NjYsNyArMjQzOCw2IEBAIHZvaWQgcW1wX2Js
b2NrZGV2X29wZW5fdHJheShib29sIGhhc19kZXZpY2UsIGNvbnN0IGNoYXIgKmRldmljZSwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBib29sIGhhc19mb3JjZSwgYm9vbCBmb3JjZSwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJyb3IgKmxv
Y2FsX2VyciA9IE5VTEw7CiAgICAgaW50IHJjOwogCiAgICAgaWYgKCFoYXNfZm9yY2UpIHsKQEAg
LTI0NzQsMTIgKzI0NDUsMTEgQEAgdm9pZCBxbXBfYmxvY2tkZXZfb3Blbl90cmF5KGJvb2wgaGFz
X2RldmljZSwgY29uc3QgY2hhciAqZGV2aWNlLAogICAgIH0KICAgICByYyA9IGRvX29wZW5fdHJh
eShoYXNfZGV2aWNlID8gZGV2aWNlIDogTlVMTCwKICAgICAgICAgICAgICAgICAgICAgICBoYXNf
aWQgPyBpZCA6IE5VTEwsCi0gICAgICAgICAgICAgICAgICAgICAgZm9yY2UsICZsb2NhbF9lcnIp
OworICAgICAgICAgICAgICAgICAgICAgIGZvcmNlLCBlcnJwKTsKICAgICBpZiAocmMgJiYgcmMg
IT0gLUVOT1NZUyAmJiByYyAhPSAtRUlOUFJPR1JFU1MpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFn
YXRlKGVycnAsIGxvY2FsX2Vycik7CiAgICAgICAgIHJldHVybjsKICAgICB9Ci0gICAgZXJyb3Jf
ZnJlZShsb2NhbF9lcnIpOworICAgIGVycm9yX2ZyZWVfZXJycChlcnJwKTsKIH0KIAogdm9pZCBx
bXBfYmxvY2tkZXZfY2xvc2VfdHJheShib29sIGhhc19kZXZpY2UsIGNvbnN0IGNoYXIgKmRldmlj
ZSwKQEAgLTI0ODcsNyArMjQ1Nyw2IEBAIHZvaWQgcW1wX2Jsb2NrZGV2X2Nsb3NlX3RyYXkoYm9v
bCBoYXNfZGV2aWNlLCBjb25zdCBjaGFyICpkZXZpY2UsCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIEVycm9yICoqZXJycCkKIHsKICAgICBCbG9ja0JhY2tlbmQgKmJsazsKLSAgICBFcnJv
ciAqbG9jYWxfZXJyID0gTlVMTDsKIAogICAgIGRldmljZSA9IGhhc19kZXZpY2UgPyBkZXZpY2Ug
OiBOVUxMOwogICAgIGlkID0gaGFzX2lkID8gaWQgOiBOVUxMOwpAQCAtMjUxMSw5ICsyNDgwLDgg
QEAgdm9pZCBxbXBfYmxvY2tkZXZfY2xvc2VfdHJheShib29sIGhhc19kZXZpY2UsIGNvbnN0IGNo
YXIgKmRldmljZSwKICAgICAgICAgcmV0dXJuOwogICAgIH0KIAotICAgIGJsa19kZXZfY2hhbmdl
X21lZGlhX2NiKGJsaywgdHJ1ZSwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2Vycikgewot
ICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBibGtfZGV2X2No
YW5nZV9tZWRpYV9jYihibGssIHRydWUsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAg
ICByZXR1cm47CiAgICAgfQogfQpAQCAtMjU4Myw3ICsyNTUxLDYgQEAgdm9pZCBxbXBfYmxvY2tk
ZXZfcmVtb3ZlX21lZGl1bShjb25zdCBjaGFyICppZCwgRXJyb3IgKiplcnJwKQogc3RhdGljIHZv
aWQgcW1wX2Jsb2NrZGV2X2luc2VydF9hbm9uX21lZGl1bShCbG9ja0JhY2tlbmQgKmJsaywKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQmxvY2tEcml2ZXJTdGF0
ZSAqYnMsIEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAg
ICBib29sIGhhc19kZXZpY2U7CiAgICAgaW50IHJldDsKIApAQCAtMjYxNiw5ICsyNTgzLDggQEAg
c3RhdGljIHZvaWQgcW1wX2Jsb2NrZGV2X2luc2VydF9hbm9uX21lZGl1bShCbG9ja0JhY2tlbmQg
KmJsaywKICAgICAgICAgICogc2xvdCBoZXJlLgogICAgICAgICAgKiBEbyBpdCBhZnRlciBibGtf
aW5zZXJ0X2JzKCkgc28gYmxrX2lzX2luc2VydGVkKGJsaykgcmV0dXJucyB0aGUgQGxvYWQKICAg
ICAgICAgICogdmFsdWUgcGFzc2VkIGhlcmUgKGkuZS4gdHJ1ZSkuICovCi0gICAgICAgIGJsa19k
ZXZfY2hhbmdlX21lZGlhX2NiKGJsaywgdHJ1ZSwgJmxvY2FsX2Vycik7Ci0gICAgICAgIGlmIChs
b2NhbF9lcnIpIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIp
OworICAgICAgICBibGtfZGV2X2NoYW5nZV9tZWRpYV9jYihibGssIHRydWUsIGVycnApOworICAg
ICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIGJsa19yZW1vdmVfYnMoYmxrKTsKICAgICAg
ICAgICAgIHJldHVybjsKICAgICAgICAgfQpAQCAtMjY3Myw3ICsyNjM5LDYgQEAgdm9pZCBxbXBf
YmxvY2tkZXZfY2hhbmdlX21lZGl1bShib29sIGhhc19kZXZpY2UsIGNvbnN0IGNoYXIgKmRldmlj
ZSwKICAgICBib29sIGRldGVjdF96ZXJvZXM7CiAgICAgaW50IHJjOwogICAgIFFEaWN0ICpvcHRp
b25zID0gTlVMTDsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKIAogICAgIGJsayA9IHFtcF9nZXRf
YmxrKGhhc19kZXZpY2UgPyBkZXZpY2UgOiBOVUxMLAogICAgICAgICAgICAgICAgICAgICAgIGhh
c19pZCA/IGlkIDogTlVMTCwKQEAgLTI3MjUsMjMgKzI2OTAsMTkgQEAgdm9pZCBxbXBfYmxvY2tk
ZXZfY2hhbmdlX21lZGl1bShib29sIGhhc19kZXZpY2UsIGNvbnN0IGNoYXIgKmRldmljZSwKIAog
ICAgIHJjID0gZG9fb3Blbl90cmF5KGhhc19kZXZpY2UgPyBkZXZpY2UgOiBOVUxMLAogICAgICAg
ICAgICAgICAgICAgICAgIGhhc19pZCA/IGlkIDogTlVMTCwKLSAgICAgICAgICAgICAgICAgICAg
ICBmYWxzZSwgJmVycik7CisgICAgICAgICAgICAgICAgICAgICAgZmFsc2UsIGVycnApOwogICAg
IGlmIChyYyAmJiByYyAhPSAtRU5PU1lTKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJw
LCBlcnIpOwogICAgICAgICBnb3RvIGZhaWw7CiAgICAgfQotICAgIGVycm9yX2ZyZWUoZXJyKTsK
LSAgICBlcnIgPSBOVUxMOworICAgIGVycm9yX2ZyZWVfZXJycChlcnJwKTsKIAotICAgIGJsb2Nr
ZGV2X3JlbW92ZV9tZWRpdW0oaGFzX2RldmljZSwgZGV2aWNlLCBoYXNfaWQsIGlkLCAmZXJyKTsK
LSAgICBpZiAoZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAg
IGJsb2NrZGV2X3JlbW92ZV9tZWRpdW0oaGFzX2RldmljZSwgZGV2aWNlLCBoYXNfaWQsIGlkLCBl
cnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ290byBmYWlsOwogICAgIH0KIAotICAg
IHFtcF9ibG9ja2Rldl9pbnNlcnRfYW5vbl9tZWRpdW0oYmxrLCBtZWRpdW1fYnMsICZlcnIpOwot
ICAgIGlmIChlcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAg
cW1wX2Jsb2NrZGV2X2luc2VydF9hbm9uX21lZGl1bShibGssIG1lZGl1bV9icywgZXJycCk7Cisg
ICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8gZmFpbDsKICAgICB9CiAKQEAgLTI5NDEsMTQg
KzI5MDIsMTIgQEAgc3RhdGljIEJkcnZEaXJ0eUJpdG1hcCAqZG9fYmxvY2tfZGlydHlfYml0bWFw
X3JlbW92ZSgKIAogICAgIGlmIChiZHJ2X2RpcnR5X2JpdG1hcF9nZXRfcGVyc2lzdGVuY2UoYml0
bWFwKSkgewogICAgICAgICBBaW9Db250ZXh0ICphaW9fY29udGV4dCA9IGJkcnZfZ2V0X2Fpb19j
b250ZXh0KGJzKTsKLSAgICAgICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICAgICAg
YWlvX2NvbnRleHRfYWNxdWlyZShhaW9fY29udGV4dCk7Ci0gICAgICAgIGJkcnZfcmVtb3ZlX3Bl
cnNpc3RlbnRfZGlydHlfYml0bWFwKGJzLCBuYW1lLCAmbG9jYWxfZXJyKTsKKyAgICAgICAgYmRy
dl9yZW1vdmVfcGVyc2lzdGVudF9kaXJ0eV9iaXRtYXAoYnMsIG5hbWUsIGVycnApOwogICAgICAg
ICBhaW9fY29udGV4dF9yZWxlYXNlKGFpb19jb250ZXh0KTsKIAotICAgICAgICBpZiAobG9jYWxf
ZXJyICE9IE5VTEwpIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9l
cnIpOworICAgICAgICBpZiAoKmVycnAgIT0gTlVMTCkgewogICAgICAgICAgICAgcmV0dXJuIE5V
TEw7CiAgICAgICAgIH0KICAgICB9CkBAIC0zMDM2LDcgKzI5OTUsNiBAQCBzdGF0aWMgQmRydkRp
cnR5Qml0bWFwICpkb19ibG9ja19kaXJ0eV9iaXRtYXBfbWVyZ2UoCiAgICAgQmxvY2tEcml2ZXJT
dGF0ZSAqYnM7CiAgICAgQmRydkRpcnR5Qml0bWFwICpkc3QsICpzcmMsICphbm9uOwogICAgIEJs
b2NrRGlydHlCaXRtYXBNZXJnZVNvdXJjZUxpc3QgKmxzdDsKLSAgICBFcnJvciAqbG9jYWxfZXJy
ID0gTlVMTDsKIAogICAgIGRzdCA9IGJsb2NrX2RpcnR5X2JpdG1hcF9sb29rdXAobm9kZSwgdGFy
Z2V0LCAmYnMsIGVycnApOwogICAgIGlmICghZHN0KSB7CkBAIC0zMDc0LDkgKzMwMzIsOCBAQCBz
dGF0aWMgQmRydkRpcnR5Qml0bWFwICpkb19ibG9ja19kaXJ0eV9iaXRtYXBfbWVyZ2UoCiAgICAg
ICAgICAgICBhYm9ydCgpOwogICAgICAgICB9CiAKLSAgICAgICAgYmRydl9tZXJnZV9kaXJ0eV9i
aXRtYXAoYW5vbiwgc3JjLCBOVUxMLCAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYgKGxvY2FsX2Vy
cikgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAg
ICAgIGJkcnZfbWVyZ2VfZGlydHlfYml0bWFwKGFub24sIHNyYywgTlVMTCwgZXJycCk7CisgICAg
ICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgZHN0ID0gTlVMTDsKICAgICAgICAgICAgIGdv
dG8gb3V0OwogICAgICAgICB9CkBAIC0zMTg2LDcgKzMxNDMsNiBAQCB2b2lkIHFtcF9ibG9ja19y
ZXNpemUoYm9vbCBoYXNfZGV2aWNlLCBjb25zdCBjaGFyICpkZXZpY2UsCiAgICAgICAgICAgICAg
ICAgICAgICAgYm9vbCBoYXNfbm9kZV9uYW1lLCBjb25zdCBjaGFyICpub2RlX25hbWUsCiAgICAg
ICAgICAgICAgICAgICAgICAgaW50NjRfdCBzaXplLCBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJy
b3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgQmxvY2tCYWNrZW5kICpibGsgPSBOVUxMOwogICAg
IEJsb2NrRHJpdmVyU3RhdGUgKmJzOwogICAgIEFpb0NvbnRleHQgKmFpb19jb250ZXh0OwpAQCAt
MzE5NCw5ICszMTUwLDggQEAgdm9pZCBxbXBfYmxvY2tfcmVzaXplKGJvb2wgaGFzX2RldmljZSwg
Y29uc3QgY2hhciAqZGV2aWNlLAogCiAgICAgYnMgPSBiZHJ2X2xvb2t1cF9icyhoYXNfZGV2aWNl
ID8gZGV2aWNlIDogTlVMTCwKICAgICAgICAgICAgICAgICAgICAgICAgIGhhc19ub2RlX25hbWUg
PyBub2RlX25hbWUgOiBOVUxMLAotICAgICAgICAgICAgICAgICAgICAgICAgJmxvY2FsX2Vycik7
Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9j
YWxfZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAgIGVycnApOworICAgIGlmICgqZXJycCkg
ewogICAgICAgICByZXR1cm47CiAgICAgfQogCkBAIC0zMjQ2LDcgKzMyMDEsNiBAQCB2b2lkIHFt
cF9ibG9ja19zdHJlYW0oYm9vbCBoYXNfam9iX2lkLCBjb25zdCBjaGFyICpqb2JfaWQsIGNvbnN0
IGNoYXIgKmRldmljZSwKICAgICBCbG9ja0RyaXZlclN0YXRlICpicywgKml0ZXI7CiAgICAgQmxv
Y2tEcml2ZXJTdGF0ZSAqYmFzZV9icyA9IE5VTEw7CiAgICAgQWlvQ29udGV4dCAqYWlvX2NvbnRl
eHQ7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgY29uc3QgY2hhciAqYmFzZV9u
YW1lID0gTlVMTDsKICAgICBpbnQgam9iX2ZsYWdzID0gSk9CX0RFRkFVTFQ7CiAKQEAgLTMzMTks
OSArMzI3Myw4IEBAIHZvaWQgcW1wX2Jsb2NrX3N0cmVhbShib29sIGhhc19qb2JfaWQsIGNvbnN0
IGNoYXIgKmpvYl9pZCwgY29uc3QgY2hhciAqZGV2aWNlLAogICAgIH0KIAogICAgIHN0cmVhbV9z
dGFydChoYXNfam9iX2lkID8gam9iX2lkIDogTlVMTCwgYnMsIGJhc2VfYnMsIGJhc2VfbmFtZSwK
LSAgICAgICAgICAgICAgICAgam9iX2ZsYWdzLCBoYXNfc3BlZWQgPyBzcGVlZCA6IDAsIG9uX2Vy
cm9yLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3By
b3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICAgICAgICAgICBqb2JfZmxhZ3MsIGhh
c19zcGVlZCA/IHNwZWVkIDogMCwgb25fZXJyb3IsIGVycnApOworICAgIGlmICgqZXJycCkgewog
ICAgICAgICBnb3RvIG91dDsKICAgICB9CiAKQEAgLTMzNDcsNyArMzMwMCw2IEBAIHZvaWQgcW1w
X2Jsb2NrX2NvbW1pdChib29sIGhhc19qb2JfaWQsIGNvbnN0IGNoYXIgKmpvYl9pZCwgY29uc3Qg
Y2hhciAqZGV2aWNlLAogICAgIEJsb2NrRHJpdmVyU3RhdGUgKml0ZXI7CiAgICAgQmxvY2tEcml2
ZXJTdGF0ZSAqYmFzZV9icywgKnRvcF9iczsKICAgICBBaW9Db250ZXh0ICphaW9fY29udGV4dDsK
LSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICAvKiBUaGlzIHdpbGwgYmUgcGFydCBv
ZiB0aGUgUU1QIGNvbW1hbmQsIGlmL3doZW4gdGhlCiAgICAgICogQmxvY2tkZXZPbkVycm9yIGNo
YW5nZSBmb3IgYmxrbWlycm9yIG1ha2VzIGl0IGluCiAgICAgICovCkBAIC0zMzcyLDE1ICszMzI0
LDE0IEBAIHZvaWQgcW1wX2Jsb2NrX2NvbW1pdChib29sIGhhc19qb2JfaWQsIGNvbnN0IGNoYXIg
KmpvYl9pZCwgY29uc3QgY2hhciAqZGV2aWNlLAogICAgICAqICBsaXZlIGNvbW1pdCBmZWF0dXJl
IHZlcnNpb25zOyBmb3IgdGhpcyB0byB3b3JrLCB3ZSBtdXN0IG1ha2Ugc3VyZSB0bwogICAgICAq
ICBwZXJmb3JtIHRoZSBkZXZpY2UgbG9va3VwIGJlZm9yZSBhbnkgZ2VuZXJpYyBlcnJvcnMgdGhh
dCBtYXkgb2NjdXIgaW4gYQogICAgICAqICBzY2VuYXJpbyBpbiB3aGljaCBhbGwgb3B0aW9uYWwg
YXJndW1lbnRzIGFyZSBvbWl0dGVkLiAqLwotICAgIGJzID0gcW1wX2dldF9yb290X2JzKGRldmlj
ZSwgJmxvY2FsX2Vycik7CisgICAgYnMgPSBxbXBfZ2V0X3Jvb3RfYnMoZGV2aWNlLCBlcnJwKTsK
ICAgICBpZiAoIWJzKSB7CiAgICAgICAgIGJzID0gYmRydl9sb29rdXBfYnMoZGV2aWNlLCBkZXZp
Y2UsIE5VTEwpOwogICAgICAgICBpZiAoIWJzKSB7Ci0gICAgICAgICAgICBlcnJvcl9mcmVlKGxv
Y2FsX2Vycik7CisgICAgICAgICAgICBlcnJvcl9mcmVlX2VycnAoZXJycCk7CiAgICAgICAgICAg
ICBlcnJvcl9zZXQoZXJycCwgRVJST1JfQ0xBU1NfREVWSUNFX05PVF9GT1VORCwKICAgICAgICAg
ICAgICAgICAgICAgICAiRGV2aWNlICclcycgbm90IGZvdW5kIiwgZGV2aWNlKTsKICAgICAgICAg
fSBlbHNlIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwog
ICAgICAgICB9CiAgICAgICAgIHJldHVybjsKICAgICB9CkBAIC0zNDcxLDcgKzM0MjIsNyBAQCB2
b2lkIHFtcF9ibG9ja19jb21taXQoYm9vbCBoYXNfam9iX2lkLCBjb25zdCBjaGFyICpqb2JfaWQs
IGNvbnN0IGNoYXIgKmRldmljZSwKICAgICAgICAgfQogICAgICAgICBjb21taXRfYWN0aXZlX3N0
YXJ0KGhhc19qb2JfaWQgPyBqb2JfaWQgOiBOVUxMLCBicywgYmFzZV9icywKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBqb2JfZmxhZ3MsIHNwZWVkLCBvbl9lcnJvciwKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBmaWx0ZXJfbm9kZV9uYW1lLCBOVUxMLCBOVUxMLCBmYWxzZSwgJmxv
Y2FsX2Vycik7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX25vZGVfbmFtZSwg
TlVMTCwgTlVMTCwgZmFsc2UsIGVycnApOwogICAgIH0gZWxzZSB7CiAgICAgICAgIEJsb2NrRHJp
dmVyU3RhdGUgKm92ZXJsYXlfYnMgPSBiZHJ2X2ZpbmRfb3ZlcmxheShicywgdG9wX2JzKTsKICAg
ICAgICAgaWYgKGJkcnZfb3BfaXNfYmxvY2tlZChvdmVybGF5X2JzLCBCTE9DS19PUF9UWVBFX0NP
TU1JVF9UQVJHRVQsIGVycnApKSB7CkBAIC0zNDc5LDEwICszNDMwLDkgQEAgdm9pZCBxbXBfYmxv
Y2tfY29tbWl0KGJvb2wgaGFzX2pvYl9pZCwgY29uc3QgY2hhciAqam9iX2lkLCBjb25zdCBjaGFy
ICpkZXZpY2UsCiAgICAgICAgIH0KICAgICAgICAgY29tbWl0X3N0YXJ0KGhhc19qb2JfaWQgPyBq
b2JfaWQgOiBOVUxMLCBicywgYmFzZV9icywgdG9wX2JzLCBqb2JfZmxhZ3MsCiAgICAgICAgICAg
ICAgICAgICAgICBzcGVlZCwgb25fZXJyb3IsIGhhc19iYWNraW5nX2ZpbGUgPyBiYWNraW5nX2Zp
bGUgOiBOVUxMLAotICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX25vZGVfbmFtZSwgJmxvY2Fs
X2Vycik7CisgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfbm9kZV9uYW1lLCBlcnJwKTsKICAg
ICB9Ci0gICAgaWYgKGxvY2FsX2VyciAhPSBOVUxMKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0
ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIGlmICgqZXJycCAhPSBOVUxMKSB7CiAgICAgICAgIGdv
dG8gb3V0OwogICAgIH0KIApAQCAtMzYxNiw3ICszNTY2LDYgQEAgc3RhdGljIEJsb2NrSm9iICpk
b19kcml2ZV9iYWNrdXAoRHJpdmVCYWNrdXAgKmJhY2t1cCwgSm9iVHhuICp0eG4sCiAgICAgQmxv
Y2tKb2IgKmpvYiA9IE5VTEw7CiAgICAgQWlvQ29udGV4dCAqYWlvX2NvbnRleHQ7CiAgICAgUURp
Y3QgKm9wdGlvbnM7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgaW50IGZsYWdz
OwogICAgIGludDY0X3Qgc2l6ZTsKICAgICBib29sIHNldF9iYWNraW5nX2hkID0gZmFsc2U7CkBA
IC0zNjc2LDE1ICszNjI1LDE0IEBAIHN0YXRpYyBCbG9ja0pvYiAqZG9fZHJpdmVfYmFja3VwKERy
aXZlQmFja3VwICpiYWNrdXAsIEpvYlR4biAqdHhuLAogICAgICAgICAgICAgYmRydl9yZWZyZXNo
X2ZpbGVuYW1lKHNvdXJjZSk7CiAgICAgICAgICAgICBiZHJ2X2ltZ19jcmVhdGUoYmFja3VwLT50
YXJnZXQsIGJhY2t1cC0+Zm9ybWF0LCBzb3VyY2UtPmZpbGVuYW1lLAogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHNvdXJjZS0+ZHJ2LT5mb3JtYXRfbmFtZSwgTlVMTCwKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBzaXplLCBmbGFncywgZmFsc2UsICZsb2NhbF9lcnIpOworICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHNpemUsIGZsYWdzLCBmYWxzZSwgZXJycCk7CiAgICAgICAg
IH0gZWxzZSB7CiAgICAgICAgICAgICBiZHJ2X2ltZ19jcmVhdGUoYmFja3VwLT50YXJnZXQsIGJh
Y2t1cC0+Zm9ybWF0LCBOVUxMLCBOVUxMLCBOVUxMLAotICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHNpemUsIGZsYWdzLCBmYWxzZSwgJmxvY2FsX2Vycik7CisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgc2l6ZSwgZmxhZ3MsIGZhbHNlLCBlcnJwKTsKICAgICAgICAgfQogICAgIH0KIAot
ICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2Fs
X2Vycik7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8gb3V0OwogICAgIH0KIApAQCAt
MzcwMSw4ICszNjQ5LDggQEAgc3RhdGljIEJsb2NrSm9iICpkb19kcml2ZV9iYWNrdXAoRHJpdmVC
YWNrdXAgKmJhY2t1cCwgSm9iVHhuICp0eG4sCiAgICAgfQogCiAgICAgaWYgKHNldF9iYWNraW5n
X2hkKSB7Ci0gICAgICAgIGJkcnZfc2V0X2JhY2tpbmdfaGQodGFyZ2V0X2JzLCBzb3VyY2UsICZs
b2NhbF9lcnIpOwotICAgICAgICBpZiAobG9jYWxfZXJyKSB7CisgICAgICAgIGJkcnZfc2V0X2Jh
Y2tpbmdfaGQodGFyZ2V0X2JzLCBzb3VyY2UsIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsK
ICAgICAgICAgICAgIGdvdG8gdW5yZWY7CiAgICAgICAgIH0KICAgICB9CkBAIC0zOTAyLDcgKzM4
NTAsNiBAQCB2b2lkIHFtcF9kcml2ZV9taXJyb3IoRHJpdmVNaXJyb3IgKmFyZywgRXJyb3IgKipl
cnJwKQogICAgIEJsb2NrRHJpdmVyU3RhdGUgKnNvdXJjZSwgKnRhcmdldF9iczsKICAgICBBaW9D
b250ZXh0ICphaW9fY29udGV4dDsKICAgICBCbG9ja01pcnJvckJhY2tpbmdNb2RlIGJhY2tpbmdf
bW9kZTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBRRGljdCAqb3B0aW9ucyA9
IE5VTEw7CiAgICAgaW50IGZsYWdzOwogICAgIGludDY0X3Qgc2l6ZTsKQEAgLTM5NzAsNyArMzkx
Nyw3IEBAIHZvaWQgcW1wX2RyaXZlX21pcnJvcihEcml2ZU1pcnJvciAqYXJnLCBFcnJvciAqKmVy
cnApCiAgICAgICAgIC8qIGNyZWF0ZSBuZXcgaW1hZ2Ugdy9vIGJhY2tpbmcgZmlsZSAqLwogICAg
ICAgICBhc3NlcnQoZm9ybWF0KTsKICAgICAgICAgYmRydl9pbWdfY3JlYXRlKGFyZy0+dGFyZ2V0
LCBmb3JtYXQsCi0gICAgICAgICAgICAgICAgICAgICAgICBOVUxMLCBOVUxMLCBOVUxMLCBzaXpl
LCBmbGFncywgZmFsc2UsICZsb2NhbF9lcnIpOworICAgICAgICAgICAgICAgICAgICAgICAgTlVM
TCwgTlVMTCwgTlVMTCwgc2l6ZSwgZmxhZ3MsIGZhbHNlLCBlcnJwKTsKICAgICB9IGVsc2Ugewog
ICAgICAgICBzd2l0Y2ggKGFyZy0+bW9kZSkgewogICAgICAgICBjYXNlIE5FV19JTUFHRV9NT0RF
X0VYSVNUSU5HOgpAQCAtMzk4MSwxNSArMzkyOCwxNCBAQCB2b2lkIHFtcF9kcml2ZV9taXJyb3Io
RHJpdmVNaXJyb3IgKmFyZywgRXJyb3IgKiplcnJwKQogICAgICAgICAgICAgYmRydl9pbWdfY3Jl
YXRlKGFyZy0+dGFyZ2V0LCBmb3JtYXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc291
cmNlLT5maWxlbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2UtPmRydi0+
Zm9ybWF0X25hbWUsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgTlVMTCwgc2l6ZSwgZmxh
Z3MsIGZhbHNlLCAmbG9jYWxfZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBOVUxM
LCBzaXplLCBmbGFncywgZmFsc2UsIGVycnApOwogICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg
IGRlZmF1bHQ6CiAgICAgICAgICAgICBhYm9ydCgpOwogICAgICAgICB9CiAgICAgfQogCi0gICAg
aWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJy
KTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ290byBvdXQ7CiAgICAgfQogCkBAIC00MDMy
LDkgKzM5NzgsOCBAQCB2b2lkIHFtcF9kcml2ZV9taXJyb3IoRHJpdmVNaXJyb3IgKmFyZywgRXJy
b3IgKiplcnJwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnLT5oYXNfY29weV9tb2Rl
LCBhcmctPmNvcHlfbW9kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZy0+aGFzX2F1
dG9fZmluYWxpemUsIGFyZy0+YXV0b19maW5hbGl6ZSwKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGFyZy0+aGFzX2F1dG9fZGlzbWlzcywgYXJnLT5hdXRvX2Rpc21pc3MsCi0gICAgICAgICAg
ICAgICAgICAgICAgICAgICAmbG9jYWxfZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
IGVycnApOwogICAgIGJkcnZfdW5yZWYodGFyZ2V0X2JzKTsKLSAgICBlcnJvcl9wcm9wYWdhdGUo
ZXJycCwgbG9jYWxfZXJyKTsKIG91dDoKICAgICBhaW9fY29udGV4dF9yZWxlYXNlKGFpb19jb250
ZXh0KTsKIH0KQEAgLTQwNjEsNyArNDAwNiw2IEBAIHZvaWQgcW1wX2Jsb2NrZGV2X21pcnJvcihi
b29sIGhhc19qb2JfaWQsIGNvbnN0IGNoYXIgKmpvYl9pZCwKICAgICBCbG9ja0RyaXZlclN0YXRl
ICp0YXJnZXRfYnM7CiAgICAgQWlvQ29udGV4dCAqYWlvX2NvbnRleHQ7CiAgICAgQmxvY2tNaXJy
b3JCYWNraW5nTW9kZSBiYWNraW5nX21vZGUgPSBNSVJST1JfTEVBVkVfQkFDS0lOR19DSEFJTjsK
LSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBib29sIHplcm9fdGFyZ2V0OwogICAg
IGludCByZXQ7CiAKQEAgLTQwOTcsOCArNDA0MSw3IEBAIHZvaWQgcW1wX2Jsb2NrZGV2X21pcnJv
cihib29sIGhhc19qb2JfaWQsIGNvbnN0IGNoYXIgKmpvYl9pZCwKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGhhc19jb3B5X21vZGUsIGNvcHlfbW9kZSwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGhhc19hdXRvX2ZpbmFsaXplLCBhdXRvX2ZpbmFsaXplLAogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgaGFzX2F1dG9fZGlzbWlzcywgYXV0b19kaXNtaXNzLAotICAgICAgICAgICAg
ICAgICAgICAgICAgICAgJmxvY2FsX2Vycik7Ci0gICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxv
Y2FsX2Vycik7CisgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJwKTsKIG91dDoKICAgICBh
aW9fY29udGV4dF9yZWxlYXNlKGFpb19jb250ZXh0KTsKIH0KQEAgLTQyNDYsNyArNDE4OSw2IEBA
IHZvaWQgcW1wX2NoYW5nZV9iYWNraW5nX2ZpbGUoY29uc3QgY2hhciAqZGV2aWNlLAogICAgIEJs
b2NrRHJpdmVyU3RhdGUgKmJzID0gTlVMTDsKICAgICBBaW9Db250ZXh0ICphaW9fY29udGV4dDsK
ICAgICBCbG9ja0RyaXZlclN0YXRlICppbWFnZV9icyA9IE5VTEw7Ci0gICAgRXJyb3IgKmxvY2Fs
X2VyciA9IE5VTEw7CiAgICAgYm9vbCBybzsKICAgICBpbnQgcmV0OwogCkBAIC00MjU4LDkgKzQy
MDAsOCBAQCB2b2lkIHFtcF9jaGFuZ2VfYmFja2luZ19maWxlKGNvbnN0IGNoYXIgKmRldmljZSwK
ICAgICBhaW9fY29udGV4dCA9IGJkcnZfZ2V0X2Fpb19jb250ZXh0KGJzKTsKICAgICBhaW9fY29u
dGV4dF9hY3F1aXJlKGFpb19jb250ZXh0KTsKIAotICAgIGltYWdlX2JzID0gYmRydl9sb29rdXBf
YnMoTlVMTCwgaW1hZ2Vfbm9kZV9uYW1lLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJy
KSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIGltYWdl
X2JzID0gYmRydl9sb29rdXBfYnMoTlVMTCwgaW1hZ2Vfbm9kZV9uYW1lLCBlcnJwKTsKKyAgICBp
ZiAoKmVycnApIHsKICAgICAgICAgZ290byBvdXQ7CiAgICAgfQogCkBAIC00MzA4LDggKzQyNDks
NyBAQCB2b2lkIHFtcF9jaGFuZ2VfYmFja2luZ19maWxlKGNvbnN0IGNoYXIgKmRldmljZSwKICAg
ICB9CiAKICAgICBpZiAocm8pIHsKLSAgICAgICAgYmRydl9yZW9wZW5fc2V0X3JlYWRfb25seShp
bWFnZV9icywgdHJ1ZSwgJmxvY2FsX2Vycik7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJw
LCBsb2NhbF9lcnIpOworICAgICAgICBiZHJ2X3Jlb3Blbl9zZXRfcmVhZF9vbmx5KGltYWdlX2Jz
LCB0cnVlLCBlcnJwKTsKICAgICB9CiAKIG91dDoKQEAgLTQzNTMsMTEgKzQyOTMsOSBAQCB2b2lk
IHFtcF9ibG9ja2Rldl9hZGQoQmxvY2tkZXZPcHRpb25zICpvcHRpb25zLCBFcnJvciAqKmVycnAp
CiAgICAgUU9iamVjdCAqb2JqOwogICAgIFZpc2l0b3IgKnYgPSBxb2JqZWN0X291dHB1dF92aXNp
dG9yX25ldygmb2JqKTsKICAgICBRRGljdCAqcWRpY3Q7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9
IE5VTEw7CiAKLSAgICB2aXNpdF90eXBlX0Jsb2NrZGV2T3B0aW9ucyh2LCBOVUxMLCAmb3B0aW9u
cywgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9w
YWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICB2aXNpdF90eXBlX0Jsb2NrZGV2T3B0aW9ucyh2
LCBOVUxMLCAmb3B0aW9ucywgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8g
ZmFpbDsKICAgICB9CiAKQEAgLTQzODgsNyArNDMyNiw2IEBAIHZvaWQgcW1wX3hfYmxvY2tkZXZf
cmVvcGVuKEJsb2NrZGV2T3B0aW9ucyAqb3B0aW9ucywgRXJyb3IgKiplcnJwKQogICAgIEFpb0Nv
bnRleHQgKmN0eDsKICAgICBRT2JqZWN0ICpvYmo7CiAgICAgVmlzaXRvciAqdiA9IHFvYmplY3Rf
b3V0cHV0X3Zpc2l0b3JfbmV3KCZvYmopOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwog
ICAgIEJsb2NrUmVvcGVuUXVldWUgKnF1ZXVlOwogICAgIFFEaWN0ICpxZGljdDsKIApAQCAtNDQw
NSw5ICs0MzQyLDggQEAgdm9pZCBxbXBfeF9ibG9ja2Rldl9yZW9wZW4oQmxvY2tkZXZPcHRpb25z
ICpvcHRpb25zLCBFcnJvciAqKmVycnApCiAgICAgfQogCiAgICAgLyogUHV0IGFsbCBvcHRpb25z
IGluIGEgUURpY3QgYW5kIGZsYXR0ZW4gaXQgKi8KLSAgICB2aXNpdF90eXBlX0Jsb2NrZGV2T3B0
aW9ucyh2LCBOVUxMLCAmb3B0aW9ucywgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2Vycikg
ewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICB2aXNpdF90
eXBlX0Jsb2NrZGV2T3B0aW9ucyh2LCBOVUxMLCAmb3B0aW9ucywgZXJycCk7CisgICAgaWYgKCpl
cnJwKSB7CiAgICAgICAgIGdvdG8gZmFpbDsKICAgICB9CiAKZGlmZiAtLWdpdCBhL2Jsb2Nram9i
LmMgYi9ibG9ja2pvYi5jCmluZGV4IGM2ZTIwZTJmY2QuLjg3MThlYWQzYjggMTAwNjQ0Ci0tLSBh
L2Jsb2Nram9iLmMKKysrIGIvYmxvY2tqb2IuYwpAQCAtNDQ5LDEyICs0NDksOSBAQCB2b2lkICpi
bG9ja19qb2JfY3JlYXRlKGNvbnN0IGNoYXIgKmpvYl9pZCwgY29uc3QgQmxvY2tKb2JEcml2ZXIg
KmRyaXZlciwKIAogICAgIC8qIE9ubHkgc2V0IHNwZWVkIHdoZW4gbmVjZXNzYXJ5IHRvIGF2b2lk
IE5vdFN1cHBvcnRlZCBlcnJvciAqLwogICAgIGlmIChzcGVlZCAhPSAwKSB7Ci0gICAgICAgIEVy
cm9yICpsb2NhbF9lcnIgPSBOVUxMOwotCi0gICAgICAgIGJsb2NrX2pvYl9zZXRfc3BlZWQoam9i
LCBzcGVlZCwgJmxvY2FsX2Vycik7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsKKyAgICAgICAg
YmxvY2tfam9iX3NldF9zcGVlZChqb2IsIHNwZWVkLCBlcnJwKTsKKyAgICAgICAgaWYgKCplcnJw
KSB7CiAgICAgICAgICAgICBqb2JfZWFybHlfZmFpbCgmam9iLT5qb2IpOwotICAgICAgICAgICAg
ZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CiAgICAgICAgICAgICByZXR1cm4gTlVM
TDsKICAgICAgICAgfQogICAgIH0KZGlmZiAtLWdpdCBhL2Jvb3RkZXZpY2UuYyBiL2Jvb3RkZXZp
Y2UuYwppbmRleCAxZDIyNTIwMmY5Li5mY2NkNDdkZDQ0IDEwMDY0NAotLS0gYS9ib290ZGV2aWNl
LmMKKysrIGIvYm9vdGRldmljZS5jCkBAIC01MywxNyArNTMsMTQgQEAgdm9pZCBxZW11X3JlZ2lz
dGVyX2Jvb3Rfc2V0KFFFTVVCb290U2V0SGFuZGxlciAqZnVuYywgdm9pZCAqb3BhcXVlKQogCiB2
b2lkIHFlbXVfYm9vdF9zZXQoY29uc3QgY2hhciAqYm9vdF9vcmRlciwgRXJyb3IgKiplcnJwKQog
ewotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwotCiAgICAgaWYgKCFib290X3NldF9oYW5k
bGVyKSB7CiAgICAgICAgIGVycm9yX3NldGcoZXJycCwgIm5vIGZ1bmN0aW9uIGRlZmluZWQgdG8g
c2V0IGJvb3QgZGV2aWNlIGxpc3QgZm9yIgogICAgICAgICAgICAgICAgICAgICAgICAgICIgdGhp
cyBhcmNoaXRlY3R1cmUiKTsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIAotICAgIHZhbGlkYXRl
X2Jvb3RkZXZpY2VzKGJvb3Rfb3JkZXIsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIp
IHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgdmFsaWRh
dGVfYm9vdGRldmljZXMoYm9vdF9vcmRlciwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAg
ICAgIHJldHVybjsKICAgICB9CiAKQEAgLTI4OCwyNCArMjg1LDIwIEBAIHN0YXRpYyB2b2lkIGRl
dmljZV9zZXRfYm9vdGluZGV4KE9iamVjdCAqb2JqLCBWaXNpdG9yICp2LCBjb25zdCBjaGFyICpu
YW1lLAogewogICAgIEJvb3RJbmRleFByb3BlcnR5ICpwcm9wID0gb3BhcXVlOwogICAgIGludDMy
X3QgYm9vdF9pbmRleDsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAotICAgIHZpc2l0
X3R5cGVfaW50MzIodiwgbmFtZSwgJmJvb3RfaW5kZXgsICZsb2NhbF9lcnIpOwotICAgIGlmIChs
b2NhbF9lcnIpIHsKLSAgICAgICAgZ290byBvdXQ7CisgICAgdmlzaXRfdHlwZV9pbnQzMih2LCBu
YW1lLCAmYm9vdF9pbmRleCwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CisgICAgICAgIHJldHVy
bjsKICAgICB9CiAgICAgLyogY2hlY2sgd2hldGhlciBib290aW5kZXggaXMgcHJlc2VudCBpbiBm
d19ib290X29yZGVyIGxpc3QgICovCi0gICAgY2hlY2tfYm9vdF9pbmRleChib290X2luZGV4LCAm
bG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGdvdG8gb3V0OworICAg
IGNoZWNrX2Jvb3RfaW5kZXgoYm9vdF9pbmRleCwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7Cisg
ICAgICAgIHJldHVybjsKICAgICB9CiAgICAgLyogY2hhbmdlIGJvb3RpbmRleCB0byBhIG5ldyBv
bmUgKi8KICAgICAqcHJvcC0+Ym9vdGluZGV4ID0gYm9vdF9pbmRleDsKIAogICAgIGFkZF9ib290
X2RldmljZV9wYXRoKCpwcm9wLT5ib290aW5kZXgsIHByb3AtPmRldiwgcHJvcC0+c3VmZml4KTsK
LQotb3V0OgotICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogfQogCiBzdGF0
aWMgdm9pZCBwcm9wZXJ0eV9yZWxlYXNlX2Jvb3RpbmRleChPYmplY3QgKm9iaiwgY29uc3QgY2hh
ciAqbmFtZSwKQEAgLTMyMiw3ICszMTUsNiBAQCB2b2lkIGRldmljZV9hZGRfYm9vdGluZGV4X3By
b3BlcnR5KE9iamVjdCAqb2JqLCBpbnQzMl90ICpib290aW5kZXgsCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoYXIgKm5hbWUsIGNvbnN0IGNoYXIgKnN1ZmZpeCwK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGV2aWNlU3RhdGUgKmRldiwgRXJy
b3IgKiplcnJwKQogewotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIEJvb3RJbmRl
eFByb3BlcnR5ICpwcm9wID0gZ19tYWxsb2MwKHNpemVvZigqcHJvcCkpOwogCiAgICAgcHJvcC0+
Ym9vdGluZGV4ID0gYm9vdGluZGV4OwpAQCAtMzMzLDEwICszMjUsOSBAQCB2b2lkIGRldmljZV9h
ZGRfYm9vdGluZGV4X3Byb3BlcnR5KE9iamVjdCAqb2JqLCBpbnQzMl90ICpib290aW5kZXgsCiAg
ICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VfZ2V0X2Jvb3RpbmRleCwKICAgICAgICAgICAg
ICAgICAgICAgICAgIGRldmljZV9zZXRfYm9vdGluZGV4LAogICAgICAgICAgICAgICAgICAgICAg
ICAgcHJvcGVydHlfcmVsZWFzZV9ib290aW5kZXgsCi0gICAgICAgICAgICAgICAgICAgICAgICBw
cm9wLCAmbG9jYWxfZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAgIHByb3AsIGVycnApOwog
Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9j
YWxfZXJyKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ19mcmVlKHByb3ApOwogICAgICAg
ICByZXR1cm47CiAgICAgfQpkaWZmIC0tZ2l0IGEvY2hhcmRldi9jaGFyLXNvY2tldC5jIGIvY2hh
cmRldi9jaGFyLXNvY2tldC5jCmluZGV4IDE4NWZlMzhkZGEuLjRlYjg4MWY5OTggMTAwNjQ0Ci0t
LSBhL2NoYXJkZXYvY2hhci1zb2NrZXQuYworKysgYi9jaGFyZGV2L2NoYXItc29ja2V0LmMKQEAg
LTEwMzEsMTMgKzEwMzEsMTEgQEAgc3RhdGljIGludCB0Y3BfY2hyX3dhaXRfY29ubmVjdGVkKENo
YXJkZXYgKmNociwgRXJyb3IgKiplcnJwKQogICAgICAgICBpZiAocy0+aXNfbGlzdGVuKSB7CiAg
ICAgICAgICAgICB0Y3BfY2hyX2FjY2VwdF9zZXJ2ZXJfc3luYyhjaHIpOwogICAgICAgICB9IGVs
c2UgewotICAgICAgICAgICAgRXJyb3IgKmVyciA9IE5VTEw7Ci0gICAgICAgICAgICBpZiAodGNw
X2Nocl9jb25uZWN0X2NsaWVudF9zeW5jKGNociwgJmVycikgPCAwKSB7CisgICAgICAgICAgICBp
ZiAodGNwX2Nocl9jb25uZWN0X2NsaWVudF9zeW5jKGNociwgZXJycCkgPCAwKSB7CiAgICAgICAg
ICAgICAgICAgaWYgKHMtPnJlY29ubmVjdF90aW1lKSB7Ci0gICAgICAgICAgICAgICAgICAgIGVy
cm9yX2ZyZWUoZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgZXJyb3JfZnJlZV9lcnJwKGVycnAp
OwogICAgICAgICAgICAgICAgICAgICBnX3VzbGVlcChzLT5yZWNvbm5lY3RfdGltZSAqIDEwMDBV
TEwgKiAxMDAwVUxMKTsKICAgICAgICAgICAgICAgICB9IGVsc2UgewotICAgICAgICAgICAgICAg
ICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKICAgICAgICAgICAgICAgICAgICAgcmV0
dXJuIC0xOwogICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgIH0KZGlmZiAtLWdpdCBhL2No
YXJkZXYvY2hhci5jIGIvY2hhcmRldi9jaGFyLmMKaW5kZXggN2I2YjJjYjEyMy4uZDAzODU5NThj
NCAxMDA2NDQKLS0tIGEvY2hhcmRldi9jaGFyLmMKKysrIGIvY2hhcmRldi9jaGFyLmMKQEAgLTYw
Myw3ICs2MDMsNiBAQCBzdGF0aWMgY29uc3QgY2hhciAqY2hhcmRldl9hbGlhc190cmFuc2xhdGUo
Y29uc3QgY2hhciAqbmFtZSkKIAogQ2hhcmRldkJhY2tlbmQgKnFlbXVfY2hyX3BhcnNlX29wdHMo
UWVtdU9wdHMgKm9wdHMsIEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0g
TlVMTDsKICAgICBjb25zdCBDaGFyZGV2Q2xhc3MgKmNjOwogICAgIENoYXJkZXZCYWNrZW5kICpi
YWNrZW5kID0gTlVMTDsKICAgICBjb25zdCBjaGFyICpuYW1lID0gY2hhcmRldl9hbGlhc190cmFu
c2xhdGUocWVtdV9vcHRfZ2V0KG9wdHMsICJiYWNrZW5kIikpOwpAQCAtNjIzLDkgKzYyMiw4IEBA
IENoYXJkZXZCYWNrZW5kICpxZW11X2Nocl9wYXJzZV9vcHRzKFFlbXVPcHRzICpvcHRzLCBFcnJv
ciAqKmVycnApCiAgICAgYmFja2VuZC0+dHlwZSA9IENIQVJERVZfQkFDS0VORF9LSU5EX05VTEw7
CiAKICAgICBpZiAoY2MtPnBhcnNlKSB7Ci0gICAgICAgIGNjLT5wYXJzZShvcHRzLCBiYWNrZW5k
LCAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICAgICAgZXJy
b3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgIGNjLT5wYXJzZShvcHRzLCBi
YWNrZW5kLCBlcnJwKTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICBxYXBpX2Zy
ZWVfQ2hhcmRldkJhY2tlbmQoYmFja2VuZCk7CiAgICAgICAgICAgICByZXR1cm4gTlVMTDsKICAg
ICAgICAgfQpAQCAtOTUxLDcgKzk0OSw2IEBAIENoYXJkZXYgKnFlbXVfY2hhcmRldl9uZXcoY29u
c3QgY2hhciAqaWQsIGNvbnN0IGNoYXIgKnR5cGVuYW1lLAogewogICAgIE9iamVjdCAqb2JqOwog
ICAgIENoYXJkZXYgKmNociA9IE5VTEw7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAg
ICAgYm9vbCBiZV9vcGVuZWQgPSB0cnVlOwogCiAgICAgYXNzZXJ0KGdfc3RyX2hhc19wcmVmaXgo
dHlwZW5hbWUsICJjaGFyZGV2LSIpKTsKQEAgLTk2MSw4ICs5NTgsOCBAQCBDaGFyZGV2ICpxZW11
X2NoYXJkZXZfbmV3KGNvbnN0IGNoYXIgKmlkLCBjb25zdCBjaGFyICp0eXBlbmFtZSwKICAgICBj
aHItPmxhYmVsID0gZ19zdHJkdXAoaWQpOwogICAgIGNoci0+Z2NvbnRleHQgPSBnY29udGV4dDsK
IAotICAgIHFlbXVfY2hhcl9vcGVuKGNociwgYmFja2VuZCwgJmJlX29wZW5lZCwgJmxvY2FsX2Vy
cik7Ci0gICAgaWYgKGxvY2FsX2VycikgeworICAgIHFlbXVfY2hhcl9vcGVuKGNociwgYmFja2Vu
ZCwgJmJlX29wZW5lZCwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8gZW5k
OwogICAgIH0KIApAQCAtOTc0LDE2ICs5NzEsMTUgQEAgQ2hhcmRldiAqcWVtdV9jaGFyZGV2X25l
dyhjb25zdCBjaGFyICppZCwgY29uc3QgY2hhciAqdHlwZW5hbWUsCiAgICAgfQogCiAgICAgaWYg
KGlkKSB7Ci0gICAgICAgIG9iamVjdF9wcm9wZXJ0eV9hZGRfY2hpbGQoZ2V0X2NoYXJkZXZzX3Jv
b3QoKSwgaWQsIG9iaiwgJmxvY2FsX2Vycik7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsKKyAg
ICAgICAgb2JqZWN0X3Byb3BlcnR5X2FkZF9jaGlsZChnZXRfY2hhcmRldnNfcm9vdCgpLCBpZCwg
b2JqLCBlcnJwKTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICBnb3RvIGVuZDsK
ICAgICAgICAgfQogICAgICAgICBvYmplY3RfdW5yZWYob2JqKTsKICAgICB9CiAKIGVuZDoKLSAg
ICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9l
cnIpOworICAgIGlmICgqZXJycCkgewogICAgICAgICBvYmplY3RfdW5yZWYob2JqKTsKICAgICAg
ICAgcmV0dXJuIE5VTEw7CiAgICAgfQpkaWZmIC0tZ2l0IGEvY3J5cHRvL2Jsb2NrLWx1a3MuYyBi
L2NyeXB0by9ibG9jay1sdWtzLmMKaW5kZXggNzQzOTQ5YWRiZi4uMDIzYzRkZmVlYSAxMDA2NDQK
LS0tIGEvY3J5cHRvL2Jsb2NrLWx1a3MuYworKysgYi9jcnlwdG8vYmxvY2stbHVrcy5jCkBAIC02
MzEsNyArNjMxLDYgQEAgcWNyeXB0b19ibG9ja19sdWtzX29wZW4oUUNyeXB0b0Jsb2NrICpibG9j
aywKICAgICAgICAgICAgICAgICAgICAgICAgIEVycm9yICoqZXJycCkKIHsKICAgICBRQ3J5cHRv
QmxvY2tMVUtTICpsdWtzOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIGludCBy
ZXQgPSAwOwogICAgIHNpemVfdCBpOwogICAgIHNzaXplX3QgcnY7CkBAIC03MjcsNDUgKzcyNiw0
MCBAQCBxY3J5cHRvX2Jsb2NrX2x1a3Nfb3BlbihRQ3J5cHRvQmxvY2sgKmJsb2NrLAogICAgICAg
ICBpdmhhc2hfbmFtZSsrOwogCiAgICAgICAgIGl2aGFzaCA9IHFjcnlwdG9fYmxvY2tfbHVrc19o
YXNoX25hbWVfbG9va3VwKGl2aGFzaF9uYW1lLAotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYgKGxvY2Fs
X2VycikgeworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBlcnJwKTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICByZXQgPSAtRU5P
VFNVUDsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogICAg
ICAgICAgICAgZ290byBmYWlsOwogICAgICAgICB9CiAgICAgfQogCiAgICAgY2lwaGVybW9kZSA9
IHFjcnlwdG9fYmxvY2tfbHVrc19jaXBoZXJfbW9kZV9sb29rdXAobHVrcy0+aGVhZGVyLmNpcGhl
cl9tb2RlLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJwKTsKKyAgICBpZiAo
KmVycnApIHsKICAgICAgICAgcmV0ID0gLUVOT1RTVVA7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0
ZShlcnJwLCBsb2NhbF9lcnIpOwogICAgICAgICBnb3RvIGZhaWw7CiAgICAgfQogCiAgICAgY2lw
aGVyYWxnID0gcWNyeXB0b19ibG9ja19sdWtzX2NpcGhlcl9uYW1lX2xvb2t1cChsdWtzLT5oZWFk
ZXIuY2lwaGVyX25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBjaXBoZXJtb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgbHVrcy0+aGVhZGVyLmtleV9ieXRlcywKLSAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZsb2NhbF9lcnIp
OwotICAgIGlmIChsb2NhbF9lcnIpIHsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICBy
ZXQgPSAtRU5PVFNVUDsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7
CiAgICAgICAgIGdvdG8gZmFpbDsKICAgICB9CiAKICAgICBoYXNoID0gcWNyeXB0b19ibG9ja19s
dWtzX2hhc2hfbmFtZV9sb29rdXAobHVrcy0+aGVhZGVyLmhhc2hfc3BlYywKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJmxvY2FsX2Vycik7Ci0gICAgaWYg
KGxvY2FsX2VycikgeworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0ID0gLUVOT1RTVVA7Ci0g
ICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogICAgICAgICBnb3RvIGZh
aWw7CiAgICAgfQogCiAgICAgaXZhbGcgPSBxY3J5cHRvX2Jsb2NrX2x1a3NfaXZnZW5fbmFtZV9s
b29rdXAoaXZnZW5fbmFtZSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7CisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJycCk7CisgICAgaWYgKCpl
cnJwKSB7CiAgICAgICAgIHJldCA9IC1FTk9UU1VQOwotICAgICAgICBlcnJvcl9wcm9wYWdhdGUo
ZXJycCwgbG9jYWxfZXJyKTsKICAgICAgICAgZ290byBmYWlsOwogICAgIH0KIApAQCAtNzc3LDEw
ICs3NzEsOSBAQCBxY3J5cHRvX2Jsb2NrX2x1a3Nfb3BlbihRQ3J5cHRvQmxvY2sgKmJsb2NrLAog
ICAgICAgICB9CiAgICAgICAgIGl2Y2lwaGVyYWxnID0gcWNyeXB0b19ibG9ja19sdWtzX2Vzc2l2
X2NpcGhlcihjaXBoZXJhbGcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBpdmhhc2gsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYgKGxvY2FsX2Vy
cikgeworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgcmV0ID0gLUVOT1RT
VVA7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKICAgICAg
ICAgICAgIGdvdG8gZmFpbDsKICAgICAgICAgfQogICAgIH0gZWxzZSB7CmRpZmYgLS1naXQgYS9j
cnlwdG8vc2VjcmV0LmMgYi9jcnlwdG8vc2VjcmV0LmMKaW5kZXggMWNmMGFkMGNlOC4uMzQ0MDBm
NDJkZiAxMDA2NDQKLS0tIGEvY3J5cHRvL3NlY3JldC5jCisrKyBiL2NyeXB0by9zZWNyZXQuYwpA
QCAtMTgxLDI0ICsxODEsMjEgQEAgcWNyeXB0b19zZWNyZXRfcHJvcF9zZXRfbG9hZGVkKE9iamVj
dCAqb2JqLAogICAgIFFDcnlwdG9TZWNyZXQgKnNlY3JldCA9IFFDUllQVE9fU0VDUkVUKG9iaik7
CiAKICAgICBpZiAodmFsdWUpIHsKLSAgICAgICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAg
ICAgICAgIHVpbnQ4X3QgKmlucHV0ID0gTlVMTDsKICAgICAgICAgc2l6ZV90IGlucHV0bGVuID0g
MDsKICAgICAgICAgdWludDhfdCAqb3V0cHV0ID0gTlVMTDsKICAgICAgICAgc2l6ZV90IG91dHB1
dGxlbiA9IDA7CiAKLSAgICAgICAgcWNyeXB0b19zZWNyZXRfbG9hZF9kYXRhKHNlY3JldCwgJmlu
cHV0LCAmaW5wdXRsZW4sICZsb2NhbF9lcnIpOwotICAgICAgICBpZiAobG9jYWxfZXJyKSB7Ci0g
ICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgcWNy
eXB0b19zZWNyZXRfbG9hZF9kYXRhKHNlY3JldCwgJmlucHV0LCAmaW5wdXRsZW4sIGVycnApOwor
ICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQogCiAg
ICAgICAgIGlmIChzZWNyZXQtPmtleWlkKSB7CiAgICAgICAgICAgICBxY3J5cHRvX3NlY3JldF9k
ZWNyeXB0KHNlY3JldCwgaW5wdXQsIGlucHV0bGVuLAotICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAmb3V0cHV0LCAmb3V0cHV0bGVuLCAmbG9jYWxfZXJyKTsKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgJm91dHB1dCwgJm91dHB1dGxlbiwgZXJycCk7CiAgICAg
ICAgICAgICBnX2ZyZWUoaW5wdXQpOwotICAgICAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAg
ICAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICAg
ICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgfQog
ICAgICAgICAgICAgaW5wdXQgPSBvdXRwdXQ7CkBAIC0yMDYsMTAgKzIwMyw5IEBAIHFjcnlwdG9f
c2VjcmV0X3Byb3Bfc2V0X2xvYWRlZChPYmplY3QgKm9iaiwKICAgICAgICAgfSBlbHNlIHsKICAg
ICAgICAgICAgIGlmIChzZWNyZXQtPmZvcm1hdCAhPSBRQ1JZUFRPX1NFQ1JFVF9GT1JNQVRfUkFX
KSB7CiAgICAgICAgICAgICAgICAgcWNyeXB0b19zZWNyZXRfZGVjb2RlKGlucHV0LCBpbnB1dGxl
biwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJm91dHB1dCwgJm91dHB1
dGxlbiwgJmxvY2FsX2Vycik7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICZvdXRwdXQsICZvdXRwdXRsZW4sIGVycnApOwogICAgICAgICAgICAgICAgIGdfZnJlZShpbnB1
dCk7Ci0gICAgICAgICAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICAgICAgICAgICAg
ICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgICAgICAgICBpZiAo
KmVycnApIHsKICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgIH0K
ICAgICAgICAgICAgICAgICBpbnB1dCA9IG91dHB1dDsKZGlmZiAtLWdpdCBhL2NyeXB0by90bHNz
ZXNzaW9uLmMgYi9jcnlwdG8vdGxzc2Vzc2lvbi5jCmluZGV4IDMzMjAzZThjYTcuLjNiYTI1YzY4
MzQgMTAwNjQ0Ci0tLSBhL2NyeXB0by90bHNzZXNzaW9uLmMKKysrIGIvY3J5cHRvL3Rsc3Nlc3Np
b24uYwpAQCAtMjYyLDcgKzI2Miw2IEBAIHFjcnlwdG9fdGxzX3Nlc3Npb25fY2hlY2tfY2VydGlm
aWNhdGUoUUNyeXB0b1RMU1Nlc3Npb24gKnNlc3Npb24sCiAgICAgdW5zaWduZWQgaW50IG5DZXJ0
cywgaTsKICAgICB0aW1lX3Qgbm93OwogICAgIGdudXRsc194NTA5X2NydF90IGNlcnQgPSBOVUxM
OwotICAgIEVycm9yICplcnIgPSBOVUxMOwogCiAgICAgbm93ID0gdGltZShOVUxMKTsKICAgICBp
ZiAobm93ID09ICgodGltZV90KS0xKSkgewpAQCAtMzU0LDkgKzM1Myw4IEBAIHFjcnlwdG9fdGxz
X3Nlc3Npb25fY2hlY2tfY2VydGlmaWNhdGUoUUNyeXB0b1RMU1Nlc3Npb24gKnNlc3Npb24sCiAg
ICAgICAgICAgICAgICAgYm9vbCBhbGxvdzsKIAogICAgICAgICAgICAgICAgIGFsbG93ID0gcWF1
dGh6X2lzX2FsbG93ZWRfYnlfaWQoc2Vzc2lvbi0+YXV0aHppZCwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb24tPnBlZXJuYW1lLCAmZXJyKTsK
LSAgICAgICAgICAgICAgICBpZiAoZXJyKSB7Ci0gICAgICAgICAgICAgICAgICAgIGVycm9yX3By
b3BhZ2F0ZShlcnJwLCBlcnIpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgc2Vzc2lvbi0+cGVlcm5hbWUsIGVycnApOworICAgICAgICAgICAgICAgIGlm
ICgqZXJycCkgewogICAgICAgICAgICAgICAgICAgICBnb3RvIGVycm9yOwogICAgICAgICAgICAg
ICAgIH0KICAgICAgICAgICAgICAgICBpZiAoIWFsbG93KSB7CmRpZmYgLS1naXQgYS9kdW1wL2R1
bXAuYyBiL2R1bXAvZHVtcC5jCmluZGV4IDZmYjZlMTI0NWEuLjRmZTM4YTM4NWEgMTAwNjQ0Ci0t
LSBhL2R1bXAvZHVtcC5jCisrKyBiL2R1bXAvZHVtcC5jCkBAIC0zODgsMjIgKzM4OCwxOSBAQCBz
dGF0aWMgdm9pZCB3cml0ZV9tZW1vcnkoRHVtcFN0YXRlICpzLCBHdWVzdFBoeXNCbG9jayAqYmxv
Y2ssIHJhbV9hZGRyX3Qgc3RhcnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgaW50NjRfdCBz
aXplLCBFcnJvciAqKmVycnApCiB7CiAgICAgaW50NjRfdCBpOwotICAgIEVycm9yICpsb2NhbF9l
cnIgPSBOVUxMOwogCiAgICAgZm9yIChpID0gMDsgaSA8IHNpemUgLyBzLT5kdW1wX2luZm8ucGFn
ZV9zaXplOyBpKyspIHsKICAgICAgICAgd3JpdGVfZGF0YShzLCBibG9jay0+aG9zdF9hZGRyICsg
c3RhcnQgKyBpICogcy0+ZHVtcF9pbmZvLnBhZ2Vfc2l6ZSwKLSAgICAgICAgICAgICAgICAgICBz
LT5kdW1wX2luZm8ucGFnZV9zaXplLCAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYgKGxvY2FsX2Vy
cikgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAg
ICAgICAgICAgICAgICAgcy0+ZHVtcF9pbmZvLnBhZ2Vfc2l6ZSwgZXJycCk7CisgICAgICAgIGlm
ICgqZXJycCkgewogICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgfQogCiAgICAg
aWYgKChzaXplICUgcy0+ZHVtcF9pbmZvLnBhZ2Vfc2l6ZSkgIT0gMCkgewogICAgICAgICB3cml0
ZV9kYXRhKHMsIGJsb2NrLT5ob3N0X2FkZHIgKyBzdGFydCArIGkgKiBzLT5kdW1wX2luZm8ucGFn
ZV9zaXplLAotICAgICAgICAgICAgICAgICAgIHNpemUgJSBzLT5kdW1wX2luZm8ucGFnZV9zaXpl
LCAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICAgICAgZXJy
b3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgICAgICAgICAgICAgc2l6ZSAl
IHMtPmR1bXBfaW5mby5wYWdlX3NpemUsIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKICAg
ICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQogICAgIH0KQEAgLTQ3Nyw3ICs0NzQsNiBAQCBz
dGF0aWMgdm9pZCB3cml0ZV9lbGZfbG9hZHMoRHVtcFN0YXRlICpzLCBFcnJvciAqKmVycnApCiAg
ICAgTWVtb3J5TWFwcGluZyAqbWVtb3J5X21hcHBpbmc7CiAgICAgdWludDMyX3QgcGhkcl9pbmRl
eCA9IDE7CiAgICAgdWludDMyX3QgbWF4X2luZGV4OwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBO
VUxMOwogCiAgICAgaWYgKHMtPmhhdmVfc2VjdGlvbikgewogICAgICAgICBtYXhfaW5kZXggPSBz
LT5zaF9pbmZvOwpAQCAtNDkxLDE0ICs0ODcsMTMgQEAgc3RhdGljIHZvaWQgd3JpdGVfZWxmX2xv
YWRzKER1bXBTdGF0ZSAqcywgRXJyb3IgKiplcnJwKQogICAgICAgICAgICAgICAgICAgICAgICAg
IHMsICZvZmZzZXQsICZmaWxlc3opOwogICAgICAgICBpZiAocy0+ZHVtcF9pbmZvLmRfY2xhc3Mg
PT0gRUxGQ0xBU1M2NCkgewogICAgICAgICAgICAgd3JpdGVfZWxmNjRfbG9hZChzLCBtZW1vcnlf
bWFwcGluZywgcGhkcl9pbmRleCsrLCBvZmZzZXQsCi0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGZpbGVzeiwgJmxvY2FsX2Vycik7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZp
bGVzeiwgZXJycCk7CiAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICB3cml0ZV9lbGYzMl9s
b2FkKHMsIG1lbW9yeV9tYXBwaW5nLCBwaGRyX2luZGV4KyssIG9mZnNldCwKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgZmlsZXN6LCAmbG9jYWxfZXJyKTsKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgZmlsZXN6LCBlcnJwKTsKICAgICAgICAgfQogCi0gICAgICAgIGlmIChsb2Nh
bF9lcnIpIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwor
ICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQogCkBA
IC01MTEsOCArNTA2LDYgQEAgc3RhdGljIHZvaWQgd3JpdGVfZWxmX2xvYWRzKER1bXBTdGF0ZSAq
cywgRXJyb3IgKiplcnJwKQogLyogd3JpdGUgZWxmIGhlYWRlciwgUFRfTk9URSBhbmQgZWxmIG5v
dGUgdG8gdm1jb3JlLiAqLwogc3RhdGljIHZvaWQgZHVtcF9iZWdpbihEdW1wU3RhdGUgKnMsIEVy
cm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKLQogICAgIC8qCiAg
ICAgICogdGhlIHZtY29yZSdzIGZvcm1hdCBpczoKICAgICAgKiAgIC0tLS0tLS0tLS0tLS0tCkBA
IC01MzksNzMgKzUzMiw2NCBAQCBzdGF0aWMgdm9pZCBkdW1wX2JlZ2luKER1bXBTdGF0ZSAqcywg
RXJyb3IgKiplcnJwKQogCiAgICAgLyogd3JpdGUgZWxmIGhlYWRlciB0byB2bWNvcmUgKi8KICAg
ICBpZiAocy0+ZHVtcF9pbmZvLmRfY2xhc3MgPT0gRUxGQ0xBU1M2NCkgewotICAgICAgICB3cml0
ZV9lbGY2NF9oZWFkZXIocywgJmxvY2FsX2Vycik7CisgICAgICAgIHdyaXRlX2VsZjY0X2hlYWRl
cihzLCBlcnJwKTsKICAgICB9IGVsc2UgewotICAgICAgICB3cml0ZV9lbGYzMl9oZWFkZXIocywg
JmxvY2FsX2Vycik7CisgICAgICAgIHdyaXRlX2VsZjMyX2hlYWRlcihzLCBlcnJwKTsKICAgICB9
Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9j
YWxfZXJyKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIAogICAg
IGlmIChzLT5kdW1wX2luZm8uZF9jbGFzcyA9PSBFTEZDTEFTUzY0KSB7CiAgICAgICAgIC8qIHdy
aXRlIFBUX05PVEUgdG8gdm1jb3JlICovCi0gICAgICAgIHdyaXRlX2VsZjY0X25vdGUocywgJmxv
Y2FsX2Vycik7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgICAgIGVycm9yX3By
b3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICB3cml0ZV9lbGY2NF9ub3RlKHMsIGVy
cnApOworICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAg
fQogCiAgICAgICAgIC8qIHdyaXRlIGFsbCBQVF9MT0FEIHRvIHZtY29yZSAqLwotICAgICAgICB3
cml0ZV9lbGZfbG9hZHMocywgJmxvY2FsX2Vycik7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsK
LSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICB3
cml0ZV9lbGZfbG9hZHMocywgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAg
ICAgcmV0dXJuOwogICAgICAgICB9CiAKICAgICAgICAgLyogd3JpdGUgc2VjdGlvbiB0byB2bWNv
cmUgKi8KICAgICAgICAgaWYgKHMtPmhhdmVfc2VjdGlvbikgewotICAgICAgICAgICAgd3JpdGVf
ZWxmX3NlY3Rpb24ocywgMSwgJmxvY2FsX2Vycik7Ci0gICAgICAgICAgICBpZiAobG9jYWxfZXJy
KSB7Ci0gICAgICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7Cisg
ICAgICAgICAgICB3cml0ZV9lbGZfc2VjdGlvbihzLCAxLCBlcnJwKTsKKyAgICAgICAgICAgIGlm
ICgqZXJycCkgewogICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgIH0KICAgICAg
ICAgfQogCiAgICAgICAgIC8qIHdyaXRlIG5vdGVzIHRvIHZtY29yZSAqLwotICAgICAgICB3cml0
ZV9lbGY2NF9ub3RlcyhmZF93cml0ZV92bWNvcmUsIHMsICZsb2NhbF9lcnIpOwotICAgICAgICBp
ZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxf
ZXJyKTsKKyAgICAgICAgd3JpdGVfZWxmNjRfbm90ZXMoZmRfd3JpdGVfdm1jb3JlLCBzLCBlcnJw
KTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgIH0K
ICAgICB9IGVsc2UgewogICAgICAgICAvKiB3cml0ZSBQVF9OT1RFIHRvIHZtY29yZSAqLwotICAg
ICAgICB3cml0ZV9lbGYzMl9ub3RlKHMsICZsb2NhbF9lcnIpOwotICAgICAgICBpZiAobG9jYWxf
ZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAg
ICAgICAgd3JpdGVfZWxmMzJfbm90ZShzLCBlcnJwKTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAg
ICAgICAgICAgICByZXR1cm47CiAgICAgICAgIH0KIAogICAgICAgICAvKiB3cml0ZSBhbGwgUFRf
TE9BRCB0byB2bWNvcmUgKi8KLSAgICAgICAgd3JpdGVfZWxmX2xvYWRzKHMsICZsb2NhbF9lcnIp
OwotICAgICAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUo
ZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgd3JpdGVfZWxmX2xvYWRzKHMsIGVycnApOworICAg
ICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQogCiAgICAg
ICAgIC8qIHdyaXRlIHNlY3Rpb24gdG8gdm1jb3JlICovCiAgICAgICAgIGlmIChzLT5oYXZlX3Nl
Y3Rpb24pIHsKLSAgICAgICAgICAgIHdyaXRlX2VsZl9zZWN0aW9uKHMsIDAsICZsb2NhbF9lcnIp
OwotICAgICAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICAgICAgICAgIGVycm9yX3By
b3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICAgICAgd3JpdGVfZWxmX3NlY3Rpb24o
cywgMCwgZXJycCk7CisgICAgICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgICAgICBy
ZXR1cm47CiAgICAgICAgICAgICB9CiAgICAgICAgIH0KIAogICAgICAgICAvKiB3cml0ZSBub3Rl
cyB0byB2bWNvcmUgKi8KLSAgICAgICAgd3JpdGVfZWxmMzJfbm90ZXMoZmRfd3JpdGVfdm1jb3Jl
LCBzLCAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICAgICAg
ZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgIHdyaXRlX2VsZjMyX25v
dGVzKGZkX3dyaXRlX3ZtY29yZSwgcywgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAg
ICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgfQpAQCAtNjQzLDcgKzYyNyw2IEBAIHN0
YXRpYyB2b2lkIGR1bXBfaXRlcmF0ZShEdW1wU3RhdGUgKnMsIEVycm9yICoqZXJycCkKIHsKICAg
ICBHdWVzdFBoeXNCbG9jayAqYmxvY2s7CiAgICAgaW50NjRfdCBzaXplOwotICAgIEVycm9yICps
b2NhbF9lcnIgPSBOVUxMOwogCiAgICAgZG8gewogICAgICAgICBibG9jayA9IHMtPm5leHRfYmxv
Y2s7CkBAIC02NTUsOSArNjM4LDggQEAgc3RhdGljIHZvaWQgZHVtcF9pdGVyYXRlKER1bXBTdGF0
ZSAqcywgRXJyb3IgKiplcnJwKQogICAgICAgICAgICAgICAgIHNpemUgLT0gYmxvY2stPnRhcmdl
dF9lbmQgLSAocy0+YmVnaW4gKyBzLT5sZW5ndGgpOwogICAgICAgICAgICAgfQogICAgICAgICB9
Ci0gICAgICAgIHdyaXRlX21lbW9yeShzLCBibG9jaywgcy0+c3RhcnQsIHNpemUsICZsb2NhbF9l
cnIpOwotICAgICAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdh
dGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgd3JpdGVfbWVtb3J5KHMsIGJsb2NrLCBzLT5z
dGFydCwgc2l6ZSwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgcmV0
dXJuOwogICAgICAgICB9CiAKQEAgLTY2NiwxMSArNjQ4LDggQEAgc3RhdGljIHZvaWQgZHVtcF9p
dGVyYXRlKER1bXBTdGF0ZSAqcywgRXJyb3IgKiplcnJwKQogCiBzdGF0aWMgdm9pZCBjcmVhdGVf
dm1jb3JlKER1bXBTdGF0ZSAqcywgRXJyb3IgKiplcnJwKQogewotICAgIEVycm9yICpsb2NhbF9l
cnIgPSBOVUxMOwotCi0gICAgZHVtcF9iZWdpbihzLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9j
YWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAg
IGR1bXBfYmVnaW4ocywgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsK
ICAgICB9CiAKQEAgLTgxNSw3ICs3OTQsNiBAQCBzdGF0aWMgdm9pZCBjcmVhdGVfaGVhZGVyMzIo
RHVtcFN0YXRlICpzLCBFcnJvciAqKmVycnApCiAgICAgdWludDMyX3QgYml0bWFwX2Jsb2NrczsK
ICAgICB1aW50MzJfdCBzdGF0dXMgPSAwOwogICAgIHVpbnQ2NF90IG9mZnNldF9ub3RlOwotICAg
IEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgLyogd3JpdGUgY29tbW9uIGhlYWRlciwg
dGhlIHZlcnNpb24gb2Yga2R1bXAtY29tcHJlc3NlZCBmb3JtYXQgaXMgNnRoICovCiAgICAgc2l6
ZSA9IHNpemVvZihEaXNrRHVtcEhlYWRlcjMyKTsKQEAgLTg5MSw5ICs4NjksOCBAQCBzdGF0aWMg
dm9pZCBjcmVhdGVfaGVhZGVyMzIoRHVtcFN0YXRlICpzLCBFcnJvciAqKmVycnApCiAgICAgcy0+
bm90ZV9idWZfb2Zmc2V0ID0gMDsKIAogICAgIC8qIHVzZSBzLT5ub3RlX2J1ZiB0byBzdG9yZSBu
b3RlcyB0ZW1wb3JhcmlseSAqLwotICAgIHdyaXRlX2VsZjMyX25vdGVzKGJ1Zl93cml0ZV9ub3Rl
LCBzLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3By
b3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHdyaXRlX2VsZjMyX25vdGVzKGJ1Zl93cml0
ZV9ub3RlLCBzLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ290byBvdXQ7CiAg
ICAgfQogICAgIGlmICh3cml0ZV9idWZmZXIocy0+ZmQsIG9mZnNldF9ub3RlLCBzLT5ub3RlX2J1
ZiwKQEAgLTkyNyw3ICs5MDQsNiBAQCBzdGF0aWMgdm9pZCBjcmVhdGVfaGVhZGVyNjQoRHVtcFN0
YXRlICpzLCBFcnJvciAqKmVycnApCiAgICAgdWludDMyX3QgYml0bWFwX2Jsb2NrczsKICAgICB1
aW50MzJfdCBzdGF0dXMgPSAwOwogICAgIHVpbnQ2NF90IG9mZnNldF9ub3RlOwotICAgIEVycm9y
ICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgLyogd3JpdGUgY29tbW9uIGhlYWRlciwgdGhlIHZl
cnNpb24gb2Yga2R1bXAtY29tcHJlc3NlZCBmb3JtYXQgaXMgNnRoICovCiAgICAgc2l6ZSA9IHNp
emVvZihEaXNrRHVtcEhlYWRlcjY0KTsKQEAgLTEwMDMsOSArOTc5LDggQEAgc3RhdGljIHZvaWQg
Y3JlYXRlX2hlYWRlcjY0KER1bXBTdGF0ZSAqcywgRXJyb3IgKiplcnJwKQogICAgIHMtPm5vdGVf
YnVmX29mZnNldCA9IDA7CiAKICAgICAvKiB1c2Ugcy0+bm90ZV9idWYgdG8gc3RvcmUgbm90ZXMg
dGVtcG9yYXJpbHkgKi8KLSAgICB3cml0ZV9lbGY2NF9ub3RlcyhidWZfd3JpdGVfbm90ZSwgcywg
JmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdh
dGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICB3cml0ZV9lbGY2NF9ub3RlcyhidWZfd3JpdGVfbm90
ZSwgcywgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8gb3V0OwogICAgIH0K
IApAQCAtMTAzMSwxNCArMTAwNiwxMSBAQCBvdXQ6CiAKIHN0YXRpYyB2b2lkIHdyaXRlX2R1bXBf
aGVhZGVyKER1bXBTdGF0ZSAqcywgRXJyb3IgKiplcnJwKQogewotICAgICBFcnJvciAqbG9jYWxf
ZXJyID0gTlVMTDsKLQogICAgIGlmIChzLT5kdW1wX2luZm8uZF9jbGFzcyA9PSBFTEZDTEFTUzMy
KSB7Ci0gICAgICAgIGNyZWF0ZV9oZWFkZXIzMihzLCAmbG9jYWxfZXJyKTsKKyAgICAgICAgY3Jl
YXRlX2hlYWRlcjMyKHMsIGVycnApOwogICAgIH0gZWxzZSB7Ci0gICAgICAgIGNyZWF0ZV9oZWFk
ZXI2NChzLCAmbG9jYWxfZXJyKTsKKyAgICAgICAgY3JlYXRlX2hlYWRlcjY0KHMsIGVycnApOwog
ICAgIH0KLSAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKIH0KIAogc3RhdGlj
IHNpemVfdCBkdW1wX2JpdG1hcF9nZXRfYnVmc2l6ZShEdW1wU3RhdGUgKnMpCkBAIC0xNDczLDcg
KzE0NDUsNiBAQCBvdXQ6CiBzdGF0aWMgdm9pZCBjcmVhdGVfa2R1bXBfdm1jb3JlKER1bXBTdGF0
ZSAqcywgRXJyb3IgKiplcnJwKQogewogICAgIGludCByZXQ7Ci0gICAgRXJyb3IgKmxvY2FsX2Vy
ciA9IE5VTEw7CiAKICAgICAvKgogICAgICAqIHRoZSBrZHVtcC1jb21wcmVzc2VkIGZvcm1hdCBp
czoKQEAgLTE1MDMsMjEgKzE0NzQsMTggQEAgc3RhdGljIHZvaWQgY3JlYXRlX2tkdW1wX3ZtY29y
ZShEdW1wU3RhdGUgKnMsIEVycm9yICoqZXJycCkKICAgICAgICAgcmV0dXJuOwogICAgIH0KIAot
ICAgIHdyaXRlX2R1bXBfaGVhZGVyKHMsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIp
IHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgd3JpdGVf
ZHVtcF9oZWFkZXIocywgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsK
ICAgICB9CiAKLSAgICB3cml0ZV9kdW1wX2JpdG1hcChzLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAo
bG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwor
ICAgIHdyaXRlX2R1bXBfYml0bWFwKHMsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAg
ICByZXR1cm47CiAgICAgfQogCi0gICAgd3JpdGVfZHVtcF9wYWdlcyhzLCAmbG9jYWxfZXJyKTsK
LSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2Nh
bF9lcnIpOworICAgIHdyaXRlX2R1bXBfcGFnZXMocywgZXJycCk7CisgICAgaWYgKCplcnJwKSB7
CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKQEAgLTE2NTAsNyArMTYxOCw2IEBAIHN0YXRpYyB2
b2lkIGR1bXBfaW5pdChEdW1wU3RhdGUgKnMsIGludCBmZCwgYm9vbCBoYXNfZm9ybWF0LAogICAg
IFZNQ29yZUluZm9TdGF0ZSAqdm1jaSA9IHZtY29yZWluZm9fZmluZCgpOwogICAgIENQVVN0YXRl
ICpjcHU7CiAgICAgaW50IG5yX2NwdXM7Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7CiAgICAgaW50
IHJldDsKIAogICAgIHMtPmhhc19mb3JtYXQgPSBoYXNfZm9ybWF0OwpAQCAtMTc2OSw5ICsxNzM2
LDggQEAgc3RhdGljIHZvaWQgZHVtcF9pbml0KER1bXBTdGF0ZSAqcywgaW50IGZkLCBib29sIGhh
c19mb3JtYXQsCiAKICAgICAvKiBnZXQgbWVtb3J5IG1hcHBpbmcgKi8KICAgICBpZiAocGFnaW5n
KSB7Ci0gICAgICAgIHFlbXVfZ2V0X2d1ZXN0X21lbW9yeV9tYXBwaW5nKCZzLT5saXN0LCAmcy0+
Z3Vlc3RfcGh5c19ibG9ja3MsICZlcnIpOwotICAgICAgICBpZiAoZXJyICE9IE5VTEwpIHsKLSAg
ICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgICAgICBxZW11X2dldF9n
dWVzdF9tZW1vcnlfbWFwcGluZygmcy0+bGlzdCwgJnMtPmd1ZXN0X3BoeXNfYmxvY2tzLCBlcnJw
KTsKKyAgICAgICAgaWYgKCplcnJwICE9IE5VTEwpIHsKICAgICAgICAgICAgIGdvdG8gY2xlYW51
cDsKICAgICAgICAgfQogICAgIH0gZWxzZSB7CkBAIC0xODcwLDMzICsxODM2LDMxIEBAIGNsZWFu
dXA6CiAvKiB0aGlzIG9wZXJhdGlvbiBtaWdodCBiZSB0aW1lIGNvbnN1bWluZy4gKi8KIHN0YXRp
YyB2b2lkIGR1bXBfcHJvY2VzcyhEdW1wU3RhdGUgKnMsIEVycm9yICoqZXJycCkKIHsKLSAgICBF
cnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBEdW1wUXVlcnlSZXN1bHQgKnJlc3VsdCA9IE5V
TEw7CiAKICAgICBpZiAocy0+aGFzX2Zvcm1hdCAmJiBzLT5mb3JtYXQgPT0gRFVNUF9HVUVTVF9N
RU1PUllfRk9STUFUX1dJTl9ETVApIHsKICNpZmRlZiBUQVJHRVRfWDg2XzY0Ci0gICAgICAgIGNy
ZWF0ZV93aW5fZHVtcChzLCAmbG9jYWxfZXJyKTsKKyAgICAgICAgY3JlYXRlX3dpbl9kdW1wKHMs
IGVycnApOwogI2VuZGlmCiAgICAgfSBlbHNlIGlmIChzLT5oYXNfZm9ybWF0ICYmIHMtPmZvcm1h
dCAhPSBEVU1QX0dVRVNUX01FTU9SWV9GT1JNQVRfRUxGKSB7Ci0gICAgICAgIGNyZWF0ZV9rZHVt
cF92bWNvcmUocywgJmxvY2FsX2Vycik7CisgICAgICAgIGNyZWF0ZV9rZHVtcF92bWNvcmUocywg
ZXJycCk7CiAgICAgfSBlbHNlIHsKLSAgICAgICAgY3JlYXRlX3ZtY29yZShzLCAmbG9jYWxfZXJy
KTsKKyAgICAgICAgY3JlYXRlX3ZtY29yZShzLCBlcnJwKTsKICAgICB9CiAKICAgICAvKiBtYWtl
IHN1cmUgc3RhdHVzIGlzIHdyaXR0ZW4gYWZ0ZXIgd3JpdHRlbl9zaXplIHVwZGF0ZXMgKi8KICAg
ICBzbXBfd21iKCk7CiAgICAgYXRvbWljX3NldCgmcy0+c3RhdHVzLAotICAgICAgICAgICAgICAg
KGxvY2FsX2VyciA/IERVTVBfU1RBVFVTX0ZBSUxFRCA6IERVTVBfU1RBVFVTX0NPTVBMRVRFRCkp
OworICAgICAgICAgICAgICAgKCplcnJwID8gRFVNUF9TVEFUVVNfRkFJTEVEIDogRFVNUF9TVEFU
VVNfQ09NUExFVEVEKSk7CiAKICAgICAvKiBzZW5kIERVTVBfQ09NUExFVEVEIG1lc3NhZ2UgKHVu
Y29uZGl0aW9uYWxseSkgKi8KICAgICByZXN1bHQgPSBxbXBfcXVlcnlfZHVtcChOVUxMKTsKICAg
ICAvKiBzaG91bGQgbmV2ZXIgZmFpbCAqLwogICAgIGFzc2VydChyZXN1bHQpOwotICAgIHFhcGlf
ZXZlbnRfc2VuZF9kdW1wX2NvbXBsZXRlZChyZXN1bHQsICEhbG9jYWxfZXJyLCAobG9jYWxfZXJy
ID8gXAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcl9nZXRfcHJldHR5
KGxvY2FsX2VycikgOiBOVUxMKSk7CisgICAgcWFwaV9ldmVudF9zZW5kX2R1bXBfY29tcGxldGVk
KHJlc3VsdCwgISEqZXJycCwgKCplcnJwID8gXAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBlcnJvcl9nZXRfcHJldHR5KCplcnJwKSA6IE5VTEwpKTsKICAgICBxYXBpX2ZyZWVf
RHVtcFF1ZXJ5UmVzdWx0KHJlc3VsdCk7CiAKLSAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9j
YWxfZXJyKTsKICAgICBkdW1wX2NsZWFudXAocyk7CiB9CiAKQEAgLTE5MjgsNyArMTg5Miw2IEBA
IHZvaWQgcW1wX2R1bXBfZ3Vlc3RfbWVtb3J5KGJvb2wgcGFnaW5nLCBjb25zdCBjaGFyICpmaWxl
LAogICAgIGNvbnN0IGNoYXIgKnA7CiAgICAgaW50IGZkID0gLTE7CiAgICAgRHVtcFN0YXRlICpz
OwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIGJvb2wgZGV0YWNoX3AgPSBmYWxz
ZTsKIAogICAgIGlmIChydW5zdGF0ZV9jaGVjayhSVU5fU1RBVEVfSU5NSUdSQVRFKSkgewpAQCAt
MjAxMyw5ICsxOTc2LDggQEAgdm9pZCBxbXBfZHVtcF9ndWVzdF9tZW1vcnkoYm9vbCBwYWdpbmcs
IGNvbnN0IGNoYXIgKmZpbGUsCiAgICAgZHVtcF9zdGF0ZV9wcmVwYXJlKHMpOwogCiAgICAgZHVt
cF9pbml0KHMsIGZkLCBoYXNfZm9ybWF0LCBmb3JtYXQsIHBhZ2luZywgaGFzX2JlZ2luLAotICAg
ICAgICAgICAgICBiZWdpbiwgbGVuZ3RoLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJy
KSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICAg
ICAgICBiZWdpbiwgbGVuZ3RoLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgYXRv
bWljX3NldCgmcy0+c3RhdHVzLCBEVU1QX1NUQVRVU19GQUlMRUQpOwogICAgICAgICByZXR1cm47
CiAgICAgfQpkaWZmIC0tZ2l0IGEvZHVtcC93aW5fZHVtcC5jIGIvZHVtcC93aW5fZHVtcC5jCmlu
ZGV4IGVkYTJhNDg5NzQuLjczYjNiNDU0ZDQgMTAwNjQ0Ci0tLSBhL2R1bXAvd2luX2R1bXAuYwor
KysgYi9kdW1wL3dpbl9kdW1wLmMKQEAgLTYyLDEzICs2MiwxMSBAQCBzdGF0aWMgdm9pZCB3cml0
ZV9ydW5zKER1bXBTdGF0ZSAqcywgV2luRHVtcEhlYWRlcjY0ICpoLCBFcnJvciAqKmVycnApCiB7
CiAgICAgV2luRHVtcFBoeU1lbURlc2M2NCAqZGVzYyA9ICZoLT5QaHlzaWNhbE1lbW9yeUJsb2Nr
OwogICAgIFdpbkR1bXBQaHlNZW1SdW42NCAqcnVuID0gZGVzYy0+UnVuOwotICAgIEVycm9yICps
b2NhbF9lcnIgPSBOVUxMOwogICAgIGludCBpOwogCiAgICAgZm9yIChpID0gMDsgaSA8IGRlc2Mt
Pk51bWJlck9mUnVuczsgaSsrKSB7Ci0gICAgICAgIHMtPndyaXR0ZW5fc2l6ZSArPSB3cml0ZV9y
dW4ocnVuICsgaSwgcy0+ZmQsICZsb2NhbF9lcnIpOwotICAgICAgICBpZiAobG9jYWxfZXJyKSB7
Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAg
cy0+d3JpdHRlbl9zaXplICs9IHdyaXRlX3J1bihydW4gKyBpLCBzLT5mZCwgZXJycCk7CisgICAg
ICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgfQpA
QCAtMzIyLDcgKzMyMCw2IEBAIHZvaWQgY3JlYXRlX3dpbl9kdW1wKER1bXBTdGF0ZSAqcywgRXJy
b3IgKiplcnJwKQogICAgIFg4NkNQVSAqZmlyc3RfeDg2X2NwdSA9IFg4Nl9DUFUoZmlyc3RfY3B1
KTsKICAgICB1aW50NjRfdCBzYXZlZF9jcjMgPSBmaXJzdF94ODZfY3B1LT5lbnYuY3JbM107CiAg
ICAgc3RydWN0IHNhdmVkX2NvbnRleHQgKnNhdmVkX2N0eCA9IE5VTEw7Ci0gICAgRXJyb3IgKmxv
Y2FsX2VyciA9IE5VTEw7CiAKICAgICBpZiAocy0+Z3Vlc3Rfbm90ZV9zaXplICE9IHNpemVvZihX
aW5EdW1wSGVhZGVyNjQpICsKICAgICAgICAgICAgIFZNQ09SRUlORk9fRUxGX05PVEVfSERSX1NJ
WkUpIHsKQEAgLTMzMCw5ICszMjcsOCBAQCB2b2lkIGNyZWF0ZV93aW5fZHVtcChEdW1wU3RhdGUg
KnMsIEVycm9yICoqZXJycCkKICAgICAgICAgcmV0dXJuOwogICAgIH0KIAotICAgIGNoZWNrX2hl
YWRlcihoLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIGNoZWNrX2hlYWRlcihoLCBlcnJwKTsK
KyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApAQCAtMzQzLDkgKzMz
OSw4IEBAIHZvaWQgY3JlYXRlX3dpbl9kdW1wKER1bXBTdGF0ZSAqcywgRXJyb3IgKiplcnJwKQog
CiAgICAgZmlyc3RfeDg2X2NwdS0+ZW52LmNyWzNdID0gaC0+RGlyZWN0b3J5VGFibGVCYXNlOwog
Ci0gICAgY2hlY2tfa2RiZyhoLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0g
ICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIGNoZWNrX2tkYmco
aCwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8gb3V0X2NyMzsKICAgICB9
CiAKQEAgLTM1OCw5ICszNTMsOCBAQCB2b2lkIGNyZWF0ZV93aW5fZHVtcChEdW1wU3RhdGUgKnMs
IEVycm9yICoqZXJycCkKICAgICAgKiB0byBkZXRlcm1pbmUgaWYgdGhlIHN5c3RlbS1zYXZlZCBj
b250ZXh0IGlzIHZhbGlkCiAgICAgICovCiAKLSAgICBwYXRjaF9hbmRfc2F2ZV9jb250ZXh0KGgs
IHNhdmVkX2N0eCwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBl
cnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBwYXRjaF9hbmRfc2F2ZV9jb250
ZXh0KGgsIHNhdmVkX2N0eCwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8g
b3V0X2ZyZWU7CiAgICAgfQogCkBAIC0zNzIsOSArMzY2LDggQEAgdm9pZCBjcmVhdGVfd2luX2R1
bXAoRHVtcFN0YXRlICpzLCBFcnJvciAqKmVycnApCiAgICAgICAgIGdvdG8gb3V0X3Jlc3RvcmU7
CiAgICAgfQogCi0gICAgd3JpdGVfcnVucyhzLCBoLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9j
YWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAg
IHdyaXRlX3J1bnMocywgaCwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8g
b3V0X3Jlc3RvcmU7CiAgICAgfQogCmRpZmYgLS1naXQgYS9leGVjLmMgYi9leGVjLmMKaW5kZXgg
OGI5OTg5NzRmOC4uYTBhYWExYjI0YSAxMDA2NDQKLS0tIGEvZXhlYy5jCisrKyBiL2V4ZWMuYwpA
QCAtMjMzOCw3ICsyMzM4LDYgQEAgUkFNQmxvY2sgKnFlbXVfcmFtX2FsbG9jX2Zyb21fZmQocmFt
X2FkZHJfdCBzaXplLCBNZW1vcnlSZWdpb24gKm1yLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgRXJyb3IgKiplcnJwKQogewogICAgIFJBTUJsb2NrICpuZXdfYmxvY2s7Ci0gICAg
RXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgaW50NjRfdCBmaWxlX3NpemU7CiAKICAgICAv
KiBKdXN0IHN1cHBvcnQgdGhlc2UgcmFtIGZsYWdzIGJ5IG5vdy4gKi8KQEAgLTIzODYsMTAgKzIz
ODUsOSBAQCBSQU1CbG9jayAqcWVtdV9yYW1fYWxsb2NfZnJvbV9mZChyYW1fYWRkcl90IHNpemUs
IE1lbW9yeVJlZ2lvbiAqbXIsCiAgICAgICAgIHJldHVybiBOVUxMOwogICAgIH0KIAotICAgIHJh
bV9ibG9ja19hZGQobmV3X2Jsb2NrLCAmbG9jYWxfZXJyLCByYW1fZmxhZ3MgJiBSQU1fU0hBUkVE
KTsKLSAgICBpZiAobG9jYWxfZXJyKSB7CisgICAgcmFtX2Jsb2NrX2FkZChuZXdfYmxvY2ssIGVy
cnAsIHJhbV9mbGFncyAmIFJBTV9TSEFSRUQpOworICAgIGlmICgqZXJycCkgewogICAgICAgICBn
X2ZyZWUobmV3X2Jsb2NrKTsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vy
cik7CiAgICAgICAgIHJldHVybiBOVUxMOwogICAgIH0KICAgICByZXR1cm4gbmV3X2Jsb2NrOwpA
QCAtMjQzMiw3ICsyNDMwLDYgQEAgUkFNQmxvY2sgKnFlbXVfcmFtX2FsbG9jX2ludGVybmFsKHJh
bV9hZGRyX3Qgc2l6ZSwgcmFtX2FkZHJfdCBtYXhfc2l6ZSwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBNZW1vcnlSZWdpb24gKm1yLCBFcnJvciAqKmVycnApCiB7CiAgICAgUkFN
QmxvY2sgKm5ld19ibG9jazsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAogICAgIHNp
emUgPSBIT1NUX1BBR0VfQUxJR04oc2l6ZSk7CiAgICAgbWF4X3NpemUgPSBIT1NUX1BBR0VfQUxJ
R04obWF4X3NpemUpOwpAQCAtMjQ1MSwxMCArMjQ0OCw5IEBAIFJBTUJsb2NrICpxZW11X3JhbV9h
bGxvY19pbnRlcm5hbChyYW1fYWRkcl90IHNpemUsIHJhbV9hZGRyX3QgbWF4X3NpemUsCiAgICAg
aWYgKHJlc2l6ZWFibGUpIHsKICAgICAgICAgbmV3X2Jsb2NrLT5mbGFncyB8PSBSQU1fUkVTSVpF
QUJMRTsKICAgICB9Ci0gICAgcmFtX2Jsb2NrX2FkZChuZXdfYmxvY2ssICZsb2NhbF9lcnIsIHNo
YXJlKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7CisgICAgcmFtX2Jsb2NrX2FkZChuZXdfYmxvY2ss
IGVycnAsIHNoYXJlKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ19mcmVlKG5ld19ibG9j
ayk7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogICAgICAgICBy
ZXR1cm4gTlVMTDsKICAgICB9CiAgICAgcmV0dXJuIG5ld19ibG9jazsKZGlmZiAtLWdpdCBhL2h3
LzlwZnMvOXAtbG9jYWwuYyBiL2h3LzlwZnMvOXAtbG9jYWwuYwppbmRleCAwOGU2NzNhNzljLi43
MzBkNThlOWVmIDEwMDY0NAotLS0gYS9ody85cGZzLzlwLWxvY2FsLmMKKysrIGIvaHcvOXBmcy85
cC1sb2NhbC5jCkBAIC0xNDc5LDcgKzE0NzksNiBAQCBzdGF0aWMgaW50IGxvY2FsX3BhcnNlX29w
dHMoUWVtdU9wdHMgKm9wdHMsIEZzRHJpdmVyRW50cnkgKmZzZSwgRXJyb3IgKiplcnJwKQogewog
ICAgIGNvbnN0IGNoYXIgKnNlY19tb2RlbCA9IHFlbXVfb3B0X2dldChvcHRzLCAic2VjdXJpdHlf
bW9kZWwiKTsKICAgICBjb25zdCBjaGFyICpwYXRoID0gcWVtdV9vcHRfZ2V0KG9wdHMsICJwYXRo
Iik7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICBpZiAoIXNlY19tb2RlbCkg
ewogICAgICAgICBlcnJvcl9zZXRnKGVycnAsICJzZWN1cml0eV9tb2RlbCBwcm9wZXJ0eSBub3Qg
c2V0Iik7CkBAIC0xNTA3LDkgKzE1MDYsOSBAQCBzdGF0aWMgaW50IGxvY2FsX3BhcnNlX29wdHMo
UWVtdU9wdHMgKm9wdHMsIEZzRHJpdmVyRW50cnkgKmZzZSwgRXJyb3IgKiplcnJwKQogICAgICAg
ICByZXR1cm4gLTE7CiAgICAgfQogCi0gICAgZnNkZXZfdGhyb3R0bGVfcGFyc2Vfb3B0cyhvcHRz
LCAmZnNlLT5mc3QsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAg
ZXJyb3JfcHJvcGFnYXRlX3ByZXBlbmQoZXJycCwgbG9jYWxfZXJyLAorICAgIGZzZGV2X3Rocm90
dGxlX3BhcnNlX29wdHMob3B0cywgJmZzZS0+ZnN0LCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsK
KyAgICAgICAgZXJyb3JfcHJvcGFnYXRlX3ByZXBlbmQoZXJycCwgKmVycnAsCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICJpbnZhbGlkIHRocm90dGxlIGNvbmZpZ3VyYXRpb246ICIp
OwogICAgICAgICByZXR1cm4gLTE7CiAgICAgfQpkaWZmIC0tZ2l0IGEvaHcvYWNwaS9jb3JlLmMg
Yi9ody9hY3BpL2NvcmUuYwppbmRleCA0NWNiZWQ0OWFiLi5iNjQ0NjE2Njk3IDEwMDY0NAotLS0g
YS9ody9hY3BpL2NvcmUuYworKysgYi9ody9hY3BpL2NvcmUuYwpAQCAtMjM5LDcgKzIzOSw2IEBA
IHN0YXRpYyB2b2lkIGFjcGlfdGFibGVfaW5zdGFsbChjb25zdCBjaGFyIHVuc2lnbmVkICpibG9i
LCBzaXplX3QgYmxvYmxlbiwKIHZvaWQgYWNwaV90YWJsZV9hZGQoY29uc3QgUWVtdU9wdHMgKm9w
dHMsIEVycm9yICoqZXJycCkKIHsKICAgICBBY3BpVGFibGVPcHRpb25zICpoZHJzID0gTlVMTDsK
LSAgICBFcnJvciAqZXJyID0gTlVMTDsKICAgICBjaGFyICoqcGF0aG5hbWVzID0gTlVMTDsKICAg
ICBjaGFyICoqY3VyOwogICAgIHNpemVfdCBibG9ibGVuID0gMDsKQEAgLTI0OSwyMSArMjQ4LDIx
IEBAIHZvaWQgYWNwaV90YWJsZV9hZGQoY29uc3QgUWVtdU9wdHMgKm9wdHMsIEVycm9yICoqZXJy
cCkKICAgICAgICAgVmlzaXRvciAqdjsKIAogICAgICAgICB2ID0gb3B0c192aXNpdG9yX25ldyhv
cHRzKTsKLSAgICAgICAgdmlzaXRfdHlwZV9BY3BpVGFibGVPcHRpb25zKHYsIE5VTEwsICZoZHJz
LCAmZXJyKTsKKyAgICAgICAgdmlzaXRfdHlwZV9BY3BpVGFibGVPcHRpb25zKHYsIE5VTEwsICZo
ZHJzLCBlcnJwKTsKICAgICAgICAgdmlzaXRfZnJlZSh2KTsKICAgICB9CiAKLSAgICBpZiAoZXJy
KSB7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8gb3V0OwogICAgIH0KICAgICBpZiAo
aGRycy0+aGFzX2ZpbGUgPT0gaGRycy0+aGFzX2RhdGEpIHsKLSAgICAgICAgZXJyb3Jfc2V0Zygm
ZXJyLCAiJy1hY3BpdGFibGUnIHJlcXVpcmVzIG9uZSBvZiAnZGF0YScgb3IgJ2ZpbGUnIik7Cisg
ICAgICAgIGVycm9yX3NldGcoZXJycCwgIictYWNwaXRhYmxlJyByZXF1aXJlcyBvbmUgb2YgJ2Rh
dGEnIG9yICdmaWxlJyIpOwogICAgICAgICBnb3RvIG91dDsKICAgICB9CiAKICAgICBwYXRobmFt
ZXMgPSBnX3N0cnNwbGl0KGhkcnMtPmhhc19maWxlID8gaGRycy0+ZmlsZSA6IGhkcnMtPmRhdGEs
ICI6IiwgMCk7CiAgICAgaWYgKHBhdGhuYW1lcyA9PSBOVUxMIHx8IHBhdGhuYW1lc1swXSA9PSBO
VUxMKSB7Ci0gICAgICAgIGVycm9yX3NldGcoJmVyciwgIictYWNwaXRhYmxlJyByZXF1aXJlcyBh
dCBsZWFzdCBvbmUgcGF0aG5hbWUiKTsKKyAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAiJy1hY3Bp
dGFibGUnIHJlcXVpcmVzIGF0IGxlYXN0IG9uZSBwYXRobmFtZSIpOwogICAgICAgICBnb3RvIG91
dDsKICAgICB9CiAKQEAgLTI3Miw3ICsyNzEsNyBAQCB2b2lkIGFjcGlfdGFibGVfYWRkKGNvbnN0
IFFlbXVPcHRzICpvcHRzLCBFcnJvciAqKmVycnApCiAgICAgICAgIGludCBmZCA9IG9wZW4oKmN1
ciwgT19SRE9OTFkgfCBPX0JJTkFSWSk7CiAKICAgICAgICAgaWYgKGZkIDwgMCkgewotICAgICAg
ICAgICAgZXJyb3Jfc2V0ZygmZXJyLCAiY2FuJ3Qgb3BlbiBmaWxlICVzOiAlcyIsICpjdXIsIHN0
cmVycm9yKGVycm5vKSk7CisgICAgICAgICAgICBlcnJvcl9zZXRnKGVycnAsICJjYW4ndCBvcGVu
IGZpbGUgJXM6ICVzIiwgKmN1ciwgc3RyZXJyb3IoZXJybm8pKTsKICAgICAgICAgICAgIGdvdG8g
b3V0OwogICAgICAgICB9CiAKQEAgLTI4OCw3ICsyODcsNyBAQCB2b2lkIGFjcGlfdGFibGVfYWRk
KGNvbnN0IFFlbXVPcHRzICpvcHRzLCBFcnJvciAqKmVycnApCiAgICAgICAgICAgICAgICAgbWVt
Y3B5KGJsb2IgKyBibG9ibGVuLCBkYXRhLCByKTsKICAgICAgICAgICAgICAgICBibG9ibGVuICs9
IHI7CiAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm5vICE9IEVJTlRSKSB7Ci0gICAgICAgICAg
ICAgICAgZXJyb3Jfc2V0ZygmZXJyLCAiY2FuJ3QgcmVhZCBmaWxlICVzOiAlcyIsCisgICAgICAg
ICAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAiY2FuJ3QgcmVhZCBmaWxlICVzOiAlcyIsCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAqY3VyLCBzdHJlcnJvcihlcnJubykpOwogICAgICAgICAg
ICAgICAgIGNsb3NlKGZkKTsKICAgICAgICAgICAgICAgICBnb3RvIG91dDsKQEAgLTI5OCwxNCAr
Mjk3LDEyIEBAIHZvaWQgYWNwaV90YWJsZV9hZGQoY29uc3QgUWVtdU9wdHMgKm9wdHMsIEVycm9y
ICoqZXJycCkKICAgICAgICAgY2xvc2UoZmQpOwogICAgIH0KIAotICAgIGFjcGlfdGFibGVfaW5z
dGFsbChibG9iLCBibG9ibGVuLCBoZHJzLT5oYXNfZmlsZSwgaGRycywgJmVycik7CisgICAgYWNw
aV90YWJsZV9pbnN0YWxsKGJsb2IsIGJsb2JsZW4sIGhkcnMtPmhhc19maWxlLCBoZHJzLCBlcnJw
KTsKIAogb3V0OgogICAgIGdfZnJlZShibG9iKTsKICAgICBnX3N0cmZyZWV2KHBhdGhuYW1lcyk7
CiAgICAgcWFwaV9mcmVlX0FjcGlUYWJsZU9wdGlvbnMoaGRycyk7Ci0KLSAgICBlcnJvcl9wcm9w
YWdhdGUoZXJycCwgZXJyKTsKIH0KIAogdW5zaWduZWQgYWNwaV90YWJsZV9sZW4odm9pZCAqY3Vy
cmVudCkKZGlmZiAtLWdpdCBhL2h3L2FjcGkvaWNoOS5jIGIvaHcvYWNwaS9pY2g5LmMKaW5kZXgg
MjAzNGRkNzQ5ZS4uMjMyYjU1MGZhMiAxMDA2NDQKLS0tIGEvaHcvYWNwaS9pY2g5LmMKKysrIGIv
aHcvYWNwaS9pY2g5LmMKQEAgLTM3MCwxNiArMzcwLDEzIEBAIHN0YXRpYyB2b2lkIGljaDlfcG1f
c2V0X2Rpc2FibGVfczMoT2JqZWN0ICpvYmosIFZpc2l0b3IgKnYsIGNvbnN0IGNoYXIgKm5hbWUs
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgKm9wYXF1ZSwgRXJyb3Ig
KiplcnJwKQogewogICAgIElDSDlMUENQTVJlZ3MgKnBtID0gb3BhcXVlOwotICAgIEVycm9yICps
b2NhbF9lcnIgPSBOVUxMOwogICAgIHVpbnQ4X3QgdmFsdWU7CiAKLSAgICB2aXNpdF90eXBlX3Vp
bnQ4KHYsIG5hbWUsICZ2YWx1ZSwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2Vycikgewot
ICAgICAgICBnb3RvIG91dDsKKyAgICB2aXNpdF90eXBlX3VpbnQ4KHYsIG5hbWUsICZ2YWx1ZSwg
ZXJycCk7CisgICAgaWYgKCplcnJwKSB7CisgICAgICAgIHJldHVybjsKICAgICB9CiAgICAgcG0t
PmRpc2FibGVfczMgPSB2YWx1ZTsKLW91dDoKLSAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9j
YWxfZXJyKTsKIH0KIAogc3RhdGljIHZvaWQgaWNoOV9wbV9nZXRfZGlzYWJsZV9zNChPYmplY3Qg
Km9iaiwgVmlzaXRvciAqdiwgY29uc3QgY2hhciAqbmFtZSwKQEAgLTM5NSwxNiArMzkyLDEzIEBA
IHN0YXRpYyB2b2lkIGljaDlfcG1fc2V0X2Rpc2FibGVfczQoT2JqZWN0ICpvYmosIFZpc2l0b3Ig
KnYsIGNvbnN0IGNoYXIgKm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHZvaWQgKm9wYXF1ZSwgRXJyb3IgKiplcnJwKQogewogICAgIElDSDlMUENQTVJlZ3MgKnBtID0g
b3BhcXVlOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIHVpbnQ4X3QgdmFsdWU7
CiAKLSAgICB2aXNpdF90eXBlX3VpbnQ4KHYsIG5hbWUsICZ2YWx1ZSwgJmxvY2FsX2Vycik7Ci0g
ICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBnb3RvIG91dDsKKyAgICB2aXNpdF90eXBlX3Vp
bnQ4KHYsIG5hbWUsICZ2YWx1ZSwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CisgICAgICAgIHJl
dHVybjsKICAgICB9CiAgICAgcG0tPmRpc2FibGVfczQgPSB2YWx1ZTsKLW91dDoKLSAgICBlcnJv
cl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKIH0KIAogc3RhdGljIHZvaWQgaWNoOV9wbV9n
ZXRfczRfdmFsKE9iamVjdCAqb2JqLCBWaXNpdG9yICp2LCBjb25zdCBjaGFyICpuYW1lLApAQCAt
NDIwLDE2ICs0MTQsMTMgQEAgc3RhdGljIHZvaWQgaWNoOV9wbV9zZXRfczRfdmFsKE9iamVjdCAq
b2JqLCBWaXNpdG9yICp2LCBjb25zdCBjaGFyICpuYW1lLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHZvaWQgKm9wYXF1ZSwgRXJyb3IgKiplcnJwKQogewogICAgIElDSDlMUENQTVJl
Z3MgKnBtID0gb3BhcXVlOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIHVpbnQ4
X3QgdmFsdWU7CiAKLSAgICB2aXNpdF90eXBlX3VpbnQ4KHYsIG5hbWUsICZ2YWx1ZSwgJmxvY2Fs
X2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBnb3RvIG91dDsKKyAgICB2aXNp
dF90eXBlX3VpbnQ4KHYsIG5hbWUsICZ2YWx1ZSwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7Cisg
ICAgICAgIHJldHVybjsKICAgICB9CiAgICAgcG0tPnM0X3ZhbCA9IHZhbHVlOwotb3V0OgotICAg
IGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogfQogCiBzdGF0aWMgYm9vbCBpY2g5
X3BtX2dldF9lbmFibGVfdGNvKE9iamVjdCAqb2JqLCBFcnJvciAqKmVycnApCmRpZmYgLS1naXQg
YS9ody9hY3BpL21lbW9yeV9ob3RwbHVnLmMgYi9ody9hY3BpL21lbW9yeV9ob3RwbHVnLmMKaW5k
ZXggOTQ4M2Q2NmU4Ni4uMzhmMzZhYTlkOCAxMDA2NDQKLS0tIGEvaHcvYWNwaS9tZW1vcnlfaG90
cGx1Zy5jCisrKyBiL2h3L2FjcGkvbWVtb3J5X2hvdHBsdWcuYwpAQCAtMjQxLDEyICsyNDEsMTAg
QEAgc3RhdGljIE1lbVN0YXR1cyAqCiBhY3BpX21lbW9yeV9zbG90X3N0YXR1cyhNZW1Ib3RwbHVn
U3RhdGUgKm1lbV9zdCwKICAgICAgICAgICAgICAgICAgICAgICAgIERldmljZVN0YXRlICpkZXYs
IEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBpbnQg
c2xvdCA9IG9iamVjdF9wcm9wZXJ0eV9nZXRfaW50KE9CSkVDVChkZXYpLCBQQ19ESU1NX1NMT1Rf
UFJPUCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZsb2NhbF9lcnIp
OworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJycCk7CiAKLSAgICBp
ZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIp
OworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm4gTlVMTDsKICAgICB9CiAKZGlmZiAt
LWdpdCBhL2h3L2FybS9hbGx3aW5uZXItYTEwLmMgYi9ody9hcm0vYWxsd2lubmVyLWExMC5jCmlu
ZGV4IDExODAzMmM4YzcuLjAyOTMyZmVjODggMTAwNjQ0Ci0tLSBhL2h3L2FybS9hbGx3aW5uZXIt
YTEwLmMKKysrIGIvaHcvYXJtL2FsbHdpbm5lci1hMTAuYwpAQCAtNTEsMTkgKzUxLDE2IEBAIHN0
YXRpYyB2b2lkIGF3X2ExMF9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkK
ICAgICBTeXNCdXNEZXZpY2UgKnN5c2J1c2RldjsKICAgICB1aW50OF90IGk7CiAgICAgcWVtdV9p
cnEgZmlxLCBpcnE7Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7CiAKLSAgICBvYmplY3RfcHJvcGVy
dHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5jcHUpLCB0cnVlLCAicmVhbGl6ZWQiLCAmZXJyKTsKLSAg
ICBpZiAoZXJyICE9IE5VTEwpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7
CisgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+Y3B1KSwgdHJ1ZSwgInJl
YWxpemVkIiwgZXJycCk7CisgICAgaWYgKCplcnJwICE9IE5VTEwpIHsKICAgICAgICAgcmV0dXJu
OwogICAgIH0KICAgICBpcnEgPSBxZGV2X2dldF9ncGlvX2luKERFVklDRSgmcy0+Y3B1KSwgQVJN
X0NQVV9JUlEpOwogICAgIGZpcSA9IHFkZXZfZ2V0X2dwaW9faW4oREVWSUNFKCZzLT5jcHUpLCBB
Uk1fQ1BVX0ZJUSk7CiAKLSAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5p
bnRjKSwgdHJ1ZSwgInJlYWxpemVkIiwgJmVycik7Ci0gICAgaWYgKGVyciAhPSBOVUxMKSB7Ci0g
ICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgIG9iamVjdF9wcm9wZXJ0eV9z
ZXRfYm9vbChPQkpFQ1QoJnMtPmludGMpLCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAgICBp
ZiAoKmVycnAgIT0gTlVMTCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogICAgIHN5c2J1c2Rl
diA9IFNZU19CVVNfREVWSUNFKCZzLT5pbnRjKTsKQEAgLTc0LDkgKzcxLDggQEAgc3RhdGljIHZv
aWQgYXdfYTEwX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogICAgICAg
ICBzLT5pcnFbaV0gPSBxZGV2X2dldF9ncGlvX2luKERFVklDRSgmcy0+aW50YyksIGkpOwogICAg
IH0KIAotICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPnRpbWVyKSwgdHJ1
ZSwgInJlYWxpemVkIiwgJmVycik7Ci0gICAgaWYgKGVyciAhPSBOVUxMKSB7Ci0gICAgICAgIGVy
cm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChP
QkpFQ1QoJnMtPnRpbWVyKSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgaWYgKCplcnJw
ICE9IE5VTEwpIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KICAgICBzeXNidXNkZXYgPSBTWVNf
QlVTX0RFVklDRSgmcy0+dGltZXIpOwpAQCAtOTgsMTggKzk0LDE2IEBAIHN0YXRpYyB2b2lkIGF3
X2ExMF9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAgICAgICAgcWVt
dV9jaGVja19uaWNfbW9kZWwoJm5kX3RhYmxlWzBdLCBUWVBFX0FXX0VNQUMpOwogICAgICAgICBx
ZGV2X3NldF9uaWNfcHJvcGVydGllcyhERVZJQ0UoJnMtPmVtYWMpLCAmbmRfdGFibGVbMF0pOwog
ICAgIH0KLSAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5lbWFjKSwgdHJ1
ZSwgInJlYWxpemVkIiwgJmVycik7Ci0gICAgaWYgKGVyciAhPSBOVUxMKSB7Ci0gICAgICAgIGVy
cm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChP
QkpFQ1QoJnMtPmVtYWMpLCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAgICBpZiAoKmVycnAg
IT0gTlVMTCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogICAgIHN5c2J1c2RldiA9IFNZU19C
VVNfREVWSUNFKCZzLT5lbWFjKTsKICAgICBzeXNidXNfbW1pb19tYXAoc3lzYnVzZGV2LCAwLCBB
V19BMTBfRU1BQ19CQVNFKTsKICAgICBzeXNidXNfY29ubmVjdF9pcnEoc3lzYnVzZGV2LCAwLCBz
LT5pcnFbNTVdKTsKIAotICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPnNh
dGEpLCB0cnVlLCAicmVhbGl6ZWQiLCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7Ci0gICAgICAgIGVy
cm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChP
QkpFQ1QoJnMtPnNhdGEpLCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAgICBpZiAoKmVycnAp
IHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KICAgICBzeXNidXNfbW1pb19tYXAoU1lTX0JVU19E
RVZJQ0UoJnMtPnNhdGEpLCAwLCBBV19BMTBfU0FUQV9CQVNFKTsKZGlmZiAtLWdpdCBhL2h3L2Fy
bS9hcm12N20uYyBiL2h3L2FybS9hcm12N20uYwppbmRleCA3YTNjNDhmMDAyLi4zM2FlOWFkYTkw
IDEwMDY0NAotLS0gYS9ody9hcm0vYXJtdjdtLmMKKysrIGIvaHcvYXJtL2FybXY3bS5jCkBAIC0x
NTAsNyArMTUwLDYgQEAgc3RhdGljIHZvaWQgYXJtdjdtX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRl
diwgRXJyb3IgKiplcnJwKQogewogICAgIEFSTXY3TVN0YXRlICpzID0gQVJNVjdNKGRldik7CiAg
ICAgU3lzQnVzRGV2aWNlICpzYmQ7Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7CiAgICAgaW50IGk7
CiAKICAgICBpZiAoIXMtPmJvYXJkX21lbW9yeSkgewpAQCAtMTYxLDUwICsxNjAsNDQgQEAgc3Rh
dGljIHZvaWQgYXJtdjdtX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQog
ICAgIG1lbW9yeV9yZWdpb25fYWRkX3N1YnJlZ2lvbl9vdmVybGFwKCZzLT5jb250YWluZXIsIDAs
IHMtPmJvYXJkX21lbW9yeSwgLTEpOwogCiAgICAgcy0+Y3B1ID0gQVJNX0NQVShvYmplY3RfbmV3
X3dpdGhfcHJvcHMocy0+Y3B1X3R5cGUsIE9CSkVDVChzKSwgImNwdSIsCi0gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJmVyciwgTlVMTCkpOwotICAgIGlmIChlcnIg
IT0gTlVMTCkgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJwLCBOVUxMKSk7CisgICAgaWYg
KCplcnJwICE9IE5VTEwpIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIAogICAgIG9iamVjdF9w
cm9wZXJ0eV9zZXRfbGluayhPQkpFQ1Qocy0+Y3B1KSwgT0JKRUNUKCZzLT5jb250YWluZXIpLCAi
bWVtb3J5IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJmVycm9yX2Fib3J0KTsKICAg
ICBpZiAob2JqZWN0X3Byb3BlcnR5X2ZpbmQoT0JKRUNUKHMtPmNwdSksICJpZGF1IiwgTlVMTCkp
IHsKLSAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9saW5rKE9CSkVDVChzLT5jcHUpLCBzLT5p
ZGF1LCAiaWRhdSIsICZlcnIpOwotICAgICAgICBpZiAoZXJyICE9IE5VTEwpIHsKLSAgICAgICAg
ICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgICAgICBvYmplY3RfcHJvcGVydHlf
c2V0X2xpbmsoT0JKRUNUKHMtPmNwdSksIHMtPmlkYXUsICJpZGF1IiwgZXJycCk7CisgICAgICAg
IGlmICgqZXJycCAhPSBOVUxMKSB7CiAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgIH0KICAg
ICB9CiAgICAgaWYgKG9iamVjdF9wcm9wZXJ0eV9maW5kKE9CSkVDVChzLT5jcHUpLCAiaW5pdC1z
dnRvciIsIE5VTEwpKSB7CiAgICAgICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfdWludChPQkpFQ1Qo
cy0+Y3B1KSwgcy0+aW5pdF9zdnRvciwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICJpbml0LXN2dG9yIiwgJmVycik7Ci0gICAgICAgIGlmIChlcnIgIT0gTlVMTCkgewotICAgICAg
ICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAiaW5pdC1zdnRvciIsIGVycnApOworICAgICAgICBpZiAoKmVycnAgIT0gTlVM
TCkgewogICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgfQogICAgIGlmIChvYmpl
Y3RfcHJvcGVydHlfZmluZChPQkpFQ1Qocy0+Y3B1KSwgInN0YXJ0LXBvd2VyZWQtb2ZmIiwgTlVM
TCkpIHsKICAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVChzLT5jcHUpLCBz
LT5zdGFydF9wb3dlcmVkX29mZiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJz
dGFydC1wb3dlcmVkLW9mZiIsICZlcnIpOwotICAgICAgICBpZiAoZXJyICE9IE5VTEwpIHsKLSAg
ICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgInN0YXJ0LXBvd2VyZWQtb2ZmIiwgZXJycCk7CisgICAgICAgIGlmICgq
ZXJycCAhPSBOVUxMKSB7CiAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgIH0KICAgICB9CiAg
ICAgaWYgKG9iamVjdF9wcm9wZXJ0eV9maW5kKE9CSkVDVChzLT5jcHUpLCAidmZwIiwgTlVMTCkp
IHsKICAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVChzLT5jcHUpLCBzLT52
ZnAsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmZwIiwgJmVycik7Ci0gICAg
ICAgIGlmIChlcnIgIT0gTlVMTCkgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAs
IGVycik7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmZwIiwgZXJycCk7Cisg
ICAgICAgIGlmICgqZXJycCAhPSBOVUxMKSB7CiAgICAgICAgICAgICByZXR1cm47CiAgICAgICAg
IH0KICAgICB9CiAgICAgaWYgKG9iamVjdF9wcm9wZXJ0eV9maW5kKE9CSkVDVChzLT5jcHUpLCAi
ZHNwIiwgTlVMTCkpIHsKICAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVChz
LT5jcHUpLCBzLT5kc3AsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZHNwIiwg
JmVycik7Ci0gICAgICAgIGlmIChlcnIgIT0gTlVMTCkgewotICAgICAgICAgICAgZXJyb3JfcHJv
cGFnYXRlKGVycnAsIGVycik7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZHNw
IiwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCAhPSBOVUxMKSB7CiAgICAgICAgICAgICByZXR1
cm47CiAgICAgICAgIH0KICAgICB9CkBAIC0yMTYsMTYgKzIwOSwxNCBAQCBzdGF0aWMgdm9pZCBh
cm12N21fcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgcy0+Y3B1
LT5lbnYubnZpYyA9ICZzLT5udmljOwogICAgIHMtPm52aWMuY3B1ID0gcy0+Y3B1OwogCi0gICAg
b2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVChzLT5jcHUpLCB0cnVlLCAicmVhbGl6ZWQi
LCAmZXJyKTsKLSAgICBpZiAoZXJyICE9IE5VTEwpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRl
KGVycnAsIGVycik7CisgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVChzLT5jcHUp
LCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAgICBpZiAoKmVycnAgIT0gTlVMTCkgewogICAg
ICAgICByZXR1cm47CiAgICAgfQogCiAgICAgLyogTm90ZSB0aGF0IHdlIG11c3QgcmVhbGl6ZSB0
aGUgTlZJQyBhZnRlciB0aGUgQ1BVICovCi0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9C
SkVDVCgmcy0+bnZpYyksIHRydWUsICJyZWFsaXplZCIsICZlcnIpOwotICAgIGlmIChlcnIgIT0g
TlVMTCkgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICBvYmplY3Rf
cHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5udmljKSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJy
cCk7CisgICAgaWYgKCplcnJwICE9IE5VTEwpIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApA
QCAtMjUwLDE2ICsyNDEsMTQgQEAgc3RhdGljIHZvaWQgYXJtdjdtX3JlYWxpemUoRGV2aWNlU3Rh
dGUgKmRldiwgRXJyb3IgKiplcnJwKQogICAgICAgICAgICAgT2JqZWN0ICpvYmogPSBPQkpFQ1Qo
JnMtPmJpdGJhbmRbaV0pOwogICAgICAgICAgICAgU3lzQnVzRGV2aWNlICpzYmQgPSBTWVNfQlVT
X0RFVklDRSgmcy0+Yml0YmFuZFtpXSk7CiAKLSAgICAgICAgICAgIG9iamVjdF9wcm9wZXJ0eV9z
ZXRfaW50KG9iaiwgYml0YmFuZF9pbnB1dF9hZGRyW2ldLCAiYmFzZSIsICZlcnIpOwotICAgICAg
ICAgICAgaWYgKGVyciAhPSBOVUxMKSB7Ci0gICAgICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRl
KGVycnAsIGVycik7CisgICAgICAgICAgICBvYmplY3RfcHJvcGVydHlfc2V0X2ludChvYmosIGJp
dGJhbmRfaW5wdXRfYWRkcltpXSwgImJhc2UiLCBlcnJwKTsKKyAgICAgICAgICAgIGlmICgqZXJy
cCAhPSBOVUxMKSB7CiAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgfQogICAg
ICAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9saW5rKG9iaiwgT0JKRUNUKHMtPmJvYXJkX21l
bW9yeSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInNvdXJjZS1tZW1v
cnkiLCAmZXJyb3JfYWJvcnQpOwotICAgICAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29s
KG9iaiwgdHJ1ZSwgInJlYWxpemVkIiwgJmVycik7Ci0gICAgICAgICAgICBpZiAoZXJyICE9IE5V
TEwpIHsKLSAgICAgICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAg
ICAgICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChvYmosIHRydWUsICJyZWFsaXplZCIsIGVy
cnApOworICAgICAgICAgICAgaWYgKCplcnJwICE9IE5VTEwpIHsKICAgICAgICAgICAgICAgICBy
ZXR1cm47CiAgICAgICAgICAgICB9CiAKZGlmZiAtLWdpdCBhL2h3L2FybS9iY20yODM1X3Blcmlw
aGVyYWxzLmMgYi9ody9hcm0vYmNtMjgzNV9wZXJpcGhlcmFscy5jCmluZGV4IDg5ODRlMmU5MWYu
LjAzMDEzMjJmN2IgMTAwNjQ0Ci0tLSBhL2h3L2FybS9iY20yODM1X3BlcmlwaGVyYWxzLmMKKysr
IGIvaHcvYXJtL2JjbTI4MzVfcGVyaXBoZXJhbHMuYwpAQCAtMTEyLDE0ICsxMTIsMTMgQEAgc3Rh
dGljIHZvaWQgYmNtMjgzNV9wZXJpcGhlcmFsc19yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVy
cm9yICoqZXJycCkKICAgICBCQ00yODM1UGVyaXBoZXJhbFN0YXRlICpzID0gQkNNMjgzNV9QRVJJ
UEhFUkFMUyhkZXYpOwogICAgIE9iamVjdCAqb2JqOwogICAgIE1lbW9yeVJlZ2lvbiAqcmFtOwot
ICAgIEVycm9yICplcnIgPSBOVUxMOwogICAgIHVpbnQ2NF90IHJhbV9zaXplLCB2Y3JhbV9zaXpl
OwogICAgIGludCBuOwogCi0gICAgb2JqID0gb2JqZWN0X3Byb3BlcnR5X2dldF9saW5rKE9CSkVD
VChkZXYpLCAicmFtIiwgJmVycik7CisgICAgb2JqID0gb2JqZWN0X3Byb3BlcnR5X2dldF9saW5r
KE9CSkVDVChkZXYpLCAicmFtIiwgZXJycCk7CiAgICAgaWYgKG9iaiA9PSBOVUxMKSB7CiAgICAg
ICAgIGVycm9yX3NldGcoZXJycCwgIiVzOiByZXF1aXJlZCByYW0gbGluayBub3QgZm91bmQ6ICVz
IiwKLSAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgZXJyb3JfZ2V0X3ByZXR0eShlcnIpKTsK
KyAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgZXJyb3JfZ2V0X3ByZXR0eSgqZXJycCkpOwog
ICAgICAgICByZXR1cm47CiAgICAgfQogCkBAIC0xNDMsOSArMTQyLDggQEAgc3RhdGljIHZvaWQg
YmNtMjgzNV9wZXJpcGhlcmFsc19yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJy
cCkKICAgICB9CiAKICAgICAvKiBJbnRlcnJ1cHQgQ29udHJvbGxlciAqLwotICAgIG9iamVjdF9w
cm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPmljKSwgdHJ1ZSwgInJlYWxpemVkIiwgJmVycik7
Ci0gICAgaWYgKGVycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAg
ICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5pYyksIHRydWUsICJyZWFsaXpl
ZCIsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCkBA
IC0xNTUsOSArMTUzLDggQEAgc3RhdGljIHZvaWQgYmNtMjgzNV9wZXJpcGhlcmFsc19yZWFsaXpl
KERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKIAogICAgIC8qIFVBUlQwICovCiAgICAg
cWRldl9wcm9wX3NldF9jaHIoREVWSUNFKCZzLT51YXJ0MCksICJjaGFyZGV2Iiwgc2VyaWFsX2hk
KDApKTsKLSAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT51YXJ0MCksIHRy
dWUsICJyZWFsaXplZCIsICZlcnIpOwotICAgIGlmIChlcnIpIHsKLSAgICAgICAgZXJyb3JfcHJv
cGFnYXRlKGVycnAsIGVycik7CisgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgm
cy0+dWFydDApLCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAg
ICAgICAgcmV0dXJuOwogICAgIH0KIApAQCAtMTY5LDkgKzE2Niw4IEBAIHN0YXRpYyB2b2lkIGJj
bTI4MzVfcGVyaXBoZXJhbHNfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnAp
CiAgICAgLyogQVVYIC8gVUFSVDEgKi8KICAgICBxZGV2X3Byb3Bfc2V0X2NocihERVZJQ0UoJnMt
PmF1eCksICJjaGFyZGV2Iiwgc2VyaWFsX2hkKDEpKTsKIAotICAgIG9iamVjdF9wcm9wZXJ0eV9z
ZXRfYm9vbChPQkpFQ1QoJnMtPmF1eCksIHRydWUsICJyZWFsaXplZCIsICZlcnIpOwotICAgIGlm
IChlcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgb2JqZWN0
X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+YXV4KSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJy
cCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKQEAgLTE4Miw5
ICsxNzgsOCBAQCBzdGF0aWMgdm9pZCBiY20yODM1X3BlcmlwaGVyYWxzX3JlYWxpemUoRGV2aWNl
U3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IElOVEVSUlVQVF9BVVgpKTsKIAogICAgIC8qIE1haWxib3hlcyAqLwotICAgIG9iamVjdF9wcm9w
ZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPm1ib3hlcyksIHRydWUsICJyZWFsaXplZCIsICZlcnIp
OwotICAgIGlmIChlcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7Cisg
ICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+bWJveGVzKSwgdHJ1ZSwgInJl
YWxpemVkIiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9
CiAKQEAgLTE5NSwyMiArMTkwLDE5IEBAIHN0YXRpYyB2b2lkIGJjbTI4MzVfcGVyaXBoZXJhbHNf
cmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgSU5URVJSVVBUX0FSTV9NQUlMQk9YKSk7CiAKICAgICAvKiBGcmFtZWJ1
ZmZlciAqLwotICAgIHZjcmFtX3NpemUgPSBvYmplY3RfcHJvcGVydHlfZ2V0X3VpbnQoT0JKRUNU
KHMpLCAidmNyYW0tc2l6ZSIsICZlcnIpOwotICAgIGlmIChlcnIpIHsKLSAgICAgICAgZXJyb3Jf
cHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgdmNyYW1fc2l6ZSA9IG9iamVjdF9wcm9wZXJ0eV9n
ZXRfdWludChPQkpFQ1QocyksICJ2Y3JhbS1zaXplIiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7
CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKICAgICBvYmplY3RfcHJvcGVydHlfc2V0X3VpbnQo
T0JKRUNUKCZzLT5mYiksIHJhbV9zaXplIC0gdmNyYW1fc2l6ZSwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgInZjcmFtLWJhc2UiLCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7Ci0gICAgICAg
IGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAidmNyYW0tYmFzZSIsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47
CiAgICAgfQogCi0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+ZmIpLCB0
cnVlLCAicmVhbGl6ZWQiLCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7Ci0gICAgICAgIGVycm9yX3By
b3BhZ2F0ZShlcnJwLCBlcnIpOworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1Qo
JnMtPmZiKSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAg
ICAgIHJldHVybjsKICAgICB9CiAKQEAgLTIyMCw5ICsyMTIsOCBAQCBzdGF0aWMgdm9pZCBiY20y
ODM1X3BlcmlwaGVyYWxzX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQog
ICAgICAgICAgICAgICAgICAgICAgICBxZGV2X2dldF9ncGlvX2luKERFVklDRSgmcy0+bWJveGVz
KSwgTUJPWF9DSEFOX0ZCKSk7CiAKICAgICAvKiBQcm9wZXJ0eSBjaGFubmVsICovCi0gICAgb2Jq
ZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+cHJvcGVydHkpLCB0cnVlLCAicmVhbGl6
ZWQiLCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJw
LCBlcnIpOworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPnByb3BlcnR5
KSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJl
dHVybjsKICAgICB9CiAKQEAgLTIzMyw5ICsyMjQsOCBAQCBzdGF0aWMgdm9pZCBiY20yODM1X3Bl
cmlwaGVyYWxzX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogICAgICAg
ICAgICAgICAgICAgICAgIHFkZXZfZ2V0X2dwaW9faW4oREVWSUNFKCZzLT5tYm94ZXMpLCBNQk9Y
X0NIQU5fUFJPUEVSVFkpKTsKIAogICAgIC8qIFJhbmRvbSBOdW1iZXIgR2VuZXJhdG9yICovCi0g
ICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+cm5nKSwgdHJ1ZSwgInJlYWxp
emVkIiwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJy
cCwgZXJyKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5ybmcpLCB0
cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJu
OwogICAgIH0KIApAQCAtMjUyLDE5ICsyNDIsMTcgQEAgc3RhdGljIHZvaWQgYmNtMjgzNV9wZXJp
cGhlcmFsc19yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAgICAgKiBG
b3IgdGhlIGV4YWN0IGRldGFpbHMgcGxlYXNlIHJlZmVyIHRvIHRoZSBBcmFzYW4gZG9jdW1lbnRh
dGlvbjoKICAgICAgKiAgIFNEMy4wX0hvc3RfQUhCX2VNTUM0LjRfVXNlcnNndWlkZV92ZXI1Ljlf
amFuMTFfMTAucGRmCiAgICAgICovCi0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF91aW50KE9CSkVD
VCgmcy0+c2RoY2kpLCAzLCAic2Qtc3BlYy12ZXJzaW9uIiwgJmVycik7CisgICAgb2JqZWN0X3By
b3BlcnR5X3NldF91aW50KE9CSkVDVCgmcy0+c2RoY2kpLCAzLCAic2Qtc3BlYy12ZXJzaW9uIiwg
ZXJycCk7CiAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF91aW50KE9CSkVDVCgmcy0+c2RoY2kpLCBC
Q00yODM1X1NESENfQ0FQQVJFRywgImNhcGFyZWciLAotICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAmZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJycCk7CiAgICAgb2Jq
ZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+c2RoY2kpLCB0cnVlLCAicGVuZGluZy1p
bnNlcnQtcXVpcmsiLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmZXJyKTsKLSAgICBp
ZiAoZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0
dXJuOwogICAgIH0KIAotICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPnNk
aGNpKSwgdHJ1ZSwgInJlYWxpemVkIiwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBl
cnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2wo
T0JKRUNUKCZzLT5zZGhjaSksIHRydWUsICJyZWFsaXplZCIsIGVycnApOworICAgIGlmICgqZXJy
cCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCkBAIC0yNzUsOSArMjYzLDggQEAgc3RhdGlj
IHZvaWQgYmNtMjgzNV9wZXJpcGhlcmFsc19yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9y
ICoqZXJycCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJTlRFUlJVUFRfQVJBU0FO
U0RJTykpOwogCiAgICAgLyogU0RIT1NUICovCi0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29s
KE9CSkVDVCgmcy0+c2Rob3N0KSwgdHJ1ZSwgInJlYWxpemVkIiwgJmVycik7Ci0gICAgaWYgKGVy
cikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICBvYmplY3RfcHJv
cGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5zZGhvc3QpLCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJw
KTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApAQCAtMjg4LDkg
KzI3NSw4IEBAIHN0YXRpYyB2b2lkIGJjbTI4MzVfcGVyaXBoZXJhbHNfcmVhbGl6ZShEZXZpY2VT
dGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
SU5URVJSVVBUX1NESU8pKTsKIAogICAgIC8qIERNQSBDaGFubmVscyAqLwotICAgIG9iamVjdF9w
cm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPmRtYSksIHRydWUsICJyZWFsaXplZCIsICZlcnIp
OwotICAgIGlmIChlcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7Cisg
ICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+ZG1hKSwgdHJ1ZSwgInJlYWxp
emVkIiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAK
QEAgLTMwNyw5ICsyOTMsOCBAQCBzdGF0aWMgdm9pZCBiY20yODM1X3BlcmlwaGVyYWxzX3JlYWxp
emUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogICAgIH0KIAogICAgIC8qIEdQSU8g
Ki8KLSAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5ncGlvKSwgdHJ1ZSwg
InJlYWxpemVkIiwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBlcnJvcl9wcm9wYWdh
dGUoZXJycCwgZXJyKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5n
cGlvKSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAg
IHJldHVybjsKICAgICB9CiAKQEAgLTMxNyw5ICszMDIsOCBAQCBzdGF0aWMgdm9pZCBiY20yODM1
X3BlcmlwaGVyYWxzX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogICAg
ICAgICAgICAgICAgIHN5c2J1c19tbWlvX2dldF9yZWdpb24oU1lTX0JVU19ERVZJQ0UoJnMtPmdw
aW8pLCAwKSk7CiAKICAgICBvYmplY3RfcHJvcGVydHlfYWRkX2FsaWFzKE9CSkVDVChzKSwgInNk
LWJ1cyIsIE9CSkVDVCgmcy0+Z3BpbyksICJzZC1idXMiLAotICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUo
ZXJycCwgZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycnApOworICAgIGlm
ICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogfQpkaWZmIC0tZ2l0IGEvaHcvYXJt
L2JjbTI4MzYuYyBiL2h3L2FybS9iY20yODM2LmMKaW5kZXggNDkzYTkxM2Y4OS4uY2Q2MDVlYjUz
ZCAxMDA2NDQKLS0tIGEvaHcvYXJtL2JjbTI4MzYuYworKysgYi9ody9hcm0vYmNtMjgzNi5jCkBA
IC03MiwzNCArNzIsMzAgQEAgc3RhdGljIHZvaWQgYmNtMjgzNl9yZWFsaXplKERldmljZVN0YXRl
ICpkZXYsIEVycm9yICoqZXJycCkKICAgICBCQ00yODNYQ2xhc3MgKmJjID0gQkNNMjgzWF9HRVRf
Q0xBU1MoZGV2KTsKICAgICBjb25zdCBCQ00yODNYSW5mbyAqaW5mbyA9IGJjLT5pbmZvOwogICAg
IE9iamVjdCAqb2JqOwotICAgIEVycm9yICplcnIgPSBOVUxMOwogICAgIGludCBuOwogCiAgICAg
LyogY29tbW9uIHBlcmlwaGVyYWxzIGZyb20gYmNtMjgzNSAqLwogCi0gICAgb2JqID0gb2JqZWN0
X3Byb3BlcnR5X2dldF9saW5rKE9CSkVDVChkZXYpLCAicmFtIiwgJmVycik7CisgICAgb2JqID0g
b2JqZWN0X3Byb3BlcnR5X2dldF9saW5rKE9CSkVDVChkZXYpLCAicmFtIiwgZXJycCk7CiAgICAg
aWYgKG9iaiA9PSBOVUxMKSB7CiAgICAgICAgIGVycm9yX3NldGcoZXJycCwgIiVzOiByZXF1aXJl
ZCByYW0gbGluayBub3QgZm91bmQ6ICVzIiwKLSAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywg
ZXJyb3JfZ2V0X3ByZXR0eShlcnIpKTsKKyAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgZXJy
b3JfZ2V0X3ByZXR0eSgqZXJycCkpOwogICAgICAgICByZXR1cm47CiAgICAgfQogCi0gICAgb2Jq
ZWN0X3Byb3BlcnR5X2FkZF9jb25zdF9saW5rKE9CSkVDVCgmcy0+cGVyaXBoZXJhbHMpLCAicmFt
Iiwgb2JqLCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShl
cnJwLCBlcnIpOworICAgIG9iamVjdF9wcm9wZXJ0eV9hZGRfY29uc3RfbGluayhPQkpFQ1QoJnMt
PnBlcmlwaGVyYWxzKSwgInJhbSIsIG9iaiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAg
ICAgIHJldHVybjsKICAgICB9CiAKLSAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNU
KCZzLT5wZXJpcGhlcmFscyksIHRydWUsICJyZWFsaXplZCIsICZlcnIpOwotICAgIGlmIChlcnIp
IHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgb2JqZWN0X3Byb3Bl
cnR5X3NldF9ib29sKE9CSkVDVCgmcy0+cGVyaXBoZXJhbHMpLCB0cnVlLCAicmVhbGl6ZWQiLCBl
cnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIAogICAgIG9i
amVjdF9wcm9wZXJ0eV9hZGRfYWxpYXMoT0JKRUNUKHMpLCAic2QtYnVzIiwgT0JKRUNUKCZzLT5w
ZXJpcGhlcmFscyksCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAic2QtYnVzIiwgJmVy
cik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzZC1idXMiLCBlcnJwKTsKKyAgICBpZiAo
KmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApAQCAtMTA3LDkgKzEwMyw4IEBAIHN0
YXRpYyB2b2lkIGJjbTI4MzZfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnAp
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQkNNMjgzNl9QRVJJX0JBU0UsIDEpOwogCiAg
ICAgLyogYmNtMjgzNiBpbnRlcnJ1cHQgY29udHJvbGxlciAoYW5kIG1haWxib3hlcywgZXRjLikg
Ki8KLSAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5jb250cm9sKSwgdHJ1
ZSwgInJlYWxpemVkIiwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBlcnJvcl9wcm9w
YWdhdGUoZXJycCwgZXJyKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZz
LT5jb250cm9sKSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAg
ICAgICAgIHJldHVybjsKICAgICB9CiAKQEAgLTEyNywyMyArMTIyLDIwIEBAIHN0YXRpYyB2b2lk
IGJjbTI4MzZfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgICAg
IC8qIHNldCBwZXJpcGhiYXNlL0NCQVIgdmFsdWUgZm9yIENQVS1sb2NhbCByZWdpc3RlcnMgKi8K
ICAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9pbnQoT0JKRUNUKCZzLT5jcHVzW25dKSwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQkNNMjgzNl9QRVJJX0JBU0UgKyBNQ09SRV9P
RkZTRVQsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJyZXNldC1jYmFyIiwgJmVy
cik7Ci0gICAgICAgIGlmIChlcnIpIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJw
LCBlcnIpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicmVzZXQtY2JhciIsIGVy
cnApOworICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAg
fQogCiAgICAgICAgIC8qIHN0YXJ0IHBvd2VyZWQgb2ZmIGlmIG5vdCBlbmFibGVkICovCiAgICAg
ICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPmNwdXNbbl0pLCBuID49IHMt
PmVuYWJsZWRfY3B1cywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzdGFydC1w
b3dlcmVkLW9mZiIsICZlcnIpOwotICAgICAgICBpZiAoZXJyKSB7Ci0gICAgICAgICAgICBlcnJv
cl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICJzdGFydC1wb3dlcmVkLW9mZiIsIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKICAgICAg
ICAgICAgIHJldHVybjsKICAgICAgICAgfQogCi0gICAgICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRf
Ym9vbChPQkpFQ1QoJnMtPmNwdXNbbl0pLCB0cnVlLCAicmVhbGl6ZWQiLCAmZXJyKTsKLSAgICAg
ICAgaWYgKGVycikgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7Cisg
ICAgICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPmNwdXNbbl0pLCB0cnVl
LCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICBy
ZXR1cm47CiAgICAgICAgIH0KIApkaWZmIC0tZ2l0IGEvaHcvYXJtL2RpZ2ljLmMgYi9ody9hcm0v
ZGlnaWMuYwppbmRleCAyMjQzNGE2NWEyLi4wMjRhYTEwNTA5IDEwMDY0NAotLS0gYS9ody9hcm0v
ZGlnaWMuYworKysgYi9ody9hcm0vZGlnaWMuYwpAQCAtNTYsMjYgKzU2LDIyIEBAIHN0YXRpYyB2
b2lkIGRpZ2ljX2luaXQoT2JqZWN0ICpvYmopCiBzdGF0aWMgdm9pZCBkaWdpY19yZWFsaXplKERl
dmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKIHsKICAgICBEaWdpY1N0YXRlICpzID0gRElH
SUMoZGV2KTsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKICAgICBTeXNCdXNEZXZpY2UgKnNiZDsK
ICAgICBpbnQgaTsKIAotICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPmNw
dSksIHRydWUsICJyZXNldC1oaXZlY3MiLCAmZXJyKTsKLSAgICBpZiAoZXJyICE9IE5VTEwpIHsK
LSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgb2JqZWN0X3Byb3BlcnR5
X3NldF9ib29sKE9CSkVDVCgmcy0+Y3B1KSwgdHJ1ZSwgInJlc2V0LWhpdmVjcyIsIGVycnApOwor
ICAgIGlmICgqZXJycCAhPSBOVUxMKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKLSAgICBv
YmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5jcHUpLCB0cnVlLCAicmVhbGl6ZWQi
LCAmZXJyKTsKLSAgICBpZiAoZXJyICE9IE5VTEwpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRl
KGVycnAsIGVycik7CisgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+Y3B1
KSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgaWYgKCplcnJwICE9IE5VTEwpIHsKICAg
ICAgICAgcmV0dXJuOwogICAgIH0KIAogICAgIGZvciAoaSA9IDA7IGkgPCBESUdJQzRfTkJfVElN
RVJTOyBpKyspIHsKLSAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+
dGltZXJbaV0pLCB0cnVlLCAicmVhbGl6ZWQiLCAmZXJyKTsKLSAgICAgICAgaWYgKGVyciAhPSBO
VUxMKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAg
b2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+dGltZXJbaV0pLCB0cnVlLCAicmVh
bGl6ZWQiLCBlcnJwKTsKKyAgICAgICAgaWYgKCplcnJwICE9IE5VTEwpIHsKICAgICAgICAgICAg
IHJldHVybjsKICAgICAgICAgfQogCkBAIC04NCw5ICs4MCw4IEBAIHN0YXRpYyB2b2lkIGRpZ2lj
X3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogICAgIH0KIAogICAgIHFk
ZXZfcHJvcF9zZXRfY2hyKERFVklDRSgmcy0+dWFydCksICJjaGFyZGV2Iiwgc2VyaWFsX2hkKDAp
KTsKLSAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT51YXJ0KSwgdHJ1ZSwg
InJlYWxpemVkIiwgJmVycik7Ci0gICAgaWYgKGVyciAhPSBOVUxMKSB7Ci0gICAgICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpF
Q1QoJnMtPnVhcnQpLCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAgICBpZiAoKmVycnAgIT0g
TlVMTCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCmRpZmYgLS1naXQgYS9ody9hcm0vZnNs
LWlteDI1LmMgYi9ody9hcm0vZnNsLWlteDI1LmMKaW5kZXggM2NiNWE4ZmRmZC4uMmE4YWE4ZDE4
OCAxMDA2NDQKLS0tIGEvaHcvYXJtL2ZzbC1pbXgyNS5jCisrKyBiL2h3L2FybS9mc2wtaW14MjUu
YwpAQCAtNzcsMTcgKzc3LDE0IEBAIHN0YXRpYyB2b2lkIGZzbF9pbXgyNV9yZWFsaXplKERldmlj
ZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKIHsKICAgICBGc2xJTVgyNVN0YXRlICpzID0gRlNM
X0lNWDI1KGRldik7CiAgICAgdWludDhfdCBpOwotICAgIEVycm9yICplcnIgPSBOVUxMOwogCi0g
ICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+Y3B1KSwgdHJ1ZSwgInJlYWxp
emVkIiwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJy
cCwgZXJyKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5jcHUpLCB0
cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJu
OwogICAgIH0KIAotICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPmF2aWMp
LCB0cnVlLCAicmVhbGl6ZWQiLCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7Ci0gICAgICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpF
Q1QoJnMtPmF2aWMpLCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsK
ICAgICAgICAgcmV0dXJuOwogICAgIH0KICAgICBzeXNidXNfbW1pb19tYXAoU1lTX0JVU19ERVZJ
Q0UoJnMtPmF2aWMpLCAwLCBGU0xfSU1YMjVfQVZJQ19BRERSKTsKQEAgLTk2LDkgKzkzLDggQEAg
c3RhdGljIHZvaWQgZnNsX2lteDI1X3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKipl
cnJwKQogICAgIHN5c2J1c19jb25uZWN0X2lycShTWVNfQlVTX0RFVklDRSgmcy0+YXZpYyksIDEs
CiAgICAgICAgICAgICAgICAgICAgICAgIHFkZXZfZ2V0X2dwaW9faW4oREVWSUNFKCZzLT5jcHUp
LCBBUk1fQ1BVX0ZJUSkpOwogCi0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgm
cy0+Y2NtKSwgdHJ1ZSwgInJlYWxpemVkIiwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAg
ICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jv
b2woT0JKRUNUKCZzLT5jY20pLCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAgICBpZiAoKmVy
cnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KICAgICBzeXNidXNfbW1pb19tYXAoU1lTX0JV
U19ERVZJQ0UoJnMtPmNjbSksIDAsIEZTTF9JTVgyNV9DQ01fQUREUik7CkBAIC0xMTgsOSArMTE0
LDggQEAgc3RhdGljIHZvaWQgZnNsX2lteDI1X3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJy
b3IgKiplcnJwKQogCiAgICAgICAgIHFkZXZfcHJvcF9zZXRfY2hyKERFVklDRSgmcy0+dWFydFtp
XSksICJjaGFyZGV2Iiwgc2VyaWFsX2hkKGkpKTsKIAotICAgICAgICBvYmplY3RfcHJvcGVydHlf
c2V0X2Jvb2woT0JKRUNUKCZzLT51YXJ0W2ldKSwgdHJ1ZSwgInJlYWxpemVkIiwgJmVycik7Ci0g
ICAgICAgIGlmIChlcnIpIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIp
OworICAgICAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT51YXJ0W2ldKSwg
dHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAg
ICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgICAgIHN5c2J1c19tbWlvX21hcChTWVNfQlVTX0RF
VklDRSgmcy0+dWFydFtpXSksIDAsIHNlcmlhbF90YWJsZVtpXS5hZGRyKTsKQEAgLTE0Myw5ICsx
MzgsOCBAQCBzdGF0aWMgdm9pZCBmc2xfaW14MjVfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBF
cnJvciAqKmVycnApCiAKICAgICAgICAgcy0+Z3B0W2ldLmNjbSA9IElNWF9DQ00oJnMtPmNjbSk7
CiAKLSAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+Z3B0W2ldKSwg
dHJ1ZSwgInJlYWxpemVkIiwgJmVycik7Ci0gICAgICAgIGlmIChlcnIpIHsKLSAgICAgICAgICAg
IGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgICAgICBvYmplY3RfcHJvcGVydHlfc2V0
X2Jvb2woT0JKRUNUKCZzLT5ncHRbaV0pLCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAgICAg
ICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgIH0KICAgICAgICAg
c3lzYnVzX21taW9fbWFwKFNZU19CVVNfREVWSUNFKCZzLT5ncHRbaV0pLCAwLCBncHRfdGFibGVb
aV0uYWRkcik7CkBAIC0xNjYsOSArMTYwLDggQEAgc3RhdGljIHZvaWQgZnNsX2lteDI1X3JlYWxp
emUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogCiAgICAgICAgIHMtPmVwaXRbaV0u
Y2NtID0gSU1YX0NDTSgmcy0+Y2NtKTsKIAotICAgICAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jv
b2woT0JKRUNUKCZzLT5lcGl0W2ldKSwgdHJ1ZSwgInJlYWxpemVkIiwgJmVycik7Ci0gICAgICAg
IGlmIChlcnIpIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAg
ICAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5lcGl0W2ldKSwgdHJ1ZSwg
InJlYWxpemVkIiwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgcmV0
dXJuOwogICAgICAgICB9CiAgICAgICAgIHN5c2J1c19tbWlvX21hcChTWVNfQlVTX0RFVklDRSgm
cy0+ZXBpdFtpXSksIDAsIGVwaXRfdGFibGVbaV0uYWRkcik7CkBAIC0xNzksOSArMTcyLDggQEAg
c3RhdGljIHZvaWQgZnNsX2lteDI1X3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKipl
cnJwKQogCiAgICAgcWRldl9zZXRfbmljX3Byb3BlcnRpZXMoREVWSUNFKCZzLT5mZWMpLCAmbmRf
dGFibGVbMF0pOwogCi0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+ZmVj
KSwgdHJ1ZSwgInJlYWxpemVkIiwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBlcnJv
cl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JK
RUNUKCZzLT5mZWMpLCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsK
ICAgICAgICAgcmV0dXJuOwogICAgIH0KICAgICBzeXNidXNfbW1pb19tYXAoU1lTX0JVU19ERVZJ
Q0UoJnMtPmZlYyksIDAsIEZTTF9JTVgyNV9GRUNfQUREUik7CkBAIC0yMDAsOSArMTkyLDggQEAg
c3RhdGljIHZvaWQgZnNsX2lteDI1X3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKipl
cnJwKQogICAgICAgICAgICAgeyBGU0xfSU1YMjVfSTJDM19BRERSLCBGU0xfSU1YMjVfSTJDM19J
UlEgfQogICAgICAgICB9OwogCi0gICAgICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpF
Q1QoJnMtPmkyY1tpXSksIHRydWUsICJyZWFsaXplZCIsICZlcnIpOwotICAgICAgICBpZiAoZXJy
KSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgb2Jq
ZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+aTJjW2ldKSwgdHJ1ZSwgInJlYWxpemVk
IiwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgcmV0dXJuOwogICAg
ICAgICB9CiAgICAgICAgIHN5c2J1c19tbWlvX21hcChTWVNfQlVTX0RFVklDRSgmcy0+aTJjW2ld
KSwgMCwgaTJjX3RhYmxlW2ldLmFkZHIpOwpAQCAtMjIzLDkgKzIxNCw4IEBAIHN0YXRpYyB2b2lk
IGZzbF9pbXgyNV9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAgICAg
ICAgICAgIHsgRlNMX0lNWDI1X0dQSU80X0FERFIsIEZTTF9JTVgyNV9HUElPNF9JUlEgfQogICAg
ICAgICB9OwogCi0gICAgICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPmdw
aW9baV0pLCB0cnVlLCAicmVhbGl6ZWQiLCAmZXJyKTsKLSAgICAgICAgaWYgKGVycikgewotICAg
ICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgICAgIG9iamVjdF9wcm9w
ZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPmdwaW9baV0pLCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJw
KTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgIH0K
ICAgICAgICAgc3lzYnVzX21taW9fbWFwKFNZU19CVVNfREVWSUNFKCZzLT5ncGlvW2ldKSwgMCwg
Z3Bpb190YWJsZVtpXS5hZGRyKTsKQEAgLTIzNywxNyArMjI3LDE1IEBAIHN0YXRpYyB2b2lkIGZz
bF9pbXgyNV9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKIAogICAgIC8q
IGluaXRpYWxpemUgMiB4IDE2IEtCIFJPTSAqLwogICAgIG1lbW9yeV9yZWdpb25faW5pdF9yb20o
JnMtPnJvbVswXSwgTlVMTCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICJpbXgyNS5yb20w
IiwgRlNMX0lNWDI1X1JPTTBfU0laRSwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBl
cnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICJp
bXgyNS5yb20wIiwgRlNMX0lNWDI1X1JPTTBfU0laRSwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7
CiAgICAgICAgIHJldHVybjsKICAgICB9CiAgICAgbWVtb3J5X3JlZ2lvbl9hZGRfc3VicmVnaW9u
KGdldF9zeXN0ZW1fbWVtb3J5KCksIEZTTF9JTVgyNV9ST00wX0FERFIsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICZzLT5yb21bMF0pOwogICAgIG1lbW9yeV9yZWdpb25faW5pdF9y
b20oJnMtPnJvbVsxXSwgTlVMTCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICJpbXgyNS5y
b20xIiwgRlNMX0lNWDI1X1JPTTFfU0laRSwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAg
ICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICJpbXgyNS5yb20xIiwgRlNMX0lNWDI1X1JPTTFfU0laRSwgZXJycCk7CisgICAgaWYgKCplcnJw
KSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAgICAgbWVtb3J5X3JlZ2lvbl9hZGRfc3VicmVn
aW9uKGdldF9zeXN0ZW1fbWVtb3J5KCksIEZTTF9JTVgyNV9ST00xX0FERFIsCkBAIC0yNTUsOSAr
MjQzLDggQEAgc3RhdGljIHZvaWQgZnNsX2lteDI1X3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwg
RXJyb3IgKiplcnJwKQogCiAgICAgLyogaW5pdGlhbGl6ZSBpbnRlcm5hbCBSQU0gKDEyOCBLQikg
Ki8KICAgICBtZW1vcnlfcmVnaW9uX2luaXRfcmFtKCZzLT5pcmFtLCBOVUxMLCAiaW14MjUuaXJh
bSIsIEZTTF9JTVgyNV9JUkFNX1NJWkUsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAmZXJy
KTsKLSAgICBpZiAoZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOwor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAg
ICAgIHJldHVybjsKICAgICB9CiAgICAgbWVtb3J5X3JlZ2lvbl9hZGRfc3VicmVnaW9uKGdldF9z
eXN0ZW1fbWVtb3J5KCksIEZTTF9JTVgyNV9JUkFNX0FERFIsCmRpZmYgLS1naXQgYS9ody9hcm0v
ZnNsLWlteDMxLmMgYi9ody9hcm0vZnNsLWlteDMxLmMKaW5kZXggNTVlOTBkMTA0Yi4uZDFjMThl
YzcyNyAxMDA2NDQKLS0tIGEvaHcvYXJtL2ZzbC1pbXgzMS5jCisrKyBiL2h3L2FybS9mc2wtaW14
MzEuYwpAQCAtNjksMTcgKzY5LDE0IEBAIHN0YXRpYyB2b2lkIGZzbF9pbXgzMV9yZWFsaXplKERl
dmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKIHsKICAgICBGc2xJTVgzMVN0YXRlICpzID0g
RlNMX0lNWDMxKGRldik7CiAgICAgdWludDE2X3QgaTsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsK
IAotICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPmNwdSksIHRydWUsICJy
ZWFsaXplZCIsICZlcnIpOwotICAgIGlmIChlcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRl
KGVycnAsIGVycik7CisgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+Y3B1
KSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJl
dHVybjsKICAgICB9CiAKLSAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5h
dmljKSwgdHJ1ZSwgInJlYWxpemVkIiwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBl
cnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2wo
T0JKRUNUKCZzLT5hdmljKSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgaWYgKCplcnJw
KSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAgICAgc3lzYnVzX21taW9fbWFwKFNZU19CVVNf
REVWSUNFKCZzLT5hdmljKSwgMCwgRlNMX0lNWDMxX0FWSUNfQUREUik7CkBAIC04OCw5ICs4NSw4
IEBAIHN0YXRpYyB2b2lkIGZzbF9pbXgzMV9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9y
ICoqZXJycCkKICAgICBzeXNidXNfY29ubmVjdF9pcnEoU1lTX0JVU19ERVZJQ0UoJnMtPmF2aWMp
LCAxLAogICAgICAgICAgICAgICAgICAgICAgICBxZGV2X2dldF9ncGlvX2luKERFVklDRSgmcy0+
Y3B1KSwgQVJNX0NQVV9GSVEpKTsKIAotICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpF
Q1QoJnMtPmNjbSksIHRydWUsICJyZWFsaXplZCIsICZlcnIpOwotICAgIGlmIChlcnIpIHsKLSAg
ICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgb2JqZWN0X3Byb3BlcnR5X3Nl
dF9ib29sKE9CSkVDVCgmcy0+Y2NtKSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgaWYg
KCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAgICAgc3lzYnVzX21taW9fbWFwKFNZ
U19CVVNfREVWSUNFKCZzLT5jY20pLCAwLCBGU0xfSU1YMzFfQ0NNX0FERFIpOwpAQCAtMTA3LDkg
KzEwMyw4IEBAIHN0YXRpYyB2b2lkIGZzbF9pbXgzMV9yZWFsaXplKERldmljZVN0YXRlICpkZXYs
IEVycm9yICoqZXJycCkKIAogICAgICAgICBxZGV2X3Byb3Bfc2V0X2NocihERVZJQ0UoJnMtPnVh
cnRbaV0pLCAiY2hhcmRldiIsIHNlcmlhbF9oZChpKSk7CiAKLSAgICAgICAgb2JqZWN0X3Byb3Bl
cnR5X3NldF9ib29sKE9CSkVDVCgmcy0+dWFydFtpXSksIHRydWUsICJyZWFsaXplZCIsICZlcnIp
OwotICAgICAgICBpZiAoZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwg
ZXJyKTsKKyAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+dWFydFtp
XSksIHRydWUsICJyZWFsaXplZCIsIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKICAgICAg
ICAgICAgIHJldHVybjsKICAgICAgICAgfQogCkBAIC0xMjEsOSArMTE2LDggQEAgc3RhdGljIHZv
aWQgZnNsX2lteDMxX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogCiAg
ICAgcy0+Z3B0LmNjbSA9IElNWF9DQ00oJnMtPmNjbSk7CiAKLSAgICBvYmplY3RfcHJvcGVydHlf
c2V0X2Jvb2woT0JKRUNUKCZzLT5ncHQpLCB0cnVlLCAicmVhbGl6ZWQiLCAmZXJyKTsKLSAgICBp
ZiAoZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgIG9iamVj
dF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPmdwdCksIHRydWUsICJyZWFsaXplZCIsIGVy
cnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCkBAIC0xNDMs
OSArMTM3LDggQEAgc3RhdGljIHZvaWQgZnNsX2lteDMxX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRl
diwgRXJyb3IgKiplcnJwKQogCiAgICAgICAgIHMtPmVwaXRbaV0uY2NtID0gSU1YX0NDTSgmcy0+
Y2NtKTsKIAotICAgICAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5lcGl0
W2ldKSwgdHJ1ZSwgInJlYWxpemVkIiwgJmVycik7Ci0gICAgICAgIGlmIChlcnIpIHsKLSAgICAg
ICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgICAgICBvYmplY3RfcHJvcGVy
dHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5lcGl0W2ldKSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7
CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CiAK
QEAgLTE2Nyw5ICsxNjAsOCBAQCBzdGF0aWMgdm9pZCBmc2xfaW14MzFfcmVhbGl6ZShEZXZpY2VT
dGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgICAgIH07CiAKICAgICAgICAgLyogSW5pdGlh
bGl6ZSB0aGUgSTJDICovCi0gICAgICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1Qo
JnMtPmkyY1tpXSksIHRydWUsICJyZWFsaXplZCIsICZlcnIpOwotICAgICAgICBpZiAoZXJyKSB7
Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgb2JqZWN0
X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+aTJjW2ldKSwgdHJ1ZSwgInJlYWxpemVkIiwg
ZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgcmV0dXJuOwogICAgICAg
ICB9CiAgICAgICAgIC8qIE1hcCBJMkMgbWVtb3J5ICovCkBAIC0xOTMsOSArMTg1LDggQEAgc3Rh
dGljIHZvaWQgZnNsX2lteDMxX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJw
KQogCiAgICAgICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPmdwaW9baV0p
LCBmYWxzZSwgImhhcy1lZGdlLXNlbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAmZXJyb3JfYWJvcnQpOwotICAgICAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNU
KCZzLT5ncGlvW2ldKSwgdHJ1ZSwgInJlYWxpemVkIiwgJmVycik7Ci0gICAgICAgIGlmIChlcnIp
IHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgICAgICBvYmpl
Y3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5ncGlvW2ldKSwgdHJ1ZSwgInJlYWxpemVk
IiwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgcmV0dXJuOwogICAg
ICAgICB9CiAgICAgICAgIHN5c2J1c19tbWlvX21hcChTWVNfQlVTX0RFVklDRSgmcy0+Z3Bpb1tp
XSksIDAsIGdwaW9fdGFibGVbaV0uYWRkcik7CkBAIC0yMDcsOSArMTk4LDggQEAgc3RhdGljIHZv
aWQgZnNsX2lteDMxX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogCiAg
ICAgLyogT24gYSByZWFsIHN5c3RlbSwgdGhlIGZpcnN0IDE2ayBpcyBhIGBzZWN1cmUgYm9vdCBy
b20nICovCiAgICAgbWVtb3J5X3JlZ2lvbl9pbml0X3JvbSgmcy0+c2VjdXJlX3JvbSwgTlVMTCwg
ImlteDMxLnNlY3VyZV9yb20iLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgRlNMX0lNWDMx
X1NFQ1VSRV9ST01fU0laRSwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBlcnJvcl9w
cm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgIEZTTF9JTVgz
MV9TRUNVUkVfUk9NX1NJWkUsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1
cm47CiAgICAgfQogICAgIG1lbW9yeV9yZWdpb25fYWRkX3N1YnJlZ2lvbihnZXRfc3lzdGVtX21l
bW9yeSgpLCBGU0xfSU1YMzFfU0VDVVJFX1JPTV9BRERSLApAQCAtMjE3LDkgKzIwNyw4IEBAIHN0
YXRpYyB2b2lkIGZzbF9pbXgzMV9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJy
cCkKIAogICAgIC8qIFRoZXJlIGlzIGFsc28gYSAxNmsgUk9NICovCiAgICAgbWVtb3J5X3JlZ2lv
bl9pbml0X3JvbSgmcy0+cm9tLCBOVUxMLCAiaW14MzEucm9tIiwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgIEZTTF9JTVgzMV9ST01fU0laRSwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAg
ICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgIEZTTF9JTVgzMV9ST01fU0laRSwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAg
IHJldHVybjsKICAgICB9CiAgICAgbWVtb3J5X3JlZ2lvbl9hZGRfc3VicmVnaW9uKGdldF9zeXN0
ZW1fbWVtb3J5KCksIEZTTF9JTVgzMV9ST01fQUREUiwKQEAgLTIyNyw5ICsyMTYsOCBAQCBzdGF0
aWMgdm9pZCBmc2xfaW14MzFfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnAp
CiAKICAgICAvKiBpbml0aWFsaXplIGludGVybmFsIFJBTSAoMTYgS0IpICovCiAgICAgbWVtb3J5
X3JlZ2lvbl9pbml0X3JhbSgmcy0+aXJhbSwgTlVMTCwgImlteDMxLmlyYW0iLCBGU0xfSU1YMzFf
SVJBTV9TSVpFLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgJmVycik7Ci0gICAgaWYgKGVy
cikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAg
ICAgfQogICAgIG1lbW9yeV9yZWdpb25fYWRkX3N1YnJlZ2lvbihnZXRfc3lzdGVtX21lbW9yeSgp
LCBGU0xfSU1YMzFfSVJBTV9BRERSLApkaWZmIC0tZ2l0IGEvaHcvYXJtL2ZzbC1pbXg2LmMgYi9o
dy9hcm0vZnNsLWlteDYuYwppbmRleCA1NTIxNDViMjRlLi4zYjEzMTBmOTFjIDEwMDY0NAotLS0g
YS9ody9hcm0vZnNsLWlteDYuYworKysgYi9ody9hcm0vZnNsLWlteDYuYwpAQCAtMTAwLDcgKzEw
MCw2IEBAIHN0YXRpYyB2b2lkIGZzbF9pbXg2X3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJy
b3IgKiplcnJwKQogICAgIE1hY2hpbmVTdGF0ZSAqbXMgPSBNQUNISU5FKHFkZXZfZ2V0X21hY2hp
bmUoKSk7CiAgICAgRnNsSU1YNlN0YXRlICpzID0gRlNMX0lNWDYoZGV2KTsKICAgICB1aW50MTZf
dCBpOwotICAgIEVycm9yICplcnIgPSBOVUxMOwogICAgIHVuc2lnbmVkIGludCBzbXBfY3B1cyA9
IG1zLT5zbXAuY3B1czsKIAogICAgIGlmIChzbXBfY3B1cyA+IEZTTF9JTVg2X05VTV9DUFVTKSB7
CkBAIC0xMjMsOSArMTIyLDggQEAgc3RhdGljIHZvaWQgZnNsX2lteDZfcmVhbGl6ZShEZXZpY2VT
dGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgInN0YXJ0LXBvd2VyZWQtb2ZmIiwgJmVycm9yX2Fib3J0KTsKICAgICAgICAgfQogCi0g
ICAgICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPmNwdVtpXSksIHRydWUs
ICJyZWFsaXplZCIsICZlcnIpOwotICAgICAgICBpZiAoZXJyKSB7Ci0gICAgICAgICAgICBlcnJv
cl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29s
KE9CSkVDVCgmcy0+Y3B1W2ldKSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgICAgIGlm
ICgqZXJycCkgewogICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgfQpAQCAtMTM3
LDkgKzEzNSw4IEBAIHN0YXRpYyB2b2lkIGZzbF9pbXg2X3JlYWxpemUoRGV2aWNlU3RhdGUgKmRl
diwgRXJyb3IgKiplcnJwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZTTF9JTVg2X01B
WF9JUlEgKyBHSUNfSU5URVJOQUwsICJudW0taXJxIiwKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAmZXJyb3JfYWJvcnQpOwogCi0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVD
VCgmcy0+YTltcGNvcmUpLCB0cnVlLCAicmVhbGl6ZWQiLCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7
Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgIG9iamVjdF9wcm9wZXJ0
eV9zZXRfYm9vbChPQkpFQ1QoJnMtPmE5bXBjb3JlKSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7
CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAgICAgc3lzYnVzX21t
aW9fbWFwKFNZU19CVVNfREVWSUNFKCZzLT5hOW1wY29yZSksIDAsIEZTTF9JTVg2X0E5TVBDT1JF
X0FERFIpOwpAQCAtMTUxLDE2ICsxNDgsMTQgQEAgc3RhdGljIHZvaWQgZnNsX2lteDZfcmVhbGl6
ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBxZGV2X2dldF9ncGlvX2luKERFVklDRSgmcy0+Y3B1W2ldKSwgQVJNX0NQVV9GSVEpKTsK
ICAgICB9CiAKLSAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5jY20pLCB0
cnVlLCAicmVhbGl6ZWQiLCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7Ci0gICAgICAgIGVycm9yX3By
b3BhZ2F0ZShlcnJwLCBlcnIpOworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1Qo
JnMtPmNjbSksIHRydWUsICJyZWFsaXplZCIsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAg
ICAgICByZXR1cm47CiAgICAgfQogICAgIHN5c2J1c19tbWlvX21hcChTWVNfQlVTX0RFVklDRSgm
cy0+Y2NtKSwgMCwgRlNMX0lNWDZfQ0NNX0FERFIpOwogCi0gICAgb2JqZWN0X3Byb3BlcnR5X3Nl
dF9ib29sKE9CSkVDVCgmcy0+c3JjKSwgdHJ1ZSwgInJlYWxpemVkIiwgJmVycik7Ci0gICAgaWYg
KGVycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICBvYmplY3Rf
cHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5zcmMpLCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJw
KTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KICAgICBzeXNidXNf
bW1pb19tYXAoU1lTX0JVU19ERVZJQ0UoJnMtPnNyYyksIDAsIEZTTF9JTVg2X1NSQ19BRERSKTsK
QEAgLTE4MCw5ICsxNzUsOCBAQCBzdGF0aWMgdm9pZCBmc2xfaW14Nl9yZWFsaXplKERldmljZVN0
YXRlICpkZXYsIEVycm9yICoqZXJycCkKIAogICAgICAgICBxZGV2X3Byb3Bfc2V0X2NocihERVZJ
Q0UoJnMtPnVhcnRbaV0pLCAiY2hhcmRldiIsIHNlcmlhbF9oZChpKSk7CiAKLSAgICAgICAgb2Jq
ZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+dWFydFtpXSksIHRydWUsICJyZWFsaXpl
ZCIsICZlcnIpOwotICAgICAgICBpZiAoZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdh
dGUoZXJycCwgZXJyKTsKKyAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgm
cy0+dWFydFtpXSksIHRydWUsICJyZWFsaXplZCIsIGVycnApOworICAgICAgICBpZiAoKmVycnAp
IHsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQogCkBAIC0xOTQsOSArMTg4LDggQEAg
c3RhdGljIHZvaWQgZnNsX2lteDZfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVy
cnApCiAKICAgICBzLT5ncHQuY2NtID0gSU1YX0NDTSgmcy0+Y2NtKTsKIAotICAgIG9iamVjdF9w
cm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPmdwdCksIHRydWUsICJyZWFsaXplZCIsICZlcnIp
OwotICAgIGlmIChlcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7Cisg
ICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+Z3B0KSwgdHJ1ZSwgInJlYWxp
emVkIiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAK
QEAgLTIxNyw5ICsyMTAsOCBAQCBzdGF0aWMgdm9pZCBmc2xfaW14Nl9yZWFsaXplKERldmljZVN0
YXRlICpkZXYsIEVycm9yICoqZXJycCkKIAogICAgICAgICBzLT5lcGl0W2ldLmNjbSA9IElNWF9D
Q00oJnMtPmNjbSk7CiAKLSAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgm
cy0+ZXBpdFtpXSksIHRydWUsICJyZWFsaXplZCIsICZlcnIpOwotICAgICAgICBpZiAoZXJyKSB7
Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgb2JqZWN0
X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+ZXBpdFtpXSksIHRydWUsICJyZWFsaXplZCIs
IGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIHJldHVybjsKICAgICAg
ICAgfQogCkBAIC0yNDAsOSArMjMyLDggQEAgc3RhdGljIHZvaWQgZnNsX2lteDZfcmVhbGl6ZShE
ZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgICAgICAgICB7IEZTTF9JTVg2X0ky
QzNfQUREUiwgRlNMX0lNWDZfSTJDM19JUlEgfQogICAgICAgICB9OwogCi0gICAgICAgIG9iamVj
dF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPmkyY1tpXSksIHRydWUsICJyZWFsaXplZCIs
ICZlcnIpOwotICAgICAgICBpZiAoZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUo
ZXJycCwgZXJyKTsKKyAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+
aTJjW2ldKSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewog
ICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CiAKQEAgLTMwMCw5ICsyOTEsOCBAQCBzdGF0
aWMgdm9pZCBmc2xfaW14Nl9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZlcnJvcl9hYm9ydCk7CiAgICAgICAg
IG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPmdwaW9baV0pLCB0cnVlLCAiaGFz
LXVwcGVyLXBpbi1pcnEiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJmVycm9y
X2Fib3J0KTsKLSAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+Z3Bp
b1tpXSksIHRydWUsICJyZWFsaXplZCIsICZlcnIpOwotICAgICAgICBpZiAoZXJyKSB7Ci0gICAg
ICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgb2JqZWN0X3Byb3Bl
cnR5X3NldF9ib29sKE9CSkVDVCgmcy0+Z3Bpb1tpXSksIHRydWUsICJyZWFsaXplZCIsIGVycnAp
OworICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQog
CkBAIC0zMjksMTIgKzMxOSwxMSBAQCBzdGF0aWMgdm9pZCBmc2xfaW14Nl9yZWFsaXplKERldmlj
ZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKIAogICAgICAgICAvKiBVSFMtSSBTRElPMy4wIFNE
UjEwNCAxLjhWIEFETUEgKi8KICAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF91aW50KE9CSkVD
VCgmcy0+ZXNkaGNbaV0pLCAzLCAic2Qtc3BlYy12ZXJzaW9uIiwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICZlcnIpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ZXJycCk7CiAgICAgICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfdWludChPQkpFQ1QoJnMtPmVzZGhj
W2ldKSwgSU1YNl9FU0RIQ19DQVBBQklMSVRJRVMsCi0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAiY2FwYXJlZyIsICZlcnIpOwotICAgICAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jv
b2woT0JKRUNUKCZzLT5lc2RoY1tpXSksIHRydWUsICJyZWFsaXplZCIsICZlcnIpOwotICAgICAg
ICBpZiAoZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJjYXBhcmVnIiwgZXJycCk7CisgICAgICAg
IG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPmVzZGhjW2ldKSwgdHJ1ZSwgInJl
YWxpemVkIiwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgcmV0dXJu
OwogICAgICAgICB9CiAgICAgICAgIHN5c2J1c19tbWlvX21hcChTWVNfQlVTX0RFVklDRSgmcy0+
ZXNkaGNbaV0pLCAwLCBlc2RoY190YWJsZVtpXS5hZGRyKTsKQEAgLTM1Nyw5ICszNDYsOCBAQCBz
dGF0aWMgdm9pZCBmc2xfaW14Nl9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJy
cCkKICAgICAgICAgfTsKIAogICAgICAgICAvKiBJbml0aWFsaXplIHRoZSBTUEkgKi8KLSAgICAg
ICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+c3BpW2ldKSwgdHJ1ZSwgInJl
YWxpemVkIiwgJmVycik7Ci0gICAgICAgIGlmIChlcnIpIHsKLSAgICAgICAgICAgIGVycm9yX3By
b3BhZ2F0ZShlcnJwLCBlcnIpOworICAgICAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JK
RUNUKCZzLT5zcGlbaV0pLCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAgICAgICAgaWYgKCpl
cnJwKSB7CiAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgIH0KIApAQCAtMzcwLDkgKzM1OCw4
IEBAIHN0YXRpYyB2b2lkIGZzbF9pbXg2X3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3Ig
KiplcnJwKQogICAgIH0KIAogICAgIHFkZXZfc2V0X25pY19wcm9wZXJ0aWVzKERFVklDRSgmcy0+
ZXRoKSwgJm5kX3RhYmxlWzBdKTsKLSAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNU
KCZzLT5ldGgpLCB0cnVlLCAicmVhbGl6ZWQiLCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7Ci0gICAg
ICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRf
Ym9vbChPQkpFQ1QoJnMtPmV0aCksIHRydWUsICJyZWFsaXplZCIsIGVycnApOworICAgIGlmICgq
ZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogICAgIHN5c2J1c19tbWlvX21hcChTWVNf
QlVTX0RFVklDRSgmcy0+ZXRoKSwgMCwgRlNMX0lNWDZfRU5FVF9BRERSKTsKQEAgLTM4NSw5ICsz
NzIsOCBAQCBzdGF0aWMgdm9pZCBmc2xfaW14Nl9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVy
cm9yICoqZXJycCkKIAogICAgIC8qIFJPTSBtZW1vcnkgKi8KICAgICBtZW1vcnlfcmVnaW9uX2lu
aXRfcm9tKCZzLT5yb20sIE5VTEwsICJpbXg2LnJvbSIsCi0gICAgICAgICAgICAgICAgICAgICAg
ICAgICBGU0xfSU1YNl9ST01fU0laRSwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBl
cnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgIEZT
TF9JTVg2X1JPTV9TSVpFLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJu
OwogICAgIH0KICAgICBtZW1vcnlfcmVnaW9uX2FkZF9zdWJyZWdpb24oZ2V0X3N5c3RlbV9tZW1v
cnkoKSwgRlNMX0lNWDZfUk9NX0FERFIsCkBAIC0zOTUsOSArMzgxLDggQEAgc3RhdGljIHZvaWQg
ZnNsX2lteDZfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAKICAgICAv
KiBDQUFNIG1lbW9yeSAqLwogICAgIG1lbW9yeV9yZWdpb25faW5pdF9yb20oJnMtPmNhYW0sIE5V
TEwsICJpbXg2LmNhYW0iLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgRlNMX0lNWDZfQ0FB
TV9NRU1fU0laRSwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBlcnJvcl9wcm9wYWdh
dGUoZXJycCwgZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgIEZTTF9JTVg2X0NBQU1f
TUVNX1NJWkUsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAg
fQogICAgIG1lbW9yeV9yZWdpb25fYWRkX3N1YnJlZ2lvbihnZXRfc3lzdGVtX21lbW9yeSgpLCBG
U0xfSU1YNl9DQUFNX01FTV9BRERSLApAQCAtNDA1LDkgKzM5MCw4IEBAIHN0YXRpYyB2b2lkIGZz
bF9pbXg2X3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogCiAgICAgLyog
T0NSQU0gbWVtb3J5ICovCiAgICAgbWVtb3J5X3JlZ2lvbl9pbml0X3JhbSgmcy0+b2NyYW0sIE5V
TEwsICJpbXg2Lm9jcmFtIiwgRlNMX0lNWDZfT0NSQU1fU0laRSwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICZlcnIpOwotICAgIGlmIChlcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRl
KGVycnAsIGVycik7CisgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJwKTsKKyAgICBpZiAo
KmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KICAgICBtZW1vcnlfcmVnaW9uX2FkZF9z
dWJyZWdpb24oZ2V0X3N5c3RlbV9tZW1vcnkoKSwgRlNMX0lNWDZfT0NSQU1fQUREUiwKZGlmZiAt
LWdpdCBhL2h3L2FybS9pbnRlZ3JhdG9yY3AuYyBiL2h3L2FybS9pbnRlZ3JhdG9yY3AuYwppbmRl
eCA1MjQ5NzA4NDBkLi5kY2RiMmZkMTU2IDEwMDY0NAotLS0gYS9ody9hcm0vaW50ZWdyYXRvcmNw
LmMKKysrIGIvaHcvYXJtL2ludGVncmF0b3JjcC5jCkBAIC0yODYsMTIgKzI4NiwxMCBAQCBzdGF0
aWMgdm9pZCBpbnRlZ3JhdG9yY21fcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZCwgRXJyb3IgKiplcnJw
KQogewogICAgIEludGVncmF0b3JDTVN0YXRlICpzID0gSU5URUdSQVRPUl9DTShkKTsKICAgICBT
eXNCdXNEZXZpY2UgKmRldiA9IFNZU19CVVNfREVWSUNFKGQpOwotICAgIEVycm9yICpsb2NhbF9l
cnIgPSBOVUxMOwogCiAgICAgbWVtb3J5X3JlZ2lvbl9pbml0X3JhbSgmcy0+Zmxhc2gsIE9CSkVD
VChkKSwgImludGVncmF0b3IuZmxhc2giLCAweDEwMDAwMCwKLSAgICAgICAgICAgICAgICAgICAg
ICAgICAgICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3Jf
cHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgICAgICAgICAgICAgICAgICAgICBl
cnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApkaWZmIC0t
Z2l0IGEvaHcvYXJtL21zZjItc29jLmMgYi9ody9hcm0vbXNmMi1zb2MuYwppbmRleCAwMDhmZDkz
MjdhLi44ZjIzNjc0ZDgxIDEwMDY0NAotLS0gYS9ody9hcm0vbXNmMi1zb2MuYworKysgYi9ody9h
cm0vbXNmMi1zb2MuYwpAQCAtODgsNyArODgsNiBAQCBzdGF0aWMgdm9pZCBtMnN4eHhfc29jX3Jl
YWxpemUoRGV2aWNlU3RhdGUgKmRldl9zb2MsIEVycm9yICoqZXJycCkKICAgICBNU0YyU3RhdGUg
KnMgPSBNU0YyX1NPQyhkZXZfc29jKTsKICAgICBEZXZpY2VTdGF0ZSAqZGV2LCAqYXJtdjdtOwog
ICAgIFN5c0J1c0RldmljZSAqYnVzZGV2OwotICAgIEVycm9yICplcnIgPSBOVUxMOwogICAgIGlu
dCBpOwogCiAgICAgTWVtb3J5UmVnaW9uICpzeXN0ZW1fbWVtb3J5ID0gZ2V0X3N5c3RlbV9tZW1v
cnkoKTsKQEAgLTEyMCw5ICsxMTksOCBAQCBzdGF0aWMgdm9pZCBtMnN4eHhfc29jX3JlYWxpemUo
RGV2aWNlU3RhdGUgKmRldl9zb2MsIEVycm9yICoqZXJycCkKICAgICBxZGV2X3Byb3Bfc2V0X2Jp
dChhcm12N20sICJlbmFibGUtYml0YmFuZCIsIHRydWUpOwogICAgIG9iamVjdF9wcm9wZXJ0eV9z
ZXRfbGluayhPQkpFQ1QoJnMtPmFybXY3bSksIE9CSkVDVChnZXRfc3lzdGVtX21lbW9yeSgpKSwK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibWVtb3J5IiwgJmVycm9yX2Fi
b3J0KTsKLSAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5hcm12N20pLCB0
cnVlLCAicmVhbGl6ZWQiLCAmZXJyKTsKLSAgICBpZiAoZXJyICE9IE5VTEwpIHsKLSAgICAgICAg
ZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29s
KE9CSkVDVCgmcy0+YXJtdjdtKSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgaWYgKCpl
cnJwICE9IE5VTEwpIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApAQCAtMTQ4LDkgKzE0Niw4
IEBAIHN0YXRpYyB2b2lkIG0yc3h4eF9zb2NfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2X3NvYywg
RXJyb3IgKiplcnJwKQogICAgIGRldiA9IERFVklDRSgmcy0+dGltZXIpOwogICAgIC8qIEFQQjAg
Y2xvY2sgaXMgdGhlIHRpbWVyIGlucHV0IGNsb2NrICovCiAgICAgcWRldl9wcm9wX3NldF91aW50
MzIoZGV2LCAiY2xvY2stZnJlcXVlbmN5Iiwgcy0+bTNjbGsgLyBzLT5hcGIwZGl2KTsKLSAgICBv
YmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT50aW1lciksIHRydWUsICJyZWFsaXpl
ZCIsICZlcnIpOwotICAgIGlmIChlcnIgIT0gTlVMTCkgewotICAgICAgICBlcnJvcl9wcm9wYWdh
dGUoZXJycCwgZXJyKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT50
aW1lciksIHRydWUsICJyZWFsaXplZCIsIGVycnApOworICAgIGlmICgqZXJycCAhPSBOVUxMKSB7
CiAgICAgICAgIHJldHVybjsKICAgICB9CiAgICAgYnVzZGV2ID0gU1lTX0JVU19ERVZJQ0UoZGV2
KTsKQEAgLTE2Myw5ICsxNjAsOCBAQCBzdGF0aWMgdm9pZCBtMnN4eHhfc29jX3JlYWxpemUoRGV2
aWNlU3RhdGUgKmRldl9zb2MsIEVycm9yICoqZXJycCkKICAgICBkZXYgPSBERVZJQ0UoJnMtPnN5
c3JlZyk7CiAgICAgcWRldl9wcm9wX3NldF91aW50MzIoZGV2LCAiYXBiMGRpdmlzb3IiLCBzLT5h
cGIwZGl2KTsKICAgICBxZGV2X3Byb3Bfc2V0X3VpbnQzMihkZXYsICJhcGIxZGl2aXNvciIsIHMt
PmFwYjFkaXYpOwotICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPnN5c3Jl
ZyksIHRydWUsICJyZWFsaXplZCIsICZlcnIpOwotICAgIGlmIChlcnIgIT0gTlVMTCkgewotICAg
ICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0
X2Jvb2woT0JKRUNUKCZzLT5zeXNyZWcpLCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAgICBp
ZiAoKmVycnAgIT0gTlVMTCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogICAgIGJ1c2RldiA9
IFNZU19CVVNfREVWSUNFKGRldik7CkBAIC0xNzQsOSArMTcwLDggQEAgc3RhdGljIHZvaWQgbTJz
eHh4X3NvY19yZWFsaXplKERldmljZVN0YXRlICpkZXZfc29jLCBFcnJvciAqKmVycnApCiAgICAg
Zm9yIChpID0gMDsgaSA8IE1TRjJfTlVNX1NQSVM7IGkrKykgewogICAgICAgICBnY2hhciAqYnVz
X25hbWU7CiAKLSAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+c3Bp
W2ldKSwgdHJ1ZSwgInJlYWxpemVkIiwgJmVycik7Ci0gICAgICAgIGlmIChlcnIgIT0gTlVMTCkg
ewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgICAgIG9iamVj
dF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPnNwaVtpXSksIHRydWUsICJyZWFsaXplZCIs
IGVycnApOworICAgICAgICBpZiAoKmVycnAgIT0gTlVMTCkgewogICAgICAgICAgICAgcmV0dXJu
OwogICAgICAgICB9CiAKZGlmZiAtLWdpdCBhL2h3L2FybS9ucmY1MV9zb2MuYyBiL2h3L2FybS9u
cmY1MV9zb2MuYwppbmRleCA3NDAyOTE2OWQwLi44YzBhODdkNmZkIDEwMDY0NAotLS0gYS9ody9h
cm0vbnJmNTFfc29jLmMKKysrIGIvaHcvYXJtL25yZjUxX3NvYy5jCkBAIC01Niw3ICs1Niw2IEBA
IHN0YXRpYyB2b2lkIG5yZjUxX3NvY19yZWFsaXplKERldmljZVN0YXRlICpkZXZfc29jLCBFcnJv
ciAqKmVycnApCiB7CiAgICAgTlJGNTFTdGF0ZSAqcyA9IE5SRjUxX1NPQyhkZXZfc29jKTsKICAg
ICBNZW1vcnlSZWdpb24gKm1yOwotICAgIEVycm9yICplcnIgPSBOVUxMOwogICAgIHVpbnQ4X3Qg
aSA9IDA7CiAgICAgaHdhZGRyIGJhc2VfYWRkciA9IDA7CiAKQEAgLTY2LDMxICs2NSwyNyBAQCBz
dGF0aWMgdm9pZCBucmY1MV9zb2NfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2X3NvYywgRXJyb3Ig
KiplcnJwKQogICAgIH0KIAogICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfbGluayhPQkpFQ1QoJnMt
PmNwdSksIE9CSkVDVCgmcy0+Y29udGFpbmVyKSwgIm1lbW9yeSIsCi0gICAgICAgICAgICAmZXJy
KTsKLSAgICBpZiAoZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOwor
ICAgICAgICAgICAgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAg
ICB9Ci0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+Y3B1KSwgdHJ1ZSwg
InJlYWxpemVkIiwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBlcnJvcl9wcm9wYWdh
dGUoZXJycCwgZXJyKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5j
cHUpLCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAg
cmV0dXJuOwogICAgIH0KIAogICAgIG1lbW9yeV9yZWdpb25fYWRkX3N1YnJlZ2lvbl9vdmVybGFw
KCZzLT5jb250YWluZXIsIDAsIHMtPmJvYXJkX21lbW9yeSwgLTEpOwogCiAgICAgbWVtb3J5X3Jl
Z2lvbl9pbml0X3JhbSgmcy0+c3JhbSwgT0JKRUNUKHMpLCAibnJmNTEuc3JhbSIsIHMtPnNyYW1f
c2l6ZSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICZlcnIpOwotICAgIGlmIChlcnIpIHsK
LSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgICAgICAgICAgICAgICAg
ICAgICAgICBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0K
ICAgICBtZW1vcnlfcmVnaW9uX2FkZF9zdWJyZWdpb24oJnMtPmNvbnRhaW5lciwgTlJGNTFfU1JB
TV9CQVNFLCAmcy0+c3JhbSk7CiAKICAgICAvKiBVQVJUICovCi0gICAgb2JqZWN0X3Byb3BlcnR5
X3NldF9ib29sKE9CSkVDVCgmcy0+dWFydCksIHRydWUsICJyZWFsaXplZCIsICZlcnIpOwotICAg
IGlmIChlcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgb2Jq
ZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+dWFydCksIHRydWUsICJyZWFsaXplZCIs
IGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogICAgIG1y
ID0gc3lzYnVzX21taW9fZ2V0X3JlZ2lvbihTWVNfQlVTX0RFVklDRSgmcy0+dWFydCksIDApOwpA
QCAtMTAwLDkgKzk1LDggQEAgc3RhdGljIHZvaWQgbnJmNTFfc29jX3JlYWxpemUoRGV2aWNlU3Rh
dGUgKmRldl9zb2MsIEVycm9yICoqZXJycCkKICAgICAgICAgICAgICAgICAgICAgICAgQkFTRV9U
T19JUlEoTlJGNTFfVUFSVF9CQVNFKSkpOwogCiAgICAgLyogUk5HICovCi0gICAgb2JqZWN0X3By
b3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+cm5nKSwgdHJ1ZSwgInJlYWxpemVkIiwgJmVycik7
Ci0gICAgaWYgKGVycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAg
ICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5ybmcpLCB0cnVlLCAicmVhbGl6
ZWQiLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApA
QCAtMTE0LDE1ICsxMDgsMTMgQEAgc3RhdGljIHZvaWQgbnJmNTFfc29jX3JlYWxpemUoRGV2aWNl
U3RhdGUgKmRldl9zb2MsIEVycm9yICoqZXJycCkKIAogICAgIC8qIFVJQ1IsIEZJQ1IsIE5WTUMs
IEZMQVNIICovCiAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF91aW50KE9CSkVDVCgmcy0+bnZtKSwg
cy0+Zmxhc2hfc2l6ZSwgImZsYXNoLXNpemUiLAotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAmZXJyKTsKLSAgICBpZiAoZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBl
cnIpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJwKTsKKyAgICBpZiAoKmVycnAp
IHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIAotICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9v
bChPQkpFQ1QoJnMtPm52bSksIHRydWUsICJyZWFsaXplZCIsICZlcnIpOwotICAgIGlmIChlcnIp
IHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgb2JqZWN0X3Byb3Bl
cnR5X3NldF9ib29sKE9CSkVDVCgmcy0+bnZtKSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7Cisg
ICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKQEAgLTEzNiw5ICsxMjgs
OCBAQCBzdGF0aWMgdm9pZCBucmY1MV9zb2NfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2X3NvYywg
RXJyb3IgKiplcnJwKQogICAgIG1lbW9yeV9yZWdpb25fYWRkX3N1YnJlZ2lvbl9vdmVybGFwKCZz
LT5jb250YWluZXIsIE5SRjUxX0ZMQVNIX0JBU0UsIG1yLCAwKTsKIAogICAgIC8qIEdQSU8gKi8K
LSAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5ncGlvKSwgdHJ1ZSwgInJl
YWxpemVkIiwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUo
ZXJycCwgZXJyKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5ncGlv
KSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJl
dHVybjsKICAgICB9CiAKQEAgLTE1MCw5ICsxNDEsOCBAQCBzdGF0aWMgdm9pZCBucmY1MV9zb2Nf
cmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2X3NvYywgRXJyb3IgKiplcnJwKQogCiAgICAgLyogVElN
RVIgKi8KICAgICBmb3IgKGkgPSAwOyBpIDwgTlJGNTFfTlVNX1RJTUVSUzsgaSsrKSB7Ci0gICAg
ICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPnRpbWVyW2ldKSwgdHJ1ZSwg
InJlYWxpemVkIiwgJmVycik7Ci0gICAgICAgIGlmIChlcnIpIHsKLSAgICAgICAgICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgICAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2wo
T0JKRUNUKCZzLT50aW1lcltpXSksIHRydWUsICJyZWFsaXplZCIsIGVycnApOworICAgICAgICBp
ZiAoKmVycnApIHsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQogCmRpZmYgLS1naXQg
YS9ody9hcm0vc21tdS1jb21tb24uYyBiL2h3L2FybS9zbW11LWNvbW1vbi5jCmluZGV4IDI0NTgx
N2QyM2UuLjg2OGYxOGM1ZTUgMTAwNjQ0Ci0tLSBhL2h3L2FybS9zbW11LWNvbW1vbi5jCisrKyBi
L2h3L2FybS9zbW11LWNvbW1vbi5jCkBAIC00MjMsMTEgKzQyMyw5IEBAIHN0YXRpYyB2b2lkIHNt
bXVfYmFzZV9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKIHsKICAgICBT
TU1VU3RhdGUgKnMgPSBBUk1fU01NVShkZXYpOwogICAgIFNNTVVCYXNlQ2xhc3MgKnNiYyA9IEFS
TV9TTU1VX0dFVF9DTEFTUyhkZXYpOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCi0g
ICAgc2JjLT5wYXJlbnRfcmVhbGl6ZShkZXYsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9l
cnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgc2Jj
LT5wYXJlbnRfcmVhbGl6ZShkZXYsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICBy
ZXR1cm47CiAgICAgfQogICAgIHMtPmNvbmZpZ3MgPSBnX2hhc2hfdGFibGVfbmV3X2Z1bGwoTlVM
TCwgTlVMTCwgTlVMTCwgZ19mcmVlKTsKZGlmZiAtLWdpdCBhL2h3L2FybS9zbW11djMuYyBiL2h3
L2FybS9zbW11djMuYwppbmRleCBkYjA1MWRjYWM4Li4yODMxZjAyNGJkIDEwMDY0NAotLS0gYS9o
dy9hcm0vc21tdXYzLmMKKysrIGIvaHcvYXJtL3NtbXV2My5jCkBAIC0xMzg5LDExICsxMzg5LDkg
QEAgc3RhdGljIHZvaWQgc21tdV9yZWFsaXplKERldmljZVN0YXRlICpkLCBFcnJvciAqKmVycnAp
CiAgICAgU01NVXYzU3RhdGUgKnMgPSBBUk1fU01NVVYzKHN5cyk7CiAgICAgU01NVXYzQ2xhc3Mg
KmMgPSBBUk1fU01NVVYzX0dFVF9DTEFTUyhzKTsKICAgICBTeXNCdXNEZXZpY2UgKmRldiA9IFNZ
U19CVVNfREVWSUNFKGQpOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCi0gICAgYy0+
cGFyZW50X3JlYWxpemUoZCwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAg
ICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBjLT5wYXJlbnRfcmVh
bGl6ZShkLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0K
IApkaWZmIC0tZ2l0IGEvaHcvYXJtL3N0bTMyZjIwNV9zb2MuYyBiL2h3L2FybS9zdG0zMmYyMDVf
c29jLmMKaW5kZXggZjVhNWMyZDgwYy4uNTIwNDJkNmQ4MCAxMDA2NDQKLS0tIGEvaHcvYXJtL3N0
bTMyZjIwNV9zb2MuYworKysgYi9ody9hcm0vc3RtMzJmMjA1X3NvYy5jCkBAIC04NSw3ICs4NSw2
IEBAIHN0YXRpYyB2b2lkIHN0bTMyZjIwNV9zb2NfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2X3Nv
YywgRXJyb3IgKiplcnJwKQogICAgIFNUTTMyRjIwNVN0YXRlICpzID0gU1RNMzJGMjA1X1NPQyhk
ZXZfc29jKTsKICAgICBEZXZpY2VTdGF0ZSAqZGV2LCAqYXJtdjdtOwogICAgIFN5c0J1c0Rldmlj
ZSAqYnVzZGV2OwotICAgIEVycm9yICplcnIgPSBOVUxMOwogICAgIGludCBpOwogCiAgICAgTWVt
b3J5UmVnaW9uICpzeXN0ZW1fbWVtb3J5ID0gZ2V0X3N5c3RlbV9tZW1vcnkoKTsKQEAgLTExNCwx
NyArMTEzLDE1IEBAIHN0YXRpYyB2b2lkIHN0bTMyZjIwNV9zb2NfcmVhbGl6ZShEZXZpY2VTdGF0
ZSAqZGV2X3NvYywgRXJyb3IgKiplcnJwKQogICAgIHFkZXZfcHJvcF9zZXRfYml0KGFybXY3bSwg
ImVuYWJsZS1iaXRiYW5kIiwgdHJ1ZSk7CiAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9saW5rKE9C
SkVDVCgmcy0+YXJtdjdtKSwgT0JKRUNUKGdldF9zeXN0ZW1fbWVtb3J5KCkpLAogICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICJtZW1vcnkiLCAmZXJyb3JfYWJvcnQpOwotICAg
IG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPmFybXY3bSksIHRydWUsICJyZWFs
aXplZCIsICZlcnIpOwotICAgIGlmIChlcnIgIT0gTlVMTCkgewotICAgICAgICBlcnJvcl9wcm9w
YWdhdGUoZXJycCwgZXJyKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZz
LT5hcm12N20pLCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAgICBpZiAoKmVycnAgIT0gTlVM
TCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCiAgICAgLyogU3lzdGVtIGNvbmZpZ3VyYXRp
b24gY29udHJvbGxlciAqLwogICAgIGRldiA9IERFVklDRSgmcy0+c3lzY2ZnKTsKLSAgICBvYmpl
Y3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5zeXNjZmcpLCB0cnVlLCAicmVhbGl6ZWQi
LCAmZXJyKTsKLSAgICBpZiAoZXJyICE9IE5VTEwpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRl
KGVycnAsIGVycik7CisgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+c3lz
Y2ZnKSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgaWYgKCplcnJwICE9IE5VTEwpIHsK
ICAgICAgICAgcmV0dXJuOwogICAgIH0KICAgICBidXNkZXYgPSBTWVNfQlVTX0RFVklDRShkZXYp
OwpAQCAtMTM1LDkgKzEzMiw4IEBAIHN0YXRpYyB2b2lkIHN0bTMyZjIwNV9zb2NfcmVhbGl6ZShE
ZXZpY2VTdGF0ZSAqZGV2X3NvYywgRXJyb3IgKiplcnJwKQogICAgIGZvciAoaSA9IDA7IGkgPCBT
VE1fTlVNX1VTQVJUUzsgaSsrKSB7CiAgICAgICAgIGRldiA9IERFVklDRSgmKHMtPnVzYXJ0W2ld
KSk7CiAgICAgICAgIHFkZXZfcHJvcF9zZXRfY2hyKGRldiwgImNoYXJkZXYiLCBzZXJpYWxfaGQo
aSkpOwotICAgICAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT51c2FydFtp
XSksIHRydWUsICJyZWFsaXplZCIsICZlcnIpOwotICAgICAgICBpZiAoZXJyICE9IE5VTEwpIHsK
LSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgICAgICBvYmplY3Rf
cHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT51c2FydFtpXSksIHRydWUsICJyZWFsaXplZCIs
IGVycnApOworICAgICAgICBpZiAoKmVycnAgIT0gTlVMTCkgewogICAgICAgICAgICAgcmV0dXJu
OwogICAgICAgICB9CiAgICAgICAgIGJ1c2RldiA9IFNZU19CVVNfREVWSUNFKGRldik7CkBAIC0x
NDksOSArMTQ1LDggQEAgc3RhdGljIHZvaWQgc3RtMzJmMjA1X3NvY19yZWFsaXplKERldmljZVN0
YXRlICpkZXZfc29jLCBFcnJvciAqKmVycnApCiAgICAgZm9yIChpID0gMDsgaSA8IFNUTV9OVU1f
VElNRVJTOyBpKyspIHsKICAgICAgICAgZGV2ID0gREVWSUNFKCYocy0+dGltZXJbaV0pKTsKICAg
ICAgICAgcWRldl9wcm9wX3NldF91aW50NjQoZGV2LCAiY2xvY2stZnJlcXVlbmN5IiwgMTAwMDAw
MDAwMCk7Ci0gICAgICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPnRpbWVy
W2ldKSwgdHJ1ZSwgInJlYWxpemVkIiwgJmVycik7Ci0gICAgICAgIGlmIChlcnIgIT0gTlVMTCkg
ewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgICAgIG9iamVj
dF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPnRpbWVyW2ldKSwgdHJ1ZSwgInJlYWxpemVk
IiwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCAhPSBOVUxMKSB7CiAgICAgICAgICAgICByZXR1
cm47CiAgICAgICAgIH0KICAgICAgICAgYnVzZGV2ID0gU1lTX0JVU19ERVZJQ0UoZGV2KTsKQEAg
LTE2MSwxMCArMTU2LDkgQEAgc3RhdGljIHZvaWQgc3RtMzJmMjA1X3NvY19yZWFsaXplKERldmlj
ZVN0YXRlICpkZXZfc29jLCBFcnJvciAqKmVycnApCiAKICAgICAvKiBBREMgMSB0byAzICovCiAg
ICAgb2JqZWN0X3Byb3BlcnR5X3NldF9pbnQoT0JKRUNUKHMtPmFkY19pcnFzKSwgU1RNX05VTV9B
RENTLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICJudW0tbGluZXMiLCAmZXJyKTsKLSAg
ICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKHMtPmFkY19pcnFzKSwgdHJ1ZSwgInJl
YWxpemVkIiwgJmVycik7Ci0gICAgaWYgKGVyciAhPSBOVUxMKSB7Ci0gICAgICAgIGVycm9yX3By
b3BhZ2F0ZShlcnJwLCBlcnIpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICJudW0tbGlu
ZXMiLCBlcnJwKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKHMtPmFkY19p
cnFzKSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgaWYgKCplcnJwICE9IE5VTEwpIHsK
ICAgICAgICAgcmV0dXJuOwogICAgIH0KICAgICBxZGV2X2Nvbm5lY3RfZ3Bpb19vdXQoREVWSUNF
KHMtPmFkY19pcnFzKSwgMCwKQEAgLTE3Miw5ICsxNjYsOCBAQCBzdGF0aWMgdm9pZCBzdG0zMmYy
MDVfc29jX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldl9zb2MsIEVycm9yICoqZXJycCkKIAogICAg
IGZvciAoaSA9IDA7IGkgPCBTVE1fTlVNX0FEQ1M7IGkrKykgewogICAgICAgICBkZXYgPSBERVZJ
Q0UoJihzLT5hZGNbaV0pKTsKLSAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVD
VCgmcy0+YWRjW2ldKSwgdHJ1ZSwgInJlYWxpemVkIiwgJmVycik7Ci0gICAgICAgIGlmIChlcnIg
IT0gTlVMTCkgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAg
ICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPmFkY1tpXSksIHRydWUsICJy
ZWFsaXplZCIsIGVycnApOworICAgICAgICBpZiAoKmVycnAgIT0gTlVMTCkgewogICAgICAgICAg
ICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgICAgIGJ1c2RldiA9IFNZU19CVVNfREVWSUNFKGRl
dik7CkBAIC0xODYsOSArMTc5LDggQEAgc3RhdGljIHZvaWQgc3RtMzJmMjA1X3NvY19yZWFsaXpl
KERldmljZVN0YXRlICpkZXZfc29jLCBFcnJvciAqKmVycnApCiAgICAgLyogU1BJIDEgYW5kIDIg
Ki8KICAgICBmb3IgKGkgPSAwOyBpIDwgU1RNX05VTV9TUElTOyBpKyspIHsKICAgICAgICAgZGV2
ID0gREVWSUNFKCYocy0+c3BpW2ldKSk7Ci0gICAgICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9v
bChPQkpFQ1QoJnMtPnNwaVtpXSksIHRydWUsICJyZWFsaXplZCIsICZlcnIpOwotICAgICAgICBp
ZiAoZXJyICE9IE5VTEwpIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIp
OworICAgICAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5zcGlbaV0pLCB0
cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAgICAgICAgaWYgKCplcnJwICE9IE5VTEwpIHsKICAg
ICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQogICAgICAgICBidXNkZXYgPSBTWVNfQlVTX0RF
VklDRShkZXYpOwpkaWZmIC0tZ2l0IGEvaHcvYXJtL3Rvc2EuYyBiL2h3L2FybS90b3NhLmMKaW5k
ZXggNGQ5NWExZjNlMi4uNTY3YzU2ZjcyNiAxMDA2NDQKLS0tIGEvaHcvYXJtL3Rvc2EuYworKysg
Yi9ody9hcm0vdG9zYS5jCkBAIC0xMzgsNiArMTM4LDcgQEAgc3RhdGljIHVpbnQzMl90IHRvc2Ff
c3NwX3RhbnNmZXIoU1NJU2xhdmUgKmRldiwgdWludDMyX3QgdmFsdWUpCiAKIHN0YXRpYyB2b2lk
IHRvc2Ffc3NwX3JlYWxpemUoU1NJU2xhdmUgKmRldiwgRXJyb3IgKiplcnJwKQogeworCUVSUlBf
RlVOQ1RJT05fQkVHSU4oKTsKICAgICAvKiBOb3RoaW5nIHRvIGRvLiAgKi8KIH0KIApkaWZmIC0t
Z2l0IGEvaHcvYXJtL3hsbngtdmVyc2FsLXZpcnQuYyBiL2h3L2FybS94bG54LXZlcnNhbC12aXJ0
LmMKaW5kZXggNDYyNDkzYzQ2Ny4uMjIyM2QzMjgxYyAxMDA2NDQKLS0tIGEvaHcvYXJtL3hsbngt
dmVyc2FsLXZpcnQuYworKysgYi9ody9hcm0veGxueC12ZXJzYWwtdmlydC5jCkBAIC0yMzIsMTMg
KzIzMiwxMSBAQCBzdGF0aWMgdm9pZCBmZHRfYWRkX2dlbV9ub2RlcyhWZXJzYWxWaXJ0ICpzKQog
CiBzdGF0aWMgdm9pZCBmZHRfbm9wX21lbW9yeV9ub2Rlcyh2b2lkICpmZHQsIEVycm9yICoqZXJy
cCkKIHsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKICAgICBjaGFyICoqbm9kZV9wYXRoOwogICAg
IGludCBuID0gMDsKIAotICAgIG5vZGVfcGF0aCA9IHFlbXVfZmR0X25vZGVfdW5pdF9wYXRoKGZk
dCwgIm1lbW9yeSIsICZlcnIpOwotICAgIGlmIChlcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFn
YXRlKGVycnAsIGVycik7CisgICAgbm9kZV9wYXRoID0gcWVtdV9mZHRfbm9kZV91bml0X3BhdGgo
ZmR0LCAibWVtb3J5IiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsK
ICAgICB9CiAgICAgd2hpbGUgKG5vZGVfcGF0aFtuXSkgewpkaWZmIC0tZ2l0IGEvaHcvYXJtL3hs
bngtenlucW1wLmMgYi9ody9hcm0veGxueC16eW5xbXAuYwppbmRleCBmYjAzYzYwZWJiLi41NWQx
OTFlYTJiIDEwMDY0NAotLS0gYS9ody9hcm0veGxueC16eW5xbXAuYworKysgYi9ody9hcm0veGxu
eC16eW5xbXAuYwpAQCAtMTc2LDcgKzE3Niw2IEBAIHN0YXRpYyBpbmxpbmUgaW50IGFybV9naWNf
cHBpX2luZGV4KGludCBjcHVfbnIsIGludCBwcGlfaW5kZXgpCiBzdGF0aWMgdm9pZCB4bG54X3p5
bnFtcF9jcmVhdGVfcnB1KE1hY2hpbmVTdGF0ZSAqbXMsIFhsbnhaeW5xTVBTdGF0ZSAqcywKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hhciAqYm9vdF9jcHUsIEVy
cm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKICAgICBpbnQgaTsKICAgICBp
bnQgbnVtX3JwdXMgPSBNSU4obXMtPnNtcC5jcHVzIC0gWExOWF9aWU5RTVBfTlVNX0FQVV9DUFVT
LAogICAgICAgICAgICAgICAgICAgICAgICBYTE5YX1pZTlFNUF9OVU1fUlBVX0NQVVMpOwpAQCAt
MjEyLDkgKzIxMSw4IEBAIHN0YXRpYyB2b2lkIHhsbnhfenlucW1wX2NyZWF0ZV9ycHUoTWFjaGlu
ZVN0YXRlICptcywgWGxueFp5bnFNUFN0YXRlICpzLAogICAgICAgICBvYmplY3RfcHJvcGVydHlf
c2V0X2Jvb2woT0JKRUNUKCZzLT5ycHVfY3B1W2ldKSwgdHJ1ZSwgInJlc2V0LWhpdmVjcyIsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmZXJyb3JfYWJvcnQpOwogICAgICAgICBv
YmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5ycHVfY3B1W2ldKSwgdHJ1ZSwgInJl
YWxpemVkIiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZlcnIpOwotICAgICAg
ICBpZiAoZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycnApOworICAgICAgICBpZiAoKmVycnAp
IHsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQogICAgIH0KQEAgLTMwMyw3ICszMDEs
NiBAQCBzdGF0aWMgdm9pZCB4bG54X3p5bnFtcF9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVy
cm9yICoqZXJycCkKICAgICBjb25zdCBjaGFyICpib290X2NwdSA9IHMtPmJvb3RfY3B1ID8gcy0+
Ym9vdF9jcHUgOiAiYXB1LWNwdVswXSI7CiAgICAgcmFtX2FkZHJfdCBkZHJfbG93X3NpemUsIGRk
cl9oaWdoX3NpemU7CiAgICAgcWVtdV9pcnEgZ2ljX3NwaVtHSUNfTlVNX1NQSV9JTlRSXTsKLSAg
ICBFcnJvciAqZXJyID0gTlVMTDsKIAogICAgIHJhbV9zaXplID0gbWVtb3J5X3JlZ2lvbl9zaXpl
KHMtPmRkcl9yYW0pOwogCkBAIC0zODQsMTYgKzM4MSwxNCBAQCBzdGF0aWMgdm9pZCB4bG54X3p5
bnFtcF9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAgICAgICAgb2Jq
ZWN0X3Byb3BlcnR5X3NldF9pbnQoT0JKRUNUKCZzLT5hcHVfY3B1W2ldKSwgbnVtX2FwdXMsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJjb3JlLWNvdW50IiwgJmVycm9yX2Fib3J0
KTsKICAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+YXB1X2NwdVtp
XSksIHRydWUsICJyZWFsaXplZCIsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAm
ZXJyKTsKLSAgICAgICAgaWYgKGVycikgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVy
cnAsIGVycik7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJwKTsKKyAgICAg
ICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgIH0KICAgICB9CiAK
LSAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5naWMpLCB0cnVlLCAicmVh
bGl6ZWQiLCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShl
cnJwLCBlcnIpOworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPmdpYyks
IHRydWUsICJyZWFsaXplZCIsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1
cm47CiAgICAgfQogCkBAIC00NjEsOSArNDU2LDggQEAgc3RhdGljIHZvaWQgeGxueF96eW5xbXBf
cmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgICAgICAgICAgICAg
ICAgICJSUFVzIGp1c3QgdXNlIC1zbXAgNi4iKTsKICAgICB9CiAKLSAgICB4bG54X3p5bnFtcF9j
cmVhdGVfcnB1KG1zLCBzLCBib290X2NwdSwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAg
ICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICB4bG54X3p5bnFtcF9jcmVhdGVfcnB1
KG1zLCBzLCBib290X2NwdSwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVy
bjsKICAgICB9CiAKQEAgLTQ4Nyw5ICs0ODEsOCBAQCBzdGF0aWMgdm9pZCB4bG54X3p5bnFtcF9y
ZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgJmVycm9yX2Fib3J0KTsKICAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3Nl
dF9pbnQoT0JKRUNUKCZzLT5nZW1baV0pLCAyLCAibnVtLXByaW9yaXR5LXF1ZXVlcyIsCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICZlcnJvcl9hYm9ydCk7Ci0gICAgICAgIG9iamVj
dF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPmdlbVtpXSksIHRydWUsICJyZWFsaXplZCIs
ICZlcnIpOwotICAgICAgICBpZiAoZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUo
ZXJycCwgZXJyKTsKKyAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+
Z2VtW2ldKSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewog
ICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgICAgIHN5c2J1c19tbWlvX21hcChT
WVNfQlVTX0RFVklDRSgmcy0+Z2VtW2ldKSwgMCwgZ2VtX2FkZHJbaV0pOwpAQCAtNDk5LDkgKzQ5
Miw4IEBAIHN0YXRpYyB2b2lkIHhsbnhfenlucW1wX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwg
RXJyb3IgKiplcnJwKQogCiAgICAgZm9yIChpID0gMDsgaSA8IFhMTlhfWllOUU1QX05VTV9VQVJU
UzsgaSsrKSB7CiAgICAgICAgIHFkZXZfcHJvcF9zZXRfY2hyKERFVklDRSgmcy0+dWFydFtpXSks
ICJjaGFyZGV2Iiwgc2VyaWFsX2hkKGkpKTsKLSAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9i
b29sKE9CSkVDVCgmcy0+dWFydFtpXSksIHRydWUsICJyZWFsaXplZCIsICZlcnIpOwotICAgICAg
ICBpZiAoZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAg
ICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+dWFydFtpXSksIHRydWUs
ICJyZWFsaXplZCIsIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIHJl
dHVybjsKICAgICAgICAgfQogICAgICAgICBzeXNidXNfbW1pb19tYXAoU1lTX0JVU19ERVZJQ0Uo
JnMtPnVhcnRbaV0pLCAwLCB1YXJ0X2FkZHJbaV0pOwpAQCAtNTExLDkgKzUwMyw4IEBAIHN0YXRp
YyB2b2lkIHhsbnhfenlucW1wX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJw
KQogCiAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9pbnQoT0JKRUNUKCZzLT5zYXRhKSwgU0FUQV9O
VU1fUE9SVFMsICJudW0tcG9ydHMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICZlcnJv
cl9hYm9ydCk7Ci0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+c2F0YSks
IHRydWUsICJyZWFsaXplZCIsICZlcnIpOwotICAgIGlmIChlcnIpIHsKLSAgICAgICAgZXJyb3Jf
cHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVD
VCgmcy0+c2F0YSksIHRydWUsICJyZWFsaXplZCIsIGVycnApOworICAgIGlmICgqZXJycCkgewog
ICAgICAgICByZXR1cm47CiAgICAgfQogCkBAIC01MzAsMTIgKzUyMSwxMSBAQCBzdGF0aWMgdm9p
ZCB4bG54X3p5bnFtcF9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAg
ICAgICAgICogLSBTRElPIFNwZWNpZmljYXRpb24gVmVyc2lvbiAzLjAKICAgICAgICAgICogLSBl
TU1DIFNwZWNpZmljYXRpb24gVmVyc2lvbiA0LjUxCiAgICAgICAgICAqLwotICAgICAgICBvYmpl
Y3RfcHJvcGVydHlfc2V0X3VpbnQoc2RoY2ksIDMsICJzZC1zcGVjLXZlcnNpb24iLCAmZXJyKTsK
LSAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF91aW50KHNkaGNpLCBTREhDSV9DQVBBQklMSVRJ
RVMsICJjYXBhcmVnIiwgJmVycik7Ci0gICAgICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfdWludChz
ZGhjaSwgVUhTX0ksICJ1aHMiLCAmZXJyKTsKLSAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9i
b29sKHNkaGNpLCB0cnVlLCAicmVhbGl6ZWQiLCAmZXJyKTsKLSAgICAgICAgaWYgKGVycikgewot
ICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgICAgIG9iamVjdF9w
cm9wZXJ0eV9zZXRfdWludChzZGhjaSwgMywgInNkLXNwZWMtdmVyc2lvbiIsIGVycnApOworICAg
ICAgICBvYmplY3RfcHJvcGVydHlfc2V0X3VpbnQoc2RoY2ksIFNESENJX0NBUEFCSUxJVElFUywg
ImNhcGFyZWciLCBlcnJwKTsKKyAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF91aW50KHNkaGNp
LCBVSFNfSSwgInVocyIsIGVycnApOworICAgICAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2wo
c2RoY2ksIHRydWUsICJyZWFsaXplZCIsIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKICAg
ICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQogICAgICAgICBzeXNidXNfbW1pb19tYXAoc2Jk
LCAwLCBzZGhjaV9hZGRyW2ldKTsKQEAgLTU1MCw3ICs1NDAsNyBAQCBzdGF0aWMgdm9pZCB4bG54
X3p5bnFtcF9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAgICBmb3Ig
KGkgPSAwOyBpIDwgWExOWF9aWU5RTVBfTlVNX1NQSVM7IGkrKykgewogICAgICAgICBnY2hhciAq
YnVzX25hbWU7CiAKLSAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+
c3BpW2ldKSwgdHJ1ZSwgInJlYWxpemVkIiwgJmVycik7CisgICAgICAgIG9iamVjdF9wcm9wZXJ0
eV9zZXRfYm9vbChPQkpFQ1QoJnMtPnNwaVtpXSksIHRydWUsICJyZWFsaXplZCIsIGVycnApOwog
CiAgICAgICAgIHN5c2J1c19tbWlvX21hcChTWVNfQlVTX0RFVklDRSgmcy0+c3BpW2ldKSwgMCwg
c3BpX2FkZHJbaV0pOwogICAgICAgICBzeXNidXNfY29ubmVjdF9pcnEoU1lTX0JVU19ERVZJQ0Uo
JnMtPnNwaVtpXSksIDAsCkBAIC01NjQsNyArNTU0LDcgQEAgc3RhdGljIHZvaWQgeGxueF96eW5x
bXBfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgICAgIGdfZnJl
ZShidXNfbmFtZSk7CiAgICAgfQogCi0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVD
VCgmcy0+cXNwaSksIHRydWUsICJyZWFsaXplZCIsICZlcnIpOworICAgIG9iamVjdF9wcm9wZXJ0
eV9zZXRfYm9vbChPQkpFQ1QoJnMtPnFzcGkpLCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKICAg
ICBzeXNidXNfbW1pb19tYXAoU1lTX0JVU19ERVZJQ0UoJnMtPnFzcGkpLCAwLCBRU1BJX0FERFIp
OwogICAgIHN5c2J1c19tbWlvX21hcChTWVNfQlVTX0RFVklDRSgmcy0+cXNwaSksIDEsIExRU1BJ
X0FERFIpOwogICAgIHN5c2J1c19jb25uZWN0X2lycShTWVNfQlVTX0RFVklDRSgmcy0+cXNwaSks
IDAsIGdpY19zcGlbUVNQSV9JUlFdKTsKQEAgLTU4MywxNyArNTczLDE1IEBAIHN0YXRpYyB2b2lk
IHhsbnhfenlucW1wX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogICAg
ICAgICBnX2ZyZWUodGFyZ2V0X2J1cyk7CiAgICAgfQogCi0gICAgb2JqZWN0X3Byb3BlcnR5X3Nl
dF9ib29sKE9CSkVDVCgmcy0+ZHApLCB0cnVlLCAicmVhbGl6ZWQiLCAmZXJyKTsKLSAgICBpZiAo
ZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgIG9iamVjdF9w
cm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPmRwKSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7
CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAgICAgc3lzYnVzX21t
aW9fbWFwKFNZU19CVVNfREVWSUNFKCZzLT5kcCksIDAsIERQX0FERFIpOwogICAgIHN5c2J1c19j
b25uZWN0X2lycShTWVNfQlVTX0RFVklDRSgmcy0+ZHApLCAwLCBnaWNfc3BpW0RQX0lSUV0pOwog
Ci0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+ZHBkbWEpLCB0cnVlLCAi
cmVhbGl6ZWQiLCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0
ZShlcnJwLCBlcnIpOworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPmRw
ZG1hKSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAg
IHJldHVybjsKICAgICB9CiAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9saW5rKE9CSkVDVCgmcy0+
ZHApLCBPQkpFQ1QoJnMtPmRwZG1hKSwgImRwZG1hIiwKQEAgLTYwMSwyNyArNTg5LDI0IEBAIHN0
YXRpYyB2b2lkIHhsbnhfenlucW1wX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKipl
cnJwKQogICAgIHN5c2J1c19tbWlvX21hcChTWVNfQlVTX0RFVklDRSgmcy0+ZHBkbWEpLCAwLCBE
UERNQV9BRERSKTsKICAgICBzeXNidXNfY29ubmVjdF9pcnEoU1lTX0JVU19ERVZJQ0UoJnMtPmRw
ZG1hKSwgMCwgZ2ljX3NwaVtEUERNQV9JUlFdKTsKIAotICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRf
Ym9vbChPQkpFQ1QoJnMtPmlwaSksIHRydWUsICJyZWFsaXplZCIsICZlcnIpOwotICAgIGlmIChl
cnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgb2JqZWN0X3By
b3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+aXBpKSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7
CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAgICAgc3lzYnVzX21t
aW9fbWFwKFNZU19CVVNfREVWSUNFKCZzLT5pcGkpLCAwLCBJUElfQUREUik7CiAgICAgc3lzYnVz
X2Nvbm5lY3RfaXJxKFNZU19CVVNfREVWSUNFKCZzLT5pcGkpLCAwLCBnaWNfc3BpW0lQSV9JUlFd
KTsKIAotICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPnJ0YyksIHRydWUs
ICJyZWFsaXplZCIsICZlcnIpOwotICAgIGlmIChlcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFn
YXRlKGVycnAsIGVycik7CisgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+
cnRjKSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAg
IHJldHVybjsKICAgICB9CiAgICAgc3lzYnVzX21taW9fbWFwKFNZU19CVVNfREVWSUNFKCZzLT5y
dGMpLCAwLCBSVENfQUREUik7CiAgICAgc3lzYnVzX2Nvbm5lY3RfaXJxKFNZU19CVVNfREVWSUNF
KCZzLT5ydGMpLCAwLCBnaWNfc3BpW1JUQ19JUlFdKTsKIAogICAgIGZvciAoaSA9IDA7IGkgPCBY
TE5YX1pZTlFNUF9OVU1fR0RNQV9DSDsgaSsrKSB7Ci0gICAgICAgIG9iamVjdF9wcm9wZXJ0eV9z
ZXRfdWludChPQkpFQ1QoJnMtPmdkbWFbaV0pLCAxMjgsICJidXMtd2lkdGgiLCAmZXJyKTsKLSAg
ICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+Z2RtYVtpXSksIHRydWUs
ICJyZWFsaXplZCIsICZlcnIpOwotICAgICAgICBpZiAoZXJyKSB7Ci0gICAgICAgICAgICBlcnJv
cl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF91aW50
KE9CSkVDVCgmcy0+Z2RtYVtpXSksIDEyOCwgImJ1cy13aWR0aCIsIGVycnApOworICAgICAgICBv
YmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5nZG1hW2ldKSwgdHJ1ZSwgInJlYWxp
emVkIiwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgcmV0dXJuOwog
ICAgICAgICB9CiAKQEAgLTYzMSw5ICs2MTYsOCBAQCBzdGF0aWMgdm9pZCB4bG54X3p5bnFtcF9y
ZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAgICB9CiAKICAgICBmb3Ig
KGkgPSAwOyBpIDwgWExOWF9aWU5RTVBfTlVNX0FETUFfQ0g7IGkrKykgewotICAgICAgICBvYmpl
Y3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5hZG1hW2ldKSwgdHJ1ZSwgInJlYWxpemVk
IiwgJmVycik7Ci0gICAgICAgIGlmIChlcnIpIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0
ZShlcnJwLCBlcnIpOworICAgICAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZz
LT5hZG1hW2ldKSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkg
ewogICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CiAKZGlmZiAtLWdpdCBhL2h3L2F1ZGlv
L2ludGVsLWhkYS5jIGIvaHcvYXVkaW8vaW50ZWwtaGRhLmMKaW5kZXggNmVjZDM4MzU0MC4uMTNj
MmJlODFhYyAxMDA2NDQKLS0tIGEvaHcvYXVkaW8vaW50ZWwtaGRhLmMKKysrIGIvaHcvYXVkaW8v
aW50ZWwtaGRhLmMKQEAgLTEwOTcsNyArMTA5Nyw2IEBAIHN0YXRpYyB2b2lkIGludGVsX2hkYV9y
ZWFsaXplKFBDSURldmljZSAqcGNpLCBFcnJvciAqKmVycnApCiB7CiAgICAgSW50ZWxIREFTdGF0
ZSAqZCA9IElOVEVMX0hEQShwY2kpOwogICAgIHVpbnQ4X3QgKmNvbmYgPSBkLT5wY2kuY29uZmln
OwotICAgIEVycm9yICplcnIgPSBOVUxMOwogICAgIGludCByZXQ7CiAKICAgICBkLT5uYW1lID0g
b2JqZWN0X2dldF90eXBlbmFtZShPQkpFQ1QoZCkpOwpAQCAtMTEwOSwyMCArMTEwOCwxOSBAQCBz
dGF0aWMgdm9pZCBpbnRlbF9oZGFfcmVhbGl6ZShQQ0lEZXZpY2UgKnBjaSwgRXJyb3IgKiplcnJw
KQogCiAgICAgaWYgKGQtPm1zaSAhPSBPTl9PRkZfQVVUT19PRkYpIHsKICAgICAgICAgcmV0ID0g
bXNpX2luaXQoJmQtPnBjaSwgZC0+b2xkX21zaV9hZGRyID8gMHg1MCA6IDB4NjAsCi0gICAgICAg
ICAgICAgICAgICAgICAgIDEsIHRydWUsIGZhbHNlLCAmZXJyKTsKKyAgICAgICAgICAgICAgICAg
ICAgICAgMSwgdHJ1ZSwgZmFsc2UsIGVycnApOwogICAgICAgICAvKiBBbnkgZXJyb3Igb3RoZXIg
dGhhbiAtRU5PVFNVUChib2FyZCdzIE1TSSBzdXBwb3J0IGlzIGJyb2tlbikKICAgICAgICAgICog
aXMgYSBwcm9ncmFtbWluZyBlcnJvciAqLwogICAgICAgICBhc3NlcnQoIXJldCB8fCByZXQgPT0g
LUVOT1RTVVApOwogICAgICAgICBpZiAocmV0ICYmIGQtPm1zaSA9PSBPTl9PRkZfQVVUT19PTikg
ewogICAgICAgICAgICAgLyogQ2FuJ3Qgc2F0aXNmeSB1c2VyJ3MgZXhwbGljaXQgbXNpPW9uIHJl
cXVlc3QsIGZhaWwgKi8KLSAgICAgICAgICAgIGVycm9yX2FwcGVuZF9oaW50KCZlcnIsICJZb3Ug
aGF2ZSB0byB1c2UgbXNpPWF1dG8gKGRlZmF1bHQpIG9yICIKLSAgICAgICAgICAgICAgICAgICAg
Im1zaT1vZmYgd2l0aCB0aGlzIG1hY2hpbmUgdHlwZS5cbiIpOwotICAgICAgICAgICAgZXJyb3Jf
cHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgICAgICAgICBlcnJvcl9hcHBlbmRfaGludChlcnJw
LCAiWW91IGhhdmUgdG8gdXNlIG1zaT1hdXRvIChkZWZhdWx0KSBvciAiCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAibXNpPW9mZiB3aXRoIHRoaXMgbWFjaGluZSB0eXBlLlxuIik7CiAg
ICAgICAgICAgICByZXR1cm47CiAgICAgICAgIH0KLSAgICAgICAgYXNzZXJ0KCFlcnIgfHwgZC0+
bXNpID09IE9OX09GRl9BVVRPX0FVVE8pOworICAgICAgICBhc3NlcnQoISplcnJwIHx8IGQtPm1z
aSA9PSBPTl9PRkZfQVVUT19BVVRPKTsKICAgICAgICAgLyogV2l0aCBtc2k9YXV0bywgd2UgZmFs
bCBiYWNrIHRvIE1TSSBvZmYgc2lsZW50bHkgKi8KLSAgICAgICAgZXJyb3JfZnJlZShlcnIpOwor
ICAgICAgICBlcnJvcl9mcmVlX2VycnAoZXJycCk7CiAgICAgfQogCiAgICAgbWVtb3J5X3JlZ2lv
bl9pbml0X2lvKCZkLT5tbWlvLCBPQkpFQ1QoZCksICZpbnRlbF9oZGFfbW1pb19vcHMsIGQsCmRp
ZmYgLS1naXQgYS9ody9ibG9jay9kYXRhcGxhbmUveGVuLWJsb2NrLmMgYi9ody9ibG9jay9kYXRh
cGxhbmUveGVuLWJsb2NrLmMKaW5kZXggM2I5Y2FlYjJmYS4uYWUzZmNkOTMwOCAxMDA2NDQKLS0t
IGEvaHcvYmxvY2svZGF0YXBsYW5lL3hlbi1ibG9jay5jCisrKyBiL2h3L2Jsb2NrL2RhdGFwbGFu
ZS94ZW4tYmxvY2suYwpAQCAtNzI4LDcgKzcyOCw2IEBAIHZvaWQgeGVuX2Jsb2NrX2RhdGFwbGFu
ZV9zdGFydChYZW5CbG9ja0RhdGFQbGFuZSAqZGF0YXBsYW5lLAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIEVycm9yICoqZXJycCkKIHsKICAgICBYZW5EZXZpY2UgKnhlbmRldiA9IGRh
dGFwbGFuZS0+eGVuZGV2OwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIHVuc2ln
bmVkIGludCByaW5nX3NpemU7CiAgICAgdW5zaWduZWQgaW50IGk7CiAKQEAgLTc2NCw5ICs3NjMs
OCBAQCB2b2lkIHhlbl9ibG9ja19kYXRhcGxhbmVfc3RhcnQoWGVuQmxvY2tEYXRhUGxhbmUgKmRh
dGFwbGFuZSwKICAgICB9CiAKICAgICB4ZW5fZGV2aWNlX3NldF9tYXhfZ3JhbnRfcmVmcyh4ZW5k
ZXYsIGRhdGFwbGFuZS0+bnJfcmluZ19yZWYsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9w
cm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ290byBzdG9wOwogICAgIH0K
IApAQCAtNzc0LDkgKzc3Miw4IEBAIHZvaWQgeGVuX2Jsb2NrX2RhdGFwbGFuZV9zdGFydChYZW5C
bG9ja0RhdGFQbGFuZSAqZGF0YXBsYW5lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGRhdGFwbGFuZS0+cmluZ19yZWYsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YXBsYW5lLT5ucl9yaW5nX3JlZiwKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQUk9UX1JFQUQgfCBQUk9U
X1dSSVRFLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZs
b2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRl
KGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8gc3RvcDsKICAg
ICB9CiAKQEAgLTgwOSw5ICs4MDYsOCBAQCB2b2lkIHhlbl9ibG9ja19kYXRhcGxhbmVfc3RhcnQo
WGVuQmxvY2tEYXRhUGxhbmUgKmRhdGFwbGFuZSwKICAgICBkYXRhcGxhbmUtPmV2ZW50X2NoYW5u
ZWwgPQogICAgICAgICB4ZW5fZGV2aWNlX2JpbmRfZXZlbnRfY2hhbm5lbCh4ZW5kZXYsIGRhdGFw
bGFuZS0+Y3R4LCBldmVudF9jaGFubmVsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICB4ZW5fYmxvY2tfZGF0YXBsYW5lX2V2ZW50LCBkYXRhcGxhbmUsCi0gICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9l
cnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycnApOworICAgIGlmICgqZXJycCkgewog
ICAgICAgICBnb3RvIHN0b3A7CiAgICAgfQogCmRpZmYgLS1naXQgYS9ody9ibG9jay9mZGMuYyBi
L2h3L2Jsb2NrL2ZkYy5jCmluZGV4IGFjNWQzMWU4YzEuLjEwMTljYWU0ZWIgMTAwNjQ0Ci0tLSBh
L2h3L2Jsb2NrL2ZkYy5jCisrKyBiL2h3L2Jsb2NrL2ZkYy5jCkBAIC0yNTI2LDcgKzI1MjYsNiBA
QCBzdGF0aWMgdm9pZCBmZGN0cmxfY29ubmVjdF9kcml2ZXMoRkRDdHJsICpmZGN0cmwsIERldmlj
ZVN0YXRlICpmZGNfZGV2LAogICAgIEZEcml2ZSAqZHJpdmU7CiAgICAgRGV2aWNlU3RhdGUgKmRl
djsKICAgICBCbG9ja0JhY2tlbmQgKmJsazsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsK
IAogICAgIGZvciAoaSA9IDA7IGkgPCBNQVhfRkQ7IGkrKykgewogICAgICAgICBkcml2ZSA9ICZm
ZGN0cmwtPmRyaXZlc1tpXTsKQEAgLTI1NDgsMTcgKzI1NDcsMTUgQEAgc3RhdGljIHZvaWQgZmRj
dHJsX2Nvbm5lY3RfZHJpdmVzKEZEQ3RybCAqZmRjdHJsLCBEZXZpY2VTdGF0ZSAqZmRjX2RldiwK
ICAgICAgICAgYmxrX3JlZihibGspOwogICAgICAgICBibGtfZGV0YWNoX2RldihibGssIGZkY19k
ZXYpOwogICAgICAgICBmZGN0cmwtPnFkZXZfZm9yX2RyaXZlc1tpXS5ibGsgPSBOVUxMOwotICAg
ICAgICBxZGV2X3Byb3Bfc2V0X2RyaXZlKGRldiwgImRyaXZlIiwgYmxrLCAmbG9jYWxfZXJyKTsK
KyAgICAgICAgcWRldl9wcm9wX3NldF9kcml2ZShkZXYsICJkcml2ZSIsIGJsaywgZXJycCk7CiAg
ICAgICAgIGJsa191bnJlZihibGspOwogCi0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAg
ICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICBpZiAoKmVy
cnApIHsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQogCi0gICAgICAgIG9iamVjdF9w
cm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoZGV2KSwgdHJ1ZSwgInJlYWxpemVkIiwgJmxvY2FsX2Vy
cik7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0
ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JK
RUNUKGRldiksIHRydWUsICJyZWFsaXplZCIsIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsK
ICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQogICAgIH0KQEAgLTI2ODgsNyArMjY4NSw2
IEBAIHN0YXRpYyB2b2lkIGlzYWJ1c19mZGNfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJv
ciAqKmVycnApCiAgICAgSVNBRGV2aWNlICppc2FkZXYgPSBJU0FfREVWSUNFKGRldik7CiAgICAg
RkRDdHJsSVNBQnVzICppc2EgPSBJU0FfRkRDKGRldik7CiAgICAgRkRDdHJsICpmZGN0cmwgPSAm
aXNhLT5zdGF0ZTsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKIAogICAgIGlzYV9yZWdpc3Rlcl9w
b3J0aW9fbGlzdChpc2FkZXYsICZmZGN0cmwtPnBvcnRpb19saXN0LAogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBpc2EtPmlvYmFzZSwgZmRjX3BvcnRpb19saXN0LCBmZGN0cmwsCkBAIC0y
NzA1LDkgKzI3MDEsOCBAQCBzdGF0aWMgdm9pZCBpc2FidXNfZmRjX3JlYWxpemUoRGV2aWNlU3Rh
dGUgKmRldiwgRXJyb3IgKiplcnJwKQogICAgIH0KIAogICAgIHFkZXZfc2V0X2xlZ2FjeV9pbnN0
YW5jZV9pZChkZXYsIGlzYS0+aW9iYXNlLCAyKTsKLSAgICBmZGN0cmxfcmVhbGl6ZV9jb21tb24o
ZGV2LCBmZGN0cmwsICZlcnIpOwotICAgIGlmIChlcnIgIT0gTlVMTCkgewotICAgICAgICBlcnJv
cl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICBmZGN0cmxfcmVhbGl6ZV9jb21tb24oZGV2LCBm
ZGN0cmwsIGVycnApOworICAgIGlmICgqZXJycCAhPSBOVUxMKSB7CiAgICAgICAgIHJldHVybjsK
ICAgICB9CiB9CmRpZmYgLS1naXQgYS9ody9ibG9jay9vbmVuYW5kLmMgYi9ody9ibG9jay9vbmVu
YW5kLmMKaW5kZXggZmNjNWE2OWI5MC4uNDhhZjA3YmIxMSAxMDA2NDQKLS0tIGEvaHcvYmxvY2sv
b25lbmFuZC5jCisrKyBiL2h3L2Jsb2NrL29uZW5hbmQuYwpAQCAtNzgwLDcgKzc4MCw2IEBAIHN0
YXRpYyB2b2lkIG9uZW5hbmRfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnAp
CiAgICAgT25lTkFORFN0YXRlICpzID0gT05FX05BTkQoZGV2KTsKICAgICB1aW50MzJfdCBzaXpl
ID0gMSA8PCAoMjQgKyAoKHMtPmlkLmRldiA+PiA0KSAmIDcpKTsKICAgICB2b2lkICpyYW07Ci0g
ICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICBzLT5iYXNlID0gKGh3YWRkciktMTsK
ICAgICBzLT5yZHkgPSBOVUxMOwpAQCAtODAwLDkgKzc5OSw4IEBAIHN0YXRpYyB2b2lkIG9uZW5h
bmRfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgICAgICAgICBy
ZXR1cm47CiAgICAgICAgIH0KICAgICAgICAgYmxrX3NldF9wZXJtKHMtPmJsaywgQkxLX1BFUk1f
Q09OU0lTVEVOVF9SRUFEIHwgQkxLX1BFUk1fV1JJVEUsCi0gICAgICAgICAgICAgICAgICAgICBC
TEtfUEVSTV9BTEwsICZsb2NhbF9lcnIpOwotICAgICAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAg
ICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgICAgICAg
ICAgICAgIEJMS19QRVJNX0FMTCwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAg
ICAgICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgICAgIHMtPmJsa19jdXIgPSBzLT5ibGs7CmRp
ZmYgLS1naXQgYS9ody9ibG9jay9wZmxhc2hfY2ZpMDEuYyBiL2h3L2Jsb2NrL3BmbGFzaF9jZmkw
MS5jCmluZGV4IDU2NmMwYWNiNzcuLjRiYTU1OTY3N2UgMTAwNjQ0Ci0tLSBhL2h3L2Jsb2NrL3Bm
bGFzaF9jZmkwMS5jCisrKyBiL2h3L2Jsb2NrL3BmbGFzaF9jZmkwMS5jCkBAIC03MDUsNyArNzA1
LDYgQEAgc3RhdGljIHZvaWQgcGZsYXNoX2NmaTAxX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwg
RXJyb3IgKiplcnJwKQogICAgIGludCByZXQ7CiAgICAgdWludDY0X3QgYmxvY2tzX3Blcl9kZXZp
Y2UsIHNlY3Rvcl9sZW5fcGVyX2RldmljZSwgZGV2aWNlX2xlbjsKICAgICBpbnQgbnVtX2Rldmlj
ZXM7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICBpZiAocGZsLT5zZWN0b3Jf
bGVuID09IDApIHsKICAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAiYXR0cmlidXRlIFwic2VjdG9y
LWxlbmd0aFwiIG5vdCBzcGVjaWZpZWQgb3IgemVyby4iKTsKQEAgLTczOSw5ICs3MzgsOCBAQCBz
dGF0aWMgdm9pZCBwZmxhc2hfY2ZpMDFfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAq
KmVycnApCiAgICAgICAgICZwZmwtPm1lbSwgT0JKRUNUKGRldiksCiAgICAgICAgICZwZmxhc2hf
Y2ZpMDFfb3BzLAogICAgICAgICBwZmwsCi0gICAgICAgIHBmbC0+bmFtZSwgdG90YWxfbGVuLCAm
bG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0
ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICBwZmwtPm5hbWUsIHRvdGFsX2xlbiwgZXJycCk7
CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKZGlmZiAtLWdpdCBh
L2h3L2Jsb2NrL3BmbGFzaF9jZmkwMi5jIGIvaHcvYmxvY2svcGZsYXNoX2NmaTAyLmMKaW5kZXgg
NGJhY2E3MDFiNy4uZDUxMTBjMTJkMCAxMDA2NDQKLS0tIGEvaHcvYmxvY2svcGZsYXNoX2NmaTAy
LmMKKysrIGIvaHcvYmxvY2svcGZsYXNoX2NmaTAyLmMKQEAgLTcyMSw3ICs3MjEsNiBAQCBzdGF0
aWMgdm9pZCBwZmxhc2hfY2ZpMDJfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVy
cnApCiB7CiAgICAgUEZsYXNoQ0ZJMDIgKnBmbCA9IFBGTEFTSF9DRkkwMihkZXYpOwogICAgIGlu
dCByZXQ7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICBpZiAocGZsLT51bmlm
b3JtX3NlY3Rvcl9sZW4gPT0gMCAmJiBwZmwtPnNlY3Rvcl9sZW5bMF0gPT0gMCkgewogICAgICAg
ICBlcnJvcl9zZXRnKGVycnAsICJhdHRyaWJ1dGUgXCJzZWN0b3ItbGVuZ3RoXCIgbm90IHNwZWNp
ZmllZCBvciB6ZXJvLiIpOwpAQCAtNzg3LDkgKzc4Niw4IEBAIHN0YXRpYyB2b2lkIHBmbGFzaF9j
ZmkwMl9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKIAogICAgIG1lbW9y
eV9yZWdpb25faW5pdF9yb21fZGV2aWNlKCZwZmwtPm9yaWdfbWVtLCBPQkpFQ1QocGZsKSwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmcGZsYXNoX2NmaTAyX29wcywgcGZsLCBw
ZmwtPm5hbWUsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGZsLT5jaGlwX2xl
biwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9w
YWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBwZmwtPmNoaXBfbGVuLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJu
OwogICAgIH0KIApkaWZmIC0tZ2l0IGEvaHcvYmxvY2svdmhvc3QtdXNlci1ibGsuYyBiL2h3L2Js
b2NrL3Zob3N0LXVzZXItYmxrLmMKaW5kZXggNjNkYTliYjYxOS4uNTkwNmZhYzZhYSAxMDA2NDQK
LS0tIGEvaHcvYmxvY2svdmhvc3QtdXNlci1ibGsuYworKysgYi9ody9ibG9jay92aG9zdC11c2Vy
LWJsay5jCkBAIC0zOTAsNyArMzkwLDYgQEAgc3RhdGljIHZvaWQgdmhvc3RfdXNlcl9ibGtfZGV2
aWNlX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogewogICAgIFZpcnRJ
T0RldmljZSAqdmRldiA9IFZJUlRJT19ERVZJQ0UoZGV2KTsKICAgICBWSG9zdFVzZXJCbGsgKnMg
PSBWSE9TVF9VU0VSX0JMSyh2ZGV2KTsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKICAgICBpbnQg
aSwgcmV0OwogCiAgICAgaWYgKCFzLT5jaGFyZGV2LmNocikgewpAQCAtNDI5LDggKzQyOCw4IEBA
IHN0YXRpYyB2b2lkIHZob3N0X3VzZXJfYmxrX2RldmljZV9yZWFsaXplKERldmljZVN0YXRlICpk
ZXYsIEVycm9yICoqZXJycCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTlVMTCwgKHZv
aWQgKilkZXYsIE5VTEwsIHRydWUpOwogCiByZWNvbm5lY3Q6Ci0gICAgaWYgKHFlbXVfY2hyX2Zl
X3dhaXRfY29ubmVjdGVkKCZzLT5jaGFyZGV2LCAmZXJyKSA8IDApIHsKLSAgICAgICAgZXJyb3Jf
cmVwb3J0X2VycihlcnIpOworICAgIGlmIChxZW11X2Nocl9mZV93YWl0X2Nvbm5lY3RlZCgmcy0+
Y2hhcmRldiwgZXJycCkgPCAwKSB7CisgICAgICAgIGVycm9yX3JlcG9ydF9lcnJwKGVycnApOwog
ICAgICAgICBnb3RvIHZpcnRpb19lcnI7CiAgICAgfQogCmRpZmYgLS1naXQgYS9ody9ibG9jay92
aXJ0aW8tYmxrLmMgYi9ody9ibG9jay92aXJ0aW8tYmxrLmMKaW5kZXggMTg4NTE2MDFjYi4uM2E3
NmYyMzFjOSAxMDA2NDQKLS0tIGEvaHcvYmxvY2svdmlydGlvLWJsay5jCisrKyBiL2h3L2Jsb2Nr
L3ZpcnRpby1ibGsuYwpAQCAtMTEwMiw3ICsxMTAyLDYgQEAgc3RhdGljIHZvaWQgdmlydGlvX2Js
a19kZXZpY2VfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgVmly
dElPRGV2aWNlICp2ZGV2ID0gVklSVElPX0RFVklDRShkZXYpOwogICAgIFZpcnRJT0Jsb2NrICpz
ID0gVklSVElPX0JMSyhkZXYpOwogICAgIFZpcnRJT0Jsa0NvbmYgKmNvbmYgPSAmcy0+Y29uZjsK
LSAgICBFcnJvciAqZXJyID0gTlVMTDsKICAgICB1bnNpZ25lZCBpOwogCiAgICAgaWYgKCFjb25m
LT5jb25mLmJsaykgewpAQCAtMTE3NCw5ICsxMTczLDggQEAgc3RhdGljIHZvaWQgdmlydGlvX2Js
a19kZXZpY2VfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgZm9y
IChpID0gMDsgaSA8IGNvbmYtPm51bV9xdWV1ZXM7IGkrKykgewogICAgICAgICB2aXJ0aW9fYWRk
X3F1ZXVlKHZkZXYsIGNvbmYtPnF1ZXVlX3NpemUsIHZpcnRpb19ibGtfaGFuZGxlX291dHB1dCk7
CiAgICAgfQotICAgIHZpcnRpb19ibGtfZGF0YV9wbGFuZV9jcmVhdGUodmRldiwgY29uZiwgJnMt
PmRhdGFwbGFuZSwgJmVycik7Ci0gICAgaWYgKGVyciAhPSBOVUxMKSB7Ci0gICAgICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgIHZpcnRpb19ibGtfZGF0YV9wbGFuZV9jcmVhdGUo
dmRldiwgY29uZiwgJnMtPmRhdGFwbGFuZSwgZXJycCk7CisgICAgaWYgKCplcnJwICE9IE5VTEwp
IHsKICAgICAgICAgdmlydGlvX2NsZWFudXAodmRldik7CiAgICAgICAgIHJldHVybjsKICAgICB9
CmRpZmYgLS1naXQgYS9ody9ibG9jay94ZW4tYmxvY2suYyBiL2h3L2Jsb2NrL3hlbi1ibG9jay5j
CmluZGV4IGY3NzM0M2RiNjAuLjdjZGVmZDA2NTYgMTAwNjQ0Ci0tLSBhL2h3L2Jsb2NrL3hlbi1i
bG9jay5jCisrKyBiL2h3L2Jsb2NrL3hlbi1ibG9jay5jCkBAIC0yMDEsNyArMjAxLDYgQEAgc3Rh
dGljIHZvaWQgeGVuX2Jsb2NrX3JlYWxpemUoWGVuRGV2aWNlICp4ZW5kZXYsIEVycm9yICoqZXJy
cCkKICAgICBYZW5CbG9ja1ZkZXYgKnZkZXYgPSAmYmxvY2tkZXYtPnByb3BzLnZkZXY7CiAgICAg
QmxvY2tDb25mICpjb25mID0gJmJsb2NrZGV2LT5wcm9wcy5jb25mOwogICAgIEJsb2NrQmFja2Vu
ZCAqYmxrID0gY29uZi0+YmxrOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAg
aWYgKHZkZXYtPnR5cGUgPT0gWEVOX0JMT0NLX1ZERVZfVFlQRV9JTlZBTElEKSB7CiAgICAgICAg
IGVycm9yX3NldGcoZXJycCwgInZkZXYgcHJvcGVydHkgbm90IHNldCIpOwpAQCAtMjExLDkgKzIx
MCw4IEBAIHN0YXRpYyB2b2lkIHhlbl9ibG9ja19yZWFsaXplKFhlbkRldmljZSAqeGVuZGV2LCBF
cnJvciAqKmVycnApCiAgICAgdHJhY2VfeGVuX2Jsb2NrX3JlYWxpemUodHlwZSwgdmRldi0+ZGlz
aywgdmRldi0+cGFydGl0aW9uKTsKIAogICAgIGlmIChibG9ja2Rldl9jbGFzcy0+cmVhbGl6ZSkg
ewotICAgICAgICBibG9ja2Rldl9jbGFzcy0+cmVhbGl6ZShibG9ja2RldiwgJmxvY2FsX2Vycik7
Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShl
cnJwLCBsb2NhbF9lcnIpOworICAgICAgICBibG9ja2Rldl9jbGFzcy0+cmVhbGl6ZShibG9ja2Rl
diwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgcmV0dXJuOwogICAg
ICAgICB9CiAgICAgfQpAQCAtMjg0LDcgKzI4Miw2IEBAIHN0YXRpYyB2b2lkIHhlbl9ibG9ja19m
cm9udGVuZF9jaGFuZ2VkKFhlbkRldmljZSAqeGVuZGV2LAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJwKQogewogICAgIGVudW0geGVuYnVzX3N0YXRl
IGJhY2tlbmRfc3RhdGUgPSB4ZW5fZGV2aWNlX2JhY2tlbmRfZ2V0X3N0YXRlKHhlbmRldik7Ci0g
ICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICBzd2l0Y2ggKGZyb250ZW5kX3N0YXRl
KSB7CiAgICAgY2FzZSBYZW5idXNTdGF0ZUluaXRpYWxpc2VkOgpAQCAtMjkzLDE1ICsyOTAsMTMg
QEAgc3RhdGljIHZvaWQgeGVuX2Jsb2NrX2Zyb250ZW5kX2NoYW5nZWQoWGVuRGV2aWNlICp4ZW5k
ZXYsCiAgICAgICAgICAgICBicmVhazsKICAgICAgICAgfQogCi0gICAgICAgIHhlbl9ibG9ja19k
aXNjb25uZWN0KHhlbmRldiwgJmxvY2FsX2Vycik7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsK
LSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICB4
ZW5fYmxvY2tfZGlzY29ubmVjdCh4ZW5kZXYsIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsK
ICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICB9CiAKLSAgICAgICAgeGVuX2Jsb2NrX2Nvbm5l
Y3QoeGVuZGV2LCAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAgICAg
ICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgIHhlbl9ibG9j
a19jb25uZWN0KHhlbmRldiwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAg
ICAgYnJlYWs7CiAgICAgICAgIH0KIApAQCAtMzEzLDkgKzMwOCw4IEBAIHN0YXRpYyB2b2lkIHhl
bl9ibG9ja19mcm9udGVuZF9jaGFuZ2VkKFhlbkRldmljZSAqeGVuZGV2LAogICAgICAgICBicmVh
azsKIAogICAgIGNhc2UgWGVuYnVzU3RhdGVDbG9zZWQ6Ci0gICAgICAgIHhlbl9ibG9ja19kaXNj
b25uZWN0KHhlbmRldiwgJmxvY2FsX2Vycik7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsKLSAg
ICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICB4ZW5f
YmxvY2tfZGlzY29ubmVjdCh4ZW5kZXYsIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKICAg
ICAgICAgICAgIGJyZWFrOwogICAgICAgICB9CiAKQEAgLTQwNSw3ICszOTksNiBAQCBzdGF0aWMg
dm9pZCB4ZW5fYmxvY2tfc2V0X3ZkZXYoT2JqZWN0ICpvYmosIFZpc2l0b3IgKnYsIGNvbnN0IGNo
YXIgKm5hbWUsCiAgICAgRGV2aWNlU3RhdGUgKmRldiA9IERFVklDRShvYmopOwogICAgIFByb3Bl
cnR5ICpwcm9wID0gb3BhcXVlOwogICAgIFhlbkJsb2NrVmRldiAqdmRldiA9IHFkZXZfZ2V0X3By
b3BfcHRyKGRldiwgcHJvcCk7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgY2hh
ciAqc3RyLCAqcDsKICAgICBjb25zdCBjaGFyICplbmQ7CiAKQEAgLTQxNCw5ICs0MDcsOCBAQCBz
dGF0aWMgdm9pZCB4ZW5fYmxvY2tfc2V0X3ZkZXYoT2JqZWN0ICpvYmosIFZpc2l0b3IgKnYsIGNv
bnN0IGNoYXIgKm5hbWUsCiAgICAgICAgIHJldHVybjsKICAgICB9CiAKLSAgICB2aXNpdF90eXBl
X3N0cih2LCBuYW1lLCAmc3RyLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0g
ICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHZpc2l0X3R5cGVf
c3RyKHYsIG5hbWUsICZzdHIsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1
cm47CiAgICAgfQogCkBAIC02NzIsNyArNjY0LDYgQEAgc3RhdGljIGNoYXIgKnhlbl9ibG9ja19i
bG9ja2Rldl9hZGQoY29uc3QgY2hhciAqaWQsIFFEaWN0ICpxZGljdCwKIHsKICAgICBjb25zdCBj
aGFyICpkcml2ZXIgPSBxZGljdF9nZXRfdHJ5X3N0cihxZGljdCwgImRyaXZlciIpOwogICAgIEJs
b2NrZGV2T3B0aW9ucyAqb3B0aW9ucyA9IE5VTEw7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5V
TEw7CiAgICAgY2hhciAqbm9kZV9uYW1lOwogICAgIFZpc2l0b3IgKnY7CiAKQEAgLTY4NywxOCAr
Njc4LDE2IEBAIHN0YXRpYyBjaGFyICp4ZW5fYmxvY2tfYmxvY2tkZXZfYWRkKGNvbnN0IGNoYXIg
KmlkLCBRRGljdCAqcWRpY3QsCiAgICAgdHJhY2VfeGVuX2Jsb2NrX2Jsb2NrZGV2X2FkZChub2Rl
X25hbWUpOwogCiAgICAgdiA9IHFvYmplY3RfaW5wdXRfdmlzaXRvcl9uZXcoUU9CSkVDVChxZGlj
dCkpOwotICAgIHZpc2l0X3R5cGVfQmxvY2tkZXZPcHRpb25zKHYsIE5VTEwsICZvcHRpb25zLCAm
bG9jYWxfZXJyKTsKKyAgICB2aXNpdF90eXBlX0Jsb2NrZGV2T3B0aW9ucyh2LCBOVUxMLCAmb3B0
aW9ucywgZXJycCk7CiAgICAgdmlzaXRfZnJlZSh2KTsKIAotICAgIGlmIChsb2NhbF9lcnIpIHsK
LSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgaWYgKCplcnJw
KSB7CiAgICAgICAgIGdvdG8gZmFpbDsKICAgICB9CiAKLSAgICBxbXBfYmxvY2tkZXZfYWRkKG9w
dGlvbnMsICZsb2NhbF9lcnIpOworICAgIHFtcF9ibG9ja2Rldl9hZGQob3B0aW9ucywgZXJycCk7
CiAKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBs
b2NhbF9lcnIpOworICAgIGlmICgqZXJycCkgewogICAgICAgICBnb3RvIGZhaWw7CiAgICAgfQog
CkBAIC03MjAsMTEgKzcwOSw4IEBAIHN0YXRpYyB2b2lkIHhlbl9ibG9ja19kcml2ZV9kZXN0cm95
KFhlbkJsb2NrRHJpdmUgKmRyaXZlLCBFcnJvciAqKmVycnApCiAgICAgY2hhciAqbm9kZV9uYW1l
ID0gZHJpdmUtPm5vZGVfbmFtZTsKIAogICAgIGlmIChub2RlX25hbWUpIHsKLSAgICAgICAgRXJy
b3IgKmxvY2FsX2VyciA9IE5VTEw7Ci0KLSAgICAgICAgeGVuX2Jsb2NrX2Jsb2NrZGV2X2RlbChu
b2RlX25hbWUsICZsb2NhbF9lcnIpOwotICAgICAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAg
ICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgeGVuX2Jsb2Nr
X2Jsb2NrZGV2X2RlbChub2RlX25hbWUsIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKICAg
ICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQogICAgICAgICBnX2ZyZWUobm9kZV9uYW1lKTsK
QEAgLTc0NSw3ICs3MzEsNiBAQCBzdGF0aWMgWGVuQmxvY2tEcml2ZSAqeGVuX2Jsb2NrX2RyaXZl
X2NyZWF0ZShjb25zdCBjaGFyICppZCwKICAgICBjaGFyICpkcml2ZXIgPSBOVUxMOwogICAgIGNo
YXIgKmZpbGVuYW1lID0gTlVMTDsKICAgICBYZW5CbG9ja0RyaXZlICpkcml2ZSA9IE5VTEw7Ci0g
ICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgUURpY3QgKmZpbGVfbGF5ZXI7CiAgICAg
UURpY3QgKmRyaXZlcl9sYXllcjsKIApAQCAtODI0LDEzICs4MDksMTIgQEAgc3RhdGljIFhlbkJs
b2NrRHJpdmUgKnhlbl9ibG9ja19kcml2ZV9jcmVhdGUoY29uc3QgY2hhciAqaWQsCiAKICAgICBn
X2Fzc2VydCghZHJpdmUtPm5vZGVfbmFtZSk7CiAgICAgZHJpdmUtPm5vZGVfbmFtZSA9IHhlbl9i
bG9ja19ibG9ja2Rldl9hZGQoZHJpdmUtPmlkLCBkcml2ZXJfbGF5ZXIsCi0gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJmxvY2FsX2Vycik7CisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJycCk7CiAKICAgICBxb2JqZWN0
X3VucmVmKGRyaXZlcl9sYXllcik7CiAKIGRvbmU6Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAg
ICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBpZiAoKmVycnApIHsK
ICAgICAgICAgeGVuX2Jsb2NrX2RyaXZlX2Rlc3Ryb3koZHJpdmUsIE5VTEwpOwogICAgICAgICBy
ZXR1cm4gTlVMTDsKICAgICB9CkBAIC04NTYsMTQgKzg0MCwxMSBAQCBzdGF0aWMgWGVuQmxvY2tJ
T1RocmVhZCAqeGVuX2Jsb2NrX2lvdGhyZWFkX2NyZWF0ZShjb25zdCBjaGFyICppZCwKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVycm9yICoqZXJy
cCkKIHsKICAgICBYZW5CbG9ja0lPVGhyZWFkICppb3RocmVhZCA9IGdfbmV3KFhlbkJsb2NrSU9U
aHJlYWQsIDEpOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgaW90aHJlYWQt
PmlkID0gZ19zdHJkdXAoaWQpOwogCi0gICAgcW1wX29iamVjdF9hZGQoVFlQRV9JT1RIUkVBRCwg
aWQsIGZhbHNlLCBOVUxMLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAg
ICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwotCisgICAgcW1wX29iamVjdF9h
ZGQoVFlQRV9JT1RIUkVBRCwgaWQsIGZhbHNlLCBOVUxMLCBlcnJwKTsKKyAgICBpZiAoKmVycnAp
IHsKICAgICAgICAgZ19mcmVlKGlvdGhyZWFkLT5pZCk7CiAgICAgICAgIGdfZnJlZShpb3RocmVh
ZCk7CiAgICAgICAgIHJldHVybiBOVUxMOwpAQCAtODgyLDcgKzg2Myw2IEBAIHN0YXRpYyB2b2lk
IHhlbl9ibG9ja19kZXZpY2VfY3JlYXRlKFhlbkJhY2tlbmRJbnN0YW5jZSAqYmFja2VuZCwKICAg
ICBYZW5CbG9ja0RyaXZlICpkcml2ZSA9IE5VTEw7CiAgICAgWGVuQmxvY2tJT1RocmVhZCAqaW90
aHJlYWQgPSBOVUxMOwogICAgIFhlbkRldmljZSAqeGVuZGV2ID0gTlVMTDsKLSAgICBFcnJvciAq
bG9jYWxfZXJyID0gTlVMTDsKICAgICBjb25zdCBjaGFyICp0eXBlOwogICAgIFhlbkJsb2NrRGV2
aWNlICpibG9ja2RldjsKIApAQCAtOTE0LDE1ICs4OTQsMTUgQEAgc3RhdGljIHZvaWQgeGVuX2Js
b2NrX2RldmljZV9jcmVhdGUoWGVuQmFja2VuZEluc3RhbmNlICpiYWNrZW5kLAogICAgICAgICBn
b3RvIGZhaWw7CiAgICAgfQogCi0gICAgZHJpdmUgPSB4ZW5fYmxvY2tfZHJpdmVfY3JlYXRlKHZk
ZXYsIGRldmljZV90eXBlLCBvcHRzLCAmbG9jYWxfZXJyKTsKKyAgICBkcml2ZSA9IHhlbl9ibG9j
a19kcml2ZV9jcmVhdGUodmRldiwgZGV2aWNlX3R5cGUsIG9wdHMsIGVycnApOwogICAgIGlmICgh
ZHJpdmUpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlX3ByZXBlbmQoZXJycCwgbG9jYWxfZXJy
LCAiZmFpbGVkIHRvIGNyZWF0ZSBkcml2ZTogIik7CisgICAgICAgIGVycm9yX3Byb3BhZ2F0ZV9w
cmVwZW5kKGVycnAsICplcnJwLCAiZmFpbGVkIHRvIGNyZWF0ZSBkcml2ZTogIik7CiAgICAgICAg
IGdvdG8gZmFpbDsKICAgICB9CiAKLSAgICBpb3RocmVhZCA9IHhlbl9ibG9ja19pb3RocmVhZF9j
cmVhdGUodmRldiwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBl
cnJvcl9wcm9wYWdhdGVfcHJlcGVuZChlcnJwLCBsb2NhbF9lcnIsCisgICAgaW90aHJlYWQgPSB4
ZW5fYmxvY2tfaW90aHJlYWRfY3JlYXRlKHZkZXYsIGVycnApOworICAgIGlmICgqZXJycCkgewor
ICAgICAgICBlcnJvcl9wcm9wYWdhdGVfcHJlcGVuZChlcnJwLCAqZXJycCwKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgImZhaWxlZCB0byBjcmVhdGUgaW90aHJlYWQ6ICIpOwogICAg
ICAgICBnb3RvIGZhaWw7CiAgICAgfQpAQCAtOTMwLDI0ICs5MTAsMjQgQEAgc3RhdGljIHZvaWQg
eGVuX2Jsb2NrX2RldmljZV9jcmVhdGUoWGVuQmFja2VuZEluc3RhbmNlICpiYWNrZW5kLAogICAg
IHhlbmRldiA9IFhFTl9ERVZJQ0UocWRldl9jcmVhdGUoQlVTKHhlbmJ1cyksIHR5cGUpKTsKICAg
ICBibG9ja2RldiA9IFhFTl9CTE9DS19ERVZJQ0UoeGVuZGV2KTsKIAotICAgIG9iamVjdF9wcm9w
ZXJ0eV9zZXRfc3RyKE9CSkVDVCh4ZW5kZXYpLCB2ZGV2LCAidmRldiIsICZsb2NhbF9lcnIpOwot
ICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlX3ByZXBlbmQoZXJy
cCwgbG9jYWxfZXJyLCAiZmFpbGVkIHRvIHNldCAndmRldic6ICIpOworICAgIG9iamVjdF9wcm9w
ZXJ0eV9zZXRfc3RyKE9CSkVDVCh4ZW5kZXYpLCB2ZGV2LCAidmRldiIsIGVycnApOworICAgIGlm
ICgqZXJycCkgeworICAgICAgICBlcnJvcl9wcm9wYWdhdGVfcHJlcGVuZChlcnJwLCAqZXJycCwg
ImZhaWxlZCB0byBzZXQgJ3ZkZXYnOiAiKTsKICAgICAgICAgZ290byBmYWlsOwogICAgIH0KIAog
ICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfc3RyKE9CSkVDVCh4ZW5kZXYpLAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHhlbl9ibG9ja19kcml2ZV9nZXRfbm9kZV9uYW1lKGRyaXZlKSwgImRy
aXZlIiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAmbG9jYWxfZXJyKTsKLSAgICBpZiAo
bG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZV9wcmVwZW5kKGVycnAsIGxvY2Fs
X2VyciwgImZhaWxlZCB0byBzZXQgJ2RyaXZlJzogIik7CisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CisgICAgICAgIGVycm9yX3Byb3BhZ2F0ZV9w
cmVwZW5kKGVycnAsICplcnJwLCAiZmFpbGVkIHRvIHNldCAnZHJpdmUnOiAiKTsKICAgICAgICAg
Z290byBmYWlsOwogICAgIH0KIAogICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfc3RyKE9CSkVDVCh4
ZW5kZXYpLCBpb3RocmVhZC0+aWQsICJpb3RocmVhZCIsCi0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9w
cm9wYWdhdGVfcHJlcGVuZChlcnJwLCBsb2NhbF9lcnIsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CisgICAgICAgIGVycm9yX3Byb3BhZ2F0ZV9w
cmVwZW5kKGVycnAsICplcnJwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZmFp
bGVkIHRvIHNldCAnaW90aHJlYWQnOiAiKTsKICAgICAgICAgZ290byBmYWlsOwogICAgIH0KQEAg
LTk1NSw5ICs5MzUsOSBAQCBzdGF0aWMgdm9pZCB4ZW5fYmxvY2tfZGV2aWNlX2NyZWF0ZShYZW5C
YWNrZW5kSW5zdGFuY2UgKmJhY2tlbmQsCiAgICAgYmxvY2tkZXYtPmlvdGhyZWFkID0gaW90aHJl
YWQ7CiAgICAgYmxvY2tkZXYtPmRyaXZlID0gZHJpdmU7CiAKLSAgICBvYmplY3RfcHJvcGVydHlf
c2V0X2Jvb2woT0JKRUNUKHhlbmRldiksIHRydWUsICJyZWFsaXplZCIsICZsb2NhbF9lcnIpOwot
ICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlX3ByZXBlbmQoZXJy
cCwgbG9jYWxfZXJyLAorICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoeGVuZGV2
KSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CisgICAgICAgIGVy
cm9yX3Byb3BhZ2F0ZV9wcmVwZW5kKGVycnAsICplcnJwLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAicmVhbGl6YXRpb24gb2YgZGV2aWNlICVzIGZhaWxlZDogIiwKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSk7CiAgICAgICAgIGdvdG8gZmFpbDsKQEAgLTk5
NCwyMyArOTc0LDE5IEBAIHN0YXRpYyB2b2lkIHhlbl9ibG9ja19kZXZpY2VfZGVzdHJveShYZW5C
YWNrZW5kSW5zdGFuY2UgKmJhY2tlbmQsCiAgICAgb2JqZWN0X3VucGFyZW50KE9CSkVDVCh4ZW5k
ZXYpKTsKIAogICAgIGlmIChpb3RocmVhZCkgewotICAgICAgICBFcnJvciAqbG9jYWxfZXJyID0g
TlVMTDsKLQotICAgICAgICB4ZW5fYmxvY2tfaW90aHJlYWRfZGVzdHJveShpb3RocmVhZCwgJmxv
Y2FsX2Vycik7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgICAgIGVycm9yX3By
b3BhZ2F0ZV9wcmVwZW5kKGVycnAsIGxvY2FsX2VyciwKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgImZhaWxlZCB0byBkZXN0cm95IGlvdGhyZWFkOiAiKTsKKyAgICAgICAgeGVuX2Js
b2NrX2lvdGhyZWFkX2Rlc3Ryb3koaW90aHJlYWQsIGVycnApOworICAgICAgICBpZiAoKmVycnAp
IHsKKyAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZV9wcmVwZW5kKGVycnAsICplcnJwLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImZhaWxlZCB0byBkZXN0cm95IGlvdGhy
ZWFkOiAiKTsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQogICAgIH0KIAogICAgIGlm
IChkcml2ZSkgewotICAgICAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKLQotICAgICAgICB4
ZW5fYmxvY2tfZHJpdmVfZGVzdHJveShkcml2ZSwgJmxvY2FsX2Vycik7Ci0gICAgICAgIGlmIChs
b2NhbF9lcnIpIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZV9wcmVwZW5kKGVycnAsIGxv
Y2FsX2VyciwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImZhaWxlZCB0byBkZXN0
cm95IGRyaXZlOiAiKTsKKyAgICAgICAgeGVuX2Jsb2NrX2RyaXZlX2Rlc3Ryb3koZHJpdmUsIGVy
cnApOworICAgICAgICBpZiAoKmVycnApIHsKKyAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZV9w
cmVwZW5kKGVycnAsICplcnJwLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ImZhaWxlZCB0byBkZXN0cm95IGRyaXZlOiAiKTsKICAgICAgICAgfQogICAgIH0KIH0KZGlmZiAt
LWdpdCBhL2h3L2NoYXIvZGVidWdjb24uYyBiL2h3L2NoYXIvZGVidWdjb24uYwppbmRleCA1YzU5
MmUwOTFiLi45MmVmNjM2YjFiIDEwMDY0NAotLS0gYS9ody9jaGFyL2RlYnVnY29uLmMKKysrIGIv
aHcvY2hhci9kZWJ1Z2Nvbi5jCkBAIC0xMDAsMTEgKzEwMCw5IEBAIHN0YXRpYyB2b2lkIGRlYnVn
Y29uX2lzYV9yZWFsaXplZm4oRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogICAgIElT
QURldmljZSAqZCA9IElTQV9ERVZJQ0UoZGV2KTsKICAgICBJU0FEZWJ1Z2NvblN0YXRlICppc2Eg
PSBJU0FfREVCVUdDT05fREVWSUNFKGRldik7CiAgICAgRGVidWdjb25TdGF0ZSAqcyA9ICZpc2Et
PnN0YXRlOwotICAgIEVycm9yICplcnIgPSBOVUxMOwogCi0gICAgZGVidWdjb25fcmVhbGl6ZV9j
b3JlKHMsICZlcnIpOwotICAgIGlmIChlcnIgIT0gTlVMTCkgewotICAgICAgICBlcnJvcl9wcm9w
YWdhdGUoZXJycCwgZXJyKTsKKyAgICBkZWJ1Z2Nvbl9yZWFsaXplX2NvcmUocywgZXJycCk7Cisg
ICAgaWYgKCplcnJwICE9IE5VTEwpIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KICAgICBtZW1v
cnlfcmVnaW9uX2luaXRfaW8oJnMtPmlvLCBPQkpFQ1QoZGV2KSwgJmRlYnVnY29uX29wcywgcywK
ZGlmZiAtLWdpdCBhL2h3L2NoYXIvc2VyaWFsLXBjaS1tdWx0aS5jIGIvaHcvY2hhci9zZXJpYWwt
cGNpLW11bHRpLmMKaW5kZXggNWYxM2I1NjYzYi4uZmM0YjFmZWQ3MCAxMDA2NDQKLS0tIGEvaHcv
Y2hhci9zZXJpYWwtcGNpLW11bHRpLmMKKysrIGIvaHcvY2hhci9zZXJpYWwtcGNpLW11bHRpLmMK
QEAgLTgyLDcgKzgyLDYgQEAgc3RhdGljIHZvaWQgbXVsdGlfc2VyaWFsX3BjaV9yZWFsaXplKFBD
SURldmljZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgUENJRGV2aWNlQ2xhc3MgKnBjID0gUENJ
X0RFVklDRV9HRVRfQ0xBU1MoZGV2KTsKICAgICBQQ0lNdWx0aVNlcmlhbFN0YXRlICpwY2kgPSBE
T19VUENBU1QoUENJTXVsdGlTZXJpYWxTdGF0ZSwgZGV2LCBkZXYpOwogICAgIFNlcmlhbFN0YXRl
ICpzOwotICAgIEVycm9yICplcnIgPSBOVUxMOwogICAgIGludCBpLCBucl9wb3J0cyA9IDA7CiAK
ICAgICBzd2l0Y2ggKHBjLT5kZXZpY2VfaWQpIHsKQEAgLTEwNiw5ICsxMDUsOCBAQCBzdGF0aWMg
dm9pZCBtdWx0aV9zZXJpYWxfcGNpX3JlYWxpemUoUENJRGV2aWNlICpkZXYsIEVycm9yICoqZXJy
cCkKICAgICBmb3IgKGkgPSAwOyBpIDwgbnJfcG9ydHM7IGkrKykgewogICAgICAgICBzID0gcGNp
LT5zdGF0ZSArIGk7CiAgICAgICAgIHMtPmJhdWRiYXNlID0gMTE1MjAwOwotICAgICAgICBzZXJp
YWxfcmVhbGl6ZV9jb3JlKHMsICZlcnIpOwotICAgICAgICBpZiAoZXJyICE9IE5VTEwpIHsKLSAg
ICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgICAgICBzZXJpYWxfcmVh
bGl6ZV9jb3JlKHMsIGVycnApOworICAgICAgICBpZiAoKmVycnAgIT0gTlVMTCkgewogICAgICAg
ICAgICAgbXVsdGlfc2VyaWFsX3BjaV9leGl0KGRldik7CiAgICAgICAgICAgICByZXR1cm47CiAg
ICAgICAgIH0KZGlmZiAtLWdpdCBhL2h3L2NoYXIvc2VyaWFsLXBjaS5jIGIvaHcvY2hhci9zZXJp
YWwtcGNpLmMKaW5kZXggY2I5Yjc2ZTIyYi4uYmI4MDRiZDdiMiAxMDA2NDQKLS0tIGEvaHcvY2hh
ci9zZXJpYWwtcGNpLmMKKysrIGIvaHcvY2hhci9zZXJpYWwtcGNpLmMKQEAgLTQ1LDEyICs0NSwx
MCBAQCBzdGF0aWMgdm9pZCBzZXJpYWxfcGNpX3JlYWxpemUoUENJRGV2aWNlICpkZXYsIEVycm9y
ICoqZXJycCkKIHsKICAgICBQQ0lTZXJpYWxTdGF0ZSAqcGNpID0gRE9fVVBDQVNUKFBDSVNlcmlh
bFN0YXRlLCBkZXYsIGRldik7CiAgICAgU2VyaWFsU3RhdGUgKnMgPSAmcGNpLT5zdGF0ZTsKLSAg
ICBFcnJvciAqZXJyID0gTlVMTDsKIAogICAgIHMtPmJhdWRiYXNlID0gMTE1MjAwOwotICAgIHNl
cmlhbF9yZWFsaXplX2NvcmUocywgJmVycik7Ci0gICAgaWYgKGVyciAhPSBOVUxMKSB7Ci0gICAg
ICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgIHNlcmlhbF9yZWFsaXplX2NvcmUo
cywgZXJycCk7CisgICAgaWYgKCplcnJwICE9IE5VTEwpIHsKICAgICAgICAgcmV0dXJuOwogICAg
IH0KIApkaWZmIC0tZ2l0IGEvaHcvY2hhci92aXJ0aW8tc2VyaWFsLWJ1cy5jIGIvaHcvY2hhci92
aXJ0aW8tc2VyaWFsLWJ1cy5jCmluZGV4IDRlMGVkODI5YWUuLjQ2NmJkNGIxYmQgMTAwNjQ0Ci0t
LSBhL2h3L2NoYXIvdmlydGlvLXNlcmlhbC1idXMuYworKysgYi9ody9jaGFyL3ZpcnRpby1zZXJp
YWwtYnVzLmMKQEAgLTk0MCw3ICs5NDAsNiBAQCBzdGF0aWMgdm9pZCB2aXJ0c2VyX3BvcnRfZGV2
aWNlX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogICAgIFZpcnRJT1Nl
cmlhbEJ1cyAqYnVzID0gVklSVElPX1NFUklBTF9CVVMocWRldl9nZXRfcGFyZW50X2J1cyhkZXYp
KTsKICAgICBpbnQgbWF4X25yX3BvcnRzOwogICAgIGJvb2wgcGx1Z2dpbmdfcG9ydDA7Ci0gICAg
RXJyb3IgKmVyciA9IE5VTEw7CiAKICAgICBwb3J0LT52c2VyID0gYnVzLT52c2VyOwogICAgIHBv
cnQtPmJoID0gcWVtdV9iaF9uZXcoZmx1c2hfcXVldWVkX2RhdGFfYmgsIHBvcnQpOwpAQCAtOTg2
LDkgKzk4NSw4IEBAIHN0YXRpYyB2b2lkIHZpcnRzZXJfcG9ydF9kZXZpY2VfcmVhbGl6ZShEZXZp
Y2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgICAgIHJldHVybjsKICAgICB9CiAKLSAg
ICB2c2MtPnJlYWxpemUoZGV2LCAmZXJyKTsKLSAgICBpZiAoZXJyICE9IE5VTEwpIHsKLSAgICAg
ICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgdnNjLT5yZWFsaXplKGRldiwgZXJy
cCk7CisgICAgaWYgKCplcnJwICE9IE5VTEwpIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApk
aWZmIC0tZ2l0IGEvaHcvY29yZS9idXMuYyBiL2h3L2NvcmUvYnVzLmMKaW5kZXggN2YzZDJhM2Ri
ZC4uNTBiM2NmNGIzNiAxMDA2NDQKLS0tIGEvaHcvY29yZS9idXMuYworKysgYi9ody9jb3JlL2J1
cy5jCkBAIC0xNDksMTEgKzE0OSwxMCBAQCBzdGF0aWMgdm9pZCBidXNfc2V0X3JlYWxpemVkKE9i
amVjdCAqb2JqLCBib29sIHZhbHVlLCBFcnJvciAqKmVycnApCiAgICAgQnVzU3RhdGUgKmJ1cyA9
IEJVUyhvYmopOwogICAgIEJ1c0NsYXNzICpiYyA9IEJVU19HRVRfQ0xBU1MoYnVzKTsKICAgICBC
dXNDaGlsZCAqa2lkOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgaWYgKHZh
bHVlICYmICFidXMtPnJlYWxpemVkKSB7CiAgICAgICAgIGlmIChiYy0+cmVhbGl6ZSkgewotICAg
ICAgICAgICAgYmMtPnJlYWxpemUoYnVzLCAmbG9jYWxfZXJyKTsKKyAgICAgICAgICAgIGJjLT5y
ZWFsaXplKGJ1cywgZXJycCk7CiAgICAgICAgIH0KIAogICAgICAgICAvKiBUT0RPOiByZWN1cnNp
dmUgcmVhbGl6YXRpb24gKi8KQEAgLTE2MSwxOCArMTYwLDE3IEBAIHN0YXRpYyB2b2lkIGJ1c19z
ZXRfcmVhbGl6ZWQoT2JqZWN0ICpvYmosIGJvb2wgdmFsdWUsIEVycm9yICoqZXJycCkKICAgICAg
ICAgUVRBSUxRX0ZPUkVBQ0goa2lkLCAmYnVzLT5jaGlsZHJlbiwgc2libGluZykgewogICAgICAg
ICAgICAgRGV2aWNlU3RhdGUgKmRldiA9IGtpZC0+Y2hpbGQ7CiAgICAgICAgICAgICBvYmplY3Rf
cHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKGRldiksIGZhbHNlLCAicmVhbGl6ZWQiLAotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZsb2NhbF9lcnIpOwotICAgICAgICAgICAg
aWYgKGxvY2FsX2VyciAhPSBOVUxMKSB7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgZXJycCk7CisgICAgICAgICAgICBpZiAoKmVycnAgIT0gTlVMTCkgewogICAgICAgICAg
ICAgICAgIGJyZWFrOwogICAgICAgICAgICAgfQogICAgICAgICB9Ci0gICAgICAgIGlmIChiYy0+
dW5yZWFsaXplICYmIGxvY2FsX2VyciA9PSBOVUxMKSB7Ci0gICAgICAgICAgICBiYy0+dW5yZWFs
aXplKGJ1cywgJmxvY2FsX2Vycik7CisgICAgICAgIGlmIChiYy0+dW5yZWFsaXplICYmICplcnJw
ID09IE5VTEwpIHsKKyAgICAgICAgICAgIGJjLT51bnJlYWxpemUoYnVzLCBlcnJwKTsKICAgICAg
ICAgfQogICAgIH0KIAotICAgIGlmIChsb2NhbF9lcnIgIT0gTlVMTCkgewotICAgICAgICBlcnJv
cl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBpZiAoKmVycnAgIT0gTlVMTCkgewog
ICAgICAgICByZXR1cm47CiAgICAgfQogCmRpZmYgLS1naXQgYS9ody9jb3JlL21hY2hpbmUuYyBi
L2h3L2NvcmUvbWFjaGluZS5jCmluZGV4IDE2ODlhZDNiZjguLmE5OThlMjEwYWYgMTAwNjQ0Ci0t
LSBhL2h3L2NvcmUvbWFjaGluZS5jCisrKyBiL2h3L2NvcmUvbWFjaGluZS5jCkBAIC0xOTIsMTMg
KzE5MiwxMSBAQCBzdGF0aWMgdm9pZCBtYWNoaW5lX3NldF9rZXJuZWxfaXJxY2hpcChPYmplY3Qg
Km9iaiwgVmlzaXRvciAqdiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGNvbnN0IGNoYXIgKm5hbWUsIHZvaWQgKm9wYXF1ZSwKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsK
ICAgICBNYWNoaW5lU3RhdGUgKm1zID0gTUFDSElORShvYmopOwogICAgIE9uT2ZmU3BsaXQgbW9k
ZTsKIAotICAgIHZpc2l0X3R5cGVfT25PZmZTcGxpdCh2LCBuYW1lLCAmbW9kZSwgJmVycik7Ci0g
ICAgaWYgKGVycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICB2
aXNpdF90eXBlX09uT2ZmU3BsaXQodiwgbmFtZSwgJm1vZGUsIGVycnApOworICAgIGlmICgqZXJy
cCkgewogICAgICAgICByZXR1cm47CiAgICAgfSBlbHNlIHsKICAgICAgICAgc3dpdGNoIChtb2Rl
KSB7CkBAIC0yNDEsMTIgKzIzOSwxMCBAQCBzdGF0aWMgdm9pZCBtYWNoaW5lX3NldF9rdm1fc2hh
ZG93X21lbShPYmplY3QgKm9iaiwgVmlzaXRvciAqdiwKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIEVycm9yICoqZXJycCkKIHsKICAgICBNYWNoaW5lU3RhdGUgKm1zID0g
TUFDSElORShvYmopOwotICAgIEVycm9yICplcnJvciA9IE5VTEw7CiAgICAgaW50NjRfdCB2YWx1
ZTsKIAotICAgIHZpc2l0X3R5cGVfaW50KHYsIG5hbWUsICZ2YWx1ZSwgJmVycm9yKTsKLSAgICBp
ZiAoZXJyb3IpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycm9yKTsKKyAgICB2
aXNpdF90eXBlX2ludCh2LCBuYW1lLCAmdmFsdWUsIGVycnApOworICAgIGlmICgqZXJycCkgewog
ICAgICAgICByZXR1cm47CiAgICAgfQogCkBAIC0zNDMsMTIgKzMzOSwxMCBAQCBzdGF0aWMgdm9p
ZCBtYWNoaW5lX3NldF9waGFuZGxlX3N0YXJ0KE9iamVjdCAqb2JqLCBWaXNpdG9yICp2LAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcnJvciAqKmVycnApCiB7CiAgICAg
TWFjaGluZVN0YXRlICptcyA9IE1BQ0hJTkUob2JqKTsKLSAgICBFcnJvciAqZXJyb3IgPSBOVUxM
OwogICAgIGludDY0X3QgdmFsdWU7CiAKLSAgICB2aXNpdF90eXBlX2ludCh2LCBuYW1lLCAmdmFs
dWUsICZlcnJvcik7Ci0gICAgaWYgKGVycm9yKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShl
cnJwLCBlcnJvcik7CisgICAgdmlzaXRfdHlwZV9pbnQodiwgbmFtZSwgJnZhbHVlLCBlcnJwKTsK
KyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApkaWZmIC0tZ2l0IGEv
aHcvY29yZS9udW1hLmMgYi9ody9jb3JlL251bWEuYwppbmRleCA0ZGZlYzVjOTViLi5kZjg1YzBl
NTU5IDEwMDY0NAotLS0gYS9ody9jb3JlL251bWEuYworKysgYi9ody9jb3JlL251bWEuYwpAQCAt
NTksNyArNTksNiBAQCBzdGF0aWMgaW50IG1heF9udW1hX25vZGVpZDsgLyogSGlnaGVzdCBzcGVj
aWZpZWQgTlVNQSBub2RlIElELCBwbHVzIG9uZS4KIHN0YXRpYyB2b2lkIHBhcnNlX251bWFfbm9k
ZShNYWNoaW5lU3RhdGUgKm1zLCBOdW1hTm9kZU9wdGlvbnMgKm5vZGUsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgRXJyb3IgKiplcnJwKQogewotICAgIEVycm9yICplcnIgPSBOVUxMOwog
ICAgIHVpbnQxNl90IG5vZGVucjsKICAgICB1aW50MTZMaXN0ICpjcHVzID0gTlVMTDsKICAgICBN
YWNoaW5lQ2xhc3MgKm1jID0gTUFDSElORV9HRVRfQ0xBU1MobXMpOwpAQCAtOTksOSArOTgsOCBA
QCBzdGF0aWMgdm9pZCBwYXJzZV9udW1hX25vZGUoTWFjaGluZVN0YXRlICptcywgTnVtYU5vZGVP
cHRpb25zICpub2RlLAogICAgICAgICBwcm9wcyA9IG1jLT5jcHVfaW5kZXhfdG9faW5zdGFuY2Vf
cHJvcHMobXMsIGNwdXMtPnZhbHVlKTsKICAgICAgICAgcHJvcHMubm9kZV9pZCA9IG5vZGVucjsK
ICAgICAgICAgcHJvcHMuaGFzX25vZGVfaWQgPSB0cnVlOwotICAgICAgICBtYWNoaW5lX3NldF9j
cHVfbnVtYV9ub2RlKG1zLCAmcHJvcHMsICZlcnIpOwotICAgICAgICBpZiAoZXJyKSB7Ci0gICAg
ICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgbWFjaGluZV9zZXRf
Y3B1X251bWFfbm9kZShtcywgJnByb3BzLCBlcnJwKTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAg
ICAgICAgICAgICByZXR1cm47CiAgICAgICAgIH0KICAgICB9CkBAIC0xNzcsNjAgKzE3NSw1NSBA
QCB2b2lkIHBhcnNlX251bWFfZGlzdGFuY2UoTWFjaGluZVN0YXRlICptcywgTnVtYURpc3RPcHRp
b25zICpkaXN0LCBFcnJvciAqKmVycnApCiAKIHZvaWQgc2V0X251bWFfb3B0aW9ucyhNYWNoaW5l
U3RhdGUgKm1zLCBOdW1hT3B0aW9ucyAqb2JqZWN0LCBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJy
b3IgKmVyciA9IE5VTEw7CiAgICAgTWFjaGluZUNsYXNzICptYyA9IE1BQ0hJTkVfR0VUX0NMQVNT
KG1zKTsKIAogICAgIGlmICghbWMtPm51bWFfbWVtX3N1cHBvcnRlZCkgewogICAgICAgICBlcnJv
cl9zZXRnKGVycnAsICJOVU1BIGlzIG5vdCBzdXBwb3J0ZWQgYnkgdGhpcyBtYWNoaW5lLXR5cGUi
KTsKLSAgICAgICAgZ290byBlbmQ7CisgICAgICAgIHJldHVybjsKICAgICB9CiAKICAgICBzd2l0
Y2ggKG9iamVjdC0+dHlwZSkgewogICAgIGNhc2UgTlVNQV9PUFRJT05TX1RZUEVfTk9ERToKLSAg
ICAgICAgcGFyc2VfbnVtYV9ub2RlKG1zLCAmb2JqZWN0LT51Lm5vZGUsICZlcnIpOwotICAgICAg
ICBpZiAoZXJyKSB7Ci0gICAgICAgICAgICBnb3RvIGVuZDsKKyAgICAgICAgcGFyc2VfbnVtYV9u
b2RlKG1zLCAmb2JqZWN0LT51Lm5vZGUsIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKKyAg
ICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQogICAgICAgICBicmVhazsKICAgICBjYXNlIE5V
TUFfT1BUSU9OU19UWVBFX0RJU1Q6Ci0gICAgICAgIHBhcnNlX251bWFfZGlzdGFuY2UobXMsICZv
YmplY3QtPnUuZGlzdCwgJmVycik7Ci0gICAgICAgIGlmIChlcnIpIHsKLSAgICAgICAgICAgIGdv
dG8gZW5kOworICAgICAgICBwYXJzZV9udW1hX2Rpc3RhbmNlKG1zLCAmb2JqZWN0LT51LmRpc3Qs
IGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKKyAgICAgICAgICAgIHJldHVybjsKICAgICAg
ICAgfQogICAgICAgICBicmVhazsKICAgICBjYXNlIE5VTUFfT1BUSU9OU19UWVBFX0NQVToKICAg
ICAgICAgaWYgKCFvYmplY3QtPnUuY3B1Lmhhc19ub2RlX2lkKSB7Ci0gICAgICAgICAgICBlcnJv
cl9zZXRnKCZlcnIsICJNaXNzaW5nIG1hbmRhdG9yeSBub2RlLWlkIHByb3BlcnR5Iik7Ci0gICAg
ICAgICAgICBnb3RvIGVuZDsKKyAgICAgICAgICAgIGVycm9yX3NldGcoZXJycCwgIk1pc3Npbmcg
bWFuZGF0b3J5IG5vZGUtaWQgcHJvcGVydHkiKTsKKyAgICAgICAgICAgIHJldHVybjsKICAgICAg
ICAgfQogICAgICAgICBpZiAoIW1zLT5udW1hX3N0YXRlLT5ub2Rlc1tvYmplY3QtPnUuY3B1Lm5v
ZGVfaWRdLnByZXNlbnQpIHsKLSAgICAgICAgICAgIGVycm9yX3NldGcoJmVyciwgIkludmFsaWQg
bm9kZS1pZD0lIiBQUklkNjQgIiwgTlVNQSBub2RlIG11c3QgYmUgIgotICAgICAgICAgICAgICAg
ICJkZWZpbmVkIHdpdGggLW51bWEgbm9kZSxub2RlaWQ9SUQgYmVmb3JlIGl0J3MgdXNlZCB3aXRo
ICIKLSAgICAgICAgICAgICAgICAiLW51bWEgY3B1LG5vZGUtaWQ9SUQiLCBvYmplY3QtPnUuY3B1
Lm5vZGVfaWQpOwotICAgICAgICAgICAgZ290byBlbmQ7CisgICAgICAgICAgICBlcnJvcl9zZXRn
KGVycnAsICJJbnZhbGlkIG5vZGUtaWQ9JSIgUFJJZDY0ICIsIE5VTUEgbm9kZSBtdXN0IGJlICIK
KyAgICAgICAgICAgICAgICAgICAgICAgImRlZmluZWQgd2l0aCAtbnVtYSBub2RlLG5vZGVpZD1J
RCBiZWZvcmUgaXQncyB1c2VkIHdpdGggIgorICAgICAgICAgICAgICAgICAgICAgICAiLW51bWEg
Y3B1LG5vZGUtaWQ9SUQiLCBvYmplY3QtPnUuY3B1Lm5vZGVfaWQpOworICAgICAgICAgICAgcmV0
dXJuOwogICAgICAgICB9CiAKICAgICAgICAgbWFjaGluZV9zZXRfY3B1X251bWFfbm9kZShtcywg
cWFwaV9OdW1hQ3B1T3B0aW9uc19iYXNlKCZvYmplY3QtPnUuY3B1KSwKLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAmZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBlcnJwKTsKICAgICAgICAgYnJlYWs7CiAgICAgZGVmYXVsdDoKICAgICAgICAgYWJvcnQo
KTsKICAgICB9Ci0KLWVuZDoKLSAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKIH0KIAog
c3RhdGljIGludCBwYXJzZV9udW1hKHZvaWQgKm9wYXF1ZSwgUWVtdU9wdHMgKm9wdHMsIEVycm9y
ICoqZXJycCkKIHsKICAgICBOdW1hT3B0aW9ucyAqb2JqZWN0ID0gTlVMTDsKICAgICBNYWNoaW5l
U3RhdGUgKm1zID0gTUFDSElORShvcGFxdWUpOwotICAgIEVycm9yICplcnIgPSBOVUxMOwogICAg
IFZpc2l0b3IgKnYgPSBvcHRzX3Zpc2l0b3JfbmV3KG9wdHMpOwogCi0gICAgdmlzaXRfdHlwZV9O
dW1hT3B0aW9ucyh2LCBOVUxMLCAmb2JqZWN0LCAmZXJyKTsKKyAgICB2aXNpdF90eXBlX051bWFP
cHRpb25zKHYsIE5VTEwsICZvYmplY3QsIGVycnApOwogICAgIHZpc2l0X2ZyZWUodik7Ci0gICAg
aWYgKGVycikgeworICAgIGlmICgqZXJycCkgewogICAgICAgICBnb3RvIGVuZDsKICAgICB9CiAK
QEAgLTI0MCwxMiArMjMzLDExIEBAIHN0YXRpYyBpbnQgcGFyc2VfbnVtYSh2b2lkICpvcGFxdWUs
IFFlbXVPcHRzICpvcHRzLCBFcnJvciAqKmVycnApCiAgICAgICAgIHFlbXVfc3RydG9zel9NaUIo
bWVtX3N0ciwgTlVMTCwgJm9iamVjdC0+dS5ub2RlLm1lbSk7CiAgICAgfQogCi0gICAgc2V0X251
bWFfb3B0aW9ucyhtcywgb2JqZWN0LCAmZXJyKTsKKyAgICBzZXRfbnVtYV9vcHRpb25zKG1zLCBv
YmplY3QsIGVycnApOwogCiBlbmQ6CiAgICAgcWFwaV9mcmVlX051bWFPcHRpb25zKG9iamVjdCk7
Ci0gICAgaWYgKGVycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAg
ICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuIC0xOwogICAgIH0KIApkaWZmIC0tZ2l0IGEv
aHcvY29yZS9xZGV2LXByb3BlcnRpZXMtc3lzdGVtLmMgYi9ody9jb3JlL3FkZXYtcHJvcGVydGll
cy1zeXN0ZW0uYwppbmRleCA3MGJmZDQ4MDliLi5iNTMwNTZhNWZhIDEwMDY0NAotLS0gYS9ody9j
b3JlL3FkZXYtcHJvcGVydGllcy1zeXN0ZW0uYworKysgYi9ody9jb3JlL3FkZXYtcHJvcGVydGll
cy1zeXN0ZW0uYwpAQCAtNDUsNyArNDUsNiBAQCBzdGF0aWMgdm9pZCBzZXRfcG9pbnRlcihPYmpl
Y3QgKm9iaiwgVmlzaXRvciAqdiwgUHJvcGVydHkgKnByb3AsCiAgICAgICAgICAgICAgICAgICAg
ICAgICBjb25zdCBjaGFyICpuYW1lLCBFcnJvciAqKmVycnApCiB7CiAgICAgRGV2aWNlU3RhdGUg
KmRldiA9IERFVklDRShvYmopOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIHZv
aWQgKipwdHIgPSBxZGV2X2dldF9wcm9wX3B0cihkZXYsIHByb3ApOwogICAgIGNoYXIgKnN0cjsK
IApAQCAtNTQsOSArNTMsOCBAQCBzdGF0aWMgdm9pZCBzZXRfcG9pbnRlcihPYmplY3QgKm9iaiwg
VmlzaXRvciAqdiwgUHJvcGVydHkgKnByb3AsCiAgICAgICAgIHJldHVybjsKICAgICB9CiAKLSAg
ICB2aXNpdF90eXBlX3N0cih2LCBuYW1lLCAmc3RyLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9j
YWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAg
IHZpc2l0X3R5cGVfc3RyKHYsIG5hbWUsICZzdHIsIGVycnApOworICAgIGlmICgqZXJycCkgewog
ICAgICAgICByZXR1cm47CiAgICAgfQogICAgIGlmICghKnN0cikgewpAQCAtMjIyLDcgKzIyMCw2
IEBAIHN0YXRpYyB2b2lkIHNldF9jaHIoT2JqZWN0ICpvYmosIFZpc2l0b3IgKnYsIGNvbnN0IGNo
YXIgKm5hbWUsIHZvaWQgKm9wYXF1ZSwKICAgICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJw
KQogewogICAgIERldmljZVN0YXRlICpkZXYgPSBERVZJQ0Uob2JqKTsKLSAgICBFcnJvciAqbG9j
YWxfZXJyID0gTlVMTDsKICAgICBQcm9wZXJ0eSAqcHJvcCA9IG9wYXF1ZTsKICAgICBDaGFyQmFj
a2VuZCAqYmUgPSBxZGV2X2dldF9wcm9wX3B0cihkZXYsIHByb3ApOwogICAgIENoYXJkZXYgKnM7
CkBAIC0yMzMsOSArMjMwLDggQEAgc3RhdGljIHZvaWQgc2V0X2NocihPYmplY3QgKm9iaiwgVmlz
aXRvciAqdiwgY29uc3QgY2hhciAqbmFtZSwgdm9pZCAqb3BhcXVlLAogICAgICAgICByZXR1cm47
CiAgICAgfQogCi0gICAgdmlzaXRfdHlwZV9zdHIodiwgbmFtZSwgJnN0ciwgJmxvY2FsX2Vycik7
Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9j
YWxfZXJyKTsKKyAgICB2aXNpdF90eXBlX3N0cih2LCBuYW1lLCAmc3RyLCBlcnJwKTsKKyAgICBp
ZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApAQCAtMjk0LDcgKzI5MCw2IEBA
IHN0YXRpYyB2b2lkIHNldF9uZXRkZXYoT2JqZWN0ICpvYmosIFZpc2l0b3IgKnYsIGNvbnN0IGNo
YXIgKm5hbWUsCiAgICAgTklDUGVlcnMgKnBlZXJzX3B0ciA9IHFkZXZfZ2V0X3Byb3BfcHRyKGRl
diwgcHJvcCk7CiAgICAgTmV0Q2xpZW50U3RhdGUgKipuY3MgPSBwZWVyc19wdHItPm5jczsKICAg
ICBOZXRDbGllbnRTdGF0ZSAqcGVlcnNbTUFYX1FVRVVFX05VTV07Ci0gICAgRXJyb3IgKmxvY2Fs
X2VyciA9IE5VTEw7CiAgICAgaW50IHF1ZXVlcywgZXJyID0gMCwgaSA9IDA7CiAgICAgY2hhciAq
c3RyOwogCkBAIC0zMDMsOSArMjk4LDggQEAgc3RhdGljIHZvaWQgc2V0X25ldGRldihPYmplY3Qg
Km9iaiwgVmlzaXRvciAqdiwgY29uc3QgY2hhciAqbmFtZSwKICAgICAgICAgcmV0dXJuOwogICAg
IH0KIAotICAgIHZpc2l0X3R5cGVfc3RyKHYsIG5hbWUsICZzdHIsICZsb2NhbF9lcnIpOwotICAg
IGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vy
cik7CisgICAgdmlzaXRfdHlwZV9zdHIodiwgbmFtZSwgJnN0ciwgZXJycCk7CisgICAgaWYgKCpl
cnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKQEAgLTM3NCw3ICszNjgsNiBAQCBzdGF0
aWMgdm9pZCBzZXRfYXVkaW9kZXYoT2JqZWN0ICpvYmosIFZpc2l0b3IgKnYsIGNvbnN0IGNoYXIq
IG5hbWUsCiAgICAgUHJvcGVydHkgKnByb3AgPSBvcGFxdWU7CiAgICAgUUVNVVNvdW5kQ2FyZCAq
Y2FyZCA9IHFkZXZfZ2V0X3Byb3BfcHRyKGRldiwgcHJvcCk7CiAgICAgQXVkaW9TdGF0ZSAqc3Rh
dGU7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgaW50IGVyciA9IDA7CiAgICAg
Y2hhciAqc3RyOwogCkBAIC0zODMsOSArMzc2LDggQEAgc3RhdGljIHZvaWQgc2V0X2F1ZGlvZGV2
KE9iamVjdCAqb2JqLCBWaXNpdG9yICp2LCBjb25zdCBjaGFyKiBuYW1lLAogICAgICAgICByZXR1
cm47CiAgICAgfQogCi0gICAgdmlzaXRfdHlwZV9zdHIodiwgbmFtZSwgJnN0ciwgJmxvY2FsX2Vy
cik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwg
bG9jYWxfZXJyKTsKKyAgICB2aXNpdF90eXBlX3N0cih2LCBuYW1lLCAmc3RyLCBlcnJwKTsKKyAg
ICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApkaWZmIC0tZ2l0IGEvaHcv
Y29yZS9xZGV2LXByb3BlcnRpZXMuYyBiL2h3L2NvcmUvcWRldi1wcm9wZXJ0aWVzLmMKaW5kZXgg
YWMyODg5MGU1YS4uMmZiNzRlZTYxOSAxMDA2NDQKLS0tIGEvaHcvY29yZS9xZGV2LXByb3BlcnRp
ZXMuYworKysgYi9ody9jb3JlL3FkZXYtcHJvcGVydGllcy5jCkBAIC0xMTYsNyArMTE2LDYgQEAg
c3RhdGljIHZvaWQgcHJvcF9zZXRfYml0KE9iamVjdCAqb2JqLCBWaXNpdG9yICp2LCBjb25zdCBj
aGFyICpuYW1lLAogewogICAgIERldmljZVN0YXRlICpkZXYgPSBERVZJQ0Uob2JqKTsKICAgICBQ
cm9wZXJ0eSAqcHJvcCA9IG9wYXF1ZTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAg
ICBib29sIHZhbHVlOwogCiAgICAgaWYgKGRldi0+cmVhbGl6ZWQpIHsKQEAgLTEyNCw5ICsxMjMs
OCBAQCBzdGF0aWMgdm9pZCBwcm9wX3NldF9iaXQoT2JqZWN0ICpvYmosIFZpc2l0b3IgKnYsIGNv
bnN0IGNoYXIgKm5hbWUsCiAgICAgICAgIHJldHVybjsKICAgICB9CiAKLSAgICB2aXNpdF90eXBl
X2Jvb2wodiwgbmFtZSwgJnZhbHVlLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7
Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHZpc2l0X3R5
cGVfYm9vbCh2LCBuYW1lLCAmdmFsdWUsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAg
ICByZXR1cm47CiAgICAgfQogICAgIGJpdF9wcm9wX3NldChkZXYsIHByb3AsIHZhbHVlKTsKQEAg
LTE4MCw3ICsxNzgsNiBAQCBzdGF0aWMgdm9pZCBwcm9wX3NldF9iaXQ2NChPYmplY3QgKm9iaiwg
VmlzaXRvciAqdiwgY29uc3QgY2hhciAqbmFtZSwKIHsKICAgICBEZXZpY2VTdGF0ZSAqZGV2ID0g
REVWSUNFKG9iaik7CiAgICAgUHJvcGVydHkgKnByb3AgPSBvcGFxdWU7Ci0gICAgRXJyb3IgKmxv
Y2FsX2VyciA9IE5VTEw7CiAgICAgYm9vbCB2YWx1ZTsKIAogICAgIGlmIChkZXYtPnJlYWxpemVk
KSB7CkBAIC0xODgsOSArMTg1LDggQEAgc3RhdGljIHZvaWQgcHJvcF9zZXRfYml0NjQoT2JqZWN0
ICpvYmosIFZpc2l0b3IgKnYsIGNvbnN0IGNoYXIgKm5hbWUsCiAgICAgICAgIHJldHVybjsKICAg
ICB9CiAKLSAgICB2aXNpdF90eXBlX2Jvb2wodiwgbmFtZSwgJnZhbHVlLCAmbG9jYWxfZXJyKTsK
LSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2Nh
bF9lcnIpOworICAgIHZpc2l0X3R5cGVfYm9vbCh2LCBuYW1lLCAmdmFsdWUsIGVycnApOworICAg
IGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogICAgIGJpdDY0X3Byb3Bfc2V0
KGRldiwgcHJvcCwgdmFsdWUpOwpAQCAtNDc3LDcgKzQ3Myw2IEBAIHN0YXRpYyB2b2lkIHNldF9z
dHJpbmcoT2JqZWN0ICpvYmosIFZpc2l0b3IgKnYsIGNvbnN0IGNoYXIgKm5hbWUsCiAgICAgRGV2
aWNlU3RhdGUgKmRldiA9IERFVklDRShvYmopOwogICAgIFByb3BlcnR5ICpwcm9wID0gb3BhcXVl
OwogICAgIGNoYXIgKipwdHIgPSBxZGV2X2dldF9wcm9wX3B0cihkZXYsIHByb3ApOwotICAgIEVy
cm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIGNoYXIgKnN0cjsKIAogICAgIGlmIChkZXYtPnJl
YWxpemVkKSB7CkBAIC00ODUsOSArNDgwLDggQEAgc3RhdGljIHZvaWQgc2V0X3N0cmluZyhPYmpl
Y3QgKm9iaiwgVmlzaXRvciAqdiwgY29uc3QgY2hhciAqbmFtZSwKICAgICAgICAgcmV0dXJuOwog
ICAgIH0KIAotICAgIHZpc2l0X3R5cGVfc3RyKHYsIG5hbWUsICZzdHIsICZsb2NhbF9lcnIpOwot
ICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2Fs
X2Vycik7CisgICAgdmlzaXRfdHlwZV9zdHIodiwgbmFtZSwgJnN0ciwgZXJycCk7CisgICAgaWYg
KCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAgICAgZ19mcmVlKCpwdHIpOwpAQCAt
NTM3LDcgKzUzMSw2IEBAIHN0YXRpYyB2b2lkIHNldF9tYWMoT2JqZWN0ICpvYmosIFZpc2l0b3Ig
KnYsIGNvbnN0IGNoYXIgKm5hbWUsIHZvaWQgKm9wYXF1ZSwKICAgICBEZXZpY2VTdGF0ZSAqZGV2
ID0gREVWSUNFKG9iaik7CiAgICAgUHJvcGVydHkgKnByb3AgPSBvcGFxdWU7CiAgICAgTUFDQWRk
ciAqbWFjID0gcWRldl9nZXRfcHJvcF9wdHIoZGV2LCBwcm9wKTsKLSAgICBFcnJvciAqbG9jYWxf
ZXJyID0gTlVMTDsKICAgICBpbnQgaSwgcG9zOwogICAgIGNoYXIgKnN0ciwgKnA7CiAKQEAgLTU0
Niw5ICs1MzksOCBAQCBzdGF0aWMgdm9pZCBzZXRfbWFjKE9iamVjdCAqb2JqLCBWaXNpdG9yICp2
LCBjb25zdCBjaGFyICpuYW1lLCB2b2lkICpvcGFxdWUsCiAgICAgICAgIHJldHVybjsKICAgICB9
CiAKLSAgICB2aXNpdF90eXBlX3N0cih2LCBuYW1lLCAmc3RyLCAmbG9jYWxfZXJyKTsKLSAgICBp
ZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIp
OworICAgIHZpc2l0X3R5cGVfc3RyKHYsIG5hbWUsICZzdHIsIGVycnApOworICAgIGlmICgqZXJy
cCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCkBAIC02NjAsNyArNjUyLDYgQEAgc3RhdGlj
IHZvaWQgc2V0X3BjaV9kZXZmbihPYmplY3QgKm9iaiwgVmlzaXRvciAqdiwgY29uc3QgY2hhciAq
bmFtZSwKICAgICBQcm9wZXJ0eSAqcHJvcCA9IG9wYXF1ZTsKICAgICBpbnQzMl90IHZhbHVlLCAq
cHRyID0gcWRldl9nZXRfcHJvcF9wdHIoZGV2LCBwcm9wKTsKICAgICB1bnNpZ25lZCBpbnQgc2xv
dCwgZm4sIG47Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgY2hhciAqc3RyOwog
CiAgICAgaWYgKGRldi0+cmVhbGl6ZWQpIHsKQEAgLTY2OCwxMyArNjU5LDExIEBAIHN0YXRpYyB2
b2lkIHNldF9wY2lfZGV2Zm4oT2JqZWN0ICpvYmosIFZpc2l0b3IgKnYsIGNvbnN0IGNoYXIgKm5h
bWUsCiAgICAgICAgIHJldHVybjsKICAgICB9CiAKLSAgICB2aXNpdF90eXBlX3N0cih2LCBuYW1l
LCAmc3RyLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9y
X2ZyZWUobG9jYWxfZXJyKTsKLSAgICAgICAgbG9jYWxfZXJyID0gTlVMTDsKLSAgICAgICAgdmlz
aXRfdHlwZV9pbnQzMih2LCBuYW1lLCAmdmFsdWUsICZsb2NhbF9lcnIpOwotICAgICAgICBpZiAo
bG9jYWxfZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJy
KTsKKyAgICB2aXNpdF90eXBlX3N0cih2LCBuYW1lLCAmc3RyLCBlcnJwKTsKKyAgICBpZiAoKmVy
cnApIHsKKyAgICAgICAgZXJyb3JfZnJlZV9lcnJwKGVycnApOworICAgICAgICB2aXNpdF90eXBl
X2ludDMyKHYsIG5hbWUsICZ2YWx1ZSwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAg
ICAgICB9IGVsc2UgaWYgKHZhbHVlIDwgLTEgfHwgdmFsdWUgPiAyNTUpIHsKICAgICAgICAgICAg
IGVycm9yX3NldGcoZXJycCwgUUVSUl9JTlZBTElEX1BBUkFNRVRFUl9WQUxVRSwKICAgICAgICAg
ICAgICAgICAgICAgICAgbmFtZSA/IG5hbWUgOiAibnVsbCIsICJwY2lfZGV2Zm4iKTsKQEAgLTcz
MSw3ICs3MjAsNiBAQCBzdGF0aWMgdm9pZCBzZXRfYmxvY2tzaXplKE9iamVjdCAqb2JqLCBWaXNp
dG9yICp2LCBjb25zdCBjaGFyICpuYW1lLAogICAgIERldmljZVN0YXRlICpkZXYgPSBERVZJQ0Uo
b2JqKTsKICAgICBQcm9wZXJ0eSAqcHJvcCA9IG9wYXF1ZTsKICAgICB1aW50MTZfdCB2YWx1ZSwg
KnB0ciA9IHFkZXZfZ2V0X3Byb3BfcHRyKGRldiwgcHJvcCk7Ci0gICAgRXJyb3IgKmxvY2FsX2Vy
ciA9IE5VTEw7CiAgICAgY29uc3QgaW50NjRfdCBtaW4gPSA1MTI7CiAgICAgY29uc3QgaW50NjRf
dCBtYXggPSAzMjc2ODsKIApAQCAtNzQwLDkgKzcyOCw4IEBAIHN0YXRpYyB2b2lkIHNldF9ibG9j
a3NpemUoT2JqZWN0ICpvYmosIFZpc2l0b3IgKnYsIGNvbnN0IGNoYXIgKm5hbWUsCiAgICAgICAg
IHJldHVybjsKICAgICB9CiAKLSAgICB2aXNpdF90eXBlX3VpbnQxNih2LCBuYW1lLCAmdmFsdWUs
ICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFn
YXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgdmlzaXRfdHlwZV91aW50MTYodiwgbmFtZSwgJnZh
bHVlLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KICAg
ICAvKiB2YWx1ZSBvZiAwIG1lYW5zICJ1bnNldCIgKi8KQEAgLTgwNiw3ICs3OTMsNiBAQCBzdGF0
aWMgdm9pZCBzZXRfcGNpX2hvc3RfZGV2YWRkcihPYmplY3QgKm9iaiwgVmlzaXRvciAqdiwgY29u
c3QgY2hhciAqbmFtZSwKICAgICBEZXZpY2VTdGF0ZSAqZGV2ID0gREVWSUNFKG9iaik7CiAgICAg
UHJvcGVydHkgKnByb3AgPSBvcGFxdWU7CiAgICAgUENJSG9zdERldmljZUFkZHJlc3MgKmFkZHIg
PSBxZGV2X2dldF9wcm9wX3B0cihkZXYsIHByb3ApOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBO
VUxMOwogICAgIGNoYXIgKnN0ciwgKnA7CiAgICAgY2hhciAqZTsKICAgICB1bnNpZ25lZCBsb25n
IHZhbDsKQEAgLTgxOCw5ICs4MDQsOCBAQCBzdGF0aWMgdm9pZCBzZXRfcGNpX2hvc3RfZGV2YWRk
cihPYmplY3QgKm9iaiwgVmlzaXRvciAqdiwgY29uc3QgY2hhciAqbmFtZSwKICAgICAgICAgcmV0
dXJuOwogICAgIH0KIAotICAgIHZpc2l0X3R5cGVfc3RyKHYsIG5hbWUsICZzdHIsICZsb2NhbF9l
cnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAs
IGxvY2FsX2Vycik7CisgICAgdmlzaXRfdHlwZV9zdHIodiwgbmFtZSwgJnN0ciwgZXJycCk7Cisg
ICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKQEAgLTkxMCw3ICs4OTUs
NiBAQCBzdGF0aWMgdm9pZCBzZXRfdXVpZChPYmplY3QgKm9iaiwgVmlzaXRvciAqdiwgY29uc3Qg
Y2hhciAqbmFtZSwgdm9pZCAqb3BhcXVlLAogICAgIERldmljZVN0YXRlICpkZXYgPSBERVZJQ0Uo
b2JqKTsKICAgICBQcm9wZXJ0eSAqcHJvcCA9IG9wYXF1ZTsKICAgICBRZW11VVVJRCAqdXVpZCA9
IHFkZXZfZ2V0X3Byb3BfcHRyKGRldiwgcHJvcCk7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5V
TEw7CiAgICAgY2hhciAqc3RyOwogCiAgICAgaWYgKGRldi0+cmVhbGl6ZWQpIHsKQEAgLTkxOCw5
ICs5MDIsOCBAQCBzdGF0aWMgdm9pZCBzZXRfdXVpZChPYmplY3QgKm9iaiwgVmlzaXRvciAqdiwg
Y29uc3QgY2hhciAqbmFtZSwgdm9pZCAqb3BhcXVlLAogICAgICAgICByZXR1cm47CiAgICAgfQog
Ci0gICAgdmlzaXRfdHlwZV9zdHIodiwgbmFtZSwgJnN0ciwgJmxvY2FsX2Vycik7Ci0gICAgaWYg
KGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsK
KyAgICB2aXNpdF90eXBlX3N0cih2LCBuYW1lLCAmc3RyLCBlcnJwKTsKKyAgICBpZiAoKmVycnAp
IHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApAQCAtOTg2LDcgKzk2OSw2IEBAIHN0YXRpYyB2
b2lkIHNldF9wcm9wX2FycmF5bGVuKE9iamVjdCAqb2JqLCBWaXNpdG9yICp2LCBjb25zdCBjaGFy
ICpuYW1lLAogICAgIFByb3BlcnR5ICpwcm9wID0gb3BhcXVlOwogICAgIHVpbnQzMl90ICphbGVu
cHRyID0gcWRldl9nZXRfcHJvcF9wdHIoZGV2LCBwcm9wKTsKICAgICB2b2lkICoqYXJyYXlwdHIg
PSAodm9pZCAqKWRldiArIHByb3AtPmFycmF5b2Zmc2V0OwotICAgIEVycm9yICpsb2NhbF9lcnIg
PSBOVUxMOwogICAgIHZvaWQgKmVsdHB0cjsKICAgICBjb25zdCBjaGFyICphcnJheW5hbWU7CiAg
ICAgaW50IGk7CkBAIC0xMDAwLDkgKzk4Miw4IEBAIHN0YXRpYyB2b2lkIHNldF9wcm9wX2FycmF5
bGVuKE9iamVjdCAqb2JqLCBWaXNpdG9yICp2LCBjb25zdCBjaGFyICpuYW1lLAogICAgICAgICAg
ICAgICAgICAgIG5hbWUpOwogICAgICAgICByZXR1cm47CiAgICAgfQotICAgIHZpc2l0X3R5cGVf
dWludDMyKHYsIG5hbWUsIGFsZW5wdHIsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIp
IHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgdmlzaXRf
dHlwZV91aW50MzIodiwgbmFtZSwgYWxlbnB0ciwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAg
ICAgICAgIHJldHVybjsKICAgICB9CiAgICAgaWYgKCEqYWxlbnB0cikgewpAQCAtMTAzOSw5ICsx
MDIwLDggQEAgc3RhdGljIHZvaWQgc2V0X3Byb3BfYXJyYXlsZW4oT2JqZWN0ICpvYmosIFZpc2l0
b3IgKnYsIGNvbnN0IGNoYXIgKm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJy
YXlwcm9wLT5wcm9wLmluZm8tPmdldCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJh
eXByb3AtPnByb3AuaW5mby0+c2V0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5
X2VsZW1lbnRfcmVsZWFzZSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJheXByb3As
ICZsb2NhbF9lcnIpOwotICAgICAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgICAgICBlcnJv
cl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBhcnJheXByb3AsIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIHJl
dHVybjsKICAgICAgICAgfQogICAgIH0KQEAgLTEzMjYsMTYgKzEzMDYsMTQgQEAgc3RhdGljIHZv
aWQgc2V0X3Byb3BfcGNpZWxpbmtzcGVlZChPYmplY3QgKm9iaiwgVmlzaXRvciAqdiwgY29uc3Qg
Y2hhciAqbmFtZSwKICAgICBQcm9wZXJ0eSAqcHJvcCA9IG9wYXF1ZTsKICAgICBQQ0lFeHBMaW5r
U3BlZWQgKnAgPSBxZGV2X2dldF9wcm9wX3B0cihkZXYsIHByb3ApOwogICAgIGludCBzcGVlZDsK
LSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAogICAgIGlmIChkZXYtPnJlYWxpemVkKSB7
CiAgICAgICAgIHFkZXZfcHJvcF9zZXRfYWZ0ZXJfcmVhbGl6ZShkZXYsIG5hbWUsIGVycnApOwog
ICAgICAgICByZXR1cm47CiAgICAgfQogCi0gICAgdmlzaXRfdHlwZV9lbnVtKHYsIHByb3AtPm5h
bWUsICZzcGVlZCwgcHJvcC0+aW5mby0+ZW51bV90YWJsZSwgJmxvY2FsX2Vycik7Ci0gICAgaWYg
KGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsK
KyAgICB2aXNpdF90eXBlX2VudW0odiwgcHJvcC0+bmFtZSwgJnNwZWVkLCBwcm9wLT5pbmZvLT5l
bnVtX3RhYmxlLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAg
IH0KIApAQCAtMTQxNCwxNiArMTM5MiwxNCBAQCBzdGF0aWMgdm9pZCBzZXRfcHJvcF9wY2llbGlu
a3dpZHRoKE9iamVjdCAqb2JqLCBWaXNpdG9yICp2LCBjb25zdCBjaGFyICpuYW1lLAogICAgIFBy
b3BlcnR5ICpwcm9wID0gb3BhcXVlOwogICAgIFBDSUV4cExpbmtXaWR0aCAqcCA9IHFkZXZfZ2V0
X3Byb3BfcHRyKGRldiwgcHJvcCk7CiAgICAgaW50IHdpZHRoOwotICAgIEVycm9yICpsb2NhbF9l
cnIgPSBOVUxMOwogCiAgICAgaWYgKGRldi0+cmVhbGl6ZWQpIHsKICAgICAgICAgcWRldl9wcm9w
X3NldF9hZnRlcl9yZWFsaXplKGRldiwgbmFtZSwgZXJycCk7CiAgICAgICAgIHJldHVybjsKICAg
ICB9CiAKLSAgICB2aXNpdF90eXBlX2VudW0odiwgcHJvcC0+bmFtZSwgJndpZHRoLCBwcm9wLT5p
bmZvLT5lbnVtX3RhYmxlLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAg
ICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHZpc2l0X3R5cGVfZW51
bSh2LCBwcm9wLT5uYW1lLCAmd2lkdGgsIHByb3AtPmluZm8tPmVudW1fdGFibGUsIGVycnApOwor
ICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCmRpZmYgLS1naXQgYS9o
dy9jb3JlL3FkZXYuYyBiL2h3L2NvcmUvcWRldi5jCmluZGV4IGNiYWQ2YzFkNTUuLjM0ZWNhNzQw
ODkgMTAwNjQ0Ci0tLSBhL2h3L2NvcmUvcWRldi5jCisrKyBiL2h3L2NvcmUvcWRldi5jCkBAIC03
MDksMTEgKzcwOSwxMCBAQCBzdGF0aWMgdm9pZCBxZGV2X3Byb3BlcnR5X2FkZF9sZWdhY3koRGV2
aWNlU3RhdGUgKmRldiwgUHJvcGVydHkgKnByb3AsCiB2b2lkIHFkZXZfcHJvcGVydHlfYWRkX3N0
YXRpYyhEZXZpY2VTdGF0ZSAqZGV2LCBQcm9wZXJ0eSAqcHJvcCwKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVM
TDsKICAgICBPYmplY3QgKm9iaiA9IE9CSkVDVChkZXYpOwogCiAgICAgaWYgKHByb3AtPmluZm8t
PmNyZWF0ZSkgewotICAgICAgICBwcm9wLT5pbmZvLT5jcmVhdGUob2JqLCBwcm9wLCAmbG9jYWxf
ZXJyKTsKKyAgICAgICAgcHJvcC0+aW5mby0+Y3JlYXRlKG9iaiwgcHJvcCwgZXJycCk7CiAgICAg
fSBlbHNlIHsKICAgICAgICAgLyoKICAgICAgICAgICogVE9ETyBxZGV2X3Byb3BfcHRyIGRvZXMg
bm90IGhhdmUgZ2V0dGVycyBvciBzZXR0ZXJzLiAgSXQgbXVzdApAQCAtNzI2LDExICs3MjUsMTAg
QEAgdm9pZCBxZGV2X3Byb3BlcnR5X2FkZF9zdGF0aWMoRGV2aWNlU3RhdGUgKmRldiwgUHJvcGVy
dHkgKnByb3AsCiAgICAgICAgIG9iamVjdF9wcm9wZXJ0eV9hZGQob2JqLCBwcm9wLT5uYW1lLCBw
cm9wLT5pbmZvLT5uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3AtPmluZm8t
PmdldCwgcHJvcC0+aW5mby0+c2V0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3At
PmluZm8tPnJlbGVhc2UsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcCwgJmxvY2Fs
X2Vycik7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcCwgZXJycCk7CiAgICAgfQog
Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9j
YWxfZXJyKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApAQCAt
ODE2LDcgKzgxNCw2IEBAIHN0YXRpYyB2b2lkIGRldmljZV9zZXRfcmVhbGl6ZWQoT2JqZWN0ICpv
YmosIGJvb2wgdmFsdWUsIEVycm9yICoqZXJycCkKICAgICBEZXZpY2VDbGFzcyAqZGMgPSBERVZJ
Q0VfR0VUX0NMQVNTKGRldik7CiAgICAgSG90cGx1Z0hhbmRsZXIgKmhvdHBsdWdfY3RybDsKICAg
ICBCdXNTdGF0ZSAqYnVzOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIGJvb2wg
dW5hdHRhY2hlZF9wYXJlbnQgPSBmYWxzZTsKICAgICBzdGF0aWMgaW50IHVuYXR0YWNoZWRfY291
bnQ7CiAKQEAgLTgyNiw3ICs4MjMsNyBAQCBzdGF0aWMgdm9pZCBkZXZpY2Vfc2V0X3JlYWxpemVk
KE9iamVjdCAqb2JqLCBib29sIHZhbHVlLCBFcnJvciAqKmVycnApCiAgICAgfQogCiAgICAgaWYg
KHZhbHVlICYmICFkZXYtPnJlYWxpemVkKSB7Ci0gICAgICAgIGlmICghY2hlY2tfb25seV9taWdy
YXRhYmxlKG9iaiwgJmxvY2FsX2VycikpIHsKKyAgICAgICAgaWYgKCFjaGVja19vbmx5X21pZ3Jh
dGFibGUob2JqLCBlcnJwKSkgewogICAgICAgICAgICAgZ290byBmYWlsOwogICAgICAgICB9CiAK
QEAgLTg0MiwxNyArODM5LDE3IEBAIHN0YXRpYyB2b2lkIGRldmljZV9zZXRfcmVhbGl6ZWQoT2Jq
ZWN0ICpvYmosIGJvb2wgdmFsdWUsIEVycm9yICoqZXJycCkKIAogICAgICAgICBob3RwbHVnX2N0
cmwgPSBxZGV2X2dldF9ob3RwbHVnX2hhbmRsZXIoZGV2KTsKICAgICAgICAgaWYgKGhvdHBsdWdf
Y3RybCkgewotICAgICAgICAgICAgaG90cGx1Z19oYW5kbGVyX3ByZV9wbHVnKGhvdHBsdWdfY3Ry
bCwgZGV2LCAmbG9jYWxfZXJyKTsKLSAgICAgICAgICAgIGlmIChsb2NhbF9lcnIgIT0gTlVMTCkg
eworICAgICAgICAgICAgaG90cGx1Z19oYW5kbGVyX3ByZV9wbHVnKGhvdHBsdWdfY3RybCwgZGV2
LCBlcnJwKTsKKyAgICAgICAgICAgIGlmICgqZXJycCAhPSBOVUxMKSB7CiAgICAgICAgICAgICAg
ICAgZ290byBmYWlsOwogICAgICAgICAgICAgfQogICAgICAgICB9CiAKICAgICAgICAgaWYgKGRj
LT5yZWFsaXplKSB7Ci0gICAgICAgICAgICBkYy0+cmVhbGl6ZShkZXYsICZsb2NhbF9lcnIpOwor
ICAgICAgICAgICAgZGMtPnJlYWxpemUoZGV2LCBlcnJwKTsKICAgICAgICAgfQogCi0gICAgICAg
IGlmIChsb2NhbF9lcnIgIT0gTlVMTCkgeworICAgICAgICBpZiAoKmVycnAgIT0gTlVMTCkgewog
ICAgICAgICAgICAgZ290byBmYWlsOwogICAgICAgICB9CiAKQEAgLTg2OSwxNSArODY2LDE1IEBA
IHN0YXRpYyB2b2lkIGRldmljZV9zZXRfcmVhbGl6ZWQoT2JqZWN0ICpvYmosIGJvb2wgdmFsdWUs
IEVycm9yICoqZXJycCkKICAgICAgICAgICAgIGlmICh2bXN0YXRlX3JlZ2lzdGVyX3dpdGhfYWxp
YXNfaWQoZGV2LCAtMSwgcWRldl9nZXRfdm1zZChkZXYpLCBkZXYsCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldi0+aW5zdGFuY2VfaWRfYWxpYXMsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldi0+YWxpYXNf
cmVxdWlyZWRfZm9yX3ZlcnNpb24sCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICZsb2NhbF9lcnIpIDwgMCkgeworICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBlcnJwKSA8IDApIHsKICAgICAgICAgICAgICAgICBnb3Rv
IHBvc3RfcmVhbGl6ZV9mYWlsOwogICAgICAgICAgICAgfQogICAgICAgICB9CiAKICAgICAgICAg
UUxJU1RfRk9SRUFDSChidXMsICZkZXYtPmNoaWxkX2J1cywgc2libGluZykgewogICAgICAgICAg
ICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVChidXMpLCB0cnVlLCAicmVhbGl6ZWQi
LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmbG9jYWxfZXJyKTsK
LSAgICAgICAgICAgIGlmIChsb2NhbF9lcnIgIT0gTlVMTCkgeworICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBlcnJwKTsKKyAgICAgICAgICAgIGlmICgqZXJycCAhPSBO
VUxMKSB7CiAgICAgICAgICAgICAgICAgZ290byBjaGlsZF9yZWFsaXplX2ZhaWw7CiAgICAgICAg
ICAgICB9CiAgICAgICAgIH0KQEAgLTg4Nyw4ICs4ODQsOCBAQCBzdGF0aWMgdm9pZCBkZXZpY2Vf
c2V0X3JlYWxpemVkKE9iamVjdCAqb2JqLCBib29sIHZhbHVlLCBFcnJvciAqKmVycnApCiAgICAg
ICAgIGRldi0+cGVuZGluZ19kZWxldGVkX2V2ZW50ID0gZmFsc2U7CiAKICAgICAgICAgaWYgKGhv
dHBsdWdfY3RybCkgewotICAgICAgICAgICAgaG90cGx1Z19oYW5kbGVyX3BsdWcoaG90cGx1Z19j
dHJsLCBkZXYsICZsb2NhbF9lcnIpOwotICAgICAgICAgICAgaWYgKGxvY2FsX2VyciAhPSBOVUxM
KSB7CisgICAgICAgICAgICBob3RwbHVnX2hhbmRsZXJfcGx1Zyhob3RwbHVnX2N0cmwsIGRldiwg
ZXJycCk7CisgICAgICAgICAgICBpZiAoKmVycnAgIT0gTlVMTCkgewogICAgICAgICAgICAgICAg
IGdvdG8gY2hpbGRfcmVhbGl6ZV9mYWlsOwogICAgICAgICAgICAgfQogICAgICAgIH0KQEAgLTg5
Niw3ICs4OTMsNyBAQCBzdGF0aWMgdm9pZCBkZXZpY2Vfc2V0X3JlYWxpemVkKE9iamVjdCAqb2Jq
LCBib29sIHZhbHVlLCBFcnJvciAqKmVycnApCiAgICAgfSBlbHNlIGlmICghdmFsdWUgJiYgZGV2
LT5yZWFsaXplZCkgewogICAgICAgICBFcnJvciAqKmxvY2FsX2VycnAgPSBOVUxMOwogICAgICAg
ICBRTElTVF9GT1JFQUNIKGJ1cywgJmRldi0+Y2hpbGRfYnVzLCBzaWJsaW5nKSB7Ci0gICAgICAg
ICAgICBsb2NhbF9lcnJwID0gbG9jYWxfZXJyID8gTlVMTCA6ICZsb2NhbF9lcnI7CisgICAgICAg
ICAgICBsb2NhbF9lcnJwID0gKmVycnAgPyBOVUxMIDogZXJycDsKICAgICAgICAgICAgIG9iamVj
dF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoYnVzKSwgZmFsc2UsICJyZWFsaXplZCIsCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxfZXJycCk7CiAgICAgICAgIH0K
QEAgLTkwNCwxNCArOTAxLDE0IEBAIHN0YXRpYyB2b2lkIGRldmljZV9zZXRfcmVhbGl6ZWQoT2Jq
ZWN0ICpvYmosIGJvb2wgdmFsdWUsIEVycm9yICoqZXJycCkKICAgICAgICAgICAgIHZtc3RhdGVf
dW5yZWdpc3RlcihkZXYsIHFkZXZfZ2V0X3Ztc2QoZGV2KSwgZGV2KTsKICAgICAgICAgfQogICAg
ICAgICBpZiAoZGMtPnVucmVhbGl6ZSkgewotICAgICAgICAgICAgbG9jYWxfZXJycCA9IGxvY2Fs
X2VyciA/IE5VTEwgOiAmbG9jYWxfZXJyOworICAgICAgICAgICAgbG9jYWxfZXJycCA9ICplcnJw
ID8gTlVMTCA6IGVycnA7CiAgICAgICAgICAgICBkYy0+dW5yZWFsaXplKGRldiwgbG9jYWxfZXJy
cCk7CiAgICAgICAgIH0KICAgICAgICAgZGV2LT5wZW5kaW5nX2RlbGV0ZWRfZXZlbnQgPSB0cnVl
OwogICAgICAgICBERVZJQ0VfTElTVEVORVJfQ0FMTCh1bnJlYWxpemUsIFJldmVyc2UsIGRldik7
CiAgICAgfQogCi0gICAgaWYgKGxvY2FsX2VyciAhPSBOVUxMKSB7CisgICAgaWYgKCplcnJwICE9
IE5VTEwpIHsKICAgICAgICAgZ290byBmYWlsOwogICAgIH0KIApAQCAtOTM2LDcgKzkzMyw2IEBA
IHBvc3RfcmVhbGl6ZV9mYWlsOgogICAgIH0KIAogZmFpbDoKLSAgICBlcnJvcl9wcm9wYWdhdGUo
ZXJycCwgbG9jYWxfZXJyKTsKICAgICBpZiAodW5hdHRhY2hlZF9wYXJlbnQpIHsKICAgICAgICAg
b2JqZWN0X3VucGFyZW50KE9CSkVDVChkZXYpKTsKICAgICAgICAgdW5hdHRhY2hlZF9jb3VudC0t
OwpkaWZmIC0tZ2l0IGEvaHcvY29yZS9zeXNidXMuYyBiL2h3L2NvcmUvc3lzYnVzLmMKaW5kZXgg
OWU2OWM4M2FlZC4uYmI3ZDI1ZGYzOCAxMDA2NDQKLS0tIGEvaHcvY29yZS9zeXNidXMuYworKysg
Yi9ody9jb3JlL3N5c2J1cy5jCkBAIC0yMTksNiArMjE5LDcgQEAgdm9pZCBzeXNidXNfaW5pdF9p
b3BvcnRzKFN5c0J1c0RldmljZSAqZGV2LCB1aW50MzJfdCBpb3BvcnQsIHVpbnQzMl90IHNpemUp
CiAgKi8KIHN0YXRpYyB2b2lkIHN5c2J1c19yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9y
ICoqZXJycCkKIHsKKwlFUlJQX0ZVTkNUSU9OX0JFR0lOKCk7CiB9CiAKIERldmljZVN0YXRlICpz
eXNidXNfY3JlYXRlX3ZhcmFyZ3MoY29uc3QgY2hhciAqbmFtZSwKZGlmZiAtLWdpdCBhL2h3L2Nw
dS9hMTVtcGNvcmUuYyBiL2h3L2NwdS9hMTVtcGNvcmUuYwppbmRleCA3ZTk5ODNhYTE5Li42ZGZj
YzlhMDQyIDEwMDY0NAotLS0gYS9ody9jcHUvYTE1bXBjb3JlLmMKKysrIGIvaHcvY3B1L2ExNW1w
Y29yZS5jCkBAIC01NCw3ICs1NCw2IEBAIHN0YXRpYyB2b2lkIGExNW1wX3ByaXZfcmVhbGl6ZShE
ZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgRGV2aWNlU3RhdGUgKmdpY2RldjsK
ICAgICBTeXNCdXNEZXZpY2UgKmJ1c2RldjsKICAgICBpbnQgaTsKLSAgICBFcnJvciAqZXJyID0g
TlVMTDsKICAgICBib29sIGhhc19lbDM7CiAgICAgYm9vbCBoYXNfZWwyID0gZmFsc2U7CiAgICAg
T2JqZWN0ICpjcHVvYmo7CkBAIC03Nyw5ICs3Niw4IEBAIHN0YXRpYyB2b2lkIGExNW1wX3ByaXZf
cmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgICAgIHFkZXZfcHJv
cF9zZXRfYml0KGdpY2RldiwgImhhcy12aXJ0dWFsaXphdGlvbi1leHRlbnNpb25zIiwgaGFzX2Vs
Mik7CiAgICAgfQogCi0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+Z2lj
KSwgdHJ1ZSwgInJlYWxpemVkIiwgJmVycik7Ci0gICAgaWYgKGVyciAhPSBOVUxMKSB7Ci0gICAg
ICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRf
Ym9vbChPQkpFQ1QoJnMtPmdpYyksIHRydWUsICJyZWFsaXplZCIsIGVycnApOworICAgIGlmICgq
ZXJycCAhPSBOVUxMKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAgICAgYnVzZGV2ID0gU1lT
X0JVU19ERVZJQ0UoJnMtPmdpYyk7CmRpZmYgLS1naXQgYS9ody9jcHUvYTltcGNvcmUuYyBiL2h3
L2NwdS9hOW1wY29yZS5jCmluZGV4IDY4NzJhM2EwMGEuLmUxYzAxMGMxNTggMTAwNjQ0Ci0tLSBh
L2h3L2NwdS9hOW1wY29yZS5jCisrKyBiL2h3L2NwdS9hOW1wY29yZS5jCkBAIC01MSwxNiArNTEs
MTQgQEAgc3RhdGljIHZvaWQgYTltcF9wcml2X3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJy
b3IgKiplcnJwKQogICAgIERldmljZVN0YXRlICpzY3VkZXYsICpnaWNkZXYsICpndGltZXJkZXYs
ICptcHRpbWVyZGV2LCAqd2R0ZGV2OwogICAgIFN5c0J1c0RldmljZSAqc2N1YnVzZGV2LCAqZ2lj
YnVzZGV2LCAqZ3RpbWVyYnVzZGV2LCAqbXB0aW1lcmJ1c2RldiwKICAgICAgICAgICAgICAgICAg
KndkdGJ1c2RldjsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKICAgICBpbnQgaTsKICAgICBib29s
IGhhc19lbDM7CiAgICAgT2JqZWN0ICpjcHVvYmo7CiAKICAgICBzY3VkZXYgPSBERVZJQ0UoJnMt
PnNjdSk7CiAgICAgcWRldl9wcm9wX3NldF91aW50MzIoc2N1ZGV2LCAibnVtLWNwdSIsIHMtPm51
bV9jcHUpOwotICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPnNjdSksIHRy
dWUsICJyZWFsaXplZCIsICZlcnIpOwotICAgIGlmIChlcnIgIT0gTlVMTCkgewotICAgICAgICBl
cnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2wo
T0JKRUNUKCZzLT5zY3UpLCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAgICBpZiAoKmVycnAg
IT0gTlVMTCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogICAgIHNjdWJ1c2RldiA9IFNZU19C
VVNfREVWSUNFKCZzLT5zY3UpOwpAQCAtNzcsOSArNzUsOCBAQCBzdGF0aWMgdm9pZCBhOW1wX3By
aXZfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgICAgIG9iamVj
dF9wcm9wZXJ0eV9nZXRfYm9vbChjcHVvYmosICJoYXNfZWwzIiwgJmVycm9yX2Fib3J0KTsKICAg
ICBxZGV2X3Byb3Bfc2V0X2JpdChnaWNkZXYsICJoYXMtc2VjdXJpdHktZXh0ZW5zaW9ucyIsIGhh
c19lbDMpOwogCi0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+Z2ljKSwg
dHJ1ZSwgInJlYWxpemVkIiwgJmVycik7Ci0gICAgaWYgKGVyciAhPSBOVUxMKSB7Ci0gICAgICAg
IGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9v
bChPQkpFQ1QoJnMtPmdpYyksIHRydWUsICJyZWFsaXplZCIsIGVycnApOworICAgIGlmICgqZXJy
cCAhPSBOVUxMKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAgICAgZ2ljYnVzZGV2ID0gU1lT
X0JVU19ERVZJQ0UoJnMtPmdpYyk7CkBAIC05MiwyNyArODksMjQgQEAgc3RhdGljIHZvaWQgYTlt
cF9wcml2X3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogCiAgICAgZ3Rp
bWVyZGV2ID0gREVWSUNFKCZzLT5ndGltZXIpOwogICAgIHFkZXZfcHJvcF9zZXRfdWludDMyKGd0
aW1lcmRldiwgIm51bS1jcHUiLCBzLT5udW1fY3B1KTsKLSAgICBvYmplY3RfcHJvcGVydHlfc2V0
X2Jvb2woT0JKRUNUKCZzLT5ndGltZXIpLCB0cnVlLCAicmVhbGl6ZWQiLCAmZXJyKTsKLSAgICBp
ZiAoZXJyICE9IE5VTEwpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7Cisg
ICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+Z3RpbWVyKSwgdHJ1ZSwgInJl
YWxpemVkIiwgZXJycCk7CisgICAgaWYgKCplcnJwICE9IE5VTEwpIHsKICAgICAgICAgcmV0dXJu
OwogICAgIH0KICAgICBndGltZXJidXNkZXYgPSBTWVNfQlVTX0RFVklDRSgmcy0+Z3RpbWVyKTsK
IAogICAgIG1wdGltZXJkZXYgPSBERVZJQ0UoJnMtPm1wdGltZXIpOwogICAgIHFkZXZfcHJvcF9z
ZXRfdWludDMyKG1wdGltZXJkZXYsICJudW0tY3B1Iiwgcy0+bnVtX2NwdSk7Ci0gICAgb2JqZWN0
X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+bXB0aW1lciksIHRydWUsICJyZWFsaXplZCIs
ICZlcnIpOwotICAgIGlmIChlcnIgIT0gTlVMTCkgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUo
ZXJycCwgZXJyKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5tcHRp
bWVyKSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgaWYgKCplcnJwICE9IE5VTEwpIHsK
ICAgICAgICAgcmV0dXJuOwogICAgIH0KICAgICBtcHRpbWVyYnVzZGV2ID0gU1lTX0JVU19ERVZJ
Q0UoJnMtPm1wdGltZXIpOwogCiAgICAgd2R0ZGV2ID0gREVWSUNFKCZzLT53ZHQpOwogICAgIHFk
ZXZfcHJvcF9zZXRfdWludDMyKHdkdGRldiwgIm51bS1jcHUiLCBzLT5udW1fY3B1KTsKLSAgICBv
YmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT53ZHQpLCB0cnVlLCAicmVhbGl6ZWQi
LCAmZXJyKTsKLSAgICBpZiAoZXJyICE9IE5VTEwpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRl
KGVycnAsIGVycik7CisgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+d2R0
KSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgaWYgKCplcnJwICE9IE5VTEwpIHsKICAg
ICAgICAgcmV0dXJuOwogICAgIH0KICAgICB3ZHRidXNkZXYgPSBTWVNfQlVTX0RFVklDRSgmcy0+
d2R0KTsKZGlmZiAtLWdpdCBhL2h3L2NwdS9hcm0xMW1wY29yZS5jIGIvaHcvY3B1L2FybTExbXBj
b3JlLmMKaW5kZXggZTc4ZjVkMDgwYy4uMjI5MmMyZGJmNiAxMDA2NDQKLS0tIGEvaHcvY3B1L2Fy
bTExbXBjb3JlLmMKKysrIGIvaHcvY3B1L2FybTExbXBjb3JlLmMKQEAgLTc1LDIwICs3NSwxNyBA
QCBzdGF0aWMgdm9pZCBtcGNvcmVfcHJpdl9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9y
ICoqZXJycCkKICAgICBEZXZpY2VTdGF0ZSAqZ2ljZGV2ID0gREVWSUNFKCZzLT5naWMpOwogICAg
IERldmljZVN0YXRlICptcHRpbWVyZGV2ID0gREVWSUNFKCZzLT5tcHRpbWVyKTsKICAgICBEZXZp
Y2VTdGF0ZSAqd2R0aW1lcmRldiA9IERFVklDRSgmcy0+d2R0aW1lcik7Ci0gICAgRXJyb3IgKmVy
ciA9IE5VTEw7CiAKICAgICBxZGV2X3Byb3Bfc2V0X3VpbnQzMihzY3VkZXYsICJudW0tY3B1Iiwg
cy0+bnVtX2NwdSk7Ci0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+c2N1
KSwgdHJ1ZSwgInJlYWxpemVkIiwgJmVycik7Ci0gICAgaWYgKGVyciAhPSBOVUxMKSB7Ci0gICAg
ICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRf
Ym9vbChPQkpFQ1QoJnMtPnNjdSksIHRydWUsICJyZWFsaXplZCIsIGVycnApOworICAgIGlmICgq
ZXJycCAhPSBOVUxMKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKICAgICBxZGV2X3Byb3Bf
c2V0X3VpbnQzMihnaWNkZXYsICJudW0tY3B1Iiwgcy0+bnVtX2NwdSk7CiAgICAgcWRldl9wcm9w
X3NldF91aW50MzIoZ2ljZGV2LCAibnVtLWlycSIsIHMtPm51bV9pcnEpOwotICAgIG9iamVjdF9w
cm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPmdpYyksIHRydWUsICJyZWFsaXplZCIsICZlcnIp
OwotICAgIGlmIChlcnIgIT0gTlVMTCkgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwg
ZXJyKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5naWMpLCB0cnVl
LCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAgICBpZiAoKmVycnAgIT0gTlVMTCkgewogICAgICAgICBy
ZXR1cm47CiAgICAgfQogCkBAIC05OSwxNiArOTYsMTQgQEAgc3RhdGljIHZvaWQgbXBjb3JlX3By
aXZfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgcWRldl9pbml0
X2dwaW9faW4oZGV2LCBtcGNvcmVfcHJpdl9zZXRfaXJxLCBzLT5udW1faXJxIC0gMzIpOwogCiAg
ICAgcWRldl9wcm9wX3NldF91aW50MzIobXB0aW1lcmRldiwgIm51bS1jcHUiLCBzLT5udW1fY3B1
KTsKLSAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5tcHRpbWVyKSwgdHJ1
ZSwgInJlYWxpemVkIiwgJmVycik7Ci0gICAgaWYgKGVyciAhPSBOVUxMKSB7Ci0gICAgICAgIGVy
cm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChP
QkpFQ1QoJnMtPm1wdGltZXIpLCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAgICBpZiAoKmVy
cnAgIT0gTlVMTCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCiAgICAgcWRldl9wcm9wX3Nl
dF91aW50MzIod2R0aW1lcmRldiwgIm51bS1jcHUiLCBzLT5udW1fY3B1KTsKLSAgICBvYmplY3Rf
cHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT53ZHRpbWVyKSwgdHJ1ZSwgInJlYWxpemVkIiwg
JmVycik7Ci0gICAgaWYgKGVyciAhPSBOVUxMKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShl
cnJwLCBlcnIpOworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPndkdGlt
ZXIpLCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAgICBpZiAoKmVycnAgIT0gTlVMTCkgewog
ICAgICAgICByZXR1cm47CiAgICAgfQogCmRpZmYgLS1naXQgYS9ody9jcHUvY29yZS5jIGIvaHcv
Y3B1L2NvcmUuYwppbmRleCA5ODc0YzVjODcwLi44ZjJkNGUzYjY0IDEwMDY0NAotLS0gYS9ody9j
cHUvY29yZS5jCisrKyBiL2h3L2NwdS9jb3JlLmMKQEAgLTI4LDEyICsyOCwxMCBAQCBzdGF0aWMg
dm9pZCBjb3JlX3Byb3Bfc2V0X2NvcmVfaWQoT2JqZWN0ICpvYmosIFZpc2l0b3IgKnYsIGNvbnN0
IGNoYXIgKm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqb3Bh
cXVlLCBFcnJvciAqKmVycnApCiB7CiAgICAgQ1BVQ29yZSAqY29yZSA9IENQVV9DT1JFKG9iaik7
Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgaW50NjRfdCB2YWx1ZTsKIAotICAg
IHZpc2l0X3R5cGVfaW50KHYsIG5hbWUsICZ2YWx1ZSwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxv
Y2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAg
ICB2aXNpdF90eXBlX2ludCh2LCBuYW1lLCAmdmFsdWUsIGVycnApOworICAgIGlmICgqZXJycCkg
ewogICAgICAgICByZXR1cm47CiAgICAgfQogCkBAIC01OCwxMiArNTYsMTAgQEAgc3RhdGljIHZv
aWQgY29yZV9wcm9wX3NldF9ucl90aHJlYWRzKE9iamVjdCAqb2JqLCBWaXNpdG9yICp2LCBjb25z
dCBjaGFyICpuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQg
Km9wYXF1ZSwgRXJyb3IgKiplcnJwKQogewogICAgIENQVUNvcmUgKmNvcmUgPSBDUFVfQ09SRShv
YmopOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIGludDY0X3QgdmFsdWU7CiAK
LSAgICB2aXNpdF90eXBlX2ludCh2LCBuYW1lLCAmdmFsdWUsICZsb2NhbF9lcnIpOwotICAgIGlm
IChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7
CisgICAgdmlzaXRfdHlwZV9pbnQodiwgbmFtZSwgJnZhbHVlLCBlcnJwKTsKKyAgICBpZiAoKmVy
cnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApkaWZmIC0tZ2l0IGEvaHcvY3B1L3JlYWx2
aWV3X21wY29yZS5jIGIvaHcvY3B1L3JlYWx2aWV3X21wY29yZS5jCmluZGV4IGFlMmM5OTEzZjYu
LmQ2MzMxMTkyYTUgMTAwNjQ0Ci0tLSBhL2h3L2NwdS9yZWFsdmlld19tcGNvcmUuYworKysgYi9o
dy9jcHUvcmVhbHZpZXdfbXBjb3JlLmMKQEAgLTY1LDE0ICs2NSwxMiBAQCBzdGF0aWMgdm9pZCBy
ZWFsdmlld19tcGNvcmVfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAg
ICAgRGV2aWNlU3RhdGUgKnByaXYgPSBERVZJQ0UoJnMtPnByaXYpOwogICAgIERldmljZVN0YXRl
ICpnaWM7CiAgICAgU3lzQnVzRGV2aWNlICpnaWNidXNkZXY7Ci0gICAgRXJyb3IgKmVyciA9IE5V
TEw7CiAgICAgaW50IG47CiAgICAgaW50IGk7CiAKICAgICBxZGV2X3Byb3Bfc2V0X3VpbnQzMihw
cml2LCAibnVtLWNwdSIsIHMtPm51bV9jcHUpOwotICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9v
bChPQkpFQ1QoJnMtPnByaXYpLCB0cnVlLCAicmVhbGl6ZWQiLCAmZXJyKTsKLSAgICBpZiAoZXJy
ICE9IE5VTEwpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgb2Jq
ZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+cHJpdiksIHRydWUsICJyZWFsaXplZCIs
IGVycnApOworICAgIGlmICgqZXJycCAhPSBOVUxMKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9
CiAgICAgc3lzYnVzX3Bhc3NfaXJxKHNiZCwgU1lTX0JVU19ERVZJQ0UoJnMtPnByaXYpKTsKQEAg
LTgxLDkgKzc5LDggQEAgc3RhdGljIHZvaWQgcmVhbHZpZXdfbXBjb3JlX3JlYWxpemUoRGV2aWNl
U3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogICAgIH0KICAgICAvKiA/Pz8gSVJRIHJvdXRpbmcg
aXMgaGFyZGNvZGVkIHRvICJub3JtYWwiIG1vZGUuICAqLwogICAgIGZvciAobiA9IDA7IG4gPCA0
OyBuKyspIHsKLSAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+Z2lj
W25dKSwgdHJ1ZSwgInJlYWxpemVkIiwgJmVycik7Ci0gICAgICAgIGlmIChlcnIgIT0gTlVMTCkg
ewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgICAgIG9iamVj
dF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPmdpY1tuXSksIHRydWUsICJyZWFsaXplZCIs
IGVycnApOworICAgICAgICBpZiAoKmVycnAgIT0gTlVMTCkgewogICAgICAgICAgICAgcmV0dXJu
OwogICAgICAgICB9CiAgICAgICAgIGdpYyA9IERFVklDRSgmcy0+Z2ljW25dKTsKZGlmZiAtLWdp
dCBhL2h3L2Rpc3BsYXkvYmNtMjgzNV9mYi5jIGIvaHcvZGlzcGxheS9iY20yODM1X2ZiLmMKaW5k
ZXggOGY4NTY4NzhjZC4uNTg0ZmMwMTY0YyAxMDA2NDQKLS0tIGEvaHcvZGlzcGxheS9iY20yODM1
X2ZiLmMKKysrIGIvaHcvZGlzcGxheS9iY20yODM1X2ZiLmMKQEAgLTQwMiw3ICs0MDIsNiBAQCBz
dGF0aWMgdm9pZCBiY20yODM1X2ZiX3Jlc2V0KERldmljZVN0YXRlICpkZXYpCiBzdGF0aWMgdm9p
ZCBiY20yODM1X2ZiX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogewog
ICAgIEJDTTI4MzVGQlN0YXRlICpzID0gQkNNMjgzNV9GQihkZXYpOwotICAgIEVycm9yICplcnIg
PSBOVUxMOwogICAgIE9iamVjdCAqb2JqOwogCiAgICAgaWYgKHMtPnZjcmFtX2Jhc2UgPT0gMCkg
ewpAQCAtNDEwLDEwICs0MDksMTAgQEAgc3RhdGljIHZvaWQgYmNtMjgzNV9mYl9yZWFsaXplKERl
dmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAgICAgICAgcmV0dXJuOwogICAgIH0KIAot
ICAgIG9iaiA9IG9iamVjdF9wcm9wZXJ0eV9nZXRfbGluayhPQkpFQ1QoZGV2KSwgImRtYS1tciIs
ICZlcnIpOworICAgIG9iaiA9IG9iamVjdF9wcm9wZXJ0eV9nZXRfbGluayhPQkpFQ1QoZGV2KSwg
ImRtYS1tciIsIGVycnApOwogICAgIGlmIChvYmogPT0gTlVMTCkgewogICAgICAgICBlcnJvcl9z
ZXRnKGVycnAsICIlczogcmVxdWlyZWQgZG1hLW1yIGxpbmsgbm90IGZvdW5kOiAlcyIsCi0gICAg
ICAgICAgICAgICAgICAgX19mdW5jX18sIGVycm9yX2dldF9wcmV0dHkoZXJyKSk7CisgICAgICAg
ICAgICAgICAgICAgX19mdW5jX18sIGVycm9yX2dldF9wcmV0dHkoKmVycnApKTsKICAgICAgICAg
cmV0dXJuOwogICAgIH0KIApkaWZmIC0tZ2l0IGEvaHcvZGlzcGxheS9xeGwuYyBiL2h3L2Rpc3Bs
YXkvcXhsLmMKaW5kZXggY2Q3ZWIzOWQyMC4uYzY5MzcyNjI1MyAxMDA2NDQKLS0tIGEvaHcvZGlz
cGxheS9xeGwuYworKysgYi9ody9kaXNwbGF5L3F4bC5jCkBAIC0yMjEyLDcgKzIyMTIsNiBAQCBz
dGF0aWMgdm9pZCBxeGxfcmVhbGl6ZV9wcmltYXJ5KFBDSURldmljZSAqZGV2LCBFcnJvciAqKmVy
cnApCiB7CiAgICAgUENJUVhMRGV2aWNlICpxeGwgPSBQQ0lfUVhMKGRldik7CiAgICAgVkdBQ29t
bW9uU3RhdGUgKnZnYSA9ICZxeGwtPnZnYTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsK
IAogICAgIHF4bF9pbml0X3JhbXNpemUocXhsKTsKICAgICB2Z2EtPnZiZV9zaXplID0gcXhsLT52
Z2FtZW1fc2l6ZTsKQEAgLTIyMzQsOSArMjIzMyw4IEBAIHN0YXRpYyB2b2lkIHF4bF9yZWFsaXpl
X3ByaW1hcnkoUENJRGV2aWNlICpkZXYsIEVycm9yICoqZXJycCkKICAgICAgICAgcmV0dXJuOwog
ICAgIH0KIAotICAgIHF4bF9yZWFsaXplX2NvbW1vbihxeGwsICZsb2NhbF9lcnIpOwotICAgIGlm
IChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7
CisgICAgcXhsX3JlYWxpemVfY29tbW9uKHF4bCwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAg
ICAgICAgIHJldHVybjsKICAgICB9CiAKZGlmZiAtLWdpdCBhL2h3L2Rpc3BsYXkvdmlydGlvLWdw
dS1iYXNlLmMgYi9ody9kaXNwbGF5L3ZpcnRpby1ncHUtYmFzZS5jCmluZGV4IDU1ZTA3OTk1ZmUu
LjI0MTgzOWU4M2YgMTAwNjQ0Ci0tLSBhL2h3L2Rpc3BsYXkvdmlydGlvLWdwdS1iYXNlLmMKKysr
IGIvaHcvZGlzcGxheS92aXJ0aW8tZ3B1LWJhc2UuYwpAQCAtMTI4LDcgKzEyOCw2IEBAIHZpcnRp
b19ncHVfYmFzZV9kZXZpY2VfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqcWRldiwKIHsKICAgICBWaXJ0
SU9EZXZpY2UgKnZkZXYgPSBWSVJUSU9fREVWSUNFKHFkZXYpOwogICAgIFZpcnRJT0dQVUJhc2Ug
KmcgPSBWSVJUSU9fR1BVX0JBU0UocWRldik7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7
CiAgICAgaW50IGk7CiAKICAgICBpZiAoZy0+Y29uZi5tYXhfb3V0cHV0cyA+IFZJUlRJT19HUFVf
TUFYX1NDQU5PVVRTKSB7CkBAIC0xMzksOSArMTM4LDggQEAgdmlydGlvX2dwdV9iYXNlX2Rldmlj
ZV9yZWFsaXplKERldmljZVN0YXRlICpxZGV2LAogICAgIGctPnVzZV92aXJnbF9yZW5kZXJlciA9
IGZhbHNlOwogICAgIGlmICh2aXJ0aW9fZ3B1X3ZpcmdsX2VuYWJsZWQoZy0+Y29uZikpIHsKICAg
ICAgICAgZXJyb3Jfc2V0ZygmZy0+bWlncmF0aW9uX2Jsb2NrZXIsICJ2aXJnbCBpcyBub3QgeWV0
IG1pZ3JhdGFibGUiKTsKLSAgICAgICAgbWlncmF0ZV9hZGRfYmxvY2tlcihnLT5taWdyYXRpb25f
YmxvY2tlciwgJmxvY2FsX2Vycik7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAg
ICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICBtaWdyYXRlX2Fk
ZF9ibG9ja2VyKGctPm1pZ3JhdGlvbl9ibG9ja2VyLCBlcnJwKTsKKyAgICAgICAgaWYgKCplcnJw
KSB7CiAgICAgICAgICAgICBlcnJvcl9mcmVlKGctPm1pZ3JhdGlvbl9ibG9ja2VyKTsKICAgICAg
ICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgfQpkaWZmIC0tZ2l0IGEvaHcvZGlzcGxheS92
aXJ0aW8tZ3B1LXBjaS5jIGIvaHcvZGlzcGxheS92aXJ0aW8tZ3B1LXBjaS5jCmluZGV4IDI1ZTQw
Mzg4NzQuLmI2ZjhjMjA3YzkgMTAwNjQ0Ci0tLSBhL2h3L2Rpc3BsYXkvdmlydGlvLWdwdS1wY2ku
YworKysgYi9ody9kaXNwbGF5L3ZpcnRpby1ncHUtcGNpLmMKQEAgLTMxLDE0ICszMSwxMiBAQCBz
dGF0aWMgdm9pZCB2aXJ0aW9fZ3B1X3BjaV9iYXNlX3JlYWxpemUoVmlydElPUENJUHJveHkgKnZw
Y2lfZGV2LCBFcnJvciAqKmVycnApCiAgICAgVmlydElPR1BVQmFzZSAqZyA9IHZncHUtPnZncHU7
CiAgICAgRGV2aWNlU3RhdGUgKnZkZXYgPSBERVZJQ0UoZyk7CiAgICAgaW50IGk7Ci0gICAgRXJy
b3IgKmxvY2FsX2Vycm9yID0gTlVMTDsKIAogICAgIHFkZXZfc2V0X3BhcmVudF9idXModmRldiwg
QlVTKCZ2cGNpX2Rldi0+YnVzKSk7CiAgICAgdmlydGlvX3BjaV9mb3JjZV92aXJ0aW9fMSh2cGNp
X2Rldik7Ci0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCh2ZGV2KSwgdHJ1ZSwg
InJlYWxpemVkIiwgJmxvY2FsX2Vycm9yKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2wo
T0JKRUNUKHZkZXYpLCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKIAotICAgIGlmIChsb2NhbF9l
cnJvcikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyb3IpOworICAg
IGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCmRpZmYgLS1naXQgYS9ody9k
aXNwbGF5L3ZpcnRpby12Z2EuYyBiL2h3L2Rpc3BsYXkvdmlydGlvLXZnYS5jCmluZGV4IGNjNmU2
NmVhMWMuLmJkN2NjMDZmODYgMTAwNjQ0Ci0tLSBhL2h3L2Rpc3BsYXkvdmlydGlvLXZnYS5jCisr
KyBiL2h3L2Rpc3BsYXkvdmlydGlvLXZnYS5jCkBAIC05Myw3ICs5Myw2IEBAIHN0YXRpYyB2b2lk
IHZpcnRpb192Z2FfYmFzZV9yZWFsaXplKFZpcnRJT1BDSVByb3h5ICp2cGNpX2RldiwgRXJyb3Ig
KiplcnJwKQogICAgIFZpcnRJT1ZHQUJhc2UgKnZ2Z2EgPSBWSVJUSU9fVkdBX0JBU0UodnBjaV9k
ZXYpOwogICAgIFZpcnRJT0dQVUJhc2UgKmcgPSB2dmdhLT52Z3B1OwogICAgIFZHQUNvbW1vblN0
YXRlICp2Z2EgPSAmdnZnYS0+dmdhOwotICAgIEVycm9yICplcnIgPSBOVUxMOwogICAgIHVpbnQz
Ml90IG9mZnNldDsKICAgICBpbnQgaTsKIApAQCAtMTM4LDkgKzEzNyw4IEBAIHN0YXRpYyB2b2lk
IHZpcnRpb192Z2FfYmFzZV9yZWFsaXplKFZpcnRJT1BDSVByb3h5ICp2cGNpX2RldiwgRXJyb3Ig
KiplcnJwKQogICAgIC8qIGluaXQgdmlydGlvIGJpdHMgKi8KICAgICBxZGV2X3NldF9wYXJlbnRf
YnVzKERFVklDRShnKSwgQlVTKCZ2cGNpX2Rldi0+YnVzKSk7CiAgICAgdmlydGlvX3BjaV9mb3Jj
ZV92aXJ0aW9fMSh2cGNpX2Rldik7Ci0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVD
VChnKSwgdHJ1ZSwgInJlYWxpemVkIiwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBl
cnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2wo
T0JKRUNUKGcpLCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAg
ICAgICAgcmV0dXJuOwogICAgIH0KIApkaWZmIC0tZ2l0IGEvaHcvZG1hL2JjbTI4MzVfZG1hLmMg
Yi9ody9kbWEvYmNtMjgzNV9kbWEuYwppbmRleCAxOTJiZDM3N2EwLi4zMzE3NzliYmQ5IDEwMDY0
NAotLS0gYS9ody9kbWEvYmNtMjgzNV9kbWEuYworKysgYi9ody9kbWEvYmNtMjgzNV9kbWEuYwpA
QCAtMzcyLDEzICszNzIsMTIgQEAgc3RhdGljIHZvaWQgYmNtMjgzNV9kbWFfcmVzZXQoRGV2aWNl
U3RhdGUgKmRldikKIHN0YXRpYyB2b2lkIGJjbTI4MzVfZG1hX3JlYWxpemUoRGV2aWNlU3RhdGUg
KmRldiwgRXJyb3IgKiplcnJwKQogewogICAgIEJDTTI4MzVETUFTdGF0ZSAqcyA9IEJDTTI4MzVf
RE1BKGRldik7Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7CiAgICAgT2JqZWN0ICpvYmo7CiAKLSAg
ICBvYmogPSBvYmplY3RfcHJvcGVydHlfZ2V0X2xpbmsoT0JKRUNUKGRldiksICJkbWEtbXIiLCAm
ZXJyKTsKKyAgICBvYmogPSBvYmplY3RfcHJvcGVydHlfZ2V0X2xpbmsoT0JKRUNUKGRldiksICJk
bWEtbXIiLCBlcnJwKTsKICAgICBpZiAob2JqID09IE5VTEwpIHsKICAgICAgICAgZXJyb3Jfc2V0
ZyhlcnJwLCAiJXM6IHJlcXVpcmVkIGRtYS1tciBsaW5rIG5vdCBmb3VuZDogJXMiLAotICAgICAg
ICAgICAgICAgICAgIF9fZnVuY19fLCBlcnJvcl9nZXRfcHJldHR5KGVycikpOworICAgICAgICAg
ICAgICAgICAgIF9fZnVuY19fLCBlcnJvcl9nZXRfcHJldHR5KCplcnJwKSk7CiAgICAgICAgIHJl
dHVybjsKICAgICB9CiAKZGlmZiAtLWdpdCBhL2h3L2RtYS94aWxpbnhfYXhpZG1hLmMgYi9ody9k
bWEveGlsaW54X2F4aWRtYS5jCmluZGV4IGEyNTQyNzViNjQuLmI1ZjQ5ZTZmODggMTAwNjQ0Ci0t
LSBhL2h3L2RtYS94aWxpbnhfYXhpZG1hLmMKKysrIGIvaHcvZG1hL3hpbGlueF9heGlkbWEuYwpA
QCAtNTI0LDI0ICs1MjQsMjMgQEAgc3RhdGljIHZvaWQgeGlsaW54X2F4aWRtYV9yZWFsaXplKERl
dmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAgICBYaWxpbnhBWElETUFTdHJlYW1TbGF2
ZSAqZHMgPSBYSUxJTlhfQVhJX0RNQV9EQVRBX1NUUkVBTSgmcy0+cnhfZGF0YV9kZXYpOwogICAg
IFhpbGlueEFYSURNQVN0cmVhbVNsYXZlICpjcyA9IFhJTElOWF9BWElfRE1BX0NPTlRST0xfU1RS
RUFNKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgJnMtPnJ4X2NvbnRyb2xfZGV2KTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVM
TDsKIAogICAgIG9iamVjdF9wcm9wZXJ0eV9hZGRfbGluayhPQkpFQ1QoZHMpLCAiZG1hIiwgVFlQ
RV9YSUxJTlhfQVhJX0RNQSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKE9iamVjdCAq
KikmZHMtPmRtYSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0X3Byb3BlcnR5
X2FsbG93X3NldF9saW5rLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPQkpfUFJPUF9M
SU5LX1NUUk9ORywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJmxvY2FsX2Vycik7Cisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycnApOwogICAgIG9iamVjdF9wcm9wZXJ0eV9h
ZGRfbGluayhPQkpFQ1QoY3MpLCAiZG1hIiwgVFlQRV9YSUxJTlhfQVhJX0RNQSwKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgKE9iamVjdCAqKikmY3MtPmRtYSwKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgb2JqZWN0X3Byb3BlcnR5X2FsbG93X3NldF9saW5rLAogICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBPQkpfUFJPUF9MSU5LX1NUUk9ORywKLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgeworICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAg
Z290byB4aWxpbnhfYXhpZG1hX3JlYWxpemVfZmFpbDsKICAgICB9Ci0gICAgb2JqZWN0X3Byb3Bl
cnR5X3NldF9saW5rKE9CSkVDVChkcyksIE9CSkVDVChzKSwgImRtYSIsICZsb2NhbF9lcnIpOwot
ICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfbGluayhPQkpFQ1QoY3MpLCBPQkpFQ1QocyksICJkbWEi
LCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7CisgICAgb2JqZWN0X3Byb3BlcnR5
X3NldF9saW5rKE9CSkVDVChkcyksIE9CSkVDVChzKSwgImRtYSIsIGVycnApOworICAgIG9iamVj
dF9wcm9wZXJ0eV9zZXRfbGluayhPQkpFQ1QoY3MpLCBPQkpFQ1QocyksICJkbWEiLCBlcnJwKTsK
KyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ290byB4aWxpbnhfYXhpZG1hX3JlYWxpemVfZmFp
bDsKICAgICB9CiAKQEAgLTU1OCw3ICs1NTcsNiBAQCBzdGF0aWMgdm9pZCB4aWxpbnhfYXhpZG1h
X3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogICAgIHJldHVybjsKIAog
eGlsaW54X2F4aWRtYV9yZWFsaXplX2ZhaWw6Ci0gICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxv
Y2FsX2Vycik7CiB9CiAKIHN0YXRpYyB2b2lkIHhpbGlueF9heGlkbWFfaW5pdChPYmplY3QgKm9i
aikKZGlmZiAtLWdpdCBhL2h3L2dwaW8vYXNwZWVkX2dwaW8uYyBiL2h3L2dwaW8vYXNwZWVkX2dw
aW8uYwppbmRleCAyNWZiZmVjM2I4Li42OTVjOTFhZWMxIDEwMDY0NAotLS0gYS9ody9ncGlvL2Fz
cGVlZF9ncGlvLmMKKysrIGIvaHcvZ3Bpby9hc3BlZWRfZ3Bpby5jCkBAIC02NzksMTYgKzY3OSwx
NCBAQCBzdGF0aWMgdm9pZCBhc3BlZWRfZ3Bpb19nZXRfcGluKE9iamVjdCAqb2JqLCBWaXNpdG9y
ICp2LCBjb25zdCBjaGFyICpuYW1lLAogc3RhdGljIHZvaWQgYXNwZWVkX2dwaW9fc2V0X3BpbihP
YmplY3QgKm9iaiwgVmlzaXRvciAqdiwgY29uc3QgY2hhciAqbmFtZSwKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICB2b2lkICpvcGFxdWUsIEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJv
ciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBib29sIGxldmVsOwogICAgIGludCBwaW4gPSAweGZm
ZjsKICAgICBjaGFyIGdyb3VwWzNdOwogICAgIEFzcGVlZEdQSU9TdGF0ZSAqcyA9IEFTUEVFRF9H
UElPKG9iaik7CiAgICAgaW50IHNldF9pZHgsIGdyb3VwX2lkeCA9IDA7CiAKLSAgICB2aXNpdF90
eXBlX2Jvb2wodiwgbmFtZSwgJmxldmVsLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJy
KSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHZpc2l0
X3R5cGVfYm9vbCh2LCBuYW1lLCAmbGV2ZWwsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAg
ICAgICByZXR1cm47CiAgICAgfQogICAgIGlmIChzc2NhbmYobmFtZSwgImdwaW8lMltBLVpdJTFk
IiwgZ3JvdXAsICZwaW4pICE9IDIpIHsKZGlmZiAtLWdpdCBhL2h3L2dwaW8vYmNtMjgzNV9ncGlv
LmMgYi9ody9ncGlvL2JjbTI4MzVfZ3Bpby5jCmluZGV4IDkxY2UzZDEwY2MuLjM2M2FkYTk2ZDIg
MTAwNjQ0Ci0tLSBhL2h3L2dwaW8vYmNtMjgzNV9ncGlvLmMKKysrIGIvaHcvZ3Bpby9iY20yODM1
X2dwaW8uYwpAQCAtMzEyLDIwICszMTIsMTkgQEAgc3RhdGljIHZvaWQgYmNtMjgzNV9ncGlvX3Jl
YWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogewogICAgIEJDTTI4MzVHcGlv
U3RhdGUgKnMgPSBCQ00yODM1X0dQSU8oZGV2KTsKICAgICBPYmplY3QgKm9iajsKLSAgICBFcnJv
ciAqZXJyID0gTlVMTDsKIAotICAgIG9iaiA9IG9iamVjdF9wcm9wZXJ0eV9nZXRfbGluayhPQkpF
Q1QoZGV2KSwgInNkYnVzLXNkaGNpIiwgJmVycik7CisgICAgb2JqID0gb2JqZWN0X3Byb3BlcnR5
X2dldF9saW5rKE9CSkVDVChkZXYpLCAic2RidXMtc2RoY2kiLCBlcnJwKTsKICAgICBpZiAob2Jq
ID09IE5VTEwpIHsKICAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAiJXM6IHJlcXVpcmVkIHNkaGNp
IGxpbmsgbm90IGZvdW5kOiAlcyIsCi0gICAgICAgICAgICAgICAgX19mdW5jX18sIGVycm9yX2dl
dF9wcmV0dHkoZXJyKSk7CisgICAgICAgICAgICAgICAgX19mdW5jX18sIGVycm9yX2dldF9wcmV0
dHkoKmVycnApKTsKICAgICAgICAgcmV0dXJuOwogICAgIH0KICAgICBzLT5zZGJ1c19zZGhjaSA9
IFNEX0JVUyhvYmopOwogCi0gICAgb2JqID0gb2JqZWN0X3Byb3BlcnR5X2dldF9saW5rKE9CSkVD
VChkZXYpLCAic2RidXMtc2Rob3N0IiwgJmVycik7CisgICAgb2JqID0gb2JqZWN0X3Byb3BlcnR5
X2dldF9saW5rKE9CSkVDVChkZXYpLCAic2RidXMtc2Rob3N0IiwgZXJycCk7CiAgICAgaWYgKG9i
aiA9PSBOVUxMKSB7CiAgICAgICAgIGVycm9yX3NldGcoZXJycCwgIiVzOiByZXF1aXJlZCBzZGhv
c3QgbGluayBub3QgZm91bmQ6ICVzIiwKLSAgICAgICAgICAgICAgICBfX2Z1bmNfXywgZXJyb3Jf
Z2V0X3ByZXR0eShlcnIpKTsKKyAgICAgICAgICAgICAgICBfX2Z1bmNfXywgZXJyb3JfZ2V0X3By
ZXR0eSgqZXJycCkpOwogICAgICAgICByZXR1cm47CiAgICAgfQogICAgIHMtPnNkYnVzX3NkaG9z
dCA9IFNEX0JVUyhvYmopOwpkaWZmIC0tZ2l0IGEvaHcvaTM4Ni9rdm0vYXBpYy5jIGIvaHcvaTM4
Ni9rdm0vYXBpYy5jCmluZGV4IDkxZmI2MjJkNjMuLmQxMjViMzcwZjQgMTAwNjQ0Ci0tLSBhL2h3
L2kzODYva3ZtL2FwaWMuYworKysgYi9ody9pMzg2L2t2bS9hcGljLmMKQEAgLTIzMiw2ICsyMzIs
NyBAQCBzdGF0aWMgdm9pZCBrdm1fYXBpY19yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9y
ICoqZXJycCkKIAogc3RhdGljIHZvaWQga3ZtX2FwaWNfdW5yZWFsaXplKERldmljZVN0YXRlICpk
ZXYsIEVycm9yICoqZXJycCkKIHsKKwlFUlJQX0ZVTkNUSU9OX0JFR0lOKCk7CiB9CiAKIHN0YXRp
YyB2b2lkIGt2bV9hcGljX2NsYXNzX2luaXQoT2JqZWN0Q2xhc3MgKmtsYXNzLCB2b2lkICpkYXRh
KQpkaWZmIC0tZ2l0IGEvaHcvaTM4Ni9wYy5jIGIvaHcvaTM4Ni9wYy5jCmluZGV4IGJjZGE1MGVm
Y2MuLjg4MzQ2NzEzNmEgMTAwNjQ0Ci0tLSBhL2h3L2kzODYvcGMuYworKysgYi9ody9pMzg2L3Bj
LmMKQEAgLTEzNzcsNyArMTM3Nyw2IEBAIHZvaWQgcGNfYWNwaV9zbWlfaW50ZXJydXB0KHZvaWQg
Km9wYXF1ZSwgaW50IGlycSwgaW50IGxldmVsKQogc3RhdGljIHZvaWQgcGNfbmV3X2NwdShQQ01h
Y2hpbmVTdGF0ZSAqcGNtcywgaW50NjRfdCBhcGljX2lkLCBFcnJvciAqKmVycnApCiB7CiAgICAg
T2JqZWN0ICpjcHUgPSBOVUxMOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIENQ
VVg4NlN0YXRlICplbnYgPSBOVUxMOwogCiAgICAgY3B1ID0gb2JqZWN0X25ldyhNQUNISU5FKHBj
bXMpLT5jcHVfdHlwZSk7CkBAIC0xMzg1LDExICsxMzg0LDEwIEBAIHN0YXRpYyB2b2lkIHBjX25l
d19jcHUoUENNYWNoaW5lU3RhdGUgKnBjbXMsIGludDY0X3QgYXBpY19pZCwgRXJyb3IgKiplcnJw
KQogICAgIGVudiA9ICZYODZfQ1BVKGNwdSktPmVudjsKICAgICBlbnYtPm5yX2RpZXMgPSBwY21z
LT5zbXBfZGllczsKIAotICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfdWludChjcHUsIGFwaWNfaWQs
ICJhcGljLWlkIiwgJmxvY2FsX2Vycik7Ci0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKGNw
dSwgdHJ1ZSwgInJlYWxpemVkIiwgJmxvY2FsX2Vycik7CisgICAgb2JqZWN0X3Byb3BlcnR5X3Nl
dF91aW50KGNwdSwgYXBpY19pZCwgImFwaWMtaWQiLCBlcnJwKTsKKyAgICBvYmplY3RfcHJvcGVy
dHlfc2V0X2Jvb2woY3B1LCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKIAogICAgIG9iamVjdF91
bnJlZihjcHUpOwotICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogfQogCiAv
KgpAQCAtMTQ3Niw3ICsxNDc0LDYgQEAgdm9pZCBwY19ob3RfYWRkX2NwdShNYWNoaW5lU3RhdGUg
Km1zLCBjb25zdCBpbnQ2NF90IGlkLCBFcnJvciAqKmVycnApCiB7CiAgICAgUENNYWNoaW5lU3Rh
dGUgKnBjbXMgPSBQQ19NQUNISU5FKG1zKTsKICAgICBpbnQ2NF90IGFwaWNfaWQgPSB4ODZfY3B1
X2FwaWNfaWRfZnJvbV9pbmRleChwY21zLCBpZCk7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5V
TEw7CiAKICAgICBpZiAoaWQgPCAwKSB7CiAgICAgICAgIGVycm9yX3NldGcoZXJycCwgIkludmFs
aWQgQ1BVIGlkOiAlIiBQUklpNjQsIGlkKTsKQEAgLTE0OTAsOSArMTQ4Nyw4IEBAIHZvaWQgcGNf
aG90X2FkZF9jcHUoTWFjaGluZVN0YXRlICptcywgY29uc3QgaW50NjRfdCBpZCwgRXJyb3IgKipl
cnJwKQogICAgICAgICByZXR1cm47CiAgICAgfQogCi0gICAgcGNfbmV3X2NwdShQQ19NQUNISU5F
KG1zKSwgYXBpY19pZCwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAg
ICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBwY19uZXdfY3B1KFBDX01B
Q0hJTkUobXMpLCBhcGljX2lkLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0
dXJuOwogICAgIH0KIH0KQEAgLTE5OTUsNyArMTk5MSw2IEBAIHN0YXRpYyB2b2lkIHBjX21lbW9y
eV9wcmVfcGx1ZyhIb3RwbHVnSGFuZGxlciAqaG90cGx1Z19kZXYsIERldmljZVN0YXRlICpkZXYs
CiAgICAgY29uc3QgTWFjaGluZVN0YXRlICptcyA9IE1BQ0hJTkUoaG90cGx1Z19kZXYpOwogICAg
IGNvbnN0IGJvb2wgaXNfbnZkaW1tID0gb2JqZWN0X2R5bmFtaWNfY2FzdChPQkpFQ1QoZGV2KSwg
VFlQRV9OVkRJTU0pOwogICAgIGNvbnN0IHVpbnQ2NF90IGxlZ2FjeV9hbGlnbiA9IFRBUkdFVF9Q
QUdFX1NJWkU7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICAvKgogICAgICAq
IFdoZW4gLW5vLWFjcGkgaXMgdXNlZCB3aXRoIFEzNSBtYWNoaW5lIHR5cGUsIG5vIEFDUEkgaXMg
YnVpbHQsCkBAIC0yMDEzLDkgKzIwMDgsOCBAQCBzdGF0aWMgdm9pZCBwY19tZW1vcnlfcHJlX3Bs
dWcoSG90cGx1Z0hhbmRsZXIgKmhvdHBsdWdfZGV2LCBEZXZpY2VTdGF0ZSAqZGV2LAogICAgICAg
ICByZXR1cm47CiAgICAgfQogCi0gICAgaG90cGx1Z19oYW5kbGVyX3ByZV9wbHVnKHBjbXMtPmFj
cGlfZGV2LCBkZXYsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAg
ZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgaG90cGx1Z19oYW5kbGVyX3By
ZV9wbHVnKHBjbXMtPmFjcGlfZGV2LCBkZXYsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAg
ICAgICByZXR1cm47CiAgICAgfQogCkBAIC0yMDI2LDE0ICsyMDIwLDEzIEBAIHN0YXRpYyB2b2lk
IHBjX21lbW9yeV9wcmVfcGx1ZyhIb3RwbHVnSGFuZGxlciAqaG90cGx1Z19kZXYsIERldmljZVN0
YXRlICpkZXYsCiBzdGF0aWMgdm9pZCBwY19tZW1vcnlfcGx1ZyhIb3RwbHVnSGFuZGxlciAqaG90
cGx1Z19kZXYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZXZpY2VTdGF0ZSAqZGV2LCBF
cnJvciAqKmVycnApCiB7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgUENNYWNo
aW5lU3RhdGUgKnBjbXMgPSBQQ19NQUNISU5FKGhvdHBsdWdfZGV2KTsKICAgICBNYWNoaW5lU3Rh
dGUgKm1zID0gTUFDSElORShob3RwbHVnX2Rldik7CiAgICAgYm9vbCBpc19udmRpbW0gPSBvYmpl
Y3RfZHluYW1pY19jYXN0KE9CSkVDVChkZXYpLCBUWVBFX05WRElNTSk7CiAKLSAgICBwY19kaW1t
X3BsdWcoUENfRElNTShkZXYpLCBNQUNISU5FKHBjbXMpLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAo
bG9jYWxfZXJyKSB7Ci0gICAgICAgIGdvdG8gb3V0OworICAgIHBjX2RpbW1fcGx1ZyhQQ19ESU1N
KGRldiksIE1BQ0hJTkUocGNtcyksIGVycnApOworICAgIGlmICgqZXJycCkgeworICAgICAgICBy
ZXR1cm47CiAgICAgfQogCiAgICAgaWYgKGlzX252ZGltbSkgewpAQCAtMjA0MSwxNCArMjAzNCwx
MSBAQCBzdGF0aWMgdm9pZCBwY19tZW1vcnlfcGx1ZyhIb3RwbHVnSGFuZGxlciAqaG90cGx1Z19k
ZXYsCiAgICAgfQogCiAgICAgaG90cGx1Z19oYW5kbGVyX3BsdWcoSE9UUExVR19IQU5ETEVSKHBj
bXMtPmFjcGlfZGV2KSwgZGV2LCAmZXJyb3JfYWJvcnQpOwotb3V0OgotICAgIGVycm9yX3Byb3Bh
Z2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogfQogCiBzdGF0aWMgdm9pZCBwY19tZW1vcnlfdW5wbHVn
X3JlcXVlc3QoSG90cGx1Z0hhbmRsZXIgKmhvdHBsdWdfZGV2LAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKIHsKLSAg
ICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBQQ01hY2hpbmVTdGF0ZSAqcGNtcyA9IFBD
X01BQ0hJTkUoaG90cGx1Z19kZXYpOwogCiAgICAgLyoKQEAgLTIwNTcsMzggKzIwNDcsMzMgQEAg
c3RhdGljIHZvaWQgcGNfbWVtb3J5X3VucGx1Z19yZXF1ZXN0KEhvdHBsdWdIYW5kbGVyICpob3Rw
bHVnX2RldiwKICAgICAgKiBhZGRpdGlvbiB0byBjb3ZlciB0aGlzIGNhc2UuCiAgICAgICovCiAg
ICAgaWYgKCFwY21zLT5hY3BpX2RldiB8fCAhYWNwaV9lbmFibGVkKSB7Ci0gICAgICAgIGVycm9y
X3NldGcoJmxvY2FsX2VyciwKKyAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLAogICAgICAgICAgICAg
ICAgICAgICJtZW1vcnkgaG90cGx1ZyBpcyBub3QgZW5hYmxlZDogbWlzc2luZyBhY3BpIGRldmlj
ZSBvciBhY3BpIGRpc2FibGVkIik7Ci0gICAgICAgIGdvdG8gb3V0OworICAgICAgICByZXR1cm47
CiAgICAgfQogCiAgICAgaWYgKG9iamVjdF9keW5hbWljX2Nhc3QoT0JKRUNUKGRldiksIFRZUEVf
TlZESU1NKSkgewotICAgICAgICBlcnJvcl9zZXRnKCZsb2NhbF9lcnIsCisgICAgICAgIGVycm9y
X3NldGcoZXJycCwKICAgICAgICAgICAgICAgICAgICAibnZkaW1tIGRldmljZSBob3QgdW5wbHVn
IGlzIG5vdCBzdXBwb3J0ZWQgeWV0LiIpOwotICAgICAgICBnb3RvIG91dDsKKyAgICAgICAgcmV0
dXJuOwogICAgIH0KIAogICAgIGhvdHBsdWdfaGFuZGxlcl91bnBsdWdfcmVxdWVzdChIT1RQTFVH
X0hBTkRMRVIocGNtcy0+YWNwaV9kZXYpLCBkZXYsCi0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICZsb2NhbF9lcnIpOwotb3V0OgotICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBs
b2NhbF9lcnIpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJwKTsKIH0K
IAogc3RhdGljIHZvaWQgcGNfbWVtb3J5X3VucGx1ZyhIb3RwbHVnSGFuZGxlciAqaG90cGx1Z19k
ZXYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERldmljZVN0YXRlICpkZXYsIEVycm9y
ICoqZXJycCkKIHsKICAgICBQQ01hY2hpbmVTdGF0ZSAqcGNtcyA9IFBDX01BQ0hJTkUoaG90cGx1
Z19kZXYpOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCi0gICAgaG90cGx1Z19oYW5k
bGVyX3VucGx1ZyhIT1RQTFVHX0hBTkRMRVIocGNtcy0+YWNwaV9kZXYpLCBkZXYsICZsb2NhbF9l
cnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZ290byBvdXQ7CisgICAgaG90cGx1
Z19oYW5kbGVyX3VucGx1ZyhIT1RQTFVHX0hBTkRMRVIocGNtcy0+YWNwaV9kZXYpLCBkZXYsIGVy
cnApOworICAgIGlmICgqZXJycCkgeworICAgICAgICByZXR1cm47CiAgICAgfQogCiAgICAgcGNf
ZGltbV91bnBsdWcoUENfRElNTShkZXYpLCBNQUNISU5FKHBjbXMpKTsKICAgICBvYmplY3RfcHJv
cGVydHlfc2V0X2Jvb2woT0JKRUNUKGRldiksIGZhbHNlLCAicmVhbGl6ZWQiLCBOVUxMKTsKLSBv
dXQ6Ci0gICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CiB9CiAKIHN0YXRpYyBp
bnQgcGNfYXBpY19jbXAoY29uc3Qgdm9pZCAqYSwgY29uc3Qgdm9pZCAqYikKQEAgLTIxMjEsMTQg
KzIxMDYsMTMgQEAgc3RhdGljIHZvaWQgcGNfY3B1X3BsdWcoSG90cGx1Z0hhbmRsZXIgKmhvdHBs
dWdfZGV2LAogICAgICAgICAgICAgICAgICAgICAgICAgRGV2aWNlU3RhdGUgKmRldiwgRXJyb3Ig
KiplcnJwKQogewogICAgIENQVUFyY2hJZCAqZm91bmRfY3B1OwotICAgIEVycm9yICpsb2NhbF9l
cnIgPSBOVUxMOwogICAgIFg4NkNQVSAqY3B1ID0gWDg2X0NQVShkZXYpOwogICAgIFBDTWFjaGlu
ZVN0YXRlICpwY21zID0gUENfTUFDSElORShob3RwbHVnX2Rldik7CiAKICAgICBpZiAocGNtcy0+
YWNwaV9kZXYpIHsKLSAgICAgICAgaG90cGx1Z19oYW5kbGVyX3BsdWcoSE9UUExVR19IQU5ETEVS
KHBjbXMtPmFjcGlfZGV2KSwgZGV2LCAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYgKGxvY2FsX2Vy
cikgewotICAgICAgICAgICAgZ290byBvdXQ7CisgICAgICAgIGhvdHBsdWdfaGFuZGxlcl9wbHVn
KEhPVFBMVUdfSEFORExFUihwY21zLT5hY3BpX2RldiksIGRldiwgZXJycCk7CisgICAgICAgIGlm
ICgqZXJycCkgeworICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgfQogCkBAIC0y
MTQzLDUxICsyMTI3LDQ0IEBAIHN0YXRpYyB2b2lkIHBjX2NwdV9wbHVnKEhvdHBsdWdIYW5kbGVy
ICpob3RwbHVnX2RldiwKIAogICAgIGZvdW5kX2NwdSA9IHBjX2ZpbmRfY3B1X3Nsb3QoTUFDSElO
RShwY21zKSwgY3B1LT5hcGljX2lkLCBOVUxMKTsKICAgICBmb3VuZF9jcHUtPmNwdSA9IE9CSkVD
VChkZXYpOwotb3V0OgotICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogfQog
c3RhdGljIHZvaWQgcGNfY3B1X3VucGx1Z19yZXF1ZXN0X2NiKEhvdHBsdWdIYW5kbGVyICpob3Rw
bHVnX2RldiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZXZpY2VTdGF0
ZSAqZGV2LCBFcnJvciAqKmVycnApCiB7CiAgICAgaW50IGlkeCA9IC0xOwotICAgIEVycm9yICps
b2NhbF9lcnIgPSBOVUxMOwogICAgIFg4NkNQVSAqY3B1ID0gWDg2X0NQVShkZXYpOwogICAgIFBD
TWFjaGluZVN0YXRlICpwY21zID0gUENfTUFDSElORShob3RwbHVnX2Rldik7CiAKICAgICBpZiAo
IXBjbXMtPmFjcGlfZGV2KSB7Ci0gICAgICAgIGVycm9yX3NldGcoJmxvY2FsX2VyciwgIkNQVSBo
b3QgdW5wbHVnIG5vdCBzdXBwb3J0ZWQgd2l0aG91dCBBQ1BJIik7Ci0gICAgICAgIGdvdG8gb3V0
OworICAgICAgICBlcnJvcl9zZXRnKGVycnAsICJDUFUgaG90IHVucGx1ZyBub3Qgc3VwcG9ydGVk
IHdpdGhvdXQgQUNQSSIpOworICAgICAgICByZXR1cm47CiAgICAgfQogCiAgICAgcGNfZmluZF9j
cHVfc2xvdChNQUNISU5FKHBjbXMpLCBjcHUtPmFwaWNfaWQsICZpZHgpOwogICAgIGFzc2VydChp
ZHggIT0gLTEpOwogICAgIGlmIChpZHggPT0gMCkgewotICAgICAgICBlcnJvcl9zZXRnKCZsb2Nh
bF9lcnIsICJCb290IENQVSBpcyB1bnBsdWdnYWJsZSIpOwotICAgICAgICBnb3RvIG91dDsKKyAg
ICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAiQm9vdCBDUFUgaXMgdW5wbHVnZ2FibGUiKTsKKyAgICAg
ICAgcmV0dXJuOwogICAgIH0KIAogICAgIGhvdHBsdWdfaGFuZGxlcl91bnBsdWdfcmVxdWVzdChI
T1RQTFVHX0hBTkRMRVIocGNtcy0+YWNwaV9kZXYpLCBkZXYsCi0gICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAg
ICAgZ290byBvdXQ7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycnApOwor
ICAgIGlmICgqZXJycCkgeworICAgICAgICByZXR1cm47CiAgICAgfQogCi0gb3V0OgotICAgIGVy
cm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwotCiB9CiAKIHN0YXRpYyB2b2lkIHBjX2Nw
dV91bnBsdWdfY2IoSG90cGx1Z0hhbmRsZXIgKmhvdHBsdWdfZGV2LAogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiB7CiAgICAgQ1BV
QXJjaElkICpmb3VuZF9jcHU7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgWDg2
Q1BVICpjcHUgPSBYODZfQ1BVKGRldik7CiAgICAgUENNYWNoaW5lU3RhdGUgKnBjbXMgPSBQQ19N
QUNISU5FKGhvdHBsdWdfZGV2KTsKIAotICAgIGhvdHBsdWdfaGFuZGxlcl91bnBsdWcoSE9UUExV
R19IQU5ETEVSKHBjbXMtPmFjcGlfZGV2KSwgZGV2LCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9j
YWxfZXJyKSB7Ci0gICAgICAgIGdvdG8gb3V0OworICAgIGhvdHBsdWdfaGFuZGxlcl91bnBsdWco
SE9UUExVR19IQU5ETEVSKHBjbXMtPmFjcGlfZGV2KSwgZGV2LCBlcnJwKTsKKyAgICBpZiAoKmVy
cnApIHsKKyAgICAgICAgcmV0dXJuOwogICAgIH0KIAogICAgIGZvdW5kX2NwdSA9IHBjX2ZpbmRf
Y3B1X3Nsb3QoTUFDSElORShwY21zKSwgY3B1LT5hcGljX2lkLCBOVUxMKTsKQEAgLTIxOTksOCAr
MjE3Niw2IEBAIHN0YXRpYyB2b2lkIHBjX2NwdV91bnBsdWdfY2IoSG90cGx1Z0hhbmRsZXIgKmhv
dHBsdWdfZGV2LAogICAgIC8qIFVwZGF0ZSB0aGUgbnVtYmVyIG9mIENQVXMgaW4gQ01PUyAqLwog
ICAgIHJ0Y19zZXRfY3B1c19jb3VudChwY21zLT5ydGMsIHBjbXMtPmJvb3RfY3B1cyk7CiAgICAg
ZndfY2ZnX21vZGlmeV9pMTYocGNtcy0+ZndfY2ZnLCBGV19DRkdfTkJfQ1BVUywgcGNtcy0+Ym9v
dF9jcHVzKTsKLSBvdXQ6Ci0gICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CiB9
CiAKIHN0YXRpYyB2b2lkIHBjX2NwdV9wcmVfcGx1ZyhIb3RwbHVnSGFuZGxlciAqaG90cGx1Z19k
ZXYsCkBAIC0yMzU0LDcgKzIzMjksNiBAQCBzdGF0aWMgdm9pZCBwY192aXJ0aW9fcG1lbV9wY2lf
cHJlX3BsdWcoSG90cGx1Z0hhbmRsZXIgKmhvdHBsdWdfZGV2LAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKIHsK
ICAgICBIb3RwbHVnSGFuZGxlciAqaG90cGx1Z19kZXYyID0gcWRldl9nZXRfYnVzX2hvdHBsdWdf
aGFuZGxlcihkZXYpOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgaWYgKCFo
b3RwbHVnX2RldjIpIHsKICAgICAgICAgLyoKQEAgLTIzNzAsMTggKzIzNDQsMTYgQEAgc3RhdGlj
IHZvaWQgcGNfdmlydGlvX3BtZW1fcGNpX3ByZV9wbHVnKEhvdHBsdWdIYW5kbGVyICpob3RwbHVn
X2RldiwKICAgICAgKiBzdWNjZWVkcywgYnJhbmNoIG9mIHRvIHRoZSBhY3R1YWwgaG90cGx1ZyBo
YW5kbGVyLgogICAgICAqLwogICAgIG1lbW9yeV9kZXZpY2VfcHJlX3BsdWcoTUVNT1JZX0RFVklD
RShkZXYpLCBNQUNISU5FKGhvdHBsdWdfZGV2KSwgTlVMTCwKLSAgICAgICAgICAgICAgICAgICAg
ICAgICAgICZsb2NhbF9lcnIpOwotICAgIGlmICghbG9jYWxfZXJyKSB7Ci0gICAgICAgIGhvdHBs
dWdfaGFuZGxlcl9wcmVfcGx1Zyhob3RwbHVnX2RldjIsIGRldiwgJmxvY2FsX2Vycik7CisgICAg
ICAgICAgICAgICAgICAgICAgICAgICBlcnJwKTsKKyAgICBpZiAoISplcnJwKSB7CisgICAgICAg
IGhvdHBsdWdfaGFuZGxlcl9wcmVfcGx1Zyhob3RwbHVnX2RldjIsIGRldiwgZXJycCk7CiAgICAg
fQotICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogfQogCiBzdGF0aWMgdm9p
ZCBwY192aXJ0aW9fcG1lbV9wY2lfcGx1ZyhIb3RwbHVnSGFuZGxlciAqaG90cGx1Z19kZXYsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZXZpY2VTdGF0ZSAqZGV2LCBFcnJv
ciAqKmVycnApCiB7CiAgICAgSG90cGx1Z0hhbmRsZXIgKmhvdHBsdWdfZGV2MiA9IHFkZXZfZ2V0
X2J1c19ob3RwbHVnX2hhbmRsZXIoZGV2KTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsK
IAogICAgIC8qCiAgICAgICogUGx1ZyB0aGUgbWVtb3J5IGRldmljZSBmaXJzdCBhbmQgdGhlbiBi
cmFuY2ggb2ZmIHRvIHRoZSBhY3R1YWwKQEAgLTIzODksMTEgKzIzNjEsMTAgQEAgc3RhdGljIHZv
aWQgcGNfdmlydGlvX3BtZW1fcGNpX3BsdWcoSG90cGx1Z0hhbmRsZXIgKmhvdHBsdWdfZGV2LAog
ICAgICAqIGRldmljZSBiaXRzLgogICAgICAqLwogICAgIG1lbW9yeV9kZXZpY2VfcGx1ZyhNRU1P
UllfREVWSUNFKGRldiksIE1BQ0hJTkUoaG90cGx1Z19kZXYpKTsKLSAgICBob3RwbHVnX2hhbmRs
ZXJfcGx1Zyhob3RwbHVnX2RldjIsIGRldiwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2Vy
cikgeworICAgIGhvdHBsdWdfaGFuZGxlcl9wbHVnKGhvdHBsdWdfZGV2MiwgZGV2LCBlcnJwKTsK
KyAgICBpZiAoKmVycnApIHsKICAgICAgICAgbWVtb3J5X2RldmljZV91bnBsdWcoTUVNT1JZX0RF
VklDRShkZXYpLCBNQUNISU5FKGhvdHBsdWdfZGV2KSk7CiAgICAgfQotICAgIGVycm9yX3Byb3Bh
Z2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogfQogCiBzdGF0aWMgdm9pZCBwY192aXJ0aW9fcG1lbV9w
Y2lfdW5wbHVnX3JlcXVlc3QoSG90cGx1Z0hhbmRsZXIgKmhvdHBsdWdfZGV2LApAQCAtMjQwNiw2
ICsyMzc3LDcgQEAgc3RhdGljIHZvaWQgcGNfdmlydGlvX3BtZW1fcGNpX3VucGx1Z19yZXF1ZXN0
KEhvdHBsdWdIYW5kbGVyICpob3RwbHVnX2RldiwKIHN0YXRpYyB2b2lkIHBjX3ZpcnRpb19wbWVt
X3BjaV91bnBsdWcoSG90cGx1Z0hhbmRsZXIgKmhvdHBsdWdfZGV2LAogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiB7
CisJRVJSUF9GVU5DVElPTl9CRUdJTigpOwogICAgIC8qIFdlIGRvbid0IHN1cHBvcnQgdmlydGlv
IHBtZW0gaG90IHVucGx1ZyAqLwogfQogCkBAIC0yNTA1LDE5ICsyNDc3LDE2IEBAIHN0YXRpYyB2
b2lkIHBjX21hY2hpbmVfc2V0X21heF9yYW1fYmVsb3dfNGcoT2JqZWN0ICpvYmosIFZpc2l0b3Ig
KnYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVycm9yICoq
ZXJycCkKIHsKICAgICBQQ01hY2hpbmVTdGF0ZSAqcGNtcyA9IFBDX01BQ0hJTkUob2JqKTsKLSAg
ICBFcnJvciAqZXJyb3IgPSBOVUxMOwogICAgIHVpbnQ2NF90IHZhbHVlOwogCi0gICAgdmlzaXRf
dHlwZV9zaXplKHYsIG5hbWUsICZ2YWx1ZSwgJmVycm9yKTsKLSAgICBpZiAoZXJyb3IpIHsKLSAg
ICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycm9yKTsKKyAgICB2aXNpdF90eXBlX3NpemUo
diwgbmFtZSwgJnZhbHVlLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJu
OwogICAgIH0KICAgICBpZiAodmFsdWUgPiA0ICogR2lCKSB7Ci0gICAgICAgIGVycm9yX3NldGco
JmVycm9yLAorICAgICAgICBlcnJvcl9zZXRnKGVycnAsCiAgICAgICAgICAgICAgICAgICAgIk1h
Y2hpbmUgb3B0aW9uICdtYXgtcmFtLWJlbG93LTRnPSUiUFJJdTY0CiAgICAgICAgICAgICAgICAg
ICAgIicgZXhwZWN0cyBzaXplIGxlc3MgdGhhbiBvciBlcXVhbCB0byA0RyIsIHZhbHVlKTsKLSAg
ICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycm9yKTsKICAgICAgICAgcmV0dXJuOwogICAg
IH0KIApkaWZmIC0tZ2l0IGEvaHcvaWRlL3FkZXYuYyBiL2h3L2lkZS9xZGV2LmMKaW5kZXggNmZi
YTZiNjJiOC4uNThmYmI5MjYzYiAxMDA2NDQKLS0tIGEvaHcvaWRlL3FkZXYuYworKysgYi9ody9p
ZGUvcWRldi5jCkBAIC0yMzUsMTYgKzIzNSwxNSBAQCBzdGF0aWMgdm9pZCBpZGVfZGV2X3NldF9i
b290aW5kZXgoT2JqZWN0ICpvYmosIFZpc2l0b3IgKnYsIGNvbnN0IGNoYXIgKm5hbWUsCiB7CiAg
ICAgSURFRGV2aWNlICpkID0gSURFX0RFVklDRShvYmopOwogICAgIGludDMyX3QgYm9vdF9pbmRl
eDsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAotICAgIHZpc2l0X3R5cGVfaW50MzIo
diwgbmFtZSwgJmJvb3RfaW5kZXgsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsK
LSAgICAgICAgZ290byBvdXQ7CisgICAgdmlzaXRfdHlwZV9pbnQzMih2LCBuYW1lLCAmYm9vdF9p
bmRleCwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CisgICAgICAgIHJldHVybjsKICAgICB9CiAg
ICAgLyogY2hlY2sgd2hldGhlciBib290aW5kZXggaXMgcHJlc2VudCBpbiBmd19ib290X29yZGVy
IGxpc3QgICovCi0gICAgY2hlY2tfYm9vdF9pbmRleChib290X2luZGV4LCAmbG9jYWxfZXJyKTsK
LSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGdvdG8gb3V0OworICAgIGNoZWNrX2Jvb3Rf
aW5kZXgoYm9vdF9pbmRleCwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CisgICAgICAgIHJldHVy
bjsKICAgICB9CiAgICAgLyogY2hhbmdlIGJvb3RpbmRleCB0byBhIG5ldyBvbmUgKi8KICAgICBk
LT5jb25mLmJvb3RpbmRleCA9IGJvb3RfaW5kZXg7CkBAIC0yNTMsOCArMjUyLDYgQEAgc3RhdGlj
IHZvaWQgaWRlX2Rldl9zZXRfYm9vdGluZGV4KE9iamVjdCAqb2JqLCBWaXNpdG9yICp2LCBjb25z
dCBjaGFyICpuYW1lLAogICAgICAgICBhZGRfYm9vdF9kZXZpY2VfcGF0aChkLT5jb25mLmJvb3Rp
bmRleCwgJmQtPnFkZXYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQtPnVuaXQgPyAi
L2Rpc2tAMSIgOiAiL2Rpc2tAMCIpOwogICAgIH0KLW91dDoKLSAgICBlcnJvcl9wcm9wYWdhdGUo
ZXJycCwgbG9jYWxfZXJyKTsKIH0KIAogc3RhdGljIHZvaWQgaWRlX2Rldl9pbnN0YW5jZV9pbml0
KE9iamVjdCAqb2JqKQpkaWZmIC0tZ2l0IGEvaHcvaW5wdXQvdmlydGlvLWlucHV0LmMgYi9ody9p
bnB1dC92aXJ0aW8taW5wdXQuYwppbmRleCA1MTYxN2E1ODg1Li5mZjJjODQ5ZTY4IDEwMDY0NAot
LS0gYS9ody9pbnB1dC92aXJ0aW8taW5wdXQuYworKysgYi9ody9pbnB1dC92aXJ0aW8taW5wdXQu
YwpAQCAtMjM2LDEyICsyMzYsMTAgQEAgc3RhdGljIHZvaWQgdmlydGlvX2lucHV0X2RldmljZV9y
ZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAgICBWaXJ0SU9EZXZpY2Ug
KnZkZXYgPSBWSVJUSU9fREVWSUNFKGRldik7CiAgICAgVmlydElPSW5wdXQgKnZpbnB1dCA9IFZJ
UlRJT19JTlBVVChkZXYpOwogICAgIFZpcnRJT0lucHV0Q29uZmlnICpjZmc7Ci0gICAgRXJyb3Ig
KmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICBpZiAodmljLT5yZWFsaXplKSB7Ci0gICAgICAgIHZp
Yy0+cmVhbGl6ZShkZXYsICZsb2NhbF9lcnIpOwotICAgICAgICBpZiAobG9jYWxfZXJyKSB7Ci0g
ICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgdmlj
LT5yZWFsaXplKGRldiwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAg
cmV0dXJuOwogICAgICAgICB9CiAgICAgfQpAQCAtMjc5LDEyICsyNzcsMTAgQEAgc3RhdGljIHZv
aWQgdmlydGlvX2lucHV0X2RldmljZV91bnJlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3Ig
KiplcnJwKQogewogICAgIFZpcnRJT0lucHV0Q2xhc3MgKnZpYyA9IFZJUlRJT19JTlBVVF9HRVRf
Q0xBU1MoZGV2KTsKICAgICBWaXJ0SU9EZXZpY2UgKnZkZXYgPSBWSVJUSU9fREVWSUNFKGRldik7
Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICBpZiAodmljLT51bnJlYWxpemUp
IHsKLSAgICAgICAgdmljLT51bnJlYWxpemUoZGV2LCAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYg
KGxvY2FsX2VycikgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vy
cik7CisgICAgICAgIHZpYy0+dW5yZWFsaXplKGRldiwgZXJycCk7CisgICAgICAgIGlmICgqZXJy
cCkgewogICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgfQpkaWZmIC0tZ2l0IGEv
aHcvaW50Yy9hcGljX2NvbW1vbi5jIGIvaHcvaW50Yy9hcGljX2NvbW1vbi5jCmluZGV4IGFhZmQ4
ZTBlMzMuLjM4YzFiNWI1YzUgMTAwNjQ0Ci0tLSBhL2h3L2ludGMvYXBpY19jb21tb24uYworKysg
Yi9ody9pbnRjL2FwaWNfY29tbW9uLmMKQEAgLTQ2Niw3ICs0NjYsNiBAQCBzdGF0aWMgdm9pZCBh
cGljX2NvbW1vbl9zZXRfaWQoT2JqZWN0ICpvYmosIFZpc2l0b3IgKnYsIGNvbnN0IGNoYXIgKm5h
bWUsCiB7CiAgICAgQVBJQ0NvbW1vblN0YXRlICpzID0gQVBJQ19DT01NT04ob2JqKTsKICAgICBE
ZXZpY2VTdGF0ZSAqZGV2ID0gREVWSUNFKG9iaik7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5V
TEw7CiAgICAgdWludDMyX3QgdmFsdWU7CiAKICAgICBpZiAoZGV2LT5yZWFsaXplZCkgewpAQCAt
NDc0LDkgKzQ3Myw4IEBAIHN0YXRpYyB2b2lkIGFwaWNfY29tbW9uX3NldF9pZChPYmplY3QgKm9i
aiwgVmlzaXRvciAqdiwgY29uc3QgY2hhciAqbmFtZSwKICAgICAgICAgcmV0dXJuOwogICAgIH0K
IAotICAgIHZpc2l0X3R5cGVfdWludDMyKHYsIG5hbWUsICZ2YWx1ZSwgJmxvY2FsX2Vycik7Ci0g
ICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxf
ZXJyKTsKKyAgICB2aXNpdF90eXBlX3VpbnQzMih2LCBuYW1lLCAmdmFsdWUsIGVycnApOworICAg
IGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCmRpZmYgLS1naXQgYS9ody9p
bnRjL2FybV9naWMuYyBiL2h3L2ludGMvYXJtX2dpYy5jCmluZGV4IDFkN2RhN2JhYTIuLjhjMzQw
ZTJlMjggMTAwNjQ0Ci0tLSBhL2h3L2ludGMvYXJtX2dpYy5jCisrKyBiL2h3L2ludGMvYXJtX2dp
Yy5jCkBAIC0yMDQxLDExICsyMDQxLDkgQEAgc3RhdGljIHZvaWQgYXJtX2dpY19yZWFsaXplKERl
dmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAgICBHSUNTdGF0ZSAqcyA9IEFSTV9HSUMo
ZGV2KTsKICAgICBTeXNCdXNEZXZpY2UgKnNiZCA9IFNZU19CVVNfREVWSUNFKGRldik7CiAgICAg
QVJNR0lDQ2xhc3MgKmFnYyA9IEFSTV9HSUNfR0VUX0NMQVNTKHMpOwotICAgIEVycm9yICpsb2Nh
bF9lcnIgPSBOVUxMOwogCi0gICAgYWdjLT5wYXJlbnRfcmVhbGl6ZShkZXYsICZsb2NhbF9lcnIp
OwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxv
Y2FsX2Vycik7CisgICAgYWdjLT5wYXJlbnRfcmVhbGl6ZShkZXYsIGVycnApOworICAgIGlmICgq
ZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCmRpZmYgLS1naXQgYS9ody9pbnRjL2Fy
bV9naWNfa3ZtLmMgYi9ody9pbnRjL2FybV9naWNfa3ZtLmMKaW5kZXggYjU2ZmRhMTQ0Zi4uYmVi
OTQ3NmMxZSAxMDA2NDQKLS0tIGEvaHcvaW50Yy9hcm1fZ2ljX2t2bS5jCisrKyBiL2h3L2ludGMv
YXJtX2dpY19rdm0uYwpAQCAtNDk2LDEyICs0OTYsMTAgQEAgc3RhdGljIHZvaWQga3ZtX2FybV9n
aWNfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgaW50IGk7CiAg
ICAgR0lDU3RhdGUgKnMgPSBLVk1fQVJNX0dJQyhkZXYpOwogICAgIEtWTUFSTUdJQ0NsYXNzICpr
Z2MgPSBLVk1fQVJNX0dJQ19HRVRfQ0xBU1Mocyk7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5V
TEw7CiAgICAgaW50IHJldDsKIAotICAgIGtnYy0+cGFyZW50X3JlYWxpemUoZGV2LCAmbG9jYWxf
ZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJw
LCBsb2NhbF9lcnIpOworICAgIGtnYy0+cGFyZW50X3JlYWxpemUoZGV2LCBlcnJwKTsKKyAgICBp
ZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApAQCAtNTIwLDkgKzUxOCw4IEBA
IHN0YXRpYyB2b2lkIGt2bV9hcm1fZ2ljX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3Ig
KiplcnJwKQogICAgIGlmICgha3ZtX2FybV9naWNfY2FuX3NhdmVfcmVzdG9yZShzKSkgewogICAg
ICAgICBlcnJvcl9zZXRnKCZzLT5taWdyYXRpb25fYmxvY2tlciwgIlRoaXMgb3BlcmF0aW5nIHN5
c3RlbSBrZXJuZWwgZG9lcyAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAibm90IHN1cHBvcnQgdkdJQ3YyIG1pZ3JhdGlvbiIpOwotICAgICAgICBtaWdyYXRlX2Fk
ZF9ibG9ja2VyKHMtPm1pZ3JhdGlvbl9ibG9ja2VyLCAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYg
KGxvY2FsX2VycikgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vy
cik7CisgICAgICAgIG1pZ3JhdGVfYWRkX2Jsb2NrZXIocy0+bWlncmF0aW9uX2Jsb2NrZXIsIGVy
cnApOworICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIGVycm9yX2ZyZWUocy0+bWln
cmF0aW9uX2Jsb2NrZXIpOwogICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CmRpZmYgLS1n
aXQgYS9ody9pbnRjL2FybV9naWN2My5jIGIvaHcvaW50Yy9hcm1fZ2ljdjMuYwppbmRleCA2NmVh
YTk3MTk4Li4wMDc0NzMzZDI1IDEwMDY0NAotLS0gYS9ody9pbnRjL2FybV9naWN2My5jCisrKyBi
L2h3L2ludGMvYXJtX2dpY3YzLmMKQEAgLTM2NiwxMSArMzY2LDkgQEAgc3RhdGljIHZvaWQgYXJt
X2dpY19yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAgICAvKiBEZXZp
Y2UgaW5zdGFuY2UgcmVhbGl6ZSBmdW5jdGlvbiBmb3IgdGhlIEdJQyBzeXNidXMgZGV2aWNlICov
CiAgICAgR0lDdjNTdGF0ZSAqcyA9IEFSTV9HSUNWMyhkZXYpOwogICAgIEFSTUdJQ3YzQ2xhc3Mg
KmFnYyA9IEFSTV9HSUNWM19HRVRfQ0xBU1Mocyk7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5V
TEw7CiAKLSAgICBhZ2MtPnBhcmVudF9yZWFsaXplKGRldiwgJmxvY2FsX2Vycik7Ci0gICAgaWYg
KGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsK
KyAgICBhZ2MtPnBhcmVudF9yZWFsaXplKGRldiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAg
ICAgICAgIHJldHVybjsKICAgICB9CiAKQEAgLTM4MCw5ICszNzgsOCBAQCBzdGF0aWMgdm9pZCBh
cm1fZ2ljX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogICAgICAgICBy
ZXR1cm47CiAgICAgfQogCi0gICAgZ2ljdjNfaW5pdF9pcnFzX2FuZF9tbWlvKHMsIGdpY3YzX3Nl
dF9pcnEsIGdpY19vcHMsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAg
ICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgZ2ljdjNfaW5pdF9pcnFz
X2FuZF9tbWlvKHMsIGdpY3YzX3NldF9pcnEsIGdpY19vcHMsIGVycnApOworICAgIGlmICgqZXJy
cCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCmRpZmYgLS1naXQgYS9ody9pbnRjL2FybV9n
aWN2M19pdHNfa3ZtLmMgYi9ody9pbnRjL2FybV9naWN2M19pdHNfa3ZtLmMKaW5kZXggZDY2ZjI0
MzFlZS4uZTVjM2E4MzYxMyAxMDA2NDQKLS0tIGEvaHcvaW50Yy9hcm1fZ2ljdjNfaXRzX2t2bS5j
CisrKyBiL2h3L2ludGMvYXJtX2dpY3YzX2l0c19rdm0uYwpAQCAtOTEsNyArOTEsNiBAQCBzdGF0
aWMgdm9pZCB2bV9jaGFuZ2Vfc3RhdGVfaGFuZGxlcih2b2lkICpvcGFxdWUsIGludCBydW5uaW5n
LAogc3RhdGljIHZvaWQga3ZtX2FybV9pdHNfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJv
ciAqKmVycnApCiB7CiAgICAgR0lDdjNJVFNTdGF0ZSAqcyA9IEFSTV9HSUNWM19JVFNfQ09NTU9O
KGRldik7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICBzLT5kZXZfZmQgPSBr
dm1fY3JlYXRlX2RldmljZShrdm1fc3RhdGUsIEtWTV9ERVZfVFlQRV9BUk1fVkdJQ19JVFMsIGZh
bHNlKTsKICAgICBpZiAocy0+ZGV2X2ZkIDwgMCkgewpAQCAtMTEzLDkgKzExMiw4IEBAIHN0YXRp
YyB2b2lkIGt2bV9hcm1faXRzX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJw
KQogICAgICAgICBHSVRTX0NUTFIpKSB7CiAgICAgICAgIGVycm9yX3NldGcoJnMtPm1pZ3JhdGlv
bl9ibG9ja2VyLCAiVGhpcyBvcGVyYXRpbmcgc3lzdGVtIGtlcm5lbCAiCiAgICAgICAgICAgICAg
ICAgICAgImRvZXMgbm90IHN1cHBvcnQgdklUUyBtaWdyYXRpb24iKTsKLSAgICAgICAgbWlncmF0
ZV9hZGRfYmxvY2tlcihzLT5taWdyYXRpb25fYmxvY2tlciwgJmxvY2FsX2Vycik7Ci0gICAgICAg
IGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2Nh
bF9lcnIpOworICAgICAgICBtaWdyYXRlX2FkZF9ibG9ja2VyKHMtPm1pZ3JhdGlvbl9ibG9ja2Vy
LCBlcnJwKTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICBlcnJvcl9mcmVlKHMt
Pm1pZ3JhdGlvbl9ibG9ja2VyKTsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQpkaWZm
IC0tZ2l0IGEvaHcvaW50Yy9hcm1fZ2ljdjNfa3ZtLmMgYi9ody9pbnRjL2FybV9naWN2M19rdm0u
YwppbmRleCA5YzdmNGFiODcxLi5lMjUwNjdiNjU5IDEwMDY0NAotLS0gYS9ody9pbnRjL2FybV9n
aWN2M19rdm0uYworKysgYi9ody9pbnRjL2FybV9naWN2M19rdm0uYwpAQCAtNzY5LDE0ICs3Njks
MTIgQEAgc3RhdGljIHZvaWQga3ZtX2FybV9naWN2M19yZWFsaXplKERldmljZVN0YXRlICpkZXYs
IEVycm9yICoqZXJycCkKICAgICBHSUN2M1N0YXRlICpzID0gS1ZNX0FSTV9HSUNWMyhkZXYpOwog
ICAgIEtWTUFSTUdJQ3YzQ2xhc3MgKmtnYyA9IEtWTV9BUk1fR0lDVjNfR0VUX0NMQVNTKHMpOwog
ICAgIGJvb2wgbXVsdGlwbGVfcmVkaXN0X3JlZ2lvbl9hbGxvd2VkOwotICAgIEVycm9yICpsb2Nh
bF9lcnIgPSBOVUxMOwogICAgIGludCBpOwogCiAgICAgRFBSSU5URigia3ZtX2FybV9naWN2M19y
ZWFsaXplXG4iKTsKIAotICAgIGtnYy0+cGFyZW50X3JlYWxpemUoZGV2LCAmbG9jYWxfZXJyKTsK
LSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2Nh
bF9lcnIpOworICAgIGtnYy0+cGFyZW50X3JlYWxpemUoZGV2LCBlcnJwKTsKKyAgICBpZiAoKmVy
cnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApAQCAtNzg2LDkgKzc4NCw4IEBAIHN0YXRp
YyB2b2lkIGt2bV9hcm1fZ2ljdjNfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVy
cnApCiAgICAgICAgIHJldHVybjsKICAgICB9CiAKLSAgICBnaWN2M19pbml0X2lycXNfYW5kX21t
aW8ocywga3ZtX2FybV9naWN2M19zZXRfaXJxLCBOVUxMLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAo
bG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwor
ICAgIGdpY3YzX2luaXRfaXJxc19hbmRfbW1pbyhzLCBrdm1fYXJtX2dpY3YzX3NldF9pcnEsIE5V
TEwsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCkBA
IC04NjMsOSArODYwLDggQEAgc3RhdGljIHZvaWQga3ZtX2FybV9naWN2M19yZWFsaXplKERldmlj
ZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBHSUNEX0NUTFIpKSB7CiAgICAgICAgIGVycm9yX3NldGcoJnMtPm1pZ3JhdGlvbl9ibG9ja2Vy
LCAiVGhpcyBvcGVyYXRpbmcgc3lzdGVtIGtlcm5lbCBkb2VzICIKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICJub3Qgc3VwcG9ydCB2R0lDdjMgbWlncmF0aW9uIik7
Ci0gICAgICAgIG1pZ3JhdGVfYWRkX2Jsb2NrZXIocy0+bWlncmF0aW9uX2Jsb2NrZXIsICZsb2Nh
bF9lcnIpOwotICAgICAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9w
YWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgbWlncmF0ZV9hZGRfYmxvY2tlcihzLT5t
aWdyYXRpb25fYmxvY2tlciwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAg
ICAgZXJyb3JfZnJlZShzLT5taWdyYXRpb25fYmxvY2tlcik7CiAgICAgICAgICAgICByZXR1cm47
CiAgICAgICAgIH0KZGlmZiAtLWdpdCBhL2h3L2ludGMvYXJtdjdtX252aWMuYyBiL2h3L2ludGMv
YXJtdjdtX252aWMuYwppbmRleCA4ZTkzZTUxZTgxLi4yZjg0MTg1ZThiIDEwMDY0NAotLS0gYS9o
dy9pbnRjL2FybXY3bV9udmljLmMKKysrIGIvaHcvaW50Yy9hcm12N21fbnZpYy5jCkBAIC0yNjA5
LDcgKzI2MDksNiBAQCBzdGF0aWMgdm9pZCBudmljX3N5c3RpY2tfdHJpZ2dlcih2b2lkICpvcGFx
dWUsIGludCBuLCBpbnQgbGV2ZWwpCiBzdGF0aWMgdm9pZCBhcm12N21fbnZpY19yZWFsaXplKERl
dmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKIHsKICAgICBOVklDU3RhdGUgKnMgPSBOVklD
KGRldik7Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7CiAgICAgaW50IHJlZ2lvbmxlbjsKIAogICAg
IC8qIFRoZSBhcm12N20gY29udGFpbmVyIG9iamVjdCB3aWxsIGhhdmUgc2V0IG91ciBDUFUgcG9p
bnRlciAqLwpAQCAtMjYzMSw5ICsyNjMwLDggQEAgc3RhdGljIHZvaWQgYXJtdjdtX252aWNfcmVh
bGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgcy0+bnVtX3ByaW9fYml0
cyA9IGFybV9mZWF0dXJlKCZzLT5jcHUtPmVudiwgQVJNX0ZFQVRVUkVfVjcpID8gOCA6IDI7CiAK
ICAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5zeXN0aWNrW01fUkVHX05T
XSksIHRydWUsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICJyZWFsaXplZCIsICZlcnIp
OwotICAgIGlmIChlcnIgIT0gTlVMTCkgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwg
ZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInJlYWxpemVkIiwgZXJycCk7Cisg
ICAgaWYgKCplcnJwICE9IE5VTEwpIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KICAgICBzeXNi
dXNfY29ubmVjdF9pcnEoU1lTX0JVU19ERVZJQ0UoJnMtPnN5c3RpY2tbTV9SRUdfTlNdKSwgMCwK
QEAgLTI2NTAsOSArMjY0OCw4IEBAIHN0YXRpYyB2b2lkIGFybXY3bV9udmljX3JlYWxpemUoRGV2
aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgc2l6ZW9mKHMtPnN5c3RpY2tbTV9SRUdfU10pLCBUWVBFX1NZU1RJQ0spOwogCiAgICAgICAg
IG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPnN5c3RpY2tbTV9SRUdfU10pLCB0
cnVlLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInJlYWxpemVkIiwgJmVycik7
Ci0gICAgICAgIGlmIChlcnIgIT0gTlVMTCkgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRl
KGVycnAsIGVycik7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicmVhbGl6ZWQi
LCBlcnJwKTsKKyAgICAgICAgaWYgKCplcnJwICE9IE5VTEwpIHsKICAgICAgICAgICAgIHJldHVy
bjsKICAgICAgICAgfQogICAgICAgICBzeXNidXNfY29ubmVjdF9pcnEoU1lTX0JVU19ERVZJQ0Uo
JnMtPnN5c3RpY2tbTV9SRUdfU10pLCAwLApkaWZmIC0tZ2l0IGEvaHcvaW50Yy9uaW9zMl9paWMu
YyBiL2h3L2ludGMvbmlvczJfaWljLmMKaW5kZXggM2E1ZDg2YzJhNC4uYzI0NjUxY2FmZCAxMDA2
NDQKLS0tIGEvaHcvaW50Yy9uaW9zMl9paWMuYworKysgYi9ody9pbnRjL25pb3MyX2lpYy5jCkBA
IC02NiwxMiArNjYsMTEgQEAgc3RhdGljIHZvaWQgYWx0ZXJhX2lpY19pbml0KE9iamVjdCAqb2Jq
KQogc3RhdGljIHZvaWQgYWx0ZXJhX2lpY19yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9y
ICoqZXJycCkKIHsKICAgICBzdHJ1Y3QgQWx0ZXJhSUlDICpwdiA9IEFMVEVSQV9JSUMoZGV2KTsK
LSAgICBFcnJvciAqZXJyID0gTlVMTDsKIAotICAgIHB2LT5jcHUgPSBvYmplY3RfcHJvcGVydHlf
Z2V0X2xpbmsoT0JKRUNUKGRldiksICJjcHUiLCAmZXJyKTsKKyAgICBwdi0+Y3B1ID0gb2JqZWN0
X3Byb3BlcnR5X2dldF9saW5rKE9CSkVDVChkZXYpLCAiY3B1IiwgZXJycCk7CiAgICAgaWYgKCFw
di0+Y3B1KSB7CiAgICAgICAgIGVycm9yX3NldGcoZXJycCwgImFsdGVyYSxpaWM6IENQVSBsaW5r
IG5vdCBmb3VuZDogJXMiLAotICAgICAgICAgICAgICAgICAgIGVycm9yX2dldF9wcmV0dHkoZXJy
KSk7CisgICAgICAgICAgICAgICAgICAgZXJyb3JfZ2V0X3ByZXR0eSgqZXJycCkpOwogICAgICAg
ICByZXR1cm47CiAgICAgfQogfQpkaWZmIC0tZ2l0IGEvaHcvaW50Yy9wbnZfeGl2ZS5jIGIvaHcv
aW50Yy9wbnZfeGl2ZS5jCmluZGV4IGVkNmU5ZDcxYmIuLjU3ODU1ZTBkYTMgMTAwNjQ0Ci0tLSBh
L2h3L2ludGMvcG52X3hpdmUuYworKysgYi9ody9pbnRjL3Budl94aXZlLmMKQEAgLTE2NjIsMTIg
KzE2NjIsMTAgQEAgc3RhdGljIHZvaWQgcG52X3hpdmVfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2
LCBFcnJvciAqKmVycnApCiAgICAgUG52WGl2ZSAqeGl2ZSA9IFBOVl9YSVZFKGRldik7CiAgICAg
WGl2ZVNvdXJjZSAqeHNyYyA9ICZ4aXZlLT5pcGlfc291cmNlOwogICAgIFhpdmVFTkRTb3VyY2Ug
KmVuZF94c3JjID0gJnhpdmUtPmVuZF9zb3VyY2U7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5V
TEw7CiAgICAgT2JqZWN0ICpvYmo7CiAKLSAgICBvYmogPSBvYmplY3RfcHJvcGVydHlfZ2V0X2xp
bmsoT0JKRUNUKGRldiksICJjaGlwIiwgJmxvY2FsX2Vycik7CisgICAgb2JqID0gb2JqZWN0X3By
b3BlcnR5X2dldF9saW5rKE9CSkVDVChkZXYpLCAiY2hpcCIsIGVycnApOwogICAgIGlmICghb2Jq
KSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogICAgICAgICBl
cnJvcl9wcmVwZW5kKGVycnAsICJyZXF1aXJlZCBsaW5rICdjaGlwJyBub3QgZm91bmQ6ICIpOwog
ICAgICAgICByZXR1cm47CiAgICAgfQpAQCAtMTY4NSw5ICsxNjgzLDggQEAgc3RhdGljIHZvaWQg
cG52X3hpdmVfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgJmVycm9yX2ZhdGFsKTsKICAgICBvYmplY3RfcHJvcGVydHlf
YWRkX2NvbnN0X2xpbmsoT0JKRUNUKHhzcmMpLCAieGl2ZSIsIE9CSkVDVCh4aXZlKSwKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJmVycm9yX2ZhdGFsKTsKLSAgICBvYmplY3Rf
cHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKHhzcmMpLCB0cnVlLCAicmVhbGl6ZWQiLCAmbG9jYWxf
ZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJw
LCBsb2NhbF9lcnIpOworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoeHNyYyks
IHRydWUsICJyZWFsaXplZCIsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1
cm47CiAgICAgfQogCkBAIC0xNjk1LDkgKzE2OTIsOCBAQCBzdGF0aWMgdm9pZCBwbnZfeGl2ZV9y
ZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAmZXJyb3JfZmF0YWwpOwogICAgIG9iamVjdF9wcm9wZXJ0eV9hZGRfY29uc3Rf
bGluayhPQkpFQ1QoZW5kX3hzcmMpLCAieGl2ZSIsIE9CSkVDVCh4aXZlKSwKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgJmVycm9yX2ZhdGFsKTsKLSAgICBvYmplY3RfcHJvcGVy
dHlfc2V0X2Jvb2woT0JKRUNUKGVuZF94c3JjKSwgdHJ1ZSwgInJlYWxpemVkIiwgJmxvY2FsX2Vy
cik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwg
bG9jYWxfZXJyKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKGVuZF94c3Jj
KSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJl
dHVybjsKICAgICB9CiAKZGlmZiAtLWdpdCBhL2h3L2ludGMvcmVhbHZpZXdfZ2ljLmMgYi9ody9p
bnRjL3JlYWx2aWV3X2dpYy5jCmluZGV4IDczZmU4Y2Q4MTUuLjU1YWM5MTAwYjAgMTAwNjQ0Ci0t
LSBhL2h3L2ludGMvcmVhbHZpZXdfZ2ljLmMKKysrIGIvaHcvaW50Yy9yZWFsdmlld19naWMuYwpA
QCAtMjYsNyArMjYsNiBAQCBzdGF0aWMgdm9pZCByZWFsdmlld19naWNfcmVhbGl6ZShEZXZpY2VT
dGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgU3lzQnVzRGV2aWNlICpzYmQgPSBTWVNfQlVT
X0RFVklDRShkZXYpOwogICAgIFJlYWxWaWV3R0lDU3RhdGUgKnMgPSBSRUFMVklFV19HSUMoZGV2
KTsKICAgICBTeXNCdXNEZXZpY2UgKmJ1c2RldjsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKICAg
ICAvKiBUaGUgR0lDcyBvbiB0aGUgUmVhbFZpZXcgYm9hcmRzIGhhdmUgYSBmaXhlZCBub25jb25m
aWd1cmFibGUKICAgICAgKiBudW1iZXIgb2YgaW50ZXJydXB0IGxpbmVzLCBzbyB3ZSBkb24ndCBu
ZWVkIHRvIGV4cG9zZSB0aGlzIGFzCiAgICAgICogYSBxZGV2IHByb3BlcnR5LgpAQCAtMzQsOSAr
MzMsOCBAQCBzdGF0aWMgdm9pZCByZWFsdmlld19naWNfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2
LCBFcnJvciAqKmVycnApCiAgICAgaW50IG51bWlycSA9IDk2OwogCiAgICAgcWRldl9wcm9wX3Nl
dF91aW50MzIoREVWSUNFKCZzLT5naWMpLCAibnVtLWlycSIsIG51bWlycSk7Ci0gICAgb2JqZWN0
X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+Z2ljKSwgdHJ1ZSwgInJlYWxpemVkIiwgJmVy
cik7Ci0gICAgaWYgKGVyciAhPSBOVUxMKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJw
LCBlcnIpOworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPmdpYyksIHRy
dWUsICJyZWFsaXplZCIsIGVycnApOworICAgIGlmICgqZXJycCAhPSBOVUxMKSB7CiAgICAgICAg
IHJldHVybjsKICAgICB9CiAgICAgYnVzZGV2ID0gU1lTX0JVU19ERVZJQ0UoJnMtPmdpYyk7CmRp
ZmYgLS1naXQgYS9ody9pbnRjL3MzOTBfZmxpY19rdm0uYyBiL2h3L2ludGMvczM5MF9mbGljX2t2
bS5jCmluZGV4IDgxOWFhNWUxOTguLjU3ZmI2Nzg4MjMgMTAwNjQ0Ci0tLSBhL2h3L2ludGMvczM5
MF9mbGljX2t2bS5jCisrKyBiL2h3L2ludGMvczM5MF9mbGljX2t2bS5jCkBAIC01ODIsMTUgKzU4
MiwxNCBAQCBzdGF0aWMgdm9pZCBrdm1fczM5MF9mbGljX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRl
diwgRXJyb3IgKiplcnJwKQogICAgIHN0cnVjdCBrdm1fY3JlYXRlX2RldmljZSBjZCA9IHswfTsK
ICAgICBzdHJ1Y3Qga3ZtX2RldmljZV9hdHRyIHRlc3RfYXR0ciA9IHswfTsKICAgICBpbnQgcmV0
OwotICAgIEVycm9yICplcnJwX2xvY2FsID0gTlVMTDsKIAotICAgIEtWTV9TMzkwX0ZMSUNfR0VU
X0NMQVNTKGRldiktPnBhcmVudF9yZWFsaXplKGRldiwgJmVycnBfbG9jYWwpOwotICAgIGlmIChl
cnJwX2xvY2FsKSB7CisgICAgS1ZNX1MzOTBfRkxJQ19HRVRfQ0xBU1MoZGV2KS0+cGFyZW50X3Jl
YWxpemUoZGV2LCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ290byBmYWlsOwog
ICAgIH0KICAgICBmbGljX3N0YXRlLT5mZCA9IC0xOwogICAgIGlmICgha3ZtX2NoZWNrX2V4dGVu
c2lvbihrdm1fc3RhdGUsIEtWTV9DQVBfREVWSUNFX0NUUkwpKSB7Ci0gICAgICAgIGVycm9yX3Nl
dGdfZXJybm8oJmVycnBfbG9jYWwsIGVycm5vLCAiS1ZNIGlzIG1pc3NpbmcgY2FwYWJpbGl0eSIK
KyAgICAgICAgZXJyb3Jfc2V0Z19lcnJubyhlcnJwLCBlcnJubywgIktWTSBpcyBtaXNzaW5nIGNh
cGFiaWxpdHkiCiAgICAgICAgICAgICAgICAgICAgICAgICAgIiBLVk1fQ0FQX0RFVklDRV9DVFJM
Iik7CiAgICAgICAgIHRyYWNlX2ZsaWNfbm9fZGV2aWNlX2FwaShlcnJubyk7CiAgICAgICAgIGdv
dG8gZmFpbDsKQEAgLTU5OSw3ICs1OTgsNyBAQCBzdGF0aWMgdm9pZCBrdm1fczM5MF9mbGljX3Jl
YWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogICAgIGNkLnR5cGUgPSBLVk1f
REVWX1RZUEVfRkxJQzsKICAgICByZXQgPSBrdm1fdm1faW9jdGwoa3ZtX3N0YXRlLCBLVk1fQ1JF
QVRFX0RFVklDRSwgJmNkKTsKICAgICBpZiAocmV0IDwgMCkgewotICAgICAgICBlcnJvcl9zZXRn
X2Vycm5vKCZlcnJwX2xvY2FsLCBlcnJubywgIkNyZWF0aW5nIHRoZSBLVk0gZGV2aWNlIGZhaWxl
ZCIpOworICAgICAgICBlcnJvcl9zZXRnX2Vycm5vKGVycnAsIGVycm5vLCAiQ3JlYXRpbmcgdGhl
IEtWTSBkZXZpY2UgZmFpbGVkIik7CiAgICAgICAgIHRyYWNlX2ZsaWNfY3JlYXRlX2RldmljZShl
cnJubyk7CiAgICAgICAgIGdvdG8gZmFpbDsKICAgICB9CkBAIC02MTEsNyArNjEwLDYgQEAgc3Rh
dGljIHZvaWQga3ZtX3MzOTBfZmxpY19yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoq
ZXJycCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgS1ZNX0hB
U19ERVZJQ0VfQVRUUiwgdGVzdF9hdHRyKTsKICAgICByZXR1cm47CiBmYWlsOgotICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBlcnJwX2xvY2FsKTsKIH0KIAogc3RhdGljIHZvaWQga3ZtX3MzOTBf
ZmxpY19yZXNldChEZXZpY2VTdGF0ZSAqZGV2KQpkaWZmIC0tZ2l0IGEvaHcvaW50Yy9zcGFwcl94
aXZlLmMgYi9ody9pbnRjL3NwYXByX3hpdmUuYwppbmRleCBjMWM5NzE5MmE3Li41MTU5ZjM1ZGY3
IDEwMDY0NAotLS0gYS9ody9pbnRjL3NwYXByX3hpdmUuYworKysgYi9ody9pbnRjL3NwYXByX3hp
dmUuYwpAQCAtMjc2LDcgKzI3Niw2IEBAIHN0YXRpYyB2b2lkIHNwYXByX3hpdmVfcmVhbGl6ZShE
ZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgU3BhcHJYaXZlICp4aXZlID0gU1BB
UFJfWElWRShkZXYpOwogICAgIFhpdmVTb3VyY2UgKnhzcmMgPSAmeGl2ZS0+c291cmNlOwogICAg
IFhpdmVFTkRTb3VyY2UgKmVuZF94c3JjID0gJnhpdmUtPmVuZF9zb3VyY2U7Ci0gICAgRXJyb3Ig
KmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICBpZiAoIXhpdmUtPm5yX2lycXMpIHsKICAgICAgICAg
ZXJyb3Jfc2V0ZyhlcnJwLCAiTnVtYmVyIG9mIGludGVycnVwdCBuZWVkcyB0byBiZSBncmVhdGVy
IDAiKTsKQEAgLTI5NSw5ICsyOTQsOCBAQCBzdGF0aWMgdm9pZCBzcGFwcl94aXZlX3JlYWxpemUo
RGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICZlcnJvcl9mYXRhbCk7CiAgICAgb2JqZWN0X3Byb3BlcnR5X2FkZF9jb25zdF9saW5rKE9C
SkVDVCh4c3JjKSwgInhpdmUiLCBPQkpFQ1QoeGl2ZSksCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICZlcnJvcl9mYXRhbCk7Ci0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29s
KE9CSkVDVCh4c3JjKSwgdHJ1ZSwgInJlYWxpemVkIiwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxv
Y2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAg
ICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKHhzcmMpLCB0cnVlLCAicmVhbGl6ZWQi
LCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KICAgICBz
eXNidXNfaW5pdF9tbWlvKFNZU19CVVNfREVWSUNFKHhpdmUpLCAmeHNyYy0+ZXNiX21taW8pOwpA
QCAtMzA5LDkgKzMwNyw4IEBAIHN0YXRpYyB2b2lkIHNwYXByX3hpdmVfcmVhbGl6ZShEZXZpY2VT
dGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJmVy
cm9yX2ZhdGFsKTsKICAgICBvYmplY3RfcHJvcGVydHlfYWRkX2NvbnN0X2xpbmsoT0JKRUNUKGVu
ZF94c3JjKSwgInhpdmUiLCBPQkpFQ1QoeGl2ZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICZlcnJvcl9mYXRhbCk7Ci0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9C
SkVDVChlbmRfeHNyYyksIHRydWUsICJyZWFsaXplZCIsICZsb2NhbF9lcnIpOwotICAgIGlmIChs
b2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7Cisg
ICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVChlbmRfeHNyYyksIHRydWUsICJyZWFs
aXplZCIsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQog
ICAgIHN5c2J1c19pbml0X21taW8oU1lTX0JVU19ERVZJQ0UoeGl2ZSksICZlbmRfeHNyYy0+ZXNi
X21taW8pOwpkaWZmIC0tZ2l0IGEvaHcvaW50Yy9zcGFwcl94aXZlX2t2bS5jIGIvaHcvaW50Yy9z
cGFwcl94aXZlX2t2bS5jCmluZGV4IDE3YWY0ZDE5ZjUuLjkyNWY1ZjdiMzcgMTAwNjQ0Ci0tLSBh
L2h3L2ludGMvc3BhcHJfeGl2ZV9rdm0uYworKysgYi9ody9pbnRjL3NwYXByX3hpdmVfa3ZtLmMK
QEAgLTE5Myw3ICsxOTMsNiBAQCB2b2lkIGt2bXBwY194aXZlX3NldF9zb3VyY2VfY29uZmlnKFNw
YXByWGl2ZSAqeGl2ZSwgdWludDMyX3QgbGlzbiwgWGl2ZUVBUyAqZWFzLAogICAgIGJvb2wgbWFz
a2VkOwogICAgIHVpbnQzMl90IGVpc247CiAgICAgdWludDY0X3Qga3ZtX3NyYzsKLSAgICBFcnJv
ciAqbG9jYWxfZXJyID0gTlVMTDsKIAogICAgIGFzc2VydCh4aXZlX2Vhc19pc192YWxpZChlYXMp
KTsKIApAQCAtMjE0LDkgKzIxMyw4IEBAIHZvaWQga3ZtcHBjX3hpdmVfc2V0X3NvdXJjZV9jb25m
aWcoU3BhcHJYaXZlICp4aXZlLCB1aW50MzJfdCBsaXNuLCBYaXZlRUFTICplYXMsCiAgICAgICAg
IEtWTV9YSVZFX1NPVVJDRV9FSVNOX01BU0s7CiAKICAgICBrdm1fZGV2aWNlX2FjY2Vzcyh4aXZl
LT5mZCwgS1ZNX0RFVl9YSVZFX0dSUF9TT1VSQ0VfQ09ORklHLCBsaXNuLAotICAgICAgICAgICAg
ICAgICAgICAgICZrdm1fc3JjLCB0cnVlLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJy
KSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICAg
ICAgICAgICAgICAgICZrdm1fc3JjLCB0cnVlLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAg
ICAgICAgcmV0dXJuOwogICAgIH0KIH0KQEAgLTI1OCwxMSArMjU2LDggQEAgc3RhdGljIHZvaWQg
a3ZtcHBjX3hpdmVfc291cmNlX3Jlc2V0KFhpdmVTb3VyY2UgKnhzcmMsIEVycm9yICoqZXJycCkK
ICAgICBpbnQgaTsKIAogICAgIGZvciAoaSA9IDA7IGkgPCB4c3JjLT5ucl9pcnFzOyBpKyspIHsK
LSAgICAgICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7Ci0KLSAgICAgICAga3ZtcHBjX3hpdmVf
c291cmNlX3Jlc2V0X29uZSh4c3JjLCBpLCAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYgKGxvY2Fs
X2VycikgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7Cisg
ICAgICAgIGt2bXBwY194aXZlX3NvdXJjZV9yZXNldF9vbmUoeHNyYywgaSwgZXJycCk7CisgICAg
ICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgfQpA
QCAtMzgxLDcgKzM3Niw2IEBAIHZvaWQga3ZtcHBjX3hpdmVfZ2V0X3F1ZXVlX2NvbmZpZyhTcGFw
clhpdmUgKnhpdmUsIHVpbnQ4X3QgZW5kX2JsaywKICAgICB1aW50NjRfdCBrdm1fZXFfaWR4Owog
ICAgIHVpbnQ4X3QgcHJpb3JpdHk7CiAgICAgdWludDMyX3Qgc2VydmVyOwotICAgIEVycm9yICps
b2NhbF9lcnIgPSBOVUxMOwogCiAgICAgYXNzZXJ0KHhpdmVfZW5kX2lzX3ZhbGlkKGVuZCkpOwog
CkBAIC0zOTQsOSArMzg4LDggQEAgdm9pZCBrdm1wcGNfeGl2ZV9nZXRfcXVldWVfY29uZmlnKFNw
YXByWGl2ZSAqeGl2ZSwgdWludDhfdCBlbmRfYmxrLAogICAgICAgICBLVk1fWElWRV9FUV9TRVJW
RVJfTUFTSzsKIAogICAgIGt2bV9kZXZpY2VfYWNjZXNzKHhpdmUtPmZkLCBLVk1fREVWX1hJVkVf
R1JQX0VRX0NPTkZJRywga3ZtX2VxX2lkeCwKLSAgICAgICAgICAgICAgICAgICAgICAma3ZtX2Vx
LCBmYWxzZSwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJv
cl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAma3Zt
X2VxLCBmYWxzZSwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAg
ICB9CiAKQEAgLTQxNyw3ICs0MTAsNiBAQCB2b2lkIGt2bXBwY194aXZlX3NldF9xdWV1ZV9jb25m
aWcoU3BhcHJYaXZlICp4aXZlLCB1aW50OF90IGVuZF9ibGssCiAgICAgdWludDY0X3Qga3ZtX2Vx
X2lkeDsKICAgICB1aW50OF90IHByaW9yaXR5OwogICAgIHVpbnQzMl90IHNlcnZlcjsKLSAgICBF
cnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAogICAgIC8qCiAgICAgICogQnVpbGQgdGhlIEtWTSBz
dGF0ZSBmcm9tIHRoZSBsb2NhbCBFTkQgc3RydWN0dXJlLgpAQCAtNDU2LDkgKzQ0OCw4IEBAIHZv
aWQga3ZtcHBjX3hpdmVfc2V0X3F1ZXVlX2NvbmZpZyhTcGFwclhpdmUgKnhpdmUsIHVpbnQ4X3Qg
ZW5kX2JsaywKICAgICAgICAgS1ZNX1hJVkVfRVFfU0VSVkVSX01BU0s7CiAKICAgICBrdm1fZGV2
aWNlX2FjY2Vzcyh4aXZlLT5mZCwgS1ZNX0RFVl9YSVZFX0dSUF9FUV9DT05GSUcsIGt2bV9lcV9p
ZHgsCi0gICAgICAgICAgICAgICAgICAgICAgJmt2bV9lcSwgdHJ1ZSwgJmxvY2FsX2Vycik7Ci0g
ICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxf
ZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAma3ZtX2VxLCB0cnVlLCBlcnJwKTsKKyAgICBp
ZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIH0KQEAgLTQ3MSw3ICs0NjIsNiBA
QCB2b2lkIGt2bXBwY194aXZlX3Jlc2V0KFNwYXByWGl2ZSAqeGl2ZSwgRXJyb3IgKiplcnJwKQog
CiBzdGF0aWMgdm9pZCBrdm1wcGNfeGl2ZV9nZXRfcXVldWVzKFNwYXByWGl2ZSAqeGl2ZSwgRXJy
b3IgKiplcnJwKQogewotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIGludCBpOwog
CiAgICAgZm9yIChpID0gMDsgaSA8IHhpdmUtPm5yX2VuZHM7IGkrKykgewpAQCAtNDgwLDkgKzQ3
MCw4IEBAIHN0YXRpYyB2b2lkIGt2bXBwY194aXZlX2dldF9xdWV1ZXMoU3BhcHJYaXZlICp4aXZl
LCBFcnJvciAqKmVycnApCiAgICAgICAgIH0KIAogICAgICAgICBrdm1wcGNfeGl2ZV9nZXRfcXVl
dWVfY29uZmlnKHhpdmUsIFNQQVBSX1hJVkVfQkxPQ0tfSUQsIGksCi0gICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgJnhpdmUtPmVuZHRbaV0sICZsb2NhbF9lcnIpOwotICAgICAg
ICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9j
YWxfZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmeGl2ZS0+ZW5k
dFtpXSwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgcmV0dXJuOwog
ICAgICAgICB9CiAgICAgfQpAQCAtNzA5LDcgKzY5OCw2IEBAIHN0YXRpYyB2b2lkICprdm1wcGNf
eGl2ZV9tbWFwKFNwYXByWGl2ZSAqeGl2ZSwgaW50IHBnb2ZmLCBzaXplX3QgbGVuLAogdm9pZCBr
dm1wcGNfeGl2ZV9jb25uZWN0KFNwYXByWGl2ZSAqeGl2ZSwgRXJyb3IgKiplcnJwKQogewogICAg
IFhpdmVTb3VyY2UgKnhzcmMgPSAmeGl2ZS0+c291cmNlOwotICAgIEVycm9yICpsb2NhbF9lcnIg
PSBOVUxMOwogICAgIHNpemVfdCBlc2JfbGVuID0gKDF1bGwgPDwgeHNyYy0+ZXNiX3NoaWZ0KSAq
IHhzcmMtPm5yX2lycXM7CiAgICAgc2l6ZV90IHRpbWFfbGVuID0gNHVsbCA8PCBUTV9TSElGVDsK
ICAgICBDUFVTdGF0ZSAqY3M7CkBAIC03MzgsOCArNzI2LDggQEAgdm9pZCBrdm1wcGNfeGl2ZV9j
b25uZWN0KFNwYXByWGl2ZSAqeGl2ZSwgRXJyb3IgKiplcnJwKQogICAgICAqIDEuIFNvdXJjZSBF
U0IgcGFnZXMgLSBLVk0gbWFwcGluZwogICAgICAqLwogICAgIHhzcmMtPmVzYl9tbWFwID0ga3Zt
cHBjX3hpdmVfbW1hcCh4aXZlLCBLVk1fWElWRV9FU0JfUEFHRV9PRkZTRVQsIGVzYl9sZW4sCi0g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZsb2NhbF9lcnIpOwotICAgIGlm
IChsb2NhbF9lcnIpIHsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJy
cCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8gZmFpbDsKICAgICB9CiAKQEAgLTc1
Niw4ICs3NDQsOCBAQCB2b2lkIGt2bXBwY194aXZlX2Nvbm5lY3QoU3BhcHJYaXZlICp4aXZlLCBF
cnJvciAqKmVycnApCiAgICAgICogMy4gVElNQSBwYWdlcyAtIEtWTSBtYXBwaW5nCiAgICAgICov
CiAgICAgeGl2ZS0+dG1fbW1hcCA9IGt2bXBwY194aXZlX21tYXAoeGl2ZSwgS1ZNX1hJVkVfVElN
QV9QQUdFX09GRlNFVCwgdGltYV9sZW4sCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgeworICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICBn
b3RvIGZhaWw7CiAgICAgfQogICAgIG1lbW9yeV9yZWdpb25faW5pdF9yYW1fZGV2aWNlX3B0cigm
eGl2ZS0+dG1fbW1pb19rdm0sIE9CSkVDVCh4aXZlKSwKQEAgLTc3MiwxNSArNzYwLDE1IEBAIHZv
aWQga3ZtcHBjX3hpdmVfY29ubmVjdChTcGFwclhpdmUgKnhpdmUsIEVycm9yICoqZXJycCkKICAg
ICBDUFVfRk9SRUFDSChjcykgewogICAgICAgICBQb3dlclBDQ1BVICpjcHUgPSBQT1dFUlBDX0NQ
VShjcyk7CiAKLSAgICAgICAga3ZtcHBjX3hpdmVfY3B1X2Nvbm5lY3Qoc3BhcHJfY3B1X3N0YXRl
KGNwdSktPnRjdHgsICZsb2NhbF9lcnIpOwotICAgICAgICBpZiAobG9jYWxfZXJyKSB7CisgICAg
ICAgIGt2bXBwY194aXZlX2NwdV9jb25uZWN0KHNwYXByX2NwdV9zdGF0ZShjcHUpLT50Y3R4LCBl
cnJwKTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICBnb3RvIGZhaWw7CiAgICAg
ICAgIH0KICAgICB9CiAKICAgICAvKiBVcGRhdGUgdGhlIEtWTSBzb3VyY2VzICovCi0gICAga3Zt
cHBjX3hpdmVfc291cmNlX3Jlc2V0KHhzcmMsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9l
cnIpIHsKKyAgICBrdm1wcGNfeGl2ZV9zb3VyY2VfcmVzZXQoeHNyYywgZXJycCk7CisgICAgaWYg
KCplcnJwKSB7CiAgICAgICAgIGdvdG8gZmFpbDsKICAgICB9CiAKQEAgLTc5MCw3ICs3NzgsNiBA
QCB2b2lkIGt2bXBwY194aXZlX2Nvbm5lY3QoU3BhcHJYaXZlICp4aXZlLCBFcnJvciAqKmVycnAp
CiAgICAgcmV0dXJuOwogCiBmYWlsOgotICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9l
cnIpOwogICAgIGt2bXBwY194aXZlX2Rpc2Nvbm5lY3QoeGl2ZSwgTlVMTCk7CiB9CiAKZGlmZiAt
LWdpdCBhL2h3L2ludGMveGljcy5jIGIvaHcvaW50Yy94aWNzLmMKaW5kZXggYjJmY2EyOTc1Yy4u
NjA1MjNmMDI0MSAxMDA2NDQKLS0tIGEvaHcvaW50Yy94aWNzLmMKKysrIGIvaHcvaW50Yy94aWNz
LmMKQEAgLTMyNSwxMSArMzI1LDEwIEBAIHN0YXRpYyB2b2lkIGljcF9yZWFsaXplKERldmljZVN0
YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAgICBQb3dlclBDQ1BVICpjcHU7CiAgICAgQ1BVUFBD
U3RhdGUgKmVudjsKICAgICBPYmplY3QgKm9iajsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKIAot
ICAgIG9iaiA9IG9iamVjdF9wcm9wZXJ0eV9nZXRfbGluayhPQkpFQ1QoZGV2KSwgSUNQX1BST1Bf
WElDUywgJmVycik7CisgICAgb2JqID0gb2JqZWN0X3Byb3BlcnR5X2dldF9saW5rKE9CSkVDVChk
ZXYpLCBJQ1BfUFJPUF9YSUNTLCBlcnJwKTsKICAgICBpZiAoIW9iaikgewotICAgICAgICBlcnJv
cl9wcm9wYWdhdGVfcHJlcGVuZChlcnJwLCBlcnIsCisgICAgICAgIGVycm9yX3Byb3BhZ2F0ZV9w
cmVwZW5kKGVycnAsICplcnJwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicmVx
dWlyZWQgbGluayAnIiBJQ1BfUFJPUF9YSUNTCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICInIG5vdCBmb3VuZDogIik7CiAgICAgICAgIHJldHVybjsKQEAgLTMzNyw5ICszMzYsOSBA
QCBzdGF0aWMgdm9pZCBpY3BfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnAp
CiAKICAgICBpY3AtPnhpY3MgPSBYSUNTX0ZBQlJJQyhvYmopOwogCi0gICAgb2JqID0gb2JqZWN0
X3Byb3BlcnR5X2dldF9saW5rKE9CSkVDVChkZXYpLCBJQ1BfUFJPUF9DUFUsICZlcnIpOworICAg
IG9iaiA9IG9iamVjdF9wcm9wZXJ0eV9nZXRfbGluayhPQkpFQ1QoZGV2KSwgSUNQX1BST1BfQ1BV
LCBlcnJwKTsKICAgICBpZiAoIW9iaikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGVfcHJlcGVu
ZChlcnJwLCBlcnIsCisgICAgICAgIGVycm9yX3Byb3BhZ2F0ZV9wcmVwZW5kKGVycnAsICplcnJw
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicmVxdWlyZWQgbGluayAnIiBJQ1Bf
UFJPUF9DUFUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIicgbm90IGZvdW5kOiAi
KTsKICAgICAgICAgcmV0dXJuOwpAQCAtMzY4LDkgKzM2Nyw4IEBAIHN0YXRpYyB2b2lkIGljcF9y
ZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKIAogICAgIC8qIENvbm5lY3Qg
dGhlIHByZXNlbnRlciB0byB0aGUgVkNQVSAocmVxdWlyZWQgZm9yIENQVSBob3RwbHVnKSAqLwog
ICAgIGlmIChrdm1faXJxY2hpcF9pbl9rZXJuZWwoKSkgewotICAgICAgICBpY3Bfa3ZtX3JlYWxp
emUoZGV2LCAmZXJyKTsKLSAgICAgICAgaWYgKGVycikgewotICAgICAgICAgICAgZXJyb3JfcHJv
cGFnYXRlKGVycnAsIGVycik7CisgICAgICAgIGljcF9rdm1fcmVhbGl6ZShkZXYsIGVycnApOwor
ICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQogICAg
IH0KQEAgLTQwNSw3ICs0MDMsNiBAQCBzdGF0aWMgY29uc3QgVHlwZUluZm8gaWNwX2luZm8gPSB7
CiAKIE9iamVjdCAqaWNwX2NyZWF0ZShPYmplY3QgKmNwdSwgY29uc3QgY2hhciAqdHlwZSwgWElD
U0ZhYnJpYyAqeGksIEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVM
TDsKICAgICBPYmplY3QgKm9iajsKIAogICAgIG9iaiA9IG9iamVjdF9uZXcodHlwZSk7CkBAIC00
MTQsMTAgKzQxMSw5IEBAIE9iamVjdCAqaWNwX2NyZWF0ZShPYmplY3QgKmNwdSwgY29uc3QgY2hh
ciAqdHlwZSwgWElDU0ZhYnJpYyAqeGksIEVycm9yICoqZXJycCkKICAgICBvYmplY3RfcHJvcGVy
dHlfYWRkX2NvbnN0X2xpbmsob2JqLCBJQ1BfUFJPUF9YSUNTLCBPQkpFQ1QoeGkpLAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmZXJyb3JfYWJvcnQpOwogICAgIG9iamVjdF9w
cm9wZXJ0eV9hZGRfY29uc3RfbGluayhvYmosIElDUF9QUk9QX0NQVSwgY3B1LCAmZXJyb3JfYWJv
cnQpOwotICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChvYmosIHRydWUsICJyZWFsaXplZCIs
ICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKKyAgICBvYmplY3RfcHJvcGVydHlf
c2V0X2Jvb2wob2JqLCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsK
ICAgICAgICAgb2JqZWN0X3VucGFyZW50KG9iaik7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShl
cnJwLCBsb2NhbF9lcnIpOwogICAgICAgICBvYmogPSBOVUxMOwogICAgIH0KIApAQCAtNTk3LDEx
ICs1OTMsOSBAQCBzdGF0aWMgdm9pZCBpY3Nfc2ltcGxlX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRl
diwgRXJyb3IgKiplcnJwKQogewogICAgIElDU1N0YXRlICppY3MgPSBJQ1NfU0lNUExFKGRldik7
CiAgICAgSUNTU3RhdGVDbGFzcyAqaWNzYyA9IElDU19CQVNFX0dFVF9DTEFTUyhpY3MpOwotICAg
IEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCi0gICAgaWNzYy0+cGFyZW50X3JlYWxpemUoZGV2
LCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3Bh
Z2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIGljc2MtPnBhcmVudF9yZWFsaXplKGRldiwgZXJy
cCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKQEAgLTY1OSwx
MSArNjUzLDEwIEBAIHN0YXRpYyB2b2lkIGljc19iYXNlX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRl
diwgRXJyb3IgKiplcnJwKQogewogICAgIElDU1N0YXRlICppY3MgPSBJQ1NfQkFTRShkZXYpOwog
ICAgIE9iamVjdCAqb2JqOwotICAgIEVycm9yICplcnIgPSBOVUxMOwogCi0gICAgb2JqID0gb2Jq
ZWN0X3Byb3BlcnR5X2dldF9saW5rKE9CSkVDVChkZXYpLCBJQ1NfUFJPUF9YSUNTLCAmZXJyKTsK
KyAgICBvYmogPSBvYmplY3RfcHJvcGVydHlfZ2V0X2xpbmsoT0JKRUNUKGRldiksIElDU19QUk9Q
X1hJQ1MsIGVycnApOwogICAgIGlmICghb2JqKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZV9w
cmVwZW5kKGVycnAsIGVyciwKKyAgICAgICAgZXJyb3JfcHJvcGFnYXRlX3ByZXBlbmQoZXJycCwg
KmVycnAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJyZXF1aXJlZCBsaW5rICci
IElDU19QUk9QX1hJQ1MKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIicgbm90IGZv
dW5kOiAiKTsKICAgICAgICAgcmV0dXJuOwpkaWZmIC0tZ2l0IGEvaHcvaW50Yy94aWNzX2t2bS5j
IGIvaHcvaW50Yy94aWNzX2t2bS5jCmluZGV4IGE0ZDJlODc2Y2MuLmE1MWYyZmU0ZTggMTAwNjQ0
Ci0tLSBhL2h3L2ludGMveGljc19rdm0uYworKysgYi9ody9pbnRjL3hpY3Nfa3ZtLmMKQEAgLTI5
OCwxMiArMjk4LDEwIEBAIGludCBpY3Nfc2V0X2t2bV9zdGF0ZShJQ1NTdGF0ZSAqaWNzLCBFcnJv
ciAqKmVycnApCiAgICAgfQogCiAgICAgZm9yIChpID0gMDsgaSA8IGljcy0+bnJfaXJxczsgaSsr
KSB7Ci0gICAgICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgICAgICBpbnQgcmV0Owog
Ci0gICAgICAgIHJldCA9IGljc19zZXRfa3ZtX3N0YXRlX29uZShpY3MsIGksICZsb2NhbF9lcnIp
OworICAgICAgICByZXQgPSBpY3Nfc2V0X2t2bV9zdGF0ZV9vbmUoaWNzLCBpLCBlcnJwKTsKICAg
ICAgICAgaWYgKHJldCA8IDApIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBs
b2NhbF9lcnIpOwogICAgICAgICAgICAgcmV0dXJuIHJldDsKICAgICAgICAgfQogICAgIH0KQEAg
LTMzOCw3ICszMzYsNiBAQCBpbnQgeGljc19rdm1fY29ubmVjdChTcGFwck1hY2hpbmVTdGF0ZSAq
c3BhcHIsIEVycm9yICoqZXJycCkKIHsKICAgICBpbnQgcmM7CiAgICAgQ1BVU3RhdGUgKmNzOwot
ICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgLyoKICAgICAgKiBUaGUgS1ZNIFhJ
Q1MgZGV2aWNlIGFscmVhZHkgaW4gdXNlLiBUaGlzIGlzIHRoZSBjYXNlIHdoZW4KQEAgLTM1Niwy
OCArMzUzLDI4IEBAIGludCB4aWNzX2t2bV9jb25uZWN0KFNwYXByTWFjaGluZVN0YXRlICpzcGFw
ciwgRXJyb3IgKiplcnJwKQogCiAgICAgcmMgPSBrdm1wcGNfZGVmaW5lX3J0YXNfa2VybmVsX3Rv
a2VuKFJUQVNfSUJNX1NFVF9YSVZFLCAiaWJtLHNldC14aXZlIik7CiAgICAgaWYgKHJjIDwgMCkg
ewotICAgICAgICBlcnJvcl9zZXRnX2Vycm5vKCZsb2NhbF9lcnIsIC1yYywKKyAgICAgICAgZXJy
b3Jfc2V0Z19lcnJubyhlcnJwLCAtcmMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgImt2bXBw
Y19kZWZpbmVfcnRhc19rZXJuZWxfdG9rZW46IGlibSxzZXQteGl2ZSIpOwogICAgICAgICBnb3Rv
IGZhaWw7CiAgICAgfQogCiAgICAgcmMgPSBrdm1wcGNfZGVmaW5lX3J0YXNfa2VybmVsX3Rva2Vu
KFJUQVNfSUJNX0dFVF9YSVZFLCAiaWJtLGdldC14aXZlIik7CiAgICAgaWYgKHJjIDwgMCkgewot
ICAgICAgICBlcnJvcl9zZXRnX2Vycm5vKCZsb2NhbF9lcnIsIC1yYywKKyAgICAgICAgZXJyb3Jf
c2V0Z19lcnJubyhlcnJwLCAtcmMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgImt2bXBwY19k
ZWZpbmVfcnRhc19rZXJuZWxfdG9rZW46IGlibSxnZXQteGl2ZSIpOwogICAgICAgICBnb3RvIGZh
aWw7CiAgICAgfQogCiAgICAgcmMgPSBrdm1wcGNfZGVmaW5lX3J0YXNfa2VybmVsX3Rva2VuKFJU
QVNfSUJNX0lOVF9PTiwgImlibSxpbnQtb24iKTsKICAgICBpZiAocmMgPCAwKSB7Ci0gICAgICAg
IGVycm9yX3NldGdfZXJybm8oJmxvY2FsX2VyciwgLXJjLAorICAgICAgICBlcnJvcl9zZXRnX2Vy
cm5vKGVycnAsIC1yYywKICAgICAgICAgICAgICAgICAgICAgICAgICAia3ZtcHBjX2RlZmluZV9y
dGFzX2tlcm5lbF90b2tlbjogaWJtLGludC1vbiIpOwogICAgICAgICBnb3RvIGZhaWw7CiAgICAg
fQogCiAgICAgcmMgPSBrdm1wcGNfZGVmaW5lX3J0YXNfa2VybmVsX3Rva2VuKFJUQVNfSUJNX0lO
VF9PRkYsICJpYm0saW50LW9mZiIpOwogICAgIGlmIChyYyA8IDApIHsKLSAgICAgICAgZXJyb3Jf
c2V0Z19lcnJubygmbG9jYWxfZXJyLCAtcmMsCisgICAgICAgIGVycm9yX3NldGdfZXJybm8oZXJy
cCwgLXJjLAogICAgICAgICAgICAgICAgICAgICAgICAgICJrdm1wcGNfZGVmaW5lX3J0YXNfa2Vy
bmVsX3Rva2VuOiBpYm0saW50LW9mZiIpOwogICAgICAgICBnb3RvIGZhaWw7CiAgICAgfQpAQCAt
Mzg1LDcgKzM4Miw3IEBAIGludCB4aWNzX2t2bV9jb25uZWN0KFNwYXByTWFjaGluZVN0YXRlICpz
cGFwciwgRXJyb3IgKiplcnJwKQogICAgIC8qIENyZWF0ZSB0aGUgS1ZNIFhJQ1MgZGV2aWNlICov
CiAgICAgcmMgPSBrdm1fY3JlYXRlX2RldmljZShrdm1fc3RhdGUsIEtWTV9ERVZfVFlQRV9YSUNT
LCBmYWxzZSk7CiAgICAgaWYgKHJjIDwgMCkgewotICAgICAgICBlcnJvcl9zZXRnX2Vycm5vKCZs
b2NhbF9lcnIsIC1yYywgIkVycm9yIG9uIEtWTV9DUkVBVEVfREVWSUNFIGZvciBYSUNTIik7Cisg
ICAgICAgIGVycm9yX3NldGdfZXJybm8oZXJycCwgLXJjLCAiRXJyb3Igb24gS1ZNX0NSRUFURV9E
RVZJQ0UgZm9yIFhJQ1MiKTsKICAgICAgICAgZ290byBmYWlsOwogICAgIH0KIApAQCAtMzk4LDIz
ICszOTUsMjMgQEAgaW50IHhpY3Nfa3ZtX2Nvbm5lY3QoU3BhcHJNYWNoaW5lU3RhdGUgKnNwYXBy
LCBFcnJvciAqKmVycnApCiAgICAgQ1BVX0ZPUkVBQ0goY3MpIHsKICAgICAgICAgUG93ZXJQQ0NQ
VSAqY3B1ID0gUE9XRVJQQ19DUFUoY3MpOwogCi0gICAgICAgIGljcF9rdm1fcmVhbGl6ZShERVZJ
Q0Uoc3BhcHJfY3B1X3N0YXRlKGNwdSktPmljcCksICZsb2NhbF9lcnIpOwotICAgICAgICBpZiAo
bG9jYWxfZXJyKSB7CisgICAgICAgIGljcF9rdm1fcmVhbGl6ZShERVZJQ0Uoc3BhcHJfY3B1X3N0
YXRlKGNwdSktPmljcCksIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAg
IGdvdG8gZmFpbDsKICAgICAgICAgfQogICAgIH0KIAogICAgIC8qIFVwZGF0ZSB0aGUgS1ZNIHNv
dXJjZXMgKi8KLSAgICBpY3Nfc2V0X2t2bV9zdGF0ZShzcGFwci0+aWNzLCAmbG9jYWxfZXJyKTsK
LSAgICBpZiAobG9jYWxfZXJyKSB7CisgICAgaWNzX3NldF9rdm1fc3RhdGUoc3BhcHItPmljcywg
ZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8gZmFpbDsKICAgICB9CiAKICAg
ICAvKiBDb25uZWN0IHRoZSBwcmVzZW50ZXJzIHRvIHRoZSBpbml0aWFsIFZDUFVzIG9mIHRoZSBt
YWNoaW5lICovCiAgICAgQ1BVX0ZPUkVBQ0goY3MpIHsKICAgICAgICAgUG93ZXJQQ0NQVSAqY3B1
ID0gUE9XRVJQQ19DUFUoY3MpOwotICAgICAgICBpY3Bfc2V0X2t2bV9zdGF0ZShzcGFwcl9jcHVf
c3RhdGUoY3B1KS0+aWNwLCAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYgKGxvY2FsX2Vycikgewor
ICAgICAgICBpY3Bfc2V0X2t2bV9zdGF0ZShzcGFwcl9jcHVfc3RhdGUoY3B1KS0+aWNwLCBlcnJw
KTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICBnb3RvIGZhaWw7CiAgICAgICAg
IH0KICAgICB9CkBAIC00MjIsNyArNDE5LDYgQEAgaW50IHhpY3Nfa3ZtX2Nvbm5lY3QoU3BhcHJN
YWNoaW5lU3RhdGUgKnNwYXByLCBFcnJvciAqKmVycnApCiAgICAgcmV0dXJuIDA7CiAKIGZhaWw6
Ci0gICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CiAgICAgeGljc19rdm1fZGlz
Y29ubmVjdChzcGFwciwgTlVMTCk7CiAgICAgcmV0dXJuIC0xOwogfQpkaWZmIC0tZ2l0IGEvaHcv
aW50Yy94aWNzX3Budi5jIGIvaHcvaW50Yy94aWNzX3Budi5jCmluZGV4IDM1ZjM4MTEyNjQuLjUw
MjhlNTg5N2QgMTAwNjQ0Ci0tLSBhL2h3L2ludGMveGljc19wbnYuYworKysgYi9ody9pbnRjL3hp
Y3NfcG52LmMKQEAgLTE2NCwxMSArMTY0LDkgQEAgc3RhdGljIHZvaWQgcG52X2ljcF9yZWFsaXpl
KERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAgICBJQ1BTdGF0ZSAqaWNwID0gSUNQ
KGRldik7CiAgICAgUG52SUNQU3RhdGUgKnBudl9pY3AgPSBQTlZfSUNQKGljcCk7CiAgICAgSUNQ
U3RhdGVDbGFzcyAqaWNwYyA9IElDUF9HRVRfQ0xBU1MoaWNwKTsKLSAgICBFcnJvciAqbG9jYWxf
ZXJyID0gTlVMTDsKIAotICAgIGljcGMtPnBhcmVudF9yZWFsaXplKGRldiwgJmxvY2FsX2Vycik7
Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9j
YWxfZXJyKTsKKyAgICBpY3BjLT5wYXJlbnRfcmVhbGl6ZShkZXYsIGVycnApOworICAgIGlmICgq
ZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCmRpZmYgLS1naXQgYS9ody9pbnRjL3hp
dmUuYyBiL2h3L2ludGMveGl2ZS5jCmluZGV4IGI3NDE3MjEwZDguLmYxNjFlMWQ2NTAgMTAwNjQ0
Ci0tLSBhL2h3L2ludGMveGl2ZS5jCisrKyBiL2h3L2ludGMveGl2ZS5jCkBAIC01NzQsMTEgKzU3
NCw5IEBAIHN0YXRpYyB2b2lkIHhpdmVfdGN0eF9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVy
cm9yICoqZXJycCkKICAgICBQb3dlclBDQ1BVICpjcHU7CiAgICAgQ1BVUFBDU3RhdGUgKmVudjsK
ICAgICBPYmplY3QgKm9iajsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAotICAgIG9i
aiA9IG9iamVjdF9wcm9wZXJ0eV9nZXRfbGluayhPQkpFQ1QoZGV2KSwgImNwdSIsICZsb2NhbF9l
cnIpOworICAgIG9iaiA9IG9iamVjdF9wcm9wZXJ0eV9nZXRfbGluayhPQkpFQ1QoZGV2KSwgImNw
dSIsIGVycnApOwogICAgIGlmICghb2JqKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJw
LCBsb2NhbF9lcnIpOwogICAgICAgICBlcnJvcl9wcmVwZW5kKGVycnAsICJyZXF1aXJlZCBsaW5r
ICdjcHUnIG5vdCBmb3VuZDogIik7CiAgICAgICAgIHJldHVybjsKICAgICB9CkBAIC02MDEsOSAr
NTk5LDggQEAgc3RhdGljIHZvaWQgeGl2ZV90Y3R4X3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwg
RXJyb3IgKiplcnJwKQogCiAgICAgLyogQ29ubmVjdCB0aGUgcHJlc2VudGVyIHRvIHRoZSBWQ1BV
IChyZXF1aXJlZCBmb3IgQ1BVIGhvdHBsdWcpICovCiAgICAgaWYgKGt2bV9pcnFjaGlwX2luX2tl
cm5lbCgpKSB7Ci0gICAgICAgIGt2bXBwY194aXZlX2NwdV9jb25uZWN0KHRjdHgsICZsb2NhbF9l
cnIpOwotICAgICAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdh
dGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAga3ZtcHBjX3hpdmVfY3B1X2Nvbm5lY3QodGN0
eCwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgcmV0dXJuOwogICAg
ICAgICB9CiAgICAgfQpAQCAtNjgxLDE1ICs2NzgsMTQgQEAgc3RhdGljIGNvbnN0IFR5cGVJbmZv
IHhpdmVfdGN0eF9pbmZvID0gewogCiBPYmplY3QgKnhpdmVfdGN0eF9jcmVhdGUoT2JqZWN0ICpj
cHUsIFhpdmVSb3V0ZXIgKnhydHIsIEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqbG9jYWxf
ZXJyID0gTlVMTDsKICAgICBPYmplY3QgKm9iajsKIAogICAgIG9iaiA9IG9iamVjdF9uZXcoVFlQ
RV9YSVZFX1RDVFgpOwogICAgIG9iamVjdF9wcm9wZXJ0eV9hZGRfY2hpbGQoY3B1LCBUWVBFX1hJ
VkVfVENUWCwgb2JqLCAmZXJyb3JfYWJvcnQpOwogICAgIG9iamVjdF91bnJlZihvYmopOwogICAg
IG9iamVjdF9wcm9wZXJ0eV9hZGRfY29uc3RfbGluayhvYmosICJjcHUiLCBjcHUsICZlcnJvcl9h
Ym9ydCk7Ci0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKG9iaiwgdHJ1ZSwgInJlYWxpemVk
IiwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgeworICAgIG9iamVjdF9wcm9wZXJ0
eV9zZXRfYm9vbChvYmosIHRydWUsICJyZWFsaXplZCIsIGVycnApOworICAgIGlmICgqZXJycCkg
ewogICAgICAgICBnb3RvIGVycm9yOwogICAgIH0KIApAQCAtNjk3LDcgKzY5Myw2IEBAIE9iamVj
dCAqeGl2ZV90Y3R4X2NyZWF0ZShPYmplY3QgKmNwdSwgWGl2ZVJvdXRlciAqeHJ0ciwgRXJyb3Ig
KiplcnJwKQogCiBlcnJvcjoKICAgICBvYmplY3RfdW5wYXJlbnQob2JqKTsKLSAgICBlcnJvcl9w
cm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKICAgICByZXR1cm4gTlVMTDsKIH0KIApAQCAtMTA1
MiwxMSArMTA0Nyw5IEBAIHN0YXRpYyB2b2lkIHhpdmVfc291cmNlX3JlYWxpemUoRGV2aWNlU3Rh
dGUgKmRldiwgRXJyb3IgKiplcnJwKQogewogICAgIFhpdmVTb3VyY2UgKnhzcmMgPSBYSVZFX1NP
VVJDRShkZXYpOwogICAgIE9iamVjdCAqb2JqOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxM
OwogCi0gICAgb2JqID0gb2JqZWN0X3Byb3BlcnR5X2dldF9saW5rKE9CSkVDVChkZXYpLCAieGl2
ZSIsICZsb2NhbF9lcnIpOworICAgIG9iaiA9IG9iamVjdF9wcm9wZXJ0eV9nZXRfbGluayhPQkpF
Q1QoZGV2KSwgInhpdmUiLCBlcnJwKTsKICAgICBpZiAoIW9iaikgewotICAgICAgICBlcnJvcl9w
cm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKICAgICAgICAgZXJyb3JfcHJlcGVuZChlcnJwLCAi
cmVxdWlyZWQgbGluayAneGl2ZScgbm90IGZvdW5kOiAiKTsKICAgICAgICAgcmV0dXJuOwogICAg
IH0KQEAgLTE4MDAsMTEgKzE3OTMsOSBAQCBzdGF0aWMgdm9pZCB4aXZlX2VuZF9zb3VyY2VfcmVh
bGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiB7CiAgICAgWGl2ZUVORFNvdXJj
ZSAqeHNyYyA9IFhJVkVfRU5EX1NPVVJDRShkZXYpOwogICAgIE9iamVjdCAqb2JqOwotICAgIEVy
cm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCi0gICAgb2JqID0gb2JqZWN0X3Byb3BlcnR5X2dldF9s
aW5rKE9CSkVDVChkZXYpLCAieGl2ZSIsICZsb2NhbF9lcnIpOworICAgIG9iaiA9IG9iamVjdF9w
cm9wZXJ0eV9nZXRfbGluayhPQkpFQ1QoZGV2KSwgInhpdmUiLCBlcnJwKTsKICAgICBpZiAoIW9i
aikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKICAgICAgICAg
ZXJyb3JfcHJlcGVuZChlcnJwLCAicmVxdWlyZWQgbGluayAneGl2ZScgbm90IGZvdW5kOiAiKTsK
ICAgICAgICAgcmV0dXJuOwogICAgIH0KZGlmZiAtLWdpdCBhL2h3L2lwYWNrL2lwYWNrLmMgYi9o
dy9pcGFjay9pcGFjay5jCmluZGV4IDMwZTE2Njk2YzAuLmRjNjZmZTYyZDggMTAwNjQ0Ci0tLSBh
L2h3L2lwYWNrL2lwYWNrLmMKKysrIGIvaHcvaXBhY2svaXBhY2suYwpAQCAtNjQsMTEgKzY0LDkg
QEAgc3RhdGljIHZvaWQgaXBhY2tfZGV2aWNlX3VucmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBF
cnJvciAqKmVycnApCiB7CiAgICAgSVBhY2tEZXZpY2UgKmlkZXYgPSBJUEFDS19ERVZJQ0UoZGV2
KTsKICAgICBJUGFja0RldmljZUNsYXNzICprID0gSVBBQ0tfREVWSUNFX0dFVF9DTEFTUyhkZXYp
OwotICAgIEVycm9yICplcnIgPSBOVUxMOwogCiAgICAgaWYgKGstPnVucmVhbGl6ZSkgewotICAg
ICAgICBrLT51bnJlYWxpemUoZGV2LCAmZXJyKTsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVy
cnAsIGVycik7CisgICAgICAgIGstPnVucmVhbGl6ZShkZXYsIGVycnApOwogICAgICAgICByZXR1
cm47CiAgICAgfQogCmRpZmYgLS1naXQgYS9ody9pc2EvcGM4NzMxMi5jIGIvaHcvaXNhL3BjODcz
MTIuYwppbmRleCBiOWJkNTc0NzFlLi5hY2VmNmZkNjcwIDEwMDY0NAotLS0gYS9ody9pc2EvcGM4
NzMxMi5jCisrKyBiL2h3L2lzYS9wYzg3MzEyLmMKQEAgLTI5MywxNiArMjkzLDE0IEBAIHN0YXRp
YyB2b2lkIHBjODczMTJfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiB7
CiAgICAgUEM4NzMxMlN0YXRlICpzOwogICAgIElTQURldmljZSAqaXNhOwotICAgIEVycm9yICps
b2NhbF9lcnIgPSBOVUxMOwogCiAgICAgcyA9IFBDODczMTIoZGV2KTsKICAgICBpc2EgPSBJU0Ff
REVWSUNFKGRldik7CiAgICAgaXNhX3JlZ2lzdGVyX2lvcG9ydChpc2EsICZzLT5pbywgcy0+aW9i
YXNlKTsKICAgICBwYzg3MzEyX2hhcmRfcmVzZXQocyk7CiAKLSAgICBJU0FfU1VQRVJJT19HRVRf
Q0xBU1MoZGV2KS0+cGFyZW50X3JlYWxpemUoZGV2LCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9j
YWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAg
IElTQV9TVVBFUklPX0dFVF9DTEFTUyhkZXYpLT5wYXJlbnRfcmVhbGl6ZShkZXYsIGVycnApOwor
ICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogfQpkaWZmIC0tZ2l0IGEv
aHcvbWVtL21lbW9yeS1kZXZpY2UuYyBiL2h3L21lbS9tZW1vcnktZGV2aWNlLmMKaW5kZXggNTM5
NTNmZGMzYS4uZWQ5YzQyMTE1MCAxMDA2NDQKLS0tIGEvaHcvbWVtL21lbW9yeS1kZXZpY2UuYwor
KysgYi9ody9tZW0vbWVtb3J5LWRldmljZS5jCkBAIC0yNTQsMjkgKzI1NCwyNiBAQCB2b2lkIG1l
bW9yeV9kZXZpY2VfcHJlX3BsdWcoTWVtb3J5RGV2aWNlU3RhdGUgKm1kLCBNYWNoaW5lU3RhdGUg
Km1zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHVpbnQ2NF90ICpsZWdhY3lf
YWxpZ24sIEVycm9yICoqZXJycCkKIHsKICAgICBjb25zdCBNZW1vcnlEZXZpY2VDbGFzcyAqbWRj
ID0gTUVNT1JZX0RFVklDRV9HRVRfQ0xBU1MobWQpOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBO
VUxMOwogICAgIHVpbnQ2NF90IGFkZHIsIGFsaWduOwogICAgIE1lbW9yeVJlZ2lvbiAqbXI7CiAK
LSAgICBtciA9IG1kYy0+Z2V0X21lbW9yeV9yZWdpb24obWQsICZsb2NhbF9lcnIpOwotICAgIGlm
IChsb2NhbF9lcnIpIHsKLSAgICAgICAgZ290byBvdXQ7CisgICAgbXIgPSBtZGMtPmdldF9tZW1v
cnlfcmVnaW9uKG1kLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKKyAgICAgICAgcmV0dXJuOwog
ICAgIH0KIAogICAgIGFsaWduID0gbGVnYWN5X2FsaWduID8gKmxlZ2FjeV9hbGlnbiA6IG1lbW9y
eV9yZWdpb25fZ2V0X2FsaWdubWVudChtcik7CiAgICAgYWRkciA9IG1kYy0+Z2V0X2FkZHIobWQp
OwogICAgIGFkZHIgPSBtZW1vcnlfZGV2aWNlX2dldF9mcmVlX2FkZHIobXMsICFhZGRyID8gTlVM
TCA6ICZhZGRyLCBhbGlnbiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IG1lbW9yeV9yZWdpb25fc2l6ZShtciksICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIp
IHsKLSAgICAgICAgZ290byBvdXQ7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBtZW1vcnlfcmVnaW9uX3NpemUobXIpLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKKyAg
ICAgICAgcmV0dXJuOwogICAgIH0KLSAgICBtZGMtPnNldF9hZGRyKG1kLCBhZGRyLCAmbG9jYWxf
ZXJyKTsKLSAgICBpZiAoIWxvY2FsX2VycikgeworICAgIG1kYy0+c2V0X2FkZHIobWQsIGFkZHIs
IGVycnApOworICAgIGlmICghKmVycnApIHsKICAgICAgICAgdHJhY2VfbWVtb3J5X2RldmljZV9w
cmVfcGx1ZyhERVZJQ0UobWQpLT5pZCA/IERFVklDRShtZCktPmlkIDogIiIsCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkcik7CiAgICAgfQotb3V0OgotICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogfQogCiB2b2lkIG1lbW9yeV9kZXZpY2VfcGx1
ZyhNZW1vcnlEZXZpY2VTdGF0ZSAqbWQsIE1hY2hpbmVTdGF0ZSAqbXMpCmRpZmYgLS1naXQgYS9o
dy9tZW0vbnZkaW1tLmMgYi9ody9tZW0vbnZkaW1tLmMKaW5kZXggMzc1ZjlhNTg4YS4uNWIwYTk2
OWQ4MyAxMDA2NDQKLS0tIGEvaHcvbWVtL252ZGltbS5jCisrKyBiL2h3L21lbS9udmRpbW0uYwpA
QCAtNDUsMjggKzQ1LDI1IEBAIHN0YXRpYyB2b2lkIG52ZGltbV9zZXRfbGFiZWxfc2l6ZShPYmpl
Y3QgKm9iaiwgVmlzaXRvciAqdiwgY29uc3QgY2hhciAqbmFtZSwKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICB2b2lkICpvcGFxdWUsIEVycm9yICoqZXJycCkKIHsKICAgICBOVkRJ
TU1EZXZpY2UgKm52ZGltbSA9IE5WRElNTShvYmopOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBO
VUxMOwogICAgIHVpbnQ2NF90IHZhbHVlOwogCiAgICAgaWYgKG52ZGltbS0+bnZkaW1tX21yKSB7
Ci0gICAgICAgIGVycm9yX3NldGcoJmxvY2FsX2VyciwgImNhbm5vdCBjaGFuZ2UgcHJvcGVydHkg
dmFsdWUiKTsKLSAgICAgICAgZ290byBvdXQ7CisgICAgICAgIGVycm9yX3NldGcoZXJycCwgImNh
bm5vdCBjaGFuZ2UgcHJvcGVydHkgdmFsdWUiKTsKKyAgICAgICAgcmV0dXJuOwogICAgIH0KIAot
ICAgIHZpc2l0X3R5cGVfc2l6ZSh2LCBuYW1lLCAmdmFsdWUsICZsb2NhbF9lcnIpOwotICAgIGlm
IChsb2NhbF9lcnIpIHsKLSAgICAgICAgZ290byBvdXQ7CisgICAgdmlzaXRfdHlwZV9zaXplKHYs
IG5hbWUsICZ2YWx1ZSwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CisgICAgICAgIHJldHVybjsK
ICAgICB9CiAgICAgaWYgKHZhbHVlIDwgTUlOX05BTUVTUEFDRV9MQUJFTF9TSVpFKSB7Ci0gICAg
ICAgIGVycm9yX3NldGcoJmxvY2FsX2VyciwgIlByb3BlcnR5ICclcy4lcycgKDB4JSIgUFJJeDY0
ICIpIGlzIHJlcXVpcmVkIgorICAgICAgICBlcnJvcl9zZXRnKGVycnAsICJQcm9wZXJ0eSAnJXMu
JXMnICgweCUiIFBSSXg2NCAiKSBpcyByZXF1aXJlZCIKICAgICAgICAgICAgICAgICAgICAiIGF0
IGxlYXN0IDB4JWx4Iiwgb2JqZWN0X2dldF90eXBlbmFtZShvYmopLAogICAgICAgICAgICAgICAg
ICAgIG5hbWUsIHZhbHVlLCBNSU5fTkFNRVNQQUNFX0xBQkVMX1NJWkUpOwotICAgICAgICBnb3Rv
IG91dDsKKyAgICAgICAgcmV0dXJuOwogICAgIH0KIAogICAgIG52ZGltbS0+bGFiZWxfc2l6ZSA9
IHZhbHVlOwotb3V0OgotICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogfQog
CiBzdGF0aWMgdm9pZCBudmRpbW1faW5pdChPYmplY3QgKm9iaikKQEAgLTEyNywxMiArMTI0LDEw
IEBAIHN0YXRpYyBNZW1vcnlSZWdpb24gKm52ZGltbV9tZF9nZXRfbWVtb3J5X3JlZ2lvbihNZW1v
cnlEZXZpY2VTdGF0ZSAqbWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgRXJyb3IgKiplcnJwKQogewogICAgIE5WRElNTURldmljZSAqbnZkaW1tID0g
TlZESU1NKG1kKTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAogICAgIGlmICghbnZk
aW1tLT5udmRpbW1fbXIpIHsKLSAgICAgICAgbnZkaW1tX3ByZXBhcmVfbWVtb3J5X3JlZ2lvbihu
dmRpbW0sICZsb2NhbF9lcnIpOwotICAgICAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgICAg
ICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgbnZkaW1tX3ByZXBh
cmVfbWVtb3J5X3JlZ2lvbihudmRpbW0sIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKICAg
ICAgICAgICAgIHJldHVybiBOVUxMOwogICAgICAgICB9CiAgICAgfQpkaWZmIC0tZ2l0IGEvaHcv
bWVtL3BjLWRpbW0uYyBiL2h3L21lbS9wYy1kaW1tLmMKaW5kZXggOTllMmZhZjAxYi4uM2YwZDY5
NmNmOCAxMDA2NDQKLS0tIGEvaHcvbWVtL3BjLWRpbW0uYworKysgYi9ody9tZW0vcGMtZGltbS5j
CkBAIC0zNywzMSArMzcsMjggQEAgc3RhdGljIGludCBwY19kaW1tX2dldF9mcmVlX3Nsb3QoY29u
c3QgaW50ICpoaW50LCBpbnQgbWF4X3Nsb3RzLCBFcnJvciAqKmVycnApOwogdm9pZCBwY19kaW1t
X3ByZV9wbHVnKFBDRElNTURldmljZSAqZGltbSwgTWFjaGluZVN0YXRlICptYWNoaW5lLAogICAg
ICAgICAgICAgICAgICAgICAgIGNvbnN0IHVpbnQ2NF90ICpsZWdhY3lfYWxpZ24sIEVycm9yICoq
ZXJycCkKIHsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBpbnQgc2xvdDsKIAog
ICAgIHNsb3QgPSBvYmplY3RfcHJvcGVydHlfZ2V0X2ludChPQkpFQ1QoZGltbSksIFBDX0RJTU1f
U0xPVF9QUk9QLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmZXJyb3JfYWJv
cnQpOwogICAgIGlmICgoc2xvdCA8IDAgfHwgc2xvdCA+PSBtYWNoaW5lLT5yYW1fc2xvdHMpICYm
CiAgICAgICAgICBzbG90ICE9IFBDX0RJTU1fVU5BU1NJR05FRF9TTE9UKSB7Ci0gICAgICAgIGVy
cm9yX3NldGcoJmxvY2FsX2VyciwgImludmFsaWQgc2xvdCBudW1iZXIsIHZhbGlkIHJhbmdlIGlz
IFswLSUiCisgICAgICAgIGVycm9yX3NldGcoZXJycCwgImludmFsaWQgc2xvdCBudW1iZXIsIHZh
bGlkIHJhbmdlIGlzIFswLSUiCiAgICAgICAgICAgICAgICAgICAgUFJJdTY0ICJdIiwgbWFjaGlu
ZS0+cmFtX3Nsb3RzIC0gMSk7Ci0gICAgICAgIGdvdG8gb3V0OworICAgICAgICByZXR1cm47CiAg
ICAgfQogCiAgICAgc2xvdCA9IHBjX2RpbW1fZ2V0X2ZyZWVfc2xvdChzbG90ID09IFBDX0RJTU1f
VU5BU1NJR05FRF9TTE9UID8gTlVMTCA6ICZzbG90LAotICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgbWFjaGluZS0+cmFtX3Nsb3RzLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxf
ZXJyKSB7Ci0gICAgICAgIGdvdG8gb3V0OworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgbWFjaGluZS0+cmFtX3Nsb3RzLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKKyAgICAgICAg
cmV0dXJuOwogICAgIH0KICAgICBvYmplY3RfcHJvcGVydHlfc2V0X2ludChPQkpFQ1QoZGltbSks
IHNsb3QsIFBDX0RJTU1fU0xPVF9QUk9QLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICZl
cnJvcl9hYm9ydCk7CiAgICAgdHJhY2VfbWhwX3BjX2RpbW1fYXNzaWduZWRfc2xvdChzbG90KTsK
IAogICAgIG1lbW9yeV9kZXZpY2VfcHJlX3BsdWcoTUVNT1JZX0RFVklDRShkaW1tKSwgbWFjaGlu
ZSwgbGVnYWN5X2FsaWduLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgJmxvY2FsX2Vycik7
Ci1vdXQ6Ci0gICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgICAg
ICAgICAgICAgICAgICAgICBlcnJwKTsKIH0KIAogdm9pZCBwY19kaW1tX3BsdWcoUENESU1NRGV2
aWNlICpkaW1tLCBNYWNoaW5lU3RhdGUgKm1hY2hpbmUsIEVycm9yICoqZXJycCkKQEAgLTE1MCwx
MiArMTQ3LDEwIEBAIHN0YXRpYyBQcm9wZXJ0eSBwY19kaW1tX3Byb3BlcnRpZXNbXSA9IHsKIHN0
YXRpYyB2b2lkIHBjX2RpbW1fZ2V0X3NpemUoT2JqZWN0ICpvYmosIFZpc2l0b3IgKnYsIGNvbnN0
IGNoYXIgKm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgKm9wYXF1ZSwg
RXJyb3IgKiplcnJwKQogewotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIHVpbnQ2
NF90IHZhbHVlOwogCi0gICAgdmFsdWUgPSBtZW1vcnlfZGV2aWNlX2dldF9yZWdpb25fc2l6ZShN
RU1PUllfREVWSUNFKG9iaiksICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAg
ICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgdmFsdWUgPSBtZW1v
cnlfZGV2aWNlX2dldF9yZWdpb25fc2l6ZShNRU1PUllfREVWSUNFKG9iaiksIGVycnApOworICAg
IGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCmRpZmYgLS1naXQgYS9ody9t
aWNyb2JsYXplL3hsbngtenlucW1wLXBtdS5jIGIvaHcvbWljcm9ibGF6ZS94bG54LXp5bnFtcC1w
bXUuYwppbmRleCAwMjhmMzE4OTRkLi5mOGVkYjMyYzhjIDEwMDY0NAotLS0gYS9ody9taWNyb2Js
YXplL3hsbngtenlucW1wLXBtdS5jCisrKyBiL2h3L21pY3JvYmxhemUveGxueC16eW5xbXAtcG11
LmMKQEAgLTc5LDcgKzc5LDYgQEAgc3RhdGljIHZvaWQgeGxueF96eW5xbXBfcG11X3NvY19pbml0
KE9iamVjdCAqb2JqKQogc3RhdGljIHZvaWQgeGxueF96eW5xbXBfcG11X3NvY19yZWFsaXplKERl
dmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKIHsKICAgICBYbG54WnlucU1QUE1VU29DU3Rh
dGUgKnMgPSBYTE5YX1pZTlFNUF9QTVVfU09DKGRldik7Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7
CiAKICAgICBvYmplY3RfcHJvcGVydHlfc2V0X3VpbnQoT0JKRUNUKCZzLT5jcHUpLCBYTE5YX1pZ
TlFNUF9QTVVfUk9NX0FERFIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJiYXNlLXZl
Y3RvcnMiLCAmZXJyb3JfYWJvcnQpOwpAQCAtOTksOSArOTgsOCBAQCBzdGF0aWMgdm9pZCB4bG54
X3p5bnFtcF9wbXVfc29jX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQog
ICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfc3RyKE9CSkVDVCgmcy0+Y3B1KSwgIjguNDAuYiIsICJ2
ZXJzaW9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmZXJyb3JfYWJvcnQpOwogICAg
IG9iamVjdF9wcm9wZXJ0eV9zZXRfdWludChPQkpFQ1QoJnMtPmNwdSksIDAsICJwdnIiLCAmZXJy
b3JfYWJvcnQpOwotICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPmNwdSks
IHRydWUsICJyZWFsaXplZCIsICZlcnIpOwotICAgIGlmIChlcnIpIHsKLSAgICAgICAgZXJyb3Jf
cHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVD
VCgmcy0+Y3B1KSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAg
ICAgICAgIHJldHVybjsKICAgICB9CiAKQEAgLTExMSw5ICsxMDksOCBAQCBzdGF0aWMgdm9pZCB4
bG54X3p5bnFtcF9wbXVfc29jX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJw
KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmZXJyb3JfYWJvcnQpOwogICAgIG9iamVj
dF9wcm9wZXJ0eV9zZXRfdWludChPQkpFQ1QoJnMtPmludGMpLCAweGZmZmYsICJpbnRjLXBvc2l0
aXZlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJmVycm9yX2Fib3J0KTsKLSAgICBv
YmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5pbnRjKSwgdHJ1ZSwgInJlYWxpemVk
IiwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwg
ZXJyKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5pbnRjKSwgdHJ1
ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsK
ICAgICB9CiAgICAgc3lzYnVzX21taW9fbWFwKFNZU19CVVNfREVWSUNFKCZzLT5pbnRjKSwgMCwg
WExOWF9aWU5RTVBfUE1VX0lOVENfQUREUik7CmRpZmYgLS1naXQgYS9ody9taXBzL2Nwcy5jIGIv
aHcvbWlwcy9jcHMuYwppbmRleCAxNjYwZjg2OTA4Li5jZWQzNzNkODUyIDEwMDY0NAotLS0gYS9o
dy9taXBzL2Nwcy5jCisrKyBiL2h3L21pcHMvY3BzLmMKQEAgLTcxLDcgKzcxLDYgQEAgc3RhdGlj
IHZvaWQgbWlwc19jcHNfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAg
ICAgQ1BVTUlQU1N0YXRlICplbnY7CiAgICAgTUlQU0NQVSAqY3B1OwogICAgIGludCBpOwotICAg
IEVycm9yICplcnIgPSBOVUxMOwogICAgIHRhcmdldF91bG9uZyBnY3JfYmFzZTsKICAgICBib29s
IGl0dV9wcmVzZW50ID0gZmFsc2U7CiAgICAgYm9vbCBzYWFyX3ByZXNlbnQgPSBmYWxzZTsKQEAg
LTEwMSwxNiArMTAwLDE1IEBAIHN0YXRpYyB2b2lkIG1pcHNfY3BzX3JlYWxpemUoRGV2aWNlU3Rh
dGUgKmRldiwgRXJyb3IgKiplcnJwKQogICAgIGlmIChpdHVfcHJlc2VudCkgewogICAgICAgICBz
eXNidXNfaW5pdF9jaGlsZF9vYmooT0JKRUNUKGRldiksICJpdHUiLCAmcy0+aXR1LCBzaXplb2Yo
cy0+aXR1KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRZUEVfTUlQU19JVFUpOwot
ICAgICAgICBvYmplY3RfcHJvcGVydHlfc2V0X2ludChPQkpFQ1QoJnMtPml0dSksIDE2LCAibnVt
LWZpZm8iLCAmZXJyKTsKLSAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9pbnQoT0JKRUNUKCZz
LT5pdHUpLCAxNiwgIm51bS1zZW1hcGhvcmVzIiwgJmVycik7CisgICAgICAgIG9iamVjdF9wcm9w
ZXJ0eV9zZXRfaW50KE9CSkVDVCgmcy0+aXR1KSwgMTYsICJudW0tZmlmbyIsIGVycnApOworICAg
ICAgICBvYmplY3RfcHJvcGVydHlfc2V0X2ludChPQkpFQ1QoJnMtPml0dSksIDE2LCAibnVtLXNl
bWFwaG9yZXMiLCBlcnJwKTsKICAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVD
VCgmcy0+aXR1KSwgc2Fhcl9wcmVzZW50LCAic2Fhci1wcmVzZW50IiwKLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICZlcnIpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgZXJycCk7CiAgICAgICAgIGlmIChzYWFyX3ByZXNlbnQpIHsKICAgICAgICAgICAgIHFkZXZf
cHJvcF9zZXRfcHRyKERFVklDRSgmcy0+aXR1KSwgInNhYXIiLCAodm9pZCAqKSZlbnYtPkNQMF9T
QUFSKTsKICAgICAgICAgfQotICAgICAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNU
KCZzLT5pdHUpLCB0cnVlLCAicmVhbGl6ZWQiLCAmZXJyKTsKLSAgICAgICAgaWYgKGVyciAhPSBO
VUxMKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAg
b2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+aXR1KSwgdHJ1ZSwgInJlYWxpemVk
IiwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCAhPSBOVUxMKSB7CiAgICAgICAgICAgICByZXR1
cm47CiAgICAgICAgIH0KIApAQCAtMTIxLDExICsxMTksMTAgQEAgc3RhdGljIHZvaWQgbWlwc19j
cHNfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgLyogQ2x1c3Rl
ciBQb3dlciBDb250cm9sbGVyICovCiAgICAgc3lzYnVzX2luaXRfY2hpbGRfb2JqKE9CSkVDVChk
ZXYpLCAiY3BjIiwgJnMtPmNwYywgc2l6ZW9mKHMtPmNwYyksCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgIFRZUEVfTUlQU19DUEMpOwotICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfaW50KE9CSkVD
VCgmcy0+Y3BjKSwgcy0+bnVtX3ZwLCAibnVtLXZwIiwgJmVycik7Ci0gICAgb2JqZWN0X3Byb3Bl
cnR5X3NldF9pbnQoT0JKRUNUKCZzLT5jcGMpLCAxLCAidnAtc3RhcnQtcnVubmluZyIsICZlcnIp
OwotICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPmNwYyksIHRydWUsICJy
ZWFsaXplZCIsICZlcnIpOwotICAgIGlmIChlcnIgIT0gTlVMTCkgewotICAgICAgICBlcnJvcl9w
cm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2ludChPQkpFQ1Qo
JnMtPmNwYyksIHMtPm51bV92cCwgIm51bS12cCIsIGVycnApOworICAgIG9iamVjdF9wcm9wZXJ0
eV9zZXRfaW50KE9CSkVDVCgmcy0+Y3BjKSwgMSwgInZwLXN0YXJ0LXJ1bm5pbmciLCBlcnJwKTsK
KyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5jcGMpLCB0cnVlLCAicmVh
bGl6ZWQiLCBlcnJwKTsKKyAgICBpZiAoKmVycnAgIT0gTlVMTCkgewogICAgICAgICByZXR1cm47
CiAgICAgfQogCkBAIC0xMzUsMTEgKzEzMiwxMCBAQCBzdGF0aWMgdm9pZCBtaXBzX2Nwc19yZWFs
aXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAgICAvKiBHbG9iYWwgSW50ZXJy
dXB0IENvbnRyb2xsZXIgKi8KICAgICBzeXNidXNfaW5pdF9jaGlsZF9vYmooT0JKRUNUKGRldiks
ICJnaWMiLCAmcy0+Z2ljLCBzaXplb2Yocy0+Z2ljKSwKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgVFlQRV9NSVBTX0dJQyk7Ci0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9pbnQoT0JKRUNUKCZz
LT5naWMpLCBzLT5udW1fdnAsICJudW0tdnAiLCAmZXJyKTsKLSAgICBvYmplY3RfcHJvcGVydHlf
c2V0X2ludChPQkpFQ1QoJnMtPmdpYyksIDEyOCwgIm51bS1pcnEiLCAmZXJyKTsKLSAgICBvYmpl
Y3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5naWMpLCB0cnVlLCAicmVhbGl6ZWQiLCAm
ZXJyKTsKLSAgICBpZiAoZXJyICE9IE5VTEwpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVy
cnAsIGVycik7CisgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9pbnQoT0JKRUNUKCZzLT5naWMpLCBz
LT5udW1fdnAsICJudW0tdnAiLCBlcnJwKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2ludChP
QkpFQ1QoJnMtPmdpYyksIDEyOCwgIm51bS1pcnEiLCBlcnJwKTsKKyAgICBvYmplY3RfcHJvcGVy
dHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5naWMpLCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAg
ICBpZiAoKmVycnAgIT0gTlVMTCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCkBAIC0xNTEs
MTQgKzE0NywxMyBAQCBzdGF0aWMgdm9pZCBtaXBzX2Nwc19yZWFsaXplKERldmljZVN0YXRlICpk
ZXYsIEVycm9yICoqZXJycCkKIAogICAgIHN5c2J1c19pbml0X2NoaWxkX29iaihPQkpFQ1QoZGV2
KSwgImdjciIsICZzLT5nY3IsIHNpemVvZihzLT5nY3IpLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICBUWVBFX01JUFNfR0NSKTsKLSAgICBvYmplY3RfcHJvcGVydHlfc2V0X2ludChPQkpFQ1Qo
JnMtPmdjciksIHMtPm51bV92cCwgIm51bS12cCIsICZlcnIpOwotICAgIG9iamVjdF9wcm9wZXJ0
eV9zZXRfaW50KE9CSkVDVCgmcy0+Z2NyKSwgMHg4MDAsICJnY3ItcmV2IiwgJmVycik7Ci0gICAg
b2JqZWN0X3Byb3BlcnR5X3NldF9pbnQoT0JKRUNUKCZzLT5nY3IpLCBnY3JfYmFzZSwgImdjci1i
YXNlIiwgJmVycik7Ci0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9saW5rKE9CSkVDVCgmcy0+Z2Ny
KSwgT0JKRUNUKCZzLT5naWMubXIpLCAiZ2ljIiwgJmVycik7Ci0gICAgb2JqZWN0X3Byb3BlcnR5
X3NldF9saW5rKE9CSkVDVCgmcy0+Z2NyKSwgT0JKRUNUKCZzLT5jcGMubXIpLCAiY3BjIiwgJmVy
cik7Ci0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+Z2NyKSwgdHJ1ZSwg
InJlYWxpemVkIiwgJmVycik7Ci0gICAgaWYgKGVyciAhPSBOVUxMKSB7Ci0gICAgICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfaW50KE9CSkVD
VCgmcy0+Z2NyKSwgcy0+bnVtX3ZwLCAibnVtLXZwIiwgZXJycCk7CisgICAgb2JqZWN0X3Byb3Bl
cnR5X3NldF9pbnQoT0JKRUNUKCZzLT5nY3IpLCAweDgwMCwgImdjci1yZXYiLCBlcnJwKTsKKyAg
ICBvYmplY3RfcHJvcGVydHlfc2V0X2ludChPQkpFQ1QoJnMtPmdjciksIGdjcl9iYXNlLCAiZ2Ny
LWJhc2UiLCBlcnJwKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2xpbmsoT0JKRUNUKCZzLT5n
Y3IpLCBPQkpFQ1QoJnMtPmdpYy5tciksICJnaWMiLCBlcnJwKTsKKyAgICBvYmplY3RfcHJvcGVy
dHlfc2V0X2xpbmsoT0JKRUNUKCZzLT5nY3IpLCBPQkpFQ1QoJnMtPmNwYy5tciksICJjcGMiLCBl
cnJwKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5nY3IpLCB0cnVl
LCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAgICBpZiAoKmVycnAgIT0gTlVMTCkgewogICAgICAgICBy
ZXR1cm47CiAgICAgfQogCmRpZmYgLS1naXQgYS9ody9taXNjL2FybTExc2N1LmMgYi9ody9taXNj
L2FybTExc2N1LmMKaW5kZXggMzAyMzI4NGQ2Zi4uYmVmYzg1ZjMyMSAxMDA2NDQKLS0tIGEvaHcv
bWlzYy9hcm0xMXNjdS5jCisrKyBiL2h3L21pc2MvYXJtMTFzY3UuYwpAQCAtNjMsNiArNjMsNyBA
QCBzdGF0aWMgY29uc3QgTWVtb3J5UmVnaW9uT3BzIG1wY29yZV9zY3Vfb3BzID0gewogCiBzdGF0
aWMgdm9pZCBhcm0xMV9zY3VfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnAp
CiB7CisJRVJSUF9GVU5DVElPTl9CRUdJTigpOwogfQogCiBzdGF0aWMgdm9pZCBhcm0xMV9zY3Vf
aW5pdChPYmplY3QgKm9iaikKZGlmZiAtLWdpdCBhL2h3L21pc2MvYmNtMjgzNV9tYm94LmMgYi9o
dy9taXNjL2JjbTI4MzVfbWJveC5jCmluZGV4IDc5YmFkMTE2MzEuLmFiNTlkODc0Y2IgMTAwNjQ0
Ci0tLSBhL2h3L21pc2MvYmNtMjgzNV9tYm94LmMKKysrIGIvaHcvbWlzYy9iY20yODM1X21ib3gu
YwpAQCAtMzAwLDEyICszMDAsMTEgQEAgc3RhdGljIHZvaWQgYmNtMjgzNV9tYm94X3JlYWxpemUo
RGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogewogICAgIEJDTTI4MzVNYm94U3RhdGUg
KnMgPSBCQ00yODM1X01CT1goZGV2KTsKICAgICBPYmplY3QgKm9iajsKLSAgICBFcnJvciAqZXJy
ID0gTlVMTDsKIAotICAgIG9iaiA9IG9iamVjdF9wcm9wZXJ0eV9nZXRfbGluayhPQkpFQ1QoZGV2
KSwgIm1ib3gtbXIiLCAmZXJyKTsKKyAgICBvYmogPSBvYmplY3RfcHJvcGVydHlfZ2V0X2xpbmso
T0JKRUNUKGRldiksICJtYm94LW1yIiwgZXJycCk7CiAgICAgaWYgKG9iaiA9PSBOVUxMKSB7CiAg
ICAgICAgIGVycm9yX3NldGcoZXJycCwgIiVzOiByZXF1aXJlZCBtYm94LW1yIGxpbmsgbm90IGZv
dW5kOiAlcyIsCi0gICAgICAgICAgICAgICAgICAgX19mdW5jX18sIGVycm9yX2dldF9wcmV0dHko
ZXJyKSk7CisgICAgICAgICAgICAgICAgICAgX19mdW5jX18sIGVycm9yX2dldF9wcmV0dHkoKmVy
cnApKTsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApkaWZmIC0tZ2l0IGEvaHcvbWlzYy9iY20y
ODM1X3Byb3BlcnR5LmMgYi9ody9taXNjL2JjbTI4MzVfcHJvcGVydHkuYwppbmRleCBkODZkNTEw
NTcyLi5lZWJkYTczYTk0IDEwMDY0NAotLS0gYS9ody9taXNjL2JjbTI4MzVfcHJvcGVydHkuYwor
KysgYi9ody9taXNjL2JjbTI4MzVfcHJvcGVydHkuYwpAQCAtMzg0LDIxICszODQsMjAgQEAgc3Rh
dGljIHZvaWQgYmNtMjgzNV9wcm9wZXJ0eV9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9y
ICoqZXJycCkKIHsKICAgICBCQ00yODM1UHJvcGVydHlTdGF0ZSAqcyA9IEJDTTI4MzVfUFJPUEVS
VFkoZGV2KTsKICAgICBPYmplY3QgKm9iajsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKIAotICAg
IG9iaiA9IG9iamVjdF9wcm9wZXJ0eV9nZXRfbGluayhPQkpFQ1QoZGV2KSwgImZiIiwgJmVycik7
CisgICAgb2JqID0gb2JqZWN0X3Byb3BlcnR5X2dldF9saW5rKE9CSkVDVChkZXYpLCAiZmIiLCBl
cnJwKTsKICAgICBpZiAob2JqID09IE5VTEwpIHsKICAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAi
JXM6IHJlcXVpcmVkIGZiIGxpbmsgbm90IGZvdW5kOiAlcyIsCi0gICAgICAgICAgICAgICAgICAg
X19mdW5jX18sIGVycm9yX2dldF9wcmV0dHkoZXJyKSk7CisgICAgICAgICAgICAgICAgICAgX19m
dW5jX18sIGVycm9yX2dldF9wcmV0dHkoKmVycnApKTsKICAgICAgICAgcmV0dXJuOwogICAgIH0K
IAogICAgIHMtPmZiZGV2ID0gQkNNMjgzNV9GQihvYmopOwogCi0gICAgb2JqID0gb2JqZWN0X3By
b3BlcnR5X2dldF9saW5rKE9CSkVDVChkZXYpLCAiZG1hLW1yIiwgJmVycik7CisgICAgb2JqID0g
b2JqZWN0X3Byb3BlcnR5X2dldF9saW5rKE9CSkVDVChkZXYpLCAiZG1hLW1yIiwgZXJycCk7CiAg
ICAgaWYgKG9iaiA9PSBOVUxMKSB7CiAgICAgICAgIGVycm9yX3NldGcoZXJycCwgIiVzOiByZXF1
aXJlZCBkbWEtbXIgbGluayBub3QgZm91bmQ6ICVzIiwKLSAgICAgICAgICAgICAgICAgICBfX2Z1
bmNfXywgZXJyb3JfZ2V0X3ByZXR0eShlcnIpKTsKKyAgICAgICAgICAgICAgICAgICBfX2Z1bmNf
XywgZXJyb3JfZ2V0X3ByZXR0eSgqZXJycCkpOwogICAgICAgICByZXR1cm47CiAgICAgfQogCmRp
ZmYgLS1naXQgYS9ody9taXNjL2l2c2htZW0uYyBiL2h3L21pc2MvaXZzaG1lbS5jCmluZGV4IDVl
M2IwNWVhZTAuLjEzNmE4ODc0ZWQgMTAwNjQ0Ci0tLSBhL2h3L21pc2MvaXZzaG1lbS5jCisrKyBi
L2h3L21pc2MvaXZzaG1lbS5jCkBAIC00NzgsNyArNDc4LDYgQEAgc3RhdGljIHZvaWQgc2V0dXBf
aW50ZXJydXB0KElWU2htZW1TdGF0ZSAqcywgaW50IHZlY3RvciwgRXJyb3IgKiplcnJwKQogICAg
IGJvb2wgd2l0aF9pcnFmZCA9IGt2bV9tc2lfdmlhX2lycWZkX2VuYWJsZWQoKSAmJgogICAgICAg
ICBpdnNobWVtX2hhc19mZWF0dXJlKHMsIElWU0hNRU1fTVNJKTsKICAgICBQQ0lEZXZpY2UgKnBk
ZXYgPSBQQ0lfREVWSUNFKHMpOwotICAgIEVycm9yICplcnIgPSBOVUxMOwogCiAgICAgSVZTSE1F
TV9EUFJJTlRGKCJzZXR0aW5nIHVwIGludGVycnVwdCBmb3IgdmVjdG9yOiAlZFxuIiwgdmVjdG9y
KTsKIApAQCAtNDg3LDkgKzQ4Niw4IEBAIHN0YXRpYyB2b2lkIHNldHVwX2ludGVycnVwdChJVlNo
bWVtU3RhdGUgKnMsIGludCB2ZWN0b3IsIEVycm9yICoqZXJycCkKICAgICAgICAgd2F0Y2hfdmVj
dG9yX25vdGlmaWVyKHMsIG4sIHZlY3Rvcik7CiAgICAgfSBlbHNlIGlmIChtc2l4X2VuYWJsZWQo
cGRldikpIHsKICAgICAgICAgSVZTSE1FTV9EUFJJTlRGKCJ3aXRoIGlycWZkXG4iKTsKLSAgICAg
ICAgaXZzaG1lbV9hZGRfa3ZtX21zaV92aXJxKHMsIHZlY3RvciwgJmVycik7Ci0gICAgICAgIGlm
IChlcnIpIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgICAg
ICBpdnNobWVtX2FkZF9rdm1fbXNpX3ZpcnEocywgdmVjdG9yLCBlcnJwKTsKKyAgICAgICAgaWYg
KCplcnJwKSB7CiAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgIH0KIApAQCAtNTA2LDcgKzUw
NCw2IEBAIHN0YXRpYyB2b2lkIHNldHVwX2ludGVycnVwdChJVlNobWVtU3RhdGUgKnMsIGludCB2
ZWN0b3IsIEVycm9yICoqZXJycCkKIAogc3RhdGljIHZvaWQgcHJvY2Vzc19tc2dfc2htZW0oSVZT
aG1lbVN0YXRlICpzLCBpbnQgZmQsIEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqbG9jYWxf
ZXJyID0gTlVMTDsKICAgICBzdHJ1Y3Qgc3RhdCBidWY7CiAgICAgc2l6ZV90IHNpemU7CiAKQEAg
LTUyNyw5ICs1MjQsOCBAQCBzdGF0aWMgdm9pZCBwcm9jZXNzX21zZ19zaG1lbShJVlNobWVtU3Rh
dGUgKnMsIGludCBmZCwgRXJyb3IgKiplcnJwKQogCiAgICAgLyogbW1hcCB0aGUgcmVnaW9uIGFu
ZCBtYXAgaW50byB0aGUgQkFSMiAqLwogICAgIG1lbW9yeV9yZWdpb25faW5pdF9yYW1fZnJvbV9m
ZCgmcy0+c2VydmVyX2JhcjIsIE9CSkVDVChzKSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIml2c2htZW0uYmFyMiIsIHNpemUsIHRydWUsIGZkLCAmbG9jYWxfZXJyKTsKLSAg
ICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9l
cnIpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaXZzaG1lbS5iYXIyIiwg
c2l6ZSwgdHJ1ZSwgZmQsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47
CiAgICAgfQogCkBAIC02NjIsMTMgKzY1OCwxMSBAQCBzdGF0aWMgaW50NjRfdCBpdnNobWVtX3Jl
Y3ZfbXNnKElWU2htZW1TdGF0ZSAqcywgaW50ICpwZmQsIEVycm9yICoqZXJycCkKIAogc3RhdGlj
IHZvaWQgaXZzaG1lbV9yZWN2X3NldHVwKElWU2htZW1TdGF0ZSAqcywgRXJyb3IgKiplcnJwKQog
ewotICAgIEVycm9yICplcnIgPSBOVUxMOwogICAgIGludDY0X3QgbXNnOwogICAgIGludCBmZDsK
IAotICAgIG1zZyA9IGl2c2htZW1fcmVjdl9tc2cocywgJmZkLCAmZXJyKTsKLSAgICBpZiAoZXJy
KSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgIG1zZyA9IGl2c2ht
ZW1fcmVjdl9tc2cocywgJmZkLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0
dXJuOwogICAgIH0KICAgICBpZiAobXNnICE9IElWU0hNRU1fUFJPVE9DT0xfVkVSU0lPTikgewpA
QCAtNjk0LDkgKzY4OCw4IEBAIHN0YXRpYyB2b2lkIGl2c2htZW1fcmVjdl9zZXR1cChJVlNobWVt
U3RhdGUgKnMsIEVycm9yICoqZXJycCkKICAgICAgKiBvbGRlciB2ZXJzaW9ucyBvZiB0aGUgZGV2
aWNlIGFjY2VwdGVkIGl0IG91dCBvZiBvcmRlciwgYnV0CiAgICAgICogYnJva2Ugd2hlbiBhbiBp
bnRlcnJ1cHQgc2V0dXAgbWVzc2FnZSBhcnJpdmVkIGJlZm9yZSBpdC4KICAgICAgKi8KLSAgICBt
c2cgPSBpdnNobWVtX3JlY3ZfbXNnKHMsICZmZCwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAg
ICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICBtc2cgPSBpdnNobWVtX3JlY3Zf
bXNnKHMsICZmZCwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAg
ICB9CiAgICAgaWYgKGZkICE9IC0xIHx8IG1zZyA8IDAgfHwgbXNnID4gSVZTSE1FTV9NQVhfUEVF
UlMpIHsKQEAgLTcwOSwxNCArNzAyLDEyIEBAIHN0YXRpYyB2b2lkIGl2c2htZW1fcmVjdl9zZXR1
cChJVlNobWVtU3RhdGUgKnMsIEVycm9yICoqZXJycCkKICAgICAgKiBSZWNlaXZlIG1vcmUgbWVz
c2FnZXMgdW50aWwgd2UgZ290IHNoYXJlZCBtZW1vcnkuCiAgICAgICovCiAgICAgZG8gewotICAg
ICAgICBtc2cgPSBpdnNobWVtX3JlY3ZfbXNnKHMsICZmZCwgJmVycik7Ci0gICAgICAgIGlmIChl
cnIpIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgICAgICBt
c2cgPSBpdnNobWVtX3JlY3ZfbXNnKHMsICZmZCwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkg
ewogICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9Ci0gICAgICAgIHByb2Nlc3NfbXNnKHMs
IG1zZywgZmQsICZlcnIpOwotICAgICAgICBpZiAoZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9w
cm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgcHJvY2Vzc19tc2cocywgbXNnLCBmZCwgZXJy
cCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9
CiAgICAgfSB3aGlsZSAobXNnICE9IC0xKTsKZGlmZiAtLWdpdCBhL2h3L21pc2MvbWFjaW8vbWFj
aW8uYyBiL2h3L21pc2MvbWFjaW8vbWFjaW8uYwppbmRleCA1MGYyMGQ4MjA2Li4yYmZkZmU2MmYz
IDEwMDY0NAotLS0gYS9ody9taXNjL21hY2lvL21hY2lvLmMKKysrIGIvaHcvbWlzYy9tYWNpby9t
YWNpby5jCkBAIC0xMDcsMTEgKzEwNyw5IEBAIHN0YXRpYyB2b2lkIG1hY2lvX2NvbW1vbl9yZWFs
aXplKFBDSURldmljZSAqZCwgRXJyb3IgKiplcnJwKQogewogICAgIE1hY0lPU3RhdGUgKnMgPSBN
QUNJTyhkKTsKICAgICBTeXNCdXNEZXZpY2UgKnN5c2J1c19kZXY7Ci0gICAgRXJyb3IgKmVyciA9
IE5VTEw7CiAKLSAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5kYmRtYSks
IHRydWUsICJyZWFsaXplZCIsICZlcnIpOwotICAgIGlmIChlcnIpIHsKLSAgICAgICAgZXJyb3Jf
cHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVD
VCgmcy0+ZGJkbWEpLCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsK
ICAgICAgICAgcmV0dXJuOwogICAgIH0KICAgICBzeXNidXNfZGV2ID0gU1lTX0JVU19ERVZJQ0Uo
JnMtPmRiZG1hKTsKQEAgLTEyNSw5ICsxMjMsOCBAQCBzdGF0aWMgdm9pZCBtYWNpb19jb21tb25f
cmVhbGl6ZShQQ0lEZXZpY2UgKmQsIEVycm9yICoqZXJycCkKICAgICBxZGV2X3Byb3Bfc2V0X2No
cihERVZJQ0UoJnMtPmVzY2MpLCAiY2hyQiIsIHNlcmlhbF9oZCgxKSk7CiAgICAgcWRldl9wcm9w
X3NldF91aW50MzIoREVWSUNFKCZzLT5lc2NjKSwgImNobkJ0eXBlIiwgZXNjY19zZXJpYWwpOwog
ICAgIHFkZXZfcHJvcF9zZXRfdWludDMyKERFVklDRSgmcy0+ZXNjYyksICJjaG5BdHlwZSIsIGVz
Y2Nfc2VyaWFsKTsKLSAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5lc2Nj
KSwgdHJ1ZSwgInJlYWxpemVkIiwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBlcnJv
cl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JK
RUNUKCZzLT5lc2NjKSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7
CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKQEAgLTE1NiwyMCArMTUzLDE3IEBAIHN0YXRpYyB2
b2lkIG1hY2lvX29sZHdvcmxkX3JlYWxpemUoUENJRGV2aWNlICpkLCBFcnJvciAqKmVycnApCiAg
ICAgTWFjSU9TdGF0ZSAqcyA9IE1BQ0lPKGQpOwogICAgIE9sZFdvcmxkTWFjSU9TdGF0ZSAqb3Mg
PSBPTERXT1JMRF9NQUNJTyhkKTsKICAgICBEZXZpY2VTdGF0ZSAqcGljX2RldiA9IERFVklDRShv
cy0+cGljKTsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKICAgICBTeXNCdXNEZXZpY2UgKnN5c2J1
c19kZXY7CiAKLSAgICBtYWNpb19jb21tb25fcmVhbGl6ZShkLCAmZXJyKTsKLSAgICBpZiAoZXJy
KSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgIG1hY2lvX2NvbW1v
bl9yZWFsaXplKGQsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAg
ICAgfQogCiAgICAgcWRldl9wcm9wX3NldF91aW50NjQoREVWSUNFKCZzLT5jdWRhKSwgInRpbWVi
YXNlLWZyZXF1ZW5jeSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgcy0+ZnJlcXVlbmN5KTsK
LSAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5jdWRhKSwgdHJ1ZSwgInJl
YWxpemVkIiwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUo
ZXJycCwgZXJyKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5jdWRh
KSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJl
dHVybjsKICAgICB9CiAgICAgc3lzYnVzX2RldiA9IFNZU19CVVNfREVWSUNFKCZzLT5jdWRhKTsK
QEAgLTE4NCw5ICsxNzgsOCBAQCBzdGF0aWMgdm9pZCBtYWNpb19vbGR3b3JsZF9yZWFsaXplKFBD
SURldmljZSAqZCwgRXJyb3IgKiplcnJwKQogICAgIHN5c2J1c19jb25uZWN0X2lycShzeXNidXNf
ZGV2LCAxLCBxZGV2X2dldF9ncGlvX2luKHBpY19kZXYsCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT0xEV09STERfRVNDQ0FfSVJRKSk7CiAK
LSAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZvcy0+bnZyYW0pLCB0cnVlLCAi
cmVhbGl6ZWQiLCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0
ZShlcnJwLCBlcnIpOworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJm9zLT5u
dnJhbSksIHRydWUsICJyZWFsaXplZCIsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAg
ICByZXR1cm47CiAgICAgfQogICAgIHN5c2J1c19kZXYgPSBTWVNfQlVTX0RFVklDRSgmb3MtPm52
cmFtKTsKQEAgLTIwMywxOCArMTk2LDE2IEBAIHN0YXRpYyB2b2lkIG1hY2lvX29sZHdvcmxkX3Jl
YWxpemUoUENJRGV2aWNlICpkLCBFcnJvciAqKmVycnApCiAgICAgbWFjaW9fcmVhbGl6ZV9pZGUo
cywgJm9zLT5pZGVbMF0sCiAgICAgICAgICAgICAgICAgICAgICAgcWRldl9nZXRfZ3Bpb19pbihw
aWNfZGV2LCBPTERXT1JMRF9JREUwX0lSUSksCiAgICAgICAgICAgICAgICAgICAgICAgcWRldl9n
ZXRfZ3Bpb19pbihwaWNfZGV2LCBPTERXT1JMRF9JREUwX0RNQV9JUlEpLAotICAgICAgICAgICAg
ICAgICAgICAgIDB4MTYsICZlcnIpOwotICAgIGlmIChlcnIpIHsKLSAgICAgICAgZXJyb3JfcHJv
cGFnYXRlKGVycnAsIGVycik7CisgICAgICAgICAgICAgICAgICAgICAgMHgxNiwgZXJycCk7Cisg
ICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKICAgICBtYWNpb19yZWFs
aXplX2lkZShzLCAmb3MtPmlkZVsxXSwKICAgICAgICAgICAgICAgICAgICAgICBxZGV2X2dldF9n
cGlvX2luKHBpY19kZXYsIE9MRFdPUkxEX0lERTFfSVJRKSwKICAgICAgICAgICAgICAgICAgICAg
ICBxZGV2X2dldF9ncGlvX2luKHBpY19kZXYsIE9MRFdPUkxEX0lERTFfRE1BX0lSUSksCi0gICAg
ICAgICAgICAgICAgICAgICAgMHgxYSwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBl
cnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAweDFhLCBl
cnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIH0KQEAgLTI5
NCwxMyArMjg1LDExIEBAIHN0YXRpYyB2b2lkIG1hY2lvX25ld3dvcmxkX3JlYWxpemUoUENJRGV2
aWNlICpkLCBFcnJvciAqKmVycnApCiAgICAgTWFjSU9TdGF0ZSAqcyA9IE1BQ0lPKGQpOwogICAg
IE5ld1dvcmxkTWFjSU9TdGF0ZSAqbnMgPSBORVdXT1JMRF9NQUNJTyhkKTsKICAgICBEZXZpY2VT
dGF0ZSAqcGljX2RldiA9IERFVklDRShucy0+cGljKTsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsK
ICAgICBTeXNCdXNEZXZpY2UgKnN5c2J1c19kZXY7CiAgICAgTWVtb3J5UmVnaW9uICp0aW1lcl9t
ZW1vcnkgPSBOVUxMOwogCi0gICAgbWFjaW9fY29tbW9uX3JlYWxpemUoZCwgJmVycik7Ci0gICAg
aWYgKGVycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICBtYWNp
b19jb21tb25fcmVhbGl6ZShkLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0
dXJuOwogICAgIH0KIApAQCAtMzE5LDE4ICszMDgsMTYgQEAgc3RhdGljIHZvaWQgbWFjaW9fbmV3
d29ybGRfcmVhbGl6ZShQQ0lEZXZpY2UgKmQsIEVycm9yICoqZXJycCkKICAgICBtYWNpb19yZWFs
aXplX2lkZShzLCAmbnMtPmlkZVswXSwKICAgICAgICAgICAgICAgICAgICAgICBxZGV2X2dldF9n
cGlvX2luKHBpY19kZXYsIE5FV1dPUkxEX0lERTBfSVJRKSwKICAgICAgICAgICAgICAgICAgICAg
ICBxZGV2X2dldF9ncGlvX2luKHBpY19kZXYsIE5FV1dPUkxEX0lERTBfRE1BX0lSUSksCi0gICAg
ICAgICAgICAgICAgICAgICAgMHgxNiwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBl
cnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAweDE2LCBl
cnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIAogICAgIG1h
Y2lvX3JlYWxpemVfaWRlKHMsICZucy0+aWRlWzFdLAogICAgICAgICAgICAgICAgICAgICAgIHFk
ZXZfZ2V0X2dwaW9faW4ocGljX2RldiwgTkVXV09STERfSURFMV9JUlEpLAogICAgICAgICAgICAg
ICAgICAgICAgIHFkZXZfZ2V0X2dwaW9faW4ocGljX2RldiwgTkVXV09STERfSURFMV9ETUFfSVJR
KSwKLSAgICAgICAgICAgICAgICAgICAgICAweDFhLCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7Ci0g
ICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgICAgICAgICAgICAgICAgICAg
IDB4MWEsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQog
CkBAIC0zNDcsNyArMzM0LDcgQEAgc3RhdGljIHZvaWQgbWFjaW9fbmV3d29ybGRfcmVhbGl6ZShQ
Q0lEZXZpY2UgKmQsIEVycm9yICoqZXJycCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICZlcnJvcl9hYm9ydCk7CiAgICAgICAgIG1lbW9yeV9yZWdpb25fYWRkX3N1YnJlZ2lvbigm
cy0+YmFyLCAweDUwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3lzYnVz
X21taW9fZ2V0X3JlZ2lvbihzeXNidXNfZGV2LCAwKSk7Ci0gICAgICAgIG9iamVjdF9wcm9wZXJ0
eV9zZXRfYm9vbChPQkpFQ1QoJm5zLT5ncGlvKSwgdHJ1ZSwgInJlYWxpemVkIiwgJmVycik7Cisg
ICAgICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJm5zLT5ncGlvKSwgdHJ1ZSwg
InJlYWxpemVkIiwgZXJycCk7CiAKICAgICAgICAgLyogUE1VICovCiAgICAgICAgIG9iamVjdF9p
bml0aWFsaXplX2NoaWxkKE9CSkVDVChzKSwgInBtdSIsICZzLT5wbXUsIHNpemVvZihzLT5wbXUp
LApAQCAtMzU3LDkgKzM0NCw4IEBAIHN0YXRpYyB2b2lkIG1hY2lvX25ld3dvcmxkX3JlYWxpemUo
UENJRGV2aWNlICpkLCBFcnJvciAqKmVycnApCiAgICAgICAgIHFkZXZfcHJvcF9zZXRfYml0KERF
VklDRSgmcy0+cG11KSwgImhhcy1hZGIiLCBucy0+aGFzX2FkYik7CiAgICAgICAgIHFkZXZfc2V0
X3BhcmVudF9idXMoREVWSUNFKCZzLT5wbXUpLCBCVVMoJnMtPm1hY2lvX2J1cykpOwogCi0gICAg
ICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJnMtPnBtdSksIHRydWUsICJyZWFs
aXplZCIsICZlcnIpOwotICAgICAgICBpZiAoZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9w
YWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVD
VCgmcy0+cG11KSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkg
ewogICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgICAgIHN5c2J1c19kZXYgPSBT
WVNfQlVTX0RFVklDRSgmcy0+cG11KTsKQEAgLTM3NSw5ICszNjEsOCBAQCBzdGF0aWMgdm9pZCBt
YWNpb19uZXd3b3JsZF9yZWFsaXplKFBDSURldmljZSAqZCwgRXJyb3IgKiplcnJwKQogICAgICAg
ICBxZGV2X3Byb3Bfc2V0X3VpbnQ2NChERVZJQ0UoJnMtPmN1ZGEpLCAidGltZWJhc2UtZnJlcXVl
bmN5IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcy0+ZnJlcXVlbmN5KTsKIAotICAg
ICAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5jdWRhKSwgdHJ1ZSwgInJl
YWxpemVkIiwgJmVycik7Ci0gICAgICAgIGlmIChlcnIpIHsKLSAgICAgICAgICAgIGVycm9yX3By
b3BhZ2F0ZShlcnJwLCBlcnIpOworICAgICAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JK
RUNUKCZzLT5jdWRhKSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgICAgIGlmICgqZXJy
cCkgewogICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgICAgIHN5c2J1c19kZXYg
PSBTWVNfQlVTX0RFVklDRSgmcy0+Y3VkYSk7CmRpZmYgLS1naXQgYS9ody9taXNjL21wczItc2Nj
LmMgYi9ody9taXNjL21wczItc2NjLmMKaW5kZXggMjU3NzlhMWRjYS4uZjJhMDBkMzIzNSAxMDA2
NDQKLS0tIGEvaHcvbWlzYy9tcHMyLXNjYy5jCisrKyBiL2h3L21pc2MvbXBzMi1zY2MuYwpAQCAt
MjQ5LDYgKzI0OSw3IEBAIHN0YXRpYyB2b2lkIG1wczJfc2NjX2luaXQoT2JqZWN0ICpvYmopCiAK
IHN0YXRpYyB2b2lkIG1wczJfc2NjX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKipl
cnJwKQogeworCUVSUlBfRlVOQ1RJT05fQkVHSU4oKTsKIH0KIAogc3RhdGljIGNvbnN0IFZNU3Rh
dGVEZXNjcmlwdGlvbiBtcHMyX3NjY192bXN0YXRlID0gewpkaWZmIC0tZ2l0IGEvaHcvbWlzYy90
bXAxMDUuYyBiL2h3L21pc2MvdG1wMTA1LmMKaW5kZXggNzVkZGFkM2ExMi4uNDgwZWFlMjNkZCAx
MDA2NDQKLS0tIGEvaHcvbWlzYy90bXAxMDUuYworKysgYi9ody9taXNjL3RtcDEwNS5jCkBAIC03
MiwxMiArNzIsMTAgQEAgc3RhdGljIHZvaWQgdG1wMTA1X3NldF90ZW1wZXJhdHVyZShPYmplY3Qg
Km9iaiwgVmlzaXRvciAqdiwgY29uc3QgY2hhciAqbmFtZSwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgdm9pZCAqb3BhcXVlLCBFcnJvciAqKmVycnApCiB7CiAgICAgVE1QMTA1
U3RhdGUgKnMgPSBUTVAxMDUob2JqKTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAg
ICBpbnQ2NF90IHRlbXA7CiAKLSAgICB2aXNpdF90eXBlX2ludCh2LCBuYW1lLCAmdGVtcCwgJmxv
Y2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUo
ZXJycCwgbG9jYWxfZXJyKTsKKyAgICB2aXNpdF90eXBlX2ludCh2LCBuYW1lLCAmdGVtcCwgZXJy
cCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAgICAgaWYgKHRl
bXAgPj0gMTI4MDAwIHx8IHRlbXAgPCAtMTI4MDAwKSB7CmRpZmYgLS1naXQgYS9ody9taXNjL3Rt
cDQyMS5jIGIvaHcvbWlzYy90bXA0MjEuYwppbmRleCA5ZjA0NDcwNWZhLi5jZGI0MjM3OWM0IDEw
MDY0NAotLS0gYS9ody9taXNjL3RtcDQyMS5jCisrKyBiL2h3L21pc2MvdG1wNDIxLmMKQEAgLTE0
MSwxNSArMTQxLDEzIEBAIHN0YXRpYyB2b2lkIHRtcDQyMV9zZXRfdGVtcGVyYXR1cmUoT2JqZWN0
ICpvYmosIFZpc2l0b3IgKnYsIGNvbnN0IGNoYXIgKm5hbWUsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHZvaWQgKm9wYXF1ZSwgRXJyb3IgKiplcnJwKQogewogICAgIFRNUDQy
MVN0YXRlICpzID0gVE1QNDIxKG9iaik7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAg
ICAgaW50NjRfdCB0ZW1wOwogICAgIGJvb2wgZXh0X3JhbmdlID0gKHMtPmNvbmZpZ1swXSAmIFRN
UDQyMV9DT05GSUdfUkFOR0UpOwogICAgIGludCBvZmZzZXQgPSBleHRfcmFuZ2UgKiA2NCAqIDI1
NjsKICAgICBpbnQgdGVtcGlkOwogCi0gICAgdmlzaXRfdHlwZV9pbnQodiwgbmFtZSwgJnRlbXAs
ICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFn
YXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgdmlzaXRfdHlwZV9pbnQodiwgbmFtZSwgJnRlbXAs
IGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCmRpZmYg
LS1naXQgYS9ody9uZXQvZHA4MzkzeC5jIGIvaHcvbmV0L2RwODM5M3guYwppbmRleCBhNTY3OGUx
MWZhLi45YzRjZDM5MDgzIDEwMDY0NAotLS0gYS9ody9uZXQvZHA4MzkzeC5jCisrKyBiL2h3L25l
dC9kcDgzOTN4LmMKQEAgLTg3Nyw3ICs4NzcsNiBAQCBzdGF0aWMgdm9pZCBkcDgzOTN4X3JlYWxp
emUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogICAgIGRwODM5M3hTdGF0ZSAqcyA9
IERQODM5M1goZGV2KTsKICAgICBpbnQgaSwgY2hlY2tzdW07CiAgICAgdWludDhfdCAqcHJvbTsK
LSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAogICAgIGFkZHJlc3Nfc3BhY2VfaW5pdCgm
cy0+YXMsIHMtPmRtYV9tciwgImRwODM5M3giKTsKICAgICBtZW1vcnlfcmVnaW9uX2luaXRfaW8o
JnMtPm1taW8sIE9CSkVDVChkZXYpLCAmZHA4MzkzeF9vcHMsIHMsCkBAIC04OTEsOSArODkwLDgg
QEAgc3RhdGljIHZvaWQgZHA4MzkzeF9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoq
ZXJycCkKICAgICBzLT5yZWdzW1NPTklDX1NSXSA9IDB4MDAwNDsgLyogb25seSByZXZpc2lvbiBy
ZWNvZ25pemVkIGJ5IExpbnV4ICovCiAKICAgICBtZW1vcnlfcmVnaW9uX2luaXRfcmFtKCZzLT5w
cm9tLCBPQkpFQ1QoZGV2KSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICJkcDgzOTN4LXBy
b20iLCBTT05JQ19QUk9NX1NJWkUsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsK
LSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAiZHA4MzkzeC1wcm9tIiwgU09OSUNfUFJPTV9TSVpFLCBlcnJwKTsKKyAg
ICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KICAgICBtZW1vcnlfcmVnaW9u
X3NldF9yZWFkb25seSgmcy0+cHJvbSwgdHJ1ZSk7CmRpZmYgLS1naXQgYS9ody9uZXQvZWVwcm8x
MDAuYyBiL2h3L25ldC9lZXBybzEwMC5jCmluZGV4IGNjMmRkOGIxYzkuLjYxNjA4M2I2NjIgMTAw
NjQ0Ci0tLSBhL2h3L25ldC9lZXBybzEwMC5jCisrKyBiL2h3L25ldC9lZXBybzEwMC5jCkBAIC0x
ODMxLDE1ICsxODMxLDEzIEBAIHN0YXRpYyB2b2lkIGUxMDBfbmljX3JlYWxpemUoUENJRGV2aWNl
ICpwY2lfZGV2LCBFcnJvciAqKmVycnApCiB7CiAgICAgRUVQUk8xMDBTdGF0ZSAqcyA9IERPX1VQ
Q0FTVChFRVBSTzEwMFN0YXRlLCBkZXYsIHBjaV9kZXYpOwogICAgIEUxMDBQQ0lEZXZpY2VJbmZv
ICppbmZvID0gZWVwcm8xMDBfZ2V0X2NsYXNzKHMpOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBO
VUxMOwogCiAgICAgVFJBQ0UoT1RIRVIsIGxvZ291dCgiXG4iKSk7CiAKICAgICBzLT5kZXZpY2Ug
PSBpbmZvLT5kZXZpY2U7CiAKLSAgICBlMTAwX3BjaV9yZXNldChzLCAmbG9jYWxfZXJyKTsKLSAg
ICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9l
cnIpOworICAgIGUxMDBfcGNpX3Jlc2V0KHMsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAg
ICAgICByZXR1cm47CiAgICAgfQogCmRpZmYgLS1naXQgYS9ody9uZXQvbmUyMDAwLWlzYS5jIGIv
aHcvbmV0L25lMjAwMC1pc2EuYwppbmRleCA2ZmNmM2Q1Y2Q5Li40M2E2ZWU3ZjNkIDEwMDY0NAot
LS0gYS9ody9uZXQvbmUyMDAwLWlzYS5jCisrKyBiL2h3L25ldC9uZTIwMDAtaXNhLmMKQEAgLTEx
MSwyMiArMTExLDE4IEBAIHN0YXRpYyB2b2lkIGlzYV9uZTIwMDBfc2V0X2Jvb3RpbmRleChPYmpl
Y3QgKm9iaiwgVmlzaXRvciAqdiwKICAgICBJU0FORTIwMDBTdGF0ZSAqaXNhID0gSVNBX05FMjAw
MChvYmopOwogICAgIE5FMjAwMFN0YXRlICpzID0gJmlzYS0+bmUyMDAwOwogICAgIGludDMyX3Qg
Ym9vdF9pbmRleDsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAotICAgIHZpc2l0X3R5
cGVfaW50MzIodiwgbmFtZSwgJmJvb3RfaW5kZXgsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2Nh
bF9lcnIpIHsKLSAgICAgICAgZ290byBvdXQ7CisgICAgdmlzaXRfdHlwZV9pbnQzMih2LCBuYW1l
LCAmYm9vdF9pbmRleCwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CisgICAgICAgIHJldHVybjsK
ICAgICB9CiAgICAgLyogY2hlY2sgd2hldGhlciBib290aW5kZXggaXMgcHJlc2VudCBpbiBmd19i
b290X29yZGVyIGxpc3QgICovCi0gICAgY2hlY2tfYm9vdF9pbmRleChib290X2luZGV4LCAmbG9j
YWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGdvdG8gb3V0OworICAgIGNo
ZWNrX2Jvb3RfaW5kZXgoYm9vdF9pbmRleCwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CisgICAg
ICAgIHJldHVybjsKICAgICB9CiAgICAgLyogY2hhbmdlIGJvb3RpbmRleCB0byBhIG5ldyBvbmUg
Ki8KICAgICBzLT5jLmJvb3RpbmRleCA9IGJvb3RfaW5kZXg7Ci0KLW91dDoKLSAgICBlcnJvcl9w
cm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKIH0KIAogc3RhdGljIHZvaWQgaXNhX25lMjAwMF9p
bnN0YW5jZV9pbml0KE9iamVjdCAqb2JqKQpkaWZmIC0tZ2l0IGEvaHcvbmV0L3hpbGlueF9heGll
bmV0LmMgYi9ody9uZXQveGlsaW54X2F4aWVuZXQuYwppbmRleCAyYzhjMDY1NDAxLi41Zjg3YTYz
MzZiIDEwMDY0NAotLS0gYS9ody9uZXQveGlsaW54X2F4aWVuZXQuYworKysgYi9ody9uZXQveGls
aW54X2F4aWVuZXQuYwpAQCAtOTUxLDI0ICs5NTEsMjMgQEAgc3RhdGljIHZvaWQgeGlsaW54X2Vu
ZXRfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgWGlsaW54QVhJ
RW5ldFN0cmVhbVNsYXZlICpkcyA9IFhJTElOWF9BWElfRU5FVF9EQVRBX1NUUkVBTSgmcy0+cnhf
ZGF0YV9kZXYpOwogICAgIFhpbGlueEFYSUVuZXRTdHJlYW1TbGF2ZSAqY3MgPSBYSUxJTlhfQVhJ
X0VORVRfQ09OVFJPTF9TVFJFQU0oCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAmcy0+cnhfY29udHJvbF9kZXYpOwotICAgIEVycm9y
ICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgb2JqZWN0X3Byb3BlcnR5X2FkZF9saW5rKE9CSkVD
VChkcyksICJlbmV0IiwgInhsbnguYXhpLWV0aGVybmV0IiwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgKE9iamVjdCAqKikgJmRzLT5lbmV0LAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBvYmplY3RfcHJvcGVydHlfYWxsb3dfc2V0X2xpbmssCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIE9CSl9QUk9QX0xJTktfU1RST05HLAotICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAmbG9jYWxfZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJycCk7CiAg
ICAgb2JqZWN0X3Byb3BlcnR5X2FkZF9saW5rKE9CSkVDVChjcyksICJlbmV0IiwgInhsbnguYXhp
LWV0aGVybmV0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKE9iamVjdCAqKikgJmNz
LT5lbmV0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmplY3RfcHJvcGVydHlfYWxs
b3dfc2V0X2xpbmssCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9CSl9QUk9QX0xJTktf
U1RST05HLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmbG9jYWxfZXJyKTsKLSAgICBp
ZiAobG9jYWxfZXJyKSB7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycnApOworICAg
IGlmICgqZXJycCkgewogICAgICAgICBnb3RvIHhpbGlueF9lbmV0X3JlYWxpemVfZmFpbDsKICAg
ICB9Ci0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9saW5rKE9CSkVDVChkcyksIE9CSkVDVChzKSwg
ImVuZXQiLCAmbG9jYWxfZXJyKTsKLSAgICBvYmplY3RfcHJvcGVydHlfc2V0X2xpbmsoT0JKRUNU
KGNzKSwgT0JKRUNUKHMpLCAiZW5ldCIsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIp
IHsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2xpbmsoT0JKRUNUKGRzKSwgT0JKRUNUKHMpLCAi
ZW5ldCIsIGVycnApOworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfbGluayhPQkpFQ1QoY3MpLCBP
QkpFQ1QocyksICJlbmV0IiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8g
eGlsaW54X2VuZXRfcmVhbGl6ZV9mYWlsOwogICAgIH0KIApAQCAtOTg2LDcgKzk4NSw2IEBAIHN0
YXRpYyB2b2lkIHhpbGlueF9lbmV0X3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKipl
cnJwKQogICAgIHJldHVybjsKIAogeGlsaW54X2VuZXRfcmVhbGl6ZV9mYWlsOgotICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogfQogCiBzdGF0aWMgdm9pZCB4aWxpbnhfZW5l
dF9pbml0KE9iamVjdCAqb2JqKQpkaWZmIC0tZ2l0IGEvaHcvbnZyYW0vZndfY2ZnLmMgYi9ody9u
dnJhbS9md19jZmcuYwppbmRleCA3ZGMzYWMzNzhlLi42ZjRkMTAyY2YzIDEwMDY0NAotLS0gYS9o
dy9udnJhbS9md19jZmcuYworKysgYi9ody9udnJhbS9md19jZmcuYwpAQCAtMTEwNSwxMSArMTEw
NSw5IEBAIHN0YXRpYyBQcm9wZXJ0eSBmd19jZmdfaW9fcHJvcGVydGllc1tdID0gewogc3RhdGlj
IHZvaWQgZndfY2ZnX2lvX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQog
ewogICAgIEZXQ2ZnSW9TdGF0ZSAqcyA9IEZXX0NGR19JTyhkZXYpOwotICAgIEVycm9yICpsb2Nh
bF9lcnIgPSBOVUxMOwogCi0gICAgZndfY2ZnX2ZpbGVfc2xvdHNfYWxsb2NhdGUoRldfQ0ZHKHMp
LCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3Bh
Z2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIGZ3X2NmZ19maWxlX3Nsb3RzX2FsbG9jYXRlKEZX
X0NGRyhzKSwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9
CiAKQEAgLTExNTgsMTEgKzExNTYsOSBAQCBzdGF0aWMgdm9pZCBmd19jZmdfbWVtX3JlYWxpemUo
RGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogICAgIEZXQ2ZnTWVtU3RhdGUgKnMgPSBG
V19DRkdfTUVNKGRldik7CiAgICAgU3lzQnVzRGV2aWNlICpzYmQgPSBTWVNfQlVTX0RFVklDRShk
ZXYpOwogICAgIGNvbnN0IE1lbW9yeVJlZ2lvbk9wcyAqZGF0YV9vcHMgPSAmZndfY2ZnX2RhdGFf
bWVtX29wczsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAotICAgIGZ3X2NmZ19maWxl
X3Nsb3RzX2FsbG9jYXRlKEZXX0NGRyhzKSwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2Vy
cikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBmd19j
ZmdfZmlsZV9zbG90c19hbGxvY2F0ZShGV19DRkcocyksIGVycnApOworICAgIGlmICgqZXJycCkg
ewogICAgICAgICByZXR1cm47CiAgICAgfQogCmRpZmYgLS1naXQgYS9ody9udnJhbS9ucmY1MV9u
dm0uYyBiL2h3L252cmFtL25yZjUxX252bS5jCmluZGV4IDRkNjc4Zjk5NGUuLjM5NmY3MmIyYjAg
MTAwNjQ0Ci0tLSBhL2h3L252cmFtL25yZjUxX252bS5jCisrKyBiL2h3L252cmFtL25yZjUxX252
bS5jCkBAIC0zMjcsMTIgKzMyNywxMCBAQCBzdGF0aWMgdm9pZCBucmY1MV9udm1faW5pdChPYmpl
Y3QgKm9iaikKIHN0YXRpYyB2b2lkIG5yZjUxX252bV9yZWFsaXplKERldmljZVN0YXRlICpkZXYs
IEVycm9yICoqZXJycCkKIHsKICAgICBOUkY1MU5WTVN0YXRlICpzID0gTlJGNTFfTlZNKGRldik7
Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7CiAKICAgICBtZW1vcnlfcmVnaW9uX2luaXRfcm9tX2Rl
dmljZSgmcy0+Zmxhc2gsIE9CSkVDVChkZXYpLCAmZmxhc2hfb3BzLCBzLAotICAgICAgICAibnJm
NTFfc29jLmZsYXNoIiwgcy0+Zmxhc2hfc2l6ZSwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAg
ICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgIm5yZjUxX3NvYy5mbGFz
aCIsIHMtPmZsYXNoX3NpemUsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1
cm47CiAgICAgfQogCmRpZmYgLS1naXQgYS9ody9wY2ktYnJpZGdlL2RlYy5jIGIvaHcvcGNpLWJy
aWRnZS9kZWMuYwppbmRleCAzYWUyZjc4OGE0Li5mYmU3ODE0NzRlIDEwMDY0NAotLS0gYS9ody9w
Y2ktYnJpZGdlL2RlYy5jCisrKyBiL2h3L3BjaS1icmlkZ2UvZGVjLmMKQEAgLTExNiw2ICsxMTYs
NyBAQCBzdGF0aWMgdm9pZCBwY2lfZGVjXzIxMTU0X2RldmljZV9yZWFsaXplKERldmljZVN0YXRl
ICpkZXYsIEVycm9yICoqZXJycCkKIAogc3RhdGljIHZvaWQgZGVjXzIxMTU0X3BjaV9ob3N0X3Jl
YWxpemUoUENJRGV2aWNlICpkLCBFcnJvciAqKmVycnApCiB7CisJRVJSUF9GVU5DVElPTl9CRUdJ
TigpOwogICAgIC8qIFBDSTJQQ0kgYnJpZGdlIHNhbWUgdmFsdWVzIGFzIFBlYXJQQyAtIGNoZWNr
IHRoaXMgKi8KIH0KIApkaWZmIC0tZ2l0IGEvaHcvcGNpLWJyaWRnZS9nZW5fcGNpZV9yb290X3Bv
cnQuYyBiL2h3L3BjaS1icmlkZ2UvZ2VuX3BjaWVfcm9vdF9wb3J0LmMKaW5kZXggOWVhZWZlYmNh
OC4uYmZiMjg4Y2NmNyAxMDA2NDQKLS0tIGEvaHcvcGNpLWJyaWRnZS9nZW5fcGNpZV9yb290X3Bv
cnQuYworKysgYi9ody9wY2ktYnJpZGdlL2dlbl9wY2llX3Jvb3RfcG9ydC5jCkBAIC03NiwxMSAr
NzYsOSBAQCBzdGF0aWMgdm9pZCBnZW5fcnBfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJv
ciAqKmVycnApCiAgICAgUENJRGV2aWNlICpkID0gUENJX0RFVklDRShkZXYpOwogICAgIEdlblBD
SUVSb290UG9ydCAqZ3JwID0gR0VOX1BDSUVfUk9PVF9QT1JUKGQpOwogICAgIFBDSUVSb290UG9y
dENsYXNzICpycGMgPSBQQ0lFX1JPT1RfUE9SVF9HRVRfQ0xBU1MoZCk7Ci0gICAgRXJyb3IgKmxv
Y2FsX2VyciA9IE5VTEw7CiAKLSAgICBycGMtPnBhcmVudF9yZWFsaXplKGRldiwgJmxvY2FsX2Vy
cik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwg
bG9jYWxfZXJyKTsKKyAgICBycGMtPnBhcmVudF9yZWFsaXplKGRldiwgZXJycCk7CisgICAgaWYg
KCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKZGlmZiAtLWdpdCBhL2h3L3BjaS1i
cmlkZ2UvcGNpX2JyaWRnZV9kZXYuYyBiL2h3L3BjaS1icmlkZ2UvcGNpX2JyaWRnZV9kZXYuYwpp
bmRleCBjYzgwY2I0ODk4Li4wMDY5MzIyYTNhIDEwMDY0NAotLS0gYS9ody9wY2ktYnJpZGdlL3Bj
aV9icmlkZ2VfZGV2LmMKKysrIGIvaHcvcGNpLWJyaWRnZS9wY2lfYnJpZGdlX2Rldi5jCkBAIC01
OSw3ICs1OSw2IEBAIHN0YXRpYyB2b2lkIHBjaV9icmlkZ2VfZGV2X3JlYWxpemUoUENJRGV2aWNl
ICpkZXYsIEVycm9yICoqZXJycCkKICAgICBQQ0lCcmlkZ2UgKmJyID0gUENJX0JSSURHRShkZXYp
OwogICAgIFBDSUJyaWRnZURldiAqYnJpZGdlX2RldiA9IFBDSV9CUklER0VfREVWKGRldik7CiAg
ICAgaW50IGVycjsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAogICAgIHBjaV9icmlk
Z2VfaW5pdGZuKGRldiwgVFlQRV9QQ0lfQlVTKTsKIApAQCAtODQsMjAgKzgzLDE5IEBAIHN0YXRp
YyB2b2lkIHBjaV9icmlkZ2VfZGV2X3JlYWxpemUoUENJRGV2aWNlICpkZXYsIEVycm9yICoqZXJy
cCkKICAgICBpZiAoYnJpZGdlX2Rldi0+bXNpICE9IE9OX09GRl9BVVRPX09GRikgewogICAgICAg
ICAvKiBpdCBtZWFucyBTSFBDIGV4aXN0cywgYmVjYXVzZSBNU0kgaXMgbmVlZGVkIGJ5IFNIUEMg
Ki8KIAotICAgICAgICBlcnIgPSBtc2lfaW5pdChkZXYsIDAsIDEsIHRydWUsIHRydWUsICZsb2Nh
bF9lcnIpOworICAgICAgICBlcnIgPSBtc2lfaW5pdChkZXYsIDAsIDEsIHRydWUsIHRydWUsIGVy
cnApOwogICAgICAgICAvKiBBbnkgZXJyb3Igb3RoZXIgdGhhbiAtRU5PVFNVUChib2FyZCdzIE1T
SSBzdXBwb3J0IGlzIGJyb2tlbikKICAgICAgICAgICogaXMgYSBwcm9ncmFtbWluZyBlcnJvciAq
LwogICAgICAgICBhc3NlcnQoIWVyciB8fCBlcnIgPT0gLUVOT1RTVVApOwogICAgICAgICBpZiAo
ZXJyICYmIGJyaWRnZV9kZXYtPm1zaSA9PSBPTl9PRkZfQVVUT19PTikgewogICAgICAgICAgICAg
LyogQ2FuJ3Qgc2F0aXNmeSB1c2VyJ3MgZXhwbGljaXQgbXNpPW9uIHJlcXVlc3QsIGZhaWwgKi8K
LSAgICAgICAgICAgIGVycm9yX2FwcGVuZF9oaW50KCZsb2NhbF9lcnIsICJZb3UgaGF2ZSB0byB1
c2UgbXNpPWF1dG8gKGRlZmF1bHQpICIKLSAgICAgICAgICAgICAgICAgICAgIm9yIG1zaT1vZmYg
d2l0aCB0aGlzIG1hY2hpbmUgdHlwZS5cbiIpOwotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRl
KGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgICAgICBlcnJvcl9hcHBlbmRfaGludChlcnJwLCAi
WW91IGhhdmUgdG8gdXNlIG1zaT1hdXRvIChkZWZhdWx0KSAiCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAib3IgbXNpPW9mZiB3aXRoIHRoaXMgbWFjaGluZSB0eXBlLlxuIik7CiAgICAg
ICAgICAgICBnb3RvIG1zaV9lcnJvcjsKICAgICAgICAgfQotICAgICAgICBhc3NlcnQoIWxvY2Fs
X2VyciB8fCBicmlkZ2VfZGV2LT5tc2kgPT0gT05fT0ZGX0FVVE9fQVVUTyk7CisgICAgICAgIGFz
c2VydCghKmVycnAgfHwgYnJpZGdlX2Rldi0+bXNpID09IE9OX09GRl9BVVRPX0FVVE8pOwogICAg
ICAgICAvKiBXaXRoIG1zaT1hdXRvLCB3ZSBmYWxsIGJhY2sgdG8gTVNJIG9mZiBzaWxlbnRseSAq
LwotICAgICAgICBlcnJvcl9mcmVlKGxvY2FsX2Vycik7CisgICAgICAgIGVycm9yX2ZyZWVfZXJy
cChlcnJwKTsKICAgICB9CiAKICAgICBlcnIgPSBwY2lfYnJpZGdlX3FlbXVfcmVzZXJ2ZV9jYXBf
aW5pdChkZXYsIDAsCmRpZmYgLS1naXQgYS9ody9wY2ktYnJpZGdlL3BjaV9leHBhbmRlcl9icmlk
Z2UuYyBiL2h3L3BjaS1icmlkZ2UvcGNpX2V4cGFuZGVyX2JyaWRnZS5jCmluZGV4IDA1OTI4MTg0
NDcuLmI5ZTg3ZTgxNTggMTAwNjQ0Ci0tLSBhL2h3L3BjaS1icmlkZ2UvcGNpX2V4cGFuZGVyX2Jy
aWRnZS5jCisrKyBiL2h3L3BjaS1icmlkZ2UvcGNpX2V4cGFuZGVyX2JyaWRnZS5jCkBAIC0yMTMs
NyArMjEzLDYgQEAgc3RhdGljIHZvaWQgcHhiX2Rldl9yZWFsaXplX2NvbW1vbihQQ0lEZXZpY2Ug
KmRldiwgYm9vbCBwY2llLCBFcnJvciAqKmVycnApCiAgICAgRGV2aWNlU3RhdGUgKmRzLCAqYmRz
ID0gTlVMTDsKICAgICBQQ0lCdXMgKmJ1czsKICAgICBjb25zdCBjaGFyICpkZXZfbmFtZSA9IE5V
TEw7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgTWFjaGluZVN0YXRlICptcyA9
IE1BQ0hJTkUocWRldl9nZXRfbWFjaGluZSgpKTsKIAogICAgIGlmIChtcy0+bnVtYV9zdGF0ZSA9
PSBOVUxMKSB7CkBAIC0yNDksOSArMjQ4LDggQEAgc3RhdGljIHZvaWQgcHhiX2Rldl9yZWFsaXpl
X2NvbW1vbihQQ0lEZXZpY2UgKmRldiwgYm9vbCBwY2llLCBFcnJvciAqKmVycnApCiAKICAgICBQ
Q0lfSE9TVF9CUklER0UoZHMpLT5idXMgPSBidXM7CiAKLSAgICBweGJfcmVnaXN0ZXJfYnVzKGRl
diwgYnVzLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHB4Yl9yZWdpc3Rlcl9idXMoZGV2LCBi
dXMsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICBnb3RvIGVycl9yZWdpc3Rlcl9i
dXM7CiAgICAgfQogCmRpZmYgLS1naXQgYS9ody9wY2ktYnJpZGdlL3BjaWVfcGNpX2JyaWRnZS5j
IGIvaHcvcGNpLWJyaWRnZS9wY2llX3BjaV9icmlkZ2UuYwppbmRleCA3Njc5YmVmNmMxLi4wMDA2
NWMzYWE4IDEwMDY0NAotLS0gYS9ody9wY2ktYnJpZGdlL3BjaWVfcGNpX2JyaWRnZS5jCisrKyBi
L2h3L3BjaS1icmlkZ2UvcGNpZV9wY2lfYnJpZGdlLmMKQEAgLTY2LDE3ICs2NiwxNCBAQCBzdGF0
aWMgdm9pZCBwY2llX3BjaV9icmlkZ2VfcmVhbGl6ZShQQ0lEZXZpY2UgKmQsIEVycm9yICoqZXJy
cCkKICAgICBpZiAocmMgPCAwKSB7CiAgICAgICAgIGdvdG8gYWVyX2Vycm9yOwogICAgIH0KLQot
ICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIGlmIChwY2llX2JyLT5tc2kgIT0gT05f
T0ZGX0FVVE9fT0ZGKSB7Ci0gICAgICAgIHJjID0gbXNpX2luaXQoZCwgMCwgMSwgdHJ1ZSwgdHJ1
ZSwgJmxvY2FsX2Vycik7CisgICAgICAgIHJjID0gbXNpX2luaXQoZCwgMCwgMSwgdHJ1ZSwgdHJ1
ZSwgZXJycCk7CiAgICAgICAgIGlmIChyYyA8IDApIHsKICAgICAgICAgICAgIGFzc2VydChyYyA9
PSAtRU5PVFNVUCk7CiAgICAgICAgICAgICBpZiAocGNpZV9ici0+bXNpICE9IE9OX09GRl9BVVRP
X09OKSB7Ci0gICAgICAgICAgICAgICAgZXJyb3JfZnJlZShsb2NhbF9lcnIpOworICAgICAgICAg
ICAgICAgIGVycm9yX2ZyZWVfZXJycChlcnJwKTsKICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg
ICAgICAgICAgICAgLyogZmFpbGVkIHRvIHNhdGlzZnkgdXNlcidzIGV4cGxpY2l0IHJlcXVlc3Qg
Zm9yIE1TSSAqLwotICAgICAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9l
cnIpOwogICAgICAgICAgICAgICAgIGdvdG8gbXNpX2Vycm9yOwogICAgICAgICAgICAgfQogICAg
ICAgICB9CmRpZmYgLS1naXQgYS9ody9wY2ktaG9zdC9waWl4LmMgYi9ody9wY2ktaG9zdC9waWl4
LmMKaW5kZXggMTM1YzY0NTUzNS4uMzE5ZmE3MWU1MiAxMDA2NDQKLS0tIGEvaHcvcGNpLWhvc3Qv
cGlpeC5jCisrKyBiL2h3L3BjaS1ob3N0L3BpaXguYwpAQCAtODU4LDE1ICs4NTgsMTMgQEAgc3Rh
dGljIHZvaWQgaWdkX3B0X2k0NDBmeF9yZWFsaXplKFBDSURldmljZSAqcGNpX2RldiwgRXJyb3Ig
KiplcnJwKQogICAgIHVpbnQzMl90IHZhbCA9IDA7CiAgICAgaW50IGksIG51bTsKICAgICBpbnQg
cG9zLCBsZW47Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICBudW0gPSBBUlJB
WV9TSVpFKGlnZF9ob3N0X2JyaWRnZV9pbmZvcyk7CiAgICAgZm9yIChpID0gMDsgaSA8IG51bTsg
aSsrKSB7CiAgICAgICAgIHBvcyA9IGlnZF9ob3N0X2JyaWRnZV9pbmZvc1tpXS5vZmZzZXQ7CiAg
ICAgICAgIGxlbiA9IGlnZF9ob3N0X2JyaWRnZV9pbmZvc1tpXS5sZW47Ci0gICAgICAgIGhvc3Rf
cGNpX2NvbmZpZ19yZWFkKHBvcywgbGVuLCAmdmFsLCAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYg
KGxvY2FsX2VycikgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vy
cik7CisgICAgICAgIGhvc3RfcGNpX2NvbmZpZ19yZWFkKHBvcywgbGVuLCAmdmFsLCBlcnJwKTsK
KyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgIH0KICAg
ICAgICAgcGNpX2RlZmF1bHRfd3JpdGVfY29uZmlnKHBjaV9kZXYsIHBvcywgdmFsLCBsZW4pOwpk
aWZmIC0tZ2l0IGEvaHcvcGNpL3BjaS5jIGIvaHcvcGNpL3BjaS5jCmluZGV4IGFhMDVjMmI5YjIu
LjQyZjVmYjQ5ZmEgMTAwNjQ0Ci0tLSBhL2h3L3BjaS9wY2kuYworKysgYi9ody9wY2kvcGNpLmMK
QEAgLTk5OCw3ICs5OTgsNiBAQCBzdGF0aWMgUENJRGV2aWNlICpkb19wY2lfcmVnaXN0ZXJfZGV2
aWNlKFBDSURldmljZSAqcGNpX2RldiwKICAgICBQQ0lEZXZpY2VDbGFzcyAqcGMgPSBQQ0lfREVW
SUNFX0dFVF9DTEFTUyhwY2lfZGV2KTsKICAgICBQQ0lDb25maWdSZWFkRnVuYyAqY29uZmlnX3Jl
YWQgPSBwYy0+Y29uZmlnX3JlYWQ7CiAgICAgUENJQ29uZmlnV3JpdGVGdW5jICpjb25maWdfd3Jp
dGUgPSBwYy0+Y29uZmlnX3dyaXRlOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAg
IERldmljZVN0YXRlICpkZXYgPSBERVZJQ0UocGNpX2Rldik7CiAgICAgUENJQnVzICpidXMgPSBw
Y2lfZ2V0X2J1cyhwY2lfZGV2KTsKIApAQCAtMTA4NCw5ICsxMDgzLDggQEAgc3RhdGljIFBDSURl
dmljZSAqZG9fcGNpX3JlZ2lzdGVyX2RldmljZShQQ0lEZXZpY2UgKnBjaV9kZXYsCiAgICAgaWYg
KHBjLT5pc19icmlkZ2UpIHsKICAgICAgICAgcGNpX2luaXRfbWFza19icmlkZ2UocGNpX2Rldik7
CiAgICAgfQotICAgIHBjaV9pbml0X211bHRpZnVuY3Rpb24oYnVzLCBwY2lfZGV2LCAmbG9jYWxf
ZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJw
LCBsb2NhbF9lcnIpOworICAgIHBjaV9pbml0X211bHRpZnVuY3Rpb24oYnVzLCBwY2lfZGV2LCBl
cnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZG9fcGNpX3VucmVnaXN0ZXJfZGV2aWNl
KHBjaV9kZXYpOwogICAgICAgICByZXR1cm4gTlVMTDsKICAgICB9CkBAIC0yMDc1LDcgKzIwNzMs
NiBAQCBzdGF0aWMgdm9pZCBwY2lfcWRldl9yZWFsaXplKERldmljZVN0YXRlICpxZGV2LCBFcnJv
ciAqKmVycnApCiAgICAgUENJRGV2aWNlICpwY2lfZGV2ID0gKFBDSURldmljZSAqKXFkZXY7CiAg
ICAgUENJRGV2aWNlQ2xhc3MgKnBjID0gUENJX0RFVklDRV9HRVRfQ0xBU1MocGNpX2Rldik7CiAg
ICAgT2JqZWN0Q2xhc3MgKmtsYXNzID0gT0JKRUNUX0NMQVNTKHBjKTsKLSAgICBFcnJvciAqbG9j
YWxfZXJyID0gTlVMTDsKICAgICBib29sIGlzX2RlZmF1bHRfcm9tOwogCiAgICAgLyogaW5pdGlh
bGl6ZSBjYXBfcHJlc2VudCBmb3IgcGNpX2lzX2V4cHJlc3MoKSBhbmQgcGNpX2NvbmZpZ19zaXpl
KCksCkBAIC0yMDkzLDkgKzIwOTAsOCBAQCBzdGF0aWMgdm9pZCBwY2lfcWRldl9yZWFsaXplKERl
dmljZVN0YXRlICpxZGV2LCBFcnJvciAqKmVycnApCiAgICAgICAgIHJldHVybjsKIAogICAgIGlm
IChwYy0+cmVhbGl6ZSkgewotICAgICAgICBwYy0+cmVhbGl6ZShwY2lfZGV2LCAmbG9jYWxfZXJy
KTsKLSAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRl
KGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgIHBjLT5yZWFsaXplKHBjaV9kZXYsIGVycnApOwor
ICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIGRvX3BjaV91bnJlZ2lzdGVyX2Rldmlj
ZShwY2lfZGV2KTsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQpAQCAtMjEwOCw5ICsy
MTA0LDggQEAgc3RhdGljIHZvaWQgcGNpX3FkZXZfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqcWRldiwg
RXJyb3IgKiplcnJwKQogICAgICAgICBpc19kZWZhdWx0X3JvbSA9IHRydWU7CiAgICAgfQogCi0g
ICAgcGNpX2FkZF9vcHRpb25fcm9tKHBjaV9kZXYsIGlzX2RlZmF1bHRfcm9tLCAmbG9jYWxfZXJy
KTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBs
b2NhbF9lcnIpOworICAgIHBjaV9hZGRfb3B0aW9uX3JvbShwY2lfZGV2LCBpc19kZWZhdWx0X3Jv
bSwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHBjaV9xZGV2X3VucmVhbGl6ZShE
RVZJQ0UocGNpX2RldiksIE5VTEwpOwogICAgICAgICByZXR1cm47CiAgICAgfQpkaWZmIC0tZ2l0
IGEvaHcvcGNpL3BjaWUuYyBiL2h3L3BjaS9wY2llLmMKaW5kZXggYTZiZWI1NjdiZC4uM2E2ODhk
NTRiMCAxMDA2NDQKLS0tIGEvaHcvcGNpL3BjaWUuYworKysgYi9ody9wY2kvcGNpZS5jCkBAIC00
NjMsMTMgKzQ2MywxMSBAQCBzdGF0aWMgdm9pZCBwY2llX3VucGx1Z19kZXZpY2UoUENJQnVzICpi
dXMsIFBDSURldmljZSAqZGV2LCB2b2lkICpvcGFxdWUpCiB2b2lkIHBjaWVfY2FwX3Nsb3RfdW5w
bHVnX3JlcXVlc3RfY2IoSG90cGx1Z0hhbmRsZXIgKmhvdHBsdWdfZGV2LAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkK
IHsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBQQ0lEZXZpY2UgKnBjaV9kZXYg
PSBQQ0lfREVWSUNFKGRldik7CiAgICAgUENJQnVzICpidXMgPSBwY2lfZ2V0X2J1cyhwY2lfZGV2
KTsKIAotICAgIHBjaWVfY2FwX3Nsb3RfcGx1Z19jb21tb24oUENJX0RFVklDRShob3RwbHVnX2Rl
diksIGRldiwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJv
cl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBwY2llX2NhcF9zbG90X3BsdWdfY29t
bW9uKFBDSV9ERVZJQ0UoaG90cGx1Z19kZXYpLCBkZXYsIGVycnApOworICAgIGlmICgqZXJycCkg
ewogICAgICAgICByZXR1cm47CiAgICAgfQogCmRpZmYgLS1naXQgYS9ody9wY2kvc2hwYy5jIGIv
aHcvcGNpL3NocGMuYwppbmRleCA3ZjBhYTI4ZTQ0Li4yY2ZiNzk0MmRhIDEwMDY0NAotLS0gYS9o
dy9wY2kvc2hwYy5jCisrKyBiL2h3L3BjaS9zaHBjLmMKQEAgLTUwNCwxNCArNTA0LDEyIEBAIHN0
YXRpYyB2b2lkIHNocGNfZGV2aWNlX3BsdWdfY29tbW9uKFBDSURldmljZSAqYWZmZWN0ZWRfZGV2
LCBpbnQgKnNsb3QsCiB2b2lkIHNocGNfZGV2aWNlX3BsdWdfY2IoSG90cGx1Z0hhbmRsZXIgKmhv
dHBsdWdfZGV2LCBEZXZpY2VTdGF0ZSAqZGV2LAogICAgICAgICAgICAgICAgICAgICAgICAgICAg
IEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBQQ0lE
ZXZpY2UgKnBjaV9ob3RwbHVnX2RldiA9IFBDSV9ERVZJQ0UoaG90cGx1Z19kZXYpOwogICAgIFNI
UENEZXZpY2UgKnNocGMgPSBwY2lfaG90cGx1Z19kZXYtPnNocGM7CiAgICAgaW50IHNsb3Q7CiAK
LSAgICBzaHBjX2RldmljZV9wbHVnX2NvbW1vbihQQ0lfREVWSUNFKGRldiksICZzbG90LCBzaHBj
LCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3Bh
Z2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHNocGNfZGV2aWNlX3BsdWdfY29tbW9uKFBDSV9E
RVZJQ0UoZGV2KSwgJnNsb3QsIHNocGMsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAg
ICByZXR1cm47CiAgICAgfQogCkBAIC01NTMsMTYgKzU1MSwxNCBAQCB2b2lkIHNocGNfZGV2aWNl
X3VucGx1Z19jYihIb3RwbHVnSGFuZGxlciAqaG90cGx1Z19kZXYsIERldmljZVN0YXRlICpkZXYs
CiB2b2lkIHNocGNfZGV2aWNlX3VucGx1Z19yZXF1ZXN0X2NiKEhvdHBsdWdIYW5kbGVyICpob3Rw
bHVnX2RldiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGV2aWNlU3RhdGUg
KmRldiwgRXJyb3IgKiplcnJwKQogewotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAg
IFBDSURldmljZSAqcGNpX2hvdHBsdWdfZGV2ID0gUENJX0RFVklDRShob3RwbHVnX2Rldik7CiAg
ICAgU0hQQ0RldmljZSAqc2hwYyA9IHBjaV9ob3RwbHVnX2Rldi0+c2hwYzsKICAgICB1aW50OF90
IHN0YXRlOwogICAgIHVpbnQ4X3QgbGVkOwogICAgIGludCBzbG90OwogCi0gICAgc2hwY19kZXZp
Y2VfcGx1Z19jb21tb24oUENJX0RFVklDRShkZXYpLCAmc2xvdCwgc2hwYywgJmxvY2FsX2Vycik7
Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9j
YWxfZXJyKTsKKyAgICBzaHBjX2RldmljZV9wbHVnX2NvbW1vbihQQ0lfREVWSUNFKGRldiksICZz
bG90LCBzaHBjLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAg
IH0KIApkaWZmIC0tZ2l0IGEvaHcvcHBjL2U1MDAuYyBiL2h3L3BwYy9lNTAwLmMKaW5kZXggOTFj
ZDRjMjZmOS4uN2I3OWExOGE5ZiAxMDA2NDQKLS0tIGEvaHcvcHBjL2U1MDAuYworKysgYi9ody9w
cGMvZTUwMC5jCkBAIC03NjQsMTYgKzc2NCwxNCBAQCBzdGF0aWMgRGV2aWNlU3RhdGUgKnBwY2U1
MDBfaW5pdF9tcGljX3FlbXUoUFBDRTUwME1hY2hpbmVTdGF0ZSAqcG1zLAogc3RhdGljIERldmlj
ZVN0YXRlICpwcGNlNTAwX2luaXRfbXBpY19rdm0oY29uc3QgUFBDRTUwME1hY2hpbmVDbGFzcyAq
cG1jLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSXJxTGluZXMg
KmlycXMsIEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKICAgICBEZXZp
Y2VTdGF0ZSAqZGV2OwogICAgIENQVVN0YXRlICpjczsKIAogICAgIGRldiA9IHFkZXZfY3JlYXRl
KE5VTEwsIFRZUEVfS1ZNX09QRU5QSUMpOwogICAgIHFkZXZfcHJvcF9zZXRfdWludDMyKGRldiwg
Im1vZGVsIiwgcG1jLT5tcGljX3ZlcnNpb24pOwogCi0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9i
b29sKE9CSkVDVChkZXYpLCB0cnVlLCAicmVhbGl6ZWQiLCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7
Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgIG9iamVjdF9wcm9wZXJ0
eV9zZXRfYm9vbChPQkpFQ1QoZGV2KSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgaWYg
KCplcnJwKSB7CiAgICAgICAgIG9iamVjdF91bnBhcmVudChPQkpFQ1QoZGV2KSk7CiAgICAgICAg
IHJldHVybiBOVUxMOwogICAgIH0KZGlmZiAtLWdpdCBhL2h3L3BwYy9wbnYuYyBiL2h3L3BwYy9w
bnYuYwppbmRleCAzZjA4ZGI3YjllLi4wNDkxNTViNGVjIDEwMDY0NAotLS0gYS9ody9wcGMvcG52
LmMKKysrIGIvaHcvcHBjL3Budi5jCkBAIC03NTIsMTQgKzc1MiwxMiBAQCBzdGF0aWMgdWludDMy
X3QgcG52X2NoaXBfY29yZV9waXJfcDgoUG52Q2hpcCAqY2hpcCwgdWludDMyX3QgY29yZV9pZCkK
IHN0YXRpYyB2b2lkIHBudl9jaGlwX3Bvd2VyOF9pbnRjX2NyZWF0ZShQbnZDaGlwICpjaGlwLCBQ
b3dlclBDQ1BVICpjcHUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
RXJyb3IgKiplcnJwKQogewotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIE9iamVj
dCAqb2JqOwogICAgIFBudkNQVVN0YXRlICpwbnZfY3B1ID0gcG52X2NwdV9zdGF0ZShjcHUpOwog
CiAgICAgb2JqID0gaWNwX2NyZWF0ZShPQkpFQ1QoY3B1KSwgVFlQRV9QTlZfSUNQLCBYSUNTX0ZB
QlJJQyhxZGV2X2dldF9tYWNoaW5lKCkpLAotICAgICAgICAgICAgICAgICAgICAgJmxvY2FsX2Vy
cik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwg
bG9jYWxfZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgIGVycnApOworICAgIGlmICgqZXJycCkg
ewogICAgICAgICByZXR1cm47CiAgICAgfQogCkBAIC03ODUsNyArNzgzLDYgQEAgc3RhdGljIHZv
aWQgcG52X2NoaXBfcG93ZXI5X2ludGNfY3JlYXRlKFBudkNoaXAgKmNoaXAsIFBvd2VyUENDUFUg
KmNwdSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcnJvciAqKmVy
cnApCiB7CiAgICAgUG52OUNoaXAgKmNoaXA5ID0gUE5WOV9DSElQKGNoaXApOwotICAgIEVycm9y
ICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIE9iamVjdCAqb2JqOwogICAgIFBudkNQVVN0YXRlICpw
bnZfY3B1ID0gcG52X2NwdV9zdGF0ZShjcHUpOwogCkBAIC03OTQsOSArNzkxLDggQEAgc3RhdGlj
IHZvaWQgcG52X2NoaXBfcG93ZXI5X2ludGNfY3JlYXRlKFBudkNoaXAgKmNoaXAsIFBvd2VyUEND
UFUgKmNwdSwKICAgICAgKiBjb250cm9sbGVyIG9iamVjdCBpcyBpbml0aWFsaXplZCBhZnRlcndh
cmRzLiBIb3BlZnVsbHksIGl0J3MKICAgICAgKiBvbmx5IHVzZWQgYXQgcnVudGltZS4KICAgICAg
Ki8KLSAgICBvYmogPSB4aXZlX3RjdHhfY3JlYXRlKE9CSkVDVChjcHUpLCBYSVZFX1JPVVRFUigm
Y2hpcDktPnhpdmUpLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAg
IGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIG9iaiA9IHhpdmVfdGN0eF9j
cmVhdGUoT0JKRUNUKGNwdSksIFhJVkVfUk9VVEVSKCZjaGlwOS0+eGl2ZSksIGVycnApOworICAg
IGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCkBAIC04ODcsMjggKzg4Mywy
NCBAQCBzdGF0aWMgdm9pZCBwbnZfY2hpcF9wb3dlcjhfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2
LCBFcnJvciAqKmVycnApCiAgICAgUG52Q2hpcCAqY2hpcCA9IFBOVl9DSElQKGRldik7CiAgICAg
UG52OENoaXAgKmNoaXA4ID0gUE5WOF9DSElQKGRldik7CiAgICAgUG52OFBzaSAqcHNpOCA9ICZj
aGlwOC0+cHNpOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgLyogWFNDT00g
YnJpZGdlIGlzIGZpcnN0ICovCi0gICAgcG52X3hzY29tX3JlYWxpemUoY2hpcCwgUE5WX1hTQ09N
X1NJWkUsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3Jf
cHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgcG52X3hzY29tX3JlYWxpemUoY2hpcCwg
UE5WX1hTQ09NX1NJWkUsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47
CiAgICAgfQogICAgIHN5c2J1c19tbWlvX21hcChTWVNfQlVTX0RFVklDRShjaGlwKSwgMCwgUE5W
X1hTQ09NX0JBU0UoY2hpcCkpOwogCi0gICAgcGNjLT5wYXJlbnRfcmVhbGl6ZShkZXYsICZsb2Nh
bF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVy
cnAsIGxvY2FsX2Vycik7CisgICAgcGNjLT5wYXJlbnRfcmVhbGl6ZShkZXYsIGVycnApOworICAg
IGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCiAgICAgLyogUHJvY2Vzc29y
IFNlcnZpY2UgSW50ZXJmYWNlIChQU0kpIEhvc3QgQnJpZGdlICovCiAgICAgb2JqZWN0X3Byb3Bl
cnR5X3NldF9pbnQoT0JKRUNUKCZjaGlwOC0+cHNpKSwgUE5WX1BTSUhCX0JBU0UoY2hpcCksCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgImJhciIsICZlcnJvcl9mYXRhbCk7Ci0gICAgb2Jq
ZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmY2hpcDgtPnBzaSksIHRydWUsICJyZWFsaXpl
ZCIsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJv
cGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9C
SkVDVCgmY2hpcDgtPnBzaSksIHRydWUsICJyZWFsaXplZCIsIGVycnApOworICAgIGlmICgqZXJy
cCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogICAgIHBudl94c2NvbV9hZGRfc3VicmVnaW9u
KGNoaXAsIFBOVl9YU0NPTV9QU0lIQl9CQVNFLApAQCAtOTI1LDE2ICs5MTcsMTQgQEAgc3RhdGlj
IHZvaWQgcG52X2NoaXBfcG93ZXI4X3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKipl
cnJwKQogCiAgICAgLyogSW50ZXJydXB0IE1hbmFnZW1lbnQgQXJlYS4gVGhpcyBpcyB0aGUgbWVt
b3J5IHJlZ2lvbiBob2xkaW5nCiAgICAgICogYWxsIHRoZSBJbnRlcnJ1cHQgQ29udHJvbCBQcmVz
ZW50ZXIgKElDUCkgcmVnaXN0ZXJzICovCi0gICAgcG52X2NoaXBfaWNwX3JlYWxpemUoY2hpcDgs
ICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFn
YXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgcG52X2NoaXBfaWNwX3JlYWxpemUoY2hpcDgsIGVy
cnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCiAgICAgLyog
Q3JlYXRlIHRoZSBzaW1wbGlmaWVkIE9DQyBtb2RlbCAqLwotICAgIG9iamVjdF9wcm9wZXJ0eV9z
ZXRfYm9vbChPQkpFQ1QoJmNoaXA4LT5vY2MpLCB0cnVlLCAicmVhbGl6ZWQiLCAmbG9jYWxfZXJy
KTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBs
b2NhbF9lcnIpOworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJmNoaXA4LT5v
Y2MpLCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAg
cmV0dXJuOwogICAgIH0KICAgICBwbnZfeHNjb21fYWRkX3N1YnJlZ2lvbihjaGlwLCBQTlZfWFND
T01fT0NDX0JBU0UsICZjaGlwOC0+b2NjLnhzY29tX3JlZ3MpOwpAQCAtMTA1NiwyNSArMTA0Niwy
MSBAQCBzdGF0aWMgdm9pZCBwbnZfY2hpcF9wb3dlcjlfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2
LCBFcnJvciAqKmVycnApCiAgICAgUG52OUNoaXAgKmNoaXA5ID0gUE5WOV9DSElQKGRldik7CiAg
ICAgUG52Q2hpcCAqY2hpcCA9IFBOVl9DSElQKGRldik7CiAgICAgUG52OVBzaSAqcHNpOSA9ICZj
aGlwOS0+cHNpOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgLyogWFNDT00g
YnJpZGdlIGlzIGZpcnN0ICovCi0gICAgcG52X3hzY29tX3JlYWxpemUoY2hpcCwgUE5WOV9YU0NP
TV9TSVpFLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHBudl94c2NvbV9yZWFsaXplKGNoaXAs
IFBOVjlfWFNDT01fU0laRSwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVy
bjsKICAgICB9CiAgICAgc3lzYnVzX21taW9fbWFwKFNZU19CVVNfREVWSUNFKGNoaXApLCAwLCBQ
TlY5X1hTQ09NX0JBU0UoY2hpcCkpOwogCi0gICAgcGNjLT5wYXJlbnRfcmVhbGl6ZShkZXYsICZs
b2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRl
KGVycnAsIGxvY2FsX2Vycik7CisgICAgcGNjLT5wYXJlbnRfcmVhbGl6ZShkZXYsIGVycnApOwor
ICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCi0gICAgcG52X2NoaXBf
cXVhZF9yZWFsaXplKGNoaXA5LCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0g
ICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHBudl9jaGlwX3F1
YWRfcmVhbGl6ZShjaGlwOSwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVy
bjsKICAgICB9CiAKQEAgLTEwODgsOSArMTA3NCw4IEBAIHN0YXRpYyB2b2lkIHBudl9jaGlwX3Bv
d2VyOV9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAgICBvYmplY3Rf
cHJvcGVydHlfc2V0X2ludChPQkpFQ1QoJmNoaXA5LT54aXZlKSwgUE5WOV9YSVZFX1RNX0JBU0Uo
Y2hpcCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInRtLWJhciIsICZlcnJvcl9mYXRh
bCk7CiAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmY2hpcDktPnhpdmUpLCB0
cnVlLCAicmVhbGl6ZWQiLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmbG9jYWxfZXJy
KTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBs
b2NhbF9lcnIpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJwKTsKKyAgICBpZiAo
KmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KICAgICBwbnZfeHNjb21fYWRkX3N1YnJl
Z2lvbihjaGlwLCBQTlY5X1hTQ09NX1hJVkVfQkFTRSwKQEAgLTEwOTksMTggKzEwODQsMTYgQEAg
c3RhdGljIHZvaWQgcG52X2NoaXBfcG93ZXI5X3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJy
b3IgKiplcnJwKQogICAgIC8qIFByb2Nlc3NvciBTZXJ2aWNlIEludGVyZmFjZSAoUFNJKSBIb3N0
IEJyaWRnZSAqLwogICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfaW50KE9CSkVDVCgmY2hpcDktPnBz
aSksIFBOVjlfUFNJSEJfQkFTRShjaGlwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAi
YmFyIiwgJmVycm9yX2ZhdGFsKTsKLSAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNU
KCZjaGlwOS0+cHNpKSwgdHJ1ZSwgInJlYWxpemVkIiwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxv
Y2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAg
ICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZjaGlwOS0+cHNpKSwgdHJ1ZSwgInJl
YWxpemVkIiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9
CiAgICAgcG52X3hzY29tX2FkZF9zdWJyZWdpb24oY2hpcCwgUE5WOV9YU0NPTV9QU0lIQl9CQVNF
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICZQTlZfUFNJKHBzaTkpLT54c2NvbV9yZWdz
KTsKIAogICAgIC8qIExQQyAqLwotICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1Qo
JmNoaXA5LT5scGMpLCB0cnVlLCAicmVhbGl6ZWQiLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9j
YWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAg
IG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJmNoaXA5LT5scGMpLCB0cnVlLCAicmVh
bGl6ZWQiLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0K
ICAgICBtZW1vcnlfcmVnaW9uX2FkZF9zdWJyZWdpb24oZ2V0X3N5c3RlbV9tZW1vcnkoKSwgUE5W
OV9MUENNX0JBU0UoY2hpcCksCkBAIC0xMTIwLDkgKzExMDMsOCBAQCBzdGF0aWMgdm9pZCBwbnZf
Y2hpcF9wb3dlcjlfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh1aW50NjRfdCkgUE5WOV9M
UENNX0JBU0UoY2hpcCkpOwogCiAgICAgLyogQ3JlYXRlIHRoZSBzaW1wbGlmaWVkIE9DQyBtb2Rl
bCAqLwotICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoJmNoaXA5LT5vY2MpLCB0
cnVlLCAicmVhbGl6ZWQiLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAg
ICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIG9iamVjdF9wcm9wZXJ0
eV9zZXRfYm9vbChPQkpFQ1QoJmNoaXA5LT5vY2MpLCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsK
KyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KICAgICBwbnZfeHNjb21f
YWRkX3N1YnJlZ2lvbihjaGlwLCBQTlY5X1hTQ09NX09DQ19CQVNFLCAmY2hpcDktPm9jYy54c2Nv
bV9yZWdzKTsKQEAgLTExODAsNyArMTE2Miw2IEBAIHN0YXRpYyB2b2lkIHBudl9jaGlwX2NvcmVf
c2FuaXRpemUoUG52Q2hpcCAqY2hpcCwgRXJyb3IgKiplcnJwKQogc3RhdGljIHZvaWQgcG52X2No
aXBfY29yZV9yZWFsaXplKFBudkNoaXAgKmNoaXAsIEVycm9yICoqZXJycCkKIHsKICAgICBNYWNo
aW5lU3RhdGUgKm1zID0gTUFDSElORShxZGV2X2dldF9tYWNoaW5lKCkpOwotICAgIEVycm9yICpl
cnJvciA9IE5VTEw7CiAgICAgUG52Q2hpcENsYXNzICpwY2MgPSBQTlZfQ0hJUF9HRVRfQ0xBU1Mo
Y2hpcCk7CiAgICAgY29uc3QgY2hhciAqdHlwZW5hbWUgPSBwbnZfY2hpcF9jb3JlX3R5cGVuYW1l
KGNoaXApOwogICAgIHNpemVfdCB0eXBlc2l6ZSA9IG9iamVjdF90eXBlX2dldF9pbnN0YW5jZV9z
aXplKHR5cGVuYW1lKTsKQEAgLTExOTIsOSArMTE3Myw4IEBAIHN0YXRpYyB2b2lkIHBudl9jaGlw
X2NvcmVfcmVhbGl6ZShQbnZDaGlwICpjaGlwLCBFcnJvciAqKmVycnApCiAgICAgfQogCiAgICAg
LyogQ29yZXMgKi8KLSAgICBwbnZfY2hpcF9jb3JlX3Nhbml0aXplKGNoaXAsICZlcnJvcik7Ci0g
ICAgaWYgKGVycm9yKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnJvcik7Cisg
ICAgcG52X2NoaXBfY29yZV9zYW5pdGl6ZShjaGlwLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsK
ICAgICAgICAgcmV0dXJuOwogICAgIH0KIApAQCAtMTI0MSwxMiArMTIyMSwxMCBAQCBzdGF0aWMg
dm9pZCBwbnZfY2hpcF9jb3JlX3JlYWxpemUoUG52Q2hpcCAqY2hpcCwgRXJyb3IgKiplcnJwKQog
c3RhdGljIHZvaWQgcG52X2NoaXBfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVy
cnApCiB7CiAgICAgUG52Q2hpcCAqY2hpcCA9IFBOVl9DSElQKGRldik7Ci0gICAgRXJyb3IgKmVy
cm9yID0gTlVMTDsKIAogICAgIC8qIENvcmVzICovCi0gICAgcG52X2NoaXBfY29yZV9yZWFsaXpl
KGNoaXAsICZlcnJvcik7Ci0gICAgaWYgKGVycm9yKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0
ZShlcnJwLCBlcnJvcik7CisgICAgcG52X2NoaXBfY29yZV9yZWFsaXplKGNoaXAsIGVycnApOwor
ICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogfQpAQCAtMTMzNiwxMSAr
MTMxNCw5IEBAIHN0YXRpYyB2b2lkIHBudl9zZXRfbnVtX2NoaXBzKE9iamVjdCAqb2JqLCBWaXNp
dG9yICp2LCBjb25zdCBjaGFyICpuYW1lLAogewogICAgIFBudk1hY2hpbmVTdGF0ZSAqcG52ID0g
UE5WX01BQ0hJTkUob2JqKTsKICAgICB1aW50MzJfdCBudW1fY2hpcHM7Ci0gICAgRXJyb3IgKmxv
Y2FsX2VyciA9IE5VTEw7CiAKLSAgICB2aXNpdF90eXBlX3VpbnQzMih2LCBuYW1lLCAmbnVtX2No
aXBzLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3By
b3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHZpc2l0X3R5cGVfdWludDMyKHYsIG5hbWUs
ICZudW1fY2hpcHMsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAg
ICAgfQogCmRpZmYgLS1naXQgYS9ody9wcGMvcG52X2NvcmUuYyBiL2h3L3BwYy9wbnZfY29yZS5j
CmluZGV4IGIxYTc0ODllN2EuLmFjN2JjNzhlM2EgMTAwNjQ0Ci0tLSBhL2h3L3BwYy9wbnZfY29y
ZS5jCisrKyBiL2h3L3BwYy9wbnZfY29yZS5jCkBAIC0xNjYsMTggKzE2NiwxNSBAQCBzdGF0aWMg
dm9pZCBwbnZfcmVhbGl6ZV92Y3B1KFBvd2VyUENDUFUgKmNwdSwgUG52Q2hpcCAqY2hpcCwgRXJy
b3IgKiplcnJwKQogICAgIGludCBjb3JlX3BpcjsKICAgICBpbnQgdGhyZWFkX2luZGV4ID0gMDsg
LyogVE9ETzogVENHIHN1cHBvcnRzIG9ubHkgb25lIHRocmVhZCAqLwogICAgIHBwY19zcHJfdCAq
cGlyID0gJmVudi0+c3ByX2NiW1NQUl9QSVJdOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxM
OwogICAgIFBudkNoaXBDbGFzcyAqcGNjID0gUE5WX0NISVBfR0VUX0NMQVNTKGNoaXApOwogCi0g
ICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVChjcHUpLCB0cnVlLCAicmVhbGl6ZWQi
LCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3Bh
Z2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpF
Q1QoY3B1KSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAg
ICAgIHJldHVybjsKICAgICB9CiAKLSAgICBwY2MtPmludGNfY3JlYXRlKGNoaXAsIGNwdSwgJmxv
Y2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUo
ZXJycCwgbG9jYWxfZXJyKTsKKyAgICBwY2MtPmludGNfY3JlYXRlKGNoaXAsIGNwdSwgZXJycCk7
CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKQEAgLTIwMiwxNSAr
MTk5LDE0IEBAIHN0YXRpYyB2b2lkIHBudl9jb3JlX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwg
RXJyb3IgKiplcnJwKQogICAgIFBudkNvcmVDbGFzcyAqcGNjID0gUE5WX0NPUkVfR0VUX0NMQVNT
KHBjKTsKICAgICBDUFVDb3JlICpjYyA9IENQVV9DT1JFKE9CSkVDVChkZXYpKTsKICAgICBjb25z
dCBjaGFyICp0eXBlbmFtZSA9IHBudl9jb3JlX2NwdV90eXBlbmFtZShwYyk7Ci0gICAgRXJyb3Ig
KmxvY2FsX2VyciA9IE5VTEw7CiAgICAgdm9pZCAqb2JqOwogICAgIGludCBpLCBqOwogICAgIGNo
YXIgbmFtZVszMl07CiAgICAgT2JqZWN0ICpjaGlwOwogCi0gICAgY2hpcCA9IG9iamVjdF9wcm9w
ZXJ0eV9nZXRfbGluayhPQkpFQ1QoZGV2KSwgImNoaXAiLCAmbG9jYWxfZXJyKTsKKyAgICBjaGlw
ID0gb2JqZWN0X3Byb3BlcnR5X2dldF9saW5rKE9CSkVDVChkZXYpLCAiY2hpcCIsIGVycnApOwog
ICAgIGlmICghY2hpcCkgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGVfcHJlcGVuZChlcnJwLCBs
b2NhbF9lcnIsCisgICAgICAgIGVycm9yX3Byb3BhZ2F0ZV9wcmVwZW5kKGVycnAsICplcnJwLAog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicmVxdWlyZWQgbGluayAnY2hpcCcgbm90
IGZvdW5kOiAiKTsKICAgICAgICAgcmV0dXJuOwogICAgIH0KQEAgLTIzNSw4ICsyMzEsOCBAQCBz
dGF0aWMgdm9pZCBwbnZfY29yZV9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJy
cCkKICAgICB9CiAKICAgICBmb3IgKGogPSAwOyBqIDwgY2MtPm5yX3RocmVhZHM7IGorKykgewot
ICAgICAgICBwbnZfcmVhbGl6ZV92Y3B1KHBjLT50aHJlYWRzW2pdLCBQTlZfQ0hJUChjaGlwKSwg
JmxvY2FsX2Vycik7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsKKyAgICAgICAgcG52X3JlYWxp
emVfdmNwdShwYy0+dGhyZWFkc1tqXSwgUE5WX0NISVAoY2hpcCksIGVycnApOworICAgICAgICBp
ZiAoKmVycnApIHsKICAgICAgICAgICAgIGdvdG8gZXJyOwogICAgICAgICB9CiAgICAgfQpAQCAt
MjUyLDcgKzI0OCw2IEBAIGVycjoKICAgICAgICAgb2JqZWN0X3VucGFyZW50KG9iaik7CiAgICAg
fQogICAgIGdfZnJlZShwYy0+dGhyZWFkcyk7Ci0gICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxv
Y2FsX2Vycik7CiB9CiAKIHN0YXRpYyB2b2lkIHBudl91bnJlYWxpemVfdmNwdShQb3dlclBDQ1BV
ICpjcHUpCmRpZmYgLS1naXQgYS9ody9wcGMvcG52X2xwYy5jIGIvaHcvcHBjL3Budl9scGMuYwpp
bmRleCA5NDY2ZDRhMWJlLi42OGRkNGI3MjBmIDEwMDY0NAotLS0gYS9ody9wcGMvcG52X2xwYy5j
CisrKyBiL2h3L3BwYy9wbnZfbHBjLmMKQEAgLTYwMSwxMSArNjAxLDkgQEAgc3RhdGljIHZvaWQg
cG52X2xwY19wb3dlcjhfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiB7
CiAgICAgUG52THBjQ29udHJvbGxlciAqbHBjID0gUE5WX0xQQyhkZXYpOwogICAgIFBudkxwY0Ns
YXNzICpwbGMgPSBQTlZfTFBDX0dFVF9DTEFTUyhkZXYpOwotICAgIEVycm9yICpsb2NhbF9lcnIg
PSBOVUxMOwogCi0gICAgcGxjLT5wYXJlbnRfcmVhbGl6ZShkZXYsICZsb2NhbF9lcnIpOwotICAg
IGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vy
cik7CisgICAgcGxjLT5wYXJlbnRfcmVhbGl6ZShkZXYsIGVycnApOworICAgIGlmICgqZXJycCkg
ewogICAgICAgICByZXR1cm47CiAgICAgfQogCkBAIC02NDYsMTEgKzY0NCw5IEBAIHN0YXRpYyB2
b2lkIHBudl9scGNfcG93ZXI5X3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJw
KQogewogICAgIFBudkxwY0NvbnRyb2xsZXIgKmxwYyA9IFBOVl9MUEMoZGV2KTsKICAgICBQbnZM
cGNDbGFzcyAqcGxjID0gUE5WX0xQQ19HRVRfQ0xBU1MoZGV2KTsKLSAgICBFcnJvciAqbG9jYWxf
ZXJyID0gTlVMTDsKIAotICAgIHBsYy0+cGFyZW50X3JlYWxpemUoZGV2LCAmbG9jYWxfZXJyKTsK
LSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2Nh
bF9lcnIpOworICAgIHBsYy0+cGFyZW50X3JlYWxpemUoZGV2LCBlcnJwKTsKKyAgICBpZiAoKmVy
cnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApAQCAtNjgzLDExICs2NzksOSBAQCBzdGF0
aWMgdm9pZCBwbnZfbHBjX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQog
ewogICAgIFBudkxwY0NvbnRyb2xsZXIgKmxwYyA9IFBOVl9MUEMoZGV2KTsKICAgICBPYmplY3Qg
Km9iajsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAotICAgIG9iaiA9IG9iamVjdF9w
cm9wZXJ0eV9nZXRfbGluayhPQkpFQ1QoZGV2KSwgInBzaSIsICZsb2NhbF9lcnIpOworICAgIG9i
aiA9IG9iamVjdF9wcm9wZXJ0eV9nZXRfbGluayhPQkpFQ1QoZGV2KSwgInBzaSIsIGVycnApOwog
ICAgIGlmICghb2JqKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIp
OwogICAgICAgICBlcnJvcl9wcmVwZW5kKGVycnAsICJyZXF1aXJlZCBsaW5rICdwc2knIG5vdCBm
b3VuZDogIik7CiAgICAgICAgIHJldHVybjsKICAgICB9CkBAIC03OTcsNyArNzkxLDYgQEAgc3Rh
dGljIHZvaWQgcG52X2xwY19pc2FfaXJxX2hhbmRsZXIodm9pZCAqb3BhcXVlLCBpbnQgbiwgaW50
IGxldmVsKQogCiBJU0FCdXMgKnBudl9scGNfaXNhX2NyZWF0ZShQbnZMcGNDb250cm9sbGVyICps
cGMsIGJvb2wgdXNlX2NwbGQsIEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqbG9jYWxfZXJy
ID0gTlVMTDsKICAgICBJU0FCdXMgKmlzYV9idXM7CiAgICAgcWVtdV9pcnEgKmlycXM7CiAgICAg
cWVtdV9pcnFfaGFuZGxlciBoYW5kbGVyOwpAQCAtODA2LDkgKzc5OSw4IEBAIElTQUJ1cyAqcG52
X2xwY19pc2FfY3JlYXRlKFBudkxwY0NvbnRyb2xsZXIgKmxwYywgYm9vbCB1c2VfY3BsZCwgRXJy
b3IgKiplcnJwKQogICAgICAqIGRldmljZXMgc3BlZmljaWVkIG9uIHRoZSBjb21tYW5kIGxpbmUg
d29uJ3QgZmluZCB0aGUgYnVzIGFuZAogICAgICAqIHdpbGwgZmFpbCB0byBjcmVhdGUuCiAgICAg
ICovCi0gICAgaXNhX2J1cyA9IGlzYV9idXNfbmV3KE5VTEwsICZscGMtPmlzYV9tZW0sICZscGMt
PmlzYV9pbywgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJv
cl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBpc2FfYnVzID0gaXNhX2J1c19uZXco
TlVMTCwgJmxwYy0+aXNhX21lbSwgJmxwYy0+aXNhX2lvLCBlcnJwKTsKKyAgICBpZiAoKmVycnAp
IHsKICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAgfQogCmRpZmYgLS1naXQgYS9ody9wcGMvcG52
X29jYy5jIGIvaHcvcHBjL3Budl9vY2MuYwppbmRleCA4YmVhZDJjOTMwLi4yNDhhYWM2NzU3IDEw
MDY0NAotLS0gYS9ody9wcGMvcG52X29jYy5jCisrKyBiL2h3L3BwYy9wbnZfb2NjLmMKQEAgLTE4
NCwxMyArMTg0LDExIEBAIHN0YXRpYyB2b2lkIHBudl9vY2NfcmVhbGl6ZShEZXZpY2VTdGF0ZSAq
ZGV2LCBFcnJvciAqKmVycnApCiAgICAgUG52T0NDICpvY2MgPSBQTlZfT0NDKGRldik7CiAgICAg
UG52T0NDQ2xhc3MgKnBvYyA9IFBOVl9PQ0NfR0VUX0NMQVNTKG9jYyk7CiAgICAgT2JqZWN0ICpv
Ymo7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICBvY2MtPm9jY21pc2MgPSAw
OwogCi0gICAgb2JqID0gb2JqZWN0X3Byb3BlcnR5X2dldF9saW5rKE9CSkVDVChkZXYpLCAicHNp
IiwgJmxvY2FsX2Vycik7CisgICAgb2JqID0gb2JqZWN0X3Byb3BlcnR5X2dldF9saW5rKE9CSkVD
VChkZXYpLCAicHNpIiwgZXJycCk7CiAgICAgaWYgKCFvYmopIHsKLSAgICAgICAgZXJyb3JfcHJv
cGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CiAgICAgICAgIGVycm9yX3ByZXBlbmQoZXJycCwgInJl
cXVpcmVkIGxpbmsgJ3BzaScgbm90IGZvdW5kOiAiKTsKICAgICAgICAgcmV0dXJuOwogICAgIH0K
ZGlmZiAtLWdpdCBhL2h3L3BwYy9wbnZfcHNpLmMgYi9ody9wcGMvcG52X3BzaS5jCmluZGV4IDg4
YmE4ZTdiOWIuLjdlMzE3MTJhMzEgMTAwNjQ0Ci0tLSBhL2h3L3BwYy9wbnZfcHNpLmMKKysrIGIv
aHcvcHBjL3Budl9wc2kuYwpAQCAtNDg2LDI3ICs0ODYsMjQgQEAgc3RhdGljIHZvaWQgcG52X3Bz
aV9wb3dlcjhfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgUG52
UHNpICpwc2kgPSBQTlZfUFNJKGRldik7CiAgICAgSUNTU3RhdGUgKmljcyA9ICZQTlY4X1BTSShw
c2kpLT5pY3M7CiAgICAgT2JqZWN0ICpvYmo7Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7CiAgICAg
dW5zaWduZWQgaW50IGk7CiAKLSAgICBvYmogPSBvYmplY3RfcHJvcGVydHlfZ2V0X2xpbmsoT0JK
RUNUKGRldiksICJ4aWNzIiwgJmVycik7CisgICAgb2JqID0gb2JqZWN0X3Byb3BlcnR5X2dldF9s
aW5rKE9CSkVDVChkZXYpLCAieGljcyIsIGVycnApOwogICAgIGlmICghb2JqKSB7CiAgICAgICAg
IGVycm9yX3NldGcoZXJycCwgIiVzOiByZXF1aXJlZCBsaW5rICd4aWNzJyBub3QgZm91bmQ6ICVz
IiwKLSAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgZXJyb3JfZ2V0X3ByZXR0eShlcnIpKTsK
KyAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgZXJyb3JfZ2V0X3ByZXR0eSgqZXJycCkpOwog
ICAgICAgICByZXR1cm47CiAgICAgfQogCiAgICAgLyogQ3JlYXRlIFBTSSBpbnRlcnJ1cHQgY29u
dHJvbCBzb3VyY2UgKi8KICAgICBvYmplY3RfcHJvcGVydHlfYWRkX2NvbnN0X2xpbmsoT0JKRUNU
KGljcyksIElDU19QUk9QX1hJQ1MsIG9iaiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgJmVycm9yX2Fib3J0KTsKLSAgICBvYmplY3RfcHJvcGVydHlfc2V0X2ludChPQkpFQ1Qo
aWNzKSwgUFNJX05VTV9JTlRFUlJVUFRTLCAibnItaXJxcyIsICZlcnIpOwotICAgIGlmIChlcnIp
IHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgb2JqZWN0X3Byb3Bl
cnR5X3NldF9pbnQoT0JKRUNUKGljcyksIFBTSV9OVU1fSU5URVJSVVBUUywgIm5yLWlycXMiLCBl
cnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KLSAgICBvYmpl
Y3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKGljcyksIHRydWUsICJyZWFsaXplZCIsICAmZXJy
KTsKLSAgICBpZiAoZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOwor
ICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoaWNzKSwgdHJ1ZSwgInJlYWxpemVk
IiwgIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCkBA
IC04MzQsNyArODMxLDYgQEAgc3RhdGljIHZvaWQgcG52X3BzaV9wb3dlcjlfcmVhbGl6ZShEZXZp
Y2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiB7CiAgICAgUG52UHNpICpwc2kgPSBQTlZfUFNJ
KGRldik7CiAgICAgWGl2ZVNvdXJjZSAqeHNyYyA9ICZQTlY5X1BTSShwc2kpLT5zb3VyY2U7Ci0g
ICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgaW50IGk7CiAKICAgICAvKiBUaGlzIGlz
IHRoZSBvbmx5IGRldmljZSB3aXRoIDRrIEVTQiBwYWdlcyAqLwpAQCAtODQ0LDkgKzg0MCw4IEBA
IHN0YXRpYyB2b2lkIHBudl9wc2lfcG93ZXI5X3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJy
b3IgKiplcnJwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICZlcnJvcl9mYXRhbCk7CiAg
ICAgb2JqZWN0X3Byb3BlcnR5X2FkZF9jb25zdF9saW5rKE9CSkVDVCh4c3JjKSwgInhpdmUiLCBP
QkpFQ1QocHNpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJmVycm9yX2Zh
dGFsKTsKLSAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKHhzcmMpLCB0cnVlLCAi
cmVhbGl6ZWQiLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVy
cm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRf
Ym9vbChPQkpFQ1QoeHNyYyksIHRydWUsICJyZWFsaXplZCIsIGVycnApOworICAgIGlmICgqZXJy
cCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCmRpZmYgLS1naXQgYS9ody9wcGMvc3BhcHIu
YyBiL2h3L3BwYy9zcGFwci5jCmluZGV4IDA4YTJhNWE3NzAuLjVlZjA0M2JkNzIgMTAwNjQ0Ci0t
LSBhL2h3L3BwYy9zcGFwci5jCisrKyBiL2h3L3BwYy9zcGFwci5jCkBAIC0yNTc1LDMwICsyNTc1
LDI5IEBAIHN0YXRpYyBDUFVBcmNoSWQgKnNwYXByX2ZpbmRfY3B1X3Nsb3QoTWFjaGluZVN0YXRl
ICptcywgdWludDMyX3QgaWQsIGludCAqaWR4KQogc3RhdGljIHZvaWQgc3BhcHJfc2V0X3ZzbXRf
bW9kZShTcGFwck1hY2hpbmVTdGF0ZSAqc3BhcHIsIEVycm9yICoqZXJycCkKIHsKICAgICBNYWNo
aW5lU3RhdGUgKm1zID0gTUFDSElORShzcGFwcik7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5V
TEw7CiAgICAgYm9vbCB2c210X3VzZXIgPSAhIXNwYXByLT52c210OwogICAgIGludCBrdm1fc210
ID0ga3ZtcHBjX3NtdF90aHJlYWRzKCk7CiAgICAgaW50IHJldDsKICAgICB1bnNpZ25lZCBpbnQg
c21wX3RocmVhZHMgPSBtcy0+c21wLnRocmVhZHM7CiAKICAgICBpZiAoIWt2bV9lbmFibGVkKCkg
JiYgKHNtcF90aHJlYWRzID4gMSkpIHsKLSAgICAgICAgZXJyb3Jfc2V0ZygmbG9jYWxfZXJyLCAi
VENHIGNhbm5vdCBzdXBwb3J0IG1vcmUgdGhhbiAxIHRocmVhZC9jb3JlICIKKyAgICAgICAgZXJy
b3Jfc2V0ZyhlcnJwLCAiVENHIGNhbm5vdCBzdXBwb3J0IG1vcmUgdGhhbiAxIHRocmVhZC9jb3Jl
ICIKICAgICAgICAgICAgICAgICAgICAgICJvbiBhIHBzZXJpZXMgbWFjaGluZSIpOwotICAgICAg
ICBnb3RvIG91dDsKKyAgICAgICAgcmV0dXJuOwogICAgIH0KICAgICBpZiAoIWlzX3Bvd2VyX29m
XzIoc21wX3RocmVhZHMpKSB7Ci0gICAgICAgIGVycm9yX3NldGcoJmxvY2FsX2VyciwgIkNhbm5v
dCBzdXBwb3J0ICVkIHRocmVhZHMvY29yZSBvbiBhIHBzZXJpZXMgIgorICAgICAgICBlcnJvcl9z
ZXRnKGVycnAsICJDYW5ub3Qgc3VwcG9ydCAlZCB0aHJlYWRzL2NvcmUgb24gYSBwc2VyaWVzICIK
ICAgICAgICAgICAgICAgICAgICAgICJtYWNoaW5lIGJlY2F1c2UgaXQgbXVzdCBiZSBhIHBvd2Vy
IG9mIDIiLCBzbXBfdGhyZWFkcyk7Ci0gICAgICAgIGdvdG8gb3V0OworICAgICAgICByZXR1cm47
CiAgICAgfQogCiAgICAgLyogRGV0ZW1pbmUgdGhlIFZTTVQgbW9kZSB0byB1c2U6ICovCiAgICAg
aWYgKHZzbXRfdXNlcikgewogICAgICAgICBpZiAoc3BhcHItPnZzbXQgPCBzbXBfdGhyZWFkcykg
ewotICAgICAgICAgICAgZXJyb3Jfc2V0ZygmbG9jYWxfZXJyLCAiQ2Fubm90IHN1cHBvcnQgVlNN
VCBtb2RlICVkIgorICAgICAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAiQ2Fubm90IHN1cHBvcnQg
VlNNVCBtb2RlICVkIgogICAgICAgICAgICAgICAgICAgICAgICAgICIgYmVjYXVzZSBpdCBtdXN0
IGJlID49IHRocmVhZHMvY29yZSAoJWQpIiwKICAgICAgICAgICAgICAgICAgICAgICAgICBzcGFw
ci0+dnNtdCwgc21wX3RocmVhZHMpOwotICAgICAgICAgICAgZ290byBvdXQ7CisgICAgICAgICAg
ICByZXR1cm47CiAgICAgICAgIH0KICAgICAgICAgLyogSW4gdGhpcyBjYXNlLCBzcGFwci0+dnNt
dCBoYXMgYmVlbiBzZXQgYnkgdGhlIGNvbW1hbmQgbGluZSAqLwogICAgIH0gZWxzZSB7CkBAIC0y
NjE3LDcgKzI2MTYsNyBAQCBzdGF0aWMgdm9pZCBzcGFwcl9zZXRfdnNtdF9tb2RlKFNwYXByTWFj
aGluZVN0YXRlICpzcGFwciwgRXJyb3IgKiplcnJwKQogICAgICAgICByZXQgPSBrdm1wcGNfc2V0
X3NtdF90aHJlYWRzKHNwYXByLT52c210KTsKICAgICAgICAgaWYgKHJldCkgewogICAgICAgICAg
ICAgLyogTG9va3MgbGlrZSBLVk0gaXNuJ3QgYWJsZSB0byBjaGFuZ2UgVlNNVCBtb2RlICovCi0g
ICAgICAgICAgICBlcnJvcl9zZXRnKCZsb2NhbF9lcnIsCisgICAgICAgICAgICBlcnJvcl9zZXRn
KGVycnAsCiAgICAgICAgICAgICAgICAgICAgICAgICJGYWlsZWQgdG8gc2V0IEtWTSdzIFZTTVQg
bW9kZSB0byAlZCAoZXJybm8gJWQpIiwKICAgICAgICAgICAgICAgICAgICAgICAgc3BhcHItPnZz
bXQsIHJldCk7CiAgICAgICAgICAgICAvKiBXZSBjYW4gbGl2ZSB3aXRoIHRoYXQgaWYgdGhlIGRl
ZmF1bHQgb25lIGlzIGJpZyBlbm91Z2gKQEAgLTI2MjUsMjUgKzI2MjQsMjIgQEAgc3RhdGljIHZv
aWQgc3BhcHJfc2V0X3ZzbXRfbW9kZShTcGFwck1hY2hpbmVTdGF0ZSAqc3BhcHIsIEVycm9yICoq
ZXJycCkKICAgICAgICAgICAgICAqIHdlIHdhbnQuICBJbiB0aGlzIGNhc2Ugd2UnbGwgd2FzdGUg
c29tZSB2Y3B1IGlkcywgYnV0CiAgICAgICAgICAgICAgKiBiZWhhdmlvdXIgd2lsbCBiZSBjb3Jy
ZWN0ICovCiAgICAgICAgICAgICBpZiAoKGt2bV9zbXQgPj0gc21wX3RocmVhZHMpICYmICgoc3Bh
cHItPnZzbXQgJSBrdm1fc210KSA9PSAwKSkgewotICAgICAgICAgICAgICAgIHdhcm5fcmVwb3J0
X2Vycihsb2NhbF9lcnIpOwotICAgICAgICAgICAgICAgIGxvY2FsX2VyciA9IE5VTEw7Ci0gICAg
ICAgICAgICAgICAgZ290byBvdXQ7CisgICAgICAgICAgICAgICAgd2Fybl9yZXBvcnRfZXJycChl
cnJwKTsKKyAgICAgICAgICAgICAgICAqZXJycCA9IE5VTEw7CisgICAgICAgICAgICAgICAgcmV0
dXJuOwogICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICBpZiAoIXZzbXRfdXNl
cikgewotICAgICAgICAgICAgICAgICAgICBlcnJvcl9hcHBlbmRfaGludCgmbG9jYWxfZXJyLAor
ICAgICAgICAgICAgICAgICAgICBlcnJvcl9hcHBlbmRfaGludChlcnJwLAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAiT24gUFBDLCBhIFZNIHdpdGggJWQgdGhyZWFkcy9j
b3JlIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiIG9uIGEgaG9zdCB3
aXRoICVkIHRocmVhZHMvY29yZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIiByZXF1aXJlcyB0aGUgdXNlIG9mIFZTTVQgbW9kZSAlZC5cbiIsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHNtcF90aHJlYWRzLCBrdm1fc210LCBzcGFwci0+dnNt
dCk7CiAgICAgICAgICAgICAgICAgfQotICAgICAgICAgICAgICAgIGt2bXBwY19oaW50X3NtdF9w
b3NzaWJsZSgmbG9jYWxfZXJyKTsKLSAgICAgICAgICAgICAgICBnb3RvIG91dDsKKyAgICAgICAg
ICAgICAgICBrdm1wcGNfaGludF9zbXRfcG9zc2libGUoZXJycCk7CisgICAgICAgICAgICAgICAg
cmV0dXJuOwogICAgICAgICAgICAgfQogICAgICAgICB9CiAgICAgfQotICAgIC8qIGVsc2UgVENH
OiBub3RoaW5nIHRvIGRvIGN1cnJlbnRseSAqLwotb3V0OgotICAgIGVycm9yX3Byb3BhZ2F0ZShl
cnJwLCBsb2NhbF9lcnIpOwogfQogCiBzdGF0aWMgdm9pZCBzcGFwcl9pbml0X2NwdXMoU3BhcHJN
YWNoaW5lU3RhdGUgKnNwYXByKQpAQCAtMzQ1OCwyMiArMzQ1NCwyMCBAQCBzdGF0aWMgdm9pZCBz
cGFwcl9hZGRfbG1icyhEZXZpY2VTdGF0ZSAqZGV2LCB1aW50NjRfdCBhZGRyX3N0YXJ0LCB1aW50
NjRfdCBzaXplLAogICAgIGludCBpOwogICAgIHVpbnQ2NF90IGFkZHIgPSBhZGRyX3N0YXJ0Owog
ICAgIGJvb2wgaG90cGx1Z2dlZCA9IHNwYXByX2RyY19ob3RwbHVnZ2VkKGRldik7Ci0gICAgRXJy
b3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICBmb3IgKGkgPSAwOyBpIDwgbnJfbG1iczsgaSsr
KSB7CiAgICAgICAgIGRyYyA9IHNwYXByX2RyY19ieV9pZChUWVBFX1NQQVBSX0RSQ19MTUIsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRyIC8gU1BBUFJfTUVNT1JZX0JMT0NLX1NJ
WkUpOwogICAgICAgICBnX2Fzc2VydChkcmMpOwogCi0gICAgICAgIHNwYXByX2RyY19hdHRhY2go
ZHJjLCBkZXYsICZsb2NhbF9lcnIpOwotICAgICAgICBpZiAobG9jYWxfZXJyKSB7CisgICAgICAg
IHNwYXByX2RyY19hdHRhY2goZHJjLCBkZXYsIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsK
ICAgICAgICAgICAgIHdoaWxlIChhZGRyID4gYWRkcl9zdGFydCkgewogICAgICAgICAgICAgICAg
IGFkZHIgLT0gU1BBUFJfTUVNT1JZX0JMT0NLX1NJWkU7CiAgICAgICAgICAgICAgICAgZHJjID0g
c3BhcHJfZHJjX2J5X2lkKFRZUEVfU1BBUFJfRFJDX0xNQiwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgYWRkciAvIFNQQVBSX01FTU9SWV9CTE9DS19TSVpFKTsKICAgICAg
ICAgICAgICAgICBzcGFwcl9kcmNfZGV0YWNoKGRyYyk7CiAgICAgICAgICAgICB9Ci0gICAgICAg
ICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKICAgICAgICAgICAgIHJldHVy
bjsKICAgICAgICAgfQogICAgICAgICBpZiAoIWhvdHBsdWdnZWQpIHsKQEAgLTM1MDEsMjcgKzM0
OTUsMjYgQEAgc3RhdGljIHZvaWQgc3BhcHJfYWRkX2xtYnMoRGV2aWNlU3RhdGUgKmRldiwgdWlu
dDY0X3QgYWRkcl9zdGFydCwgdWludDY0X3Qgc2l6ZSwKIHN0YXRpYyB2b2lkIHNwYXByX21lbW9y
eV9wbHVnKEhvdHBsdWdIYW5kbGVyICpob3RwbHVnX2RldiwgRGV2aWNlU3RhdGUgKmRldiwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAq
bG9jYWxfZXJyID0gTlVMTDsKICAgICBTcGFwck1hY2hpbmVTdGF0ZSAqbXMgPSBTUEFQUl9NQUNI
SU5FKGhvdHBsdWdfZGV2KTsKICAgICBQQ0RJTU1EZXZpY2UgKmRpbW0gPSBQQ19ESU1NKGRldik7
CiAgICAgdWludDY0X3Qgc2l6ZSwgYWRkcjsKIAogICAgIHNpemUgPSBtZW1vcnlfZGV2aWNlX2dl
dF9yZWdpb25fc2l6ZShNRU1PUllfREVWSUNFKGRldiksICZlcnJvcl9hYm9ydCk7CiAKLSAgICBw
Y19kaW1tX3BsdWcoZGltbSwgTUFDSElORShtcyksICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2Nh
bF9lcnIpIHsKKyAgICBwY19kaW1tX3BsdWcoZGltbSwgTUFDSElORShtcyksIGVycnApOworICAg
IGlmICgqZXJycCkgewogICAgICAgICBnb3RvIG91dDsKICAgICB9CiAKICAgICBhZGRyID0gb2Jq
ZWN0X3Byb3BlcnR5X2dldF91aW50KE9CSkVDVChkaW1tKSwKLSAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIFBDX0RJTU1fQUREUl9QUk9QLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAo
bG9jYWxfZXJyKSB7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQ19ESU1N
X0FERFJfUFJPUCwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8gb3V0X3Vu
cGx1ZzsKICAgICB9CiAKICAgICBzcGFwcl9hZGRfbG1icyhkZXYsIGFkZHIsIHNpemUsIHNwYXBy
X292ZWNfdGVzdChtcy0+b3Y1X2NhcywgT1Y1X0hQX0VWVCksCi0gICAgICAgICAgICAgICAgICAg
JmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgeworICAgICAgICAgICAgICAgICAgIGVy
cnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICBnb3RvIG91dF91bnBsdWc7CiAgICAgfQog
CkBAIC0zNTMwLDcgKzM1MjMsNiBAQCBzdGF0aWMgdm9pZCBzcGFwcl9tZW1vcnlfcGx1ZyhIb3Rw
bHVnSGFuZGxlciAqaG90cGx1Z19kZXYsIERldmljZVN0YXRlICpkZXYsCiBvdXRfdW5wbHVnOgog
ICAgIHBjX2RpbW1fdW5wbHVnKGRpbW0sIE1BQ0hJTkUobXMpKTsKIG91dDoKLSAgICBlcnJvcl9w
cm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKIH0KIAogc3RhdGljIHZvaWQgc3BhcHJfbWVtb3J5
X3ByZV9wbHVnKEhvdHBsdWdIYW5kbGVyICpob3RwbHVnX2RldiwgRGV2aWNlU3RhdGUgKmRldiwK
QEAgLTM1MzksNyArMzUzMSw2IEBAIHN0YXRpYyB2b2lkIHNwYXByX21lbW9yeV9wcmVfcGx1ZyhI
b3RwbHVnSGFuZGxlciAqaG90cGx1Z19kZXYsIERldmljZVN0YXRlICpkZXYsCiAgICAgY29uc3Qg
U3BhcHJNYWNoaW5lQ2xhc3MgKnNtYyA9IFNQQVBSX01BQ0hJTkVfR0VUX0NMQVNTKGhvdHBsdWdf
ZGV2KTsKICAgICBTcGFwck1hY2hpbmVTdGF0ZSAqc3BhcHIgPSBTUEFQUl9NQUNISU5FKGhvdHBs
dWdfZGV2KTsKICAgICBQQ0RJTU1EZXZpY2UgKmRpbW0gPSBQQ19ESU1NKGRldik7Ci0gICAgRXJy
b3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgdWludDY0X3Qgc2l6ZTsKICAgICBPYmplY3QgKm1l
bWRldjsKICAgICBod2FkZHIgcGFnZXNpemU7CkBAIC0zNTQ5LDkgKzM1NDAsOCBAQCBzdGF0aWMg
dm9pZCBzcGFwcl9tZW1vcnlfcHJlX3BsdWcoSG90cGx1Z0hhbmRsZXIgKmhvdHBsdWdfZGV2LCBE
ZXZpY2VTdGF0ZSAqZGV2LAogICAgICAgICByZXR1cm47CiAgICAgfQogCi0gICAgc2l6ZSA9IG1l
bW9yeV9kZXZpY2VfZ2V0X3JlZ2lvbl9zaXplKE1FTU9SWV9ERVZJQ0UoZGltbSksICZsb2NhbF9l
cnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAs
IGxvY2FsX2Vycik7CisgICAgc2l6ZSA9IG1lbW9yeV9kZXZpY2VfZ2V0X3JlZ2lvbl9zaXplKE1F
TU9SWV9ERVZJQ0UoZGltbSksIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1
cm47CiAgICAgfQogCkBAIC0zNTY0LDkgKzM1NTQsOCBAQCBzdGF0aWMgdm9pZCBzcGFwcl9tZW1v
cnlfcHJlX3BsdWcoSG90cGx1Z0hhbmRsZXIgKmhvdHBsdWdfZGV2LCBEZXZpY2VTdGF0ZSAqZGV2
LAogICAgIG1lbWRldiA9IG9iamVjdF9wcm9wZXJ0eV9nZXRfbGluayhPQkpFQ1QoZGltbSksIFBD
X0RJTU1fTUVNREVWX1BST1AsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICZlcnJvcl9hYm9ydCk7CiAgICAgcGFnZXNpemUgPSBob3N0X21lbW9yeV9iYWNrZW5kX3BhZ2Vz
aXplKE1FTU9SWV9CQUNLRU5EKG1lbWRldikpOwotICAgIHNwYXByX2NoZWNrX3BhZ2VzaXplKHNw
YXByLCBwYWdlc2l6ZSwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAg
ICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBzcGFwcl9jaGVja19wYWdl
c2l6ZShzcGFwciwgcGFnZXNpemUsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICBy
ZXR1cm47CiAgICAgfQogCkBAIC0zNjkxLDcgKzM2ODAsNiBAQCBzdGF0aWMgdm9pZCBzcGFwcl9t
ZW1vcnlfdW5wbHVnX3JlcXVlc3QoSG90cGx1Z0hhbmRsZXIgKmhvdHBsdWdfZGV2LAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERldmljZVN0YXRlICpkZXYsIEVycm9y
ICoqZXJycCkKIHsKICAgICBTcGFwck1hY2hpbmVTdGF0ZSAqc3BhcHIgPSBTUEFQUl9NQUNISU5F
KGhvdHBsdWdfZGV2KTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBQQ0RJTU1E
ZXZpY2UgKmRpbW0gPSBQQ19ESU1NKGRldik7CiAgICAgdWludDMyX3QgbnJfbG1iczsKICAgICB1
aW50NjRfdCBzaXplLCBhZGRyX3N0YXJ0LCBhZGRyOwpAQCAtMzcwMiw5ICszNjkwLDkgQEAgc3Rh
dGljIHZvaWQgc3BhcHJfbWVtb3J5X3VucGx1Z19yZXF1ZXN0KEhvdHBsdWdIYW5kbGVyICpob3Rw
bHVnX2RldiwKICAgICBucl9sbWJzID0gc2l6ZSAvIFNQQVBSX01FTU9SWV9CTE9DS19TSVpFOwog
CiAgICAgYWRkcl9zdGFydCA9IG9iamVjdF9wcm9wZXJ0eV9nZXRfdWludChPQkpFQ1QoZGltbSks
IFBDX0RJTU1fQUREUl9QUk9QLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGdvdG8gb3V0
OworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJwKTsKKyAgICBp
ZiAoKmVycnApIHsKKyAgICAgICAgcmV0dXJuOwogICAgIH0KIAogICAgIC8qCkBAIC0zNzE0LDEw
ICszNzAyLDEwIEBAIHN0YXRpYyB2b2lkIHNwYXByX21lbW9yeV91bnBsdWdfcmVxdWVzdChIb3Rw
bHVnSGFuZGxlciAqaG90cGx1Z19kZXYsCiAgICAgICogYmFpbCBvdXQgdG8gYXZvaWQgZGV0YWNo
aW5nIERSQ3MgdGhhdCB3ZXJlIGFscmVhZHkgcmVsZWFzZWQuCiAgICAgICovCiAgICAgaWYgKHNw
YXByX3BlbmRpbmdfZGltbV91bnBsdWdzX2ZpbmQoc3BhcHIsIGRpbW0pKSB7Ci0gICAgICAgIGVy
cm9yX3NldGcoJmxvY2FsX2VyciwKKyAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLAogICAgICAgICAg
ICAgICAgICAgICJNZW1vcnkgdW5wbHVnIGFscmVhZHkgaW4gcHJvZ3Jlc3MgZm9yIGRldmljZSAl
cyIsCiAgICAgICAgICAgICAgICAgICAgZGV2LT5pZCk7Ci0gICAgICAgIGdvdG8gb3V0OworICAg
ICAgICByZXR1cm47CiAgICAgfQogCiAgICAgc3BhcHJfcGVuZGluZ19kaW1tX3VucGx1Z3NfYWRk
KHNwYXByLCBucl9sbWJzLCBkaW1tKTsKQEAgLTM3MzYsOCArMzcyNCw2IEBAIHN0YXRpYyB2b2lk
IHNwYXByX21lbW9yeV91bnBsdWdfcmVxdWVzdChIb3RwbHVnSGFuZGxlciAqaG90cGx1Z19kZXYs
CiAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJfc3RhcnQgLyBTUEFQUl9NRU1PUllfQkxP
Q0tfU0laRSk7CiAgICAgc3BhcHJfaG90cGx1Z19yZXFfcmVtb3ZlX2J5X2NvdW50X2luZGV4ZWQo
U1BBUFJfRFJfQ09OTkVDVE9SX1RZUEVfTE1CLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIG5yX2xtYnMsIHNwYXByX2RyY19pbmRleChkcmMpKTsKLW91dDoK
LSAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKIH0KIAogLyogQ2FsbGJhY2sg
dG8gYmUgY2FsbGVkIGR1cmluZyBEUkMgcmVsZWFzZS4gKi8KQEAgLTM4MzIsNyArMzgxOCw2IEBA
IHN0YXRpYyB2b2lkIHNwYXByX2NvcmVfcGx1ZyhIb3RwbHVnSGFuZGxlciAqaG90cGx1Z19kZXYs
IERldmljZVN0YXRlICpkZXYsCiAgICAgQ1BVQ29yZSAqY2MgPSBDUFVfQ09SRShkZXYpOwogICAg
IENQVVN0YXRlICpjczsKICAgICBTcGFwckRyYyAqZHJjOwotICAgIEVycm9yICpsb2NhbF9lcnIg
PSBOVUxMOwogICAgIENQVUFyY2hJZCAqY29yZV9zbG90OwogICAgIGludCBpbmRleDsKICAgICBi
b29sIGhvdHBsdWdnZWQgPSBzcGFwcl9kcmNfaG90cGx1Z2dlZChkZXYpOwpAQCAtMzg1MCw5ICsz
ODM1LDggQEAgc3RhdGljIHZvaWQgc3BhcHJfY29yZV9wbHVnKEhvdHBsdWdIYW5kbGVyICpob3Rw
bHVnX2RldiwgRGV2aWNlU3RhdGUgKmRldiwKICAgICBnX2Fzc2VydChkcmMgfHwgIW1jLT5oYXNf
aG90cGx1Z2dhYmxlX2NwdXMpOwogCiAgICAgaWYgKGRyYykgewotICAgICAgICBzcGFwcl9kcmNf
YXR0YWNoKGRyYywgZGV2LCAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYgKGxvY2FsX2Vycikgewot
ICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgIHNw
YXByX2RyY19hdHRhY2goZHJjLCBkZXYsIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKICAg
ICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQogCkBAIC0zODgzLDkgKzM4NjcsOCBAQCBzdGF0
aWMgdm9pZCBzcGFwcl9jb3JlX3BsdWcoSG90cGx1Z0hhbmRsZXIgKmhvdHBsdWdfZGV2LCBEZXZp
Y2VTdGF0ZSAqZGV2LAogICAgIGlmIChob3RwbHVnZ2VkKSB7CiAgICAgICAgIGZvciAoaSA9IDA7
IGkgPCBjYy0+bnJfdGhyZWFkczsgaSsrKSB7CiAgICAgICAgICAgICBwcGNfc2V0X2NvbXBhdChj
b3JlLT50aHJlYWRzW2ldLCBQT1dFUlBDX0NQVShmaXJzdF9jcHUpLT5jb21wYXRfcHZyLAotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgJmxvY2FsX2Vycik7Ci0gICAgICAgICAgICBpZiAobG9j
YWxfZXJyKSB7Ci0gICAgICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vy
cik7CisgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJwKTsKKyAgICAgICAgICAgIGlmICgq
ZXJycCkgewogICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgIH0KICAgICAgICAg
fQpAQCAtMzg5Nyw3ICszODgwLDYgQEAgc3RhdGljIHZvaWQgc3BhcHJfY29yZV9wcmVfcGx1ZyhI
b3RwbHVnSGFuZGxlciAqaG90cGx1Z19kZXYsIERldmljZVN0YXRlICpkZXYsCiB7CiAgICAgTWFj
aGluZVN0YXRlICptYWNoaW5lID0gTUFDSElORShPQkpFQ1QoaG90cGx1Z19kZXYpKTsKICAgICBN
YWNoaW5lQ2xhc3MgKm1jID0gTUFDSElORV9HRVRfQ0xBU1MoaG90cGx1Z19kZXYpOwotICAgIEVy
cm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIENQVUNvcmUgKmNjID0gQ1BVX0NPUkUoZGV2KTsK
ICAgICBjb25zdCBjaGFyICpiYXNlX2NvcmVfdHlwZSA9IHNwYXByX2dldF9jcHVfY29yZV90eXBl
KG1hY2hpbmUtPmNwdV90eXBlKTsKICAgICBjb25zdCBjaGFyICp0eXBlID0gb2JqZWN0X2dldF90
eXBlbmFtZShPQkpFQ1QoZGV2KSk7CkBAIC0zOTA2LDE4ICszODg4LDE4IEBAIHN0YXRpYyB2b2lk
IHNwYXByX2NvcmVfcHJlX3BsdWcoSG90cGx1Z0hhbmRsZXIgKmhvdHBsdWdfZGV2LCBEZXZpY2VT
dGF0ZSAqZGV2LAogICAgIHVuc2lnbmVkIGludCBzbXBfdGhyZWFkcyA9IG1hY2hpbmUtPnNtcC50
aHJlYWRzOwogCiAgICAgaWYgKGRldi0+aG90cGx1Z2dlZCAmJiAhbWMtPmhhc19ob3RwbHVnZ2Fi
bGVfY3B1cykgewotICAgICAgICBlcnJvcl9zZXRnKCZsb2NhbF9lcnIsICJDUFUgaG90cGx1ZyBu
b3Qgc3VwcG9ydGVkIGZvciB0aGlzIG1hY2hpbmUiKTsKLSAgICAgICAgZ290byBvdXQ7CisgICAg
ICAgIGVycm9yX3NldGcoZXJycCwgIkNQVSBob3RwbHVnIG5vdCBzdXBwb3J0ZWQgZm9yIHRoaXMg
bWFjaGluZSIpOworICAgICAgICByZXR1cm47CiAgICAgfQogCiAgICAgaWYgKHN0cmNtcChiYXNl
X2NvcmVfdHlwZSwgdHlwZSkpIHsKLSAgICAgICAgZXJyb3Jfc2V0ZygmbG9jYWxfZXJyLCAiQ1BV
IGNvcmUgdHlwZSBzaG91bGQgYmUgJXMiLCBiYXNlX2NvcmVfdHlwZSk7Ci0gICAgICAgIGdvdG8g
b3V0OworICAgICAgICBlcnJvcl9zZXRnKGVycnAsICJDUFUgY29yZSB0eXBlIHNob3VsZCBiZSAl
cyIsIGJhc2VfY29yZV90eXBlKTsKKyAgICAgICAgcmV0dXJuOwogICAgIH0KIAogICAgIGlmIChj
Yy0+Y29yZV9pZCAlIHNtcF90aHJlYWRzKSB7Ci0gICAgICAgIGVycm9yX3NldGcoJmxvY2FsX2Vy
ciwgImludmFsaWQgY29yZSBpZCAlZCIsIGNjLT5jb3JlX2lkKTsKLSAgICAgICAgZ290byBvdXQ7
CisgICAgICAgIGVycm9yX3NldGcoZXJycCwgImludmFsaWQgY29yZSBpZCAlZCIsIGNjLT5jb3Jl
X2lkKTsKKyAgICAgICAgcmV0dXJuOwogICAgIH0KIAogICAgIC8qCkBAIC0zOTI3LDI2ICszOTA5
LDIzIEBAIHN0YXRpYyB2b2lkIHNwYXByX2NvcmVfcHJlX3BsdWcoSG90cGx1Z0hhbmRsZXIgKmhv
dHBsdWdfZGV2LCBEZXZpY2VTdGF0ZSAqZGV2LAogICAgICAqIHRvdGFsIHZjcHVzIG5vdCBhIG11
bHRpcGxlIG9mIHRocmVhZHMtcGVyLWNvcmUuCiAgICAgICovCiAgICAgaWYgKG1jLT5oYXNfaG90
cGx1Z2dhYmxlX2NwdXMgJiYgKGNjLT5ucl90aHJlYWRzICE9IHNtcF90aHJlYWRzKSkgewotICAg
ICAgICBlcnJvcl9zZXRnKCZsb2NhbF9lcnIsICJpbnZhbGlkIG5yLXRocmVhZHMgJWQsIG11c3Qg
YmUgJWQiLAorICAgICAgICBlcnJvcl9zZXRnKGVycnAsICJpbnZhbGlkIG5yLXRocmVhZHMgJWQs
IG11c3QgYmUgJWQiLAogICAgICAgICAgICAgICAgICAgIGNjLT5ucl90aHJlYWRzLCBzbXBfdGhy
ZWFkcyk7Ci0gICAgICAgIGdvdG8gb3V0OworICAgICAgICByZXR1cm47CiAgICAgfQogCiAgICAg
Y29yZV9zbG90ID0gc3BhcHJfZmluZF9jcHVfc2xvdChNQUNISU5FKGhvdHBsdWdfZGV2KSwgY2Mt
PmNvcmVfaWQsICZpbmRleCk7CiAgICAgaWYgKCFjb3JlX3Nsb3QpIHsKLSAgICAgICAgZXJyb3Jf
c2V0ZygmbG9jYWxfZXJyLCAiY29yZSBpZCAlZCBvdXQgb2YgcmFuZ2UiLCBjYy0+Y29yZV9pZCk7
Ci0gICAgICAgIGdvdG8gb3V0OworICAgICAgICBlcnJvcl9zZXRnKGVycnAsICJjb3JlIGlkICVk
IG91dCBvZiByYW5nZSIsIGNjLT5jb3JlX2lkKTsKKyAgICAgICAgcmV0dXJuOwogICAgIH0KIAog
ICAgIGlmIChjb3JlX3Nsb3QtPmNwdSkgewotICAgICAgICBlcnJvcl9zZXRnKCZsb2NhbF9lcnIs
ICJjb3JlICVkIGFscmVhZHkgcG9wdWxhdGVkIiwgY2MtPmNvcmVfaWQpOwotICAgICAgICBnb3Rv
IG91dDsKKyAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAiY29yZSAlZCBhbHJlYWR5IHBvcHVsYXRl
ZCIsIGNjLT5jb3JlX2lkKTsKKyAgICAgICAgcmV0dXJuOwogICAgIH0KIAotICAgIG51bWFfY3B1
X3ByZV9wbHVnKGNvcmVfc2xvdCwgZGV2LCAmbG9jYWxfZXJyKTsKLQotb3V0OgotICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIG51bWFfY3B1X3ByZV9wbHVnKGNvcmVf
c2xvdCwgZGV2LCBlcnJwKTsKIH0KIAogaW50IHNwYXByX3BoYl9kdF9wb3B1bGF0ZShTcGFwckRy
YyAqZHJjLCBTcGFwck1hY2hpbmVTdGF0ZSAqc3BhcHIsCkBAIC00MDEwLDcgKzM5ODksNiBAQCBz
dGF0aWMgdm9pZCBzcGFwcl9waGJfcGx1ZyhIb3RwbHVnSGFuZGxlciAqaG90cGx1Z19kZXYsIERl
dmljZVN0YXRlICpkZXYsCiAgICAgU3BhcHJQaGJTdGF0ZSAqc3BoYiA9IFNQQVBSX1BDSV9IT1NU
X0JSSURHRShkZXYpOwogICAgIFNwYXByRHJjICpkcmM7CiAgICAgYm9vbCBob3RwbHVnZ2VkID0g
c3BhcHJfZHJjX2hvdHBsdWdnZWQoZGV2KTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsK
IAogICAgIGlmICghc21jLT5kcl9waGJfZW5hYmxlZCkgewogICAgICAgICByZXR1cm47CkBAIC00
MDIwLDkgKzM5OTgsOCBAQCBzdGF0aWMgdm9pZCBzcGFwcl9waGJfcGx1ZyhIb3RwbHVnSGFuZGxl
ciAqaG90cGx1Z19kZXYsIERldmljZVN0YXRlICpkZXYsCiAgICAgLyogaG90cGx1ZyBob29rcyBz
aG91bGQgY2hlY2sgaXQncyBlbmFibGVkIGJlZm9yZSBnZXR0aW5nIHRoaXMgZmFyICovCiAgICAg
YXNzZXJ0KGRyYyk7CiAKLSAgICBzcGFwcl9kcmNfYXR0YWNoKGRyYywgREVWSUNFKGRldiksICZs
b2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRl
KGVycnAsIGxvY2FsX2Vycik7CisgICAgc3BhcHJfZHJjX2F0dGFjaChkcmMsIERFVklDRShkZXYp
LCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApkaWZm
IC0tZ2l0IGEvaHcvcHBjL3NwYXByX2NhcHMuYyBiL2h3L3BwYy9zcGFwcl9jYXBzLmMKaW5kZXgg
NDgxZGZkMmEyNy4uNTEzYTVkYWQzNCAxMDA2NDQKLS0tIGEvaHcvcHBjL3NwYXByX2NhcHMuYwor
KysgYi9ody9wcGMvc3BhcHJfY2Fwcy5jCkBAIC04NiwxMSArODYsOSBAQCBzdGF0aWMgdm9pZCBz
cGFwcl9jYXBfc2V0X2Jvb2woT2JqZWN0ICpvYmosIFZpc2l0b3IgKnYsIGNvbnN0IGNoYXIgKm5h
bWUsCiAgICAgU3BhcHJDYXBhYmlsaXR5SW5mbyAqY2FwID0gb3BhcXVlOwogICAgIFNwYXByTWFj
aGluZVN0YXRlICpzcGFwciA9IFNQQVBSX01BQ0hJTkUob2JqKTsKICAgICBib29sIHZhbHVlOwot
ICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCi0gICAgdmlzaXRfdHlwZV9ib29sKHYsIG5h
bWUsICZ2YWx1ZSwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBl
cnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICB2aXNpdF90eXBlX2Jvb2wodiwg
bmFtZSwgJnZhbHVlLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwog
ICAgIH0KIApAQCAtMTIzLDEzICsxMjEsMTEgQEAgc3RhdGljIHZvaWQgc3BhcHJfY2FwX3NldF9z
dHJpbmcoT2JqZWN0ICpvYmosIFZpc2l0b3IgKnYsIGNvbnN0IGNoYXIgKm5hbWUsCiB7CiAgICAg
U3BhcHJDYXBhYmlsaXR5SW5mbyAqY2FwID0gb3BhcXVlOwogICAgIFNwYXByTWFjaGluZVN0YXRl
ICpzcGFwciA9IFNQQVBSX01BQ0hJTkUob2JqKTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVM
TDsKICAgICB1aW50OF90IGk7CiAgICAgY2hhciAqdmFsOwogCi0gICAgdmlzaXRfdHlwZV9zdHIo
diwgbmFtZSwgJnZhbCwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAg
ICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICB2aXNpdF90eXBlX3N0cih2
LCBuYW1lLCAmdmFsLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwog
ICAgIH0KIApAQCAtMTY5LDExICsxNjUsOSBAQCBzdGF0aWMgdm9pZCBzcGFwcl9jYXBfc2V0X3Bh
Z2VzaXplKE9iamVjdCAqb2JqLCBWaXNpdG9yICp2LCBjb25zdCBjaGFyICpuYW1lLAogICAgIFNw
YXByTWFjaGluZVN0YXRlICpzcGFwciA9IFNQQVBSX01BQ0hJTkUob2JqKTsKICAgICB1aW50NjRf
dCBwYWdlc2l6ZTsKICAgICB1aW50OF90IHZhbDsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVM
TDsKIAotICAgIHZpc2l0X3R5cGVfc2l6ZSh2LCBuYW1lLCAmcGFnZXNpemUsICZsb2NhbF9lcnIp
OwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxv
Y2FsX2Vycik7CisgICAgdmlzaXRfdHlwZV9zaXplKHYsIG5hbWUsICZwYWdlc2l6ZSwgZXJycCk7
CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKQEAgLTI0OCwxMiAr
MjQyLDExIEBAIFNwYXByQ2FwUG9zc2libGUgY2FwX2NmcGNfcG9zc2libGUgPSB7CiBzdGF0aWMg
dm9pZCBjYXBfc2FmZV9jYWNoZV9hcHBseShTcGFwck1hY2hpbmVTdGF0ZSAqc3BhcHIsIHVpbnQ4
X3QgdmFsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJwKQog
ewotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIHVpbnQ4X3Qga3ZtX3ZhbCA9ICBr
dm1wcGNfZ2V0X2NhcF9zYWZlX2NhY2hlKCk7CiAKICAgICBpZiAodGNnX2VuYWJsZWQoKSAmJiB2
YWwpIHsKICAgICAgICAgLyogVENHIG9ubHkgc3VwcG9ydHMgYnJva2VuLCBhbGxvdyBvdGhlciB2
YWx1ZXMgYW5kIHByaW50IGEgd2FybmluZyAqLwotICAgICAgICBlcnJvcl9zZXRnKCZsb2NhbF9l
cnIsCisgICAgICAgIGVycm9yX3NldGcoZXJycCwKICAgICAgICAgICAgICAgICAgICAiVENHIGRv
ZXNuJ3Qgc3VwcG9ydCByZXF1ZXN0ZWQgZmVhdHVyZSwgY2FwLWNmcGM9JXMiLAogICAgICAgICAg
ICAgICAgICAgIGNhcF9jZnBjX3Bvc3NpYmxlLnZhbHNbdmFsXSk7CiAgICAgfSBlbHNlIGlmIChr
dm1fZW5hYmxlZCgpICYmICh2YWwgPiBrdm1fdmFsKSkgewpAQCAtMjYzLDggKzI1Niw4IEBAIHN0
YXRpYyB2b2lkIGNhcF9zYWZlX2NhY2hlX2FwcGx5KFNwYXByTWFjaGluZVN0YXRlICpzcGFwciwg
dWludDhfdCB2YWwsCiAgICAgICAgICAgICAgICAgICAgY2FwX2NmcGNfcG9zc2libGUudmFsc1tr
dm1fdmFsXSk7CiAgICAgfQogCi0gICAgaWYgKGxvY2FsX2VyciAhPSBOVUxMKQotICAgICAgICB3
YXJuX3JlcG9ydF9lcnIobG9jYWxfZXJyKTsKKyAgICBpZiAoKmVycnAgIT0gTlVMTCkKKyAgICAg
ICAgd2Fybl9yZXBvcnRfZXJycChlcnJwKTsKIH0KIAogU3BhcHJDYXBQb3NzaWJsZSBjYXBfc2Ji
Y19wb3NzaWJsZSA9IHsKQEAgLTI3NywxMiArMjcwLDExIEBAIFNwYXByQ2FwUG9zc2libGUgY2Fw
X3NiYmNfcG9zc2libGUgPSB7CiBzdGF0aWMgdm9pZCBjYXBfc2FmZV9ib3VuZHNfY2hlY2tfYXBw
bHkoU3BhcHJNYWNoaW5lU3RhdGUgKnNwYXByLCB1aW50OF90IHZhbCwKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJyb3IgKmxv
Y2FsX2VyciA9IE5VTEw7CiAgICAgdWludDhfdCBrdm1fdmFsID0gIGt2bXBwY19nZXRfY2FwX3Nh
ZmVfYm91bmRzX2NoZWNrKCk7CiAKICAgICBpZiAodGNnX2VuYWJsZWQoKSAmJiB2YWwpIHsKICAg
ICAgICAgLyogVENHIG9ubHkgc3VwcG9ydHMgYnJva2VuLCBhbGxvdyBvdGhlciB2YWx1ZXMgYW5k
IHByaW50IGEgd2FybmluZyAqLwotICAgICAgICBlcnJvcl9zZXRnKCZsb2NhbF9lcnIsCisgICAg
ICAgIGVycm9yX3NldGcoZXJycCwKICAgICAgICAgICAgICAgICAgICAiVENHIGRvZXNuJ3Qgc3Vw
cG9ydCByZXF1ZXN0ZWQgZmVhdHVyZSwgY2FwLXNiYmM9JXMiLAogICAgICAgICAgICAgICAgICAg
IGNhcF9zYmJjX3Bvc3NpYmxlLnZhbHNbdmFsXSk7CiAgICAgfSBlbHNlIGlmIChrdm1fZW5hYmxl
ZCgpICYmICh2YWwgPiBrdm1fdmFsKSkgewpAQCAtMjkyLDggKzI4NCw4IEBAIHN0YXRpYyB2b2lk
IGNhcF9zYWZlX2JvdW5kc19jaGVja19hcHBseShTcGFwck1hY2hpbmVTdGF0ZSAqc3BhcHIsIHVp
bnQ4X3QgdmFsLAogICAgICAgICAgICAgICAgICAgIGNhcF9zYmJjX3Bvc3NpYmxlLnZhbHNba3Zt
X3ZhbF0pOwogICAgIH0KIAotICAgIGlmIChsb2NhbF9lcnIgIT0gTlVMTCkKLSAgICAgICAgd2Fy
bl9yZXBvcnRfZXJyKGxvY2FsX2Vycik7CisgICAgaWYgKCplcnJwICE9IE5VTEwpCisgICAgICAg
IHdhcm5fcmVwb3J0X2VycnAoZXJycCk7CiB9CiAKIFNwYXByQ2FwUG9zc2libGUgY2FwX2lic19w
b3NzaWJsZSA9IHsKQEAgLTMwOSwxMiArMzAxLDExIEBAIFNwYXByQ2FwUG9zc2libGUgY2FwX2li
c19wb3NzaWJsZSA9IHsKIHN0YXRpYyB2b2lkIGNhcF9zYWZlX2luZGlyZWN0X2JyYW5jaF9hcHBs
eShTcGFwck1hY2hpbmVTdGF0ZSAqc3BhcHIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgdWludDhfdCB2YWwsIEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAq
bG9jYWxfZXJyID0gTlVMTDsKICAgICB1aW50OF90IGt2bV92YWwgPSBrdm1wcGNfZ2V0X2NhcF9z
YWZlX2luZGlyZWN0X2JyYW5jaCgpOwogCiAgICAgaWYgKHRjZ19lbmFibGVkKCkgJiYgdmFsKSB7
CiAgICAgICAgIC8qIFRDRyBvbmx5IHN1cHBvcnRzIGJyb2tlbiwgYWxsb3cgb3RoZXIgdmFsdWVz
IGFuZCBwcmludCBhIHdhcm5pbmcgKi8KLSAgICAgICAgZXJyb3Jfc2V0ZygmbG9jYWxfZXJyLAor
ICAgICAgICBlcnJvcl9zZXRnKGVycnAsCiAgICAgICAgICAgICAgICAgICAgIlRDRyBkb2Vzbid0
IHN1cHBvcnQgcmVxdWVzdGVkIGZlYXR1cmUsIGNhcC1pYnM9JXMiLAogICAgICAgICAgICAgICAg
ICAgIGNhcF9pYnNfcG9zc2libGUudmFsc1t2YWxdKTsKICAgICB9IGVsc2UgaWYgKGt2bV9lbmFi
bGVkKCkgJiYgKHZhbCA+IGt2bV92YWwpKSB7CkBAIC0zMjQsOCArMzE1LDggQEAgc3RhdGljIHZv
aWQgY2FwX3NhZmVfaW5kaXJlY3RfYnJhbmNoX2FwcGx5KFNwYXByTWFjaGluZVN0YXRlICpzcGFw
ciwKICAgICAgICAgICAgICAgICAgICBjYXBfaWJzX3Bvc3NpYmxlLnZhbHNba3ZtX3ZhbF0pOwog
ICAgIH0KIAotICAgIGlmIChsb2NhbF9lcnIgIT0gTlVMTCkgewotICAgICAgICB3YXJuX3JlcG9y
dF9lcnIobG9jYWxfZXJyKTsKKyAgICBpZiAoKmVycnAgIT0gTlVMTCkgeworICAgICAgICB3YXJu
X3JlcG9ydF9lcnJwKGVycnApOwogICAgIH0KIH0KIApAQCAtNzg3LDcgKzc3OCw2IEBAIHZvaWQg
c3BhcHJfY2Fwc19jcHVfYXBwbHkoU3BhcHJNYWNoaW5lU3RhdGUgKnNwYXByLCBQb3dlclBDQ1BV
ICpjcHUpCiAKIHZvaWQgc3BhcHJfY2Fwc19hZGRfcHJvcGVydGllcyhTcGFwck1hY2hpbmVDbGFz
cyAqc21jLCBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAg
ICAgT2JqZWN0Q2xhc3MgKmtsYXNzID0gT0JKRUNUX0NMQVNTKHNtYyk7CiAgICAgaW50IGk7CiAK
QEAgLTc5OCwxOSArNzg4LDE3IEBAIHZvaWQgc3BhcHJfY2Fwc19hZGRfcHJvcGVydGllcyhTcGFw
ck1hY2hpbmVDbGFzcyAqc21jLCBFcnJvciAqKmVycnApCiAKICAgICAgICAgb2JqZWN0X2NsYXNz
X3Byb3BlcnR5X2FkZChrbGFzcywgbmFtZSwgY2FwLT50eXBlLAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGNhcC0+Z2V0LCBjYXAtPnNldCwKLSAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBOVUxMLCBjYXAsICZsb2NhbF9lcnIpOwotICAgICAgICBpZiAobG9jYWxf
ZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOVUxMLCBjYXAsIGVycnApOworICAgICAg
ICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIGdfZnJlZShuYW1lKTsKICAgICAgICAgICAgIHJl
dHVybjsKICAgICAgICAgfQogCiAgICAgICAgIGRlc2MgPSBnX3N0cmR1cF9wcmludGYoIiVzIiwg
Y2FwLT5kZXNjcmlwdGlvbik7Ci0gICAgICAgIG9iamVjdF9jbGFzc19wcm9wZXJ0eV9zZXRfZGVz
Y3JpcHRpb24oa2xhc3MsIG5hbWUsIGRlc2MsICZsb2NhbF9lcnIpOworICAgICAgICBvYmplY3Rf
Y2xhc3NfcHJvcGVydHlfc2V0X2Rlc2NyaXB0aW9uKGtsYXNzLCBuYW1lLCBkZXNjLCBlcnJwKTsK
ICAgICAgICAgZ19mcmVlKG5hbWUpOwogICAgICAgICBnX2ZyZWUoZGVzYyk7Ci0gICAgICAgIGlm
IChsb2NhbF9lcnIpIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9l
cnIpOworICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAg
fQogICAgIH0KZGlmZiAtLWdpdCBhL2h3L3BwYy9zcGFwcl9jcHVfY29yZS5jIGIvaHcvcHBjL3Nw
YXByX2NwdV9jb3JlLmMKaW5kZXggMWQ5M2RlODE2MS4uOTNmOWIwZTBjOSAxMDA2NDQKLS0tIGEv
aHcvcHBjL3NwYXByX2NwdV9jb3JlLmMKKysrIGIvaHcvcHBjL3NwYXByX2NwdV9jb3JlLmMKQEAg
LTIyMSwxMCArMjIxLDkgQEAgc3RhdGljIHZvaWQgc3BhcHJfcmVhbGl6ZV92Y3B1KFBvd2VyUEND
UFUgKmNwdSwgU3BhcHJNYWNoaW5lU3RhdGUgKnNwYXByLAogewogICAgIENQVVBQQ1N0YXRlICpl
bnYgPSAmY3B1LT5lbnY7CiAgICAgQ1BVU3RhdGUgKmNzID0gQ1BVKGNwdSk7Ci0gICAgRXJyb3Ig
KmxvY2FsX2VyciA9IE5VTEw7CiAKLSAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNU
KGNwdSksIHRydWUsICJyZWFsaXplZCIsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIp
IHsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKGNwdSksIHRydWUsICJyZWFs
aXplZCIsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICBnb3RvIGVycm9yOwogICAg
IH0KIApAQCAtMjM3LDggKzIzNiw4IEBAIHN0YXRpYyB2b2lkIHNwYXByX3JlYWxpemVfdmNwdShQ
b3dlclBDQ1BVICpjcHUsIFNwYXByTWFjaGluZVN0YXRlICpzcGFwciwKICAgICBxZW11X3JlZ2lz
dGVyX3Jlc2V0KHNwYXByX2NwdV9yZXNldCwgY3B1KTsKICAgICBzcGFwcl9jcHVfcmVzZXQoY3B1
KTsKIAotICAgIHNwYXByLT5pcnEtPmNwdV9pbnRjX2NyZWF0ZShzcGFwciwgY3B1LCAmbG9jYWxf
ZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7CisgICAgc3BhcHItPmlycS0+Y3B1X2ludGNfY3Jl
YXRlKHNwYXByLCBjcHUsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICBnb3RvIGVy
cm9yX3VucmVnaXN0ZXI7CiAgICAgfQogCkBAIC0yNTMsNyArMjUyLDYgQEAgZXJyb3JfdW5yZWdp
c3RlcjoKICAgICBxZW11X3VucmVnaXN0ZXJfcmVzZXQoc3BhcHJfY3B1X3Jlc2V0LCBjcHUpOwog
ICAgIGNwdV9yZW1vdmVfc3luYyhDUFUoY3B1KSk7CiBlcnJvcjoKLSAgICBlcnJvcl9wcm9wYWdh
dGUoZXJycCwgbG9jYWxfZXJyKTsKIH0KIAogc3RhdGljIFBvd2VyUENDUFUgKnNwYXByX2NyZWF0
ZV92Y3B1KFNwYXByQ3B1Q29yZSAqc2MsIGludCBpLCBFcnJvciAqKmVycnApCkBAIC0yNjQsMjQg
KzI2MiwyMyBAQCBzdGF0aWMgUG93ZXJQQ0NQVSAqc3BhcHJfY3JlYXRlX3ZjcHUoU3BhcHJDcHVD
b3JlICpzYywgaW50IGksIEVycm9yICoqZXJycCkKICAgICBjaGFyICppZDsKICAgICBDUFVTdGF0
ZSAqY3M7CiAgICAgUG93ZXJQQ0NQVSAqY3B1OwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxM
OwogCiAgICAgb2JqID0gb2JqZWN0X25ldyhzY2MtPmNwdV90eXBlKTsKIAogICAgIGNzID0gQ1BV
KG9iaik7CiAgICAgY3B1ID0gUE9XRVJQQ19DUFUob2JqKTsKICAgICBjcy0+Y3B1X2luZGV4ID0g
Y2MtPmNvcmVfaWQgKyBpOwotICAgIHNwYXByX3NldF92Y3B1X2lkKGNwdSwgY3MtPmNwdV9pbmRl
eCwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgeworICAgIHNwYXByX3NldF92Y3B1
X2lkKGNwdSwgY3MtPmNwdV9pbmRleCwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAg
IGdvdG8gZXJyOwogICAgIH0KIAogICAgIGNwdS0+bm9kZV9pZCA9IHNjLT5ub2RlX2lkOwogCiAg
ICAgaWQgPSBnX3N0cmR1cF9wcmludGYoInRocmVhZFslZF0iLCBpKTsKLSAgICBvYmplY3RfcHJv
cGVydHlfYWRkX2NoaWxkKE9CSkVDVChzYyksIGlkLCBvYmosICZsb2NhbF9lcnIpOworICAgIG9i
amVjdF9wcm9wZXJ0eV9hZGRfY2hpbGQoT0JKRUNUKHNjKSwgaWQsIG9iaiwgZXJycCk7CiAgICAg
Z19mcmVlKGlkKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7CisgICAgaWYgKCplcnJwKSB7CiAgICAg
ICAgIGdvdG8gZXJyOwogICAgIH0KIApAQCAtMjkyLDcgKzI4OSw2IEBAIHN0YXRpYyBQb3dlclBD
Q1BVICpzcGFwcl9jcmVhdGVfdmNwdShTcGFwckNwdUNvcmUgKnNjLCBpbnQgaSwgRXJyb3IgKipl
cnJwKQogCiBlcnI6CiAgICAgb2JqZWN0X3VucmVmKG9iaik7Ci0gICAgZXJyb3JfcHJvcGFnYXRl
KGVycnAsIGxvY2FsX2Vycik7CiAgICAgcmV0dXJuIE5VTEw7CiB9CiAKQEAgLTMxNSw3ICszMTEs
NiBAQCBzdGF0aWMgdm9pZCBzcGFwcl9jcHVfY29yZV9yZWFsaXplKERldmljZVN0YXRlICpkZXYs
IEVycm9yICoqZXJycCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgVFlQRV9TUEFQUl9NQUNISU5FKTsKICAgICBTcGFwckNwdUNvcmUgKnNjID0gU1BB
UFJfQ1BVX0NPUkUoT0JKRUNUKGRldikpOwogICAgIENQVUNvcmUgKmNjID0gQ1BVX0NPUkUoT0JK
RUNUKGRldikpOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIGludCBpLCBqOwog
CiAgICAgaWYgKCFzcGFwcikgewpAQCAtMzI1LDE1ICszMjAsMTUgQEAgc3RhdGljIHZvaWQgc3Bh
cHJfY3B1X2NvcmVfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAKICAg
ICBzYy0+dGhyZWFkcyA9IGdfbmV3KFBvd2VyUENDUFUgKiwgY2MtPm5yX3RocmVhZHMpOwogICAg
IGZvciAoaSA9IDA7IGkgPCBjYy0+bnJfdGhyZWFkczsgaSsrKSB7Ci0gICAgICAgIHNjLT50aHJl
YWRzW2ldID0gc3BhcHJfY3JlYXRlX3ZjcHUoc2MsIGksICZsb2NhbF9lcnIpOwotICAgICAgICBp
ZiAobG9jYWxfZXJyKSB7CisgICAgICAgIHNjLT50aHJlYWRzW2ldID0gc3BhcHJfY3JlYXRlX3Zj
cHUoc2MsIGksIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIGdvdG8g
ZXJyOwogICAgICAgICB9CiAgICAgfQogCiAgICAgZm9yIChqID0gMDsgaiA8IGNjLT5ucl90aHJl
YWRzOyBqKyspIHsKLSAgICAgICAgc3BhcHJfcmVhbGl6ZV92Y3B1KHNjLT50aHJlYWRzW2pdLCBz
cGFwciwgc2MsICZsb2NhbF9lcnIpOwotICAgICAgICBpZiAobG9jYWxfZXJyKSB7CisgICAgICAg
IHNwYXByX3JlYWxpemVfdmNwdShzYy0+dGhyZWFkc1tqXSwgc3BhcHIsIHNjLCBlcnJwKTsKKyAg
ICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICBnb3RvIGVycl91bnJlYWxpemU7CiAgICAg
ICAgIH0KICAgICB9CkBAIC0zNDgsNyArMzQzLDYgQEAgZXJyOgogICAgICAgICBzcGFwcl9kZWxl
dGVfdmNwdShzYy0+dGhyZWFkc1tpXSwgc2MpOwogICAgIH0KICAgICBnX2ZyZWUoc2MtPnRocmVh
ZHMpOwotICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogfQogCiBzdGF0aWMg
UHJvcGVydHkgc3BhcHJfY3B1X2NvcmVfcHJvcGVydGllc1tdID0gewpkaWZmIC0tZ2l0IGEvaHcv
cHBjL3NwYXByX2RyYy5jIGIvaHcvcHBjL3NwYXByX2RyYy5jCmluZGV4IDYyZjFhNDI1OTIuLjc2
ZDgxZDAyMzggMTAwNjQ0Ci0tLSBhL2h3L3BwYy9zcGFwcl9kcmMuYworKysgYi9ody9wcGMvc3Bh
cHJfZHJjLmMKQEAgLTMwMSw3ICszMDEsNiBAQCBzdGF0aWMgdm9pZCBwcm9wX2dldF9mZHQoT2Jq
ZWN0ICpvYmosIFZpc2l0b3IgKnYsIGNvbnN0IGNoYXIgKm5hbWUsCiB7CiAgICAgU3BhcHJEcmMg
KmRyYyA9IFNQQVBSX0RSX0NPTk5FQ1RPUihvYmopOwogICAgIFFOdWxsICpudWxsID0gTlVMTDsK
LSAgICBFcnJvciAqZXJyID0gTlVMTDsKICAgICBpbnQgZmR0X29mZnNldF9uZXh0LCBmZHRfb2Zm
c2V0LCBmZHRfZGVwdGg7CiAgICAgdm9pZCAqZmR0OwogCkBAIC0zMjYsMTkgKzMyNSwxNyBAQCBz
dGF0aWMgdm9pZCBwcm9wX2dldF9mZHQoT2JqZWN0ICpvYmosIFZpc2l0b3IgKnYsIGNvbnN0IGNo
YXIgKm5hbWUsCiAgICAgICAgIGNhc2UgRkRUX0JFR0lOX05PREU6CiAgICAgICAgICAgICBmZHRf
ZGVwdGgrKzsKICAgICAgICAgICAgIG5hbWUgPSBmZHRfZ2V0X25hbWUoZmR0LCBmZHRfb2Zmc2V0
LCAmbmFtZV9sZW4pOwotICAgICAgICAgICAgdmlzaXRfc3RhcnRfc3RydWN0KHYsIG5hbWUsIE5V
TEwsIDAsICZlcnIpOwotICAgICAgICAgICAgaWYgKGVycikgewotICAgICAgICAgICAgICAgIGVy
cm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgICAgICAgICAgdmlzaXRfc3RhcnRfc3RydWN0
KHYsIG5hbWUsIE5VTEwsIDAsIGVycnApOworICAgICAgICAgICAgaWYgKCplcnJwKSB7CiAgICAg
ICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgfQogICAgICAgICAgICAgYnJlYWs7CiAg
ICAgICAgIGNhc2UgRkRUX0VORF9OT0RFOgogICAgICAgICAgICAgLyogc2hvdWxkbid0IGV2ZXIg
c2VlIGFuIEZEVF9FTkRfTk9ERSBiZWZvcmUgRkRUX0JFR0lOX05PREUgKi8KICAgICAgICAgICAg
IGdfYXNzZXJ0KGZkdF9kZXB0aCA+IDApOwotICAgICAgICAgICAgdmlzaXRfY2hlY2tfc3RydWN0
KHYsICZlcnIpOworICAgICAgICAgICAgdmlzaXRfY2hlY2tfc3RydWN0KHYsIGVycnApOwogICAg
ICAgICAgICAgdmlzaXRfZW5kX3N0cnVjdCh2LCBOVUxMKTsKLSAgICAgICAgICAgIGlmIChlcnIp
IHsKLSAgICAgICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAg
ICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgIH0K
ICAgICAgICAgICAgIGZkdF9kZXB0aC0tOwpAQCAtMzQ3LDIyICszNDQsMTkgQEAgc3RhdGljIHZv
aWQgcHJvcF9nZXRfZmR0KE9iamVjdCAqb2JqLCBWaXNpdG9yICp2LCBjb25zdCBjaGFyICpuYW1l
LAogICAgICAgICAgICAgaW50IGk7CiAgICAgICAgICAgICBwcm9wID0gZmR0X2dldF9wcm9wZXJ0
eV9ieV9vZmZzZXQoZmR0LCBmZHRfb2Zmc2V0LCAmcHJvcF9sZW4pOwogICAgICAgICAgICAgbmFt
ZSA9IGZkdF9zdHJpbmcoZmR0LCBmZHQzMl90b19jcHUocHJvcC0+bmFtZW9mZikpOwotICAgICAg
ICAgICAgdmlzaXRfc3RhcnRfbGlzdCh2LCBuYW1lLCBOVUxMLCAwLCAmZXJyKTsKLSAgICAgICAg
ICAgIGlmIChlcnIpIHsKLSAgICAgICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJy
KTsKKyAgICAgICAgICAgIHZpc2l0X3N0YXJ0X2xpc3QodiwgbmFtZSwgTlVMTCwgMCwgZXJycCk7
CisgICAgICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAg
ICAgICAgICB9CiAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcHJvcF9sZW47IGkrKykgewot
ICAgICAgICAgICAgICAgIHZpc2l0X3R5cGVfdWludDgodiwgTlVMTCwgKHVpbnQ4X3QgKikmcHJv
cC0+ZGF0YVtpXSwgJmVycik7Ci0gICAgICAgICAgICAgICAgaWYgKGVycikgewotICAgICAgICAg
ICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgICAgICAgICB2
aXNpdF90eXBlX3VpbnQ4KHYsIE5VTEwsICh1aW50OF90ICopJnByb3AtPmRhdGFbaV0sIGVycnAp
OworICAgICAgICAgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgICAgICAgICByZXR1
cm47CiAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgfQotICAgICAgICAgICAgdmlzaXRf
Y2hlY2tfbGlzdCh2LCAmZXJyKTsKKyAgICAgICAgICAgIHZpc2l0X2NoZWNrX2xpc3QodiwgZXJy
cCk7CiAgICAgICAgICAgICB2aXNpdF9lbmRfbGlzdCh2LCBOVUxMKTsKLSAgICAgICAgICAgIGlm
IChlcnIpIHsKLSAgICAgICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAg
ICAgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAg
ICAgIH0KICAgICAgICAgICAgIGJyZWFrOwpAQCAtNDg5LDcgKzQ4Myw2IEBAIHN0YXRpYyB2b2lk
IHJlYWxpemUoRGV2aWNlU3RhdGUgKmQsIEVycm9yICoqZXJycCkKICAgICBPYmplY3QgKnJvb3Rf
Y29udGFpbmVyOwogICAgIGdjaGFyICpsaW5rX25hbWU7CiAgICAgZ2NoYXIgKmNoaWxkX25hbWU7
Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7CiAKICAgICB0cmFjZV9zcGFwcl9kcmNfcmVhbGl6ZShz
cGFwcl9kcmNfaW5kZXgoZHJjKSk7CiAgICAgLyogTk9URTogd2UgZG8gdGhpcyBhcyBwYXJ0IG9m
IHJlYWxpemUvdW5yZWFsaXplIGR1ZSB0byB0aGUgZmFjdApAQCAtNTA0LDExICs0OTcsMTAgQEAg
c3RhdGljIHZvaWQgcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZCwgRXJyb3IgKiplcnJwKQogICAgIGNo
aWxkX25hbWUgPSBvYmplY3RfZ2V0X2Nhbm9uaWNhbF9wYXRoX2NvbXBvbmVudChPQkpFQ1QoZHJj
KSk7CiAgICAgdHJhY2Vfc3BhcHJfZHJjX3JlYWxpemVfY2hpbGQoc3BhcHJfZHJjX2luZGV4KGRy
YyksIGNoaWxkX25hbWUpOwogICAgIG9iamVjdF9wcm9wZXJ0eV9hZGRfYWxpYXMocm9vdF9jb250
YWluZXIsIGxpbmtfbmFtZSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyYy0+b3du
ZXIsIGNoaWxkX25hbWUsICZlcnIpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJj
LT5vd25lciwgY2hpbGRfbmFtZSwgZXJycCk7CiAgICAgZ19mcmVlKGNoaWxkX25hbWUpOwogICAg
IGdfZnJlZShsaW5rX25hbWUpOwotICAgIGlmIChlcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFn
YXRlKGVycnAsIGVycik7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9
CiAgICAgdm1zdGF0ZV9yZWdpc3RlcihERVZJQ0UoZHJjKSwgc3BhcHJfZHJjX2luZGV4KGRyYyks
ICZ2bXN0YXRlX3NwYXByX2RyYywKQEAgLTYxMSwxMSArNjAzLDkgQEAgc3RhdGljIHZvaWQgZHJj
X3BoeXNpY2FsX3Jlc2V0KHZvaWQgKm9wYXF1ZSkKIHN0YXRpYyB2b2lkIHJlYWxpemVfcGh5c2lj
YWwoRGV2aWNlU3RhdGUgKmQsIEVycm9yICoqZXJycCkKIHsKICAgICBTcGFwckRyY1BoeXNpY2Fs
ICpkcmNwID0gU1BBUFJfRFJDX1BIWVNJQ0FMKGQpOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBO
VUxMOwogCi0gICAgcmVhbGl6ZShkLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7
Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHJlYWxpemUo
ZCwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKQEAg
LTYyNywxMSArNjE3LDkgQEAgc3RhdGljIHZvaWQgcmVhbGl6ZV9waHlzaWNhbChEZXZpY2VTdGF0
ZSAqZCwgRXJyb3IgKiplcnJwKQogc3RhdGljIHZvaWQgdW5yZWFsaXplX3BoeXNpY2FsKERldmlj
ZVN0YXRlICpkLCBFcnJvciAqKmVycnApCiB7CiAgICAgU3BhcHJEcmNQaHlzaWNhbCAqZHJjcCA9
IFNQQVBSX0RSQ19QSFlTSUNBTChkKTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAot
ICAgIHVucmVhbGl6ZShkLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAg
ICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHVucmVhbGl6ZShkLCBl
cnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApkaWZmIC0t
Z2l0IGEvaHcvcHBjL3NwYXByX2lycS5jIGIvaHcvcHBjL3NwYXByX2lycS5jCmluZGV4IDA2ZmUy
NDMyYmEuLjdmNmQyYzQ1OGQgMTAwNjQ0Ci0tLSBhL2h3L3BwYy9zcGFwcl9pcnEuYworKysgYi9o
dy9wcGMvc3BhcHJfaXJxLmMKQEAgLTYzLDE4ICs2MywxNiBAQCBzdGF0aWMgdm9pZCBzcGFwcl9p
cnFfaW5pdF9rdm0oU3BhcHJNYWNoaW5lU3RhdGUgKnNwYXByLAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIFNwYXBySXJxICppcnEsIEVycm9yICoqZXJycCkKIHsKICAgICBNYWNo
aW5lU3RhdGUgKm1hY2hpbmUgPSBNQUNISU5FKHNwYXByKTsKLSAgICBFcnJvciAqbG9jYWxfZXJy
ID0gTlVMTDsKIAogICAgIGlmIChrdm1fZW5hYmxlZCgpICYmIG1hY2hpbmVfa2VybmVsX2lycWNo
aXBfYWxsb3dlZChtYWNoaW5lKSkgewotICAgICAgICBpcnEtPmluaXRfa3ZtKHNwYXByLCAmbG9j
YWxfZXJyKTsKLSAgICAgICAgaWYgKGxvY2FsX2VyciAmJiBtYWNoaW5lX2tlcm5lbF9pcnFjaGlw
X3JlcXVpcmVkKG1hY2hpbmUpKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcmVwZW5kKCZsb2NhbF9l
cnIsCisgICAgICAgIGlycS0+aW5pdF9rdm0oc3BhcHIsIGVycnApOworICAgICAgICBpZiAoKmVy
cnAgJiYgbWFjaGluZV9rZXJuZWxfaXJxY2hpcF9yZXF1aXJlZChtYWNoaW5lKSkgeworICAgICAg
ICAgICAgZXJyb3JfcHJlcGVuZChlcnJwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAia2Vy
bmVsX2lycWNoaXAgcmVxdWVzdGVkIGJ1dCB1bmF2YWlsYWJsZTogIik7Ci0gICAgICAgICAgICBl
cnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKICAgICAgICAgICAgIHJldHVybjsKICAg
ICAgICAgfQogCi0gICAgICAgIGlmICghbG9jYWxfZXJyKSB7CisgICAgICAgIGlmICghKmVycnAp
IHsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQogCkBAIC04Miw5ICs4MCw5IEBAIHN0
YXRpYyB2b2lkIHNwYXByX2lycV9pbml0X2t2bShTcGFwck1hY2hpbmVTdGF0ZSAqc3BhcHIsCiAg
ICAgICAgICAqIFdlIGZhaWxlZCB0byBpbml0aWFsaXplIHRoZSBLVk0gZGV2aWNlLCBmYWxsYmFj
ayB0bwogICAgICAgICAgKiBlbXVsYXRlZCBtb2RlCiAgICAgICAgICAqLwotICAgICAgICBlcnJv
cl9wcmVwZW5kKCZsb2NhbF9lcnIsICJrZXJuZWxfaXJxY2hpcCBhbGxvd2VkIGJ1dCB1bmF2YWls
YWJsZTogIik7Ci0gICAgICAgIGVycm9yX2FwcGVuZF9oaW50KCZsb2NhbF9lcnIsICJGYWxsaW5n
IGJhY2sgdG8ga2VybmVsLWlycWNoaXA9b2ZmXG4iKTsKLSAgICAgICAgd2Fybl9yZXBvcnRfZXJy
KGxvY2FsX2Vycik7CisgICAgICAgIGVycm9yX3ByZXBlbmQoZXJycCwgImtlcm5lbF9pcnFjaGlw
IGFsbG93ZWQgYnV0IHVuYXZhaWxhYmxlOiAiKTsKKyAgICAgICAgZXJyb3JfYXBwZW5kX2hpbnQo
ZXJycCwgIkZhbGxpbmcgYmFjayB0byBrZXJuZWwtaXJxY2hpcD1vZmZcbiIpOworICAgICAgICB3
YXJuX3JlcG9ydF9lcnJwKGVycnApOwogICAgIH0KIH0KIApAQCAtOTYsMTYgKzk0LDE0IEBAIHN0
YXRpYyB2b2lkIHNwYXByX2lycV9pbml0X3hpY3MoU3BhcHJNYWNoaW5lU3RhdGUgKnNwYXByLCBp
bnQgbnJfaXJxcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJw
KQogewogICAgIE9iamVjdCAqb2JqOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAg
ICAgb2JqID0gb2JqZWN0X25ldyhUWVBFX0lDU19TSU1QTEUpOwogICAgIG9iamVjdF9wcm9wZXJ0
eV9hZGRfY2hpbGQoT0JKRUNUKHNwYXByKSwgImljcyIsIG9iaiwgJmVycm9yX2Fib3J0KTsKICAg
ICBvYmplY3RfcHJvcGVydHlfYWRkX2NvbnN0X2xpbmsob2JqLCBJQ1NfUFJPUF9YSUNTLCBPQkpF
Q1Qoc3BhcHIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmZXJyb3JfZmF0
YWwpOwogICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfaW50KG9iaiwgbnJfaXJxcywgIm5yLWlycXMi
LCAgJmVycm9yX2ZhdGFsKTsKLSAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2wob2JqLCB0cnVl
LCAicmVhbGl6ZWQiLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAg
IGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIG9iamVjdF9wcm9wZXJ0eV9z
ZXRfYm9vbChvYmosIHRydWUsICJyZWFsaXplZCIsIGVycnApOworICAgIGlmICgqZXJycCkgewog
ICAgICAgICByZXR1cm47CiAgICAgfQogCkBAIC0xODMsMTQgKzE3OSwxMiBAQCBzdGF0aWMgdm9p
ZCBzcGFwcl9pcnFfcHJpbnRfaW5mb194aWNzKFNwYXByTWFjaGluZVN0YXRlICpzcGFwciwgTW9u
aXRvciAqbW9uKQogc3RhdGljIHZvaWQgc3BhcHJfaXJxX2NwdV9pbnRjX2NyZWF0ZV94aWNzKFNw
YXByTWFjaGluZVN0YXRlICpzcGFwciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBQb3dlclBDQ1BVICpjcHUsIEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAq
bG9jYWxfZXJyID0gTlVMTDsKICAgICBPYmplY3QgKm9iajsKICAgICBTcGFwckNwdVN0YXRlICpz
cGFwcl9jcHUgPSBzcGFwcl9jcHVfc3RhdGUoY3B1KTsKIAogICAgIG9iaiA9IGljcF9jcmVhdGUo
T0JKRUNUKGNwdSksIFRZUEVfSUNQLCBYSUNTX0ZBQlJJQyhzcGFwciksCi0gICAgICAgICAgICAg
ICAgICAgICAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICAgICAgICAgICAgICAgZXJycCk7
CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKQEAgLTIxOCwxMSAr
MjEyLDggQEAgc3RhdGljIHZvaWQgc3BhcHJfaXJxX3NldF9pcnFfeGljcyh2b2lkICpvcGFxdWUs
IGludCBzcmNubywgaW50IHZhbCkKIAogc3RhdGljIHZvaWQgc3BhcHJfaXJxX3Jlc2V0X3hpY3Mo
U3BhcHJNYWNoaW5lU3RhdGUgKnNwYXByLCBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJyb3IgKmxv
Y2FsX2VyciA9IE5VTEw7Ci0KLSAgICBzcGFwcl9pcnFfaW5pdF9rdm0oc3BhcHIsICZzcGFwcl9p
cnFfeGljcywgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJv
cl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBzcGFwcl9pcnFfaW5pdF9rdm0oc3Bh
cHIsICZzcGFwcl9pcnFfeGljcywgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJl
dHVybjsKICAgICB9CiB9CkBAIC0zNDAsMTMgKzMzMSwxMSBAQCBzdGF0aWMgdm9pZCBzcGFwcl9p
cnFfcHJpbnRfaW5mb194aXZlKFNwYXByTWFjaGluZVN0YXRlICpzcGFwciwKIHN0YXRpYyB2b2lk
IHNwYXByX2lycV9jcHVfaW50Y19jcmVhdGVfeGl2ZShTcGFwck1hY2hpbmVTdGF0ZSAqc3BhcHIs
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG93ZXJQQ0NQVSAq
Y3B1LCBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAg
T2JqZWN0ICpvYmo7CiAgICAgU3BhcHJDcHVTdGF0ZSAqc3BhcHJfY3B1ID0gc3BhcHJfY3B1X3N0
YXRlKGNwdSk7CiAKLSAgICBvYmogPSB4aXZlX3RjdHhfY3JlYXRlKE9CSkVDVChjcHUpLCBYSVZF
X1JPVVRFUihzcGFwci0+eGl2ZSksICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsK
LSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgb2JqID0geGl2
ZV90Y3R4X2NyZWF0ZShPQkpFQ1QoY3B1KSwgWElWRV9ST1VURVIoc3BhcHItPnhpdmUpLCBlcnJw
KTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApAQCAtMzY3LDcg
KzM1Niw2IEBAIHN0YXRpYyBpbnQgc3BhcHJfaXJxX3Bvc3RfbG9hZF94aXZlKFNwYXByTWFjaGlu
ZVN0YXRlICpzcGFwciwgaW50IHZlcnNpb25faWQpCiBzdGF0aWMgdm9pZCBzcGFwcl9pcnFfcmVz
ZXRfeGl2ZShTcGFwck1hY2hpbmVTdGF0ZSAqc3BhcHIsIEVycm9yICoqZXJycCkKIHsKICAgICBD
UFVTdGF0ZSAqY3M7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICBDUFVfRk9S
RUFDSChjcykgewogICAgICAgICBQb3dlclBDQ1BVICpjcHUgPSBQT1dFUlBDX0NQVShjcyk7CkBA
IC0zNzYsOSArMzY0LDggQEAgc3RhdGljIHZvaWQgc3BhcHJfaXJxX3Jlc2V0X3hpdmUoU3BhcHJN
YWNoaW5lU3RhdGUgKnNwYXByLCBFcnJvciAqKmVycnApCiAgICAgICAgIHNwYXByX3hpdmVfc2V0
X3RjdHhfb3NfY2FtKHNwYXByX2NwdV9zdGF0ZShjcHUpLT50Y3R4KTsKICAgICB9CiAKLSAgICBz
cGFwcl9pcnFfaW5pdF9rdm0oc3BhcHIsICZzcGFwcl9pcnFfeGl2ZSwgJmxvY2FsX2Vycik7Ci0g
ICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxf
ZXJyKTsKKyAgICBzcGFwcl9pcnFfaW5pdF9rdm0oc3BhcHIsICZzcGFwcl9pcnFfeGl2ZSwgZXJy
cCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKQEAgLTQ1OCwx
NyArNDQ1LDEzIEBAIHN0YXRpYyBTcGFwcklycSAqc3BhcHJfaXJxX2N1cnJlbnQoU3BhcHJNYWNo
aW5lU3RhdGUgKnNwYXByKQogc3RhdGljIHZvaWQgc3BhcHJfaXJxX2luaXRfZHVhbChTcGFwck1h
Y2hpbmVTdGF0ZSAqc3BhcHIsIGludCBucl9pcnFzLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7Ci0K
LSAgICBzcGFwcl9pcnFfeGljcy5pbml0KHNwYXByLCBzcGFwcl9pcnFfeGljcy5ucl9pcnFzLCAm
bG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0
ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHNwYXByX2lycV94aWNzLmluaXQoc3BhcHIsIHNwYXBy
X2lycV94aWNzLm5yX2lycXMsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1
cm47CiAgICAgfQogCi0gICAgc3BhcHJfaXJxX3hpdmUuaW5pdChzcGFwciwgc3BhcHJfaXJxX3hp
dmUubnJfaXJxcywgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBl
cnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBzcGFwcl9pcnFfeGl2ZS5pbml0
KHNwYXByLCBzcGFwcl9pcnFfeGl2ZS5ucl9pcnFzLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsK
ICAgICAgICAgcmV0dXJuOwogICAgIH0KIH0KQEAgLTQ3NiwxOCArNDU5LDE1IEBAIHN0YXRpYyB2
b2lkIHNwYXByX2lycV9pbml0X2R1YWwoU3BhcHJNYWNoaW5lU3RhdGUgKnNwYXByLCBpbnQgbnJf
aXJxcywKIHN0YXRpYyBpbnQgc3BhcHJfaXJxX2NsYWltX2R1YWwoU3BhcHJNYWNoaW5lU3RhdGUg
KnNwYXByLCBpbnQgaXJxLCBib29sIGxzaSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgRXJyb3IgKiplcnJwKQogewotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIGlu
dCByZXQ7CiAKLSAgICByZXQgPSBzcGFwcl9pcnFfeGljcy5jbGFpbShzcGFwciwgaXJxLCBsc2ks
ICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFn
YXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgcmV0ID0gc3BhcHJfaXJxX3hpY3MuY2xhaW0oc3Bh
cHIsIGlycSwgbHNpLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuIHJl
dDsKICAgICB9CiAKLSAgICByZXQgPSBzcGFwcl9pcnFfeGl2ZS5jbGFpbShzcGFwciwgaXJxLCBs
c2ksICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJv
cGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgcmV0ID0gc3BhcHJfaXJxX3hpdmUuY2xhaW0o
c3BhcHIsIGlycSwgbHNpLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJu
IHJldDsKICAgICB9CiAKQEAgLTUyMCwxMSArNTAwLDggQEAgc3RhdGljIHZvaWQgc3BhcHJfaXJx
X2R0X3BvcHVsYXRlX2R1YWwoU3BhcHJNYWNoaW5lU3RhdGUgKnNwYXByLAogc3RhdGljIHZvaWQg
c3BhcHJfaXJxX2NwdV9pbnRjX2NyZWF0ZV9kdWFsKFNwYXByTWFjaGluZVN0YXRlICpzcGFwciwK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3dlclBDQ1BVICpj
cHUsIEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKLQotICAg
IHNwYXByX2lycV94aXZlLmNwdV9pbnRjX2NyZWF0ZShzcGFwciwgY3B1LCAmbG9jYWxfZXJyKTsK
LSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2Nh
bF9lcnIpOworICAgIHNwYXByX2lycV94aXZlLmNwdV9pbnRjX2NyZWF0ZShzcGFwciwgY3B1LCBl
cnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApAQCAtNTQ5
LDggKzUyNiw2IEBAIHN0YXRpYyBpbnQgc3BhcHJfaXJxX3Bvc3RfbG9hZF9kdWFsKFNwYXByTWFj
aGluZVN0YXRlICpzcGFwciwgaW50IHZlcnNpb25faWQpCiAKIHN0YXRpYyB2b2lkIHNwYXByX2ly
cV9yZXNldF9kdWFsKFNwYXByTWFjaGluZVN0YXRlICpzcGFwciwgRXJyb3IgKiplcnJwKQogewot
ICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwotCiAgICAgLyoKICAgICAgKiBEZWFjdGl2YXRl
IHRoZSBYSVZFIE1NSU9zLiBUaGUgWElWRSBiYWNrZW5kIHdpbGwgcmVlbmFibGUgdGhlbQogICAg
ICAqIGlmIHNlbGVjdGVkLgpAQCAtNTU5LDE1ICs1MzQsMTMgQEAgc3RhdGljIHZvaWQgc3BhcHJf
aXJxX3Jlc2V0X2R1YWwoU3BhcHJNYWNoaW5lU3RhdGUgKnNwYXByLCBFcnJvciAqKmVycnApCiAK
ICAgICAvKiBEZXN0cm95IGFsbCBLVk0gZGV2aWNlcyAqLwogICAgIGlmIChrdm1faXJxY2hpcF9p
bl9rZXJuZWwoKSkgewotICAgICAgICB4aWNzX2t2bV9kaXNjb25uZWN0KHNwYXByLCAmbG9jYWxf
ZXJyKTsKLSAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFn
YXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgIHhpY3Nfa3ZtX2Rpc2Nvbm5lY3Qoc3BhcHIs
IGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIGVycm9yX3ByZXBlbmQo
ZXJycCwgIktWTSBYSUNTIGRpc2Nvbm5lY3QgZmFpbGVkOiAiKTsKICAgICAgICAgICAgIHJldHVy
bjsKICAgICAgICAgfQotICAgICAgICBrdm1wcGNfeGl2ZV9kaXNjb25uZWN0KHNwYXByLT54aXZl
LCAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICAgICAgZXJy
b3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgIGt2bXBwY194aXZlX2Rpc2Nv
bm5lY3Qoc3BhcHItPnhpdmUsIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAg
ICAgIGVycm9yX3ByZXBlbmQoZXJycCwgIktWTSBYSVZFIGRpc2Nvbm5lY3QgZmFpbGVkOiAiKTsK
ICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQpAQCAtNjc0LDcgKzY0Nyw2IEBAIHN0YXRp
YyB2b2lkIHNwYXByX2lycV9jaGVjayhTcGFwck1hY2hpbmVTdGF0ZSAqc3BhcHIsIEVycm9yICoq
ZXJycCkKIHZvaWQgc3BhcHJfaXJxX2luaXQoU3BhcHJNYWNoaW5lU3RhdGUgKnNwYXByLCBFcnJv
ciAqKmVycnApCiB7CiAgICAgTWFjaGluZVN0YXRlICptYWNoaW5lID0gTUFDSElORShzcGFwcik7
Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICBpZiAobWFjaGluZV9rZXJuZWxf
aXJxY2hpcF9zcGxpdChtYWNoaW5lKSkgewogICAgICAgICBlcnJvcl9zZXRnKGVycnAsICJrZXJu
ZWxfaXJxY2hpcCBzcGxpdCBtb2RlIG5vdCBzdXBwb3J0ZWQgb24gcHNlcmllcyIpOwpAQCAtNjg3
LDkgKzY1OSw4IEBAIHZvaWQgc3BhcHJfaXJxX2luaXQoU3BhcHJNYWNoaW5lU3RhdGUgKnNwYXBy
LCBFcnJvciAqKmVycnApCiAgICAgICAgIHJldHVybjsKICAgICB9CiAKLSAgICBzcGFwcl9pcnFf
Y2hlY2soc3BhcHIsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAg
ZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgc3BhcHJfaXJxX2NoZWNrKHNw
YXByLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApk
aWZmIC0tZ2l0IGEvaHcvcHBjL3NwYXByX3BjaS5jIGIvaHcvcHBjL3NwYXByX3BjaS5jCmluZGV4
IDdiNzFhZDdjNzQuLjQzOTFkNTRjNmUgMTAwNjQ0Ci0tLSBhL2h3L3BwYy9zcGFwcl9wY2kuYwor
KysgYi9ody9wcGMvc3BhcHJfcGNpLmMKQEAgLTEyNTcsMTUgKzEyNTcsMTMgQEAgc3RhdGljIHZv
aWQgYWRkX2RyY3MoU3BhcHJQaGJTdGF0ZSAqcGhiLCBQQ0lCdXMgKmJ1cywgRXJyb3IgKiplcnJw
KQogICAgIE9iamVjdCAqb3duZXI7CiAgICAgaW50IGk7CiAgICAgdWludDhfdCBjaGFzc2lzOwot
ICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgaWYgKCFwaGItPmRyX2VuYWJsZWQp
IHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIAotICAgIGNoYXNzaXMgPSBjaGFzc2lzX2Zyb21f
YnVzKGJ1cywgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJv
cl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBjaGFzc2lzID0gY2hhc3Npc19mcm9t
X2J1cyhidXMsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAg
fQogCkBAIC0xMjg1LDE1ICsxMjgzLDEzIEBAIHN0YXRpYyB2b2lkIHJlbW92ZV9kcmNzKFNwYXBy
UGhiU3RhdGUgKnBoYiwgUENJQnVzICpidXMsIEVycm9yICoqZXJycCkKIHsKICAgICBpbnQgaTsK
ICAgICB1aW50OF90IGNoYXNzaXM7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAg
ICBpZiAoIXBoYi0+ZHJfZW5hYmxlZCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCi0gICAg
Y2hhc3NpcyA9IGNoYXNzaXNfZnJvbV9idXMoYnVzLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9j
YWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAg
IGNoYXNzaXMgPSBjaGFzc2lzX2Zyb21fYnVzKGJ1cywgZXJycCk7CisgICAgaWYgKCplcnJwKSB7
CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKQEAgLTE1MTgsMTIgKzE1MTQsMTAgQEAgc3RhdGlj
IHZvaWQgc3BhcHJfcGNpX2JyaWRnZV9wbHVnKFNwYXByUGhiU3RhdGUgKnBoYiwKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lCcmlkZ2UgKmJyaWRnZSwKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJyb3IgKmxvY2Fs
X2VyciA9IE5VTEw7CiAgICAgUENJQnVzICpidXMgPSBwY2lfYnJpZGdlX2dldF9zZWNfYnVzKGJy
aWRnZSk7CiAKLSAgICBhZGRfZHJjcyhwaGIsIGJ1cywgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxv
Y2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAg
ICBhZGRfZHJjcyhwaGIsIGJ1cywgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJl
dHVybjsKICAgICB9CiB9CkBAIC0xNTM1LDcgKzE1MjksNiBAQCBzdGF0aWMgdm9pZCBzcGFwcl9w
Y2lfcGx1ZyhIb3RwbHVnSGFuZGxlciAqcGx1Z19oYW5kbGVyLAogICAgIFBDSURldmljZSAqcGRl
diA9IFBDSV9ERVZJQ0UocGx1Z2dlZF9kZXYpOwogICAgIFBDSURldmljZUNsYXNzICpwYyA9IFBD
SV9ERVZJQ0VfR0VUX0NMQVNTKHBsdWdnZWRfZGV2KTsKICAgICBTcGFwckRyYyAqZHJjID0gZHJj
X2Zyb21fZGV2KHBoYiwgcGRldik7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAg
UENJQnVzICpidXMgPSBQQ0lfQlVTKHFkZXZfZ2V0X3BhcmVudF9idXMoREVWSUNFKHBkZXYpKSk7
CiAgICAgdWludDMyX3Qgc2xvdG5yID0gUENJX1NMT1QocGRldi0+ZGV2Zm4pOwogCkBAIC0xNTQ3
LDE4ICsxNTQwLDE3IEBAIHN0YXRpYyB2b2lkIHNwYXByX3BjaV9wbHVnKEhvdHBsdWdIYW5kbGVy
ICpwbHVnX2hhbmRsZXIsCiAgICAgICAgICAqIHdlIG5lZWQgdG8gbGV0IHRoZW0ga25vdyBpdCdz
IG5vdCBlbmFibGVkCiAgICAgICAgICAqLwogICAgICAgICBpZiAocGx1Z2dlZF9kZXYtPmhvdHBs
dWdnZWQpIHsKLSAgICAgICAgICAgIGVycm9yX3NldGcoJmxvY2FsX2VyciwgUUVSUl9CVVNfTk9f
SE9UUExVRywKKyAgICAgICAgICAgIGVycm9yX3NldGcoZXJycCwgUUVSUl9CVVNfTk9fSE9UUExV
RywKICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0X2dldF90eXBlbmFtZShPQkpFQ1QocGhi
KSkpOwogICAgICAgICB9Ci0gICAgICAgIGdvdG8gb3V0OworICAgICAgICByZXR1cm47CiAgICAg
fQogCiAgICAgZ19hc3NlcnQoZHJjKTsKIAogICAgIGlmIChwYy0+aXNfYnJpZGdlKSB7Ci0gICAg
ICAgIHNwYXByX3BjaV9icmlkZ2VfcGx1ZyhwaGIsIFBDSV9CUklER0UocGx1Z2dlZF9kZXYpLCAm
bG9jYWxfZXJyKTsKLSAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICAgICAgZXJyb3Jf
cHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgIHNwYXByX3BjaV9icmlkZ2VfcGx1
ZyhwaGIsIFBDSV9CUklER0UocGx1Z2dlZF9kZXYpLCBlcnJwKTsKKyAgICAgICAgaWYgKCplcnJw
KSB7CiAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgIH0KICAgICB9CkBAIC0xNTY5LDE1ICsx
NTYxLDE1IEBAIHN0YXRpYyB2b2lkIHNwYXByX3BjaV9wbHVnKEhvdHBsdWdIYW5kbGVyICpwbHVn
X2hhbmRsZXIsCiAgICAgICovCiAgICAgaWYgKHBsdWdnZWRfZGV2LT5ob3RwbHVnZ2VkICYmIGJ1
cy0+ZGV2aWNlc1tQQ0lfREVWRk4oc2xvdG5yLCAwKV0gJiYKICAgICAgICAgUENJX0ZVTkMocGRl
di0+ZGV2Zm4pICE9IDApIHsKLSAgICAgICAgZXJyb3Jfc2V0ZygmbG9jYWxfZXJyLCAiUENJOiBz
bG90ICVkIGZ1bmN0aW9uIDAgYWxyZWFkeSBvY3VwcGllZCBieSAlcywiCisgICAgICAgIGVycm9y
X3NldGcoZXJycCwgIlBDSTogc2xvdCAlZCBmdW5jdGlvbiAwIGFscmVhZHkgb2N1cHBpZWQgYnkg
JXMsIgogICAgICAgICAgICAgICAgICAgICIgYWRkaXRpb25hbCBmdW5jdGlvbnMgY2FuIG5vIGxv
bmdlciBiZSBleHBvc2VkIHRvIGd1ZXN0LiIsCiAgICAgICAgICAgICAgICAgICAgc2xvdG5yLCBi
dXMtPmRldmljZXNbUENJX0RFVkZOKHNsb3RuciwgMCldLT5uYW1lKTsKLSAgICAgICAgZ290byBv
dXQ7CisgICAgICAgIHJldHVybjsKICAgICB9CiAKLSAgICBzcGFwcl9kcmNfYXR0YWNoKGRyYywg
REVWSUNFKHBkZXYpLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAg
IGdvdG8gb3V0OworICAgIHNwYXByX2RyY19hdHRhY2goZHJjLCBERVZJQ0UocGRldiksIGVycnAp
OworICAgIGlmICgqZXJycCkgeworICAgICAgICByZXR1cm47CiAgICAgfQogCiAgICAgLyogSWYg
dGhpcyBpcyBmdW5jdGlvbiAwLCBzaWduYWwgaG90cGx1ZyBmb3IgYWxsIHRoZSBkZXZpY2UgZnVu
Y3Rpb25zLgpAQCAtMTU4NywxMCArMTU3OSw5IEBAIHN0YXRpYyB2b2lkIHNwYXByX3BjaV9wbHVn
KEhvdHBsdWdIYW5kbGVyICpwbHVnX2hhbmRsZXIsCiAgICAgICAgIHNwYXByX2RyY19yZXNldChk
cmMpOwogICAgIH0gZWxzZSBpZiAoUENJX0ZVTkMocGRldi0+ZGV2Zm4pID09IDApIHsKICAgICAg
ICAgaW50IGk7Ci0gICAgICAgIHVpbnQ4X3QgY2hhc3NpcyA9IGNoYXNzaXNfZnJvbV9idXMocGNp
X2dldF9idXMocGRldiksICZsb2NhbF9lcnIpOworICAgICAgICB1aW50OF90IGNoYXNzaXMgPSBj
aGFzc2lzX2Zyb21fYnVzKHBjaV9nZXRfYnVzKHBkZXYpLCBlcnJwKTsKIAotICAgICAgICBpZiAo
bG9jYWxfZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJy
KTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgIH0K
IApAQCAtMTYwOCwyMSArMTU5OSwxNiBAQCBzdGF0aWMgdm9pZCBzcGFwcl9wY2lfcGx1ZyhIb3Rw
bHVnSGFuZGxlciAqcGx1Z19oYW5kbGVyLAogICAgICAgICAgICAgfQogICAgICAgICB9CiAgICAg
fQotCi1vdXQ6Ci0gICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CiB9CiAKIHN0
YXRpYyB2b2lkIHNwYXByX3BjaV9icmlkZ2VfdW5wbHVnKFNwYXByUGhiU3RhdGUgKnBoYiwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSUJyaWRnZSAqYnJpZGdlLAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJwKQogewotICAgIEVy
cm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIFBDSUJ1cyAqYnVzID0gcGNpX2JyaWRnZV9nZXRf
c2VjX2J1cyhicmlkZ2UpOwogCi0gICAgcmVtb3ZlX2RyY3MocGhiLCBidXMsICZsb2NhbF9lcnIp
OwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxv
Y2FsX2Vycik7CisgICAgcmVtb3ZlX2RyY3MocGhiLCBidXMsIGVycnApOworICAgIGlmICgqZXJy
cCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogfQpAQCAtMTY0NiwxMCArMTYzMiw4IEBAIHN0
YXRpYyB2b2lkIHNwYXByX3BjaV91bnBsdWcoSG90cGx1Z0hhbmRsZXIgKnBsdWdfaGFuZGxlciwK
ICAgICBwY2lfZGV2aWNlX3Jlc2V0KFBDSV9ERVZJQ0UocGx1Z2dlZF9kZXYpKTsKIAogICAgIGlm
IChwYy0+aXNfYnJpZGdlKSB7Ci0gICAgICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwotICAg
ICAgICBzcGFwcl9wY2lfYnJpZGdlX3VucGx1ZyhwaGIsIFBDSV9CUklER0UocGx1Z2dlZF9kZXYp
LCAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICAgICAgZXJy
b3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgIHNwYXByX3BjaV9icmlkZ2Vf
dW5wbHVnKHBoYiwgUENJX0JSSURHRShwbHVnZ2VkX2RldiksIGVycnApOworICAgICAgICBpZiAo
KmVycnApIHsKICAgICAgICAgfQogICAgICAgICByZXR1cm47CiAgICAgfQpAQCAtMTY4MCwxMSAr
MTY2NCw5IEBAIHN0YXRpYyB2b2lkIHNwYXByX3BjaV91bnBsdWdfcmVxdWVzdChIb3RwbHVnSGFu
ZGxlciAqcGx1Z19oYW5kbGVyLAogICAgICAgICBTcGFwckRyY0NsYXNzICpmdW5jX2RyY2s7CiAg
ICAgICAgIFNwYXByRFJFbnRpdHlTZW5zZSBzdGF0ZTsKICAgICAgICAgaW50IGk7Ci0gICAgICAg
IEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwotICAgICAgICB1aW50OF90IGNoYXNzaXMgPSBjaGFz
c2lzX2Zyb21fYnVzKHBjaV9nZXRfYnVzKHBkZXYpLCAmbG9jYWxfZXJyKTsKKyAgICAgICAgdWlu
dDhfdCBjaGFzc2lzID0gY2hhc3Npc19mcm9tX2J1cyhwY2lfZ2V0X2J1cyhwZGV2KSwgZXJycCk7
CiAKLSAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRl
KGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgcmV0
dXJuOwogICAgICAgICB9CiAKQEAgLTE3NDYsNyArMTcyOCw2IEBAIHN0YXRpYyB2b2lkIHNwYXBy
X3BoYl91bnJlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogICAgIFNwYXBy
VGNlVGFibGUgKnRjZXQ7CiAgICAgaW50IGk7CiAgICAgY29uc3QgdW5zaWduZWQgd2luZG93c19z
dXBwb3J0ZWQgPSBzcGFwcl9waGJfd2luZG93c19zdXBwb3J0ZWQoc3BoYik7Ci0gICAgRXJyb3Ig
KmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICBzcGFwcl9waGJfbnZncHVfZnJlZShzcGhiKTsKIApA
QCAtMTc2Nyw5ICsxNzQ4LDggQEAgc3RhdGljIHZvaWQgc3BhcHJfcGhiX3VucmVhbGl6ZShEZXZp
Y2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgICAgIH0KICAgICB9CiAKLSAgICByZW1v
dmVfZHJjcyhzcGhiLCBwaGItPmJ1cywgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2Vycikg
ewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICByZW1vdmVf
ZHJjcyhzcGhiLCBwaGItPmJ1cywgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJl
dHVybjsKICAgICB9CiAKQEAgLTE4MzQsNyArMTgxNCw2IEBAIHN0YXRpYyB2b2lkIHNwYXByX3Bo
Yl9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAgICB1aW50NjRfdCBt
c2lfd2luZG93X3NpemUgPSA0MDk2OwogICAgIFNwYXByVGNlVGFibGUgKnRjZXQ7CiAgICAgY29u
c3QgdW5zaWduZWQgd2luZG93c19zdXBwb3J0ZWQgPSBzcGFwcl9waGJfd2luZG93c19zdXBwb3J0
ZWQoc3BoYik7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICBpZiAoIXNwYXBy
KSB7CiAgICAgICAgIGVycm9yX3NldGcoZXJycCwgVFlQRV9TUEFQUl9QQ0lfSE9TVF9CUklER0Ug
IiBuZWVkcyBhIHBzZXJpZXMgbWFjaGluZSIpOwpAQCAtMTk4OCw5ICsxOTY3LDkgQEAgc3RhdGlj
IHZvaWQgc3BhcHJfcGhiX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQog
ICAgICAgICB1aW50MzJfdCBpcnEgPSBTUEFQUl9JUlFfUENJX0xTSSArIHNwaGItPmluZGV4ICog
UENJX05VTV9QSU5TICsgaTsKIAogICAgICAgICBpZiAoc21jLT5sZWdhY3lfaXJxX2FsbG9jYXRp
b24pIHsKLSAgICAgICAgICAgIGlycSA9IHNwYXByX2lycV9maW5kb25lKHNwYXByLCAmbG9jYWxf
ZXJyKTsKLSAgICAgICAgICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgICAgICAgICBlcnJv
cl9wcm9wYWdhdGVfcHJlcGVuZChlcnJwLCBsb2NhbF9lcnIsCisgICAgICAgICAgICBpcnEgPSBz
cGFwcl9pcnFfZmluZG9uZShzcGFwciwgZXJycCk7CisgICAgICAgICAgICBpZiAoKmVycnApIHsK
KyAgICAgICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGVfcHJlcGVuZChlcnJwLCAqZXJycCwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiY2FuJ3QgYWxsb2NhdGUgTFNJ
czogIik7CiAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgKiBPbGRlciBtYWNo
aW5lcyB3aWxsIG5ldmVyIHN1cHBvcnQgUEhCIGhvdHBsdWcsIGllLCB0aGlzIGlzIGFuCkBAIC0y
MDAwLDkgKzE5NzksOSBAQCBzdGF0aWMgdm9pZCBzcGFwcl9waGJfcmVhbGl6ZShEZXZpY2VTdGF0
ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgICAgICAgICB9CiAgICAgICAgIH0KIAotICAgICAg
ICBzcGFwcl9pcnFfY2xhaW0oc3BhcHIsIGlycSwgdHJ1ZSwgJmxvY2FsX2Vycik7Ci0gICAgICAg
IGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZV9wcmVwZW5kKGVy
cnAsIGxvY2FsX2VyciwgImNhbid0IGFsbG9jYXRlIExTSXM6ICIpOworICAgICAgICBzcGFwcl9p
cnFfY2xhaW0oc3BhcHIsIGlycSwgdHJ1ZSwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewor
ICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlX3ByZXBlbmQoZXJycCwgKmVycnAsICJjYW4ndCBh
bGxvY2F0ZSBMU0lzOiAiKTsKICAgICAgICAgICAgIGdvdG8gdW5yZWFsaXplOwogICAgICAgICB9
CiAKQEAgLTIwMTAsOSArMTk4OSw4IEBAIHN0YXRpYyB2b2lkIHNwYXByX3BoYl9yZWFsaXplKERl
dmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAgICB9CiAKICAgICAvKiBhbGxvY2F0ZSBj
b25uZWN0b3JzIGZvciBjaGlsZCBQQ0kgZGV2aWNlcyAqLwotICAgIGFkZF9kcmNzKHNwaGIsIHBo
Yi0+YnVzLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIGFkZF9kcmNzKHNwaGIsIHBoYi0+YnVz
LCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ290byB1bnJlYWxpemU7CiAgICAg
fQogCmRpZmYgLS1naXQgYS9ody9wcGMvc3BhcHJfdmlvLmMgYi9ody9wcGMvc3BhcHJfdmlvLmMK
aW5kZXggMDgwMzY0OTY1OC4uNjI1OTU3YTJjZCAxMDA2NDQKLS0tIGEvaHcvcHBjL3NwYXByX3Zp
by5jCisrKyBiL2h3L3BwYy9zcGFwcl92aW8uYwpAQCAtNDY4LDcgKzQ2OCw2IEBAIHN0YXRpYyB2
b2lkIHNwYXByX3Zpb19idXNkZXZfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqcWRldiwgRXJyb3IgKipl
cnJwKQogICAgIFNwYXByVmlvRGV2aWNlICpkZXYgPSAoU3BhcHJWaW9EZXZpY2UgKilxZGV2Owog
ICAgIFNwYXByVmlvRGV2aWNlQ2xhc3MgKnBjID0gVklPX1NQQVBSX0RFVklDRV9HRVRfQ0xBU1Mo
ZGV2KTsKICAgICBjaGFyICppZDsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAogICAg
IGlmIChkZXYtPnJlZyAhPSAtMSkgewogICAgICAgICAvKgpAQCAtNTA0LDE2ICs1MDMsMTQgQEAg
c3RhdGljIHZvaWQgc3BhcHJfdmlvX2J1c2Rldl9yZWFsaXplKERldmljZVN0YXRlICpxZGV2LCBF
cnJvciAqKmVycnApCiAgICAgZGV2LT5pcnEgPSBzcGFwcl92aW9fcmVnX3RvX2lycShkZXYtPnJl
Zyk7CiAKICAgICBpZiAoU1BBUFJfTUFDSElORV9HRVRfQ0xBU1Moc3BhcHIpLT5sZWdhY3lfaXJx
X2FsbG9jYXRpb24pIHsKLSAgICAgICAgZGV2LT5pcnEgPSBzcGFwcl9pcnFfZmluZG9uZShzcGFw
ciwgJmxvY2FsX2Vycik7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgICAgIGVy
cm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICBkZXYtPmlycSA9IHNwYXBy
X2lycV9maW5kb25lKHNwYXByLCBlcnJwKTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAg
ICAgICByZXR1cm47CiAgICAgICAgIH0KICAgICB9CiAKLSAgICBzcGFwcl9pcnFfY2xhaW0oc3Bh
cHIsIGRldi0+aXJxLCBmYWxzZSwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2Vycikgewot
ICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBzcGFwcl9pcnFf
Y2xhaW0oc3BhcHIsIGRldi0+aXJxLCBmYWxzZSwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAg
ICAgICAgIHJldHVybjsKICAgICB9CiAKZGlmZiAtLWdpdCBhL2h3L3Jpc2N2L3Jpc2N2X2hhcnQu
YyBiL2h3L3Jpc2N2L3Jpc2N2X2hhcnQuYwppbmRleCA1Yjk4MjI3ZGI2Li43ZTIxNzM4YmJiIDEw
MDY0NAotLS0gYS9ody9yaXNjdi9yaXNjdl9oYXJ0LmMKKysrIGIvaHcvcmlzY3YvcmlzY3ZfaGFy
dC5jCkBAIC00MywxNyArNDMsMTQgQEAgc3RhdGljIHZvaWQgcmlzY3ZfaGFydHNfY3B1X3Jlc2V0
KHZvaWQgKm9wYXF1ZSkKIHN0YXRpYyB2b2lkIHJpc2N2X2hhcnRfcmVhbGl6ZShSSVNDVkhhcnRB
cnJheVN0YXRlICpzLCBpbnQgaWR4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNo
YXIgKmNwdV90eXBlLCBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7Ci0K
ICAgICBvYmplY3RfaW5pdGlhbGl6ZV9jaGlsZChPQkpFQ1QocyksICJoYXJ0c1sqXSIsICZzLT5o
YXJ0c1tpZHhdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemVvZihSSVNDVkNQVSks
IGNwdV90eXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICZlcnJvcl9hYm9ydCwgTlVM
TCk7CiAgICAgcy0+aGFydHNbaWR4XS5lbnYubWhhcnRpZCA9IHMtPmhhcnRpZF9iYXNlICsgaWR4
OwogICAgIHFlbXVfcmVnaXN0ZXJfcmVzZXQocmlzY3ZfaGFydHNfY3B1X3Jlc2V0LCAmcy0+aGFy
dHNbaWR4XSk7CiAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+aGFydHNb
aWR4XSksIHRydWUsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICJyZWFsaXplZCIsICZl
cnIpOwotICAgIGlmIChlcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJyZWFsaXplZCIsIGVycnApOworICAgIGlm
ICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogfQpkaWZmIC0tZ2l0IGEvaHcvcmlz
Y3Yvc2lmaXZlX2UuYyBiL2h3L3Jpc2N2L3NpZml2ZV9lLmMKaW5kZXggMGY5ZDY0MWEwZS4uMTdm
MTlmZjMzOCAxMDA2NDQKLS0tIGEvaHcvcmlzY3Yvc2lmaXZlX2UuYworKysgYi9ody9yaXNjdi9z
aWZpdmVfZS5jCkBAIC0xMzYsNyArMTM2LDYgQEAgc3RhdGljIHZvaWQgcmlzY3Zfc2lmaXZlX2Vf
c29jX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogewogICAgIE1hY2hp
bmVTdGF0ZSAqbXMgPSBNQUNISU5FKHFkZXZfZ2V0X21hY2hpbmUoKSk7CiAgICAgY29uc3Qgc3Ry
dWN0IE1lbW1hcEVudHJ5ICptZW1tYXAgPSBzaWZpdmVfZV9tZW1tYXA7Ci0gICAgRXJyb3IgKmVy
ciA9IE5VTEw7CiAKICAgICBTaUZpdmVFU29DU3RhdGUgKnMgPSBSSVNDVl9FX1NPQyhkZXYpOwog
ICAgIE1lbW9yeVJlZ2lvbiAqc3lzX21lbSA9IGdldF9zeXN0ZW1fbWVtb3J5KCk7CkBAIC0xNzEs
OSArMTcwLDggQEAgc3RhdGljIHZvaWQgcmlzY3Zfc2lmaXZlX2Vfc29jX3JlYWxpemUoRGV2aWNl
U3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogCiAgICAgLyogR1BJTyAqLwogCi0gICAgb2JqZWN0
X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+Z3BpbyksIHRydWUsICJyZWFsaXplZCIsICZl
cnIpOwotICAgIGlmIChlcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7
CisgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+Z3BpbyksIHRydWUsICJy
ZWFsaXplZCIsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAg
fQogCmRpZmYgLS1naXQgYS9ody9yaXNjdi9zaWZpdmVfdS5jIGIvaHcvcmlzY3Yvc2lmaXZlX3Uu
YwppbmRleCA5ZjhlODRiZjJlLi43ZWVjZjMxYTNkIDEwMDY0NAotLS0gYS9ody9yaXNjdi9zaWZp
dmVfdS5jCisrKyBiL2h3L3Jpc2N2L3NpZml2ZV91LmMKQEAgLTQzNSw3ICs0MzUsNiBAQCBzdGF0
aWMgdm9pZCByaXNjdl9zaWZpdmVfdV9zb2NfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJv
ciAqKmVycnApCiAgICAgY2hhciAqcGxpY19oYXJ0X2NvbmZpZzsKICAgICBzaXplX3QgcGxpY19o
YXJ0X2NvbmZpZ19sZW47CiAgICAgaW50IGk7Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7CiAgICAg
TklDSW5mbyAqbmQgPSAmbmRfdGFibGVbMF07CiAKICAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jv
b2woT0JKRUNUKCZzLT5lX2NwdXMpLCB0cnVlLCAicmVhbGl6ZWQiLApAQCAtNDkzLDEwICs0OTIs
MTAgQEAgc3RhdGljIHZvaWQgcmlzY3Zfc2lmaXZlX3Vfc29jX3JlYWxpemUoRGV2aWNlU3RhdGUg
KmRldiwgRXJyb3IgKiplcnJwKQogICAgICAgICBtZW1tYXBbU0lGSVZFX1VfQ0xJTlRdLnNpemUs
IG1zLT5zbXAuY3B1cywKICAgICAgICAgU0lGSVZFX1NJUF9CQVNFLCBTSUZJVkVfVElNRUNNUF9C
QVNFLCBTSUZJVkVfVElNRV9CQVNFKTsKIAotICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChP
QkpFQ1QoJnMtPnByY2kpLCB0cnVlLCAicmVhbGl6ZWQiLCAmZXJyKTsKKyAgICBvYmplY3RfcHJv
cGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5wcmNpKSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7
CiAgICAgc3lzYnVzX21taW9fbWFwKFNZU19CVVNfREVWSUNFKCZzLT5wcmNpKSwgMCwgbWVtbWFw
W1NJRklWRV9VX1BSQ0ldLmJhc2UpOwogCi0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9C
SkVDVCgmcy0+b3RwKSwgdHJ1ZSwgInJlYWxpemVkIiwgJmVycik7CisgICAgb2JqZWN0X3Byb3Bl
cnR5X3NldF9ib29sKE9CSkVDVCgmcy0+b3RwKSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CiAg
ICAgc3lzYnVzX21taW9fbWFwKFNZU19CVVNfREVWSUNFKCZzLT5vdHApLCAwLCBtZW1tYXBbU0lG
SVZFX1VfT1RQXS5iYXNlKTsKIAogICAgIGZvciAoaSA9IDA7IGkgPCBTSUZJVkVfVV9QTElDX05V
TV9TT1VSQ0VTOyBpKyspIHsKQEAgLTUwOSw5ICs1MDgsOCBAQCBzdGF0aWMgdm9pZCByaXNjdl9z
aWZpdmVfdV9zb2NfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAg
fQogICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfaW50KE9CSkVDVCgmcy0+Z2VtKSwgR0VNX1JFVklT
SU9OLCAicmV2aXNpb24iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICZlcnJvcl9hYm9y
dCk7Ci0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCgmcy0+Z2VtKSwgdHJ1ZSwg
InJlYWxpemVkIiwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBlcnJvcl9wcm9wYWdh
dGUoZXJycCwgZXJyKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKCZzLT5n
ZW0pLCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAg
cmV0dXJuOwogICAgIH0KICAgICBzeXNidXNfbW1pb19tYXAoU1lTX0JVU19ERVZJQ0UoJnMtPmdl
bSksIDAsIG1lbW1hcFtTSUZJVkVfVV9HRU1dLmJhc2UpOwpkaWZmIC0tZ2l0IGEvaHcvczM5MHgv
MzI3MC1jY3cuYyBiL2h3L3MzOTB4LzMyNzAtY2N3LmMKaW5kZXggYzE5YTc1YjliNy4uZmI5NTRi
ZDk1MiAxMDA2NDQKLS0tIGEvaHcvczM5MHgvMzI3MC1jY3cuYworKysgYi9ody9zMzkweC8zMjcw
LWNjdy5jCkBAIC0xMDEsNyArMTAxLDYgQEAgc3RhdGljIHZvaWQgZW11bGF0ZWRfY2N3XzMyNzBf
cmVhbGl6ZShEZXZpY2VTdGF0ZSAqZHMsIEVycm9yICoqZXJycCkKICAgICBDY3dEZXZpY2UgKmNk
ZXYgPSBDQ1dfREVWSUNFKGRzKTsKICAgICBDQ1dEZXZpY2VDbGFzcyAqY2RrID0gQ0NXX0RFVklD
RV9HRVRfQ0xBU1MoY2Rldik7CiAgICAgU3ViY2hEZXYgKnNjaDsKLSAgICBFcnJvciAqZXJyID0g
TlVMTDsKIAogICAgIHNjaCA9IGNzc19jcmVhdGVfc2NoKGNkZXYtPmRldm5vLCBlcnJwKTsKICAg
ICBpZiAoIXNjaCkgewpAQCAtMTE3LDcgKzExNiw3IEBAIHN0YXRpYyB2b2lkIGVtdWxhdGVkX2Nj
d18zMjcwX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRzLCBFcnJvciAqKmVycnApCiAgICAgY2hwaWQg
PSBjc3NfZmluZF9mcmVlX2NocGlkKHNjaC0+Y3NzaWQpOwogCiAgICAgaWYgKGNocGlkID4gTUFY
X0NIUElEKSB7Ci0gICAgICAgIGVycm9yX3NldGcoJmVyciwgIk5vIGF2YWlsYWJsZSBjaHBpZCB0
byB1c2UuIik7CisgICAgICAgIGVycm9yX3NldGcoZXJycCwgIk5vIGF2YWlsYWJsZSBjaHBpZCB0
byB1c2UuIik7CiAgICAgICAgIGdvdG8gb3V0X2VycjsKICAgICB9CiAKQEAgLTEyOCwyMCArMTI3
LDE5IEBAIHN0YXRpYyB2b2lkIGVtdWxhdGVkX2Njd18zMjcwX3JlYWxpemUoRGV2aWNlU3RhdGUg
KmRzLCBFcnJvciAqKmVycnApCiAgICAgc2NoLT5kb19zdWJjaGFubmVsX3dvcmsgPSBkb19zdWJj
aGFubmVsX3dvcmtfdmlydHVhbDsKICAgICBzY2gtPmNjd19jYiA9IGVtdWxhdGVkX2Njd18zMjcw
X2NiOwogCi0gICAgY2stPmluaXQoZGV2LCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7CisgICAgY2st
PmluaXQoZGV2LCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ290byBvdXRfZXJy
OwogICAgIH0KIAotICAgIGNkay0+cmVhbGl6ZShjZGV2LCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7
CisgICAgY2RrLT5yZWFsaXplKGNkZXYsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAg
ICBnb3RvIG91dF9lcnI7CiAgICAgfQogCiAgICAgcmV0dXJuOwogCiBvdXRfZXJyOgotICAgIGVy
cm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOwogICAgIGNzc19zdWJjaF9hc3NpZ24oc2NoLT5jc3Np
ZCwgc2NoLT5zc2lkLCBzY2gtPnNjaGlkLCBzY2gtPmRldm5vLCBOVUxMKTsKICAgICBjZGV2LT5z
Y2ggPSBOVUxMOwogICAgIGdfZnJlZShzY2gpOwpkaWZmIC0tZ2l0IGEvaHcvczM5MHgvY3NzLWJy
aWRnZS5jIGIvaHcvczM5MHgvY3NzLWJyaWRnZS5jCmluZGV4IDE1YThlZDk2ZGUuLmM0MjNjNDNl
NmQgMTAwNjQ0Ci0tLSBhL2h3L3MzOTB4L2Nzcy1icmlkZ2UuYworKysgYi9ody9zMzkweC9jc3Mt
YnJpZGdlLmMKQEAgLTMzLDEyICszMywxMCBAQCBzdGF0aWMgdm9pZCBjY3dfZGV2aWNlX3VucGx1
ZyhIb3RwbHVnSGFuZGxlciAqaG90cGx1Z19kZXYsCiAgICAgQ2N3RGV2aWNlICpjY3dfZGV2ID0g
Q0NXX0RFVklDRShkZXYpOwogICAgIENDV0RldmljZUNsYXNzICprID0gQ0NXX0RFVklDRV9HRVRf
Q0xBU1MoY2N3X2Rldik7CiAgICAgU3ViY2hEZXYgKnNjaCA9IGNjd19kZXYtPnNjaDsKLSAgICBF
cnJvciAqZXJyID0gTlVMTDsKIAogICAgIGlmIChrLT51bnBsdWcpIHsKLSAgICAgICAgay0+dW5w
bHVnKGhvdHBsdWdfZGV2LCBkZXYsICZlcnIpOwotICAgICAgICBpZiAoZXJyKSB7Ci0gICAgICAg
ICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgay0+dW5wbHVnKGhvdHBs
dWdfZGV2LCBkZXYsIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIHJl
dHVybjsKICAgICAgICAgfQogICAgIH0KZGlmZiAtLWdpdCBhL2h3L3MzOTB4L2Nzcy5jIGIvaHcv
czM5MHgvY3NzLmMKaW5kZXggODQ0Y2FhYjQwOC4uZDIwMWFlZDVjYyAxMDA2NDQKLS0tIGEvaHcv
czM5MHgvY3NzLmMKKysrIGIvaHcvczM5MHgvY3NzLmMKQEAgLTIzNTQsNyArMjM1NCw2IEBAIHN0
YXRpYyB2b2lkIHNldF9jc3NfZGV2aWQoT2JqZWN0ICpvYmosIFZpc2l0b3IgKnYsIGNvbnN0IGNo
YXIgKm5hbWUsCiAgICAgRGV2aWNlU3RhdGUgKmRldiA9IERFVklDRShvYmopOwogICAgIFByb3Bl
cnR5ICpwcm9wID0gb3BhcXVlOwogICAgIENzc0RldklkICpkZXZfaWQgPSBxZGV2X2dldF9wcm9w
X3B0cihkZXYsIHByb3ApOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIGNoYXIg
KnN0cjsKICAgICBpbnQgbnVtLCBuMSwgbjI7CiAgICAgdW5zaWduZWQgaW50IGNzc2lkLCBzc2lk
LCBkZXZpZDsKQEAgLTIzNjQsOSArMjM2Myw4IEBAIHN0YXRpYyB2b2lkIHNldF9jc3NfZGV2aWQo
T2JqZWN0ICpvYmosIFZpc2l0b3IgKnYsIGNvbnN0IGNoYXIgKm5hbWUsCiAgICAgICAgIHJldHVy
bjsKICAgICB9CiAKLSAgICB2aXNpdF90eXBlX3N0cih2LCBuYW1lLCAmc3RyLCAmbG9jYWxfZXJy
KTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBs
b2NhbF9lcnIpOworICAgIHZpc2l0X3R5cGVfc3RyKHYsIG5hbWUsICZzdHIsIGVycnApOworICAg
IGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCmRpZmYgLS1naXQgYS9ody9z
MzkweC9pcGwuYyBiL2h3L3MzOTB4L2lwbC5jCmluZGV4IGNhNTQ0ZDY0YzUuLmQyNWYyY2EyMDAg
MTAwNjQ0Ci0tLSBhL2h3L3MzOTB4L2lwbC5jCisrKyBiL2h3L3MzOTB4L2lwbC5jCkBAIC0xMTUs
NyArMTE1LDYgQEAgc3RhdGljIHZvaWQgczM5MF9pcGxfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2
LCBFcnJvciAqKmVycnApCiAgICAgdWludDY0X3QgcGVudHJ5OwogICAgIGNoYXIgKm1hZ2ljOwog
ICAgIGludCBrZXJuZWxfc2l6ZTsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKIAogICAgIGludCBi
aW9zX3NpemU7CiAgICAgY2hhciAqYmlvc19maWxlbmFtZTsKQEAgLTEzMyw4ICsxMzIsOCBAQCBz
dGF0aWMgdm9pZCBzMzkwX2lwbF9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJy
cCkKIAogICAgICAgICBiaW9zX2ZpbGVuYW1lID0gcWVtdV9maW5kX2ZpbGUoUUVNVV9GSUxFX1RZ
UEVfQklPUywgYmlvc19uYW1lKTsKICAgICAgICAgaWYgKGJpb3NfZmlsZW5hbWUgPT0gTlVMTCkg
ewotICAgICAgICAgICAgZXJyb3Jfc2V0ZygmZXJyLCAiY291bGQgbm90IGZpbmQgc3RhZ2UxIGJv
b3Rsb2FkZXIiKTsKLSAgICAgICAgICAgIGdvdG8gZXJyb3I7CisgICAgICAgICAgICBlcnJvcl9z
ZXRnKGVycnAsICJjb3VsZCBub3QgZmluZCBzdGFnZTEgYm9vdGxvYWRlciIpOworICAgICAgICAg
ICAgcmV0dXJuOwogICAgICAgICB9CiAKICAgICAgICAgYmlvc19zaXplID0gbG9hZF9lbGYoYmlv
c19maWxlbmFtZSwgTlVMTCwKQEAgLTE1Myw4ICsxNTIsOCBAQCBzdGF0aWMgdm9pZCBzMzkwX2lw
bF9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAgICAgICAgZ19mcmVl
KGJpb3NfZmlsZW5hbWUpOwogCiAgICAgICAgIGlmIChiaW9zX3NpemUgPT0gLTEpIHsKLSAgICAg
ICAgICAgIGVycm9yX3NldGcoJmVyciwgImNvdWxkIG5vdCBsb2FkIGJvb3Rsb2FkZXIgJyVzJyIs
IGJpb3NfbmFtZSk7Ci0gICAgICAgICAgICBnb3RvIGVycm9yOworICAgICAgICAgICAgZXJyb3Jf
c2V0ZyhlcnJwLCAiY291bGQgbm90IGxvYWQgYm9vdGxvYWRlciAnJXMnIiwgYmlvc19uYW1lKTsK
KyAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQogCiAgICAgICAgIC8qIGRlZmF1bHQgYm9v
dCB0YXJnZXQgaXMgdGhlIGJpb3MgKi8KQEAgLTE2OCw4ICsxNjcsOCBAQCBzdGF0aWMgdm9pZCBz
MzkwX2lwbF9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAgICAgICAg
aWYgKGtlcm5lbF9zaXplIDwgMCkgewogICAgICAgICAgICAga2VybmVsX3NpemUgPSBsb2FkX2lt
YWdlX3RhcmdwaHlzKGlwbC0+a2VybmVsLCAwLCByYW1fc2l6ZSk7CiAgICAgICAgICAgICBpZiAo
a2VybmVsX3NpemUgPCAwKSB7Ci0gICAgICAgICAgICAgICAgZXJyb3Jfc2V0ZygmZXJyLCAiY291
bGQgbm90IGxvYWQga2VybmVsICclcyciLCBpcGwtPmtlcm5lbCk7Ci0gICAgICAgICAgICAgICAg
Z290byBlcnJvcjsKKyAgICAgICAgICAgICAgICBlcnJvcl9zZXRnKGVycnAsICJjb3VsZCBub3Qg
bG9hZCBrZXJuZWwgJyVzJyIsIGlwbC0+a2VybmVsKTsKKyAgICAgICAgICAgICAgICByZXR1cm47
CiAgICAgICAgICAgICB9CiAgICAgICAgICAgICAvKiBpZiB0aGlzIGlzIExpbnV4IHVzZSBLRVJO
X0lNQUdFX1NUQVJUICovCiAgICAgICAgICAgICBtYWdpYyA9IHJvbV9wdHIoTElOVVhfTUFHSUNf
QUREUiwgNik7CkBAIC0xODEsOCArMTgwLDggQEAgc3RhdGljIHZvaWQgczM5MF9pcGxfcmVhbGl6
ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgICAgICAgICAgICAgaWYgKGlw
bF9wc3cpIHsKICAgICAgICAgICAgICAgICAgICAgcGVudHJ5ID0gYmUzMl90b19jcHUoKmlwbF9w
c3cpICYgMHg3ZmZmZmZmZlVMOwogICAgICAgICAgICAgICAgIH0gZWxzZSB7Ci0gICAgICAgICAg
ICAgICAgICAgIGVycm9yX3NldGcoJmVyciwgIkNvdWxkIG5vdCBnZXQgSVBMIFBTVyIpOwotICAg
ICAgICAgICAgICAgICAgICBnb3RvIGVycm9yOworICAgICAgICAgICAgICAgICAgICBlcnJvcl9z
ZXRnKGVycnAsICJDb3VsZCBub3QgZ2V0IElQTCBQU1ciKTsKKyAgICAgICAgICAgICAgICAgICAg
cmV0dXJuOwogICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgIH0KICAgICAgICAgfQpAQCAt
MjE1LDggKzIxNCw4IEBAIHN0YXRpYyB2b2lkIHMzOTBfaXBsX3JlYWxpemUoRGV2aWNlU3RhdGUg
KmRldiwgRXJyb3IgKiplcnJwKQogICAgICAgICAgICAgaW5pdHJkX3NpemUgPSBsb2FkX2ltYWdl
X3RhcmdwaHlzKGlwbC0+aW5pdHJkLCBpbml0cmRfb2Zmc2V0LAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbV9zaXplIC0gaW5pdHJkX29mZnNldCk7CiAg
ICAgICAgICAgICBpZiAoaW5pdHJkX3NpemUgPT0gLTEpIHsKLSAgICAgICAgICAgICAgICBlcnJv
cl9zZXRnKCZlcnIsICJjb3VsZCBub3QgbG9hZCBpbml0cmQgJyVzJyIsIGlwbC0+aW5pdHJkKTsK
LSAgICAgICAgICAgICAgICBnb3RvIGVycm9yOworICAgICAgICAgICAgICAgIGVycm9yX3NldGco
ZXJycCwgImNvdWxkIG5vdCBsb2FkIGluaXRyZCAnJXMnIiwgaXBsLT5pbml0cmQpOworICAgICAg
ICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgIH0KIAogICAgICAgICAgICAgLyoKQEAgLTIz
OCw4ICsyMzcsNiBAQCBzdGF0aWMgdm9pZCBzMzkwX2lwbF9yZWFsaXplKERldmljZVN0YXRlICpk
ZXYsIEVycm9yICoqZXJycCkKICAgICBpcGwtPmNvbXBhdF9zdGFydF9hZGRyID0gaXBsLT5zdGFy
dF9hZGRyOwogICAgIGlwbC0+Y29tcGF0X2Jpb3Nfc3RhcnRfYWRkciA9IGlwbC0+Ymlvc19zdGFy
dF9hZGRyOwogICAgIHFlbXVfcmVnaXN0ZXJfcmVzZXQocWRldl9yZXNldF9hbGxfZm4sIGRldik7
Ci1lcnJvcjoKLSAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKIH0KIAogc3RhdGljIFBy
b3BlcnR5IHMzOTBfaXBsX3Byb3BlcnRpZXNbXSA9IHsKZGlmZiAtLWdpdCBhL2h3L3MzOTB4L3Mz
OTAtY2N3LmMgYi9ody9zMzkweC9zMzkwLWNjdy5jCmluZGV4IDBjNWE1YjYwYmQuLjBhZTE5NTE1
MDcgMTAwNjQ0Ci0tLSBhL2h3L3MzOTB4L3MzOTAtY2N3LmMKKysrIGIvaHcvczM5MHgvczM5MC1j
Y3cuYwpAQCAtOTEsMTQgKzkxLDEzIEBAIHN0YXRpYyB2b2lkIHMzOTBfY2N3X3JlYWxpemUoUzM5
MENDV0RldmljZSAqY2RldiwgY2hhciAqc3lzZnNkZXYsIEVycm9yICoqZXJycCkKICAgICBEZXZp
Y2VTdGF0ZSAqcGFyZW50ID0gREVWSUNFKGNjd19kZXYpOwogICAgIFN1YmNoRGV2ICpzY2g7CiAg
ICAgaW50IHJldDsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKIAotICAgIHMzOTBfY2N3X2dldF9k
ZXZfaW5mbyhjZGV2LCBzeXNmc2RldiwgJmVycik7Ci0gICAgaWYgKGVycikgeworICAgIHMzOTBf
Y2N3X2dldF9kZXZfaW5mbyhjZGV2LCBzeXNmc2RldiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7
CiAgICAgICAgIGdvdG8gb3V0X2Vycl9wcm9wYWdhdGU7CiAgICAgfQogCi0gICAgc2NoID0gY3Nz
X2NyZWF0ZV9zY2goY2N3X2Rldi0+ZGV2bm8sICZlcnIpOworICAgIHNjaCA9IGNzc19jcmVhdGVf
c2NoKGNjd19kZXYtPmRldm5vLCBlcnJwKTsKICAgICBpZiAoIXNjaCkgewogICAgICAgICBnb3Rv
IG91dF9tZGV2aWRfZnJlZTsKICAgICB9CkBAIC0xMDgsMTMgKzEwNywxMyBAQCBzdGF0aWMgdm9p
ZCBzMzkwX2Njd19yZWFsaXplKFMzOTBDQ1dEZXZpY2UgKmNkZXYsIGNoYXIgKnN5c2ZzZGV2LCBF
cnJvciAqKmVycnApCiAgICAgY2N3X2Rldi0+c2NoID0gc2NoOwogICAgIHJldCA9IGNzc19zY2hf
YnVpbGRfc2NoaWIoc2NoLCAmY2Rldi0+aG9zdGlkKTsKICAgICBpZiAocmV0KSB7Ci0gICAgICAg
IGVycm9yX3NldGdfZXJybm8oJmVyciwgLXJldCwgIiVzOiBGYWlsZWQgdG8gYnVpbGQgaW5pdGlh
bCBzY2hpYiIsCisgICAgICAgIGVycm9yX3NldGdfZXJybm8oZXJycCwgLXJldCwgIiVzOiBGYWls
ZWQgdG8gYnVpbGQgaW5pdGlhbCBzY2hpYiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgX19m
dW5jX18pOwogICAgICAgICBnb3RvIG91dF9lcnI7CiAgICAgfQogCi0gICAgY2stPnJlYWxpemUo
Y2N3X2RldiwgJmVycik7Ci0gICAgaWYgKGVycikgeworICAgIGNrLT5yZWFsaXplKGNjd19kZXYs
IGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICBnb3RvIG91dF9lcnI7CiAgICAgfQog
CkBAIC0xMjksNyArMTI4LDYgQEAgb3V0X2VycjoKIG91dF9tZGV2aWRfZnJlZToKICAgICBnX2Zy
ZWUoY2Rldi0+bWRldmlkKTsKIG91dF9lcnJfcHJvcGFnYXRlOgotICAgIGVycm9yX3Byb3BhZ2F0
ZShlcnJwLCBlcnIpOwogfQogCiBzdGF0aWMgdm9pZCBzMzkwX2Njd191bnJlYWxpemUoUzM5MEND
V0RldmljZSAqY2RldiwgRXJyb3IgKiplcnJwKQpkaWZmIC0tZ2l0IGEvaHcvczM5MHgvczM5MC1w
Y2ktYnVzLmMgYi9ody9zMzkweC9zMzkwLXBjaS1idXMuYwppbmRleCA5NjNhNDFjN2Y1Li4yMDBi
OTYyNmRkIDEwMDY0NAotLS0gYS9ody9zMzkweC9zMzkwLXBjaS1idXMuYworKysgYi9ody9zMzkw
eC9zMzkwLXBjaS1idXMuYwpAQCAtNzM2LDcgKzczNiw2IEBAIHN0YXRpYyB2b2lkIHMzOTBfcGNp
aG9zdF9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAgICBCdXNTdGF0
ZSAqYnVzOwogICAgIFBDSUhvc3RTdGF0ZSAqcGhiID0gUENJX0hPU1RfQlJJREdFKGRldik7CiAg
ICAgUzM5MHBjaVN0YXRlICpzID0gUzM5MF9QQ0lfSE9TVF9CUklER0UoZGV2KTsKLSAgICBFcnJv
ciAqbG9jYWxfZXJyID0gTlVMTDsKIAogICAgIERQUklOVEYoImhvc3RfaW5pdFxuIik7CiAKQEAg
LTc0NiwxNyArNzQ1LDE1IEBAIHN0YXRpYyB2b2lkIHMzOTBfcGNpaG9zdF9yZWFsaXplKERldmlj
ZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAgICBwY2lfc2V0dXBfaW9tbXUoYiwgczM5MF9w
Y2lfZG1hX2lvbW11LCBzKTsKIAogICAgIGJ1cyA9IEJVUyhiKTsKLSAgICBxYnVzX3NldF9ob3Rw
bHVnX2hhbmRsZXIoYnVzLCBPQkpFQ1QoZGV2KSwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2Fs
X2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBx
YnVzX3NldF9ob3RwbHVnX2hhbmRsZXIoYnVzLCBPQkpFQ1QoZGV2KSwgZXJycCk7CisgICAgaWYg
KCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAgICAgcGhiLT5idXMgPSBiOwogCiAg
ICAgcy0+YnVzID0gUzM5MF9QQ0lfQlVTKHFidXNfY3JlYXRlKFRZUEVfUzM5MF9QQ0lfQlVTLCBk
ZXYsIE5VTEwpKTsKLSAgICBxYnVzX3NldF9ob3RwbHVnX2hhbmRsZXIoQlVTKHMtPmJ1cyksIE9C
SkVDVChkZXYpLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVy
cm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHFidXNfc2V0X2hvdHBsdWdfaGFu
ZGxlcihCVVMocy0+YnVzKSwgT0JKRUNUKGRldiksIGVycnApOworICAgIGlmICgqZXJycCkgewog
ICAgICAgICByZXR1cm47CiAgICAgfQogCkBAIC03NjgsOCArNzY1LDcgQEAgc3RhdGljIHZvaWQg
czM5MF9wY2lob3N0X3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogICAg
IFFUQUlMUV9JTklUKCZzLT56cGNpX2RldnMpOwogCiAgICAgY3NzX3JlZ2lzdGVyX2lvX2FkYXB0
ZXJzKENTU19JT19BREFQVEVSX1BDSSwgdHJ1ZSwgZmFsc2UsCi0gICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIFMzOTBfQURBUFRFUl9TVVBQUkVTU0lCTEUsICZsb2NhbF9lcnIpOwotICAgIGVy
cm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBTMzkwX0FEQVBURVJfU1VQUFJFU1NJQkxFLCBlcnJwKTsKIH0KIAogc3RhdGljIGludCBz
MzkwX3BjaV9tc2l4X2luaXQoUzM5MFBDSUJ1c0RldmljZSAqcGJkZXYpCkBAIC04MTYsNyArODEy
LDYgQEAgc3RhdGljIHZvaWQgczM5MF9wY2lfbXNpeF9mcmVlKFMzOTBQQ0lCdXNEZXZpY2UgKnBi
ZGV2KQogc3RhdGljIFMzOTBQQ0lCdXNEZXZpY2UgKnMzOTBfcGNpX2RldmljZV9uZXcoUzM5MHBj
aVN0YXRlICpzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
Y29uc3QgY2hhciAqdGFyZ2V0LCBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJyb3IgKmxvY2FsX2Vy
ciA9IE5VTEw7CiAgICAgRGV2aWNlU3RhdGUgKmRldjsKIAogICAgIGRldiA9IHFkZXZfdHJ5X2Ny
ZWF0ZShCVVMocy0+YnVzKSwgVFlQRV9TMzkwX1BDSV9ERVZJQ0UpOwpAQCAtODI1LDE3ICs4MjAs
MTcgQEAgc3RhdGljIFMzOTBQQ0lCdXNEZXZpY2UgKnMzOTBfcGNpX2RldmljZV9uZXcoUzM5MHBj
aVN0YXRlICpzLAogICAgICAgICByZXR1cm4gTlVMTDsKICAgICB9CiAKLSAgICBvYmplY3RfcHJv
cGVydHlfc2V0X3N0cihPQkpFQ1QoZGV2KSwgdGFyZ2V0LCAidGFyZ2V0IiwgJmxvY2FsX2Vycik7
Ci0gICAgaWYgKGxvY2FsX2VycikgeworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfc3RyKE9CSkVD
VChkZXYpLCB0YXJnZXQsICJ0YXJnZXQiLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAg
ICAgb2JqZWN0X3VucGFyZW50KE9CSkVDVChkZXYpKTsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRl
X3ByZXBlbmQoZXJycCwgbG9jYWxfZXJyLAorICAgICAgICBlcnJvcl9wcm9wYWdhdGVfcHJlcGVu
ZChlcnJwLCAqZXJycCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInpQQ0kgZGV2
aWNlIGNvdWxkIG5vdCBiZSBjcmVhdGVkOiAiKTsKICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAg
fQotICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoZGV2KSwgdHJ1ZSwgInJlYWxp
emVkIiwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgeworICAgIG9iamVjdF9wcm9w
ZXJ0eV9zZXRfYm9vbChPQkpFQ1QoZGV2KSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAg
aWYgKCplcnJwKSB7CiAgICAgICAgIG9iamVjdF91bnBhcmVudChPQkpFQ1QoZGV2KSk7Ci0gICAg
ICAgIGVycm9yX3Byb3BhZ2F0ZV9wcmVwZW5kKGVycnAsIGxvY2FsX2VyciwKKyAgICAgICAgZXJy
b3JfcHJvcGFnYXRlX3ByZXBlbmQoZXJycCwgKmVycnAsCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICJ6UENJIGRldmljZSBjb3VsZCBub3QgYmUgY3JlYXRlZDogIik7CiAgICAgICAg
IHJldHVybiBOVUxMOwogICAgIH0KQEAgLTEyMDgsMTEgKzEyMDMsOCBAQCBzdGF0aWMgdm9pZCBz
MzkwX3BjaV9kZXZpY2VfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAg
ICAgfQogCiAgICAgaWYgKCF6cGNpLT5maWRfZGVmaW5lZCkgewotICAgICAgICBFcnJvciAqbG9j
YWxfZXJyb3IgPSBOVUxMOwotCi0gICAgICAgIHpwY2ktPmZpZCA9IHMzOTBfcGNpX2dlbmVyYXRl
X2ZpZChzLCAmbG9jYWxfZXJyb3IpOwotICAgICAgICBpZiAobG9jYWxfZXJyb3IpIHsKLSAgICAg
ICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnJvcik7CisgICAgICAgIHpwY2kt
PmZpZCA9IHMzOTBfcGNpX2dlbmVyYXRlX2ZpZChzLCBlcnJwKTsKKyAgICAgICAgaWYgKCplcnJw
KSB7CiAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgIH0KICAgICB9IGVsc2UgaWYgKHMzOTBf
cGNpX2ZpbmRfZGV2X2J5X2ZpZChzLCB6cGNpLT5maWQpKSB7CmRpZmYgLS1naXQgYS9ody9zMzkw
eC9zMzkwLXNrZXlzLmMgYi9ody9zMzkweC9zMzkwLXNrZXlzLmMKaW5kZXggYmQzN2YzOTEyMC4u
Njk2M2ZmOWNkZSAxMDA2NDQKLS0tIGEvaHcvczM5MHgvczM5MC1za2V5cy5jCisrKyBiL2h3L3Mz
OTB4L3MzOTAtc2tleXMuYwpAQCAtMTExLDcgKzExMSw2IEBAIHZvaWQgcW1wX2R1bXBfc2tleXMo
Y29uc3QgY2hhciAqZmlsZW5hbWUsIEVycm9yICoqZXJycCkKICAgICBTMzkwU0tleXNDbGFzcyAq
c2tleWNsYXNzID0gUzM5MF9TS0VZU19HRVRfQ0xBU1Moc3MpOwogICAgIGNvbnN0IHVpbnQ2NF90
IHRvdGFsX2NvdW50ID0gcmFtX3NpemUgLyBUQVJHRVRfUEFHRV9TSVpFOwogICAgIHVpbnQ2NF90
IGhhbmRsZWRfY291bnQgPSAwLCBjdXJfY291bnQ7Ci0gICAgRXJyb3IgKmxlcnIgPSBOVUxMOwog
ICAgIHZhZGRyIGN1cl9nZm4gPSAwOwogICAgIHVpbnQ4X3QgKmJ1ZjsKICAgICBpbnQgcmV0OwpA
QCAtMTU1LDggKzE1NCw4IEBAIHZvaWQgcW1wX2R1bXBfc2tleXMoY29uc3QgY2hhciAqZmlsZW5h
bWUsIEVycm9yICoqZXJycCkKICAgICAgICAgfQogCiAgICAgICAgIC8qIHdyaXRlIGtleXMgdG8g
c3RyZWFtICovCi0gICAgICAgIHdyaXRlX2tleXMoZiwgYnVmLCBjdXJfZ2ZuLCBjdXJfY291bnQs
ICZsZXJyKTsKLSAgICAgICAgaWYgKGxlcnIpIHsKKyAgICAgICAgd3JpdGVfa2V5cyhmLCBidWYs
IGN1cl9nZm4sIGN1cl9jb3VudCwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAg
ICAgICAgZ290byBvdXRfZnJlZTsKICAgICAgICAgfQogCkBAIC0xNjUsNyArMTY0LDYgQEAgdm9p
ZCBxbXBfZHVtcF9za2V5cyhjb25zdCBjaGFyICpmaWxlbmFtZSwgRXJyb3IgKiplcnJwKQogICAg
IH0KIAogb3V0X2ZyZWU6Ci0gICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxlcnIpOwogICAgIGdf
ZnJlZShidWYpOwogb3V0OgogICAgIGZjbG9zZShmKTsKZGlmZiAtLWdpdCBhL2h3L3MzOTB4L3Mz
OTAtdmlydGlvLWNjdy5jIGIvaHcvczM5MHgvczM5MC12aXJ0aW8tY2N3LmMKaW5kZXggOGJmYjY2
ODRjYi4uOTY2ZGU1NzgyNiAxMDA2NDQKLS0tIGEvaHcvczM5MHgvczM5MC12aXJ0aW8tY2N3LmMK
KysrIGIvaHcvczM5MHgvczM5MC12aXJ0aW8tY2N3LmMKQEAgLTYyLDE4ICs2MiwxNiBAQCBzdGF0
aWMgUzM5MENQVSAqczM5MHhfbmV3X2NwdShjb25zdCBjaGFyICp0eXBlbmFtZSwgdWludDMyX3Qg
Y29yZV9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVycm9yICoqZXJycCkKIHsK
ICAgICBTMzkwQ1BVICpjcHUgPSBTMzkwX0NQVShvYmplY3RfbmV3KHR5cGVuYW1lKSk7Ci0gICAg
RXJyb3IgKmVyciA9IE5VTEw7CiAKLSAgICBvYmplY3RfcHJvcGVydHlfc2V0X2ludChPQkpFQ1Qo
Y3B1KSwgY29yZV9pZCwgImNvcmUtaWQiLCAmZXJyKTsKLSAgICBpZiAoZXJyICE9IE5VTEwpIHsK
KyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2ludChPQkpFQ1QoY3B1KSwgY29yZV9pZCwgImNvcmUt
aWQiLCBlcnJwKTsKKyAgICBpZiAoKmVycnAgIT0gTlVMTCkgewogICAgICAgICBnb3RvIG91dDsK
ICAgICB9Ci0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVChjcHUpLCB0cnVlLCAi
cmVhbGl6ZWQiLCAmZXJyKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKGNw
dSksIHRydWUsICJyZWFsaXplZCIsIGVycnApOwogCiBvdXQ6CiAgICAgb2JqZWN0X3VucmVmKE9C
SkVDVChjcHUpKTsKLSAgICBpZiAoZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJw
LCBlcnIpOworICAgIGlmICgqZXJycCkgewogICAgICAgICBjcHUgPSBOVUxMOwogICAgIH0KICAg
ICByZXR1cm4gY3B1OwpkaWZmIC0tZ2l0IGEvaHcvczM5MHgvc2NscC5jIGIvaHcvczM5MHgvc2Ns
cC5jCmluZGV4IGZhYzdjM2JiNmMuLjVkODc3OGJmMmEgMTAwNjQ0Ci0tLSBhL2h3L3MzOTB4L3Nj
bHAuYworKysgYi9ody9zMzkweC9zY2xwLmMKQEAgLTI3MSwxNCArMjcxLDEzIEBAIHN0YXRpYyB2
b2lkIHNjbHBfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiB7CiAgICAg
TWFjaGluZVN0YXRlICptYWNoaW5lID0gTUFDSElORShxZGV2X2dldF9tYWNoaW5lKCkpOwogICAg
IFNDTFBEZXZpY2UgKnNjbHAgPSBTQ0xQKGRldik7Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7CiAg
ICAgdWludDY0X3QgaHdfbGltaXQ7CiAgICAgaW50IHJldDsKIAogICAgIG9iamVjdF9wcm9wZXJ0
eV9zZXRfYm9vbChPQkpFQ1Qoc2NscC0+ZXZlbnRfZmFjaWxpdHkpLCB0cnVlLCAicmVhbGl6ZWQi
LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmZXJyKTsKLSAgICBpZiAoZXJyKSB7Ci0g
ICAgICAgIGdvdG8gb3V0OworICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJwKTsKKyAg
ICBpZiAoKmVycnApIHsKKyAgICAgICAgcmV0dXJuOwogICAgIH0KICAgICAvKgogICAgICAqIHFk
ZXZfZGV2aWNlX2FkZCBzZWFyY2hlcyB0aGUgc3lzYnVzIGZvciBUWVBFX1NDTFBfRVZFTlRTX0JV
Uy4gQXMgbG9uZwpAQCAtMjg5LDE0ICsyODgsMTEgQEAgc3RhdGljIHZvaWQgc2NscF9yZWFsaXpl
KERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKIAogICAgIHJldCA9IHMzOTBfc2V0X21l
bW9yeV9saW1pdChtYWNoaW5lLT5tYXhyYW1fc2l6ZSwgJmh3X2xpbWl0KTsKICAgICBpZiAocmV0
ID09IC1FMkJJRykgewotICAgICAgICBlcnJvcl9zZXRnKCZlcnIsICJob3N0IHN1cHBvcnRzIGEg
bWF4aW11bSBvZiAlIiBQUkl1NjQgIiBHQiIsCisgICAgICAgIGVycm9yX3NldGcoZXJycCwgImhv
c3Qgc3VwcG9ydHMgYSBtYXhpbXVtIG9mICUiIFBSSXU2NCAiIEdCIiwKICAgICAgICAgICAgICAg
ICAgICBod19saW1pdCAvIEdpQik7CiAgICAgfSBlbHNlIGlmIChyZXQpIHsKLSAgICAgICAgZXJy
b3Jfc2V0ZygmZXJyLCAic2V0dGluZyB0aGUgZ3Vlc3Qgc2l6ZSBmYWlsZWQiKTsKKyAgICAgICAg
ZXJyb3Jfc2V0ZyhlcnJwLCAic2V0dGluZyB0aGUgZ3Vlc3Qgc2l6ZSBmYWlsZWQiKTsKICAgICB9
Ci0KLW91dDoKLSAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKIH0KIAogc3RhdGljIHZv
aWQgc2NscF9tZW1vcnlfaW5pdChTQ0xQRGV2aWNlICpzY2xwKQpkaWZmIC0tZ2l0IGEvaHcvczM5
MHgvdG9kLWt2bS5jIGIvaHcvczM5MHgvdG9kLWt2bS5jCmluZGV4IDZlMjFkODMxODEuLjA5Njk2
NjUyMWMgMTAwNjQ0Ci0tLSBhL2h3L3MzOTB4L3RvZC1rdm0uYworKysgYi9ody9zMzkweC90b2Qt
a3ZtLmMKQEAgLTU1LDggKzU1LDYgQEAgc3RhdGljIHZvaWQga3ZtX3MzOTBfc2V0X3RvZF9yYXco
Y29uc3QgUzM5MFRPRCAqdG9kLCBFcnJvciAqKmVycnApCiAKIHN0YXRpYyB2b2lkIGt2bV9zMzkw
X3RvZF9zZXQoUzM5MFRPRFN0YXRlICp0ZCwgY29uc3QgUzM5MFRPRCAqdG9kLCBFcnJvciAqKmVy
cnApCiB7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7Ci0KICAgICAvKgogICAgICAqIFNv
bWVib2R5IChlLmcuIG1pZ3JhdGlvbikgc2V0IHRoZSBUT0QuIFdlJ2xsIHN0b3JlIGl0IGludG8g
S1ZNIHRvCiAgICAgICogcHJvcGVybHkgZGV0ZWN0IGVycm9ycyBub3cgYnV0IHRha2UgYSBsb29r
IGF0IHRoZSBydW5zdGF0ZSB0byBkZWNpZGUKQEAgLTY0LDkgKzYyLDggQEAgc3RhdGljIHZvaWQg
a3ZtX3MzOTBfdG9kX3NldChTMzkwVE9EU3RhdGUgKnRkLCBjb25zdCBTMzkwVE9EICp0b2QsIEVy
cm9yICoqZXJycCkKICAgICAgKiBpcyB0aGUgcG9pbnQgd2hlcmUgd2Ugd2FudCB0byBzdG9wIHRo
ZSBpbml0aWFsbHkgcnVubmluZyBUT0QgdG8gZmlyZQogICAgICAqIGl0IGJhY2sgdXAgd2hlbiBh
Y3R1YWxseSBzdGFydGluZyB0aGUgbWlncmF0ZWQgZ3Vlc3QuCiAgICAgICovCi0gICAga3ZtX3Mz
OTBfc2V0X3RvZF9yYXcodG9kLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0g
ICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIGt2bV9zMzkwX3Nl
dF90b2RfcmF3KHRvZCwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsK
ICAgICB9CiAKQEAgLTEwOCwxMSArMTA1LDkgQEAgc3RhdGljIHZvaWQga3ZtX3MzOTBfdG9kX3Jl
YWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogewogICAgIFMzOTBUT0RTdGF0
ZSAqdGQgPSBTMzkwX1RPRChkZXYpOwogICAgIFMzOTBUT0RDbGFzcyAqdGRjID0gUzM5MF9UT0Rf
R0VUX0NMQVNTKHRkKTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAotICAgIHRkYy0+
cGFyZW50X3JlYWxpemUoZGV2LCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0g
ICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHRkYy0+cGFyZW50
X3JlYWxpemUoZGV2LCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwog
ICAgIH0KIApkaWZmIC0tZ2l0IGEvaHcvczM5MHgvdmlydGlvLWNjdy1jcnlwdG8uYyBiL2h3L3Mz
OTB4L3ZpcnRpby1jY3ctY3J5cHRvLmMKaW5kZXggMDg2YjM5N2FkMi4uZDA0MmU3NGJjZCAxMDA2
NDQKLS0tIGEvaHcvczM5MHgvdmlydGlvLWNjdy1jcnlwdG8uYworKysgYi9ody9zMzkweC92aXJ0
aW8tY2N3LWNyeXB0by5jCkBAIC0xOSwxMiArMTksMTAgQEAgc3RhdGljIHZvaWQgdmlydGlvX2Nj
d19jcnlwdG9fcmVhbGl6ZShWaXJ0aW9DY3dEZXZpY2UgKmNjd19kZXYsIEVycm9yICoqZXJycCkK
IHsKICAgICBWaXJ0SU9DcnlwdG9DY3cgKmRldiA9IFZJUlRJT19DUllQVE9fQ0NXKGNjd19kZXYp
OwogICAgIERldmljZVN0YXRlICp2ZGV2ID0gREVWSUNFKCZkZXYtPnZkZXYpOwotICAgIEVycm9y
ICplcnIgPSBOVUxMOwogCiAgICAgcWRldl9zZXRfcGFyZW50X2J1cyh2ZGV2LCBCVVMoJmNjd19k
ZXYtPmJ1cykpOwotICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QodmRldiksIHRy
dWUsICJyZWFsaXplZCIsICZlcnIpOwotICAgIGlmIChlcnIpIHsKLSAgICAgICAgZXJyb3JfcHJv
cGFnYXRlKGVycnAsIGVycik7CisgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCh2
ZGV2KSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAg
IHJldHVybjsKICAgICB9CiAKZGlmZiAtLWdpdCBhL2h3L3MzOTB4L3ZpcnRpby1jY3ctcm5nLmMg
Yi9ody9zMzkweC92aXJ0aW8tY2N3LXJuZy5jCmluZGV4IDg1NDI1NGRkNTAuLjIwYjBlODQyNTAg
MTAwNjQ0Ci0tLSBhL2h3L3MzOTB4L3ZpcnRpby1jY3ctcm5nLmMKKysrIGIvaHcvczM5MHgvdmly
dGlvLWNjdy1ybmcuYwpAQCAtMjAsMTIgKzIwLDEwIEBAIHN0YXRpYyB2b2lkIHZpcnRpb19jY3df
cm5nX3JlYWxpemUoVmlydGlvQ2N3RGV2aWNlICpjY3dfZGV2LCBFcnJvciAqKmVycnApCiB7CiAg
ICAgVmlydElPUk5HQ2N3ICpkZXYgPSBWSVJUSU9fUk5HX0NDVyhjY3dfZGV2KTsKICAgICBEZXZp
Y2VTdGF0ZSAqdmRldiA9IERFVklDRSgmZGV2LT52ZGV2KTsKLSAgICBFcnJvciAqZXJyID0gTlVM
TDsKIAogICAgIHFkZXZfc2V0X3BhcmVudF9idXModmRldiwgQlVTKCZjY3dfZGV2LT5idXMpKTsK
LSAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKHZkZXYpLCB0cnVlLCAicmVhbGl6
ZWQiLCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJw
LCBlcnIpOworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QodmRldiksIHRydWUs
ICJyZWFsaXplZCIsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAg
ICAgfQogCmRpZmYgLS1naXQgYS9ody9zMzkweC92aXJ0aW8tY2N3LmMgYi9ody9zMzkweC92aXJ0
aW8tY2N3LmMKaW5kZXggNjU4MGNlNTkwNy4uN2NkMWVjNDg2MiAxMDA2NDQKLS0tIGEvaHcvczM5
MHgvdmlydGlvLWNjdy5jCisrKyBiL2h3L3MzOTB4L3ZpcnRpby1jY3cuYwpAQCAtNjk2LDE0ICs2
OTYsMTMgQEAgc3RhdGljIHZvaWQgdmlydGlvX2Njd19kZXZpY2VfcmVhbGl6ZShWaXJ0aW9DY3dE
ZXZpY2UgKmRldiwgRXJyb3IgKiplcnJwKQogICAgIENjd0RldmljZSAqY2N3X2RldiA9IENDV19E
RVZJQ0UoZGV2KTsKICAgICBDQ1dEZXZpY2VDbGFzcyAqY2sgPSBDQ1dfREVWSUNFX0dFVF9DTEFT
UyhjY3dfZGV2KTsKICAgICBTdWJjaERldiAqc2NoOwotICAgIEVycm9yICplcnIgPSBOVUxMOwog
CiAgICAgc2NoID0gY3NzX2NyZWF0ZV9zY2goY2N3X2Rldi0+ZGV2bm8sIGVycnApOwogICAgIGlm
ICghc2NoKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAgICAgaWYgKCF2aXJ0aW9fY2N3X3Jl
dl9tYXgoZGV2KSAmJiBkZXYtPmZvcmNlX3JldmlzaW9uXzEpIHsKLSAgICAgICAgZXJyb3Jfc2V0
ZygmZXJyLCAiSW52YWxpZCB2YWx1ZSBvZiBwcm9wZXJ0eSBtYXhfcmV2ICIKKyAgICAgICAgZXJy
b3Jfc2V0ZyhlcnJwLCAiSW52YWxpZCB2YWx1ZSBvZiBwcm9wZXJ0eSBtYXhfcmV2ICIKICAgICAg
ICAgICAgICAgICAgICAiKGlzICVkIGV4cGVjdGVkID49IDEpIiwgdmlydGlvX2Njd19yZXZfbWF4
KGRldikpOwogICAgICAgICBnb3RvIG91dF9lcnI7CiAgICAgfQpAQCAtNzI4LDIxICs3MjcsMjAg
QEAgc3RhdGljIHZvaWQgdmlydGlvX2Njd19kZXZpY2VfcmVhbGl6ZShWaXJ0aW9DY3dEZXZpY2Ug
KmRldiwgRXJyb3IgKiplcnJwKQogICAgIH0KIAogICAgIGlmIChrLT5yZWFsaXplKSB7Ci0gICAg
ICAgIGstPnJlYWxpemUoZGV2LCAmZXJyKTsKLSAgICAgICAgaWYgKGVycikgeworICAgICAgICBr
LT5yZWFsaXplKGRldiwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAg
Z290byBvdXRfZXJyOwogICAgICAgICB9CiAgICAgfQogCi0gICAgY2stPnJlYWxpemUoY2N3X2Rl
diwgJmVycik7Ci0gICAgaWYgKGVycikgeworICAgIGNrLT5yZWFsaXplKGNjd19kZXYsIGVycnAp
OworICAgIGlmICgqZXJycCkgewogICAgICAgICBnb3RvIG91dF9lcnI7CiAgICAgfQogCiAgICAg
cmV0dXJuOwogCiBvdXRfZXJyOgotICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOwogICAg
IGNzc19zdWJjaF9hc3NpZ24oc2NoLT5jc3NpZCwgc2NoLT5zc2lkLCBzY2gtPnNjaGlkLCBzY2gt
PmRldm5vLCBOVUxMKTsKICAgICBjY3dfZGV2LT5zY2ggPSBOVUxMOwogICAgIGdfZnJlZShzY2gp
OwpkaWZmIC0tZ2l0IGEvaHcvc2NzaS9lc3AtcGNpLmMgYi9ody9zY3NpL2VzcC1wY2kuYwppbmRl
eCBkNWExZjllMDE3Li45NjZiNTA5ZWYwIDEwMDY0NAotLS0gYS9ody9zY3NpL2VzcC1wY2kuYwor
KysgYi9ody9zY3NpL2VzcC1wY2kuYwpAQCAtNDY5LDE1ICs0NjksMTMgQEAgc3RhdGljIHZvaWQg
ZGMzOTBfd3JpdGVfY29uZmlnKFBDSURldmljZSAqZGV2LAogc3RhdGljIHZvaWQgZGMzOTBfc2Nz
aV9yZWFsaXplKFBDSURldmljZSAqZGV2LCBFcnJvciAqKmVycnApCiB7CiAgICAgREMzOTBTdGF0
ZSAqcGNpID0gREMzOTAoZGV2KTsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKICAgICB1aW50OF90
ICpjb250ZW50czsKICAgICB1aW50MTZfdCBjaGtzdW0gPSAwOwogICAgIGludCBpOwogCiAgICAg
LyogaW5pdCBiYXNlIGNsYXNzICovCi0gICAgZXNwX3BjaV9zY3NpX3JlYWxpemUoZGV2LCAmZXJy
KTsKLSAgICBpZiAoZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOwor
ICAgIGVzcF9wY2lfc2NzaV9yZWFsaXplKGRldiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAg
ICAgICAgIHJldHVybjsKICAgICB9CiAKZGlmZiAtLWdpdCBhL2h3L3Njc2kvbWVnYXNhcy5jIGIv
aHcvc2NzaS9tZWdhc2FzLmMKaW5kZXggZGU5YmQyMDg4Ny4uODkwNzkxNWY0OSAxMDA2NDQKLS0t
IGEvaHcvc2NzaS9tZWdhc2FzLmMKKysrIGIvaHcvc2NzaS9tZWdhc2FzLmMKQEAgLTIzMTUsNyAr
MjMxNSw2IEBAIHN0YXRpYyB2b2lkIG1lZ2FzYXNfc2NzaV9yZWFsaXplKFBDSURldmljZSAqZGV2
LCBFcnJvciAqKmVycnApCiAgICAgTWVnYXNhc0Jhc2VDbGFzcyAqYiA9IE1FR0FTQVNfREVWSUNF
X0dFVF9DTEFTUyhzKTsKICAgICB1aW50OF90ICpwY2lfY29uZjsKICAgICBpbnQgaSwgYmFyX3R5
cGU7Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7CiAgICAgaW50IHJldDsKIAogICAgIHBjaV9jb25m
ID0gZGV2LT5jb25maWc7CkBAIC0yMzI2LDIwICsyMzI1LDE5IEBAIHN0YXRpYyB2b2lkIG1lZ2Fz
YXNfc2NzaV9yZWFsaXplKFBDSURldmljZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgcGNpX2Nv
bmZbUENJX0lOVEVSUlVQVF9QSU5dID0gMHgwMTsKIAogICAgIGlmIChzLT5tc2kgIT0gT05fT0ZG
X0FVVE9fT0ZGKSB7Ci0gICAgICAgIHJldCA9IG1zaV9pbml0KGRldiwgMHg1MCwgMSwgdHJ1ZSwg
ZmFsc2UsICZlcnIpOworICAgICAgICByZXQgPSBtc2lfaW5pdChkZXYsIDB4NTAsIDEsIHRydWUs
IGZhbHNlLCBlcnJwKTsKICAgICAgICAgLyogQW55IGVycm9yIG90aGVyIHRoYW4gLUVOT1RTVVAo
Ym9hcmQncyBNU0kgc3VwcG9ydCBpcyBicm9rZW4pCiAgICAgICAgICAqIGlzIGEgcHJvZ3JhbW1p
bmcgZXJyb3IgKi8KICAgICAgICAgYXNzZXJ0KCFyZXQgfHwgcmV0ID09IC1FTk9UU1VQKTsKICAg
ICAgICAgaWYgKHJldCAmJiBzLT5tc2kgPT0gT05fT0ZGX0FVVE9fT04pIHsKICAgICAgICAgICAg
IC8qIENhbid0IHNhdGlzZnkgdXNlcidzIGV4cGxpY2l0IG1zaT1vbiByZXF1ZXN0LCBmYWlsICov
Ci0gICAgICAgICAgICBlcnJvcl9hcHBlbmRfaGludCgmZXJyLCAiWW91IGhhdmUgdG8gdXNlIG1z
aT1hdXRvIChkZWZhdWx0KSBvciAiCi0gICAgICAgICAgICAgICAgICAgICJtc2k9b2ZmIHdpdGgg
dGhpcyBtYWNoaW5lIHR5cGUuXG4iKTsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJw
LCBlcnIpOworICAgICAgICAgICAgZXJyb3JfYXBwZW5kX2hpbnQoZXJycCwgIllvdSBoYXZlIHRv
IHVzZSBtc2k9YXV0byAoZGVmYXVsdCkgb3IgIgorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIm1zaT1vZmYgd2l0aCB0aGlzIG1hY2hpbmUgdHlwZS5cbiIpOwogICAgICAgICAgICAgcmV0
dXJuOwogICAgICAgICB9IGVsc2UgaWYgKHJldCkgewogICAgICAgICAgICAgLyogV2l0aCBtc2k9
YXV0bywgd2UgZmFsbCBiYWNrIHRvIE1TSSBvZmYgc2lsZW50bHkgKi8KICAgICAgICAgICAgIHMt
Pm1zaSA9IE9OX09GRl9BVVRPX09GRjsKLSAgICAgICAgICAgIGVycm9yX2ZyZWUoZXJyKTsKKyAg
ICAgICAgICAgIGVycm9yX2ZyZWVfZXJycChlcnJwKTsKICAgICAgICAgfQogICAgIH0KIApkaWZm
IC0tZ2l0IGEvaHcvc2NzaS9tcHRzYXMuYyBiL2h3L3Njc2kvbXB0c2FzLmMKaW5kZXggYjhhNGIz
N2NmMy4uNzFlZGM5ZTM4YSAxMDA2NDQKLS0tIGEvaHcvc2NzaS9tcHRzYXMuYworKysgYi9ody9z
Y3NpL21wdHNhcy5jCkBAIC0xMjczLDI3ICsxMjczLDI1IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3Qg
U0NTSUJ1c0luZm8gbXB0c2FzX3Njc2lfaW5mbyA9IHsKIHN0YXRpYyB2b2lkIG1wdHNhc19zY3Np
X3JlYWxpemUoUENJRGV2aWNlICpkZXYsIEVycm9yICoqZXJycCkKIHsKICAgICBNUFRTQVNTdGF0
ZSAqcyA9IE1QVF9TQVMoZGV2KTsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKICAgICBpbnQgcmV0
OwogCiAgICAgZGV2LT5jb25maWdbUENJX0xBVEVOQ1lfVElNRVJdID0gMDsKICAgICBkZXYtPmNv
bmZpZ1tQQ0lfSU5URVJSVVBUX1BJTl0gPSAweDAxOwogCiAgICAgaWYgKHMtPm1zaSAhPSBPTl9P
RkZfQVVUT19PRkYpIHsKLSAgICAgICAgcmV0ID0gbXNpX2luaXQoZGV2LCAwLCAxLCB0cnVlLCBm
YWxzZSwgJmVycik7CisgICAgICAgIHJldCA9IG1zaV9pbml0KGRldiwgMCwgMSwgdHJ1ZSwgZmFs
c2UsIGVycnApOwogICAgICAgICAvKiBBbnkgZXJyb3Igb3RoZXIgdGhhbiAtRU5PVFNVUChib2Fy
ZCdzIE1TSSBzdXBwb3J0IGlzIGJyb2tlbikKICAgICAgICAgICogaXMgYSBwcm9ncmFtbWluZyBl
cnJvciAqLwogICAgICAgICBhc3NlcnQoIXJldCB8fCByZXQgPT0gLUVOT1RTVVApOwogICAgICAg
ICBpZiAocmV0ICYmIHMtPm1zaSA9PSBPTl9PRkZfQVVUT19PTikgewogICAgICAgICAgICAgLyog
Q2FuJ3Qgc2F0aXNmeSB1c2VyJ3MgZXhwbGljaXQgbXNpPW9uIHJlcXVlc3QsIGZhaWwgKi8KLSAg
ICAgICAgICAgIGVycm9yX2FwcGVuZF9oaW50KCZlcnIsICJZb3UgaGF2ZSB0byB1c2UgbXNpPWF1
dG8gKGRlZmF1bHQpIG9yICIKLSAgICAgICAgICAgICAgICAgICAgIm1zaT1vZmYgd2l0aCB0aGlz
IG1hY2hpbmUgdHlwZS5cbiIpOwotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVy
cik7CisgICAgICAgICAgICBlcnJvcl9hcHBlbmRfaGludChlcnJwLCAiWW91IGhhdmUgdG8gdXNl
IG1zaT1hdXRvIChkZWZhdWx0KSBvciAiCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAi
bXNpPW9mZiB3aXRoIHRoaXMgbWFjaGluZSB0eXBlLlxuIik7CiAgICAgICAgICAgICByZXR1cm47
CiAgICAgICAgIH0KLSAgICAgICAgYXNzZXJ0KCFlcnIgfHwgcy0+bXNpID09IE9OX09GRl9BVVRP
X0FVVE8pOworICAgICAgICBhc3NlcnQoISplcnJwIHx8IHMtPm1zaSA9PSBPTl9PRkZfQVVUT19B
VVRPKTsKICAgICAgICAgLyogV2l0aCBtc2k9YXV0bywgd2UgZmFsbCBiYWNrIHRvIE1TSSBvZmYg
c2lsZW50bHkgKi8KLSAgICAgICAgZXJyb3JfZnJlZShlcnIpOworICAgICAgICBlcnJvcl9mcmVl
X2VycnAoZXJycCk7CiAKICAgICAgICAgLyogT25seSB1c2VkIGZvciBtaWdyYXRpb24uICAqLwog
ICAgICAgICBzLT5tc2lfaW5fdXNlID0gKHJldCA9PSAwKTsKZGlmZiAtLWdpdCBhL2h3L3Njc2kv
c2NzaS1idXMuYyBiL2h3L3Njc2kvc2NzaS1idXMuYwppbmRleCBiY2NiN2NjNGM2Li5jMjM4ZThl
YTJkIDEwMDY0NAotLS0gYS9ody9zY3NpL3Njc2ktYnVzLmMKKysrIGIvaHcvc2NzaS9zY3NpLWJ1
cy5jCkBAIC0xNTcsNyArMTU3LDYgQEAgc3RhdGljIHZvaWQgc2NzaV9xZGV2X3JlYWxpemUoRGV2
aWNlU3RhdGUgKnFkZXYsIEVycm9yICoqZXJycCkKICAgICBTQ1NJRGV2aWNlICpkZXYgPSBTQ1NJ
X0RFVklDRShxZGV2KTsKICAgICBTQ1NJQnVzICpidXMgPSBET19VUENBU1QoU0NTSUJ1cywgcWJ1
cywgZGV2LT5xZGV2LnBhcmVudF9idXMpOwogICAgIFNDU0lEZXZpY2UgKmQ7Ci0gICAgRXJyb3Ig
KmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICBpZiAoZGV2LT5jaGFubmVsID4gYnVzLT5pbmZvLT5t
YXhfY2hhbm5lbCkgewogICAgICAgICBlcnJvcl9zZXRnKGVycnAsICJiYWQgc2NzaSBjaGFubmVs
IGlkOiAlZCIsIGRldi0+Y2hhbm5lbCk7CkBAIC0yMDUsOSArMjA0LDggQEAgc3RhdGljIHZvaWQg
c2NzaV9xZGV2X3JlYWxpemUoRGV2aWNlU3RhdGUgKnFkZXYsIEVycm9yICoqZXJycCkKICAgICB9
CiAKICAgICBRVEFJTFFfSU5JVCgmZGV2LT5yZXF1ZXN0cyk7Ci0gICAgc2NzaV9kZXZpY2VfcmVh
bGl6ZShkZXYsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJy
b3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgc2NzaV9kZXZpY2VfcmVhbGl6ZShk
ZXYsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogICAg
IGRldi0+dm1zZW50cnkgPSBxZGV2X2FkZF92bV9jaGFuZ2Vfc3RhdGVfaGFuZGxlcihERVZJQ0Uo
ZGV2KSwKQEAgLTIzNyw3ICsyMzUsNiBAQCBTQ1NJRGV2aWNlICpzY3NpX2J1c19sZWdhY3lfYWRk
X2RyaXZlKFNDU0lCdXMgKmJ1cywgQmxvY2tCYWNrZW5kICpibGssCiAgICAgY29uc3QgY2hhciAq
ZHJpdmVyOwogICAgIGNoYXIgKm5hbWU7CiAgICAgRGV2aWNlU3RhdGUgKmRldjsKLSAgICBFcnJv
ciAqZXJyID0gTlVMTDsKIAogICAgIGRyaXZlciA9IGJsa19pc19zZyhibGspID8gInNjc2ktZ2Vu
ZXJpYyIgOiAic2NzaS1kaXNrIjsKICAgICBkZXYgPSBxZGV2X2NyZWF0ZSgmYnVzLT5xYnVzLCBk
cml2ZXIpOwpAQCAtMjU2LDE1ICsyNTMsMTMgQEAgU0NTSURldmljZSAqc2NzaV9idXNfbGVnYWN5
X2FkZF9kcml2ZShTQ1NJQnVzICpidXMsIEJsb2NrQmFja2VuZCAqYmxrLAogICAgIGlmIChzZXJp
YWwgJiYgb2JqZWN0X3Byb3BlcnR5X2ZpbmQoT0JKRUNUKGRldiksICJzZXJpYWwiLCBOVUxMKSkg
ewogICAgICAgICBxZGV2X3Byb3Bfc2V0X3N0cmluZyhkZXYsICJzZXJpYWwiLCBzZXJpYWwpOwog
ICAgIH0KLSAgICBxZGV2X3Byb3Bfc2V0X2RyaXZlKGRldiwgImRyaXZlIiwgYmxrLCAmZXJyKTsK
LSAgICBpZiAoZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAg
IHFkZXZfcHJvcF9zZXRfZHJpdmUoZGV2LCAiZHJpdmUiLCBibGssIGVycnApOworICAgIGlmICgq
ZXJycCkgewogICAgICAgICBvYmplY3RfdW5wYXJlbnQoT0JKRUNUKGRldikpOwogICAgICAgICBy
ZXR1cm4gTlVMTDsKICAgICB9Ci0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVChk
ZXYpLCBzaGFyZV9ydywgInNoYXJlLXJ3IiwgJmVycik7Ci0gICAgaWYgKGVyciAhPSBOVUxMKSB7
Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgIG9iamVjdF9wcm9wZXJ0
eV9zZXRfYm9vbChPQkpFQ1QoZGV2KSwgc2hhcmVfcncsICJzaGFyZS1ydyIsIGVycnApOworICAg
IGlmICgqZXJycCAhPSBOVUxMKSB7CiAgICAgICAgIG9iamVjdF91bnBhcmVudChPQkpFQ1QoZGV2
KSk7CiAgICAgICAgIHJldHVybiBOVUxMOwogICAgIH0KQEAgLTI3Miw5ICsyNjcsOCBAQCBTQ1NJ
RGV2aWNlICpzY3NpX2J1c19sZWdhY3lfYWRkX2RyaXZlKFNDU0lCdXMgKmJ1cywgQmxvY2tCYWNr
ZW5kICpibGssCiAgICAgcWRldl9wcm9wX3NldF9lbnVtKGRldiwgInJlcnJvciIsIHJlcnJvcik7
CiAgICAgcWRldl9wcm9wX3NldF9lbnVtKGRldiwgIndlcnJvciIsIHdlcnJvcik7CiAKLSAgICBv
YmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKGRldiksIHRydWUsICJyZWFsaXplZCIsICZl
cnIpOwotICAgIGlmIChlcnIgIT0gTlVMTCkgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJy
cCwgZXJyKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKGRldiksIHRydWUs
ICJyZWFsaXplZCIsIGVycnApOworICAgIGlmICgqZXJycCAhPSBOVUxMKSB7CiAgICAgICAgIG9i
amVjdF91bnBhcmVudChPQkpFQ1QoZGV2KSk7CiAgICAgICAgIHJldHVybiBOVUxMOwogICAgIH0K
ZGlmZiAtLWdpdCBhL2h3L3Njc2kvc2NzaS1kaXNrLmMgYi9ody9zY3NpL3Njc2ktZGlzay5jCmlu
ZGV4IDkxNTY0MWEwZjEuLmJjNjMwNmQzOGUgMTAwNjQ0Ci0tLSBhL2h3L3Njc2kvc2NzaS1kaXNr
LmMKKysrIGIvaHcvc2NzaS9zY3NpLWRpc2suYwpAQCAtMjQ1NiwxMiArMjQ1NiwxMCBAQCBzdGF0
aWMgdm9pZCBzY3NpX2NkX3JlYWxpemUoU0NTSURldmljZSAqZGV2LCBFcnJvciAqKmVycnApCiBz
dGF0aWMgdm9pZCBzY3NpX2Rpc2tfcmVhbGl6ZShTQ1NJRGV2aWNlICpkZXYsIEVycm9yICoqZXJy
cCkKIHsKICAgICBEcml2ZUluZm8gKmRpbmZvOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxM
OwogCiAgICAgaWYgKCFkZXYtPmNvbmYuYmxrKSB7Ci0gICAgICAgIHNjc2lfcmVhbGl6ZShkZXYs
ICZsb2NhbF9lcnIpOwotICAgICAgICBhc3NlcnQobG9jYWxfZXJyKTsKLSAgICAgICAgZXJyb3Jf
cHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgIHNjc2lfcmVhbGl6ZShkZXYsIGVy
cnApOworICAgICAgICBhc3NlcnQoKmVycnApOwogICAgICAgICByZXR1cm47CiAgICAgfQogCmRp
ZmYgLS1naXQgYS9ody9zY3NpL3Zob3N0LXNjc2kuYyBiL2h3L3Njc2kvdmhvc3Qtc2NzaS5jCmlu
ZGV4IGM2OTNmYzc0OGEuLjkxNzgzYTkxZjcgMTAwNjQ0Ci0tLSBhL2h3L3Njc2kvdmhvc3Qtc2Nz
aS5jCisrKyBiL2h3L3Njc2kvdmhvc3Qtc2NzaS5jCkBAIC0xNjcsNyArMTY3LDYgQEAgc3RhdGlj
IHZvaWQgdmhvc3Rfc2NzaV9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkK
IHsKICAgICBWaXJ0SU9TQ1NJQ29tbW9uICp2cyA9IFZJUlRJT19TQ1NJX0NPTU1PTihkZXYpOwog
ICAgIFZIb3N0U0NTSUNvbW1vbiAqdnNjID0gVkhPU1RfU0NTSV9DT01NT04oZGV2KTsKLSAgICBF
cnJvciAqZXJyID0gTlVMTDsKICAgICBpbnQgdmhvc3RmZCA9IC0xOwogICAgIGludCByZXQ7CiAK
QEAgLTE5NSw5ICsxOTQsOCBAQCBzdGF0aWMgdm9pZCB2aG9zdF9zY3NpX3JlYWxpemUoRGV2aWNl
U3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHZob3N0X2R1bW15X2hhbmRsZV9vdXRwdXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgdmhvc3RfZHVtbXlfaGFuZGxlX291dHB1dCwKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICB2aG9zdF9kdW1teV9oYW5kbGVfb3V0cHV0LAotICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICZlcnIpOwotICAgIGlmIChlcnIgIT0gTlVMTCkgewotICAgICAgICBlcnJvcl9wcm9w
YWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJwKTsK
KyAgICBpZiAoKmVycnAgIT0gTlVMTCkgewogICAgICAgICBnb3RvIGNsb3NlX2ZkOwogICAgIH0K
IApAQCAtMjA3LDkgKzIwNSw4IEBAIHN0YXRpYyB2b2lkIHZob3N0X3Njc2lfcmVhbGl6ZShEZXZp
Y2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgICAgICAgICAgICAgIldoZW4gZXh0ZXJu
YWwgZW52aXJvbm1lbnQgc3VwcG9ydHMgaXQgKE9yY2hlc3RyYXRvciBtaWdyYXRlcyAiCiAgICAg
ICAgICAgICAgICAgInRhcmdldCBTQ1NJIGRldmljZSBzdGF0ZSBvciB1c2Ugc2hhcmVkIHN0b3Jh
Z2Ugb3ZlciBuZXR3b3JrKSwgIgogICAgICAgICAgICAgICAgICJzZXQgJ21pZ3JhdGFibGUnIHBy
b3BlcnR5IHRvIHRydWUgdG8gZW5hYmxlIG1pZ3JhdGlvbi4iKTsKLSAgICAgICAgbWlncmF0ZV9h
ZGRfYmxvY2tlcih2c2MtPm1pZ3JhdGlvbl9ibG9ja2VyLCAmZXJyKTsKLSAgICAgICAgaWYgKGVy
cikgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgICAgIG1p
Z3JhdGVfYWRkX2Jsb2NrZXIodnNjLT5taWdyYXRpb25fYmxvY2tlciwgZXJycCk7CisgICAgICAg
IGlmICgqZXJycCkgewogICAgICAgICAgICAgZXJyb3JfZnJlZSh2c2MtPm1pZ3JhdGlvbl9ibG9j
a2VyKTsKICAgICAgICAgICAgIGdvdG8gZnJlZV92aXJ0aW87CiAgICAgICAgIH0KZGlmZiAtLWdp
dCBhL2h3L3Njc2kvdmhvc3QtdXNlci1zY3NpLmMgYi9ody9zY3NpL3Zob3N0LXVzZXItc2NzaS5j
CmluZGV4IDZhNmMxNWRkMzIuLmMyMTFkYzU5OTggMTAwNjQ0Ci0tLSBhL2h3L3Njc2kvdmhvc3Qt
dXNlci1zY3NpLmMKKysrIGIvaHcvc2NzaS92aG9zdC11c2VyLXNjc2kuYwpAQCAtNzIsNyArNzIs
NiBAQCBzdGF0aWMgdm9pZCB2aG9zdF91c2VyX3Njc2lfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2
LCBFcnJvciAqKmVycnApCiAgICAgVkhvc3RVc2VyU0NTSSAqcyA9IFZIT1NUX1VTRVJfU0NTSShk
ZXYpOwogICAgIFZIb3N0U0NTSUNvbW1vbiAqdnNjID0gVkhPU1RfU0NTSV9DT01NT04ocyk7CiAg
ICAgc3RydWN0IHZob3N0X3ZpcnRxdWV1ZSAqdnFzID0gTlVMTDsKLSAgICBFcnJvciAqZXJyID0g
TlVMTDsKICAgICBpbnQgcmV0OwogCiAgICAgaWYgKCF2cy0+Y29uZi5jaGFyZGV2LmNocikgewpA
QCAtODIsOSArODEsOCBAQCBzdGF0aWMgdm9pZCB2aG9zdF91c2VyX3Njc2lfcmVhbGl6ZShEZXZp
Y2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAKICAgICB2aXJ0aW9fc2NzaV9jb21tb25fcmVh
bGl6ZShkZXYsIHZob3N0X2R1bW15X2hhbmRsZV9vdXRwdXQsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgdmhvc3RfZHVtbXlfaGFuZGxlX291dHB1dCwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICB2aG9zdF9kdW1teV9oYW5kbGVfb3V0cHV0LCAmZXJyKTsKLSAgICBpZiAo
ZXJyICE9IE5VTEwpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgdmhvc3RfZHVtbXlfaGFuZGxlX291dHB1dCwgZXJy
cCk7CisgICAgaWYgKCplcnJwICE9IE5VTEwpIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApk
aWZmIC0tZ2l0IGEvaHcvc2NzaS92aXJ0aW8tc2NzaS5jIGIvaHcvc2NzaS92aXJ0aW8tc2NzaS5j
CmluZGV4IGVlNTJhYTdkMTcuLmFhYjBiMzE4ZTcgMTAwNjQ0Ci0tLSBhL2h3L3Njc2kvdmlydGlv
LXNjc2kuYworKysgYi9ody9zY3NpL3ZpcnRpby1zY3NpLmMKQEAgLTkwNywxNSArOTA3LDEzIEBA
IHN0YXRpYyB2b2lkIHZpcnRpb19zY3NpX2RldmljZV9yZWFsaXplKERldmljZVN0YXRlICpkZXYs
IEVycm9yICoqZXJycCkKIHsKICAgICBWaXJ0SU9EZXZpY2UgKnZkZXYgPSBWSVJUSU9fREVWSUNF
KGRldik7CiAgICAgVmlydElPU0NTSSAqcyA9IFZJUlRJT19TQ1NJKGRldik7Ci0gICAgRXJyb3Ig
KmVyciA9IE5VTEw7CiAKICAgICB2aXJ0aW9fc2NzaV9jb21tb25fcmVhbGl6ZShkZXYsCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlydGlvX3Njc2lfaGFuZGxlX2N0cmwsCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlydGlvX3Njc2lfaGFuZGxlX2V2ZW50LAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpcnRpb19zY3NpX2hhbmRsZV9jbWQsCi0gICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgJmVycik7Ci0gICAgaWYgKGVyciAhPSBOVUxMKSB7
Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIGVycnApOworICAgIGlmICgqZXJycCAhPSBOVUxMKSB7CiAgICAgICAgIHJl
dHVybjsKICAgICB9CiAKZGlmZiAtLWdpdCBhL2h3L3NkL21pbGt5bWlzdC1tZW1jYXJkLmMgYi9o
dy9zZC9taWxreW1pc3QtbWVtY2FyZC5jCmluZGV4IDkyNmUxYWY0NzUuLjhhYzJjODQ1MTUgMTAw
NjQ0Ci0tLSBhL2h3L3NkL21pbGt5bWlzdC1tZW1jYXJkLmMKKysrIGIvaHcvc2QvbWlsa3ltaXN0
LW1lbWNhcmQuYwpAQCAtMjY5LDcgKzI2OSw2IEBAIHN0YXRpYyB2b2lkIG1pbGt5bWlzdF9tZW1j
YXJkX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogICAgIERldmljZVN0
YXRlICpjYXJkZGV2OwogICAgIEJsb2NrQmFja2VuZCAqYmxrOwogICAgIERyaXZlSW5mbyAqZGlu
Zm87Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7CiAKICAgICBxYnVzX2NyZWF0ZV9pbnBsYWNlKCZz
LT5zZGJ1cywgc2l6ZW9mKHMtPnNkYnVzKSwgVFlQRV9TRF9CVVMsCiAgICAgICAgICAgICAgICAg
ICAgICAgICBkZXYsICJzZC1idXMiKTsKQEAgLTI3OSwxMCArMjc4LDExIEBAIHN0YXRpYyB2b2lk
IG1pbGt5bWlzdF9tZW1jYXJkX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJw
KQogICAgIGRpbmZvID0gZHJpdmVfZ2V0X25leHQoSUZfU0QpOwogICAgIGJsayA9IGRpbmZvID8g
YmxrX2J5X2xlZ2FjeV9kaW5mbyhkaW5mbykgOiBOVUxMOwogICAgIGNhcmRkZXYgPSBxZGV2X2Ny
ZWF0ZShCVVMoJnMtPnNkYnVzKSwgVFlQRV9TRF9DQVJEKTsKLSAgICBxZGV2X3Byb3Bfc2V0X2Ry
aXZlKGNhcmRkZXYsICJkcml2ZSIsIGJsaywgJmVycik7Ci0gICAgb2JqZWN0X3Byb3BlcnR5X3Nl
dF9ib29sKE9CSkVDVChjYXJkZGV2KSwgdHJ1ZSwgInJlYWxpemVkIiwgJmVycik7Ci0gICAgaWYg
KGVycikgewotICAgICAgICBlcnJvcl9zZXRnKGVycnAsICJmYWlsZWQgdG8gaW5pdCBTRCBjYXJk
OiAlcyIsIGVycm9yX2dldF9wcmV0dHkoZXJyKSk7CisgICAgcWRldl9wcm9wX3NldF9kcml2ZShj
YXJkZGV2LCAiZHJpdmUiLCBibGssIGVycnApOworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9v
bChPQkpFQ1QoY2FyZGRldiksIHRydWUsICJyZWFsaXplZCIsIGVycnApOworICAgIGlmICgqZXJy
cCkgeworICAgICAgICBlcnJvcl9zZXRnKGVycnAsICJmYWlsZWQgdG8gaW5pdCBTRCBjYXJkOiAl
cyIsCisgICAgICAgICAgICAgICAgICAgZXJyb3JfZ2V0X3ByZXR0eSgqZXJycCkpOwogICAgICAg
ICByZXR1cm47CiAgICAgfQogICAgIHMtPmVuYWJsZWQgPSBibGsgJiYgYmxrX2lzX2luc2VydGVk
KGJsayk7CmRpZmYgLS1naXQgYS9ody9zZC9zZGhjaS1wY2kuYyBiL2h3L3NkL3NkaGNpLXBjaS5j
CmluZGV4IDJjOGQ4ZjU5YjUuLjI3NDcwYTFhOGYgMTAwNjQ0Ci0tLSBhL2h3L3NkL3NkaGNpLXBj
aS5jCisrKyBiL2h3L3NkL3NkaGNpLXBjaS5jCkBAIC0zMCwxMiArMzAsMTAgQEAgc3RhdGljIFBy
b3BlcnR5IHNkaGNpX3BjaV9wcm9wZXJ0aWVzW10gPSB7CiBzdGF0aWMgdm9pZCBzZGhjaV9wY2lf
cmVhbGl6ZShQQ0lEZXZpY2UgKmRldiwgRXJyb3IgKiplcnJwKQogewogICAgIFNESENJU3RhdGUg
KnMgPSBQQ0lfU0RIQ0koZGV2KTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAogICAg
IHNkaGNpX2luaXRmbihzKTsKLSAgICBzZGhjaV9jb21tb25fcmVhbGl6ZShzLCAmbG9jYWxfZXJy
KTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBs
b2NhbF9lcnIpOworICAgIHNkaGNpX2NvbW1vbl9yZWFsaXplKHMsIGVycnApOworICAgIGlmICgq
ZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCmRpZmYgLS1naXQgYS9ody9zZC9zZGhj
aS5jIGIvaHcvc2Qvc2RoY2kuYwppbmRleCBlMDhlYzNlMzk4Li5mOTVhNDk2MTlkIDEwMDY0NAot
LS0gYS9ody9zZC9zZGhjaS5jCisrKyBiL2h3L3NkL3NkaGNpLmMKQEAgLTEyOTMsOCArMTI5Myw2
IEBAIHN0YXRpYyBjb25zdCBNZW1vcnlSZWdpb25PcHMgc2RoY2lfbW1pb19vcHMgPSB7CiAKIHN0
YXRpYyB2b2lkIHNkaGNpX2luaXRfcmVhZG9ubHlfcmVnaXN0ZXJzKFNESENJU3RhdGUgKnMsIEVy
cm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKLQogICAgIHN3aXRj
aCAocy0+c2Rfc3BlY192ZXJzaW9uKSB7CiAgICAgY2FzZSAyIC4uLiAzOgogICAgICAgICBicmVh
azsKQEAgLTEzMDQsOSArMTMwMiw4IEBAIHN0YXRpYyB2b2lkIHNkaGNpX2luaXRfcmVhZG9ubHlf
cmVnaXN0ZXJzKFNESENJU3RhdGUgKnMsIEVycm9yICoqZXJycCkKICAgICB9CiAgICAgcy0+dmVy
c2lvbiA9IChTREhDX0hDVkVSX1ZFTkRPUiA8PCA4KSB8IChzLT5zZF9zcGVjX3ZlcnNpb24gLSAx
KTsKIAotICAgIHNkaGNpX2NoZWNrX2NhcGFyZWcocywgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxv
Y2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAg
ICBzZGhjaV9jaGVja19jYXBhcmVnKHMsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAg
ICByZXR1cm47CiAgICAgfQogfQpAQCAtMTMzNywxMSArMTMzNCw4IEBAIHZvaWQgc2RoY2lfdW5p
bml0Zm4oU0RIQ0lTdGF0ZSAqcykKIAogdm9pZCBzZGhjaV9jb21tb25fcmVhbGl6ZShTREhDSVN0
YXRlICpzLCBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7Ci0K
LSAgICBzZGhjaV9pbml0X3JlYWRvbmx5X3JlZ2lzdGVycyhzLCAmbG9jYWxfZXJyKTsKLSAgICBp
ZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIp
OworICAgIHNkaGNpX2luaXRfcmVhZG9ubHlfcmVnaXN0ZXJzKHMsIGVycnApOworICAgIGlmICgq
ZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogICAgIHMtPmJ1Zl9tYXhzeiA9IHNkaGNp
X2dldF9maWZvbGVuKHMpOwpAQCAtMTQ2MywxMSArMTQ1Nyw5IEBAIHN0YXRpYyB2b2lkIHNkaGNp
X3N5c2J1c19yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqIGVycnApCiB7CiAgICAg
U0RIQ0lTdGF0ZSAqcyA9IFNZU0JVU19TREhDSShkZXYpOwogICAgIFN5c0J1c0RldmljZSAqc2Jk
ID0gU1lTX0JVU19ERVZJQ0UoZGV2KTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAot
ICAgIHNkaGNpX2NvbW1vbl9yZWFsaXplKHMsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9l
cnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgc2Ro
Y2lfY29tbW9uX3JlYWxpemUocywgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJl
dHVybjsKICAgICB9CiAKZGlmZiAtLWdpdCBhL2h3L3NkL3NzaS1zZC5jIGIvaHcvc2Qvc3NpLXNk
LmMKaW5kZXggOTFkYjA2OTIxMi4uMTgxMGQ4OWYzMSAxMDA2NDQKLS0tIGEvaHcvc2Qvc3NpLXNk
LmMKKysrIGIvaHcvc2Qvc3NpLXNkLmMKQEAgLTI0NCw3ICsyNDQsNiBAQCBzdGF0aWMgdm9pZCBz
c2lfc2RfcmVhbGl6ZShTU0lTbGF2ZSAqZCwgRXJyb3IgKiplcnJwKQogICAgIHNzaV9zZF9zdGF0
ZSAqcyA9IEZST01fU1NJX1NMQVZFKHNzaV9zZF9zdGF0ZSwgZCk7CiAgICAgRGV2aWNlU3RhdGUg
KmNhcmRkZXY7CiAgICAgRHJpdmVJbmZvICpkaW5mbzsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsK
IAogICAgIHFidXNfY3JlYXRlX2lucGxhY2UoJnMtPnNkYnVzLCBzaXplb2Yocy0+c2RidXMpLCBU
WVBFX1NEX0JVUywKICAgICAgICAgICAgICAgICAgICAgICAgIERFVklDRShkKSwgInNkLWJ1cyIp
OwpAQCAtMjU0LDEyICsyNTMsMTQgQEAgc3RhdGljIHZvaWQgc3NpX3NkX3JlYWxpemUoU1NJU2xh
dmUgKmQsIEVycm9yICoqZXJycCkKICAgICBkaW5mbyA9IGRyaXZlX2dldF9uZXh0KElGX1NEKTsK
ICAgICBjYXJkZGV2ID0gcWRldl9jcmVhdGUoQlVTKCZzLT5zZGJ1cyksIFRZUEVfU0RfQ0FSRCk7
CiAgICAgaWYgKGRpbmZvKSB7Ci0gICAgICAgIHFkZXZfcHJvcF9zZXRfZHJpdmUoY2FyZGRldiwg
ImRyaXZlIiwgYmxrX2J5X2xlZ2FjeV9kaW5mbyhkaW5mbyksICZlcnIpOworICAgICAgICBxZGV2
X3Byb3Bfc2V0X2RyaXZlKGNhcmRkZXYsICJkcml2ZSIsIGJsa19ieV9sZWdhY3lfZGluZm8oZGlu
Zm8pLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycnApOwogICAgIH0KLSAgICBvYmpl
Y3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKGNhcmRkZXYpLCB0cnVlLCAic3BpIiwgJmVycik7
Ci0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVChjYXJkZGV2KSwgdHJ1ZSwgInJl
YWxpemVkIiwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBlcnJvcl9zZXRnKGVycnAs
ICJmYWlsZWQgdG8gaW5pdCBTRCBjYXJkOiAlcyIsIGVycm9yX2dldF9wcmV0dHkoZXJyKSk7Cisg
ICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVChjYXJkZGV2KSwgdHJ1ZSwgInNwaSIs
IGVycnApOworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoY2FyZGRldiksIHRy
dWUsICJyZWFsaXplZCIsIGVycnApOworICAgIGlmICgqZXJycCkgeworICAgICAgICBlcnJvcl9z
ZXRnKGVycnAsICJmYWlsZWQgdG8gaW5pdCBTRCBjYXJkOiAlcyIsCisgICAgICAgICAgICAgICAg
ICAgZXJyb3JfZ2V0X3ByZXR0eSgqZXJycCkpOwogICAgICAgICByZXR1cm47CiAgICAgfQogfQpk
aWZmIC0tZ2l0IGEvaHcvc21iaW9zL3NtYmlvcy5jIGIvaHcvc21iaW9zL3NtYmlvcy5jCmluZGV4
IDExZDQ3NmM0YTIuLjUwMzc1NjM5ZGMgMTAwNjQ0Ci0tLSBhL2h3L3NtYmlvcy9zbWJpb3MuYwor
KysgYi9ody9zbWJpb3Mvc21iaW9zLmMKQEAgLTk1NCw3ICs5NTQsNiBAQCBzdGF0aWMgdm9pZCBz
YXZlX29wdF9saXN0KHNpemVfdCAqbmRlc3QsIGNvbnN0IGNoYXIgKioqZGVzdCwKIAogdm9pZCBz
bWJpb3NfZW50cnlfYWRkKFFlbXVPcHRzICpvcHRzLCBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJy
b3IgKmVyciA9IE5VTEw7CiAgICAgY29uc3QgY2hhciAqdmFsOwogCiAgICAgYXNzZXJ0KCFzbWJp
b3NfaW1tdXRhYmxlKTsKQEAgLTk2NSw5ICs5NjQsOCBAQCB2b2lkIHNtYmlvc19lbnRyeV9hZGQo
UWVtdU9wdHMgKm9wdHMsIEVycm9yICoqZXJycCkKICAgICAgICAgaW50IHNpemU7CiAgICAgICAg
IHN0cnVjdCBzbWJpb3NfdGFibGUgKnRhYmxlOyAvKiBsZWdhY3kgbW9kZSBvbmx5ICovCiAKLSAg
ICAgICAgcWVtdV9vcHRzX3ZhbGlkYXRlKG9wdHMsIHFlbXVfc21iaW9zX2ZpbGVfb3B0cywgJmVy
cik7Ci0gICAgICAgIGlmIChlcnIpIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJw
LCBlcnIpOworICAgICAgICBxZW11X29wdHNfdmFsaWRhdGUob3B0cywgcWVtdV9zbWJpb3NfZmls
ZV9vcHRzLCBlcnJwKTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICByZXR1cm47
CiAgICAgICAgIH0KIApAQCAtMTA1Miw5ICsxMDUwLDggQEAgdm9pZCBzbWJpb3NfZW50cnlfYWRk
KFFlbXVPcHRzICpvcHRzLCBFcnJvciAqKmVycnApCiAKICAgICAgICAgc3dpdGNoICh0eXBlKSB7
CiAgICAgICAgIGNhc2UgMDoKLSAgICAgICAgICAgIHFlbXVfb3B0c192YWxpZGF0ZShvcHRzLCBx
ZW11X3NtYmlvc190eXBlMF9vcHRzLCAmZXJyKTsKLSAgICAgICAgICAgIGlmIChlcnIpIHsKLSAg
ICAgICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgICAgIHFl
bXVfb3B0c192YWxpZGF0ZShvcHRzLCBxZW11X3NtYmlvc190eXBlMF9vcHRzLCBlcnJwKTsKKyAg
ICAgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAg
ICAgIH0KICAgICAgICAgICAgIHNhdmVfb3B0KCZ0eXBlMC52ZW5kb3IsIG9wdHMsICJ2ZW5kb3Ii
KTsKQEAgLTEwNzIsOSArMTA2OSw4IEBAIHZvaWQgc21iaW9zX2VudHJ5X2FkZChRZW11T3B0cyAq
b3B0cywgRXJyb3IgKiplcnJwKQogICAgICAgICAgICAgfQogICAgICAgICAgICAgcmV0dXJuOwog
ICAgICAgICBjYXNlIDE6Ci0gICAgICAgICAgICBxZW11X29wdHNfdmFsaWRhdGUob3B0cywgcWVt
dV9zbWJpb3NfdHlwZTFfb3B0cywgJmVycik7Ci0gICAgICAgICAgICBpZiAoZXJyKSB7Ci0gICAg
ICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgICAgICAgICBxZW11
X29wdHNfdmFsaWRhdGUob3B0cywgcWVtdV9zbWJpb3NfdHlwZTFfb3B0cywgZXJycCk7CisgICAg
ICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAg
ICB9CiAgICAgICAgICAgICBzYXZlX29wdCgmdHlwZTEubWFudWZhY3R1cmVyLCBvcHRzLCAibWFu
dWZhY3R1cmVyIik7CkBAIC0xMDk0LDkgKzEwOTAsOCBAQCB2b2lkIHNtYmlvc19lbnRyeV9hZGQo
UWVtdU9wdHMgKm9wdHMsIEVycm9yICoqZXJycCkKICAgICAgICAgICAgIH0KICAgICAgICAgICAg
IHJldHVybjsKICAgICAgICAgY2FzZSAyOgotICAgICAgICAgICAgcWVtdV9vcHRzX3ZhbGlkYXRl
KG9wdHMsIHFlbXVfc21iaW9zX3R5cGUyX29wdHMsICZlcnIpOwotICAgICAgICAgICAgaWYgKGVy
cikgewotICAgICAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgICAg
ICAgICAgcWVtdV9vcHRzX3ZhbGlkYXRlKG9wdHMsIHFlbXVfc21iaW9zX3R5cGUyX29wdHMsIGVy
cnApOworICAgICAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICAgICAgcmV0dXJuOwog
ICAgICAgICAgICAgfQogICAgICAgICAgICAgc2F2ZV9vcHQoJnR5cGUyLm1hbnVmYWN0dXJlciwg
b3B0cywgIm1hbnVmYWN0dXJlciIpOwpAQCAtMTEwNyw5ICsxMTAyLDggQEAgdm9pZCBzbWJpb3Nf
ZW50cnlfYWRkKFFlbXVPcHRzICpvcHRzLCBFcnJvciAqKmVycnApCiAgICAgICAgICAgICBzYXZl
X29wdCgmdHlwZTIubG9jYXRpb24sIG9wdHMsICJsb2NhdGlvbiIpOwogICAgICAgICAgICAgcmV0
dXJuOwogICAgICAgICBjYXNlIDM6Ci0gICAgICAgICAgICBxZW11X29wdHNfdmFsaWRhdGUob3B0
cywgcWVtdV9zbWJpb3NfdHlwZTNfb3B0cywgJmVycik7Ci0gICAgICAgICAgICBpZiAoZXJyKSB7
Ci0gICAgICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgICAgICAg
ICBxZW11X29wdHNfdmFsaWRhdGUob3B0cywgcWVtdV9zbWJpb3NfdHlwZTNfb3B0cywgZXJycCk7
CisgICAgICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAg
ICAgICAgICB9CiAgICAgICAgICAgICBzYXZlX29wdCgmdHlwZTMubWFudWZhY3R1cmVyLCBvcHRz
LCAibWFudWZhY3R1cmVyIik7CkBAIC0xMTE5LDkgKzExMTMsOCBAQCB2b2lkIHNtYmlvc19lbnRy
eV9hZGQoUWVtdU9wdHMgKm9wdHMsIEVycm9yICoqZXJycCkKICAgICAgICAgICAgIHNhdmVfb3B0
KCZ0eXBlMy5za3UsIG9wdHMsICJza3UiKTsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAg
Y2FzZSA0OgotICAgICAgICAgICAgcWVtdV9vcHRzX3ZhbGlkYXRlKG9wdHMsIHFlbXVfc21iaW9z
X3R5cGU0X29wdHMsICZlcnIpOwotICAgICAgICAgICAgaWYgKGVycikgewotICAgICAgICAgICAg
ICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgICAgICAgICAgcWVtdV9vcHRzX3Zh
bGlkYXRlKG9wdHMsIHFlbXVfc21iaW9zX3R5cGU0X29wdHMsIGVycnApOworICAgICAgICAgICAg
aWYgKCplcnJwKSB7CiAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgfQogICAg
ICAgICAgICAgc2F2ZV9vcHQoJnR5cGU0LnNvY2tfcGZ4LCBvcHRzLCAic29ja19wZngiKTsKQEAg
LTExMzIsMTcgKzExMjUsMTUgQEAgdm9pZCBzbWJpb3NfZW50cnlfYWRkKFFlbXVPcHRzICpvcHRz
LCBFcnJvciAqKmVycnApCiAgICAgICAgICAgICBzYXZlX29wdCgmdHlwZTQucGFydCwgb3B0cywg
InBhcnQiKTsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgY2FzZSAxMToKLSAgICAgICAg
ICAgIHFlbXVfb3B0c192YWxpZGF0ZShvcHRzLCBxZW11X3NtYmlvc190eXBlMTFfb3B0cywgJmVy
cik7Ci0gICAgICAgICAgICBpZiAoZXJyKSB7Ci0gICAgICAgICAgICAgICAgZXJyb3JfcHJvcGFn
YXRlKGVycnAsIGVycik7CisgICAgICAgICAgICBxZW11X29wdHNfdmFsaWRhdGUob3B0cywgcWVt
dV9zbWJpb3NfdHlwZTExX29wdHMsIGVycnApOworICAgICAgICAgICAgaWYgKCplcnJwKSB7CiAg
ICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgfQogICAgICAgICAgICAgc2F2ZV9v
cHRfbGlzdCgmdHlwZTExLm52YWx1ZXMsICZ0eXBlMTEudmFsdWVzLCBvcHRzLCAidmFsdWUiKTsK
ICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgY2FzZSAxNzoKLSAgICAgICAgICAgIHFlbXVf
b3B0c192YWxpZGF0ZShvcHRzLCBxZW11X3NtYmlvc190eXBlMTdfb3B0cywgJmVycik7Ci0gICAg
ICAgICAgICBpZiAoZXJyKSB7Ci0gICAgICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAs
IGVycik7CisgICAgICAgICAgICBxZW11X29wdHNfdmFsaWRhdGUob3B0cywgcWVtdV9zbWJpb3Nf
dHlwZTE3X29wdHMsIGVycnApOworICAgICAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAg
ICAgICAgcmV0dXJuOwogICAgICAgICAgICAgfQogICAgICAgICAgICAgc2F2ZV9vcHQoJnR5cGUx
Ny5sb2NfcGZ4LCBvcHRzLCAibG9jX3BmeCIpOwpkaWZmIC0tZ2l0IGEvaHcvc3BhcmMvc3VuNG0u
YyBiL2h3L3NwYXJjL3N1bjRtLmMKaW5kZXggNmM1YTE3YTAyMC4uODA2MjM4Nzk4YiAxMDA2NDQK
LS0tIGEvaHcvc3BhcmMvc3VuNG0uYworKysgYi9ody9zcGFyYy9zdW40bS5jCkBAIC02MDMsMTIg
KzYwMywxMCBAQCBzdGF0aWMgdm9pZCBpZHJlZ19yZWFsaXplKERldmljZVN0YXRlICpkcywgRXJy
b3IgKiplcnJwKQogewogICAgIElEUmVnU3RhdGUgKnMgPSBNQUNJT19JRF9SRUdJU1RFUihkcyk7
CiAgICAgU3lzQnVzRGV2aWNlICpkZXYgPSBTWVNfQlVTX0RFVklDRShkcyk7Ci0gICAgRXJyb3Ig
KmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICBtZW1vcnlfcmVnaW9uX2luaXRfcmFtX25vbWlncmF0
ZSgmcy0+bWVtLCBPQkpFQ1QoZHMpLCAic3VuNG0uaWRyZWciLAotICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHNpemVvZihpZHJlZ19kYXRhKSwgJmxvY2FsX2Vycik7Ci0gICAg
aWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJy
KTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplb2YoaWRyZWdfZGF0
YSksIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCkBA
IC02NTcsMTIgKzY1NSwxMCBAQCBzdGF0aWMgdm9pZCBhZnhfcmVhbGl6ZShEZXZpY2VTdGF0ZSAq
ZHMsIEVycm9yICoqZXJycCkKIHsKICAgICBBRlhTdGF0ZSAqcyA9IFRDWF9BRlgoZHMpOwogICAg
IFN5c0J1c0RldmljZSAqZGV2ID0gU1lTX0JVU19ERVZJQ0UoZHMpOwotICAgIEVycm9yICpsb2Nh
bF9lcnIgPSBOVUxMOwogCiAgICAgbWVtb3J5X3JlZ2lvbl9pbml0X3JhbV9ub21pZ3JhdGUoJnMt
Pm1lbSwgT0JKRUNUKGRzKSwgInN1bjRtLmFmeCIsIDQsCi0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAg
ICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJu
OwogICAgIH0KIApAQCAtNzM5LDEyICs3MzUsMTAgQEAgc3RhdGljIHZvaWQgcHJvbV9yZWFsaXpl
KERldmljZVN0YXRlICpkcywgRXJyb3IgKiplcnJwKQogewogICAgIFBST01TdGF0ZSAqcyA9IE9Q
RU5QUk9NKGRzKTsKICAgICBTeXNCdXNEZXZpY2UgKmRldiA9IFNZU19CVVNfREVWSUNFKGRzKTsK
LSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAogICAgIG1lbW9yeV9yZWdpb25faW5pdF9y
YW1fbm9taWdyYXRlKCZzLT5wcm9tLCBPQkpFQ1QoZHMpLCAic3VuNG0ucHJvbSIsCi0gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUFJPTV9TSVpFX01BWCwgJmxvY2FsX2Vycik7
Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9j
YWxfZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQUk9NX1NJWkVf
TUFYLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApk
aWZmIC0tZ2l0IGEvaHcvc3BhcmM2NC9zdW40dS5jIGIvaHcvc3BhcmM2NC9zdW40dS5jCmluZGV4
IDFkZWQyYTRjOWEuLjlmMTA0M2Y1OGUgMTAwNjQ0Ci0tLSBhL2h3L3NwYXJjNjQvc3VuNHUuYwor
KysgYi9ody9zcGFyYzY0L3N1bjR1LmMKQEAgLTQ1NywxMiArNDU3LDEwIEBAIHN0YXRpYyB2b2lk
IHByb21fcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZHMsIEVycm9yICoqZXJycCkKIHsKICAgICBQUk9N
U3RhdGUgKnMgPSBPUEVOUFJPTShkcyk7CiAgICAgU3lzQnVzRGV2aWNlICpkZXYgPSBTWVNfQlVT
X0RFVklDRShkcyk7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICBtZW1vcnlf
cmVnaW9uX2luaXRfcmFtX25vbWlncmF0ZSgmcy0+cHJvbSwgT0JKRUNUKGRzKSwgInN1bjR1LnBy
b20iLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBST01fU0laRV9NQVgs
ICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFn
YXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgUFJPTV9TSVpFX01BWCwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVy
bjsKICAgICB9CiAKZGlmZiAtLWdpdCBhL2h3L3RpbWVyL2FzcGVlZF90aW1lci5jIGIvaHcvdGlt
ZXIvYXNwZWVkX3RpbWVyLmMKaW5kZXggMmJkYTgyNjg4Mi4uMGVmODY2OWFhNiAxMDA2NDQKLS0t
IGEvaHcvdGltZXIvYXNwZWVkX3RpbWVyLmMKKysrIGIvaHcvdGltZXIvYXNwZWVkX3RpbWVyLmMK
QEAgLTQ4NiwxMSArNDg2LDExIEBAIHN0YXRpYyB2b2lkIGFzcGVlZF90aW1lcl9yZWFsaXplKERl
dmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAgICBTeXNCdXNEZXZpY2UgKnNiZCA9IFNZ
U19CVVNfREVWSUNFKGRldik7CiAgICAgQXNwZWVkVGltZXJDdHJsU3RhdGUgKnMgPSBBU1BFRURf
VElNRVIoZGV2KTsKICAgICBPYmplY3QgKm9iajsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKIAot
ICAgIG9iaiA9IG9iamVjdF9wcm9wZXJ0eV9nZXRfbGluayhPQkpFQ1QoZGV2KSwgInNjdSIsICZl
cnIpOworICAgIG9iaiA9IG9iamVjdF9wcm9wZXJ0eV9nZXRfbGluayhPQkpFQ1QoZGV2KSwgInNj
dSIsIGVycnApOwogICAgIGlmICghb2JqKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZV9wcmVw
ZW5kKGVycnAsIGVyciwgInJlcXVpcmVkIGxpbmsgJ3NjdScgbm90IGZvdW5kOiAiKTsKKyAgICAg
ICAgZXJyb3JfcHJvcGFnYXRlX3ByZXBlbmQoZXJycCwgKmVycnAsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICJyZXF1aXJlZCBsaW5rICdzY3UnIG5vdCBmb3VuZDogIik7CiAgICAg
ICAgIHJldHVybjsKICAgICB9CiAgICAgcy0+c2N1ID0gQVNQRUVEX1NDVShvYmopOwpkaWZmIC0t
Z2l0IGEvaHcvdHBtL3RwbV91dGlsLmMgYi9ody90cG0vdHBtX3V0aWwuYwppbmRleCA2MmIwOTFm
MGMwLi40ZTMwMjM1YzVkIDEwMDY0NAotLS0gYS9ody90cG0vdHBtX3V0aWwuYworKysgYi9ody90
cG0vdHBtX3V0aWwuYwpAQCAtNDgsNyArNDgsNiBAQCBzdGF0aWMgdm9pZCBzZXRfdHBtKE9iamVj
dCAqb2JqLCBWaXNpdG9yICp2LCBjb25zdCBjaGFyICpuYW1lLCB2b2lkICpvcGFxdWUsCiAgICAg
ICAgICAgICAgICAgICAgIEVycm9yICoqZXJycCkKIHsKICAgICBEZXZpY2VTdGF0ZSAqZGV2ID0g
REVWSUNFKG9iaik7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgUHJvcGVydHkg
KnByb3AgPSBvcGFxdWU7CiAgICAgVFBNQmFja2VuZCAqcywgKipiZSA9IHFkZXZfZ2V0X3Byb3Bf
cHRyKGRldiwgcHJvcCk7CiAgICAgY2hhciAqc3RyOwpAQCAtNTgsOSArNTcsOCBAQCBzdGF0aWMg
dm9pZCBzZXRfdHBtKE9iamVjdCAqb2JqLCBWaXNpdG9yICp2LCBjb25zdCBjaGFyICpuYW1lLCB2
b2lkICpvcGFxdWUsCiAgICAgICAgIHJldHVybjsKICAgICB9CiAKLSAgICB2aXNpdF90eXBlX3N0
cih2LCBuYW1lLCAmc3RyLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAg
ICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHZpc2l0X3R5cGVfc3Ry
KHYsIG5hbWUsICZzdHIsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47
CiAgICAgfQogCmRpZmYgLS1naXQgYS9ody91c2IvYnVzLmMgYi9ody91c2IvYnVzLmMKaW5kZXgg
YTY1MjJmNTQyOS4uODUxN2Y0OTZmZCAxMDA2NDQKLS0tIGEvaHcvdXNiL2J1cy5jCisrKyBiL2h3
L3VzYi9idXMuYwpAQCAtMjQxLDcgKzI0MSw2IEBAIHZvaWQgdXNiX2RldmljZV9mcmVlX3N0cmVh
bXMoVVNCRGV2aWNlICpkZXYsIFVTQkVuZHBvaW50ICoqZXBzLCBpbnQgbnJfZXBzKQogc3RhdGlj
IHZvaWQgdXNiX3FkZXZfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqcWRldiwgRXJyb3IgKiplcnJwKQog
ewogICAgIFVTQkRldmljZSAqZGV2ID0gVVNCX0RFVklDRShxZGV2KTsKLSAgICBFcnJvciAqbG9j
YWxfZXJyID0gTlVMTDsKIAogICAgIHBzdHJjcHkoZGV2LT5wcm9kdWN0X2Rlc2MsIHNpemVvZihk
ZXYtPnByb2R1Y3RfZGVzYyksCiAgICAgICAgICAgICB1c2JfZGV2aWNlX2dldF9wcm9kdWN0X2Rl
c2MoZGV2KSk7CkBAIC0yNDksMjQgKzI0OCwyMSBAQCBzdGF0aWMgdm9pZCB1c2JfcWRldl9yZWFs
aXplKERldmljZVN0YXRlICpxZGV2LCBFcnJvciAqKmVycnApCiAgICAgUUxJU1RfSU5JVCgmZGV2
LT5zdHJpbmdzKTsKICAgICB1c2JfZXBfaW5pdChkZXYpOwogCi0gICAgdXNiX2NsYWltX3BvcnQo
ZGV2LCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3By
b3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHVzYl9jbGFpbV9wb3J0KGRldiwgZXJycCk7
CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKLSAgICB1c2JfZGV2
aWNlX3JlYWxpemUoZGV2LCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7CisgICAg
dXNiX2RldmljZV9yZWFsaXplKGRldiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAg
IHVzYl9yZWxlYXNlX3BvcnQoZGV2KTsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxv
Y2FsX2Vycik7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKICAgICBpZiAoZGV2LT5hdXRvX2F0
dGFjaCkgewotICAgICAgICB1c2JfZGV2aWNlX2F0dGFjaChkZXYsICZsb2NhbF9lcnIpOwotICAg
ICAgICBpZiAobG9jYWxfZXJyKSB7CisgICAgICAgIHVzYl9kZXZpY2VfYXR0YWNoKGRldiwgZXJy
cCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgdXNiX3FkZXZfdW5yZWFsaXpl
KHFkZXYsIE5VTEwpOwotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vy
cik7CiAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgIH0KICAgICB9CkBAIC0zMjUsNyArMzIx
LDYgQEAgVVNCRGV2aWNlICp1c2JfY3JlYXRlKFVTQkJ1cyAqYnVzLCBjb25zdCBjaGFyICpuYW1l
KQogc3RhdGljIFVTQkRldmljZSAqdXNiX3RyeV9jcmVhdGVfc2ltcGxlKFVTQkJ1cyAqYnVzLCBj
b25zdCBjaGFyICpuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKICAgICBVU0JEZXZpY2Ug
KmRldjsKIAogICAgIGRldiA9IFVTQl9ERVZJQ0UocWRldl90cnlfY3JlYXRlKCZidXMtPnFidXMs
IG5hbWUpKTsKQEAgLTMzMyw5ICszMjgsOSBAQCBzdGF0aWMgVVNCRGV2aWNlICp1c2JfdHJ5X2Ny
ZWF0ZV9zaW1wbGUoVVNCQnVzICpidXMsIGNvbnN0IGNoYXIgKm5hbWUsCiAgICAgICAgIGVycm9y
X3NldGcoZXJycCwgIkZhaWxlZCB0byBjcmVhdGUgVVNCIGRldmljZSAnJXMnIiwgbmFtZSk7CiAg
ICAgICAgIHJldHVybiBOVUxMOwogICAgIH0KLSAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2wo
T0JKRUNUKGRldiksIHRydWUsICJyZWFsaXplZCIsICZlcnIpOwotICAgIGlmIChlcnIpIHsKLSAg
ICAgICAgZXJyb3JfcHJvcGFnYXRlX3ByZXBlbmQoZXJycCwgZXJyLAorICAgIG9iamVjdF9wcm9w
ZXJ0eV9zZXRfYm9vbChPQkpFQ1QoZGV2KSwgdHJ1ZSwgInJlYWxpemVkIiwgZXJycCk7CisgICAg
aWYgKCplcnJwKSB7CisgICAgICAgIGVycm9yX3Byb3BhZ2F0ZV9wcmVwZW5kKGVycnAsICplcnJw
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiRmFpbGVkIHRvIGluaXRpYWxpemUg
VVNCIGRldmljZSAnJXMnOiAiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1l
KTsKICAgICAgICAgcmV0dXJuIE5VTEw7CkBAIC01MzMsMTEgKzUyOCw5IEBAIHZvaWQgdXNiX2No
ZWNrX2F0dGFjaChVU0JEZXZpY2UgKmRldiwgRXJyb3IgKiplcnJwKQogdm9pZCB1c2JfZGV2aWNl
X2F0dGFjaChVU0JEZXZpY2UgKmRldiwgRXJyb3IgKiplcnJwKQogewogICAgIFVTQlBvcnQgKnBv
cnQgPSBkZXYtPnBvcnQ7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKLSAgICB1c2Jf
Y2hlY2tfYXR0YWNoKGRldiwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAg
ICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICB1c2JfY2hlY2tfYXR0
YWNoKGRldiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9
CiAKQEAgLTczMiwxNSArNzI1LDEzIEBAIHN0YXRpYyBib29sIHVzYl9nZXRfYXR0YWNoZWQoT2Jq
ZWN0ICpvYmosIEVycm9yICoqZXJycCkKIHN0YXRpYyB2b2lkIHVzYl9zZXRfYXR0YWNoZWQoT2Jq
ZWN0ICpvYmosIGJvb2wgdmFsdWUsIEVycm9yICoqZXJycCkKIHsKICAgICBVU0JEZXZpY2UgKmRl
diA9IFVTQl9ERVZJQ0Uob2JqKTsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKIAogICAgIGlmIChk
ZXYtPmF0dGFjaGVkID09IHZhbHVlKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKICAgICBp
ZiAodmFsdWUpIHsKLSAgICAgICAgdXNiX2RldmljZV9hdHRhY2goZGV2LCAmZXJyKTsKLSAgICAg
ICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgICAgIHVzYl9kZXZpY2VfYXR0YWNo
KGRldiwgZXJycCk7CiAgICAgfSBlbHNlIHsKICAgICAgICAgdXNiX2RldmljZV9kZXRhY2goZGV2
KTsKICAgICB9CmRpZmYgLS1naXQgYS9ody91c2IvZGV2LXNlcmlhbC5jIGIvaHcvdXNiL2Rldi1z
ZXJpYWwuYwppbmRleCA0NWNjNzQxMjhhLi5kNmZmNTViYWY2IDEwMDY0NAotLS0gYS9ody91c2Iv
ZGV2LXNlcmlhbC5jCisrKyBiL2h3L3VzYi9kZXYtc2VyaWFsLmMKQEAgLTQ4NSw3ICs0ODUsNiBA
QCBzdGF0aWMgdm9pZCB1c2Jfc2VyaWFsX2V2ZW50KHZvaWQgKm9wYXF1ZSwgaW50IGV2ZW50KQog
c3RhdGljIHZvaWQgdXNiX3NlcmlhbF9yZWFsaXplKFVTQkRldmljZSAqZGV2LCBFcnJvciAqKmVy
cnApCiB7CiAgICAgVVNCU2VyaWFsU3RhdGUgKnMgPSBVU0JfU0VSSUFMX0RFVihkZXYpOwotICAg
IEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgdXNiX2Rlc2NfY3JlYXRlX3NlcmlhbChk
ZXYpOwogICAgIHVzYl9kZXNjX2luaXQoZGV2KTsKQEAgLTQ5Niw5ICs0OTUsOCBAQCBzdGF0aWMg
dm9pZCB1c2Jfc2VyaWFsX3JlYWxpemUoVVNCRGV2aWNlICpkZXYsIEVycm9yICoqZXJycCkKICAg
ICAgICAgcmV0dXJuOwogICAgIH0KIAotICAgIHVzYl9jaGVja19hdHRhY2goZGV2LCAmbG9jYWxf
ZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJw
LCBsb2NhbF9lcnIpOworICAgIHVzYl9jaGVja19hdHRhY2goZGV2LCBlcnJwKTsKKyAgICBpZiAo
KmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApkaWZmIC0tZ2l0IGEvaHcvdXNiL2Rl
di1zbWFydGNhcmQtcmVhZGVyLmMgYi9ody91c2IvZGV2LXNtYXJ0Y2FyZC1yZWFkZXIuYwppbmRl
eCA0NTY4ZGIyNTY4Li5jYmRmMmQ5NjU4IDEwMDY0NAotLS0gYS9ody91c2IvZGV2LXNtYXJ0Y2Fy
ZC1yZWFkZXIuYworKysgYi9ody91c2IvZGV2LXNtYXJ0Y2FyZC1yZWFkZXIuYwpAQCAtMTI3NSwx
NSArMTI3NSwxMyBAQCBzdGF0aWMgdm9pZCBjY2lkX2NhcmRfdW5yZWFsaXplKERldmljZVN0YXRl
ICpxZGV2LCBFcnJvciAqKmVycnApCiAgICAgQ0NJRENhcmRDbGFzcyAqY2MgPSBDQ0lEX0NBUkRf
R0VUX0NMQVNTKGNhcmQpOwogICAgIFVTQkRldmljZSAqZGV2ID0gVVNCX0RFVklDRShxZGV2LT5w
YXJlbnRfYnVzLT5wYXJlbnQpOwogICAgIFVTQkNDSURTdGF0ZSAqcyA9IFVTQl9DQ0lEX0RFVihk
ZXYpOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgaWYgKGNjaWRfY2FyZF9p
bnNlcnRlZChzKSkgewogICAgICAgICBjY2lkX2NhcmRfY2FyZF9yZW1vdmVkKGNhcmQpOwogICAg
IH0KICAgICBpZiAoY2MtPnVucmVhbGl6ZSkgewotICAgICAgICBjYy0+dW5yZWFsaXplKGNhcmQs
ICZsb2NhbF9lcnIpOwotICAgICAgICBpZiAobG9jYWxfZXJyICE9IE5VTEwpIHsKLSAgICAgICAg
ICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICBjYy0+dW5yZWFs
aXplKGNhcmQsIGVycnApOworICAgICAgICBpZiAoKmVycnAgIT0gTlVMTCkgewogICAgICAgICAg
ICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgfQpAQCAtMTI5Niw3ICsxMjk0LDYgQEAgc3RhdGlj
IHZvaWQgY2NpZF9jYXJkX3JlYWxpemUoRGV2aWNlU3RhdGUgKnFkZXYsIEVycm9yICoqZXJycCkK
ICAgICBDQ0lEQ2FyZENsYXNzICpjYyA9IENDSURfQ0FSRF9HRVRfQ0xBU1MoY2FyZCk7CiAgICAg
VVNCRGV2aWNlICpkZXYgPSBVU0JfREVWSUNFKHFkZXYtPnBhcmVudF9idXMtPnBhcmVudCk7CiAg
ICAgVVNCQ0NJRFN0YXRlICpzID0gVVNCX0NDSURfREVWKGRldik7Ci0gICAgRXJyb3IgKmxvY2Fs
X2VyciA9IE5VTEw7CiAKICAgICBpZiAoY2FyZC0+c2xvdCAhPSAwKSB7CiAgICAgICAgIGVycm9y
X3NldGcoZXJycCwgInVzYi1jY2lkIHN1cHBvcnRzIG9uZSBzbG90LCBjYW4ndCBhZGQgJWQiLApA
QCAtMTMwOCw5ICsxMzA1LDggQEAgc3RhdGljIHZvaWQgY2NpZF9jYXJkX3JlYWxpemUoRGV2aWNl
U3RhdGUgKnFkZXYsIEVycm9yICoqZXJycCkKICAgICAgICAgcmV0dXJuOwogICAgIH0KICAgICBp
ZiAoY2MtPnJlYWxpemUpIHsKLSAgICAgICAgY2MtPnJlYWxpemUoY2FyZCwgJmxvY2FsX2Vycik7
Ci0gICAgICAgIGlmIChsb2NhbF9lcnIgIT0gTlVMTCkgewotICAgICAgICAgICAgZXJyb3JfcHJv
cGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgIGNjLT5yZWFsaXplKGNhcmQsIGVycnAp
OworICAgICAgICBpZiAoKmVycnAgIT0gTlVMTCkgewogICAgICAgICAgICAgcmV0dXJuOwogICAg
ICAgICB9CiAgICAgfQpkaWZmIC0tZ2l0IGEvaHcvdXNiL2Rldi1zdG9yYWdlLmMgYi9ody91c2Iv
ZGV2LXN0b3JhZ2UuYwppbmRleCA4NTQ1MTkzNDg4Li5jZDY3MGY4ZTQ0IDEwMDY0NAotLS0gYS9o
dy91c2IvZGV2LXN0b3JhZ2UuYworKysgYi9ody91c2IvZGV2LXN0b3JhZ2UuYwpAQCAtNzIwLDE2
ICs3MjAsMTUgQEAgc3RhdGljIHZvaWQgdXNiX21zZF9zZXRfYm9vdGluZGV4KE9iamVjdCAqb2Jq
LCBWaXNpdG9yICp2LCBjb25zdCBjaGFyICpuYW1lLAogICAgIFVTQkRldmljZSAqZGV2ID0gVVNC
X0RFVklDRShvYmopOwogICAgIE1TRFN0YXRlICpzID0gVVNCX1NUT1JBR0VfREVWKGRldik7CiAg
ICAgaW50MzJfdCBib290X2luZGV4OwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCi0g
ICAgdmlzaXRfdHlwZV9pbnQzMih2LCBuYW1lLCAmYm9vdF9pbmRleCwgJmxvY2FsX2Vycik7Ci0g
ICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBnb3RvIG91dDsKKyAgICB2aXNpdF90eXBlX2lu
dDMyKHYsIG5hbWUsICZib290X2luZGV4LCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKKyAgICAg
ICAgcmV0dXJuOwogICAgIH0KICAgICAvKiBjaGVjayB3aGV0aGVyIGJvb3RpbmRleCBpcyBwcmVz
ZW50IGluIGZ3X2Jvb3Rfb3JkZXIgbGlzdCAgKi8KLSAgICBjaGVja19ib290X2luZGV4KGJvb3Rf
aW5kZXgsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZ290byBv
dXQ7CisgICAgY2hlY2tfYm9vdF9pbmRleChib290X2luZGV4LCBlcnJwKTsKKyAgICBpZiAoKmVy
cnApIHsKKyAgICAgICAgcmV0dXJuOwogICAgIH0KICAgICAvKiBjaGFuZ2UgYm9vdGluZGV4IHRv
IGEgbmV3IG9uZSAqLwogICAgIHMtPmNvbmYuYm9vdGluZGV4ID0gYm9vdF9pbmRleDsKQEAgLTcz
OCw5ICs3MzcsNiBAQCBzdGF0aWMgdm9pZCB1c2JfbXNkX3NldF9ib290aW5kZXgoT2JqZWN0ICpv
YmosIFZpc2l0b3IgKnYsIGNvbnN0IGNoYXIgKm5hbWUsCiAgICAgICAgIG9iamVjdF9wcm9wZXJ0
eV9zZXRfaW50KE9CSkVDVChzLT5zY3NpX2RldiksIGJvb3RfaW5kZXgsICJib290aW5kZXgiLAog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmZXJyb3JfYWJvcnQpOwogICAgIH0KLQot
b3V0OgotICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogfQogCiBzdGF0aWMg
Y29uc3QgVHlwZUluZm8gdXNiX3N0b3JhZ2VfZGV2X3R5cGVfaW5mbyA9IHsKZGlmZiAtLWdpdCBh
L2h3L3VzYi9oY2Qtb2hjaS1wY2kuYyBiL2h3L3VzYi9oY2Qtb2hjaS1wY2kuYwppbmRleCBjMDUy
ZjEwNTIxLi5iZTc2YjQ0MWM0IDEwMDY0NAotLS0gYS9ody91c2IvaGNkLW9oY2ktcGNpLmMKKysr
IGIvaHcvdXNiL2hjZC1vaGNpLXBjaS5jCkBAIC02MCw3ICs2MCw2IEBAIHN0YXRpYyB2b2lkIG9o
Y2lfcGNpX2RpZShzdHJ1Y3QgT0hDSVN0YXRlICpvaGNpKQogCiBzdGF0aWMgdm9pZCB1c2Jfb2hj
aV9yZWFsaXplX3BjaShQQ0lEZXZpY2UgKmRldiwgRXJyb3IgKiplcnJwKQogewotICAgIEVycm9y
ICplcnIgPSBOVUxMOwogICAgIE9IQ0lQQ0lTdGF0ZSAqb2hjaSA9IFBDSV9PSENJKGRldik7CiAK
ICAgICBkZXYtPmNvbmZpZ1tQQ0lfQ0xBU1NfUFJPR10gPSAweDEwOyAvKiBPSENJICovCkBAIC02
OCw5ICs2Nyw4IEBAIHN0YXRpYyB2b2lkIHVzYl9vaGNpX3JlYWxpemVfcGNpKFBDSURldmljZSAq
ZGV2LCBFcnJvciAqKmVycnApCiAKICAgICB1c2Jfb2hjaV9pbml0KCZvaGNpLT5zdGF0ZSwgREVW
SUNFKGRldiksIG9oY2ktPm51bV9wb3J0cywgMCwKICAgICAgICAgICAgICAgICAgIG9oY2ktPm1h
c3RlcmJ1cywgb2hjaS0+Zmlyc3Rwb3J0LAotICAgICAgICAgICAgICAgICAgcGNpX2dldF9hZGRy
ZXNzX3NwYWNlKGRldiksIG9oY2lfcGNpX2RpZSwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAg
ICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgICAgICAgICAgIHBjaV9n
ZXRfYWRkcmVzc19zcGFjZShkZXYpLCBvaGNpX3BjaV9kaWUsIGVycnApOworICAgIGlmICgqZXJy
cCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCmRpZmYgLS1naXQgYS9ody91c2IvaGNkLW9o
Y2kuYyBiL2h3L3VzYi9oY2Qtb2hjaS5jCmluZGV4IDE0NWVlMjFmZDYuLjE0ZTAwMmU0YjUgMTAw
NjQ0Ci0tLSBhL2h3L3VzYi9oY2Qtb2hjaS5jCisrKyBiL2h3L3VzYi9oY2Qtb2hjaS5jCkBAIC0x
Nzk1LDcgKzE3OTUsNiBAQCB2b2lkIHVzYl9vaGNpX2luaXQoT0hDSVN0YXRlICpvaGNpLCBEZXZp
Y2VTdGF0ZSAqZGV2LCB1aW50MzJfdCBudW1fcG9ydHMsCiAgICAgICAgICAgICAgICAgICAgdWlu
dDMyX3QgZmlyc3Rwb3J0LCBBZGRyZXNzU3BhY2UgKmFzLAogICAgICAgICAgICAgICAgICAgIHZv
aWQgKCpvaGNpX2RpZV9mbikoc3RydWN0IE9IQ0lTdGF0ZSAqKSwgRXJyb3IgKiplcnJwKQogewot
ICAgIEVycm9yICplcnIgPSBOVUxMOwogICAgIGludCBpOwogCiAgICAgb2hjaS0+YXMgPSBhczsK
QEAgLTE4MzEsOSArMTgzMCw4IEBAIHZvaWQgdXNiX29oY2lfaW5pdChPSENJU3RhdGUgKm9oY2ks
IERldmljZVN0YXRlICpkZXYsIHVpbnQzMl90IG51bV9wb3J0cywKICAgICAgICAgdXNiX3JlZ2lz
dGVyX2NvbXBhbmlvbihtYXN0ZXJidXMsIHBvcnRzLCBudW1fcG9ydHMsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgZmlyc3Rwb3J0LCBvaGNpLCAmb2hjaV9wb3J0X29wcywKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBVU0JfU1BFRURfTUFTS19MT1cgfCBVU0JfU1BFRURf
TUFTS19GVUxMLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZlcnIpOwotICAgICAg
ICBpZiAoZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJwKTsKKyAgICAgICAgaWYgKCplcnJwKSB7
CiAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgIH0KICAgICB9IGVsc2UgewpAQCAtMTg4OSwx
MyArMTg4NywxMSBAQCBzdGF0aWMgdm9pZCBvaGNpX3JlYWxpemVfcHhhKERldmljZVN0YXRlICpk
ZXYsIEVycm9yICoqZXJycCkKIHsKICAgICBPSENJU3lzQnVzU3RhdGUgKnMgPSBTWVNCVVNfT0hD
SShkZXYpOwogICAgIFN5c0J1c0RldmljZSAqc2JkID0gU1lTX0JVU19ERVZJQ0UoZGV2KTsKLSAg
ICBFcnJvciAqZXJyID0gTlVMTDsKIAogICAgIHVzYl9vaGNpX2luaXQoJnMtPm9oY2ksIGRldiwg
cy0+bnVtX3BvcnRzLCBzLT5kbWFfb2Zmc2V0LAogICAgICAgICAgICAgICAgICAgcy0+bWFzdGVy
YnVzLCBzLT5maXJzdHBvcnQsCi0gICAgICAgICAgICAgICAgICAmYWRkcmVzc19zcGFjZV9tZW1v
cnksIG9oY2lfc3lzYnVzX2RpZSwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBlcnJv
cl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgICAgICAgICAgICZhZGRyZXNzX3NwYWNl
X21lbW9yeSwgb2hjaV9zeXNidXNfZGllLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAg
ICAgcmV0dXJuOwogICAgIH0KICAgICBzeXNidXNfaW5pdF9pcnEoc2JkLCAmcy0+b2hjaS5pcnEp
OwpkaWZmIC0tZ2l0IGEvaHcvdXNiL2hjZC11aGNpLmMgYi9ody91c2IvaGNkLXVoY2kuYwppbmRl
eCAyMzUwN2FkM2I1Li42ZjZlZTc5MGZkIDEwMDY0NAotLS0gYS9ody91c2IvaGNkLXVoY2kuYwor
KysgYi9ody91c2IvaGNkLXVoY2kuYwpAQCAtMTIxMyw3ICsxMjEzLDYgQEAgc3RhdGljIFVTQkJ1
c09wcyB1aGNpX2J1c19vcHMgPSB7CiAKIHN0YXRpYyB2b2lkIHVzYl91aGNpX2NvbW1vbl9yZWFs
aXplKFBDSURldmljZSAqZGV2LCBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJyb3IgKmVyciA9IE5V
TEw7CiAgICAgUENJRGV2aWNlQ2xhc3MgKnBjID0gUENJX0RFVklDRV9HRVRfQ0xBU1MoZGV2KTsK
ICAgICBVSENJUENJRGV2aWNlQ2xhc3MgKnUgPSBjb250YWluZXJfb2YocGMsIFVIQ0lQQ0lEZXZp
Y2VDbGFzcywgcGFyZW50X2NsYXNzKTsKICAgICBVSENJU3RhdGUgKnMgPSBVSENJKGRldik7CkBA
IC0xMjM0LDkgKzEyMzMsOCBAQCBzdGF0aWMgdm9pZCB1c2JfdWhjaV9jb21tb25fcmVhbGl6ZShQ
Q0lEZXZpY2UgKmRldiwgRXJyb3IgKiplcnJwKQogICAgICAgICB1c2JfcmVnaXN0ZXJfY29tcGFu
aW9uKHMtPm1hc3RlcmJ1cywgcG9ydHMsIE5CX1BPUlRTLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHMtPmZpcnN0cG9ydCwgcywgJnVoY2lfcG9ydF9vcHMsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgVVNCX1NQRUVEX01BU0tfTE9XIHwgVVNCX1NQRUVEX01BU0tfRlVM
TCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmZXJyKTsKLSAgICAgICAgaWYgKGVy
cikgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAg
ICAgICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgfSBlbHNlIHsKZGlmZiAtLWdpdCBhL2h3L3Vz
Yi9oY2QteGhjaS5jIGIvaHcvdXNiL2hjZC14aGNpLmMKaW5kZXggODA5ODhiYjMwNS4uZmIzZmNi
YmQzZCAxMDA2NDQKLS0tIGEvaHcvdXNiL2hjZC14aGNpLmMKKysrIGIvaHcvdXNiL2hjZC14aGNp
LmMKQEAgLTMzNzAsNyArMzM3MCw2IEBAIHN0YXRpYyB2b2lkIHVzYl94aGNpX2luaXQoWEhDSVN0
YXRlICp4aGNpKQogc3RhdGljIHZvaWQgdXNiX3hoY2lfcmVhbGl6ZShzdHJ1Y3QgUENJRGV2aWNl
ICpkZXYsIEVycm9yICoqZXJycCkKIHsKICAgICBpbnQgaSwgcmV0OwotICAgIEVycm9yICplcnIg
PSBOVUxMOwogCiAgICAgWEhDSVN0YXRlICp4aGNpID0gWEhDSShkZXYpOwogCkBAIC0zNDA0LDIw
ICszNDAzLDE5IEBAIHN0YXRpYyB2b2lkIHVzYl94aGNpX3JlYWxpemUoc3RydWN0IFBDSURldmlj
ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgfQogCiAgICAgaWYgKHhoY2ktPm1zaSAhPSBPTl9P
RkZfQVVUT19PRkYpIHsKLSAgICAgICAgcmV0ID0gbXNpX2luaXQoZGV2LCAweDcwLCB4aGNpLT5u
dW1pbnRycywgdHJ1ZSwgZmFsc2UsICZlcnIpOworICAgICAgICByZXQgPSBtc2lfaW5pdChkZXYs
IDB4NzAsIHhoY2ktPm51bWludHJzLCB0cnVlLCBmYWxzZSwgZXJycCk7CiAgICAgICAgIC8qIEFu
eSBlcnJvciBvdGhlciB0aGFuIC1FTk9UU1VQKGJvYXJkJ3MgTVNJIHN1cHBvcnQgaXMgYnJva2Vu
KQogICAgICAgICAgKiBpcyBhIHByb2dyYW1taW5nIGVycm9yICovCiAgICAgICAgIGFzc2VydCgh
cmV0IHx8IHJldCA9PSAtRU5PVFNVUCk7CiAgICAgICAgIGlmIChyZXQgJiYgeGhjaS0+bXNpID09
IE9OX09GRl9BVVRPX09OKSB7CiAgICAgICAgICAgICAvKiBDYW4ndCBzYXRpc2Z5IHVzZXIncyBl
eHBsaWNpdCBtc2k9b24gcmVxdWVzdCwgZmFpbCAqLwotICAgICAgICAgICAgZXJyb3JfYXBwZW5k
X2hpbnQoJmVyciwgIllvdSBoYXZlIHRvIHVzZSBtc2k9YXV0byAoZGVmYXVsdCkgb3IgIgotICAg
ICAgICAgICAgICAgICAgICAibXNpPW9mZiB3aXRoIHRoaXMgbWFjaGluZSB0eXBlLlxuIik7Ci0g
ICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgICAgIGVycm9y
X2FwcGVuZF9oaW50KGVycnAsICJZb3UgaGF2ZSB0byB1c2UgbXNpPWF1dG8gKGRlZmF1bHQpIG9y
ICIKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJtc2k9b2ZmIHdpdGggdGhpcyBtYWNo
aW5lIHR5cGUuXG4iKTsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQotICAgICAgICBh
c3NlcnQoIWVyciB8fCB4aGNpLT5tc2kgPT0gT05fT0ZGX0FVVE9fQVVUTyk7CisgICAgICAgIGFz
c2VydCghKmVycnAgfHwgeGhjaS0+bXNpID09IE9OX09GRl9BVVRPX0FVVE8pOwogICAgICAgICAv
KiBXaXRoIG1zaT1hdXRvLCB3ZSBmYWxsIGJhY2sgdG8gTVNJIG9mZiBzaWxlbnRseSAqLwotICAg
ICAgICBlcnJvcl9mcmVlKGVycik7CisgICAgICAgIGVycm9yX2ZyZWVfZXJycChlcnJwKTsKICAg
ICB9CiAKICAgICB1c2JfeGhjaV9pbml0KHhoY2kpOwpkaWZmIC0tZ2l0IGEvaHcvdmZpby9hcC5j
IGIvaHcvdmZpby9hcC5jCmluZGV4IGRhNmEyMDY2OWQuLmUwNzJhMDhmMWQgMTAwNjQ0Ci0tLSBh
L2h3L3ZmaW8vYXAuYworKysgYi9ody92ZmlvL2FwLmMKQEAgLTg5LDEyICs4OSwxMSBAQCBzdGF0
aWMgdm9pZCB2ZmlvX2FwX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQog
ewogICAgIGludCByZXQ7CiAgICAgY2hhciAqbWRldmlkOwotICAgIEVycm9yICpsb2NhbF9lcnIg
PSBOVUxMOwogICAgIFZGSU9Hcm91cCAqdmZpb19ncm91cDsKICAgICBBUERldmljZSAqYXBkZXYg
PSBBUF9ERVZJQ0UoZGV2KTsKICAgICBWRklPQVBEZXZpY2UgKnZhcGRldiA9IFZGSU9fQVBfREVW
SUNFKGFwZGV2KTsKIAotICAgIHZmaW9fZ3JvdXAgPSB2ZmlvX2FwX2dldF9ncm91cCh2YXBkZXYs
ICZsb2NhbF9lcnIpOworICAgIHZmaW9fZ3JvdXAgPSB2ZmlvX2FwX2dldF9ncm91cCh2YXBkZXYs
IGVycnApOwogICAgIGlmICghdmZpb19ncm91cCkgewogICAgICAgICBnb3RvIG91dF9lcnI7CiAg
ICAgfQpAQCAtMTEzLDcgKzExMiw3IEBAIHN0YXRpYyB2b2lkIHZmaW9fYXBfcmVhbGl6ZShEZXZp
Y2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgICovCiAgICAgdmFwZGV2LT52ZGV2LmJh
bGxvb25fYWxsb3dlZCA9IHRydWU7CiAKLSAgICByZXQgPSB2ZmlvX2dldF9kZXZpY2UodmZpb19n
cm91cCwgbWRldmlkLCAmdmFwZGV2LT52ZGV2LCAmbG9jYWxfZXJyKTsKKyAgICByZXQgPSB2Zmlv
X2dldF9kZXZpY2UodmZpb19ncm91cCwgbWRldmlkLCAmdmFwZGV2LT52ZGV2LCBlcnJwKTsKICAg
ICBpZiAocmV0KSB7CiAgICAgICAgIGdvdG8gb3V0X2dldF9kZXZfZXJyOwogICAgIH0KQEAgLTEy
NCw3ICsxMjMsNiBAQCBvdXRfZ2V0X2Rldl9lcnI6CiAgICAgdmZpb19hcF9wdXRfZGV2aWNlKHZh
cGRldik7CiAgICAgdmZpb19wdXRfZ3JvdXAodmZpb19ncm91cCk7CiBvdXRfZXJyOgotICAgIGVy
cm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogfQogCiBzdGF0aWMgdm9pZCB2ZmlvX2Fw
X3VucmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCmRpZmYgLS1naXQgYS9o
dy92ZmlvL2Njdy5jIGIvaHcvdmZpby9jY3cuYwppbmRleCA2ODYzZjZjNjlmLi5kMmI1MjY2Njdl
IDEwMDY0NAotLS0gYS9ody92ZmlvL2Njdy5jCisrKyBiL2h3L3ZmaW8vY2N3LmMKQEAgLTQ4MSwz
MyArNDgxLDMyIEBAIHN0YXRpYyB2b2lkIHZmaW9fY2N3X3JlYWxpemUoRGV2aWNlU3RhdGUgKmRl
diwgRXJyb3IgKiplcnJwKQogICAgIFMzOTBDQ1dEZXZpY2UgKmNkZXYgPSBET19VUENBU1QoUzM5
MENDV0RldmljZSwgcGFyZW50X29iaiwgY2N3X2Rldik7CiAgICAgVkZJT0NDV0RldmljZSAqdmNk
ZXYgPSBET19VUENBU1QoVkZJT0NDV0RldmljZSwgY2RldiwgY2Rldik7CiAgICAgUzM5MENDV0Rl
dmljZUNsYXNzICpjZGMgPSBTMzkwX0NDV19ERVZJQ0VfR0VUX0NMQVNTKGNkZXYpOwotICAgIEVy
cm9yICplcnIgPSBOVUxMOwogCiAgICAgLyogQ2FsbCB0aGUgY2xhc3MgaW5pdCBmdW5jdGlvbiBm
b3Igc3ViY2hhbm5lbC4gKi8KICAgICBpZiAoY2RjLT5yZWFsaXplKSB7Ci0gICAgICAgIGNkYy0+
cmVhbGl6ZShjZGV2LCB2Y2Rldi0+dmRldi5zeXNmc2RldiwgJmVycik7Ci0gICAgICAgIGlmIChl
cnIpIHsKKyAgICAgICAgY2RjLT5yZWFsaXplKGNkZXYsIHZjZGV2LT52ZGV2LnN5c2ZzZGV2LCBl
cnJwKTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICBnb3RvIG91dF9lcnJfcHJv
cGFnYXRlOwogICAgICAgICB9CiAgICAgfQogCi0gICAgZ3JvdXAgPSB2ZmlvX2Njd19nZXRfZ3Jv
dXAoY2RldiwgJmVycik7CisgICAgZ3JvdXAgPSB2ZmlvX2Njd19nZXRfZ3JvdXAoY2RldiwgZXJy
cCk7CiAgICAgaWYgKCFncm91cCkgewogICAgICAgICBnb3RvIG91dF9ncm91cF9lcnI7CiAgICAg
fQogCi0gICAgdmZpb19jY3dfZ2V0X2RldmljZShncm91cCwgdmNkZXYsICZlcnIpOwotICAgIGlm
IChlcnIpIHsKKyAgICB2ZmlvX2Njd19nZXRfZGV2aWNlKGdyb3VwLCB2Y2RldiwgZXJycCk7Cisg
ICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8gb3V0X2RldmljZV9lcnI7CiAgICAgfQogCi0g
ICAgdmZpb19jY3dfZ2V0X3JlZ2lvbih2Y2RldiwgJmVycik7Ci0gICAgaWYgKGVycikgeworICAg
IHZmaW9fY2N3X2dldF9yZWdpb24odmNkZXYsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAg
ICAgICBnb3RvIG91dF9yZWdpb25fZXJyOwogICAgIH0KIAotICAgIHZmaW9fY2N3X3JlZ2lzdGVy
X2lvX25vdGlmaWVyKHZjZGV2LCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7CisgICAgdmZpb19jY3df
cmVnaXN0ZXJfaW9fbm90aWZpZXIodmNkZXYsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAg
ICAgICBnb3RvIG91dF9ub3RpZmllcl9lcnI7CiAgICAgfQogCkBAIC01MjQsNyArNTIzLDYgQEAg
b3V0X2dyb3VwX2VycjoKICAgICAgICAgY2RjLT51bnJlYWxpemUoY2RldiwgTlVMTCk7CiAgICAg
fQogb3V0X2Vycl9wcm9wYWdhdGU6Ci0gICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CiB9
CiAKIHN0YXRpYyB2b2lkIHZmaW9fY2N3X3VucmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJv
ciAqKmVycnApCmRpZmYgLS1naXQgYS9ody92ZmlvL3BjaS1xdWlya3MuYyBiL2h3L3ZmaW8vcGNp
LXF1aXJrcy5jCmluZGV4IDEzNmYzYTlhZDYuLmM3YmMxN2VkOGEgMTAwNjQ0Ci0tLSBhL2h3L3Zm
aW8vcGNpLXF1aXJrcy5jCisrKyBiL2h3L3ZmaW8vcGNpLXF1aXJrcy5jCkBAIC0yMTA5LDE2ICsy
MTA5LDE0IEBAIHN0YXRpYyB2b2lkIHNldF9udl9ncHVkaXJlY3RfY2xpcXVlX2lkKE9iamVjdCAq
b2JqLCBWaXNpdG9yICp2LAogICAgIERldmljZVN0YXRlICpkZXYgPSBERVZJQ0Uob2JqKTsKICAg
ICBQcm9wZXJ0eSAqcHJvcCA9IG9wYXF1ZTsKICAgICB1aW50OF90IHZhbHVlLCAqcHRyID0gcWRl
dl9nZXRfcHJvcF9wdHIoZGV2LCBwcm9wKTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsK
IAogICAgIGlmIChkZXYtPnJlYWxpemVkKSB7CiAgICAgICAgIHFkZXZfcHJvcF9zZXRfYWZ0ZXJf
cmVhbGl6ZShkZXYsIG5hbWUsIGVycnApOwogICAgICAgICByZXR1cm47CiAgICAgfQogCi0gICAg
dmlzaXRfdHlwZV91aW50OCh2LCBuYW1lLCAmdmFsdWUsICZsb2NhbF9lcnIpOwotICAgIGlmIChs
b2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7Cisg
ICAgdmlzaXRfdHlwZV91aW50OCh2LCBuYW1lLCAmdmFsdWUsIGVycnApOworICAgIGlmICgqZXJy
cCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCmRpZmYgLS1naXQgYS9ody92ZmlvL3BjaS5j
IGIvaHcvdmZpby9wY2kuYwppbmRleCBkYzM0NzljMzc0Li44MzlkZGEzNDI0IDEwMDY0NAotLS0g
YS9ody92ZmlvL3BjaS5jCisrKyBiL2h3L3ZmaW8vcGNpLmMKQEAgLTExOSw3ICsxMTksNiBAQCBz
dGF0aWMgdm9pZCB2ZmlvX2ludHhfZW5hYmxlX2t2bShWRklPUENJRGV2aWNlICp2ZGV2LCBFcnJv
ciAqKmVycnApCiAgICAgICAgIC5nc2kgPSB2ZGV2LT5pbnR4LnJvdXRlLmlycSwKICAgICAgICAg
LmZsYWdzID0gS1ZNX0lSUUZEX0ZMQUdfUkVTQU1QTEUsCiAgICAgfTsKLSAgICBFcnJvciAqZXJy
ID0gTlVMTDsKIAogICAgIGlmICh2ZGV2LT5ub19rdm1faW50eCB8fCAha3ZtX2lycWZkc19lbmFi
bGVkKCkgfHwKICAgICAgICAgdmRldi0+aW50eC5yb3V0ZS5tb2RlICE9IFBDSV9JTlRYX0VOQUJM
RUQgfHwKQEAgLTE0OSw4ICsxNDgsNyBAQCBzdGF0aWMgdm9pZCB2ZmlvX2ludHhfZW5hYmxlX2t2
bShWRklPUENJRGV2aWNlICp2ZGV2LCBFcnJvciAqKmVycnApCiAKICAgICBpZiAodmZpb19zZXRf
aXJxX3NpZ25hbGluZygmdmRldi0+dmJhc2VkZXYsIFZGSU9fUENJX0lOVFhfSVJRX0lOREVYLCAw
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZGSU9fSVJRX1NFVF9BQ1RJT05fVU5N
QVNLLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlycWZkLnJlc2FtcGxlZmQsICZl
cnIpKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGlycWZkLnJlc2FtcGxlZmQsIGVycnApKSB7CiAgICAgICAgIGdv
dG8gZmFpbF92ZmlvOwogICAgIH0KIApAQCAtMjU0LDcgKzI1Miw2IEBAIHN0YXRpYyB2b2lkIHZm
aW9faW50eF91cGRhdGUoUENJRGV2aWNlICpwZGV2KQogc3RhdGljIGludCB2ZmlvX2ludHhfZW5h
YmxlKFZGSU9QQ0lEZXZpY2UgKnZkZXYsIEVycm9yICoqZXJycCkKIHsKICAgICB1aW50OF90IHBp
biA9IHZmaW9fcGNpX3JlYWRfY29uZmlnKCZ2ZGV2LT5wZGV2LCBQQ0lfSU5URVJSVVBUX1BJTiwg
MSk7Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7CiAgICAgaW50MzJfdCBmZDsKICAgICBpbnQgcmV0
OwogCkBAIC0yODgsMTYgKzI4NSwxNSBAQCBzdGF0aWMgaW50IHZmaW9faW50eF9lbmFibGUoVkZJ
T1BDSURldmljZSAqdmRldiwgRXJyb3IgKiplcnJwKQogICAgIHFlbXVfc2V0X2ZkX2hhbmRsZXIo
ZmQsIHZmaW9faW50eF9pbnRlcnJ1cHQsIE5VTEwsIHZkZXYpOwogCiAgICAgaWYgKHZmaW9fc2V0
X2lycV9zaWduYWxpbmcoJnZkZXYtPnZiYXNlZGV2LCBWRklPX1BDSV9JTlRYX0lSUV9JTkRFWCwg
MCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWRklPX0lSUV9TRVRfQUNUSU9OX1RS
SUdHRVIsIGZkLCAmZXJyKSkgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWRklPX0lSUV9TRVRfQUNUSU9OX1RSSUdH
RVIsIGZkLCBlcnJwKSkgewogICAgICAgICBxZW11X3NldF9mZF9oYW5kbGVyKGZkLCBOVUxMLCBO
VUxMLCB2ZGV2KTsKICAgICAgICAgZXZlbnRfbm90aWZpZXJfY2xlYW51cCgmdmRldi0+aW50eC5p
bnRlcnJ1cHQpOwogICAgICAgICByZXR1cm4gLWVycm5vOwogICAgIH0KIAotICAgIHZmaW9faW50
eF9lbmFibGVfa3ZtKHZkZXYsICZlcnIpOwotICAgIGlmIChlcnIpIHsKLSAgICAgICAgd2Fybl9y
ZXBvcnRmX2VycihlcnIsIFZGSU9fTVNHX1BSRUZJWCwgdmRldi0+dmJhc2VkZXYubmFtZSk7Cisg
ICAgdmZpb19pbnR4X2VuYWJsZV9rdm0odmRldiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7Cisg
ICAgICAgIHdhcm5fcmVwb3J0Zl9lcnIoKmVycnAsIFZGSU9fTVNHX1BSRUZJWCwgdmRldi0+dmJh
c2VkZXYubmFtZSk7CiAgICAgfQogCiAgICAgdmRldi0+aW50ZXJydXB0ID0gVkZJT19JTlRfSU5U
eDsKQEAgLTEyMjEsNyArMTIxNyw2IEBAIHN0YXRpYyBpbnQgdmZpb19tc2lfc2V0dXAoVkZJT1BD
SURldmljZSAqdmRldiwgaW50IHBvcywgRXJyb3IgKiplcnJwKQogICAgIHVpbnQxNl90IGN0cmw7
CiAgICAgYm9vbCBtc2lfNjRiaXQsIG1zaV9tYXNrYml0OwogICAgIGludCByZXQsIGVudHJpZXM7
Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7CiAKICAgICBpZiAocHJlYWQodmRldi0+dmJhc2VkZXYu
ZmQsICZjdHJsLCBzaXplb2YoY3RybCksCiAgICAgICAgICAgICAgIHZkZXYtPmNvbmZpZ19vZmZz
ZXQgKyBwb3MgKyBQQ0lfQ0FQX0ZMQUdTKSAhPSBzaXplb2YoY3RybCkpIHsKQEAgLTEyMzYsMTIg
KzEyMzEsMTIgQEAgc3RhdGljIGludCB2ZmlvX21zaV9zZXR1cChWRklPUENJRGV2aWNlICp2ZGV2
LCBpbnQgcG9zLCBFcnJvciAqKmVycnApCiAKICAgICB0cmFjZV92ZmlvX21zaV9zZXR1cCh2ZGV2
LT52YmFzZWRldi5uYW1lLCBwb3MpOwogCi0gICAgcmV0ID0gbXNpX2luaXQoJnZkZXYtPnBkZXYs
IHBvcywgZW50cmllcywgbXNpXzY0Yml0LCBtc2lfbWFza2JpdCwgJmVycik7CisgICAgcmV0ID0g
bXNpX2luaXQoJnZkZXYtPnBkZXYsIHBvcywgZW50cmllcywgbXNpXzY0Yml0LCBtc2lfbWFza2Jp
dCwgZXJycCk7CiAgICAgaWYgKHJldCA8IDApIHsKICAgICAgICAgaWYgKHJldCA9PSAtRU5PVFNV
UCkgewogICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgIH0KLSAgICAgICAgZXJyb3JfcHJv
cGFnYXRlX3ByZXBlbmQoZXJycCwgZXJyLCAibXNpX2luaXQgZmFpbGVkOiAiKTsKKyAgICAgICAg
ZXJyb3JfcHJvcGFnYXRlX3ByZXBlbmQoZXJycCwgKmVycnAsICJtc2lfaW5pdCBmYWlsZWQ6ICIp
OwogICAgICAgICByZXR1cm4gcmV0OwogICAgIH0KICAgICB2ZGV2LT5tc2lfY2FwX3NpemUgPSAw
eGEgKyAobXNpX21hc2tiaXQgPyAweGEgOiAwKSArIChtc2lfNjRiaXQgPyAweDQgOiAwKTsKQEAg
LTE1MDMsNyArMTQ5OCw2IEBAIHN0YXRpYyB2b2lkIHZmaW9fbXNpeF9lYXJseV9zZXR1cChWRklP
UENJRGV2aWNlICp2ZGV2LCBFcnJvciAqKmVycnApCiBzdGF0aWMgaW50IHZmaW9fbXNpeF9zZXR1
cChWRklPUENJRGV2aWNlICp2ZGV2LCBpbnQgcG9zLCBFcnJvciAqKmVycnApCiB7CiAgICAgaW50
IHJldDsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKIAogICAgIHZkZXYtPm1zaXgtPnBlbmRpbmcg
PSBnX21hbGxvYzAoQklUU19UT19MT05HUyh2ZGV2LT5tc2l4LT5lbnRyaWVzKSAqCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplb2YodW5zaWduZWQgbG9uZykpOwpAQCAt
MTUxMiwxNCArMTUwNiwxMyBAQCBzdGF0aWMgaW50IHZmaW9fbXNpeF9zZXR1cChWRklPUENJRGV2
aWNlICp2ZGV2LCBpbnQgcG9zLCBFcnJvciAqKmVycnApCiAgICAgICAgICAgICAgICAgICAgIHZk
ZXYtPm1zaXgtPnRhYmxlX2JhciwgdmRldi0+bXNpeC0+dGFibGVfb2Zmc2V0LAogICAgICAgICAg
ICAgICAgICAgICB2ZGV2LT5iYXJzW3ZkZXYtPm1zaXgtPnBiYV9iYXJdLm1yLAogICAgICAgICAg
ICAgICAgICAgICB2ZGV2LT5tc2l4LT5wYmFfYmFyLCB2ZGV2LT5tc2l4LT5wYmFfb2Zmc2V0LCBw
b3MsCi0gICAgICAgICAgICAgICAgICAgICZlcnIpOworICAgICAgICAgICAgICAgICAgICBlcnJw
KTsKICAgICBpZiAocmV0IDwgMCkgewogICAgICAgICBpZiAocmV0ID09IC1FTk9UU1VQKSB7Ci0g
ICAgICAgICAgICB3YXJuX3JlcG9ydF9lcnIoZXJyKTsKKyAgICAgICAgICAgIHdhcm5fcmVwb3J0
X2VycnAoZXJycCk7CiAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgfQogCi0gICAgICAg
IGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOwogICAgICAgICByZXR1cm4gcmV0OwogICAgIH0K
IApAQCAtMjcwNCw3ICsyNjk3LDYgQEAgc3RhdGljIHZvaWQgdmZpb19yZWFsaXplKFBDSURldmlj
ZSAqcGRldiwgRXJyb3IgKiplcnJwKQogICAgIFZGSU9EZXZpY2UgKnZiYXNlZGV2X2l0ZXI7CiAg
ICAgVkZJT0dyb3VwICpncm91cDsKICAgICBjaGFyICp0bXAsICpzdWJzeXMsIGdyb3VwX3BhdGhb
UEFUSF9NQVhdLCAqZ3JvdXBfbmFtZTsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKICAgICBzc2l6
ZV90IGxlbjsKICAgICBzdHJ1Y3Qgc3RhdCBzdDsKICAgICBpbnQgZ3JvdXBpZDsKQEAgLTI3OTYs
OSArMjc4OCw4IEBAIHN0YXRpYyB2b2lkIHZmaW9fcmVhbGl6ZShQQ0lEZXZpY2UgKnBkZXYsIEVy
cm9yICoqZXJycCkKICAgICAgICAgZ290byBlcnJvcjsKICAgICB9CiAKLSAgICB2ZmlvX3BvcHVs
YXRlX2RldmljZSh2ZGV2LCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7Ci0gICAgICAgIGVycm9yX3By
b3BhZ2F0ZShlcnJwLCBlcnIpOworICAgIHZmaW9fcG9wdWxhdGVfZGV2aWNlKHZkZXYsIGVycnAp
OworICAgIGlmICgqZXJycCkgewogICAgICAgICBnb3RvIGVycm9yOwogICAgIH0KIApAQCAtMjg5
MSw5ICsyODgyLDggQEAgc3RhdGljIHZvaWQgdmZpb19yZWFsaXplKFBDSURldmljZSAqcGRldiwg
RXJyb3IgKiplcnJwKQogCiAgICAgdmZpb19iYXJzX3ByZXBhcmUodmRldik7CiAKLSAgICB2Zmlv
X21zaXhfZWFybHlfc2V0dXAodmRldiwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBl
cnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICB2ZmlvX21zaXhfZWFybHlfc2V0dXAodmRl
diwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8gZXJyb3I7CiAgICAgfQog
CmRpZmYgLS1naXQgYS9ody92aXJ0aW8vdmlydGlvLWJhbGxvb24uYyBiL2h3L3ZpcnRpby92aXJ0
aW8tYmFsbG9vbi5jCmluZGV4IDQwYjA0ZjUxODAuLmFmZTY0NDhjN2IgMTAwNjQ0Ci0tLSBhL2h3
L3ZpcnRpby92aXJ0aW8tYmFsbG9vbi5jCisrKyBiL2h3L3ZpcnRpby92aXJ0aW8tYmFsbG9vbi5j
CkBAIC0yMjksNDAgKzIyOSwzNyBAQCBzdGF0aWMgdm9pZCBiYWxsb29uX3N0YXRzX3BvbGxfY2Io
dm9pZCAqb3BhcXVlKQogc3RhdGljIHZvaWQgYmFsbG9vbl9zdGF0c19nZXRfYWxsKE9iamVjdCAq
b2JqLCBWaXNpdG9yICp2LCBjb25zdCBjaGFyICpuYW1lLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHZvaWQgKm9wYXF1ZSwgRXJyb3IgKiplcnJwKQogewotICAgIEVycm9yICpl
cnIgPSBOVUxMOwogICAgIFZpcnRJT0JhbGxvb24gKnMgPSBvcGFxdWU7CiAgICAgaW50IGk7CiAK
LSAgICB2aXNpdF9zdGFydF9zdHJ1Y3QodiwgbmFtZSwgTlVMTCwgMCwgJmVycik7Ci0gICAgaWYg
KGVycikgewotICAgICAgICBnb3RvIG91dDsKKyAgICB2aXNpdF9zdGFydF9zdHJ1Y3QodiwgbmFt
ZSwgTlVMTCwgMCwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CisgICAgICAgIHJldHVybjsKICAg
ICB9Ci0gICAgdmlzaXRfdHlwZV9pbnQodiwgImxhc3QtdXBkYXRlIiwgJnMtPnN0YXRzX2xhc3Rf
dXBkYXRlLCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7CisgICAgdmlzaXRfdHlwZV9pbnQodiwgImxh
c3QtdXBkYXRlIiwgJnMtPnN0YXRzX2xhc3RfdXBkYXRlLCBlcnJwKTsKKyAgICBpZiAoKmVycnAp
IHsKICAgICAgICAgZ290byBvdXRfZW5kOwogICAgIH0KIAotICAgIHZpc2l0X3N0YXJ0X3N0cnVj
dCh2LCAic3RhdHMiLCBOVUxMLCAwLCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7CisgICAgdmlzaXRf
c3RhcnRfc3RydWN0KHYsICJzdGF0cyIsIE5VTEwsIDAsIGVycnApOworICAgIGlmICgqZXJycCkg
ewogICAgICAgICBnb3RvIG91dF9lbmQ7CiAgICAgfQogICAgIGZvciAoaSA9IDA7IGkgPCBWSVJU
SU9fQkFMTE9PTl9TX05SOyBpKyspIHsKLSAgICAgICAgdmlzaXRfdHlwZV91aW50NjQodiwgYmFs
bG9vbl9zdGF0X25hbWVzW2ldLCAmcy0+c3RhdHNbaV0sICZlcnIpOwotICAgICAgICBpZiAoZXJy
KSB7CisgICAgICAgIHZpc2l0X3R5cGVfdWludDY0KHYsIGJhbGxvb25fc3RhdF9uYW1lc1tpXSwg
JnMtPnN0YXRzW2ldLCBlcnJwKTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICBn
b3RvIG91dF9uZXN0ZWQ7CiAgICAgICAgIH0KICAgICB9Ci0gICAgdmlzaXRfY2hlY2tfc3RydWN0
KHYsICZlcnIpOworICAgIHZpc2l0X2NoZWNrX3N0cnVjdCh2LCBlcnJwKTsKIG91dF9uZXN0ZWQ6
CiAgICAgdmlzaXRfZW5kX3N0cnVjdCh2LCBOVUxMKTsKIAotICAgIGlmICghZXJyKSB7Ci0gICAg
ICAgIHZpc2l0X2NoZWNrX3N0cnVjdCh2LCAmZXJyKTsKKyAgICBpZiAoISplcnJwKSB7CisgICAg
ICAgIHZpc2l0X2NoZWNrX3N0cnVjdCh2LCBlcnJwKTsKICAgICB9CiBvdXRfZW5kOgogICAgIHZp
c2l0X2VuZF9zdHJ1Y3QodiwgTlVMTCk7Ci1vdXQ6Ci0gICAgZXJyb3JfcHJvcGFnYXRlKGVycnAs
IGVycik7CiB9CiAKIHN0YXRpYyB2b2lkIGJhbGxvb25fc3RhdHNfZ2V0X3BvbGxfaW50ZXJ2YWwo
T2JqZWN0ICpvYmosIFZpc2l0b3IgKnYsCkBAIC0yNzgsMTIgKzI3NSwxMCBAQCBzdGF0aWMgdm9p
ZCBiYWxsb29uX3N0YXRzX3NldF9wb2xsX2ludGVydmFsKE9iamVjdCAqb2JqLCBWaXNpdG9yICp2
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcnJvciAqKmVy
cnApCiB7CiAgICAgVmlydElPQmFsbG9vbiAqcyA9IG9wYXF1ZTsKLSAgICBFcnJvciAqbG9jYWxf
ZXJyID0gTlVMTDsKICAgICBpbnQ2NF90IHZhbHVlOwogCi0gICAgdmlzaXRfdHlwZV9pbnQodiwg
bmFtZSwgJnZhbHVlLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAg
IGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHZpc2l0X3R5cGVfaW50KHYs
IG5hbWUsICZ2YWx1ZSwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsK
ICAgICB9CiAKZGlmZiAtLWdpdCBhL2h3L3ZpcnRpby92aXJ0aW8tYnVzLmMgYi9ody92aXJ0aW8v
dmlydGlvLWJ1cy5jCmluZGV4IGIyYzgwNDI5MmUuLjVjNTRjZWFkNzIgMTAwNjQ0Ci0tLSBhL2h3
L3ZpcnRpby92aXJ0aW8tYnVzLmMKKysrIGIvaHcvdmlydGlvL3ZpcnRpby1idXMuYwpAQCAtNDgs
MTQgKzQ4LDEyIEBAIHZvaWQgdmlydGlvX2J1c19kZXZpY2VfcGx1Z2dlZChWaXJ0SU9EZXZpY2Ug
KnZkZXYsIEVycm9yICoqZXJycCkKICAgICBWaXJ0aW9CdXNDbGFzcyAqa2xhc3MgPSBWSVJUSU9f
QlVTX0dFVF9DTEFTUyhidXMpOwogICAgIFZpcnRpb0RldmljZUNsYXNzICp2ZGMgPSBWSVJUSU9f
REVWSUNFX0dFVF9DTEFTUyh2ZGV2KTsKICAgICBib29sIGhhc19pb21tdSA9IHZpcnRpb19ob3N0
X2hhc19mZWF0dXJlKHZkZXYsIFZJUlRJT19GX0lPTU1VX1BMQVRGT1JNKTsKLSAgICBFcnJvciAq
bG9jYWxfZXJyID0gTlVMTDsKIAogICAgIERQUklOVEYoIiVzOiBwbHVnIGRldmljZS5cbiIsIHFi
dXMtPm5hbWUpOwogCiAgICAgaWYgKGtsYXNzLT5wcmVfcGx1Z2dlZCAhPSBOVUxMKSB7Ci0gICAg
ICAgIGtsYXNzLT5wcmVfcGx1Z2dlZChxYnVzLT5wYXJlbnQsICZsb2NhbF9lcnIpOwotICAgICAg
ICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9j
YWxfZXJyKTsKKyAgICAgICAga2xhc3MtPnByZV9wbHVnZ2VkKHFidXMtPnBhcmVudCwgZXJycCk7
CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CiAg
ICAgfQpAQCAtNjMsMTcgKzYxLDE1IEBAIHZvaWQgdmlydGlvX2J1c19kZXZpY2VfcGx1Z2dlZChW
aXJ0SU9EZXZpY2UgKnZkZXYsIEVycm9yICoqZXJycCkKICAgICAvKiBHZXQgdGhlIGZlYXR1cmVz
IG9mIHRoZSBwbHVnZ2VkIGRldmljZS4gKi8KICAgICBhc3NlcnQodmRjLT5nZXRfZmVhdHVyZXMg
IT0gTlVMTCk7CiAgICAgdmRldi0+aG9zdF9mZWF0dXJlcyA9IHZkYy0+Z2V0X2ZlYXR1cmVzKHZk
ZXYsIHZkZXYtPmhvc3RfZmVhdHVyZXMsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAg
ZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICBy
ZXR1cm47CiAgICAgfQogCiAgICAgaWYgKGtsYXNzLT5kZXZpY2VfcGx1Z2dlZCAhPSBOVUxMKSB7
Ci0gICAgICAgIGtsYXNzLT5kZXZpY2VfcGx1Z2dlZChxYnVzLT5wYXJlbnQsICZsb2NhbF9lcnIp
OworICAgICAgICBrbGFzcy0+ZGV2aWNlX3BsdWdnZWQocWJ1cy0+cGFyZW50LCBlcnJwKTsKICAg
ICB9Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwg
bG9jYWxfZXJyKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApk
aWZmIC0tZ2l0IGEvaHcvdmlydGlvL3ZpcnRpby1ybmctcGNpLmMgYi9ody92aXJ0aW8vdmlydGlv
LXJuZy1wY2kuYwppbmRleCA4YWFmNTRiNzgxLi44OTc4YzBiYmUxIDEwMDY0NAotLS0gYS9ody92
aXJ0aW8vdmlydGlvLXJuZy1wY2kuYworKysgYi9ody92aXJ0aW8vdmlydGlvLXJuZy1wY2kuYwpA
QCAtMzQsMTIgKzM0LDEwIEBAIHN0YXRpYyB2b2lkIHZpcnRpb19ybmdfcGNpX3JlYWxpemUoVmly
dElPUENJUHJveHkgKnZwY2lfZGV2LCBFcnJvciAqKmVycnApCiB7CiAgICAgVmlydElPUm5nUENJ
ICp2cm5nID0gVklSVElPX1JOR19QQ0kodnBjaV9kZXYpOwogICAgIERldmljZVN0YXRlICp2ZGV2
ID0gREVWSUNFKCZ2cm5nLT52ZGV2KTsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKIAogICAgIHFk
ZXZfc2V0X3BhcmVudF9idXModmRldiwgQlVTKCZ2cGNpX2Rldi0+YnVzKSk7Ci0gICAgb2JqZWN0
X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCh2ZGV2KSwgdHJ1ZSwgInJlYWxpemVkIiwgJmVycik7
Ci0gICAgaWYgKGVycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAg
ICBvYmplY3RfcHJvcGVydHlfc2V0X2Jvb2woT0JKRUNUKHZkZXYpLCB0cnVlLCAicmVhbGl6ZWQi
LCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApkaWZm
IC0tZ2l0IGEvaHcvdmlydGlvL3ZpcnRpby1ybmcuYyBiL2h3L3ZpcnRpby92aXJ0aW8tcm5nLmMK
aW5kZXggZTkzYmVkMDIwZi4uYWViM2FhYzFmYSAxMDA2NDQKLS0tIGEvaHcvdmlydGlvL3ZpcnRp
by1ybmcuYworKysgYi9ody92aXJ0aW8vdmlydGlvLXJuZy5jCkBAIC0xNzYsNyArMTc2LDYgQEAg
c3RhdGljIHZvaWQgdmlydGlvX3JuZ19kZXZpY2VfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBF
cnJvciAqKmVycnApCiB7CiAgICAgVmlydElPRGV2aWNlICp2ZGV2ID0gVklSVElPX0RFVklDRShk
ZXYpOwogICAgIFZpcnRJT1JORyAqdnJuZyA9IFZJUlRJT19STkcoZGV2KTsKLSAgICBFcnJvciAq
bG9jYWxfZXJyID0gTlVMTDsKIAogICAgIGlmICh2cm5nLT5jb25mLnBlcmlvZF9tcyA8PSAwKSB7
CiAgICAgICAgIGVycm9yX3NldGcoZXJycCwgIidwZXJpb2QnIHBhcmFtZXRlciBleHBlY3RzIGEg
cG9zaXRpdmUgaW50ZWdlciIpOwpAQCAtMTk1LDkgKzE5NCw4IEBAIHN0YXRpYyB2b2lkIHZpcnRp
b19ybmdfZGV2aWNlX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogICAg
ICAgICBPYmplY3QgKmRlZmF1bHRfYmFja2VuZCA9IG9iamVjdF9uZXcoVFlQRV9STkdfQlVJTFRJ
Tik7CiAKICAgICAgICAgdXNlcl9jcmVhdGFibGVfY29tcGxldGUoVVNFUl9DUkVBVEFCTEUoZGVm
YXVsdF9iYWNrZW5kKSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJmxvY2FsX2Vy
cik7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0
ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJw
KTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICBvYmplY3RfdW5yZWYoZGVmYXVs
dF9iYWNrZW5kKTsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQpkaWZmIC0tZ2l0IGEv
aHcvdmlydGlvL3ZpcnRpby5jIGIvaHcvdmlydGlvL3ZpcnRpby5jCmluZGV4IDUyN2RmMDNiZmQu
Ljc1YWQyNWIxMjAgMTAwNjQ0Ci0tLSBhL2h3L3ZpcnRpby92aXJ0aW8uYworKysgYi9ody92aXJ0
aW8vdmlydGlvLmMKQEAgLTI2MDgsMjIgKzI2MDgsMTkgQEAgc3RhdGljIHZvaWQgdmlydGlvX2Rl
dmljZV9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKIHsKICAgICBWaXJ0
SU9EZXZpY2UgKnZkZXYgPSBWSVJUSU9fREVWSUNFKGRldik7CiAgICAgVmlydGlvRGV2aWNlQ2xh
c3MgKnZkYyA9IFZJUlRJT19ERVZJQ0VfR0VUX0NMQVNTKGRldik7Ci0gICAgRXJyb3IgKmVyciA9
IE5VTEw7CiAKICAgICAvKiBEZXZpY2VzIHNob3VsZCBlaXRoZXIgdXNlIHZtc2Qgb3IgdGhlIGxv
YWQvc2F2ZSBtZXRob2RzICovCiAgICAgYXNzZXJ0KCF2ZGMtPnZtc2QgfHwgIXZkYy0+bG9hZCk7
CiAKICAgICBpZiAodmRjLT5yZWFsaXplICE9IE5VTEwpIHsKLSAgICAgICAgdmRjLT5yZWFsaXpl
KGRldiwgJmVycik7Ci0gICAgICAgIGlmIChlcnIgIT0gTlVMTCkgewotICAgICAgICAgICAgZXJy
b3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgICAgIHZkYy0+cmVhbGl6ZShkZXYsIGVycnAp
OworICAgICAgICBpZiAoKmVycnAgIT0gTlVMTCkgewogICAgICAgICAgICAgcmV0dXJuOwogICAg
ICAgICB9CiAgICAgfQogCi0gICAgdmlydGlvX2J1c19kZXZpY2VfcGx1Z2dlZCh2ZGV2LCAmZXJy
KTsKLSAgICBpZiAoZXJyICE9IE5VTEwpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAs
IGVycik7CisgICAgdmlydGlvX2J1c19kZXZpY2VfcGx1Z2dlZCh2ZGV2LCBlcnJwKTsKKyAgICBp
ZiAoKmVycnAgIT0gTlVMTCkgewogICAgICAgICB2ZGMtPnVucmVhbGl6ZShkZXYsIE5VTEwpOwog
ICAgICAgICByZXR1cm47CiAgICAgfQpAQCAtMjYzNiwxNCArMjYzMywxMiBAQCBzdGF0aWMgdm9p
ZCB2aXJ0aW9fZGV2aWNlX3VucmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnAp
CiB7CiAgICAgVmlydElPRGV2aWNlICp2ZGV2ID0gVklSVElPX0RFVklDRShkZXYpOwogICAgIFZp
cnRpb0RldmljZUNsYXNzICp2ZGMgPSBWSVJUSU9fREVWSUNFX0dFVF9DTEFTUyhkZXYpOwotICAg
IEVycm9yICplcnIgPSBOVUxMOwogCiAgICAgdmlydGlvX2J1c19kZXZpY2VfdW5wbHVnZ2VkKHZk
ZXYpOwogCiAgICAgaWYgKHZkYy0+dW5yZWFsaXplICE9IE5VTEwpIHsKLSAgICAgICAgdmRjLT51
bnJlYWxpemUoZGV2LCAmZXJyKTsKLSAgICAgICAgaWYgKGVyciAhPSBOVUxMKSB7Ci0gICAgICAg
ICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgdmRjLT51bnJlYWxpemUo
ZGV2LCBlcnJwKTsKKyAgICAgICAgaWYgKCplcnJwICE9IE5VTEwpIHsKICAgICAgICAgICAgIHJl
dHVybjsKICAgICAgICAgfQogICAgIH0KZGlmZiAtLWdpdCBhL2h3L3dhdGNoZG9nL3dkdF9hc3Bl
ZWQuYyBiL2h3L3dhdGNoZG9nL3dkdF9hc3BlZWQuYwppbmRleCA5YjkzMjEzNDE3Li40M2IyNjJj
M2MwIDEwMDY0NAotLS0gYS9ody93YXRjaGRvZy93ZHRfYXNwZWVkLmMKKysrIGIvaHcvd2F0Y2hk
b2cvd2R0X2FzcGVlZC5jCkBAIC0yNDUsMTIgKzI0NSwxMCBAQCBzdGF0aWMgdm9pZCBhc3BlZWRf
d2R0X3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogewogICAgIFN5c0J1
c0RldmljZSAqc2JkID0gU1lTX0JVU19ERVZJQ0UoZGV2KTsKICAgICBBc3BlZWRXRFRTdGF0ZSAq
cyA9IEFTUEVFRF9XRFQoZGV2KTsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKICAgICBPYmplY3Qg
Km9iajsKIAotICAgIG9iaiA9IG9iamVjdF9wcm9wZXJ0eV9nZXRfbGluayhPQkpFQ1QoZGV2KSwg
InNjdSIsICZlcnIpOworICAgIG9iaiA9IG9iamVjdF9wcm9wZXJ0eV9nZXRfbGluayhPQkpFQ1Qo
ZGV2KSwgInNjdSIsIGVycnApOwogICAgIGlmICghb2JqKSB7Ci0gICAgICAgIGVycm9yX3Byb3Bh
Z2F0ZShlcnJwLCBlcnIpOwogICAgICAgICBlcnJvcl9wcmVwZW5kKGVycnAsICJyZXF1aXJlZCBs
aW5rICdzY3UnIG5vdCBmb3VuZDogIik7CiAgICAgICAgIHJldHVybjsKICAgICB9CmRpZmYgLS1n
aXQgYS9ody94ZW4veGVuLWJhY2tlbmQuYyBiL2h3L3hlbi94ZW4tYmFja2VuZC5jCmluZGV4IGRh
MDY1ZjgxYjcuLmU1NTUyMGY5N2MgMTAwNjQ0Ci0tLSBhL2h3L3hlbi94ZW4tYmFja2VuZC5jCisr
KyBiL2h3L3hlbi94ZW4tYmFja2VuZC5jCkBAIC0xMDAsNyArMTAwLDYgQEAgdm9pZCB4ZW5fYmFj
a2VuZF9kZXZpY2VfY3JlYXRlKFhlbkJ1cyAqeGVuYnVzLCBjb25zdCBjaGFyICp0eXBlLAogewog
ICAgIGNvbnN0IFhlbkJhY2tlbmRJbXBsICppbXBsID0geGVuX2JhY2tlbmRfdGFibGVfbG9va3Vw
KHR5cGUpOwogICAgIFhlbkJhY2tlbmRJbnN0YW5jZSAqYmFja2VuZDsKLSAgICBFcnJvciAqbG9j
YWxfZXJyb3IgPSBOVUxMOwogCiAgICAgaWYgKCFpbXBsKSB7CiAgICAgICAgIHJldHVybjsKQEAg
LTExMCw5ICsxMDksOCBAQCB2b2lkIHhlbl9iYWNrZW5kX2RldmljZV9jcmVhdGUoWGVuQnVzICp4
ZW5idXMsIGNvbnN0IGNoYXIgKnR5cGUsCiAgICAgYmFja2VuZC0+eGVuYnVzID0geGVuYnVzOwog
ICAgIGJhY2tlbmQtPm5hbWUgPSBnX3N0cmR1cChuYW1lKTsKIAotICAgIGltcGwtPmNyZWF0ZShi
YWNrZW5kLCBvcHRzLCAmbG9jYWxfZXJyb3IpOwotICAgIGlmIChsb2NhbF9lcnJvcikgewotICAg
ICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyb3IpOworICAgIGltcGwtPmNyZWF0
ZShiYWNrZW5kLCBvcHRzLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ19mcmVl
KGJhY2tlbmQtPm5hbWUpOwogICAgICAgICBnX2ZyZWUoYmFja2VuZCk7CiAgICAgICAgIHJldHVy
bjsKZGlmZiAtLWdpdCBhL2h3L3hlbi94ZW4tYnVzLmMgYi9ody94ZW4veGVuLWJ1cy5jCmluZGV4
IGEwNDQ3OGFkNGYuLjYzNjA0YWE2ZmMgMTAwNjQ0Ci0tLSBhL2h3L3hlbi94ZW4tYnVzLmMKKysr
IGIvaHcveGVuL3hlbi1idXMuYwpAQCAtNTUsNyArNTUsNiBAQCBzdGF0aWMgdm9pZCB4ZW5fZGV2
aWNlX3VucGx1ZyhYZW5EZXZpY2UgKnhlbmRldiwgRXJyb3IgKiplcnJwKQogewogICAgIFhlbkJ1
cyAqeGVuYnVzID0gWEVOX0JVUyhxZGV2X2dldF9wYXJlbnRfYnVzKERFVklDRSh4ZW5kZXYpKSk7
CiAgICAgY29uc3QgY2hhciAqdHlwZSA9IG9iamVjdF9nZXRfdHlwZW5hbWUoT0JKRUNUKHhlbmRl
dikpOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIHhzX3RyYW5zYWN0aW9uX3Qg
dGlkOwogCiAgICAgdHJhY2VfeGVuX2RldmljZV91bnBsdWcodHlwZSwgeGVuZGV2LT5uYW1lKTsK
QEAgLTY5LDE0ICs2OCwxNCBAQCBhZ2FpbjoKICAgICB9CiAKICAgICB4c19ub2RlX3ByaW50Zih4
ZW5idXMtPnhzaCwgdGlkLCB4ZW5kZXYtPmJhY2tlbmRfcGF0aCwgIm9ubGluZSIsCi0gICAgICAg
ICAgICAgICAgICAgJmxvY2FsX2VyciwgIiV1IiwgMCk7Ci0gICAgaWYgKGxvY2FsX2Vycikgewor
ICAgICAgICAgICAgICAgICAgIGVycnAsICIldSIsIDApOworICAgIGlmICgqZXJycCkgewogICAg
ICAgICBnb3RvIGFib3J0OwogICAgIH0KIAogICAgIHhzX25vZGVfcHJpbnRmKHhlbmJ1cy0+eHNo
LCB0aWQsIHhlbmRldi0+YmFja2VuZF9wYXRoLCAic3RhdGUiLAotICAgICAgICAgICAgICAgICAg
ICZsb2NhbF9lcnIsICIldSIsIFhlbmJ1c1N0YXRlQ2xvc2luZyk7Ci0gICAgaWYgKGxvY2FsX2Vy
cikgeworICAgICAgICAgICAgICAgICAgIGVycnAsICIldSIsIFhlbmJ1c1N0YXRlQ2xvc2luZyk7
CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8gYWJvcnQ7CiAgICAgfQogCkBAIC05Niw3
ICs5NSw2IEBAIGFib3J0OgogICAgICAqIGZyb20gZW5kaW5nIHRoZSB0cmFuc2FjdGlvbi4KICAg
ICAgKi8KICAgICB4c190cmFuc2FjdGlvbl9lbmQoeGVuYnVzLT54c2gsIHRpZCwgdHJ1ZSk7Ci0g
ICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CiB9CiAKIHN0YXRpYyB2b2lkIHhl
bl9idXNfcHJpbnRfZGV2KE1vbml0b3IgKm1vbiwgRGV2aWNlU3RhdGUgKmRldiwgaW50IGluZGVu
dCkKQEAgLTE2MiwxNiArMTYwLDEzIEBAIHN0YXRpYyBYZW5XYXRjaCAqeGVuX2J1c19hZGRfd2F0
Y2goWGVuQnVzICp4ZW5idXMsIGNvbnN0IGNoYXIgKm5vZGUsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHZvaWQgKm9wYXF1ZSwgRXJyb3IgKiplcnJwKQogewogICAgIFhlbldh
dGNoICp3YXRjaCA9IG5ld193YXRjaChub2RlLCBrZXksIGhhbmRsZXIsIG9wYXF1ZSk7Ci0gICAg
RXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICB0cmFjZV94ZW5fYnVzX2FkZF93YXRjaCh3
YXRjaC0+bm9kZSwgd2F0Y2gtPmtleSwgd2F0Y2gtPnRva2VuKTsKIAogICAgIG5vdGlmaWVyX2xp
c3RfYWRkKCZ4ZW5idXMtPndhdGNoX25vdGlmaWVycywgJndhdGNoLT5ub3RpZmllcik7CiAKLSAg
ICB4c19ub2RlX3dhdGNoKHhlbmJ1cy0+eHNoLCBub2RlLCBrZXksIHdhdGNoLT50b2tlbiwgJmxv
Y2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUo
ZXJycCwgbG9jYWxfZXJyKTsKLQorICAgIHhzX25vZGVfd2F0Y2goeGVuYnVzLT54c2gsIG5vZGUs
IGtleSwgd2F0Y2gtPnRva2VuLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgbm90
aWZpZXJfcmVtb3ZlKCZ3YXRjaC0+bm90aWZpZXIpOwogICAgICAgICBmcmVlX3dhdGNoKHdhdGNo
KTsKIApAQCAtMjAxLDcgKzE5Niw2IEBAIHN0YXRpYyB2b2lkIHhlbl9idXNfYmFja2VuZF9jcmVh
dGUoWGVuQnVzICp4ZW5idXMsIGNvbnN0IGNoYXIgKnR5cGUsCiAgICAgY2hhciAqKmtleTsKICAg
ICBRRGljdCAqb3B0czsKICAgICB1bnNpZ25lZCBpbnQgaSwgbjsKLSAgICBFcnJvciAqbG9jYWxf
ZXJyID0gTlVMTDsKIAogICAgIHRyYWNlX3hlbl9idXNfYmFja2VuZF9jcmVhdGUodHlwZSwgcGF0
aCk7CiAKQEAgLTI1NiwxMSArMjUwLDExIEBAIGFnYWluOgogICAgICAgICByZXR1cm47CiAgICAg
fQogCi0gICAgeGVuX2JhY2tlbmRfZGV2aWNlX2NyZWF0ZSh4ZW5idXMsIHR5cGUsIG5hbWUsIG9w
dHMsICZsb2NhbF9lcnIpOworICAgIHhlbl9iYWNrZW5kX2RldmljZV9jcmVhdGUoeGVuYnVzLCB0
eXBlLCBuYW1lLCBvcHRzLCBlcnJwKTsKICAgICBxb2JqZWN0X3VucmVmKG9wdHMpOwogCi0gICAg
aWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGVfcHJlcGVuZChlcnJwLCBs
b2NhbF9lcnIsCisgICAgaWYgKCplcnJwKSB7CisgICAgICAgIGVycm9yX3Byb3BhZ2F0ZV9wcmVw
ZW5kKGVycnAsICplcnJwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZmFpbGVk
IHRvIGNyZWF0ZSAnJXMnIGRldmljZSAnJXMnOiAiLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICB0eXBlLCBuYW1lKTsKICAgICB9CkBAIC0zNzMsNyArMzY3LDYgQEAgc3RhdGljIHZv
aWQgeGVuX2J1c19yZWFsaXplKEJ1c1N0YXRlICpidXMsIEVycm9yICoqZXJycCkKIHsKICAgICBY
ZW5CdXMgKnhlbmJ1cyA9IFhFTl9CVVMoYnVzKTsKICAgICB1bnNpZ25lZCBpbnQgZG9taWQ7Ci0g
ICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICB0cmFjZV94ZW5fYnVzX3JlYWxpemUo
KTsKIApAQCAtMzk4LDEwICszOTEsMTAgQEAgc3RhdGljIHZvaWQgeGVuX2J1c19yZWFsaXplKEJ1
c1N0YXRlICpidXMsIEVycm9yICoqZXJycCkKIAogICAgIHhlbmJ1cy0+YmFja2VuZF93YXRjaCA9
CiAgICAgICAgIHhlbl9idXNfYWRkX3dhdGNoKHhlbmJ1cywgIiIsIC8qIGRvbWFpbiByb290IG5v
ZGUgKi8KLSAgICAgICAgICAgICAgICAgICAgICAgICAgImJhY2tlbmQiLCB4ZW5fYnVzX2VudW1l
cmF0ZSwgeGVuYnVzLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7CisgICAgICAg
ICAgICAgICAgICAgICAgICAgICJiYWNrZW5kIiwgeGVuX2J1c19lbnVtZXJhdGUsIHhlbmJ1cywg
ZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIC8qIFRoaXMgbmVlZCBub3QgYmUgdHJl
YXRlZCBhcyBhIGhhcmQgZXJyb3Igc28gZG9uJ3QgcHJvcGFnYXRlICovCi0gICAgICAgIGVycm9y
X3JlcG9ydGZfZXJyKGxvY2FsX2VyciwKKyAgICAgICAgZXJyb3JfcmVwb3J0Zl9lcnIoKmVycnAs
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICJmYWlsZWQgdG8gc2V0IHVwIGVudW1lcmF0aW9u
IHdhdGNoOiAiKTsKICAgICB9CiAKQEAgLTU5MCw3ICs1ODMsNiBAQCBzdGF0aWMgdm9pZCB4ZW5f
ZGV2aWNlX2JhY2tlbmRfY3JlYXRlKFhlbkRldmljZSAqeGVuZGV2LCBFcnJvciAqKmVycnApCiB7
CiAgICAgWGVuQnVzICp4ZW5idXMgPSBYRU5fQlVTKHFkZXZfZ2V0X3BhcmVudF9idXMoREVWSUNF
KHhlbmRldikpKTsKICAgICBzdHJ1Y3QgeHNfcGVybWlzc2lvbnMgcGVybXNbMl07Ci0gICAgRXJy
b3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICB4ZW5kZXYtPmJhY2tlbmRfcGF0aCA9IHhlbl9k
ZXZpY2VfZ2V0X2JhY2tlbmRfcGF0aCh4ZW5kZXYpOwogCkBAIC02MDIsOSArNTk0LDkgQEAgc3Rh
dGljIHZvaWQgeGVuX2RldmljZV9iYWNrZW5kX2NyZWF0ZShYZW5EZXZpY2UgKnhlbmRldiwgRXJy
b3IgKiplcnJwKQogICAgIGdfYXNzZXJ0KHhlbmJ1cy0+eHNoKTsKIAogICAgIHhzX25vZGVfY3Jl
YXRlKHhlbmJ1cy0+eHNoLCBYQlRfTlVMTCwgeGVuZGV2LT5iYWNrZW5kX3BhdGgsIHBlcm1zLAot
ICAgICAgICAgICAgICAgICAgIEFSUkFZX1NJWkUocGVybXMpLCAmbG9jYWxfZXJyKTsKLSAgICBp
ZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZV9wcmVwZW5kKGVycnAsIGxv
Y2FsX2VyciwKKyAgICAgICAgICAgICAgICAgICBBUlJBWV9TSVpFKHBlcm1zKSwgZXJycCk7Cisg
ICAgaWYgKCplcnJwKSB7CisgICAgICAgIGVycm9yX3Byb3BhZ2F0ZV9wcmVwZW5kKGVycnAsICpl
cnJwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZmFpbGVkIHRvIGNyZWF0ZSBi
YWNrZW5kOiAiKTsKICAgICAgICAgcmV0dXJuOwogICAgIH0KQEAgLTYxMiw5ICs2MDQsOSBAQCBz
dGF0aWMgdm9pZCB4ZW5fZGV2aWNlX2JhY2tlbmRfY3JlYXRlKFhlbkRldmljZSAqeGVuZGV2LCBF
cnJvciAqKmVycnApCiAgICAgeGVuZGV2LT5iYWNrZW5kX3N0YXRlX3dhdGNoID0KICAgICAgICAg
eGVuX2J1c19hZGRfd2F0Y2goeGVuYnVzLCB4ZW5kZXYtPmJhY2tlbmRfcGF0aCwKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgInN0YXRlIiwgeGVuX2RldmljZV9iYWNrZW5kX2NoYW5nZWQsCi0g
ICAgICAgICAgICAgICAgICAgICAgICAgIHhlbmRldiwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxv
Y2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGVfcHJlcGVuZChlcnJwLCBsb2NhbF9l
cnIsCisgICAgICAgICAgICAgICAgICAgICAgICAgIHhlbmRldiwgZXJycCk7CisgICAgaWYgKCpl
cnJwKSB7CisgICAgICAgIGVycm9yX3Byb3BhZ2F0ZV9wcmVwZW5kKGVycnAsICplcnJwLAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZmFpbGVkIHRvIHdhdGNoIGJhY2tlbmQgc3Rh
dGU6ICIpOwogICAgICAgICByZXR1cm47CiAgICAgfQpAQCAtNjIyLDkgKzYxNCw5IEBAIHN0YXRp
YyB2b2lkIHhlbl9kZXZpY2VfYmFja2VuZF9jcmVhdGUoWGVuRGV2aWNlICp4ZW5kZXYsIEVycm9y
ICoqZXJycCkKICAgICB4ZW5kZXYtPmJhY2tlbmRfb25saW5lX3dhdGNoID0KICAgICAgICAgeGVu
X2J1c19hZGRfd2F0Y2goeGVuYnVzLCB4ZW5kZXYtPmJhY2tlbmRfcGF0aCwKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIm9ubGluZSIsIHhlbl9kZXZpY2VfYmFja2VuZF9jaGFuZ2VkLAotICAg
ICAgICAgICAgICAgICAgICAgICAgICB4ZW5kZXYsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2Nh
bF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlX3ByZXBlbmQoZXJycCwgbG9jYWxfZXJy
LAorICAgICAgICAgICAgICAgICAgICAgICAgICB4ZW5kZXYsIGVycnApOworICAgIGlmICgqZXJy
cCkgeworICAgICAgICBlcnJvcl9wcm9wYWdhdGVfcHJlcGVuZChlcnJwLCAqZXJycCwKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgImZhaWxlZCB0byB3YXRjaCBiYWNrZW5kIG9ubGlu
ZTogIik7CiAgICAgICAgIHJldHVybjsKICAgICB9CkBAIC03NTcsNyArNzQ5LDYgQEAgc3RhdGlj
IHZvaWQgeGVuX2RldmljZV9mcm9udGVuZF9jcmVhdGUoWGVuRGV2aWNlICp4ZW5kZXYsIEVycm9y
ICoqZXJycCkKIHsKICAgICBYZW5CdXMgKnhlbmJ1cyA9IFhFTl9CVVMocWRldl9nZXRfcGFyZW50
X2J1cyhERVZJQ0UoeGVuZGV2KSkpOwogICAgIHN0cnVjdCB4c19wZXJtaXNzaW9ucyBwZXJtc1sy
XTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAogICAgIHhlbmRldi0+ZnJvbnRlbmRf
cGF0aCA9IHhlbl9kZXZpY2VfZ2V0X2Zyb250ZW5kX3BhdGgoeGVuZGV2KTsKIApAQCAtNzY5LDE4
ICs3NjAsMTggQEAgc3RhdGljIHZvaWQgeGVuX2RldmljZV9mcm9udGVuZF9jcmVhdGUoWGVuRGV2
aWNlICp4ZW5kZXYsIEVycm9yICoqZXJycCkKICAgICBnX2Fzc2VydCh4ZW5idXMtPnhzaCk7CiAK
ICAgICB4c19ub2RlX2NyZWF0ZSh4ZW5idXMtPnhzaCwgWEJUX05VTEwsIHhlbmRldi0+ZnJvbnRl
bmRfcGF0aCwgcGVybXMsCi0gICAgICAgICAgICAgICAgICAgQVJSQVlfU0laRShwZXJtcyksICZs
b2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRl
X3ByZXBlbmQoZXJycCwgbG9jYWxfZXJyLAorICAgICAgICAgICAgICAgICAgIEFSUkFZX1NJWkUo
cGVybXMpLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKKyAgICAgICAgZXJyb3JfcHJvcGFnYXRl
X3ByZXBlbmQoZXJycCwgKmVycnAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJm
YWlsZWQgdG8gY3JlYXRlIGZyb250ZW5kOiAiKTsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIAog
ICAgIHhlbmRldi0+ZnJvbnRlbmRfc3RhdGVfd2F0Y2ggPQogICAgICAgICB4ZW5fYnVzX2FkZF93
YXRjaCh4ZW5idXMsIHhlbmRldi0+ZnJvbnRlbmRfcGF0aCwgInN0YXRlIiwKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgeGVuX2RldmljZV9mcm9udGVuZF9jaGFuZ2VkLCB4ZW5kZXYsICZsb2Nh
bF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlX3By
ZXBlbmQoZXJycCwgbG9jYWxfZXJyLAorICAgICAgICAgICAgICAgICAgICAgICAgICB4ZW5fZGV2
aWNlX2Zyb250ZW5kX2NoYW5nZWQsIHhlbmRldiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7Cisg
ICAgICAgIGVycm9yX3Byb3BhZ2F0ZV9wcmVwZW5kKGVycnAsICplcnJwLAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAiZmFpbGVkIHRvIHdhdGNoIGZyb250ZW5kIHN0YXRlOiAiKTsK
ICAgICB9CiB9CkBAIC0xMTA0LDcgKzEwOTUsNiBAQCBzdGF0aWMgdm9pZCB4ZW5fZGV2aWNlX3Jl
YWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogICAgIFhlbkRldmljZUNsYXNz
ICp4ZW5kZXZfY2xhc3MgPSBYRU5fREVWSUNFX0dFVF9DTEFTUyh4ZW5kZXYpOwogICAgIFhlbkJ1
cyAqeGVuYnVzID0gWEVOX0JVUyhxZGV2X2dldF9wYXJlbnRfYnVzKERFVklDRSh4ZW5kZXYpKSk7
CiAgICAgY29uc3QgY2hhciAqdHlwZSA9IG9iamVjdF9nZXRfdHlwZW5hbWUoT0JKRUNUKHhlbmRl
dikpOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgaWYgKHhlbmRldi0+ZnJv
bnRlbmRfaWQgPT0gRE9NSURfSU5WQUxJRCkgewogICAgICAgICB4ZW5kZXYtPmZyb250ZW5kX2lk
ID0geGVuX2RvbWlkOwpAQCAtMTEyMCw5ICsxMTEwLDkgQEAgc3RhdGljIHZvaWQgeGVuX2Rldmlj
ZV9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAgICAgICAgZ290byB1
bnJlYWxpemU7CiAgICAgfQogCi0gICAgeGVuZGV2LT5uYW1lID0geGVuZGV2X2NsYXNzLT5nZXRf
bmFtZSh4ZW5kZXYsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAg
ZXJyb3JfcHJvcGFnYXRlX3ByZXBlbmQoZXJycCwgbG9jYWxfZXJyLAorICAgIHhlbmRldi0+bmFt
ZSA9IHhlbmRldl9jbGFzcy0+Z2V0X25hbWUoeGVuZGV2LCBlcnJwKTsKKyAgICBpZiAoKmVycnAp
IHsKKyAgICAgICAgZXJyb3JfcHJvcGFnYXRlX3ByZXBlbmQoZXJycCwgKmVycnAsCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICJmYWlsZWQgdG8gZ2V0IGRldmljZSBuYW1lOiAiKTsK
ICAgICAgICAgZ290byB1bnJlYWxpemU7CiAgICAgfQpAQCAtMTEzOCwyMiArMTEyOCwxOSBAQCBz
dGF0aWMgdm9pZCB4ZW5fZGV2aWNlX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKipl
cnJwKQogICAgIHhlbmRldi0+ZmVhdHVyZV9ncmFudF9jb3B5ID0KICAgICAgICAgKHhlbmdudHRh
Yl9ncmFudF9jb3B5KHhlbmRldi0+eGd0aCwgMCwgTlVMTCkgPT0gMCk7CiAKLSAgICB4ZW5fZGV2
aWNlX2JhY2tlbmRfY3JlYXRlKHhlbmRldiwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2Vy
cikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICB4ZW5f
ZGV2aWNlX2JhY2tlbmRfY3JlYXRlKHhlbmRldiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAg
ICAgICAgIGdvdG8gdW5yZWFsaXplOwogICAgIH0KIAotICAgIHhlbl9kZXZpY2VfZnJvbnRlbmRf
Y3JlYXRlKHhlbmRldiwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAg
ICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICB4ZW5fZGV2aWNlX2Zyb250
ZW5kX2NyZWF0ZSh4ZW5kZXYsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICBnb3Rv
IHVucmVhbGl6ZTsKICAgICB9CiAKICAgICBpZiAoeGVuZGV2X2NsYXNzLT5yZWFsaXplKSB7Ci0g
ICAgICAgIHhlbmRldl9jbGFzcy0+cmVhbGl6ZSh4ZW5kZXYsICZsb2NhbF9lcnIpOwotICAgICAg
ICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9j
YWxfZXJyKTsKKyAgICAgICAgeGVuZGV2X2NsYXNzLT5yZWFsaXplKHhlbmRldiwgZXJycCk7Cisg
ICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgZ290byB1bnJlYWxpemU7CiAgICAgICAg
IH0KICAgICB9CmRpZmYgLS1naXQgYS9ody94ZW4veGVuLWhvc3QtcGNpLWRldmljZS5jIGIvaHcv
eGVuL3hlbi1ob3N0LXBjaS1kZXZpY2UuYwppbmRleCAxYjQ0ZGNhZmFmLi42YmI2NWJmNTY3IDEw
MDY0NAotLS0gYS9ody94ZW4veGVuLWhvc3QtcGNpLWRldmljZS5jCisrKyBiL2h3L3hlbi94ZW4t
aG9zdC1wY2ktZGV2aWNlLmMKQEAgLTMzNCw3ICszMzQsNiBAQCB2b2lkIHhlbl9ob3N0X3BjaV9k
ZXZpY2VfZ2V0KFhlbkhvc3RQQ0lEZXZpY2UgKmQsIHVpbnQxNl90IGRvbWFpbiwKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJwKQogewogICAgIHVuc2lnbmVkIGludCB2
OwotICAgIEVycm9yICplcnIgPSBOVUxMOwogCiAgICAgZC0+Y29uZmlnX2ZkID0gLTE7CiAgICAg
ZC0+ZG9tYWluID0gZG9tYWluOwpAQCAtMzQyLDM2ICszNDEsMzYgQEAgdm9pZCB4ZW5faG9zdF9w
Y2lfZGV2aWNlX2dldChYZW5Ib3N0UENJRGV2aWNlICpkLCB1aW50MTZfdCBkb21haW4sCiAgICAg
ZC0+ZGV2ID0gZGV2OwogICAgIGQtPmZ1bmMgPSBmdW5jOwogCi0gICAgeGVuX2hvc3RfcGNpX2Nv
bmZpZ19vcGVuKGQsICZlcnIpOwotICAgIGlmIChlcnIpIHsKKyAgICB4ZW5faG9zdF9wY2lfY29u
ZmlnX29wZW4oZCwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8gZXJyb3I7
CiAgICAgfQogCi0gICAgeGVuX2hvc3RfcGNpX2dldF9yZXNvdXJjZShkLCAmZXJyKTsKLSAgICBp
ZiAoZXJyKSB7CisgICAgeGVuX2hvc3RfcGNpX2dldF9yZXNvdXJjZShkLCBlcnJwKTsKKyAgICBp
ZiAoKmVycnApIHsKICAgICAgICAgZ290byBlcnJvcjsKICAgICB9CiAKLSAgICB4ZW5faG9zdF9w
Y2lfZ2V0X2hleF92YWx1ZShkLCAidmVuZG9yIiwgJnYsICZlcnIpOwotICAgIGlmIChlcnIpIHsK
KyAgICB4ZW5faG9zdF9wY2lfZ2V0X2hleF92YWx1ZShkLCAidmVuZG9yIiwgJnYsIGVycnApOwor
ICAgIGlmICgqZXJycCkgewogICAgICAgICBnb3RvIGVycm9yOwogICAgIH0KICAgICBkLT52ZW5k
b3JfaWQgPSB2OwogCi0gICAgeGVuX2hvc3RfcGNpX2dldF9oZXhfdmFsdWUoZCwgImRldmljZSIs
ICZ2LCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7CisgICAgeGVuX2hvc3RfcGNpX2dldF9oZXhfdmFs
dWUoZCwgImRldmljZSIsICZ2LCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ290
byBlcnJvcjsKICAgICB9CiAgICAgZC0+ZGV2aWNlX2lkID0gdjsKIAotICAgIHhlbl9ob3N0X3Bj
aV9nZXRfZGVjX3ZhbHVlKGQsICJpcnEiLCAmdiwgJmVycik7Ci0gICAgaWYgKGVycikgeworICAg
IHhlbl9ob3N0X3BjaV9nZXRfZGVjX3ZhbHVlKGQsICJpcnEiLCAmdiwgZXJycCk7CisgICAgaWYg
KCplcnJwKSB7CiAgICAgICAgIGdvdG8gZXJyb3I7CiAgICAgfQogICAgIGQtPmlycSA9IHY7CiAK
LSAgICB4ZW5faG9zdF9wY2lfZ2V0X2hleF92YWx1ZShkLCAiY2xhc3MiLCAmdiwgJmVycik7Ci0g
ICAgaWYgKGVycikgeworICAgIHhlbl9ob3N0X3BjaV9nZXRfaGV4X3ZhbHVlKGQsICJjbGFzcyIs
ICZ2LCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ290byBlcnJvcjsKICAgICB9
CiAgICAgZC0+Y2xhc3NfY29kZSA9IHY7CkBAIC0zODEsNyArMzgwLDYgQEAgdm9pZCB4ZW5faG9z
dF9wY2lfZGV2aWNlX2dldChYZW5Ib3N0UENJRGV2aWNlICpkLCB1aW50MTZfdCBkb21haW4sCiAg
ICAgcmV0dXJuOwogCiBlcnJvcjoKLSAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKIAog
ICAgIGlmIChkLT5jb25maWdfZmQgPj0gMCkgewogICAgICAgICBjbG9zZShkLT5jb25maWdfZmQp
OwpkaWZmIC0tZ2l0IGEvaHcveGVuL3hlbl9wdC5jIGIvaHcveGVuL3hlbl9wdC5jCmluZGV4IDhm
YmFmMmVhZTkuLjhkNGNmNzI5MWYgMTAwNjQ0Ci0tLSBhL2h3L3hlbi94ZW5fcHQuYworKysgYi9o
dy94ZW4veGVuX3B0LmMKQEAgLTc3MCw3ICs3NzAsNiBAQCBzdGF0aWMgdm9pZCB4ZW5fcHRfcmVh
bGl6ZShQQ0lEZXZpY2UgKmQsIEVycm9yICoqZXJycCkKICAgICB1aW50OF90IG1hY2hpbmVfaXJx
ID0gMCwgc2NyYXRjaDsKICAgICB1aW50MTZfdCBjbWQgPSAwOwogICAgIGludCBwaXJxID0gWEVO
X1BUX1VOQVNTSUdORURfUElSUTsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKIAogICAgIC8qIHJl
Z2lzdGVyIHJlYWwgZGV2aWNlICovCiAgICAgWEVOX1BUX0xPRyhkLCAiQXNzaWduaW5nIHJlYWwg
cGh5c2ljYWwgZGV2aWNlICUwMng6JTAyeC4lZCIKQEAgLTc4MSwxMCArNzgwLDkgQEAgc3RhdGlj
IHZvaWQgeGVuX3B0X3JlYWxpemUoUENJRGV2aWNlICpkLCBFcnJvciAqKmVycnApCiAgICAgeGVu
X2hvc3RfcGNpX2RldmljZV9nZXQoJnMtPnJlYWxfZGV2aWNlLAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHMtPmhvc3RhZGRyLmRvbWFpbiwgcy0+aG9zdGFkZHIuYnVzLAogICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHMtPmhvc3RhZGRyLnNsb3QsIHMtPmhvc3RhZGRyLmZ1bmN0aW9u
LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICZlcnIpOwotICAgIGlmIChlcnIpIHsKLSAg
ICAgICAgZXJyb3JfYXBwZW5kX2hpbnQoJmVyciwgIkZhaWxlZCB0byBcIm9wZW5cIiB0aGUgcmVh
bCBwY2kgZGV2aWNlIik7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGVycnApOworICAgIGlmICgqZXJycCkgeworICAgICAg
ICBlcnJvcl9hcHBlbmRfaGludChlcnJwLCAiRmFpbGVkIHRvIFwib3BlblwiIHRoZSByZWFsIHBj
aSBkZXZpY2UiKTsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApAQCAtODExLDExICs4MDksMTAg
QEAgc3RhdGljIHZvaWQgeGVuX3B0X3JlYWxpemUoUENJRGV2aWNlICpkLCBFcnJvciAqKmVycnAp
CiAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgIH0KIAotICAgICAgICB4ZW5fcHRfc2V0dXBf
dmdhKHMsICZzLT5yZWFsX2RldmljZSwgJmVycik7Ci0gICAgICAgIGlmIChlcnIpIHsKLSAgICAg
ICAgICAgIGVycm9yX2FwcGVuZF9oaW50KCZlcnIsICJTZXR1cCBWR0EgQklPUyBvZiBwYXNzdGhy
b3VnaCIKLSAgICAgICAgICAgICAgICAgICAgIiBHRlggZmFpbGVkIik7Ci0gICAgICAgICAgICBl
cnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgeGVuX3B0X3NldHVwX3ZnYShzLCAm
cy0+cmVhbF9kZXZpY2UsIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKKyAgICAgICAgICAg
IGVycm9yX2FwcGVuZF9oaW50KGVycnAsICJTZXR1cCBWR0EgQklPUyBvZiBwYXNzdGhyb3VnaCIK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIgR0ZYIGZhaWxlZCIpOwogICAgICAgICAg
ICAgeGVuX2hvc3RfcGNpX2RldmljZV9wdXQoJnMtPnJlYWxfZGV2aWNlKTsKICAgICAgICAgICAg
IHJldHVybjsKICAgICAgICAgfQpAQCAtODI4LDEwICs4MjUsOSBAQCBzdGF0aWMgdm9pZCB4ZW5f
cHRfcmVhbGl6ZShQQ0lEZXZpY2UgKmQsIEVycm9yICoqZXJycCkKICAgICB4ZW5fcHRfcmVnaXN0
ZXJfcmVnaW9ucyhzLCAmY21kKTsKIAogICAgIC8qIHJlaW5pdGlhbGl6ZSBlYWNoIGNvbmZpZyBy
ZWdpc3RlciB0byBiZSBlbXVsYXRlZCAqLwotICAgIHhlbl9wdF9jb25maWdfaW5pdChzLCAmZXJy
KTsKLSAgICBpZiAoZXJyKSB7Ci0gICAgICAgIGVycm9yX2FwcGVuZF9oaW50KCZlcnIsICJQQ0kg
Q29uZmlnIHNwYWNlIGluaXRpYWxpc2F0aW9uIGZhaWxlZCIpOwotICAgICAgICBlcnJvcl9wcm9w
YWdhdGUoZXJycCwgZXJyKTsKKyAgICB4ZW5fcHRfY29uZmlnX2luaXQocywgZXJycCk7CisgICAg
aWYgKCplcnJwKSB7CisgICAgICAgIGVycm9yX2FwcGVuZF9oaW50KGVycnAsICJQQ0kgQ29uZmln
IHNwYWNlIGluaXRpYWxpc2F0aW9uIGZhaWxlZCIpOwogICAgICAgICByYyA9IC0xOwogICAgICAg
ICBnb3RvIGVycl9vdXQ7CiAgICAgfQpkaWZmIC0tZ2l0IGEvaHcveGVuL3hlbl9wdF9jb25maWdf
aW5pdC5jIGIvaHcveGVuL3hlbl9wdF9jb25maWdfaW5pdC5jCmluZGV4IDMxZWM1YWRkMWQuLmJj
MWZlYWNjM2MgMTAwNjQ0Ci0tLSBhL2h3L3hlbi94ZW5fcHRfY29uZmlnX2luaXQuYworKysgYi9o
dy94ZW4veGVuX3B0X2NvbmZpZ19pbml0LmMKQEAgLTIwMDksNyArMjAwOSw2IEBAIHN0YXRpYyB2
b2lkIHhlbl9wdF9jb25maWdfcmVnX2luaXQoWGVuUENJUGFzc3Rocm91Z2hTdGF0ZSAqcywKIHZv
aWQgeGVuX3B0X2NvbmZpZ19pbml0KFhlblBDSVBhc3N0aHJvdWdoU3RhdGUgKnMsIEVycm9yICoq
ZXJycCkKIHsKICAgICBpbnQgaSwgcmM7Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7CiAKICAgICBR
TElTVF9JTklUKCZzLT5yZWdfZ3Jwcyk7CiAKQEAgLTIwNTIsMTAgKzIwNTEsOSBAQCB2b2lkIHhl
bl9wdF9jb25maWdfaW5pdChYZW5QQ0lQYXNzdGhyb3VnaFN0YXRlICpzLCBFcnJvciAqKmVycnAp
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ19n
cnBfb2Zmc2V0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAmcmVnX2dycF9lbnRyeS0+c2l6ZSk7CiAgICAgICAgICAgICBpZiAocmMgPCAwKSB7Ci0g
ICAgICAgICAgICAgICAgZXJyb3Jfc2V0ZygmZXJyLCAiRmFpbGVkIHRvIGluaXRpYWxpemUgJWQv
JXp1LCB0eXBlID0gMHgleCwiCisgICAgICAgICAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAiRmFp
bGVkIHRvIGluaXRpYWxpemUgJWQvJXp1LCB0eXBlID0gMHgleCwiCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAiIHJjOiAlZCIsIGksIEFSUkFZX1NJWkUoeGVuX3B0X2VtdV9yZWdfZ3Jwcyks
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4ZW5fcHRfZW11X3JlZ19ncnBzW2ldLmdycF90
eXBlLCByYyk7Ci0gICAgICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CiAg
ICAgICAgICAgICAgICAgeGVuX3B0X2NvbmZpZ19kZWxldGUocyk7CiAgICAgICAgICAgICAgICAg
cmV0dXJuOwogICAgICAgICAgICAgfQpAQCAtMjA2OCwxMyArMjA2NiwxNCBAQCB2b2lkIHhlbl9w
dF9jb25maWdfaW5pdChYZW5QQ0lQYXNzdGhyb3VnaFN0YXRlICpzLCBFcnJvciAqKmVycnApCiAK
ICAgICAgICAgICAgICAgICAvKiBpbml0aWFsaXplIGNhcGFiaWxpdHkgcmVnaXN0ZXIgKi8KICAg
ICAgICAgICAgICAgICBmb3IgKGogPSAwOyByZWdzLT5zaXplICE9IDA7IGorKywgcmVncysrKSB7
Ci0gICAgICAgICAgICAgICAgICAgIHhlbl9wdF9jb25maWdfcmVnX2luaXQocywgcmVnX2dycF9l
bnRyeSwgcmVncywgJmVycik7Ci0gICAgICAgICAgICAgICAgICAgIGlmIChlcnIpIHsKLSAgICAg
ICAgICAgICAgICAgICAgICAgIGVycm9yX2FwcGVuZF9oaW50KCZlcnIsICJGYWlsZWQgdG8gaW5p
dCByZWdpc3RlciAlZCIKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiBvZmZzZXRz
IDB4JXggaW4gZ3JwX3R5cGUgPSAweCV4ICglZC8lenUpIiwgaiwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgcmVncy0+b2Zmc2V0LCB4ZW5fcHRfZW11X3JlZ19ncnBzW2ldLmdycF90
eXBlLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLCBBUlJBWV9TSVpFKHhlbl9w
dF9lbXVfcmVnX2dycHMpKTsKLSAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0
ZShlcnJwLCBlcnIpOworICAgICAgICAgICAgICAgICAgICB4ZW5fcHRfY29uZmlnX3JlZ19pbml0
KHMsIHJlZ19ncnBfZW50cnksIHJlZ3MsIGVycnApOworICAgICAgICAgICAgICAgICAgICBpZiAo
KmVycnApIHsKKyAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yX2FwcGVuZF9oaW50KGVycnAs
ICJGYWlsZWQgdG8gaW5pdCByZWdpc3RlciAlZCIKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICIgb2Zmc2V0cyAweCV4IGluIGdycF90eXBlID0gMHgleCAoJWQvJXp1
KSIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVncy0+b2Zmc2V0LAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeGVuX3B0X2VtdV9yZWdfZ3Jwc1tp
XS5ncnBfdHlwZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGks
IEFSUkFZX1NJWkUoeGVuX3B0X2VtdV9yZWdfZ3JwcykpOwogICAgICAgICAgICAgICAgICAgICAg
ICAgeGVuX3B0X2NvbmZpZ19kZWxldGUocyk7CiAgICAgICAgICAgICAgICAgICAgICAgICByZXR1
cm47CiAgICAgICAgICAgICAgICAgICAgIH0KZGlmZiAtLWdpdCBhL2lvL2Rucy1yZXNvbHZlci5j
IGIvaW8vZG5zLXJlc29sdmVyLmMKaW5kZXggNmViZTJhNTY1MC4uMWFhYjVjZmVmMiAxMDA2NDQK
LS0tIGEvaW8vZG5zLXJlc29sdmVyLmMKKysrIGIvaW8vZG5zLXJlc29sdmVyLmMKQEAgLTU4LDcg
KzU4LDYgQEAgc3RhdGljIGludCBxaW9fZG5zX3Jlc29sdmVyX2xvb2t1cF9zeW5jX2luZXQoUUlP
RE5TUmVzb2x2ZXIgKnJlc29sdmVyLAogICAgIGNoYXIgdWFkZHJbSU5FVDZfQUREUlNUUkxFTiAr
IDFdOwogICAgIGNoYXIgdXBvcnRbMzNdOwogICAgIGludCByYzsKLSAgICBFcnJvciAqZXJyID0g
TlVMTDsKICAgICBzaXplX3QgaTsKIAogICAgICpuYWRkcnMgPSAwOwpAQCAtNjksMTEgKzY4LDEw
IEBAIHN0YXRpYyBpbnQgcWlvX2Ruc19yZXNvbHZlcl9sb29rdXBfc3luY19pbmV0KFFJT0ROU1Jl
c29sdmVyICpyZXNvbHZlciwKICAgICBpZiAoaWFkZHItPmhhc19udW1lcmljICYmIGlhZGRyLT5u
dW1lcmljKSB7CiAgICAgICAgIGFpLmFpX2ZsYWdzIHw9IEFJX05VTUVSSUNIT1NUIHwgQUlfTlVN
RVJJQ1NFUlY7CiAgICAgfQotICAgIGFpLmFpX2ZhbWlseSA9IGluZXRfYWlfZmFtaWx5X2Zyb21f
YWRkcmVzcyhpYWRkciwgJmVycik7CisgICAgYWkuYWlfZmFtaWx5ID0gaW5ldF9haV9mYW1pbHlf
ZnJvbV9hZGRyZXNzKGlhZGRyLCBlcnJwKTsKICAgICBhaS5haV9zb2NrdHlwZSA9IFNPQ0tfU1RS
RUFNOwogCi0gICAgaWYgKGVycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJy
KTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuIC0xOwogICAgIH0KIApkaWZmIC0t
Z2l0IGEvaW8vbmV0LWxpc3RlbmVyLmMgYi9pby9uZXQtbGlzdGVuZXIuYwppbmRleCA1ZDhhMjI2
ODcyLi43M2E4YTcxNDQ5IDEwMDY0NAotLS0gYS9pby9uZXQtbGlzdGVuZXIuYworKysgYi9pby9u
ZXQtbGlzdGVuZXIuYwpAQCAtNjksNyArNjksNiBAQCBpbnQgcWlvX25ldF9saXN0ZW5lcl9vcGVu
X3N5bmMoUUlPTmV0TGlzdGVuZXIgKmxpc3RlbmVyLAogICAgIFNvY2tldEFkZHJlc3MgKipyZXNh
ZGRyczsKICAgICBzaXplX3QgbnJlc2FkZHJzOwogICAgIHNpemVfdCBpOwotICAgIEVycm9yICpl
cnIgPSBOVUxMOwogICAgIGJvb2wgc3VjY2VzcyA9IGZhbHNlOwogCiAgICAgaWYgKHFpb19kbnNf
cmVzb2x2ZXJfbG9va3VwX3N5bmMocmVzb2x2ZXIsCkBAIC04NCw3ICs4Myw3IEBAIGludCBxaW9f
bmV0X2xpc3RlbmVyX29wZW5fc3luYyhRSU9OZXRMaXN0ZW5lciAqbGlzdGVuZXIsCiAgICAgICAg
IFFJT0NoYW5uZWxTb2NrZXQgKnNpb2MgPSBxaW9fY2hhbm5lbF9zb2NrZXRfbmV3KCk7CiAKICAg
ICAgICAgaWYgKHFpb19jaGFubmVsX3NvY2tldF9saXN0ZW5fc3luYyhzaW9jLCByZXNhZGRyc1tp
XSwgbnVtLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVyciA/
IE5VTEwgOiAmZXJyKSA9PSAwKSB7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgKmVycnAgPyBOVUxMIDogZXJycCkgPT0gMCkgewogICAgICAgICAgICAgc3VjY2Vz
cyA9IHRydWU7CiAKICAgICAgICAgICAgIHFpb19uZXRfbGlzdGVuZXJfYWRkKGxpc3RlbmVyLCBz
aW9jKTsKQEAgLTk2LDEwICs5NSw5IEBAIGludCBxaW9fbmV0X2xpc3RlbmVyX29wZW5fc3luYyhR
SU9OZXRMaXN0ZW5lciAqbGlzdGVuZXIsCiAgICAgZ19mcmVlKHJlc2FkZHJzKTsKIAogICAgIGlm
IChzdWNjZXNzKSB7Ci0gICAgICAgIGVycm9yX2ZyZWUoZXJyKTsKKyAgICAgICAgZXJyb3JfZnJl
ZV9lcnJwKGVycnApOwogICAgICAgICByZXR1cm4gMDsKICAgICB9IGVsc2UgewotICAgICAgICBl
cnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKICAgICAgICAgcmV0dXJuIC0xOwogICAgIH0KIH0K
ZGlmZiAtLWdpdCBhL2lvdGhyZWFkLmMgYi9pb3RocmVhZC5jCmluZGV4IDcxMzBiZTU4ZTMuLmI5
NzdlNWMxYjAgMTAwNjQ0Ci0tLSBhL2lvdGhyZWFkLmMKKysrIGIvaW90aHJlYWQuYwpAQCAtMTYz
LDE1ICsxNjMsMTMgQEAgc3RhdGljIHZvaWQgaW90aHJlYWRfaW5pdF9nY29udGV4dChJT1RocmVh
ZCAqaW90aHJlYWQpCiAKIHN0YXRpYyB2b2lkIGlvdGhyZWFkX2NvbXBsZXRlKFVzZXJDcmVhdGFi
bGUgKm9iaiwgRXJyb3IgKiplcnJwKQogewotICAgIEVycm9yICpsb2NhbF9lcnJvciA9IE5VTEw7
CiAgICAgSU9UaHJlYWQgKmlvdGhyZWFkID0gSU9USFJFQUQob2JqKTsKICAgICBjaGFyICpuYW1l
LCAqdGhyZWFkX25hbWU7CiAKICAgICBpb3RocmVhZC0+c3RvcHBpbmcgPSBmYWxzZTsKICAgICBp
b3RocmVhZC0+cnVubmluZyA9IHRydWU7Ci0gICAgaW90aHJlYWQtPmN0eCA9IGFpb19jb250ZXh0
X25ldygmbG9jYWxfZXJyb3IpOworICAgIGlvdGhyZWFkLT5jdHggPSBhaW9fY29udGV4dF9uZXco
ZXJycCk7CiAgICAgaWYgKCFpb3RocmVhZC0+Y3R4KSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0
ZShlcnJwLCBsb2NhbF9lcnJvcik7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKQEAgLTE4NSw5
ICsxODMsOCBAQCBzdGF0aWMgdm9pZCBpb3RocmVhZF9jb21wbGV0ZShVc2VyQ3JlYXRhYmxlICpv
YmosIEVycm9yICoqZXJycCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW90aHJl
YWQtPnBvbGxfbWF4X25zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpb3RocmVh
ZC0+cG9sbF9ncm93LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpb3RocmVhZC0+
cG9sbF9zaHJpbmssCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZsb2NhbF9lcnJv
cik7Ci0gICAgaWYgKGxvY2FsX2Vycm9yKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJw
LCBsb2NhbF9lcnJvcik7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycnApOwor
ICAgIGlmICgqZXJycCkgewogICAgICAgICBhaW9fY29udGV4dF91bnJlZihpb3RocmVhZC0+Y3R4
KTsKICAgICAgICAgaW90aHJlYWQtPmN0eCA9IE5VTEw7CiAgICAgICAgIHJldHVybjsKQEAgLTI0
MCwxOCArMjM3LDE3IEBAIHN0YXRpYyB2b2lkIGlvdGhyZWFkX3NldF9wb2xsX3BhcmFtKE9iamVj
dCAqb2JqLCBWaXNpdG9yICp2LAogICAgIElPVGhyZWFkICppb3RocmVhZCA9IElPVEhSRUFEKG9i
aik7CiAgICAgUG9sbFBhcmFtSW5mbyAqaW5mbyA9IG9wYXF1ZTsKICAgICBpbnQ2NF90ICpmaWVs
ZCA9ICh2b2lkICopaW90aHJlYWQgKyBpbmZvLT5vZmZzZXQ7Ci0gICAgRXJyb3IgKmxvY2FsX2Vy
ciA9IE5VTEw7CiAgICAgaW50NjRfdCB2YWx1ZTsKIAotICAgIHZpc2l0X3R5cGVfaW50NjQodiwg
bmFtZSwgJnZhbHVlLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAg
IGdvdG8gb3V0OworICAgIHZpc2l0X3R5cGVfaW50NjQodiwgbmFtZSwgJnZhbHVlLCBlcnJwKTsK
KyAgICBpZiAoKmVycnApIHsKKyAgICAgICAgcmV0dXJuOwogICAgIH0KIAogICAgIGlmICh2YWx1
ZSA8IDApIHsKLSAgICAgICAgZXJyb3Jfc2V0ZygmbG9jYWxfZXJyLCAiJXMgdmFsdWUgbXVzdCBi
ZSBpbiByYW5nZSBbMCwgJSJQUklkNjQiXSIsCisgICAgICAgIGVycm9yX3NldGcoZXJycCwgIiVz
IHZhbHVlIG11c3QgYmUgaW4gcmFuZ2UgWzAsICUiUFJJZDY0Il0iLAogICAgICAgICAgICAgICAg
ICAgIGluZm8tPm5hbWUsIElOVDY0X01BWCk7Ci0gICAgICAgIGdvdG8gb3V0OworICAgICAgICBy
ZXR1cm47CiAgICAgfQogCiAgICAgKmZpZWxkID0gdmFsdWU7CkBAIC0yNjEsMTEgKzI1Nyw4IEBA
IHN0YXRpYyB2b2lkIGlvdGhyZWFkX3NldF9wb2xsX3BhcmFtKE9iamVjdCAqb2JqLCBWaXNpdG9y
ICp2LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW90aHJlYWQtPnBvbGxf
bWF4X25zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW90aHJlYWQtPnBv
bGxfZ3JvdywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlvdGhyZWFkLT5w
b2xsX3NocmluaywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZsb2NhbF9l
cnIpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJycCk7CiAgICAgfQot
Ci1vdXQ6Ci0gICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CiB9CiAKIHN0YXRp
YyB2b2lkIGlvdGhyZWFkX2NsYXNzX2luaXQoT2JqZWN0Q2xhc3MgKmtsYXNzLCB2b2lkICpjbGFz
c19kYXRhKQpkaWZmIC0tZ2l0IGEvam9iLmMgYi9qb2IuYwppbmRleCAwNDQwOWI0MGFhLi5iMGFk
ZGUxNjcwIDEwMDY0NAotLS0gYS9qb2IuYworKysgYi9qb2IuYwpAQCAtOTY2LDE2ICs5NjYsMTQg
QEAgdm9pZCBqb2JfY29tcGxldGUoSm9iICpqb2IsIEVycm9yICoqZXJycCkKIAogaW50IGpvYl9m
aW5pc2hfc3luYyhKb2IgKmpvYiwgdm9pZCAoKmZpbmlzaCkoSm9iICosIEVycm9yICoqZXJycCks
IEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBpbnQg
cmV0OwogCiAgICAgam9iX3JlZihqb2IpOwogCiAgICAgaWYgKGZpbmlzaCkgewotICAgICAgICBm
aW5pc2goam9iLCAmbG9jYWxfZXJyKTsKKyAgICAgICAgZmluaXNoKGpvYiwgZXJycCk7CiAgICAg
fQotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxv
Y2FsX2Vycik7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGpvYl91bnJlZihqb2IpOwogICAg
ICAgICByZXR1cm4gLUVCVVNZOwogICAgIH0KZGlmZiAtLWdpdCBhL21lbW9yeS5jIGIvbWVtb3J5
LmMKaW5kZXggYjlkZDZiOTRjYS4uMTY4ZGU4ZTUxNiAxMDA2NDQKLS0tIGEvbWVtb3J5LmMKKysr
IGIvbWVtb3J5LmMKQEAgLTE1NDQsMTcgKzE1NDQsMTUgQEAgdm9pZCBtZW1vcnlfcmVnaW9uX2lu
aXRfcmFtX3NoYXJlZF9ub21pZ3JhdGUoTWVtb3J5UmVnaW9uICptciwKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2wgc2hhcmUsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJy
b3IgKmVyciA9IE5VTEw7CiAgICAgbWVtb3J5X3JlZ2lvbl9pbml0KG1yLCBvd25lciwgbmFtZSwg
c2l6ZSk7CiAgICAgbXItPnJhbSA9IHRydWU7CiAgICAgbXItPnRlcm1pbmF0ZXMgPSB0cnVlOwog
ICAgIG1yLT5kZXN0cnVjdG9yID0gbWVtb3J5X3JlZ2lvbl9kZXN0cnVjdG9yX3JhbTsKLSAgICBt
ci0+cmFtX2Jsb2NrID0gcWVtdV9yYW1fYWxsb2Moc2l6ZSwgc2hhcmUsIG1yLCAmZXJyKTsKKyAg
ICBtci0+cmFtX2Jsb2NrID0gcWVtdV9yYW1fYWxsb2Moc2l6ZSwgc2hhcmUsIG1yLCBlcnJwKTsK
ICAgICBtci0+ZGlydHlfbG9nX21hc2sgPSB0Y2dfZW5hYmxlZCgpID8gKDEgPDwgRElSVFlfTUVN
T1JZX0NPREUpIDogMDsKLSAgICBpZiAoZXJyKSB7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAg
IG1yLT5zaXplID0gaW50MTI4X3plcm8oKTsKICAgICAgICAgb2JqZWN0X3VucGFyZW50KE9CSkVD
VChtcikpOwotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKICAgICB9CiB9CiAK
QEAgLTE1NjgsMTggKzE1NjYsMTYgQEAgdm9pZCBtZW1vcnlfcmVnaW9uX2luaXRfcmVzaXplYWJs
ZV9yYW0oTWVtb3J5UmVnaW9uICptciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICB2b2lkICpob3N0KSwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqZXJyID0gTlVM
TDsKICAgICBtZW1vcnlfcmVnaW9uX2luaXQobXIsIG93bmVyLCBuYW1lLCBzaXplKTsKICAgICBt
ci0+cmFtID0gdHJ1ZTsKICAgICBtci0+dGVybWluYXRlcyA9IHRydWU7CiAgICAgbXItPmRlc3Ry
dWN0b3IgPSBtZW1vcnlfcmVnaW9uX2Rlc3RydWN0b3JfcmFtOwogICAgIG1yLT5yYW1fYmxvY2sg
PSBxZW11X3JhbV9hbGxvY19yZXNpemVhYmxlKHNpemUsIG1heF9zaXplLCByZXNpemVkLAotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1yLCAmZXJyKTsKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtciwgZXJycCk7CiAg
ICAgbXItPmRpcnR5X2xvZ19tYXNrID0gdGNnX2VuYWJsZWQoKSA/ICgxIDw8IERJUlRZX01FTU9S
WV9DT0RFKSA6IDA7Ci0gICAgaWYgKGVycikgeworICAgIGlmICgqZXJycCkgewogICAgICAgICBt
ci0+c2l6ZSA9IGludDEyOF96ZXJvKCk7CiAgICAgICAgIG9iamVjdF91bnBhcmVudChPQkpFQ1Qo
bXIpKTsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CiAgICAgfQogfQogCkBA
IC0xNTkzLDE4ICsxNTg5LDE2IEBAIHZvaWQgbWVtb3J5X3JlZ2lvbl9pbml0X3JhbV9mcm9tX2Zp
bGUoTWVtb3J5UmVnaW9uICptciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgY29uc3QgY2hhciAqcGF0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgRXJyb3IgKiplcnJwKQogewotICAgIEVycm9yICplcnIgPSBOVUxMOwogICAgIG1lbW9yeV9y
ZWdpb25faW5pdChtciwgb3duZXIsIG5hbWUsIHNpemUpOwogICAgIG1yLT5yYW0gPSB0cnVlOwog
ICAgIG1yLT50ZXJtaW5hdGVzID0gdHJ1ZTsKICAgICBtci0+ZGVzdHJ1Y3RvciA9IG1lbW9yeV9y
ZWdpb25fZGVzdHJ1Y3Rvcl9yYW07CiAgICAgbXItPmFsaWduID0gYWxpZ247Ci0gICAgbXItPnJh
bV9ibG9jayA9IHFlbXVfcmFtX2FsbG9jX2Zyb21fZmlsZShzaXplLCBtciwgcmFtX2ZsYWdzLCBw
YXRoLCAmZXJyKTsKKyAgICBtci0+cmFtX2Jsb2NrID0gcWVtdV9yYW1fYWxsb2NfZnJvbV9maWxl
KHNpemUsIG1yLCByYW1fZmxhZ3MsIHBhdGgsIGVycnApOwogICAgIG1yLT5kaXJ0eV9sb2dfbWFz
ayA9IHRjZ19lbmFibGVkKCkgPyAoMSA8PCBESVJUWV9NRU1PUllfQ09ERSkgOiAwOwotICAgIGlm
IChlcnIpIHsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgbXItPnNpemUgPSBpbnQxMjhfemVy
bygpOwogICAgICAgICBvYmplY3RfdW5wYXJlbnQoT0JKRUNUKG1yKSk7Ci0gICAgICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBlcnIpOwogICAgIH0KIH0KIApAQCAtMTYxNiwxOSArMTYxMCwxNyBA
QCB2b2lkIG1lbW9yeV9yZWdpb25faW5pdF9yYW1fZnJvbV9mZChNZW1vcnlSZWdpb24gKm1yLAog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IGZkLAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJwKQogewotICAgIEVycm9yICplcnIg
PSBOVUxMOwogICAgIG1lbW9yeV9yZWdpb25faW5pdChtciwgb3duZXIsIG5hbWUsIHNpemUpOwog
ICAgIG1yLT5yYW0gPSB0cnVlOwogICAgIG1yLT50ZXJtaW5hdGVzID0gdHJ1ZTsKICAgICBtci0+
ZGVzdHJ1Y3RvciA9IG1lbW9yeV9yZWdpb25fZGVzdHJ1Y3Rvcl9yYW07CiAgICAgbXItPnJhbV9i
bG9jayA9IHFlbXVfcmFtX2FsbG9jX2Zyb21fZmQoc2l6ZSwgbXIsCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hhcmUgPyBSQU1fU0hBUkVEIDogMCwKLSAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmZCwgJmVycik7CisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmQsIGVycnApOwogICAgIG1yLT5k
aXJ0eV9sb2dfbWFzayA9IHRjZ19lbmFibGVkKCkgPyAoMSA8PCBESVJUWV9NRU1PUllfQ09ERSkg
OiAwOwotICAgIGlmIChlcnIpIHsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgbXItPnNpemUg
PSBpbnQxMjhfemVybygpOwogICAgICAgICBvYmplY3RfdW5wYXJlbnQoT0JKRUNUKG1yKSk7Ci0g
ICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOwogICAgIH0KIH0KICNlbmRpZgpAQCAt
MTY4NywxOCArMTY3OSwxNiBAQCB2b2lkIG1lbW9yeV9yZWdpb25faW5pdF9yb21fbm9taWdyYXRl
KE1lbW9yeVJlZ2lvbiAqbXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHVpbnQ2NF90IHNpemUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVy
cm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKICAgICBtZW1vcnlfcmVnaW9u
X2luaXQobXIsIG93bmVyLCBuYW1lLCBzaXplKTsKICAgICBtci0+cmFtID0gdHJ1ZTsKICAgICBt
ci0+cmVhZG9ubHkgPSB0cnVlOwogICAgIG1yLT50ZXJtaW5hdGVzID0gdHJ1ZTsKICAgICBtci0+
ZGVzdHJ1Y3RvciA9IG1lbW9yeV9yZWdpb25fZGVzdHJ1Y3Rvcl9yYW07Ci0gICAgbXItPnJhbV9i
bG9jayA9IHFlbXVfcmFtX2FsbG9jKHNpemUsIGZhbHNlLCBtciwgJmVycik7CisgICAgbXItPnJh
bV9ibG9jayA9IHFlbXVfcmFtX2FsbG9jKHNpemUsIGZhbHNlLCBtciwgZXJycCk7CiAgICAgbXIt
PmRpcnR5X2xvZ19tYXNrID0gdGNnX2VuYWJsZWQoKSA/ICgxIDw8IERJUlRZX01FTU9SWV9DT0RF
KSA6IDA7Ci0gICAgaWYgKGVycikgeworICAgIGlmICgqZXJycCkgewogICAgICAgICBtci0+c2l6
ZSA9IGludDEyOF96ZXJvKCk7CiAgICAgICAgIG9iamVjdF91bnBhcmVudChPQkpFQ1QobXIpKTsK
LSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CiAgICAgfQogfQogCkBAIC0xNzEw
LDcgKzE3MDAsNiBAQCB2b2lkIG1lbW9yeV9yZWdpb25faW5pdF9yb21fZGV2aWNlX25vbWlncmF0
ZShNZW1vcnlSZWdpb24gKm1yLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgdWludDY0X3Qgc2l6ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKICAg
ICBhc3NlcnQob3BzKTsKICAgICBtZW1vcnlfcmVnaW9uX2luaXQobXIsIG93bmVyLCBuYW1lLCBz
aXplKTsKICAgICBtci0+b3BzID0gb3BzOwpAQCAtMTcxOCwxMSArMTcwNywxMCBAQCB2b2lkIG1l
bW9yeV9yZWdpb25faW5pdF9yb21fZGV2aWNlX25vbWlncmF0ZShNZW1vcnlSZWdpb24gKm1yLAog
ICAgIG1yLT50ZXJtaW5hdGVzID0gdHJ1ZTsKICAgICBtci0+cm9tX2RldmljZSA9IHRydWU7CiAg
ICAgbXItPmRlc3RydWN0b3IgPSBtZW1vcnlfcmVnaW9uX2Rlc3RydWN0b3JfcmFtOwotICAgIG1y
LT5yYW1fYmxvY2sgPSBxZW11X3JhbV9hbGxvYyhzaXplLCBmYWxzZSwgIG1yLCAmZXJyKTsKLSAg
ICBpZiAoZXJyKSB7CisgICAgbXItPnJhbV9ibG9jayA9IHFlbXVfcmFtX2FsbG9jKHNpemUsIGZh
bHNlLCAgbXIsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICBtci0+c2l6ZSA9IGlu
dDEyOF96ZXJvKCk7CiAgICAgICAgIG9iamVjdF91bnBhcmVudChPQkpFQ1QobXIpKTsKLSAgICAg
ICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CiAgICAgfQogfQogCkBAIC0zMTc0LDExICsz
MTYyLDkgQEAgdm9pZCBtZW1vcnlfcmVnaW9uX2luaXRfcmFtKE1lbW9yeVJlZ2lvbiAqbXIsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJwKQogewogICAgIERldmljZVN0
YXRlICpvd25lcl9kZXY7Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7CiAKLSAgICBtZW1vcnlfcmVn
aW9uX2luaXRfcmFtX25vbWlncmF0ZShtciwgb3duZXIsIG5hbWUsIHNpemUsICZlcnIpOwotICAg
IGlmIChlcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgbWVt
b3J5X3JlZ2lvbl9pbml0X3JhbV9ub21pZ3JhdGUobXIsIG93bmVyLCBuYW1lLCBzaXplLCBlcnJw
KTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KICAgICAvKiBUaGlz
IHdpbGwgYXNzZXJ0IGlmIG93bmVyIGlzIG5laXRoZXIgTlVMTCBub3IgYSBEZXZpY2VTdGF0ZS4K
QEAgLTMxOTgsMTEgKzMxODQsOSBAQCB2b2lkIG1lbW9yeV9yZWdpb25faW5pdF9yb20oTWVtb3J5
UmVnaW9uICptciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcnJvciAqKmVycnApCiB7
CiAgICAgRGV2aWNlU3RhdGUgKm93bmVyX2RldjsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKIAot
ICAgIG1lbW9yeV9yZWdpb25faW5pdF9yb21fbm9taWdyYXRlKG1yLCBvd25lciwgbmFtZSwgc2l6
ZSwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwg
ZXJyKTsKKyAgICBtZW1vcnlfcmVnaW9uX2luaXRfcm9tX25vbWlncmF0ZShtciwgb3duZXIsIG5h
bWUsIHNpemUsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAg
fQogICAgIC8qIFRoaXMgd2lsbCBhc3NlcnQgaWYgb3duZXIgaXMgbmVpdGhlciBOVUxMIG5vciBh
IERldmljZVN0YXRlLgpAQCAtMzIyNCwxMiArMzIwOCwxMCBAQCB2b2lkIG1lbW9yeV9yZWdpb25f
aW5pdF9yb21fZGV2aWNlKE1lbW9yeVJlZ2lvbiAqbXIsCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIEVycm9yICoqZXJycCkKIHsKICAgICBEZXZpY2VTdGF0ZSAqb3duZXJfZGV2
OwotICAgIEVycm9yICplcnIgPSBOVUxMOwogCiAgICAgbWVtb3J5X3JlZ2lvbl9pbml0X3JvbV9k
ZXZpY2Vfbm9taWdyYXRlKG1yLCBvd25lciwgb3BzLCBvcGFxdWUsCi0gICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUsIHNpemUsICZlcnIpOwotICAgIGlmIChl
cnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUsIHNpemUsIGVycnApOworICAgIGlm
ICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogICAgIC8qIFRoaXMgd2lsbCBhc3Nl
cnQgaWYgb3duZXIgaXMgbmVpdGhlciBOVUxMIG5vciBhIERldmljZVN0YXRlLgpkaWZmIC0tZ2l0
IGEvbWVtb3J5X21hcHBpbmcuYyBiL21lbW9yeV9tYXBwaW5nLmMKaW5kZXggMThkMGI4MDY3Yy4u
MzMxMDNjMTZkMyAxMDA2NDQKLS0tIGEvbWVtb3J5X21hcHBpbmcuYworKysgYi9tZW1vcnlfbWFw
cGluZy5jCkBAIC0yOTYsMTAgKzI5Niw4IEBAIHZvaWQgcWVtdV9nZXRfZ3Vlc3RfbWVtb3J5X21h
cHBpbmcoTWVtb3J5TWFwcGluZ0xpc3QgKmxpc3QsCiAgICAgaWYgKGZpcnN0X3BhZ2luZ19lbmFi
bGVkX2NwdSkgewogICAgICAgICBmb3IgKGNwdSA9IGZpcnN0X3BhZ2luZ19lbmFibGVkX2NwdTsg
Y3B1ICE9IE5VTEw7CiAgICAgICAgICAgICAgY3B1ID0gQ1BVX05FWFQoY3B1KSkgewotICAgICAg
ICAgICAgRXJyb3IgKmVyciA9IE5VTEw7Ci0gICAgICAgICAgICBjcHVfZ2V0X21lbW9yeV9tYXBw
aW5nKGNwdSwgbGlzdCwgJmVycik7Ci0gICAgICAgICAgICBpZiAoZXJyKSB7Ci0gICAgICAgICAg
ICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgICAgICAgICBjcHVfZ2V0X21l
bW9yeV9tYXBwaW5nKGNwdSwgbGlzdCwgZXJycCk7CisgICAgICAgICAgICBpZiAoKmVycnApIHsK
ICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICB9CiAgICAgICAgIH0KZGlmZiAt
LWdpdCBhL21pZ3JhdGlvbi9jb2xvLmMgYi9taWdyYXRpb24vY29sby5jCmluZGV4IDJjODhhYTU3
YTIuLjMxZGFjOGMwYmQgMTAwNjQ0Ci0tLSBhL21pZ3JhdGlvbi9jb2xvLmMKKysrIGIvbWlncmF0
aW9uL2NvbG8uYwpAQCAtMjQzLDE5ICsyNDMsMTggQEAgdm9pZCBxbXBfeGVuX3NldF9yZXBsaWNh
dGlvbihib29sIGVuYWJsZSwgYm9vbCBwcmltYXJ5LAogCiBSZXBsaWNhdGlvblN0YXR1cyAqcW1w
X3F1ZXJ5X3hlbl9yZXBsaWNhdGlvbl9zdGF0dXMoRXJyb3IgKiplcnJwKQogewotICAgIEVycm9y
ICplcnIgPSBOVUxMOwogICAgIFJlcGxpY2F0aW9uU3RhdHVzICpzID0gZ19uZXcwKFJlcGxpY2F0
aW9uU3RhdHVzLCAxKTsKIAotICAgIHJlcGxpY2F0aW9uX2dldF9lcnJvcl9hbGwoJmVycik7Ci0g
ICAgaWYgKGVycikgeworICAgIHJlcGxpY2F0aW9uX2dldF9lcnJvcl9hbGwoZXJycCk7CisgICAg
aWYgKCplcnJwKSB7CiAgICAgICAgIHMtPmVycm9yID0gdHJ1ZTsKICAgICAgICAgcy0+aGFzX2Rl
c2MgPSB0cnVlOwotICAgICAgICBzLT5kZXNjID0gZ19zdHJkdXAoZXJyb3JfZ2V0X3ByZXR0eShl
cnIpKTsKKyAgICAgICAgcy0+ZGVzYyA9IGdfc3RyZHVwKGVycm9yX2dldF9wcmV0dHkoKmVycnAp
KTsKICAgICB9IGVsc2UgewogICAgICAgICBzLT5lcnJvciA9IGZhbHNlOwogICAgIH0KIAotICAg
IGVycm9yX2ZyZWUoZXJyKTsKKyAgICBlcnJvcl9mcmVlX2VycnAoZXJycCk7CiAgICAgcmV0dXJu
IHM7CiB9CiAKQEAgLTMxNCwxMiArMzEzLDEwIEBAIHN0YXRpYyB2b2lkIGNvbG9fc2VuZF9tZXNz
YWdlKFFFTVVGaWxlICpmLCBDT0xPTWVzc2FnZSBtc2csCiBzdGF0aWMgdm9pZCBjb2xvX3NlbmRf
bWVzc2FnZV92YWx1ZShRRU1VRmlsZSAqZiwgQ09MT01lc3NhZ2UgbXNnLAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgdWludDY0X3QgdmFsdWUsIEVycm9yICoqZXJycCkKIHsK
LSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBpbnQgcmV0OwogCi0gICAgY29sb19z
ZW5kX21lc3NhZ2UoZiwgbXNnLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0g
ICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIGNvbG9fc2VuZF9t
ZXNzYWdlKGYsIG1zZywgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsK
ICAgICB9CiAgICAgcWVtdV9wdXRfYmU2NChmLCB2YWx1ZSk7CkBAIC0zNTUsMTEgKzM1Miw5IEBA
IHN0YXRpYyB2b2lkIGNvbG9fcmVjZWl2ZV9jaGVja19tZXNzYWdlKFFFTVVGaWxlICpmLCBDT0xP
TWVzc2FnZSBleHBlY3RfbXNnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgRXJyb3IgKiplcnJwKQogewogICAgIENPTE9NZXNzYWdlIG1zZzsKLSAgICBFcnJvciAqbG9j
YWxfZXJyID0gTlVMTDsKIAotICAgIG1zZyA9IGNvbG9fcmVjZWl2ZV9tZXNzYWdlKGYsICZsb2Nh
bF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVy
cnAsIGxvY2FsX2Vycik7CisgICAgbXNnID0gY29sb19yZWNlaXZlX21lc3NhZ2UoZiwgZXJycCk7
CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAgICAgaWYgKG1zZyAh
PSBleHBlY3RfbXNnKSB7CkBAIC0zNzEsMTMgKzM2NiwxMSBAQCBzdGF0aWMgdm9pZCBjb2xvX3Jl
Y2VpdmVfY2hlY2tfbWVzc2FnZShRRU1VRmlsZSAqZiwgQ09MT01lc3NhZ2UgZXhwZWN0X21zZywK
IHN0YXRpYyB1aW50NjRfdCBjb2xvX3JlY2VpdmVfbWVzc2FnZV92YWx1ZShRRU1VRmlsZSAqZiwg
dWludDMyX3QgZXhwZWN0X21zZywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAg
ICAgdWludDY0X3QgdmFsdWU7CiAgICAgaW50IHJldDsKIAotICAgIGNvbG9fcmVjZWl2ZV9jaGVj
a19tZXNzYWdlKGYsIGV4cGVjdF9tc2csICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIp
IHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgY29sb19y
ZWNlaXZlX2NoZWNrX21lc3NhZ2UoZiwgZXhwZWN0X21zZywgZXJycCk7CisgICAgaWYgKCplcnJw
KSB7CiAgICAgICAgIHJldHVybiAwOwogICAgIH0KIApAQCAtNjY4LDExICs2NjEsOSBAQCBzdGF0
aWMgdm9pZCBjb2xvX3dhaXRfaGFuZGxlX21lc3NhZ2UoUUVNVUZpbGUgKmYsIGludCAqY2hlY2tw
b2ludF9yZXF1ZXN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVycm9y
ICoqZXJycCkKIHsKICAgICBDT0xPTWVzc2FnZSBtc2c7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9
IE5VTEw7CiAKLSAgICBtc2cgPSBjb2xvX3JlY2VpdmVfbWVzc2FnZShmLCAmbG9jYWxfZXJyKTsK
LSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2Nh
bF9lcnIpOworICAgIG1zZyA9IGNvbG9fcmVjZWl2ZV9tZXNzYWdlKGYsIGVycnApOworICAgIGlm
ICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCmRpZmYgLS1naXQgYS9taWdyYXRp
b24vbWlncmF0aW9uLmMgYi9taWdyYXRpb24vbWlncmF0aW9uLmMKaW5kZXggMDE4NjNhOTVmNS4u
OTMwOTAwODU1NSAxMDA2NDQKLS0tIGEvbWlncmF0aW9uL21pZ3JhdGlvbi5jCisrKyBiL21pZ3Jh
dGlvbi9taWdyYXRpb24uYwpAQCAtNjAzLDEyICs2MDMsMTAgQEAgdm9pZCBtaWdyYXRpb25faW9j
X3Byb2Nlc3NfaW5jb21pbmcoUUlPQ2hhbm5lbCAqaW9jLCBFcnJvciAqKmVycnApCiAgICAgICAg
ICAqLwogICAgICAgICBzdGFydF9taWdyYXRpb24gPSAhbWlncmF0ZV91c2VfbXVsdGlmZCgpOwog
ICAgIH0gZWxzZSB7Ci0gICAgICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgICAgICAv
KiBNdWx0aXBsZSBjb25uZWN0aW9ucyAqLwogICAgICAgICBhc3NlcnQobWlncmF0ZV91c2VfbXVs
dGlmZCgpKTsKLSAgICAgICAgc3RhcnRfbWlncmF0aW9uID0gbXVsdGlmZF9yZWN2X25ld19jaGFu
bmVsKGlvYywgJmxvY2FsX2Vycik7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAg
ICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICBzdGFydF9taWdy
YXRpb24gPSBtdWx0aWZkX3JlY3ZfbmV3X2NoYW5uZWwoaW9jLCBlcnJwKTsKKyAgICAgICAgaWYg
KCplcnJwKSB7CiAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgIH0KICAgICB9CkBAIC0xNzU3
LDcgKzE3NTUsNiBAQCB2b2lkIG1pZ3JhdGVfZGVsX2Jsb2NrZXIoRXJyb3IgKnJlYXNvbikKIAog
dm9pZCBxbXBfbWlncmF0ZV9pbmNvbWluZyhjb25zdCBjaGFyICp1cmksIEVycm9yICoqZXJycCkK
IHsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBzdGF0aWMgYm9vbCBvbmNlID0g
dHJ1ZTsKIAogICAgIGlmICghZGVmZXJyZWRfaW5jb21pbmcpIHsKQEAgLTE3NjgsMTAgKzE3NjUs
OSBAQCB2b2lkIHFtcF9taWdyYXRlX2luY29taW5nKGNvbnN0IGNoYXIgKnVyaSwgRXJyb3IgKipl
cnJwKQogICAgICAgICBlcnJvcl9zZXRnKGVycnAsICJUaGUgaW5jb21pbmcgbWlncmF0aW9uIGhh
cyBhbHJlYWR5IGJlZW4gc3RhcnRlZCIpOwogICAgIH0KIAotICAgIHFlbXVfc3RhcnRfaW5jb21p
bmdfbWlncmF0aW9uKHVyaSwgJmxvY2FsX2Vycik7CisgICAgcWVtdV9zdGFydF9pbmNvbWluZ19t
aWdyYXRpb24odXJpLCBlcnJwKTsKIAotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJy
b3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAg
IHJldHVybjsKICAgICB9CiAKQEAgLTE4NDksOCArMTg0NSw2IEBAIGJvb2wgbWlncmF0aW9uX2lz
X2Jsb2NrZWQoRXJyb3IgKiplcnJwKQogc3RhdGljIGJvb2wgbWlncmF0ZV9wcmVwYXJlKE1pZ3Jh
dGlvblN0YXRlICpzLCBib29sIGJsaywgYm9vbCBibGtfaW5jLAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGJvb2wgcmVzdW1lLCBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJyb3IgKmxvY2Fs
X2VyciA9IE5VTEw7Ci0KICAgICBpZiAocmVzdW1lKSB7CiAgICAgICAgIGlmIChzLT5zdGF0ZSAh
PSBNSUdSQVRJT05fU1RBVFVTX1BPU1RDT1BZX1BBVVNFRCkgewogICAgICAgICAgICAgZXJyb3Jf
c2V0ZyhlcnJwLCAiQ2Fubm90IHJlc3VtZSBpZiB0aGVyZSBpcyBubyAiCkBAIC0xOTAyLDkgKzE4
OTYsOCBAQCBzdGF0aWMgYm9vbCBtaWdyYXRlX3ByZXBhcmUoTWlncmF0aW9uU3RhdGUgKnMsIGJv
b2wgYmxrLCBib29sIGJsa19pbmMsCiAgICAgICAgICAgICAgICAgICAgICAgICJjdXJyZW50IG1p
Z3JhdGlvbiBjYXBhYmlsaXRpZXMiKTsKICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg
ICAgfQotICAgICAgICBtaWdyYXRlX3NldF9ibG9ja19lbmFibGVkKHRydWUsICZsb2NhbF9lcnIp
OwotICAgICAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUo
ZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgbWlncmF0ZV9zZXRfYmxvY2tfZW5hYmxlZCh0cnVl
LCBlcnJwKTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICByZXR1cm4gZmFsc2U7
CiAgICAgICAgIH0KICAgICAgICAgcy0+bXVzdF9yZW1vdmVfYmxvY2tfb3B0aW9ucyA9IHRydWU7
CkBAIC0xOTI4LDcgKzE5MjEsNiBAQCB2b2lkIHFtcF9taWdyYXRlKGNvbnN0IGNoYXIgKnVyaSwg
Ym9vbCBoYXNfYmxrLCBib29sIGJsaywKICAgICAgICAgICAgICAgICAgYm9vbCBoYXNfaW5jLCBi
b29sIGluYywgYm9vbCBoYXNfZGV0YWNoLCBib29sIGRldGFjaCwKICAgICAgICAgICAgICAgICAg
Ym9vbCBoYXNfcmVzdW1lLCBib29sIHJlc3VtZSwgRXJyb3IgKiplcnJwKQogewotICAgIEVycm9y
ICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIE1pZ3JhdGlvblN0YXRlICpzID0gbWlncmF0ZV9nZXRf
Y3VycmVudCgpOwogICAgIGNvbnN0IGNoYXIgKnA7CiAKQEAgLTE5MzksMTcgKzE5MzEsMTcgQEAg
dm9pZCBxbXBfbWlncmF0ZShjb25zdCBjaGFyICp1cmksIGJvb2wgaGFzX2JsaywgYm9vbCBibGss
CiAgICAgfQogCiAgICAgaWYgKHN0cnN0YXJ0KHVyaSwgInRjcDoiLCAmcCkpIHsKLSAgICAgICAg
dGNwX3N0YXJ0X291dGdvaW5nX21pZ3JhdGlvbihzLCBwLCAmbG9jYWxfZXJyKTsKKyAgICAgICAg
dGNwX3N0YXJ0X291dGdvaW5nX21pZ3JhdGlvbihzLCBwLCBlcnJwKTsKICNpZmRlZiBDT05GSUdf
UkRNQQogICAgIH0gZWxzZSBpZiAoc3Ryc3RhcnQodXJpLCAicmRtYToiLCAmcCkpIHsKLSAgICAg
ICAgcmRtYV9zdGFydF9vdXRnb2luZ19taWdyYXRpb24ocywgcCwgJmxvY2FsX2Vycik7CisgICAg
ICAgIHJkbWFfc3RhcnRfb3V0Z29pbmdfbWlncmF0aW9uKHMsIHAsIGVycnApOwogI2VuZGlmCiAg
ICAgfSBlbHNlIGlmIChzdHJzdGFydCh1cmksICJleGVjOiIsICZwKSkgewotICAgICAgICBleGVj
X3N0YXJ0X291dGdvaW5nX21pZ3JhdGlvbihzLCBwLCAmbG9jYWxfZXJyKTsKKyAgICAgICAgZXhl
Y19zdGFydF9vdXRnb2luZ19taWdyYXRpb24ocywgcCwgZXJycCk7CiAgICAgfSBlbHNlIGlmIChz
dHJzdGFydCh1cmksICJ1bml4OiIsICZwKSkgewotICAgICAgICB1bml4X3N0YXJ0X291dGdvaW5n
X21pZ3JhdGlvbihzLCBwLCAmbG9jYWxfZXJyKTsKKyAgICAgICAgdW5peF9zdGFydF9vdXRnb2lu
Z19taWdyYXRpb24ocywgcCwgZXJycCk7CiAgICAgfSBlbHNlIGlmIChzdHJzdGFydCh1cmksICJm
ZDoiLCAmcCkpIHsKLSAgICAgICAgZmRfc3RhcnRfb3V0Z29pbmdfbWlncmF0aW9uKHMsIHAsICZs
b2NhbF9lcnIpOworICAgICAgICBmZF9zdGFydF9vdXRnb2luZ19taWdyYXRpb24ocywgcCwgZXJy
cCk7CiAgICAgfSBlbHNlIHsKICAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCBRRVJSX0lOVkFMSURf
UEFSQU1FVEVSX1ZBTFVFLCAidXJpIiwKICAgICAgICAgICAgICAgICAgICAiYSB2YWxpZCBtaWdy
YXRpb24gcHJvdG9jb2wiKTsKQEAgLTE5NTksOSArMTk1MSw4IEBAIHZvaWQgcW1wX21pZ3JhdGUo
Y29uc3QgY2hhciAqdXJpLCBib29sIGhhc19ibGssIGJvb2wgYmxrLAogICAgICAgICByZXR1cm47
CiAgICAgfQogCi0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBtaWdyYXRlX2ZkX2Vycm9y
KHMsIGxvY2FsX2Vycik7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIp
OworICAgIGlmICgqZXJycCkgeworICAgICAgICBtaWdyYXRlX2ZkX2Vycm9yKHMsICplcnJwKTsK
ICAgICAgICAgcmV0dXJuOwogICAgIH0KIH0KZGlmZiAtLWdpdCBhL21pZ3JhdGlvbi9yYW0uYyBi
L21pZ3JhdGlvbi9yYW0uYwppbmRleCAwMWRmMzI2NzY3Li42OTM1YWZlMmVhIDEwMDY0NAotLS0g
YS9taWdyYXRpb24vcmFtLmMKKysrIGIvbWlncmF0aW9uL3JhbS5jCkBAIC0xNDc1LDEzICsxNDc1
LDEyIEBAIGJvb2wgbXVsdGlmZF9yZWN2X2FsbF9jaGFubmVsc19jcmVhdGVkKHZvaWQpCiBib29s
IG11bHRpZmRfcmVjdl9uZXdfY2hhbm5lbChRSU9DaGFubmVsICppb2MsIEVycm9yICoqZXJycCkK
IHsKICAgICBNdWx0aUZEUmVjdlBhcmFtcyAqcDsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVM
TDsKICAgICBpbnQgaWQ7CiAKLSAgICBpZCA9IG11bHRpZmRfcmVjdl9pbml0aWFsX3BhY2tldChp
b2MsICZsb2NhbF9lcnIpOworICAgIGlkID0gbXVsdGlmZF9yZWN2X2luaXRpYWxfcGFja2V0KGlv
YywgZXJycCk7CiAgICAgaWYgKGlkIDwgMCkgewotICAgICAgICBtdWx0aWZkX3JlY3ZfdGVybWlu
YXRlX3RocmVhZHMobG9jYWxfZXJyKTsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlX3ByZXBlbmQo
ZXJycCwgbG9jYWxfZXJyLAorICAgICAgICBtdWx0aWZkX3JlY3ZfdGVybWluYXRlX3RocmVhZHMo
KmVycnApOworICAgICAgICBlcnJvcl9wcm9wYWdhdGVfcHJlcGVuZChlcnJwLCAqZXJycCwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImZhaWxlZCB0byByZWNlaXZlIHBhY2tldCIK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiB2aWEgbXVsdGlmZCBjaGFubmVsICVk
OiAiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdG9taWNfcmVhZCgmbXVsdGlm
ZF9yZWN2X3N0YXRlLT5jb3VudCkpOwpAQCAtMTQ5MSwxMCArMTQ5MCw5IEBAIGJvb2wgbXVsdGlm
ZF9yZWN2X25ld19jaGFubmVsKFFJT0NoYW5uZWwgKmlvYywgRXJyb3IgKiplcnJwKQogCiAgICAg
cCA9ICZtdWx0aWZkX3JlY3Zfc3RhdGUtPnBhcmFtc1tpZF07CiAgICAgaWYgKHAtPmMgIT0gTlVM
TCkgewotICAgICAgICBlcnJvcl9zZXRnKCZsb2NhbF9lcnIsICJtdWx0aWZkOiByZWNlaXZlZCBp
ZCAnJWQnIGFscmVhZHkgc2V0dXAnIiwKKyAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAibXVsdGlm
ZDogcmVjZWl2ZWQgaWQgJyVkJyBhbHJlYWR5IHNldHVwJyIsCiAgICAgICAgICAgICAgICAgICAg
aWQpOwotICAgICAgICBtdWx0aWZkX3JlY3ZfdGVybWluYXRlX3RocmVhZHMobG9jYWxfZXJyKTsK
LSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgIG11bHRp
ZmRfcmVjdl90ZXJtaW5hdGVfdGhyZWFkcygqZXJycCk7CiAgICAgICAgIHJldHVybiBmYWxzZTsK
ICAgICB9CiAgICAgcC0+YyA9IGlvYzsKZGlmZiAtLWdpdCBhL21pZ3JhdGlvbi9yZG1hLmMgYi9t
aWdyYXRpb24vcmRtYS5jCmluZGV4IDc4ZTZiNzJiYWMuLjJiNDAxNTcyNDAgMTAwNjQ0Ci0tLSBh
L21pZ3JhdGlvbi9yZG1hLmMKKysrIGIvbWlncmF0aW9uL3JkbWEuYwpAQCAtMjM5Nyw3ICsyMzk3
LDcgQEAgc3RhdGljIHZvaWQgcWVtdV9yZG1hX2NsZWFudXAoUkRNQUNvbnRleHQgKnJkbWEpCiBz
dGF0aWMgaW50IHFlbXVfcmRtYV9zb3VyY2VfaW5pdChSRE1BQ29udGV4dCAqcmRtYSwgYm9vbCBw
aW5fYWxsLCBFcnJvciAqKmVycnApCiB7CiAgICAgaW50IHJldCwgaWR4OwotICAgIEVycm9yICps
b2NhbF9lcnIgPSBOVUxMLCAqKnRlbXAgPSAmbG9jYWxfZXJyOworICAgIEVycm9yICoqdGVtcCA9
IGVycnA7CiAKICAgICAvKgogICAgICAqIFdpbGwgYmUgdmFsaWRhdGVkIGFnYWluc3QgZGVzdGlu
YXRpb24ncyBhY3R1YWwgY2FwYWJpbGl0aWVzCkBAIC0yNDUwLDcgKzI0NTAsNiBAQCBzdGF0aWMg
aW50IHFlbXVfcmRtYV9zb3VyY2VfaW5pdChSRE1BQ29udGV4dCAqcmRtYSwgYm9vbCBwaW5fYWxs
LCBFcnJvciAqKmVycnApCiAgICAgcmV0dXJuIDA7CiAKIGVycl9yZG1hX3NvdXJjZV9pbml0Ogot
ICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogICAgIHFlbXVfcmRtYV9jbGVh
bnVwKHJkbWEpOwogICAgIHJldHVybiAtMTsKIH0KQEAgLTQwMjcsMTYgKzQwMjYsMTUgQEAgdm9p
ZCByZG1hX3N0YXJ0X2luY29taW5nX21pZ3JhdGlvbihjb25zdCBjaGFyICpob3N0X3BvcnQsIEVy
cm9yICoqZXJycCkKIHsKICAgICBpbnQgcmV0OwogICAgIFJETUFDb250ZXh0ICpyZG1hLCAqcmRt
YV9yZXR1cm5fcGF0aCA9IE5VTEw7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAg
ICB0cmFjZV9yZG1hX3N0YXJ0X2luY29taW5nX21pZ3JhdGlvbigpOwotICAgIHJkbWEgPSBxZW11
X3JkbWFfZGF0YV9pbml0KGhvc3RfcG9ydCwgJmxvY2FsX2Vycik7CisgICAgcmRtYSA9IHFlbXVf
cmRtYV9kYXRhX2luaXQoaG9zdF9wb3J0LCBlcnJwKTsKIAogICAgIGlmIChyZG1hID09IE5VTEwp
IHsKICAgICAgICAgZ290byBlcnI7CiAgICAgfQogCi0gICAgcmV0ID0gcWVtdV9yZG1hX2Rlc3Rf
aW5pdChyZG1hLCAmbG9jYWxfZXJyKTsKKyAgICByZXQgPSBxZW11X3JkbWFfZGVzdF9pbml0KHJk
bWEsIGVycnApOwogCiAgICAgaWYgKHJldCkgewogICAgICAgICBnb3RvIGVycjsKQEAgLTQwNTUs
NyArNDA1Myw3IEBAIHZvaWQgcmRtYV9zdGFydF9pbmNvbWluZ19taWdyYXRpb24oY29uc3QgY2hh
ciAqaG9zdF9wb3J0LCBFcnJvciAqKmVycnApCiAKICAgICAvKiBpbml0aWFsaXplIHRoZSBSRE1B
Q29udGV4dCBmb3IgcmV0dXJuIHBhdGggKi8KICAgICBpZiAobWlncmF0ZV9wb3N0Y29weSgpKSB7
Ci0gICAgICAgIHJkbWFfcmV0dXJuX3BhdGggPSBxZW11X3JkbWFfZGF0YV9pbml0KGhvc3RfcG9y
dCwgJmxvY2FsX2Vycik7CisgICAgICAgIHJkbWFfcmV0dXJuX3BhdGggPSBxZW11X3JkbWFfZGF0
YV9pbml0KGhvc3RfcG9ydCwgZXJycCk7CiAKICAgICAgICAgaWYgKHJkbWFfcmV0dXJuX3BhdGgg
PT0gTlVMTCkgewogICAgICAgICAgICAgZ290byBlcnI7CkBAIC00MDY4LDcgKzQwNjYsNiBAQCB2
b2lkIHJkbWFfc3RhcnRfaW5jb21pbmdfbWlncmF0aW9uKGNvbnN0IGNoYXIgKmhvc3RfcG9ydCwg
RXJyb3IgKiplcnJwKQogICAgICAgICAgICAgICAgICAgICAgICAgTlVMTCwgKHZvaWQgKikoaW50
cHRyX3QpcmRtYSk7CiAgICAgcmV0dXJuOwogZXJyOgotICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJw
LCBsb2NhbF9lcnIpOwogICAgIGdfZnJlZShyZG1hKTsKICAgICBnX2ZyZWUocmRtYV9yZXR1cm5f
cGF0aCk7CiB9CmRpZmYgLS1naXQgYS9taWdyYXRpb24vc29ja2V0LmMgYi9taWdyYXRpb24vc29j
a2V0LmMKaW5kZXggOTdjOWVmZGU1OS4uY2E0MzI2ZTAyYyAxMDA2NDQKLS0tIGEvbWlncmF0aW9u
L3NvY2tldC5jCisrKyBiL21pZ3JhdGlvbi9zb2NrZXQuYwpAQCAtMTM5LDEyICsxMzksMTAgQEAg
dm9pZCB0Y3Bfc3RhcnRfb3V0Z29pbmdfbWlncmF0aW9uKE1pZ3JhdGlvblN0YXRlICpzLAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoYXIgKmhvc3RfcG9ydCwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJy
b3IgKmVyciA9IE5VTEw7Ci0gICAgU29ja2V0QWRkcmVzcyAqc2FkZHIgPSB0Y3BfYnVpbGRfYWRk
cmVzcyhob3N0X3BvcnQsICZlcnIpOwotICAgIGlmICghZXJyKSB7Ci0gICAgICAgIHNvY2tldF9z
dGFydF9vdXRnb2luZ19taWdyYXRpb24ocywgc2FkZHIsICZlcnIpOworICAgIFNvY2tldEFkZHJl
c3MgKnNhZGRyID0gdGNwX2J1aWxkX2FkZHJlc3MoaG9zdF9wb3J0LCBlcnJwKTsKKyAgICBpZiAo
ISplcnJwKSB7CisgICAgICAgIHNvY2tldF9zdGFydF9vdXRnb2luZ19taWdyYXRpb24ocywgc2Fk
ZHIsIGVycnApOwogICAgIH0KLSAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKIH0KIAog
dm9pZCB1bml4X3N0YXJ0X291dGdvaW5nX21pZ3JhdGlvbihNaWdyYXRpb25TdGF0ZSAqcywKQEAg
LTIwOSwxMyArMjA3LDExIEBAIHN0YXRpYyB2b2lkIHNvY2tldF9zdGFydF9pbmNvbWluZ19taWdy
YXRpb24oU29ja2V0QWRkcmVzcyAqc2FkZHIsCiAKIHZvaWQgdGNwX3N0YXJ0X2luY29taW5nX21p
Z3JhdGlvbihjb25zdCBjaGFyICpob3N0X3BvcnQsIEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJv
ciAqZXJyID0gTlVMTDsKLSAgICBTb2NrZXRBZGRyZXNzICpzYWRkciA9IHRjcF9idWlsZF9hZGRy
ZXNzKGhvc3RfcG9ydCwgJmVycik7Ci0gICAgaWYgKCFlcnIpIHsKLSAgICAgICAgc29ja2V0X3N0
YXJ0X2luY29taW5nX21pZ3JhdGlvbihzYWRkciwgJmVycik7CisgICAgU29ja2V0QWRkcmVzcyAq
c2FkZHIgPSB0Y3BfYnVpbGRfYWRkcmVzcyhob3N0X3BvcnQsIGVycnApOworICAgIGlmICghKmVy
cnApIHsKKyAgICAgICAgc29ja2V0X3N0YXJ0X2luY29taW5nX21pZ3JhdGlvbihzYWRkciwgZXJy
cCk7CiAgICAgfQogICAgIHFhcGlfZnJlZV9Tb2NrZXRBZGRyZXNzKHNhZGRyKTsKLSAgICBlcnJv
cl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKIH0KIAogdm9pZCB1bml4X3N0YXJ0X2luY29taW5nX21p
Z3JhdGlvbihjb25zdCBjaGFyICpwYXRoLCBFcnJvciAqKmVycnApCmRpZmYgLS1naXQgYS9tb25p
dG9yL21pc2MuYyBiL21vbml0b3IvbWlzYy5jCmluZGV4IGFlZjE2ZjZjZmIuLmZlYWRmOTc4MGMg
MTAwNjQ0Ci0tLSBhL21vbml0b3IvbWlzYy5jCisrKyBiL21vbml0b3IvbWlzYy5jCkBAIC0xNzc2
LDE5ICsxNzc2LDE3IEBAIHZvaWQgbW9uaXRvcl9mZHNldF9kdXBfZmRfcmVtb3ZlKGludCBkdXBf
ZmQpCiBpbnQgbW9uaXRvcl9mZF9wYXJhbShNb25pdG9yICptb24sIGNvbnN0IGNoYXIgKmZkbmFt
ZSwgRXJyb3IgKiplcnJwKQogewogICAgIGludCBmZDsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0g
TlVMTDsKIAogICAgIGlmICghcWVtdV9pc2RpZ2l0KGZkbmFtZVswXSkgJiYgbW9uKSB7Ci0gICAg
ICAgIGZkID0gbW9uaXRvcl9nZXRfZmQobW9uLCBmZG5hbWUsICZsb2NhbF9lcnIpOworICAgICAg
ICBmZCA9IG1vbml0b3JfZ2V0X2ZkKG1vbiwgZmRuYW1lLCBlcnJwKTsKICAgICB9IGVsc2Ugewog
ICAgICAgICBmZCA9IHFlbXVfcGFyc2VfZmQoZmRuYW1lKTsKICAgICAgICAgaWYgKGZkID09IC0x
KSB7Ci0gICAgICAgICAgICBlcnJvcl9zZXRnKCZsb2NhbF9lcnIsICJJbnZhbGlkIGZpbGUgZGVz
Y3JpcHRvciBudW1iZXIgJyVzJyIsCisgICAgICAgICAgICBlcnJvcl9zZXRnKGVycnAsICJJbnZh
bGlkIGZpbGUgZGVzY3JpcHRvciBudW1iZXIgJyVzJyIsCiAgICAgICAgICAgICAgICAgICAgICAg
IGZkbmFtZSk7CiAgICAgICAgIH0KICAgICB9Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAg
ICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBpZiAoKmVycnApIHsKICAg
ICAgICAgYXNzZXJ0KGZkID09IC0xKTsKICAgICB9IGVsc2UgewogICAgICAgICBhc3NlcnQoZmQg
IT0gLTEpOwpkaWZmIC0tZ2l0IGEvbW9uaXRvci9xbXAtY21kcy5jIGIvbW9uaXRvci9xbXAtY21k
cy5jCmluZGV4IDA4ODAzNDFhMmQuLmQ4NWI2NjkzZTUgMTAwNjQ0Ci0tLSBhL21vbml0b3IvcW1w
LWNtZHMuYworKysgYi9tb25pdG9yL3FtcC1jbWRzLmMKQEAgLTEyOCw3ICsxMjgsNiBAQCB2b2lk
IHFtcF9jb250KEVycm9yICoqZXJycCkKIHsKICAgICBCbG9ja0JhY2tlbmQgKmJsazsKICAgICBC
bG9ja0pvYiAqam9iOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgLyogaWYg
dGhlcmUgaXMgYSBkdW1wIGluIGJhY2tncm91bmQsIHdlIHNob3VsZCB3YWl0IHVudGlsIHRoZSBk
dW1wCiAgICAgICogZmluaXNoZWQgKi8KQEAgLTE2MSw5ICsxNjAsOCBAQCB2b2lkIHFtcF9jb250
KEVycm9yICoqZXJycCkKICAgICAgKiBJZiB0aGVyZSBhcmUgbm8gaW5hY3RpdmUgYmxvY2sgbm9k
ZXMgKGUuZy4gYmVjYXVzZSB0aGUgVk0gd2FzIGp1c3QKICAgICAgKiBwYXVzZWQgcmF0aGVyIHRo
YW4gY29tcGxldGluZyBhIG1pZ3JhdGlvbiksIGJkcnZfaW5hY3RpdmF0ZV9hbGwoKSBzaW1wbHkK
ICAgICAgKiBkb2Vzbid0IGRvIGFueXRoaW5nLiAqLwotICAgIGJkcnZfaW52YWxpZGF0ZV9jYWNo
ZV9hbGwoJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9w
cm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBiZHJ2X2ludmFsaWRhdGVfY2FjaGVfYWxs
KGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCmRpZmYg
LS1naXQgYS9uZXQvY2FuL2Nhbl9ob3N0LmMgYi9uZXQvY2FuL2Nhbl9ob3N0LmMKaW5kZXggMWRm
YWYwY2VkMC4uZTliNGFjOTA3NSAxMDA2NDQKLS0tIGEvbmV0L2Nhbi9jYW5faG9zdC5jCisrKyBi
L25ldC9jYW4vY2FuX2hvc3QuYwpAQCAtNTEsMTEgKzUxLDkgQEAgc3RhdGljIHZvaWQgY2FuX2hv
c3RfZGlzY29ubmVjdChDYW5Ib3N0U3RhdGUgKmNoKQogc3RhdGljIHZvaWQgY2FuX2hvc3RfY29u
bmVjdChDYW5Ib3N0U3RhdGUgKmNoLCBFcnJvciAqKmVycnApCiB7CiAgICAgQ2FuSG9zdENsYXNz
ICpjaGMgPSBDQU5fSE9TVF9HRVRfQ0xBU1MoY2gpOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBO
VUxMOwogCi0gICAgY2hjLT5jb25uZWN0KGNoLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxf
ZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIGNo
Yy0+Y29ubmVjdChjaCwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsK
ICAgICB9CiAKZGlmZiAtLWdpdCBhL25ldC9kdW1wLmMgYi9uZXQvZHVtcC5jCmluZGV4IDIzYjM2
MjhkZGUuLmFjNjkwMGUzNGYgMTAwNjQ0Ci0tLSBhL25ldC9kdW1wLmMKKysrIGIvbmV0L2R1bXAu
YwpAQCAtMTkyLDIyICsxOTIsMTggQEAgc3RhdGljIHZvaWQgZmlsdGVyX2R1bXBfc2V0X21heGxl
bihPYmplY3QgKm9iaiwgVmlzaXRvciAqdiwgY29uc3QgY2hhciAqbmFtZSwKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqb3BhcXVlLCBFcnJvciAqKmVycnApCiB7CiAg
ICAgTmV0RmlsdGVyRHVtcFN0YXRlICpuZmRzID0gRklMVEVSX0RVTVAob2JqKTsKLSAgICBFcnJv
ciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICB1aW50MzJfdCB2YWx1ZTsKIAotICAgIHZpc2l0X3R5
cGVfdWludDMyKHYsIG5hbWUsICZ2YWx1ZSwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2Vy
cikgewotICAgICAgICBnb3RvIG91dDsKKyAgICB2aXNpdF90eXBlX3VpbnQzMih2LCBuYW1lLCAm
dmFsdWUsIGVycnApOworICAgIGlmICgqZXJycCkgeworICAgICAgICByZXR1cm47CiAgICAgfQog
ICAgIGlmICh2YWx1ZSA9PSAwKSB7Ci0gICAgICAgIGVycm9yX3NldGcoJmxvY2FsX2VyciwgIlBy
b3BlcnR5ICclcy4lcycgZG9lc24ndCB0YWtlIHZhbHVlICcldSciLAorICAgICAgICBlcnJvcl9z
ZXRnKGVycnAsICJQcm9wZXJ0eSAnJXMuJXMnIGRvZXNuJ3QgdGFrZSB2YWx1ZSAnJXUnIiwKICAg
ICAgICAgICAgICAgICAgICBvYmplY3RfZ2V0X3R5cGVuYW1lKG9iaiksIG5hbWUsIHZhbHVlKTsK
LSAgICAgICAgZ290byBvdXQ7CisgICAgICAgIHJldHVybjsKICAgICB9CiAgICAgbmZkcy0+bWF4
bGVuID0gdmFsdWU7Ci0KLW91dDoKLSAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJy
KTsKIH0KIAogc3RhdGljIGNoYXIgKmZpbGVfZHVtcF9nZXRfZmlsZW5hbWUoT2JqZWN0ICpvYmos
IEVycm9yICoqZXJycCkKZGlmZiAtLWdpdCBhL25ldC9maWx0ZXItYnVmZmVyLmMgYi9uZXQvZmls
dGVyLWJ1ZmZlci5jCmluZGV4IDg4ZGE3OGY4MjEuLjY5ZjM3ZTI3M2IgMTAwNjQ0Ci0tLSBhL25l
dC9maWx0ZXItYnVmZmVyLmMKKysrIGIvbmV0L2ZpbHRlci1idWZmZXIuYwpAQCAtMTcwLDIyICsx
NzAsMTggQEAgc3RhdGljIHZvaWQgZmlsdGVyX2J1ZmZlcl9zZXRfaW50ZXJ2YWwoT2JqZWN0ICpv
YmosIFZpc2l0b3IgKnYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBF
cnJvciAqKmVycnApCiB7CiAgICAgRmlsdGVyQnVmZmVyU3RhdGUgKnMgPSBGSUxURVJfQlVGRkVS
KG9iaik7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgdWludDMyX3QgdmFsdWU7
CiAKLSAgICB2aXNpdF90eXBlX3VpbnQzMih2LCBuYW1lLCAmdmFsdWUsICZsb2NhbF9lcnIpOwot
ICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZ290byBvdXQ7CisgICAgdmlzaXRfdHlwZV91
aW50MzIodiwgbmFtZSwgJnZhbHVlLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKKyAgICAgICAg
cmV0dXJuOwogICAgIH0KICAgICBpZiAoIXZhbHVlKSB7Ci0gICAgICAgIGVycm9yX3NldGcoJmxv
Y2FsX2VyciwgIlByb3BlcnR5ICclcy4lcycgcmVxdWlyZXMgYSBwb3NpdGl2ZSB2YWx1ZSIsCisg
ICAgICAgIGVycm9yX3NldGcoZXJycCwgIlByb3BlcnR5ICclcy4lcycgcmVxdWlyZXMgYSBwb3Np
dGl2ZSB2YWx1ZSIsCiAgICAgICAgICAgICAgICAgICAgb2JqZWN0X2dldF90eXBlbmFtZShvYmop
LCBuYW1lKTsKLSAgICAgICAgZ290byBvdXQ7CisgICAgICAgIHJldHVybjsKICAgICB9CiAgICAg
cy0+aW50ZXJ2YWwgPSB2YWx1ZTsKLQotb3V0OgotICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBs
b2NhbF9lcnIpOwogfQogCiBzdGF0aWMgdm9pZCBmaWx0ZXJfYnVmZmVyX2luaXQoT2JqZWN0ICpv
YmopCmRpZmYgLS1naXQgYS9uZXQvZmlsdGVyLmMgYi9uZXQvZmlsdGVyLmMKaW5kZXggNGI5MzJl
NzlmOS4uMTE0NzIzYTZkYiAxMDA2NDQKLS0tIGEvbmV0L2ZpbHRlci5jCisrKyBiL25ldC9maWx0
ZXIuYwpAQCAtMTk1LDcgKzE5NSw2IEBAIHN0YXRpYyB2b2lkIG5ldGZpbHRlcl9jb21wbGV0ZShV
c2VyQ3JlYXRhYmxlICp1YywgRXJyb3IgKiplcnJwKQogICAgIE5ldENsaWVudFN0YXRlICpuY3Nb
TUFYX1FVRVVFX05VTV07CiAgICAgTmV0RmlsdGVyQ2xhc3MgKm5mYyA9IE5FVEZJTFRFUl9HRVRf
Q0xBU1ModWMpOwogICAgIGludCBxdWV1ZXM7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7
CiAKICAgICBpZiAoIW5mLT5uZXRkZXZfaWQpIHsKICAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAi
UGFyYW1ldGVyICduZXRkZXYnIGlzIHJlcXVpcmVkIik7CkBAIC0yMjIsOSArMjIxLDggQEAgc3Rh
dGljIHZvaWQgbmV0ZmlsdGVyX2NvbXBsZXRlKFVzZXJDcmVhdGFibGUgKnVjLCBFcnJvciAqKmVy
cnApCiAgICAgbmYtPm5ldGRldiA9IG5jc1swXTsKIAogICAgIGlmIChuZmMtPnNldHVwKSB7Ci0g
ICAgICAgIG5mYy0+c2V0dXAobmYsICZsb2NhbF9lcnIpOwotICAgICAgICBpZiAobG9jYWxfZXJy
KSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAg
ICAgbmZjLT5zZXR1cChuZiwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAg
ICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgfQpkaWZmIC0tZ2l0IGEvbmV0L25ldC5jIGIvbmV0
L25ldC5jCmluZGV4IDVmYzcyNTExYzEuLmVhODk3NWIyMTkgMTAwNjQ0Ci0tLSBhL25ldC9uZXQu
YworKysgYi9uZXQvbmV0LmMKQEAgLTExMDAsNyArMTEwMCw2IEBAIHN0YXRpYyBpbnQgbmV0X2Ns
aWVudF9pbml0KFFlbXVPcHRzICpvcHRzLCBib29sIGlzX25ldGRldiwgRXJyb3IgKiplcnJwKQog
ewogICAgIGdjaGFyICoqc3Vic3RyaW5ncyA9IE5VTEw7CiAgICAgdm9pZCAqb2JqZWN0ID0gTlVM
TDsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKICAgICBpbnQgcmV0ID0gLTE7CiAgICAgVmlzaXRv
ciAqdiA9IG9wdHNfdmlzaXRvcl9uZXcob3B0cyk7CiAKQEAgLTExNDYsMTMgKzExNDUsMTMgQEAg
c3RhdGljIGludCBuZXRfY2xpZW50X2luaXQoUWVtdU9wdHMgKm9wdHMsIGJvb2wgaXNfbmV0ZGV2
LCBFcnJvciAqKmVycnApCiAgICAgfQogCiAgICAgaWYgKGlzX25ldGRldikgewotICAgICAgICB2
aXNpdF90eXBlX05ldGRldih2LCBOVUxMLCAoTmV0ZGV2ICoqKSZvYmplY3QsICZlcnIpOworICAg
ICAgICB2aXNpdF90eXBlX05ldGRldih2LCBOVUxMLCAoTmV0ZGV2ICoqKSZvYmplY3QsIGVycnAp
OwogICAgIH0gZWxzZSB7Ci0gICAgICAgIHZpc2l0X3R5cGVfTmV0TGVnYWN5KHYsIE5VTEwsIChO
ZXRMZWdhY3kgKiopJm9iamVjdCwgJmVycik7CisgICAgICAgIHZpc2l0X3R5cGVfTmV0TGVnYWN5
KHYsIE5VTEwsIChOZXRMZWdhY3kgKiopJm9iamVjdCwgZXJycCk7CiAgICAgfQogCi0gICAgaWYg
KCFlcnIpIHsKLSAgICAgICAgcmV0ID0gbmV0X2NsaWVudF9pbml0MShvYmplY3QsIGlzX25ldGRl
diwgJmVycik7CisgICAgaWYgKCEqZXJycCkgeworICAgICAgICByZXQgPSBuZXRfY2xpZW50X2lu
aXQxKG9iamVjdCwgaXNfbmV0ZGV2LCBlcnJwKTsKICAgICB9CiAKICAgICBpZiAoaXNfbmV0ZGV2
KSB7CkBAIC0xMTYyLDcgKzExNjEsNiBAQCBzdGF0aWMgaW50IG5ldF9jbGllbnRfaW5pdChRZW11
T3B0cyAqb3B0cywgYm9vbCBpc19uZXRkZXYsIEVycm9yICoqZXJycCkKICAgICB9CiAKIG91dDoK
LSAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKICAgICBnX3N0cmZyZWV2KHN1YnN0cmlu
Z3MpOwogICAgIHZpc2l0X2ZyZWUodik7CiAgICAgcmV0dXJuIHJldDsKQEAgLTExNzUsMjggKzEx
NzMsMjQgQEAgdm9pZCBuZXRkZXZfYWRkKFFlbXVPcHRzICpvcHRzLCBFcnJvciAqKmVycnApCiAK
IHZvaWQgcW1wX25ldGRldl9hZGQoUURpY3QgKnFkaWN0LCBRT2JqZWN0ICoqcmV0LCBFcnJvciAq
KmVycnApCiB7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgUWVtdU9wdHNMaXN0
ICpvcHRzX2xpc3Q7CiAgICAgUWVtdU9wdHMgKm9wdHM7CiAKLSAgICBvcHRzX2xpc3QgPSBxZW11
X2ZpbmRfb3B0c19lcnIoIm5ldGRldiIsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIp
IHsKLSAgICAgICAgZ290byBvdXQ7CisgICAgb3B0c19saXN0ID0gcWVtdV9maW5kX29wdHNfZXJy
KCJuZXRkZXYiLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKKyAgICAgICAgcmV0dXJuOwogICAg
IH0KIAotICAgIG9wdHMgPSBxZW11X29wdHNfZnJvbV9xZGljdChvcHRzX2xpc3QsIHFkaWN0LCAm
bG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGdvdG8gb3V0OworICAg
IG9wdHMgPSBxZW11X29wdHNfZnJvbV9xZGljdChvcHRzX2xpc3QsIHFkaWN0LCBlcnJwKTsKKyAg
ICBpZiAoKmVycnApIHsKKyAgICAgICAgcmV0dXJuOwogICAgIH0KIAotICAgIG5ldGRldl9hZGQo
b3B0cywgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgeworICAgIG5ldGRldl9hZGQo
b3B0cywgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHFlbXVfb3B0c19kZWwob3B0
cyk7Ci0gICAgICAgIGdvdG8gb3V0OworICAgICAgICByZXR1cm47CiAgICAgfQotCi1vdXQ6Ci0g
ICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CiB9CiAKIHZvaWQgcW1wX25ldGRl
dl9kZWwoY29uc3QgY2hhciAqaWQsIEVycm9yICoqZXJycCkKQEAgLTEzNTQsMTQgKzEzNDgsMTIg
QEAgdm9pZCBjb2xvX25vdGlmeV9maWx0ZXJzX2V2ZW50KGludCBldmVudCwgRXJyb3IgKiplcnJw
KQogICAgIE5ldENsaWVudFN0YXRlICpuYzsKICAgICBOZXRGaWx0ZXJTdGF0ZSAqbmY7CiAgICAg
TmV0RmlsdGVyQ2xhc3MgKm5mYyA9IE5VTEw7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7
CiAKICAgICBRVEFJTFFfRk9SRUFDSChuYywgJm5ldF9jbGllbnRzLCBuZXh0KSB7CiAgICAgICAg
IFFUQUlMUV9GT1JFQUNIKG5mLCAmbmMtPmZpbHRlcnMsIG5leHQpIHsKICAgICAgICAgICAgIG5m
YyA9IE5FVEZJTFRFUl9HRVRfQ0xBU1MoT0JKRUNUKG5mKSk7Ci0gICAgICAgICAgICBuZmMtPmhh
bmRsZV9ldmVudChuZiwgZXZlbnQsICZsb2NhbF9lcnIpOwotICAgICAgICAgICAgaWYgKGxvY2Fs
X2VycikgewotICAgICAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIp
OworICAgICAgICAgICAgbmZjLT5oYW5kbGVfZXZlbnQobmYsIGV2ZW50LCBlcnJwKTsKKyAgICAg
ICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAg
IH0KICAgICAgICAgfQpkaWZmIC0tZ2l0IGEvbmV0L25ldG1hcC5jIGIvbmV0L25ldG1hcC5jCmlu
ZGV4IDM1MGYwOTdmOTEuLjU3YzdkY2RhZWQgMTAwNjQ0Ci0tLSBhL25ldC9uZXRtYXAuYworKysg
Yi9uZXQvbmV0bWFwLmMKQEAgLTQwOSwxMiArNDA5LDEwIEBAIGludCBuZXRfaW5pdF9uZXRtYXAo
Y29uc3QgTmV0ZGV2ICpuZXRkZXYsCiAgICAgY29uc3QgTmV0ZGV2TmV0bWFwT3B0aW9ucyAqbmV0
bWFwX29wdHMgPSAmbmV0ZGV2LT51Lm5ldG1hcDsKICAgICBzdHJ1Y3Qgbm1fZGVzYyAqbm1kOwog
ICAgIE5ldENsaWVudFN0YXRlICpuYzsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKICAgICBOZXRt
YXBTdGF0ZSAqczsKIAotICAgIG5tZCA9IG5ldG1hcF9vcGVuKG5ldG1hcF9vcHRzLCAmZXJyKTsK
LSAgICBpZiAoZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAg
IG5tZCA9IG5ldG1hcF9vcGVuKG5ldG1hcF9vcHRzLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsK
ICAgICAgICAgcmV0dXJuIC0xOwogICAgIH0KICAgICAvKiBDcmVhdGUgdGhlIG9iamVjdC4gKi8K
ZGlmZiAtLWdpdCBhL25ldC9zbGlycC5jIGIvbmV0L3NsaXJwLmMKaW5kZXggZjQyZjQ5NjY0MS4u
MTIxYmM4ZTZhYiAxMDA2NDQKLS0tIGEvbmV0L3NsaXJwLmMKKysrIGIvbmV0L3NsaXJwLmMKQEAg
LTk3OSw3ICs5NzksNiBAQCBzdGF0aWMgaW50IHNsaXJwX2d1ZXN0ZndkKFNsaXJwU3RhdGUgKnMs
IGNvbnN0IGNoYXIgKmNvbmZpZ19zdHIsIEVycm9yICoqZXJycCkKICAgICAgICAgICAgIHJldHVy
biAtMTsKICAgICAgICAgfQogICAgIH0gZWxzZSB7Ci0gICAgICAgIEVycm9yICplcnIgPSBOVUxM
OwogICAgICAgICAvKgogICAgICAgICAgKiBGSVhNRTogc3VyZSB3ZSB3YW50IHRvIHN1cHBvcnQg
aW1wbGljaXQKICAgICAgICAgICogbXV4ZWQgbW9uaXRvcnMgaGVyZT8KQEAgLTk5Myw5ICs5OTIs
OCBAQCBzdGF0aWMgaW50IHNsaXJwX2d1ZXN0ZndkKFNsaXJwU3RhdGUgKnMsIGNvbnN0IGNoYXIg
KmNvbmZpZ19zdHIsIEVycm9yICoqZXJycCkKICAgICAgICAgfQogCiAgICAgICAgIGZ3ZCA9IGdf
bmV3KHN0cnVjdCBHdWVzdEZ3ZCwgMSk7Ci0gICAgICAgIHFlbXVfY2hyX2ZlX2luaXQoJmZ3ZC0+
aGQsIGNociwgJmVycik7Ci0gICAgICAgIGlmIChlcnIpIHsKLSAgICAgICAgICAgIGVycm9yX3By
b3BhZ2F0ZShlcnJwLCBlcnIpOworICAgICAgICBxZW11X2Nocl9mZV9pbml0KCZmd2QtPmhkLCBj
aHIsIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIG9iamVjdF91bnBh
cmVudChPQkpFQ1QoY2hyKSk7CiAgICAgICAgICAgICBnX2ZyZWUoZndkKTsKICAgICAgICAgICAg
IHJldHVybiAtMTsKZGlmZiAtLWdpdCBhL25ldC90YXAtYnNkLmMgYi9uZXQvdGFwLWJzZC5jCmlu
ZGV4IGE1YzM3MDdmODAuLjBlYjgzNmEwMjAgMTAwNjQ0Ci0tLSBhL25ldC90YXAtYnNkLmMKKysr
IGIvbmV0L3RhcC1ic2QuYwpAQCAtMjA5LDYgKzIwOSw3IEBAIGVycm9yOgogCiB2b2lkIHRhcF9z
ZXRfc25kYnVmKGludCBmZCwgY29uc3QgTmV0ZGV2VGFwT3B0aW9ucyAqdGFwLCBFcnJvciAqKmVy
cnApCiB7CisJRVJSUF9GVU5DVElPTl9CRUdJTigpOwogfQogCiBpbnQgdGFwX3Byb2JlX3ZuZXRf
aGRyKGludCBmZCkKZGlmZiAtLWdpdCBhL25ldC90YXAtc29sYXJpcy5jIGIvbmV0L3RhcC1zb2xh
cmlzLmMKaW5kZXggNDcyNWQyMzE0ZS4uMTRmMjAxZmNlZCAxMDA2NDQKLS0tIGEvbmV0L3RhcC1z
b2xhcmlzLmMKKysrIGIvbmV0L3RhcC1zb2xhcmlzLmMKQEAgLTIwNCw2ICsyMDQsNyBAQCBpbnQg
dGFwX29wZW4oY2hhciAqaWZuYW1lLCBpbnQgaWZuYW1lX3NpemUsIGludCAqdm5ldF9oZHIsCiAK
IHZvaWQgdGFwX3NldF9zbmRidWYoaW50IGZkLCBjb25zdCBOZXRkZXZUYXBPcHRpb25zICp0YXAs
IEVycm9yICoqZXJycCkKIHsKKwlFUlJQX0ZVTkNUSU9OX0JFR0lOKCk7CiB9CiAKIGludCB0YXBf
cHJvYmVfdm5ldF9oZHIoaW50IGZkKQpkaWZmIC0tZ2l0IGEvbmV0L3RhcC1zdHViLmMgYi9uZXQv
dGFwLXN0dWIuYwppbmRleCBhOWFiOGY4MjkzLi4zMmFiYjU0YmM5IDEwMDY0NAotLS0gYS9uZXQv
dGFwLXN0dWIuYworKysgYi9uZXQvdGFwLXN0dWIuYwpAQCAtMzUsNiArMzUsNyBAQCBpbnQgdGFw
X29wZW4oY2hhciAqaWZuYW1lLCBpbnQgaWZuYW1lX3NpemUsIGludCAqdm5ldF9oZHIsCiAKIHZv
aWQgdGFwX3NldF9zbmRidWYoaW50IGZkLCBjb25zdCBOZXRkZXZUYXBPcHRpb25zICp0YXAsIEVy
cm9yICoqZXJycCkKIHsKKwlFUlJQX0ZVTkNUSU9OX0JFR0lOKCk7CiB9CiAKIGludCB0YXBfcHJv
YmVfdm5ldF9oZHIoaW50IGZkKQpkaWZmIC0tZ2l0IGEvbmV0L3RhcC5jIGIvbmV0L3RhcC5jCmlu
ZGV4IDYyMDdmNjFmODQuLmNjYTg3ZmU3ODcgMTAwNjQ0Ci0tLSBhL25ldC90YXAuYworKysgYi9u
ZXQvdGFwLmMKQEAgLTYxMCw3ICs2MTAsNiBAQCBzdGF0aWMgaW50IG5ldF90YXBfaW5pdChjb25z
dCBOZXRkZXZUYXBPcHRpb25zICp0YXAsIGludCAqdm5ldF9oZHIsCiAgICAgICAgICAgICAgICAg
ICAgICAgICBjb25zdCBjaGFyICpzZXR1cF9zY3JpcHQsIGNoYXIgKmlmbmFtZSwKICAgICAgICAg
ICAgICAgICAgICAgICAgIHNpemVfdCBpZm5hbWVfc3osIGludCBtcV9yZXF1aXJlZCwgRXJyb3Ig
KiplcnJwKQogewotICAgIEVycm9yICplcnIgPSBOVUxMOwogICAgIGludCBmZCwgdm5ldF9oZHJf
cmVxdWlyZWQ7CiAKICAgICBpZiAodGFwLT5oYXNfdm5ldF9oZHIpIHsKQEAgLTYzMCw5ICs2Mjks
OCBAQCBzdGF0aWMgaW50IG5ldF90YXBfaW5pdChjb25zdCBOZXRkZXZUYXBPcHRpb25zICp0YXAs
IGludCAqdm5ldF9oZHIsCiAgICAgaWYgKHNldHVwX3NjcmlwdCAmJgogICAgICAgICBzZXR1cF9z
Y3JpcHRbMF0gIT0gJ1wwJyAmJgogICAgICAgICBzdHJjbXAoc2V0dXBfc2NyaXB0LCAibm8iKSAh
PSAwKSB7Ci0gICAgICAgIGxhdW5jaF9zY3JpcHQoc2V0dXBfc2NyaXB0LCBpZm5hbWUsIGZkLCAm
ZXJyKTsKLSAgICAgICAgaWYgKGVycikgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVy
cnAsIGVycik7CisgICAgICAgIGxhdW5jaF9zY3JpcHQoc2V0dXBfc2NyaXB0LCBpZm5hbWUsIGZk
LCBlcnJwKTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICBjbG9zZShmZCk7CiAg
ICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgIH0KQEAgLTY0OSwxMyArNjQ3LDExIEBAIHN0
YXRpYyB2b2lkIG5ldF9pbml0X3RhcF9vbmUoY29uc3QgTmV0ZGV2VGFwT3B0aW9ucyAqdGFwLCBO
ZXRDbGllbnRTdGF0ZSAqcGVlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qg
Y2hhciAqZG93bnNjcmlwdCwgY29uc3QgY2hhciAqdmhvc3RmZG5hbWUsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGludCB2bmV0X2hkciwgaW50IGZkLCBFcnJvciAqKmVycnApCiB7Ci0g
ICAgRXJyb3IgKmVyciA9IE5VTEw7CiAgICAgVEFQU3RhdGUgKnMgPSBuZXRfdGFwX2ZkX2luaXQo
cGVlciwgbW9kZWwsIG5hbWUsIGZkLCB2bmV0X2hkcik7CiAgICAgaW50IHZob3N0ZmQ7CiAKLSAg
ICB0YXBfc2V0X3NuZGJ1ZihzLT5mZCwgdGFwLCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7Ci0gICAg
ICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgIHRhcF9zZXRfc25kYnVmKHMtPmZk
LCB0YXAsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQog
CkBAIC02ODksMTIgKzY4NSwxMSBAQCBzdGF0aWMgdm9pZCBuZXRfaW5pdF90YXBfb25lKGNvbnN0
IE5ldGRldlRhcE9wdGlvbnMgKnRhcCwgTmV0Q2xpZW50U3RhdGUgKnBlZXIsCiAgICAgICAgIH0K
IAogICAgICAgICBpZiAodmhvc3RmZG5hbWUpIHsKLSAgICAgICAgICAgIHZob3N0ZmQgPSBtb25p
dG9yX2ZkX3BhcmFtKGN1cl9tb24sIHZob3N0ZmRuYW1lLCAmZXJyKTsKKyAgICAgICAgICAgIHZo
b3N0ZmQgPSBtb25pdG9yX2ZkX3BhcmFtKGN1cl9tb24sIHZob3N0ZmRuYW1lLCBlcnJwKTsKICAg
ICAgICAgICAgIGlmICh2aG9zdGZkID09IC0xKSB7CiAgICAgICAgICAgICAgICAgaWYgKHRhcC0+
aGFzX3Zob3N0Zm9yY2UgJiYgdGFwLT52aG9zdGZvcmNlKSB7Ci0gICAgICAgICAgICAgICAgICAg
IGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOwogICAgICAgICAgICAgICAgIH0gZWxzZSB7Ci0g
ICAgICAgICAgICAgICAgICAgIHdhcm5fcmVwb3J0X2VycihlcnIpOworICAgICAgICAgICAgICAg
ICAgICB3YXJuX3JlcG9ydF9lcnJwKGVycnApOwogICAgICAgICAgICAgICAgIH0KICAgICAgICAg
ICAgICAgICByZXR1cm47CiAgICAgICAgICAgICB9CkBAIC03NjMsNyArNzU4LDYgQEAgaW50IG5l
dF9pbml0X3RhcChjb25zdCBOZXRkZXYgKm5ldGRldiwgY29uc3QgY2hhciAqbmFtZSwKICAgICAv
KiBmb3IgdGhlIG5vLWZkLCBuby1oZWxwZXIgY2FzZSAqLwogICAgIGNvbnN0IGNoYXIgKnNjcmlw
dCA9IE5VTEw7IC8qIHN1cHByZXNzIHdyb25nICJ1bmluaXQnZCB1c2UiIGdjYyB3YXJuaW5nICov
CiAgICAgY29uc3QgY2hhciAqZG93bnNjcmlwdCA9IE5VTEw7Ci0gICAgRXJyb3IgKmVyciA9IE5V
TEw7CiAgICAgY29uc3QgY2hhciAqdmhvc3RmZG5hbWU7CiAgICAgY2hhciBpZm5hbWVbMTI4XTsK
IApAQCAtNzg5LDkgKzc4Myw4IEBAIGludCBuZXRfaW5pdF90YXAoY29uc3QgTmV0ZGV2ICpuZXRk
ZXYsIGNvbnN0IGNoYXIgKm5hbWUsCiAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgIH0K
IAotICAgICAgICBmZCA9IG1vbml0b3JfZmRfcGFyYW0oY3VyX21vbiwgdGFwLT5mZCwgJmVycik7
CisgICAgICAgIGZkID0gbW9uaXRvcl9mZF9wYXJhbShjdXJfbW9uLCB0YXAtPmZkLCBlcnJwKTsK
ICAgICAgICAgaWYgKGZkID09IC0xKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJy
cCwgZXJyKTsKICAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgfQogCkBAIC04MDEsOSAr
Nzk0LDggQEAgaW50IG5ldF9pbml0X3RhcChjb25zdCBOZXRkZXYgKm5ldGRldiwgY29uc3QgY2hh
ciAqbmFtZSwKIAogICAgICAgICBuZXRfaW5pdF90YXBfb25lKHRhcCwgcGVlciwgInRhcCIsIG5h
bWUsIE5VTEwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgc2NyaXB0LCBkb3duc2NyaXB0LAot
ICAgICAgICAgICAgICAgICAgICAgICAgIHZob3N0ZmRuYW1lLCB2bmV0X2hkciwgZmQsICZlcnIp
OwotICAgICAgICBpZiAoZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwg
ZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICB2aG9zdGZkbmFtZSwgdm5ldF9oZHIsIGZk
LCBlcnJwKTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICByZXR1cm4gLTE7CiAg
ICAgICAgIH0KICAgICB9IGVsc2UgaWYgKHRhcC0+aGFzX2ZkcykgewpAQCAtODM2LDkgKzgyOCw4
IEBAIGludCBuZXRfaW5pdF90YXAoY29uc3QgTmV0ZGV2ICpuZXRkZXYsIGNvbnN0IGNoYXIgKm5h
bWUsCiAgICAgICAgIH0KIAogICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbmZkczsgaSsrKSB7Ci0g
ICAgICAgICAgICBmZCA9IG1vbml0b3JfZmRfcGFyYW0oY3VyX21vbiwgZmRzW2ldLCAmZXJyKTsK
KyAgICAgICAgICAgIGZkID0gbW9uaXRvcl9mZF9wYXJhbShjdXJfbW9uLCBmZHNbaV0sIGVycnAp
OwogICAgICAgICAgICAgaWYgKGZkID09IC0xKSB7Ci0gICAgICAgICAgICAgICAgZXJyb3JfcHJv
cGFnYXRlKGVycnAsIGVycik7CiAgICAgICAgICAgICAgICAgcmV0ID0gLTE7CiAgICAgICAgICAg
ICAgICAgZ290byBmcmVlX2ZhaWw7CiAgICAgICAgICAgICB9CkBAIC04NTcsOSArODQ4LDggQEAg
aW50IG5ldF9pbml0X3RhcChjb25zdCBOZXRkZXYgKm5ldGRldiwgY29uc3QgY2hhciAqbmFtZSwK
ICAgICAgICAgICAgIG5ldF9pbml0X3RhcF9vbmUodGFwLCBwZWVyLCAidGFwIiwgbmFtZSwgaWZu
YW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JpcHQsIGRvd25zY3JpcHQsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcC0+aGFzX3Zob3N0ZmRzID8gdmhvc3RfZmRz
W2ldIDogTlVMTCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm5ldF9oZHIsIGZkLCAm
ZXJyKTsKLSAgICAgICAgICAgIGlmIChlcnIpIHsKLSAgICAgICAgICAgICAgICBlcnJvcl9wcm9w
YWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm5ldF9oZHIs
IGZkLCBlcnJwKTsKKyAgICAgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgICAgIHJl
dCA9IC0xOwogICAgICAgICAgICAgICAgIGdvdG8gZnJlZV9mYWlsOwogICAgICAgICAgICAgfQpA
QCAtODk2LDkgKzg4Niw4IEBAIGZyZWVfZmFpbDoKIAogICAgICAgICBuZXRfaW5pdF90YXBfb25l
KHRhcCwgcGVlciwgImJyaWRnZSIsIG5hbWUsIGlmbmFtZSwKICAgICAgICAgICAgICAgICAgICAg
ICAgICBzY3JpcHQsIGRvd25zY3JpcHQsIHZob3N0ZmRuYW1lLAotICAgICAgICAgICAgICAgICAg
ICAgICAgIHZuZXRfaGRyLCBmZCwgJmVycik7Ci0gICAgICAgIGlmIChlcnIpIHsKLSAgICAgICAg
ICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgICAgICAgICAgICAgICAgICAgICAg
IHZuZXRfaGRyLCBmZCwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAg
Y2xvc2UoZmQpOwogICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICB9CkBAIC05MzUsOSAr
OTI0LDggQEAgZnJlZV9mYWlsOgogICAgICAgICAgICAgbmV0X2luaXRfdGFwX29uZSh0YXAsIHBl
ZXIsICJ0YXAiLCBuYW1lLCBpZm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkg
Pj0gMSA/ICJubyIgOiBzY3JpcHQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgPj0g
MSA/ICJubyIgOiBkb3duc2NyaXB0LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aG9z
dGZkbmFtZSwgdm5ldF9oZHIsIGZkLCAmZXJyKTsKLSAgICAgICAgICAgIGlmIChlcnIpIHsKLSAg
ICAgICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgdmhvc3RmZG5hbWUsIHZuZXRfaGRyLCBmZCwgZXJycCk7CisgICAgICAg
ICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgICAgICBjbG9zZShmZCk7CiAgICAgICAgICAg
ICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICAgfQpkaWZmIC0tZ2l0IGEvcWFwaS9vcHRzLXZp
c2l0b3IuYyBiL3FhcGkvb3B0cy12aXNpdG9yLmMKaW5kZXggMzI0YjE5NzQ5NS4uMzVjNTEwYzk1
OSAxMDA2NDQKLS0tIGEvcWFwaS9vcHRzLXZpc2l0b3IuYworKysgYi9xYXBpL29wdHMtdmlzaXRv
ci5jCkBAIC0yNzUsNiArMjc1LDcgQEAgb3B0c19uZXh0X2xpc3QoVmlzaXRvciAqdiwgR2VuZXJp
Y0xpc3QgKnRhaWwsIHNpemVfdCBzaXplKQogc3RhdGljIHZvaWQKIG9wdHNfY2hlY2tfbGlzdChW
aXNpdG9yICp2LCBFcnJvciAqKmVycnApCiB7CisJRVJSUF9GVU5DVElPTl9CRUdJTigpOwogICAg
IC8qCiAgICAgICogVW52aXNpdGVkIGxpc3QgZWxlbWVudHMgd2lsbCBiZSByZXBvcnRlZCBsYXRl
ciB3aGVuIGNoZWNraW5nCiAgICAgICogd2hldGhlciB1bnZpc2l0ZWQgc3RydWN0IG1lbWJlcnMg
cmVtYWluLgpkaWZmIC0tZ2l0IGEvcWFwaS9xYXBpLWRlYWxsb2MtdmlzaXRvci5jIGIvcWFwaS9x
YXBpLWRlYWxsb2MtdmlzaXRvci5jCmluZGV4IGQxOTI3MjRiMTMuLjNlZTRjN2EyZTcgMTAwNjQ0
Ci0tLSBhL3FhcGkvcWFwaS1kZWFsbG9jLXZpc2l0b3IuYworKysgYi9xYXBpL3FhcGktZGVhbGxv
Yy12aXNpdG9yLmMKQEAgLTI1LDYgKzI1LDcgQEAgc3RydWN0IFFhcGlEZWFsbG9jVmlzaXRvcgog
c3RhdGljIHZvaWQgcWFwaV9kZWFsbG9jX3N0YXJ0X3N0cnVjdChWaXNpdG9yICp2LCBjb25zdCBj
aGFyICpuYW1lLCB2b2lkICoqb2JqLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBzaXplX3QgdW51c2VkLCBFcnJvciAqKmVycnApCiB7CisJRVJSUF9GVU5DVElPTl9CRUdJ
TigpOwogfQogCiBzdGF0aWMgdm9pZCBxYXBpX2RlYWxsb2NfZW5kX3N0cnVjdChWaXNpdG9yICp2
LCB2b2lkICoqb2JqKQpAQCAtMzgsNiArMzksNyBAQCBzdGF0aWMgdm9pZCBxYXBpX2RlYWxsb2Nf
c3RhcnRfYWx0ZXJuYXRlKFZpc2l0b3IgKnYsIGNvbnN0IGNoYXIgKm5hbWUsCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdlbmVyaWNBbHRlcm5hdGUgKipvYmosIHNp
emVfdCBzaXplLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcnJv
ciAqKmVycnApCiB7CisJRVJSUF9GVU5DVElPTl9CRUdJTigpOwogfQogCiBzdGF0aWMgdm9pZCBx
YXBpX2RlYWxsb2NfZW5kX2FsdGVybmF0ZShWaXNpdG9yICp2LCB2b2lkICoqb2JqKQpAQCAtNTEs
NiArNTMsNyBAQCBzdGF0aWMgdm9pZCBxYXBpX2RlYWxsb2Nfc3RhcnRfbGlzdChWaXNpdG9yICp2
LCBjb25zdCBjaGFyICpuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
R2VuZXJpY0xpc3QgKipsaXN0LCBzaXplX3Qgc2l6ZSwKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIEVycm9yICoqZXJycCkKIHsKKwlFUlJQX0ZVTkNUSU9OX0JFR0lOKCk7CiB9
CiAKIHN0YXRpYyBHZW5lcmljTGlzdCAqcWFwaV9kZWFsbG9jX25leHRfbGlzdChWaXNpdG9yICp2
LCBHZW5lcmljTGlzdCAqdGFpbCwKQEAgLTc2LDIxICs3OSwyNSBAQCBzdGF0aWMgdm9pZCBxYXBp
X2RlYWxsb2NfdHlwZV9zdHIoVmlzaXRvciAqdiwgY29uc3QgY2hhciAqbmFtZSwgY2hhciAqKm9i
aiwKIHN0YXRpYyB2b2lkIHFhcGlfZGVhbGxvY190eXBlX2ludDY0KFZpc2l0b3IgKnYsIGNvbnN0
IGNoYXIgKm5hbWUsIGludDY0X3QgKm9iaiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIEVycm9yICoqZXJycCkKIHsKKwlFUlJQX0ZVTkNUSU9OX0JFR0lOKCk7CiB9CiAKIHN0
YXRpYyB2b2lkIHFhcGlfZGVhbGxvY190eXBlX3VpbnQ2NChWaXNpdG9yICp2LCBjb25zdCBjaGFy
ICpuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQ2NF90ICpv
YmosIEVycm9yICoqZXJycCkKIHsKKwlFUlJQX0ZVTkNUSU9OX0JFR0lOKCk7CiB9CiAKIHN0YXRp
YyB2b2lkIHFhcGlfZGVhbGxvY190eXBlX2Jvb2woVmlzaXRvciAqdiwgY29uc3QgY2hhciAqbmFt
ZSwgYm9vbCAqb2JqLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcnJvciAq
KmVycnApCiB7CisJRVJSUF9GVU5DVElPTl9CRUdJTigpOwogfQogCiBzdGF0aWMgdm9pZCBxYXBp
X2RlYWxsb2NfdHlwZV9udW1iZXIoVmlzaXRvciAqdiwgY29uc3QgY2hhciAqbmFtZSwgZG91Ymxl
ICpvYmosCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJw
KQogeworCUVSUlBfRlVOQ1RJT05fQkVHSU4oKTsKIH0KIAogc3RhdGljIHZvaWQgcWFwaV9kZWFs
bG9jX3R5cGVfYW55dGhpbmcoVmlzaXRvciAqdiwgY29uc3QgY2hhciAqbmFtZSwKZGlmZiAtLWdp
dCBhL3FhcGkvcWFwaS12aXNpdC1jb3JlLmMgYi9xYXBpL3FhcGktdmlzaXQtY29yZS5jCmluZGV4
IDUzNjU1NjFiMDcuLjY0OTQzZWJlYjcgMTAwNjQ0Ci0tLSBhL3FhcGkvcWFwaS12aXNpdC1jb3Jl
LmMKKysrIGIvcWFwaS9xYXBpLXZpc2l0LWNvcmUuYwpAQCAtMzksMTggKzM5LDE1IEBAIHZvaWQg
dmlzaXRfZnJlZShWaXNpdG9yICp2KQogdm9pZCB2aXNpdF9zdGFydF9zdHJ1Y3QoVmlzaXRvciAq
diwgY29uc3QgY2hhciAqbmFtZSwgdm9pZCAqKm9iaiwKICAgICAgICAgICAgICAgICAgICAgICAg
IHNpemVfdCBzaXplLCBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7Ci0K
ICAgICB0cmFjZV92aXNpdF9zdGFydF9zdHJ1Y3QodiwgbmFtZSwgb2JqLCBzaXplKTsKICAgICBp
ZiAob2JqKSB7CiAgICAgICAgIGFzc2VydChzaXplKTsKICAgICAgICAgYXNzZXJ0KCEodi0+dHlw
ZSAmIFZJU0lUT1JfT1VUUFVUKSB8fCAqb2JqKTsKICAgICB9Ci0gICAgdi0+c3RhcnRfc3RydWN0
KHYsIG5hbWUsIG9iaiwgc2l6ZSwgJmVycik7CisgICAgdi0+c3RhcnRfc3RydWN0KHYsIG5hbWUs
IG9iaiwgc2l6ZSwgZXJycCk7CiAgICAgaWYgKG9iaiAmJiAodi0+dHlwZSAmIFZJU0lUT1JfSU5Q
VVQpKSB7Ci0gICAgICAgIGFzc2VydCghZXJyICE9ICEqb2JqKTsKKyAgICAgICAgYXNzZXJ0KCEq
ZXJycCAhPSAhKm9iaik7CiAgICAgfQotICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOwog
fQogCiB2b2lkIHZpc2l0X2NoZWNrX3N0cnVjdChWaXNpdG9yICp2LCBFcnJvciAqKmVycnApCkBA
IC03MCwxNSArNjcsMTIgQEAgdm9pZCB2aXNpdF9lbmRfc3RydWN0KFZpc2l0b3IgKnYsIHZvaWQg
KipvYmopCiB2b2lkIHZpc2l0X3N0YXJ0X2xpc3QoVmlzaXRvciAqdiwgY29uc3QgY2hhciAqbmFt
ZSwgR2VuZXJpY0xpc3QgKipsaXN0LAogICAgICAgICAgICAgICAgICAgICAgIHNpemVfdCBzaXpl
LCBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7Ci0KICAgICBhc3NlcnQo
IWxpc3QgfHwgc2l6ZSA+PSBzaXplb2YoR2VuZXJpY0xpc3QpKTsKICAgICB0cmFjZV92aXNpdF9z
dGFydF9saXN0KHYsIG5hbWUsIGxpc3QsIHNpemUpOwotICAgIHYtPnN0YXJ0X2xpc3QodiwgbmFt
ZSwgbGlzdCwgc2l6ZSwgJmVycik7CisgICAgdi0+c3RhcnRfbGlzdCh2LCBuYW1lLCBsaXN0LCBz
aXplLCBlcnJwKTsKICAgICBpZiAobGlzdCAmJiAodi0+dHlwZSAmIFZJU0lUT1JfSU5QVVQpKSB7
Ci0gICAgICAgIGFzc2VydCghKGVyciAmJiAqbGlzdCkpOworICAgICAgICBhc3NlcnQoISgqZXJy
cCAmJiAqbGlzdCkpOwogICAgIH0KLSAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKIH0K
IAogR2VuZXJpY0xpc3QgKnZpc2l0X25leHRfbGlzdChWaXNpdG9yICp2LCBHZW5lcmljTGlzdCAq
dGFpbCwgc2l6ZV90IHNpemUpCkBAIC0xMDYsMTggKzEwMCwxNSBAQCB2b2lkIHZpc2l0X3N0YXJ0
X2FsdGVybmF0ZShWaXNpdG9yICp2LCBjb25zdCBjaGFyICpuYW1lLAogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgR2VuZXJpY0FsdGVybmF0ZSAqKm9iaiwgc2l6ZV90IHNpemUsCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJyb3IgKmVyciA9IE5V
TEw7Ci0KICAgICBhc3NlcnQob2JqICYmIHNpemUgPj0gc2l6ZW9mKEdlbmVyaWNBbHRlcm5hdGUp
KTsKICAgICBhc3NlcnQoISh2LT50eXBlICYgVklTSVRPUl9PVVRQVVQpIHx8ICpvYmopOwogICAg
IHRyYWNlX3Zpc2l0X3N0YXJ0X2FsdGVybmF0ZSh2LCBuYW1lLCBvYmosIHNpemUpOwogICAgIGlm
ICh2LT5zdGFydF9hbHRlcm5hdGUpIHsKLSAgICAgICAgdi0+c3RhcnRfYWx0ZXJuYXRlKHYsIG5h
bWUsIG9iaiwgc2l6ZSwgJmVycik7CisgICAgICAgIHYtPnN0YXJ0X2FsdGVybmF0ZSh2LCBuYW1l
LCBvYmosIHNpemUsIGVycnApOwogICAgIH0KICAgICBpZiAodi0+dHlwZSAmIFZJU0lUT1JfSU5Q
VVQpIHsKLSAgICAgICAgYXNzZXJ0KHYtPnN0YXJ0X2FsdGVybmF0ZSAmJiAhZXJyICE9ICEqb2Jq
KTsKKyAgICAgICAgYXNzZXJ0KHYtPnN0YXJ0X2FsdGVybmF0ZSAmJiAhKmVycnAgIT0gISpvYmop
OwogICAgIH0KLSAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKIH0KIAogdm9pZCB2aXNp
dF9lbmRfYWx0ZXJuYXRlKFZpc2l0b3IgKnYsIHZvaWQgKipvYmopCkBAIC0xNTIsMTIgKzE0Mywx
MCBAQCB2b2lkIHZpc2l0X3R5cGVfaW50KFZpc2l0b3IgKnYsIGNvbnN0IGNoYXIgKm5hbWUsIGlu
dDY0X3QgKm9iaiwgRXJyb3IgKiplcnJwKQogc3RhdGljIHZvaWQgdmlzaXRfdHlwZV91aW50TihW
aXNpdG9yICp2LCB1aW50NjRfdCAqb2JqLCBjb25zdCBjaGFyICpuYW1lLAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICB1aW50NjRfdCBtYXgsIGNvbnN0IGNoYXIgKnR5cGUsIEVycm9yICoq
ZXJycCkKIHsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKICAgICB1aW50NjRfdCB2YWx1ZSA9ICpv
Ymo7CiAKLSAgICB2LT50eXBlX3VpbnQ2NCh2LCBuYW1lLCAmdmFsdWUsICZlcnIpOwotICAgIGlm
IChlcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgdi0+dHlw
ZV91aW50NjQodiwgbmFtZSwgJnZhbHVlLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICB9
IGVsc2UgaWYgKHZhbHVlID4gbWF4KSB7CiAgICAgICAgIGVycm9yX3NldGcoZXJycCwgUUVSUl9J
TlZBTElEX1BBUkFNRVRFUl9WQUxVRSwKICAgICAgICAgICAgICAgICAgICBuYW1lID8gbmFtZSA6
ICJudWxsIiwgdHlwZSk7CkBAIC0yMTEsMTIgKzIwMCwxMCBAQCBzdGF0aWMgdm9pZCB2aXNpdF90
eXBlX2ludE4oVmlzaXRvciAqdiwgaW50NjRfdCAqb2JqLCBjb25zdCBjaGFyICpuYW1lLAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGludDY0X3QgbWluLCBpbnQ2NF90IG1heCwgY29uc3Qg
Y2hhciAqdHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcnJvciAqKmVycnApCiB7
Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7CiAgICAgaW50NjRfdCB2YWx1ZSA9ICpvYmo7CiAKLSAg
ICB2LT50eXBlX2ludDY0KHYsIG5hbWUsICZ2YWx1ZSwgJmVycik7Ci0gICAgaWYgKGVycikgewot
ICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICB2LT50eXBlX2ludDY0KHYs
IG5hbWUsICZ2YWx1ZSwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgfSBlbHNlIGlmICh2
YWx1ZSA8IG1pbiB8fCB2YWx1ZSA+IG1heCkgewogICAgICAgICBlcnJvcl9zZXRnKGVycnAsIFFF
UlJfSU5WQUxJRF9QQVJBTUVURVJfVkFMVUUsCiAgICAgICAgICAgICAgICAgICAgbmFtZSA/IG5h
bWUgOiAibnVsbCIsIHR5cGUpOwpAQCAtMjg2LDE5ICsyNzMsMTYgQEAgdm9pZCB2aXNpdF90eXBl
X2Jvb2woVmlzaXRvciAqdiwgY29uc3QgY2hhciAqbmFtZSwgYm9vbCAqb2JqLCBFcnJvciAqKmVy
cnApCiAKIHZvaWQgdmlzaXRfdHlwZV9zdHIoVmlzaXRvciAqdiwgY29uc3QgY2hhciAqbmFtZSwg
Y2hhciAqKm9iaiwgRXJyb3IgKiplcnJwKQogewotICAgIEVycm9yICplcnIgPSBOVUxMOwotCiAg
ICAgYXNzZXJ0KG9iaik7CiAgICAgLyogVE9ETzogRml4IGNhbGxlcnMgdG8gbm90IHBhc3MgTlVM
TCB3aGVuIHRoZXkgbWVhbiAiIiwgc28gdGhhdCB3ZQogICAgICAqIGNhbiBlbmFibGU6CiAgICAg
YXNzZXJ0KCEodi0+dHlwZSAmIFZJU0lUT1JfT1VUUFVUKSB8fCAqb2JqKTsKICAgICAgKi8KICAg
ICB0cmFjZV92aXNpdF90eXBlX3N0cih2LCBuYW1lLCBvYmopOwotICAgIHYtPnR5cGVfc3RyKHYs
IG5hbWUsIG9iaiwgJmVycik7CisgICAgdi0+dHlwZV9zdHIodiwgbmFtZSwgb2JqLCBlcnJwKTsK
ICAgICBpZiAodi0+dHlwZSAmIFZJU0lUT1JfSU5QVVQpIHsKLSAgICAgICAgYXNzZXJ0KCFlcnIg
IT0gISpvYmopOworICAgICAgICBhc3NlcnQoISplcnJwICE9ICEqb2JqKTsKICAgICB9Ci0gICAg
ZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CiB9CiAKIHZvaWQgdmlzaXRfdHlwZV9udW1iZXIo
VmlzaXRvciAqdiwgY29uc3QgY2hhciAqbmFtZSwgZG91YmxlICpvYmosCkBAIC0zMTEsMTYgKzI5
NSwxMyBAQCB2b2lkIHZpc2l0X3R5cGVfbnVtYmVyKFZpc2l0b3IgKnYsIGNvbnN0IGNoYXIgKm5h
bWUsIGRvdWJsZSAqb2JqLAogCiB2b2lkIHZpc2l0X3R5cGVfYW55KFZpc2l0b3IgKnYsIGNvbnN0
IGNoYXIgKm5hbWUsIFFPYmplY3QgKipvYmosIEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAq
ZXJyID0gTlVMTDsKLQogICAgIGFzc2VydChvYmopOwogICAgIGFzc2VydCh2LT50eXBlICE9IFZJ
U0lUT1JfT1VUUFVUIHx8ICpvYmopOwogICAgIHRyYWNlX3Zpc2l0X3R5cGVfYW55KHYsIG5hbWUs
IG9iaik7Ci0gICAgdi0+dHlwZV9hbnkodiwgbmFtZSwgb2JqLCAmZXJyKTsKKyAgICB2LT50eXBl
X2FueSh2LCBuYW1lLCBvYmosIGVycnApOwogICAgIGlmICh2LT50eXBlID09IFZJU0lUT1JfSU5Q
VVQpIHsKLSAgICAgICAgYXNzZXJ0KCFlcnIgIT0gISpvYmopOworICAgICAgICBhc3NlcnQoISpl
cnJwICE9ICEqb2JqKTsKICAgICB9Ci0gICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CiB9
CiAKIHZvaWQgdmlzaXRfdHlwZV9udWxsKFZpc2l0b3IgKnYsIGNvbnN0IGNoYXIgKm5hbWUsIFFO
dWxsICoqb2JqLApAQCAtMzUyLDEzICszMzMsMTEgQEAgc3RhdGljIHZvaWQgb3V0cHV0X3R5cGVf
ZW51bShWaXNpdG9yICp2LCBjb25zdCBjaGFyICpuYW1lLCBpbnQgKm9iaiwKIHN0YXRpYyB2b2lk
IGlucHV0X3R5cGVfZW51bShWaXNpdG9yICp2LCBjb25zdCBjaGFyICpuYW1lLCBpbnQgKm9iaiwK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBRRW51bUxvb2t1cCAqbG9va3VwLCBF
cnJvciAqKmVycnApCiB7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgaW50NjRf
dCB2YWx1ZTsKICAgICBjaGFyICplbnVtX3N0cjsKIAotICAgIHZpc2l0X3R5cGVfc3RyKHYsIG5h
bWUsICZlbnVtX3N0ciwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAg
ICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICB2aXNpdF90eXBlX3N0cih2
LCBuYW1lLCAmZW51bV9zdHIsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1
cm47CiAgICAgfQogCmRpZmYgLS1naXQgYS9xYXBpL3FtcC1kaXNwYXRjaC5jIGIvcWFwaS9xbXAt
ZGlzcGF0Y2guYwppbmRleCAzMDM3ZDM1M2E0Li41Yzc1MzIyYTdkIDEwMDY0NAotLS0gYS9xYXBp
L3FtcC1kaXNwYXRjaC5jCisrKyBiL3FhcGkvcW1wLWRpc3BhdGNoLmMKQEAgLTc4LDcgKzc4LDYg
QEAgc3RhdGljIFFEaWN0ICpxbXBfZGlzcGF0Y2hfY2hlY2tfb2JqKGNvbnN0IFFPYmplY3QgKnJl
cXVlc3QsIGJvb2wgYWxsb3dfb29iLAogc3RhdGljIFFPYmplY3QgKmRvX3FtcF9kaXNwYXRjaChR
bXBDb21tYW5kTGlzdCAqY21kcywgUU9iamVjdCAqcmVxdWVzdCwKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgYm9vbCBhbGxvd19vb2IsIEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJv
ciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBib29sIG9vYjsKICAgICBjb25zdCBjaGFyICpjb21t
YW5kOwogICAgIFFEaWN0ICphcmdzLCAqZGljdDsKQEAgLTEyOCw5ICsxMjcsOCBAQCBzdGF0aWMg
UU9iamVjdCAqZG9fcW1wX2Rpc3BhdGNoKFFtcENvbW1hbmRMaXN0ICpjbWRzLCBRT2JqZWN0ICpy
ZXF1ZXN0LAogICAgICAgICBxb2JqZWN0X3JlZihhcmdzKTsKICAgICB9CiAKLSAgICBjbWQtPmZu
KGFyZ3MsICZyZXQsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAg
ZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgY21kLT5mbihhcmdzLCAmcmV0
LCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICB9IGVsc2UgaWYgKGNtZC0+b3B0aW9ucyAm
IFFDT19OT19TVUNDRVNTX1JFU1ApIHsKICAgICAgICAgZ19hc3NlcnQoIXJldCk7CiAgICAgfSBl
bHNlIGlmICghcmV0KSB7CmRpZmYgLS1naXQgYS9xYXBpL3N0cmluZy1pbnB1dC12aXNpdG9yLmMg
Yi9xYXBpL3N0cmluZy1pbnB1dC12aXNpdG9yLmMKaW5kZXggOWJlNDE4YjZkNi4uMzAyYzVkZGFk
ZiAxMDA2NDQKLS0tIGEvcWFwaS9zdHJpbmctaW5wdXQtdmlzaXRvci5jCisrKyBiL3FhcGkvc3Ry
aW5nLWlucHV0LXZpc2l0b3IuYwpAQCAtMzE0LDEzICszMTQsMTEgQEAgc3RhdGljIHZvaWQgcGFy
c2VfdHlwZV9zaXplKFZpc2l0b3IgKnYsIGNvbnN0IGNoYXIgKm5hbWUsIHVpbnQ2NF90ICpvYmos
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJwKQogewogICAgIFN0cmlu
Z0lucHV0VmlzaXRvciAqc2l2ID0gdG9fc2l2KHYpOwotICAgIEVycm9yICplcnIgPSBOVUxMOwog
ICAgIHVpbnQ2NF90IHZhbDsKIAogICAgIGFzc2VydChzaXYtPmxtID09IExNX05PTkUpOwotICAg
IHBhcnNlX29wdGlvbl9zaXplKG5hbWUsIHNpdi0+c3RyaW5nLCAmdmFsLCAmZXJyKTsKLSAgICBp
ZiAoZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgIHBhcnNl
X29wdGlvbl9zaXplKG5hbWUsIHNpdi0+c3RyaW5nLCAmdmFsLCBlcnJwKTsKKyAgICBpZiAoKmVy
cnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApkaWZmIC0tZ2l0IGEvcWRldi1tb25pdG9y
LmMgYi9xZGV2LW1vbml0b3IuYwppbmRleCAxNDhkZjljYWNmLi5kZDE3YWQ0OTY3IDEwMDY0NAot
LS0gYS9xZGV2LW1vbml0b3IuYworKysgYi9xZGV2LW1vbml0b3IuYwpAQCAtMTcxLDE2ICsxNzEs
MTQgQEAgc3RhdGljIGludCBzZXRfcHJvcGVydHkodm9pZCAqb3BhcXVlLCBjb25zdCBjaGFyICpu
YW1lLCBjb25zdCBjaGFyICp2YWx1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgIEVycm9yICoq
ZXJycCkKIHsKICAgICBPYmplY3QgKm9iaiA9IG9wYXF1ZTsKLSAgICBFcnJvciAqZXJyID0gTlVM
TDsKIAogICAgIGlmIChzdHJjbXAobmFtZSwgImRyaXZlciIpID09IDApCiAgICAgICAgIHJldHVy
biAwOwogICAgIGlmIChzdHJjbXAobmFtZSwgImJ1cyIpID09IDApCiAgICAgICAgIHJldHVybiAw
OwogCi0gICAgb2JqZWN0X3Byb3BlcnR5X3BhcnNlKG9iaiwgdmFsdWUsIG5hbWUsICZlcnIpOwot
ICAgIGlmIChlcnIgIT0gTlVMTCkgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJy
KTsKKyAgICBvYmplY3RfcHJvcGVydHlfcGFyc2Uob2JqLCB2YWx1ZSwgbmFtZSwgZXJycCk7Cisg
ICAgaWYgKCplcnJwICE9IE5VTEwpIHsKICAgICAgICAgcmV0dXJuIC0xOwogICAgIH0KICAgICBy
ZXR1cm4gMDsKQEAgLTU2OCw3ICs1NjYsNiBAQCBEZXZpY2VTdGF0ZSAqcWRldl9kZXZpY2VfYWRk
KFFlbXVPcHRzICpvcHRzLCBFcnJvciAqKmVycnApCiAgICAgY29uc3QgY2hhciAqZHJpdmVyLCAq
cGF0aDsKICAgICBEZXZpY2VTdGF0ZSAqZGV2OwogICAgIEJ1c1N0YXRlICpidXMgPSBOVUxMOwot
ICAgIEVycm9yICplcnIgPSBOVUxMOwogCiAgICAgZHJpdmVyID0gcWVtdV9vcHRfZ2V0KG9wdHMs
ICJkcml2ZXIiKTsKICAgICBpZiAoIWRyaXZlcikgewpAQCAtNjE2LDkgKzYxMyw5IEBAIERldmlj
ZVN0YXRlICpxZGV2X2RldmljZV9hZGQoUWVtdU9wdHMgKm9wdHMsIEVycm9yICoqZXJycCkKICAg
ICBkZXYgPSBERVZJQ0Uob2JqZWN0X25ldyhkcml2ZXIpKTsKIAogICAgIC8qIENoZWNrIHdoZXRo
ZXIgdGhlIGhvdHBsdWcgaXMgYWxsb3dlZCBieSB0aGUgbWFjaGluZSAqLwotICAgIGlmIChxZGV2
X2hvdHBsdWcgJiYgIXFkZXZfaG90cGx1Z19hbGxvd2VkKGRldiwgJmVycikpIHsKKyAgICBpZiAo
cWRldl9ob3RwbHVnICYmICFxZGV2X2hvdHBsdWdfYWxsb3dlZChkZXYsIGVycnApKSB7CiAgICAg
ICAgIC8qIEVycm9yIG11c3QgYmUgc2V0IGluIHRoZSBtYWNoaW5lIGhvb2sgKi8KLSAgICAgICAg
YXNzZXJ0KGVycik7CisgICAgICAgIGFzc2VydCgqZXJycCk7CiAgICAgICAgIGdvdG8gZXJyX2Rl
bF9kZXY7CiAgICAgfQogCkBAIC02MjYsNyArNjIzLDcgQEAgRGV2aWNlU3RhdGUgKnFkZXZfZGV2
aWNlX2FkZChRZW11T3B0cyAqb3B0cywgRXJyb3IgKiplcnJwKQogICAgICAgICBxZGV2X3NldF9w
YXJlbnRfYnVzKGRldiwgYnVzKTsKICAgICB9IGVsc2UgaWYgKHFkZXZfaG90cGx1ZyAmJiAhcWRl
dl9nZXRfbWFjaGluZV9ob3RwbHVnX2hhbmRsZXIoZGV2KSkgewogICAgICAgICAvKiBObyBidXMs
IG5vIG1hY2hpbmUgaG90cGx1ZyBoYW5kbGVyIC0tPiBkZXZpY2UgaXMgbm90IGhvdHBsdWdnYWJs
ZSAqLwotICAgICAgICBlcnJvcl9zZXRnKCZlcnIsICJEZXZpY2UgJyVzJyBjYW4gbm90IGJlIGhv
dHBsdWdnZWQgb24gdGhpcyBtYWNoaW5lIiwKKyAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAiRGV2
aWNlICclcycgY2FuIG5vdCBiZSBob3RwbHVnZ2VkIG9uIHRoaXMgbWFjaGluZSIsCiAgICAgICAg
ICAgICAgICAgICAgZHJpdmVyKTsKICAgICAgICAgZ290byBlcnJfZGVsX2RldjsKICAgICB9CkBA
IC02MzQsMjAgKzYzMSwxOSBAQCBEZXZpY2VTdGF0ZSAqcWRldl9kZXZpY2VfYWRkKFFlbXVPcHRz
ICpvcHRzLCBFcnJvciAqKmVycnApCiAgICAgcWRldl9zZXRfaWQoZGV2LCBxZW11X29wdHNfaWQo
b3B0cykpOwogCiAgICAgLyogc2V0IHByb3BlcnRpZXMgKi8KLSAgICBpZiAocWVtdV9vcHRfZm9y
ZWFjaChvcHRzLCBzZXRfcHJvcGVydHksIGRldiwgJmVycikpIHsKKyAgICBpZiAocWVtdV9vcHRf
Zm9yZWFjaChvcHRzLCBzZXRfcHJvcGVydHksIGRldiwgZXJycCkpIHsKICAgICAgICAgZ290byBl
cnJfZGVsX2RldjsKICAgICB9CiAKICAgICBkZXYtPm9wdHMgPSBvcHRzOwotICAgIG9iamVjdF9w
cm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoZGV2KSwgdHJ1ZSwgInJlYWxpemVkIiwgJmVycik7Ci0g
ICAgaWYgKGVyciAhPSBOVUxMKSB7CisgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVD
VChkZXYpLCB0cnVlLCAicmVhbGl6ZWQiLCBlcnJwKTsKKyAgICBpZiAoKmVycnAgIT0gTlVMTCkg
ewogICAgICAgICBkZXYtPm9wdHMgPSBOVUxMOwogICAgICAgICBnb3RvIGVycl9kZWxfZGV2Owog
ICAgIH0KICAgICByZXR1cm4gZGV2OwogCiBlcnJfZGVsX2RldjoKLSAgICBlcnJvcl9wcm9wYWdh
dGUoZXJycCwgZXJyKTsKICAgICBvYmplY3RfdW5wYXJlbnQoT0JKRUNUKGRldikpOwogICAgIG9i
amVjdF91bnJlZihPQkpFQ1QoZGV2KSk7CiAgICAgcmV0dXJuIE5VTEw7CkBAIC03NDksMjIgKzc0
NSwxOSBAQCB2b2lkIGhtcF9pbmZvX3FkbShNb25pdG9yICptb24sIGNvbnN0IFFEaWN0ICpxZGlj
dCkKIAogdm9pZCBxbXBfZGV2aWNlX2FkZChRRGljdCAqcWRpY3QsIFFPYmplY3QgKipyZXRfZGF0
YSwgRXJyb3IgKiplcnJwKQogewotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIFFl
bXVPcHRzICpvcHRzOwogICAgIERldmljZVN0YXRlICpkZXY7CiAKLSAgICBvcHRzID0gcWVtdV9v
cHRzX2Zyb21fcWRpY3QocWVtdV9maW5kX29wdHMoImRldmljZSIpLCBxZGljdCwgJmxvY2FsX2Vy
cik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwg
bG9jYWxfZXJyKTsKKyAgICBvcHRzID0gcWVtdV9vcHRzX2Zyb21fcWRpY3QocWVtdV9maW5kX29w
dHMoImRldmljZSIpLCBxZGljdCwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJl
dHVybjsKICAgICB9CiAgICAgaWYgKCFtb25pdG9yX2N1cl9pc19xbXAoKSAmJiBxZGV2X2Rldmlj
ZV9oZWxwKG9wdHMpKSB7CiAgICAgICAgIHFlbXVfb3B0c19kZWwob3B0cyk7CiAgICAgICAgIHJl
dHVybjsKICAgICB9Ci0gICAgZGV2ID0gcWRldl9kZXZpY2VfYWRkKG9wdHMsICZsb2NhbF9lcnIp
OworICAgIGRldiA9IHFkZXZfZGV2aWNlX2FkZChvcHRzLCBlcnJwKTsKICAgICBpZiAoIWRldikg
ewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKICAgICAgICAgcWVt
dV9vcHRzX2RlbChvcHRzKTsKICAgICAgICAgcmV0dXJuOwogICAgIH0KQEAgLTgwNSw3ICs3OTgs
NiBAQCB2b2lkIHFkZXZfdW5wbHVnKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAg
ICBEZXZpY2VDbGFzcyAqZGMgPSBERVZJQ0VfR0VUX0NMQVNTKGRldik7CiAgICAgSG90cGx1Z0hh
bmRsZXIgKmhvdHBsdWdfY3RybDsKICAgICBIb3RwbHVnSGFuZGxlckNsYXNzICpoZGM7Ci0gICAg
RXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICBpZiAoZGV2LT5wYXJlbnRfYnVzICYmICFx
YnVzX2lzX2hvdHBsdWdnYWJsZShkZXYtPnBhcmVudF9idXMpKSB7CiAgICAgICAgIGVycm9yX3Nl
dGcoZXJycCwgUUVSUl9CVVNfTk9fSE9UUExVRywgZGV2LT5wYXJlbnRfYnVzLT5uYW1lKTsKQEAg
LTgzNCwxNCArODI2LDEzIEBAIHZvaWQgcWRldl91bnBsdWcoRGV2aWNlU3RhdGUgKmRldiwgRXJy
b3IgKiplcnJwKQogICAgICAqIG90aGVyd2lzZSBqdXN0IHJlbW92ZSBpdCBzeW5jaHJvbm91c2x5
ICovCiAgICAgaGRjID0gSE9UUExVR19IQU5ETEVSX0dFVF9DTEFTUyhob3RwbHVnX2N0cmwpOwog
ICAgIGlmIChoZGMtPnVucGx1Z19yZXF1ZXN0KSB7Ci0gICAgICAgIGhvdHBsdWdfaGFuZGxlcl91
bnBsdWdfcmVxdWVzdChob3RwbHVnX2N0cmwsIGRldiwgJmxvY2FsX2Vycik7CisgICAgICAgIGhv
dHBsdWdfaGFuZGxlcl91bnBsdWdfcmVxdWVzdChob3RwbHVnX2N0cmwsIGRldiwgZXJycCk7CiAg
ICAgfSBlbHNlIHsKLSAgICAgICAgaG90cGx1Z19oYW5kbGVyX3VucGx1Zyhob3RwbHVnX2N0cmws
IGRldiwgJmxvY2FsX2Vycik7Ci0gICAgICAgIGlmICghbG9jYWxfZXJyKSB7CisgICAgICAgIGhv
dHBsdWdfaGFuZGxlcl91bnBsdWcoaG90cGx1Z19jdHJsLCBkZXYsIGVycnApOworICAgICAgICBp
ZiAoISplcnJwKSB7CiAgICAgICAgICAgICBvYmplY3RfdW5wYXJlbnQoT0JKRUNUKGRldikpOwog
ICAgICAgICB9CiAgICAgfQotICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwog
fQogCiB2b2lkIHFtcF9kZXZpY2VfZGVsKGNvbnN0IGNoYXIgKmlkLCBFcnJvciAqKmVycnApCmRp
ZmYgLS1naXQgYS9xZ2EvY29tbWFuZHMtcG9zaXguYyBiL3FnYS9jb21tYW5kcy1wb3NpeC5jCmlu
ZGV4IGRmYzA1ZjViOGEuLmEyODc0ZTI3MmUgMTAwNjQ0Ci0tLSBhL3FnYS9jb21tYW5kcy1wb3Np
eC5jCisrKyBiL3FnYS9jb21tYW5kcy1wb3NpeC5jCkBAIC04Myw3ICs4Myw2IEBAIHN0YXRpYyB2
b2lkIGdhX3dhaXRfY2hpbGQocGlkX3QgcGlkLCBpbnQgKnN0YXR1cywgRXJyb3IgKiplcnJwKQog
dm9pZCBxbXBfZ3Vlc3Rfc2h1dGRvd24oYm9vbCBoYXNfbW9kZSwgY29uc3QgY2hhciAqbW9kZSwg
RXJyb3IgKiplcnJwKQogewogICAgIGNvbnN0IGNoYXIgKnNodXRkb3duX2ZsYWc7Ci0gICAgRXJy
b3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgcGlkX3QgcGlkOwogICAgIGludCBzdGF0dXM7CiAK
QEAgLTExNiw5ICsxMTUsOCBAQCB2b2lkIHFtcF9ndWVzdF9zaHV0ZG93bihib29sIGhhc19tb2Rl
LCBjb25zdCBjaGFyICptb2RlLCBFcnJvciAqKmVycnApCiAgICAgICAgIHJldHVybjsKICAgICB9
CiAKLSAgICBnYV93YWl0X2NoaWxkKHBpZCwgJnN0YXR1cywgJmxvY2FsX2Vycik7Ci0gICAgaWYg
KGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsK
KyAgICBnYV93YWl0X2NoaWxkKHBpZCwgJnN0YXR1cywgZXJycCk7CisgICAgaWYgKCplcnJwKSB7
CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKQEAgLTE1NCw3ICsxNTIsNiBAQCB2b2lkIHFtcF9n
dWVzdF9zZXRfdGltZShib29sIGhhc190aW1lLCBpbnQ2NF90IHRpbWVfbnMsIEVycm9yICoqZXJy
cCkKICAgICBpbnQgcmV0OwogICAgIGludCBzdGF0dXM7CiAgICAgcGlkX3QgcGlkOwotICAgIEVy
cm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIHN0cnVjdCB0aW1ldmFsIHR2OwogCiAgICAgLyog
SWYgdXNlciBoYXMgcGFzc2VkIGEgdGltZSwgdmFsaWRhdGUgYW5kIHNldCBpdC4gKi8KQEAgLTIw
Myw5ICsyMDAsOCBAQCB2b2lkIHFtcF9ndWVzdF9zZXRfdGltZShib29sIGhhc190aW1lLCBpbnQ2
NF90IHRpbWVfbnMsIEVycm9yICoqZXJycCkKICAgICAgICAgcmV0dXJuOwogICAgIH0KIAotICAg
IGdhX3dhaXRfY2hpbGQocGlkLCAmc3RhdHVzLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxf
ZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIGdh
X3dhaXRfY2hpbGQocGlkLCAmc3RhdHVzLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAg
ICAgcmV0dXJuOwogICAgIH0KIApAQCAtMzI4LDExICszMjQsMTAgQEAgZmluZF9vcGVuX2ZsYWco
Y29uc3QgY2hhciAqbW9kZV9zdHIsIEVycm9yICoqZXJycCkKIHN0YXRpYyBGSUxFICoKIHNhZmVf
b3Blbl9vcl9jcmVhdGUoY29uc3QgY2hhciAqcGF0aCwgY29uc3QgY2hhciAqbW9kZSwgRXJyb3Ig
KiplcnJwKQogewotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIGludCBvZmxhZzsK
IAotICAgIG9mbGFnID0gZmluZF9vcGVuX2ZsYWcobW9kZSwgJmxvY2FsX2Vycik7Ci0gICAgaWYg
KGxvY2FsX2VyciA9PSBOVUxMKSB7CisgICAgb2ZsYWcgPSBmaW5kX29wZW5fZmxhZyhtb2RlLCBl
cnJwKTsKKyAgICBpZiAoKmVycnAgPT0gTlVMTCkgewogICAgICAgICBpbnQgZmQ7CiAKICAgICAg
ICAgLyogSWYgdGhlIGNhbGxlciB3YW50cyAvIGFsbG93cyBjcmVhdGlvbiBvZiBhIG5ldyBmaWxl
LCB3ZSBpbXBsZW1lbnQgaXQKQEAgLTM2NCwxMyArMzU5LDEzIEBAIHNhZmVfb3Blbl9vcl9jcmVh
dGUoY29uc3QgY2hhciAqcGF0aCwgY29uc3QgY2hhciAqbW9kZSwgRXJyb3IgKiplcnJwKQogICAg
ICAgICB9CiAKICAgICAgICAgaWYgKGZkID09IC0xKSB7Ci0gICAgICAgICAgICBlcnJvcl9zZXRn
X2Vycm5vKCZsb2NhbF9lcnIsIGVycm5vLCAiZmFpbGVkIHRvIG9wZW4gZmlsZSAnJXMnICIKKyAg
ICAgICAgICAgIGVycm9yX3NldGdfZXJybm8oZXJycCwgZXJybm8sICJmYWlsZWQgdG8gb3BlbiBm
aWxlICclcycgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiKG1vZGU6ICclcycpIiwg
cGF0aCwgbW9kZSk7CiAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICBxZW11X3NldF9jbG9l
eGVjKGZkKTsKIAogICAgICAgICAgICAgaWYgKChvZmxhZyAmIE9fQ1JFQVQpICYmIGZjaG1vZChm
ZCwgREVGQVVMVF9ORVdfRklMRV9NT0RFKSA9PSAtMSkgewotICAgICAgICAgICAgICAgIGVycm9y
X3NldGdfZXJybm8oJmxvY2FsX2VyciwgZXJybm8sICJmYWlsZWQgdG8gc2V0IHBlcm1pc3Npb24g
IgorICAgICAgICAgICAgICAgIGVycm9yX3NldGdfZXJybm8oZXJycCwgZXJybm8sICJmYWlsZWQg
dG8gc2V0IHBlcm1pc3Npb24gIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIjAl
MDNvIG9uIG5ldyBmaWxlICclcycgKG1vZGU6ICclcycpIiwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICh1bnNpZ25lZClERUZBVUxUX05FV19GSUxFX01PREUsIHBhdGgsIG1vZGUp
OwogICAgICAgICAgICAgfSBlbHNlIHsKQEAgLTM3OCw3ICszNzMsNyBAQCBzYWZlX29wZW5fb3Jf
Y3JlYXRlKGNvbnN0IGNoYXIgKnBhdGgsIGNvbnN0IGNoYXIgKm1vZGUsIEVycm9yICoqZXJycCkK
IAogICAgICAgICAgICAgICAgIGYgPSBmZG9wZW4oZmQsIG1vZGUpOwogICAgICAgICAgICAgICAg
IGlmIChmID09IE5VTEwpIHsKLSAgICAgICAgICAgICAgICAgICAgZXJyb3Jfc2V0Z19lcnJubygm
bG9jYWxfZXJyLCBlcnJubywgImZhaWxlZCB0byBhc3NvY2lhdGUgIgorICAgICAgICAgICAgICAg
ICAgICBlcnJvcl9zZXRnX2Vycm5vKGVycnAsIGVycm5vLCAiZmFpbGVkIHRvIGFzc29jaWF0ZSAi
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInN0ZGlvIHN0cmVhbSB3aXRo
IGZpbGUgZGVzY3JpcHRvciAlZCwgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICJmaWxlICclcycgKG1vZGU6ICclcycpIiwgZmQsIHBhdGgsIG1vZGUpOwogICAgICAgICAg
ICAgICAgIH0gZWxzZSB7CkBAIC0zOTMsNyArMzg4LDYgQEAgc2FmZV9vcGVuX29yX2NyZWF0ZShj
b25zdCBjaGFyICpwYXRoLCBjb25zdCBjaGFyICptb2RlLCBFcnJvciAqKmVycnApCiAgICAgICAg
IH0KICAgICB9CiAKLSAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKICAgICBy
ZXR1cm4gTlVMTDsKIH0KIApAQCAtNDAxLDE2ICszOTUsMTQgQEAgaW50NjRfdCBxbXBfZ3Vlc3Rf
ZmlsZV9vcGVuKGNvbnN0IGNoYXIgKnBhdGgsIGJvb2wgaGFzX21vZGUsIGNvbnN0IGNoYXIgKm1v
ZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJwKQogewogICAgIEZJ
TEUgKmZoOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIGludDY0X3QgaGFuZGxl
OwogCiAgICAgaWYgKCFoYXNfbW9kZSkgewogICAgICAgICBtb2RlID0gInIiOwogICAgIH0KICAg
ICBzbG9nKCJndWVzdC1maWxlLW9wZW4gY2FsbGVkLCBmaWxlcGF0aDogJXMsIG1vZGU6ICVzIiwg
cGF0aCwgbW9kZSk7Ci0gICAgZmggPSBzYWZlX29wZW5fb3JfY3JlYXRlKHBhdGgsIG1vZGUsICZs
b2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIgIT0gTlVMTCkgewotICAgICAgICBlcnJvcl9w
cm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBmaCA9IHNhZmVfb3Blbl9vcl9jcmVhdGUo
cGF0aCwgbW9kZSwgZXJycCk7CisgICAgaWYgKCplcnJwICE9IE5VTEwpIHsKICAgICAgICAgcmV0
dXJuIC0xOwogICAgIH0KIApAQCAtNTY4LDE2ICs1NjAsMTQgQEAgc3RydWN0IEd1ZXN0RmlsZVNl
ZWsgKnFtcF9ndWVzdF9maWxlX3NlZWsoaW50NjRfdCBoYW5kbGUsIGludDY0X3Qgb2Zmc2V0LAog
ICAgIEZJTEUgKmZoOwogICAgIGludCByZXQ7CiAgICAgaW50IHdoZW5jZTsKLSAgICBFcnJvciAq
ZXJyID0gTlVMTDsKIAogICAgIGlmICghZ2ZoKSB7CiAgICAgICAgIHJldHVybiBOVUxMOwogICAg
IH0KIAogICAgIC8qIFdlIHN0dXBpZGx5IGV4cG9zZWQgJ3doZW5jZSc6J2ludCcgaW4gb3VyIHFh
cGkgKi8KLSAgICB3aGVuY2UgPSBnYV9wYXJzZV93aGVuY2Uod2hlbmNlX2NvZGUsICZlcnIpOwot
ICAgIGlmIChlcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAg
d2hlbmNlID0gZ2FfcGFyc2Vfd2hlbmNlKHdoZW5jZV9jb2RlLCBlcnJwKTsKKyAgICBpZiAoKmVy
cnApIHsKICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAgfQogCkBAIC0xMTUzLDEyICsxMTQzLDEw
IEBAIEd1ZXN0RmlsZXN5c3RlbUluZm9MaXN0ICpxbXBfZ3Vlc3RfZ2V0X2ZzaW5mbyhFcnJvciAq
KmVycnApCiAgICAgRnNNb3VudExpc3QgbW91bnRzOwogICAgIHN0cnVjdCBGc01vdW50ICptb3Vu
dDsKICAgICBHdWVzdEZpbGVzeXN0ZW1JbmZvTGlzdCAqbmV3LCAqcmV0ID0gTlVMTDsKLSAgICBF
cnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAogICAgIFFUQUlMUV9JTklUKCZtb3VudHMpOwotICAg
IGJ1aWxkX2ZzX21vdW50X2xpc3QoJm1vdW50cywgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2Fs
X2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBi
dWlsZF9mc19tb3VudF9saXN0KCZtb3VudHMsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAg
ICAgICByZXR1cm4gTlVMTDsKICAgICB9CiAKQEAgLTExNjYsMTEgKzExNTQsMTAgQEAgR3Vlc3RG
aWxlc3lzdGVtSW5mb0xpc3QgKnFtcF9ndWVzdF9nZXRfZnNpbmZvKEVycm9yICoqZXJycCkKICAg
ICAgICAgZ19kZWJ1ZygiQnVpbGRpbmcgZ3Vlc3QgZnNpbmZvIGZvciAnJXMnIiwgbW91bnQtPmRp
cm5hbWUpOwogCiAgICAgICAgIG5ldyA9IGdfbWFsbG9jMChzaXplb2YoKnJldCkpOwotICAgICAg
ICBuZXctPnZhbHVlID0gYnVpbGRfZ3Vlc3RfZnNpbmZvKG1vdW50LCAmbG9jYWxfZXJyKTsKKyAg
ICAgICAgbmV3LT52YWx1ZSA9IGJ1aWxkX2d1ZXN0X2ZzaW5mbyhtb3VudCwgZXJycCk7CiAgICAg
ICAgIG5ldy0+bmV4dCA9IHJldDsKICAgICAgICAgcmV0ID0gbmV3OwotICAgICAgICBpZiAobG9j
YWxfZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsK
KyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICBxYXBpX2ZyZWVfR3Vlc3RGaWxlc3lz
dGVtSW5mb0xpc3QocmV0KTsKICAgICAgICAgICAgIHJldCA9IE5VTEw7CiAgICAgICAgICAgICBi
cmVhazsKQEAgLTExOTgsNyArMTE4NSw2IEBAIHN0YXRpYyB2b2lkIGV4ZWN1dGVfZnNmcmVlemVf
aG9vayhGc2ZyZWV6ZUhvb2tBcmcgYXJnLCBFcnJvciAqKmVycnApCiAgICAgcGlkX3QgcGlkOwog
ICAgIGNvbnN0IGNoYXIgKmhvb2s7CiAgICAgY29uc3QgY2hhciAqYXJnX3N0ciA9IGZzZnJlZXpl
X2hvb2tfYXJnX3N0cmluZ1thcmddOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAg
ICAgaG9vayA9IGdhX2ZzZnJlZXplX2hvb2soZ2Ffc3RhdGUpOwogICAgIGlmICghaG9vaykgewpA
QCAtMTIyNCw5ICsxMjEwLDggQEAgc3RhdGljIHZvaWQgZXhlY3V0ZV9mc2ZyZWV6ZV9ob29rKEZz
ZnJlZXplSG9va0FyZyBhcmcsIEVycm9yICoqZXJycCkKICAgICAgICAgcmV0dXJuOwogICAgIH0K
IAotICAgIGdhX3dhaXRfY2hpbGQocGlkLCAmc3RhdHVzLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAo
bG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwor
ICAgIGdhX3dhaXRfY2hpbGQocGlkLCAmc3RhdHVzLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsK
ICAgICAgICAgcmV0dXJuOwogICAgIH0KIApAQCAtMTI3MSwyMSArMTI1NiwxOCBAQCBpbnQ2NF90
IHFtcF9ndWVzdF9mc2ZyZWV6ZV9mcmVlemVfbGlzdChib29sIGhhc19tb3VudHBvaW50cywKICAg
ICBzdHJMaXN0ICpsaXN0OwogICAgIEZzTW91bnRMaXN0IG1vdW50czsKICAgICBzdHJ1Y3QgRnNN
b3VudCAqbW91bnQ7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgaW50IGZkOwog
CiAgICAgc2xvZygiZ3Vlc3QtZnNmcmVlemUgY2FsbGVkIik7CiAKLSAgICBleGVjdXRlX2ZzZnJl
ZXplX2hvb2soRlNGUkVFWkVfSE9PS19GUkVFWkUsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2Nh
bF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAg
ZXhlY3V0ZV9mc2ZyZWV6ZV9ob29rKEZTRlJFRVpFX0hPT0tfRlJFRVpFLCBlcnJwKTsKKyAgICBp
ZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuIC0xOwogICAgIH0KIAogICAgIFFUQUlMUV9JTklU
KCZtb3VudHMpOwotICAgIGJ1aWxkX2ZzX21vdW50X2xpc3QoJm1vdW50cywgJmxvY2FsX2Vycik7
Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9j
YWxfZXJyKTsKKyAgICBidWlsZF9mc19tb3VudF9saXN0KCZtb3VudHMsIGVycnApOworICAgIGlm
ICgqZXJycCkgewogICAgICAgICByZXR1cm4gLTE7CiAgICAgfQogCkBAIC0xMzYyLDEyICsxMzQ0
LDEwIEBAIGludDY0X3QgcW1wX2d1ZXN0X2ZzZnJlZXplX3RoYXcoRXJyb3IgKiplcnJwKQogICAg
IEZzTW91bnRMaXN0IG1vdW50czsKICAgICBGc01vdW50ICptb3VudDsKICAgICBpbnQgZmQsIGkg
PSAwLCBsb2dnZWQ7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICBRVEFJTFFf
SU5JVCgmbW91bnRzKTsKLSAgICBidWlsZF9mc19tb3VudF9saXN0KCZtb3VudHMsICZsb2NhbF9l
cnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAs
IGxvY2FsX2Vycik7CisgICAgYnVpbGRfZnNfbW91bnRfbGlzdCgmbW91bnRzLCBlcnJwKTsKKyAg
ICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuIDA7CiAgICAgfQogCkBAIC0xNDQwLDE1ICsx
NDIwLDEzIEBAIHFtcF9ndWVzdF9mc3RyaW0oYm9vbCBoYXNfbWluaW11bSwgaW50NjRfdCBtaW5p
bXVtLCBFcnJvciAqKmVycnApCiAgICAgRnNNb3VudExpc3QgbW91bnRzOwogICAgIHN0cnVjdCBG
c01vdW50ICptb3VudDsKICAgICBpbnQgZmQ7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7
CiAgICAgc3RydWN0IGZzdHJpbV9yYW5nZSByOwogCiAgICAgc2xvZygiZ3Vlc3QtZnN0cmltIGNh
bGxlZCIpOwogCiAgICAgUVRBSUxRX0lOSVQoJm1vdW50cyk7Ci0gICAgYnVpbGRfZnNfbW91bnRf
bGlzdCgmbW91bnRzLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAg
IGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIGJ1aWxkX2ZzX21vdW50X2xp
c3QoJm1vdW50cywgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybiBOVUxM
OwogICAgIH0KIApAQCAtMTU1NCwxMyArMTUzMiwxMiBAQCBzdGF0aWMgaW50IHJ1bl9wcm9jZXNz
X2NoaWxkKGNvbnN0IGNoYXIgKmNvbW1hbmRbXSwgRXJyb3IgKiplcnJwKQogCiBzdGF0aWMgYm9v
bCBzeXN0ZW1kX3N1cHBvcnRzX21vZGUoU3VzcGVuZE1vZGUgbW9kZSwgRXJyb3IgKiplcnJwKQog
ewotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIGNvbnN0IGNoYXIgKnN5c3RlbWN0
bF9hcmdzWzNdID0geyJzeXN0ZW1kLWhpYmVybmF0ZSIsICJzeXN0ZW1kLXN1c3BlbmQiLAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzeXN0ZW1kLWh5YnJpZC1zbGVlcCJ9
OwogICAgIGNvbnN0IGNoYXIgKmNtZFs0XSA9IHsic3lzdGVtY3RsIiwgInN0YXR1cyIsIHN5c3Rl
bWN0bF9hcmdzW21vZGVdLCBOVUxMfTsKICAgICBpbnQgc3RhdHVzOwogCi0gICAgc3RhdHVzID0g
cnVuX3Byb2Nlc3NfY2hpbGQoY21kLCAmbG9jYWxfZXJyKTsKKyAgICBzdGF0dXMgPSBydW5fcHJv
Y2Vzc19jaGlsZChjbWQsIGVycnApOwogCiAgICAgLyoKICAgICAgKiBzeXN0ZW1jdGwgc3RhdHVz
IHVzZXMgTFNCIHJldHVybiBjb2RlcyBzbyB3ZSBjYW4gZXhwZWN0CkBAIC0xNTc0LDMxICsxNTUx
LDI4IEBAIHN0YXRpYyBib29sIHN5c3RlbWRfc3VwcG9ydHNfbW9kZShTdXNwZW5kTW9kZSBtb2Rl
LCBFcnJvciAqKmVycnApCiAgICAgICAgIHJldHVybiB0cnVlOwogICAgIH0KIAotICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogICAgIHJldHVybiBmYWxzZTsKIH0KIAogc3Rh
dGljIHZvaWQgc3lzdGVtZF9zdXNwZW5kKFN1c3BlbmRNb2RlIG1vZGUsIEVycm9yICoqZXJycCkK
IHsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBjb25zdCBjaGFyICpzeXN0ZW1j
dGxfYXJnc1szXSA9IHsiaGliZXJuYXRlIiwgInN1c3BlbmQiLCAiaHlicmlkLXNsZWVwIn07CiAg
ICAgY29uc3QgY2hhciAqY21kWzNdID0geyJzeXN0ZW1jdGwiLCBzeXN0ZW1jdGxfYXJnc1ttb2Rl
XSwgTlVMTH07CiAgICAgaW50IHN0YXR1czsKIAotICAgIHN0YXR1cyA9IHJ1bl9wcm9jZXNzX2No
aWxkKGNtZCwgJmxvY2FsX2Vycik7CisgICAgc3RhdHVzID0gcnVuX3Byb2Nlc3NfY2hpbGQoY21k
LCBlcnJwKTsKIAogICAgIGlmIChzdGF0dXMgPT0gMCkgewogICAgICAgICByZXR1cm47CiAgICAg
fQogCi0gICAgaWYgKChzdGF0dXMgPT0gLTEpICYmICFsb2NhbF9lcnIpIHsKKyAgICBpZiAoKHN0
YXR1cyA9PSAtMSkgJiYgISplcnJwKSB7CiAgICAgICAgIGVycm9yX3NldGcoZXJycCwgInRoZSBo
ZWxwZXIgcHJvZ3JhbSAnc3lzdGVtY3RsICVzJyB3YXMgbm90IGZvdW5kIiwKICAgICAgICAgICAg
ICAgICAgICBzeXN0ZW1jdGxfYXJnc1ttb2RlXSk7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAK
LSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2Nh
bF9lcnIpOworICAgIGlmICgqZXJycCkgewogICAgIH0gZWxzZSB7CiAgICAgICAgIGVycm9yX3Nl
dGcoZXJycCwgInRoZSBoZWxwZXIgcHJvZ3JhbSAnc3lzdGVtY3RsICVzJyByZXR1cm5lZCBhbiAi
CiAgICAgICAgICAgICAgICAgICAgInVuZXhwZWN0ZWQgZXhpdCBzdGF0dXMgY29kZSAoJWQpIiwK
QEAgLTE2MDgsMjQgKzE1ODIsMjIgQEAgc3RhdGljIHZvaWQgc3lzdGVtZF9zdXNwZW5kKFN1c3Bl
bmRNb2RlIG1vZGUsIEVycm9yICoqZXJycCkKIAogc3RhdGljIGJvb2wgcG11dGlsc19zdXBwb3J0
c19tb2RlKFN1c3BlbmRNb2RlIG1vZGUsIEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqbG9j
YWxfZXJyID0gTlVMTDsKICAgICBjb25zdCBjaGFyICpwbXV0aWxzX2FyZ3NbM10gPSB7Ii0taGli
ZXJuYXRlIiwgIi0tc3VzcGVuZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICItLXN1c3BlbmQtaHlicmlkIn07CiAgICAgY29uc3QgY2hhciAqY21kWzNdID0geyJwbS1pcy1z
dXBwb3J0ZWQiLCBwbXV0aWxzX2FyZ3NbbW9kZV0sIE5VTEx9OwogICAgIGludCBzdGF0dXM7CiAK
LSAgICBzdGF0dXMgPSBydW5fcHJvY2Vzc19jaGlsZChjbWQsICZsb2NhbF9lcnIpOworICAgIHN0
YXR1cyA9IHJ1bl9wcm9jZXNzX2NoaWxkKGNtZCwgZXJycCk7CiAKICAgICBpZiAoc3RhdHVzID09
IFNVU1BFTkRfU1VQUE9SVEVEKSB7CiAgICAgICAgIHJldHVybiB0cnVlOwogICAgIH0KIAotICAg
IGlmICgoc3RhdHVzID09IC0xKSAmJiAhbG9jYWxfZXJyKSB7CisgICAgaWYgKChzdGF0dXMgPT0g
LTEpICYmICEqZXJycCkgewogICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgfQogCi0gICAgaWYg
KGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsK
KyAgICBpZiAoKmVycnApIHsKICAgICB9IGVsc2UgewogICAgICAgICBlcnJvcl9zZXRnKGVycnAs
CiAgICAgICAgICAgICAgICAgICAgInRoZSBoZWxwZXIgcHJvZ3JhbSAnJXMnIHJldHVybmVkIGFu
IHVuZXhwZWN0ZWQgZXhpdCIKQEAgLTE2MzcsMjYgKzE2MDksMjQgQEAgc3RhdGljIGJvb2wgcG11
dGlsc19zdXBwb3J0c19tb2RlKFN1c3BlbmRNb2RlIG1vZGUsIEVycm9yICoqZXJycCkKIAogc3Rh
dGljIHZvaWQgcG11dGlsc19zdXNwZW5kKFN1c3BlbmRNb2RlIG1vZGUsIEVycm9yICoqZXJycCkK
IHsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBjb25zdCBjaGFyICpwbXV0aWxz
X2JpbmFyaWVzWzNdID0geyJwbS1oaWJlcm5hdGUiLCAicG0tc3VzcGVuZCIsCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicG0tc3VzcGVuZC1oeWJyaWQifTsKICAgICBj
b25zdCBjaGFyICpjbWRbMl0gPSB7cG11dGlsc19iaW5hcmllc1ttb2RlXSwgTlVMTH07CiAgICAg
aW50IHN0YXR1czsKIAotICAgIHN0YXR1cyA9IHJ1bl9wcm9jZXNzX2NoaWxkKGNtZCwgJmxvY2Fs
X2Vycik7CisgICAgc3RhdHVzID0gcnVuX3Byb2Nlc3NfY2hpbGQoY21kLCBlcnJwKTsKIAogICAg
IGlmIChzdGF0dXMgPT0gMCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCi0gICAgaWYgKChz
dGF0dXMgPT0gLTEpICYmICFsb2NhbF9lcnIpIHsKKyAgICBpZiAoKHN0YXR1cyA9PSAtMSkgJiYg
ISplcnJwKSB7CiAgICAgICAgIGVycm9yX3NldGcoZXJycCwgInRoZSBoZWxwZXIgcHJvZ3JhbSAn
JXMnIHdhcyBub3QgZm91bmQiLAogICAgICAgICAgICAgICAgICAgIHBtdXRpbHNfYmluYXJpZXNb
bW9kZV0pOwogICAgICAgICByZXR1cm47CiAgICAgfQogCi0gICAgaWYgKGxvY2FsX2Vycikgewot
ICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBpZiAoKmVycnAp
IHsKICAgICB9IGVsc2UgewogICAgICAgICBlcnJvcl9zZXRnKGVycnAsCiAgICAgICAgICAgICAg
ICAgICAgInRoZSBoZWxwZXIgcHJvZ3JhbSAnJXMnIHJldHVybmVkIGFuIHVuZXhwZWN0ZWQgZXhp
dCIKQEAgLTE2OTcsNyArMTY2Nyw2IEBAIHN0YXRpYyBib29sIGxpbnV4X3N5c19zdGF0ZV9zdXBw
b3J0c19tb2RlKFN1c3BlbmRNb2RlIG1vZGUsIEVycm9yICoqZXJycCkKIAogc3RhdGljIHZvaWQg
bGludXhfc3lzX3N0YXRlX3N1c3BlbmQoU3VzcGVuZE1vZGUgbW9kZSwgRXJyb3IgKiplcnJwKQog
ewotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIGNvbnN0IGNoYXIgKnN5c2ZpbGVf
c3Ryc1szXSA9IHsiZGlzayIsICJtZW0iLCBOVUxMfTsKICAgICBjb25zdCBjaGFyICpzeXNmaWxl
X3N0ciA9IHN5c2ZpbGVfc3Ryc1ttb2RlXTsKICAgICBwaWRfdCBwaWQ7CkBAIC0xNzMzLDkgKzE3
MDIsOCBAQCBzdGF0aWMgdm9pZCBsaW51eF9zeXNfc3RhdGVfc3VzcGVuZChTdXNwZW5kTW9kZSBt
b2RlLCBFcnJvciAqKmVycnApCiAgICAgICAgIHJldHVybjsKICAgICB9CiAKLSAgICBnYV93YWl0
X2NoaWxkKHBpZCwgJnN0YXR1cywgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2Vycikgewot
ICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBnYV93YWl0X2No
aWxkKHBpZCwgJnN0YXR1cywgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVy
bjsKICAgICB9CiAKQEAgLTE3NDcsNDEgKzE3MTUsMzkgQEAgc3RhdGljIHZvaWQgbGludXhfc3lz
X3N0YXRlX3N1c3BlbmQoU3VzcGVuZE1vZGUgbW9kZSwgRXJyb3IgKiplcnJwKQogCiBzdGF0aWMg
dm9pZCBndWVzdF9zdXNwZW5kKFN1c3BlbmRNb2RlIG1vZGUsIEVycm9yICoqZXJycCkKIHsKLSAg
ICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBib29sIG1vZGVfc3VwcG9ydGVkID0gZmFs
c2U7CiAKLSAgICBpZiAoc3lzdGVtZF9zdXBwb3J0c19tb2RlKG1vZGUsICZsb2NhbF9lcnIpKSB7
CisgICAgaWYgKHN5c3RlbWRfc3VwcG9ydHNfbW9kZShtb2RlLCBlcnJwKSkgewogICAgICAgICBt
b2RlX3N1cHBvcnRlZCA9IHRydWU7Ci0gICAgICAgIHN5c3RlbWRfc3VzcGVuZChtb2RlLCAmbG9j
YWxfZXJyKTsKKyAgICAgICAgc3lzdGVtZF9zdXNwZW5kKG1vZGUsIGVycnApOwogICAgIH0KIAot
ICAgIGlmICghbG9jYWxfZXJyKSB7CisgICAgaWYgKCEqZXJycCkgewogICAgICAgICByZXR1cm47
CiAgICAgfQogCi0gICAgZXJyb3JfZnJlZShsb2NhbF9lcnIpOworICAgIGVycm9yX2ZyZWVfZXJy
cChlcnJwKTsKIAotICAgIGlmIChwbXV0aWxzX3N1cHBvcnRzX21vZGUobW9kZSwgJmxvY2FsX2Vy
cikpIHsKKyAgICBpZiAocG11dGlsc19zdXBwb3J0c19tb2RlKG1vZGUsIGVycnApKSB7CiAgICAg
ICAgIG1vZGVfc3VwcG9ydGVkID0gdHJ1ZTsKLSAgICAgICAgcG11dGlsc19zdXNwZW5kKG1vZGUs
ICZsb2NhbF9lcnIpOworICAgICAgICBwbXV0aWxzX3N1c3BlbmQobW9kZSwgZXJycCk7CiAgICAg
fQogCi0gICAgaWYgKCFsb2NhbF9lcnIpIHsKKyAgICBpZiAoISplcnJwKSB7CiAgICAgICAgIHJl
dHVybjsKICAgICB9CiAKLSAgICBlcnJvcl9mcmVlKGxvY2FsX2Vycik7CisgICAgZXJyb3JfZnJl
ZV9lcnJwKGVycnApOwogCi0gICAgaWYgKGxpbnV4X3N5c19zdGF0ZV9zdXBwb3J0c19tb2RlKG1v
ZGUsICZsb2NhbF9lcnIpKSB7CisgICAgaWYgKGxpbnV4X3N5c19zdGF0ZV9zdXBwb3J0c19tb2Rl
KG1vZGUsIGVycnApKSB7CiAgICAgICAgIG1vZGVfc3VwcG9ydGVkID0gdHJ1ZTsKLSAgICAgICAg
bGludXhfc3lzX3N0YXRlX3N1c3BlbmQobW9kZSwgJmxvY2FsX2Vycik7CisgICAgICAgIGxpbnV4
X3N5c19zdGF0ZV9zdXNwZW5kKG1vZGUsIGVycnApOwogICAgIH0KIAogICAgIGlmICghbW9kZV9z
dXBwb3J0ZWQpIHsKICAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLAogICAgICAgICAgICAgICAgICAg
ICJ0aGUgcmVxdWVzdGVkIHN1c3BlbmQgbW9kZSBpcyBub3Qgc3VwcG9ydGVkIGJ5IHRoZSBndWVz
dCIpOwogICAgIH0gZWxzZSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9l
cnIpOwogICAgIH0KIH0KIApAQCAtMjEyMywxNCArMjA4OSwxMyBAQCBHdWVzdExvZ2ljYWxQcm9j
ZXNzb3JMaXN0ICpxbXBfZ3Vlc3RfZ2V0X3ZjcHVzKEVycm9yICoqZXJycCkKICAgICBpbnQ2NF90
IGN1cnJlbnQ7CiAgICAgR3Vlc3RMb2dpY2FsUHJvY2Vzc29yTGlzdCAqaGVhZCwgKipsaW5rOwog
ICAgIGxvbmcgc2NfbWF4OwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgY3Vy
cmVudCA9IDA7CiAgICAgaGVhZCA9IE5VTEw7CiAgICAgbGluayA9ICZoZWFkOwotICAgIHNjX21h
eCA9IFNZU0NPTkZfRVhBQ1QoX1NDX05QUk9DRVNTT1JTX0NPTkYsICZsb2NhbF9lcnIpOworICAg
IHNjX21heCA9IFNZU0NPTkZfRVhBQ1QoX1NDX05QUk9DRVNTT1JTX0NPTkYsIGVycnApOwogCi0g
ICAgd2hpbGUgKGxvY2FsX2VyciA9PSBOVUxMICYmIGN1cnJlbnQgPCBzY19tYXgpIHsKKyAgICB3
aGlsZSAoKmVycnAgPT0gTlVMTCAmJiBjdXJyZW50IDwgc2NfbWF4KSB7CiAgICAgICAgIEd1ZXN0
TG9naWNhbFByb2Nlc3NvciAqdmNwdTsKICAgICAgICAgR3Vlc3RMb2dpY2FsUHJvY2Vzc29yTGlz
dCAqZW50cnk7CiAgICAgICAgIGludDY0X3QgaWQgPSBjdXJyZW50Kys7CkBAIC0yMTQxLDcgKzIx
MDYsNyBAQCBHdWVzdExvZ2ljYWxQcm9jZXNzb3JMaXN0ICpxbXBfZ3Vlc3RfZ2V0X3ZjcHVzKEVy
cm9yICoqZXJycCkKICAgICAgICAgICAgIHZjcHUgPSBnX21hbGxvYzAoc2l6ZW9mICp2Y3B1KTsK
ICAgICAgICAgICAgIHZjcHUtPmxvZ2ljYWxfaWQgPSBpZDsKICAgICAgICAgICAgIHZjcHUtPmhh
c19jYW5fb2ZmbGluZSA9IHRydWU7IC8qIGxvbHNwZWFrIGZ0dyAqLwotICAgICAgICAgICAgdHJh
bnNmZXJfdmNwdSh2Y3B1LCB0cnVlLCBwYXRoLCAmbG9jYWxfZXJyKTsKKyAgICAgICAgICAgIHRy
YW5zZmVyX3ZjcHUodmNwdSwgdHJ1ZSwgcGF0aCwgZXJycCk7CiAgICAgICAgICAgICBlbnRyeSA9
IGdfbWFsbG9jMChzaXplb2YgKmVudHJ5KTsKICAgICAgICAgICAgIGVudHJ5LT52YWx1ZSA9IHZj
cHU7CiAgICAgICAgICAgICAqbGluayA9IGVudHJ5OwpAQCAtMjE1MCw0MSArMjExNSwzOCBAQCBH
dWVzdExvZ2ljYWxQcm9jZXNzb3JMaXN0ICpxbXBfZ3Vlc3RfZ2V0X3ZjcHVzKEVycm9yICoqZXJy
cCkKICAgICAgICAgZ19mcmVlKHBhdGgpOwogICAgIH0KIAotICAgIGlmIChsb2NhbF9lcnIgPT0g
TlVMTCkgeworICAgIGlmICgqZXJycCA9PSBOVUxMKSB7CiAgICAgICAgIC8qIHRoZXJlJ3Mgbm8g
Z3Vlc3Qgd2l0aCB6ZXJvIFZDUFVzICovCiAgICAgICAgIGdfYXNzZXJ0KGhlYWQgIT0gTlVMTCk7
CiAgICAgICAgIHJldHVybiBoZWFkOwogICAgIH0KIAogICAgIHFhcGlfZnJlZV9HdWVzdExvZ2lj
YWxQcm9jZXNzb3JMaXN0KGhlYWQpOwotICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9l
cnIpOwogICAgIHJldHVybiBOVUxMOwogfQogCiBpbnQ2NF90IHFtcF9ndWVzdF9zZXRfdmNwdXMo
R3Vlc3RMb2dpY2FsUHJvY2Vzc29yTGlzdCAqdmNwdXMsIEVycm9yICoqZXJycCkKIHsKICAgICBp
bnQ2NF90IHByb2Nlc3NlZDsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAogICAgIHBy
b2Nlc3NlZCA9IDA7CiAgICAgd2hpbGUgKHZjcHVzICE9IE5VTEwpIHsKICAgICAgICAgY2hhciAq
cGF0aCA9IGdfc3RyZHVwX3ByaW50ZigiL3N5cy9kZXZpY2VzL3N5c3RlbS9jcHUvY3B1JSIgUFJJ
ZDY0ICIvIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Y3B1cy0+dmFs
dWUtPmxvZ2ljYWxfaWQpOwogCi0gICAgICAgIHRyYW5zZmVyX3ZjcHUodmNwdXMtPnZhbHVlLCBm
YWxzZSwgcGF0aCwgJmxvY2FsX2Vycik7CisgICAgICAgIHRyYW5zZmVyX3ZjcHUodmNwdXMtPnZh
bHVlLCBmYWxzZSwgcGF0aCwgZXJycCk7CiAgICAgICAgIGdfZnJlZShwYXRoKTsKLSAgICAgICAg
aWYgKGxvY2FsX2VyciAhPSBOVUxMKSB7CisgICAgICAgIGlmICgqZXJycCAhPSBOVUxMKSB7CiAg
ICAgICAgICAgICBicmVhazsKICAgICAgICAgfQogICAgICAgICArK3Byb2Nlc3NlZDsKICAgICAg
ICAgdmNwdXMgPSB2Y3B1cy0+bmV4dDsKICAgICB9CiAKLSAgICBpZiAobG9jYWxfZXJyICE9IE5V
TEwpIHsKKyAgICBpZiAoKmVycnAgIT0gTlVMTCkgewogICAgICAgICBpZiAocHJvY2Vzc2VkID09
IDApIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogICAg
ICAgICB9IGVsc2UgewotICAgICAgICAgICAgZXJyb3JfZnJlZShsb2NhbF9lcnIpOworICAgICAg
ICAgICAgZXJyb3JfZnJlZV9lcnJwKGVycnApOwogICAgICAgICB9CiAgICAgfQogCkBAIC0yMTk2
LDcgKzIxNTgsNiBAQCB2b2lkIHFtcF9ndWVzdF9zZXRfdXNlcl9wYXNzd29yZChjb25zdCBjaGFy
ICp1c2VybmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2wgY3J5cHRl
ZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVycm9yICoqZXJycCkKIHsKLSAg
ICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBjaGFyICpwYXNzd2RfcGF0aCA9IE5VTEw7
CiAgICAgcGlkX3QgcGlkOwogICAgIGludCBzdGF0dXM7CkBAIC0yMjY4LDkgKzIyMjksOCBAQCB2
b2lkIHFtcF9ndWVzdF9zZXRfdXNlcl9wYXNzd29yZChjb25zdCBjaGFyICp1c2VybmFtZSwKICAg
ICBjbG9zZShkYXRhZmRbMV0pOwogICAgIGRhdGFmZFsxXSA9IC0xOwogCi0gICAgZ2Ffd2FpdF9j
aGlsZChwaWQsICZzdGF0dXMsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAg
ICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgZ2Ffd2FpdF9jaGls
ZChwaWQsICZzdGF0dXMsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICBnb3RvIG91
dDsKICAgICB9CiAKQEAgLTIzNTksNyArMjMxOSw2IEBAIHN0YXRpYyB2b2lkIHRyYW5zZmVyX21l
bW9yeV9ibG9jayhHdWVzdE1lbW9yeUJsb2NrICptZW1fYmxrLCBib29sIHN5czJtZW1ibGssCiAg
ICAgY2hhciAqZGlycGF0aDsKICAgICBpbnQgZGlyZmQ7CiAgICAgY2hhciAqc3RhdHVzOwotICAg
IEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgaWYgKCFzeXMybWVtYmxrKSB7CiAgICAg
ICAgIERJUiAqZHA7CkBAIC0yNDA0LDExICsyMzYzLDExIEBAIHN0YXRpYyB2b2lkIHRyYW5zZmVy
X21lbW9yeV9ibG9jayhHdWVzdE1lbW9yeUJsb2NrICptZW1fYmxrLCBib29sIHN5czJtZW1ibGss
CiAgICAgZ19mcmVlKGRpcnBhdGgpOwogCiAgICAgc3RhdHVzID0gZ19tYWxsb2MwKDEwKTsKLSAg
ICBnYV9yZWFkX3N5c2ZzX2ZpbGUoZGlyZmQsICJzdGF0ZSIsIHN0YXR1cywgMTAsICZsb2NhbF9l
cnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKKyAgICBnYV9yZWFkX3N5c2ZzX2ZpbGUoZGlyZmQs
ICJzdGF0ZSIsIHN0YXR1cywgMTAsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICAv
KiB0cmVhdCB3aXRoIHN5c2ZzIGZpbGUgdGhhdCBub3QgZXhpc3QgaW4gb2xkIGtlcm5lbCAqLwog
ICAgICAgICBpZiAoZXJybm8gPT0gRU5PRU5UKSB7Ci0gICAgICAgICAgICBlcnJvcl9mcmVlKGxv
Y2FsX2Vycik7CisgICAgICAgICAgICBlcnJvcl9mcmVlX2VycnAoZXJycCk7CiAgICAgICAgICAg
ICBpZiAoc3lzMm1lbWJsaykgewogICAgICAgICAgICAgICAgIG1lbV9ibGstPm9ubGluZSA9IHRy
dWU7CiAgICAgICAgICAgICAgICAgbWVtX2Jsay0+Y2FuX29mZmxpbmUgPSBmYWxzZTsKQEAgLTI0
MTgsNyArMjM3Nyw2IEBAIHN0YXRpYyB2b2lkIHRyYW5zZmVyX21lbW9yeV9ibG9jayhHdWVzdE1l
bW9yeUJsb2NrICptZW1fYmxrLCBib29sIHN5czJtZW1ibGssCiAgICAgICAgICAgICB9CiAgICAg
ICAgIH0gZWxzZSB7CiAgICAgICAgICAgICBpZiAoc3lzMm1lbWJsaykgewotICAgICAgICAgICAg
ICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogICAgICAgICAgICAgfSBlbHNl
IHsKICAgICAgICAgICAgICAgICByZXN1bHQtPnJlc3BvbnNlID0KICAgICAgICAgICAgICAgICAg
ICAgR1VFU1RfTUVNT1JZX0JMT0NLX1JFU1BPTlNFX1RZUEVfT1BFUkFUSU9OX0ZBSUxFRDsKQEAg
LTI0MzIsMTQgKzIzOTAsMTMgQEAgc3RhdGljIHZvaWQgdHJhbnNmZXJfbWVtb3J5X2Jsb2NrKEd1
ZXN0TWVtb3J5QmxvY2sgKm1lbV9ibGssIGJvb2wgc3lzMm1lbWJsaywKIAogICAgICAgICBtZW1f
YmxrLT5vbmxpbmUgPSAoc3RybmNtcChzdGF0dXMsICJvbmxpbmUiLCA2KSA9PSAwKTsKIAotICAg
ICAgICBnYV9yZWFkX3N5c2ZzX2ZpbGUoZGlyZmQsICJyZW1vdmFibGUiLCAmcmVtb3ZhYmxlLCAx
LCAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYgKGxvY2FsX2VycikgeworICAgICAgICBnYV9yZWFk
X3N5c2ZzX2ZpbGUoZGlyZmQsICJyZW1vdmFibGUiLCAmcmVtb3ZhYmxlLCAxLCBlcnJwKTsKKyAg
ICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICAvKiBpZiBubyAncmVtb3ZhYmxlJyBmaWxl
LCBpdCBkb2Vzbid0IHN1cHBvcnQgb2ZmbGluZSBtZW0gYmxrICovCiAgICAgICAgICAgICBpZiAo
ZXJybm8gPT0gRU5PRU5UKSB7Ci0gICAgICAgICAgICAgICAgZXJyb3JfZnJlZShsb2NhbF9lcnIp
OworICAgICAgICAgICAgICAgIGVycm9yX2ZyZWVfZXJycChlcnJwKTsKICAgICAgICAgICAgICAg
ICBtZW1fYmxrLT5jYW5fb2ZmbGluZSA9IGZhbHNlOwogICAgICAgICAgICAgfSBlbHNlIHsKLSAg
ICAgICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKICAgICAgICAg
ICAgIH0KICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgIG1lbV9ibGstPmNhbl9vZmZsaW5l
ID0gKHJlbW92YWJsZSAhPSAnMCcpOwpAQCAtMjQ0OSw5ICsyNDA2LDkgQEAgc3RhdGljIHZvaWQg
dHJhbnNmZXJfbWVtb3J5X2Jsb2NrKEd1ZXN0TWVtb3J5QmxvY2sgKm1lbV9ibGssIGJvb2wgc3lz
Mm1lbWJsaywKICAgICAgICAgICAgIGNvbnN0IGNoYXIgKm5ld19zdGF0ZSA9IG1lbV9ibGstPm9u
bGluZSA/ICJvbmxpbmUiIDogIm9mZmxpbmUiOwogCiAgICAgICAgICAgICBnYV93cml0ZV9zeXNm
c19maWxlKGRpcmZkLCAic3RhdGUiLCBuZXdfc3RhdGUsIHN0cmxlbihuZXdfc3RhdGUpLAotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmbG9jYWxfZXJyKTsKLSAgICAgICAgICAgIGlm
IChsb2NhbF9lcnIpIHsKLSAgICAgICAgICAgICAgICBlcnJvcl9mcmVlKGxvY2FsX2Vycik7Cisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycnApOworICAgICAgICAgICAgaWYgKCpl
cnJwKSB7CisgICAgICAgICAgICAgICAgZXJyb3JfZnJlZV9lcnJwKGVycnApOwogICAgICAgICAg
ICAgICAgIHJlc3VsdC0+cmVzcG9uc2UgPQogICAgICAgICAgICAgICAgICAgICBHVUVTVF9NRU1P
UllfQkxPQ0tfUkVTUE9OU0VfVFlQRV9PUEVSQVRJT05fRkFJTEVEOwogICAgICAgICAgICAgICAg
IGdvdG8gb3V0MjsKQEAgLTI0NzgsNyArMjQzNSw2IEBAIG91dDE6CiBHdWVzdE1lbW9yeUJsb2Nr
TGlzdCAqcW1wX2d1ZXN0X2dldF9tZW1vcnlfYmxvY2tzKEVycm9yICoqZXJycCkKIHsKICAgICBH
dWVzdE1lbW9yeUJsb2NrTGlzdCAqaGVhZCwgKipsaW5rOwotICAgIEVycm9yICpsb2NhbF9lcnIg
PSBOVUxMOwogICAgIHN0cnVjdCBkaXJlbnQgKmRlOwogICAgIERJUiAqZHA7CiAKQEAgLTI1MTYs
NyArMjQ3Miw3IEBAIEd1ZXN0TWVtb3J5QmxvY2tMaXN0ICpxbXBfZ3Vlc3RfZ2V0X21lbW9yeV9i
bG9ja3MoRXJyb3IgKiplcnJwKQogICAgICAgICAvKiBUaGUgZF9uYW1lIGlzICJtZW1vcnlYWFgi
LCAgcGh5c19pbmRleCBpcyBibG9jayBpZCwgc2FtZSBhcyBYWFggKi8KICAgICAgICAgbWVtX2Js
ay0+cGh5c19pbmRleCA9IHN0cnRvdWwoJmRlLT5kX25hbWVbNl0sIE5VTEwsIDEwKTsKICAgICAg
ICAgbWVtX2Jsay0+aGFzX2Nhbl9vZmZsaW5lID0gdHJ1ZTsgLyogbG9sc3BlYWsgZnR3ICovCi0g
ICAgICAgIHRyYW5zZmVyX21lbW9yeV9ibG9jayhtZW1fYmxrLCB0cnVlLCBOVUxMLCAmbG9jYWxf
ZXJyKTsKKyAgICAgICAgdHJhbnNmZXJfbWVtb3J5X2Jsb2NrKG1lbV9ibGssIHRydWUsIE5VTEws
IGVycnApOwogCiAgICAgICAgIGVudHJ5ID0gZ19tYWxsb2MwKHNpemVvZiAqZW50cnkpOwogICAg
ICAgICBlbnRyeS0+dmFsdWUgPSBtZW1fYmxrOwpAQCAtMjUyNiw3ICsyNDgyLDcgQEAgR3Vlc3RN
ZW1vcnlCbG9ja0xpc3QgKnFtcF9ndWVzdF9nZXRfbWVtb3J5X2Jsb2NrcyhFcnJvciAqKmVycnAp
CiAgICAgfQogCiAgICAgY2xvc2VkaXIoZHApOwotICAgIGlmIChsb2NhbF9lcnIgPT0gTlVMTCkg
eworICAgIGlmICgqZXJycCA9PSBOVUxMKSB7CiAgICAgICAgIC8qIHRoZXJlJ3Mgbm8gZ3Vlc3Qg
d2l0aCB6ZXJvIG1lbW9yeSBibG9ja3MgKi8KICAgICAgICAgaWYgKGhlYWQgPT0gTlVMTCkgewog
ICAgICAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAiZ3Vlc3QgcmVwb3J0ZWQgemVybyBtZW1vcnkg
YmxvY2tzISIpOwpAQCAtMjUzNSw3ICsyNDkxLDYgQEAgR3Vlc3RNZW1vcnlCbG9ja0xpc3QgKnFt
cF9ndWVzdF9nZXRfbWVtb3J5X2Jsb2NrcyhFcnJvciAqKmVycnApCiAgICAgfQogCiAgICAgcWFw
aV9mcmVlX0d1ZXN0TWVtb3J5QmxvY2tMaXN0KGhlYWQpOwotICAgIGVycm9yX3Byb3BhZ2F0ZShl
cnJwLCBsb2NhbF9lcnIpOwogICAgIHJldHVybiBOVUxMOwogfQogCkBAIC0yNTQzLDcgKzI0OTgs
NiBAQCBHdWVzdE1lbW9yeUJsb2NrUmVzcG9uc2VMaXN0ICoKIHFtcF9ndWVzdF9zZXRfbWVtb3J5
X2Jsb2NrcyhHdWVzdE1lbW9yeUJsb2NrTGlzdCAqbWVtX2Jsa3MsIEVycm9yICoqZXJycCkKIHsK
ICAgICBHdWVzdE1lbW9yeUJsb2NrUmVzcG9uc2VMaXN0ICpoZWFkLCAqKmxpbms7Ci0gICAgRXJy
b3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICBoZWFkID0gTlVMTDsKICAgICBsaW5rID0gJmhl
YWQ7CkBAIC0yNTU1LDggKzI1MDksOCBAQCBxbXBfZ3Vlc3Rfc2V0X21lbW9yeV9ibG9ja3MoR3Vl
c3RNZW1vcnlCbG9ja0xpc3QgKm1lbV9ibGtzLCBFcnJvciAqKmVycnApCiAKICAgICAgICAgcmVz
dWx0ID0gZ19tYWxsb2MwKHNpemVvZigqcmVzdWx0KSk7CiAgICAgICAgIHJlc3VsdC0+cGh5c19p
bmRleCA9IGN1cnJlbnRfbWVtX2Jsay0+cGh5c19pbmRleDsKLSAgICAgICAgdHJhbnNmZXJfbWVt
b3J5X2Jsb2NrKGN1cnJlbnRfbWVtX2JsaywgZmFsc2UsIHJlc3VsdCwgJmxvY2FsX2Vycik7Ci0g
ICAgICAgIGlmIChsb2NhbF9lcnIpIHsgLyogc2hvdWxkIG5ldmVyIGhhcHBlbiAqLworICAgICAg
ICB0cmFuc2Zlcl9tZW1vcnlfYmxvY2soY3VycmVudF9tZW1fYmxrLCBmYWxzZSwgcmVzdWx0LCBl
cnJwKTsKKyAgICAgICAgaWYgKCplcnJwKSB7IC8qIHNob3VsZCBuZXZlciBoYXBwZW4gKi8KICAg
ICAgICAgICAgIGdvdG8gZXJyOwogICAgICAgICB9CiAgICAgICAgIGVudHJ5ID0gZ19tYWxsb2Mw
KHNpemVvZiAqZW50cnkpOwpAQCAtMjU3MCwxMyArMjUyNCwxMSBAQCBxbXBfZ3Vlc3Rfc2V0X21l
bW9yeV9ibG9ja3MoR3Vlc3RNZW1vcnlCbG9ja0xpc3QgKm1lbV9ibGtzLCBFcnJvciAqKmVycnAp
CiAgICAgcmV0dXJuIGhlYWQ7CiBlcnI6CiAgICAgcWFwaV9mcmVlX0d1ZXN0TWVtb3J5QmxvY2tS
ZXNwb25zZUxpc3QoaGVhZCk7Ci0gICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7
CiAgICAgcmV0dXJuIE5VTEw7CiB9CiAKIEd1ZXN0TWVtb3J5QmxvY2tJbmZvICpxbXBfZ3Vlc3Rf
Z2V0X21lbW9yeV9ibG9ja19pbmZvKEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqbG9jYWxf
ZXJyID0gTlVMTDsKICAgICBjaGFyICpkaXJwYXRoOwogICAgIGludCBkaXJmZDsKICAgICBjaGFy
ICpidWY7CkBAIC0yNTkyLDExICsyNTQ0LDEwIEBAIEd1ZXN0TWVtb3J5QmxvY2tJbmZvICpxbXBf
Z3Vlc3RfZ2V0X21lbW9yeV9ibG9ja19pbmZvKEVycm9yICoqZXJycCkKICAgICBnX2ZyZWUoZGly
cGF0aCk7CiAKICAgICBidWYgPSBnX21hbGxvYzAoMjApOwotICAgIGdhX3JlYWRfc3lzZnNfZmls
ZShkaXJmZCwgImJsb2NrX3NpemVfYnl0ZXMiLCBidWYsIDIwLCAmbG9jYWxfZXJyKTsKKyAgICBn
YV9yZWFkX3N5c2ZzX2ZpbGUoZGlyZmQsICJibG9ja19zaXplX2J5dGVzIiwgYnVmLCAyMCwgZXJy
cCk7CiAgICAgY2xvc2UoZGlyZmQpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKKyAgICBpZiAoKmVy
cnApIHsKICAgICAgICAgZ19mcmVlKGJ1Zik7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJw
LCBsb2NhbF9lcnIpOwogICAgICAgICByZXR1cm4gTlVMTDsKICAgICB9CiAKZGlmZiAtLWdpdCBh
L3FnYS9jb21tYW5kcy13aW4zMi5jIGIvcWdhL2NvbW1hbmRzLXdpbjMyLmMKaW5kZXggNmI2N2Yx
NmZhZi4uMGU5YzE3MTA4NSAxMDA2NDQKLS0tIGEvcWdhL2NvbW1hbmRzLXdpbjMyLmMKKysrIGIv
cWdhL2NvbW1hbmRzLXdpbjMyLmMKQEAgLTI0MiwxMyArMjQyLDEyIEBAIHN0YXRpYyB2b2lkIGFj
cXVpcmVfcHJpdmlsZWdlKGNvbnN0IGNoYXIgKm5hbWUsIEVycm9yICoqZXJycCkKIHsKICAgICBI
QU5ETEUgdG9rZW4gPSBOVUxMOwogICAgIFRPS0VOX1BSSVZJTEVHRVMgcHJpdjsKLSAgICBFcnJv
ciAqbG9jYWxfZXJyID0gTlVMTDsKIAogICAgIGlmIChPcGVuUHJvY2Vzc1Rva2VuKEdldEN1cnJl
bnRQcm9jZXNzKCksCiAgICAgICAgIFRPS0VOX0FESlVTVF9QUklWSUxFR0VTfFRPS0VOX1FVRVJZ
LCAmdG9rZW4pKQogICAgIHsKICAgICAgICAgaWYgKCFMb29rdXBQcml2aWxlZ2VWYWx1ZShOVUxM
LCBuYW1lLCAmcHJpdi5Qcml2aWxlZ2VzWzBdLkx1aWQpKSB7Ci0gICAgICAgICAgICBlcnJvcl9z
ZXRnKCZsb2NhbF9lcnIsIFFFUlJfUUdBX0NPTU1BTkRfRkFJTEVELAorICAgICAgICAgICAgZXJy
b3Jfc2V0ZyhlcnJwLCBRRVJSX1FHQV9DT01NQU5EX0ZBSUxFRCwKICAgICAgICAgICAgICAgICAg
ICAgICAgIm5vIGx1aWQgZm9yIHJlcXVlc3RlZCBwcml2aWxlZ2UiKTsKICAgICAgICAgICAgIGdv
dG8gb3V0OwogICAgICAgICB9CkBAIC0yNTcsMTMgKzI1NiwxMyBAQCBzdGF0aWMgdm9pZCBhY3F1
aXJlX3ByaXZpbGVnZShjb25zdCBjaGFyICpuYW1lLCBFcnJvciAqKmVycnApCiAgICAgICAgIHBy
aXYuUHJpdmlsZWdlc1swXS5BdHRyaWJ1dGVzID0gU0VfUFJJVklMRUdFX0VOQUJMRUQ7CiAKICAg
ICAgICAgaWYgKCFBZGp1c3RUb2tlblByaXZpbGVnZXModG9rZW4sIEZBTFNFLCAmcHJpdiwgMCwg
TlVMTCwgMCkpIHsKLSAgICAgICAgICAgIGVycm9yX3NldGcoJmxvY2FsX2VyciwgUUVSUl9RR0Ff
Q09NTUFORF9GQUlMRUQsCisgICAgICAgICAgICBlcnJvcl9zZXRnKGVycnAsIFFFUlJfUUdBX0NP
TU1BTkRfRkFJTEVELAogICAgICAgICAgICAgICAgICAgICAgICAidW5hYmxlIHRvIGFjcXVpcmUg
cmVxdWVzdGVkIHByaXZpbGVnZSIpOwogICAgICAgICAgICAgZ290byBvdXQ7CiAgICAgICAgIH0K
IAogICAgIH0gZWxzZSB7Ci0gICAgICAgIGVycm9yX3NldGcoJmxvY2FsX2VyciwgUUVSUl9RR0Ff
Q09NTUFORF9GQUlMRUQsCisgICAgICAgIGVycm9yX3NldGcoZXJycCwgUUVSUl9RR0FfQ09NTUFO
RF9GQUlMRUQsCiAgICAgICAgICAgICAgICAgICAgImZhaWxlZCB0byBvcGVuIHByaXZpbGVnZSB0
b2tlbiIpOwogICAgIH0KIApAQCAtMjcxLDI1ICsyNzAsMjAgQEAgb3V0OgogICAgIGlmICh0b2tl
bikgewogICAgICAgICBDbG9zZUhhbmRsZSh0b2tlbik7CiAgICAgfQotICAgIGVycm9yX3Byb3Bh
Z2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogfQogCiBzdGF0aWMgdm9pZCBleGVjdXRlX2FzeW5jKERX
T1JEIFdJTkFQSSAoKmZ1bmMpKExQVk9JRCksIExQVk9JRCBvcGFxdWUsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgIEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVM
TDsKLQogICAgIEhBTkRMRSB0aHJlYWQgPSBDcmVhdGVUaHJlYWQoTlVMTCwgMCwgZnVuYywgb3Bh
cXVlLCAwLCBOVUxMKTsKICAgICBpZiAoIXRocmVhZCkgewotICAgICAgICBlcnJvcl9zZXRnKCZs
b2NhbF9lcnIsIFFFUlJfUUdBX0NPTU1BTkRfRkFJTEVELAorICAgICAgICBlcnJvcl9zZXRnKGVy
cnAsIFFFUlJfUUdBX0NPTU1BTkRfRkFJTEVELAogICAgICAgICAgICAgICAgICAgICJmYWlsZWQg
dG8gZGlzcGF0Y2ggYXN5bmNocm9ub3VzIGNvbW1hbmQiKTsKLSAgICAgICAgZXJyb3JfcHJvcGFn
YXRlKGVycnAsIGxvY2FsX2Vycik7CiAgICAgfQogfQogCiB2b2lkIHFtcF9ndWVzdF9zaHV0ZG93
bihib29sIGhhc19tb2RlLCBjb25zdCBjaGFyICptb2RlLCBFcnJvciAqKmVycnApCiB7Ci0gICAg
RXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgVUlOVCBzaHV0ZG93bl9mbGFnID0gRVdYX0ZP
UkNFOwogCiAgICAgc2xvZygiZ3Vlc3Qtc2h1dGRvd24gY2FsbGVkLCBtb2RlOiAlcyIsIG1vZGUp
OwpAQCAtMzA4LDkgKzMwMiw4IEBAIHZvaWQgcW1wX2d1ZXN0X3NodXRkb3duKGJvb2wgaGFzX21v
ZGUsIGNvbnN0IGNoYXIgKm1vZGUsIEVycm9yICoqZXJycCkKIAogICAgIC8qIFJlcXVlc3QgYSBz
aHV0ZG93biBwcml2aWxlZ2UsIGJ1dCB0cnkgdG8gc2h1dCBkb3duIHRoZSBzeXN0ZW0KICAgICAg
ICBhbnl3YXkuICovCi0gICAgYWNxdWlyZV9wcml2aWxlZ2UoU0VfU0hVVERPV05fTkFNRSwgJmxv
Y2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUo
ZXJycCwgbG9jYWxfZXJyKTsKKyAgICBhY3F1aXJlX3ByaXZpbGVnZShTRV9TSFVURE9XTl9OQU1F
LCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApAQCAt
NDE2LDcgKzQwOSw2IEBAIEd1ZXN0RmlsZVNlZWsgKnFtcF9ndWVzdF9maWxlX3NlZWsoaW50NjRf
dCBoYW5kbGUsIGludDY0X3Qgb2Zmc2V0LAogICAgIG9mZl9wb3MuUXVhZFBhcnQgPSBvZmZzZXQ7
CiAgICAgQk9PTCByZXM7CiAgICAgaW50IHdoZW5jZTsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsK
IAogICAgIGdmaCA9IGd1ZXN0X2ZpbGVfaGFuZGxlX2ZpbmQoaGFuZGxlLCBlcnJwKTsKICAgICBp
ZiAoIWdmaCkgewpAQCAtNDI0LDkgKzQxNiw4IEBAIEd1ZXN0RmlsZVNlZWsgKnFtcF9ndWVzdF9m
aWxlX3NlZWsoaW50NjRfdCBoYW5kbGUsIGludDY0X3Qgb2Zmc2V0LAogICAgIH0KIAogICAgIC8q
IFdlIHN0dXBpZGx5IGV4cG9zZWQgJ3doZW5jZSc6J2ludCcgaW4gb3VyIHFhcGkgKi8KLSAgICB3
aGVuY2UgPSBnYV9wYXJzZV93aGVuY2Uod2hlbmNlX2NvZGUsICZlcnIpOwotICAgIGlmIChlcnIp
IHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgd2hlbmNlID0gZ2Ff
cGFyc2Vfd2hlbmNlKHdoZW5jZV9jb2RlLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAg
ICAgcmV0dXJuIE5VTEw7CiAgICAgfQogCkBAIC03OTUsNyArNzg2LDYgQEAgc3RhdGljIHZvaWQg
Z2V0X3NpbmdsZV9kaXNrX2luZm8oaW50IGRpc2tfbnVtYmVyLAogICAgIFNDU0lfQUREUkVTUyBh
ZGRyLCAqc2NzaV9hZDsKICAgICBEV09SRCBsZW47CiAgICAgSEFORExFIGRpc2tfaDsKLSAgICBF
cnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAogICAgIHNjc2lfYWQgPSAmYWRkcjsKIApAQCAtODA3
LDkgKzc5Nyw4IEBAIHN0YXRpYyB2b2lkIGdldF9zaW5nbGVfZGlza19pbmZvKGludCBkaXNrX251
bWJlciwKICAgICAgICAgcmV0dXJuOwogICAgIH0KIAotICAgIGdldF9kaXNrX3Byb3BlcnRpZXMo
ZGlza19oLCBkaXNrLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAg
IGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIGdldF9kaXNrX3Byb3BlcnRp
ZXMoZGlza19oLCBkaXNrLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ290byBl
cnJfY2xvc2U7CiAgICAgfQogCkBAIC04MTksOSArODA4LDggQEAgc3RhdGljIHZvaWQgZ2V0X3Np
bmdsZV9kaXNrX2luZm8oaW50IGRpc2tfbnVtYmVyLAogICAgICAqIGlmIHRoYXQgZG9lc24ndCBo
b2xkIHNpbmNlIHRoYXQgc3VnZ2VzdHMgc29tZSBvdGhlciB1bmV4cGVjdGVkCiAgICAgICogYnJl
YWthZ2UKICAgICAgKi8KLSAgICBkaXNrLT5wY2lfY29udHJvbGxlciA9IGdldF9wY2lfaW5mbyhk
aXNrX251bWJlciwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBl
cnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBkaXNrLT5wY2lfY29udHJvbGxl
ciA9IGdldF9wY2lfaW5mbyhkaXNrX251bWJlciwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAg
ICAgICAgIGdvdG8gZXJyX2Nsb3NlOwogICAgIH0KICAgICBpZiAoZGlzay0+YnVzX3R5cGUgPT0g
R1VFU1RfRElTS19CVVNfVFlQRV9TQ1NJCkBAIC04NTQsNyArODQyLDYgQEAgZXJyX2Nsb3NlOgog
ICogdm9sdW1lIGlzIHJldHVybmVkIGZvciB0aGUgc3Bhbm5lZCBkaXNrIGdyb3VwIChMVk0pICov
CiBzdGF0aWMgR3Vlc3REaXNrQWRkcmVzc0xpc3QgKmJ1aWxkX2d1ZXN0X2Rpc2tfaW5mbyhjaGFy
ICpndWlkLCBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAg
ICAgR3Vlc3REaXNrQWRkcmVzc0xpc3QgKmxpc3QgPSBOVUxMLCAqY3VyX2l0ZW0gPSBOVUxMOwog
ICAgIEd1ZXN0RGlza0FkZHJlc3MgKmRpc2sgPSBOVUxMOwogICAgIGludCBpOwpAQCAtOTAwLDEx
ICs4ODcsMTEgQEAgc3RhdGljIEd1ZXN0RGlza0FkZHJlc3NMaXN0ICpidWlsZF9ndWVzdF9kaXNr
X2luZm8oY2hhciAqZ3VpZCwgRXJyb3IgKiplcnJwKQogICAgICAgICAgICAgZGlzayA9IGdfbWFs
bG9jMChzaXplb2YoR3Vlc3REaXNrQWRkcmVzcykpOwogICAgICAgICAgICAgZGlzay0+aGFzX2Rl
diA9IHRydWU7CiAgICAgICAgICAgICBkaXNrLT5kZXYgPSBnX3N0cmR1cChuYW1lKTsKLSAgICAg
ICAgICAgIGdldF9zaW5nbGVfZGlza19pbmZvKDB4ZmZmZmZmZmYsIGRpc2ssICZsb2NhbF9lcnIp
OwotICAgICAgICAgICAgaWYgKGxvY2FsX2VycikgeworICAgICAgICAgICAgZ2V0X3NpbmdsZV9k
aXNrX2luZm8oMHhmZmZmZmZmZiwgZGlzaywgZXJycCk7CisgICAgICAgICAgICBpZiAoKmVycnAp
IHsKICAgICAgICAgICAgICAgICBnX2RlYnVnKCJmYWlsZWQgdG8gZ2V0IGRpc2sgaW5mbywgaWdu
b3JpbmcgZXJyb3I6ICVzIiwKLSAgICAgICAgICAgICAgICAgICAgZXJyb3JfZ2V0X3ByZXR0eShs
b2NhbF9lcnIpKTsKLSAgICAgICAgICAgICAgICBlcnJvcl9mcmVlKGxvY2FsX2Vycik7CisgICAg
ICAgICAgICAgICAgICAgIGVycm9yX2dldF9wcmV0dHkoKmVycnApKTsKKyAgICAgICAgICAgICAg
ICBlcnJvcl9mcmVlX2VycnAoZXJycCk7CiAgICAgICAgICAgICAgICAgZ290byBvdXQ7CiAgICAg
ICAgICAgICB9CiAgICAgICAgICAgICBsaXN0ID0gZ19tYWxsb2MwKHNpemVvZigqbGlzdCkpOwpA
QCAtOTM2LDkgKzkyMyw4IEBAIHN0YXRpYyBHdWVzdERpc2tBZGRyZXNzTGlzdCAqYnVpbGRfZ3Vl
c3RfZGlza19pbmZvKGNoYXIgKmd1aWQsIEVycm9yICoqZXJycCkKICAgICAgICAgZGlzay0+ZGV2
ID0gZ19zdHJkdXBfcHJpbnRmKCJcXFxcLlxcUGh5c2ljYWxEcml2ZSVsdSIsCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBleHRlbnRzLT5FeHRlbnRzW2ldLkRpc2tOdW1iZXIp
OwogCi0gICAgICAgIGdldF9zaW5nbGVfZGlza19pbmZvKGV4dGVudHMtPkV4dGVudHNbaV0uRGlz
a051bWJlciwgZGlzaywgJmxvY2FsX2Vycik7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsKLSAg
ICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICBnZXRf
c2luZ2xlX2Rpc2tfaW5mbyhleHRlbnRzLT5FeHRlbnRzW2ldLkRpc2tOdW1iZXIsIGRpc2ssIGVy
cnApOworICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIGdvdG8gb3V0OwogICAgICAg
ICB9CiAgICAgICAgIGN1cl9pdGVtID0gZ19tYWxsb2MwKHNpemVvZigqbGlzdCkpOwpAQCAtMTA5
MSw3ICsxMDc3LDYgQEAgaW50NjRfdCBxbXBfZ3Vlc3RfZnNmcmVlemVfZnJlZXplX2xpc3QoYm9v
bCBoYXNfbW91bnRwb2ludHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBFcnJvciAqKmVycnApCiB7CiAgICAgaW50IGk7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5V
TEw7CiAKICAgICBpZiAoIXZzc19pbml0aWFsaXplZCgpKSB7CiAgICAgICAgIGVycm9yX3NldGco
ZXJycCwgUUVSUl9VTlNVUFBPUlRFRCk7CkBAIC0xMTAzLDIwICsxMDg4LDE5IEBAIGludDY0X3Qg
cW1wX2d1ZXN0X2ZzZnJlZXplX2ZyZWV6ZV9saXN0KGJvb2wgaGFzX21vdW50cG9pbnRzLAogICAg
IC8qIGNhbm5vdCByaXNrIGd1ZXN0IGFnZW50IGJsb2NraW5nIGl0c2VsZiBvbiBhIHdyaXRlIGlu
IHRoaXMgc3RhdGUgKi8KICAgICBnYV9zZXRfZnJvemVuKGdhX3N0YXRlKTsKIAotICAgIHFnYV92
c3NfZnNmcmVlemUoJmksIHRydWUsIG1vdW50cG9pbnRzLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAo
bG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwor
ICAgIHFnYV92c3NfZnNmcmVlemUoJmksIHRydWUsIG1vdW50cG9pbnRzLCBlcnJwKTsKKyAgICBp
ZiAoKmVycnApIHsKICAgICAgICAgZ290byBlcnJvcjsKICAgICB9CiAKICAgICByZXR1cm4gaTsK
IAogZXJyb3I6Ci0gICAgbG9jYWxfZXJyID0gTlVMTDsKLSAgICBxbXBfZ3Vlc3RfZnNmcmVlemVf
dGhhdygmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGdfZGVidWco
ImNsZWFudXAgdGhhdzogJXMiLCBlcnJvcl9nZXRfcHJldHR5KGxvY2FsX2VycikpOwotICAgICAg
ICBlcnJvcl9mcmVlKGxvY2FsX2Vycik7CisgICAgKmVycnAgPSBOVUxMOworICAgIHFtcF9ndWVz
dF9mc2ZyZWV6ZV90aGF3KGVycnApOworICAgIGlmICgqZXJycCkgeworICAgICAgICBnX2RlYnVn
KCJjbGVhbnVwIHRoYXc6ICVzIiwgZXJyb3JfZ2V0X3ByZXR0eSgqZXJycCkpOworICAgICAgICBl
cnJvcl9mcmVlX2VycnAoZXJycCk7CiAgICAgfQogICAgIHJldHVybiAwOwogfQpAQCAtMTI4Miwz
NSArMTI2NiwzMSBAQCB0eXBlZGVmIGVudW0gewogc3RhdGljIHZvaWQgY2hlY2tfc3VzcGVuZF9t
b2RlKEd1ZXN0U3VzcGVuZE1vZGUgbW9kZSwgRXJyb3IgKiplcnJwKQogewogICAgIFNZU1RFTV9Q
T1dFUl9DQVBBQklMSVRJRVMgc3lzX3B3cl9jYXBzOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBO
VUxMOwogCiAgICAgWmVyb01lbW9yeSgmc3lzX3B3cl9jYXBzLCBzaXplb2Yoc3lzX3B3cl9jYXBz
KSk7CiAgICAgaWYgKCFHZXRQd3JDYXBhYmlsaXRpZXMoJnN5c19wd3JfY2FwcykpIHsKLSAgICAg
ICAgZXJyb3Jfc2V0ZygmbG9jYWxfZXJyLCBRRVJSX1FHQV9DT01NQU5EX0ZBSUxFRCwKKyAgICAg
ICAgZXJyb3Jfc2V0ZyhlcnJwLCBRRVJSX1FHQV9DT01NQU5EX0ZBSUxFRCwKICAgICAgICAgICAg
ICAgICAgICAiZmFpbGVkIHRvIGRldGVybWluZSBndWVzdCBzdXNwZW5kIGNhcGFiaWxpdGllcyIp
OwotICAgICAgICBnb3RvIG91dDsKKyAgICAgICAgcmV0dXJuOwogICAgIH0KIAogICAgIHN3aXRj
aCAobW9kZSkgewogICAgIGNhc2UgR1VFU1RfU1VTUEVORF9NT0RFX0RJU0s6CiAgICAgICAgIGlm
ICghc3lzX3B3cl9jYXBzLlN5c3RlbVM0KSB7Ci0gICAgICAgICAgICBlcnJvcl9zZXRnKCZsb2Nh
bF9lcnIsIFFFUlJfUUdBX0NPTU1BTkRfRkFJTEVELAorICAgICAgICAgICAgZXJyb3Jfc2V0Zyhl
cnJwLCBRRVJSX1FHQV9DT01NQU5EX0ZBSUxFRCwKICAgICAgICAgICAgICAgICAgICAgICAgInN1
c3BlbmQtdG8tZGlzayBub3Qgc3VwcG9ydGVkIGJ5IE9TIik7CiAgICAgICAgIH0KICAgICAgICAg
YnJlYWs7CiAgICAgY2FzZSBHVUVTVF9TVVNQRU5EX01PREVfUkFNOgogICAgICAgICBpZiAoIXN5
c19wd3JfY2Fwcy5TeXN0ZW1TMykgewotICAgICAgICAgICAgZXJyb3Jfc2V0ZygmbG9jYWxfZXJy
LCBRRVJSX1FHQV9DT01NQU5EX0ZBSUxFRCwKKyAgICAgICAgICAgIGVycm9yX3NldGcoZXJycCwg
UUVSUl9RR0FfQ09NTUFORF9GQUlMRUQsCiAgICAgICAgICAgICAgICAgICAgICAgICJzdXNwZW5k
LXRvLXJhbSBub3Qgc3VwcG9ydGVkIGJ5IE9TIik7CiAgICAgICAgIH0KICAgICAgICAgYnJlYWs7
CiAgICAgZGVmYXVsdDoKLSAgICAgICAgZXJyb3Jfc2V0ZygmbG9jYWxfZXJyLCBRRVJSX0lOVkFM
SURfUEFSQU1FVEVSX1ZBTFVFLCAibW9kZSIsCisgICAgICAgIGVycm9yX3NldGcoZXJycCwgUUVS
Ul9JTlZBTElEX1BBUkFNRVRFUl9WQUxVRSwgIm1vZGUiLAogICAgICAgICAgICAgICAgICAgICJH
dWVzdFN1c3BlbmRNb2RlIik7CiAgICAgfQotCi1vdXQ6Ci0gICAgZXJyb3JfcHJvcGFnYXRlKGVy
cnAsIGxvY2FsX2Vycik7CiB9CiAKIHN0YXRpYyBEV09SRCBXSU5BUEkgZG9fc3VzcGVuZChMUFZP
SUQgb3BhcXVlKQpAQCAtMTMyOCwzMiArMTMwOCwyOCBAQCBzdGF0aWMgRFdPUkQgV0lOQVBJIGRv
X3N1c3BlbmQoTFBWT0lEIG9wYXF1ZSkKIAogdm9pZCBxbXBfZ3Vlc3Rfc3VzcGVuZF9kaXNrKEVy
cm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBHdWVzdFN1
c3BlbmRNb2RlICptb2RlID0gZ19uZXcoR3Vlc3RTdXNwZW5kTW9kZSwgMSk7CiAKICAgICAqbW9k
ZSA9IEdVRVNUX1NVU1BFTkRfTU9ERV9ESVNLOwotICAgIGNoZWNrX3N1c3BlbmRfbW9kZSgqbW9k
ZSwgJmxvY2FsX2Vycik7Ci0gICAgYWNxdWlyZV9wcml2aWxlZ2UoU0VfU0hVVERPV05fTkFNRSwg
JmxvY2FsX2Vycik7Ci0gICAgZXhlY3V0ZV9hc3luYyhkb19zdXNwZW5kLCBtb2RlLCAmbG9jYWxf
ZXJyKTsKKyAgICBjaGVja19zdXNwZW5kX21vZGUoKm1vZGUsIGVycnApOworICAgIGFjcXVpcmVf
cHJpdmlsZWdlKFNFX1NIVVRET1dOX05BTUUsIGVycnApOworICAgIGV4ZWN1dGVfYXN5bmMoZG9f
c3VzcGVuZCwgbW9kZSwgZXJycCk7CiAKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVy
cm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIGlmICgqZXJycCkgewogICAgICAg
ICBnX2ZyZWUobW9kZSk7CiAgICAgfQogfQogCiB2b2lkIHFtcF9ndWVzdF9zdXNwZW5kX3JhbShF
cnJvciAqKmVycnApCiB7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgR3Vlc3RT
dXNwZW5kTW9kZSAqbW9kZSA9IGdfbmV3KEd1ZXN0U3VzcGVuZE1vZGUsIDEpOwogCiAgICAgKm1v
ZGUgPSBHVUVTVF9TVVNQRU5EX01PREVfUkFNOwotICAgIGNoZWNrX3N1c3BlbmRfbW9kZSgqbW9k
ZSwgJmxvY2FsX2Vycik7Ci0gICAgYWNxdWlyZV9wcml2aWxlZ2UoU0VfU0hVVERPV05fTkFNRSwg
JmxvY2FsX2Vycik7Ci0gICAgZXhlY3V0ZV9hc3luYyhkb19zdXNwZW5kLCBtb2RlLCAmbG9jYWxf
ZXJyKTsKKyAgICBjaGVja19zdXNwZW5kX21vZGUoKm1vZGUsIGVycnApOworICAgIGFjcXVpcmVf
cHJpdmlsZWdlKFNFX1NIVVRET1dOX05BTUUsIGVycnApOworICAgIGV4ZWN1dGVfYXN5bmMoZG9f
c3VzcGVuZCwgbW9kZSwgZXJycCk7CiAKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVy
cm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIGlmICgqZXJycCkgewogICAgICAg
ICBnX2ZyZWUobW9kZSk7CiAgICAgfQogfQpAQCAtMTYxNiw3ICsxNTkyLDYgQEAgaW50NjRfdCBx
bXBfZ3Vlc3RfZ2V0X3RpbWUoRXJyb3IgKiplcnJwKQogCiB2b2lkIHFtcF9ndWVzdF9zZXRfdGlt
ZShib29sIGhhc190aW1lLCBpbnQ2NF90IHRpbWVfbnMsIEVycm9yICoqZXJycCkKIHsKLSAgICBF
cnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBTWVNURU1USU1FIHRzOwogICAgIEZJTEVUSU1F
IHRmOwogICAgIExPTkdMT05HIHRpbWU7CkBAIC0xNjgxLDkgKzE2NTYsOCBAQCB2b2lkIHFtcF9n
dWVzdF9zZXRfdGltZShib29sIGhhc190aW1lLCBpbnQ2NF90IHRpbWVfbnMsIEVycm9yICoqZXJy
cCkKICAgICAgICAgcmV0dXJuOwogICAgIH0KIAotICAgIGFjcXVpcmVfcHJpdmlsZWdlKFNFX1NZ
U1RFTVRJTUVfTkFNRSwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAg
ICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBhY3F1aXJlX3ByaXZpbGVn
ZShTRV9TWVNURU1USU1FX05BTUUsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICBy
ZXR1cm47CiAgICAgfQogCkBAIC0xNjk4LDcgKzE2NzIsNiBAQCBHdWVzdExvZ2ljYWxQcm9jZXNz
b3JMaXN0ICpxbXBfZ3Vlc3RfZ2V0X3ZjcHVzKEVycm9yICoqZXJycCkKICAgICBQU1lTVEVNX0xP
R0lDQUxfUFJPQ0VTU09SX0lORk9STUFUSU9OIHBzbHBpLCBwdHI7CiAgICAgRFdPUkQgbGVuZ3Ro
OwogICAgIEd1ZXN0TG9naWNhbFByb2Nlc3Nvckxpc3QgKmhlYWQsICoqbGluazsKLSAgICBFcnJv
ciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBpbnQ2NF90IGN1cnJlbnQ7CiAKICAgICBwdHIgPSBw
c2xwaSA9IE5VTEw7CkBAIC0xNzEyLDE2ICsxNjg1LDE2IEBAIEd1ZXN0TG9naWNhbFByb2Nlc3Nv
ckxpc3QgKnFtcF9ndWVzdF9nZXRfdmNwdXMoRXJyb3IgKiplcnJwKQogICAgICAgICAobGVuZ3Ro
ID4gc2l6ZW9mKFNZU1RFTV9MT0dJQ0FMX1BST0NFU1NPUl9JTkZPUk1BVElPTikpKSB7CiAgICAg
ICAgIHB0ciA9IHBzbHBpID0gZ19tYWxsb2MwKGxlbmd0aCk7CiAgICAgICAgIGlmIChHZXRMb2dp
Y2FsUHJvY2Vzc29ySW5mb3JtYXRpb24ocHNscGksICZsZW5ndGgpID09IEZBTFNFKSB7Ci0gICAg
ICAgICAgICBlcnJvcl9zZXRnKCZsb2NhbF9lcnIsICJGYWlsZWQgdG8gZ2V0IHByb2Nlc3NvciBp
bmZvcm1hdGlvbjogJWQiLAorICAgICAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAiRmFpbGVkIHRv
IGdldCBwcm9jZXNzb3IgaW5mb3JtYXRpb246ICVkIiwKICAgICAgICAgICAgICAgICAgICAgICAg
KGludClHZXRMYXN0RXJyb3IoKSk7CiAgICAgICAgIH0KICAgICB9IGVsc2UgewotICAgICAgICBl
cnJvcl9zZXRnKCZsb2NhbF9lcnIsCisgICAgICAgIGVycm9yX3NldGcoZXJycCwKICAgICAgICAg
ICAgICAgICAgICAiRmFpbGVkIHRvIGdldCBwcm9jZXNzb3IgaW5mb3JtYXRpb24gYnVmZmVyIGxl
bmd0aDogJWQiLAogICAgICAgICAgICAgICAgICAgIChpbnQpR2V0TGFzdEVycm9yKCkpOwogICAg
IH0KIAotICAgIHdoaWxlICgobG9jYWxfZXJyID09IE5VTEwpICYmIChsZW5ndGggPiAwKSkgewor
ICAgIHdoaWxlICgoKmVycnAgPT0gTlVMTCkgJiYgKGxlbmd0aCA+IDApKSB7CiAgICAgICAgIGlm
IChwc2xwaS0+UmVsYXRpb25zaGlwID09IFJlbGF0aW9uUHJvY2Vzc29yQ29yZSkgewogICAgICAg
ICAgICAgVUxPTkdfUFRSIGNwdV9iaXRzID0gcHNscGktPlByb2Nlc3Nvck1hc2s7CiAKQEAgLTE3
NTAsMTYgKzE3MjMsMTUgQEAgR3Vlc3RMb2dpY2FsUHJvY2Vzc29yTGlzdCAqcW1wX2d1ZXN0X2dl
dF92Y3B1cyhFcnJvciAqKmVycnApCiAKICAgICBnX2ZyZWUocHRyKTsKIAotICAgIGlmIChsb2Nh
bF9lcnIgPT0gTlVMTCkgeworICAgIGlmICgqZXJycCA9PSBOVUxMKSB7CiAgICAgICAgIGlmICho
ZWFkICE9IE5VTEwpIHsKICAgICAgICAgICAgIHJldHVybiBoZWFkOwogICAgICAgICB9CiAgICAg
ICAgIC8qIHRoZXJlJ3Mgbm8gZ3Vlc3Qgd2l0aCB6ZXJvIFZDUFVzICovCi0gICAgICAgIGVycm9y
X3NldGcoJmxvY2FsX2VyciwgIkd1ZXN0IHJlcG9ydGVkIHplcm8gVkNQVXMiKTsKKyAgICAgICAg
ZXJyb3Jfc2V0ZyhlcnJwLCAiR3Vlc3QgcmVwb3J0ZWQgemVybyBWQ1BVcyIpOwogICAgIH0KIAog
ICAgIHFhcGlfZnJlZV9HdWVzdExvZ2ljYWxQcm9jZXNzb3JMaXN0KGhlYWQpOwotICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogICAgIHJldHVybiBOVUxMOwogfQogCkBAIC0y
MTg2LDIyICsyMTU4LDE5IEBAIHN0YXRpYyBjaGFyICpnYV9nZXRfY3VycmVudF9hcmNoKHZvaWQp
CiAKIEd1ZXN0T1NJbmZvICpxbXBfZ3Vlc3RfZ2V0X29zaW5mbyhFcnJvciAqKmVycnApCiB7Ci0g
ICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgT1NWRVJTSU9OSU5GT0VYVyBvc192ZXJz
aW9uID0gezB9OwogICAgIGJvb2wgc2VydmVyOwogICAgIGNoYXIgKnByb2R1Y3RfbmFtZTsKICAg
ICBHdWVzdE9TSW5mbyAqaW5mbzsKIAotICAgIGdhX2dldF93aW5fdmVyc2lvbigmb3NfdmVyc2lv
biwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9w
YWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBnYV9nZXRfd2luX3ZlcnNpb24oJm9zX3ZlcnNp
b24sIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm4gTlVMTDsKICAgICB9
CiAKICAgICBzZXJ2ZXIgPSBvc192ZXJzaW9uLndQcm9kdWN0VHlwZSAhPSBWRVJfTlRfV09SS1NU
QVRJT047Ci0gICAgcHJvZHVjdF9uYW1lID0gZ2FfZ2V0X3dpbl9wcm9kdWN0X25hbWUoJmxvY2Fs
X2Vycik7CisgICAgcHJvZHVjdF9uYW1lID0gZ2FfZ2V0X3dpbl9wcm9kdWN0X25hbWUoZXJycCk7
CiAgICAgaWYgKHByb2R1Y3RfbmFtZSA9PSBOVUxMKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0
ZShlcnJwLCBsb2NhbF9lcnIpOwogICAgICAgICByZXR1cm4gTlVMTDsKICAgICB9CiAKZGlmZiAt
LWdpdCBhL3FvbS9vYmplY3QuYyBiL3FvbS9vYmplY3QuYwppbmRleCA2ZmE5YzYxOWZhLi42N2Y2
YjZhYzlkIDEwMDY0NAotLS0gYS9xb20vb2JqZWN0LmMKKysrIGIvcW9tL29iamVjdC5jCkBAIC0z
ODIsNyArMzgyLDYgQEAgdm9pZCBvYmplY3RfYXBwbHlfZ2xvYmFsX3Byb3BzKE9iamVjdCAqb2Jq
LCBjb25zdCBHUHRyQXJyYXkgKnByb3BzLCBFcnJvciAqKmVycnAKIAogICAgIGZvciAoaSA9IDA7
IGkgPCBwcm9wcy0+bGVuOyBpKyspIHsKICAgICAgICAgR2xvYmFsUHJvcGVydHkgKnAgPSBnX3B0
cl9hcnJheV9pbmRleChwcm9wcywgaSk7Ci0gICAgICAgIEVycm9yICplcnIgPSBOVUxMOwogCiAg
ICAgICAgIGlmIChvYmplY3RfZHluYW1pY19jYXN0KG9iaiwgcC0+ZHJpdmVyKSA9PSBOVUxMKSB7
CiAgICAgICAgICAgICBjb250aW51ZTsKQEAgLTM5MSw5ICszOTAsOSBAQCB2b2lkIG9iamVjdF9h
cHBseV9nbG9iYWxfcHJvcHMoT2JqZWN0ICpvYmosIGNvbnN0IEdQdHJBcnJheSAqcHJvcHMsIEVy
cm9yICoqZXJycAogICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgIH0KICAgICAgICAgcC0+
dXNlZCA9IHRydWU7Ci0gICAgICAgIG9iamVjdF9wcm9wZXJ0eV9wYXJzZShvYmosIHAtPnZhbHVl
LCBwLT5wcm9wZXJ0eSwgJmVycik7Ci0gICAgICAgIGlmIChlcnIgIT0gTlVMTCkgewotICAgICAg
ICAgICAgZXJyb3JfcHJlcGVuZCgmZXJyLCAiY2FuJ3QgYXBwbHkgZ2xvYmFsICVzLiVzPSVzOiAi
LAorICAgICAgICBvYmplY3RfcHJvcGVydHlfcGFyc2Uob2JqLCBwLT52YWx1ZSwgcC0+cHJvcGVy
dHksIGVycnApOworICAgICAgICBpZiAoKmVycnAgIT0gTlVMTCkgeworICAgICAgICAgICAgZXJy
b3JfcHJlcGVuZChlcnJwLCAiY2FuJ3QgYXBwbHkgZ2xvYmFsICVzLiVzPSVzOiAiLAogICAgICAg
ICAgICAgICAgICAgICAgICAgICBwLT5kcml2ZXIsIHAtPnByb3BlcnR5LCBwLT52YWx1ZSk7CiAg
ICAgICAgICAgICAvKgogICAgICAgICAgICAgICogSWYgZXJycCAhPSBOVUxMLCBwcm9wYWdhdGUg
ZXJyb3IgYW5kIHJldHVybi4KQEAgLTQwMSwxMCArNDAwLDkgQEAgdm9pZCBvYmplY3RfYXBwbHlf
Z2xvYmFsX3Byb3BzKE9iamVjdCAqb2JqLCBjb25zdCBHUHRyQXJyYXkgKnByb3BzLCBFcnJvciAq
KmVycnAKICAgICAgICAgICAgICAqIHdpdGggdGhlIHJlbWFpbmluZyBnbG9iYWxzLgogICAgICAg
ICAgICAgICovCiAgICAgICAgICAgICBpZiAoZXJycCkgewotICAgICAgICAgICAgICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBlcnIpOwogICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAg
ICAgIH0gZWxzZSB7Ci0gICAgICAgICAgICAgICAgd2Fybl9yZXBvcnRfZXJyKGVycik7CisgICAg
ICAgICAgICAgICAgd2Fybl9yZXBvcnRfZXJycChlcnJwKTsKICAgICAgICAgICAgIH0KICAgICAg
ICAgfQogICAgIH0KQEAgLTE0MzAsNyArMTQyOCw2IEBAIHR5cGVkZWYgc3RydWN0IEVudW1Qcm9w
ZXJ0eSB7CiBpbnQgb2JqZWN0X3Byb3BlcnR5X2dldF9lbnVtKE9iamVjdCAqb2JqLCBjb25zdCBj
aGFyICpuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGFyICp0eXBl
bmFtZSwgRXJyb3IgKiplcnJwKQogewotICAgIEVycm9yICplcnIgPSBOVUxMOwogICAgIFZpc2l0
b3IgKnY7CiAgICAgY2hhciAqc3RyOwogICAgIGludCByZXQ7CkBAIC0xNDUxLDkgKzE0NDgsOCBA
QCBpbnQgb2JqZWN0X3Byb3BlcnR5X2dldF9lbnVtKE9iamVjdCAqb2JqLCBjb25zdCBjaGFyICpu
YW1lLAogICAgIGVudW1wcm9wID0gcHJvcC0+b3BhcXVlOwogCiAgICAgdiA9IHN0cmluZ19vdXRw
dXRfdmlzaXRvcl9uZXcoZmFsc2UsICZzdHIpOwotICAgIG9iamVjdF9wcm9wZXJ0eV9nZXQob2Jq
LCB2LCBuYW1lLCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0
ZShlcnJwLCBlcnIpOworICAgIG9iamVjdF9wcm9wZXJ0eV9nZXQob2JqLCB2LCBuYW1lLCBlcnJw
KTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgdmlzaXRfZnJlZSh2KTsKICAgICAgICAgcmV0
dXJuIDA7CiAgICAgfQpAQCAtMTQ3MSwxNCArMTQ2NywxMiBAQCBpbnQgb2JqZWN0X3Byb3BlcnR5
X2dldF9lbnVtKE9iamVjdCAqb2JqLCBjb25zdCBjaGFyICpuYW1lLAogdm9pZCBvYmplY3RfcHJv
cGVydHlfZ2V0X3VpbnQxNkxpc3QoT2JqZWN0ICpvYmosIGNvbnN0IGNoYXIgKm5hbWUsCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MTZMaXN0ICoqbGlzdCwgRXJyb3Ig
KiplcnJwKQogewotICAgIEVycm9yICplcnIgPSBOVUxMOwogICAgIFZpc2l0b3IgKnY7CiAgICAg
Y2hhciAqc3RyOwogCiAgICAgdiA9IHN0cmluZ19vdXRwdXRfdmlzaXRvcl9uZXcoZmFsc2UsICZz
dHIpOwotICAgIG9iamVjdF9wcm9wZXJ0eV9nZXQob2JqLCB2LCBuYW1lLCAmZXJyKTsKLSAgICBp
ZiAoZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgIG9iamVj
dF9wcm9wZXJ0eV9nZXQob2JqLCB2LCBuYW1lLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAg
ICAgICAgZ290byBvdXQ7CiAgICAgfQogICAgIHZpc2l0X2NvbXBsZXRlKHYsICZzdHIpOwpAQCAt
MTUwNCwxMiArMTQ5OCwxMCBAQCBjaGFyICpvYmplY3RfcHJvcGVydHlfcHJpbnQoT2JqZWN0ICpv
YmosIGNvbnN0IGNoYXIgKm5hbWUsIGJvb2wgaHVtYW4sCiB7CiAgICAgVmlzaXRvciAqdjsKICAg
ICBjaGFyICpzdHJpbmcgPSBOVUxMOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAg
ICAgdiA9IHN0cmluZ19vdXRwdXRfdmlzaXRvcl9uZXcoaHVtYW4sICZzdHJpbmcpOwotICAgIG9i
amVjdF9wcm9wZXJ0eV9nZXQob2JqLCB2LCBuYW1lLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9j
YWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAg
IG9iamVjdF9wcm9wZXJ0eV9nZXQob2JqLCB2LCBuYW1lLCBlcnJwKTsKKyAgICBpZiAoKmVycnAp
IHsKICAgICAgICAgZ290byBvdXQ7CiAgICAgfQogCkBAIC0xNTg5LDcgKzE1ODEsNiBAQCBzdGF0
aWMgdm9pZCBvYmplY3RfZmluYWxpemVfY2hpbGRfcHJvcGVydHkoT2JqZWN0ICpvYmosIGNvbnN0
IGNoYXIgKm5hbWUsCiB2b2lkIG9iamVjdF9wcm9wZXJ0eV9hZGRfY2hpbGQoT2JqZWN0ICpvYmos
IGNvbnN0IGNoYXIgKm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0
ICpjaGlsZCwgRXJyb3IgKiplcnJwKQogewotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwog
ICAgIGdjaGFyICp0eXBlOwogICAgIE9iamVjdFByb3BlcnR5ICpvcDsKIApAQCAtMTYwMSw5ICsx
NTkyLDggQEAgdm9pZCBvYmplY3RfcHJvcGVydHlfYWRkX2NoaWxkKE9iamVjdCAqb2JqLCBjb25z
dCBjaGFyICpuYW1lLAogICAgIHR5cGUgPSBnX3N0cmR1cF9wcmludGYoImNoaWxkPCVzPiIsIG9i
amVjdF9nZXRfdHlwZW5hbWUoT0JKRUNUKGNoaWxkKSkpOwogCiAgICAgb3AgPSBvYmplY3RfcHJv
cGVydHlfYWRkKG9iaiwgbmFtZSwgdHlwZSwgb2JqZWN0X2dldF9jaGlsZF9wcm9wZXJ0eSwgTlVM
TCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0X2ZpbmFsaXplX2NoaWxkX3By
b3BlcnR5LCBjaGlsZCwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAg
ICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgb2JqZWN0X2ZpbmFsaXplX2NoaWxkX3Byb3BlcnR5LCBjaGlsZCwgZXJycCk7Cisg
ICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8gb3V0OwogICAgIH0KIApAQCAtMTYxOCw2ICsx
NjA4LDcgQEAgb3V0Ogogdm9pZCBvYmplY3RfcHJvcGVydHlfYWxsb3dfc2V0X2xpbmsoY29uc3Qg
T2JqZWN0ICpvYmosIGNvbnN0IGNoYXIgKm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBPYmplY3QgKnZhbCwgRXJyb3IgKiplcnJwKQogeworCUVSUlBfRlVOQ1RJT05f
QkVHSU4oKTsKICAgICAvKiBBbGxvdyB0aGUgbGluayB0byBiZSBzZXQsIGFsd2F5cyAqLwogfQog
CkBAIC0xNjg5LDI4ICsxNjgwLDI1IEBAIHN0YXRpYyB2b2lkIG9iamVjdF9zZXRfbGlua19wcm9w
ZXJ0eShPYmplY3QgKm9iaiwgVmlzaXRvciAqdiwKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBjb25zdCBjaGFyICpuYW1lLCB2b2lkICpvcGFxdWUsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJwKQogewotICAgIEVycm9yICpsb2Nh
bF9lcnIgPSBOVUxMOwogICAgIExpbmtQcm9wZXJ0eSAqcHJvcCA9IG9wYXF1ZTsKICAgICBPYmpl
Y3QgKipjaGlsZCA9IHByb3AtPmNoaWxkOwogICAgIE9iamVjdCAqb2xkX3RhcmdldCA9ICpjaGls
ZDsKICAgICBPYmplY3QgKm5ld190YXJnZXQgPSBOVUxMOwogICAgIGNoYXIgKnBhdGggPSBOVUxM
OwogCi0gICAgdmlzaXRfdHlwZV9zdHIodiwgbmFtZSwgJnBhdGgsICZsb2NhbF9lcnIpOworICAg
IHZpc2l0X3R5cGVfc3RyKHYsIG5hbWUsICZwYXRoLCBlcnJwKTsKIAotICAgIGlmICghbG9jYWxf
ZXJyICYmIHN0cmNtcChwYXRoLCAiIikgIT0gMCkgewotICAgICAgICBuZXdfdGFyZ2V0ID0gb2Jq
ZWN0X3Jlc29sdmVfbGluayhvYmosIG5hbWUsIHBhdGgsICZsb2NhbF9lcnIpOworICAgIGlmICgh
KmVycnAgJiYgc3RyY21wKHBhdGgsICIiKSAhPSAwKSB7CisgICAgICAgIG5ld190YXJnZXQgPSBv
YmplY3RfcmVzb2x2ZV9saW5rKG9iaiwgbmFtZSwgcGF0aCwgZXJycCk7CiAgICAgfQogCiAgICAg
Z19mcmVlKHBhdGgpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFn
YXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsK
ICAgICB9CiAKLSAgICBwcm9wLT5jaGVjayhvYmosIG5hbWUsIG5ld190YXJnZXQsICZsb2NhbF9l
cnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAs
IGxvY2FsX2Vycik7CisgICAgcHJvcC0+Y2hlY2sob2JqLCBuYW1lLCBuZXdfdGFyZ2V0LCBlcnJw
KTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApAQCAtMTc0Niw3
ICsxNzM0LDYgQEAgdm9pZCBvYmplY3RfcHJvcGVydHlfYWRkX2xpbmsoT2JqZWN0ICpvYmosIGNv
bnN0IGNoYXIgKm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3RQcm9w
ZXJ0eUxpbmtGbGFncyBmbGFncywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVycm9y
ICoqZXJycCkKIHsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBMaW5rUHJvcGVy
dHkgKnByb3AgPSBnX21hbGxvYyhzaXplb2YoKnByb3ApKTsKICAgICBnY2hhciAqZnVsbF90eXBl
OwogICAgIE9iamVjdFByb3BlcnR5ICpvcDsKQEAgLTE3NjIsOSArMTc0OSw4IEBAIHZvaWQgb2Jq
ZWN0X3Byb3BlcnR5X2FkZF9saW5rKE9iamVjdCAqb2JqLCBjb25zdCBjaGFyICpuYW1lLAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVjayA/IG9iamVjdF9zZXRfbGlua19wcm9wZXJ0
eSA6IE5VTEwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdF9yZWxlYXNlX2xp
bmtfcHJvcGVydHksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3AsCi0gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsK
LSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICBnX2ZyZWUo
cHJvcCk7CiAgICAgICAgIGdvdG8gb3V0OwogICAgIH0KQEAgLTE5NjEsMTEgKzE5NDcsOSBAQCBz
dGF0aWMgdm9pZCBwcm9wZXJ0eV9nZXRfc3RyKE9iamVjdCAqb2JqLCBWaXNpdG9yICp2LCBjb25z
dCBjaGFyICpuYW1lLAogewogICAgIFN0cmluZ1Byb3BlcnR5ICpwcm9wID0gb3BhcXVlOwogICAg
IGNoYXIgKnZhbHVlOwotICAgIEVycm9yICplcnIgPSBOVUxMOwogCi0gICAgdmFsdWUgPSBwcm9w
LT5nZXQob2JqLCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0
ZShlcnJwLCBlcnIpOworICAgIHZhbHVlID0gcHJvcC0+Z2V0KG9iaiwgZXJycCk7CisgICAgaWYg
KCplcnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKQEAgLTE5NzgsMTEgKzE5NjIsOSBA
QCBzdGF0aWMgdm9pZCBwcm9wZXJ0eV9zZXRfc3RyKE9iamVjdCAqb2JqLCBWaXNpdG9yICp2LCBj
b25zdCBjaGFyICpuYW1lLAogewogICAgIFN0cmluZ1Byb3BlcnR5ICpwcm9wID0gb3BhcXVlOwog
ICAgIGNoYXIgKnZhbHVlOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCi0gICAgdmlz
aXRfdHlwZV9zdHIodiwgbmFtZSwgJnZhbHVlLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxf
ZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHZp
c2l0X3R5cGVfc3RyKHYsIG5hbWUsICZ2YWx1ZSwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAg
ICAgICAgIHJldHVybjsKICAgICB9CiAKQEAgLTIwMDIsNyArMTk4NCw2IEBAIHZvaWQgb2JqZWN0
X3Byb3BlcnR5X2FkZF9zdHIoT2JqZWN0ICpvYmosIGNvbnN0IGNoYXIgKm5hbWUsCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICB2b2lkICgqc2V0KShPYmplY3QgKiwgY29uc3QgY2hhciAqLCBF
cnJvciAqKiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcnJvciAqKmVycnApCiB7Ci0g
ICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgU3RyaW5nUHJvcGVydHkgKnByb3AgPSBn
X21hbGxvYzAoc2l6ZW9mKCpwcm9wKSk7CiAKICAgICBwcm9wLT5nZXQgPSBnZXQ7CkBAIC0yMDEy
LDkgKzE5OTMsOCBAQCB2b2lkIG9iamVjdF9wcm9wZXJ0eV9hZGRfc3RyKE9iamVjdCAqb2JqLCBj
b25zdCBjaGFyICpuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgZ2V0ID8gcHJvcGVydHlf
Z2V0X3N0ciA6IE5VTEwsCiAgICAgICAgICAgICAgICAgICAgICAgICBzZXQgPyBwcm9wZXJ0eV9z
ZXRfc3RyIDogTlVMTCwKICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5X3JlbGVhc2Vf
c3RyLAotICAgICAgICAgICAgICAgICAgICAgICAgcHJvcCwgJmxvY2FsX2Vycik7Ci0gICAgaWYg
KGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsK
KyAgICAgICAgICAgICAgICAgICAgICAgIHByb3AsIGVycnApOworICAgIGlmICgqZXJycCkgewog
ICAgICAgICBnX2ZyZWUocHJvcCk7CiAgICAgfQogfQpAQCAtMjAyNSw3ICsyMDA1LDYgQEAgdm9p
ZCBvYmplY3RfY2xhc3NfcHJvcGVydHlfYWRkX3N0cihPYmplY3RDbGFzcyAqa2xhc3MsIGNvbnN0
IGNoYXIgKm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIEVycm9yICoqKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXJyb3Ig
KiplcnJwKQogewotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIFN0cmluZ1Byb3Bl
cnR5ICpwcm9wID0gZ19tYWxsb2MwKHNpemVvZigqcHJvcCkpOwogCiAgICAgcHJvcC0+Z2V0ID0g
Z2V0OwpAQCAtMjAzNSw5ICsyMDE0LDggQEAgdm9pZCBvYmplY3RfY2xhc3NfcHJvcGVydHlfYWRk
X3N0cihPYmplY3RDbGFzcyAqa2xhc3MsIGNvbnN0IGNoYXIgKm5hbWUsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBnZXQgPyBwcm9wZXJ0eV9nZXRfc3RyIDogTlVMTCwKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHNldCA/IHByb3BlcnR5X3NldF9zdHIgOiBOVUxMLAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlfcmVsZWFzZV9zdHIsCi0gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBwcm9wLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxf
ZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgcHJvcCwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAg
ICAgICAgIGdfZnJlZShwcm9wKTsKICAgICB9CiB9CkBAIC0yMDUzLDExICsyMDMxLDkgQEAgc3Rh
dGljIHZvaWQgcHJvcGVydHlfZ2V0X2Jvb2woT2JqZWN0ICpvYmosIFZpc2l0b3IgKnYsIGNvbnN0
IGNoYXIgKm5hbWUsCiB7CiAgICAgQm9vbFByb3BlcnR5ICpwcm9wID0gb3BhcXVlOwogICAgIGJv
b2wgdmFsdWU7Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7CiAKLSAgICB2YWx1ZSA9IHByb3AtPmdl
dChvYmosICZlcnIpOwotICAgIGlmIChlcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVy
cnAsIGVycik7CisgICAgdmFsdWUgPSBwcm9wLT5nZXQob2JqLCBlcnJwKTsKKyAgICBpZiAoKmVy
cnApIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApAQCAtMjA2OSwxMSArMjA0NSw5IEBAIHN0
YXRpYyB2b2lkIHByb3BlcnR5X3NldF9ib29sKE9iamVjdCAqb2JqLCBWaXNpdG9yICp2LCBjb25z
dCBjaGFyICpuYW1lLAogewogICAgIEJvb2xQcm9wZXJ0eSAqcHJvcCA9IG9wYXF1ZTsKICAgICBi
b29sIHZhbHVlOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCi0gICAgdmlzaXRfdHlw
ZV9ib29sKHYsIG5hbWUsICZ2YWx1ZSwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2Vycikg
ewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICB2aXNpdF90
eXBlX2Jvb2wodiwgbmFtZSwgJnZhbHVlLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAg
ICAgcmV0dXJuOwogICAgIH0KIApAQCAtMjA5Miw3ICsyMDY2LDYgQEAgdm9pZCBvYmplY3RfcHJv
cGVydHlfYWRkX2Jvb2woT2JqZWN0ICpvYmosIGNvbnN0IGNoYXIgKm5hbWUsCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICB2b2lkICgqc2V0KShPYmplY3QgKiwgYm9vbCwgRXJyb3IgKiop
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJwKQogewotICAgIEVy
cm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIEJvb2xQcm9wZXJ0eSAqcHJvcCA9IGdfbWFsbG9j
MChzaXplb2YoKnByb3ApKTsKIAogICAgIHByb3AtPmdldCA9IGdldDsKQEAgLTIxMDIsOSArMjA3
NSw4IEBAIHZvaWQgb2JqZWN0X3Byb3BlcnR5X2FkZF9ib29sKE9iamVjdCAqb2JqLCBjb25zdCBj
aGFyICpuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgZ2V0ID8gcHJvcGVydHlfZ2V0X2Jv
b2wgOiBOVUxMLAogICAgICAgICAgICAgICAgICAgICAgICAgc2V0ID8gcHJvcGVydHlfc2V0X2Jv
b2wgOiBOVUxMLAogICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlfcmVsZWFzZV9ib29s
LAotICAgICAgICAgICAgICAgICAgICAgICAgcHJvcCwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxv
Y2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAg
ICAgICAgICAgICAgICAgICAgICAgIHByb3AsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAg
ICAgICBnX2ZyZWUocHJvcCk7CiAgICAgfQogfQpAQCAtMjExNCw3ICsyMDg2LDYgQEAgdm9pZCBv
YmplY3RfY2xhc3NfcHJvcGVydHlfYWRkX2Jvb2woT2JqZWN0Q2xhc3MgKmtsYXNzLCBjb25zdCBj
aGFyICpuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAoKnNl
dCkoT2JqZWN0ICosIGJvb2wsIEVycm9yICoqKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsK
ICAgICBCb29sUHJvcGVydHkgKnByb3AgPSBnX21hbGxvYzAoc2l6ZW9mKCpwcm9wKSk7CiAKICAg
ICBwcm9wLT5nZXQgPSBnZXQ7CkBAIC0yMTI0LDkgKzIwOTUsOCBAQCB2b2lkIG9iamVjdF9jbGFz
c19wcm9wZXJ0eV9hZGRfYm9vbChPYmplY3RDbGFzcyAqa2xhc3MsIGNvbnN0IGNoYXIgKm5hbWUs
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXQgPyBwcm9wZXJ0eV9nZXRfYm9vbCA6
IE5VTEwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXQgPyBwcm9wZXJ0eV9zZXRf
Ym9vbCA6IE5VTEwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eV9yZWxl
YXNlX2Jvb2wsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wLCAmbG9jYWxfZXJy
KTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBs
b2NhbF9lcnIpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcCwgZXJycCk7Cisg
ICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdfZnJlZShwcm9wKTsKICAgICB9CiB9CkBAIC0yMTM2
LDExICsyMTA2LDkgQEAgc3RhdGljIHZvaWQgcHJvcGVydHlfZ2V0X2VudW0oT2JqZWN0ICpvYmos
IFZpc2l0b3IgKnYsIGNvbnN0IGNoYXIgKm5hbWUsCiB7CiAgICAgRW51bVByb3BlcnR5ICpwcm9w
ID0gb3BhcXVlOwogICAgIGludCB2YWx1ZTsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKIAotICAg
IHZhbHVlID0gcHJvcC0+Z2V0KG9iaiwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBl
cnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICB2YWx1ZSA9IHByb3AtPmdldChvYmosIGVy
cnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCkBAIC0yMTUy
LDExICsyMTIwLDkgQEAgc3RhdGljIHZvaWQgcHJvcGVydHlfc2V0X2VudW0oT2JqZWN0ICpvYmos
IFZpc2l0b3IgKnYsIGNvbnN0IGNoYXIgKm5hbWUsCiB7CiAgICAgRW51bVByb3BlcnR5ICpwcm9w
ID0gb3BhcXVlOwogICAgIGludCB2YWx1ZTsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKIAotICAg
IHZpc2l0X3R5cGVfZW51bSh2LCBuYW1lLCAmdmFsdWUsIHByb3AtPmxvb2t1cCwgJmVycik7Ci0g
ICAgaWYgKGVycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICB2
aXNpdF90eXBlX2VudW0odiwgbmFtZSwgJnZhbHVlLCBwcm9wLT5sb29rdXAsIGVycnApOworICAg
IGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogICAgIHByb3AtPnNldChvYmos
IHZhbHVlLCBlcnJwKTsKQEAgLTIxNzYsNyArMjE0Miw2IEBAIHZvaWQgb2JqZWN0X3Byb3BlcnR5
X2FkZF9lbnVtKE9iamVjdCAqb2JqLCBjb25zdCBjaGFyICpuYW1lLAogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgdm9pZCAoKnNldCkoT2JqZWN0ICosIGludCwgRXJyb3IgKiopLAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJwKQogewotICAgIEVycm9yICps
b2NhbF9lcnIgPSBOVUxMOwogICAgIEVudW1Qcm9wZXJ0eSAqcHJvcCA9IGdfbWFsbG9jKHNpemVv
ZigqcHJvcCkpOwogCiAgICAgcHJvcC0+bG9va3VwID0gbG9va3VwOwpAQCAtMjE4Nyw5ICsyMTUy
LDggQEAgdm9pZCBvYmplY3RfcHJvcGVydHlfYWRkX2VudW0oT2JqZWN0ICpvYmosIGNvbnN0IGNo
YXIgKm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICBnZXQgPyBwcm9wZXJ0eV9nZXRfZW51
bSA6IE5VTEwsCiAgICAgICAgICAgICAgICAgICAgICAgICBzZXQgPyBwcm9wZXJ0eV9zZXRfZW51
bSA6IE5VTEwsCiAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eV9yZWxlYXNlX2VudW0s
Ci0gICAgICAgICAgICAgICAgICAgICAgICBwcm9wLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9j
YWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAg
ICAgICAgICAgICAgICAgICAgICAgcHJvcCwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAg
ICAgIGdfZnJlZShwcm9wKTsKICAgICB9CiB9CkBAIC0yMjAxLDcgKzIxNjUsNiBAQCB2b2lkIG9i
amVjdF9jbGFzc19wcm9wZXJ0eV9hZGRfZW51bShPYmplY3RDbGFzcyAqa2xhc3MsIGNvbnN0IGNo
YXIgKm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkICgqc2V0
KShPYmplY3QgKiwgaW50LCBFcnJvciAqKiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAg
ICAgRW51bVByb3BlcnR5ICpwcm9wID0gZ19tYWxsb2Moc2l6ZW9mKCpwcm9wKSk7CiAKICAgICBw
cm9wLT5sb29rdXAgPSBsb29rdXA7CkBAIC0yMjEyLDkgKzIxNzUsOCBAQCB2b2lkIG9iamVjdF9j
bGFzc19wcm9wZXJ0eV9hZGRfZW51bShPYmplY3RDbGFzcyAqa2xhc3MsIGNvbnN0IGNoYXIgKm5h
bWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXQgPyBwcm9wZXJ0eV9nZXRfZW51
bSA6IE5VTEwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXQgPyBwcm9wZXJ0eV9z
ZXRfZW51bSA6IE5VTEwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eV9y
ZWxlYXNlX2VudW0sCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wLCAmbG9jYWxf
ZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJw
LCBsb2NhbF9lcnIpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcCwgZXJycCk7
CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdfZnJlZShwcm9wKTsKICAgICB9CiB9CkBAIC0y
MjI3LDQ3ICsyMTg5LDQ0IEBAIHN0YXRpYyB2b2lkIHByb3BlcnR5X2dldF90bShPYmplY3QgKm9i
aiwgVmlzaXRvciAqdiwgY29uc3QgY2hhciAqbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICB2b2lkICpvcGFxdWUsIEVycm9yICoqZXJycCkKIHsKICAgICBUTVByb3BlcnR5ICpwcm9w
ID0gb3BhcXVlOwotICAgIEVycm9yICplcnIgPSBOVUxMOwogICAgIHN0cnVjdCB0bSB2YWx1ZTsK
IAotICAgIHByb3AtPmdldChvYmosICZ2YWx1ZSwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAg
ICAgICBnb3RvIG91dDsKKyAgICBwcm9wLT5nZXQob2JqLCAmdmFsdWUsIGVycnApOworICAgIGlm
ICgqZXJycCkgeworICAgICAgICByZXR1cm47CiAgICAgfQogCi0gICAgdmlzaXRfc3RhcnRfc3Ry
dWN0KHYsIG5hbWUsIE5VTEwsIDAsICZlcnIpOwotICAgIGlmIChlcnIpIHsKLSAgICAgICAgZ290
byBvdXQ7CisgICAgdmlzaXRfc3RhcnRfc3RydWN0KHYsIG5hbWUsIE5VTEwsIDAsIGVycnApOwor
ICAgIGlmICgqZXJycCkgeworICAgICAgICByZXR1cm47CiAgICAgfQotICAgIHZpc2l0X3R5cGVf
aW50MzIodiwgInRtX3llYXIiLCAmdmFsdWUudG1feWVhciwgJmVycik7Ci0gICAgaWYgKGVycikg
eworICAgIHZpc2l0X3R5cGVfaW50MzIodiwgInRtX3llYXIiLCAmdmFsdWUudG1feWVhciwgZXJy
cCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8gb3V0X2VuZDsKICAgICB9Ci0gICAg
dmlzaXRfdHlwZV9pbnQzMih2LCAidG1fbW9uIiwgJnZhbHVlLnRtX21vbiwgJmVycik7Ci0gICAg
aWYgKGVycikgeworICAgIHZpc2l0X3R5cGVfaW50MzIodiwgInRtX21vbiIsICZ2YWx1ZS50bV9t
b24sIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICBnb3RvIG91dF9lbmQ7CiAgICAg
fQotICAgIHZpc2l0X3R5cGVfaW50MzIodiwgInRtX21kYXkiLCAmdmFsdWUudG1fbWRheSwgJmVy
cik7Ci0gICAgaWYgKGVycikgeworICAgIHZpc2l0X3R5cGVfaW50MzIodiwgInRtX21kYXkiLCAm
dmFsdWUudG1fbWRheSwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8gb3V0
X2VuZDsKICAgICB9Ci0gICAgdmlzaXRfdHlwZV9pbnQzMih2LCAidG1faG91ciIsICZ2YWx1ZS50
bV9ob3VyLCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7CisgICAgdmlzaXRfdHlwZV9pbnQzMih2LCAi
dG1faG91ciIsICZ2YWx1ZS50bV9ob3VyLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAg
ICAgZ290byBvdXRfZW5kOwogICAgIH0KLSAgICB2aXNpdF90eXBlX2ludDMyKHYsICJ0bV9taW4i
LCAmdmFsdWUudG1fbWluLCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7CisgICAgdmlzaXRfdHlwZV9p
bnQzMih2LCAidG1fbWluIiwgJnZhbHVlLnRtX21pbiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7
CiAgICAgICAgIGdvdG8gb3V0X2VuZDsKICAgICB9Ci0gICAgdmlzaXRfdHlwZV9pbnQzMih2LCAi
dG1fc2VjIiwgJnZhbHVlLnRtX3NlYywgJmVycik7Ci0gICAgaWYgKGVycikgeworICAgIHZpc2l0
X3R5cGVfaW50MzIodiwgInRtX3NlYyIsICZ2YWx1ZS50bV9zZWMsIGVycnApOworICAgIGlmICgq
ZXJycCkgewogICAgICAgICBnb3RvIG91dF9lbmQ7CiAgICAgfQotICAgIHZpc2l0X2NoZWNrX3N0
cnVjdCh2LCAmZXJyKTsKKyAgICB2aXNpdF9jaGVja19zdHJ1Y3QodiwgZXJycCk7CiBvdXRfZW5k
OgogICAgIHZpc2l0X2VuZF9zdHJ1Y3QodiwgTlVMTCk7Ci1vdXQ6Ci0gICAgZXJyb3JfcHJvcGFn
YXRlKGVycnAsIGVycik7CiAKIH0KIApAQCAtMjI4Miw3ICsyMjQxLDYgQEAgdm9pZCBvYmplY3Rf
cHJvcGVydHlfYWRkX3RtKE9iamVjdCAqb2JqLCBjb25zdCBjaGFyICpuYW1lLAogICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHZvaWQgKCpnZXQpKE9iamVjdCAqLCBzdHJ1Y3QgdG0gKiwgRXJy
b3IgKiopLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVycm9yICoqZXJycCkKIHsKLSAg
ICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBUTVByb3BlcnR5ICpwcm9wID0gZ19tYWxs
b2MwKHNpemVvZigqcHJvcCkpOwogCiAgICAgcHJvcC0+Z2V0ID0gZ2V0OwpAQCAtMjI5MCw5ICsy
MjQ4LDggQEAgdm9pZCBvYmplY3RfcHJvcGVydHlfYWRkX3RtKE9iamVjdCAqb2JqLCBjb25zdCBj
aGFyICpuYW1lLAogICAgIG9iamVjdF9wcm9wZXJ0eV9hZGQob2JqLCBuYW1lLCAic3RydWN0IHRt
IiwKICAgICAgICAgICAgICAgICAgICAgICAgIGdldCA/IHByb3BlcnR5X2dldF90bSA6IE5VTEws
IE5VTEwsCiAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eV9yZWxlYXNlX3RtLAotICAg
ICAgICAgICAgICAgICAgICAgICAgcHJvcCwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2Vy
cikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAg
ICAgICAgICAgICAgICAgIHByb3AsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICBn
X2ZyZWUocHJvcCk7CiAgICAgfQogfQpAQCAtMjMwMSw3ICsyMjU4LDYgQEAgdm9pZCBvYmplY3Rf
Y2xhc3NfcHJvcGVydHlfYWRkX3RtKE9iamVjdENsYXNzICprbGFzcywgY29uc3QgY2hhciAqbmFt
ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkICgqZ2V0KShPYmplY3Qg
Kiwgc3RydWN0IHRtICosIEVycm9yICoqKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAg
VE1Qcm9wZXJ0eSAqcHJvcCA9IGdfbWFsbG9jMChzaXplb2YoKnByb3ApKTsKIAogICAgIHByb3At
PmdldCA9IGdldDsKQEAgLTIzMDksOSArMjI2NSw4IEBAIHZvaWQgb2JqZWN0X2NsYXNzX3Byb3Bl
cnR5X2FkZF90bShPYmplY3RDbGFzcyAqa2xhc3MsIGNvbnN0IGNoYXIgKm5hbWUsCiAgICAgb2Jq
ZWN0X2NsYXNzX3Byb3BlcnR5X2FkZChrbGFzcywgbmFtZSwgInN0cnVjdCB0bSIsCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBnZXQgPyBwcm9wZXJ0eV9nZXRfdG0gOiBOVUxMLCBOVUxM
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlfcmVsZWFzZV90bSwKLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3AsICZsb2NhbF9lcnIpOwotICAgIGlmIChs
b2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7Cisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wLCBlcnJwKTsKKyAgICBpZiAoKmVycnAp
IHsKICAgICAgICAgZ19mcmVlKHByb3ApOwogICAgIH0KIH0KQEAgLTI0NTAsNyArMjQwNSw2IEBA
IHZvaWQgb2JqZWN0X3Byb3BlcnR5X2FkZF9hbGlhcyhPYmplY3QgKm9iaiwgY29uc3QgY2hhciAq
bmFtZSwKICAgICBPYmplY3RQcm9wZXJ0eSAqb3A7CiAgICAgT2JqZWN0UHJvcGVydHkgKnRhcmdl
dF9wcm9wOwogICAgIGdjaGFyICpwcm9wX3R5cGU7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5V
TEw7CiAKICAgICB0YXJnZXRfcHJvcCA9IG9iamVjdF9wcm9wZXJ0eV9maW5kKHRhcmdldF9vYmos
IHRhcmdldF9uYW1lLCBlcnJwKTsKICAgICBpZiAoIXRhcmdldF9wcm9wKSB7CkBAIC0yNDcyLDkg
KzI0MjYsOCBAQCB2b2lkIG9iamVjdF9wcm9wZXJ0eV9hZGRfYWxpYXMoT2JqZWN0ICpvYmosIGNv
bnN0IGNoYXIgKm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5X2dl
dF9hbGlhcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlfc2V0X2FsaWFz
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eV9yZWxlYXNlX2FsaWFzLAot
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAo
bG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wLCBlcnJwKTsKKyAgICBpZiAoKmVycnAp
IHsKICAgICAgICAgZ19mcmVlKHByb3ApOwogICAgICAgICBnb3RvIG91dDsKICAgICB9CmRpZmYg
LS1naXQgYS9xb20vb2JqZWN0X2ludGVyZmFjZXMuYyBiL3FvbS9vYmplY3RfaW50ZXJmYWNlcy5j
CmluZGV4IGNiNTgwOTkzNGEuLjU4YmI3OGU0ZTkgMTAwNjQ0Ci0tLSBhL3FvbS9vYmplY3RfaW50
ZXJmYWNlcy5jCisrKyBiL3FvbS9vYmplY3RfaW50ZXJmYWNlcy5jCkBAIC0zNiw3ICszNiw2IEBA
IE9iamVjdCAqdXNlcl9jcmVhdGFibGVfYWRkX3R5cGUoY29uc3QgY2hhciAqdHlwZSwgY29uc3Qg
Y2hhciAqaWQsCiAgICAgT2JqZWN0ICpvYmo7CiAgICAgT2JqZWN0Q2xhc3MgKmtsYXNzOwogICAg
IGNvbnN0IFFEaWN0RW50cnkgKmU7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAg
ICBrbGFzcyA9IG9iamVjdF9jbGFzc19ieV9uYW1lKHR5cGUpOwogICAgIGlmICgha2xhc3MpIHsK
QEAgLTU3LDM0ICs1NiwzNCBAQCBPYmplY3QgKnVzZXJfY3JlYXRhYmxlX2FkZF90eXBlKGNvbnN0
IGNoYXIgKnR5cGUsIGNvbnN0IGNoYXIgKmlkLAogCiAgICAgYXNzZXJ0KHFkaWN0KTsKICAgICBv
YmogPSBvYmplY3RfbmV3KHR5cGUpOwotICAgIHZpc2l0X3N0YXJ0X3N0cnVjdCh2LCBOVUxMLCBO
VUxMLCAwLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7CisgICAgdmlzaXRfc3Rh
cnRfc3RydWN0KHYsIE5VTEwsIE5VTEwsIDAsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAg
ICAgICBnb3RvIG91dDsKICAgICB9CiAgICAgZm9yIChlID0gcWRpY3RfZmlyc3QocWRpY3QpOyBl
OyBlID0gcWRpY3RfbmV4dChxZGljdCwgZSkpIHsKLSAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3Nl
dChvYmosIHYsIGUtPmtleSwgJmxvY2FsX2Vycik7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsK
KyAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldChvYmosIHYsIGUtPmtleSwgZXJycCk7CisgICAg
ICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgIH0KICAgICB9Ci0g
ICAgaWYgKCFsb2NhbF9lcnIpIHsKLSAgICAgICAgdmlzaXRfY2hlY2tfc3RydWN0KHYsICZsb2Nh
bF9lcnIpOworICAgIGlmICghKmVycnApIHsKKyAgICAgICAgdmlzaXRfY2hlY2tfc3RydWN0KHYs
IGVycnApOwogICAgIH0KICAgICB2aXNpdF9lbmRfc3RydWN0KHYsIE5VTEwpOwotICAgIGlmIChs
b2NhbF9lcnIpIHsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ290byBvdXQ7CiAgICAgfQog
CiAgICAgaWYgKGlkICE9IE5VTEwpIHsKICAgICAgICAgb2JqZWN0X3Byb3BlcnR5X2FkZF9jaGls
ZChvYmplY3RfZ2V0X29iamVjdHNfcm9vdCgpLAotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGlkLCBvYmosICZsb2NhbF9lcnIpOwotICAgICAgICBpZiAobG9jYWxfZXJyKSB7Cisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQsIG9iaiwgZXJycCk7CisgICAgICAg
IGlmICgqZXJycCkgewogICAgICAgICAgICAgZ290byBvdXQ7CiAgICAgICAgIH0KICAgICB9CiAK
LSAgICB1c2VyX2NyZWF0YWJsZV9jb21wbGV0ZShVU0VSX0NSRUFUQUJMRShvYmopLCAmbG9jYWxf
ZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7CisgICAgdXNlcl9jcmVhdGFibGVfY29tcGxldGUo
VVNFUl9DUkVBVEFCTEUob2JqKSwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGlm
IChpZCAhPSBOVUxMKSB7CiAgICAgICAgICAgICBvYmplY3RfcHJvcGVydHlfZGVsKG9iamVjdF9n
ZXRfb2JqZWN0c19yb290KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkLCAm
ZXJyb3JfYWJvcnQpOwpAQCAtOTIsOCArOTEsNyBAQCBPYmplY3QgKnVzZXJfY3JlYXRhYmxlX2Fk
ZF90eXBlKGNvbnN0IGNoYXIgKnR5cGUsIGNvbnN0IGNoYXIgKmlkLAogICAgICAgICBnb3RvIG91
dDsKICAgICB9CiBvdXQ6Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9w
YWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgb2JqZWN0
X3VucmVmKG9iaik7CiAgICAgICAgIHJldHVybiBOVUxMOwogICAgIH0KZGlmZiAtLWdpdCBhL3Fv
bS9xb20tcW9iamVjdC5jIGIvcW9tL3FvbS1xb2JqZWN0LmMKaW5kZXggYzNiOTVhYTM1NC4uNmE3
NmEzZmM1YSAxMDA2NDQKLS0tIGEvcW9tL3FvbS1xb2JqZWN0LmMKKysrIGIvcW9tL3FvbS1xb2Jq
ZWN0LmMKQEAgLTMxLDE1ICszMSwxMyBAQCBRT2JqZWN0ICpvYmplY3RfcHJvcGVydHlfZ2V0X3Fv
YmplY3QoT2JqZWN0ICpvYmosIGNvbnN0IGNoYXIgKm5hbWUsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJwKQogewogICAgIFFPYmplY3QgKnJldCA9IE5V
TEw7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgVmlzaXRvciAqdjsKIAogICAg
IHYgPSBxb2JqZWN0X291dHB1dF92aXNpdG9yX25ldygmcmV0KTsKLSAgICBvYmplY3RfcHJvcGVy
dHlfZ2V0KG9iaiwgdiwgbmFtZSwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKCFsb2NhbF9lcnIpIHsK
KyAgICBvYmplY3RfcHJvcGVydHlfZ2V0KG9iaiwgdiwgbmFtZSwgZXJycCk7CisgICAgaWYgKCEq
ZXJycCkgewogICAgICAgICB2aXNpdF9jb21wbGV0ZSh2LCAmcmV0KTsKICAgICB9Ci0gICAgZXJy
b3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CiAgICAgdmlzaXRfZnJlZSh2KTsKICAgICBy
ZXR1cm4gcmV0OwogfQpkaWZmIC0tZ2l0IGEvcmVwbGljYXRpb24uYyBiL3JlcGxpY2F0aW9uLmMK
aW5kZXggYmUzYTQyZjljOS4uZDk4OTY2OTM0ZSAxMDA2NDQKLS0tIGEvcmVwbGljYXRpb24uYwor
KysgYi9yZXBsaWNhdGlvbi5jCkBAIC00NSwxNCArNDUsMTIgQEAgdm9pZCByZXBsaWNhdGlvbl9y
ZW1vdmUoUmVwbGljYXRpb25TdGF0ZSAqcnMpCiB2b2lkIHJlcGxpY2F0aW9uX3N0YXJ0X2FsbChS
ZXBsaWNhdGlvbk1vZGUgbW9kZSwgRXJyb3IgKiplcnJwKQogewogICAgIFJlcGxpY2F0aW9uU3Rh
dGUgKnJzLCAqbmV4dDsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAogICAgIFFMSVNU
X0ZPUkVBQ0hfU0FGRShycywgJnJlcGxpY2F0aW9uX3N0YXRlcywgbm9kZSwgbmV4dCkgewogICAg
ICAgICBpZiAocnMtPm9wcyAmJiBycy0+b3BzLT5zdGFydCkgewotICAgICAgICAgICAgcnMtPm9w
cy0+c3RhcnQocnMsIG1vZGUsICZsb2NhbF9lcnIpOworICAgICAgICAgICAgcnMtPm9wcy0+c3Rh
cnQocnMsIG1vZGUsIGVycnApOwogICAgICAgICB9Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsK
LSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICBp
ZiAoKmVycnApIHsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQogICAgIH0KQEAgLTYx
LDE0ICs1OSwxMiBAQCB2b2lkIHJlcGxpY2F0aW9uX3N0YXJ0X2FsbChSZXBsaWNhdGlvbk1vZGUg
bW9kZSwgRXJyb3IgKiplcnJwKQogdm9pZCByZXBsaWNhdGlvbl9kb19jaGVja3BvaW50X2FsbChF
cnJvciAqKmVycnApCiB7CiAgICAgUmVwbGljYXRpb25TdGF0ZSAqcnMsICpuZXh0OwotICAgIEVy
cm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgUUxJU1RfRk9SRUFDSF9TQUZFKHJzLCAmcmVw
bGljYXRpb25fc3RhdGVzLCBub2RlLCBuZXh0KSB7CiAgICAgICAgIGlmIChycy0+b3BzICYmIHJz
LT5vcHMtPmNoZWNrcG9pbnQpIHsKLSAgICAgICAgICAgIHJzLT5vcHMtPmNoZWNrcG9pbnQocnMs
ICZsb2NhbF9lcnIpOworICAgICAgICAgICAgcnMtPm9wcy0+Y2hlY2twb2ludChycywgZXJycCk7
CiAgICAgICAgIH0KLSAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICAgICAgZXJyb3Jf
cHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAg
ICAgICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgfQpAQCAtNzcsMTQgKzczLDEyIEBAIHZvaWQg
cmVwbGljYXRpb25fZG9fY2hlY2twb2ludF9hbGwoRXJyb3IgKiplcnJwKQogdm9pZCByZXBsaWNh
dGlvbl9nZXRfZXJyb3JfYWxsKEVycm9yICoqZXJycCkKIHsKICAgICBSZXBsaWNhdGlvblN0YXRl
ICpycywgKm5leHQ7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICBRTElTVF9G
T1JFQUNIX1NBRkUocnMsICZyZXBsaWNhdGlvbl9zdGF0ZXMsIG5vZGUsIG5leHQpIHsKICAgICAg
ICAgaWYgKHJzLT5vcHMgJiYgcnMtPm9wcy0+Z2V0X2Vycm9yKSB7Ci0gICAgICAgICAgICBycy0+
b3BzLT5nZXRfZXJyb3IocnMsICZsb2NhbF9lcnIpOworICAgICAgICAgICAgcnMtPm9wcy0+Z2V0
X2Vycm9yKHJzLCBlcnJwKTsKICAgICAgICAgfQotICAgICAgICBpZiAobG9jYWxfZXJyKSB7Ci0g
ICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgaWYg
KCplcnJwKSB7CiAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgIH0KICAgICB9CkBAIC05Mywx
NCArODcsMTIgQEAgdm9pZCByZXBsaWNhdGlvbl9nZXRfZXJyb3JfYWxsKEVycm9yICoqZXJycCkK
IHZvaWQgcmVwbGljYXRpb25fc3RvcF9hbGwoYm9vbCBmYWlsb3ZlciwgRXJyb3IgKiplcnJwKQog
ewogICAgIFJlcGxpY2F0aW9uU3RhdGUgKnJzLCAqbmV4dDsKLSAgICBFcnJvciAqbG9jYWxfZXJy
ID0gTlVMTDsKIAogICAgIFFMSVNUX0ZPUkVBQ0hfU0FGRShycywgJnJlcGxpY2F0aW9uX3N0YXRl
cywgbm9kZSwgbmV4dCkgewogICAgICAgICBpZiAocnMtPm9wcyAmJiBycy0+b3BzLT5zdG9wKSB7
Ci0gICAgICAgICAgICBycy0+b3BzLT5zdG9wKHJzLCBmYWlsb3ZlciwgJmxvY2FsX2Vycik7Cisg
ICAgICAgICAgICBycy0+b3BzLT5zdG9wKHJzLCBmYWlsb3ZlciwgZXJycCk7CiAgICAgICAgIH0K
LSAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVy
cnAsIGxvY2FsX2Vycik7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgcmV0dXJu
OwogICAgICAgICB9CiAgICAgfQpkaWZmIC0tZ2l0IGEvc2NzaS9wci1tYW5hZ2VyLWhlbHBlci5j
IGIvc2NzaS9wci1tYW5hZ2VyLWhlbHBlci5jCmluZGV4IGNhMjdjOTMyODMuLmMzOWZjNDI5Zjcg
MTAwNjQ0Ci0tLSBhL3Njc2kvcHItbWFuYWdlci1oZWxwZXIuYworKysgYi9zY3NpL3ByLW1hbmFn
ZXItaGVscGVyLmMKQEAgLTEwNyw3ICsxMDcsNiBAQCBzdGF0aWMgaW50IHByX21hbmFnZXJfaGVs
cGVyX2luaXRpYWxpemUoUFJNYW5hZ2VySGVscGVyICpwcl9tZ3IsCiAgICAgICAgIC51LnFfdW5p
eC5wYXRoID0gcGF0aAogICAgIH07CiAgICAgUUlPQ2hhbm5lbFNvY2tldCAqc2lvYyA9IHFpb19j
aGFubmVsX3NvY2tldF9uZXcoKTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAogICAg
IHVpbnQzMl90IGZsYWdzOwogICAgIGludCByOwpAQCAtMTE2LDExICsxMTUsMTAgQEAgc3RhdGlj
IGludCBwcl9tYW5hZ2VyX2hlbHBlcl9pbml0aWFsaXplKFBSTWFuYWdlckhlbHBlciAqcHJfbWdy
LAogICAgIHFpb19jaGFubmVsX3NldF9uYW1lKFFJT19DSEFOTkVMKHNpb2MpLCAicHItbWFuYWdl
ci1oZWxwZXIiKTsKICAgICBxaW9fY2hhbm5lbF9zb2NrZXRfY29ubmVjdF9zeW5jKHNpb2MsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmc2FkZHIsCi0gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAmbG9jYWxfZXJyKTsKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGVycnApOwogICAgIGdfZnJlZShwYXRoKTsKLSAgICBpZiAobG9jYWxf
ZXJyKSB7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIG9iamVjdF91bnJlZihPQkpFQ1Qoc2lv
YykpOwotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKICAgICAgICAg
cmV0dXJuIC1FTk9UQ09OTjsKICAgICB9CiAKZGlmZiAtLWdpdCBhL3N0dWJzL3hlbi1odm0uYyBi
L3N0dWJzL3hlbi1odm0uYwppbmRleCBiN2Q1M2I1ZTJmLi44NDBhMmEwZDA5IDEwMDY0NAotLS0g
YS9zdHVicy94ZW4taHZtLmMKKysrIGIvc3R1YnMveGVuLWh2bS5jCkBAIC0zOCw2ICszOCw3IEBA
IGludCB4ZW5faXNfcGlycV9tc2kodWludDMyX3QgbXNpX2RhdGEpCiB2b2lkIHhlbl9yYW1fYWxs
b2MocmFtX2FkZHJfdCByYW1fYWRkciwgcmFtX2FkZHJfdCBzaXplLCBNZW1vcnlSZWdpb24gKm1y
LAogICAgICAgICAgICAgICAgICAgIEVycm9yICoqZXJycCkKIHsKKwlFUlJQX0ZVTkNUSU9OX0JF
R0lOKCk7CiB9CiAKIHFlbXVfaXJxICp4ZW5faW50ZXJydXB0X2NvbnRyb2xsZXJfaW5pdCh2b2lk
KQpAQCAtNTksNCArNjAsNSBAQCB2b2lkIHhlbl9odm1faW5pdChQQ01hY2hpbmVTdGF0ZSAqcGNt
cywgTWVtb3J5UmVnaW9uICoqcmFtX21lbW9yeSkKIAogdm9pZCBxbXBfeGVuX3NldF9nbG9iYWxf
ZGlydHlfbG9nKGJvb2wgZW5hYmxlLCBFcnJvciAqKmVycnApCiB7CisJRVJSUF9GVU5DVElPTl9C
RUdJTigpOwogfQpkaWZmIC0tZ2l0IGEvdGFyZ2V0L2FscGhhL2NwdS5jIGIvdGFyZ2V0L2FscGhh
L2NwdS5jCmluZGV4IGIzZmQ2NjQzZTguLjBlMzA1Y2IxZjYgMTAwNjQ0Ci0tLSBhL3RhcmdldC9h
bHBoYS9jcHUuYworKysgYi90YXJnZXQvYWxwaGEvY3B1LmMKQEAgLTU4LDExICs1OCw5IEBAIHN0
YXRpYyB2b2lkIGFscGhhX2NwdV9yZWFsaXplZm4oRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKipl
cnJwKQogewogICAgIENQVVN0YXRlICpjcyA9IENQVShkZXYpOwogICAgIEFscGhhQ1BVQ2xhc3Mg
KmFjYyA9IEFMUEhBX0NQVV9HRVRfQ0xBU1MoZGV2KTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0g
TlVMTDsKIAotICAgIGNwdV9leGVjX3JlYWxpemVmbihjcywgJmxvY2FsX2Vycik7Ci0gICAgaWYg
KGxvY2FsX2VyciAhPSBOVUxMKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2Nh
bF9lcnIpOworICAgIGNwdV9leGVjX3JlYWxpemVmbihjcywgZXJycCk7CisgICAgaWYgKCplcnJw
ICE9IE5VTEwpIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApkaWZmIC0tZ2l0IGEvdGFyZ2V0
L2FybS9jcHUuYyBiL3RhcmdldC9hcm0vY3B1LmMKaW5kZXggMjM5OWMxNDQ3MS4uMTEwYzI4YmRi
ZSAxMDA2NDQKLS0tIGEvdGFyZ2V0L2FybS9jcHUuYworKysgYi90YXJnZXQvYXJtL2NwdS5jCkBA
IC0xMjA1LDcgKzEyMDUsNiBAQCBzdGF0aWMgdm9pZCBhcm1fY3B1X3JlYWxpemVmbihEZXZpY2VT
dGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgQVJNQ1BVQ2xhc3MgKmFjYyA9IEFSTV9DUFVf
R0VUX0NMQVNTKGRldik7CiAgICAgQ1BVQVJNU3RhdGUgKmVudiA9ICZjcHUtPmVudjsKICAgICBp
bnQgcGFnZWJpdHM7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgYm9vbCBub19h
YTMyID0gZmFsc2U7CiAKICAgICAvKiBJZiB3ZSBuZWVkZWQgdG8gcXVlcnkgdGhlIGhvc3Qga2Vy
bmVsIGZvciB0aGUgQ1BVIGZlYXR1cmVzCkBAIC0xMjQ4LDkgKzEyNDcsOCBAQCBzdGF0aWMgdm9p
ZCBhcm1fY3B1X3JlYWxpemVmbihEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcm1fZ3Rfc3RpbWVyX2NiLCBj
cHUpOwogI2VuZGlmCiAKLSAgICBjcHVfZXhlY19yZWFsaXplZm4oY3MsICZsb2NhbF9lcnIpOwot
ICAgIGlmIChsb2NhbF9lcnIgIT0gTlVMTCkgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJy
cCwgbG9jYWxfZXJyKTsKKyAgICBjcHVfZXhlY19yZWFsaXplZm4oY3MsIGVycnApOworICAgIGlm
ICgqZXJycCAhPSBOVUxMKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKZGlmZiAtLWdpdCBh
L3RhcmdldC9hcm0vY3B1NjQuYyBiL3RhcmdldC9hcm0vY3B1NjQuYwppbmRleCBkN2Y1YmY2MTBh
Li41NTIwYzcxODYzIDEwMDY0NAotLS0gYS90YXJnZXQvYXJtL2NwdTY0LmMKKysrIGIvdGFyZ2V0
L2FybS9jcHU2NC5jCkBAIC0yNjcsMTYgKzI2NywxNCBAQCBzdGF0aWMgdm9pZCBjcHVfbWF4X3Nl
dF9zdmVfdnEoT2JqZWN0ICpvYmosIFZpc2l0b3IgKnYsIGNvbnN0IGNoYXIgKm5hbWUsCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqb3BhcXVlLCBFcnJvciAqKmVycnApCiB7
CiAgICAgQVJNQ1BVICpjcHUgPSBBUk1fQ1BVKG9iaik7Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7
CiAKLSAgICB2aXNpdF90eXBlX3VpbnQzMih2LCBuYW1lLCAmY3B1LT5zdmVfbWF4X3ZxLCAmZXJy
KTsKKyAgICB2aXNpdF90eXBlX3VpbnQzMih2LCBuYW1lLCAmY3B1LT5zdmVfbWF4X3ZxLCBlcnJw
KTsKIAotICAgIGlmICghZXJyICYmIChjcHUtPnN2ZV9tYXhfdnEgPT0gMCB8fCBjcHUtPnN2ZV9t
YXhfdnEgPiBBUk1fTUFYX1ZRKSkgewotICAgICAgICBlcnJvcl9zZXRnKCZlcnIsICJ1bnN1cHBv
cnRlZCBTVkUgdmVjdG9yIGxlbmd0aCIpOwotICAgICAgICBlcnJvcl9hcHBlbmRfaGludCgmZXJy
LCAiVmFsaWQgc3ZlLW1heC12cSBpbiByYW5nZSBbMS0lZF1cbiIsCisgICAgaWYgKCEqZXJycCAm
JiAoY3B1LT5zdmVfbWF4X3ZxID09IDAgfHwgY3B1LT5zdmVfbWF4X3ZxID4gQVJNX01BWF9WUSkp
IHsKKyAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAidW5zdXBwb3J0ZWQgU1ZFIHZlY3RvciBsZW5n
dGgiKTsKKyAgICAgICAgZXJyb3JfYXBwZW5kX2hpbnQoZXJycCwgIlZhbGlkIHN2ZS1tYXgtdnEg
aW4gcmFuZ2UgWzEtJWRdXG4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICBBUk1fTUFYX1ZR
KTsKICAgICB9Ci0gICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CiB9CiAKIC8qIC1jcHUg
bWF4OiBpZiBLVk0gaXMgZW5hYmxlZCwgbGlrZSAtY3B1IGhvc3QgKGJlc3QgcG9zc2libGUgd2l0
aCB0aGlzIGhvc3QpOwpkaWZmIC0tZ2l0IGEvdGFyZ2V0L2NyaXMvY3B1LmMgYi90YXJnZXQvY3Jp
cy9jcHUuYwppbmRleCA3YWRmZDZjYWY0Li42ZjU0MzQxMDkzIDEwMDY0NAotLS0gYS90YXJnZXQv
Y3Jpcy9jcHUuYworKysgYi90YXJnZXQvY3Jpcy9jcHUuYwpAQCAtMTI2LDExICsxMjYsOSBAQCBz
dGF0aWMgdm9pZCBjcmlzX2NwdV9yZWFsaXplZm4oRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKipl
cnJwKQogewogICAgIENQVVN0YXRlICpjcyA9IENQVShkZXYpOwogICAgIENSSVNDUFVDbGFzcyAq
Y2NjID0gQ1JJU19DUFVfR0VUX0NMQVNTKGRldik7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5V
TEw7CiAKLSAgICBjcHVfZXhlY19yZWFsaXplZm4oY3MsICZsb2NhbF9lcnIpOwotICAgIGlmIChs
b2NhbF9lcnIgIT0gTlVMTCkgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxf
ZXJyKTsKKyAgICBjcHVfZXhlY19yZWFsaXplZm4oY3MsIGVycnApOworICAgIGlmICgqZXJycCAh
PSBOVUxMKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKZGlmZiAtLWdpdCBhL3RhcmdldC9o
cHBhL2NwdS5jIGIvdGFyZ2V0L2hwcGEvY3B1LmMKaW5kZXggNzFiNmFjYTQ1ZC4uYjk4YjI2YjUy
MSAxMDA2NDQKLS0tIGEvdGFyZ2V0L2hwcGEvY3B1LmMKKysrIGIvdGFyZ2V0L2hwcGEvY3B1LmMK
QEAgLTkxLDExICs5MSw5IEBAIHN0YXRpYyB2b2lkIGhwcGFfY3B1X3JlYWxpemVmbihEZXZpY2VT
dGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiB7CiAgICAgQ1BVU3RhdGUgKmNzID0gQ1BVKGRldik7
CiAgICAgSFBQQUNQVUNsYXNzICphY2MgPSBIUFBBX0NQVV9HRVRfQ0xBU1MoZGV2KTsKLSAgICBF
cnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAotICAgIGNwdV9leGVjX3JlYWxpemVmbihjcywgJmxv
Y2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VyciAhPSBOVUxMKSB7Ci0gICAgICAgIGVycm9yX3By
b3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIGNwdV9leGVjX3JlYWxpemVmbihjcywgZXJy
cCk7CisgICAgaWYgKCplcnJwICE9IE5VTEwpIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApk
aWZmIC0tZ2l0IGEvdGFyZ2V0L2kzODYvY3B1LmMgYi90YXJnZXQvaTM4Ni9jcHUuYwppbmRleCA5
ZTBiYWMzMWU4Li5hYzQ5Y2ZmZDU0IDEwMDY0NAotLS0gYS90YXJnZXQvaTM4Ni9jcHUuYworKysg
Yi90YXJnZXQvaTM4Ni9jcHUuYwpAQCAtMzEzOCwxMiArMzEzOCwxMCBAQCBzdGF0aWMgdm9pZCB4
ODZfY3B1aWRfdmVyc2lvbl9zZXRfZmFtaWx5KE9iamVjdCAqb2JqLCBWaXNpdG9yICp2LAogICAg
IENQVVg4NlN0YXRlICplbnYgPSAmY3B1LT5lbnY7CiAgICAgY29uc3QgaW50NjRfdCBtaW4gPSAw
OwogICAgIGNvbnN0IGludDY0X3QgbWF4ID0gMHhmZiArIDB4ZjsKLSAgICBFcnJvciAqbG9jYWxf
ZXJyID0gTlVMTDsKICAgICBpbnQ2NF90IHZhbHVlOwogCi0gICAgdmlzaXRfdHlwZV9pbnQodiwg
bmFtZSwgJnZhbHVlLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAg
IGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHZpc2l0X3R5cGVfaW50KHYs
IG5hbWUsICZ2YWx1ZSwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybjsK
ICAgICB9CiAgICAgaWYgKHZhbHVlIDwgbWluIHx8IHZhbHVlID4gbWF4KSB7CkBAIC0zMTgxLDEy
ICszMTc5LDEwIEBAIHN0YXRpYyB2b2lkIHg4Nl9jcHVpZF92ZXJzaW9uX3NldF9tb2RlbChPYmpl
Y3QgKm9iaiwgVmlzaXRvciAqdiwKICAgICBDUFVYODZTdGF0ZSAqZW52ID0gJmNwdS0+ZW52Owog
ICAgIGNvbnN0IGludDY0X3QgbWluID0gMDsKICAgICBjb25zdCBpbnQ2NF90IG1heCA9IDB4ZmY7
Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgaW50NjRfdCB2YWx1ZTsKIAotICAg
IHZpc2l0X3R5cGVfaW50KHYsIG5hbWUsICZ2YWx1ZSwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxv
Y2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAg
ICB2aXNpdF90eXBlX2ludCh2LCBuYW1lLCAmdmFsdWUsIGVycnApOworICAgIGlmICgqZXJycCkg
ewogICAgICAgICByZXR1cm47CiAgICAgfQogICAgIGlmICh2YWx1ZSA8IG1pbiB8fCB2YWx1ZSA+
IG1heCkgewpAQCAtMzIxOSwxMiArMzIxNSwxMCBAQCBzdGF0aWMgdm9pZCB4ODZfY3B1aWRfdmVy
c2lvbl9zZXRfc3RlcHBpbmcoT2JqZWN0ICpvYmosIFZpc2l0b3IgKnYsCiAgICAgQ1BVWDg2U3Rh
dGUgKmVudiA9ICZjcHUtPmVudjsKICAgICBjb25zdCBpbnQ2NF90IG1pbiA9IDA7CiAgICAgY29u
c3QgaW50NjRfdCBtYXggPSAweGY7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAg
aW50NjRfdCB2YWx1ZTsKIAotICAgIHZpc2l0X3R5cGVfaW50KHYsIG5hbWUsICZ2YWx1ZSwgJmxv
Y2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUo
ZXJycCwgbG9jYWxfZXJyKTsKKyAgICB2aXNpdF90eXBlX2ludCh2LCBuYW1lLCAmdmFsdWUsIGVy
cnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogICAgIGlmICh2
YWx1ZSA8IG1pbiB8fCB2YWx1ZSA+IG1heCkgewpAQCAtMzMyNCwxMiArMzMxOCwxMCBAQCBzdGF0
aWMgdm9pZCB4ODZfY3B1aWRfc2V0X3RzY19mcmVxKE9iamVjdCAqb2JqLCBWaXNpdG9yICp2LCBj
b25zdCBjaGFyICpuYW1lLAogICAgIFg4NkNQVSAqY3B1ID0gWDg2X0NQVShvYmopOwogICAgIGNv
bnN0IGludDY0X3QgbWluID0gMDsKICAgICBjb25zdCBpbnQ2NF90IG1heCA9IElOVDY0X01BWDsK
LSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBpbnQ2NF90IHZhbHVlOwogCi0gICAg
dmlzaXRfdHlwZV9pbnQodiwgbmFtZSwgJnZhbHVlLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9j
YWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAg
IHZpc2l0X3R5cGVfaW50KHYsIG5hbWUsICZ2YWx1ZSwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7
CiAgICAgICAgIHJldHVybjsKICAgICB9CiAgICAgaWYgKHZhbHVlIDwgbWluIHx8IHZhbHVlID4g
bWF4KSB7CkBAIC0zOTk3LDE3ICszOTg5LDE0IEBAIHN0YXRpYyB2b2lkIHg4Nl9jcHVfdG9fZGlj
dF9mdWxsKFg4NkNQVSAqY3B1LCBRRGljdCAqcHJvcHMpCiBzdGF0aWMgdm9pZCBvYmplY3RfYXBw
bHlfcHJvcHMoT2JqZWN0ICpvYmosIFFEaWN0ICpwcm9wcywgRXJyb3IgKiplcnJwKQogewogICAg
IGNvbnN0IFFEaWN0RW50cnkgKnByb3A7Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7CiAKICAgICBm
b3IgKHByb3AgPSBxZGljdF9maXJzdChwcm9wcyk7IHByb3A7IHByb3AgPSBxZGljdF9uZXh0KHBy
b3BzLCBwcm9wKSkgewogICAgICAgICBvYmplY3RfcHJvcGVydHlfc2V0X3FvYmplY3Qob2JqLCBx
ZGljdF9lbnRyeV92YWx1ZShwcm9wKSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgcWRpY3RfZW50cnlfa2V5KHByb3ApLCAmZXJyKTsKLSAgICAgICAgaWYgKGVycikg
eworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxZGljdF9lbnRyeV9r
ZXkocHJvcCksIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIGJyZWFr
OwogICAgICAgICB9CiAgICAgfQotCi0gICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CiB9
CiAKIC8qIENyZWF0ZSBYODZDUFUgb2JqZWN0IGFjY29yZGluZyB0byBtb2RlbCtwcm9wcyBzcGVj
aWZpY2F0aW9uICovCkBAIC00MDE1LDMwICs0MDA0LDI4IEBAIHN0YXRpYyBYODZDUFUgKng4Nl9j
cHVfZnJvbV9tb2RlbChjb25zdCBjaGFyICptb2RlbCwgUURpY3QgKnByb3BzLCBFcnJvciAqKmVy
cnApCiB7CiAgICAgWDg2Q1BVICp4YyA9IE5VTEw7CiAgICAgWDg2Q1BVQ2xhc3MgKnhjYzsKLSAg
ICBFcnJvciAqZXJyID0gTlVMTDsKIAogICAgIHhjYyA9IFg4Nl9DUFVfQ0xBU1MoY3B1X2NsYXNz
X2J5X25hbWUoVFlQRV9YODZfQ1BVLCBtb2RlbCkpOwogICAgIGlmICh4Y2MgPT0gTlVMTCkgewot
ICAgICAgICBlcnJvcl9zZXRnKCZlcnIsICJDUFUgbW9kZWwgJyVzJyBub3QgZm91bmQiLCBtb2Rl
bCk7CisgICAgICAgIGVycm9yX3NldGcoZXJycCwgIkNQVSBtb2RlbCAnJXMnIG5vdCBmb3VuZCIs
IG1vZGVsKTsKICAgICAgICAgZ290byBvdXQ7CiAgICAgfQogCiAgICAgeGMgPSBYODZfQ1BVKG9i
amVjdF9uZXcob2JqZWN0X2NsYXNzX2dldF9uYW1lKE9CSkVDVF9DTEFTUyh4Y2MpKSkpOwogICAg
IGlmIChwcm9wcykgewotICAgICAgICBvYmplY3RfYXBwbHlfcHJvcHMoT0JKRUNUKHhjKSwgcHJv
cHMsICZlcnIpOwotICAgICAgICBpZiAoZXJyKSB7CisgICAgICAgIG9iamVjdF9hcHBseV9wcm9w
cyhPQkpFQ1QoeGMpLCBwcm9wcywgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAg
ICAgICAgZ290byBvdXQ7CiAgICAgICAgIH0KICAgICB9CiAKLSAgICB4ODZfY3B1X2V4cGFuZF9m
ZWF0dXJlcyh4YywgJmVycik7Ci0gICAgaWYgKGVycikgeworICAgIHg4Nl9jcHVfZXhwYW5kX2Zl
YXR1cmVzKHhjLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ290byBvdXQ7CiAg
ICAgfQogCiBvdXQ6Ci0gICAgaWYgKGVycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJy
cCwgZXJyKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgb2JqZWN0X3VucmVmKE9CSkVDVCh4
YykpOwogICAgICAgICB4YyA9IE5VTEw7CiAgICAgfQpAQCAtNDA1MSw3ICs0MDM4LDYgQEAgcW1w
X3F1ZXJ5X2NwdV9tb2RlbF9leHBhbnNpb24oQ3B1TW9kZWxFeHBhbnNpb25UeXBlIHR5cGUsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcnJv
ciAqKmVycnApCiB7CiAgICAgWDg2Q1BVICp4YyA9IE5VTEw7Ci0gICAgRXJyb3IgKmVyciA9IE5V
TEw7CiAgICAgQ3B1TW9kZWxFeHBhbnNpb25JbmZvICpyZXQgPSBnX25ldzAoQ3B1TW9kZWxFeHBh
bnNpb25JbmZvLCAxKTsKICAgICBRRGljdCAqcHJvcHMgPSBOVUxMOwogICAgIGNvbnN0IGNoYXIg
KmJhc2VfbmFtZTsKQEAgLTQwNTksOCArNDA0NSw4IEBAIHFtcF9xdWVyeV9jcHVfbW9kZWxfZXhw
YW5zaW9uKENwdU1vZGVsRXhwYW5zaW9uVHlwZSB0eXBlLAogICAgIHhjID0geDg2X2NwdV9mcm9t
X21vZGVsKG1vZGVsLT5uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsLT5o
YXNfcHJvcHMgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxb2JqZWN0X3RvKFFE
aWN0LCBtb2RlbC0+cHJvcHMpIDoKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTlVM
TCwgJmVycik7Ci0gICAgaWYgKGVycikgeworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBOVUxMLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ290byBvdXQ7CiAgICAg
fQogCkBAIC00MDg0LDcgKzQwNzAsNyBAQCBxbXBfcXVlcnlfY3B1X21vZGVsX2V4cGFuc2lvbihD
cHVNb2RlbEV4cGFuc2lvblR5cGUgdHlwZSwKICAgICAgICAgeDg2X2NwdV90b19kaWN0X2Z1bGwo
eGMsIHByb3BzKTsKICAgICBicmVhazsKICAgICBkZWZhdWx0OgotICAgICAgICBlcnJvcl9zZXRn
KCZlcnIsICJVbnN1cHBvcnRlZCBleHBhbnNpb24gdHlwZSIpOworICAgICAgICBlcnJvcl9zZXRn
KGVycnAsICJVbnN1cHBvcnRlZCBleHBhbnNpb24gdHlwZSIpOwogICAgICAgICBnb3RvIG91dDsK
ICAgICB9CiAKQEAgLTQwOTQsOCArNDA4MCw3IEBAIHFtcF9xdWVyeV9jcHVfbW9kZWxfZXhwYW5z
aW9uKENwdU1vZGVsRXhwYW5zaW9uVHlwZSB0eXBlLAogCiBvdXQ6CiAgICAgb2JqZWN0X3VucmVm
KE9CSkVDVCh4YykpOwotICAgIGlmIChlcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVy
cnAsIGVycik7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHFhcGlfZnJlZV9DcHVNb2RlbEV4
cGFuc2lvbkluZm8ocmV0KTsKICAgICAgICAgcmV0ID0gTlVMTDsKICAgICB9CkBAIC00OTE0LDYg
KzQ4OTksNyBAQCBzdGF0aWMgdm9pZCB4ODZfY3B1X21hY2hpbmVfZG9uZShOb3RpZmllciAqbiwg
dm9pZCAqdW51c2VkKQogI2Vsc2UKIHN0YXRpYyB2b2lkIHg4Nl9jcHVfYXBpY19yZWFsaXplKFg4
NkNQVSAqY3B1LCBFcnJvciAqKmVycnApCiB7CisJRVJSUF9GVU5DVElPTl9CRUdJTigpOwogfQog
I2VuZGlmCiAKQEAgLTUwNDksNyArNTAzNSw2IEBAIHN0YXRpYyB2b2lkIHg4Nl9jcHVfZXhwYW5k
X2ZlYXR1cmVzKFg4NkNQVSAqY3B1LCBFcnJvciAqKmVycnApCiAgICAgQ1BVWDg2U3RhdGUgKmVu
diA9ICZjcHUtPmVudjsKICAgICBGZWF0dXJlV29yZCB3OwogICAgIEdMaXN0ICpsOwotICAgIEVy
cm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgLypUT0RPOiBOb3cgY3B1LT5tYXhfZmVhdHVy
ZXMgZG9lc24ndCBvdmVyd3JpdGUgZmVhdHVyZXMKICAgICAgKiBzZXQgdXNpbmcgUU9NIHByb3Bl
cnRpZXMsIGFuZCB3ZSBjYW4gY29udmVydApAQCAtNTA3MCwxNiArNTA1NSwxNiBAQCBzdGF0aWMg
dm9pZCB4ODZfY3B1X2V4cGFuZF9mZWF0dXJlcyhYODZDUFUgKmNwdSwgRXJyb3IgKiplcnJwKQog
CiAgICAgZm9yIChsID0gcGx1c19mZWF0dXJlczsgbDsgbCA9IGwtPm5leHQpIHsKICAgICAgICAg
Y29uc3QgY2hhciAqcHJvcCA9IGwtPmRhdGE7Ci0gICAgICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRf
Ym9vbChPQkpFQ1QoY3B1KSwgdHJ1ZSwgcHJvcCwgJmxvY2FsX2Vycik7Ci0gICAgICAgIGlmIChs
b2NhbF9lcnIpIHsKKyAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVChjcHUp
LCB0cnVlLCBwcm9wLCBlcnJwKTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICBn
b3RvIG91dDsKICAgICAgICAgfQogICAgIH0KIAogICAgIGZvciAobCA9IG1pbnVzX2ZlYXR1cmVz
OyBsOyBsID0gbC0+bmV4dCkgewogICAgICAgICBjb25zdCBjaGFyICpwcm9wID0gbC0+ZGF0YTsK
LSAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVChjcHUpLCBmYWxzZSwgcHJv
cCwgJmxvY2FsX2Vycik7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsKKyAgICAgICAgb2JqZWN0
X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVChjcHUpLCBmYWxzZSwgcHJvcCwgZXJycCk7CisgICAg
ICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgZ290byBvdXQ7CiAgICAgICAgIH0KICAgICB9
CkBAIC01MTQzLDggKzUxMjgsNyBAQCBzdGF0aWMgdm9pZCB4ODZfY3B1X2V4cGFuZF9mZWF0dXJl
cyhYODZDUFUgKmNwdSwgRXJyb3IgKiplcnJwKQogICAgIH0KIAogb3V0OgotICAgIGlmIChsb2Nh
bF9lcnIgIT0gTlVMTCkgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJy
KTsKKyAgICBpZiAoKmVycnAgIT0gTlVMTCkgewogICAgIH0KIH0KIApAQCAtNTIxMiwxMyArNTE5
NiwxMiBAQCBzdGF0aWMgdm9pZCB4ODZfY3B1X3JlYWxpemVmbihEZXZpY2VTdGF0ZSAqZGV2LCBF
cnJvciAqKmVycnApCiAgICAgWDg2Q1BVICpjcHUgPSBYODZfQ1BVKGRldik7CiAgICAgWDg2Q1BV
Q2xhc3MgKnhjYyA9IFg4Nl9DUFVfR0VUX0NMQVNTKGRldik7CiAgICAgQ1BVWDg2U3RhdGUgKmVu
diA9ICZjcHUtPmVudjsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBzdGF0aWMg
Ym9vbCBodF93YXJuZWQ7CiAKICAgICBpZiAoeGNjLT5ob3N0X2NwdWlkX3JlcXVpcmVkKSB7CiAg
ICAgICAgIGlmICghYWNjZWxfdXNlc19ob3N0X2NwdWlkKCkpIHsKICAgICAgICAgICAgIGNoYXIg
Km5hbWUgPSB4ODZfY3B1X2NsYXNzX2dldF9tb2RlbF9uYW1lKHhjYyk7Ci0gICAgICAgICAgICBl
cnJvcl9zZXRnKCZsb2NhbF9lcnIsICJDUFUgbW9kZWwgJyVzJyByZXF1aXJlcyBLVk0iLCBuYW1l
KTsKKyAgICAgICAgICAgIGVycm9yX3NldGcoZXJycCwgIkNQVSBtb2RlbCAnJXMnIHJlcXVpcmVz
IEtWTSIsIG5hbWUpOwogICAgICAgICAgICAgZ19mcmVlKG5hbWUpOwogICAgICAgICAgICAgZ290
byBvdXQ7CiAgICAgICAgIH0KQEAgLTUyMzksOCArNTIyMiw4IEBAIHN0YXRpYyB2b2lkIHg4Nl9j
cHVfcmVhbGl6ZWZuKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAgICAgICAgcmV0
dXJuOwogICAgIH0KIAotICAgIHg4Nl9jcHVfZXhwYW5kX2ZlYXR1cmVzKGNwdSwgJmxvY2FsX2Vy
cik7Ci0gICAgaWYgKGxvY2FsX2VycikgeworICAgIHg4Nl9jcHVfZXhwYW5kX2ZlYXR1cmVzKGNw
dSwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8gb3V0OwogICAgIH0KIApA
QCAtNTI0OCw3ICs1MjMxLDcgQEAgc3RhdGljIHZvaWQgeDg2X2NwdV9yZWFsaXplZm4oRGV2aWNl
U3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogICAgICAgICAoY3B1LT5jaGVja19jcHVpZCB8fCBj
cHUtPmVuZm9yY2VfY3B1aWQpKSB7CiAgICAgICAgIHg4Nl9jcHVfcmVwb3J0X2ZpbHRlcmVkX2Zl
YXR1cmVzKGNwdSk7CiAgICAgICAgIGlmIChjcHUtPmVuZm9yY2VfY3B1aWQpIHsKLSAgICAgICAg
ICAgIGVycm9yX3NldGcoJmxvY2FsX2VyciwKKyAgICAgICAgICAgIGVycm9yX3NldGcoZXJycCwK
ICAgICAgICAgICAgICAgICAgICAgICAgYWNjZWxfdXNlc19ob3N0X2NwdWlkKCkgPwogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIkhvc3QgZG9lc24ndCBzdXBwb3J0IHJlcXVlc3RlZCBmZWF0
dXJlcyIgOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIlRDRyBkb2Vzbid0IHN1cHBvcnQg
cmVxdWVzdGVkIGZlYXR1cmVzIik7CkBAIC01MzY0LDkgKzUzNDcsOCBAQCBzdGF0aWMgdm9pZCB4
ODZfY3B1X3JlYWxpemVmbihEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgfQog
CiAKLSAgICBjcHVfZXhlY19yZWFsaXplZm4oY3MsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2Nh
bF9lcnIgIT0gTlVMTCkgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJy
KTsKKyAgICBjcHVfZXhlY19yZWFsaXplZm4oY3MsIGVycnApOworICAgIGlmICgqZXJycCAhPSBO
VUxMKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKQEAgLTUzNzUsOCArNTM1Nyw4IEBAIHN0
YXRpYyB2b2lkIHg4Nl9jcHVfcmVhbGl6ZWZuKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJy
cCkKICAgICBxZW11X3JlZ2lzdGVyX3Jlc2V0KHg4Nl9jcHVfbWFjaGluZV9yZXNldF9jYiwgY3B1
KTsKIAogICAgIGlmIChjcHUtPmVudi5mZWF0dXJlc1tGRUFUXzFfRURYXSAmIENQVUlEX0FQSUMg
fHwgbXMtPnNtcC5jcHVzID4gMSkgewotICAgICAgICB4ODZfY3B1X2FwaWNfY3JlYXRlKGNwdSwg
JmxvY2FsX2Vycik7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIgIT0gTlVMTCkgeworICAgICAgICB4
ODZfY3B1X2FwaWNfY3JlYXRlKGNwdSwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCAhPSBOVUxM
KSB7CiAgICAgICAgICAgICBnb3RvIG91dDsKICAgICAgICAgfQogICAgIH0KQEAgLTU0MzMsMTcg
KzU0MTUsMTYgQEAgc3RhdGljIHZvaWQgeDg2X2NwdV9yZWFsaXplZm4oRGV2aWNlU3RhdGUgKmRl
diwgRXJyb3IgKiplcnJwKQogICAgICAgICAgICAgaHRfd2FybmVkID0gdHJ1ZTsKICAgICB9CiAK
LSAgICB4ODZfY3B1X2FwaWNfcmVhbGl6ZShjcHUsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2Nh
bF9lcnIgIT0gTlVMTCkgeworICAgIHg4Nl9jcHVfYXBpY19yZWFsaXplKGNwdSwgZXJycCk7Cisg
ICAgaWYgKCplcnJwICE9IE5VTEwpIHsKICAgICAgICAgZ290byBvdXQ7CiAgICAgfQogICAgIGNw
dV9yZXNldChjcyk7CiAKLSAgICB4Y2MtPnBhcmVudF9yZWFsaXplKGRldiwgJmxvY2FsX2Vycik7
CisgICAgeGNjLT5wYXJlbnRfcmVhbGl6ZShkZXYsIGVycnApOwogCiBvdXQ6Ci0gICAgaWYgKGxv
Y2FsX2VyciAhPSBOVUxMKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9l
cnIpOworICAgIGlmICgqZXJycCAhPSBOVUxMKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiB9
CkBAIC01NDUyLDcgKzU0MzMsNiBAQCBzdGF0aWMgdm9pZCB4ODZfY3B1X3VucmVhbGl6ZWZuKERl
dmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKIHsKICAgICBYODZDUFUgKmNwdSA9IFg4Nl9D
UFUoZGV2KTsKICAgICBYODZDUFVDbGFzcyAqeGNjID0gWDg2X0NQVV9HRVRfQ0xBU1MoZGV2KTsK
LSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAogI2lmbmRlZiBDT05GSUdfVVNFUl9PTkxZ
CiAgICAgY3B1X3JlbW92ZV9zeW5jKENQVShkZXYpKTsKQEAgLTU0NjQsOSArNTQ0NCw4IEBAIHN0
YXRpYyB2b2lkIHg4Nl9jcHVfdW5yZWFsaXplZm4oRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKipl
cnJwKQogICAgICAgICBjcHUtPmFwaWNfc3RhdGUgPSBOVUxMOwogICAgIH0KIAotICAgIHhjYy0+
cGFyZW50X3VucmVhbGl6ZShkZXYsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIgIT0g
TlVMTCkgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICB4
Y2MtPnBhcmVudF91bnJlYWxpemUoZGV2LCBlcnJwKTsKKyAgICBpZiAoKmVycnAgIT0gTlVMTCkg
ewogICAgICAgICByZXR1cm47CiAgICAgfQogfQpAQCAtNTQ5Miw3ICs1NDcxLDYgQEAgc3RhdGlj
IHZvaWQgeDg2X2NwdV9zZXRfYml0X3Byb3AoT2JqZWN0ICpvYmosIFZpc2l0b3IgKnYsIGNvbnN0
IGNoYXIgKm5hbWUsCiAgICAgRGV2aWNlU3RhdGUgKmRldiA9IERFVklDRShvYmopOwogICAgIFg4
NkNQVSAqY3B1ID0gWDg2X0NQVShvYmopOwogICAgIEJpdFByb3BlcnR5ICpmcCA9IG9wYXF1ZTsK
LSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBib29sIHZhbHVlOwogCiAgICAgaWYg
KGRldi0+cmVhbGl6ZWQpIHsKQEAgLTU1MDAsOSArNTQ3OCw4IEBAIHN0YXRpYyB2b2lkIHg4Nl9j
cHVfc2V0X2JpdF9wcm9wKE9iamVjdCAqb2JqLCBWaXNpdG9yICp2LCBjb25zdCBjaGFyICpuYW1l
LAogICAgICAgICByZXR1cm47CiAgICAgfQogCi0gICAgdmlzaXRfdHlwZV9ib29sKHYsIG5hbWUs
ICZ2YWx1ZSwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJv
cl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICB2aXNpdF90eXBlX2Jvb2wodiwgbmFt
ZSwgJnZhbHVlLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuOwogICAg
IH0KIApkaWZmIC0tZ2l0IGEvdGFyZ2V0L2xtMzIvY3B1LmMgYi90YXJnZXQvbG0zMi9jcHUuYwpp
bmRleCBiMzU1MzdkZTYyLi41NTBlODUxZmVmIDEwMDY0NAotLS0gYS90YXJnZXQvbG0zMi9jcHUu
YworKysgYi90YXJnZXQvbG0zMi9jcHUuYwpAQCAtMTI0LDExICsxMjQsOSBAQCBzdGF0aWMgdm9p
ZCBsbTMyX2NwdV9yZWFsaXplZm4oRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogewog
ICAgIENQVVN0YXRlICpjcyA9IENQVShkZXYpOwogICAgIExNMzJDUFVDbGFzcyAqbGNjID0gTE0z
Ml9DUFVfR0VUX0NMQVNTKGRldik7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKLSAg
ICBjcHVfZXhlY19yZWFsaXplZm4oY3MsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIg
IT0gTlVMTCkgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAg
ICBjcHVfZXhlY19yZWFsaXplZm4oY3MsIGVycnApOworICAgIGlmICgqZXJycCAhPSBOVUxMKSB7
CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKZGlmZiAtLWdpdCBhL3RhcmdldC9tNjhrL2NwdS5j
IGIvdGFyZ2V0L202OGsvY3B1LmMKaW5kZXggZTY1OTZkZTI5Yy4uMmM3YWY5ZGY1ZiAxMDA2NDQK
LS0tIGEvdGFyZ2V0L202OGsvY3B1LmMKKysrIGIvdGFyZ2V0L202OGsvY3B1LmMKQEAgLTIxOSwx
MyArMjE5LDExIEBAIHN0YXRpYyB2b2lkIG02OGtfY3B1X3JlYWxpemVmbihEZXZpY2VTdGF0ZSAq
ZGV2LCBFcnJvciAqKmVycnApCiAgICAgQ1BVU3RhdGUgKmNzID0gQ1BVKGRldik7CiAgICAgTTY4
a0NQVSAqY3B1ID0gTTY4S19DUFUoZGV2KTsKICAgICBNNjhrQ1BVQ2xhc3MgKm1jYyA9IE02OEtf
Q1BVX0dFVF9DTEFTUyhkZXYpOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAg
cmVnaXN0ZXJfbTY4a19pbnNucygmY3B1LT5lbnYpOwogCi0gICAgY3B1X2V4ZWNfcmVhbGl6ZWZu
KGNzLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyICE9IE5VTEwpIHsKLSAgICAgICAg
ZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgY3B1X2V4ZWNfcmVhbGl6ZWZu
KGNzLCBlcnJwKTsKKyAgICBpZiAoKmVycnAgIT0gTlVMTCkgewogICAgICAgICByZXR1cm47CiAg
ICAgfQogCmRpZmYgLS1naXQgYS90YXJnZXQvbWljcm9ibGF6ZS9jcHUuYyBiL3RhcmdldC9taWNy
b2JsYXplL2NwdS5jCmluZGV4IDljZmQ3NDQ1ZTcuLmI4OTNiMTg2NzUgMTAwNjQ0Ci0tLSBhL3Rh
cmdldC9taWNyb2JsYXplL2NwdS5jCisrKyBiL3RhcmdldC9taWNyb2JsYXplL2NwdS5jCkBAIC0x
NDcsMTEgKzE0Nyw5IEBAIHN0YXRpYyB2b2lkIG1iX2NwdV9yZWFsaXplZm4oRGV2aWNlU3RhdGUg
KmRldiwgRXJyb3IgKiplcnJwKQogICAgIHVpbnQ4X3QgdmVyc2lvbl9jb2RlID0gMDsKICAgICBj
b25zdCBjaGFyICp2ZXJzaW9uOwogICAgIGludCBpID0gMDsKLSAgICBFcnJvciAqbG9jYWxfZXJy
ID0gTlVMTDsKIAotICAgIGNwdV9leGVjX3JlYWxpemVmbihjcywgJmxvY2FsX2Vycik7Ci0gICAg
aWYgKGxvY2FsX2VyciAhPSBOVUxMKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBs
b2NhbF9lcnIpOworICAgIGNwdV9leGVjX3JlYWxpemVmbihjcywgZXJycCk7CisgICAgaWYgKCpl
cnJwICE9IE5VTEwpIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApkaWZmIC0tZ2l0IGEvdGFy
Z2V0L21pcHMvY3B1LmMgYi90YXJnZXQvbWlwcy9jcHUuYwppbmRleCBiYmNmN2NhNDYzLi40YmMx
N2VmMDM2IDEwMDY0NAotLS0gYS90YXJnZXQvbWlwcy9jcHUuYworKysgYi90YXJnZXQvbWlwcy9j
cHUuYwpAQCAtMTM5LDExICsxMzksOSBAQCBzdGF0aWMgdm9pZCBtaXBzX2NwdV9yZWFsaXplZm4o
RGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogICAgIENQVVN0YXRlICpjcyA9IENQVShk
ZXYpOwogICAgIE1JUFNDUFUgKmNwdSA9IE1JUFNfQ1BVKGRldik7CiAgICAgTUlQU0NQVUNsYXNz
ICptY2MgPSBNSVBTX0NQVV9HRVRfQ0xBU1MoZGV2KTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0g
TlVMTDsKIAotICAgIGNwdV9leGVjX3JlYWxpemVmbihjcywgJmxvY2FsX2Vycik7Ci0gICAgaWYg
KGxvY2FsX2VyciAhPSBOVUxMKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2Nh
bF9lcnIpOworICAgIGNwdV9leGVjX3JlYWxpemVmbihjcywgZXJycCk7CisgICAgaWYgKCplcnJw
ICE9IE5VTEwpIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApkaWZmIC0tZ2l0IGEvdGFyZ2V0
L21veGllL2NwdS5jIGIvdGFyZ2V0L21veGllL2NwdS5jCmluZGV4IDQ4OTk2ZDA1NTQuLjQ5Zjc3
NjQ2MTkgMTAwNjQ0Ci0tLSBhL3RhcmdldC9tb3hpZS9jcHUuYworKysgYi90YXJnZXQvbW94aWUv
Y3B1LmMKQEAgLTU3LDExICs1Nyw5IEBAIHN0YXRpYyB2b2lkIG1veGllX2NwdV9yZWFsaXplZm4o
RGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogewogICAgIENQVVN0YXRlICpjcyA9IENQ
VShkZXYpOwogICAgIE1veGllQ1BVQ2xhc3MgKm1jYyA9IE1PWElFX0NQVV9HRVRfQ0xBU1MoZGV2
KTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAotICAgIGNwdV9leGVjX3JlYWxpemVm
bihjcywgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VyciAhPSBOVUxMKSB7Ci0gICAgICAg
IGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIGNwdV9leGVjX3JlYWxpemVm
bihjcywgZXJycCk7CisgICAgaWYgKCplcnJwICE9IE5VTEwpIHsKICAgICAgICAgcmV0dXJuOwog
ICAgIH0KIApkaWZmIC0tZ2l0IGEvdGFyZ2V0L25pb3MyL2NwdS5jIGIvdGFyZ2V0L25pb3MyL2Nw
dS5jCmluZGV4IGNhOWM3YTZkZjUuLjhjNjE3ZmQ2NTcgMTAwNjQ0Ci0tLSBhL3RhcmdldC9uaW9z
Mi9jcHUuYworKysgYi90YXJnZXQvbmlvczIvY3B1LmMKQEAgLTg0LDExICs4NCw5IEBAIHN0YXRp
YyB2b2lkIG5pb3MyX2NwdV9yZWFsaXplZm4oRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJw
KQogewogICAgIENQVVN0YXRlICpjcyA9IENQVShkZXYpOwogICAgIE5pb3MyQ1BVQ2xhc3MgKm5j
YyA9IE5JT1MyX0NQVV9HRVRfQ0xBU1MoZGV2KTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVM
TDsKIAotICAgIGNwdV9leGVjX3JlYWxpemVmbihjcywgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxv
Y2FsX2VyciAhPSBOVUxMKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9l
cnIpOworICAgIGNwdV9leGVjX3JlYWxpemVmbihjcywgZXJycCk7CisgICAgaWYgKCplcnJwICE9
IE5VTEwpIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApkaWZmIC0tZ2l0IGEvdGFyZ2V0L29w
ZW5yaXNjL2NwdS5jIGIvdGFyZ2V0L29wZW5yaXNjL2NwdS5jCmluZGV4IDUwNmFlYzZiZmIuLmNk
OGVmYzZkMmQgMTAwNjQ0Ci0tLSBhL3RhcmdldC9vcGVucmlzYy9jcHUuYworKysgYi90YXJnZXQv
b3BlbnJpc2MvY3B1LmMKQEAgLTY5LDExICs2OSw5IEBAIHN0YXRpYyB2b2lkIG9wZW5yaXNjX2Nw
dV9yZWFsaXplZm4oRGV2aWNlU3RhdGUgKmRldiwgRXJyb3IgKiplcnJwKQogewogICAgIENQVVN0
YXRlICpjcyA9IENQVShkZXYpOwogICAgIE9wZW5SSVNDQ1BVQ2xhc3MgKm9jYyA9IE9QRU5SSVND
X0NQVV9HRVRfQ0xBU1MoZGV2KTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAotICAg
IGNwdV9leGVjX3JlYWxpemVmbihjcywgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VyciAh
PSBOVUxMKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAg
IGNwdV9leGVjX3JlYWxpemVmbihjcywgZXJycCk7CisgICAgaWYgKCplcnJwICE9IE5VTEwpIHsK
ICAgICAgICAgcmV0dXJuOwogICAgIH0KIApkaWZmIC0tZ2l0IGEvdGFyZ2V0L3BwYy9jb21wYXQu
YyBiL3RhcmdldC9wcGMvY29tcGF0LmMKaW5kZXggN2RlNGJmMzEyMi4uYTgyZDhkMTA1NiAxMDA2
NDQKLS0tIGEvdGFyZ2V0L3BwYy9jb21wYXQuYworKysgYi90YXJnZXQvcHBjL2NvbXBhdC5jCkBA
IC0yNTEsMTMgKzI1MSwxMSBAQCBzdGF0aWMgdm9pZCBwcGNfY29tcGF0X3Byb3BfZ2V0KE9iamVj
dCAqb2JqLCBWaXNpdG9yICp2LCBjb25zdCBjaGFyICpuYW1lLAogc3RhdGljIHZvaWQgcHBjX2Nv
bXBhdF9wcm9wX3NldChPYmplY3QgKm9iaiwgVmlzaXRvciAqdiwgY29uc3QgY2hhciAqbmFtZSwK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqb3BhcXVlLCBFcnJvciAqKmVy
cnApCiB7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgY2hhciAqdmFsdWU7CiAg
ICAgdWludDMyX3QgY29tcGF0X3B2cjsKIAotICAgIHZpc2l0X3R5cGVfc3RyKHYsIG5hbWUsICZ2
YWx1ZSwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9w
cm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICB2aXNpdF90eXBlX3N0cih2LCBuYW1lLCAm
dmFsdWUsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQog
CkBAIC0yOTIsMTYgKzI5MCwxNSBAQCB2b2lkIHBwY19jb21wYXRfYWRkX3Byb3BlcnR5KE9iamVj
dCAqb2JqLCBjb25zdCBjaGFyICpuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1
aW50MzJfdCAqY29tcGF0X3B2ciwgY29uc3QgY2hhciAqYmFzZWRlc2MsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0g
TlVMTDsKICAgICBnY2hhciAqbmFtZXN2W0FSUkFZX1NJWkUoY29tcGF0X3RhYmxlKSArIDFdOwog
ICAgIGdjaGFyICpuYW1lcywgKmRlc2M7CiAgICAgaW50IGk7CiAKICAgICBvYmplY3RfcHJvcGVy
dHlfYWRkKG9iaiwgbmFtZSwgInN0cmluZyIsCiAgICAgICAgICAgICAgICAgICAgICAgICBwcGNf
Y29tcGF0X3Byb3BfZ2V0LCBwcGNfY29tcGF0X3Byb3Bfc2V0LCBOVUxMLAotICAgICAgICAgICAg
ICAgICAgICAgICAgY29tcGF0X3B2ciwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2Vycikg
ewotICAgICAgICBnb3RvIG91dDsKKyAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBhdF9wdnIs
IGVycnApOworICAgIGlmICgqZXJycCkgeworICAgICAgICByZXR1cm47CiAgICAgfQogCiAgICAg
Zm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUoY29tcGF0X3RhYmxlKTsgaSsrKSB7CkBAIC0zMTUs
MTEgKzMxMiw4IEBAIHZvaWQgcHBjX2NvbXBhdF9hZGRfcHJvcGVydHkoT2JqZWN0ICpvYmosIGNv
bnN0IGNoYXIgKm5hbWUsCiAKICAgICBuYW1lcyA9IGdfc3Ryam9pbnYoIiwgIiwgbmFtZXN2KTsK
ICAgICBkZXNjID0gZ19zdHJkdXBfcHJpbnRmKCIlcy4gVmFsaWQgdmFsdWVzIGFyZSAlcy4iLCBi
YXNlZGVzYywgbmFtZXMpOwotICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfZGVzY3JpcHRpb24ob2Jq
LCBuYW1lLCBkZXNjLCAmbG9jYWxfZXJyKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2Rlc2Ny
aXB0aW9uKG9iaiwgbmFtZSwgZGVzYywgZXJycCk7CiAKICAgICBnX2ZyZWUobmFtZXMpOwogICAg
IGdfZnJlZShkZXNjKTsKLQotb3V0OgotICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9l
cnIpOwogfQpkaWZmIC0tZ2l0IGEvdGFyZ2V0L3BwYy9rdm0uYyBiL3RhcmdldC9wcGMva3ZtLmMK
aW5kZXggOGM1YjFmMjVjYy4uYmFkNzNmZjAzNiAxMDA2NDQKLS0tIGEvdGFyZ2V0L3BwYy9rdm0u
YworKysgYi90YXJnZXQvcHBjL2t2bS5jCkBAIC0zMjcsMTYgKzMyNywxNCBAQCB2b2lkIGt2bV9j
aGVja19tbXUoUG93ZXJQQ0NQVSAqY3B1LCBFcnJvciAqKmVycnApCiB7CiAgICAgc3RydWN0IGt2
bV9wcGNfc21tdV9pbmZvIHNtbXVfaW5mbzsKICAgICBpbnQgaXEsIGlrLCBqcSwgams7Ci0gICAg
RXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICAvKiBGb3Igbm93LCB3ZSBvbmx5IGhhdmUg
YW55dGhpbmcgdG8gY2hlY2sgb24gaGFzaDY0IE1NVXMgKi8KICAgICBpZiAoIWNwdS0+aGFzaDY0
X29wdHMgfHwgIWt2bV9lbmFibGVkKCkpIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIAotICAg
IGt2bV9nZXRfc21tdV9pbmZvKCZzbW11X2luZm8sICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2Nh
bF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAg
a3ZtX2dldF9zbW11X2luZm8oJnNtbXVfaW5mbywgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAg
ICAgICAgIHJldHVybjsKICAgICB9CiAKZGlmZiAtLWdpdCBhL3RhcmdldC9wcGMvdHJhbnNsYXRl
X2luaXQuaW5jLmMgYi90YXJnZXQvcHBjL3RyYW5zbGF0ZV9pbml0LmluYy5jCmluZGV4IDBmYjEx
YzdhYzYuLjhlYzkzMTY5YjMgMTAwNjQ0Ci0tLSBhL3RhcmdldC9wcGMvdHJhbnNsYXRlX2luaXQu
aW5jLmMKKysrIGIvdGFyZ2V0L3BwYy90cmFuc2xhdGVfaW5pdC5pbmMuYwpAQCAtOTgxMSwxMSAr
OTgxMSw5IEBAIHN0YXRpYyB2b2lkIHBwY19jcHVfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBF
cnJvciAqKmVycnApCiAgICAgQ1BVU3RhdGUgKmNzID0gQ1BVKGRldik7CiAgICAgUG93ZXJQQ0NQ
VSAqY3B1ID0gUE9XRVJQQ19DUFUoZGV2KTsKICAgICBQb3dlclBDQ1BVQ2xhc3MgKnBjYyA9IFBP
V0VSUENfQ1BVX0dFVF9DTEFTUyhjcHUpOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwog
Ci0gICAgY3B1X2V4ZWNfcmVhbGl6ZWZuKGNzLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxf
ZXJyICE9IE5VTEwpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7
CisgICAgY3B1X2V4ZWNfcmVhbGl6ZWZuKGNzLCBlcnJwKTsKKyAgICBpZiAoKmVycnAgIT0gTlVM
TCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogICAgIGlmIChjcHUtPnZjcHVfaWQgPT0gVU5B
U1NJR05FRF9DUFVfSU5ERVgpIHsKQEAgLTk4MjksOSArOTgyNyw4IEBAIHN0YXRpYyB2b2lkIHBw
Y19jcHVfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgICAgIH0K
ICAgICB9CiAKLSAgICBjcmVhdGVfcHBjX29wY29kZXMoY3B1LCAmbG9jYWxfZXJyKTsKLSAgICBp
ZiAobG9jYWxfZXJyICE9IE5VTEwpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxv
Y2FsX2Vycik7CisgICAgY3JlYXRlX3BwY19vcGNvZGVzKGNwdSwgZXJycCk7CisgICAgaWYgKCpl
cnJwICE9IE5VTEwpIHsKICAgICAgICAgZ290byB1bnJlYWxpemU7CiAgICAgfQogICAgIGluaXRf
cHBjX3Byb2MoY3B1KTsKQEAgLTEwMDM2LDEzICsxMDAzMywxMSBAQCBzdGF0aWMgdm9pZCBwcGNf
Y3B1X3VucmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiB7CiAgICAgUG93
ZXJQQ0NQVSAqY3B1ID0gUE9XRVJQQ19DUFUoZGV2KTsKICAgICBQb3dlclBDQ1BVQ2xhc3MgKnBj
YyA9IFBPV0VSUENfQ1BVX0dFVF9DTEFTUyhjcHUpOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBO
VUxMOwogICAgIG9wY19oYW5kbGVyX3QgKip0YWJsZSwgKip0YWJsZV8yOwogICAgIGludCBpLCBq
LCBrOwogCi0gICAgcGNjLT5wYXJlbnRfdW5yZWFsaXplKGRldiwgJmxvY2FsX2Vycik7Ci0gICAg
aWYgKGxvY2FsX2VyciAhPSBOVUxMKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBs
b2NhbF9lcnIpOworICAgIHBjYy0+cGFyZW50X3VucmVhbGl6ZShkZXYsIGVycnApOworICAgIGlm
ICgqZXJycCAhPSBOVUxMKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKQEAgLTEwMjAwLDcg
KzEwMTk1LDYgQEAgc3RhdGljIHZvaWQgcHBjX2NwdV9wYXJzZV9mZWF0dXJlc3RyKGNvbnN0IGNo
YXIgKnR5cGUsIGNoYXIgKmZlYXR1cmVzLAogICAgICAgICBpbnQgaTsKICAgICAgICAgY2hhciAq
KmlucGllY2VzOwogICAgICAgICBjaGFyICpzID0gZmVhdHVyZXM7Ci0gICAgICAgIEVycm9yICps
b2NhbF9lcnIgPSBOVUxMOwogICAgICAgICBjaGFyICpjb21wYXRfc3RyID0gTlVMTDsKIAogICAg
ICAgICAvKgpAQCAtMTAyMjgsMTEgKzEwMjIyLDEwIEBAIHN0YXRpYyB2b2lkIHBwY19jcHVfcGFy
c2VfZmVhdHVyZXN0cihjb25zdCBjaGFyICp0eXBlLCBjaGFyICpmZWF0dXJlcywKIAogICAgICAg
ICBpZiAoY29tcGF0X3N0cikgewogICAgICAgICAgICAgY2hhciAqdiA9IGNvbXBhdF9zdHIgKyBz
dHJsZW4oImNvbXBhdD0iKTsKLSAgICAgICAgICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfc3RyKG1h
Y2hpbmUsIHYsICJtYXgtY3B1LWNvbXBhdCIsICZsb2NhbF9lcnIpOworICAgICAgICAgICAgb2Jq
ZWN0X3Byb3BlcnR5X3NldF9zdHIobWFjaGluZSwgdiwgIm1heC1jcHUtY29tcGF0IiwgZXJycCk7
CiAgICAgICAgIH0KICAgICAgICAgZ19zdHJmcmVldihpbnBpZWNlcyk7Ci0gICAgICAgIGlmIChs
b2NhbF9lcnIpIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIp
OworICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQog
ICAgIH0KZGlmZiAtLWdpdCBhL3RhcmdldC9yaXNjdi9jcHUuYyBiL3RhcmdldC9yaXNjdi9jcHUu
YwppbmRleCBmMTNlMjk4YTM2Li4wOGFlZjdjNzdkIDEwMDY0NAotLS0gYS90YXJnZXQvcmlzY3Yv
Y3B1LmMKKysrIGIvdGFyZ2V0L3Jpc2N2L2NwdS5jCkBAIC0zMjIsMTEgKzMyMiw5IEBAIHN0YXRp
YyB2b2lkIHJpc2N2X2NwdV9yZWFsaXplKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkK
ICAgICBSSVNDVkNQVUNsYXNzICptY2MgPSBSSVNDVl9DUFVfR0VUX0NMQVNTKGRldik7CiAgICAg
aW50IHByaXZfdmVyc2lvbiA9IFBSSVZfVkVSU0lPTl8xXzExXzA7CiAgICAgdGFyZ2V0X3Vsb25n
IHRhcmdldF9taXNhID0gMDsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAotICAgIGNw
dV9leGVjX3JlYWxpemVmbihjcywgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VyciAhPSBO
VUxMKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIGNw
dV9leGVjX3JlYWxpemVmbihjcywgZXJycCk7CisgICAgaWYgKCplcnJwICE9IE5VTEwpIHsKICAg
ICAgICAgcmV0dXJuOwogICAgIH0KIApkaWZmIC0tZ2l0IGEvdGFyZ2V0L3MzOTB4L2NwdS5jIGIv
dGFyZ2V0L3MzOTB4L2NwdS5jCmluZGV4IDNhYmU3ZTgwZmQuLjExY2UwYzIxMTQgMTAwNjQ0Ci0t
LSBhL3RhcmdldC9zMzkweC9jcHUuYworKysgYi90YXJnZXQvczM5MHgvY3B1LmMKQEAgLTE4OSwz
NyArMTg5LDM2IEBAIHN0YXRpYyB2b2lkIHMzOTBfY3B1X3JlYWxpemVmbihEZXZpY2VTdGF0ZSAq
ZGV2LCBFcnJvciAqKmVycnApCiAjaWYgIWRlZmluZWQoQ09ORklHX1VTRVJfT05MWSkKICAgICBT
MzkwQ1BVICpjcHUgPSBTMzkwX0NQVShkZXYpOwogI2VuZGlmCi0gICAgRXJyb3IgKmVyciA9IE5V
TEw7CiAKICAgICAvKiB0aGUgbW9kZWwgaGFzIHRvIGJlIHJlYWxpemVkIGJlZm9yZSBxZW11X2lu
aXRfdmNwdSgpIGR1ZSB0byBrdm0gKi8KLSAgICBzMzkwX3JlYWxpemVfY3B1X21vZGVsKGNzLCAm
ZXJyKTsKLSAgICBpZiAoZXJyKSB7Ci0gICAgICAgIGdvdG8gb3V0OworICAgIHMzOTBfcmVhbGl6
ZV9jcHVfbW9kZWwoY3MsIGVycnApOworICAgIGlmICgqZXJycCkgeworICAgICAgICByZXR1cm47
CiAgICAgfQogCiAjaWYgIWRlZmluZWQoQ09ORklHX1VTRVJfT05MWSkKICAgICBNYWNoaW5lU3Rh
dGUgKm1zID0gTUFDSElORShxZGV2X2dldF9tYWNoaW5lKCkpOwogICAgIHVuc2lnbmVkIGludCBt
YXhfY3B1cyA9IG1zLT5zbXAubWF4X2NwdXM7CiAgICAgaWYgKGNwdS0+ZW52LmNvcmVfaWQgPj0g
bWF4X2NwdXMpIHsKLSAgICAgICAgZXJyb3Jfc2V0ZygmZXJyLCAiVW5hYmxlIHRvIGFkZCBDUFUg
d2l0aCBjb3JlLWlkOiAlIiBQUkl1MzIKKyAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAiVW5hYmxl
IHRvIGFkZCBDUFUgd2l0aCBjb3JlLWlkOiAlIiBQUkl1MzIKICAgICAgICAgICAgICAgICAgICAi
LCBtYXhpbXVtIGNvcmUtaWQ6ICVkIiwgY3B1LT5lbnYuY29yZV9pZCwKICAgICAgICAgICAgICAg
ICAgICBtYXhfY3B1cyAtIDEpOwotICAgICAgICBnb3RvIG91dDsKKyAgICAgICAgcmV0dXJuOwog
ICAgIH0KIAogICAgIGlmIChjcHVfZXhpc3RzKGNwdS0+ZW52LmNvcmVfaWQpKSB7Ci0gICAgICAg
IGVycm9yX3NldGcoJmVyciwgIlVuYWJsZSB0byBhZGQgQ1BVIHdpdGggY29yZS1pZDogJSIgUFJJ
dTMyCisgICAgICAgIGVycm9yX3NldGcoZXJycCwgIlVuYWJsZSB0byBhZGQgQ1BVIHdpdGggY29y
ZS1pZDogJSIgUFJJdTMyCiAgICAgICAgICAgICAgICAgICAgIiwgaXQgYWxyZWFkeSBleGlzdHMi
LCBjcHUtPmVudi5jb3JlX2lkKTsKLSAgICAgICAgZ290byBvdXQ7CisgICAgICAgIHJldHVybjsK
ICAgICB9CiAKICAgICAvKiBzeW5jIGNzLT5jcHVfaW5kZXggYW5kIGVudi0+Y29yZV9pZC4gVGhl
IGxhdHRlciBpcyBuZWVkZWQgZm9yIFRDRy4gKi8KICAgICBjcy0+Y3B1X2luZGV4ID0gY3B1LT5l
bnYuY29yZV9pZDsKICNlbmRpZgogCi0gICAgY3B1X2V4ZWNfcmVhbGl6ZWZuKGNzLCAmZXJyKTsK
LSAgICBpZiAoZXJyICE9IE5VTEwpIHsKLSAgICAgICAgZ290byBvdXQ7CisgICAgY3B1X2V4ZWNf
cmVhbGl6ZWZuKGNzLCBlcnJwKTsKKyAgICBpZiAoKmVycnAgIT0gTlVMTCkgeworICAgICAgICBy
ZXR1cm47CiAgICAgfQogCiAjaWYgIWRlZmluZWQoQ09ORklHX1VTRVJfT05MWSkKQEAgLTI0MCw5
ICsyMzksNyBAQCBzdGF0aWMgdm9pZCBzMzkwX2NwdV9yZWFsaXplZm4oRGV2aWNlU3RhdGUgKmRl
diwgRXJyb3IgKiplcnJwKQogICAgICAgICBjcHVfcmVzZXQoY3MpOwogICAgIH0KIAotICAgIHNj
Yy0+cGFyZW50X3JlYWxpemUoZGV2LCAmZXJyKTsKLW91dDoKLSAgICBlcnJvcl9wcm9wYWdhdGUo
ZXJycCwgZXJyKTsKKyAgICBzY2MtPnBhcmVudF9yZWFsaXplKGRldiwgZXJycCk7CiB9CiAKIHN0
YXRpYyBHdWVzdFBhbmljSW5mb3JtYXRpb24gKnMzOTBfY3B1X2dldF9jcmFzaF9pbmZvKENQVVN0
YXRlICpjcykKZGlmZiAtLWdpdCBhL3RhcmdldC9zMzkweC9rdm0tc3R1Yi5jIGIvdGFyZ2V0L3Mz
OTB4L2t2bS1zdHViLmMKaW5kZXggNTE1MmUyYmRmMS4uMjQ3MmVkNjIzOSAxMDA2NDQKLS0tIGEv
dGFyZ2V0L3MzOTB4L2t2bS1zdHViLmMKKysrIGIvdGFyZ2V0L3MzOTB4L2t2bS1zdHViLmMKQEAg
LTk0LDYgKzk0LDcgQEAgaW50IGt2bV9zMzkwX3NldF9tZW1fbGltaXQodWludDY0X3QgbmV3X2xp
bWl0LCB1aW50NjRfdCAqaHdfbGltaXQpCiAKIHZvaWQga3ZtX3MzOTBfc2V0X21heF9wYWdlc2l6
ZSh1aW50NjRfdCBwYWdlc2l6ZSwgRXJyb3IgKiplcnJwKQogeworCUVSUlBfRlVOQ1RJT05fQkVH
SU4oKTsKIH0KIAogdm9pZCBrdm1fczM5MF9jcnlwdG9fcmVzZXQodm9pZCkKZGlmZiAtLWdpdCBh
L3RhcmdldC9zaDQvY3B1LmMgYi90YXJnZXQvc2g0L2NwdS5jCmluZGV4IGQwYTc3MDc5OTEuLjc4
N2JiNTMwMTAgMTAwNjQ0Ci0tLSBhL3RhcmdldC9zaDQvY3B1LmMKKysrIGIvdGFyZ2V0L3NoNC9j
cHUuYwpAQCAtMTc2LDExICsxNzYsOSBAQCBzdGF0aWMgdm9pZCBzdXBlcmhfY3B1X3JlYWxpemVm
bihEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiB7CiAgICAgQ1BVU3RhdGUgKmNzID0g
Q1BVKGRldik7CiAgICAgU3VwZXJIQ1BVQ2xhc3MgKnNjYyA9IFNVUEVSSF9DUFVfR0VUX0NMQVNT
KGRldik7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKLSAgICBjcHVfZXhlY19yZWFs
aXplZm4oY3MsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIgIT0gTlVMTCkgewotICAg
ICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBjcHVfZXhlY19yZWFs
aXplZm4oY3MsIGVycnApOworICAgIGlmICgqZXJycCAhPSBOVUxMKSB7CiAgICAgICAgIHJldHVy
bjsKICAgICB9CiAKZGlmZiAtLWdpdCBhL3RhcmdldC9zcGFyYy9jcHUuYyBiL3RhcmdldC9zcGFy
Yy9jcHUuYwppbmRleCBiYzY1OTI5NTUyLi44NTNiNjI3N2ZjIDEwMDY0NAotLS0gYS90YXJnZXQv
c3BhcmMvY3B1LmMKKysrIGIvdGFyZ2V0L3NwYXJjL2NwdS5jCkBAIC03MzgsNyArNzM4LDYgQEAg
c3RhdGljIHZvaWQgc3BhcmNfY3B1X3JlYWxpemVmbihEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAq
KmVycnApCiB7CiAgICAgQ1BVU3RhdGUgKmNzID0gQ1BVKGRldik7CiAgICAgU1BBUkNDUFVDbGFz
cyAqc2NjID0gU1BBUkNfQ1BVX0dFVF9DTEFTUyhkZXYpOwotICAgIEVycm9yICpsb2NhbF9lcnIg
PSBOVUxMOwogICAgIFNQQVJDQ1BVICpjcHUgPSBTUEFSQ19DUFUoZGV2KTsKICAgICBDUFVTUEFS
Q1N0YXRlICplbnYgPSAmY3B1LT5lbnY7CiAKQEAgLTc2Miw5ICs3NjEsOCBAQCBzdGF0aWMgdm9p
ZCBzcGFyY19jcHVfcmVhbGl6ZWZuKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAg
ICBlbnYtPnZlcnNpb24gfD0gZW52LT5kZWYubndpbmRvd3MgLSAxOwogI2VuZGlmCiAKLSAgICBj
cHVfZXhlY19yZWFsaXplZm4oY3MsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIgIT0g
TlVMTCkgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBj
cHVfZXhlY19yZWFsaXplZm4oY3MsIGVycnApOworICAgIGlmICgqZXJycCAhPSBOVUxMKSB7CiAg
ICAgICAgIHJldHVybjsKICAgICB9CiAKQEAgLTgwMSwxMiArNzk5LDEwIEBAIHN0YXRpYyB2b2lk
IHNwYXJjX3NldF9ud2luZG93cyhPYmplY3QgKm9iaiwgVmlzaXRvciAqdiwgY29uc3QgY2hhciAq
bmFtZSwKICAgICBjb25zdCBpbnQ2NF90IG1pbiA9IE1JTl9OV0lORE9XUzsKICAgICBjb25zdCBp
bnQ2NF90IG1heCA9IE1BWF9OV0lORE9XUzsKICAgICBTUEFSQ0NQVSAqY3B1ID0gU1BBUkNfQ1BV
KG9iaik7Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7CiAgICAgaW50NjRfdCB2YWx1ZTsKIAotICAg
IHZpc2l0X3R5cGVfaW50KHYsIG5hbWUsICZ2YWx1ZSwgJmVycik7Ci0gICAgaWYgKGVycikgewot
ICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICB2aXNpdF90eXBlX2ludCh2
LCBuYW1lLCAmdmFsdWUsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47
CiAgICAgfQogCmRpZmYgLS1naXQgYS90YXJnZXQvdGlsZWd4L2NwdS5jIGIvdGFyZ2V0L3RpbGVn
eC9jcHUuYwppbmRleCAyYjJhN2NjYzMxLi40MTkwOTc0YWFmIDEwMDY0NAotLS0gYS90YXJnZXQv
dGlsZWd4L2NwdS5jCisrKyBiL3RhcmdldC90aWxlZ3gvY3B1LmMKQEAgLTgzLDExICs4Myw5IEBA
IHN0YXRpYyB2b2lkIHRpbGVneF9jcHVfcmVhbGl6ZWZuKERldmljZVN0YXRlICpkZXYsIEVycm9y
ICoqZXJycCkKIHsKICAgICBDUFVTdGF0ZSAqY3MgPSBDUFUoZGV2KTsKICAgICBUaWxlR1hDUFVD
bGFzcyAqdGNjID0gVElMRUdYX0NQVV9HRVRfQ0xBU1MoZGV2KTsKLSAgICBFcnJvciAqbG9jYWxf
ZXJyID0gTlVMTDsKIAotICAgIGNwdV9leGVjX3JlYWxpemVmbihjcywgJmxvY2FsX2Vycik7Ci0g
ICAgaWYgKGxvY2FsX2VyciAhPSBOVUxMKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJw
LCBsb2NhbF9lcnIpOworICAgIGNwdV9leGVjX3JlYWxpemVmbihjcywgZXJycCk7CisgICAgaWYg
KCplcnJwICE9IE5VTEwpIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIApkaWZmIC0tZ2l0IGEv
dGFyZ2V0L3RyaWNvcmUvY3B1LmMgYi90YXJnZXQvdHJpY29yZS9jcHUuYwppbmRleCBkZjgwN2Mx
ZDc0Li5mN2ExOWQzMDljIDEwMDY0NAotLS0gYS90YXJnZXQvdHJpY29yZS9jcHUuYworKysgYi90
YXJnZXQvdHJpY29yZS9jcHUuYwpAQCAtNzUsMTEgKzc1LDkgQEAgc3RhdGljIHZvaWQgdHJpY29y
ZV9jcHVfcmVhbGl6ZWZuKERldmljZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKICAgICBUcmlD
b3JlQ1BVICpjcHUgPSBUUklDT1JFX0NQVShkZXYpOwogICAgIFRyaUNvcmVDUFVDbGFzcyAqdGNj
ID0gVFJJQ09SRV9DUFVfR0VUX0NMQVNTKGRldik7CiAgICAgQ1BVVHJpQ29yZVN0YXRlICplbnYg
PSAmY3B1LT5lbnY7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKLSAgICBjcHVfZXhl
Y19yZWFsaXplZm4oY3MsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIgIT0gTlVMTCkg
ewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBjcHVfZXhl
Y19yZWFsaXplZm4oY3MsIGVycnApOworICAgIGlmICgqZXJycCAhPSBOVUxMKSB7CiAgICAgICAg
IHJldHVybjsKICAgICB9CiAKZGlmZiAtLWdpdCBhL3RhcmdldC91bmljb3JlMzIvY3B1LmMgYi90
YXJnZXQvdW5pY29yZTMyL2NwdS5jCmluZGV4IGIyN2ZiOTY4OWYuLjdiZjc0MjIyZjcgMTAwNjQ0
Ci0tLSBhL3RhcmdldC91bmljb3JlMzIvY3B1LmMKKysrIGIvdGFyZ2V0L3VuaWNvcmUzMi9jcHUu
YwpAQCAtODYsMTEgKzg2LDkgQEAgc3RhdGljIHZvaWQgdWMzMl9jcHVfcmVhbGl6ZWZuKERldmlj
ZVN0YXRlICpkZXYsIEVycm9yICoqZXJycCkKIHsKICAgICBDUFVTdGF0ZSAqY3MgPSBDUFUoZGV2
KTsKICAgICBVbmlDb3JlMzJDUFVDbGFzcyAqdWNjID0gVU5JQ09SRTMyX0NQVV9HRVRfQ0xBU1Mo
ZGV2KTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAotICAgIGNwdV9leGVjX3JlYWxp
emVmbihjcywgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VyciAhPSBOVUxMKSB7Ci0gICAg
ICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIGNwdV9leGVjX3JlYWxp
emVmbihjcywgZXJycCk7CisgICAgaWYgKCplcnJwICE9IE5VTEwpIHsKICAgICAgICAgcmV0dXJu
OwogICAgIH0KIApkaWZmIC0tZ2l0IGEvdGFyZ2V0L3h0ZW5zYS9jcHUuYyBiL3RhcmdldC94dGVu
c2EvY3B1LmMKaW5kZXggYzY1ZGNmOWRkNy4uYjJiOTYxN2Y4MSAxMDA2NDQKLS0tIGEvdGFyZ2V0
L3h0ZW5zYS9jcHUuYworKysgYi90YXJnZXQveHRlbnNhL2NwdS5jCkBAIC0xMzMsMTUgKzEzMywx
MyBAQCBzdGF0aWMgdm9pZCB4dGVuc2FfY3B1X3JlYWxpemVmbihEZXZpY2VTdGF0ZSAqZGV2LCBF
cnJvciAqKmVycnApCiB7CiAgICAgQ1BVU3RhdGUgKmNzID0gQ1BVKGRldik7CiAgICAgWHRlbnNh
Q1BVQ2xhc3MgKnhjYyA9IFhURU5TQV9DUFVfR0VUX0NMQVNTKGRldik7Ci0gICAgRXJyb3IgKmxv
Y2FsX2VyciA9IE5VTEw7CiAKICNpZm5kZWYgQ09ORklHX1VTRVJfT05MWQogICAgIHh0ZW5zYV9p
cnFfaW5pdCgmWFRFTlNBX0NQVShkZXYpLT5lbnYpOwogI2VuZGlmCiAKLSAgICBjcHVfZXhlY19y
ZWFsaXplZm4oY3MsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIgIT0gTlVMTCkgewot
ICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBjcHVfZXhlY19y
ZWFsaXplZm4oY3MsIGVycnApOworICAgIGlmICgqZXJycCAhPSBOVUxMKSB7CiAgICAgICAgIHJl
dHVybjsKICAgICB9CiAKZGlmZiAtLWdpdCBhL3Rlc3RzL3Rlc3QtaW1hZ2UtbG9ja2luZy5jIGIv
dGVzdHMvdGVzdC1pbWFnZS1sb2NraW5nLmMKaW5kZXggYmEwNTdiZDY2Yy4uNDljNmM5ZWQ3YiAx
MDA2NDQKLS0tIGEvdGVzdHMvdGVzdC1pbWFnZS1sb2NraW5nLmMKKysrIGIvdGVzdHMvdGVzdC1p
bWFnZS1sb2NraW5nLmMKQEAgLTM1LDIwICszNSwxOCBAQCBzdGF0aWMgQmxvY2tCYWNrZW5kICpv
cGVuX2ltYWdlKGNvbnN0IGNoYXIgKnBhdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHVpbnQ2NF90IHBlcm0sIHVpbnQ2NF90IHNoYXJlZF9wZXJtLAogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9
IE5VTEw7CiAgICAgQmxvY2tCYWNrZW5kICpibGs7CiAgICAgUURpY3QgKm9wdGlvbnMgPSBxZGlj
dF9uZXcoKTsKIAogICAgIHFkaWN0X3B1dF9zdHIob3B0aW9ucywgImRyaXZlciIsICJyYXciKTsK
LSAgICBibGsgPSBibGtfbmV3X29wZW4ocGF0aCwgTlVMTCwgb3B0aW9ucywgQkRSVl9PX1JEV1Is
ICZsb2NhbF9lcnIpOworICAgIGJsayA9IGJsa19uZXdfb3BlbihwYXRoLCBOVUxMLCBvcHRpb25z
LCBCRFJWX09fUkRXUiwgZXJycCk7CiAgICAgaWYgKGJsaykgewotICAgICAgICBnX2Fzc2VydF9u
dWxsKGxvY2FsX2Vycik7CisgICAgICAgIGdfYXNzZXJ0X251bGwoKmVycnApOwogICAgICAgICBp
ZiAoYmxrX3NldF9wZXJtKGJsaywgcGVybSwgc2hhcmVkX3Blcm0sIGVycnApKSB7CiAgICAgICAg
ICAgICBibGtfdW5yZWYoYmxrKTsKICAgICAgICAgICAgIGJsayA9IE5VTEw7CiAgICAgICAgIH0K
ICAgICB9IGVsc2UgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsK
ICAgICB9CiAgICAgcmV0dXJuIGJsazsKIH0KZGlmZiAtLWdpdCBhL3Rlc3RzL3Rlc3QtcW1wLWNt
ZHMuYyBiL3Rlc3RzL3Rlc3QtcW1wLWNtZHMuYwppbmRleCBhYjM4OWY0MmRhLi4zY2Y5MThhYjZl
IDEwMDY0NAotLS0gYS90ZXN0cy90ZXN0LXFtcC1jbWRzLmMKKysrIGIvdGVzdHMvdGVzdC1xbXAt
Y21kcy5jCkBAIC0yNCwxNCArMjQsMTcgQEAgVXNlckRlZlRocmVlICpxbXBfVGVzdENtZFJldHVy
bkRlZlRocmVlKEVycm9yICoqZXJycCkKIAogdm9pZCBxbXBfdXNlcl9kZWZfY21kKEVycm9yICoq
ZXJycCkKIHsKKwlFUlJQX0ZVTkNUSU9OX0JFR0lOKCk7CiB9CiAKIHZvaWQgcW1wX3Rlc3RfZmxh
Z3NfY29tbWFuZChFcnJvciAqKmVycnApCiB7CisJRVJSUF9GVU5DVElPTl9CRUdJTigpOwogfQog
CiB2b2lkIHFtcF9jbWRfc3VjY2Vzc19yZXNwb25zZShFcnJvciAqKmVycnApCiB7CisJRVJSUF9G
VU5DVElPTl9CRUdJTigpOwogfQogCiBFbXB0eTIgKnFtcF91c2VyX2RlZl9jbWQwKEVycm9yICoq
ZXJycCkKQEAgLTQxLDYgKzQ0LDcgQEAgRW1wdHkyICpxbXBfdXNlcl9kZWZfY21kMChFcnJvciAq
KmVycnApCiAKIHZvaWQgcW1wX3VzZXJfZGVmX2NtZDEoVXNlckRlZk9uZSAqIHVkMSwgRXJyb3Ig
KiplcnJwKQogeworCUVSUlBfRlVOQ1RJT05fQkVHSU4oKTsKIH0KIAogdm9pZCBxbXBfdGVzdF9m
ZWF0dXJlcyhGZWF0dXJlU3RydWN0MCAqZnMwLCBGZWF0dXJlU3RydWN0MSAqZnMxLApAQCAtNDks
NiArNTMsNyBAQCB2b2lkIHFtcF90ZXN0X2ZlYXR1cmVzKEZlYXR1cmVTdHJ1Y3QwICpmczAsIEZl
YXR1cmVTdHJ1Y3QxICpmczEsCiAgICAgICAgICAgICAgICAgICAgICAgIENvbmRGZWF0dXJlU3Ry
dWN0MiAqY2ZzMiwgQ29uZEZlYXR1cmVTdHJ1Y3QzICpjZnMzLAogICAgICAgICAgICAgICAgICAg
ICAgICBFcnJvciAqKmVycnApCiB7CisJRVJSUF9GVU5DVElPTl9CRUdJTigpOwogfQogCiBVc2Vy
RGVmVHdvICpxbXBfdXNlcl9kZWZfY21kMihVc2VyRGVmT25lICp1ZDFhLApAQCAtOTEsMTAgKzk2
LDEyIEBAIFFPYmplY3QgKnFtcF9ndWVzdF9zeW5jKFFPYmplY3QgKmFyZywgRXJyb3IgKiplcnJw
KQogCiB2b2lkIHFtcF9ib3hlZF9zdHJ1Y3QoVXNlckRlZlplcm8gKmFyZywgRXJyb3IgKiplcnJw
KQogeworCUVSUlBfRlVOQ1RJT05fQkVHSU4oKTsKIH0KIAogdm9pZCBxbXBfYm94ZWRfdW5pb24o
VXNlckRlZkxpc3RVbmlvbiAqYXJnLCBFcnJvciAqKmVycnApCiB7CisJRVJSUF9GVU5DVElPTl9C
RUdJTigpOwogfQogCiBfX29yZ19xZW11X3hfVW5pb24xICpxbXBfX19vcmdfcWVtdV94X2NvbW1h
bmQoX19vcmdfcWVtdV94X0VudW1MaXN0ICphLApkaWZmIC0tZ2l0IGEvdHBtLmMgYi90cG0uYwpp
bmRleCA5YzllMjBiYmI3Li5hM2EwZWI3NmYwIDEwMDY0NAotLS0gYS90cG0uYworKysgYi90cG0u
YwpAQCAtODUsNyArODUsNiBAQCBzdGF0aWMgaW50IHRwbV9pbml0X3RwbWRldih2b2lkICpkdW1t
eSwgUWVtdU9wdHMgKm9wdHMsIEVycm9yICoqZXJycCkKICAgICBjb25zdCBjaGFyICppZDsKICAg
ICBjb25zdCBUUE1CYWNrZW5kQ2xhc3MgKmJlOwogICAgIFRQTUJhY2tlbmQgKmRydjsKLSAgICBF
cnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBpbnQgaTsKIAogICAgIGlmICghUUxJU1RfRU1Q
VFkoJnRwbV9iYWNrZW5kcykpIHsKQEAgLTExNiw5ICsxMTUsOCBAQCBzdGF0aWMgaW50IHRwbV9p
bml0X3RwbWRldih2b2lkICpkdW1teSwgUWVtdU9wdHMgKm9wdHMsIEVycm9yICoqZXJycCkKICAg
ICB9CiAKICAgICAvKiB2YWxpZGF0ZSBiYWNrZW5kIHNwZWNpZmljIG9wdHMgKi8KLSAgICBxZW11
X29wdHNfdmFsaWRhdGUob3B0cywgYmUtPm9wdHMsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2Nh
bF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAg
cWVtdV9vcHRzX3ZhbGlkYXRlKG9wdHMsIGJlLT5vcHRzLCBlcnJwKTsKKyAgICBpZiAoKmVycnAp
IHsKICAgICAgICAgcmV0dXJuIDE7CiAgICAgfQogCmRpZmYgLS1naXQgYS90cmFjZS9xbXAuYyBi
L3RyYWNlL3FtcC5jCmluZGV4IDM4MjQ2ZTFhYTYuLjFmYzE5ZDJlYjAgMTAwNjQ0Ci0tLSBhL3Ry
YWNlL3FtcC5jCisrKyBiL3RyYWNlL3FtcC5jCkBAIC03MCw3ICs3MCw2IEBAIFRyYWNlRXZlbnRJ
bmZvTGlzdCAqcW1wX3RyYWNlX2V2ZW50X2dldF9zdGF0ZShjb25zdCBjaGFyICpuYW1lLAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2wgaGFzX3ZjcHUs
IGludDY0X3QgdmNwdSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7CiAgICAgVHJhY2VF
dmVudEluZm9MaXN0ICpldmVudHMgPSBOVUxMOwogICAgIFRyYWNlRXZlbnRJdGVyIGl0ZXI7CiAg
ICAgVHJhY2VFdmVudCAqZXY7CkBAIC03OCw5ICs3Nyw4IEBAIFRyYWNlRXZlbnRJbmZvTGlzdCAq
cW1wX3RyYWNlX2V2ZW50X2dldF9zdGF0ZShjb25zdCBjaGFyICpuYW1lLAogICAgIENQVVN0YXRl
ICpjcHU7CiAKICAgICAvKiBDaGVjayBwcm92aWRlZCB2Y3B1ICovCi0gICAgY3B1ID0gZ2V0X2Nw
dShoYXNfdmNwdSwgdmNwdSwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBlcnJvcl9w
cm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICBjcHUgPSBnZXRfY3B1KGhhc192Y3B1LCB2Y3B1LCBl
cnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAgfQogCkBA
IC0xMzUsMTYgKzEzMywxNCBAQCB2b2lkIHFtcF90cmFjZV9ldmVudF9zZXRfc3RhdGUoY29uc3Qg
Y2hhciAqbmFtZSwgYm9vbCBlbmFibGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
Ym9vbCBoYXNfdmNwdSwgaW50NjRfdCB2Y3B1LAogICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIEVycm9yICoqZXJycCkKIHsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKICAgICBUcmFjZUV2
ZW50SXRlciBpdGVyOwogICAgIFRyYWNlRXZlbnQgKmV2OwogICAgIGJvb2wgaXNfcGF0dGVybiA9
IHRyYWNlX2V2ZW50X2lzX3BhdHRlcm4obmFtZSk7CiAgICAgQ1BVU3RhdGUgKmNwdTsKIAogICAg
IC8qIENoZWNrIHByb3ZpZGVkIHZjcHUgKi8KLSAgICBjcHUgPSBnZXRfY3B1KGhhc192Y3B1LCB2
Y3B1LCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJw
LCBlcnIpOworICAgIGNwdSA9IGdldF9jcHUoaGFzX3ZjcHUsIHZjcHUsIGVycnApOworICAgIGlm
ICgqZXJycCkgewogICAgICAgICByZXR1cm47CiAgICAgfQogCmRpZmYgLS1naXQgYS91aS9pbnB1
dC1iYXJyaWVyLmMgYi91aS9pbnB1dC1iYXJyaWVyLmMKaW5kZXggYTJjOTYxZjI4NS4uODQ0OTE3
NDRjNSAxMDA2NDQKLS0tIGEvdWkvaW5wdXQtYmFycmllci5jCisrKyBiL3VpL2lucHV0LWJhcnJp
ZXIuYwpAQCAtNDkzLDcgKzQ5Myw2IEBAIHN0YXRpYyBnYm9vbGVhbiBpbnB1dF9iYXJyaWVyX2V2
ZW50KFFJT0NoYW5uZWwgKmlvYyBHX0dOVUNfVU5VU0VELAogc3RhdGljIHZvaWQgaW5wdXRfYmFy
cmllcl9jb21wbGV0ZShVc2VyQ3JlYXRhYmxlICp1YywgRXJyb3IgKiplcnJwKQogewogICAgIElu
cHV0QmFycmllciAqaWIgPSBJTlBVVF9CQVJSSUVSKHVjKTsKLSAgICBFcnJvciAqbG9jYWxfZXJy
ID0gTlVMTDsKIAogICAgIGlmICghaWItPm5hbWUpIHsKICAgICAgICAgZXJyb3Jfc2V0ZyhlcnJw
LCBRRVJSX01JU1NJTkdfUEFSQU1FVEVSLCAibmFtZSIpOwpAQCAtNTA5LDkgKzUwOCw4IEBAIHN0
YXRpYyB2b2lkIGlucHV0X2JhcnJpZXJfY29tcGxldGUoVXNlckNyZWF0YWJsZSAqdWMsIEVycm9y
ICoqZXJycCkKICAgICBpYi0+c2lvYyA9IHFpb19jaGFubmVsX3NvY2tldF9uZXcoKTsKICAgICBx
aW9fY2hhbm5lbF9zZXRfbmFtZShRSU9fQ0hBTk5FTChpYi0+c2lvYyksICJiYXJyaWVyLWNsaWVu
dCIpOwogCi0gICAgcWlvX2NoYW5uZWxfc29ja2V0X2Nvbm5lY3Rfc3luYyhpYi0+c2lvYywgJmli
LT5zYWRkciwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJv
cl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBxaW9fY2hhbm5lbF9zb2NrZXRfY29u
bmVjdF9zeW5jKGliLT5zaW9jLCAmaWItPnNhZGRyLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsK
ICAgICAgICAgcmV0dXJuOwogICAgIH0KIApkaWZmIC0tZ2l0IGEvdWkvaW5wdXQuYyBiL3VpL2lu
cHV0LmMKaW5kZXggNDc5MWIwODljNy4uMjc2YzM0OTAwZSAxMDA2NDQKLS0tIGEvdWkvaW5wdXQu
YworKysgYi91aS9pbnB1dC5jCkBAIC04OCwxMSArODgsOSBAQCB2b2lkIHFlbXVfaW5wdXRfaGFu
ZGxlcl9iaW5kKFFlbXVJbnB1dEhhbmRsZXJTdGF0ZSAqcywKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgRXJyb3IgKiplcnJwKQogewogICAgIFFlbXVDb25zb2xlICpjb247Ci0gICAgRXJy
b3IgKmVyciA9IE5VTEw7CiAKLSAgICBjb24gPSBxZW11X2NvbnNvbGVfbG9va3VwX2J5X2Rldmlj
ZV9uYW1lKGRldmljZV9pZCwgaGVhZCwgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBl
cnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICBjb24gPSBxZW11X2NvbnNvbGVfbG9va3Vw
X2J5X2RldmljZV9uYW1lKGRldmljZV9pZCwgaGVhZCwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7
CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKQEAgLTEzMCwxNiArMTI4LDE0IEBAIHZvaWQgcW1w
X2lucHV0X3NlbmRfZXZlbnQoYm9vbCBoYXNfZGV2aWNlLCBjb25zdCBjaGFyICpkZXZpY2UsCiB7
CiAgICAgSW5wdXRFdmVudExpc3QgKmU7CiAgICAgUWVtdUNvbnNvbGUgKmNvbjsKLSAgICBFcnJv
ciAqZXJyID0gTlVMTDsKIAogICAgIGNvbiA9IE5VTEw7CiAgICAgaWYgKGhhc19kZXZpY2UpIHsK
ICAgICAgICAgaWYgKCFoYXNfaGVhZCkgewogICAgICAgICAgICAgaGVhZCA9IDA7CiAgICAgICAg
IH0KLSAgICAgICAgY29uID0gcWVtdV9jb25zb2xlX2xvb2t1cF9ieV9kZXZpY2VfbmFtZShkZXZp
Y2UsIGhlYWQsICZlcnIpOwotICAgICAgICBpZiAoZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9w
cm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICAgICAgY29uID0gcWVtdV9jb25zb2xlX2xvb2t1cF9i
eV9kZXZpY2VfbmFtZShkZXZpY2UsIGhlYWQsIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsK
ICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQogICAgIH0KZGlmZiAtLWdpdCBhL3VpL3Zu
Yy5jIGIvdWkvdm5jLmMKaW5kZXggOWQ2Mzg0ZDliMS4uMzc3MjFlOTcxYiAxMDA2NDQKLS0tIGEv
dWkvdm5jLmMKKysrIGIvdWkvdm5jLmMKQEAgLTQwMTQsMTEgKzQwMTQsOSBAQCB2b2lkIHZuY19k
aXNwbGF5X29wZW4oY29uc3QgY2hhciAqaWQsIEVycm9yICoqZXJycCkKICAgICBkZXZpY2VfaWQg
PSBxZW11X29wdF9nZXQob3B0cywgImRpc3BsYXkiKTsKICAgICBpZiAoZGV2aWNlX2lkKSB7CiAg
ICAgICAgIGludCBoZWFkID0gcWVtdV9vcHRfZ2V0X251bWJlcihvcHRzLCAiaGVhZCIsIDApOwot
ICAgICAgICBFcnJvciAqZXJyID0gTlVMTDsKIAotICAgICAgICBjb24gPSBxZW11X2NvbnNvbGVf
bG9va3VwX2J5X2RldmljZV9uYW1lKGRldmljZV9pZCwgaGVhZCwgJmVycik7Ci0gICAgICAgIGlm
IChlcnIpIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgICAg
ICBjb24gPSBxZW11X2NvbnNvbGVfbG9va3VwX2J5X2RldmljZV9uYW1lKGRldmljZV9pZCwgaGVh
ZCwgZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgZ290byBmYWlsOwog
ICAgICAgICB9CiAgICAgfSBlbHNlIHsKQEAgLTQxMTIsMTggKzQxMTAsMTUgQEAgUWVtdU9wdHMg
KnZuY19wYXJzZShjb25zdCBjaGFyICpzdHIsIEVycm9yICoqZXJycCkKIAogaW50IHZuY19pbml0
X2Z1bmModm9pZCAqb3BhcXVlLCBRZW11T3B0cyAqb3B0cywgRXJyb3IgKiplcnJwKQogewotICAg
IEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIGNoYXIgKmlkID0gKGNoYXIgKilxZW11X29w
dHNfaWQob3B0cyk7CiAKICAgICBhc3NlcnQoaWQpOwotICAgIHZuY19kaXNwbGF5X2luaXQoaWQs
ICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFn
YXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgdm5jX2Rpc3BsYXlfaW5pdChpZCwgZXJycCk7Cisg
ICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybiAtMTsKICAgICB9Ci0gICAgdm5jX2Rpc3Bs
YXlfb3BlbihpZCwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VyciAhPSBOVUxMKSB7Ci0g
ICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIHZuY19kaXNwbGF5
X29wZW4oaWQsIGVycnApOworICAgIGlmICgqZXJycCAhPSBOVUxMKSB7CiAgICAgICAgIHJldHVy
biAtMTsKICAgICB9CiAgICAgcmV0dXJuIDA7CmRpZmYgLS1naXQgYS91dGlsL21haW4tbG9vcC5j
IGIvdXRpbC9tYWluLWxvb3AuYwppbmRleCBlM2VhYTU1ODY2Li42ZjM0OTJkOTQzIDEwMDY0NAot
LS0gYS91dGlsL21haW4tbG9vcC5jCisrKyBiL3V0aWwvbWFpbi1sb29wLmMKQEAgLTE0Nyw3ICsx
NDcsNiBAQCBpbnQgcWVtdV9pbml0X21haW5fbG9vcChFcnJvciAqKmVycnApCiB7CiAgICAgaW50
IHJldDsKICAgICBHU291cmNlICpzcmM7Ci0gICAgRXJyb3IgKmxvY2FsX2Vycm9yID0gTlVMTDsK
IAogICAgIGluaXRfY2xvY2tzKHFlbXVfdGltZXJfbm90aWZ5X2NiKTsKIApAQCAtMTU2LDkgKzE1
NSw4IEBAIGludCBxZW11X2luaXRfbWFpbl9sb29wKEVycm9yICoqZXJycCkKICAgICAgICAgcmV0
dXJuIHJldDsKICAgICB9CiAKLSAgICBxZW11X2Fpb19jb250ZXh0ID0gYWlvX2NvbnRleHRfbmV3
KCZsb2NhbF9lcnJvcik7CisgICAgcWVtdV9haW9fY29udGV4dCA9IGFpb19jb250ZXh0X25ldyhl
cnJwKTsKICAgICBpZiAoIXFlbXVfYWlvX2NvbnRleHQpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFn
YXRlKGVycnAsIGxvY2FsX2Vycm9yKTsKICAgICAgICAgcmV0dXJuIC1FTUZJTEU7CiAgICAgfQog
ICAgIHFlbXVfbm90aWZ5X2JoID0gcWVtdV9iaF9uZXcobm90aWZ5X2V2ZW50X2NiLCBOVUxMKTsK
ZGlmZiAtLWdpdCBhL3V0aWwvb3NsaWItcG9zaXguYyBiL3V0aWwvb3NsaWItcG9zaXguYwppbmRl
eCBmODY5MzM4NGZjLi5iMTY3MWYxMWU2IDEwMDY0NAotLS0gYS91dGlsL29zbGliLXBvc2l4LmMK
KysrIGIvdXRpbC9vc2xpYi1wb3NpeC5jCkBAIC02MDAsMTAgKzYwMCw5IEBAIHBpZF90IHFlbXVf
Zm9yayhFcnJvciAqKmVycnApCiAgICAgICAgICAqIHByb3BhZ2F0ZSB0aGF0IHRvIGNoaWxkcmVu
ICovCiAgICAgICAgIHNpZ2VtcHR5c2V0KCZuZXdtYXNrKTsKICAgICAgICAgaWYgKHB0aHJlYWRf
c2lnbWFzayhTSUdfU0VUTUFTSywgJm5ld21hc2ssIE5VTEwpICE9IDApIHsKLSAgICAgICAgICAg
IEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwotICAgICAgICAgICAgZXJyb3Jfc2V0Z19lcnJubygm
bG9jYWxfZXJyLCBlcnJubywKKyAgICAgICAgICAgIGVycm9yX3NldGdfZXJybm8oZXJycCwgZXJy
bm8sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJjYW5ub3QgdW5ibG9jayBzaWduYWxz
Iik7Ci0gICAgICAgICAgICBlcnJvcl9yZXBvcnRfZXJyKGxvY2FsX2Vycik7CisgICAgICAgICAg
ICBlcnJvcl9yZXBvcnRfZXJycChlcnJwKTsKICAgICAgICAgICAgIF9leGl0KDEpOwogICAgICAg
ICB9CiAgICAgfQpkaWZmIC0tZ2l0IGEvdXRpbC9xZW11LWNvbmZpZy5jIGIvdXRpbC9xZW11LWNv
bmZpZy5jCmluZGV4IDc3MmY1YTIxOWUuLmIwMjY2Zjk5NTQgMTAwNjQ0Ci0tLSBhL3V0aWwvcWVt
dS1jb25maWcuYworKysgYi91dGlsL3FlbXUtY29uZmlnLmMKQEAgLTQ4MSw3ICs0ODEsNiBAQCBz
dGF0aWMgdm9pZCBjb25maWdfcGFyc2VfcWRpY3Rfc2VjdGlvbihRRGljdCAqb3B0aW9ucywgUWVt
dU9wdHNMaXN0ICpvcHRzLAogICAgIFFlbXVPcHRzICpzdWJvcHRzOwogICAgIFFEaWN0ICpzdWJx
ZGljdDsKICAgICBRTGlzdCAqbGlzdCA9IE5VTEw7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5V
TEw7CiAgICAgc2l6ZV90IG9yaWdfc2l6ZSwgZW51bV9zaXplOwogICAgIGNoYXIgKnByZWZpeDsK
IApAQCAtNDkzLDE1ICs0OTIsMTMgQEAgc3RhdGljIHZvaWQgY29uZmlnX3BhcnNlX3FkaWN0X3Nl
Y3Rpb24oUURpY3QgKm9wdGlvbnMsIFFlbXVPcHRzTGlzdCAqb3B0cywKICAgICAgICAgZ290byBv
dXQ7CiAgICAgfQogCi0gICAgc3Vib3B0cyA9IHFlbXVfb3B0c19jcmVhdGUob3B0cywgTlVMTCwg
MCwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9w
YWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBzdWJvcHRzID0gcWVtdV9vcHRzX2NyZWF0ZShv
cHRzLCBOVUxMLCAwLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ290byBvdXQ7
CiAgICAgfQogCi0gICAgcWVtdV9vcHRzX2Fic29yYl9xZGljdChzdWJvcHRzLCBzdWJxZGljdCwg
JmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdh
dGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBxZW11X29wdHNfYWJzb3JiX3FkaWN0KHN1Ym9wdHMs
IHN1YnFkaWN0LCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ290byBvdXQ7CiAg
ICAgfQogCkBAIC01MzgsMTYgKzUzNSwxNCBAQCBzdGF0aWMgdm9pZCBjb25maWdfcGFyc2VfcWRp
Y3Rfc2VjdGlvbihRRGljdCAqb3B0aW9ucywgUWVtdU9wdHNMaXN0ICpvcHRzLAogICAgICAgICAg
ICAgfQogCiAgICAgICAgICAgICBvcHRfbmFtZSA9IGdfc3RyZHVwX3ByaW50ZigiJXMuJXUiLCBv
cHRzLT5uYW1lLCBpKyspOwotICAgICAgICAgICAgc3Vib3B0cyA9IHFlbXVfb3B0c19jcmVhdGUo
b3B0cywgb3B0X25hbWUsIDEsICZsb2NhbF9lcnIpOworICAgICAgICAgICAgc3Vib3B0cyA9IHFl
bXVfb3B0c19jcmVhdGUob3B0cywgb3B0X25hbWUsIDEsIGVycnApOwogICAgICAgICAgICAgZ19m
cmVlKG9wdF9uYW1lKTsKLSAgICAgICAgICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgICAg
ICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgICAgIGlmICgq
ZXJycCkgewogICAgICAgICAgICAgICAgIGdvdG8gb3V0OwogICAgICAgICAgICAgfQogCi0gICAg
ICAgICAgICBxZW11X29wdHNfYWJzb3JiX3FkaWN0KHN1Ym9wdHMsIHNlY3Rpb24sICZsb2NhbF9l
cnIpOwotICAgICAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICAgICAgICAgIGVycm9y
X3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICAgICAgcWVtdV9vcHRzX2Fic29y
Yl9xZGljdChzdWJvcHRzLCBzZWN0aW9uLCBlcnJwKTsKKyAgICAgICAgICAgIGlmICgqZXJycCkg
ewogICAgICAgICAgICAgICAgIHFlbXVfb3B0c19kZWwoc3Vib3B0cyk7CiAgICAgICAgICAgICAg
ICAgZ290byBvdXQ7CiAgICAgICAgICAgICB9CkBAIC01NzAsMTIgKzU2NSwxMCBAQCB2b2lkIHFl
bXVfY29uZmlnX3BhcnNlX3FkaWN0KFFEaWN0ICpvcHRpb25zLCBRZW11T3B0c0xpc3QgKipsaXN0
cywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJwKQogewogICAgIGlu
dCBpOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgZm9yIChpID0gMDsgbGlz
dHNbaV07IGkrKykgewotICAgICAgICBjb25maWdfcGFyc2VfcWRpY3Rfc2VjdGlvbihvcHRpb25z
LCBsaXN0c1tpXSwgJmxvY2FsX2Vycik7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAg
ICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICBjb25maWdf
cGFyc2VfcWRpY3Rfc2VjdGlvbihvcHRpb25zLCBsaXN0c1tpXSwgZXJycCk7CisgICAgICAgIGlm
ICgqZXJycCkgewogICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgfQpkaWZmIC0t
Z2l0IGEvdXRpbC9xZW11LW9wdGlvbi5jIGIvdXRpbC9xZW11LW9wdGlvbi5jCmluZGV4IDk3MTcy
YjVlYWEuLjI2MWIzNDdlODMgMTAwNjQ0Ci0tLSBhL3V0aWwvcWVtdS1vcHRpb24uYworKysgYi91
dGlsL3FlbXUtb3B0aW9uLmMKQEAgLTU0Myw3ICs1NDMsNiBAQCBzdGF0aWMgdm9pZCBvcHRfc2V0
KFFlbXVPcHRzICpvcHRzLCBjb25zdCBjaGFyICpuYW1lLCBjaGFyICp2YWx1ZSwKIHsKICAgICBR
ZW11T3B0ICpvcHQ7CiAgICAgY29uc3QgUWVtdU9wdERlc2MgKmRlc2M7Ci0gICAgRXJyb3IgKmxv
Y2FsX2VyciA9IE5VTEw7CiAKICAgICBkZXNjID0gZmluZF9kZXNjX2J5X25hbWUob3B0cy0+bGlz
dC0+ZGVzYywgbmFtZSk7CiAgICAgaWYgKCFkZXNjICYmICFvcHRzX2FjY2VwdHNfYW55KG9wdHMp
KSB7CkBAIC01NjUsOSArNTY0LDggQEAgc3RhdGljIHZvaWQgb3B0X3NldChRZW11T3B0cyAqb3B0
cywgY29uc3QgY2hhciAqbmFtZSwgY2hhciAqdmFsdWUsCiAgICAgfQogICAgIG9wdC0+ZGVzYyA9
IGRlc2M7CiAgICAgb3B0LT5zdHIgPSB2YWx1ZTsKLSAgICBxZW11X29wdF9wYXJzZShvcHQsICZs
b2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRl
KGVycnAsIGxvY2FsX2Vycik7CisgICAgcWVtdV9vcHRfcGFyc2Uob3B0LCBlcnJwKTsKKyAgICBp
ZiAoKmVycnApIHsKICAgICAgICAgcWVtdV9vcHRfZGVsKG9wdCk7CiAgICAgfQogfQpAQCAtNzEy
LDExICs3MTAsOSBAQCB2b2lkIHFlbXVfb3B0c19zZXQoUWVtdU9wdHNMaXN0ICpsaXN0LCBjb25z
dCBjaGFyICppZCwKICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGFyICpuYW1lLCBjb25zdCBj
aGFyICp2YWx1ZSwgRXJyb3IgKiplcnJwKQogewogICAgIFFlbXVPcHRzICpvcHRzOwotICAgIEVy
cm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCi0gICAgb3B0cyA9IHFlbXVfb3B0c19jcmVhdGUobGlz
dCwgaWQsIDEsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJy
b3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgb3B0cyA9IHFlbXVfb3B0c19jcmVh
dGUobGlzdCwgaWQsIDEsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICByZXR1cm47
CiAgICAgfQogICAgIHFlbXVfb3B0X3NldChvcHRzLCBuYW1lLCB2YWx1ZSwgZXJycCk7CkBAIC04
MTIsNyArODA4LDYgQEAgc3RhdGljIHZvaWQgb3B0c19kb19wYXJzZShRZW11T3B0cyAqb3B0cywg
Y29uc3QgY2hhciAqcGFyYW1zLAogICAgIGNoYXIgKm9wdGlvbiA9IE5VTEw7CiAgICAgY2hhciAq
dmFsdWUgPSBOVUxMOwogICAgIGNvbnN0IGNoYXIgKnAsKnBlLCpwYzsKLSAgICBFcnJvciAqbG9j
YWxfZXJyID0gTlVMTDsKIAogICAgIGZvciAocCA9IHBhcmFtczsgKnAgIT0gJ1wwJzsgcCsrKSB7
CiAgICAgICAgIHBlID0gc3RyY2hyKHAsICc9Jyk7CkBAIC04NDIsMTAgKzgzNyw5IEBAIHN0YXRp
YyB2b2lkIG9wdHNfZG9fcGFyc2UoUWVtdU9wdHMgKm9wdHMsIGNvbnN0IGNoYXIgKnBhcmFtcywK
ICAgICAgICAgfQogICAgICAgICBpZiAoc3RyY21wKG9wdGlvbiwgImlkIikgIT0gMCkgewogICAg
ICAgICAgICAgLyogc3RvcmUgYW5kIHBhcnNlICovCi0gICAgICAgICAgICBvcHRfc2V0KG9wdHMs
IG9wdGlvbiwgdmFsdWUsIHByZXBlbmQsIGludmFsaWRwLCAmbG9jYWxfZXJyKTsKKyAgICAgICAg
ICAgIG9wdF9zZXQob3B0cywgb3B0aW9uLCB2YWx1ZSwgcHJlcGVuZCwgaW52YWxpZHAsIGVycnAp
OwogICAgICAgICAgICAgdmFsdWUgPSBOVUxMOwotICAgICAgICAgICAgaWYgKGxvY2FsX2Vycikg
ewotICAgICAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAg
ICAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICAgICAgZ290byBjbGVhbnVwOwogICAg
ICAgICAgICAgfQogICAgICAgICB9CkBAIC04ODIsNyArODc2LDYgQEAgc3RhdGljIFFlbXVPcHRz
ICpvcHRzX3BhcnNlKFFlbXVPcHRzTGlzdCAqbGlzdCwgY29uc3QgY2hhciAqcGFyYW1zLAogICAg
IGNoYXIgKmlkID0gTlVMTDsKICAgICBjb25zdCBjaGFyICpwOwogICAgIFFlbXVPcHRzICpvcHRz
OwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgYXNzZXJ0KCFwZXJtaXRfYWJi
cmV2IHx8IGxpc3QtPmltcGxpZWRfb3B0X25hbWUpOwogICAgIGZpcnN0bmFtZSA9IHBlcm1pdF9h
YmJyZXYgPyBsaXN0LT5pbXBsaWVkX29wdF9uYW1lIDogTlVMTDsKQEAgLTkwMSwxNiArODk0LDE0
IEBAIHN0YXRpYyBRZW11T3B0cyAqb3B0c19wYXJzZShRZW11T3B0c0xpc3QgKmxpc3QsIGNvbnN0
IGNoYXIgKnBhcmFtcywKICAgICAgKiAoaWYgdW5saWtlbHkpIGZ1dHVyZSBtaXN1c2U6CiAgICAg
ICovCiAgICAgYXNzZXJ0KCFkZWZhdWx0cyB8fCBsaXN0LT5tZXJnZV9saXN0cyk7Ci0gICAgb3B0
cyA9IHFlbXVfb3B0c19jcmVhdGUobGlzdCwgaWQsICFkZWZhdWx0cywgJmxvY2FsX2Vycik7Cisg
ICAgb3B0cyA9IHFlbXVfb3B0c19jcmVhdGUobGlzdCwgaWQsICFkZWZhdWx0cywgZXJycCk7CiAg
ICAgZ19mcmVlKGlkKTsKICAgICBpZiAob3B0cyA9PSBOVUxMKSB7Ci0gICAgICAgIGVycm9yX3By
b3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogICAgICAgICByZXR1cm4gTlVMTDsKICAgICB9CiAK
LSAgICBvcHRzX2RvX3BhcnNlKG9wdHMsIHBhcmFtcywgZmlyc3RuYW1lLCBkZWZhdWx0cywgaW52
YWxpZHAsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3Jf
cHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgb3B0c19kb19wYXJzZShvcHRzLCBwYXJh
bXMsIGZpcnN0bmFtZSwgZGVmYXVsdHMsIGludmFsaWRwLCBlcnJwKTsKKyAgICBpZiAoKmVycnAp
IHsKICAgICAgICAgcWVtdV9vcHRzX2RlbChvcHRzKTsKICAgICAgICAgcmV0dXJuIE5VTEw7CiAg
ICAgfQpAQCAtMTAxMywyMyArMTAwNCwyMCBAQCBRZW11T3B0cyAqcWVtdV9vcHRzX2Zyb21fcWRp
Y3QoUWVtdU9wdHNMaXN0ICpsaXN0LCBjb25zdCBRRGljdCAqcWRpY3QsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJwKQogewogICAgIE9wdHNGcm9tUURpY3RTdGF0
ZSBzdGF0ZTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBRZW11T3B0cyAqb3B0
czsKIAogICAgIG9wdHMgPSBxZW11X29wdHNfY3JlYXRlKGxpc3QsIHFkaWN0X2dldF90cnlfc3Ry
KHFkaWN0LCAiaWQiKSwgMSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAmbG9jYWxfZXJy
KTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBs
b2NhbF9lcnIpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycnApOworICAgIGlmICgq
ZXJycCkgewogICAgICAgICByZXR1cm4gTlVMTDsKICAgICB9CiAKICAgICBhc3NlcnQob3B0cyAh
PSBOVUxMKTsKIAotICAgIHN0YXRlLmVycnAgPSAmbG9jYWxfZXJyOworICAgIHN0YXRlLmVycnAg
PSBlcnJwOwogICAgIHN0YXRlLm9wdHMgPSBvcHRzOwogICAgIHFkaWN0X2l0ZXIocWRpY3QsIHFl
bXVfb3B0c19mcm9tX3FkaWN0XzEsICZzdGF0ZSk7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAg
ICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICBpZiAoKmVycnApIHsK
ICAgICAgICAgcWVtdV9vcHRzX2RlbChvcHRzKTsKICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAg
fQpAQCAtMTA0OSw5ICsxMDM3LDggQEAgdm9pZCBxZW11X29wdHNfYWJzb3JiX3FkaWN0KFFlbXVP
cHRzICpvcHRzLCBRRGljdCAqcWRpY3QsIEVycm9yICoqZXJycCkKICAgICBlbnRyeSA9IHFkaWN0
X2ZpcnN0KHFkaWN0KTsKIAogICAgIHdoaWxlIChlbnRyeSAhPSBOVUxMKSB7Ci0gICAgICAgIEVy
cm9yICpsb2NhbF9lcnIgPSBOVUxMOwogICAgICAgICBPcHRzRnJvbVFEaWN0U3RhdGUgc3RhdGUg
PSB7Ci0gICAgICAgICAgICAuZXJycCA9ICZsb2NhbF9lcnIsCisgICAgICAgICAgICAuZXJycCA9
IGVycnAsCiAgICAgICAgICAgICAub3B0cyA9IG9wdHMsCiAgICAgICAgIH07CiAKQEAgLTEwNTks
OCArMTA0Niw3IEBAIHZvaWQgcWVtdV9vcHRzX2Fic29yYl9xZGljdChRZW11T3B0cyAqb3B0cywg
UURpY3QgKnFkaWN0LCBFcnJvciAqKmVycnApCiAKICAgICAgICAgaWYgKGZpbmRfZGVzY19ieV9u
YW1lKG9wdHMtPmxpc3QtPmRlc2MsIGVudHJ5LT5rZXkpKSB7CiAgICAgICAgICAgICBxZW11X29w
dHNfZnJvbV9xZGljdF8xKGVudHJ5LT5rZXksIGVudHJ5LT52YWx1ZSwgJnN0YXRlKTsKLSAgICAg
ICAgICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUo
ZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAg
ICAgIHJldHVybjsKICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgcWRpY3Rf
ZGVsKHFkaWN0LCBlbnRyeS0+a2V5KTsKQEAgLTExMzEsNyArMTExNyw2IEBAIFFEaWN0ICpxZW11
X29wdHNfdG9fcWRpY3QoUWVtdU9wdHMgKm9wdHMsIFFEaWN0ICpxZGljdCkKIHZvaWQgcWVtdV9v
cHRzX3ZhbGlkYXRlKFFlbXVPcHRzICpvcHRzLCBjb25zdCBRZW11T3B0RGVzYyAqZGVzYywgRXJy
b3IgKiplcnJwKQogewogICAgIFFlbXVPcHQgKm9wdDsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0g
TlVMTDsKIAogICAgIGFzc2VydChvcHRzX2FjY2VwdHNfYW55KG9wdHMpKTsKIApAQCAtMTE0Miw5
ICsxMTI3LDggQEAgdm9pZCBxZW11X29wdHNfdmFsaWRhdGUoUWVtdU9wdHMgKm9wdHMsIGNvbnN0
IFFlbXVPcHREZXNjICpkZXNjLCBFcnJvciAqKmVycnApCiAgICAgICAgICAgICByZXR1cm47CiAg
ICAgICAgIH0KIAotICAgICAgICBxZW11X29wdF9wYXJzZShvcHQsICZsb2NhbF9lcnIpOwotICAg
ICAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwg
bG9jYWxfZXJyKTsKKyAgICAgICAgcWVtdV9vcHRfcGFyc2Uob3B0LCBlcnJwKTsKKyAgICAgICAg
aWYgKCplcnJwKSB7CiAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgIH0KICAgICB9CmRpZmYg
LS1naXQgYS91dGlsL3FlbXUtc29ja2V0cy5jIGIvdXRpbC9xZW11LXNvY2tldHMuYwppbmRleCA5
OGZmM2ExY2NlLi45ODMyZDgyNzhkIDEwMDY0NAotLS0gYS91dGlsL3FlbXUtc29ja2V0cy5jCisr
KyBiL3V0aWwvcWVtdS1zb2NrZXRzLmMKQEAgLTIxOSw3ICsyMTksNiBAQCBzdGF0aWMgaW50IGlu
ZXRfbGlzdGVuX3NhZGRyKEluZXRTb2NrZXRBZGRyZXNzICpzYWRkciwKICAgICBpbnQgc2xpc3Rl
biA9IC0xOwogICAgIGludCBzYXZlZF9lcnJubyA9IDA7CiAgICAgYm9vbCBzb2NrZXRfY3JlYXRl
ZCA9IGZhbHNlOwotICAgIEVycm9yICplcnIgPSBOVUxMOwogCiAgICAgaWYgKHNhZGRyLT5rZWVw
X2FsaXZlKSB7CiAgICAgICAgIGVycm9yX3NldGcoZXJycCwgImtlZXAtYWxpdmUgb3B0aW9uIGlz
IG5vdCBzdXBwb3J0ZWQgZm9yIHBhc3NpdmUgIgpAQCAtMjMyLDExICsyMzEsMTAgQEAgc3RhdGlj
IGludCBpbmV0X2xpc3Rlbl9zYWRkcihJbmV0U29ja2V0QWRkcmVzcyAqc2FkZHIsCiAgICAgaWYg
KHNhZGRyLT5oYXNfbnVtZXJpYyAmJiBzYWRkci0+bnVtZXJpYykgewogICAgICAgICBhaS5haV9m
bGFncyB8PSBBSV9OVU1FUklDSE9TVCB8IEFJX05VTUVSSUNTRVJWOwogICAgIH0KLSAgICBhaS5h
aV9mYW1pbHkgPSBpbmV0X2FpX2ZhbWlseV9mcm9tX2FkZHJlc3Moc2FkZHIsICZlcnIpOworICAg
IGFpLmFpX2ZhbWlseSA9IGluZXRfYWlfZmFtaWx5X2Zyb21fYWRkcmVzcyhzYWRkciwgZXJycCk7
CiAgICAgYWkuYWlfc29ja3R5cGUgPSBTT0NLX1NUUkVBTTsKIAotICAgIGlmIChlcnIpIHsKLSAg
ICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgaWYgKCplcnJwKSB7CiAgICAg
ICAgIHJldHVybiAtMTsKICAgICB9CiAKQEAgLTM4OSw3ICszODcsNiBAQCBzdGF0aWMgc3RydWN0
IGFkZHJpbmZvICppbmV0X3BhcnNlX2Nvbm5lY3Rfc2FkZHIoSW5ldFNvY2tldEFkZHJlc3MgKnNh
ZGRyLAogewogICAgIHN0cnVjdCBhZGRyaW5mbyBhaSwgKnJlczsKICAgICBpbnQgcmM7Ci0gICAg
RXJyb3IgKmVyciA9IE5VTEw7CiAgICAgc3RhdGljIGludCB1c2VWNE1hcHBlZCA9IDE7CiAKICAg
ICBtZW1zZXQoJmFpLCAwLCBzaXplb2YoYWkpKTsKQEAgLTM5OCwxMSArMzk1LDEwIEBAIHN0YXRp
YyBzdHJ1Y3QgYWRkcmluZm8gKmluZXRfcGFyc2VfY29ubmVjdF9zYWRkcihJbmV0U29ja2V0QWRk
cmVzcyAqc2FkZHIsCiAgICAgaWYgKGF0b21pY19yZWFkKCZ1c2VWNE1hcHBlZCkpIHsKICAgICAg
ICAgYWkuYWlfZmxhZ3MgfD0gQUlfVjRNQVBQRUQ7CiAgICAgfQotICAgIGFpLmFpX2ZhbWlseSA9
IGluZXRfYWlfZmFtaWx5X2Zyb21fYWRkcmVzcyhzYWRkciwgJmVycik7CisgICAgYWkuYWlfZmFt
aWx5ID0gaW5ldF9haV9mYW1pbHlfZnJvbV9hZGRyZXNzKHNhZGRyLCBlcnJwKTsKICAgICBhaS5h
aV9zb2NrdHlwZSA9IFNPQ0tfU1RSRUFNOwogCi0gICAgaWYgKGVycikgewotICAgICAgICBlcnJv
cl9wcm9wYWdhdGUoZXJycCwgZXJyKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgcmV0dXJu
IE5VTEw7CiAgICAgfQogCkBAIC00NDMsNyArNDM5LDYgQEAgc3RhdGljIHN0cnVjdCBhZGRyaW5m
byAqaW5ldF9wYXJzZV9jb25uZWN0X3NhZGRyKEluZXRTb2NrZXRBZGRyZXNzICpzYWRkciwKICAq
LwogaW50IGluZXRfY29ubmVjdF9zYWRkcihJbmV0U29ja2V0QWRkcmVzcyAqc2FkZHIsIEVycm9y
ICoqZXJycCkKIHsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICBzdHJ1Y3QgYWRk
cmluZm8gKnJlcywgKmU7CiAgICAgaW50IHNvY2sgPSAtMTsKIApAQCAtNDUzLDE2ICs0NDgsMTQg
QEAgaW50IGluZXRfY29ubmVjdF9zYWRkcihJbmV0U29ja2V0QWRkcmVzcyAqc2FkZHIsIEVycm9y
ICoqZXJycCkKICAgICB9CiAKICAgICBmb3IgKGUgPSByZXM7IGUgIT0gTlVMTDsgZSA9IGUtPmFp
X25leHQpIHsKLSAgICAgICAgZXJyb3JfZnJlZShsb2NhbF9lcnIpOwotICAgICAgICBsb2NhbF9l
cnIgPSBOVUxMOwotICAgICAgICBzb2NrID0gaW5ldF9jb25uZWN0X2FkZHIoZSwgJmxvY2FsX2Vy
cik7CisgICAgICAgIGVycm9yX2ZyZWVfZXJycChlcnJwKTsKKyAgICAgICAgc29jayA9IGluZXRf
Y29ubmVjdF9hZGRyKGUsIGVycnApOwogICAgICAgICBpZiAoc29jayA+PSAwKSB7CiAgICAgICAg
ICAgICBicmVhazsKICAgICAgICAgfQogICAgIH0KIAogICAgIGlmIChzb2NrIDwgMCkgewotICAg
ICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKICAgICB9CiAKICAgICBmcmVl
YWRkcmluZm8ocmVzKTsKQEAgLTQ5MCwxNiArNDgzLDE0IEBAIHN0YXRpYyBpbnQgaW5ldF9kZ3Jh
bV9zYWRkcihJbmV0U29ja2V0QWRkcmVzcyAqc3JhZGRyLAogICAgIGNvbnN0IGNoYXIgKmFkZHI7
CiAgICAgY29uc3QgY2hhciAqcG9ydDsKICAgICBpbnQgc29jayA9IC0xLCByYzsKLSAgICBFcnJv
ciAqZXJyID0gTlVMTDsKIAogICAgIC8qIGxvb2t1cCBwZWVyIGFkZHIgKi8KICAgICBtZW1zZXQo
JmFpLDAsIHNpemVvZihhaSkpOwogICAgIGFpLmFpX2ZsYWdzID0gQUlfQ0FOT05OQU1FIHwgQUlf
VjRNQVBQRUQgfCBBSV9BRERSQ09ORklHOwotICAgIGFpLmFpX2ZhbWlseSA9IGluZXRfYWlfZmFt
aWx5X2Zyb21fYWRkcmVzcyhzcmFkZHIsICZlcnIpOworICAgIGFpLmFpX2ZhbWlseSA9IGluZXRf
YWlfZmFtaWx5X2Zyb21fYWRkcmVzcyhzcmFkZHIsIGVycnApOwogICAgIGFpLmFpX3NvY2t0eXBl
ID0gU09DS19ER1JBTTsKIAotICAgIGlmIChlcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRl
KGVycnAsIGVycik7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8gZXJyOwogICAgIH0K
IApkaWZmIC0tZ2l0IGEvdmwuYyBiL3ZsLmMKaW5kZXggNjMwZjVjNWU5Yy4uMjFmNTY3OTk2NCAx
MDA2NDQKLS0tIGEvdmwuYworKysgYi92bC5jCkBAIC0yMjEzLDExICsyMjEzLDggQEAgc3RhdGlj
IGludCBkZXZpY2VfaW5pdF9mdW5jKHZvaWQgKm9wYXF1ZSwgUWVtdU9wdHMgKm9wdHMsIEVycm9y
ICoqZXJycCkKIAogc3RhdGljIGludCBjaGFyZGV2X2luaXRfZnVuYyh2b2lkICpvcGFxdWUsIFFl
bXVPcHRzICpvcHRzLCBFcnJvciAqKmVycnApCiB7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5V
TEw7Ci0KLSAgICBpZiAoIXFlbXVfY2hyX25ld19mcm9tX29wdHMob3B0cywgTlVMTCwgJmxvY2Fs
X2VycikpIHsKLSAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICAgICAgZXJyb3JfcHJv
cGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgaWYgKCFxZW11X2Nocl9uZXdfZnJvbV9vcHRz
KG9wdHMsIE5VTEwsIGVycnApKSB7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAg
cmV0dXJuIC0xOwogICAgICAgICB9CiAgICAgICAgIGV4aXQoMCk7CkBAIC0yNjE0LDcgKzI2MTEs
NiBAQCBzdGF0aWMgaW50IG1hY2hpbmVfc2V0X3Byb3BlcnR5KHZvaWQgKm9wYXF1ZSwKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJwKQogewogICAgIE9iamVjdCAq
b2JqID0gT0JKRUNUKG9wYXF1ZSk7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAg
Y2hhciAqcCwgKnFvbV9uYW1lOwogCiAgICAgaWYgKHN0cmNtcChuYW1lLCAidHlwZSIpID09IDAp
IHsKQEAgLTI2MjgsMTEgKzI2MjQsMTAgQEAgc3RhdGljIGludCBtYWNoaW5lX3NldF9wcm9wZXJ0
eSh2b2lkICpvcGFxdWUsCiAgICAgICAgIH0KICAgICB9CiAKLSAgICBvYmplY3RfcHJvcGVydHlf
cGFyc2Uob2JqLCB2YWx1ZSwgcW9tX25hbWUsICZsb2NhbF9lcnIpOworICAgIG9iamVjdF9wcm9w
ZXJ0eV9wYXJzZShvYmosIHZhbHVlLCBxb21fbmFtZSwgZXJycCk7CiAgICAgZ19mcmVlKHFvbV9u
YW1lKTsKIAotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVy
cnAsIGxvY2FsX2Vycik7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHJldHVybiAtMTsKICAg
ICB9CiAKLS0gCjIuMjEuMAoKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2pl
Y3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4t
ZGV2ZWw=

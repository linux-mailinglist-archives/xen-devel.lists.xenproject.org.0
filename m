Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id D70156A342
	for <lists+xen-devel@lfdr.de>; Tue, 16 Jul 2019 09:50:09 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hnIBn-0002s2-GY; Tue, 16 Jul 2019 07:47:55 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=LiPz=VN=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1hnIBl-0002ru-Rs
 for xen-devel@lists.xenproject.org; Tue, 16 Jul 2019 07:47:53 +0000
X-Inumbo-ID: 00c564e0-a79e-11e9-a42a-23f5b4669daa
Received: from m9a0002g.houston.softwaregrp.com (unknown [15.124.64.67])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 00c564e0-a79e-11e9-a42a-23f5b4669daa;
 Tue, 16 Jul 2019 07:47:48 +0000 (UTC)
Received: FROM m9a0002g.houston.softwaregrp.com (15.121.0.190) BY
 m9a0002g.houston.softwaregrp.com WITH ESMTP; 
 Tue, 16 Jul 2019 07:47:47 +0000
Received: from M4W0334.microfocus.com (2002:f78:1192::f78:1192) by
 M9W0067.microfocus.com (2002:f79:be::f79:be) with Microsoft SMTP Server
 (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256) id
 15.1.1591.10; Tue, 16 Jul 2019 07:39:59 +0000
Received: from NAM01-BY2-obe.outbound.protection.outlook.com (15.124.8.14) by
 M4W0334.microfocus.com (15.120.17.146) with Microsoft SMTP Server
 (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256) id
 15.1.1591.10 via Frontend Transport; Tue, 16 Jul 2019 07:39:59 +0000
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=ehKHYUWMRUvAe+2jkxB2SiZhFGpBazz++hNcM3qAbe/RADrLOpyt4OkKciEj5ZVMNYxxX15vskHh0/xfQHCF1XuHykfIry8sZC/dDmqlatlzI17i8bRj5XttDebjHWbKljmNV18rTMXO4ZHWIvsotB54eEozPwAR9/jD1GuRrv+PY9H0Ra4T5CaBTr32U9nVAVUDYb9r6mhJbVdBmyzZtNZSnnLlgoZdgMBI0G/vofK0Fwus56r3HvgcBszE2JmkcCyTqELMY+Qt0fVT1XTrv2Dbk2XsgY9nFtH1V2Q5KWPu/kSDXDoXhC+8nKgXt0CtMHahkzOmlRrCgyayR8GZ5Q==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=8OSDl/1ltzuH4FKjkG4mGUSd0Iy2sK7prqgf1+74uNU=;
 b=Xan1cPO/wb/RzX4TgJrKmdDZ/oBhTFwY/sshi0zUCXCwLxX69FfmtgkZYGvW1Ltq+ErAzBjtGnBrRwWz4005IUXjL+TAMToocx+KPjazDvFfqgl1VAQTTt0zV86dvrc/Rp9hIzBXLG4HK4OjEvgC0ShQgOVjaq8ornQ4UUn9oQGrWDIhc9IP+KHK5UY5JkGCJxM16SGU5AcA7o3RtySLRWccm1t4jdY8HO51Pyl6CzfV5P+tP8uRPF00lKy+ueeFwwKEWAogbYgt9l4UsqFyx1gA4CoycEnpo3Vev1yonK7ihsELOY2RVYipD1JEHusUCE2mDtYJR8H1nwhTx65YKw==
ARC-Authentication-Results: i=1; mx.microsoft.com 1;spf=pass
 smtp.mailfrom=suse.com;dmarc=pass action=none header.from=suse.com;dkim=pass
 header.d=suse.com;arc=none
Received: from DM6PR18MB3401.namprd18.prod.outlook.com (10.255.174.218) by
 DM6PR18MB2667.namprd18.prod.outlook.com (20.179.107.10) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2073.14; Tue, 16 Jul 2019 07:39:58 +0000
Received: from DM6PR18MB3401.namprd18.prod.outlook.com
 ([fe80::1fe:35f6:faf3:78c7]) by DM6PR18MB3401.namprd18.prod.outlook.com
 ([fe80::1fe:35f6:faf3:78c7%7]) with mapi id 15.20.2073.012; Tue, 16 Jul 2019
 07:39:58 +0000
From: Jan Beulich <JBeulich@suse.com>
To: "xen-devel@lists.xenproject.org" <xen-devel@lists.xenproject.org>
Thread-Topic: [PATCH v4 05/13] x86/IRQ: fix locking around vector management
Thread-Index: AQHVO6mrVR2llFRiTk2C0NteVXbnZA==
Date: Tue, 16 Jul 2019 07:39:58 +0000
Message-ID: <590e074c-f3b2-91ea-acaa-5a0b0409d749@suse.com>
References: <5cda711a-b417-76e9-d113-ea838463f225@suse.com>
In-Reply-To: <5cda711a-b417-76e9-d113-ea838463f225@suse.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-clientproxiedby: DB6PR01CA0070.eurprd01.prod.exchangelabs.com
 (2603:10a6:6:46::47) To DM6PR18MB3401.namprd18.prod.outlook.com
 (2603:10b6:5:1cc::26)
authentication-results: spf=none (sender IP is )
 smtp.mailfrom=JBeulich@suse.com; 
x-ms-exchange-messagesentrepresentingtype: 1
x-originating-ip: [87.234.252.170]
x-ms-publictraffictype: Email
x-ms-office365-filtering-correlation-id: d96ec161-3de4-4523-dc01-08d709c0cd9b
x-microsoft-antispam: BCL:0; PCL:0;
 RULEID:(2390118)(7020095)(4652040)(8989299)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(5600148)(711020)(4605104)(1401327)(2017052603328)(7193020);
 SRVR:DM6PR18MB2667; 
x-ms-traffictypediagnostic: DM6PR18MB2667:
x-microsoft-antispam-prvs: <DM6PR18MB2667B9D50E50BAC26690BCFDB3CE0@DM6PR18MB2667.namprd18.prod.outlook.com>
x-ms-oob-tlc-oobclassifiers: OLM:10000;
x-forefront-prvs: 0100732B76
x-forefront-antispam-report: SFV:NSPM;
 SFS:(10019020)(4636009)(39860400002)(346002)(366004)(376002)(396003)(136003)(43544003)(189003)(199004)(6436002)(102836004)(5640700003)(8676002)(53936002)(6506007)(4326008)(386003)(6512007)(7736002)(186003)(6116002)(6486002)(305945005)(52116002)(2906002)(66066001)(11346002)(81166006)(2616005)(8936002)(316002)(476003)(3846002)(66476007)(446003)(76176011)(2351001)(99286004)(26005)(81156014)(31686004)(68736007)(6916009)(256004)(14444005)(14454004)(486006)(71190400001)(478600001)(71200400001)(31696002)(5660300002)(86362001)(80792005)(2501003)(54906003)(36756003)(25786009)(64756008)(66556008)(66946007)(66446008);
 DIR:OUT; SFP:1102; SCL:1; SRVR:DM6PR18MB2667;
 H:DM6PR18MB3401.namprd18.prod.outlook.com; FPR:; SPF:None; LANG:en;
 PTR:InfoNoRecords; MX:1; A:1; 
received-spf: None (protection.outlook.com: suse.com does not designate
 permitted sender hosts)
x-ms-exchange-senderadcheck: 1
x-microsoft-antispam-message-info: mHHMVUY4qKgorqQVrrG/o+cw/Sy6SEZgo/4U/ldHU8IkIILSrhucvGI8aDAzGedcQEPsw7odf+1Ttdp5Jh61BrAOjgC4S9Rn8pUBdBSHQBc3XBHmmoy/LCHPcLqPM2laxLM5SYDehdtOYm/h9U9ClM05bP4/1V4oZ/aJJD90CDmXwxcw3K2ozW6jRUm9WY9G68km4JhICFkyufH8MA/ItCDwR1Afav9kejpKPXs3lGy5hiIUTul2/l720TnlmcidHipqZamnT9+bRUIduMX3iSTAUswX18fgDdeR+GRko5sTKMmFfDGwyauwGAEw3b5Shy/Em5RAok9a4dJj5DDauW/xw98hxtRNnd5yPnVIp3u5ZoX2FmE/4qzwFzojNvsEuy4EcOSgw4F8XU48XiNsq+f+4CvEB+L+QqaegQRYg8g=
Content-ID: <F1BF7DA334ED614188F79D609BB5DD01@namprd18.prod.outlook.com>
MIME-Version: 1.0
X-MS-Exchange-CrossTenant-Network-Message-Id: d96ec161-3de4-4523-dc01-08d709c0cd9b
X-MS-Exchange-CrossTenant-originalarrivaltime: 16 Jul 2019 07:39:58.5268 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: 856b813c-16e5-49a5-85ec-6f081e13b527
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: JBeulich@suse.com
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DM6PR18MB2667
X-OriginatorOrg: suse.com
Subject: [Xen-devel] [PATCH v4 05/13] x86/IRQ: fix locking around vector
 management
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>, Wei Liu <wl@xen.org>,
 =?utf-8?B?Um9nZXIgUGF1IE1vbm7DqQ==?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

QWxsIG9mIF9fe2Fzc2lnbixiaW5kLGNsZWFyfV9pcnFfdmVjdG9yKCkgbWFuaXB1bGF0ZSBzdHJ1
Y3QgaXJxX2Rlc2MNCmZpZWxkcywgYW5kIGhlbmNlIG91Z2h0IHRvIGJlIGNhbGxlZCB3aXRoIHRo
ZSBkZXNjcmlwdG9yIGxvY2sgaGVsZCBpbg0KYWRkaXRpb24gdG8gdmVjdG9yX2xvY2suIFRoaXMg
aXMgY3VycmVudGx5IHRoZSBjYXNlIGZvciBvbmx5DQpzZXRfZGVzY19hZmZpbml0eSgpIChpbiB0
aGUgY29tbW9uIGNhc2UpIGFuZCBkZXN0cm95X2lycSgpLCB3aGljaCBhbHNvDQpjbGFyaWZpZXMg
d2hhdCB0aGUgbmVzdGluZyBiZWhhdmlvciBiZXR3ZWVuIHRoZSBsb2NrcyBoYXMgdG8gYmUuDQpS
ZWZsZWN0IHRoZSBuZXcgZXhwZWN0YXRpb24gYnkgaGF2aW5nIHRoZXNlIGZ1bmN0aW9ucyBhbGwg
dGFrZSBhDQpkZXNjcmlwdG9yIGFzIHBhcmFtZXRlciBpbnN0ZWFkIG9mIGFuIGludGVycnVwdCBu
dW1iZXIuDQoNCkFsc28gdGFrZSBjYXJlIG9mIHRoZSB0d28gc3BlY2lhbCBjYXNlcyBvZiBjYWxs
cyB0byBzZXRfZGVzY19hZmZpbml0eSgpOg0Kc2V0X2lvYXBpY19hZmZpbml0eV9pcnEoKSBhbmQg
VlQtZCdzIGRtYV9tc2lfc2V0X2FmZmluaXR5KCkgZ2V0IGNhbGxlZA0KZGlyZWN0bHkgYXMgd2Vs
bCwgYW5kIGluIHRoZXNlIGNhc2VzIHRoZSBkZXNjcmlwdG9yIGxvY2tzIGhhZG4ndCBnb3QNCmFj
cXVpcmVkIHRpbGwgbm93LiBGb3Igc2V0X2lvYXBpY19hZmZpbml0eV9pcnEoKSB0aGlzIG1lYW5z
IGFjcXVpcmluZyAvDQpyZWxlYXNpbmcgb2YgdGhlIElPLUFQSUMgbG9jayBjYW4gYmUgcGxhaW4g
c3Bpbl97LHVufWxvY2soKSB0aGVuLg0KDQpEcm9wIG9uZSBvZiB0aGUgdHdvIGxlYWRpbmcgdW5k
ZXJzY29yZXMgZnJvbSBhbGwgdGhyZWUgZnVuY3Rpb25zIGF0DQp0aGUgc2FtZSB0aW1lLg0KDQpU
aGVyZSdzIG9uZSBjYXNlIGxlZnQgd2hlcmUgZGVzY3JpcHRvcnMgZ2V0IG1hbmlwdWxhdGVkIHdp
dGgganVzdA0KdmVjdG9yX2xvY2sgaGVsZDogc2V0dXBfdmVjdG9yX2lycSgpIGFzc3VtZXMgaXRz
IGNhbGxlciB0byBhY3F1aXJlDQp2ZWN0b3JfbG9jaywgYW5kIGhlbmNlIGNhbid0IGl0c2VsZiBh
Y3F1aXJlIHRoZSBkZXNjcmlwdG9yIGxvY2tzICh3cm9uZw0KbG9jayBvcmRlcikuIEkgZG9uJ3Qg
Y3VycmVudGx5IHNlZSBob3cgdG8gYWRkcmVzcyB0aGlzLg0KDQpTaWduZWQtb2ZmLWJ5OiBKYW4g
QmV1bGljaCA8amJldWxpY2hAc3VzZS5jb20+DQpSZXZpZXdlZC1ieTogS2V2aW4gVGlhbiA8a2V2
aW4udGlhbkBpbnRlbC5jb20+IFtWVC1kXQ0KUmV2aWV3ZWQtYnk6IFJvZ2VyIFBhdSBNb25uw6kg
PHJvZ2VyLnBhdUBjaXRyaXguY29tPg0KQWNrZWQtYnk6IEFuZHJldyBDb29wZXIgPGFuZHJldy5j
b29wZXIzQGNpdHJpeC5jb20+DQotLS0NCnY0OiBBZGp1c3QgY29tbWVudCBhaGVhZCBvZiBzZXR1
cF92ZWN0b3JfaXJxKCkuDQp2MzogQWxzbyBkcm9wIG9uZSBsZWFkaW5nIHVuZGVyc2NvcmUgZnJv
bSBhIGNvbW1lbnQuIFJlLWJhc2UuDQp2MjogQWxzbyBhZGp1c3Qgc2V0X2lvYXBpY19hZmZpbml0
eV9pcnEoKSBhbmQgVlQtZCdzDQogICAgIGRtYV9tc2lfc2V0X2FmZmluaXR5KCkuDQoNCi0tLSBh
L3hlbi9hcmNoL3g4Ni9pb19hcGljLmMNCisrKyBiL3hlbi9hcmNoL3g4Ni9pb19hcGljLmMNCkBA
IC01NTAsMTQgKzU1MCwxNCBAQCBzdGF0aWMgdm9pZCBjbGVhcl9JT19BUElDICh2b2lkKQ0KICBz
dGF0aWMgdm9pZA0KICBzZXRfaW9hcGljX2FmZmluaXR5X2lycShzdHJ1Y3QgaXJxX2Rlc2MgKmRl
c2MsIGNvbnN0IGNwdW1hc2tfdCAqbWFzaykNCiAgew0KLSAgICB1bnNpZ25lZCBsb25nIGZsYWdz
Ow0KICAgICAgdW5zaWduZWQgaW50IGRlc3Q7DQogICAgICBpbnQgcGluLCBpcnE7DQogICAgICBz
dHJ1Y3QgaXJxX3Bpbl9saXN0ICplbnRyeTsNCiAgDQogICAgICBpcnEgPSBkZXNjLT5pcnE7DQog
IA0KLSAgICBzcGluX2xvY2tfaXJxc2F2ZSgmaW9hcGljX2xvY2ssIGZsYWdzKTsNCisgICAgc3Bp
bl9sb2NrKCZpb2FwaWNfbG9jayk7DQorDQogICAgICBkZXN0ID0gc2V0X2Rlc2NfYWZmaW5pdHko
ZGVzYywgbWFzayk7DQogICAgICBpZiAoZGVzdCAhPSBCQURfQVBJQ0lEKSB7DQogICAgICAgICAg
aWYgKCAheDJhcGljX2VuYWJsZWQgKQ0KQEAgLTU4MCw4ICs1ODAsOCBAQCBzZXRfaW9hcGljX2Fm
ZmluaXR5X2lycShzdHJ1Y3QgaXJxX2Rlc2MNCiAgICAgICAgICAgICAgZW50cnkgPSBpcnFfMl9w
aW4gKyBlbnRyeS0+bmV4dDsNCiAgICAgICAgICB9DQogICAgICB9DQotICAgIHNwaW5fdW5sb2Nr
X2lycXJlc3RvcmUoJmlvYXBpY19sb2NrLCBmbGFncyk7DQogIA0KKyAgICBzcGluX3VubG9jaygm
aW9hcGljX2xvY2spOw0KICB9DQogIA0KICAvKg0KQEAgLTY3NCwxNiArNjc0LDE5IEBAIHZvaWQg
LypfX2luaXQqLyBzZXR1cF9pb2FwaWNfZGVzdCh2b2lkKQ0KICAgICAgZm9yIChpb2FwaWMgPSAw
OyBpb2FwaWMgPCBucl9pb2FwaWNzOyBpb2FwaWMrKykgew0KICAgICAgICAgIGZvciAocGluID0g
MDsgcGluIDwgbnJfaW9hcGljX2VudHJpZXNbaW9hcGljXTsgcGluKyspIHsNCiAgICAgICAgICAg
ICAgc3RydWN0IGlycV9kZXNjICpkZXNjOw0KKyAgICAgICAgICAgIHVuc2lnbmVkIGxvbmcgZmxh
Z3M7DQogIA0KICAgICAgICAgICAgICBpcnFfZW50cnkgPSBmaW5kX2lycV9lbnRyeShpb2FwaWMs
IHBpbiwgbXBfSU5UKTsNCiAgICAgICAgICAgICAgaWYgKGlycV9lbnRyeSA9PSAtMSkNCiAgICAg
ICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICBpcnEgPSBwaW5fMl9pcnEoaXJx
X2VudHJ5LCBpb2FwaWMsIHBpbik7DQogICAgICAgICAgICAgIGRlc2MgPSBpcnFfdG9fZGVzYyhp
cnEpOw0KKw0KKyAgICAgICAgICAgIHNwaW5fbG9ja19pcnFzYXZlKCZkZXNjLT5sb2NrLCBmbGFn
cyk7DQogICAgICAgICAgICAgIEJVR19PTighY3B1bWFza19pbnRlcnNlY3RzKGRlc2MtPmFyY2gu
Y3B1X21hc2ssICZjcHVfb25saW5lX21hcCkpOw0KICAgICAgICAgICAgICBzZXRfaW9hcGljX2Fm
ZmluaXR5X2lycShkZXNjLCBkZXNjLT5hcmNoLmNwdV9tYXNrKTsNCisgICAgICAgICAgICBzcGlu
X3VubG9ja19pcnFyZXN0b3JlKCZkZXNjLT5sb2NrLCBmbGFncyk7DQogICAgICAgICAgfQ0KLQ0K
ICAgICAgfQ0KICB9DQogIA0KLS0tIGEveGVuL2FyY2gveDg2L2lycS5jDQorKysgYi94ZW4vYXJj
aC94ODYvaXJxLmMNCkBAIC0yNyw2ICsyNyw3IEBADQogICNpbmNsdWRlIDxwdWJsaWMvcGh5c2Rl
di5oPg0KICANCiAgc3RhdGljIGludCBwYXJzZV9pcnFfdmVjdG9yX21hcF9wYXJhbShjb25zdCBj
aGFyICpzKTsNCitzdGF0aWMgdm9pZCBfY2xlYXJfaXJxX3ZlY3RvcihzdHJ1Y3QgaXJxX2Rlc2Mg
KmRlc2MpOw0KICANCiAgLyogb3B0X25vaXJxYmFsYW5jZTogSWYgdHJ1ZSwgc29mdHdhcmUgSVJR
IGJhbGFuY2luZy9hZmZpbml0eSBpcyBkaXNhYmxlZC4gKi8NCiAgYm9vbCBfX3JlYWRfbW9zdGx5
IG9wdF9ub2lycWJhbGFuY2U7DQpAQCAtMTQzLDEzICsxNDQsMTIgQEAgc3RhdGljIHZvaWQgdHJh
Y2VfaXJxX21hc2sodWludDMyX3QgZXZlbg0KICAgICAgICAgIF90cmFjZV9pcnFfbWFzayhldmVu
dCwgaXJxLCB2ZWN0b3IsIG1hc2spOw0KICB9DQogIA0KLXN0YXRpYyBpbnQgX19pbml0IF9fYmlu
ZF9pcnFfdmVjdG9yKGludCBpcnEsIGludCB2ZWN0b3IsIGNvbnN0IGNwdW1hc2tfdCAqY3B1X21h
c2spDQorc3RhdGljIGludCBfX2luaXQgX2JpbmRfaXJxX3ZlY3RvcihzdHJ1Y3QgaXJxX2Rlc2Mg
KmRlc2MsIGludCB2ZWN0b3IsDQorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBj
b25zdCBjcHVtYXNrX3QgKmNwdV9tYXNrKQ0KICB7DQogICAgICBjcHVtYXNrX3Qgb25saW5lX21h
c2s7DQogICAgICBpbnQgY3B1Ow0KLSAgICBzdHJ1Y3QgaXJxX2Rlc2MgKmRlc2MgPSBpcnFfdG9f
ZGVzYyhpcnEpOw0KICANCi0gICAgQlVHX09OKCh1bnNpZ25lZClpcnEgPj0gbnJfaXJxcyk7DQog
ICAgICBCVUdfT04oKHVuc2lnbmVkKXZlY3RvciA+PSBOUl9WRUNUT1JTKTsNCiAgDQogICAgICBj
cHVtYXNrX2FuZCgmb25saW5lX21hc2ssIGNwdV9tYXNrLCAmY3B1X29ubGluZV9tYXApOw0KQEAg
LTE2MCw5ICsxNjAsOSBAQCBzdGF0aWMgaW50IF9faW5pdCBfX2JpbmRfaXJxX3ZlY3RvcihpbnQN
CiAgICAgICAgICByZXR1cm4gMDsNCiAgICAgIGlmICggZGVzYy0+YXJjaC52ZWN0b3IgIT0gSVJR
X1ZFQ1RPUl9VTkFTU0lHTkVEICkNCiAgICAgICAgICByZXR1cm4gLUVCVVNZOw0KLSAgICB0cmFj
ZV9pcnFfbWFzayhUUkNfSFdfSVJRX0JJTkRfVkVDVE9SLCBpcnEsIHZlY3RvciwgJm9ubGluZV9t
YXNrKTsNCisgICAgdHJhY2VfaXJxX21hc2soVFJDX0hXX0lSUV9CSU5EX1ZFQ1RPUiwgZGVzYy0+
aXJxLCB2ZWN0b3IsICZvbmxpbmVfbWFzayk7DQogICAgICBmb3JfZWFjaF9jcHUoY3B1LCAmb25s
aW5lX21hc2spDQotICAgICAgICBwZXJfY3B1KHZlY3Rvcl9pcnEsIGNwdSlbdmVjdG9yXSA9IGly
cTsNCisgICAgICAgIHBlcl9jcHUodmVjdG9yX2lycSwgY3B1KVt2ZWN0b3JdID0gZGVzYy0+aXJx
Ow0KICAgICAgZGVzYy0+YXJjaC52ZWN0b3IgPSB2ZWN0b3I7DQogICAgICBjcHVtYXNrX2NvcHko
ZGVzYy0+YXJjaC5jcHVfbWFzaywgJm9ubGluZV9tYXNrKTsNCiAgICAgIGlmICggZGVzYy0+YXJj
aC51c2VkX3ZlY3RvcnMgKQ0KQEAgLTE3NiwxMiArMTc2LDE4IEBAIHN0YXRpYyBpbnQgX19pbml0
IF9fYmluZF9pcnFfdmVjdG9yKGludA0KICANCiAgaW50IF9faW5pdCBiaW5kX2lycV92ZWN0b3Io
aW50IGlycSwgaW50IHZlY3RvciwgY29uc3QgY3B1bWFza190ICpjcHVfbWFzaykNCiAgew0KKyAg
ICBzdHJ1Y3QgaXJxX2Rlc2MgKmRlc2MgPSBpcnFfdG9fZGVzYyhpcnEpOw0KICAgICAgdW5zaWdu
ZWQgbG9uZyBmbGFnczsNCiAgICAgIGludCByZXQ7DQogIA0KLSAgICBzcGluX2xvY2tfaXJxc2F2
ZSgmdmVjdG9yX2xvY2ssIGZsYWdzKTsNCi0gICAgcmV0ID0gX19iaW5kX2lycV92ZWN0b3IoaXJx
LCB2ZWN0b3IsIGNwdV9tYXNrKTsNCi0gICAgc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmdmVjdG9y
X2xvY2ssIGZsYWdzKTsNCisgICAgQlVHX09OKCh1bnNpZ25lZClpcnEgPj0gbnJfaXJxcyk7DQor
DQorICAgIHNwaW5fbG9ja19pcnFzYXZlKCZkZXNjLT5sb2NrLCBmbGFncyk7DQorICAgIHNwaW5f
bG9jaygmdmVjdG9yX2xvY2spOw0KKyAgICByZXQgPSBfYmluZF9pcnFfdmVjdG9yKGRlc2MsIHZl
Y3RvciwgY3B1X21hc2spOw0KKyAgICBzcGluX3VubG9jaygmdmVjdG9yX2xvY2spOw0KKyAgICBz
cGluX3VubG9ja19pcnFyZXN0b3JlKCZkZXNjLT5sb2NrLCBmbGFncyk7DQorDQogICAgICByZXR1
cm4gcmV0Ow0KICB9DQogIA0KQEAgLTI2NiwxOCArMjcyLDIwIEBAIHZvaWQgZGVzdHJveV9pcnEo
dW5zaWduZWQgaW50IGlycSkNCiAgDQogICAgICBzcGluX2xvY2tfaXJxc2F2ZSgmZGVzYy0+bG9j
aywgZmxhZ3MpOw0KICAgICAgZGVzYy0+aGFuZGxlciA9ICZub19pcnFfdHlwZTsNCi0gICAgY2xl
YXJfaXJxX3ZlY3RvcihpcnEpOw0KKyAgICBzcGluX2xvY2soJnZlY3Rvcl9sb2NrKTsNCisgICAg
X2NsZWFyX2lycV92ZWN0b3IoZGVzYyk7DQorICAgIHNwaW5fdW5sb2NrKCZ2ZWN0b3JfbG9jayk7
DQogICAgICBkZXNjLT5hcmNoLnVzZWRfdmVjdG9ycyA9IE5VTEw7DQogICAgICBzcGluX3VubG9j
a19pcnFyZXN0b3JlKCZkZXNjLT5sb2NrLCBmbGFncyk7DQogIA0KICAgICAgeGZyZWUoYWN0aW9u
KTsNCiAgfQ0KICANCi1zdGF0aWMgdm9pZCBfX2NsZWFyX2lycV92ZWN0b3IoaW50IGlycSkNCitz
dGF0aWMgdm9pZCBfY2xlYXJfaXJxX3ZlY3RvcihzdHJ1Y3QgaXJxX2Rlc2MgKmRlc2MpDQogIHsN
Ci0gICAgaW50IGNwdSwgdmVjdG9yLCBvbGRfdmVjdG9yOw0KKyAgICB1bnNpZ25lZCBpbnQgY3B1
Ow0KKyAgICBpbnQgdmVjdG9yLCBvbGRfdmVjdG9yLCBpcnEgPSBkZXNjLT5pcnE7DQogICAgICBj
cHVtYXNrX3QgdG1wX21hc2s7DQotICAgIHN0cnVjdCBpcnFfZGVzYyAqZGVzYyA9IGlycV90b19k
ZXNjKGlycSk7DQogIA0KICAgICAgQlVHX09OKCFkZXNjLT5hcmNoLnZlY3Rvcik7DQogIA0KQEAg
LTMyMywxMSArMzMxLDE0IEBAIHN0YXRpYyB2b2lkIF9fY2xlYXJfaXJxX3ZlY3RvcihpbnQgaXJx
KQ0KICANCiAgdm9pZCBjbGVhcl9pcnFfdmVjdG9yKGludCBpcnEpDQogIHsNCisgICAgc3RydWN0
IGlycV9kZXNjICpkZXNjID0gaXJxX3RvX2Rlc2MoaXJxKTsNCiAgICAgIHVuc2lnbmVkIGxvbmcg
ZmxhZ3M7DQogIA0KLSAgICBzcGluX2xvY2tfaXJxc2F2ZSgmdmVjdG9yX2xvY2ssIGZsYWdzKTsN
Ci0gICAgX19jbGVhcl9pcnFfdmVjdG9yKGlycSk7DQotICAgIHNwaW5fdW5sb2NrX2lycXJlc3Rv
cmUoJnZlY3Rvcl9sb2NrLCBmbGFncyk7DQorICAgIHNwaW5fbG9ja19pcnFzYXZlKCZkZXNjLT5s
b2NrLCBmbGFncyk7DQorICAgIHNwaW5fbG9jaygmdmVjdG9yX2xvY2spOw0KKyAgICBfY2xlYXJf
aXJxX3ZlY3RvcihkZXNjKTsNCisgICAgc3Bpbl91bmxvY2soJnZlY3Rvcl9sb2NrKTsNCisgICAg
c3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZGVzYy0+bG9jaywgZmxhZ3MpOw0KICB9DQogIA0KICBp
bnQgaXJxX3RvX3ZlY3RvcihpbnQgaXJxKQ0KQEAgLTQ2Miw4ICs0NzMsNyBAQCBzdGF0aWMgdm1h
c2tfdCAqaXJxX2dldF91c2VkX3ZlY3Rvcl9tYXNrDQogICAgICByZXR1cm4gcmV0Ow0KICB9DQog
IA0KLXN0YXRpYyBpbnQgX19hc3NpZ25faXJxX3ZlY3RvcigNCi0gICAgaW50IGlycSwgc3RydWN0
IGlycV9kZXNjICpkZXNjLCBjb25zdCBjcHVtYXNrX3QgKm1hc2spDQorc3RhdGljIGludCBfYXNz
aWduX2lycV92ZWN0b3Ioc3RydWN0IGlycV9kZXNjICpkZXNjLCBjb25zdCBjcHVtYXNrX3QgKm1h
c2spDQogIHsNCiAgICAgIC8qDQogICAgICAgKiBOT1RFISBUaGUgbG9jYWwgQVBJQyBpc24ndCB2
ZXJ5IGdvb2QgYXQgaGFuZGxpbmcNCkBAIC00NzcsNyArNDg3LDggQEAgc3RhdGljIGludCBfX2Fz
c2lnbl9pcnFfdmVjdG9yKA0KICAgICAgICogMHg4MCwgYmVjYXVzZSBpbnQgMHg4MCBpcyBobSwg
a2luZCBvZiBpbXBvcnRhbnRpc2guIDspDQogICAgICAgKi8NCiAgICAgIHN0YXRpYyBpbnQgY3Vy
cmVudF92ZWN0b3IgPSBGSVJTVF9EWU5BTUlDX1ZFQ1RPUiwgY3VycmVudF9vZmZzZXQgPSAwOw0K
LSAgICBpbnQgY3B1LCBlcnIsIG9sZF92ZWN0b3I7DQorICAgIHVuc2lnbmVkIGludCBjcHU7DQor
ICAgIGludCBlcnIsIG9sZF92ZWN0b3IsIGlycSA9IGRlc2MtPmlycTsNCiAgICAgIHZtYXNrX3Qg
KmlycV91c2VkX3ZlY3RvcnMgPSBOVUxMOw0KICANCiAgICAgIG9sZF92ZWN0b3IgPSBpcnFfdG9f
dmVjdG9yKGlycSk7DQpAQCAtNTkwLDggKzYwMSwxMiBAQCBpbnQgYXNzaWduX2lycV92ZWN0b3Io
aW50IGlycSwgY29uc3QgY3B1DQogICAgICANCiAgICAgIEJVR19PTihpcnEgPj0gbnJfaXJxcyB8
fCBpcnEgPDApOw0KICANCi0gICAgc3Bpbl9sb2NrX2lycXNhdmUoJnZlY3Rvcl9sb2NrLCBmbGFn
cyk7DQotICAgIHJldCA9IF9fYXNzaWduX2lycV92ZWN0b3IoaXJxLCBkZXNjLCBtYXNrID86IFRB
UkdFVF9DUFVTKTsNCisgICAgc3Bpbl9sb2NrX2lycXNhdmUoJmRlc2MtPmxvY2ssIGZsYWdzKTsN
CisNCisgICAgc3Bpbl9sb2NrKCZ2ZWN0b3JfbG9jayk7DQorICAgIHJldCA9IF9hc3NpZ25faXJx
X3ZlY3RvcihkZXNjLCBtYXNrID86IFRBUkdFVF9DUFVTKTsNCisgICAgc3Bpbl91bmxvY2soJnZl
Y3Rvcl9sb2NrKTsNCisNCiAgICAgIGlmICggIXJldCApDQogICAgICB7DQogICAgICAgICAgcmV0
ID0gZGVzYy0+YXJjaC52ZWN0b3I7DQpAQCAtNjAwLDE0ICs2MTUsMTYgQEAgaW50IGFzc2lnbl9p
cnFfdmVjdG9yKGludCBpcnEsIGNvbnN0IGNwdQ0KICAgICAgICAgIGVsc2UNCiAgICAgICAgICAg
ICAgY3B1bWFza19zZXRhbGwoZGVzYy0+YWZmaW5pdHkpOw0KICAgICAgfQ0KLSAgICBzcGluX3Vu
bG9ja19pcnFyZXN0b3JlKCZ2ZWN0b3JfbG9jaywgZmxhZ3MpOw0KKw0KKyAgICBzcGluX3VubG9j
a19pcnFyZXN0b3JlKCZkZXNjLT5sb2NrLCBmbGFncyk7DQogIA0KICAgICAgcmV0dXJuIHJldDsN
CiAgfQ0KICANCiAgLyoNCiAgICogSW5pdGlhbGl6ZSB2ZWN0b3JfaXJxIG9uIGEgbmV3IGNwdS4g
VGhpcyBmdW5jdGlvbiBtdXN0IGJlIGNhbGxlZA0KLSAqIHdpdGggdmVjdG9yX2xvY2sgaGVsZC4N
CisgKiB3aXRoIHZlY3Rvcl9sb2NrIGhlbGQuICBGb3IgdGhpcyByZWFzb24gaXQgbWF5IG5vdCBp
dHNlbGYgYWNxdWlyZQ0KKyAqIHRoZSBJUlEgZGVzY3JpcHRvciBsb2NrcywgYXMgbG9jayBuZXN0
aW5nIGlzIHRoZSBvdGhlciB3YXkgYXJvdW5kLg0KICAgKi8NCiAgdm9pZCBzZXR1cF92ZWN0b3Jf
aXJxKHVuc2lnbmVkIGludCBjcHUpDQogIHsNCkBAIC03NzUsNyArNzkyLDYgQEAgdm9pZCBpcnFf
Y29tcGxldGVfbW92ZShzdHJ1Y3QgaXJxX2Rlc2MgKg0KICANCiAgdW5zaWduZWQgaW50IHNldF9k
ZXNjX2FmZmluaXR5KHN0cnVjdCBpcnFfZGVzYyAqZGVzYywgY29uc3QgY3B1bWFza190ICptYXNr
KQ0KICB7DQotICAgIHVuc2lnbmVkIGludCBpcnE7DQogICAgICBpbnQgcmV0Ow0KICAgICAgdW5z
aWduZWQgbG9uZyBmbGFnczsNCiAgICAgIGNwdW1hc2tfdCBkZXN0X21hc2s7DQpAQCAtNzgzLDEw
ICs3OTksOCBAQCB1bnNpZ25lZCBpbnQgc2V0X2Rlc2NfYWZmaW5pdHkoc3RydWN0IGlyDQogICAg
ICBpZiAoIWNwdW1hc2tfaW50ZXJzZWN0cyhtYXNrLCAmY3B1X29ubGluZV9tYXApKQ0KICAgICAg
ICAgIHJldHVybiBCQURfQVBJQ0lEOw0KICANCi0gICAgaXJxID0gZGVzYy0+aXJxOw0KLQ0KICAg
ICAgc3Bpbl9sb2NrX2lycXNhdmUoJnZlY3Rvcl9sb2NrLCBmbGFncyk7DQotICAgIHJldCA9IF9f
YXNzaWduX2lycV92ZWN0b3IoaXJxLCBkZXNjLCBtYXNrKTsNCisgICAgcmV0ID0gX2Fzc2lnbl9p
cnFfdmVjdG9yKGRlc2MsIG1hc2spOw0KICAgICAgc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmdmVj
dG9yX2xvY2ssIGZsYWdzKTsNCiAgDQogICAgICBpZiAocmV0IDwgMCkNCkBAIC0yNDUzLDcgKzI0
NjcsNyBAQCB2b2lkIGZpeHVwX2lycXMoY29uc3QgY3B1bWFza190ICptYXNrLCBiDQogIA0KICAg
ICAgICAgIC8qDQogICAgICAgICAgICogSW4gb3JkZXIgZm9yIHRoZSBhZmZpbml0eSBhZGp1c3Rt
ZW50IGJlbG93IHRvIGJlIHN1Y2Nlc3NmdWwsIHdlDQotICAgICAgICAgKiBuZWVkIF9fYXNzaWdu
X2lycV92ZWN0b3IoKSB0byBzdWNjZWVkLiBUaGlzIGluIHBhcnRpY3VsYXIgbWVhbnMNCisgICAg
ICAgICAqIG5lZWQgX2Fzc2lnbl9pcnFfdmVjdG9yKCkgdG8gc3VjY2VlZC4gVGhpcyBpbiBwYXJ0
aWN1bGFyIG1lYW5zDQogICAgICAgICAgICogY2xlYXJpbmcgZGVzYy0+YXJjaC5tb3ZlX2luX3By
b2dyZXNzIGlmIHRoaXMgd291bGQgb3RoZXJ3aXNlDQogICAgICAgICAgICogcHJldmVudCB0aGUg
ZnVuY3Rpb24gZnJvbSBzdWNjZWVkaW5nLiBTaW5jZSB0aGVyZSdzIG5vIHdheSBmb3IgdGhlDQog
ICAgICAgICAgICogZmxhZyB0byBnZXQgY2xlYXJlZCBhbnltb3JlIHdoZW4gdGhlcmUncyBubyBw
b3NzaWJsZSBkZXN0aW5hdGlvbg0KLS0tIGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvdnRkL2lv
bW11LmMNCisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9pb21tdS5jDQpAQCAtMjEz
NCwxMSArMjEzNCwxNiBAQCBzdGF0aWMgdm9pZCBhZGp1c3RfaXJxX2FmZmluaXR5KHN0cnVjdCBh
DQogICAgICB1bnNpZ25lZCBpbnQgbm9kZSA9IHJoc2EgPyBweG1fdG9fbm9kZShyaHNhLT5wcm94
aW1pdHlfZG9tYWluKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogTlVNQV9OT19O
T0RFOw0KICAgICAgY29uc3QgY3B1bWFza190ICpjcHVtYXNrID0gJmNwdV9vbmxpbmVfbWFwOw0K
KyAgICBzdHJ1Y3QgaXJxX2Rlc2MgKmRlc2M7DQogIA0KICAgICAgaWYgKCBub2RlIDwgTUFYX05V
TU5PREVTICYmIG5vZGVfb25saW5lKG5vZGUpICYmDQogICAgICAgICAgIGNwdW1hc2tfaW50ZXJz
ZWN0cygmbm9kZV90b19jcHVtYXNrKG5vZGUpLCBjcHVtYXNrKSApDQogICAgICAgICAgY3B1bWFz
ayA9ICZub2RlX3RvX2NwdW1hc2sobm9kZSk7DQotICAgIGRtYV9tc2lfc2V0X2FmZmluaXR5KGly
cV90b19kZXNjKGRyaGQtPmlvbW11LT5tc2kuaXJxKSwgY3B1bWFzayk7DQorDQorICAgIGRlc2Mg
PSBpcnFfdG9fZGVzYyhkcmhkLT5pb21tdS0+bXNpLmlycSk7DQorICAgIHNwaW5fbG9ja19pcnEo
JmRlc2MtPmxvY2spOw0KKyAgICBkbWFfbXNpX3NldF9hZmZpbml0eShkZXNjLCBjcHVtYXNrKTsN
CisgICAgc3Bpbl91bmxvY2tfaXJxKCZkZXNjLT5sb2NrKTsNCiAgfQ0KICANCiAgc3RhdGljIGlu
dCBhZGp1c3RfdnRkX2lycV9hZmZpbml0aWVzKHZvaWQpDQoNCl9fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRl
dmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFp
bG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

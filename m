Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 2C9E8A83F3
	for <lists+xen-devel@lfdr.de>; Wed,  4 Sep 2019 15:48:39 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i5Vc9-0003rM-84; Wed, 04 Sep 2019 13:46:25 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=YVaO=W7=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1i5Vc7-0003qd-Hu
 for xen-devel@lists.xenproject.org; Wed, 04 Sep 2019 13:46:23 +0000
X-Inumbo-ID: 5b3b2074-cf1a-11e9-978d-bc764e2007e4
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 5b3b2074-cf1a-11e9-978d-bc764e2007e4;
 Wed, 04 Sep 2019 13:46:12 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 859FEAD5D;
 Wed,  4 Sep 2019 13:46:11 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Wed,  4 Sep 2019 15:46:06 +0200
Message-Id: <20190904134608.18425-3-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190904134608.18425-1-jgross@suse.com>
References: <20190904134608.18425-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v4 2/4] xen: move debugtrace coding to
 common/debugtrace.c
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SW5zdGVhZCBvZiBsaXZpbmcgaW4gZHJpdmVycy9jaGFyL2NvbnNvbGUuYyBtb3ZlIHRoZSBkZWJ1
Z3RyYWNlCnJlbGF0ZWQgY29kaW5nIHRvIGEgbmV3IGZpbGUgY29tbW9uL2RlYnVndHJhY2UuYwoK
Tm8gZnVuY3Rpb25hbCBjaGFuZ2UsIGNvZGUgbW92ZW1lbnQgb25seS4KClNpZ25lZC1vZmYtYnk6
IEp1ZXJnZW4gR3Jvc3MgPGpncm9zc0BzdXNlLmNvbT4KQWNrZWQtYnk6IEphbiBCZXVsaWNoIDxq
YmV1bGljaEBzdXNlLmNvbT4KLS0tCiB4ZW4vY29tbW9uL01ha2VmaWxlICAgICAgICB8ICAgMSAr
CiB4ZW4vY29tbW9uL2RlYnVndHJhY2UuYyAgICB8IDE4MCArKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysKIHhlbi9kcml2ZXJzL2NoYXIvY29uc29sZS5jIHwgMTc3
ICstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAzIGZpbGVzIGNo
YW5nZWQsIDE4MiBpbnNlcnRpb25zKCspLCAxNzYgZGVsZXRpb25zKC0pCiBjcmVhdGUgbW9kZSAx
MDA2NDQgeGVuL2NvbW1vbi9kZWJ1Z3RyYWNlLmMKCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL01h
a2VmaWxlIGIveGVuL2NvbW1vbi9NYWtlZmlsZQppbmRleCBlZGRkYTVkYWE2Li42MmIzNGU2OWU5
IDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL01ha2VmaWxlCisrKyBiL3hlbi9jb21tb24vTWFrZWZp
bGUKQEAgLTQsNiArNCw3IEBAIG9iai15ICs9IGJzZWFyY2gubwogb2JqLSQoQ09ORklHX0NPUkVf
UEFSS0lORykgKz0gY29yZV9wYXJraW5nLm8KIG9iai15ICs9IGNwdS5vCiBvYmoteSArPSBjcHVw
b29sLm8KK29iai0kKENPTkZJR19ERUJVR19UUkFDRSkgKz0gZGVidWd0cmFjZS5vCiBvYmotJChD
T05GSUdfSEFTX0RFVklDRV9UUkVFKSArPSBkZXZpY2VfdHJlZS5vCiBvYmoteSArPSBkb21jdGwu
bwogb2JqLXkgKz0gZG9tYWluLm8KZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vZGVidWd0cmFjZS5j
IGIveGVuL2NvbW1vbi9kZWJ1Z3RyYWNlLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAw
MDAwMDAwMC4uNTA2YWVlOTQxOAotLS0gL2Rldi9udWxsCisrKyBiL3hlbi9jb21tb24vZGVidWd0
cmFjZS5jCkBAIC0wLDAgKzEsMTgwIEBACisvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCisgKiBkZWJ1
Z3RyYWNlLmMKKyAqCisgKiBEZWJ1Z3RyYWNlIGZvciBYZW4KKyAqLworCisKKyNpbmNsdWRlIDx4
ZW4vY29uc29sZS5oPgorI2luY2x1ZGUgPHhlbi9pbml0Lmg+CisjaW5jbHVkZSA8eGVuL2tleWhh
bmRsZXIuaD4KKyNpbmNsdWRlIDx4ZW4vbGliLmg+CisjaW5jbHVkZSA8eGVuL21tLmg+CisjaW5j
bHVkZSA8eGVuL3NlcmlhbC5oPgorI2luY2x1ZGUgPHhlbi9zcGlubG9jay5oPgorI2luY2x1ZGUg
PHhlbi93YXRjaGRvZy5oPgorCisvKiBTZW5kIG91dHB1dCBkaXJlY3QgdG8gY29uc29sZSwgb3Ig
YnVmZmVyIGl0PyAqLworc3RhdGljIHZvbGF0aWxlIGludCBkZWJ1Z3RyYWNlX3NlbmRfdG9fY29u
c29sZTsKKworc3RhdGljIGNoYXIgICAgICAgICpkZWJ1Z3RyYWNlX2J1ZjsgLyogRGVidWctdHJh
Y2UgYnVmZmVyICovCitzdGF0aWMgdW5zaWduZWQgaW50IGRlYnVndHJhY2VfcHJkOyAvKiBQcm9k
dWNlciBpbmRleCAgICAgKi8KK3N0YXRpYyB1bnNpZ25lZCBpbnQgZGVidWd0cmFjZV9wcmRfbGFz
dDsKK3N0YXRpYyB1bnNpZ25lZCBpbnQgZGVidWd0cmFjZV9raWxvYnl0ZXMgPSAxMjgsIGRlYnVn
dHJhY2VfYnl0ZXM7CitzdGF0aWMgdW5zaWduZWQgaW50IGRlYnVndHJhY2VfdXNlZDsKK3N0YXRp
YyBERUZJTkVfU1BJTkxPQ0soZGVidWd0cmFjZV9sb2NrKTsKK2ludGVnZXJfcGFyYW0oImRlYnVn
dHJhY2UiLCBkZWJ1Z3RyYWNlX2tpbG9ieXRlcyk7CisKK3N0YXRpYyB2b2lkIGRlYnVndHJhY2Vf
ZHVtcF93b3JrZXIodm9pZCkKK3sKKyAgICBpZiAoIChkZWJ1Z3RyYWNlX2J5dGVzID09IDApIHx8
ICFkZWJ1Z3RyYWNlX3VzZWQgKQorICAgICAgICByZXR1cm47CisKKyAgICBwcmludGsoImRlYnVn
dHJhY2VfZHVtcCgpIHN0YXJ0aW5nXG4iKTsKKworICAgIC8qIFByaW50IG9sZGVzdCBwb3J0aW9u
IG9mIHRoZSByaW5nLiAqLworICAgIGlmICggZGVidWd0cmFjZV9idWZbZGVidWd0cmFjZV9wcmRd
ICE9ICdcMCcgKQorICAgICAgICBjb25zb2xlX3NlcmlhbF9wdXRzKCZkZWJ1Z3RyYWNlX2J1Zltk
ZWJ1Z3RyYWNlX3ByZF0sCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVidWd0cmFjZV9i
eXRlcyAtIGRlYnVndHJhY2VfcHJkKTsKKworICAgIC8qIFByaW50IHlvdW5nZXN0IHBvcnRpb24g
b2YgdGhlIHJpbmcuICovCisgICAgZGVidWd0cmFjZV9idWZbZGVidWd0cmFjZV9wcmRdID0gJ1ww
JzsKKyAgICBjb25zb2xlX3NlcmlhbF9wdXRzKCZkZWJ1Z3RyYWNlX2J1ZlswXSwgZGVidWd0cmFj
ZV9wcmQpOworCisgICAgbWVtc2V0KGRlYnVndHJhY2VfYnVmLCAnXDAnLCBkZWJ1Z3RyYWNlX2J5
dGVzKTsKKyAgICBkZWJ1Z3RyYWNlX3ByZCA9IDA7CisgICAgZGVidWd0cmFjZV9wcmRfbGFzdCA9
IDA7CisKKyAgICBwcmludGsoImRlYnVndHJhY2VfZHVtcCgpIGZpbmlzaGVkXG4iKTsKK30KKwor
c3RhdGljIHZvaWQgZGVidWd0cmFjZV90b2dnbGUodm9pZCkKK3sKKyAgICB1bnNpZ25lZCBsb25n
IGZsYWdzOworCisgICAgd2F0Y2hkb2dfZGlzYWJsZSgpOworICAgIHNwaW5fbG9ja19pcnFzYXZl
KCZkZWJ1Z3RyYWNlX2xvY2ssIGZsYWdzKTsKKworICAgIC8qCisgICAgICogRHVtcCB0aGUgYnVm
ZmVyICpiZWZvcmUqIHRvZ2dsaW5nLCBpbiBjYXNlIHRoZSBhY3Qgb2YgZHVtcGluZyB0aGUKKyAg
ICAgKiBidWZmZXIgaXRzZWxmIGNhdXNlcyBtb3JlIHByaW50aygpIGludm9jYXRpb25zLgorICAg
ICAqLworICAgIHByaW50aygiZGVidWd0cmFjZV9wcmludGsgbm93IHdyaXRpbmcgdG8gJXMuXG4i
LAorICAgICAgICAgICAhZGVidWd0cmFjZV9zZW5kX3RvX2NvbnNvbGUgPyAiY29uc29sZSI6ICJi
dWZmZXIiKTsKKyAgICBpZiAoICFkZWJ1Z3RyYWNlX3NlbmRfdG9fY29uc29sZSApCisgICAgICAg
IGRlYnVndHJhY2VfZHVtcF93b3JrZXIoKTsKKworICAgIGRlYnVndHJhY2Vfc2VuZF90b19jb25z
b2xlID0gIWRlYnVndHJhY2Vfc2VuZF90b19jb25zb2xlOworCisgICAgc3Bpbl91bmxvY2tfaXJx
cmVzdG9yZSgmZGVidWd0cmFjZV9sb2NrLCBmbGFncyk7CisgICAgd2F0Y2hkb2dfZW5hYmxlKCk7
CisKK30KKwordm9pZCBkZWJ1Z3RyYWNlX2R1bXAodm9pZCkKK3sKKyAgICB1bnNpZ25lZCBsb25n
IGZsYWdzOworCisgICAgd2F0Y2hkb2dfZGlzYWJsZSgpOworICAgIHNwaW5fbG9ja19pcnFzYXZl
KCZkZWJ1Z3RyYWNlX2xvY2ssIGZsYWdzKTsKKworICAgIGRlYnVndHJhY2VfZHVtcF93b3JrZXIo
KTsKKworICAgIHNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmRlYnVndHJhY2VfbG9jaywgZmxhZ3Mp
OworICAgIHdhdGNoZG9nX2VuYWJsZSgpOworfQorCitzdGF0aWMgdm9pZCBkZWJ1Z3RyYWNlX2Fk
ZF90b19idWYoY2hhciAqYnVmKQoreworICAgIGNoYXIgKnA7CisKKyAgICBmb3IgKCBwID0gYnVm
OyAqcCAhPSAnXDAnOyBwKysgKQorICAgIHsKKyAgICAgICAgZGVidWd0cmFjZV9idWZbZGVidWd0
cmFjZV9wcmQrK10gPSAqcDsKKyAgICAgICAgaWYgKCBkZWJ1Z3RyYWNlX3ByZCA9PSBkZWJ1Z3Ry
YWNlX2J5dGVzICkKKyAgICAgICAgICAgIGRlYnVndHJhY2VfcHJkID0gMDsKKyAgICB9Cit9CisK
K3ZvaWQgZGVidWd0cmFjZV9wcmludGsoY29uc3QgY2hhciAqZm10LCAuLi4pCit7CisgICAgc3Rh
dGljIGNoYXIgYnVmWzEwMjRdLCBsYXN0X2J1ZlsxMDI0XTsKKyAgICBzdGF0aWMgdW5zaWduZWQg
aW50IGNvdW50LCBsYXN0X2NvdW50OworCisgICAgY2hhciAgICAgICAgICBjbnRidWZbMjRdOwor
ICAgIHZhX2xpc3QgICAgICAgYXJnczsKKyAgICB1bnNpZ25lZCBsb25nIGZsYWdzOworICAgIHVu
c2lnbmVkIGludCBucjsKKworICAgIGlmICggZGVidWd0cmFjZV9ieXRlcyA9PSAwICkKKyAgICAg
ICAgcmV0dXJuOworCisgICAgZGVidWd0cmFjZV91c2VkID0gMTsKKworICAgIHNwaW5fbG9ja19p
cnFzYXZlKCZkZWJ1Z3RyYWNlX2xvY2ssIGZsYWdzKTsKKworICAgIHZhX3N0YXJ0KGFyZ3MsIGZt
dCk7CisgICAgbnIgPSB2c25wcmludGYoYnVmLCBzaXplb2YoYnVmKSwgZm10LCBhcmdzKTsKKyAg
ICB2YV9lbmQoYXJncyk7CisKKyAgICBpZiAoIGRlYnVndHJhY2Vfc2VuZF90b19jb25zb2xlICkK
KyAgICB7CisgICAgICAgIHVuc2lnbmVkIGludCBuID0gc2NucHJpbnRmKGNudGJ1Ziwgc2l6ZW9m
KGNudGJ1ZiksICIldSAiLCArK2NvdW50KTsKKworICAgICAgICBjb25zb2xlX3NlcmlhbF9wdXRz
KGNudGJ1Ziwgbik7CisgICAgICAgIGNvbnNvbGVfc2VyaWFsX3B1dHMoYnVmLCBucik7CisgICAg
fQorICAgIGVsc2UKKyAgICB7CisgICAgICAgIGlmICggc3RyY21wKGJ1ZiwgbGFzdF9idWYpICkK
KyAgICAgICAgeworICAgICAgICAgICAgZGVidWd0cmFjZV9wcmRfbGFzdCA9IGRlYnVndHJhY2Vf
cHJkOworICAgICAgICAgICAgbGFzdF9jb3VudCA9ICsrY291bnQ7CisgICAgICAgICAgICBzYWZl
X3N0cmNweShsYXN0X2J1ZiwgYnVmKTsKKyAgICAgICAgICAgIHNucHJpbnRmKGNudGJ1Ziwgc2l6
ZW9mKGNudGJ1ZiksICIldSAiLCBjb3VudCk7CisgICAgICAgIH0KKyAgICAgICAgZWxzZQorICAg
ICAgICB7CisgICAgICAgICAgICBkZWJ1Z3RyYWNlX3ByZCA9IGRlYnVndHJhY2VfcHJkX2xhc3Q7
CisgICAgICAgICAgICBzbnByaW50ZihjbnRidWYsIHNpemVvZihjbnRidWYpLCAiJXUtJXUgIiwg
bGFzdF9jb3VudCwgKytjb3VudCk7CisgICAgICAgIH0KKyAgICAgICAgZGVidWd0cmFjZV9hZGRf
dG9fYnVmKGNudGJ1Zik7CisgICAgICAgIGRlYnVndHJhY2VfYWRkX3RvX2J1ZihidWYpOworICAg
IH0KKworICAgIHNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmRlYnVndHJhY2VfbG9jaywgZmxhZ3Mp
OworfQorCitzdGF0aWMgdm9pZCBkZWJ1Z3RyYWNlX2tleSh1bnNpZ25lZCBjaGFyIGtleSkKK3sK
KyAgICBkZWJ1Z3RyYWNlX3RvZ2dsZSgpOworfQorCitzdGF0aWMgaW50IF9faW5pdCBkZWJ1Z3Ry
YWNlX2luaXQodm9pZCkKK3sKKyAgICBpbnQgb3JkZXI7CisgICAgdW5zaWduZWQgaW50IGtieXRl
cywgYnl0ZXM7CisKKyAgICAvKiBSb3VuZCBzaXplIGRvd24gdG8gbmV4dCBwb3dlciBvZiB0d28u
ICovCisgICAgd2hpbGUgKCAoa2J5dGVzID0gKGRlYnVndHJhY2Vfa2lsb2J5dGVzICYgKGRlYnVn
dHJhY2Vfa2lsb2J5dGVzLTEpKSkgIT0gMCApCisgICAgICAgIGRlYnVndHJhY2Vfa2lsb2J5dGVz
ID0ga2J5dGVzOworCisgICAgYnl0ZXMgPSBkZWJ1Z3RyYWNlX2tpbG9ieXRlcyA8PCAxMDsKKyAg
ICBpZiAoIGJ5dGVzID09IDAgKQorICAgICAgICByZXR1cm4gMDsKKworICAgIG9yZGVyID0gZ2V0
X29yZGVyX2Zyb21fYnl0ZXMoYnl0ZXMpOworICAgIGRlYnVndHJhY2VfYnVmID0gYWxsb2NfeGVu
aGVhcF9wYWdlcyhvcmRlciwgMCk7CisgICAgQVNTRVJUKGRlYnVndHJhY2VfYnVmICE9IE5VTEwp
OworCisgICAgbWVtc2V0KGRlYnVndHJhY2VfYnVmLCAnXDAnLCBieXRlcyk7CisKKyAgICBkZWJ1
Z3RyYWNlX2J5dGVzID0gYnl0ZXM7CisKKyAgICByZWdpc3Rlcl9rZXloYW5kbGVyKCdUJywgZGVi
dWd0cmFjZV9rZXksCisgICAgICAgICAgICAgICAgICAgICAgICAidG9nZ2xlIGRlYnVndHJhY2Ug
dG8gY29uc29sZS9idWZmZXIiLCAwKTsKKworICAgIHJldHVybiAwOworfQorX19pbml0Y2FsbChk
ZWJ1Z3RyYWNlX2luaXQpOworCmRpZmYgLS1naXQgYS94ZW4vZHJpdmVycy9jaGFyL2NvbnNvbGUu
YyBiL3hlbi9kcml2ZXJzL2NoYXIvY29uc29sZS5jCmluZGV4IDYyNDc3YTk3MjguLjdmMjkxOTBl
YWYgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL2NoYXIvY29uc29sZS5jCisrKyBiL3hlbi9kcml2
ZXJzL2NoYXIvY29uc29sZS5jCkBAIC0xMTYwLDE4MiArMTE2MCw3IEBAIGludCBwcmludGtfcmF0
ZWxpbWl0KHZvaWQpCiAKIC8qCiAgKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKgotICogKioqKioqKioqKioqKioqIFNlcmlhbCBj
b25zb2xlIHJpbmcgYnVmZmVyICoqKioqKioqKioqKioqKioqKioKLSAqICoqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCi0gKi8KLQot
I2lmZGVmIENPTkZJR19ERUJVR19UUkFDRQotCi0vKiBTZW5kIG91dHB1dCBkaXJlY3QgdG8gY29u
c29sZSwgb3IgYnVmZmVyIGl0PyAqLwotc3RhdGljIHZvbGF0aWxlIGludCBkZWJ1Z3RyYWNlX3Nl
bmRfdG9fY29uc29sZTsKLQotc3RhdGljIGNoYXIgICAgICAgICpkZWJ1Z3RyYWNlX2J1ZjsgLyog
RGVidWctdHJhY2UgYnVmZmVyICovCi1zdGF0aWMgdW5zaWduZWQgaW50IGRlYnVndHJhY2VfcHJk
OyAvKiBQcm9kdWNlciBpbmRleCAgICAgKi8KLXN0YXRpYyB1bnNpZ25lZCBpbnQgZGVidWd0cmFj
ZV9wcmRfbGFzdDsKLXN0YXRpYyB1bnNpZ25lZCBpbnQgZGVidWd0cmFjZV9raWxvYnl0ZXMgPSAx
MjgsIGRlYnVndHJhY2VfYnl0ZXM7Ci1zdGF0aWMgdW5zaWduZWQgaW50IGRlYnVndHJhY2VfdXNl
ZDsKLXN0YXRpYyBERUZJTkVfU1BJTkxPQ0soZGVidWd0cmFjZV9sb2NrKTsKLWludGVnZXJfcGFy
YW0oImRlYnVndHJhY2UiLCBkZWJ1Z3RyYWNlX2tpbG9ieXRlcyk7Ci0KLXN0YXRpYyB2b2lkIGRl
YnVndHJhY2VfZHVtcF93b3JrZXIodm9pZCkKLXsKLSAgICBpZiAoIChkZWJ1Z3RyYWNlX2J5dGVz
ID09IDApIHx8ICFkZWJ1Z3RyYWNlX3VzZWQgKQotICAgICAgICByZXR1cm47Ci0KLSAgICBwcmlu
dGsoImRlYnVndHJhY2VfZHVtcCgpIHN0YXJ0aW5nXG4iKTsKLQotICAgIC8qIFByaW50IG9sZGVz
dCBwb3J0aW9uIG9mIHRoZSByaW5nLiAqLwotICAgIGlmICggZGVidWd0cmFjZV9idWZbZGVidWd0
cmFjZV9wcmRdICE9ICdcMCcgKQotICAgICAgICBjb25zb2xlX3NlcmlhbF9wdXRzKCZkZWJ1Z3Ry
YWNlX2J1ZltkZWJ1Z3RyYWNlX3ByZF0sCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVi
dWd0cmFjZV9ieXRlcyAtIGRlYnVndHJhY2VfcHJkKTsKLQotICAgIC8qIFByaW50IHlvdW5nZXN0
IHBvcnRpb24gb2YgdGhlIHJpbmcuICovCi0gICAgZGVidWd0cmFjZV9idWZbZGVidWd0cmFjZV9w
cmRdID0gJ1wwJzsKLSAgICBjb25zb2xlX3NlcmlhbF9wdXRzKCZkZWJ1Z3RyYWNlX2J1ZlswXSwg
ZGVidWd0cmFjZV9wcmQpOwotCi0gICAgbWVtc2V0KGRlYnVndHJhY2VfYnVmLCAnXDAnLCBkZWJ1
Z3RyYWNlX2J5dGVzKTsKLSAgICBkZWJ1Z3RyYWNlX3ByZCA9IDA7Ci0gICAgZGVidWd0cmFjZV9w
cmRfbGFzdCA9IDA7Ci0KLSAgICBwcmludGsoImRlYnVndHJhY2VfZHVtcCgpIGZpbmlzaGVkXG4i
KTsKLX0KLQotc3RhdGljIHZvaWQgZGVidWd0cmFjZV90b2dnbGUodm9pZCkKLXsKLSAgICB1bnNp
Z25lZCBsb25nIGZsYWdzOwotCi0gICAgd2F0Y2hkb2dfZGlzYWJsZSgpOwotICAgIHNwaW5fbG9j
a19pcnFzYXZlKCZkZWJ1Z3RyYWNlX2xvY2ssIGZsYWdzKTsKLQotICAgIC8qCi0gICAgICogRHVt
cCB0aGUgYnVmZmVyICpiZWZvcmUqIHRvZ2dsaW5nLCBpbiBjYXNlIHRoZSBhY3Qgb2YgZHVtcGlu
ZyB0aGUKLSAgICAgKiBidWZmZXIgaXRzZWxmIGNhdXNlcyBtb3JlIHByaW50aygpIGludm9jYXRp
b25zLgotICAgICAqLwotICAgIHByaW50aygiZGVidWd0cmFjZV9wcmludGsgbm93IHdyaXRpbmcg
dG8gJXMuXG4iLAotICAgICAgICAgICAhZGVidWd0cmFjZV9zZW5kX3RvX2NvbnNvbGUgPyAiY29u
c29sZSI6ICJidWZmZXIiKTsKLSAgICBpZiAoICFkZWJ1Z3RyYWNlX3NlbmRfdG9fY29uc29sZSAp
Ci0gICAgICAgIGRlYnVndHJhY2VfZHVtcF93b3JrZXIoKTsKLQotICAgIGRlYnVndHJhY2Vfc2Vu
ZF90b19jb25zb2xlID0gIWRlYnVndHJhY2Vfc2VuZF90b19jb25zb2xlOwotCi0gICAgc3Bpbl91
bmxvY2tfaXJxcmVzdG9yZSgmZGVidWd0cmFjZV9sb2NrLCBmbGFncyk7Ci0gICAgd2F0Y2hkb2df
ZW5hYmxlKCk7Ci0KLX0KLQotdm9pZCBkZWJ1Z3RyYWNlX2R1bXAodm9pZCkKLXsKLSAgICB1bnNp
Z25lZCBsb25nIGZsYWdzOwotCi0gICAgd2F0Y2hkb2dfZGlzYWJsZSgpOwotICAgIHNwaW5fbG9j
a19pcnFzYXZlKCZkZWJ1Z3RyYWNlX2xvY2ssIGZsYWdzKTsKLQotICAgIGRlYnVndHJhY2VfZHVt
cF93b3JrZXIoKTsKLQotICAgIHNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmRlYnVndHJhY2VfbG9j
aywgZmxhZ3MpOwotICAgIHdhdGNoZG9nX2VuYWJsZSgpOwotfQotCi1zdGF0aWMgdm9pZCBkZWJ1
Z3RyYWNlX2FkZF90b19idWYoY2hhciAqYnVmKQotewotICAgIGNoYXIgKnA7Ci0KLSAgICBmb3Ig
KCBwID0gYnVmOyAqcCAhPSAnXDAnOyBwKysgKQotICAgIHsKLSAgICAgICAgZGVidWd0cmFjZV9i
dWZbZGVidWd0cmFjZV9wcmQrK10gPSAqcDsKLSAgICAgICAgaWYgKCBkZWJ1Z3RyYWNlX3ByZCA9
PSBkZWJ1Z3RyYWNlX2J5dGVzICkKLSAgICAgICAgICAgIGRlYnVndHJhY2VfcHJkID0gMDsKLSAg
ICB9Ci19Ci0KLXZvaWQgZGVidWd0cmFjZV9wcmludGsoY29uc3QgY2hhciAqZm10LCAuLi4pCi17
Ci0gICAgc3RhdGljIGNoYXIgYnVmWzEwMjRdLCBsYXN0X2J1ZlsxMDI0XTsKLSAgICBzdGF0aWMg
dW5zaWduZWQgaW50IGNvdW50LCBsYXN0X2NvdW50OwotCi0gICAgY2hhciAgICAgICAgICBjbnRi
dWZbMjRdOwotICAgIHZhX2xpc3QgICAgICAgYXJnczsKLSAgICB1bnNpZ25lZCBsb25nIGZsYWdz
OwotICAgIHVuc2lnbmVkIGludCBucjsKLQotICAgIGlmICggZGVidWd0cmFjZV9ieXRlcyA9PSAw
ICkKLSAgICAgICAgcmV0dXJuOwotCi0gICAgZGVidWd0cmFjZV91c2VkID0gMTsKLQotICAgIHNw
aW5fbG9ja19pcnFzYXZlKCZkZWJ1Z3RyYWNlX2xvY2ssIGZsYWdzKTsKLQotICAgIHZhX3N0YXJ0
KGFyZ3MsIGZtdCk7Ci0gICAgbnIgPSB2c2NucHJpbnRmKGJ1Ziwgc2l6ZW9mKGJ1ZiksIGZtdCwg
YXJncyk7Ci0gICAgdmFfZW5kKGFyZ3MpOwotCi0gICAgaWYgKCBkZWJ1Z3RyYWNlX3NlbmRfdG9f
Y29uc29sZSApCi0gICAgewotICAgICAgICB1bnNpZ25lZCBpbnQgbiA9IHNjbnByaW50ZihjbnRi
dWYsIHNpemVvZihjbnRidWYpLCAiJXUgIiwgKytjb3VudCk7Ci0KLSAgICAgICAgY29uc29sZV9z
ZXJpYWxfcHV0cyhjbnRidWYsIG4pOwotICAgICAgICBjb25zb2xlX3NlcmlhbF9wdXRzKGJ1Ziwg
bnIpOwotICAgIH0KLSAgICBlbHNlCi0gICAgewotICAgICAgICBpZiAoIHN0cmNtcChidWYsIGxh
c3RfYnVmKSApCi0gICAgICAgIHsKLSAgICAgICAgICAgIGRlYnVndHJhY2VfcHJkX2xhc3QgPSBk
ZWJ1Z3RyYWNlX3ByZDsKLSAgICAgICAgICAgIGxhc3RfY291bnQgPSArK2NvdW50OwotICAgICAg
ICAgICAgc2FmZV9zdHJjcHkobGFzdF9idWYsIGJ1Zik7Ci0gICAgICAgICAgICBzbnByaW50Zihj
bnRidWYsIHNpemVvZihjbnRidWYpLCAiJXUgIiwgY291bnQpOwotICAgICAgICB9Ci0gICAgICAg
IGVsc2UKLSAgICAgICAgewotICAgICAgICAgICAgZGVidWd0cmFjZV9wcmQgPSBkZWJ1Z3RyYWNl
X3ByZF9sYXN0OwotICAgICAgICAgICAgc25wcmludGYoY250YnVmLCBzaXplb2YoY250YnVmKSwg
IiV1LSV1ICIsIGxhc3RfY291bnQsICsrY291bnQpOwotICAgICAgICB9Ci0gICAgICAgIGRlYnVn
dHJhY2VfYWRkX3RvX2J1ZihjbnRidWYpOwotICAgICAgICBkZWJ1Z3RyYWNlX2FkZF90b19idWYo
YnVmKTsKLSAgICB9Ci0KLSAgICBzcGluX3VubG9ja19pcnFyZXN0b3JlKCZkZWJ1Z3RyYWNlX2xv
Y2ssIGZsYWdzKTsKLX0KLQotc3RhdGljIHZvaWQgZGVidWd0cmFjZV9rZXkodW5zaWduZWQgY2hh
ciBrZXkpCi17Ci0gICAgZGVidWd0cmFjZV90b2dnbGUoKTsKLX0KLQotc3RhdGljIGludCBfX2lu
aXQgZGVidWd0cmFjZV9pbml0KHZvaWQpCi17Ci0gICAgaW50IG9yZGVyOwotICAgIHVuc2lnbmVk
IGludCBrYnl0ZXMsIGJ5dGVzOwotCi0gICAgLyogUm91bmQgc2l6ZSBkb3duIHRvIG5leHQgcG93
ZXIgb2YgdHdvLiAqLwotICAgIHdoaWxlICggKGtieXRlcyA9IChkZWJ1Z3RyYWNlX2tpbG9ieXRl
cyAmIChkZWJ1Z3RyYWNlX2tpbG9ieXRlcy0xKSkpICE9IDAgKQotICAgICAgICBkZWJ1Z3RyYWNl
X2tpbG9ieXRlcyA9IGtieXRlczsKLQotICAgIGJ5dGVzID0gZGVidWd0cmFjZV9raWxvYnl0ZXMg
PDwgMTA7Ci0gICAgaWYgKCBieXRlcyA9PSAwICkKLSAgICAgICAgcmV0dXJuIDA7Ci0KLSAgICBv
cmRlciA9IGdldF9vcmRlcl9mcm9tX2J5dGVzKGJ5dGVzKTsKLSAgICBkZWJ1Z3RyYWNlX2J1ZiA9
IGFsbG9jX3hlbmhlYXBfcGFnZXMob3JkZXIsIDApOwotICAgIEFTU0VSVChkZWJ1Z3RyYWNlX2J1
ZiAhPSBOVUxMKTsKLQotICAgIG1lbXNldChkZWJ1Z3RyYWNlX2J1ZiwgJ1wwJywgYnl0ZXMpOwot
Ci0gICAgZGVidWd0cmFjZV9ieXRlcyA9IGJ5dGVzOwotCi0gICAgcmVnaXN0ZXJfa2V5aGFuZGxl
cignVCcsIGRlYnVndHJhY2Vfa2V5LAotICAgICAgICAgICAgICAgICAgICAgICAgInRvZ2dsZSBk
ZWJ1Z3RyYWNlIHRvIGNvbnNvbGUvYnVmZmVyIiwgMCk7Ci0KLSAgICByZXR1cm4gMDsKLX0KLV9f
aW5pdGNhbGwoZGVidWd0cmFjZV9pbml0KTsKLQotI2VuZGlmIC8qICFDT05GSUdfREVCVUdfVFJB
Q0UgKi8KLQotCi0vKgotICogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioKLSAqICoqKioqKioqKioqKioqKiBEZWJ1Z2dpbmcvdHJh
Y2luZy9lcnJvci1yZXBvcnQgKioqKioqKioqKioqKioqCisgKiAqKioqKioqKioqKioqKioqKioq
KioqIEVycm9yLXJlcG9ydCAqKioqKioqKioqKioqKioqKioqKioqKioqKgogICogKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAq
LwogCi0tIAoyLjE2LjQKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0
Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRl
dmVs

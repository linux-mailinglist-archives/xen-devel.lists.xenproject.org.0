Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 6F83CBFFA7
	for <lists+xen-devel@lfdr.de>; Fri, 27 Sep 2019 09:04:58 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iDkFy-0003V3-AD; Fri, 27 Sep 2019 07:01:34 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=Rbpq=XW=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1iDkFw-0003TS-P8
 for xen-devel@lists.xenproject.org; Fri, 27 Sep 2019 07:01:32 +0000
X-Inumbo-ID: 8ed177bc-e0f4-11e9-97fb-bc764e2007e4
Received: from mx1.suse.de (unknown [195.135.220.15])
 by localhost (Halon) with ESMTPS
 id 8ed177bc-e0f4-11e9-97fb-bc764e2007e4;
 Fri, 27 Sep 2019 07:01:00 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 82028AFE8;
 Fri, 27 Sep 2019 07:00:56 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Fri, 27 Sep 2019 09:00:11 +0200
Message-Id: <20190927070050.12405-8-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190927070050.12405-1-jgross@suse.com>
References: <20190927070050.12405-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v4 07/46] xen/sched: move per cpu scheduler
 private data into struct sched_resource
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Tim Deegan <tim@xen.org>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>,
 Robert VanVossen <robert.vanvossen@dornerworks.com>,
 Dario Faggioli <dfaggioli@suse.com>, Julien Grall <julien.grall@arm.com>,
 Josh Whitehead <josh.whitehead@dornerworks.com>,
 Meng Xu <mengxu@cis.upenn.edu>, Jan Beulich <jbeulich@suse.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhpcyBwcmVwYXJlcyBzdXBwb3J0IG9mIGxhcmdlciBzY2hlZHVsaW5nIGdyYW51bGFyaXRpZXMs
IGUuZy4gY29yZQpzY2hlZHVsaW5nLgoKV2hpbGUgYXQgaXQgbW92ZSBzY2hlZF9oYXNfdXJnZW50
X3ZjcHUoKSBmcm9tIGluY2x1ZGUvYXNtLXg4Ni9jcHVpZGxlLmgKaW50byBzY2hlZC5oIHJlbW92
aW5nIHRoZSBuZWVkIGZvciBpbmNsdWRpbmcgc2NoZWQtaWYuaCBpbiBjcHVpZGxlLmguCkZvciB0
aGF0IHB1cnBvc2UgcmVtb2JlIHVyZ2VudF9jb3VudCBmcm9tIHRoZSBzY2hlZHVsZXIgcHJpdmF0
ZSBkYXRhCmFuZCBtYWtlIGl0IGEgcGxhaW4gcGVyY3B1IHZhcmlhYmxlLgoKU2lnbmVkLW9mZi1i
eTogSnVlcmdlbiBHcm9zcyA8amdyb3NzQHN1c2UuY29tPgpSZXZpZXdlZC1ieTogSmFuIEJldWxp
Y2ggPGpiZXVsaWNoQHN1c2UuY29tPgpSZXZpZXdlZC1ieTogRGFyaW8gRmFnZ2lvbGkgPGRmYWdn
aW9saUBzdXNlLmNvbT4KLS0tClYxOgotIG1vdmUgc2NoZWRfaGFzX3VyZ2VudF92Y3B1KCkKVjI6
Ci0gbWFrZSBzY2hlZF9oYXNfdXJnZW50X3ZjcHUoKSByZXR1cm4gYm9vbCAoSmFuIEJldWxpY2gp
ClYzOgotIHNwbGl0IG91dCByZW1vdmluZyBzY2hlZC1pZi5oIGluY2x1ZGUgaW4gc29tZSBDIGZp
bGVzIChKYW4gQmV1bGljaCkKLSBtYWtlIHVyZ2VudF9jb3VudCBhIHBsYWluIHBlcmNwdSB2YXJp
YWJsZSAoSmFuIEJldWxpY2gpClY0OgotIGF2b2lkIGludHJvZHVjaW5nIGxvY2FsIHZhcmlhYmxl
cyB1c2VkIG9ubHkgb25jZSAoSmFuIEJldWxpY2gpCi0gbmFtZSBzY2hlZF9yZXNvdXJjZSBwb2lu
dGVycyAic3IiIChKYW4gQmV1bGljaCkKLSBtYWtlIGN1cnJfb25fY3B1KCkgYSBzdGF0aWMgaW5s
aW5lIGZ1bmN0aW9uIChKYW4gQmV1bGljaCkKLS0tCiB4ZW4vY29tbW9uL3NjaGVkX2FyaW5jNjUz
LmMgICB8ICA2ICsrLS0KIHhlbi9jb21tb24vc2NoZWRfY3JlZGl0LmMgICAgIHwgMTIgKysrKy0t
LS0KIHhlbi9jb21tb24vc2NoZWRfY3JlZGl0Mi5jICAgIHwgMjAgKysrKysrLS0tLS0tLQogeGVu
L2NvbW1vbi9zY2hlZF9udWxsLmMgICAgICAgfCAgNiArKy0tCiB4ZW4vY29tbW9uL3NjaGVkX3J0
LmMgICAgICAgICB8ICA4ICsrLS0tCiB4ZW4vY29tbW9uL3NjaGVkdWxlLmMgICAgICAgICB8IDY5
ICsrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLS0tLS0KIHhlbi9pbmNsdWRl
L2FzbS14ODYvY3B1aWRsZS5oIHwgMTEgLS0tLS0tLQogeGVuL2luY2x1ZGUveGVuL3NjaGVkLWlm
LmggICAgfCAyNiArKysrKysrKy0tLS0tLS0tCiB4ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaCAgICAg
ICB8IDExICsrKysrKysKIDkgZmlsZXMgY2hhbmdlZCwgODUgaW5zZXJ0aW9ucygrKSwgODQgZGVs
ZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZF9hcmluYzY1My5jIGIveGVu
L2NvbW1vbi9zY2hlZF9hcmluYzY1My5jCmluZGV4IDdiZGFmMjU3Y2UuLjVjZjQ3ZjU2MjIgMTAw
NjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWRfYXJpbmM2NTMuYworKysgYi94ZW4vY29tbW9uL3Nj
aGVkX2FyaW5jNjUzLmMKQEAgLTQ4MSw3ICs0ODEsNyBAQCBhNjUzc2NoZWRfdW5pdF9zbGVlcChj
b25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogICAg
ICAqIElmIHRoZSBWQ1BVIGJlaW5nIHB1dCB0byBzbGVlcCBpcyB0aGUgc2FtZSBvbmUgdGhhdCBp
cyBjdXJyZW50bHkKICAgICAgKiBydW5uaW5nLCByYWlzZSBhIHNvZnRpcnEgdG8gaW52b2tlIHRo
ZSBzY2hlZHVsZXIgdG8gc3dpdGNoIGRvbWFpbnMuCiAgICAgICovCi0gICAgaWYgKCBwZXJfY3B1
KHNjaGVkdWxlX2RhdGEsIHZjLT5wcm9jZXNzb3IpLmN1cnIgPT0gdW5pdCApCisgICAgaWYgKCBn
ZXRfc2NoZWRfcmVzKHZjLT5wcm9jZXNzb3IpLT5jdXJyID09IHVuaXQgKQogICAgICAgICBjcHVf
cmFpc2Vfc29mdGlycSh2Yy0+cHJvY2Vzc29yLCBTQ0hFRFVMRV9TT0ZUSVJRKTsKIH0KIApAQCAt
NjQ5LDE0ICs2NDksMTQgQEAgc3RhdGljIHNwaW5sb2NrX3QgKgogYTY1M19zd2l0Y2hfc2NoZWQo
c3RydWN0IHNjaGVkdWxlciAqbmV3X29wcywgdW5zaWduZWQgaW50IGNwdSwKICAgICAgICAgICAg
ICAgICAgIHZvaWQgKnBkYXRhLCB2b2lkICp2ZGF0YSkKIHsKLSAgICBzdHJ1Y3Qgc2NoZWR1bGVf
ZGF0YSAqc2QgPSAmcGVyX2NwdShzY2hlZHVsZV9kYXRhLCBjcHUpOworICAgIHN0cnVjdCBzY2hl
ZF9yZXNvdXJjZSAqc3IgPSBnZXRfc2NoZWRfcmVzKGNwdSk7CiAgICAgYXJpbmM2NTNfdmNwdV90
ICpzdmMgPSB2ZGF0YTsKIAogICAgIEFTU0VSVCghcGRhdGEgJiYgc3ZjICYmIGlzX2lkbGVfdmNw
dShzdmMtPnZjKSk7CiAKICAgICBpZGxlX3ZjcHVbY3B1XS0+c2NoZWRfdW5pdC0+cHJpdiA9IHZk
YXRhOwogCi0gICAgcmV0dXJuICZzZC0+X2xvY2s7CisgICAgcmV0dXJuICZzci0+X2xvY2s7CiB9
CiAKIC8qKgpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQuYyBiL3hlbi9jb21t
b24vc2NoZWRfY3JlZGl0LmMKaW5kZXggY2ZlM2VkYzE0Yy4uNTlhNzdlODc0YiAxMDA2NDQKLS0t
IGEveGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQuYworKysgYi94ZW4vY29tbW9uL3NjaGVkX2NyZWRp
dC5jCkBAIC04Miw3ICs4Miw3IEBACiAjZGVmaW5lIENTQ0hFRF9QUklWKF9vcHMpICAgXAogICAg
ICgoc3RydWN0IGNzY2hlZF9wcml2YXRlICopKChfb3BzKS0+c2NoZWRfZGF0YSkpCiAjZGVmaW5l
IENTQ0hFRF9QQ1BVKF9jKSAgICAgXAotICAgICgoc3RydWN0IGNzY2hlZF9wY3B1ICopcGVyX2Nw
dShzY2hlZHVsZV9kYXRhLCBfYykuc2NoZWRfcHJpdikKKyAgICAoKHN0cnVjdCBjc2NoZWRfcGNw
dSAqKWdldF9zY2hlZF9yZXMoX2MpLT5zY2hlZF9wcml2KQogI2RlZmluZSBDU0NIRURfVU5JVCh1
bml0KSAgICgoc3RydWN0IGNzY2hlZF91bml0ICopICh1bml0KS0+cHJpdikKICNkZWZpbmUgQ1ND
SEVEX0RPTShfZG9tKSAgICAoKHN0cnVjdCBjc2NoZWRfZG9tICopIChfZG9tKS0+c2NoZWRfcHJp
dikKICNkZWZpbmUgUlVOUShfY3B1KSAgICAgICAgICAoJihDU0NIRURfUENQVShfY3B1KS0+cnVu
cSkpCkBAIC0yNTAsNyArMjUwLDcgQEAgc3RhdGljIGlubGluZSBib29sX3QgaXNfcnVucV9pZGxl
KHVuc2lnbmVkIGludCBjcHUpCiAgICAgLyoKICAgICAgKiBXZSdyZSBwZWVraW5nIGF0IGNwdSdz
IHJ1bnEsIHdlIG11c3QgaG9sZCB0aGUgcHJvcGVyIGxvY2suCiAgICAgICovCi0gICAgQVNTRVJU
KHNwaW5faXNfbG9ja2VkKHBlcl9jcHUoc2NoZWR1bGVfZGF0YSwgY3B1KS5zY2hlZHVsZV9sb2Nr
KSk7CisgICAgQVNTRVJUKHNwaW5faXNfbG9ja2VkKGdldF9zY2hlZF9yZXMoY3B1KS0+c2NoZWR1
bGVfbG9jaykpOwogCiAgICAgcmV0dXJuIGxpc3RfZW1wdHkoUlVOUShjcHUpKSB8fAogICAgICAg
ICAgICBpc19pZGxlX3ZjcHUoX19ydW5xX2VsZW0oUlVOUShjcHUpLT5uZXh0KS0+dmNwdSk7CkBA
IC0yNTksNyArMjU5LDcgQEAgc3RhdGljIGlubGluZSBib29sX3QgaXNfcnVucV9pZGxlKHVuc2ln
bmVkIGludCBjcHUpCiBzdGF0aWMgaW5saW5lIHZvaWQKIGluY19ucl9ydW5uYWJsZSh1bnNpZ25l
ZCBpbnQgY3B1KQogewotICAgIEFTU0VSVChzcGluX2lzX2xvY2tlZChwZXJfY3B1KHNjaGVkdWxl
X2RhdGEsIGNwdSkuc2NoZWR1bGVfbG9jaykpOworICAgIEFTU0VSVChzcGluX2lzX2xvY2tlZChn
ZXRfc2NoZWRfcmVzKGNwdSktPnNjaGVkdWxlX2xvY2spKTsKICAgICBDU0NIRURfUENQVShjcHUp
LT5ucl9ydW5uYWJsZSsrOwogCiB9CkBAIC0yNjcsNyArMjY3LDcgQEAgaW5jX25yX3J1bm5hYmxl
KHVuc2lnbmVkIGludCBjcHUpCiBzdGF0aWMgaW5saW5lIHZvaWQKIGRlY19ucl9ydW5uYWJsZSh1
bnNpZ25lZCBpbnQgY3B1KQogewotICAgIEFTU0VSVChzcGluX2lzX2xvY2tlZChwZXJfY3B1KHNj
aGVkdWxlX2RhdGEsIGNwdSkuc2NoZWR1bGVfbG9jaykpOworICAgIEFTU0VSVChzcGluX2lzX2xv
Y2tlZChnZXRfc2NoZWRfcmVzKGNwdSktPnNjaGVkdWxlX2xvY2spKTsKICAgICBBU1NFUlQoQ1ND
SEVEX1BDUFUoY3B1KS0+bnJfcnVubmFibGUgPj0gMSk7CiAgICAgQ1NDSEVEX1BDUFUoY3B1KS0+
bnJfcnVubmFibGUtLTsKIH0KQEAgLTYyOCw3ICs2MjgsNyBAQCBzdGF0aWMgc3BpbmxvY2tfdCAq
CiBjc2NoZWRfc3dpdGNoX3NjaGVkKHN0cnVjdCBzY2hlZHVsZXIgKm5ld19vcHMsIHVuc2lnbmVk
IGludCBjcHUsCiAgICAgICAgICAgICAgICAgICAgIHZvaWQgKnBkYXRhLCB2b2lkICp2ZGF0YSkK
IHsKLSAgICBzdHJ1Y3Qgc2NoZWR1bGVfZGF0YSAqc2QgPSAmcGVyX2NwdShzY2hlZHVsZV9kYXRh
LCBjcHUpOworICAgIHN0cnVjdCBzY2hlZF9yZXNvdXJjZSAqc3IgPSBnZXRfc2NoZWRfcmVzKGNw
dSk7CiAgICAgc3RydWN0IGNzY2hlZF9wcml2YXRlICpwcnYgPSBDU0NIRURfUFJJVihuZXdfb3Bz
KTsKICAgICBzdHJ1Y3QgY3NjaGVkX3VuaXQgKnN2YyA9IHZkYXRhOwogCkBAIC02NDYsNyArNjQ2
LDcgQEAgY3NjaGVkX3N3aXRjaF9zY2hlZChzdHJ1Y3Qgc2NoZWR1bGVyICpuZXdfb3BzLCB1bnNp
Z25lZCBpbnQgY3B1LAogICAgIGluaXRfcGRhdGEocHJ2LCBwZGF0YSwgY3B1KTsKICAgICBzcGlu
X3VubG9jaygmcHJ2LT5sb2NrKTsKIAotICAgIHJldHVybiAmc2QtPl9sb2NrOworICAgIHJldHVy
biAmc3ItPl9sb2NrOwogfQogCiAjaWZuZGVmIE5ERUJVRwpkaWZmIC0tZ2l0IGEveGVuL2NvbW1v
bi9zY2hlZF9jcmVkaXQyLmMgYi94ZW4vY29tbW9uL3NjaGVkX2NyZWRpdDIuYwppbmRleCBhZmVi
NzBiODQ1Li5lZjBkZDFkMjI4IDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL3NjaGVkX2NyZWRpdDIu
YworKysgYi94ZW4vY29tbW9uL3NjaGVkX2NyZWRpdDIuYwpAQCAtNTY4LDcgKzU2OCw3IEBAIHN0
YXRpYyBpbmxpbmUgc3RydWN0IGNzY2hlZDJfcHJpdmF0ZSAqY3NjaGVkMl9wcml2KGNvbnN0IHN0
cnVjdCBzY2hlZHVsZXIgKm9wcykKIAogc3RhdGljIGlubGluZSBzdHJ1Y3QgY3NjaGVkMl9wY3B1
ICpjc2NoZWQyX3BjcHUodW5zaWduZWQgaW50IGNwdSkKIHsKLSAgICByZXR1cm4gcGVyX2NwdShz
Y2hlZHVsZV9kYXRhLCBjcHUpLnNjaGVkX3ByaXY7CisgICAgcmV0dXJuIGdldF9zY2hlZF9yZXMo
Y3B1KS0+c2NoZWRfcHJpdjsKIH0KIAogc3RhdGljIGlubGluZSBzdHJ1Y3QgY3NjaGVkMl91bml0
ICpjc2NoZWQyX3VuaXQoY29uc3Qgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCkBAIC0xMjc3LDcg
KzEyNzcsNyBAQCBydW5xX2luc2VydChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVj
dCBjc2NoZWQyX3VuaXQgKnN2YykKICAgICBzdHJ1Y3QgbGlzdF9oZWFkICogcnVucSA9ICZjMnJx
ZChvcHMsIGNwdSktPnJ1bnE7CiAgICAgaW50IHBvcyA9IDA7CiAKLSAgICBBU1NFUlQoc3Bpbl9p
c19sb2NrZWQocGVyX2NwdShzY2hlZHVsZV9kYXRhLCBjcHUpLnNjaGVkdWxlX2xvY2spKTsKKyAg
ICBBU1NFUlQoc3Bpbl9pc19sb2NrZWQoZ2V0X3NjaGVkX3JlcyhjcHUpLT5zY2hlZHVsZV9sb2Nr
KSk7CiAKICAgICBBU1NFUlQoIXZjcHVfb25fcnVucShzdmMpKTsKICAgICBBU1NFUlQoYzJyKGNw
dSkgPT0gYzJyKHN2Yy0+dmNwdS0+cHJvY2Vzc29yKSk7CkBAIC0xNzk4LDcgKzE3OTgsNyBAQCBz
dGF0aWMgYm9vbCB2Y3B1X2dyYWJfYnVkZ2V0KHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YykKICAg
ICBzdHJ1Y3QgY3NjaGVkMl9kb20gKnNkb20gPSBzdmMtPnNkb207CiAgICAgdW5zaWduZWQgaW50
IGNwdSA9IHN2Yy0+dmNwdS0+cHJvY2Vzc29yOwogCi0gICAgQVNTRVJUKHNwaW5faXNfbG9ja2Vk
KHBlcl9jcHUoc2NoZWR1bGVfZGF0YSwgY3B1KS5zY2hlZHVsZV9sb2NrKSk7CisgICAgQVNTRVJU
KHNwaW5faXNfbG9ja2VkKGdldF9zY2hlZF9yZXMoY3B1KS0+c2NoZWR1bGVfbG9jaykpOwogCiAg
ICAgaWYgKCBzdmMtPmJ1ZGdldCA+IDAgKQogICAgICAgICByZXR1cm4gdHJ1ZTsKQEAgLTE4NDUs
NyArMTg0NSw3IEBAIHZjcHVfcmV0dXJuX2J1ZGdldChzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMs
IHN0cnVjdCBsaXN0X2hlYWQgKnBhcmtlZCkKICAgICBzdHJ1Y3QgY3NjaGVkMl9kb20gKnNkb20g
PSBzdmMtPnNkb207CiAgICAgdW5zaWduZWQgaW50IGNwdSA9IHN2Yy0+dmNwdS0+cHJvY2Vzc29y
OwogCi0gICAgQVNTRVJUKHNwaW5faXNfbG9ja2VkKHBlcl9jcHUoc2NoZWR1bGVfZGF0YSwgY3B1
KS5zY2hlZHVsZV9sb2NrKSk7CisgICAgQVNTRVJUKHNwaW5faXNfbG9ja2VkKGdldF9zY2hlZF9y
ZXMoY3B1KS0+c2NoZWR1bGVfbG9jaykpOwogICAgIEFTU0VSVChsaXN0X2VtcHR5KHBhcmtlZCkp
OwogCiAgICAgLyogYnVkZ2V0X2xvY2sgbmVzdHMgaW5zaWRlIHJ1bnF1ZXVlIGxvY2suICovCkBA
IC0yMTAyLDcgKzIxMDIsNyBAQCBjc2NoZWQyX3VuaXRfd2FrZShjb25zdCBzdHJ1Y3Qgc2NoZWR1
bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogICAgIHVuc2lnbmVkIGludCBjcHUg
PSB2Yy0+cHJvY2Vzc29yOwogICAgIHNfdGltZV90IG5vdzsKIAotICAgIEFTU0VSVChzcGluX2lz
X2xvY2tlZChwZXJfY3B1KHNjaGVkdWxlX2RhdGEsIGNwdSkuc2NoZWR1bGVfbG9jaykpOworICAg
IEFTU0VSVChzcGluX2lzX2xvY2tlZChnZXRfc2NoZWRfcmVzKGNwdSktPnNjaGVkdWxlX2xvY2sp
KTsKIAogICAgIEFTU0VSVCghaXNfaWRsZV92Y3B1KHZjKSk7CiAKQEAgLTIyMzAsNyArMjIzMCw3
IEBAIGNzY2hlZDJfcmVzX3BpY2soY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBjb25zdCBz
dHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKICAgICAgKiBqdXN0IGdyYWIgdGhlIHBydiBsb2NrLiAg
SW5zdGVhZCwgd2UnbGwgaGF2ZSB0byB0cnlsb2NrLCBhbmQKICAgICAgKiBkbyBzb21ldGhpbmcg
ZWxzZSByZWFzb25hYmxlIGlmIHdlIGZhaWwuCiAgICAgICovCi0gICAgQVNTRVJUKHNwaW5faXNf
bG9ja2VkKHBlcl9jcHUoc2NoZWR1bGVfZGF0YSwgY3B1KS5zY2hlZHVsZV9sb2NrKSk7CisgICAg
QVNTRVJUKHNwaW5faXNfbG9ja2VkKGdldF9zY2hlZF9yZXMoY3B1KS0+c2NoZWR1bGVfbG9jaykp
OwogCiAgICAgaWYgKCAhcmVhZF90cnlsb2NrKCZwcnYtPmxvY2spICkKICAgICB7CkBAIC0yNTcw
LDcgKzI1NzAsNyBAQCBzdGF0aWMgdm9pZCBiYWxhbmNlX2xvYWQoY29uc3Qgc3RydWN0IHNjaGVk
dWxlciAqb3BzLCBpbnQgY3B1LCBzX3RpbWVfdCBub3cpCiAgICAgICogb24gZWl0aGVyIHNpZGUg
bWF5IGJlIGVtcHR5KS4KICAgICAgKi8KIAotICAgIEFTU0VSVChzcGluX2lzX2xvY2tlZChwZXJf
Y3B1KHNjaGVkdWxlX2RhdGEsIGNwdSkuc2NoZWR1bGVfbG9jaykpOworICAgIEFTU0VSVChzcGlu
X2lzX2xvY2tlZChnZXRfc2NoZWRfcmVzKGNwdSktPnNjaGVkdWxlX2xvY2spKTsKICAgICBzdC5s
cnFkID0gYzJycWQob3BzLCBjcHUpOwogCiAgICAgdXBkYXRlX3J1bnFfbG9hZChvcHMsIHN0Lmxy
cWQsIDAsIG5vdyk7CkBAIC0zNDc2LDcgKzM0NzYsNyBAQCBjc2NoZWQyX3NjaGVkdWxlKAogICAg
IHJxZCA9IGMycnFkKG9wcywgY3B1KTsKICAgICBCVUdfT04oIWNwdW1hc2tfdGVzdF9jcHUoY3B1
LCAmcnFkLT5hY3RpdmUpKTsKIAotICAgIEFTU0VSVChzcGluX2lzX2xvY2tlZChwZXJfY3B1KHNj
aGVkdWxlX2RhdGEsIGNwdSkuc2NoZWR1bGVfbG9jaykpOworICAgIEFTU0VSVChzcGluX2lzX2xv
Y2tlZChnZXRfc2NoZWRfcmVzKGNwdSktPnNjaGVkdWxlX2xvY2spKTsKIAogICAgIEJVR19PTigh
aXNfaWRsZV92Y3B1KHNjdXJyLT52Y3B1KSAmJiBzY3Vyci0+cnFkICE9IHJxZCk7CiAKQEAgLTM4
NjcsNyArMzg2Nyw3IEBAIGNzY2hlZDJfaW5pdF9wZGF0YShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVy
ICpvcHMsIHZvaWQgKnBkYXRhLCBpbnQgY3B1KQogCiAgICAgcnFpID0gaW5pdF9wZGF0YShwcnYs
IHBkYXRhLCBjcHUpOwogICAgIC8qIE1vdmUgdGhlIHNjaGVkdWxlciBsb2NrIHRvIHRoZSBuZXcg
cnVucSBsb2NrLiAqLwotICAgIHBlcl9jcHUoc2NoZWR1bGVfZGF0YSwgY3B1KS5zY2hlZHVsZV9s
b2NrID0gJnBydi0+cnFkW3JxaV0ubG9jazsKKyAgICBnZXRfc2NoZWRfcmVzKGNwdSktPnNjaGVk
dWxlX2xvY2sgPSAmcHJ2LT5ycWRbcnFpXS5sb2NrOwogCiAgICAgLyogX05vdF8gcGNwdV9zY2hl
ZHVsZV91bmxvY2soKTogc2NoZWR1bGVfbG9jayBtYXkgaGF2ZSBjaGFuZ2VkISAqLwogICAgIHNw
aW5fdW5sb2NrKG9sZF9sb2NrKTsKQEAgLTM5MDYsNyArMzkwNiw3IEBAIGNzY2hlZDJfc3dpdGNo
X3NjaGVkKHN0cnVjdCBzY2hlZHVsZXIgKm5ld19vcHMsIHVuc2lnbmVkIGludCBjcHUsCiAgICAg
ICogdGhpcyBzY2hlZHVsZXIsIGFuZCBzbyBpdCdzIHNhZmUgdG8gaGF2ZSB0YWtlbiBpdCAvYmVm
b3JlLyBvdXIKICAgICAgKiBwcml2YXRlIGdsb2JhbCBsb2NrLgogICAgICAqLwotICAgIEFTU0VS
VChwZXJfY3B1KHNjaGVkdWxlX2RhdGEsIGNwdSkuc2NoZWR1bGVfbG9jayAhPSAmcHJ2LT5ycWRb
cnFpXS5sb2NrKTsKKyAgICBBU1NFUlQoZ2V0X3NjaGVkX3JlcyhjcHUpLT5zY2hlZHVsZV9sb2Nr
ICE9ICZwcnYtPnJxZFtycWldLmxvY2spOwogCiAgICAgd3JpdGVfdW5sb2NrKCZwcnYtPmxvY2sp
OwogCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3NjaGVkX251bGwuYyBiL3hlbi9jb21tb24vc2No
ZWRfbnVsbC5jCmluZGV4IDM2MTk3NzQzMTguLmI5NTIxNDYwMWYgMTAwNjQ0Ci0tLSBhL3hlbi9j
b21tb24vc2NoZWRfbnVsbC5jCisrKyBiL3hlbi9jb21tb24vc2NoZWRfbnVsbC5jCkBAIC0yNjks
NyArMjY5LDcgQEAgcGlja19yZXMoc3RydWN0IG51bGxfcHJpdmF0ZSAqcHJ2LCBjb25zdCBzdHJ1
Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKICAgICB1bnNpZ25lZCBpbnQgY3B1ID0gdi0+cHJvY2Vzc29y
LCBuZXdfY3B1OwogICAgIGNwdW1hc2tfdCAqY3B1cyA9IGNwdXBvb2xfZG9tYWluX2NwdW1hc2so
di0+ZG9tYWluKTsKIAotICAgIEFTU0VSVChzcGluX2lzX2xvY2tlZChwZXJfY3B1KHNjaGVkdWxl
X2RhdGEsIGNwdSkuc2NoZWR1bGVfbG9jaykpOworICAgIEFTU0VSVChzcGluX2lzX2xvY2tlZChn
ZXRfc2NoZWRfcmVzKGNwdSktPnNjaGVkdWxlX2xvY2spKTsKIAogICAgIGZvcl9lYWNoX2FmZmlu
aXR5X2JhbGFuY2Vfc3RlcCggYnMgKQogICAgIHsKQEAgLTQxOSw3ICs0MTksNyBAQCBzdGF0aWMg
c3BpbmxvY2tfdCAqbnVsbF9zd2l0Y2hfc2NoZWQoc3RydWN0IHNjaGVkdWxlciAqbmV3X29wcywK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgY3B1LAog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgKnBkYXRhLCB2b2lkICp2
ZGF0YSkKIHsKLSAgICBzdHJ1Y3Qgc2NoZWR1bGVfZGF0YSAqc2QgPSAmcGVyX2NwdShzY2hlZHVs
ZV9kYXRhLCBjcHUpOworICAgIHN0cnVjdCBzY2hlZF9yZXNvdXJjZSAqc3IgPSBnZXRfc2NoZWRf
cmVzKGNwdSk7CiAgICAgc3RydWN0IG51bGxfcHJpdmF0ZSAqcHJ2ID0gbnVsbF9wcml2KG5ld19v
cHMpOwogICAgIHN0cnVjdCBudWxsX3VuaXQgKm52YyA9IHZkYXRhOwogCkBAIC00MzYsNyArNDM2
LDcgQEAgc3RhdGljIHNwaW5sb2NrX3QgKm51bGxfc3dpdGNoX3NjaGVkKHN0cnVjdCBzY2hlZHVs
ZXIgKm5ld19vcHMsCiAKICAgICBpbml0X3BkYXRhKHBydiwgY3B1KTsKIAotICAgIHJldHVybiAm
c2QtPl9sb2NrOworICAgIHJldHVybiAmc3ItPl9sb2NrOwogfQogCiBzdGF0aWMgdm9pZCBudWxs
X3VuaXRfaW5zZXJ0KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKZGlmZiAtLWdpdCBhL3hl
bi9jb21tb24vc2NoZWRfcnQuYyBiL3hlbi9jb21tb24vc2NoZWRfcnQuYwppbmRleCA1N2RhNTVk
OTBmLi5hMTY4NjY4YTcwIDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL3NjaGVkX3J0LmMKKysrIGIv
eGVuL2NvbW1vbi9zY2hlZF9ydC5jCkBAIC03NSw3ICs3NSw3IEBACiAvKgogICogTG9ja2luZzoK
ICAqIEEgZ2xvYmFsIHN5c3RlbSBsb2NrIGlzIHVzZWQgdG8gcHJvdGVjdCB0aGUgUnVuUSBhbmQg
RGVwbGV0ZWRRLgotICogVGhlIGdsb2JhbCBsb2NrIGlzIHJlZmVyZW5jZWQgYnkgc2NoZWR1bGVf
ZGF0YS5zY2hlZHVsZV9sb2NrCisgKiBUaGUgZ2xvYmFsIGxvY2sgaXMgcmVmZXJlbmNlZCBieSBz
Y2hlZF9yZXMtPnNjaGVkdWxlX2xvY2sKICAqIGZyb20gYWxsIHBoeXNpY2FsIGNwdXMuCiAgKgog
ICogVGhlIGxvY2sgaXMgYWxyZWFkeSBncmFiYmVkIHdoZW4gY2FsbGluZyB3YWtlL3NsZWVwL3Nj
aGVkdWxlLyBmdW5jdGlvbnMKQEAgLTE3Niw3ICsxNzYsNyBAQCBzdGF0aWMgdm9pZCByZXBsX3Rp
bWVyX2hhbmRsZXIodm9pZCAqZGF0YSk7CiAKIC8qCiAgKiBTeXN0ZW0td2lkZSBwcml2YXRlIGRh
dGEsIGluY2x1ZGUgZ2xvYmFsIFJ1blF1ZXVlL0RlcGxldGVkUQotICogR2xvYmFsIGxvY2sgaXMg
cmVmZXJlbmNlZCBieSBzY2hlZHVsZV9kYXRhLnNjaGVkdWxlX2xvY2sgZnJvbSBhbGwKKyAqIEds
b2JhbCBsb2NrIGlzIHJlZmVyZW5jZWQgYnkgc2NoZWRfcmVzLT5zY2hlZHVsZV9sb2NrIGZyb20g
YWxsCiAgKiBwaHlzaWNhbCBjcHVzLiBJdCBjYW4gYmUgZ3JhYmJlZCB2aWEgdmNwdV9zY2hlZHVs
ZV9sb2NrX2lycSgpCiAgKi8KIHN0cnVjdCBydF9wcml2YXRlIHsKQEAgLTcyMiw3ICs3MjIsNyBA
QCBydF9pbml0X3BkYXRhKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgdm9pZCAqcGRhdGEs
IGludCBjcHUpCiAgICAgfQogCiAgICAgLyogTW92ZSB0aGUgc2NoZWR1bGVyIGxvY2sgdG8gb3Vy
IGdsb2JhbCBydW5xdWV1ZSBsb2NrLiAgKi8KLSAgICBwZXJfY3B1KHNjaGVkdWxlX2RhdGEsIGNw
dSkuc2NoZWR1bGVfbG9jayA9ICZwcnYtPmxvY2s7CisgICAgZ2V0X3NjaGVkX3JlcyhjcHUpLT5z
Y2hlZHVsZV9sb2NrID0gJnBydi0+bG9jazsKIAogICAgIC8qIF9Ob3RfIHBjcHVfc2NoZWR1bGVf
dW5sb2NrKCk6IHBlcl9jcHUoKS5zY2hlZHVsZV9sb2NrIGNoYW5nZWQhICovCiAgICAgc3Bpbl91
bmxvY2tfaXJxcmVzdG9yZShvbGRfbG9jaywgZmxhZ3MpOwpAQCAtNzQ0LDcgKzc0NCw3IEBAIHJ0
X3N3aXRjaF9zY2hlZChzdHJ1Y3Qgc2NoZWR1bGVyICpuZXdfb3BzLCB1bnNpZ25lZCBpbnQgY3B1
LAogICAgICAqIGFub3RoZXIgc2NoZWR1bGVyLCBidXQgdGhhdCBpcyBob3cgdGhpbmdzIG5lZWQg
dG8gYmUsIGZvcgogICAgICAqIHByZXZlbnRpbmcgcmFjZXMuCiAgICAgICovCi0gICAgQVNTRVJU
KHBlcl9jcHUoc2NoZWR1bGVfZGF0YSwgY3B1KS5zY2hlZHVsZV9sb2NrICE9ICZwcnYtPmxvY2sp
OworICAgIEFTU0VSVChnZXRfc2NoZWRfcmVzKGNwdSktPnNjaGVkdWxlX2xvY2sgIT0gJnBydi0+
bG9jayk7CiAKICAgICAvKgogICAgICAqIElmIHdlIGFyZSB0aGUgYWJzb2x1dGUgZmlyc3QgY3B1
IGJlaW5nIHN3aXRjaGVkIHRvd2FyZCB0aGlzCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3NjaGVk
dWxlLmMgYi94ZW4vY29tbW9uL3NjaGVkdWxlLmMKaW5kZXggNmQ2ZDhhMjM0Zi4uNjdjY2I3ODcz
OSAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9zY2hlZHVsZS5jCisrKyBiL3hlbi9jb21tb24vc2No
ZWR1bGUuYwpAQCAtNjUsMTMgKzY1LDE1IEBAIHN0YXRpYyB2b2lkIHZjcHVfc2luZ2xlc2hvdF90
aW1lcl9mbih2b2lkICpkYXRhKTsKIHN0YXRpYyB2b2lkIHBvbGxfdGltZXJfZm4odm9pZCAqZGF0
YSk7CiAKIC8qIFRoaXMgaXMgZ2xvYmFsIGZvciBub3cgc28gdGhhdCBwcml2YXRlIGltcGxlbWVu
dGF0aW9ucyBjYW4gcmVhY2ggaXQgKi8KLURFRklORV9QRVJfQ1BVKHN0cnVjdCBzY2hlZHVsZV9k
YXRhLCBzY2hlZHVsZV9kYXRhKTsKIERFRklORV9QRVJfQ1BVKHN0cnVjdCBzY2hlZHVsZXIgKiwg
c2NoZWR1bGVyKTsKIERFRklORV9QRVJfQ1BVX1JFQURfTU9TVExZKHN0cnVjdCBzY2hlZF9yZXNv
dXJjZSAqLCBzY2hlZF9yZXMpOwogCiAvKiBTY3JhdGNoIHNwYWNlIGZvciBjcHVtYXNrcy4gKi8K
IERFRklORV9QRVJfQ1BVKGNwdW1hc2tfdCwgY3B1bWFza19zY3JhdGNoKTsKIAorLyogSG93IG1h
bnkgdXJnZW50IHZjcHVzLiAqLworREVGSU5FX1BFUl9DUFUoYXRvbWljX3QsIHNjaGVkX3VyZ2Vu
dF9jb3VudCk7CisKIGV4dGVybiBjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpfX3N0YXJ0X3NjaGVk
dWxlcnNfYXJyYXlbXSwgKl9fZW5kX3NjaGVkdWxlcnNfYXJyYXlbXTsKICNkZWZpbmUgTlVNX1ND
SEVEVUxFUlMgKF9fZW5kX3NjaGVkdWxlcnNfYXJyYXkgLSBfX3N0YXJ0X3NjaGVkdWxlcnNfYXJy
YXkpCiAjZGVmaW5lIHNjaGVkdWxlcnMgX19zdGFydF9zY2hlZHVsZXJzX2FycmF5CkBAIC0yMTMs
NyArMjE1LDcgQEAgc3RhdGljIGlubGluZSB2b2lkIHZjcHVfdXJnZW50X2NvdW50X3VwZGF0ZShz
dHJ1Y3QgdmNwdSAqdikKICAgICAgICAgICAgICAhdGVzdF9iaXQodi0+dmNwdV9pZCwgdi0+ZG9t
YWluLT5wb2xsX21hc2spICkKICAgICAgICAgewogICAgICAgICAgICAgdi0+aXNfdXJnZW50ID0g
MDsKLSAgICAgICAgICAgIGF0b21pY19kZWMoJnBlcl9jcHUoc2NoZWR1bGVfZGF0YSx2LT5wcm9j
ZXNzb3IpLnVyZ2VudF9jb3VudCk7CisgICAgICAgICAgICBhdG9taWNfZGVjKCZwZXJfY3B1KHNj
aGVkX3VyZ2VudF9jb3VudCwgdi0+cHJvY2Vzc29yKSk7CiAgICAgICAgIH0KICAgICB9CiAgICAg
ZWxzZQpAQCAtMjIyLDcgKzIyNCw3IEBAIHN0YXRpYyBpbmxpbmUgdm9pZCB2Y3B1X3VyZ2VudF9j
b3VudF91cGRhdGUoc3RydWN0IHZjcHUgKnYpCiAgICAgICAgICAgICAgdW5saWtlbHkodGVzdF9i
aXQodi0+dmNwdV9pZCwgdi0+ZG9tYWluLT5wb2xsX21hc2spKSApCiAgICAgICAgIHsKICAgICAg
ICAgICAgIHYtPmlzX3VyZ2VudCA9IDE7Ci0gICAgICAgICAgICBhdG9taWNfaW5jKCZwZXJfY3B1
KHNjaGVkdWxlX2RhdGEsdi0+cHJvY2Vzc29yKS51cmdlbnRfY291bnQpOworICAgICAgICAgICAg
YXRvbWljX2luYygmcGVyX2NwdShzY2hlZF91cmdlbnRfY291bnQsIHYtPnByb2Nlc3NvcikpOwog
ICAgICAgICB9CiAgICAgfQogfQpAQCAtMjMzLDcgKzIzNSw3IEBAIHN0YXRpYyBpbmxpbmUgdm9p
ZCB2Y3B1X3J1bnN0YXRlX2NoYW5nZSgKICAgICBzX3RpbWVfdCBkZWx0YTsKIAogICAgIEFTU0VS
VCh2LT5ydW5zdGF0ZS5zdGF0ZSAhPSBuZXdfc3RhdGUpOwotICAgIEFTU0VSVChzcGluX2lzX2xv
Y2tlZChwZXJfY3B1KHNjaGVkdWxlX2RhdGEsdi0+cHJvY2Vzc29yKS5zY2hlZHVsZV9sb2NrKSk7
CisgICAgQVNTRVJUKHNwaW5faXNfbG9ja2VkKGdldF9zY2hlZF9yZXModi0+cHJvY2Vzc29yKS0+
c2NoZWR1bGVfbG9jaykpOwogCiAgICAgdmNwdV91cmdlbnRfY291bnRfdXBkYXRlKHYpOwogCkBA
IC0zOTQsNyArMzk2LDcgQEAgaW50IHNjaGVkX2luaXRfdmNwdShzdHJ1Y3QgdmNwdSAqdiwgdW5z
aWduZWQgaW50IHByb2Nlc3NvcikKICAgICAvKiBJZGxlIFZDUFVzIGFyZSBzY2hlZHVsZWQgaW1t
ZWRpYXRlbHksIHNvIGRvbid0IHB1dCB0aGVtIGluIHJ1bnF1ZXVlLiAqLwogICAgIGlmICggaXNf
aWRsZV9kb21haW4oZCkgKQogICAgIHsKLSAgICAgICAgcGVyX2NwdShzY2hlZHVsZV9kYXRhLCB2
LT5wcm9jZXNzb3IpLmN1cnIgPSB1bml0OworICAgICAgICBnZXRfc2NoZWRfcmVzKHYtPnByb2Nl
c3NvciktPmN1cnIgPSB1bml0OwogICAgICAgICB2LT5pc19ydW5uaW5nID0gMTsKICAgICB9CiAg
ICAgZWxzZQpAQCAtNTE5LDcgKzUyMSw3IEBAIHZvaWQgc2NoZWRfZGVzdHJveV92Y3B1KHN0cnVj
dCB2Y3B1ICp2KQogICAgIGtpbGxfdGltZXIoJnYtPnNpbmdsZXNob3RfdGltZXIpOwogICAgIGtp
bGxfdGltZXIoJnYtPnBvbGxfdGltZXIpOwogICAgIGlmICggdGVzdF9hbmRfY2xlYXJfYm9vbCh2
LT5pc191cmdlbnQpICkKLSAgICAgICAgYXRvbWljX2RlYygmcGVyX2NwdShzY2hlZHVsZV9kYXRh
LCB2LT5wcm9jZXNzb3IpLnVyZ2VudF9jb3VudCk7CisgICAgICAgIGF0b21pY19kZWMoJnBlcl9j
cHUoc2NoZWRfdXJnZW50X2NvdW50LCB2LT5wcm9jZXNzb3IpKTsKICAgICBzY2hlZF9yZW1vdmVf
dW5pdCh2Y3B1X3NjaGVkdWxlcih2KSwgdW5pdCk7CiAgICAgc2NoZWRfZnJlZV91ZGF0YSh2Y3B1
X3NjaGVkdWxlcih2KSwgdW5pdC0+cHJpdik7CiAgICAgc2NoZWRfZnJlZV91bml0KHVuaXQpOwpA
QCAtNTY2LDcgKzU2OCw3IEBAIHZvaWQgc2NoZWRfZGVzdHJveV9kb21haW4oc3RydWN0IGRvbWFp
biAqZCkKIAogdm9pZCB2Y3B1X3NsZWVwX25vc3luY19sb2NrZWQoc3RydWN0IHZjcHUgKnYpCiB7
Ci0gICAgQVNTRVJUKHNwaW5faXNfbG9ja2VkKHBlcl9jcHUoc2NoZWR1bGVfZGF0YSx2LT5wcm9j
ZXNzb3IpLnNjaGVkdWxlX2xvY2spKTsKKyAgICBBU1NFUlQoc3Bpbl9pc19sb2NrZWQoZ2V0X3Nj
aGVkX3Jlcyh2LT5wcm9jZXNzb3IpLT5zY2hlZHVsZV9sb2NrKSk7CiAKICAgICBpZiAoIGxpa2Vs
eSghdmNwdV9ydW5uYWJsZSh2KSkgKQogICAgIHsKQEAgLTY2MSw4ICs2NjMsOCBAQCBzdGF0aWMg
dm9pZCB2Y3B1X21vdmVfbG9ja2VkKHN0cnVjdCB2Y3B1ICp2LCB1bnNpZ25lZCBpbnQgbmV3X2Nw
dSkKICAgICAgKi8KICAgICBpZiAoIHVubGlrZWx5KHYtPmlzX3VyZ2VudCkgJiYgKG9sZF9jcHUg
IT0gbmV3X2NwdSkgKQogICAgIHsKLSAgICAgICAgYXRvbWljX2luYygmcGVyX2NwdShzY2hlZHVs
ZV9kYXRhLCBuZXdfY3B1KS51cmdlbnRfY291bnQpOwotICAgICAgICBhdG9taWNfZGVjKCZwZXJf
Y3B1KHNjaGVkdWxlX2RhdGEsIG9sZF9jcHUpLnVyZ2VudF9jb3VudCk7CisgICAgICAgIGF0b21p
Y19pbmMoJnBlcl9jcHUoc2NoZWRfdXJnZW50X2NvdW50LCBuZXdfY3B1KSk7CisgICAgICAgIGF0
b21pY19kZWMoJnBlcl9jcHUoc2NoZWRfdXJnZW50X2NvdW50LCBvbGRfY3B1KSk7CiAgICAgfQog
CiAgICAgLyoKQEAgLTcyOCwyMCArNzMwLDIwIEBAIHN0YXRpYyB2b2lkIHZjcHVfbWlncmF0ZV9m
aW5pc2goc3RydWN0IHZjcHUgKnYpCiAgICAgICAgICAqIGFyZSBub3QgY29ycmVjdCBhbnkgbG9u
Z2VyIGFmdGVyIGV2YWx1YXRpbmcgb2xkIGFuZCBuZXcgY3B1IGhvbGRpbmcKICAgICAgICAgICog
dGhlIGxvY2tzLgogICAgICAgICAgKi8KLSAgICAgICAgb2xkX2xvY2sgPSBwZXJfY3B1KHNjaGVk
dWxlX2RhdGEsIG9sZF9jcHUpLnNjaGVkdWxlX2xvY2s7Ci0gICAgICAgIG5ld19sb2NrID0gcGVy
X2NwdShzY2hlZHVsZV9kYXRhLCBuZXdfY3B1KS5zY2hlZHVsZV9sb2NrOworICAgICAgICBvbGRf
bG9jayA9IGdldF9zY2hlZF9yZXMob2xkX2NwdSktPnNjaGVkdWxlX2xvY2s7CisgICAgICAgIG5l
d19sb2NrID0gZ2V0X3NjaGVkX3JlcyhuZXdfY3B1KS0+c2NoZWR1bGVfbG9jazsKIAogICAgICAg
ICBzY2hlZF9zcGluX2xvY2tfZG91YmxlKG9sZF9sb2NrLCBuZXdfbG9jaywgJmZsYWdzKTsKIAog
ICAgICAgICBvbGRfY3B1ID0gdi0+cHJvY2Vzc29yOwotICAgICAgICBpZiAoIG9sZF9sb2NrID09
IHBlcl9jcHUoc2NoZWR1bGVfZGF0YSwgb2xkX2NwdSkuc2NoZWR1bGVfbG9jayApCisgICAgICAg
IGlmICggb2xkX2xvY2sgPT0gZ2V0X3NjaGVkX3JlcyhvbGRfY3B1KS0+c2NoZWR1bGVfbG9jayAp
CiAgICAgICAgIHsKICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgKiBJZiB3ZSBzZWxlY3Rl
ZCBhIENQVSBvbiB0aGUgcHJldmlvc3UgaXRlcmF0aW9uLCBjaGVjayBpZiBpdAogICAgICAgICAg
ICAgICogcmVtYWlucyBzdWl0YWJsZSBmb3IgcnVubmluZyB0aGlzIHZDUFUuCiAgICAgICAgICAg
ICAgKi8KICAgICAgICAgICAgIGlmICggcGlja19jYWxsZWQgJiYKLSAgICAgICAgICAgICAgICAg
KG5ld19sb2NrID09IHBlcl9jcHUoc2NoZWR1bGVfZGF0YSwgbmV3X2NwdSkuc2NoZWR1bGVfbG9j
aykgJiYKKyAgICAgICAgICAgICAgICAgKG5ld19sb2NrID09IGdldF9zY2hlZF9yZXMobmV3X2Nw
dSktPnNjaGVkdWxlX2xvY2spICYmCiAgICAgICAgICAgICAgICAgIGNwdW1hc2tfdGVzdF9jcHUo
bmV3X2NwdSwgdi0+Y3B1X2hhcmRfYWZmaW5pdHkpICYmCiAgICAgICAgICAgICAgICAgIGNwdW1h
c2tfdGVzdF9jcHUobmV3X2NwdSwgdi0+ZG9tYWluLT5jcHVwb29sLT5jcHVfdmFsaWQpICkKICAg
ICAgICAgICAgICAgICBicmVhazsKQEAgLTc0OSw3ICs3NTEsNyBAQCBzdGF0aWMgdm9pZCB2Y3B1
X21pZ3JhdGVfZmluaXNoKHN0cnVjdCB2Y3B1ICp2KQogICAgICAgICAgICAgLyogU2VsZWN0IGEg
bmV3IENQVS4gKi8KICAgICAgICAgICAgIG5ld19jcHUgPSBzY2hlZF9waWNrX3Jlc291cmNlKHZj
cHVfc2NoZWR1bGVyKHYpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgdi0+c2NoZWRfdW5pdCktPm1hc3Rlcl9jcHU7Ci0gICAgICAgICAgICBpZiAoIChuZXdfbG9j
ayA9PSBwZXJfY3B1KHNjaGVkdWxlX2RhdGEsIG5ld19jcHUpLnNjaGVkdWxlX2xvY2spICYmCisg
ICAgICAgICAgICBpZiAoIChuZXdfbG9jayA9PSBnZXRfc2NoZWRfcmVzKG5ld19jcHUpLT5zY2hl
ZHVsZV9sb2NrKSAmJgogICAgICAgICAgICAgICAgICBjcHVtYXNrX3Rlc3RfY3B1KG5ld19jcHUs
IHYtPmRvbWFpbi0+Y3B1cG9vbC0+Y3B1X3ZhbGlkKSApCiAgICAgICAgICAgICAgICAgYnJlYWs7
CiAgICAgICAgICAgICBwaWNrX2NhbGxlZCA9IDE7CkBAIC0xNTY2LDcgKzE1NjgsNyBAQCBzdGF0
aWMgdm9pZCBzY2hlZHVsZSh2b2lkKQogICAgIHN0cnVjdCBzY2hlZHVsZXIgICAgICpzY2hlZDsK
ICAgICB1bnNpZ25lZCBsb25nICAgICAgICAqdGFza2xldF93b3JrID0gJnRoaXNfY3B1KHRhc2ts
ZXRfd29ya190b19kbyk7CiAgICAgYm9vbF90ICAgICAgICAgICAgICAgIHRhc2tsZXRfd29ya19z
Y2hlZHVsZWQgPSAwOwotICAgIHN0cnVjdCBzY2hlZHVsZV9kYXRhICpzZDsKKyAgICBzdHJ1Y3Qg
c2NoZWRfcmVzb3VyY2UgKnNkOwogICAgIHNwaW5sb2NrX3QgICAgICAgICAgICpsb2NrOwogICAg
IHN0cnVjdCB0YXNrX3NsaWNlICAgICBuZXh0X3NsaWNlOwogICAgIGludCBjcHUgPSBzbXBfcHJv
Y2Vzc29yX2lkKCk7CkBAIC0xNTc1LDcgKzE1NzcsNyBAQCBzdGF0aWMgdm9pZCBzY2hlZHVsZSh2
b2lkKQogCiAgICAgU0NIRURfU1RBVF9DUkFOSyhzY2hlZF9ydW4pOwogCi0gICAgc2QgPSAmdGhp
c19jcHUoc2NoZWR1bGVfZGF0YSk7CisgICAgc2QgPSBnZXRfc2NoZWRfcmVzKGNwdSk7CiAKICAg
ICAvKiBVcGRhdGUgdGFza2xldCBzY2hlZHVsaW5nIHN0YXR1cy4gKi8KICAgICBzd2l0Y2ggKCAq
dGFza2xldF93b3JrICkKQEAgLTE3MTYsMjAgKzE3MTgsMTkgQEAgc3RhdGljIHZvaWQgcG9sbF90
aW1lcl9mbih2b2lkICpkYXRhKQogCiBzdGF0aWMgaW50IGNwdV9zY2hlZHVsZV91cCh1bnNpZ25l
ZCBpbnQgY3B1KQogewotICAgIHN0cnVjdCBzY2hlZHVsZV9kYXRhICpzZCA9ICZwZXJfY3B1KHNj
aGVkdWxlX2RhdGEsIGNwdSk7Ci0gICAgc3RydWN0IHNjaGVkX3Jlc291cmNlICpyZXM7CisgICAg
c3RydWN0IHNjaGVkX3Jlc291cmNlICpzcjsKIAotICAgIHJlcyA9IHh6YWxsb2Moc3RydWN0IHNj
aGVkX3Jlc291cmNlKTsKLSAgICBpZiAoIHJlcyA9PSBOVUxMICkKKyAgICBzciA9IHh6YWxsb2Mo
c3RydWN0IHNjaGVkX3Jlc291cmNlKTsKKyAgICBpZiAoIHNyID09IE5VTEwgKQogICAgICAgICBy
ZXR1cm4gLUVOT01FTTsKLSAgICByZXMtPm1hc3Rlcl9jcHUgPSBjcHU7Ci0gICAgc2V0X3NjaGVk
X3JlcyhjcHUsIHJlcyk7CisgICAgc3ItPm1hc3Rlcl9jcHUgPSBjcHU7CisgICAgc2V0X3NjaGVk
X3JlcyhjcHUsIHNyKTsKIAogICAgIHBlcl9jcHUoc2NoZWR1bGVyLCBjcHUpID0gJnNjaGVkX2lk
bGVfb3BzOwotICAgIHNwaW5fbG9ja19pbml0KCZzZC0+X2xvY2spOwotICAgIHNkLT5zY2hlZHVs
ZV9sb2NrID0gJnNjaGVkX2ZyZWVfY3B1X2xvY2s7Ci0gICAgaW5pdF90aW1lcigmc2QtPnNfdGlt
ZXIsIHNfdGltZXJfZm4sIE5VTEwsIGNwdSk7Ci0gICAgYXRvbWljX3NldCgmc2QtPnVyZ2VudF9j
b3VudCwgMCk7CisgICAgc3Bpbl9sb2NrX2luaXQoJnNyLT5fbG9jayk7CisgICAgc3ItPnNjaGVk
dWxlX2xvY2sgPSAmc2NoZWRfZnJlZV9jcHVfbG9jazsKKyAgICBpbml0X3RpbWVyKCZzci0+c190
aW1lciwgc190aW1lcl9mbiwgTlVMTCwgY3B1KTsKKyAgICBhdG9taWNfc2V0KCZwZXJfY3B1KHNj
aGVkX3VyZ2VudF9jb3VudCwgY3B1KSwgMCk7CiAKICAgICAvKiBCb290IENQVSBpcyBkZWFsdCB3
aXRoIGxhdGVyIGluIHNjaGVkdWxlcl9pbml0KCkuICovCiAgICAgaWYgKCBjcHUgPT0gMCApCkBA
IC0xNzM4LDcgKzE3MzksNyBAQCBzdGF0aWMgaW50IGNwdV9zY2hlZHVsZV91cCh1bnNpZ25lZCBp
bnQgY3B1KQogICAgIGlmICggaWRsZV92Y3B1W2NwdV0gPT0gTlVMTCApCiAgICAgICAgIHZjcHVf
Y3JlYXRlKGlkbGVfdmNwdVswXS0+ZG9tYWluLCBjcHUsIGNwdSk7CiAgICAgZWxzZQotICAgICAg
ICBpZGxlX3ZjcHVbY3B1XS0+c2NoZWRfdW5pdC0+cmVzID0gcmVzOworICAgICAgICBpZGxlX3Zj
cHVbY3B1XS0+c2NoZWRfdW5pdC0+cmVzID0gc3I7CiAKICAgICBpZiAoIGlkbGVfdmNwdVtjcHVd
ID09IE5VTEwgKQogICAgICAgICByZXR1cm4gLUVOT01FTTsKQEAgLTE3NDksMjEgKzE3NTAsMjEg
QEAgc3RhdGljIGludCBjcHVfc2NoZWR1bGVfdXAodW5zaWduZWQgaW50IGNwdSkKICAgICAgKiBh
bGxvY2F0ZWQuCiAgICAgICovCiAKLSAgICBzZC0+Y3VyciA9IGlkbGVfdmNwdVtjcHVdLT5zY2hl
ZF91bml0OworICAgIHNyLT5jdXJyID0gaWRsZV92Y3B1W2NwdV0tPnNjaGVkX3VuaXQ7CiAKLSAg
ICBzZC0+c2NoZWRfcHJpdiA9IE5VTEw7CisgICAgc3ItPnNjaGVkX3ByaXYgPSBOVUxMOwogCiAg
ICAgcmV0dXJuIDA7CiB9CiAKIHN0YXRpYyB2b2lkIGNwdV9zY2hlZHVsZV9kb3duKHVuc2lnbmVk
IGludCBjcHUpCiB7Ci0gICAgc3RydWN0IHNjaGVkdWxlX2RhdGEgKnNkID0gJnBlcl9jcHUoc2No
ZWR1bGVfZGF0YSwgY3B1KTsKKyAgICBzdHJ1Y3Qgc2NoZWRfcmVzb3VyY2UgKnNyID0gZ2V0X3Nj
aGVkX3JlcyhjcHUpOwogCi0gICAga2lsbF90aW1lcigmc2QtPnNfdGltZXIpOworICAgIGtpbGxf
dGltZXIoJnNyLT5zX3RpbWVyKTsKIAogICAgIHNldF9zY2hlZF9yZXMoY3B1LCBOVUxMKTsKLSAg
ICB4ZnJlZShzZCk7CisgICAgeGZyZWUoc3IpOwogfQogCiB2b2lkIHNjaGVkX3JtX2NwdSh1bnNp
Z25lZCBpbnQgY3B1KQpAQCAtMTkxNyw3ICsxOTE4LDcgQEAgdm9pZCBfX2luaXQgc2NoZWR1bGVy
X2luaXQodm9pZCkKICAgICBpZGxlX2RvbWFpbi0+bWF4X3ZjcHVzID0gbnJfY3B1X2lkczsKICAg
ICBpZiAoIHZjcHVfY3JlYXRlKGlkbGVfZG9tYWluLCAwLCAwKSA9PSBOVUxMICkKICAgICAgICAg
QlVHKCk7Ci0gICAgdGhpc19jcHUoc2NoZWR1bGVfZGF0YSkuY3VyciA9IGlkbGVfdmNwdVswXS0+
c2NoZWRfdW5pdDsKKyAgICBnZXRfc2NoZWRfcmVzKDApLT5jdXJyID0gaWRsZV92Y3B1WzBdLT5z
Y2hlZF91bml0OwogfQogCiAvKgpAQCAtMTkzNCw3ICsxOTM1LDcgQEAgaW50IHNjaGVkdWxlX2Nw
dV9zd2l0Y2godW5zaWduZWQgaW50IGNwdSwgc3RydWN0IGNwdXBvb2wgKmMpCiAgICAgc3RydWN0
IHNjaGVkdWxlciAqb2xkX29wcyA9IHBlcl9jcHUoc2NoZWR1bGVyLCBjcHUpOwogICAgIHN0cnVj
dCBzY2hlZHVsZXIgKm5ld19vcHMgPSAoYyA9PSBOVUxMKSA/ICZzY2hlZF9pZGxlX29wcyA6IGMt
PnNjaGVkOwogICAgIHN0cnVjdCBjcHVwb29sICpvbGRfcG9vbCA9IHBlcl9jcHUoY3B1cG9vbCwg
Y3B1KTsKLSAgICBzdHJ1Y3Qgc2NoZWR1bGVfZGF0YSAqc2QgPSAmcGVyX2NwdShzY2hlZHVsZV9k
YXRhLCBjcHUpOworICAgIHN0cnVjdCBzY2hlZF9yZXNvdXJjZSAqc2QgPSBnZXRfc2NoZWRfcmVz
KGNwdSk7CiAgICAgc3BpbmxvY2tfdCAqb2xkX2xvY2ssICpuZXdfbG9jazsKICAgICB1bnNpZ25l
ZCBsb25nIGZsYWdzOwogCmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS9hc20teDg2L2NwdWlkbGUu
aCBiL3hlbi9pbmNsdWRlL2FzbS14ODYvY3B1aWRsZS5oCmluZGV4IDQ4OGY3MDgzMDUuLjVkN2Rm
ZmQyMjggMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL2FzbS14ODYvY3B1aWRsZS5oCisrKyBiL3hl
bi9pbmNsdWRlL2FzbS14ODYvY3B1aWRsZS5oCkBAIC00LDcgKzQsNiBAQAogI2luY2x1ZGUgPHhl
bi9jcHVpZGxlLmg+CiAjaW5jbHVkZSA8eGVuL25vdGlmaWVyLmg+CiAjaW5jbHVkZSA8eGVuL3Nj
aGVkLmg+Ci0jaW5jbHVkZSA8eGVuL3NjaGVkLWlmLmg+CiAKIGV4dGVybiBzdHJ1Y3QgYWNwaV9w
cm9jZXNzb3JfcG93ZXIgKnByb2Nlc3Nvcl9wb3dlcnNbXTsKIApAQCAtMjcsMTQgKzI2LDQgQEAg
dm9pZCB1cGRhdGVfaWRsZV9zdGF0cyhzdHJ1Y3QgYWNwaV9wcm9jZXNzb3JfcG93ZXIgKiwKIHZv
aWQgdXBkYXRlX2xhc3RfY3hfc3RhdChzdHJ1Y3QgYWNwaV9wcm9jZXNzb3JfcG93ZXIgKiwKICAg
ICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgYWNwaV9wcm9jZXNzb3JfY3ggKiwgdWludDY0
X3QpOwogCi0vKgotICogdmNwdSBpcyB1cmdlbnQgaWYgdmNwdSBpcyBwb2xsaW5nIGV2ZW50IGNo
YW5uZWwKLSAqCi0gKiBpZiB1cmdlbnQgdmNwdSBleGlzdHMsIENQVSBzaG91bGQgbm90IGVudGVy
IGRlZXAgQyBzdGF0ZQotICovCi1zdGF0aWMgaW5saW5lIGludCBzY2hlZF9oYXNfdXJnZW50X3Zj
cHUodm9pZCkKLXsKLSAgICByZXR1cm4gYXRvbWljX3JlYWQoJnRoaXNfY3B1KHNjaGVkdWxlX2Rh
dGEpLnVyZ2VudF9jb3VudCk7Ci19Ci0KICNlbmRpZiAvKiBfX1g4Nl9BU01fQ1BVSURMRV9IX18g
Ki8KZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5oIGIveGVuL2luY2x1ZGUv
eGVuL3NjaGVkLWlmLmgKaW5kZXggNGI4MTczNDdkNS4uNGRiZjhmOTc0YyAxMDA2NDQKLS0tIGEv
eGVuL2luY2x1ZGUveGVuL3NjaGVkLWlmLmgKKysrIGIveGVuL2luY2x1ZGUveGVuL3NjaGVkLWlm
LmgKQEAgLTMzLDIyICszMywxNyBAQCBleHRlcm4gaW50IHNjaGVkX3JhdGVsaW1pdF91czsKICAq
IEZvciBjYWNoZSBiZXR0ZXJuZXNzLCBrZWVwIHRoZSBhY3R1YWwgbG9jayBpbiB0aGUgc2FtZSBj
YWNoZSBhcmVhCiAgKiBhcyB0aGUgcmVzdCBvZiB0aGUgc3RydWN0LiAgSnVzdCBoYXZlIHRoZSBz
Y2hlZHVsZXIgcG9pbnQgdG8gdGhlCiAgKiBvbmUgaXQgd2FudHMgKFRoaXMgbWF5IGJlIHRoZSBv
bmUgcmlnaHQgaW4gZnJvbnQgb2YgaXQpLiovCi1zdHJ1Y3Qgc2NoZWR1bGVfZGF0YSB7CitzdHJ1
Y3Qgc2NoZWRfcmVzb3VyY2UgewogICAgIHNwaW5sb2NrX3QgICAgICAgICAqc2NoZWR1bGVfbG9j
aywKICAgICAgICAgICAgICAgICAgICAgICAgX2xvY2s7CiAgICAgc3RydWN0IHNjaGVkX3VuaXQg
ICpjdXJyOwogICAgIHZvaWQgICAgICAgICAgICAgICAqc2NoZWRfcHJpdjsKICAgICBzdHJ1Y3Qg
dGltZXIgICAgICAgIHNfdGltZXI7ICAgICAgICAvKiBzY2hlZHVsaW5nIHRpbWVyICAgICAgICAg
ICAgICAgICovCi0gICAgYXRvbWljX3QgICAgICAgICAgICB1cmdlbnRfY291bnQ7ICAgLyogaG93
IG1hbnkgdXJnZW50IHZjcHVzICAgICAgICAgICAqLwotfTsKIAotI2RlZmluZSBjdXJyX29uX2Nw
dShjKSAgICAocGVyX2NwdShzY2hlZHVsZV9kYXRhLCBjKS5jdXJyKQotCi1zdHJ1Y3Qgc2NoZWRf
cmVzb3VyY2UgewotICAgIHVuc2lnbmVkIGludCBtYXN0ZXJfY3B1OyAgLyogQ3B1IHdpdGggbG93
ZXN0IGlkIGluIHNjaGVkdWxpbmcgcmVzb3VyY2UuICovCisgICAgLyogQ3B1IHdpdGggbG93ZXN0
IGlkIGluIHNjaGVkdWxpbmcgcmVzb3VyY2UuICovCisgICAgdW5zaWduZWQgaW50ICAgICAgICBt
YXN0ZXJfY3B1OwogfTsKIAotREVDTEFSRV9QRVJfQ1BVKHN0cnVjdCBzY2hlZHVsZV9kYXRhLCBz
Y2hlZHVsZV9kYXRhKTsKIERFQ0xBUkVfUEVSX0NQVShzdHJ1Y3Qgc2NoZWR1bGVyICosIHNjaGVk
dWxlcik7CiBERUNMQVJFX1BFUl9DUFUoc3RydWN0IGNwdXBvb2wgKiwgY3B1cG9vbCk7CiBERUNM
QVJFX1BFUl9DUFUoc3RydWN0IHNjaGVkX3Jlc291cmNlICosIHNjaGVkX3Jlcyk7CkBAIC02Myw2
ICs1OCwxMSBAQCBzdGF0aWMgaW5saW5lIHZvaWQgc2V0X3NjaGVkX3Jlcyh1bnNpZ25lZCBpbnQg
Y3B1LCBzdHJ1Y3Qgc2NoZWRfcmVzb3VyY2UgKnJlcykKICAgICBwZXJfY3B1KHNjaGVkX3Jlcywg
Y3B1KSA9IHJlczsKIH0KIAorc3RhdGljIGlubGluZSBzdHJ1Y3Qgc2NoZWRfdW5pdCAqY3Vycl9v
bl9jcHUodW5zaWduZWQgaW50IGNwdSkKK3sKKyAgICByZXR1cm4gZ2V0X3NjaGVkX3JlcyhjcHUp
LT5jdXJyOworfQorCiAvKgogICogU2NyYXRjaCBzcGFjZSwgZm9yIGF2b2lkaW5nIGhhdmluZyB0
b28gbWFueSBjcHVtYXNrX3Qgb24gdGhlIHN0YWNrLgogICogV2l0aGluIGVhY2ggc2NoZWR1bGVy
LCB3aGVuIHVzaW5nIHRoZSBzY3JhdGNoIG1hc2sgb2Ygb25lIHBDUFU6CkBAIC03OSw3ICs3OSw3
IEBAIHN0YXRpYyBpbmxpbmUgc3BpbmxvY2tfdCAqa2luZCMjX3NjaGVkdWxlX2xvY2sjI2lycShw
YXJhbSBFWFRSQV9UWVBFKGFyZykpIFwKIHsgXAogICAgIGZvciAoIDsgOyApIFwKICAgICB7IFwK
LSAgICAgICAgc3BpbmxvY2tfdCAqbG9jayA9IHBlcl9jcHUoc2NoZWR1bGVfZGF0YSwgY3B1KS5z
Y2hlZHVsZV9sb2NrOyBcCisgICAgICAgIHNwaW5sb2NrX3QgKmxvY2sgPSBnZXRfc2NoZWRfcmVz
KGNwdSktPnNjaGVkdWxlX2xvY2s7IFwKICAgICAgICAgLyogXAogICAgICAgICAgKiB2LT5wcm9j
ZXNzb3IgbWF5IGNoYW5nZSB3aGVuIGdyYWJiaW5nIHRoZSBsb2NrOyBidXQgXAogICAgICAgICAg
KiBwZXJfY3B1KHYtPnByb2Nlc3NvcikgbWF5IGFsc28gY2hhbmdlLCBpZiBjaGFuZ2luZyBjcHUg
cG9vbCBcCkBAIC04OSw3ICs4OSw3IEBAIHN0YXRpYyBpbmxpbmUgc3BpbmxvY2tfdCAqa2luZCMj
X3NjaGVkdWxlX2xvY2sjI2lycShwYXJhbSBFWFRSQV9UWVBFKGFyZykpIFwKICAgICAgICAgICog
bG9jayBtYXkgYmUgdGhlIHNhbWU7IHRoaXMgd2lsbCBzdWNjZWVkIGluIHRoYXQgY2FzZS4gXAog
ICAgICAgICAgKi8gXAogICAgICAgICBzcGluX2xvY2sjI2lycShsb2NrLCAjIyBhcmcpOyBcCi0g
ICAgICAgIGlmICggbGlrZWx5KGxvY2sgPT0gcGVyX2NwdShzY2hlZHVsZV9kYXRhLCBjcHUpLnNj
aGVkdWxlX2xvY2spICkgXAorICAgICAgICBpZiAoIGxpa2VseShsb2NrID09IGdldF9zY2hlZF9y
ZXMoY3B1KS0+c2NoZWR1bGVfbG9jaykgKSBcCiAgICAgICAgICAgICByZXR1cm4gbG9jazsgXAog
ICAgICAgICBzcGluX3VubG9jayMjaXJxKGxvY2ssICMjIGFyZyk7IFwKICAgICB9IFwKQEAgLTk5
LDcgKzk5LDcgQEAgc3RhdGljIGlubGluZSBzcGlubG9ja190ICpraW5kIyNfc2NoZWR1bGVfbG9j
ayMjaXJxKHBhcmFtIEVYVFJBX1RZUEUoYXJnKSkgXAogc3RhdGljIGlubGluZSB2b2lkIGtpbmQj
I19zY2hlZHVsZV91bmxvY2sjI2lycShzcGlubG9ja190ICpsb2NrIFwKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRVhUUkFfVFlQRShhcmcpLCBwYXJhbSkg
XAogeyBcCi0gICAgQVNTRVJUKGxvY2sgPT0gcGVyX2NwdShzY2hlZHVsZV9kYXRhLCBjcHUpLnNj
aGVkdWxlX2xvY2spOyBcCisgICAgQVNTRVJUKGxvY2sgPT0gZ2V0X3NjaGVkX3JlcyhjcHUpLT5z
Y2hlZHVsZV9sb2NrKTsgXAogICAgIHNwaW5fdW5sb2NrIyNpcnEobG9jaywgIyMgYXJnKTsgXAog
fQogCkBAIC0xMjgsMTEgKzEyOCwxMSBAQCBzY2hlZF91bmxvY2sodmNwdSwgY29uc3Qgc3RydWN0
IHZjcHUgKnYsIHYtPnByb2Nlc3NvciwgX2lycXJlc3RvcmUsIGZsYWdzKQogCiBzdGF0aWMgaW5s
aW5lIHNwaW5sb2NrX3QgKnBjcHVfc2NoZWR1bGVfdHJ5bG9jayh1bnNpZ25lZCBpbnQgY3B1KQog
ewotICAgIHNwaW5sb2NrX3QgKmxvY2sgPSBwZXJfY3B1KHNjaGVkdWxlX2RhdGEsIGNwdSkuc2No
ZWR1bGVfbG9jazsKKyAgICBzcGlubG9ja190ICpsb2NrID0gZ2V0X3NjaGVkX3JlcyhjcHUpLT5z
Y2hlZHVsZV9sb2NrOwogCiAgICAgaWYgKCAhc3Bpbl90cnlsb2NrKGxvY2spICkKICAgICAgICAg
cmV0dXJuIE5VTEw7Ci0gICAgaWYgKCBsb2NrID09IHBlcl9jcHUoc2NoZWR1bGVfZGF0YSwgY3B1
KS5zY2hlZHVsZV9sb2NrICkKKyAgICBpZiAoIGxvY2sgPT0gZ2V0X3NjaGVkX3JlcyhjcHUpLT5z
Y2hlZHVsZV9sb2NrICkKICAgICAgICAgcmV0dXJuIGxvY2s7CiAgICAgc3Bpbl91bmxvY2sobG9j
ayk7CiAgICAgcmV0dXJuIE5VTEw7CmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQu
aCBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCmluZGV4IDViMDM0ZDViNTkuLmZjMjlkNzJiNTcg
MTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCisrKyBiL3hlbi9pbmNsdWRlL3hl
bi9zY2hlZC5oCkBAIC04ODMsNiArODgzLDE3IEBAIHN0YXRpYyBpbmxpbmUgc3RydWN0IHZjcHUg
KmRvbWFpbl92Y3B1KGNvbnN0IHN0cnVjdCBkb21haW4gKmQsCiAKIHZvaWQgY3B1X2luaXQodm9p
ZCk7CiAKKy8qCisgKiB2Y3B1IGlzIHVyZ2VudCBpZiB2Y3B1IGlzIHBvbGxpbmcgZXZlbnQgY2hh
bm5lbAorICoKKyAqIGlmIHVyZ2VudCB2Y3B1IGV4aXN0cywgQ1BVIHNob3VsZCBub3QgZW50ZXIg
ZGVlcCBDIHN0YXRlCisgKi8KK0RFQ0xBUkVfUEVSX0NQVShhdG9taWNfdCwgc2NoZWRfdXJnZW50
X2NvdW50KTsKK3N0YXRpYyBpbmxpbmUgYm9vbCBzY2hlZF9oYXNfdXJnZW50X3ZjcHUodm9pZCkK
K3sKKyAgICByZXR1cm4gYXRvbWljX3JlYWQoJnRoaXNfY3B1KHNjaGVkX3VyZ2VudF9jb3VudCkp
OworfQorCiBzdHJ1Y3Qgc2NoZWR1bGVyOwogCiBzdHJ1Y3Qgc2NoZWR1bGVyICpzY2hlZHVsZXJf
Z2V0X2RlZmF1bHQodm9pZCk7Ci0tIAoyLjE2LjQKCgpfX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBs
aXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4v
bGlzdGluZm8veGVuLWRldmVs

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 5BF1A18F26
	for <lists+xen-devel@lfdr.de>; Thu,  9 May 2019 19:30:24 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hOmpl-0001qM-Ux; Thu, 09 May 2019 17:27:53 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=fgKw=TJ=oracle.com=ankur.a.arora@srs-us1.protection.inumbo.net>)
 id 1hOmpl-0001q2-AR
 for xen-devel@lists.xenproject.org; Thu, 09 May 2019 17:27:53 +0000
X-Inumbo-ID: c539ccac-727f-11e9-ac13-7fd1f1f1a5a2
Received: from aserp2130.oracle.com (unknown [141.146.126.79])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id c539ccac-727f-11e9-ac13-7fd1f1f1a5a2;
 Thu, 09 May 2019 17:27:50 +0000 (UTC)
Received: from pps.filterd (aserp2130.oracle.com [127.0.0.1])
 by aserp2130.oracle.com (8.16.0.27/8.16.0.27) with SMTP id x49HJMt2162236;
 Thu, 9 May 2019 17:27:49 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=oracle.com;
 h=from : to : cc :
 subject : date : message-id : in-reply-to : references : mime-version :
 content-transfer-encoding; s=corp-2018-07-02;
 bh=FvwJdH247VIR+T7d8TULPFfutaAeqdcje9WExwJ1RHc=;
 b=fesHRt605BuU7kaQjJ33JtffhGU3oVjx2bxIZ9mfdG91NgEWIx/1+mU9UWZtlJFS9iyf
 VGGdqwyyHULxcM+K/tsFE7hiSuv8WT+oBtvY6kb3epYjI07oH5lHqwpaL2FsTzFIJdjo
 Sm9yjcncu7QSNhdQuUInprQ39Ns7I/HkcaP9RR8HucQg+ri3KXLpM53+u2TYCqBOILVt
 oojaxNmtyEzMNzCsTHmSS1ZKPVQQJHXXXZzmIUu7ztx0WWoFPOWugfLtEN32IxrEu54F
 JHGpbSI5IrM8G9l0bPz2bIxsntzximkwF7olKmmQhWSl9KnaUOsZhNcnyz1axZ5rE5jg /w== 
Received: from userp3030.oracle.com (userp3030.oracle.com [156.151.31.80])
 by aserp2130.oracle.com with ESMTP id 2s94b6cf9s-1
 (version=TLSv1.2 cipher=ECDHE-RSA-AES256-GCM-SHA384 bits=256 verify=OK);
 Thu, 09 May 2019 17:27:49 +0000
Received: from pps.filterd (userp3030.oracle.com [127.0.0.1])
 by userp3030.oracle.com (8.16.0.27/8.16.0.27) with SMTP id x49HNxqa109565;
 Thu, 9 May 2019 17:25:48 GMT
Received: from aserv0121.oracle.com (aserv0121.oracle.com [141.146.126.235])
 by userp3030.oracle.com with ESMTP id 2sagyvcg73-1
 (version=TLSv1.2 cipher=ECDHE-RSA-AES256-GCM-SHA384 bits=256 verify=OK);
 Thu, 09 May 2019 17:25:48 +0000
Received: from abhmp0008.oracle.com (abhmp0008.oracle.com [141.146.116.14])
 by aserv0121.oracle.com (8.14.4/8.13.8) with ESMTP id x49HPlha019366;
 Thu, 9 May 2019 17:25:47 GMT
Received: from aa1-ca-oracle-com.ca.oracle.com (/10.156.75.204)
 by default (Oracle Beehive Gateway v4.0)
 with ESMTP ; Thu, 09 May 2019 10:25:47 -0700
From: Ankur Arora <ankur.a.arora@oracle.com>
To: linux-kernel@vger.kernel.org, xen-devel@lists.xenproject.org
Date: Thu,  9 May 2019 10:25:39 -0700
Message-Id: <20190509172540.12398-16-ankur.a.arora@oracle.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190509172540.12398-1-ankur.a.arora@oracle.com>
References: <20190509172540.12398-1-ankur.a.arora@oracle.com>
MIME-Version: 1.0
X-Proofpoint-Virus-Version: vendor=nai engine=5900 definitions=9252
 signatures=668686
X-Proofpoint-Spam-Details: rule=notspam policy=default score=0 suspectscore=2
 malwarescore=0
 phishscore=0 bulkscore=0 spamscore=0 mlxscore=0 mlxlogscore=999
 adultscore=0 classifier=spam adjust=0 reason=mlx scancount=1
 engine=8.0.1-1810050000 definitions=main-1905090100
X-Proofpoint-Virus-Version: vendor=nai engine=5900 definitions=9252
 signatures=668686
X-Proofpoint-Spam-Details: rule=notspam policy=default score=0
 priorityscore=1501 malwarescore=0
 suspectscore=2 phishscore=0 bulkscore=0 spamscore=0 clxscore=1015
 lowpriorityscore=0 mlxscore=0 impostorscore=0 mlxlogscore=999 adultscore=0
 classifier=spam adjust=0 reason=mlx scancount=1 engine=8.0.1-1810050000
 definitions=main-1905090100
Subject: [Xen-devel] [RFC PATCH 15/16] xen/net: gnttab, evtchn,
 xenbus API changes
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: jgross@suse.com, sstabellini@kernel.org, konrad.wilk@oracle.com,
 ankur.a.arora@oracle.com, pbonzini@redhat.com, boris.ostrovsky@oracle.com,
 joao.m.martins@oracle.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

Rm9yIHRoZSBtb3N0IHBhcnQsIHdlIG5vdyBwYXNzIHhlbmhvc3RfdCAqIGFzIHBhcmFtZXRlci4K
CkNvLWRldmVsb3BlZC1ieTogSm9hbyBNYXJ0aW5zIDxqb2FvLm0ubWFydGluc0BvcmFjbGUuY29t
PgpTaWduZWQtb2ZmLWJ5OiBBbmt1ciBBcm9yYSA8YW5rdXIuYS5hcm9yYUBvcmFjbGUuY29tPgot
LS0KIGRyaXZlcnMvbmV0L3hlbi1uZXRiYWNrL2hhc2guYyAgICAgIHwgICA3ICstCiBkcml2ZXJz
L25ldC94ZW4tbmV0YmFjay9pbnRlcmZhY2UuYyB8ICAgNyArLQogZHJpdmVycy9uZXQveGVuLW5l
dGJhY2svbmV0YmFjay5jICAgfCAgMTEgKy0tCiBkcml2ZXJzL25ldC94ZW4tbmV0YmFjay9yeC5j
ICAgICAgICB8ICAgMyArLQogZHJpdmVycy9uZXQveGVuLW5ldGJhY2sveGVuYnVzLmMgICAgfCAg
ODEgKysrKysrKysrKystLS0tLS0tLS0tLQogZHJpdmVycy9uZXQveGVuLW5ldGZyb250LmMgICAg
ICAgICAgfCAxMDIgKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tLQogNiBmaWxlcyBjaGFuZ2Vk
LCAxMTcgaW5zZXJ0aW9ucygrKSwgOTQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9uZXQveGVuLW5ldGJhY2svaGFzaC5jIGIvZHJpdmVycy9uZXQveGVuLW5ldGJhY2svaGFzaC5j
CmluZGV4IDBjY2IwMjFmMWU3OC4uOTNhNDQ5NTcxZWYzIDEwMDY0NAotLS0gYS9kcml2ZXJzL25l
dC94ZW4tbmV0YmFjay9oYXNoLmMKKysrIGIvZHJpdmVycy9uZXQveGVuLW5ldGJhY2svaGFzaC5j
CkBAIC0yODksNiArMjg5LDggQEAgdTMyIHhlbnZpZl9zZXRfaGFzaF9mbGFncyhzdHJ1Y3QgeGVu
dmlmICp2aWYsIHUzMiBmbGFncykKIHUzMiB4ZW52aWZfc2V0X2hhc2hfa2V5KHN0cnVjdCB4ZW52
aWYgKnZpZiwgdTMyIGdyZWYsIHUzMiBsZW4pCiB7CiAJdTggKmtleSA9IHZpZi0+aGFzaC5rZXk7
CisJc3RydWN0IHhlbmJ1c19kZXZpY2UgKmRldiA9IHhlbnZpZl90b194ZW5idXNfZGV2aWNlKHZp
Zik7CisKIAlzdHJ1Y3QgZ250dGFiX2NvcHkgY29weV9vcCA9IHsKIAkJLnNvdXJjZS51LnJlZiA9
IGdyZWYsCiAJCS5zb3VyY2UuZG9taWQgPSB2aWYtPmRvbWlkLApAQCAtMzAzLDcgKzMwNSw3IEBA
IHUzMiB4ZW52aWZfc2V0X2hhc2hfa2V5KHN0cnVjdCB4ZW52aWYgKnZpZiwgdTMyIGdyZWYsIHUz
MiBsZW4pCiAJCXJldHVybiBYRU5fTkVUSUZfQ1RSTF9TVEFUVVNfSU5WQUxJRF9QQVJBTUVURVI7
CiAKIAlpZiAoY29weV9vcC5sZW4gIT0gMCkgewotCQlnbnR0YWJfYmF0Y2hfY29weSgmY29weV9v
cCwgMSk7CisJCWdudHRhYl9iYXRjaF9jb3B5KGRldi0+eGgsICZjb3B5X29wLCAxKTsKIAogCQlp
ZiAoY29weV9vcC5zdGF0dXMgIT0gR05UU1Rfb2theSkKIAkJCXJldHVybiBYRU5fTkVUSUZfQ1RS
TF9TVEFUVVNfSU5WQUxJRF9QQVJBTUVURVI7CkBAIC0zMzQsNiArMzM2LDcgQEAgdTMyIHhlbnZp
Zl9zZXRfaGFzaF9tYXBwaW5nKHN0cnVjdCB4ZW52aWYgKnZpZiwgdTMyIGdyZWYsIHUzMiBsZW4s
CiAJCQkgICAgdTMyIG9mZikKIHsKIAl1MzIgKm1hcHBpbmcgPSB2aWYtPmhhc2gubWFwcGluZ1sh
dmlmLT5oYXNoLm1hcHBpbmdfc2VsXTsKKwlzdHJ1Y3QgeGVuYnVzX2RldmljZSAqZGV2ID0geGVu
dmlmX3RvX3hlbmJ1c19kZXZpY2UodmlmKTsKIAl1bnNpZ25lZCBpbnQgbnIgPSAxOwogCXN0cnVj
dCBnbnR0YWJfY29weSBjb3B5X29wWzJdID0ge3sKIAkJLnNvdXJjZS51LnJlZiA9IGdyZWYsCkBA
IC0zNjMsNyArMzY2LDcgQEAgdTMyIHhlbnZpZl9zZXRfaGFzaF9tYXBwaW5nKHN0cnVjdCB4ZW52
aWYgKnZpZiwgdTMyIGdyZWYsIHUzMiBsZW4sCiAJICAgICAgIHZpZi0+aGFzaC5zaXplICogc2l6
ZW9mKCptYXBwaW5nKSk7CiAKIAlpZiAoY29weV9vcFswXS5sZW4gIT0gMCkgewotCQlnbnR0YWJf
YmF0Y2hfY29weShjb3B5X29wLCBucik7CisJCWdudHRhYl9iYXRjaF9jb3B5KGRldi0+eGgsIGNv
cHlfb3AsIG5yKTsKIAogCQlpZiAoY29weV9vcFswXS5zdGF0dXMgIT0gR05UU1Rfb2theSB8fAog
CQkgICAgY29weV9vcFtuciAtIDFdLnN0YXR1cyAhPSBHTlRTVF9va2F5KQpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9uZXQveGVuLW5ldGJhY2svaW50ZXJmYWNlLmMgYi9kcml2ZXJzL25ldC94ZW4tbmV0
YmFjay9pbnRlcmZhY2UuYwppbmRleCA1M2Q0ZTYzNTFmMWUuLjMyOWE0YzcwMTA0MiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9uZXQveGVuLW5ldGJhY2svaW50ZXJmYWNlLmMKKysrIGIvZHJpdmVycy9u
ZXQveGVuLW5ldGJhY2svaW50ZXJmYWNlLmMKQEAgLTUxOSw2ICs1MTksNyBAQCBzdHJ1Y3QgeGVu
dmlmICp4ZW52aWZfYWxsb2Moc3RydWN0IGRldmljZSAqcGFyZW50LCBkb21pZF90IGRvbWlkLAog
aW50IHhlbnZpZl9pbml0X3F1ZXVlKHN0cnVjdCB4ZW52aWZfcXVldWUgKnF1ZXVlKQogewogCWlu
dCBlcnIsIGk7CisJc3RydWN0IHhlbmJ1c19kZXZpY2UgKmRldiA9IHhlbnZpZl90b194ZW5idXNf
ZGV2aWNlKHF1ZXVlLT52aWYpOwogCiAJcXVldWUtPmNyZWRpdF9ieXRlcyA9IHF1ZXVlLT5yZW1h
aW5pbmdfY3JlZGl0ID0gfjBVTDsKIAlxdWV1ZS0+Y3JlZGl0X3VzZWMgID0gMFVMOwpAQCAtNTQy
LDcgKzU0Myw3IEBAIGludCB4ZW52aWZfaW5pdF9xdWV1ZShzdHJ1Y3QgeGVudmlmX3F1ZXVlICpx
dWV1ZSkKIAkgKiBiZXR0ZXIgZW5hYmxlIGl0LiBUaGUgbG9uZyB0ZXJtIHNvbHV0aW9uIHdvdWxk
IGJlIHRvIHVzZSBqdXN0IGEKIAkgKiBidW5jaCBvZiB2YWxpZCBwYWdlIGRlc2NyaXB0b3JzLCB3
aXRob3V0IGRlcGVuZGVuY3kgb24gYmFsbG9vbmluZwogCSAqLwotCWVyciA9IGdudHRhYl9hbGxv
Y19wYWdlcyhNQVhfUEVORElOR19SRVFTLAorCWVyciA9IGdudHRhYl9hbGxvY19wYWdlcyhkZXYt
PnhoLCBNQVhfUEVORElOR19SRVFTLAogCQkJCSBxdWV1ZS0+bW1hcF9wYWdlcyk7CiAJaWYgKGVy
cikgewogCQluZXRkZXZfZXJyKHF1ZXVlLT52aWYtPmRldiwgIkNvdWxkIG5vdCByZXNlcnZlIG1t
YXBfcGFnZXNcbiIpOwpAQCAtNzkwLDcgKzc5MSw5IEBAIHZvaWQgeGVudmlmX2Rpc2Nvbm5lY3Rf
Y3RybChzdHJ1Y3QgeGVudmlmICp2aWYpCiAgKi8KIHZvaWQgeGVudmlmX2RlaW5pdF9xdWV1ZShz
dHJ1Y3QgeGVudmlmX3F1ZXVlICpxdWV1ZSkKIHsKLQlnbnR0YWJfZnJlZV9wYWdlcyhNQVhfUEVO
RElOR19SRVFTLCBxdWV1ZS0+bW1hcF9wYWdlcyk7CisJc3RydWN0IHhlbmJ1c19kZXZpY2UgKmRl
diA9IHhlbnZpZl90b194ZW5idXNfZGV2aWNlKHF1ZXVlLT52aWYpOworCisJZ250dGFiX2ZyZWVf
cGFnZXMoZGV2LT54aCwgTUFYX1BFTkRJTkdfUkVRUywgcXVldWUtPm1tYXBfcGFnZXMpOwogfQog
CiB2b2lkIHhlbnZpZl9mcmVlKHN0cnVjdCB4ZW52aWYgKnZpZikKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvbmV0L3hlbi1uZXRiYWNrL25ldGJhY2suYyBiL2RyaXZlcnMvbmV0L3hlbi1uZXRiYWNrL25l
dGJhY2suYwppbmRleCA4MGFhZTNhMzJjMmEuLjA1NWRlNjJlY2JmNSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9uZXQveGVuLW5ldGJhY2svbmV0YmFjay5jCisrKyBiL2RyaXZlcnMvbmV0L3hlbi1uZXRi
YWNrL25ldGJhY2suYwpAQCAtMTI0NCw2ICsxMjQ0LDcgQEAgc3RhdGljIGlubGluZSB2b2lkIHhl
bnZpZl90eF9kZWFsbG9jX2FjdGlvbihzdHJ1Y3QgeGVudmlmX3F1ZXVlICpxdWV1ZSkKIAlwZW5k
aW5nX3JpbmdfaWR4X3QgZGMsIGRwOwogCXUxNiBwZW5kaW5nX2lkeCwgcGVuZGluZ19pZHhfcmVs
ZWFzZVtNQVhfUEVORElOR19SRVFTXTsKIAl1bnNpZ25lZCBpbnQgaSA9IDA7CisJc3RydWN0IHhl
bmJ1c19kZXZpY2UgKmRldiA9IHhlbnZpZl90b194ZW5idXNfZGV2aWNlKHF1ZXVlLT52aWYpOwog
CiAJZGMgPSBxdWV1ZS0+ZGVhbGxvY19jb25zOwogCWdvcCA9IHF1ZXVlLT50eF91bm1hcF9vcHM7
CkBAIC0xMjgwLDcgKzEyODEsNyBAQCBzdGF0aWMgaW5saW5lIHZvaWQgeGVudmlmX3R4X2RlYWxs
b2NfYWN0aW9uKHN0cnVjdCB4ZW52aWZfcXVldWUgKnF1ZXVlKQogCiAJaWYgKGdvcCAtIHF1ZXVl
LT50eF91bm1hcF9vcHMgPiAwKSB7CiAJCWludCByZXQ7Ci0JCXJldCA9IGdudHRhYl91bm1hcF9y
ZWZzKHF1ZXVlLT50eF91bm1hcF9vcHMsCisJCXJldCA9IGdudHRhYl91bm1hcF9yZWZzKGRldi0+
eGgsIHF1ZXVlLT50eF91bm1hcF9vcHMsCiAJCQkJCU5VTEwsCiAJCQkJCXF1ZXVlLT5wYWdlc190
b191bm1hcCwKIAkJCQkJZ29wIC0gcXVldWUtPnR4X3VubWFwX29wcyk7CkBAIC0xMzEwLDYgKzEz
MTEsNyBAQCBpbnQgeGVudmlmX3R4X2FjdGlvbihzdHJ1Y3QgeGVudmlmX3F1ZXVlICpxdWV1ZSwg
aW50IGJ1ZGdldCkKIHsKIAl1bnNpZ25lZCBucl9tb3BzLCBucl9jb3BzID0gMDsKIAlpbnQgd29y
a19kb25lLCByZXQ7CisJc3RydWN0IHhlbmJ1c19kZXZpY2UgKmRldiA9IHhlbnZpZl90b194ZW5i
dXNfZGV2aWNlKHF1ZXVlLT52aWYpOwogCiAJaWYgKHVubGlrZWx5KCF0eF93b3JrX3RvZG8ocXVl
dWUpKSkKIAkJcmV0dXJuIDA7CkBAIC0xMzE5LDkgKzEzMjEsOSBAQCBpbnQgeGVudmlmX3R4X2Fj
dGlvbihzdHJ1Y3QgeGVudmlmX3F1ZXVlICpxdWV1ZSwgaW50IGJ1ZGdldCkKIAlpZiAobnJfY29w
cyA9PSAwKQogCQlyZXR1cm4gMDsKIAotCWdudHRhYl9iYXRjaF9jb3B5KHF1ZXVlLT50eF9jb3B5
X29wcywgbnJfY29wcyk7CisJZ250dGFiX2JhdGNoX2NvcHkoZGV2LT54aCwgcXVldWUtPnR4X2Nv
cHlfb3BzLCBucl9jb3BzKTsKIAlpZiAobnJfbW9wcyAhPSAwKSB7Ci0JCXJldCA9IGdudHRhYl9t
YXBfcmVmcyhxdWV1ZS0+dHhfbWFwX29wcywKKwkJcmV0ID0gZ250dGFiX21hcF9yZWZzKGRldi0+
eGgsIHF1ZXVlLT50eF9tYXBfb3BzLAogCQkJCSAgICAgIE5VTEwsCiAJCQkJICAgICAgcXVldWUt
PnBhZ2VzX3RvX21hcCwKIAkJCQkgICAgICBucl9tb3BzKTsKQEAgLTEzOTEsNiArMTM5Myw3IEBA
IHZvaWQgeGVudmlmX2lkeF91bm1hcChzdHJ1Y3QgeGVudmlmX3F1ZXVlICpxdWV1ZSwgdTE2IHBl
bmRpbmdfaWR4KQogewogCWludCByZXQ7CiAJc3RydWN0IGdudHRhYl91bm1hcF9ncmFudF9yZWYg
dHhfdW5tYXBfb3A7CisJc3RydWN0IHhlbmJ1c19kZXZpY2UgKmRldiA9IHhlbnZpZl90b194ZW5i
dXNfZGV2aWNlKHF1ZXVlLT52aWYpOwogCiAJZ250dGFiX3NldF91bm1hcF9vcCgmdHhfdW5tYXBf
b3AsCiAJCQkgICAgaWR4X3RvX2thZGRyKHF1ZXVlLCBwZW5kaW5nX2lkeCksCkBAIC0xMzk4LDcg
KzE0MDEsNyBAQCB2b2lkIHhlbnZpZl9pZHhfdW5tYXAoc3RydWN0IHhlbnZpZl9xdWV1ZSAqcXVl
dWUsIHUxNiBwZW5kaW5nX2lkeCkKIAkJCSAgICBxdWV1ZS0+Z3JhbnRfdHhfaGFuZGxlW3BlbmRp
bmdfaWR4XSk7CiAJeGVudmlmX2dyYW50X2hhbmRsZV9yZXNldChxdWV1ZSwgcGVuZGluZ19pZHgp
OwogCi0JcmV0ID0gZ250dGFiX3VubWFwX3JlZnMoJnR4X3VubWFwX29wLCBOVUxMLAorCXJldCA9
IGdudHRhYl91bm1hcF9yZWZzKGRldi0+eGgsICZ0eF91bm1hcF9vcCwgTlVMTCwKIAkJCQkmcXVl
dWUtPm1tYXBfcGFnZXNbcGVuZGluZ19pZHhdLCAxKTsKIAlpZiAocmV0KSB7CiAJCW5ldGRldl9l
cnIocXVldWUtPnZpZi0+ZGV2LApkaWZmIC0tZ2l0IGEvZHJpdmVycy9uZXQveGVuLW5ldGJhY2sv
cnguYyBiL2RyaXZlcnMvbmV0L3hlbi1uZXRiYWNrL3J4LmMKaW5kZXggZWY1ODg3MDM3YjIyLi5h
YThmY2JlMzE1YTYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvbmV0L3hlbi1uZXRiYWNrL3J4LmMKKysr
IGIvZHJpdmVycy9uZXQveGVuLW5ldGJhY2svcnguYwpAQCAtMTM0LDggKzEzNCw5IEBAIHN0YXRp
YyB2b2lkIHhlbnZpZl9yeF9jb3B5X2ZsdXNoKHN0cnVjdCB4ZW52aWZfcXVldWUgKnF1ZXVlKQog
ewogCXVuc2lnbmVkIGludCBpOwogCWludCBub3RpZnk7CisJc3RydWN0IHhlbmJ1c19kZXZpY2Ug
KmRldiA9IHhlbnZpZl90b194ZW5idXNfZGV2aWNlKHF1ZXVlLT52aWYpOwogCi0JZ250dGFiX2Jh
dGNoX2NvcHkocXVldWUtPnJ4X2NvcHkub3AsIHF1ZXVlLT5yeF9jb3B5Lm51bSk7CisJZ250dGFi
X2JhdGNoX2NvcHkoZGV2LT54aCwgcXVldWUtPnJ4X2NvcHkub3AsIHF1ZXVlLT5yeF9jb3B5Lm51
bSk7CiAKIAlmb3IgKGkgPSAwOyBpIDwgcXVldWUtPnJ4X2NvcHkubnVtOyBpKyspIHsKIAkJc3Ry
dWN0IGdudHRhYl9jb3B5ICpvcDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvbmV0L3hlbi1uZXRiYWNr
L3hlbmJ1cy5jIGIvZHJpdmVycy9uZXQveGVuLW5ldGJhY2sveGVuYnVzLmMKaW5kZXggMjYyNTc0
MGJkYzRhLi4wOTMxNmMyMjFkYjkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvbmV0L3hlbi1uZXRiYWNr
L3hlbmJ1cy5jCisrKyBiL2RyaXZlcnMvbmV0L3hlbi1uZXRiYWNrL3hlbmJ1cy5jCkBAIC0yNTcs
NyArMjU3LDcgQEAgc3RhdGljIGludCBuZXRiYWNrX3JlbW92ZShzdHJ1Y3QgeGVuYnVzX2Rldmlj
ZSAqZGV2KQogCWlmIChiZS0+dmlmKSB7CiAJCWtvYmplY3RfdWV2ZW50KCZkZXYtPmRldi5rb2Jq
LCBLT0JKX09GRkxJTkUpOwogCQl4ZW5fdW5yZWdpc3Rlcl93YXRjaGVycyhiZS0+dmlmKTsKLQkJ
eGVuYnVzX3JtKFhCVF9OSUwsIGRldi0+bm9kZW5hbWUsICJob3RwbHVnLXN0YXR1cyIpOworCQl4
ZW5idXNfcm0oZGV2LT54aCwgWEJUX05JTCwgZGV2LT5ub2RlbmFtZSwgImhvdHBsdWctc3RhdHVz
Iik7CiAJCXhlbnZpZl9mcmVlKGJlLT52aWYpOwogCQliZS0+dmlmID0gTlVMTDsKIAl9CkBAIC0y
OTksMjYgKzI5OSwyNiBAQCBzdGF0aWMgaW50IG5ldGJhY2tfcHJvYmUoc3RydWN0IHhlbmJ1c19k
ZXZpY2UgKmRldiwKIAlzZyA9IDE7CiAKIAlkbyB7Ci0JCWVyciA9IHhlbmJ1c190cmFuc2FjdGlv
bl9zdGFydCgmeGJ0KTsKKwkJZXJyID0geGVuYnVzX3RyYW5zYWN0aW9uX3N0YXJ0KGRldi0+eGgs
ICZ4YnQpOwogCQlpZiAoZXJyKSB7CiAJCQl4ZW5idXNfZGV2X2ZhdGFsKGRldiwgZXJyLCAic3Rh
cnRpbmcgdHJhbnNhY3Rpb24iKTsKIAkJCWdvdG8gZmFpbDsKIAkJfQogCi0JCWVyciA9IHhlbmJ1
c19wcmludGYoeGJ0LCBkZXYtPm5vZGVuYW1lLCAiZmVhdHVyZS1zZyIsICIlZCIsIHNnKTsKKwkJ
ZXJyID0geGVuYnVzX3ByaW50ZihkZXYtPnhoLCB4YnQsIGRldi0+bm9kZW5hbWUsICJmZWF0dXJl
LXNnIiwgIiVkIiwgc2cpOwogCQlpZiAoZXJyKSB7CiAJCQltZXNzYWdlID0gIndyaXRpbmcgZmVh
dHVyZS1zZyI7CiAJCQlnb3RvIGFib3J0X3RyYW5zYWN0aW9uOwogCQl9CiAKLQkJZXJyID0geGVu
YnVzX3ByaW50Zih4YnQsIGRldi0+bm9kZW5hbWUsICJmZWF0dXJlLWdzby10Y3B2NCIsCisJCWVy
ciA9IHhlbmJ1c19wcmludGYoZGV2LT54aCwgeGJ0LCBkZXYtPm5vZGVuYW1lLCAiZmVhdHVyZS1n
c28tdGNwdjQiLAogCQkJCSAgICAiJWQiLCBzZyk7CiAJCWlmIChlcnIpIHsKIAkJCW1lc3NhZ2Ug
PSAid3JpdGluZyBmZWF0dXJlLWdzby10Y3B2NCI7CiAJCQlnb3RvIGFib3J0X3RyYW5zYWN0aW9u
OwogCQl9CiAKLQkJZXJyID0geGVuYnVzX3ByaW50Zih4YnQsIGRldi0+bm9kZW5hbWUsICJmZWF0
dXJlLWdzby10Y3B2NiIsCisJCWVyciA9IHhlbmJ1c19wcmludGYoZGV2LT54aCwgeGJ0LCBkZXYt
Pm5vZGVuYW1lLCAiZmVhdHVyZS1nc28tdGNwdjYiLAogCQkJCSAgICAiJWQiLCBzZyk7CiAJCWlm
IChlcnIpIHsKIAkJCW1lc3NhZ2UgPSAid3JpdGluZyBmZWF0dXJlLWdzby10Y3B2NiI7CkBAIC0z
MjYsNyArMzI2LDcgQEAgc3RhdGljIGludCBuZXRiYWNrX3Byb2JlKHN0cnVjdCB4ZW5idXNfZGV2
aWNlICpkZXYsCiAJCX0KIAogCQkvKiBXZSBzdXBwb3J0IHBhcnRpYWwgY2hlY2tzdW0gc2V0dXAg
Zm9yIElQdjYgcGFja2V0cyAqLwotCQllcnIgPSB4ZW5idXNfcHJpbnRmKHhidCwgZGV2LT5ub2Rl
bmFtZSwKKwkJZXJyID0geGVuYnVzX3ByaW50ZihkZXYtPnhoLCB4YnQsIGRldi0+bm9kZW5hbWUs
CiAJCQkJICAgICJmZWF0dXJlLWlwdjYtY3N1bS1vZmZsb2FkIiwKIAkJCQkgICAgIiVkIiwgMSk7
CiAJCWlmIChlcnIpIHsKQEAgLTMzNSw3ICszMzUsNyBAQCBzdGF0aWMgaW50IG5ldGJhY2tfcHJv
YmUoc3RydWN0IHhlbmJ1c19kZXZpY2UgKmRldiwKIAkJfQogCiAJCS8qIFdlIHN1cHBvcnQgcngt
Y29weSBwYXRoLiAqLwotCQllcnIgPSB4ZW5idXNfcHJpbnRmKHhidCwgZGV2LT5ub2RlbmFtZSwK
KwkJZXJyID0geGVuYnVzX3ByaW50ZihkZXYtPnhoLCB4YnQsIGRldi0+bm9kZW5hbWUsCiAJCQkJ
ICAgICJmZWF0dXJlLXJ4LWNvcHkiLCAiJWQiLCAxKTsKIAkJaWYgKGVycikgewogCQkJbWVzc2Fn
ZSA9ICJ3cml0aW5nIGZlYXR1cmUtcngtY29weSI7CkBAIC0zNDYsNyArMzQ2LDcgQEAgc3RhdGlj
IGludCBuZXRiYWNrX3Byb2JlKHN0cnVjdCB4ZW5idXNfZGV2aWNlICpkZXYsCiAJCSAqIFdlIGRv
bid0IHN1cHBvcnQgcngtZmxpcCBwYXRoIChleGNlcHQgb2xkIGd1ZXN0cyB3aG8gZG9uJ3QKIAkJ
ICogZ3JvayB0aGlzIGZlYXR1cmUgZmxhZykuCiAJCSAqLwotCQllcnIgPSB4ZW5idXNfcHJpbnRm
KHhidCwgZGV2LT5ub2RlbmFtZSwKKwkJZXJyID0geGVuYnVzX3ByaW50ZihkZXYtPnhoLCB4YnQs
IGRldi0+bm9kZW5hbWUsCiAJCQkJICAgICJmZWF0dXJlLXJ4LWZsaXAiLCAiJWQiLCAwKTsKIAkJ
aWYgKGVycikgewogCQkJbWVzc2FnZSA9ICJ3cml0aW5nIGZlYXR1cmUtcngtZmxpcCI7CkBAIC0z
NTQsMTQgKzM1NCwxNCBAQCBzdGF0aWMgaW50IG5ldGJhY2tfcHJvYmUoc3RydWN0IHhlbmJ1c19k
ZXZpY2UgKmRldiwKIAkJfQogCiAJCS8qIFdlIHN1cHBvcnQgZHluYW1pYyBtdWx0aWNhc3QtY29u
dHJvbC4gKi8KLQkJZXJyID0geGVuYnVzX3ByaW50Zih4YnQsIGRldi0+bm9kZW5hbWUsCisJCWVy
ciA9IHhlbmJ1c19wcmludGYoZGV2LT54aCwgeGJ0LCBkZXYtPm5vZGVuYW1lLAogCQkJCSAgICAi
ZmVhdHVyZS1tdWx0aWNhc3QtY29udHJvbCIsICIlZCIsIDEpOwogCQlpZiAoZXJyKSB7CiAJCQlt
ZXNzYWdlID0gIndyaXRpbmcgZmVhdHVyZS1tdWx0aWNhc3QtY29udHJvbCI7CiAJCQlnb3RvIGFi
b3J0X3RyYW5zYWN0aW9uOwogCQl9CiAKLQkJZXJyID0geGVuYnVzX3ByaW50Zih4YnQsIGRldi0+
bm9kZW5hbWUsCisJCWVyciA9IHhlbmJ1c19wcmludGYoZGV2LT54aCwgeGJ0LCBkZXYtPm5vZGVu
YW1lLAogCQkJCSAgICAiZmVhdHVyZS1keW5hbWljLW11bHRpY2FzdC1jb250cm9sIiwKIAkJCQkg
ICAgIiVkIiwgMSk7CiAJCWlmIChlcnIpIHsKQEAgLTM2OSw3ICszNjksNyBAQCBzdGF0aWMgaW50
IG5ldGJhY2tfcHJvYmUoc3RydWN0IHhlbmJ1c19kZXZpY2UgKmRldiwKIAkJCWdvdG8gYWJvcnRf
dHJhbnNhY3Rpb247CiAJCX0KIAotCQllcnIgPSB4ZW5idXNfdHJhbnNhY3Rpb25fZW5kKHhidCwg
MCk7CisJCWVyciA9IHhlbmJ1c190cmFuc2FjdGlvbl9lbmQoZGV2LT54aCwgeGJ0LCAwKTsKIAl9
IHdoaWxlIChlcnIgPT0gLUVBR0FJTik7CiAKIAlpZiAoZXJyKSB7CkBAIC0zODEsMjUgKzM4MSwy
NSBAQCBzdGF0aWMgaW50IG5ldGJhY2tfcHJvYmUoc3RydWN0IHhlbmJ1c19kZXZpY2UgKmRldiwK
IAkgKiBTcGxpdCBldmVudCBjaGFubmVscyBzdXBwb3J0LCB0aGlzIGlzIG9wdGlvbmFsIHNvIGl0
IGlzIG5vdAogCSAqIHB1dCBpbnNpZGUgdGhlIGFib3ZlIGxvb3AuCiAJICovCi0JZXJyID0geGVu
YnVzX3ByaW50ZihYQlRfTklMLCBkZXYtPm5vZGVuYW1lLAorCWVyciA9IHhlbmJ1c19wcmludGYo
ZGV2LT54aCwgWEJUX05JTCwgZGV2LT5ub2RlbmFtZSwKIAkJCSAgICAiZmVhdHVyZS1zcGxpdC1l
dmVudC1jaGFubmVscyIsCiAJCQkgICAgIiV1Iiwgc2VwYXJhdGVfdHhfcnhfaXJxKTsKIAlpZiAo
ZXJyKQogCQlwcl9kZWJ1ZygiRXJyb3Igd3JpdGluZyBmZWF0dXJlLXNwbGl0LWV2ZW50LWNoYW5u
ZWxzXG4iKTsKIAogCS8qIE11bHRpLXF1ZXVlIHN1cHBvcnQ6IFRoaXMgaXMgYW4gb3B0aW9uYWwg
ZmVhdHVyZS4gKi8KLQllcnIgPSB4ZW5idXNfcHJpbnRmKFhCVF9OSUwsIGRldi0+bm9kZW5hbWUs
CisJZXJyID0geGVuYnVzX3ByaW50ZihkZXYtPnhoLCBYQlRfTklMLCBkZXYtPm5vZGVuYW1lLAog
CQkJICAgICJtdWx0aS1xdWV1ZS1tYXgtcXVldWVzIiwgIiV1IiwgeGVudmlmX21heF9xdWV1ZXMp
OwogCWlmIChlcnIpCiAJCXByX2RlYnVnKCJFcnJvciB3cml0aW5nIG11bHRpLXF1ZXVlLW1heC1x
dWV1ZXNcbiIpOwogCi0JZXJyID0geGVuYnVzX3ByaW50ZihYQlRfTklMLCBkZXYtPm5vZGVuYW1l
LAorCWVyciA9IHhlbmJ1c19wcmludGYoZGV2LT54aCwgWEJUX05JTCwgZGV2LT5ub2RlbmFtZSwK
IAkJCSAgICAiZmVhdHVyZS1jdHJsLXJpbmciLAogCQkJICAgICIldSIsIHRydWUpOwogCWlmIChl
cnIpCiAJCXByX2RlYnVnKCJFcnJvciB3cml0aW5nIGZlYXR1cmUtY3RybC1yaW5nXG4iKTsKIAot
CXNjcmlwdCA9IHhlbmJ1c19yZWFkKFhCVF9OSUwsIGRldi0+bm9kZW5hbWUsICJzY3JpcHQiLCBO
VUxMKTsKKwlzY3JpcHQgPSB4ZW5idXNfcmVhZChkZXYtPnhoLCBYQlRfTklMLCBkZXYtPm5vZGVu
YW1lLCAic2NyaXB0IiwgTlVMTCk7CiAJaWYgKElTX0VSUihzY3JpcHQpKSB7CiAJCWVyciA9IFBU
Ul9FUlIoc2NyaXB0KTsKIAkJeGVuYnVzX2Rldl9mYXRhbChkZXYsIGVyciwgInJlYWRpbmcgc2Ny
aXB0Iik7CkBAIC00MTcsNyArNDE3LDcgQEAgc3RhdGljIGludCBuZXRiYWNrX3Byb2JlKHN0cnVj
dCB4ZW5idXNfZGV2aWNlICpkZXYsCiAJcmV0dXJuIDA7CiAKIGFib3J0X3RyYW5zYWN0aW9uOgot
CXhlbmJ1c190cmFuc2FjdGlvbl9lbmQoeGJ0LCAxKTsKKwl4ZW5idXNfdHJhbnNhY3Rpb25fZW5k
KGRldi0+eGgsIHhidCwgMSk7CiAJeGVuYnVzX2Rldl9mYXRhbChkZXYsIGVyciwgIiVzIiwgbWVz
c2FnZSk7CiBmYWlsOgogCXByX2RlYnVnKCJmYWlsZWRcbiIpOwpAQCAtNDU5LDcgKzQ1OSw3IEBA
IHN0YXRpYyBpbnQgYmFja2VuZF9jcmVhdGVfeGVudmlmKHN0cnVjdCBiYWNrZW5kX2luZm8gKmJl
KQogCWlmIChiZS0+dmlmICE9IE5VTEwpCiAJCXJldHVybiAwOwogCi0JZXJyID0geGVuYnVzX3Nj
YW5mKFhCVF9OSUwsIGRldi0+bm9kZW5hbWUsICJoYW5kbGUiLCAiJWxpIiwgJmhhbmRsZSk7CisJ
ZXJyID0geGVuYnVzX3NjYW5mKGRldi0+eGgsIFhCVF9OSUwsIGRldi0+bm9kZW5hbWUsICJoYW5k
bGUiLCAiJWxpIiwgJmhhbmRsZSk7CiAJaWYgKGVyciAhPSAxKSB7CiAJCXhlbmJ1c19kZXZfZmF0
YWwoZGV2LCBlcnIsICJyZWFkaW5nIGhhbmRsZSIpOwogCQlyZXR1cm4gKGVyciA8IDApID8gZXJy
IDogLUVJTlZBTDsKQEAgLTY4MCw3ICs2ODAsNyBAQCBzdGF0aWMgdm9pZCB4ZW5fbmV0X3JlYWRf
cmF0ZShzdHJ1Y3QgeGVuYnVzX2RldmljZSAqZGV2LAogCSpieXRlcyA9IH4wVUw7CiAJKnVzZWMg
PSAwOwogCi0JcmF0ZXN0ciA9IHhlbmJ1c19yZWFkKFhCVF9OSUwsIGRldi0+bm9kZW5hbWUsICJy
YXRlIiwgTlVMTCk7CisJcmF0ZXN0ciA9IHhlbmJ1c19yZWFkKGRldi0+eGgsIFhCVF9OSUwsIGRl
di0+bm9kZW5hbWUsICJyYXRlIiwgTlVMTCk7CiAJaWYgKElTX0VSUihyYXRlc3RyKSkKIAkJcmV0
dXJuOwogCkBAIC03MTAsNyArNzEwLDcgQEAgc3RhdGljIGludCB4ZW5fbmV0X3JlYWRfbWFjKHN0
cnVjdCB4ZW5idXNfZGV2aWNlICpkZXYsIHU4IG1hY1tdKQogCWNoYXIgKnMsICplLCAqbWFjc3Ry
OwogCWludCBpOwogCi0JbWFjc3RyID0gcyA9IHhlbmJ1c19yZWFkKFhCVF9OSUwsIGRldi0+bm9k
ZW5hbWUsICJtYWMiLCBOVUxMKTsKKwltYWNzdHIgPSBzID0geGVuYnVzX3JlYWQoZGV2LT54aCwg
WEJUX05JTCwgZGV2LT5ub2RlbmFtZSwgIm1hYyIsIE5VTEwpOwogCWlmIChJU19FUlIobWFjc3Ry
KSkKIAkJcmV0dXJuIFBUUl9FUlIobWFjc3RyKTsKIApAQCAtNzY1LDcgKzc2NSw3IEBAIHN0YXRp
YyBpbnQgeGVuX3JlZ2lzdGVyX2NyZWRpdF93YXRjaChzdHJ1Y3QgeGVuYnVzX2RldmljZSAqZGV2
LAogCXNucHJpbnRmKG5vZGUsIG1heGxlbiwgIiVzL3JhdGUiLCBkZXYtPm5vZGVuYW1lKTsKIAl2
aWYtPmNyZWRpdF93YXRjaC5ub2RlID0gbm9kZTsKIAl2aWYtPmNyZWRpdF93YXRjaC5jYWxsYmFj
ayA9IHhlbl9uZXRfcmF0ZV9jaGFuZ2VkOwotCWVyciA9IHJlZ2lzdGVyX3hlbmJ1c193YXRjaCgm
dmlmLT5jcmVkaXRfd2F0Y2gpOworCWVyciA9IHJlZ2lzdGVyX3hlbmJ1c193YXRjaChkZXYtPnho
LCAmdmlmLT5jcmVkaXRfd2F0Y2gpOwogCWlmIChlcnIpIHsKIAkJcHJfZXJyKCJGYWlsZWQgdG8g
c2V0IHdhdGNoZXIgJXNcbiIsIHZpZi0+Y3JlZGl0X3dhdGNoLm5vZGUpOwogCQlrZnJlZShub2Rl
KTsKQEAgLTc3Nyw4ICs3NzcsOSBAQCBzdGF0aWMgaW50IHhlbl9yZWdpc3Rlcl9jcmVkaXRfd2F0
Y2goc3RydWN0IHhlbmJ1c19kZXZpY2UgKmRldiwKIAogc3RhdGljIHZvaWQgeGVuX3VucmVnaXN0
ZXJfY3JlZGl0X3dhdGNoKHN0cnVjdCB4ZW52aWYgKnZpZikKIHsKKwlzdHJ1Y3QgeGVuYnVzX2Rl
dmljZSAqZGV2ID0geGVudmlmX3RvX3hlbmJ1c19kZXZpY2UodmlmKTsKIAlpZiAodmlmLT5jcmVk
aXRfd2F0Y2gubm9kZSkgewotCQl1bnJlZ2lzdGVyX3hlbmJ1c193YXRjaCgmdmlmLT5jcmVkaXRf
d2F0Y2gpOworCQl1bnJlZ2lzdGVyX3hlbmJ1c193YXRjaChkZXYtPnhoLCAmdmlmLT5jcmVkaXRf
d2F0Y2gpOwogCQlrZnJlZSh2aWYtPmNyZWRpdF93YXRjaC5ub2RlKTsKIAkJdmlmLT5jcmVkaXRf
d2F0Y2gubm9kZSA9IE5VTEw7CiAJfQpAQCAtNzkxLDcgKzc5Miw3IEBAIHN0YXRpYyB2b2lkIHhl
bl9tY2FzdF9jdHJsX2NoYW5nZWQoc3RydWN0IHhlbmJ1c193YXRjaCAqd2F0Y2gsCiAJCQkJCSAg
bWNhc3RfY3RybF93YXRjaCk7CiAJc3RydWN0IHhlbmJ1c19kZXZpY2UgKmRldiA9IHhlbnZpZl90
b194ZW5idXNfZGV2aWNlKHZpZik7CiAKLQl2aWYtPm11bHRpY2FzdF9jb250cm9sID0gISF4ZW5i
dXNfcmVhZF91bnNpZ25lZChkZXYtPm90aGVyZW5kLAorCXZpZi0+bXVsdGljYXN0X2NvbnRyb2wg
PSAhIXhlbmJ1c19yZWFkX3Vuc2lnbmVkKGRldi0+eGgsIGRldi0+b3RoZXJlbmQsCiAJCQkJCSJy
ZXF1ZXN0LW11bHRpY2FzdC1jb250cm9sIiwgMCk7CiB9CiAKQEAgLTgxNyw3ICs4MTgsNyBAQCBz
dGF0aWMgaW50IHhlbl9yZWdpc3Rlcl9tY2FzdF9jdHJsX3dhdGNoKHN0cnVjdCB4ZW5idXNfZGV2
aWNlICpkZXYsCiAJCSBkZXYtPm90aGVyZW5kKTsKIAl2aWYtPm1jYXN0X2N0cmxfd2F0Y2gubm9k
ZSA9IG5vZGU7CiAJdmlmLT5tY2FzdF9jdHJsX3dhdGNoLmNhbGxiYWNrID0geGVuX21jYXN0X2N0
cmxfY2hhbmdlZDsKLQllcnIgPSByZWdpc3Rlcl94ZW5idXNfd2F0Y2goJnZpZi0+bWNhc3RfY3Ry
bF93YXRjaCk7CisJZXJyID0gcmVnaXN0ZXJfeGVuYnVzX3dhdGNoKGRldi0+eGgsICZ2aWYtPm1j
YXN0X2N0cmxfd2F0Y2gpOwogCWlmIChlcnIpIHsKIAkJcHJfZXJyKCJGYWlsZWQgdG8gc2V0IHdh
dGNoZXIgJXNcbiIsCiAJCSAgICAgICB2aWYtPm1jYXN0X2N0cmxfd2F0Y2gubm9kZSk7CkBAIC04
MzAsOCArODMxLDEwIEBAIHN0YXRpYyBpbnQgeGVuX3JlZ2lzdGVyX21jYXN0X2N0cmxfd2F0Y2go
c3RydWN0IHhlbmJ1c19kZXZpY2UgKmRldiwKIAogc3RhdGljIHZvaWQgeGVuX3VucmVnaXN0ZXJf
bWNhc3RfY3RybF93YXRjaChzdHJ1Y3QgeGVudmlmICp2aWYpCiB7CisJc3RydWN0IHhlbmJ1c19k
ZXZpY2UgKmRldiA9IHhlbnZpZl90b194ZW5idXNfZGV2aWNlKHZpZik7CisKIAlpZiAodmlmLT5t
Y2FzdF9jdHJsX3dhdGNoLm5vZGUpIHsKLQkJdW5yZWdpc3Rlcl94ZW5idXNfd2F0Y2goJnZpZi0+
bWNhc3RfY3RybF93YXRjaCk7CisJCXVucmVnaXN0ZXJfeGVuYnVzX3dhdGNoKGRldi0+eGgsICZ2
aWYtPm1jYXN0X2N0cmxfd2F0Y2gpOwogCQlrZnJlZSh2aWYtPm1jYXN0X2N0cmxfd2F0Y2gubm9k
ZSk7CiAJCXZpZi0+bWNhc3RfY3RybF93YXRjaC5ub2RlID0gTlVMTDsKIAl9CkBAIC04NTMsNyAr
ODU2LDcgQEAgc3RhdGljIHZvaWQgeGVuX3VucmVnaXN0ZXJfd2F0Y2hlcnMoc3RydWN0IHhlbnZp
ZiAqdmlmKQogc3RhdGljIHZvaWQgdW5yZWdpc3Rlcl9ob3RwbHVnX3N0YXR1c193YXRjaChzdHJ1
Y3QgYmFja2VuZF9pbmZvICpiZSkKIHsKIAlpZiAoYmUtPmhhdmVfaG90cGx1Z19zdGF0dXNfd2F0
Y2gpIHsKLQkJdW5yZWdpc3Rlcl94ZW5idXNfd2F0Y2goJmJlLT5ob3RwbHVnX3N0YXR1c193YXRj
aCk7CisJCXVucmVnaXN0ZXJfeGVuYnVzX3dhdGNoKGJlLT5kZXYtPnhoLCAmYmUtPmhvdHBsdWdf
c3RhdHVzX3dhdGNoKTsKIAkJa2ZyZWUoYmUtPmhvdHBsdWdfc3RhdHVzX3dhdGNoLm5vZGUpOwog
CX0KIAliZS0+aGF2ZV9ob3RwbHVnX3N0YXR1c193YXRjaCA9IDA7CkBAIC04NjksNyArODcyLDcg
QEAgc3RhdGljIHZvaWQgaG90cGx1Z19zdGF0dXNfY2hhbmdlZChzdHJ1Y3QgeGVuYnVzX3dhdGNo
ICp3YXRjaCwKIAljaGFyICpzdHI7CiAJdW5zaWduZWQgaW50IGxlbjsKIAotCXN0ciA9IHhlbmJ1
c19yZWFkKFhCVF9OSUwsIGJlLT5kZXYtPm5vZGVuYW1lLCAiaG90cGx1Zy1zdGF0dXMiLCAmbGVu
KTsKKwlzdHIgPSB4ZW5idXNfcmVhZChiZS0+ZGV2LT54aCwgWEJUX05JTCwgYmUtPmRldi0+bm9k
ZW5hbWUsICJob3RwbHVnLXN0YXR1cyIsICZsZW4pOwogCWlmIChJU19FUlIoc3RyKSkKIAkJcmV0
dXJuOwogCWlmIChsZW4gPT0gc2l6ZW9mKCJjb25uZWN0ZWQiKS0xICYmICFtZW1jbXAoc3RyLCAi
Y29ubmVjdGVkIiwgbGVuKSkgewpAQCAtODkxLDE0ICs4OTQsMTQgQEAgc3RhdGljIGludCBjb25u
ZWN0X2N0cmxfcmluZyhzdHJ1Y3QgYmFja2VuZF9pbmZvICpiZSkKIAl1bnNpZ25lZCBpbnQgZXZ0
Y2huOwogCWludCBlcnI7CiAKLQllcnIgPSB4ZW5idXNfc2NhbmYoWEJUX05JTCwgZGV2LT5vdGhl
cmVuZCwKKwllcnIgPSB4ZW5idXNfc2NhbmYoZGV2LT54aCwgWEJUX05JTCwgZGV2LT5vdGhlcmVu
ZCwKIAkJCSAgICJjdHJsLXJpbmctcmVmIiwgIiV1IiwgJnZhbCk7CiAJaWYgKGVyciA8IDApCiAJ
CWdvdG8gZG9uZTsgLyogVGhlIGZyb250ZW5kIGRvZXMgbm90IGhhdmUgYSBjb250cm9sIHJpbmcg
Ki8KIAogCXJpbmdfcmVmID0gdmFsOwogCi0JZXJyID0geGVuYnVzX3NjYW5mKFhCVF9OSUwsIGRl
di0+b3RoZXJlbmQsCisJZXJyID0geGVuYnVzX3NjYW5mKGRldi0+eGgsIFhCVF9OSUwsIGRldi0+
b3RoZXJlbmQsCiAJCQkgICAiZXZlbnQtY2hhbm5lbC1jdHJsIiwgIiV1IiwgJnZhbCk7CiAJaWYg
KGVyciA8IDApIHsKIAkJeGVuYnVzX2Rldl9mYXRhbChkZXYsIGVyciwKQEAgLTkzNiw3ICs5Mzks
NyBAQCBzdGF0aWMgdm9pZCBjb25uZWN0KHN0cnVjdCBiYWNrZW5kX2luZm8gKmJlKQogCS8qIENo
ZWNrIHdoZXRoZXIgdGhlIGZyb250ZW5kIHJlcXVlc3RlZCBtdWx0aXBsZSBxdWV1ZXMKIAkgKiBh
bmQgcmVhZCB0aGUgbnVtYmVyIHJlcXVlc3RlZC4KIAkgKi8KLQlyZXF1ZXN0ZWRfbnVtX3F1ZXVl
cyA9IHhlbmJ1c19yZWFkX3Vuc2lnbmVkKGRldi0+b3RoZXJlbmQsCisJcmVxdWVzdGVkX251bV9x
dWV1ZXMgPSB4ZW5idXNfcmVhZF91bnNpZ25lZChkZXYtPnhoLCBkZXYtPm90aGVyZW5kLAogCQkJ
CQkibXVsdGktcXVldWUtbnVtLXF1ZXVlcyIsIDEpOwogCWlmIChyZXF1ZXN0ZWRfbnVtX3F1ZXVl
cyA+IHhlbnZpZl9tYXhfcXVldWVzKSB7CiAJCS8qIGJ1Z2d5IG9yIG1hbGljaW91cyBndWVzdCAq
LwpAQCAtMTA4Nyw3ICsxMDkwLDcgQEAgc3RhdGljIGludCBjb25uZWN0X2RhdGFfcmluZ3Moc3Ry
dWN0IGJhY2tlbmRfaW5mbyAqYmUsCiAJCQkgcXVldWUtPmlkKTsKIAl9CiAKLQllcnIgPSB4ZW5i
dXNfZ2F0aGVyKFhCVF9OSUwsIHhzcGF0aCwKKwllcnIgPSB4ZW5idXNfZ2F0aGVyKGRldi0+eGgs
IFhCVF9OSUwsIHhzcGF0aCwKIAkJCSAgICAidHgtcmluZy1yZWYiLCAiJWx1IiwgJnR4X3Jpbmdf
cmVmLAogCQkJICAgICJyeC1yaW5nLXJlZiIsICIlbHUiLCAmcnhfcmluZ19yZWYsIE5VTEwpOwog
CWlmIChlcnIpIHsKQEAgLTEwOTgsMTEgKzExMDEsMTEgQEAgc3RhdGljIGludCBjb25uZWN0X2Rh
dGFfcmluZ3Moc3RydWN0IGJhY2tlbmRfaW5mbyAqYmUsCiAJfQogCiAJLyogVHJ5IHNwbGl0IGV2
ZW50IGNoYW5uZWxzIGZpcnN0LCB0aGVuIHNpbmdsZSBldmVudCBjaGFubmVsLiAqLwotCWVyciA9
IHhlbmJ1c19nYXRoZXIoWEJUX05JTCwgeHNwYXRoLAorCWVyciA9IHhlbmJ1c19nYXRoZXIoZGV2
LT54aCwgWEJUX05JTCwgeHNwYXRoLAogCQkJICAgICJldmVudC1jaGFubmVsLXR4IiwgIiV1Iiwg
JnR4X2V2dGNobiwKIAkJCSAgICAiZXZlbnQtY2hhbm5lbC1yeCIsICIldSIsICZyeF9ldnRjaG4s
IE5VTEwpOwogCWlmIChlcnIgPCAwKSB7Ci0JCWVyciA9IHhlbmJ1c19zY2FuZihYQlRfTklMLCB4
c3BhdGgsCisJCWVyciA9IHhlbmJ1c19zY2FuZihkZXYtPnhoLCBYQlRfTklMLCB4c3BhdGgsCiAJ
CQkJICAgImV2ZW50LWNoYW5uZWwiLCAiJXUiLCAmdHhfZXZ0Y2huKTsKIAkJaWYgKGVyciA8IDAp
IHsKIAkJCXhlbmJ1c19kZXZfZmF0YWwoZGV2LCBlcnIsCkBAIC0xMTM3LDcgKzExNDAsNyBAQCBz
dGF0aWMgaW50IHJlYWRfeGVuYnVzX3ZpZl9mbGFncyhzdHJ1Y3QgYmFja2VuZF9pbmZvICpiZSkK
IAl1bnNpZ25lZCBpbnQgcnhfY29weTsKIAlpbnQgZXJyOwogCi0JZXJyID0geGVuYnVzX3NjYW5m
KFhCVF9OSUwsIGRldi0+b3RoZXJlbmQsICJyZXF1ZXN0LXJ4LWNvcHkiLCAiJXUiLAorCWVyciA9
IHhlbmJ1c19zY2FuZihkZXYtPnhoLCBYQlRfTklMLCBkZXYtPm90aGVyZW5kLCAicmVxdWVzdC1y
eC1jb3B5IiwgIiV1IiwKIAkJCSAgICZyeF9jb3B5KTsKIAlpZiAoZXJyID09IC1FTk9FTlQpIHsK
IAkJZXJyID0gMDsKQEAgLTExNTEsNyArMTE1NCw3IEBAIHN0YXRpYyBpbnQgcmVhZF94ZW5idXNf
dmlmX2ZsYWdzKHN0cnVjdCBiYWNrZW5kX2luZm8gKmJlKQogCWlmICghcnhfY29weSkKIAkJcmV0
dXJuIC1FT1BOT1RTVVBQOwogCi0JaWYgKCF4ZW5idXNfcmVhZF91bnNpZ25lZChkZXYtPm90aGVy
ZW5kLCAiZmVhdHVyZS1yeC1ub3RpZnkiLCAwKSkgeworCWlmICgheGVuYnVzX3JlYWRfdW5zaWdu
ZWQoZGV2LT54aCwgZGV2LT5vdGhlcmVuZCwgImZlYXR1cmUtcngtbm90aWZ5IiwgMCkpIHsKIAkJ
LyogLSBSZWR1Y2UgZHJhaW4gdGltZW91dCB0byBwb2xsIG1vcmUgZnJlcXVlbnRseSBmb3IKIAkJ
ICogICBSeCByZXF1ZXN0cy4KIAkJICogLSBEaXNhYmxlIFJ4IHN0YWxsIGRldGVjdGlvbi4KQEAg
LTExNjAsMjAgKzExNjMsMjAgQEAgc3RhdGljIGludCByZWFkX3hlbmJ1c192aWZfZmxhZ3Moc3Ry
dWN0IGJhY2tlbmRfaW5mbyAqYmUpCiAJCWJlLT52aWYtPnN0YWxsX3RpbWVvdXQgPSAwOwogCX0K
IAotCXZpZi0+Y2FuX3NnID0gISF4ZW5idXNfcmVhZF91bnNpZ25lZChkZXYtPm90aGVyZW5kLCAi
ZmVhdHVyZS1zZyIsIDApOworCXZpZi0+Y2FuX3NnID0gISF4ZW5idXNfcmVhZF91bnNpZ25lZChk
ZXYtPnhoLCBkZXYtPm90aGVyZW5kLCAiZmVhdHVyZS1zZyIsIDApOwogCiAJdmlmLT5nc29fbWFz
ayA9IDA7CiAKLQlpZiAoeGVuYnVzX3JlYWRfdW5zaWduZWQoZGV2LT5vdGhlcmVuZCwgImZlYXR1
cmUtZ3NvLXRjcHY0IiwgMCkpCisJaWYgKHhlbmJ1c19yZWFkX3Vuc2lnbmVkKGRldi0+eGgsIGRl
di0+b3RoZXJlbmQsICJmZWF0dXJlLWdzby10Y3B2NCIsIDApKQogCQl2aWYtPmdzb19tYXNrIHw9
IEdTT19CSVQoVENQVjQpOwogCi0JaWYgKHhlbmJ1c19yZWFkX3Vuc2lnbmVkKGRldi0+b3RoZXJl
bmQsICJmZWF0dXJlLWdzby10Y3B2NiIsIDApKQorCWlmICh4ZW5idXNfcmVhZF91bnNpZ25lZChk
ZXYtPnhoLCBkZXYtPm90aGVyZW5kLCAiZmVhdHVyZS1nc28tdGNwdjYiLCAwKSkKIAkJdmlmLT5n
c29fbWFzayB8PSBHU09fQklUKFRDUFY2KTsKIAotCXZpZi0+aXBfY3N1bSA9ICF4ZW5idXNfcmVh
ZF91bnNpZ25lZChkZXYtPm90aGVyZW5kLAorCXZpZi0+aXBfY3N1bSA9ICF4ZW5idXNfcmVhZF91
bnNpZ25lZChkZXYtPnhoLCBkZXYtPm90aGVyZW5kLAogCQkJCQkgICAgICJmZWF0dXJlLW5vLWNz
dW0tb2ZmbG9hZCIsIDApOwogCi0JdmlmLT5pcHY2X2NzdW0gPSAhIXhlbmJ1c19yZWFkX3Vuc2ln
bmVkKGRldi0+b3RoZXJlbmQsCisJdmlmLT5pcHY2X2NzdW0gPSAhIXhlbmJ1c19yZWFkX3Vuc2ln
bmVkKGRldi0+eGgsIGRldi0+b3RoZXJlbmQsCiAJCQkJCQkiZmVhdHVyZS1pcHY2LWNzdW0tb2Zm
bG9hZCIsIDApOwogCiAJcmV0dXJuIDA7CmRpZmYgLS1naXQgYS9kcml2ZXJzL25ldC94ZW4tbmV0
ZnJvbnQuYyBiL2RyaXZlcnMvbmV0L3hlbi1uZXRmcm9udC5jCmluZGV4IGVlMjhlOGI4NTQwNi4u
NzEwMDdhZDgyMmMwIDEwMDY0NAotLS0gYS9kcml2ZXJzL25ldC94ZW4tbmV0ZnJvbnQuYworKysg
Yi9kcml2ZXJzL25ldC94ZW4tbmV0ZnJvbnQuYwpAQCAtMjg1LDYgKzI4NSw3IEBAIHN0YXRpYyB2
b2lkIHhlbm5ldF9hbGxvY19yeF9idWZmZXJzKHN0cnVjdCBuZXRmcm9udF9xdWV1ZSAqcXVldWUp
CiAJUklOR19JRFggcmVxX3Byb2QgPSBxdWV1ZS0+cngucmVxX3Byb2RfcHZ0OwogCWludCBub3Rp
Znk7CiAJaW50IGVyciA9IDA7CisJc3RydWN0IHhlbmJ1c19kZXZpY2UgKmRldiA9IHF1ZXVlLT5p
bmZvLT54YmRldjsKIAogCWlmICh1bmxpa2VseSghbmV0aWZfY2Fycmllcl9vayhxdWV1ZS0+aW5m
by0+bmV0ZGV2KSkpCiAJCXJldHVybjsKQEAgLTMwOSwxNCArMzEwLDE0IEBAIHN0YXRpYyB2b2lk
IHhlbm5ldF9hbGxvY19yeF9idWZmZXJzKHN0cnVjdCBuZXRmcm9udF9xdWV1ZSAqcXVldWUpCiAJ
CUJVR19PTihxdWV1ZS0+cnhfc2tic1tpZF0pOwogCQlxdWV1ZS0+cnhfc2tic1tpZF0gPSBza2I7
CiAKLQkJcmVmID0gZ250dGFiX2NsYWltX2dyYW50X3JlZmVyZW5jZSgmcXVldWUtPmdyZWZfcnhf
aGVhZCk7CisJCXJlZiA9IGdudHRhYl9jbGFpbV9ncmFudF9yZWZlcmVuY2UoZGV2LT54aCwgJnF1
ZXVlLT5ncmVmX3J4X2hlYWQpOwogCQlXQVJOX09OX09OQ0UoSVNfRVJSX1ZBTFVFKCh1bnNpZ25l
ZCBsb25nKShpbnQpcmVmKSk7CiAJCXF1ZXVlLT5ncmFudF9yeF9yZWZbaWRdID0gcmVmOwogCiAJ
CXBhZ2UgPSBza2JfZnJhZ19wYWdlKCZza2Jfc2hpbmZvKHNrYiktPmZyYWdzWzBdKTsKIAogCQly
ZXEgPSBSSU5HX0dFVF9SRVFVRVNUKCZxdWV1ZS0+cngsIHJlcV9wcm9kKTsKLQkJZ250dGFiX3Bh
Z2VfZ3JhbnRfZm9yZWlnbl9hY2Nlc3NfcmVmX29uZShyZWYsCisJCWdudHRhYl9wYWdlX2dyYW50
X2ZvcmVpZ25fYWNjZXNzX3JlZl9vbmUoZGV2LT54aCwgcmVmLAogCQkJCQkJCSBxdWV1ZS0+aW5m
by0+eGJkZXYtPm90aGVyZW5kX2lkLAogCQkJCQkJCSBwYWdlLAogCQkJCQkJCSAwKTsKQEAgLTM3
Nyw2ICszNzgsNyBAQCBzdGF0aWMgdm9pZCB4ZW5uZXRfdHhfYnVmX2djKHN0cnVjdCBuZXRmcm9u
dF9xdWV1ZSAqcXVldWUpCiAJdW5zaWduZWQgc2hvcnQgaWQ7CiAJc3RydWN0IHNrX2J1ZmYgKnNr
YjsKIAlib29sIG1vcmVfdG9fZG87CisJc3RydWN0IHhlbmJ1c19kZXZpY2UgKmRldiA9IHF1ZXVl
LT5pbmZvLT54YmRldjsKIAogCUJVR19PTighbmV0aWZfY2Fycmllcl9vayhxdWV1ZS0+aW5mby0+
bmV0ZGV2KSk7CiAKQEAgLTM5MywxNSArMzk1LDE1IEBAIHN0YXRpYyB2b2lkIHhlbm5ldF90eF9i
dWZfZ2Moc3RydWN0IG5ldGZyb250X3F1ZXVlICpxdWV1ZSkKIAogCQkJaWQgID0gdHhyc3AtPmlk
OwogCQkJc2tiID0gcXVldWUtPnR4X3NrYnNbaWRdLnNrYjsKLQkJCWlmICh1bmxpa2VseShnbnR0
YWJfcXVlcnlfZm9yZWlnbl9hY2Nlc3MoCisJCQlpZiAodW5saWtlbHkoZ250dGFiX3F1ZXJ5X2Zv
cmVpZ25fYWNjZXNzKGRldi0+eGgsCiAJCQkJcXVldWUtPmdyYW50X3R4X3JlZltpZF0pICE9IDAp
KSB7CiAJCQkJcHJfYWxlcnQoIiVzOiB3YXJuaW5nIC0tIGdyYW50IHN0aWxsIGluIHVzZSBieSBi
YWNrZW5kIGRvbWFpblxuIiwKIAkJCQkJIF9fZnVuY19fKTsKIAkJCQlCVUcoKTsKIAkJCX0KLQkJ
CWdudHRhYl9lbmRfZm9yZWlnbl9hY2Nlc3NfcmVmKAorCQkJZ250dGFiX2VuZF9mb3JlaWduX2Fj
Y2Vzc19yZWYoZGV2LT54aCwKIAkJCQlxdWV1ZS0+Z3JhbnRfdHhfcmVmW2lkXSwgR05UTUFQX3Jl
YWRvbmx5KTsKLQkJCWdudHRhYl9yZWxlYXNlX2dyYW50X3JlZmVyZW5jZSgKKwkJCWdudHRhYl9y
ZWxlYXNlX2dyYW50X3JlZmVyZW5jZShkZXYtPnhoLAogCQkJCSZxdWV1ZS0+Z3JlZl90eF9oZWFk
LCBxdWV1ZS0+Z3JhbnRfdHhfcmVmW2lkXSk7CiAJCQlxdWV1ZS0+Z3JhbnRfdHhfcmVmW2lkXSA9
IEdSQU5UX0lOVkFMSURfUkVGOwogCQkJcXVldWUtPmdyYW50X3R4X3BhZ2VbaWRdID0gTlVMTDsK
QEAgLTQzNiwxMyArNDM4LDE0IEBAIHN0YXRpYyB2b2lkIHhlbm5ldF90eF9zZXR1cF9ncmFudCh1
bnNpZ25lZCBsb25nIGdmbiwgdW5zaWduZWQgaW50IG9mZnNldCwKIAlzdHJ1Y3QgcGFnZSAqcGFn
ZSA9IGluZm8tPnBhZ2U7CiAJc3RydWN0IG5ldGZyb250X3F1ZXVlICpxdWV1ZSA9IGluZm8tPnF1
ZXVlOwogCXN0cnVjdCBza19idWZmICpza2IgPSBpbmZvLT5za2I7CisJc3RydWN0IHhlbmJ1c19k
ZXZpY2UgKmRldiA9IHF1ZXVlLT5pbmZvLT54YmRldjsKIAogCWlkID0gZ2V0X2lkX2Zyb21fZnJl
ZWxpc3QoJnF1ZXVlLT50eF9za2JfZnJlZWxpc3QsIHF1ZXVlLT50eF9za2JzKTsKIAl0eCA9IFJJ
TkdfR0VUX1JFUVVFU1QoJnF1ZXVlLT50eCwgcXVldWUtPnR4LnJlcV9wcm9kX3B2dCsrKTsKLQly
ZWYgPSBnbnR0YWJfY2xhaW1fZ3JhbnRfcmVmZXJlbmNlKCZxdWV1ZS0+Z3JlZl90eF9oZWFkKTsK
KwlyZWYgPSBnbnR0YWJfY2xhaW1fZ3JhbnRfcmVmZXJlbmNlKGRldi0+eGgsICZxdWV1ZS0+Z3Jl
Zl90eF9oZWFkKTsKIAlXQVJOX09OX09OQ0UoSVNfRVJSX1ZBTFVFKCh1bnNpZ25lZCBsb25nKShp
bnQpcmVmKSk7CiAKLQlnbnR0YWJfZ3JhbnRfZm9yZWlnbl9hY2Nlc3NfcmVmKHJlZiwgcXVldWUt
PmluZm8tPnhiZGV2LT5vdGhlcmVuZF9pZCwKKwlnbnR0YWJfZ3JhbnRfZm9yZWlnbl9hY2Nlc3Nf
cmVmKGRldi0+eGgsIHJlZiwgcXVldWUtPmluZm8tPnhiZGV2LT5vdGhlcmVuZF9pZCwKIAkJCQkJ
Z2ZuLCBHTlRNQVBfcmVhZG9ubHkpOwogCiAJcXVldWUtPnR4X3NrYnNbaWRdLnNrYiA9IHNrYjsK
QEAgLTc4Niw2ICs3ODksNyBAQCBzdGF0aWMgaW50IHhlbm5ldF9nZXRfcmVzcG9uc2VzKHN0cnVj
dCBuZXRmcm9udF9xdWV1ZSAqcXVldWUsCiAJc3RydWN0IHhlbl9uZXRpZl9yeF9yZXNwb25zZSAq
cnggPSAmcmluZm8tPnJ4OwogCXN0cnVjdCB4ZW5fbmV0aWZfZXh0cmFfaW5mbyAqZXh0cmFzID0g
cmluZm8tPmV4dHJhczsKIAlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmcXVldWUtPmluZm8tPm5ldGRl
di0+ZGV2OworCXN0cnVjdCB4ZW5idXNfZGV2aWNlICp4ZGV2ID0gcXVldWUtPmluZm8tPnhiZGV2
OwogCVJJTkdfSURYIGNvbnMgPSBxdWV1ZS0+cngucnNwX2NvbnM7CiAJc3RydWN0IHNrX2J1ZmYg
KnNrYiA9IHhlbm5ldF9nZXRfcnhfc2tiKHF1ZXVlLCBjb25zKTsKIAlncmFudF9yZWZfdCByZWYg
PSB4ZW5uZXRfZ2V0X3J4X3JlZihxdWV1ZSwgY29ucyk7CkBAIC04MjMsMTAgKzgyNywxMCBAQCBz
dGF0aWMgaW50IHhlbm5ldF9nZXRfcmVzcG9uc2VzKHN0cnVjdCBuZXRmcm9udF9xdWV1ZSAqcXVl
dWUsCiAJCQlnb3RvIG5leHQ7CiAJCX0KIAotCQlyZXQgPSBnbnR0YWJfZW5kX2ZvcmVpZ25fYWNj
ZXNzX3JlZihyZWYsIDApOworCQlyZXQgPSBnbnR0YWJfZW5kX2ZvcmVpZ25fYWNjZXNzX3JlZih4
ZGV2LT54aCwgcmVmLCAwKTsKIAkJQlVHX09OKCFyZXQpOwogCi0JCWdudHRhYl9yZWxlYXNlX2dy
YW50X3JlZmVyZW5jZSgmcXVldWUtPmdyZWZfcnhfaGVhZCwgcmVmKTsKKwkJZ250dGFiX3JlbGVh
c2VfZ3JhbnRfcmVmZXJlbmNlKHhkZXYtPnhoLCAmcXVldWUtPmdyZWZfcnhfaGVhZCwgcmVmKTsK
IAogCQlfX3NrYl9xdWV1ZV90YWlsKGxpc3QsIHNrYik7CiAKQEAgLTExMzAsNiArMTEzNCw3IEBA
IHN0YXRpYyB2b2lkIHhlbm5ldF9yZWxlYXNlX3R4X2J1ZnMoc3RydWN0IG5ldGZyb250X3F1ZXVl
ICpxdWV1ZSkKIHsKIAlzdHJ1Y3Qgc2tfYnVmZiAqc2tiOwogCWludCBpOworCXN0cnVjdCB4ZW5i
dXNfZGV2aWNlICpkZXYgPSBxdWV1ZS0+aW5mby0+eGJkZXY7CiAKIAlmb3IgKGkgPSAwOyBpIDwg
TkVUX1RYX1JJTkdfU0laRTsgaSsrKSB7CiAJCS8qIFNraXAgb3ZlciBlbnRyaWVzIHdoaWNoIGFy
ZSBhY3R1YWxseSBmcmVlbGlzdCByZWZlcmVuY2VzICovCkBAIC0xMTM4LDcgKzExNDMsNyBAQCBz
dGF0aWMgdm9pZCB4ZW5uZXRfcmVsZWFzZV90eF9idWZzKHN0cnVjdCBuZXRmcm9udF9xdWV1ZSAq
cXVldWUpCiAKIAkJc2tiID0gcXVldWUtPnR4X3NrYnNbaV0uc2tiOwogCQlnZXRfcGFnZShxdWV1
ZS0+Z3JhbnRfdHhfcGFnZVtpXSk7Ci0JCWdudHRhYl9lbmRfZm9yZWlnbl9hY2Nlc3MocXVldWUt
PmdyYW50X3R4X3JlZltpXSwKKwkJZ250dGFiX2VuZF9mb3JlaWduX2FjY2VzcyhkZXYtPnhoLCBx
dWV1ZS0+Z3JhbnRfdHhfcmVmW2ldLAogCQkJCQkgIEdOVE1BUF9yZWFkb25seSwKIAkJCQkJICAo
dW5zaWduZWQgbG9uZylwYWdlX2FkZHJlc3MocXVldWUtPmdyYW50X3R4X3BhZ2VbaV0pKTsKIAkJ
cXVldWUtPmdyYW50X3R4X3BhZ2VbaV0gPSBOVUxMOwpAQCAtMTE1MSw2ICsxMTU2LDcgQEAgc3Rh
dGljIHZvaWQgeGVubmV0X3JlbGVhc2VfdHhfYnVmcyhzdHJ1Y3QgbmV0ZnJvbnRfcXVldWUgKnF1
ZXVlKQogc3RhdGljIHZvaWQgeGVubmV0X3JlbGVhc2VfcnhfYnVmcyhzdHJ1Y3QgbmV0ZnJvbnRf
cXVldWUgKnF1ZXVlKQogewogCWludCBpZCwgcmVmOworCXN0cnVjdCB4ZW5idXNfZGV2aWNlICpk
ZXYgPSBxdWV1ZS0+aW5mby0+eGJkZXY7CiAKIAlzcGluX2xvY2tfYmgoJnF1ZXVlLT5yeF9sb2Nr
KTsKIApAQCAtMTE3Miw3ICsxMTc4LDcgQEAgc3RhdGljIHZvaWQgeGVubmV0X3JlbGVhc2Vfcnhf
YnVmcyhzdHJ1Y3QgbmV0ZnJvbnRfcXVldWUgKnF1ZXVlKQogCQkgKiBmb3JlaWduIGFjY2VzcyBp
cyBlbmRlZCAod2hpY2ggbWF5IGJlIGRlZmVycmVkKS4KIAkJICovCiAJCWdldF9wYWdlKHBhZ2Up
OwotCQlnbnR0YWJfZW5kX2ZvcmVpZ25fYWNjZXNzKHJlZiwgMCwKKwkJZ250dGFiX2VuZF9mb3Jl
aWduX2FjY2VzcyhkZXYtPnhoLCByZWYsIDAsCiAJCQkJCSAgKHVuc2lnbmVkIGxvbmcpcGFnZV9h
ZGRyZXNzKHBhZ2UpKTsKIAkJcXVldWUtPmdyYW50X3J4X3JlZltpZF0gPSBHUkFOVF9JTlZBTElE
X1JFRjsKIApAQCAtMTE4NiwyMiArMTE5MiwyMyBAQCBzdGF0aWMgbmV0ZGV2X2ZlYXR1cmVzX3Qg
eGVubmV0X2ZpeF9mZWF0dXJlcyhzdHJ1Y3QgbmV0X2RldmljZSAqZGV2LAogCW5ldGRldl9mZWF0
dXJlc190IGZlYXR1cmVzKQogewogCXN0cnVjdCBuZXRmcm9udF9pbmZvICpucCA9IG5ldGRldl9w
cml2KGRldik7CisJc3RydWN0IHhlbmJ1c19kZXZpY2UgKnhkZXYgPSBucC0+eGJkZXY7CiAKIAlp
ZiAoZmVhdHVyZXMgJiBORVRJRl9GX1NHICYmCi0JICAgICF4ZW5idXNfcmVhZF91bnNpZ25lZChu
cC0+eGJkZXYtPm90aGVyZW5kLCAiZmVhdHVyZS1zZyIsIDApKQorCSAgICAheGVuYnVzX3JlYWRf
dW5zaWduZWQoeGRldi0+eGgsIG5wLT54YmRldi0+b3RoZXJlbmQsICJmZWF0dXJlLXNnIiwgMCkp
CiAJCWZlYXR1cmVzICY9IH5ORVRJRl9GX1NHOwogCiAJaWYgKGZlYXR1cmVzICYgTkVUSUZfRl9J
UFY2X0NTVU0gJiYKLQkgICAgIXhlbmJ1c19yZWFkX3Vuc2lnbmVkKG5wLT54YmRldi0+b3RoZXJl
bmQsCisJICAgICF4ZW5idXNfcmVhZF91bnNpZ25lZCh4ZGV2LT54aCwgbnAtPnhiZGV2LT5vdGhl
cmVuZCwKIAkJCQkgICJmZWF0dXJlLWlwdjYtY3N1bS1vZmZsb2FkIiwgMCkpCiAJCWZlYXR1cmVz
ICY9IH5ORVRJRl9GX0lQVjZfQ1NVTTsKIAogCWlmIChmZWF0dXJlcyAmIE5FVElGX0ZfVFNPICYm
Ci0JICAgICF4ZW5idXNfcmVhZF91bnNpZ25lZChucC0+eGJkZXYtPm90aGVyZW5kLCAiZmVhdHVy
ZS1nc28tdGNwdjQiLCAwKSkKKwkgICAgIXhlbmJ1c19yZWFkX3Vuc2lnbmVkKHhkZXYtPnhoLCBu
cC0+eGJkZXYtPm90aGVyZW5kLCAiZmVhdHVyZS1nc28tdGNwdjQiLCAwKSkKIAkJZmVhdHVyZXMg
Jj0gfk5FVElGX0ZfVFNPOwogCiAJaWYgKGZlYXR1cmVzICYgTkVUSUZfRl9UU082ICYmCi0JICAg
ICF4ZW5idXNfcmVhZF91bnNpZ25lZChucC0+eGJkZXYtPm90aGVyZW5kLCAiZmVhdHVyZS1nc28t
dGNwdjYiLCAwKSkKKwkgICAgIXhlbmJ1c19yZWFkX3Vuc2lnbmVkKHhkZXYtPnhoLCBucC0+eGJk
ZXYtPm90aGVyZW5kLCAiZmVhdHVyZS1nc28tdGNwdjYiLCAwKSkKIAkJZmVhdHVyZXMgJj0gfk5F
VElGX0ZfVFNPNjsKIAogCXJldHVybiBmZWF0dXJlczsKQEAgLTEzNzUsMTcgKzEzODIsMTggQEAg
c3RhdGljIGludCBuZXRmcm9udF9wcm9iZShzdHJ1Y3QgeGVuYnVzX2RldmljZSAqZGV2LAogCXJl
dHVybiAwOwogfQogCi1zdGF0aWMgdm9pZCB4ZW5uZXRfZW5kX2FjY2VzcyhpbnQgcmVmLCB2b2lk
ICpwYWdlKQorc3RhdGljIHZvaWQgeGVubmV0X2VuZF9hY2Nlc3MoeGVuaG9zdF90ICp4aCwgaW50
IHJlZiwgdm9pZCAqcGFnZSkKIHsKIAkvKiBUaGlzIGZyZWVzIHRoZSBwYWdlIGFzIGEgc2lkZS1l
ZmZlY3QgKi8KIAlpZiAocmVmICE9IEdSQU5UX0lOVkFMSURfUkVGKQotCQlnbnR0YWJfZW5kX2Zv
cmVpZ25fYWNjZXNzKHJlZiwgMCwgKHVuc2lnbmVkIGxvbmcpcGFnZSk7CisJCWdudHRhYl9lbmRf
Zm9yZWlnbl9hY2Nlc3MoeGgsIHJlZiwgMCwgKHVuc2lnbmVkIGxvbmcpcGFnZSk7CiB9CiAKIHN0
YXRpYyB2b2lkIHhlbm5ldF9kaXNjb25uZWN0X2JhY2tlbmQoc3RydWN0IG5ldGZyb250X2luZm8g
KmluZm8pCiB7CiAJdW5zaWduZWQgaW50IGkgPSAwOwogCXVuc2lnbmVkIGludCBudW1fcXVldWVz
ID0gaW5mby0+bmV0ZGV2LT5yZWFsX251bV90eF9xdWV1ZXM7CisJc3RydWN0IHhlbmJ1c19kZXZp
Y2UgKmRldiA9IGluZm8tPnhiZGV2OwogCiAJbmV0aWZfY2Fycmllcl9vZmYoaW5mby0+bmV0ZGV2
KTsKIApAQCAtMTQwOCwxMiArMTQxNiwxMiBAQCBzdGF0aWMgdm9pZCB4ZW5uZXRfZGlzY29ubmVj
dF9iYWNrZW5kKHN0cnVjdCBuZXRmcm9udF9pbmZvICppbmZvKQogCiAJCXhlbm5ldF9yZWxlYXNl
X3R4X2J1ZnMocXVldWUpOwogCQl4ZW5uZXRfcmVsZWFzZV9yeF9idWZzKHF1ZXVlKTsKLQkJZ250
dGFiX2ZyZWVfZ3JhbnRfcmVmZXJlbmNlcyhxdWV1ZS0+Z3JlZl90eF9oZWFkKTsKLQkJZ250dGFi
X2ZyZWVfZ3JhbnRfcmVmZXJlbmNlcyhxdWV1ZS0+Z3JlZl9yeF9oZWFkKTsKKwkJZ250dGFiX2Zy
ZWVfZ3JhbnRfcmVmZXJlbmNlcyhkZXYtPnhoLCBxdWV1ZS0+Z3JlZl90eF9oZWFkKTsKKwkJZ250
dGFiX2ZyZWVfZ3JhbnRfcmVmZXJlbmNlcyhkZXYtPnhoLCBxdWV1ZS0+Z3JlZl9yeF9oZWFkKTsK
IAogCQkvKiBFbmQgYWNjZXNzIGFuZCBmcmVlIHRoZSBwYWdlcyAqLwotCQl4ZW5uZXRfZW5kX2Fj
Y2VzcyhxdWV1ZS0+dHhfcmluZ19yZWYsIHF1ZXVlLT50eC5zcmluZyk7Ci0JCXhlbm5ldF9lbmRf
YWNjZXNzKHF1ZXVlLT5yeF9yaW5nX3JlZiwgcXVldWUtPnJ4LnNyaW5nKTsKKwkJeGVubmV0X2Vu
ZF9hY2Nlc3MoZGV2LT54aCwgcXVldWUtPnR4X3JpbmdfcmVmLCBxdWV1ZS0+dHguc3JpbmcpOwor
CQl4ZW5uZXRfZW5kX2FjY2VzcyhkZXYtPnhoLCBxdWV1ZS0+cnhfcmluZ19yZWYsIHF1ZXVlLT5y
eC5zcmluZyk7CiAKIAkJcXVldWUtPnR4X3JpbmdfcmVmID0gR1JBTlRfSU5WQUxJRF9SRUY7CiAJ
CXF1ZXVlLT5yeF9yaW5nX3JlZiA9IEdSQU5UX0lOVkFMSURfUkVGOwpAQCAtMTQ0Myw3ICsxNDUx
LDcgQEAgc3RhdGljIGludCB4ZW5fbmV0X3JlYWRfbWFjKHN0cnVjdCB4ZW5idXNfZGV2aWNlICpk
ZXYsIHU4IG1hY1tdKQogCWNoYXIgKnMsICplLCAqbWFjc3RyOwogCWludCBpOwogCi0JbWFjc3Ry
ID0gcyA9IHhlbmJ1c19yZWFkKFhCVF9OSUwsIGRldi0+bm9kZW5hbWUsICJtYWMiLCBOVUxMKTsK
KwltYWNzdHIgPSBzID0geGVuYnVzX3JlYWQoZGV2LT54aCwgWEJUX05JTCwgZGV2LT5ub2RlbmFt
ZSwgIm1hYyIsIE5VTEwpOwogCWlmIChJU19FUlIobWFjc3RyKSkKIAkJcmV0dXJuIFBUUl9FUlIo
bWFjc3RyKTsKIApAQCAtMTU4OCwxMSArMTU5NiwxMSBAQCBzdGF0aWMgaW50IHNldHVwX25ldGZy
b250KHN0cnVjdCB4ZW5idXNfZGV2aWNlICpkZXYsCiAJICogZ3JhbnRlZCBwYWdlcyBiZWNhdXNl
IGJhY2tlbmQgaXMgbm90IGFjY2Vzc2luZyBpdCBhdCB0aGlzIHBvaW50LgogCSAqLwogYWxsb2Nf
ZXZ0Y2huX2ZhaWw6Ci0JZ250dGFiX2VuZF9mb3JlaWduX2FjY2Vzc19yZWYocXVldWUtPnJ4X3Jp
bmdfcmVmLCAwKTsKKwlnbnR0YWJfZW5kX2ZvcmVpZ25fYWNjZXNzX3JlZihkZXYtPnhoLCBxdWV1
ZS0+cnhfcmluZ19yZWYsIDApOwogZ3JhbnRfcnhfcmluZ19mYWlsOgogCWZyZWVfcGFnZSgodW5z
aWduZWQgbG9uZylyeHMpOwogYWxsb2NfcnhfcmluZ19mYWlsOgotCWdudHRhYl9lbmRfZm9yZWln
bl9hY2Nlc3NfcmVmKHF1ZXVlLT50eF9yaW5nX3JlZiwgMCk7CisJZ250dGFiX2VuZF9mb3JlaWdu
X2FjY2Vzc19yZWYoZGV2LT54aCwgcXVldWUtPnR4X3JpbmdfcmVmLCAwKTsKIGdyYW50X3R4X3Jp
bmdfZmFpbDoKIAlmcmVlX3BhZ2UoKHVuc2lnbmVkIGxvbmcpdHhzKTsKIGZhaWw6CkBAIC0xNjA4
LDYgKzE2MTYsNyBAQCBzdGF0aWMgaW50IHhlbm5ldF9pbml0X3F1ZXVlKHN0cnVjdCBuZXRmcm9u
dF9xdWV1ZSAqcXVldWUpCiAJdW5zaWduZWQgc2hvcnQgaTsKIAlpbnQgZXJyID0gMDsKIAljaGFy
ICpkZXZpZDsKKwlzdHJ1Y3QgeGVuYnVzX2RldmljZSAqZGV2ID0gcXVldWUtPmluZm8tPnhiZGV2
OwogCiAJc3Bpbl9sb2NrX2luaXQoJnF1ZXVlLT50eF9sb2NrKTsKIAlzcGluX2xvY2tfaW5pdCgm
cXVldWUtPnJ4X2xvY2spOwpAQCAtMTYzMyw3ICsxNjQyLDcgQEAgc3RhdGljIGludCB4ZW5uZXRf
aW5pdF9xdWV1ZShzdHJ1Y3QgbmV0ZnJvbnRfcXVldWUgKnF1ZXVlKQogCX0KIAogCS8qIEEgZ3Jh
bnQgZm9yIGV2ZXJ5IHR4IHJpbmcgc2xvdCAqLwotCWlmIChnbnR0YWJfYWxsb2NfZ3JhbnRfcmVm
ZXJlbmNlcyhORVRfVFhfUklOR19TSVpFLAorCWlmIChnbnR0YWJfYWxsb2NfZ3JhbnRfcmVmZXJl
bmNlcyhkZXYtPnhoLCBORVRfVFhfUklOR19TSVpFLAogCQkJCQkgICZxdWV1ZS0+Z3JlZl90eF9o
ZWFkKSA8IDApIHsKIAkJcHJfYWxlcnQoImNhbid0IGFsbG9jIHR4IGdyYW50IHJlZnNcbiIpOwog
CQllcnIgPSAtRU5PTUVNOwpAQCAtMTY0MSw3ICsxNjUwLDcgQEAgc3RhdGljIGludCB4ZW5uZXRf
aW5pdF9xdWV1ZShzdHJ1Y3QgbmV0ZnJvbnRfcXVldWUgKnF1ZXVlKQogCX0KIAogCS8qIEEgZ3Jh
bnQgZm9yIGV2ZXJ5IHJ4IHJpbmcgc2xvdCAqLwotCWlmIChnbnR0YWJfYWxsb2NfZ3JhbnRfcmVm
ZXJlbmNlcyhORVRfUlhfUklOR19TSVpFLAorCWlmIChnbnR0YWJfYWxsb2NfZ3JhbnRfcmVmZXJl
bmNlcyhkZXYtPnhoLCBORVRfUlhfUklOR19TSVpFLAogCQkJCQkgICZxdWV1ZS0+Z3JlZl9yeF9o
ZWFkKSA8IDApIHsKIAkJcHJfYWxlcnQoImNhbid0IGFsbG9jIHJ4IGdyYW50IHJlZnNcbiIpOwog
CQllcnIgPSAtRU5PTUVNOwpAQCAtMTY1MSw3ICsxNjYwLDcgQEAgc3RhdGljIGludCB4ZW5uZXRf
aW5pdF9xdWV1ZShzdHJ1Y3QgbmV0ZnJvbnRfcXVldWUgKnF1ZXVlKQogCXJldHVybiAwOwogCiAg
ZXhpdF9mcmVlX3R4OgotCWdudHRhYl9mcmVlX2dyYW50X3JlZmVyZW5jZXMocXVldWUtPmdyZWZf
dHhfaGVhZCk7CisJZ250dGFiX2ZyZWVfZ3JhbnRfcmVmZXJlbmNlcyhkZXYtPnhoLCBxdWV1ZS0+
Z3JlZl90eF9oZWFkKTsKICBleGl0OgogCXJldHVybiBlcnI7CiB9CkBAIC0xNjg1LDE0ICsxNjk0
LDE0IEBAIHN0YXRpYyBpbnQgd3JpdGVfcXVldWVfeGVuc3RvcmVfa2V5cyhzdHJ1Y3QgbmV0ZnJv
bnRfcXVldWUgKnF1ZXVlLAogCX0KIAogCS8qIFdyaXRlIHJpbmcgcmVmZXJlbmNlcyAqLwotCWVy
ciA9IHhlbmJ1c19wcmludGYoKnhidCwgcGF0aCwgInR4LXJpbmctcmVmIiwgIiV1IiwKKwllcnIg
PSB4ZW5idXNfcHJpbnRmKGRldi0+eGgsICp4YnQsIHBhdGgsICJ0eC1yaW5nLXJlZiIsICIldSIs
CiAJCQlxdWV1ZS0+dHhfcmluZ19yZWYpOwogCWlmIChlcnIpIHsKIAkJbWVzc2FnZSA9ICJ3cml0
aW5nIHR4LXJpbmctcmVmIjsKIAkJZ290byBlcnJvcjsKIAl9CiAKLQllcnIgPSB4ZW5idXNfcHJp
bnRmKCp4YnQsIHBhdGgsICJyeC1yaW5nLXJlZiIsICIldSIsCisJZXJyID0geGVuYnVzX3ByaW50
ZihkZXYtPnhoLCAqeGJ0LCBwYXRoLCAicngtcmluZy1yZWYiLCAiJXUiLAogCQkJcXVldWUtPnJ4
X3JpbmdfcmVmKTsKIAlpZiAoZXJyKSB7CiAJCW1lc3NhZ2UgPSAid3JpdGluZyByeC1yaW5nLXJl
ZiI7CkBAIC0xNzA0LDcgKzE3MTMsNyBAQCBzdGF0aWMgaW50IHdyaXRlX3F1ZXVlX3hlbnN0b3Jl
X2tleXMoc3RydWN0IG5ldGZyb250X3F1ZXVlICpxdWV1ZSwKIAkgKi8KIAlpZiAocXVldWUtPnR4
X2V2dGNobiA9PSBxdWV1ZS0+cnhfZXZ0Y2huKSB7CiAJCS8qIFNoYXJlZCBldmVudCBjaGFubmVs
ICovCi0JCWVyciA9IHhlbmJ1c19wcmludGYoKnhidCwgcGF0aCwKKwkJZXJyID0geGVuYnVzX3By
aW50ZihkZXYtPnhoLCp4YnQsIHBhdGgsCiAJCQkJImV2ZW50LWNoYW5uZWwiLCAiJXUiLCBxdWV1
ZS0+dHhfZXZ0Y2huKTsKIAkJaWYgKGVycikgewogCQkJbWVzc2FnZSA9ICJ3cml0aW5nIGV2ZW50
LWNoYW5uZWwiOwpAQCAtMTcxMiwxNCArMTcyMSwxNCBAQCBzdGF0aWMgaW50IHdyaXRlX3F1ZXVl
X3hlbnN0b3JlX2tleXMoc3RydWN0IG5ldGZyb250X3F1ZXVlICpxdWV1ZSwKIAkJfQogCX0gZWxz
ZSB7CiAJCS8qIFNwbGl0IGV2ZW50IGNoYW5uZWxzICovCi0JCWVyciA9IHhlbmJ1c19wcmludGYo
KnhidCwgcGF0aCwKKwkJZXJyID0geGVuYnVzX3ByaW50ZihkZXYtPnhoLCAqeGJ0LCBwYXRoLAog
CQkJCSJldmVudC1jaGFubmVsLXR4IiwgIiV1IiwgcXVldWUtPnR4X2V2dGNobik7CiAJCWlmIChl
cnIpIHsKIAkJCW1lc3NhZ2UgPSAid3JpdGluZyBldmVudC1jaGFubmVsLXR4IjsKIAkJCWdvdG8g
ZXJyb3I7CiAJCX0KIAotCQllcnIgPSB4ZW5idXNfcHJpbnRmKCp4YnQsIHBhdGgsCisJCWVyciA9
IHhlbmJ1c19wcmludGYoZGV2LT54aCwgKnhidCwgcGF0aCwKIAkJCQkiZXZlbnQtY2hhbm5lbC1y
eCIsICIldSIsIHF1ZXVlLT5yeF9ldnRjaG4pOwogCQlpZiAoZXJyKSB7CiAJCQltZXNzYWdlID0g
IndyaXRpbmcgZXZlbnQtY2hhbm5lbC1yeCI7CkBAIC0xODEwLDEyICsxODE5LDEyIEBAIHN0YXRp
YyBpbnQgdGFsa190b19uZXRiYWNrKHN0cnVjdCB4ZW5idXNfZGV2aWNlICpkZXYsCiAJaW5mby0+
bmV0ZGV2LT5pcnEgPSAwOwogCiAJLyogQ2hlY2sgaWYgYmFja2VuZCBzdXBwb3J0cyBtdWx0aXBs
ZSBxdWV1ZXMgKi8KLQltYXhfcXVldWVzID0geGVuYnVzX3JlYWRfdW5zaWduZWQoaW5mby0+eGJk
ZXYtPm90aGVyZW5kLAorCW1heF9xdWV1ZXMgPSB4ZW5idXNfcmVhZF91bnNpZ25lZChkZXYtPnho
LCBpbmZvLT54YmRldi0+b3RoZXJlbmQsCiAJCQkJCSAgIm11bHRpLXF1ZXVlLW1heC1xdWV1ZXMi
LCAxKTsKIAludW1fcXVldWVzID0gbWluKG1heF9xdWV1ZXMsIHhlbm5ldF9tYXhfcXVldWVzKTsK
IAogCS8qIENoZWNrIGZlYXR1cmUtc3BsaXQtZXZlbnQtY2hhbm5lbHMgKi8KLQlmZWF0dXJlX3Nw
bGl0X2V2dGNobiA9IHhlbmJ1c19yZWFkX3Vuc2lnbmVkKGluZm8tPnhiZGV2LT5vdGhlcmVuZCwK
KwlmZWF0dXJlX3NwbGl0X2V2dGNobiA9IHhlbmJ1c19yZWFkX3Vuc2lnbmVkKGRldi0+eGgsIGlu
Zm8tPnhiZGV2LT5vdGhlcmVuZCwKIAkJCQkJImZlYXR1cmUtc3BsaXQtZXZlbnQtY2hhbm5lbHMi
LCAwKTsKIAogCS8qIFJlYWQgbWFjIGFkZHIuICovCkBAIC0xODQ3LDE2ICsxODU2LDE2IEBAIHN0
YXRpYyBpbnQgdGFsa190b19uZXRiYWNrKHN0cnVjdCB4ZW5idXNfZGV2aWNlICpkZXYsCiAJfQog
CiBhZ2FpbjoKLQllcnIgPSB4ZW5idXNfdHJhbnNhY3Rpb25fc3RhcnQoJnhidCk7CisJZXJyID0g
eGVuYnVzX3RyYW5zYWN0aW9uX3N0YXJ0KGRldi0+eGgsICZ4YnQpOwogCWlmIChlcnIpIHsKIAkJ
eGVuYnVzX2Rldl9mYXRhbChkZXYsIGVyciwgInN0YXJ0aW5nIHRyYW5zYWN0aW9uIik7CiAJCWdv
dG8gZGVzdHJveV9yaW5nOwogCX0KIAotCWlmICh4ZW5idXNfZXhpc3RzKFhCVF9OSUwsCisJaWYg
KHhlbmJ1c19leGlzdHMoZGV2LT54aCwgWEJUX05JTCwKIAkJCSAgaW5mby0+eGJkZXYtPm90aGVy
ZW5kLCAibXVsdGktcXVldWUtbWF4LXF1ZXVlcyIpKSB7CiAJCS8qIFdyaXRlIHRoZSBudW1iZXIg
b2YgcXVldWVzICovCi0JCWVyciA9IHhlbmJ1c19wcmludGYoeGJ0LCBkZXYtPm5vZGVuYW1lLAor
CQllcnIgPSB4ZW5idXNfcHJpbnRmKGRldi0+eGgsIHhidCwgZGV2LT5ub2RlbmFtZSwKIAkJCQkg
ICAgIm11bHRpLXF1ZXVlLW51bS1xdWV1ZXMiLCAiJXUiLCBudW1fcXVldWVzKTsKIAkJaWYgKGVy
cikgewogCQkJbWVzc2FnZSA9ICJ3cml0aW5nIG11bHRpLXF1ZXVlLW51bS1xdWV1ZXMiOwpAQCAt
MTg3OSw0NSArMTg4OCw0NSBAQCBzdGF0aWMgaW50IHRhbGtfdG9fbmV0YmFjayhzdHJ1Y3QgeGVu
YnVzX2RldmljZSAqZGV2LAogCX0KIAogCS8qIFRoZSByZW1haW5pbmcga2V5cyBhcmUgbm90IHF1
ZXVlLXNwZWNpZmljICovCi0JZXJyID0geGVuYnVzX3ByaW50Zih4YnQsIGRldi0+bm9kZW5hbWUs
ICJyZXF1ZXN0LXJ4LWNvcHkiLCAiJXUiLAorCWVyciA9IHhlbmJ1c19wcmludGYoZGV2LT54aCwg
eGJ0LCBkZXYtPm5vZGVuYW1lLCAicmVxdWVzdC1yeC1jb3B5IiwgIiV1IiwKIAkJCSAgICAxKTsK
IAlpZiAoZXJyKSB7CiAJCW1lc3NhZ2UgPSAid3JpdGluZyByZXF1ZXN0LXJ4LWNvcHkiOwogCQln
b3RvIGFib3J0X3RyYW5zYWN0aW9uOwogCX0KIAotCWVyciA9IHhlbmJ1c19wcmludGYoeGJ0LCBk
ZXYtPm5vZGVuYW1lLCAiZmVhdHVyZS1yeC1ub3RpZnkiLCAiJWQiLCAxKTsKKwllcnIgPSB4ZW5i
dXNfcHJpbnRmKGRldi0+eGgsIHhidCwgZGV2LT5ub2RlbmFtZSwgImZlYXR1cmUtcngtbm90aWZ5
IiwgIiVkIiwgMSk7CiAJaWYgKGVycikgewogCQltZXNzYWdlID0gIndyaXRpbmcgZmVhdHVyZS1y
eC1ub3RpZnkiOwogCQlnb3RvIGFib3J0X3RyYW5zYWN0aW9uOwogCX0KIAotCWVyciA9IHhlbmJ1
c19wcmludGYoeGJ0LCBkZXYtPm5vZGVuYW1lLCAiZmVhdHVyZS1zZyIsICIlZCIsIDEpOworCWVy
ciA9IHhlbmJ1c19wcmludGYoZGV2LT54aCwgeGJ0LCBkZXYtPm5vZGVuYW1lLCAiZmVhdHVyZS1z
ZyIsICIlZCIsIDEpOwogCWlmIChlcnIpIHsKIAkJbWVzc2FnZSA9ICJ3cml0aW5nIGZlYXR1cmUt
c2ciOwogCQlnb3RvIGFib3J0X3RyYW5zYWN0aW9uOwogCX0KIAotCWVyciA9IHhlbmJ1c19wcmlu
dGYoeGJ0LCBkZXYtPm5vZGVuYW1lLCAiZmVhdHVyZS1nc28tdGNwdjQiLCAiJWQiLCAxKTsKKwll
cnIgPSB4ZW5idXNfcHJpbnRmKGRldi0+eGgsIHhidCwgZGV2LT5ub2RlbmFtZSwgImZlYXR1cmUt
Z3NvLXRjcHY0IiwgIiVkIiwgMSk7CiAJaWYgKGVycikgewogCQltZXNzYWdlID0gIndyaXRpbmcg
ZmVhdHVyZS1nc28tdGNwdjQiOwogCQlnb3RvIGFib3J0X3RyYW5zYWN0aW9uOwogCX0KIAotCWVy
ciA9IHhlbmJ1c193cml0ZSh4YnQsIGRldi0+bm9kZW5hbWUsICJmZWF0dXJlLWdzby10Y3B2NiIs
ICIxIik7CisJZXJyID0geGVuYnVzX3dyaXRlKGRldi0+eGgsIHhidCwgZGV2LT5ub2RlbmFtZSwg
ImZlYXR1cmUtZ3NvLXRjcHY2IiwgIjEiKTsKIAlpZiAoZXJyKSB7CiAJCW1lc3NhZ2UgPSAid3Jp
dGluZyBmZWF0dXJlLWdzby10Y3B2NiI7CiAJCWdvdG8gYWJvcnRfdHJhbnNhY3Rpb247CiAJfQog
Ci0JZXJyID0geGVuYnVzX3dyaXRlKHhidCwgZGV2LT5ub2RlbmFtZSwgImZlYXR1cmUtaXB2Ni1j
c3VtLW9mZmxvYWQiLAorCWVyciA9IHhlbmJ1c193cml0ZShkZXYtPnhoLCB4YnQsIGRldi0+bm9k
ZW5hbWUsICJmZWF0dXJlLWlwdjYtY3N1bS1vZmZsb2FkIiwKIAkJCSAgICIxIik7CiAJaWYgKGVy
cikgewogCQltZXNzYWdlID0gIndyaXRpbmcgZmVhdHVyZS1pcHY2LWNzdW0tb2ZmbG9hZCI7CiAJ
CWdvdG8gYWJvcnRfdHJhbnNhY3Rpb247CiAJfQogCi0JZXJyID0geGVuYnVzX3RyYW5zYWN0aW9u
X2VuZCh4YnQsIDApOworCWVyciA9IHhlbmJ1c190cmFuc2FjdGlvbl9lbmQoZGV2LT54aCwgeGJ0
LCAwKTsKIAlpZiAoZXJyKSB7CiAJCWlmIChlcnIgPT0gLUVBR0FJTikKIAkJCWdvdG8gYWdhaW47
CkBAIC0xOTMwLDcgKzE5MzksNyBAQCBzdGF0aWMgaW50IHRhbGtfdG9fbmV0YmFjayhzdHJ1Y3Qg
eGVuYnVzX2RldmljZSAqZGV2LAogIGFib3J0X3RyYW5zYWN0aW9uOgogCXhlbmJ1c19kZXZfZmF0
YWwoZGV2LCBlcnIsICIlcyIsIG1lc3NhZ2UpOwogYWJvcnRfdHJhbnNhY3Rpb25fbm9fZGV2X2Zh
dGFsOgotCXhlbmJ1c190cmFuc2FjdGlvbl9lbmQoeGJ0LCAxKTsKKwl4ZW5idXNfdHJhbnNhY3Rp
b25fZW5kKGRldi0+eGgsIHhidCwgMSk7CiAgZGVzdHJveV9yaW5nOgogCXhlbm5ldF9kaXNjb25u
ZWN0X2JhY2tlbmQoaW5mbyk7CiAJcnRubF9sb2NrKCk7CkBAIC0xOTQ5LDggKzE5NTgsOSBAQCBz
dGF0aWMgaW50IHhlbm5ldF9jb25uZWN0KHN0cnVjdCBuZXRfZGV2aWNlICpkZXYpCiAJaW50IGVy
cjsKIAl1bnNpZ25lZCBpbnQgaiA9IDA7CiAJc3RydWN0IG5ldGZyb250X3F1ZXVlICpxdWV1ZSA9
IE5VTEw7CisJc3RydWN0IHhlbmJ1c19kZXZpY2UgKnhkZXYgPSBucC0+eGJkZXY7CiAKLQlpZiAo
IXhlbmJ1c19yZWFkX3Vuc2lnbmVkKG5wLT54YmRldi0+b3RoZXJlbmQsICJmZWF0dXJlLXJ4LWNv
cHkiLCAwKSkgeworCWlmICgheGVuYnVzX3JlYWRfdW5zaWduZWQoeGRldi0+eGgsIG5wLT54YmRl
di0+b3RoZXJlbmQsICJmZWF0dXJlLXJ4LWNvcHkiLCAwKSkgewogCQlkZXZfaW5mbygmZGV2LT5k
ZXYsCiAJCQkgImJhY2tlbmQgZG9lcyBub3Qgc3VwcG9ydCBjb3B5aW5nIHJlY2VpdmUgcGF0aFxu
Iik7CiAJCXJldHVybiAtRU5PREVWOwotLSAKMi4yMC4xCgoKX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2
ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWls
bWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

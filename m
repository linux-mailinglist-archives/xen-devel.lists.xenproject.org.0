Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id AC280164C77
	for <lists+xen-devel@lfdr.de>; Wed, 19 Feb 2020 18:48:50 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1j4TOi-0001n8-T0; Wed, 19 Feb 2020 17:44:32 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=jH6y=4H=citrix.com=roger.pau@srs-us1.protection.inumbo.net>)
 id 1j4TOi-0001n0-62
 for xen-devel@lists.xenproject.org; Wed, 19 Feb 2020 17:44:32 +0000
X-Inumbo-ID: 7b56db92-533f-11ea-ade5-bc764e2007e4
Received: from esa5.hc3370-68.iphmx.com (unknown [216.71.155.168])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 7b56db92-533f-11ea-ade5-bc764e2007e4;
 Wed, 19 Feb 2020 17:44:31 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1582134270;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=OlOC1qLxECnr0CgnbIGTDmVVrZiqIdQR39diZKkI/1A=;
 b=AckQk8B4X3Nskm4IL3/OfXih0OF2Q0obMi3dkairDAYSr4FIHhH/CKEc
 4UD/TGkDVg/lD2Fv5sQO+Qv28UmBCDM1eRE1FBx+KkBUPtXrQgkWnq98w
 djuBN2SnhKhbPOKy++qOw0YOJLSPKDe4JgsOIPC8j7joNpp92GZaiRxcz E=;
Authentication-Results: esa5.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=roger.pau@citrix.com;
 spf=Pass smtp.mailfrom=roger.pau@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa5.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 roger.pau@citrix.com) identity=pra; client-ip=162.221.158.21;
 receiver=esa5.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="roger.pau@citrix.com"; x-conformance=sidf_compatible
Received-SPF: Pass (esa5.hc3370-68.iphmx.com: domain of
 roger.pau@citrix.com designates 162.221.158.21 as permitted
 sender) identity=mailfrom; client-ip=162.221.158.21;
 receiver=esa5.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="roger.pau@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83
 ip4:168.245.78.127 ~all"
Received-SPF: None (esa5.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa5.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: 7b04rkIJMDyGHJORlZupHrx6/VWxQ5jspP4UCJegeicLkIfislfOmwwsEQBfzd6IbjjlU8+aAE
 aKqKPOKEW/MK46NSJdySFLLvKr1PO5vDyfsTHDPjsvh9Vk5/Pv25pdaoLccY9e5vunU0FFmuLz
 T73E2yG/TAVU+07ajNrJIo3SM0Z6UW5Fttk2XqCHiLCpBanN2/WIZvYlWAntrCZf20Ph46dhgC
 5p75Jq+DKpVWOu2atiZbMkRcvf2xaHrWbRFGJVyCiVRcG1C9xvsU4iDahXs8sFFk2eVloNbrZ+
 gGc=
X-SBRS: 2.7
X-MesageID: 13064288
X-Ironport-Server: esa5.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.70,461,1574139600"; d="scan'208";a="13064288"
From: Roger Pau Monne <roger.pau@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Wed, 19 Feb 2020 18:43:49 +0100
Message-ID: <20200219174354.84726-3-roger.pau@citrix.com>
X-Mailer: git-send-email 2.25.0
In-Reply-To: <20200219174354.84726-1-roger.pau@citrix.com>
References: <20200219174354.84726-1-roger.pau@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v5 2/7] x86/paging: add TLB flush hooks
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Wei Liu <wl@xen.org>, George
 Dunlap <george.dunlap@eu.citrix.com>, Andrew Cooper <andrew.cooper3@citrix.com>,
 Tim Deegan <tim@xen.org>, Jan Beulich <jbeulich@suse.com>,
 Roger Pau Monne <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

QWRkIHNoYWRvdyBhbmQgaGFwIGltcGxlbWVudGF0aW9uIHNwZWNpZmljIGhlbHBlcnMgdG8gcGVy
Zm9ybSBndWVzdApUTEIgZmx1c2hlcy4gTm90ZSB0aGF0IHRoZSBjb2RlIGZvciBib3RoIGlzIGV4
YWN0bHkgdGhlIHNhbWUgYXQgdGhlCm1vbWVudCwgYW5kIGlzIGNvcGllZCBmcm9tIGh2bV9mbHVz
aF92Y3B1X3RsYi4gVGhpcyB3aWxsIGJlIGNoYW5nZWQgYnkKZnVydGhlciBwYXRjaGVzIHRoYXQg
d2lsbCBhZGQgaW1wbGVtZW50YXRpb24gc3BlY2lmaWMgb3B0aW1pemF0aW9ucyB0bwp0aGVtLgoK
Tm8gZnVuY3Rpb25hbCBjaGFuZ2UgaW50ZW5kZWQuCgpTaWduZWQtb2ZmLWJ5OiBSb2dlciBQYXUg
TW9ubsOpIDxyb2dlci5wYXVAY2l0cml4LmNvbT4KUmV2aWV3ZWQtYnk6IFdlaSBMaXUgPHdsQHhl
bi5vcmc+CkFja2VkLWJ5OiBUaW0gRGVlZ2FuIDx0aW1AeGVuLm9yZz4KLS0tCkNoYW5nZXMgc2lu
Y2UgdjM6CiAtIEZpeCBzdHJheSBuZXdsaW5lIHJlbW92YWwuCiAtIEZpeCByZXR1cm4gb2Ygc2hh
ZG93X2ZsdXNoX3RsYiBkdW1teSBmdW5jdGlvbi4KLS0tCiB4ZW4vYXJjaC94ODYvaHZtL2h2bS5j
ICAgICAgICAgIHwgNTEgKystLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiB4ZW4vYXJjaC94
ODYvbW0vaGFwL2hhcC5jICAgICAgIHwgNTQgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysKIHhlbi9hcmNoL3g4Ni9tbS9zaGFkb3cvY29tbW9uLmMgfCA1NSArKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysKIHhlbi9pbmNsdWRlL2FzbS14ODYvaGFwLmggICAgICAgfCAgMyAr
KwogeGVuL2luY2x1ZGUvYXNtLXg4Ni9zaGFkb3cuaCAgICB8IDEyICsrKysrKysKIDUgZmlsZXMg
Y2hhbmdlZCwgMTI3IGluc2VydGlvbnMoKyksIDQ4IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBh
L3hlbi9hcmNoL3g4Ni9odm0vaHZtLmMgYi94ZW4vYXJjaC94ODYvaHZtL2h2bS5jCmluZGV4IDAw
YTllNzBiN2MuLjQwNDlmNTcyMzIgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9odm0vaHZtLmMK
KysrIGIveGVuL2FyY2gveDg2L2h2bS9odm0uYwpAQCAtMzk5MCw1NSArMzk5MCwxMCBAQCBzdGF0
aWMgdm9pZCBodm1fczNfcmVzdW1lKHN0cnVjdCBkb21haW4gKmQpCiBib29sIGh2bV9mbHVzaF92
Y3B1X3RsYihib29sICgqZmx1c2hfdmNwdSkodm9pZCAqY3R4dCwgc3RydWN0IHZjcHUgKnYpLAog
ICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqY3R4dCkKIHsKLSAgICBzdGF0aWMgREVGSU5F
X1BFUl9DUFUoY3B1bWFza190LCBmbHVzaF9jcHVtYXNrKTsKLSAgICBjcHVtYXNrX3QgKm1hc2sg
PSAmdGhpc19jcHUoZmx1c2hfY3B1bWFzayk7Ci0gICAgc3RydWN0IGRvbWFpbiAqZCA9IGN1cnJl
bnQtPmRvbWFpbjsKLSAgICBzdHJ1Y3QgdmNwdSAqdjsKLQotICAgIC8qIEF2b2lkIGRlYWRsb2Nr
IGlmIG1vcmUgdGhhbiBvbmUgdmNwdSB0cmllcyB0aGlzIGF0IHRoZSBzYW1lIHRpbWUuICovCi0g
ICAgaWYgKCAhc3Bpbl90cnlsb2NrKCZkLT5oeXBlcmNhbGxfZGVhZGxvY2tfbXV0ZXgpICkKLSAg
ICAgICAgcmV0dXJuIGZhbHNlOwotCi0gICAgLyogUGF1c2UgYWxsIG90aGVyIHZjcHVzLiAqLwot
ICAgIGZvcl9lYWNoX3ZjcHUgKCBkLCB2ICkKLSAgICAgICAgaWYgKCB2ICE9IGN1cnJlbnQgJiYg
Zmx1c2hfdmNwdShjdHh0LCB2KSApCi0gICAgICAgICAgICB2Y3B1X3BhdXNlX25vc3luYyh2KTsK
LQotICAgIC8qIE5vdyB0aGF0IGFsbCBWQ1BVcyBhcmUgc2lnbmFsbGVkIHRvIGRlc2NoZWR1bGUs
IHdlIHdhaXQuLi4gKi8KLSAgICBmb3JfZWFjaF92Y3B1ICggZCwgdiApCi0gICAgICAgIGlmICgg
diAhPSBjdXJyZW50ICYmIGZsdXNoX3ZjcHUoY3R4dCwgdikgKQotICAgICAgICAgICAgd2hpbGUg
KCAhdmNwdV9ydW5uYWJsZSh2KSAmJiB2LT5pc19ydW5uaW5nICkKLSAgICAgICAgICAgICAgICBj
cHVfcmVsYXgoKTsKLQotICAgIC8qIEFsbCBvdGhlciB2Y3B1cyBhcmUgcGF1c2VkLCBzYWZlIHRv
IHVubG9jayBub3cuICovCi0gICAgc3Bpbl91bmxvY2soJmQtPmh5cGVyY2FsbF9kZWFkbG9ja19t
dXRleCk7Ci0KLSAgICBjcHVtYXNrX2NsZWFyKG1hc2spOwotCi0gICAgLyogRmx1c2ggcGFnaW5n
LW1vZGUgc29mdCBzdGF0ZSAoZS5nLiwgdmEtPmdmbiBjYWNoZTsgUEFFIFBEUEUgY2FjaGUpLiAq
LwotICAgIGZvcl9lYWNoX3ZjcHUgKCBkLCB2ICkKLSAgICB7Ci0gICAgICAgIHVuc2lnbmVkIGlu
dCBjcHU7Ci0KLSAgICAgICAgaWYgKCAhZmx1c2hfdmNwdShjdHh0LCB2KSApCi0gICAgICAgICAg
ICBjb250aW51ZTsKLQotICAgICAgICBwYWdpbmdfdXBkYXRlX2NyMyh2LCBmYWxzZSk7CisgICAg
c3RydWN0IGRvbWFpbiAqY3VycmQgPSBjdXJyZW50LT5kb21haW47CiAKLSAgICAgICAgY3B1ID0g
cmVhZF9hdG9taWMoJnYtPmRpcnR5X2NwdSk7Ci0gICAgICAgIGlmICggaXNfdmNwdV9kaXJ0eV9j
cHUoY3B1KSApCi0gICAgICAgICAgICBfX2NwdW1hc2tfc2V0X2NwdShjcHUsIG1hc2spOwotICAg
IH0KLQotICAgIC8qIEZsdXNoIFRMQnMgb24gYWxsIENQVXMgd2l0aCBkaXJ0eSB2Y3B1IHN0YXRl
LiAqLwotICAgIGZsdXNoX3RsYl9tYXNrKG1hc2spOwotCi0gICAgLyogRG9uZS4gKi8KLSAgICBm
b3JfZWFjaF92Y3B1ICggZCwgdiApCi0gICAgICAgIGlmICggdiAhPSBjdXJyZW50ICYmIGZsdXNo
X3ZjcHUoY3R4dCwgdikgKQotICAgICAgICAgICAgdmNwdV91bnBhdXNlKHYpOwotCi0gICAgcmV0
dXJuIHRydWU7CisgICAgcmV0dXJuIHNoYWRvd19tb2RlX2VuYWJsZWQoY3VycmQpID8gc2hhZG93
X2ZsdXNoX3RsYihmbHVzaF92Y3B1LCBjdHh0KQorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICA6IGhhcF9mbHVzaF90bGIoZmx1c2hfdmNwdSwgY3R4dCk7CiB9CiAKIHN0YXRp
YyBib29sIGFsd2F5c19mbHVzaCh2b2lkICpjdHh0LCBzdHJ1Y3QgdmNwdSAqdikKZGlmZiAtLWdp
dCBhL3hlbi9hcmNoL3g4Ni9tbS9oYXAvaGFwLmMgYi94ZW4vYXJjaC94ODYvbW0vaGFwL2hhcC5j
CmluZGV4IDNkOTNmMzQ1MWMuLjY4OTRjMWFhMzggMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9t
bS9oYXAvaGFwLmMKKysrIGIveGVuL2FyY2gveDg2L21tL2hhcC9oYXAuYwpAQCAtNjY5LDYgKzY2
OSw2MCBAQCBzdGF0aWMgdm9pZCBoYXBfdXBkYXRlX2NyMyhzdHJ1Y3QgdmNwdSAqdiwgaW50IGRv
X2xvY2tpbmcsIGJvb2wgbm9mbHVzaCkKICAgICBodm1fdXBkYXRlX2d1ZXN0X2NyMyh2LCBub2Zs
dXNoKTsKIH0KIAorYm9vbCBoYXBfZmx1c2hfdGxiKGJvb2wgKCpmbHVzaF92Y3B1KSh2b2lkICpj
dHh0LCBzdHJ1Y3QgdmNwdSAqdiksCisgICAgICAgICAgICAgICAgICAgdm9pZCAqY3R4dCkKK3sK
KyAgICBzdGF0aWMgREVGSU5FX1BFUl9DUFUoY3B1bWFza190LCBmbHVzaF9jcHVtYXNrKTsKKyAg
ICBjcHVtYXNrX3QgKm1hc2sgPSAmdGhpc19jcHUoZmx1c2hfY3B1bWFzayk7CisgICAgc3RydWN0
IGRvbWFpbiAqZCA9IGN1cnJlbnQtPmRvbWFpbjsKKyAgICBzdHJ1Y3QgdmNwdSAqdjsKKworICAg
IC8qIEF2b2lkIGRlYWRsb2NrIGlmIG1vcmUgdGhhbiBvbmUgdmNwdSB0cmllcyB0aGlzIGF0IHRo
ZSBzYW1lIHRpbWUuICovCisgICAgaWYgKCAhc3Bpbl90cnlsb2NrKCZkLT5oeXBlcmNhbGxfZGVh
ZGxvY2tfbXV0ZXgpICkKKyAgICAgICAgcmV0dXJuIGZhbHNlOworCisgICAgLyogUGF1c2UgYWxs
IG90aGVyIHZjcHVzLiAqLworICAgIGZvcl9lYWNoX3ZjcHUgKCBkLCB2ICkKKyAgICAgICAgaWYg
KCB2ICE9IGN1cnJlbnQgJiYgZmx1c2hfdmNwdShjdHh0LCB2KSApCisgICAgICAgICAgICB2Y3B1
X3BhdXNlX25vc3luYyh2KTsKKworICAgIC8qIE5vdyB0aGF0IGFsbCBWQ1BVcyBhcmUgc2lnbmFs
bGVkIHRvIGRlc2NoZWR1bGUsIHdlIHdhaXQuLi4gKi8KKyAgICBmb3JfZWFjaF92Y3B1ICggZCwg
diApCisgICAgICAgIGlmICggdiAhPSBjdXJyZW50ICYmIGZsdXNoX3ZjcHUoY3R4dCwgdikgKQor
ICAgICAgICAgICAgd2hpbGUgKCAhdmNwdV9ydW5uYWJsZSh2KSAmJiB2LT5pc19ydW5uaW5nICkK
KyAgICAgICAgICAgICAgICBjcHVfcmVsYXgoKTsKKworICAgIC8qIEFsbCBvdGhlciB2Y3B1cyBh
cmUgcGF1c2VkLCBzYWZlIHRvIHVubG9jayBub3cuICovCisgICAgc3Bpbl91bmxvY2soJmQtPmh5
cGVyY2FsbF9kZWFkbG9ja19tdXRleCk7CisKKyAgICBjcHVtYXNrX2NsZWFyKG1hc2spOworCisg
ICAgLyogRmx1c2ggcGFnaW5nLW1vZGUgc29mdCBzdGF0ZSAoZS5nLiwgdmEtPmdmbiBjYWNoZTsg
UEFFIFBEUEUgY2FjaGUpLiAqLworICAgIGZvcl9lYWNoX3ZjcHUgKCBkLCB2ICkKKyAgICB7Cisg
ICAgICAgIHVuc2lnbmVkIGludCBjcHU7CisKKyAgICAgICAgaWYgKCAhZmx1c2hfdmNwdShjdHh0
LCB2KSApCisgICAgICAgICAgICBjb250aW51ZTsKKworICAgICAgICBwYWdpbmdfdXBkYXRlX2Ny
Myh2LCBmYWxzZSk7CisKKyAgICAgICAgY3B1ID0gcmVhZF9hdG9taWMoJnYtPmRpcnR5X2NwdSk7
CisgICAgICAgIGlmICggaXNfdmNwdV9kaXJ0eV9jcHUoY3B1KSApCisgICAgICAgICAgICBfX2Nw
dW1hc2tfc2V0X2NwdShjcHUsIG1hc2spOworICAgIH0KKworICAgIC8qIEZsdXNoIFRMQnMgb24g
YWxsIENQVXMgd2l0aCBkaXJ0eSB2Y3B1IHN0YXRlLiAqLworICAgIGZsdXNoX3RsYl9tYXNrKG1h
c2spOworCisgICAgLyogRG9uZS4gKi8KKyAgICBmb3JfZWFjaF92Y3B1ICggZCwgdiApCisgICAg
ICAgIGlmICggdiAhPSBjdXJyZW50ICYmIGZsdXNoX3ZjcHUoY3R4dCwgdikgKQorICAgICAgICAg
ICAgdmNwdV91bnBhdXNlKHYpOworCisgICAgcmV0dXJuIHRydWU7Cit9CisKIGNvbnN0IHN0cnVj
dCBwYWdpbmdfbW9kZSAqCiBoYXBfcGFnaW5nX2dldF9tb2RlKHN0cnVjdCB2Y3B1ICp2KQogewpk
aWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L21tL3NoYWRvdy9jb21tb24uYyBiL3hlbi9hcmNoL3g4
Ni9tbS9zaGFkb3cvY29tbW9uLmMKaW5kZXggY2JhM2FiMWViYS4uMTIxZGRmMTI1NSAxMDA2NDQK
LS0tIGEveGVuL2FyY2gveDg2L21tL3NoYWRvdy9jb21tb24uYworKysgYi94ZW4vYXJjaC94ODYv
bW0vc2hhZG93L2NvbW1vbi5jCkBAIC0zMzU3LDYgKzMzNTcsNjEgQEAgb3V0OgogICAgIHJldHVy
biByYzsKIH0KIAorLyogRmx1aHMgVExCIG9mIHNlbGVjdGVkIHZDUFVzLiAqLworYm9vbCBzaGFk
b3dfZmx1c2hfdGxiKGJvb2wgKCpmbHVzaF92Y3B1KSh2b2lkICpjdHh0LCBzdHJ1Y3QgdmNwdSAq
diksCisgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqY3R4dCkKK3sKKyAgICBzdGF0aWMgREVG
SU5FX1BFUl9DUFUoY3B1bWFza190LCBmbHVzaF9jcHVtYXNrKTsKKyAgICBjcHVtYXNrX3QgKm1h
c2sgPSAmdGhpc19jcHUoZmx1c2hfY3B1bWFzayk7CisgICAgc3RydWN0IGRvbWFpbiAqZCA9IGN1
cnJlbnQtPmRvbWFpbjsKKyAgICBzdHJ1Y3QgdmNwdSAqdjsKKworICAgIC8qIEF2b2lkIGRlYWRs
b2NrIGlmIG1vcmUgdGhhbiBvbmUgdmNwdSB0cmllcyB0aGlzIGF0IHRoZSBzYW1lIHRpbWUuICov
CisgICAgaWYgKCAhc3Bpbl90cnlsb2NrKCZkLT5oeXBlcmNhbGxfZGVhZGxvY2tfbXV0ZXgpICkK
KyAgICAgICAgcmV0dXJuIGZhbHNlOworCisgICAgLyogUGF1c2UgYWxsIG90aGVyIHZjcHVzLiAq
LworICAgIGZvcl9lYWNoX3ZjcHUgKCBkLCB2ICkKKyAgICAgICAgaWYgKCB2ICE9IGN1cnJlbnQg
JiYgZmx1c2hfdmNwdShjdHh0LCB2KSApCisgICAgICAgICAgICB2Y3B1X3BhdXNlX25vc3luYyh2
KTsKKworICAgIC8qIE5vdyB0aGF0IGFsbCBWQ1BVcyBhcmUgc2lnbmFsbGVkIHRvIGRlc2NoZWR1
bGUsIHdlIHdhaXQuLi4gKi8KKyAgICBmb3JfZWFjaF92Y3B1ICggZCwgdiApCisgICAgICAgIGlm
ICggdiAhPSBjdXJyZW50ICYmIGZsdXNoX3ZjcHUoY3R4dCwgdikgKQorICAgICAgICAgICAgd2hp
bGUgKCAhdmNwdV9ydW5uYWJsZSh2KSAmJiB2LT5pc19ydW5uaW5nICkKKyAgICAgICAgICAgICAg
ICBjcHVfcmVsYXgoKTsKKworICAgIC8qIEFsbCBvdGhlciB2Y3B1cyBhcmUgcGF1c2VkLCBzYWZl
IHRvIHVubG9jayBub3cuICovCisgICAgc3Bpbl91bmxvY2soJmQtPmh5cGVyY2FsbF9kZWFkbG9j
a19tdXRleCk7CisKKyAgICBjcHVtYXNrX2NsZWFyKG1hc2spOworCisgICAgLyogRmx1c2ggcGFn
aW5nLW1vZGUgc29mdCBzdGF0ZSAoZS5nLiwgdmEtPmdmbiBjYWNoZTsgUEFFIFBEUEUgY2FjaGUp
LiAqLworICAgIGZvcl9lYWNoX3ZjcHUgKCBkLCB2ICkKKyAgICB7CisgICAgICAgIHVuc2lnbmVk
IGludCBjcHU7CisKKyAgICAgICAgaWYgKCAhZmx1c2hfdmNwdShjdHh0LCB2KSApCisgICAgICAg
ICAgICBjb250aW51ZTsKKworICAgICAgICBwYWdpbmdfdXBkYXRlX2NyMyh2LCBmYWxzZSk7CisK
KyAgICAgICAgY3B1ID0gcmVhZF9hdG9taWMoJnYtPmRpcnR5X2NwdSk7CisgICAgICAgIGlmICgg
aXNfdmNwdV9kaXJ0eV9jcHUoY3B1KSApCisgICAgICAgICAgICBfX2NwdW1hc2tfc2V0X2NwdShj
cHUsIG1hc2spOworICAgIH0KKworICAgIC8qIEZsdXNoIFRMQnMgb24gYWxsIENQVXMgd2l0aCBk
aXJ0eSB2Y3B1IHN0YXRlLiAqLworICAgIGZsdXNoX3RsYl9tYXNrKG1hc2spOworCisgICAgLyog
RG9uZS4gKi8KKyAgICBmb3JfZWFjaF92Y3B1ICggZCwgdiApCisgICAgICAgIGlmICggdiAhPSBj
dXJyZW50ICYmIGZsdXNoX3ZjcHUoY3R4dCwgdikgKQorICAgICAgICAgICAgdmNwdV91bnBhdXNl
KHYpOworCisgICAgcmV0dXJuIHRydWU7Cit9CisKIC8qKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KIC8qIFNo
YWRvdy1jb250cm9sIFhFTl9ET01DVEwgZGlzcGF0Y2hlciAqLwogCmRpZmYgLS1naXQgYS94ZW4v
aW5jbHVkZS9hc20teDg2L2hhcC5oIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9oYXAuaAppbmRleCBi
OTRiZmI0ZWQwLi4wYzZhYTI2YjliIDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS9hc20teDg2L2hh
cC5oCisrKyBiL3hlbi9pbmNsdWRlL2FzbS14ODYvaGFwLmgKQEAgLTQ2LDYgKzQ2LDkgQEAgaW50
ICAgaGFwX3RyYWNrX2RpcnR5X3ZyYW0oc3RydWN0IGRvbWFpbiAqZCwKIGV4dGVybiBjb25zdCBz
dHJ1Y3QgcGFnaW5nX21vZGUgKmhhcF9wYWdpbmdfZ2V0X21vZGUoc3RydWN0IHZjcHUgKik7CiBp
bnQgaGFwX3NldF9hbGxvY2F0aW9uKHN0cnVjdCBkb21haW4gKmQsIHVuc2lnbmVkIGludCBwYWdl
cywgYm9vbCAqcHJlZW1wdGVkKTsKIAorYm9vbCBoYXBfZmx1c2hfdGxiKGJvb2wgKCpmbHVzaF92
Y3B1KSh2b2lkICpjdHh0LCBzdHJ1Y3QgdmNwdSAqdiksCisgICAgICAgICAgICAgICAgICAgdm9p
ZCAqY3R4dCk7CisKICNlbmRpZiAvKiBYRU5fSEFQX0ggKi8KIAogLyoKZGlmZiAtLWdpdCBhL3hl
bi9pbmNsdWRlL2FzbS14ODYvc2hhZG93LmggYi94ZW4vaW5jbHVkZS9hc20teDg2L3NoYWRvdy5o
CmluZGV4IDkwN2M3MWY0OTcuLmNmZDQ2NTBhMTYgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL2Fz
bS14ODYvc2hhZG93LmgKKysrIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9zaGFkb3cuaApAQCAtOTUs
NiArOTUsMTAgQEAgdm9pZCBzaGFkb3dfYmxvd190YWJsZXNfcGVyX2RvbWFpbihzdHJ1Y3QgZG9t
YWluICpkKTsKIGludCBzaGFkb3dfc2V0X2FsbG9jYXRpb24oc3RydWN0IGRvbWFpbiAqZCwgdW5z
aWduZWQgaW50IHBhZ2VzLAogICAgICAgICAgICAgICAgICAgICAgICAgICBib29sICpwcmVlbXB0
ZWQpOwogCisvKiBGbHVzaCB0aGUgVExCIG9mIHRoZSBzZWxlY3RlZCB2Q1BVcy4gKi8KK2Jvb2wg
c2hhZG93X2ZsdXNoX3RsYihib29sICgqZmx1c2hfdmNwdSkodm9pZCAqY3R4dCwgc3RydWN0IHZj
cHUgKnYpLAorICAgICAgICAgICAgICAgICAgICAgIHZvaWQgKmN0eHQpOworCiAjZWxzZSAvKiAh
Q09ORklHX1NIQURPV19QQUdJTkcgKi8KIAogI2RlZmluZSBzaGFkb3dfdGVhcmRvd24oZCwgcCkg
QVNTRVJUKGlzX3B2X2RvbWFpbihkKSkKQEAgLTEwNiw2ICsxMTAsMTQgQEAgaW50IHNoYWRvd19z
ZXRfYWxsb2NhdGlvbihzdHJ1Y3QgZG9tYWluICpkLCB1bnNpZ25lZCBpbnQgcGFnZXMsCiAjZGVm
aW5lIHNoYWRvd19zZXRfYWxsb2NhdGlvbihkLCBwYWdlcywgcHJlZW1wdGVkKSBcCiAgICAgKHsg
QVNTRVJUX1VOUkVBQ0hBQkxFKCk7IC1FT1BOT1RTVVBQOyB9KQogCitzdGF0aWMgaW5saW5lIGJv
b2wgc2hhZG93X2ZsdXNoX3RsYihib29sICgqZmx1c2hfdmNwdSkodm9pZCAqY3R4dCwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3Qg
dmNwdSAqdiksCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkICpjdHh0
KQoreworICAgIEFTU0VSVF9VTlJFQUNIQUJMRSgpOworICAgIHJldHVybiBmYWxzZTsKK30KKwog
c3RhdGljIGlubGluZSB2b2lkIHNoX3JlbW92ZV9zaGFkb3dzKHN0cnVjdCBkb21haW4gKmQsIG1m
bl90IGdtZm4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IGZhc3Qs
IGludCBhbGwpIHt9CiAKLS0gCjIuMjUuMAoKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3Rz
LnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0
aW5mby94ZW4tZGV2ZWw=

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 58D50BFFB1
	for <lists+xen-devel@lfdr.de>; Fri, 27 Sep 2019 09:05:24 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iDkGK-00041B-NF; Fri, 27 Sep 2019 07:01:56 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=Rbpq=XW=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1iDkGJ-0003zA-6l
 for xen-devel@lists.xenproject.org; Fri, 27 Sep 2019 07:01:55 +0000
X-Inumbo-ID: 919739a2-e0f4-11e9-966c-12813bfff9fa
Received: from mx1.suse.de (unknown [195.135.220.15])
 by localhost (Halon) with ESMTPS
 id 919739a2-e0f4-11e9-966c-12813bfff9fa;
 Fri, 27 Sep 2019 07:01:04 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 8FB01AECB;
 Fri, 27 Sep 2019 07:01:00 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Fri, 27 Sep 2019 09:00:24 +0200
Message-Id: <20190927070050.12405-21-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190927070050.12405-1-jgross@suse.com>
References: <20190927070050.12405-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v4 20/46] xen: let vcpu_create() select processor
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>,
 Dario Faggioli <dfaggioli@suse.com>,
 Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VG9kYXkgdGhlcmUgYXJlIHR3byBkaXN0aW5jdCBzY2VuYXJpb3MgZm9yIHZjcHVfY3JlYXRlKCk6
IGVpdGhlciBmb3IKY3JlYXRpb24gb2YgaWRsZS1kb21haW4gdmNwdXMgKHZjcHVpZCA9PSBwcm9j
ZXNzb3IpIG9yIGZvciBjcmVhdGlvbiBvZgoibm9ybWFsIiBkb21haW4gdmNwdXMgKGluY2x1ZGlu
ZyBkb20wKSwgd2hlcmUgdGhlIGNhbGxlciBzZWxlY3RzIHRoZQppbml0aWFsIHByb2Nlc3NvciBv
biBhIHJvdW5kLXJvYmluIHNjaGVtZSBvZiB0aGUgYWxsb3dlZCBwcm9jZXNzb3JzCihhbGxvd2Vk
IGJlaW5nIGJhc2VkIG9uIGNwdXBvb2wgYW5kIGFmZmluaXRpZXMpLgoKSW5zdGVhZCBvZiBwYXNz
aW5nIHRoZSBpbml0aWFsIHByb2Nlc3NvciB0byB2Y3B1X2NyZWF0ZSgpIGFuZCBwYXNzaW5nCm9u
IHRvIHNjaGVkX2luaXRfdmNwdSgpIGxldCBzY2hlZF9pbml0X3ZjcHUoKSBkbyB0aGUgcHJvY2Vz
c29yCnNlbGVjdGlvbi4gRm9yIHN1cHBvcnRpbmcgZG9tMCB2Y3B1IGNyZWF0aW9uIHVzZSB0aGUg
bm9kZV9hZmZpbml0eSBvZgp0aGUgZG9tYWluIGFzIGEgYmFzZSBmb3Igc2VsZWN0aW5nIHRoZSBw
cm9jZXNzb3JzLiBVc2VyIGRvbWFpbnMgd2lsbApoYXZlIGluaXRpYWxseSBhbGwgbm9kZXMgc2V0
LCBzbyB0aGlzIGlzIG5vIGRpZmZlcmVudCBiZWhhdmlvciBjb21wYXJlZAp0byB0b2RheS4gSW4g
dGhlb3J5IHRoaXMgaXMgbm90IGd1YXJhbnRlZWQgYXMgdmNwdXMgYXJlIGNyZWF0ZWQgb25seQp3
aXRoIFhFTl9ET01DVExfbWF4X3ZjcHVzIGJlaW5nIGNhbGxlZCwgYnV0IHRoaXMgY2FsbCBpcyBn
b2luZyB0byBiZQpyZW1vdmVkIGluIGZ1dHVyZSBhbmQgdGhlIHRvb2xzdGFjayBkb2Vzbid0IGNh
bGwKWEVOX0RPTUNUTF9zZXRub2RlYWZmaW5pdHkgYmVmb3JlIGNhbGxpbmcgWEVOX0RPTUNUTF9t
YXhfdmNwdXMuCgpUbyBiZSBhYmxlIHRvIHVzZSBjb25zdCBzdHJ1Y3QgZG9tYWluICogbWFrZSBj
cHVwb29sX2RvbWFpbl9jcHVtYXNrKCkKdGFrZSBhIGNvbnN0IGRvbWFpbiBwb2ludGVyLCB0b28u
CgpBIGZ1cnRoZXIgc2ltcGxpZmljYXRpb24gaXMgcG9zc2libGUgYnkgaGF2aW5nIGEgc2luZ2xl
IGZ1bmN0aW9uIGZvcgpjcmVhdGluZyB0aGUgZG9tMCB2Y3B1cyB3aXRoIHZjcHVfaWQgPiAwIGFu
ZCBkb2luZyB0aGUgcmVxdWlyZWQgcGlubmluZwpmb3IgYWxsIHZjcHVzIGFmdGVyIHRoYXQuIFRo
aXMgYWxsb3dzIHRvIG1ha2Ugc2NoZWRfc2V0X2FmZmluaXR5KCkKcHJpdmF0ZSB0byBzY2hlZHVs
ZS5jIGFuZCBzd2l0Y2ggaXQgdG8gc2NoZWRfdW5pdHMgZWFzaWx5LiBOb3RlIHRoYXQKdGhpcyBm
dW5jdGlvbmFsaXR5IGlzIHg4NiBvbmx5LgoKU2lnbmVkLW9mZi1ieTogSnVlcmdlbiBHcm9zcyA8
amdyb3NzQHN1c2UuY29tPgpBY2tlZC1ieTogSnVsaWVuIEdyYWxsIDxqdWxpZW4uZ3JhbGxAYXJt
LmNvbT4KLS0tClJGQyBWMjoKLSBhZGQgQVNTRVJUKCksIG1vZGlmeSBlcnJvciBtZXNzYWdlIChB
bmRyZXcgQ29vcGVyKQpWMToKLSBjb25zdGlmeSBwb2ludGVycywgYXZvaWQgY3B1bWFzayBvbiBz
dGFjayAoSmFuIEJldWxpY2gpClYzOgotIHN0eWxlIGNvcnJlY3Rpb24gKEphbiBCZXVsaWNoKQpW
NDoKLSBtb3ZlIHg4NiB2Y3B1IGFsbG9jYXRpb24gYW5kIHBpbm5pbmcgdG8gc2NoZWR1bGUuYwot
LS0KIHhlbi9hcmNoL2FybS9kb21haW5fYnVpbGQuYyAgICAgIHwgIDEzICsrKy0tCiB4ZW4vYXJj
aC94ODYvZG9tMF9idWlsZC5jICAgICAgICB8ICAzMiArKy0tLS0tLS0tLS0KIHhlbi9hcmNoL3g4
Ni9odm0vZG9tMF9idWlsZC5jICAgIHwgIDExICstLS0KIHhlbi9hcmNoL3g4Ni9wdi9kb20wX2J1
aWxkLmMgICAgIHwgIDEyICstLS0tCiB4ZW4vY29tbW9uL2RvbWFpbi5jICAgICAgICAgICAgICB8
ICAgNSArLQogeGVuL2NvbW1vbi9kb21jdGwuYyAgICAgICAgICAgICAgfCAgMTAgKy0tLQogeGVu
L2NvbW1vbi9zY2hlZHVsZS5jICAgICAgICAgICAgfCAxMTAgKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKystLS0tLS0tCiB4ZW4vaW5jbHVkZS9hc20teDg2L2RvbTBfYnVpbGQuaCB8ICAg
MiAtCiB4ZW4vaW5jbHVkZS94ZW4vZG9tYWluLmggICAgICAgICB8ICAgNSArLQogeGVuL2luY2x1
ZGUveGVuL3NjaGVkLWlmLmggICAgICAgfCAgIDIgKy0KIHhlbi9pbmNsdWRlL3hlbi9zY2hlZC5o
ICAgICAgICAgIHwgICA2ICstLQogMTEgZmlsZXMgY2hhbmdlZCwgMTEzIGluc2VydGlvbnMoKyks
IDk1IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL2FybS9kb21haW5fYnVpbGQu
YyBiL3hlbi9hcmNoL2FybS9kb21haW5fYnVpbGQuYwppbmRleCBiODRhNDQ4M2NjLi43YTgyZGUy
NjczIDEwMDY0NAotLS0gYS94ZW4vYXJjaC9hcm0vZG9tYWluX2J1aWxkLmMKKysrIGIveGVuL2Fy
Y2gvYXJtL2RvbWFpbl9idWlsZC5jCkBAIC04MCw3ICs4MCw3IEBAIHVuc2lnbmVkIGludCBfX2lu
aXQgZG9tMF9tYXhfdmNwdXModm9pZCkKIAogc3RydWN0IHZjcHUgKl9faW5pdCBhbGxvY19kb20w
X3ZjcHUwKHN0cnVjdCBkb21haW4gKmRvbTApCiB7Ci0gICAgcmV0dXJuIHZjcHVfY3JlYXRlKGRv
bTAsIDAsIDApOworICAgIHJldHVybiB2Y3B1X2NyZWF0ZShkb20wLCAwKTsKIH0KIAogc3RhdGlj
IHVuc2lnbmVkIGludCBfX2luaXQgZ2V0X2FsbG9jYXRpb25fc2l6ZShwYWRkcl90IHNpemUpCkBA
IC0xOTQwLDcgKzE5NDAsNyBAQCBzdGF0aWMgdm9pZCBfX2luaXQgZmluZF9nbnR0YWJfcmVnaW9u
KHN0cnVjdCBkb21haW4gKmQsCiAKIHN0YXRpYyBpbnQgX19pbml0IGNvbnN0cnVjdF9kb21haW4o
c3RydWN0IGRvbWFpbiAqZCwgc3RydWN0IGtlcm5lbF9pbmZvICpraW5mbykKIHsKLSAgICBpbnQg
aSwgY3B1OworICAgIGludCBpOwogICAgIHN0cnVjdCB2Y3B1ICp2ID0gZC0+dmNwdVswXTsKICAg
ICBzdHJ1Y3QgY3B1X3VzZXJfcmVncyAqcmVncyA9ICZ2LT5hcmNoLmNwdV9pbmZvLT5ndWVzdF9j
cHVfdXNlcl9yZWdzOwogCkBAIC0yMDAzLDEyICsyMDAzLDExIEBAIHN0YXRpYyBpbnQgX19pbml0
IGNvbnN0cnVjdF9kb21haW4oc3RydWN0IGRvbWFpbiAqZCwgc3RydWN0IGtlcm5lbF9pbmZvICpr
aW5mbykKICAgICB9CiAjZW5kaWYKIAotICAgIGZvciAoIGkgPSAxLCBjcHUgPSAwOyBpIDwgZC0+
bWF4X3ZjcHVzOyBpKysgKQorICAgIGZvciAoIGkgPSAxOyBpIDwgZC0+bWF4X3ZjcHVzOyBpKysg
KQogICAgIHsKLSAgICAgICAgY3B1ID0gY3B1bWFza19jeWNsZShjcHUsICZjcHVfb25saW5lX21h
cCk7Ci0gICAgICAgIGlmICggdmNwdV9jcmVhdGUoZCwgaSwgY3B1KSA9PSBOVUxMICkKKyAgICAg
ICAgaWYgKCB2Y3B1X2NyZWF0ZShkLCBpKSA9PSBOVUxMICkKICAgICAgICAgewotICAgICAgICAg
ICAgcHJpbnRrKCJGYWlsZWQgdG8gYWxsb2NhdGUgZG9tMCB2Y3B1ICVkIG9uIHBjcHUgJWRcbiIs
IGksIGNwdSk7CisgICAgICAgICAgICBwcmludGsoIkZhaWxlZCB0byBhbGxvY2F0ZSBkMHYldVxu
IiwgaSk7CiAgICAgICAgICAgICBicmVhazsKICAgICAgICAgfQogCkBAIC0yMDQzLDcgKzIwNDIs
NyBAQCBzdGF0aWMgaW50IF9faW5pdCBjb25zdHJ1Y3RfZG9tVShzdHJ1Y3QgZG9tYWluICpkLAog
CiAgICAga2luZm8udnBsMDExID0gZHRfcHJvcGVydHlfcmVhZF9ib29sKG5vZGUsICJ2cGwwMTEi
KTsKIAotICAgIGlmICggdmNwdV9jcmVhdGUoZCwgMCwgMCkgPT0gTlVMTCApCisgICAgaWYgKCB2
Y3B1X2NyZWF0ZShkLCAwKSA9PSBOVUxMICkKICAgICAgICAgcmV0dXJuIC1FTk9NRU07CiAgICAg
ZC0+bWF4X3BhZ2VzID0gfjBVOwogCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvZG9tMF9idWls
ZC5jIGIveGVuL2FyY2gveDg2L2RvbTBfYnVpbGQuYwppbmRleCA0NTRjZjYzMmQ3Li5kZTk0YmRm
MjFmIDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYvZG9tMF9idWlsZC5jCisrKyBiL3hlbi9hcmNo
L3g4Ni9kb20wX2J1aWxkLmMKQEAgLTE2NSw3ICsxNjUsNyBAQCBjdXN0b21fcGFyYW0oImRvbTBf
bWF4X3ZjcHVzIiwgcGFyc2VfZG9tMF9tYXhfdmNwdXMpOwogc3RhdGljIF9faW5pdGRhdGEgdW5z
aWduZWQgaW50IGRvbTBfbnJfcHhtczsKIHN0YXRpYyBfX2luaXRkYXRhIHVuc2lnbmVkIGludCBk
b20wX3B4bXNbTUFYX05VTU5PREVTXSA9CiAgICAgeyBbMCAuLi4gTUFYX05VTU5PREVTIC0gMV0g
PSB+MCB9Owotc3RhdGljIF9faW5pdGRhdGEgYm9vbCBkb20wX2FmZmluaXR5X3JlbGF4ZWQ7Citf
X2luaXRkYXRhIGJvb2wgZG9tMF9hZmZpbml0eV9yZWxheGVkOwogCiBzdGF0aWMgaW50IF9faW5p
dCBwYXJzZV9kb20wX25vZGVzKGNvbnN0IGNoYXIgKnMpCiB7CkBAIC0xOTYsMzIgKzE5Niw3IEBA
IHN0YXRpYyBpbnQgX19pbml0IHBhcnNlX2RvbTBfbm9kZXMoY29uc3QgY2hhciAqcykKIH0KIGN1
c3RvbV9wYXJhbSgiZG9tMF9ub2RlcyIsIHBhcnNlX2RvbTBfbm9kZXMpOwogCi1zdGF0aWMgY3B1
bWFza190IF9faW5pdGRhdGEgZG9tMF9jcHVzOwotCi1zdHJ1Y3QgdmNwdSAqX19pbml0IGRvbTBf
c2V0dXBfdmNwdShzdHJ1Y3QgZG9tYWluICpkLAotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgdW5zaWduZWQgaW50IHZjcHVfaWQsCi0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICB1bnNpZ25lZCBpbnQgcHJldl9jcHUpCi17Ci0gICAgdW5zaWduZWQgaW50IGNw
dSA9IGNwdW1hc2tfY3ljbGUocHJldl9jcHUsICZkb20wX2NwdXMpOwotICAgIHN0cnVjdCB2Y3B1
ICp2ID0gdmNwdV9jcmVhdGUoZCwgdmNwdV9pZCwgY3B1KTsKLQotICAgIGlmICggdiApCi0gICAg
ewotICAgICAgICBpZiAoIHB2X3NoaW0gKQotICAgICAgICB7Ci0gICAgICAgICAgICBzY2hlZF9z
ZXRfYWZmaW5pdHkodiwgY3B1bWFza19vZih2Y3B1X2lkKSwgY3B1bWFza19vZih2Y3B1X2lkKSk7
Ci0gICAgICAgIH0KLSAgICAgICAgZWxzZQotICAgICAgICB7Ci0gICAgICAgICAgICBpZiAoICFv
cHRfZG9tMF92Y3B1c19waW4gJiYgIWRvbTBfYWZmaW5pdHlfcmVsYXhlZCApCi0gICAgICAgICAg
ICAgICAgc2NoZWRfc2V0X2FmZmluaXR5KHYsICZkb20wX2NwdXMsIE5VTEwpOwotICAgICAgICAg
ICAgc2NoZWRfc2V0X2FmZmluaXR5KHYsIE5VTEwsICZkb20wX2NwdXMpOwotICAgICAgICB9Ci0g
ICAgfQotCi0gICAgcmV0dXJuIHY7Ci19Ci0KK2NwdW1hc2tfdCBfX2luaXRkYXRhIGRvbTBfY3B1
czsKIHN0YXRpYyBub2RlbWFza190IF9faW5pdGRhdGEgZG9tMF9ub2RlczsKIAogdW5zaWduZWQg
aW50IF9faW5pdCBkb20wX21heF92Y3B1cyh2b2lkKQpAQCAtMjczLDggKzI0OCw3IEBAIHN0cnVj
dCB2Y3B1ICpfX2luaXQgYWxsb2NfZG9tMF92Y3B1MChzdHJ1Y3QgZG9tYWluICpkb20wKQogICAg
IGRvbTAtPm5vZGVfYWZmaW5pdHkgPSBkb20wX25vZGVzOwogICAgIGRvbTAtPmF1dG9fbm9kZV9h
ZmZpbml0eSA9ICFkb20wX25yX3B4bXM7CiAKLSAgICByZXR1cm4gZG9tMF9zZXR1cF92Y3B1KGRv
bTAsIDAsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICBjcHVtYXNrX2xhc3QoJmRvbTBfY3B1
cykgLyogc28gaXQgd3JhcHMgYXJvdW5kIHRvIGZpcnN0IHBjcHUgKi8pOworICAgIHJldHVybiB2
Y3B1X2NyZWF0ZShkb20wLCAwKTsKIH0KIAogI2lmZGVmIENPTkZJR19TSEFET1dfUEFHSU5HCmRp
ZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvaHZtL2RvbTBfYnVpbGQuYyBiL3hlbi9hcmNoL3g4Ni9o
dm0vZG9tMF9idWlsZC5jCmluZGV4IDg4NDUzOTlhZTkuLjgzMTMyNTE1MGIgMTAwNjQ0Ci0tLSBh
L3hlbi9hcmNoL3g4Ni9odm0vZG9tMF9idWlsZC5jCisrKyBiL3hlbi9hcmNoL3g4Ni9odm0vZG9t
MF9idWlsZC5jCkBAIC02MTQsNyArNjE0LDYgQEAgc3RhdGljIGludCBfX2luaXQgcHZoX3NldHVw
X2NwdXMoc3RydWN0IGRvbWFpbiAqZCwgcGFkZHJfdCBlbnRyeSwKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHBhZGRyX3Qgc3RhcnRfaW5mbykKIHsKICAgICBzdHJ1Y3QgdmNwdSAq
diA9IGQtPnZjcHVbMF07Ci0gICAgdW5zaWduZWQgaW50IGNwdSA9IHYtPnByb2Nlc3NvciwgaTsK
ICAgICBpbnQgcmM7CiAgICAgLyoKICAgICAgKiBUaGlzIHNldHMgdGhlIHZDUFUgc3RhdGUgYWNj
b3JkaW5nIHRvIHRoZSBzdGF0ZSBkZXNjcmliZWQgaW4KQEAgLTYzNSwxNSArNjM0LDcgQEAgc3Rh
dGljIGludCBfX2luaXQgcHZoX3NldHVwX2NwdXMoc3RydWN0IGRvbWFpbiAqZCwgcGFkZHJfdCBl
bnRyeSwKICAgICAgICAgLmNwdV9yZWdzLng4Nl8zMi50cl9hciA9IDB4OGIsCiAgICAgfTsKIAot
ICAgIGZvciAoIGkgPSAxOyBpIDwgZC0+bWF4X3ZjcHVzOyBpKysgKQotICAgIHsKLSAgICAgICAg
Y29uc3Qgc3RydWN0IHZjcHUgKnAgPSBkb20wX3NldHVwX3ZjcHUoZCwgaSwgY3B1KTsKLQotICAg
ICAgICBpZiAoIHAgKQotICAgICAgICAgICAgY3B1ID0gcC0+cHJvY2Vzc29yOwotICAgIH0KLQot
ICAgIGRvbWFpbl91cGRhdGVfbm9kZV9hZmZpbml0eShkKTsKKyAgICBzY2hlZF9zZXR1cF9kb20w
X3ZjcHVzKGQpOwogCiAgICAgcmMgPSBhcmNoX3NldF9pbmZvX2h2bV9ndWVzdCh2LCAmY3B1X2N0
eCk7CiAgICAgaWYgKCByYyApCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvcHYvZG9tMF9idWls
ZC5jIGIveGVuL2FyY2gveDg2L3B2L2RvbTBfYnVpbGQuYwppbmRleCAxYmQ1M2U5YzA4Li45YTk3
Y2Y0YWJmIDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYvcHYvZG9tMF9idWlsZC5jCisrKyBiL3hl
bi9hcmNoL3g4Ni9wdi9kb20wX2J1aWxkLmMKQEAgLTI4NSw3ICsyODUsNyBAQCBpbnQgX19pbml0
IGRvbTBfY29uc3RydWN0X3B2KHN0cnVjdCBkb21haW4gKmQsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIG1vZHVsZV90ICppbml0cmQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGNoYXIgKmNtZGxpbmUpCiB7Ci0gICAgaW50IGksIGNwdSwgcmMsIGNvbXBhdGlibGUsIG9yZGVy
LCBtYWNoaW5lOworICAgIGludCBpLCByYywgY29tcGF0aWJsZSwgb3JkZXIsIG1hY2hpbmU7CiAg
ICAgc3RydWN0IGNwdV91c2VyX3JlZ3MgKnJlZ3M7CiAgICAgdW5zaWduZWQgbG9uZyBwZm4sIG1m
bjsKICAgICB1bnNpZ25lZCBsb25nIG5yX3BhZ2VzOwpAQCAtNjk0LDE2ICs2OTQsOCBAQCBpbnQg
X19pbml0IGRvbTBfY29uc3RydWN0X3B2KHN0cnVjdCBkb21haW4gKmQsCiAKICAgICBwcmludGso
IkRvbSV1IGhhcyBtYXhpbXVtICV1IFZDUFVzXG4iLCBkLT5kb21haW5faWQsIGQtPm1heF92Y3B1
cyk7CiAKLSAgICBjcHUgPSB2LT5wcm9jZXNzb3I7Ci0gICAgZm9yICggaSA9IDE7IGkgPCBkLT5t
YXhfdmNwdXM7IGkrKyApCi0gICAgewotICAgICAgICBjb25zdCBzdHJ1Y3QgdmNwdSAqcCA9IGRv
bTBfc2V0dXBfdmNwdShkLCBpLCBjcHUpOwotCi0gICAgICAgIGlmICggcCApCi0gICAgICAgICAg
ICBjcHUgPSBwLT5wcm9jZXNzb3I7Ci0gICAgfQorICAgIHNjaGVkX3NldHVwX2RvbTBfdmNwdXMo
ZCk7CiAKLSAgICBkb21haW5fdXBkYXRlX25vZGVfYWZmaW5pdHkoZCk7CiAgICAgZC0+YXJjaC5w
YWdpbmcubW9kZSA9IDA7CiAKICAgICAvKiBTZXQgdXAgQ1IzIHZhbHVlIGZvciB3cml0ZV9wdGJh
c2UgKi8KZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vZG9tYWluLmMgYi94ZW4vY29tbW9uL2RvbWFp
bi5jCmluZGV4IDI1YTEzODYwNTcuLmIzM2E3MDMxZWQgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24v
ZG9tYWluLmMKKysrIGIveGVuL2NvbW1vbi9kb21haW4uYwpAQCAtMTM1LDggKzEzNSw3IEBAIHN0
YXRpYyB2b2lkIHZjcHVfZGVzdHJveShzdHJ1Y3QgdmNwdSAqdikKICAgICBmcmVlX3ZjcHVfc3Ry
dWN0KHYpOwogfQogCi1zdHJ1Y3QgdmNwdSAqdmNwdV9jcmVhdGUoCi0gICAgc3RydWN0IGRvbWFp
biAqZCwgdW5zaWduZWQgaW50IHZjcHVfaWQsIHVuc2lnbmVkIGludCBjcHVfaWQpCitzdHJ1Y3Qg
dmNwdSAqdmNwdV9jcmVhdGUoc3RydWN0IGRvbWFpbiAqZCwgdW5zaWduZWQgaW50IHZjcHVfaWQp
CiB7CiAgICAgc3RydWN0IHZjcHUgKnY7CiAKQEAgLTE2OCw3ICsxNjcsNyBAQCBzdHJ1Y3QgdmNw
dSAqdmNwdV9jcmVhdGUoCiAgICAgICAgIGluaXRfd2FpdHF1ZXVlX3ZjcHUodik7CiAgICAgfQog
Ci0gICAgaWYgKCBzY2hlZF9pbml0X3ZjcHUodiwgY3B1X2lkKSAhPSAwICkKKyAgICBpZiAoIHNj
aGVkX2luaXRfdmNwdSh2KSAhPSAwICkKICAgICAgICAgZ290byBmYWlsX3dxOwogCiAgICAgaWYg
KCBhcmNoX3ZjcHVfY3JlYXRlKHYpICE9IDAgKQpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9kb21j
dGwuYyBiL3hlbi9jb21tb24vZG9tY3RsLmMKaW5kZXggMmY5NzY4ZjA4Zi4uOGE2OTRlMGQzNyAx
MDA2NDQKLS0tIGEveGVuL2NvbW1vbi9kb21jdGwuYworKysgYi94ZW4vY29tbW9uL2RvbWN0bC5j
CkBAIC01MzIsOCArNTMyLDcgQEAgbG9uZyBkb19kb21jdGwoWEVOX0dVRVNUX0hBTkRMRV9QQVJB
TSh4ZW5fZG9tY3RsX3QpIHVfZG9tY3RsKQogCiAgICAgY2FzZSBYRU5fRE9NQ1RMX21heF92Y3B1
czoKICAgICB7Ci0gICAgICAgIHVuc2lnbmVkIGludCBpLCBtYXggPSBvcC0+dS5tYXhfdmNwdXMu
bWF4LCBjcHU7Ci0gICAgICAgIGNwdW1hc2tfdCAqb25saW5lOworICAgICAgICB1bnNpZ25lZCBp
bnQgaSwgbWF4ID0gb3AtPnUubWF4X3ZjcHVzLm1heDsKIAogICAgICAgICByZXQgPSAtRUlOVkFM
OwogICAgICAgICBpZiAoIChkID09IGN1cnJlbnQtPmRvbWFpbikgfHwgLyogbm8gZG9tYWluX3Bh
dXNlKCkgKi8KQEAgLTU0NCwxOCArNTQzLDEzIEBAIGxvbmcgZG9fZG9tY3RsKFhFTl9HVUVTVF9I
QU5ETEVfUEFSQU0oeGVuX2RvbWN0bF90KSB1X2RvbWN0bCkKICAgICAgICAgZG9tYWluX3BhdXNl
KGQpOwogCiAgICAgICAgIHJldCA9IC1FTk9NRU07Ci0gICAgICAgIG9ubGluZSA9IGNwdXBvb2xf
ZG9tYWluX2NwdW1hc2soZCk7CiAKICAgICAgICAgZm9yICggaSA9IDA7IGkgPCBtYXg7IGkrKyAp
CiAgICAgICAgIHsKICAgICAgICAgICAgIGlmICggZC0+dmNwdVtpXSAhPSBOVUxMICkKICAgICAg
ICAgICAgICAgICBjb250aW51ZTsKIAotICAgICAgICAgICAgY3B1ID0gKGkgPT0gMCkgPwotICAg
ICAgICAgICAgICAgIGNwdW1hc2tfYW55KG9ubGluZSkgOgotICAgICAgICAgICAgICAgIGNwdW1h
c2tfY3ljbGUoZC0+dmNwdVtpLTFdLT5wcm9jZXNzb3IsIG9ubGluZSk7Ci0KLSAgICAgICAgICAg
IGlmICggdmNwdV9jcmVhdGUoZCwgaSwgY3B1KSA9PSBOVUxMICkKKyAgICAgICAgICAgIGlmICgg
dmNwdV9jcmVhdGUoZCwgaSkgPT0gTlVMTCApCiAgICAgICAgICAgICAgICAgZ290byBtYXh2Y3B1
X291dDsKICAgICAgICAgfQogCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3NjaGVkdWxlLmMgYi94
ZW4vY29tbW9uL3NjaGVkdWxlLmMKaW5kZXggYjAyN2MwODRiZi4uMjZjZTA0YmZkOCAxMDA2NDQK
LS0tIGEveGVuL2NvbW1vbi9zY2hlZHVsZS5jCisrKyBiL3hlbi9jb21tb24vc2NoZWR1bGUuYwpA
QCAtMzgsNiArMzgsMTAgQEAKICNpbmNsdWRlIDx4c20veHNtLmg+CiAjaW5jbHVkZSA8eGVuL2Vy
ci5oPgogCisjaWZkZWYgQ09ORklHX1g4NgorI2luY2x1ZGUgPGFzbS9ndWVzdC5oPgorI2VuZGlm
CisKIC8qIG9wdF9zY2hlZDogc2NoZWR1bGVyIC0gZGVmYXVsdCB0byBjb25maWd1cmVkIHZhbHVl
ICovCiBzdGF0aWMgY2hhciBfX2luaXRkYXRhIG9wdF9zY2hlZFsxMF0gPSBDT05GSUdfU0NIRURf
REVGQVVMVDsKIHN0cmluZ19wYXJhbSgic2NoZWQiLCBvcHRfc2NoZWQpOwpAQCAtODAsNiArODQs
OSBAQCBleHRlcm4gY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqX19zdGFydF9zY2hlZHVsZXJzX2Fy
cmF5W10sICpfX2VuZF9zY2hlZHVsZXJzX2FycgogCiBzdGF0aWMgc3RydWN0IHNjaGVkdWxlciBf
X3JlYWRfbW9zdGx5IG9wczsKIAorc3RhdGljIHZvaWQgc2NoZWRfc2V0X2FmZmluaXR5KAorICAg
IHN0cnVjdCBzY2hlZF91bml0ICp1bml0LCBjb25zdCBjcHVtYXNrX3QgKmhhcmQsIGNvbnN0IGNw
dW1hc2tfdCAqc29mdCk7CisKIHN0YXRpYyBzcGlubG9ja190ICoKIHNjaGVkX2lkbGVfc3dpdGNo
X3NjaGVkKHN0cnVjdCBzY2hlZHVsZXIgKm5ld19vcHMsIHVuc2lnbmVkIGludCBjcHUsCiAgICAg
ICAgICAgICAgICAgICAgICAgICB2b2lkICpwZGF0YSwgdm9pZCAqdmRhdGEpCkBAIC0zNzIsMTQg
KzM3OSw1MiBAQCBzdGF0aWMgc3RydWN0IHNjaGVkX3VuaXQgKnNjaGVkX2FsbG9jX3VuaXQoc3Ry
dWN0IHZjcHUgKnYpCiAgICAgcmV0dXJuIE5VTEw7CiB9CiAKLWludCBzY2hlZF9pbml0X3ZjcHUo
c3RydWN0IHZjcHUgKnYsIHVuc2lnbmVkIGludCBwcm9jZXNzb3IpCitzdGF0aWMgdW5zaWduZWQg
aW50IHNjaGVkX3NlbGVjdF9pbml0aWFsX2NwdShjb25zdCBzdHJ1Y3QgdmNwdSAqdikKK3sKKyAg
ICBjb25zdCBzdHJ1Y3QgZG9tYWluICpkID0gdi0+ZG9tYWluOworICAgIG5vZGVpZF90IG5vZGU7
CisgICAgc3BpbmxvY2tfdCAqbG9jazsKKyAgICB1bnNpZ25lZCBsb25nIGZsYWdzOworICAgIHVu
c2lnbmVkIGludCBjcHVfcmV0LCBjcHUgPSBzbXBfcHJvY2Vzc29yX2lkKCk7CisgICAgY3B1bWFz
a190ICpjcHVzID0gY3B1bWFza19zY3JhdGNoX2NwdShjcHUpOworCisgICAgbG9jayA9IHBjcHVf
c2NoZWR1bGVfbG9ja19pcnFzYXZlKGNwdSwgJmZsYWdzKTsKKyAgICBjcHVtYXNrX2NsZWFyKGNw
dXMpOworICAgIGZvcl9lYWNoX25vZGVfbWFzayAoIG5vZGUsIGQtPm5vZGVfYWZmaW5pdHkgKQor
ICAgICAgICBjcHVtYXNrX29yKGNwdXMsIGNwdXMsICZub2RlX3RvX2NwdW1hc2sobm9kZSkpOwor
ICAgIGNwdW1hc2tfYW5kKGNwdXMsIGNwdXMsIGNwdXBvb2xfZG9tYWluX2NwdW1hc2soZCkpOwor
ICAgIGlmICggY3B1bWFza19lbXB0eShjcHVzKSApCisgICAgICAgIGNwdW1hc2tfY29weShjcHVz
LCBjcHVwb29sX2RvbWFpbl9jcHVtYXNrKGQpKTsKKworICAgIGlmICggdi0+dmNwdV9pZCA9PSAw
ICkKKyAgICAgICAgY3B1X3JldCA9IGNwdW1hc2tfZmlyc3QoY3B1cyk7CisgICAgZWxzZQorICAg
IHsKKyAgICAgICAgLyogV2UgY2FuIHJlbHkgb24gcHJldmlvdXMgdmNwdSBiZWluZyBhdmFpbGFi
bGUuICovCisgICAgICAgIEFTU0VSVCghaXNfaWRsZV9kb21haW4oZCkpOworCisgICAgICAgIGNw
dV9yZXQgPSBjcHVtYXNrX2N5Y2xlKGQtPnZjcHVbdi0+dmNwdV9pZCAtIDFdLT5wcm9jZXNzb3Is
IGNwdXMpOworICAgIH0KKworICAgIHBjcHVfc2NoZWR1bGVfdW5sb2NrX2lycXJlc3RvcmUobG9j
aywgZmxhZ3MsIGNwdSk7CisKKyAgICByZXR1cm4gY3B1X3JldDsKK30KKworaW50IHNjaGVkX2lu
aXRfdmNwdShzdHJ1Y3QgdmNwdSAqdikKIHsKICAgICBzdHJ1Y3QgZG9tYWluICpkID0gdi0+ZG9t
YWluOwogICAgIHN0cnVjdCBzY2hlZF91bml0ICp1bml0OworICAgIHVuc2lnbmVkIGludCBwcm9j
ZXNzb3I7CiAKICAgICBpZiAoICh1bml0ID0gc2NoZWRfYWxsb2NfdW5pdCh2KSkgPT0gTlVMTCAp
CiAgICAgICAgIHJldHVybiAxOwogCisgICAgaWYgKCBpc19pZGxlX2RvbWFpbihkKSApCisgICAg
ICAgIHByb2Nlc3NvciA9IHYtPnZjcHVfaWQ7CisgICAgZWxzZQorICAgICAgICBwcm9jZXNzb3Ig
PSBzY2hlZF9zZWxlY3RfaW5pdGlhbF9jcHUodik7CisKICAgICBzY2hlZF9zZXRfcmVzKHVuaXQs
IGdldF9zY2hlZF9yZXMocHJvY2Vzc29yKSk7CiAKICAgICAvKiBJbml0aWFsaXNlIHRoZSBwZXIt
dmNwdSB0aW1lcnMuICovCkBAIC00MDMsOSArNDQ4LDkgQEAgaW50IHNjaGVkX2luaXRfdmNwdShz
dHJ1Y3QgdmNwdSAqdiwgdW5zaWduZWQgaW50IHByb2Nlc3NvcikKICAgICAgKiBkb21haW4tMCBW
Q1BVcywgYXJlIHBpbm5lZCBvbnRvIHRoZWlyIHJlc3BlY3RpdmUgcGh5c2ljYWwgQ1BVcy4KICAg
ICAgKi8KICAgICBpZiAoIGlzX2lkbGVfZG9tYWluKGQpIHx8IChpc19oYXJkd2FyZV9kb21haW4o
ZCkgJiYgb3B0X2RvbTBfdmNwdXNfcGluKSApCi0gICAgICAgIHNjaGVkX3NldF9hZmZpbml0eSh2
LCBjcHVtYXNrX29mKHByb2Nlc3NvciksICZjcHVtYXNrX2FsbCk7CisgICAgICAgIHNjaGVkX3Nl
dF9hZmZpbml0eSh1bml0LCBjcHVtYXNrX29mKHByb2Nlc3NvciksICZjcHVtYXNrX2FsbCk7CiAg
ICAgZWxzZQotICAgICAgICBzY2hlZF9zZXRfYWZmaW5pdHkodiwgJmNwdW1hc2tfYWxsLCAmY3B1
bWFza19hbGwpOworICAgICAgICBzY2hlZF9zZXRfYWZmaW5pdHkodW5pdCwgJmNwdW1hc2tfYWxs
LCAmY3B1bWFza19hbGwpOwogCiAgICAgLyogSWRsZSBWQ1BVcyBhcmUgc2NoZWR1bGVkIGltbWVk
aWF0ZWx5LCBzbyBkb24ndCBwdXQgdGhlbSBpbiBydW5xdWV1ZS4gKi8KICAgICBpZiAoIGlzX2lk
bGVfZG9tYWluKGQpICkKQEAgLTQ5Niw3ICs1NDEsNyBAQCBpbnQgc2NoZWRfbW92ZV9kb21haW4o
c3RydWN0IGRvbWFpbiAqZCwgc3RydWN0IGNwdXBvb2wgKmMpCiAKICAgICAgICAgbG9jayA9IHVu
aXRfc2NoZWR1bGVfbG9ja19pcnEodi0+c2NoZWRfdW5pdCk7CiAKLSAgICAgICAgc2NoZWRfc2V0
X2FmZmluaXR5KHYsICZjcHVtYXNrX2FsbCwgJmNwdW1hc2tfYWxsKTsKKyAgICAgICAgc2NoZWRf
c2V0X2FmZmluaXR5KHYtPnNjaGVkX3VuaXQsICZjcHVtYXNrX2FsbCwgJmNwdW1hc2tfYWxsKTsK
IAogICAgICAgICBzY2hlZF9zZXRfcmVzKHYtPnNjaGVkX3VuaXQsIGdldF9zY2hlZF9yZXMobmV3
X3ApKTsKICAgICAgICAgLyoKQEAgLTgzOSw3ICs4ODQsNyBAQCB2b2lkIHJlc3RvcmVfdmNwdV9h
ZmZpbml0eShzdHJ1Y3QgZG9tYWluICpkKQogICAgICAgICB7CiAgICAgICAgICAgICBpZiAoIHYt
PmFmZmluaXR5X2Jyb2tlbiApCiAgICAgICAgICAgICB7Ci0gICAgICAgICAgICAgICAgc2NoZWRf
c2V0X2FmZmluaXR5KHYsIHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5X3NhdmVkLCBOVUxMKTsKKyAg
ICAgICAgICAgICAgICBzY2hlZF9zZXRfYWZmaW5pdHkodW5pdCwgdW5pdC0+Y3B1X2hhcmRfYWZm
aW5pdHlfc2F2ZWQsIE5VTEwpOwogICAgICAgICAgICAgICAgIHYtPmFmZmluaXR5X2Jyb2tlbiA9
IDA7CiAgICAgICAgICAgICAgICAgY3B1bWFza19hbmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUp
LCB1bml0LT5jcHVfaGFyZF9hZmZpbml0eSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBj
cHVwb29sX2RvbWFpbl9jcHVtYXNrKGQpKTsKQEAgLTg0OCw3ICs4OTMsNyBAQCB2b2lkIHJlc3Rv
cmVfdmNwdV9hZmZpbml0eShzdHJ1Y3QgZG9tYWluICpkKQogICAgICAgICAgICAgaWYgKCBjcHVt
YXNrX2VtcHR5KGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSkgKQogICAgICAgICAgICAgewogICAg
ICAgICAgICAgICAgIHByaW50ayhYRU5MT0dfREVCVUcgIkJyZWFraW5nIGFmZmluaXR5IGZvciAl
cHZcbiIsIHYpOwotICAgICAgICAgICAgICAgIHNjaGVkX3NldF9hZmZpbml0eSh2LCAmY3B1bWFz
a19hbGwsIE5VTEwpOworICAgICAgICAgICAgICAgIHNjaGVkX3NldF9hZmZpbml0eSh1bml0LCAm
Y3B1bWFza19hbGwsIE5VTEwpOwogICAgICAgICAgICAgICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tf
c2NyYXRjaF9jcHUoY3B1KSwgdW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHksCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgY3B1cG9vbF9kb21haW5fY3B1bWFzayhkKSk7CiAgICAgICAgICAgICB9
CkBAIC05MTEsNyArOTU2LDcgQEAgaW50IGNwdV9kaXNhYmxlX3NjaGVkdWxlcih1bnNpZ25lZCBp
bnQgY3B1KQogCiAgICAgICAgICAgICAgICAgcHJpbnRrKFhFTkxPR19ERUJVRyAiQnJlYWtpbmcg
YWZmaW5pdHkgZm9yICVwdlxuIiwgdik7CiAKLSAgICAgICAgICAgICAgICBzY2hlZF9zZXRfYWZm
aW5pdHkodiwgJmNwdW1hc2tfYWxsLCBOVUxMKTsKKyAgICAgICAgICAgICAgICBzY2hlZF9zZXRf
YWZmaW5pdHkodW5pdCwgJmNwdW1hc2tfYWxsLCBOVUxMKTsKICAgICAgICAgICAgIH0KIAogICAg
ICAgICAgICAgaWYgKCB2LT5wcm9jZXNzb3IgIT0gY3B1ICkKQEAgLTk3MCwxNCArMTAxNSwxMiBA
QCBzdGF0aWMgaW50IGNwdV9kaXNhYmxlX3NjaGVkdWxlcl9jaGVjayh1bnNpZ25lZCBpbnQgY3B1
KQogICogYWRqdXN0X2FmZmluaXR5IGhvb2sgbWF5IHdhbnQgdG8gbW9kaWZ5IHRoZSB2Q1BVIHN0
YXRlLiBIb3dldmVyLCB3aGVuIHRoZQogICogdkNQVSBpcyBiZWluZyBpbml0aWFsaXplZCAoZWl0
aGVyIGZvciBkb20wIG9yIGRvbVUpIHRoZXJlIGlzIG5vIHJpc2sgb2YKICAqIHJhY2VzLCBhbmQg
aXQncyBmaW5lIHRvIG5vdCB0YWtlIHRoZSBsb29rICh3ZSdyZSB0YWxraW5nIGFib3V0Ci0gKiBk
b20wX3NldHVwX3ZjcHUoKSBhbiBzY2hlZF9pbml0X3ZjcHUoKSkuCisgKiBzY2hlZF9zZXR1cF9k
b20wX3ZjcHVzKCkgYW4gc2NoZWRfaW5pdF92Y3B1KCkpLgogICovCi12b2lkIHNjaGVkX3NldF9h
ZmZpbml0eSgKLSAgICBzdHJ1Y3QgdmNwdSAqdiwgY29uc3QgY3B1bWFza190ICpoYXJkLCBjb25z
dCBjcHVtYXNrX3QgKnNvZnQpCitzdGF0aWMgdm9pZCBzY2hlZF9zZXRfYWZmaW5pdHkoCisgICAg
c3RydWN0IHNjaGVkX3VuaXQgKnVuaXQsIGNvbnN0IGNwdW1hc2tfdCAqaGFyZCwgY29uc3QgY3B1
bWFza190ICpzb2Z0KQogewotICAgIHN0cnVjdCBzY2hlZF91bml0ICp1bml0ID0gdi0+c2NoZWRf
dW5pdDsKLQotICAgIHNjaGVkX2FkanVzdF9hZmZpbml0eShkb21fc2NoZWR1bGVyKHYtPmRvbWFp
biksIHVuaXQsIGhhcmQsIHNvZnQpOworICAgIHNjaGVkX2FkanVzdF9hZmZpbml0eShkb21fc2No
ZWR1bGVyKHVuaXQtPmRvbWFpbiksIHVuaXQsIGhhcmQsIHNvZnQpOwogCiAgICAgaWYgKCBoYXJk
ICkKICAgICAgICAgY3B1bWFza19jb3B5KHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5LCBoYXJkKTsK
QEAgLTEwMDksMTIgKzEwNTIsMTIgQEAgc3RhdGljIGludCB2Y3B1X3NldF9hZmZpbml0eSgKICAg
ICAgICAgICovCiAgICAgICAgIGlmICggd2hpY2ggPT0gdW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHkg
KQogICAgICAgICB7Ci0gICAgICAgICAgICBzY2hlZF9zZXRfYWZmaW5pdHkodiwgYWZmaW5pdHks
IE5VTEwpOworICAgICAgICAgICAgc2NoZWRfc2V0X2FmZmluaXR5KHVuaXQsIGFmZmluaXR5LCBO
VUxMKTsKICAgICAgICAgfQogICAgICAgICBlbHNlCiAgICAgICAgIHsKICAgICAgICAgICAgIEFT
U0VSVCh3aGljaCA9PSB1bml0LT5jcHVfc29mdF9hZmZpbml0eSk7Ci0gICAgICAgICAgICBzY2hl
ZF9zZXRfYWZmaW5pdHkodiwgTlVMTCwgYWZmaW5pdHkpOworICAgICAgICAgICAgc2NoZWRfc2V0
X2FmZmluaXR5KHVuaXQsIE5VTEwsIGFmZmluaXR5KTsKICAgICAgICAgfQogICAgICAgICB2Y3B1
X21pZ3JhdGVfc3RhcnQodik7CiAgICAgfQpAQCAtMTI2Miw3ICsxMzA1LDcgQEAgaW50IHZjcHVf
dGVtcG9yYXJ5X2FmZmluaXR5KHN0cnVjdCB2Y3B1ICp2LCB1bnNpZ25lZCBpbnQgY3B1LCB1aW50
OF90IHJlYXNvbikKICAgICAgICAgICAgIHYtPmFmZmluaXR5X2Jyb2tlbiAmPSB+cmVhc29uOwog
ICAgICAgICB9CiAgICAgICAgIGlmICggIXJldCAmJiAhdi0+YWZmaW5pdHlfYnJva2VuICkKLSAg
ICAgICAgICAgIHNjaGVkX3NldF9hZmZpbml0eSh2LCB1bml0LT5jcHVfaGFyZF9hZmZpbml0eV9z
YXZlZCwgTlVMTCk7CisgICAgICAgICAgICBzY2hlZF9zZXRfYWZmaW5pdHkodW5pdCwgdW5pdC0+
Y3B1X2hhcmRfYWZmaW5pdHlfc2F2ZWQsIE5VTEwpOwogICAgIH0KICAgICBlbHNlIGlmICggY3B1
IDwgbnJfY3B1X2lkcyApCiAgICAgewpAQCAtMTI3NSw3ICsxMzE4LDcgQEAgaW50IHZjcHVfdGVt
cG9yYXJ5X2FmZmluaXR5KHN0cnVjdCB2Y3B1ICp2LCB1bnNpZ25lZCBpbnQgY3B1LCB1aW50OF90
IHJlYXNvbikKICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICBjcHVtYXNrX2NvcHkodW5p
dC0+Y3B1X2hhcmRfYWZmaW5pdHlfc2F2ZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5KTsKLSAgICAgICAgICAgICAgICBzY2hlZF9zZXRfYWZm
aW5pdHkodiwgY3B1bWFza19vZihjcHUpLCBOVUxMKTsKKyAgICAgICAgICAgICAgICBzY2hlZF9z
ZXRfYWZmaW5pdHkodW5pdCwgY3B1bWFza19vZihjcHUpLCBOVUxMKTsKICAgICAgICAgICAgIH0K
ICAgICAgICAgICAgIHYtPmFmZmluaXR5X2Jyb2tlbiB8PSByZWFzb247CiAgICAgICAgICAgICBy
ZXQgPSAwOwpAQCAtMTc2NCw3ICsxODA3LDcgQEAgc3RhdGljIGludCBjcHVfc2NoZWR1bGVfdXAo
dW5zaWduZWQgaW50IGNwdSkKICAgICAgICAgcmV0dXJuIDA7CiAKICAgICBpZiAoIGlkbGVfdmNw
dVtjcHVdID09IE5VTEwgKQotICAgICAgICB2Y3B1X2NyZWF0ZShpZGxlX3ZjcHVbMF0tPmRvbWFp
biwgY3B1LCBjcHUpOworICAgICAgICB2Y3B1X2NyZWF0ZShpZGxlX3ZjcHVbMF0tPmRvbWFpbiwg
Y3B1KTsKICAgICBlbHNlCiAgICAgICAgIGlkbGVfdmNwdVtjcHVdLT5zY2hlZF91bml0LT5yZXMg
PSBzcjsKIApAQCAtMTk0Myw3ICsxOTg2LDcgQEAgdm9pZCBfX2luaXQgc2NoZWR1bGVyX2luaXQo
dm9pZCkKICAgICBCVUdfT04obnJfY3B1X2lkcyA+IEFSUkFZX1NJWkUoaWRsZV92Y3B1KSk7CiAg
ICAgaWRsZV9kb21haW4tPnZjcHUgPSBpZGxlX3ZjcHU7CiAgICAgaWRsZV9kb21haW4tPm1heF92
Y3B1cyA9IG5yX2NwdV9pZHM7Ci0gICAgaWYgKCB2Y3B1X2NyZWF0ZShpZGxlX2RvbWFpbiwgMCwg
MCkgPT0gTlVMTCApCisgICAgaWYgKCB2Y3B1X2NyZWF0ZShpZGxlX2RvbWFpbiwgMCkgPT0gTlVM
TCApCiAgICAgICAgIEJVRygpOwogICAgIGdldF9zY2hlZF9yZXMoMCktPmN1cnIgPSBpZGxlX3Zj
cHVbMF0tPnNjaGVkX3VuaXQ7CiB9CkBAIC0yMTQ1LDYgKzIxODgsMzUgQEAgdm9pZCB3YWl0KHZv
aWQpCiAgICAgc2NoZWR1bGUoKTsKIH0KIAorI2lmZGVmIENPTkZJR19YODYKK3ZvaWQgX19pbml0
IHNjaGVkX3NldHVwX2RvbTBfdmNwdXMoc3RydWN0IGRvbWFpbiAqZCkKK3sKKyAgICB1bnNpZ25l
ZCBpbnQgaTsKKyAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdDsKKworICAgIGZvciAoIGkgPSAx
OyBpIDwgZC0+bWF4X3ZjcHVzOyBpKysgKQorICAgICAgICB2Y3B1X2NyZWF0ZShkLCBpKTsKKwor
ICAgIGZvcl9lYWNoX3NjaGVkX3VuaXQgKCBkLCB1bml0ICkKKyAgICB7CisgICAgICAgIHVuc2ln
bmVkIGludCBpZCA9IHVuaXQtPnVuaXRfaWQ7CisKKyAgICAgICAgaWYgKCBwdl9zaGltICkKKyAg
ICAgICAgeworICAgICAgICAgICAgc2NoZWRfc2V0X2FmZmluaXR5KHVuaXQsIGNwdW1hc2tfb2Yo
aWQpLCBjcHVtYXNrX29mKGlkKSk7CisgICAgICAgIH0KKyAgICAgICAgZWxzZQorICAgICAgICB7
CisgICAgICAgICAgICBpZiAoICFvcHRfZG9tMF92Y3B1c19waW4gJiYgIWRvbTBfYWZmaW5pdHlf
cmVsYXhlZCApCisgICAgICAgICAgICAgICAgc2NoZWRfc2V0X2FmZmluaXR5KHVuaXQsICZkb20w
X2NwdXMsIE5VTEwpOworICAgICAgICAgICAgc2NoZWRfc2V0X2FmZmluaXR5KHVuaXQsIE5VTEws
ICZkb20wX2NwdXMpOworICAgICAgICB9CisgICAgfQorCisgICAgZG9tYWluX3VwZGF0ZV9ub2Rl
X2FmZmluaXR5KGQpOworfQorI2VuZGlmCisKICNpZmRlZiBDT05GSUdfQ09NUEFUCiAjaW5jbHVk
ZSAiY29tcGF0L3NjaGVkdWxlLmMiCiAjZW5kaWYKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL2Fz
bS14ODYvZG9tMF9idWlsZC5oIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9kb20wX2J1aWxkLmgKaW5k
ZXggMzNhNTQ4MzczOS4uMGI3OTdiNTgwNiAxMDA2NDQKLS0tIGEveGVuL2luY2x1ZGUvYXNtLXg4
Ni9kb20wX2J1aWxkLmgKKysrIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9kb20wX2J1aWxkLmgKQEAg
LTExLDggKzExLDYgQEAgZXh0ZXJuIHVuc2lnbmVkIGludCBkb20wX21lbWZsYWdzOwogdW5zaWdu
ZWQgbG9uZyBkb20wX2NvbXB1dGVfbnJfcGFnZXMoc3RydWN0IGRvbWFpbiAqZCwKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBlbGZfZG9tX3Bhcm1zICpwYXJtcywK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGxvbmcgaW5pdHJk
X2xlbik7Ci1zdHJ1Y3QgdmNwdSAqZG9tMF9zZXR1cF92Y3B1KHN0cnVjdCBkb21haW4gKmQsIHVu
c2lnbmVkIGludCB2Y3B1X2lkLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25l
ZCBpbnQgY3B1KTsKIGludCBkb20wX3NldHVwX3Blcm1pc3Npb25zKHN0cnVjdCBkb21haW4gKmQp
OwogCiBpbnQgZG9tMF9jb25zdHJ1Y3RfcHYoc3RydWN0IGRvbWFpbiAqZCwgY29uc3QgbW9kdWxl
X3QgKmltYWdlLApkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUveGVuL2RvbWFpbi5oIGIveGVuL2lu
Y2x1ZGUveGVuL2RvbWFpbi5oCmluZGV4IDNmMDljYjY2YzAuLjc2OTMwMjA1N2IgMTAwNjQ0Ci0t
LSBhL3hlbi9pbmNsdWRlL3hlbi9kb21haW4uaAorKysgYi94ZW4vaW5jbHVkZS94ZW4vZG9tYWlu
LmgKQEAgLTEzLDggKzEzLDcgQEAgdHlwZWRlZiB1bmlvbiB7CiAgICAgc3RydWN0IGNvbXBhdF92
Y3B1X2d1ZXN0X2NvbnRleHQgKmNtcDsKIH0gdmNwdV9ndWVzdF9jb250ZXh0X3UgX19hdHRyaWJ1
dGVfXygoX190cmFuc3BhcmVudF91bmlvbl9fKSk7CiAKLXN0cnVjdCB2Y3B1ICp2Y3B1X2NyZWF0
ZSgKLSAgICBzdHJ1Y3QgZG9tYWluICpkLCB1bnNpZ25lZCBpbnQgdmNwdV9pZCwgdW5zaWduZWQg
aW50IGNwdV9pZCk7CitzdHJ1Y3QgdmNwdSAqdmNwdV9jcmVhdGUoc3RydWN0IGRvbWFpbiAqZCwg
dW5zaWduZWQgaW50IHZjcHVfaWQpOwogCiB1bnNpZ25lZCBpbnQgZG9tMF9tYXhfdmNwdXModm9p
ZCk7CiBzdHJ1Y3QgdmNwdSAqYWxsb2NfZG9tMF92Y3B1MChzdHJ1Y3QgZG9tYWluICpkb20wKTsK
QEAgLTEwNyw2ICsxMDYsOCBAQCBpbnQgY29udGludWVfaHlwZXJjYWxsX29uX2NwdSgKIGV4dGVy
biB1bnNpZ25lZCBpbnQgeGVuX3Byb2Nlc3Nvcl9wbWJpdHM7CiAKIGV4dGVybiBib29sX3Qgb3B0
X2RvbTBfdmNwdXNfcGluOworZXh0ZXJuIGNwdW1hc2tfdCBkb20wX2NwdXM7CitleHRlcm4gYm9v
bCBkb20wX2FmZmluaXR5X3JlbGF4ZWQ7CiAKIC8qIHZudW1hIHRvcG9sb2d5IHBlciBkb21haW4u
ICovCiBzdHJ1Y3Qgdm51bWFfaW5mbyB7CmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS94ZW4vc2No
ZWQtaWYuaCBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5oCmluZGV4IDQ1YWMwM2YwZjguLjQ3
OTdiYTNmMmIgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5oCisrKyBiL3hl
bi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5oCkBAIC00OTgsNyArNDk4LDcgQEAgc3RydWN0IGNwdXBv
b2wKICNkZWZpbmUgY3B1cG9vbF9vbmxpbmVfY3B1bWFzayhfcG9vbCkgXAogICAgICgoKF9wb29s
KSA9PSBOVUxMKSA/ICZjcHVfb25saW5lX21hcCA6IChfcG9vbCktPmNwdV92YWxpZCkKIAotc3Rh
dGljIGlubGluZSBjcHVtYXNrX3QqIGNwdXBvb2xfZG9tYWluX2NwdW1hc2soc3RydWN0IGRvbWFp
biAqZCkKK3N0YXRpYyBpbmxpbmUgY3B1bWFza190ICpjcHVwb29sX2RvbWFpbl9jcHVtYXNrKGNv
bnN0IHN0cnVjdCBkb21haW4gKmQpCiB7CiAgICAgLyoKICAgICAgKiBkLT5jcHVwb29sIGlzIE5V
TEwgb25seSBmb3IgdGhlIGlkbGUgZG9tYWluLCBhbmQgbm8gb25lIHNob3VsZApkaWZmIC0tZ2l0
IGEveGVuL2luY2x1ZGUveGVuL3NjaGVkLmggYi94ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaAppbmRl
eCA1NjQ2ZDYyMGMzLi42ZGU5ZGRhYWE5IDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS94ZW4vc2No
ZWQuaAorKysgYi94ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaApAQCAtNjYxLDcgKzY2MSw3IEBAIHZv
aWQgX19kb21haW5fY3Jhc2goc3RydWN0IGRvbWFpbiAqZCk7CiB2b2lkIG5vcmV0dXJuIGFzbV9k
b21haW5fY3Jhc2hfc3luY2hyb25vdXModW5zaWduZWQgbG9uZyBhZGRyKTsKIAogdm9pZCBzY2hl
ZHVsZXJfaW5pdCh2b2lkKTsKLWludCAgc2NoZWRfaW5pdF92Y3B1KHN0cnVjdCB2Y3B1ICp2LCB1
bnNpZ25lZCBpbnQgcHJvY2Vzc29yKTsKK2ludCAgc2NoZWRfaW5pdF92Y3B1KHN0cnVjdCB2Y3B1
ICp2KTsKIHZvaWQgc2NoZWRfZGVzdHJveV92Y3B1KHN0cnVjdCB2Y3B1ICp2KTsKIGludCAgc2No
ZWRfaW5pdF9kb21haW4oc3RydWN0IGRvbWFpbiAqZCwgaW50IHBvb2xpZCk7CiB2b2lkIHNjaGVk
X2Rlc3Ryb3lfZG9tYWluKHN0cnVjdCBkb21haW4gKmQpOwpAQCAtOTA2LDkgKzkwNiw3IEBAIHZv
aWQgc2NoZWR1bGVyX2ZyZWUoc3RydWN0IHNjaGVkdWxlciAqc2NoZWQpOwogaW50IHNjaGVkdWxl
X2NwdV9zd2l0Y2godW5zaWduZWQgaW50IGNwdSwgc3RydWN0IGNwdXBvb2wgKmMpOwogdm9pZCB2
Y3B1X3NldF9wZXJpb2RpY190aW1lcihzdHJ1Y3QgdmNwdSAqdiwgc190aW1lX3QgdmFsdWUpOwog
aW50IGNwdV9kaXNhYmxlX3NjaGVkdWxlcih1bnNpZ25lZCBpbnQgY3B1KTsKLS8qIFdlIG5lZWQg
aXQgaW4gZG9tMF9zZXR1cF92Y3B1ICovCi12b2lkIHNjaGVkX3NldF9hZmZpbml0eShzdHJ1Y3Qg
dmNwdSAqdiwgY29uc3QgY3B1bWFza190ICpoYXJkLAotICAgICAgICAgICAgICAgICAgICAgICAg
Y29uc3QgY3B1bWFza190ICpzb2Z0KTsKK3ZvaWQgc2NoZWRfc2V0dXBfZG9tMF92Y3B1cyhzdHJ1
Y3QgZG9tYWluICpkKTsKIGludCB2Y3B1X3RlbXBvcmFyeV9hZmZpbml0eShzdHJ1Y3QgdmNwdSAq
diwgdW5zaWduZWQgaW50IGNwdSwgdWludDhfdCByZWFzb24pOwogaW50IHZjcHVfc2V0X2hhcmRf
YWZmaW5pdHkoc3RydWN0IHZjcHUgKnYsIGNvbnN0IGNwdW1hc2tfdCAqYWZmaW5pdHkpOwogaW50
IHZjcHVfc2V0X3NvZnRfYWZmaW5pdHkoc3RydWN0IHZjcHUgKnYsIGNvbnN0IGNwdW1hc2tfdCAq
YWZmaW5pdHkpOwotLSAKMi4xNi40CgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVu
cHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZv
L3hlbi1kZXZlbA==

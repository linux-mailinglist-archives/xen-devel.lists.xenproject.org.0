Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id E44E1AF5AE
	for <lists+xen-devel@lfdr.de>; Wed, 11 Sep 2019 08:22:45 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i7vzN-0003ep-JT; Wed, 11 Sep 2019 06:20:25 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=s4Ct=XG=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1i7vzL-0003eK-QY
 for xen-devel@lists.xenproject.org; Wed, 11 Sep 2019 06:20:23 +0000
X-Inumbo-ID: 3217d646-d45c-11e9-b299-bc764e2007e4
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 3217d646-d45c-11e9-b299-bc764e2007e4;
 Wed, 11 Sep 2019 06:20:05 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 2176DB60A;
 Wed, 11 Sep 2019 06:20:05 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Wed, 11 Sep 2019 08:20:00 +0200
Message-Id: <20190911062001.25931-5-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190911062001.25931-1-jgross@suse.com>
References: <20190911062001.25931-1-jgross@suse.com>
Subject: [Xen-devel] [RFC PATCH 4/5] tools: add xenfs tool
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Ian Jackson <ian.jackson@eu.citrix.com>,
 Wei Liu <wl@xen.org>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

QWRkIHRoZSB4ZW5mcyB0b29sIGZvciBhY2Nlc3NpbmcgdGhlIGh5cGVydmlzb3IgZmlsZXN5c3Rl
bS4KClNpZ25lZC1vZmYtYnk6IEp1ZXJnZW4gR3Jvc3MgPGpncm9zc0BzdXNlLmNvbT4KLS0tCiB0
b29scy9taXNjL01ha2VmaWxlIHwgICA2ICsrKysKIHRvb2xzL21pc2MveGVuZnMuYyAgfCAxMDIg
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwogMiBm
aWxlcyBjaGFuZ2VkLCAxMDggaW5zZXJ0aW9ucygrKQogY3JlYXRlIG1vZGUgMTAwNjQ0IHRvb2xz
L21pc2MveGVuZnMuYwoKZGlmZiAtLWdpdCBhL3Rvb2xzL21pc2MvTWFrZWZpbGUgYi90b29scy9t
aXNjL01ha2VmaWxlCmluZGV4IDYzOTQ3YmZhZGMuLjlmM2FiZDViY2YgMTAwNjQ0Ci0tLSBhL3Rv
b2xzL21pc2MvTWFrZWZpbGUKKysrIGIvdG9vbHMvbWlzYy9NYWtlZmlsZQpAQCAtMjQsNiArMjQs
NyBAQCBJTlNUQUxMX1NCSU4tJChDT05GSUdfWDg2KSAgICAgKz0geGVuLWxvd21lbWQKIElOU1RB
TExfU0JJTi0kKENPTkZJR19YODYpICAgICArPSB4ZW4tbWZuZHVtcAogSU5TVEFMTF9TQklOLSQo
Q09ORklHX1g4NikgICAgICs9IHhlbi11Y29kZQogSU5TVEFMTF9TQklOICAgICAgICAgICAgICAg
ICAgICs9IHhlbmNvdgorSU5TVEFMTF9TQklOICAgICAgICAgICAgICAgICAgICs9IHhlbmZzCiBJ
TlNUQUxMX1NCSU4gICAgICAgICAgICAgICAgICAgKz0geGVubG9ja3Byb2YKIElOU1RBTExfU0JJ
TiAgICAgICAgICAgICAgICAgICArPSB4ZW5wZXJmCiBJTlNUQUxMX1NCSU4gICAgICAgICAgICAg
ICAgICAgKz0geGVucG0KQEAgLTg2LDYgKzg3LDkgQEAgeGVucGVyZjogeGVucGVyZi5vCiB4ZW5w
bTogeGVucG0ubwogCSQoQ0MpICQoTERGTEFHUykgLW8gJEAgJDwgJChMRExJQlNfbGlieGVuY3Ry
bCkgJChBUFBFTkRfTERGTEFHUykKIAoreGVuZnM6IHhlbmZzLm8KKwkkKENDKSAkKExERkxBR1Mp
IC1vICRAICQ8ICQoTERMSUJTX2xpYnhlbmZzKSAkKEFQUEVORF9MREZMQUdTKQorCiB4ZW5sb2Nr
cHJvZjogeGVubG9ja3Byb2YubwogCSQoQ0MpICQoTERGTEFHUykgLW8gJEAgJDwgJChMRExJQlNf
bGlieGVuY3RybCkgJChBUFBFTkRfTERGTEFHUykKIApAQCAtOTQsNiArOTgsOCBAQCB4ZW4taHB0
b29sLm86IENGTEFHUyArPSAtSSQoWEVOX1JPT1QpL3Rvb2xzL2xpYnhjICQoQ0ZMQUdTX2xpYnhl
bmNhbGwpCiB4ZW4taHB0b29sOiB4ZW4taHB0b29sLm8KIAkkKENDKSAkKExERkxBR1MpIC1vICRA
ICQ8ICQoTERMSUJTX2xpYnhlbmV2dGNobikgJChMRExJQlNfbGlieGVuY3RybCkgJChMRExJQlNf
bGlieGVuZ3Vlc3QpICQoTERMSUJTX2xpYnhlbnN0b3JlKSAkKEFQUEVORF9MREZMQUdTKQogCit4
ZW5mcy5vOiBDRkxBR1MgKz0gJChDRkxBR1NfbGlieGVuZnMpCisKICMgeGVuLW1mbmR1bXAgaW5j
b3JyZWN0bHkgdXNlcyBsaWJ4YyBpbnRlcm5hbHMKIHhlbi1tZm5kdW1wLm86IENGTEFHUyArPSAt
SSQoWEVOX1JPT1QpL3Rvb2xzL2xpYnhjICQoQ0ZMQUdTX2xpYnhlbmNhbGwpCiB4ZW4tbWZuZHVt
cDogeGVuLW1mbmR1bXAubwpkaWZmIC0tZ2l0IGEvdG9vbHMvbWlzYy94ZW5mcy5jIGIvdG9vbHMv
bWlzYy94ZW5mcy5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAuLmVjYWE0
Y2NiMGEKLS0tIC9kZXYvbnVsbAorKysgYi90b29scy9taXNjL3hlbmZzLmMKQEAgLTAsMCArMSwx
MDIgQEAKKyNkZWZpbmUgX0dOVV9TT1VSQ0UKKyNpbmNsdWRlIDxzdGRpby5oPgorI2luY2x1ZGUg
PHN0ZGxpYi5oPgorI2luY2x1ZGUgPHN0cmluZy5oPgorI2luY2x1ZGUgPHhlbmZzLmg+CisKK3N0
YXRpYyBzdHJ1Y3QgeGVuZnNfaGFuZGxlICpoZGw7CisKK3N0YXRpYyBpbnQgeGVuZnNfY2F0KGNo
YXIgKnBhdGgpCit7CisgICAgaW50IHJldCA9IDA7CisgICAgY2hhciAqcmVzdWx0OworCisgICAg
cmVzdWx0ID0geGVuZnNfcmVhZChoZGwsIHBhdGgpOworICAgIGlmICghcmVzdWx0KSB7CisgICAg
ICAgIHBlcnJvcigiY291bGQgbm90IHJlYWQiKTsKKyAgICAgICAgcmV0ID0gMzsKKyAgICB9IGVs
c2UgeworICAgICAgICBwcmludGYoIiVzXG4iLCByZXN1bHQpOworICAgICAgICBmcmVlKHJlc3Vs
dCk7CisgICAgfQorICAgIHJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBpbnQgeGVuZnNfbHMoY2hh
ciAqcGF0aCkKK3sKKyAgICBzdHJ1Y3QgeGVuZnNfZGlyZW50ICplbnQ7CisgICAgdW5zaWduZWQg
aW50IG4sIGk7CisgICAgaW50IHJldCA9IDA7CisKKyAgICBlbnQgPSB4ZW5mc19yZWFkZGlyKGhk
bCwgcGF0aCwgJm4pOworICAgIGlmICghZW50KSB7CisgICAgICAgIHBlcnJvcigiY291bGQgbm90
IHJlYWQgZGlyIik7CisgICAgICAgIHJldCA9IDM7CisgICAgfSBlbHNlIHsKKyAgICAgICAgZm9y
IChpID0gMDsgaSA8IG47IGkrKykKKyAgICAgICAgICAgIHByaW50ZigiJWMgJXNcbiIsIGVudFtp
XS5pc19kaXIgPyAnZCcgOiAnLScsIGVudFtpXS5uYW1lKTsKKworICAgICAgICBmcmVlKGVudCk7
CisgICAgfQorICAgIHJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBpbnQgeGVuZnNfdHJlZV9zdWIo
Y2hhciAqcGF0aCwgdW5zaWduZWQgaW50IGRlcHRoKQoreworICAgIHN0cnVjdCB4ZW5mc19kaXJl
bnQgKmVudDsKKyAgICB1bnNpZ25lZCBpbnQgbiwgaTsKKyAgICBpbnQgcmV0ID0gMDsKKyAgICBj
aGFyICpwOworCisgICAgZW50ID0geGVuZnNfcmVhZGRpcihoZGwsIHBhdGgsICZuKTsKKyAgICBp
ZiAoIWVudCkKKyAgICAgICAgcmV0dXJuIDE7CisKKyAgICBmb3IgKGkgPSAwOyBpIDwgbjsgaSsr
KSB7CisgICAgICAgIHByaW50ZigiJSpzJXMlc1xuIiwgZGVwdGggKiAyLCAiIiwgZW50W2ldLm5h
bWUsCisgICAgICAgICAgICAgICBlbnRbaV0uaXNfZGlyID8gIi8iIDogIiIpOworICAgICAgICBp
ZiAoZW50W2ldLmlzX2RpcikgeworICAgICAgICAgICAgYXNwcmludGYoJnAsICIlcyVzJXMiLCBw
YXRoLCAoZGVwdGggPT0gMSkgPyAiIiA6ICIvIiwgZW50W2ldLm5hbWUpOworICAgICAgICAgICAg
aWYgKHhlbmZzX3RyZWVfc3ViKHAsIGRlcHRoICsgMSkpCisgICAgICAgICAgICAgICAgcmV0ID0g
MTsKKyAgICAgICAgfQorICAgIH0KKworICAgIGZyZWUoZW50KTsKKworICAgIHJldHVybiByZXQ7
Cit9CisKK3N0YXRpYyBpbnQgeGVuZnNfdHJlZSh2b2lkKQoreworICAgIHByaW50ZigiL1xuIik7
CisKKyAgICByZXR1cm4geGVuZnNfdHJlZV9zdWIoIi8iLCAxKTsKK30KKworaW50IG1haW4oaW50
IGFyZ2MsIGNoYXIgKmFyZ3ZbXSkKK3sKKyAgICBpbnQgcmV0OworCisgICAgaGRsID0geGVuZnNf
b3BlbihOVUxMLCAwKTsKKworICAgIGlmICghaGRsKSB7CisgICAgICAgIGZwcmludGYoc3RkZXJy
LCAiQ291bGQgbm90IG9wZW4gbGlieGVuZnNcbiIpOworICAgICAgICByZXQgPSAyOworICAgIH0g
ZWxzZSBpZiAoYXJnYyA9PSAzICYmICFzdHJjbXAoYXJndlsxXSwgIi0tY2F0IikpCisgICAgICAg
IHJldCA9IHhlbmZzX2NhdChhcmd2WzJdKTsKKyAgICBlbHNlIGlmIChhcmdjID09IDMgJiYgIXN0
cmNtcChhcmd2WzFdLCAiLS1scyIpKQorICAgICAgICByZXQgPSB4ZW5mc19scyhhcmd2WzJdKTsK
KyAgICBlbHNlIGlmIChhcmdjID09IDIgJiYgIXN0cmNtcChhcmd2WzFdLCAiLS10cmVlIikpCisg
ICAgICAgIHJldCA9IHhlbmZzX3RyZWUoKTsKKyAgICBlbHNlIHsKKyAgICAgICAgZnByaW50Zihz
dGRlcnIsICJ1c2FnZTogeGVuZnMgLS1scyA8cGF0aD5cbiIpOworICAgICAgICBmcHJpbnRmKHN0
ZGVyciwgIiAgICAgICB4ZW5mcyAtLWNhdCA8cGF0aD5cbiIpOworICAgICAgICBmcHJpbnRmKHN0
ZGVyciwgIiAgICAgICB4ZW5mcyAtLXRyZWVcbiIpOworICAgICAgICByZXQgPSAxOworICAgIH0K
KworICAgIHhlbmZzX2Nsb3NlKGhkbCk7CisKKyAgICByZXR1cm4gcmV0OworfQotLSAKMi4xNi40
CgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRl
dmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9s
aXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

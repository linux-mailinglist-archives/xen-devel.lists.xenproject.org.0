Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 1EF1C74FBB
	for <lists+xen-devel@lfdr.de>; Thu, 25 Jul 2019 15:39:56 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hqduZ-000802-VG; Thu, 25 Jul 2019 13:35:59 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=dOpT=VW=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1hqduY-0007zl-Fl
 for xen-devel@lists.xenproject.org; Thu, 25 Jul 2019 13:35:58 +0000
X-Inumbo-ID: 20649880-aee1-11e9-b269-83af57f464a0
Received: from m4a0039g.houston.softwaregrp.com (unknown [15.124.2.85])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 20649880-aee1-11e9-b269-83af57f464a0;
 Thu, 25 Jul 2019 13:35:55 +0000 (UTC)
Received: FROM m4a0039g.houston.softwaregrp.com (15.120.17.146) BY
 m4a0039g.houston.softwaregrp.com WITH ESMTP; 
 Thu, 25 Jul 2019 13:35:50 +0000
Received: from M4W0334.microfocus.com (2002:f78:1192::f78:1192) by
 M4W0334.microfocus.com (2002:f78:1192::f78:1192) with Microsoft SMTP Server
 (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256) id
 15.1.1591.10; Thu, 25 Jul 2019 13:32:42 +0000
Received: from NAM05-BY2-obe.outbound.protection.outlook.com (15.124.8.13) by
 M4W0334.microfocus.com (15.120.17.146) with Microsoft SMTP Server
 (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256) id
 15.1.1591.10 via Frontend Transport; Thu, 25 Jul 2019 13:32:42 +0000
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=UoF/N2fX+/4bsYZgbJ4d17ZbEo8S2lg64GzN9wRW9u6RMrV0G57dboSA5h0zyv34BKd0bKvcOXfQKEDq5K5XmvoonAqIycVL+EeMBjM2rQc70Sufr+H/tFZkkz53AxqGj+cq3lju+3Z7Pc8RtRUFyy9Jk9I+RXp4Swo4xUq9OGWxax4U3b478uDqVC823nuPw79h7Ak6l8nonRj9fOeUStoalQDpDHBgF/7uljf5fGJvEh+/fEPIyXqbUBRt8dkDW+0CfABKJeO5CEahiaAKFvM+pxSbQxEB0WC7B37S2Iynqvptiufwjojs1rVHRAhMZNBVMXzvXsnOiZK0arIL/A==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=05BeA7+zlzlPgeC8wqnYLrDRW+B+4+k20mX6+v0Bj0s=;
 b=i9pUunk2ARQRtPmoLIGrlsKIdhEScDvmo8Rwh43jghUrI3PaFPGafMStKE/estVYUn2T0vksdcFwWWlo5Y+Lp59vTKOAzUhS5LamNilZDOWrdi0beFVs9U2tu6zUrP75mAIRkJ64mkmxxqYAiBHVPoxnxTIwaFCGWJ/+MG/VUu5TvB428bghRFRy1ynpZfZPzspoSIKwGC3gOOJ7+Pq5w8nGj53HsVFturQKqe0Klny/B3O2zZP/X4xoufTA03NVmujqvIa5w0dJDyLTsi3L2ddTDLOEjweZntGC345Vw9DzZP82hXH6UoMAB3saMQoiLQvZQ912OkgU8xAxIx18fg==
ARC-Authentication-Results: i=1; mx.microsoft.com 1;spf=pass
 smtp.mailfrom=suse.com;dmarc=pass action=none header.from=suse.com;dkim=pass
 header.d=suse.com;arc=none
Received: from BY5PR18MB3394.namprd18.prod.outlook.com (10.255.139.95) by
 BY5PR18MB3297.namprd18.prod.outlook.com (10.255.163.221) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2115.10; Thu, 25 Jul 2019 13:32:40 +0000
Received: from BY5PR18MB3394.namprd18.prod.outlook.com
 ([fe80::a4f0:4f46:c076:f74b]) by BY5PR18MB3394.namprd18.prod.outlook.com
 ([fe80::a4f0:4f46:c076:f74b%7]) with mapi id 15.20.2115.005; Thu, 25 Jul 2019
 13:32:40 +0000
From: Jan Beulich <JBeulich@suse.com>
To: "xen-devel@lists.xenproject.org" <xen-devel@lists.xenproject.org>
Thread-Topic: [PATCH v4 09/12] AMD/IOMMU: enable x2APIC mode when available
Thread-Index: AQHVQu1ukmUsOZ1yIkGpOa1CMLMQVw==
Date: Thu, 25 Jul 2019 13:32:40 +0000
Message-ID: <a7719ca8-77f0-6bef-84ce-c6d3e4f5da59@suse.com>
References: <b8ae110a-f94a-4ed2-5cf9-c00ff1c0cb81@suse.com>
In-Reply-To: <b8ae110a-f94a-4ed2-5cf9-c00ff1c0cb81@suse.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-clientproxiedby: LO2P265CA0033.GBRP265.PROD.OUTLOOK.COM
 (2603:10a6:600:61::21) To BY5PR18MB3394.namprd18.prod.outlook.com
 (2603:10b6:a03:194::31)
authentication-results: spf=none (sender IP is )
 smtp.mailfrom=JBeulich@suse.com; 
x-ms-exchange-messagesentrepresentingtype: 1
x-originating-ip: [87.234.252.170]
x-ms-publictraffictype: Email
x-ms-office365-filtering-correlation-id: 7060274d-8c77-4585-7153-08d7110490d9
x-microsoft-antispam: BCL:0; PCL:0;
 RULEID:(2390118)(7020095)(4652040)(8989299)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(5600148)(711020)(4605104)(1401327)(2017052603328)(7193020);
 SRVR:BY5PR18MB3297; 
x-ms-traffictypediagnostic: BY5PR18MB3297:
x-microsoft-antispam-prvs: <BY5PR18MB329765332FA4921F3CF8E342B3C10@BY5PR18MB3297.namprd18.prod.outlook.com>
x-ms-oob-tlc-oobclassifiers: OLM:8273;
x-forefront-prvs: 0109D382B0
x-forefront-antispam-report: SFV:NSPM;
 SFS:(10019020)(4636009)(39860400002)(366004)(136003)(396003)(376002)(346002)(189003)(199004)(6436002)(53936002)(2906002)(386003)(6506007)(2501003)(86362001)(478600001)(5660300002)(64756008)(4326008)(66556008)(305945005)(6486002)(31696002)(486006)(25786009)(66066001)(6512007)(102836004)(80792005)(66946007)(5640700003)(14454004)(26005)(66446008)(7736002)(14444005)(446003)(52116002)(99286004)(76176011)(54906003)(6116002)(3846002)(31686004)(316002)(81166006)(81156014)(6916009)(8676002)(8936002)(68736007)(2616005)(66476007)(11346002)(256004)(71190400001)(71200400001)(36756003)(476003)(2351001)(186003);
 DIR:OUT; SFP:1102; SCL:1; SRVR:BY5PR18MB3297;
 H:BY5PR18MB3394.namprd18.prod.outlook.com; FPR:; SPF:None; LANG:en;
 PTR:InfoNoRecords; MX:1; A:1; 
received-spf: None (protection.outlook.com: suse.com does not designate
 permitted sender hosts)
x-ms-exchange-senderadcheck: 1
x-microsoft-antispam-message-info: xUwRFQty3UbbHKOMFna1lOQvyshRu9ScUWcMF0XJbOhmikCF4SFIRO+SbuFUBUDANDlOW/EXScdQuRSTKdVWnDgNmLGUSbNjX/nHOaAz6Qg1tKV1t4e9WyZvD+dicFgMUKcAYERt+fiFdMkwvMerZG+BfLF9j+HaWkZfgqsVOxIGU2nFRQ/zzSZsTx9BiY7z4oaOiB/Yu/CQ766lpb1j7K+zBueCaqdBY4c2E5MMUJUKhnGvGkEm+Is+b17u+ecZPk5LuQ0GnzWlfTv/Gbtw5kLKDvSKx/BLh3iXlYoB5cZh+LEQ3o2PJLVAViHXmCHBqwH9odfYFUjLoyeNhT1ntWsNqsEC6FSopQfZm7LIrCzznIW9MaQxuCGCuI48qhMj32D1z6/4oPkQ0ZJulwxeN1YjXApeoE8/coJRfzFAX+o=
Content-ID: <010D44378A2BB94BA192137589FD8D20@namprd18.prod.outlook.com>
MIME-Version: 1.0
X-MS-Exchange-CrossTenant-Network-Message-Id: 7060274d-8c77-4585-7153-08d7110490d9
X-MS-Exchange-CrossTenant-originalarrivaltime: 25 Jul 2019 13:32:40.5614 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: 856b813c-16e5-49a5-85ec-6f081e13b527
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: JBeulich@suse.com
X-MS-Exchange-Transport-CrossTenantHeadersStamped: BY5PR18MB3297
X-OriginatorOrg: suse.com
Subject: [Xen-devel] [PATCH v4 09/12] AMD/IOMMU: enable x2APIC mode when
 available
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>,
 Brian Woods <brian.woods@amd.com>,
 Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SW4gb3JkZXIgZm9yIHRoZSBDUFVzIHRvIHVzZSB4MkFQSUMgbW9kZSwgdGhlIElPTU1VKHMpIGZp
cnN0IG5lZWQgdG8gYmUNCnN3aXRjaGVkIGludG8gc3VpdGFibGUgc3RhdGUuDQoNClRoZSBwb3N0
LUFQLWJyaW5ndXAgSVJRIGFmZmluaXR5IGFkanVzdG1lbnQgaXMgZG9uZSBhbHNvIGZvciB0aGUg
bm9uLQ0KeDJBUElDIGNhc2UsIG1hdGNoaW5nIHdoYXQgVlQtZCBkb2VzLg0KDQpTaWduZWQtb2Zm
LWJ5OiBKYW4gQmV1bGljaCA8amJldWxpY2hAc3VzZS5jb20+DQpBY2tlZC1ieTogQW5kcmV3IENv
b3BlciA8YW5kcmV3LmNvb3BlcjNAY2l0cml4LmNvbT4NCkFja2VkLWJ5OiBCcmlhbiBXb29kcyA8
YnJpYW4ud29vZHNAYW1kLmNvbT4NCi0tLQ0KdjQ6IFJlLWJhc2UuDQp2MzogU2V0IEdBRW4gKGFu
ZCBvdGhlciBjb250cm9sIHJlZ2lzdGVyIGJpdHMpIGVhcmxpZXIuIEFsc28gY2xlYXIgdGhlDQog
ICAgIGJpdHMgZW5hYmxlZCBoZXJlIGluIGFtZF9pb21tdV9pbml0X2NsZWFudXAoKS4gUmUtYmFz
ZS4gUGFzcyBOVUxMDQogICAgIENQVSBtYXNrIHRvIHNldF97eDJhcGljLG1zaX1fYWZmaW5pdHko
KS4NCnYyOiBEcm9wIGNwdV9oYXNfY3gxNiBjaGVjay4gQWRkIGNvbW1lbnQuDQotLS0NClRCRDog
SW5zdGVhZCBvZiB0aGUgc3lzdGVtX3N0YXRlIGNoZWNrIGluIGlvdl9lbmFibGVfeHQoKSB0aGUg
ZnVuY3Rpb24NCiAgICAgIGNvdWxkIGFsc28gemFwIGl0cyBvd24gaG9vayBwb2ludGVyLCBhdCB3
aGljaCBwb2ludCBpdCBjb3VsZCBhbHNvDQogICAgICBiZWNvbWUgX19pbml0LiBUaGlzIHdvdWxk
LCBob3dldmVyLCByZXF1aXJlIHRoYXQgZWl0aGVyDQogICAgICByZXN1bWVfeDJhcGljKCkgYmUg
Ym91bmQgdG8gaWdub3JlIGlvbW11X2VuYWJsZV94MmFwaWMoKSBlcnJvcnMNCiAgICAgIGZvcmV2
ZXIsIG9yIHRoYXQgaW9tbXVfZW5hYmxlX3gyYXBpYygpIGJlIHNsaWdodGx5IHJlLWFycmFuZ2Vk
IHRvDQogICAgICBub3QgcmV0dXJuIC1FT1BOT1RTVVBQIHdoZW4gZmluZGluZyBhIE5VTEwgaG9v
ayBkdXJpbmcgcmVzdW1lLg0KDQotLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9t
bXVfaW5pdC5jDQorKysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfaW5pdC5j
DQpAQCAtODMzLDYgKzgzMywzMCBAQCBzdGF0aWMgYm9vbF90IF9faW5pdCBzZXRfaW9tbXVfaW50
ZXJydXB0DQogICAgICByZXR1cm4gMTsNCiAgfQ0KICANCitpbnQgaW92X2FkanVzdF9pcnFfYWZm
aW5pdGllcyh2b2lkKQ0KK3sNCisgICAgY29uc3Qgc3RydWN0IGFtZF9pb21tdSAqaW9tbXU7DQor
DQorICAgIGlmICggIWlvbW11X2VuYWJsZWQgKQ0KKyAgICAgICAgcmV0dXJuIDA7DQorDQorICAg
IGZvcl9lYWNoX2FtZF9pb21tdSAoIGlvbW11ICkNCisgICAgew0KKyAgICAgICAgc3RydWN0IGly
cV9kZXNjICpkZXNjID0gaXJxX3RvX2Rlc2MoaW9tbXUtPm1zaS5pcnEpOw0KKyAgICAgICAgdW5z
aWduZWQgbG9uZyBmbGFnczsNCisNCisgICAgICAgIHNwaW5fbG9ja19pcnFzYXZlKCZkZXNjLT5s
b2NrLCBmbGFncyk7DQorICAgICAgICBpZiAoIGlvbW11LT5jdHJsLmludF9jYXBfeHRfZW4gKQ0K
KyAgICAgICAgICAgIHNldF94MmFwaWNfYWZmaW5pdHkoZGVzYywgTlVMTCk7DQorICAgICAgICBl
bHNlDQorICAgICAgICAgICAgc2V0X21zaV9hZmZpbml0eShkZXNjLCBOVUxMKTsNCisgICAgICAg
IHNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmRlc2MtPmxvY2ssIGZsYWdzKTsNCisgICAgfQ0KKw0K
KyAgICByZXR1cm4gMDsNCit9DQorX19pbml0Y2FsbChpb3ZfYWRqdXN0X2lycV9hZmZpbml0aWVz
KTsNCisNCiAgLyoNCiAgICogRmFtaWx5MTVoIE1vZGVsIDEwaC0xZmggZXJyYXR1bSA3NDYgKElP
TU1VIExvZ2dpbmcgTWF5IFN0YWxsIFRyYW5zbGF0aW9ucykNCiAgICogV29ya2Fyb3VuZDoNCkBA
IC0xMDQ2LDcgKzEwNzAsNyBAQCBzdGF0aWMgdm9pZCAqIF9faW5pdCBhbGxvY2F0ZV9wcHJfbG9n
KHN0DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSU9NTVVfUFBSX0xPR19ERUZB
VUxUX0VOVFJJRVMsICJQUFIgTG9nIik7DQogIH0NCiAgDQotc3RhdGljIGludCBfX2luaXQgYW1k
X2lvbW11X2luaXRfb25lKHN0cnVjdCBhbWRfaW9tbXUgKmlvbW11KQ0KK3N0YXRpYyBpbnQgX19p
bml0IGFtZF9pb21tdV9pbml0X29uZShzdHJ1Y3QgYW1kX2lvbW11ICppb21tdSwgYm9vbCBpbnRy
KQ0KICB7DQogICAgICBpZiAoIGFsbG9jYXRlX2NtZF9idWZmZXIoaW9tbXUpID09IE5VTEwgKQ0K
ICAgICAgICAgIGdvdG8gZXJyb3Jfb3V0Ow0KQEAgLTEwNTcsNyArMTA4MSw3IEBAIHN0YXRpYyBp
bnQgX19pbml0IGFtZF9pb21tdV9pbml0X29uZShzdHINCiAgICAgIGlmICggaW9tbXUtPmZlYXR1
cmVzLmZsZHMucHByX3N1cCAmJiAhYWxsb2NhdGVfcHByX2xvZyhpb21tdSkgKQ0KICAgICAgICAg
IGdvdG8gZXJyb3Jfb3V0Ow0KICANCi0gICAgaWYgKCAhc2V0X2lvbW11X2ludGVycnVwdF9oYW5k
bGVyKGlvbW11KSApDQorICAgIGlmICggaW50ciAmJiAhc2V0X2lvbW11X2ludGVycnVwdF9oYW5k
bGVyKGlvbW11KSApDQogICAgICAgICAgZ290byBlcnJvcl9vdXQ7DQogIA0KICAgICAgLyogVG8g
bWFrZSBzdXJlIHRoYXQgZGV2aWNlX3RhYmxlLmJ1ZmZlciBoYXMgYmVlbiBzdWNjZXNzZnVsbHkg
YWxsb2NhdGVkICovDQpAQCAtMTA4Niw4ICsxMTEwLDE2IEBAIHN0YXRpYyB2b2lkIF9faW5pdCBh
bWRfaW9tbXVfaW5pdF9jbGVhbnUNCiAgICAgIGxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZSAoIGlv
bW11LCBuZXh0LCAmYW1kX2lvbW11X2hlYWQsIGxpc3QgKQ0KICAgICAgew0KICAgICAgICAgIGxp
c3RfZGVsKCZpb21tdS0+bGlzdCk7DQorDQorICAgICAgICBpb21tdS0+Y3RybC5nYV9lbiA9IDA7
DQorICAgICAgICBpb21tdS0+Y3RybC54dF9lbiA9IDA7DQorICAgICAgICBpb21tdS0+Y3RybC5p
bnRfY2FwX3h0X2VuID0gMDsNCisNCiAgICAgICAgICBpZiAoIGlvbW11LT5lbmFibGVkICkNCiAg
ICAgICAgICAgICAgZGlzYWJsZV9pb21tdShpb21tdSk7DQorICAgICAgICBlbHNlIGlmICggaW9t
bXUtPm1taW9fYmFzZSApDQorICAgICAgICAgICAgd3JpdGVxKGlvbW11LT5jdHJsLnJhdywNCisg
ICAgICAgICAgICAgICAgICAgaW9tbXUtPm1taW9fYmFzZSArIElPTU1VX0NPTlRST0xfTU1JT19P
RkZTRVQpOw0KICANCiAgICAgICAgICBkZWFsbG9jYXRlX3JpbmdfYnVmZmVyKCZpb21tdS0+Y21k
X2J1ZmZlcik7DQogICAgICAgICAgZGVhbGxvY2F0ZV9yaW5nX2J1ZmZlcigmaW9tbXUtPmV2ZW50
X2xvZyk7DQpAQCAtMTI4OSw3ICsxMzIxLDcgQEAgc3RhdGljIGludCBfX2luaXQgYW1kX2lvbW11
X3ByZXBhcmVfb25lKA0KICAgICAgcmV0dXJuIDA7DQogIH0NCiAgDQotaW50IF9faW5pdCBhbWRf
aW9tbXVfaW5pdCh2b2lkKQ0KK2ludCBfX2luaXQgYW1kX2lvbW11X3ByZXBhcmUoYm9vbCB4dCkN
CiAgew0KICAgICAgc3RydWN0IGFtZF9pb21tdSAqaW9tbXU7DQogICAgICBpbnQgcmMgPSAtRU5P
REVWOw0KQEAgLTEzMDQsOSArMTMzNiwxNCBAQCBpbnQgX19pbml0IGFtZF9pb21tdV9pbml0KHZv
aWQpDQogICAgICBpZiAoIHVubGlrZWx5KGFjcGlfZ2JsX0ZBRFQuYm9vdF9mbGFncyAmIEFDUElf
RkFEVF9OT19NU0kpICkNCiAgICAgICAgICBnb3RvIGVycm9yX291dDsNCiAgDQorICAgIC8qIEhh
dmUgd2UgYmVlbiBoZXJlIGJlZm9yZT8gKi8NCisgICAgaWYgKCBpdmhkX3R5cGUgKQ0KKyAgICAg
ICAgcmV0dXJuIDA7DQorDQogICAgICByYyA9IGFtZF9pb21tdV9nZXRfc3VwcG9ydGVkX2l2aGRf
dHlwZSgpOw0KICAgICAgaWYgKCByYyA8IDAgKQ0KICAgICAgICAgIGdvdG8gZXJyb3Jfb3V0Ow0K
KyAgICBCVUdfT04oIXJjKTsNCiAgICAgIGl2aGRfdHlwZSA9IHJjOw0KICANCiAgICAgIHJjID0g
YW1kX2lvbW11X2dldF9pdnJzX2Rldl9lbnRyaWVzKCk7DQpAQCAtMTMyMiw5ICsxMzU5LDM3IEBA
IGludCBfX2luaXQgYW1kX2lvbW11X2luaXQodm9pZCkNCiAgICAgICAgICByYyA9IGFtZF9pb21t
dV9wcmVwYXJlX29uZShpb21tdSk7DQogICAgICAgICAgaWYgKCByYyApDQogICAgICAgICAgICAg
IGdvdG8gZXJyb3Jfb3V0Ow0KKw0KKyAgICAgICAgcmMgPSAtRU5PREVWOw0KKyAgICAgICAgaWYg
KCB4dCAmJiAoIWlvbW11LT5mZWF0dXJlcy5mbGRzLmdhX3N1cCB8fCAhaW9tbXUtPmZlYXR1cmVz
LmZsZHMueHRfc3VwKSApDQorICAgICAgICAgICAgZ290byBlcnJvcl9vdXQ7DQorICAgIH0NCisN
CisgICAgZm9yX2VhY2hfYW1kX2lvbW11ICggaW9tbXUgKQ0KKyAgICB7DQorICAgICAgICAvKiBO
QjogVGhlcmUncyBubyBuZWVkIHRvIGFjdHVhbGx5IHdyaXRlIHRoZXNlIG91dCByaWdodCBoZXJl
LiAqLw0KKyAgICAgICAgaW9tbXUtPmN0cmwuZ2FfZW4gfD0geHQ7DQorICAgICAgICBpb21tdS0+
Y3RybC54dF9lbiA9IHh0Ow0KKyAgICAgICAgaW9tbXUtPmN0cmwuaW50X2NhcF94dF9lbiA9IHh0
Ow0KICAgICAgfQ0KICANCiAgICAgIHJjID0gYW1kX2lvbW11X3VwZGF0ZV9pdnJzX21hcHBpbmdf
YWNwaSgpOw0KKw0KKyBlcnJvcl9vdXQ6DQorICAgIGlmICggcmMgKQ0KKyAgICB7DQorICAgICAg
ICBhbWRfaW9tbXVfaW5pdF9jbGVhbnVwKCk7DQorICAgICAgICBpdmhkX3R5cGUgPSAwOw0KKyAg
ICB9DQorDQorICAgIHJldHVybiByYzsNCit9DQorDQoraW50IF9faW5pdCBhbWRfaW9tbXVfaW5p
dChib29sIHh0KQ0KK3sNCisgICAgc3RydWN0IGFtZF9pb21tdSAqaW9tbXU7DQorICAgIGludCBy
YyA9IGFtZF9pb21tdV9wcmVwYXJlKHh0KTsNCisNCiAgICAgIGlmICggcmMgKQ0KICAgICAgICAg
IGdvdG8gZXJyb3Jfb3V0Ow0KICANCkBAIC0xMzUwLDcgKzE0MTUsMTIgQEAgaW50IF9faW5pdCBh
bWRfaW9tbXVfaW5pdCh2b2lkKQ0KICAgICAgLyogcGVyIGlvbW11IGluaXRpYWxpemF0aW9uICAq
Lw0KICAgICAgZm9yX2VhY2hfYW1kX2lvbW11ICggaW9tbXUgKQ0KICAgICAgew0KLSAgICAgICAg
cmMgPSBhbWRfaW9tbXVfaW5pdF9vbmUoaW9tbXUpOw0KKyAgICAgICAgLyoNCisgICAgICAgICAq
IFNldHRpbmcgdXAgb2YgdGhlIElPTU1VIGludGVycnVwdHMgY2Fubm90IG9jY3VyIHlldCBhdCB0
aGUgKHZlcnkNCisgICAgICAgICAqIGVhcmx5KSB0aW1lIHdlIGdldCBoZXJlIHdoZW4gZW5hYmxp
bmcgeDJBUElDIG1vZGUuIFN1cHByZXNzIGl0DQorICAgICAgICAgKiBoZXJlLCBhbmQgZG8gaXQg
ZXhwbGljaXRseSBpbiBhbWRfaW9tbXVfaW5pdF9pbnRlcnJ1cHQoKS4NCisgICAgICAgICAqLw0K
KyAgICAgICAgcmMgPSBhbWRfaW9tbXVfaW5pdF9vbmUoaW9tbXUsICF4dCk7DQogICAgICAgICAg
aWYgKCByYyApDQogICAgICAgICAgICAgIGdvdG8gZXJyb3Jfb3V0Ow0KICAgICAgfQ0KQEAgLTEz
NjIsNiArMTQzMiw0MCBAQCBlcnJvcl9vdXQ6DQogICAgICByZXR1cm4gcmM7DQogIH0NCiAgDQor
aW50IF9faW5pdCBhbWRfaW9tbXVfaW5pdF9pbnRlcnJ1cHQodm9pZCkNCit7DQorICAgIHN0cnVj
dCBhbWRfaW9tbXUgKmlvbW11Ow0KKyAgICBpbnQgcmMgPSAwOw0KKw0KKyAgICBmb3JfZWFjaF9h
bWRfaW9tbXUgKCBpb21tdSApDQorICAgIHsNCisgICAgICAgIHN0cnVjdCBpcnFfZGVzYyAqZGVz
YzsNCisNCisgICAgICAgIGlmICggIXNldF9pb21tdV9pbnRlcnJ1cHRfaGFuZGxlcihpb21tdSkg
KQ0KKyAgICAgICAgew0KKyAgICAgICAgICAgIHJjID0gLUVJTzsNCisgICAgICAgICAgICBicmVh
azsNCisgICAgICAgIH0NCisNCisgICAgICAgIGRlc2MgPSBpcnFfdG9fZGVzYyhpb21tdS0+bXNp
LmlycSk7DQorDQorICAgICAgICBzcGluX2xvY2soJmRlc2MtPmxvY2spOw0KKyAgICAgICAgQVNT
RVJUKGlvbW11LT5jdHJsLmludF9jYXBfeHRfZW4pOw0KKyAgICAgICAgc2V0X3gyYXBpY19hZmZp
bml0eShkZXNjLCAmY3B1X29ubGluZV9tYXApOw0KKyAgICAgICAgc3Bpbl91bmxvY2soJmRlc2Mt
PmxvY2spOw0KKw0KKyAgICAgICAgc2V0X2lvbW11X2V2ZW50X2xvZ19jb250cm9sKGlvbW11LCBJ
T01NVV9DT05UUk9MX0VOQUJMRUQpOw0KKw0KKyAgICAgICAgaWYgKCBpb21tdS0+ZmVhdHVyZXMu
Zmxkcy5wcHJfc3VwICkNCisgICAgICAgICAgICBzZXRfaW9tbXVfcHByX2xvZ19jb250cm9sKGlv
bW11LCBJT01NVV9DT05UUk9MX0VOQUJMRUQpOw0KKyAgICB9DQorDQorICAgIGlmICggcmMgKQ0K
KyAgICAgICAgYW1kX2lvbW11X2luaXRfY2xlYW51cCgpOw0KKw0KKyAgICByZXR1cm4gcmM7DQor
fQ0KKw0KICBzdGF0aWMgdm9pZCBpbnZhbGlkYXRlX2FsbF9kb21haW5fcGFnZXModm9pZCkNCiAg
ew0KICAgICAgc3RydWN0IGRvbWFpbiAqZDsNCi0tLSBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdo
L2FtZC9pb21tdV9pbnRyLmMNCisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9pb21t
dV9pbnRyLmMNCkBAIC03OTksNiArNzk5LDM1IEBAIHZvaWQgKl9faW5pdCBhbWRfaW9tbXVfYWxs
b2NfaW50cmVtYXBfdGENCiAgICAgIHJldHVybiB0YjsNCiAgfQ0KICANCitib29sIF9faW5pdCBp
b3Zfc3VwcG9ydHNfeHQodm9pZCkNCit7DQorICAgIHVuc2lnbmVkIGludCBhcGljOw0KKw0KKyAg
ICBpZiAoICFpb21tdV9lbmFibGUgfHwgIWlvbW11X2ludHJlbWFwICkNCisgICAgICAgIHJldHVy
biBmYWxzZTsNCisNCisgICAgaWYgKCBhbWRfaW9tbXVfcHJlcGFyZSh0cnVlKSApDQorICAgICAg
ICByZXR1cm4gZmFsc2U7DQorDQorICAgIGZvciAoIGFwaWMgPSAwOyBhcGljIDwgbnJfaW9hcGlj
czsgYXBpYysrICkNCisgICAgew0KKyAgICAgICAgdW5zaWduZWQgaW50IGlkeCA9IGlvYXBpY19p
ZF90b19pbmRleChJT19BUElDX0lEKGFwaWMpKTsNCisNCisgICAgICAgIGlmICggaWR4ID09IE1B
WF9JT19BUElDUyApDQorICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KKw0KKyAgICAgICAgaWYg
KCAhZmluZF9pb21tdV9mb3JfZGV2aWNlKGlvYXBpY19zYmRmW2lkeF0uc2VnLA0KKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlvYXBpY19zYmRmW2lkeF0uYmRmKSApDQorICAg
ICAgICB7DQorICAgICAgICAgICAgQU1EX0lPTU1VX0RFQlVHKCJObyBJT01NVSBmb3IgSU8tQVBJ
QyAlI3ggKElEICV4KVxuIiwNCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBpYywgSU9f
QVBJQ19JRChhcGljKSk7DQorICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KKyAgICAgICAgfQ0K
KyAgICB9DQorDQorICAgIHJldHVybiB0cnVlOw0KK30NCisNCiAgaW50IF9faW5pdCBhbWRfc2V0
dXBfaHBldF9tc2koc3RydWN0IG1zaV9kZXNjICptc2lfZGVzYykNCiAgew0KICAgICAgc3Bpbmxv
Y2tfdCAqbG9jazsNCi0tLSBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9wY2lfYW1kX2lv
bW11LmMNCisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9wY2lfYW1kX2lvbW11LmMN
CkBAIC0xNzAsNyArMTcwLDggQEAgc3RhdGljIGludCBfX2luaXQgaW92X2RldGVjdCh2b2lkKQ0K
ICAgICAgaWYgKCAhaW9tbXVfZW5hYmxlICYmICFpb21tdV9pbnRyZW1hcCApDQogICAgICAgICAg
cmV0dXJuIDA7DQogIA0KLSAgICBpZiAoIGFtZF9pb21tdV9pbml0KCkgIT0gMCApDQorICAgIGVs
c2UgaWYgKCAoaW5pdF9kb25lID8gYW1kX2lvbW11X2luaXRfaW50ZXJydXB0KCkNCisgICAgICAg
ICAgICAgICAgICAgICAgICAgOiBhbWRfaW9tbXVfaW5pdChmYWxzZSkpICE9IDAgKQ0KICAgICAg
ew0KICAgICAgICAgIHByaW50aygiQU1ELVZpOiBFcnJvciBpbml0aWFsaXphdGlvblxuIik7DQog
ICAgICAgICAgcmV0dXJuIC1FTk9ERVY7DQpAQCAtMTg0LDYgKzE4NSwyNSBAQCBzdGF0aWMgaW50
IF9faW5pdCBpb3ZfZGV0ZWN0KHZvaWQpDQogICAgICByZXR1cm4gMDsNCiAgfQ0KICANCitzdGF0
aWMgaW50IGlvdl9lbmFibGVfeHQodm9pZCkNCit7DQorICAgIGludCByYzsNCisNCisgICAgaWYg
KCBzeXN0ZW1fc3RhdGUgPj0gU1lTX1NUQVRFX2FjdGl2ZSApDQorICAgICAgICByZXR1cm4gMDsN
CisNCisgICAgaWYgKCAocmMgPSBhbWRfaW9tbXVfaW5pdCh0cnVlKSkgIT0gMCApDQorICAgIHsN
CisgICAgICAgIHByaW50aygiQU1ELVZpOiBFcnJvciAlZCBpbml0aWFsaXppbmcgZm9yIHgyQVBJ
QyBtb2RlXG4iLCByYyk7DQorICAgICAgICAvKiAtRU5YSU8gaGFzIHNwZWNpYWwgbWVhbmluZyB0
byB0aGUgY2FsbGVyIC0gY29udmVydCBpdC4gKi8NCisgICAgICAgIHJldHVybiByYyAhPSAtRU5Y
SU8gPyByYyA6IC1FTk9EQVRBOw0KKyAgICB9DQorDQorICAgIGluaXRfZG9uZSA9IHRydWU7DQor
DQorICAgIHJldHVybiAwOw0KK30NCisNCiAgaW50IGFtZF9pb21tdV9hbGxvY19yb290KHN0cnVj
dCBkb21haW5faW9tbXUgKmhkKQ0KICB7DQogICAgICBpZiAoIHVubGlrZWx5KCFoZC0+YXJjaC5y
b290X3RhYmxlKSApDQpAQCAtNTU3LDExICs1NzcsMTMgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBp
b21tdV9vcHMgX19pbml0Y29ucw0KICAgICAgLmZyZWVfcGFnZV90YWJsZSA9IGRlYWxsb2NhdGVf
cGFnZV90YWJsZSwNCiAgICAgIC5yZWFzc2lnbl9kZXZpY2UgPSByZWFzc2lnbl9kZXZpY2UsDQog
ICAgICAuZ2V0X2RldmljZV9ncm91cF9pZCA9IGFtZF9pb21tdV9ncm91cF9pZCwNCisgICAgLmVu
YWJsZV94MmFwaWMgPSBpb3ZfZW5hYmxlX3h0LA0KICAgICAgLnVwZGF0ZV9pcmVfZnJvbV9hcGlj
ID0gYW1kX2lvbW11X2lvYXBpY191cGRhdGVfaXJlLA0KICAgICAgLnVwZGF0ZV9pcmVfZnJvbV9t
c2kgPSBhbWRfaW9tbXVfbXNpX21zZ191cGRhdGVfaXJlLA0KICAgICAgLnJlYWRfYXBpY19mcm9t
X2lyZSA9IGFtZF9pb21tdV9yZWFkX2lvYXBpY19mcm9tX2lyZSwNCiAgICAgIC5yZWFkX21zaV9m
cm9tX2lyZSA9IGFtZF9pb21tdV9yZWFkX21zaV9mcm9tX2lyZSwNCiAgICAgIC5zZXR1cF9ocGV0
X21zaSA9IGFtZF9zZXR1cF9ocGV0X21zaSwNCisgICAgLmFkanVzdF9pcnFfYWZmaW5pdGllcyA9
IGlvdl9hZGp1c3RfaXJxX2FmZmluaXRpZXMsDQogICAgICAuc3VzcGVuZCA9IGFtZF9pb21tdV9z
dXNwZW5kLA0KICAgICAgLnJlc3VtZSA9IGFtZF9pb21tdV9yZXN1bWUsDQogICAgICAuY3Jhc2hf
c2h1dGRvd24gPSBhbWRfaW9tbXVfY3Jhc2hfc2h1dGRvd24sDQpAQCAtNTcxLDQgKzU5Myw1IEBA
IHN0YXRpYyBjb25zdCBzdHJ1Y3QgaW9tbXVfb3BzIF9faW5pdGNvbnMNCiAgc3RhdGljIGNvbnN0
IHN0cnVjdCBpb21tdV9pbml0X29wcyBfX2luaXRjb25zdHJlbCBfaW9tbXVfaW5pdF9vcHMgPSB7
DQogICAgICAub3BzID0gJl9pb21tdV9vcHMsDQogICAgICAuc2V0dXAgPSBpb3ZfZGV0ZWN0LA0K
KyAgICAuc3VwcG9ydHNfeDJhcGljID0gaW92X3N1cHBvcnRzX3h0LA0KICB9Ow0KLS0tIGEveGVu
L2luY2x1ZGUvYXNtLXg4Ni9odm0vc3ZtL2FtZC1pb21tdS1wcm90by5oDQorKysgYi94ZW4vaW5j
bHVkZS9hc20teDg2L2h2bS9zdm0vYW1kLWlvbW11LXByb3RvLmgNCkBAIC00OCw4ICs0OCwxMSBA
QCBpbnQgYW1kX2lvbW11X2RldGVjdF9hY3BpKHZvaWQpOw0KICB2b2lkIGdldF9pb21tdV9mZWF0
dXJlcyhzdHJ1Y3QgYW1kX2lvbW11ICppb21tdSk7DQogIA0KICAvKiBhbWQtaW9tbXUtaW5pdCBm
dW5jdGlvbnMgKi8NCi1pbnQgYW1kX2lvbW11X2luaXQodm9pZCk7DQoraW50IGFtZF9pb21tdV9w
cmVwYXJlKGJvb2wgeHQpOw0KK2ludCBhbWRfaW9tbXVfaW5pdChib29sIHh0KTsNCitpbnQgYW1k
X2lvbW11X2luaXRfaW50ZXJydXB0KHZvaWQpOw0KICBpbnQgYW1kX2lvbW11X3VwZGF0ZV9pdnJz
X21hcHBpbmdfYWNwaSh2b2lkKTsNCitpbnQgaW92X2FkanVzdF9pcnFfYWZmaW5pdGllcyh2b2lk
KTsNCiAgDQogIC8qIG1hcHBpbmcgZnVuY3Rpb25zICovDQogIGludCBfX211c3RfY2hlY2sgYW1k
X2lvbW11X21hcF9wYWdlKHN0cnVjdCBkb21haW4gKmQsIGRmbl90IGRmbiwNCkBAIC05Myw2ICs5
Niw3IEBAIHZvaWQgYW1kX2lvbW11X2ZsdXNoX2FsbF9jYWNoZXMoc3RydWN0IGENCiAgc3RydWN0
IGFtZF9pb21tdSAqZmluZF9pb21tdV9mb3JfZGV2aWNlKGludCBzZWcsIGludCBiZGYpOw0KICAN
CiAgLyogaW50ZXJydXB0IHJlbWFwcGluZyAqLw0KK2Jvb2wgaW92X3N1cHBvcnRzX3h0KHZvaWQp
Ow0KICBpbnQgYW1kX2lvbW11X3NldHVwX2lvYXBpY19yZW1hcHBpbmcodm9pZCk7DQogIHZvaWQg
KmFtZF9pb21tdV9hbGxvY19pbnRyZW1hcF90YWJsZSgNCiAgICAgIGNvbnN0IHN0cnVjdCBhbWRf
aW9tbXUgKiwgdW5zaWduZWQgbG9uZyAqKik7DQoNCl9fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxp
c3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9s
aXN0aW5mby94ZW4tZGV2ZWw=

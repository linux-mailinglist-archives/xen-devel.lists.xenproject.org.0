Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id D42C187DB7
	for <lists+xen-devel@lfdr.de>; Fri,  9 Aug 2019 17:06:39 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hw6Qa-00041n-RO; Fri, 09 Aug 2019 15:03:36 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=yG4W=WF=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1hw6QZ-00041I-H5
 for xen-devel@lists.xenproject.org; Fri, 09 Aug 2019 15:03:35 +0000
X-Inumbo-ID: 2f4bfafe-bab6-11e9-8980-bc764e045a96
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 2f4bfafe-bab6-11e9-8980-bc764e045a96;
 Fri, 09 Aug 2019 14:58:45 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id D790DB035;
 Fri,  9 Aug 2019 14:58:44 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Fri,  9 Aug 2019 16:58:05 +0200
Message-Id: <20190809145833.1020-21-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190809145833.1020-1-jgross@suse.com>
References: <20190809145833.1020-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v2 20/48] xen: let vcpu_create() select processor
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>,
 Dario Faggioli <dfaggioli@suse.com>,
 Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VG9kYXkgdGhlcmUgYXJlIHR3byBkaXN0aW5jdCBzY2VuYXJpb3MgZm9yIHZjcHVfY3JlYXRlKCk6
IGVpdGhlciBmb3IKY3JlYXRpb24gb2YgaWRsZS1kb21haW4gdmNwdXMgKHZjcHVpZCA9PSBwcm9j
ZXNzb3IpIG9yIGZvciBjcmVhdGlvbiBvZgoibm9ybWFsIiBkb21haW4gdmNwdXMgKGluY2x1ZGlu
ZyBkb20wKSwgd2hlcmUgdGhlIGNhbGxlciBzZWxlY3RzIHRoZQppbml0aWFsIHByb2Nlc3NvciBv
biBhIHJvdW5kLXJvYmluIHNjaGVtZSBvZiB0aGUgYWxsb3dlZCBwcm9jZXNzb3JzCihhbGxvd2Vk
IGJlaW5nIGJhc2VkIG9uIGNwdXBvb2wgYW5kIGFmZmluaXRpZXMpLgoKSW5zdGVhZCBvZiBwYXNz
aW5nIHRoZSBpbml0aWFsIHByb2Nlc3NvciB0byB2Y3B1X2NyZWF0ZSgpIGFuZCBwYXNzaW5nCm9u
IHRvIHNjaGVkX2luaXRfdmNwdSgpIGxldCBzY2hlZF9pbml0X3ZjcHUoKSBkbyB0aGUgcHJvY2Vz
c29yCnNlbGVjdGlvbi4gRm9yIHN1cHBvcnRpbmcgZG9tMCB2Y3B1IGNyZWF0aW9uIHVzZSB0aGUg
bm9kZV9hZmZpbml0eSBvZgp0aGUgZG9tYWluIGFzIGEgYmFzZSBmb3Igc2VsZWN0aW5nIHRoZSBw
cm9jZXNzb3JzLiBVc2VyIGRvbWFpbnMgd2lsbApoYXZlIGluaXRpYWxseSBhbGwgbm9kZXMgc2V0
LCBzbyB0aGlzIGlzIG5vIGRpZmZlcmVudCBiZWhhdmlvciBjb21wYXJlZAp0byB0b2RheS4gSW4g
dGhlb3J5IHRoaXMgaXMgbm90IGd1YXJhbnRlZWQgYXMgdmNwdXMgYXJlIGNyZWF0ZWQgb25seQp3
aXRoIFhFTl9ET01DVExfbWF4X3ZjcHVzIGJlaW5nIGNhbGxlZCwgYnV0IHRoaXMgY2FsbCBpcyBn
b2luZyB0byBiZQpyZW1vdmVkIGluIGZ1dHVyZSBhbmQgdGhlIHRvb2xzdGFjayBkb2Vzbid0IGNh
bGwKWEVOX0RPTUNUTF9zZXRub2RlYWZmaW5pdHkgYmVmb3JlIGNhbGxpbmcgWEVOX0RPTUNUTF9t
YXhfdmNwdXMuCgpUbyBiZSBhYmxlIHRvIHVzZSBjb25zdCBzdHJ1Y3QgZG9tYWluICogbWFrZSBj
cHVwb29sX2RvbWFpbl9jcHVtYXNrKCkKdGFrZSBhIGNvbnN0IGRvbWFpbiBwb2ludGVyLCB0b28u
CgpTaWduZWQtb2ZmLWJ5OiBKdWVyZ2VuIEdyb3NzIDxqZ3Jvc3NAc3VzZS5jb20+CkFja2VkLWJ5
OiBBbmRyZXcgQ29vcGVyIDxhbmRyZXcuY29vcGVyM0BjaXRyaXguY29tPgotLS0KUkZDIFYyOiBh
ZGQgQVNTRVJUKCksIG1vZGlmeSBlcnJvciBtZXNzYWdlIChBbmRyZXcgQ29vcGVyKQpWMTogY29u
c3RpZnkgcG9pbnRlcnMsIGF2b2lkIGNwdW1hc2sgb24gc3RhY2sgKEphbiBCZXVsaWNoKQotLS0K
IHhlbi9hcmNoL2FybS9kb21haW5fYnVpbGQuYyAgICAgIHwgMTMgKysrKysrLS0tLS0tCiB4ZW4v
YXJjaC94ODYvZG9tMF9idWlsZC5jICAgICAgICB8IDEwICsrKy0tLS0tLQogeGVuL2FyY2gveDg2
L2h2bS9kb20wX2J1aWxkLmMgICAgfCAgOSArKy0tLS0tLQogeGVuL2FyY2gveDg2L3B2L2RvbTBf
YnVpbGQuYyAgICAgfCAxMCArKy0tLS0tLS0KIHhlbi9jb21tb24vZG9tYWluLmMgICAgICAgICAg
ICAgIHwgIDUgKystLS0KIHhlbi9jb21tb24vZG9tY3RsLmMgICAgICAgICAgICAgIHwgMTAgKyst
LS0tLS0tCiB4ZW4vY29tbW9uL3NjaGVkdWxlLmMgICAgICAgICAgICB8IDQ0ICsrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKystLS0KIHhlbi9pbmNsdWRlL2FzbS14ODYvZG9tMF9i
dWlsZC5oIHwgIDMgKy0tCiB4ZW4vaW5jbHVkZS94ZW4vZG9tYWluLmggICAgICAgICB8ICAzICst
LQogeGVuL2luY2x1ZGUveGVuL3NjaGVkLWlmLmggICAgICAgfCAgMiArLQogeGVuL2luY2x1ZGUv
eGVuL3NjaGVkLmggICAgICAgICAgfCAgMiArLQogMTEgZmlsZXMgY2hhbmdlZCwgNjIgaW5zZXJ0
aW9ucygrKSwgNDkgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEveGVuL2FyY2gvYXJtL2RvbWFp
bl9idWlsZC5jIGIveGVuL2FyY2gvYXJtL2RvbWFpbl9idWlsZC5jCmluZGV4IDRjODQwNDE1NWEu
LjI3MDM2MTFiNDYgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL2FybS9kb21haW5fYnVpbGQuYworKysg
Yi94ZW4vYXJjaC9hcm0vZG9tYWluX2J1aWxkLmMKQEAgLTgwLDcgKzgwLDcgQEAgdW5zaWduZWQg
aW50IF9faW5pdCBkb20wX21heF92Y3B1cyh2b2lkKQogCiBzdHJ1Y3QgdmNwdSAqX19pbml0IGFs
bG9jX2RvbTBfdmNwdTAoc3RydWN0IGRvbWFpbiAqZG9tMCkKIHsKLSAgICByZXR1cm4gdmNwdV9j
cmVhdGUoZG9tMCwgMCwgMCk7CisgICAgcmV0dXJuIHZjcHVfY3JlYXRlKGRvbTAsIDApOwogfQog
CiBzdGF0aWMgdW5zaWduZWQgaW50IF9faW5pdCBnZXRfYWxsb2NhdGlvbl9zaXplKHBhZGRyX3Qg
c2l6ZSkKQEAgLTE5MzgsNyArMTkzOCw3IEBAIHN0YXRpYyB2b2lkIF9faW5pdCBmaW5kX2dudHRh
Yl9yZWdpb24oc3RydWN0IGRvbWFpbiAqZCwKIAogc3RhdGljIGludCBfX2luaXQgY29uc3RydWN0
X2RvbWFpbihzdHJ1Y3QgZG9tYWluICpkLCBzdHJ1Y3Qga2VybmVsX2luZm8gKmtpbmZvKQogewot
ICAgIGludCBpLCBjcHU7CisgICAgaW50IGk7CiAgICAgc3RydWN0IHZjcHUgKnYgPSBkLT52Y3B1
WzBdOwogICAgIHN0cnVjdCBjcHVfdXNlcl9yZWdzICpyZWdzID0gJnYtPmFyY2guY3B1X2luZm8t
Pmd1ZXN0X2NwdV91c2VyX3JlZ3M7CiAKQEAgLTIwMDEsMTIgKzIwMDEsMTEgQEAgc3RhdGljIGlu
dCBfX2luaXQgY29uc3RydWN0X2RvbWFpbihzdHJ1Y3QgZG9tYWluICpkLCBzdHJ1Y3Qga2VybmVs
X2luZm8gKmtpbmZvKQogICAgIH0KICNlbmRpZgogCi0gICAgZm9yICggaSA9IDEsIGNwdSA9IDA7
IGkgPCBkLT5tYXhfdmNwdXM7IGkrKyApCisgICAgZm9yICggaSA9IDE7IGkgPCBkLT5tYXhfdmNw
dXM7IGkrKyApCiAgICAgewotICAgICAgICBjcHUgPSBjcHVtYXNrX2N5Y2xlKGNwdSwgJmNwdV9v
bmxpbmVfbWFwKTsKLSAgICAgICAgaWYgKCB2Y3B1X2NyZWF0ZShkLCBpLCBjcHUpID09IE5VTEwg
KQorICAgICAgICBpZiAoIHZjcHVfY3JlYXRlKGQsIGkpID09IE5VTEwgKQogICAgICAgICB7Ci0g
ICAgICAgICAgICBwcmludGsoIkZhaWxlZCB0byBhbGxvY2F0ZSBkb20wIHZjcHUgJWQgb24gcGNw
dSAlZFxuIiwgaSwgY3B1KTsKKyAgICAgICAgICAgIHByaW50aygiRmFpbGVkIHRvIGFsbG9jYXRl
IGQwdiV1XG4iLCBpKTsKICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICB9CiAKQEAgLTIwNDEs
NyArMjA0MCw3IEBAIHN0YXRpYyBpbnQgX19pbml0IGNvbnN0cnVjdF9kb21VKHN0cnVjdCBkb21h
aW4gKmQsCiAKICAgICBraW5mby52cGwwMTEgPSBkdF9wcm9wZXJ0eV9yZWFkX2Jvb2wobm9kZSwg
InZwbDAxMSIpOwogCi0gICAgaWYgKCB2Y3B1X2NyZWF0ZShkLCAwLCAwKSA9PSBOVUxMICkKKyAg
ICBpZiAoIHZjcHVfY3JlYXRlKGQsIDApID09IE5VTEwgKQogICAgICAgICByZXR1cm4gLUVOT01F
TTsKICAgICBkLT5tYXhfcGFnZXMgPSB+MFU7CiAKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9k
b20wX2J1aWxkLmMgYi94ZW4vYXJjaC94ODYvZG9tMF9idWlsZC5jCmluZGV4IGM2OTU3MDkyMGMu
LjYyNjVkZDRhMWMgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9kb20wX2J1aWxkLmMKKysrIGIv
eGVuL2FyY2gveDg2L2RvbTBfYnVpbGQuYwpAQCAtMTk4LDEyICsxOTgsOSBAQCBjdXN0b21fcGFy
YW0oImRvbTBfbm9kZXMiLCBwYXJzZV9kb20wX25vZGVzKTsKIAogc3RhdGljIGNwdW1hc2tfdCBf
X2luaXRkYXRhIGRvbTBfY3B1czsKIAotc3RydWN0IHZjcHUgKl9faW5pdCBkb20wX3NldHVwX3Zj
cHUoc3RydWN0IGRvbWFpbiAqZCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHVuc2lnbmVkIGludCB2Y3B1X2lkLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgdW5zaWduZWQgaW50IHByZXZfY3B1KQorc3RydWN0IHZjcHUgKl9faW5pdCBkb20wX3NldHVw
X3ZjcHUoc3RydWN0IGRvbWFpbiAqZCwgdW5zaWduZWQgaW50IHZjcHVfaWQpCiB7Ci0gICAgdW5z
aWduZWQgaW50IGNwdSA9IGNwdW1hc2tfY3ljbGUocHJldl9jcHUsICZkb20wX2NwdXMpOwotICAg
IHN0cnVjdCB2Y3B1ICp2ID0gdmNwdV9jcmVhdGUoZCwgdmNwdV9pZCwgY3B1KTsKKyAgICBzdHJ1
Y3QgdmNwdSAqdiA9IHZjcHVfY3JlYXRlKGQsIHZjcHVfaWQpOwogCiAgICAgaWYgKCB2ICkKICAg
ICB7CkBAIC0yNzMsOCArMjcwLDcgQEAgc3RydWN0IHZjcHUgKl9faW5pdCBhbGxvY19kb20wX3Zj
cHUwKHN0cnVjdCBkb21haW4gKmRvbTApCiAgICAgZG9tMC0+bm9kZV9hZmZpbml0eSA9IGRvbTBf
bm9kZXM7CiAgICAgZG9tMC0+YXV0b19ub2RlX2FmZmluaXR5ID0gIWRvbTBfbnJfcHhtczsKIAot
ICAgIHJldHVybiBkb20wX3NldHVwX3ZjcHUoZG9tMCwgMCwKLSAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGNwdW1hc2tfbGFzdCgmZG9tMF9jcHVzKSAvKiBzbyBpdCB3cmFwcyBhcm91bmQgdG8g
Zmlyc3QgcGNwdSAqLyk7CisgICAgcmV0dXJuIGRvbTBfc2V0dXBfdmNwdShkb20wLCAwKTsKIH0K
IAogI2lmZGVmIENPTkZJR19TSEFET1dfUEFHSU5HCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYv
aHZtL2RvbTBfYnVpbGQuYyBiL3hlbi9hcmNoL3g4Ni9odm0vZG9tMF9idWlsZC5jCmluZGV4IDg4
NDUzOTlhZTkuLmZkOGQ5NjA5YjEgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9odm0vZG9tMF9i
dWlsZC5jCisrKyBiL3hlbi9hcmNoL3g4Ni9odm0vZG9tMF9idWlsZC5jCkBAIC02MTQsNyArNjE0
LDcgQEAgc3RhdGljIGludCBfX2luaXQgcHZoX3NldHVwX2NwdXMoc3RydWN0IGRvbWFpbiAqZCwg
cGFkZHJfdCBlbnRyeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZGRyX3Qg
c3RhcnRfaW5mbykKIHsKICAgICBzdHJ1Y3QgdmNwdSAqdiA9IGQtPnZjcHVbMF07Ci0gICAgdW5z
aWduZWQgaW50IGNwdSA9IHYtPnByb2Nlc3NvciwgaTsKKyAgICB1bnNpZ25lZCBpbnQgaTsKICAg
ICBpbnQgcmM7CiAgICAgLyoKICAgICAgKiBUaGlzIHNldHMgdGhlIHZDUFUgc3RhdGUgYWNjb3Jk
aW5nIHRvIHRoZSBzdGF0ZSBkZXNjcmliZWQgaW4KQEAgLTYzNiwxMiArNjM2LDcgQEAgc3RhdGlj
IGludCBfX2luaXQgcHZoX3NldHVwX2NwdXMoc3RydWN0IGRvbWFpbiAqZCwgcGFkZHJfdCBlbnRy
eSwKICAgICB9OwogCiAgICAgZm9yICggaSA9IDE7IGkgPCBkLT5tYXhfdmNwdXM7IGkrKyApCi0g
ICAgewotICAgICAgICBjb25zdCBzdHJ1Y3QgdmNwdSAqcCA9IGRvbTBfc2V0dXBfdmNwdShkLCBp
LCBjcHUpOwotCi0gICAgICAgIGlmICggcCApCi0gICAgICAgICAgICBjcHUgPSBwLT5wcm9jZXNz
b3I7Ci0gICAgfQorICAgICAgICBkb20wX3NldHVwX3ZjcHUoZCwgaSk7CiAKICAgICBkb21haW5f
dXBkYXRlX25vZGVfYWZmaW5pdHkoZCk7CiAKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9wdi9k
b20wX2J1aWxkLmMgYi94ZW4vYXJjaC94ODYvcHYvZG9tMF9idWlsZC5jCmluZGV4IDFiZDUzZTlj
MDguLjU2NWM2YzhiNDQgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9wdi9kb20wX2J1aWxkLmMK
KysrIGIveGVuL2FyY2gveDg2L3B2L2RvbTBfYnVpbGQuYwpAQCAtMjg1LDcgKzI4NSw3IEBAIGlu
dCBfX2luaXQgZG9tMF9jb25zdHJ1Y3RfcHYoc3RydWN0IGRvbWFpbiAqZCwKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgbW9kdWxlX3QgKmluaXRyZCwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgY2hhciAqY21kbGluZSkKIHsKLSAgICBpbnQgaSwgY3B1LCByYywgY29tcGF0aWJs
ZSwgb3JkZXIsIG1hY2hpbmU7CisgICAgaW50IGksIHJjLCBjb21wYXRpYmxlLCBvcmRlciwgbWFj
aGluZTsKICAgICBzdHJ1Y3QgY3B1X3VzZXJfcmVncyAqcmVnczsKICAgICB1bnNpZ25lZCBsb25n
IHBmbiwgbWZuOwogICAgIHVuc2lnbmVkIGxvbmcgbnJfcGFnZXM7CkBAIC02OTQsMTQgKzY5NCw4
IEBAIGludCBfX2luaXQgZG9tMF9jb25zdHJ1Y3RfcHYoc3RydWN0IGRvbWFpbiAqZCwKIAogICAg
IHByaW50aygiRG9tJXUgaGFzIG1heGltdW0gJXUgVkNQVXNcbiIsIGQtPmRvbWFpbl9pZCwgZC0+
bWF4X3ZjcHVzKTsKIAotICAgIGNwdSA9IHYtPnByb2Nlc3NvcjsKICAgICBmb3IgKCBpID0gMTsg
aSA8IGQtPm1heF92Y3B1czsgaSsrICkKLSAgICB7Ci0gICAgICAgIGNvbnN0IHN0cnVjdCB2Y3B1
ICpwID0gZG9tMF9zZXR1cF92Y3B1KGQsIGksIGNwdSk7Ci0KLSAgICAgICAgaWYgKCBwICkKLSAg
ICAgICAgICAgIGNwdSA9IHAtPnByb2Nlc3NvcjsKLSAgICB9CisgICAgICAgIGRvbTBfc2V0dXBf
dmNwdShkLCBpKTsKIAogICAgIGRvbWFpbl91cGRhdGVfbm9kZV9hZmZpbml0eShkKTsKICAgICBk
LT5hcmNoLnBhZ2luZy5tb2RlID0gMDsKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vZG9tYWluLmMg
Yi94ZW4vY29tbW9uL2RvbWFpbi5jCmluZGV4IDVhYTQwOTI5YzAuLjE5ZDg4MWIwYzMgMTAwNjQ0
Ci0tLSBhL3hlbi9jb21tb24vZG9tYWluLmMKKysrIGIveGVuL2NvbW1vbi9kb21haW4uYwpAQCAt
MTM1LDggKzEzNSw3IEBAIHN0YXRpYyB2b2lkIHZjcHVfZGVzdHJveShzdHJ1Y3QgdmNwdSAqdikK
ICAgICBmcmVlX3ZjcHVfc3RydWN0KHYpOwogfQogCi1zdHJ1Y3QgdmNwdSAqdmNwdV9jcmVhdGUo
Ci0gICAgc3RydWN0IGRvbWFpbiAqZCwgdW5zaWduZWQgaW50IHZjcHVfaWQsIHVuc2lnbmVkIGlu
dCBjcHVfaWQpCitzdHJ1Y3QgdmNwdSAqdmNwdV9jcmVhdGUoc3RydWN0IGRvbWFpbiAqZCwgdW5z
aWduZWQgaW50IHZjcHVfaWQpCiB7CiAgICAgc3RydWN0IHZjcHUgKnY7CiAKQEAgLTE2OCw3ICsx
NjcsNyBAQCBzdHJ1Y3QgdmNwdSAqdmNwdV9jcmVhdGUoCiAgICAgICAgIGluaXRfd2FpdHF1ZXVl
X3ZjcHUodik7CiAgICAgfQogCi0gICAgaWYgKCBzY2hlZF9pbml0X3ZjcHUodiwgY3B1X2lkKSAh
PSAwICkKKyAgICBpZiAoIHNjaGVkX2luaXRfdmNwdSh2KSAhPSAwICkKICAgICAgICAgZ290byBm
YWlsX3dxOwogCiAgICAgaWYgKCBhcmNoX3ZjcHVfY3JlYXRlKHYpICE9IDAgKQpkaWZmIC0tZ2l0
IGEveGVuL2NvbW1vbi9kb21jdGwuYyBiL3hlbi9jb21tb24vZG9tY3RsLmMKaW5kZXggZWJiMzdh
MTM4ZS4uY2Y3MDY3MWQyZCAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9kb21jdGwuYworKysgYi94
ZW4vY29tbW9uL2RvbWN0bC5jCkBAIC01MzIsOCArNTMyLDcgQEAgbG9uZyBkb19kb21jdGwoWEVO
X0dVRVNUX0hBTkRMRV9QQVJBTSh4ZW5fZG9tY3RsX3QpIHVfZG9tY3RsKQogCiAgICAgY2FzZSBY
RU5fRE9NQ1RMX21heF92Y3B1czoKICAgICB7Ci0gICAgICAgIHVuc2lnbmVkIGludCBpLCBtYXgg
PSBvcC0+dS5tYXhfdmNwdXMubWF4LCBjcHU7Ci0gICAgICAgIGNwdW1hc2tfdCAqb25saW5lOwor
ICAgICAgICB1bnNpZ25lZCBpbnQgaSwgbWF4ID0gb3AtPnUubWF4X3ZjcHVzLm1heDsKIAogICAg
ICAgICByZXQgPSAtRUlOVkFMOwogICAgICAgICBpZiAoIChkID09IGN1cnJlbnQtPmRvbWFpbikg
fHwgLyogbm8gZG9tYWluX3BhdXNlKCkgKi8KQEAgLTU0NCwxOCArNTQzLDEzIEBAIGxvbmcgZG9f
ZG9tY3RsKFhFTl9HVUVTVF9IQU5ETEVfUEFSQU0oeGVuX2RvbWN0bF90KSB1X2RvbWN0bCkKICAg
ICAgICAgZG9tYWluX3BhdXNlKGQpOwogCiAgICAgICAgIHJldCA9IC1FTk9NRU07Ci0gICAgICAg
IG9ubGluZSA9IGNwdXBvb2xfZG9tYWluX2NwdW1hc2soZCk7CiAKICAgICAgICAgZm9yICggaSA9
IDA7IGkgPCBtYXg7IGkrKyApCiAgICAgICAgIHsKICAgICAgICAgICAgIGlmICggZC0+dmNwdVtp
XSAhPSBOVUxMICkKICAgICAgICAgICAgICAgICBjb250aW51ZTsKIAotICAgICAgICAgICAgY3B1
ID0gKGkgPT0gMCkgPwotICAgICAgICAgICAgICAgIGNwdW1hc2tfYW55KG9ubGluZSkgOgotICAg
ICAgICAgICAgICAgIGNwdW1hc2tfY3ljbGUoZC0+dmNwdVtpLTFdLT5wcm9jZXNzb3IsIG9ubGlu
ZSk7Ci0KLSAgICAgICAgICAgIGlmICggdmNwdV9jcmVhdGUoZCwgaSwgY3B1KSA9PSBOVUxMICkK
KyAgICAgICAgICAgIGlmICggdmNwdV9jcmVhdGUoZCwgaSkgPT0gTlVMTCApCiAgICAgICAgICAg
ICAgICAgZ290byBtYXh2Y3B1X291dDsKICAgICAgICAgfQogCmRpZmYgLS1naXQgYS94ZW4vY29t
bW9uL3NjaGVkdWxlLmMgYi94ZW4vY29tbW9uL3NjaGVkdWxlLmMKaW5kZXggMDMxMTlhZjI1Yy4u
NjI4MWU4ODRjZiAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9zY2hlZHVsZS5jCisrKyBiL3hlbi9j
b21tb24vc2NoZWR1bGUuYwpAQCAtMzY4LDE0ICszNjgsNTIgQEAgc3RhdGljIHN0cnVjdCBzY2hl
ZF91bml0ICpzY2hlZF9hbGxvY191bml0KHN0cnVjdCB2Y3B1ICp2KQogICAgIHJldHVybiBOVUxM
OwogfQogCi1pbnQgc2NoZWRfaW5pdF92Y3B1KHN0cnVjdCB2Y3B1ICp2LCB1bnNpZ25lZCBpbnQg
cHJvY2Vzc29yKQorc3RhdGljIHVuc2lnbmVkIGludCBzY2hlZF9zZWxlY3RfaW5pdGlhbF9jcHUo
Y29uc3Qgc3RydWN0IHZjcHUgKnYpCit7CisgICAgY29uc3Qgc3RydWN0IGRvbWFpbiAqZCA9IHYt
PmRvbWFpbjsKKyAgICBub2RlaWRfdCBub2RlOworICAgIHNwaW5sb2NrX3QgKmxvY2s7CisgICAg
dW5zaWduZWQgbG9uZyBmbGFnczsKKyAgICB1bnNpZ25lZCBpbnQgY3B1X3JldCwgY3B1ID0gc21w
X3Byb2Nlc3Nvcl9pZCgpOworICAgIGNwdW1hc2tfdCAqY3B1cyA9IGNwdW1hc2tfc2NyYXRjaF9j
cHUoY3B1KTsKKworICAgIGxvY2sgPSBwY3B1X3NjaGVkdWxlX2xvY2tfaXJxc2F2ZShjcHUsICZm
bGFncyk7CisgICAgY3B1bWFza19jbGVhcihjcHVzKTsKKyAgICBmb3JfZWFjaF9ub2RlX21hc2sg
KCBub2RlLCBkLT5ub2RlX2FmZmluaXR5ICkKKyAgICAgICAgY3B1bWFza19vcihjcHVzLCBjcHVz
LCAmbm9kZV90b19jcHVtYXNrKG5vZGUpKTsKKyAgICBjcHVtYXNrX2FuZChjcHVzLCBjcHVzLCBj
cHVwb29sX2RvbWFpbl9jcHVtYXNrKGQpKTsKKyAgICBpZiAoIGNwdW1hc2tfZW1wdHkoY3B1cykg
KQorICAgICAgICBjcHVtYXNrX2NvcHkoY3B1cywgY3B1cG9vbF9kb21haW5fY3B1bWFzayhkKSk7
CisKKyAgICBpZiAoIHYtPnZjcHVfaWQgPT0gMCApCisgICAgICAgIGNwdV9yZXQgPSBjcHVtYXNr
X2ZpcnN0KGNwdXMpOworICAgIGVsc2UKKyAgICB7CisgICAgICAgIC8qIFdlIGNhbiByZWx5IG9u
IHByZXZpb3VzIHZjcHUgYmVpbmcgYXZhaWxhYmxlLiAqLworICAgICAgICBBU1NFUlQoIWlzX2lk
bGVfZG9tYWluKGQpKTsKKworICAgICAgICBjcHVfcmV0ID0gY3B1bWFza19jeWNsZShkLT52Y3B1
W3YtPnZjcHVfaWQgLSAxXS0+cHJvY2Vzc29yLCBjcHVzKTsKKyAgICB9CisKKyAgICBwY3B1X3Nj
aGVkdWxlX3VubG9ja19pcnFyZXN0b3JlKGxvY2ssIGZsYWdzLCBjcHUpOworCisgICAgcmV0dXJu
IGNwdV9yZXQ7Cit9CisKK2ludCBzY2hlZF9pbml0X3ZjcHUoc3RydWN0IHZjcHUgKnYpCiB7CiAg
ICAgc3RydWN0IGRvbWFpbiAqZCA9IHYtPmRvbWFpbjsKICAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCAq
dW5pdDsKKyAgICB1bnNpZ25lZCBpbnQgcHJvY2Vzc29yOwogCiAgICAgaWYgKCAodW5pdCA9IHNj
aGVkX2FsbG9jX3VuaXQodikpID09IE5VTEwgKQogICAgICAgICByZXR1cm4gMTsKIAorICAgIGlm
ICggaXNfaWRsZV9kb21haW4oZCkgKQorICAgICAgICBwcm9jZXNzb3IgPSB2LT52Y3B1X2lkOwor
ICAgIGVsc2UKKyAgICAgICAgcHJvY2Vzc29yID0gc2NoZWRfc2VsZWN0X2luaXRpYWxfY3B1KHYp
OworCiAgICAgc2NoZWRfc2V0X3Jlcyh1bml0LCBnZXRfc2NoZWRfcmVzKHByb2Nlc3NvcikpOwog
CiAgICAgLyogSW5pdGlhbGlzZSB0aGUgcGVyLXZjcHUgdGltZXJzLiAqLwpAQCAtMTc1Myw3ICsx
NzkxLDcgQEAgc3RhdGljIGludCBjcHVfc2NoZWR1bGVfdXAodW5zaWduZWQgaW50IGNwdSkKICAg
ICAgICAgcmV0dXJuIDA7CiAKICAgICBpZiAoIGlkbGVfdmNwdVtjcHVdID09IE5VTEwgKQotICAg
ICAgICB2Y3B1X2NyZWF0ZShpZGxlX3ZjcHVbMF0tPmRvbWFpbiwgY3B1LCBjcHUpOworICAgICAg
ICB2Y3B1X2NyZWF0ZShpZGxlX3ZjcHVbMF0tPmRvbWFpbiwgY3B1KTsKICAgICBlbHNlCiAgICAg
ICAgIGlkbGVfdmNwdVtjcHVdLT5zY2hlZF91bml0LT5yZXMgPSBzZDsKIApAQCAtMTkzMiw3ICsx
OTcwLDcgQEAgdm9pZCBfX2luaXQgc2NoZWR1bGVyX2luaXQodm9pZCkKICAgICBCVUdfT04obnJf
Y3B1X2lkcyA+IEFSUkFZX1NJWkUoaWRsZV92Y3B1KSk7CiAgICAgaWRsZV9kb21haW4tPnZjcHUg
PSBpZGxlX3ZjcHU7CiAgICAgaWRsZV9kb21haW4tPm1heF92Y3B1cyA9IG5yX2NwdV9pZHM7Ci0g
ICAgaWYgKCB2Y3B1X2NyZWF0ZShpZGxlX2RvbWFpbiwgMCwgMCkgPT0gTlVMTCApCisgICAgaWYg
KCB2Y3B1X2NyZWF0ZShpZGxlX2RvbWFpbiwgMCkgPT0gTlVMTCApCiAgICAgICAgIEJVRygpOwog
ICAgIGdldF9zY2hlZF9yZXMoMCktPmN1cnIgPSBpZGxlX3ZjcHVbMF0tPnNjaGVkX3VuaXQ7CiB9
CmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS9hc20teDg2L2RvbTBfYnVpbGQuaCBiL3hlbi9pbmNs
dWRlL2FzbS14ODYvZG9tMF9idWlsZC5oCmluZGV4IDMzYTU0ODM3MzkuLjNlYjRiMDM2ZTEgMTAw
NjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL2FzbS14ODYvZG9tMF9idWlsZC5oCisrKyBiL3hlbi9pbmNs
dWRlL2FzbS14ODYvZG9tMF9idWlsZC5oCkBAIC0xMSw4ICsxMSw3IEBAIGV4dGVybiB1bnNpZ25l
ZCBpbnQgZG9tMF9tZW1mbGFnczsKIHVuc2lnbmVkIGxvbmcgZG9tMF9jb21wdXRlX25yX3BhZ2Vz
KHN0cnVjdCBkb21haW4gKmQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBz
dHJ1Y3QgZWxmX2RvbV9wYXJtcyAqcGFybXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICB1bnNpZ25lZCBsb25nIGluaXRyZF9sZW4pOwotc3RydWN0IHZjcHUgKmRvbTBfc2V0
dXBfdmNwdShzdHJ1Y3QgZG9tYWluICpkLCB1bnNpZ25lZCBpbnQgdmNwdV9pZCwKLSAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IGNwdSk7CitzdHJ1Y3QgdmNwdSAqZG9t
MF9zZXR1cF92Y3B1KHN0cnVjdCBkb21haW4gKmQsIHVuc2lnbmVkIGludCB2Y3B1X2lkKTsKIGlu
dCBkb20wX3NldHVwX3Blcm1pc3Npb25zKHN0cnVjdCBkb21haW4gKmQpOwogCiBpbnQgZG9tMF9j
b25zdHJ1Y3RfcHYoc3RydWN0IGRvbWFpbiAqZCwgY29uc3QgbW9kdWxlX3QgKmltYWdlLApkaWZm
IC0tZ2l0IGEveGVuL2luY2x1ZGUveGVuL2RvbWFpbi5oIGIveGVuL2luY2x1ZGUveGVuL2RvbWFp
bi5oCmluZGV4IDNmMDljYjY2YzAuLjRjYTNkYjVhMTggMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRl
L3hlbi9kb21haW4uaAorKysgYi94ZW4vaW5jbHVkZS94ZW4vZG9tYWluLmgKQEAgLTEzLDggKzEz
LDcgQEAgdHlwZWRlZiB1bmlvbiB7CiAgICAgc3RydWN0IGNvbXBhdF92Y3B1X2d1ZXN0X2NvbnRl
eHQgKmNtcDsKIH0gdmNwdV9ndWVzdF9jb250ZXh0X3UgX19hdHRyaWJ1dGVfXygoX190cmFuc3Bh
cmVudF91bmlvbl9fKSk7CiAKLXN0cnVjdCB2Y3B1ICp2Y3B1X2NyZWF0ZSgKLSAgICBzdHJ1Y3Qg
ZG9tYWluICpkLCB1bnNpZ25lZCBpbnQgdmNwdV9pZCwgdW5zaWduZWQgaW50IGNwdV9pZCk7Citz
dHJ1Y3QgdmNwdSAqdmNwdV9jcmVhdGUoc3RydWN0IGRvbWFpbiAqZCwgdW5zaWduZWQgaW50IHZj
cHVfaWQpOwogCiB1bnNpZ25lZCBpbnQgZG9tMF9tYXhfdmNwdXModm9pZCk7CiBzdHJ1Y3QgdmNw
dSAqYWxsb2NfZG9tMF92Y3B1MChzdHJ1Y3QgZG9tYWluICpkb20wKTsKZGlmZiAtLWdpdCBhL3hl
bi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5oIGIveGVuL2luY2x1ZGUveGVuL3NjaGVkLWlmLmgKaW5k
ZXggYTk0NWZjNzQ4ZC4uMTQ0MDA1NTI1MCAxMDA2NDQKLS0tIGEveGVuL2luY2x1ZGUveGVuL3Nj
aGVkLWlmLmgKKysrIGIveGVuL2luY2x1ZGUveGVuL3NjaGVkLWlmLmgKQEAgLTQ1Nyw3ICs0NTcs
NyBAQCBzdHJ1Y3QgY3B1cG9vbAogI2RlZmluZSBjcHVwb29sX29ubGluZV9jcHVtYXNrKF9wb29s
KSBcCiAgICAgKCgoX3Bvb2wpID09IE5VTEwpID8gJmNwdV9vbmxpbmVfbWFwIDogKF9wb29sKS0+
Y3B1X3ZhbGlkKQogCi1zdGF0aWMgaW5saW5lIGNwdW1hc2tfdCogY3B1cG9vbF9kb21haW5fY3B1
bWFzayhzdHJ1Y3QgZG9tYWluICpkKQorc3RhdGljIGlubGluZSBjcHVtYXNrX3QqIGNwdXBvb2xf
ZG9tYWluX2NwdW1hc2soY29uc3Qgc3RydWN0IGRvbWFpbiAqZCkKIHsKICAgICAvKgogICAgICAq
IGQtPmNwdXBvb2wgaXMgTlVMTCBvbmx5IGZvciB0aGUgaWRsZSBkb21haW4sIGFuZCBubyBvbmUg
c2hvdWxkCmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaCBiL3hlbi9pbmNsdWRl
L3hlbi9zY2hlZC5oCmluZGV4IGY1MDZjMGNiZDQuLmY2MzliMTY0YjUgMTAwNjQ0Ci0tLSBhL3hl
bi9pbmNsdWRlL3hlbi9zY2hlZC5oCisrKyBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCkBAIC02
NjIsNyArNjYyLDcgQEAgdm9pZCBfX2RvbWFpbl9jcmFzaChzdHJ1Y3QgZG9tYWluICpkKTsKIHZv
aWQgbm9yZXR1cm4gYXNtX2RvbWFpbl9jcmFzaF9zeW5jaHJvbm91cyh1bnNpZ25lZCBsb25nIGFk
ZHIpOwogCiB2b2lkIHNjaGVkdWxlcl9pbml0KHZvaWQpOwotaW50ICBzY2hlZF9pbml0X3ZjcHUo
c3RydWN0IHZjcHUgKnYsIHVuc2lnbmVkIGludCBwcm9jZXNzb3IpOworaW50ICBzY2hlZF9pbml0
X3ZjcHUoc3RydWN0IHZjcHUgKnYpOwogdm9pZCBzY2hlZF9kZXN0cm95X3ZjcHUoc3RydWN0IHZj
cHUgKnYpOwogaW50ICBzY2hlZF9pbml0X2RvbWFpbihzdHJ1Y3QgZG9tYWluICpkLCBpbnQgcG9v
bGlkKTsKIHZvaWQgc2NoZWRfZGVzdHJveV9kb21haW4oc3RydWN0IGRvbWFpbiAqZCk7Ci0tIAoy
LjE2LjQKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpY
ZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRw
czovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

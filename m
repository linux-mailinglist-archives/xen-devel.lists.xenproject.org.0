Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 1A52D75F08
	for <lists+xen-devel@lfdr.de>; Fri, 26 Jul 2019 08:28:30 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hqtfv-00038Q-H1; Fri, 26 Jul 2019 06:25:55 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=6973=VX=suse.com=dfaggioli@srs-us1.protection.inumbo.net>)
 id 1hqtft-00038K-NA
 for xen-devel@lists.xenproject.org; Fri, 26 Jul 2019 06:25:53 +0000
X-Inumbo-ID: 3730ec1e-af6e-11e9-8980-bc764e045a96
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 3730ec1e-af6e-11e9-8980-bc764e045a96;
 Fri, 26 Jul 2019 06:25:52 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 924C1AD31;
 Fri, 26 Jul 2019 06:25:51 +0000 (UTC)
From: Dario Faggioli <dfaggioli@suse.com>
To: xen-devel@lists.xenproject.org
Date: Fri, 26 Jul 2019 08:25:51 +0200
Message-ID: <156412235104.2385.3911161728130674771.stgit@Palanthas>
In-Reply-To: <156412188377.2385.12588508835559819141.stgit@Palanthas>
References: <156412188377.2385.12588508835559819141.stgit@Palanthas>
User-Agent: StGit/0.17.1-dirty
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v2 1/4] xen: sched: refector code around
 vcpu_deassign() in null scheduler
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: George Dunlap <george.dunlap@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

dmNwdV9kZWFzc2lnbigpIGlzIGNhbGxlZCBvbmx5IG9uY2UgKGluIF92Y3B1X3JlbW92ZSgpKS4K
CkxldCdzIGNvbnNvbGlkYXRlIHRoZSB0d28gZnVuY3Rpb25zIGludG8gb25lLgoKTm8gZnVuY3Rp
b25hbCBjaGFuZ2UgaW50ZW5kZWQuCgpTaWduZWQtb2ZmLWJ5OiBEYXJpbyBGYWdnaW9saSA8ZGZh
Z2dpb2xpQHN1c2UuY29tPgpBY2tlZC1ieTogR2VvcmdlIER1bmxhcCA8Z2VvcmdlLmR1bmxhcEBj
aXRyaXguY29tPgotLS0KIHhlbi9jb21tb24vc2NoZWRfbnVsbC5jIHwgICA3NiArKysrKysrKysr
KysrKysrKysrKysrLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDM1
IGluc2VydGlvbnMoKyksIDQxIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24v
c2NoZWRfbnVsbC5jIGIveGVuL2NvbW1vbi9zY2hlZF9udWxsLmMKaW5kZXggYzAyYzFiOWMxZi4u
YzQ3YzFiNWFhZSAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9zY2hlZF9udWxsLmMKKysrIGIveGVu
L2NvbW1vbi9zY2hlZF9udWxsLmMKQEAgLTM1OCw5ICszNTgsMTQgQEAgc3RhdGljIHZvaWQgdmNw
dV9hc3NpZ24oc3RydWN0IG51bGxfcHJpdmF0ZSAqcHJ2LCBzdHJ1Y3QgdmNwdSAqdiwKICAgICB9
CiB9CiAKLXN0YXRpYyB2b2lkIHZjcHVfZGVhc3NpZ24oc3RydWN0IG51bGxfcHJpdmF0ZSAqcHJ2
LCBzdHJ1Y3QgdmNwdSAqdiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50
IGNwdSkKK3N0YXRpYyB2b2lkIHZjcHVfZGVhc3NpZ24oc3RydWN0IG51bGxfcHJpdmF0ZSAqcHJ2
LCBzdHJ1Y3QgdmNwdSAqdikKIHsKKyAgICB1bnNpZ25lZCBpbnQgYnM7CisgICAgdW5zaWduZWQg
aW50IGNwdSA9IHYtPnByb2Nlc3NvcjsKKyAgICBzdHJ1Y3QgbnVsbF92Y3B1ICp3dmM7CisKKyAg
ICBBU1NFUlQobGlzdF9lbXB0eSgmbnVsbF92Y3B1KHYpLT53YWl0cV9lbGVtKSk7CisKICAgICBw
ZXJfY3B1KG5wYywgY3B1KS52Y3B1ID0gTlVMTDsKICAgICBjcHVtYXNrX3NldF9jcHUoY3B1LCAm
cHJ2LT5jcHVzX2ZyZWUpOwogCkBAIC0zNzcsNiArMzgyLDMyIEBAIHN0YXRpYyB2b2lkIHZjcHVf
ZGVhc3NpZ24oc3RydWN0IG51bGxfcHJpdmF0ZSAqcHJ2LCBzdHJ1Y3QgdmNwdSAqdiwKICAgICAg
ICAgZC5jcHUgPSBjcHU7CiAgICAgICAgIF9fdHJhY2VfdmFyKFRSQ19TTlVMTF9WQ1BVX0RFQVNT
SUdOLCAxLCBzaXplb2YoZCksICZkKTsKICAgICB9CisKKyAgICBzcGluX2xvY2soJnBydi0+d2Fp
dHFfbG9jayk7CisKKyAgICAvKgorICAgICAqIElmIHYgaXMgYXNzaWduZWQgdG8gYSBwQ1BVLCBs
ZXQncyBzZWUgaWYgdGhlcmUgaXMgc29tZW9uZSB3YWl0aW5nLAorICAgICAqIHN1aXRhYmxlIHRv
IGJlIGFzc2lnbmVkIHRvIGl0IChwcmlvcml0aXppbmcgdmNwdXMgdGhhdCBoYXZlCisgICAgICog
c29mdC1hZmZpbml0eSB3aXRoIGNwdSkuCisgICAgICovCisgICAgZm9yX2VhY2hfYWZmaW5pdHlf
YmFsYW5jZV9zdGVwKCBicyApCisgICAgeworICAgICAgICBsaXN0X2Zvcl9lYWNoX2VudHJ5KCB3
dmMsICZwcnYtPndhaXRxLCB3YWl0cV9lbGVtICkKKyAgICAgICAgeworICAgICAgICAgICAgaWYg
KCBicyA9PSBCQUxBTkNFX1NPRlRfQUZGSU5JVFkgJiYgIWhhc19zb2Z0X2FmZmluaXR5KHd2Yy0+
dmNwdSkgKQorICAgICAgICAgICAgICAgIGNvbnRpbnVlOworCisgICAgICAgICAgICBpZiAoIHZj
cHVfY2hlY2tfYWZmaW5pdHkod3ZjLT52Y3B1LCBjcHUsIGJzKSApCisgICAgICAgICAgICB7Cisg
ICAgICAgICAgICAgICAgbGlzdF9kZWxfaW5pdCgmd3ZjLT53YWl0cV9lbGVtKTsKKyAgICAgICAg
ICAgICAgICB2Y3B1X2Fzc2lnbihwcnYsIHd2Yy0+dmNwdSwgY3B1KTsKKyAgICAgICAgICAgICAg
ICBjcHVfcmFpc2Vfc29mdGlycShjcHUsIFNDSEVEVUxFX1NPRlRJUlEpOworICAgICAgICAgICAg
ICAgIHNwaW5fdW5sb2NrKCZwcnYtPndhaXRxX2xvY2spOworICAgICAgICAgICAgICAgIHJldHVy
bjsKKyAgICAgICAgICAgIH0KKyAgICAgICAgfQorICAgIH0KKyAgICBzcGluX3VubG9jaygmcHJ2
LT53YWl0cV9sb2NrKTsKIH0KIAogLyogQ2hhbmdlIHRoZSBzY2hlZHVsZXIgb2YgY3B1IHRvIHVz
IChudWxsKS4gKi8KQEAgLTQ1OSw0MyArNDkwLDYgQEAgc3RhdGljIHZvaWQgbnVsbF92Y3B1X2lu
c2VydChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCB2Y3B1ICp2KQogICAgIFND
SEVEX1NUQVRfQ1JBTksodmNwdV9pbnNlcnQpOwogfQogCi1zdGF0aWMgdm9pZCBfdmNwdV9yZW1v
dmUoc3RydWN0IG51bGxfcHJpdmF0ZSAqcHJ2LCBzdHJ1Y3QgdmNwdSAqdikKLXsKLSAgICB1bnNp
Z25lZCBpbnQgYnM7Ci0gICAgdW5zaWduZWQgaW50IGNwdSA9IHYtPnByb2Nlc3NvcjsKLSAgICBz
dHJ1Y3QgbnVsbF92Y3B1ICp3dmM7Ci0KLSAgICBBU1NFUlQobGlzdF9lbXB0eSgmbnVsbF92Y3B1
KHYpLT53YWl0cV9lbGVtKSk7Ci0KLSAgICB2Y3B1X2RlYXNzaWduKHBydiwgdiwgY3B1KTsKLQot
ICAgIHNwaW5fbG9jaygmcHJ2LT53YWl0cV9sb2NrKTsKLQotICAgIC8qCi0gICAgICogSWYgdiBp
cyBhc3NpZ25lZCB0byBhIHBDUFUsIGxldCdzIHNlZSBpZiB0aGVyZSBpcyBzb21lb25lIHdhaXRp
bmcsCi0gICAgICogc3VpdGFibGUgdG8gYmUgYXNzaWduZWQgdG8gaXQgKHByaW9yaXRpemluZyB2
Y3B1cyB0aGF0IGhhdmUKLSAgICAgKiBzb2Z0LWFmZmluaXR5IHdpdGggY3B1KS4KLSAgICAgKi8K
LSAgICBmb3JfZWFjaF9hZmZpbml0eV9iYWxhbmNlX3N0ZXAoIGJzICkKLSAgICB7Ci0gICAgICAg
IGxpc3RfZm9yX2VhY2hfZW50cnkoIHd2YywgJnBydi0+d2FpdHEsIHdhaXRxX2VsZW0gKQotICAg
ICAgICB7Ci0gICAgICAgICAgICBpZiAoIGJzID09IEJBTEFOQ0VfU09GVF9BRkZJTklUWSAmJiAh
aGFzX3NvZnRfYWZmaW5pdHkod3ZjLT52Y3B1KSApCi0gICAgICAgICAgICAgICAgY29udGludWU7
Ci0KLSAgICAgICAgICAgIGlmICggdmNwdV9jaGVja19hZmZpbml0eSh3dmMtPnZjcHUsIGNwdSwg
YnMpICkKLSAgICAgICAgICAgIHsKLSAgICAgICAgICAgICAgICBsaXN0X2RlbF9pbml0KCZ3dmMt
PndhaXRxX2VsZW0pOwotICAgICAgICAgICAgICAgIHZjcHVfYXNzaWduKHBydiwgd3ZjLT52Y3B1
LCBjcHUpOwotICAgICAgICAgICAgICAgIGNwdV9yYWlzZV9zb2Z0aXJxKGNwdSwgU0NIRURVTEVf
U09GVElSUSk7Ci0gICAgICAgICAgICAgICAgc3Bpbl91bmxvY2soJnBydi0+d2FpdHFfbG9jayk7
Ci0gICAgICAgICAgICAgICAgcmV0dXJuOwotICAgICAgICAgICAgfQotICAgICAgICB9Ci0gICAg
fQotICAgIHNwaW5fdW5sb2NrKCZwcnYtPndhaXRxX2xvY2spOwotfQotCiBzdGF0aWMgdm9pZCBu
dWxsX3ZjcHVfcmVtb3ZlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHZjcHUg
KnYpCiB7CiAgICAgc3RydWN0IG51bGxfcHJpdmF0ZSAqcHJ2ID0gbnVsbF9wcml2KG9wcyk7CkBA
IC01MTksNyArNTEzLDcgQEAgc3RhdGljIHZvaWQgbnVsbF92Y3B1X3JlbW92ZShjb25zdCBzdHJ1
Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCB2Y3B1ICp2KQogICAgIEFTU0VSVChwZXJfY3B1KG5w
Yywgdi0+cHJvY2Vzc29yKS52Y3B1ID09IHYpOwogICAgIEFTU0VSVCghY3B1bWFza190ZXN0X2Nw
dSh2LT5wcm9jZXNzb3IsICZwcnYtPmNwdXNfZnJlZSkpOwogCi0gICAgX3ZjcHVfcmVtb3ZlKHBy
diwgdik7CisgICAgdmNwdV9kZWFzc2lnbihwcnYsIHYpOwogCiAgb3V0OgogICAgIHZjcHVfc2No
ZWR1bGVfdW5sb2NrX2lycShsb2NrLCB2KTsKQEAgLTYwNSw3ICs1OTksNyBAQCBzdGF0aWMgdm9p
ZCBudWxsX3ZjcHVfbWlncmF0ZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCB2
Y3B1ICp2LAogICAgICAqLwogICAgIGlmICggbGlrZWx5KGxpc3RfZW1wdHkoJm52Yy0+d2FpdHFf
ZWxlbSkpICkKICAgICB7Ci0gICAgICAgIF92Y3B1X3JlbW92ZShwcnYsIHYpOworICAgICAgICB2
Y3B1X2RlYXNzaWduKHBydiwgdik7CiAgICAgICAgIFNDSEVEX1NUQVRfQ1JBTksobWlncmF0ZV9y
dW5uaW5nKTsKICAgICB9CiAgICAgZWxzZQoKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3Rz
LnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0
aW5mby94ZW4tZGV2ZWw=

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 29887144B5
	for <lists+xen-devel@lfdr.de>; Mon,  6 May 2019 08:59:29 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hNXYe-000215-Mj; Mon, 06 May 2019 06:57:04 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=XZcu=TG=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1hNXYc-0001xp-VE
 for xen-devel@lists.xenproject.org; Mon, 06 May 2019 06:57:02 +0000
X-Inumbo-ID: 2300004c-6fcc-11e9-9fac-bf81ad6d26d4
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 2300004c-6fcc-11e9-9fac-bf81ad6d26d4;
 Mon, 06 May 2019 06:56:56 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id B1499AF1C;
 Mon,  6 May 2019 06:56:53 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Mon,  6 May 2019 08:56:16 +0200
Message-Id: <20190506065644.7415-18-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190506065644.7415-1-jgross@suse.com>
References: <20190506065644.7415-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH RFC V2 17/45] xen/sched: add is_running
 indicator to struct sched_item
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Tim Deegan <tim@xen.org>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wei.liu2@citrix.com>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Dario Faggioli <dfaggioli@suse.com>,
 Julien Grall <julien.grall@arm.com>, Meng Xu <mengxu@cis.upenn.edu>,
 Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

QWRkIGFuIGlzX3J1bm5pbmcgaW5kaWNhdG9yIHRvIHN0cnVjdCBzY2hlZF9pdGVtIHdoaWNoIHdp
bGwgYmUgc2V0CndoZW5ldmVyIHRoZSBpdGVtIGlzIGJlaW5nIHNjaGVkdWxlZC4gU3dpdGNoIHNj
aGVkdWxlciBjb2RlIHRvIHVzZQppdGVtLT5pc19ydW5uaW5nIGluc3RlYWQgb2YgdmNwdS0+aXNf
cnVubmluZyBmb3Igc2NoZWR1bGluZyBkZWNpc2lvbnMuCgpBdCB0aGUgc2FtZSB0aW1lIGludHJv
ZHVjZSBhIHN0YXRlX2VudHJ5X3RpbWUgZmllbGQgaW4gc3RydWN0CnNjaGVkX2l0ZW0gYmVpbmcg
dXBkYXRlZCB3aGVuZXZlciB0aGUgaXNfcnVubmluZyBpbmRpY2F0b3IgaXMgY2hhbmdlZC4KVXNl
IHRoYXQgbmV3IGZpZWxkIGluIHRoZSBzY2hlZHVsZXJzIGluc3RlYWQgb2YgdGhlIHNpbWlsYXIg
dmNwdSBmaWVsZC4KClNpZ25lZC1vZmYtYnk6IEp1ZXJnZW4gR3Jvc3MgPGpncm9zc0BzdXNlLmNv
bT4KLS0tClJGQyBWMjogZml4IGFybSBidWlsZCwgZG9uJ3QgZHJvcCB2LT5pc19ydW5uaW5nCi0t
LQogeGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQuYyAgfCAxMiArKysrKysrLS0tLS0KIHhlbi9jb21t
b24vc2NoZWRfY3JlZGl0Mi5jIHwgMTggKysrKysrKysrLS0tLS0tLS0tCiB4ZW4vY29tbW9uL3Nj
aGVkX3J0LmMgICAgICB8ICAyICstCiB4ZW4vY29tbW9uL3NjaGVkdWxlLmMgICAgICB8IDE1ICsr
KysrKysrKysrLS0tLQogeGVuL2luY2x1ZGUveGVuL3NjaGVkLmggICAgfCAgNCArKysrCiA1IGZp
bGVzIGNoYW5nZWQsIDMyIGluc2VydGlvbnMoKyksIDE5IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdp
dCBhL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0LmMgYi94ZW4vY29tbW9uL3NjaGVkX2NyZWRpdC5j
CmluZGV4IDI5MDc2ZTM2MmIuLjc3YmViZjViNDIgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2No
ZWRfY3JlZGl0LmMKKysrIGIveGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQuYwpAQCAtNzIzLDcgKzcy
Myw3IEBAIF9fY3NjaGVkX3ZjcHVfaXNfbWlncmF0ZWFibGUoY29uc3Qgc3RydWN0IGNzY2hlZF9w
cml2YXRlICpwcnYsIHN0cnVjdCB2Y3B1ICp2YywKICAgICAgKiBUaGUgY2FsbGVyIGlzIHN1cHBv
c2VkIHRvIGhhdmUgYWxyZWFkeSBjaGVja2VkIHRoYXQgdmMgaXMgYWxzbwogICAgICAqIG5vdCBy
dW5uaW5nLgogICAgICAqLwotICAgIEFTU0VSVCghdmMtPmlzX3J1bm5pbmcpOworICAgIEFTU0VS
VCghdmMtPnNjaGVkX2l0ZW0tPmlzX3J1bm5pbmcpOwogCiAgICAgcmV0dXJuICFfX2NzY2hlZF92
Y3B1X2lzX2NhY2hlX2hvdChwcnYsIHZjKSAmJgogICAgICAgICAgICBjcHVtYXNrX3Rlc3RfY3B1
KGRlc3RfY3B1LCBtYXNrKTsKQEAgLTEwNDcsNyArMTA0Nyw4IEBAIGNzY2hlZF9pdGVtX2luc2Vy
dChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF9pdGVtICppdGVtKQog
CiAgICAgbG9jayA9IGl0ZW1fc2NoZWR1bGVfbG9ja19pcnEoaXRlbSk7CiAKLSAgICBpZiAoICFf
X3ZjcHVfb25fcnVucShzdmMpICYmIHZjcHVfcnVubmFibGUodmMpICYmICF2Yy0+aXNfcnVubmlu
ZyApCisgICAgaWYgKCAhX192Y3B1X29uX3J1bnEoc3ZjKSAmJiB2Y3B1X3J1bm5hYmxlKHZjKSAm
JgorICAgICAgICAgIXZjLT5zY2hlZF9pdGVtLT5pc19ydW5uaW5nICkKICAgICAgICAgcnVucV9p
bnNlcnQoc3ZjKTsKIAogICAgIGl0ZW1fc2NoZWR1bGVfdW5sb2NrX2lycShsb2NrLCBpdGVtKTsK
QEAgLTE2NTksOCArMTY2MCw5IEBAIGNzY2hlZF9ydW5xX3N0ZWFsKGludCBwZWVyX2NwdSwgaW50
IGNwdSwgaW50IHByaSwgaW50IGJhbGFuY2Vfc3RlcCkKICAgICAgICAgICogdkNQVXMgd2l0aCB1
c2VmdWwgc29mdCBhZmZpbml0aWVzIGluIHNvbWUgc29ydCBvZiBiaXRtYXAKICAgICAgICAgICog
b3IgY291bnRlci4KICAgICAgICAgICovCi0gICAgICAgIGlmICggdmMtPmlzX3J1bm5pbmcgfHwg
KGJhbGFuY2Vfc3RlcCA9PSBCQUxBTkNFX1NPRlRfQUZGSU5JVFkgJiYKLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIWhhc19zb2Z0X2FmZmluaXR5KHZjLT5zY2hlZF9pdGVtKSkgKQor
ICAgICAgICBpZiAoIHZjLT5zY2hlZF9pdGVtLT5pc19ydW5uaW5nIHx8CisgICAgICAgICAgICAg
KGJhbGFuY2Vfc3RlcCA9PSBCQUxBTkNFX1NPRlRfQUZGSU5JVFkgJiYKKyAgICAgICAgICAgICAg
IWhhc19zb2Z0X2FmZmluaXR5KHZjLT5zY2hlZF9pdGVtKSkgKQogICAgICAgICAgICAgY29udGlu
dWU7CiAKICAgICAgICAgYWZmaW5pdHlfYmFsYW5jZV9jcHVtYXNrKHZjLT5zY2hlZF9pdGVtLCBi
YWxhbmNlX3N0ZXAsIGNwdW1hc2tfc2NyYXRjaCk7CkBAIC0xODY4LDcgKzE4NzAsNyBAQCBjc2No
ZWRfc2NoZWR1bGUoCiAgICAgICAgICAgICAgICAgICAgICh1bnNpZ25lZCBjaGFyICopJmQpOwog
ICAgIH0KIAotICAgIHJ1bnRpbWUgPSBub3cgLSBjdXJyZW50LT5ydW5zdGF0ZS5zdGF0ZV9lbnRy
eV90aW1lOworICAgIHJ1bnRpbWUgPSBub3cgLSBjdXJyZW50LT5zY2hlZF9pdGVtLT5zdGF0ZV9l
bnRyeV90aW1lOwogICAgIGlmICggcnVudGltZSA8IDAgKSAvKiBEb2VzIHRoaXMgZXZlciBoYXBw
ZW4/ICovCiAgICAgICAgIHJ1bnRpbWUgPSAwOwogCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3Nj
aGVkX2NyZWRpdDIuYyBiL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0Mi5jCmluZGV4IDliZjA0NWQy
MGYuLjBmMGQ2YTM4MDEgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0Mi5jCisr
KyBiL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0Mi5jCkBAIC0xMjgzLDcgKzEyODMsNyBAQCBydW5x
X2luc2VydChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBjc2NoZWQyX2l0ZW0g
KnN2YykKIAogICAgIEFTU0VSVCgmc3ZjLT5ycWQtPnJ1bnEgPT0gcnVucSk7CiAgICAgQVNTRVJU
KCFpc19pZGxlX3ZjcHUoc3ZjLT52Y3B1KSk7Ci0gICAgQVNTRVJUKCFzdmMtPnZjcHUtPmlzX3J1
bm5pbmcpOworICAgIEFTU0VSVCghc3ZjLT52Y3B1LT5zY2hlZF9pdGVtLT5pc19ydW5uaW5nKTsK
ICAgICBBU1NFUlQoIShzdmMtPmZsYWdzICYgQ1NGTEFHX3NjaGVkdWxlZCkpOwogCiAgICAgbGlz
dF9mb3JfZWFjaCggaXRlciwgcnVucSApCkBAIC0xMzQwLDggKzEzNDAsOCBAQCBzdGF0aWMgaW5s
aW5lIGJvb2wgaXNfcHJlZW1wdGFibGUoY29uc3Qgc3RydWN0IGNzY2hlZDJfaXRlbSAqc3ZjLAog
ICAgIGlmICggcmF0ZWxpbWl0IDw9IENTQ0hFRDJfUkFURUxJTUlUX1RJQ0tMRV9UT0xFUkFOQ0Ug
KQogICAgICAgICByZXR1cm4gdHJ1ZTsKIAotICAgIEFTU0VSVChzdmMtPnZjcHUtPmlzX3J1bm5p
bmcpOwotICAgIHJldHVybiBub3cgLSBzdmMtPnZjcHUtPnJ1bnN0YXRlLnN0YXRlX2VudHJ5X3Rp
bWUgPgorICAgIEFTU0VSVChzdmMtPnZjcHUtPnNjaGVkX2l0ZW0tPmlzX3J1bm5pbmcpOworICAg
IHJldHVybiBub3cgLSBzdmMtPnZjcHUtPnNjaGVkX2l0ZW0tPnN0YXRlX2VudHJ5X3RpbWUgPgog
ICAgICAgICAgICByYXRlbGltaXQgLSBDU0NIRUQyX1JBVEVMSU1JVF9USUNLTEVfVE9MRVJBTkNF
OwogfQogCkBAIC0yOTMxLDcgKzI5MzEsNyBAQCBjc2NoZWQyX2RvbV9jbnRsKAogICAgICAgICAg
ICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgc3ZjID0gY3NjaGVkMl9pdGVtKHYtPnNjaGVk
X2l0ZW0pOwogICAgICAgICAgICAgICAgICAgICBsb2NrID0gaXRlbV9zY2hlZHVsZV9sb2NrKHN2
Yy0+dmNwdS0+c2NoZWRfaXRlbSk7Ci0gICAgICAgICAgICAgICAgICAgIGlmICggdi0+aXNfcnVu
bmluZyApCisgICAgICAgICAgICAgICAgICAgIGlmICggdi0+c2NoZWRfaXRlbS0+aXNfcnVubmlu
ZyApCiAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2ln
bmVkIGludCBjcHUgPSB2LT5wcm9jZXNzb3I7CiAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1
Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQgPSBjMnJxZChvcHMsIGNwdSk7CkBAIC0zMjA0
LDggKzMyMDQsOCBAQCBjc2NoZWQyX3J1bnRpbWUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3Bz
LCBpbnQgY3B1LAogICAgIGlmICggcHJ2LT5yYXRlbGltaXRfdXMgKQogICAgIHsKICAgICAgICAg
c190aW1lX3QgcmF0ZWxpbWl0X21pbiA9IE1JQ1JPU0VDUyhwcnYtPnJhdGVsaW1pdF91cyk7Ci0g
ICAgICAgIGlmICggc25leHQtPnZjcHUtPmlzX3J1bm5pbmcgKQotICAgICAgICAgICAgcmF0ZWxp
bWl0X21pbiA9IHNuZXh0LT52Y3B1LT5ydW5zdGF0ZS5zdGF0ZV9lbnRyeV90aW1lICsKKyAgICAg
ICAgaWYgKCBzbmV4dC0+dmNwdS0+c2NoZWRfaXRlbS0+aXNfcnVubmluZyApCisgICAgICAgICAg
ICByYXRlbGltaXRfbWluID0gc25leHQtPnZjcHUtPnNjaGVkX2l0ZW0tPnN0YXRlX2VudHJ5X3Rp
bWUgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1JQ1JPU0VDUyhwcnYtPnJhdGVsaW1p
dF91cykgLSBub3c7CiAgICAgICAgIGlmICggcmF0ZWxpbWl0X21pbiA+IG1pbl90aW1lICkKICAg
ICAgICAgICAgIG1pbl90aW1lID0gcmF0ZWxpbWl0X21pbjsKQEAgLTMzMDIsNyArMzMwMiw3IEBA
IHJ1bnFfY2FuZGlkYXRlKHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCwKICAgICAg
KiBubyBwb2ludCBmb3JjaW5nIGl0IHRvIGRvIHNvIHVudGlsIHJhdGUgbGltaXRpbmcgZXhwaXJl
cy4KICAgICAgKi8KICAgICBpZiAoICF5aWVsZCAmJiBwcnYtPnJhdGVsaW1pdF91cyAmJiB2Y3B1
X3J1bm5hYmxlKHNjdXJyLT52Y3B1KSAmJgotICAgICAgICAgKG5vdyAtIHNjdXJyLT52Y3B1LT5y
dW5zdGF0ZS5zdGF0ZV9lbnRyeV90aW1lKSA8CisgICAgICAgICAobm93IC0gc2N1cnItPnZjcHUt
PnNjaGVkX2l0ZW0tPnN0YXRlX2VudHJ5X3RpbWUpIDwKICAgICAgICAgICBNSUNST1NFQ1MocHJ2
LT5yYXRlbGltaXRfdXMpICkKICAgICB7CiAgICAgICAgIGlmICggdW5saWtlbHkodGJfaW5pdF9k
b25lKSApCkBAIC0zMzEzLDcgKzMzMTMsNyBAQCBydW5xX2NhbmRpZGF0ZShzdHJ1Y3QgY3NjaGVk
Ml9ydW5xdWV1ZV9kYXRhICpycWQsCiAgICAgICAgICAgICB9IGQ7CiAgICAgICAgICAgICBkLmRv
bSA9IHNjdXJyLT52Y3B1LT5kb21haW4tPmRvbWFpbl9pZDsKICAgICAgICAgICAgIGQudmNwdSA9
IHNjdXJyLT52Y3B1LT52Y3B1X2lkOwotICAgICAgICAgICAgZC5ydW50aW1lID0gbm93IC0gc2N1
cnItPnZjcHUtPnJ1bnN0YXRlLnN0YXRlX2VudHJ5X3RpbWU7CisgICAgICAgICAgICBkLnJ1bnRp
bWUgPSBub3cgLSBzY3Vyci0+dmNwdS0+c2NoZWRfaXRlbS0+c3RhdGVfZW50cnlfdGltZTsKICAg
ICAgICAgICAgIF9fdHJhY2VfdmFyKFRSQ19DU0NIRUQyX1JBVEVMSU1JVCwgMSwKICAgICAgICAg
ICAgICAgICAgICAgICAgIHNpemVvZihkKSwKICAgICAgICAgICAgICAgICAgICAgICAgICh1bnNp
Z25lZCBjaGFyICopJmQpOwpAQCAtMzU2MSw3ICszNTYxLDcgQEAgY3NjaGVkMl9zY2hlZHVsZSgK
ICAgICAgICAgaWYgKCBzbmV4dCAhPSBzY3VyciApCiAgICAgICAgIHsKICAgICAgICAgICAgIEFT
U0VSVChzbmV4dC0+cnFkID09IHJxZCk7Ci0gICAgICAgICAgICBBU1NFUlQoIXNuZXh0LT52Y3B1
LT5pc19ydW5uaW5nKTsKKyAgICAgICAgICAgIEFTU0VSVCghc25leHQtPnZjcHUtPnNjaGVkX2l0
ZW0tPmlzX3J1bm5pbmcpOwogCiAgICAgICAgICAgICBydW5xX3JlbW92ZShzbmV4dCk7CiAgICAg
ICAgICAgICBfX3NldF9iaXQoX19DU0ZMQUdfc2NoZWR1bGVkLCAmc25leHQtPmZsYWdzKTsKZGlm
ZiAtLWdpdCBhL3hlbi9jb21tb24vc2NoZWRfcnQuYyBiL3hlbi9jb21tb24vc2NoZWRfcnQuYwpp
bmRleCAzNzRhOWQyMzgzLi4xODYxZWY4YzQxIDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL3NjaGVk
X3J0LmMKKysrIGIveGVuL2NvbW1vbi9zY2hlZF9ydC5jCkBAIC05MTQsNyArOTE0LDcgQEAgcnRf
aXRlbV9pbnNlcnQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfaXRl
bSAqaXRlbSkKICAgICB7CiAgICAgICAgIHJlcGxxX2luc2VydChvcHMsIHN2Yyk7CiAKLSAgICAg
ICAgaWYgKCAhdmMtPmlzX3J1bm5pbmcgKQorICAgICAgICBpZiAoICFpdGVtLT5pc19ydW5uaW5n
ICkKICAgICAgICAgICAgIHJ1bnFfaW5zZXJ0KG9wcywgc3ZjKTsKICAgICB9CiAgICAgaXRlbV9z
Y2hlZHVsZV91bmxvY2tfaXJxKGxvY2ssIGl0ZW0pOwpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9z
Y2hlZHVsZS5jIGIveGVuL2NvbW1vbi9zY2hlZHVsZS5jCmluZGV4IDJhMmYzNjYzNmEuLmRmZDI2
MWQwMjkgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWR1bGUuYworKysgYi94ZW4vY29tbW9u
L3NjaGVkdWxlLmMKQEAgLTM1Myw2ICszNTMsOCBAQCBpbnQgc2NoZWRfaW5pdF92Y3B1KHN0cnVj
dCB2Y3B1ICp2LCB1bnNpZ25lZCBpbnQgcHJvY2Vzc29yKQogICAgIHsKICAgICAgICAgcGVyX2Nw
dShzY2hlZF9yZXMsIHYtPnByb2Nlc3NvciktPmN1cnIgPSBpdGVtOwogICAgICAgICB2LT5pc19y
dW5uaW5nID0gMTsKKyAgICAgICAgaXRlbS0+aXNfcnVubmluZyA9IDE7CisgICAgICAgIGl0ZW0t
PnN0YXRlX2VudHJ5X3RpbWUgPSBOT1coKTsKICAgICB9CiAgICAgZWxzZQogICAgIHsKQEAgLTY3
Myw3ICs2NzUsOCBAQCBzdGF0aWMgdm9pZCB2Y3B1X21pZ3JhdGVfZmluaXNoKHN0cnVjdCB2Y3B1
ICp2KQogICAgICAqIGNvbnRleHRfc2F2ZWQoKTsgYW5kIGluIGFueSBjYXNlLCBpZiB0aGUgYml0
IGlzIGNsZWFyZWQsIHRoZW4KICAgICAgKiBzb21lb25lIGVsc2UgaGFzIGFscmVhZHkgZG9uZSB0
aGUgd29yayBzbyB3ZSBkb24ndCBuZWVkIHRvLgogICAgICAqLwotICAgIGlmICggdi0+aXNfcnVu
bmluZyB8fCAhdGVzdF9iaXQoX1ZQRl9taWdyYXRpbmcsICZ2LT5wYXVzZV9mbGFncykgKQorICAg
IGlmICggdi0+c2NoZWRfaXRlbS0+aXNfcnVubmluZyB8fAorICAgICAgICAgIXRlc3RfYml0KF9W
UEZfbWlncmF0aW5nLCAmdi0+cGF1c2VfZmxhZ3MpICkKICAgICAgICAgcmV0dXJuOwogCiAgICAg
b2xkX2NwdSA9IG5ld19jcHUgPSB2LT5wcm9jZXNzb3I7CkBAIC03MjcsNyArNzMwLDcgQEAgc3Rh
dGljIHZvaWQgdmNwdV9taWdyYXRlX2ZpbmlzaChzdHJ1Y3QgdmNwdSAqdikKICAgICAgKiBiZWNh
dXNlIHRoZXkgYm90aCBoYXBwZW4gaW4gKGRpZmZlcmVudCkgc3BpbmxvY2sgcmVnaW9ucywgYW5k
IHRob3NlCiAgICAgICogcmVnaW9ucyBhcmUgc3RyaWN0bHkgc2VyaWFsaXNlZC4KICAgICAgKi8K
LSAgICBpZiAoIHYtPmlzX3J1bm5pbmcgfHwKKyAgICBpZiAoIHYtPnNjaGVkX2l0ZW0tPmlzX3J1
bm5pbmcgfHwKICAgICAgICAgICF0ZXN0X2FuZF9jbGVhcl9iaXQoX1ZQRl9taWdyYXRpbmcsICZ2
LT5wYXVzZV9mbGFncykgKQogICAgIHsKICAgICAgICAgc2NoZWRfc3Bpbl91bmxvY2tfZG91Ymxl
KG9sZF9sb2NrLCBuZXdfbG9jaywgZmxhZ3MpOwpAQCAtNzU1LDcgKzc1OCw3IEBAIHZvaWQgdmNw
dV9mb3JjZV9yZXNjaGVkdWxlKHN0cnVjdCB2Y3B1ICp2KQogewogICAgIHNwaW5sb2NrX3QgKmxv
Y2sgPSBpdGVtX3NjaGVkdWxlX2xvY2tfaXJxKHYtPnNjaGVkX2l0ZW0pOwogCi0gICAgaWYgKCB2
LT5pc19ydW5uaW5nICkKKyAgICBpZiAoIHYtPnNjaGVkX2l0ZW0tPmlzX3J1bm5pbmcgKQogICAg
ICAgICB2Y3B1X21pZ3JhdGVfc3RhcnQodik7CiAKICAgICBpdGVtX3NjaGVkdWxlX3VubG9ja19p
cnEobG9jaywgdi0+c2NoZWRfaXRlbSk7CkBAIC0xNTgyLDggKzE1ODUsMTAgQEAgc3RhdGljIHZv
aWQgc2NoZWR1bGUodm9pZCkKICAgICAgKiBzd2l0Y2gsIGVsc2UgbG9zdF9yZWNvcmRzIHJlc3Vt
ZSB3aWxsIG5vdCB3b3JrIHByb3Blcmx5LgogICAgICAqLwogCi0gICAgQVNTRVJUKCFuZXh0LT5p
c19ydW5uaW5nKTsKKyAgICBBU1NFUlQoIW5leHQtPnNjaGVkX2l0ZW0tPmlzX3J1bm5pbmcpOwog
ICAgIG5leHQtPmlzX3J1bm5pbmcgPSAxOworICAgIG5leHQtPnNjaGVkX2l0ZW0tPmlzX3J1bm5p
bmcgPSAxOworICAgIG5leHQtPnNjaGVkX2l0ZW0tPnN0YXRlX2VudHJ5X3RpbWUgPSBub3c7CiAK
ICAgICBwY3B1X3NjaGVkdWxlX3VubG9ja19pcnEobG9jaywgY3B1KTsKIApAQCAtMTYwNSw2ICsx
NjEwLDggQEAgdm9pZCBjb250ZXh0X3NhdmVkKHN0cnVjdCB2Y3B1ICpwcmV2KQogICAgIHNtcF93
bWIoKTsKIAogICAgIHByZXYtPmlzX3J1bm5pbmcgPSAwOworICAgIHByZXYtPnNjaGVkX2l0ZW0t
PmlzX3J1bm5pbmcgPSAwOworICAgIHByZXYtPnNjaGVkX2l0ZW0tPnN0YXRlX2VudHJ5X3RpbWUg
PSBOT1coKTsKIAogICAgIC8qIENoZWNrIGZvciBtaWdyYXRpb24gcmVxdWVzdCAvYWZ0ZXIvIGNs
ZWFyaW5nIHJ1bm5pbmcgZmxhZy4gKi8KICAgICBzbXBfbWIoKTsKZGlmZiAtLWdpdCBhL3hlbi9p
bmNsdWRlL3hlbi9zY2hlZC5oIGIveGVuL2luY2x1ZGUveGVuL3NjaGVkLmgKaW5kZXggY2U3ZWFk
OTk3MS4uZGExMTczNjVhZiAxMDA2NDQKLS0tIGEveGVuL2luY2x1ZGUveGVuL3NjaGVkLmgKKysr
IGIveGVuL2luY2x1ZGUveGVuL3NjaGVkLmgKQEAgLTI3MCw3ICsyNzAsMTEgQEAgc3RydWN0IHNj
aGVkX2l0ZW0gewogCiAgICAgLyogTGFzdCB0aW1lIHdoZW4gaXRlbSBoYXMgYmVlbiBzY2hlZHVs
ZWQgb3V0LiAqLwogICAgIHVpbnQ2NF90ICAgICAgICAgICAgICAgbGFzdF9ydW5fdGltZTsKKyAg
ICAvKiBMYXN0IHRpbWUgaXRlbSBnb3QgKGRlLSlzY2hlZHVsZWQuICovCisgICAgdWludDY0X3Qg
ICAgICAgICAgICAgICBzdGF0ZV9lbnRyeV90aW1lOwogCisgICAgLyogQ3VycmVudGx5IHJ1bm5p
bmcgb24gYSBDUFU/ICovCisgICAgYm9vbCAgICAgICAgICAgICAgICAgICBpc19ydW5uaW5nOwog
ICAgIC8qIEl0ZW0gbmVlZHMgYWZmaW5pdHkgcmVzdG9yZWQuICovCiAgICAgYm9vbCAgICAgICAg
ICAgICAgICAgICBhZmZpbml0eV9icm9rZW47CiAgICAgLyogRG9lcyBzb2Z0IGFmZmluaXR5IGFj
dHVhbGx5IHBsYXkgYSByb2xlIChnaXZlbiBoYXJkIGFmZmluaXR5KT8gKi8KLS0gCjIuMTYuNAoK
Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZl
bCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlz
dHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

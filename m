Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id E2BFA11308B
	for <lists+xen-devel@lfdr.de>; Wed,  4 Dec 2019 18:13:37 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1icYBY-0003e8-05; Wed, 04 Dec 2019 17:11:32 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=pQYo=Z2=amazon.com=prvs=234ed30ac=hongyxia@srs-us1.protection.inumbo.net>)
 id 1icYBV-0003dJ-R2
 for xen-devel@lists.xenproject.org; Wed, 04 Dec 2019 17:11:29 +0000
X-Inumbo-ID: 1913caa3-16b9-11ea-8206-12813bfff9fa
Received: from smtp-fw-33001.amazon.com (unknown [207.171.190.10])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 1913caa3-16b9-11ea-8206-12813bfff9fa;
 Wed, 04 Dec 2019 17:11:24 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amazon.com; i=@amazon.com; q=dns/txt; s=amazon201209;
 t=1575479485; x=1607015485;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version;
 bh=JfBjHGTtieYsBSyBebnsZQmdwI9lEcNcATx/cmQduiE=;
 b=CkvG5aPb27AAAmNHMKkD5KUOEkxnutOAYhqaJai02U2fO/hKKEeqriSq
 xGB4Kwf8dvkIxNgw7oGUDsRXLnhfHQXRgfrnpjKguayiCjpTXtIjthAeG
 JCrTJJzUNwTjgf8HvNTRzbbdqYmq9A7U6EmLU9UZNSan8tf8aWv+Uun9y Y=;
IronPort-SDR: f1wTML/VG1MXMXnDBRHhbJm+OBe3hZFxnz1Nn9Jwp44vWbRtwAgr7XS1013iMGk9jOjUI6Rqbq
 QI2xLj6ztajQ==
X-IronPort-AV: E=Sophos;i="5.69,277,1571702400"; d="scan'208";a="13005452"
Received: from sea32-co-svc-lb4-vlan3.sea.corp.amazon.com (HELO
 email-inbound-relay-2c-87a10be6.us-west-2.amazon.com) ([10.47.23.38])
 by smtp-border-fw-out-33001.sea14.amazon.com with ESMTP;
 04 Dec 2019 17:11:08 +0000
Received: from EX13MTAUWA001.ant.amazon.com
 (pdx4-ws-svc-p6-lb7-vlan2.pdx.amazon.com [10.170.41.162])
 by email-inbound-relay-2c-87a10be6.us-west-2.amazon.com (Postfix) with ESMTPS
 id 26C70A1C82; Wed,  4 Dec 2019 17:11:08 +0000 (UTC)
Received: from EX13D19UWA001.ant.amazon.com (10.43.160.169) by
 EX13MTAUWA001.ant.amazon.com (10.43.160.118) with Microsoft SMTP Server (TLS)
 id 15.0.1367.3; Wed, 4 Dec 2019 17:11:08 +0000
Received: from EX13MTAUWA001.ant.amazon.com (10.43.160.58) by
 EX13D19UWA001.ant.amazon.com (10.43.160.169) with Microsoft SMTP Server (TLS)
 id 15.0.1367.3; Wed, 4 Dec 2019 17:11:07 +0000
Received: from u60d575063b1f53.ant.amazon.com (10.125.106.64) by
 mail-relay.amazon.com (10.43.160.118) with Microsoft SMTP Server id
 15.0.1367.3 via Frontend Transport; Wed, 4 Dec 2019 17:11:06 +0000
From: Hongyan Xia <hongyxia@amazon.com>
To: <xen-devel@lists.xenproject.org>
Date: Wed, 4 Dec 2019 17:10:55 +0000
Message-ID: <032b7288fc1606a68dc18cf5709c83540717f38a.1575477921.git.hongyxia@amazon.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <cover.1575477921.git.hongyxia@amazon.com>
References: <cover.1575477921.git.hongyxia@amazon.com>
MIME-Version: 1.0
Precedence: Bulk
Subject: [Xen-devel] [PATCH v4 3/9] x86/mm: introduce l{1,
 2}t local variables to map_pages_to_xen
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>, Wei Liu <wl@xen.org>,
 Jan Beulich <jbeulich@suse.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

RnJvbTogV2VpIExpdSA8d2VpLmxpdTJAY2l0cml4LmNvbT4KClRoZSBwbDJlIGFuZCBwbDFlIHZh
cmlhYmxlcyBhcmUgaGVhdmlseSAoYWIpdXNlZCBpbiB0aGF0IGZ1bmN0aW9uLiBJdAppcyBmaW5l
IGF0IHRoZSBtb21lbnQgYmVjYXVzZSBhbGwgcGFnZSB0YWJsZXMgYXJlIGFsd2F5cyBtYXBwZWQg
c28KdGhlcmUgaXMgbm8gbmVlZCB0byB0cmFjayB0aGUgbGlmZSB0aW1lIG9mIGVhY2ggdmFyaWFi
bGUuCgpXZSB3aWxsIHNvb24gaGF2ZSB0aGUgcmVxdWlyZW1lbnQgdG8gbWFwIGFuZCB1bm1hcCBw
YWdlIHRhYmxlcy4gV2UKbmVlZCB0byB0cmFjayB0aGUgbGlmZSB0aW1lIG9mIGVhY2ggdmFyaWFi
bGUgdG8gYXZvaWQgbGVha2FnZS4KCkludHJvZHVjZSBzb21lIGx7MSwyfXQgdmFyaWFibGVzIHdp
dGggbGltaXRlZCBzY29wZSBzbyB0aGF0IHdlIGNhbgp0cmFjayBsaWZlIHRpbWUgb2YgcG9pbnRl
cnMgdG8geGVuIHBhZ2UgdGFibGVzIG1vcmUgZWFzaWx5LgoKTm8gZnVuY3Rpb25hbCBjaGFuZ2Uu
CgpTaWduZWQtb2ZmLWJ5OiBXZWkgTGl1IDx3ZWkubGl1MkBjaXRyaXguY29tPgpSZXZpZXdlZC1i
eTogSmFuIEJldWxpY2ggPGpiZXVsaWNoQHN1c2UuY29tPgotLS0KIHhlbi9hcmNoL3g4Ni9tbS5j
IHwgNzUgKysrKysrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLS0tLS0KIDEg
ZmlsZSBjaGFuZ2VkLCA0MiBpbnNlcnRpb25zKCspLCAzMyBkZWxldGlvbnMoLSkKCmRpZmYgLS1n
aXQgYS94ZW4vYXJjaC94ODYvbW0uYyBiL3hlbi9hcmNoL3g4Ni9tbS5jCmluZGV4IGNhMzYyYWQ2
MzguLjc5MDU3OGQyYjMgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9tbS5jCisrKyBiL3hlbi9h
cmNoL3g4Ni9tbS5jCkBAIC01MjM0LDEwICs1MjM0LDEyIEBAIGludCBtYXBfcGFnZXNfdG9feGVu
KAogICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg
ICAgewotICAgICAgICAgICAgICAgICAgICBwbDJlID0gbDNlX3RvX2wyZShvbDNlKTsKKyAgICAg
ICAgICAgICAgICAgICAgbDJfcGdlbnRyeV90ICpsMnQ7CisKKyAgICAgICAgICAgICAgICAgICAg
bDJ0ID0gbDNlX3RvX2wyZShvbDNlKTsKICAgICAgICAgICAgICAgICAgICAgZm9yICggaSA9IDA7
IGkgPCBMMl9QQUdFVEFCTEVfRU5UUklFUzsgaSsrICkKICAgICAgICAgICAgICAgICAgICAgewot
ICAgICAgICAgICAgICAgICAgICAgICAgb2wyZSA9IHBsMmVbaV07CisgICAgICAgICAgICAgICAg
ICAgICAgICBvbDJlID0gbDJ0W2ldOwogICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhKGwy
ZV9nZXRfZmxhZ3Mob2wyZSkgJiBfUEFHRV9QUkVTRU5UKSApCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGwyZV9nZXRf
ZmxhZ3Mob2wyZSkgJiBfUEFHRV9QU0UgKQpAQCAtNTI0NSwyMSArNTI0NywyMiBAQCBpbnQgbWFw
X3BhZ2VzX3RvX3hlbigKICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg
ICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQg
ajsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBsMV9wZ2VudHJ5X3QgKmwxdDsKIAotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHBsMWUgPSBsMmVfdG9fbDFlKG9sMmUpOworICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGwxdCA9IGwyZV90b19sMWUob2wyZSk7CiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgZm9yICggaiA9IDA7IGogPCBMMV9QQUdFVEFCTEVfRU5UUklFUzsg
aisrICkKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmx1c2hfZmxhZ3MobDFlX2dl
dF9mbGFncyhwbDFlW2pdKSk7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZsdXNo
X2ZsYWdzKGwxZV9nZXRfZmxhZ3MobDF0W2pdKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICB9
CiAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgZmx1c2hfYXJlYSh2
aXJ0LCBmbHVzaF9mbGFncyk7CiAgICAgICAgICAgICAgICAgICAgIGZvciAoIGkgPSAwOyBpIDwg
TDJfUEFHRVRBQkxFX0VOVFJJRVM7IGkrKyApCiAgICAgICAgICAgICAgICAgICAgIHsKLSAgICAg
ICAgICAgICAgICAgICAgICAgIG9sMmUgPSBwbDJlW2ldOworICAgICAgICAgICAgICAgICAgICAg
ICAgb2wyZSA9IGwydFtpXTsKICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggKGwyZV9nZXRf
ZmxhZ3Mob2wyZSkgJiBfUEFHRV9QUkVTRU5UKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAhKGwyZV9nZXRfZmxhZ3Mob2wyZSkgJiBfUEFHRV9QU0UpICkKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBmcmVlX3hlbl9wYWdldGFibGUobDJlX3RvX2wxZShvbDJlKSk7CiAgICAg
ICAgICAgICAgICAgICAgIH0KLSAgICAgICAgICAgICAgICAgICAgZnJlZV94ZW5fcGFnZXRhYmxl
KHBsMmUpOworICAgICAgICAgICAgICAgICAgICBmcmVlX3hlbl9wYWdldGFibGUobDJ0KTsKICAg
ICAgICAgICAgICAgICB9CiAgICAgICAgICAgICB9CiAKQEAgLTUyNzUsNiArNTI3OCw3IEBAIGlu
dCBtYXBfcGFnZXNfdG9feGVuKAogICAgICAgICB7CiAgICAgICAgICAgICB1bnNpZ25lZCBpbnQg
Zmx1c2hfZmxhZ3MgPQogICAgICAgICAgICAgICAgIEZMVVNIX1RMQiB8IEZMVVNIX09SREVSKDIg
KiBQQUdFVEFCTEVfT1JERVIpOworICAgICAgICAgICAgbDJfcGdlbnRyeV90ICpsMnQ7CiAKICAg
ICAgICAgICAgIC8qIFNraXAgdGhpcyBQVEUgaWYgdGhlcmUgaXMgbm8gY2hhbmdlLiAqLwogICAg
ICAgICAgICAgaWYgKCAoKGwzZV9nZXRfcGZuKG9sM2UpICYgfihMMl9QQUdFVEFCTEVfRU5UUklF
UyAqCkBAIC01Mjk2LDEyICs1MzAwLDEyIEBAIGludCBtYXBfcGFnZXNfdG9feGVuKAogICAgICAg
ICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgfQogCi0gICAgICAgICAgICBwbDJlID0g
YWxsb2NfeGVuX3BhZ2V0YWJsZSgpOwotICAgICAgICAgICAgaWYgKCBwbDJlID09IE5VTEwgKQor
ICAgICAgICAgICAgbDJ0ID0gYWxsb2NfeGVuX3BhZ2V0YWJsZSgpOworICAgICAgICAgICAgaWYg
KCBsMnQgPT0gTlVMTCApCiAgICAgICAgICAgICAgICAgcmV0dXJuIC1FTk9NRU07CiAKICAgICAg
ICAgICAgIGZvciAoIGkgPSAwOyBpIDwgTDJfUEFHRVRBQkxFX0VOVFJJRVM7IGkrKyApCi0gICAg
ICAgICAgICAgICAgbDJlX3dyaXRlKHBsMmUgKyBpLAorICAgICAgICAgICAgICAgIGwyZV93cml0
ZShsMnQgKyBpLAogICAgICAgICAgICAgICAgICAgICAgICAgICBsMmVfZnJvbV9wZm4obDNlX2dl
dF9wZm4ob2wzZSkgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGkg
PDwgUEFHRVRBQkxFX09SREVSKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGwzZV9nZXRfZmxhZ3Mob2wzZSkpKTsKQEAgLTUzMTQsMTUgKzUzMTgsMTUgQEAgaW50IG1h
cF9wYWdlc190b194ZW4oCiAgICAgICAgICAgICBpZiAoIChsM2VfZ2V0X2ZsYWdzKCpwbDNlKSAm
IF9QQUdFX1BSRVNFTlQpICYmCiAgICAgICAgICAgICAgICAgIChsM2VfZ2V0X2ZsYWdzKCpwbDNl
KSAmIF9QQUdFX1BTRSkgKQogICAgICAgICAgICAgewotICAgICAgICAgICAgICAgIGwzZV93cml0
ZV9hdG9taWMocGwzZSwgbDNlX2Zyb21fbWZuKHZpcnRfdG9fbWZuKHBsMmUpLAorICAgICAgICAg
ICAgICAgIGwzZV93cml0ZV9hdG9taWMocGwzZSwgbDNlX2Zyb21fbWZuKHZpcnRfdG9fbWZuKGwy
dCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
X19QQUdFX0hZUEVSVklTT1IpKTsKLSAgICAgICAgICAgICAgICBwbDJlID0gTlVMTDsKKyAgICAg
ICAgICAgICAgICBsMnQgPSBOVUxMOwogICAgICAgICAgICAgfQogICAgICAgICAgICAgaWYgKCBs
b2NraW5nICkKICAgICAgICAgICAgICAgICBzcGluX3VubG9jaygmbWFwX3BnZGlyX2xvY2spOwog
ICAgICAgICAgICAgZmx1c2hfYXJlYSh2aXJ0LCBmbHVzaF9mbGFncyk7Ci0gICAgICAgICAgICBp
ZiAoIHBsMmUgKQotICAgICAgICAgICAgICAgIGZyZWVfeGVuX3BhZ2V0YWJsZShwbDJlKTsKKyAg
ICAgICAgICAgIGlmICggbDJ0ICkKKyAgICAgICAgICAgICAgICBmcmVlX3hlbl9wYWdldGFibGUo
bDJ0KTsKICAgICAgICAgfQogCiAgICAgICAgIHBsMmUgPSB2aXJ0X3RvX3hlbl9sMmUodmlydCk7
CkBAIC01MzUwLDExICs1MzU0LDEzIEBAIGludCBtYXBfcGFnZXNfdG9feGVuKAogICAgICAgICAg
ICAgICAgIH0KICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgewotICAgICAg
ICAgICAgICAgICAgICBwbDFlID0gbDJlX3RvX2wxZShvbDJlKTsKKyAgICAgICAgICAgICAgICAg
ICAgbDFfcGdlbnRyeV90ICpsMXQ7CisKKyAgICAgICAgICAgICAgICAgICAgbDF0ID0gbDJlX3Rv
X2wxZShvbDJlKTsKICAgICAgICAgICAgICAgICAgICAgZm9yICggaSA9IDA7IGkgPCBMMV9QQUdF
VEFCTEVfRU5UUklFUzsgaSsrICkKLSAgICAgICAgICAgICAgICAgICAgICAgIGZsdXNoX2ZsYWdz
KGwxZV9nZXRfZmxhZ3MocGwxZVtpXSkpOworICAgICAgICAgICAgICAgICAgICAgICAgZmx1c2hf
ZmxhZ3MobDFlX2dldF9mbGFncyhsMXRbaV0pKTsKICAgICAgICAgICAgICAgICAgICAgZmx1c2hf
YXJlYSh2aXJ0LCBmbHVzaF9mbGFncyk7Ci0gICAgICAgICAgICAgICAgICAgIGZyZWVfeGVuX3Bh
Z2V0YWJsZShwbDFlKTsKKyAgICAgICAgICAgICAgICAgICAgZnJlZV94ZW5fcGFnZXRhYmxlKGwx
dCk7CiAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgfQogCkBAIC01Mzc2LDYgKzUzODIs
NyBAQCBpbnQgbWFwX3BhZ2VzX3RvX3hlbigKICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAg
ICB1bnNpZ25lZCBpbnQgZmx1c2hfZmxhZ3MgPQogICAgICAgICAgICAgICAgICAgICBGTFVTSF9U
TEIgfCBGTFVTSF9PUkRFUihQQUdFVEFCTEVfT1JERVIpOworICAgICAgICAgICAgICAgIGwxX3Bn
ZW50cnlfdCAqbDF0OwogCiAgICAgICAgICAgICAgICAgLyogU2tpcCB0aGlzIFBURSBpZiB0aGVy
ZSBpcyBubyBjaGFuZ2UuICovCiAgICAgICAgICAgICAgICAgaWYgKCAoKChsMmVfZ2V0X3Bmbigq
cGwyZSkgJiB+KEwxX1BBR0VUQUJMRV9FTlRSSUVTIC0gMSkpICsKQEAgLTUzOTUsMTIgKzU0MDIs
MTIgQEAgaW50IG1hcF9wYWdlc190b194ZW4oCiAgICAgICAgICAgICAgICAgICAgIGdvdG8gY2hl
Y2tfbDM7CiAgICAgICAgICAgICAgICAgfQogCi0gICAgICAgICAgICAgICAgcGwxZSA9IGFsbG9j
X3hlbl9wYWdldGFibGUoKTsKLSAgICAgICAgICAgICAgICBpZiAoIHBsMWUgPT0gTlVMTCApCisg
ICAgICAgICAgICAgICAgbDF0ID0gYWxsb2NfeGVuX3BhZ2V0YWJsZSgpOworICAgICAgICAgICAg
ICAgIGlmICggbDF0ID09IE5VTEwgKQogICAgICAgICAgICAgICAgICAgICByZXR1cm4gLUVOT01F
TTsKIAogICAgICAgICAgICAgICAgIGZvciAoIGkgPSAwOyBpIDwgTDFfUEFHRVRBQkxFX0VOVFJJ
RVM7IGkrKyApCi0gICAgICAgICAgICAgICAgICAgIGwxZV93cml0ZSgmcGwxZVtpXSwKKyAgICAg
ICAgICAgICAgICAgICAgbDFlX3dyaXRlKCZsMXRbaV0sCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBsMWVfZnJvbV9wZm4obDJlX2dldF9wZm4oKnBsMmUpICsgaSwKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsTmZfdG9fbDFmKGwyZV9nZXRfZmxhZ3Mo
KnBsMmUpKSkpOwogCkBAIC01NDEyLDE1ICs1NDE5LDE1IEBAIGludCBtYXBfcGFnZXNfdG9feGVu
KAogICAgICAgICAgICAgICAgIGlmICggKGwyZV9nZXRfZmxhZ3MoKnBsMmUpICYgX1BBR0VfUFJF
U0VOVCkgJiYKICAgICAgICAgICAgICAgICAgICAgIChsMmVfZ2V0X2ZsYWdzKCpwbDJlKSAmIF9Q
QUdFX1BTRSkgKQogICAgICAgICAgICAgICAgIHsKLSAgICAgICAgICAgICAgICAgICAgbDJlX3dy
aXRlX2F0b21pYyhwbDJlLCBsMmVfZnJvbV9tZm4odmlydF90b19tZm4ocGwxZSksCisgICAgICAg
ICAgICAgICAgICAgIGwyZV93cml0ZV9hdG9taWMocGwyZSwgbDJlX2Zyb21fbWZuKHZpcnRfdG9f
bWZuKGwxdCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIF9fUEFHRV9IWVBFUlZJU09SKSk7Ci0gICAgICAgICAgICAgICAgICAgIHBsMWUg
PSBOVUxMOworICAgICAgICAgICAgICAgICAgICBsMXQgPSBOVUxMOwogICAgICAgICAgICAgICAg
IH0KICAgICAgICAgICAgICAgICBpZiAoIGxvY2tpbmcgKQogICAgICAgICAgICAgICAgICAgICBz
cGluX3VubG9jaygmbWFwX3BnZGlyX2xvY2spOwogICAgICAgICAgICAgICAgIGZsdXNoX2FyZWEo
dmlydCwgZmx1c2hfZmxhZ3MpOwotICAgICAgICAgICAgICAgIGlmICggcGwxZSApCi0gICAgICAg
ICAgICAgICAgICAgIGZyZWVfeGVuX3BhZ2V0YWJsZShwbDFlKTsKKyAgICAgICAgICAgICAgICBp
ZiAoIGwxdCApCisgICAgICAgICAgICAgICAgICAgIGZyZWVfeGVuX3BhZ2V0YWJsZShsMXQpOwog
ICAgICAgICAgICAgfQogCiAgICAgICAgICAgICBwbDFlICA9IGwyZV90b19sMWUoKnBsMmUpICsg
bDFfdGFibGVfb2Zmc2V0KHZpcnQpOwpAQCAtNTQ0NSw2ICs1NDUyLDcgQEAgaW50IG1hcF9wYWdl
c190b194ZW4oCiAgICAgICAgICAgICAgICAgICAgICgoMXUgPDwgUEFHRVRBQkxFX09SREVSKSAt
IDEpKSA9PSAwKSkgKQogICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIHVuc2lnbmVkIGxv
bmcgYmFzZV9tZm47CisgICAgICAgICAgICAgICAgbDFfcGdlbnRyeV90ICpsMXQ7CiAKICAgICAg
ICAgICAgICAgICBpZiAoIGxvY2tpbmcgKQogICAgICAgICAgICAgICAgICAgICBzcGluX2xvY2so
Jm1hcF9wZ2Rpcl9sb2NrKTsKQEAgLTU0NjgsMTEgKzU0NzYsMTEgQEAgaW50IG1hcF9wYWdlc190
b194ZW4oCiAgICAgICAgICAgICAgICAgICAgIGdvdG8gY2hlY2tfbDM7CiAgICAgICAgICAgICAg
ICAgfQogCi0gICAgICAgICAgICAgICAgcGwxZSA9IGwyZV90b19sMWUob2wyZSk7Ci0gICAgICAg
ICAgICAgICAgYmFzZV9tZm4gPSBsMWVfZ2V0X3BmbigqcGwxZSkgJiB+KEwxX1BBR0VUQUJMRV9F
TlRSSUVTIC0gMSk7Ci0gICAgICAgICAgICAgICAgZm9yICggaSA9IDA7IGkgPCBMMV9QQUdFVEFC
TEVfRU5UUklFUzsgaSsrLCBwbDFlKysgKQotICAgICAgICAgICAgICAgICAgICBpZiAoIChsMWVf
Z2V0X3BmbigqcGwxZSkgIT0gKGJhc2VfbWZuICsgaSkpIHx8Ci0gICAgICAgICAgICAgICAgICAg
ICAgICAgKGwxZV9nZXRfZmxhZ3MoKnBsMWUpICE9IGZsYWdzKSApCisgICAgICAgICAgICAgICAg
bDF0ID0gbDJlX3RvX2wxZShvbDJlKTsKKyAgICAgICAgICAgICAgICBiYXNlX21mbiA9IGwxZV9n
ZXRfcGZuKGwxdFswXSkgJiB+KEwxX1BBR0VUQUJMRV9FTlRSSUVTIC0gMSk7CisgICAgICAgICAg
ICAgICAgZm9yICggaSA9IDA7IGkgPCBMMV9QQUdFVEFCTEVfRU5UUklFUzsgaSsrICkKKyAgICAg
ICAgICAgICAgICAgICAgaWYgKCAobDFlX2dldF9wZm4obDF0W2ldKSAhPSAoYmFzZV9tZm4gKyBp
KSkgfHwKKyAgICAgICAgICAgICAgICAgICAgICAgICAobDFlX2dldF9mbGFncyhsMXRbaV0pICE9
IGZsYWdzKSApCiAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg
ICBpZiAoIGkgPT0gTDFfUEFHRVRBQkxFX0VOVFJJRVMgKQogICAgICAgICAgICAgICAgIHsKQEAg
LTU0OTgsNiArNTUwNiw3IEBAIGludCBtYXBfcGFnZXNfdG9feGVuKAogICAgICAgICAgICAgICAg
ICgoMVVMIDw8IChMM19QQUdFVEFCTEVfU0hJRlQgLSBQQUdFX1NISUZUKSkgLSAxKSkpICkKICAg
ICAgICAgewogICAgICAgICAgICAgdW5zaWduZWQgbG9uZyBiYXNlX21mbjsKKyAgICAgICAgICAg
IGwyX3BnZW50cnlfdCAqbDJ0OwogCiAgICAgICAgICAgICBpZiAoIGxvY2tpbmcgKQogICAgICAg
ICAgICAgICAgIHNwaW5fbG9jaygmbWFwX3BnZGlyX2xvY2spOwpAQCAtNTUxNSwxMyArNTUyNCwx
MyBAQCBpbnQgbWFwX3BhZ2VzX3RvX3hlbigKICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAg
ICAgICAgICAgIH0KIAotICAgICAgICAgICAgcGwyZSA9IGwzZV90b19sMmUob2wzZSk7Ci0gICAg
ICAgICAgICBiYXNlX21mbiA9IGwyZV9nZXRfcGZuKCpwbDJlKSAmIH4oTDJfUEFHRVRBQkxFX0VO
VFJJRVMgKgorICAgICAgICAgICAgbDJ0ID0gbDNlX3RvX2wyZShvbDNlKTsKKyAgICAgICAgICAg
IGJhc2VfbWZuID0gbDJlX2dldF9wZm4obDJ0WzBdKSAmIH4oTDJfUEFHRVRBQkxFX0VOVFJJRVMg
KgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEwxX1BBR0VU
QUJMRV9FTlRSSUVTIC0gMSk7Ci0gICAgICAgICAgICBmb3IgKCBpID0gMDsgaSA8IEwyX1BBR0VU
QUJMRV9FTlRSSUVTOyBpKyssIHBsMmUrKyApCi0gICAgICAgICAgICAgICAgaWYgKCAobDJlX2dl
dF9wZm4oKnBsMmUpICE9CisgICAgICAgICAgICBmb3IgKCBpID0gMDsgaSA8IEwyX1BBR0VUQUJM
RV9FTlRSSUVTOyBpKysgKQorICAgICAgICAgICAgICAgIGlmICggKGwyZV9nZXRfcGZuKGwydFtp
XSkgIT0KICAgICAgICAgICAgICAgICAgICAgICAoYmFzZV9tZm4gKyAoaSA8PCBQQUdFVEFCTEVf
T1JERVIpKSkgfHwKLSAgICAgICAgICAgICAgICAgICAgIChsMmVfZ2V0X2ZsYWdzKCpwbDJlKSAh
PSBsMWZfdG9fbE5mKGZsYWdzKSkgKQorICAgICAgICAgICAgICAgICAgICAgKGwyZV9nZXRfZmxh
Z3MobDJ0W2ldKSAhPSBsMWZfdG9fbE5mKGZsYWdzKSkgKQogICAgICAgICAgICAgICAgICAgICBi
cmVhazsKICAgICAgICAgICAgIGlmICggaSA9PSBMMl9QQUdFVEFCTEVfRU5UUklFUyApCiAgICAg
ICAgICAgICB7Ci0tIAoyLjE3LjEKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5w
cm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8v
eGVuLWRldmVs

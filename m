Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id C1583144C3
	for <lists+xen-devel@lfdr.de>; Mon,  6 May 2019 08:59:53 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hNXYU-0001sM-H9; Mon, 06 May 2019 06:56:54 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=XZcu=TG=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1hNXYT-0001s1-Fv
 for xen-devel@lists.xenproject.org; Mon, 06 May 2019 06:56:53 +0000
X-Inumbo-ID: 1ecbb955-6fcc-11e9-843c-bc764e045a96
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 1ecbb955-6fcc-11e9-843c-bc764e045a96;
 Mon, 06 May 2019 06:56:50 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 8314DABC7;
 Mon,  6 May 2019 06:56:48 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Mon,  6 May 2019 08:56:00 +0200
Message-Id: <20190506065644.7415-2-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190506065644.7415-1-jgross@suse.com>
References: <20190506065644.7415-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH RFC V2 01/45] xen/sched: add inline wrappers for
 calling per-scheduler functions
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Tim Deegan <tim@xen.org>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wei.liu2@citrix.com>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Dario Faggioli <dfaggioli@suse.com>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SW5zdGVhZCBvZiB1c2luZyB0aGUgU0NIRURfT1AoKSBtYWNybyB0byBjYWxsIHRoZSBkaWZmZXJl
bnQgc2NoZWR1bGVyCnNwZWNpZmljIGZ1bmN0aW9ucyBhZGQgaW5saW5lIHdyYXBwZXJzIGZvciB0
aGF0IHB1cnBvc2UuCgpTaWduZWQtb2ZmLWJ5OiBKdWVyZ2VuIEdyb3NzIDxqZ3Jvc3NAc3VzZS5j
b20+Ci0tLQpSRkMgVjI6IG5ldyBwYXRjaCAoQW5kcmV3IENvb3BlcikKLS0tCiB4ZW4vY29tbW9u
L3NjaGVkdWxlLmMgICAgICB8IDEwNCArKysrKysrKysrKystLS0tLS0tLS0tLS0tLQogeGVuL2lu
Y2x1ZGUveGVuL3NjaGVkLWlmLmggfCAxNzggKysrKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrCiAyIGZpbGVzIGNoYW5nZWQsIDIyNiBpbnNlcnRpb25zKCspLCA1NiBk
ZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3NjaGVkdWxlLmMgYi94ZW4vY29t
bW9uL3NjaGVkdWxlLmMKaW5kZXggNjZmMWUyNjExYi4uMzVhNDBhNDBjOCAxMDA2NDQKLS0tIGEv
eGVuL2NvbW1vbi9zY2hlZHVsZS5jCisrKyBiL3hlbi9jb21tb24vc2NoZWR1bGUuYwpAQCAtNzMs
MTAgKzczLDYgQEAgZXh0ZXJuIGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKl9fc3RhcnRfc2NoZWR1
bGVyc19hcnJheVtdLCAqX19lbmRfc2NoZWR1bGVyc19hcnIKIAogc3RhdGljIHN0cnVjdCBzY2hl
ZHVsZXIgX19yZWFkX21vc3RseSBvcHM7CiAKLSNkZWZpbmUgU0NIRURfT1Aob3BzcHRyLCBmbiwg
Li4uKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwKLSAgICAgICAg
ICgoIChvcHNwdHIpLT5mbiAhPSBOVUxMICkgPyAob3BzcHRyKS0+Zm4ob3BzcHRyLCAjI19fVkFf
QVJHU19fICkgIFwKLSAgICAgICAgICA6ICh0eXBlb2YoKG9wc3B0ciktPmZuKG9wc3B0ciwgIyNf
X1ZBX0FSR1NfXykpKTAgKQotCiBzdGF0aWMgaW5saW5lIHN0cnVjdCBzY2hlZHVsZXIgKmRvbV9z
Y2hlZHVsZXIoY29uc3Qgc3RydWN0IGRvbWFpbiAqZCkKIHsKICAgICBpZiAoIGxpa2VseShkLT5j
cHVwb29sICE9IE5VTEwpICkKQEAgLTI2Nyw4ICsyNjMsNyBAQCBpbnQgc2NoZWRfaW5pdF92Y3B1
KHN0cnVjdCB2Y3B1ICp2LCB1bnNpZ25lZCBpbnQgcHJvY2Vzc29yKQogICAgIGluaXRfdGltZXIo
JnYtPnBvbGxfdGltZXIsIHBvbGxfdGltZXJfZm4sCiAgICAgICAgICAgICAgICB2LCB2LT5wcm9j
ZXNzb3IpOwogCi0gICAgdi0+c2NoZWRfcHJpdiA9IFNDSEVEX09QKGRvbV9zY2hlZHVsZXIoZCks
IGFsbG9jX3ZkYXRhLCB2LAotICAgICAgICAgICAgICAgICAgICAgZC0+c2NoZWRfcHJpdik7Cisg
ICAgdi0+c2NoZWRfcHJpdiA9IHNjaGVkX2FsbG9jX3ZkYXRhKGRvbV9zY2hlZHVsZXIoZCksIHYs
IGQtPnNjaGVkX3ByaXYpOwogICAgIGlmICggdi0+c2NoZWRfcHJpdiA9PSBOVUxMICkKICAgICAg
ICAgcmV0dXJuIDE7CiAKQEAgLTI4OSw3ICsyODQsNyBAQCBpbnQgc2NoZWRfaW5pdF92Y3B1KHN0
cnVjdCB2Y3B1ICp2LCB1bnNpZ25lZCBpbnQgcHJvY2Vzc29yKQogICAgIH0KICAgICBlbHNlCiAg
ICAgewotICAgICAgICBTQ0hFRF9PUChkb21fc2NoZWR1bGVyKGQpLCBpbnNlcnRfdmNwdSwgdik7
CisgICAgICAgIHNjaGVkX2luc2VydF92Y3B1KGRvbV9zY2hlZHVsZXIoZCksIHYpOwogICAgIH0K
IAogICAgIHJldHVybiAwOwpAQCAtMzMwLDcgKzMyNSw3IEBAIGludCBzY2hlZF9tb3ZlX2RvbWFp
bihzdHJ1Y3QgZG9tYWluICpkLCBzdHJ1Y3QgY3B1cG9vbCAqYykKIAogICAgIGZvcl9lYWNoX3Zj
cHUgKCBkLCB2ICkKICAgICB7Ci0gICAgICAgIHZjcHVfcHJpdlt2LT52Y3B1X2lkXSA9IFNDSEVE
X09QKGMtPnNjaGVkLCBhbGxvY192ZGF0YSwgdiwgZG9tZGF0YSk7CisgICAgICAgIHZjcHVfcHJp
dlt2LT52Y3B1X2lkXSA9IHNjaGVkX2FsbG9jX3ZkYXRhKGMtPnNjaGVkLCB2LCBkb21kYXRhKTsK
ICAgICAgICAgaWYgKCB2Y3B1X3ByaXZbdi0+dmNwdV9pZF0gPT0gTlVMTCApCiAgICAgICAgIHsK
ICAgICAgICAgICAgIGZvcl9lYWNoX3ZjcHUgKCBkLCB2ICkKQEAgLTM0OCw3ICszNDMsNyBAQCBp
bnQgc2NoZWRfbW92ZV9kb21haW4oc3RydWN0IGRvbWFpbiAqZCwgc3RydWN0IGNwdXBvb2wgKmMp
CiAKICAgICBmb3JfZWFjaF92Y3B1ICggZCwgdiApCiAgICAgewotICAgICAgICBTQ0hFRF9PUChv
bGRfb3BzLCByZW1vdmVfdmNwdSwgdik7CisgICAgICAgIHNjaGVkX3JlbW92ZV92Y3B1KG9sZF9v
cHMsIHYpOwogICAgIH0KIAogICAgIGQtPmNwdXBvb2wgPSBjOwpAQCAtMzgzLDkgKzM3OCw5IEBA
IGludCBzY2hlZF9tb3ZlX2RvbWFpbihzdHJ1Y3QgZG9tYWluICpkLCBzdHJ1Y3QgY3B1cG9vbCAq
YykKIAogICAgICAgICBuZXdfcCA9IGNwdW1hc2tfY3ljbGUobmV3X3AsIGMtPmNwdV92YWxpZCk7
CiAKLSAgICAgICAgU0NIRURfT1AoYy0+c2NoZWQsIGluc2VydF92Y3B1LCB2KTsKKyAgICAgICAg
c2NoZWRfaW5zZXJ0X3ZjcHUoYy0+c2NoZWQsIHYpOwogCi0gICAgICAgIFNDSEVEX09QKG9sZF9v
cHMsIGZyZWVfdmRhdGEsIHZjcHVkYXRhKTsKKyAgICAgICAgc2NoZWRfZnJlZV92ZGF0YShvbGRf
b3BzLCB2Y3B1ZGF0YSk7CiAgICAgfQogCiAgICAgZG9tYWluX3VwZGF0ZV9ub2RlX2FmZmluaXR5
KGQpOwpAQCAtNDA2LDggKzQwMSw4IEBAIHZvaWQgc2NoZWRfZGVzdHJveV92Y3B1KHN0cnVjdCB2
Y3B1ICp2KQogICAgIGtpbGxfdGltZXIoJnYtPnBvbGxfdGltZXIpOwogICAgIGlmICggdGVzdF9h
bmRfY2xlYXJfYm9vbCh2LT5pc191cmdlbnQpICkKICAgICAgICAgYXRvbWljX2RlYygmcGVyX2Nw
dShzY2hlZHVsZV9kYXRhLCB2LT5wcm9jZXNzb3IpLnVyZ2VudF9jb3VudCk7Ci0gICAgU0NIRURf
T1AodmNwdV9zY2hlZHVsZXIodiksIHJlbW92ZV92Y3B1LCB2KTsKLSAgICBTQ0hFRF9PUCh2Y3B1
X3NjaGVkdWxlcih2KSwgZnJlZV92ZGF0YSwgdi0+c2NoZWRfcHJpdik7CisgICAgc2NoZWRfcmVt
b3ZlX3ZjcHUodmNwdV9zY2hlZHVsZXIodiksIHYpOworICAgIHNjaGVkX2ZyZWVfdmRhdGEodmNw
dV9zY2hlZHVsZXIodiksIHYtPnNjaGVkX3ByaXYpOwogfQogCiBpbnQgc2NoZWRfaW5pdF9kb21h
aW4oc3RydWN0IGRvbWFpbiAqZCwgaW50IHBvb2xpZCkKQEAgLTQ1OCw3ICs0NTMsNyBAQCB2b2lk
IHZjcHVfc2xlZXBfbm9zeW5jX2xvY2tlZChzdHJ1Y3QgdmNwdSAqdikKICAgICAgICAgaWYgKCB2
LT5ydW5zdGF0ZS5zdGF0ZSA9PSBSVU5TVEFURV9ydW5uYWJsZSApCiAgICAgICAgICAgICB2Y3B1
X3J1bnN0YXRlX2NoYW5nZSh2LCBSVU5TVEFURV9vZmZsaW5lLCBOT1coKSk7CiAKLSAgICAgICAg
U0NIRURfT1AodmNwdV9zY2hlZHVsZXIodiksIHNsZWVwLCB2KTsKKyAgICAgICAgc2NoZWRfc2xl
ZXAodmNwdV9zY2hlZHVsZXIodiksIHYpOwogICAgIH0KIH0KIApAQCAtNDk5LDcgKzQ5NCw3IEBA
IHZvaWQgdmNwdV93YWtlKHN0cnVjdCB2Y3B1ICp2KQogICAgIHsKICAgICAgICAgaWYgKCB2LT5y
dW5zdGF0ZS5zdGF0ZSA+PSBSVU5TVEFURV9ibG9ja2VkICkKICAgICAgICAgICAgIHZjcHVfcnVu
c3RhdGVfY2hhbmdlKHYsIFJVTlNUQVRFX3J1bm5hYmxlLCBOT1coKSk7Ci0gICAgICAgIFNDSEVE
X09QKHZjcHVfc2NoZWR1bGVyKHYpLCB3YWtlLCB2KTsKKyAgICAgICAgc2NoZWRfd2FrZSh2Y3B1
X3NjaGVkdWxlcih2KSwgdik7CiAgICAgfQogICAgIGVsc2UgaWYgKCAhKHYtPnBhdXNlX2ZsYWdz
ICYgVlBGX2Jsb2NrZWQpICkKICAgICB7CkBAIC01NTIsMTkgKzU0NywxNiBAQCBzdGF0aWMgdm9p
ZCB2Y3B1X21vdmVfbG9ja2VkKHN0cnVjdCB2Y3B1ICp2LCB1bnNpZ25lZCBpbnQgbmV3X2NwdSkK
IAogICAgIC8qCiAgICAgICogQWN0dWFsIENQVSBzd2l0Y2ggdG8gbmV3IENQVS4gIFRoaXMgaXMg
c2FmZSBiZWNhdXNlIHRoZSBsb2NrCi0gICAgICogcG9pbnRlciBjYW50JyBjaGFuZ2Ugd2hpbGUg
dGhlIGN1cnJlbnQgbG9jayBpcyBoZWxkLgorICAgICAqIHBvaW50ZXIgY2FuJ3QgY2hhbmdlIHdo
aWxlIHRoZSBjdXJyZW50IGxvY2sgaXMgaGVsZC4KICAgICAgKi8KLSAgICBpZiAoIHZjcHVfc2No
ZWR1bGVyKHYpLT5taWdyYXRlICkKLSAgICAgICAgU0NIRURfT1AodmNwdV9zY2hlZHVsZXIodiks
IG1pZ3JhdGUsIHYsIG5ld19jcHUpOwotICAgIGVsc2UKLSAgICAgICAgdi0+cHJvY2Vzc29yID0g
bmV3X2NwdTsKKyAgICBzY2hlZF9taWdyYXRlKHZjcHVfc2NoZWR1bGVyKHYpLCB2LCBuZXdfY3B1
KTsKIH0KIAogLyoKICAqIEluaXRpYXRpbmcgbWlncmF0aW9uCiAgKgogICogSW4gb3JkZXIgdG8g
bWlncmF0ZSwgd2UgbmVlZCB0aGUgdmNwdSBpbiBxdWVzdGlvbiB0byBoYXZlIHN0b3BwZWQKLSAq
IHJ1bm5pbmcgYW5kIGhhZCBTQ0hFRF9PUChzbGVlcCkgY2FsbGVkICh0byB0YWtlIGl0IG9mZiBh
bnkKKyAqIHJ1bm5pbmcgYW5kIGhhZCBzY2hlZF9zbGVlcCgpIGNhbGxlZCAodG8gdGFrZSBpdCBv
ZmYgYW55CiAgKiBydW5xdWV1ZXMsIGZvciBpbnN0YW5jZSk7IGFuZCBpZiBpdCBpcyBjdXJyZW50
bHkgcnVubmluZywgaXQgbmVlZHMKICAqIHRvIGJlIHNjaGVkdWxlZCBvdXQuICBGaW5hbGx5LCB3
ZSBuZWVkIHRvIGhvbGQgdGhlIHNjaGVkdWxpbmcgbG9ja3MKICAqIGZvciBib3RoIHRoZSBwcm9j
ZXNzb3Igd2UncmUgbWlncmF0aW5nIGZyb20sIGFuZCB0aGUgcHJvY2Vzc29yCkBAIC02MzUsNyAr
NjI3LDcgQEAgc3RhdGljIHZvaWQgdmNwdV9taWdyYXRlX2ZpbmlzaChzdHJ1Y3QgdmNwdSAqdikK
ICAgICAgICAgICAgICAgICBicmVhazsKIAogICAgICAgICAgICAgLyogU2VsZWN0IGEgbmV3IENQ
VS4gKi8KLSAgICAgICAgICAgIG5ld19jcHUgPSBTQ0hFRF9PUCh2Y3B1X3NjaGVkdWxlcih2KSwg
cGlja19jcHUsIHYpOworICAgICAgICAgICAgbmV3X2NwdSA9IHNjaGVkX3BpY2tfY3B1KHZjcHVf
c2NoZWR1bGVyKHYpLCB2KTsKICAgICAgICAgICAgIGlmICggKG5ld19sb2NrID09IHBlcl9jcHUo
c2NoZWR1bGVfZGF0YSwgbmV3X2NwdSkuc2NoZWR1bGVfbG9jaykgJiYKICAgICAgICAgICAgICAg
ICAgY3B1bWFza190ZXN0X2NwdShuZXdfY3B1LCB2LT5kb21haW4tPmNwdXBvb2wtPmNwdV92YWxp
ZCkgKQogICAgICAgICAgICAgICAgIGJyZWFrOwpAQCAtNzQwLDcgKzczMiw3IEBAIHZvaWQgcmVz
dG9yZV92Y3B1X2FmZmluaXR5KHN0cnVjdCBkb21haW4gKmQpCiAgICAgICAgIHYtPnByb2Nlc3Nv
ciA9IGNwdW1hc2tfYW55KGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSk7CiAKICAgICAgICAgbG9j
ayA9IHZjcHVfc2NoZWR1bGVfbG9ja19pcnEodik7Ci0gICAgICAgIHYtPnByb2Nlc3NvciA9IFND
SEVEX09QKHZjcHVfc2NoZWR1bGVyKHYpLCBwaWNrX2NwdSwgdik7CisgICAgICAgIHYtPnByb2Nl
c3NvciA9IHNjaGVkX3BpY2tfY3B1KHZjcHVfc2NoZWR1bGVyKHYpLCB2KTsKICAgICAgICAgc3Bp
bl91bmxvY2tfaXJxKGxvY2spOwogCiAgICAgICAgIGlmICggb2xkX2NwdSAhPSB2LT5wcm9jZXNz
b3IgKQpAQCAtODUyLDcgKzg0NCw3IEBAIHN0YXRpYyBpbnQgY3B1X2Rpc2FibGVfc2NoZWR1bGVy
X2NoZWNrKHVuc2lnbmVkIGludCBjcHUpCiB2b2lkIHNjaGVkX3NldF9hZmZpbml0eSgKICAgICBz
dHJ1Y3QgdmNwdSAqdiwgY29uc3QgY3B1bWFza190ICpoYXJkLCBjb25zdCBjcHVtYXNrX3QgKnNv
ZnQpCiB7Ci0gICAgU0NIRURfT1AoZG9tX3NjaGVkdWxlcih2LT5kb21haW4pLCBhZGp1c3RfYWZm
aW5pdHksIHYsIGhhcmQsIHNvZnQpOworICAgIHNjaGVkX2FkanVzdF9hZmZpbml0eShkb21fc2No
ZWR1bGVyKHYtPmRvbWFpbiksIHYsIGhhcmQsIHNvZnQpOwogCiAgICAgaWYgKCBoYXJkICkKICAg
ICAgICAgY3B1bWFza19jb3B5KHYtPmNwdV9oYXJkX2FmZmluaXR5LCBoYXJkKTsKQEAgLTEwMjcs
NyArMTAxOSw3IEBAIGxvbmcgdmNwdV95aWVsZCh2b2lkKQogICAgIHN0cnVjdCB2Y3B1ICogdj1j
dXJyZW50OwogICAgIHNwaW5sb2NrX3QgKmxvY2sgPSB2Y3B1X3NjaGVkdWxlX2xvY2tfaXJxKHYp
OwogCi0gICAgU0NIRURfT1AodmNwdV9zY2hlZHVsZXIodiksIHlpZWxkLCB2KTsKKyAgICBzY2hl
ZF95aWVsZCh2Y3B1X3NjaGVkdWxlcih2KSwgdik7CiAgICAgdmNwdV9zY2hlZHVsZV91bmxvY2tf
aXJxKGxvY2ssIHYpOwogCiAgICAgU0NIRURfU1RBVF9DUkFOSyh2Y3B1X3lpZWxkKTsKQEAgLTEz
NTIsNyArMTM0NCw3IEBAIGxvbmcgc2NoZWRfYWRqdXN0KHN0cnVjdCBkb21haW4gKmQsIHN0cnVj
dCB4ZW5fZG9tY3RsX3NjaGVkdWxlcl9vcCAqb3ApCiAKICAgICAvKiBOQjogdGhlIHBsdWdnYWJs
ZSBzY2hlZHVsZXIgY29kZSBuZWVkcyB0byB0YWtlIGNhcmUKICAgICAgKiBvZiBsb2NraW5nIGJ5
IGl0c2VsZi4gKi8KLSAgICBpZiAoIChyZXQgPSBTQ0hFRF9PUChkb21fc2NoZWR1bGVyKGQpLCBh
ZGp1c3QsIGQsIG9wKSkgPT0gMCApCisgICAgaWYgKCAocmV0ID0gc2NoZWRfYWRqdXN0X2RvbShk
b21fc2NoZWR1bGVyKGQpLCBkLCBvcCkpID09IDAgKQogICAgICAgICBUUkFDRV8xRChUUkNfU0NI
RURfQURKRE9NLCBkLT5kb21haW5faWQpOwogCiAgICAgcmV0dXJuIHJldDsKQEAgLTEzNzYsNyAr
MTM2OCw3IEBAIGxvbmcgc2NoZWRfYWRqdXN0X2dsb2JhbChzdHJ1Y3QgeGVuX3N5c2N0bF9zY2hl
ZHVsZXJfb3AgKm9wKQogICAgICAgICByZXR1cm4gLUVTUkNIOwogCiAgICAgcmMgPSAoKG9wLT5z
Y2hlZF9pZCA9PSBwb29sLT5zY2hlZC0+c2NoZWRfaWQpCi0gICAgICAgICAgPyBTQ0hFRF9PUChw
b29sLT5zY2hlZCwgYWRqdXN0X2dsb2JhbCwgb3ApIDogLUVJTlZBTCk7CisgICAgICAgICAgPyBz
Y2hlZF9hZGp1c3RfY3B1cG9vbChwb29sLT5zY2hlZCwgb3ApIDogLUVJTlZBTCk7CiAKICAgICBj
cHVwb29sX3B1dChwb29sKTsKIApAQCAtMTUzMCw3ICsxNTIyLDcgQEAgdm9pZCBjb250ZXh0X3Nh
dmVkKHN0cnVjdCB2Y3B1ICpwcmV2KQogICAgIC8qIENoZWNrIGZvciBtaWdyYXRpb24gcmVxdWVz
dCAvYWZ0ZXIvIGNsZWFyaW5nIHJ1bm5pbmcgZmxhZy4gKi8KICAgICBzbXBfbWIoKTsKIAotICAg
IFNDSEVEX09QKHZjcHVfc2NoZWR1bGVyKHByZXYpLCBjb250ZXh0X3NhdmVkLCBwcmV2KTsKKyAg
ICBzY2hlZF9jb250ZXh0X3NhdmVkKHZjcHVfc2NoZWR1bGVyKHByZXYpLCBwcmV2KTsKIAogICAg
IHZjcHVfbWlncmF0ZV9maW5pc2gocHJldik7CiB9CkBAIC0xNTk5LDggKzE1OTEsOCBAQCBzdGF0
aWMgaW50IGNwdV9zY2hlZHVsZV91cCh1bnNpZ25lZCBpbnQgY3B1KQogICAgICAgICAgKi8KICAg
ICAgICAgQVNTRVJUKGlkbGUtPnNjaGVkX3ByaXYgPT0gTlVMTCk7CiAKLSAgICAgICAgaWRsZS0+
c2NoZWRfcHJpdiA9IFNDSEVEX09QKCZvcHMsIGFsbG9jX3ZkYXRhLCBpZGxlLAotICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgaWRsZS0+ZG9tYWluLT5zY2hlZF9wcml2KTsKKyAg
ICAgICAgaWRsZS0+c2NoZWRfcHJpdiA9IHNjaGVkX2FsbG9jX3ZkYXRhKCZvcHMsIGlkbGUsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZGxlLT5kb21haW4t
PnNjaGVkX3ByaXYpOwogICAgICAgICBpZiAoIGlkbGUtPnNjaGVkX3ByaXYgPT0gTlVMTCApCiAg
ICAgICAgICAgICByZXR1cm4gLUVOT01FTTsKICAgICB9CkBAIC0xNjEyLDcgKzE2MDQsNyBAQCBz
dGF0aWMgaW50IGNwdV9zY2hlZHVsZV91cCh1bnNpZ25lZCBpbnQgY3B1KQogICAgICAqIChlLmcu
LCBpbnNpZGUgZnJlZV9wZGF0YSwgZnJvbSBjcHVfc2NoZWR1bGVfZG93bigpIGNhbGxlZAogICAg
ICAqIGR1cmluZyBDUFVfVVBfQ0FOQ0VMTEVEKSB0aGF0IGNvbnRhaW5zIGFuIElTX0VSUiB2YWx1
ZS4KICAgICAgKi8KLSAgICBzY2hlZF9wcml2ID0gU0NIRURfT1AoJm9wcywgYWxsb2NfcGRhdGEs
IGNwdSk7CisgICAgc2NoZWRfcHJpdiA9IHNjaGVkX2FsbG9jX3BkYXRhKCZvcHMsIGNwdSk7CiAg
ICAgaWYgKCBJU19FUlIoc2NoZWRfcHJpdikgKQogICAgICAgICByZXR1cm4gUFRSX0VSUihzY2hl
ZF9wcml2KTsKIApAQCAtMTYyNiw4ICsxNjE4LDggQEAgc3RhdGljIHZvaWQgY3B1X3NjaGVkdWxl
X2Rvd24odW5zaWduZWQgaW50IGNwdSkKICAgICBzdHJ1Y3Qgc2NoZWR1bGVfZGF0YSAqc2QgPSAm
cGVyX2NwdShzY2hlZHVsZV9kYXRhLCBjcHUpOwogICAgIHN0cnVjdCBzY2hlZHVsZXIgKnNjaGVk
ID0gcGVyX2NwdShzY2hlZHVsZXIsIGNwdSk7CiAKLSAgICBTQ0hFRF9PUChzY2hlZCwgZnJlZV9w
ZGF0YSwgc2QtPnNjaGVkX3ByaXYsIGNwdSk7Ci0gICAgU0NIRURfT1Aoc2NoZWQsIGZyZWVfdmRh
dGEsIGlkbGVfdmNwdVtjcHVdLT5zY2hlZF9wcml2KTsKKyAgICBzY2hlZF9mcmVlX3BkYXRhKHNj
aGVkLCBzZC0+c2NoZWRfcHJpdiwgY3B1KTsKKyAgICBzY2hlZF9mcmVlX3ZkYXRhKHNjaGVkLCBp
ZGxlX3ZjcHVbY3B1XS0+c2NoZWRfcHJpdik7CiAKICAgICBpZGxlX3ZjcHVbY3B1XS0+c2NoZWRf
cHJpdiA9IE5VTEw7CiAgICAgc2QtPnNjaGVkX3ByaXYgPSBOVUxMOwpAQCAtMTY3OSw3ICsxNjcx
LDcgQEAgc3RhdGljIGludCBjcHVfc2NoZWR1bGVfY2FsbGJhY2soCiAgICAgewogICAgIGNhc2Ug
Q1BVX1NUQVJUSU5HOgogICAgICAgICBpZiAoIHN5c3RlbV9zdGF0ZSAhPSBTWVNfU1RBVEVfcmVz
dW1lICkKLSAgICAgICAgICAgIFNDSEVEX09QKHNjaGVkLCBpbml0X3BkYXRhLCBzZC0+c2NoZWRf
cHJpdiwgY3B1KTsKKyAgICAgICAgICAgIHNjaGVkX2luaXRfcGRhdGEoc2NoZWQsIHNkLT5zY2hl
ZF9wcml2LCBjcHUpOwogICAgICAgICBicmVhazsKICAgICBjYXNlIENQVV9VUF9QUkVQQVJFOgog
ICAgICAgICBpZiAoIHN5c3RlbV9zdGF0ZSAhPSBTWVNfU1RBVEVfcmVzdW1lICkKQEAgLTE2OTgs
NyArMTY5MCw3IEBAIHN0YXRpYyBpbnQgY3B1X3NjaGVkdWxlX2NhbGxiYWNrKAogICAgICAgICBy
YyA9IGNwdV9kaXNhYmxlX3NjaGVkdWxlcihjcHUpOwogICAgICAgICBCVUdfT04ocmMpOwogICAg
ICAgICByY3VfcmVhZF91bmxvY2soJmRvbWxpc3RfcmVhZF9sb2NrKTsKLSAgICAgICAgU0NIRURf
T1Aoc2NoZWQsIGRlaW5pdF9wZGF0YSwgc2QtPnNjaGVkX3ByaXYsIGNwdSk7CisgICAgICAgIHNj
aGVkX2RlaW5pdF9wZGF0YShzY2hlZCwgc2QtPnNjaGVkX3ByaXYsIGNwdSk7CiAgICAgICAgIGNw
dV9zY2hlZHVsZV9kb3duKGNwdSk7CiAgICAgICAgIGJyZWFrOwogICAgIGNhc2UgQ1BVX1VQX0NB
TkNFTEVEOgpAQCAtMTc1MSw3ICsxNzQzLDcgQEAgdm9pZCBfX2luaXQgc2NoZWR1bGVyX2luaXQo
dm9pZCkKICAgICByZWdpc3Rlcl9jcHVfbm90aWZpZXIoJmNwdV9zY2hlZHVsZV9uZmIpOwogCiAg
ICAgcHJpbnRrKCJVc2luZyBzY2hlZHVsZXI6ICVzICglcylcbiIsIG9wcy5uYW1lLCBvcHMub3B0
X25hbWUpOwotICAgIGlmICggU0NIRURfT1AoJm9wcywgaW5pdCkgKQorICAgIGlmICggc2NoZWRf
aW5pdCgmb3BzKSApCiAgICAgICAgIHBhbmljKCJzY2hlZHVsZXIgcmV0dXJuZWQgZXJyb3Igb24g
aW5pdFxuIik7CiAKICAgICBpZiAoIHNjaGVkX3JhdGVsaW1pdF91cyAmJgpAQCAtMTc3Myw5ICsx
NzY1LDkgQEAgdm9pZCBfX2luaXQgc2NoZWR1bGVyX2luaXQodm9pZCkKICAgICBpZGxlX2RvbWFp
bi0+bWF4X3ZjcHVzID0gbnJfY3B1X2lkczsKICAgICBpZiAoIHZjcHVfY3JlYXRlKGlkbGVfZG9t
YWluLCAwLCAwKSA9PSBOVUxMICkKICAgICAgICAgQlVHKCk7Ci0gICAgdGhpc19jcHUoc2NoZWR1
bGVfZGF0YSkuc2NoZWRfcHJpdiA9IFNDSEVEX09QKCZvcHMsIGFsbG9jX3BkYXRhLCAwKTsKKyAg
ICB0aGlzX2NwdShzY2hlZHVsZV9kYXRhKS5zY2hlZF9wcml2ID0gc2NoZWRfYWxsb2NfcGRhdGEo
Jm9wcywgMCk7CiAgICAgQlVHX09OKElTX0VSUih0aGlzX2NwdShzY2hlZHVsZV9kYXRhKS5zY2hl
ZF9wcml2KSk7Ci0gICAgU0NIRURfT1AoJm9wcywgaW5pdF9wZGF0YSwgdGhpc19jcHUoc2NoZWR1
bGVfZGF0YSkuc2NoZWRfcHJpdiwgMCk7CisgICAgc2NoZWRfaW5pdF9wZGF0YSgmb3BzLCB0aGlz
X2NwdShzY2hlZHVsZV9kYXRhKS5zY2hlZF9wcml2LCAwKTsKIH0KIAogLyoKQEAgLTE4MTgsMjYg
KzE4MTAsMjYgQEAgaW50IHNjaGVkdWxlX2NwdV9zd2l0Y2godW5zaWduZWQgaW50IGNwdSwgc3Ry
dWN0IGNwdXBvb2wgKmMpCiAgICAgLyoKICAgICAgKiBUbyBzZXR1cCB0aGUgY3B1IGZvciB0aGUg
bmV3IHNjaGVkdWxlciB3ZSBuZWVkOgogICAgICAqICAtIGEgdmFsaWQgaW5zdGFuY2Ugb2YgcGVy
LUNQVSBzY2hlZHVsZXIgc3BlY2lmaWMgZGF0YSwgYXMgaXQgaXMKLSAgICAgKiAgICBhbGxvY2F0
ZWQgYnkgU0NIRURfT1AoYWxsb2NfcGRhdGEpLiBOb3RlIHRoYXQgd2UgZG8gbm90IHdhbnQgdG8K
LSAgICAgKiAgICBpbml0aWFsaXplIGl0IHlldCAoaS5lLiwgd2UgYXJlIG5vdCBjYWxsaW5nIFND
SEVEX09QKGluaXRfcGRhdGEpKS4KLSAgICAgKiAgICBUaGF0IHdpbGwgYmUgZG9uZSBieSB0aGUg
dGFyZ2V0IHNjaGVkdWxlciwgaW4gU0NIRURfT1Aoc3dpdGNoX3NjaGVkKSwKKyAgICAgKiAgICBh
bGxvY2F0ZWQgYnkgc2NoZWRfYWxsb2NfcGRhdGEoKS4gTm90ZSB0aGF0IHdlIGRvIG5vdCB3YW50
IHRvCisgICAgICogICAgaW5pdGlhbGl6ZSBpdCB5ZXQgKGkuZS4sIHdlIGFyZSBub3QgY2FsbGlu
ZyBzY2hlZF9pbml0X3BkYXRhKCkpLgorICAgICAqICAgIFRoYXQgd2lsbCBiZSBkb25lIGJ5IHRo
ZSB0YXJnZXQgc2NoZWR1bGVyLCBpbiBzY2hlZF9zd2l0Y2hfc2NoZWQoKSwKICAgICAgKiAgICBp
biBwcm9wZXIgb3JkZXJpbmcgYW5kIHdpdGggbG9ja2luZy4KICAgICAgKiAgLSBhIHZhbGlkIGlu
c3RhbmNlIG9mIHBlci12Q1BVIHNjaGVkdWxlciBzcGVjaWZpYyBkYXRhLCBmb3IgdGhlIGlkbGUK
ICAgICAgKiAgICB2Q1BVIG9mIGNwdS4gVGhhdCBpcyB3aGF0IHRoZSB0YXJnZXQgc2NoZWR1bGVy
IHdpbGwgdXNlIGZvciB0aGUKICAgICAgKiAgICBzY2hlZF9wcml2IGZpZWxkIG9mIHRoZSBwZXIt
dkNQVSBpbmZvIG9mIHRoZSBpZGxlIGRvbWFpbi4KICAgICAgKi8KICAgICBpZGxlID0gaWRsZV92
Y3B1W2NwdV07Ci0gICAgcHByaXYgPSBTQ0hFRF9PUChuZXdfb3BzLCBhbGxvY19wZGF0YSwgY3B1
KTsKKyAgICBwcHJpdiA9IHNjaGVkX2FsbG9jX3BkYXRhKG5ld19vcHMsIGNwdSk7CiAgICAgaWYg
KCBJU19FUlIocHByaXYpICkKICAgICAgICAgcmV0dXJuIFBUUl9FUlIocHByaXYpOwotICAgIHZw
cml2ID0gU0NIRURfT1AobmV3X29wcywgYWxsb2NfdmRhdGEsIGlkbGUsIGlkbGUtPmRvbWFpbi0+
c2NoZWRfcHJpdik7CisgICAgdnByaXYgPSBzY2hlZF9hbGxvY192ZGF0YShuZXdfb3BzLCBpZGxl
LCBpZGxlLT5kb21haW4tPnNjaGVkX3ByaXYpOwogICAgIGlmICggdnByaXYgPT0gTlVMTCApCiAg
ICAgewotICAgICAgICBTQ0hFRF9PUChuZXdfb3BzLCBmcmVlX3BkYXRhLCBwcHJpdiwgY3B1KTsK
KyAgICAgICAgc2NoZWRfZnJlZV9wZGF0YShuZXdfb3BzLCBwcHJpdiwgY3B1KTsKICAgICAgICAg
cmV0dXJuIC1FTk9NRU07CiAgICAgfQogCi0gICAgU0NIRURfT1Aob2xkX29wcywgdGlja19zdXNw
ZW5kLCBjcHUpOworICAgIHNjaGVkX2RvX3RpY2tfc3VzcGVuZChvbGRfb3BzLCBjcHUpOwogCiAg
ICAgLyoKICAgICAgKiBUaGUgYWN0dWFsIHN3aXRjaCwgaW5jbHVkaW5nIChpZiBuZWNlc3Nhcnkp
IHRoZSByZXJvdXRpbmcgb2YgdGhlCkBAIC0xODU1LDE3ICsxODQ3LDE3IEBAIGludCBzY2hlZHVs
ZV9jcHVfc3dpdGNoKHVuc2lnbmVkIGludCBjcHUsIHN0cnVjdCBjcHVwb29sICpjKQogCiAgICAg
dnByaXZfb2xkID0gaWRsZS0+c2NoZWRfcHJpdjsKICAgICBwcHJpdl9vbGQgPSBwZXJfY3B1KHNj
aGVkdWxlX2RhdGEsIGNwdSkuc2NoZWRfcHJpdjsKLSAgICBTQ0hFRF9PUChuZXdfb3BzLCBzd2l0
Y2hfc2NoZWQsIGNwdSwgcHByaXYsIHZwcml2KTsKKyAgICBzY2hlZF9zd2l0Y2hfc2NoZWQobmV3
X29wcywgY3B1LCBwcHJpdiwgdnByaXYpOwogCiAgICAgLyogX05vdF8gcGNwdV9zY2hlZHVsZV91
bmxvY2soKTogc2NoZWR1bGVfbG9jayBtYXkgaGF2ZSBjaGFuZ2VkISAqLwogICAgIHNwaW5fdW5s
b2NrX2lycShvbGRfbG9jayk7CiAKLSAgICBTQ0hFRF9PUChuZXdfb3BzLCB0aWNrX3Jlc3VtZSwg
Y3B1KTsKKyAgICBzY2hlZF9kb190aWNrX3Jlc3VtZShuZXdfb3BzLCBjcHUpOwogCi0gICAgU0NI
RURfT1Aob2xkX29wcywgZGVpbml0X3BkYXRhLCBwcHJpdl9vbGQsIGNwdSk7CisgICAgc2NoZWRf
ZGVpbml0X3BkYXRhKG9sZF9vcHMsIHBwcml2X29sZCwgY3B1KTsKIAotICAgIFNDSEVEX09QKG9s
ZF9vcHMsIGZyZWVfdmRhdGEsIHZwcml2X29sZCk7Ci0gICAgU0NIRURfT1Aob2xkX29wcywgZnJl
ZV9wZGF0YSwgcHByaXZfb2xkLCBjcHUpOworICAgIHNjaGVkX2ZyZWVfdmRhdGEob2xkX29wcywg
dnByaXZfb2xkKTsKKyAgICBzY2hlZF9mcmVlX3BkYXRhKG9sZF9vcHMsIHBwcml2X29sZCwgY3B1
KTsKIAogIG91dDoKICAgICBwZXJfY3B1KGNwdXBvb2wsIGNwdSkgPSBjOwpAQCAtMTg5Nyw3ICsx
ODg5LDcgQEAgc3RydWN0IHNjaGVkdWxlciAqc2NoZWR1bGVyX2FsbG9jKHVuc2lnbmVkIGludCBz
Y2hlZF9pZCwgaW50ICpwZXJyKQogICAgIGlmICggKHNjaGVkID0geG1hbGxvYyhzdHJ1Y3Qgc2No
ZWR1bGVyKSkgPT0gTlVMTCApCiAgICAgICAgIHJldHVybiBOVUxMOwogICAgIG1lbWNweShzY2hl
ZCwgc2NoZWR1bGVyc1tpXSwgc2l6ZW9mKCpzY2hlZCkpOwotICAgIGlmICggKCpwZXJyID0gU0NI
RURfT1Aoc2NoZWQsIGluaXQpKSAhPSAwICkKKyAgICBpZiAoICgqcGVyciA9IHNjaGVkX2luaXQo
c2NoZWQpKSAhPSAwICkKICAgICB7CiAgICAgICAgIHhmcmVlKHNjaGVkKTsKICAgICAgICAgc2No
ZWQgPSBOVUxMOwpAQCAtMTkwOSw3ICsxOTAxLDcgQEAgc3RydWN0IHNjaGVkdWxlciAqc2NoZWR1
bGVyX2FsbG9jKHVuc2lnbmVkIGludCBzY2hlZF9pZCwgaW50ICpwZXJyKQogdm9pZCBzY2hlZHVs
ZXJfZnJlZShzdHJ1Y3Qgc2NoZWR1bGVyICpzY2hlZCkKIHsKICAgICBCVUdfT04oc2NoZWQgPT0g
Jm9wcyk7Ci0gICAgU0NIRURfT1Aoc2NoZWQsIGRlaW5pdCk7CisgICAgc2NoZWRfZGVpbml0KHNj
aGVkKTsKICAgICB4ZnJlZShzY2hlZCk7CiB9CiAKQEAgLTE5MjYsNyArMTkxOCw3IEBAIHZvaWQg
c2NoZWR1bGVfZHVtcChzdHJ1Y3QgY3B1cG9vbCAqYykKICAgICAgICAgc2NoZWQgPSBjLT5zY2hl
ZDsKICAgICAgICAgY3B1cyA9IGMtPmNwdV92YWxpZDsKICAgICAgICAgcHJpbnRrKCJTY2hlZHVs
ZXI6ICVzICglcylcbiIsIHNjaGVkLT5uYW1lLCBzY2hlZC0+b3B0X25hbWUpOwotICAgICAgICBT
Q0hFRF9PUChzY2hlZCwgZHVtcF9zZXR0aW5ncyk7CisgICAgICAgIHNjaGVkX2R1bXBfc2V0dGlu
Z3Moc2NoZWQpOwogICAgIH0KICAgICBlbHNlCiAgICAgewpAQCAtMTkzOCw3ICsxOTMwLDcgQEAg
dm9pZCBzY2hlZHVsZV9kdW1wKHN0cnVjdCBjcHVwb29sICpjKQogICAgIHsKICAgICAgICAgcHJp
bnRrKCJDUFVzIGluZm86XG4iKTsKICAgICAgICAgZm9yX2VhY2hfY3B1IChpLCBjcHVzKQotICAg
ICAgICAgICAgU0NIRURfT1Aoc2NoZWQsIGR1bXBfY3B1X3N0YXRlLCBpKTsKKyAgICAgICAgICAg
IHNjaGVkX2R1bXBfY3B1X3N0YXRlKHNjaGVkLCBpKTsKICAgICB9CiB9CiAKQEAgLTE5NDgsNyAr
MTk0MCw3IEBAIHZvaWQgc2NoZWRfdGlja19zdXNwZW5kKHZvaWQpCiAgICAgdW5zaWduZWQgaW50
IGNwdSA9IHNtcF9wcm9jZXNzb3JfaWQoKTsKIAogICAgIHNjaGVkID0gcGVyX2NwdShzY2hlZHVs
ZXIsIGNwdSk7Ci0gICAgU0NIRURfT1Aoc2NoZWQsIHRpY2tfc3VzcGVuZCwgY3B1KTsKKyAgICBz
Y2hlZF9kb190aWNrX3N1c3BlbmQoc2NoZWQsIGNwdSk7CiAgICAgcmN1X2lkbGVfZW50ZXIoY3B1
KTsKICAgICByY3VfaWRsZV90aW1lcl9zdGFydCgpOwogfQpAQCAtMTk2MSw3ICsxOTUzLDcgQEAg
dm9pZCBzY2hlZF90aWNrX3Jlc3VtZSh2b2lkKQogICAgIHJjdV9pZGxlX3RpbWVyX3N0b3AoKTsK
ICAgICByY3VfaWRsZV9leGl0KGNwdSk7CiAgICAgc2NoZWQgPSBwZXJfY3B1KHNjaGVkdWxlciwg
Y3B1KTsKLSAgICBTQ0hFRF9PUChzY2hlZCwgdGlja19yZXN1bWUsIGNwdSk7CisgICAgc2NoZWRf
ZG9fdGlja19yZXN1bWUoc2NoZWQsIGNwdSk7CiB9CiAKIHZvaWQgd2FpdCh2b2lkKQpkaWZmIC0t
Z2l0IGEveGVuL2luY2x1ZGUveGVuL3NjaGVkLWlmLmggYi94ZW4vaW5jbHVkZS94ZW4vc2NoZWQt
aWYuaAppbmRleCA5MmJjN2EwMzY1Li41OTNjZDc5Mjk3IDEwMDY0NAotLS0gYS94ZW4vaW5jbHVk
ZS94ZW4vc2NoZWQtaWYuaAorKysgYi94ZW4vaW5jbHVkZS94ZW4vc2NoZWQtaWYuaApAQCAtMTg1
LDYgKzE4NSw0OSBAQCBzdHJ1Y3Qgc2NoZWR1bGVyIHsKICAgICB2b2lkICAgICAgICAgKCp0aWNr
X3Jlc3VtZSkgICAgIChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICosIHVuc2lnbmVkIGludCk7CiB9
OwogCitzdGF0aWMgaW5saW5lIGludCBzY2hlZF9pbml0KHN0cnVjdCBzY2hlZHVsZXIgKnMpCit7
CisgICAgQVNTRVJUKHMtPmluaXQpOworICAgIHJldHVybiBzLT5pbml0KHMpOworfQorCitzdGF0
aWMgaW5saW5lIHZvaWQgc2NoZWRfZGVpbml0KHN0cnVjdCBzY2hlZHVsZXIgKnMpCit7CisgICAg
QVNTRVJUKHMtPmRlaW5pdCk7CisgICAgcy0+ZGVpbml0KHMpOworfQorCitzdGF0aWMgaW5saW5l
IHZvaWQgc2NoZWRfc3dpdGNoX3NjaGVkKHN0cnVjdCBzY2hlZHVsZXIgKnMsIHVuc2lnbmVkIGlu
dCBjcHUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgKnBkYXRh
LCB2b2lkICp2ZGF0YSkKK3sKKyAgICBpZiAoIHMtPnN3aXRjaF9zY2hlZCApCisgICAgICAgIHMt
PnN3aXRjaF9zY2hlZChzLCBjcHUsIHBkYXRhLCB2ZGF0YSk7Cit9CisKK3N0YXRpYyBpbmxpbmUg
dm9pZCBzY2hlZF9kdW1wX3NldHRpbmdzKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKnMpCit7Cisg
ICAgaWYgKCBzLT5kdW1wX3NldHRpbmdzICkKKyAgICAgICAgcy0+ZHVtcF9zZXR0aW5ncyhzKTsK
K30KKworc3RhdGljIGlubGluZSB2b2lkIHNjaGVkX2R1bXBfY3B1X3N0YXRlKGNvbnN0IHN0cnVj
dCBzY2hlZHVsZXIgKnMsIGludCBjcHUpCit7CisgICAgaWYgKCBzLT5kdW1wX2NwdV9zdGF0ZSAp
CisgICAgICAgIHMtPmR1bXBfY3B1X3N0YXRlKHMsIGNwdSk7Cit9CisKK3N0YXRpYyBpbmxpbmUg
dm9pZCBzY2hlZF9kb190aWNrX3N1c3BlbmQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqcywgaW50
IGNwdSkKK3sKKyAgICBpZiAoIHMtPnRpY2tfc3VzcGVuZCApCisgICAgICAgIHMtPnRpY2tfc3Vz
cGVuZChzLCBjcHUpOworfQorCitzdGF0aWMgaW5saW5lIHZvaWQgc2NoZWRfZG9fdGlja19yZXN1
bWUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqcywgaW50IGNwdSkKK3sKKyAgICBpZiAoIHMtPnRp
Y2tfcmVzdW1lICkKKyAgICAgICAgcy0+dGlja19yZXN1bWUocywgY3B1KTsKK30KKwogc3RhdGlj
IGlubGluZSB2b2lkICpzY2hlZF9hbGxvY19kb21kYXRhKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIg
KnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGRvbWFp
biAqZCkKIHsKQEAgLTIwNyw2ICsyNTAsMTQxIEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBzY2hlZF9m
cmVlX2RvbWRhdGEoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqcywKICAgICAgICAgQVNTRVJUKCFk
YXRhKTsKIH0KIAorc3RhdGljIGlubGluZSB2b2lkICpzY2hlZF9hbGxvY19wZGF0YShjb25zdCBz
dHJ1Y3Qgc2NoZWR1bGVyICpzLCBpbnQgY3B1KQoreworICAgIGlmICggcy0+YWxsb2NfcGRhdGEg
KQorICAgICAgICByZXR1cm4gcy0+YWxsb2NfcGRhdGEocywgY3B1KTsKKyAgICBlbHNlCisgICAg
ICAgIHJldHVybiBOVUxMOworfQorCitzdGF0aWMgaW5saW5lIHZvaWQgc2NoZWRfZnJlZV9wZGF0
YShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpzLCB2b2lkICpkYXRhLAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgaW50IGNwdSkKK3sKKyAgICBpZiAoIHMtPmZyZWVfcGRhdGEg
KQorICAgICAgICBzLT5mcmVlX3BkYXRhKHMsIGRhdGEsIGNwdSk7CisgICAgZWxzZQorICAgICAg
ICAvKgorICAgICAgICAgKiBDaGVjayB0aGF0IGlmIHRoZXJlIGlzbid0IGEgZnJlZV9wZGF0YSBo
b29rLCB3ZSBoYXZlbid0IGdvdCBhbnkKKyAgICAgICAgICogZGF0YSB3ZSdyZSBleHBlY3RlZCB0
byBkZWFsIHdpdGguCisgICAgICAgICAqLworICAgICAgICBBU1NFUlQoIWRhdGEpOworfQorCitz
dGF0aWMgaW5saW5lIHZvaWQgc2NoZWRfaW5pdF9wZGF0YShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVy
ICpzLCB2b2lkICpkYXRhLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50
IGNwdSkKK3sKKyAgICBpZiAoIHMtPmluaXRfcGRhdGEgKQorICAgICAgICBzLT5pbml0X3BkYXRh
KHMsIGRhdGEsIGNwdSk7Cit9CisKK3N0YXRpYyBpbmxpbmUgdm9pZCBzY2hlZF9kZWluaXRfcGRh
dGEoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqcywgdm9pZCAqZGF0YSwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgaW50IGNwdSkKK3sKKyAgICBpZiAoIHMtPmRlaW5pdF9w
ZGF0YSApCisgICAgICAgIHMtPmRlaW5pdF9wZGF0YShzLCBkYXRhLCBjcHUpOworfQorCitzdGF0
aWMgaW5saW5lIHZvaWQgKnNjaGVkX2FsbG9jX3ZkYXRhKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIg
KnMsIHN0cnVjdCB2Y3B1ICp2LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICB2b2lkICpkb21fZGF0YSkKK3sKKyAgICBpZiAoIHMtPmFsbG9jX3ZkYXRhICkKKyAgICAgICAg
cmV0dXJuIHMtPmFsbG9jX3ZkYXRhKHMsIHYsIGRvbV9kYXRhKTsKKyAgICBlbHNlCisgICAgICAg
IHJldHVybiBOVUxMOworfQorCitzdGF0aWMgaW5saW5lIHZvaWQgc2NoZWRfZnJlZV92ZGF0YShj
b25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpzLCB2b2lkICpkYXRhKQoreworICAgIGlmICggcy0+ZnJl
ZV92ZGF0YSApCisgICAgICAgIHMtPmZyZWVfdmRhdGEocywgZGF0YSk7CisgICAgZWxzZQorICAg
ICAgICAvKgorICAgICAgICAgKiBDaGVjayB0aGF0IGlmIHRoZXJlIGlzbid0IGEgZnJlZV92ZGF0
YSBob29rLCB3ZSBoYXZlbid0IGdvdCBhbnkKKyAgICAgICAgICogZGF0YSB3ZSdyZSBleHBlY3Rl
ZCB0byBkZWFsIHdpdGguCisgICAgICAgICAqLworICAgICAgICBBU1NFUlQoIWRhdGEpOworfQor
CitzdGF0aWMgaW5saW5lIHZvaWQgc2NoZWRfaW5zZXJ0X3ZjcHUoY29uc3Qgc3RydWN0IHNjaGVk
dWxlciAqcywgc3RydWN0IHZjcHUgKnYpCit7CisgICAgaWYgKCBzLT5pbnNlcnRfdmNwdSApCisg
ICAgICAgIHMtPmluc2VydF92Y3B1KHMsIHYpOworfQorCitzdGF0aWMgaW5saW5lIHZvaWQgc2No
ZWRfcmVtb3ZlX3ZjcHUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqcywgc3RydWN0IHZjcHUgKnYp
Cit7CisgICAgaWYgKCBzLT5yZW1vdmVfdmNwdSApCisgICAgICAgIHMtPnJlbW92ZV92Y3B1KHMs
IHYpOworfQorCitzdGF0aWMgaW5saW5lIHZvaWQgc2NoZWRfc2xlZXAoY29uc3Qgc3RydWN0IHNj
aGVkdWxlciAqcywgc3RydWN0IHZjcHUgKnYpCit7CisgICAgaWYgKCBzLT5zbGVlcCApCisgICAg
ICAgIHMtPnNsZWVwKHMsIHYpOworfQorCitzdGF0aWMgaW5saW5lIHZvaWQgc2NoZWRfd2FrZShj
b25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpzLCBzdHJ1Y3QgdmNwdSAqdikKK3sKKyAgICBpZiAoIHMt
Pndha2UgKQorICAgICAgICBzLT53YWtlKHMsIHYpOworfQorCitzdGF0aWMgaW5saW5lIHZvaWQg
c2NoZWRfeWllbGQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqcywgc3RydWN0IHZjcHUgKnYpCit7
CisgICAgaWYgKCBzLT55aWVsZCApCisgICAgICAgIHMtPnlpZWxkKHMsIHYpOworfQorCitzdGF0
aWMgaW5saW5lIHZvaWQgc2NoZWRfY29udGV4dF9zYXZlZChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVy
ICpzLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHZjcHUg
KnYpCit7CisgICAgaWYgKCBzLT5jb250ZXh0X3NhdmVkICkKKyAgICAgICAgcy0+Y29udGV4dF9z
YXZlZChzLCB2KTsKK30KKworc3RhdGljIGlubGluZSB2b2lkIHNjaGVkX21pZ3JhdGUoY29uc3Qg
c3RydWN0IHNjaGVkdWxlciAqcywgc3RydWN0IHZjcHUgKnYsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgY3B1KQoreworICAgIGlmICggcy0+bWlncmF0ZSAp
CisgICAgICAgIHMtPm1pZ3JhdGUocywgdiwgY3B1KTsKKyAgICBlbHNlCisgICAgICAgIHYtPnBy
b2Nlc3NvciA9IGNwdTsKK30KKworc3RhdGljIGlubGluZSBpbnQgc2NoZWRfcGlja19jcHUoY29u
c3Qgc3RydWN0IHNjaGVkdWxlciAqcywgc3RydWN0IHZjcHUgKnYpCit7CisgICAgQVNTRVJUKHMt
PnBpY2tfY3B1KTsKKyAgICByZXR1cm4gcy0+cGlja19jcHUocywgdik7Cit9CisKK3N0YXRpYyBp
bmxpbmUgdm9pZCBzY2hlZF9hZGp1c3RfYWZmaW5pdHkoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAq
cywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHZjcHUg
KnYsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNwdW1h
c2tfdCAqaGFyZCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29u
c3QgY3B1bWFza190ICpzb2Z0KQoreworICAgIGlmICggcy0+YWRqdXN0X2FmZmluaXR5ICkKKyAg
ICAgICAgcy0+YWRqdXN0X2FmZmluaXR5KHMsIHYsIGhhcmQsIHNvZnQpOworfQorCitzdGF0aWMg
aW5saW5lIGludCBzY2hlZF9hZGp1c3RfZG9tKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKnMsIHN0
cnVjdCBkb21haW4gKmQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVj
dCB4ZW5fZG9tY3RsX3NjaGVkdWxlcl9vcCAqb3ApCit7CisgICAgaWYgKCBzLT5hZGp1c3QgKQor
ICAgICAgICByZXR1cm4gcy0+YWRqdXN0KHMsIGQsIG9wKTsKKyAgICBlbHNlCisgICAgICAgIHJl
dHVybiAwOworfQorCitzdGF0aWMgaW5saW5lIGludCBzY2hlZF9hZGp1c3RfY3B1cG9vbChjb25z
dCBzdHJ1Y3Qgc2NoZWR1bGVyICpzLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgc3RydWN0IHhlbl9zeXNjdGxfc2NoZWR1bGVyX29wICpvcCkKK3sKKyAgICBpZiAoIHMt
PmFkanVzdF9nbG9iYWwgKQorICAgICAgICByZXR1cm4gcy0+YWRqdXN0X2dsb2JhbChzLCBvcCk7
CisgICAgZWxzZQorICAgICAgICByZXR1cm4gMDsKK30KKwogI2RlZmluZSBSRUdJU1RFUl9TQ0hF
RFVMRVIoeCkgc3RhdGljIGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKngjI19lbnRyeSBcCiAgIF9f
dXNlZF9zZWN0aW9uKCIuZGF0YS5zY2hlZHVsZXJzIikgPSAmeDsKIAotLSAKMi4xNi40CgoKX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1h
aWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54
ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

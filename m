Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 5671DFC7D3
	for <lists+xen-devel@lfdr.de>; Thu, 14 Nov 2019 14:37:23 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iVFHk-0002v3-I3; Thu, 14 Nov 2019 13:35:44 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=H8L6=ZG=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1iVFHj-0002uy-67
 for xen-devel@lists.xenproject.org; Thu, 14 Nov 2019 13:35:43 +0000
X-Inumbo-ID: a6b977d4-06e3-11ea-b678-bc764e2007e4
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id a6b977d4-06e3-11ea-b678-bc764e2007e4;
 Thu, 14 Nov 2019 13:35:41 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id B09B0B02E;
 Thu, 14 Nov 2019 13:35:40 +0000 (UTC)
To: Roger Pau Monne <roger.pau@citrix.com>
References: <20191113155940.81837-1-roger.pau@citrix.com>
 <20191113155940.81837-3-roger.pau@citrix.com>
From: Jan Beulich <jbeulich@suse.com>
Message-ID: <6af26dbb-42c8-d938-ea6a-4ae0efcc4c87@suse.com>
Date: Thu, 14 Nov 2019 14:35:56 +0100
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:60.0) Gecko/20100101
 Thunderbird/60.9.1
MIME-Version: 1.0
In-Reply-To: <20191113155940.81837-3-roger.pau@citrix.com>
Content-Language: en-US
Subject: Re: [Xen-devel] [PATCH for-4.13 v4 2/3] x86/passthrough: fix
 migration of MSI when using posted interrupts
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, xen-devel@lists.xenproject.org,
 Joe Jin <joe.jin@oracle.com>, Wei Liu <wl@xen.org>,
 Andrew Cooper <andrew.cooper3@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

T24gMTMuMTEuMjAxOSAxNjo1OSwgUm9nZXIgUGF1IE1vbm5lIHdyb3RlOgo+IEBAIC01MjY2LDYg
KzUyNjcsMzYgQEAgdm9pZCBodm1fc2V0X3NlZ21lbnRfcmVnaXN0ZXIoc3RydWN0IHZjcHUgKnYs
IGVudW0geDg2X3NlZ21lbnQgc2VnLAo+ICAgICAgYWx0ZXJuYXRpdmVfdmNhbGwoaHZtX2Z1bmNz
LnNldF9zZWdtZW50X3JlZ2lzdGVyLCB2LCBzZWcsIHJlZyk7Cj4gIH0KPiAgCj4gK2ludCBodm1f
aW50cl9nZXRfZGVzdHMoc3RydWN0IGRvbWFpbiAqZCwgdWludDhfdCBkZXN0LCB1aW50OF90IGRl
c3RfbW9kZSwKCldoaWxlIGZvciBJTy1BUElDIGFuZCBNU0kgImRlc3QiIGNhbid0IGJlIHdpZGVy
IHRoYW4gOCBiaXRzIHdpdGhvdXQKdmlydHVhbCBpbnRlcnJ1cHQgcmVtYXBwaW5nLCAiaW50ciIg
aW1vIGlzIGdlbmVyaWMgZW5vdWdoIHRvIGFsc28KKHBvdGVudGlhbGx5KSBpbmNsdWRlIElQSXMu
IEknZCB0aGVyZWZvcmUgcmVjb21tZW5kIGluIG5ldyBjb2RlIHRvCm1ha2UgdGhpcyB1aW50MzJf
dCByaWdodCBhd2F5IHRvIGNvdmVyIGZvciBhbGwgY3VycmVudCBhbmQgZnV0dXJlCmNhc2VzLgoK
QWxzbyAtIGNvbnN0IGZvciBkPwoKPiArICAgICAgICAgICAgICAgICAgICAgICB1aW50OF90IGRl
bGl2ZXJ5X21vZGUsIHVuc2lnbmVkIGxvbmcgKnZjcHVzKQo+ICt7Cj4gKyAgICBzdHJ1Y3QgdmNw
dSAqdjsKPiArCj4gKyAgICBzd2l0Y2ggKCBkZWxpdmVyeV9tb2RlICkKPiArICAgIHsKPiArICAg
IGNhc2UgZGVzdF9Mb3dlc3RQcmlvOgo+ICsgICAgICAgIC8qCj4gKyAgICAgICAgICogR2V0IGFs
bCB0aGUgcG9zc2libGUgZGVzdGluYXRpb25zLCBidXQgbm90ZSB0aGF0IGxvd2VzdCBwcmlvcml0
eQo+ICsgICAgICAgICAqIG1vZGUgaXMgb25seSBnb2luZyB0byBpbmplY3QgdGhlIGludGVycnVw
dCB0byB0aGUgdkNQVSBydW5uaW5nIGF0Cj4gKyAgICAgICAgICogdGhlIGxlYXN0IHByaXZpbGVn
ZSBsZXZlbC4KCiJwcml2aWxlZ2UgbGV2ZWwiPyBJIHRoaW5rIHlvdSBtZWFuICJsb3dlc3QgcHJp
b3JpdHkiIGhlcmU/Cgo+ICsgICAgICAgICAqCj4gKyAgICAgICAgICogRmFsbHRocm91Z2gKPiAr
ICAgICAgICAgKi8KPiArICAgIGNhc2UgZGVzdF9GaXhlZDoKClRoZXJlJ3Mgbm90IHJlYWxseSBh
bnkgZmFsbCB0aHJvdWdoIGhlcmUsIGFuZCBoZW5jZSBJIHRoaW5rIHRoaXMgcGFydApvZiB0aGUg
Y29tbWVudCB3b3VsZCBiZXR0ZXIgYmUgZHJvcHBlZC4KCj4gKyAgICAgICAgZm9yX2VhY2hfdmNw
dSAoIGQsIHYgKQo+ICsgICAgICAgICAgICBpZiAoIHZsYXBpY19tYXRjaF9kZXN0KHZjcHVfdmxh
cGljKHYpLCBOVUxMLCAwLCBkZXN0LCBkZXN0X21vZGUpICkKPiArICAgICAgICAgICAgICAgIF9f
c2V0X2JpdCh2LT52Y3B1X2lkLCB2Y3B1cyk7Cj4gKyAgICAgICAgYnJlYWs7Cj4gKwo+ICsgICAg
ZGVmYXVsdDoKPiArICAgICAgICBncHJpbnRrKFhFTkxPR19XQVJOSU5HLCAidW5zdXBwb3J0ZWQg
aW50ZXJydXB0IGRlbGl2ZXJ5IG1vZGUgJXVcbiIsCj4gKyAgICAgICAgICAgICAgICBkZWxpdmVy
eV9tb2RlKTsKCmdkcHJpbnRrKCkgcGVyaGFwcywgc28ga2VlcCBhdCBsZWFzdCByZWxlYXNlIGJ1
aWxkcycgbG9ncyB0aWR5CihhbmQgdXNlZnVsKT8KCj4gLS0tIGEveGVuL2FyY2gveDg2L2h2bS92
bGFwaWMuYwo+ICsrKyBiL3hlbi9hcmNoL3g4Ni9odm0vdmxhcGljLmMKPiBAQCAtMTEyLDYgKzEx
MiwyNSBAQCBzdGF0aWMgdm9pZCBzeW5jX3Bpcl90b19pcnIoc3RydWN0IHZjcHUgKnYpCj4gICAg
ICAgICAgYWx0ZXJuYXRpdmVfdmNhbGwoaHZtX2Z1bmNzLnN5bmNfcGlyX3RvX2lyciwgdik7Cj4g
IH0KPiAgCj4gK3ZvaWQgZG9tYWluX3N5bmNfdmxhcGljX3BpcihzdHJ1Y3QgZG9tYWluICpkLCB1
bnNpZ25lZCBsb25nICp2Y3B1cykKCmNvbnN0ICh0d2ljZSk/Cgo+ICt7Cj4gKyAgICB1bnNpZ25l
ZCBpbnQgaWQ7Cj4gKwo+ICsgICAgaWYgKCAhYml0bWFwX3dlaWdodCh2Y3B1cywgZC0+bWF4X3Zj
cHVzKSApCj4gKyAgICAgICAgcmV0dXJuOwoKV2h5IGdvIG92ZXIgdGhlIGVudGlyZSBiaXRtYXAg
ZW4gZXh0cmEgdGltZSBoZXJlPyBUaGUgZmluZC1maXJzdAp3aWxsIGRvIGV4YWN0bHkgdGhlIHNh
bWUsIGFuZCBoZW5jZSB0aGUgbG9vcCBib2R5IGJlbG93IHdvbid0IGJlCmVudGVyZWQgaW4gdGhp
cyBjYXNlLgoKPiArICAgIGZvciAoIGlkID0gZmluZF9maXJzdF9iaXQodmNwdXMsIGQtPm1heF92
Y3B1cyk7Cj4gKyAgICAgICAgICBpZCA8IGQtPm1heF92Y3B1czsKPiArICAgICAgICAgIGlkID0g
ZmluZF9uZXh0X2JpdCh2Y3B1cywgZC0+bWF4X3ZjcHVzLCBpZCArIDEpICkKPiArICAgIHsKPiAr
ICAgICAgICBpZiAoIGQtPnZjcHVbaWRdICE9IGN1cnJlbnQgKQo+ICsgICAgICAgICAgICB2Y3B1
X3BhdXNlKGQtPnZjcHVbaWRdKTsKCklzbid0IHRoaXMgc2V0dGluZyB1cyB1cCBmb3IgYSBkZWFk
bG9jayBpZiB0d28gcGFydGllcyBjb21lIGhlcmUKZm9yIHRoZSBzYW1lIGRvbWFpbiwgYW5kIGJv
dGggb24gYSB2Q1BVIGJlbG9uZ2luZyB0byB0aGF0IGRvbWFpbgooYW5kIHdpdGggdGhlIG9wcG9z
aXRlIG9uZSdzIGJpdCBzZXQgaW4gdGhlIGJpdG1hcCk/IEJ1dCBpdCBsb29rcwpsaWtlIGQgd291
bGQgbmV2ZXIgYmUgdGhlIGN1cnJlbnQgZG9tYWluIGhlcmUgLSB5b3Ugd2lsbCB3YW50IHRvCmFz
c2VydCBhbmQgY29tbWVudCBvbiB0aGlzLCB0aG91Z2guIEF0IHRoYXQgcG9pbnQgdGhlIGNvbXBh
cmlzb25zCmFnYWluc3QgY3VycmVudCBjYW4gdGhlbiBnbyBhd2F5IGFzIHdlbGwgYWZhaWN0LgoK
PiBAQCAtMzQ1LDYgKzI4OSw4IEBAIGludCBwdF9pcnFfY3JlYXRlX2JpbmQoCj4gICAgICAgICAg
Y29uc3Qgc3RydWN0IHZjcHUgKnZjcHU7Cj4gICAgICAgICAgdWludDMyX3QgZ2ZsYWdzID0gcHRf
aXJxX2JpbmQtPnUubXNpLmdmbGFncyAmCj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgflhF
Tl9ET01DVExfVk1TSV9YODZfVU5NQVNLRUQ7Cj4gKyAgICAgICAgREVDTEFSRV9CSVRNQVAoZGVz
dF92Y3B1cywgTUFYX1ZJUlRfQ1BVUykgPSB7IH07Cj4gKyAgICAgICAgREVDTEFSRV9CSVRNQVAo
cHJldl92Y3B1cywgTUFYX1ZJUlRfQ1BVUykgPSB7IH07CgpUaGlzIGlzIHJlYWNoYWJsZSBmb3Ig
SFZNIGRvbWFpbnMgb25seSwgaXNuJ3QgaXQ/IEluIHdoaWNoIGNhc2UKd2h5IHRoZSBtdWNoIGxh
cmdlciBNQVhfVklSVF9DUFVTIChjcmVhdGluZyB0d28gdW5yZWFzb25hYmx5IGJpZwpsb2NhbCB2
YXJpYWJsZXMpIGluc3RlYWQgb2YgSFZNX01BWF9WQ1BVUz8gSG93ZXZlciwgZXZlbiBvbmNlCnN3
aXRjaGVkIEknZCBiZSBvcHBvc2VkIHRvIHRoaXMgLSBUaGVyZSdkIGJlIGEgZmFpciBjaGFuY2Ug
dGhhdAp0aGUgbmVlZCB0byBkZWFsIHdpdGggdGhlc2UgdmFyaWFibGVzIG1pZ2h0IGdvIHVubm90
aWNlZCBvbmNlCnRoZSBtYXhpbXVtIHZDUFUgY291bnQgZm9yIEhWTSBnZXRzIGluY3JlYXNlZCAo
d2hpY2ggaGFzIGJlZW4gYQpwZW5kaW5nIHRvZG8gaXRlbSBmb3IgbWFueSB5ZWFycyBub3cpLgoK
PiBAQCAtNDIwLDIwICszODQsMTYgQEAgaW50IHB0X2lycV9jcmVhdGVfYmluZCgKPiAgICAgICAg
ICBkZWxpdmVyeV9tb2RlID0gTUFTS19FWFRSKHBpcnFfZHBjaS0+Z21zaS5nZmxhZ3MsCj4gICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBYRU5fRE9NQ1RMX1ZNU0lfWDg2X0RFTElW
X01BU0spOwo+ICAKPiAtICAgICAgICBkZXN0X3ZjcHVfaWQgPSBodm1fZ2lycV9kZXN0XzJfdmNw
dV9pZChkLCBkZXN0LCBkZXN0X21vZGUpOwo+ICsgICAgICAgIGh2bV9pbnRyX2dldF9kZXN0cyhk
LCBkZXN0LCBkZXN0X21vZGUsIGRlbGl2ZXJ5X21vZGUsIGRlc3RfdmNwdXMpOwo+ICsgICAgICAg
IGRlc3RfdmNwdV9pZCA9IGJpdG1hcF93ZWlnaHQoZGVzdF92Y3B1cywgZC0+bWF4X3ZjcHVzKSAh
PSAxID8KPiArICAgICAgICAgICAgLTEgOiBmaW5kX2ZpcnN0X2JpdChkZXN0X3ZjcHVzLCBkLT5t
YXhfdmNwdXMpOwo+ICAgICAgICAgIHBpcnFfZHBjaS0+Z21zaS5kZXN0X3ZjcHVfaWQgPSBkZXN0
X3ZjcHVfaWQ7Cj4gICAgICAgICAgc3Bpbl91bmxvY2soJmQtPmV2ZW50X2xvY2spOwo+ICAKPiAg
ICAgICAgICBwaXJxX2RwY2ktPmdtc2kucG9zdGVkID0gZmFsc2U7Cj4gICAgICAgICAgdmNwdSA9
IChkZXN0X3ZjcHVfaWQgPj0gMCkgPyBkLT52Y3B1W2Rlc3RfdmNwdV9pZF0gOiBOVUxMOwo+IC0g
ICAgICAgIGlmICggaW9tbXVfaW50cG9zdCApCj4gLSAgICAgICAgewo+IC0gICAgICAgICAgICBp
ZiAoIGRlbGl2ZXJ5X21vZGUgPT0gZGVzdF9Mb3dlc3RQcmlvICkKPiAtICAgICAgICAgICAgICAg
IHZjcHUgPSB2ZWN0b3JfaGFzaGluZ19kZXN0KGQsIGRlc3QsIGRlc3RfbW9kZSwKPiAtICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpcnFfZHBjaS0+Z21zaS5ndmVj
KTsKPiAtICAgICAgICAgICAgaWYgKCB2Y3B1ICkKPiAtICAgICAgICAgICAgICAgIHBpcnFfZHBj
aS0+Z21zaS5wb3N0ZWQgPSB0cnVlOwo+IC0gICAgICAgIH0KPiArICAgICAgICBpZiAoIHZjcHUg
JiYgaW9tbXVfaW50cG9zdCApCj4gKyAgICAgICAgICAgIHBpcnFfZHBjaS0+Z21zaS5wb3N0ZWQg
PSB0cnVlOwoKT25lIGFzcGVjdCB0aGF0IEknbSBjdXJpb3VzIGFib3V0OiBIb3cgbXVjaCBwb3N0
aW5nIG9wcG9ydHVuaXR5IGRvCndlIGxvc2UgaW4gcHJhY3RpY2UgYnkgbm8gbG9uZ2VyIHBvc3Rp
bmcgd2hlbiB0aGUgZ3Vlc3QgdXNlcyBsb3dlc3QKcHJpb3JpdHkgbW9kZSB3aXRoIG11bHRpcGxl
IGRlc3RpbmF0aW9ucz8KCj4gQEAgLTQ0Miw2ICs0MDIsOSBAQCBpbnQgcHRfaXJxX2NyZWF0ZV9i
aW5kKAo+ICAgICAgICAgICAgICBwaV91cGRhdGVfaXJ0ZSh2Y3B1ID8gJnZjcHUtPmFyY2guaHZt
LnZteC5waV9kZXNjIDogTlVMTCwKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mbywg
cGlycV9kcGNpLT5nbXNpLmd2ZWMpOwo+ICAKPiArICAgICAgICBpZiAoIGh2bV9mdW5jcy5kZWxp
dmVyX3Bvc3RlZF9pbnRyICkKPiArICAgICAgICAgICAgZG9tYWluX3N5bmNfdmxhcGljX3Bpcihk
LCBwcmV2X3ZjcHVzKTsKCkFjY2Vzc2luZyBodm1fZnVuY3MgaGVyZSBsb29rcyBsaWtlIGEgbGF5
ZXJpbmcgdmlvbGF0aW9uLiBUaGlzCndhbnRzIGVpdGhlciBtb3ZpbmcgaW50byB0aGUgZnVuY3Rp
b24gb3IgKHNlZWluZyB0aGUgb3RoZXIgdXNlKQphYnN0cmFjdGluZyBhd2F5LiBTZWVpbmcgdGhl
IGNvbmRpdGlvbmFsIGhlcmUgKGFuZCBiZWxvdykgSSBhbHNvCm5vdGljZSB0aGF0IHlvdSBjYWxj
dWxhdGUgcHJldl92Y3B1cyBpbiB2ZWluIHdoZW4gdGhlcmUncyBubwppbnRlcnJ1cHQgcG9zdGlu
ZyBpbiB1c2UuCgpJIGd1ZXNzIHRvZ2V0aGVyIHdpdGggdGhlIHZhcmlhYmxlIHNpemUgaXNzdWUg
bWVudGlvbmVkIGFib3ZlIGEKcG9zc2libGUgc29sdXRpb24gd291bGQgYmU6Ci0gaGF2ZSBvbmUg
Yml0bWFwIGhhbmdpbmcgb2ZmIG9mIHBpcnFfZHBjaS0+Z21zaSwKLSBoYXZlIG9uZSBiaXRtYXAg
cGVyIHBDUFUsCi0gcG9wdWxhdGUgdGhlIG5ldyBkZXN0aW5hdGlvbiBiaXRzIGludG8gdGhlIHBl
ci1wQ1BVIG9uZSwKLSBpc3N1ZSB0aGUgUElSLT5JUlIgc3luYywKLSBleGNoYW5nZSB0aGUgcGVy
LXBDUFUgYW5kIHBlci1EUENJIHBvaW50ZXJzLgpZb3UgY291bGQgdGhlbiBsZWF2ZSB0aGUgcG9p
bnRlcnMgYXQgTlVMTCB3aGVuIG5vIHBvc3RpbmcgaXMgdG8KYmUgdXNlZCwgYWRkcmVzc2luZyB0
aGUgYXBwYXJlbnQgbGF5ZXJpbmcgdmlvbGF0aW9uIGhlcmUgYXQgdGhlCnNhbWUgdGltZS4KCkph
bgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRl
dmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9s
aXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

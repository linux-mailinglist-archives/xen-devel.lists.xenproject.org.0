Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id BE871B2A95
	for <lists+xen-devel@lfdr.de>; Sat, 14 Sep 2019 10:55:33 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i93oE-00081O-VL; Sat, 14 Sep 2019 08:53:34 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=rDpt=XJ=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1i93oC-0007zJ-UR
 for xen-devel@lists.xenproject.org; Sat, 14 Sep 2019 08:53:32 +0000
X-Inumbo-ID: 1149e846-d6cd-11e9-a337-bc764e2007e4
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 1149e846-d6cd-11e9-a337-bc764e2007e4;
 Sat, 14 Sep 2019 08:53:06 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 49923B672;
 Sat, 14 Sep 2019 08:53:04 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Sat, 14 Sep 2019 10:52:34 +0200
Message-Id: <20190914085251.18816-31-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190914085251.18816-1-jgross@suse.com>
References: <20190914085251.18816-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v3 30/47] xen/sched: add support for multiple
 vcpus per sched unit where missing
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>,
 Dario Faggioli <dfaggioli@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SW4gc2V2ZXJhbCBwbGFjZXMgdGhlcmUgaXMgc3VwcG9ydCBmb3IgbXVsdGlwbGUgdmNwdXMgcGVy
IHNjaGVkIHVuaXQKbWlzc2luZy4gQWRkIHRoYXQgbWlzc2luZyBzdXBwb3J0ICh3aXRoIHRoZSBl
eGNlcHRpb24gb2YgaW5pdGlhbAphbGxvY2F0aW9uKSBhbmQgbWlzc2luZyBoZWxwZXJzIGZvciB0
aGF0LgoKU2lnbmVkLW9mZi1ieTogSnVlcmdlbiBHcm9zcyA8amdyb3NzQHN1c2UuY29tPgotLS0K
UkZDIFYyOgotIGZpeCB2Y3B1X3J1bnN0YXRlX2hlbHBlcigpClYxOgotIGFkZCBzcGVjaWFsIGhh
bmRsaW5nIGZvciBpZGxlIHVuaXQgaW4gdW5pdF9ydW5uYWJsZSgpIGFuZAogIHVuaXRfcnVubmFi
bGVfc3RhdGUoKQpWMjoKLSBoYW5kbGUgYWZmaW5pdHlfYnJva2VuIGNvcnJlY3RseSAoSmFuIEJl
dWxpY2gpClYzOgotIHR5cGUgZm9yIGNwdSAtPnVuc2lnbmVkIGludCAoSmFuIEJldWxpY2gpCi0t
LQogeGVuL2NvbW1vbi9kb21haW4uYyAgICAgICAgfCAgNSArKystCiB4ZW4vY29tbW9uL3NjaGVk
dWxlLmMgICAgICB8IDM3ICsrKysrKysrKysrKystLS0tLS0tLS0tLS0tCiB4ZW4vaW5jbHVkZS94
ZW4vc2NoZWQtaWYuaCB8IDY1ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysr
Ky0tLS0tLS0KIDMgZmlsZXMgY2hhbmdlZCwgNzkgaW5zZXJ0aW9ucygrKSwgMjggZGVsZXRpb25z
KC0pCgpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9kb21haW4uYyBiL3hlbi9jb21tb24vZG9tYWlu
LmMKaW5kZXggZmE0MDIzOTM2Yi4uZWE2YWVlMzg1OCAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9k
b21haW4uYworKysgYi94ZW4vY29tbW9uL2RvbWFpbi5jCkBAIC0xMjU5LDcgKzEyNTksMTAgQEAg
aW50IHZjcHVfcmVzZXQoc3RydWN0IHZjcHUgKnYpCiAgICAgdi0+YXN5bmNfZXhjZXB0aW9uX21h
c2sgPSAwOwogICAgIG1lbXNldCh2LT5hc3luY19leGNlcHRpb25fc3RhdGUsIDAsIHNpemVvZih2
LT5hc3luY19leGNlcHRpb25fc3RhdGUpKTsKICNlbmRpZgotICAgIHYtPmFmZmluaXR5X2Jyb2tl
biA9IDA7CisgICAgaWYgKCB2LT5hZmZpbml0eV9icm9rZW4gJiBWQ1BVX0FGRklOSVRZX09WRVJS
SURFICkKKyAgICAgICAgdmNwdV90ZW1wb3JhcnlfYWZmaW5pdHkodiwgTlJfQ1BVUywgVkNQVV9B
RkZJTklUWV9PVkVSUklERSk7CisgICAgaWYgKCB2LT5hZmZpbml0eV9icm9rZW4gJiBWQ1BVX0FG
RklOSVRZX1dBSVQgKQorICAgICAgICB2Y3B1X3RlbXBvcmFyeV9hZmZpbml0eSh2LCBOUl9DUFVT
LCBWQ1BVX0FGRklOSVRZX1dBSVQpOwogICAgIGNsZWFyX2JpdChfVlBGX2Jsb2NrZWQsICZ2LT5w
YXVzZV9mbGFncyk7CiAgICAgY2xlYXJfYml0KF9WUEZfaW5fcmVzZXQsICZ2LT5wYXVzZV9mbGFn
cyk7CiAKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vc2NoZWR1bGUuYyBiL3hlbi9jb21tb24vc2No
ZWR1bGUuYwppbmRleCAwM2JjZjc5NmFlLi5hNzkwNjVjODI2IDEwMDY0NAotLS0gYS94ZW4vY29t
bW9uL3NjaGVkdWxlLmMKKysrIGIveGVuL2NvbW1vbi9zY2hlZHVsZS5jCkBAIC0yNDMsOCArMjQz
LDkgQEAgc3RhdGljIGlubGluZSB2b2lkIHZjcHVfcnVuc3RhdGVfY2hhbmdlKAogICAgIHNfdGlt
ZV90IGRlbHRhOwogICAgIHN0cnVjdCBzY2hlZF91bml0ICp1bml0ID0gdi0+c2NoZWRfdW5pdDsK
IAotICAgIEFTU0VSVCh2LT5ydW5zdGF0ZS5zdGF0ZSAhPSBuZXdfc3RhdGUpOwogICAgIEFTU0VS
VChzcGluX2lzX2xvY2tlZChnZXRfc2NoZWRfcmVzKHYtPnByb2Nlc3NvciktPnNjaGVkdWxlX2xv
Y2spKTsKKyAgICBpZiAoIHYtPnJ1bnN0YXRlLnN0YXRlID09IG5ld19zdGF0ZSApCisgICAgICAg
IHJldHVybjsKIAogICAgIHZjcHVfdXJnZW50X2NvdW50X3VwZGF0ZSh2KTsKIApAQCAtMjY2LDE1
ICsyNjcsMTYgQEAgc3RhdGljIGlubGluZSB2b2lkIHZjcHVfcnVuc3RhdGVfY2hhbmdlKAogc3Rh
dGljIGlubGluZSB2b2lkIHNjaGVkX3VuaXRfcnVuc3RhdGVfY2hhbmdlKHN0cnVjdCBzY2hlZF91
bml0ICp1bml0LAogICAgIGJvb2wgcnVubmluZywgc190aW1lX3QgbmV3X2VudHJ5X3RpbWUpCiB7
Ci0gICAgc3RydWN0IHZjcHUgKnYgPSB1bml0LT52Y3B1X2xpc3Q7CisgICAgc3RydWN0IHZjcHUg
KnY7CiAKLSAgICBpZiAoIHJ1bm5pbmcgKQotICAgICAgICB2Y3B1X3J1bnN0YXRlX2NoYW5nZSh2
LCB2LT5uZXdfc3RhdGUsIG5ld19lbnRyeV90aW1lKTsKLSAgICBlbHNlCi0gICAgICAgIHZjcHVf
cnVuc3RhdGVfY2hhbmdlKHYsCi0gICAgICAgICAgICAoKHYtPnBhdXNlX2ZsYWdzICYgVlBGX2Js
b2NrZWQpID8gUlVOU1RBVEVfYmxvY2tlZCA6Ci0gICAgICAgICAgICAgKHZjcHVfcnVubmFibGUo
dikgPyBSVU5TVEFURV9ydW5uYWJsZSA6IFJVTlNUQVRFX29mZmxpbmUpKSwKLSAgICAgICAgICAg
IG5ld19lbnRyeV90aW1lKTsKKyAgICBmb3JfZWFjaF9zY2hlZF91bml0X3ZjcHUgKCB1bml0LCB2
ICkKKyAgICAgICAgaWYgKCBydW5uaW5nICkKKyAgICAgICAgICAgIHZjcHVfcnVuc3RhdGVfY2hh
bmdlKHYsIHYtPm5ld19zdGF0ZSwgbmV3X2VudHJ5X3RpbWUpOworICAgICAgICBlbHNlCisgICAg
ICAgICAgICB2Y3B1X3J1bnN0YXRlX2NoYW5nZSh2LAorICAgICAgICAgICAgICAgICgodi0+cGF1
c2VfZmxhZ3MgJiBWUEZfYmxvY2tlZCkgPyBSVU5TVEFURV9ibG9ja2VkIDoKKyAgICAgICAgICAg
ICAgICAgKHZjcHVfcnVubmFibGUodikgPyBSVU5TVEFURV9ydW5uYWJsZSA6IFJVTlNUQVRFX29m
ZmxpbmUpKSwKKyAgICAgICAgICAgICAgICBuZXdfZW50cnlfdGltZSk7CiB9CiAKIHZvaWQgdmNw
dV9ydW5zdGF0ZV9nZXQoc3RydWN0IHZjcHUgKnYsIHN0cnVjdCB2Y3B1X3J1bnN0YXRlX2luZm8g
KnJ1bnN0YXRlKQpAQCAtMTAzMSwxMCArMTAzMyw5IEBAIGludCBjcHVfZGlzYWJsZV9zY2hlZHVs
ZXIodW5zaWduZWQgaW50IGNwdSkKICAgICAgICAgICAgIGlmICggY3B1bWFza19lbXB0eSgmb25s
aW5lX2FmZmluaXR5KSAmJgogICAgICAgICAgICAgICAgICBjcHVtYXNrX3Rlc3RfY3B1KGNwdSwg
dW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHkpICkKICAgICAgICAgICAgIHsKLSAgICAgICAgICAgICAg
ICAvKiBUT0RPOiBtdWx0aXBsZSB2Y3B1cyBwZXIgdW5pdC4gKi8KLSAgICAgICAgICAgICAgICBp
ZiAoIHVuaXQtPnZjcHVfbGlzdC0+YWZmaW5pdHlfYnJva2VuICkKKyAgICAgICAgICAgICAgICBp
ZiAoIHNjaGVkX2NoZWNrX2FmZmluaXR5X2Jyb2tlbih1bml0KSApCiAgICAgICAgICAgICAgICAg
ewotICAgICAgICAgICAgICAgICAgICAvKiBUaGUgdmNwdSBpcyB0ZW1wb3JhcmlseSBwaW5uZWQs
IGNhbid0IG1vdmUgaXQuICovCisgICAgICAgICAgICAgICAgICAgIC8qIFRoZSB1bml0IGlzIHRl
bXBvcmFyaWx5IHBpbm5lZCwgY2FuJ3QgbW92ZSBpdC4gKi8KICAgICAgICAgICAgICAgICAgICAg
dW5pdF9zY2hlZHVsZV91bmxvY2tfaXJxcmVzdG9yZShsb2NrLCBmbGFncywgdW5pdCk7CiAgICAg
ICAgICAgICAgICAgICAgIHJldCA9IC1FQUREUklOVVNFOwogICAgICAgICAgICAgICAgICAgICBi
cmVhazsKQEAgLTEzOTIsMTcgKzEzOTMsMTcgQEAgaW50IHZjcHVfdGVtcG9yYXJ5X2FmZmluaXR5
KHN0cnVjdCB2Y3B1ICp2LCB1bnNpZ25lZCBpbnQgY3B1LCB1aW50OF90IHJlYXNvbikKICAgICAg
ICAgICAgIHJldCA9IDA7CiAgICAgICAgICAgICB2LT5hZmZpbml0eV9icm9rZW4gJj0gfnJlYXNv
bjsKICAgICAgICAgfQotICAgICAgICBpZiAoICFyZXQgJiYgIXYtPmFmZmluaXR5X2Jyb2tlbiAp
CisgICAgICAgIGlmICggIXJldCAmJiAhc2NoZWRfY2hlY2tfYWZmaW5pdHlfYnJva2VuKHVuaXQp
ICkKICAgICAgICAgICAgIHNjaGVkX3NldF9hZmZpbml0eSh2LCB1bml0LT5jcHVfaGFyZF9hZmZp
bml0eV9zYXZlZCwgTlVMTCk7CiAgICAgfQogICAgIGVsc2UgaWYgKCBjcHUgPCBucl9jcHVfaWRz
ICkKICAgICB7CiAgICAgICAgIGlmICggKHYtPmFmZmluaXR5X2Jyb2tlbiAmIHJlYXNvbikgfHwK
LSAgICAgICAgICAgICAodi0+YWZmaW5pdHlfYnJva2VuICYmIHYtPnByb2Nlc3NvciAhPSBjcHUp
ICkKKyAgICAgICAgICAgICAoc2NoZWRfY2hlY2tfYWZmaW5pdHlfYnJva2VuKHVuaXQpICYmIHYt
PnByb2Nlc3NvciAhPSBjcHUpICkKICAgICAgICAgICAgIHJldCA9IC1FQlVTWTsKICAgICAgICAg
ZWxzZSBpZiAoIGNwdW1hc2tfdGVzdF9jcHUoY3B1LCBWQ1BVMk9OTElORSh2KSkgKQogICAgICAg
ICB7Ci0gICAgICAgICAgICBpZiAoICF2LT5hZmZpbml0eV9icm9rZW4gKQorICAgICAgICAgICAg
aWYgKCAhc2NoZWRfY2hlY2tfYWZmaW5pdHlfYnJva2VuKHVuaXQpICkKICAgICAgICAgICAgIHsK
ICAgICAgICAgICAgICAgICBjcHVtYXNrX2NvcHkodW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHlfc2F2
ZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5
KTsKQEAgLTE3MjIsMTQgKzE3MjMsMTQgQEAgc3RhdGljIHZvaWQgc2NoZWRfc3dpdGNoX3VuaXRz
KHN0cnVjdCBzY2hlZF9yZXNvdXJjZSAqc2QsCiAgICAgICAgICAgICAgKG5leHQtPnZjcHVfbGlz
dC0+cnVuc3RhdGUuc3RhdGUgPT0gUlVOU1RBVEVfcnVubmFibGUpID8KICAgICAgICAgICAgICAo
bm93IC0gbmV4dC0+c3RhdGVfZW50cnlfdGltZSkgOiAwLCBwcmV2LT5uZXh0X3RpbWUpOwogCi0g
ICAgQVNTRVJUKHByZXYtPnZjcHVfbGlzdC0+cnVuc3RhdGUuc3RhdGUgPT0gUlVOU1RBVEVfcnVu
bmluZyk7CisgICAgQVNTRVJUKHVuaXRfcnVubmluZyhwcmV2KSk7CiAKICAgICBUUkFDRV80RChU
UkNfU0NIRURfU1dJVENILCBwcmV2LT5kb21haW4tPmRvbWFpbl9pZCwgcHJldi0+dW5pdF9pZCwK
ICAgICAgICAgICAgICBuZXh0LT5kb21haW4tPmRvbWFpbl9pZCwgbmV4dC0+dW5pdF9pZCk7CiAK
ICAgICBzY2hlZF91bml0X3J1bnN0YXRlX2NoYW5nZShwcmV2LCBmYWxzZSwgbm93KTsKIAotICAg
IEFTU0VSVChuZXh0LT52Y3B1X2xpc3QtPnJ1bnN0YXRlLnN0YXRlICE9IFJVTlNUQVRFX3J1bm5p
bmcpOworICAgIEFTU0VSVCghdW5pdF9ydW5uaW5nKG5leHQpKTsKICAgICBzY2hlZF91bml0X3J1
bnN0YXRlX2NoYW5nZShuZXh0LCB0cnVlLCBub3cpOwogCiAgICAgLyoKQEAgLTE4NTEsNyArMTg1
Miw3IEBAIHZvaWQgc2NoZWRfY29udGV4dF9zd2l0Y2hlZChzdHJ1Y3QgdmNwdSAqdnByZXYsIHN0
cnVjdCB2Y3B1ICp2bmV4dCkKICAgICAgICAgICAgIHdoaWxlICggYXRvbWljX3JlYWQoJm5leHQt
PnJlbmRlenZvdXNfb3V0X2NudCkgKQogICAgICAgICAgICAgICAgIGNwdV9yZWxheCgpOwogICAg
IH0KLSAgICBlbHNlIGlmICggdnByZXYgIT0gdm5leHQgKQorICAgIGVsc2UgaWYgKCB2cHJldiAh
PSB2bmV4dCAmJiBzY2hlZF9ncmFudWxhcml0eSA9PSAxICkKICAgICAgICAgY29udGV4dF9zYXZl
ZCh2cHJldik7CiB9CiAKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5oIGIv
eGVuL2luY2x1ZGUveGVuL3NjaGVkLWlmLmgKaW5kZXggMjViYTZmMjVjOS4uNmE0ZGJhYzkzNSAx
MDA2NDQKLS0tIGEveGVuL2luY2x1ZGUveGVuL3NjaGVkLWlmLmgKKysrIGIveGVuL2luY2x1ZGUv
eGVuL3NjaGVkLWlmLmgKQEAgLTY4LDEyICs2OCwzMiBAQCBzdGF0aWMgaW5saW5lIGJvb2wgaXNf
aWRsZV91bml0KGNvbnN0IHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogCiBzdGF0aWMgaW5saW5l
IGJvb2wgaXNfdW5pdF9vbmxpbmUoY29uc3Qgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiB7Ci0g
ICAgcmV0dXJuIGlzX3ZjcHVfb25saW5lKHVuaXQtPnZjcHVfbGlzdCk7CisgICAgc3RydWN0IHZj
cHUgKnY7CisKKyAgICBmb3JfZWFjaF9zY2hlZF91bml0X3ZjcHUgKCB1bml0LCB2ICkKKyAgICAg
ICAgaWYgKCBpc192Y3B1X29ubGluZSh2KSApCisgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKKwor
ICAgIHJldHVybiBmYWxzZTsKK30KKworc3RhdGljIGlubGluZSB1bnNpZ25lZCBpbnQgdW5pdF9y
dW5uaW5nKGNvbnN0IHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQoreworICAgIHJldHVybiB1bml0
LT5ydW5zdGF0ZV9jbnRbUlVOU1RBVEVfcnVubmluZ107CiB9CiAKIHN0YXRpYyBpbmxpbmUgYm9v
bCB1bml0X3J1bm5hYmxlKGNvbnN0IHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogewotICAgIHJl
dHVybiB2Y3B1X3J1bm5hYmxlKHVuaXQtPnZjcHVfbGlzdCk7CisgICAgc3RydWN0IHZjcHUgKnY7
CisKKyAgICBpZiAoIGlzX2lkbGVfdW5pdCh1bml0KSApCisgICAgICAgIHJldHVybiB0cnVlOwor
CisgICAgZm9yX2VhY2hfc2NoZWRfdW5pdF92Y3B1ICggdW5pdCwgdiApCisgICAgICAgIGlmICgg
dmNwdV9ydW5uYWJsZSh2KSApCisgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKKworICAgIHJldHVy
biBmYWxzZTsKIH0KIAogc3RhdGljIGlubGluZSBib29sIHVuaXRfcnVubmFibGVfc3RhdGUoY29u
c3Qgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCkBAIC0xMDIsNyArMTIyLDE2IEBAIHN0YXRpYyBp
bmxpbmUgYm9vbCB1bml0X3J1bm5hYmxlX3N0YXRlKGNvbnN0IHN0cnVjdCBzY2hlZF91bml0ICp1
bml0KQogc3RhdGljIGlubGluZSB2b2lkIHNjaGVkX3NldF9yZXMoc3RydWN0IHNjaGVkX3VuaXQg
KnVuaXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3Qgc2NoZWRfcmVz
b3VyY2UgKnJlcykKIHsKLSAgICB1bml0LT52Y3B1X2xpc3QtPnByb2Nlc3NvciA9IHJlcy0+bWFz
dGVyX2NwdTsKKyAgICB1bnNpZ25lZCBpbnQgY3B1ID0gY3B1bWFza19maXJzdChyZXMtPmNwdXMp
OworICAgIHN0cnVjdCB2Y3B1ICp2OworCisgICAgZm9yX2VhY2hfc2NoZWRfdW5pdF92Y3B1ICgg
dW5pdCwgdiApCisgICAgeworICAgICAgICBBU1NFUlQoY3B1IDwgbnJfY3B1X2lkcyk7CisgICAg
ICAgIHYtPnByb2Nlc3NvciA9IGNwdTsKKyAgICAgICAgY3B1ID0gY3B1bWFza19uZXh0KGNwdSwg
cmVzLT5jcHVzKTsKKyAgICB9CisKICAgICB1bml0LT5yZXMgPSByZXM7CiB9CiAKQEAgLTExNCwy
NSArMTQzLDM3IEBAIHN0YXRpYyBpbmxpbmUgdW5zaWduZWQgaW50IHNjaGVkX3VuaXRfY3B1KGNv
bnN0IHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogc3RhdGljIGlubGluZSB2b2lkIHNjaGVkX3Nl
dF9wYXVzZV9mbGFncyhzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCwKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IGJpdCkKIHsKLSAgICBfX3NldF9i
aXQoYml0LCAmdW5pdC0+dmNwdV9saXN0LT5wYXVzZV9mbGFncyk7CisgICAgc3RydWN0IHZjcHUg
KnY7CisKKyAgICBmb3JfZWFjaF9zY2hlZF91bml0X3ZjcHUgKCB1bml0LCB2ICkKKyAgICAgICAg
X19zZXRfYml0KGJpdCwgJnYtPnBhdXNlX2ZsYWdzKTsKIH0KIAogc3RhdGljIGlubGluZSB2b2lk
IHNjaGVkX2NsZWFyX3BhdXNlX2ZsYWdzKHN0cnVjdCBzY2hlZF91bml0ICp1bml0LAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCBiaXQpCiB7
Ci0gICAgX19jbGVhcl9iaXQoYml0LCAmdW5pdC0+dmNwdV9saXN0LT5wYXVzZV9mbGFncyk7Cisg
ICAgc3RydWN0IHZjcHUgKnY7CisKKyAgICBmb3JfZWFjaF9zY2hlZF91bml0X3ZjcHUgKCB1bml0
LCB2ICkKKyAgICAgICAgX19jbGVhcl9iaXQoYml0LCAmdi0+cGF1c2VfZmxhZ3MpOwogfQogCiBz
dGF0aWMgaW5saW5lIHZvaWQgc2NoZWRfc2V0X3BhdXNlX2ZsYWdzX2F0b21pYyhzdHJ1Y3Qgc2No
ZWRfdW5pdCAqdW5pdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHVuc2lnbmVkIGludCBiaXQpCiB7Ci0gICAgc2V0X2JpdChiaXQsICZ1bml0LT52Y3B1
X2xpc3QtPnBhdXNlX2ZsYWdzKTsKKyAgICBzdHJ1Y3QgdmNwdSAqdjsKKworICAgIGZvcl9lYWNo
X3NjaGVkX3VuaXRfdmNwdSAoIHVuaXQsIHYgKQorICAgICAgICBzZXRfYml0KGJpdCwgJnYtPnBh
dXNlX2ZsYWdzKTsKIH0KIAogc3RhdGljIGlubGluZSB2b2lkIHNjaGVkX2NsZWFyX3BhdXNlX2Zs
YWdzX2F0b21pYyhzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IGJpdCkKIHsKLSAgICBj
bGVhcl9iaXQoYml0LCAmdW5pdC0+dmNwdV9saXN0LT5wYXVzZV9mbGFncyk7CisgICAgc3RydWN0
IHZjcHUgKnY7CisKKyAgICBmb3JfZWFjaF9zY2hlZF91bml0X3ZjcHUgKCB1bml0LCB2ICkKKyAg
ICAgICAgY2xlYXJfYml0KGJpdCwgJnYtPnBhdXNlX2ZsYWdzKTsKIH0KIAogc3RhdGljIGlubGlu
ZSBzdHJ1Y3Qgc2NoZWRfdW5pdCAqc2NoZWRfaWRsZV91bml0KHVuc2lnbmVkIGludCBjcHUpCkBA
IC00NTgsMTIgKzQ5OSwxOCBAQCBzdGF0aWMgaW5saW5lIGludCBzY2hlZF9hZGp1c3RfY3B1cG9v
bChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpzLAogCiBzdGF0aWMgaW5saW5lIHZvaWQgc2NoZWRf
dW5pdF9wYXVzZV9ub3N5bmMoc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiB7Ci0gICAgdmNwdV9w
YXVzZV9ub3N5bmModW5pdC0+dmNwdV9saXN0KTsKKyAgICBzdHJ1Y3QgdmNwdSAqdjsKKworICAg
IGZvcl9lYWNoX3NjaGVkX3VuaXRfdmNwdSAoIHVuaXQsIHYgKQorICAgICAgICB2Y3B1X3BhdXNl
X25vc3luYyh2KTsKIH0KIAogc3RhdGljIGlubGluZSB2b2lkIHNjaGVkX3VuaXRfdW5wYXVzZShz
dHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIHsKLSAgICB2Y3B1X3VucGF1c2UodW5pdC0+dmNwdV9s
aXN0KTsKKyAgICBzdHJ1Y3QgdmNwdSAqdjsKKworICAgIGZvcl9lYWNoX3NjaGVkX3VuaXRfdmNw
dSAoIHVuaXQsIHYgKQorICAgICAgICB2Y3B1X3VucGF1c2Uodik7CiB9CiAKICNkZWZpbmUgUkVH
SVNURVJfU0NIRURVTEVSKHgpIHN0YXRpYyBjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICp4IyNfZW50
cnkgXAotLSAKMi4xNi40CgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVj
dC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1k
ZXZlbA==

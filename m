Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 2E2FF167CD0
	for <lists+xen-devel@lfdr.de>; Fri, 21 Feb 2020 12:54:04 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1j56p5-0000AZ-1h; Fri, 21 Feb 2020 11:50:23 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=aa0I=4J=xen.org=wl@srs-us1.protection.inumbo.net>)
 id 1j56p4-0000AU-He
 for xen-devel@lists.xenproject.org; Fri, 21 Feb 2020 11:50:22 +0000
X-Inumbo-ID: 56da116e-54a0-11ea-bc8e-bc764e2007e4
Received: from mail.xenproject.org (unknown [104.130.215.37])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 56da116e-54a0-11ea-bc8e-bc764e2007e4;
 Fri, 21 Feb 2020 11:50:21 +0000 (UTC)
Received: from xenbits.xenproject.org ([104.239.192.120])
 by mail.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <wl@xen.org>)
 id 1j56p2-00018F-Tm; Fri, 21 Feb 2020 11:50:20 +0000
Received: from 41.142.6.51.dyn.plus.net ([51.6.142.41] helo=debian)
 by xenbits.xenproject.org with esmtpsa
 (TLS1.2:ECDHE_RSA_AES_256_GCM_SHA384:256) (Exim 4.89)
 (envelope-from <wl@xen.org>)
 id 1j56p2-0006Jd-KV; Fri, 21 Feb 2020 11:50:20 +0000
Date: Fri, 21 Feb 2020 11:50:17 +0000
From: Wei Liu <wl@xen.org>
To: Hongyan Xia <hongyxia@amazon.com>
Message-ID: <20200221115017.tuo2i5db5mhd5yyt@debian>
References: <4058e92ce21627731c49b588a95809dc0affd83a.1581015491.git.hongyxia@amazon.com>
MIME-Version: 1.0
Content-Disposition: inline
In-Reply-To: <4058e92ce21627731c49b588a95809dc0affd83a.1581015491.git.hongyxia@amazon.com>
User-Agent: NeoMutt/20180716
Subject: Re: [Xen-devel] [PATCH v2] x86/domain_page: implement pure per-vCPU
 mapping infrastructure
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Wei Liu <wl@xen.org>, Andrew Cooper <andrew.cooper3@citrix.com>,
 jgrall@amazon.com, Jan Beulich <jbeulich@suse.com>,
 xen-devel@lists.xenproject.org,
 Roger Pau =?utf-8?B?TW9ubsOp?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

T24gVGh1LCBGZWIgMDYsIDIwMjAgYXQgMDY6NTg6MjNQTSArMDAwMCwgSG9uZ3lhbiBYaWEgd3Jv
dGU6Cj4gUmV3cml0ZSB0aGUgbWFwY2FjaGUgdG8gYmUgcHVyZWx5IHBlci12Q1BVIGluc3RlYWQg
b2YgcGFydGlhbGx5IHBlci12Y3B1Cj4gYW5kIHBhcnRpYWxseSBwZXItZG9tYWluLgo+IAo+IFRo
ZSBleGlzdGluZyBtYXBjYWNoZSBpbXBsZW1lbnRhdGlvbiBrZWVwcyBwZXItdmNwdSBoYXNoIHRh
YmxlcyBmb3IKPiBjYWNoaW5nLCBidXQgYWxzbyBjcmVhdGVzIGEgcGVyLWRvbWFpbiByZWdpb24g
d2hpY2ggaXMgc2hhcmVkIGJ5IGFsbAo+IHZjcHVzIGFuZCBwcm90ZWN0ZWQgYnkgYSBwZXItZG9t
YWluIGxvY2suIFdoZW4gdGhlIHZjcHUgY291bnQgb2YgYQo+IGRvbWFpbiBpcyBsYXJnZSwgdGhl
IHBlci1kb21haW4gbG9jayBjb250ZW50aW9uIGlzIGhpZ2guIEFsc28sIHNldmVyYWwKPiBkYXRh
IHN0cnVjdHVyZXMgYXJlIHNoYXJlZCBhbW9uZyBhbGwgdmNwdXMsIHBvdGVudGlhbGx5IGNyZWF0
aW5nIHNlcmlvdXMKPiBjYWNoZSBwaW5nLXBvbmcgZWZmZWN0cy4gUGVyZm9ybWFuY2UgZGVncmFk
YXRpb24gY2FuIGJlIHNlZW4gb24gZG9tYWlucwo+IHdpdGggPjE2IHZjcHVzLgo+IAo+IFRoaXMg
cGF0Y2ggaXMgbmVlZGVkIHRvIGFkZHJlc3MgdGhlc2UgaXNzdWVzIHdoZW4gd2Ugc3RhcnQgcmVs
eWluZyBvbgo+IHRoZSBtYXBjYWNoZSAoZS5nLiwgd2hlbiB3ZSBkbyBub3QgaGF2ZSBhIGRpcmVj
dCBtYXApLiBJdCBwYXJ0aXRpb25zIHRoZQo+IHBlci1kb21haW4gcmVnaW9uIGludG8gcGVyLXZj
cHUgcmVnaW9ucyBzbyB0aGF0IG5vIG1hcGNhY2hlIHN0YXRlIGlzCj4gc2hhcmVkIGFtb25nIHZj
cHVzLiBBcyBhIHJlc3VsdCwgbm8gbG9ja2luZyBpcyByZXF1aXJlZCBhbmQgYSBtdWNoCj4gc2lt
cGxlciBtYXBoYXNoIGRlc2lnbiBjYW4gYmUgdXNlZC4gVGhlIHBlcmZvcm1hbmNlIGltcHJvdmVt
ZW50IGFmdGVyCj4gdGhpcyBwYXRjaCBpcyBxdWl0ZSBub3RpY2VhYmxlLgo+IAo+IEJlbmNobWFy
a3MKPiAoYmFzZWxpbmUgdXNlcyBkaXJlY3QgbWFwIGluc3RlYWQgb2YgdGhlIG1hcGNhY2hlIGlu
IG1hcF9kb21haW5fcGFnZSwKPiBvbGQgaXMgdGhlIGV4aXN0aW5nIG1hcGNhY2hlIGFuZCBuZXcg
aXMgYWZ0ZXIgdGhpcyBwYXRjaCk6Cj4gCj4gR2Vla2JlbmNoIG9uIGEgMzItdkNQVSBndWVzdCwK
PiAKPiBwZXJmb3JtYW5jZSBkcm9wICAgICBvbGQgICAgICAgIG5ldwo+IHNpbmdsZSBjb3JlICAg
ICAgICAgMC4wNCUgICAgICAwLjE4JQoKRG8geW91IGtub3cgd2h5IHRoZSBuZXcgbWFwY2FjaGUg
aGFzIG1vcmUgb3ZlcmhlYWQgdGhhbiB0aGUgb2xkIG9uZSBpbgp0aGUgc2luZ2xlIGNvcmUgY2Fz
ZT8KCj4gbXVsdGkgY29yZSAgICAgICAgICAyLjQzJSAgICAgIDAuMDglCj4gCj4gZmlvIG9uIGEg
MzItdkNQVSBndWVzdCwgTFZNIGF0b3AgOCpTU0QsCj4gCj4gcGVyZm9ybWFuY2UgZHJvcCAgICAg
b2xkICAgICAgICBuZXcKPiAgICAgICAgICAgICAgICAgICAgIDMuMDUlICAgICAgMC4yOCUKPiAK
PiBUaGVyZSBzaG91bGQgYmUgcm9vbSBmb3IgZnV0aGVyIG9wdGltaXNhdGlvbnMsIGJ1dCB0aGlz
IGFscmVhZHkKPiBpbXByb3ZlcyBvdmVyIHRoZSBvbGQgbWFwY2FjaGUgYnkgYSBsb3QuCj4gCj4g
SW4gdGhlIG5ldyBjYWNoZSBkZXNpZ24sIG1hcGhhc2ggZW50cmllcyB0aGVtc2VsdmVzIGFsc28g
b2NjdXB5IGludXNlCj4gc2xvdHMuIFRoZSBleGlzdGluZyBjb25maWd1cmF0aW9uIG9mIDE2IHNs
b3RzIGZvciBlYWNoIHZjcHUgaXMgbm8gbG9uZ2VyCj4gc3VmZmljaWVudCB0byBpbmNsdWRlIGJv
dGggdGhlIG1hcGhhc2ggYW5kIGEgbmVzdGVkIHBhZ2UgdGFibGUgd2Fsay4KPiBGb3J0dW5hdGVs
eSwgdGhlIHBlci1kb21haW4gaW51c2UgYW5kIGdhcmJhZ2UgYml0IHZlY3RvcnMgYXJlIHJlbW92
ZWQKPiBmcm9tIHRoZSBQRVJET01BSU4gcmVnaW9uLCBnaXZpbmcgdXMgZW5vdWdoIHJvb20gdG8g
ZXhwYW5kIHRoZSBhdmFpbGFibGUKPiBtYXBwaW5nIHNsb3RzLgo+IAo+IFNpZ25lZC1vZmYtYnk6
IEhvbmd5YW4gWGlhIDxob25neXhpYUBhbWF6b24uY29tPgoKWy4uLl0KCj4gIHZvaWQgdW5tYXBf
ZG9tYWluX3BhZ2UoY29uc3Qgdm9pZCAqcHRyKQo+ICB7Cj4gLSAgICB1bnNpZ25lZCBpbnQgaWR4
Owo+ICsgICAgdW5zaWduZWQgaW50IGlkeCwgZ2xiX2lkeDsKPiAgICAgIHN0cnVjdCB2Y3B1ICp2
Owo+IC0gICAgc3RydWN0IG1hcGNhY2hlX2RvbWFpbiAqZGNhY2hlOwo+IC0gICAgdW5zaWduZWQg
bG9uZyB2YSA9ICh1bnNpZ25lZCBsb25nKXB0ciwgbWZuLCBmbGFnczsKPiAtICAgIHN0cnVjdCB2
Y3B1X21hcGhhc2hfZW50cnkgKmhhc2hlbnQ7Cj4gKyAgICBzdHJ1Y3QgbWFwY2FjaGVfdmNwdSAq
dmNhY2hlOwo+ICsgICAgdW5zaWduZWQgbG9uZyB2YSA9ICh1bnNpZ25lZCBsb25nKXB0ciwgbWZu
LCBoYXNobWZuLCBmbGFnczsKPiAgCj4gICAgICBpZiAoIHZhID49IERJUkVDVE1BUF9WSVJUX1NU
QVJUICkKPiAgICAgICAgICByZXR1cm47Cj4gQEAgLTE4OSwxMTQgKzE0NCw3OCBAQCB2b2lkIHVu
bWFwX2RvbWFpbl9wYWdlKGNvbnN0IHZvaWQgKnB0cikKPiAgICAgIHYgPSBtYXBjYWNoZV9jdXJy
ZW50X3ZjcHUoKTsKPiAgICAgIEFTU0VSVCh2ICYmIGlzX3B2X3ZjcHUodikpOwo+ICAKPiAtICAg
IGRjYWNoZSA9ICZ2LT5kb21haW4tPmFyY2gucHYubWFwY2FjaGU7Cj4gLSAgICBBU1NFUlQoZGNh
Y2hlLT5pbnVzZSk7Cj4gKyAgICB2Y2FjaGUgPSB2LT5hcmNoLnB2Lm1hcGNhY2hlOwo+ICsgICAg
QVNTRVJUKHZjYWNoZSk7Cj4gIAo+IC0gICAgaWR4ID0gUEZOX0RPV04odmEgLSBNQVBDQUNIRV9W
SVJUX1NUQVJUKTsKPiAtICAgIG1mbiA9IGwxZV9nZXRfcGZuKE1BUENBQ0hFX0wxRU5UKGlkeCkp
Owo+IC0gICAgaGFzaGVudCA9ICZ2LT5hcmNoLnB2Lm1hcGNhY2hlLmhhc2hbTUFQSEFTSF9IQVNI
Rk4obWZuKV07CgpQbGVhc2UgYWxzbyBhc3NlcnQgdGhlIHZhIGluIHF1ZXN0aW9uIGlzIHdpdGhp
biB0aGUgcmFuZ2UgYWxsb2NhdGVkIHRvCnRoaXMgdmNwdS4KCj4gKyAgICBnbGJfaWR4ID0gUEZO
X0RPV04odmEgLSBNQVBDQUNIRV9WSVJUX1NUQVJUKTsKPiArICAgIGlkeCA9IGdsYl9pZHggLSB2
LT52Y3B1X2lkICogTUFQQ0FDSEVfVkNQVV9FTlRSSUVTOwo+ICAKPiAgICAgIGxvY2FsX2lycV9z
YXZlKGZsYWdzKTsKPiAgCj4gLSAgICBpZiAoIGhhc2hlbnQtPmlkeCA9PSBpZHggKQo+IC0gICAg
ewo+IC0gICAgICAgIEFTU0VSVChoYXNoZW50LT5tZm4gPT0gbWZuKTsKPiAtICAgICAgICBBU1NF
UlQoaGFzaGVudC0+cmVmY250KTsKPiAtICAgICAgICBoYXNoZW50LT5yZWZjbnQtLTsKPiAtICAg
IH0KPiAtICAgIGVsc2UgaWYgKCAhaGFzaGVudC0+cmVmY250ICkKPiAtICAgIHsKPiAtICAgICAg
ICBpZiAoIGhhc2hlbnQtPmlkeCAhPSBNQVBIQVNIRU5UX05PVElOVVNFICkKPiAtICAgICAgICB7
Cj4gLSAgICAgICAgICAgIC8qIC9GaXJzdC8sIHphcCB0aGUgUFRFLiAqLwo+IC0gICAgICAgICAg
ICBBU1NFUlQobDFlX2dldF9wZm4oTUFQQ0FDSEVfTDFFTlQoaGFzaGVudC0+aWR4KSkgPT0KPiAt
ICAgICAgICAgICAgICAgICAgIGhhc2hlbnQtPm1mbik7Cj4gLSAgICAgICAgICAgIGwxZV93cml0
ZSgmTUFQQ0FDSEVfTDFFTlQoaGFzaGVudC0+aWR4KSwgbDFlX2VtcHR5KCkpOwo+IC0gICAgICAg
ICAgICAvKiAvU2Vjb25kLywgbWFyayBhcyBnYXJiYWdlLiAqLwo+IC0gICAgICAgICAgICBzZXRf
Yml0KGhhc2hlbnQtPmlkeCwgZGNhY2hlLT5nYXJiYWdlKTsKPiAtICAgICAgICB9Cj4gLQo+IC0g
ICAgICAgIC8qIEFkZCBuZXdseS1mcmVlZCBtYXBwaW5nIHRvIHRoZSBtYXBoYXNoLiAqLwo+IC0g
ICAgICAgIGhhc2hlbnQtPm1mbiA9IG1mbjsKPiAtICAgICAgICBoYXNoZW50LT5pZHggPSBpZHg7
Cj4gLSAgICB9Cj4gLSAgICBlbHNlCj4gLSAgICB7Cj4gLSAgICAgICAgLyogL0ZpcnN0LywgemFw
IHRoZSBQVEUuICovCj4gLSAgICAgICAgbDFlX3dyaXRlKCZNQVBDQUNIRV9MMUVOVChpZHgpLCBs
MWVfZW1wdHkoKSk7Cj4gLSAgICAgICAgLyogL1NlY29uZC8sIG1hcmsgYXMgZ2FyYmFnZS4gKi8K
PiAtICAgICAgICBzZXRfYml0KGlkeCwgZGNhY2hlLT5nYXJiYWdlKTsKPiAtICAgIH0KPiArICAg
IG1mbiA9IGwxZV9nZXRfcGZuKE1BUENBQ0hFX0wxRU5UKGdsYl9pZHgpKTsKPiArICAgIGhhc2ht
Zm4gPSB2Y2FjaGUtPmhhc2hfbWZuW01BUEhBU0hfSEFTSEZOKG1mbildOwo+ICsKPiArICAgIHZj
YWNoZS0+cmVmY250W2lkeF0tLTsKPiArICAgIC8qIElmIHJlZmNudCBkcm9wcyB0byAwLCB3ZSBv
bmx5IGNsZWFyIGludXNlIHdoZW4gaXQncyBub3QgaW4gdGhlIG1hcGhhc2guICovCgpJdCB3b3Vs
ZCBiZSBjbGVhcmVyIHRvICJ3aGVuIGl0IGhhcyBiZWVuIGV2aWN0ZWQgZnJvbSBtYXBoYXNoIiB0
byBtYXRjaAp0aGUgdGVybWlub2xvZ3kgaW4gdGhlIG1hcCByb3V0aW5lLgoKPiArICAgIGlmICgg
aGFzaG1mbiAhPSBtZm4gJiYgIXZjYWNoZS0+cmVmY250W2lkeF0gKQo+ICsgICAgICAgIF9fY2xl
YXJfYml0KGlkeCwgdmNhY2hlLT5pbnVzZSk7CgpBbHNvLCBwbGVhc2UgZmx1c2ggdGhlIGxpbmVh
ciBhZGRyZXNzIGhlcmUgYW5kIHRoZSBvdGhlciBfX2NsZWFyX2JpdApsb2NhdGlvbi4KCgo+ICAK
PiAgICAgIGxvY2FsX2lycV9yZXN0b3JlKGZsYWdzKTsKPiAgfQo+ICAKPiAtaW50IG1hcGNhY2hl
X2RvbWFpbl9pbml0KHN0cnVjdCBkb21haW4gKmQpCj4gK2ludCBtYXBjYWNoZV92Y3B1X2luaXQo
c3RydWN0IHZjcHUgKnYpCj4gIHsKPiArICAgIHN0cnVjdCBkb21haW4gKmQgPSB2LT5kb21haW47
Cj4gICAgICBzdHJ1Y3QgbWFwY2FjaGVfZG9tYWluICpkY2FjaGUgPSAmZC0+YXJjaC5wdi5tYXBj
YWNoZTsKPiAtICAgIHVuc2lnbmVkIGludCBiaXRtYXBfcGFnZXM7Cj4gLQo+IC0gICAgQVNTRVJU
KGlzX3B2X2RvbWFpbihkKSk7Cj4gKyAgICB1bnNpZ25lZCBsb25nIGk7CgpTaW5jZSB5b3UncmUg
Y2hhbmdpbmcgdGhpcyBhbnl3YXkgLS0gd2Ugbm9ybWFsbHkgdXNlIHVuc2lnbmVkIGludCBhcwpp
bmRleCB0eXBlLgoKPiArICAgIHVuc2lnbmVkIGludCBlbnRzID0gZC0+bWF4X3ZjcHVzICogTUFQ
Q0FDSEVfVkNQVV9FTlRSSUVTOwo+ICAKPiAgI2lmZGVmIE5ERUJVRwo+ICAgICAgaWYgKCAhbWVt
X2hvdHBsdWcgJiYgbWF4X3BhZ2UgPD0gUEZOX0RPV04oX19wYShIWVBFUlZJU09SX1ZJUlRfRU5E
IC0gMSkpICkKPiAgICAgICAgICByZXR1cm4gMDsKPiAgI2VuZGlmCj4gIAo+IC0gICAgQlVJTERf
QlVHX09OKE1BUENBQ0hFX1ZJUlRfRU5EICsgUEFHRV9TSVpFICogKDMgKwo+IC0gICAgICAgICAg
ICAgICAgIDIgKiBQRk5fVVAoQklUU19UT19MT05HUyhNQVBDQUNIRV9FTlRSSUVTKSAqIHNpemVv
Zihsb25nKSkpID4KPiAtICAgICAgICAgICAgICAgICBNQVBDQUNIRV9WSVJUX1NUQVJUICsgKFBF
UkRPTUFJTl9TTE9UX01CWVRFUyA8PCAyMCkpOwo+IC0gICAgYml0bWFwX3BhZ2VzID0gUEZOX1VQ
KEJJVFNfVE9fTE9OR1MoTUFQQ0FDSEVfRU5UUklFUykgKiBzaXplb2YobG9uZykpOwo+IC0gICAg
ZGNhY2hlLT5pbnVzZSA9ICh2b2lkICopTUFQQ0FDSEVfVklSVF9FTkQgKyBQQUdFX1NJWkU7Cj4g
LSAgICBkY2FjaGUtPmdhcmJhZ2UgPSBkY2FjaGUtPmludXNlICsKPiAtICAgICAgICAgICAgICAg
ICAgICAgIChiaXRtYXBfcGFnZXMgKyAxKSAqIFBBR0VfU0laRSAvIHNpemVvZihsb25nKTsKPiAt
Cj4gLSAgICBzcGluX2xvY2tfaW5pdCgmZGNhY2hlLT5sb2NrKTsKPiAtCj4gLSAgICByZXR1cm4g
Y3JlYXRlX3BlcmRvbWFpbl9tYXBwaW5nKGQsICh1bnNpZ25lZCBsb25nKWRjYWNoZS0+aW51c2Us
Cj4gLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDIgKiBiaXRtYXBfcGFnZXMg
KyAxLAo+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOSUwobDFfcGdlbnRy
eV90ICopLCBOVUxMKTsKPiAtfQo+IC0KPiAtaW50IG1hcGNhY2hlX3ZjcHVfaW5pdChzdHJ1Y3Qg
dmNwdSAqdikKPiAtewo+IC0gICAgc3RydWN0IGRvbWFpbiAqZCA9IHYtPmRvbWFpbjsKPiAtICAg
IHN0cnVjdCBtYXBjYWNoZV9kb21haW4gKmRjYWNoZSA9ICZkLT5hcmNoLnB2Lm1hcGNhY2hlOwo+
IC0gICAgdW5zaWduZWQgbG9uZyBpOwo+IC0gICAgdW5zaWduZWQgaW50IGVudHMgPSBkLT5tYXhf
dmNwdXMgKiBNQVBDQUNIRV9WQ1BVX0VOVFJJRVM7Cj4gLSAgICB1bnNpZ25lZCBpbnQgbnIgPSBQ
Rk5fVVAoQklUU19UT19MT05HUyhlbnRzKSAqIHNpemVvZihsb25nKSk7Cj4gLQo+IC0gICAgaWYg
KCAhaXNfcHZfdmNwdSh2KSB8fCAhZGNhY2hlLT5pbnVzZSApCj4gKyAgICBpZiAoIGlzX2lkbGVf
dmNwdSh2KSB8fCBpc19odm1fdmNwdSh2KSApCj4gICAgICAgICAgcmV0dXJuIDA7Cj4gIAo+ICsg
ICAgQlVJTERfQlVHX09OKE1BUENBQ0hFX1ZJUlRfRU5EID4gQVJHX1hMQVRfVklSVF9TVEFSVCk7
Cj4gKwo+ICAgICAgaWYgKCBlbnRzID4gZGNhY2hlLT5lbnRyaWVzICkKPiAgICAgIHsKPiArICAg
ICAgICBpbnQgcmM7Cj4gKwo+ICsgICAgICAgIEFTU0VSVChlbnRzICogUEFHRV9TSVpFIDw9IChQ
RVJET01BSU5fU0xPVF9NQllURVMgPDwgMjApKTsKPiArCj4gICAgICAgICAgLyogUG9wdWxhdGUg
cGFnZSB0YWJsZXMuICovCj4gLSAgICAgICAgaW50IHJjID0gY3JlYXRlX3BlcmRvbWFpbl9tYXBw
aW5nKGQsIE1BUENBQ0hFX1ZJUlRfU1RBUlQsIGVudHMsCj4gKyAgICAgICAgcmMgPSBjcmVhdGVf
cGVyZG9tYWluX21hcHBpbmcoZCwgTUFQQ0FDSEVfVklSVF9TVEFSVCwgZW50cywKPiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTklMKGwxX3BnZW50cnlfdCAqKSwg
TlVMTCk7Cj4gIAo+IC0gICAgICAgIC8qIFBvcHVsYXRlIGJpdCBtYXBzLiAqLwo+IC0gICAgICAg
IGlmICggIXJjICkKPiAtICAgICAgICAgICAgcmMgPSBjcmVhdGVfcGVyZG9tYWluX21hcHBpbmco
ZCwgKHVuc2lnbmVkIGxvbmcpZGNhY2hlLT5pbnVzZSwKPiAtICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgbnIsIE5VTEwsIE5JTChzdHJ1Y3QgcGFnZV9pbmZvICopKTsK
PiAtICAgICAgICBpZiAoICFyYyApCj4gLSAgICAgICAgICAgIHJjID0gY3JlYXRlX3BlcmRvbWFp
bl9tYXBwaW5nKGQsICh1bnNpZ25lZCBsb25nKWRjYWNoZS0+Z2FyYmFnZSwKPiAtICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnIsIE5VTEwsIE5JTChzdHJ1Y3QgcGFn
ZV9pbmZvICopKTsKPiAtCj4gICAgICAgICAgaWYgKCByYyApCj4gICAgICAgICAgICAgIHJldHVy
biByYzsKPiAgCj4gICAgICAgICAgZGNhY2hlLT5lbnRyaWVzID0gZW50czsKCkdpdmVuIHRoYXQ6
CgoxLiBtYXBjYWNoZV9kb21haW4gaXMgbm93IGEgc3RydWN0dXJlIHdpdGggb25seSBvbmUgbWVt
YmVyLgoyLiBlbnRzIGlzIGEgY29uc3RhbnQgdGhyb3VnaG91dCBkb21haW4ncyBsaWZlY3ljbGUu
CgpZb3UgY2FuIHJlcGxhY2UgbWFwY2FjaGVfZG9tYWluIHdpdGggYSBib29sZWFuIC0tCm1hcGNh
Y2hlX21hcHBpbmdfcG9wdWxhdGVkICg/KSBpbiBhcmNoLnB2LgoKSWYgSSdtIG5vdCBtaXN0YWtl
biwgdGhlIHNpemUgb2YgdGhlIG1hcHBpbmcgaXMgZGVyaXZlZCBmcm9tIHRoZSB2Y3B1CmJlaW5n
IGluaXRpYWxpc2VkLCBzbyBhIGZ1cnRoZXIgaW1wcm92ZW1lbnQgaXMgdG8gbGlmdCB0aGUgbWFw
cGluZwpjcmVhdGlvbiBvdXQgb2YgbWFwY2FjaGVfdmNwdV9pbml0LgoKPiAgICAgIH0KPiAgCj4g
LSAgICAvKiBNYXJrIGFsbCBtYXBoYXNoIGVudHJpZXMgYXMgbm90IGluIHVzZS4gKi8KPiAgICAg
IEJVSUxEX0JVR19PTihNQVBIQVNIRU5UX05PVElOVVNFIDwgTUFQQ0FDSEVfRU5UUklFUyk7Cj4g
KyAgICAvKiBNQVBIQVNIX0VOVFJJRVMgaGFzIHRvIGJlIHBvd2VyLW9mLXR3byB0byBtYWtlIGhh
c2hpbmcgd29yay4gKi8KPiArICAgIEJVSUxEX0JVR19PTihNQVBIQVNIX0VOVFJJRVMgJiAoTUFQ
SEFTSF9FTlRSSUVTIC0gMSkpOwo+ICsgICAgLyoKPiArICAgICAqIFNpbmNlIGVudHJpZXMgaW4g
dGhlIG1hcGhhc2ggYWxzbyBvY2N1cHkgaW51c2Ugc2xvdHMsIHdlIGhhdmUgdG8gbWFrZQo+ICsg
ICAgICogc3VyZSBNQVBDQUNIRV9WQ1BVX0VOVFJJRVMgaXMgbGFyZ2UgZW5vdWdoIHRvIGFjY29t
bW9kYXRlIGJvdGggdGhlCj4gKyAgICAgKiBtYXBoYXNoIGFuZCBhIG5lc3RlZCBwYWdlIHRhYmxl
IHdhbGsuCj4gKyAgICAgKi8KPiArICAgIEJVSUxEX0JVR19PTihNQVBDQUNIRV9WQ1BVX0VOVFJJ
RVMgLSBNQVBIQVNIX0VOVFJJRVMgPAo+ICsgICAgICAgICAgICAgICAgIENPTkZJR19QQUdJTkdf
TEVWRUxTICogQ09ORklHX1BBR0lOR19MRVZFTFMpOwo+ICsKPiArICAgIHYtPmFyY2gucHYubWFw
Y2FjaGUgPSB4emFsbG9jKHN0cnVjdCBtYXBjYWNoZV92Y3B1KTsKPiArICAgIGlmICggIXYtPmFy
Y2gucHYubWFwY2FjaGUgKQo+ICsgICAgICAgIHJldHVybiAtRU5PTUVNOwo+ICsKPiArICAgIC8q
IE1hcmsgYWxsIG1hcGhhc2ggZW50cmllcyBhcyBub3QgaW4gdXNlLiAqLwo+ICAgICAgZm9yICgg
aSA9IDA7IGkgPCBNQVBIQVNIX0VOVFJJRVM7IGkrKyApCj4gICAgICB7Cj4gLSAgICAgICAgc3Ry
dWN0IHZjcHVfbWFwaGFzaF9lbnRyeSAqaGFzaGVudCA9ICZ2LT5hcmNoLnB2Lm1hcGNhY2hlLmhh
c2hbaV07Cj4gLQo+IC0gICAgICAgIGhhc2hlbnQtPm1mbiA9IH4wVUw7IC8qIG5ldmVyIHZhbGlk
IHRvIG1hcCAqLwo+IC0gICAgICAgIGhhc2hlbnQtPmlkeCA9IE1BUEhBU0hFTlRfTk9USU5VU0U7
Cj4gKyAgICAgICAgdi0+YXJjaC5wdi5tYXBjYWNoZS0+aGFzaF9tZm5baV0gPSB+MFVMOwoKbWZu
X3goSU5WQUxJRF9NRk4pIGhlcmUuCgpPciB5b3UgY2FuIGNoYW5nZSB0aGUgdHlwZSBvZiB0aGUg
YXJyYXkgdG8gbWZuX3QuIEl0IHdvbid0IGVubGFyZ2UgaXRzCnNpemUuCgpXZWkuCgpfX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGlu
ZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnBy
b2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

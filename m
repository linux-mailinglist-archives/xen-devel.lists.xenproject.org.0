Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 58432100A0A
	for <lists+xen-devel@lfdr.de>; Mon, 18 Nov 2019 18:16:10 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iWkaa-00061A-Mf; Mon, 18 Nov 2019 17:13:24 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=vqm6=ZK=citrix.com=anthony.perard@srs-us1.protection.inumbo.net>)
 id 1iWkaZ-00060b-DQ
 for xen-devel@lists.xenproject.org; Mon, 18 Nov 2019 17:13:23 +0000
X-Inumbo-ID: b2e67e50-0a26-11ea-a2db-12813bfff9fa
Received: from esa4.hc3370-68.iphmx.com (unknown [216.71.155.144])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id b2e67e50-0a26-11ea-a2db-12813bfff9fa;
 Mon, 18 Nov 2019 17:13:12 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1574097192;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=aboUeJtbqj5tTk0rMmKX3R9Hcu6rZaOm0x/Cw+jDfLc=;
 b=E+6B1qlQDqwmf8JtIUQS0cocCqEBZCEyg2GHwf77/zz6u3o2tRXK7dDH
 fQMFY6Fwy5qf3ve3TXuJUsRPz8KruB7SVDylmmVHy/mc+lVIU4Fp0BVnA
 kieKS7rQpXtDTMX7jQdn3/j09rKVkXmSY4eLLaBqLi+PnYsUpeCsNhIfE 8=;
Authentication-Results: esa4.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=anthony.perard@citrix.com;
 spf=Pass smtp.mailfrom=anthony.perard@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa4.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 anthony.perard@citrix.com) identity=pra;
 client-ip=162.221.158.21; receiver=esa4.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="anthony.perard@citrix.com";
 x-conformance=sidf_compatible
Received-SPF: Pass (esa4.hc3370-68.iphmx.com: domain of
 anthony.perard@citrix.com designates 162.221.158.21 as
 permitted sender) identity=mailfrom;
 client-ip=162.221.158.21; receiver=esa4.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="anthony.perard@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83
 ip4:168.245.78.127 ~all"
Received-SPF: None (esa4.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa4.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: JkmYOMSzugpAQHdXqbCyLeZmfu24cUs47Re0UQ3BniUTmRggexWZgXebknd57mAXk6z6FeMw/F
 WQl3X/EZMTHKz17WacDWkqzckoOmHWExxC9+andNSt94ukEUF+1SAOHDIFUdZPyKnXKRGd3pi1
 P83HSHu+5Q6ppeIGu/+1S+AoGViLO028Kx1YAacWuYHsZhy+ngpzHeTB2D7XUKlDYuheGIwtxq
 SsbYRQB92UoEAo0SzFJvQ4UZ9G+e+q++u/5TJmpJZpFQT4HXzCMkvQ9VOgWgTRtyVx3AQ1fcW4
 5zw=
X-SBRS: 2.7
X-MesageID: 9014073
X-Ironport-Server: esa4.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.68,320,1569297600"; 
   d="scan'208";a="9014073"
From: Anthony PERARD <anthony.perard@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Mon, 18 Nov 2019 17:13:06 +0000
Message-ID: <20191118171309.1459302-6-anthony.perard@citrix.com>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191118171309.1459302-1-anthony.perard@citrix.com>
References: <20191118171309.1459302-1-anthony.perard@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [XEN PATCH for-4.13 v3 5/7] libxl: libxl__ev_qmp_send
 now takes an egc
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Anthony PERARD <anthony.perard@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Wei Liu <wl@xen.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

Tm8gZnVuY3Rpb25uYWwgY2hhbmdlcy4KClNpZ25lZC1vZmYtYnk6IEFudGhvbnkgUEVSQVJEIDxh
bnRob255LnBlcmFyZEBjaXRyaXguY29tPgpBY2tlZC1ieTogSWFuIEphY2tzb24gPGlhbi5qYWNr
c29uQGV1LmNpdHJpeC5jb20+Ci0tLQogdG9vbHMvbGlieGwvbGlieGxfZGlzay5jICAgICAgICB8
ICA2ICsrKy0tLQogdG9vbHMvbGlieGwvbGlieGxfZG0uYyAgICAgICAgICB8ICA4ICsrKystLS0t
CiB0b29scy9saWJ4bC9saWJ4bF9kb21fc2F2ZS5jICAgIHwgIDIgKy0KIHRvb2xzL2xpYnhsL2xp
YnhsX2RvbV9zdXNwZW5kLmMgfCAgMiArLQogdG9vbHMvbGlieGwvbGlieGxfZG9tYWluLmMgICAg
ICB8ICA4ICsrKystLS0tCiB0b29scy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5oICAgIHwgIDIgKy0K
IHRvb2xzL2xpYnhsL2xpYnhsX3BjaS5jICAgICAgICAgfCAgOCArKysrLS0tLQogdG9vbHMvbGli
eGwvbGlieGxfcW1wLmMgICAgICAgICB8IDEwICsrKysrLS0tLS0KIHRvb2xzL2xpYnhsL2xpYnhs
X3VzYi5jICAgICAgICAgfCAyOCArKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tCiA5IGZpbGVz
IGNoYW5nZWQsIDM5IGluc2VydGlvbnMoKyksIDM1IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBh
L3Rvb2xzL2xpYnhsL2xpYnhsX2Rpc2suYyBiL3Rvb2xzL2xpYnhsL2xpYnhsX2Rpc2suYwppbmRl
eCA3N2FlM2E1OWJmYjYuLjY0YTY2OTE0MjQwYSAxMDA2NDQKLS0tIGEvdG9vbHMvbGlieGwvbGli
eGxfZGlzay5jCisrKyBiL3Rvb2xzL2xpYnhsL2xpYnhsX2Rpc2suYwpAQCAtNzc2LDcgKzc3Niw3
IEBAIHN0YXRpYyB2b2lkIGNkcm9tX2luc2VydF9sb2NrX2FjcXVpcmVkKGxpYnhsX19lZ2MgKmVn
YywKIAogICAgICAgICBRTVBfUEFSQU1FVEVSU19TUFJJTlRGKCZhcmdzLCAiZGV2aWNlIiwgImlk
ZS0laSIsIGRldmlkKTsKICAgICAgICAgY2lzLT5xbXAuY2FsbGJhY2sgPSBjZHJvbV9pbnNlcnRf
ZWplY3RlZDsKLSAgICAgICAgcmMgPSBsaWJ4bF9fZXZfcW1wX3NlbmQoZ2MsICZjaXMtPnFtcCwg
ImVqZWN0IiwgYXJncyk7CisgICAgICAgIHJjID0gbGlieGxfX2V2X3FtcF9zZW5kKGVnYywgJmNp
cy0+cW1wLCAiZWplY3QiLCBhcmdzKTsKICAgICAgICAgaWYgKHJjKSBnb3RvIG91dDsKICAgICB9
IGVsc2UgewogICAgICAgICBjZHJvbV9pbnNlcnRfZWplY3RlZChlZ2MsICZjaXMtPnFtcCwgTlVM
TCwgMCk7IC8qIG11c3QgYmUgbGFzdCAqLwpAQCAtODg0LDcgKzg4NCw3IEBAIHN0YXRpYyB2b2lk
IGNkcm9tX2luc2VydF9lamVjdGVkKGxpYnhsX19lZ2MgKmVnYywKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBsaWJ4bF9kaXNrX2Zvcm1hdF90b19zdHJpbmcoZGlzay0+Zm9ybWF0KSwK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNrLT5wZGV2X3BhdGgpOwogICAgICAg
ICBxbXAtPmNhbGxiYWNrID0gY2Ryb21faW5zZXJ0X2FkZGZkX2NiOwotICAgICAgICByYyA9IGxp
YnhsX19ldl9xbXBfc2VuZChnYywgcW1wLCAiYWRkLWZkIiwgYXJncyk7CisgICAgICAgIHJjID0g
bGlieGxfX2V2X3FtcF9zZW5kKGVnYywgcW1wLCAiYWRkLWZkIiwgYXJncyk7CiAgICAgICAgIGlm
IChyYykgZ290byBvdXQ7CiAgICAgICAgIGhhc19jYWxsYmFjayA9IHRydWU7CiAgICAgfSBlbHNl
IHsKQEAgLTkzOCw3ICs5MzgsNyBAQCBzdGF0aWMgdm9pZCBjZHJvbV9pbnNlcnRfYWRkZmRfY2Io
bGlieGxfX2VnYyAqZWdjLAogICAgIGxpYnhsX19xbXBfcGFyYW1fYWRkX3N0cmluZyhnYywgJmFy
Z3MsICJhcmciLAogICAgICAgICBsaWJ4bF9fcWVtdV9kaXNrX2Zvcm1hdF9zdHJpbmcoZGlzay0+
Zm9ybWF0KSk7CiAgICAgcW1wLT5jYWxsYmFjayA9IGNkcm9tX2luc2VydF9pbnNlcnRlZDsKLSAg
ICByYyA9IGxpYnhsX19ldl9xbXBfc2VuZChnYywgcW1wLCAiY2hhbmdlIiwgYXJncyk7CisgICAg
cmMgPSBsaWJ4bF9fZXZfcW1wX3NlbmQoZWdjLCBxbXAsICJjaGFuZ2UiLCBhcmdzKTsKIG91dDoK
ICAgICBpZiAocmMpCiAgICAgICAgIGNkcm9tX2luc2VydF9kb25lKGVnYywgY2lzLCByYyk7IC8q
IG11c3QgYmUgbGFzdCAqLwpkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGlieGxfZG0uYyBiL3Rv
b2xzL2xpYnhsL2xpYnhsX2RtLmMKaW5kZXggOGUwZmI3OGJkMmYzLi5kYWMxYjhkZGI4OGEgMTAw
NjQ0Ci0tLSBhL3Rvb2xzL2xpYnhsL2xpYnhsX2RtLmMKKysrIGIvdG9vbHMvbGlieGwvbGlieGxf
ZG0uYwpAQCAtMjY0OSw3ICsyNjQ5LDcgQEAgdm9pZCBsaWJ4bF9fc3Bhd25fbG9jYWxfZG0obGli
eGxfX2VnYyAqZWdjLCBsaWJ4bF9fZG1fc3Bhd25fc3RhdGUgKmRtc3MpCiAgICAgICAgIGRtc3Mt
PnFtcC5jYWxsYmFjayA9IGRldmljZV9tb2RlbF9xbXBfY2I7CiAgICAgICAgIGRtc3MtPnFtcC5k
b21pZCA9IGRvbWlkOwogICAgICAgICBkbXNzLT5xbXAucGF5bG9hZF9mZCA9IC0xOwotICAgICAg
ICByYyA9IGxpYnhsX19ldl9xbXBfc2VuZChnYywgJmRtc3MtPnFtcCwgInF1ZXJ5LXN0YXR1cyIs
IE5VTEwpOworICAgICAgICByYyA9IGxpYnhsX19ldl9xbXBfc2VuZChlZ2MsICZkbXNzLT5xbXAs
ICJxdWVyeS1zdGF0dXMiLCBOVUxMKTsKICAgICAgICAgaWYgKHJjKSBnb3RvIG91dF9jbG9zZTsK
ICAgICB9CiAKQEAgLTI4MDcsNyArMjgwNyw3IEBAIHN0YXRpYyB2b2lkIGRldmljZV9tb2RlbF9z
cGF3bl9vdXRjb21lKGxpYnhsX19lZ2MgKmVnYywKICAgICAgICAgZG1zcy0+cW1wLmRvbWlkID0g
ZG1zcy0+Z3Vlc3RfZG9taWQ7CiAgICAgICAgIGRtc3MtPnFtcC5wYXlsb2FkX2ZkID0gLTE7CiAg
ICAgICAgIGRtc3MtPnFtcC5jYWxsYmFjayA9IGRldmljZV9tb2RlbF9wb3N0Y29uZmlnX2NoYXJk
ZXY7Ci0gICAgICAgIHJjID0gbGlieGxfX2V2X3FtcF9zZW5kKGdjLCAmZG1zcy0+cW1wLCAicXVl
cnktY2hhcmRldiIsIE5VTEwpOworICAgICAgICByYyA9IGxpYnhsX19ldl9xbXBfc2VuZChlZ2Ms
ICZkbXNzLT5xbXAsICJxdWVyeS1jaGFyZGV2IiwgTlVMTCk7CiAgICAgICAgIGlmIChyYykgZ290
byBvdXQ7CiAgICAgICAgIHJldHVybjsKICAgICB9CkBAIC0yODc5LDcgKzI4NzksNyBAQCBzdGF0
aWMgdm9pZCBkZXZpY2VfbW9kZWxfcG9zdGNvbmZpZ19jaGFyZGV2KGxpYnhsX19lZ2MgKmVnYywK
ICAgICB9CiAKICAgICBxbXAtPmNhbGxiYWNrID0gZGV2aWNlX21vZGVsX3Bvc3Rjb25maWdfdm5j
OwotICAgIHJjID0gbGlieGxfX2V2X3FtcF9zZW5kKGdjLCBxbXAsICJxdWVyeS12bmMiLCBOVUxM
KTsKKyAgICByYyA9IGxpYnhsX19ldl9xbXBfc2VuZChlZ2MsIHFtcCwgInF1ZXJ5LXZuYyIsIE5V
TEwpOwogICAgIGlmIChyYykgZ290byBvdXQ7CiAgICAgcmV0dXJuOwogCkBAIC0yOTM5LDcgKzI5
MzksNyBAQCBzdGF0aWMgdm9pZCBkZXZpY2VfbW9kZWxfcG9zdGNvbmZpZ192bmMobGlieGxfX2Vn
YyAqZWdjLAogICAgIGlmICh2bmMgJiYgdm5jLT5wYXNzd2QgJiYgdm5jLT5wYXNzd2RbMF0pIHsK
ICAgICAgICAgcW1wLT5jYWxsYmFjayA9IGRldmljZV9tb2RlbF9wb3N0Y29uZmlnX3ZuY19wYXNz
d2Q7CiAgICAgICAgIGxpYnhsX19xbXBfcGFyYW1fYWRkX3N0cmluZyhnYywgJmFyZ3MsICJwYXNz
d29yZCIsIHZuYy0+cGFzc3dkKTsKLSAgICAgICAgcmMgPSBsaWJ4bF9fZXZfcW1wX3NlbmQoZ2Ms
IHFtcCwgImNoYW5nZS12bmMtcGFzc3dvcmQiLCBhcmdzKTsKKyAgICAgICAgcmMgPSBsaWJ4bF9f
ZXZfcW1wX3NlbmQoZWdjLCBxbXAsICJjaGFuZ2Utdm5jLXBhc3N3b3JkIiwgYXJncyk7CiAgICAg
ICAgIGlmIChyYykgZ290byBvdXQ7CiAgICAgICAgIHJldHVybjsKICAgICB9CmRpZmYgLS1naXQg
YS90b29scy9saWJ4bC9saWJ4bF9kb21fc2F2ZS5jIGIvdG9vbHMvbGlieGwvbGlieGxfZG9tX3Nh
dmUuYwppbmRleCBlNzBhYTE1ODU5NzYuLjY1NjEwZTYwNTVhNyAxMDA2NDQKLS0tIGEvdG9vbHMv
bGlieGwvbGlieGxfZG9tX3NhdmUuYworKysgYi90b29scy9saWJ4bC9saWJ4bF9kb21fc2F2ZS5j
CkBAIC0yMjYsNyArMjI2LDcgQEAgc3RhdGljIHZvaWQgZG9tYWluX3N1c3BlbmRfc3dpdGNoX3Fl
bXVfeGVuX2xvZ2RpcnR5CiAgICAgcW1wLT5wYXlsb2FkX2ZkID0gLTE7CiAgICAgcW1wLT5jYWxs
YmFjayA9IHN3aXRjaF9xZW11X3hlbl9sb2dkaXJ0eV9kb25lOwogICAgIGxpYnhsX19xbXBfcGFy
YW1fYWRkX2Jvb2woZ2MsICZhcmdzLCAiZW5hYmxlIiwgZW5hYmxlKTsKLSAgICByYyA9IGxpYnhs
X19ldl9xbXBfc2VuZChnYywgcW1wLCAieGVuLXNldC1nbG9iYWwtZGlydHktbG9nIiwgYXJncyk7
CisgICAgcmMgPSBsaWJ4bF9fZXZfcW1wX3NlbmQoZWdjLCBxbXAsICJ4ZW4tc2V0LWdsb2JhbC1k
aXJ0eS1sb2ciLCBhcmdzKTsKICAgICBpZiAocmMpIGdvdG8gb3V0OwogCiAgICAgcmV0dXJuOwpk
aWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGlieGxfZG9tX3N1c3BlbmQuYyBiL3Rvb2xzL2xpYnhs
L2xpYnhsX2RvbV9zdXNwZW5kLmMKaW5kZXggMzVhZTMzNzI2MWJhLi4yNWQxNTcxODk1ZjggMTAw
NjQ0Ci0tLSBhL3Rvb2xzL2xpYnhsL2xpYnhsX2RvbV9zdXNwZW5kLmMKKysrIGIvdG9vbHMvbGli
eGwvbGlieGxfZG9tX3N1c3BlbmQuYwpAQCAtNTQ1LDcgKzU0NSw3IEBAIHZvaWQgbGlieGxfX2Rt
X3Jlc3VtZShsaWJ4bF9fZWdjICplZ2MsCiAgICAgICAgIHFtcC0+ZG9taWQgPSBkb21pZDsKICAg
ICAgICAgcW1wLT5jYWxsYmFjayA9IGRtX3Jlc3VtZV9xbXBfZG9uZTsKICAgICAgICAgcW1wLT5w
YXlsb2FkX2ZkID0gLTE7Ci0gICAgICAgIHJjID0gbGlieGxfX2V2X3FtcF9zZW5kKGdjLCBxbXAs
ICJjb250IiwgTlVMTCk7CisgICAgICAgIHJjID0gbGlieGxfX2V2X3FtcF9zZW5kKGVnYywgcW1w
LCAiY29udCIsIE5VTEwpOwogICAgICAgICBpZiAocmMpIGdvdG8gb3V0OwogICAgICAgICBicmVh
azsKICAgICBkZWZhdWx0OgpkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGlieGxfZG9tYWluLmMg
Yi90b29scy9saWJ4bC9saWJ4bF9kb21haW4uYwppbmRleCA3Y2E3YTIyNGY5YTQuLjU3MTQ1MDE3
Nzg1OCAxMDA2NDQKLS0tIGEvdG9vbHMvbGlieGwvbGlieGxfZG9tYWluLmMKKysrIGIvdG9vbHMv
bGlieGwvbGlieGxfZG9tYWluLmMKQEAgLTE2MDAsNyArMTYwMCw3IEBAIGludCBsaWJ4bF9zZXRf
dmNwdW9ubGluZShsaWJ4bF9jdHggKmN0eCwgdWludDMyX3QgZG9taWQsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMSUJYTF9RTVBfQ01EX1RJTUVPVVQgKiAx
MDAwKTsKICAgICAgICAgICAgIGlmIChyYykgZ290byBvdXQ7CiAgICAgICAgICAgICBxbXAtPmNh
bGxiYWNrID0gc2V0X3ZjcHVvbmxpbmVfcW1wX2NwdXNfcXVlcmllZDsKLSAgICAgICAgICAgIHJj
ID0gbGlieGxfX2V2X3FtcF9zZW5kKGdjLCBxbXAsICJxdWVyeS1jcHVzIiwgTlVMTCk7CisgICAg
ICAgICAgICByYyA9IGxpYnhsX19ldl9xbXBfc2VuZChlZ2MsIHFtcCwgInF1ZXJ5LWNwdXMiLCBO
VUxMKTsKICAgICAgICAgICAgIGlmIChyYykgZ290byBvdXQ7CiAgICAgICAgICAgICByZXR1cm4g
QU9fSU5QUk9HUkVTUzsKICAgICAgICAgZGVmYXVsdDoKQEAgLTE2NjYsNyArMTY2Niw3IEBAIHN0
YXRpYyB2b2lkIHNldF92Y3B1b25saW5lX3FtcF9hZGRfY3B1KGxpYnhsX19lZ2MgKmVnYywKICAg
ICAgICAgaWYgKGxpYnhsX2JpdG1hcF90ZXN0KG1hcCwgc3Zvcy0+aW5kZXgpKSB7CiAgICAgICAg
ICAgICBxbXAtPmNhbGxiYWNrID0gc2V0X3ZjcHVvbmxpbmVfcW1wX2FkZF9jcHU7CiAgICAgICAg
ICAgICBsaWJ4bF9fcW1wX3BhcmFtX2FkZF9pbnRlZ2VyKGdjLCAmYXJncywgImlkIiwgc3Zvcy0+
aW5kZXgpOwotICAgICAgICAgICAgcmMgPSBsaWJ4bF9fZXZfcW1wX3NlbmQoZ2MsIHFtcCwgImNw
dS1hZGQiLCBhcmdzKTsKKyAgICAgICAgICAgIHJjID0gbGlieGxfX2V2X3FtcF9zZW5kKGVnYywg
cW1wLCAiY3B1LWFkZCIsIGFyZ3MpOwogICAgICAgICAgICAgaWYgKHJjKSBnb3RvIG91dDsKICAg
ICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQpAQCAtMTc0MCw3ICsxNzQwLDcgQEAgc3RhdGlj
IHZvaWQgZG9tYWluX3MzX3Jlc3VtZShsaWJ4bF9fYW8gKmFvLCBsaWJ4bF9fZWdjICplZ2MsIGlu
dCBkb21pZCkKICAgICAgICAgICAgIH0KICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICBjYXNl
IExJQlhMX0RFVklDRV9NT0RFTF9WRVJTSU9OX1FFTVVfWEVOOgotICAgICAgICAgICAgcmMgPSBs
aWJ4bF9fZXZfcW1wX3NlbmQoZ2MsIHFtcCwgInN5c3RlbV93YWtldXAiLCBOVUxMKTsKKyAgICAg
ICAgICAgIHJjID0gbGlieGxfX2V2X3FtcF9zZW5kKGVnYywgcW1wLCAic3lzdGVtX3dha2V1cCIs
IE5VTEwpOwogICAgICAgICAgICAgaWYgKHJjKSBnb3RvIG91dDsKICAgICAgICAgICAgIHJldHVy
bjsKICAgICAgICAgZGVmYXVsdDoKQEAgLTE5NTgsNyArMTk1OCw3IEBAIHN0YXRpYyB2b2lkIHJl
dHJpZXZlX2RvbWFpbl9jb25maWd1cmF0aW9uX2xvY2tfYWNxdWlyZWQoCiAgICAgICAgIGxpYnhs
X2JpdG1hcF9hbGxvYyhDVFgsICZyZGNzLT5xZW11dV9jcHVzLAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgZF9jb25maWctPmJfaW5mby5tYXhfdmNwdXMpOwogICAgICAgICByZGNzLT5xbXAu
Y2FsbGJhY2sgPSByZXRyaWV2ZV9kb21haW5fY29uZmlndXJhdGlvbl9jcHVfcXVlcmllZDsKLSAg
ICAgICAgcmMgPSBsaWJ4bF9fZXZfcW1wX3NlbmQoZ2MsICZyZGNzLT5xbXAsICJxdWVyeS1jcHVz
IiwgTlVMTCk7CisgICAgICAgIHJjID0gbGlieGxfX2V2X3FtcF9zZW5kKGVnYywgJnJkY3MtPnFt
cCwgInF1ZXJ5LWNwdXMiLCBOVUxMKTsKICAgICAgICAgaWYgKHJjKSBnb3RvIG91dDsKICAgICAg
ICAgaGFzX2NhbGxiYWNrID0gdHJ1ZTsKICAgICB9CmRpZmYgLS1naXQgYS90b29scy9saWJ4bC9s
aWJ4bF9pbnRlcm5hbC5oIGIvdG9vbHMvbGlieGwvbGlieGxfaW50ZXJuYWwuaAppbmRleCA5Yjg0
ZGRkZDNiN2QuLmY5NTg5NWVhZTE3ZCAxMDA2NDQKLS0tIGEvdG9vbHMvbGlieGwvbGlieGxfaW50
ZXJuYWwuaAorKysgYi90b29scy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5oCkBAIC00NzIsNyArNDcy
LDcgQEAgdHlwZWRlZiB2b2lkIGxpYnhsX19ldl9xbXBfY2FsbGJhY2sobGlieGxfX2VnYyAqZWdj
LCBsaWJ4bF9fZXZfcW1wICpldiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGludCByYyk7CiAKIF9oaWRkZW4gdm9pZCBsaWJ4bF9fZXZfcW1wX2luaXQobGlieGxfX2V2X3Ft
cCAqZXYpOwotX2hpZGRlbiBpbnQgbGlieGxfX2V2X3FtcF9zZW5kKGxpYnhsX19nYyAqZ2MsIGxp
YnhsX19ldl9xbXAgKmV2LAorX2hpZGRlbiBpbnQgbGlieGxfX2V2X3FtcF9zZW5kKGxpYnhsX19l
Z2MgKmVnYywgbGlieGxfX2V2X3FtcCAqZXYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgY29uc3QgY2hhciAqY21kLCBsaWJ4bF9fanNvbl9vYmplY3QgKmFyZ3MpOwogX2hpZGRlbiB2
b2lkIGxpYnhsX19ldl9xbXBfZGlzcG9zZShsaWJ4bF9fZ2MgKmdjLCBsaWJ4bF9fZXZfcW1wICpl
dik7CiAKZGlmZiAtLWdpdCBhL3Rvb2xzL2xpYnhsL2xpYnhsX3BjaS5jIGIvdG9vbHMvbGlieGwv
bGlieGxfcGNpLmMKaW5kZXggMmNjYWIwMzNiNDYwLi5hNjY5MTU1NDJiOTggMTAwNjQ0Ci0tLSBh
L3Rvb2xzL2xpYnhsL2xpYnhsX3BjaS5jCisrKyBiL3Rvb2xzL2xpYnhsL2xpYnhsX3BjaS5jCkBA
IC0xMTg2LDcgKzExODYsNyBAQCBzdGF0aWMgdm9pZCBwY2lfYWRkX3FtcF9kZXZpY2VfYWRkKGxp
YnhsX19lZ2MgKmVnYywgcGNpX2FkZF9zdGF0ZSAqcGFzKQogICAgIHFtcC0+ZG9taWQgPSBkb21p
ZDsKICAgICBxbXAtPnBheWxvYWRfZmQgPSAtMTsKICAgICBxbXAtPmNhbGxiYWNrID0gcGNpX2Fk
ZF9xbXBfZGV2aWNlX2FkZF9jYjsKLSAgICByYyA9IGxpYnhsX19ldl9xbXBfc2VuZChnYywgcW1w
LCAiZGV2aWNlX2FkZCIsIGFyZ3MpOworICAgIHJjID0gbGlieGxfX2V2X3FtcF9zZW5kKGVnYywg
cW1wLCAiZGV2aWNlX2FkZCIsIGFyZ3MpOwogICAgIGlmIChyYykgZ290byBvdXQ7CiAgICAgcmV0
dXJuOwogCkBAIC0xMjA1LDcgKzEyMDUsNyBAQCBzdGF0aWMgdm9pZCBwY2lfYWRkX3FtcF9kZXZp
Y2VfYWRkX2NiKGxpYnhsX19lZ2MgKmVnYywKICAgICBpZiAocmMpIGdvdG8gb3V0OwogCiAgICAg
cW1wLT5jYWxsYmFjayA9IHBjaV9hZGRfcW1wX3F1ZXJ5X3BjaV9jYjsKLSAgICByYyA9IGxpYnhs
X19ldl9xbXBfc2VuZChnYywgcW1wLCAicXVlcnktcGNpIiwgTlVMTCk7CisgICAgcmMgPSBsaWJ4
bF9fZXZfcW1wX3NlbmQoZWdjLCBxbXAsICJxdWVyeS1wY2kiLCBOVUxMKTsKICAgICBpZiAocmMp
IGdvdG8gb3V0OwogICAgIHJldHVybjsKIApAQCAtMjAyMCw3ICsyMDIwLDcgQEAgc3RhdGljIHZv
aWQgcGNpX3JlbW92ZV9xbXBfZGV2aWNlX2RlbChsaWJ4bF9fZWdjICplZ2MsCiAgICAgUU1QX1BB
UkFNRVRFUlNfU1BSSU5URigmYXJncywgImlkIiwgUENJX1BUX1FERVZfSUQsCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBwY2lkZXYtPmJ1cywgcGNpZGV2LT5kZXYsIHBjaWRldi0+ZnVuYyk7
CiAgICAgcHJzLT5xbXAuY2FsbGJhY2sgPSBwY2lfcmVtb3ZlX3FtcF9kZXZpY2VfZGVsX2NiOwot
ICAgIHJjID0gbGlieGxfX2V2X3FtcF9zZW5kKGdjLCAmcHJzLT5xbXAsICJkZXZpY2VfZGVsIiwg
YXJncyk7CisgICAgcmMgPSBsaWJ4bF9fZXZfcW1wX3NlbmQoZWdjLCAmcHJzLT5xbXAsICJkZXZp
Y2VfZGVsIiwgYXJncyk7CiAgICAgaWYgKHJjKSBnb3RvIG91dDsKICAgICByZXR1cm47CiAKQEAg
LTIwNTksNyArMjA1OSw3IEBAIHN0YXRpYyB2b2lkIHBjaV9yZW1vdmVfcW1wX3JldHJ5X3RpbWVy
X2NiKGxpYnhsX19lZ2MgKmVnYywgbGlieGxfX2V2X3RpbWUgKmV2LAogICAgIHBjaV9yZW1vdmVf
c3RhdGUgKnBycyA9IENPTlRBSU5FUl9PRihldiwgKnBycywgcmV0cnlfdGltZXIpOwogCiAgICAg
cHJzLT5xbXAuY2FsbGJhY2sgPSBwY2lfcmVtb3ZlX3FtcF9xdWVyeV9jYjsKLSAgICByYyA9IGxp
YnhsX19ldl9xbXBfc2VuZChnYywgJnBycy0+cW1wLCAicXVlcnktcGNpIiwgTlVMTCk7CisgICAg
cmMgPSBsaWJ4bF9fZXZfcW1wX3NlbmQoZWdjLCAmcHJzLT5xbXAsICJxdWVyeS1wY2kiLCBOVUxM
KTsKICAgICBpZiAocmMpIGdvdG8gb3V0OwogICAgIHJldHVybjsKIApkaWZmIC0tZ2l0IGEvdG9v
bHMvbGlieGwvbGlieGxfcW1wLmMgYi90b29scy9saWJ4bC9saWJ4bF9xbXAuYwppbmRleCA5YWFi
YWQ3NGZhYmQuLmYwZTBiNTBiZDFjNSAxMDA2NDQKLS0tIGEvdG9vbHMvbGlieGwvbGlieGxfcW1w
LmMKKysrIGIvdG9vbHMvbGlieGwvbGlieGxfcW1wLmMKQEAgLTkyNCw3ICs5MjQsNyBAQCBpbnQg
bGlieGxfcWVtdV9tb25pdG9yX2NvbW1hbmQobGlieGxfY3R4ICpjdHgsIHVpbnQzMl90IGRvbWlk
LAogICAgIHFtY3MtPnFtcC5jYWxsYmFjayA9IHFlbXVfbW9uaXRvcl9jb21tYW5kX2RvbmU7CiAg
ICAgcW1jcy0+b3V0cHV0ID0gb3V0cHV0OwogICAgIGxpYnhsX19xbXBfcGFyYW1fYWRkX3N0cmlu
ZyhnYywgJmFyZ3MsICJjb21tYW5kLWxpbmUiLCBjb21tYW5kX2xpbmUpOwotICAgIHJjID0gbGli
eGxfX2V2X3FtcF9zZW5kKGdjLCAmcW1jcy0+cW1wLCAiaHVtYW4tbW9uaXRvci1jb21tYW5kIiwg
YXJncyk7CisgICAgcmMgPSBsaWJ4bF9fZXZfcW1wX3NlbmQoZWdjLCAmcW1jcy0+cW1wLCAiaHVt
YW4tbW9uaXRvci1jb21tYW5kIiwgYXJncyk7CiBvdXQ6CiAgICAgaWYgKHJjKSByZXR1cm4gQU9f
Q1JFQVRFX0ZBSUwocmMpOwogICAgIHJldHVybiBBT19JTlBST0dSRVNTOwpAQCAtOTc4LDcgKzk3
OCw3IEBAIHZvaWQgbGlieGxfX3FtcF9zdXNwZW5kX3NhdmUobGlieGxfX2VnYyAqZWdjLAogICAg
IGV2LT5jYWxsYmFjayA9IGRtX3N0b3BwZWQ7CiAgICAgZXYtPnBheWxvYWRfZmQgPSAtMTsKIAot
ICAgIHJjID0gbGlieGxfX2V2X3FtcF9zZW5kKGdjLCBldiwgInN0b3AiLCBOVUxMKTsKKyAgICBy
YyA9IGxpYnhsX19ldl9xbXBfc2VuZChlZ2MsIGV2LCAic3RvcCIsIE5VTEwpOwogICAgIGlmIChy
YykKICAgICAgICAgZ290byBlcnJvcjsKIApAQCAtMTAwNyw3ICsxMDA3LDcgQEAgc3RhdGljIHZv
aWQgZG1fc3RvcHBlZChsaWJ4bF9fZWdjICplZ2MsIGxpYnhsX19ldl9xbXAgKmV2LAogICAgIH0K
IAogICAgIGV2LT5jYWxsYmFjayA9IGRtX3N0YXRlX2ZkX3JlYWR5OwotICAgIHJjID0gbGlieGxf
X2V2X3FtcF9zZW5kKGdjLCBldiwgImFkZC1mZCIsIE5VTEwpOworICAgIHJjID0gbGlieGxfX2V2
X3FtcF9zZW5kKGVnYywgZXYsICJhZGQtZmQiLCBOVUxMKTsKICAgICBpZiAocmMpCiAgICAgICAg
IGdvdG8gZXJyb3I7CiAKQEAgLTEwNTIsNyArMTA1Miw3IEBAIHN0YXRpYyB2b2lkIGRtX3N0YXRl
X2ZkX3JlYWR5KGxpYnhsX19lZ2MgKmVnYywgbGlieGxfX2V2X3FtcCAqZXYsCiAgICAgaWYgKHFt
cF9ldl9xZW11X2NvbXBhcmVfdmVyc2lvbihldiwgMiwgMTEsIDApID49IDApCiAgICAgICAgIGxp
YnhsX19xbXBfcGFyYW1fYWRkX2Jvb2woZ2MsICZhcmdzLCAibGl2ZSIsIGRzcHMtPmxpdmUpOwog
ICAgIFFNUF9QQVJBTUVURVJTX1NQUklOVEYoJmFyZ3MsICJmaWxlbmFtZSIsICIvZGV2L2Zkc2V0
LyVkIiwgZmRzZXQpOwotICAgIHJjID0gbGlieGxfX2V2X3FtcF9zZW5kKGdjLCBldiwgInhlbi1z
YXZlLWRldmljZXMtc3RhdGUiLCBhcmdzKTsKKyAgICByYyA9IGxpYnhsX19ldl9xbXBfc2VuZChl
Z2MsIGV2LCAieGVuLXNhdmUtZGV2aWNlcy1zdGF0ZSIsIGFyZ3MpOwogICAgIGlmIChyYykKICAg
ICAgICAgZ290byBlcnJvcjsKIApAQCAtMTc4MSw3ICsxNzgxLDcgQEAgdm9pZCBsaWJ4bF9fZXZf
cW1wX2luaXQobGlieGxfX2V2X3FtcCAqZXYpCiAgICAgZXYtPnFlbXVfdmVyc2lvbi5taWNybyA9
IC0xOwogfQogCi1pbnQgbGlieGxfX2V2X3FtcF9zZW5kKGxpYnhsX19nYyAqdW51c2VkX2djLCBs
aWJ4bF9fZXZfcW1wICpldiwKK2ludCBsaWJ4bF9fZXZfcW1wX3NlbmQobGlieGxfX2VnYyAqZWdj
LCBsaWJ4bF9fZXZfcW1wICpldiwKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hhciAq
Y21kLCBsaWJ4bF9fanNvbl9vYmplY3QgKmFyZ3MpCiAgICAgLyogZGlzY29ubmVjdGVkIC0+IGNv
bm5lY3RpbmcKICAgICAgKiBjb25uZWN0ZWQgLT4gd2FpdGluZ19yZXBseSAod2l0aCBtc2cgc2V0
KQpkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGlieGxfdXNiLmMgYi90b29scy9saWJ4bC9saWJ4
bF91c2IuYwppbmRleCAxZmM3Y2NmNDFmODYuLmRhNWUzNzA4ZTZjZiAxMDA2NDQKLS0tIGEvdG9v
bHMvbGlieGwvbGlieGxfdXNiLmMKKysrIGIvdG9vbHMvbGlieGwvbGlieGxfdXNiLmMKQEAgLTM0
OSw5ICszNDksMTAgQEAgc3RhdGljIGNoYXIgKnB2dXNiX2dldF9kZXZpY2VfdHlwZShsaWJ4bF91
c2JjdHJsX3R5cGUgdHlwZSkKICAqIC0gdXNiLWVoY2kgICAgICAgKHZlcnNpb249MiksIGFsd2F5
cyA2IHBvcnRzCiAgKiAtIG5lYy11c2IteGhjaSAgICh2ZXJzaW9uPTMpLCB1cCB0byAxNSBwb3J0
cwogICovCi1zdGF0aWMgaW50IGxpYnhsX19kZXZpY2VfdXNiY3RybF9hZGRfaHZtKGxpYnhsX19n
YyAqZ2MsIGxpYnhsX19ldl9xbXAgKnFtcCwKK3N0YXRpYyBpbnQgbGlieGxfX2RldmljZV91c2Jj
dHJsX2FkZF9odm0obGlieGxfX2VnYyAqZWdjLCBsaWJ4bF9fZXZfcW1wICpxbXAsCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnhsX2RldmljZV91c2JjdHJsICp1
c2JjdHJsKQogeworICAgIEVHQ19HQzsKICAgICBsaWJ4bF9fanNvbl9vYmplY3QgKnFtcF9hcmdz
ID0gTlVMTDsKIAogICAgIHN3aXRjaCAodXNiY3RybC0+dmVyc2lvbikgewpAQCAtMzc4LDI2ICsz
NzksMjggQEAgc3RhdGljIGludCBsaWJ4bF9fZGV2aWNlX3VzYmN0cmxfYWRkX2h2bShsaWJ4bF9f
Z2MgKmdjLCBsaWJ4bF9fZXZfcW1wICpxbXAsCiAgICAgbGlieGxfX3FtcF9wYXJhbV9hZGRfc3Ry
aW5nKGdjLCAmcW1wX2FyZ3MsICJpZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IEdDU1BSSU5URigieGVudXNiLSVkIiwgdXNiY3RybC0+ZGV2aWQpKTsKIAotICAgIHJldHVybiBs
aWJ4bF9fZXZfcW1wX3NlbmQoZ2MsIHFtcCwgImRldmljZV9hZGQiLCBxbXBfYXJncyk7CisgICAg
cmV0dXJuIGxpYnhsX19ldl9xbXBfc2VuZChlZ2MsIHFtcCwgImRldmljZV9hZGQiLCBxbXBfYXJn
cyk7CiB9CiAKIC8qIFNlbmQgcW1wIGNvbW1hbmRzIHRvIGRlbGV0ZSBhIHVzYiBjb250cm9sbGVy
IGluIHFlbXUuICAqLwotc3RhdGljIGludCBsaWJ4bF9fZGV2aWNlX3VzYmN0cmxfZGVsX2h2bShs
aWJ4bF9fZ2MgKmdjLAorc3RhdGljIGludCBsaWJ4bF9fZGV2aWNlX3VzYmN0cmxfZGVsX2h2bShs
aWJ4bF9fZWdjICplZ2MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGxpYnhsX19ldl9xbXAgKnFtcCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgaW50IGRldmlkKQogeworICAgIEVHQ19HQzsKICAgICBsaWJ4bF9fanNvbl9vYmplY3Qg
KnFtcF9hcmdzID0gTlVMTDsKIAogICAgIGxpYnhsX19xbXBfcGFyYW1fYWRkX3N0cmluZyhnYywg
JnFtcF9hcmdzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaWQiLCBHQ1NQUklO
VEYoInhlbnVzYi0lZCIsIGRldmlkKSk7CiAKLSAgICByZXR1cm4gbGlieGxfX2V2X3FtcF9zZW5k
KGdjLCBxbXAsICJkZXZpY2VfZGVsIiwgcW1wX2FyZ3MpOworICAgIHJldHVybiBsaWJ4bF9fZXZf
cW1wX3NlbmQoZWdjLCBxbXAsICJkZXZpY2VfZGVsIiwgcW1wX2FyZ3MpOwogfQogCiAvKiBTZW5k
IHFtcCBjb21tYW5kcyB0byBjcmVhdGUgYSB1c2IgZGV2aWNlIGluIHFlbXUuICovCi1zdGF0aWMg
aW50IGxpYnhsX19kZXZpY2VfdXNiZGV2X2FkZF9odm0obGlieGxfX2djICpnYywgbGlieGxfX2V2
X3FtcCAqcW1wLAorc3RhdGljIGludCBsaWJ4bF9fZGV2aWNlX3VzYmRldl9hZGRfaHZtKGxpYnhs
X19lZ2MgKmVnYywgbGlieGxfX2V2X3FtcCAqcW1wLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGxpYnhsX2RldmljZV91c2JkZXYgKnVzYmRldikKIHsKKyAgICBFR0Nf
R0M7CiAgICAgbGlieGxfX2pzb25fb2JqZWN0ICpxbXBfYXJncyA9IE5VTEw7CiAKICAgICBsaWJ4
bF9fcW1wX3BhcmFtX2FkZF9zdHJpbmcoZ2MsICZxbXBfYXJncywgImlkIiwKQEAgLTQxMywyMCAr
NDE2LDIxIEBAIHN0YXRpYyBpbnQgbGlieGxfX2RldmljZV91c2JkZXZfYWRkX2h2bShsaWJ4bF9f
Z2MgKmdjLCBsaWJ4bF9fZXZfcW1wICpxbXAsCiAgICAgbGlieGxfX3FtcF9wYXJhbV9hZGRfc3Ry
aW5nKGdjLCAmcW1wX2FyZ3MsICJob3N0YWRkciIsCiAgICAgICAgIEdDU1BSSU5URigiJWQiLCB1
c2JkZXYtPnUuaG9zdGRldi5ob3N0YWRkcikpOwogCi0gICAgcmV0dXJuIGxpYnhsX19ldl9xbXBf
c2VuZChnYywgcW1wLCAiZGV2aWNlX2FkZCIsIHFtcF9hcmdzKTsKKyAgICByZXR1cm4gbGlieGxf
X2V2X3FtcF9zZW5kKGVnYywgcW1wLCAiZGV2aWNlX2FkZCIsIHFtcF9hcmdzKTsKIH0KIAogLyog
U2VuZCBxbXAgY29tbWFuZHMgdG8gZGVsZXRlIGEgdXNiIGRldmljZSBpbiBxZW11LiAqLwotc3Rh
dGljIGludCBsaWJ4bF9fZGV2aWNlX3VzYmRldl9kZWxfaHZtKGxpYnhsX19nYyAqZ2MsIGxpYnhs
X19ldl9xbXAgKnFtcCwKK3N0YXRpYyBpbnQgbGlieGxfX2RldmljZV91c2JkZXZfZGVsX2h2bShs
aWJ4bF9fZWdjICplZ2MsIGxpYnhsX19ldl9xbXAgKnFtcCwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBsaWJ4bF9kZXZpY2VfdXNiZGV2ICp1c2JkZXYpCiB7CisgICAg
RUdDX0dDOwogICAgIGxpYnhsX19qc29uX29iamVjdCAqcW1wX2FyZ3MgPSBOVUxMOwogCiAgICAg
bGlieGxfX3FtcF9wYXJhbV9hZGRfc3RyaW5nKGdjLCAmcW1wX2FyZ3MsICJpZCIsCiAgICAgICAg
IEdDU1BSSU5URigieGVudXNiLSVkLSVkIiwgdXNiZGV2LT51Lmhvc3RkZXYuaG9zdGJ1cywKICAg
ICAgICAgICAgICAgICAgIHVzYmRldi0+dS5ob3N0ZGV2Lmhvc3RhZGRyKSk7CiAKLSAgICByZXR1
cm4gbGlieGxfX2V2X3FtcF9zZW5kKGdjLCBxbXAsICJkZXZpY2VfZGVsIiwgcW1wX2FyZ3MpOwor
ICAgIHJldHVybiBsaWJ4bF9fZXZfcW1wX3NlbmQoZWdjLCBxbXAsICJkZXZpY2VfZGVsIiwgcW1w
X2FyZ3MpOwogfQogCiBzdGF0aWMgTElCWExfREVGSU5FX1VQREFURV9ERVZJRCh1c2JjdHJsKQpA
QCAtNDkwLDcgKzQ5NCw3IEBAIHN0YXRpYyB2b2lkIGxpYnhsX19kZXZpY2VfdXNiY3RybF9hZGQo
bGlieGxfX2VnYyAqZWdjLCB1aW50MzJfdCBkb21pZCwKICAgICAgICAgcW1wLT5kb21pZCA9IGRv
bWlkOwogICAgICAgICBxbXAtPnBheWxvYWRfZmQgPSAtMTsKICAgICAgICAgcW1wLT5jYWxsYmFj
ayA9IGRldmljZV91c2JjdHJsX2FkZF9xbXBfY2I7Ci0gICAgICAgIHJjID0gbGlieGxfX2Rldmlj
ZV91c2JjdHJsX2FkZF9odm0oZ2MsIHFtcCwgdXNiY3RybCk7CisgICAgICAgIHJjID0gbGlieGxf
X2RldmljZV91c2JjdHJsX2FkZF9odm0oZWdjLCBxbXAsIHVzYmN0cmwpOwogICAgICAgICBpZiAo
cmMpIGdvdG8gb3V0cm07CiAgICAgICAgIHJldHVybjsKICAgICB9CkBAIC02NDcsNyArNjUxLDcg
QEAgc3RhdGljIHZvaWQgZGV2aWNlX3VzYmN0cmxfdXNiZGV2c19yZW1vdmVkKGxpYnhsX19lZ2Mg
KmVnYywKICAgICAgICAgcW1wLT5kb21pZCA9IGFvZGV2LT5kZXYtPmRvbWlkOwogICAgICAgICBx
bXAtPmNhbGxiYWNrID0gZGV2aWNlX3VzYmN0cmxfcmVtb3ZlX3FtcF9jYjsKICAgICAgICAgcW1w
LT5wYXlsb2FkX2ZkID0gLTE7Ci0gICAgICAgIHJjID0gbGlieGxfX2RldmljZV91c2JjdHJsX2Rl
bF9odm0oZ2MsIHFtcCwgYW9kZXYtPmRldi0+ZGV2aWQpOworICAgICAgICByYyA9IGxpYnhsX19k
ZXZpY2VfdXNiY3RybF9kZWxfaHZtKGVnYywgcW1wLCBhb2Rldi0+ZGV2LT5kZXZpZCk7CiAgICAg
ICAgIGlmIChyYykgZ290byBvdXQ7CiAgICAgICAgIHJldHVybjsKICAgICB9CkBAIC0xNzk3LDcg
KzE4MDEsNyBAQCBzdGF0aWMgdm9pZCBsaWJ4bF9fZGV2aWNlX3VzYmRldl9hZGQobGlieGxfX2Vn
YyAqZWdjLCB1aW50MzJfdCBkb21pZCwKICAgICAgICAgYW9kZXYtPnFtcC5kb21pZCA9IGRvbWlk
OwogICAgICAgICBhb2Rldi0+cW1wLmNhbGxiYWNrID0gZGV2aWNlX3VzYmRldl9hZGRfcW1wX2Ni
OwogICAgICAgICBhb2Rldi0+cW1wLnBheWxvYWRfZmQgPSAtMTsKLSAgICAgICAgcmMgPSBsaWJ4
bF9fZGV2aWNlX3VzYmRldl9hZGRfaHZtKGdjLCAmYW9kZXYtPnFtcCwgdXNiZGV2KTsKKyAgICAg
ICAgcmMgPSBsaWJ4bF9fZGV2aWNlX3VzYmRldl9hZGRfaHZtKGVnYywgJmFvZGV2LT5xbXAsIHVz
YmRldik7CiAgICAgICAgIGlmIChyYykgewogICAgICAgICAgICAgbGlieGxfX2RldmljZV91c2Jk
ZXZfcmVtb3ZlX3hlbnN0b3JlKGdjLCBkb21pZCwgdXNiZGV2LAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgTElCWExfVVNCQ1RSTF9UWVBFX0RFVklDRU1PREVM
KTsKQEAgLTE5NzksNyArMTk4Myw3IEBAIHN0YXRpYyB2b2lkIGxpYnhsX19kZXZpY2VfdXNiZGV2
X3JlbW92ZShsaWJ4bF9fZWdjICplZ2MsIHVpbnQzMl90IGRvbWlkLAogICAgICAgICBhb2Rldi0+
cW1wLmRvbWlkID0gZG9taWQ7CiAgICAgICAgIGFvZGV2LT5xbXAuY2FsbGJhY2sgPSBkZXZpY2Vf
dXNiZGV2X3JlbW92ZV9xbXBfY2I7CiAgICAgICAgIGFvZGV2LT5xbXAucGF5bG9hZF9mZCA9IC0x
OwotICAgICAgICByYyA9IGxpYnhsX19kZXZpY2VfdXNiZGV2X2RlbF9odm0oZ2MsICZhb2Rldi0+
cW1wLCB1c2JkZXYpOworICAgICAgICByYyA9IGxpYnhsX19kZXZpY2VfdXNiZGV2X2RlbF9odm0o
ZWdjLCAmYW9kZXYtPnFtcCwgdXNiZGV2KTsKICAgICAgICAgaWYgKHJjKSB7CiAgICAgICAgICAg
ICBsaWJ4bF9fZGV2aWNlX3VzYmRldl9hZGRfeGVuc3RvcmUoZ2MsIGRvbWlkLCB1c2JkZXYsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTElCWExfVVNCQ1RS
TF9UWVBFX0RFVklDRU1PREVMLAotLSAKQW50aG9ueSBQRVJBUkQKCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhl
bi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3Jn
L21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 9795EA32AC
	for <lists+xen-devel@lfdr.de>; Fri, 30 Aug 2019 10:33:27 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i3cIK-0006NG-0d; Fri, 30 Aug 2019 08:30:08 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=0MMg=W2=citrix.com=paul.durrant@srs-us1.protection.inumbo.net>)
 id 1i3cII-0006Dc-GM
 for xen-devel@lists.xenproject.org; Fri, 30 Aug 2019 08:30:06 +0000
X-Inumbo-ID: 5c4a22e5-cb00-11e9-ae7d-12813bfff9fa
Received: from esa6.hc3370-68.iphmx.com (unknown [216.71.155.175])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 5c4a22e5-cb00-11e9-ae7d-12813bfff9fa;
 Fri, 30 Aug 2019 08:30:04 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1567153803;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=vblHcc4nut7ypw91ZHzG+TjkVQX4tTewFuYwEWx1/wA=;
 b=SI7kTcY6fyw5gSZYCfFxKiXWqNdgY/O725eCfk5vJazohmmU16HyCiZN
 YhOCIav9xqJg7CHvRBQhtdin59FOC7O2FCg4I99qD9PhvHhUuDLP8kcDB
 /vdNmmfwp1oDvjdp3b0HJd/jTwAKvuPQI1jJYuahMyd8aKmxwcr8ZOYOx w=;
Authentication-Results: esa6.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=paul.durrant@citrix.com;
 spf=Pass smtp.mailfrom=Paul.Durrant@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa6.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 paul.durrant@citrix.com) identity=pra;
 client-ip=162.221.158.21; receiver=esa6.hc3370-68.iphmx.com;
 envelope-from="Paul.Durrant@citrix.com";
 x-sender="paul.durrant@citrix.com"; x-conformance=sidf_compatible
Received-SPF: Pass (esa6.hc3370-68.iphmx.com: domain of
 Paul.Durrant@citrix.com designates 162.221.158.21 as
 permitted sender) identity=mailfrom;
 client-ip=162.221.158.21; receiver=esa6.hc3370-68.iphmx.com;
 envelope-from="Paul.Durrant@citrix.com";
 x-sender="Paul.Durrant@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83 ~all"
Received-SPF: None (esa6.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa6.hc3370-68.iphmx.com;
 envelope-from="Paul.Durrant@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: +fCKHx0S4xQt66+68GbQulh3UETzkA48kyRP4GHBibXhCVDp3JzxQ2cVsoBCHCrZolD9sYvxF8
 5ZrRtXXejCcqW1woRAnkfvpO0Tcyei/q2fP4MmhFNgvjTR7sbNNZuCHo29UHKw3FdUi071V7gp
 ENyTP7Zi3a7vkPgg1lZUElndSpz66AieMgc74KViMpuD6+nJuDd0MUZ2KGFL1XrTYKdvKLnE0R
 2TDTP1HGlbV4MiiO+TgUUmD+ZiW55kLVbW23wm7uJGV5PNOOt1Ub6kowYC2nsd4KUx165sn3ee
 ocU=
X-SBRS: 2.7
X-MesageID: 5147852
X-Ironport-Server: esa6.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.64,446,1559534400"; 
   d="scan'208";a="5147852"
From: Paul Durrant <paul.durrant@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Fri, 30 Aug 2019 09:29:51 +0100
Message-ID: <20190830082953.2192-5-paul.durrant@citrix.com>
X-Mailer: git-send-email 2.20.1.2.gb21ebb671
In-Reply-To: <20190830082953.2192-1-paul.durrant@citrix.com>
References: <20190830082953.2192-1-paul.durrant@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v7 4/6] remove late (on-demand) construction of
 IOMMU page tables
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Petre Pircalabu <ppircalabu@bitdefender.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Razvan Cojocaru <rcojocaru@bitdefender.com>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Paul Durrant <paul.durrant@citrix.com>,
 Tamas K Lengyel <tamas@tklengyel.com>, Jan
 Beulich <jbeulich@suse.com>, Alexandru Isaila <aisaila@bitdefender.com>,
 Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

Tm93IHRoYXQgdGhlcmUgaXMgYSBwZXItZG9tYWluIElPTU1VLWVuYWJsZSBmbGFnLCB3aGljaCBz
aG91bGQgYmUgc2V0IGlmCmFueSBkZXZpY2UgaXMgZ29pbmcgdG8gYmUgcGFzc2VkIHRocm91Z2gs
IHN0b3AgZGVmZXJyaW5nIHBhZ2UgdGFibGUKY29uc3RydWN0aW9uIHVudGlsIHRoZSBhc3NpZ25t
ZW50IGlzIGRvbmUuIEFsc28gZG9uJ3QgdGVhciBkb3duIHRoZSB0YWJsZXMKYWdhaW4gd2hlbiB0
aGUgbGFzdCBkZXZpY2UgaXMgZGUtYXNzaWduZWQ7IGRlZmVyIHRoYXQgdGFzayB1bnRpbCBkb21h
aW4KZGVzdHJ1Y3Rpb24uCgpUaGlzIGFsbG93cyB0aGUgaGFzX2lvbW11X3B0KCkgaGVscGVyIGFu
ZCBpb21tdV9zdGF0dXMgZW51bWVyYXRpb24gdG8gYmUKcmVtb3ZlZC4gQ2FsbHMgdG8gaGFzX2lv
bW11X3B0KCkgYXJlIHNpbXBseSByZXBsYWNlZCBieSBjYWxscyB0bwppc19pb21tdV9lbmFibGVk
KCkuIFJlbWFpbmluZyBvcGVuLWNvZGVkIHRlc3RzIG9mIGlvbW11X2hhcF9wdF9zaGFyZSBjYW4K
YWxzbyBiZSByZXBsYWNlZCBieSBjYWxscyB0byBpb21tdV91c2VfaGFwX3B0KCkuClRoZSBhcmNo
X2lvbW11X3BvcHVsYXRlX3BhZ2VfdGFibGUoKSBhbmQgaW9tbXVfY29uc3RydWN0KCkgZnVuY3Rp
b25zIGJlY29tZQpyZWR1bmRhbnQsIGFzIGRvZXMgdGhlICdzdHJpY3QgbW9kZScgZG9tMCBwYWdl
X2xpc3QgbWFwcGluZyBjb2RlIGluCmlvbW11X2h3ZG9tX2luaXQoKSwgYW5kIGlvbW11X3RlYXJk
b3duKCkgY2FuIGJlIG1hZGUgc3RhdGljIGlzIGl0cyBvbmx5CnJlbWFpbmluZyBjYWxsZXIsIGlv
bW11X2RvbWFpbl9kZXN0cm95KCksIGlzIHdpdGhpbiB0aGUgc2FtZSBzb3VyY2UKbW9kdWxlLgoK
QWxsIGluIGFsbCwgYWJvdXQgMjIwIGxpbmVzIG9mIGNvZGUgYXJlIHJlbW92ZWQgZnJvbSB0aGUg
aHlwZXJ2aXNvci4KCk5PVEU6IFRoaXMgcGF0Y2ggd2lsbCBjYXVzZSBhIHNtYWxsIGFtb3VudCBv
ZiBleHRyYSByZXNvdXJjZSB0byBiZSB1c2VkCiAgICAgIHRvIGFjY29tbW9kYXRlIElPTU1VIHBh
Z2UgdGFibGVzIHRoYXQgbWF5IG5ldmVyIGJlIHVzZWQsIHNpbmNlIHRoZQogICAgICBwZXItZG9t
YWluIElPTU1VLWVuYWJsZSBmbGFnIGlzIGN1cnJlbnRseSBzZXQgdG8gdGhlIHZhbHVlIG9mIHRo
ZQogICAgICBnbG9iYWwgaW9tbXVfZW5hYmxlIGZsYWcuIEEgc3Vic2VxdWVudCBwYXRjaCB3aWxs
IGFkZCBhbiBvcHRpb24gdG8KICAgICAgdGhlIHRvb2xzdGFjayB0byBhbGxvdyBpdCB0byBiZSB0
dXJuZWQgb2ZmIGlmIHRoZXJlIGlzIG5vIGludGVudGlvbgogICAgICB0byBhc3NpZ24gcGFzc3Ro
cm91Z2ggaGFyZHdhcmUgdG8gdGhlIGRvbWFpbi4KICAgICAgVG8gYWNjb3VudCBmb3IgdGhlIGV4
dHJhIHJlc291cmNlLCAnaW9tbXVfbWVta2InIGhhcyBiZWVuIGFkZGVkIHRvCiAgICAgIGRvbWFp
bl9idWlsZF9pbmZvLiBUaGlzIHBhdGNoIHNldHMgaXQgdW5jb25kaXRpb25hbGx5IHRvIGEgdmFs
dWUKICAgICAgY2FsY3VsYXRlZCBiYXNlZCBvbiB0aGUgZG9tYWluJ3MgbWF4aW11bSBtZW1vcnkg
YnV0LCB3aGVuIHRoZQogICAgICB0b29sc3RhY2sgb3B0aW9uIG1lbnRpb25lZCBhYm92ZSBpcyBh
ZGRlZCwgaXQgY2FuIGJlIHNldCB0byB6ZXJvCiAgICAgIGlmIHRoZSBwZXItZG9tYWluIElPTU1V
LWVuYWJsZSBmbGFnIGlzIHR1cm5lZCBvZmYuCgpTaWduZWQtb2ZmLWJ5OiBQYXVsIER1cnJhbnQg
PHBhdWwuZHVycmFudEBjaXRyaXguY29tPgpSZXZpZXdlZC1ieTogQWxleGFuZHJ1IElzYWlsYSA8
YWlzYWlsYUBiaXRkZWZlbmRlci5jb20+CkFja2VkLWJ5OiBSYXp2YW4gQ29qb2NhcnUgPHJjb2pv
Y2FydUBiaXRkZWZlbmRlci5jb20+Ci0tLQpDYzogU3RlZmFubyBTdGFiZWxsaW5pIDxzc3RhYmVs
bGluaUBrZXJuZWwub3JnPgpDYzogSnVsaWVuIEdyYWxsIDxqdWxpZW4uZ3JhbGxAYXJtLmNvbT4K
Q2M6IFZvbG9keW15ciBCYWJjaHVrIDxWb2xvZHlteXJfQmFiY2h1a0BlcGFtLmNvbT4KQ2M6IEFu
ZHJldyBDb29wZXIgPGFuZHJldy5jb29wZXIzQGNpdHJpeC5jb20+CkNjOiBHZW9yZ2UgRHVubGFw
IDxHZW9yZ2UuRHVubGFwQGV1LmNpdHJpeC5jb20+CkNjOiBJYW4gSmFja3NvbiA8aWFuLmphY2tz
b25AZXUuY2l0cml4LmNvbT4KQ2M6IEphbiBCZXVsaWNoIDxqYmV1bGljaEBzdXNlLmNvbT4KQ2M6
IEtvbnJhZCBSemVzenV0ZWsgV2lsayA8a29ucmFkLndpbGtAb3JhY2xlLmNvbT4KQ2M6IFRpbSBE
ZWVnYW4gPHRpbUB4ZW4ub3JnPgpDYzogV2VpIExpdSA8d2xAeGVuLm9yZz4KQ2M6ICJSb2dlciBQ
YXUgTW9ubsOpIiA8cm9nZXIucGF1QGNpdHJpeC5jb20+CkNjOiBUYW1hcyBLIExlbmd5ZWwgPHRh
bWFzQHRrbGVuZ3llbC5jb20+CkNjOiBHZW9yZ2UgRHVubGFwIDxnZW9yZ2UuZHVubGFwQGV1LmNp
dHJpeC5jb20+CkNjOiBQZXRyZSBQaXJjYWxhYnUgPHBwaXJjYWxhYnVAYml0ZGVmZW5kZXIuY29t
PgoKUHJldmlvdXNseSBwYXJ0IG9mIHNlcmllcyBodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3Jn
L2FyY2hpdmVzL2h0bWwveGVuLWRldmVsLzIwMTktMDcvbXNnMDIyNjcuaHRtbAoKdjc6CiAtIEFk
ZCB0b29sc3RhY2sgbWVtb3J5IHJlc2VydmF0aW9uIGZvciBJT01NVSBwYWdlIHRhYmxlcy4uLiBS
ZS11c2Ugb2YKICAgc2hhZG93IGNhbGN1bGF0aW9uIGRpZG4ndCBzZWVtIGFwcHJvcHJpYXRlIHNv
IGEgbmV3IGhlbHBlciBmdW5jdGlvbiBpcwogICBhZGRlZAoKdjU6CiAtIE1pbm9yIHN0eWxlIGZp
eGVzCi0tLQogdG9vbHMvbGlieGwvbGlieGxfbWVtLmMgICAgICAgICAgICAgICB8ICAgNiArLQog
dG9vbHMvbGlieGwvbGlieGxfdHlwZXMuaWRsICAgICAgICAgICB8ICAgMSArCiB0b29scy9saWJ4
bC9saWJ4bF91dGlscy5jICAgICAgICAgICAgIHwgIDE1ICsrKwogdG9vbHMvbGlieGwvbGlieGxf
dXRpbHMuaCAgICAgICAgICAgICB8ICAgMSArCiB0b29scy94bC94bF9wYXJzZS5jICAgICAgICAg
ICAgICAgICAgIHwgICA3ICstCiB4ZW4vYXJjaC9hcm0vcDJtLmMgICAgICAgICAgICAgICAgICAg
IHwgICAyICstCiB4ZW4vYXJjaC94ODYvZG9tMF9idWlsZC5jICAgICAgICAgICAgIHwgICAyICst
CiB4ZW4vYXJjaC94ODYvaHZtL210cnIuYyAgICAgICAgICAgICAgIHwgICA1ICstCiB4ZW4vYXJj
aC94ODYvbW0vbWVtX3NoYXJpbmcuYyAgICAgICAgIHwgICAyICstCiB4ZW4vYXJjaC94ODYvbW0v
cDJtLmMgICAgICAgICAgICAgICAgIHwgICA0ICstCiB4ZW4vYXJjaC94ODYvbW0vcGFnaW5nLmMg
ICAgICAgICAgICAgIHwgICAyICstCiB4ZW4vYXJjaC94ODYveDg2XzY0L21tLmMgICAgICAgICAg
ICAgIHwgICAyICstCiB4ZW4vY29tbW9uL21lbW9yeS5jICAgICAgICAgICAgICAgICAgIHwgICA0
ICstCiB4ZW4vY29tbW9uL3ZtX2V2ZW50LmMgICAgICAgICAgICAgICAgIHwgICAyICstCiB4ZW4v
ZHJpdmVycy9wYXNzdGhyb3VnaC9kZXZpY2VfdHJlZS5jIHwgIDExIC0tLQogeGVuL2RyaXZlcnMv
cGFzc3Rocm91Z2gvaW9tbXUuYyAgICAgICB8IDEzNCArKysrKystLS0tLS0tLS0tLS0tLS0tLS0t
LQogeGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvcGNpLmMgICAgICAgICB8ICAxMiAtLS0KIHhlbi9k
cml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9pb21tdS5jICAgfCAgMTAgKy0KIHhlbi9kcml2ZXJzL3Bh
c3N0aHJvdWdoL3g4Ni9pb21tdS5jICAgfCAgOTcgLS0tLS0tLS0tLS0tLS0tLS0tLQogeGVuL2lu
Y2x1ZGUvYXNtLWFybS9pb21tdS5oICAgICAgICAgICB8ICAgMiArLQogeGVuL2luY2x1ZGUvYXNt
LXg4Ni9pb21tdS5oICAgICAgICAgICB8ICAgMiArLQogeGVuL2luY2x1ZGUveGVuL2lvbW11Lmgg
ICAgICAgICAgICAgICB8ICAxNiAtLS0KIHhlbi9pbmNsdWRlL3hlbi9zY2hlZC5oICAgICAgICAg
ICAgICAgfCAgIDIgLQogMjMgZmlsZXMgY2hhbmdlZCwgNzAgaW5zZXJ0aW9ucygrKSwgMjcxIGRl
bGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3Rvb2xzL2xpYnhsL2xpYnhsX21lbS5jIGIvdG9vbHMv
bGlieGwvbGlieGxfbWVtLmMKaW5kZXggNDQ4YTJhZjhmZC4uZmQ2ZjMzMzEyZSAxMDA2NDQKLS0t
IGEvdG9vbHMvbGlieGwvbGlieGxfbWVtLmMKKysrIGIvdG9vbHMvbGlieGwvbGlieGxfbWVtLmMK
QEAgLTQ2MSwxNSArNDYxLDE3IEBAIGludCBsaWJ4bF9kb21haW5fbmVlZF9tZW1vcnkobGlieGxf
Y3R4ICpjdHgsCiAgICAgaWYgKHJjKSBnb3RvIG91dDsKIAogICAgICpuZWVkX21lbWtiID0gYl9p
bmZvLT50YXJnZXRfbWVta2I7CisgICAgKm5lZWRfbWVta2IgKz0gYl9pbmZvLT5zaGFkb3dfbWVt
a2IgKyBiX2luZm8tPmlvbW11X21lbWtiOworCiAgICAgc3dpdGNoIChiX2luZm8tPnR5cGUpIHsK
ICAgICBjYXNlIExJQlhMX0RPTUFJTl9UWVBFX1BWSDoKICAgICBjYXNlIExJQlhMX0RPTUFJTl9U
WVBFX0hWTToKLSAgICAgICAgKm5lZWRfbWVta2IgKz0gYl9pbmZvLT5zaGFkb3dfbWVta2IgKyBM
SUJYTF9IVk1fRVhUUkFfTUVNT1JZOworICAgICAgICAqbmVlZF9tZW1rYiArPSBMSUJYTF9IVk1f
RVhUUkFfTUVNT1JZOwogICAgICAgICBpZiAobGlieGxfZGVmYm9vbF92YWwoYl9pbmZvLT5kZXZp
Y2VfbW9kZWxfc3R1YmRvbWFpbikpCiAgICAgICAgICAgICAqbmVlZF9tZW1rYiArPSAzMiAqIDEw
MjQ7CiAgICAgICAgIGJyZWFrOwogICAgIGNhc2UgTElCWExfRE9NQUlOX1RZUEVfUFY6Ci0gICAg
ICAgICpuZWVkX21lbWtiICs9IGJfaW5mby0+c2hhZG93X21lbWtiICsgTElCWExfUFZfRVhUUkFf
TUVNT1JZOworICAgICAgICAqbmVlZF9tZW1rYiArPSBMSUJYTF9QVl9FWFRSQV9NRU1PUlk7CiAg
ICAgICAgIGJyZWFrOwogICAgIGRlZmF1bHQ6CiAgICAgICAgIHJjID0gRVJST1JfSU5WQUw7CmRp
ZmYgLS1naXQgYS90b29scy9saWJ4bC9saWJ4bF90eXBlcy5pZGwgYi90b29scy9saWJ4bC9saWJ4
bF90eXBlcy5pZGwKaW5kZXggYjYxMzk5Y2UzNi4uZDk0Yjc0NTNjYiAxMDA2NDQKLS0tIGEvdG9v
bHMvbGlieGwvbGlieGxfdHlwZXMuaWRsCisrKyBiL3Rvb2xzL2xpYnhsL2xpYnhsX3R5cGVzLmlk
bApAQCAtNDg2LDYgKzQ4Niw3IEBAIGxpYnhsX2RvbWFpbl9idWlsZF9pbmZvID0gU3RydWN0KCJk
b21haW5fYnVpbGRfaW5mbyIsWwogICAgICgidGFyZ2V0X21lbWtiIiwgICAgTWVtS0IpLAogICAg
ICgidmlkZW9fbWVta2IiLCAgICAgTWVtS0IpLAogICAgICgic2hhZG93X21lbWtiIiwgICAgTWVt
S0IpLAorICAgICgiaW9tbXVfbWVta2IiLCAgICAgTWVtS0IpLAogICAgICgicnRjX3RpbWVvZmZz
ZXQiLCAgdWludDMyKSwKICAgICAoImV4ZWNfc3NpZHJlZiIsICAgIHVpbnQzMiksCiAgICAgKCJl
eGVjX3NzaWRfbGFiZWwiLCBzdHJpbmcpLApkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGlieGxf
dXRpbHMuYyBiL3Rvb2xzL2xpYnhsL2xpYnhsX3V0aWxzLmMKaW5kZXggZjM2MGY1ZTIyOC4uNDA1
NzMzYjdlMSAxMDA2NDQKLS0tIGEvdG9vbHMvbGlieGwvbGlieGxfdXRpbHMuYworKysgYi90b29s
cy9saWJ4bC9saWJ4bF91dGlscy5jCkBAIC00OCw2ICs0OCwyMSBAQCB1bnNpZ25lZCBsb25nIGxp
YnhsX2dldF9yZXF1aXJlZF9zaGFkb3dfbWVtb3J5KHVuc2lnbmVkIGxvbmcgbWF4bWVtX2tiLCB1
bnNpZ25lZAogICAgIHJldHVybiA0ICogKDI1NiAqIHNtcF9jcHVzICsgMiAqIChtYXhtZW1fa2Ig
LyAxMDI0KSk7CiB9CiAKK3Vuc2lnbmVkIGxvbmcgbGlieGxfZ2V0X3JlcXVpcmVkX2lvbW11X21l
bW9yeSh1bnNpZ25lZCBsb25nIG1heG1lbV9rYikKK3sKKyAgICB1bnNpZ25lZCBsb25nIGlvbW11
X3BhZ2VzID0gMCwgbWVtX3BhZ2VzID0gbWF4bWVtX2tiIC8gNDsKKyAgICB1bnNpZ25lZCBpbnQg
bGV2ZWw7CisKKyAgICAvKiBBc3N1bWUgYSA0IGxldmVsIHBhZ2UgdGFibGUgd2l0aCA1MTIgZW50
cmllcyBwZXIgbGV2ZWwgKi8KKyAgICBmb3IgKGxldmVsID0gMDsgbGV2ZWwgPCA0OyBsZXZlbCsr
KQorICAgIHsKKyAgICAgICAgbWVtX3BhZ2VzID0gRElWX1JPVU5EVVAobWVtX3BhZ2VzLCA1MTIp
OworICAgICAgICBpb21tdV9wYWdlcyArPSBtZW1fcGFnZXM7CisgICAgfQorCisgICAgcmV0dXJu
IGlvbW11X3BhZ2VzICogNDsKK30KKwogY2hhciAqbGlieGxfZG9taWRfdG9fbmFtZShsaWJ4bF9j
dHggKmN0eCwgdWludDMyX3QgZG9taWQpCiB7CiAgICAgdW5zaWduZWQgaW50IGxlbjsKZGlmZiAt
LWdpdCBhL3Rvb2xzL2xpYnhsL2xpYnhsX3V0aWxzLmggYi90b29scy9saWJ4bC9saWJ4bF91dGls
cy5oCmluZGV4IDQ0NDA5YWZkYzQuLjYzMGNjYmUyOGEgMTAwNjQ0Ci0tLSBhL3Rvb2xzL2xpYnhs
L2xpYnhsX3V0aWxzLmgKKysrIGIvdG9vbHMvbGlieGwvbGlieGxfdXRpbHMuaApAQCAtMjQsNiAr
MjQsNyBAQCBjb25zdAogY2hhciAqbGlieGxfYmFzZW5hbWUoY29uc3QgY2hhciAqbmFtZSk7IC8q
IHJldHVybnMgc3RyaW5nIGZyb20gc3RyZHVwICovCiAKIHVuc2lnbmVkIGxvbmcgbGlieGxfZ2V0
X3JlcXVpcmVkX3NoYWRvd19tZW1vcnkodW5zaWduZWQgbG9uZyBtYXhtZW1fa2IsIHVuc2lnbmVk
IGludCBzbXBfY3B1cyk7Cit1bnNpZ25lZCBsb25nIGxpYnhsX2dldF9yZXF1aXJlZF9pb21tdV9t
ZW1vcnkodW5zaWduZWQgbG9uZyBtYXhtZW1fa2IpOwogaW50IGxpYnhsX25hbWVfdG9fZG9taWQo
bGlieGxfY3R4ICpjdHgsIGNvbnN0IGNoYXIgKm5hbWUsIHVpbnQzMl90ICpkb21pZCk7CiBpbnQg
bGlieGxfZG9tYWluX3F1YWxpZmllcl90b19kb21pZChsaWJ4bF9jdHggKmN0eCwgY29uc3QgY2hh
ciAqbmFtZSwgdWludDMyX3QgKmRvbWlkKTsKIGNoYXIgKmxpYnhsX2RvbWlkX3RvX25hbWUobGli
eGxfY3R4ICpjdHgsIHVpbnQzMl90IGRvbWlkKTsKZGlmZiAtLWdpdCBhL3Rvb2xzL3hsL3hsX3Bh
cnNlLmMgYi90b29scy94bC94bF9wYXJzZS5jCmluZGV4IGUxMDViZGEyYmIuLmMxOTNmZTliYTQg
MTAwNjQ0Ci0tLSBhL3Rvb2xzL3hsL3hsX3BhcnNlLmMKKysrIGIvdG9vbHMveGwveGxfcGFyc2Uu
YwpAQCAtMTQ0OCwxNCArMTQ0OCwxNyBAQCB2b2lkIHBhcnNlX2NvbmZpZ19kYXRhKGNvbnN0IGNo
YXIgKmNvbmZpZ19zb3VyY2UsCiAgICAgICAgIGV4aXQoMSk7CiAgICAgfQogCi0gICAgLyogbGli
eGxfZ2V0X3JlcXVpcmVkX3NoYWRvd19tZW1vcnkoKSBtdXN0IGJlIGNhbGxlZCBhZnRlciBmaW5h
bCB2YWx1ZXMKKyAgICAvKiBsaWJ4bF9nZXRfcmVxdWlyZWRfc2hhZG93X21lbW9yeSgpIGFuZAor
ICAgICAqIGxpYnhsX2dldF9yZXF1aXJlZF9pb21tdV9tZW1vcnkoKSBtdXN0IGJlIGNhbGxlZCBh
ZnRlciBmaW5hbCB2YWx1ZXMKICAgICAgKiAoZGVmYXVsdCBvciBzcGVjaWZpZWQpIGZvciB2Y3B1
cyBhbmQgbWVtb3J5IGFyZSBzZXQsIGJlY2F1c2UgdGhlCi0gICAgICogY2FsY3VsYXRpb24gZGVw
ZW5kcyBvbiB0aG9zZSB2YWx1ZXMuICovCisgICAgICogY2FsY3VsYXRpb25zIGRlcGVuZCBvbiB0
aG9zZSB2YWx1ZXMuICovCiAgICAgYl9pbmZvLT5zaGFkb3dfbWVta2IgPSAheGx1X2NmZ19nZXRf
bG9uZyhjb25maWcsICJzaGFkb3dfbWVtb3J5IiwgJmwsIDApCiAgICAgICAgID8gbCAqIDEwMjQK
ICAgICAgICAgOiBsaWJ4bF9nZXRfcmVxdWlyZWRfc2hhZG93X21lbW9yeShiX2luZm8tPm1heF9t
ZW1rYiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiX2luZm8t
Pm1heF92Y3B1cyk7CiAKKyAgICBiX2luZm8tPmlvbW11X21lbWtiID0gbGlieGxfZ2V0X3JlcXVp
cmVkX2lvbW11X21lbW9yeShiX2luZm8tPm1heF9tZW1rYik7CisKICAgICB4bHVfY2ZnX2dldF9k
ZWZib29sKGNvbmZpZywgIm5vbWlncmF0ZSIsICZiX2luZm8tPmRpc2FibGVfbWlncmF0ZSwgMCk7
CiAKICAgICBpZiAoIXhsdV9jZmdfZ2V0X2xvbmcoY29uZmlnLCAidHNjX21vZGUiLCAmbCwgMSkp
IHsKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL2FybS9wMm0uYyBiL3hlbi9hcmNoL2FybS9wMm0uYwpp
bmRleCA3ZjE0NDI5MzJhLi42OTI1NjU3NTdlIDEwMDY0NAotLS0gYS94ZW4vYXJjaC9hcm0vcDJt
LmMKKysrIGIveGVuL2FyY2gvYXJtL3AybS5jCkBAIC0xMDU2LDcgKzEwNTYsNyBAQCBzdGF0aWMg
aW50IF9fcDJtX3NldF9lbnRyeShzdHJ1Y3QgcDJtX2RvbWFpbiAqcDJtLAogICAgICAgICAgIW1m
bl9lcShscGFlX2dldF9tZm4oKmVudHJ5KSwgbHBhZV9nZXRfbWZuKG9yaWdfcHRlKSkgKQogICAg
ICAgICBwMm1fZnJlZV9lbnRyeShwMm0sIG9yaWdfcHRlLCBsZXZlbCk7CiAKLSAgICBpZiAoIGhh
c19pb21tdV9wdChwMm0tPmRvbWFpbikgJiYKKyAgICBpZiAoIGlzX2lvbW11X2VuYWJsZWQocDJt
LT5kb21haW4pICYmCiAgICAgICAgICAobHBhZV9pc192YWxpZChvcmlnX3B0ZSkgfHwgbHBhZV9p
c192YWxpZCgqZW50cnkpKSApCiAgICAgewogICAgICAgICB1bnNpZ25lZCBpbnQgZmx1c2hfZmxh
Z3MgPSAwOwpkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L2RvbTBfYnVpbGQuYyBiL3hlbi9hcmNo
L3g4Ni9kb20wX2J1aWxkLmMKaW5kZXggZDM4MTc4NGVkZC4uN2NmYWIyZGMyNSAxMDA2NDQKLS0t
IGEveGVuL2FyY2gveDg2L2RvbTBfYnVpbGQuYworKysgYi94ZW4vYXJjaC94ODYvZG9tMF9idWls
ZC5jCkBAIC0zNjUsNyArMzY1LDcgQEAgdW5zaWduZWQgbG9uZyBfX2luaXQgZG9tMF9jb21wdXRl
X25yX3BhZ2VzKAogICAgIH0KIAogICAgIG5lZWRfcGFnaW5nID0gaXNfaHZtX2RvbWFpbihkKSAm
JgotICAgICAgICAoIWlvbW11X2hhcF9wdF9zaGFyZSB8fCAhcGFnaW5nX21vZGVfaGFwKGQpKTsK
KyAgICAgICAgKCFpb21tdV91c2VfaGFwX3B0KGQpIHx8ICFwYWdpbmdfbW9kZV9oYXAoZCkpOwog
ICAgIGZvciAoIDsgOyBuZWVkX3BhZ2luZyA9IGZhbHNlICkKICAgICB7CiAgICAgICAgIG5yX3Bh
Z2VzID0gZ2V0X21lbXNpemUoJmRvbTBfc2l6ZSwgYXZhaWwpOwpkaWZmIC0tZ2l0IGEveGVuL2Fy
Y2gveDg2L2h2bS9tdHJyLmMgYi94ZW4vYXJjaC94ODYvaHZtL210cnIuYwppbmRleCA3Y2NkODVi
Y2VhLi41YWQxNWVhZmUwIDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYvaHZtL210cnIuYworKysg
Yi94ZW4vYXJjaC94ODYvaHZtL210cnIuYwpAQCAtNzgzLDcgKzc4Myw4IEBAIEhWTV9SRUdJU1RF
Ul9TQVZFX1JFU1RPUkUoTVRSUiwgaHZtX3NhdmVfbXRycl9tc3IsIGh2bV9sb2FkX210cnJfbXNy
LCAxLAogCiB2b2lkIG1lbW9yeV90eXBlX2NoYW5nZWQoc3RydWN0IGRvbWFpbiAqZCkKIHsKLSAg
ICBpZiAoIChoYXNfaW9tbXVfcHQoZCkgfHwgY2FjaGVfZmx1c2hfcGVybWl0dGVkKGQpKSAmJiBk
LT52Y3B1ICYmIGQtPnZjcHVbMF0gKQorICAgIGlmICggKGlzX2lvbW11X2VuYWJsZWQoZCkgfHwg
Y2FjaGVfZmx1c2hfcGVybWl0dGVkKGQpKSAmJgorICAgICAgICAgZC0+dmNwdSAmJiBkLT52Y3B1
WzBdICkKICAgICB7CiAgICAgICAgIHAybV9tZW1vcnlfdHlwZV9jaGFuZ2VkKGQpOwogICAgICAg
ICBmbHVzaF9hbGwoRkxVU0hfQ0FDSEUpOwpAQCAtODMxLDcgKzgzMiw3IEBAIGludCBlcHRlX2dl
dF9lbnRyeV9lbXQoc3RydWN0IGRvbWFpbiAqZCwgdW5zaWduZWQgbG9uZyBnZm4sIG1mbl90IG1m
biwKICAgICAgICAgcmV0dXJuIE1UUlJfVFlQRV9VTkNBQ0hBQkxFOwogICAgIH0KIAotICAgIGlm
ICggIWhhc19pb21tdV9wdChkKSAmJiAhY2FjaGVfZmx1c2hfcGVybWl0dGVkKGQpICkKKyAgICBp
ZiAoICFpc19pb21tdV9lbmFibGVkKGQpICYmICFjYWNoZV9mbHVzaF9wZXJtaXR0ZWQoZCkgKQog
ICAgIHsKICAgICAgICAgKmlwYXQgPSAxOwogICAgICAgICByZXR1cm4gTVRSUl9UWVBFX1dSQkFD
SzsKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9tbS9tZW1fc2hhcmluZy5jIGIveGVuL2FyY2gv
eDg2L21tL21lbV9zaGFyaW5nLmMKaW5kZXggYTVmZTg5ZTMzOS4uZWZiODgyMTc2OCAxMDA2NDQK
LS0tIGEveGVuL2FyY2gveDg2L21tL21lbV9zaGFyaW5nLmMKKysrIGIveGVuL2FyY2gveDg2L21t
L21lbV9zaGFyaW5nLmMKQEAgLTE2NjQsNyArMTY2NCw3IEBAIGludCBtZW1fc2hhcmluZ19kb21j
dGwoc3RydWN0IGRvbWFpbiAqZCwgc3RydWN0IHhlbl9kb21jdGxfbWVtX3NoYXJpbmdfb3AgKm1l
YykKICAgICAgICAgY2FzZSBYRU5fRE9NQ1RMX01FTV9TSEFSSU5HX0NPTlRST0w6CiAgICAgICAg
IHsKICAgICAgICAgICAgIHJjID0gMDsKLSAgICAgICAgICAgIGlmICggdW5saWtlbHkoaGFzX2lv
bW11X3B0KGQpICYmIG1lYy0+dS5lbmFibGUpICkKKyAgICAgICAgICAgIGlmICggdW5saWtlbHko
aXNfaW9tbXVfZW5hYmxlZChkKSAmJiBtZWMtPnUuZW5hYmxlKSApCiAgICAgICAgICAgICAgICAg
cmMgPSAtRVhERVY7CiAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgZC0+YXJjaC5o
dm0ubWVtX3NoYXJpbmdfZW5hYmxlZCA9IG1lYy0+dS5lbmFibGU7CmRpZmYgLS1naXQgYS94ZW4v
YXJjaC94ODYvbW0vcDJtLmMgYi94ZW4vYXJjaC94ODYvbW0vcDJtLmMKaW5kZXggOGE1MjI5ZWUy
MS4uZTVlNDM0OWRlYSAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L21tL3AybS5jCisrKyBiL3hl
bi9hcmNoL3g4Ni9tbS9wMm0uYwpAQCAtMTM0MSw3ICsxMzQxLDcgQEAgaW50IHNldF9pZGVudGl0
eV9wMm1fZW50cnkoc3RydWN0IGRvbWFpbiAqZCwgdW5zaWduZWQgbG9uZyBnZm5fbCwKIAogICAg
IGlmICggIXBhZ2luZ19tb2RlX3RyYW5zbGF0ZShwMm0tPmRvbWFpbikgKQogICAgIHsKLSAgICAg
ICAgaWYgKCAhaGFzX2lvbW11X3B0KGQpICkKKyAgICAgICAgaWYgKCAhaXNfaW9tbXVfZW5hYmxl
ZChkKSApCiAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgcmV0dXJuIGlvbW11X2xlZ2Fj
eV9tYXAoZCwgX2RmbihnZm5fbCksIF9tZm4oZ2ZuX2wpLCBQQUdFX09SREVSXzRLLAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBJT01NVUZfcmVhZGFibGUgfCBJT01NVUZfd3JpdGFi
bGUpOwpAQCAtMTQzMiw3ICsxNDMyLDcgQEAgaW50IGNsZWFyX2lkZW50aXR5X3AybV9lbnRyeShz
dHJ1Y3QgZG9tYWluICpkLCB1bnNpZ25lZCBsb25nIGdmbl9sKQogCiAgICAgaWYgKCAhcGFnaW5n
X21vZGVfdHJhbnNsYXRlKGQpICkKICAgICB7Ci0gICAgICAgIGlmICggIWhhc19pb21tdV9wdChk
KSApCisgICAgICAgIGlmICggIWlzX2lvbW11X2VuYWJsZWQoZCkgKQogICAgICAgICAgICAgcmV0
dXJuIDA7CiAgICAgICAgIHJldHVybiBpb21tdV9sZWdhY3lfdW5tYXAoZCwgX2RmbihnZm5fbCks
IFBBR0VfT1JERVJfNEspOwogICAgIH0KZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9tbS9wYWdp
bmcuYyBiL3hlbi9hcmNoL3g4Ni9tbS9wYWdpbmcuYwppbmRleCA2OWFhMjI4ZTQ2Li5kOWE1MmM0
ZGI0IDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYvbW0vcGFnaW5nLmMKKysrIGIveGVuL2FyY2gv
eDg2L21tL3BhZ2luZy5jCkBAIC0yMTMsNyArMjEzLDcgQEAgaW50IHBhZ2luZ19sb2dfZGlydHlf
ZW5hYmxlKHN0cnVjdCBkb21haW4gKmQsIGJvb2xfdCBsb2dfZ2xvYmFsKQogewogICAgIGludCBy
ZXQ7CiAKLSAgICBpZiAoIGhhc19pb21tdV9wdChkKSAmJiBsb2dfZ2xvYmFsICkKKyAgICBpZiAo
IGlzX2lvbW11X2VuYWJsZWQoZCkgJiYgbG9nX2dsb2JhbCApCiAgICAgewogICAgICAgICAvKgog
ICAgICAgICAgKiBSZWZ1c2UgdG8gdHVybiBvbiBnbG9iYWwgbG9nLWRpcnR5IG1vZGUKZGlmZiAt
LWdpdCBhL3hlbi9hcmNoL3g4Ni94ODZfNjQvbW0uYyBiL3hlbi9hcmNoL3g4Ni94ODZfNjQvbW0u
YwppbmRleCA3OTVhNDY3NDYyLi5mYTU1ZjM0NzRlIDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYv
eDg2XzY0L21tLmMKKysrIGIveGVuL2FyY2gveDg2L3g4Nl82NC9tbS5jCkBAIC0xNDM0LDcgKzE0
MzQsNyBAQCBpbnQgbWVtb3J5X2FkZCh1bnNpZ25lZCBsb25nIHNwZm4sIHVuc2lnbmVkIGxvbmcg
ZXBmbiwgdW5zaWduZWQgaW50IHB4bSkKICAgICAgKiBzaGFyZWQgb3IgYmVpbmcga2VwdCBpbiBz
eW5jIHRoZW4gbmV3bHkgYWRkZWQgbWVtb3J5IG5lZWRzIHRvIGJlCiAgICAgICogbWFwcGVkIGhl
cmUuCiAgICAgICovCi0gICAgaWYgKCBoYXNfaW9tbXVfcHQoaGFyZHdhcmVfZG9tYWluKSAmJgor
ICAgIGlmICggaXNfaW9tbXVfZW5hYmxlZChoYXJkd2FyZV9kb21haW4pICYmCiAgICAgICAgICAh
aW9tbXVfdXNlX2hhcF9wdChoYXJkd2FyZV9kb21haW4pICYmCiAgICAgICAgICAhbmVlZF9pb21t
dV9wdF9zeW5jKGhhcmR3YXJlX2RvbWFpbikgKQogICAgIHsKZGlmZiAtLWdpdCBhL3hlbi9jb21t
b24vbWVtb3J5LmMgYi94ZW4vY29tbW9uL21lbW9yeS5jCmluZGV4IGQ1YWZmODNmMmQuLjczNjRm
ZDJjMzMgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vbWVtb3J5LmMKKysrIGIveGVuL2NvbW1vbi9t
ZW1vcnkuYwpAQCAtODIzLDcgKzgyMyw3IEBAIGludCB4ZW5tZW1fYWRkX3RvX3BoeXNtYXAoc3Ry
dWN0IGRvbWFpbiAqZCwgc3RydWN0IHhlbl9hZGRfdG9fcGh5c21hcCAqeGF0cCwKICAgICB4YXRw
LT5ncGZuICs9IHN0YXJ0OwogICAgIHhhdHAtPnNpemUgLT0gc3RhcnQ7CiAKLSAgICBpZiAoIGhh
c19pb21tdV9wdChkKSApCisgICAgaWYgKCBpc19pb21tdV9lbmFibGVkKGQpICkKICAgICAgICB0
aGlzX2NwdShpb21tdV9kb250X2ZsdXNoX2lvdGxiKSA9IDE7CiAKICAgICB3aGlsZSAoIHhhdHAt
PnNpemUgPiBkb25lICkKQEAgLTg0NCw3ICs4NDQsNyBAQCBpbnQgeGVubWVtX2FkZF90b19waHlz
bWFwKHN0cnVjdCBkb21haW4gKmQsIHN0cnVjdCB4ZW5fYWRkX3RvX3BoeXNtYXAgKnhhdHAsCiAg
ICAgICAgIH0KICAgICB9CiAKLSAgICBpZiAoIGhhc19pb21tdV9wdChkKSApCisgICAgaWYgKCBp
c19pb21tdV9lbmFibGVkKGQpICkKICAgICB7CiAgICAgICAgIGludCByZXQ7CiAKZGlmZiAtLWdp
dCBhL3hlbi9jb21tb24vdm1fZXZlbnQuYyBiL3hlbi9jb21tb24vdm1fZXZlbnQuYwppbmRleCAy
YTFjODdlNDRiLi4zYjE4MTk1ZWJmIDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL3ZtX2V2ZW50LmMK
KysrIGIveGVuL2NvbW1vbi92bV9ldmVudC5jCkBAIC02MzAsNyArNjMwLDcgQEAgaW50IHZtX2V2
ZW50X2RvbWN0bChzdHJ1Y3QgZG9tYWluICpkLCBzdHJ1Y3QgeGVuX2RvbWN0bF92bV9ldmVudF9v
cCAqdmVjKQogCiAgICAgICAgICAgICAvKiBObyBwYWdpbmcgaWYgaW9tbXUgaXMgdXNlZCAqLwog
ICAgICAgICAgICAgcmMgPSAtRU1MSU5LOwotICAgICAgICAgICAgaWYgKCB1bmxpa2VseShoYXNf
aW9tbXVfcHQoZCkpICkKKyAgICAgICAgICAgIGlmICggdW5saWtlbHkoaXNfaW9tbXVfZW5hYmxl
ZChkKSkgKQogICAgICAgICAgICAgICAgIGJyZWFrOwogCiAgICAgICAgICAgICByYyA9IC1FWERF
VjsKZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2RldmljZV90cmVlLmMgYi94
ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9kZXZpY2VfdHJlZS5jCmluZGV4IDEyZjJjNGMzZjIuLmVh
OWZkNTRlM2IgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2RldmljZV90cmVl
LmMKKysrIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvZGV2aWNlX3RyZWUuYwpAQCAtNDAsMTcg
KzQwLDYgQEAgaW50IGlvbW11X2Fzc2lnbl9kdF9kZXZpY2Uoc3RydWN0IGRvbWFpbiAqZCwgc3Ry
dWN0IGR0X2RldmljZV9ub2RlICpkZXYpCiAgICAgaWYgKCAhbGlzdF9lbXB0eSgmZGV2LT5kb21h
aW5fbGlzdCkgKQogICAgICAgICBnb3RvIGZhaWw7CiAKLSAgICAvKgotICAgICAqIFRoZSBod2Rv
bSBpcyBmb3JjZWQgdG8gdXNlIElPTU1VIGZvciBwcm90ZWN0aW5nIGFzc2lnbmVkCi0gICAgICog
ZGV2aWNlLiBUaGVyZWZvcmUgdGhlIElPTU1VIGRhdGEgaXMgYWxyZWFkeSBzZXQgdXAuCi0gICAg
ICovCi0gICAgQVNTRVJUKCFpc19oYXJkd2FyZV9kb21haW4oZCkgfHwKLSAgICAgICAgICAgaGQt
PnN0YXR1cyA9PSBJT01NVV9TVEFUVVNfaW5pdGlhbGl6ZWQpOwotCi0gICAgcmMgPSBpb21tdV9j
b25zdHJ1Y3QoZCk7Ci0gICAgaWYgKCByYyApCi0gICAgICAgIGdvdG8gZmFpbDsKLQogICAgIC8q
IFRoZSBmbGFnIGZpZWxkIGRvZXNuJ3QgbWF0dGVyIHRvIERUIGRldmljZS4gKi8KICAgICByYyA9
IGhkLT5wbGF0Zm9ybV9vcHMtPmFzc2lnbl9kZXZpY2UoZCwgMCwgZHRfdG9fZGV2KGRldiksIDAp
OwogCmRpZmYgLS1naXQgYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9pb21tdS5jIGIveGVuL2Ry
aXZlcnMvcGFzc3Rocm91Z2gvaW9tbXUuYwppbmRleCA5ZGFjZTY0YWY5Li40ZjcxZGI5NWVhIDEw
MDY0NAotLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9pb21tdS5jCisrKyBiL3hlbi9kcml2
ZXJzL3Bhc3N0aHJvdWdoL2lvbW11LmMKQEAgLTE0Niw2ICsxNDYsMTcgQEAgc3RhdGljIGludCBf
X2luaXQgcGFyc2VfZG9tMF9pb21tdV9wYXJhbShjb25zdCBjaGFyICpzKQogfQogY3VzdG9tX3Bh
cmFtKCJkb20wLWlvbW11IiwgcGFyc2VfZG9tMF9pb21tdV9wYXJhbSk7CiAKK3N0YXRpYyB2b2lk
IF9faHdkb21faW5pdCBjaGVja19od2RvbV9yZXFzKHN0cnVjdCBkb21haW4gKmQpCit7CisgICAg
aWYgKCBpb21tdV9od2RvbV9ub25lIHx8ICFwYWdpbmdfbW9kZV90cmFuc2xhdGUoZCkgKQorICAg
ICAgICByZXR1cm47CisKKyAgICBhcmNoX2lvbW11X2NoZWNrX2F1dG90cmFuc2xhdGVkX2h3ZG9t
KGQpOworCisgICAgaW9tbXVfaHdkb21fcGFzc3Rocm91Z2ggPSBmYWxzZTsKKyAgICBpb21tdV9o
d2RvbV9zdHJpY3QgPSB0cnVlOworfQorCiBpbnQgaW9tbXVfZG9tYWluX2luaXQoc3RydWN0IGRv
bWFpbiAqZCkKIHsKICAgICBzdHJ1Y3QgZG9tYWluX2lvbW11ICpoZCA9IGRvbV9pb21tdShkKTsK
QEAgLTE1OSwxMjkgKzE3MCw0NCBAQCBpbnQgaW9tbXVfZG9tYWluX2luaXQoc3RydWN0IGRvbWFp
biAqZCkKICAgICAgICAgcmV0dXJuIHJldDsKIAogICAgIGhkLT5wbGF0Zm9ybV9vcHMgPSBpb21t
dV9nZXRfb3BzKCk7Ci0gICAgcmV0dXJuIGhkLT5wbGF0Zm9ybV9vcHMtPmluaXQoZCk7Ci19Cisg
ICAgcmV0ID0gaGQtPnBsYXRmb3JtX29wcy0+aW5pdChkKTsKKyAgICBpZiAoIHJldCApCisgICAg
ICAgIHJldHVybiByZXQ7CiAKLXN0YXRpYyB2b2lkIF9faHdkb21faW5pdCBjaGVja19od2RvbV9y
ZXFzKHN0cnVjdCBkb21haW4gKmQpCi17Ci0gICAgaWYgKCBpb21tdV9od2RvbV9ub25lIHx8ICFw
YWdpbmdfbW9kZV90cmFuc2xhdGUoZCkgKQotICAgICAgICByZXR1cm47CisgICAgaWYgKCBpc19o
YXJkd2FyZV9kb21haW4oZCkgKQorICAgICAgICBjaGVja19od2RvbV9yZXFzKGQpOyAvKiBtYXkg
bW9kaWZ5IGlvbW11X2h3ZG9tX3N0cmljdCAqLwogCi0gICAgYXJjaF9pb21tdV9jaGVja19hdXRv
dHJhbnNsYXRlZF9od2RvbShkKTsKKyAgICAvKgorICAgICAqIE5COiAncmVsYXhlZCcgaC93IGRv
bWFpbnMgZG9uJ3QgbmVlZCB0aGUgSU9NTVUgbWFwcGluZ3MgdG8gYmUga2VwdAorICAgICAqICAg
ICBpbi1zeW5jIHdpdGggdGhlaXIgYXNzaWduZWQgcGFnZXMgYmVjYXVzZSBhbGwgaG9zdCBSQU0g
d2lsbCBiZQorICAgICAqICAgICBtYXBwZWQgZHVyaW5nIGh3ZG9tX2luaXQoKS4KKyAgICAgKi8K
KyAgICBpZiAoICFpc19oYXJkd2FyZV9kb21haW4oZCkgfHwgaW9tbXVfaHdkb21fc3RyaWN0ICkK
KyAgICAgICAgaGQtPm5lZWRfc3luYyA9ICFpb21tdV91c2VfaGFwX3B0KGQpOwogCi0gICAgaW9t
bXVfaHdkb21fcGFzc3Rocm91Z2ggPSBmYWxzZTsKLSAgICBpb21tdV9od2RvbV9zdHJpY3QgPSB0
cnVlOworICAgIHJldHVybiAwOwogfQogCiB2b2lkIF9faHdkb21faW5pdCBpb21tdV9od2RvbV9p
bml0KHN0cnVjdCBkb21haW4gKmQpCiB7CiAgICAgc3RydWN0IGRvbWFpbl9pb21tdSAqaGQgPSBk
b21faW9tbXUoZCk7CiAKLSAgICBjaGVja19od2RvbV9yZXFzKGQpOwotCiAgICAgaWYgKCAhaXNf
aW9tbXVfZW5hYmxlZChkKSApCiAgICAgICAgIHJldHVybjsKIAogICAgIHJlZ2lzdGVyX2tleWhh
bmRsZXIoJ28nLCAmaW9tbXVfZHVtcF9wMm1fdGFibGUsICJkdW1wIGlvbW11IHAybSB0YWJsZSIs
IDApOwogCi0gICAgaGQtPnN0YXR1cyA9IElPTU1VX1NUQVRVU19pbml0aWFsaXppbmc7Ci0gICAg
LyoKLSAgICAgKiBOQjogcmVsYXhlZCBodyBkb21haW5zIGRvbid0IG5lZWQgc3luYyBiZWNhdXNl
IGFsbCByYW0gaXMgYWxyZWFkeQotICAgICAqIG1hcHBlZCBpbiB0aGUgaW9tbXUgcGFnZSB0YWJs
ZXMuCi0gICAgICovCi0gICAgaGQtPm5lZWRfc3luYyA9IGlvbW11X2h3ZG9tX3N0cmljdCAmJiAh
aW9tbXVfdXNlX2hhcF9wdChkKTsKLSAgICBpZiAoIG5lZWRfaW9tbXVfcHRfc3luYyhkKSApCi0g
ICAgewotICAgICAgICBzdHJ1Y3QgcGFnZV9pbmZvICpwYWdlOwotICAgICAgICB1bnNpZ25lZCBp
bnQgaSA9IDAsIGZsdXNoX2ZsYWdzID0gMDsKLSAgICAgICAgaW50IHJjID0gMDsKLQotICAgICAg
ICBwYWdlX2xpc3RfZm9yX2VhY2ggKCBwYWdlLCAmZC0+cGFnZV9saXN0ICkKLSAgICAgICAgewot
ICAgICAgICAgICAgdW5zaWduZWQgbG9uZyBtZm4gPSBtZm5feChwYWdlX3RvX21mbihwYWdlKSk7
Ci0gICAgICAgICAgICB1bnNpZ25lZCBsb25nIGRmbiA9IG1mbl90b19nbWZuKGQsIG1mbik7Ci0g
ICAgICAgICAgICB1bnNpZ25lZCBpbnQgbWFwcGluZyA9IElPTU1VRl9yZWFkYWJsZTsKLSAgICAg
ICAgICAgIGludCByZXQ7Ci0KLSAgICAgICAgICAgIGlmICggKChwYWdlLT51LmludXNlLnR5cGVf
aW5mbyAmIFBHVF9jb3VudF9tYXNrKSA9PSAwKSB8fAotICAgICAgICAgICAgICAgICAoKHBhZ2Ut
PnUuaW51c2UudHlwZV9pbmZvICYgUEdUX3R5cGVfbWFzaykKLSAgICAgICAgICAgICAgICAgID09
IFBHVF93cml0YWJsZV9wYWdlKSApCi0gICAgICAgICAgICAgICAgbWFwcGluZyB8PSBJT01NVUZf
d3JpdGFibGU7Ci0KLSAgICAgICAgICAgIHJldCA9IGlvbW11X21hcChkLCBfZGZuKGRmbiksIF9t
Zm4obWZuKSwgMCwgbWFwcGluZywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAmZmx1c2hf
ZmxhZ3MpOwotCi0gICAgICAgICAgICBpZiAoICFyYyApCi0gICAgICAgICAgICAgICAgcmMgPSBy
ZXQ7Ci0KLSAgICAgICAgICAgIGlmICggIShpKysgJiAweGZmZmZmKSApCi0gICAgICAgICAgICAg
ICAgcHJvY2Vzc19wZW5kaW5nX3NvZnRpcnFzKCk7Ci0gICAgICAgIH0KLQotICAgICAgICAvKiBV
c2Ugd2hpbGUtYnJlYWsgdG8gYXZvaWQgY29tcGlsZXIgd2FybmluZyAqLwotICAgICAgICB3aGls
ZSAoIGlvbW11X2lvdGxiX2ZsdXNoX2FsbChkLCBmbHVzaF9mbGFncykgKQotICAgICAgICAgICAg
YnJlYWs7Ci0KLSAgICAgICAgaWYgKCByYyApCi0gICAgICAgICAgICBwcmludGsoWEVOTE9HX1dB
Uk5JTkcgImQlZDogSU9NTVUgbWFwcGluZyBmYWlsZWQ6ICVkXG4iLAotICAgICAgICAgICAgICAg
ICAgIGQtPmRvbWFpbl9pZCwgcmMpOwotICAgIH0KLQogICAgIGhkLT5wbGF0Zm9ybV9vcHMtPmh3
ZG9tX2luaXQoZCk7Ci0KLSAgICBoZC0+c3RhdHVzID0gSU9NTVVfU1RBVFVTX2luaXRpYWxpemVk
OwogfQogCi12b2lkIGlvbW11X3RlYXJkb3duKHN0cnVjdCBkb21haW4gKmQpCitzdGF0aWMgdm9p
ZCBpb21tdV90ZWFyZG93bihzdHJ1Y3QgZG9tYWluICpkKQogewogICAgIHN0cnVjdCBkb21haW5f
aW9tbXUgKmhkID0gZG9tX2lvbW11KGQpOwogCi0gICAgaGQtPnN0YXR1cyA9IElPTU1VX1NUQVRV
U19kaXNhYmxlZDsKICAgICBoZC0+cGxhdGZvcm1fb3BzLT50ZWFyZG93bihkKTsKICAgICB0YXNr
bGV0X3NjaGVkdWxlKCZpb21tdV9wdF9jbGVhbnVwX3Rhc2tsZXQpOwogfQogCi1pbnQgaW9tbXVf
Y29uc3RydWN0KHN0cnVjdCBkb21haW4gKmQpCi17Ci0gICAgc3RydWN0IGRvbWFpbl9pb21tdSAq
aGQgPSBkb21faW9tbXUoZCk7Ci0KLSAgICBpZiAoIGhkLT5zdGF0dXMgPT0gSU9NTVVfU1RBVFVT
X2luaXRpYWxpemVkICkKLSAgICAgICAgcmV0dXJuIDA7Ci0KLSAgICBoZC0+c3RhdHVzID0gSU9N
TVVfU1RBVFVTX2luaXRpYWxpemluZzsKLQotICAgIGlmICggIWlvbW11X3VzZV9oYXBfcHQoZCkg
KQotICAgIHsKLSAgICAgICAgaW50IHJjOwotCi0gICAgICAgIGhkLT5uZWVkX3N5bmMgPSB0cnVl
OwotCi0gICAgICAgIHJjID0gYXJjaF9pb21tdV9wb3B1bGF0ZV9wYWdlX3RhYmxlKGQpOwotICAg
ICAgICBpZiAoIHJjICkKLSAgICAgICAgewotICAgICAgICAgICAgaWYgKCByYyAhPSAtRVJFU1RB
UlQgKQotICAgICAgICAgICAgewotICAgICAgICAgICAgICAgIGhkLT5uZWVkX3N5bmMgPSBmYWxz
ZTsKLSAgICAgICAgICAgICAgICBoZC0+c3RhdHVzID0gSU9NTVVfU1RBVFVTX2Rpc2FibGVkOwot
ICAgICAgICAgICAgfQotCi0gICAgICAgICAgICByZXR1cm4gcmM7Ci0gICAgICAgIH0KLSAgICB9
Ci0KLSAgICBoZC0+c3RhdHVzID0gSU9NTVVfU1RBVFVTX2luaXRpYWxpemVkOwotCi0gICAgLyoK
LSAgICAgKiBUaGVyZSBtYXkgYmUgZGlydHkgY2FjaGUgbGluZXMgd2hlbiBhIGRldmljZSBpcyBh
c3NpZ25lZAotICAgICAqIGFuZCBiZWZvcmUgaGFzX2lvbW11X3B0KGQpIGJlY29taW5nIHRydWUs
IHRoaXMgd2lsbCBjYXVzZQotICAgICAqIG1lbW9yeV90eXBlX2NoYW5nZWQgbG9zZSBlZmZlY3Qg
aWYgbWVtb3J5IHR5cGUgY2hhbmdlcy4KLSAgICAgKiBDYWxsIG1lbW9yeV90eXBlX2NoYW5nZWQg
aGVyZSB0byBhbWVuZCB0aGlzLgotICAgICAqLwotICAgIG1lbW9yeV90eXBlX2NoYW5nZWQoZCk7
Ci0KLSAgICByZXR1cm4gMDsKLX0KLQogdm9pZCBpb21tdV9kb21haW5fZGVzdHJveShzdHJ1Y3Qg
ZG9tYWluICpkKQogewogICAgIGlmICggIWlzX2lvbW11X2VuYWJsZWQoZCkgKQpAQCAtNTc0LDEx
ICs1MDAsOCBAQCBpbnQgaW9tbXVfZG9fZG9tY3RsKAogdm9pZCBpb21tdV9zaGFyZV9wMm1fdGFi
bGUoc3RydWN0IGRvbWFpbiogZCkKIHsKICAgICBBU1NFUlQoaGFwX2VuYWJsZWQoZCkpOwotICAg
IC8qCi0gICAgICogaW9tbXVfdXNlX2hhcF9wdChkKSBjYW5ub3QgYmUgdXNlZCBoZXJlIGJlY2F1
c2UgZHVyaW5nIGRvbWFpbgotICAgICAqIGNvbnN0cnVjdGlvbiBoYXNfaW9tbXVfcHQoZCkgd2ls
bCBhbHdheXMgcmV0dXJuIGZhbHNlIGhlcmUuCi0gICAgICovCi0gICAgaWYgKCBpc19pb21tdV9l
bmFibGVkKGQpICYmIGlvbW11X2hhcF9wdF9zaGFyZSApCisKKyAgICBpZiAoIGlvbW11X3VzZV9o
YXBfcHQoZCkgKQogICAgICAgICBpb21tdV9nZXRfb3BzKCktPnNoYXJlX3AybShkKTsKIH0KIApA
QCAtNjI1LDggKzU0OCw3IEBAIHN0YXRpYyB2b2lkIGlvbW11X2R1bXBfcDJtX3RhYmxlKHVuc2ln
bmVkIGNoYXIga2V5KQogICAgIG9wcyA9IGlvbW11X2dldF9vcHMoKTsKICAgICBmb3JfZWFjaF9k
b21haW4oZCkKICAgICB7Ci0gICAgICAgIGlmICggaXNfaGFyZHdhcmVfZG9tYWluKGQpIHx8Ci0g
ICAgICAgICAgICAgZG9tX2lvbW11KGQpLT5zdGF0dXMgPCBJT01NVV9TVEFUVVNfaW5pdGlhbGl6
ZWQgKQorICAgICAgICBpZiAoIGlzX2hhcmR3YXJlX2RvbWFpbihkKSB8fCAhaXNfaW9tbXVfZW5h
YmxlZChkKSApCiAgICAgICAgICAgICBjb250aW51ZTsKIAogICAgICAgICBpZiAoIGlvbW11X3Vz
ZV9oYXBfcHQoZCkgKQpkaWZmIC0tZ2l0IGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvcGNpLmMg
Yi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9wY2kuYwppbmRleCA4MTQxMDY2NzlmLi4yMzE1ZDQ5
MGRjIDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9wY2kuYworKysgYi94ZW4v
ZHJpdmVycy9wYXNzdGhyb3VnaC9wY2kuYwpAQCAtOTMzLDkgKzkzMyw2IEBAIHN0YXRpYyBpbnQg
ZGVhc3NpZ25fZGV2aWNlKHN0cnVjdCBkb21haW4gKmQsIHVpbnQxNl90IHNlZywgdWludDhfdCBi
dXMsCiAKICAgICBwZGV2LT5mYXVsdC5jb3VudCA9IDA7CiAKLSAgICBpZiAoICFoYXNfYXJjaF9w
ZGV2cyhkKSAmJiBoYXNfaW9tbXVfcHQoZCkgKQotICAgICAgICBpb21tdV90ZWFyZG93bihkKTsK
LQogICAgIHJldHVybiByZXQ7CiB9CiAKQEAgLTE0ODQsMTMgKzE0ODEsNiBAQCBzdGF0aWMgaW50
IGFzc2lnbl9kZXZpY2Uoc3RydWN0IGRvbWFpbiAqZCwgdTE2IHNlZywgdTggYnVzLCB1OCBkZXZm
biwgdTMyIGZsYWcpCiAgICAgaWYgKCAhcGNpZGV2c190cnlsb2NrKCkgKQogICAgICAgICByZXR1
cm4gLUVSRVNUQVJUOwogCi0gICAgcmMgPSBpb21tdV9jb25zdHJ1Y3QoZCk7Ci0gICAgaWYgKCBy
YyApCi0gICAgewotICAgICAgICBwY2lkZXZzX3VubG9jaygpOwotICAgICAgICByZXR1cm4gcmM7
Ci0gICAgfQotCiAgICAgcGRldiA9IHBjaV9nZXRfcGRldl9ieV9kb21haW4oaGFyZHdhcmVfZG9t
YWluLCBzZWcsIGJ1cywgZGV2Zm4pOwogICAgIGlmICggIXBkZXYgKQogICAgIHsKQEAgLTE1MTks
OCArMTUwOSw2IEBAIHN0YXRpYyBpbnQgYXNzaWduX2RldmljZShzdHJ1Y3QgZG9tYWluICpkLCB1
MTYgc2VnLCB1OCBidXMsIHU4IGRldmZuLCB1MzIgZmxhZykKICAgICB9CiAKICBkb25lOgotICAg
IGlmICggIWhhc19hcmNoX3BkZXZzKGQpICYmIGhhc19pb21tdV9wdChkKSApCi0gICAgICAgIGlv
bW11X3RlYXJkb3duKGQpOwogICAgIHBjaWRldnNfdW5sb2NrKCk7CiAKICAgICByZXR1cm4gcmM7
CmRpZmYgLS1naXQgYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC92dGQvaW9tbXUuYyBiL3hlbi9k
cml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9pb21tdS5jCmluZGV4IGU1NmQ3YmVmYjQuLmFlNDYwOGZl
MTQgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9pb21tdS5jCisrKyBi
L3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9pb21tdS5jCkBAIC0xNzU5LDE1ICsxNzU5LDcg
QEAgc3RhdGljIHZvaWQgaW9tbXVfZG9tYWluX3RlYXJkb3duKHN0cnVjdCBkb21haW4gKmQpCiAK
ICAgICBBU1NFUlQoaXNfaW9tbXVfZW5hYmxlZChkKSk7CiAKLSAgICAvKgotICAgICAqIFdlIGNh
bid0IHVzZSBpb21tdV91c2VfaGFwX3B0IGhlcmUgYmVjYXVzZSBlaXRoZXIgSU9NTVUgc3RhdGUK
LSAgICAgKiBpcyBhbHJlYWR5IGNoYW5nZWQgdG8gSU9NTVVfU1RBVFVTX2Rpc2FibGVkIGF0IHRo
aXMgcG9pbnQgb3IKLSAgICAgKiBoYXMgYWx3YXlzIGJlZW4gSU9NTVVfU1RBVFVTX2Rpc2FibGVk
LgotICAgICAqCi0gICAgICogV2UgYWxzbyBuZWVkIHRvIHRlc3QgaWYgSEFQIGlzIGVuYWJsZWQg
YmVjYXVzZSBQViBndWVzdHMgY2FuCi0gICAgICogZW50ZXIgdGhpcyBwYXRoIHRvby4KLSAgICAg
Ki8KLSAgICBpZiAoIGhhcF9lbmFibGVkKGQpICYmIGlvbW11X2hhcF9wdF9zaGFyZSApCisgICAg
aWYgKCBpb21tdV91c2VfaGFwX3B0KGQpICkKICAgICAgICAgcmV0dXJuOwogCiAgICAgc3Bpbl9s
b2NrKCZoZC0+YXJjaC5tYXBwaW5nX2xvY2spOwpkaWZmIC0tZ2l0IGEveGVuL2RyaXZlcnMvcGFz
c3Rocm91Z2gveDg2L2lvbW11LmMgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC94ODYvaW9tbXUu
YwppbmRleCA4MzE5ZmUwYTY5Li40N2EzZTU1MjEzIDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy9w
YXNzdGhyb3VnaC94ODYvaW9tbXUuYworKysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC94ODYv
aW9tbXUuYwpAQCAtODEsMTAzICs4MSw2IEBAIGludCBfX2luaXQgaW9tbXVfc2V0dXBfaHBldF9t
c2koc3RydWN0IG1zaV9kZXNjICptc2kpCiAgICAgcmV0dXJuIG9wcy0+c2V0dXBfaHBldF9tc2kg
PyBvcHMtPnNldHVwX2hwZXRfbXNpKG1zaSkgOiAtRU5PREVWOwogfQogCi1pbnQgYXJjaF9pb21t
dV9wb3B1bGF0ZV9wYWdlX3RhYmxlKHN0cnVjdCBkb21haW4gKmQpCi17Ci0gICAgc3RydWN0IHBh
Z2VfaW5mbyAqcGFnZTsKLSAgICBpbnQgcmMgPSAwLCBuID0gMDsKLQotICAgIHNwaW5fbG9jaygm
ZC0+cGFnZV9hbGxvY19sb2NrKTsKLQotICAgIGlmICggdW5saWtlbHkoZC0+aXNfZHlpbmcpICkK
LSAgICAgICAgcmMgPSAtRVNSQ0g7Ci0KLSAgICB3aGlsZSAoICFyYyAmJiAocGFnZSA9IHBhZ2Vf
bGlzdF9yZW1vdmVfaGVhZCgmZC0+cGFnZV9saXN0KSkgKQotICAgIHsKLSAgICAgICAgaWYgKCBp
c19odm1fZG9tYWluKGQpIHx8Ci0gICAgICAgICAgICAocGFnZS0+dS5pbnVzZS50eXBlX2luZm8g
JiBQR1RfdHlwZV9tYXNrKSA9PSBQR1Rfd3JpdGFibGVfcGFnZSApCi0gICAgICAgIHsKLSAgICAg
ICAgICAgIG1mbl90IG1mbiA9IHBhZ2VfdG9fbWZuKHBhZ2UpOwotICAgICAgICAgICAgZ2ZuX3Qg
Z2ZuID0gbWZuX3RvX2dmbihkLCBtZm4pOwotICAgICAgICAgICAgdW5zaWduZWQgaW50IGZsdXNo
X2ZsYWdzID0gMDsKLQotICAgICAgICAgICAgaWYgKCAhZ2ZuX2VxKGdmbiwgSU5WQUxJRF9HRk4p
ICkKLSAgICAgICAgICAgIHsKLSAgICAgICAgICAgICAgICBkZm5fdCBkZm4gPSBfZGZuKGdmbl94
KGdmbikpOwotCi0gICAgICAgICAgICAgICAgQVNTRVJUKCEoZ2ZuX3goZ2ZuKSA+PiBERUZBVUxU
X0RPTUFJTl9BRERSRVNTX1dJRFRIKSk7Ci0gICAgICAgICAgICAgICAgQlVHX09OKFNIQVJFRF9N
MlAoZ2ZuX3goZ2ZuKSkpOwotICAgICAgICAgICAgICAgIHJjID0gaW9tbXVfbWFwKGQsIGRmbiwg
bWZuLCBQQUdFX09SREVSXzRLLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElPTU1V
Rl9yZWFkYWJsZSB8IElPTU1VRl93cml0YWJsZSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAmZmx1c2hfZmxhZ3MpOwotCi0gICAgICAgICAgICAgICAgLyoKLSAgICAgICAgICAgICAg
ICAgKiBXZSBtYXkgYmUgd29ya2luZyBiZWhpbmQgdGhlIGJhY2sgb2YgYSBydW5uaW5nIGd1ZXN0
LCB3aGljaAotICAgICAgICAgICAgICAgICAqIG1heSBjaGFuZ2UgdGhlIHR5cGUgb2YgYSBwYWdl
IGF0IGFueSB0aW1lLiAgV2UgY2FuJ3QgcHJldmVudAotICAgICAgICAgICAgICAgICAqIHRoaXMg
KGZvciBpbnN0YW5jZSwgYnkgYnVtcGluZyB0aGUgdHlwZSBjb3VudCB3aGlsZSBtYXBwaW5nCi0g
ICAgICAgICAgICAgICAgICogdGhlIHBhZ2UpIHdpdGhvdXQgY2F1c2luZyBsZWdpdGltYXRlIGd1
ZXN0IHR5cGUtY2hhbmdlCi0gICAgICAgICAgICAgICAgICogb3BlcmF0aW9ucyB0byBmYWlsLiAg
U28gYWZ0ZXIgYWRkaW5nIHRoZSBwYWdlIHRvIHRoZSBJT01NVSwKLSAgICAgICAgICAgICAgICAg
KiBjaGVjayBhZ2FpbiB0byBtYWtlIHN1cmUgdGhpcyBpcyBzdGlsbCB2YWxpZC4gIE5CIHRoYXQg
dGhlCi0gICAgICAgICAgICAgICAgICogd3JpdGFibGUgZW50cnkgaW4gdGhlIGlvbW11IGlzIGhh
cm1sZXNzIHVudGlsIGxhdGVyLCB3aGVuCi0gICAgICAgICAgICAgICAgICogdGhlIGFjdHVhbCBk
ZXZpY2UgZ2V0cyBhc3NpZ25lZC4KLSAgICAgICAgICAgICAgICAgKi8KLSAgICAgICAgICAgICAg
ICBpZiAoICFyYyAmJiAhaXNfaHZtX2RvbWFpbihkKSAmJgotICAgICAgICAgICAgICAgICAgICAg
KChwYWdlLT51LmludXNlLnR5cGVfaW5mbyAmIFBHVF90eXBlX21hc2spICE9Ci0gICAgICAgICAg
ICAgICAgICAgICAgUEdUX3dyaXRhYmxlX3BhZ2UpICkKLSAgICAgICAgICAgICAgICB7Ci0gICAg
ICAgICAgICAgICAgICAgIHJjID0gaW9tbXVfdW5tYXAoZCwgZGZuLCBQQUdFX09SREVSXzRLLCAm
Zmx1c2hfZmxhZ3MpOwotICAgICAgICAgICAgICAgICAgICAvKiBJZiB0aGUgdHlwZSBjaGFuZ2Vk
IHlldCBhZ2Fpbiwgc2ltcGx5IGZvcmNlIGEgcmV0cnkuICovCi0gICAgICAgICAgICAgICAgICAg
IGlmICggIXJjICYmICgocGFnZS0+dS5pbnVzZS50eXBlX2luZm8gJiBQR1RfdHlwZV9tYXNrKSA9
PQotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUEdUX3dyaXRhYmxlX3BhZ2UpICkK
LSAgICAgICAgICAgICAgICAgICAgICAgIHJjID0gLUVSRVNUQVJUOwotICAgICAgICAgICAgICAg
IH0KLSAgICAgICAgICAgIH0KLSAgICAgICAgICAgIGlmICggcmMgKQotICAgICAgICAgICAgewot
ICAgICAgICAgICAgICAgIHBhZ2VfbGlzdF9hZGQocGFnZSwgJmQtPnBhZ2VfbGlzdCk7Ci0gICAg
ICAgICAgICAgICAgYnJlYWs7Ci0gICAgICAgICAgICB9Ci0gICAgICAgIH0KLSAgICAgICAgcGFn
ZV9saXN0X2FkZF90YWlsKHBhZ2UsICZkLT5hcmNoLnJlbG1lbV9saXN0KTsKLSAgICAgICAgaWYg
KCAhKCsrbiAmIDB4ZmYpICYmICFwYWdlX2xpc3RfZW1wdHkoJmQtPnBhZ2VfbGlzdCkgJiYKLSAg
ICAgICAgICAgICBoeXBlcmNhbGxfcHJlZW1wdF9jaGVjaygpICkKLSAgICAgICAgICAgIHJjID0g
LUVSRVNUQVJUOwotICAgIH0KLQotICAgIGlmICggIXJjICkKLSAgICB7Ci0gICAgICAgIC8qCi0g
ICAgICAgICAqIFRoZSBleHBlY3RhdGlvbiBoZXJlIGlzIHRoYXQgZ2VuZXJhbGx5IHRoZXJlIGFy
ZSBtYW55IG5vcm1hbCBwYWdlcwotICAgICAgICAgKiBvbiByZWxtZW1fbGlzdCAodGhlIG9uZXMg
d2UgcHV0IHRoZXJlKSBhbmQgb25seSBmZXcgYmVpbmcgaW4gYW4KLSAgICAgICAgICogb2ZmbGlu
ZS9icm9rZW4gc3RhdGUuIFRoZSBsYXR0ZXIgb25lcyBhcmUgYWx3YXlzIGF0IHRoZSBoZWFkIG9m
IHRoZQotICAgICAgICAgKiBsaXN0LiBIZW5jZSB3ZSBmaXJzdCBtb3ZlIHRoZSB3aG9sZSBsaXN0
LCBhbmQgdGhlbiBtb3ZlIGJhY2sgdGhlCi0gICAgICAgICAqIGZpcnN0IGZldyBlbnRyaWVzLgot
ICAgICAgICAgKi8KLSAgICAgICAgcGFnZV9saXN0X21vdmUoJmQtPnBhZ2VfbGlzdCwgJmQtPmFy
Y2gucmVsbWVtX2xpc3QpOwotICAgICAgICB3aGlsZSAoICFwYWdlX2xpc3RfZW1wdHkoJmQtPnBh
Z2VfbGlzdCkgJiYKLSAgICAgICAgICAgICAgICAocGFnZSA9IHBhZ2VfbGlzdF9maXJzdCgmZC0+
cGFnZV9saXN0KSwKLSAgICAgICAgICAgICAgICAgKHBhZ2UtPmNvdW50X2luZm8gJiAoUEdDX3N0
YXRlfFBHQ19icm9rZW4pKSkgKQotICAgICAgICB7Ci0gICAgICAgICAgICBwYWdlX2xpc3RfZGVs
KHBhZ2UsICZkLT5wYWdlX2xpc3QpOwotICAgICAgICAgICAgcGFnZV9saXN0X2FkZF90YWlsKHBh
Z2UsICZkLT5hcmNoLnJlbG1lbV9saXN0KTsKLSAgICAgICAgfQotICAgIH0KLQotICAgIHNwaW5f
dW5sb2NrKCZkLT5wYWdlX2FsbG9jX2xvY2spOwotCi0gICAgaWYgKCAhcmMgKQotICAgICAgICAv
KgotICAgICAgICAgKiBmbHVzaF9mbGFncyBhcmUgbm90IHRyYWNrZWQgYWNyb3NzIGh5cGVyY2Fs
bCBwcmUtZW1wdGlvbiBzbwotICAgICAgICAgKiBhc3N1bWUgYSBmdWxsIGZsdXNoIGlzIG5lY2Vz
c2FyeS4KLSAgICAgICAgICovCi0gICAgICAgIHJjID0gaW9tbXVfaW90bGJfZmx1c2hfYWxsKAot
ICAgICAgICAgICAgZCwgSU9NTVVfRkxVU0hGX2FkZGVkIHwgSU9NTVVfRkxVU0hGX21vZGlmaWVk
KTsKLQotICAgIGlmICggcmMgJiYgcmMgIT0gLUVSRVNUQVJUICkKLSAgICAgICAgaW9tbXVfdGVh
cmRvd24oZCk7Ci0KLSAgICByZXR1cm4gcmM7Ci19Ci0KIHZvaWQgX19od2RvbV9pbml0IGFyY2hf
aW9tbXVfY2hlY2tfYXV0b3RyYW5zbGF0ZWRfaHdkb20oc3RydWN0IGRvbWFpbiAqZCkKIHsKICAg
ICBpZiAoICFpc19pb21tdV9lbmFibGVkKGQpICkKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL2Fz
bS1hcm0vaW9tbXUuaCBiL3hlbi9pbmNsdWRlL2FzbS1hcm0vaW9tbXUuaAppbmRleCA5MDRjOWFl
YzExLi4xNTc3ZTgzZDJiIDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS9hc20tYXJtL2lvbW11LmgK
KysrIGIveGVuL2luY2x1ZGUvYXNtLWFybS9pb21tdS5oCkBAIC0yMSw3ICsyMSw3IEBAIHN0cnVj
dCBhcmNoX2lvbW11CiB9OwogCiAvKiBBbHdheXMgc2hhcmUgUDJNIFRhYmxlIGJldHdlZW4gdGhl
IENQVSBhbmQgdGhlIElPTU1VICovCi0jZGVmaW5lIGlvbW11X3VzZV9oYXBfcHQoZCkgKGhhc19p
b21tdV9wdChkKSkKKyNkZWZpbmUgaW9tbXVfdXNlX2hhcF9wdChkKSBpc19pb21tdV9lbmFibGVk
KGQpCiAKIGNvbnN0IHN0cnVjdCBpb21tdV9vcHMgKmlvbW11X2dldF9vcHModm9pZCk7CiB2b2lk
IGlvbW11X3NldF9vcHMoY29uc3Qgc3RydWN0IGlvbW11X29wcyAqb3BzKTsKZGlmZiAtLWdpdCBh
L3hlbi9pbmNsdWRlL2FzbS14ODYvaW9tbXUuaCBiL3hlbi9pbmNsdWRlL2FzbS14ODYvaW9tbXUu
aAppbmRleCBkN2ZlMmRmNTFmLi5mNTJkNmY3NWVmIDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS9h
c20teDg2L2lvbW11LmgKKysrIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9pb21tdS5oCkBAIC05MCw3
ICs5MCw3IEBAIGV4dGVybiBjb25zdCBzdHJ1Y3QgaW9tbXVfaW5pdF9vcHMgKmlvbW11X2luaXRf
b3BzOwogCiAvKiBBcmUgd2UgdXNpbmcgdGhlIGRvbWFpbiBQMk0gdGFibGUgYXMgaXRzIElPTU1V
IHBhZ2V0YWJsZT8gKi8KICNkZWZpbmUgaW9tbXVfdXNlX2hhcF9wdChkKSBcCi0gICAgKGhhcF9l
bmFibGVkKGQpICYmIGhhc19pb21tdV9wdChkKSAmJiBpb21tdV9oYXBfcHRfc2hhcmUpCisgICAg
KGhhcF9lbmFibGVkKGQpICYmIGlzX2lvbW11X2VuYWJsZWQoZCkgJiYgaW9tbXVfaGFwX3B0X3No
YXJlKQogCiB2b2lkIGlvbW11X3VwZGF0ZV9pcmVfZnJvbV9hcGljKHVuc2lnbmVkIGludCBhcGlj
LCB1bnNpZ25lZCBpbnQgcmVnLCB1bnNpZ25lZCBpbnQgdmFsdWUpOwogdW5zaWduZWQgaW50IGlv
bW11X3JlYWRfYXBpY19mcm9tX2lyZSh1bnNpZ25lZCBpbnQgYXBpYywgdW5zaWduZWQgaW50IHJl
Zyk7CmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS94ZW4vaW9tbXUuaCBiL3hlbi9pbmNsdWRlL3hl
bi9pb21tdS5oCmluZGV4IDMxNGYyOGYzMjMuLjRiNjg3MTkzNmMgMTAwNjQ0Ci0tLSBhL3hlbi9p
bmNsdWRlL3hlbi9pb21tdS5oCisrKyBiL3hlbi9pbmNsdWRlL3hlbi9pb21tdS5oCkBAIC03Mywx
NSArNzMsOSBAQCB2b2lkIGlvbW11X2RvbWFpbl9kZXN0cm95KHN0cnVjdCBkb21haW4gKmQpOwog
CiB2b2lkIGFyY2hfaW9tbXVfZG9tYWluX2Rlc3Ryb3koc3RydWN0IGRvbWFpbiAqZCk7CiBpbnQg
YXJjaF9pb21tdV9kb21haW5faW5pdChzdHJ1Y3QgZG9tYWluICpkKTsKLWludCBhcmNoX2lvbW11
X3BvcHVsYXRlX3BhZ2VfdGFibGUoc3RydWN0IGRvbWFpbiAqZCk7CiB2b2lkIGFyY2hfaW9tbXVf
Y2hlY2tfYXV0b3RyYW5zbGF0ZWRfaHdkb20oc3RydWN0IGRvbWFpbiAqZCk7CiB2b2lkIGFyY2hf
aW9tbXVfaHdkb21faW5pdChzdHJ1Y3QgZG9tYWluICpkKTsKIAotaW50IGlvbW11X2NvbnN0cnVj
dChzdHJ1Y3QgZG9tYWluICpkKTsKLQotLyogRnVuY3Rpb24gdXNlZCBpbnRlcm5hbGx5LCB1c2Ug
aW9tbXVfZG9tYWluX2Rlc3Ryb3kgKi8KLXZvaWQgaW9tbXVfdGVhcmRvd24oc3RydWN0IGRvbWFp
biAqZCk7Ci0KIC8qCiAgKiBUaGUgZm9sbG93aW5nIGZsYWdzIGFyZSBwYXNzZWQgdG8gbWFwIG9w
ZXJhdGlvbnMgYW5kIHBhc3NlZCBieSBsb29rdXAKICAqIG9wZXJhdGlvbnMuCkBAIC0yNDgsMTMg
KzI0Miw2IEBAIHN0cnVjdCBpb21tdV9vcHMgewogIyBkZWZpbmUgaW9tbXVfdmNhbGwgaW9tbXVf
Y2FsbAogI2VuZGlmCiAKLWVudW0gaW9tbXVfc3RhdHVzCi17Ci0gICAgSU9NTVVfU1RBVFVTX2Rp
c2FibGVkLAotICAgIElPTU1VX1NUQVRVU19pbml0aWFsaXppbmcsCi0gICAgSU9NTVVfU1RBVFVT
X2luaXRpYWxpemVkCi19OwotCiBzdHJ1Y3QgZG9tYWluX2lvbW11IHsKICAgICBzdHJ1Y3QgYXJj
aF9pb21tdSBhcmNoOwogCkBAIC0yNjksOSArMjU2LDYgQEAgc3RydWN0IGRvbWFpbl9pb21tdSB7
CiAgICAgLyogRmVhdHVyZXMgc3VwcG9ydGVkIGJ5IHRoZSBJT01NVSAqLwogICAgIERFQ0xBUkVf
QklUTUFQKGZlYXR1cmVzLCBJT01NVV9GRUFUX2NvdW50KTsKIAotICAgIC8qIFN0YXR1cyBvZiBn
dWVzdCBJT01NVSBtYXBwaW5ncyAqLwotICAgIGVudW0gaW9tbXVfc3RhdHVzIHN0YXR1czsKLQog
ICAgIC8qCiAgICAgICogRG9lcyB0aGUgZ3Vlc3QgcmVxaXJlIG1hcHBpbmdzIHRvIGJlIHN5bmNo
b25pemVkLCB0byBtYWludGFpbgogICAgICAqIHRoZSBkZWZhdWx0IGRmbiA9PSBwZm4gbWFwLiAo
U2VlIGNvbW1lbnQgb24gZGZuIGF0IHRoZSB0b3Agb2YKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRl
L3hlbi9zY2hlZC5oIGIveGVuL2luY2x1ZGUveGVuL3NjaGVkLmgKaW5kZXggM2MwZGI0MmI4Mi4u
M2Y4YWQ1NjY1NSAxMDA2NDQKLS0tIGEveGVuL2luY2x1ZGUveGVuL3NjaGVkLmgKKysrIGIveGVu
L2luY2x1ZGUveGVuL3NjaGVkLmgKQEAgLTk2NiwxMCArOTY2LDggQEAgc3RhdGljIGlubGluZSBi
b29sIGlzX2h3ZG9tX3Bpbm5lZF92Y3B1KGNvbnN0IHN0cnVjdCB2Y3B1ICp2KQogfQogCiAjaWZk
ZWYgQ09ORklHX0hBU19QQVNTVEhST1VHSAotI2RlZmluZSBoYXNfaW9tbXVfcHQoZCkgKGRvbV9p
b21tdShkKS0+c3RhdHVzICE9IElPTU1VX1NUQVRVU19kaXNhYmxlZCkKICNkZWZpbmUgbmVlZF9p
b21tdV9wdF9zeW5jKGQpIChkb21faW9tbXUoZCktPm5lZWRfc3luYykKICNlbHNlCi0jZGVmaW5l
IGhhc19pb21tdV9wdChkKSBmYWxzZQogI2RlZmluZSBuZWVkX2lvbW11X3B0X3N5bmMoZCkgZmFs
c2UKICNlbmRpZgogCi0tIAoyLjIwLjEuMi5nYjIxZWJiNjcxCgoKX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4t
ZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9t
YWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

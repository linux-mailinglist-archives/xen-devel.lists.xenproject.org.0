Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 358667EBA26
	for <lists+xen-devel@lfdr.de>; Wed, 15 Nov 2023 00:12:40 +0100 (CET)
Received: from list by lists.xenproject.org with outflank-mailman.633381.988131 (Exim 4.92)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1r32Zo-0001gZ-Ru; Tue, 14 Nov 2023 23:12:12 +0000
X-Outflank-Mailman: Message body and most headers restored to incoming version
Received: by outflank-mailman (output) from mailman id 633381.988131; Tue, 14 Nov 2023 23:12:12 +0000
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.92)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1r32Zo-0001eQ-P6; Tue, 14 Nov 2023 23:12:12 +0000
Received: by outflank-mailman (input) for mailman id 633381;
 Tue, 14 Nov 2023 23:12:11 +0000
Received: from se1-gles-sth1-in.inumbo.com ([159.253.27.254]
 helo=se1-gles-sth1.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.92) (envelope-from
 <SRS0=MjOU=G3=gmail.com=marietto2008@srs-se1.protection.inumbo.net>)
 id 1r32Zn-0001eK-Iu
 for xen-devel@lists.xenproject.org; Tue, 14 Nov 2023 23:12:11 +0000
Received: from mail-lf1-x131.google.com (mail-lf1-x131.google.com
 [2a00:1450:4864:20::131])
 by se1-gles-sth1.inumbo.com (Halon) with ESMTPS
 id 3ccac628-8343-11ee-98db-6d05b1d4d9a1;
 Wed, 15 Nov 2023 00:12:10 +0100 (CET)
Received: by mail-lf1-x131.google.com with SMTP id
 2adb3069b0e04-507f1c29f25so8431134e87.1
 for <xen-devel@lists.xenproject.org>; Tue, 14 Nov 2023 15:12:10 -0800 (PST)
X-BeenThere: xen-devel@lists.xenproject.org
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Errors-To: xen-devel-bounces@lists.xenproject.org
Precedence: list
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>
X-Inumbo-ID: 3ccac628-8343-11ee-98db-6d05b1d4d9a1
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20230601; t=1700003530; x=1700608330; darn=lists.xenproject.org;
        h=cc:to:subject:message-id:date:from:in-reply-to:references
         :mime-version:from:to:cc:subject:date:message-id:reply-to;
        bh=Zb5px6Yc2dJp0UHMwF+/aR8HVP38rStjyqhUXgOqtVU=;
        b=RvESYQWoxMHnmS72Tvyjngd5no0a17wKNYQQGCf6Mcf0rIa2jPmYanu1I2MqXHo2w6
         Zdt5pQG/Jb1ng8S4Ed492OFwh7pxTn+KtYb/+yBwnNQxmZklX17WufRy9+LQN69VaqEJ
         vvMedOq+JhJnNTjrBXCKse8lLuzSszSeB9wD/R4eRsu0Skia3/cWkH4arn7RJ5+kla6g
         PDeZ34DJeyoquHrDizVF8ut22unr9XLkVuhFEXdZnw+tV4e2rjzVFWaS9zH/iedwT6lq
         e5RlQYluBpxBnUAzbXX99l5/5aX9JldEKRlBKw5c9JXKNHkL2rsS2sHQhBXySKZ5W5in
         atmw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1700003530; x=1700608330;
        h=cc:to:subject:message-id:date:from:in-reply-to:references
         :mime-version:x-gm-message-state:from:to:cc:subject:date:message-id
         :reply-to;
        bh=Zb5px6Yc2dJp0UHMwF+/aR8HVP38rStjyqhUXgOqtVU=;
        b=VnsA0dSY1jGAt2VowDR43LiYHnDPYnMFKzqTWNx0aYbIuuJFGUTPmx/w+65J8ZOc74
         XjhY0KwMmANbZLEfx84hd3rd9yfhz0xh8wlHnhs8X0VTD4zw+g9Seb8X00gZyQ1MTPZ9
         XGnZBjj9IpUCesX8myt2FWXGFF2MwRbONuXiPjOArrzcgh2EY5iBqj5Qx5N2OE2oxDQR
         pDG6PH0ZfYEFQ9zc654TtEZ4sv4gPgVY011i/DnMyJxvb/14aMyEpS0uhTNYXV4QmxGA
         XWQCav2XiKIPn5WysClhEhxwWIhaJwSJQABvXb9EOGO8LWBDXl8a1eqIgQZHZlfBHkH2
         DACA==
X-Gm-Message-State: AOJu0Yw7Zbr5/X8XlgRrIRUOSGukj/iQxDx1au40pG74SFgqj3slzPgh
	4GJP3MkqafmO1yfhOtVv0YTGHsKanRCVjOU8R3Y=
X-Google-Smtp-Source: AGHT+IHMXxPM4pyne0InpjCZ6q9Sv2WOBgjHzvPYclQoWlap4Bsr1UjU3YDnZWFodBWlrol97yeBnKCStp6cE+vDllQ=
X-Received: by 2002:a19:5f0d:0:b0:506:8b22:bac2 with SMTP id
 t13-20020a195f0d000000b005068b22bac2mr6842971lfb.4.1700003529265; Tue, 14 Nov
 2023 15:12:09 -0800 (PST)
MIME-Version: 1.0
References: <CA+1FSiiq9Z2sWq9R=7wEA0=LCavohupBedJOVnGrCHGiMZhR=A@mail.gmail.com>
 <alpine.DEB.2.22.394.2311141445120.160649@ubuntu-linux-20-04-desktop>
In-Reply-To: <alpine.DEB.2.22.394.2311141445120.160649@ubuntu-linux-20-04-desktop>
From: Mario Marietto <marietto2008@gmail.com>
Date: Wed, 15 Nov 2023 00:11:33 +0100
Message-ID: <CA+1FSijk1gVZ2OZC=UCWQzUed2Ve5Nu5CagSTAnHPGf0hBRy-A@mail.gmail.com>
Subject: Re: Values generated by the ViryaOS uboot-script-gen do not work
 correctly on the Chromebook Snow
To: Stefano Stabellini <sstabellini@kernel.org>
Cc: =?UTF-8?Q?Marek_Marczykowski=2DG=C3=B3recki?= <marmarek@invisiblethingslab.com>, 
	Chuck Zmudzinski <brchuckz@netscape.net>, Julien Grall <julien@xen.org>, 
	Bertrand Marquis <bertrand.marquis@arm.com>, xen-devel <xen-devel@lists.xenproject.org>
Content-Type: multipart/alternative; boundary="0000000000007a995e060a24ea2c"

--0000000000007a995e060a24ea2c
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

---> uboot-script-gen assumes that the memory range specified by
MEMORY_START-MEMORY_END is valid and correct.

Actually Chuck chose 0 as MEMORY_START and 0x800000 as MEMORY_END and these
are stable values,they don't change. If you ask me to calculate those
values,it means that we need to compute these values. I imagine that to
calculate these values is not easy.

---> To debug this kind of issues please post the size of all the binaries
specified in the imagebuilder config file

I imagine that I should also calculate those values. And again,I see a
complication.

I'm realizing that the method used by Chuck is easier because he uses
stable values. In the end,there aren't any calculations to do and since I'm
looking for an easier method,not a more complicated one,I think that
Chuck's method is good as is.

On Tue, Nov 14, 2023 at 11:51=E2=80=AFPM Stefano Stabellini <sstabellini@ke=
rnel.org>
wrote:

> Hi Mario,
>
> It is difficult to know how to change uboot-script-gen if we don't know
> why it is currently going wrong.
>
> uboot-script-gen assumes that the memory range specified by
> MEMORY_START-MEMORY_END is valid and correct.
>
> So if you specified a valid and correct memory range in your config file
> (0x41e00000-0x60000000) why is it failing?
>
> The only thing uboot-script-gen does is choosing aligned addresses
> within the MEMORY_START-MEMORY_END range. The addresses are supposed not
> to overlap (meaning the initrd will not overwrite part of the kernel
> when loaded). If the issue is a bug in uboot-script-gen, such as the
> generated addresses overlap or they are not aligned, then we can fix the
> alignment or overlap bug. To debug this kind of issues please post:
> - the imagebuilder config file
> - the generate boot.source script
> - the size of all the binaries specified in the imagebuilder config file
>
> On the other hand if 0x41e00000-0x60000000 is not a safe memory range to
> use, then you need to specify a different memory range.
>
> Cheers,
>
> Stefano
>
>
>
> On Mon, 13 Nov 2023, Mario Marietto wrote:
> > Hello.
> >
> > I'm trying to find an easier way to the problem that you can read here =
:
> >
> >
> https://github.com/mobile-virt/u-boot-chromebook-xe303c12/tree/chromebook=
/xen#starting-a-domu-guest
> >
> > where Chuck says :
> >
> >  6. Create the u-boot shell commands that will be used to boot Xen and
> dom0.
> >
> > Create a file in /home/user (or any other directory) named
> bootxen.source with these contents :
> >
> >
> > mmc dev 1 && mmc rescan 1
> > ext2load mmc 1:3 0x42000000 zImage-6.1.61-stb-xen-cbe+
> > ext2load mmc 1:3 0x51000000 xen-4.17-armhf-armmp-0x51004000.ub
> > ext2load mmc 1:3 0x5ffec000 exynos5250-snow-6.1.61-stb-xen-cbe+.dtb
> > fdt addr 0x5ffec000
> > fdt resize 1024
> > fdt set /chosen \#address-cells <0x2>
> > fdt set /chosen \#size-cells <0x2>
> > fdt set /chosen xen,xen-bootargs "console=3Ddtuart dtuart=3Dserial0
> dom0_mem=3D1G dom0_max_vcpus=3D2 bootscrub=3D0 vwfi=3Dnative"
> > fdt mknod /chosen dom0
> > fdt set /chosen/dom0 compatible  "xen,linux-zimage"
> "xen,multiboot-module" "multiboot,module"
> > fdt set /chosen/dom0 reg <0x0 0x42000000 0x0 0x7D7200 >
> > fdt set /chosen xen,dom0-bootargs "console=3Dtty1 root=3D/dev/mmcblk1p4=
 rw
> rootwait clk_ignore_unused"
> > bootm 0x51000000 - 0x5ffec000
> >
> > The hex value 0x7D7200 is the size of the zImage-6.1.61-stb-xen-cbe+
> file, and that value is computed from the uboot-script-gen script
> > available from here :
> >
> >
> > https://gitlab.com/ViryaOS/imagebuilder
> >
> >
> > This is the interesting point :
> >
> >
> > Please note that most of the other values in the script generated by th=
e
> ViryaOS uboot-script-gen do not work correctly with the Chromebook
> > Snow, but the script does correctly calculate the size of the dom0 Linu=
x
> kernel image.
> >
> >
> > Some time ago Stefano suggested to put the values below for MEMORY_STAR=
T
> and MEMORY_END inside the xen-config file :
> >
> >
> > nano xen-config file :
> >
> >
> > MEMORY_START=3D"0x41e00000"
> > MEMORY_END=3D"0x60000000"
> > LOAD_CMD=3D"ext2load mmc 1:3"
> > BOOT_CMD=3D"bootm"
> > DEVICE_TREE=3D"exynos5250-snow.dtb"
> > XEN=3D"xen-4.17-armhf"
> > XEN_CMD=3D"console=3Ddtuart dtuart=3Dserial0 dom0_mem=3D768M dom0_max_v=
cpus=3D2
> bootscrub=3D0 vwfi=3Dnative sched=3Dnull"
> > DOM0_KERNEL=3D"zImage-6.6.0-xen-dma-mapping"
> > DOM0_CMD=3D"console=3Dtty earlycon=3Dxen earlyprintk=3Dxen root=3D/dev/=
mmcblk1p4
> rw rootwait clk_ignore_unused"
> > UBOOT_SOURCE=3D"xen.source"
> >
> >
> > bash ./uboot-script-gen -c xen-config -d .
> >
> >
> > Image Name:
> > Created:      Thu Nov  2 20:59:24 2023
> > Image Type:   ARM Linux Kernel Image (uncompressed)
> > Data Size:    884744 Bytes =3D 864.01 KiB =3D 0.84 MiB
> > Load Address: 42c00000
> > Entry Point:  42c00000
> >
> >
> > Generated uboot script xen.scr, to be loaded at address 0x42000000:
> > ext2load mmc 1:3 0x42000000 xen.scr; source 0x42000000
> >
> >
> > and I tried to boot Xen and Linux 6.6 as dom0 :
> >
> > SMDK5250 # mmc dev 1
> > SMDK5250 # ext2load mmc 1:3 0x42000000 xen.scr; source 0x42000000
> > but it did not work : it reboots on the verification screen.
> >
> > --
> > Mario.
> >
> >



--=20
Mario.

--0000000000007a995e060a24ea2c
Content-Type: text/html; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr"><div>---&gt; uboot-script-gen assumes that the memory rang=
e specified by MEMORY_START-MEMORY_END is valid and correct.</div><div><br>=
</div><div>Actually Chuck chose 0 as MEMORY_START and 0x800000 as MEMORY_EN=
D and these are stable values,they don&#39;t change. If you ask me to calcu=
late those values,it means that we need to compute these values. I imagine =
that to calculate these values is not easy. <br></div><div><br></div><div>-=
--&gt; To debug this kind of issues please post the size of all the binarie=
s specified in the imagebuilder config file</div><div><br></div><div>I imag=
ine that I should also calculate those values. And again,I see a complicati=
on. <br></div><div><br></div><div>I&#39;m realizing that the method used by=
 Chuck is easier because he uses stable values. In the end,there aren&#39;t=
 any calculations to do and since I&#39;m looking for an easier method,not =
a more complicated one,I think that Chuck&#39;s method is good as is.=C2=A0=
 </div></div><br><div class=3D"gmail_quote"><div dir=3D"ltr" class=3D"gmail=
_attr">On Tue, Nov 14, 2023 at 11:51=E2=80=AFPM Stefano Stabellini &lt;<a h=
ref=3D"mailto:sstabellini@kernel.org">sstabellini@kernel.org</a>&gt; wrote:=
<br></div><blockquote class=3D"gmail_quote" style=3D"margin:0px 0px 0px 0.8=
ex;border-left:1px solid rgb(204,204,204);padding-left:1ex">Hi Mario,<br>
<br>
It is difficult to know how to change uboot-script-gen if we don&#39;t know=
<br>
why it is currently going wrong.<br>
<br>
uboot-script-gen assumes that the memory range specified by<br>
MEMORY_START-MEMORY_END is valid and correct.<br>
<br>
So if you specified a valid and correct memory range in your config file<br=
>
(0x41e00000-0x60000000) why is it failing?<br>
<br>
The only thing uboot-script-gen does is choosing aligned addresses<br>
within the MEMORY_START-MEMORY_END range. The addresses are supposed not<br=
>
to overlap (meaning the initrd will not overwrite part of the kernel<br>
when loaded). If the issue is a bug in uboot-script-gen, such as the<br>
generated addresses overlap or they are not aligned, then we can fix the<br=
>
alignment or overlap bug. To debug this kind of issues please post:<br>
- the imagebuilder config file<br>
- the generate boot.source script<br>
- the size of all the binaries specified in the imagebuilder config file<br=
>
<br>
On the other hand if 0x41e00000-0x60000000 is not a safe memory range to<br=
>
use, then you need to specify a different memory range.<br>
<br>
Cheers,<br>
<br>
Stefano<br>
<br>
<br>
<br>
On Mon, 13 Nov 2023, Mario Marietto wrote:<br>
&gt; Hello.<br>
&gt; <br>
&gt; I&#39;m trying to find an easier way to the problem that you can read =
here :<br>
&gt; <br>
&gt; <a href=3D"https://github.com/mobile-virt/u-boot-chromebook-xe303c12/t=
ree/chromebook/xen#starting-a-domu-guest" rel=3D"noreferrer" target=3D"_bla=
nk">https://github.com/mobile-virt/u-boot-chromebook-xe303c12/tree/chromebo=
ok/xen#starting-a-domu-guest</a><br>
&gt; <br>
&gt; where Chuck says :<br>
&gt; <br>
&gt;=C2=A0 6. Create the u-boot shell commands that will be used to boot Xe=
n and dom0.<br>
&gt; <br>
&gt; Create a file in /home/user (or any other directory) named bootxen.sou=
rce with these contents :<br>
&gt; <br>
&gt; <br>
&gt; mmc dev 1 &amp;&amp; mmc rescan 1<br>
&gt; ext2load mmc 1:3 0x42000000 zImage-6.1.61-stb-xen-cbe+<br>
&gt; ext2load mmc 1:3 0x51000000 xen-4.17-armhf-armmp-0x51004000.ub<br>
&gt; ext2load mmc 1:3 0x5ffec000 exynos5250-snow-6.1.61-stb-xen-cbe+.dtb<br=
>
&gt; fdt addr 0x5ffec000<br>
&gt; fdt resize 1024<br>
&gt; fdt set /chosen \#address-cells &lt;0x2&gt;<br>
&gt; fdt set /chosen \#size-cells &lt;0x2&gt;<br>
&gt; fdt set /chosen xen,xen-bootargs &quot;console=3Ddtuart dtuart=3Dseria=
l0 dom0_mem=3D1G dom0_max_vcpus=3D2 bootscrub=3D0 vwfi=3Dnative&quot;<br>
&gt; fdt mknod /chosen dom0<br>
&gt; fdt set /chosen/dom0 compatible=C2=A0 &quot;xen,linux-zimage&quot; &qu=
ot;xen,multiboot-module&quot; &quot;multiboot,module&quot;<br>
&gt; fdt set /chosen/dom0 reg &lt;0x0 0x42000000 0x0 0x7D7200 &gt;<br>
&gt; fdt set /chosen xen,dom0-bootargs &quot;console=3Dtty1 root=3D/dev/mmc=
blk1p4 rw rootwait clk_ignore_unused&quot;<br>
&gt; bootm 0x51000000 - 0x5ffec000<br>
&gt; <br>
&gt; The hex value 0x7D7200 is the size of the zImage-6.1.61-stb-xen-cbe+ f=
ile, and that value is computed from the uboot-script-gen script<br>
&gt; available from here :<br>
&gt; <br>
&gt; <br>
&gt; <a href=3D"https://gitlab.com/ViryaOS/imagebuilder" rel=3D"noreferrer"=
 target=3D"_blank">https://gitlab.com/ViryaOS/imagebuilder</a><br>
&gt; <br>
&gt; <br>
&gt; This is the interesting point :<br>
&gt; <br>
&gt; <br>
&gt; Please note that most of the other values in the script generated by t=
he ViryaOS uboot-script-gen do not work correctly with the Chromebook<br>
&gt; Snow, but the script does correctly calculate the size of the dom0 Lin=
ux kernel image.<br>
&gt; <br>
&gt; <br>
&gt; Some time ago Stefano suggested to put the values below for MEMORY_STA=
RT and MEMORY_END inside the xen-config file :<br>
&gt; <br>
&gt; <br>
&gt; nano xen-config file :<br>
&gt; <br>
&gt; <br>
&gt; MEMORY_START=3D&quot;0x41e00000&quot;<br>
&gt; MEMORY_END=3D&quot;0x60000000&quot;<br>
&gt; LOAD_CMD=3D&quot;ext2load mmc 1:3&quot;<br>
&gt; BOOT_CMD=3D&quot;bootm&quot;<br>
&gt; DEVICE_TREE=3D&quot;exynos5250-snow.dtb&quot;<br>
&gt; XEN=3D&quot;xen-4.17-armhf&quot;<br>
&gt; XEN_CMD=3D&quot;console=3Ddtuart dtuart=3Dserial0 dom0_mem=3D768M dom0=
_max_vcpus=3D2 bootscrub=3D0 vwfi=3Dnative sched=3Dnull&quot;<br>
&gt; DOM0_KERNEL=3D&quot;zImage-6.6.0-xen-dma-mapping&quot;<br>
&gt; DOM0_CMD=3D&quot;console=3Dtty earlycon=3Dxen earlyprintk=3Dxen root=
=3D/dev/mmcblk1p4 rw rootwait clk_ignore_unused&quot;<br>
&gt; UBOOT_SOURCE=3D&quot;xen.source&quot;<br>
&gt; <br>
&gt; <br>
&gt; bash ./uboot-script-gen -c xen-config -d .<br>
&gt; <br>
&gt; <br>
&gt; Image Name: =C2=A0=C2=A0=C2=A0<br>
&gt; Created: =C2=A0=C2=A0=C2=A0=C2=A0=C2=A0Thu Nov =C2=A02 20:59:24 2023<b=
r>
&gt; Image Type: =C2=A0=C2=A0ARM Linux Kernel Image (uncompressed)<br>
&gt; Data Size: =C2=A0=C2=A0=C2=A0884744 Bytes =3D 864.01 KiB =3D 0.84 MiB<=
br>
&gt; Load Address: 42c00000<br>
&gt; Entry Point: =C2=A042c00000<br>
&gt; <br>
&gt; <br>
&gt; Generated uboot script xen.scr, to be loaded at address 0x42000000:<br=
>
&gt; ext2load mmc 1:3 0x42000000 xen.scr; source 0x42000000<br>
&gt; <br>
&gt; <br>
&gt; and I tried to boot Xen and Linux 6.6 as dom0 :<br>
&gt; <br>
&gt; SMDK5250 # mmc dev 1<br>
&gt; SMDK5250 # ext2load mmc 1:3 0x42000000 xen.scr; source 0x42000000<br>
&gt; but it did not work : it reboots on the verification screen.<br>
&gt; <br>
&gt; --<br>
&gt; Mario.<br>
&gt; <br>
&gt; </blockquote></div><br clear=3D"all"><br><span class=3D"gmail_signatur=
e_prefix">-- </span><br><div dir=3D"ltr" class=3D"gmail_signature">Mario.<b=
r></div>

--0000000000007a995e060a24ea2c--


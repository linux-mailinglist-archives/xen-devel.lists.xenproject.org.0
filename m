Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 8517190264
	for <lists+xen-devel@lfdr.de>; Fri, 16 Aug 2019 15:03:33 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hybqf-000764-Jv; Fri, 16 Aug 2019 13:00:53 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=5/9Y=WM=bombadil.srs.infradead.org=batv+66fbed4ec5b4f711ea06+5836+infradead.org+hch@srs-us1.protection.inumbo.net>)
 id 1hybqd-00074u-Nh
 for xen-devel@lists.xenproject.org; Fri, 16 Aug 2019 13:00:51 +0000
X-Inumbo-ID: df427164-c025-11e9-aee9-bc764e2007e4
Received: from bombadil.infradead.org (unknown [2607:7c80:54:e::133])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id df427164-c025-11e9-aee9-bc764e2007e4;
 Fri, 16 Aug 2019 13:00:50 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
 d=infradead.org; s=bombadil.20170209; h=Content-Transfer-Encoding:
 MIME-Version:References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:Sender
 :Reply-To:Content-Type:Content-ID:Content-Description:Resent-Date:Resent-From
 :Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:List-Id:List-Help:
 List-Unsubscribe:List-Subscribe:List-Post:List-Owner:List-Archive;
 bh=89q9oKs7bTpug2tToqaA0l6h36yL6pfvGuRA8FECJYw=; b=FCthpspjCHwX2f4UlZCW8ouqBW
 d9RBUcc/QcU6M7eHwl6OWoAXxN8n869021V3DAJE4PgYKGfsBx8d/3eXc0QNNRLqB1G3agnVbqcO+
 yQ7m43PljjdRfql1nE0IKddTipHyRw90zsloFVBEEvMrweKQxD/AJgW1YXMhwt0cgunQJhGwwO/Te
 NTPp5a8AVU58kwptTt3lDN/DRI9jmruu7sSvVJAIs2uYG+yEK6XYnr9tVeCB2ZsKB1hWwHX7v6pc8
 xConKWBkHATedJRRop0617gKdXp66s7c4Ix2l0iC/khModnBUVgkv9X9npKymuLFDsbsX1JxBEG3y
 8MEtPVAA==;
Received: from [91.112.187.46] (helo=localhost)
 by bombadil.infradead.org with esmtpsa (Exim 4.92 #3 (Red Hat Linux))
 id 1hybqa-0006ck-1f; Fri, 16 Aug 2019 13:00:48 +0000
From: Christoph Hellwig <hch@lst.de>
To: Stefano Stabellini <sstabellini@kernel.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
Date: Fri, 16 Aug 2019 15:00:11 +0200
Message-Id: <20190816130013.31154-10-hch@lst.de>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190816130013.31154-1-hch@lst.de>
References: <20190816130013.31154-1-hch@lst.de>
MIME-Version: 1.0
X-SRS-Rewrite: SMTP reverse-path rewritten from <hch@infradead.org> by
 bombadil.infradead.org. See http://www.infradead.org/rpr.html
Subject: [Xen-devel] [PATCH 09/11] swiotlb-xen: simplify cache maintainance
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: xen-devel@lists.xenproject.org, iommu@lists.linux-foundation.org,
 x86@kernel.org, linux-kernel@vger.kernel.org,
 linux-arm-kernel@lists.infradead.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

Tm93IHRoYXQgd2Uga25vdyB3ZSBhbHdheXMgaGF2ZSB0aGUgZG1hLW5vbmNvaGVyZW50LmggaGVs
cGVycyBhdmFpbGFibGUKaWYgd2UgYXJlIG9uIGFuIGFyY2hpdGVjdHVyZSB3aXRoIHN1cHBvcnQg
Zm9yIG5vbi1jb2hlcmVudCBkZXZpY2VzLAp3ZSBjYW4ganVzdCBjYWxsIHRoZW0gZGlyZWN0bHks
IGFuZCByZW1vdmUgdGhlIGNhbGxzIHRvIHRoZSBkbWEtZGlyZWN0CnJvdXRpbmVzLCBpbmNsdWRp
bmcgdGhlIGZhY3QgdGhhdCB3ZSBjYWxsIHRoZSBkbWFfZGlyZWN0X21hcF9wYWdlCnJvdXRpbmVz
IGJ1dCBpZ25vcmUgdGhlIHZhbHVlIHJldHVybmVkIGZyb20gaXQuICBJbnN0ZWFkIHdlIG5vdyBo
YXZlClhlbiB3cmFwcGVycyBmb3IgdGhlIGFyY2hfc3luY19kbWFfZm9yX3tkZXZpY2UsY3B1fSBo
ZWxwZXJzIHRoYXQgY2FsbAp0aGUgc3BlY2lhbCBYZW4gdmVyc2lvbnMgb2YgdGhvc2Ugcm91dGlu
ZXMgZm9yIGZvcmVpZ24gcGFnZXMuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpc3RvcGggSGVsbHdpZyA8
aGNoQGxzdC5kZT4KLS0tCiBhcmNoL2FybS94ZW4vbW0uYyAgICAgICAgICAgfCAgNDcgKystLS0t
LS0tLS0tLS0tLS0KIGRyaXZlcnMveGVuL3N3aW90bGIteGVuLmMgICB8ICAxOSArKysrLS0tCiBp
bmNsdWRlL3hlbi9wYWdlLWNvaGVyZW50LmggfCAxMDAgKysrKysrKysrKystLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tCiAzIGZpbGVzIGNoYW5nZWQsIDQyIGluc2VydGlvbnMoKyksIDEyNCBkZWxl
dGlvbnMoLSkKCmRpZmYgLS1naXQgYS9hcmNoL2FybS94ZW4vbW0uYyBiL2FyY2gvYXJtL3hlbi9t
bS5jCmluZGV4IDg1NDgyY2RkYTFlNS4uMGViODhmMTM1NWMyIDEwMDY0NAotLS0gYS9hcmNoL2Fy
bS94ZW4vbW0uYworKysgYi9hcmNoL2FybS94ZW4vbW0uYwpAQCAtODYsNTkgKzg2LDE4IEBAIHN0
YXRpYyB2b2lkIGRtYV9jYWNoZV9tYWludChkbWFfYWRkcl90IGhhbmRsZSwgc2l6ZV90IHNpemUs
CiAJfSB3aGlsZSAobGVmdCk7CiB9CiAKLXN0YXRpYyB2b2lkIF9feGVuX2RtYV9wYWdlX2Rldl90
b19jcHUoc3RydWN0IGRldmljZSAqaHdkZXYsIGRtYV9hZGRyX3QgaGFuZGxlLAotCQlzaXplX3Qg
c2l6ZSwgZW51bSBkbWFfZGF0YV9kaXJlY3Rpb24gZGlyKQordm9pZCBfX3hlbl9kbWFfc3luY19m
b3JfY3B1KHN0cnVjdCBkZXZpY2UgKmRldiwgZG1hX2FkZHJfdCBoYW5kbGUsIHNpemVfdCBzaXpl
LAorCQllbnVtIGRtYV9kYXRhX2RpcmVjdGlvbiBkaXIpCiB7CiAJZG1hX2NhY2hlX21haW50KGhh
bmRsZSwgc2l6ZSwgZGlyLCBETUFfVU5NQVApOwogfQogCi1zdGF0aWMgdm9pZCBfX3hlbl9kbWFf
cGFnZV9jcHVfdG9fZGV2KHN0cnVjdCBkZXZpY2UgKmh3ZGV2LCBkbWFfYWRkcl90IGhhbmRsZSwK
K3ZvaWQgX194ZW5fZG1hX3N5bmNfZm9yX2RldmljZShzdHJ1Y3QgZGV2aWNlICpkZXYsIGRtYV9h
ZGRyX3QgaGFuZGxlLAogCQlzaXplX3Qgc2l6ZSwgZW51bSBkbWFfZGF0YV9kaXJlY3Rpb24gZGly
KQogewogCWRtYV9jYWNoZV9tYWludChoYW5kbGUsIHNpemUsIGRpciwgRE1BX01BUCk7CiB9CiAK
LXZvaWQgX194ZW5fZG1hX21hcF9wYWdlKHN0cnVjdCBkZXZpY2UgKmh3ZGV2LCBzdHJ1Y3QgcGFn
ZSAqcGFnZSwKLQkgICAgIGRtYV9hZGRyX3QgZGV2X2FkZHIsIHVuc2lnbmVkIGxvbmcgb2Zmc2V0
LCBzaXplX3Qgc2l6ZSwKLQkgICAgIGVudW0gZG1hX2RhdGFfZGlyZWN0aW9uIGRpciwgdW5zaWdu
ZWQgbG9uZyBhdHRycykKLXsKLQlpZiAoZGV2X2lzX2RtYV9jb2hlcmVudChod2RldikpCi0JCXJl
dHVybjsKLQlpZiAoYXR0cnMgJiBETUFfQVRUUl9TS0lQX0NQVV9TWU5DKQotCQlyZXR1cm47Ci0K
LQlfX3hlbl9kbWFfcGFnZV9jcHVfdG9fZGV2KGh3ZGV2LCBkZXZfYWRkciwgc2l6ZSwgZGlyKTsK
LX0KLQotdm9pZCBfX3hlbl9kbWFfdW5tYXBfcGFnZShzdHJ1Y3QgZGV2aWNlICpod2RldiwgZG1h
X2FkZHJfdCBoYW5kbGUsCi0JCXNpemVfdCBzaXplLCBlbnVtIGRtYV9kYXRhX2RpcmVjdGlvbiBk
aXIsCi0JCXVuc2lnbmVkIGxvbmcgYXR0cnMpCi0KLXsKLQlpZiAoZGV2X2lzX2RtYV9jb2hlcmVu
dChod2RldikpCi0JCXJldHVybjsKLQlpZiAoYXR0cnMgJiBETUFfQVRUUl9TS0lQX0NQVV9TWU5D
KQotCQlyZXR1cm47Ci0KLQlfX3hlbl9kbWFfcGFnZV9kZXZfdG9fY3B1KGh3ZGV2LCBoYW5kbGUs
IHNpemUsIGRpcik7Ci19Ci0KLXZvaWQgX194ZW5fZG1hX3N5bmNfc2luZ2xlX2Zvcl9jcHUoc3Ry
dWN0IGRldmljZSAqaHdkZXYsCi0JCWRtYV9hZGRyX3QgaGFuZGxlLCBzaXplX3Qgc2l6ZSwgZW51
bSBkbWFfZGF0YV9kaXJlY3Rpb24gZGlyKQotewotCWlmIChkZXZfaXNfZG1hX2NvaGVyZW50KGh3
ZGV2KSkKLQkJcmV0dXJuOwotCV9feGVuX2RtYV9wYWdlX2Rldl90b19jcHUoaHdkZXYsIGhhbmRs
ZSwgc2l6ZSwgZGlyKTsKLX0KLQotdm9pZCBfX3hlbl9kbWFfc3luY19zaW5nbGVfZm9yX2Rldmlj
ZShzdHJ1Y3QgZGV2aWNlICpod2RldiwKLQkJZG1hX2FkZHJfdCBoYW5kbGUsIHNpemVfdCBzaXpl
LCBlbnVtIGRtYV9kYXRhX2RpcmVjdGlvbiBkaXIpCi17Ci0JaWYgKGRldl9pc19kbWFfY29oZXJl
bnQoaHdkZXYpKQotCQlyZXR1cm47Ci0JX194ZW5fZG1hX3BhZ2VfY3B1X3RvX2Rldihod2Rldiwg
aGFuZGxlLCBzaXplLCBkaXIpOwotfQotCiBib29sIHhlbl9hcmNoX25lZWRfc3dpb3RsYihzdHJ1
Y3QgZGV2aWNlICpkZXYsCiAJCQkgICBwaHlzX2FkZHJfdCBwaHlzLAogCQkJICAgZG1hX2FkZHJf
dCBkZXZfYWRkcikKZGlmZiAtLWdpdCBhL2RyaXZlcnMveGVuL3N3aW90bGIteGVuLmMgYi9kcml2
ZXJzL3hlbi9zd2lvdGxiLXhlbi5jCmluZGV4IDdiMjM5Mjk4NTRlNy4uYzNjMzgzMDMzYWU0IDEw
MDY0NAotLS0gYS9kcml2ZXJzL3hlbi9zd2lvdGxiLXhlbi5jCisrKyBiL2RyaXZlcnMveGVuL3N3
aW90bGIteGVuLmMKQEAgLTM4OCw2ICszODgsNyBAQCBzdGF0aWMgZG1hX2FkZHJfdCB4ZW5fc3dp
b3RsYl9tYXBfcGFnZShzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0cnVjdCBwYWdlICpwYWdlLAogCWlm
IChtYXAgPT0gKHBoeXNfYWRkcl90KURNQV9NQVBQSU5HX0VSUk9SKQogCQlyZXR1cm4gRE1BX01B
UFBJTkdfRVJST1I7CiAKKwlwaHlzID0gbWFwOwogCWRldl9hZGRyID0geGVuX3BoeXNfdG9fYnVz
KG1hcCk7CiAKIAkvKgpAQCAtMzk5LDE0ICs0MDAsOSBAQCBzdGF0aWMgZG1hX2FkZHJfdCB4ZW5f
c3dpb3RsYl9tYXBfcGFnZShzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0cnVjdCBwYWdlICpwYWdlLAog
CQlyZXR1cm4gRE1BX01BUFBJTkdfRVJST1I7CiAJfQogCi0JcGFnZSA9IHBmbl90b19wYWdlKG1h
cCA+PiBQQUdFX1NISUZUKTsKLQlvZmZzZXQgPSBtYXAgJiB+UEFHRV9NQVNLOwogZG9uZToKLQkv
KgotCSAqIHdlIGFyZSBub3QgaW50ZXJlc3RlZCBpbiB0aGUgZG1hX2FkZHIgcmV0dXJuZWQgYnkg
eGVuX2RtYV9tYXBfcGFnZSwKLQkgKiBvbmx5IGluIHRoZSBwb3RlbnRpYWwgY2FjaGUgZmx1c2hl
cyBleGVjdXRlZCBieSB0aGUgZnVuY3Rpb24uCi0JICovCi0JeGVuX2RtYV9tYXBfcGFnZShkZXYs
IHBhZ2UsIGRldl9hZGRyLCBvZmZzZXQsIHNpemUsIGRpciwgYXR0cnMpOworCWlmICghZGV2X2lz
X2RtYV9jb2hlcmVudChkZXYpICYmICEoYXR0cnMgJiBETUFfQVRUUl9TS0lQX0NQVV9TWU5DKSkK
KwkJeGVuX2RtYV9zeW5jX2Zvcl9kZXZpY2UoZGV2LCBkZXZfYWRkciwgcGh5cywgc2l6ZSwgZGly
KTsKIAlyZXR1cm4gZGV2X2FkZHI7CiB9CiAKQEAgLTQyNiw3ICs0MjIsOCBAQCBzdGF0aWMgdm9p
ZCB4ZW5fdW5tYXBfc2luZ2xlKHN0cnVjdCBkZXZpY2UgKmh3ZGV2LCBkbWFfYWRkcl90IGRldl9h
ZGRyLAogCiAJQlVHX09OKGRpciA9PSBETUFfTk9ORSk7CiAKLQl4ZW5fZG1hX3VubWFwX3BhZ2Uo
aHdkZXYsIGRldl9hZGRyLCBzaXplLCBkaXIsIGF0dHJzKTsKKwlpZiAoIWRldl9pc19kbWFfY29o
ZXJlbnQoaHdkZXYpICYmICEoYXR0cnMgJiBETUFfQVRUUl9TS0lQX0NQVV9TWU5DKSkKKwkJeGVu
X2RtYV9zeW5jX2Zvcl9jcHUoaHdkZXYsIGRldl9hZGRyLCBwYWRkciwgc2l6ZSwgZGlyKTsKIAog
CS8qIE5PVEU6IFdlIHVzZSBkZXZfYWRkciBoZXJlLCBub3QgcGFkZHIhICovCiAJaWYgKGlzX3hl
bl9zd2lvdGxiX2J1ZmZlcihkZXZfYWRkcikpCkBAIC00NDYsNyArNDQzLDggQEAgeGVuX3N3aW90
bGJfc3luY19zaW5nbGVfZm9yX2NwdShzdHJ1Y3QgZGV2aWNlICpkZXYsIGRtYV9hZGRyX3QgZG1h
X2FkZHIsCiB7CiAJcGh5c19hZGRyX3QgcGFkZHIgPSB4ZW5fYnVzX3RvX3BoeXMoZG1hX2FkZHIp
OwogCi0JeGVuX2RtYV9zeW5jX3NpbmdsZV9mb3JfY3B1KGRldiwgZG1hX2FkZHIsIHNpemUsIGRp
cik7CisJaWYgKCFkZXZfaXNfZG1hX2NvaGVyZW50KGRldikpCisJCXhlbl9kbWFfc3luY19mb3Jf
Y3B1KGRldiwgZG1hX2FkZHIsIHBhZGRyLCBzaXplLCBkaXIpOwogCiAJaWYgKGlzX3hlbl9zd2lv
dGxiX2J1ZmZlcihkbWFfYWRkcikpCiAJCXN3aW90bGJfdGJsX3N5bmNfc2luZ2xlKGRldiwgcGFk
ZHIsIHNpemUsIGRpciwgU1lOQ19GT1JfQ1BVKTsKQEAgLTQ2MSw3ICs0NTksOCBAQCB4ZW5fc3dp
b3RsYl9zeW5jX3NpbmdsZV9mb3JfZGV2aWNlKHN0cnVjdCBkZXZpY2UgKmRldiwgZG1hX2FkZHJf
dCBkbWFfYWRkciwKIAlpZiAoaXNfeGVuX3N3aW90bGJfYnVmZmVyKGRtYV9hZGRyKSkKIAkJc3dp
b3RsYl90Ymxfc3luY19zaW5nbGUoZGV2LCBwYWRkciwgc2l6ZSwgZGlyLCBTWU5DX0ZPUl9ERVZJ
Q0UpOwogCi0JeGVuX2RtYV9zeW5jX3NpbmdsZV9mb3JfZGV2aWNlKGRldiwgZG1hX2FkZHIsIHNp
emUsIGRpcik7CisJaWYgKCFkZXZfaXNfZG1hX2NvaGVyZW50KGRldikpCisJCXhlbl9kbWFfc3lu
Y19mb3JfZGV2aWNlKGRldiwgZG1hX2FkZHIsIHBhZGRyLCBzaXplLCBkaXIpOwogfQogCiAvKgpk
aWZmIC0tZ2l0IGEvaW5jbHVkZS94ZW4vcGFnZS1jb2hlcmVudC5oIGIvaW5jbHVkZS94ZW4vcGFn
ZS1jb2hlcmVudC5oCmluZGV4IDBmNGQ0NjhlN2E4OS4uMzhiNTcyZWQwODc5IDEwMDY0NAotLS0g
YS9pbmNsdWRlL3hlbi9wYWdlLWNvaGVyZW50LmgKKysrIGIvaW5jbHVkZS94ZW4vcGFnZS1jb2hl
cmVudC5oCkBAIC0yLDg4ICsyLDQ4IEBACiAjaWZuZGVmIF9YRU5fUEFHRV9DT0hFUkVOVF9ICiAj
ZGVmaW5lIF9YRU5fUEFHRV9DT0hFUkVOVF9ICiAKLSNpbmNsdWRlIDxsaW51eC9kbWEtbWFwcGlu
Zy5oPgotI2luY2x1ZGUgPGFzbS9wYWdlLmg+CisjaW5jbHVkZSA8bGludXgvZG1hLW5vbmNvaGVy
ZW50Lmg+CiAKICNpZiBkZWZpbmVkKENPTkZJR19BUkNIX0hBU19TWU5DX0RNQV9GT1JfREVWSUNF
KSB8fCBcCiAgICAgZGVmaW5lZChDT05GSUdfQVJDSF9IQVNfU1lOQ19ETUFfRk9SX0NQVSkKLXZv
aWQgX194ZW5fZG1hX21hcF9wYWdlKHN0cnVjdCBkZXZpY2UgKmh3ZGV2LCBzdHJ1Y3QgcGFnZSAq
cGFnZSwKLQkgICAgIGRtYV9hZGRyX3QgZGV2X2FkZHIsIHVuc2lnbmVkIGxvbmcgb2Zmc2V0LCBz
aXplX3Qgc2l6ZSwKLQkgICAgIGVudW0gZG1hX2RhdGFfZGlyZWN0aW9uIGRpciwgdW5zaWduZWQg
bG9uZyBhdHRycyk7Ci12b2lkIF9feGVuX2RtYV91bm1hcF9wYWdlKHN0cnVjdCBkZXZpY2UgKmh3
ZGV2LCBkbWFfYWRkcl90IGhhbmRsZSwKLQkJc2l6ZV90IHNpemUsIGVudW0gZG1hX2RhdGFfZGly
ZWN0aW9uIGRpciwKLQkJdW5zaWduZWQgbG9uZyBhdHRycyk7Ci12b2lkIF9feGVuX2RtYV9zeW5j
X3NpbmdsZV9mb3JfY3B1KHN0cnVjdCBkZXZpY2UgKmh3ZGV2LAotCQlkbWFfYWRkcl90IGhhbmRs
ZSwgc2l6ZV90IHNpemUsIGVudW0gZG1hX2RhdGFfZGlyZWN0aW9uIGRpcik7Ci12b2lkIF9feGVu
X2RtYV9zeW5jX3NpbmdsZV9mb3JfZGV2aWNlKHN0cnVjdCBkZXZpY2UgKmh3ZGV2LAotCQlkbWFf
YWRkcl90IGhhbmRsZSwgc2l6ZV90IHNpemUsIGVudW0gZG1hX2RhdGFfZGlyZWN0aW9uIGRpcik7
Ci0KLXN0YXRpYyBpbmxpbmUgdm9pZCB4ZW5fZG1hX3N5bmNfc2luZ2xlX2Zvcl9jcHUoc3RydWN0
IGRldmljZSAqaHdkZXYsCi0JCWRtYV9hZGRyX3QgaGFuZGxlLCBzaXplX3Qgc2l6ZSwgZW51bSBk
bWFfZGF0YV9kaXJlY3Rpb24gZGlyKQotewotCXVuc2lnbmVkIGxvbmcgcGZuID0gUEZOX0RPV04o
aGFuZGxlKTsKLQotCWlmIChwZm5fdmFsaWQocGZuKSkKLQkJZG1hX2RpcmVjdF9zeW5jX3Npbmds
ZV9mb3JfY3B1KGh3ZGV2LCBoYW5kbGUsIHNpemUsIGRpcik7Ci0JZWxzZQotCQlfX3hlbl9kbWFf
c3luY19zaW5nbGVfZm9yX2NwdShod2RldiwgaGFuZGxlLCBzaXplLCBkaXIpOwotfQotCi1zdGF0
aWMgaW5saW5lIHZvaWQgeGVuX2RtYV9zeW5jX3NpbmdsZV9mb3JfZGV2aWNlKHN0cnVjdCBkZXZp
Y2UgKmh3ZGV2LAotCQlkbWFfYWRkcl90IGhhbmRsZSwgc2l6ZV90IHNpemUsIGVudW0gZG1hX2Rh
dGFfZGlyZWN0aW9uIGRpcikKLXsKLQl1bnNpZ25lZCBsb25nIHBmbiA9IFBGTl9ET1dOKGhhbmRs
ZSk7Ci0JaWYgKHBmbl92YWxpZChwZm4pKQotCQlkbWFfZGlyZWN0X3N5bmNfc2luZ2xlX2Zvcl9k
ZXZpY2UoaHdkZXYsIGhhbmRsZSwgc2l6ZSwgZGlyKTsKLQllbHNlCi0JCV9feGVuX2RtYV9zeW5j
X3NpbmdsZV9mb3JfZGV2aWNlKGh3ZGV2LCBoYW5kbGUsIHNpemUsIGRpcik7Ci19Ci0KLXN0YXRp
YyBpbmxpbmUgdm9pZCB4ZW5fZG1hX21hcF9wYWdlKHN0cnVjdCBkZXZpY2UgKmh3ZGV2LCBzdHJ1
Y3QgcGFnZSAqcGFnZSwKLQkgICAgIGRtYV9hZGRyX3QgZGV2X2FkZHIsIHVuc2lnbmVkIGxvbmcg
b2Zmc2V0LCBzaXplX3Qgc2l6ZSwKLQkgICAgIGVudW0gZG1hX2RhdGFfZGlyZWN0aW9uIGRpciwg
dW5zaWduZWQgbG9uZyBhdHRycykKLXsKLQl1bnNpZ25lZCBsb25nIHBmbiA9IFBGTl9ET1dOKGRl
dl9hZGRyKTsKLQotCWlmIChwZm5fdmFsaWQocGZuKSkKLQkJZG1hX2RpcmVjdF9tYXBfcGFnZSho
d2RldiwgcGFnZSwgb2Zmc2V0LCBzaXplLCBkaXIsIGF0dHJzKTsKKy8qCisgKiBEb20wIGlzIG1h
cHBlZCAxOjEsIHdoaWxlIHRoZSBMaW51eCBwYWdlIGNhbiBiZSBzcGFubmVkIGFjY3Jvc3MgbXVs
dGlwbGUgWGVuCisgKiBwYWdlcywgaXQncyBub3QgcG9zc2libGUgdG8gaGF2ZSBhIG1peCBvZiBs
b2NhbCBhbmQgZm9yZWlnbiBYZW4gcGFnZS4gIERvbTAKKyAqIGlzIG1hcHBlZCAxOjEsIHNvIGNh
bGxpbmcgcGZuX3ZhbGlkIG9uIGEgZm9yZWlnbiBtZm4gd2lsbCBhbHdheXMgcmV0dXJuCisgKiBm
YWxzZS4gIElmIHRoZSBwYWdlIGlzIGxvY2FsIHdlIGNhbiBzYWZlbHkgdXNlIHRoZSBuYXRpdmUg
cm91dGluZXMgZm9yIGNhY2hlCisgKiBtYWludGFpbmFuY2UsIG90aGVyd2lzZSB3ZSBjYWxsIHRo
ZSBYZW4gc3BlY2lmaWMgZnVuY3Rpb24uCisgKi8KK3ZvaWQgX194ZW5fZG1hX3N5bmNfZm9yX2Nw
dShzdHJ1Y3QgZGV2aWNlICpkZXYsIGRtYV9hZGRyX3QgaGFuZGxlLCBzaXplX3Qgc2l6ZSwKKwkJ
ZW51bSBkbWFfZGF0YV9kaXJlY3Rpb24gZGlyKTsKK3ZvaWQgX194ZW5fZG1hX3N5bmNfZm9yX2Rl
dmljZShzdHJ1Y3QgZGV2aWNlICpkZXYsIGRtYV9hZGRyX3QgaGFuZGxlLAorCQlzaXplX3Qgc2l6
ZSwgZW51bSBkbWFfZGF0YV9kaXJlY3Rpb24gZGlyKTsKKworc3RhdGljIGlubGluZSB2b2lkIHhl
bl9kbWFfc3luY19mb3JfY3B1KHN0cnVjdCBkZXZpY2UgKmRldiwgZG1hX2FkZHJfdCBoYW5kbGUs
CisJCXBoeXNfYWRkcl90IHBhZGRyLCBzaXplX3Qgc2l6ZSwgZW51bSBkbWFfZGF0YV9kaXJlY3Rp
b24gZGlyKQoreworCWlmIChwZm5fdmFsaWQoUEZOX0RPV04oaGFuZGxlKSkpCisJCWFyY2hfc3lu
Y19kbWFfZm9yX2NwdShkZXYsIHBhZGRyLCBzaXplLCBkaXIpOwogCWVsc2UKLQkJX194ZW5fZG1h
X21hcF9wYWdlKGh3ZGV2LCBwYWdlLCBkZXZfYWRkciwgb2Zmc2V0LCBzaXplLCBkaXIsIGF0dHJz
KTsKKwkJX194ZW5fZG1hX3N5bmNfZm9yX2NwdShkZXYsIGhhbmRsZSwgc2l6ZSwgZGlyKTsKIH0K
IAotc3RhdGljIGlubGluZSB2b2lkIHhlbl9kbWFfdW5tYXBfcGFnZShzdHJ1Y3QgZGV2aWNlICpo
d2RldiwgZG1hX2FkZHJfdCBoYW5kbGUsCi0JCXNpemVfdCBzaXplLCBlbnVtIGRtYV9kYXRhX2Rp
cmVjdGlvbiBkaXIsIHVuc2lnbmVkIGxvbmcgYXR0cnMpCitzdGF0aWMgaW5saW5lIHZvaWQgeGVu
X2RtYV9zeW5jX2Zvcl9kZXZpY2Uoc3RydWN0IGRldmljZSAqZGV2LAorCQlkbWFfYWRkcl90IGhh
bmRsZSwgcGh5c19hZGRyX3QgcGFkZHIsIHNpemVfdCBzaXplLAorCQllbnVtIGRtYV9kYXRhX2Rp
cmVjdGlvbiBkaXIpCiB7Ci0JdW5zaWduZWQgbG9uZyBwZm4gPSBQRk5fRE9XTihoYW5kbGUpOwot
CS8qCi0JICogRG9tMCBpcyBtYXBwZWQgMToxLCB3aGlsZSB0aGUgTGludXggcGFnZSBjYW4gYmUg
c3Bhbm5lZCBhY2Nyb3NzCi0JICogbXVsdGlwbGUgWGVuIHBhZ2UsIGl0J3Mgbm90IHBvc3NpYmxl
IHRvIGhhdmUgYSBtaXggb2YgbG9jYWwgYW5kCi0JICogZm9yZWlnbiBYZW4gcGFnZS4gRG9tMCBp
cyBtYXBwZWQgMToxLCBzbyBjYWxsaW5nIHBmbl92YWxpZCBvbiBhCi0JICogZm9yZWlnbiBtZm4g
d2lsbCBhbHdheXMgcmV0dXJuIGZhbHNlLiBJZiB0aGUgcGFnZSBpcyBsb2NhbCB3ZSBjYW4KLQkg
KiBzYWZlbHkgY2FsbCB0aGUgbmF0aXZlIGRtYV9vcHMgZnVuY3Rpb24sIG90aGVyd2lzZSB3ZSBj
YWxsIHRoZSB4ZW4KLQkgKiBzcGVjaWZpYyBmdW5jdGlvbi4KLQkgKi8KLQlpZiAocGZuX3ZhbGlk
KHBmbikpCi0JCWRtYV9kaXJlY3RfdW5tYXBfcGFnZShod2RldiwgaGFuZGxlLCBzaXplLCBkaXIs
IGF0dHJzKTsKKwlpZiAocGZuX3ZhbGlkKFBGTl9ET1dOKGhhbmRsZSkpKQorCQlhcmNoX3N5bmNf
ZG1hX2Zvcl9kZXZpY2UoZGV2LCBwYWRkciwgc2l6ZSwgZGlyKTsKIAllbHNlCi0JCV9feGVuX2Rt
YV91bm1hcF9wYWdlKGh3ZGV2LCBoYW5kbGUsIHNpemUsIGRpciwgYXR0cnMpOworCQlfX3hlbl9k
bWFfc3luY19mb3JfZGV2aWNlKGRldiwgaGFuZGxlLCBzaXplLCBkaXIpOwogfQogI2Vsc2UKLXN0
YXRpYyBpbmxpbmUgdm9pZCB4ZW5fZG1hX21hcF9wYWdlKHN0cnVjdCBkZXZpY2UgKmh3ZGV2LCBz
dHJ1Y3QgcGFnZSAqcGFnZSwKLQkgICAgIGRtYV9hZGRyX3QgZGV2X2FkZHIsIHVuc2lnbmVkIGxv
bmcgb2Zmc2V0LCBzaXplX3Qgc2l6ZSwKLQkgICAgIGVudW0gZG1hX2RhdGFfZGlyZWN0aW9uIGRp
ciwgdW5zaWduZWQgbG9uZyBhdHRycykKLXsKLX0KLXN0YXRpYyBpbmxpbmUgdm9pZCB4ZW5fZG1h
X3VubWFwX3BhZ2Uoc3RydWN0IGRldmljZSAqaHdkZXYsIGRtYV9hZGRyX3QgaGFuZGxlLAotCQlz
aXplX3Qgc2l6ZSwgZW51bSBkbWFfZGF0YV9kaXJlY3Rpb24gZGlyLCB1bnNpZ25lZCBsb25nIGF0
dHJzKQotewotfQotc3RhdGljIGlubGluZSB2b2lkIHhlbl9kbWFfc3luY19zaW5nbGVfZm9yX2Nw
dShzdHJ1Y3QgZGV2aWNlICpod2RldiwKLQkJZG1hX2FkZHJfdCBoYW5kbGUsIHNpemVfdCBzaXpl
LCBlbnVtIGRtYV9kYXRhX2RpcmVjdGlvbiBkaXIpCitzdGF0aWMgaW5saW5lIHZvaWQgeGVuX2Rt
YV9zeW5jX2Zvcl9jcHUoc3RydWN0IGRldmljZSAqZGV2LCBkbWFfYWRkcl90IGhhbmRsZSwKKwkJ
cGh5c19hZGRyX3QgcGFkZHIsIHNpemVfdCBzaXplLCBlbnVtIGRtYV9kYXRhX2RpcmVjdGlvbiBk
aXIpCiB7CiB9Ci1zdGF0aWMgaW5saW5lIHZvaWQgeGVuX2RtYV9zeW5jX3NpbmdsZV9mb3JfZGV2
aWNlKHN0cnVjdCBkZXZpY2UgKmh3ZGV2LAotCQlkbWFfYWRkcl90IGhhbmRsZSwgc2l6ZV90IHNp
emUsIGVudW0gZG1hX2RhdGFfZGlyZWN0aW9uIGRpcikKK3N0YXRpYyBpbmxpbmUgdm9pZCB4ZW5f
ZG1hX3N5bmNfZm9yX2RldmljZShzdHJ1Y3QgZGV2aWNlICpkZXYsCisJCWRtYV9hZGRyX3QgaGFu
ZGxlLCBwaHlzX2FkZHJfdCBwYWRkciwgc2l6ZV90IHNpemUsCisJCWVudW0gZG1hX2RhdGFfZGly
ZWN0aW9uIGRpcikKIHsKIH0KICNlbmRpZgotLSAKMi4yMC4xCgoKX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4t
ZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9t
YWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

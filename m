Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 2541EB7827
	for <lists+xen-devel@lfdr.de>; Thu, 19 Sep 2019 13:07:29 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iAuFE-0003G3-TF; Thu, 19 Sep 2019 11:05:04 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=vwgP=XO=citrix.com=anthony.perard@srs-us1.protection.inumbo.net>)
 id 1iAuFC-0003Ek-NE
 for xen-devel@lists.xenproject.org; Thu, 19 Sep 2019 11:05:02 +0000
X-Inumbo-ID: 4d563458-dacd-11e9-9656-12813bfff9fa
Received: from esa5.hc3370-68.iphmx.com (unknown [216.71.155.168])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 4d563458-dacd-11e9-9656-12813bfff9fa;
 Thu, 19 Sep 2019 11:04:51 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1568891091;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=AJMmAYEqyRooJeKHzVCA8PJ0DcCsBrHvXRZS/oznQNI=;
 b=bm0JJ5RDV5DP+OBxQbYGvMhp89Nv8ME27ZfvMTGXWa/2fOxv6To8RBX6
 OrwtdOIgtw9MD9qVa9r9Wf3Pll/PfYwuwZtR0qviGtuTuayb9o0Ga1+RQ
 YGU1V/EZ/oazqB31eGVcFbTv1Eg3dkMQbeN4NW4EDMay85GHHDjR7CQ1d o=;
Authentication-Results: esa5.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=anthony.perard@citrix.com;
 spf=Pass smtp.mailfrom=anthony.perard@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa5.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 anthony.perard@citrix.com) identity=pra;
 client-ip=162.221.158.21; receiver=esa5.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="anthony.perard@citrix.com";
 x-conformance=sidf_compatible
Received-SPF: Pass (esa5.hc3370-68.iphmx.com: domain of
 anthony.perard@citrix.com designates 162.221.158.21 as
 permitted sender) identity=mailfrom;
 client-ip=162.221.158.21; receiver=esa5.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="anthony.perard@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83 ~all"
Received-SPF: None (esa5.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa5.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: 30rZysVDmeYvhpXMYE5h4RWfLqcCQrN+bv7XTI37/BoUAhNZl9Mn13lEyUJ7nG00AYqeZSBYd1
 XLS0PcRTR5/Mdp9JnHqUYe+raUKWa4ovXeI8k8xZ4LBSm45amFQTNJk2C2NnDsCb+yKkS2I3o+
 bMWilgg3PZVLSwJp+jTu+IkezZroHl2xhtGurUEr/PF+icX/dnsOTVQU7FietGNWBZM3BqAtzI
 xwLk+GmhmCuTmtWoMHGwNMmB7U1F3gexvMyhpiUtMmUqfOpdQDveLjI6ECkSTGIeNlFJ/Weul8
 ZFI=
X-SBRS: 2.7
X-MesageID: 5984932
X-Ironport-Server: esa5.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.64,523,1559534400"; 
   d="scan'208";a="5984932"
From: Anthony PERARD <anthony.perard@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Thu, 19 Sep 2019 12:04:37 +0100
Message-ID: <20190919110443.817594-4-anthony.perard@citrix.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190919110443.817594-1-anthony.perard@citrix.com>
References: <20190919110443.817594-1-anthony.perard@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v3 3/9] libxl_internal: Introduce
 libxl__ev_devlock for devices hotplug via QMP
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Anthony PERARD <anthony.perard@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Wei Liu <wl@xen.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhlIGN1cnJlbnQgbG9jayBgZG9tYWluX3VzZXJkYXRhX2xvY2snIGNhbid0IGJlIHVzZWQgd2hl
biBtb2RpZmljYXRpb24KdG8gYSBndWVzdCBpcyBkb25lIGJ5IHNlbmRpbmcgY29tbWFuZCB0byBR
RU1VLCB0aGlzIGlzIGEgc2xvdyBwcm9jZXNzCmFuZCByZXF1aXJlcyB0byBjYWxsIENUWF9VTkxP
Q0ssIHdoaWNoIGlzIG5vdCBwb3NzaWJsZSB3aGlsZSBob2xkaW5nCnRoZSBgZG9tYWluX3VzZXJk
YXRhX2xvY2snLgoKVG8gcmVzb2x2ZSB0aGlzIGlzc3VlLCB3ZSBjcmVhdGUgYSBuZXcgbG9jayB3
aGljaCBjYW4gdGFrZSBvdmVyIHBhcnQKb2YgdGhlIGpvYiBvZiB0aGUganNvbl9sb2NrLgoKVGhp
cyBsb2NrIGlzIG91dHNpZGUgQ1RYX0xPQ0sgaW4gdGhlIGxvY2sgaGllcmFyY2h5LgpsaWJ4bF9f
ZXZfZGV2bG9ja19sb2NrIHdpbGwgaGF2ZSBDVFhfVU5MT0NLIGJlZm9yZSB0cnlpbmcgdG8gZ3Jh
YiB0aGUKZXZfZGV2bG9jay4gVGhlIGNhbGxiYWNrIGlzIHVzZWQgdG8gbm90aWZ5IHdoZW4gdGhl
IGV2X2RldmxvY2sgaGF2ZQpiZWVuIGFjcXVpcmVkLgoKU2lnbmVkLW9mZi1ieTogQW50aG9ueSBQ
RVJBUkQgPGFudGhvbnkucGVyYXJkQGNpdHJpeC5jb20+Ci0tLQoKTm90ZXM6CiAgICB2MzoKICAg
IC0gZml4IHVzZSBvZiBMT0dFRCB3aGVyZSBlcnJubyBudW1lcmljIHZhbHVlIHdhcyBwcmludGVk
LgogICAgLSBjaGFuZ2UgY29tbWVudCBpbiBsaWJ4bF9fZXZfdW5sb2NrIHRvIHJlZmVyIHRvIHRo
ZSBvbmUgaW4KICAgICAgbGlieGxfX3VubG9ja19kb21haW5fdXNlcmRhdGEoKSBpbnN0ZWFkIG9m
IG1ha2luZyBhIGNvcHkgb2YgaXQuCiAgICAtIHJlbmFtZSBldl9sb2NrIHRvIGV2X2RldmxvY2su
IChBbmQgX2dldCB0byBfbG9jay4pCiAgICAKICAgIHYyOgogICAgLSBuZXcgcGF0Y2gsIHRvIHJl
cGxhY2UgMiBwYXRjaAogICAgICBpbXBsZW1lbnQgYSBkaWZmZXJlbnQgbG9jawoKIHRvb2xzL2xp
YnhsL2xpYnhsX2ludGVybmFsLmMgfCAxNjMgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysKIHRvb2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmggfCAgNzYgKysrKysrKysrKysrKysr
LQogMiBmaWxlcyBjaGFuZ2VkLCAyMzUgaW5zZXJ0aW9ucygrKSwgNCBkZWxldGlvbnMoLSkKCmRp
ZmYgLS1naXQgYS90b29scy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5jIGIvdG9vbHMvbGlieGwvbGli
eGxfaW50ZXJuYWwuYwppbmRleCBmNDkyZGFlNWZmNzAuLjI4YTEyNmNjYzM0MiAxMDA2NDQKLS0t
IGEvdG9vbHMvbGlieGwvbGlieGxfaW50ZXJuYWwuYworKysgYi90b29scy9saWJ4bC9saWJ4bF9p
bnRlcm5hbC5jCkBAIC01NzUsNiArNTc1LDE2OSBAQCB2b2lkIGxpYnhsX191cGRhdGVfZG9tYWlu
X2NvbmZpZ3VyYXRpb24obGlieGxfX2djICpnYywKICAgICBkc3QtPmJfaW5mby52aWRlb19tZW1r
YiA9IHNyYy0+Yl9pbmZvLnZpZGVvX21lbWtiOwogfQogCit2b2lkIGxpYnhsX19ldl9kZXZsb2Nr
X2luaXQobGlieGxfX2V2X2RldmxvY2sgKmxvY2spCit7CisgICAgbGlieGxfX2V2X2NoaWxkX2lu
aXQoJmxvY2stPmNoaWxkKTsKKyAgICBsb2NrLT5wYXRoID0gTlVMTDsKKyAgICBsb2NrLT5mZCA9
IC0xOworICAgIGxvY2stPmhlbGQgPSBmYWxzZTsKK30KKworc3RhdGljIHZvaWQgZXZfbG9ja19w
cmVwYXJlX2ZvcmsobGlieGxfX2VnYyAqZWdjLCBsaWJ4bF9fZXZfZGV2bG9jayAqbG9jayk7Citz
dGF0aWMgdm9pZCBldl9sb2NrX2NoaWxkX2NhbGxiYWNrKGxpYnhsX19lZ2MgKmVnYywgbGlieGxf
X2V2X2NoaWxkICpjaGlsZCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGlk
X3QgcGlkLCBpbnQgc3RhdHVzKTsKKwordm9pZCBsaWJ4bF9fZXZfZGV2bG9ja19sb2NrKGxpYnhs
X19lZ2MgKmVnYywgbGlieGxfX2V2X2RldmxvY2sgKmxvY2spCit7CisgICAgU1RBVEVfQU9fR0Mo
bG9jay0+YW8pOworICAgIGNvbnN0IGNoYXIgKmxvY2tmaWxlOworCisgICAgbG9ja2ZpbGUgPSBs
aWJ4bF9fdXNlcmRhdGFfcGF0aChnYywgbG9jay0+ZG9taWQsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAibGlieGwtZGV2aWNlLWNoYW5nZXMtbG9jayIsICJsIik7CisgICAg
aWYgKCFsb2NrZmlsZSkgZ290byBvdXQ7CisgICAgbG9jay0+cGF0aCA9IGxpYnhsX19zdHJkdXAo
Tk9HQywgbG9ja2ZpbGUpOworCisgICAgZXZfbG9ja19wcmVwYXJlX2ZvcmsoZWdjLCBsb2NrKTsK
KyAgICByZXR1cm47CitvdXQ6CisgICAgbG9jay0+Y2FsbGJhY2soZWdjLCBsb2NrLCBFUlJPUl9M
T0NLX0ZBSUwpOworfQorCitzdGF0aWMgdm9pZCBldl9sb2NrX3ByZXBhcmVfZm9yayhsaWJ4bF9f
ZWdjICplZ2MsIGxpYnhsX19ldl9kZXZsb2NrICpsb2NrKQoreworICAgIFNUQVRFX0FPX0dDKGxv
Y2stPmFvKTsKKyAgICBwaWRfdCBwaWQ7CisgICAgaW50IGZkOworCisgICAgLyogQ29udmVuaWVu
Y2UgYWxpYXNlcyAqLworICAgIGxpYnhsX2RvbWlkIGRvbWlkID0gbG9jay0+ZG9taWQ7CisgICAg
Y29uc3QgY2hhciAqbG9ja2ZpbGUgPSBsb2NrLT5wYXRoOworCisgICAgbG9jay0+ZmQgPSBvcGVu
KGxvY2tmaWxlLCBPX1JEV1J8T19DUkVBVCwgMDY2Nik7CisgICAgaWYgKGxvY2stPmZkIDwgMCkg
eworICAgICAgICBMT0dFRChFUlJPUiwgZG9taWQsICJjYW5ub3Qgb3BlbiBsb2NrZmlsZSAlcyIs
IGxvY2tmaWxlKTsKKyAgICAgICAgZ290byBvdXQ7CisgICAgfQorICAgIGZkID0gbG9jay0+ZmQ7
CisKKyAgICBwaWQgPSBsaWJ4bF9fZXZfY2hpbGRfZm9yayhnYywgJmxvY2stPmNoaWxkLCBldl9s
b2NrX2NoaWxkX2NhbGxiYWNrKTsKKyAgICBpZiAocGlkIDwgMCkKKyAgICAgICAgZ290byBvdXQ7
CisgICAgaWYgKCFwaWQpIHsKKyAgICAgICAgLyogY2hpbGQgKi8KKyAgICAgICAgaW50IGV4aXRf
dmFsID0gMDsKKworICAgICAgICAvKiBMb2NrIHRoZSBmaWxlIGluIGV4Y2x1c2l2ZSBtb2RlLCB3
YWl0IGluZGVmaW5pdGVseSB0bworICAgICAgICAgKiBhY3F1aXJlIHRoZSBsb2NrICovCisgICAg
ICAgIHdoaWxlIChmbG9jayhmZCwgTE9DS19FWCkpIHsKKyAgICAgICAgICAgIHN3aXRjaCAoZXJy
bm8pIHsKKyAgICAgICAgICAgIGNhc2UgRUlOVFI6CisgICAgICAgICAgICAgICAgLyogU2lnbmFs
IHJlY2VpdmVkLCByZXRyeSAqLworICAgICAgICAgICAgICAgIGNvbnRpbnVlOworICAgICAgICAg
ICAgZGVmYXVsdDoKKyAgICAgICAgICAgICAgICAvKiBBbGwgb3RoZXIgZXJybm86IEVCQURGLCBF
SU5WQUwsIEVOT0xDSywgRVdPVUxEQkxPQ0sgKi8KKyAgICAgICAgICAgICAgICBMT0dFRChFUlJP
UiwgZG9taWQsCisgICAgICAgICAgICAgICAgICAgICAgInVuZXhwZWN0ZWQgZXJyb3Igd2hpbGUg
dHJ5aW5nIHRvIGxvY2sgJXMsIGZkPSVkIiwKKyAgICAgICAgICAgICAgICAgICAgICBsb2NrZmls
ZSwgZmQpOworICAgICAgICAgICAgICAgIGV4aXRfdmFsID0gMTsKKyAgICAgICAgICAgICAgICBi
cmVhazsKKyAgICAgICAgICAgIH0KKyAgICAgICAgfQorICAgICAgICBfZXhpdChleGl0X3ZhbCk7
CisgICAgfQorCisgICAgLyogTm93IHRoYXQgdGhlIGNoaWxkIGhhcyB0aGUgZmQsIHNldCBjbG9l
eGVjIGluIHRoZSBwYXJlbnQgdG8gcHJldmVudAorICAgICAqIG1vcmUgbGVha2FnZSB0aGFuIG5l
Y2Vzc2FyeSAqLworICAgIGxpYnhsX2ZkX3NldF9jbG9leGVjKENUWCwgZmQsIDEpOworICAgIHJl
dHVybjsKK291dDoKKyAgICBsaWJ4bF9fZXZfZGV2bG9ja191bmxvY2soZ2MsIGxvY2spOworICAg
IGxvY2stPmNhbGxiYWNrKGVnYywgbG9jaywgRVJST1JfTE9DS19GQUlMKTsKK30KKworc3RhdGlj
IHZvaWQgZXZfbG9ja19jaGlsZF9jYWxsYmFjayhsaWJ4bF9fZWdjICplZ2MsIGxpYnhsX19ldl9j
aGlsZCAqY2hpbGQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpZF90IHBp
ZCwgaW50IHN0YXR1cykKK3sKKyAgICBFR0NfR0M7CisgICAgbGlieGxfX2V2X2RldmxvY2sgKmxv
Y2sgPSBDT05UQUlORVJfT0YoY2hpbGQsICpsb2NrLCBjaGlsZCk7CisgICAgc3RydWN0IHN0YXQg
c3RhYiwgZnN0YWI7CisgICAgaW50IHJjID0gRVJST1JfTE9DS19GQUlMOworCisgICAgLyogQ29u
dmVuaWVuY2UgYWxpYXNlcyAqLworICAgIGludCBmZCA9IGxvY2stPmZkOworICAgIGNvbnN0IGNo
YXIgKmxvY2tmaWxlID0gbG9jay0+cGF0aDsKKyAgICBsaWJ4bF9kb21pZCBkb21pZCA9IGxvY2st
PmRvbWlkOworCisgICAgaWYgKHN0YXR1cykgeworICAgICAgICBsaWJ4bF9yZXBvcnRfY2hpbGRf
ZXhpdHN0YXR1cyhDVFgsIFhUTF9FUlJPUiwgImZsb2NrIGNoaWxkIiwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgcGlkLCBzdGF0dXMpOworICAgICAgICBnb3RvIG91dDsK
KyAgICB9CisKKyAgICBpZiAoZnN0YXQoZmQsICZmc3RhYikpIHsKKyAgICAgICAgTE9HRUQoRVJS
T1IsIGRvbWlkLCAiY2Fubm90IGZzdGF0ICVzLCBmZD0lZCIsIGxvY2tmaWxlLCBmZCk7CisgICAg
ICAgIGdvdG8gb3V0OworICAgIH0KKyAgICBpZiAoc3RhdChsb2NrZmlsZSwgJnN0YWIpKSB7Cisg
ICAgICAgIGlmIChlcnJubyAhPSBFTk9FTlQpIHsKKyAgICAgICAgICAgIExPR0VEKEVSUk9SLCBk
b21pZCwgImNhbm5vdCBzdGF0ICVzIiwgbG9ja2ZpbGUpOworICAgICAgICAgICAgZ290byBvdXQ7
CisgICAgICAgIH0KKyAgICB9IGVsc2UgeworICAgICAgICBpZiAoc3RhYi5zdF9kZXYgPT0gZnN0
YWIuc3RfZGV2ICYmIHN0YWIuc3RfaW5vID09IGZzdGFiLnN0X2lubykgeworICAgICAgICAgICAg
LyogV2UgaGVsZCB0aGUgbG9jayAqLworICAgICAgICAgICAgbG9jay0+aGVsZCA9IHRydWU7Cisg
ICAgICAgICAgICByYyA9IDA7CisgICAgICAgICAgICBnb3RvIG91dDsKKyAgICAgICAgfQorICAg
IH0KKworICAgIC8qIFdlIGRpZG4ndCBncmFiIHRoZSBsb2NrLCBsZXQncyB0cnkgYWdhaW4gKi8K
KyAgICBmbG9jayhsb2NrLT5mZCwgTE9DS19VTik7CisgICAgY2xvc2UobG9jay0+ZmQpOworICAg
IGxvY2stPmZkID0gLTE7CisgICAgZXZfbG9ja19wcmVwYXJlX2ZvcmsoZWdjLCBsb2NrKTsKKyAg
ICByZXR1cm47CisKK291dDoKKyAgICBpZiAobG9jay0+aGVsZCkgeworICAgICAgICAvKiBDaGVj
ayB0aGUgZG9tYWluIGlzIHN0aWxsIHRoZXJlLCBpZiBub3Qgd2Ugc2hvdWxkIHJlbGVhc2UgdGhl
CisgICAgICAgICAqIGxvY2sgYW5kIGNsZWFuIHVwLiAgKi8KKyAgICAgICAgaWYgKGxpYnhsX2Rv
bWFpbl9pbmZvKENUWCwgTlVMTCwgZG9taWQpKQorICAgICAgICAgICAgcmMgPSBFUlJPUl9MT0NL
X0ZBSUw7CisgICAgfQorICAgIGlmIChyYykgeworICAgICAgICBMT0dEKEVSUk9SLCBkb21pZCwg
IkZhaWxlZCB0byBncmFiIHFtcC1sb2NrIik7CisgICAgICAgIGxpYnhsX19ldl9kZXZsb2NrX3Vu
bG9jayhnYywgbG9jayk7CisgICAgfQorICAgIGxvY2stPmNhbGxiYWNrKGVnYywgbG9jaywgcmMp
OworfQorCit2b2lkIGxpYnhsX19ldl9kZXZsb2NrX3VubG9jayhsaWJ4bF9fZ2MgKmdjLCBsaWJ4
bF9fZXZfZGV2bG9jayAqbG9jaykKK3sKKyAgICBpbnQgcjsKKworICAgIGFzc2VydCghbGlieGxf
X2V2X2NoaWxkX2ludXNlKCZsb2NrLT5jaGlsZCkpOworCisgICAgLyogU2VlIHRoZSByYXRpb25h
bGUgaW4gbGlieGxfX3VubG9ja19kb21haW5fdXNlcmRhdGEoKQorICAgICAqIGFib3V0IHdoeSB3
ZSBkbyB1bmxpbmsoKSBiZWZvcmUgdW5sb2NrKCkuICovCisKKyAgICBpZiAobG9jay0+cGF0aCAm
JiBsb2NrLT5oZWxkKQorICAgICAgICB1bmxpbmsobG9jay0+cGF0aCk7CisKKyAgICBpZiAobG9j
ay0+ZmQgPj0gMCkgeworICAgICAgICAvKiBXZSBuZWVkIHRvIGNhbGwgdW5sb2NrIGFzIHRoZSBm
ZCBtYXkgaGF2ZSBsZWFrZWQgaW50byBvdGhlcgorICAgICAgICAgKiBwcm9jZXNzZXMgKi8KKyAg
ICAgICAgciA9IGZsb2NrKGxvY2stPmZkLCBMT0NLX1VOKTsKKyAgICAgICAgaWYgKHIpCisgICAg
ICAgICAgICBMT0dFRChFUlJPUiwgbG9jay0+ZG9taWQsICJmYWlsZWQgdG8gdW5sb2NrIGZkPSVk
LCBwYXRoPSVzIiwKKyAgICAgICAgICAgICAgICAgIGxvY2stPmZkLCBsb2NrLT5wYXRoKTsKKyAg
ICAgICAgY2xvc2UobG9jay0+ZmQpOworICAgIH0KKyAgICBmcmVlKGxvY2stPnBhdGgpOworICAg
IGxpYnhsX19ldl9kZXZsb2NrX2luaXQobG9jayk7Cit9CisKIC8qCiAgKiBMb2NhbCB2YXJpYWJs
ZXM6CiAgKiBtb2RlOiBDCmRpZmYgLS1naXQgYS90b29scy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5o
IGIvdG9vbHMvbGlieGwvbGlieGxfaW50ZXJuYWwuaAppbmRleCAwM2UwODY0ODBjYTMuLmM3YmNk
ZTVlZGFlNyAxMDA2NDQKLS0tIGEvdG9vbHMvbGlieGwvbGlieGxfaW50ZXJuYWwuaAorKysgYi90
b29scy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5oCkBAIC0xOTQsNiArMTk0LDcgQEAgdHlwZWRlZiBz
dHJ1Y3QgbGlieGxfX29zZXZlbnRfaG9va19uZXh1cyBsaWJ4bF9fb3NldmVudF9ob29rX25leHVz
OwogdHlwZWRlZiBzdHJ1Y3QgbGlieGxfX29zZXZlbnRfaG9va19uZXhpIGxpYnhsX19vc2V2ZW50
X2hvb2tfbmV4aTsKIHR5cGVkZWYgc3RydWN0IGxpYnhsX19qc29uX29iamVjdCBsaWJ4bF9fanNv
bl9vYmplY3Q7CiB0eXBlZGVmIHN0cnVjdCBsaWJ4bF9fY2FyZWZkIGxpYnhsX19jYXJlZmQ7Cit0
eXBlZGVmIHN0cnVjdCBsaWJ4bF9fZXZfZGV2bG9jayBsaWJ4bF9fZXZfZGV2bG9jazsKIAogdHlw
ZWRlZiBzdHJ1Y3QgbGlieGxfX2RvbWFpbl9jcmVhdGVfc3RhdGUgbGlieGxfX2RvbWFpbl9jcmVh
dGVfc3RhdGU7CiB0eXBlZGVmIHZvaWQgbGlieGxfX2RvbWFpbl9jcmVhdGVfY2Ioc3RydWN0IGxp
YnhsX19lZ2MgKmVnYywKQEAgLTI3MjQsMTEgKzI3MjUsMTEgQEAgc3RydWN0IGxpYnhsX19tdWx0
aWRldiB7CiAgKiBkZXZpY2UgaW5mb3JtYXRpb24sIGluIEpTT04gZmlsZXMsIHNvIHRoYXQgd2Ug
Y2FuIHVzZSB0aGlzIEpTT04KICAqIGZpbGUgYXMgYSB0ZW1wbGF0ZSB0byByZWNvbnN0cnVjdCBk
b21haW4gY29uZmlndXJhdGlvbi4KICAqCi0gKiBJbiBlc3NlbnNlIHRoZXJlIGFyZSBub3cgdHdv
IHZpZXdzIG9mIGRldmljZSBzdGF0ZSwgb25lIGlzIHhlbnN0b3JlLAotICogdGhlIG90aGVyIGlz
IEpTT04gZmlsZS4gV2UgdXNlIHhlbnN0b3JlIGFzIHByaW1hcnkgcmVmZXJlbmNlLgorICogSW4g
ZXNzZW5zZSB0aGVyZSBhcmUgbm93IHR3byB2aWV3cyBvZiBkZXZpY2Ugc3RhdGUsIG9uZSBpcyB0
aGUKKyAqIHByaW1hcnkgY29uZmlnICh4ZW5zdG9yZSBvciBRRU1VKSwgdGhlIG90aGVyIGlzIEpT
T04gZmlsZS4KICAqCi0gKiBIZXJlIHdlIG1haW50YWluIG9uZSBpbnZhcmlhbnQ6IGV2ZXJ5IGRl
dmljZSBpbiB4ZW5zdG9yZSBtdXN0IGhhdmUKLSAqIGFuIGVudHJ5IGluIEpTT04gZmlsZS4KKyAq
IEhlcmUgd2UgbWFpbnRhaW4gb25lIGludmFyaWFudDogZXZlcnkgZGV2aWNlIGluIHRoZSBwcmlt
YXJ5IGNvbmZpZworICogbXVzdCBoYXZlIGFuIGVudHJ5IGluIEpTT04gZmlsZS4KICAqCiAgKiBB
bGwgZGV2aWNlIGhvdHBsdWcgcm91dGluZXMgc2hvdWxkIGNvbXBseSB0byBmb2xsb3dpbmcgcGF0
dGVybjoKICAqICAgbG9jayBqc29uIGNvbmZpZyAoanNvbl9sb2NrKQpAQCAtMjc0Myw2ICsyNzQ0
LDI0IEBAIHN0cnVjdCBsaWJ4bF9fbXVsdGlkZXYgewogICogICAgICAgZW5kIGZvciBsb29wCiAg
KiAgIHVubG9jayBqc29uIGNvbmZpZwogICoKKyAqIE9yIGluIGNhc2UgUUVNVSBpcyB0aGUgcHJp
bWFyeSBjb25maWcsIHRoaXMgcGF0dGVybiBjYW4gYmUgdXNlOgorICogICBxbXBfbG9jayAobGli
eGxfX2V2X2RldmxvY2spCisgKiAgICAgIGxvY2sganNvbiBjb25maWcgKGpzb25fbG9jaykKKyAq
ICAgICAgICAgIHJlYWQganNvbiBjb25maWcKKyAqICAgICAgICAgIHVwZGF0ZSBpbi1tZW1vcnkg
anNvbiBjb25maWcgd2l0aCBuZXcgZW50cnksIHJlcGxhY2luZworICogICAgICAgICAgICAgYW55
IHN0YWxlIGVudHJ5CisgKiAgICAgIHVubG9jayBqc29uIGNvbmZpZworICogICAgICBhcHBseSBu
ZXcgY29uZmlnIHRvIHByaW1hcnkgY29uZmlnCisgKiAgICAgIGxvY2sganNvbiBjb25maWcgKGpz
b25fbG9jaykKKyAqICAgICAgICAgIHJlYWQganNvbiBjb25maWcKKyAqICAgICAgICAgIHVwZGF0
ZSBpbi1tZW1vcnkganNvbiBjb25maWcgd2l0aCBuZXcgZW50cnksIHJlcGxhY2luZworICogICAg
ICAgICAgICAgYW55IHN0YWxlIGVudHJ5CisgKiAgICAgICAgICB3cml0ZSBpbi1tZW1vcnkganNv
biBjb25maWcgdG8gZGlzaworICogICAgICB1bmxvY2sganNvbiBjb25maWcKKyAqICAgdW5sb2Nr
IHFtcF9sb2NrCisgKiAgIChDVFhfTE9DSyBjYW4gYmUgYWNxdWlyZWQgYW5kIHJlbGVhc2VkIHNl
dmVyYWwgdGltZSB3aGlsZSBob2xkaW5nIHRoZQorICogICAgcW1wX2xvY2spCisgKgogICogRGV2
aWNlIHJlbW92YWwgcm91dGluZXMgYXJlIG5vdCB0b3VjaGVkLgogICoKICAqIEhlcmUgaXMgdGhl
IHByb29mIHRoYXQgd2UgYWx3YXlzIG1haW50YWluIHRoYXQgaW52YXJpYW50IGFuZCB3ZQpAQCAt
NDYwMyw2ICs0NjIyLDU1IEBAIHN0YXRpYyBpbmxpbmUgY29uc3QgY2hhciAqbGlieGxfX3FlbXVf
cW1wX3BhdGgobGlieGxfX2djICpnYywgaW50IGRvbWlkKQogewogICAgIHJldHVybiBHQ1NQUklO
VEYoIiVzL3FtcC1saWJ4bC0lZCIsIGxpYnhsX19ydW5fZGlyX3BhdGgoKSwgZG9taWQpOwogfQor
CisvKgorICogTG9jayBmb3IgZGV2aWNlIGhvdHBsdWcsIHFtcF9sb2NrLgorICoKKyAqIGxpYnhs
X19ldl9kZXZsb2NrIGltcGxlbWVudCBhIGxvY2sgdGhhdCBpcyBvdXRzaWRlIG9mIENUWF9MT0NL
IGluIHRoZQorICogbG9jayBoaWVyYXJjaHkuIEl0IGNhbiBiZSB1c2VkIHdoZW4gb25lIHdhbnQg
dG8gbWFrZSBRTVAgY2FsbHMgdG8gUUVNVSwKKyAqIHdoaWNoIG1heSB0YWtlIGEgc2lnbmlmaWNh
bnQgYW1vdW50IHRpbWUuCisgKiBJdCBpcyB0byBiZSBhY3F1aXJlZCBieSBhbiBhbyBldmVudCBj
YWxsYmFjay4KKyAqCisgKiBJdCBpcyB0byBiZSBhY3F1aXJlZCB3aGVuIGFkZGluZy9yZW1vdmlu
ZyBkZXZpY2VzIG9yIG1ha2luZyBjaGFuZ2VzCisgKiB0byB0aGVtIHdoZW4gdGhpcyBpcyBhIHNs
b3cgb3BlcmF0aW9uIGFuZCBqc29uX2xvY2sgaXNuJ3QgYXBwcm9wcmlhdGUuCisgKgorICogUG9z
c2libGUgc3RhdGVzIG9mIGxpYnhsX19ldl9kZXZsb2NrOgorICogICBVbmRlZmluZWQKKyAqICAg
IE1pZ2h0IGNvbnRhaW4gYW55dGhpbmcuCisgKiAgSWRsZQorICogICAgU3RydWN0IGNvbnRlbnRz
IGFyZSBkZWZpbmVkIGVub3VnaCB0byBwYXNzIHRvIGFueQorICogICAgbGlieGxfX2V2X2Rldmxv
Y2tfKiBmdW5jdGlvbi4KKyAqICAgIFRoZSBzdHJ1Y3QgZG9lcyBub3QgY29udGFpbiByZWZlcmVu
Y2VzIHRvIGFueSBhbGxvY2F0ZWQgcHJpdmF0ZQorICogICAgcmVzb3VyY2VzIHNvIGNhbiBiZSB0
aHJvd24gYXdheS4KKyAqICBBY3RpdmUKKyAqICAgIFdhaXRpbmcgdG8gZ2V0IGEgbG9jay4KKyAq
ICAgIE5lZWRzIHRvIHdhaXQgdW50aWwgdGhlIGNhbGxiYWNrIGlzIGNhbGxlZC4KKyAqICBMb2Nr
QWNxdWlyZWQKKyAqICAgIGxpYnhsX19ldl9kZXZsb2NrX3VubG9jayB3aWxsIG5lZWQgdG8gYmUg
Y2FsbGVkIHRvIHJlbGVhc2UgdGhlIGxvY2sKKyAqICAgIGFuZCB0aGUgcmVzb3VyY2VzIG9mIGxp
YnhsX19ldl9kZXZsb2NrLgorICoKKyAqICBsaWJ4bF9fZXZfZGV2bG9ja19pbml0OiBVbmRlZmlu
ZWQvSWRsZSAtPiBJZGxlCisgKiAgbGlieGxfX2V2X2RldmxvY2tfbG9jazogSWRsZSAtPiBBY3Rp
dmUKKyAqICAgIE1heSBjYWxsIGNhbGxiYWNrIHN5bmNocm9ub3VzbHkuCisgKiAgbGlieGxfX2V2
X2RldmxvY2tfdW5sb2NrOiBMb2NrQWNxdWlyZWQvSWRsZSAtPiBJZGxlCisgKiAgY2FsbGJhY2s6
ICAgICBXaGVuIGNhbGxlZDogQWN0aXZlIC0+IExvY2tBY3F1aXJlZCAob24gZXJyb3I6IElkbGUp
CisgKiAgICBUaGUgY2FsbGJhY2sgaXMgb25seSBjYWxsZWQgb25jZS4KKyAqLworc3RydWN0IGxp
YnhsX19ldl9kZXZsb2NrIHsKKyAgICAvKiBmaWxsZWQgYnkgdXNlciAqLworICAgIGxpYnhsX19h
byAqYW87CisgICAgbGlieGxfZG9taWQgZG9taWQ7CisgICAgdm9pZCAoKmNhbGxiYWNrKShsaWJ4
bF9fZWdjICosIGxpYnhsX19ldl9kZXZsb2NrICosIGludCByYyk7CisgICAgLyogcHJpdmF0ZSB0
byBsaWJ4bF9fZXZfZGV2bG9jayogKi8KKyAgICBsaWJ4bF9fZXZfY2hpbGQgY2hpbGQ7CisgICAg
Y2hhciAqcGF0aDsgLyogcGF0aCBvZiB0aGUgbG9jayBmaWxlIGl0c2VsZiAqLworICAgIGludCBm
ZDsKKyAgICBib29sIGhlbGQ7Cit9OworX2hpZGRlbiB2b2lkIGxpYnhsX19ldl9kZXZsb2NrX2lu
aXQobGlieGxfX2V2X2RldmxvY2sgKik7CitfaGlkZGVuIHZvaWQgbGlieGxfX2V2X2RldmxvY2tf
bG9jayhsaWJ4bF9fZWdjICosIGxpYnhsX19ldl9kZXZsb2NrICopOworX2hpZGRlbiB2b2lkIGxp
YnhsX19ldl9kZXZsb2NrX3VubG9jayhsaWJ4bF9fZ2MgKiwgbGlieGxfX2V2X2RldmxvY2sgKik7
CisKICNlbmRpZgogCiAvKgotLSAKQW50aG9ueSBQRVJBUkQKCgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1k
ZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21h
aWxtYW4vbGlzdGluZm8veGVuLWRldmVs

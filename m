Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 41B0730BBF
	for <lists+xen-devel@lfdr.de>; Fri, 31 May 2019 11:38:02 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hWdwz-0003Nq-NA; Fri, 31 May 2019 09:35:49 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=1r68=T7=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1hWdwy-0003Nh-E9
 for xen-devel@lists.xenproject.org; Fri, 31 May 2019 09:35:48 +0000
X-Inumbo-ID: 77d4f4d8-8387-11e9-8980-bc764e045a96
Received: from prv1-mh.provo.novell.com (unknown [137.65.248.33])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 77d4f4d8-8387-11e9-8980-bc764e045a96;
 Fri, 31 May 2019 09:35:46 +0000 (UTC)
Received: from INET-PRV1-MTA by prv1-mh.provo.novell.com
 with Novell_GroupWise; Fri, 31 May 2019 03:35:46 -0600
Message-Id: <5CF0F5700200007800233DB4@prv1-mh.provo.novell.com>
X-Mailer: Novell GroupWise Internet Agent 18.1.1 
Date: Fri, 31 May 2019 03:35:44 -0600
From: "Jan Beulich" <JBeulich@suse.com>
To: "xen-devel" <xen-devel@lists.xenproject.org>
References: <5CF0F33A0200007800233D8F@prv1-mh.provo.novell.com>
In-Reply-To: <5CF0F33A0200007800233D8F@prv1-mh.provo.novell.com>
Mime-Version: 1.0
Content-Disposition: inline
Subject: [Xen-devel] [PATCH 2/2] dom_cow is needed for mem-sharing only
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Stefano Stabellini <sstabellini@kernel.org>, WeiLiu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <Ian.Jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Tamas K Lengyel <tamas@tklengyel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

QSBjb3VwbGUgb2YgYWRqdXN0bWVudHMgYXJlIG5lZWRlZCB0byBjb2RlIGNoZWNraW5nIGZvciBk
b21fY293LCBidXQKc2luY2UgdGhlcmUgYXJlIHByZXR0eSBmZXcgaXQgaXMgcHJvYmFibHkgYmV0
dGVyIHRvIGFkanVzdCB0aG9zZSB0aGFuCnRvIHNldCB1cCBhbmQga2VlcCBhcm91bmQgYSBuZXZl
ciB1c2VkIGRvbWFpbi4KClRha2UgdGhlIG9wcG9ydHVuaXR5IGFuZCB0aWdodGVuIGEgQlVHX09O
KCkgaW4gZW11bC1wcml2LW9wLmM6cmVhZF9jcigpLgooQXJndWFibHkgdGhpcyBwZXJoYXBzIHNo
b3VsZG4ndCBiZSBhIEJVR19PTigpIGluIHRoZSBmaXJzdCBwbGFjZS4pCgpTaWduZWQtb2ZmLWJ5
OiBKYW4gQmV1bGljaCA8amJldWxpY2hAc3VzZS5jb20+Ci0tLQpXaGlsZSBmb3Igbm93IHRoaXMg
YXZvaWRzIGNyZWF0aW5nIHRoZSBkb21haW4gb24gQXJtIG9ubHksIFRhbWFzJ2VzCnBhdGNoIHN3
aXRjaGluZyB0byBDT05GSUdfTUVNX1NIQVJJTkcgd2lsbCBtYWtlIHg4NiBsZXZlcmFnZSB0aGlz
IHRvby4KCi0tLSBhL3hlbi9hcmNoL3g4Ni9tbS5jCisrKyBiL3hlbi9hcmNoL3g4Ni9tbS5jCkBA
IC05NjcsOCArOTY3LDggQEAgZ2V0X3BhZ2VfZnJvbV9sMWUoCiAgICAgICAgIHJldHVybiBmbGlw
OwogICAgIH0KIAotICAgIGlmICggdW5saWtlbHkoIChyZWFsX3BnX293bmVyICE9IHBnX293bmVy
KSAmJgotICAgICAgICAgICAgICAgICAgIChyZWFsX3BnX293bmVyICE9IGRvbV9jb3cpICkgKQor
ICAgIGlmICggdW5saWtlbHkoKHJlYWxfcGdfb3duZXIgIT0gcGdfb3duZXIpICYmCisgICAgICAg
ICAgICAgICAgICAoIWRvbV9jb3cgfHwgKHJlYWxfcGdfb3duZXIgIT0gZG9tX2NvdykpKSApCiAg
ICAgewogICAgICAgICAvKgogICAgICAgICAgKiBMZXQgcHJpdmlsZWdlZCBkb21haW5zIHRyYW5z
ZmVyIHRoZSByaWdodCB0byBtYXAgdGhlaXIgdGFyZ2V0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9tbS9w
Mm0uYworKysgYi94ZW4vYXJjaC94ODYvbW0vcDJtLmMKQEAgLTU2OCw3ICs1NjgsOCBAQCBzdHJ1
Y3QgcGFnZV9pbmZvICpwMm1fZ2V0X3BhZ2VfZnJvbV9nZm4oCiAgICAgICAgICAgICB9CiAgICAg
ICAgICAgICBlbHNlIGlmICggIWdldF9wYWdlKHBhZ2UsIHAybS0+ZG9tYWluKSAmJgogICAgICAg
ICAgICAgICAgICAgICAgIC8qIFBhZ2UgY291bGQgYmUgc2hhcmVkICovCi0gICAgICAgICAgICAg
ICAgICAgICAgKCFwMm1faXNfc2hhcmVkKCp0KSB8fCAhZ2V0X3BhZ2UocGFnZSwgZG9tX2Nvdykp
ICkKKyAgICAgICAgICAgICAgICAgICAgICAoIWRvbV9jb3cgfHwgIXAybV9pc19zaGFyZWQoKnQp
IHx8CisgICAgICAgICAgICAgICAgICAgICAgICFnZXRfcGFnZShwYWdlLCBkb21fY293KSkgKQog
ICAgICAgICAgICAgICAgIHBhZ2UgPSBOVUxMOwogICAgICAgICB9CiAgICAgICAgIHAybV9yZWFk
X3VubG9jayhwMm0pOwpAQCAtOTQxLDcgKzk0Miw4IEBAIGd1ZXN0X3BoeXNtYXBfYWRkX2VudHJ5
KHN0cnVjdCBkb21haW4gKmQKICAgICAvKiBUaGVuLCBsb29rIGZvciBtLT5wIG1hcHBpbmdzIGZv
ciB0aGlzIHJhbmdlIGFuZCBkZWFsIHdpdGggdGhlbSAqLwogICAgIGZvciAoIGkgPSAwOyBpIDwg
KDFVTCA8PCBwYWdlX29yZGVyKTsgaSsrICkKICAgICB7Ci0gICAgICAgIGlmICggcGFnZV9nZXRf
b3duZXIobWZuX3RvX3BhZ2UobWZuX2FkZChtZm4sIGkpKSkgPT0gZG9tX2NvdyApCisgICAgICAg
IGlmICggZG9tX2NvdyAmJgorICAgICAgICAgICAgIHBhZ2VfZ2V0X293bmVyKG1mbl90b19wYWdl
KG1mbl9hZGQobWZuLCBpKSkpID09IGRvbV9jb3cgKQogICAgICAgICB7CiAgICAgICAgICAgICAv
KiBUaGlzIGlzIG5vIHdheSB0byBhZGQgYSBzaGFyZWQgcGFnZSB0byB5b3VyIHBoeXNtYXAhICov
CiAgICAgICAgICAgICBnZHByaW50ayhYRU5MT0dfRVJSLCAiQWRkaW5nIHNoYXJlZCBtZm4gJWx4
IGRpcmVjdGx5IHRvIGRvbSVkIHBoeXNtYXAgbm90IGFsbG93ZWQuXG4iLAotLS0gYS94ZW4vYXJj
aC94ODYvcHYvZW11bC1wcml2LW9wLmMKKysrIGIveGVuL2FyY2gveDg2L3B2L2VtdWwtcHJpdi1v
cC5jCkBAIC03MjMsOCArNzIzLDggQEAgc3RhdGljIGludCByZWFkX2NyKHVuc2lnbmVkIGludCBy
ZWcsIHVucwogICAgICAgICAgICAgdW5tYXBfZG9tYWluX3BhZ2UocGw0ZSk7CiAgICAgICAgICAg
ICAqdmFsID0gY29tcGF0X3Bmbl90b19jcjMobWZuX3RvX2dtZm4oY3VycmQsIG1mbl94KG1mbikp
KTsKICAgICAgICAgfQotICAgICAgICAvKiBQVHMgc2hvdWxkIG5vdCBiZSBzaGFyZWQgKi8KLSAg
ICAgICAgQlVHX09OKHBhZ2VfZ2V0X293bmVyKG1mbl90b19wYWdlKG1mbikpID09IGRvbV9jb3cp
OworICAgICAgICAvKiBQVHMgc2hvdWxkIGJlIG93bmVkIGJ5IHRoZWlyIGRvbWFpbnMgKi8KKyAg
ICAgICAgQlVHX09OKHBhZ2VfZ2V0X293bmVyKG1mbl90b19wYWdlKG1mbikpICE9IGN1cnJkKTsK
ICAgICAgICAgcmV0dXJuIFg4NkVNVUxfT0tBWTsKICAgICB9CiAgICAgfQotLS0gYS94ZW4vY29t
bW9uL2RvbWFpbi5jCisrKyBiL3hlbi9jb21tb24vZG9tYWluLmMKQEAgLTc0LDcgKzc0LDkgQEAg
aW50ZWdlcl9wYXJhbSgiaGFyZHdhcmVfZG9tIiwgaGFyZHdhcmVfZAogLyogUHJpdmF0ZSBkb21h
aW4gc3RydWN0cyBmb3IgRE9NSURfWEVOLCBET01JRF9JTywgZXRjLiAqLwogc3RydWN0IGRvbWFp
biAqX19yZWFkX21vc3RseSBkb21feGVuOwogc3RydWN0IGRvbWFpbiAqX19yZWFkX21vc3RseSBk
b21faW87CisjaWZkZWYgQ09ORklHX0hBU19NRU1fU0hBUklORwogc3RydWN0IGRvbWFpbiAqX19y
ZWFkX21vc3RseSBkb21fY293OworI2VuZGlmCiAKIHN0cnVjdCB2Y3B1ICppZGxlX3ZjcHVbTlJf
Q1BVU10gX19yZWFkX21vc3RseTsKIApAQCAtNTQ0LDEyICs1NDYsMTQgQEAgdm9pZCBfX2luaXQg
c2V0dXBfc3BlY2lhbF9kb21haW5zKHZvaWQpCiAgICAgZG9tX2lvID0gZG9tYWluX2NyZWF0ZShE
T01JRF9JTywgTlVMTCwgZmFsc2UpOwogICAgIEJVR19PTihJU19FUlIoZG9tX2lvKSk7CiAKKyNp
ZmRlZiBDT05GSUdfSEFTX01FTV9TSEFSSU5HCiAgICAgLyoKICAgICAgKiBJbml0aWFsaXNlIG91
ciBDT1cgZG9tYWluLgogICAgICAqIFRoaXMgZG9tYWluIG93bnMgc2hhcmFibGUgcGFnZXMuCiAg
ICAgICovCiAgICAgZG9tX2NvdyA9IGRvbWFpbl9jcmVhdGUoRE9NSURfQ09XLCBOVUxMLCBmYWxz
ZSk7CiAgICAgQlVHX09OKElTX0VSUihkb21fY293KSk7CisjZW5kaWYKIH0KIAogdm9pZCBkb21h
aW5fdXBkYXRlX25vZGVfYWZmaW5pdHkoc3RydWN0IGRvbWFpbiAqZCkKLS0tIGEveGVuL2NvbW1v
bi9ncmFudF90YWJsZS5jCisrKyBiL3hlbi9jb21tb24vZ3JhbnRfdGFibGUuYwpAQCAtMTA5NSw3
ICsxMDk1LDcgQEAgbWFwX2dyYW50X3JlZigKICAgICAgICAgICAgIGhvc3RfbWFwX2NyZWF0ZWQg
PSB0cnVlOwogICAgICAgICB9CiAgICAgfQotICAgIGVsc2UgaWYgKCBvd25lciA9PSByZCB8fCBv
d25lciA9PSBkb21fY293ICkKKyAgICBlbHNlIGlmICggb3duZXIgPT0gcmQgfHwgKGRvbV9jb3cg
JiYgb3duZXIgPT0gZG9tX2NvdykgKQogICAgIHsKICAgICAgICAgaWYgKCAob3AtPmZsYWdzICYg
R05UTUFQX2RldmljZV9tYXApICYmICEob3AtPmZsYWdzICYgR05UTUFQX3JlYWRvbmx5KSApCiAg
ICAgICAgIHsKLS0tIGEveGVuL2luY2x1ZGUveGVuL21tLmgKKysrIGIveGVuL2luY2x1ZGUveGVu
L21tLmgKQEAgLTY0NCw2ICs2NDQsOSBAQCBzdGF0aWMgaW5saW5lIHZvaWQgZmlsdGVyZWRfZmx1
c2hfdGxiX21hCiAKIC8qIFByaXZhdGUgZG9tYWluIHN0cnVjdHMgZm9yIERPTUlEX1hFTiwgRE9N
SURfSU8sIGV0Yy4gKi8KIGV4dGVybiBzdHJ1Y3QgZG9tYWluICpkb21feGVuLCAqZG9tX2lvLCAq
ZG9tX2NvdzsKKyNpZm5kZWYgQ09ORklHX0hBU19NRU1fU0hBUklORworIyBkZWZpbmUgZG9tX2Nv
dyBOVUxMCisjZW5kaWYKIAogZW51bSBYRU5TSEFSRV9mbGFncyB7CiAgICAgU0hBUkVfcncsCgoK
CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2
ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xp
c3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 797D721755
	for <lists+xen-devel@lfdr.de>; Fri, 17 May 2019 12:54:45 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hRaTx-00073j-JX; Fri, 17 May 2019 10:52:57 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=mYL4=TR=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1hRaTw-00073V-35
 for xen-devel@lists.xenproject.org; Fri, 17 May 2019 10:52:56 +0000
X-Inumbo-ID: ec1da149-7891-11e9-8980-bc764e045a96
Received: from prv1-mh.provo.novell.com (unknown [137.65.248.33])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id ec1da149-7891-11e9-8980-bc764e045a96;
 Fri, 17 May 2019 10:52:54 +0000 (UTC)
Received: from INET-PRV1-MTA by prv1-mh.provo.novell.com
 with Novell_GroupWise; Fri, 17 May 2019 04:52:53 -0600
Message-Id: <5CDE928602000078002300BD@prv1-mh.provo.novell.com>
X-Mailer: Novell GroupWise Internet Agent 18.1.0 
Date: Fri, 17 May 2019 04:52:54 -0600
From: "Jan Beulich" <JBeulich@suse.com>
To: "xen-devel" <xen-devel@lists.xenproject.org>
References: <5CC6DD090200007800229E80@prv1-mh.provo.novell.com>
 <5CDE8F5B020000780023005F@prv1-mh.provo.novell.com>
In-Reply-To: <5CDE8F5B020000780023005F@prv1-mh.provo.novell.com>
Mime-Version: 1.0
Content-Disposition: inline
Subject: [Xen-devel] [PATCH v3 14/15] x86/IRQ: eliminate some on-stack
 cpumask_t instances
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>, Wei Liu <wei.liu2@citrix.com>,
 Roger Pau Monne <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VXNlIHNjcmF0Y2hfY3B1bWFzayB3aGVyZSBwb3NzaWJsZSwgdG8gYXZvaWQgY3JlYXRpbmcgdGhl
c2UgcG9zc2libHkKbGFyZ2Ugc3RhY2sgb2JqZWN0cy4gV2UgY2FuJ3QgdXNlIGl0IGluIF9hc3Np
Z25faXJxX3ZlY3RvcigpIGFuZApzZXRfZGVzY19hZmZpbml0eSgpLCBhcyB0aGVzZSBnZXQgY2Fs
bGVkIGluIElSUSBjb250ZXh0LgoKU2lnbmVkLW9mZi1ieTogSmFuIEJldWxpY2ggPGpiZXVsaWNo
QHN1c2UuY29tPgotLS0KdjM6IE5ldy4KCi0tLSBhL3hlbi9hcmNoL3g4Ni9pcnEuYworKysgYi94
ZW4vYXJjaC94ODYvaXJxLmMKQEAgLTI4NSwxNCArMjg1LDE1IEBAIHN0YXRpYyB2b2lkIF9jbGVh
cl9pcnFfdmVjdG9yKHN0cnVjdCBpcnEKIHsKICAgICB1bnNpZ25lZCBpbnQgY3B1LCBvbGRfdmVj
dG9yLCBpcnEgPSBkZXNjLT5pcnE7CiAgICAgdW5zaWduZWQgaW50IHZlY3RvciA9IGRlc2MtPmFy
Y2gudmVjdG9yOwotICAgIGNwdW1hc2tfdCB0bXBfbWFzazsKKyAgICBjcHVtYXNrX3QgKnRtcF9t
YXNrID0gdGhpc19jcHUoc2NyYXRjaF9jcHVtYXNrKTsKIAogICAgIEJVR19PTighdmFsaWRfaXJx
X3ZlY3Rvcih2ZWN0b3IpKTsKIAogICAgIC8qIEFsd2F5cyBjbGVhciBkZXNjLT5hcmNoLnZlY3Rv
ciAqLwotICAgIGNwdW1hc2tfYW5kKCZ0bXBfbWFzaywgZGVzYy0+YXJjaC5jcHVfbWFzaywgJmNw
dV9vbmxpbmVfbWFwKTsKKyAgICBjcHVtYXNrX2FuZCh0bXBfbWFzaywgZGVzYy0+YXJjaC5jcHVf
bWFzaywgJmNwdV9vbmxpbmVfbWFwKTsKIAotICAgIGZvcl9lYWNoX2NwdShjcHUsICZ0bXBfbWFz
aykgeworICAgIGZvcl9lYWNoX2NwdShjcHUsIHRtcF9tYXNrKQorICAgIHsKICAgICAgICAgQVNT
RVJUKCBwZXJfY3B1KHZlY3Rvcl9pcnEsIGNwdSlbdmVjdG9yXSA9PSBpcnEgKTsKICAgICAgICAg
cGVyX2NwdSh2ZWN0b3JfaXJxLCBjcHUpW3ZlY3Rvcl0gPSB+aXJxOwogICAgIH0KQEAgLTMwOCwx
NiArMzA5LDE3IEBAIHN0YXRpYyB2b2lkIF9jbGVhcl9pcnFfdmVjdG9yKHN0cnVjdCBpcnEKIAog
ICAgIGRlc2MtPmFyY2gudXNlZCA9IElSUV9VTlVTRUQ7CiAKLSAgICB0cmFjZV9pcnFfbWFzayhU
UkNfSFdfSVJRX0NMRUFSX1ZFQ1RPUiwgaXJxLCB2ZWN0b3IsICZ0bXBfbWFzayk7CisgICAgdHJh
Y2VfaXJxX21hc2soVFJDX0hXX0lSUV9DTEVBUl9WRUNUT1IsIGlycSwgdmVjdG9yLCB0bXBfbWFz
ayk7CiAKICAgICBpZiAoIGxpa2VseSghZGVzYy0+YXJjaC5tb3ZlX2luX3Byb2dyZXNzKSApCiAg
ICAgICAgIHJldHVybjsKIAogICAgIC8qIElmIHdlIHdlcmUgaW4gbW90aW9uLCBhbHNvIGNsZWFy
IGRlc2MtPmFyY2gub2xkX3ZlY3RvciAqLwogICAgIG9sZF92ZWN0b3IgPSBkZXNjLT5hcmNoLm9s
ZF92ZWN0b3I7Ci0gICAgY3B1bWFza19hbmQoJnRtcF9tYXNrLCBkZXNjLT5hcmNoLm9sZF9jcHVf
bWFzaywgJmNwdV9vbmxpbmVfbWFwKTsKKyAgICBjcHVtYXNrX2FuZCh0bXBfbWFzaywgZGVzYy0+
YXJjaC5vbGRfY3B1X21hc2ssICZjcHVfb25saW5lX21hcCk7CiAKLSAgICBmb3JfZWFjaF9jcHUo
Y3B1LCAmdG1wX21hc2spIHsKKyAgICBmb3JfZWFjaF9jcHUoY3B1LCB0bXBfbWFzaykKKyAgICB7
CiAgICAgICAgIEFTU0VSVCggcGVyX2NwdSh2ZWN0b3JfaXJxLCBjcHUpW29sZF92ZWN0b3JdID09
IGlycSApOwogICAgICAgICBUUkFDRV8zRChUUkNfSFdfSVJRX01PVkVfRklOSVNILCBpcnEsIG9s
ZF92ZWN0b3IsIGNwdSk7CiAgICAgICAgIHBlcl9jcHUodmVjdG9yX2lycSwgY3B1KVtvbGRfdmVj
dG9yXSA9IH5pcnE7CkBAIC0xMTU5LDcgKzExNjEsNiBAQCBzdGF0aWMgdm9pZCBpcnFfZ3Vlc3Rf
ZW9pX3RpbWVyX2ZuKHZvaWQKICAgICBzdHJ1Y3QgaXJxX2Rlc2MgKmRlc2MgPSBkYXRhOwogICAg
IHVuc2lnbmVkIGludCBpLCBpcnEgPSBkZXNjIC0gaXJxX2Rlc2M7CiAgICAgaXJxX2d1ZXN0X2Fj
dGlvbl90ICphY3Rpb247Ci0gICAgY3B1bWFza190IGNwdV9lb2lfbWFwOwogCiAgICAgc3Bpbl9s
b2NrX2lycSgmZGVzYy0+bG9jayk7CiAgICAgCkBAIC0xMTg5LDE0ICsxMTkwLDE4IEBAIHN0YXRp
YyB2b2lkIGlycV9ndWVzdF9lb2lfdGltZXJfZm4odm9pZAogCiAgICAgc3dpdGNoICggYWN0aW9u
LT5hY2tfdHlwZSApCiAgICAgeworICAgICAgICBjcHVtYXNrX3QgKmNwdV9lb2lfbWFwOworCiAg
ICAgY2FzZSBBQ0tUWVBFX1VOTUFTSzoKICAgICAgICAgaWYgKCBkZXNjLT5oYW5kbGVyLT5lbmQg
KQogICAgICAgICAgICAgZGVzYy0+aGFuZGxlci0+ZW5kKGRlc2MsIDApOwogICAgICAgICBicmVh
azsKKwogICAgIGNhc2UgQUNLVFlQRV9FT0k6Ci0gICAgICAgIGNwdW1hc2tfY29weSgmY3B1X2Vv
aV9tYXAsIGFjdGlvbi0+Y3B1X2VvaV9tYXApOworICAgICAgICBjcHVfZW9pX21hcCA9IHRoaXNf
Y3B1KHNjcmF0Y2hfY3B1bWFzayk7CisgICAgICAgIGNwdW1hc2tfY29weShjcHVfZW9pX21hcCwg
YWN0aW9uLT5jcHVfZW9pX21hcCk7CiAgICAgICAgIHNwaW5fdW5sb2NrX2lycSgmZGVzYy0+bG9j
ayk7Ci0gICAgICAgIG9uX3NlbGVjdGVkX2NwdXMoJmNwdV9lb2lfbWFwLCBzZXRfZW9pX3JlYWR5
LCBkZXNjLCAwKTsKKyAgICAgICAgb25fc2VsZWN0ZWRfY3B1cyhjcHVfZW9pX21hcCwgc2V0X2Vv
aV9yZWFkeSwgZGVzYywgMCk7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKQEAgLTI0MzcsNyAr
MjQ0Miw3IEBAIHZvaWQgZml4dXBfaXJxcyhjb25zdCBjcHVtYXNrX3QgKm1hc2ssIGIKICAgICB7
CiAgICAgICAgIGJvb2wgYnJlYWtfYWZmaW5pdHkgPSBmYWxzZSwgc2V0X2FmZmluaXR5ID0gdHJ1
ZTsKICAgICAgICAgdW5zaWduZWQgaW50IHZlY3RvcjsKLSAgICAgICAgY3B1bWFza190IGFmZmlu
aXR5OworICAgICAgICBjcHVtYXNrX3QgKmFmZmluaXR5ID0gdGhpc19jcHUoc2NyYXRjaF9jcHVt
YXNrKTsKIAogICAgICAgICBpZiAoIGlycSA9PSAyICkKICAgICAgICAgICAgIGNvbnRpbnVlOwpA
QCAtMjQ2OCw5ICsyNDczLDkgQEAgdm9pZCBmaXh1cF9pcnFzKGNvbnN0IGNwdW1hc2tfdCAqbWFz
aywgYgogICAgICAgICBpZiAoIGRlc2MtPmFyY2gubW92ZV9jbGVhbnVwX2NvdW50ICkKICAgICAg
ICAgewogICAgICAgICAgICAgLyogVGhlIGNsZWFudXAgSVBJIG1heSBoYXZlIGdvdCBzZW50IHdo
aWxlIHdlIHdlcmUgc3RpbGwgb25saW5lLiAqLwotICAgICAgICAgICAgY3B1bWFza19hbmRub3Qo
JmFmZmluaXR5LCBkZXNjLT5hcmNoLm9sZF9jcHVfbWFzaywKKyAgICAgICAgICAgIGNwdW1hc2tf
YW5kbm90KGFmZmluaXR5LCBkZXNjLT5hcmNoLm9sZF9jcHVfbWFzaywKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICZjcHVfb25saW5lX21hcCk7Ci0gICAgICAgICAgICBkZXNjLT5hcmNoLm1v
dmVfY2xlYW51cF9jb3VudCAtPSBjcHVtYXNrX3dlaWdodCgmYWZmaW5pdHkpOworICAgICAgICAg
ICAgZGVzYy0+YXJjaC5tb3ZlX2NsZWFudXBfY291bnQgLT0gY3B1bWFza193ZWlnaHQoYWZmaW5p
dHkpOwogICAgICAgICAgICAgaWYgKCAhZGVzYy0+YXJjaC5tb3ZlX2NsZWFudXBfY291bnQgKQog
ICAgICAgICAgICAgICAgIHJlbGVhc2Vfb2xkX3ZlYyhkZXNjKTsKICAgICAgICAgfQpAQCAtMjQ5
NywxMCArMjUwMiwxMCBAQCB2b2lkIGZpeHVwX2lycXMoY29uc3QgY3B1bWFza190ICptYXNrLCBi
CiAgICAgICAgIHsKICAgICAgICAgICAgIHVuc2lnbmVkIGludCBjcHU7CiAKLSAgICAgICAgICAg
IGNwdW1hc2tfYW5kKCZhZmZpbml0eSwgZGVzYy0+YXJjaC5vbGRfY3B1X21hc2ssICZjcHVfb25s
aW5lX21hcCk7CisgICAgICAgICAgICBjcHVtYXNrX2FuZChhZmZpbml0eSwgZGVzYy0+YXJjaC5v
bGRfY3B1X21hc2ssICZjcHVfb25saW5lX21hcCk7CiAKICAgICAgICAgICAgIHNwaW5fbG9jaygm
dmVjdG9yX2xvY2spOwotICAgICAgICAgICAgZm9yX2VhY2hfY3B1KGNwdSwgJmFmZmluaXR5KQor
ICAgICAgICAgICAgZm9yX2VhY2hfY3B1KGNwdSwgYWZmaW5pdHkpCiAgICAgICAgICAgICAgICAg
cGVyX2NwdSh2ZWN0b3JfaXJxLCBjcHUpW2Rlc2MtPmFyY2gub2xkX3ZlY3Rvcl0gPSB+aXJxOwog
ICAgICAgICAgICAgc3Bpbl91bmxvY2soJnZlY3Rvcl9sb2NrKTsKIApAQCAtMjUxMSwyMyArMjUx
NiwyMyBAQCB2b2lkIGZpeHVwX2lycXMoY29uc3QgY3B1bWFza190ICptYXNrLCBiCiAgICAgICAg
IGlmICggIWNwdW1hc2tfaW50ZXJzZWN0cyhtYXNrLCBkZXNjLT5hZmZpbml0eSkgKQogICAgICAg
ICB7CiAgICAgICAgICAgICBicmVha19hZmZpbml0eSA9IHRydWU7Ci0gICAgICAgICAgICBjcHVt
YXNrX3NldGFsbCgmYWZmaW5pdHkpOworICAgICAgICAgICAgY3B1bWFza19zZXRhbGwoYWZmaW5p
dHkpOwogICAgICAgICB9CiAgICAgICAgIGVsc2UKLSAgICAgICAgICAgIGNwdW1hc2tfY29weSgm
YWZmaW5pdHksIGRlc2MtPmFmZmluaXR5KTsKKyAgICAgICAgICAgIGNwdW1hc2tfY29weShhZmZp
bml0eSwgZGVzYy0+YWZmaW5pdHkpOwogCiAgICAgICAgIGlmICggZGVzYy0+aGFuZGxlci0+ZGlz
YWJsZSApCiAgICAgICAgICAgICBkZXNjLT5oYW5kbGVyLT5kaXNhYmxlKGRlc2MpOwogCiAgICAg
ICAgIGlmICggZGVzYy0+aGFuZGxlci0+c2V0X2FmZmluaXR5ICkKLSAgICAgICAgICAgIGRlc2Mt
PmhhbmRsZXItPnNldF9hZmZpbml0eShkZXNjLCAmYWZmaW5pdHkpOworICAgICAgICAgICAgZGVz
Yy0+aGFuZGxlci0+c2V0X2FmZmluaXR5KGRlc2MsIGFmZmluaXR5KTsKICAgICAgICAgZWxzZSBp
ZiAoICEod2FybmVkKyspICkKICAgICAgICAgICAgIHNldF9hZmZpbml0eSA9IGZhbHNlOwogCiAg
ICAgICAgIGlmICggZGVzYy0+aGFuZGxlci0+ZW5hYmxlICkKICAgICAgICAgICAgIGRlc2MtPmhh
bmRsZXItPmVuYWJsZShkZXNjKTsKIAotICAgICAgICBjcHVtYXNrX2NvcHkoJmFmZmluaXR5LCBk
ZXNjLT5hZmZpbml0eSk7CisgICAgICAgIGNwdW1hc2tfY29weShhZmZpbml0eSwgZGVzYy0+YWZm
aW5pdHkpOwogCiAgICAgICAgIHNwaW5fdW5sb2NrKCZkZXNjLT5sb2NrKTsKIApAQCAtMjUzOCw3
ICsyNTQzLDcgQEAgdm9pZCBmaXh1cF9pcnFzKGNvbnN0IGNwdW1hc2tfdCAqbWFzaywgYgogICAg
ICAgICAgICAgcHJpbnRrKCJDYW5ub3Qgc2V0IGFmZmluaXR5IGZvciBJUlEldVxuIiwgaXJxKTsK
ICAgICAgICAgZWxzZSBpZiAoIGJyZWFrX2FmZmluaXR5ICkKICAgICAgICAgICAgIHByaW50aygi
QnJva2UgYWZmaW5pdHkgZm9yIElSUSV1LCBuZXc6ICUqcGJcbiIsCi0gICAgICAgICAgICAgICAg
ICAgaXJxLCBucl9jcHVfaWRzLCAmYWZmaW5pdHkpOworICAgICAgICAgICAgICAgICAgIGlycSwg
bnJfY3B1X2lkcywgYWZmaW5pdHkpOwogICAgIH0KIAogICAgIC8qIFRoYXQgZG9lc24ndCBzZWVt
IHN1ZmZpY2llbnQuICBHaXZlIGl0IDFtcy4gKi8KCgoKCl9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVs
QGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1h
bi9saXN0aW5mby94ZW4tZGV2ZWw=

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id C80A21A116
	for <lists+xen-devel@lfdr.de>; Fri, 10 May 2019 18:15:14 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hP87g-0004WE-Lf; Fri, 10 May 2019 16:11:48 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=35pT=TK=citrix.com=prvs=026e1af23=roger.pau@srs-us1.protection.inumbo.net>)
 id 1hP87f-0004W0-Pe
 for xen-devel@lists.xenproject.org; Fri, 10 May 2019 16:11:47 +0000
X-Inumbo-ID: 4d22e641-733e-11e9-8980-bc764e045a96
Received: from SMTP03.CITRIX.COM (unknown [162.221.156.55])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 4d22e641-733e-11e9-8980-bc764e045a96;
 Fri, 10 May 2019 16:11:43 +0000 (UTC)
X-IronPort-AV: E=Sophos;i="5.60,453,1549929600"; d="scan'208";a="85330710"
From: Roger Pau Monne <roger.pau@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Fri, 10 May 2019 18:10:52 +0200
Message-ID: <20190510161056.48648-2-roger.pau@citrix.com>
X-Mailer: git-send-email 2.17.2 (Apple Git-113)
In-Reply-To: <20190510161056.48648-1-roger.pau@citrix.com>
References: <20190510161056.48648-1-roger.pau@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH 1/5] pci: use pci_sbdf_t in pci_dev
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Kevin Tian <kevin.tian@intel.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wei.liu2@citrix.com>,
 Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>,
 Brian Woods <brian.woods@amd.com>, Roger Pau Monne <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhpcyBwYXRjaCByZXBsYWNlcyB0aGUgc2VnLCBidXMgYW5kIGRldmZuIGZpZWxkcyBvZiB0aGUg
c3RydWN0IGFuZApmaXhlcyB0aGUgY2FsbGVycy4gV2hpbGUgdGhlcmUgaW5zdGFuY2VzIG9mIHU8
c2l6ZT4gaGF2ZSBhbHNvIGJlZW4KcmVwbGFjZWQgd2l0aCB1aW50PHNpemU+X3QuCgpObyBmdW5j
dGlvbmFsIGNoYW5nZSBpbnRlbmRlZC4KClNpZ25lZC1vZmYtYnk6IFJvZ2VyIFBhdSBNb25uw6kg
PHJvZ2VyLnBhdUBjaXRyaXguY29tPgotLS0KQ2M6IEphbiBCZXVsaWNoIDxqYmV1bGljaEBzdXNl
LmNvbT4KQ2M6IEFuZHJldyBDb29wZXIgPGFuZHJldy5jb29wZXIzQGNpdHJpeC5jb20+CkNjOiBX
ZWkgTGl1IDx3ZWkubGl1MkBjaXRyaXguY29tPgpDYzogR2VvcmdlIER1bmxhcCA8R2VvcmdlLkR1
bmxhcEBldS5jaXRyaXguY29tPgpDYzogSWFuIEphY2tzb24gPGlhbi5qYWNrc29uQGV1LmNpdHJp
eC5jb20+CkNjOiBKdWxpZW4gR3JhbGwgPGp1bGllbi5ncmFsbEBhcm0uY29tPgpDYzogS29ucmFk
IFJ6ZXN6dXRlayBXaWxrIDxrb25yYWQud2lsa0BvcmFjbGUuY29tPgpDYzogU3RlZmFubyBTdGFi
ZWxsaW5pIDxzc3RhYmVsbGluaUBrZXJuZWwub3JnPgpDYzogVGltIERlZWdhbiA8dGltQHhlbi5v
cmc+CkNjOiBTdXJhdmVlIFN1dGhpa3VscGFuaXQgPHN1cmF2ZWUuc3V0aGlrdWxwYW5pdEBhbWQu
Y29tPgpDYzogQnJpYW4gV29vZHMgPGJyaWFuLndvb2RzQGFtZC5jb20+CkNjOiBLZXZpbiBUaWFu
IDxrZXZpbi50aWFuQGludGVsLmNvbT4KLS0tCiB4ZW4vYXJjaC94ODYvaHZtL3Ztc2kuYyAgICAg
ICAgICAgICAgICAgICAgIHwgIDE0ICstCiB4ZW4vYXJjaC94ODYvbXNpLmMgICAgICAgICAgICAg
ICAgICAgICAgICAgIHwgMTM2ICsrKysrKysrLS0tLS0tLS0KIHhlbi9kcml2ZXJzL3Bhc3N0aHJv
dWdoL2FtZC9pb21tdV9jbWQuYyAgICAgfCAgMTYgKy0KIHhlbi9kcml2ZXJzL3Bhc3N0aHJvdWdo
L2FtZC9pb21tdV9pbnRyLmMgICAgfCAgMTQgKy0KIHhlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2Ft
ZC9pb21tdV9tYXAuYyAgICAgfCAgMTAgKy0KIHhlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9w
Y2lfYW1kX2lvbW11LmMgfCAgNTggKysrKy0tLQogeGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvcGNp
LmMgICAgICAgICAgICAgICB8IDE2MiArKysrKysrKysrLS0tLS0tLS0tLQogeGVuL2RyaXZlcnMv
cGFzc3Rocm91Z2gvdnRkL2RtYXIuYyAgICAgICAgICB8ICAxMiArLQogeGVuL2RyaXZlcnMvcGFz
c3Rocm91Z2gvdnRkL2ludHJlbWFwLmMgICAgICB8ICAgOCArLQogeGVuL2RyaXZlcnMvcGFzc3Ro
cm91Z2gvdnRkL2lvbW11LmMgICAgICAgICB8ICAzNCArKy0tCiB4ZW4vZHJpdmVycy9wYXNzdGhy
b3VnaC92dGQvcWludmFsLmMgICAgICAgIHwgICAyICstCiB4ZW4vZHJpdmVycy9wYXNzdGhyb3Vn
aC92dGQvcXVpcmtzLmMgICAgICAgIHwgIDE2ICstCiB4ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC92
dGQveDg2L2F0cy5jICAgICAgIHwgIDEyICstCiB4ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC94ODYv
YXRzLmMgICAgICAgICAgIHwgICA4ICstCiB4ZW4vZHJpdmVycy9wY2kvcGNpLmMgICAgICAgICAg
ICAgICAgICAgICAgIHwgICA4ICstCiB4ZW4vZHJpdmVycy92cGNpL2hlYWRlci5jICAgICAgICAg
ICAgICAgICAgIHwgIDc0ICsrKystLS0tLQogeGVuL2RyaXZlcnMvdnBjaS9tc2kuYyAgICAgICAg
ICAgICAgICAgICAgICB8ICAyMSArKy0KIHhlbi9kcml2ZXJzL3ZwY2kvbXNpeC5jICAgICAgICAg
ICAgICAgICAgICAgfCAgMzYgKysrLS0KIHhlbi9kcml2ZXJzL3ZwY2kvdnBjaS5jICAgICAgICAg
ICAgICAgICAgICAgfCAgIDggKy0KIHhlbi9pbmNsdWRlL3hlbi9wY2kuaCAgICAgICAgICAgICAg
ICAgICAgICAgfCAgIDUgKy0KIDIwIGZpbGVzIGNoYW5nZWQsIDMyMiBpbnNlcnRpb25zKCspLCAz
MzIgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L2h2bS92bXNpLmMgYi94
ZW4vYXJjaC94ODYvaHZtL3Ztc2kuYwppbmRleCBhZWI1YTcwMTA0Li4xNWNmZThkMDU3IDEwMDY0
NAotLS0gYS94ZW4vYXJjaC94ODYvaHZtL3Ztc2kuYworKysgYi94ZW4vYXJjaC94ODYvaHZtL3Zt
c2kuYwpAQCAtNjg4LDggKzY4OCw4IEBAIHN0YXRpYyBpbnQgdnBjaV9tc2lfdXBkYXRlKGNvbnN0
IHN0cnVjdCBwY2lfZGV2ICpwZGV2LCB1aW50MzJfdCBkYXRhLAogICAgICAgICB7CiAgICAgICAg
ICAgICBnZHByaW50ayhYRU5MT0dfRVJSLAogICAgICAgICAgICAgICAgICAgICAgIiUwNHg6JTAy
eDolMDJ4LiV1OiBmYWlsZWQgdG8gYmluZCBQSVJRICV1OiAlZFxuIiwKLSAgICAgICAgICAgICAg
ICAgICAgIHBkZXYtPnNlZywgcGRldi0+YnVzLCBQQ0lfU0xPVChwZGV2LT5kZXZmbiksCi0gICAg
ICAgICAgICAgICAgICAgICBQQ0lfRlVOQyhwZGV2LT5kZXZmbiksIHBpcnEgKyBpLCByYyk7Cisg
ICAgICAgICAgICAgICAgICAgICBwZGV2LT5zYmRmLnNlZywgcGRldi0+c2JkZi5idXMsIHBkZXYt
PnNiZGYuZGV2LAorICAgICAgICAgICAgICAgICAgICAgcGRldi0+c2JkZi5mdW5jLCBwaXJxICsg
aSwgcmMpOwogICAgICAgICAgICAgd2hpbGUgKCBiaW5kLm1hY2hpbmVfaXJxLS0gPiBwaXJxICkK
ICAgICAgICAgICAgICAgICBwdF9pcnFfZGVzdHJveV9iaW5kKHBkZXYtPmRvbWFpbiwgJmJpbmQp
OwogICAgICAgICAgICAgcmV0dXJuIHJjOwpAQCAtNzI3LDkgKzcyNyw5IEBAIHN0YXRpYyBpbnQg
dnBjaV9tc2lfZW5hYmxlKGNvbnN0IHN0cnVjdCBwY2lfZGV2ICpwZGV2LCB1aW50MzJfdCBkYXRh
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFkZHJfdCB0YWJsZV9iYXNlLCB1aW50MzJf
dCBtYXNrKQogewogICAgIHN0cnVjdCBtc2lfaW5mbyBtc2lfaW5mbyA9IHsKLSAgICAgICAgLnNl
ZyA9IHBkZXYtPnNlZywKLSAgICAgICAgLmJ1cyA9IHBkZXYtPmJ1cywKLSAgICAgICAgLmRldmZu
ID0gcGRldi0+ZGV2Zm4sCisgICAgICAgIC5zZWcgPSBwZGV2LT5zYmRmLnNlZywKKyAgICAgICAg
LmJ1cyA9IHBkZXYtPnNiZGYuYnVzLAorICAgICAgICAuZGV2Zm4gPSBwZGV2LT5zYmRmLmV4dGZ1
bmMsCiAgICAgICAgIC50YWJsZV9iYXNlID0gdGFibGVfYmFzZSwKICAgICAgICAgLmVudHJ5X25y
ID0gbnIsCiAgICAgfTsKQEAgLTc0NCw4ICs3NDQsOCBAQCBzdGF0aWMgaW50IHZwY2lfbXNpX2Vu
YWJsZShjb25zdCBzdHJ1Y3QgcGNpX2RldiAqcGRldiwgdWludDMyX3QgZGF0YSwKICAgICBpZiAo
IHJjICkKICAgICB7CiAgICAgICAgIGdkcHJpbnRrKFhFTkxPR19FUlIsICIlMDR4OiUwMng6JTAy
eC4ldTogZmFpbGVkIHRvIG1hcCBQSVJROiAlZFxuIiwKLSAgICAgICAgICAgICAgICAgcGRldi0+
c2VnLCBwZGV2LT5idXMsIFBDSV9TTE9UKHBkZXYtPmRldmZuKSwKLSAgICAgICAgICAgICAgICAg
UENJX0ZVTkMocGRldi0+ZGV2Zm4pLCByYyk7CisgICAgICAgICAgICAgICAgIHBkZXYtPnNiZGYu
c2VnLCBwZGV2LT5zYmRmLmJ1cywgcGRldi0+c2JkZi5kZXYsCisgICAgICAgICAgICAgICAgIHBk
ZXYtPnNiZGYuZnVuYywgcmMpOwogICAgICAgICByZXR1cm4gcmM7CiAgICAgfQogCmRpZmYgLS1n
aXQgYS94ZW4vYXJjaC94ODYvbXNpLmMgYi94ZW4vYXJjaC94ODYvbXNpLmMKaW5kZXggYmFiYzQx
NDdjNC4uZjMwZjU5MmVlMiAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L21zaS5jCisrKyBiL3hl
bi9hcmNoL3g4Ni9tc2kuYwpAQCAtMTI0LDEzICsxMjQsMTMgQEAgc3RhdGljIHZvaWQgbXNpeF9w
dXRfZml4bWFwKHN0cnVjdCBhcmNoX21zaXggKm1zaXgsIGludCBpZHgpCiAKIHN0YXRpYyBib29s
IG1lbW9yeV9kZWNvZGVkKGNvbnN0IHN0cnVjdCBwY2lfZGV2ICpkZXYpCiB7Ci0gICAgdTggYnVz
LCBzbG90LCBmdW5jOworICAgIHVpbnQ4X3QgYnVzLCBzbG90LCBmdW5jOwogCiAgICAgaWYgKCAh
ZGV2LT5pbmZvLmlzX3ZpcnRmbiApCiAgICAgewotICAgICAgICBidXMgPSBkZXYtPmJ1czsKLSAg
ICAgICAgc2xvdCA9IFBDSV9TTE9UKGRldi0+ZGV2Zm4pOwotICAgICAgICBmdW5jID0gUENJX0ZV
TkMoZGV2LT5kZXZmbik7CisgICAgICAgIGJ1cyA9IGRldi0+c2JkZi5idXM7CisgICAgICAgIHNs
b3QgPSBkZXYtPnNiZGYuZGV2OworICAgICAgICBmdW5jID0gZGV2LT5zYmRmLmZ1bmM7CiAgICAg
fQogICAgIGVsc2UKICAgICB7CkBAIC0xMzksMTQgKzEzOSwxNCBAQCBzdGF0aWMgYm9vbCBtZW1v
cnlfZGVjb2RlZChjb25zdCBzdHJ1Y3QgcGNpX2RldiAqZGV2KQogICAgICAgICBmdW5jID0gUENJ
X0ZVTkMoZGV2LT5pbmZvLnBoeXNmbi5kZXZmbik7CiAgICAgfQogCi0gICAgcmV0dXJuICEhKHBj
aV9jb25mX3JlYWQxNihkZXYtPnNlZywgYnVzLCBzbG90LCBmdW5jLCBQQ0lfQ09NTUFORCkgJgor
ICAgIHJldHVybiAhIShwY2lfY29uZl9yZWFkMTYoZGV2LT5zYmRmLnNlZywgYnVzLCBzbG90LCBm
dW5jLCBQQ0lfQ09NTUFORCkgJgogICAgICAgICAgICAgICBQQ0lfQ09NTUFORF9NRU1PUlkpOwog
fQogCiBzdGF0aWMgYm9vbCBtc2l4X21lbW9yeV9kZWNvZGVkKGNvbnN0IHN0cnVjdCBwY2lfZGV2
ICpkZXYsIHVuc2lnbmVkIGludCBwb3MpCiB7Ci0gICAgdTE2IGNvbnRyb2wgPSBwY2lfY29uZl9y
ZWFkMTYoZGV2LT5zZWcsIGRldi0+YnVzLCBQQ0lfU0xPVChkZXYtPmRldmZuKSwKLSAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lfRlVOQyhkZXYtPmRldmZuKSwgbXNpeF9jb250
cm9sX3JlZyhwb3MpKTsKKyAgICB1MTYgY29udHJvbCA9IHBjaV9jb25mX3JlYWQxNihkZXYtPnNi
ZGYuc2VnLCBkZXYtPnNiZGYuYnVzLCBkZXYtPnNiZGYuZGV2LAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGRldi0+c2JkZi5mdW5jLCBtc2l4X2NvbnRyb2xfcmVnKHBvcykpOwog
CiAgICAgaWYgKCAhKGNvbnRyb2wgJiBQQ0lfTVNJWF9GTEFHU19FTkFCTEUpICkKICAgICAgICAg
cmV0dXJuIGZhbHNlOwpAQCAtMjAwLDEwICsyMDAsMTAgQEAgc3RhdGljIGJvb2wgcmVhZF9tc2lf
bXNnKHN0cnVjdCBtc2lfZGVzYyAqZW50cnksIHN0cnVjdCBtc2lfbXNnICptc2cpCiAgICAgewog
ICAgICAgICBzdHJ1Y3QgcGNpX2RldiAqZGV2ID0gZW50cnktPmRldjsKICAgICAgICAgaW50IHBv
cyA9IGVudHJ5LT5tc2lfYXR0cmliLnBvczsKLSAgICAgICAgdTE2IGRhdGEsIHNlZyA9IGRldi0+
c2VnOwotICAgICAgICB1OCBidXMgPSBkZXYtPmJ1czsKLSAgICAgICAgdTggc2xvdCA9IFBDSV9T
TE9UKGRldi0+ZGV2Zm4pOwotICAgICAgICB1OCBmdW5jID0gUENJX0ZVTkMoZGV2LT5kZXZmbik7
CisgICAgICAgIHVpbnQxNl90IGRhdGEsIHNlZyA9IGRldi0+c2JkZi5zZWc7CisgICAgICAgIHVp
bnQ4X3QgYnVzID0gZGV2LT5zYmRmLmJ1czsKKyAgICAgICAgdWludDhfdCBzbG90ID0gZGV2LT5z
YmRmLmRldjsKKyAgICAgICAgdWludDhfdCBmdW5jID0gZGV2LT5zYmRmLmZ1bmM7CiAKICAgICAg
ICAgbXNnLT5hZGRyZXNzX2xvID0gcGNpX2NvbmZfcmVhZDMyKHNlZywgYnVzLCBzbG90LCBmdW5j
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNpX2xvd2VyX2Fk
ZHJlc3NfcmVnKHBvcykpOwpAQCAtMjY1LDEwICsyNjUsMTAgQEAgc3RhdGljIGludCB3cml0ZV9t
c2lfbXNnKHN0cnVjdCBtc2lfZGVzYyAqZW50cnksIHN0cnVjdCBtc2lfbXNnICptc2cpCiAgICAg
ewogICAgICAgICBzdHJ1Y3QgcGNpX2RldiAqZGV2ID0gZW50cnktPmRldjsKICAgICAgICAgaW50
IHBvcyA9IGVudHJ5LT5tc2lfYXR0cmliLnBvczsKLSAgICAgICAgdTE2IHNlZyA9IGRldi0+c2Vn
OwotICAgICAgICB1OCBidXMgPSBkZXYtPmJ1czsKLSAgICAgICAgdTggc2xvdCA9IFBDSV9TTE9U
KGRldi0+ZGV2Zm4pOwotICAgICAgICB1OCBmdW5jID0gUENJX0ZVTkMoZGV2LT5kZXZmbik7Cisg
ICAgICAgIHVpbnQxNl90IHNlZyA9IGRldi0+c2JkZi5zZWc7CisgICAgICAgIHVpbnQ4X3QgYnVz
ID0gZGV2LT5zYmRmLmJ1czsKKyAgICAgICAgdWludDhfdCBzbG90ID0gZGV2LT5zYmRmLmRldjsK
KyAgICAgICAgdWludDhfdCBmdW5jID0gZGV2LT5zYmRmLmZ1bmM7CiAgICAgICAgIGludCBuciA9
IGVudHJ5LT5tc2lfYXR0cmliLmVudHJ5X25yOwogCiAgICAgICAgIEFTU0VSVCgobXNnLT5kYXRh
ICYgKGVudHJ5Wy1ucl0ubXNpLm52ZWMgLSAxKSkgPT0gbnIpOwpAQCAtMzQ4LDEwICszNDgsMTAg
QEAgdm9pZCBfX21zaV9zZXRfZW5hYmxlKHUxNiBzZWcsIHU4IGJ1cywgdTggc2xvdCwgdTggZnVu
YywgaW50IHBvcywgaW50IGVuYWJsZSkKIHN0YXRpYyB2b2lkIG1zaV9zZXRfZW5hYmxlKHN0cnVj
dCBwY2lfZGV2ICpkZXYsIGludCBlbmFibGUpCiB7CiAgICAgaW50IHBvczsKLSAgICB1MTYgc2Vn
ID0gZGV2LT5zZWc7Ci0gICAgdTggYnVzID0gZGV2LT5idXM7Ci0gICAgdTggc2xvdCA9IFBDSV9T
TE9UKGRldi0+ZGV2Zm4pOwotICAgIHU4IGZ1bmMgPSBQQ0lfRlVOQyhkZXYtPmRldmZuKTsKKyAg
ICB1aW50MTZfdCBzZWcgPSBkZXYtPnNiZGYuc2VnOworICAgIHVpbnQ4X3QgYnVzID0gZGV2LT5z
YmRmLmJ1czsKKyAgICB1aW50OF90IHNsb3QgPSBkZXYtPnNiZGYuZGV2OworICAgIHVpbnQ4X3Qg
ZnVuYyA9IGRldi0+c2JkZi5mdW5jOwogCiAgICAgcG9zID0gcGNpX2ZpbmRfY2FwX29mZnNldChz
ZWcsIGJ1cywgc2xvdCwgZnVuYywgUENJX0NBUF9JRF9NU0kpOwogICAgIGlmICggcG9zICkKQEAg
LTM2MSwxMCArMzYxLDEwIEBAIHN0YXRpYyB2b2lkIG1zaV9zZXRfZW5hYmxlKHN0cnVjdCBwY2lf
ZGV2ICpkZXYsIGludCBlbmFibGUpCiBzdGF0aWMgdm9pZCBtc2l4X3NldF9lbmFibGUoc3RydWN0
IHBjaV9kZXYgKmRldiwgaW50IGVuYWJsZSkKIHsKICAgICBpbnQgcG9zOwotICAgIHUxNiBjb250
cm9sLCBzZWcgPSBkZXYtPnNlZzsKLSAgICB1OCBidXMgPSBkZXYtPmJ1czsKLSAgICB1OCBzbG90
ID0gUENJX1NMT1QoZGV2LT5kZXZmbik7Ci0gICAgdTggZnVuYyA9IFBDSV9GVU5DKGRldi0+ZGV2
Zm4pOworICAgIHVpbnQxNl90IGNvbnRyb2wsIHNlZyA9IGRldi0+c2JkZi5zZWc7CisgICAgdWlu
dDhfdCBidXMgPSBkZXYtPnNiZGYuYnVzOworICAgIHVpbnQ4X3Qgc2xvdCA9IGRldi0+c2JkZi5k
ZXY7CisgICAgdWludDhfdCBmdW5jID0gZGV2LT5zYmRmLmZ1bmM7CiAKICAgICBwb3MgPSBwY2lf
ZmluZF9jYXBfb2Zmc2V0KHNlZywgYnVzLCBzbG90LCBmdW5jLCBQQ0lfQ0FQX0lEX01TSVgpOwog
ICAgIGlmICggcG9zICkKQEAgLTM4OCwxNyArMzg4LDE3IEBAIHN0YXRpYyBib29sIG1zaV9zZXRf
bWFza19iaXQoc3RydWN0IGlycV9kZXNjICpkZXNjLCBib29sIGhvc3QsIGJvb2wgZ3Vlc3QpCiB7
CiAgICAgc3RydWN0IG1zaV9kZXNjICplbnRyeSA9IGRlc2MtPm1zaV9kZXNjOwogICAgIHN0cnVj
dCBwY2lfZGV2ICpwZGV2OwotICAgIHUxNiBzZWcsIGNvbnRyb2w7Ci0gICAgdTggYnVzLCBzbG90
LCBmdW5jOworICAgIHVpbnQxNl90IHNlZywgY29udHJvbDsKKyAgICB1aW50OF90IGJ1cywgc2xv
dCwgZnVuYzsKICAgICBib29sIGZsYWcgPSBob3N0IHx8IGd1ZXN0LCBtYXNrYWxsOwogCiAgICAg
QVNTRVJUKHNwaW5faXNfbG9ja2VkKCZkZXNjLT5sb2NrKSk7CiAgICAgQlVHX09OKCFlbnRyeSB8
fCAhZW50cnktPmRldik7CiAgICAgcGRldiA9IGVudHJ5LT5kZXY7Ci0gICAgc2VnID0gcGRldi0+
c2VnOwotICAgIGJ1cyA9IHBkZXYtPmJ1czsKLSAgICBzbG90ID0gUENJX1NMT1QocGRldi0+ZGV2
Zm4pOwotICAgIGZ1bmMgPSBQQ0lfRlVOQyhwZGV2LT5kZXZmbik7CisgICAgc2VnID0gcGRldi0+
c2JkZi5zZWc7CisgICAgYnVzID0gcGRldi0+c2JkZi5idXM7CisgICAgc2xvdCA9IHBkZXYtPnNi
ZGYuZGV2OworICAgIGZ1bmMgPSBwZGV2LT5zYmRmLmZ1bmM7CiAgICAgc3dpdGNoICggZW50cnkt
Pm1zaV9hdHRyaWIudHlwZSApCiAgICAgewogICAgIGNhc2UgUENJX0NBUF9JRF9NU0k6CkBAIC00
NzUsOSArNDc1LDggQEAgc3RhdGljIGludCBtc2lfZ2V0X21hc2tfYml0KGNvbnN0IHN0cnVjdCBt
c2lfZGVzYyAqZW50cnkpCiAgICAgY2FzZSBQQ0lfQ0FQX0lEX01TSToKICAgICAgICAgaWYgKCAh
ZW50cnktPm1zaV9hdHRyaWIubWFza2JpdCApCiAgICAgICAgICAgICBicmVhazsKLSAgICAgICAg
cmV0dXJuIChwY2lfY29uZl9yZWFkMzIoZW50cnktPmRldi0+c2VnLCBlbnRyeS0+ZGV2LT5idXMs
Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9TTE9UKGVudHJ5LT5kZXYtPmRl
dmZuKSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX0ZVTkMoZW50cnktPmRl
di0+ZGV2Zm4pLAorICAgICAgICByZXR1cm4gKHBjaV9jb25mX3JlYWQzMihlbnRyeS0+ZGV2LT5z
YmRmLnNlZywgZW50cnktPmRldi0+c2JkZi5idXMsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGVudHJ5LT5kZXYtPnNiZGYuZGV2LCBlbnRyeS0+ZGV2LT5zYmRmLmZ1bmMsCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudHJ5LT5tc2kubXBvcykgPj4KICAgICAgICAg
ICAgICAgICBlbnRyeS0+bXNpX2F0dHJpYi5lbnRyeV9ucikgJiAxOwogICAgIGNhc2UgUENJX0NB
UF9JRF9NU0lYOgpAQCAtNTk0LDExICs1OTMsMTEgQEAgaW50IHNldHVwX21zaV9pcnEoc3RydWN0
IGlycV9kZXNjICpkZXNjLCBzdHJ1Y3QgbXNpX2Rlc2MgKm1zaWRlc2MpCiAKICAgICBpZiAoIG1z
aWRlc2MtPm1zaV9hdHRyaWIudHlwZSA9PSBQQ0lfQ0FQX0lEX01TSVggKQogICAgIHsKLSAgICAg
ICAgY29udHJvbCA9IHBjaV9jb25mX3JlYWQxNihwZGV2LT5zZWcsIHBkZXYtPmJ1cywgUENJX1NM
T1QocGRldi0+ZGV2Zm4pLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9G
VU5DKHBkZXYtPmRldmZuKSwgY3Bvcyk7CisgICAgICAgIGNvbnRyb2wgPSBwY2lfY29uZl9yZWFk
MTYocGRldi0+c2JkZi5zZWcsIHBkZXYtPnNiZGYuYnVzLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHBkZXYtPnNiZGYuZGV2LCBwZGV2LT5zYmRmLmZ1bmMsIGNwb3MpOwogICAg
ICAgICBpZiAoICEoY29udHJvbCAmIFBDSV9NU0lYX0ZMQUdTX0VOQUJMRSkgKQotICAgICAgICAg
ICAgcGNpX2NvbmZfd3JpdGUxNihwZGV2LT5zZWcsIHBkZXYtPmJ1cywgUENJX1NMT1QocGRldi0+
ZGV2Zm4pLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lfRlVOQyhwZGV2LT5kZXZm
biksIGNwb3MsCisgICAgICAgICAgICBwY2lfY29uZl93cml0ZTE2KHBkZXYtPnNiZGYuc2VnLCBw
ZGV2LT5zYmRmLmJ1cywgcGRldi0+c2JkZi5kZXYsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHBkZXYtPnNiZGYuZnVuYywgY3BvcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
Y29udHJvbCB8IChQQ0lfTVNJWF9GTEFHU19FTkFCTEUgfAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIFBDSV9NU0lYX0ZMQUdTX01BU0tBTEwpKTsKICAgICB9CkBAIC02
MDgsOCArNjA3LDggQEAgaW50IHNldHVwX21zaV9pcnEoc3RydWN0IGlycV9kZXNjICpkZXNjLCBz
dHJ1Y3QgbXNpX2Rlc2MgKm1zaWRlc2MpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICA6ICZwY2lfbXNpX25vbm1hc2thYmxlKTsKIAogICAgIGlmICgg
IShjb250cm9sICYgUENJX01TSVhfRkxBR1NfRU5BQkxFKSApCi0gICAgICAgIHBjaV9jb25mX3dy
aXRlMTYocGRldi0+c2VnLCBwZGV2LT5idXMsIFBDSV9TTE9UKHBkZXYtPmRldmZuKSwKLSAgICAg
ICAgICAgICAgICAgICAgICAgICBQQ0lfRlVOQyhwZGV2LT5kZXZmbiksIGNwb3MsIGNvbnRyb2wp
OworICAgICAgICBwY2lfY29uZl93cml0ZTE2KHBkZXYtPnNiZGYuc2VnLCBwZGV2LT5zYmRmLmJ1
cywgcGRldi0+c2JkZi5kZXYsCisgICAgICAgICAgICAgICAgICAgICAgICAgcGRldi0+c2JkZi5m
dW5jLCBjcG9zLCBjb250cm9sKTsKIAogICAgIHJldHVybiByYzsKIH0KQEAgLTY4OSwxMCArNjg4
LDEwIEBAIHN0YXRpYyBpbnQgbXNpX2NhcGFiaWxpdHlfaW5pdChzdHJ1Y3QgcGNpX2RldiAqZGV2
LAogICAgIHN0cnVjdCBtc2lfZGVzYyAqZW50cnk7CiAgICAgaW50IHBvczsKICAgICB1bnNpZ25l
ZCBpbnQgaSwgbWF4dmVjLCBtcG9zOwotICAgIHUxNiBjb250cm9sLCBzZWcgPSBkZXYtPnNlZzsK
LSAgICB1OCBidXMgPSBkZXYtPmJ1czsKLSAgICB1OCBzbG90ID0gUENJX1NMT1QoZGV2LT5kZXZm
bik7Ci0gICAgdTggZnVuYyA9IFBDSV9GVU5DKGRldi0+ZGV2Zm4pOworICAgIHVpbnQxNl90IGNv
bnRyb2wsIHNlZyA9IGRldi0+c2JkZi5zZWc7CisgICAgdWludDhfdCBidXMgPSBkZXYtPnNiZGYu
YnVzOworICAgIHVpbnQ4X3Qgc2xvdCA9IGRldi0+c2JkZi5kZXY7CisgICAgdWludDhfdCBmdW5j
ID0gZGV2LT5zYmRmLmZ1bmM7CiAKICAgICBBU1NFUlQocGNpZGV2c19sb2NrZWQoKSk7CiAgICAg
cG9zID0gcGNpX2ZpbmRfY2FwX29mZnNldChzZWcsIGJ1cywgc2xvdCwgZnVuYywgUENJX0NBUF9J
RF9NU0kpOwpAQCAtODU2LDEwICs4NTUsMTAgQEAgc3RhdGljIGludCBtc2l4X2NhcGFiaWxpdHlf
aW5pdChzdHJ1Y3QgcGNpX2RldiAqZGV2LAogICAgIHU2NCB0YWJsZV9wYWRkcjsKICAgICB1MzIg
dGFibGVfb2Zmc2V0OwogICAgIHU4IGJpciwgcGJ1cywgcHNsb3QsIHBmdW5jOwotICAgIHUxNiBz
ZWcgPSBkZXYtPnNlZzsKLSAgICB1OCBidXMgPSBkZXYtPmJ1czsKLSAgICB1OCBzbG90ID0gUENJ
X1NMT1QoZGV2LT5kZXZmbik7Ci0gICAgdTggZnVuYyA9IFBDSV9GVU5DKGRldi0+ZGV2Zm4pOwor
ICAgIHVpbnQxNl90IHNlZyA9IGRldi0+c2JkZi5zZWc7CisgICAgdWludDhfdCBidXMgPSBkZXYt
PnNiZGYuYnVzOworICAgIHVpbnQ4X3Qgc2xvdCA9IGRldi0+c2JkZi5kZXY7CisgICAgdWludDhf
dCBmdW5jID0gZGV2LT5zYmRmLmZ1bmM7CiAgICAgYm9vbCBtYXNrYWxsID0gbXNpeC0+aG9zdF9t
YXNrYWxsOwogCiAgICAgQVNTRVJUKHBjaWRldnNfbG9ja2VkKCkpOwpAQCAtOTEzLDcgKzkxMiw3
IEBAIHN0YXRpYyBpbnQgbXNpeF9jYXBhYmlsaXR5X2luaXQoc3RydWN0IHBjaV9kZXYgKmRldiwK
ICAgICAgICAgcGJ1cyA9IGRldi0+aW5mby5waHlzZm4uYnVzOwogICAgICAgICBwc2xvdCA9IFBD
SV9TTE9UKGRldi0+aW5mby5waHlzZm4uZGV2Zm4pOwogICAgICAgICBwZnVuYyA9IFBDSV9GVU5D
KGRldi0+aW5mby5waHlzZm4uZGV2Zm4pOwotICAgICAgICB2ZiA9IFBDSV9CREYyKGRldi0+YnVz
LCBkZXYtPmRldmZuKTsKKyAgICAgICAgdmYgPSBkZXYtPnNiZGYuYmRmOwogICAgIH0KIAogICAg
IHRhYmxlX3BhZGRyID0gcmVhZF9wY2lfbWVtX2JhcihzZWcsIHBidXMsIHBzbG90LCBwZnVuYywg
YmlyLCB2Zik7CkBAIC0xMTcyLDEwICsxMTcxLDEwIEBAIHN0YXRpYyB2b2lkIF9wY2lfY2xlYW51
cF9tc2l4KHN0cnVjdCBhcmNoX21zaXggKm1zaXgpCiBzdGF0aWMgdm9pZCBfX3BjaV9kaXNhYmxl
X21zaXgoc3RydWN0IG1zaV9kZXNjICplbnRyeSkKIHsKICAgICBzdHJ1Y3QgcGNpX2RldiAqZGV2
ID0gZW50cnktPmRldjsKLSAgICB1MTYgc2VnID0gZGV2LT5zZWc7Ci0gICAgdTggYnVzID0gZGV2
LT5idXM7Ci0gICAgdTggc2xvdCA9IFBDSV9TTE9UKGRldi0+ZGV2Zm4pOwotICAgIHU4IGZ1bmMg
PSBQQ0lfRlVOQyhkZXYtPmRldmZuKTsKKyAgICB1aW50MTZfdCBzZWcgPSBkZXYtPnNiZGYuc2Vn
OworICAgIHVpbnQ4X3QgYnVzID0gZGV2LT5zYmRmLmJ1czsKKyAgICB1aW50OF90IHNsb3QgPSBk
ZXYtPnNiZGYuZGV2OworICAgIHVpbnQ4X3QgZnVuYyA9IGRldi0+c2JkZi5mdW5jOwogICAgIHVu
c2lnbmVkIGludCBwb3MgPSBwY2lfZmluZF9jYXBfb2Zmc2V0KHNlZywgYnVzLCBzbG90LCBmdW5j
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9DQVBfSURf
TVNJWCk7CiAgICAgdTE2IGNvbnRyb2wgPSBwY2lfY29uZl9yZWFkMTYoc2VnLCBidXMsIHNsb3Qs
IGZ1bmMsCkBAIC0xMjk1LDEwICsxMjk0LDEwIEBAIHZvaWQgcGNpX2NsZWFudXBfbXNpKHN0cnVj
dCBwY2lfZGV2ICpwZGV2KQogaW50IHBjaV9tc2lfY29uZl93cml0ZV9pbnRlcmNlcHQoc3RydWN0
IHBjaV9kZXYgKnBkZXYsIHVuc2lnbmVkIGludCByZWcsCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICB1bnNpZ25lZCBpbnQgc2l6ZSwgdWludDMyX3QgKmRhdGEpCiB7Ci0gICAgdTE2
IHNlZyA9IHBkZXYtPnNlZzsKLSAgICB1OCBidXMgPSBwZGV2LT5idXM7Ci0gICAgdTggc2xvdCA9
IFBDSV9TTE9UKHBkZXYtPmRldmZuKTsKLSAgICB1OCBmdW5jID0gUENJX0ZVTkMocGRldi0+ZGV2
Zm4pOworICAgIHVpbnQxNl90IHNlZyA9IHBkZXYtPnNiZGYuc2VnOworICAgIHVpbnQ4X3QgYnVz
ID0gcGRldi0+c2JkZi5idXM7CisgICAgdWludDhfdCBzbG90ID0gcGRldi0+c2JkZi5kZXY7Cisg
ICAgdWludDhfdCBmdW5jID0gcGRldi0+c2JkZi5mdW5jOwogICAgIHN0cnVjdCBtc2lfZGVzYyAq
ZW50cnk7CiAgICAgdW5zaWduZWQgaW50IHBvczsKIApAQCAtMTM2NSw3ICsxMzY0LDcgQEAgaW50
IHBjaV9yZXN0b3JlX21zaV9zdGF0ZShzdHJ1Y3QgcGNpX2RldiAqcGRldikKICAgICBzdHJ1Y3Qg
bXNpX2Rlc2MgKmVudHJ5LCAqdG1wOwogICAgIHN0cnVjdCBpcnFfZGVzYyAqZGVzYzsKICAgICBz
dHJ1Y3QgbXNpX21zZyBtc2c7Ci0gICAgdTggc2xvdCA9IFBDSV9TTE9UKHBkZXYtPmRldmZuKSwg
ZnVuYyA9IFBDSV9GVU5DKHBkZXYtPmRldmZuKTsKKyAgICB1aW50OF90IHNsb3QgPSBwZGV2LT5z
YmRmLmRldiwgZnVuYyA9IHBkZXYtPnNiZGYuZnVuYzsKICAgICB1bnNpZ25lZCBpbnQgdHlwZSA9
IDAsIHBvcyA9IDA7CiAgICAgdTE2IGNvbnRyb2wgPSAwOwogCkBAIC0xMzc0LDkgKzEzNzMsNyBA
QCBpbnQgcGNpX3Jlc3RvcmVfbXNpX3N0YXRlKHN0cnVjdCBwY2lfZGV2ICpwZGV2KQogICAgIGlm
ICggIXVzZV9tc2kgKQogICAgICAgICByZXR1cm4gLUVPUE5PVFNVUFA7CiAKLSAgICByZXQgPSB4
c21fcmVzb3VyY2Vfc2V0dXBfcGNpKFhTTV9QUklWLAotICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAocGRldi0+c2VnIDw8IDE2KSB8IChwZGV2LT5idXMgPDwgOCkgfAotICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBwZGV2LT5kZXZmbik7CisgICAgcmV0ID0geHNtX3Jlc291
cmNlX3NldHVwX3BjaShYU01fUFJJViwgcGRldi0+c2JkZi5zYmRmKTsKICAgICBpZiAoIHJldCAp
CiAgICAgICAgIHJldHVybiByZXQ7CiAKQEAgLTEzOTYsMTAgKzEzOTMsMTAgQEAgaW50IHBjaV9y
ZXN0b3JlX21zaV9zdGF0ZShzdHJ1Y3QgcGNpX2RldiAqcGRldikKICAgICBib2d1czoKICAgICAg
ICAgICAgIGRwcmludGsoWEVOTE9HX0VSUiwKICAgICAgICAgICAgICAgICAgICAgIlJlc3RvcmUg
TVNJIGZvciAlMDR4OiUwMng6JTAyeDoldSBlbnRyeSAldSBub3Qgc2V0P1xuIiwKLSAgICAgICAg
ICAgICAgICAgICAgcGRldi0+c2VnLCBwZGV2LT5idXMsIHNsb3QsIGZ1bmMsIGkpOworICAgICAg
ICAgICAgICAgICAgICBwZGV2LT5zYmRmLnNlZywgcGRldi0+c2JkZi5idXMsIHNsb3QsIGZ1bmMs
IGkpOwogICAgICAgICAgICAgc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZGVzYy0+bG9jaywgZmxh
Z3MpOwogICAgICAgICAgICAgaWYgKCB0eXBlID09IFBDSV9DQVBfSURfTVNJWCApCi0gICAgICAg
ICAgICAgICAgcGNpX2NvbmZfd3JpdGUxNihwZGV2LT5zZWcsIHBkZXYtPmJ1cywgc2xvdCwgZnVu
YywKKyAgICAgICAgICAgICAgICBwY2lfY29uZl93cml0ZTE2KHBkZXYtPnNiZGYuc2VnLCBwZGV2
LT5zYmRmLmJ1cywgc2xvdCwgZnVuYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IG1zaXhfY29udHJvbF9yZWcocG9zKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGNvbnRyb2wgJiB+UENJX01TSVhfRkxBR1NfRU5BQkxFKTsKICAgICAgICAgICAgIHJldHVybiAt
RUlOVkFMOwpAQCAtMTQxNCwxNiArMTQxMSwxNiBAQCBpbnQgcGNpX3Jlc3RvcmVfbXNpX3N0YXRl
KHN0cnVjdCBwY2lfZGV2ICpwZGV2KQogICAgICAgICB9CiAgICAgICAgIGVsc2UgaWYgKCAhdHlw
ZSAmJiBlbnRyeS0+bXNpX2F0dHJpYi50eXBlID09IFBDSV9DQVBfSURfTVNJWCApCiAgICAgICAg
IHsKLSAgICAgICAgICAgIGNvbnRyb2wgPSBwY2lfY29uZl9yZWFkMTYocGRldi0+c2VnLCBwZGV2
LT5idXMsIHNsb3QsIGZ1bmMsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IG1zaXhfY29udHJvbF9yZWcocG9zKSk7Ci0gICAgICAgICAgICBwY2lfY29uZl93cml0ZTE2KHBk
ZXYtPnNlZywgcGRldi0+YnVzLCBzbG90LCBmdW5jLAorICAgICAgICAgICAgY29udHJvbCA9IHBj
aV9jb25mX3JlYWQxNihwZGV2LT5zYmRmLnNlZywgcGRldi0+c2JkZi5idXMsIHNsb3QsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmMsIG1zaXhfY29udHJvbF9yZWco
cG9zKSk7CisgICAgICAgICAgICBwY2lfY29uZl93cml0ZTE2KHBkZXYtPnNiZGYuc2VnLCBwZGV2
LT5zYmRmLmJ1cywgc2xvdCwgZnVuYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNp
eF9jb250cm9sX3JlZyhwb3MpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250cm9s
IHwgKFBDSV9NU0lYX0ZMQUdTX0VOQUJMRSB8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgUENJX01TSVhfRkxBR1NfTUFTS0FMTCkpOwogICAgICAgICAgICAgaWYgKCB1
bmxpa2VseSghbWVtb3J5X2RlY29kZWQocGRldikpICkKICAgICAgICAgICAgIHsKICAgICAgICAg
ICAgICAgICBzcGluX3VubG9ja19pcnFyZXN0b3JlKCZkZXNjLT5sb2NrLCBmbGFncyk7Ci0gICAg
ICAgICAgICAgICAgcGNpX2NvbmZfd3JpdGUxNihwZGV2LT5zZWcsIHBkZXYtPmJ1cywgc2xvdCwg
ZnVuYywKKyAgICAgICAgICAgICAgICBwY2lfY29uZl93cml0ZTE2KHBkZXYtPnNiZGYuc2VnLCBw
ZGV2LT5zYmRmLmJ1cywgc2xvdCwgZnVuYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIG1zaXhfY29udHJvbF9yZWcocG9zKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGNvbnRyb2wgJiB+UENJX01TSVhfRkxBR1NfRU5BQkxFKTsKICAgICAgICAgICAgICAgICBy
ZXR1cm4gLUVOWElPOwpAQCAtMTQ1NywxNyArMTQ1NCwxOCBAQCBpbnQgcGNpX3Jlc3RvcmVfbXNp
X3N0YXRlKHN0cnVjdCBwY2lfZGV2ICpwZGV2KQogICAgICAgICB7CiAgICAgICAgICAgICB1bnNp
Z25lZCBpbnQgY3BvcyA9IG1zaV9jb250cm9sX3JlZyhwb3MpOwogCi0gICAgICAgICAgICBjb250
cm9sID0gcGNpX2NvbmZfcmVhZDE2KHBkZXYtPnNlZywgcGRldi0+YnVzLCBzbG90LCBmdW5jLCBj
cG9zKSAmCi0gICAgICAgICAgICAgICAgICAgICAgflBDSV9NU0lfRkxBR1NfUVNJWkU7CisgICAg
ICAgICAgICBjb250cm9sID0gcGNpX2NvbmZfcmVhZDE2KHBkZXYtPnNiZGYuc2VnLCBwZGV2LT5z
YmRmLmJ1cywgc2xvdCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVu
YywgY3BvcykgJiB+UENJX01TSV9GTEFHU19RU0laRTsKICAgICAgICAgICAgIG11bHRpX21zaV9l
bmFibGUoY29udHJvbCwgZW50cnktPm1zaS5udmVjKTsKLSAgICAgICAgICAgIHBjaV9jb25mX3dy
aXRlMTYocGRldi0+c2VnLCBwZGV2LT5idXMsIHNsb3QsIGZ1bmMsIGNwb3MsIGNvbnRyb2wpOwor
ICAgICAgICAgICAgcGNpX2NvbmZfd3JpdGUxNihwZGV2LT5zYmRmLnNlZywgcGRldi0+c2JkZi5i
dXMsIHNsb3QsIGZ1bmMsIGNwb3MsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRy
b2wpOwogCiAgICAgICAgICAgICBtc2lfc2V0X2VuYWJsZShwZGV2LCAxKTsKICAgICAgICAgfQog
ICAgIH0KIAogICAgIGlmICggdHlwZSA9PSBQQ0lfQ0FQX0lEX01TSVggKQotICAgICAgICBwY2lf
Y29uZl93cml0ZTE2KHBkZXYtPnNlZywgcGRldi0+YnVzLCBzbG90LCBmdW5jLAorICAgICAgICBw
Y2lfY29uZl93cml0ZTE2KHBkZXYtPnNiZGYuc2VnLCBwZGV2LT5zYmRmLmJ1cywgc2xvdCwgZnVu
YywKICAgICAgICAgICAgICAgICAgICAgICAgICBtc2l4X2NvbnRyb2xfcmVnKHBvcyksCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgY29udHJvbCB8IFBDSV9NU0lYX0ZMQUdTX0VOQUJMRSk7CiAK
ZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9pb21tdV9jbWQuYyBiL3hl
bi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9pb21tdV9jbWQuYwppbmRleCBhZjNhMWZiODY1Li44
MjMzMGMyNGJhIDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVf
Y21kLmMKKysrIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL2lvbW11X2NtZC5jCkBAIC0y
ODksMjMgKzI4OSwyMyBAQCB2b2lkIGFtZF9pb21tdV9mbHVzaF9pb3RsYih1OCBkZXZmbiwgY29u
c3Qgc3RydWN0IHBjaV9kZXYgKnBkZXYsCiAgICAgaWYgKCAhYXRzX2VuYWJsZWQgKQogICAgICAg
ICByZXR1cm47CiAKLSAgICBpZiAoICFwY2lfYXRzX2VuYWJsZWQocGRldi0+c2VnLCBwZGV2LT5i
dXMsIHBkZXYtPmRldmZuKSApCisgICAgaWYgKCAhcGNpX2F0c19lbmFibGVkKHBkZXYtPnNiZGYu
c2VnLCBwZGV2LT5zYmRmLmJ1cywgcGRldi0+c2JkZi5leHRmdW5jKSApCiAgICAgICAgIHJldHVy
bjsKIAotICAgIGlvbW11ID0gZmluZF9pb21tdV9mb3JfZGV2aWNlKHBkZXYtPnNlZywgUENJX0JE
RjIocGRldi0+YnVzLCBwZGV2LT5kZXZmbikpOworICAgIGlvbW11ID0gZmluZF9pb21tdV9mb3Jf
ZGV2aWNlKHBkZXYtPnNiZGYuc2VnLCBwZGV2LT5zYmRmLmJkZik7CiAKICAgICBpZiAoICFpb21t
dSApCiAgICAgewogICAgICAgICBBTURfSU9NTVVfREVCVUcoIiVzOiBDYW4ndCBmaW5kIGlvbW11
IGZvciAlMDR4OiUwMng6JTAyeC4ldVxuIiwKLSAgICAgICAgICAgICAgICAgICAgICAgIF9fZnVu
Y19fLCBwZGV2LT5zZWcsIHBkZXYtPmJ1cywKLSAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9T
TE9UKHBkZXYtPmRldmZuKSwgUENJX0ZVTkMocGRldi0+ZGV2Zm4pKTsKKyAgICAgICAgICAgICAg
ICAgICAgICAgIF9fZnVuY19fLCBwZGV2LT5zYmRmLnNlZywgcGRldi0+c2JkZi5idXMsCisgICAg
ICAgICAgICAgICAgICAgICAgICBwZGV2LT5zYmRmLmRldiwgcGRldi0+c2JkZi5mdW5jKTsKICAg
ICAgICAgcmV0dXJuOwogICAgIH0KIAogICAgIGlmICggIWlvbW11X2hhc19jYXAoaW9tbXUsIFBD
SV9DQVBfSU9UTEJfU0hJRlQpICkKICAgICAgICAgcmV0dXJuOwogCi0gICAgcmVxX2lkID0gZ2V0
X2RtYV9yZXF1ZXN0b3JfaWQoaW9tbXUtPnNlZywgUENJX0JERjIocGRldi0+YnVzLCBkZXZmbikp
OworICAgIHJlcV9pZCA9IGdldF9kbWFfcmVxdWVzdG9yX2lkKGlvbW11LT5zZWcsIFBDSV9CREYy
KHBkZXYtPnNiZGYuYnVzLCBkZXZmbikpOwogICAgIHF1ZXVlaWQgPSByZXFfaWQ7CiAgICAgbWF4
cGVuZCA9IHBkZXYtPmF0cy5xdWV1ZV9kZXB0aCAmIDB4ZmY7CiAKQEAgLTMyNiwxMyArMzI2LDEz
IEBAIHN0YXRpYyB2b2lkIGFtZF9pb21tdV9mbHVzaF9hbGxfaW90bGJzKHN0cnVjdCBkb21haW4g
KmQsIGRhZGRyX3QgZGFkZHIsCiAKICAgICBmb3JfZWFjaF9wZGV2KCBkLCBwZGV2ICkKICAgICB7
Ci0gICAgICAgIHU4IGRldmZuID0gcGRldi0+ZGV2Zm47CisgICAgICAgIHVpbnQ4X3QgZGV2Zm4g
PSBwZGV2LT5zYmRmLmV4dGZ1bmM7CiAKICAgICAgICAgZG8gewogICAgICAgICAgICAgYW1kX2lv
bW11X2ZsdXNoX2lvdGxiKGRldmZuLCBwZGV2LCBkYWRkciwgb3JkZXIpOwogICAgICAgICAgICAg
ZGV2Zm4gKz0gcGRldi0+cGhhbnRvbV9zdHJpZGU7Ci0gICAgICAgIH0gd2hpbGUgKCBkZXZmbiAh
PSBwZGV2LT5kZXZmbiAmJgotICAgICAgICAgICAgICAgICAgUENJX1NMT1QoZGV2Zm4pID09IFBD
SV9TTE9UKHBkZXYtPmRldmZuKSApOworICAgICAgICB9IHdoaWxlICggZGV2Zm4gIT0gcGRldi0+
c2JkZi5leHRmdW5jICYmCisgICAgICAgICAgICAgICAgICBQQ0lfU0xPVChkZXZmbikgPT0gcGRl
di0+c2JkZi5kZXYgKTsKICAgICB9CiB9CiAKZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL3Bhc3N0
aHJvdWdoL2FtZC9pb21tdV9pbnRyLmMgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9t
bXVfaW50ci5jCmluZGV4IGRhZDJkMWU1YWIuLjcxNTk0Y2MyN2QgMTAwNjQ0Ci0tLSBhL3hlbi9k
cml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9pb21tdV9pbnRyLmMKKysrIGIveGVuL2RyaXZlcnMvcGFz
c3Rocm91Z2gvYW1kL2lvbW11X2ludHIuYwpAQCAtNTI1LDggKzUyNSw4IEBAIGludCBhbWRfaW9t
bXVfbXNpX21zZ191cGRhdGVfaXJlKAogICAgIHVuc2lnbmVkIGludCBpLCBuciA9IDE7CiAgICAg
dTMyIGRhdGE7CiAKLSAgICBiZGYgPSBwZGV2ID8gUENJX0JERjIocGRldi0+YnVzLCBwZGV2LT5k
ZXZmbikgOiBocGV0X3NiZGYuYmRmOwotICAgIHNlZyA9IHBkZXYgPyBwZGV2LT5zZWcgOiBocGV0
X3NiZGYuc2VnOworICAgIGJkZiA9IHBkZXYgPyBwZGV2LT5zYmRmLmJkZiA6IGhwZXRfc2JkZi5i
ZGY7CisgICAgc2VnID0gcGRldiA/IHBkZXYtPnNiZGYuc2VnIDogaHBldF9zYmRmLnNlZzsKIAog
ICAgIGlvbW11ID0gX2ZpbmRfaW9tbXVfZm9yX2RldmljZShzZWcsIGJkZik7CiAgICAgaWYgKCBJ
U19FUlJfT1JfTlVMTChpb21tdSkgKQpAQCAtNTQ0LDEyICs1NDQsMTIgQEAgaW50IGFtZF9pb21t
dV9tc2lfbXNnX3VwZGF0ZV9pcmUoCiAgICAgICAgICAgICBpZiAoICFwZGV2IHx8ICFwZGV2LT5w
aGFudG9tX3N0cmlkZSApCiAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICBiZGYg
Kz0gcGRldi0+cGhhbnRvbV9zdHJpZGU7Ci0gICAgICAgIH0gd2hpbGUgKCBQQ0lfU0xPVChiZGYp
ID09IFBDSV9TTE9UKHBkZXYtPmRldmZuKSApOworICAgICAgICB9IHdoaWxlICggUENJX1NMT1Qo
YmRmKSA9PSBwZGV2LT5zYmRmLmRldiApOwogCiAgICAgICAgIGZvciAoIGkgPSAwOyBpIDwgbnI7
ICsraSApCiAgICAgICAgICAgICBtc2lfZGVzY1tpXS5yZW1hcF9pbmRleCA9IC0xOwogICAgICAg
ICBpZiAoIHBkZXYgKQotICAgICAgICAgICAgYmRmID0gUENJX0JERjIocGRldi0+YnVzLCBwZGV2
LT5kZXZmbik7CisgICAgICAgICAgICBiZGYgPSBwZGV2LT5zYmRmLmJkZjsKICAgICB9CiAKICAg
ICBpZiAoICFtc2cgKQpAQCAtNTYyLDcgKzU2Miw3IEBAIGludCBhbWRfaW9tbXVfbXNpX21zZ191
cGRhdGVfaXJlKAogICAgICAgICBpZiAoIHJjIHx8ICFwZGV2IHx8ICFwZGV2LT5waGFudG9tX3N0
cmlkZSApCiAgICAgICAgICAgICBicmVhazsKICAgICAgICAgYmRmICs9IHBkZXYtPnBoYW50b21f
c3RyaWRlOwotICAgIH0gd2hpbGUgKCBQQ0lfU0xPVChiZGYpID09IFBDSV9TTE9UKHBkZXYtPmRl
dmZuKSApOworICAgIH0gd2hpbGUgKCBQQ0lfU0xPVChiZGYpID09IHBkZXYtPnNiZGYuZGV2ICk7
CiAKICAgICBpZiAoICFyYyApCiAgICAgewpAQCAtNTc5LDggKzU3OSw4IEBAIHZvaWQgYW1kX2lv
bW11X3JlYWRfbXNpX2Zyb21faXJlKAogewogICAgIHVuc2lnbmVkIGludCBvZmZzZXQgPSBtc2ct
PmRhdGEgJiAoSU5UUkVNQVBfRU5UUklFUyAtIDEpOwogICAgIGNvbnN0IHN0cnVjdCBwY2lfZGV2
ICpwZGV2ID0gbXNpX2Rlc2MtPmRldjsKLSAgICB1MTYgYmRmID0gcGRldiA/IFBDSV9CREYyKHBk
ZXYtPmJ1cywgcGRldi0+ZGV2Zm4pIDogaHBldF9zYmRmLmJkZjsKLSAgICB1MTYgc2VnID0gcGRl
diA/IHBkZXYtPnNlZyA6IGhwZXRfc2JkZi5zZWc7CisgICAgdWludDE2X3QgYmRmID0gcGRldiA/
IHBkZXYtPnNiZGYuYmRmIDogaHBldF9zYmRmLmJkZjsKKyAgICB1aW50MTZfdCBzZWcgPSBwZGV2
ID8gcGRldi0+c2JkZi5zZWcgOiBocGV0X3NiZGYuc2VnOwogICAgIGNvbnN0IHUzMiAqZW50cnk7
CiAKICAgICBpZiAoIElTX0VSUl9PUl9OVUxMKF9maW5kX2lvbW11X2Zvcl9kZXZpY2Uoc2VnLCBi
ZGYpKSApCmRpZmYgLS1naXQgYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfbWFw
LmMgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfbWFwLmMKaW5kZXggY2JmMDBl
OWU3Mi4uMzE0ZDg3MWM5ZSAxMDA2NDQKLS0tIGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1k
L2lvbW11X21hcC5jCisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9pb21tdV9tYXAu
YwpAQCAtMzI0LDggKzMyNCw4IEBAIHN0YXRpYyBpbnQgdXBkYXRlX3BhZ2luZ19tb2RlKHN0cnVj
dCBkb21haW4gKmQsIHVuc2lnbmVkIGxvbmcgZGZuKQogICAgICAgICAgICAgaWYgKCBwZGV2LT50
eXBlID09IERFVl9UWVBFX1BDSV9IT1NUX0JSSURHRSApCiAgICAgICAgICAgICAgICAgY29udGlu
dWU7CiAKLSAgICAgICAgICAgIGJkZiA9IFBDSV9CREYyKHBkZXYtPmJ1cywgcGRldi0+ZGV2Zm4p
OwotICAgICAgICAgICAgaW9tbXUgPSBmaW5kX2lvbW11X2Zvcl9kZXZpY2UocGRldi0+c2VnLCBi
ZGYpOworICAgICAgICAgICAgYmRmID0gcGRldi0+c2JkZi5iZGY7CisgICAgICAgICAgICBpb21t
dSA9IGZpbmRfaW9tbXVfZm9yX2RldmljZShwZGV2LT5zYmRmLnNlZywgYmRmKTsKICAgICAgICAg
ICAgIGlmICggIWlvbW11ICkKICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICBBTURfSU9N
TVVfREVCVUcoIiVzIEZhaWwgdG8gZmluZCBpb21tdS5cbiIsIF9fZnVuY19fKTsKQEAgLTMzNCw3
ICszMzQsNyBAQCBzdGF0aWMgaW50IHVwZGF0ZV9wYWdpbmdfbW9kZShzdHJ1Y3QgZG9tYWluICpk
LCB1bnNpZ25lZCBsb25nIGRmbikKIAogICAgICAgICAgICAgc3Bpbl9sb2NrX2lycXNhdmUoJmlv
bW11LT5sb2NrLCBmbGFncyk7CiAgICAgICAgICAgICBkbyB7Ci0gICAgICAgICAgICAgICAgcmVx
X2lkID0gZ2V0X2RtYV9yZXF1ZXN0b3JfaWQocGRldi0+c2VnLCBiZGYpOworICAgICAgICAgICAg
ICAgIHJlcV9pZCA9IGdldF9kbWFfcmVxdWVzdG9yX2lkKHBkZXYtPnNiZGYuc2VnLCBiZGYpOwog
ICAgICAgICAgICAgICAgIHRhYmxlID0gaW9tbXUtPmRldl90YWJsZS5idWZmZXI7CiAgICAgICAg
ICAgICAgICAgZHRlID0gJnRhYmxlW3JlcV9pZF07CiAKQEAgLTM0Niw4ICszNDYsOCBAQCBzdGF0
aWMgaW50IHVwZGF0ZV9wYWdpbmdfbW9kZShzdHJ1Y3QgZG9tYWluICpkLCB1bnNpZ25lZCBsb25n
IGRmbikKIAogICAgICAgICAgICAgICAgIGFtZF9pb21tdV9mbHVzaF9kZXZpY2UoaW9tbXUsIHJl
cV9pZCk7CiAgICAgICAgICAgICAgICAgYmRmICs9IHBkZXYtPnBoYW50b21fc3RyaWRlOwotICAg
ICAgICAgICAgfSB3aGlsZSAoIFBDSV9ERVZGTjIoYmRmKSAhPSBwZGV2LT5kZXZmbiAmJgotICAg
ICAgICAgICAgICAgICAgICAgIFBDSV9TTE9UKGJkZikgPT0gUENJX1NMT1QocGRldi0+ZGV2Zm4p
ICk7CisgICAgICAgICAgICB9IHdoaWxlICggUENJX0RFVkZOMihiZGYpICE9IHBkZXYtPnNiZGYu
ZXh0ZnVuYyAmJgorICAgICAgICAgICAgICAgICAgICAgIFBDSV9TTE9UKGJkZikgPT0gcGRldi0+
c2JkZi5kZXYgKTsKICAgICAgICAgICAgIHNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmlvbW11LT5s
b2NrLCBmbGFncyk7CiAgICAgICAgIH0KIApkaWZmIC0tZ2l0IGEveGVuL2RyaXZlcnMvcGFzc3Ro
cm91Z2gvYW1kL3BjaV9hbWRfaW9tbXUuYyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9w
Y2lfYW1kX2lvbW11LmMKaW5kZXggZGJjNzFjYTdkNS4uMGU0YzViNDk5NCAxMDA2NDQKLS0tIGEv
eGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL3BjaV9hbWRfaW9tbXUuYworKysgYi94ZW4vZHJp
dmVycy9wYXNzdGhyb3VnaC9hbWQvcGNpX2FtZF9pb21tdS5jCkBAIC05NCw3ICs5NCw3IEBAIHN0
YXRpYyB2b2lkIGFtZF9pb21tdV9zZXR1cF9kb21haW5fZGV2aWNlKAogICAgIHVuc2lnbmVkIGxv
bmcgZmxhZ3M7CiAgICAgaW50IHJlcV9pZCwgdmFsaWQgPSAxOwogICAgIGludCBkdGVfaSA9IDA7
Ci0gICAgdTggYnVzID0gcGRldi0+YnVzOworICAgIHVpbnQ4X3QgYnVzID0gcGRldi0+c2JkZi5i
dXM7CiAgICAgY29uc3Qgc3RydWN0IGRvbWFpbl9pb21tdSAqaGQgPSBkb21faW9tbXUoZG9tYWlu
KTsKIAogICAgIEJVR19PTiggIWhkLT5hcmNoLnJvb3RfdGFibGUgfHwgIWhkLT5hcmNoLnBhZ2lu
Z19tb2RlIHx8CkBAIC0xMjAsNyArMTIwLDcgQEAgc3RhdGljIHZvaWQgYW1kX2lvbW11X3NldHVw
X2RvbWFpbl9kZXZpY2UoCiAgICAgICAgICAgICBkdGUsIHBhZ2VfdG9fbWFkZHIoaGQtPmFyY2gu
cm9vdF90YWJsZSksIGRvbWFpbi0+ZG9tYWluX2lkLAogICAgICAgICAgICAgaGQtPmFyY2gucGFn
aW5nX21vZGUsIHZhbGlkKTsKIAotICAgICAgICBpZiAoIHBjaV9hdHNfZGV2aWNlKGlvbW11LT5z
ZWcsIGJ1cywgcGRldi0+ZGV2Zm4pICYmCisgICAgICAgIGlmICggcGNpX2F0c19kZXZpY2UoaW9t
bXUtPnNlZywgYnVzLCBwZGV2LT5zYmRmLmV4dGZ1bmMpICYmCiAgICAgICAgICAgICAgaW9tbXVf
aGFzX2NhcChpb21tdSwgUENJX0NBUF9JT1RMQl9TSElGVCkgKQogICAgICAgICAgICAgZHRlLT5p
ID0gZHRlX2k7CiAKQEAgLTEzOCwxMCArMTM4LDEwIEBAIHN0YXRpYyB2b2lkIGFtZF9pb21tdV9z
ZXR1cF9kb21haW5fZGV2aWNlKAogCiAgICAgQVNTRVJUKHBjaWRldnNfbG9ja2VkKCkpOwogCi0g
ICAgaWYgKCBwY2lfYXRzX2RldmljZShpb21tdS0+c2VnLCBidXMsIHBkZXYtPmRldmZuKSAmJgot
ICAgICAgICAgIXBjaV9hdHNfZW5hYmxlZChpb21tdS0+c2VnLCBidXMsIHBkZXYtPmRldmZuKSAp
CisgICAgaWYgKCBwY2lfYXRzX2RldmljZShpb21tdS0+c2VnLCBidXMsIHBkZXYtPnNiZGYuZXh0
ZnVuYykgJiYKKyAgICAgICAgICFwY2lfYXRzX2VuYWJsZWQoaW9tbXUtPnNlZywgYnVzLCBwZGV2
LT5zYmRmLmV4dGZ1bmMpICkKICAgICB7Ci0gICAgICAgIGlmICggZGV2Zm4gPT0gcGRldi0+ZGV2
Zm4gKQorICAgICAgICBpZiAoIGRldmZuID09IHBkZXYtPnNiZGYuZXh0ZnVuYyApCiAgICAgICAg
ICAgICBlbmFibGVfYXRzX2RldmljZShwZGV2LCAmaW9tbXUtPmF0c19kZXZpY2VzKTsKIAogICAg
ICAgICBhbWRfaW9tbXVfZmx1c2hfaW90bGIoZGV2Zm4sIHBkZXYsIElOVl9JT01NVV9BTExfUEFH
RVNfQUREUkVTUywgMCk7CkBAIC0yNjEsNyArMjYxLDcgQEAgdm9pZCBhbWRfaW9tbXVfZGlzYWJs
ZV9kb21haW5fZGV2aWNlKHN0cnVjdCBkb21haW4gKmRvbWFpbiwKICAgICBzdHJ1Y3QgYW1kX2lv
bW11X2R0ZSAqdGFibGUsICpkdGU7CiAgICAgdW5zaWduZWQgbG9uZyBmbGFnczsKICAgICBpbnQg
cmVxX2lkOwotICAgIHU4IGJ1cyA9IHBkZXYtPmJ1czsKKyAgICB1aW50OF90IGJ1cyA9IHBkZXYt
PnNiZGYuYnVzOwogCiAgICAgQlVHX09OICggaW9tbXUtPmRldl90YWJsZS5idWZmZXIgPT0gTlVM
TCApOwogICAgIHJlcV9pZCA9IGdldF9kbWFfcmVxdWVzdG9yX2lkKGlvbW11LT5zZWcsIFBDSV9C
REYyKGJ1cywgZGV2Zm4pKTsKQEAgLTI3NCw3ICsyNzQsNyBAQCB2b2lkIGFtZF9pb21tdV9kaXNh
YmxlX2RvbWFpbl9kZXZpY2Uoc3RydWN0IGRvbWFpbiAqZG9tYWluLAogICAgICAgICBkdGUtPnR2
ID0gMDsKICAgICAgICAgZHRlLT52ID0gMDsKIAotICAgICAgICBpZiAoIHBjaV9hdHNfZGV2aWNl
KGlvbW11LT5zZWcsIGJ1cywgcGRldi0+ZGV2Zm4pICYmCisgICAgICAgIGlmICggcGNpX2F0c19k
ZXZpY2UoaW9tbXUtPnNlZywgYnVzLCBwZGV2LT5zYmRmLmV4dGZ1bmMpICYmCiAgICAgICAgICAg
ICAgaW9tbXVfaGFzX2NhcChpb21tdSwgUENJX0NBUF9JT1RMQl9TSElGVCkgKQogICAgICAgICAg
ICAgZHRlLT5pID0gMDsKIApAQCAtMjg5LDcgKzI4OSw3IEBAIHZvaWQgYW1kX2lvbW11X2Rpc2Fi
bGVfZG9tYWluX2RldmljZShzdHJ1Y3QgZG9tYWluICpkb21haW4sCiAKICAgICBBU1NFUlQocGNp
ZGV2c19sb2NrZWQoKSk7CiAKLSAgICBpZiAoIGRldmZuID09IHBkZXYtPmRldmZuICYmCisgICAg
aWYgKCBkZXZmbiA9PSBwZGV2LT5zYmRmLmV4dGZ1bmMgJiYKICAgICAgICAgIHBjaV9hdHNfZGV2
aWNlKGlvbW11LT5zZWcsIGJ1cywgZGV2Zm4pICYmCiAgICAgICAgICBwY2lfYXRzX2VuYWJsZWQo
aW9tbXUtPnNlZywgYnVzLCBkZXZmbikgKQogICAgICAgICBkaXNhYmxlX2F0c19kZXZpY2UocGRl
dik7CkBAIC0yOTksMjMgKzI5OSwyMiBAQCBzdGF0aWMgaW50IHJlYXNzaWduX2RldmljZShzdHJ1
Y3QgZG9tYWluICpzb3VyY2UsIHN0cnVjdCBkb21haW4gKnRhcmdldCwKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHU4IGRldmZuLCBzdHJ1Y3QgcGNpX2RldiAqcGRldikKIHsKICAgICBzdHJ1
Y3QgYW1kX2lvbW11ICppb21tdTsKLSAgICBpbnQgYmRmLCByYzsKKyAgICBpbnQgcmM7CiAgICAg
c3RydWN0IGRvbWFpbl9pb21tdSAqdCA9IGRvbV9pb21tdSh0YXJnZXQpOwogCi0gICAgYmRmID0g
UENJX0JERjIocGRldi0+YnVzLCBwZGV2LT5kZXZmbik7Ci0gICAgaW9tbXUgPSBmaW5kX2lvbW11
X2Zvcl9kZXZpY2UocGRldi0+c2VnLCBiZGYpOworICAgIGlvbW11ID0gZmluZF9pb21tdV9mb3Jf
ZGV2aWNlKHBkZXYtPnNiZGYuc2VnLCBwZGV2LT5zYmRmLmJkZik7CiAgICAgaWYgKCAhaW9tbXUg
KQogICAgIHsKICAgICAgICAgQU1EX0lPTU1VX0RFQlVHKCJGYWlsIHRvIGZpbmQgaW9tbXUuIgog
ICAgICAgICAgICAgICAgICAgICAgICAgIiAlMDR4OiUwMng6JXgwMi4leCBjYW5ub3QgYmUgYXNz
aWduZWQgdG8gZG9tJWRcbiIsCi0gICAgICAgICAgICAgICAgICAgICAgICBwZGV2LT5zZWcsIHBk
ZXYtPmJ1cywgUENJX1NMT1QoZGV2Zm4pLCBQQ0lfRlVOQyhkZXZmbiksCi0gICAgICAgICAgICAg
ICAgICAgICAgICB0YXJnZXQtPmRvbWFpbl9pZCk7CisgICAgICAgICAgICAgICAgICAgICAgICBw
ZGV2LT5zYmRmLnNlZywgcGRldi0+c2JkZi5idXMsIFBDSV9TTE9UKGRldmZuKSwKKyAgICAgICAg
ICAgICAgICAgICAgICAgIFBDSV9GVU5DKGRldmZuKSwgdGFyZ2V0LT5kb21haW5faWQpOwogICAg
ICAgICByZXR1cm4gLUVOT0RFVjsKICAgICB9CiAKICAgICBhbWRfaW9tbXVfZGlzYWJsZV9kb21h
aW5fZGV2aWNlKHNvdXJjZSwgaW9tbXUsIGRldmZuLCBwZGV2KTsKIAotICAgIGlmICggZGV2Zm4g
PT0gcGRldi0+ZGV2Zm4gKQorICAgIGlmICggZGV2Zm4gPT0gcGRldi0+c2JkZi5leHRmdW5jICkK
ICAgICB7CiAgICAgICAgIGxpc3RfbW92ZSgmcGRldi0+ZG9tYWluX2xpc3QsICZ0YXJnZXQtPmFy
Y2gucGRldl9saXN0KTsKICAgICAgICAgcGRldi0+ZG9tYWluID0gdGFyZ2V0OwpAQCAtMzI3LDgg
KzMyNiw4IEBAIHN0YXRpYyBpbnQgcmVhc3NpZ25fZGV2aWNlKHN0cnVjdCBkb21haW4gKnNvdXJj
ZSwgc3RydWN0IGRvbWFpbiAqdGFyZ2V0LAogCiAgICAgYW1kX2lvbW11X3NldHVwX2RvbWFpbl9k
ZXZpY2UodGFyZ2V0LCBpb21tdSwgZGV2Zm4sIHBkZXYpOwogICAgIEFNRF9JT01NVV9ERUJVRygi
UmUtYXNzaWduICUwNHg6JTAyeDolMDJ4LiV1IGZyb20gZG9tJWQgdG8gZG9tJWRcbiIsCi0gICAg
ICAgICAgICAgICAgICAgIHBkZXYtPnNlZywgcGRldi0+YnVzLCBQQ0lfU0xPVChkZXZmbiksIFBD
SV9GVU5DKGRldmZuKSwKLSAgICAgICAgICAgICAgICAgICAgc291cmNlLT5kb21haW5faWQsIHRh
cmdldC0+ZG9tYWluX2lkKTsKKyAgICAgICAgICAgICAgICAgICAgcGRldi0+c2JkZi5zZWcsIHBk
ZXYtPnNiZGYuYnVzLCBQQ0lfU0xPVChkZXZmbiksCisgICAgICAgICAgICAgICAgICAgIFBDSV9G
VU5DKGRldmZuKSwgc291cmNlLT5kb21haW5faWQsIHRhcmdldC0+ZG9tYWluX2lkKTsKIAogICAg
IHJldHVybiAwOwogfQpAQCAtMzM3LDkgKzMzNiw5IEBAIHN0YXRpYyBpbnQgYW1kX2lvbW11X2Fz
c2lnbl9kZXZpY2Uoc3RydWN0IGRvbWFpbiAqZCwgdTggZGV2Zm4sCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHN0cnVjdCBwY2lfZGV2ICpwZGV2LAogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICB1MzIgZmxhZykKIHsKLSAgICBzdHJ1Y3QgaXZyc19tYXBwaW5n
cyAqaXZyc19tYXBwaW5ncyA9IGdldF9pdnJzX21hcHBpbmdzKHBkZXYtPnNlZyk7Ci0gICAgaW50
IGJkZiA9IFBDSV9CREYyKHBkZXYtPmJ1cywgZGV2Zm4pOwotICAgIGludCByZXFfaWQgPSBnZXRf
ZG1hX3JlcXVlc3Rvcl9pZChwZGV2LT5zZWcsIGJkZik7CisgICAgc3RydWN0IGl2cnNfbWFwcGlu
Z3MgKml2cnNfbWFwcGluZ3MgPSBnZXRfaXZyc19tYXBwaW5ncyhwZGV2LT5zYmRmLnNlZyk7Cisg
ICAgaW50IGJkZiA9IFBDSV9CREYyKHBkZXYtPnNiZGYuYnVzLCBkZXZmbik7CisgICAgaW50IHJl
cV9pZCA9IGdldF9kbWFfcmVxdWVzdG9yX2lkKHBkZXYtPnNiZGYuc2VnLCBiZGYpOwogCiAgICAg
aWYgKCBpdnJzX21hcHBpbmdzW3JlcV9pZF0udW5pdHlfbWFwX2VuYWJsZSApCiAgICAgewpAQCAt
NDIwLDEzICs0MTksMTEgQEAgc3RhdGljIHZvaWQgYW1kX2lvbW11X2RvbWFpbl9kZXN0cm95KHN0
cnVjdCBkb21haW4gKmQpCiBzdGF0aWMgaW50IGFtZF9pb21tdV9hZGRfZGV2aWNlKHU4IGRldmZu
LCBzdHJ1Y3QgcGNpX2RldiAqcGRldikKIHsKICAgICBzdHJ1Y3QgYW1kX2lvbW11ICppb21tdTsK
LSAgICB1MTYgYmRmOwogCiAgICAgaWYgKCAhcGRldi0+ZG9tYWluICkKICAgICAgICAgcmV0dXJu
IC1FSU5WQUw7CiAKLSAgICBiZGYgPSBQQ0lfQkRGMihwZGV2LT5idXMsIHBkZXYtPmRldmZuKTsK
LSAgICBpb21tdSA9IGZpbmRfaW9tbXVfZm9yX2RldmljZShwZGV2LT5zZWcsIGJkZik7CisgICAg
aW9tbXUgPSBmaW5kX2lvbW11X2Zvcl9kZXZpY2UocGRldi0+c2JkZi5zZWcsIHBkZXYtPnNiZGYu
YmRmKTsKICAgICBpZiAoIHVubGlrZWx5KCFpb21tdSkgKQogICAgIHsKICAgICAgICAgLyogRmls
dGVyIGJyaWRnZSBkZXZpY2VzLiAqLwpAQCAtNDM0LDE0ICs0MzEsMTQgQEAgc3RhdGljIGludCBh
bWRfaW9tbXVfYWRkX2RldmljZSh1OCBkZXZmbiwgc3RydWN0IHBjaV9kZXYgKnBkZXYpCiAgICAg
ICAgICAgICAgaXNfaGFyZHdhcmVfZG9tYWluKHBkZXYtPmRvbWFpbikgKQogICAgICAgICB7CiAg
ICAgICAgICAgICBBTURfSU9NTVVfREVCVUcoIlNraXBwaW5nIGhvc3QgYnJpZGdlICUwNHg6JTAy
eDolMDJ4LiV1XG4iLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBkZXYtPnNlZywgcGRl
di0+YnVzLCBQQ0lfU0xPVChkZXZmbiksCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJ
X0ZVTkMoZGV2Zm4pKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZGV2LT5zYmRmLnNl
ZywgcGRldi0+c2JkZi5idXMsIHBkZXYtPnNiZGYuZGV2LAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHBkZXYtPnNiZGYuZnVuYyk7CiAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAg
fQogCiAgICAgICAgIEFNRF9JT01NVV9ERUJVRygiTm8gaW9tbXUgZm9yICUwNHg6JTAyeDolMDJ4
LiV1OyBjYW5ub3QgYmUgaGFuZGVkIHRvIGQlZFxuIiwKLSAgICAgICAgICAgICAgICAgICAgICAg
IHBkZXYtPnNlZywgcGRldi0+YnVzLCBQQ0lfU0xPVChkZXZmbiksIFBDSV9GVU5DKGRldmZuKSwK
LSAgICAgICAgICAgICAgICAgICAgICAgIHBkZXYtPmRvbWFpbi0+ZG9tYWluX2lkKTsKKyAgICAg
ICAgICAgICAgICAgICAgICAgIHBkZXYtPnNiZGYuc2VnLCBwZGV2LT5zYmRmLmJ1cywgcGRldi0+
c2JkZi5kZXYsCisgICAgICAgICAgICAgICAgICAgICAgICBwZGV2LT5zYmRmLmZ1bmMsIHBkZXYt
PmRvbWFpbi0+ZG9tYWluX2lkKTsKICAgICAgICAgcmV0dXJuIC1FTk9ERVY7CiAgICAgfQogCkBA
IC00NTIsMTggKzQ0OSwxNyBAQCBzdGF0aWMgaW50IGFtZF9pb21tdV9hZGRfZGV2aWNlKHU4IGRl
dmZuLCBzdHJ1Y3QgcGNpX2RldiAqcGRldikKIHN0YXRpYyBpbnQgYW1kX2lvbW11X3JlbW92ZV9k
ZXZpY2UodTggZGV2Zm4sIHN0cnVjdCBwY2lfZGV2ICpwZGV2KQogewogICAgIHN0cnVjdCBhbWRf
aW9tbXUgKmlvbW11OwotICAgIHUxNiBiZGY7CisKICAgICBpZiAoICFwZGV2LT5kb21haW4gKQog
ICAgICAgICByZXR1cm4gLUVJTlZBTDsKIAotICAgIGJkZiA9IFBDSV9CREYyKHBkZXYtPmJ1cywg
cGRldi0+ZGV2Zm4pOwotICAgIGlvbW11ID0gZmluZF9pb21tdV9mb3JfZGV2aWNlKHBkZXYtPnNl
ZywgYmRmKTsKKyAgICBpb21tdSA9IGZpbmRfaW9tbXVfZm9yX2RldmljZShwZGV2LT5zYmRmLnNl
ZywgcGRldi0+c2JkZi5iZGYpOwogICAgIGlmICggIWlvbW11ICkKICAgICB7CiAgICAgICAgIEFN
RF9JT01NVV9ERUJVRygiRmFpbCB0byBmaW5kIGlvbW11LiIKICAgICAgICAgICAgICAgICAgICAg
ICAgICIgJTA0eDolMDJ4OiUwMnguJXUgY2Fubm90IGJlIHJlbW92ZWQgZnJvbSBkb20lZFxuIiwK
LSAgICAgICAgICAgICAgICAgICAgICAgIHBkZXYtPnNlZywgcGRldi0+YnVzLCBQQ0lfU0xPVChk
ZXZmbiksIFBDSV9GVU5DKGRldmZuKSwKLSAgICAgICAgICAgICAgICAgICAgICAgIHBkZXYtPmRv
bWFpbi0+ZG9tYWluX2lkKTsKKyAgICAgICAgICAgICAgICAgICAgICAgIHBkZXYtPnNiZGYuc2Vn
LCBwZGV2LT5zYmRmLmJ1cywgcGRldi0+c2JkZi5kZXYsCisgICAgICAgICAgICAgICAgICAgICAg
ICBwZGV2LT5zYmRmLmZ1bmMsIHBkZXYtPmRvbWFpbi0+ZG9tYWluX2lkKTsKICAgICAgICAgcmV0
dXJuIC1FTk9ERVY7CiAgICAgfQogCmRpZmYgLS1naXQgYS94ZW4vZHJpdmVycy9wYXNzdGhyb3Vn
aC9wY2kuYyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3BjaS5jCmluZGV4IDgxMDhlZDVmOWEu
LjhkZThkOGUxMTAgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3BjaS5jCisr
KyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3BjaS5jCkBAIC0yMzgsMTAgKzIzOCwxMCBAQCBz
dGF0aWMgdm9pZCBjaGVja19wZGV2KGNvbnN0IHN0cnVjdCBwY2lfZGV2ICpwZGV2KQogICAgIChQ
Q0lfU1RBVFVTX1BBUklUWSB8IFBDSV9TVEFUVVNfU0lHX1RBUkdFVF9BQk9SVCB8IFwKICAgICAg
UENJX1NUQVRVU19SRUNfVEFSR0VUX0FCT1JUIHwgUENJX1NUQVRVU19SRUNfTUFTVEVSX0FCT1JU
IHwgXAogICAgICBQQ0lfU1RBVFVTX1NJR19TWVNURU1fRVJST1IgfCBQQ0lfU1RBVFVTX0RFVEVD
VEVEX1BBUklUWSkKLSAgICB1MTYgc2VnID0gcGRldi0+c2VnOwotICAgIHU4IGJ1cyA9IHBkZXYt
PmJ1czsKLSAgICB1OCBkZXYgPSBQQ0lfU0xPVChwZGV2LT5kZXZmbik7Ci0gICAgdTggZnVuYyA9
IFBDSV9GVU5DKHBkZXYtPmRldmZuKTsKKyAgICB1aW50MTZfdCBzZWcgPSBwZGV2LT5zYmRmLnNl
ZzsKKyAgICB1aW50OF90IGJ1cyA9IHBkZXYtPnNiZGYuYnVzOworICAgIHVpbnQ4X3QgZGV2ID0g
cGRldi0+c2JkZi5kZXY7CisgICAgdWludDhfdCBmdW5jID0gcGRldi0+c2JkZi5mdW5jOwogICAg
IHUxNiB2YWw7CiAKICAgICBpZiAoIGNvbW1hbmRfbWFzayApCkBAIC0yODksMTIgKzI4OSwxMiBA
QCBzdGF0aWMgdm9pZCBjaGVja19wZGV2KGNvbnN0IHN0cnVjdCBwY2lfZGV2ICpwZGV2KQogCiBz
dGF0aWMgdm9pZCBhcHBseV9xdWlya3Moc3RydWN0IHBjaV9kZXYgKnBkZXYpCiB7Ci0gICAgdWlu
dDE2X3QgdmVuZG9yID0gcGNpX2NvbmZfcmVhZDE2KHBkZXYtPnNlZywgcGRldi0+YnVzLAotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lfU0xPVChwZGV2LT5kZXZmbiks
Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9GVU5DKHBkZXYtPmRl
dmZuKSwgUENJX1ZFTkRPUl9JRCk7Ci0gICAgdWludDE2X3QgZGV2aWNlID0gcGNpX2NvbmZfcmVh
ZDE2KHBkZXYtPnNlZywgcGRldi0+YnVzLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBQQ0lfU0xPVChwZGV2LT5kZXZmbiksCi0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIFBDSV9GVU5DKHBkZXYtPmRldmZuKSwgUENJX0RFVklDRV9JRCk7CisgICAg
dWludDE2X3QgdmVuZG9yID0gcGNpX2NvbmZfcmVhZDE2KHBkZXYtPnNiZGYuc2VnLCBwZGV2LT5z
YmRmLmJ1cywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGRldi0+c2Jk
Zi5kZXYsIHBkZXYtPnNiZGYuZnVuYywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgUENJX1ZFTkRPUl9JRCk7CisgICAgdWludDE2X3QgZGV2aWNlID0gcGNpX2NvbmZfcmVh
ZDE2KHBkZXYtPnNiZGYuc2VnLCBwZGV2LT5zYmRmLmJ1cywKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgcGRldi0+c2JkZi5kZXYsIHBkZXYtPnNiZGYuZnVuYywKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX0RFVklDRV9JRCk7CiAgICAgc3Rh
dGljIGNvbnN0IHN0cnVjdCB7CiAgICAgICAgIHVpbnQxNl90IHZlbmRvciwgZGV2aWNlOwogICAg
IH0gaWdub3JlX2JhcnNbXSA9IHsKQEAgLTMzMiwxNiArMzMyLDE0IEBAIHN0YXRpYyBzdHJ1Y3Qg
cGNpX2RldiAqYWxsb2NfcGRldihzdHJ1Y3QgcGNpX3NlZyAqcHNlZywgdTggYnVzLCB1OCBkZXZm
bikKICAgICBzdHJ1Y3QgcGNpX2RldiAqcGRldjsKIAogICAgIGxpc3RfZm9yX2VhY2hfZW50cnkg
KCBwZGV2LCAmcHNlZy0+YWxsZGV2c19saXN0LCBhbGxkZXZzX2xpc3QgKQotICAgICAgICBpZiAo
IHBkZXYtPmJ1cyA9PSBidXMgJiYgcGRldi0+ZGV2Zm4gPT0gZGV2Zm4gKQorICAgICAgICBpZiAo
IHBkZXYtPnNiZGYuYnVzID09IGJ1cyAmJiBwZGV2LT5zYmRmLmV4dGZ1bmMgPT0gZGV2Zm4gKQog
ICAgICAgICAgICAgcmV0dXJuIHBkZXY7CiAKICAgICBwZGV2ID0geHphbGxvYyhzdHJ1Y3QgcGNp
X2Rldik7CiAgICAgaWYgKCAhcGRldiApCiAgICAgICAgIHJldHVybiBOVUxMOwogCi0gICAgKih1
MTYqKSAmcGRldi0+c2VnID0gcHNlZy0+bnI7Ci0gICAgKigodTgqKSAmcGRldi0+YnVzKSA9IGJ1
czsKLSAgICAqKCh1OCopICZwZGV2LT5kZXZmbikgPSBkZXZmbjsKKyAgICAqKHVpbnQzMl90ICop
ICZwZGV2LT5zYmRmLnNiZGYgPSBQQ0lfU0JERjMocHNlZy0+bnIsIGJ1cywgZGV2Zm4pOwogICAg
IHBkZXYtPmRvbWFpbiA9IE5VTEw7CiAgICAgSU5JVF9MSVNUX0hFQUQoJnBkZXYtPm1zaV9saXN0
KTsKIApAQCAtNDM2LDIwICs0MzQsMTggQEAgc3RhdGljIHZvaWQgZnJlZV9wZGV2KHN0cnVjdCBw
Y2lfc2VnICpwc2VnLCBzdHJ1Y3QgcGNpX2RldiAqcGRldikKICAgICAvKiB1cGRhdGUgYnVzMmJy
aWRnZSAqLwogICAgIHN3aXRjaCAoIHBkZXYtPnR5cGUgKQogICAgIHsKLSAgICAgICAgdTggZGV2
LCBmdW5jLCBzZWNfYnVzLCBzdWJfYnVzOworICAgICAgICB1aW50OF90IHNlY19idXMsIHN1Yl9i
dXM7CiAKICAgICAgICAgY2FzZSBERVZfVFlQRV9QQ0llMlBDSV9CUklER0U6CiAgICAgICAgIGNh
c2UgREVWX1RZUEVfTEVHQUNZX1BDSV9CUklER0U6Ci0gICAgICAgICAgICBkZXYgPSBQQ0lfU0xP
VChwZGV2LT5kZXZmbik7Ci0gICAgICAgICAgICBmdW5jID0gUENJX0ZVTkMocGRldi0+ZGV2Zm4p
OwotICAgICAgICAgICAgc2VjX2J1cyA9IHBjaV9jb25mX3JlYWQ4KHBzZWctPm5yLCBwZGV2LT5i
dXMsIGRldiwgZnVuYywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lf
U0VDT05EQVJZX0JVUyk7Ci0gICAgICAgICAgICBzdWJfYnVzID0gcGNpX2NvbmZfcmVhZDgocHNl
Zy0+bnIsIHBkZXYtPmJ1cywgZGV2LCBmdW5jLAotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIFBDSV9TVUJPUkRJTkFURV9CVVMpOworICAgICAgICAgICAgc2VjX2J1cyA9IHBj
aV9jb25mX3JlYWQ4KHBzZWctPm5yLCBwZGV2LT5zYmRmLmJ1cywgcGRldi0+c2JkZi5kZXYsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGRldi0+c2JkZi5mdW5jLCBQQ0lf
U0VDT05EQVJZX0JVUyk7CisgICAgICAgICAgICBzdWJfYnVzID0gcGNpX2NvbmZfcmVhZDgocHNl
Zy0+bnIsIHBkZXYtPnNiZGYuYnVzLCBwZGV2LT5zYmRmLmRldiwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBwZGV2LT5zYmRmLmZ1bmMsIFBDSV9TVUJPUkRJTkFURV9CVVMp
OwogCiAgICAgICAgICAgICBzcGluX2xvY2soJnBzZWctPmJ1czJicmlkZ2VfbG9jayk7CiAgICAg
ICAgICAgICBmb3IgKCA7IHNlY19idXMgPD0gc3ViX2J1czsgc2VjX2J1cysrICkKLSAgICAgICAg
ICAgICAgICBwc2VnLT5idXMyYnJpZGdlW3NlY19idXNdID0gcHNlZy0+YnVzMmJyaWRnZVtwZGV2
LT5idXNdOworICAgICAgICAgICAgICAgIHBzZWctPmJ1czJicmlkZ2Vbc2VjX2J1c10gPSBwc2Vn
LT5idXMyYnJpZGdlW3BkZXYtPnNiZGYuYnVzXTsKICAgICAgICAgICAgIHNwaW5fdW5sb2NrKCZw
c2VnLT5idXMyYnJpZGdlX2xvY2spOwogICAgICAgICAgICAgYnJlYWs7CiAKQEAgLTUzOSw4ICs1
MzUsOCBAQCBzdHJ1Y3QgcGNpX2RldiAqcGNpX2dldF9wZGV2KGludCBzZWcsIGludCBidXMsIGlu
dCBkZXZmbikKIAogICAgIGRvIHsKICAgICAgICAgbGlzdF9mb3JfZWFjaF9lbnRyeSAoIHBkZXYs
ICZwc2VnLT5hbGxkZXZzX2xpc3QsIGFsbGRldnNfbGlzdCApCi0gICAgICAgICAgICBpZiAoIChw
ZGV2LT5idXMgPT0gYnVzIHx8IGJ1cyA9PSAtMSkgJiYKLSAgICAgICAgICAgICAgICAgKHBkZXYt
PmRldmZuID09IGRldmZuIHx8IGRldmZuID09IC0xKSApCisgICAgICAgICAgICBpZiAoIChwZGV2
LT5zYmRmLmJ1cyA9PSBidXMgfHwgYnVzID09IC0xKSAmJgorICAgICAgICAgICAgICAgICAocGRl
di0+c2JkZi5leHRmdW5jID09IGRldmZuIHx8IGRldmZuID09IC0xKSApCiAgICAgICAgICAgICAg
ICAgcmV0dXJuIHBkZXY7CiAgICAgfSB3aGlsZSAoIHJhZGl4X3RyZWVfZ2FuZ19sb29rdXAoJnBj
aV9zZWdtZW50cywgKHZvaWQgKiopJnBzZWcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgcHNlZy0+bnIgKyAxLCAxKSApOwpAQCAtNTg4LDggKzU4NCw4IEBAIHN0cnVjdCBw
Y2lfZGV2ICpwY2lfZ2V0X3BkZXZfYnlfZG9tYWluKGNvbnN0IHN0cnVjdCBkb21haW4gKmQsIGlu
dCBzZWcsCiAKICAgICBkbyB7CiAgICAgICAgIGxpc3RfZm9yX2VhY2hfZW50cnkgKCBwZGV2LCAm
cHNlZy0+YWxsZGV2c19saXN0LCBhbGxkZXZzX2xpc3QgKQotICAgICAgICAgICAgaWYgKCAocGRl
di0+YnVzID09IGJ1cyB8fCBidXMgPT0gLTEpICYmCi0gICAgICAgICAgICAgICAgIChwZGV2LT5k
ZXZmbiA9PSBkZXZmbiB8fCBkZXZmbiA9PSAtMSkgJiYKKyAgICAgICAgICAgIGlmICggKHBkZXYt
PnNiZGYuYnVzID09IGJ1cyB8fCBidXMgPT0gLTEpICYmCisgICAgICAgICAgICAgICAgIChwZGV2
LT5zYmRmLmV4dGZ1bmMgPT0gZGV2Zm4gfHwgZGV2Zm4gPT0gLTEpICYmCiAgICAgICAgICAgICAg
ICAgIChwZGV2LT5kb21haW4gPT0gZCkgKQogICAgICAgICAgICAgICAgIHJldHVybiBwZGV2Owog
ICAgIH0gd2hpbGUgKCByYWRpeF90cmVlX2dhbmdfbG9va3VwKCZwY2lfc2VnbWVudHMsICh2b2lk
ICoqKSZwc2VnLApAQCAtNjA1LDE1ICs2MDEsMTUgQEAgc3RydWN0IHBjaV9kZXYgKnBjaV9nZXRf
cGRldl9ieV9kb21haW4oY29uc3Qgc3RydWN0IGRvbWFpbiAqZCwgaW50IHNlZywKIHN0YXRpYyB2
b2lkIHBjaV9lbmFibGVfYWNzKHN0cnVjdCBwY2lfZGV2ICpwZGV2KQogewogICAgIGludCBwb3M7
Ci0gICAgdTE2IGNhcCwgY3RybCwgc2VnID0gcGRldi0+c2VnOwotICAgIHU4IGJ1cyA9IHBkZXYt
PmJ1czsKLSAgICB1OCBkZXYgPSBQQ0lfU0xPVChwZGV2LT5kZXZmbik7Ci0gICAgdTggZnVuYyA9
IFBDSV9GVU5DKHBkZXYtPmRldmZuKTsKKyAgICB1aW50MTZfdCBjYXAsIGN0cmwsIHNlZyA9IHBk
ZXYtPnNiZGYuc2VnOworICAgIHVpbnQ4X3QgYnVzID0gcGRldi0+c2JkZi5idXM7CisgICAgdWlu
dDhfdCBkZXYgPSBwZGV2LT5zYmRmLmRldjsKKyAgICB1aW50OF90IGZ1bmMgPSBwZGV2LT5zYmRm
LmZ1bmM7CiAKICAgICBpZiAoICFpb21tdV9lbmFibGVkICkKICAgICAgICAgcmV0dXJuOwogCi0g
ICAgcG9zID0gcGNpX2ZpbmRfZXh0X2NhcGFiaWxpdHkoc2VnLCBidXMsIHBkZXYtPmRldmZuLCBQ
Q0lfRVhUX0NBUF9JRF9BQ1MpOworICAgIHBvcyA9IHBjaV9maW5kX2V4dF9jYXBhYmlsaXR5KHNl
ZywgYnVzLCBwZGV2LT5zYmRmLmV4dGZ1bmMsIFBDSV9FWFRfQ0FQX0lEX0FDUyk7CiAgICAgaWYg
KCFwb3MpCiAgICAgICAgIHJldHVybjsKIApAQCAtODQ1LDcgKzg0MSw3IEBAIGludCBwY2lfcmVt
b3ZlX2RldmljZSh1MTYgc2VnLCB1OCBidXMsIHU4IGRldmZuKQogCiAgICAgcGNpZGV2c19sb2Nr
KCk7CiAgICAgbGlzdF9mb3JfZWFjaF9lbnRyeSAoIHBkZXYsICZwc2VnLT5hbGxkZXZzX2xpc3Qs
IGFsbGRldnNfbGlzdCApCi0gICAgICAgIGlmICggcGRldi0+YnVzID09IGJ1cyAmJiBwZGV2LT5k
ZXZmbiA9PSBkZXZmbiApCisgICAgICAgIGlmICggcGRldi0+c2JkZi5idXMgPT0gYnVzICYmIHBk
ZXYtPnNiZGYuZXh0ZnVuYyA9PSBkZXZmbiApCiAgICAgICAgIHsKICAgICAgICAgICAgIHJldCA9
IGlvbW11X3JlbW92ZV9kZXZpY2UocGRldik7CiAgICAgICAgICAgICBpZiAoIHBkZXYtPmRvbWFp
biApCkBAIC05MjQsMTEgKzkyMCwxMSBAQCBpbnQgcGNpX3JlbGVhc2VfZGV2aWNlcyhzdHJ1Y3Qg
ZG9tYWluICpkKQogICAgIH0KICAgICB3aGlsZSAoIChwZGV2ID0gcGNpX2dldF9wZGV2X2J5X2Rv
bWFpbihkLCAtMSwgLTEsIC0xKSkgKQogICAgIHsKLSAgICAgICAgYnVzID0gcGRldi0+YnVzOwot
ICAgICAgICBkZXZmbiA9IHBkZXYtPmRldmZuOwotICAgICAgICBpZiAoIGRlYXNzaWduX2Rldmlj
ZShkLCBwZGV2LT5zZWcsIGJ1cywgZGV2Zm4pICkKKyAgICAgICAgYnVzID0gcGRldi0+c2JkZi5i
dXM7CisgICAgICAgIGRldmZuID0gcGRldi0+c2JkZi5leHRmdW5jOworICAgICAgICBpZiAoIGRl
YXNzaWduX2RldmljZShkLCBwZGV2LT5zYmRmLnNlZywgYnVzLCBkZXZmbikgKQogICAgICAgICAg
ICAgcHJpbnRrKCJkb21haW4gJWQ6IGRlYXNzaWduIGRldmljZSAoJTA0eDolMDJ4OiUwMnguJXUp
IGZhaWxlZCFcbiIsCi0gICAgICAgICAgICAgICAgICAgZC0+ZG9tYWluX2lkLCBwZGV2LT5zZWcs
IGJ1cywKKyAgICAgICAgICAgICAgICAgICBkLT5kb21haW5faWQsIHBkZXYtPnNiZGYuc2VnLCBi
dXMsCiAgICAgICAgICAgICAgICAgICAgUENJX1NMT1QoZGV2Zm4pLCBQQ0lfRlVOQyhkZXZmbikp
OwogICAgIH0KICAgICBwY2lkZXZzX3VubG9jaygpOwpAQCAtMTA0NywxMCArMTA0Myw5IEBAIHZv
aWQgcGNpX2NoZWNrX2Rpc2FibGVfZGV2aWNlKHUxNiBzZWcsIHU4IGJ1cywgdTggZGV2Zm4pCiAK
ICAgICAvKiBUZWxsIHRoZSBkZXZpY2UgdG8gc3RvcCBETUFpbmc7IHdlIGNhbid0IHJlbHkgb24g
dGhlIGd1ZXN0IHRvCiAgICAgICogY29udHJvbCBpdCBmb3IgdXMuICovCi0gICAgZGV2Zm4gPSBw
ZGV2LT5kZXZmbjsKLSAgICBjd29yZCA9IHBjaV9jb25mX3JlYWQxNihzZWcsIGJ1cywgUENJX1NM
T1QoZGV2Zm4pLCBQQ0lfRlVOQyhkZXZmbiksCisgICAgY3dvcmQgPSBwY2lfY29uZl9yZWFkMTYo
c2VnLCBidXMsIHBkZXYtPnNiZGYuZGV2LCBwZGV2LT5zYmRmLmZ1bmMsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgUENJX0NPTU1BTkQpOwotICAgIHBjaV9jb25mX3dyaXRlMTYoc2VnLCBi
dXMsIFBDSV9TTE9UKGRldmZuKSwgUENJX0ZVTkMoZGV2Zm4pLAorICAgIHBjaV9jb25mX3dyaXRl
MTYoc2VnLCBidXMsIHBkZXYtPnNiZGYuZGV2LCBwZGV2LT5zYmRmLmZ1bmMsCiAgICAgICAgICAg
ICAgICAgICAgICBQQ0lfQ09NTUFORCwgY3dvcmQgJiB+UENJX0NPTU1BTkRfTUFTVEVSKTsKIH0K
IApAQCAtMTExMyw3ICsxMTA4LDcgQEAgc3RydWN0IHNldHVwX2h3ZG9tIHsKIHN0YXRpYyB2b2lk
IF9faHdkb21faW5pdCBzZXR1cF9vbmVfaHdkb21fZGV2aWNlKGNvbnN0IHN0cnVjdCBzZXR1cF9o
d2RvbSAqY3R4dCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHN0cnVjdCBwY2lfZGV2ICpwZGV2KQogewotICAgIHU4IGRldmZuID0gcGRldi0+ZGV2Zm47
CisgICAgdWludDhfdCBkZXZmbiA9IHBkZXYtPnNiZGYuZXh0ZnVuYzsKICAgICBpbnQgZXJyOwog
CiAgICAgZG8gewpAQCAtMTEyMSwxNCArMTExNiwxNCBAQCBzdGF0aWMgdm9pZCBfX2h3ZG9tX2lu
aXQgc2V0dXBfb25lX2h3ZG9tX2RldmljZShjb25zdCBzdHJ1Y3Qgc2V0dXBfaHdkb20gKmN0eHQs
CiAgICAgICAgIGlmICggZXJyICkKICAgICAgICAgewogICAgICAgICAgICAgcHJpbnRrKFhFTkxP
R19FUlIgInNldHVwICUwNHg6JTAyeDolMDJ4LiV1IGZvciBkJWQgZmFpbGVkICglZClcbiIsCi0g
ICAgICAgICAgICAgICAgICAgcGRldi0+c2VnLCBwZGV2LT5idXMsIFBDSV9TTE9UKGRldmZuKSwg
UENJX0ZVTkMoZGV2Zm4pLAotICAgICAgICAgICAgICAgICAgIGN0eHQtPmQtPmRvbWFpbl9pZCwg
ZXJyKTsKLSAgICAgICAgICAgIGlmICggZGV2Zm4gPT0gcGRldi0+ZGV2Zm4gKQorICAgICAgICAg
ICAgICAgICAgIHBkZXYtPnNiZGYuc2VnLCBwZGV2LT5zYmRmLmJ1cywgcGRldi0+c2JkZi5kZXYs
CisgICAgICAgICAgICAgICAgICAgcGRldi0+c2JkZi5mdW5jLCBjdHh0LT5kLT5kb21haW5faWQs
IGVycik7CisgICAgICAgICAgICBpZiAoIGRldmZuID09IHBkZXYtPnNiZGYuZXh0ZnVuYyApCiAg
ICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgICAgIGRldmZuICs9IHBkZXYt
PnBoYW50b21fc3RyaWRlOwotICAgIH0gd2hpbGUgKCBkZXZmbiAhPSBwZGV2LT5kZXZmbiAmJgot
ICAgICAgICAgICAgICBQQ0lfU0xPVChkZXZmbikgPT0gUENJX1NMT1QocGRldi0+ZGV2Zm4pICk7
CisgICAgfSB3aGlsZSAoIGRldmZuICE9IHBkZXYtPnNiZGYuZXh0ZnVuYyAmJgorICAgICAgICAg
ICAgICBQQ0lfU0xPVChkZXZmbikgPT0gcGRldi0+c2JkZi5kZXYgKTsKIAogICAgIGVyciA9IHZw
Y2lfYWRkX2hhbmRsZXJzKHBkZXYpOwogICAgIGlmICggZXJyICkKQEAgLTEyMDMsMjQgKzExOTgs
MjIgQEAgdm9pZCBfX2h3ZG9tX2luaXQgc2V0dXBfaHdkb21fcGNpX2RldmljZXMoCiBzdGF0aWMg
aW50IGhlc3RfbWF0Y2hfcGNpKGNvbnN0IHN0cnVjdCBhY3BpX2hlc3RfYWVyX2NvbW1vbiAqcCwK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RydWN0IHBjaV9kZXYgKnBkZXYpCiB7
Ci0gICAgcmV0dXJuIEFDUElfSEVTVF9TRUdNRU5UKHAtPmJ1cykgPT0gcGRldi0+c2VnICYmCi0g
ICAgICAgICAgIEFDUElfSEVTVF9CVVMocC0+YnVzKSAgICAgPT0gcGRldi0+YnVzICYmCi0gICAg
ICAgICAgIHAtPmRldmljZSAgICAgICAgICAgICAgICAgPT0gUENJX1NMT1QocGRldi0+ZGV2Zm4p
ICYmCi0gICAgICAgICAgIHAtPmZ1bmN0aW9uICAgICAgICAgICAgICAgPT0gUENJX0ZVTkMocGRl
di0+ZGV2Zm4pOworICAgIHJldHVybiBBQ1BJX0hFU1RfU0VHTUVOVChwLT5idXMpID09IHBkZXYt
PnNiZGYuc2VnICYmCisgICAgICAgICAgIEFDUElfSEVTVF9CVVMocC0+YnVzKSAgICAgPT0gcGRl
di0+c2JkZi5idXMgJiYKKyAgICAgICAgICAgcC0+ZGV2aWNlICAgICAgICAgICAgICAgICA9PSBw
ZGV2LT5zYmRmLmRldiAmJgorICAgICAgICAgICBwLT5mdW5jdGlvbiAgICAgICAgICAgICAgID09
IHBkZXYtPnNiZGYuZnVuYzsKIH0KIAogc3RhdGljIGJvb2xfdCBoZXN0X21hdGNoX3R5cGUoY29u
c3Qgc3RydWN0IGFjcGlfaGVzdF9oZWFkZXIgKmhlc3RfaGRyLAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgY29uc3Qgc3RydWN0IHBjaV9kZXYgKnBkZXYpCiB7Ci0gICAgdW5zaWduZWQg
aW50IHBvcyA9IHBjaV9maW5kX2NhcF9vZmZzZXQocGRldi0+c2VnLCBwZGV2LT5idXMsCi0gICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX1NMT1QocGRldi0+ZGV2
Zm4pLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9GVU5D
KHBkZXYtPmRldmZuKSwKKyAgICB1bnNpZ25lZCBpbnQgcG9zID0gcGNpX2ZpbmRfY2FwX29mZnNl
dChwZGV2LT5zYmRmLnNlZywgcGRldi0+c2JkZi5idXMsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgcGRldi0+c2JkZi5kZXYsIHBkZXYtPnNiZGYuZnVuYywKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lfQ0FQX0lEX0VYUCk7
Ci0gICAgdTggcGNpZSA9IE1BU0tfRVhUUihwY2lfY29uZl9yZWFkMTYocGRldi0+c2VnLCBwZGV2
LT5idXMsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX1NMT1Qo
cGRldi0+ZGV2Zm4pLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBD
SV9GVU5DKHBkZXYtPmRldmZuKSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBwb3MgKyBQQ0lfRVhQX0ZMQUdTKSwKLSAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9F
WFBfRkxBR1NfVFlQRSk7CisgICAgdWludDhfdCBwY2llID0gTUFTS19FWFRSKHBjaV9jb25mX3Jl
YWQxNihwZGV2LT5zYmRmLnNlZywgcGRldi0+c2JkZi5idXMsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBwZGV2LT5zYmRmLmRldiwgcGRldi0+c2JkZi5mdW5j
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zICsgUENJ
X0VYUF9GTEFHUyksCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9FWFBfRkxBR1Nf
VFlQRSk7CiAKICAgICBzd2l0Y2ggKCBoZXN0X2hkci0+dHlwZSApCiAgICAgewpAQCAtMTIyOSw4
ICsxMjIyLDggQEAgc3RhdGljIGJvb2xfdCBoZXN0X21hdGNoX3R5cGUoY29uc3Qgc3RydWN0IGFj
cGlfaGVzdF9oZWFkZXIgKmhlc3RfaGRyLAogICAgIGNhc2UgQUNQSV9IRVNUX1RZUEVfQUVSX0VO
RFBPSU5UOgogICAgICAgICByZXR1cm4gcGNpZSA9PSBQQ0lfRVhQX1RZUEVfRU5EUE9JTlQ7CiAg
ICAgY2FzZSBBQ1BJX0hFU1RfVFlQRV9BRVJfQlJJREdFOgotICAgICAgICByZXR1cm4gcGNpX2Nv
bmZfcmVhZDE2KHBkZXYtPnNlZywgcGRldi0+YnVzLCBQQ0lfU0xPVChwZGV2LT5kZXZmbiksCi0g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX0ZVTkMocGRldi0+ZGV2Zm4pLCBQQ0lf
Q0xBU1NfREVWSUNFKSA9PQorICAgICAgICByZXR1cm4gcGNpX2NvbmZfcmVhZDE2KHBkZXYtPnNi
ZGYuc2VnLCBwZGV2LT5zYmRmLmJ1cywgcGRldi0+c2JkZi5kZXYsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgcGRldi0+c2JkZi5mdW5jLCBQQ0lfQ0xBU1NfREVWSUNFKSA9PQogICAg
ICAgICAgICAgICAgUENJX0NMQVNTX0JSSURHRV9QQ0k7CiAgICAgfQogCkBAIC0xMjg5LDggKzEy
ODIsOCBAQCBib29sX3QgcGNpZV9hZXJfZ2V0X2Zpcm13YXJlX2ZpcnN0KGNvbnN0IHN0cnVjdCBw
Y2lfZGV2ICpwZGV2KQogewogICAgIHN0cnVjdCBhZXJfaGVzdF9wYXJzZV9pbmZvIGluZm8gPSB7
IC5wZGV2ID0gcGRldiB9OwogCi0gICAgcmV0dXJuIHBjaV9maW5kX2NhcF9vZmZzZXQocGRldi0+
c2VnLCBwZGV2LT5idXMsIFBDSV9TTE9UKHBkZXYtPmRldmZuKSwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBQQ0lfRlVOQyhwZGV2LT5kZXZmbiksIFBDSV9DQVBfSURfRVhQKSAmJgor
ICAgIHJldHVybiBwY2lfZmluZF9jYXBfb2Zmc2V0KHBkZXYtPnNiZGYuc2VnLCBwZGV2LT5zYmRm
LmJ1cywgcGRldi0+c2JkZi5kZXYsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGRl
di0+c2JkZi5mdW5jLCBQQ0lfQ0FQX0lEX0VYUCkgJiYKICAgICAgICAgICAgYXBlaV9oZXN0X3Bh
cnNlKGFlcl9oZXN0X3BhcnNlLCAmaW5mbykgPj0gMCAmJgogICAgICAgICAgICBpbmZvLmZpcm13
YXJlX2ZpcnN0OwogfQpAQCAtMTMwNiw4ICsxMjk5LDcgQEAgc3RhdGljIGludCBfZHVtcF9wY2lf
ZGV2aWNlcyhzdHJ1Y3QgcGNpX3NlZyAqcHNlZywgdm9pZCAqYXJnKQogICAgIGxpc3RfZm9yX2Vh
Y2hfZW50cnkgKCBwZGV2LCAmcHNlZy0+YWxsZGV2c19saXN0LCBhbGxkZXZzX2xpc3QgKQogICAg
IHsKICAgICAgICAgcHJpbnRrKCIlMDR4OiUwMng6JTAyeC4ldSAtIGRvbSAlLTNkIC0gbm9kZSAl
LTNkIC0gTVNJcyA8ICIsCi0gICAgICAgICAgICAgICBwc2VnLT5uciwgcGRldi0+YnVzLAotICAg
ICAgICAgICAgICAgUENJX1NMT1QocGRldi0+ZGV2Zm4pLCBQQ0lfRlVOQyhwZGV2LT5kZXZmbiks
CisgICAgICAgICAgICAgICBwc2VnLT5uciwgcGRldi0+c2JkZi5idXMsIHBkZXYtPnNiZGYuZGV2
LCBwZGV2LT5zYmRmLmZ1bmMsCiAgICAgICAgICAgICAgICBwZGV2LT5kb21haW4gPyBwZGV2LT5k
b21haW4tPmRvbWFpbl9pZCA6IC0xLAogICAgICAgICAgICAgICAgKHBkZXYtPm5vZGUgIT0gTlVN
QV9OT19OT0RFKSA/IHBkZXYtPm5vZGUgOiAtMSk7CiAgICAgICAgIGxpc3RfZm9yX2VhY2hfZW50
cnkgKCBtc2ksICZwZGV2LT5tc2lfbGlzdCwgbGlzdCApCkBAIC0xMzYyLDE5ICsxMzU0LDIwIEBA
IHN0YXRpYyBpbnQgaW9tbXVfYWRkX2RldmljZShzdHJ1Y3QgcGNpX2RldiAqcGRldikKICAgICBp
ZiAoICFpb21tdV9lbmFibGVkIHx8ICFoZC0+cGxhdGZvcm1fb3BzICkKICAgICAgICAgcmV0dXJu
IDA7CiAKLSAgICByYyA9IGhkLT5wbGF0Zm9ybV9vcHMtPmFkZF9kZXZpY2UocGRldi0+ZGV2Zm4s
IHBjaV90b19kZXYocGRldikpOworICAgIHJjID0gaGQtPnBsYXRmb3JtX29wcy0+YWRkX2Rldmlj
ZShwZGV2LT5zYmRmLmV4dGZ1bmMsIHBjaV90b19kZXYocGRldikpOwogICAgIGlmICggcmMgfHwg
IXBkZXYtPnBoYW50b21fc3RyaWRlICkKICAgICAgICAgcmV0dXJuIHJjOwogCi0gICAgZm9yICgg
ZGV2Zm4gPSBwZGV2LT5kZXZmbiA7IDsgKQorICAgIGZvciAoIGRldmZuID0gcGRldi0+c2JkZi5l
eHRmdW5jIDsgOyApCiAgICAgewogICAgICAgICBkZXZmbiArPSBwZGV2LT5waGFudG9tX3N0cmlk
ZTsKLSAgICAgICAgaWYgKCBQQ0lfU0xPVChkZXZmbikgIT0gUENJX1NMT1QocGRldi0+ZGV2Zm4p
ICkKKyAgICAgICAgaWYgKCBQQ0lfU0xPVChkZXZmbikgIT0gcGRldi0+c2JkZi5kZXYgKQogICAg
ICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgIHJjID0gaGQtPnBsYXRmb3JtX29wcy0+YWRkX2Rl
dmljZShkZXZmbiwgcGNpX3RvX2RldihwZGV2KSk7CiAgICAgICAgIGlmICggcmMgKQogICAgICAg
ICAgICAgcHJpbnRrKFhFTkxPR19XQVJOSU5HICJJT01NVTogYWRkICUwNHg6JTAyeDolMDJ4LiV1
IGZhaWxlZCAoJWQpXG4iLAotICAgICAgICAgICAgICAgICAgIHBkZXYtPnNlZywgcGRldi0+YnVz
LCBQQ0lfU0xPVChkZXZmbiksIFBDSV9GVU5DKGRldmZuKSwgcmMpOworICAgICAgICAgICAgICAg
ICAgIHBkZXYtPnNiZGYuc2VnLCBwZGV2LT5zYmRmLmJ1cywgUENJX1NMT1QoZGV2Zm4pLAorICAg
ICAgICAgICAgICAgICAgIFBDSV9GVU5DKGRldmZuKSwgcmMpOwogICAgIH0KIH0KIApAQCAtMTM5
OCw3ICsxMzkxLDcgQEAgc3RhdGljIGludCBpb21tdV9lbmFibGVfZGV2aWNlKHN0cnVjdCBwY2lf
ZGV2ICpwZGV2KQogc3RhdGljIGludCBpb21tdV9yZW1vdmVfZGV2aWNlKHN0cnVjdCBwY2lfZGV2
ICpwZGV2KQogewogICAgIGNvbnN0IHN0cnVjdCBkb21haW5faW9tbXUgKmhkOwotICAgIHU4IGRl
dmZuOworICAgIHVpbnQ4X3QgZGV2Zm47CiAKICAgICBpZiAoICFwZGV2LT5kb21haW4gKQogICAg
ICAgICByZXR1cm4gLUVJTlZBTDsKQEAgLTE0MDcsMjMgKzE0MDAsMjQgQEAgc3RhdGljIGludCBp
b21tdV9yZW1vdmVfZGV2aWNlKHN0cnVjdCBwY2lfZGV2ICpwZGV2KQogICAgIGlmICggIWlvbW11
X2VuYWJsZWQgfHwgIWhkLT5wbGF0Zm9ybV9vcHMgKQogICAgICAgICByZXR1cm4gMDsKIAotICAg
IGZvciAoIGRldmZuID0gcGRldi0+ZGV2Zm4gOyBwZGV2LT5waGFudG9tX3N0cmlkZTsgKQorICAg
IGZvciAoIGRldmZuID0gcGRldi0+c2JkZi5leHRmdW5jIDsgcGRldi0+cGhhbnRvbV9zdHJpZGU7
ICkKICAgICB7CiAgICAgICAgIGludCByYzsKIAogICAgICAgICBkZXZmbiArPSBwZGV2LT5waGFu
dG9tX3N0cmlkZTsKLSAgICAgICAgaWYgKCBQQ0lfU0xPVChkZXZmbikgIT0gUENJX1NMT1QocGRl
di0+ZGV2Zm4pICkKKyAgICAgICAgaWYgKCBQQ0lfU0xPVChkZXZmbikgIT0gcGRldi0+c2JkZi5k
ZXYgKQogICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgIHJjID0gaGQtPnBsYXRmb3JtX29wcy0+
cmVtb3ZlX2RldmljZShkZXZmbiwgcGNpX3RvX2RldihwZGV2KSk7CiAgICAgICAgIGlmICggIXJj
ICkKICAgICAgICAgICAgIGNvbnRpbnVlOwogCiAgICAgICAgIHByaW50ayhYRU5MT0dfRVJSICJJ
T01NVTogcmVtb3ZlICUwNHg6JTAyeDolMDJ4LiV1IGZhaWxlZCAoJWQpXG4iLAotICAgICAgICAg
ICAgICAgcGRldi0+c2VnLCBwZGV2LT5idXMsIFBDSV9TTE9UKGRldmZuKSwgUENJX0ZVTkMoZGV2
Zm4pLCByYyk7CisgICAgICAgICAgICAgICBwZGV2LT5zYmRmLnNlZywgcGRldi0+c2JkZi5idXMs
IFBDSV9TTE9UKGRldmZuKSwgUENJX0ZVTkMoZGV2Zm4pLAorICAgICAgICAgICAgICAgcmMpOwog
ICAgICAgICByZXR1cm4gcmM7CiAgICAgfQogCi0gICAgcmV0dXJuIGhkLT5wbGF0Zm9ybV9vcHMt
PnJlbW92ZV9kZXZpY2UocGRldi0+ZGV2Zm4sIHBjaV90b19kZXYocGRldikpOworICAgIHJldHVy
biBoZC0+cGxhdGZvcm1fb3BzLT5yZW1vdmVfZGV2aWNlKHBkZXYtPnNiZGYuZXh0ZnVuYywgcGNp
X3RvX2RldihwZGV2KSk7CiB9CiAKIC8qCkBAIC0xNDg1LDcgKzE0NzksNyBAQCBzdGF0aWMgaW50
IGFzc2lnbl9kZXZpY2Uoc3RydWN0IGRvbWFpbiAqZCwgdTE2IHNlZywgdTggYnVzLCB1OCBkZXZm
biwgdTMyIGZsYWcpCiAgICAgZm9yICggOyBwZGV2LT5waGFudG9tX3N0cmlkZTsgcmMgPSAwICkK
ICAgICB7CiAgICAgICAgIGRldmZuICs9IHBkZXYtPnBoYW50b21fc3RyaWRlOwotICAgICAgICBp
ZiAoIFBDSV9TTE9UKGRldmZuKSAhPSBQQ0lfU0xPVChwZGV2LT5kZXZmbikgKQorICAgICAgICBp
ZiAoIFBDSV9TTE9UKGRldmZuKSAhPSBwZGV2LT5zYmRmLmRldiApCiAgICAgICAgICAgICBicmVh
azsKICAgICAgICAgcmMgPSBoZC0+cGxhdGZvcm1fb3BzLT5hc3NpZ25fZGV2aWNlKGQsIGRldmZu
LCBwY2lfdG9fZGV2KHBkZXYpLCBmbGFnKTsKICAgICAgICAgaWYgKCByYyApCkBAIC0xNTIwLDcg
KzE1MTQsNyBAQCBpbnQgZGVhc3NpZ25fZGV2aWNlKHN0cnVjdCBkb21haW4gKmQsIHUxNiBzZWcs
IHU4IGJ1cywgdTggZGV2Zm4pCiAgICAgd2hpbGUgKCBwZGV2LT5waGFudG9tX3N0cmlkZSApCiAg
ICAgewogICAgICAgICBkZXZmbiArPSBwZGV2LT5waGFudG9tX3N0cmlkZTsKLSAgICAgICAgaWYg
KCBQQ0lfU0xPVChkZXZmbikgIT0gUENJX1NMT1QocGRldi0+ZGV2Zm4pICkKKyAgICAgICAgaWYg
KCBQQ0lfU0xPVChkZXZmbikgIT0gcGRldi0+c2JkZi5kZXYgKQogICAgICAgICAgICAgYnJlYWs7
CiAgICAgICAgIHJldCA9IGhkLT5wbGF0Zm9ybV9vcHMtPnJlYXNzaWduX2RldmljZShkLCBoYXJk
d2FyZV9kb21haW4sIGRldmZuLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgcGNpX3RvX2RldihwZGV2KSk7CkBAIC0xNTMyLDcgKzE1MjYsNyBAQCBpbnQg
ZGVhc3NpZ25fZGV2aWNlKHN0cnVjdCBkb21haW4gKmQsIHUxNiBzZWcsIHU4IGJ1cywgdTggZGV2
Zm4pCiAgICAgICAgIHJldHVybiByZXQ7CiAgICAgfQogCi0gICAgZGV2Zm4gPSBwZGV2LT5kZXZm
bjsKKyAgICBkZXZmbiA9IHBkZXYtPnNiZGYuZXh0ZnVuYzsKICAgICByZXQgPSBoZC0+cGxhdGZv
cm1fb3BzLT5yZWFzc2lnbl9kZXZpY2UoZCwgaGFyZHdhcmVfZG9tYWluLCBkZXZmbiwKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGNpX3RvX2RldihwZGV2KSk7
CiAgICAgaWYgKCByZXQgKQpAQCAtMTU1OCw3ICsxNTUyLDYgQEAgc3RhdGljIGludCBpb21tdV9n
ZXRfZGV2aWNlX2dyb3VwKAogICAgIGNvbnN0IHN0cnVjdCBkb21haW5faW9tbXUgKmhkID0gZG9t
X2lvbW11KGQpOwogICAgIHN0cnVjdCBwY2lfZGV2ICpwZGV2OwogICAgIGludCBncm91cF9pZCwg
c2Rldl9pZDsKLSAgICB1MzIgYmRmOwogICAgIGludCBpID0gMDsKICAgICBjb25zdCBzdHJ1Y3Qg
aW9tbXVfb3BzICpvcHMgPSBoZC0+cGxhdGZvcm1fb3BzOwogCkBAIC0xNTcwLDE5ICsxNTYzLDE4
IEBAIHN0YXRpYyBpbnQgaW9tbXVfZ2V0X2RldmljZV9ncm91cCgKICAgICBwY2lkZXZzX2xvY2so
KTsKICAgICBmb3JfZWFjaF9wZGV2KCBkLCBwZGV2ICkKICAgICB7Ci0gICAgICAgIGlmICggKHBk
ZXYtPnNlZyAhPSBzZWcpIHx8Ci0gICAgICAgICAgICAgKChwZGV2LT5idXMgPT0gYnVzKSAmJiAo
cGRldi0+ZGV2Zm4gPT0gZGV2Zm4pKSApCisgICAgICAgIGlmICggKHBkZXYtPnNiZGYuc2VnICE9
IHNlZykgfHwKKyAgICAgICAgICAgICAoKHBkZXYtPnNiZGYuYnVzID09IGJ1cykgJiYgKHBkZXYt
PnNiZGYuZXh0ZnVuYyA9PSBkZXZmbikpICkKICAgICAgICAgICAgIGNvbnRpbnVlOwogCi0gICAg
ICAgIGlmICggeHNtX2dldF9kZXZpY2VfZ3JvdXAoWFNNX0hPT0ssIChzZWcgPDwgMTYpIHwgKHBk
ZXYtPmJ1cyA8PCA4KSB8IHBkZXYtPmRldmZuKSApCisgICAgICAgIGlmICggeHNtX2dldF9kZXZp
Y2VfZ3JvdXAoWFNNX0hPT0ssIChzZWcgPDwgMTYpIHwgcGRldi0+c2JkZi5iZGYpICkKICAgICAg
ICAgICAgIGNvbnRpbnVlOwogCi0gICAgICAgIHNkZXZfaWQgPSBvcHMtPmdldF9kZXZpY2VfZ3Jv
dXBfaWQoc2VnLCBwZGV2LT5idXMsIHBkZXYtPmRldmZuKTsKKyAgICAgICAgc2Rldl9pZCA9IG9w
cy0+Z2V0X2RldmljZV9ncm91cF9pZChzZWcsIHBkZXYtPnNiZGYuYnVzLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBkZXYtPnNiZGYuZXh0ZnVuYyk7CiAgICAg
ICAgIGlmICggKHNkZXZfaWQgPT0gZ3JvdXBfaWQpICYmIChpIDwgbWF4X3NkZXZzKSApCiAgICAg
ICAgIHsKLSAgICAgICAgICAgIGJkZiA9IDA7Ci0gICAgICAgICAgICBiZGYgfD0gKHBkZXYtPmJ1
cyAmIDB4ZmYpIDw8IDE2OwotICAgICAgICAgICAgYmRmIHw9IChwZGV2LT5kZXZmbiAmIDB4ZmYp
IDw8IDg7CisgICAgICAgICAgICB1aW50MzJfdCBiZGYgPSBwZGV2LT5zYmRmLmJkZjsKIAogICAg
ICAgICAgICAgaWYgKCB1bmxpa2VseShjb3B5X3RvX2d1ZXN0X29mZnNldChidWYsIGksICZiZGYs
IDEpKSApCiAgICAgICAgICAgICB7CkBAIC0xNjE4LDggKzE2MTAsOCBAQCB2b2lkIGlvbW11X2Rl
dl9pb3RsYl9mbHVzaF90aW1lb3V0KHN0cnVjdCBkb21haW4gKmQsIHN0cnVjdCBwY2lfZGV2ICpw
ZGV2KQogICAgIGlmICggIWQtPmlzX3NodXR0aW5nX2Rvd24gJiYgcHJpbnRrX3JhdGVsaW1pdCgp
ICkKICAgICAgICAgcHJpbnRrKFhFTkxPR19FUlIKICAgICAgICAgICAgICAgICJkb20lZDogQVRT
IGRldmljZSAlMDR4OiUwMng6JTAyeC4ldSBmbHVzaCBmYWlsZWRcbiIsCi0gICAgICAgICAgICAg
ICBkLT5kb21haW5faWQsIHBkZXYtPnNlZywgcGRldi0+YnVzLCBQQ0lfU0xPVChwZGV2LT5kZXZm
biksCi0gICAgICAgICAgICAgICBQQ0lfRlVOQyhwZGV2LT5kZXZmbikpOworICAgICAgICAgICAg
ICAgZC0+ZG9tYWluX2lkLCBwZGV2LT5zYmRmLnNlZywgcGRldi0+c2JkZi5idXMsIHBkZXYtPnNi
ZGYuZGV2LAorICAgICAgICAgICAgICAgcGRldi0+c2JkZi5mdW5jKTsKICAgICBpZiAoICFpc19o
YXJkd2FyZV9kb21haW4oZCkgKQogICAgICAgICBkb21haW5fY3Jhc2goZCk7CiAKZGlmZiAtLWdp
dCBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9kbWFyLmMgYi94ZW4vZHJpdmVycy9wYXNz
dGhyb3VnaC92dGQvZG1hci5jCmluZGV4IDljYzg2MjNlNTMuLmVmZmFmOTMyMjIgMTAwNjQ0Ci0t
LSBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9kbWFyLmMKKysrIGIveGVuL2RyaXZlcnMv
cGFzc3Rocm91Z2gvdnRkL2RtYXIuYwpAQCAtMjE5LDE4ICsyMTksMTggQEAgc3RydWN0IGFjcGlf
ZHJoZF91bml0ICphY3BpX2ZpbmRfbWF0Y2hlZF9kcmhkX3VuaXQoY29uc3Qgc3RydWN0IHBjaV9k
ZXYgKnBkZXYpCiAgICAgfQogICAgIGVsc2UgaWYgKCBwZGV2LT5pbmZvLmlzX2V4dGZuICkKICAg
ICB7Ci0gICAgICAgIGJ1cyA9IHBkZXYtPmJ1czsKKyAgICAgICAgYnVzID0gcGRldi0+c2JkZi5i
dXM7CiAgICAgICAgIGRldmZuID0gMDsKICAgICB9CiAgICAgZWxzZQogICAgIHsKLSAgICAgICAg
YnVzID0gcGRldi0+YnVzOwotICAgICAgICBkZXZmbiA9IHBkZXYtPmRldmZuOworICAgICAgICBi
dXMgPSBwZGV2LT5zYmRmLmJ1czsKKyAgICAgICAgZGV2Zm4gPSBwZGV2LT5zYmRmLmV4dGZ1bmM7
CiAgICAgfQogCiAgICAgbGlzdF9mb3JfZWFjaF9lbnRyeSAoIGRyaGQsICZhY3BpX2RyaGRfdW5p
dHMsIGxpc3QgKQogICAgIHsKLSAgICAgICAgaWYgKCBkcmhkLT5zZWdtZW50ICE9IHBkZXYtPnNl
ZyApCisgICAgICAgIGlmICggZHJoZC0+c2VnbWVudCAhPSBwZGV2LT5zYmRmLnNlZyApCiAgICAg
ICAgICAgICBjb250aW51ZTsKIAogICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZHJoZC0+c2NvcGUu
ZGV2aWNlc19jbnQ7IGkrKykKQEAgLTI1MywxMCArMjUzLDEwIEBAIHN0cnVjdCBhY3BpX2F0c3Jf
dW5pdCAqYWNwaV9maW5kX21hdGNoZWRfYXRzcl91bml0KGNvbnN0IHN0cnVjdCBwY2lfZGV2ICpw
ZGV2KQogCiAgICAgbGlzdF9mb3JfZWFjaF9lbnRyeSAoIGF0c3IsICZhY3BpX2F0c3JfdW5pdHMs
IGxpc3QgKQogICAgIHsKLSAgICAgICAgaWYgKCBhdHNyLT5zZWdtZW50ICE9IHBkZXYtPnNlZyAp
CisgICAgICAgIGlmICggYXRzci0+c2VnbWVudCAhPSBwZGV2LT5zYmRmLnNlZyApCiAgICAgICAg
ICAgICBjb250aW51ZTsKIAotICAgICAgICBpZiAoIHRlc3RfYml0KHBkZXYtPmJ1cywgYXRzci0+
c2NvcGUuYnVzZXMpICkKKyAgICAgICAgaWYgKCB0ZXN0X2JpdChwZGV2LT5zYmRmLmJ1cywgYXRz
ci0+c2NvcGUuYnVzZXMpICkKICAgICAgICAgICAgIHJldHVybiBhdHNyOwogCiAgICAgICAgIGlm
ICggYXRzci0+YWxsX3BvcnRzICkKZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdo
L3Z0ZC9pbnRyZW1hcC5jIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvdnRkL2ludHJlbWFwLmMK
aW5kZXggZGYwZThhYzVjYi4uMGRiZjk5NTUxZSAxMDA2NDQKLS0tIGEveGVuL2RyaXZlcnMvcGFz
c3Rocm91Z2gvdnRkL2ludHJlbWFwLmMKKysrIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvdnRk
L2ludHJlbWFwLmMKQEAgLTQ4Myw5ICs0ODMsOSBAQCBzdGF0aWMgdm9pZCBzZXRfbXNpX3NvdXJj
ZV9pZChzdHJ1Y3QgcGNpX2RldiAqcGRldiwgc3RydWN0IGlyZW1hcF9lbnRyeSAqaXJlKQogICAg
IGlmICggIXBkZXYgfHwgIWlyZSApCiAgICAgICAgIHJldHVybjsKIAotICAgIHNlZyA9IHBkZXYt
PnNlZzsKLSAgICBidXMgPSBwZGV2LT5idXM7Ci0gICAgZGV2Zm4gPSBwZGV2LT5kZXZmbjsKKyAg
ICBzZWcgPSBwZGV2LT5zYmRmLnNlZzsKKyAgICBidXMgPSBwZGV2LT5zYmRmLmJ1czsKKyAgICBk
ZXZmbiA9IHBkZXYtPnNiZGYuZXh0ZnVuYzsKICAgICBzd2l0Y2ggKCBwZGV2LT50eXBlICkKICAg
ICB7CiAgICAgICAgIHVuc2lnbmVkIGludCBzcTsKQEAgLTUxNyw3ICs1MTcsNyBAQCBzdGF0aWMg
dm9pZCBzZXRfbXNpX3NvdXJjZV9pZChzdHJ1Y3QgcGNpX2RldiAqcGRldiwgc3RydWN0IGlyZW1h
cF9lbnRyeSAqaXJlKQogICAgICAgICB7CiAgICAgICAgICAgICBpZiAoIHBkZXZfdHlwZShzZWcs
IGJ1cywgZGV2Zm4pID09IERFVl9UWVBFX1BDSWUyUENJX0JSSURHRSApCiAgICAgICAgICAgICAg
ICAgc2V0X2lyZV9zaWQoaXJlLCBTVlRfVkVSSUZZX0JVUywgU1FfQUxMXzE2LAotICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIChidXMgPDwgOCkgfCBwZGV2LT5idXMpOworICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIChidXMgPDwgOCkgfCBwZGV2LT5zYmRmLmJ1cyk7CiAgICAgICAgICAg
ICBlbHNlCiAgICAgICAgICAgICAgICAgc2V0X2lyZV9zaWQoaXJlLCBTVlRfVkVSSUZZX1NJRF9T
USwgU1FfQUxMXzE2LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9CREYyKGJ1cywg
ZGV2Zm4pKTsKZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9pb21tdS5j
IGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvdnRkL2lvbW11LmMKaW5kZXggN2I5ZTA5YTA4NC4u
N2I3MDczMjg2MyAxMDA2NDQKLS0tIGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvdnRkL2lvbW11
LmMKKysrIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvdnRkL2lvbW11LmMKQEAgLTE0ODQsNyAr
MTQ4NCw3IEBAIHN0YXRpYyBpbnQgZG9tYWluX2NvbnRleHRfbWFwcGluZyhzdHJ1Y3QgZG9tYWlu
ICpkb21haW4sIHU4IGRldmZuLAogewogICAgIHN0cnVjdCBhY3BpX2RyaGRfdW5pdCAqZHJoZDsK
ICAgICBpbnQgcmV0ID0gMDsKLSAgICB1OCBzZWcgPSBwZGV2LT5zZWcsIGJ1cyA9IHBkZXYtPmJ1
cywgc2VjYnVzOworICAgIHVpbnQ4X3Qgc2VnID0gcGRldi0+c2JkZi5zZWcsIGJ1cyA9IHBkZXYt
PnNiZGYuYnVzLCBzZWNidXM7CiAKICAgICBkcmhkID0gYWNwaV9maW5kX21hdGNoZWRfZHJoZF91
bml0KHBkZXYpOwogICAgIGlmICggIWRyaGQgKQpAQCAtMTUxNSw3ICsxNTE1LDcgQEAgc3RhdGlj
IGludCBkb21haW5fY29udGV4dF9tYXBwaW5nKHN0cnVjdCBkb21haW4gKmRvbWFpbiwgdTggZGV2
Zm4sCiAgICAgICAgICAgICAgICAgICAgUENJX1NMT1QoZGV2Zm4pLCBQQ0lfRlVOQyhkZXZmbikp
OwogICAgICAgICByZXQgPSBkb21haW5fY29udGV4dF9tYXBwaW5nX29uZShkb21haW4sIGRyaGQt
PmlvbW11LCBidXMsIGRldmZuLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBwZGV2KTsKLSAgICAgICAgaWYgKCAhcmV0ICYmIGRldmZuID09IHBkZXYtPmRldmZuICYm
IGF0c19kZXZpY2UocGRldiwgZHJoZCkgPiAwICkKKyAgICAgICAgaWYgKCAhcmV0ICYmIGRldmZu
ID09IHBkZXYtPnNiZGYuZXh0ZnVuYyAmJiBhdHNfZGV2aWNlKHBkZXYsIGRyaGQpID4gMCApCiAg
ICAgICAgICAgICBlbmFibGVfYXRzX2RldmljZShwZGV2LCAmZHJoZC0+aW9tbXUtPmF0c19kZXZp
Y2VzKTsKIAogICAgICAgICBicmVhazsKQEAgLTE1NDMsNyArMTU0Myw3IEBAIHN0YXRpYyBpbnQg
ZG9tYWluX2NvbnRleHRfbWFwcGluZyhzdHJ1Y3QgZG9tYWluICpkb21haW4sIHU4IGRldmZuLAog
ICAgICAgICAgKiBiZWhpbmQgdGhlIGJyaWRnZS4gTWFwIHRoYXQgaWQgYXMgd2VsbCBpZiB3ZSBk
aWRuJ3QgYWxyZWFkeS4KICAgICAgICAgICovCiAgICAgICAgIGlmICggIXJldCAmJiBwZGV2X3R5
cGUoc2VnLCBidXMsIGRldmZuKSA9PSBERVZfVFlQRV9QQ0llMlBDSV9CUklER0UgJiYKLSAgICAg
ICAgICAgICAoc2VjYnVzICE9IHBkZXYtPmJ1cyB8fCBwZGV2LT5kZXZmbiAhPSAwKSApCisgICAg
ICAgICAgICAgKHNlY2J1cyAhPSBwZGV2LT5zYmRmLmJ1cyB8fCBwZGV2LT5zYmRmLmV4dGZ1bmMg
IT0gMCkgKQogICAgICAgICAgICAgcmV0ID0gZG9tYWluX2NvbnRleHRfbWFwcGluZ19vbmUoZG9t
YWluLCBkcmhkLT5pb21tdSwgc2VjYnVzLCAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgcGNpX2dldF9wZGV2KHNlZywgc2VjYnVzLCAwKSk7CiAKQEAgLTE1
NTcsNyArMTU1Nyw3IEBAIHN0YXRpYyBpbnQgZG9tYWluX2NvbnRleHRfbWFwcGluZyhzdHJ1Y3Qg
ZG9tYWluICpkb21haW4sIHU4IGRldmZuLAogICAgICAgICBicmVhazsKICAgICB9CiAKLSAgICBp
ZiAoICFyZXQgJiYgZGV2Zm4gPT0gcGRldi0+ZGV2Zm4gKQorICAgIGlmICggIXJldCAmJiBkZXZm
biA9PSBwZGV2LT5zYmRmLmV4dGZ1bmMgKQogICAgICAgICBwY2lfdnRkX3F1aXJrKHBkZXYpOwog
CiAgICAgcmV0dXJuIHJldDsKQEAgLTE2MzUsNyArMTYzNSw4IEBAIHN0YXRpYyBpbnQgZG9tYWlu
X2NvbnRleHRfdW5tYXAoc3RydWN0IGRvbWFpbiAqZG9tYWluLCB1OCBkZXZmbiwKICAgICBzdHJ1
Y3QgYWNwaV9kcmhkX3VuaXQgKmRyaGQ7CiAgICAgc3RydWN0IGlvbW11ICppb21tdTsKICAgICBp
bnQgcmV0ID0gMDsKLSAgICB1OCBzZWcgPSBwZGV2LT5zZWcsIGJ1cyA9IHBkZXYtPmJ1cywgdG1w
X2J1cywgdG1wX2RldmZuLCBzZWNidXM7CisgICAgdWludDhfdCBzZWcgPSBwZGV2LT5zYmRmLnNl
ZywgYnVzID0gcGRldi0+c2JkZi5idXMsIHRtcF9idXMsIHRtcF9kZXZmbiwKKyAgICAgICAgICAg
IHNlY2J1czsKICAgICBpbnQgZm91bmQgPSAwOwogCiAgICAgZHJoZCA9IGFjcGlfZmluZF9tYXRj
aGVkX2RyaGRfdW5pdChwZGV2KTsKQEAgLTE2NjUsNyArMTY2Niw3IEBAIHN0YXRpYyBpbnQgZG9t
YWluX2NvbnRleHRfdW5tYXAoc3RydWN0IGRvbWFpbiAqZG9tYWluLCB1OCBkZXZmbiwKICAgICAg
ICAgICAgICAgICAgICBkb21haW4tPmRvbWFpbl9pZCwgc2VnLCBidXMsCiAgICAgICAgICAgICAg
ICAgICAgUENJX1NMT1QoZGV2Zm4pLCBQQ0lfRlVOQyhkZXZmbikpOwogICAgICAgICByZXQgPSBk
b21haW5fY29udGV4dF91bm1hcF9vbmUoZG9tYWluLCBpb21tdSwgYnVzLCBkZXZmbik7Ci0gICAg
ICAgIGlmICggIXJldCAmJiBkZXZmbiA9PSBwZGV2LT5kZXZmbiAmJiBhdHNfZGV2aWNlKHBkZXYs
IGRyaGQpID4gMCApCisgICAgICAgIGlmICggIXJldCAmJiBkZXZmbiA9PSBwZGV2LT5zYmRmLmV4
dGZ1bmMgJiYgYXRzX2RldmljZShwZGV2LCBkcmhkKSA+IDAgKQogICAgICAgICAgICAgZGlzYWJs
ZV9hdHNfZGV2aWNlKHBkZXYpOwogCiAgICAgICAgIGJyZWFrOwpAQCAtMTcxMSw3ICsxNzEyLDgg
QEAgc3RhdGljIGludCBkb21haW5fY29udGV4dF91bm1hcChzdHJ1Y3QgZG9tYWluICpkb21haW4s
IHU4IGRldmZuLAogICAgICAqLwogICAgIGZvcl9lYWNoX3BkZXYgKCBkb21haW4sIHBkZXYgKQog
ICAgIHsKLSAgICAgICAgaWYgKCBwZGV2LT5zZWcgPT0gc2VnICYmIHBkZXYtPmJ1cyA9PSBidXMg
JiYgcGRldi0+ZGV2Zm4gPT0gZGV2Zm4gKQorICAgICAgICBpZiAoIHBkZXYtPnNiZGYuc2VnID09
IHNlZyAmJiBwZGV2LT5zYmRmLmJ1cyA9PSBidXMgJiYKKyAgICAgICAgICAgICBwZGV2LT5zYmRm
LmV4dGZ1bmMgPT0gZGV2Zm4gKQogICAgICAgICAgICAgY29udGludWU7CiAKICAgICAgICAgZHJo
ZCA9IGFjcGlfZmluZF9tYXRjaGVkX2RyaGRfdW5pdChwZGV2KTsKQEAgLTIwNTAsOCArMjA1Miw4
IEBAIHN0YXRpYyBpbnQgaW50ZWxfaW9tbXVfYWRkX2RldmljZSh1OCBkZXZmbiwgc3RydWN0IHBj
aV9kZXYgKnBkZXYpCiAKICAgICBmb3JfZWFjaF9ybXJyX2RldmljZSAoIHJtcnIsIGJkZiwgaSAp
CiAgICAgewotICAgICAgICBpZiAoIHJtcnItPnNlZ21lbnQgPT0gcGRldi0+c2VnICYmCi0gICAg
ICAgICAgICAgUENJX0JVUyhiZGYpID09IHBkZXYtPmJ1cyAmJgorICAgICAgICBpZiAoIHJtcnIt
PnNlZ21lbnQgPT0gcGRldi0+c2JkZi5zZWcgJiYKKyAgICAgICAgICAgICBQQ0lfQlVTKGJkZikg
PT0gcGRldi0+c2JkZi5idXMgJiYKICAgICAgICAgICAgICBQQ0lfREVWRk4yKGJkZikgPT0gZGV2
Zm4gKQogICAgICAgICB7CiAgICAgICAgICAgICAvKgpAQCAtMjA5Niw4ICsyMDk4LDggQEAgc3Rh
dGljIGludCBpbnRlbF9pb21tdV9yZW1vdmVfZGV2aWNlKHU4IGRldmZuLCBzdHJ1Y3QgcGNpX2Rl
diAqcGRldikKIAogICAgIGZvcl9lYWNoX3JtcnJfZGV2aWNlICggcm1yciwgYmRmLCBpICkKICAg
ICB7Ci0gICAgICAgIGlmICggcm1yci0+c2VnbWVudCAhPSBwZGV2LT5zZWcgfHwKLSAgICAgICAg
ICAgICBQQ0lfQlVTKGJkZikgIT0gcGRldi0+YnVzIHx8CisgICAgICAgIGlmICggcm1yci0+c2Vn
bWVudCAhPSBwZGV2LT5zYmRmLnNlZyB8fAorICAgICAgICAgICAgIFBDSV9CVVMoYmRmKSAhPSBw
ZGV2LT5zYmRmLmJ1cyB8fAogICAgICAgICAgICAgIFBDSV9ERVZGTjIoYmRmKSAhPSBkZXZmbiAp
CiAgICAgICAgICAgICBjb250aW51ZTsKIApAQCAtMjQyMSw4ICsyNDIzLDggQEAgc3RhdGljIGlu
dCByZWFzc2lnbl9kZXZpY2Vfb3duZXJzaGlwKAogICAgICAgICB1bnNpZ25lZCBpbnQgaTsKIAog
ICAgICAgICBmb3JfZWFjaF9ybXJyX2RldmljZSggcm1yciwgYmRmLCBpICkKLSAgICAgICAgICAg
IGlmICggcm1yci0+c2VnbWVudCA9PSBwZGV2LT5zZWcgJiYKLSAgICAgICAgICAgICAgICAgUENJ
X0JVUyhiZGYpID09IHBkZXYtPmJ1cyAmJgorICAgICAgICAgICAgaWYgKCBybXJyLT5zZWdtZW50
ID09IHBkZXYtPnNiZGYuc2VnICYmCisgICAgICAgICAgICAgICAgIFBDSV9CVVMoYmRmKSA9PSBw
ZGV2LT5zYmRmLmJ1cyAmJgogICAgICAgICAgICAgICAgICBQQ0lfREVWRk4yKGJkZikgPT0gZGV2
Zm4gKQogICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIC8qCkBAIC0yNDUxLDcgKzI0NTMs
NyBAQCBzdGF0aWMgaW50IHJlYXNzaWduX2RldmljZV9vd25lcnNoaXAoCiAgICAgICAgIHJldHVy
biByZXQ7CiAgICAgfQogCi0gICAgaWYgKCBkZXZmbiA9PSBwZGV2LT5kZXZmbiApCisgICAgaWYg
KCBkZXZmbiA9PSBwZGV2LT5zYmRmLmV4dGZ1bmMgKQogICAgIHsKICAgICAgICAgbGlzdF9tb3Zl
KCZwZGV2LT5kb21haW5fbGlzdCwgJnRhcmdldC0+YXJjaC5wZGV2X2xpc3QpOwogICAgICAgICBw
ZGV2LT5kb21haW4gPSB0YXJnZXQ7CkBAIC0yNDc0LDggKzI0NzYsOCBAQCBzdGF0aWMgaW50IGlu
dGVsX2lvbW11X2Fzc2lnbl9kZXZpY2UoCiAgICAgaWYgKCBsaXN0X2VtcHR5KCZhY3BpX2RyaGRf
dW5pdHMpICkKICAgICAgICAgcmV0dXJuIC1FTk9ERVY7CiAKLSAgICBzZWcgPSBwZGV2LT5zZWc7
Ci0gICAgYnVzID0gcGRldi0+YnVzOworICAgIHNlZyA9IHBkZXYtPnNiZGYuc2VnOworICAgIGJ1
cyA9IHBkZXYtPnNiZGYuYnVzOwogICAgIC8qCiAgICAgICogSW4gcmFyZSBjYXNlcyBvbmUgZ2l2
ZW4gcm1yciBpcyBzaGFyZWQgYnkgbXVsdGlwbGUgZGV2aWNlcyBidXQKICAgICAgKiBvYnZpb3Vz
bHkgdGhpcyB3b3VsZCBwdXQgdGhlIHNlY3VyaXR5IG9mIGEgc3lzdGVtIGF0IHJpc2suIFNvCmRp
ZmYgLS1naXQgYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC92dGQvcWludmFsLmMgYi94ZW4vZHJp
dmVycy9wYXNzdGhyb3VnaC92dGQvcWludmFsLmMKaW5kZXggMDE0NDdjZjlhOC4uODAxNWQxNjUz
MSAxMDA2NDQKLS0tIGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvdnRkL3FpbnZhbC5jCisrKyBi
L3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9xaW52YWwuYwpAQCAtMjU3LDcgKzI1Nyw3IEBA
IGludCBxaW52YWxfZGV2aWNlX2lvdGxiX3N5bmMoc3RydWN0IGlvbW11ICppb21tdSwgc3RydWN0
IHBjaV9kZXYgKnBkZXYsCiAgICAgcWludmFsX2VudHJ5LT5xLmRldl9pb3RsYl9pbnZfZHNjLmxv
LnJlc18xID0gMDsKICAgICBxaW52YWxfZW50cnktPnEuZGV2X2lvdGxiX2ludl9kc2MubG8ubWF4
X2ludnNfcGVuZCA9IHBkZXYtPmF0cy5xdWV1ZV9kZXB0aDsKICAgICBxaW52YWxfZW50cnktPnEu
ZGV2X2lvdGxiX2ludl9kc2MubG8ucmVzXzIgPSAwOwotICAgIHFpbnZhbF9lbnRyeS0+cS5kZXZf
aW90bGJfaW52X2RzYy5sby5zaWQgPSBQQ0lfQkRGMihwZGV2LT5idXMsIHBkZXYtPmRldmZuKTsK
KyAgICBxaW52YWxfZW50cnktPnEuZGV2X2lvdGxiX2ludl9kc2MubG8uc2lkID0gcGRldi0+c2Jk
Zi5iZGY7CiAgICAgcWludmFsX2VudHJ5LT5xLmRldl9pb3RsYl9pbnZfZHNjLmxvLnJlc18zID0g
MDsKIAogICAgIHFpbnZhbF9lbnRyeS0+cS5kZXZfaW90bGJfaW52X2RzYy5oaS5zaXplID0gc2l6
ZTsKZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9xdWlya3MuYyBiL3hl
bi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9xdWlya3MuYwppbmRleCBkNmRiODYyNjc4Li5mYTgx
MTYwNWVlIDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC92dGQvcXVpcmtzLmMK
KysrIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvdnRkL3F1aXJrcy5jCkBAIC00MTMsMTAgKzQx
MywxMCBAQCBpbnQgbWVfd2lmaV9xdWlyayhzdHJ1Y3QgZG9tYWluICpkb21haW4sIHU4IGJ1cywg
dTggZGV2Zm4sIGludCBtYXApCiAKIHZvaWQgcGNpX3Z0ZF9xdWlyayhjb25zdCBzdHJ1Y3QgcGNp
X2RldiAqcGRldikKIHsKLSAgICBpbnQgc2VnID0gcGRldi0+c2VnOwotICAgIGludCBidXMgPSBw
ZGV2LT5idXM7Ci0gICAgaW50IGRldiA9IFBDSV9TTE9UKHBkZXYtPmRldmZuKTsKLSAgICBpbnQg
ZnVuYyA9IFBDSV9GVU5DKHBkZXYtPmRldmZuKTsKKyAgICBpbnQgc2VnID0gcGRldi0+c2JkZi5z
ZWc7CisgICAgaW50IGJ1cyA9IHBkZXYtPnNiZGYuYnVzOworICAgIGludCBkZXYgPSBwZGV2LT5z
YmRmLmRldjsKKyAgICBpbnQgZnVuYyA9IHBkZXYtPnNiZGYuZnVuYzsKICAgICBpbnQgcG9zOwog
ICAgIGJvb2xfdCBmZjsKICAgICB1MzIgdmFsLCB2YWwyOwpAQCAtNDU0LDExICs0NTQsMTEgQEAg
dm9pZCBwY2lfdnRkX3F1aXJrKGNvbnN0IHN0cnVjdCBwY2lfZGV2ICpwZGV2KQogICAgIC8qIFNh
bmR5YnJpZGdlLUVQIChSb21sZXkpICovCiAgICAgY2FzZSAweDNjMDA6IC8qIGhvc3QgYnJpZGdl
ICovCiAgICAgY2FzZSAweDNjMDEgLi4uIDB4M2MwYjogLyogcm9vdCBwb3J0cyAqLwotICAgICAg
ICBwb3MgPSBwY2lfZmluZF9leHRfY2FwYWJpbGl0eShzZWcsIGJ1cywgcGRldi0+ZGV2Zm4sCisg
ICAgICAgIHBvcyA9IHBjaV9maW5kX2V4dF9jYXBhYmlsaXR5KHNlZywgYnVzLCBwZGV2LT5zYmRm
LmV4dGZ1bmMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9FWFRf
Q0FQX0lEX0VSUik7CiAgICAgICAgIGlmICggIXBvcyApCiAgICAgICAgIHsKLSAgICAgICAgICAg
IHBvcyA9IHBjaV9maW5kX2V4dF9jYXBhYmlsaXR5KHNlZywgYnVzLCBwZGV2LT5kZXZmbiwKKyAg
ICAgICAgICAgIHBvcyA9IHBjaV9maW5kX2V4dF9jYXBhYmlsaXR5KHNlZywgYnVzLCBwZGV2LT5z
YmRmLmV4dGZ1bmMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQ
Q0lfRVhUX0NBUF9JRF9WTkRSKTsKICAgICAgICAgICAgIHdoaWxlICggcG9zICkKICAgICAgICAg
ICAgIHsKQEAgLTQ2OCw4ICs0NjgsOCBAQCB2b2lkIHBjaV92dGRfcXVpcmsoY29uc3Qgc3RydWN0
IHBjaV9kZXYgKnBkZXYpCiAgICAgICAgICAgICAgICAgICAgIHBvcyArPSBQQ0lfVk5EUl9IRUFE
RVI7CiAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgIH0KLSAgICAg
ICAgICAgICAgICBwb3MgPSBwY2lfZmluZF9uZXh0X2V4dF9jYXBhYmlsaXR5KHNlZywgYnVzLCBw
ZGV2LT5kZXZmbiwgcG9zLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgUENJX0VYVF9DQVBfSURfVk5EUik7CisgICAgICAgICAgICAgICAgcG9zID0g
cGNpX2ZpbmRfbmV4dF9leHRfY2FwYWJpbGl0eShzZWcsIGJ1cywgcGRldi0+c2JkZi5leHRmdW5j
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9z
LCBQQ0lfRVhUX0NBUF9JRF9WTkRSKTsKICAgICAgICAgICAgIH0KICAgICAgICAgICAgIGZmID0g
MDsKICAgICAgICAgfQpkaWZmIC0tZ2l0IGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvdnRkL3g4
Ni9hdHMuYyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC94ODYvYXRzLmMKaW5kZXggMWEz
YWRiNGFjYi4uZTA5MDRkZjViNiAxMDA2NDQKLS0tIGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gv
dnRkL3g4Ni9hdHMuYworKysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC92dGQveDg2L2F0cy5j
CkBAIC01Nyw4ICs1Nyw4IEBAIGludCBhdHNfZGV2aWNlKGNvbnN0IHN0cnVjdCBwY2lfZGV2ICpw
ZGV2LCBjb25zdCBzdHJ1Y3QgYWNwaV9kcmhkX3VuaXQgKmRyaGQpCiAgICAgICAgIHJldHVybiAw
OwogCiAgICAgYXRzX2RyaGQgPSBmaW5kX2F0c19kZXZfZHJoZChkcmhkLT5pb21tdSk7Ci0gICAg
cG9zID0gcGNpX2ZpbmRfZXh0X2NhcGFiaWxpdHkocGRldi0+c2VnLCBwZGV2LT5idXMsIHBkZXYt
PmRldmZuLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9FWFRfQ0FQX0lE
X0FUUyk7CisgICAgcG9zID0gcGNpX2ZpbmRfZXh0X2NhcGFiaWxpdHkocGRldi0+c2JkZi5zZWcs
IHBkZXYtPnNiZGYuYnVzLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBkZXYt
PnNiZGYuZXh0ZnVuYywgUENJX0VYVF9DQVBfSURfQVRTKTsKIAogICAgIGlmICggcG9zICYmIChh
dHNfZHJoZCA9PSBOVUxMKSApCiAgICAgewpAQCAtNzksMTkgKzc5LDE5IEBAIHN0YXRpYyBpbnQg
ZGV2aWNlX2luX2RvbWFpbihjb25zdCBzdHJ1Y3QgaW9tbXUgKmlvbW11LAogICAgIGludCB0dCwg
Zm91bmQgPSAwOwogCiAgICAgcm9vdF9lbnRyeSA9IChzdHJ1Y3Qgcm9vdF9lbnRyeSAqKSBtYXBf
dnRkX2RvbWFpbl9wYWdlKGlvbW11LT5yb290X21hZGRyKTsKLSAgICBpZiAoICFyb290X2VudHJ5
IHx8ICFyb290X3ByZXNlbnQocm9vdF9lbnRyeVtwZGV2LT5idXNdKSApCisgICAgaWYgKCAhcm9v
dF9lbnRyeSB8fCAhcm9vdF9wcmVzZW50KHJvb3RfZW50cnlbcGRldi0+c2JkZi5idXNdKSApCiAg
ICAgICAgIGdvdG8gb3V0OwogCiAgICAgY3R4dF9lbnRyeSA9IChzdHJ1Y3QgY29udGV4dF9lbnRy
eSAqKQotICAgICAgICAgICAgICAgICBtYXBfdnRkX2RvbWFpbl9wYWdlKHJvb3RfZW50cnlbcGRl
di0+YnVzXS52YWwpOworICAgICAgICAgICAgICAgICBtYXBfdnRkX2RvbWFpbl9wYWdlKHJvb3Rf
ZW50cnlbcGRldi0+c2JkZi5idXNdLnZhbCk7CiAKICAgICBpZiAoIGN0eHRfZW50cnkgPT0gTlVM
TCApCiAgICAgICAgIGdvdG8gb3V0OwogCi0gICAgaWYgKCBjb250ZXh0X2RvbWFpbl9pZChjdHh0
X2VudHJ5W3BkZXYtPmRldmZuXSkgIT0gZGlkICkKKyAgICBpZiAoIGNvbnRleHRfZG9tYWluX2lk
KGN0eHRfZW50cnlbcGRldi0+c2JkZi5leHRmdW5jXSkgIT0gZGlkICkKICAgICAgICAgZ290byBv
dXQ7CiAKLSAgICB0dCA9IGNvbnRleHRfdHJhbnNsYXRpb25fdHlwZShjdHh0X2VudHJ5W3BkZXYt
PmRldmZuXSk7CisgICAgdHQgPSBjb250ZXh0X3RyYW5zbGF0aW9uX3R5cGUoY3R4dF9lbnRyeVtw
ZGV2LT5zYmRmLmV4dGZ1bmNdKTsKICAgICBpZiAoIHR0ICE9IENPTlRFWFRfVFRfREVWX0lPVExC
ICkKICAgICAgICAgZ290byBvdXQ7CiAKZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJv
dWdoL3g4Ni9hdHMuYyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3g4Ni9hdHMuYwppbmRleCA1
OWMxNjM0NTlhLi5kZGFlYzcyZDE5IDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3Vn
aC94ODYvYXRzLmMKKysrIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gveDg2L2F0cy5jCkBAIC0y
Myw4ICsyMyw4IEBAIGJvb2xlYW5fcGFyYW0oImF0cyIsIGF0c19lbmFibGVkKTsKIGludCBlbmFi
bGVfYXRzX2RldmljZShzdHJ1Y3QgcGNpX2RldiAqcGRldiwgc3RydWN0IGxpc3RfaGVhZCAqYXRz
X2xpc3QpCiB7CiAgICAgdTMyIHZhbHVlOwotICAgIHUxNiBzZWcgPSBwZGV2LT5zZWc7Ci0gICAg
dTggYnVzID0gcGRldi0+YnVzLCBkZXZmbiA9IHBkZXYtPmRldmZuOworICAgIHVpbnQxNl90IHNl
ZyA9IHBkZXYtPnNiZGYuc2VnOworICAgIHVpbnQxNl90IGJ1cyA9IHBkZXYtPnNiZGYuYnVzLCBk
ZXZmbiA9IHBkZXYtPnNiZGYuZXh0ZnVuYzsKICAgICBpbnQgcG9zOwogCiAgICAgcG9zID0gcGNp
X2ZpbmRfZXh0X2NhcGFiaWxpdHkoc2VnLCBidXMsIGRldmZuLCBQQ0lfRVhUX0NBUF9JRF9BVFMp
OwpAQCAtNzYsOCArNzYsOCBAQCBpbnQgZW5hYmxlX2F0c19kZXZpY2Uoc3RydWN0IHBjaV9kZXYg
KnBkZXYsIHN0cnVjdCBsaXN0X2hlYWQgKmF0c19saXN0KQogdm9pZCBkaXNhYmxlX2F0c19kZXZp
Y2Uoc3RydWN0IHBjaV9kZXYgKnBkZXYpCiB7CiAgICAgdTMyIHZhbHVlOwotICAgIHUxNiBzZWcg
PSBwZGV2LT5zZWc7Ci0gICAgdTggYnVzID0gcGRldi0+YnVzLCBkZXZmbiA9IHBkZXYtPmRldmZu
OworICAgIHVpbnQxNl90IHNlZyA9IHBkZXYtPnNiZGYuc2VnOworICAgIHVpbnQ4X3QgYnVzID0g
cGRldi0+c2JkZi5idXMsIGRldmZuID0gcGRldi0+c2JkZi5leHRmdW5jOwogCiAgICAgQlVHX09O
KCFwZGV2LT5hdHMuY2FwX3Bvcyk7CiAKZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL3BjaS9wY2ku
YyBiL3hlbi9kcml2ZXJzL3BjaS9wY2kuYwppbmRleCAxYzgwOGQ2NjMyLi5hMzIyM2EyYjI5IDEw
MDY0NAotLS0gYS94ZW4vZHJpdmVycy9wY2kvcGNpLmMKKysrIGIveGVuL2RyaXZlcnMvcGNpL3Bj
aS5jCkBAIC0xMTcsMTAgKzExNywxMCBAQCBpbnQgcGNpX2ZpbmRfbmV4dF9leHRfY2FwYWJpbGl0
eShpbnQgc2VnLCBpbnQgYnVzLCBpbnQgZGV2Zm4sIGludCBzdGFydCwgaW50IGNhcAogCiB2b2lk
IHBjaV9pbnR4KGNvbnN0IHN0cnVjdCBwY2lfZGV2ICpwZGV2LCBib29sIGVuYWJsZSkKIHsKLSAg
ICB1aW50MTZfdCBzZWcgPSBwZGV2LT5zZWc7Ci0gICAgdWludDhfdCBidXMgPSBwZGV2LT5idXM7
Ci0gICAgdWludDhfdCBzbG90ID0gUENJX1NMT1QocGRldi0+ZGV2Zm4pOwotICAgIHVpbnQ4X3Qg
ZnVuYyA9IFBDSV9GVU5DKHBkZXYtPmRldmZuKTsKKyAgICB1aW50MTZfdCBzZWcgPSBwZGV2LT5z
YmRmLnNlZzsKKyAgICB1aW50OF90IGJ1cyA9IHBkZXYtPnNiZGYuYnVzOworICAgIHVpbnQ4X3Qg
c2xvdCA9IHBkZXYtPnNiZGYuZGV2OworICAgIHVpbnQ4X3QgZnVuYyA9IHBkZXYtPnNiZGYuZnVu
YzsKICAgICB1aW50MTZfdCBjbWQgPSBwY2lfY29uZl9yZWFkMTYoc2VnLCBidXMsIHNsb3QsIGZ1
bmMsIFBDSV9DT01NQU5EKTsKIAogICAgIGlmICggZW5hYmxlICkKZGlmZiAtLWdpdCBhL3hlbi9k
cml2ZXJzL3ZwY2kvaGVhZGVyLmMgYi94ZW4vZHJpdmVycy92cGNpL2hlYWRlci5jCmluZGV4IGVm
YjZjYTkwZTMuLjc0ZDcwYTQyNzggMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL3ZwY2kvaGVhZGVy
LmMKKysrIGIveGVuL2RyaXZlcnMvdnBjaS9oZWFkZXIuYwpAQCAtODUsNyArODUsNiBAQCBzdGF0
aWMgdm9pZCBtb2RpZnlfZGVjb2RpbmcoY29uc3Qgc3RydWN0IHBjaV9kZXYgKnBkZXYsIHVpbnQx
Nl90IGNtZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib29sIHJvbV9vbmx5KQogewog
ICAgIHN0cnVjdCB2cGNpX2hlYWRlciAqaGVhZGVyID0gJnBkZXYtPnZwY2ktPmhlYWRlcjsKLSAg
ICB1aW50OF90IHNsb3QgPSBQQ0lfU0xPVChwZGV2LT5kZXZmbiksIGZ1bmMgPSBQQ0lfRlVOQyhw
ZGV2LT5kZXZmbik7CiAgICAgYm9vbCBtYXAgPSBjbWQgJiBQQ0lfQ09NTUFORF9NRU1PUlk7CiAg
ICAgdW5zaWduZWQgaW50IGk7CiAKQEAgLTExMyw3ICsxMTIsOCBAQCBzdGF0aWMgdm9pZCBtb2Rp
ZnlfZGVjb2RpbmcoY29uc3Qgc3RydWN0IHBjaV9kZXYgKnBkZXYsIHVpbnQxNl90IGNtZCwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIChtYXAgPyBQQ0lfUk9NX0FERFJFU1NfRU5BQkxFIDog
MCk7CiAKICAgICAgICAgICAgIGhlYWRlci0+YmFyc1tpXS5lbmFibGVkID0gaGVhZGVyLT5yb21f
ZW5hYmxlZCA9IG1hcDsKLSAgICAgICAgICAgIHBjaV9jb25mX3dyaXRlMzIocGRldi0+c2VnLCBw
ZGV2LT5idXMsIHNsb3QsIGZ1bmMsIHJvbV9wb3MsIHZhbCk7CisgICAgICAgICAgICBwY2lfY29u
Zl93cml0ZTMyKHBkZXYtPnNiZGYuc2VnLCBwZGV2LT5zYmRmLmJ1cywgcGRldi0+c2JkZi5kZXYs
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBkZXYtPnNiZGYuZnVuYywgcm9tX3Bvcywg
dmFsKTsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgfQogCkBAIC0xMjMsOCArMTIzLDgg
QEAgc3RhdGljIHZvaWQgbW9kaWZ5X2RlY29kaW5nKGNvbnN0IHN0cnVjdCBwY2lfZGV2ICpwZGV2
LCB1aW50MTZfdCBjbWQsCiAgICAgfQogCiAgICAgaWYgKCAhcm9tX29ubHkgKQotICAgICAgICBw
Y2lfY29uZl93cml0ZTE2KHBkZXYtPnNlZywgcGRldi0+YnVzLCBzbG90LCBmdW5jLCBQQ0lfQ09N
TUFORCwKLSAgICAgICAgICAgICAgICAgICAgICAgICBjbWQpOworICAgICAgICBwY2lfY29uZl93
cml0ZTE2KHBkZXYtPnNiZGYuc2VnLCBwZGV2LT5zYmRmLmJ1cywgcGRldi0+c2JkZi5kZXYsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgcGRldi0+c2JkZi5mdW5jLCBQQ0lfQ09NTUFORCwgY21k
KTsKICAgICBlbHNlCiAgICAgICAgIEFTU0VSVF9VTlJFQUNIQUJMRSgpOwogfQpAQCAtMzM1LDgg
KzMzNSw4IEBAIHN0YXRpYyBpbnQgbW9kaWZ5X2JhcnMoY29uc3Qgc3RydWN0IHBjaV9kZXYgKnBk
ZXYsIHVpbnQxNl90IGNtZCwgYm9vbCByb21fb25seSkKIHN0YXRpYyB2b2lkIGNtZF93cml0ZShj
b25zdCBzdHJ1Y3QgcGNpX2RldiAqcGRldiwgdW5zaWduZWQgaW50IHJlZywKICAgICAgICAgICAg
ICAgICAgICAgICB1aW50MzJfdCBjbWQsIHZvaWQgKmRhdGEpCiB7Ci0gICAgdWludDhfdCBzbG90
ID0gUENJX1NMT1QocGRldi0+ZGV2Zm4pLCBmdW5jID0gUENJX0ZVTkMocGRldi0+ZGV2Zm4pOwot
ICAgIHVpbnQxNl90IGN1cnJlbnRfY21kID0gcGNpX2NvbmZfcmVhZDE2KHBkZXYtPnNlZywgcGRl
di0+YnVzLCBzbG90LCBmdW5jLAorICAgIHVpbnQxNl90IGN1cnJlbnRfY21kID0gcGNpX2NvbmZf
cmVhZDE2KHBkZXYtPnNiZGYuc2VnLCBwZGV2LT5zYmRmLmJ1cywKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBwZGV2LT5zYmRmLmRldiwgcGRldi0+c2JkZi5mdW5j
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZyk7CiAKICAg
ICAvKgpAQCAtMzUyLDE0ICszNTIsMTQgQEAgc3RhdGljIHZvaWQgY21kX3dyaXRlKGNvbnN0IHN0
cnVjdCBwY2lfZGV2ICpwZGV2LCB1bnNpZ25lZCBpbnQgcmVnLAogICAgICAgICAgKi8KICAgICAg
ICAgbW9kaWZ5X2JhcnMocGRldiwgY21kLCBmYWxzZSk7CiAgICAgZWxzZQotICAgICAgICBwY2lf
Y29uZl93cml0ZTE2KHBkZXYtPnNlZywgcGRldi0+YnVzLCBzbG90LCBmdW5jLCByZWcsIGNtZCk7
CisgICAgICAgIHBjaV9jb25mX3dyaXRlMTYocGRldi0+c2JkZi5zZWcsIHBkZXYtPnNiZGYuYnVz
LCBwZGV2LT5zYmRmLmRldiwKKyAgICAgICAgICAgICAgICAgICAgICAgICBwZGV2LT5zYmRmLmZ1
bmMsIHJlZywgY21kKTsKIH0KIAogc3RhdGljIHZvaWQgYmFyX3dyaXRlKGNvbnN0IHN0cnVjdCBw
Y2lfZGV2ICpwZGV2LCB1bnNpZ25lZCBpbnQgcmVnLAogICAgICAgICAgICAgICAgICAgICAgIHVp
bnQzMl90IHZhbCwgdm9pZCAqZGF0YSkKIHsKICAgICBzdHJ1Y3QgdnBjaV9iYXIgKmJhciA9IGRh
dGE7Ci0gICAgdWludDhfdCBzbG90ID0gUENJX1NMT1QocGRldi0+ZGV2Zm4pLCBmdW5jID0gUENJ
X0ZVTkMocGRldi0+ZGV2Zm4pOwogICAgIGJvb2wgaGkgPSBmYWxzZTsKIAogICAgIGlmICggYmFy
LT50eXBlID09IFZQQ0lfQkFSX01FTTY0X0hJICkKQEAgLTM3MSwxNSArMzcxLDE1IEBAIHN0YXRp
YyB2b2lkIGJhcl93cml0ZShjb25zdCBzdHJ1Y3QgcGNpX2RldiAqcGRldiwgdW5zaWduZWQgaW50
IHJlZywKICAgICBlbHNlCiAgICAgICAgIHZhbCAmPSBQQ0lfQkFTRV9BRERSRVNTX01FTV9NQVNL
OwogCi0gICAgaWYgKCBwY2lfY29uZl9yZWFkMTYocGRldi0+c2VnLCBwZGV2LT5idXMsIHNsb3Qs
IGZ1bmMsIFBDSV9DT01NQU5EKSAmCi0gICAgICAgICBQQ0lfQ09NTUFORF9NRU1PUlkgKQorICAg
IGlmICggcGNpX2NvbmZfcmVhZDE2KHBkZXYtPnNiZGYuc2VnLCBwZGV2LT5zYmRmLmJ1cywgcGRl
di0+c2JkZi5kZXYsCisgICAgICAgICAgICAgICAgICAgICAgICAgcGRldi0+c2JkZi5mdW5jLCBQ
Q0lfQ09NTUFORCkgJiBQQ0lfQ09NTUFORF9NRU1PUlkgKQogICAgIHsKICAgICAgICAgLyogSWYg
dGhlIHZhbHVlIHdyaXR0ZW4gaXMgdGhlIGN1cnJlbnQgb25lIGF2b2lkIHByaW50aW5nIGEgd2Fy
bmluZy4gKi8KICAgICAgICAgaWYgKCB2YWwgIT0gKHVpbnQzMl90KShiYXItPmFkZHIgPj4gKGhp
ID8gMzIgOiAwKSkgKQogICAgICAgICAgICAgZ3ByaW50ayhYRU5MT0dfV0FSTklORywKICAgICAg
ICAgICAgICAgICAgICAgIiUwNHg6JTAyeDolMDJ4LiV1OiBpZ25vcmVkIEJBUiAlbHUgd3JpdGUg
d2l0aCBtZW1vcnkgZGVjb2RpbmcgZW5hYmxlZFxuIiwKLSAgICAgICAgICAgICAgICAgICAgcGRl
di0+c2VnLCBwZGV2LT5idXMsIHNsb3QsIGZ1bmMsCi0gICAgICAgICAgICAgICAgICAgIGJhciAt
IHBkZXYtPnZwY2ktPmhlYWRlci5iYXJzICsgaGkpOworICAgICAgICAgICAgICAgICAgICBwZGV2
LT5zYmRmLnNlZywgcGRldi0+c2JkZi5idXMsIHBkZXYtPnNiZGYuZGV2LAorICAgICAgICAgICAg
ICAgICAgICBwZGV2LT5zYmRmLmZ1bmMsIGJhciAtIHBkZXYtPnZwY2ktPmhlYWRlci5iYXJzICsg
aGkpOwogICAgICAgICByZXR1cm47CiAgICAgfQogCkBAIC0zOTksOCArMzk5LDggQEAgc3RhdGlj
IHZvaWQgYmFyX3dyaXRlKGNvbnN0IHN0cnVjdCBwY2lfZGV2ICpwZGV2LCB1bnNpZ25lZCBpbnQg
cmVnLAogICAgICAgICB2YWwgfD0gYmFyLT5wcmVmZXRjaGFibGUgPyBQQ0lfQkFTRV9BRERSRVNT
X01FTV9QUkVGRVRDSCA6IDA7CiAgICAgfQogCi0gICAgcGNpX2NvbmZfd3JpdGUzMihwZGV2LT5z
ZWcsIHBkZXYtPmJ1cywgUENJX1NMT1QocGRldi0+ZGV2Zm4pLAotICAgICAgICAgICAgICAgICAg
ICAgUENJX0ZVTkMocGRldi0+ZGV2Zm4pLCByZWcsIHZhbCk7CisgICAgcGNpX2NvbmZfd3JpdGUz
MihwZGV2LT5zYmRmLnNlZywgcGRldi0+c2JkZi5idXMsIHBkZXYtPnNiZGYuZGV2LAorICAgICAg
ICAgICAgICAgICAgICAgcGRldi0+c2JkZi5mdW5jLCByZWcsIHZhbCk7CiB9CiAKIHN0YXRpYyB2
b2lkIHJvbV93cml0ZShjb25zdCBzdHJ1Y3QgcGNpX2RldiAqcGRldiwgdW5zaWduZWQgaW50IHJl
ZywKQEAgLTQwOCw4ICs0MDgsOCBAQCBzdGF0aWMgdm9pZCByb21fd3JpdGUoY29uc3Qgc3RydWN0
IHBjaV9kZXYgKnBkZXYsIHVuc2lnbmVkIGludCByZWcsCiB7CiAgICAgc3RydWN0IHZwY2lfaGVh
ZGVyICpoZWFkZXIgPSAmcGRldi0+dnBjaS0+aGVhZGVyOwogICAgIHN0cnVjdCB2cGNpX2JhciAq
cm9tID0gZGF0YTsKLSAgICB1aW50OF90IHNsb3QgPSBQQ0lfU0xPVChwZGV2LT5kZXZmbiksIGZ1
bmMgPSBQQ0lfRlVOQyhwZGV2LT5kZXZmbik7Ci0gICAgdWludDE2X3QgY21kID0gcGNpX2NvbmZf
cmVhZDE2KHBkZXYtPnNlZywgcGRldi0+YnVzLCBzbG90LCBmdW5jLAorICAgIHVpbnQxNl90IGNt
ZCA9IHBjaV9jb25mX3JlYWQxNihwZGV2LT5zYmRmLnNlZywgcGRldi0+c2JkZi5idXMsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBkZXYtPnNiZGYuZGV2LCBwZGV2LT5zYmRm
LmZ1bmMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9DT01NQU5EKTsK
ICAgICBib29sIG5ld19lbmFibGVkID0gdmFsICYgUENJX1JPTV9BRERSRVNTX0VOQUJMRTsKIApA
QCAtNDE3LDcgKzQxNyw4IEBAIHN0YXRpYyB2b2lkIHJvbV93cml0ZShjb25zdCBzdHJ1Y3QgcGNp
X2RldiAqcGRldiwgdW5zaWduZWQgaW50IHJlZywKICAgICB7CiAgICAgICAgIGdwcmludGsoWEVO
TE9HX1dBUk5JTkcsCiAgICAgICAgICAgICAgICAgIiUwNHg6JTAyeDolMDJ4LiV1OiBpZ25vcmVk
IFJPTSBCQVIgd3JpdGUgd2l0aCBtZW1vcnkgZGVjb2RpbmcgZW5hYmxlZFxuIiwKLSAgICAgICAg
ICAgICAgICBwZGV2LT5zZWcsIHBkZXYtPmJ1cywgc2xvdCwgZnVuYyk7CisgICAgICAgICAgICAg
ICAgcGRldi0+c2JkZi5zZWcsIHBkZXYtPnNiZGYuYnVzLCBwZGV2LT5zYmRmLmRldiwKKyAgICAg
ICAgICAgICAgICBwZGV2LT5zYmRmLmZ1bmMpOwogICAgICAgICByZXR1cm47CiAgICAgfQogCkBA
IC00MzIsNyArNDMzLDggQEAgc3RhdGljIHZvaWQgcm9tX3dyaXRlKGNvbnN0IHN0cnVjdCBwY2lf
ZGV2ICpwZGV2LCB1bnNpZ25lZCBpbnQgcmVnLAogICAgIHsKICAgICAgICAgLyogSnVzdCB1cGRh
dGUgdGhlIFJPTSBCQVIgZmllbGQuICovCiAgICAgICAgIGhlYWRlci0+cm9tX2VuYWJsZWQgPSBu
ZXdfZW5hYmxlZDsKLSAgICAgICAgcGNpX2NvbmZfd3JpdGUzMihwZGV2LT5zZWcsIHBkZXYtPmJ1
cywgc2xvdCwgZnVuYywgcmVnLCB2YWwpOworICAgICAgICBwY2lfY29uZl93cml0ZTMyKHBkZXYt
PnNiZGYuc2VnLCBwZGV2LT5zYmRmLmJ1cywgcGRldi0+c2JkZi5kZXYsCisgICAgICAgICAgICAg
ICAgICAgICAgICAgcGRldi0+c2JkZi5mdW5jLCByZWcsIHZhbCk7CiAgICAgfQogICAgIC8qCiAg
ICAgICogUGFzcyBQQ0lfQ09NTUFORF9NRU1PUlkgb3IgMCB0byBzaWduYWwgYSBtYXAvdW5tYXAg
cmVxdWVzdCwgbm90ZSB0aGF0CkBAIC00NTUsMTkgKzQ1NywxNSBAQCBzdGF0aWMgdm9pZCByb21f
d3JpdGUoY29uc3Qgc3RydWN0IHBjaV9kZXYgKnBkZXYsIHVuc2lnbmVkIGludCByZWcsCiAKIHN0
YXRpYyBpbnQgaW5pdF9iYXJzKHN0cnVjdCBwY2lfZGV2ICpwZGV2KQogewotICAgIHVpbnQ4X3Qg
c2xvdCA9IFBDSV9TTE9UKHBkZXYtPmRldmZuKSwgZnVuYyA9IFBDSV9GVU5DKHBkZXYtPmRldmZu
KTsKICAgICB1aW50MTZfdCBjbWQ7CiAgICAgdWludDY0X3QgYWRkciwgc2l6ZTsKICAgICB1bnNp
Z25lZCBpbnQgaSwgbnVtX2JhcnMsIHJvbV9yZWc7CiAgICAgc3RydWN0IHZwY2lfaGVhZGVyICpo
ZWFkZXIgPSAmcGRldi0+dnBjaS0+aGVhZGVyOwogICAgIHN0cnVjdCB2cGNpX2JhciAqYmFycyA9
IGhlYWRlci0+YmFyczsKLSAgICBwY2lfc2JkZl90IHNiZGYgPSB7Ci0gICAgICAgIC5zYmRmID0g
UENJX1NCREYzKHBkZXYtPnNlZywgcGRldi0+YnVzLCBwZGV2LT5kZXZmbiksCi0gICAgfTsKICAg
ICBpbnQgcmM7CiAKLSAgICBzd2l0Y2ggKCBwY2lfY29uZl9yZWFkOChwZGV2LT5zZWcsIHBkZXYt
PmJ1cywgc2xvdCwgZnVuYywgUENJX0hFQURFUl9UWVBFKQotICAgICAgICAgICAgICYgMHg3ZiAp
CisgICAgc3dpdGNoICggcGNpX2NvbmZfcmVhZDgocGRldi0+c2JkZi5zZWcsIHBkZXYtPnNiZGYu
YnVzLCBwZGV2LT5zYmRmLmRldiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZGV2LT5z
YmRmLmZ1bmMsIFBDSV9IRUFERVJfVFlQRSkgJiAweDdmICkKICAgICB7CiAgICAgY2FzZSBQQ0lf
SEVBREVSX1RZUEVfTk9STUFMOgogICAgICAgICBudW1fYmFycyA9IFBDSV9IRUFERVJfTk9STUFM
X05SX0JBUlM7CkBAIC00OTMsOSArNDkxLDExIEBAIHN0YXRpYyBpbnQgaW5pdF9iYXJzKHN0cnVj
dCBwY2lfZGV2ICpwZGV2KQogICAgICAgICByZXR1cm4gMDsKIAogICAgIC8qIERpc2FibGUgbWVt
b3J5IGRlY29kaW5nIGJlZm9yZSBzaXppbmcuICovCi0gICAgY21kID0gcGNpX2NvbmZfcmVhZDE2
KHBkZXYtPnNlZywgcGRldi0+YnVzLCBzbG90LCBmdW5jLCBQQ0lfQ09NTUFORCk7CisgICAgY21k
ID0gcGNpX2NvbmZfcmVhZDE2KHBkZXYtPnNiZGYuc2VnLCBwZGV2LT5zYmRmLmJ1cywgcGRldi0+
c2JkZi5kZXYsCisgICAgICAgICAgICAgICAgICAgICAgICAgIHBkZXYtPnNiZGYuZnVuYywgUENJ
X0NPTU1BTkQpOwogICAgIGlmICggY21kICYgUENJX0NPTU1BTkRfTUVNT1JZICkKLSAgICAgICAg
cGNpX2NvbmZfd3JpdGUxNihwZGV2LT5zZWcsIHBkZXYtPmJ1cywgc2xvdCwgZnVuYywgUENJX0NP
TU1BTkQsCisgICAgICAgIHBjaV9jb25mX3dyaXRlMTYocGRldi0+c2JkZi5zZWcsIHBkZXYtPnNi
ZGYuYnVzLCBwZGV2LT5zYmRmLmRldiwKKyAgICAgICAgICAgICAgICAgICAgICAgICBwZGV2LT5z
YmRmLmZ1bmMsIFBDSV9DT01NQU5ELAogICAgICAgICAgICAgICAgICAgICAgICAgIGNtZCAmIH5Q
Q0lfQ09NTUFORF9NRU1PUlkpOwogCiAgICAgZm9yICggaSA9IDA7IGkgPCBudW1fYmFyczsgaSsr
ICkKQEAgLTUxMCwxNSArNTEwLDE2IEBAIHN0YXRpYyBpbnQgaW5pdF9iYXJzKHN0cnVjdCBwY2lf
ZGV2ICpwZGV2KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA0LCAmYmFyc1tp
XSk7CiAgICAgICAgICAgICBpZiAoIHJjICkKICAgICAgICAgICAgIHsKLSAgICAgICAgICAgICAg
ICBwY2lfY29uZl93cml0ZTE2KHBkZXYtPnNlZywgcGRldi0+YnVzLCBzbG90LCBmdW5jLAotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX0NPTU1BTkQsIGNtZCk7CisgICAgICAg
ICAgICAgICAgcGNpX2NvbmZfd3JpdGUxNihwZGV2LT5zYmRmLnNlZywgcGRldi0+c2JkZi5idXMs
IHBkZXYtPnNiZGYuZGV2LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGRldi0+
c2JkZi5mdW5jLCBQQ0lfQ09NTUFORCwgY21kKTsKICAgICAgICAgICAgICAgICByZXR1cm4gcmM7
CiAgICAgICAgICAgICB9CiAKICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICB9CiAKLSAg
ICAgICAgdmFsID0gcGNpX2NvbmZfcmVhZDMyKHBkZXYtPnNlZywgcGRldi0+YnVzLCBzbG90LCBm
dW5jLCByZWcpOworICAgICAgICB2YWwgPSBwY2lfY29uZl9yZWFkMzIocGRldi0+c2JkZi5zZWcs
IHBkZXYtPnNiZGYuYnVzLCBwZGV2LT5zYmRmLmRldiwKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHBkZXYtPnNiZGYuZnVuYywgcmVnKTsKICAgICAgICAgaWYgKCAodmFsICYgUENJX0JB
U0VfQUREUkVTU19TUEFDRSkgPT0gUENJX0JBU0VfQUREUkVTU19TUEFDRV9JTyApCiAgICAgICAg
IHsKICAgICAgICAgICAgIGJhcnNbaV0udHlwZSA9IFZQQ0lfQkFSX0lPOwpAQCAtNTMwLDEyICs1
MzEsMTIgQEAgc3RhdGljIGludCBpbml0X2JhcnMoc3RydWN0IHBjaV9kZXYgKnBkZXYpCiAgICAg
ICAgIGVsc2UKICAgICAgICAgICAgIGJhcnNbaV0udHlwZSA9IFZQQ0lfQkFSX01FTTMyOwogCi0g
ICAgICAgIHJjID0gcGNpX3NpemVfbWVtX2JhcihzYmRmLCByZWcsICZhZGRyLCAmc2l6ZSwKKyAg
ICAgICAgcmMgPSBwY2lfc2l6ZV9tZW1fYmFyKHBkZXYtPnNiZGYsIHJlZywgJmFkZHIsICZzaXpl
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGkgPT0gbnVtX2JhcnMgLSAxKSA/IFBD
SV9CQVJfTEFTVCA6IDApOwogICAgICAgICBpZiAoIHJjIDwgMCApCiAgICAgICAgIHsKLSAgICAg
ICAgICAgIHBjaV9jb25mX3dyaXRlMTYocGRldi0+c2VnLCBwZGV2LT5idXMsIHNsb3QsIGZ1bmMs
IFBDSV9DT01NQU5ELAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbWQpOworICAgICAg
ICAgICAgcGNpX2NvbmZfd3JpdGUxNihwZGV2LT5zYmRmLnNlZywgcGRldi0+c2JkZi5idXMsIHBk
ZXYtPnNiZGYuZGV2LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZGV2LT5zYmRmLmZ1
bmMsIFBDSV9DT01NQU5ELCBjbWQpOwogICAgICAgICAgICAgcmV0dXJuIHJjOwogICAgICAgICB9
CiAKQEAgLTU1MywxNCArNTU0LDE0IEBAIHN0YXRpYyBpbnQgaW5pdF9iYXJzKHN0cnVjdCBwY2lf
ZGV2ICpwZGV2KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZiYXJzW2ldKTsKICAg
ICAgICAgaWYgKCByYyApCiAgICAgICAgIHsKLSAgICAgICAgICAgIHBjaV9jb25mX3dyaXRlMTYo
cGRldi0+c2VnLCBwZGV2LT5idXMsIHNsb3QsIGZ1bmMsIFBDSV9DT01NQU5ELAotICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBjbWQpOworICAgICAgICAgICAgcGNpX2NvbmZfd3JpdGUxNihw
ZGV2LT5zYmRmLnNlZywgcGRldi0+c2JkZi5idXMsIHBkZXYtPnNiZGYuZGV2LAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBwZGV2LT5zYmRmLmZ1bmMsIFBDSV9DT01NQU5ELCBjbWQpOwog
ICAgICAgICAgICAgcmV0dXJuIHJjOwogICAgICAgICB9CiAgICAgfQogCiAgICAgLyogQ2hlY2sg
ZXhwYW5zaW9uIFJPTS4gKi8KLSAgICByYyA9IHBjaV9zaXplX21lbV9iYXIoc2JkZiwgcm9tX3Jl
ZywgJmFkZHIsICZzaXplLCBQQ0lfQkFSX1JPTSk7CisgICAgcmMgPSBwY2lfc2l6ZV9tZW1fYmFy
KHBkZXYtPnNiZGYsIHJvbV9yZWcsICZhZGRyLCAmc2l6ZSwgUENJX0JBUl9ST00pOwogICAgIGlm
ICggcmMgPiAwICYmIHNpemUgKQogICAgIHsKICAgICAgICAgc3RydWN0IHZwY2lfYmFyICpyb20g
PSAmaGVhZGVyLT5iYXJzW251bV9iYXJzXTsKQEAgLTU2OCw3ICs1NjksOCBAQCBzdGF0aWMgaW50
IGluaXRfYmFycyhzdHJ1Y3QgcGNpX2RldiAqcGRldikKICAgICAgICAgcm9tLT50eXBlID0gVlBD
SV9CQVJfUk9NOwogICAgICAgICByb20tPnNpemUgPSBzaXplOwogICAgICAgICByb20tPmFkZHIg
PSBhZGRyOwotICAgICAgICBoZWFkZXItPnJvbV9lbmFibGVkID0gcGNpX2NvbmZfcmVhZDMyKHBk
ZXYtPnNlZywgcGRldi0+YnVzLCBzbG90LCBmdW5jLAorICAgICAgICBoZWFkZXItPnJvbV9lbmFi
bGVkID0gcGNpX2NvbmZfcmVhZDMyKHBkZXYtPnNiZGYuc2VnLCBwZGV2LT5zYmRmLmJ1cywKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZGV2LT5zYmRmLmRl
diwgcGRldi0+c2JkZi5mdW5jLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHJvbV9yZWcpICYgUENJX1JPTV9BRERSRVNTX0VOQUJMRTsKIAogICAgICAgICBy
YyA9IHZwY2lfYWRkX3JlZ2lzdGVyKHBkZXYtPnZwY2ksIHZwY2lfaHdfcmVhZDMyLCByb21fd3Jp
dGUsIHJvbV9yZWcsCmRpZmYgLS1naXQgYS94ZW4vZHJpdmVycy92cGNpL21zaS5jIGIveGVuL2Ry
aXZlcnMvdnBjaS9tc2kuYwppbmRleCA4ZjE1YWQ3YmYyLi5kZmM4OTRkY2M2IDEwMDY0NAotLS0g
YS94ZW4vZHJpdmVycy92cGNpL21zaS5jCisrKyBiL3hlbi9kcml2ZXJzL3ZwY2kvbXNpLmMKQEAg
LTc3LDkgKzc3LDggQEAgc3RhdGljIHZvaWQgY29udHJvbF93cml0ZShjb25zdCBzdHJ1Y3QgcGNp
X2RldiAqcGRldiwgdW5zaWduZWQgaW50IHJlZywKICAgICBtc2ktPnZlY3RvcnMgPSB2ZWN0b3Jz
OwogICAgIG1zaS0+ZW5hYmxlZCA9IG5ld19lbmFibGVkOwogCi0gICAgcGNpX2NvbmZfd3JpdGUx
NihwZGV2LT5zZWcsIHBkZXYtPmJ1cywgUENJX1NMT1QocGRldi0+ZGV2Zm4pLAotICAgICAgICAg
ICAgICAgICAgICAgUENJX0ZVTkMocGRldi0+ZGV2Zm4pLCByZWcsCi0gICAgICAgICAgICAgICAg
ICAgICBjb250cm9sX3JlYWQocGRldiwgcmVnLCBkYXRhKSk7CisgICAgcGNpX2NvbmZfd3JpdGUx
NihwZGV2LT5zYmRmLnNlZywgcGRldi0+c2JkZi5idXMsIHBkZXYtPnNiZGYuZGV2LAorICAgICAg
ICAgICAgICAgICAgICAgcGRldi0+c2JkZi5mdW5jLCByZWcsIGNvbnRyb2xfcmVhZChwZGV2LCBy
ZWcsIGRhdGEpKTsKIH0KIAogc3RhdGljIHZvaWQgdXBkYXRlX21zaShjb25zdCBzdHJ1Y3QgcGNp
X2RldiAqcGRldiwgc3RydWN0IHZwY2lfbXNpICptc2kpCkBAIC0xODcsOCArMTg2LDggQEAgc3Rh
dGljIHZvaWQgbWFza193cml0ZShjb25zdCBzdHJ1Y3QgcGNpX2RldiAqcGRldiwgdW5zaWduZWQg
aW50IHJlZywKIAogc3RhdGljIGludCBpbml0X21zaShzdHJ1Y3QgcGNpX2RldiAqcGRldikKIHsK
LSAgICB1aW50OF90IHNsb3QgPSBQQ0lfU0xPVChwZGV2LT5kZXZmbiksIGZ1bmMgPSBQQ0lfRlVO
QyhwZGV2LT5kZXZmbik7Ci0gICAgdW5zaWduZWQgaW50IHBvcyA9IHBjaV9maW5kX2NhcF9vZmZz
ZXQocGRldi0+c2VnLCBwZGV2LT5idXMsIHNsb3QsIGZ1bmMsCisgICAgdW5zaWduZWQgaW50IHBv
cyA9IHBjaV9maW5kX2NhcF9vZmZzZXQocGRldi0+c2JkZi5zZWcsIHBkZXYtPnNiZGYuYnVzLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBkZXYtPnNiZGYuZGV2
LCBwZGV2LT5zYmRmLmZ1bmMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgUENJX0NBUF9JRF9NU0kpOwogICAgIHVpbnQxNl90IGNvbnRyb2w7CiAgICAgaW50IHJl
dDsKQEAgLTIxMSw4ICsyMTAsOCBAQCBzdGF0aWMgaW50IGluaXRfbXNpKHN0cnVjdCBwY2lfZGV2
ICpwZGV2KQogICAgICAgICByZXR1cm4gcmV0OwogCiAgICAgLyogR2V0IHRoZSBtYXhpbXVtIG51
bWJlciBvZiB2ZWN0b3JzIHRoZSBkZXZpY2Ugc3VwcG9ydHMuICovCi0gICAgY29udHJvbCA9IHBj
aV9jb25mX3JlYWQxNihwZGV2LT5zZWcsIHBkZXYtPmJ1cywgc2xvdCwgZnVuYywKLSAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIG1zaV9jb250cm9sX3JlZyhwb3MpKTsKKyAgICBjb250cm9s
ID0gcGNpX2NvbmZfcmVhZDE2KHBkZXYtPnNiZGYuc2VnLCBwZGV2LT5zYmRmLmJ1cywgcGRldi0+
c2JkZi5kZXYsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZGV2LT5zYmRmLmZ1bmMs
IG1zaV9jb250cm9sX3JlZyhwb3MpKTsKIAogICAgIC8qCiAgICAgICogRklYTUU6IEkndmUgb25s
eSBiZWVuIGFibGUgdG8gdGVzdCB0aGlzIGNvZGUgd2l0aCBkZXZpY2VzIHVzaW5nIGEgc2luZ2xl
CkBAIC0yOTMsOCArMjkyLDggQEAgdm9pZCB2cGNpX2R1bXBfbXNpKHZvaWQpCiAgICAgICAgICAg
ICBtc2kgPSBwZGV2LT52cGNpLT5tc2k7CiAgICAgICAgICAgICBpZiAoIG1zaSAmJiBtc2ktPmVu
YWJsZWQgKQogICAgICAgICAgICAgewotICAgICAgICAgICAgICAgIHByaW50aygiJTA0eDolMDJ4
OiUwMnguJXUgTVNJXG4iLCBwZGV2LT5zZWcsIHBkZXYtPmJ1cywKLSAgICAgICAgICAgICAgICAg
ICAgICAgUENJX1NMT1QocGRldi0+ZGV2Zm4pLCBQQ0lfRlVOQyhwZGV2LT5kZXZmbikpOworICAg
ICAgICAgICAgICAgIHByaW50aygiJTA0eDolMDJ4OiUwMnguJXUgTVNJXG4iLCBwZGV2LT5zYmRm
LnNlZywKKyAgICAgICAgICAgICAgICAgICAgICAgcGRldi0+c2JkZi5idXMsIHBkZXYtPnNiZGYu
ZGV2LCBwZGV2LT5zYmRmLmZ1bmMpOwogCiAgICAgICAgICAgICAgICAgcHJpbnRrKCIgIGVuYWJs
ZWQ6ICVkIDY0LWJpdDogJWQiLAogICAgICAgICAgICAgICAgICAgICAgICBtc2ktPmVuYWJsZWQs
IG1zaS0+YWRkcmVzczY0KTsKQEAgLTMxMSw4ICszMTAsOCBAQCB2b2lkIHZwY2lfZHVtcF9tc2ko
dm9pZCkKICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICBpbnQgcmM7CiAKLSAgICAgICAg
ICAgICAgICBwcmludGsoIiUwNHg6JTAyeDolMDJ4LiV1IE1TSS1YXG4iLCBwZGV2LT5zZWcsIHBk
ZXYtPmJ1cywKLSAgICAgICAgICAgICAgICAgICAgICAgUENJX1NMT1QocGRldi0+ZGV2Zm4pLCBQ
Q0lfRlVOQyhwZGV2LT5kZXZmbikpOworICAgICAgICAgICAgICAgIHByaW50aygiJTA0eDolMDJ4
OiUwMnguJXUgTVNJLVhcbiIsIHBkZXYtPnNiZGYuc2VnLAorICAgICAgICAgICAgICAgICAgICAg
ICBwZGV2LT5zYmRmLmJ1cywgcGRldi0+c2JkZi5kZXYsIHBkZXYtPnNiZGYuZnVuYyk7CiAKICAg
ICAgICAgICAgICAgICBwcmludGsoIiAgZW50cmllczogJXUgbWFza2FsbDogJWQgZW5hYmxlZDog
JWRcbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIG1zaXgtPm1heF9lbnRyaWVzLCBtc2l4LT5t
YXNrZWQsIG1zaXgtPmVuYWJsZWQpOwpkaWZmIC0tZ2l0IGEveGVuL2RyaXZlcnMvdnBjaS9tc2l4
LmMgYi94ZW4vZHJpdmVycy92cGNpL21zaXguYwppbmRleCBhZjNmZmEwODdkLi4wNDQzMTcxNWY1
IDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy92cGNpL21zaXguYworKysgYi94ZW4vZHJpdmVycy92
cGNpL21zaXguYwpAQCAtNDIsNyArNDIsNiBAQCBzdGF0aWMgdWludDMyX3QgY29udHJvbF9yZWFk
KGNvbnN0IHN0cnVjdCBwY2lfZGV2ICpwZGV2LCB1bnNpZ25lZCBpbnQgcmVnLAogc3RhdGljIGlu
dCB1cGRhdGVfZW50cnkoc3RydWN0IHZwY2lfbXNpeF9lbnRyeSAqZW50cnksCiAgICAgICAgICAg
ICAgICAgICAgICAgICBjb25zdCBzdHJ1Y3QgcGNpX2RldiAqcGRldiwgdW5zaWduZWQgaW50IG5y
KQogewotICAgIHVpbnQ4X3Qgc2xvdCA9IFBDSV9TTE9UKHBkZXYtPmRldmZuKSwgZnVuYyA9IFBD
SV9GVU5DKHBkZXYtPmRldmZuKTsKICAgICBpbnQgcmMgPSB2cGNpX21zaXhfYXJjaF9kaXNhYmxl
X2VudHJ5KGVudHJ5LCBwZGV2KTsKIAogICAgIC8qIElnbm9yZSBFTk9FTlQsIGl0IG1lYW5zIHRo
ZSBlbnRyeSB3YXNuJ3Qgc2V0dXAuICovCkBAIC01MCw3ICs0OSw4IEBAIHN0YXRpYyBpbnQgdXBk
YXRlX2VudHJ5KHN0cnVjdCB2cGNpX21zaXhfZW50cnkgKmVudHJ5LAogICAgIHsKICAgICAgICAg
Z3ByaW50ayhYRU5MT0dfV0FSTklORywKICAgICAgICAgICAgICAgICAiJTA0eDolMDJ4OiUwMngu
JXU6IHVuYWJsZSB0byBkaXNhYmxlIGVudHJ5ICV1IGZvciB1cGRhdGU6ICVkXG4iLAotICAgICAg
ICAgICAgICAgIHBkZXYtPnNlZywgcGRldi0+YnVzLCBzbG90LCBmdW5jLCBuciwgcmMpOworICAg
ICAgICAgICAgICAgIHBkZXYtPnNiZGYuc2VnLCBwZGV2LT5zYmRmLmJ1cywgcGRldi0+c2JkZi5k
ZXYsIHBkZXYtPnNiZGYuZnVuYywKKyAgICAgICAgICAgICAgICBuciwgcmMpOwogICAgICAgICBy
ZXR1cm4gcmM7CiAgICAgfQogCkBAIC02MSw3ICs2MSw4IEBAIHN0YXRpYyBpbnQgdXBkYXRlX2Vu
dHJ5KHN0cnVjdCB2cGNpX21zaXhfZW50cnkgKmVudHJ5LAogICAgIHsKICAgICAgICAgZ3ByaW50
ayhYRU5MT0dfV0FSTklORywKICAgICAgICAgICAgICAgICAiJTA0eDolMDJ4OiUwMnguJXU6IHVu
YWJsZSB0byBlbmFibGUgZW50cnkgJXU6ICVkXG4iLAotICAgICAgICAgICAgICAgIHBkZXYtPnNl
ZywgcGRldi0+YnVzLCBzbG90LCBmdW5jLCBuciwgcmMpOworICAgICAgICAgICAgICAgIHBkZXYt
PnNiZGYuc2VnLCBwZGV2LT5zYmRmLmJ1cywgcGRldi0+c2JkZi5kZXYsIHBkZXYtPnNiZGYuZnVu
YywKKyAgICAgICAgICAgICAgICBuciwgcmMpOwogICAgICAgICAvKiBFbnRyeSBpcyBsaWtlbHkg
bm90IHByb3Blcmx5IGNvbmZpZ3VyZWQuICovCiAgICAgICAgIHJldHVybiByYzsKICAgICB9CkBA
IC03Miw3ICs3Myw2IEBAIHN0YXRpYyBpbnQgdXBkYXRlX2VudHJ5KHN0cnVjdCB2cGNpX21zaXhf
ZW50cnkgKmVudHJ5LAogc3RhdGljIHZvaWQgY29udHJvbF93cml0ZShjb25zdCBzdHJ1Y3QgcGNp
X2RldiAqcGRldiwgdW5zaWduZWQgaW50IHJlZywKICAgICAgICAgICAgICAgICAgICAgICAgICAg
dWludDMyX3QgdmFsLCB2b2lkICpkYXRhKQogewotICAgIHVpbnQ4X3Qgc2xvdCA9IFBDSV9TTE9U
KHBkZXYtPmRldmZuKSwgZnVuYyA9IFBDSV9GVU5DKHBkZXYtPmRldmZuKTsKICAgICBzdHJ1Y3Qg
dnBjaV9tc2l4ICptc2l4ID0gZGF0YTsKICAgICBib29sIG5ld19tYXNrZWQgPSB2YWwgJiBQQ0lf
TVNJWF9GTEFHU19NQVNLQUxMOwogICAgIGJvb2wgbmV3X2VuYWJsZWQgPSB2YWwgJiBQQ0lfTVNJ
WF9GTEFHU19FTkFCTEU7CkBAIC0xMzUsNyArMTM1LDggQEAgc3RhdGljIHZvaWQgY29udHJvbF93
cml0ZShjb25zdCBzdHJ1Y3QgcGNpX2RldiAqcGRldiwgdW5zaWduZWQgaW50IHJlZywKICAgICAg
ICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgZ3ByaW50ayhYRU5MT0dfV0FSTklORywK
ICAgICAgICAgICAgICAgICAgICAgICAgICIlMDR4OiUwMng6JTAyeC4ldTogdW5hYmxlIHRvIGRp
c2FibGUgZW50cnkgJXU6ICVkXG4iLAotICAgICAgICAgICAgICAgICAgICAgICAgcGRldi0+c2Vn
LCBwZGV2LT5idXMsIHNsb3QsIGZ1bmMsIGksIHJjKTsKKyAgICAgICAgICAgICAgICAgICAgICAg
IHBkZXYtPnNiZGYuc2VnLCBwZGV2LT5zYmRmLmJ1cywgcGRldi0+c2JkZi5kZXYsCisgICAgICAg
ICAgICAgICAgICAgICAgICBwZGV2LT5zYmRmLmZ1bmMsIGksIHJjKTsKICAgICAgICAgICAgICAg
ICByZXR1cm47CiAgICAgICAgICAgICB9CiAgICAgICAgIH0KQEAgLTE0Niw3ICsxNDcsOCBAQCBz
dGF0aWMgdm9pZCBjb250cm9sX3dyaXRlKGNvbnN0IHN0cnVjdCBwY2lfZGV2ICpwZGV2LCB1bnNp
Z25lZCBpbnQgcmVnLAogCiAgICAgdmFsID0gY29udHJvbF9yZWFkKHBkZXYsIHJlZywgZGF0YSk7
CiAgICAgaWYgKCBwY2lfbXNpX2NvbmZfd3JpdGVfaW50ZXJjZXB0KG1zaXgtPnBkZXYsIHJlZywg
MiwgJnZhbCkgPj0gMCApCi0gICAgICAgIHBjaV9jb25mX3dyaXRlMTYocGRldi0+c2VnLCBwZGV2
LT5idXMsIHNsb3QsIGZ1bmMsIHJlZywgdmFsKTsKKyAgICAgICAgcGNpX2NvbmZfd3JpdGUxNihw
ZGV2LT5zYmRmLnNlZywgcGRldi0+c2JkZi5idXMsIHBkZXYtPnNiZGYuZGV2LAorICAgICAgICAg
ICAgICAgICAgICAgICAgIHBkZXYtPnNiZGYuZnVuYywgcmVnLCB2YWwpOwogfQogCiBzdGF0aWMg
c3RydWN0IHZwY2lfbXNpeCAqbXNpeF9maW5kKGNvbnN0IHN0cnVjdCBkb21haW4gKmQsIHVuc2ln
bmVkIGxvbmcgYWRkcikKQEAgLTE4MSw3ICsxODMsNyBAQCBzdGF0aWMgYm9vbCBhY2Nlc3NfYWxs
b3dlZChjb25zdCBzdHJ1Y3QgcGNpX2RldiAqcGRldiwgdW5zaWduZWQgbG9uZyBhZGRyLAogCiAg
ICAgZ3ByaW50ayhYRU5MT0dfV0FSTklORywKICAgICAgICAgICAgICIlMDR4OiUwMng6JTAyeC4l
dTogdW5hbGlnbmVkIG9yIGludmFsaWQgc2l6ZSBNU0ktWCB0YWJsZSBhY2Nlc3NcbiIsCi0gICAg
ICAgICAgICBwZGV2LT5zZWcsIHBkZXYtPmJ1cywgUENJX1NMT1QocGRldi0+ZGV2Zm4pLCBQQ0lf
RlVOQyhwZGV2LT5kZXZmbikpOworICAgICAgICAgICAgcGRldi0+c2JkZi5zZWcsIHBkZXYtPnNi
ZGYuYnVzLCBwZGV2LT5zYmRmLmRldiwgcGRldi0+c2JkZi5mdW5jKTsKIAogICAgIHJldHVybiBm
YWxzZTsKIH0KQEAgLTQzMyw4ICs0MzUsOCBAQCBpbnQgdnBjaV9tYWtlX21zaXhfaG9sZShjb25z
dCBzdHJ1Y3QgcGNpX2RldiAqcGRldikKICAgICAgICAgICAgICAgICBncHJpbnRrKFhFTkxPR19X
QVJOSU5HLAogICAgICAgICAgICAgICAgICAgICAgICAgIiUwNHg6JTAyeDolMDJ4LiV1OiBleGlz
dGluZyBtYXBwaW5nIChtZm46ICUiIFBSSV9tZm4KICAgICAgICAgICAgICAgICAgICAgICAgICJ0
eXBlOiAlZCkgYXQgJSNseCBjbG9iYmVycyBNU0lYIE1NSU8gYXJlYVxuIiwKLSAgICAgICAgICAg
ICAgICAgICAgICAgIHBkZXYtPnNlZywgcGRldi0+YnVzLCBQQ0lfU0xPVChwZGV2LT5kZXZmbiks
Ci0gICAgICAgICAgICAgICAgICAgICAgICBQQ0lfRlVOQyhwZGV2LT5kZXZmbiksIG1mbl94KG1m
biksIHQsIHN0YXJ0KTsKKyAgICAgICAgICAgICAgICAgICAgICAgIHBkZXYtPnNiZGYuc2VnLCBw
ZGV2LT5zYmRmLmJ1cywgcGRldi0+c2JkZi5kZXYsCisgICAgICAgICAgICAgICAgICAgICAgICBw
ZGV2LT5zYmRmLmZ1bmMsIG1mbl94KG1mbiksIHQsIHN0YXJ0KTsKICAgICAgICAgICAgICAgICBy
ZXR1cm4gLUVFWElTVDsKICAgICAgICAgICAgIH0KICAgICAgICAgICAgIHB1dF9nZm4oZCwgc3Rh
cnQpOwpAQCAtNDQ3LDE4ICs0NDksMTggQEAgaW50IHZwY2lfbWFrZV9tc2l4X2hvbGUoY29uc3Qg
c3RydWN0IHBjaV9kZXYgKnBkZXYpCiBzdGF0aWMgaW50IGluaXRfbXNpeChzdHJ1Y3QgcGNpX2Rl
diAqcGRldikKIHsKICAgICBzdHJ1Y3QgZG9tYWluICpkID0gcGRldi0+ZG9tYWluOwotICAgIHVp
bnQ4X3Qgc2xvdCA9IFBDSV9TTE9UKHBkZXYtPmRldmZuKSwgZnVuYyA9IFBDSV9GVU5DKHBkZXYt
PmRldmZuKTsKICAgICB1bnNpZ25lZCBpbnQgbXNpeF9vZmZzZXQsIGksIG1heF9lbnRyaWVzOwog
ICAgIHVpbnQxNl90IGNvbnRyb2w7CiAgICAgaW50IHJjOwogCi0gICAgbXNpeF9vZmZzZXQgPSBw
Y2lfZmluZF9jYXBfb2Zmc2V0KHBkZXYtPnNlZywgcGRldi0+YnVzLCBzbG90LCBmdW5jLAorICAg
IG1zaXhfb2Zmc2V0ID0gcGNpX2ZpbmRfY2FwX29mZnNldChwZGV2LT5zYmRmLnNlZywgcGRldi0+
c2JkZi5idXMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBkZXYtPnNi
ZGYuZGV2LCBwZGV2LT5zYmRmLmZ1bmMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIFBDSV9DQVBfSURfTVNJWCk7CiAgICAgaWYgKCAhbXNpeF9vZmZzZXQgKQogICAgICAg
ICByZXR1cm4gMDsKIAotICAgIGNvbnRyb2wgPSBwY2lfY29uZl9yZWFkMTYocGRldi0+c2VnLCBw
ZGV2LT5idXMsIHNsb3QsIGZ1bmMsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2l4
X2NvbnRyb2xfcmVnKG1zaXhfb2Zmc2V0KSk7CisgICAgY29udHJvbCA9IHBjaV9jb25mX3JlYWQx
NihwZGV2LT5zYmRmLnNlZywgcGRldi0+c2JkZi5idXMsIHBkZXYtPnNiZGYuZGV2LAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgcGRldi0+c2JkZi5mdW5jLCBtc2l4X2NvbnRyb2xfcmVn
KG1zaXhfb2Zmc2V0KSk7CiAKICAgICBtYXhfZW50cmllcyA9IG1zaXhfdGFibGVfc2l6ZShjb250
cm9sKTsKIApAQCAtNDcwLDExICs0NzIsMTEgQEAgc3RhdGljIGludCBpbml0X21zaXgoc3RydWN0
IHBjaV9kZXYgKnBkZXYpCiAgICAgcGRldi0+dnBjaS0+bXNpeC0+cGRldiA9IHBkZXY7CiAKICAg
ICBwZGV2LT52cGNpLT5tc2l4LT50YWJsZXNbVlBDSV9NU0lYX1RBQkxFXSA9Ci0gICAgICAgIHBj
aV9jb25mX3JlYWQzMihwZGV2LT5zZWcsIHBkZXYtPmJ1cywgc2xvdCwgZnVuYywKLSAgICAgICAg
ICAgICAgICAgICAgICAgIG1zaXhfdGFibGVfb2Zmc2V0X3JlZyhtc2l4X29mZnNldCkpOworICAg
ICAgICBwY2lfY29uZl9yZWFkMzIocGRldi0+c2JkZi5zZWcsIHBkZXYtPnNiZGYuYnVzLCBwZGV2
LT5zYmRmLmRldiwKKyAgICAgICAgICAgICAgICAgICAgICAgIHBkZXYtPnNiZGYuZnVuYywgbXNp
eF90YWJsZV9vZmZzZXRfcmVnKG1zaXhfb2Zmc2V0KSk7CiAgICAgcGRldi0+dnBjaS0+bXNpeC0+
dGFibGVzW1ZQQ0lfTVNJWF9QQkFdID0KLSAgICAgICAgcGNpX2NvbmZfcmVhZDMyKHBkZXYtPnNl
ZywgcGRldi0+YnVzLCBzbG90LCBmdW5jLAotICAgICAgICAgICAgICAgICAgICAgICAgbXNpeF9w
YmFfb2Zmc2V0X3JlZyhtc2l4X29mZnNldCkpOworICAgICAgICBwY2lfY29uZl9yZWFkMzIocGRl
di0+c2JkZi5zZWcsIHBkZXYtPnNiZGYuYnVzLCBwZGV2LT5zYmRmLmRldiwKKyAgICAgICAgICAg
ICAgICAgICAgICAgIHBkZXYtPnNiZGYuZnVuYywgbXNpeF9wYmFfb2Zmc2V0X3JlZyhtc2l4X29m
ZnNldCkpOwogCiAgICAgZm9yICggaSA9IDA7IGkgPCBwZGV2LT52cGNpLT5tc2l4LT5tYXhfZW50
cmllczsgaSsrKQogICAgIHsKZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL3ZwY2kvdnBjaS5jIGIv
eGVuL2RyaXZlcnMvdnBjaS92cGNpLmMKaW5kZXggODI2MDdiZGI5YS4uOWEwNjBjMTA4ZSAxMDA2
NDQKLS0tIGEveGVuL2RyaXZlcnMvdnBjaS92cGNpLmMKKysrIGIveGVuL2RyaXZlcnMvdnBjaS92
cGNpLmMKQEAgLTExNCwxNSArMTE0LDE1IEBAIHN0YXRpYyB2b2lkIHZwY2lfaWdub3JlZF93cml0
ZShjb25zdCBzdHJ1Y3QgcGNpX2RldiAqcGRldiwgdW5zaWduZWQgaW50IHJlZywKIHVpbnQzMl90
IHZwY2lfaHdfcmVhZDE2KGNvbnN0IHN0cnVjdCBwY2lfZGV2ICpwZGV2LCB1bnNpZ25lZCBpbnQg
cmVnLAogICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqZGF0YSkKIHsKLSAgICByZXR1cm4g
cGNpX2NvbmZfcmVhZDE2KHBkZXYtPnNlZywgcGRldi0+YnVzLCBQQ0lfU0xPVChwZGV2LT5kZXZm
biksCi0gICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lfRlVOQyhwZGV2LT5kZXZmbiksIHJl
Zyk7CisgICAgcmV0dXJuIHBjaV9jb25mX3JlYWQxNihwZGV2LT5zYmRmLnNlZywgcGRldi0+c2Jk
Zi5idXMsIHBkZXYtPnNiZGYuZGV2LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgcGRldi0+
c2JkZi5mdW5jLCByZWcpOwogfQogCiB1aW50MzJfdCB2cGNpX2h3X3JlYWQzMihjb25zdCBzdHJ1
Y3QgcGNpX2RldiAqcGRldiwgdW5zaWduZWQgaW50IHJlZywKICAgICAgICAgICAgICAgICAgICAg
ICAgIHZvaWQgKmRhdGEpCiB7Ci0gICAgcmV0dXJuIHBjaV9jb25mX3JlYWQzMihwZGV2LT5zZWcs
IHBkZXYtPmJ1cywgUENJX1NMT1QocGRldi0+ZGV2Zm4pLAotICAgICAgICAgICAgICAgICAgICAg
ICAgICAgUENJX0ZVTkMocGRldi0+ZGV2Zm4pLCByZWcpOworICAgIHJldHVybiBwY2lfY29uZl9y
ZWFkMzIocGRldi0+c2JkZi5zZWcsIHBkZXYtPnNiZGYuYnVzLCBwZGV2LT5zYmRmLmRldiwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHBkZXYtPnNiZGYuZnVuYywgcmVnKTsKIH0KIAogaW50
IHZwY2lfYWRkX3JlZ2lzdGVyKHN0cnVjdCB2cGNpICp2cGNpLCB2cGNpX3JlYWRfdCAqcmVhZF9o
YW5kbGVyLApkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUveGVuL3BjaS5oIGIveGVuL2luY2x1ZGUv
eGVuL3BjaS5oCmluZGV4IDhiMjFlOGRjODQuLjFjZjU0ZWI0NjYgMTAwNjQ0Ci0tLSBhL3hlbi9p
bmNsdWRlL3hlbi9wY2kuaAorKysgYi94ZW4vaW5jbHVkZS94ZW4vcGNpLmgKQEAgLTgwLDkgKzgw
LDggQEAgc3RydWN0IHBjaV9kZXYgewogICAgIHN0cnVjdCBhcmNoX21zaXggKm1zaXg7CiAKICAg
ICBzdHJ1Y3QgZG9tYWluICpkb21haW47Ci0gICAgY29uc3QgdTE2IHNlZzsKLSAgICBjb25zdCB1
OCBidXM7Ci0gICAgY29uc3QgdTggZGV2Zm47CisKKyAgICBjb25zdCBwY2lfc2JkZl90IHNiZGY7
CiAKICAgICB1OCBwaGFudG9tX3N0cmlkZTsKIAotLSAKMi4xNy4yIChBcHBsZSBHaXQtMTEzKQoK
Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZl
bCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlz
dHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

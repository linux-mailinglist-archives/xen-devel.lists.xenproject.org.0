Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id A6264146AD7
	for <lists+xen-devel@lfdr.de>; Thu, 23 Jan 2020 15:06:23 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iud5M-0008UM-1q; Thu, 23 Jan 2020 14:03:52 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=wqmU=3M=amazon.co.uk=prvs=2848fc5af=pdurrant@srs-us1.protection.inumbo.net>)
 id 1iud5L-0008UC-9H
 for xen-devel@lists.xenproject.org; Thu, 23 Jan 2020 14:03:51 +0000
X-Inumbo-ID: 29ad0cf0-3de9-11ea-aecd-bc764e2007e4
Received: from smtp-fw-6001.amazon.com (unknown [52.95.48.154])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 29ad0cf0-3de9-11ea-aecd-bc764e2007e4;
 Thu, 23 Jan 2020 14:03:42 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amazon.com; i=@amazon.com; q=dns/txt; s=amazon201209;
 t=1579788223; x=1611324223;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=LgE7nnA0ZyJbkJDPKSRUX9dhk1goVhTldyW9gc1rNAE=;
 b=eLdRlLAw/MXKiXcRi+430UA4l9LhB11+VcTVyKQCXYKNGb5wCQS95ezk
 WrmH0/cXkkT3xSaljRcixyjOZGumzABZ5Sn9iBdCDnXYmOdWoe6yj5ZA1
 PFIeyOiu2VINqsEJSljM9fnYANMAOhyNKu1mplYcFD6H+MoUpu+o79pT9 g=;
IronPort-SDR: ccysc1bfwC9hcv+IwSy3hN5pJG5jm9raTpwJ5zMLukqqyJl7ONV4rGuAwCcfh6ED5qwbKnR9OE
 xASR4NxU68OQ==
X-IronPort-AV: E=Sophos;i="5.70,354,1574121600"; d="scan'208";a="14385996"
Received: from iad12-co-svc-p1-lb1-vlan3.amazon.com (HELO
 email-inbound-relay-2a-8549039f.us-west-2.amazon.com) ([10.43.8.6])
 by smtp-border-fw-out-6001.iad6.amazon.com with ESMTP;
 23 Jan 2020 14:03:41 +0000
Received: from EX13MTAUEA002.ant.amazon.com
 (pdx4-ws-svc-p6-lb7-vlan2.pdx.amazon.com [10.170.41.162])
 by email-inbound-relay-2a-8549039f.us-west-2.amazon.com (Postfix) with ESMTPS
 id 0E310A20A8; Thu, 23 Jan 2020 14:03:39 +0000 (UTC)
Received: from EX13D32EUB003.ant.amazon.com (10.43.166.165) by
 EX13MTAUEA002.ant.amazon.com (10.43.61.77) with Microsoft SMTP Server (TLS)
 id 15.0.1236.3; Thu, 23 Jan 2020 14:03:21 +0000
Received: from EX13MTAUEB002.ant.amazon.com (10.43.60.12) by
 EX13D32EUB003.ant.amazon.com (10.43.166.165) with Microsoft SMTP Server (TLS)
 id 15.0.1367.3; Thu, 23 Jan 2020 14:03:20 +0000
Received: from u2f063a87eabd5f.cbg10.amazon.com (10.125.106.135) by
 mail-relay.amazon.com (10.43.60.234) with Microsoft SMTP Server id
 15.0.1367.3 via Frontend Transport; Thu, 23 Jan 2020 14:03:18 +0000
From: Paul Durrant <pdurrant@amazon.com>
To: <xen-devel@lists.xenproject.org>
Date: Thu, 23 Jan 2020 14:03:05 +0000
Message-ID: <20200123140305.21050-4-pdurrant@amazon.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20200123140305.21050-1-pdurrant@amazon.com>
References: <20200123140305.21050-1-pdurrant@amazon.com>
MIME-Version: 1.0
Precedence: Bulk
Subject: [Xen-devel] [PATCH v3 3/3] x86 / vmx: use a 'normal' domheap page
 for APIC_DEFAULT_PHYS_BASE
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Kevin Tian <kevin.tian@intel.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Julien Grall <julien@xen.org>,
 Jun Nakajima <jun.nakajima@intel.com>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>, Paul Durrant <pdurrant@amazon.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

dm14X2FsbG9jX3ZsYXBpY19tYXBwaW5nKCkgY3VycmVudGx5IGNvbnRhaW5zIHNvbWUgdmVyeSBv
ZGQgbG9va2luZyBjb2RlCnRoYXQgYWxsb2NhdGVzIGEgTUVNRl9ub19vd25lciBkb21oZWFwIHBh
Z2UgYW5kIHRoZW4gc2hhcmVzIHdpdGggdGhlIGd1ZXN0CmFzIGlmIGl0IHdlcmUgYSB4ZW5oZWFw
IHBhZ2UuIFRoaXMgdGhlbiByZXF1aXJlcyB2bXhfZnJlZV92bGFwaWNfbWFwcGluZygpCnRvIGNh
bGwgYSBzcGVjaWFsIGZ1bmN0aW9uIGluIHRoZSBtbSBjb2RlOiBmcmVlX3NoYXJlZF9kb21oZWFw
X3BhZ2UoKS4KCkJ5IHVzaW5nIGEgJ25vcm1hbCcgZG9taGVhcCBwYWdlIChpLmUuIGJ5IG5vdCBw
YXNzaW5nIE1FTUZfbm9fb3duZXIgdG8KYWxsb2NfZG9taGVhcF9wYWdlKCkpLCB0aGUgb2RkIGxv
b2tpbmcgY29kZSBpbiB2bXhfYWxsb2NfdmxhcGljX21hcHBpbmcoKQpjYW4gc2ltcGx5IHVzZSBn
ZXRfcGFnZV9hbmRfdHlwZSgpIHRvIHNldCB1cCBhIHdyaXRhYmxlIG1hcHBpbmcgYmVmb3JlCmlu
c2VydGlvbiBpbiB0aGUgUDJNIGFuZCB2bXhfZnJlZV92bGFwaWNfbWFwcGluZygpIGNhbiBzaW1w
bHkgcmVsZWFzZSB0aGUKcGFnZSB1c2luZyBwdXRfcGFnZV9hbGxvY19yZWYoKSBmb2xsb3dlZCBi
eSBwdXRfcGFnZV9hbmRfdHlwZSgpLiBUaGlzCnRoZW4gYWxsb3dzIGZyZWVfc2hhcmVkX2RvbWhl
YXBfcGFnZSgpIHRvIGJlIHB1cmdlZC4KClRoZXJlIGlzLCBob3dldmVyLCBzb21lIGZhbGwtb3V0
IGZyb20gdGhpcyBzaW1wbGlmaWNhdGlvbjoKCi0gYWxsb2NfZG9taGVhcF9wYWdlKCkgd2lsbCBu
b3cgY2FsbCBhc3NpZ25fcGFnZXMoKSBhbmQgcnVuIGludG8gdGhlIGZhY3QKICB0aGF0ICdtYXhf
cGFnZXMnIGlzIG5vdCBzZXQgdW50aWwgc29tZSB0aW1lIGFmdGVyIGRvbWFpbl9jcmVhdGUoKS4g
VG8KICBhdm9pZCBhbiBhbGxvY2F0aW9uIGZhaWx1cmUsIGRvbWFpbl9jcmVhdGUoKSBpcyBtb2Rp
ZmllZCB0byBzZXQKICBtYXhfcGFnZXMgdG8gYW4gaW5pdGlhbCB2YWx1ZSwgc3VmZmljaWVudCB0
byBjb3ZlciBhbnkgZG9taGVhcAogIGFsbG9jYXRpb25zIHJlcXVpcmVkIHRvIGNvbXBsZXRlIGRv
bWFpbiBjcmVhdGlvbi4gVGhlIHZhbHVlIHdpbGwgYmUKICBzZXQgdG8gdGhlICdyZWFsJyBtYXhf
cGFnZXMgd2hlbiB0aGUgdG9vbC1zdGFjayBsYXRlciBwZXJmb3JtcyB0aGUKICBYRU5fRE9NQ1RM
X21heF9tZW0gb3BlcmF0aW9uLCB0aHVzIGFsbG93aW5nIHRoZSByZXN0IG9mIHRoZSBkb21haW4n
cwogIG1lbW9yeSB0byBiZSBhbGxvY2F0ZWQuCgotIEJlY2F1c2UgdGhlIGRvbWhlYXAgcGFnZSBp
cyBubyBsb25nZXIgYSBwc2V1ZG8teGVuaGVhcCBwYWdlLCB0aGUKICByZWZlcmVuY2UgY291bnRp
bmcgd2lsbCBwcmV2ZW50IHRoZSBkb21haW4gZnJvbSBiZWluZyBkZXN0cm95ZWQuIFRodXMKICB0
aGUgY2FsbCB0byB2bXhfZnJlZV92bGFwaWNfbWFwcGluZygpIGlzIG1vdmVkIGZyb20gdGhlCiAg
ZG9tYWluX2Rlc3Ryb3koKSBtZXRob2QgaW50byB0aGUgZG9tYWluX3JlbGlucXVpc2hfcmVzb3Vy
Y2VzKCkgbWV0aG9kLgogIFdoaWxzdCBpbiB0aGUgYXJlYSwgbWFrZSB0aGUgZG9tYWluX2Rlc3Ry
b3koKSBtZXRob2QgYW4gb3B0aW9uYWwKICBhbHRlcm5hdGl2ZV92Y2FsbCgpIChzaW5jZSBpdCB3
aWxsIG5vIGxvbmdlciBwZWZvcm0gYW55IGZ1bmN0aW9uIGluIFZNWAogIGFuZCBpcyBzdHViYmVk
IGluIFNWTSBhbnl3YXkpLgoKU2lnbmVkLW9mZi1ieTogUGF1bCBEdXJyYW50IDxwZHVycmFudEBh
bWF6b24uY29tPgotLS0KQ2M6IEphbiBCZXVsaWNoIDxqYmV1bGljaEBzdXNlLmNvbT4KQ2M6IEFu
ZHJldyBDb29wZXIgPGFuZHJldy5jb29wZXIzQGNpdHJpeC5jb20+CkNjOiBXZWkgTGl1IDx3bEB4
ZW4ub3JnPgpDYzogIlJvZ2VyIFBhdSBNb25uw6kiIDxyb2dlci5wYXVAY2l0cml4LmNvbT4KQ2M6
IEdlb3JnZSBEdW5sYXAgPEdlb3JnZS5EdW5sYXBAZXUuY2l0cml4LmNvbT4KQ2M6IElhbiBKYWNr
c29uIDxpYW4uamFja3NvbkBldS5jaXRyaXguY29tPgpDYzogSnVsaWVuIEdyYWxsIDxqdWxpZW5A
eGVuLm9yZz4KQ2M6IEtvbnJhZCBSemVzenV0ZWsgV2lsayA8a29ucmFkLndpbGtAb3JhY2xlLmNv
bT4KQ2M6IFN0ZWZhbm8gU3RhYmVsbGluaSA8c3N0YWJlbGxpbmlAa2VybmVsLm9yZz4KQ2M6IEp1
biBOYWthamltYSA8anVuLm5ha2FqaW1hQGludGVsLmNvbT4KQ2M6IEtldmluIFRpYW4gPGtldmlu
LnRpYW5AaW50ZWwuY29tPgoKdjI6CiAtIFNldCBhbiBpbml0aWFsIHZhbHVlIGZvciBtYXhfcGFn
ZXMgcmF0aGVyIHRoYW4gYXZvaWRpbmcgdGhlIGNoZWNrIGluCiAgIGFzc2lnbl9wYWdlcygpCiAt
IE1ha2UgZG9tYWluX2Rlc3Ryb3koKSBvcHRpb25hbAotLS0KIHhlbi9hcmNoL3g4Ni9odm0vaHZt
LmMgICAgIHwgIDQgKysrLQogeGVuL2FyY2gveDg2L2h2bS9zdm0vc3ZtLmMgfCAgNSAtLS0tLQog
eGVuL2FyY2gveDg2L2h2bS92bXgvdm14LmMgfCAyNSArKysrKysrKysrKysrKysrKysrKy0tLS0t
CiB4ZW4vYXJjaC94ODYvbW0uYyAgICAgICAgICB8IDEwIC0tLS0tLS0tLS0KIHhlbi9jb21tb24v
ZG9tYWluLmMgICAgICAgIHwgIDggKysrKysrKysKIHhlbi9pbmNsdWRlL2FzbS14ODYvbW0uaCAg
IHwgIDIgLS0KIDYgZmlsZXMgY2hhbmdlZCwgMzEgaW5zZXJ0aW9ucygrKSwgMjMgZGVsZXRpb25z
KC0pCgpkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L2h2bS9odm0uYyBiL3hlbi9hcmNoL3g4Ni9o
dm0vaHZtLmMKaW5kZXggZTUxYzA3NzI2OS4uZDI2MTBmNWYwMSAxMDA2NDQKLS0tIGEveGVuL2Fy
Y2gveDg2L2h2bS9odm0uYworKysgYi94ZW4vYXJjaC94ODYvaHZtL2h2bS5jCkBAIC03NDYsNyAr
NzQ2LDkgQEAgdm9pZCBodm1fZG9tYWluX2Rlc3Ryb3koc3RydWN0IGRvbWFpbiAqZCkKIAogICAg
IGh2bV9kZXN0cm95X2NhY2hlYXR0cl9yZWdpb25fbGlzdChkKTsKIAotICAgIGh2bV9mdW5jcy5k
b21haW5fZGVzdHJveShkKTsKKyAgICBpZiAoIGh2bV9mdW5jcy5kb21haW5fZGVzdHJveSApCisg
ICAgICAgIGFsdGVybmF0aXZlX3ZjYWxsKGh2bV9mdW5jcy5kb21haW5fZGVzdHJveSwgZCk7CisK
ICAgICBydGNfZGVpbml0KGQpOwogICAgIHN0ZHZnYV9kZWluaXQoZCk7CiAgICAgdmlvYXBpY19k
ZWluaXQoZCk7CmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvaHZtL3N2bS9zdm0uYyBiL3hlbi9h
cmNoL3g4Ni9odm0vc3ZtL3N2bS5jCmluZGV4IGIxYzM3NmQ0NTUuLmI3ZjY3ZjlmMDMgMTAwNjQ0
Ci0tLSBhL3hlbi9hcmNoL3g4Ni9odm0vc3ZtL3N2bS5jCisrKyBiL3hlbi9hcmNoL3g4Ni9odm0v
c3ZtL3N2bS5jCkBAIC0xMTU1LDEwICsxMTU1LDYgQEAgc3RhdGljIGludCBzdm1fZG9tYWluX2lu
aXRpYWxpc2Uoc3RydWN0IGRvbWFpbiAqZCkKICAgICByZXR1cm4gMDsKIH0KIAotc3RhdGljIHZv
aWQgc3ZtX2RvbWFpbl9kZXN0cm95KHN0cnVjdCBkb21haW4gKmQpCi17Ci19Ci0KIHN0YXRpYyBp
bnQgc3ZtX3ZjcHVfaW5pdGlhbGlzZShzdHJ1Y3QgdmNwdSAqdikKIHsKICAgICBpbnQgcmM7CkBA
IC0yNDI1LDcgKzI0MjEsNiBAQCBzdGF0aWMgc3RydWN0IGh2bV9mdW5jdGlvbl90YWJsZSBfX2lu
aXRkYXRhIHN2bV9mdW5jdGlvbl90YWJsZSA9IHsKICAgICAuY3B1X3VwICAgICAgICAgICAgICAg
PSBzdm1fY3B1X3VwLAogICAgIC5jcHVfZG93biAgICAgICAgICAgICA9IHN2bV9jcHVfZG93biwK
ICAgICAuZG9tYWluX2luaXRpYWxpc2UgICAgPSBzdm1fZG9tYWluX2luaXRpYWxpc2UsCi0gICAg
LmRvbWFpbl9kZXN0cm95ICAgICAgID0gc3ZtX2RvbWFpbl9kZXN0cm95LAogICAgIC52Y3B1X2lu
aXRpYWxpc2UgICAgICA9IHN2bV92Y3B1X2luaXRpYWxpc2UsCiAgICAgLnZjcHVfZGVzdHJveSAg
ICAgICAgID0gc3ZtX3ZjcHVfZGVzdHJveSwKICAgICAuc2F2ZV9jcHVfY3R4dCAgICAgICAgPSBz
dm1fc2F2ZV92bWNiX2N0eHQsCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvaHZtL3ZteC92bXgu
YyBiL3hlbi9hcmNoL3g4Ni9odm0vdm14L3ZteC5jCmluZGV4IGIyNjJkMzhhN2MuLmMzYTA2YjU0
YTggMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9odm0vdm14L3ZteC5jCisrKyBiL3hlbi9hcmNo
L3g4Ni9odm0vdm14L3ZteC5jCkBAIC00MTksNyArNDE5LDcgQEAgc3RhdGljIGludCB2bXhfZG9t
YWluX2luaXRpYWxpc2Uoc3RydWN0IGRvbWFpbiAqZCkKICAgICByZXR1cm4gMDsKIH0KIAotc3Rh
dGljIHZvaWQgdm14X2RvbWFpbl9kZXN0cm95KHN0cnVjdCBkb21haW4gKmQpCitzdGF0aWMgdm9p
ZCB2bXhfZG9tYWluX3JlbGlucXVpc2hfcmVzb3VyY2VzKHN0cnVjdCBkb21haW4gKmQpCiB7CiAg
ICAgaWYgKCAhaGFzX3ZsYXBpYyhkKSApCiAgICAgICAgIHJldHVybjsKQEAgLTIyNDAsNyArMjI0
MCw3IEBAIHN0YXRpYyBzdHJ1Y3QgaHZtX2Z1bmN0aW9uX3RhYmxlIF9faW5pdGRhdGEgdm14X2Z1
bmN0aW9uX3RhYmxlID0gewogICAgIC5jcHVfdXBfcHJlcGFyZSAgICAgICA9IHZteF9jcHVfdXBf
cHJlcGFyZSwKICAgICAuY3B1X2RlYWQgICAgICAgICAgICAgPSB2bXhfY3B1X2RlYWQsCiAgICAg
LmRvbWFpbl9pbml0aWFsaXNlICAgID0gdm14X2RvbWFpbl9pbml0aWFsaXNlLAotICAgIC5kb21h
aW5fZGVzdHJveSAgICAgICA9IHZteF9kb21haW5fZGVzdHJveSwKKyAgICAuZG9tYWluX3JlbGlu
cXVpc2hfcmVzb3VyY2VzID0gdm14X2RvbWFpbl9yZWxpbnF1aXNoX3Jlc291cmNlcywKICAgICAu
dmNwdV9pbml0aWFsaXNlICAgICAgPSB2bXhfdmNwdV9pbml0aWFsaXNlLAogICAgIC52Y3B1X2Rl
c3Ryb3kgICAgICAgICA9IHZteF92Y3B1X2Rlc3Ryb3ksCiAgICAgLnNhdmVfY3B1X2N0eHQgICAg
ICAgID0gdm14X3NhdmVfdm1jc19jdHh0LApAQCAtMzAyOCwxMiArMzAyOCwyMiBAQCBzdGF0aWMg
aW50IHZteF9hbGxvY192bGFwaWNfbWFwcGluZyhzdHJ1Y3QgZG9tYWluICpkKQogICAgIGlmICgg
IWNwdV9oYXNfdm14X3ZpcnR1YWxpemVfYXBpY19hY2Nlc3NlcyApCiAgICAgICAgIHJldHVybiAw
OwogCi0gICAgcGcgPSBhbGxvY19kb21oZWFwX3BhZ2UoZCwgTUVNRl9ub19vd25lcik7CisgICAg
cGcgPSBhbGxvY19kb21oZWFwX3BhZ2UoZCwgMCk7CiAgICAgaWYgKCAhcGcgKQogICAgICAgICBy
ZXR1cm4gLUVOT01FTTsKKworICAgIGlmICggIWdldF9wYWdlX2FuZF90eXBlKHBnLCBkLCBQR1Rf
d3JpdGFibGVfcGFnZSkgKQorICAgIHsKKyAgICAgICAgLyoKKyAgICAgICAgICogVGhlIGRvbWFp
biBjYW4ndCBwb3NzaWJseSBrbm93IGFib3V0IHRoaXMgcGFnZSB5ZXQsIHNvIGZhaWx1cmUKKyAg
ICAgICAgICogaGVyZSBpcyBhIGNsZWFyIGluZGljYXRpb24gb2Ygc29tZXRoaW5nIGZpc2h5IGdv
aW5nIG9uLgorICAgICAgICAgKi8KKyAgICAgICAgZG9tYWluX2NyYXNoKGQpOworICAgICAgICBy
ZXR1cm4gLUVOT0RBVEE7CisgICAgfQorCiAgICAgbWZuID0gcGFnZV90b19tZm4ocGcpOwogICAg
IGNsZWFyX2RvbWFpbl9wYWdlKG1mbik7Ci0gICAgc2hhcmVfeGVuX3BhZ2Vfd2l0aF9ndWVzdChw
ZywgZCwgU0hBUkVfcncpOwogICAgIGQtPmFyY2guaHZtLnZteC5hcGljX2FjY2Vzc19tZm4gPSBt
Zm47CiAKICAgICByZXR1cm4gc2V0X21taW9fcDJtX2VudHJ5KGQsIHBhZGRyX3RvX3BmbihBUElD
X0RFRkFVTFRfUEhZU19CQVNFKSwgbWZuLApAQCAtMzA0Nyw3ICszMDU3LDEyIEBAIHN0YXRpYyB2
b2lkIHZteF9mcmVlX3ZsYXBpY19tYXBwaW5nKHN0cnVjdCBkb21haW4gKmQpCiAKICAgICBkLT5h
cmNoLmh2bS52bXguYXBpY19hY2Nlc3NfbWZuID0gX21mbigwKTsKICAgICBpZiAoICFtZm5fZXEo
bWZuLCBfbWZuKDApKSApCi0gICAgICAgIGZyZWVfc2hhcmVkX2RvbWhlYXBfcGFnZShtZm5fdG9f
cGFnZShtZm4pKTsKKyAgICB7CisgICAgICAgIHN0cnVjdCBwYWdlX2luZm8gKnBnID0gbWZuX3Rv
X3BhZ2UobWZuKTsKKworICAgICAgICBwdXRfcGFnZV9hbGxvY19yZWYocGcpOworICAgICAgICBw
dXRfcGFnZV9hbmRfdHlwZShwZyk7CisgICAgfQogfQogCiBzdGF0aWMgdm9pZCB2bXhfaW5zdGFs
bF92bGFwaWNfbWFwcGluZyhzdHJ1Y3QgdmNwdSAqdikKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4
Ni9tbS5jIGIveGVuL2FyY2gveDg2L21tLmMKaW5kZXggNjU0MTkwZTllOS4uMmE2ZDJlOGFmOSAx
MDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L21tLmMKKysrIGIveGVuL2FyY2gveDg2L21tLmMKQEAg
LTQ5NiwxNiArNDk2LDYgQEAgdm9pZCBzaGFyZV94ZW5fcGFnZV93aXRoX2d1ZXN0KHN0cnVjdCBw
YWdlX2luZm8gKnBhZ2UsIHN0cnVjdCBkb21haW4gKmQsCiAgICAgc3Bpbl91bmxvY2soJmQtPnBh
Z2VfYWxsb2NfbG9jayk7CiB9CiAKLXZvaWQgZnJlZV9zaGFyZWRfZG9taGVhcF9wYWdlKHN0cnVj
dCBwYWdlX2luZm8gKnBhZ2UpCi17Ci0gICAgcHV0X3BhZ2VfYWxsb2NfcmVmKHBhZ2UpOwotICAg
IGlmICggIXRlc3RfYW5kX2NsZWFyX2JpdChfUEdDX3hlbl9oZWFwLCAmcGFnZS0+Y291bnRfaW5m
bykgKQotICAgICAgICBBU1NFUlRfVU5SRUFDSEFCTEUoKTsKLSAgICBwYWdlLT51LmludXNlLnR5
cGVfaW5mbyA9IDA7Ci0gICAgcGFnZV9zZXRfb3duZXIocGFnZSwgTlVMTCk7Ci0gICAgZnJlZV9k
b21oZWFwX3BhZ2UocGFnZSk7Ci19Ci0KIHZvaWQgbWFrZV9jcjMoc3RydWN0IHZjcHUgKnYsIG1m
bl90IG1mbikKIHsKICAgICBzdHJ1Y3QgZG9tYWluICpkID0gdi0+ZG9tYWluOwpkaWZmIC0tZ2l0
IGEveGVuL2NvbW1vbi9kb21haW4uYyBiL3hlbi9jb21tb24vZG9tYWluLmMKaW5kZXggZWUzZjlm
ZmQzZS4uMzBjNzc3YWNiOCAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9kb21haW4uYworKysgYi94
ZW4vY29tbW9uL2RvbWFpbi5jCkBAIC0zMzksNiArMzM5LDggQEAgc3RhdGljIGludCBzYW5pdGlz
ZV9kb21haW5fY29uZmlnKHN0cnVjdCB4ZW5fZG9tY3RsX2NyZWF0ZWRvbWFpbiAqY29uZmlnKQog
ICAgIHJldHVybiBhcmNoX3Nhbml0aXNlX2RvbWFpbl9jb25maWcoY29uZmlnKTsKIH0KIAorI2Rl
ZmluZSBET01BSU5fSU5JVF9QQUdFUyAxCisKIHN0cnVjdCBkb21haW4gKmRvbWFpbl9jcmVhdGUo
ZG9taWRfdCBkb21pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHhlbl9k
b21jdGxfY3JlYXRlZG9tYWluICpjb25maWcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGJvb2wgaXNfcHJpdikKQEAgLTQ0MSw2ICs0NDMsMTIgQEAgc3RydWN0IGRvbWFpbiAqZG9tYWlu
X2NyZWF0ZShkb21pZF90IGRvbWlkLAogICAgICAgICByYWRpeF90cmVlX2luaXQoJmQtPnBpcnFf
dHJlZSk7CiAgICAgfQogCisgICAgLyoKKyAgICAgKiBBbGxvdyBhIGxpbWl0ZWQgbnVtYmVyIG9m
IHNwZWNpYWwgcGFnZXMgdG8gYmUgYWxsb2NhdGVkIGZvciB0aGUKKyAgICAgKiBkb21haW4KKyAg
ICAgKi8KKyAgICBkLT5tYXhfcGFnZXMgPSBET01BSU5fSU5JVF9QQUdFUzsKKwogICAgIGlmICgg
KGVyciA9IGFyY2hfZG9tYWluX2NyZWF0ZShkLCBjb25maWcpKSAhPSAwICkKICAgICAgICAgZ290
byBmYWlsOwogICAgIGluaXRfc3RhdHVzIHw9IElOSVRfYXJjaDsKZGlmZiAtLWdpdCBhL3hlbi9p
bmNsdWRlL2FzbS14ODYvbW0uaCBiL3hlbi9pbmNsdWRlL2FzbS14ODYvbW0uaAppbmRleCAyY2E4
ODgyYWQwLi5lNDI5ZjM4MjI4IDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS9hc20teDg2L21tLmgK
KysrIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9tbS5oCkBAIC0zMTcsOCArMzE3LDYgQEAgc3RydWN0
IHBhZ2VfaW5mbwogCiAjZGVmaW5lIG1hZGRyX2dldF9vd25lcihtYSkgICAocGFnZV9nZXRfb3du
ZXIobWFkZHJfdG9fcGFnZSgobWEpKSkpCiAKLWV4dGVybiB2b2lkIGZyZWVfc2hhcmVkX2RvbWhl
YXBfcGFnZShzdHJ1Y3QgcGFnZV9pbmZvICpwYWdlKTsKLQogI2RlZmluZSBmcmFtZV90YWJsZSAo
KHN0cnVjdCBwYWdlX2luZm8gKilGUkFNRVRBQkxFX1ZJUlRfU1RBUlQpCiBleHRlcm4gdW5zaWdu
ZWQgbG9uZyBtYXhfcGFnZTsKIGV4dGVybiB1bnNpZ25lZCBsb25nIHRvdGFsX3BhZ2VzOwotLSAK
Mi4yMC4xCgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18K
WGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0
cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

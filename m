Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id A1593C2AF0
	for <lists+xen-devel@lfdr.de>; Tue,  1 Oct 2019 01:32:28 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iF57u-00026T-Gx; Mon, 30 Sep 2019 23:30:46 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=/D4s=XZ=kernel.org=sstabellini@srs-us1.protection.inumbo.net>)
 id 1iF57t-00025i-7Z
 for xen-devel@lists.xen.org; Mon, 30 Sep 2019 23:30:45 +0000
X-Inumbo-ID: 4ce1acd2-e3da-11e9-96ea-12813bfff9fa
Received: from mail.kernel.org (unknown [198.145.29.99])
 by localhost (Halon) with ESMTPS
 id 4ce1acd2-e3da-11e9-96ea-12813bfff9fa;
 Mon, 30 Sep 2019 23:30:36 +0000 (UTC)
Received: from sstabellini-ThinkPad-T480s.xilinx.com
 (c-67-164-102-47.hsd1.ca.comcast.net [67.164.102.47])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
 (No client certificate requested)
 by mail.kernel.org (Postfix) with ESMTPSA id 635F9217F4;
 Mon, 30 Sep 2019 23:30:35 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
 s=default; t=1569886235;
 bh=BmvjVVWKnq0mtpTPHHlY9DvkBE59lN+h5n1p5jOe54I=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=P2iiLsZAilFoQy0fuwywxL1S/KW0GSRVIUgndx1eNku1Kyv26u70/XR3L6QhofAOj
 5mY9dGeYkXIKO3FHxBEfHV/kXy10cUTCMdXVkC2ui8sg2J91xhJXGrrR91qwrkR9sB
 f9sD0SORyjVi08lpyPSdj33oHmjcb54R9yNykNkQ=
From: Stefano Stabellini <sstabellini@kernel.org>
To: julien.grall@arm.com
Date: Mon, 30 Sep 2019 16:30:29 -0700
Message-Id: <20190930233032.2120-5-sstabellini@kernel.org>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <alpine.DEB.2.21.1909301628540.2594@sstabellini-ThinkPad-T480s>
References: <alpine.DEB.2.21.1909301628540.2594@sstabellini-ThinkPad-T480s>
Subject: [Xen-devel] [PATCH v7b 5/8] xen/arm: assign devices to boot domains
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Stefano Stabellini <stefanos@xilinx.com>, sstabellini@kernel.org,
 andrii_anisov@epam.com, Achin.Gupta@arm.com, xen-devel@lists.xen.org,
 Volodymyr_Babchuk@epam.com
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

U2NhbiB0aGUgdXNlciBwcm92aWRlZCBkdGIgZnJhZ21lbnQgYXQgYm9vdC4gRm9yIGVhY2ggZGV2
aWNlIG5vZGUsIG1hcAptZW1vcnkgdG8gZ3Vlc3RzLCBhbmQgcm91dGUgaW50ZXJydXB0cyBhbmQg
c2V0dXAgdGhlIGlvbW11LgoKVGhlIG1lbW9yeSByZWdpb24gdG8gcmVtYXAgaXMgc3BlY2lmaWVk
IGJ5IHRoZSAieGVuLHJlZyIgcHJvcGVydHkuCgpUaGUgaW9tbXUgaXMgc2V0dXAgYnkgcGFzc2lu
ZyB0aGUgbm9kZSBvZiB0aGUgZGV2aWNlIHRvIGFzc2lnbiBvbiB0aGUKaG9zdCBkZXZpY2UgdHJl
ZS4gVGhlIHBhdGggaXMgc3BlY2lmaWVkIGluIHRoZSBkZXZpY2UgdHJlZSBmcmFnbWVudCBhcwp0
aGUgInhlbixwYXRoIiBzdHJpbmcgcHJvcGVydHkuCgpUaGUgaW50ZXJydXB0cyBhcmUgcmVtYXBw
ZWQgYmFzZWQgb24gdGhlIGluZm9ybWF0aW9uIGZyb20gdGhlCmNvcnJlc3BvbmRpbmcgbm9kZSBv
biB0aGUgaG9zdCBkZXZpY2UgdHJlZS4gQ2FsbApoYW5kbGVfZGV2aWNlX2ludGVycnVwdHMgdG8g
cmVtYXAgaW50ZXJydXB0cy4gSW50ZXJydXB0cyByZWxhdGVkIGRldmljZQp0cmVlIHByb3BlcnRp
ZXMgYXJlIGNvcGllZCBmcm9tIHRoZSBkZXZpY2UgdHJlZSBmcmFnbWVudCwgc2FtZSBhcyBhbGwK
dGhlIG90aGVyIHByb3BlcnRpZXMuCgpSZXF1aXJlIGJvdGggeGVuLHJlZyBhbmQgeGVuLHBhdGgg
dG8gYmUgcHJlc2VudCwgdW5sZXNzCnhlbixmb3JjZS1hc3NpZ24td2l0aG91dC1pb21tdSBpcyBh
bHNvIHNldC4gSW4gdGhhdCBjYXNlLCB0b2xlcmF0ZSBhCm1pc3NpbmcgeGVuLHBhdGgsIGFsc28g
dG9sZXJhdGUgaW9tbXUgc2V0dXAgZmFpbHVyZSBmb3IgdGhlIHBhc3N0aHJvdWdoCmRldmljZS4K
CkFsc28gc2V0IGFkZCB0aGUgbmV3IGZsYWcgWEVOX0RPTUNUTF9DREZfaW9tbXUgc28gdGhhdCBk
b20wbGVzcyBkb21VCmNhbiB1c2UgdGhlIElPTU1VIGlmIGEgcGFydGlhbCBkdGIgaXMgc3BlY2lm
aWVkLgoKU2lnbmVkLW9mZi1ieTogU3RlZmFubyBTdGFiZWxsaW5pIDxzdGVmYW5vc0B4aWxpbngu
Y29tPgotLS0KQ2hhbmdlcyBpbiB2NzoKLSBpbXByb3ZlIGluLWNvZGUgY29tbWVudAotIGNvZGUg
c3R5bGUKLSByZXR1cm4gMSBpbnN0ZWFkIG9mIEVOT0VOVAotIGludHJvZHVjZSAieGVuLGZvcmNl
LWFzc2lnbi13aXRob3V0LWlvbW11IgotIHJlcXVpcmUgYm90aCAieGVuLHJlZyIgYW5kICJ4ZW4s
cGF0aCIgdW5sZXNzCiAgInhlbixmb3JjZS1hc3NpZ24td2l0aG91dC1pb21tdSIKCkNoYW5nZXMg
aW4gdjY6Ci0gdHVybiBkcHJpbnRrcyBpbnRvIHByaW50a3MKLSByZXR1cm4gZXJyb3Igb24gcGFn
ZSBhbGlnbm1lbnQgY2hlY2sgZmFpbHVyZQotIHNldCBYRU5fRE9NQ1RMX0NERl9pb21tdSBpZiBw
YXJ0aWFsIGR0YiBpcyBzcGVjaWZpZWQKCkNoYW5nZXMgaW4gdjU6Ci0gdXNlIGxvY2FsIHZhcmlh
YmxlIGZvciBuYW1lCi0gdXNlIG1hcF9yZWdpb25zX3AybXQKLSBhZGQgd2FybmluZyBmb3Igbm90
IHBhZ2UgYWxpZ25lZCBhZGRyZXNzZXMvc2l6ZXMKLSBpbnRyb2R1Y2UgaGFuZGxlX3Bhc3N0aHJv
dWdoX3Byb3AKCkNoYW5nZXMgaW4gdjQ6Ci0gdXNlIHVuc2lnbmVkCi0gaW1wcm92ZSBjb21taXQg
bWVzc2FnZQotIGNvZGUgc3R5bGUKLSB1c2UgZHRfcHJvcF9jbXAKLSB1c2UgZGV2aWNlX3RyZWVf
Z2V0X3JlZwotIGRvbid0IGNvcHkgb3ZlciB4ZW4scmVnIGFuZCB4ZW4scGF0aAotIGRvbid0IGNy
ZWF0ZSBzcGVjaWFsIGludGVycnVwdCBwcm9wZXJ0aWVzIGZvciBkb21VOiBjb3B5IHRoZW0gZnJv
bSB0aGUKICBmcmFnbWVudAotIGluLWNvZGUgY29tbWVudAoKQ2hhbmdlcyBpbiB2MzoKLSBpbXBy
b3ZlIGNvbW1pdCBtZXNzYWdlCi0gcmVtb3ZlIHN1cGVyZmx1b3VzIGNhc3QKLSBtZXJnZSBjb2Rl
IHdpdGggdGhlIGNvcHkgY29kZQotIGFkZCBpbnRlcnJ1cC1wYXJlbnQKLSBkZW1vdmUgZGVwdGgg
PiAyIGNoZWNrCi0gcmV1c2UgY29kZSBmcm9tIGhhbmRsZV9kZXZpY2VfaW50ZXJydXB0cwotIGNv
cHkgaW50ZXJydXB0cyBmcm9tIGhvc3QgZHQKCkNoYW5nZXMgaW4gdjI6Ci0gcmVuYW1lICJwYXRo
IiB0byAieGVuLHBhdGgiCi0gZ3JhbW1hciBmaXgKLSB1c2UgZ2FkZHJfdG9fZ2ZuIGFuZCBtYWRk
cl90b19tZm4KLSByZW1vdmUgZGVwdGggPD0gMiBsaW1pdGF0aW9uIGluIHNjYW5uaW5nIHRoZSBk
dGIgZnJhZ21lbnQKLSBpbnRyb2R1Y2UgYW5kIHBhcnNlIHhlbixyZWcKLSBjb2RlIHN0eWxlCi0g
c3VwcG9ydCBtb3JlIHRoYW4gb25lIGludGVycnVwdCBwZXIgZGV2aWNlCi0gc3BlY2lmeSBvbmx5
IHRoZSBHSUMgaXMgc3VwcG9ydGVkCi0tLQogeGVuL2FyY2gvYXJtL2RvbWFpbl9idWlsZC5jIHwg
MTMzICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKystLQogMSBmaWxlIGNoYW5nZWQs
IDEyOSBpbnNlcnRpb25zKCspLCA0IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3hlbi9hcmNo
L2FybS9kb21haW5fYnVpbGQuYyBiL3hlbi9hcmNoL2FybS9kb21haW5fYnVpbGQuYwppbmRleCA4
NGI2NWI4ZjI1Li40N2Y5YmIzMWRmIDEwMDY0NAotLS0gYS94ZW4vYXJjaC9hcm0vZG9tYWluX2J1
aWxkLmMKKysrIGIveGVuL2FyY2gvYXJtL2RvbWFpbl9idWlsZC5jCkBAIC0xNzE0LDYgKzE3MTQs
ODggQEAgc3RhdGljIGludCBfX2luaXQgbWFrZV92cGwwMTFfdWFydF9ub2RlKHN0cnVjdCBrZXJu
ZWxfaW5mbyAqa2luZm8pCiB9CiAjZW5kaWYKIAorLyoKKyAqIFNjYW4gZGV2aWNlIHRyZWUgcHJv
cGVydGllcyBmb3IgcGFzc3Rocm91Z2ggc3BlY2lmaWMgaW5mb3JtYXRpb24uCisgKiBSZXR1cm5z
IDwgMCBvbiBlcnJvcgorICogICAgICAgICAwIG9uIHN1Y2Nlc3MKKyAqLworc3RhdGljIGludCBf
X2luaXQgaGFuZGxlX3Bhc3N0aHJvdWdoX3Byb3Aoc3RydWN0IGtlcm5lbF9pbmZvICpraW5mbywK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cnVjdCBm
ZHRfcHJvcGVydHkgKnhlbl9yZWcsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBjb25zdCBzdHJ1Y3QgZmR0X3Byb3BlcnR5ICp4ZW5fcGF0aCwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2wgeGVuX2ZvcmNlLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgYWRkcmVzc19jZWxscywg
dWludDMyX3Qgc2l6ZV9jZWxscykKK3sKKyAgICBjb25zdCBfX2JlMzIgKmNlbGw7CisgICAgdW5z
aWduZWQgaW50IGksIGxlbjsKKyAgICBzdHJ1Y3QgZHRfZGV2aWNlX25vZGUgKm5vZGU7CisgICAg
aW50IHJlczsKKyAgICBwYWRkcl90IG1zdGFydCwgc2l6ZSwgZ3N0YXJ0OworCisgICAgLyogeGVu
LHJlZyBzcGVjaWZpZXMgd2hlcmUgdG8gbWFwIHRoZSBNTUlPIHJlZ2lvbiAqLworICAgIGNlbGwg
PSAoY29uc3QgX19iZTMyICopeGVuX3JlZy0+ZGF0YTsKKyAgICBsZW4gPSBmZHQzMl90b19jcHUo
eGVuX3JlZy0+bGVuKSAvCisgICAgICAgICAgKChhZGRyZXNzX2NlbGxzICogMiArIHNpemVfY2Vs
bHMpICogc2l6ZW9mKHVpbnQzMl90KSk7CisKKyAgICBmb3IgKCBpID0gMDsgaSA8IGxlbjsgaSsr
ICkKKyAgICB7CisgICAgICAgIGRldmljZV90cmVlX2dldF9yZWcoJmNlbGwsIGFkZHJlc3NfY2Vs
bHMsIHNpemVfY2VsbHMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgJm1zdGFydCwgJnNp
emUpOworICAgICAgICBnc3RhcnQgPSBkdF9uZXh0X2NlbGwoYWRkcmVzc19jZWxscywgJmNlbGwp
OworCisgICAgICAgIGlmICggZ3N0YXJ0ICYgflBBR0VfTUFTSyB8fCBtc3RhcnQgJiB+UEFHRV9N
QVNLIHx8IHNpemUgJiB+UEFHRV9NQVNLICkKKyAgICAgICAgeworICAgICAgICAgICAgcHJpbnRr
KFhFTkxPR19FUlIKKyAgICAgICAgICAgICAgICAgICAgIkRvbVUgcGFzc3Rocm91Z2ggY29uZmln
IGhhcyBub3QgcGFnZSBhbGlnbmVkIGFkZHJlc3Nlcy9zaXplc1xuIik7CisgICAgICAgICAgICBy
ZXR1cm4gLUVJTlZBTDsKKyAgICAgICAgfQorCisgICAgICAgIHJlcyA9IG1hcF9yZWdpb25zX3Ay
bXQoa2luZm8tPmQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FkZHJfdG9fZ2Zu
KGdzdGFydCksCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUEZOX0RPV04oc2l6ZSks
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFkZHJfdG9fbWZuKG1zdGFydCksCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcDJtX21taW9fZGlyZWN0X2Rldik7CisgICAg
ICAgIGlmICggcmVzIDwgMCApCisgICAgICAgIHsKKyAgICAgICAgICAgIHByaW50ayhYRU5MT0df
RVJSCisgICAgICAgICAgICAgICAgICAgIkZhaWxlZCB0byBtYXAgJSJQUklwYWRkciIgdG8gdGhl
IGd1ZXN0IGF0JSJQUklwYWRkciJcbiIsCisgICAgICAgICAgICAgICAgICAgbXN0YXJ0LCBnc3Rh
cnQpOworICAgICAgICAgICAgcmV0dXJuIC1FRkFVTFQ7CisgICAgICAgIH0KKyAgICB9CisKKyAg
ICAvKgorICAgICAqIElmIHhlbl9mb3JjZSwgd2UgbGV0IHRoZSB1c2VyIGFzc2lnbiBhIE1NSU8g
cmVnaW9uIHdpdGggbm8KKyAgICAgKiBhc3NvY2lhdGVkIHBhdGguCisgICAgICovCisgICAgaWYg
KCB4ZW5fcGF0aCA9PSBOVUxMICkKKyAgICAgICAgcmV0dXJuIHhlbl9mb3JjZSA/IDAgOiAtRUlO
VkFMOworCisgICAgLyoKKyAgICAgKiB4ZW4scGF0aCBzcGVjaWZpZXMgdGhlIGNvcnJlc3BvbmRp
bmcgbm9kZSBpbiB0aGUgaG9zdCBEVC4KKyAgICAgKiBCb3RoIGludGVycnVwdCBtYXBwaW5ncyBh
bmQgSU9NTVUgc2V0dGluZ3MgYXJlIGJhc2VkIG9uIGl0LAorICAgICAqIGFzIHRoZXkgYXJlIGRv
bmUgYmFzZWQgb24gdGhlIGNvcnJlc3BvbmRpbmcgaG9zdCBEVCBub2RlLgorICAgICAqLworICAg
IG5vZGUgPSBkdF9maW5kX25vZGVfYnlfcGF0aCh4ZW5fcGF0aC0+ZGF0YSk7CisgICAgaWYgKCBu
b2RlID09IE5VTEwgKQorICAgIHsKKyAgICAgICAgcHJpbnRrKFhFTkxPR19FUlIgIkNvdWxkbid0
IGZpbmQgbm9kZSAlcyBpbiBob3N0X2R0IVxuIiwKKyAgICAgICAgICAgICAgIChjaGFyICopeGVu
X3BhdGgtPmRhdGEpOworICAgICAgICByZXR1cm4gLUVJTlZBTDsKKyAgICB9CisKKyAgICByZXMg
PSBoYW5kbGVfZGV2aWNlX2ludGVycnVwdHMoa2luZm8tPmQsIG5vZGUsIHRydWUpOworICAgIGlm
ICggcmVzIDwgMCApCisgICAgICAgIHJldHVybiByZXM7CisKKyAgICAvKiBJZiB4ZW5fZm9yY2Us
IHdlIGlnbm9yZSBJT01NVSBmYWlsdXJlcy4gKi8KKyAgICByZXMgPSBpb21tdV9hZGRfZHRfZGV2
aWNlKG5vZGUpOworICAgIGlmICggcmVzIDwgMCApCisgICAgICAgIHJldHVybiB4ZW5fZm9yY2Ug
PyAwIDogLUVJTlZBTDsKKworICAgIHJlcyA9IGlvbW11X2Fzc2lnbl9kdF9kZXZpY2Uoa2luZm8t
PmQsIG5vZGUpOworICAgIHJldHVybiByZXM7Cit9CisKIHN0YXRpYyBpbnQgX19pbml0IGhhbmRs
ZV9wcm9wX3BmZHQoc3RydWN0IGtlcm5lbF9pbmZvICpraW5mbywKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgY29uc3Qgdm9pZCAqcGZkdCwgaW50IG5vZGVvZmYsCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90IGFkZHJlc3NfY2VsbHMsIHVpbnQz
Ml90IHNpemVfY2VsbHMsCkBAIC0xNzIxLDcgKzE4MDMsOSBAQCBzdGF0aWMgaW50IF9faW5pdCBo
YW5kbGVfcHJvcF9wZmR0KHN0cnVjdCBrZXJuZWxfaW5mbyAqa2luZm8sCiB7CiAgICAgdm9pZCAq
ZmR0ID0ga2luZm8tPmZkdDsKICAgICBpbnQgcHJvcG9mZiwgbmFtZW9mZiwgcmVzOwotICAgIGNv
bnN0IHN0cnVjdCBmZHRfcHJvcGVydHkgKnByb3A7CisgICAgY29uc3Qgc3RydWN0IGZkdF9wcm9w
ZXJ0eSAqcHJvcCwgKnhlbl9yZWcgPSBOVUxMLCAqeGVuX3BhdGggPSBOVUxMOworICAgIGNvbnN0
IGNoYXIgKm5hbWU7CisgICAgYm9vbCBmb3VuZCwgeGVuX2ZvcmNlID0gZmFsc2U7CiAKICAgICBm
b3IgKCBwcm9wb2ZmID0gZmR0X2ZpcnN0X3Byb3BlcnR5X29mZnNldChwZmR0LCBub2Rlb2ZmKTsK
ICAgICAgICAgICBwcm9wb2ZmID49IDA7CkBAIC0xNzMwLDEwICsxODE0LDQ4IEBAIHN0YXRpYyBp
bnQgX19pbml0IGhhbmRsZV9wcm9wX3BmZHQoc3RydWN0IGtlcm5lbF9pbmZvICpraW5mbywKICAg
ICAgICAgaWYgKCAhKHByb3AgPSBmZHRfZ2V0X3Byb3BlcnR5X2J5X29mZnNldChwZmR0LCBwcm9w
b2ZmLCBOVUxMKSkgKQogICAgICAgICAgICAgcmV0dXJuIC1GRFRfRVJSX0lOVEVSTkFMOwogCisg
ICAgICAgIGZvdW5kID0gZmFsc2U7CiAgICAgICAgIG5hbWVvZmYgPSBmZHQzMl90b19jcHUocHJv
cC0+bmFtZW9mZik7Ci0gICAgICAgIHJlcyA9IGZkdF9wcm9wZXJ0eShmZHQsIGZkdF9zdHJpbmco
cGZkdCwgbmFtZW9mZiksCi0gICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wLT5kYXRhLCBm
ZHQzMl90b19jcHUocHJvcC0+bGVuKSk7Ci0gICAgICAgIGlmICggcmVzICkKKyAgICAgICAgbmFt
ZSA9IGZkdF9zdHJpbmcocGZkdCwgbmFtZW9mZik7CisKKyAgICAgICAgaWYgKCBzY2FuX3Bhc3N0
aHJvdWdoX3Byb3AgKQorICAgICAgICB7CisgICAgICAgICAgICBpZiAoIGR0X3Byb3BfY21wKCJ4
ZW4scmVnIiwgbmFtZSkgPT0gMCApCisgICAgICAgICAgICB7CisgICAgICAgICAgICAgICAgeGVu
X3JlZyA9IHByb3A7CisgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOworICAgICAgICAgICAg
fQorICAgICAgICAgICAgZWxzZSBpZiAoIGR0X3Byb3BfY21wKCJ4ZW4scGF0aCIsIG5hbWUpID09
IDAgKQorICAgICAgICAgICAgeworICAgICAgICAgICAgICAgIHhlbl9wYXRoID0gcHJvcDsKKyAg
ICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CisgICAgICAgICAgICB9CisgICAgICAgICAgICBl
bHNlIGlmICggZHRfcHJvcF9jbXAoInhlbixmb3JjZS1hc3NpZ24td2l0aG91dC1pb21tdSIsCisg
ICAgICAgICAgICAgICAgICAgICAgbmFtZSkgPT0gMCApCisgICAgICAgICAgICB7CisgICAgICAg
ICAgICAgICAgeGVuX2ZvcmNlID0gdHJ1ZTsKKyAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7
CisgICAgICAgICAgICB9CisgICAgICAgIH0KKworICAgICAgICAvKiBDb3B5IGFsbCBvdGhlciBw
cm9wZXJ0aWVzICovCisgICAgICAgIGlmICggIWZvdW5kICkKKyAgICAgICAgeworICAgICAgICAg
ICAgcmVzID0gZmR0X3Byb3BlcnR5KGZkdCwgbmFtZSwgcHJvcC0+ZGF0YSwgZmR0MzJfdG9fY3B1
KHByb3AtPmxlbikpOworICAgICAgICAgICAgaWYgKCByZXMgKQorICAgICAgICAgICAgICAgIHJl
dHVybiByZXM7CisgICAgICAgIH0KKyAgICB9CisKKyAgICAvKgorICAgICAqIE9ubHkgaGFuZGxl
IHBhc3N0aHJvdWdoIHByb3BlcnRpZXMgaWYgYm90aCB4ZW4scmVnIGFuZCB4ZW4scGF0aAorICAg
ICAqIGFyZSBwcmVzZW50LCBvciBpZiB4ZW4sZm9yY2UtYXNzaWduLXdpdGhvdXQtaW9tbXUgaXMg
c3BlY2lmaWVkLgorICAgICAqLworICAgIGlmICggeGVuX3JlZyAhPSBOVUxMICYmICh4ZW5fcGF0
aCAhPSBOVUxMIHx8IHhlbl9mb3JjZSkgKQorICAgIHsKKyAgICAgICAgcmVzID0gaGFuZGxlX3Bh
c3N0aHJvdWdoX3Byb3Aoa2luZm8sIHhlbl9yZWcsIHhlbl9wYXRoLCB4ZW5fZm9yY2UsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3NfY2VsbHMsIHNpemVfY2Vs
bHMpOworICAgICAgICBpZiAoIHJlcyA8IDAgKQogICAgICAgICAgICAgcmV0dXJuIHJlczsKICAg
ICB9CiAKQEAgLTIyOTEsNiArMjQxMyw5IEBAIHZvaWQgX19pbml0IGNyZWF0ZV9kb21Vcyh2b2lk
KQogICAgICAgICAgICAgcGFuaWMoIk1pc3NpbmcgcHJvcGVydHkgJ2NwdXMnIGZvciBkb21haW4g
JXNcbiIsCiAgICAgICAgICAgICAgICAgICBkdF9ub2RlX25hbWUobm9kZSkpOwogCisgICAgICAg
IGlmICggZHRfZmluZF9jb21wYXRpYmxlX25vZGUobm9kZSwgTlVMTCwgIm11bHRpYm9vdCxkZXZp
Y2UtdHJlZSIpICkKKyAgICAgICAgICAgIGRfY2ZnLmZsYWdzIHw9IFhFTl9ET01DVExfQ0RGX2lv
bW11OworCiAgICAgICAgIGQgPSBkb21haW5fY3JlYXRlKCsrbWF4X2luaXRfZG9taWQsICZkX2Nm
ZywgZmFsc2UpOwogICAgICAgICBpZiAoIElTX0VSUihkKSApCiAgICAgICAgICAgICBwYW5pYygi
RXJyb3IgY3JlYXRpbmcgZG9tYWluICVzXG4iLCBkdF9ub2RlX25hbWUobm9kZSkpOwotLSAKMi4x
Ny4xCgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVu
LWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6
Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 145981438A2
	for <lists+xen-devel@lfdr.de>; Tue, 21 Jan 2020 09:46:49 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1itp8n-0004dm-3o; Tue, 21 Jan 2020 08:44:05 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=4mp0=3K=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1itp8m-0004dR-6C
 for xen-devel@lists.xenproject.org; Tue, 21 Jan 2020 08:44:04 +0000
X-Inumbo-ID: 1ed01392-3c2a-11ea-ba47-12813bfff9fa
Received: from mx2.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 1ed01392-3c2a-11ea-ba47-12813bfff9fa;
 Tue, 21 Jan 2020 08:43:39 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx2.suse.de (Postfix) with ESMTP id 4143CB2BD;
 Tue, 21 Jan 2020 08:43:34 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Tue, 21 Jan 2020 09:43:25 +0100
Message-Id: <20200121084330.18309-5-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20200121084330.18309-1-jgross@suse.com>
References: <20200121084330.18309-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v3 4/9] xen: add basic hypervisor filesystem
 support
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Julien Grall <julien@xen.org>,
 Wei Liu <wl@xen.org>, Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Jan Beulich <jbeulich@suse.com>,
 Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

QWRkIHRoZSBpbmZyYXN0cnVjdHVyZSBmb3IgdGhlIGh5cGVydmlzb3IgZmlsZXN5c3RlbS4KClRo
aXMgaW5jbHVkZXMgdGhlIGh5cGVyY2FsbCBpbnRlcmZhY2UgYW5kIHRoZSBiYXNlIGZ1bmN0aW9u
cyBmb3IKZW50cnkgY3JlYXRpb24sIGRlbGV0aW9uIGFuZCBtb2RpZmljYXRpb24uCgpTaWduZWQt
b2ZmLWJ5OiBKdWVyZ2VuIEdyb3NzIDxqZ3Jvc3NAc3VzZS5jb20+Ci0tLQpWMToKLSByZW5hbWUg
ZmlsZXMgZnJvbSBmaWxlc3lzdGVtLiogdG8gaHlwZnMuKgotIGFkZCBkdW1teSB3cml0ZSBlbnRy
eSBzdXBwb3J0Ci0gcmVuYW1lIGh5cGVyY2FsbCBmaWxlc3lzdGVtX29wIHRvIGh5cGZzX29wCi0g
YWRkIHN1cHBvcnQgZm9yIHVuc2lnbmVkIGludGVnZXIgZW50cmllcwoKVjI6Ci0gdGVzdCBuZXcg
ZW50cnkgbmFtZSB0byBiZSB2YWxpZAoKVjM6Ci0gbWFqb3IgcmV3b3JrLCBlc3BlY2lhbGx5IGJ5
IHN1cHBvcnRpbmcgYmluYXJ5IGNvbnRlbnRzIG9mIGVudHJpZXMKLSBhZGRyZXNzZWQgYWxsIGNv
bW1lbnRzCi0tLQogeGVuL2FyY2gvYXJtL3RyYXBzLmMgICAgICAgICB8ICAgMSArCiB4ZW4vYXJj
aC94ODYvaHZtL2h5cGVyY2FsbC5jIHwgICAxICsKIHhlbi9hcmNoL3g4Ni9oeXBlcmNhbGwuYyAg
ICAgfCAgIDEgKwogeGVuL2FyY2gveDg2L3B2L2h5cGVyY2FsbC5jICB8ICAgMSArCiB4ZW4vY29t
bW9uL01ha2VmaWxlICAgICAgICAgIHwgICAxICsKIHhlbi9jb21tb24vaHlwZnMuYyAgICAgICAg
ICAgfCAzNjUgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwogeGVu
L2luY2x1ZGUvcHVibGljL2h5cGZzLmggICB8IDEyNCArKysrKysrKysrKysrKysKIHhlbi9pbmNs
dWRlL3B1YmxpYy94ZW4uaCAgICAgfCAgIDEgKwogeGVuL2luY2x1ZGUveGVuL2h5cGVyY2FsbC5o
ICB8ICAgOCArCiB4ZW4vaW5jbHVkZS94ZW4vaHlwZnMuaCAgICAgIHwgIDg5ICsrKysrKysrKysr
CiAxMCBmaWxlcyBjaGFuZ2VkLCA1OTIgaW5zZXJ0aW9ucygrKQogY3JlYXRlIG1vZGUgMTAwNjQ0
IHhlbi9jb21tb24vaHlwZnMuYwogY3JlYXRlIG1vZGUgMTAwNjQ0IHhlbi9pbmNsdWRlL3B1Ymxp
Yy9oeXBmcy5oCiBjcmVhdGUgbW9kZSAxMDA2NDQgeGVuL2luY2x1ZGUveGVuL2h5cGZzLmgKCmRp
ZmYgLS1naXQgYS94ZW4vYXJjaC9hcm0vdHJhcHMuYyBiL3hlbi9hcmNoL2FybS90cmFwcy5jCmlu
ZGV4IDZmOWJlYzIyZDMuLjg3YWY4MTA2NjcgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL2FybS90cmFw
cy5jCisrKyBiL3hlbi9hcmNoL2FybS90cmFwcy5jCkBAIC0xMzgyLDYgKzEzODIsNyBAQCBzdGF0
aWMgYXJtX2h5cGVyY2FsbF90IGFybV9oeXBlcmNhbGxfdGFibGVbXSA9IHsKICNpZmRlZiBDT05G
SUdfQVJHTwogICAgIEhZUEVSQ0FMTChhcmdvX29wLCA1KSwKICNlbmRpZgorICAgIEhZUEVSQ0FM
TChoeXBmc19vcCwgNSksCiB9OwogCiAjaWZuZGVmIE5ERUJVRwpkaWZmIC0tZ2l0IGEveGVuL2Fy
Y2gveDg2L2h2bS9oeXBlcmNhbGwuYyBiL3hlbi9hcmNoL3g4Ni9odm0vaHlwZXJjYWxsLmMKaW5k
ZXggMzNkZDJkOTlkMi4uMjEwZGRhNGYzOCAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L2h2bS9o
eXBlcmNhbGwuYworKysgYi94ZW4vYXJjaC94ODYvaHZtL2h5cGVyY2FsbC5jCkBAIC0xNDQsNiAr
MTQ0LDcgQEAgc3RhdGljIGNvbnN0IGh5cGVyY2FsbF90YWJsZV90IGh2bV9oeXBlcmNhbGxfdGFi
bGVbXSA9IHsKICNlbmRpZgogICAgIEhZUEVSQ0FMTCh4ZW5wbXVfb3ApLAogICAgIENPTVBBVF9D
QUxMKGRtX29wKSwKKyAgICBIWVBFUkNBTEwoaHlwZnNfb3ApLAogICAgIEhZUEVSQ0FMTChhcmNo
XzEpCiB9OwogCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvaHlwZXJjYWxsLmMgYi94ZW4vYXJj
aC94ODYvaHlwZXJjYWxsLmMKaW5kZXggN2YyOTlkNDVjNi4uMDVhM2Y1ZTI1YiAxMDA2NDQKLS0t
IGEveGVuL2FyY2gveDg2L2h5cGVyY2FsbC5jCisrKyBiL3hlbi9hcmNoL3g4Ni9oeXBlcmNhbGwu
YwpAQCAtNzMsNiArNzMsNyBAQCBjb25zdCBoeXBlcmNhbGxfYXJnc190IGh5cGVyY2FsbF9hcmdz
X3RhYmxlW05SX2h5cGVyY2FsbHNdID0KICAgICBBUkdTKGh2bV9vcCwgMiksCiAgICAgQVJHUyhk
bV9vcCwgMyksCiAjZW5kaWYKKyAgICBBUkdTKGh5cGZzX29wLCA1KSwKICAgICBBUkdTKG1jYSwg
MSksCiAgICAgQVJHUyhhcmNoXzEsIDEpLAogfTsKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9w
di9oeXBlcmNhbGwuYyBiL3hlbi9hcmNoL3g4Ni9wdi9oeXBlcmNhbGwuYwppbmRleCAxN2RkZjll
YTFmLi44MzkwN2Q0ZjAwIDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYvcHYvaHlwZXJjYWxsLmMK
KysrIGIveGVuL2FyY2gveDg2L3B2L2h5cGVyY2FsbC5jCkBAIC04NSw2ICs4NSw3IEBAIGNvbnN0
IGh5cGVyY2FsbF90YWJsZV90IHB2X2h5cGVyY2FsbF90YWJsZVtdID0gewogICAgIEhZUEVSQ0FM
TChodm1fb3ApLAogICAgIENPTVBBVF9DQUxMKGRtX29wKSwKICNlbmRpZgorICAgIEhZUEVSQ0FM
TChoeXBmc19vcCksCiAgICAgSFlQRVJDQUxMKG1jYSksCiAgICAgSFlQRVJDQUxMKGFyY2hfMSks
CiB9OwpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9NYWtlZmlsZSBiL3hlbi9jb21tb24vTWFrZWZp
bGUKaW5kZXggNjJiMzRlNjllOS4uYTNmNjZhYTBjMCAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9N
YWtlZmlsZQorKysgYi94ZW4vY29tbW9uL01ha2VmaWxlCkBAIC0xMSw2ICsxMSw3IEBAIG9iai15
ICs9IGRvbWFpbi5vCiBvYmoteSArPSBldmVudF8ybC5vCiBvYmoteSArPSBldmVudF9jaGFubmVs
Lm8KIG9iai15ICs9IGV2ZW50X2ZpZm8ubworb2JqLXkgKz0gaHlwZnMubwogb2JqLSQoQ09ORklH
X0NSQVNIX0RFQlVHKSArPSBnZGJzdHViLm8KIG9iai0kKENPTkZJR19HUkFOVF9UQUJMRSkgKz0g
Z3JhbnRfdGFibGUubwogb2JqLXkgKz0gZ3Vlc3Rjb3B5Lm8KZGlmZiAtLWdpdCBhL3hlbi9jb21t
b24vaHlwZnMuYyBiL3hlbi9jb21tb24vaHlwZnMuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRl
eCAwMDAwMDAwMDAwLi42NzYyZDIwZGZkCi0tLSAvZGV2L251bGwKKysrIGIveGVuL2NvbW1vbi9o
eXBmcy5jCkBAIC0wLDAgKzEsMzY1IEBACisvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCisgKgorICog
aHlwZnMuYworICoKKyAqIFNpbXBsZSBzeXNmcy1saWtlIGZpbGUgc3lzdGVtIGZvciB0aGUgaHlw
ZXJ2aXNvci4KKyAqLworCisjaW5jbHVkZSA8eGVuL2xpYi5oPgorI2luY2x1ZGUgPHhlbi9lcnIu
aD4KKyNpbmNsdWRlIDx4ZW4vZ3Vlc3RfYWNjZXNzLmg+CisjaW5jbHVkZSA8eGVuL2h5cGVyY2Fs
bC5oPgorI2luY2x1ZGUgPHhlbi9oeXBmcy5oPgorI2luY2x1ZGUgPHhlbi9yd2xvY2suaD4KKyNp
bmNsdWRlIDxwdWJsaWMvaHlwZnMuaD4KKworI2RlZmluZSBESVJFTlRSWV9OQU1FX09GRiBvZmZz
ZXRvZihzdHJ1Y3QgeGVuX2h5cGZzX2Rpcmxpc3RlbnRyeSwgbmFtZSkKKyNkZWZpbmUgRElSRU5U
UllfU0laRShuYW1lX2xlbikgXAorICAgIChESVJFTlRSWV9OQU1FX09GRiArIFJPVU5EVVAobmFt
ZV9sZW4sIGFsaWdub2Yoc3RydWN0IHhlbl9oeXBmc19kaXJlbnRyeSkpKQorCitzdGF0aWMgREVG
SU5FX1JXTE9DSyhoeXBmc19sb2NrKTsKKworSFlQRlNfRElSX0lOSVQoaHlwZnNfcm9vdCwgIiIp
OworCitzdGF0aWMgaW50IGFkZF9lbnRyeShzdHJ1Y3QgaHlwZnNfZW50cnlfZGlyICpwYXJlbnQs
IHN0cnVjdCBoeXBmc19lbnRyeSAqbmV3KQoreworICAgIGludCByZXQgPSAtRU5PRU5UOworICAg
IHN0cnVjdCBoeXBmc19lbnRyeSAqZTsKKworICAgIHdyaXRlX2xvY2soJmh5cGZzX2xvY2spOwor
CisgICAgbGlzdF9mb3JfZWFjaF9lbnRyeSAoIGUsICZwYXJlbnQtPmRpcmxpc3QsIGxpc3QgKQor
ICAgIHsKKyAgICAgICAgaW50IGNtcCA9IHN0cmNtcChlLT5uYW1lLCBuZXctPm5hbWUpOworCisg
ICAgICAgIGlmICggY21wID4gMCApCisgICAgICAgIHsKKyAgICAgICAgICAgIHJldCA9IDA7Cisg
ICAgICAgICAgICBsaXN0X2FkZF90YWlsKCZuZXctPmxpc3QsICZlLT5saXN0KTsKKyAgICAgICAg
ICAgIGJyZWFrOworICAgICAgICB9CisgICAgICAgIGlmICggY21wID09IDAgKQorICAgICAgICB7
CisgICAgICAgICAgICByZXQgPSAtRUVYSVNUOworICAgICAgICAgICAgYnJlYWs7CisgICAgICAg
IH0KKyAgICB9CisKKyAgICBpZiAoIHJldCA9PSAtRU5PRU5UICkKKyAgICB7CisgICAgICAgIHJl
dCA9IDA7CisgICAgICAgIGxpc3RfYWRkX3RhaWwoJm5ldy0+bGlzdCwgJnBhcmVudC0+ZGlybGlz
dCk7CisgICAgfQorCisgICAgaWYgKCAhcmV0ICkKKyAgICB7CisgICAgICAgIHVuc2lnbmVkIGlu
dCBzeiA9IHN0cmxlbihuZXctPm5hbWUpICsgMTsKKworICAgICAgICBwYXJlbnQtPmUuc2l6ZSAr
PSBESVJFTlRSWV9TSVpFKHN6KTsKKyAgICB9CisKKyAgICB3cml0ZV91bmxvY2soJmh5cGZzX2xv
Y2spOworCisgICAgcmV0dXJuIHJldDsKK30KKworaW50IGh5cGZzX2FkZF9lbnRyeShzdHJ1Y3Qg
aHlwZnNfZW50cnlfZGlyICpwYXJlbnQsCisgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBoeXBm
c19lbnRyeSAqZW50cnksIGJvb2wgbm9mYXVsdCkKK3sKKyAgICBpbnQgcmV0OworCisgICAgcmV0
ID0gYWRkX2VudHJ5KHBhcmVudCwgZW50cnkpOworICAgIEJVR19PTihub2ZhdWx0ICYmIHJldCk7
CisKKyAgICByZXR1cm4gcmV0OworfQorCitpbnQgaHlwZnNfYWRkX2RpcihzdHJ1Y3QgaHlwZnNf
ZW50cnlfZGlyICpwYXJlbnQsCisgICAgICAgICAgICAgICAgICBzdHJ1Y3QgaHlwZnNfZW50cnlf
ZGlyICpkaXIsIGJvb2wgbm9mYXVsdCkKK3sKKyAgICBpbnQgcmV0OworCisgICAgcmV0ID0gYWRk
X2VudHJ5KHBhcmVudCwgJmRpci0+ZSk7CisgICAgQlVHX09OKG5vZmF1bHQgJiYgcmV0KTsKKwor
ICAgIHJldHVybiByZXQ7Cit9CisKK2ludCBoeXBmc19hZGRfbGVhZihzdHJ1Y3QgaHlwZnNfZW50
cnlfZGlyICpwYXJlbnQsCisgICAgICAgICAgICAgICAgICAgc3RydWN0IGh5cGZzX2VudHJ5X2xl
YWYgKmxlYWYsIGJvb2wgbm9mYXVsdCkKK3sKKyAgICBpbnQgcmV0OworCisgICAgaWYgKCAhbGVh
Zi0+Y29udGVudCApCisgICAgICAgIHJldCA9IC1FSU5WQUw7CisgICAgZWxzZQorICAgICAgICBy
ZXQgPSBhZGRfZW50cnkocGFyZW50LCAmbGVhZi0+ZSk7CisgICAgQlVHX09OKG5vZmF1bHQgJiYg
cmV0KTsKKworICAgIHJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBpbnQgaHlwZnNfZ2V0X3BhdGhf
dXNlcihjaGFyICpidWYsIFhFTl9HVUVTVF9IQU5ETEVfUEFSQU0odm9pZCkgdWFkZHIsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgbG9uZyBsZW4pCit7CisgICAgaWYg
KCBsZW4gPiBYRU5fSFlQRlNfTUFYX1BBVEhMRU4gKQorICAgICAgICByZXR1cm4gLUVJTlZBTDsK
KworICAgIGlmICggY29weV9mcm9tX2d1ZXN0KGJ1ZiwgdWFkZHIsIGxlbikgKQorICAgICAgICBy
ZXR1cm4gLUVGQVVMVDsKKworICAgIGlmICggYnVmW2xlbiAtIDFdICkKKyAgICAgICAgcmV0dXJu
IC1FSU5WQUw7CisKKyAgICByZXR1cm4gMDsKK30KKworc3RhdGljIHN0cnVjdCBoeXBmc19lbnRy
eSAqaHlwZnNfZ2V0X2VudHJ5X3JlbChzdHJ1Y3QgaHlwZnNfZW50cnlfZGlyICpkaXIsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoYXIgKnBh
dGgpCit7CisgICAgY29uc3QgY2hhciAqZW5kOworICAgIHN0cnVjdCBoeXBmc19lbnRyeSAqZW50
cnk7CisgICAgdW5zaWduZWQgaW50IG5hbWVfbGVuOworCisgICAgaWYgKCAhKnBhdGggKQorICAg
ICAgICByZXR1cm4gJmRpci0+ZTsKKworICAgIGlmICggZGlyLT5lLnR5cGUgIT0gWEVOX0hZUEZT
X1RZUEVfRElSICkKKyAgICAgICAgcmV0dXJuIE5VTEw7CisKKyAgICBlbmQgPSBzdHJjaHIocGF0
aCwgJy8nKTsKKyAgICBpZiAoICFlbmQgKQorICAgICAgICBlbmQgPSBzdHJjaHIocGF0aCwgJ1ww
Jyk7CisgICAgbmFtZV9sZW4gPSBlbmQgLSBwYXRoOworCisgICAgbGlzdF9mb3JfZWFjaF9lbnRy
eSAoIGVudHJ5LCAmZGlyLT5kaXJsaXN0LCBsaXN0ICkKKyAgICB7CisgICAgICAgIGludCBjbXAg
PSBzdHJuY21wKHBhdGgsIGVudHJ5LT5uYW1lLCBuYW1lX2xlbik7CisJc3RydWN0IGh5cGZzX2Vu
dHJ5X2RpciAqZCA9IGNvbnRhaW5lcl9vZihlbnRyeSwKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgaHlwZnNfZW50cnlfZGlyLCBlKTsKKwor
ICAgICAgICBpZiAoIGNtcCA8IDAgKQorICAgICAgICAgICAgcmV0dXJuIE5VTEw7CisgICAgICAg
IGlmICggIWNtcCAmJiBzdHJsZW4oZW50cnktPm5hbWUpID09IG5hbWVfbGVuICkKKyAgICAgICAg
ICAgIHJldHVybiAqZW5kID8gaHlwZnNfZ2V0X2VudHJ5X3JlbChkLCBlbmQgKyAxKSA6IGVudHJ5
OworICAgIH0KKworICAgIHJldHVybiBOVUxMOworfQorCitzdHJ1Y3QgaHlwZnNfZW50cnkgKmh5
cGZzX2dldF9lbnRyeShjb25zdCBjaGFyICpwYXRoKQoreworICAgIGlmICggcGF0aFswXSAhPSAn
LycgKQorICAgICAgICByZXR1cm4gTlVMTDsKKworICAgIHJldHVybiBoeXBmc19nZXRfZW50cnlf
cmVsKCZoeXBmc19yb290LCBwYXRoICsgMSk7Cit9CisKK2ludCBoeXBmc19yZWFkX2Rpcihjb25z
dCBzdHJ1Y3QgaHlwZnNfZW50cnkgKmVudHJ5LAorICAgICAgICAgICAgICAgICAgIFhFTl9HVUVT
VF9IQU5ETEVfUEFSQU0odm9pZCkgdWFkZHIpCit7CisgICAgY29uc3Qgc3RydWN0IGh5cGZzX2Vu
dHJ5X2RpciAqZDsKKyAgICBzdHJ1Y3QgaHlwZnNfZW50cnkgKmU7CisgICAgdW5zaWduZWQgaW50
IHNpemUgPSBlbnRyeS0+c2l6ZTsKKworICAgIGQgPSBjb250YWluZXJfb2YoZW50cnksIGNvbnN0
IHN0cnVjdCBoeXBmc19lbnRyeV9kaXIsIGUpOworCisgICAgbGlzdF9mb3JfZWFjaF9lbnRyeSAo
IGUsICZkLT5kaXJsaXN0LCBsaXN0ICkKKyAgICB7CisgICAgICAgIHN0cnVjdCB4ZW5faHlwZnNf
ZGlybGlzdGVudHJ5IGRpcmVudHJ5OworICAgICAgICB1bnNpZ25lZCBpbnQgZV9uYW1lbGVuID0g
c3RybGVuKGUtPm5hbWUpICsgMTsKKyAgICAgICAgdW5zaWduZWQgaW50IGVfbGVuID0gRElSRU5U
UllfU0laRShlX25hbWVsZW4pOworCisgICAgICAgIGRpcmVudHJ5LmUuZmxhZ3MgPSBlLT53cml0
ZSA/IFhFTl9IWVBGU19XUklURUFCTEUgOiAwOworICAgICAgICBkaXJlbnRyeS5lLnR5cGUgPSBl
LT50eXBlOworICAgICAgICBkaXJlbnRyeS5lLmVuY29kaW5nID0gZS0+ZW5jb2Rpbmc7CisgICAg
ICAgIGRpcmVudHJ5LmUuY29udGVudF9sZW4gPSBlLT5zaXplOworICAgICAgICBkaXJlbnRyeS5v
ZmZfbmV4dCA9IGxpc3RfaXNfbGFzdCgmZS0+bGlzdCwgJmQtPmRpcmxpc3QpID8gMCA6IGVfbGVu
OworICAgICAgICBpZiAoIGNvcHlfdG9fZ3Vlc3QodWFkZHIsICZkaXJlbnRyeSwgMSkgKQorICAg
ICAgICAgICAgcmV0dXJuIC1FRkFVTFQ7CisKKyAgICAgICAgaWYgKCBjb3B5X3RvX2d1ZXN0X29m
ZnNldCh1YWRkciwgRElSRU5UUllfTkFNRV9PRkYsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgZS0+bmFtZSwgZV9uYW1lbGVuKSApCisgICAgICAgICAgICByZXR1cm4gLUVGQVVM
VDsKKworICAgICAgICBndWVzdF9oYW5kbGVfYWRkX29mZnNldCh1YWRkciwgZV9sZW4pOworCisg
ICAgICAgIEFTU0VSVChlX2xlbiA8PSBzaXplKTsKKyAgICAgICAgc2l6ZSAtPSBlX2xlbjsKKyAg
ICB9CisKKyAgICByZXR1cm4gMDsKK30KKworaW50IGh5cGZzX3JlYWRfbGVhZihjb25zdCBzdHJ1
Y3QgaHlwZnNfZW50cnkgKmVudHJ5LAorICAgICAgICAgICAgICAgICAgICBYRU5fR1VFU1RfSEFO
RExFX1BBUkFNKHZvaWQpIHVhZGRyKQoreworICAgIGNvbnN0IHN0cnVjdCBoeXBmc19lbnRyeV9s
ZWFmICpsOworCisgICAgbCA9IGNvbnRhaW5lcl9vZihlbnRyeSwgY29uc3Qgc3RydWN0IGh5cGZz
X2VudHJ5X2xlYWYsIGUpOworCisgICAgcmV0dXJuIGNvcHlfdG9fZ3Vlc3QodWFkZHIsIGwtPmNv
bnRlbnQsIGVudHJ5LT5zaXplKSA/IC1FRkFVTFQ6IDA7Cit9CisKK3N0YXRpYyBpbnQgaHlwZnNf
cmVhZChjb25zdCBzdHJ1Y3QgaHlwZnNfZW50cnkgKmVudHJ5LAorICAgICAgICAgICAgICAgICAg
ICAgIFhFTl9HVUVTVF9IQU5ETEVfUEFSQU0odm9pZCkgdWFkZHIsIHVuc2lnbmVkIGxvbmcgdWxl
bikKK3sKKyAgICBzdHJ1Y3QgeGVuX2h5cGZzX2RpcmVudHJ5IGU7CisgICAgbG9uZyByZXQgPSAt
RUlOVkFMOworCisgICAgaWYgKCB1bGVuIDwgc2l6ZW9mKGUpICkKKyAgICAgICAgZ290byBvdXQ7
CisKKyAgICBlLmZsYWdzID0gZW50cnktPndyaXRlID8gWEVOX0hZUEZTX1dSSVRFQUJMRSA6IDA7
CisgICAgZS50eXBlID0gZW50cnktPnR5cGU7CisgICAgZS5lbmNvZGluZyA9IGVudHJ5LT5lbmNv
ZGluZzsKKyAgICBlLmNvbnRlbnRfbGVuID0gZW50cnktPnNpemU7CisKKyAgICByZXQgPSAtRUZB
VUxUOworICAgIGlmICggY29weV90b19ndWVzdCh1YWRkciwgJmUsIDEpICkKKyAgICAgICAgZ290
byBvdXQ7CisKKyAgICByZXQgPSAwOworICAgIGlmICggdWxlbiA8IGVudHJ5LT5zaXplICsgc2l6
ZW9mKGUpICkKKyAgICAgICAgZ290byBvdXQ7CisKKyAgICBndWVzdF9oYW5kbGVfYWRkX29mZnNl
dCh1YWRkciwgc2l6ZW9mKGUpKTsKKworICAgIHJldCA9IGVudHJ5LT5yZWFkKGVudHJ5LCB1YWRk
cik7CisKKyBvdXQ6CisgICAgcmV0dXJuIHJldDsKK30KKworaW50IGh5cGZzX3dyaXRlX2xlYWYo
c3RydWN0IGh5cGZzX2VudHJ5X2xlYWYgKmxlYWYsCisgICAgICAgICAgICAgICAgICAgICBYRU5f
R1VFU1RfSEFORExFX1BBUkFNKHZvaWQpIHVhZGRyLCB1bnNpZ25lZCBsb25nIHVsZW4pCit7Cisg
ICAgY2hhciAqYnVmOworICAgIGludCByZXQ7CisKKyAgICBpZiAoIHVsZW4gPiBsZWFmLT5lLnNp
emUgKQorICAgICAgICB1bGVuID0gbGVhZi0+ZS5zaXplOworCisgICAgYnVmID0geHphbGxvY19h
cnJheShjaGFyLCB1bGVuKTsKKyAgICBpZiAoICFidWYgKQorICAgICAgICByZXR1cm4gLUVOT01F
TTsKKworICAgIHJldCA9IC1FRkFVTFQ7CisgICAgaWYgKCBjb3B5X2Zyb21fZ3Vlc3QoYnVmLCB1
YWRkciwgdWxlbikgKQorICAgICAgICBnb3RvIG91dDsKKworICAgIHJldCA9IDA7CisgICAgaWYg
KCBsZWFmLT5lLnR5cGUgPT0gWEVOX0hZUEZTX1RZUEVfU1RSSU5HICkKKyAgICAgICAgYnVmW2xl
YWYtPmUuc2l6ZSAtIDFdID0gMDsKKyAgICBtZW1jcHkobGVhZi0+d3JpdGVfcHRyLCBidWYsIHVs
ZW4pOworCisgb3V0OgorICAgIHhmcmVlKGJ1Zik7CisgICAgcmV0dXJuIHJldDsKK30KKworaW50
IGh5cGZzX3dyaXRlX2Jvb2woc3RydWN0IGh5cGZzX2VudHJ5X2xlYWYgKmxlYWYsCisgICAgICAg
ICAgICAgICAgICAgICBYRU5fR1VFU1RfSEFORExFX1BBUkFNKHZvaWQpIHVhZGRyLCB1bnNpZ25l
ZCBsb25nIHVsZW4pCit7CisgICAgdW5pb24geworICAgICAgICBjaGFyIGJ1Zls4XTsKKyAgICAg
ICAgdWludDhfdCB1ODsKKyAgICAgICAgdWludDE2X3QgdTE2OworICAgICAgICB1aW50MzJfdCB1
MzI7CisgICAgICAgIHVpbnQ2NF90IHU2NDsKKyAgICB9IHU7CisKKyAgICBBU1NFUlQobGVhZi0+
ZS50eXBlID09IFhFTl9IWVBGU19UWVBFX1VJTlQgJiYgbGVhZi0+ZS5zaXplIDw9IDgpOworCisg
ICAgaWYgKCB1bGVuICE9IGxlYWYtPmUuc2l6ZSApCisgICAgICAgIHJldHVybiAtRURPTTsKKwor
ICAgIGlmICggY29weV9mcm9tX2d1ZXN0KHUuYnVmLCB1YWRkciwgdWxlbikgKQorICAgICAgICBy
ZXR1cm4gLUVGQVVMVDsKKworICAgIHN3aXRjaCAoIGxlYWYtPmUuc2l6ZSApCisgICAgeworICAg
IGNhc2UgMToKKyAgICAgICAgKih1aW50OF90ICopbGVhZi0+d3JpdGVfcHRyID0gISF1LnU4Owor
ICAgICAgICBicmVhazsKKyAgICBjYXNlIDI6CisgICAgICAgICoodWludDE2X3QgKilsZWFmLT53
cml0ZV9wdHIgPSAhIXUudTE2OworICAgICAgICBicmVhazsKKyAgICBjYXNlIDQ6CisgICAgICAg
ICoodWludDMyX3QgKilsZWFmLT53cml0ZV9wdHIgPSAhIXUudTMyOworICAgICAgICBicmVhazsK
KyAgICBjYXNlIDg6CisgICAgICAgICoodWludDY0X3QgKilsZWFmLT53cml0ZV9wdHIgPSAhIXUu
dTY0OworICAgICAgICBicmVhazsKKyAgICB9CisKKyAgICByZXR1cm4gMDsKK30KKworc3RhdGlj
IGludCBoeXBmc193cml0ZShzdHJ1Y3QgaHlwZnNfZW50cnkgKmVudHJ5LAorICAgICAgICAgICAg
ICAgICAgICAgICBYRU5fR1VFU1RfSEFORExFX1BBUkFNKHZvaWQpIHVhZGRyLCB1bnNpZ25lZCBs
b25nIHVsZW4pCit7CisgICAgc3RydWN0IGh5cGZzX2VudHJ5X2xlYWYgKmw7CisKKyAgICBpZiAo
ICFlbnRyeS0+d3JpdGUgKQorICAgICAgICByZXR1cm4gLUVBQ0NFUzsKKworICAgIGwgPSBjb250
YWluZXJfb2YoZW50cnksIHN0cnVjdCBoeXBmc19lbnRyeV9sZWFmLCBlKTsKKworICAgIHJldHVy
biBlbnRyeS0+d3JpdGUobCwgdWFkZHIsIHVsZW4pOworfQorCitsb25nIGRvX2h5cGZzX29wKHVu
c2lnbmVkIGludCBjbWQsCisgICAgICAgICAgICAgICAgIFhFTl9HVUVTVF9IQU5ETEVfUEFSQU0o
dm9pZCkgYXJnMSwgdW5zaWduZWQgbG9uZyBhcmcyLAorICAgICAgICAgICAgICAgICBYRU5fR1VF
U1RfSEFORExFX1BBUkFNKHZvaWQpIGFyZzMsIHVuc2lnbmVkIGxvbmcgYXJnNCkKK3sKKyAgICBp
bnQgcmV0OworICAgIHN0cnVjdCBoeXBmc19lbnRyeSAqZW50cnk7CisgICAgc3RhdGljIGNoYXIg
cGF0aFtYRU5fSFlQRlNfTUFYX1BBVEhMRU5dOworCisgICAgaWYgKCAhaXNfY29udHJvbF9kb21h
aW4oY3VycmVudC0+ZG9tYWluKSAmJgorICAgICAgICAgIWlzX2hhcmR3YXJlX2RvbWFpbihjdXJy
ZW50LT5kb21haW4pICkKKyAgICAgICAgcmV0dXJuIC1FUEVSTTsKKworICAgIGlmICggY21kID09
IFhFTl9IWVBGU19PUF9nZXRfdmVyc2lvbiApCisgICAgICAgIHJldHVybiBYRU5fSFlQRlNfVkVS
U0lPTjsKKworICAgIGlmICggY21kID09IFhFTl9IWVBGU19PUF93cml0ZV9jb250ZW50cyApCisg
ICAgICAgIHdyaXRlX2xvY2soJmh5cGZzX2xvY2spOworICAgIGVsc2UKKyAgICAgICAgcmVhZF9s
b2NrKCZoeXBmc19sb2NrKTsKKworICAgIHJldCA9IGh5cGZzX2dldF9wYXRoX3VzZXIocGF0aCwg
YXJnMSwgYXJnMik7CisgICAgaWYgKCByZXQgKQorICAgICAgICBnb3RvIG91dDsKKworICAgIGVu
dHJ5ID0gaHlwZnNfZ2V0X2VudHJ5KHBhdGgpOworICAgIGlmICggIWVudHJ5ICkKKyAgICB7Cisg
ICAgICAgIHJldCA9IC1FTk9FTlQ7CisgICAgICAgIGdvdG8gb3V0OworICAgIH0KKworICAgIHN3
aXRjaCAoIGNtZCApCisgICAgeworICAgIGNhc2UgWEVOX0hZUEZTX09QX3JlYWRfY29udGVudHM6
CisgICAgICAgIHJldCA9IGh5cGZzX3JlYWQoZW50cnksIGFyZzMsIGFyZzQpOworICAgICAgICBi
cmVhazsKKworICAgIGNhc2UgWEVOX0hZUEZTX09QX3dyaXRlX2NvbnRlbnRzOgorICAgICAgICBy
ZXQgPSBoeXBmc193cml0ZShlbnRyeSwgYXJnMywgYXJnNCk7CisgICAgICAgIGJyZWFrOworCisg
ICAgZGVmYXVsdDoKKyAgICAgICAgcmV0ID0gLUVOT1NZUzsKKyAgICAgICAgYnJlYWs7CisgICAg
fQorCisgb3V0OgorICAgIGlmICggY21kID09IFhFTl9IWVBGU19PUF93cml0ZV9jb250ZW50cyAp
CisgICAgICAgIHdyaXRlX3VubG9jaygmaHlwZnNfbG9jayk7CisgICAgZWxzZQorICAgICAgICBy
ZWFkX3VubG9jaygmaHlwZnNfbG9jayk7CisKKyAgICByZXR1cm4gcmV0OworfQpkaWZmIC0tZ2l0
IGEveGVuL2luY2x1ZGUvcHVibGljL2h5cGZzLmggYi94ZW4vaW5jbHVkZS9wdWJsaWMvaHlwZnMu
aApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwLi44MzUxNTExMjI3Ci0tLSAv
ZGV2L251bGwKKysrIGIveGVuL2luY2x1ZGUvcHVibGljL2h5cGZzLmgKQEAgLTAsMCArMSwxMjQg
QEAKKy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioKKyAqIFhlbiBIeXBlcnZpc29yIEZpbGVzeXN0ZW0K
KyAqCisgKiBDb3B5cmlnaHQgKGMpIDIwMTksIFNVU0UgU29mdHdhcmUgU29sdXRpb25zIEdlcm1h
bnkgR21iSAorICoKKyAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hh
cmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkKKyAqIG9mIHRoaXMgc29mdHdhcmUg
YW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0bwor
ICogZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdp
dGhvdXQgbGltaXRhdGlvbiB0aGUKKyAqIHJpZ2h0cyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVy
Z2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vcgorICogc2VsbCBjb3Bp
ZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29m
dHdhcmUgaXMKKyAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5n
IGNvbmRpdGlvbnM6CisgKgorICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMg
cGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4KKyAqIGFsbCBjb3BpZXMgb3Ig
c3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgorICoKKyAqIFRIRSBTT0ZUV0FS
RSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBS
RVNTIE9SCisgKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJS
QU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKKyAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQ
VVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQorICogQVVU
SE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdF
UyBPUiBPVEhFUgorICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFD
VCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcKKyAqIEZST00sIE9VVCBPRiBPUiBJTiBDT05O
RUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIKKyAqIERFQUxJTkdT
IElOIFRIRSBTT0ZUV0FSRS4KKyAqCisgKi8KKworI2lmbmRlZiBfX1hFTl9QVUJMSUNfSFlQRlNf
SF9fCisjZGVmaW5lIF9fWEVOX1BVQkxJQ19IWVBGU19IX18KKworI2luY2x1ZGUgInhlbi5oIgor
CisvKgorICogRGVmaW5pdGlvbnMgZm9yIHRoZSBfX0hZUEVSVklTT1JfaHlwZnNfb3AgaHlwZXJj
YWxsLgorICovCisKKy8qIEhpZ2hlc3QgdmVyc2lvbiBudW1iZXIgb2YgdGhlIGh5cGZzIGludGVy
ZmFjZSBjdXJyZW50bHkgZGVmaW5lZC4gKi8KKyNkZWZpbmUgWEVOX0hZUEZTX1ZFUlNJT04gICAg
ICAxCisKKy8qIE1heGltdW0gbGVuZ3RoIG9mIGEgcGF0aCBpbiB0aGUgZmlsZXN5c3RlbS4gKi8K
KyNkZWZpbmUgWEVOX0hZUEZTX01BWF9QQVRITEVOIDEwMjQKKworc3RydWN0IHhlbl9oeXBmc19k
aXJlbnRyeSB7CisgICAgdWludDE2X3QgZmxhZ3M7CisjZGVmaW5lIFhFTl9IWVBGU19XUklURUFC
TEUgICAgMHgwMDAxCisgICAgdWludDhfdCB0eXBlOworI2RlZmluZSBYRU5fSFlQRlNfVFlQRV9E
SVIgICAgIDB4MDAwMAorI2RlZmluZSBYRU5fSFlQRlNfVFlQRV9CTE9CICAgIDB4MDAwMQorI2Rl
ZmluZSBYRU5fSFlQRlNfVFlQRV9TVFJJTkcgIDB4MDAwMgorI2RlZmluZSBYRU5fSFlQRlNfVFlQ
RV9VSU5UICAgIDB4MDAwMworI2RlZmluZSBYRU5fSFlQRlNfVFlQRV9JTlQgICAgIDB4MDAwNAor
I2RlZmluZSBYRU5fSFlQRlNfVFlQRV9CT09MICAgIDB4MDAwNQorICAgIHVpbnQ4X3QgZW5jb2Rp
bmc7CisjZGVmaW5lIFhFTl9IWVBGU19FTkNfUExBSU4gICAgMHgwMDAwCisjZGVmaW5lIFhFTl9I
WVBGU19FTkNfR1pJUCAgICAgMHgwMDAxCisgICAgdWludDMyX3QgY29udGVudF9sZW47Cit9Owor
CitzdHJ1Y3QgeGVuX2h5cGZzX2Rpcmxpc3RlbnRyeSB7CisgICAgc3RydWN0IHhlbl9oeXBmc19k
aXJlbnRyeSBlOworICAgIC8qIE9mZnNldCBpbiBieXRlcyB0byBuZXh0IGVudHJ5ICgwID09IHRo
aXMgaXMgdGhlIGxhc3QgZW50cnkpLiAqLworICAgIHVpbnQxNl90IG9mZl9uZXh0OworICAgIGNo
YXIgbmFtZVtYRU5fRkxFWF9BUlJBWV9ESU1dOworfTsKKworLyoKKyAqIEh5cGVyY2FsbCBvcGVy
YXRpb25zLgorICovCisKKy8qCisgKiBYRU5fSFlQRlNfT1BfZ2V0X3ZlcnNpb24KKyAqCisgKiBS
ZWFkIGhpZ2hlc3QgaW50ZXJmYWNlIHZlcnNpb24gc3VwcG9ydGVkIGJ5IHRoZSBoeXBlcnZpc29y
LgorICoKKyAqIFBvc3NpYmxlIHJldHVybiB2YWx1ZXM6CisgKiA+MDogaGlnaGVzdCBzdXBwb3J0
ZWQgaW50ZXJmYWNlIHZlcnNpb24KKyAqIDwwOiBuZWdhdGl2ZSBYZW4gZXJybm8gdmFsdWUKKyAq
LworI2RlZmluZSBYRU5fSFlQRlNfT1BfZ2V0X3ZlcnNpb24gICAgIDAKKworLyoKKyAqIFhFTl9I
WVBGU19PUF9yZWFkX2NvbnRlbnRzCisgKgorICogUmVhZCBjb250ZW50cyBvZiBhIGZpbGVzeXN0
ZW0gZW50cnkuCisgKgorICogUmV0dXJucyB0aGUgZGlyZW50cnkgYW5kIGNvbnRlbnRzIG9mIGFu
IGVudHJ5IGluIHRoZSBidWZmZXIgc3VwcGxpZWQgYnkgdGhlCisgKiBjYWxsZXIgKHN0cnVjdCB4
ZW5faHlwZnNfZGlyZW50cnkgd2l0aCB0aGUgY29udGVudHMgZm9sbG93aW5nIGRpcmVjdGx5Cisg
KiBhZnRlciBpdCkuCisgKiBUaGUgZGF0YSBidWZmZXIgbXVzdCBiZSBhdCBsZWFzdCB0aGUgc2l6
ZSBvZiB0aGUgZGlyZW50cnkgcmV0dXJuZWQgaW4gb3JkZXIKKyAqIHRvIGhhdmUgc3VjY2Vzcy4g
SWYgdGhlIGRhdGEgYnVmZmVyIHdhcyBub3QgbGFyZ2UgZW5vdWdoIGZvciBhbGwgdGhlIGRhdGEK
KyAqIG5vIGVudHJ5IGRhdGEgaXMgcmV0dXJuZWQsIGJ1dCB0aGUgZGlyZW50cnkgd2lsbCBjb250
YWluIHRoZSBuZWVkZWQgc2l6ZQorICogZm9yIHRoZSByZXR1cm5lZCBkYXRhLgorICogVGhlIGZv
cm1hdCBvZiB0aGUgY29udGVudHMgaXMgYWNjb3JkaW5nIHRvIGl0cyBlbnRyeSB0eXBlIGFuZCBl
bmNvZGluZy4KKyAqCisgKiBhcmcxOiBYRU5fR1VFU1RfSEFORExFKHBhdGggbmFtZSkKKyAqIGFy
ZzI6IGxlbmd0aCBvZiBwYXRoIG5hbWUgKGluY2x1ZGluZyB0cmFpbGluZyB6ZXJvIGJ5dGUpCisg
KiBhcmczOiBYRU5fR1VFU1RfSEFORExFKGRhdGEgYnVmZmVyIHdyaXR0ZW4gYnkgaHlwZXJ2aXNv
cikKKyAqIGFyZzQ6IGRhdGEgYnVmZmVyIHNpemUKKyAqCisgKiBQb3NzaWJsZSByZXR1cm4gdmFs
dWVzOgorICogMDogc3VjY2VzcyAoYXQgbGVhc3QgdGhlIGRpcmVudHJ5IHdhcyByZXR1cm5lZCkK
KyAqIDwwIDogbmVnYXRpdmUgWGVuIGVycm5vIHZhbHVlCisgKi8KKyNkZWZpbmUgWEVOX0hZUEZT
X09QX3JlYWRfY29udGVudHMgICAgIDEKKworLyoKKyAqIFhFTl9IWVBGU19PUF93cml0ZV9jb250
ZW50cworICoKKyAqIFdyaXRlIGNvbnRlbnRzIG9mIGEgZmlsZXN5c3RlbSBlbnRyeS4KKyAqCisg
KiBXcml0ZXMgYW4gZW50cnkgd2l0aCB0aGUgY29udGVudHMgb2YgYSBidWZmZXIgc3VwcGxpZWQg
YnkgdGhlIGNhbGxlci4KKyAqIFRoZSBkYXRhIHR5cGUgYW5kIGVuY29kaW5nIGNhbid0IGJlIGNo
YW5nZWQuIFRoZSBzaXplIGNhbiBiZSBjaGFuZ2VkIG9ubHkKKyAqIGZvciBibG9icyBhbmQgc3Ry
aW5ncy4KKyAqCisgKiBhcmcxOiBYRU5fR1VFU1RfSEFORExFKHBhdGggbmFtZSkKKyAqIGFyZzI6
IGxlbmd0aCBvZiBwYXRoIG5hbWUgKGluY2x1ZGluZyB0cmFpbGluZyB6ZXJvIGJ5dGUpCisgKiBh
cmczOiBYRU5fR1VFU1RfSEFORExFKGNvbnRlbnQgYnVmZmVyIHJlYWQgYnkgaHlwZXJ2aXNvcikK
KyAqIGFyZzQ6IGNvbnRlbnQgYnVmZmVyIHNpemUKKyAqCisgKiBQb3NzaWJsZSByZXR1cm4gdmFs
dWVzOgorICogMDogc3VjY2VzcworICogPDAgOiBuZWdhdGl2ZSBYZW4gZXJybm8gdmFsdWUKKyAq
LworI2RlZmluZSBYRU5fSFlQRlNfT1Bfd3JpdGVfY29udGVudHMgICAgMgorCisjZW5kaWYgLyog
X19YRU5fUFVCTElDX0hZUEZTX0hfXyAqLwpkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUvcHVibGlj
L3hlbi5oIGIveGVuL2luY2x1ZGUvcHVibGljL3hlbi5oCmluZGV4IGQyMTk4ZGZmYWQuLmJmODBm
MWRhOGMgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL3B1YmxpYy94ZW4uaAorKysgYi94ZW4vaW5j
bHVkZS9wdWJsaWMveGVuLmgKQEAgLTEzMCw2ICsxMzAsNyBAQCBERUZJTkVfWEVOX0dVRVNUX0hB
TkRMRSh4ZW5fdWxvbmdfdCk7CiAjZGVmaW5lIF9fSFlQRVJWSVNPUl9hcmdvX29wICAgICAgICAg
ICAgICAzOQogI2RlZmluZSBfX0hZUEVSVklTT1JfeGVucG11X29wICAgICAgICAgICAgNDAKICNk
ZWZpbmUgX19IWVBFUlZJU09SX2RtX29wICAgICAgICAgICAgICAgIDQxCisjZGVmaW5lIF9fSFlQ
RVJWSVNPUl9oeXBmc19vcCAgICAgICAgICAgICA0MgogCiAvKiBBcmNoaXRlY3R1cmUtc3BlY2lm
aWMgaHlwZXJjYWxsIGRlZmluaXRpb25zLiAqLwogI2RlZmluZSBfX0hZUEVSVklTT1JfYXJjaF8w
ICAgICAgICAgICAgICAgNDgKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL3hlbi9oeXBlcmNhbGwu
aCBiL3hlbi9pbmNsdWRlL3hlbi9oeXBlcmNhbGwuaAppbmRleCBhZDhhZDI3YjIzLi4zNDlhMGY2
NDg3IDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS94ZW4vaHlwZXJjYWxsLmgKKysrIGIveGVuL2lu
Y2x1ZGUveGVuL2h5cGVyY2FsbC5oCkBAIC0xNTAsNiArMTUwLDE0IEBAIGRvX2RtX29wKAogICAg
IHVuc2lnbmVkIGludCBucl9idWZzLAogICAgIFhFTl9HVUVTVF9IQU5ETEVfUEFSQU0oeGVuX2Rt
X29wX2J1Zl90KSBidWZzKTsKIAorZXh0ZXJuIGxvbmcKK2RvX2h5cGZzX29wKAorICAgIHVuc2ln
bmVkIGludCBjbWQsCisgICAgWEVOX0dVRVNUX0hBTkRMRV9QQVJBTSh2b2lkKSBhcmcxLAorICAg
IHVuc2lnbmVkIGxvbmcgYXJnMiwKKyAgICBYRU5fR1VFU1RfSEFORExFX1BBUkFNKHZvaWQpIGFy
ZzMsCisgICAgdW5zaWduZWQgbG9uZyBhcmc0KTsKKwogI2lmZGVmIENPTkZJR19DT01QQVQKIAog
ZXh0ZXJuIGludApkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUveGVuL2h5cGZzLmggYi94ZW4vaW5j
bHVkZS94ZW4vaHlwZnMuaApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwLi5h
MWMyMTQwMzk4Ci0tLSAvZGV2L251bGwKKysrIGIveGVuL2luY2x1ZGUveGVuL2h5cGZzLmgKQEAg
LTAsMCArMSw4OSBAQAorI2lmbmRlZiBfX1hFTl9IWVBGU19IX18KKyNkZWZpbmUgX19YRU5fSFlQ
RlNfSF9fCisKKyNpbmNsdWRlIDx4ZW4vbGlzdC5oPgorI2luY2x1ZGUgPHhlbi9zdHJpbmcuaD4K
KyNpbmNsdWRlIDxwdWJsaWMvaHlwZnMuaD4KKworc3RydWN0IGh5cGZzX2VudHJ5X2xlYWY7CisK
K3N0cnVjdCBoeXBmc19lbnRyeSB7CisgICAgdW5zaWduZWQgc2hvcnQgdHlwZTsKKyAgICB1bnNp
Z25lZCBzaG9ydCBlbmNvZGluZzsKKyAgICB1bnNpZ25lZCBpbnQgc2l6ZTsKKyAgICBjb25zdCBj
aGFyICpuYW1lOworICAgIHN0cnVjdCBsaXN0X2hlYWQgbGlzdDsKKyAgICBpbnQgKCpyZWFkKShj
b25zdCBzdHJ1Y3QgaHlwZnNfZW50cnkgKmVudHJ5LAorICAgICAgICAgICAgICAgIFhFTl9HVUVT
VF9IQU5ETEVfUEFSQU0odm9pZCkgdWFkZHIpOworICAgIGludCAoKndyaXRlKShzdHJ1Y3QgaHlw
ZnNfZW50cnlfbGVhZiAqbGVhZiwKKyAgICAgICAgICAgICAgICAgWEVOX0dVRVNUX0hBTkRMRV9Q
QVJBTSh2b2lkKSB1YWRkciwgdW5zaWduZWQgbG9uZyB1bGVuKTsKK307CisKK3N0cnVjdCBoeXBm
c19lbnRyeV9sZWFmIHsKKyAgICBzdHJ1Y3QgaHlwZnNfZW50cnkgZTsKKyAgICB1bmlvbiB7Cisg
ICAgICAgIGNvbnN0IHZvaWQgKmNvbnRlbnQ7CisgICAgICAgIHZvaWQgKndyaXRlX3B0cjsKKyAg
ICB9OworfTsKKworc3RydWN0IGh5cGZzX2VudHJ5X2RpciB7CisgICAgc3RydWN0IGh5cGZzX2Vu
dHJ5IGU7CisgICAgc3RydWN0IGxpc3RfaGVhZCBkaXJsaXN0OworfTsKKworI2RlZmluZSBIWVBG
U19ESVJfSU5JVCh2YXIsIG5hbSkgICAgICAgICAgICAgICAgXAorICAgIHN0cnVjdCBoeXBmc19l
bnRyeV9kaXIgdmFyID0geyAgICAgICAgICAgICAgXAorICAgICAgICAuZS50eXBlID0gWEVOX0hZ
UEZTX1RZUEVfRElSLCAgICAgICAgICAgXAorICAgICAgICAuZS5lbmNvZGluZyA9IFhFTl9IWVBG
U19FTkNfUExBSU4sICAgICAgXAorICAgICAgICAuZS5uYW1lID0gbmFtLCAgICAgICAgICAgICAg
ICAgICAgICAgICAgXAorICAgICAgICAuZS5zaXplID0gMCwgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgXAorICAgICAgICAuZS5saXN0ID0gTElTVF9IRUFEX0lOSVQodmFyLmUubGlzdCksICAg
XAorICAgICAgICAuZS5yZWFkID0gaHlwZnNfcmVhZF9kaXIsICAgICAgICAgICAgICAgXAorICAg
ICAgICAuZGlybGlzdCA9IExJU1RfSEVBRF9JTklUKHZhci5kaXJsaXN0KSwgXAorICAgIH0KKwor
LyogQ29udGVudCBhbmQgc2l6ZSBuZWVkIHRvIGJlIHNldCB2aWEgaHlwZnNfc3RyaW5nX3NldCgp
LiAqLworI2RlZmluZSBIWVBGU19TVFJJTkdfSU5JVCh2YXIsIG5hbSkgICAgICAgICAgICAgXAor
ICAgIHN0cnVjdCBoeXBmc19lbnRyeV9sZWFmIHZhciA9IHsgICAgICAgICAgICAgXAorICAgICAg
ICAuZS50eXBlID0gWEVOX0hZUEZTX1RZUEVfU1RSSU5HLCAgICAgICAgXAorICAgICAgICAuZS5l
bmNvZGluZyA9IFhFTl9IWVBGU19FTkNfUExBSU4sICAgICAgXAorICAgICAgICAuZS5uYW1lID0g
bmFtLCAgICAgICAgICAgICAgICAgICAgICAgICAgXAorICAgICAgICAuZS5yZWFkID0gaHlwZnNf
cmVhZF9sZWFmLCAgICAgICAgICAgICAgXAorICAgIH0KKworc3RhdGljIGlubGluZSB2b2lkIGh5
cGZzX3N0cmluZ19zZXQoc3RydWN0IGh5cGZzX2VudHJ5X2xlYWYgKmxlYWYsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGFyICpzdHIpCit7CisgICAgbGVhZi0+
Y29udGVudCA9IHN0cjsKKyAgICBsZWFmLT5lLnNpemUgPSBzdHJsZW4oc3RyKSArIDE7Cit9CisK
KyNkZWZpbmUgSFlQRlNfVUlOVF9JTklUKHZhciwgbmFtLCB1aW50KSAgICAgICAgIFwKKyAgICBz
dHJ1Y3QgaHlwZnNfZW50cnlfbGVhZiB2YXIgPSB7ICAgICAgICAgICAgIFwKKyAgICAgICAgLmUu
dHlwZSA9IFhFTl9IWVBGU19UWVBFX1VJTlQsICAgICAgICAgIFwKKyAgICAgICAgLmUuZW5jb2Rp
bmcgPSBYRU5fSFlQRlNfRU5DX1BMQUlOLCAgICAgIFwKKyAgICAgICAgLmUubmFtZSA9IG5hbSwg
ICAgICAgICAgICAgICAgICAgICAgICAgIFwKKyAgICAgICAgLmUuc2l6ZSA9IHNpemVvZih1aW50
KSwgICAgICAgICAgICAgICAgIFwKKyAgICAgICAgLmUucmVhZCA9IGh5cGZzX3JlYWRfbGVhZiwg
ICAgICAgICAgICAgIFwKKyAgICAgICAgLmNvbnRlbnQgPSAmdWludCwgICAgICAgICAgICAgICAg
ICAgICAgIFwKKyAgICB9CisKKworZXh0ZXJuIHN0cnVjdCBoeXBmc19lbnRyeV9kaXIgaHlwZnNf
cm9vdDsKKworc3RydWN0IGh5cGZzX2VudHJ5ICpoeXBmc19nZXRfZW50cnkoY29uc3QgY2hhciAq
cGF0aCk7CitpbnQgaHlwZnNfYWRkX2RpcihzdHJ1Y3QgaHlwZnNfZW50cnlfZGlyICpwYXJlbnQs
CisgICAgICAgICAgICAgICAgICBzdHJ1Y3QgaHlwZnNfZW50cnlfZGlyICpkaXIsIGJvb2wgbm9m
YXVsdCk7CitpbnQgaHlwZnNfYWRkX2xlYWYoc3RydWN0IGh5cGZzX2VudHJ5X2RpciAqcGFyZW50
LAorICAgICAgICAgICAgICAgICAgIHN0cnVjdCBoeXBmc19lbnRyeV9sZWFmICpsZWFmLCBib29s
IG5vZmF1bHQpOworaW50IGh5cGZzX3JlYWRfZGlyKGNvbnN0IHN0cnVjdCBoeXBmc19lbnRyeSAq
ZW50cnksCisgICAgICAgICAgICAgICAgICAgWEVOX0dVRVNUX0hBTkRMRV9QQVJBTSh2b2lkKSB1
YWRkcik7CitpbnQgaHlwZnNfcmVhZF9sZWFmKGNvbnN0IHN0cnVjdCBoeXBmc19lbnRyeSAqZW50
cnksCisgICAgICAgICAgICAgICAgICAgIFhFTl9HVUVTVF9IQU5ETEVfUEFSQU0odm9pZCkgdWFk
ZHIpOworaW50IGh5cGZzX3dyaXRlX2xlYWYoc3RydWN0IGh5cGZzX2VudHJ5X2xlYWYgKmxlYWYs
CisgICAgICAgICAgICAgICAgICAgICBYRU5fR1VFU1RfSEFORExFX1BBUkFNKHZvaWQpIHVhZGRy
LCB1bnNpZ25lZCBsb25nIHVsZW4pOworaW50IGh5cGZzX3dyaXRlX2Jvb2woc3RydWN0IGh5cGZz
X2VudHJ5X2xlYWYgKmxlYWYsCisgICAgICAgICAgICAgICAgICAgICBYRU5fR1VFU1RfSEFORExF
X1BBUkFNKHZvaWQpIHVhZGRyLCB1bnNpZ25lZCBsb25nIHVsZW4pOworCisjZW5kaWYgLyogX19Y
RU5fSFlQRlNfSF9fICovCi0tIAoyLjE2LjQKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0
cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlz
dGluZm8veGVuLWRldmVs

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id BFE83A65A8
	for <lists+xen-devel@lfdr.de>; Tue,  3 Sep 2019 11:39:20 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i55FM-0005eq-TS; Tue, 03 Sep 2019 09:37:08 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=CRa/=W6=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1i55FL-0005ej-6S
 for xen-devel@lists.xenproject.org; Tue, 03 Sep 2019 09:37:07 +0000
X-Inumbo-ID: 637853c0-ce2e-11e9-ac23-bc764e2007e4
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 637853c0-ce2e-11e9-ac23-bc764e2007e4;
 Tue, 03 Sep 2019 09:37:04 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 2C390AC10;
 Tue,  3 Sep 2019 09:37:04 +0000 (UTC)
From: Jan Beulich <jbeulich@suse.com>
To: "xen-devel@lists.xenproject.org" <xen-devel@lists.xenproject.org>
References: <347e51f2-e80c-992c-6d0b-3b2bfdb75cce@suse.com>
Message-ID: <8d4c8f8e-c80d-5979-f965-a13db2d81ea6@suse.com>
Date: Tue, 3 Sep 2019 11:37:09 +0200
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:60.0) Gecko/20100101
 Thunderbird/60.8.0
MIME-Version: 1.0
In-Reply-To: <347e51f2-e80c-992c-6d0b-3b2bfdb75cce@suse.com>
Content-Language: en-US
Subject: [Xen-devel] [PATCH v3 1/8] x86emul: support WBNOINVD
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>,
 Paul Durrant <Paul.Durrant@citrix.com>, Wei Liu <wl@xen.org>,
 Roger Pau Monne <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

UmV2IDAzNyBvZiBJbnRlbCdzIElTQSBleHRlbnNpb25zIGRvY3VtZW50IGRvZXMgbm90IHN0YXRl
IGludGVyY2VwdApiZWhhdmlvciBmb3IgdGhlIGluc24gKEkndmUgYmVlbiB1bm9mZmljaWFsbHkg
dG9sZCB0aGF0IHRoZSBkaXN0aW5jdGlvbgppcyBnb2luZyB0byBiZSBieSBleGl0IHF1YWxpZmlj
YXRpb24sIGFzIEkgd291bGQgaGF2ZSBhc3N1bWVkCmNvbnNpZGVyaW5nIHRoYXQgdGhpcyB3YXkg
aXQncyBzdWZmaWNpZW50bHkgdHJhbnNwYXJlbnQgdG8gdW5hd2FyZQpzb2Z0d2FyZSwgYXMgdXNp
bmcgV0JJTlZEIGluIHBsYWNlIG9mIFdCTk9JTlZEIGlzIGFsd2F5cyBjb3JyZWN0LCBqdXN0Cmxl
c3MgZWZmaWNpZW50KS4gU2ltaWxhcmx5IEFNRCdzIFBNIHZvbHVtZSAyIHZlcnNpb24gMy4zMSBv
bmx5IHN0YXRlcwp0aGF0IGJvdGggdXNlIHRoZSBzYW1lIFZNRVhJVCwgYnV0IG5vdCBob3cgdG8g
ZGlzdGludWdpc2ggdGhlbSAob3RoZXIKdGhhbiBieSBkZWNvZGluZyB0aGUgaW5zbikuIFRoZXJl
Zm9yZSBpbiB0aGUgSFZNIGNhc2UgZm9yIG5vdyBpdCdsbCBiZQpiYWNrZWQgYnkgdGhlIHNhbWUg
LT53YmludmRfaW50ZXJjZXB0KCkgaGFuZGxlcnMuCgpVc2UgdGhpcyBvY2Nhc2lvbiBhbmQgYWxz
byBhZGQgdGhlIHR3byBtaXNzaW5nIHRhYmxlIGVudHJpZXMgZm9yCkNMREVNT1RFLCB3aGljaCBk
b2Vzbid0IHJlcXVpcmUgYW55IGZ1cnRoZXIgY2hhbmdlcyB0byBtYWtlIHdvcmsuCgpTaWduZWQt
b2ZmLWJ5OiBKYW4gQmV1bGljaCA8amJldWxpY2hAc3VzZS5jb20+ClJldmlld2VkLWJ5OiBQYXVs
IER1cnJhbnQgPHBhdWwuZHVycmFudEBjaXRyaXguY29tPgotLS0KdjM6IERyb3AgQSBhdHRyaWJ1
dGUgZnJvbSBwdWJsaWMgaGVhZGVyIGFkZGl0aW9uLiBDb21tZW50IG91dAogICAgY3B1X2hhc193
Ym5vaW52ZCBwYXJ0IG9mIGNvbmRpdGlvbmFsLiBFeHRlbmQgZGVzY3JpcHRpb24uCnYyOiBSZS1i
YXNlLiBDb252ZXJ0IHdibm9pbnZkKCkgaW5saW5lIGZ1bmN0aW9uLgoKLS0tIGEvdG9vbHMvbGli
eGwvbGlieGxfY3B1aWQuYworKysgYi90b29scy9saWJ4bC9saWJ4bF9jcHVpZC5jCkBAIC0yMDgs
NiArMjA4LDcgQEAgaW50IGxpYnhsX2NwdWlkX3BhcnNlX2NvbmZpZyhsaWJ4bF9jcHVpZAogICAg
ICAgICB7ImF2eDUxMi1iaXRhbGciLDB4MDAwMDAwMDcsICAwLCBDUFVJRF9SRUdfRUNYLCAxMiwg
IDF9LAogICAgICAgICB7ImF2eDUxMi12cG9wY250ZHEiLDB4MDAwMDAwMDcsMCxDUFVJRF9SRUdf
RUNYLCAxNCwgIDF9LAogICAgICAgICB7InJkcGlkIiwgICAgICAgIDB4MDAwMDAwMDcsICAwLCBD
UFVJRF9SRUdfRUNYLCAyMiwgIDF9LAorICAgICAgICB7ImNsZGVtb3RlIiwgICAgIDB4MDAwMDAw
MDcsICAwLCBDUFVJRF9SRUdfRUNYLCAyNSwgIDF9LAogCiAgICAgICAgIHsiYXZ4NTEyLTR2bm5p
dyIsMHgwMDAwMDAwNywgIDAsIENQVUlEX1JFR19FRFgsICAyLCAgMX0sCiAgICAgICAgIHsiYXZ4
NTEyLTRmbWFwcyIsMHgwMDAwMDAwNywgIDAsIENQVUlEX1JFR19FRFgsICAzLCAgMX0sCkBAIC0y
NTYsNiArMjU3LDcgQEAgaW50IGxpYnhsX2NwdWlkX3BhcnNlX2NvbmZpZyhsaWJ4bF9jcHVpZAog
CiAgICAgICAgIHsiaW52dHNjIiwgICAgICAgMHg4MDAwMDAwNywgTkEsIENQVUlEX1JFR19FRFgs
ICA4LCAgMX0sCiAKKyAgICAgICAgeyJ3Ym5vaW52ZCIsICAgICAweDgwMDAwMDA4LCBOQSwgQ1BV
SURfUkVHX0VCWCwgIDksICAxfSwKICAgICAgICAgeyJpYnBiIiwgICAgICAgICAweDgwMDAwMDA4
LCBOQSwgQ1BVSURfUkVHX0VCWCwgMTIsICAxfSwKICAgICAgICAgeyJuYyIsICAgICAgICAgICAw
eDgwMDAwMDA4LCBOQSwgQ1BVSURfUkVHX0VDWCwgIDAsICA4fSwKICAgICAgICAgeyJhcGljaWRz
aXplIiwgICAweDgwMDAwMDA4LCBOQSwgQ1BVSURfUkVHX0VDWCwgMTIsICA0fSwKLS0tIGEvdG9v
bHMvbWlzYy94ZW4tY3B1aWQuYworKysgYi90b29scy9taXNjL3hlbi1jcHVpZC5jCkBAIC0xNDYs
NiArMTQ2LDggQEAgc3RhdGljIGNvbnN0IGNoYXIgKmNvbnN0IHN0cl9lOGJbMzJdID0KIHsKICAg
ICBbIDBdID0gImNsemVybyIsCiAKKyAgICAvKiBbIDhdICovICAgICAgICAgICAgWyA5XSA9ICJ3
Ym5vaW52ZCIsCisKICAgICBbMTJdID0gImlicGIiLAogfTsKIAotLS0gYS94ZW4vYXJjaC94ODYv
aHZtL2VtdWxhdGUuYworKysgYi94ZW4vYXJjaC94ODYvaHZtL2VtdWxhdGUuYwpAQCAtMjIxMiw2
ICsyMjEyLDcgQEAgc3RhdGljIGludCBodm1lbXVsX2NhY2hlX29wKAogICAgICAgICAvKiBmYWxs
IHRocm91Z2ggKi8KICAgICBjYXNlIHg4NmVtdWxfaW52ZDoKICAgICBjYXNlIHg4NmVtdWxfd2Jp
bnZkOgorICAgIGNhc2UgeDg2ZW11bF93Ym5vaW52ZDoKICAgICAgICAgYWx0ZXJuYXRpdmVfdmNh
bGwoaHZtX2Z1bmNzLndiaW52ZF9pbnRlcmNlcHQpOwogICAgICAgICBicmVhazsKICAgICB9Ci0t
LSBhL3hlbi9hcmNoL3g4Ni9wdi9lbXVsLXByaXYtb3AuYworKysgYi94ZW4vYXJjaC94ODYvcHYv
ZW11bC1wcml2LW9wLmMKQEAgLTExMjAsNyArMTEyMCw3IEBAIHN0YXRpYyBpbnQgd3JpdGVfbXNy
KHVuc2lnbmVkIGludCByZWcsIHUKIHN0YXRpYyBpbnQgY2FjaGVfb3AoZW51bSB4ODZlbXVsX2Nh
Y2hlX29wIG9wLCBlbnVtIHg4Nl9zZWdtZW50IHNlZywKICAgICAgICAgICAgICAgICAgICAgdW5z
aWduZWQgbG9uZyBvZmZzZXQsIHN0cnVjdCB4ODZfZW11bGF0ZV9jdHh0ICpjdHh0KQogewotICAg
IEFTU0VSVChvcCA9PSB4ODZlbXVsX3diaW52ZCk7CisgICAgQVNTRVJUKG9wID09IHg4NmVtdWxf
d2JpbnZkIHx8IG9wID09IHg4NmVtdWxfd2Jub2ludmQpOwogCiAgICAgLyogSWdub3JlIHRoZSBp
bnN0cnVjdGlvbiBpZiB1bnByaXZpbGVnZWQuICovCiAgICAgaWYgKCAhY2FjaGVfZmx1c2hfcGVy
bWl0dGVkKGN1cnJlbnQtPmRvbWFpbikgKQpAQCAtMTEyOSw2ICsxMTI5LDggQEAgc3RhdGljIGlu
dCBjYWNoZV9vcChlbnVtIHg4NmVtdWxfY2FjaGVfbwogICAgICAgICAgKiBuZXdlciBsaW51eCB1
c2VzIHRoaXMgaW4gc29tZSBzdGFydC1vZi1kYXkgdGltaW5nIGxvb3BzLgogICAgICAgICAgKi8K
ICAgICAgICAgOworICAgIGVsc2UgaWYgKCBvcCA9PSB4ODZlbXVsX3dibm9pbnZkIC8qICYmIGNw
dV9oYXNfd2Jub2ludmQgKi8gKQorICAgICAgICB3Ym5vaW52ZCgpOwogICAgIGVsc2UKICAgICAg
ICAgd2JpbnZkKCk7CiAKLS0tIGEveGVuL2FyY2gveDg2L3g4Nl9lbXVsYXRlL3g4Nl9lbXVsYXRl
LmMKKysrIGIveGVuL2FyY2gveDg2L3g4Nl9lbXVsYXRlL3g4Nl9lbXVsYXRlLmMKQEAgLTE4Njks
NiArMTg2OSw3IEBAIGluX3Byb3Rtb2RlKAogI2RlZmluZSB2Y3B1X2hhc19mbWE0KCkgICAgICAg
IChjdHh0LT5jcHVpZC0+ZXh0ZC5mbWE0KQogI2RlZmluZSB2Y3B1X2hhc190Ym0oKSAgICAgICAg
IChjdHh0LT5jcHVpZC0+ZXh0ZC50Ym0pCiAjZGVmaW5lIHZjcHVfaGFzX2NsemVybygpICAgICAg
KGN0eHQtPmNwdWlkLT5leHRkLmNsemVybykKKyNkZWZpbmUgdmNwdV9oYXNfd2Jub2ludmQoKSAg
ICAoY3R4dC0+Y3B1aWQtPmV4dGQud2Jub2ludmQpCiAKICNkZWZpbmUgdmNwdV9oYXNfYm1pMSgp
ICAgICAgICAoY3R4dC0+Y3B1aWQtPmZlYXQuYm1pMSkKICNkZWZpbmUgdmNwdV9oYXNfaGxlKCkg
ICAgICAgICAoY3R4dC0+Y3B1aWQtPmZlYXQuaGxlKQpAQCAtNTkzMSwxMCArNTkzMiwxMyBAQCB4
ODZfZW11bGF0ZSgKICAgICAgICAgYnJlYWs7CiAKICAgICBjYXNlIFg4NkVNVUxfT1BDKDB4MGYs
IDB4MDgpOiAvKiBpbnZkICovCi0gICAgY2FzZSBYODZFTVVMX09QQygweDBmLCAweDA5KTogLyog
d2JpbnZkICovCisgICAgY2FzZSBYODZFTVVMX09QQygweDBmLCAweDA5KTogLyogd2JpbnZkIC8g
d2Jub2ludmQgKi8KICAgICAgICAgZ2VuZXJhdGVfZXhjZXB0aW9uX2lmKCFtb2RlX3JpbmcwKCks
IEVYQ19HUCwgMCk7CiAgICAgICAgIGZhaWxfaWYoIW9wcy0+Y2FjaGVfb3ApOwotICAgICAgICBp
ZiAoIChyYyA9IG9wcy0+Y2FjaGVfb3AoYiA9PSAweDA5ID8geDg2ZW11bF93YmludmQKKyAgICAg
ICAgaWYgKCAocmMgPSBvcHMtPmNhY2hlX29wKGIgPT0gMHgwOSA/ICFyZXBlX3ByZWZpeCgpIHx8
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhdmNwdV9oYXNf
d2Jub2ludmQoKQorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
PyB4ODZlbXVsX3diaW52ZAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgOiB4ODZlbXVsX3dibm9pbnZkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgOiB4ODZlbXVsX2ludmQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICB4ODZfc2VnX25vbmUsIDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBj
dHh0KSkgIT0gWDg2RU1VTF9PS0FZICkKLS0tIGEveGVuL2FyY2gveDg2L3g4Nl9lbXVsYXRlL3g4
Nl9lbXVsYXRlLmgKKysrIGIveGVuL2FyY2gveDg2L3g4Nl9lbXVsYXRlL3g4Nl9lbXVsYXRlLmgK
QEAgLTE4Miw2ICsxODIsNyBAQCBlbnVtIHg4NmVtdWxfY2FjaGVfb3AgewogICAgIHg4NmVtdWxf
Y2x3YiwKICAgICB4ODZlbXVsX2ludmQsCiAgICAgeDg2ZW11bF93YmludmQsCisgICAgeDg2ZW11
bF93Ym5vaW52ZCwKIH07CiAKIHN0cnVjdCB4ODZfZW11bGF0ZV9zdGF0ZTsKLS0tIGEveGVuL2lu
Y2x1ZGUvYXNtLXg4Ni9zeXN0ZW0uaAorKysgYi94ZW4vaW5jbHVkZS9hc20teDg2L3N5c3RlbS5o
CkBAIC0xNiw2ICsxNiwxMSBAQCBzdGF0aWMgaW5saW5lIHZvaWQgd2JpbnZkKHZvaWQpCiAgICAg
YXNtIHZvbGF0aWxlICggIndiaW52ZCIgOjo6ICJtZW1vcnkiICk7CiB9CiAKK3N0YXRpYyBpbmxp
bmUgdm9pZCB3Ym5vaW52ZCh2b2lkKQoreworICAgIGFzbSB2b2xhdGlsZSAoICJyZXBlOyB3Ymlu
dmQiIDogOiA6ICJtZW1vcnkiICk7Cit9CisKIHN0YXRpYyBpbmxpbmUgdm9pZCBjbGZsdXNoKGNv
bnN0IHZvaWQgKnApCiB7CiAgICAgYXNtIHZvbGF0aWxlICggImNsZmx1c2ggJTAiIDo6ICJtIiAo
Kihjb25zdCBjaGFyICopcCkgKTsKLS0tIGEveGVuL2luY2x1ZGUvcHVibGljL2FyY2gteDg2L2Nw
dWZlYXR1cmVzZXQuaAorKysgYi94ZW4vaW5jbHVkZS9wdWJsaWMvYXJjaC14ODYvY3B1ZmVhdHVy
ZXNldC5oCkBAIC0yMzYsNiArMjM2LDcgQEAgWEVOX0NQVUZFQVRVUkUoQVZYNTEyX1ZOTkksICAg
NiozMisxMSkgLwogWEVOX0NQVUZFQVRVUkUoQVZYNTEyX0JJVEFMRywgNiozMisxMikgLypBICBT
dXBwb3J0IGZvciBWUE9QQ05UW0IsV10gYW5kIFZQU0hVRkJJVFFNQiAqLwogWEVOX0NQVUZFQVRV
UkUoQVZYNTEyX1ZQT1BDTlREUSwgNiozMisxNCkgLypBICBQT1BDTlQgZm9yIHZlY3RvcnMgb2Yg
RFcvUVcgKi8KIFhFTl9DUFVGRUFUVVJFKFJEUElELCAgICAgICAgIDYqMzIrMjIpIC8qQSAgUkRQ
SUQgaW5zdHJ1Y3Rpb24gKi8KK1hFTl9DUFVGRUFUVVJFKENMREVNT1RFLCAgICAgIDYqMzIrMjUp
IC8qQSAgQ0xERU1PVEUgaW5zdHJ1Y3Rpb24gKi8KIAogLyogQU1ELWRlZmluZWQgQ1BVIGZlYXR1
cmVzLCBDUFVJRCBsZXZlbCAweDgwMDAwMDA3LmVkeCwgd29yZCA3ICovCiBYRU5fQ1BVRkVBVFVS
RShJVFNDLCAgICAgICAgICA3KjMyKyA4KSAvKiAgIEludmFyaWFudCBUU0MgKi8KQEAgLTI0Myw2
ICsyNDQsNyBAQCBYRU5fQ1BVRkVBVFVSRShFRlJPLCAgICAgICAgICA3KjMyKzEwKSAvCiAKIC8q
IEFNRC1kZWZpbmVkIENQVSBmZWF0dXJlcywgQ1BVSUQgbGV2ZWwgMHg4MDAwMDAwOC5lYngsIHdv
cmQgOCAqLwogWEVOX0NQVUZFQVRVUkUoQ0xaRVJPLCAgICAgICAgOCozMisgMCkgLypBICBDTFpF
Uk8gaW5zdHJ1Y3Rpb24gKi8KK1hFTl9DUFVGRUFUVVJFKFdCTk9JTlZELCAgICAgIDgqMzIrIDkp
IC8qICAgV0JOT0lOVkQgaW5zdHJ1Y3Rpb24gKi8KIFhFTl9DUFVGRUFUVVJFKElCUEIsICAgICAg
ICAgIDgqMzIrMTIpIC8qQSAgSUJQQiBzdXBwb3J0IG9ubHkgKG5vIElCUlMsIHVzZWQgYnkgQU1E
KSAqLwogCiAvKiBJbnRlbC1kZWZpbmVkIENQVSBmZWF0dXJlcywgQ1BVSUQgbGV2ZWwgMHgwMDAw
MDAwNzowLmVkeCwgd29yZCA5ICovCgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVu
cHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZv
L3hlbi1kZXZlbA==

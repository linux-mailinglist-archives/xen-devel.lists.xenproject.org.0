Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 3C1482C492
	for <lists+xen-devel@lfdr.de>; Tue, 28 May 2019 12:39:23 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hVZRf-0007zR-00; Tue, 28 May 2019 10:35:03 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=31/0=T4=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1hVZQM-00059z-7O
 for xen-devel@lists.xenproject.org; Tue, 28 May 2019 10:33:42 +0000
X-Inumbo-ID: 0528a348-8134-11e9-8980-bc764e045a96
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 0528a348-8134-11e9-8980-bc764e045a96;
 Tue, 28 May 2019 10:33:24 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 6DE46B03F;
 Tue, 28 May 2019 10:33:22 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Tue, 28 May 2019 12:32:36 +0200
Message-Id: <20190528103313.1343-24-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190528103313.1343-1-jgross@suse.com>
References: <20190528103313.1343-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH 23/60] xen/sched: make credit2 scheduler vcpu
 agnostic.
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Dario Faggioli <dfaggioli@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

U3dpdGNoIGNyZWRpdDIgc2NoZWR1bGVyIGNvbXBsZXRlbHkgZnJvbSB2Y3B1IHRvIHNjaGVkX3Vu
aXQgdXNhZ2UuCgpBcyB3ZSBhcmUgdG91Y2hpbmcgbG90cyBvZiBsaW5lcyByZW1vdmUgc29tZSB3
aGl0ZSBzcGFjZSBhdCB0aGUgZW5kIG9mCnRoZSBsaW5lLCB0b28uCgpTaWduZWQtb2ZmLWJ5OiBK
dWVyZ2VuIEdyb3NzIDxqZ3Jvc3NAc3VzZS5jb20+Ci0tLQogeGVuL2NvbW1vbi9zY2hlZF9jcmVk
aXQyLmMgfCA4MjAgKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
CiAxIGZpbGUgY2hhbmdlZCwgNDAzIGluc2VydGlvbnMoKyksIDQxNyBkZWxldGlvbnMoLSkKCmRp
ZmYgLS1naXQgYS94ZW4vY29tbW9uL3NjaGVkX2NyZWRpdDIuYyBiL3hlbi9jb21tb24vc2NoZWRf
Y3JlZGl0Mi5jCmluZGV4IGVmMjlhM2Q4NzQuLjBmNTcxMzVlODEgMTAwNjQ0Ci0tLSBhL3hlbi9j
b21tb24vc2NoZWRfY3JlZGl0Mi5jCisrKyBiL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0Mi5jCkBA
IC00NSw3ICs0NSw3IEBACiAjZGVmaW5lIFRSQ19DU0NIRUQyX1NDSEVEX1RBU0tMRVQgICAgVFJD
X1NDSEVEX0NMQVNTX0VWVChDU0NIRUQyLCA4KQogI2RlZmluZSBUUkNfQ1NDSEVEMl9VUERBVEVf
TE9BRCAgICAgIFRSQ19TQ0hFRF9DTEFTU19FVlQoQ1NDSEVEMiwgOSkKICNkZWZpbmUgVFJDX0NT
Q0hFRDJfUlVOUV9BU1NJR04gICAgICBUUkNfU0NIRURfQ0xBU1NfRVZUKENTQ0hFRDIsIDEwKQot
I2RlZmluZSBUUkNfQ1NDSEVEMl9VUERBVEVfVkNQVV9MT0FEIFRSQ19TQ0hFRF9DTEFTU19FVlQo
Q1NDSEVEMiwgMTEpCisjZGVmaW5lIFRSQ19DU0NIRUQyX1VQREFURV9VTklUX0xPQUQgVFJDX1ND
SEVEX0NMQVNTX0VWVChDU0NIRUQyLCAxMSkKICNkZWZpbmUgVFJDX0NTQ0hFRDJfVVBEQVRFX1JV
TlFfTE9BRCBUUkNfU0NIRURfQ0xBU1NfRVZUKENTQ0hFRDIsIDEyKQogI2RlZmluZSBUUkNfQ1ND
SEVEMl9USUNLTEVfTkVXICAgICAgIFRSQ19TQ0hFRF9DTEFTU19FVlQoQ1NDSEVEMiwgMTMpCiAj
ZGVmaW5lIFRSQ19DU0NIRUQyX1JVTlFfTUFYX1dFSUdIVCAgVFJDX1NDSEVEX0NMQVNTX0VWVChD
U0NIRUQyLCAxNCkKQEAgLTc0LDEzICs3NCwxMyBAQAogICogRGVzaWduOgogICoKICAqIFZNcyAi
YnVybiIgY3JlZGl0cyBiYXNlZCBvbiB0aGVpciB3ZWlnaHQ7IGhpZ2hlciB3ZWlnaHQgbWVhbnMK
LSAqIGNyZWRpdHMgYnVybiBtb3JlIHNsb3dseS4gIFRoZSBoaWdoZXN0IHdlaWdodCB2Y3B1IGJ1
cm5zIGNyZWRpdHMgYXQKKyAqIGNyZWRpdHMgYnVybiBtb3JlIHNsb3dseS4gIFRoZSBoaWdoZXN0
IHdlaWdodCB1bml0IGJ1cm5zIGNyZWRpdHMgYXQKICAqIGEgcmF0ZSBvZiAxIGNyZWRpdCBwZXIg
bmFub3NlY29uZC4gIE90aGVycyBidXJuIHByb3BvcnRpb25hbGx5CiAgKiBtb3JlLgogICoKLSAq
IHZjcHVzIGFyZSBpbnNlcnRlZCBpbnRvIHRoZSBydW5xdWV1ZSBieSBjcmVkaXQgb3JkZXIuCisg
KiB1bml0cyBhcmUgaW5zZXJ0ZWQgaW50byB0aGUgcnVucXVldWUgYnkgY3JlZGl0IG9yZGVyLgog
ICoKLSAqIENyZWRpdHMgYXJlICJyZXNldCIgd2hlbiB0aGUgbmV4dCB2Y3B1IGluIHRoZSBydW5x
dWV1ZSBpcyBsZXNzIHRoYW4KKyAqIENyZWRpdHMgYXJlICJyZXNldCIgd2hlbiB0aGUgbmV4dCB1
bml0IGluIHRoZSBydW5xdWV1ZSBpcyBsZXNzIHRoYW4KICAqIG9yIGVxdWFsIHRvIHplcm8uICBB
dCB0aGF0IHBvaW50LCBldmVyeW9uZSdzIGNyZWRpdHMgYXJlICJjbGlwcGVkIgogICogdG8gYSBz
bWFsbCB2YWx1ZSwgYW5kIGEgZml4ZWQgY3JlZGl0IGlzIGFkZGVkIHRvIGV2ZXJ5b25lLgogICov
CkBAIC05NSwzMyArOTUsMzMgQEAKICAqICAgYmUgZ2l2ZW4gYSBjYXAgb2YgMjUlOyBhIGRvbWFp
biB0aGF0IG11c3Qgbm90IHVzZSBtb3JlIHRoYW4gMSsxLzIgb2YKICAqICAgcGh5c2ljYWwgQ1BV
IHRpbWUsIHdpbGwgYmUgZ2l2ZW4gYSBjYXAgb2YgMTUwJTsKICAqCi0gKiAtIGNhcHMgYXJlIHBl
ci1kb21haW4gKG5vdCBwZXItdkNQVSkuIElmIGEgZG9tYWluIGhhcyBvbmx5IDEgdkNQVSwgYW5k
Ci0gKiAgIGEgNDAlIGNhcCwgdGhhdCBvbmUgdkNQVSB3aWxsIHVzZSA0MCUgb2Ygb25lIHBDUFUu
IElmIGEgc29tYWluIGhhcyA0Ci0gKiAgIHZDUFVzLCBhbmQgYSAyMDAlIGNhcCwgdGhlIGVxdWl2
YWxlbnQgb2YgMTAwJSB0aW1lIG9uIDIgcENQVXMgd2lsbCBiZQotICogICBzcGxpdCBhbW9uZyB0
aGUgdiB2Q1BVcy4gSG93IG11Y2ggZWFjaCBvZiB0aGUgdkNQVXMgd2lsbCBhY3R1YWxseSBnZXQs
CisgKiAtIGNhcHMgYXJlIHBlci1kb21haW4gKG5vdCBwZXItdW5pdCkuIElmIGEgZG9tYWluIGhh
cyBvbmx5IDEgdW5pdCwgYW5kCisgKiAgIGEgNDAlIGNhcCwgdGhhdCBvbmUgdW5pdCB3aWxsIHVz
ZSA0MCUgb2Ygb25lIHBDUFUuIElmIGEgc29tYWluIGhhcyA0CisgKiAgIHVuaXRzLCBhbmQgYSAy
MDAlIGNhcCwgdGhlIGVxdWl2YWxlbnQgb2YgMTAwJSB0aW1lIG9uIDIgcENQVXMgd2lsbCBiZQor
ICogICBzcGxpdCBhbW9uZyB0aGUgdiB1bml0cy4gSG93IG11Y2ggZWFjaCBvZiB0aGUgdW5pdHMg
d2lsbCBhY3R1YWxseSBnZXQsCiAgKiAgIGR1cmluZyBhbnkgZ2l2ZW4gaW50ZXJ2YWwgb2YgdGlt
ZSwgaXMgdW5zcGVjaWZpZWQgKGFzIGl0IGRlcGVuZHMgb24KICAqICAgdmFyaW91cyBhc3BlY3Rz
OiB3b3JrbG9hZCwgc3lzdGVtIGxvYWQsIGV0Yy4pLiBGb3IgaW5zdGFuY2UsIGl0IGlzCi0gKiAg
IHBvc3NpYmxlIHRoYXQsIGR1cmluZyBhIGdpdmVuIHRpbWUgaW50ZXJ2YWwsIDIgdkNQVXMgdXNl
IDEwMCUgZWFjaCwKKyAqICAgcG9zc2libGUgdGhhdCwgZHVyaW5nIGEgZ2l2ZW4gdGltZSBpbnRl
cnZhbCwgMiB1bml0cyB1c2UgMTAwJSBlYWNoLAogICogICBhbmQgdGhlIG90aGVyIHR3byB1c2Ug
bm90aGluZzsgd2hpbGUgZHVyaW5nIGFub3RoZXIgdGltZSBpbnRlcnZhbCwKLSAqICAgdHdvIHZD
UFVzIHVzZSA4MCUsIG9uZSB1c2VzIDEwJSBhbmQgdGhlIG90aGVyIDMwJTsgb3IgdGhhdCBlYWNo
IHVzZQorICogICB0d28gdW5pdHMgdXNlIDgwJSwgb25lIHVzZXMgMTAlIGFuZCB0aGUgb3RoZXIg
MzAlOyBvciB0aGF0IGVhY2ggdXNlCiAgKiAgIDUwJSAoYW5kIHNvIG9uIGFuZCBzbyBmb3J0aCku
CiAgKgogICogRm9yIGltcGxlbWVudGluZyB0aGlzLCB3ZSB1c2UgdGhlIGZvbGxvd2luZyBhcHBy
b2FjaDoKICAqCiAgKiAtIGVhY2ggZG9tYWluIGlzIGdpdmVuIGEgJ2J1ZGdldCcsIGFuIGVhY2gg
ZG9tYWluIGhhcyBhIHRpbWVyLCB3aGljaAogICogICByZXBsZW5pc2hlcyB0aGUgZG9tYWluJ3Mg
YnVkZ2V0IHBlcmlvZGljYWxseS4gVGhlIGJ1ZGdldCBpcyB0aGUgYW1vdW50Ci0gKiAgIG9mIHRp
bWUgdGhlIHZDUFVzIG9mIHRoZSBkb21haW4gY2FuIHVzZSBldmVyeSAncGVyaW9kJzsKKyAqICAg
b2YgdGltZSB0aGUgdW5pdHMgb2YgdGhlIGRvbWFpbiBjYW4gdXNlIGV2ZXJ5ICdwZXJpb2QnOwog
ICoKICAqIC0gdGhlIHBlcmlvZCBpcyBDU0NIRUQyX0JER1RfUkVQTF9QRVJJT0QsIGFuZCBpcyB0
aGUgc2FtZSBmb3IgYWxsIGRvbWFpbnMKICAqICAgKGJ1dCBlYWNoIGRvbWFpbiBoYXMgaXRzIG93
biB0aW1lcjsgc28gdGhlIGFsbCBhcmUgcGVyaW9kaWMgYnkgdGhlIHNhbWUKICAqICAgcGVyaW9k
LCBidXQgcmVwbGVuaXNobWVudCBvZiB0aGUgYnVkZ2V0cyBvZiB0aGUgdmFyaW91cyBkb21haW5z
LCBhdAogICogICBwZXJpb2RzIGJvdW5kYXJpZXMsIGFyZSBub3Qgc3luY2hyb25vdXMpOwogICoK
LSAqIC0gd2hlbiB2Q1BVcyBydW4sIHRoZXkgY29uc3VtZSBidWRnZXQuIFdoZW4gdGhleSBkb24n
dCBydW4sIHRoZXkgZG9uJ3QKLSAqICAgY29uc3VtZSBidWRnZXQuIElmIHRoZXJlIGlzIG5vIGJ1
ZGdldCBsZWZ0IGZvciB0aGUgZG9tYWluLCBubyB2Q1BVIG9mCi0gKiAgIHRoYXQgZG9tYWluIGNh
biBydW4uIElmIGEgdkNQVSB0cmllcyB0byBydW4gYW5kIGZpbmRzIHRoYXQgdGhlcmUgaXMgbm8K
KyAqIC0gd2hlbiB1bml0cyBydW4sIHRoZXkgY29uc3VtZSBidWRnZXQuIFdoZW4gdGhleSBkb24n
dCBydW4sIHRoZXkgZG9uJ3QKKyAqICAgY29uc3VtZSBidWRnZXQuIElmIHRoZXJlIGlzIG5vIGJ1
ZGdldCBsZWZ0IGZvciB0aGUgZG9tYWluLCBubyB1bml0IG9mCisgKiAgIHRoYXQgZG9tYWluIGNh
biBydW4uIElmIGFuIHVuaXQgdHJpZXMgdG8gcnVuIGFuZCBmaW5kcyB0aGF0IHRoZXJlIGlzIG5v
CiAgKiAgIGJ1ZGdldCwgaXQgYmxvY2tzLgotICogICBBdCB3aGF0ZXZlciB0aW1lIGEgdkNQVSB3
YW50cyB0byBydW4sIGl0IG11c3QgY2hlY2sgdGhlIGRvbWFpbidzIGJ1ZGdldCwKKyAqICAgQXQg
d2hhdGV2ZXIgdGltZSBhbiB1bml0IHdhbnRzIHRvIHJ1biwgaXQgbXVzdCBjaGVjayB0aGUgZG9t
YWluJ3MgYnVkZ2V0LAogICogICBhbmQgaWYgdGhlcmUgaXMgc29tZSwgaXQgY2FuIHVzZSBpdC4K
ICAqCiAgKiAtIGJ1ZGdldCBpcyByZXBsZW5pc2hlZCB0byB0aGUgdG9wIG9mIHRoZSBjYXBhY2l0
eSBmb3IgdGhlIGRvbWFpbiBvbmNlCkBAIC0xMjksMzkgKzEyOSwzOSBAQAogICogICB0aG91Z2gs
IHRoZSBidWRnZXQgYWZ0ZXIgYSByZXBsZW5pc2htZW50IHdpbGwgYWx3YXlzIGJlIGF0IG1vc3Qg
ZXF1YWwKICAqICAgdG8gdGhlIHRvdGFsIGNhcGFjaWZ5IG9mIHRoZSBkb21haW4gKCd0b3RfYnVk
Z2V0Jyk7CiAgKgotICogLSB3aGVuIGEgYnVkZ2V0IHJlcGxlbmlzaG1lbnQgb2NjdXJzLCBpZiB0
aGVyZSBhcmUgdkNQVXMgdGhhdCBoYWQgYmVlbgorICogLSB3aGVuIGEgYnVkZ2V0IHJlcGxlbmlz
aG1lbnQgb2NjdXJzLCBpZiB0aGVyZSBhcmUgdW5pdHMgdGhhdCBoYWQgYmVlbgogICogICBibG9j
a2VkIGJlY2F1c2Ugb2YgbGFjayBvZiBidWRnZXQsIHRoZXknbGwgYmUgdW5ibG9ja2VkLCBhbmQg
dGhleSB3aWxsCiAgKiAgIChwb3RlbnRpYWxseSkgYmUgYWJsZSB0byBydW4gYWdhaW4uCiAgKgog
ICogRmluYWxseSwgc29tZSBldmVuIG1vcmUgaW1wbGVtZW50YXRpb24gcmVsYXRlZCBkZXRhaWw6
CiAgKgotICogLSBidWRnZXQgaXMgc3RvcmVkIGluIGEgZG9tYWluLXdpZGUgcG9vbC4gdkNQVXMg
b2YgdGhlIGRvbWFpbiB0aGF0IHdhbnQKKyAqIC0gYnVkZ2V0IGlzIHN0b3JlZCBpbiBhIGRvbWFp
bi13aWRlIHBvb2wuIEl0ZW1zIG9mIHRoZSBkb21haW4gdGhhdCB3YW50CiAgKiAgIHRvIHJ1biBn
byB0byBzdWNoIHBvb2wsIGFuZCBncnViIHNvbWUuIFdoZW4gdGhleSBkbyBzbywgdGhlIGFtb3Vu
dAogICogICB0aGV5IGdyYWJiZWQgaXMgX2ltbWVkaWF0ZWx5XyByZW1vdmVkIGZyb20gdGhlIHBv
b2wuIFRoaXMgaGFwcGVucyBpbgotICogICB2Y3B1X2dyYWJfYnVkZ2V0KCk7CisgKiAgIHVuaXRf
Z3JhYl9idWRnZXQoKTsKICAqCi0gKiAtIHdoZW4gdkNQVXMgc3RvcCBydW5uaW5nLCBpZiB0aGV5
J3ZlIG5vdCBjb25zdW1lZCBhbGwgdGhlIGJ1ZGdldCB0aGV5CisgKiAtIHdoZW4gdW5pdHMgc3Rv
cCBydW5uaW5nLCBpZiB0aGV5J3ZlIG5vdCBjb25zdW1lZCBhbGwgdGhlIGJ1ZGdldCB0aGV5CiAg
KiAgIHRvb2ssIHRoZSBsZWZ0b3ZlciBpcyBwdXQgYmFjayBpbiB0aGUgcG9vbC4gVGhpcyBoYXBw
ZW5zIGluCi0gKiAgIHZjcHVfcmV0dXJuX2J1ZGdldCgpOworICogICB1bml0X3JldHVybl9idWRn
ZXQoKTsKICAqCi0gKiAtIHRoZSBhYm92ZSBtZWFucyB0aGF0IGEgdkNQVSBjYW4gZmluZCBvdXQg
dGhhdCB0aGVyZSBpcyBubyBidWRnZXQgYW5kCisgKiAtIHRoZSBhYm92ZSBtZWFucyB0aGF0IGFu
IHVuaXQgY2FuIGZpbmQgb3V0IHRoYXQgdGhlcmUgaXMgbm8gYnVkZ2V0IGFuZAogICogICBibG9j
aywgbm90IG9ubHkgaWYgdGhlIGNhcCBoYXMgYWN0dWFsbHkgYmVlbiByZWFjaGVkIChmb3IgdGhp
cyBwZXJpb2QpLAotICogICBidXQgYWxzbyBpZiBzb21lIG90aGVyIHZDUFVzLCBpbiBvcmRlciB0
byBydW4sIGhhdmUgZ3JhYmJlZCBhIGNlcnRhaW4KKyAqICAgYnV0IGFsc28gaWYgc29tZSBvdGhl
ciB1bml0cywgaW4gb3JkZXIgdG8gcnVuLCBoYXZlIGdyYWJiZWQgYSBjZXJ0YWluCiAgKiAgIHF1
b3RhIG9mIGJ1ZGdldCwgbm8gbWF0dGVyIHdoZXRoZXIgdGhleSd2ZSBhbHJlYWR5IHVzZWQgaXQg
YWxsIG9yIG5vdC4KLSAqICAgQSB2Q1BVIGJsb2NraW5nIGJlY2F1c2UgKGFueSBmb3JtIG9mKSBs
YWNrIG9mIGJ1ZGdldCBpcyBzYWlkIHRvIGJlCi0gKiAgICJwYXJrZWQiLCBhbmQgc3VjaCBibG9j
a2luZyBoYXBwZW5zIGluIHBhcmtfdmNwdSgpOworICogICBBbiB1bml0IGJsb2NraW5nIGJlY2F1
c2UgKGFueSBmb3JtIG9mKSBsYWNrIG9mIGJ1ZGdldCBpcyBzYWlkIHRvIGJlCisgKiAgICJwYXJr
ZWQiLCBhbmQgc3VjaCBibG9ja2luZyBoYXBwZW5zIGluIHBhcmtfdW5pdCgpOwogICoKLSAqIC0g
d2hlbiBhIHZDUFUgc3RvcHMgcnVubmluZywgYW5kIHB1dHMgYmFjayBzb21lIGJ1ZGdldCBpbiB0
aGUgZG9tYWluIHBvb2wsCisgKiAtIHdoZW4gYW4gdW5pdCBzdG9wcyBydW5uaW5nLCBhbmQgcHV0
cyBiYWNrIHNvbWUgYnVkZ2V0IGluIHRoZSBkb21haW4gcG9vbCwKICAqICAgd2UgbmVlZCB0byBj
aGVjayB3aGV0aGVyIHRoZXJlIGlzIHNvbWVvbmUgd2hpY2ggaGFzIGJlZW4gcGFya2VkIGFuZCB0
aGF0Ci0gKiAgIGNhbiBiZSB1bnBhcmtlZC4gVGhpcyBoYXBwZW5zIGluIHVucGFya19wYXJrZWRf
dmNwdXMoKSwgY2FsbGVkIGZyb20KKyAqICAgY2FuIGJlIHVucGFya2VkLiBUaGlzIGhhcHBlbnMg
aW4gdW5wYXJrX3BhcmtlZF91bml0cygpLCBjYWxsZWQgZnJvbQogICogICBjc2NoZWQyX2NvbnRl
eHRfc2F2ZWQoKTsKICAqCiAgKiAtIG9mIGNvdXJzZSwgdW5wYXJraW5nIGhhcHBlbnMgYWxzbyBh
cyBhIGNvbnNlcXVlbmNlIG9mIHRoZSBkb21haW4ncyBidWRnZXQKICAqICAgYmVpbmcgcmVwbGVu
aXNoZWQgYnkgdGhlIHBlcmlvZGljIHRpbWVyLiBUaGlzIGFsc28gb2NjdXJzIGJ5IG1lYW5zIG9m
CiAgKiAgIGNhbGxpbmcgY3NjaGVkMl9jb250ZXh0X3NhdmVkKCkgKGJ1dCBmcm9tIHJlcGxlbmlz
aF9kb21haW5fYnVkZ2V0KCkpOwogICoKLSAqIC0gcGFya2VkIHZDUFVzIG9mIGEgZG9tYWluIGFy
ZSBrZXB0IGluIGEgKHBlci1kb21haW4pIGxpc3QsIGNhbGxlZAotICogICAncGFya2VkX3ZjcHVz
JykuIE1hbmlwdWxhdGlvbiBvZiB0aGUgbGlzdCBhbmQgb2YgdGhlIGRvbWFpbi13aWRlIGJ1ZGdl
dAorICogLSBwYXJrZWQgdW5pdHMgb2YgYSBkb21haW4gYXJlIGtlcHQgaW4gYSAocGVyLWRvbWFp
bikgbGlzdCwgY2FsbGVkCisgKiAgICdwYXJrZWRfdW5pdHMnKS4gTWFuaXB1bGF0aW9uIG9mIHRo
ZSBsaXN0IGFuZCBvZiB0aGUgZG9tYWluLXdpZGUgYnVkZ2V0CiAgKiAgIHBvb2wsIG11c3Qgb2Nj
dXIgb25seSB3aGVuIGhvbGRpbmcgdGhlICdidWRnZXRfbG9jaycuCiAgKi8KIApAQCAtMTc0LDkg
KzE3NCw5IEBACiAgKiAgICAgcGNwdV9zY2hlZHVsZV9sb2NrKCkgLyB1bml0X3NjaGVkdWxlX2xv
Y2soKSAoYW5kIGZyaWVuZHMpLAogICogICAqIGEgY3B1IG1heSAodHJ5IHRvKSB0YWtlIGEgInJl
bW90ZSIgcnVucXVldWUgbG9jaywgZS5nLiwgZm9yCiAgKiAgICAgbG9hZCBiYWxhbmNpbmc7Ci0g
KiAgKyBzZXJpYWxpemVzIHJ1bnF1ZXVlIG9wZXJhdGlvbnMgKHJlbW92aW5nIGFuZCBpbnNlcnRp
bmcgdmNwdXMpOworICogICsgc2VyaWFsaXplcyBydW5xdWV1ZSBvcGVyYXRpb25zIChyZW1vdmlu
ZyBhbmQgaW5zZXJ0aW5nIHVuaXRzKTsKICAqICArIHByb3RlY3RzIHJ1bnF1ZXVlLXdpZGUgZGF0
YSBpbiBjc2NoZWQyX3J1bnF1ZXVlX2RhdGE7Ci0gKiAgKyBwcm90ZWN0cyB2Y3B1IHBhcmFtZXRl
cnMgaW4gY3NjaGVkMl91bml0IGZvciB0aGUgdmNwdSBpbiB0aGUKKyAqICArIHByb3RlY3RzIHVu
aXQgcGFyYW1ldGVycyBpbiBjc2NoZWQyX3VuaXQgZm9yIHRoZSB1bml0IGluIHRoZQogICogICAg
cnVucXVldWUuCiAgKgogICogLSBQcml2YXRlIHNjaGVkdWxlciBsb2NrCkBAIC0xOTAsOCArMTkw
LDggQEAKICAqICArIGl0IGlzIHBlci1kb21haW47CiAgKiAgKyBwcm90ZWN0cywgaW4gZG9tYWlu
cyB0aGF0IGhhdmUgYW4gdXRpbGl6YXRpb24gY2FwOwogICogICAqIG1hbmlwdWxhdGlvbiBvZiB0
aGUgdG90YWwgYnVkZ2V0IG9mIHRoZSBkb21haW4gKGFzIGl0IGlzIHNoYXJlZAotICogICAgIGFt
b25nIGFsbCB2Q1BVcyBvZiB0aGUgZG9tYWluKSwKLSAqICAgKiBtYW5pcHVsYXRpb24gb2YgdGhl
IGxpc3Qgb2YgdkNQVXMgdGhhdCBhcmUgYmxvY2tlZCB3YWl0aW5nIGZvcgorICogICAgIGFtb25n
IGFsbCB1bml0cyBvZiB0aGUgZG9tYWluKSwKKyAqICAgKiBtYW5pcHVsYXRpb24gb2YgdGhlIGxp
c3Qgb2YgdW5pdHMgdGhhdCBhcmUgYmxvY2tlZCB3YWl0aW5nIGZvcgogICogICAgIHNvbWUgYnVk
Z2V0IHRvIGJlIGF2YWlsYWJsZS4KICAqCiAgKiAtIFR5cGU6CkBAIC0yMjgsOSArMjI4LDkgQEAK
ICAqLwogI2RlZmluZSBDU0NIRUQyX0NSRURJVF9JTklUICAgICAgICAgIE1JTExJU0VDUygxMCkK
IC8qCi0gKiBBbW91bnQgb2YgY3JlZGl0IHRoZSBpZGxlIHZjcHVzIGhhdmUuIEl0IG5ldmVyIGNo
YW5nZXMsIGFzIGlkbGUKLSAqIHZjcHVzIGRvZXMgbm90IGNvbnN1bWUgY3JlZGl0cywgYW5kIGl0
IG11c3QgYmUgbG93ZXIgdGhhbiB3aGF0ZXZlcgotICogYW1vdW50IG9mIGNyZWRpdCAncmVndWxh
cicgdmNwdSB3b3VsZCBlbmQgdXAgd2l0aC4KKyAqIEFtb3VudCBvZiBjcmVkaXQgdGhlIGlkbGUg
dW5pdHMgaGF2ZS4gSXQgbmV2ZXIgY2hhbmdlcywgYXMgaWRsZQorICogdW5pdHMgZG9lcyBub3Qg
Y29uc3VtZSBjcmVkaXRzLCBhbmQgaXQgbXVzdCBiZSBsb3dlciB0aGFuIHdoYXRldmVyCisgKiBh
bW91bnQgb2YgY3JlZGl0ICdyZWd1bGFyJyB1bml0IHdvdWxkIGVuZCB1cCB3aXRoLgogICovCiAj
ZGVmaW5lIENTQ0hFRDJfSURMRV9DUkVESVQgICAgICAgICAgKC0oMVU8PDMwKSkKIC8qCkBAIC0y
NDMsOSArMjQzLDkgQEAKICAqIE1JTl9USU1FUi4KICAqLwogI2RlZmluZSBDU0NIRUQyX01JR1JB
VEVfUkVTSVNUICAgICAgICgob3B0X21pZ3JhdGVfcmVzaXN0KSpNSUNST1NFQ1MoMSkpCi0vKiBI
b3cgbXVjaCB0byAiY29tcGVuc2F0ZSIgYSB2Y3B1IGZvciBMMiBtaWdyYXRpb24uICovCisvKiBI
b3cgbXVjaCB0byAiY29tcGVuc2F0ZSIgYW4gdW5pdCBmb3IgTDIgbWlncmF0aW9uLiAqLwogI2Rl
ZmluZSBDU0NIRUQyX01JR1JBVEVfQ09NUEVOU0FUSU9OIE1JQ1JPU0VDUyg1MCkKLS8qIEhvdyB0
b2xlcmFudCB3ZSBzaG91bGQgYmUgd2hlbiBwZWVraW5nIGF0IHJ1bnRpbWUgb2YgdmNwdXMgb24g
b3RoZXIgY3B1cyAqLworLyogSG93IHRvbGVyYW50IHdlIHNob3VsZCBiZSB3aGVuIHBlZWtpbmcg
YXQgcnVudGltZSBvZiB1bml0cyBvbiBvdGhlciBjcHVzICovCiAjZGVmaW5lIENTQ0hFRDJfUkFU
RUxJTUlUX1RJQ0tMRV9UT0xFUkFOQ0UgTUlDUk9TRUNTKDUwKQogLyogUmVzZXQ6IFZhbHVlIGJl
bG93IHdoaWNoIGNyZWRpdCB3aWxsIGJlIHJlc2V0LiAqLwogI2RlZmluZSBDU0NIRUQyX0NSRURJ
VF9SRVNFVCAgICAgICAgIDAKQEAgLTI1OCw3ICsyNTgsNyBAQAogICogRmxhZ3MKICAqLwogLyoK
LSAqIENTRkxBR19zY2hlZHVsZWQ6IElzIHRoaXMgdmNwdSBlaXRoZXIgcnVubmluZyBvbiwgb3Ig
Y29udGV4dC1zd2l0Y2hpbmcgb2ZmLAorICogQ1NGTEFHX3NjaGVkdWxlZDogSXMgdGhpcyB1bml0
IGVpdGhlciBydW5uaW5nIG9uLCBvciBjb250ZXh0LXN3aXRjaGluZyBvZmYsCiAgKiBhIHBoeXNp
Y2FsIGNwdT8KICAqICsgQWNjZXNzZWQgb25seSB3aXRoIHJ1bnF1ZXVlIGxvY2sgaGVsZAogICog
KyBTZXQgd2hlbiBjaG9zZW4gYXMgbmV4dCBpbiBjc2NoZWQyX3NjaGVkdWxlKCkuCkBAIC0yODAs
MjEgKzI4MCwyMSBAQAogI2RlZmluZSBfX0NTRkxBR19kZWxheWVkX3J1bnFfYWRkIDIKICNkZWZp
bmUgQ1NGTEFHX2RlbGF5ZWRfcnVucV9hZGQgKDFVPDxfX0NTRkxBR19kZWxheWVkX3J1bnFfYWRk
KQogLyoKLSAqIENTRkxBR19ydW5xX21pZ3JhdGVfcmVxdWVzdDogVGhpcyB2Y3B1IGlzIGJlaW5n
IG1pZ3JhdGVkIGFzIGEgcmVzdWx0IG9mIGEKKyAqIENTRkxBR19ydW5xX21pZ3JhdGVfcmVxdWVz
dDogVGhpcyB1bml0IGlzIGJlaW5nIG1pZ3JhdGVkIGFzIGEgcmVzdWx0IG9mIGEKICAqIGNyZWRp
dDItaW5pdGlhdGVkIHJ1bnEgbWlncmF0ZSByZXF1ZXN0OyBtaWdyYXRlIGl0IHRvIHRoZSBydW5x
dWV1ZSBpbmRpY2F0ZWQKLSAqIGluIHRoZSBzdmMgc3RydWN0LiAKKyAqIGluIHRoZSBzdmMgc3Ry
dWN0LgogICovCiAjZGVmaW5lIF9fQ1NGTEFHX3J1bnFfbWlncmF0ZV9yZXF1ZXN0IDMKICNkZWZp
bmUgQ1NGTEFHX3J1bnFfbWlncmF0ZV9yZXF1ZXN0ICgxVTw8X19DU0ZMQUdfcnVucV9taWdyYXRl
X3JlcXVlc3QpCiAvKgotICogQ1NGTEFHX3ZjcHVfeWllbGQ6IHRoaXMgdmNwdSB3YXMgcnVubmlu
ZywgYW5kIGhhcyBjYWxsZWQgdmNwdV95aWVsZCgpLiBUaGUKKyAqIENTRkxBR191bml0X3lpZWxk
OiB0aGlzIHVuaXQgd2FzIHJ1bm5pbmcsIGFuZCBoYXMgY2FsbGVkIHZjcHVfeWllbGQoKS4gVGhl
CiAgKiBzY2hlZHVsZXIgaXMgaW52b2tlZCB0byBzZWUgaWYgd2UgY2FuIGdpdmUgdGhlIGNwdSB0
byBzb21lb25lIGVsc2UsIGFuZAotICogZ2V0IGJhY2sgdG8gdGhlIHlpZWxkaW5nIHZjcHUgaW4g
YSB3aGlsZS4KKyAqIGdldCBiYWNrIHRvIHRoZSB5aWVsZGluZyB1bml0IGluIGEgd2hpbGUuCiAg
Ki8KLSNkZWZpbmUgX19DU0ZMQUdfdmNwdV95aWVsZCA0Ci0jZGVmaW5lIENTRkxBR192Y3B1X3lp
ZWxkICgxVTw8X19DU0ZMQUdfdmNwdV95aWVsZCkKKyNkZWZpbmUgX19DU0ZMQUdfdW5pdF95aWVs
ZCA0CisjZGVmaW5lIENTRkxBR191bml0X3lpZWxkICgxVTw8X19DU0ZMQUdfdW5pdF95aWVsZCkK
IC8qCi0gKiBDU0ZMQUdTX3Bpbm5lZDogdGhpcyB2Y3B1IGlzIGN1cnJlbnRseSAncGlubmVkJywg
aS5lLiwgaGFzIGl0cyBoYXJkCisgKiBDU0ZMQUdTX3Bpbm5lZDogdGhpcyB1bml0IGlzIGN1cnJl
bnRseSAncGlubmVkJywgaS5lLiwgaGFzIGl0cyBoYXJkCiAgKiBhZmZpbml0eSBzZXQgdG8gb25l
IGFuZCBvbmx5IDEgY3B1IChhbmQsIGhlbmNlLCBjYW4gb25seSBydW4gdGhlcmUpLgogICovCiAj
ZGVmaW5lIF9fQ1NGTEFHX3Bpbm5lZCA1CkBAIC0zMDYsNyArMzA2LDcgQEAgaW50ZWdlcl9wYXJh
bSgic2NoZWRfY3JlZGl0Ml9taWdyYXRlX3Jlc2lzdCIsIG9wdF9taWdyYXRlX3Jlc2lzdCk7CiAv
KgogICogTG9hZCB0cmFja2luZyBhbmQgbG9hZCBiYWxhbmNpbmcKICAqCi0gKiBMb2FkIGhpc3Rv
cnkgb2YgcnVucXVldWVzIGFuZCB2Y3B1cyBpcyBhY2NvdW50ZWQgZm9yIGJ5IHVzaW5nIGFuCisg
KiBMb2FkIGhpc3Rvcnkgb2YgcnVucXVldWVzIGFuZCB1bml0cyBpcyBhY2NvdW50ZWQgZm9yIGJ5
IHVzaW5nIGFuCiAgKiBleHBvbmVudGlhbCB3ZWlnaHRlZCBtb3ZpbmcgYXZlcmFnZSBhbGdvcml0
aG0uIEhvd2V2ZXIsIGluc3RlYWQgb2YgdXNpbmcKICAqIGZyYWN0aW9ucyx3ZSBzaGlmdCBldmVy
eXRoaW5nIHRvIGxlZnQgYnkgdGhlIG51bWJlciBvZiBiaXRzIHdlIHdhbnQgdG8KICAqIHVzZSBm
b3IgcmVwcmVzZW50aW5nIHRoZSBmcmFjdGlvbmFsIHBhcnQgKFEtZm9ybWF0KS4KQEAgLTMyNiw3
ICszMjYsNyBAQCBpbnRlZ2VyX3BhcmFtKCJzY2hlZF9jcmVkaXQyX21pZ3JhdGVfcmVzaXN0Iiwg
b3B0X21pZ3JhdGVfcmVzaXN0KTsKICAqCiAgKiB3aGVyZSBXIGlzIHRoZSBsZW5ndGggb2YgdGhl
IHdpbmRvdywgUCB0aGUgbXVsdGlwbGllciBmb3IgdHJhbnNpdGlvbmcgaW50bwogICogUS1mb3Jt
YXQgZml4ZWQgcG9pbnQgYXJpdGhtZXRpYyBhbmQgbG9hZCBpcyB0aGUgaW5zdGFudGFuZW91cyBs
b2FkIG9mIGEKLSAqIHJ1bnF1ZXVlLCB3aGljaCBiYXNpY2FsbHkgaXMgdGhlIG51bWJlciBvZiBy
dW5uYWJsZSB2Y3B1cyB0aGVyZSBhcmUgb24gdGhlCisgKiBydW5xdWV1ZSwgd2hpY2ggYmFzaWNh
bGx5IGlzIHRoZSBudW1iZXIgb2YgcnVubmFibGUgdW5pdHMgdGhlcmUgYXJlIG9uIHRoZQogICog
cnVucXVldWUgKGZvciB0aGUgbWVhbmluZyBvZiB0aGUgb3RoZXIgdGVybXMsIGxvb2sgYXQgdGhl
IGRvYyBjb21tZW50IHRvCiAgKiAgdXBkYXRlX3J1bnFfbG9hZCgpKS4KICAqCkBAIC0zMzgsNyAr
MzM4LDcgQEAgaW50ZWdlcl9wYXJhbSgic2NoZWRfY3JlZGl0Ml9taWdyYXRlX3Jlc2lzdCIsIG9w
dF9taWdyYXRlX3Jlc2lzdCk7CiAgKiBUaGUgbWF4aW11bSBwb3NzaWJsZSB2YWx1ZSBmb3IgdGhl
IGF2ZXJhZ2UgbG9hZCwgd2hpY2ggd2Ugd2FudCB0byBzdG9yZSBpbgogICogc190aW1lX3QgdHlw
ZSB2YXJpYWJsZXMgKGkuZS4sIHdlIGhhdmUgNjMgYml0cyBhdmFpbGFibGUpIGlzIGxvYWQqUC4g
VGhpcwogICogbWVhbnMgdGhhdCwgd2l0aCBQIDE4IGJpdHMgd2lkZSwgbG9hZCBjYW4gb2NjdXB5
IDQ1IGJpdHMuIFRoaXMgaW4gdHVybgotICogbWVhbnMgd2UgY2FuIGhhdmUgMl40NSB2Y3B1cyBp
biBlYWNoIHJ1bnF1ZXVlLCBiZWZvcmUgb3ZlcmZsb3cgb2NjdXJzIQorICogbWVhbnMgd2UgY2Fu
IGhhdmUgMl40NSB1bml0cyBpbiBlYWNoIHJ1bnF1ZXVlLCBiZWZvcmUgb3ZlcmZsb3cgb2NjdXJz
IQogICoKICAqIEhvd2V2ZXIsIGl0IGNhbiBoYXBwZW4gdGhhdCwgYXQgc3RlcCBqKzEsIGlmOgog
ICoKQEAgLTM1NCwxMyArMzU0LDEzIEBAIGludGVnZXJfcGFyYW0oInNjaGVkX2NyZWRpdDJfbWln
cmF0ZV9yZXNpc3QiLCBvcHRfbWlncmF0ZV9yZXNpc3QpOwogICoKICAqICAyXig2MyAtIDMwIC0g
MTgpID0gMl4xNSA9IDMyNzY4CiAgKgotICogU28gMzI3NjggaXMgdGhlIG1heGltdW0gbnVtYmVy
IG9mIHZjcHVzIHRoZSB3ZSBjYW4gaGF2ZSBpbiBhIHJ1bnF1ZXVlLAorICogU28gMzI3NjggaXMg
dGhlIG1heGltdW0gbnVtYmVyIG9mIHVuaXRzIHRoZSB3ZSBjYW4gaGF2ZSBpbiBhIHJ1bnF1ZXVl
LAogICogYXQgYW55IGdpdmVuIHRpbWUsIGFuZCBzdGlsbCBub3QgaGF2ZSBwcm9ibGVtcyB3aXRo
IHRoZSBsb2FkIHRyYWNraW5nCiAgKiBjYWxjdWxhdGlvbnMuLi4gYW5kIHRoaXMgaXMgbW9yZSB0
aGFuIGZpbmUuCiAgKgogICogQXMgYSBtYXR0ZXIgb2YgZmFjdCwgc2luY2Ugd2UgYXJlIHVzaW5n
IG1pY3Jvc2Vjb25kcyBncmFudWxhcml0eSwgd2UgaGF2ZQogICogVz0yXjIwLiBTbywgc3RpbGwg
d2l0aCAxOCBmcmFjdGlvbmFsIGJpdHMgYW5kIGEgMSBzZWNvbmQgbG9uZyB3aW5kb3csIHRoZXJl
Ci0gKiBtYXkgYmUgMl4yNSA9IDMzNTU0NDMyIHZjcHVzIGluIGEgcnVucSBiZWZvcmUgd2UgaGF2
ZSB0byBzdGFydCB0aGlua2luZworICogbWF5IGJlIDJeMjUgPSAzMzU1NDQzMiB1bml0cyBpbiBh
IHJ1bnEgYmVmb3JlIHdlIGhhdmUgdG8gc3RhcnQgdGhpbmtpbmcKICAqIGFib3V0IG92ZXJmbG93
LgogICovCiAKQEAgLTQ2OCw3ICs0NjgsNyBAQCBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRh
IHsKICAgICBzdHJ1Y3QgbGlzdF9oZWFkIHJ1bnE7ICAgICAvKiBPcmRlcmVkIGxpc3Qgb2YgcnVu
bmFibGUgdm1zICAgICAgICAgICAgICAgKi8KICAgICBpbnQgaWQ7ICAgICAgICAgICAgICAgICAg
ICAvKiBJRCBvZiB0aGlzIHJ1bnF1ZXVlICgtMSBpZiBpbnZhbGlkKSAgICAgICAgKi8KIAotICAg
IGludCBsb2FkOyAgICAgICAgICAgICAgICAgIC8qIEluc3RhbnRhbmVvdXMgbG9hZCAobnVtIG9m
IG5vbi1pZGxlIHZjcHVzKSAqLworICAgIGludCBsb2FkOyAgICAgICAgICAgICAgICAgIC8qIElu
c3RhbnRhbmVvdXMgbG9hZCAobnVtIG9mIG5vbi1pZGxlIHVuaXRzKSAqLwogICAgIHNfdGltZV90
IGxvYWRfbGFzdF91cGRhdGU7IC8qIExhc3QgdGltZSBhdmVyYWdlIHdhcyB1cGRhdGVkICAgICAg
ICAgICAgICAqLwogICAgIHNfdGltZV90IGF2Z2xvYWQ7ICAgICAgICAgIC8qIERlY2F5aW5nIHF1
ZXVlIGxvYWQgICAgICAgICAgICAgICAgICAgICAgICAqLwogICAgIHNfdGltZV90IGJfYXZnbG9h
ZDsgICAgICAgIC8qIERlY2F5aW5nIHF1ZXVlIGxvYWQgbW9kaWZpZWQgYnkgYmFsYW5jaW5nICAq
LwpAQCAtNDc4LDggKzQ3OCw4IEBAIHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgewogICAg
ICAgICB0aWNrbGVkLCAgICAgICAgICAgICAgIC8qIEhhdmUgYmVlbiBhc2tlZCB0byBnbyB0aHJv
dWdoIHNjaGVkdWxlICAgICAqLwogICAgICAgICBpZGxlOyAgICAgICAgICAgICAgICAgIC8qIEN1
cnJlbnRseSBpZGxlIHBjcHVzICAgICAgICAgICAgICAgICAgICAgICAqLwogCi0gICAgc3RydWN0
IGxpc3RfaGVhZCBzdmM7ICAgICAgLyogTGlzdCBvZiBhbGwgdmNwdXMgYXNzaWduZWQgdG8gdGhl
IHJ1bnF1ZXVlICovCi0gICAgdW5zaWduZWQgaW50IG1heF93ZWlnaHQ7ICAgLyogTWF4IHdlaWdo
dCBvZiB0aGUgdmNwdXMgaW4gdGhpcyBydW5xdWV1ZSAgICovCisgICAgc3RydWN0IGxpc3RfaGVh
ZCBzdmM7ICAgICAgLyogTGlzdCBvZiBhbGwgdW5pdHMgYXNzaWduZWQgdG8gdGhlIHJ1bnF1ZXVl
ICovCisgICAgdW5zaWduZWQgaW50IG1heF93ZWlnaHQ7ICAgLyogTWF4IHdlaWdodCBvZiB0aGUg
dW5pdHMgaW4gdGhpcyBydW5xdWV1ZSAgICovCiAgICAgdW5zaWduZWQgaW50IHBpY2tfYmlhczsg
ICAgLyogTGFzdCBwaWNrZWQgcGNwdS4gU3RhcnQgZnJvbSBpdCBuZXh0IHRpbWUgICovCiB9Owog
CkBAIC01MDksMjAgKzUwOSwyMCBAQCBzdHJ1Y3QgY3NjaGVkMl9wY3B1IHsKIH07CiAKIC8qCi0g
KiBWaXJ0dWFsIENQVQorICogU2NoZWR1bGUgSXRlbQogICovCiBzdHJ1Y3QgY3NjaGVkMl91bml0
IHsKICAgICBzdHJ1Y3QgY3NjaGVkMl9kb20gKnNkb207ICAgICAgICAgIC8qIFVwLXBvaW50ZXIg
dG8gZG9tYWluICAgICAgICAgICAgICAgICovCi0gICAgc3RydWN0IHZjcHUgKnZjcHU7ICAgICAg
ICAgICAgICAgICAvKiBVcC1wb2ludGVyLCB0byB2Y3B1ICAgICAgICAgICAgICAgICAqLworICAg
IHN0cnVjdCBzY2hlZF91bml0ICp1bml0OyAgICAgICAgICAgLyogVXAtcG9pbnRlciwgdG8gc2No
ZWR1bGUgdW5pdCAgICAgICAgKi8KICAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpy
cWQ7IC8qIFVwLXBvaW50ZXIgdG8gdGhlIHJ1bnF1ZXVlICAgICAgICAgICovCiAKICAgICBpbnQg
Y3JlZGl0OyAgICAgICAgICAgICAgICAgICAgICAgIC8qIEN1cnJlbnQgYW1vdW50IG9mIGNyZWRp
dCAgICAgICAgICAgICovCi0gICAgdW5zaWduZWQgaW50IHdlaWdodDsgICAgICAgICAgICAgICAv
KiBXZWlnaHQgb2YgdGhpcyB2Y3B1ICAgICAgICAgICAgICAgICAqLworICAgIHVuc2lnbmVkIGlu
dCB3ZWlnaHQ7ICAgICAgICAgICAgICAgLyogV2VpZ2h0IG9mIHRoaXMgdW5pdCAgICAgICAgICAg
ICAgICAgKi8KICAgICB1bnNpZ25lZCBpbnQgcmVzaWR1YWw7ICAgICAgICAgICAgIC8qIFJlbWlu
ZGVyIG9mIGRpdihtYXhfd2VpZ2h0L3dlaWdodCkgICovCiAgICAgdW5zaWduZWQgZmxhZ3M7ICAg
ICAgICAgICAgICAgICAgICAvKiBTdGF0dXMgZmxhZ3MgKDE2IGJpdHMgd291bGQgYmUgb2ssICAq
LwogICAgIHNfdGltZV90IGJ1ZGdldDsgICAgICAgICAgICAgICAgICAgLyogQ3VycmVudCBidWRn
ZXQgKGlmIGRvbWFpbnMgaGFzIGNhcCkgKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIC8qIGJ1dCBjbGVhcl9iaXQoKSBkb2VzIG5vdCBsaWtlIHRoYXQpICovCi0gICAg
c190aW1lX3QgYnVkZ2V0X3F1b3RhOyAgICAgICAgICAgICAvKiBCdWRnZXQgdG8gd2hpY2ggdkNQ
VSBpcyBlbnRpdGxlZCAgICAqLworICAgIHNfdGltZV90IGJ1ZGdldF9xdW90YTsgICAgICAgICAg
ICAgLyogQnVkZ2V0IHRvIHdoaWNoIHVuaXQgaXMgZW50aXRsZWQgICAgKi8KIAogICAgIHNfdGlt
ZV90IHN0YXJ0X3RpbWU7ICAgICAgICAgICAgICAgLyogVGltZSB3ZSB3ZXJlIHNjaGVkdWxlZCAo
Zm9yIGNyZWRpdCkgKi8KIApAQCAtNTMxLDcgKzUzMSw3IEBAIHN0cnVjdCBjc2NoZWQyX3VuaXQg
ewogICAgIHNfdGltZV90IGF2Z2xvYWQ7ICAgICAgICAgICAgICAgICAgLyogRGVjYXlpbmcgcXVl
dWUgbG9hZCAgICAgICAgICAgICAgICAgKi8KIAogICAgIHN0cnVjdCBsaXN0X2hlYWQgcnVucV9l
bGVtOyAgICAgICAgLyogT24gdGhlIHJ1bnF1ZXVlIChycWQtPnJ1bnEpICAgICAgICAgKi8KLSAg
ICBzdHJ1Y3QgbGlzdF9oZWFkIHBhcmtlZF9lbGVtOyAgICAgIC8qIE9uIHRoZSBwYXJrZWRfdmNw
dXMgbGlzdCAgICAgICAgICAgICovCisgICAgc3RydWN0IGxpc3RfaGVhZCBwYXJrZWRfZWxlbTsg
ICAgICAvKiBPbiB0aGUgcGFya2VkX3VuaXRzIGxpc3QgICAgICAgICAgICAqLwogICAgIHN0cnVj
dCBsaXN0X2hlYWQgcnFkX2VsZW07ICAgICAgICAgLyogT24gY3NjaGVkMl9ydW5xdWV1ZV9kYXRh
J3Mgc3ZjIGxpc3QgKi8KICAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICptaWdyYXRl
X3JxZDsgLyogUHJlLWRldGVybWluZWQgbWlnci4gdGFyZ2V0ICovCiAgICAgaW50IHRpY2tsZWRf
Y3B1OyAgICAgICAgICAgICAgICAgICAvKiBDcHUgdGhhdCB3aWxsIHBpY2sgdXMgKC0xIGlmIG5v
bmUpICAqLwpAQCAtNTQ5LDEyICs1NDksMTIgQEAgc3RydWN0IGNzY2hlZDJfZG9tIHsKIAogICAg
IHN0cnVjdCB0aW1lciByZXBsX3RpbWVyOyAgICAvKiBUaW1lciBmb3IgcGVyaW9kaWMgcmVwbGVu
aXNobWVudCBvZiBidWRnZXQgKi8KICAgICBzX3RpbWVfdCBuZXh0X3JlcGw7ICAgICAgICAgLyog
VGltZSBhdCB3aGljaCBuZXh0IHJlcGxlbmlzaG1lbnQgb2NjdXJzICAgICovCi0gICAgc3RydWN0
IGxpc3RfaGVhZCBwYXJrZWRfdmNwdXM7IC8qIExpc3Qgb2YgQ1BVcyB3YWl0aW5nIGZvciBidWRn
ZXQgICAgICAgICAqLworICAgIHN0cnVjdCBsaXN0X2hlYWQgcGFya2VkX3VuaXRzOyAvKiBMaXN0
IG9mIENQVXMgd2FpdGluZyBmb3IgYnVkZ2V0ICAgICAgICAgKi8KIAogICAgIHN0cnVjdCBsaXN0
X2hlYWQgc2RvbV9lbGVtOyAvKiBPbiBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEncyBzZG9tIGxpc3Qg
ICAgICAgKi8KICAgICB1aW50MTZfdCB3ZWlnaHQ7ICAgICAgICAgICAgLyogVXNlciBzcGVjaWZp
ZWQgd2VpZ2h0ICAgICAgICAgICAgICAgICAgICAgICovCiAgICAgdWludDE2X3QgY2FwOyAgICAg
ICAgICAgICAgIC8qIFVzZXIgc3BlY2lmaWVkIGNhcCAgICAgICAgICAgICAgICAgICAgICAgICAq
LwotICAgIHVpbnQxNl90IG5yX3ZjcHVzOyAgICAgICAgICAvKiBOdW1iZXIgb2YgdmNwdXMgb2Yg
dGhpcyBkb21haW4gICAgICAgICAgICAgKi8KKyAgICB1aW50MTZfdCBucl91bml0czsgICAgICAg
ICAgLyogTnVtYmVyIG9mIHVuaXRzIG9mIHRoaXMgZG9tYWluICAgICAgICAgICAgICovCiB9Owog
CiAvKgpAQCAtNTkzLDcgKzU5Myw3IEBAIHN0YXRpYyBpbmxpbmUgc3RydWN0IGNzY2hlZDJfcnVu
cXVldWVfZGF0YSAqYzJycWQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAgIHJldHVy
biAmY3NjaGVkMl9wcml2KG9wcyktPnJxZFtjMnIoY3B1KV07CiB9CiAKLS8qIERvZXMgdGhlIGRv
bWFpbiBvZiB0aGlzIHZDUFUgaGF2ZSBhIGNhcD8gKi8KKy8qIERvZXMgdGhlIGRvbWFpbiBvZiB0
aGlzIHVuaXQgaGF2ZSBhIGNhcD8gKi8KIHN0YXRpYyBpbmxpbmUgYm9vbCBoYXNfY2FwKGNvbnN0
IHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YykKIHsKICAgICByZXR1cm4gc3ZjLT5idWRnZXQgIT0g
U1RJTUVfTUFYOwpAQCAtNjExLDI0ICs2MTEsMjQgQEAgc3RhdGljIGlubGluZSBib29sIGhhc19j
YXAoY29uc3Qgc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQogICogICAgc210X2lkbGUgbWFzay4K
ICAqCiAgKiBPbmNlIHdlIGhhdmUgc3VjaCBhIG1hc2ssIGl0IGlzIGVhc3kgdG8gaW1wbGVtZW50
IGEgcG9saWN5IHRoYXQsIGVpdGhlcjoKLSAqICAtIHVzZXMgZnVsbHkgaWRsZSBjb3JlcyBmaXJz
dDogaXQgaXMgZW5vdWdoIHRvIHRyeSB0byBzY2hlZHVsZSB0aGUgdmNwdXMKKyAqICAtIHVzZXMg
ZnVsbHkgaWRsZSBjb3JlcyBmaXJzdDogaXQgaXMgZW5vdWdoIHRvIHRyeSB0byBzY2hlZHVsZSB0
aGUgdW5pdHMKICAqICAgIG9uIHBjcHVzIGZyb20gc210X2lkbGUgbWFzayBmaXJzdC4gVGhpcyBp
cyB3aGF0IGhhcHBlbnMgaWYKICAqICAgIHNjaGVkX3NtdF9wb3dlcl9zYXZpbmdzIHdhcyBub3Qg
c2V0IGF0IGJvb3QgKGRlZmF1bHQpLCBhbmQgaXQgbWF4aW1pemVzCiAgKiAgICB0cnVlIHBhcmFs
bGVsaXNtLCBhbmQgaGVuY2UgcGVyZm9ybWFuY2U7Ci0gKiAgLSB1c2VzIGFscmVhZHkgYnVzeSBj
b3JlcyBmaXJzdDogaXQgaXMgZW5vdWdoIHRvIHRyeSB0byBzY2hlZHVsZSB0aGUgdmNwdXMKKyAq
ICAtIHVzZXMgYWxyZWFkeSBidXN5IGNvcmVzIGZpcnN0OiBpdCBpcyBlbm91Z2ggdG8gdHJ5IHRv
IHNjaGVkdWxlIHRoZSB1bml0cwogICogICAgb24gcGNwdXMgdGhhdCBhcmUgaWRsZSwgYnV0IGFy
ZSBub3QgaW4gc210X2lkbGUuIFRoaXMgaXMgd2hhdCBoYXBwZW5zIGlmCiAgKiAgICBzY2hlZF9z
bXRfcG93ZXJfc2F2aW5ncyBpcyBzZXQgYXQgYm9vdCwgYW5kIGl0IGFsbG93cyBhcyBtb3JlIGNv
cmVzIGFzCiAgKiAgICBwb3NzaWJsZSB0byBzdGF5IGluIGxvdyBwb3dlciBzdGF0ZXMsIG1pbmlt
aXppbmcgcG93ZXIgY29uc3VtcHRpb24uCiAgKgogICogVGhpcyBsb2dpYyBpcyBlbnRpcmVseSBp
bXBsZW1lbnRlZCBpbiBydW5xX3RpY2tsZSgpLCBhbmQgdGhhdCBpcyBlbm91Z2guCi0gKiBJbiBm
YWN0LCBpbiB0aGlzIHNjaGVkdWxlciwgcGxhY2VtZW50IG9mIGEgdmNwdSBvbiBvbmUgb2YgdGhl
IHBjcHVzIG9mIGEKKyAqIEluIGZhY3QsIGluIHRoaXMgc2NoZWR1bGVyLCBwbGFjZW1lbnQgb2Yg
YW4gdW5pdCBvbiBvbmUgb2YgdGhlIHBjcHVzIG9mIGEKICAqIHJ1bnEsIF9hbHdheXNfIGhhcHBl
bnMgYnkgbWVhbnMgb2YgdGlja2xpbmc6Ci0gKiAgLSB3aGVuIGEgdmNwdSB3YWtlcyB1cCwgaXQg
Y2FsbHMgY3NjaGVkMl91bml0X3dha2UoKSwgd2hpY2ggY2FsbHMKKyAqICAtIHdoZW4gYW4gdW5p
dCB3YWtlcyB1cCwgaXQgY2FsbHMgY3NjaGVkMl91bml0X3dha2UoKSwgd2hpY2ggY2FsbHMKICAq
ICAgIHJ1bnFfdGlja2xlKCk7CiAgKiAgLSB3aGVuIGEgbWlncmF0aW9uIGlzIGluaXRpYXRlZCBp
biBzY2hlZHVsZS5jLCB3ZSBjYWxsIGNzY2hlZDJfcmVzX3BpY2soKSwKICAqICAgIGNzY2hlZDJf
dW5pdF9taWdyYXRlKCkgKHdoaWNoIGNhbGxzIG1pZ3JhdGUoKSkgYW5kIGNzY2hlZDJfdW5pdF93
YWtlKCkuCiAgKiAgICBjc2NoZWQyX3Jlc19waWNrKCkgbG9va3MgZm9yIHRoZSBsZWFzdCBsb2Fk
ZWQgcnVucSBhbmQgcmV0dXJuIGp1c3QgYW55Ci0gKiAgICBvZiBpdHMgcHJvY2Vzc29ycy4gVGhl
biwgY3NjaGVkMl91bml0X21pZ3JhdGUoKSBqdXN0IG1vdmVzIHRoZSB2Y3B1IHRvCisgKiAgICBv
ZiBpdHMgcHJvY2Vzc29ycy4gVGhlbiwgY3NjaGVkMl91bml0X21pZ3JhdGUoKSBqdXN0IG1vdmVz
IHRoZSB1bml0IHRvCiAgKiAgICB0aGUgY2hvc2VuIHJ1bnEsIGFuZCBpdCBpcyBhZ2FpbiBydW5x
X3RpY2tsZSgpLCBjYWxsZWQgYnkKICAqICAgIGNzY2hlZDJfdW5pdF93YWtlKCkgdGhhdCBhY3R1
YWxseSBkZWNpZGVzIHdoYXQgcGNwdSB0byB1c2Ugd2l0aGluIHRoZQogICogICAgY2hvc2VuIHJ1
bnE7CkBAIC02NDMsNyArNjQzLDcgQEAgc3RhdGljIGlubGluZSBib29sIGhhc19jYXAoY29uc3Qg
c3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQogICoKICAqIE5CIHRoYXQgcnFkLT5zbXRfaWRsZSBp
cyBkaWZmZXJlbnQgdGhhbiBycWQtPmlkbGUuICBycWQtPmlkbGUKICAqIHJlY29yZHMgcGNwdXMg
dGhhdCBhdCBhcmUgbWVyZWx5IGlkbGUgKGkuZS4sIGF0IHRoZSBtb21lbnQgZG8gbm90Ci0gKiBo
YXZlIGEgdmNwdSBydW5uaW5nIG9uIHRoZW0pLiAgQnV0IHlvdSBoYXZlIHRvIG1hbnVhbGx5IGZp
bHRlciBvdXQKKyAqIGhhdmUgYW4gdW5pdCBydW5uaW5nIG9uIHRoZW0pLiAgQnV0IHlvdSBoYXZl
IHRvIG1hbnVhbGx5IGZpbHRlciBvdXQKICAqIHdoaWNoIHBjcHVzIGhhdmUgYmVlbiB0aWNrbGVk
IGluIG9yZGVyIHRvIGZpbmQgY29yZXMgdGhhdCBhcmUgbm90CiAgKiBnb2luZyB0byBiZSBidXN5
IHNvb24uICBGaWx0ZXJpbmcgb3V0IHRpY2tsZWQgY3B1cyBwYWlyd2lzZSBpcyBhCiAgKiBsb3Qg
b2YgZXh0cmEgcGFpbjsgc28gZm9yIHJxZC0+c210X2lkbGUsIHdlIGV4cGxpY2l0bHkgbWFrZSBz
byB0aGF0CkBAIC02OTAsMjQgKzY5MCwyNCBAQCB2b2lkIHNtdF9pZGxlX21hc2tfY2xlYXIodW5z
aWduZWQgaW50IGNwdSwgY3B1bWFza190ICptYXNrKQogICovCiBzdGF0aWMgaW50IGdldF9mYWxs
YmFja19jcHUoc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQogewotICAgIHN0cnVjdCB2Y3B1ICp2
ID0gc3ZjLT52Y3B1OworICAgIHN0cnVjdCBzY2hlZF91bml0ICp1bml0ID0gc3ZjLT51bml0Owog
ICAgIHVuc2lnbmVkIGludCBiczsKIAogICAgIFNDSEVEX1NUQVRfQ1JBTksobmVlZF9mYWxsYmFj
a19jcHUpOwogCiAgICAgZm9yX2VhY2hfYWZmaW5pdHlfYmFsYW5jZV9zdGVwKCBicyApCiAgICAg
ewotICAgICAgICBpbnQgY3B1ID0gdi0+cHJvY2Vzc29yOworICAgICAgICBpbnQgY3B1ID0gc2No
ZWRfdW5pdF9jcHUodW5pdCk7CiAKLSAgICAgICAgaWYgKCBicyA9PSBCQUxBTkNFX1NPRlRfQUZG
SU5JVFkgJiYgIWhhc19zb2Z0X2FmZmluaXR5KHYtPnNjaGVkX3VuaXQpICkKKyAgICAgICAgaWYg
KCBicyA9PSBCQUxBTkNFX1NPRlRfQUZGSU5JVFkgJiYgIWhhc19zb2Z0X2FmZmluaXR5KHVuaXQp
ICkKICAgICAgICAgICAgIGNvbnRpbnVlOwogCi0gICAgICAgIGFmZmluaXR5X2JhbGFuY2VfY3B1
bWFzayh2LT5zY2hlZF91bml0LCBicywgY3B1bWFza19zY3JhdGNoX2NwdShjcHUpKTsKKyAgICAg
ICAgYWZmaW5pdHlfYmFsYW5jZV9jcHVtYXNrKHVuaXQsIGJzLCBjcHVtYXNrX3NjcmF0Y2hfY3B1
KGNwdSkpOwogICAgICAgICBjcHVtYXNrX2FuZChjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksIGNw
dW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwKLSAgICAgICAgICAgICAgICAgICAgY3B1cG9vbF9kb21h
aW5fY3B1bWFzayh2LT5kb21haW4pKTsKKyAgICAgICAgICAgICAgICAgICAgY3B1cG9vbF9kb21h
aW5fY3B1bWFzayh1bml0LT5kb21haW4pKTsKIAogICAgICAgICAvKgotICAgICAgICAgKiBUaGlz
IGlzIGNhc2VzIDEgb3IgMyAoZGVwZW5kaW5nIG9uIGJzKTogaWYgdi0+cHJvY2Vzc29yIGlzIChz
dGlsbCkKKyAgICAgICAgICogVGhpcyBpcyBjYXNlcyAxIG9yIDMgKGRlcGVuZGluZyBvbiBicyk6
IGlmIHByb2Nlc3NvciBpcyAoc3RpbGwpCiAgICAgICAgICAqIGluIG91ciBhZmZpbml0eSwgZ28g
Zm9yIGl0LCBmb3IgY2FjaGUgYmV0dGVybmVzcy4KICAgICAgICAgICovCiAgICAgICAgIGlmICgg
bGlrZWx5KGNwdW1hc2tfdGVzdF9jcHUoY3B1LCBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSkpKSAp
CkBAIC03MjksNyArNzI5LDcgQEAgc3RhdGljIGludCBnZXRfZmFsbGJhY2tfY3B1KHN0cnVjdCBj
c2NoZWQyX3VuaXQgKnN2YykKICAgICAgICAgICogV2UgbWF5IHdlbGwgcGljayBhbnkgdmFsaWQg
cGNwdSBmcm9tIG91ciBzb2Z0LWFmZmluaXR5LCBvdXRzaWRlCiAgICAgICAgICAqIG9mIG91ciBj
dXJyZW50IHJ1bnF1ZXVlLCBidXQgd2UgZGVjaWRlIG5vdCB0by4gSW4gZmFjdCwgY2hhbmdpbmcK
ICAgICAgICAgICogcnVucXVldWUgaXMgc2xvdywgYWZmZWN0cyBsb2FkIGRpc3RyaWJ1dGlvbiwg
YW5kIGlzIGEgc291cmNlIG9mCi0gICAgICAgICAqIG92ZXJoZWFkIGZvciB0aGUgdmNwdXMgcnVu
bmluZyBvbiB0aGUgb3RoZXIgcnVucXVldWUgKHdlIG5lZWQgdGhlCisgICAgICAgICAqIG92ZXJo
ZWFkIGZvciB0aGUgdW5pdHMgcnVubmluZyBvbiB0aGUgb3RoZXIgcnVucXVldWUgKHdlIG5lZWQg
dGhlCiAgICAgICAgICAqIGxvY2spLiBTbywgYmV0dGVyIGRvIHRoYXQgYXMgYSBjb25zZXF1ZW5j
ZSBvZiBhIHdlbGwgaW5mb3JtZWQKICAgICAgICAgICogZGVjaXNpb24gKG9yIGlmIHdlIHJlYWxs
eSBkb24ndCBoYXZlIGFueSBvdGhlciBjaGFuY2UsIGFzIHdlIHdpbGwsCiAgICAgICAgICAqIGF0
IHN0ZXAgNSwgaWYgd2UgZ2V0IHRvIHRoZXJlKS4KQEAgLTc2MSw3ICs3NjEsNyBAQCBzdGF0aWMg
aW50IGdldF9mYWxsYmFja19jcHUoc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQogICAgICAqIFdl
IGNhbid0IGJlIGhlcmUuICBCdXQgaWYgdGhhdCBzb21laG93IGhhcHBlbiAoaW4gbm9uLWRlYnVn
IGJ1aWxkcyksCiAgICAgICogYXQgbGVhc3QgcmV0dXJuIHNvbWV0aGluZyB3aGljaCBib3RoIG9u
bGluZSBhbmQgaW4gb3VyIGhhcmQtYWZmaW5pdHkuCiAgICAgICovCi0gICAgcmV0dXJuIGNwdW1h
c2tfYW55KGNwdW1hc2tfc2NyYXRjaF9jcHUodi0+cHJvY2Vzc29yKSk7CisgICAgcmV0dXJuIGNw
dW1hc2tfYW55KGNwdW1hc2tfc2NyYXRjaF9jcHUoc2NoZWRfdW5pdF9jcHUodW5pdCkpKTsKIH0K
IAogLyoKQEAgLTc5MCw3ICs3OTAsNyBAQCBzdGF0aWMgc190aW1lX3QgYzJ0KHN0cnVjdCBjc2No
ZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCwgc190aW1lX3QgY3JlZGl0LCBzdHJ1Y3QgYwogICogUnVu
cXVldWUgcmVsYXRlZCBjb2RlLgogICovCiAKLXN0YXRpYyBpbmxpbmUgaW50IHZjcHVfb25fcnVu
cShzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMpCitzdGF0aWMgaW5saW5lIGludCB1bml0X29uX3J1
bnEoc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQogewogICAgIHJldHVybiAhbGlzdF9lbXB0eSgm
c3ZjLT5ydW5xX2VsZW0pOwogfQpAQCAtOTQ4LDE3ICs5NDgsMTcgQEAgX3J1bnFfYXNzaWduKHN0
cnVjdCBjc2NoZWQyX3VuaXQgKnN2Yywgc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFk
KQogCiAgICAgdXBkYXRlX21heF93ZWlnaHQoc3ZjLT5ycWQsIHN2Yy0+d2VpZ2h0LCAwKTsKIAot
ICAgIC8qIEV4cGVjdGVkIG5ldyBsb2FkIGJhc2VkIG9uIGFkZGluZyB0aGlzIHZjcHUgKi8KKyAg
ICAvKiBFeHBlY3RlZCBuZXcgbG9hZCBiYXNlZCBvbiBhZGRpbmcgdGhpcyB1bml0ICovCiAgICAg
cnFkLT5iX2F2Z2xvYWQgKz0gc3ZjLT5hdmdsb2FkOwogCiAgICAgaWYgKCB1bmxpa2VseSh0Yl9p
bml0X2RvbmUpICkKICAgICB7CiAgICAgICAgIHN0cnVjdCB7Ci0gICAgICAgICAgICB1bnNpZ25l
ZCB2Y3B1OjE2LCBkb206MTY7CisgICAgICAgICAgICB1bnNpZ25lZCB1bml0OjE2LCBkb206MTY7
CiAgICAgICAgICAgICB1bnNpZ25lZCBycWk6MTY7CiAgICAgICAgIH0gZDsKLSAgICAgICAgZC5k
b20gPSBzdmMtPnZjcHUtPmRvbWFpbi0+ZG9tYWluX2lkOwotICAgICAgICBkLnZjcHUgPSBzdmMt
PnZjcHUtPnZjcHVfaWQ7CisgICAgICAgIGQuZG9tID0gc3ZjLT51bml0LT5kb21haW4tPmRvbWFp
bl9pZDsKKyAgICAgICAgZC51bml0ID0gc3ZjLT51bml0LT51bml0X2lkOwogICAgICAgICBkLnJx
aT1ycWQtPmlkOwogICAgICAgICBfX3RyYWNlX3ZhcihUUkNfQ1NDSEVEMl9SVU5RX0FTU0lHTiwg
MSwKICAgICAgICAgICAgICAgICAgICAgc2l6ZW9mKGQpLApAQCAtOTY4LDEzICs5NjgsMTMgQEAg
X3J1bnFfYXNzaWduKHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2Yywgc3RydWN0IGNzY2hlZDJfcnVu
cXVldWVfZGF0YSAqcnFkKQogfQogCiBzdGF0aWMgdm9pZAotcnVucV9hc3NpZ24oY29uc3Qgc3Ry
dWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgdmNwdSAqdmMpCitydW5xX2Fzc2lnbihjb25zdCBz
dHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogewotICAgIHN0
cnVjdCBjc2NoZWQyX3VuaXQgKnN2YyA9IHZjLT5zY2hlZF91bml0LT5wcml2OworICAgIHN0cnVj
dCBjc2NoZWQyX3VuaXQgKnN2YyA9IHVuaXQtPnByaXY7CiAKICAgICBBU1NFUlQoc3ZjLT5ycWQg
PT0gTlVMTCk7CiAKLSAgICBfcnVucV9hc3NpZ24oc3ZjLCBjMnJxZChvcHMsIHZjLT5wcm9jZXNz
b3IpKTsKKyAgICBfcnVucV9hc3NpZ24oc3ZjLCBjMnJxZChvcHMsIHNjaGVkX3VuaXRfY3B1KHVu
aXQpKSk7CiB9CiAKIHN0YXRpYyB2b2lkCkBAIC05ODIsMjQgKzk4MiwyNCBAQCBfcnVucV9kZWFz
c2lnbihzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMpCiB7CiAgICAgc3RydWN0IGNzY2hlZDJfcnVu
cXVldWVfZGF0YSAqcnFkID0gc3ZjLT5ycWQ7CiAKLSAgICBBU1NFUlQoIXZjcHVfb25fcnVucShz
dmMpKTsKKyAgICBBU1NFUlQoIXVuaXRfb25fcnVucShzdmMpKTsKICAgICBBU1NFUlQoIShzdmMt
PmZsYWdzICYgQ1NGTEFHX3NjaGVkdWxlZCkpOwogCiAgICAgbGlzdF9kZWxfaW5pdCgmc3ZjLT5y
cWRfZWxlbSk7CiAgICAgdXBkYXRlX21heF93ZWlnaHQocnFkLCAwLCBzdmMtPndlaWdodCk7CiAK
LSAgICAvKiBFeHBlY3RlZCBuZXcgbG9hZCBiYXNlZCBvbiByZW1vdmluZyB0aGlzIHZjcHUgKi8K
KyAgICAvKiBFeHBlY3RlZCBuZXcgbG9hZCBiYXNlZCBvbiByZW1vdmluZyB0aGlzIHVuaXQgKi8K
ICAgICBycWQtPmJfYXZnbG9hZCA9IG1heF90KHNfdGltZV90LCBycWQtPmJfYXZnbG9hZCAtIHN2
Yy0+YXZnbG9hZCwgMCk7CiAKICAgICBzdmMtPnJxZCA9IE5VTEw7CiB9CiAKIHN0YXRpYyB2b2lk
Ci1ydW5xX2RlYXNzaWduKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHZjcHUg
KnZjKQorcnVucV9kZWFzc2lnbihjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBz
Y2hlZF91bml0ICp1bml0KQogewotICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YyA9IHZjLT5z
Y2hlZF91bml0LT5wcml2OworICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YyA9IHVuaXQtPnBy
aXY7CiAKLSAgICBBU1NFUlQoc3ZjLT5ycWQgPT0gYzJycWQob3BzLCB2Yy0+cHJvY2Vzc29yKSk7
CisgICAgQVNTRVJUKHN2Yy0+cnFkID09IGMycnFkKG9wcywgc2NoZWRfdW5pdF9jcHUodW5pdCkp
KTsKIAogICAgIF9ydW5xX2RlYXNzaWduKHN2Yyk7CiB9CkBAIC0xMjAyLDE1ICsxMjAyLDE1IEBA
IHVwZGF0ZV9zdmNfbG9hZChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAgICAgICAgICAg
ICAgICAgc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjLCBpbnQgY2hhbmdlLCBzX3RpbWVfdCBub3cp
CiB7CiAgICAgc3RydWN0IGNzY2hlZDJfcHJpdmF0ZSAqcHJ2ID0gY3NjaGVkMl9wcml2KG9wcyk7
Ci0gICAgc190aW1lX3QgZGVsdGEsIHZjcHVfbG9hZDsKKyAgICBzX3RpbWVfdCBkZWx0YSwgdW5p
dF9sb2FkOwogICAgIHVuc2lnbmVkIGludCBQLCBXOwogCiAgICAgaWYgKCBjaGFuZ2UgPT0gLTEg
KQotICAgICAgICB2Y3B1X2xvYWQgPSAxOworICAgICAgICB1bml0X2xvYWQgPSAxOwogICAgIGVs
c2UgaWYgKCBjaGFuZ2UgPT0gMSApCi0gICAgICAgIHZjcHVfbG9hZCA9IDA7CisgICAgICAgIHVu
aXRfbG9hZCA9IDA7CiAgICAgZWxzZQotICAgICAgICB2Y3B1X2xvYWQgPSB2Y3B1X3J1bm5hYmxl
KHN2Yy0+dmNwdSk7CisgICAgICAgIHVuaXRfbG9hZCA9IHVuaXRfcnVubmFibGUoc3ZjLT51bml0
KTsKIAogICAgIFcgPSBwcnYtPmxvYWRfd2luZG93X3NoaWZ0OwogICAgIFAgPSBwcnYtPmxvYWRf
cHJlY2lzaW9uX3NoaWZ0OwpAQCAtMTIxOCw3ICsxMjE4LDcgQEAgdXBkYXRlX3N2Y19sb2FkKGNv
bnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKIAogICAgIGlmICggc3ZjLT5sb2FkX2xhc3RfdXBk
YXRlICsgKDFVTEwgPDwgVykgPCBub3cgKQogICAgIHsKLSAgICAgICAgc3ZjLT5hdmdsb2FkID0g
dmNwdV9sb2FkIDw8IFA7CisgICAgICAgIHN2Yy0+YXZnbG9hZCA9IHVuaXRfbG9hZCA8PCBQOwog
ICAgIH0KICAgICBlbHNlCiAgICAgewpAQCAtMTIzMSw3ICsxMjMxLDcgQEAgdXBkYXRlX3N2Y19s
b2FkKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKICAgICAgICAgfQogCiAgICAgICAgIHN2
Yy0+YXZnbG9hZCA9IHN2Yy0+YXZnbG9hZCArCi0gICAgICAgICAgICAgICAgICAgICAgICgoZGVs
dGEgKiAodmNwdV9sb2FkIDw8IFApKSA+PiBXKSAtCisgICAgICAgICAgICAgICAgICAgICAgICgo
ZGVsdGEgKiAodW5pdF9sb2FkIDw8IFApKSA+PiBXKSAtCiAgICAgICAgICAgICAgICAgICAgICAg
ICgoZGVsdGEgKiBzdmMtPmF2Z2xvYWQpID4+IFcpOwogICAgIH0KICAgICBzdmMtPmxvYWRfbGFz
dF91cGRhdGUgPSBub3c7CkBAIC0xMjQzLDE0ICsxMjQzLDE0IEBAIHVwZGF0ZV9zdmNfbG9hZChj
b25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAgICAgewogICAgICAgICBzdHJ1Y3QgewogICAg
ICAgICAgICAgdWludDY0X3Qgdl9hdmdsb2FkOwotICAgICAgICAgICAgdW5zaWduZWQgdmNwdTox
NiwgZG9tOjE2OworICAgICAgICAgICAgdW5zaWduZWQgdW5pdDoxNiwgZG9tOjE2OwogICAgICAg
ICAgICAgdW5zaWduZWQgc2hpZnQ7CiAgICAgICAgIH0gZDsKLSAgICAgICAgZC5kb20gPSBzdmMt
PnZjcHUtPmRvbWFpbi0+ZG9tYWluX2lkOwotICAgICAgICBkLnZjcHUgPSBzdmMtPnZjcHUtPnZj
cHVfaWQ7CisgICAgICAgIGQuZG9tID0gc3ZjLT51bml0LT5kb21haW4tPmRvbWFpbl9pZDsKKyAg
ICAgICAgZC51bml0ID0gc3ZjLT51bml0LT51bml0X2lkOwogICAgICAgICBkLnZfYXZnbG9hZCA9
IHN2Yy0+YXZnbG9hZDsKICAgICAgICAgZC5zaGlmdCA9IFA7Ci0gICAgICAgIF9fdHJhY2VfdmFy
KFRSQ19DU0NIRUQyX1VQREFURV9WQ1BVX0xPQUQsIDEsCisgICAgICAgIF9fdHJhY2VfdmFyKFRS
Q19DU0NIRUQyX1VQREFURV9VTklUX0xPQUQsIDEsCiAgICAgICAgICAgICAgICAgICAgIHNpemVv
ZihkKSwKICAgICAgICAgICAgICAgICAgICAgKHVuc2lnbmVkIGNoYXIgKikmZCk7CiAgICAgfQpA
QCAtMTI3MiwxOCArMTI3MiwxOCBAQCBzdGF0aWMgdm9pZAogcnVucV9pbnNlcnQoY29uc3Qgc3Ry
dWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMpCiB7CiAgICAgc3Ry
dWN0IGxpc3RfaGVhZCAqaXRlcjsKLSAgICB1bnNpZ25lZCBpbnQgY3B1ID0gc3ZjLT52Y3B1LT5w
cm9jZXNzb3I7CisgICAgdW5zaWduZWQgaW50IGNwdSA9IHNjaGVkX3VuaXRfY3B1KHN2Yy0+dW5p
dCk7CiAgICAgc3RydWN0IGxpc3RfaGVhZCAqIHJ1bnEgPSAmYzJycWQob3BzLCBjcHUpLT5ydW5x
OwogICAgIGludCBwb3MgPSAwOwogCiAgICAgQVNTRVJUKHNwaW5faXNfbG9ja2VkKGdldF9zY2hl
ZF9yZXMoY3B1KS0+c2NoZWR1bGVfbG9jaykpOwogCi0gICAgQVNTRVJUKCF2Y3B1X29uX3J1bnEo
c3ZjKSk7Ci0gICAgQVNTRVJUKGMycihjcHUpID09IGMycihzdmMtPnZjcHUtPnByb2Nlc3Nvcikp
OworICAgIEFTU0VSVCghdW5pdF9vbl9ydW5xKHN2YykpOworICAgIEFTU0VSVChjMnIoY3B1KSA9
PSBjMnIoc2NoZWRfdW5pdF9jcHUoc3ZjLT51bml0KSkpOwogCiAgICAgQVNTRVJUKCZzdmMtPnJx
ZC0+cnVucSA9PSBydW5xKTsKLSAgICBBU1NFUlQoIWlzX2lkbGVfdmNwdShzdmMtPnZjcHUpKTsK
LSAgICBBU1NFUlQoIXN2Yy0+dmNwdS0+c2NoZWRfdW5pdC0+aXNfcnVubmluZyk7CisgICAgQVNT
RVJUKCFpc19pZGxlX3VuaXQoc3ZjLT51bml0KSk7CisgICAgQVNTRVJUKCFzdmMtPnVuaXQtPmlz
X3J1bm5pbmcpOwogICAgIEFTU0VSVCghKHN2Yy0+ZmxhZ3MgJiBDU0ZMQUdfc2NoZWR1bGVkKSk7
CiAKICAgICBsaXN0X2Zvcl9lYWNoKCBpdGVyLCBydW5xICkKQEAgLTEzMDAsMTEgKzEzMDAsMTEg
QEAgcnVucV9pbnNlcnQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgY3NjaGVk
Ml91bml0ICpzdmMpCiAgICAgaWYgKCB1bmxpa2VseSh0Yl9pbml0X2RvbmUpICkKICAgICB7CiAg
ICAgICAgIHN0cnVjdCB7Ci0gICAgICAgICAgICB1bnNpZ25lZCB2Y3B1OjE2LCBkb206MTY7Cisg
ICAgICAgICAgICB1bnNpZ25lZCB1bml0OjE2LCBkb206MTY7CiAgICAgICAgICAgICB1bnNpZ25l
ZCBwb3M7CiAgICAgICAgIH0gZDsKLSAgICAgICAgZC5kb20gPSBzdmMtPnZjcHUtPmRvbWFpbi0+
ZG9tYWluX2lkOwotICAgICAgICBkLnZjcHUgPSBzdmMtPnZjcHUtPnZjcHVfaWQ7CisgICAgICAg
IGQuZG9tID0gc3ZjLT51bml0LT5kb21haW4tPmRvbWFpbl9pZDsKKyAgICAgICAgZC51bml0ID0g
c3ZjLT51bml0LT51bml0X2lkOwogICAgICAgICBkLnBvcyA9IHBvczsKICAgICAgICAgX190cmFj
ZV92YXIoVFJDX0NTQ0hFRDJfUlVOUV9QT1MsIDEsCiAgICAgICAgICAgICAgICAgICAgIHNpemVv
ZihkKSwKQEAgLTEzMTQsNyArMTMxNCw3IEBAIHJ1bnFfaW5zZXJ0KGNvbnN0IHN0cnVjdCBzY2hl
ZHVsZXIgKm9wcywgc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQogCiBzdGF0aWMgaW5saW5lIHZv
aWQgcnVucV9yZW1vdmUoc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQogewotICAgIEFTU0VSVCh2
Y3B1X29uX3J1bnEoc3ZjKSk7CisgICAgQVNTRVJUKHVuaXRfb25fcnVucShzdmMpKTsKICAgICBs
aXN0X2RlbF9pbml0KCZzdmMtPnJ1bnFfZWxlbSk7CiB9CiAKQEAgLTEzNDAsOCArMTM0MCw4IEBA
IHN0YXRpYyBpbmxpbmUgYm9vbCBpc19wcmVlbXB0YWJsZShjb25zdCBzdHJ1Y3QgY3NjaGVkMl91
bml0ICpzdmMsCiAgICAgaWYgKCByYXRlbGltaXQgPD0gQ1NDSEVEMl9SQVRFTElNSVRfVElDS0xF
X1RPTEVSQU5DRSApCiAgICAgICAgIHJldHVybiB0cnVlOwogCi0gICAgQVNTRVJUKHN2Yy0+dmNw
dS0+c2NoZWRfdW5pdC0+aXNfcnVubmluZyk7Ci0gICAgcmV0dXJuIG5vdyAtIHN2Yy0+dmNwdS0+
c2NoZWRfdW5pdC0+c3RhdGVfZW50cnlfdGltZSA+CisgICAgQVNTRVJUKHN2Yy0+dW5pdC0+aXNf
cnVubmluZyk7CisgICAgcmV0dXJuIG5vdyAtIHN2Yy0+dW5pdC0+c3RhdGVfZW50cnlfdGltZSA+
CiAgICAgICAgICAgIHJhdGVsaW1pdCAtIENTQ0hFRDJfUkFURUxJTUlUX1RJQ0tMRV9UT0xFUkFO
Q0U7CiB9CiAKQEAgLTEzNjksMTcgKzEzNjksMTcgQEAgc3RhdGljIHNfdGltZV90IHRpY2tsZV9z
Y29yZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHNfdGltZV90IG5vdywKIAogICAgIC8q
CiAgICAgICogV2UgYXJlIGRlYWxpbmcgd2l0aCBjcHVzIHRoYXQgYXJlIG1hcmtlZCBub24taWRs
ZSAoaS5lLiwgdGhhdCBhcmUgbm90Ci0gICAgICogaW4gcnFkLT5pZGxlKS4gSG93ZXZlciwgc29t
ZSBvZiB0aGVtIG1heSBiZSBydW5uaW5nIHRoZWlyIGlkbGUgdmNwdSwKKyAgICAgKiBpbiBycWQt
PmlkbGUpLiBIb3dldmVyLCBzb21lIG9mIHRoZW0gbWF5IGJlIHJ1bm5pbmcgdGhlaXIgaWRsZSB1
bml0LAogICAgICAqIGlmIHRha2luZyBjYXJlIG9mIHRhc2tsZXRzLiBJbiB0aGF0IGNhc2UsIHdl
IHdhbnQgdG8gbGVhdmUgaXQgYWxvbmUuCiAgICAgICovCi0gICAgaWYgKCB1bmxpa2VseShpc19p
ZGxlX3ZjcHUoY3VyLT52Y3B1KSB8fAorICAgIGlmICggdW5saWtlbHkoaXNfaWRsZV91bml0KGN1
ci0+dW5pdCkgfHwKICAgICAgICAgICFpc19wcmVlbXB0YWJsZShjdXIsIG5vdywgTUlDUk9TRUNT
KHBydi0+cmF0ZWxpbWl0X3VzKSkpICkKICAgICAgICAgcmV0dXJuIC0xOwogCiAgICAgYnVybl9j
cmVkaXRzKHJxZCwgY3VyLCBub3cpOwogCiAgICAgc2NvcmUgPSBuZXctPmNyZWRpdCAtIGN1ci0+
Y3JlZGl0OwotICAgIGlmICggbmV3LT52Y3B1LT5wcm9jZXNzb3IgIT0gY3B1ICkKKyAgICBpZiAo
IHNjaGVkX3VuaXRfY3B1KG5ldy0+dW5pdCkgIT0gY3B1ICkKICAgICAgICAgc2NvcmUgLT0gQ1ND
SEVEMl9NSUdSQVRFX1JFU0lTVDsKIAogICAgIC8qCkBAIC0xMzkwLDIxICsxMzkwLDIxIEBAIHN0
YXRpYyBzX3RpbWVfdCB0aWNrbGVfc2NvcmUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBz
X3RpbWVfdCBub3csCiAgICAgICovCiAgICAgaWYgKCBzY29yZSA+IDAgKQogICAgIHsKLSAgICAg
ICAgaWYgKCBjcHVtYXNrX3Rlc3RfY3B1KGNwdSwgbmV3LT52Y3B1LT5zY2hlZF91bml0LT5jcHVf
c29mdF9hZmZpbml0eSkgKQorICAgICAgICBpZiAoIGNwdW1hc2tfdGVzdF9jcHUoY3B1LCBuZXct
PnVuaXQtPmNwdV9zb2Z0X2FmZmluaXR5KSApCiAgICAgICAgICAgICBzY29yZSArPSBDU0NIRUQy
X0NSRURJVF9JTklUOwogCi0gICAgICAgIGlmICggIWNwdW1hc2tfdGVzdF9jcHUoY3B1LCBjdXIt
PnZjcHUtPnNjaGVkX3VuaXQtPmNwdV9zb2Z0X2FmZmluaXR5KSApCisgICAgICAgIGlmICggIWNw
dW1hc2tfdGVzdF9jcHUoY3B1LCBjdXItPnVuaXQtPmNwdV9zb2Z0X2FmZmluaXR5KSApCiAgICAg
ICAgICAgICBzY29yZSArPSBDU0NIRUQyX0NSRURJVF9JTklUOwogICAgIH0KIAogICAgIGlmICgg
dW5saWtlbHkodGJfaW5pdF9kb25lKSApCiAgICAgewogICAgICAgICBzdHJ1Y3QgewotICAgICAg
ICAgICAgdW5zaWduZWQgdmNwdToxNiwgZG9tOjE2OworICAgICAgICAgICAgdW5zaWduZWQgdW5p
dDoxNiwgZG9tOjE2OwogICAgICAgICAgICAgaW50IGNyZWRpdCwgc2NvcmU7CiAgICAgICAgIH0g
ZDsKLSAgICAgICAgZC5kb20gPSBjdXItPnZjcHUtPmRvbWFpbi0+ZG9tYWluX2lkOwotICAgICAg
ICBkLnZjcHUgPSBjdXItPnZjcHUtPnZjcHVfaWQ7CisgICAgICAgIGQuZG9tID0gY3VyLT51bml0
LT5kb21haW4tPmRvbWFpbl9pZDsKKyAgICAgICAgZC51bml0ID0gY3VyLT51bml0LT51bml0X2lk
OwogICAgICAgICBkLmNyZWRpdCA9IGN1ci0+Y3JlZGl0OwogICAgICAgICBkLnNjb3JlID0gc2Nv
cmU7CiAgICAgICAgIF9fdHJhY2VfdmFyKFRSQ19DU0NIRUQyX1RJQ0tMRV9DSEVDSywgMSwKQEAg
LTE0MTYsMTQgKzE0MTYsMTQgQEAgc3RhdGljIHNfdGltZV90IHRpY2tsZV9zY29yZShjb25zdCBz
dHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHNfdGltZV90IG5vdywKIH0KIAogLyoKLSAqIENoZWNrIHdo
YXQgcHJvY2Vzc29yIGl0IGlzIGJlc3QgdG8gJ3dha2UnLCBmb3IgcGlja2luZyB1cCBhIHZjcHUg
dGhhdCBoYXMKKyAqIENoZWNrIHdoYXQgcHJvY2Vzc29yIGl0IGlzIGJlc3QgdG8gJ3dha2UnLCBm
b3IgcGlja2luZyB1cCBhbiB1bml0IHRoYXQgaGFzCiAgKiBqdXN0IGJlZW4gcHV0IChiYWNrKSBp
biB0aGUgcnVucXVldWUuIExvZ2ljIGlzIGFzIGZvbGxvd3M6CiAgKiAgMS4gaWYgdGhlcmUgYXJl
IGlkbGUgcHJvY2Vzc29ycyBpbiB0aGUgcnVucSwgd2FrZSBvbmUgb2YgdGhlbTsKLSAqICAyLiBp
ZiB0aGVyZSBhcmVuJ3QgaWRsZSBwcm9jZXNzb3IsIGNoZWNrIHRoZSBvbmUgd2VyZSB0aGUgdmNw
dSB3YXMKKyAqICAyLiBpZiB0aGVyZSBhcmVuJ3QgaWRsZSBwcm9jZXNzb3IsIGNoZWNrIHRoZSBv
bmUgd2VyZSB0aGUgdW5pdCB3YXMKICAqICAgICBydW5uaW5nIGJlZm9yZSB0byBzZWUgaWYgd2Ug
Y2FuIHByZWVtcHQgd2hhdCdzIHJ1bm5pbmcgdGhlcmUgbm93CiAgKiAgICAgKGFuZCBoZW5jZSBk
b2luZyBqdXN0IG9uZSBtaWdyYXRpb24pOwotICogIDMuIGxhc3Qgc3RhbmQ6IGNoZWNrIGFsbCBw
cm9jZXNzb3JzIGFuZCBzZWUgaWYgdGhlIHZjcHUgaXMgaW4gcmlnaHQKLSAqICAgICBvZiBwcmVl
bXB0aW5nIGFueSBvZiB0aGUgb3RoZXIgdmNwdXMgcnVubmluZyBvbiB0aGVtICh0aGlzIHJlcXVp
cmVzCisgKiAgMy4gbGFzdCBzdGFuZDogY2hlY2sgYWxsIHByb2Nlc3NvcnMgYW5kIHNlZSBpZiB0
aGUgdW5pdCBpcyBpbiByaWdodAorICogICAgIG9mIHByZWVtcHRpbmcgYW55IG9mIHRoZSBvdGhl
ciB1bml0cyBydW5uaW5nIG9uIHRoZW0gKHRoaXMgcmVxdWlyZXMKICAqICAgICB0d28gbWlncmF0
aW9ucywgYW5kIHRoYXQncyBpbmRlZWQgd2h5IGl0IGlzIGxlZnQgYXMgdGhlIGxhc3Qgc3RhbmQp
LgogICoKICAqIE5vdGUgdGhhdCB3aGVuIHdlIHNheSAnaWRsZSBwcm9jZXNzb3JzJyB3aGF0IHdl
IHJlYWxseSBtZWFuIGlzIChwcmV0dHkKQEAgLTE0MzYsMTAgKzE0MzYsMTAgQEAgcnVucV90aWNr
bGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgY3NjaGVkMl91bml0ICpuZXcs
IHNfdGltZV90IG5vdykKIHsKICAgICBpbnQgaSwgaXBpZCA9IC0xOwogICAgIHNfdGltZV90IG1h
eCA9IDA7Ci0gICAgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQgPSBuZXctPnZjcHUtPnNjaGVkX3Vu
aXQ7Ci0gICAgdW5zaWduZWQgaW50IGJzLCBjcHUgPSBuZXctPnZjcHUtPnByb2Nlc3NvcjsKKyAg
ICBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCA9IG5ldy0+dW5pdDsKKyAgICB1bnNpZ25lZCBpbnQg
YnMsIGNwdSA9IHNjaGVkX3VuaXRfY3B1KHVuaXQpOwogICAgIHN0cnVjdCBjc2NoZWQyX3J1bnF1
ZXVlX2RhdGEgKnJxZCA9IGMycnFkKG9wcywgY3B1KTsKLSAgICBjcHVtYXNrX3QgKm9ubGluZSA9
IGNwdXBvb2xfZG9tYWluX2NwdW1hc2sobmV3LT52Y3B1LT5kb21haW4pOworICAgIGNwdW1hc2tf
dCAqb25saW5lID0gY3B1cG9vbF9kb21haW5fY3B1bWFzayh1bml0LT5kb21haW4pOwogICAgIGNw
dW1hc2tfdCBtYXNrOwogCiAgICAgQVNTRVJUKG5ldy0+cnFkID09IHJxZCk7CkBAIC0xNDQ3LDEz
ICsxNDQ3LDEzIEBAIHJ1bnFfdGlja2xlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3Ry
dWN0IGNzY2hlZDJfdW5pdCAqbmV3LCBzX3RpbWVfdCBub3cpCiAgICAgaWYgKCB1bmxpa2VseSh0
Yl9pbml0X2RvbmUpICkKICAgICB7CiAgICAgICAgIHN0cnVjdCB7Ci0gICAgICAgICAgICB1bnNp
Z25lZCB2Y3B1OjE2LCBkb206MTY7CisgICAgICAgICAgICB1bnNpZ25lZCB1bml0OjE2LCBkb206
MTY7CiAgICAgICAgICAgICB1bnNpZ25lZCBwcm9jZXNzb3I7CiAgICAgICAgICAgICBpbnQgY3Jl
ZGl0OwogICAgICAgICB9IGQ7Ci0gICAgICAgIGQuZG9tID0gbmV3LT52Y3B1LT5kb21haW4tPmRv
bWFpbl9pZDsKLSAgICAgICAgZC52Y3B1ID0gbmV3LT52Y3B1LT52Y3B1X2lkOwotICAgICAgICBk
LnByb2Nlc3NvciA9IG5ldy0+dmNwdS0+cHJvY2Vzc29yOworICAgICAgICBkLmRvbSA9IHVuaXQt
PmRvbWFpbi0+ZG9tYWluX2lkOworICAgICAgICBkLnVuaXQgPSB1bml0LT51bml0X2lkOworICAg
ICAgICBkLnByb2Nlc3NvciA9IGNwdTsKICAgICAgICAgZC5jcmVkaXQgPSBuZXctPmNyZWRpdDsK
ICAgICAgICAgX190cmFjZV92YXIoVFJDX0NTQ0hFRDJfVElDS0xFX05FVywgMSwKICAgICAgICAg
ICAgICAgICAgICAgc2l6ZW9mKGQpLApAQCAtMTQ2MSwxMSArMTQ2MSwxMSBAQCBydW5xX3RpY2ts
ZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBjc2NoZWQyX3VuaXQgKm5ldywg
c190aW1lX3Qgbm93KQogICAgIH0KIAogICAgIC8qCi0gICAgICogRXhjbHVzaXZlIHBpbm5pbmcg
aXMgd2hlbiBhIHZjcHUgaGFzIGhhcmQtYWZmaW5pdHkgd2l0aCBvbmx5IG9uZQotICAgICAqIGNw
dSwgYW5kIHRoZXJlIGlzIG5vIG90aGVyIHZjcHUgdGhhdCBoYXMgaGFyZC1hZmZpbml0eSB3aXRo
IHRoYXQKKyAgICAgKiBFeGNsdXNpdmUgcGlubmluZyBpcyB3aGVuIGFuIHVuaXQgaGFzIGhhcmQt
YWZmaW5pdHkgd2l0aCBvbmx5IG9uZQorICAgICAqIGNwdSwgYW5kIHRoZXJlIGlzIG5vIG90aGVy
IHVuaXQgdGhhdCBoYXMgaGFyZC1hZmZpbml0eSB3aXRoIHRoYXQKICAgICAgKiBzYW1lIGNwdS4g
VGhpcyBpcyBpbmZyZXF1ZW50LCBidXQgaWYgaXQgaGFwcGVucywgaXMgZm9yIGFjaGlldmluZwog
ICAgICAqIHRoZSBtb3N0IHBvc3NpYmxlIGRldGVybWluaXNtLCBhbmQgbGVhc3QgcG9zc2libGUg
b3ZlcmhlYWQgZm9yCi0gICAgICogdGhlIHZjcHVzIGluIHF1ZXN0aW9uLgorICAgICAqIHRoZSB1
bml0cyBpbiBxdWVzdGlvbi4KICAgICAgKgogICAgICAqIFRyeSB0byBpZGVudGlmeSB0aGUgdmFz
dCBtYWpvcml0eSBvZiB0aGVzZSBzaXR1YXRpb25zLCBhbmQgZGVhbAogICAgICAqIHdpdGggdGhl
bSBxdWlja2x5LgpAQCAtMTUzMiw3ICsxNTMyLDcgQEAgcnVucV90aWNrbGUoY29uc3Qgc3RydWN0
IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgY3NjaGVkMl91bml0ICpuZXcsIHNfdGltZV90IG5vdykK
ICAgICAvKgogICAgICAqIE5vdGUgdGhhdCwgaWYgd2UgYXJlIGhlcmUsIGl0IG1lYW5zIHdlIGhh
dmUgZG9uZSB0aGUgaGFyZC1hZmZpbml0eQogICAgICAqIGJhbGFuY2luZyBzdGVwIG9mIHRoZSBs
b29wLCBhbmQgaGVuY2Ugd2hhdCB3ZSBoYXZlIGluIGNwdW1hc2tfc2NyYXRjaAotICAgICAqIGlz
IHdoYXQgd2UgcHV0IHRoZXJlIGZvciBsYXN0LCBpLmUuLCBuZXcncyB2Y3B1X2hhcmRfYWZmaW5p
dHkgJiBvbmxpbmUKKyAgICAgKiBpcyB3aGF0IHdlIHB1dCB0aGVyZSBmb3IgbGFzdCwgaS5lLiwg
bmV3J3MgdW5pdF9oYXJkX2FmZmluaXR5ICYgb25saW5lCiAgICAgICogd2hpY2ggaXMgZXhhY3Rs
eSB3aGF0IHdlIG5lZWQgZm9yIHRoZSBuZXh0IHBhcnQgb2YgdGhlIGZ1bmN0aW9uLgogICAgICAq
LwogCkBAIC0xNTQzLDcgKzE1NDMsNyBAQCBydW5xX3RpY2tsZShjb25zdCBzdHJ1Y3Qgc2NoZWR1
bGVyICpvcHMsIHN0cnVjdCBjc2NoZWQyX3VuaXQgKm5ldywgc190aW1lX3Qgbm93KQogICAgICAq
CiAgICAgICogRm9yIGRlY2lkaW5nIHdoaWNoIGNwdSB0byB0aWNrbGUsIHdlIHVzZSB0aWNrbGVf
c2NvcmUoKSwgd2hpY2ggd2lsbAogICAgICAqIGZhY3RvciBpbiBib3RoIG5ldydzIHNvZnQtYWZm
aW5pdHksIGFuZCB0aGUgc29mdC1hZmZpbml0eSBvZiB0aGUKLSAgICAgKiB2Y3B1IHJ1bm5pbmcg
b24gZWFjaCBjcHUgdGhhdCB3ZSBjb25zaWRlci4KKyAgICAgKiB1bml0IHJ1bm5pbmcgb24gZWFj
aCBjcHUgdGhhdCB3ZSBjb25zaWRlci4KICAgICAgKi8KICAgICBjcHVtYXNrX2FuZG5vdCgmbWFz
aywgJnJxZC0+YWN0aXZlLCAmcnFkLT5pZGxlKTsKICAgICBjcHVtYXNrX2FuZG5vdCgmbWFzaywg
Jm1hc2ssICZycWQtPnRpY2tsZWQpOwpAQCAtMTU4OCw3ICsxNTg4LDcgQEAgcnVucV90aWNrbGUo
Y29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgY3NjaGVkMl91bml0ICpuZXcsIHNf
dGltZV90IG5vdykKICAgICAgICAgcmV0dXJuOwogICAgIH0KIAotICAgIEFTU0VSVCghaXNfaWRs
ZV92Y3B1KGN1cnJfb25fY3B1KGlwaWQpLT52Y3B1KSk7CisgICAgQVNTRVJUKCFpc19pZGxlX3Vu
aXQoY3Vycl9vbl9jcHUoaXBpZCkpKTsKICAgICBTQ0hFRF9TVEFUX0NSQU5LKHRpY2tsZWRfYnVz
eV9jcHUpOwogIHRpY2tsZToKICAgICBCVUdfT04oaXBpZCA9PSAtMSk7CkBAIC0xNjIzLDE2ICsx
NjIzLDE2IEBAIHN0YXRpYyB2b2lkIHJlc2V0X2NyZWRpdChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVy
ICpvcHMsIGludCBjcHUsIHNfdGltZV90IG5vdywKIAogICAgIC8qCiAgICAgICogVW5kZXIgbm9y
bWFsIGNpcmN1bXN0YW5jZXMsIHNuZXh0LT5jcmVkaXQgc2hvdWxkIG5ldmVyIGJlIGxlc3MKLSAg
ICAgKiB0aGFuIC1DU0NIRUQyX01JTl9USU1FUi4gIEhvd2V2ZXIsIHVuZGVyIHNvbWUgY2lyY3Vt
c3RhbmNlcywgYQotICAgICAqIHZjcHUgd2l0aCBsb3cgY3JlZGl0cyBtYXkgYmUgYWxsb3dlZCB0
byBydW4gbG9uZyBlbm91Z2ggdGhhdAorICAgICAqIHRoYW4gLUNTQ0hFRDJfTUlOX1RJTUVSLiAg
SG93ZXZlciwgdW5kZXIgc29tZSBjaXJjdW1zdGFuY2VzLCBhbgorICAgICAqIHVuaXQgd2l0aCBs
b3cgY3JlZGl0cyBtYXkgYmUgYWxsb3dlZCB0byBydW4gbG9uZyBlbm91Z2ggdGhhdAogICAgICAq
IGl0cyBjcmVkaXRzIGFyZSBhY3R1YWxseSBsZXNzIHRoYW4gLUNTQ0hFRDJfQ1JFRElUX0lOSVQu
Ci0gICAgICogKEluc3RhbmNlcyBoYXZlIGJlZW4gb2JzZXJ2ZWQsIGZvciBleGFtcGxlLCB3aGVy
ZSBhIHZjcHUgd2l0aAorICAgICAqIChJbnN0YW5jZXMgaGF2ZSBiZWVuIG9ic2VydmVkLCBmb3Ig
ZXhhbXBsZSwgd2hlcmUgYW4gdW5pdCB3aXRoCiAgICAgICogMjAwdXMgb2YgY3JlZGl0IHdhcyBh
bGxvd2VkIHRvIHJ1biBmb3IgMTFtcywgZ2l2aW5nIGl0IC0xMC44bXMKICAgICAgKiBvZiBjcmVk
aXQuICBUaHVzIGl0IHdhcyBzdGlsbCBuZWdhdGl2ZSBldmVuIGFmdGVyIHRoZSByZXNldC4pCiAg
ICAgICoKICAgICAgKiBJZiB0aGlzIGlzIHRoZSBjYXNlIGZvciBzbmV4dCwgd2Ugc2ltcGx5IHdh
bnQgdG8ga2VlcCBtb3ZpbmcKICAgICAgKiBldmVyeW9uZSB1cCB1bnRpbCBpdCBpcyBpbiB0aGUg
YmxhY2sgYWdhaW4uICBUaGlzIGZhaXIgYmVjYXVzZQotICAgICAqIG5vbmUgb2YgdGhlIG90aGVy
IHZjcHVzIHdhbnQgdG8gcnVuIGF0IHRoZSBtb21lbnQuCisgICAgICogbm9uZSBvZiB0aGUgb3Ro
ZXIgdW5pdHMgd2FudCB0byBydW4gYXQgdGhlIG1vbWVudC4KICAgICAgKgogICAgICAqIFJhdGhl
ciB0aGFuIGxvb3BpbmcsIGhvd2V2ZXIsIHdlIGp1c3QgY2FsY3VsYXRlIGEgbXVsdGlwbGllciwK
ICAgICAgKiBhdm9pZGluZyBhbiBpbnRlZ2VyIGRpdmlzaW9uIGFuZCBtdWx0aXBsaWNhdGlvbiBp
biB0aGUgY29tbW9uCkBAIC0xNjQ5LDE2ICsxNjQ5LDE2IEBAIHN0YXRpYyB2b2lkIHJlc2V0X2Ny
ZWRpdChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGludCBjcHUsIHNfdGltZV90IG5vdywK
ICAgICAgICAgaW50IHN0YXJ0X2NyZWRpdDsKIAogICAgICAgICBzdmMgPSBsaXN0X2VudHJ5KGl0
ZXIsIHN0cnVjdCBjc2NoZWQyX3VuaXQsIHJxZF9lbGVtKTsKLSAgICAgICAgc3ZjX2NwdSA9IHN2
Yy0+dmNwdS0+cHJvY2Vzc29yOworICAgICAgICBzdmNfY3B1ID0gc2NoZWRfdW5pdF9jcHUoc3Zj
LT51bml0KTsKIAotICAgICAgICBBU1NFUlQoIWlzX2lkbGVfdmNwdShzdmMtPnZjcHUpKTsKKyAg
ICAgICAgQVNTRVJUKCFpc19pZGxlX3VuaXQoc3ZjLT51bml0KSk7CiAgICAgICAgIEFTU0VSVChz
dmMtPnJxZCA9PSBycWQpOwogCiAgICAgICAgIC8qCiAgICAgICAgICAqIElmIHN2YyBpcyBydW5u
aW5nLCBpdCBpcyBvdXIgcmVzcG9uc2liaWxpdHkgdG8gbWFrZSBzdXJlLCBoZXJlLAogICAgICAg
ICAgKiB0aGF0IHRoZSBjcmVkaXQgaXQgaGFzIHNwZW50IHNvIGZhciBnZXQgYWNjb3VudGVkLgog
ICAgICAgICAgKi8KLSAgICAgICAgaWYgKCBzdmMtPnZjcHUgPT0gY3Vycl9vbl9jcHUoc3ZjX2Nw
dSktPnZjcHUgKQorICAgICAgICBpZiAoIHN2Yy0+dW5pdCA9PSBjdXJyX29uX2NwdShzdmNfY3B1
KSApCiAgICAgICAgIHsKICAgICAgICAgICAgIGJ1cm5fY3JlZGl0cyhycWQsIHN2Yywgbm93KTsK
ICAgICAgICAgICAgIC8qCkBAIC0xNjg5LDEyICsxNjg5LDEyIEBAIHN0YXRpYyB2b2lkIHJlc2V0
X2NyZWRpdChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGludCBjcHUsIHNfdGltZV90IG5v
dywKICAgICAgICAgaWYgKCB1bmxpa2VseSh0Yl9pbml0X2RvbmUpICkKICAgICAgICAgewogICAg
ICAgICAgICAgc3RydWN0IHsKLSAgICAgICAgICAgICAgICB1bnNpZ25lZCB2Y3B1OjE2LCBkb206
MTY7CisgICAgICAgICAgICAgICAgdW5zaWduZWQgdW5pdDoxNiwgZG9tOjE2OwogICAgICAgICAg
ICAgICAgIGludCBjcmVkaXRfc3RhcnQsIGNyZWRpdF9lbmQ7CiAgICAgICAgICAgICAgICAgdW5z
aWduZWQgbXVsdGlwbGllcjsKICAgICAgICAgICAgIH0gZDsKLSAgICAgICAgICAgIGQuZG9tID0g
c3ZjLT52Y3B1LT5kb21haW4tPmRvbWFpbl9pZDsKLSAgICAgICAgICAgIGQudmNwdSA9IHN2Yy0+
dmNwdS0+dmNwdV9pZDsKKyAgICAgICAgICAgIGQuZG9tID0gc3ZjLT51bml0LT5kb21haW4tPmRv
bWFpbl9pZDsKKyAgICAgICAgICAgIGQudW5pdCA9IHN2Yy0+dW5pdC0+dW5pdF9pZDsKICAgICAg
ICAgICAgIGQuY3JlZGl0X3N0YXJ0ID0gc3RhcnRfY3JlZGl0OwogICAgICAgICAgICAgZC5jcmVk
aXRfZW5kID0gc3ZjLT5jcmVkaXQ7CiAgICAgICAgICAgICBkLm11bHRpcGxpZXIgPSBtOwpAQCAt
MTcxNCw5ICsxNzE0LDkgQEAgdm9pZCBidXJuX2NyZWRpdHMoc3RydWN0IGNzY2hlZDJfcnVucXVl
dWVfZGF0YSAqcnFkLAogewogICAgIHNfdGltZV90IGRlbHRhOwogCi0gICAgQVNTRVJUKHN2YyA9
PSBjc2NoZWQyX3VuaXQoY3Vycl9vbl9jcHUoc3ZjLT52Y3B1LT5wcm9jZXNzb3IpKSk7CisgICAg
QVNTRVJUKHN2YyA9PSBjc2NoZWQyX3VuaXQoY3Vycl9vbl9jcHUoc2NoZWRfdW5pdF9jcHUoc3Zj
LT51bml0KSkpKTsKIAotICAgIGlmICggdW5saWtlbHkoaXNfaWRsZV92Y3B1KHN2Yy0+dmNwdSkp
ICkKKyAgICBpZiAoIHVubGlrZWx5KGlzX2lkbGVfdW5pdChzdmMtPnVuaXQpKSApCiAgICAgewog
ICAgICAgICBBU1NFUlQoc3ZjLT5jcmVkaXQgPT0gQ1NDSEVEMl9JRExFX0NSRURJVCk7CiAgICAg
ICAgIHJldHVybjsKQEAgLTE3NDUsMTIgKzE3NDUsMTIgQEAgdm9pZCBidXJuX2NyZWRpdHMoc3Ry
dWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFkLAogICAgIGlmICggdW5saWtlbHkodGJfaW5p
dF9kb25lKSApCiAgICAgewogICAgICAgICBzdHJ1Y3QgewotICAgICAgICAgICAgdW5zaWduZWQg
dmNwdToxNiwgZG9tOjE2OworICAgICAgICAgICAgdW5zaWduZWQgdW5pdDoxNiwgZG9tOjE2Owog
ICAgICAgICAgICAgaW50IGNyZWRpdCwgYnVkZ2V0OwogICAgICAgICAgICAgaW50IGRlbHRhOwog
ICAgICAgICB9IGQ7Ci0gICAgICAgIGQuZG9tID0gc3ZjLT52Y3B1LT5kb21haW4tPmRvbWFpbl9p
ZDsKLSAgICAgICAgZC52Y3B1ID0gc3ZjLT52Y3B1LT52Y3B1X2lkOworICAgICAgICBkLmRvbSA9
IHN2Yy0+dW5pdC0+ZG9tYWluLT5kb21haW5faWQ7CisgICAgICAgIGQudW5pdCA9IHN2Yy0+dW5p
dC0+dW5pdF9pZDsKICAgICAgICAgZC5jcmVkaXQgPSBzdmMtPmNyZWRpdDsKICAgICAgICAgZC5i
dWRnZXQgPSBoYXNfY2FwKHN2YykgPyAgc3ZjLT5idWRnZXQgOiBJTlRfTUlOOwogICAgICAgICBk
LmRlbHRhID0gZGVsdGE7CkBAIC0xNzY0LDM5ICsxNzY0LDM5IEBAIHZvaWQgYnVybl9jcmVkaXRz
KHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCwKICAqIEJ1ZGdldC1yZWxhdGVkIGNv
ZGUuCiAgKi8KIAotc3RhdGljIHZvaWQgcGFya192Y3B1KHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2
YykKK3N0YXRpYyB2b2lkIHBhcmtfdW5pdChzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMpCiB7Ci0g
ICAgc3RydWN0IHZjcHUgKnYgPSBzdmMtPnZjcHU7CisgICAgc3RydWN0IHNjaGVkX3VuaXQgKnVu
aXQgPSBzdmMtPnVuaXQ7CiAKICAgICBBU1NFUlQoc3Bpbl9pc19sb2NrZWQoJnN2Yy0+c2RvbS0+
YnVkZ2V0X2xvY2spKTsKIAogICAgIC8qCi0gICAgICogSXQgd2FzIGltcG9zc2libGUgdG8gZmlu
ZCBidWRnZXQgZm9yIHRoaXMgdkNQVSwgc28gaXQgaGFzIHRvIGJlCisgICAgICogSXQgd2FzIGlt
cG9zc2libGUgdG8gZmluZCBidWRnZXQgZm9yIHRoaXMgdW5pdCwgc28gaXQgaGFzIHRvIGJlCiAg
ICAgICogInBhcmtlZCIuIFRoaXMgaW1wbGllcyBpdCBpcyBub3QgcnVubmFibGUsIHNvIHdlIG1h
cmsgaXQgYXMgc3VjaCBpbgotICAgICAqIGl0cyBwYXVzZV9mbGFncy4gSWYgdGhlIHZDUFUgaXMg
Y3VycmVudGx5IHNjaGVkdWxlZCAod2hpY2ggbWVhbnMgd2UKKyAgICAgKiBpdHMgcGF1c2VfZmxh
Z3MuIElmIHRoZSB1bml0IGlzIGN1cnJlbnRseSBzY2hlZHVsZWQgKHdoaWNoIG1lYW5zIHdlCiAg
ICAgICogYXJlIGhlcmUgYWZ0ZXIgYmVpbmcgY2FsbGVkIGZyb20gd2l0aGluIGNzY2hlZF9zY2hl
ZHVsZSgpKSwgZmxhZ2dpbmcKICAgICAgKiBpcyBlbm91Z2gsIGFzIHdlJ2xsIGNob29zZSBzb21l
b25lIGVsc2UsIGFuZCB0aGVuIGNvbnRleHRfc2F2ZWQoKQogICAgICAqIHdpbGwgdGFrZSBjYXJl
IG9mIHVwZGF0aW5nIHRoZSBsb2FkIHByb3Blcmx5LgogICAgICAqCi0gICAgICogSWYsIE9UT0gs
IHRoZSB2Q1BVIGlzIHNpdHRpbmcgaW4gdGhlIHJ1bnF1ZXVlICh3aGljaCBtZWFucyB3ZSBhcmUg
aGVyZQorICAgICAqIElmLCBPVE9ILCB0aGUgdW5pdCBpcyBzaXR0aW5nIGluIHRoZSBydW5xdWV1
ZSAod2hpY2ggbWVhbnMgd2UgYXJlIGhlcmUKICAgICAgKiBhZnRlciBiZWluZyBjYWxsZWQgZnJv
bSB3aXRoaW4gcnVucV9jYW5kaWRhdGUoKSksIHdlIG11c3QgZ28gYWxsIHRoZQogICAgICAqIHdh
eSBkb3duIHRvIHRha2luZyBpdCBvdXQgb2YgdGhlcmUsIGFuZCB1cGRhdGluZyB0aGUgbG9hZCBh
Y2NvcmRpbmdseS4KICAgICAgKgotICAgICAqIEluIGJvdGggY2FzZXMsIHdlIGFsc28gYWRkIGl0
IHRvIHRoZSBsaXN0IG9mIHBhcmtlZCB2Q1BVcyBvZiB0aGUgZG9tYWluLgorICAgICAqIEluIGJv
dGggY2FzZXMsIHdlIGFsc28gYWRkIGl0IHRvIHRoZSBsaXN0IG9mIHBhcmtlZCB1bml0cyBvZiB0
aGUgZG9tYWluLgogICAgICAqLwotICAgIF9fc2V0X2JpdChfVlBGX3BhcmtlZCwgJnYtPnBhdXNl
X2ZsYWdzKTsKLSAgICBpZiAoIHZjcHVfb25fcnVucShzdmMpICkKKyAgICBzY2hlZF9zZXRfcGF1
c2VfZmxhZ3ModW5pdCwgX1ZQRl9wYXJrZWQpOworICAgIGlmICggdW5pdF9vbl9ydW5xKHN2Yykg
KQogICAgIHsKICAgICAgICAgcnVucV9yZW1vdmUoc3ZjKTsKICAgICAgICAgdXBkYXRlX2xvYWQo
c3ZjLT5zZG9tLT5kb20tPmNwdXBvb2wtPnNjaGVkLCBzdmMtPnJxZCwgc3ZjLCAtMSwgTk9XKCkp
OwogICAgIH0KLSAgICBsaXN0X2FkZCgmc3ZjLT5wYXJrZWRfZWxlbSwgJnN2Yy0+c2RvbS0+cGFy
a2VkX3ZjcHVzKTsKKyAgICBsaXN0X2FkZCgmc3ZjLT5wYXJrZWRfZWxlbSwgJnN2Yy0+c2RvbS0+
cGFya2VkX3VuaXRzKTsKIH0KIAotc3RhdGljIGJvb2wgdmNwdV9ncmFiX2J1ZGdldChzdHJ1Y3Qg
Y3NjaGVkMl91bml0ICpzdmMpCitzdGF0aWMgYm9vbCB1bml0X2dyYWJfYnVkZ2V0KHN0cnVjdCBj
c2NoZWQyX3VuaXQgKnN2YykKIHsKICAgICBzdHJ1Y3QgY3NjaGVkMl9kb20gKnNkb20gPSBzdmMt
PnNkb207Ci0gICAgdW5zaWduZWQgaW50IGNwdSA9IHN2Yy0+dmNwdS0+cHJvY2Vzc29yOworICAg
IHVuc2lnbmVkIGludCBjcHUgPSBzY2hlZF91bml0X2NwdShzdmMtPnVuaXQpOwogCiAgICAgQVNT
RVJUKHNwaW5faXNfbG9ja2VkKGdldF9zY2hlZF9yZXMoY3B1KS0+c2NoZWR1bGVfbG9jaykpOwog
CkBAIC0xODA4LDkgKzE4MDgsOSBAQCBzdGF0aWMgYm9vbCB2Y3B1X2dyYWJfYnVkZ2V0KHN0cnVj
dCBjc2NoZWQyX3VuaXQgKnN2YykKIAogICAgIC8qCiAgICAgICogSGVyZSwgc3ZjLT5idWRnZXQg
aXMgPD0gMCAoYXMsIGlmIGl0IHdhcyA+IDAsIHdlJ2QgaGF2ZSB0YWtlbiB0aGUgaWYKLSAgICAg
KiBhYm92ZSEpLiBUaGF0IGJhc2ljYWxseSBtZWFucyB0aGUgdkNQVSBoYXMgb3ZlcnJ1biBhIGJp
dCAtLWJlY2F1c2Ugb2YKKyAgICAgKiBhYm92ZSEpLiBUaGF0IGJhc2ljYWxseSBtZWFucyB0aGUg
dW5pdCBoYXMgb3ZlcnJ1biBhIGJpdCAtLWJlY2F1c2Ugb2YKICAgICAgKiB2YXJpb3VzIHJlYXNv
bnMtLSBhbmQgd2Ugd2FudCB0byB0YWtlIHRoYXQgaW50byBhY2NvdW50LiBXaXRoIHRoZSArPSwK
LSAgICAgKiB3ZSBhcmUgYWN0dWFsbHkgc3VidHJhY3RpbmcgdGhlIGFtb3VudCBvZiBidWRnZXQg
dGhlIHZDUFUgaGFzCisgICAgICogd2UgYXJlIGFjdHVhbGx5IHN1YnRyYWN0aW5nIHRoZSBhbW91
bnQgb2YgYnVkZ2V0IHRoZSB1bml0IGhhcwogICAgICAqIG92ZXJjb25zdW1lZCwgZnJvbSB0aGUg
dG90YWwgZG9tYWluIGJ1ZGdldC4KICAgICAgKi8KICAgICBzZG9tLT5idWRnZXQgKz0gc3ZjLT5i
dWRnZXQ7CkBAIC0xODMxLDcgKzE4MzEsNyBAQCBzdGF0aWMgYm9vbCB2Y3B1X2dyYWJfYnVkZ2V0
KHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YykKICAgICBlbHNlCiAgICAgewogICAgICAgICBzdmMt
PmJ1ZGdldCA9IDA7Ci0gICAgICAgIHBhcmtfdmNwdShzdmMpOworICAgICAgICBwYXJrX3VuaXQo
c3ZjKTsKICAgICB9CiAKICAgICBzcGluX3VubG9jaygmc2RvbS0+YnVkZ2V0X2xvY2spOwpAQCAt
MTg0MCwxMCArMTg0MCwxMCBAQCBzdGF0aWMgYm9vbCB2Y3B1X2dyYWJfYnVkZ2V0KHN0cnVjdCBj
c2NoZWQyX3VuaXQgKnN2YykKIH0KIAogc3RhdGljIHZvaWQKLXZjcHVfcmV0dXJuX2J1ZGdldChz
dHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMsIHN0cnVjdCBsaXN0X2hlYWQgKnBhcmtlZCkKK3VuaXRf
cmV0dXJuX2J1ZGdldChzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMsIHN0cnVjdCBsaXN0X2hlYWQg
KnBhcmtlZCkKIHsKICAgICBzdHJ1Y3QgY3NjaGVkMl9kb20gKnNkb20gPSBzdmMtPnNkb207Ci0g
ICAgdW5zaWduZWQgaW50IGNwdSA9IHN2Yy0+dmNwdS0+cHJvY2Vzc29yOworICAgIHVuc2lnbmVk
IGludCBjcHUgPSBzY2hlZF91bml0X2NwdShzdmMtPnVuaXQpOwogCiAgICAgQVNTRVJUKHNwaW5f
aXNfbG9ja2VkKGdldF9zY2hlZF9yZXMoY3B1KS0+c2NoZWR1bGVfbG9jaykpOwogICAgIEFTU0VS
VChsaXN0X2VtcHR5KHBhcmtlZCkpOwpAQCAtMTg1Miw3ICsxODUyLDcgQEAgdmNwdV9yZXR1cm5f
YnVkZ2V0KHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2Yywgc3RydWN0IGxpc3RfaGVhZCAqcGFya2Vk
KQogICAgIHNwaW5fbG9jaygmc2RvbS0+YnVkZ2V0X2xvY2spOwogCiAgICAgLyoKLSAgICAgKiBU
aGUgdkNQVSBpcyBzdG9wcGluZyBydW5uaW5nIChlLmcuLCBiZWNhdXNlIGl0J3MgYmxvY2tpbmcs
IG9yIGl0IGhhcworICAgICAqIFRoZSB1bml0IGlzIHN0b3BwaW5nIHJ1bm5pbmcgKGUuZy4sIGJl
Y2F1c2UgaXQncyBibG9ja2luZywgb3IgaXQgaGFzCiAgICAgICogYmVlbiBwcmVlbXB0ZWQpLiBJ
ZiBpdCBoYXNuJ3QgY29uc3VtZWQgYWxsIHRoZSBidWRnZXQgaXQgZ290IHdoZW4sCiAgICAgICog
c3RhcnRpbmcgdG8gcnVuLCBwdXQgdGhhdCByZW1haW5pbmcgYW1vdW50IGJhY2sgaW4gdGhlIGRv
bWFpbidzIGJ1ZGdldAogICAgICAqIHBvb2wuCkBAIC0xODYxLDU4ICsxODYxLDU4IEBAIHZjcHVf
cmV0dXJuX2J1ZGdldChzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMsIHN0cnVjdCBsaXN0X2hlYWQg
KnBhcmtlZCkKICAgICBzdmMtPmJ1ZGdldCA9IDA7CiAKICAgICAvKgotICAgICAqIE1ha2luZyBi
dWRnZXQgYXZhaWxhYmxlIGFnYWluIHRvIHRoZSBkb21haW4gbWVhbnMgdGhhdCBwYXJrZWQgdkNQ
VXMKLSAgICAgKiBtYXkgYmUgdW5wYXJrZWQgYW5kIHJ1bi4gVGhleSBhcmUsIGlmIGFueSwgaW4g
dGhlIGRvbWFpbidzIHBhcmtlZF92Y3B1cworICAgICAqIE1ha2luZyBidWRnZXQgYXZhaWxhYmxl
IGFnYWluIHRvIHRoZSBkb21haW4gbWVhbnMgdGhhdCBwYXJrZWQgdW5pdHMKKyAgICAgKiBtYXkg
YmUgdW5wYXJrZWQgYW5kIHJ1bi4gVGhleSBhcmUsIGlmIGFueSwgaW4gdGhlIGRvbWFpbidzIHBh
cmtlZF91bml0cwogICAgICAqIGxpc3QsIHNvIHdlIHdhbnQgdG8gZ28gdGhyb3VnaCB0aGF0IGFu
ZCB1bnBhcmsgdGhlbSAoc28gdGhleSBjYW4gdHJ5CiAgICAgICogdG8gZ2V0IHNvbWUgYnVkZ2V0
KS4KICAgICAgKgogICAgICAqIFRvdWNoaW5nIHRoZSBsaXN0IHJlcXVpcmVzIHRoZSBidWRnZXRf
bG9jaywgd2hpY2ggd2UgaG9sZC4gTGV0J3MKICAgICAgKiB0aGVyZWZvcmUgcHV0IGV2ZXJ5b25l
IGluIHRoYXQgbGlzdCBpbiBhbm90aGVyLCB0ZW1wb3JhcnkgbGlzdCwgd2hpY2gKLSAgICAgKiB0
aGVuIHRoZSBjYWxsZXIgd2lsbCB0cmF2ZXJzZSwgdW5wYXJraW5nIHRoZSB2Q1BVcyBpdCBmaW5k
cyB0aGVyZS4KKyAgICAgKiB0aGVuIHRoZSBjYWxsZXIgd2lsbCB0cmF2ZXJzZSwgdW5wYXJraW5n
IHRoZSB1bml0cyBpdCBmaW5kcyB0aGVyZS4KICAgICAgKgogICAgICAqIEluIGZhY3QsIHdlIGNh
bid0IGRvIHRoZSBhY3R1YWwgdW5wYXJraW5nIGhlcmUsIGJlY2F1c2UgdGhhdCByZXF1aXJlcwot
ICAgICAqIHRha2luZyB0aGUgcnVucXVldWUgbG9jayBvZiB0aGUgdkNQVXMgYmVpbmcgdW5wYXJr
ZWQsIGFuZCB3ZSBjYW4ndAorICAgICAqIHRha2luZyB0aGUgcnVucXVldWUgbG9jayBvZiB0aGUg
dW5pdHMgYmVpbmcgdW5wYXJrZWQsIGFuZCB3ZSBjYW4ndAogICAgICAqIHRha2UgYW55IHJ1bnF1
ZXVlIGxvY2tzIHdoaWxlIHdlIGhvbGQgYSBidWRnZXRfbG9jay4KICAgICAgKi8KICAgICBpZiAo
IHNkb20tPmJ1ZGdldCA+IDAgKQotICAgICAgICBsaXN0X3NwbGljZV9pbml0KCZzZG9tLT5wYXJr
ZWRfdmNwdXMsIHBhcmtlZCk7CisgICAgICAgIGxpc3Rfc3BsaWNlX2luaXQoJnNkb20tPnBhcmtl
ZF91bml0cywgcGFya2VkKTsKIAogICAgIHNwaW5fdW5sb2NrKCZzZG9tLT5idWRnZXRfbG9jayk7
CiB9CiAKIHN0YXRpYyB2b2lkCi11bnBhcmtfcGFya2VkX3ZjcHVzKGNvbnN0IHN0cnVjdCBzY2hl
ZHVsZXIgKm9wcywgc3RydWN0IGxpc3RfaGVhZCAqdmNwdXMpCit1bnBhcmtfcGFya2VkX3VuaXRz
KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IGxpc3RfaGVhZCAqdW5pdHMpCiB7
CiAgICAgc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjLCAqdG1wOwogICAgIHNwaW5sb2NrX3QgKmxv
Y2s7CiAKLSAgICBsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUoc3ZjLCB0bXAsIHZjcHVzLCBwYXJr
ZWRfZWxlbSkKKyAgICBsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUgKCBzdmMsIHRtcCwgdW5pdHMs
IHBhcmtlZF9lbGVtICkKICAgICB7CiAgICAgICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAgICAg
ICAgIHNfdGltZV90IG5vdzsKIAotICAgICAgICBsb2NrID0gdW5pdF9zY2hlZHVsZV9sb2NrX2ly
cXNhdmUoc3ZjLT52Y3B1LT5zY2hlZF91bml0LCAmZmxhZ3MpOworICAgICAgICBsb2NrID0gdW5p
dF9zY2hlZHVsZV9sb2NrX2lycXNhdmUoc3ZjLT51bml0LCAmZmxhZ3MpOwogCi0gICAgICAgIF9f
Y2xlYXJfYml0KF9WUEZfcGFya2VkLCAmc3ZjLT52Y3B1LT5wYXVzZV9mbGFncyk7CisgICAgICAg
IHNjaGVkX2NsZWFyX3BhdXNlX2ZsYWdzKHN2Yy0+dW5pdCwgX1ZQRl9wYXJrZWQpOwogICAgICAg
ICBpZiAoIHVubGlrZWx5KHN2Yy0+ZmxhZ3MgJiBDU0ZMQUdfc2NoZWR1bGVkKSApCiAgICAgICAg
IHsKICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgKiBXZSBlbmQgaGVyZSBpZiBhIGJ1ZGdl
dCByZXBsZW5pc2htZW50IGFycml2ZWQgYmV0d2VlbgogICAgICAgICAgICAgICogY3NjaGVkMl9z
Y2hlZHVsZSgpIChhbmQsIGluIHBhcnRpY3VsYXIsIGFmdGVyIGEgY2FsbCB0bwotICAgICAgICAg
ICAgICogdmNwdV9ncmFiX2J1ZGdldCgpIHRoYXQgcmV0dXJuZWQgZmFsc2UpLCBhbmQKKyAgICAg
ICAgICAgICAqIHVuaXRfZ3JhYl9idWRnZXQoKSB0aGF0IHJldHVybmVkIGZhbHNlKSwgYW5kCiAg
ICAgICAgICAgICAgKiBjb250ZXh0X3NhdmVkKCkuIEJ5IHNldHRpbmcgX19DU0ZMQUdfZGVsYXll
ZF9ydW5xX2FkZCwKLSAgICAgICAgICAgICAqIHdlIHRlbGwgY29udGV4dF9zYXZlZCgpIHRvIHB1
dCB0aGUgdkNQVSBiYWNrIGluIHRoZQorICAgICAgICAgICAgICogd2UgdGVsbCBjb250ZXh0X3Nh
dmVkKCkgdG8gcHV0IHRoZSB1bml0IGJhY2sgaW4gdGhlCiAgICAgICAgICAgICAgKiBydW5xdWV1
ZSwgZnJvbSB3aGVyZSBpdCB3aWxsIGNvbXBldGUgd2l0aCB0aGUgb3RoZXJzCiAgICAgICAgICAg
ICAgKiBmb3IgdGhlIG5ld2x5IHJlcGxlbmlzaGVkIGJ1ZGdldC4KICAgICAgICAgICAgICAqLwog
ICAgICAgICAgICAgQVNTRVJUKCBzdmMtPnJxZCAhPSBOVUxMICk7Ci0gICAgICAgICAgICBBU1NF
UlQoIGMycnFkKG9wcywgc3ZjLT52Y3B1LT5wcm9jZXNzb3IpID09IHN2Yy0+cnFkICk7CisgICAg
ICAgICAgICBBU1NFUlQoIGMycnFkKG9wcywgc2NoZWRfdW5pdF9jcHUoc3ZjLT51bml0KSkgPT0g
c3ZjLT5ycWQgKTsKICAgICAgICAgICAgIF9fc2V0X2JpdChfX0NTRkxBR19kZWxheWVkX3J1bnFf
YWRkLCAmc3ZjLT5mbGFncyk7CiAgICAgICAgIH0KLSAgICAgICAgZWxzZSBpZiAoIHZjcHVfcnVu
bmFibGUoc3ZjLT52Y3B1KSApCisgICAgICAgIGVsc2UgaWYgKCB1bml0X3J1bm5hYmxlKHN2Yy0+
dW5pdCkgKQogICAgICAgICB7CiAgICAgICAgICAgICAvKgotICAgICAgICAgICAgICogVGhlIHZD
UFUgc2hvdWxkIGdvIGJhY2sgdG8gdGhlIHJ1bnF1ZXVlLCBhbmQgY29tcGV0ZSBmb3IKKyAgICAg
ICAgICAgICAqIFRoZSB1bml0IHNob3VsZCBnbyBiYWNrIHRvIHRoZSBydW5xdWV1ZSwgYW5kIGNv
bXBldGUgZm9yCiAgICAgICAgICAgICAgKiB0aGUgbmV3bHkgcmVwbGVuaXNoZWQgYnVkZ2V0LCBi
dXQgb25seSBpZiBpdCBpcyBhY3R1YWxseQogICAgICAgICAgICAgICogcnVubmFibGUgKGFuZCB3
YXMgdGhlcmVmb3JlIG9mZmxpbmUgb25seSBiZWNhdXNlIG9mIHRoZQogICAgICAgICAgICAgICog
bGFjayBvZiBidWRnZXQpLgpAQCAtMTkyNCw3ICsxOTI0LDcgQEAgdW5wYXJrX3BhcmtlZF92Y3B1
cyhjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBsaXN0X2hlYWQgKnZjcHVzKQog
ICAgICAgICB9CiAgICAgICAgIGxpc3RfZGVsX2luaXQoJnN2Yy0+cGFya2VkX2VsZW0pOwogCi0g
ICAgICAgIHVuaXRfc2NoZWR1bGVfdW5sb2NrX2lycXJlc3RvcmUobG9jaywgZmxhZ3MsIHN2Yy0+
dmNwdS0+c2NoZWRfdW5pdCk7CisgICAgICAgIHVuaXRfc2NoZWR1bGVfdW5sb2NrX2lycXJlc3Rv
cmUobG9jaywgZmxhZ3MsIHN2Yy0+dW5pdCk7CiAgICAgfQogfQogCkBAIC0xOTU0LDcgKzE5NTQs
NyBAQCBzdGF0aWMgdm9pZCByZXBsZW5pc2hfZG9tYWluX2J1ZGdldCh2b2lkKiBkYXRhKQogICAg
ICAqCiAgICAgICogRXZlbiBpbiBjYXNlcyBvZiBvdmVycnVuIG9yIGRlbGF5LCBob3dldmVyLCB3
ZSBleHBlY3QgdGhhdCBpbiA5OSUgb2YKICAgICAgKiBjYXNlcywgZG9pbmcganVzdCBvbmUgcmVw
bGVuaXNobWVudCB3aWxsIGJlIGdvb2QgZW5vdWdoIGZvciBiZWluZyBhYmxlCi0gICAgICogdG8g
dW5wYXJrIHRoZSB2Q1BVcyB0aGF0IGFyZSB3YWl0aW5nIGZvciBzb21lIGJ1ZGdldC4KKyAgICAg
KiB0byB1bnBhcmsgdGhlIHVuaXRzIHRoYXQgYXJlIHdhaXRpbmcgZm9yIHNvbWUgYnVkZ2V0Lgog
ICAgICAqLwogICAgIGRvX3JlcGxlbmlzaChzZG9tKTsKIApAQCAtMTk3NCw3ICsxOTc0LDcgQEAg
c3RhdGljIHZvaWQgcmVwbGVuaXNoX2RvbWFpbl9idWRnZXQodm9pZCogZGF0YSkKICAgICB9CiAg
ICAgLyoKICAgICAgKiAyKSBpZiB3ZSBvdmVycnVuIGJ5IG1vcmUgdGhhbiB0b3RfYnVkZ2V0LCB0
aGVuIGJ1ZGdldCt0b3RfYnVkZ2V0IGlzCi0gICAgICogc3RpbGwgPCAwLCB3aGljaCBtZWFucyB0
aGF0IHdlIGNhbid0IHVucGFyayB0aGUgdkNQVXMuIExldCdzIGJhaWwsCisgICAgICogc3RpbGwg
PCAwLCB3aGljaCBtZWFucyB0aGF0IHdlIGNhbid0IHVucGFyayB0aGUgdW5pdHMuIExldCdzIGJh
aWwsCiAgICAgICogYW5kIHdhaXQgZm9yIGZ1dHVyZSByZXBsZW5pc2htZW50cy4KICAgICAgKi8K
ICAgICBpZiAoIHVubGlrZWx5KHNkb20tPmJ1ZGdldCA8PSAwKSApCkBAIC0xOTg4LDE0ICsxOTg4
LDE0IEBAIHN0YXRpYyB2b2lkIHJlcGxlbmlzaF9kb21haW5fYnVkZ2V0KHZvaWQqIGRhdGEpCiAK
ICAgICAvKgogICAgICAqIEFzIGFib3ZlLCBsZXQncyBwcmVwYXJlIHRoZSB0ZW1wb3JhcnkgbGlz
dCwgb3V0IG9mIHRoZSBkb21haW4ncwotICAgICAqIHBhcmtlZF92Y3B1cyBsaXN0LCBub3cgdGhh
dCB3ZSBob2xkIHRoZSBidWRnZXRfbG9jay4gVGhlbiwgZHJvcCBzdWNoCisgICAgICogcGFya2Vk
X3VuaXRzIGxpc3QsIG5vdyB0aGF0IHdlIGhvbGQgdGhlIGJ1ZGdldF9sb2NrLiBUaGVuLCBkcm9w
IHN1Y2gKICAgICAgKiBsb2NrLCBhbmQgcGFzcyB0aGUgbGlzdCB0byB0aGUgdW5wYXJraW5nIGZ1
bmN0aW9uLgogICAgICAqLwotICAgIGxpc3Rfc3BsaWNlX2luaXQoJnNkb20tPnBhcmtlZF92Y3B1
cywgJnBhcmtlZCk7CisgICAgbGlzdF9zcGxpY2VfaW5pdCgmc2RvbS0+cGFya2VkX3VuaXRzLCAm
cGFya2VkKTsKIAogICAgIHNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnNkb20tPmJ1ZGdldF9sb2Nr
LCBmbGFncyk7CiAKLSAgICB1bnBhcmtfcGFya2VkX3ZjcHVzKHNkb20tPmRvbS0+Y3B1cG9vbC0+
c2NoZWQsICZwYXJrZWQpOworICAgIHVucGFya19wYXJrZWRfdW5pdHMoc2RvbS0+ZG9tLT5jcHVw
b29sLT5zY2hlZCwgJnBhcmtlZCk7CiAKICBvdXQ6CiAgICAgc2V0X3RpbWVyKCZzZG9tLT5yZXBs
X3RpbWVyLCBzZG9tLT5uZXh0X3JlcGwpOwpAQCAtMjAwMywzNyArMjAwMywzNiBAQCBzdGF0aWMg
dm9pZCByZXBsZW5pc2hfZG9tYWluX2J1ZGdldCh2b2lkKiBkYXRhKQogCiAjaWZuZGVmIE5ERUJV
Rwogc3RhdGljIGlubGluZSB2b2lkCi1jc2NoZWQyX3ZjcHVfY2hlY2soc3RydWN0IHZjcHUgKnZj
KQorY3NjaGVkMl91bml0X2NoZWNrKHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogewotICAgIHN0
cnVjdCBjc2NoZWQyX3VuaXQgKiBjb25zdCBzdmMgPSBjc2NoZWQyX3VuaXQodmMtPnNjaGVkX3Vu
aXQpOworICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKiBjb25zdCBzdmMgPSBjc2NoZWQyX3VuaXQo
dW5pdCk7CiAgICAgc3RydWN0IGNzY2hlZDJfZG9tICogY29uc3Qgc2RvbSA9IHN2Yy0+c2RvbTsK
IAotICAgIEJVR19PTiggc3ZjLT52Y3B1ICE9IHZjICk7Ci0gICAgQlVHX09OKCBzZG9tICE9IGNz
Y2hlZDJfZG9tKHZjLT5kb21haW4pICk7CisgICAgQlVHX09OKCBzdmMtPnVuaXQgIT0gdW5pdCAp
OworICAgIEJVR19PTiggc2RvbSAhPSBjc2NoZWQyX2RvbSh1bml0LT5kb21haW4pICk7CiAgICAg
aWYgKCBzZG9tICkKICAgICB7Ci0gICAgICAgIEJVR19PTiggaXNfaWRsZV92Y3B1KHZjKSApOwot
ICAgICAgICBCVUdfT04oIHNkb20tPmRvbSAhPSB2Yy0+ZG9tYWluICk7CisgICAgICAgIEJVR19P
TiggaXNfaWRsZV91bml0KHVuaXQpICk7CisgICAgICAgIEJVR19PTiggc2RvbS0+ZG9tICE9IHVu
aXQtPmRvbWFpbiApOwogICAgIH0KICAgICBlbHNlCiAgICAgewotICAgICAgICBCVUdfT04oICFp
c19pZGxlX3ZjcHUodmMpICk7CisgICAgICAgIEJVR19PTiggIWlzX2lkbGVfdW5pdCh1bml0KSAp
OwogICAgIH0KICAgICBTQ0hFRF9TVEFUX0NSQU5LKHVuaXRfY2hlY2spOwogfQotI2RlZmluZSBD
U0NIRUQyX1ZDUFVfQ0hFQ0soX3ZjKSAgKGNzY2hlZDJfdmNwdV9jaGVjayhfdmMpKQorI2RlZmlu
ZSBDU0NIRUQyX1VOSVRfQ0hFQ0sodW5pdCkgIChjc2NoZWQyX3VuaXRfY2hlY2sodW5pdCkpCiAj
ZWxzZQotI2RlZmluZSBDU0NIRUQyX1ZDUFVfQ0hFQ0soX3ZjKQorI2RlZmluZSBDU0NIRUQyX1VO
SVRfQ0hFQ0sodW5pdCkKICNlbmRpZgogCiBzdGF0aWMgdm9pZCAqCiBjc2NoZWQyX2FsbG9jX3Zk
YXRhKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQs
CiAgICAgICAgICAgICAgICAgICAgIHZvaWQgKmRkKQogewotICAgIHN0cnVjdCB2Y3B1ICp2YyA9
IHVuaXQtPnZjcHU7CiAgICAgc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjOwogCi0gICAgLyogQWxs
b2NhdGUgcGVyLVZDUFUgaW5mbyAqLworICAgIC8qIEFsbG9jYXRlIHBlci1VTklUIGluZm8gKi8K
ICAgICBzdmMgPSB4emFsbG9jKHN0cnVjdCBjc2NoZWQyX3VuaXQpOwogICAgIGlmICggc3ZjID09
IE5VTEwgKQogICAgICAgICByZXR1cm4gTlVMTDsKQEAgLTIwNDIsMTAgKzIwNDEsMTAgQEAgY3Nj
aGVkMl9hbGxvY192ZGF0YShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hl
ZF91bml0ICp1bml0LAogICAgIElOSVRfTElTVF9IRUFEKCZzdmMtPnJ1bnFfZWxlbSk7CiAKICAg
ICBzdmMtPnNkb20gPSBkZDsKLSAgICBzdmMtPnZjcHUgPSB2YzsKKyAgICBzdmMtPnVuaXQgPSB1
bml0OwogICAgIHN2Yy0+ZmxhZ3MgPSAwVTsKIAotICAgIGlmICggISBpc19pZGxlX3ZjcHUodmMp
ICkKKyAgICBpZiAoICEgaXNfaWRsZV91bml0KHVuaXQpICkKICAgICB7CiAgICAgICAgIEFTU0VS
VChzdmMtPnNkb20gIT0gTlVMTCk7CiAgICAgICAgIHN2Yy0+Y3JlZGl0ID0gQ1NDSEVEMl9DUkVE
SVRfSU5JVDsKQEAgLTIwNzQsMTkgKzIwNzMsMTggQEAgY3NjaGVkMl9hbGxvY192ZGF0YShjb25z
dCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0LAogc3RhdGlj
IHZvaWQKIGNzY2hlZDJfdW5pdF9zbGVlcChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0
cnVjdCBzY2hlZF91bml0ICp1bml0KQogewotICAgIHN0cnVjdCB2Y3B1ICp2YyA9IHVuaXQtPnZj
cHU7CiAgICAgc3RydWN0IGNzY2hlZDJfdW5pdCAqIGNvbnN0IHN2YyA9IGNzY2hlZDJfdW5pdCh1
bml0KTsKIAotICAgIEFTU0VSVCghaXNfaWRsZV92Y3B1KHZjKSk7CisgICAgQVNTRVJUKCFpc19p
ZGxlX3VuaXQodW5pdCkpOwogICAgIFNDSEVEX1NUQVRfQ1JBTksodW5pdF9zbGVlcCk7CiAKLSAg
ICBpZiAoIGN1cnJfb25fY3B1KHZjLT5wcm9jZXNzb3IpID09IHVuaXQgKQorICAgIGlmICggY3Vy
cl9vbl9jcHUoc2NoZWRfdW5pdF9jcHUodW5pdCkpID09IHVuaXQgKQogICAgIHsKLSAgICAgICAg
dGlja2xlX2NwdSh2Yy0+cHJvY2Vzc29yLCBzdmMtPnJxZCk7CisgICAgICAgIHRpY2tsZV9jcHUo
c2NoZWRfdW5pdF9jcHUodW5pdCksIHN2Yy0+cnFkKTsKICAgICB9Ci0gICAgZWxzZSBpZiAoIHZj
cHVfb25fcnVucShzdmMpICkKKyAgICBlbHNlIGlmICggdW5pdF9vbl9ydW5xKHN2YykgKQogICAg
IHsKLSAgICAgICAgQVNTRVJUKHN2Yy0+cnFkID09IGMycnFkKG9wcywgdmMtPnByb2Nlc3Nvcikp
OworICAgICAgICBBU1NFUlQoc3ZjLT5ycWQgPT0gYzJycWQob3BzLCBzY2hlZF91bml0X2NwdSh1
bml0KSkpOwogICAgICAgICB1cGRhdGVfbG9hZChvcHMsIHN2Yy0+cnFkLCBzdmMsIC0xLCBOT1co
KSk7CiAgICAgICAgIHJ1bnFfcmVtb3ZlKHN2Yyk7CiAgICAgfQpAQCAtMjA5NywxNCArMjA5NSwx
MyBAQCBjc2NoZWQyX3VuaXRfc2xlZXAoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1
Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIHN0YXRpYyB2b2lkCiBjc2NoZWQyX3VuaXRfd2FrZShjb25z
dCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogewotICAg
IHN0cnVjdCB2Y3B1ICp2YyA9IHVuaXQtPnZjcHU7CiAgICAgc3RydWN0IGNzY2hlZDJfdW5pdCAq
IGNvbnN0IHN2YyA9IGNzY2hlZDJfdW5pdCh1bml0KTsKLSAgICB1bnNpZ25lZCBpbnQgY3B1ID0g
dmMtPnByb2Nlc3NvcjsKKyAgICB1bnNpZ25lZCBpbnQgY3B1ID0gc2NoZWRfdW5pdF9jcHUodW5p
dCk7CiAgICAgc190aW1lX3Qgbm93OwogCiAgICAgQVNTRVJUKHNwaW5faXNfbG9ja2VkKGdldF9z
Y2hlZF9yZXMoY3B1KS0+c2NoZWR1bGVfbG9jaykpOwogCi0gICAgQVNTRVJUKCFpc19pZGxlX3Zj
cHUodmMpKTsKKyAgICBBU1NFUlQoIWlzX2lkbGVfdW5pdCh1bml0KSk7CiAKICAgICBpZiAoIHVu
bGlrZWx5KGN1cnJfb25fY3B1KGNwdSkgPT0gdW5pdCkgKQogICAgIHsKQEAgLTIxMTIsMTggKzIx
MDksMTggQEAgY3NjaGVkMl91bml0X3dha2UoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBz
dHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKICAgICAgICAgZ290byBvdXQ7CiAgICAgfQogCi0gICAg
aWYgKCB1bmxpa2VseSh2Y3B1X29uX3J1bnEoc3ZjKSkgKQorICAgIGlmICggdW5saWtlbHkodW5p
dF9vbl9ydW5xKHN2YykpICkKICAgICB7CiAgICAgICAgIFNDSEVEX1NUQVRfQ1JBTksodW5pdF93
YWtlX29ucnVucSk7CiAgICAgICAgIGdvdG8gb3V0OwogICAgIH0KIAotICAgIGlmICggbGlrZWx5
KHZjcHVfcnVubmFibGUodmMpKSApCisgICAgaWYgKCBsaWtlbHkodW5pdF9ydW5uYWJsZSh1bml0
KSkgKQogICAgICAgICBTQ0hFRF9TVEFUX0NSQU5LKHVuaXRfd2FrZV9ydW5uYWJsZSk7CiAgICAg
ZWxzZQogICAgICAgICBTQ0hFRF9TVEFUX0NSQU5LKHVuaXRfd2FrZV9ub3RfcnVubmFibGUpOwog
Ci0gICAgLyogSWYgdGhlIGNvbnRleHQgaGFzbid0IGJlZW4gc2F2ZWQgZm9yIHRoaXMgdmNwdSB5
ZXQsIHdlIGNhbid0IHB1dCBpdCBvbgorICAgIC8qIElmIHRoZSBjb250ZXh0IGhhc24ndCBiZWVu
IHNhdmVkIGZvciB0aGlzIHVuaXQgeWV0LCB3ZSBjYW4ndCBwdXQgaXQgb24KICAgICAgKiBhbm90
aGVyIHJ1bnF1ZXVlLiAgSW5zdGVhZCwgd2Ugc2V0IGEgZmxhZyBzbyB0aGF0IGl0IHdpbGwgYmUg
cHV0IG9uIHRoZSBydW5xdWV1ZQogICAgICAqIGFmdGVyIHRoZSBjb250ZXh0IGhhcyBiZWVuIHNh
dmVkLiAqLwogICAgIGlmICggdW5saWtlbHkoc3ZjLT5mbGFncyAmIENTRkxBR19zY2hlZHVsZWQp
ICkKQEAgLTIxMzQsMTUgKzIxMzEsMTUgQEAgY3NjaGVkMl91bml0X3dha2UoY29uc3Qgc3RydWN0
IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIAogICAgIC8qIEFkZCBp
bnRvIHRoZSBuZXcgcnVucXVldWUgaWYgbmVjZXNzYXJ5ICovCiAgICAgaWYgKCBzdmMtPnJxZCA9
PSBOVUxMICkKLSAgICAgICAgcnVucV9hc3NpZ24ob3BzLCB2Yyk7CisgICAgICAgIHJ1bnFfYXNz
aWduKG9wcywgdW5pdCk7CiAgICAgZWxzZQotICAgICAgICBBU1NFUlQoYzJycWQob3BzLCB2Yy0+
cHJvY2Vzc29yKSA9PSBzdmMtPnJxZCApOworICAgICAgICBBU1NFUlQoYzJycWQob3BzLCBzY2hl
ZF91bml0X2NwdSh1bml0KSkgPT0gc3ZjLT5ycWQgKTsKIAogICAgIG5vdyA9IE5PVygpOwogCiAg
ICAgdXBkYXRlX2xvYWQob3BzLCBzdmMtPnJxZCwgc3ZjLCAxLCBub3cpOwotICAgICAgICAKLSAg
ICAvKiBQdXQgdGhlIFZDUFUgb24gdGhlIHJ1bnEgKi8KKworICAgIC8qIFB1dCB0aGUgVU5JVCBv
biB0aGUgcnVucSAqLwogICAgIHJ1bnFfaW5zZXJ0KG9wcywgc3ZjKTsKICAgICBydW5xX3RpY2ts
ZShvcHMsIHN2Yywgbm93KTsKIApAQCAtMjE1NSw0OSArMjE1Miw0OCBAQCBjc2NoZWQyX3VuaXRf
eWllbGQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5p
dCkKIHsKICAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICogY29uc3Qgc3ZjID0gY3NjaGVkMl91bml0
KHVuaXQpOwogCi0gICAgX19zZXRfYml0KF9fQ1NGTEFHX3ZjcHVfeWllbGQsICZzdmMtPmZsYWdz
KTsKKyAgICBfX3NldF9iaXQoX19DU0ZMQUdfdW5pdF95aWVsZCwgJnN2Yy0+ZmxhZ3MpOwogfQog
CiBzdGF0aWMgdm9pZAogY3NjaGVkMl9jb250ZXh0X3NhdmVkKGNvbnN0IHN0cnVjdCBzY2hlZHVs
ZXIgKm9wcywgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiB7Ci0gICAgc3RydWN0IHZjcHUgKnZj
ID0gdW5pdC0+dmNwdTsKICAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICogY29uc3Qgc3ZjID0gY3Nj
aGVkMl91bml0KHVuaXQpOwogICAgIHNwaW5sb2NrX3QgKmxvY2sgPSB1bml0X3NjaGVkdWxlX2xv
Y2tfaXJxKHVuaXQpOwogICAgIHNfdGltZV90IG5vdyA9IE5PVygpOwogICAgIExJU1RfSEVBRCh3
ZXJlX3BhcmtlZCk7CiAKLSAgICBCVUdfT04oICFpc19pZGxlX3ZjcHUodmMpICYmIHN2Yy0+cnFk
ICE9IGMycnFkKG9wcywgdmMtPnByb2Nlc3NvcikpOwotICAgIEFTU0VSVChpc19pZGxlX3ZjcHUo
dmMpIHx8IHN2Yy0+cnFkID09IGMycnFkKG9wcywgdmMtPnByb2Nlc3NvcikpOworICAgIEJVR19P
TiggIWlzX2lkbGVfdW5pdCh1bml0KSAmJiBzdmMtPnJxZCAhPSBjMnJxZChvcHMsIHNjaGVkX3Vu
aXRfY3B1KHVuaXQpKSk7CisgICAgQVNTRVJUKGlzX2lkbGVfdW5pdCh1bml0KSB8fCBzdmMtPnJx
ZCA9PSBjMnJxZChvcHMsIHNjaGVkX3VuaXRfY3B1KHVuaXQpKSk7CiAKLSAgICAvKiBUaGlzIHZj
cHUgaXMgbm93IGVsaWdpYmxlIHRvIGJlIHB1dCBvbiB0aGUgcnVucXVldWUgYWdhaW4gKi8KKyAg
ICAvKiBUaGlzIHVuaXQgaXMgbm93IGVsaWdpYmxlIHRvIGJlIHB1dCBvbiB0aGUgcnVucXVldWUg
YWdhaW4gKi8KICAgICBfX2NsZWFyX2JpdChfX0NTRkxBR19zY2hlZHVsZWQsICZzdmMtPmZsYWdz
KTsKIAogICAgIGlmICggdW5saWtlbHkoaGFzX2NhcChzdmMpICYmIHN2Yy0+YnVkZ2V0ID4gMCkg
KQotICAgICAgICB2Y3B1X3JldHVybl9idWRnZXQoc3ZjLCAmd2VyZV9wYXJrZWQpOworICAgICAg
ICB1bml0X3JldHVybl9idWRnZXQoc3ZjLCAmd2VyZV9wYXJrZWQpOwogCiAgICAgLyogSWYgc29t
ZW9uZSB3YW50cyBpdCBvbiB0aGUgcnVucXVldWUsIHB1dCBpdCB0aGVyZS4gKi8KICAgICAvKgog
ICAgICAqIE5COiBXZSBjYW4gZ2V0IHJpZCBvZiBDU0ZMQUdfc2NoZWR1bGVkIGJ5IGNoZWNraW5n
IGZvcgotICAgICAqIHZjLT5pc19ydW5uaW5nIGFuZCB2Y3B1X29uX3J1bnEoc3ZjKSBoZXJlLiAg
SG93ZXZlciwKKyAgICAgKiB2Yy0+aXNfcnVubmluZyBhbmQgdW5pdF9vbl9ydW5xKHN2YykgaGVy
ZS4gIEhvd2V2ZXIsCiAgICAgICogc2luY2Ugd2UncmUgYWNjZXNzaW5nIHRoZSBmbGFncyBjYWNo
ZWxpbmUgYW55d2F5LAogICAgICAqIGl0IHNlZW1zIGEgYml0IHBvaW50bGVzczsgZXNwZWNpYWxs
eSBhcyB3ZSBoYXZlIHBsZW50eSBvZgogICAgICAqIGJpdHMgZnJlZS4KICAgICAgKi8KICAgICBp
ZiAoIF9fdGVzdF9hbmRfY2xlYXJfYml0KF9fQ1NGTEFHX2RlbGF5ZWRfcnVucV9hZGQsICZzdmMt
PmZsYWdzKQotICAgICAgICAgJiYgbGlrZWx5KHZjcHVfcnVubmFibGUodmMpKSApCisgICAgICAg
ICAmJiBsaWtlbHkodW5pdF9ydW5uYWJsZSh1bml0KSkgKQogICAgIHsKLSAgICAgICAgQVNTRVJU
KCF2Y3B1X29uX3J1bnEoc3ZjKSk7CisgICAgICAgIEFTU0VSVCghdW5pdF9vbl9ydW5xKHN2Yykp
OwogCiAgICAgICAgIHJ1bnFfaW5zZXJ0KG9wcywgc3ZjKTsKICAgICAgICAgcnVucV90aWNrbGUo
b3BzLCBzdmMsIG5vdyk7CiAgICAgfQotICAgIGVsc2UgaWYgKCAhaXNfaWRsZV92Y3B1KHZjKSAp
CisgICAgZWxzZSBpZiAoICFpc19pZGxlX3VuaXQodW5pdCkgKQogICAgICAgICB1cGRhdGVfbG9h
ZChvcHMsIHN2Yy0+cnFkLCBzdmMsIC0xLCBub3cpOwogCiAgICAgdW5pdF9zY2hlZHVsZV91bmxv
Y2tfaXJxKGxvY2ssIHVuaXQpOwogCi0gICAgdW5wYXJrX3BhcmtlZF92Y3B1cyhvcHMsICZ3ZXJl
X3BhcmtlZCk7CisgICAgdW5wYXJrX3BhcmtlZF91bml0cyhvcHMsICZ3ZXJlX3BhcmtlZCk7CiB9
CiAKICNkZWZpbmUgTUFYX0xPQUQgKFNUSU1FX01BWCkKQEAgLTIyMDUsOSArMjIwMSw4IEBAIHN0
YXRpYyBzdHJ1Y3Qgc2NoZWRfcmVzb3VyY2UgKgogY3NjaGVkMl9yZXNfcGljayhjb25zdCBzdHJ1
Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogewogICAgIHN0cnVj
dCBjc2NoZWQyX3ByaXZhdGUgKnBydiA9IGNzY2hlZDJfcHJpdihvcHMpOwotICAgIHN0cnVjdCB2
Y3B1ICp2YyA9IHVuaXQtPnZjcHU7CiAgICAgaW50IGksIG1pbl9ycWkgPSAtMSwgbWluX3NfcnFp
ID0gLTE7Ci0gICAgdW5zaWduZWQgaW50IG5ld19jcHUsIGNwdSA9IHZjLT5wcm9jZXNzb3I7Cisg
ICAgdW5zaWduZWQgaW50IG5ld19jcHUsIGNwdSA9IHNjaGVkX3VuaXRfY3B1KHVuaXQpOwogICAg
IHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YyA9IGNzY2hlZDJfdW5pdCh1bml0KTsKICAgICBzX3Rp
bWVfdCBtaW5fYXZnbG9hZCA9IE1BWF9MT0FELCBtaW5fc19hdmdsb2FkID0gTUFYX0xPQUQ7CiAg
ICAgYm9vbCBoYXNfc29mdDsKQEAgLTIyNDUsNyArMjI0MCw3IEBAIGNzY2hlZDJfcmVzX3BpY2so
Y29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKICAg
ICB9CiAKICAgICBjcHVtYXNrX2FuZChjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksIHVuaXQtPmNw
dV9oYXJkX2FmZmluaXR5LAotICAgICAgICAgICAgICAgIGNwdXBvb2xfZG9tYWluX2NwdW1hc2so
dmMtPmRvbWFpbikpOworICAgICAgICAgICAgICAgIGNwdXBvb2xfZG9tYWluX2NwdW1hc2sodW5p
dC0+ZG9tYWluKSk7CiAKICAgICAvKgogICAgICAqIEZpcnN0IGNoZWNrIHRvIHNlZSBpZiB3ZSdy
ZSBoZXJlIGJlY2F1c2Ugc29tZW9uZSBlbHNlIHN1Z2dlc3RlZCBhIHBsYWNlCkBAIC0yMzU2LDcg
KzIzNTEsNyBAQCBjc2NoZWQyX3Jlc19waWNrKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywg
c3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiAgICAgICAgICAqIFdlIGhhdmUgc29mdCBhZmZpbml0
eSwgYW5kIHdlIGhhdmUgYSBjYW5kaWRhdGUgcnVucSwgc28gZ28gZm9yIGl0LgogICAgICAgICAg
KgogICAgICAgICAgKiBOb3RlIHRoYXQsIHRvIG9idGFpbiB0aGUgc29mdC1hZmZpbml0eSBtYXNr
LCB3ZSAianVzdCIgcHV0IHdoYXQgd2UKLSAgICAgICAgICogaGF2ZSBpbiBjcHVtYXNrX3NjcmF0
Y2ggaW4gJiYgd2l0aCB2Yy0+Y3B1X3NvZnRfYWZmaW5pdHkuIFRoaXMgaXMKKyAgICAgICAgICog
aGF2ZSBpbiBjcHVtYXNrX3NjcmF0Y2ggaW4gJiYgd2l0aCB1bml0LT5jcHVfc29mdF9hZmZpbml0
eS4gVGhpcyBpcwogICAgICAgICAgKiBvayBiZWNhdXNlOgogICAgICAgICAgKiAtIHdlIGtub3cg
dGhhdCB1bml0LT5jcHVfaGFyZF9hZmZpbml0eSBhbmQgLT5jcHVfc29mdF9hZmZpbml0eSBoYXZl
CiAgICAgICAgICAqICAgYSBub24tZW1wdHkgaW50ZXJzZWN0aW9uIChiZWNhdXNlIGhhc19zb2Z0
IGlzIHRydWUpOwpAQCAtMjM3OSw3ICsyMzc0LDcgQEAgY3NjaGVkMl9yZXNfcGljayhjb25zdCBz
dHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQogICAgICAgICAg
KiBhbnkgc3VpdGFibGUgcnVucS4gQnV0IHdlIGRpZCBmaW5kIG9uZSB3aGVuIGNvbnNpZGVyaW5n
IGhhcmQKICAgICAgICAgICogYWZmaW5pdHksIHNvIGdvIGZvciBpdC4KICAgICAgICAgICoKLSAg
ICAgICAgICogY3B1bWFza19zY3JhdGNoIGFscmVhZHkgaGFzIHZjLT5jcHVfaGFyZF9hZmZpbml0
eSAmCisgICAgICAgICAqIGNwdW1hc2tfc2NyYXRjaCBhbHJlYWR5IGhhcyB1bml0LT5jcHVfaGFy
ZF9hZmZpbml0eSAmCiAgICAgICAgICAqIGNwdXBvb2xfZG9tYWluX2NwdW1hc2soKSBpbiBpdCwg
c28gaXQncyBlbm91Z2ggdGhhdCB3ZSBmaWx0ZXIKICAgICAgICAgICogd2l0aCB0aGUgY3B1cyBv
ZiB0aGUgcnVucS4KICAgICAgICAgICovCkBAIC0yNDEwLDExICsyNDA1LDExIEBAIGNzY2hlZDJf
cmVzX3BpY2soY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAq
dW5pdCkKICAgICB7CiAgICAgICAgIHN0cnVjdCB7CiAgICAgICAgICAgICB1aW50NjRfdCBiX2F2
Z2xvYWQ7Ci0gICAgICAgICAgICB1bnNpZ25lZCB2Y3B1OjE2LCBkb206MTY7CisgICAgICAgICAg
ICB1bnNpZ25lZCB1bml0OjE2LCBkb206MTY7CiAgICAgICAgICAgICB1bnNpZ25lZCBycV9pZDox
NiwgbmV3X2NwdToxNjsKICAgICAgICAgfSBkOwotICAgICAgICBkLmRvbSA9IHZjLT5kb21haW4t
PmRvbWFpbl9pZDsKLSAgICAgICAgZC52Y3B1ID0gdmMtPnZjcHVfaWQ7CisgICAgICAgIGQuZG9t
ID0gdW5pdC0+ZG9tYWluLT5kb21haW5faWQ7CisgICAgICAgIGQudW5pdCA9IHVuaXQtPnVuaXRf
aWQ7CiAgICAgICAgIGQucnFfaWQgPSBtaW5fcnFpOwogICAgICAgICBkLmJfYXZnbG9hZCA9IG1p
bl9hdmdsb2FkOwogICAgICAgICBkLm5ld19jcHUgPSBuZXdfY3B1OwpAQCAtMjQzMywxMCArMjQy
OCwxMCBAQCB0eXBlZGVmIHN0cnVjdCB7CiAgICAgc3RydWN0IGNzY2hlZDJfdW5pdCAqIGJlc3Rf
cHVzaF9zdmMsICpiZXN0X3B1bGxfc3ZjOwogICAgIC8qIE5COiBSZWFkIGJ5IGNvbnNpZGVyKCkg
Ki8KICAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpscnFkOwotICAgIHN0cnVjdCBj
c2NoZWQyX3J1bnF1ZXVlX2RhdGEgKm9ycWQ7ICAgICAgICAgICAgICAgICAgCisgICAgc3RydWN0
IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqb3JxZDsKIH0gYmFsYW5jZV9zdGF0ZV90OwogCi1zdGF0
aWMgdm9pZCBjb25zaWRlcihiYWxhbmNlX3N0YXRlX3QgKnN0LCAKK3N0YXRpYyB2b2lkIGNvbnNp
ZGVyKGJhbGFuY2Vfc3RhdGVfdCAqc3QsCiAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgY3Nj
aGVkMl91bml0ICpwdXNoX3N2YywKICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBjc2NoZWQy
X3VuaXQgKnB1bGxfc3ZjKQogewpAQCAtMjQ3NSwxNyArMjQ3MCwxNyBAQCBzdGF0aWMgdm9pZCBt
aWdyYXRlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKICAgICAgICAgICAgICAgICAgICAg
c3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqdHJxZCwKICAgICAgICAgICAgICAgICAgICAg
c190aW1lX3Qgbm93KQogewotICAgIGludCBjcHUgPSBzdmMtPnZjcHUtPnByb2Nlc3NvcjsKLSAg
ICBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCA9IHN2Yy0+dmNwdS0+c2NoZWRfdW5pdDsKKyAgICBz
dHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCA9IHN2Yy0+dW5pdDsKKyAgICBpbnQgY3B1ID0gc2NoZWRf
dW5pdF9jcHUodW5pdCk7CiAKICAgICBpZiAoIHVubGlrZWx5KHRiX2luaXRfZG9uZSkgKQogICAg
IHsKICAgICAgICAgc3RydWN0IHsKLSAgICAgICAgICAgIHVuc2lnbmVkIHZjcHU6MTYsIGRvbTox
NjsKKyAgICAgICAgICAgIHVuc2lnbmVkIHVuaXQ6MTYsIGRvbToxNjsKICAgICAgICAgICAgIHVu
c2lnbmVkIHJxaToxNiwgdHJxaToxNjsKICAgICAgICAgfSBkOwotICAgICAgICBkLmRvbSA9IHN2
Yy0+dmNwdS0+ZG9tYWluLT5kb21haW5faWQ7Ci0gICAgICAgIGQudmNwdSA9IHN2Yy0+dmNwdS0+
dmNwdV9pZDsKKyAgICAgICAgZC5kb20gPSB1bml0LT5kb21haW4tPmRvbWFpbl9pZDsKKyAgICAg
ICAgZC51bml0ID0gdW5pdC0+dW5pdF9pZDsKICAgICAgICAgZC5ycWkgPSBzdmMtPnJxZC0+aWQ7
CiAgICAgICAgIGQudHJxaSA9IHRycWQtPmlkOwogICAgICAgICBfX3RyYWNlX3ZhcihUUkNfQ1ND
SEVEMl9NSUdSQVRFLCAxLApAQCAtMjQ5Nyw3ICsyNDkyLDcgQEAgc3RhdGljIHZvaWQgbWlncmF0
ZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAgICAgewogICAgICAgICAvKiBJdCdzIHJ1
bm5pbmc7IG1hcmsgaXQgdG8gbWlncmF0ZS4gKi8KICAgICAgICAgc3ZjLT5taWdyYXRlX3JxZCA9
IHRycWQ7Ci0gICAgICAgIF9fc2V0X2JpdChfVlBGX21pZ3JhdGluZywgJnN2Yy0+dmNwdS0+cGF1
c2VfZmxhZ3MpOworICAgICAgICBzY2hlZF9zZXRfcGF1c2VfZmxhZ3ModW5pdCwgX1ZQRl9taWdy
YXRpbmcpOwogICAgICAgICBfX3NldF9iaXQoX19DU0ZMQUdfcnVucV9taWdyYXRlX3JlcXVlc3Qs
ICZzdmMtPmZsYWdzKTsKICAgICAgICAgU0NIRURfU1RBVF9DUkFOSyhtaWdyYXRlX3JlcXVlc3Rl
ZCk7CiAgICAgICAgIHRpY2tsZV9jcHUoY3B1LCBzdmMtPnJxZCk7CkBAIC0yNTA2LDcgKzI1MDEs
NyBAQCBzdGF0aWMgdm9pZCBtaWdyYXRlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKICAg
ICB7CiAgICAgICAgIGludCBvbl9ydW5xID0gMDsKICAgICAgICAgLyogSXQncyBub3QgcnVubmlu
ZzsganVzdCBtb3ZlIGl0ICovCi0gICAgICAgIGlmICggdmNwdV9vbl9ydW5xKHN2YykgKQorICAg
ICAgICBpZiAoIHVuaXRfb25fcnVucShzdmMpICkKICAgICAgICAgewogICAgICAgICAgICAgcnVu
cV9yZW1vdmUoc3ZjKTsKICAgICAgICAgICAgIHVwZGF0ZV9sb2FkKG9wcywgc3ZjLT5ycWQsIE5V
TEwsIC0xLCBub3cpOwpAQCAtMjUxNSwxNCArMjUxMCwxNCBAQCBzdGF0aWMgdm9pZCBtaWdyYXRl
KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKICAgICAgICAgX3J1bnFfZGVhc3NpZ24oc3Zj
KTsKIAogICAgICAgICBjcHVtYXNrX2FuZChjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksIHVuaXQt
PmNwdV9oYXJkX2FmZmluaXR5LAotICAgICAgICAgICAgICAgICAgICBjcHVwb29sX2RvbWFpbl9j
cHVtYXNrKHN2Yy0+dmNwdS0+ZG9tYWluKSk7CisgICAgICAgICAgICAgICAgICAgIGNwdXBvb2xf
ZG9tYWluX2NwdW1hc2sodW5pdC0+ZG9tYWluKSk7CiAgICAgICAgIGNwdW1hc2tfYW5kKGNwdW1h
c2tfc2NyYXRjaF9jcHUoY3B1KSwgY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLAogICAgICAgICAg
ICAgICAgICAgICAmdHJxZC0+YWN0aXZlKTsKLSAgICAgICAgc3ZjLT52Y3B1LT5wcm9jZXNzb3Ig
PSBjcHVtYXNrX2N5Y2xlKHRycWQtPnBpY2tfYmlhcywKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSk7Ci0gICAgICAg
IHN2Yy0+dmNwdS0+c2NoZWRfdW5pdC0+cmVzID0gZ2V0X3NjaGVkX3JlcyhzdmMtPnZjcHUtPnBy
b2Nlc3Nvcik7Ci0gICAgICAgIHRycWQtPnBpY2tfYmlhcyA9IHN2Yy0+dmNwdS0+cHJvY2Vzc29y
OwotICAgICAgICBBU1NFUlQoc3ZjLT52Y3B1LT5wcm9jZXNzb3IgPCBucl9jcHVfaWRzKTsKKyAg
ICAgICAgc2NoZWRfc2V0X3Jlcyh1bml0LAorICAgICAgICAgICAgICAgICAgICAgIGdldF9zY2hl
ZF9yZXMoY3B1bWFza19jeWNsZSh0cnFkLT5waWNrX2JpYXMsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSkp
KTsKKyAgICAgICAgdHJxZC0+cGlja19iaWFzID0gc2NoZWRfdW5pdF9jcHUodW5pdCk7CisgICAg
ICAgIEFTU0VSVChzY2hlZF91bml0X2NwdSh1bml0KSA8IG5yX2NwdV9pZHMpOwogCiAgICAgICAg
IF9ydW5xX2Fzc2lnbihzdmMsIHRycWQpOwogICAgICAgICBpZiAoIG9uX3J1bnEgKQpAQCAtMjU0
MiwxNCArMjUzNywxNCBAQCBzdGF0aWMgdm9pZCBtaWdyYXRlKGNvbnN0IHN0cnVjdCBzY2hlZHVs
ZXIgKm9wcywKICAqICAtIHN2YyBpcyBub3QgYWxyZWFkeSBmbGFnZ2VkIHRvIG1pZ3JhdGUsCiAg
KiAgLSBpZiBzdmMgaXMgYWxsb3dlZCB0byBydW4gb24gYXQgbGVhc3Qgb25lIG9mIHRoZSBwY3B1
cyBvZiBycWQuCiAgKi8KLXN0YXRpYyBib29sIHZjcHVfaXNfbWlncmF0ZWFibGUoc3RydWN0IGNz
Y2hlZDJfdW5pdCAqc3ZjLAorc3RhdGljIGJvb2wgdW5pdF9pc19taWdyYXRlYWJsZShzdHJ1Y3Qg
Y3NjaGVkMl91bml0ICpzdmMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ry
dWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFkKQogewotICAgIHN0cnVjdCB2Y3B1ICp2ID0g
c3ZjLT52Y3B1OwotICAgIGludCBjcHUgPSBzdmMtPnZjcHUtPnByb2Nlc3NvcjsKKyAgICBzdHJ1
Y3Qgc2NoZWRfdW5pdCAqdW5pdCA9IHN2Yy0+dW5pdDsKKyAgICBpbnQgY3B1ID0gc2NoZWRfdW5p
dF9jcHUodW5pdCk7CiAKLSAgICBjcHVtYXNrX2FuZChjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSks
IHYtPnNjaGVkX3VuaXQtPmNwdV9oYXJkX2FmZmluaXR5LAotICAgICAgICAgICAgICAgIGNwdXBv
b2xfZG9tYWluX2NwdW1hc2sodi0+ZG9tYWluKSk7CisgICAgY3B1bWFza19hbmQoY3B1bWFza19z
Y3JhdGNoX2NwdShjcHUpLCB1bml0LT5jcHVfaGFyZF9hZmZpbml0eSwKKyAgICAgICAgICAgICAg
ICBjcHVwb29sX2RvbWFpbl9jcHVtYXNrKHVuaXQtPmRvbWFpbikpOwogCiAgICAgcmV0dXJuICEo
c3ZjLT5mbGFncyAmIENTRkxBR19ydW5xX21pZ3JhdGVfcmVxdWVzdCkgJiYKICAgICAgICAgICAg
Y3B1bWFza19pbnRlcnNlY3RzKGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwgJnJxZC0+YWN0aXZl
KTsKQEAgLTI1ODYsNyArMjU4MSw3IEBAIHJldHJ5OgogICAgIGZvcl9lYWNoX2NwdShpLCAmcHJ2
LT5hY3RpdmVfcXVldWVzKQogICAgIHsKICAgICAgICAgc190aW1lX3QgZGVsdGE7Ci0gICAgICAg
IAorCiAgICAgICAgIHN0Lm9ycWQgPSBwcnYtPnJxZCArIGk7CiAKICAgICAgICAgaWYgKCBzdC5v
cnFkID09IHN0LmxycWQKQEAgLTI1OTQsNyArMjU4OSw3IEBAIHJldHJ5OgogICAgICAgICAgICAg
Y29udGludWU7CiAKICAgICAgICAgdXBkYXRlX3J1bnFfbG9hZChvcHMsIHN0Lm9ycWQsIDAsIG5v
dyk7Ci0gICAgCisKICAgICAgICAgZGVsdGEgPSBzdC5scnFkLT5iX2F2Z2xvYWQgLSBzdC5vcnFk
LT5iX2F2Z2xvYWQ7CiAgICAgICAgIGlmICggZGVsdGEgPCAwICkKICAgICAgICAgICAgIGRlbHRh
ID0gLWRlbHRhOwpAQCAtMjYxNyw3ICsyNjEyLDcgQEAgcmV0cnk6CiAgICAgICAgIHNfdGltZV90
IGxvYWRfbWF4OwogICAgICAgICBpbnQgY3B1c19tYXg7CiAKLSAgICAgICAgCisKICAgICAgICAg
bG9hZF9tYXggPSBzdC5scnFkLT5iX2F2Z2xvYWQ7CiAgICAgICAgIGlmICggc3Qub3JxZC0+Yl9h
dmdsb2FkID4gbG9hZF9tYXggKQogICAgICAgICAgICAgbG9hZF9tYXggPSBzdC5vcnFkLT5iX2F2
Z2xvYWQ7CkBAIC0yNjU2LDcgKzI2NTEsNyBAQCByZXRyeToKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBvcHRfb3ZlcmxvYWRfYmFsYW5jZV90b2xlcmFuY2UpKSAp
CiAgICAgICAgICAgICAgICAgZ290byBvdXQ7CiAgICAgfQotICAgICAgICAgICAgIAorCiAgICAg
LyogVHJ5IHRvIGdyYWIgdGhlIG90aGVyIHJ1bnF1ZXVlIGxvY2s7IGlmIGl0J3MgYmVlbiB0YWtl
biBpbiB0aGUKICAgICAgKiBtZWFudGltZSwgdHJ5IHRoZSBwcm9jZXNzIG92ZXIgYWdhaW4uICBU
aGlzIGNhbid0IGRlYWRsb2NrCiAgICAgICogYmVjYXVzZSBpZiBpdCBkb2Vzbid0IGdldCBhbnkg
b3RoZXIgcnFkIGxvY2tzLCBpdCB3aWxsIHNpbXBseQpAQCAtMjY5NiwxNyArMjY5MSwxNyBAQCBy
ZXRyeToKIAogICAgICAgICB1cGRhdGVfc3ZjX2xvYWQob3BzLCBwdXNoX3N2YywgMCwgbm93KTsK
IAotICAgICAgICBpZiAoICF2Y3B1X2lzX21pZ3JhdGVhYmxlKHB1c2hfc3ZjLCBzdC5vcnFkKSAp
CisgICAgICAgIGlmICggIXVuaXRfaXNfbWlncmF0ZWFibGUocHVzaF9zdmMsIHN0Lm9ycWQpICkK
ICAgICAgICAgICAgIGNvbnRpbnVlOwogCiAgICAgICAgIGxpc3RfZm9yX2VhY2goIHB1bGxfaXRl
ciwgJnN0Lm9ycWQtPnN2YyApCiAgICAgICAgIHsKICAgICAgICAgICAgIHN0cnVjdCBjc2NoZWQy
X3VuaXQgKiBwdWxsX3N2YyA9IGxpc3RfZW50cnkocHVsbF9pdGVyLCBzdHJ1Y3QgY3NjaGVkMl91
bml0LCBycWRfZWxlbSk7Ci0gICAgICAgICAgICAKKwogICAgICAgICAgICAgaWYgKCAhaW5uZXJf
bG9hZF91cGRhdGVkICkKICAgICAgICAgICAgICAgICB1cGRhdGVfc3ZjX2xvYWQob3BzLCBwdWxs
X3N2YywgMCwgbm93KTsKLSAgICAgICAgCi0gICAgICAgICAgICBpZiAoICF2Y3B1X2lzX21pZ3Jh
dGVhYmxlKHB1bGxfc3ZjLCBzdC5scnFkKSApCisKKyAgICAgICAgICAgIGlmICggIXVuaXRfaXNf
bWlncmF0ZWFibGUocHVsbF9zdmMsIHN0LmxycWQpICkKICAgICAgICAgICAgICAgICBjb250aW51
ZTsKIAogICAgICAgICAgICAgY29uc2lkZXIoJnN0LCBwdXNoX3N2YywgcHVsbF9zdmMpOwpAQCAt
MjcyMSw4ICsyNzE2LDggQEAgcmV0cnk6CiAgICAgbGlzdF9mb3JfZWFjaCggcHVsbF9pdGVyLCAm
c3Qub3JxZC0+c3ZjICkKICAgICB7CiAgICAgICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKiBwdWxs
X3N2YyA9IGxpc3RfZW50cnkocHVsbF9pdGVyLCBzdHJ1Y3QgY3NjaGVkMl91bml0LCBycWRfZWxl
bSk7Ci0gICAgICAgIAotICAgICAgICBpZiAoICF2Y3B1X2lzX21pZ3JhdGVhYmxlKHB1bGxfc3Zj
LCBzdC5scnFkKSApCisKKyAgICAgICAgaWYgKCAhdW5pdF9pc19taWdyYXRlYWJsZShwdWxsX3N2
Yywgc3QubHJxZCkgKQogICAgICAgICAgICAgY29udGludWU7CiAKICAgICAgICAgLyogQ29uc2lk
ZXIgcHVsbCBvbmx5ICovCkBAIC0yNzQ1LDggKzI3NDAsNyBAQCBzdGF0aWMgdm9pZAogY3NjaGVk
Ml91bml0X21pZ3JhdGUoCiAgICAgY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qg
c2NoZWRfdW5pdCAqdW5pdCwgdW5zaWduZWQgaW50IG5ld19jcHUpCiB7Ci0gICAgc3RydWN0IHZj
cHUgKnZjID0gdW5pdC0+dmNwdTsKLSAgICBzdHJ1Y3QgZG9tYWluICpkID0gdmMtPmRvbWFpbjsK
KyAgICBzdHJ1Y3QgZG9tYWluICpkID0gdW5pdC0+ZG9tYWluOwogICAgIHN0cnVjdCBjc2NoZWQy
X3VuaXQgKiBjb25zdCBzdmMgPSBjc2NoZWQyX3VuaXQodW5pdCk7CiAgICAgc3RydWN0IGNzY2hl
ZDJfcnVucXVldWVfZGF0YSAqdHJxZDsKICAgICBzX3RpbWVfdCBub3cgPSBOT1coKTsKQEAgLTI3
NTgsMjUgKzI3NTIsMjQgQEAgY3NjaGVkMl91bml0X21pZ3JhdGUoCiAgICAgICogY3B1cG9vbC4K
ICAgICAgKgogICAgICAqIEFuZCBzaW5jZSB0aGVyZSBpbmRlZWQgaXMgdGhlIGNoYW5jZSB0aGF0
IGl0IGlzIG5vdCBwYXJ0IG9mIGl0LCBhbGwKLSAgICAgKiB3ZSBtdXN0IGRvIGlzIHJlbW92ZSBf
YW5kXyB1bmFzc2lnbiB0aGUgdkNQVSBmcm9tIGFueSBydW5xdWV1ZSwgYXMKKyAgICAgKiB3ZSBt
dXN0IGRvIGlzIHJlbW92ZSBfYW5kXyB1bmFzc2lnbiB0aGUgdW5pdCBmcm9tIGFueSBydW5xdWV1
ZSwgYXMKICAgICAgKiB3ZWxsIGFzIHVwZGF0aW5nIHYtPnByb2Nlc3NvciB3aXRoIHRoZSB0YXJn
ZXQsIHNvIHRoYXQgdGhlIHN1c3BlbmQKICAgICAgKiBwcm9jZXNzIGNhbiBjb250aW51ZS4KICAg
ICAgKgogICAgICAqIEl0IHdpbGwgdGhlbiBiZSBkdXJpbmcgcmVzdW1lIHRoYXQgYSBuZXcsIG1l
YW5pbmdmdWwsIHZhbHVlIGZvcgogICAgICAqIHYtPnByb2Nlc3NvciB3aWxsIGJlIGNob3Nlbiwg
YW5kIGR1cmluZyBhY3R1YWwgZG9tYWluIHVucGF1c2UgdGhhdAotICAgICAqIHRoZSB2Q1BVIHdp
bGwgYmUgYXNzaWduZWQgdG8gYW5kIGFkZGVkIHRvIHRoZSBwcm9wZXIgcnVucXVldWUuCisgICAg
ICogdGhlIHVuaXQgd2lsbCBiZSBhc3NpZ25lZCB0byBhbmQgYWRkZWQgdG8gdGhlIHByb3BlciBy
dW5xdWV1ZS4KICAgICAgKi8KICAgICBpZiAoIHVubGlrZWx5KCFjcHVtYXNrX3Rlc3RfY3B1KG5l
d19jcHUsIGNwdXBvb2xfZG9tYWluX2NwdW1hc2soZCkpKSApCiAgICAgewogICAgICAgICBBU1NF
UlQoc3lzdGVtX3N0YXRlID09IFNZU19TVEFURV9zdXNwZW5kKTsKLSAgICAgICAgaWYgKCB2Y3B1
X29uX3J1bnEoc3ZjKSApCisgICAgICAgIGlmICggdW5pdF9vbl9ydW5xKHN2YykgKQogICAgICAg
ICB7CiAgICAgICAgICAgICBydW5xX3JlbW92ZShzdmMpOwogICAgICAgICAgICAgdXBkYXRlX2xv
YWQob3BzLCBzdmMtPnJxZCwgTlVMTCwgLTEsIG5vdyk7CiAgICAgICAgIH0KICAgICAgICAgX3J1
bnFfZGVhc3NpZ24oc3ZjKTsKLSAgICAgICAgdmMtPnByb2Nlc3NvciA9IG5ld19jcHU7Ci0gICAg
ICAgIHVuaXQtPnJlcyA9IGdldF9zY2hlZF9yZXMobmV3X2NwdSk7CisgICAgICAgIHNjaGVkX3Nl
dF9yZXModW5pdCwgZ2V0X3NjaGVkX3JlcyhuZXdfY3B1KSk7CiAgICAgICAgIHJldHVybjsKICAg
ICB9CiAKQEAgLTI3OTAsMTcgKzI3ODMsMTQgQEAgY3NjaGVkMl91bml0X21pZ3JhdGUoCiAgICAg
ICogRG8gdGhlIGFjdHVhbCBtb3ZlbWVudCB0b3dhcmQgbmV3X2NwdSwgYW5kIHVwZGF0ZSB2Yy0+
cHJvY2Vzc29yLgogICAgICAqIElmIHdlIGFyZSBjaGFuZ2luZyBydW5xdWV1ZSwgbWlncmF0ZSgp
IHRha2VzIGNhcmUgb2YgZXZlcnl0aGluZy4KICAgICAgKiBJZiB3ZSBhcmUgbm90IGNoYW5naW5n
IHJ1bnF1ZXVlLCB3ZSBuZWVkIHRvIHVwZGF0ZSB2Yy0+cHJvY2Vzc29yCi0gICAgICogaGVyZS4g
SW4gZmFjdCwgaWYsIGZvciBpbnN0YW5jZSwgd2UgYXJlIGhlcmUgYmVjYXVzZSB0aGUgdmNwdSdz
CisgICAgICogaGVyZS4gSW4gZmFjdCwgaWYsIGZvciBpbnN0YW5jZSwgd2UgYXJlIGhlcmUgYmVj
YXVzZSB0aGUgdW5pdCdzCiAgICAgICogaGFyZCBhZmZpbml0eSBjaGFuZ2VkLCB3ZSBkb24ndCB3
YW50IHRvIHJpc2sgbGVhdmluZyB2Yy0+cHJvY2Vzc29yCiAgICAgICogcG9pbnRpbmcgdG8gYSBw
Y3B1IHdoZXJlIHdlIGNhbid0IHJ1biBhbnkgbG9uZ2VyLgogICAgICAqLwogICAgIGlmICggdHJx
ZCAhPSBzdmMtPnJxZCApCiAgICAgICAgIG1pZ3JhdGUob3BzLCBzdmMsIHRycWQsIG5vdyk7CiAg
ICAgZWxzZQotICAgIHsKLSAgICAgICAgdmMtPnByb2Nlc3NvciA9IG5ld19jcHU7Ci0gICAgICAg
IHVuaXQtPnJlcyA9IGdldF9zY2hlZF9yZXMobmV3X2NwdSk7Ci0gICAgfQorICAgICAgICBzY2hl
ZF9zZXRfcmVzKHVuaXQsIGdldF9zY2hlZF9yZXMobmV3X2NwdSkpOwogfQogCiBzdGF0aWMgaW50
CkBAIC0yODEyLDE4ICsyODAyLDE4IEBAIGNzY2hlZDJfZG9tX2NudGwoCiAgICAgc3RydWN0IGNz
Y2hlZDJfZG9tICogY29uc3Qgc2RvbSA9IGNzY2hlZDJfZG9tKGQpOwogICAgIHN0cnVjdCBjc2No
ZWQyX3ByaXZhdGUgKnBydiA9IGNzY2hlZDJfcHJpdihvcHMpOwogICAgIHVuc2lnbmVkIGxvbmcg
ZmxhZ3M7Ci0gICAgc3RydWN0IHZjcHUgKnY7CisgICAgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQ7
CiAgICAgaW50IHJjID0gMDsKIAogICAgIC8qCiAgICAgICogTG9ja2luZzoKICAgICAgKiAgLSB3
ZSBtdXN0IHRha2UgdGhlIHByaXZhdGUgbG9jayBmb3IgYWNjZXNzaW5nIHRoZSB3ZWlnaHRzIG9m
IHRoZQotICAgICAqICAgIHZjcHVzIG9mIGQsIGFuZC9vciB0aGUgY2FwOworICAgICAqICAgIHVu
aXRzIG9mIGQsIGFuZC9vciB0aGUgY2FwOwogICAgICAqICAtIGluIHRoZSBwdXRpbmZvIGNhc2Us
IHdlIGFsc28gbmVlZCB0aGUgcnVucXVldWUgbG9jayhzKSwgZm9yCiAgICAgICogICAgdXBkYXRp
bmcgdGhlIG1heCB3YWlnaHQgb2YgdGhlIHJ1bnF1ZXVlKHMpLgogICAgICAqICAgIElmIGNoYW5n
aW5nIHRoZSBjYXAsIHdlIGFsc28gbmVlZCB0aGUgYnVkZ2V0X2xvY2ssIGZvciB1cGRhdGluZwog
ICAgICAqICAgIHRoZSB2YWx1ZSBvZiB0aGUgZG9tYWluIGJ1ZGdldCBwb29sIChhbmQgdGhlIHJ1
bnF1ZXVlIGxvY2ssCi0gICAgICogICAgZm9yIGFkanVzdGluZyB0aGUgcGFyYW1ldGVycyBhbmQg
cmVzY2hlZHVsaW5nIGFueSB2Q1BVIHRoYXQgaXMKKyAgICAgKiAgICBmb3IgYWRqdXN0aW5nIHRo
ZSBwYXJhbWV0ZXJzIGFuZCByZXNjaGVkdWxpbmcgYW55IHVuaXQgdGhhdCBpcwogICAgICAqICAg
IHJ1bm5pbmcgYXQgdGhlIHRpbWUgb2YgdGhlIGNoYW5nZSkuCiAgICAgICovCiAgICAgc3dpdGNo
ICggb3AtPmNtZCApCkBAIC0yODQ1LDE4ICsyODM1LDE4IEBAIGNzY2hlZDJfZG9tX2NudGwoCiAK
ICAgICAgICAgICAgIHNkb20tPndlaWdodCA9IG9wLT51LmNyZWRpdDIud2VpZ2h0OwogCi0gICAg
ICAgICAgICAvKiBVcGRhdGUgd2VpZ2h0cyBmb3IgdmNwdXMsIGFuZCBtYXhfd2VpZ2h0IGZvciBy
dW5xdWV1ZXMgb24gd2hpY2ggdGhleSByZXNpZGUgKi8KLSAgICAgICAgICAgIGZvcl9lYWNoX3Zj
cHUgKCBkLCB2ICkKKyAgICAgICAgICAgIC8qIFVwZGF0ZSB3ZWlnaHRzIGZvciB1bml0cywgYW5k
IG1heF93ZWlnaHQgZm9yIHJ1bnF1ZXVlcyBvbiB3aGljaCB0aGV5IHJlc2lkZSAqLworICAgICAg
ICAgICAgZm9yX2VhY2hfc2NoZWRfdW5pdCAoIGQsIHVuaXQgKQogICAgICAgICAgICAgewotICAg
ICAgICAgICAgICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YyA9IGNzY2hlZDJfdW5pdCh2LT5z
Y2hlZF91bml0KTsKLSAgICAgICAgICAgICAgICBzcGlubG9ja190ICpsb2NrID0gdW5pdF9zY2hl
ZHVsZV9sb2NrKHN2Yy0+dmNwdS0+c2NoZWRfdW5pdCk7CisgICAgICAgICAgICAgICAgc3RydWN0
IGNzY2hlZDJfdW5pdCAqc3ZjID0gY3NjaGVkMl91bml0KHVuaXQpOworICAgICAgICAgICAgICAg
IHNwaW5sb2NrX3QgKmxvY2sgPSB1bml0X3NjaGVkdWxlX2xvY2sodW5pdCk7CiAKLSAgICAgICAg
ICAgICAgICBBU1NFUlQoc3ZjLT5ycWQgPT0gYzJycWQob3BzLCBzdmMtPnZjcHUtPnByb2Nlc3Nv
cikpOworICAgICAgICAgICAgICAgIEFTU0VSVChzdmMtPnJxZCA9PSBjMnJxZChvcHMsIHNjaGVk
X3VuaXRfY3B1KHVuaXQpKSk7CiAKICAgICAgICAgICAgICAgICBzdmMtPndlaWdodCA9IHNkb20t
PndlaWdodDsKICAgICAgICAgICAgICAgICB1cGRhdGVfbWF4X3dlaWdodChzdmMtPnJxZCwgc3Zj
LT53ZWlnaHQsIG9sZF93ZWlnaHQpOwogCi0gICAgICAgICAgICAgICAgdW5pdF9zY2hlZHVsZV91
bmxvY2sobG9jaywgc3ZjLT52Y3B1LT5zY2hlZF91bml0KTsKKyAgICAgICAgICAgICAgICB1bml0
X3NjaGVkdWxlX3VubG9jayhsb2NrLCB1bml0KTsKICAgICAgICAgICAgIH0KICAgICAgICAgfQog
ICAgICAgICAvKiBDYXAgKi8KQEAgLTI4NjUsOCArMjg1NSw4IEBAIGNzY2hlZDJfZG9tX2NudGwo
CiAgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmM7CiAgICAgICAgICAgICBzcGlu
bG9ja190ICpsb2NrOwogCi0gICAgICAgICAgICAvKiBDYXAgaXMgb25seSB2YWxpZCBpZiBpdCdz
IGJlbG93IDEwMCAqIG5yX29mX3ZDUFVTICovCi0gICAgICAgICAgICBpZiAoIG9wLT51LmNyZWRp
dDIuY2FwID4gMTAwICogc2RvbS0+bnJfdmNwdXMgKQorICAgICAgICAgICAgLyogQ2FwIGlzIG9u
bHkgdmFsaWQgaWYgaXQncyBiZWxvdyAxMDAgKiBucl9vZl91bml0cyAqLworICAgICAgICAgICAg
aWYgKCBvcC0+dS5jcmVkaXQyLmNhcCA+IDEwMCAqIHNkb20tPm5yX3VuaXRzICkKICAgICAgICAg
ICAgIHsKICAgICAgICAgICAgICAgICByYyA9IC1FSU5WQUw7CiAgICAgICAgICAgICAgICAgd3Jp
dGVfdW5sb2NrX2lycXJlc3RvcmUoJnBydi0+bG9jaywgZmxhZ3MpOwpAQCAtMjg3OSwyMyArMjg2
OSwyMyBAQCBjc2NoZWQyX2RvbV9jbnRsKAogICAgICAgICAgICAgc3Bpbl91bmxvY2soJnNkb20t
PmJ1ZGdldF9sb2NrKTsKIAogICAgICAgICAgICAgLyoKLSAgICAgICAgICAgICAqIFdoZW4gdHJ5
aW5nIHRvIGdldCBzb21lIGJ1ZGdldCBhbmQgcnVuLCBlYWNoIHZDUFUgd2lsbCBncmFiCi0gICAg
ICAgICAgICAgKiBmcm9tIHRoZSBwb29sIDEvTiAod2l0aCBOID0gbnIgb2YgdkNQVXMgb2YgdGhl
IGRvbWFpbikgb2YKLSAgICAgICAgICAgICAqIHRoZSB0b3RhbCBidWRnZXQuIFJvdWdobHkgc3Bl
YWtpbmcsIHRoaXMgbWVhbnMgZWFjaCB2Q1BVIHdpbGwKKyAgICAgICAgICAgICAqIFdoZW4gdHJ5
aW5nIHRvIGdldCBzb21lIGJ1ZGdldCBhbmQgcnVuLCBlYWNoIHVuaXQgd2lsbCBncmFiCisgICAg
ICAgICAgICAgKiBmcm9tIHRoZSBwb29sIDEvTiAod2l0aCBOID0gbnIgb2YgdW5pdHMgb2YgdGhl
IGRvbWFpbikgb2YKKyAgICAgICAgICAgICAqIHRoZSB0b3RhbCBidWRnZXQuIFJvdWdobHkgc3Bl
YWtpbmcsIHRoaXMgbWVhbnMgZWFjaCB1bml0IHdpbGwKICAgICAgICAgICAgICAqIGhhdmUgYXQg
bGVhc3Qgb25lIGNoYW5jZSB0byBydW4gZHVyaW5nIGV2ZXJ5IHBlcmlvZC4KICAgICAgICAgICAg
ICAqLwotICAgICAgICAgICAgZm9yX2VhY2hfdmNwdSAoIGQsIHYgKQorICAgICAgICAgICAgZm9y
X2VhY2hfc2NoZWRfdW5pdCAoIGQsIHVuaXQgKQogICAgICAgICAgICAgewotICAgICAgICAgICAg
ICAgIHN2YyA9IGNzY2hlZDJfdW5pdCh2LT5zY2hlZF91bml0KTsKLSAgICAgICAgICAgICAgICBs
b2NrID0gdW5pdF9zY2hlZHVsZV9sb2NrKHN2Yy0+dmNwdS0+c2NoZWRfdW5pdCk7CisgICAgICAg
ICAgICAgICAgc3ZjID0gY3NjaGVkMl91bml0KHVuaXQpOworICAgICAgICAgICAgICAgIGxvY2sg
PSB1bml0X3NjaGVkdWxlX2xvY2sodW5pdCk7CiAgICAgICAgICAgICAgICAgLyoKICAgICAgICAg
ICAgICAgICAgKiBUb28gc21hbGwgcXVvdGFzIHdvdWxkIGluIHRoZW9yeSBjYXVzZSBhIGxvdCBv
ZiBvdmVyaGVhZCwKICAgICAgICAgICAgICAgICAgKiB3aGljaCB0aGVuIHdvbid0IGhhcHBlbiBi
ZWNhdXNlLCBpbiBjc2NoZWQyX3J1bnRpbWUoKSwKICAgICAgICAgICAgICAgICAgKiBDU0NIRUQy
X01JTl9USU1FUiBpcyB3aGF0IHdvdWxkIGJlIHVzZWQgYW55d2F5LgogICAgICAgICAgICAgICAg
ICAqLwotICAgICAgICAgICAgICAgIHN2Yy0+YnVkZ2V0X3F1b3RhID0gbWF4KHNkb20tPnRvdF9i
dWRnZXQgLyBzZG9tLT5ucl92Y3B1cywKKyAgICAgICAgICAgICAgICBzdmMtPmJ1ZGdldF9xdW90
YSA9IG1heChzZG9tLT50b3RfYnVkZ2V0IC8gc2RvbS0+bnJfdW5pdHMsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgQ1NDSEVEMl9NSU5fVElNRVIpOwotICAgICAgICAg
ICAgICAgIHVuaXRfc2NoZWR1bGVfdW5sb2NrKGxvY2ssIHN2Yy0+dmNwdS0+c2NoZWRfdW5pdCk7
CisgICAgICAgICAgICAgICAgdW5pdF9zY2hlZHVsZV91bmxvY2sobG9jaywgdW5pdCk7CiAgICAg
ICAgICAgICB9CiAKICAgICAgICAgICAgIGlmICggc2RvbS0+Y2FwID09IDAgKQpAQCAtMjkwNSw3
ICsyODk1LDcgQEAgY3NjaGVkMl9kb21fY250bCgKICAgICAgICAgICAgICAgICAgKiBhbmQgcXVl
dWUgaXRzIGZpcnN0IHJlcGxlbmlzaG1lbnQgZXZlbnQuCiAgICAgICAgICAgICAgICAgICoKICAg
ICAgICAgICAgICAgICAgKiBTaW5jZSBjYXAgaXMgY3VycmVudGx5IGRpc2FibGVkIGZvciB0aGlz
IGRvbWFpbiwgd2UKLSAgICAgICAgICAgICAgICAgKiBrbm93IG5vIHZDUFUgaXMgbWVzc2luZyB3
aXRoIHRoZSBkb21haW4ncyBidWRnZXQsIGFuZAorICAgICAgICAgICAgICAgICAqIGtub3cgbm8g
dW5pdCBpcyBtZXNzaW5nIHdpdGggdGhlIGRvbWFpbidzIGJ1ZGdldCwgYW5kCiAgICAgICAgICAg
ICAgICAgICogdGhlIHJlcGxlbmlzaG1lbnQgdGltZXIgaXMgc3RpbGwgb2ZmLgogICAgICAgICAg
ICAgICAgICAqIEZvciB0aGVzZSByZWFzb25zLCBpdCBpcyBzYWZlIHRvIGRvIHRoZSBmb2xsb3dp
bmcgd2l0aG91dAogICAgICAgICAgICAgICAgICAqIHRha2luZyB0aGUgYnVkZ2V0X2xvY2suCkBA
IC0yOTE1LDQyICsyOTA1LDQyIEBAIGNzY2hlZDJfZG9tX2NudGwoCiAgICAgICAgICAgICAgICAg
c2V0X3RpbWVyKCZzZG9tLT5yZXBsX3RpbWVyLCBzZG9tLT5uZXh0X3JlcGwpOwogCiAgICAgICAg
ICAgICAgICAgLyoKLSAgICAgICAgICAgICAgICAgKiBOb3csIGxldCdzIGVuYWJsZSBidWRnZXQg
YWNjb3VudGluZyBmb3IgYWxsIHRoZSB2Q1BVcy4KKyAgICAgICAgICAgICAgICAgKiBOb3csIGxl
dCdzIGVuYWJsZSBidWRnZXQgYWNjb3VudGluZyBmb3IgYWxsIHRoZSB1bml0cy4KICAgICAgICAg
ICAgICAgICAgKiBGb3IgbWFraW5nIHN1cmUgdGhhdCB0aGV5IHdpbGwgc3RhcnQgdG8gaG9ub3Vy
IHRoZSBkb21haW4ncwogICAgICAgICAgICAgICAgICAqIGNhcCwgd2Ugc2V0IHRoZWlyIGJ1ZGdl
dCB0byAwLgogICAgICAgICAgICAgICAgICAqIFRoaXMgd2F5LCBhcyBzb29uIGFzIHRoZXkgd2ls
bCB0cnkgdG8gcnVuLCB0aGV5IHdpbGwgaGF2ZQogICAgICAgICAgICAgICAgICAqIHRvIGdldCBz
b21lIGJ1ZGdldC4KICAgICAgICAgICAgICAgICAgKgotICAgICAgICAgICAgICAgICAqIEZvciB0
aGUgdkNQVXMgdGhhdCBhcmUgYWxyZWFkeSBydW5uaW5nLCB3ZSB0cmlnZ2VyIHRoZQorICAgICAg
ICAgICAgICAgICAqIEZvciB0aGUgdW5pdHMgdGhhdCBhcmUgYWxyZWFkeSBydW5uaW5nLCB3ZSB0
cmlnZ2VyIHRoZQogICAgICAgICAgICAgICAgICAqIHNjaGVkdWxlciBvbiB0aGVpciBwQ1BVLiBX
aGVuLCBhcyBhIGNvbnNlcXVlbmNlIG9mIHRoaXMsCiAgICAgICAgICAgICAgICAgICogY3NjaGVk
Ml9zY2hlZHVsZSgpIHdpbGwgcnVuLCBpdCB3aWxsIGZpZ3VyZSBvdXQgdGhlcmUgaXMKLSAgICAg
ICAgICAgICAgICAgKiBubyBidWRnZXQsIGFuZCB0aGUgdkNQVSB3aWxsIHRyeSB0byBnZXQgc29t
ZSAoYW5kIGJlIHBhcmtlZCwKKyAgICAgICAgICAgICAgICAgKiBubyBidWRnZXQsIGFuZCB0aGUg
dW5pdCB3aWxsIHRyeSB0byBnZXQgc29tZSAoYW5kIGJlIHBhcmtlZCwKICAgICAgICAgICAgICAg
ICAgKiBpZiB0aGVyZSdzIG5vbmUsIGFuZCB3ZSdsbCBzd2l0Y2ggdG8gc29tZW9uZSBlbHNlKS4K
ICAgICAgICAgICAgICAgICAgKi8KLSAgICAgICAgICAgICAgICBmb3JfZWFjaF92Y3B1ICggZCwg
diApCisgICAgICAgICAgICAgICAgZm9yX2VhY2hfc2NoZWRfdW5pdCAoIGQsIHVuaXQgKQogICAg
ICAgICAgICAgICAgIHsKLSAgICAgICAgICAgICAgICAgICAgc3ZjID0gY3NjaGVkMl91bml0KHYt
PnNjaGVkX3VuaXQpOwotICAgICAgICAgICAgICAgICAgICBsb2NrID0gdW5pdF9zY2hlZHVsZV9s
b2NrKHN2Yy0+dmNwdS0+c2NoZWRfdW5pdCk7Ci0gICAgICAgICAgICAgICAgICAgIGlmICggdi0+
c2NoZWRfdW5pdC0+aXNfcnVubmluZyApCisgICAgICAgICAgICAgICAgICAgIHN2YyA9IGNzY2hl
ZDJfdW5pdCh1bml0KTsKKyAgICAgICAgICAgICAgICAgICAgbG9jayA9IHVuaXRfc2NoZWR1bGVf
bG9jayh1bml0KTsKKyAgICAgICAgICAgICAgICAgICAgaWYgKCB1bml0LT5pc19ydW5uaW5nICkK
ICAgICAgICAgICAgICAgICAgICAgewotICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQg
aW50IGNwdSA9IHYtPnByb2Nlc3NvcjsKKyAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVk
IGludCBjcHUgPSBzY2hlZF91bml0X2NwdSh1bml0KTsKICAgICAgICAgICAgICAgICAgICAgICAg
IHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCA9IGMycnFkKG9wcywgY3B1KTsKIAot
ICAgICAgICAgICAgICAgICAgICAgICAgQVNTRVJUKGN1cnJfb25fY3B1KGNwdSktPnZjcHUgPT0g
dik7CisgICAgICAgICAgICAgICAgICAgICAgICBBU1NFUlQoY3Vycl9vbl9jcHUoY3B1KSA9PSB1
bml0KTsKIAogICAgICAgICAgICAgICAgICAgICAgICAgLyoKLSAgICAgICAgICAgICAgICAgICAg
ICAgICAqIFdlIGFyZSB0cmlnZ2VyaW5nIGEgcmVzY2hlZHVsZSBvbiB0aGUgdkNQVSdzCisgICAg
ICAgICAgICAgICAgICAgICAgICAgKiBXZSBhcmUgdHJpZ2dlcmluZyBhIHJlc2NoZWR1bGUgb24g
dGhlIHVuaXQncwogICAgICAgICAgICAgICAgICAgICAgICAgICogcENQVS4gVGhhdCB3aWxsIHJ1
biBidXJuX2NyZWRpdHMoKSBhbmQsIHNpbmNlCi0gICAgICAgICAgICAgICAgICAgICAgICAgKiB0
aGUgdkNQVSBpcyBjYXBwZWQgbm93LCBpdCB3b3VsZCBjaGFyZ2UgYWxsIHRoZQorICAgICAgICAg
ICAgICAgICAgICAgICAgICogdGhlIHVuaXQgaXMgY2FwcGVkIG5vdywgaXQgd291bGQgY2hhcmdl
IGFsbCB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgICAqIGV4ZWN1dGlvbiB0aW1lIG9mIHRo
aXMgbGFzdCByb3VuZCBhcyBidWRnZXQgYXMKLSAgICAgICAgICAgICAgICAgICAgICAgICAqIHdl
bGwuIFRoYXQgd2lsbCBtYWtlIHRoZSB2Q1BVIGJ1ZGdldCBnbyBuZWdhdGl2ZSwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAqIHdlbGwuIFRoYXQgd2lsbCBtYWtlIHRoZSB1bml0IGJ1ZGdldCBn
byBuZWdhdGl2ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAqIHBvdGVudGlhbGx5IGJ5IGEg
bGFyZ2UgYW1vdW50LCBhbmQgaXQncyB1bmZhaXIuCiAgICAgICAgICAgICAgICAgICAgICAgICAg
KgogICAgICAgICAgICAgICAgICAgICAgICAgICogVG8gYXZvaWQgdGhhdCwgY2FsbCBidXJuX2Ny
ZWRpdCgpIGhlcmUsIHRvIGRvIHRoZQogICAgICAgICAgICAgICAgICAgICAgICAgICogYWNjb3Vu
dGluZyBvZiB0aGlzIGN1cnJlbnQgcnVubmluZyBpbnN0YW5jZSBub3csCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgKiB3aXRoIGJ1ZGdldHRpbmcgc3RpbGwgZGlzYWJsZWQuIFRoaXMgZG9lcyBu
b3QKICAgICAgICAgICAgICAgICAgICAgICAgICAqIHByZXZlbnQgc29tZSBzbWFsbCBhbW91bnQg
b2YgYnVkZ2V0IGJlaW5nIGNoYXJnZWQKLSAgICAgICAgICAgICAgICAgICAgICAgICAqIHRvIHRo
ZSB2Q1BVIChpLmUuLCB0aGUgYW1vdW50IG9mIHRpbWUgaXQgcnVucyBmcm9tCisgICAgICAgICAg
ICAgICAgICAgICAgICAgKiB0byB0aGUgdW5pdCAoaS5lLiwgdGhlIGFtb3VudCBvZiB0aW1lIGl0
IHJ1bnMgZnJvbQogICAgICAgICAgICAgICAgICAgICAgICAgICogbm93LCB0byB3aGVuIHNjaGVk
dWxpbmcgaGFwcGVucykuIFRoZSBidWRnZXQgd2lsbAogICAgICAgICAgICAgICAgICAgICAgICAg
ICogYWxzbyBnbyBiZWxvdyAwLCBidXQgYSBsb3QgbGVzcyB0aGFuIGhvdyBpdCB3b3VsZAogICAg
ICAgICAgICAgICAgICAgICAgICAgICogaWYgd2UgZG9uJ3QgZG8gdGhpcy4KQEAgLTI5NjEsNyAr
Mjk1MSw3IEBAIGNzY2hlZDJfZG9tX2NudGwoCiAgICAgICAgICAgICAgICAgICAgICAgICBjcHVf
cmFpc2Vfc29mdGlycShjcHUsIFNDSEVEVUxFX1NPRlRJUlEpOwogICAgICAgICAgICAgICAgICAg
ICB9CiAgICAgICAgICAgICAgICAgICAgIHN2Yy0+YnVkZ2V0ID0gMDsKLSAgICAgICAgICAgICAg
ICAgICAgdW5pdF9zY2hlZHVsZV91bmxvY2sobG9jaywgc3ZjLT52Y3B1LT5zY2hlZF91bml0KTsK
KyAgICAgICAgICAgICAgICAgICAgdW5pdF9zY2hlZHVsZV91bmxvY2sobG9jaywgdW5pdCk7CiAg
ICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgfQogCkBAIC0yOTczLDMwICsyOTYzLDMwIEBA
IGNzY2hlZDJfZG9tX2NudGwoCiAKICAgICAgICAgICAgIHN0b3BfdGltZXIoJnNkb20tPnJlcGxf
dGltZXIpOwogCi0gICAgICAgICAgICAvKiBEaXNhYmxlIGJ1ZGdldCBhY2NvdW50aW5nIGZvciBh
bGwgdGhlIHZDUFVzLiAqLwotICAgICAgICAgICAgZm9yX2VhY2hfdmNwdSAoIGQsIHYgKQorICAg
ICAgICAgICAgLyogRGlzYWJsZSBidWRnZXQgYWNjb3VudGluZyBmb3IgYWxsIHRoZSB1bml0cy4g
Ki8KKyAgICAgICAgICAgIGZvcl9lYWNoX3NjaGVkX3VuaXQgKCBkLCB1bml0ICkKICAgICAgICAg
ICAgIHsKLSAgICAgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMgPSBjc2NoZWQy
X3VuaXQodi0+c2NoZWRfdW5pdCk7Ci0gICAgICAgICAgICAgICAgc3BpbmxvY2tfdCAqbG9jayA9
IHVuaXRfc2NoZWR1bGVfbG9jayhzdmMtPnZjcHUtPnNjaGVkX3VuaXQpOworICAgICAgICAgICAg
ICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2YyA9IGNzY2hlZDJfdW5pdCh1bml0KTsKKyAgICAg
ICAgICAgICAgICBzcGlubG9ja190ICpsb2NrID0gdW5pdF9zY2hlZHVsZV9sb2NrKHVuaXQpOwog
CiAgICAgICAgICAgICAgICAgc3ZjLT5idWRnZXQgPSBTVElNRV9NQVg7CiAgICAgICAgICAgICAg
ICAgc3ZjLT5idWRnZXRfcXVvdGEgPSAwOwogCi0gICAgICAgICAgICAgICAgdW5pdF9zY2hlZHVs
ZV91bmxvY2sobG9jaywgc3ZjLT52Y3B1LT5zY2hlZF91bml0KTsKKyAgICAgICAgICAgICAgICB1
bml0X3NjaGVkdWxlX3VubG9jayhsb2NrLCB1bml0KTsKICAgICAgICAgICAgIH0KICAgICAgICAg
ICAgIHNkb20tPmNhcCA9IDA7CiAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICogV2UgYXJl
IGRpc2FibGluZyB0aGUgY2FwIGZvciB0aGlzIGRvbWFpbiwgd2hpY2ggbWF5IGhhdmUKLSAgICAg
ICAgICAgICAqIHZDUFVzIHdhaXRpbmcgZm9yIGEgcmVwbGVuaXNobWVudCwgc28gd2UgdW5wYXJr
IHRoZW0gYWxsLgorICAgICAgICAgICAgICogdW5pdHMgd2FpdGluZyBmb3IgYSByZXBsZW5pc2ht
ZW50LCBzbyB3ZSB1bnBhcmsgdGhlbSBhbGwuCiAgICAgICAgICAgICAgKiBOb3RlIHRoYXQsIHNp
bmNlIHdlIGhhdmUgYWxyZWFkeSBkaXNhYmxlZCBidWRnZXQgYWNjb3VudGluZwotICAgICAgICAg
ICAgICogZm9yIGFsbCB0aGUgdkNQVXMgb2YgdGhlIGRvbWFpbiwgbm8gY3VycmVudGx5IHJ1bm5p
bmcgdkNQVQotICAgICAgICAgICAgICogd2lsbCBiZSBhZGRlZCB0byB0aGUgcGFya2VkIHZDUFVz
IGxpc3QgYW55IGxvbmdlci4KKyAgICAgICAgICAgICAqIGZvciBhbGwgdGhlIHVuaXRzIG9mIHRo
ZSBkb21haW4sIG5vIGN1cnJlbnRseSBydW5uaW5nIHVuaXQKKyAgICAgICAgICAgICAqIHdpbGwg
YmUgYWRkZWQgdG8gdGhlIHBhcmtlZCB1bml0cyBsaXN0IGFueSBsb25nZXIuCiAgICAgICAgICAg
ICAgKi8KICAgICAgICAgICAgIHNwaW5fbG9jaygmc2RvbS0+YnVkZ2V0X2xvY2spOwotICAgICAg
ICAgICAgbGlzdF9zcGxpY2VfaW5pdCgmc2RvbS0+cGFya2VkX3ZjcHVzLCAmcGFya2VkKTsKKyAg
ICAgICAgICAgIGxpc3Rfc3BsaWNlX2luaXQoJnNkb20tPnBhcmtlZF91bml0cywgJnBhcmtlZCk7
CiAgICAgICAgICAgICBzcGluX3VubG9jaygmc2RvbS0+YnVkZ2V0X2xvY2spOwogCi0gICAgICAg
ICAgICB1bnBhcmtfcGFya2VkX3ZjcHVzKG9wcywgJnBhcmtlZCk7CisgICAgICAgICAgICB1bnBh
cmtfcGFya2VkX3VuaXRzKG9wcywgJnBhcmtlZCk7CiAgICAgICAgIH0KICAgICAgICAgd3JpdGVf
dW5sb2NrX2lycXJlc3RvcmUoJnBydi0+bG9jaywgZmxhZ3MpOwogICAgICAgICBicmVhazsKQEAg
LTMwNzMsMTIgKzMwNjMsMTIgQEAgY3NjaGVkMl9hbGxvY19kb21kYXRhKGNvbnN0IHN0cnVjdCBz
Y2hlZHVsZXIgKm9wcywgc3RydWN0IGRvbWFpbiAqZG9tKQogICAgIHNkb20tPmRvbSA9IGRvbTsK
ICAgICBzZG9tLT53ZWlnaHQgPSBDU0NIRUQyX0RFRkFVTFRfV0VJR0hUOwogICAgIHNkb20tPmNh
cCA9IDBVOwotICAgIHNkb20tPm5yX3ZjcHVzID0gMDsKKyAgICBzZG9tLT5ucl91bml0cyA9IDA7
CiAKICAgICBpbml0X3RpbWVyKCZzZG9tLT5yZXBsX3RpbWVyLCByZXBsZW5pc2hfZG9tYWluX2J1
ZGdldCwgc2RvbSwKICAgICAgICAgICAgICAgIGNwdW1hc2tfYW55KGNwdXBvb2xfZG9tYWluX2Nw
dW1hc2soZG9tKSkpOwogICAgIHNwaW5fbG9ja19pbml0KCZzZG9tLT5idWRnZXRfbG9jayk7Ci0g
ICAgSU5JVF9MSVNUX0hFQUQoJnNkb20tPnBhcmtlZF92Y3B1cyk7CisgICAgSU5JVF9MSVNUX0hF
QUQoJnNkb20tPnBhcmtlZF91bml0cyk7CiAKICAgICB3cml0ZV9sb2NrX2lycXNhdmUoJnBydi0+
bG9jaywgZmxhZ3MpOwogCkBAIC0zMTEyLDM0ICszMTAyLDMyIEBAIGNzY2hlZDJfZnJlZV9kb21k
YXRhKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgdm9pZCAqZGF0YSkKIHN0YXRpYyB2b2lk
CiBjc2NoZWQyX3VuaXRfaW5zZXJ0KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0
IHNjaGVkX3VuaXQgKnVuaXQpCiB7Ci0gICAgc3RydWN0IHZjcHUgKnZjID0gdW5pdC0+dmNwdTsK
ICAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICpzdmMgPSB1bml0LT5wcml2OwogICAgIHN0cnVjdCBj
c2NoZWQyX2RvbSAqIGNvbnN0IHNkb20gPSBzdmMtPnNkb207CiAgICAgc3BpbmxvY2tfdCAqbG9j
azsKIAotICAgIEFTU0VSVCghaXNfaWRsZV92Y3B1KHZjKSk7CisgICAgQVNTRVJUKCFpc19pZGxl
X3VuaXQodW5pdCkpOwogICAgIEFTU0VSVChsaXN0X2VtcHR5KCZzdmMtPnJ1bnFfZWxlbSkpOwog
CiAgICAgLyogY3NjaGVkMl9yZXNfcGljaygpIGV4cGVjdHMgdGhlIHBjcHUgbG9jayB0byBiZSBo
ZWxkICovCiAgICAgbG9jayA9IHVuaXRfc2NoZWR1bGVfbG9ja19pcnEodW5pdCk7CiAKLSAgICB1
bml0LT5yZXMgPSBjc2NoZWQyX3Jlc19waWNrKG9wcywgdW5pdCk7Ci0gICAgdmMtPnByb2Nlc3Nv
ciA9IHVuaXQtPnJlcy0+cHJvY2Vzc29yOworICAgIHNjaGVkX3NldF9yZXModW5pdCwgY3NjaGVk
Ml9yZXNfcGljayhvcHMsIHVuaXQpKTsKIAogICAgIHNwaW5fdW5sb2NrX2lycShsb2NrKTsKIAog
ICAgIGxvY2sgPSB1bml0X3NjaGVkdWxlX2xvY2tfaXJxKHVuaXQpOwogCi0gICAgLyogQWRkIHZj
cHUgdG8gcnVucXVldWUgb2YgaW5pdGlhbCBwcm9jZXNzb3IgKi8KLSAgICBydW5xX2Fzc2lnbihv
cHMsIHZjKTsKKyAgICAvKiBBZGQgdW5pdCB0byBydW5xdWV1ZSBvZiBpbml0aWFsIHByb2Nlc3Nv
ciAqLworICAgIHJ1bnFfYXNzaWduKG9wcywgdW5pdCk7CiAKICAgICB1bml0X3NjaGVkdWxlX3Vu
bG9ja19pcnEobG9jaywgdW5pdCk7CiAKLSAgICBzZG9tLT5ucl92Y3B1cysrOworICAgIHNkb20t
Pm5yX3VuaXRzKys7CiAKICAgICBTQ0hFRF9TVEFUX0NSQU5LKHVuaXRfaW5zZXJ0KTsKIAotICAg
IENTQ0hFRDJfVkNQVV9DSEVDSyh2Yyk7CisgICAgQ1NDSEVEMl9VTklUX0NIRUNLKHVuaXQpOwog
fQogCiBzdGF0aWMgdm9pZApAQCAtMzE1MywxMSArMzE0MSwxMCBAQCBjc2NoZWQyX2ZyZWVfdmRh
dGEoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCB2b2lkICpwcml2KQogc3RhdGljIHZvaWQK
IGNzY2hlZDJfdW5pdF9yZW1vdmUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qg
c2NoZWRfdW5pdCAqdW5pdCkKIHsKLSAgICBzdHJ1Y3QgdmNwdSAqdmMgPSB1bml0LT52Y3B1Owog
ICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKiBjb25zdCBzdmMgPSBjc2NoZWQyX3VuaXQodW5pdCk7
CiAgICAgc3BpbmxvY2tfdCAqbG9jazsKIAotICAgIEFTU0VSVCghaXNfaWRsZV92Y3B1KHZjKSk7
CisgICAgQVNTRVJUKCFpc19pZGxlX3VuaXQodW5pdCkpOwogICAgIEFTU0VSVChsaXN0X2VtcHR5
KCZzdmMtPnJ1bnFfZWxlbSkpOwogCiAgICAgU0NIRURfU1RBVF9DUkFOSyh1bml0X3JlbW92ZSk7
CkBAIC0zMTY1LDE0ICszMTUyLDE0IEBAIGNzY2hlZDJfdW5pdF9yZW1vdmUoY29uc3Qgc3RydWN0
IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKICAgICAvKiBSZW1vdmUg
ZnJvbSBydW5xdWV1ZSAqLwogICAgIGxvY2sgPSB1bml0X3NjaGVkdWxlX2xvY2tfaXJxKHVuaXQp
OwogCi0gICAgcnVucV9kZWFzc2lnbihvcHMsIHZjKTsKKyAgICBydW5xX2RlYXNzaWduKG9wcywg
dW5pdCk7CiAKICAgICB1bml0X3NjaGVkdWxlX3VubG9ja19pcnEobG9jaywgdW5pdCk7CiAKLSAg
ICBzdmMtPnNkb20tPm5yX3ZjcHVzLS07CisgICAgc3ZjLT5zZG9tLT5ucl91bml0cy0tOwogfQog
Ci0vKiBIb3cgbG9uZyBzaG91bGQgd2UgbGV0IHRoaXMgdmNwdSBydW4gZm9yPyAqLworLyogSG93
IGxvbmcgc2hvdWxkIHdlIGxldCB0aGlzIHVuaXQgcnVuIGZvcj8gKi8KIHN0YXRpYyBzX3RpbWVf
dAogY3NjaGVkMl9ydW50aW1lKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgaW50IGNwdSwK
ICAgICAgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICpzbmV4dCwgc190aW1lX3Qgbm93
KQpAQCAtMzE4Nyw3ICszMTc0LDcgQEAgY3NjaGVkMl9ydW50aW1lKGNvbnN0IHN0cnVjdCBzY2hl
ZHVsZXIgKm9wcywgaW50IGNwdSwKICAgICAgKiBJZiB3ZSdyZSBpZGxlLCBqdXN0IHN0YXkgc28u
IE90aGVycyAob3IgZXh0ZXJuYWwgZXZlbnRzKQogICAgICAqIHdpbGwgcG9rZSB1cyB3aGVuIG5l
Y2Vzc2FyeS4KICAgICAgKi8KLSAgICBpZiAoIGlzX2lkbGVfdmNwdShzbmV4dC0+dmNwdSkgKQor
ICAgIGlmICggaXNfaWRsZV91bml0KHNuZXh0LT51bml0KSApCiAgICAgICAgIHJldHVybiAtMTsK
IAogICAgIC8qIEdlbmVyYWwgYWxnb3JpdGhtOgpAQCAtMzIwNCw4ICszMTkxLDggQEAgY3NjaGVk
Ml9ydW50aW1lKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgaW50IGNwdSwKICAgICBpZiAo
IHBydi0+cmF0ZWxpbWl0X3VzICkKICAgICB7CiAgICAgICAgIHNfdGltZV90IHJhdGVsaW1pdF9t
aW4gPSBNSUNST1NFQ1MocHJ2LT5yYXRlbGltaXRfdXMpOwotICAgICAgICBpZiAoIHNuZXh0LT52
Y3B1LT5zY2hlZF91bml0LT5pc19ydW5uaW5nICkKLSAgICAgICAgICAgIHJhdGVsaW1pdF9taW4g
PSBzbmV4dC0+dmNwdS0+c2NoZWRfdW5pdC0+c3RhdGVfZW50cnlfdGltZSArCisgICAgICAgIGlm
ICggc25leHQtPnVuaXQtPmlzX3J1bm5pbmcgKQorICAgICAgICAgICAgcmF0ZWxpbWl0X21pbiA9
IHNuZXh0LT51bml0LT5zdGF0ZV9lbnRyeV90aW1lICsKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBNSUNST1NFQ1MocHJ2LT5yYXRlbGltaXRfdXMpIC0gbm93OwogICAgICAgICBpZiAoIHJh
dGVsaW1pdF9taW4gPiBtaW5fdGltZSApCiAgICAgICAgICAgICBtaW5fdGltZSA9IHJhdGVsaW1p
dF9taW47CkBAIC0zMjIyLDcgKzMyMDksNyBAQCBjc2NoZWQyX3J1bnRpbWUoY29uc3Qgc3RydWN0
IHNjaGVkdWxlciAqb3BzLCBpbnQgY3B1LAogICAgIHsKICAgICAgICAgc3RydWN0IGNzY2hlZDJf
dW5pdCAqc3dhaXQgPSBydW5xX2VsZW0ocnVucS0+bmV4dCk7CiAKLSAgICAgICAgaWYgKCAhIGlz
X2lkbGVfdmNwdShzd2FpdC0+dmNwdSkKKyAgICAgICAgaWYgKCAhIGlzX2lkbGVfdW5pdChzd2Fp
dC0+dW5pdCkKICAgICAgICAgICAgICAmJiBzd2FpdC0+Y3JlZGl0ID4gMCApCiAgICAgICAgIHsK
ICAgICAgICAgICAgIHJ0X2NyZWRpdCA9IHNuZXh0LT5jcmVkaXQgLSBzd2FpdC0+Y3JlZGl0OwpA
QCAtMzIzNiw3ICszMjIzLDcgQEAgY3NjaGVkMl9ydW50aW1lKGNvbnN0IHN0cnVjdCBzY2hlZHVs
ZXIgKm9wcywgaW50IGNwdSwKICAgICAgKgogICAgICAqIEZJWE1FOiBTZWUgaWYgd2UgY2FuIGVs
aW1pbmF0ZSB0aGlzIGNvbnZlcnNpb24gaWYgd2Uga25vdyB0aW1lCiAgICAgICogd2lsbCBiZSBv
dXRzaWRlIChNSU4sTUFYKS4gIFByb2JhYmx5IHJlcXVpcmVzIHByZS1jYWxjdWxhdGluZwotICAg
ICAqIGNyZWRpdCB2YWx1ZXMgb2YgTUlOLE1BWCBwZXIgdmNwdSwgc2luY2UgZWFjaCB2Y3B1IGJ1
cm5zIGNyZWRpdAorICAgICAqIGNyZWRpdCB2YWx1ZXMgb2YgTUlOLE1BWCBwZXIgdW5pdCwgc2lu
Y2UgZWFjaCB1bml0IGJ1cm5zIGNyZWRpdAogICAgICAqIGF0IGEgZGlmZmVyZW50IHJhdGUuCiAg
ICAgICovCiAgICAgaWYgKCBydF9jcmVkaXQgPiAwICkKQEAgLTMyODQsMzYgKzMyNzEsMzUgQEAg
cnVucV9jYW5kaWRhdGUoc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFkLAogCiAgICAg
KnNraXBwZWQgPSAwOwogCi0gICAgaWYgKCB1bmxpa2VseShpc19pZGxlX3ZjcHUoc2N1cnItPnZj
cHUpKSApCisgICAgaWYgKCB1bmxpa2VseShpc19pZGxlX3VuaXQoc2N1cnItPnVuaXQpKSApCiAg
ICAgewogICAgICAgICBzbmV4dCA9IHNjdXJyOwogICAgICAgICBnb3RvIGNoZWNrX3J1bnE7CiAg
ICAgfQogCi0gICAgeWllbGQgPSBfX3Rlc3RfYW5kX2NsZWFyX2JpdChfX0NTRkxBR192Y3B1X3lp
ZWxkLCAmc2N1cnItPmZsYWdzKTsKKyAgICB5aWVsZCA9IF9fdGVzdF9hbmRfY2xlYXJfYml0KF9f
Q1NGTEFHX3VuaXRfeWllbGQsICZzY3Vyci0+ZmxhZ3MpOwogCiAgICAgLyoKLSAgICAgKiBSZXR1
cm4gdGhlIGN1cnJlbnQgdmNwdSBpZiBpdCBoYXMgZXhlY3V0ZWQgZm9yIGxlc3MgdGhhbiByYXRl
bGltaXQuCi0gICAgICogQWRqdXN0c3RtZW50IGZvciB0aGUgc2VsZWN0ZWQgdmNwdSdzIGNyZWRp
dCBhbmQgZGVjaXNpb24KKyAgICAgKiBSZXR1cm4gdGhlIGN1cnJlbnQgdW5pdCBpZiBpdCBoYXMg
ZXhlY3V0ZWQgZm9yIGxlc3MgdGhhbiByYXRlbGltaXQuCisgICAgICogQWRqdXN0c3RtZW50IGZv
ciB0aGUgc2VsZWN0ZWQgdW5pdCdzIGNyZWRpdCBhbmQgZGVjaXNpb24KICAgICAgKiBmb3IgaG93
IGxvbmcgaXQgd2lsbCBydW4gd2lsbCBiZSB0YWtlbiBpbiBjc2NoZWQyX3J1bnRpbWUuCiAgICAg
ICoKICAgICAgKiBOb3RlIHRoYXQsIGlmIHNjdXJyIGlzIHlpZWxkaW5nLCB3ZSBkb24ndCBsZXQg
cmF0ZSBsaW1pdGluZyBraWNrIGluLgogICAgICAqIEluIGZhY3QsIGl0IG1heSBiZSB0aGUgY2Fz
ZSB0aGF0IHNjdXJyIGlzIGFib3V0IHRvIHNwaW4sIGFuZCB0aGVyZSdzCiAgICAgICogbm8gcG9p
bnQgZm9yY2luZyBpdCB0byBkbyBzbyB1bnRpbCByYXRlIGxpbWl0aW5nIGV4cGlyZXMuCiAgICAg
ICovCi0gICAgaWYgKCAheWllbGQgJiYgcHJ2LT5yYXRlbGltaXRfdXMgJiYgdmNwdV9ydW5uYWJs
ZShzY3Vyci0+dmNwdSkgJiYKLSAgICAgICAgIChub3cgLSBzY3Vyci0+dmNwdS0+c2NoZWRfdW5p
dC0+c3RhdGVfZW50cnlfdGltZSkgPAotICAgICAgICAgIE1JQ1JPU0VDUyhwcnYtPnJhdGVsaW1p
dF91cykgKQorICAgIGlmICggIXlpZWxkICYmIHBydi0+cmF0ZWxpbWl0X3VzICYmIHVuaXRfcnVu
bmFibGUoc2N1cnItPnVuaXQpICYmCisgICAgICAgICAobm93IC0gc2N1cnItPnVuaXQtPnN0YXRl
X2VudHJ5X3RpbWUpIDwgTUlDUk9TRUNTKHBydi0+cmF0ZWxpbWl0X3VzKSApCiAgICAgewogICAg
ICAgICBpZiAoIHVubGlrZWx5KHRiX2luaXRfZG9uZSkgKQogICAgICAgICB7CiAgICAgICAgICAg
ICBzdHJ1Y3QgewotICAgICAgICAgICAgICAgIHVuc2lnbmVkIHZjcHU6MTYsIGRvbToxNjsKKyAg
ICAgICAgICAgICAgICB1bnNpZ25lZCB1bml0OjE2LCBkb206MTY7CiAgICAgICAgICAgICAgICAg
dW5zaWduZWQgcnVudGltZTsKICAgICAgICAgICAgIH0gZDsKLSAgICAgICAgICAgIGQuZG9tID0g
c2N1cnItPnZjcHUtPmRvbWFpbi0+ZG9tYWluX2lkOwotICAgICAgICAgICAgZC52Y3B1ID0gc2N1
cnItPnZjcHUtPnZjcHVfaWQ7Ci0gICAgICAgICAgICBkLnJ1bnRpbWUgPSBub3cgLSBzY3Vyci0+
dmNwdS0+c2NoZWRfdW5pdC0+c3RhdGVfZW50cnlfdGltZTsKKyAgICAgICAgICAgIGQuZG9tID0g
c2N1cnItPnVuaXQtPmRvbWFpbi0+ZG9tYWluX2lkOworICAgICAgICAgICAgZC51bml0ID0gc2N1
cnItPnVuaXQtPnVuaXRfaWQ7CisgICAgICAgICAgICBkLnJ1bnRpbWUgPSBub3cgLSBzY3Vyci0+
dW5pdC0+c3RhdGVfZW50cnlfdGltZTsKICAgICAgICAgICAgIF9fdHJhY2VfdmFyKFRSQ19DU0NI
RUQyX1JBVEVMSU1JVCwgMSwKICAgICAgICAgICAgICAgICAgICAgICAgIHNpemVvZihkKSwKICAg
ICAgICAgICAgICAgICAgICAgICAgICh1bnNpZ25lZCBjaGFyICopJmQpOwpAQCAtMzMyMiwxMyAr
MzMwOCwxMyBAQCBydW5xX2NhbmRpZGF0ZShzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpy
cWQsCiAgICAgfQogCiAgICAgLyogSWYgc2N1cnIgaGFzIGEgc29mdC1hZmZpbml0eSwgbGV0J3Mg
Y2hlY2sgd2hldGhlciBjcHUgaXMgcGFydCBvZiBpdCAqLwotICAgIGlmICggaGFzX3NvZnRfYWZm
aW5pdHkoc2N1cnItPnZjcHUtPnNjaGVkX3VuaXQpICkKKyAgICBpZiAoIGhhc19zb2Z0X2FmZmlu
aXR5KHNjdXJyLT51bml0KSApCiAgICAgewotICAgICAgICBhZmZpbml0eV9iYWxhbmNlX2NwdW1h
c2soc2N1cnItPnZjcHUtPnNjaGVkX3VuaXQsIEJBTEFOQ0VfU09GVF9BRkZJTklUWSwKKyAgICAg
ICAgYWZmaW5pdHlfYmFsYW5jZV9jcHVtYXNrKHNjdXJyLT51bml0LCBCQUxBTkNFX1NPRlRfQUZG
SU5JVFksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcHVtYXNrX3NjcmF0Y2gp
OwogICAgICAgICBpZiAoIHVubGlrZWx5KCFjcHVtYXNrX3Rlc3RfY3B1KGNwdSwgY3B1bWFza19z
Y3JhdGNoKSkgKQogICAgICAgICB7Ci0gICAgICAgICAgICBjcHVtYXNrX3QgKm9ubGluZSA9IGNw
dXBvb2xfZG9tYWluX2NwdW1hc2soc2N1cnItPnZjcHUtPmRvbWFpbik7CisgICAgICAgICAgICBj
cHVtYXNrX3QgKm9ubGluZSA9IGNwdXBvb2xfZG9tYWluX2NwdW1hc2soc2N1cnItPnVuaXQtPmRv
bWFpbik7CiAKICAgICAgICAgICAgIC8qIE9rLCBpcyBhbnkgb2YgdGhlIHBjcHVzIGluIHNjdXJy
IHNvZnQtYWZmaW5pdHkgaWRsZT8gKi8KICAgICAgICAgICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tf
c2NyYXRjaCwgY3B1bWFza19zY3JhdGNoLCAmcnFkLT5pZGxlKTsKQEAgLTMzNTYsMTAgKzMzNDIs
MTAgQEAgcnVucV9jYW5kaWRhdGUoc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFkLAog
ICAgICAqCiAgICAgICogT2YgY291cnNlLCB3ZSBhbHNvIGRlZmF1bHQgdG8gaWRsZSBhbHNvIGlm
IHNjdXJyIGlzIG5vdCBydW5uYWJsZS4KICAgICAgKi8KLSAgICBpZiAoIHZjcHVfcnVubmFibGUo
c2N1cnItPnZjcHUpICYmICFzb2Z0X2FmZl9wcmVlbXB0ICkKKyAgICBpZiAoIHVuaXRfcnVubmFi
bGUoc2N1cnItPnVuaXQpICYmICFzb2Z0X2FmZl9wcmVlbXB0ICkKICAgICAgICAgc25leHQgPSBz
Y3VycjsKICAgICBlbHNlCi0gICAgICAgIHNuZXh0ID0gY3NjaGVkMl91bml0KGlkbGVfdmNwdVtj
cHVdLT5zY2hlZF91bml0KTsKKyAgICAgICAgc25leHQgPSBjc2NoZWQyX3VuaXQoc2NoZWRfaWRs
ZV91bml0KGNwdSkpOwogCiAgY2hlY2tfcnVucToKICAgICBsaXN0X2Zvcl9lYWNoX3NhZmUoIGl0
ZXIsIHRlbXAsICZycWQtPnJ1bnEgKQpAQCAtMzM2OSwyNCArMzM1NSwyNCBAQCBydW5xX2NhbmRp
ZGF0ZShzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQsCiAgICAgICAgIGlmICggdW5s
aWtlbHkodGJfaW5pdF9kb25lKSApCiAgICAgICAgIHsKICAgICAgICAgICAgIHN0cnVjdCB7Ci0g
ICAgICAgICAgICAgICAgdW5zaWduZWQgdmNwdToxNiwgZG9tOjE2OworICAgICAgICAgICAgICAg
IHVuc2lnbmVkIHVuaXQ6MTYsIGRvbToxNjsKICAgICAgICAgICAgIH0gZDsKLSAgICAgICAgICAg
IGQuZG9tID0gc3ZjLT52Y3B1LT5kb21haW4tPmRvbWFpbl9pZDsKLSAgICAgICAgICAgIGQudmNw
dSA9IHN2Yy0+dmNwdS0+dmNwdV9pZDsKKyAgICAgICAgICAgIGQuZG9tID0gc3ZjLT51bml0LT5k
b21haW4tPmRvbWFpbl9pZDsKKyAgICAgICAgICAgIGQudW5pdCA9IHN2Yy0+dW5pdC0+dW5pdF9p
ZDsKICAgICAgICAgICAgIF9fdHJhY2VfdmFyKFRSQ19DU0NIRUQyX1JVTlFfQ0FORF9DSEVDSywg
MSwKICAgICAgICAgICAgICAgICAgICAgICAgIHNpemVvZihkKSwKICAgICAgICAgICAgICAgICAg
ICAgICAgICh1bnNpZ25lZCBjaGFyICopJmQpOwogICAgICAgICB9CiAKLSAgICAgICAgLyogT25s
eSBjb25zaWRlciB2Y3B1cyB0aGF0IGFyZSBhbGxvd2VkIHRvIHJ1biBvbiB0aGlzIHByb2Nlc3Nv
ci4gKi8KLSAgICAgICAgaWYgKCAhY3B1bWFza190ZXN0X2NwdShjcHUsIHN2Yy0+dmNwdS0+c2No
ZWRfdW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHkpICkKKyAgICAgICAgLyogT25seSBjb25zaWRlciB1
bml0cyB0aGF0IGFyZSBhbGxvd2VkIHRvIHJ1biBvbiB0aGlzIHByb2Nlc3Nvci4gKi8KKyAgICAg
ICAgaWYgKCAhY3B1bWFza190ZXN0X2NwdShjcHUsIHN2Yy0+dW5pdC0+Y3B1X2hhcmRfYWZmaW5p
dHkpICkKICAgICAgICAgewogICAgICAgICAgICAgKCpza2lwcGVkKSsrOwogICAgICAgICAgICAg
Y29udGludWU7CiAgICAgICAgIH0KIAogICAgICAgICAvKgotICAgICAgICAgKiBJZiBhIHZjcHUg
aXMgbWVhbnQgdG8gYmUgcGlja2VkIHVwIGJ5IGFub3RoZXIgcHJvY2Vzc29yLCBhbmQgc3VjaAor
ICAgICAgICAgKiBJZiBhbiB1bml0IGlzIG1lYW50IHRvIGJlIHBpY2tlZCB1cCBieSBhbm90aGVy
IHByb2Nlc3NvciwgYW5kIHN1Y2gKICAgICAgICAgICogcHJvY2Vzc29yIGhhcyBub3Qgc2NoZWR1
bGVkIHlldCwgbGVhdmUgaXQgaW4gdGhlIHJ1bnF1ZXVlIGZvciBoaW0uCiAgICAgICAgICAqLwog
ICAgICAgICBpZiAoIHN2Yy0+dGlja2xlZF9jcHUgIT0gLTEgJiYgc3ZjLT50aWNrbGVkX2NwdSAh
PSBjcHUgJiYKQEAgLTM0MDEsNyArMzM4Nyw3IEBAIHJ1bnFfY2FuZGlkYXRlKHN0cnVjdCBjc2No
ZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCwKICAgICAgICAgICogSWYgdGhpcyBpcyBvbiBhIGRpZmZl
cmVudCBwcm9jZXNzb3IsIGRvbid0IHB1bGwgaXQgdW5sZXNzCiAgICAgICAgICAqIGl0cyBjcmVk
aXQgaXMgYXQgbGVhc3QgQ1NDSEVEMl9NSUdSQVRFX1JFU0lTVCBoaWdoZXIuCiAgICAgICAgICAq
LwotICAgICAgICBpZiAoIHN2Yy0+dmNwdS0+cHJvY2Vzc29yICE9IGNwdQorICAgICAgICBpZiAo
IHNjaGVkX3VuaXRfY3B1KHN2Yy0+dW5pdCkgIT0gY3B1CiAgICAgICAgICAgICAgJiYgc25leHQt
PmNyZWRpdCArIENTQ0hFRDJfTUlHUkFURV9SRVNJU1QgPiBzdmMtPmNyZWRpdCApCiAgICAgICAg
IHsKICAgICAgICAgICAgICgqc2tpcHBlZCkrKzsKQEAgLTM0MTYsNyArMzQwMiw3IEBAIHJ1bnFf
Y2FuZGlkYXRlKHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCwKICAgICAgICAgICog
c29tZSBidWRnZXQsIHRoZW4gY2hvb3NlIGl0LgogICAgICAgICAgKi8KICAgICAgICAgaWYgKCAo
eWllbGQgfHwgc3ZjLT5jcmVkaXQgPiBzbmV4dC0+Y3JlZGl0KSAmJgotICAgICAgICAgICAgICgh
aGFzX2NhcChzdmMpIHx8IHZjcHVfZ3JhYl9idWRnZXQoc3ZjKSkgKQorICAgICAgICAgICAgICgh
aGFzX2NhcChzdmMpIHx8IHVuaXRfZ3JhYl9idWRnZXQoc3ZjKSkgKQogICAgICAgICAgICAgc25l
eHQgPSBzdmM7CiAKICAgICAgICAgLyogSW4gYW55IGNhc2UsIGlmIHdlIGdvdCB0aGlzIGZhciwg
YnJlYWsuICovCkBAIC0zNDI2LDEyICszNDEyLDEyIEBAIHJ1bnFfY2FuZGlkYXRlKHN0cnVjdCBj
c2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCwKICAgICBpZiAoIHVubGlrZWx5KHRiX2luaXRfZG9u
ZSkgKQogICAgIHsKICAgICAgICAgc3RydWN0IHsKLSAgICAgICAgICAgIHVuc2lnbmVkIHZjcHU6
MTYsIGRvbToxNjsKKyAgICAgICAgICAgIHVuc2lnbmVkIHVuaXQ6MTYsIGRvbToxNjsKICAgICAg
ICAgICAgIHVuc2lnbmVkIHRpY2tsZWRfY3B1LCBza2lwcGVkOwogICAgICAgICAgICAgaW50IGNy
ZWRpdDsKICAgICAgICAgfSBkOwotICAgICAgICBkLmRvbSA9IHNuZXh0LT52Y3B1LT5kb21haW4t
PmRvbWFpbl9pZDsKLSAgICAgICAgZC52Y3B1ID0gc25leHQtPnZjcHUtPnZjcHVfaWQ7CisgICAg
ICAgIGQuZG9tID0gc25leHQtPnVuaXQtPmRvbWFpbi0+ZG9tYWluX2lkOworICAgICAgICBkLnVu
aXQgPSBzbmV4dC0+dW5pdC0+dW5pdF9pZDsKICAgICAgICAgZC5jcmVkaXQgPSBzbmV4dC0+Y3Jl
ZGl0OwogICAgICAgICBkLnRpY2tsZWRfY3B1ID0gc25leHQtPnRpY2tsZWRfY3B1OwogICAgICAg
ICBkLnNraXBwZWQgPSAqc2tpcHBlZDsKQEAgLTM0NjMsMTQgKzM0NDksMTUgQEAgY3NjaGVkMl9z
Y2hlZHVsZSgKIHsKICAgICBjb25zdCBpbnQgY3B1ID0gc21wX3Byb2Nlc3Nvcl9pZCgpOwogICAg
IHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZDsKLSAgICBzdHJ1Y3QgY3NjaGVkMl91
bml0ICogY29uc3Qgc2N1cnIgPSBjc2NoZWQyX3VuaXQoY3VycmVudC0+c2NoZWRfdW5pdCk7Cisg
ICAgc3RydWN0IHNjaGVkX3VuaXQgKmN1cnJ1bml0ID0gY3VycmVudC0+c2NoZWRfdW5pdDsKKyAg
ICBzdHJ1Y3QgY3NjaGVkMl91bml0ICogY29uc3Qgc2N1cnIgPSBjc2NoZWQyX3VuaXQoY3VycnVu
aXQpOwogICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKnNuZXh0ID0gTlVMTDsKLSAgICB1bnNpZ25l
ZCBpbnQgc2tpcHBlZF92Y3B1cyA9IDA7CisgICAgdW5zaWduZWQgaW50IHNraXBwZWRfdW5pdHMg
PSAwOwogICAgIHN0cnVjdCB0YXNrX3NsaWNlIHJldDsKICAgICBib29sIHRpY2tsZWQ7CiAKICAg
ICBTQ0hFRF9TVEFUX0NSQU5LKHNjaGVkdWxlKTsKLSAgICBDU0NIRUQyX1ZDUFVfQ0hFQ0soY3Vy
cmVudCk7CisgICAgQ1NDSEVEMl9VTklUX0NIRUNLKGN1cnJ1bml0KTsKIAogICAgIEJVR19PTigh
Y3B1bWFza190ZXN0X2NwdShjcHUsICZjc2NoZWQyX3ByaXYob3BzKS0+aW5pdGlhbGl6ZWQpKTsK
IApAQCAtMzQ3OSw3ICszNDY2LDcgQEAgY3NjaGVkMl9zY2hlZHVsZSgKIAogICAgIEFTU0VSVChz
cGluX2lzX2xvY2tlZChnZXRfc2NoZWRfcmVzKGNwdSktPnNjaGVkdWxlX2xvY2spKTsKIAotICAg
IEJVR19PTighaXNfaWRsZV92Y3B1KHNjdXJyLT52Y3B1KSAmJiBzY3Vyci0+cnFkICE9IHJxZCk7
CisgICAgQlVHX09OKCFpc19pZGxlX3VuaXQoY3VycnVuaXQpICYmIHNjdXJyLT5ycWQgIT0gcnFk
KTsKIAogICAgIC8qIENsZWFyICJ0aWNrbGVkIiBiaXQgbm93IHRoYXQgd2UndmUgYmVlbiBzY2hl
ZHVsZWQgKi8KICAgICB0aWNrbGVkID0gY3B1bWFza190ZXN0X2NwdShjcHUsICZycWQtPnRpY2ts
ZWQpOwpAQCAtMzQ5OSw3ICszNDg2LDcgQEAgY3NjaGVkMl9zY2hlZHVsZSgKICAgICAgICAgZC5j
cHUgPSBjcHU7CiAgICAgICAgIGQucnFfaWQgPSBjMnIoY3B1KTsKICAgICAgICAgZC50YXNrbGV0
ID0gdGFza2xldF93b3JrX3NjaGVkdWxlZDsKLSAgICAgICAgZC5pZGxlID0gaXNfaWRsZV92Y3B1
KGN1cnJlbnQpOworICAgICAgICBkLmlkbGUgPSBpc19pZGxlX3VuaXQoY3VycnVuaXQpOwogICAg
ICAgICBkLnNtdF9pZGxlID0gY3B1bWFza190ZXN0X2NwdShjcHUsICZycWQtPnNtdF9pZGxlKTsK
ICAgICAgICAgZC50aWNrbGVkID0gdGlja2xlZDsKICAgICAgICAgX190cmFjZV92YXIoVFJDX0NT
Q0hFRDJfU0NIRURVTEUsIDEsCkBAIC0zNTEzLDU1ICszNTAwLDU1IEBAIGNzY2hlZDJfc2NoZWR1
bGUoCiAgICAgLyoKICAgICAgKiAgQmVsb3cgMCwgbWVhbnMgdGhhdCB3ZSBhcmUgY2FwcGVkIGFu
ZCB3ZSBoYXZlIG92ZXJydW4gb3VyICBidWRnZXQuCiAgICAgICogIExldCdzIHRyeSB0byBnZXQg
c29tZSBtb3JlIGJ1dCwgaWYgd2UgZmFpbCAoZS5nLiwgYmVjYXVzZSBvZiB0aGUKLSAgICAgKiAg
b3RoZXIgcnVubmluZyB2Y3B1cyksIHdlIHdpbGwgYmUgcGFya2VkLgorICAgICAqICBvdGhlciBy
dW5uaW5nIHVuaXRzKSwgd2Ugd2lsbCBiZSBwYXJrZWQuCiAgICAgICovCiAgICAgaWYgKCB1bmxp
a2VseShzY3Vyci0+YnVkZ2V0IDw9IDApICkKLSAgICAgICAgdmNwdV9ncmFiX2J1ZGdldChzY3Vy
cik7CisgICAgICAgIHVuaXRfZ3JhYl9idWRnZXQoc2N1cnIpOwogCiAgICAgLyoKLSAgICAgKiBT
ZWxlY3QgbmV4dCBydW5uYWJsZSBsb2NhbCBWQ1BVIChpZSB0b3Agb2YgbG9jYWwgcnVucSkuCisg
ICAgICogU2VsZWN0IG5leHQgcnVubmFibGUgbG9jYWwgVU5JVCAoaWUgdG9wIG9mIGxvY2FsIHJ1
bnEpLgogICAgICAqCi0gICAgICogSWYgdGhlIGN1cnJlbnQgdmNwdSBpcyBydW5uYWJsZSwgYW5k
IGhhcyBoaWdoZXIgY3JlZGl0IHRoYW4KKyAgICAgKiBJZiB0aGUgY3VycmVudCB1bml0IGlzIHJ1
bm5hYmxlLCBhbmQgaGFzIGhpZ2hlciBjcmVkaXQgdGhhbgogICAgICAqIHRoZSBuZXh0IGd1eSBv
biB0aGUgcXVldWUgKG9yIHRoZXJlIGlzIG5vb25lIGVsc2UpLCB3ZSB3YW50IHRvCiAgICAgICog
cnVuIGhpbSBhZ2Fpbi4KICAgICAgKgotICAgICAqIElmIHRoZXJlJ3MgdGFza2xldCB3b3JrIHRv
IGRvLCB3ZSB3YW50IHRvIGNob3NlIHRoZSBpZGxlIHZjcHUKKyAgICAgKiBJZiB0aGVyZSdzIHRh
c2tsZXQgd29yayB0byBkbywgd2Ugd2FudCB0byBjaG9zZSB0aGUgaWRsZSB1bml0CiAgICAgICog
Zm9yIHRoaXMgcHJvY2Vzc29yLCBhbmQgbWFyayB0aGUgY3VycmVudCBmb3IgZGVsYXllZCBydW5x
dWV1ZQogICAgICAqIGFkZC4KICAgICAgKgotICAgICAqIElmIHRoZSBjdXJyZW50IHZjcHUgaXMg
cnVubmFibGUsIGFuZCB0aGVyZSdzIGFub3RoZXIgcnVubmFibGUKKyAgICAgKiBJZiB0aGUgY3Vy
cmVudCB1bml0IGlzIHJ1bm5hYmxlLCBhbmQgdGhlcmUncyBhbm90aGVyIHJ1bm5hYmxlCiAgICAg
ICogY2FuZGlkYXRlLCB3ZSB3YW50IHRvIG1hcmsgY3VycmVudCBmb3IgZGVsYXllZCBydW5xdWV1
ZSBhZGQsCiAgICAgICogYW5kIHJlbW92ZSB0aGUgbmV4dCBndXkgZnJvbSB0aGUgcXVldWUuCiAg
ICAgICoKLSAgICAgKiBJZiB0aGUgY3VycmVudCB2Y3B1IGlzIG5vdCBydW5uYWJsZSwgd2Ugd2Fu
dCB0byBjaG9zZSB0aGUgaWRsZQotICAgICAqIHZjcHUgZm9yIHRoaXMgcHJvY2Vzc29yLgorICAg
ICAqIElmIHRoZSBjdXJyZW50IHVuaXQgaXMgbm90IHJ1bm5hYmxlLCB3ZSB3YW50IHRvIGNob3Nl
IHRoZSBpZGxlCisgICAgICogdW5pdCBmb3IgdGhpcyBwcm9jZXNzb3IuCiAgICAgICovCiAgICAg
aWYgKCB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkICkKICAgICB7Ci0gICAgICAgIF9fY2xlYXJfYml0
KF9fQ1NGTEFHX3ZjcHVfeWllbGQsICZzY3Vyci0+ZmxhZ3MpOworICAgICAgICBfX2NsZWFyX2Jp
dChfX0NTRkxBR191bml0X3lpZWxkLCAmc2N1cnItPmZsYWdzKTsKICAgICAgICAgdHJhY2VfdmFy
KFRSQ19DU0NIRUQyX1NDSEVEX1RBU0tMRVQsIDEsIDAsIE5VTEwpOwotICAgICAgICBzbmV4dCA9
IGNzY2hlZDJfdW5pdChpZGxlX3ZjcHVbY3B1XS0+c2NoZWRfdW5pdCk7CisgICAgICAgIHNuZXh0
ID0gY3NjaGVkMl91bml0KHNjaGVkX2lkbGVfdW5pdChjcHUpKTsKICAgICB9CiAgICAgZWxzZQot
ICAgICAgICBzbmV4dCA9IHJ1bnFfY2FuZGlkYXRlKHJxZCwgc2N1cnIsIGNwdSwgbm93LCAmc2tp
cHBlZF92Y3B1cyk7CisgICAgICAgIHNuZXh0ID0gcnVucV9jYW5kaWRhdGUocnFkLCBzY3Vyciwg
Y3B1LCBub3csICZza2lwcGVkX3VuaXRzKTsKIAotICAgIC8qIElmIHN3aXRjaGluZyBmcm9tIGEg
bm9uLWlkbGUgcnVubmFibGUgdmNwdSwgcHV0IGl0CisgICAgLyogSWYgc3dpdGNoaW5nIGZyb20g
YSBub24taWRsZSBydW5uYWJsZSB1bml0LCBwdXQgaXQKICAgICAgKiBiYWNrIG9uIHRoZSBydW5x
dWV1ZS4gKi8KICAgICBpZiAoIHNuZXh0ICE9IHNjdXJyCi0gICAgICAgICAmJiAhaXNfaWRsZV92
Y3B1KHNjdXJyLT52Y3B1KQotICAgICAgICAgJiYgdmNwdV9ydW5uYWJsZShjdXJyZW50KSApCisg
ICAgICAgICAmJiAhaXNfaWRsZV91bml0KGN1cnJ1bml0KQorICAgICAgICAgJiYgdW5pdF9ydW5u
YWJsZShjdXJydW5pdCkgKQogICAgICAgICBfX3NldF9iaXQoX19DU0ZMQUdfZGVsYXllZF9ydW5x
X2FkZCwgJnNjdXJyLT5mbGFncyk7CiAKICAgICByZXQubWlncmF0ZWQgPSAwOwogCiAgICAgLyog
QWNjb3VudGluZyBmb3Igbm9uLWlkbGUgdGFza3MgKi8KLSAgICBpZiAoICFpc19pZGxlX3ZjcHUo
c25leHQtPnZjcHUpICkKKyAgICBpZiAoICFpc19pZGxlX3VuaXQoc25leHQtPnVuaXQpICkKICAg
ICB7CiAgICAgICAgIC8qIElmIHN3aXRjaGluZywgcmVtb3ZlIHRoaXMgZnJvbSB0aGUgcnVucXVl
dWUgYW5kIG1hcmsgaXQgc2NoZWR1bGVkICovCiAgICAgICAgIGlmICggc25leHQgIT0gc2N1cnIg
KQogICAgICAgICB7CiAgICAgICAgICAgICBBU1NFUlQoc25leHQtPnJxZCA9PSBycWQpOwotICAg
ICAgICAgICAgQVNTRVJUKCFzbmV4dC0+dmNwdS0+c2NoZWRfdW5pdC0+aXNfcnVubmluZyk7Cisg
ICAgICAgICAgICBBU1NFUlQoIXNuZXh0LT51bml0LT5pc19ydW5uaW5nKTsKIAogICAgICAgICAg
ICAgcnVucV9yZW1vdmUoc25leHQpOwogICAgICAgICAgICAgX19zZXRfYml0KF9fQ1NGTEFHX3Nj
aGVkdWxlZCwgJnNuZXh0LT5mbGFncyk7CkBAIC0zNTc2LDE5ICszNTYzLDE5IEBAIGNzY2hlZDJf
c2NoZWR1bGUoCiAKICAgICAgICAgLyoKICAgICAgICAgICogVGhlIHJlc2V0IGNvbmRpdGlvbiBp
cyAiaGFzIGEgc2NoZWR1bGVyIGVwb2NoIGNvbWUgdG8gYW4gZW5kPyIuCi0gICAgICAgICAqIFRo
ZSB3YXkgdGhpcyBpcyBlbmZvcmNlZCBpcyBjaGVja2luZyB3aGV0aGVyIHRoZSB2Y3B1IGF0IHRo
ZSB0b3AKKyAgICAgICAgICogVGhlIHdheSB0aGlzIGlzIGVuZm9yY2VkIGlzIGNoZWNraW5nIHdo
ZXRoZXIgdGhlIHVuaXQgYXQgdGhlIHRvcAogICAgICAgICAgKiBvZiB0aGUgcnVucXVldWUgaGFz
IG5lZ2F0aXZlIGNyZWRpdHMuIFRoaXMgbWVhbnMgdGhlIGVwb2NocyBoYXZlCiAgICAgICAgICAq
IHZhcmlhYmxlIGxlbmd0aCwgYXMgaW4gb25lIGVwb2NoIGV4cG9yZXMgd2hlbjoKLSAgICAgICAg
ICogIDEpIHRoZSB2Y3B1IGF0IHRoZSB0b3Agb2YgdGhlIHJ1bnF1ZXVlIGhhcyBleGVjdXRlZCBm
b3IKKyAgICAgICAgICogIDEpIHRoZSB1bml0IGF0IHRoZSB0b3Agb2YgdGhlIHJ1bnF1ZXVlIGhh
cyBleGVjdXRlZCBmb3IKICAgICAgICAgICogICAgIGFyb3VuZCAxMCBtcyAod2l0aCBkZWZhdWx0
IHBhcmFtZXRlcnMpOwotICAgICAgICAgKiAgMikgbm8gb3RoZXIgdmNwdSB3aXRoIGhpZ2hlciBj
cmVkaXRzIHdhbnRzIHRvIHJ1bi4KKyAgICAgICAgICogIDIpIG5vIG90aGVyIHVuaXQgd2l0aCBo
aWdoZXIgY3JlZGl0cyB3YW50cyB0byBydW4uCiAgICAgICAgICAqCiAgICAgICAgICAqIEhlcmUs
IHdoZXJlIHdlIHdhbnQgdG8gY2hlY2sgZm9yIHJlc2V0LCB3ZSBuZWVkIHRvIG1ha2Ugc3VyZSB0
aGUKLSAgICAgICAgICogcHJvcGVyIHZjcHUgaXMgYmVpbmcgdXNlZC4gSW4gZmFjdCwgcnVucXVl
dWVfY2FuZGlkYXRlKCkgbWF5IGhhdmUKLSAgICAgICAgICogbm90IHJldHVybmVkIHRoZSBmaXJz
dCB2Y3B1IGluIHRoZSBydW5xdWV1ZSwgZm9yIHZhcmlvdXMgcmVhc29ucworICAgICAgICAgKiBw
cm9wZXIgdW5pdCBpcyBiZWluZyB1c2VkLiBJbiBmYWN0LCBydW5xdWV1ZV9jYW5kaWRhdGUoKSBt
YXkgaGF2ZQorICAgICAgICAgKiBub3QgcmV0dXJuZWQgdGhlIGZpcnN0IHVuaXQgaW4gdGhlIHJ1
bnF1ZXVlLCBmb3IgdmFyaW91cyByZWFzb25zCiAgICAgICAgICAqIChlLmcuLCBhZmZpbml0eSku
IE9ubHkgdHJpZ2dlciBhIHJlc2V0IHdoZW4gaXQgZG9lcy4KICAgICAgICAgICovCi0gICAgICAg
IGlmICggc2tpcHBlZF92Y3B1cyA9PSAwICYmIHNuZXh0LT5jcmVkaXQgPD0gQ1NDSEVEMl9DUkVE
SVRfUkVTRVQgKQorICAgICAgICBpZiAoIHNraXBwZWRfdW5pdHMgPT0gMCAmJiBzbmV4dC0+Y3Jl
ZGl0IDw9IENTQ0hFRDJfQ1JFRElUX1JFU0VUICkKICAgICAgICAgewogICAgICAgICAgICAgcmVz
ZXRfY3JlZGl0KG9wcywgY3B1LCBub3csIHNuZXh0KTsKICAgICAgICAgICAgIGJhbGFuY2VfbG9h
ZChvcHMsIGNwdSwgbm93KTsKQEAgLTM1OTgsMTEgKzM1ODUsMTAgQEAgY3NjaGVkMl9zY2hlZHVs
ZSgKICAgICAgICAgc25leHQtPnRpY2tsZWRfY3B1ID0gLTE7CiAKICAgICAgICAgLyogU2FmZSBi
ZWNhdXNlIGxvY2sgZm9yIG9sZCBwcm9jZXNzb3IgaXMgaGVsZCAqLwotICAgICAgICBpZiAoIHNu
ZXh0LT52Y3B1LT5wcm9jZXNzb3IgIT0gY3B1ICkKKyAgICAgICAgaWYgKCBzY2hlZF91bml0X2Nw
dShzbmV4dC0+dW5pdCkgIT0gY3B1ICkKICAgICAgICAgewogICAgICAgICAgICAgc25leHQtPmNy
ZWRpdCArPSBDU0NIRUQyX01JR1JBVEVfQ09NUEVOU0FUSU9OOwotICAgICAgICAgICAgc25leHQt
PnZjcHUtPnByb2Nlc3NvciA9IGNwdTsKLSAgICAgICAgICAgIHNuZXh0LT52Y3B1LT5zY2hlZF91
bml0LT5yZXMgPSBnZXRfc2NoZWRfcmVzKGNwdSk7CisgICAgICAgICAgICBzY2hlZF9zZXRfcmVz
KHNuZXh0LT51bml0LCBnZXRfc2NoZWRfcmVzKGNwdSkpOwogICAgICAgICAgICAgU0NIRURfU1RB
VF9DUkFOSyhtaWdyYXRlZCk7CiAgICAgICAgICAgICByZXQubWlncmF0ZWQgPSAxOwogICAgICAg
ICB9CkBAIC0zNjM2LDIwICszNjIyLDIwIEBAIGNzY2hlZDJfc2NoZWR1bGUoCiAgICAgICogUmV0
dXJuIHRhc2sgdG8gcnVuIG5leHQuLi4KICAgICAgKi8KICAgICByZXQudGltZSA9IGNzY2hlZDJf
cnVudGltZShvcHMsIGNwdSwgc25leHQsIG5vdyk7Ci0gICAgcmV0LnRhc2sgPSBzbmV4dC0+dmNw
dS0+c2NoZWRfdW5pdDsKKyAgICByZXQudGFzayA9IHNuZXh0LT51bml0OwogCi0gICAgQ1NDSEVE
Ml9WQ1BVX0NIRUNLKHJldC50YXNrLT52Y3B1KTsKKyAgICBDU0NIRUQyX1VOSVRfQ0hFQ0socmV0
LnRhc2spOwogICAgIHJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyB2b2lkCi1jc2NoZWQyX2R1bXBf
dmNwdShzdHJ1Y3QgY3NjaGVkMl9wcml2YXRlICpwcnYsIHN0cnVjdCBjc2NoZWQyX3VuaXQgKnN2
YykKK2NzY2hlZDJfZHVtcF91bml0KHN0cnVjdCBjc2NoZWQyX3ByaXZhdGUgKnBydiwgc3RydWN0
IGNzY2hlZDJfdW5pdCAqc3ZjKQogewogICAgIHByaW50aygiWyVpLiVpXSBmbGFncz0leCBjcHU9
JWkiLAotICAgICAgICAgICAgc3ZjLT52Y3B1LT5kb21haW4tPmRvbWFpbl9pZCwKLSAgICAgICAg
ICAgIHN2Yy0+dmNwdS0+dmNwdV9pZCwKKyAgICAgICAgICAgIHN2Yy0+dW5pdC0+ZG9tYWluLT5k
b21haW5faWQsCisgICAgICAgICAgICBzdmMtPnVuaXQtPnVuaXRfaWQsCiAgICAgICAgICAgICBz
dmMtPmZsYWdzLAotICAgICAgICAgICAgc3ZjLT52Y3B1LT5wcm9jZXNzb3IpOworICAgICAgICAg
ICAgc2NoZWRfdW5pdF9jcHUoc3ZjLT51bml0KSk7CiAKICAgICBwcmludGsoIiBjcmVkaXQ9JSIg
UFJJaTMyIiBbdz0ldV0iLCBzdmMtPmNyZWRpdCwgc3ZjLT53ZWlnaHQpOwogCkBAIC0zNjc0LDEy
ICszNjYwLDEyIEBAIGR1bXBfcGNwdShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGludCBj
cHUpCiAgICAgICAgICAgIG5yX2NwdV9pZHMsIGNwdW1hc2tfYml0cyhwZXJfY3B1KGNwdV9zaWJs
aW5nX21hc2ssIGNwdSkpLAogICAgICAgICAgICBucl9jcHVfaWRzLCBjcHVtYXNrX2JpdHMocGVy
X2NwdShjcHVfY29yZV9tYXNrLCBjcHUpKSk7CiAKLSAgICAvKiBjdXJyZW50IFZDUFUgKG5vdGhp
bmcgdG8gc2F5IGlmIHRoYXQncyB0aGUgaWRsZSB2Y3B1KSAqLworICAgIC8qIGN1cnJlbnQgVU5J
VCAobm90aGluZyB0byBzYXkgaWYgdGhhdCdzIHRoZSBpZGxlIHVuaXQpICovCiAgICAgc3ZjID0g
Y3NjaGVkMl91bml0KGN1cnJfb25fY3B1KGNwdSkpOwotICAgIGlmICggc3ZjICYmICFpc19pZGxl
X3ZjcHUoc3ZjLT52Y3B1KSApCisgICAgaWYgKCBzdmMgJiYgIWlzX2lkbGVfdW5pdChzdmMtPnVu
aXQpICkKICAgICB7CiAgICAgICAgIHByaW50aygiXHRydW46ICIpOwotICAgICAgICBjc2NoZWQy
X2R1bXBfdmNwdShwcnYsIHN2Yyk7CisgICAgICAgIGNzY2hlZDJfZHVtcF91bml0KHBydiwgc3Zj
KTsKICAgICB9CiB9CiAKQEAgLTM3MzYsNyArMzcyMiw3IEBAIGNzY2hlZDJfZHVtcChjb25zdCBz
dHJ1Y3Qgc2NoZWR1bGVyICpvcHMpCiAgICAgbGlzdF9mb3JfZWFjaCggaXRlcl9zZG9tLCAmcHJ2
LT5zZG9tICkKICAgICB7CiAgICAgICAgIHN0cnVjdCBjc2NoZWQyX2RvbSAqc2RvbTsKLSAgICAg
ICAgc3RydWN0IHZjcHUgKnY7CisgICAgICAgIHN0cnVjdCBzY2hlZF91bml0ICp1bml0OwogCiAg
ICAgICAgIHNkb20gPSBsaXN0X2VudHJ5KGl0ZXJfc2RvbSwgc3RydWN0IGNzY2hlZDJfZG9tLCBz
ZG9tX2VsZW0pOwogCkBAIC0zNzQ0LDE5ICszNzMwLDE5IEBAIGNzY2hlZDJfZHVtcChjb25zdCBz
dHJ1Y3Qgc2NoZWR1bGVyICpvcHMpCiAgICAgICAgICAgICAgICBzZG9tLT5kb20tPmRvbWFpbl9p
ZCwKICAgICAgICAgICAgICAgIHNkb20tPndlaWdodCwKICAgICAgICAgICAgICAgIHNkb20tPmNh
cCwKLSAgICAgICAgICAgICAgIHNkb20tPm5yX3ZjcHVzKTsKKyAgICAgICAgICAgICAgIHNkb20t
Pm5yX3VuaXRzKTsKIAotICAgICAgICBmb3JfZWFjaF92Y3B1KCBzZG9tLT5kb20sIHYgKQorICAg
ICAgICBmb3JfZWFjaF9zY2hlZF91bml0ICggc2RvbS0+ZG9tLCB1bml0ICkKICAgICAgICAgewot
ICAgICAgICAgICAgc3RydWN0IGNzY2hlZDJfdW5pdCAqIGNvbnN0IHN2YyA9IGNzY2hlZDJfdW5p
dCh2LT5zY2hlZF91bml0KTsKKyAgICAgICAgICAgIHN0cnVjdCBjc2NoZWQyX3VuaXQgKiBjb25z
dCBzdmMgPSBjc2NoZWQyX3VuaXQodW5pdCk7CiAgICAgICAgICAgICBzcGlubG9ja190ICpsb2Nr
OwogCi0gICAgICAgICAgICBsb2NrID0gdW5pdF9zY2hlZHVsZV9sb2NrKHN2Yy0+dmNwdS0+c2No
ZWRfdW5pdCk7CisgICAgICAgICAgICBsb2NrID0gdW5pdF9zY2hlZHVsZV9sb2NrKHVuaXQpOwog
CiAgICAgICAgICAgICBwcmludGsoIlx0JTNkOiAiLCArK2xvb3ApOwotICAgICAgICAgICAgY3Nj
aGVkMl9kdW1wX3ZjcHUocHJ2LCBzdmMpOworICAgICAgICAgICAgY3NjaGVkMl9kdW1wX3VuaXQo
cHJ2LCBzdmMpOwogCi0gICAgICAgICAgICB1bml0X3NjaGVkdWxlX3VubG9jayhsb2NrLCBzdmMt
PnZjcHUtPnNjaGVkX3VuaXQpOworICAgICAgICAgICAgdW5pdF9zY2hlZHVsZV91bmxvY2sobG9j
aywgdW5pdCk7CiAgICAgICAgIH0KICAgICB9CiAKQEAgLTM3ODIsNyArMzc2OCw3IEBAIGNzY2hl
ZDJfZHVtcChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMpCiAgICAgICAgICAgICBpZiAoIHN2
YyApCiAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgcHJpbnRrKCJcdCUzZDogIiwgbG9v
cCsrKTsKLSAgICAgICAgICAgICAgICBjc2NoZWQyX2R1bXBfdmNwdShwcnYsIHN2Yyk7CisgICAg
ICAgICAgICAgICAgY3NjaGVkMl9kdW1wX3VuaXQocHJ2LCBzdmMpOwogICAgICAgICAgICAgfQog
ICAgICAgICB9CiAgICAgICAgIHNwaW5fdW5sb2NrKCZycWQtPmxvY2spOwpAQCAtMzg4Miw3ICsz
ODY4LDcgQEAgY3NjaGVkMl9zd2l0Y2hfc2NoZWQoc3RydWN0IHNjaGVkdWxlciAqbmV3X29wcywg
dW5zaWduZWQgaW50IGNwdSwKICAgICBzdHJ1Y3Qgc2NoZWRfcmVzb3VyY2UgKnNkID0gZ2V0X3Nj
aGVkX3JlcyhjcHUpOwogICAgIHVuc2lnbmVkIHJxaTsKIAotICAgIEFTU0VSVChwZGF0YSAmJiBz
dmMgJiYgaXNfaWRsZV92Y3B1KHN2Yy0+dmNwdSkpOworICAgIEFTU0VSVChwZGF0YSAmJiBzdmMg
JiYgaXNfaWRsZV91bml0KHN2Yy0+dW5pdCkpOwogCiAgICAgLyoKICAgICAgKiBXZSBvd24gb25l
IHJ1bnF1ZXVlIGxvY2sgYWxyZWFkeSAoZnJvbSBzY2hlZHVsZV9jcHVfc3dpdGNoKCkpLiBUaGlz
CkBAIC0zODk1LDcgKzM4ODEsNyBAQCBjc2NoZWQyX3N3aXRjaF9zY2hlZChzdHJ1Y3Qgc2NoZWR1
bGVyICpuZXdfb3BzLCB1bnNpZ25lZCBpbnQgY3B1LAogICAgIEFTU0VSVCghbG9jYWxfaXJxX2lz
X2VuYWJsZWQoKSk7CiAgICAgd3JpdGVfbG9jaygmcHJ2LT5sb2NrKTsKIAotICAgIGlkbGVfdmNw
dVtjcHVdLT5zY2hlZF91bml0LT5wcml2ID0gdmRhdGE7CisgICAgc2NoZWRfaWRsZV91bml0KGNw
dSktPnByaXYgPSB2ZGF0YTsKIAogICAgIHJxaSA9IGluaXRfcGRhdGEocHJ2LCBwZGF0YSwgY3B1
KTsKIApAQCAtMzkzNyw3ICszOTIzLDcgQEAgY3NjaGVkMl9kZWluaXRfcGRhdGEoY29uc3Qgc3Ry
dWN0IHNjaGVkdWxlciAqb3BzLCB2b2lkICpwY3B1LCBpbnQgY3B1KQogICAgICAqLwogICAgIEFT
U0VSVChzcGMgJiYgc3BjLT5ydW5xX2lkICE9IC0xKTsKICAgICBBU1NFUlQoY3B1bWFza190ZXN0
X2NwdShjcHUsICZwcnYtPmluaXRpYWxpemVkKSk7Ci0gICAgCisKICAgICAvKiBGaW5kIHRoZSBv
bGQgcnVucXVldWUgYW5kIHJlbW92ZSB0aGlzIGNwdSBmcm9tIGl0ICovCiAgICAgcnFkID0gcHJ2
LT5ycWQgKyBzcGMtPnJ1bnFfaWQ7CiAKLS0gCjIuMTYuNAoKCl9fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRl
dmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFp
bG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

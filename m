Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 6F17D18F293
	for <lists+xen-devel@lfdr.de>; Mon, 23 Mar 2020 11:20:15 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1jGK9O-0007XJ-Rc; Mon, 23 Mar 2020 10:17:42 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=0LFc=5I=citrix.com=andrew.cooper3@srs-us1.protection.inumbo.net>)
 id 1jGK9N-0007Ws-Cu
 for xen-devel@lists.xenproject.org; Mon, 23 Mar 2020 10:17:41 +0000
X-Inumbo-ID: 851d5bf0-6cef-11ea-bec1-bc764e2007e4
Received: from esa4.hc3370-68.iphmx.com (unknown [216.71.155.144])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 851d5bf0-6cef-11ea-bec1-bc764e2007e4;
 Mon, 23 Mar 2020 10:17:37 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1584958657;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=oY1vI/otJqmLyA7rCioLLDt00ejjHRZ/yqa6F3MCnfI=;
 b=MRHRvNGF6mkmgsQMuFbvGBb13vJgppMdp3mumG48Of5U3YvChL3bxU0l
 9j7rqMTxf8u6/Dzy2JhS7YXYsyxzPpF3/6rB7f/96ijxtYZvbu0o++1TY
 cR/TY0Dk30eDMrVYCQTcR0Wu2tzx5vm/abfXX2uUpU+NhoYWJoZV1usl+ 8=;
Authentication-Results: esa4.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=andrew.cooper3@citrix.com;
 spf=Pass smtp.mailfrom=Andrew.Cooper3@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa4.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 andrew.cooper3@citrix.com) identity=pra;
 client-ip=162.221.158.21; receiver=esa4.hc3370-68.iphmx.com;
 envelope-from="Andrew.Cooper3@citrix.com";
 x-sender="andrew.cooper3@citrix.com";
 x-conformance=sidf_compatible
Received-SPF: Pass (esa4.hc3370-68.iphmx.com: domain of
 Andrew.Cooper3@citrix.com designates 162.221.158.21 as
 permitted sender) identity=mailfrom;
 client-ip=162.221.158.21; receiver=esa4.hc3370-68.iphmx.com;
 envelope-from="Andrew.Cooper3@citrix.com";
 x-sender="Andrew.Cooper3@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83
 ip4:168.245.78.127 ~all"
Received-SPF: None (esa4.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa4.hc3370-68.iphmx.com;
 envelope-from="Andrew.Cooper3@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: T8aB5NzSWaUhgRXZotbC0J50HLLtbzCLOTtBisY27fKZRyy/vTO/Clc+mAstvNNw77gaHbLTvN
 DJ8BroynwEa0Ghfkorm9ko2BzPmbYc3Dgx5e/waYXaXLNF+KAPFrqTquoux4UKUiWy+HfWJjsE
 rhNDXbnsbAcpDU+uH4BRFvnGYz3Y+Ymu5XnCs2ZNjoSvVuMIhs6PmqfzcmneHtVJlekapGRhDq
 I5wAbwqNu7NqgTrHNYyVaJ0ubSxCsA1a/r729RwPPTxaG2SjDoxSLmOVai5kAeP6NeKyY+W69B
 WUQ=
X-SBRS: 2.7
X-MesageID: 15099729
X-Ironport-Server: esa4.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.72,296,1580792400"; d="scan'208";a="15099729"
From: Andrew Cooper <andrew.cooper3@citrix.com>
To: Xen-devel <xen-devel@lists.xenproject.org>
Date: Mon, 23 Mar 2020 10:17:24 +0000
Message-ID: <20200323101724.15655-8-andrew.cooper3@citrix.com>
X-Mailer: git-send-email 2.11.0
In-Reply-To: <20200323101724.15655-1-andrew.cooper3@citrix.com>
References: <20200323101724.15655-1-andrew.cooper3@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH 7/7] x86/ucode/intel: Fold structures together
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>, Wei Liu <wl@xen.org>,
 Jan Beulich <JBeulich@suse.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

Q3VycmVudGx5LCB3ZSBhbGxvY2F0ZSBhbiA4IGJ5dGUgc3RydWN0IG1pY3JvY29kZV9wYXRjaCB0
byBwb2ludCBhdCBhCnNlcGFyYXRlbHkgYWxsb2NhdGVkIHN0cnVjdCBtaWNyb2NvZGVfaW50ZWwu
ICBUaGlzIGlzIHdhc3RlZnVsLgoKRm9sZCBzdHJ1Y3QgbWljcm9jb2RlX2hlYWRlcl9pbnRlbCBh
bmQgbWljcm9jb2RlX2ludGVsIGludG8gbWljcm9jb2RlX3BhdGNoIHRvCnNpbXBsaWZ5IHRoZSBj
b2RlIGFuZCByZW1vdmUgYSBsZXZlbCBvZiBpbmRpcmVjdGlvbi4KClRoZSB0d28gc2VtYW50aWMg
Y2hhbmdlcyBhcmUgaW4gZnJlZV9wYXRjaCgpIGFuZCBjcHVfcmVxdWVzdF9taWNyb2NvZGUoKSB3
aGljaApkZWFsIHdpdGggdGhlIG1lbW9yeSBhbGxvY2F0aW9uIGFzcGVjdHMuICBFdmVyeXRoaW5n
IGVsc2UgaXMgbm8gZnVuY3Rpb25hbApjaGFuZ2UuCgpTaWduZWQtb2ZmLWJ5OiBBbmRyZXcgQ29v
cGVyIDxhbmRyZXcuY29vcGVyM0BjaXRyaXguY29tPgotLS0KQ0M6IEphbiBCZXVsaWNoIDxKQmV1
bGljaEBzdXNlLmNvbT4KQ0M6IFdlaSBMaXUgPHdsQHhlbi5vcmc+CkNDOiBSb2dlciBQYXUgTW9u
bsOpIDxyb2dlci5wYXVAY2l0cml4LmNvbT4KLS0tCiB4ZW4vYXJjaC94ODYvY3B1L21pY3JvY29k
ZS9pbnRlbC5jIHwgMTAzICsrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIDEg
ZmlsZSBjaGFuZ2VkLCAzNyBpbnNlcnRpb25zKCspLCA2NiBkZWxldGlvbnMoLSkKCmRpZmYgLS1n
aXQgYS94ZW4vYXJjaC94ODYvY3B1L21pY3JvY29kZS9pbnRlbC5jIGIveGVuL2FyY2gveDg2L2Nw
dS9taWNyb2NvZGUvaW50ZWwuYwppbmRleCAyY2NjZjljMjZkLi44ZjRlYmJkNzU5IDEwMDY0NAot
LS0gYS94ZW4vYXJjaC94ODYvY3B1L21pY3JvY29kZS9pbnRlbC5jCisrKyBiL3hlbi9hcmNoL3g4
Ni9jcHUvbWljcm9jb2RlL2ludGVsLmMKQEAgLTMyLDE3ICszMiwxMiBAQAogCiAjZGVmaW5lIHBy
X2RlYnVnKHguLi4pICgodm9pZCkwKQogCi1zdHJ1Y3QgbWljcm9jb2RlX2hlYWRlcl9pbnRlbCB7
CitzdHJ1Y3QgbWljcm9jb2RlX3BhdGNoIHsKICAgICB1bnNpZ25lZCBpbnQgaGRydmVyOwogICAg
IHVuc2lnbmVkIGludCByZXY7Ci0gICAgdW5pb24gewotICAgICAgICBzdHJ1Y3QgewotICAgICAg
ICAgICAgdWludDE2X3QgeWVhcjsKLSAgICAgICAgICAgIHVpbnQ4X3QgZGF5OwotICAgICAgICAg
ICAgdWludDhfdCBtb250aDsKLSAgICAgICAgfTsKLSAgICAgICAgdW5zaWduZWQgaW50IGRhdGU7
Ci0gICAgfTsKKyAgICB1aW50MTZfdCB5ZWFyOworICAgIHVpbnQ4X3QgIGRheTsKKyAgICB1aW50
OF90ICBtb250aDsKICAgICB1bnNpZ25lZCBpbnQgc2lnOwogICAgIHVuc2lnbmVkIGludCBja3N1
bTsKICAgICB1bnNpZ25lZCBpbnQgbGRydmVyOwpAQCAtNTcsMTAgKzUyLDcgQEAgc3RydWN0IG1p
Y3JvY29kZV9oZWFkZXJfaW50ZWwgewogICAgIHVuc2lnbmVkIGludCBfZGF0YXNpemU7CiAgICAg
dW5zaWduZWQgaW50IF90b3RhbHNpemU7CiAgICAgdW5zaWduZWQgaW50IHJlc2VydmVkWzNdOwot
fTsKIAotc3RydWN0IG1pY3JvY29kZV9pbnRlbCB7Ci0gICAgc3RydWN0IG1pY3JvY29kZV9oZWFk
ZXJfaW50ZWwgaGRyOwogICAgIHVpbnQ4X3QgZGF0YVtdOwogfTsKIApAQCAtNzYsMjEgKzY4LDE3
IEBAIHN0cnVjdCBleHRlbmRlZF9zaWd0YWJsZSB7CiAgICAgfSBzaWdzW107CiB9OwogCi1zdHJ1
Y3QgbWljcm9jb2RlX3BhdGNoIHsKLSAgICBzdHJ1Y3QgbWljcm9jb2RlX2ludGVsICptY19pbnRl
bDsKLX07Ci0KICNkZWZpbmUgUFBST19VQ09ERV9EQVRBU0laRSAgICAgMjAwMAotI2RlZmluZSBN
Q19IRUFERVJfU0laRSAgICAgICAgICAoc2l6ZW9mKHN0cnVjdCBtaWNyb2NvZGVfaGVhZGVyX2lu
dGVsKSkKKyNkZWZpbmUgTUNfSEVBREVSX1NJWkUgICAgICAgICAgb2Zmc2V0b2Yoc3RydWN0IG1p
Y3JvY29kZV9wYXRjaCwgZGF0YSkKIAotc3RhdGljIHVpbnQzMl90IGdldF9kYXRhc2l6ZShjb25z
dCBzdHJ1Y3QgbWljcm9jb2RlX2hlYWRlcl9pbnRlbCAqaGRyKQorc3RhdGljIHVpbnQzMl90IGdl
dF9kYXRhc2l6ZShjb25zdCBzdHJ1Y3QgbWljcm9jb2RlX3BhdGNoICptYykKIHsKLSAgICByZXR1
cm4gaGRyLT5fZGF0YXNpemUgPzogUFBST19VQ09ERV9EQVRBU0laRTsKKyAgICByZXR1cm4gbWMt
Pl9kYXRhc2l6ZSA/OiBQUFJPX1VDT0RFX0RBVEFTSVpFOwogfQogCi1zdGF0aWMgdWludDMyX3Qg
Z2V0X3RvdGFsc2l6ZShjb25zdCBzdHJ1Y3QgbWljcm9jb2RlX2hlYWRlcl9pbnRlbCAqaGRyKQor
c3RhdGljIHVpbnQzMl90IGdldF90b3RhbHNpemUoY29uc3Qgc3RydWN0IG1pY3JvY29kZV9wYXRj
aCAqbWMpCiB7Ci0gICAgcmV0dXJuIGhkci0+X3RvdGFsc2l6ZSA/OiBQUFJPX1VDT0RFX0RBVEFT
SVpFICsgTUNfSEVBREVSX1NJWkU7CisgICAgcmV0dXJuIG1jLT5fdG90YWxzaXplID86IFBQUk9f
VUNPREVfREFUQVNJWkUgKyBNQ19IRUFERVJfU0laRTsKIH0KIAogLyoKQEAgLTEwMCwxMCArODgs
MTAgQEAgc3RhdGljIHVpbnQzMl90IGdldF90b3RhbHNpemUoY29uc3Qgc3RydWN0IG1pY3JvY29k
ZV9oZWFkZXJfaW50ZWwgKmhkcikKICAqIGZpZWxkcywgYW5kIG5vIGV4dGVuZGVkIHNpZ25hdHVy
ZSB0YWJsZS4pCiAgKi8KIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZXh0ZW5kZWRfc2lndGFibGUgKmdl
dF9leHRfc2lndGFibGUoCi0gICAgY29uc3Qgc3RydWN0IG1pY3JvY29kZV9pbnRlbCAqbWMpCisg
ICAgY29uc3Qgc3RydWN0IG1pY3JvY29kZV9wYXRjaCAqbWMpCiB7Ci0gICAgaWYgKCBtYy0+aGRy
Ll90b3RhbHNpemUgPiAoTUNfSEVBREVSX1NJWkUgKyBtYy0+aGRyLl9kYXRhc2l6ZSkgKQotICAg
ICAgICByZXR1cm4gKHZvaWQgKikmbWMtPmRhdGFbbWMtPmhkci5fZGF0YXNpemVdOworICAgIGlm
ICggbWMtPl90b3RhbHNpemUgPiAoTUNfSEVBREVSX1NJWkUgKyBtYy0+X2RhdGFzaXplKSApCisg
ICAgICAgIHJldHVybiAodm9pZCAqKSZtYy0+ZGF0YVttYy0+X2RhdGFzaXplXTsKIAogICAgIHJl
dHVybiBOVUxMOwogfQpAQCAtMTU4LDExICsxNDYsMTEgQEAgc3RhdGljIGludCBjb2xsZWN0X2Nw
dV9pbmZvKHN0cnVjdCBjcHVfc2lnbmF0dXJlICpjc2lnKQogICogaGVhZGVyIGlzIG9mIGEga25v
d24gZm9ybWF0LCBhbmQgdG9nZXRoZXIgd2l0aCB0b3RhbHNpemUgYXJlIHdpdGhpbiB0aGUKICAq
IGJvdW5kcyBvZiB0aGUgY29udGFpbmVyLiAgRXZlcnl0aGluZyBlbHNlIGlzIHVuY2hlY2tlZC4K
ICAqLwotc3RhdGljIGludCBtaWNyb2NvZGVfc2FuaXR5X2NoZWNrKGNvbnN0IHN0cnVjdCBtaWNy
b2NvZGVfaW50ZWwgKm1jKQorc3RhdGljIGludCBtaWNyb2NvZGVfc2FuaXR5X2NoZWNrKGNvbnN0
IHN0cnVjdCBtaWNyb2NvZGVfcGF0Y2ggKm1jKQogewogICAgIGNvbnN0IHN0cnVjdCBleHRlbmRl
ZF9zaWd0YWJsZSAqZXh0OwotICAgIHVuc2lnbmVkIGludCB0b3RhbF9zaXplID0gZ2V0X3RvdGFs
c2l6ZSgmbWMtPmhkcik7Ci0gICAgdW5zaWduZWQgaW50IGRhdGFfc2l6ZSA9IGdldF9kYXRhc2l6
ZSgmbWMtPmhkcik7CisgICAgdW5zaWduZWQgaW50IHRvdGFsX3NpemUgPSBnZXRfdG90YWxzaXpl
KG1jKTsKKyAgICB1bnNpZ25lZCBpbnQgZGF0YV9zaXplID0gZ2V0X2RhdGFzaXplKG1jKTsKICAg
ICB1bnNpZ25lZCBpbnQgaSwgZXh0X3NpemU7CiAgICAgdWludDMyX3Qgc3VtLCAqcHRyOwogCkBA
IC0yMTEsNyArMTk5LDcgQEAgc3RhdGljIGludCBtaWNyb2NvZGVfc2FuaXR5X2NoZWNrKGNvbnN0
IHN0cnVjdCBtaWNyb2NvZGVfaW50ZWwgKm1jKQogICAgICAqIENoZWNrc3VtIGVhY2ggaW5kaXZp
dWRhbCBleHRlbmRlZCBzaWduYXR1cmUgYXMgaWYgaXQgaGFkIGJlZW4gaW4gdGhlCiAgICAgICog
bWFpbiBoZWFkZXIuCiAgICAgICovCi0gICAgc3VtID0gbWMtPmhkci5zaWcgKyBtYy0+aGRyLnBm
ICsgbWMtPmhkci5ja3N1bTsKKyAgICBzdW0gPSBtYy0+c2lnICsgbWMtPnBmICsgbWMtPmNrc3Vt
OwogICAgIGZvciAoIGkgPSAwOyBpIDwgZXh0LT5jb3VudDsgKytpICkKICAgICAgICAgaWYgKCBz
dW0gIT0gKGV4dC0+c2lnc1tpXS5zaWcgKyBleHQtPnNpZ3NbaV0ucGYgKyBleHQtPnNpZ3NbaV0u
Y2tzdW0pICkKICAgICAgICAgICAgIHJldHVybiAtRUlOVkFMOwpAQCAtMjIxLDcgKzIwOSw3IEBA
IHN0YXRpYyBpbnQgbWljcm9jb2RlX3Nhbml0eV9jaGVjayhjb25zdCBzdHJ1Y3QgbWljcm9jb2Rl
X2ludGVsICptYykKIAogLyogQ2hlY2sgYW4gdXBkYXRlIGFnYWluc3QgdGhlIENQVSBzaWduYXR1
cmUgYW5kIGN1cnJlbnQgdXBkYXRlIHJldmlzaW9uICovCiBzdGF0aWMgZW51bSBtaWNyb2NvZGVf
bWF0Y2hfcmVzdWx0IG1pY3JvY29kZV91cGRhdGVfbWF0Y2goCi0gICAgY29uc3Qgc3RydWN0IG1p
Y3JvY29kZV9pbnRlbCAqbWMpCisgICAgY29uc3Qgc3RydWN0IG1pY3JvY29kZV9wYXRjaCAqbWMp
CiB7CiAgICAgY29uc3Qgc3RydWN0IGV4dGVuZGVkX3NpZ3RhYmxlICpleHQ7CiAgICAgdW5zaWdu
ZWQgaW50IGk7CkBAIC0yMzAsNyArMjE4LDcgQEAgc3RhdGljIGVudW0gbWljcm9jb2RlX21hdGNo
X3Jlc3VsdCBtaWNyb2NvZGVfdXBkYXRlX21hdGNoKAogICAgIEFTU0VSVCghbWljcm9jb2RlX3Nh
bml0eV9jaGVjayhtYykpOwogCiAgICAgLyogQ2hlY2sgdGhlIG1haW4gbWljcm9jb2RlIHNpZ25h
dHVyZS4gKi8KLSAgICBpZiAoIHNpZ25hdHVyZV9tYWNoZXMoY3B1X3NpZywgbWMtPmhkci5zaWcs
IG1jLT5oZHIucGYpICkKKyAgICBpZiAoIHNpZ25hdHVyZV9tYWNoZXMoY3B1X3NpZywgbWMtPnNp
ZywgbWMtPnBmKSApCiAgICAgICAgIGdvdG8gZm91bmQ7CiAKICAgICAvKiBJZiB0aGVyZSBpcyBh
biBleHRlbmRlZCBzaWduYXR1cmUgdGFibGUsIGNoZWNrIGVhY2ggb2YgdGhlbS4gKi8KQEAgLTI0
Miw3ICsyMzAsNyBAQCBzdGF0aWMgZW51bSBtaWNyb2NvZGVfbWF0Y2hfcmVzdWx0IG1pY3JvY29k
ZV91cGRhdGVfbWF0Y2goCiAgICAgcmV0dXJuIE1JU19VQ09ERTsKIAogIGZvdW5kOgotICAgIHJl
dHVybiBtYy0+aGRyLnJldiA+IGNwdV9zaWctPnJldiA/IE5FV19VQ09ERSA6IE9MRF9VQ09ERTsK
KyAgICByZXR1cm4gbWMtPnJldiA+IGNwdV9zaWctPnJldiA/IE5FV19VQ09ERSA6IE9MRF9VQ09E
RTsKIH0KIAogc3RhdGljIGJvb2wgbWF0Y2hfY3B1KGNvbnN0IHN0cnVjdCBtaWNyb2NvZGVfcGF0
Y2ggKnBhdGNoKQpAQCAtMjUwLDE2ICsyMzgsMTIgQEAgc3RhdGljIGJvb2wgbWF0Y2hfY3B1KGNv
bnN0IHN0cnVjdCBtaWNyb2NvZGVfcGF0Y2ggKnBhdGNoKQogICAgIGlmICggIXBhdGNoICkKICAg
ICAgICAgcmV0dXJuIGZhbHNlOwogCi0gICAgcmV0dXJuIG1pY3JvY29kZV91cGRhdGVfbWF0Y2go
cGF0Y2gtPm1jX2ludGVsKSA9PSBORVdfVUNPREU7CisgICAgcmV0dXJuIG1pY3JvY29kZV91cGRh
dGVfbWF0Y2gocGF0Y2gpID09IE5FV19VQ09ERTsKIH0KIAogc3RhdGljIHZvaWQgZnJlZV9wYXRj
aChzdHJ1Y3QgbWljcm9jb2RlX3BhdGNoICpwYXRjaCkKIHsKLSAgICBpZiAoIHBhdGNoICkKLSAg
ICB7Ci0gICAgICAgIHhmcmVlKHBhdGNoLT5tY19pbnRlbCk7Ci0gICAgICAgIHhmcmVlKHBhdGNo
KTsKLSAgICB9CisgICAgeGZyZWUocGF0Y2gpOwogfQogCiBzdGF0aWMgZW51bSBtaWNyb2NvZGVf
bWF0Y2hfcmVzdWx0IGNvbXBhcmVfcGF0Y2goCkBAIC0yNjksMTEgKzI1MywxMCBAQCBzdGF0aWMg
ZW51bSBtaWNyb2NvZGVfbWF0Y2hfcmVzdWx0IGNvbXBhcmVfcGF0Y2goCiAgICAgICogQm90aCBw
YXRjaGVzIHRvIGNvbXBhcmUgYXJlIHN1cHBvc2VkIHRvIGJlIGFwcGxpY2FibGUgdG8gbG9jYWwg
Q1BVLgogICAgICAqIEp1c3QgY29tcGFyZSB0aGUgcmV2aXNpb24gbnVtYmVyLgogICAgICAqLwot
ICAgIEFTU0VSVChtaWNyb2NvZGVfdXBkYXRlX21hdGNoKG9sZC0+bWNfaW50ZWwpICE9IE1JU19V
Q09ERSk7Ci0gICAgQVNTRVJUKG1pY3JvY29kZV91cGRhdGVfbWF0Y2gobmV3LT5tY19pbnRlbCkg
IT0gTUlTX1VDT0RFKTsKKyAgICBBU1NFUlQobWljcm9jb2RlX3VwZGF0ZV9tYXRjaChvbGQpICE9
IE1JU19VQ09ERSk7CisgICAgQVNTRVJUKG1pY3JvY29kZV91cGRhdGVfbWF0Y2gobmV3KSAhPSBN
SVNfVUNPREUpOwogCi0gICAgcmV0dXJuIChuZXctPm1jX2ludGVsLT5oZHIucmV2ID4gb2xkLT5t
Y19pbnRlbC0+aGRyLnJldikgPyBORVdfVUNPREUKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IE9MRF9VQ09ERTsKKyAgICByZXR1
cm4gbmV3LT5yZXYgPiBvbGQtPnJldiA/IE5FV19VQ09ERSA6IE9MRF9VQ09ERTsKIH0KIAogc3Rh
dGljIGludCBhcHBseV9taWNyb2NvZGUoY29uc3Qgc3RydWN0IG1pY3JvY29kZV9wYXRjaCAqcGF0
Y2gpCkBAIC0yODEsNyArMjY0LDYgQEAgc3RhdGljIGludCBhcHBseV9taWNyb2NvZGUoY29uc3Qg
c3RydWN0IG1pY3JvY29kZV9wYXRjaCAqcGF0Y2gpCiAgICAgdWludDY0X3QgbXNyX2NvbnRlbnQ7
CiAgICAgdW5zaWduZWQgaW50IGNwdSA9IHNtcF9wcm9jZXNzb3JfaWQoKTsKICAgICBzdHJ1Y3Qg
Y3B1X3NpZ25hdHVyZSAqc2lnID0gJnRoaXNfY3B1KGNwdV9zaWcpOwotICAgIGNvbnN0IHN0cnVj
dCBtaWNyb2NvZGVfaW50ZWwgKm1jX2ludGVsOwogICAgIHVpbnQzMl90IHJldiwgb2xkX3JldiA9
IHNpZy0+cmV2OwogCiAgICAgaWYgKCAhcGF0Y2ggKQpAQCAtMjkwLDEyICsyNzIsMTAgQEAgc3Rh
dGljIGludCBhcHBseV9taWNyb2NvZGUoY29uc3Qgc3RydWN0IG1pY3JvY29kZV9wYXRjaCAqcGF0
Y2gpCiAgICAgaWYgKCAhbWF0Y2hfY3B1KHBhdGNoKSApCiAgICAgICAgIHJldHVybiAtRUlOVkFM
OwogCi0gICAgbWNfaW50ZWwgPSBwYXRjaC0+bWNfaW50ZWw7Ci0KICAgICBCVUdfT04obG9jYWxf
aXJxX2lzX2VuYWJsZWQoKSk7CiAKICAgICAvKiB3cml0ZSBtaWNyb2NvZGUgdmlhIE1TUiAweDc5
ICovCi0gICAgd3Jtc3JsKE1TUl9JQTMyX1VDT0RFX1dSSVRFLCAodW5zaWduZWQgbG9uZyltY19p
bnRlbC0+ZGF0YSk7CisgICAgd3Jtc3JsKE1TUl9JQTMyX1VDT0RFX1dSSVRFLCAodW5zaWduZWQg
bG9uZylwYXRjaC0+ZGF0YSk7CiAgICAgd3Jtc3JsKE1TUl9JQTMyX1VDT0RFX1JFViwgMHgwVUxM
KTsKIAogICAgIC8qIEFzIGRvY3VtZW50ZWQgaW4gdGhlIFNETTogRG8gYSBDUFVJRCAxIGhlcmUg
Ki8KQEAgLTMwNSwxOCArMjg1LDE3IEBAIHN0YXRpYyBpbnQgYXBwbHlfbWljcm9jb2RlKGNvbnN0
IHN0cnVjdCBtaWNyb2NvZGVfcGF0Y2ggKnBhdGNoKQogICAgIHJkbXNybChNU1JfSUEzMl9VQ09E
RV9SRVYsIG1zcl9jb250ZW50KTsKICAgICBzaWctPnJldiA9IHJldiA9IG1zcl9jb250ZW50ID4+
IDMyOwogCi0gICAgaWYgKCByZXYgIT0gbWNfaW50ZWwtPmhkci5yZXYgKQorICAgIGlmICggcmV2
ICE9IHBhdGNoLT5yZXYgKQogICAgIHsKICAgICAgICAgcHJpbnRrKFhFTkxPR19FUlIKICAgICAg
ICAgICAgICAgICJtaWNyb2NvZGU6IENQVSV1IHVwZGF0ZSByZXYgJSN4IHRvICUjeCBmYWlsZWQs
IHJlc3VsdCAlI3hcbiIsCi0gICAgICAgICAgICAgICBjcHUsIG9sZF9yZXYsIG1jX2ludGVsLT5o
ZHIucmV2LCByZXYpOworICAgICAgICAgICAgICAgY3B1LCBvbGRfcmV2LCBwYXRjaC0+cmV2LCBy
ZXYpOwogICAgICAgICByZXR1cm4gLUVJTzsKICAgICB9CiAKICAgICBwcmludGsoWEVOTE9HX1dB
Uk5JTkcKICAgICAgICAgICAgIm1pY3JvY29kZTogQ1BVJXUgdXBkYXRlZCBmcm9tIHJldmlzaW9u
ICUjeCB0byAlI3gsIGRhdGUgPSAlMDR4LSUwMngtJTAyeFxuIiwKLSAgICAgICAgICAgY3B1LCBv
bGRfcmV2LCByZXYsIG1jX2ludGVsLT5oZHIueWVhciwKLSAgICAgICAgICAgbWNfaW50ZWwtPmhk
ci5tb250aCwgbWNfaW50ZWwtPmhkci5kYXkpOworICAgICAgICAgICBjcHUsIG9sZF9yZXYsIHJl
diwgcGF0Y2gtPnllYXIsIHBhdGNoLT5tb250aCwgcGF0Y2gtPmRheSk7CiAKICAgICByZXR1cm4g
MDsKIH0KQEAgLTMyNSwxOSArMzA0LDE5IEBAIHN0YXRpYyBzdHJ1Y3QgbWljcm9jb2RlX3BhdGNo
ICpjcHVfcmVxdWVzdF9taWNyb2NvZGUoY29uc3Qgdm9pZCAqYnVmLAogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplX3Qgc2l6ZSkKIHsKICAg
ICBpbnQgZXJyb3IgPSAwOwotICAgIGNvbnN0IHN0cnVjdCBtaWNyb2NvZGVfaW50ZWwgKnNhdmVk
ID0gTlVMTDsKKyAgICBjb25zdCBzdHJ1Y3QgbWljcm9jb2RlX3BhdGNoICpzYXZlZCA9IE5VTEw7
CiAgICAgc3RydWN0IG1pY3JvY29kZV9wYXRjaCAqcGF0Y2ggPSBOVUxMOwogCiAgICAgd2hpbGUg
KCBzaXplICkKICAgICB7Ci0gICAgICAgIGNvbnN0IHN0cnVjdCBtaWNyb2NvZGVfaW50ZWwgKm1j
OworICAgICAgICBjb25zdCBzdHJ1Y3QgbWljcm9jb2RlX3BhdGNoICptYzsKICAgICAgICAgdW5z
aWduZWQgaW50IGJsb2Jfc2l6ZTsKIAogICAgICAgICBpZiAoIHNpemUgPCBNQ19IRUFERVJfU0la
RSB8fCAgICAgICAvKiBJbnN1ZmZpY2llbnQgc3BhY2UgZm9yIGhlYWRlcj8gKi8KLSAgICAgICAg
ICAgICAobWMgPSBidWYpLT5oZHIuaGRydmVyICE9IDEgfHwgLyogVW5yZWNvZ25pc2VkIGhlYWRl
ciB2ZXJzaW9uPyAgICovCi0gICAgICAgICAgICAgbWMtPmhkci5sZHJ2ZXIgIT0gMSB8fCAgICAg
ICAgIC8qIFVucmVjb2duaXNlZCBsb2FkZXIgdmVyc2lvbj8gICAqLworICAgICAgICAgICAgICht
YyA9IGJ1ZiktPmhkcnZlciAhPSAxIHx8ICAgICAvKiBVbnJlY29nbmlzZWQgaGVhZGVyIHZlcnNp
b24/ICAgKi8KKyAgICAgICAgICAgICBtYy0+bGRydmVyICE9IDEgfHwgICAgICAgICAgICAgLyog
VW5yZWNvZ25pc2VkIGxvYWRlciB2ZXJzaW9uPyAgICovCiAgICAgICAgICAgICAgc2l6ZSA8IChi
bG9iX3NpemUgPSAgICAgICAgICAgIC8qIEluc3VmZmljaWVudCBzcGFjZSBmb3IgcGF0Y2g/ICAq
LwotICAgICAgICAgICAgICAgICAgICAgZ2V0X3RvdGFsc2l6ZSgmbWMtPmhkcikpICkKKyAgICAg
ICAgICAgICAgICAgICAgIGdldF90b3RhbHNpemUobWMpKSApCiAgICAgICAgIHsKICAgICAgICAg
ICAgIGVycm9yID0gLUVJTlZBTDsKICAgICAgICAgICAgIGJyZWFrOwpAQCAtMzUyLDcgKzMzMSw3
IEBAIHN0YXRpYyBzdHJ1Y3QgbWljcm9jb2RlX3BhdGNoICpjcHVfcmVxdWVzdF9taWNyb2NvZGUo
Y29uc3Qgdm9pZCAqYnVmLAogICAgICAgICAgKiBvbmUgd2l0aCBoaWdoZXIgcmV2aXNpb24uCiAg
ICAgICAgICAqLwogICAgICAgICBpZiAoIChtaWNyb2NvZGVfdXBkYXRlX21hdGNoKG1jKSAhPSBN
SVNfVUNPREUpICYmCi0gICAgICAgICAgICAgKCFzYXZlZCB8fCAobWMtPmhkci5yZXYgPiBzYXZl
ZC0+aGRyLnJldikpICkKKyAgICAgICAgICAgICAoIXNhdmVkIHx8IChtYy0+cmV2ID4gc2F2ZWQt
PnJldikpICkKICAgICAgICAgICAgIHNhdmVkID0gbWM7CiAKICAgICAgICAgYnVmICArPSBibG9i
X3NpemU7CkBAIC0zNjEsMTcgKzM0MCw5IEBAIHN0YXRpYyBzdHJ1Y3QgbWljcm9jb2RlX3BhdGNo
ICpjcHVfcmVxdWVzdF9taWNyb2NvZGUoY29uc3Qgdm9pZCAqYnVmLAogCiAgICAgaWYgKCBzYXZl
ZCApCiAgICAgewotICAgICAgICBwYXRjaCA9IHhtYWxsb2Moc3RydWN0IG1pY3JvY29kZV9wYXRj
aCk7Ci0gICAgICAgIGlmICggcGF0Y2ggKQotICAgICAgICB7Ci0gICAgICAgICAgICBwYXRjaC0+
bWNfaW50ZWwgPSB4bWVtZHVwX2J5dGVzKHNhdmVkLCBnZXRfdG90YWxzaXplKCZzYXZlZC0+aGRy
KSk7Ci0gICAgICAgICAgICBpZiAoICFwYXRjaC0+bWNfaW50ZWwgKQotICAgICAgICAgICAgewot
ICAgICAgICAgICAgICAgIFhGUkVFKHBhdGNoKTsKLSAgICAgICAgICAgICAgICBlcnJvciA9IC1F
Tk9NRU07Ci0gICAgICAgICAgICB9Ci0gICAgICAgIH0KLSAgICAgICAgZWxzZQorICAgICAgICBw
YXRjaCA9IHhtZW1kdXBfYnl0ZXMoc2F2ZWQsIGdldF90b3RhbHNpemUoc2F2ZWQpKTsKKworICAg
ICAgICBpZiAoICFwYXRjaCApCiAgICAgICAgICAgICBlcnJvciA9IC1FTk9NRU07CiAgICAgfQog
Ci0tIAoyLjExLjAKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9y
ZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

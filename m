Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id BED43B2396
	for <lists+xen-devel@lfdr.de>; Fri, 13 Sep 2019 17:39:45 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i8ncn-0002GZ-Uc; Fri, 13 Sep 2019 15:36:41 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=QaHn=XI=gmail.com=olekstysh@srs-us1.protection.inumbo.net>)
 id 1i8ncm-0002GA-Jl
 for xen-devel@lists.xenproject.org; Fri, 13 Sep 2019 15:36:40 +0000
X-Inumbo-ID: 3448745c-d63c-11e9-b299-bc764e2007e4
Received: from mail-lj1-x242.google.com (unknown [2a00:1450:4864:20::242])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 3448745c-d63c-11e9-b299-bc764e2007e4;
 Fri, 13 Sep 2019 15:36:08 +0000 (UTC)
Received: by mail-lj1-x242.google.com with SMTP id r14so4472139ljn.3
 for <xen-devel@lists.xenproject.org>; Fri, 13 Sep 2019 08:36:08 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=y6jpry2SgM0hHmqkmSrwj0pTldySEpQovg4E6+MSTlc=;
 b=dkXdtXzlatnls8JboniREzeNUJ8+pLEi5kZeecbFgQtBrUE+Oevt7Dt3Hg1dBVH+Nc
 Rb2as2r39cOO8Hft3zoyzYzAZY7feQuV0QD7xEneqEJW6qyyBowDiooG0uWmGmrorFCU
 UToNHqHWKm4Mub9bCc760Rrak3g0fEdPsdixPmEe7sP3caqjh/HpE/5364syfpVxthb2
 xvgOHgBmpVFlp8Pqi1uc663A+kyk1bhI478e17mHi+SJFIWE/+XRXYqrEhgCPv36mYz7
 Ue6c3awPH0b5XW9op5pqDvBRuzoizAKekkx/6CDHxjncissiDyyDA3Qgz306iPOR42LN
 uAww==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=y6jpry2SgM0hHmqkmSrwj0pTldySEpQovg4E6+MSTlc=;
 b=rUeFe1l7348PLe8EuixFLuGND+1n4tmx/BphQpeIA0bZIhS3lnwiY83x5a8Wjnv3GY
 UEZPMwUfBcP3sbQQoDq18G3ipZd8mRfzCK2Uq7b+2pHasPsMJBWYe7ko+JHn1ZEJcqvc
 DQnaoQ7V3TK0540WWmXGwMaEdHPrvzSajgAYhByQCMyWUGklTXVseZaT+myuGZEZhQOQ
 FWtMTVnM+JtowgjgPxhOGPLZq33qH2w6cm527dczLhO3uGku9+Qz/KVYjvgWBeH3t318
 dnUHPCCJzymrOYKPDyYPYdEqksET1SUCEV+M714B0LAy/h47iqKN26U4hM4RAeVPEB40
 AmtA==
X-Gm-Message-State: APjAAAV1vYbrGs8OgKlJ6ymt4r3xYps6Hw2ooP4uEDNo5Ma8QnQE3QXQ
 VAAayxUGRhJYJmcBUDXJ5ivZ9aT+q5s=
X-Google-Smtp-Source: APXvYqzAba6T+20iy2I2FrzoR5kflXkXeKfBPIZadkUwjQ/v0y5Avg1Kj7t4YsDKPd2S4HRruusalQ==
X-Received: by 2002:a2e:3c14:: with SMTP id j20mr1616125lja.84.1568388966412; 
 Fri, 13 Sep 2019 08:36:06 -0700 (PDT)
Received: from otyshchenko.kyiv.epam.com (ll-74.141.223.85.sovam.net.ua.
 [85.223.141.74])
 by smtp.gmail.com with ESMTPSA id c16sm6969765lfj.8.2019.09.13.08.36.05
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-SHA bits=128/128);
 Fri, 13 Sep 2019 08:36:05 -0700 (PDT)
From: Oleksandr Tyshchenko <olekstysh@gmail.com>
To: xen-devel@lists.xenproject.org
Date: Fri, 13 Sep 2019 18:35:17 +0300
Message-Id: <1568388917-7287-9-git-send-email-olekstysh@gmail.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1568388917-7287-1-git-send-email-olekstysh@gmail.com>
References: <1568388917-7287-1-git-send-email-olekstysh@gmail.com>
Subject: [Xen-devel] [PATCH V4 8/8] iommu/arm: Add Renesas IPMMU-VMSA support
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Oleksandr Tyshchenko <oleksandr_tyshchenko@epam.com>, julien.grall@arm.com,
 sstabellini@kernel.org, Volodymyr_Babchuk@epam.com,
 Yoshihiro Shimoda <yoshihiro.shimoda.uh@renesas.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

RnJvbTogT2xla3NhbmRyIFR5c2hjaGVua28gPG9sZWtzYW5kcl90eXNoY2hlbmtvQGVwYW0uY29t
PgoKVGhlIElQTU1VLVZNU0EgaXMgVk1TQS1jb21wYXRpYmxlIEkvTyBNZW1vcnkgTWFuYWdlbWVu
dCBVbml0IChJT01NVSkKd2hpY2ggcHJvdmlkZXMgYWRkcmVzcyB0cmFuc2xhdGlvbiBhbmQgYWNj
ZXNzIHByb3RlY3Rpb24gZnVuY3Rpb25hbGl0aWVzCnRvIHByb2Nlc3NpbmcgdW5pdHMgYW5kIGlu
dGVyY29ubmVjdCBuZXR3b3Jrcy4KClBsZWFzZSBub3RlLCBjdXJyZW50IGRyaXZlciBpcyBzdXBw
b3NlZCB0byB3b3JrIG9ubHkgd2l0aCBuZXdlc3QKUi1DYXIgR2VuMyBTb0NzIHJldmlzaW9ucyB3
aGljaCBJUE1NVSBoYXJkd2FyZSBzdXBwb3J0cyBzdGFnZSAyIHRyYW5zbGF0aW9uCnRhYmxlIGZv
cm1hdCBhbmQgaXMgYWJsZSB0byB1c2UgQ1BVJ3MgUDJNIHRhYmxlIGFzIGlzIGlmIG9uZSBpcwoz
LWxldmVsIHBhZ2UgdGFibGUgKHVwIHRvIDQwIGJpdCBJUEEpLgoKVGhlIG1ham9yIGRpZmZlcmVu
Y2VzIGNvbXBhcmUgdG8gdGhlIExpbnV4IGRyaXZlciBhcmU6CgoxLiBTdGFnZSAxL1N0YWdlIDIg
dHJhbnNsYXRpb24uIExpbnV4IGRyaXZlciBzdXBwb3J0cyBTdGFnZSAxCnRyYW5zbGF0aW9uIG9u
bHkgKHdpdGggU3RhZ2UgMSB0cmFuc2xhdGlvbiB0YWJsZSBmb3JtYXQpLiBJdCBtYW5hZ2VzCnBh
Z2UgdGFibGUgYnkgaXRzZWxmLiBCdXQgWGVuIGRyaXZlciBzdXBwb3J0cyBTdGFnZSAyIHRyYW5z
bGF0aW9uCih3aXRoIFN0YWdlIDIgdHJhbnNsYXRpb24gdGFibGUgZm9ybWF0KSB0byBiZSBhYmxl
IHRvIHNoYXJlIHRoZSBQMk0Kd2l0aCB0aGUgQ1BVLiBTdGFnZSAxIHRyYW5zbGF0aW9uIGlzIGFs
d2F5cyBieXBhc3NlZCBpbiBYZW4gZHJpdmVyLgoKU28sIFhlbiBkcml2ZXIgaXMgc3VwcG9zZWQg
dG8gYmUgdXNlZCB3aXRoIG5ld2VzdCBSLUNhciBHZW4zIFNvQyByZXZpc2lvbnMKb25seSAoSDMg
RVMzLjAsIE0zLVcrLCBldGMuKSB3aGljaCBJUE1NVSBIL1cgc3VwcG9ydHMgc3RhZ2UgMiB0cmFu
c2xhdGlvbgp0YWJsZSBmb3JtYXQuCgoyLiBBQXJjaDY0IHN1cHBvcnQuIExpbnV4IGRyaXZlciB1
c2VzIFZNU0F2OC0zMiBtb2RlLCB3aGlsZSBYZW4gZHJpdmVyCmVuYWJsZXMgQXJtdjggVk1TQXY4
LTY0IG1vZGUgdG8gY292ZXIgdXAgdG8gNDAgYml0IGlucHV0IGFkZHJlc3MuCgozLiBDb250ZXh0
IGJhbmsgKHNldHMgb2YgcGFnZSB0YWJsZSkgdXNhZ2UuIEluIFhlbiwgZWFjaCBjb250ZXh0IGJh
bmsgaXMKbWFwcGVkIHRvIG9uZSBYZW4gZG9tYWluLiBTbywgYWxsIGRldmljZXMgYmVpbmcgcGFz
cyB0aHJvdWdoZWQgdG8gdGhlCnNhbWUgWGVuIGRvbWFpbiBzaGFyZSB0aGUgc2FtZSBjb250ZXh0
IGJhbmsuCgo0LiBJUE1NVSBkZXZpY2UgdHJhY2tpbmcuIEluIFhlbiwgYWxsIElPTU1VIGRldmlj
ZXMgYXJlIG1hbmFnZWQKYnkgc2luZ2xlIGRyaXZlciBpbnN0YW5jZS4gU28sIGRyaXZlciB1c2Vz
IGdsb2JhbCBsaXN0IHRvIGtlZXAgdHJhY2sKb2YgcmVnaXN0ZXJlZCBJUE1NVSBkZXZpY2VzLgoK
U2lnbmVkLW9mZi1ieTogT2xla3NhbmRyIFR5c2hjaGVua28gPG9sZWtzYW5kcl90eXNoY2hlbmtv
QGVwYW0uY29tPgpDQzogSnVsaWVuIEdyYWxsIDxqdWxpZW4uZ3JhbGxAYXJtLmNvbT4KQ0M6IFlv
c2hpaGlybyBTaGltb2RhIDx5b3NoaWhpcm8uc2hpbW9kYS51aEByZW5lc2FzLmNvbT4KCi0tLQpD
aGFuZ2VzIFYzIC0+IFY0OgogICAgLSBjaGFuZ2VkICJHZW4zIiB0byAiUi1DYXIgR2VuMyIgaW4g
Y29tbWl0IGRlc2NyaXB0aW9uCiAgICAtIHJlbmFtZWQgIm9mX3hsYXRlIiB0byAiZHRfeGxhdGUi
CiAgICAtIHJlbW92ZWQgY2hlY2sgZm9yIHRoZSBpb21tdV9oYXBfcHRfc2hhcmUgZmxhZyBpbiBp
cG1tdV9pbml0KCkKICAgIC0gbW9kaWZpZWQgdG8gYmUgYWJsZSB0byBzZWxlY3QgSVBNTVVfVk1T
QSBvcHRpb24gb25seSBpZiBFWFBFUlQgaXMgc2V0CiAgICAtIHJlbW92ZWQgYW4gZXJyb3IgbWVz
c2FnZSB3aGVuIGRlZmVycmluZyB0aGUgcHJvYmUKICAgIC0gbW92ZWQgY2hlY2sgZm9yIHRoZSBQ
Mk0gc2hhcmluZyBwb3NzaWJpbGl0eSB0byB0aGUgUm9vdCBJUE1NVSBwYXRoCgpDaGFuZ2VzIFYy
IC0+IFYzOgogICAgLSBhZGRlZCBDb3B5cmlnaHQgZnJvbSBMaW51eAogICAgLSBpbmNsdWRlZCA8
eGVuL2lvbW11Lmg+IGFuZCA8YXNtL2lvbW11X2Z3c3BlYy5oPiBkaXJlY3RseQogICAgLSByZW1v
dmVkIHBvaW50bGVzcyBzcGluX2xvY2sgZnJvbSBpcG1tdV9pb21tdV9kb21haW5fdGVhcmRvd24o
KQogICAgLSBjaGFuZ2VkICJHZW4zIiB0byAiUi1DYXIgR2VuMyIsICJNMyBFUzMuMCIgdG8gIk0z
LVcrIgogICAgLSBjaGFuZ2VkIFJDQVJfUFJPRFVDVF9NMyB0byBSQ0FSX1BST0RVQ1RfTTNXCiAg
ICAtIGNsYXJpZmllZCBJTVRUQkNSX1RTWjFfTUFTSwogICAgLSByZW1vdmVkIFRMQiBmbHVzaCBm
cm9tIGlwbW11X2RvbWFpbl9pcnEoKSB1bnRpbCBjbGFyaWZpZWQgdGhlIHB1cnBvc2UKICAgIC0g
cmV0dXJuZWQgLUVOT0RFViBpbiBpcG1tdV9pbml0KCkgaWYgUDJNIHNoYXJpbmcgb3IgUDJNIElQ
QSBzaXplCiAgICAgIGlzIG5vdCBzdXBwb3J0ZWQgdG8gc2hvdyB0aGF0IElPTU1VIGRldmljZSBp
cyBub3QgdXNhYmxlIGluIFhlbgogICAgLSBpbXBsZW1lbnRlZCBuZXcgY2FsbGJhY2sgIm9mX3hs
YXRlIiB0byBwYXJzZSBEVCBJT01NVSBzcGVjaWZpZXIKICAgICAgYW5kIGFkZCBkZXZpY2UgSURz
IHRvICJpb21tdV9md3NwZWMiCiAgICAtIHJld29ya2VkICJhZGRfZGV2aWNlIiBjYWxsYmFjawog
ICAgLSB1cGRhdGVkIHBhdGNoIGRlc2NyaXB0aW9uCgpDaGFuZ2VzIFYxIC0+IFYyOgogICAgLSBy
ZXdyaXRlZCBkcml2ZXIgdG8gdXNlIGlvbW11X2Z3c3BlYwogICAgLSByZW1vdmVkIERUIHBhcnNp
bmcgY29kZSBmb3IgbWljcm8tVExCcwogICAgLSByZW1vdmVkIHN0cnVjdCBpcG1tdV92bXNhX21h
c3Rlcl9jZmcsIGRldl9hcmNoZGF0YSBtYWNybwogICAgLSBhZGRlZCBpcG1tdV9maW5kX21tdV9i
eV9kZXYoKSwgdmFyaW91cyBoZWxwZXJzIHRvIGFjY2VzcwogICAgICBmd3NwZWMtPmlvbW11X3By
aXYKICAgIC0gaW1wbGVtZW50ZWQgbmV3IGNhbGxiYWNrICJhZGRfZGV2aWNlIiB0byBhZGQgbWFz
dGVyIGRldmljZSB0byBJUE1NVQogICAgLSByZW1vdmVkIGlwbW11X3Byb3RlY3RfbWFzdGVycygp
CiAgICAtIHJlbW92ZWQgY29kZSB0byBsb2NhdGUgUm9vdCBkZXZpY2UgaW4gdGhlIGZpcnN0IHBs
YWNlLAogICAgICB1c2VkIEVBR0FJTiB0byByZXF1ZXN0IGRlZmVycmVkIHByb2JpbmcKICAgIC0g
dXNlZCBwcmludGtfb25jZSBmb3IgdGhlIHN5c3RlbSB3aWRlIGVycm9yIG1lc3NhZ2VzIGluIGlw
bW11X2luaXQoKQogICAgICB3aGljaCBkb24ndCBuZWVkIHRvIGJlIHNob3duIGZvciBldmVyeSBk
ZXZpY2UgYmVpbmcgcHJvYmVkCiAgICAtIHJlbW92ZWQgbWFwX3BhZ2UvdW5tYXBfcGFnZSBpbXBs
ZW1lbnRhdGlvbiwgcmV1c2VkIHRoZW0KICAgICAgZnJvbSBpb21tdV9oZWxwZXJzLmMKICAgIC0g
dXNlZCAlcGQgZm9yIHByaW50aW5nIGRvbWFpZCBpZAogICAgLSBwZXJmb3JtZWQgdmFyaW91cyBj
b3NtZXRpYyBmaXhlcwogICAgLSBjaGFuZ2VkIHUzMiAtPiB1aW50MzJfdCwgdTY0IC0+IHVpbnQ2
NF90LAogICAgICB1bnNpZ25lZCBpbnQgLT4gdWludDMyX3Qgd2hlcmUgbmVlZGVkCiAgICAtIGNs
YXJpZmllZCBUT0RPcwogICAgLSBjbGFmaXJpZWQgc3VwcG9ydGVkIFNvQyB2ZXJzaW9ucyBpbiBj
b25maWcgSVBNTVVfVk1TQSwKICAgICAgc2V0IGRlZmF1bHQgdG8gIm4iCiAgICAtIHVwZGF0ZWQg
Y29tbWVudHMgaW4gY29kZSwgcHJvdmlkZWQgbW9yZSBhY2N1cmF0ZSBkZXNjcmlwdGlvbiwKICAg
ICAgYWRkZWQgbmV3IGNvbW1lbnRzIHdoZXJlIG5lZWRlZAogICAgLSB1cGRhdGVkIHBhdGNoIGRl
c2NyaXB0aW9uIGJ5IHByb3ZpZGluZyBkaWZmZXJlbmNlcyBiZXR3ZWVuCiAgICAgIExpbnV4L1hl
biBpbXBsZW1lbnRhdGlvbnMKICAgIC0gcmVtb3ZlZCBmaWVsZHMgZm9yIGNhY2hlIHNub29wIHRy
YW5zYWN0aW9uIHdoZW4gY29uZmlndXJpbmcgSU1UVEJDUgogICAgICAodXBkYXRlIGZyb20gUmVu
ZXNhcyBCU1ApCi0tLQogeGVuL2FyY2gvYXJtL3BsYXRmb3Jtcy9LY29uZmlnICAgICAgICAgICB8
ICAgIDEgKwogeGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvS2NvbmZpZyAgICAgICAgICB8ICAgMTMg
KwogeGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYXJtL01ha2VmaWxlICAgICB8ICAgIDEgKwogeGVu
L2RyaXZlcnMvcGFzc3Rocm91Z2gvYXJtL2lwbW11LXZtc2EuYyB8IDEzMzIgKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrCiA0IGZpbGVzIGNoYW5nZWQsIDEzNDcgaW5zZXJ0aW9ucygrKQog
Y3JlYXRlIG1vZGUgMTAwNjQ0IHhlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FybS9pcG1tdS12bXNh
LmMKCmRpZmYgLS1naXQgYS94ZW4vYXJjaC9hcm0vcGxhdGZvcm1zL0tjb25maWcgYi94ZW4vYXJj
aC9hcm0vcGxhdGZvcm1zL0tjb25maWcKaW5kZXggYmMwZTljZC4uNGJiNzMxOSAxMDA2NDQKLS0t
IGEveGVuL2FyY2gvYXJtL3BsYXRmb3Jtcy9LY29uZmlnCisrKyBiL3hlbi9hcmNoL2FybS9wbGF0
Zm9ybXMvS2NvbmZpZwpAQCAtMjUsNiArMjUsNyBAQCBjb25maWcgUkNBUjMKIAlib29sICJSZW5l
c2FzIFJDYXIzIHN1cHBvcnQiCiAJZGVwZW5kcyBvbiBBUk1fNjQKIAlzZWxlY3QgSEFTX1NDSUYK
KwlzZWxlY3QgSVBNTVVfVk1TQSBpZiBFWFBFUlQKIAktLS1oZWxwLS0tCiAJRW5hYmxlIGFsbCB0
aGUgcmVxdWlyZWQgZHJpdmVycyBmb3IgUmVuZXNhcyBSQ2FyMwogCmRpZmYgLS1naXQgYS94ZW4v
ZHJpdmVycy9wYXNzdGhyb3VnaC9LY29uZmlnIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvS2Nv
bmZpZwppbmRleCBhM2MwNjQ5Li5lMjIzMDFjIDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy9wYXNz
dGhyb3VnaC9LY29uZmlnCisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL0tjb25maWcKQEAg
LTEyLDQgKzEyLDE3IEBAIGNvbmZpZyBBUk1fU01NVQogCiAJICBTYXkgWSBoZXJlIGlmIHlvdXIg
U29DIGluY2x1ZGVzIGFuIElPTU1VIGRldmljZSBpbXBsZW1lbnRpbmcgdGhlCiAJICBBUk0gU01N
VSBhcmNoaXRlY3R1cmUuCisKK2NvbmZpZyBJUE1NVV9WTVNBCisJYm9vbCAiUmVuZXNhcyBJUE1N
VS1WTVNBIGZvdW5kIGluIFItQ2FyIEdlbjMgU29DcyIgaWYgRVhQRVJUID0gInkiCisJZGVmYXVs
dCBuCisJZGVwZW5kcyBvbiBBUk1fNjQKKwktLS1oZWxwLS0tCisJICBTdXBwb3J0IGZvciBpbXBs
ZW1lbnRhdGlvbnMgb2YgdGhlIFJlbmVzYXMgSVBNTVUtVk1TQSBmb3VuZAorCSAgaW4gUi1DYXIg
R2VuMyBTb0NzLgorCisJICBTYXkgWSBoZXJlIGlmIHlvdSBhcmUgdXNpbmcgbmV3ZXN0IFItQ2Fy
IEdlbjMgU29DcyByZXZpc2lvbnMKKwkgIChIMyBFUzMuMCwgTTMtVyssIGV0Yykgd2hpY2ggSVBN
TVUgaGFyZHdhcmUgc3VwcG9ydHMgc3RhZ2UgMgorCSAgdHJhbnNsYXRpb24gdGFibGUgZm9ybWF0
IGFuZCBpcyBhYmxlIHRvIHVzZSBDUFUncyBQMk0gdGFibGUgYXMgaXMuCisKIGVuZGlmCmRpZmYg
LS1naXQgYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hcm0vTWFrZWZpbGUgYi94ZW4vZHJpdmVy
cy9wYXNzdGhyb3VnaC9hcm0vTWFrZWZpbGUKaW5kZXggNWZiYWQ0NS4uZmNkOTE4ZSAxMDA2NDQK
LS0tIGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYXJtL01ha2VmaWxlCisrKyBiL3hlbi9kcml2
ZXJzL3Bhc3N0aHJvdWdoL2FybS9NYWtlZmlsZQpAQCAtMSwyICsxLDMgQEAKIG9iai15ICs9IGlv
bW11Lm8gaW9tbXVfaGVscGVycy5vIGlvbW11X2Z3c3BlYy5vCiBvYmotJChDT05GSUdfQVJNX1NN
TVUpICs9IHNtbXUubworb2JqLSQoQ09ORklHX0lQTU1VX1ZNU0EpICs9IGlwbW11LXZtc2Eubwpk
aWZmIC0tZ2l0IGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYXJtL2lwbW11LXZtc2EuYyBiL3hl
bi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FybS9pcG1tdS12bXNhLmMKbmV3IGZpbGUgbW9kZSAxMDA2
NDQKaW5kZXggMDAwMDAwMC4uZWEyOWU5MQotLS0gL2Rldi9udWxsCisrKyBiL3hlbi9kcml2ZXJz
L3Bhc3N0aHJvdWdoL2FybS9pcG1tdS12bXNhLmMKQEAgLTAsMCArMSwxMzMyIEBACisvKgorICog
eGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYXJtL2lwbW11LXZtc2EuYworICoKKyAqIERyaXZlciBm
b3IgdGhlIFJlbmVzYXMgSVBNTVUtVk1TQSBmb3VuZCBpbiBSLUNhciBHZW4zIFNvQ3MuCisgKgor
ICogVGhlIElQTU1VLVZNU0EgaXMgVk1TQS1jb21wYXRpYmxlIEkvTyBNZW1vcnkgTWFuYWdlbWVu
dCBVbml0IChJT01NVSkKKyAqIHdoaWNoIHByb3ZpZGVzIGFkZHJlc3MgdHJhbnNsYXRpb24gYW5k
IGFjY2VzcyBwcm90ZWN0aW9uIGZ1bmN0aW9uYWxpdGllcworICogdG8gcHJvY2Vzc2luZyB1bml0
cyBhbmQgaW50ZXJjb25uZWN0IG5ldHdvcmtzLgorICoKKyAqIFBsZWFzZSBub3RlLCBjdXJyZW50
IGRyaXZlciBpcyBzdXBwb3NlZCB0byB3b3JrIG9ubHkgd2l0aCBuZXdlc3QKKyAqIFItQ2FyIEdl
bjMgU29DcyByZXZpc2lvbnMgd2hpY2ggSVBNTVUgaGFyZHdhcmUgc3VwcG9ydHMgc3RhZ2UgMiB0
cmFuc2xhdGlvbgorICogdGFibGUgZm9ybWF0IGFuZCBpcyBhYmxlIHRvIHVzZSBDUFUncyBQMk0g
dGFibGUgYXMgaXMuCisgKgorICogQmFzZWQgb24gTGludXgncyBJUE1NVS1WTVNBIGRyaXZlciBm
cm9tIFJlbmVzYXMgQlNQOgorICogICAgZHJpdmVycy9pb21tdS9pcG1tdS12bXNhLmMKKyAqIHlv
dSBjYW4gZm91bmQgYXQ6CisgKiAgICB1cmw6IGdpdDovL2dpdC5rZXJuZWwub3JnL3B1Yi9zY20v
bGludXgva2VybmVsL2dpdC9ob3Jtcy9yZW5lc2FzLWJzcC5naXQKKyAqICAgIGJyYW5jaDogdjQu
MTQuNzUtbHRzaS9yY2FyLTMuOS42CisgKiAgICBjb21taXQ6IGUyMDZlYjViODFhNjBlNjRjMzVm
YmMzYTk5OWIxYTBkYjJiOTgwNDQKKyAqIGFuZCBYZW4ncyBTTU1VIGRyaXZlcjoKKyAqICAgIHhl
bi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FybS9zbW11LmMKKyAqCisgKiBDb3B5cmlnaHQgKEMpIDIw
MTQtMjAxOSBSZW5lc2FzIEVsZWN0cm9uaWNzIENvcnBvcmF0aW9uCisgKgorICogQ29weXJpZ2h0
IChDKSAyMDE2LTIwMTkgRVBBTSBTeXN0ZW1zIEluYy4KKyAqCisgKiBUaGlzIHByb2dyYW0gaXMg
ZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yCisgKiBtb2RpZnkg
aXQgdW5kZXIgdGhlIHRlcm1zIGFuZCBjb25kaXRpb25zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJs
aWMKKyAqIExpY2Vuc2UsIHZlcnNpb24gMiwgYXMgcHVibGlzaGVkIGJ5IHRoZSBGcmVlIFNvZnR3
YXJlIEZvdW5kYXRpb24uCisgKgorICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRo
ZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCisgKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFO
VFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgorICogTUVSQ0hBTlRBQklM
SVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZSBHTlUKKyAq
IEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KKyAqCisgKiBZb3Ugc2hv
dWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMKKyAqIExp
Y2Vuc2UgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW07IElmIG5vdCwgc2VlIDxodHRwOi8vd3d3Lmdu
dS5vcmcvbGljZW5zZXMvPi4KKyAqLworCisjaW5jbHVkZSA8eGVuL2RlbGF5Lmg+CisjaW5jbHVk
ZSA8eGVuL2Vyci5oPgorI2luY2x1ZGUgPHhlbi9pb21tdS5oPgorI2luY2x1ZGUgPHhlbi9pcnEu
aD4KKyNpbmNsdWRlIDx4ZW4vbGliLmg+CisjaW5jbHVkZSA8eGVuL2xpc3QuaD4KKyNpbmNsdWRl
IDx4ZW4vbW0uaD4KKyNpbmNsdWRlIDx4ZW4vc2NoZWQuaD4KKyNpbmNsdWRlIDx4ZW4vdm1hcC5o
PgorCisjaW5jbHVkZSA8YXNtL2F0b21pYy5oPgorI2luY2x1ZGUgPGFzbS9kZXZpY2UuaD4KKyNp
bmNsdWRlIDxhc20vaW8uaD4KKyNpbmNsdWRlIDxhc20vaW9tbXVfZndzcGVjLmg+CisKKyNkZWZp
bmUgZGV2X25hbWUoZGV2KSBkdF9ub2RlX2Z1bGxfbmFtZShkZXZfdG9fZHQoZGV2KSkKKworLyog
RGV2aWNlIGxvZ2dlciBmdW5jdGlvbnMgKi8KKyNkZWZpbmUgZGV2X3ByaW50KGRldiwgbHZsLCBm
bXQsIC4uLikgICAgXAorICAgIHByaW50ayhsdmwgImlwbW11OiAlczogIiBmbXQsIGRldl9uYW1l
KGRldiksICMjIF9fVkFfQVJHU19fKQorCisjZGVmaW5lIGRldl9pbmZvKGRldiwgZm10LCAuLi4p
ICAgIFwKKyAgICBkZXZfcHJpbnQoZGV2LCBYRU5MT0dfSU5GTywgZm10LCAjIyBfX1ZBX0FSR1Nf
XykKKyNkZWZpbmUgZGV2X3dhcm4oZGV2LCBmbXQsIC4uLikgICAgXAorICAgIGRldl9wcmludChk
ZXYsIFhFTkxPR19XQVJOSU5HLCBmbXQsICMjIF9fVkFfQVJHU19fKQorI2RlZmluZSBkZXZfZXJy
KGRldiwgZm10LCAuLi4pICAgICBcCisgICAgZGV2X3ByaW50KGRldiwgWEVOTE9HX0VSUiwgZm10
LCAjIyBfX1ZBX0FSR1NfXykKKyNkZWZpbmUgZGV2X2Vycl9yYXRlbGltaXRlZChkZXYsIGZtdCwg
Li4uKSAgICBcCisgICAgZGV2X3ByaW50KGRldiwgWEVOTE9HX0VSUiwgZm10LCAjIyBfX1ZBX0FS
R1NfXykKKworLyoKKyAqIFItQ2FyIEdlbjMgU29DcyBtYWtlIHVzZSBvZiB1cCB0byA4IElQTU1V
IGNvbnRleHRzIChzZXRzIG9mIHBhZ2UgdGFibGUpIGFuZAorICogdGhlc2UgY2FuIGJlIG1hbmFn
ZWQgaW5kZXBlbmRlbnRseS4gRWFjaCBjb250ZXh0IGlzIG1hcHBlZCB0byBvbmUgWGVuIGRvbWFp
bi4KKyAqLworI2RlZmluZSBJUE1NVV9DVFhfTUFYICAgICA4CisvKiBSLUNhciBHZW4zIFNvQ3Mg
bWFrZSB1c2Ugb2YgdXAgdG8gNDggbWljcm8tVExCcyBwZXIgSVBNTVUgZGV2aWNlLiAqLworI2Rl
ZmluZSBJUE1NVV9VVExCX01BWCAgICA0OAorCisvKiBJUE1NVSBjb250ZXh0IHN1cHBvcnRzIElQ
QSBzaXplIHVwIHRvIDQwIGJpdC4gKi8KKyNkZWZpbmUgSVBNTVVfTUFYX1AyTV9JUEFfQklUUyAg
ICA0MAorCisvKgorICogWGVuJ3MgZG9tYWluIElQTU1VIGluZm9ybWF0aW9uIHN0b3JlZCBpbiBk
b21faW9tbXUoZCktPmFyY2gucHJpdgorICoKKyAqIEFzIGVhY2ggY29udGV4dCAoc2V0IG9mIHBh
Z2UgdGFibGUpIGlzIG1hcHBlZCB0byBvbmUgWGVuIGRvbWFpbiwKKyAqIGFsbCBhc3NvY2lhdGVk
IElQTU1VIGRvbWFpbnMgdXNlIHRoZSBzYW1lIGNvbnRleHQgbWFwcGVkIHRvIHRoaXMgWGVuIGRv
bWFpbi4KKyAqIFRoaXMgbWFrZXMgYWxsIG1hc3RlciBkZXZpY2VzIGJlaW5nIGF0dGFjaGVkIHRv
IHRoZSBzYW1lIFhlbiBkb21haW4gc2hhcmUKKyAqIHRoZSBzYW1lIGNvbnRleHQgKFAyTSB0YWJs
ZSkuCisgKi8KK3N0cnVjdCBpcG1tdV92bXNhX3hlbl9kb21haW4geworICAgIC8qCisgICAgICog
VXNlZCB0byBwcm90ZWN0IGV2ZXJ5dGhpbmcgd2hpY2ggYmVsb25ncyB0byB0aGlzIFhlbiBkb21h
aW46CisgICAgICogZGV2aWNlIGFzc2lnbm1lbnQsIGRvbWFpbiBpbml0L2Rlc3Ryb3ksIGZsdXNo
IG9wcywgZXRjCisgICAgICovCisgICAgc3BpbmxvY2tfdCBsb2NrOworICAgIC8qIE9uZSBvciBt
b3JlIENhY2hlIElQTU1VIGRvbWFpbnMgYXNzb2NpYXRlZCB3aXRoIHRoaXMgWGVuIGRvbWFpbiAq
LworICAgIHN0cnVjdCBsaXN0X2hlYWQgY2FjaGVfZG9tYWluczsKKyAgICAvKiBSb290IElQTU1V
IGRvbWFpbiBhc3NvY2lhdGVkIHdpdGggdGhpcyBYZW4gZG9tYWluICovCisgICAgc3RydWN0IGlw
bW11X3Ztc2FfZG9tYWluICpyb290X2RvbWFpbjsKK307CisKKy8qIFhlbiBtYXN0ZXIgZGV2aWNl
J3MgSVBNTVUgaW5mb3JtYXRpb24gc3RvcmVkIGluIGZ3c3BlYy0+aW9tbXVfcHJpdiAqLworc3Ry
dWN0IGlwbW11X3Ztc2FfeGVuX2RldmljZSB7CisgICAgLyogQ2FjaGUgSVBNTVUgZG9tYWluIHRo
aXMgbWFzdGVyIGRldmljZSBpcyBsb2dpY2FsbHkgYXR0YWNoZWQgdG8gKi8KKyAgICBzdHJ1Y3Qg
aXBtbXVfdm1zYV9kb21haW4gKmRvbWFpbjsKKyAgICAvKiBDYWNoZSBJUE1NVSB0aGlzIG1hc3Rl
ciBkZXZpY2UgaXMgcGh5c2ljYWxseSBjb25uZWN0ZWQgdG8gKi8KKyAgICBzdHJ1Y3QgaXBtbXVf
dm1zYV9kZXZpY2UgKm1tdTsKK307CisKKy8qIFJvb3QvQ2FjaGUgSVBNTVUgZGV2aWNlJ3MgaW5m
b3JtYXRpb24gKi8KK3N0cnVjdCBpcG1tdV92bXNhX2RldmljZSB7CisgICAgc3RydWN0IGRldmlj
ZSAqZGV2OworICAgIHZvaWQgX19pb21lbSAqYmFzZTsKKyAgICBzdHJ1Y3QgaXBtbXVfdm1zYV9k
ZXZpY2UgKnJvb3Q7CisgICAgc3RydWN0IGxpc3RfaGVhZCBsaXN0OworICAgIHVuc2lnbmVkIGlu
dCBudW1fdXRsYnM7CisgICAgdW5zaWduZWQgaW50IG51bV9jdHg7CisgICAgc3BpbmxvY2tfdCBs
b2NrOyAgICAvKiBQcm90ZWN0cyBjdHggYW5kIGRvbWFpbnNbXSAqLworICAgIERFQ0xBUkVfQklU
TUFQKGN0eCwgSVBNTVVfQ1RYX01BWCk7CisgICAgc3RydWN0IGlwbW11X3Ztc2FfZG9tYWluICpk
b21haW5zW0lQTU1VX0NUWF9NQVhdOworfTsKKworLyoKKyAqIFJvb3QvQ2FjaGUgSVBNTVUgZG9t
YWluJ3MgaW5mb3JtYXRpb24KKyAqCisgKiBSb290IElQTU1VIGRldmljZSBpcyBhc3NpZ25lZCB0
byBSb290IElQTU1VIGRvbWFpbiB3aGlsZSBDYWNoZSBJUE1NVSBkZXZpY2UKKyAqIGlzIGFzc2ln
bmVkIHRvIENhY2hlIElQTU1VIGRvbWFpbi4gTWFzdGVyIGRldmljZXMgYXJlIGNvbm5lY3RlZCB0
byBDYWNoZQorICogSVBNTVUgZGV2aWNlcyB0aHJvdWdoIHNwZWNpZmljIHBvcnRzIGNhbGxlZCBt
aWNyby1UTEJzLgorICogQWxsIENhY2hlIElQTU1VIGRldmljZXMsIGluIHR1cm4sIGFyZSBjb25u
ZWN0ZWQgdG8gUm9vdCBJUE1NVSBkZXZpY2UKKyAqIHdoaWNoIG1hbmFnZXMgSVBNTVUgY29udGV4
dC4KKyAqLworc3RydWN0IGlwbW11X3Ztc2FfZG9tYWluIHsKKyAgICAvKgorICAgICAqIElQTU1V
IGRldmljZSBhc3NpZ25lZCB0byB0aGlzIElQTU1VIGRvbWFpbi4KKyAgICAgKiBFaXRoZXIgUm9v
dCBkZXZpY2Ugd2hpY2ggaXMgbG9jYXRlZCBhdCB0aGUgbWFpbiBtZW1vcnkgYnVzIGRvbWFpbiBv
cgorICAgICAqIENhY2hlIGRldmljZSB3aGljaCBpcyBsb2NhdGVkIGF0IGVhY2ggaGllcmFyY2h5
IGJ1cyBkb21haW4uCisgICAgICovCisgICAgc3RydWN0IGlwbW11X3Ztc2FfZGV2aWNlICptbXU7
CisKKyAgICAvKiBDb250ZXh0IHVzZWQgZm9yIHRoaXMgSVBNTVUgZG9tYWluICovCisgICAgdW5z
aWduZWQgaW50IGNvbnRleHRfaWQ7CisKKyAgICAvKiBYZW4gZG9tYWluIGFzc29jaWF0ZWQgd2l0
aCB0aGlzIElQTU1VIGRvbWFpbiAqLworICAgIHN0cnVjdCBkb21haW4gKmQ7CisKKyAgICAvKiBU
aGUgZmllbGRzIGJlbG93IGFyZSB1c2VkIGZvciBDYWNoZSBJUE1NVSBkb21haW4gb25seSAqLwor
CisgICAgLyoKKyAgICAgKiBVc2VkIHRvIGtlZXAgdHJhY2sgb2YgdGhlIG1hc3RlciBkZXZpY2Vz
IHdoaWNoIGFyZSBhdHRhY2hlZCB0byB0aGlzCisgICAgICogSVBNTVUgZG9tYWluIChkb21haW4g
dXNlcnMpLiBNYXN0ZXIgZGV2aWNlcyBiZWhpbmQgdGhlIHNhbWUgSVBNTVUgZGV2aWNlCisgICAg
ICogYXJlIGdyb3VwZWQgdG9nZXRoZXIgYnkgcHV0dGluZyBpbnRvIHRoZSBzYW1lIElQTU1VIGRv
bWFpbi4KKyAgICAgKiBPbmx5IHdoZW4gdGhlIHJlZmNvdW50IHJlYWNoZXMgMCB0aGlzIElQTU1V
IGRvbWFpbiBjYW4gYmUgZGVzdHJveWVkLgorICAgICAqLworICAgIHVuc2lnbmVkIGludCByZWZj
b3VudDsKKyAgICAvKiBVc2VkIHRvIGxpbmsgdGhpcyBJUE1NVSBkb21haW4gZm9yIHRoZSBzYW1l
IFhlbiBkb21haW4gKi8KKyAgICBzdHJ1Y3QgbGlzdF9oZWFkIGxpc3Q7Cit9OworCisvKiBVc2Vk
IHRvIGtlZXAgdHJhY2sgb2YgcmVnaXN0ZXJlZCBJUE1NVSBkZXZpY2VzICovCitzdGF0aWMgTElT
VF9IRUFEKGlwbW11X2RldmljZXMpOworc3RhdGljIERFRklORV9TUElOTE9DSyhpcG1tdV9kZXZp
Y2VzX2xvY2spOworCisjZGVmaW5lIFRMQl9MT09QX1RJTUVPVVQgICAgMTAwIC8qIDEwMHVzICov
CisKKy8qIFJlZ2lzdGVycyBEZWZpbml0aW9uICovCisjZGVmaW5lIElNX0NUWF9TSVpFICAgIDB4
NDAKKworI2RlZmluZSBJTUNUUiAgICAgICAgICAgICAgICAweDAwMDAKKy8qCisgKiBUaGVzZSBm
aWVsZHMgYXJlIGltcGxlbWVudGVkIGluIElQTU1VLU1NIG9ubHkuIFNvLCBjYW4gYmUgc2V0IGZv
cgorICogUm9vdCBJUE1NVSBvbmx5LgorICovCisjZGVmaW5lIElNQ1RSX1ZBNjQgICAgICAgICAg
ICgxIDw8IDI5KQorI2RlZmluZSBJTUNUUl9UUkUgICAgICAgICAgICAoMSA8PCAxNykKKyNkZWZp
bmUgSU1DVFJfQUZFICAgICAgICAgICAgKDEgPDwgMTYpCisjZGVmaW5lIElNQ1RSX1JUU0VMX01B
U0sgICAgICgzIDw8IDQpCisjZGVmaW5lIElNQ1RSX1JUU0VMX1NISUZUICAgIDQKKyNkZWZpbmUg
SU1DVFJfVFJFTiAgICAgICAgICAgKDEgPDwgMykKKy8qCisgKiBUaGVzZSBmaWVsZHMgYXJlIGNv
bW1vbiBmb3IgYWxsIElQTU1VIGRldmljZXMuIFNvLCBjYW4gYmUgc2V0IGZvcgorICogQ2FjaGUg
SVBNTVVzIGFzIHdlbGwuCisgKi8KKyNkZWZpbmUgSU1DVFJfSU5URU4gICAgICAgICAgKDEgPDwg
MikKKyNkZWZpbmUgSU1DVFJfRkxVU0ggICAgICAgICAgKDEgPDwgMSkKKyNkZWZpbmUgSU1DVFJf
TU1VRU4gICAgICAgICAgKDEgPDwgMCkKKyNkZWZpbmUgSU1DVFJfQ09NTU9OX01BU0sgICAgKDcg
PDwgMCkKKworI2RlZmluZSBJTUNBQVIgICAgICAgICAgICAgICAweDAwMDQKKworI2RlZmluZSBJ
TVRUQkNSICAgICAgICAgICAgICAgICAgICAgICAgMHgwMDA4CisjZGVmaW5lIElNVFRCQ1JfRUFF
ICAgICAgICAgICAgICAgICAgICAoMSA8PCAzMSkKKyNkZWZpbmUgSU1UVEJDUl9QTUIgICAgICAg
ICAgICAgICAgICAgICgxIDw8IDMwKQorI2RlZmluZSBJTVRUQkNSX1NIMV9OT05fU0hBUkVBQkxF
ICAgICAgKDAgPDwgMjgpCisjZGVmaW5lIElNVFRCQ1JfU0gxX09VVEVSX1NIQVJFQUJMRSAgICAo
MiA8PCAyOCkKKyNkZWZpbmUgSU1UVEJDUl9TSDFfSU5ORVJfU0hBUkVBQkxFICAgICgzIDw8IDI4
KQorI2RlZmluZSBJTVRUQkNSX1NIMV9NQVNLICAgICAgICAgICAgICAgKDMgPDwgMjgpCisjZGVm
aW5lIElNVFRCQ1JfT1JHTjFfTkMgICAgICAgICAgICAgICAoMCA8PCAyNikKKyNkZWZpbmUgSU1U
VEJDUl9PUkdOMV9XQl9XQSAgICAgICAgICAgICgxIDw8IDI2KQorI2RlZmluZSBJTVRUQkNSX09S
R04xX1dUICAgICAgICAgICAgICAgKDIgPDwgMjYpCisjZGVmaW5lIElNVFRCQ1JfT1JHTjFfV0Ig
ICAgICAgICAgICAgICAoMyA8PCAyNikKKyNkZWZpbmUgSU1UVEJDUl9PUkdOMV9NQVNLICAgICAg
ICAgICAgICgzIDw8IDI2KQorI2RlZmluZSBJTVRUQkNSX0lSR04xX05DICAgICAgICAgICAgICAg
KDAgPDwgMjQpCisjZGVmaW5lIElNVFRCQ1JfSVJHTjFfV0JfV0EgICAgICAgICAgICAoMSA8PCAy
NCkKKyNkZWZpbmUgSU1UVEJDUl9JUkdOMV9XVCAgICAgICAgICAgICAgICgyIDw8IDI0KQorI2Rl
ZmluZSBJTVRUQkNSX0lSR04xX1dCICAgICAgICAgICAgICAgKDMgPDwgMjQpCisjZGVmaW5lIElN
VFRCQ1JfSVJHTjFfTUFTSyAgICAgICAgICAgICAoMyA8PCAyNCkKKyNkZWZpbmUgSU1UVEJDUl9U
U1oxX01BU0sgICAgICAgICAgICAgICgweDFmIDw8IDE2KQorI2RlZmluZSBJTVRUQkNSX1RTWjFf
U0hJRlQgICAgICAgICAgICAgMTYKKyNkZWZpbmUgSU1UVEJDUl9TSDBfTk9OX1NIQVJFQUJMRSAg
ICAgICgwIDw8IDEyKQorI2RlZmluZSBJTVRUQkNSX1NIMF9PVVRFUl9TSEFSRUFCTEUgICAgKDIg
PDwgMTIpCisjZGVmaW5lIElNVFRCQ1JfU0gwX0lOTkVSX1NIQVJFQUJMRSAgICAoMyA8PCAxMikK
KyNkZWZpbmUgSU1UVEJDUl9TSDBfTUFTSyAgICAgICAgICAgICAgICgzIDw8IDEyKQorI2RlZmlu
ZSBJTVRUQkNSX09SR04wX05DICAgICAgICAgICAgICAgKDAgPDwgMTApCisjZGVmaW5lIElNVFRC
Q1JfT1JHTjBfV0JfV0EgICAgICAgICAgICAoMSA8PCAxMCkKKyNkZWZpbmUgSU1UVEJDUl9PUkdO
MF9XVCAgICAgICAgICAgICAgICgyIDw8IDEwKQorI2RlZmluZSBJTVRUQkNSX09SR04wX1dCICAg
ICAgICAgICAgICAgKDMgPDwgMTApCisjZGVmaW5lIElNVFRCQ1JfT1JHTjBfTUFTSyAgICAgICAg
ICAgICAoMyA8PCAxMCkKKyNkZWZpbmUgSU1UVEJDUl9JUkdOMF9OQyAgICAgICAgICAgICAgICgw
IDw8IDgpCisjZGVmaW5lIElNVFRCQ1JfSVJHTjBfV0JfV0EgICAgICAgICAgICAoMSA8PCA4KQor
I2RlZmluZSBJTVRUQkNSX0lSR04wX1dUICAgICAgICAgICAgICAgKDIgPDwgOCkKKyNkZWZpbmUg
SU1UVEJDUl9JUkdOMF9XQiAgICAgICAgICAgICAgICgzIDw8IDgpCisjZGVmaW5lIElNVFRCQ1Jf
SVJHTjBfTUFTSyAgICAgICAgICAgICAoMyA8PCA4KQorI2RlZmluZSBJTVRUQkNSX1NMMF9MVkxf
MiAgICAgICAgICAgICAgKDAgPDwgNikKKyNkZWZpbmUgSU1UVEJDUl9TTDBfTFZMXzEgICAgICAg
ICAgICAgICgxIDw8IDYpCisjZGVmaW5lIElNVFRCQ1JfVFNaMF9NQVNLICAgICAgICAgICAgICAo
MHgxZiA8PCAwKQorI2RlZmluZSBJTVRUQkNSX1RTWjBfU0hJRlQgICAgICAgICAgICAgMAorCisj
ZGVmaW5lIElNVFRMQlIwICAgICAgICAgICAgICAweDAwMTAKKyNkZWZpbmUgSU1UVExCUjBfVFRC
Ul9NQVNLICAgICgweGZmZmZmIDw8IDEyKQorI2RlZmluZSBJTVRUVUJSMCAgICAgICAgICAgICAg
MHgwMDE0CisjZGVmaW5lIElNVFRVQlIwX1RUQlJfTUFTSyAgICAoMHhmZiA8PCAwKQorI2RlZmlu
ZSBJTVRUTEJSMSAgICAgICAgICAgICAgMHgwMDE4CisjZGVmaW5lIElNVFRMQlIxX1RUQlJfTUFT
SyAgICAoMHhmZmZmZiA8PCAxMikKKyNkZWZpbmUgSU1UVFVCUjEgICAgICAgICAgICAgIDB4MDAx
YworI2RlZmluZSBJTVRUVUJSMV9UVEJSX01BU0sgICAgKDB4ZmYgPDwgMCkKKworI2RlZmluZSBJ
TVNUUiAgICAgICAgICAgICAgICAgICAgICAgICAgMHgwMDIwCisjZGVmaW5lIElNU1RSX0VSUkxW
TF9NQVNLICAgICAgICAgICAgICAoMyA8PCAxMikKKyNkZWZpbmUgSU1TVFJfRVJSTFZMX1NISUZU
ICAgICAgICAgICAgIDEyCisjZGVmaW5lIElNU1RSX0VSUkNPREVfVExCX0ZPUk1BVCAgICAgICAo
MSA8PCA4KQorI2RlZmluZSBJTVNUUl9FUlJDT0RFX0FDQ0VTU19QRVJNICAgICAgKDQgPDwgOCkK
KyNkZWZpbmUgSU1TVFJfRVJSQ09ERV9TRUNVUkVfQUNDRVNTICAgICg1IDw8IDgpCisjZGVmaW5l
IElNU1RSX0VSUkNPREVfTUFTSyAgICAgICAgICAgICAoNyA8PCA4KQorI2RlZmluZSBJTVNUUl9N
SElUICAgICAgICAgICAgICAgICAgICAgKDEgPDwgNCkKKyNkZWZpbmUgSU1TVFJfQUJPUlQgICAg
ICAgICAgICAgICAgICAgICgxIDw8IDIpCisjZGVmaW5lIElNU1RSX1BGICAgICAgICAgICAgICAg
ICAgICAgICAoMSA8PCAxKQorI2RlZmluZSBJTVNUUl9URiAgICAgICAgICAgICAgICAgICAgICAg
KDEgPDwgMCkKKworI2RlZmluZSBJTUVMQVIgICAgMHgwMDMwCisjZGVmaW5lIElNRVVBUiAgICAw
eDAwMzQKKworI2RlZmluZSBJTVVDVFIobikgICAgICAgICAgICAgICgobikgPCAzMiA/IElNVUNU
UjAobikgOiBJTVVDVFIzMihuKSkKKyNkZWZpbmUgSU1VQ1RSMChuKSAgICAgICAgICAgICAoMHgw
MzAwICsgKChuKSAqIDE2KSkKKyNkZWZpbmUgSU1VQ1RSMzIobikgICAgICAgICAgICAoMHgwNjAw
ICsgKCgobikgLSAzMikgKiAxNikpCisjZGVmaW5lIElNVUNUUl9GSVhBRERFTiAgICAgICAgKDEg
PDwgMzEpCisjZGVmaW5lIElNVUNUUl9GSVhBRERfTUFTSyAgICAgKDB4ZmYgPDwgMTYpCisjZGVm
aW5lIElNVUNUUl9GSVhBRERfU0hJRlQgICAgMTYKKyNkZWZpbmUgSU1VQ1RSX1RUU0VMX01NVShu
KSAgICAoKG4pIDw8IDQpCisjZGVmaW5lIElNVUNUUl9UVFNFTF9QTUIgICAgICAgKDggPDwgNCkK
KyNkZWZpbmUgSU1VQ1RSX1RUU0VMX01BU0sgICAgICAoMTUgPDwgNCkKKyNkZWZpbmUgSU1VQ1RS
X0ZMVVNIICAgICAgICAgICAoMSA8PCAxKQorI2RlZmluZSBJTVVDVFJfTU1VRU4gICAgICAgICAg
ICgxIDw8IDApCisKKyNkZWZpbmUgSU1VQVNJRChuKSAgICAgICAgICAgICAoKG4pIDwgMzIgPyBJ
TVVBU0lEMChuKSA6IElNVUFTSUQzMihuKSkKKyNkZWZpbmUgSU1VQVNJRDAobikgICAgICAgICAg
ICAoMHgwMzA4ICsgKChuKSAqIDE2KSkKKyNkZWZpbmUgSU1VQVNJRDMyKG4pICAgICAgICAgICAo
MHgwNjA4ICsgKCgobikgLSAzMikgKiAxNikpCisjZGVmaW5lIElNVUFTSURfQVNJRDhfTUFTSyAg
ICAgKDB4ZmYgPDwgOCkKKyNkZWZpbmUgSU1VQVNJRF9BU0lEOF9TSElGVCAgICA4CisjZGVmaW5l
IElNVUFTSURfQVNJRDBfTUFTSyAgICAgKDB4ZmYgPDwgMCkKKyNkZWZpbmUgSU1VQVNJRF9BU0lE
MF9TSElGVCAgICAwCisKKyNkZWZpbmUgSU1TQVVYQ1RMUiAgICAgICAgICAweDA1MDQKKyNkZWZp
bmUgSU1TQVVYQ1RMUl9TMlBURSAgICAoMSA8PCAzKQorCitzdGF0aWMgc3RydWN0IGlwbW11X3Zt
c2FfZGV2aWNlICp0b19pcG1tdShzdHJ1Y3QgZGV2aWNlICpkZXYpCit7CisgICAgc3RydWN0IGlv
bW11X2Z3c3BlYyAqZndzcGVjID0gZGV2X2lvbW11X2Z3c3BlY19nZXQoZGV2KTsKKworICAgIHJl
dHVybiBmd3NwZWMgJiYgZndzcGVjLT5pb21tdV9wcml2ID8KKyAgICAgICAgKChzdHJ1Y3QgaXBt
bXVfdm1zYV94ZW5fZGV2aWNlICopZndzcGVjLT5pb21tdV9wcml2KS0+bW11IDogTlVMTDsKK30K
Kworc3RhdGljIHZvaWQgc2V0X2lwbW11KHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IGlwbW11
X3Ztc2FfZGV2aWNlICptbXUpCit7CisgICAgc3RydWN0IGlvbW11X2Z3c3BlYyAqZndzcGVjID0g
ZGV2X2lvbW11X2Z3c3BlY19nZXQoZGV2KTsKKworICAgICgoc3RydWN0IGlwbW11X3Ztc2FfeGVu
X2RldmljZSAqKWZ3c3BlYy0+aW9tbXVfcHJpdiktPm1tdSA9IG1tdTsKK30KKworc3RhdGljIHN0
cnVjdCBpcG1tdV92bXNhX2RvbWFpbiAqdG9fZG9tYWluKHN0cnVjdCBkZXZpY2UgKmRldikKK3sK
KyAgICBzdHJ1Y3QgaW9tbXVfZndzcGVjICpmd3NwZWMgPSBkZXZfaW9tbXVfZndzcGVjX2dldChk
ZXYpOworCisgICAgcmV0dXJuIGZ3c3BlYyAmJiBmd3NwZWMtPmlvbW11X3ByaXYgPworICAgICAg
ICAoKHN0cnVjdCBpcG1tdV92bXNhX3hlbl9kZXZpY2UgKilmd3NwZWMtPmlvbW11X3ByaXYpLT5k
b21haW4gOiBOVUxMOworfQorCitzdGF0aWMgdm9pZCBzZXRfZG9tYWluKHN0cnVjdCBkZXZpY2Ug
KmRldiwgc3RydWN0IGlwbW11X3Ztc2FfZG9tYWluICpkb21haW4pCit7CisgICAgc3RydWN0IGlv
bW11X2Z3c3BlYyAqZndzcGVjID0gZGV2X2lvbW11X2Z3c3BlY19nZXQoZGV2KTsKKworICAgICgo
c3RydWN0IGlwbW11X3Ztc2FfeGVuX2RldmljZSAqKWZ3c3BlYy0+aW9tbXVfcHJpdiktPmRvbWFp
biA9IGRvbWFpbjsKK30KKworc3RhdGljIHN0cnVjdCBpcG1tdV92bXNhX2RldmljZSAqaXBtbXVf
ZmluZF9tbXVfYnlfZGV2KHN0cnVjdCBkZXZpY2UgKmRldikKK3sKKyAgICBzdHJ1Y3QgaXBtbXVf
dm1zYV9kZXZpY2UgKm1tdSA9IE5VTEw7CisgICAgYm9vbCBmb3VuZCA9IGZhbHNlOworCisgICAg
c3Bpbl9sb2NrKCZpcG1tdV9kZXZpY2VzX2xvY2spOworCisgICAgbGlzdF9mb3JfZWFjaF9lbnRy
eSAoIG1tdSwgJmlwbW11X2RldmljZXMsIGxpc3QgKQorICAgIHsKKyAgICAgICAgaWYgKCBtbXUt
PmRldiA9PSBkZXYgKQorICAgICAgICB7CisgICAgICAgICAgICBmb3VuZCA9IHRydWU7CisgICAg
ICAgICAgICBicmVhazsKKyAgICAgICAgfQorICAgIH0KKworICAgIHNwaW5fdW5sb2NrKCZpcG1t
dV9kZXZpY2VzX2xvY2spOworCisgICAgcmV0dXJuIGZvdW5kID8gbW11IDogTlVMTDsKK30KKwor
LyogUm9vdCBkZXZpY2UgaGFuZGxpbmcgKi8KK3N0YXRpYyBib29sIGlwbW11X2lzX3Jvb3Qoc3Ry
dWN0IGlwbW11X3Ztc2FfZGV2aWNlICptbXUpCit7CisgICAgcmV0dXJuIG1tdS0+cm9vdCA9PSBt
bXU7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgaXBtbXVfdm1zYV9kZXZpY2UgKmlwbW11X2ZpbmRfcm9v
dCh2b2lkKQoreworICAgIHN0cnVjdCBpcG1tdV92bXNhX2RldmljZSAqbW11ID0gTlVMTDsKKyAg
ICBib29sIGZvdW5kID0gZmFsc2U7CisKKyAgICBzcGluX2xvY2soJmlwbW11X2RldmljZXNfbG9j
ayk7CisKKyAgICBsaXN0X2Zvcl9lYWNoX2VudHJ5KCBtbXUsICZpcG1tdV9kZXZpY2VzLCBsaXN0
ICkKKyAgICB7CisgICAgICAgIGlmICggaXBtbXVfaXNfcm9vdChtbXUpICkKKyAgICAgICAgewor
ICAgICAgICAgICAgZm91bmQgPSB0cnVlOworICAgICAgICAgICAgYnJlYWs7CisgICAgICAgIH0K
KyAgICB9CisKKyAgICBzcGluX3VubG9jaygmaXBtbXVfZGV2aWNlc19sb2NrKTsKKworICAgIHJl
dHVybiBmb3VuZCA/IG1tdSA6IE5VTEw7Cit9CisKKy8qIFJlYWQvV3JpdGUgQWNjZXNzICovCitz
dGF0aWMgdWludDMyX3QgaXBtbXVfcmVhZChzdHJ1Y3QgaXBtbXVfdm1zYV9kZXZpY2UgKm1tdSwg
dWludDMyX3Qgb2Zmc2V0KQoreworICAgIHJldHVybiByZWFkbChtbXUtPmJhc2UgKyBvZmZzZXQp
OworfQorCitzdGF0aWMgdm9pZCBpcG1tdV93cml0ZShzdHJ1Y3QgaXBtbXVfdm1zYV9kZXZpY2Ug
Km1tdSwgdWludDMyX3Qgb2Zmc2V0LAorICAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3Qg
ZGF0YSkKK3sKKyAgICB3cml0ZWwoZGF0YSwgbW11LT5iYXNlICsgb2Zmc2V0KTsKK30KKworc3Rh
dGljIHVpbnQzMl90IGlwbW11X2N0eF9yZWFkX3Jvb3Qoc3RydWN0IGlwbW11X3Ztc2FfZG9tYWlu
ICpkb21haW4sCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCBy
ZWcpCit7CisgICAgcmV0dXJuIGlwbW11X3JlYWQoZG9tYWluLT5tbXUtPnJvb3QsCisgICAgICAg
ICAgICAgICAgICAgICAgZG9tYWluLT5jb250ZXh0X2lkICogSU1fQ1RYX1NJWkUgKyByZWcpOwor
fQorCitzdGF0aWMgdm9pZCBpcG1tdV9jdHhfd3JpdGVfcm9vdChzdHJ1Y3QgaXBtbXVfdm1zYV9k
b21haW4gKmRvbWFpbiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90
IHJlZywgdWludDMyX3QgZGF0YSkKK3sKKyAgICBpcG1tdV93cml0ZShkb21haW4tPm1tdS0+cm9v
dCwKKyAgICAgICAgICAgICAgICBkb21haW4tPmNvbnRleHRfaWQgKiBJTV9DVFhfU0laRSArIHJl
ZywgZGF0YSk7Cit9CisKK3N0YXRpYyB2b2lkIGlwbW11X2N0eF93cml0ZV9jYWNoZShzdHJ1Y3Qg
aXBtbXVfdm1zYV9kb21haW4gKmRvbWFpbiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICB1aW50MzJfdCByZWcsIHVpbnQzMl90IGRhdGEpCit7CisgICAgLyogV2UgZXhwZWN0IG9u
bHkgSU1DVFIgdmFsdWUgdG8gYmUgcGFzc2VkIGFzIGEgcmVnLiAqLworICAgIEFTU0VSVChyZWcg
PT0gSU1DVFIpOworCisgICAgLyogTWFzayBmaWVsZHMgd2hpY2ggYXJlIGltcGxlbWVudGVkIGlu
IElQTU1VLU1NIG9ubHkuICovCisgICAgaWYgKCAhaXBtbXVfaXNfcm9vdChkb21haW4tPm1tdSkg
KQorICAgICAgICBpcG1tdV93cml0ZShkb21haW4tPm1tdSwgZG9tYWluLT5jb250ZXh0X2lkICog
SU1fQ1RYX1NJWkUgKyByZWcsCisgICAgICAgICAgICAgICAgICAgIGRhdGEgJiBJTUNUUl9DT01N
T05fTUFTSyk7Cit9CisKKy8qCisgKiBXcml0ZSB0aGUgY29udGV4dCB0byBib3RoIFJvb3QgSVBN
TVUgYW5kIGFsbCBDYWNoZSBJUE1NVXMgYXNzaWduZWQKKyAqIHRvIHRoaXMgWGVuIGRvbWFpbi4K
KyAqLworc3RhdGljIHZvaWQgaXBtbXVfY3R4X3dyaXRlX2FsbChzdHJ1Y3QgaXBtbXVfdm1zYV9k
b21haW4gKmRvbWFpbiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3Qg
cmVnLCB1aW50MzJfdCBkYXRhKQoreworICAgIHN0cnVjdCBpcG1tdV92bXNhX3hlbl9kb21haW4g
Knhlbl9kb21haW4gPSBkb21faW9tbXUoZG9tYWluLT5kKS0+YXJjaC5wcml2OworICAgIHN0cnVj
dCBpcG1tdV92bXNhX2RvbWFpbiAqY2FjaGVfZG9tYWluOworCisgICAgbGlzdF9mb3JfZWFjaF9l
bnRyeSggY2FjaGVfZG9tYWluLCAmeGVuX2RvbWFpbi0+Y2FjaGVfZG9tYWlucywgbGlzdCApCisg
ICAgICAgIGlwbW11X2N0eF93cml0ZV9jYWNoZShjYWNoZV9kb21haW4sIHJlZywgZGF0YSk7CisK
KyAgICBpcG1tdV9jdHhfd3JpdGVfcm9vdChkb21haW4sIHJlZywgZGF0YSk7Cit9CisKKy8qIFRM
QiBhbmQgbWljcm8tVExCIE1hbmFnZW1lbnQgKi8KKworLyogV2FpdCBmb3IgYW55IHBlbmRpbmcg
VExCIGludmFsaWRhdGlvbnMgdG8gY29tcGxldGUuICovCitzdGF0aWMgdm9pZCBpcG1tdV90bGJf
c3luYyhzdHJ1Y3QgaXBtbXVfdm1zYV9kb21haW4gKmRvbWFpbikKK3sKKyAgICB1bnNpZ25lZCBp
bnQgY291bnQgPSAwOworCisgICAgd2hpbGUgKCBpcG1tdV9jdHhfcmVhZF9yb290KGRvbWFpbiwg
SU1DVFIpICYgSU1DVFJfRkxVU0ggKQorICAgIHsKKyAgICAgICAgY3B1X3JlbGF4KCk7CisgICAg
ICAgIGlmICggKytjb3VudCA9PSBUTEJfTE9PUF9USU1FT1VUICkKKyAgICAgICAgeworICAgICAg
ICAgICAgZGV2X2Vycl9yYXRlbGltaXRlZChkb21haW4tPm1tdS0+ZGV2LCAiVExCIHN5bmMgdGlt
ZWQgb3V0IC0tIE1NVSBtYXkgYmUgZGVhZGxvY2tlZFxuIik7CisgICAgICAgICAgICByZXR1cm47
CisgICAgICAgIH0KKyAgICAgICAgdWRlbGF5KDEpOworICAgIH0KK30KKworc3RhdGljIHZvaWQg
aXBtbXVfdGxiX2ludmFsaWRhdGUoc3RydWN0IGlwbW11X3Ztc2FfZG9tYWluICpkb21haW4pCit7
CisgICAgdWludDMyX3QgZGF0YTsKKworICAgIGRhdGEgPSBpcG1tdV9jdHhfcmVhZF9yb290KGRv
bWFpbiwgSU1DVFIpOworICAgIGRhdGEgfD0gSU1DVFJfRkxVU0g7CisgICAgaXBtbXVfY3R4X3dy
aXRlX2FsbChkb21haW4sIElNQ1RSLCBkYXRhKTsKKworICAgIGlwbW11X3RsYl9zeW5jKGRvbWFp
bik7Cit9CisKKy8qIEVuYWJsZSBNTVUgdHJhbnNsYXRpb24gZm9yIHRoZSBtaWNyby1UTEIuICov
CitzdGF0aWMgdm9pZCBpcG1tdV91dGxiX2VuYWJsZShzdHJ1Y3QgaXBtbXVfdm1zYV9kb21haW4g
KmRvbWFpbiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCB1dGxi
KQoreworICAgIHN0cnVjdCBpcG1tdV92bXNhX2RldmljZSAqbW11ID0gZG9tYWluLT5tbXU7CisK
KyAgICAvKgorICAgICAqIFRPRE86IFJlZmVyZW5jZS1jb3VudCB0aGUgbWljcm8tVExCIGFzIHNl
dmVyYWwgYnVzIG1hc3RlcnMgY2FuIGJlCisgICAgICogY29ubmVjdGVkIHRvIHRoZSBzYW1lIG1p
Y3JvLVRMQi4gUHJldmVudCB0aGUgdXNlIGNhc2VzIHdoZXJlCisgICAgICogdGhlIHNhbWUgbWlj
cm8tVExCIGNvdWxkIGJlIHNoYXJlZCBiZXR3ZWVuIG11bHRpcGxlIFhlbiBkb21haW5zLgorICAg
ICAqLworICAgIGlwbW11X3dyaXRlKG1tdSwgSU1VQVNJRCh1dGxiKSwgMCk7CisgICAgaXBtbXVf
d3JpdGUobW11LCBJTVVDVFIodXRsYiksIGlwbW11X3JlYWQobW11LCBJTVVDVFIodXRsYikpIHwK
KyAgICAgICAgICAgICAgICBJTVVDVFJfVFRTRUxfTU1VKGRvbWFpbi0+Y29udGV4dF9pZCkgfCBJ
TVVDVFJfTU1VRU4pOworfQorCisvKiBEaXNhYmxlIE1NVSB0cmFuc2xhdGlvbiBmb3IgdGhlIG1p
Y3JvLVRMQi4gKi8KK3N0YXRpYyB2b2lkIGlwbW11X3V0bGJfZGlzYWJsZShzdHJ1Y3QgaXBtbXVf
dm1zYV9kb21haW4gKmRvbWFpbiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNp
Z25lZCBpbnQgdXRsYikKK3sKKyAgICBzdHJ1Y3QgaXBtbXVfdm1zYV9kZXZpY2UgKm1tdSA9IGRv
bWFpbi0+bW11OworCisgICAgaXBtbXVfd3JpdGUobW11LCBJTVVDVFIodXRsYiksIDApOworfQor
CisvKiBEb21haW4vQ29udGV4dCBNYW5hZ2VtZW50ICovCitzdGF0aWMgaW50IGlwbW11X2RvbWFp
bl9hbGxvY2F0ZV9jb250ZXh0KHN0cnVjdCBpcG1tdV92bXNhX2RldmljZSAqbW11LAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgaXBtbXVfdm1zYV9kb21h
aW4gKmRvbWFpbikKK3sKKyAgICB1bnNpZ25lZCBsb25nIGZsYWdzOworICAgIGludCByZXQ7CisK
KyAgICBzcGluX2xvY2tfaXJxc2F2ZSgmbW11LT5sb2NrLCBmbGFncyk7CisKKyAgICByZXQgPSBm
aW5kX2ZpcnN0X3plcm9fYml0KG1tdS0+Y3R4LCBtbXUtPm51bV9jdHgpOworICAgIGlmICggcmV0
ICE9IG1tdS0+bnVtX2N0eCApCisgICAgeworICAgICAgICBtbXUtPmRvbWFpbnNbcmV0XSA9IGRv
bWFpbjsKKyAgICAgICAgc2V0X2JpdChyZXQsIG1tdS0+Y3R4KTsKKyAgICB9CisgICAgZWxzZQor
ICAgICAgICByZXQgPSAtRUJVU1k7CisKKyAgICBzcGluX3VubG9ja19pcnFyZXN0b3JlKCZtbXUt
PmxvY2ssIGZsYWdzKTsKKworICAgIHJldHVybiByZXQ7Cit9CisKK3N0YXRpYyB2b2lkIGlwbW11
X2RvbWFpbl9mcmVlX2NvbnRleHQoc3RydWN0IGlwbW11X3Ztc2FfZGV2aWNlICptbXUsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCBjb250ZXh0X2lk
KQoreworICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7CisKKyAgICBzcGluX2xvY2tfaXJxc2F2ZSgm
bW11LT5sb2NrLCBmbGFncyk7CisKKyAgICBjbGVhcl9iaXQoY29udGV4dF9pZCwgbW11LT5jdHgp
OworICAgIG1tdS0+ZG9tYWluc1tjb250ZXh0X2lkXSA9IE5VTEw7CisKKyAgICBzcGluX3VubG9j
a19pcnFyZXN0b3JlKCZtbXUtPmxvY2ssIGZsYWdzKTsKK30KKworc3RhdGljIGludCBpcG1tdV9k
b21haW5faW5pdF9jb250ZXh0KHN0cnVjdCBpcG1tdV92bXNhX2RvbWFpbiAqZG9tYWluKQorewor
ICAgIHVpbnQ2NF90IHR0YnI7CisgICAgdWludDMyX3QgdHN6MDsKKyAgICBpbnQgcmV0OworCisg
ICAgLyogRmluZCBhbiB1bnVzZWQgY29udGV4dC4gKi8KKyAgICByZXQgPSBpcG1tdV9kb21haW5f
YWxsb2NhdGVfY29udGV4dChkb21haW4tPm1tdS0+cm9vdCwgZG9tYWluKTsKKyAgICBpZiAoIHJl
dCA8IDAgKQorICAgICAgICByZXR1cm4gcmV0OworCisgICAgZG9tYWluLT5jb250ZXh0X2lkID0g
cmV0OworCisgICAgLyoKKyAgICAgKiBUVEJSMAorICAgICAqIFVzZSBQMk0gdGFibGUgZm9yIHRo
aXMgWGVuIGRvbWFpbi4KKyAgICAgKi8KKyAgICBBU1NFUlQoZG9tYWluLT5kICE9IE5VTEwpOwor
ICAgIHR0YnIgPSBwYWdlX3RvX21hZGRyKGRvbWFpbi0+ZC0+YXJjaC5wMm0ucm9vdCk7CisKKyAg
ICBkZXZfaW5mbyhkb21haW4tPm1tdS0+cm9vdC0+ZGV2LCAiJXBkOiBTZXQgSVBNTVUgY29udGV4
dCAldSAocGdkIDB4JSJQUkl4NjQiKVxuIiwKKyAgICAgICAgICAgICBkb21haW4tPmQsIGRvbWFp
bi0+Y29udGV4dF9pZCwgdHRicik7CisKKyAgICBpcG1tdV9jdHhfd3JpdGVfcm9vdChkb21haW4s
IElNVFRMQlIwLCB0dGJyICYgSU1UVExCUjBfVFRCUl9NQVNLKTsKKyAgICBpcG1tdV9jdHhfd3Jp
dGVfcm9vdChkb21haW4sIElNVFRVQlIwLCAodHRiciA+PiAzMikgJiBJTVRUVUJSMF9UVEJSX01B
U0spOworCisgICAgLyoKKyAgICAgKiBUVEJDUgorICAgICAqIFdlIHVzZSBsb25nIGRlc2NyaXB0
b3JzIGFuZCBhbGxvY2F0ZSB0aGUgd2hvbGUgInAybV9pcGFfYml0cyIgSVBBIHNwYWNlCisgICAg
ICogdG8gVFRCUjAuIFVzZSA0S0IgcGFnZSBncmFudWxlLiBTdGFydCBwYWdlIHRhYmxlIHdhbGtz
IGF0IGZpcnN0IGxldmVsLgorICAgICAqIEFsd2F5cyBieXBhc3Mgc3RhZ2UgMSB0cmFuc2xhdGlv
bi4KKyAgICAgKi8KKyAgICB0c3owID0gKDY0IC0gcDJtX2lwYV9iaXRzKSA8PCBJTVRUQkNSX1RT
WjBfU0hJRlQ7CisgICAgaXBtbXVfY3R4X3dyaXRlX3Jvb3QoZG9tYWluLCBJTVRUQkNSLCBJTVRU
QkNSX0VBRSB8IElNVFRCQ1JfUE1CIHwKKyAgICAgICAgICAgICAgICAgICAgICAgICBJTVRUQkNS
X1NMMF9MVkxfMSB8IHRzejApOworCisgICAgLyoKKyAgICAgKiBJTVNUUgorICAgICAqIENsZWFy
IGFsbCBpbnRlcnJ1cHQgZmxhZ3MuCisgICAgICovCisgICAgaXBtbXVfY3R4X3dyaXRlX3Jvb3Qo
ZG9tYWluLCBJTVNUUiwgaXBtbXVfY3R4X3JlYWRfcm9vdChkb21haW4sIElNU1RSKSk7CisKKyAg
ICAvKgorICAgICAqIElNQ1RSCisgICAgICogRW5hYmxlIHRoZSBNTVUgYW5kIGludGVycnVwdCBn
ZW5lcmF0aW9uLiBUaGUgbG9uZy1kZXNjcmlwdG9yCisgICAgICogdHJhbnNsYXRpb24gdGFibGUg
Zm9ybWF0IGRvZXNuJ3QgdXNlIFRFWCByZW1hcHBpbmcuIERvbid0IGVuYWJsZSBBRgorICAgICAq
IHNvZnR3YXJlIG1hbmFnZW1lbnQgYXMgd2UgaGF2ZSBubyB1c2UgZm9yIGl0LiBVc2UgVk1TQXY4
LTY0IG1vZGUuCisgICAgICogRW5hYmxlIHRoZSBjb250ZXh0IGZvciBSb290IElQTU1VIG9ubHku
IEZsdXNoIHRoZSBUTEIgYXMgcmVxdWlyZWQKKyAgICAgKiB3aGVuIG1vZGlmeWluZyB0aGUgY29u
dGV4dCByZWdpc3RlcnMuCisgICAgICovCisgICAgaXBtbXVfY3R4X3dyaXRlX3Jvb3QoZG9tYWlu
LCBJTUNUUiwKKyAgICAgICAgICAgICAgICAgICAgICAgICBJTUNUUl9WQTY0IHwgSU1DVFJfSU5U
RU4gfCBJTUNUUl9GTFVTSCB8IElNQ1RSX01NVUVOKTsKKworICAgIHJldHVybiAwOworfQorCitz
dGF0aWMgdm9pZCBpcG1tdV9kb21haW5fZGVzdHJveV9jb250ZXh0KHN0cnVjdCBpcG1tdV92bXNh
X2RvbWFpbiAqZG9tYWluKQoreworICAgIGlmICggIWRvbWFpbi0+bW11ICkKKyAgICAgICAgcmV0
dXJuOworCisgICAgLyoKKyAgICAgKiBEaXNhYmxlIHRoZSBjb250ZXh0IGZvciBSb290IElQTU1V
IG9ubHkuIEZsdXNoIHRoZSBUTEIgYXMgcmVxdWlyZWQKKyAgICAgKiB3aGVuIG1vZGlmeWluZyB0
aGUgY29udGV4dCByZWdpc3RlcnMuCisgICAgICovCisgICAgaXBtbXVfY3R4X3dyaXRlX3Jvb3Qo
ZG9tYWluLCBJTUNUUiwgSU1DVFJfRkxVU0gpOworICAgIGlwbW11X3RsYl9zeW5jKGRvbWFpbik7
CisKKyAgICBpcG1tdV9kb21haW5fZnJlZV9jb250ZXh0KGRvbWFpbi0+bW11LT5yb290LCBkb21h
aW4tPmNvbnRleHRfaWQpOworfQorCisvKiBGYXVsdCBIYW5kbGluZyAqLworc3RhdGljIHZvaWQg
aXBtbXVfZG9tYWluX2lycShzdHJ1Y3QgaXBtbXVfdm1zYV9kb21haW4gKmRvbWFpbikKK3sKKyAg
ICBjb25zdCB1aW50MzJfdCBlcnJfbWFzayA9IElNU1RSX01ISVQgfCBJTVNUUl9BQk9SVCB8IElN
U1RSX1BGIHwgSU1TVFJfVEY7CisgICAgc3RydWN0IGlwbW11X3Ztc2FfZGV2aWNlICptbXUgPSBk
b21haW4tPm1tdTsKKyAgICB1aW50MzJfdCBzdGF0dXM7CisgICAgdWludDY0X3QgaW92YTsKKwor
ICAgIHN0YXR1cyA9IGlwbW11X2N0eF9yZWFkX3Jvb3QoZG9tYWluLCBJTVNUUik7CisgICAgaWYg
KCAhKHN0YXR1cyAmIGVycl9tYXNrKSApCisgICAgICAgIHJldHVybjsKKworICAgIGlvdmEgPSBp
cG1tdV9jdHhfcmVhZF9yb290KGRvbWFpbiwgSU1FTEFSKSB8CisgICAgICAgICgodWludDY0X3Qp
aXBtbXVfY3R4X3JlYWRfcm9vdChkb21haW4sIElNRVVBUikgPDwgMzIpOworCisgICAgLyoKKyAg
ICAgKiBDbGVhciB0aGUgZXJyb3Igc3RhdHVzIGZsYWdzLiBVbmxpa2UgdHJhZGl0aW9uYWwgaW50
ZXJydXB0IGZsYWcKKyAgICAgKiByZWdpc3RlcnMgdGhhdCBtdXN0IGJlIGNsZWFyZWQgYnkgd3Jp
dGluZyAxLCB0aGlzIHN0YXR1cyByZWdpc3RlcgorICAgICAqIHNlZW1zIHRvIHJlcXVpcmUgMC4g
VGhlIGVycm9yIGFkZHJlc3MgcmVnaXN0ZXIgbXVzdCBiZSByZWFkIGJlZm9yZSwKKyAgICAgKiBv
dGhlcndpc2UgaXRzIHZhbHVlIHdpbGwgYmUgMC4KKyAgICAgKi8KKyAgICBpcG1tdV9jdHhfd3Jp
dGVfcm9vdChkb21haW4sIElNU1RSLCAwKTsKKworICAgIC8qIExvZyBmYXRhbCBlcnJvcnMuICov
CisgICAgaWYgKCBzdGF0dXMgJiBJTVNUUl9NSElUICkKKyAgICAgICAgZGV2X2Vycl9yYXRlbGlt
aXRlZChtbXUtPmRldiwgIiVwZDogTXVsdGlwbGUgVExCIGhpdHMgQDB4JSJQUkl4NjQiXG4iLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvbWFpbi0+ZCwgaW92YSk7CisgICAgaWYgKCBz
dGF0dXMgJiBJTVNUUl9BQk9SVCApCisgICAgICAgIGRldl9lcnJfcmF0ZWxpbWl0ZWQobW11LT5k
ZXYsICIlcGQ6IFBhZ2UgVGFibGUgV2FsayBBYm9ydCBAMHglIlBSSXg2NCJcbiIsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgZG9tYWluLT5kLCBpb3ZhKTsKKworICAgIC8qIFJldHVybiBp
ZiBpdCBpcyBuZWl0aGVyIFBlcm1pc3Npb24gRmF1bHQgbm9yIFRyYW5zbGF0aW9uIEZhdWx0LiAq
LworICAgIGlmICggIShzdGF0dXMgJiAoSU1TVFJfUEYgfCBJTVNUUl9URikpICkKKyAgICAgICAg
cmV0dXJuOworCisgICAgZGV2X2Vycl9yYXRlbGltaXRlZChtbXUtPmRldiwgIiVwZDogVW5oYW5k
bGVkIGZhdWx0OiBzdGF0dXMgMHglMDh4IGlvdmEgMHglIlBSSXg2NCJcbiIsCisgICAgICAgICAg
ICAgICAgICAgICAgICBkb21haW4tPmQsIHN0YXR1cywgaW92YSk7Cit9CisKK3N0YXRpYyB2b2lk
IGlwbW11X2lycShpbnQgaXJxLCB2b2lkICpkZXYsIHN0cnVjdCBjcHVfdXNlcl9yZWdzICpyZWdz
KQoreworICAgIHN0cnVjdCBpcG1tdV92bXNhX2RldmljZSAqbW11ID0gZGV2OworICAgIHVuc2ln
bmVkIGludCBpOworICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7CisKKyAgICBzcGluX2xvY2tfaXJx
c2F2ZSgmbW11LT5sb2NrLCBmbGFncyk7CisKKyAgICAvKgorICAgICAqIFdoZW4gaW50ZXJydXB0
IGFycml2ZXMsIHdlIGRvbid0IGtub3cgdGhlIGNvbnRleHQgaXQgaXMgcmVsYXRlZCB0by4KKyAg
ICAgKiBTbywgY2hlY2sgaW50ZXJydXB0cyBmb3IgYWxsIGFjdGl2ZSBjb250ZXh0cyB0byBsb2Nh
dGUgYSBjb250ZXh0CisgICAgICogd2l0aCBzdGF0dXMgYml0cyBzZXQuCisgICAgKi8KKyAgICBm
b3IgKCBpID0gMDsgaSA8IG1tdS0+bnVtX2N0eDsgaSsrICkKKyAgICB7CisgICAgICAgIGlmICgg
IW1tdS0+ZG9tYWluc1tpXSApCisgICAgICAgICAgICBjb250aW51ZTsKKyAgICAgICAgaXBtbXVf
ZG9tYWluX2lycShtbXUtPmRvbWFpbnNbaV0pOworICAgIH0KKworICAgIHNwaW5fdW5sb2NrX2ly
cXJlc3RvcmUoJm1tdS0+bG9jaywgZmxhZ3MpOworfQorCisvKiBNYXN0ZXIgZGV2aWNlcyBtYW5h
Z2VtZW50ICovCitzdGF0aWMgaW50IGlwbW11X2F0dGFjaF9kZXZpY2Uoc3RydWN0IGlwbW11X3Zt
c2FfZG9tYWluICpkb21haW4sCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0
IGRldmljZSAqZGV2KQoreworICAgIHN0cnVjdCBpb21tdV9md3NwZWMgKmZ3c3BlYyA9IGRldl9p
b21tdV9md3NwZWNfZ2V0KGRldik7CisgICAgc3RydWN0IGlwbW11X3Ztc2FfZGV2aWNlICptbXUg
PSB0b19pcG1tdShkZXYpOworICAgIHVuc2lnbmVkIGludCBpOworCisgICAgaWYgKCAhbW11ICkK
KyAgICB7CisgICAgICAgIGRldl9lcnIoZGV2LCAiQ2Fubm90IGF0dGFjaCB0byBJUE1NVVxuIik7
CisgICAgICAgIHJldHVybiAtRU5YSU87CisgICAgfQorCisgICAgaWYgKCAhZG9tYWluLT5tbXUg
KQorICAgIHsKKyAgICAgICAgLyogVGhlIGRvbWFpbiBoYXNuJ3QgYmVlbiB1c2VkIHlldCwgaW5p
dGlhbGl6ZSBpdC4gKi8KKyAgICAgICAgZG9tYWluLT5tbXUgPSBtbXU7CisKKyAgICAgICAgLyoK
KyAgICAgICAgICogV2UgaGF2ZSBhbHJlYWR5IGVuYWJsZWQgY29udGV4dCBmb3IgUm9vdCBJUE1N
VSBhc3NpZ25lZCB0byB0aGlzCisgICAgICAgICAqIFhlbiBkb21haW4gaW4gaXBtbXVfZG9tYWlu
X2luaXRfY29udGV4dCgpLgorICAgICAgICAgKiBFbmFibGUgdGhlIGNvbnRleHQgZm9yIENhY2hl
IElQTU1VIG9ubHkuIEZsdXNoIHRoZSBUTEIgYXMgcmVxdWlyZWQKKyAgICAgICAgICogd2hlbiBt
b2RpZnlpbmcgdGhlIGNvbnRleHQgcmVnaXN0ZXJzLgorICAgICAgICAgKi8KKyAgICAgICAgaXBt
bXVfY3R4X3dyaXRlX2NhY2hlKGRvbWFpbiwgSU1DVFIsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBpcG1tdV9jdHhfcmVhZF9yb290KGRvbWFpbiwgSU1DVFIpIHwgSU1DVFJfRkxVU0gp
OworCisgICAgICAgIGRldl9pbmZvKGRldiwgIlVzaW5nIElQTU1VIGNvbnRleHQgJXVcbiIsIGRv
bWFpbi0+Y29udGV4dF9pZCk7CisgICAgfQorICAgIGVsc2UgaWYgKCBkb21haW4tPm1tdSAhPSBt
bXUgKQorICAgIHsKKyAgICAgICAgLyoKKyAgICAgICAgICogU29tZXRoaW5nIGlzIHdyb25nLCB3
ZSBjYW4ndCBhdHRhY2ggdHdvIG1hc3RlciBkZXZpY2VzIHVzaW5nCisgICAgICAgICAqIGRpZmZl
cmVudCBJT01NVXMgdG8gdGhlIHNhbWUgSVBNTVUgZG9tYWluLgorICAgICAgICAgKi8KKyAgICAg
ICAgZGV2X2VycihkZXYsICJDYW4ndCBhdHRhY2ggSVBNTVUgJXMgdG8gZG9tYWluIG9uIElQTU1V
ICVzXG4iLAorICAgICAgICAgICAgICAgIGRldl9uYW1lKG1tdS0+ZGV2KSwgZGV2X25hbWUoZG9t
YWluLT5tbXUtPmRldikpOworICAgICAgICByZXR1cm4gLUVJTlZBTDsKKyAgICB9CisgICAgZWxz
ZQorICAgICAgICBkZXZfaW5mbyhkZXYsICJSZXVzaW5nIElQTU1VIGNvbnRleHQgJXVcbiIsIGRv
bWFpbi0+Y29udGV4dF9pZCk7CisKKyAgICBmb3IgKCBpID0gMDsgaSA8IGZ3c3BlYy0+bnVtX2lk
czsgKytpICkKKyAgICAgICAgaXBtbXVfdXRsYl9lbmFibGUoZG9tYWluLCBmd3NwZWMtPmlkc1tp
XSk7CisKKyAgICByZXR1cm4gMDsKK30KKworc3RhdGljIHZvaWQgaXBtbXVfZGV0YWNoX2Rldmlj
ZShzdHJ1Y3QgaXBtbXVfdm1zYV9kb21haW4gKmRvbWFpbiwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgc3RydWN0IGRldmljZSAqZGV2KQoreworICAgIHN0cnVjdCBpb21tdV9md3Nw
ZWMgKmZ3c3BlYyA9IGRldl9pb21tdV9md3NwZWNfZ2V0KGRldik7CisgICAgdW5zaWduZWQgaW50
IGk7CisKKyAgICBmb3IgKCBpID0gMDsgaSA8IGZ3c3BlYy0+bnVtX2lkczsgKytpICkKKyAgICAg
ICAgaXBtbXVfdXRsYl9kaXNhYmxlKGRvbWFpbiwgZndzcGVjLT5pZHNbaV0pOworfQorCitzdGF0
aWMgaW50IGlwbW11X2luaXRfcGxhdGZvcm1fZGV2aWNlKHN0cnVjdCBkZXZpY2UgKmRldiwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGR0X3BoYW5kbGVfYXJn
cyAqYXJncykKK3sKKyAgICBzdHJ1Y3QgaW9tbXVfZndzcGVjICpmd3NwZWMgPSBkZXZfaW9tbXVf
ZndzcGVjX2dldChkZXYpOworICAgIHN0cnVjdCBpcG1tdV92bXNhX2RldmljZSAqbW11OworCisg
ICAgbW11ID0gaXBtbXVfZmluZF9tbXVfYnlfZGV2KGR0X3RvX2RldihhcmdzLT5ucCkpOworICAg
IGlmICggIW1tdSApCisgICAgICAgIHJldHVybiAtRU5PREVWOworCisgICAgZndzcGVjLT5pb21t
dV9wcml2ID0geHphbGxvYyhzdHJ1Y3QgaXBtbXVfdm1zYV94ZW5fZGV2aWNlKTsKKyAgICBpZiAo
ICFmd3NwZWMtPmlvbW11X3ByaXYgKQorICAgICAgICByZXR1cm4gLUVOT01FTTsKKworICAgIHNl
dF9pcG1tdShkZXYsIG1tdSk7CisKKyAgICByZXR1cm4gMDsKK30KKworc3RhdGljIHZvaWQgaXBt
bXVfZGV2aWNlX3Jlc2V0KHN0cnVjdCBpcG1tdV92bXNhX2RldmljZSAqbW11KQoreworICAgIHVu
c2lnbmVkIGludCBpOworCisgICAgLyogRGlzYWJsZSBhbGwgY29udGV4dHMuICovCisgICAgZm9y
ICggaSA9IDA7IGkgPCBtbXUtPm51bV9jdHg7ICsraSApCisgICAgICAgIGlwbW11X3dyaXRlKG1t
dSwgaSAqIElNX0NUWF9TSVpFICsgSU1DVFIsIDApOworfQorCisvKiBSLUNhciBHZW4zIFNvQ3Mg
cHJvZHVjdCBhbmQgY3V0IGluZm9ybWF0aW9uLiAqLworI2RlZmluZSBSQ0FSX1BST0RVQ1RfTUFT
SyAgICAweDAwMDA3RjAwCisjZGVmaW5lIFJDQVJfUFJPRFVDVF9IMyAgICAgIDB4MDAwMDRGMDAK
KyNkZWZpbmUgUkNBUl9QUk9EVUNUX00zVyAgICAgMHgwMDAwNTIwMAorI2RlZmluZSBSQ0FSX1BS
T0RVQ1RfTTNOICAgICAweDAwMDA1NTAwCisjZGVmaW5lIFJDQVJfQ1VUX01BU0sgICAgICAgIDB4
MDAwMDAwRkYKKyNkZWZpbmUgUkNBUl9DVVRfVkVSMzAgICAgICAgMHgwMDAwMDAyMAorCitzdGF0
aWMgX19pbml0IGJvb2wgaXBtbXVfc3RhZ2UyX3N1cHBvcnRlZCh2b2lkKQoreworICAgIHN0cnVj
dCBkdF9kZXZpY2Vfbm9kZSAqbnA7CisgICAgdWludDY0X3QgYWRkciwgc2l6ZTsKKyAgICB2b2lk
IF9faW9tZW0gKmJhc2U7CisgICAgdWludDMyX3QgcHJvZHVjdCwgY3V0OworICAgIGJvb2wgc3Rh
Z2UyX3N1cHBvcnRlZCA9IGZhbHNlOworCisgICAgbnAgPSBkdF9maW5kX2NvbXBhdGlibGVfbm9k
ZShOVUxMLCBOVUxMLCAicmVuZXNhcyxwcnIiKTsKKyAgICBpZiAoICFucCApCisgICAgeworICAg
ICAgICBwcmludGsoWEVOTE9HX0VSUiAiaXBtbXU6IEZhaWxlZCB0byBmaW5kIFBSUiBub2RlXG4i
KTsKKyAgICAgICAgcmV0dXJuIGZhbHNlOworICAgIH0KKworICAgIGlmICggZHRfZGV2aWNlX2dl
dF9hZGRyZXNzKG5wLCAwLCAmYWRkciwgJnNpemUpICkKKyAgICB7CisgICAgICAgIHByaW50ayhY
RU5MT0dfRVJSICJpcG1tdTogRmFpbGVkIHRvIGdldCBQUlIgTU1JT1xuIik7CisgICAgICAgIHJl
dHVybiBmYWxzZTsKKyAgICB9CisKKyAgICBiYXNlID0gaW9yZW1hcF9ub2NhY2hlKGFkZHIsIHNp
emUpOworICAgIGlmICggIWJhc2UgKQorICAgIHsKKyAgICAgICAgcHJpbnRrKFhFTkxPR19FUlIg
ImlwbW11OiBGYWlsZWQgdG8gaW9yZW1hcCBQUlIgTU1JT1xuIik7CisgICAgICAgIHJldHVybiBm
YWxzZTsKKyAgICB9CisKKyAgICBwcm9kdWN0ID0gcmVhZGwoYmFzZSk7CisgICAgY3V0ID0gcHJv
ZHVjdCAmIFJDQVJfQ1VUX01BU0s7CisgICAgcHJvZHVjdCAmPSBSQ0FSX1BST0RVQ1RfTUFTSzsK
KworICAgIHN3aXRjaCAoIHByb2R1Y3QgKQorICAgIHsKKyAgICBjYXNlIFJDQVJfUFJPRFVDVF9I
MzoKKyAgICBjYXNlIFJDQVJfUFJPRFVDVF9NM1c6CisgICAgICAgIGlmICggY3V0ID49IFJDQVJf
Q1VUX1ZFUjMwICkKKyAgICAgICAgICAgIHN0YWdlMl9zdXBwb3J0ZWQgPSB0cnVlOworICAgICAg
ICBicmVhazsKKworICAgIGNhc2UgUkNBUl9QUk9EVUNUX00zTjoKKyAgICAgICAgc3RhZ2UyX3N1
cHBvcnRlZCA9IHRydWU7CisgICAgICAgIGJyZWFrOworCisgICAgZGVmYXVsdDoKKyAgICAgICAg
cHJpbnRrKFhFTkxPR19FUlIgImlwbW11OiBVbnN1cHBvcnRlZCBTb0MgdmVyc2lvblxuIik7Cisg
ICAgICAgIGJyZWFrOworICAgIH0KKworICAgIGlvdW5tYXAoYmFzZSk7CisKKyAgICByZXR1cm4g
c3RhZ2UyX3N1cHBvcnRlZDsKK30KKworLyoKKyAqIFRoaXMgZnVuY3Rpb24gcmVsaWVzIG9uIHRo
ZSBmYWN0IHRoYXQgUm9vdCBJUE1NVSBkZXZpY2UgaXMgYmVpbmcgcHJvYmVkCisgKiB0aGUgZmly
c3QuIElmIG5vdCB0aGUgY2FzZSwgaXQgZGVuaWVzIGZ1cnRoZXIgQ2FjaGUgSVBNTVUgZGV2aWNl
IHByb2JlcworICogKHJldHVybnMgdGhlIC1FQUdBSU4pIHVudGlsIHRoZSBSb290IElQTU1VIGRl
dmljZSBoYXMgYmVlbiByZWdpc3RlcmVkCisgKiBmb3Igc3VyZS4KKyAqLworc3RhdGljIGludCBp
cG1tdV9wcm9iZShzdHJ1Y3QgZHRfZGV2aWNlX25vZGUgKm5vZGUpCit7CisgICAgc3RydWN0IGlw
bW11X3Ztc2FfZGV2aWNlICptbXU7CisgICAgdWludDY0X3QgYWRkciwgc2l6ZTsKKyAgICBpbnQg
aXJxLCByZXQ7CisKKyAgICBtbXUgPSB4emFsbG9jKHN0cnVjdCBpcG1tdV92bXNhX2RldmljZSk7
CisgICAgaWYgKCAhbW11ICkKKyAgICB7CisgICAgICAgIGRldl9lcnIoJm5vZGUtPmRldiwgIkNh
bm5vdCBhbGxvY2F0ZSBkZXZpY2UgZGF0YVxuIik7CisgICAgICAgIHJldHVybiAtRU5PTUVNOwor
ICAgIH0KKworICAgIG1tdS0+ZGV2ID0gJm5vZGUtPmRldjsKKyAgICBtbXUtPm51bV91dGxicyA9
IElQTU1VX1VUTEJfTUFYOworICAgIG1tdS0+bnVtX2N0eCA9IElQTU1VX0NUWF9NQVg7CisgICAg
c3Bpbl9sb2NrX2luaXQoJm1tdS0+bG9jayk7CisgICAgYml0bWFwX3plcm8obW11LT5jdHgsIElQ
TU1VX0NUWF9NQVgpOworCisgICAgLyogTWFwIEkvTyBtZW1vcnkgYW5kIHJlcXVlc3QgSVJRLiAq
LworICAgIHJldCA9IGR0X2RldmljZV9nZXRfYWRkcmVzcyhub2RlLCAwLCAmYWRkciwgJnNpemUp
OworICAgIGlmICggcmV0ICkKKyAgICB7CisgICAgICAgIGRldl9lcnIoJm5vZGUtPmRldiwgIkZh
aWxlZCB0byBnZXQgTU1JT1xuIik7CisgICAgICAgIGdvdG8gb3V0OworICAgIH0KKworICAgIG1t
dS0+YmFzZSA9IGlvcmVtYXBfbm9jYWNoZShhZGRyLCBzaXplKTsKKyAgICBpZiAoICFtbXUtPmJh
c2UgKQorICAgIHsKKyAgICAgICAgZGV2X2Vycigmbm9kZS0+ZGV2LCAiRmFpbGVkIHRvIGlvcmVt
YXAgTU1JTyAoYWRkciAweCUiUFJJeDY0IiBzaXplIDB4JSJQUkl4NjQiKVxuIiwKKyAgICAgICAg
ICAgICAgICBhZGRyLCBzaXplKTsKKyAgICAgICAgcmV0ID0gLUVOT01FTTsKKyAgICAgICAgZ290
byBvdXQ7CisgICAgfQorCisgICAgLyoKKyAgICAgKiBEZXRlcm1pbmUgaWYgdGhpcyBJUE1NVSBu
b2RlIGlzIGEgUm9vdCBkZXZpY2UgYnkgY2hlY2tpbmcgZm9yCisgICAgICogdGhlIGxhY2sgb2Yg
cmVuZXNhcyxpcG1tdS1tYWluIHByb3BlcnR5LgorICAgICAqLworICAgIGlmICggIWR0X2ZpbmRf
cHJvcGVydHkobm9kZSwgInJlbmVzYXMsaXBtbXUtbWFpbiIsIE5VTEwpICkKKyAgICAgICAgbW11
LT5yb290ID0gbW11OworICAgIGVsc2UKKyAgICAgICAgbW11LT5yb290ID0gaXBtbXVfZmluZF9y
b290KCk7CisKKyAgICAvKiBXYWl0IHVudGlsIHRoZSBSb290IGRldmljZSBoYXMgYmVlbiByZWdp
c3RlcmVkIGZvciBzdXJlLiAqLworICAgIGlmICggIW1tdS0+cm9vdCApCisgICAgeworICAgICAg
ICByZXQgPSAtRUFHQUlOOworICAgICAgICBnb3RvIG91dDsKKyAgICB9CisKKyAgICAvKiBSb290
IGRldmljZXMgaGF2ZSBtYW5kYXRvcnkgSVJRcy4gKi8KKyAgICBpZiAoIGlwbW11X2lzX3Jvb3Qo
bW11KSApCisgICAgeworICAgICAgICBpZiAoICFpcG1tdV9zdGFnZTJfc3VwcG9ydGVkKCkgKQor
ICAgICAgICB7CisgICAgICAgICAgICBwcmludGsoWEVOTE9HX0VSUiAiaXBtbXU6IFAyTSBzaGFy
aW5nIGlzIG5vdCBzdXBwb3J0ZWQgaW4gY3VycmVudCBTb0MgcmV2aXNpb25cbiIpOworICAgICAg
ICAgICAgcmV0ID0gLUVOT0RFVjsKKyAgICAgICAgICAgIGdvdG8gb3V0OworICAgICAgICB9CisK
KyAgICAgICAgLyoKKyAgICAgICAgICogQXMgNC1sZXZlbCB0cmFuc2xhdGlvbiB0YWJsZSBpcyBu
b3Qgc3VwcG9ydGVkIGluIElQTU1VLCB3ZSBuZWVkCisgICAgICAgICAqIHRvIGNoZWNrIElQQSBz
aXplIHVzZWQgZm9yIFAyTSB0YWJsZSBiZWZvcmVoYW5kIHRvIGJlIHN1cmUgaXQgaXMKKyAgICAg
ICAgICogMy1sZXZlbCBhbmQgdGhlIElQTU1VIHdpbGwgYmUgYWJsZSB0byB1c2UgaXQuCisgICAg
ICAgICAqCisgICAgICAgICAqIFRPRE86IEZpcnN0IGluaXRpYWxpemUgdGhlIElPTU1VIGFuZCBn
YXRoZXIgdGhlIHJlcXVpcmVtZW50cyBhbmQKKyAgICAgICAgICogdGhlbiBpbml0aWFsaXplIHRo
ZSBQMk0uIEluIHRoZSBQMk0gY29kZSwgdGFrZSBpbnRvIHRoZSBhY2NvdW50CisgICAgICAgICAq
IHRoZSBJT01NVSByZXF1aXJlbWVudHMgYW5kIHJlc3RyaWN0ICJwYV9yYW5nZSIgaWYgbmVjZXNz
YXJ5LgorICAgICAgICAgKi8KKyAgICAgICAgaWYgKCBJUE1NVV9NQVhfUDJNX0lQQV9CSVRTIDwg
cDJtX2lwYV9iaXRzICkKKyAgICAgICAgeworICAgICAgICAgICAgcHJpbnRrKFhFTkxPR19FUlIg
ImlwbW11OiBQMk0gSVBBIHNpemUgaXMgbm90IHN1cHBvcnRlZCAoUDJNPSV1IElQTU1VPSV1KSFc
biIsCisgICAgICAgICAgICAgICAgICAgcDJtX2lwYV9iaXRzLCBJUE1NVV9NQVhfUDJNX0lQQV9C
SVRTKTsKKyAgICAgICAgICAgIHJldCA9IC1FTk9ERVY7CisgICAgICAgICAgICBnb3RvIG91dDsK
KyAgICAgICAgfQorCisgICAgICAgIGlycSA9IHBsYXRmb3JtX2dldF9pcnEobm9kZSwgMCk7Cisg
ICAgICAgIGlmICggaXJxIDwgMCApCisgICAgICAgIHsKKyAgICAgICAgICAgIGRldl9lcnIoJm5v
ZGUtPmRldiwgIk5vIElSUSBmb3VuZFxuIik7CisgICAgICAgICAgICByZXQgPSBpcnE7CisgICAg
ICAgICAgICBnb3RvIG91dDsKKyAgICAgICAgfQorCisgICAgICAgIHJldCA9IHJlcXVlc3RfaXJx
KGlycSwgMCwgaXBtbXVfaXJxLCBkZXZfbmFtZSgmbm9kZS0+ZGV2KSwgbW11KTsKKyAgICAgICAg
aWYgKCByZXQgPCAwICkKKyAgICAgICAgeworICAgICAgICAgICAgZGV2X2Vycigmbm9kZS0+ZGV2
LCAiRmFpbGVkIHRvIHJlcXVlc3QgSVJRICVkXG4iLCBpcnEpOworICAgICAgICAgICAgZ290byBv
dXQ7CisgICAgICAgIH0KKworICAgICAgICBpcG1tdV9kZXZpY2VfcmVzZXQobW11KTsKKworICAg
ICAgICAvKgorICAgICAgICAgKiBVc2Ugc3RhZ2UgMiB0cmFuc2xhdGlvbiB0YWJsZSBmb3JtYXQg
d2hlbiBzdGFnZSAyIHRyYW5zbGF0aW9uCisgICAgICAgICAqIGVuYWJsZWQuCisgICAgICAgICAq
LworICAgICAgICBpcG1tdV93cml0ZShtbXUsIElNU0FVWENUTFIsCisgICAgICAgICAgICAgICAg
ICAgIGlwbW11X3JlYWQobW11LCBJTVNBVVhDVExSKSB8IElNU0FVWENUTFJfUzJQVEUpOworCisg
ICAgICAgIGRldl9pbmZvKCZub2RlLT5kZXYsICJJUE1NVSBjb250ZXh0IDAgaXMgcmVzZXJ2ZWRc
biIpOworICAgICAgICBzZXRfYml0KDAsIG1tdS0+Y3R4KTsKKyAgICB9CisKKyAgICBzcGluX2xv
Y2soJmlwbW11X2RldmljZXNfbG9jayk7CisgICAgbGlzdF9hZGQoJm1tdS0+bGlzdCwgJmlwbW11
X2RldmljZXMpOworICAgIHNwaW5fdW5sb2NrKCZpcG1tdV9kZXZpY2VzX2xvY2spOworCisgICAg
ZGV2X2luZm8oJm5vZGUtPmRldiwgIlJlZ2lzdGVyZWQgJXMgSVBNTVVcbiIsCisgICAgICAgICAg
ICAgaXBtbXVfaXNfcm9vdChtbXUpID8gIlJvb3QiIDogIkNhY2hlIik7CisKKyAgICByZXR1cm4g
MDsKKworb3V0OgorICAgIGlmICggbW11LT5iYXNlICkKKyAgICAgICAgaW91bm1hcChtbXUtPmJh
c2UpOworICAgIHhmcmVlKG1tdSk7CisKKyAgICByZXR1cm4gcmV0OworfQorCisvKiBYZW4gSU9N
TVUgb3BzICovCitzdGF0aWMgaW50IF9fbXVzdF9jaGVjayBpcG1tdV9pb3RsYl9mbHVzaF9hbGwo
c3RydWN0IGRvbWFpbiAqZCkKK3sKKyAgICBzdHJ1Y3QgaXBtbXVfdm1zYV94ZW5fZG9tYWluICp4
ZW5fZG9tYWluID0gZG9tX2lvbW11KGQpLT5hcmNoLnByaXY7CisKKyAgICBpZiAoICF4ZW5fZG9t
YWluIHx8ICF4ZW5fZG9tYWluLT5yb290X2RvbWFpbiApCisgICAgICAgIHJldHVybiAwOworCisg
ICAgc3Bpbl9sb2NrKCZ4ZW5fZG9tYWluLT5sb2NrKTsKKyAgICBpcG1tdV90bGJfaW52YWxpZGF0
ZSh4ZW5fZG9tYWluLT5yb290X2RvbWFpbik7CisgICAgc3Bpbl91bmxvY2soJnhlbl9kb21haW4t
PmxvY2spOworCisgICAgcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgX19tdXN0X2NoZWNrIGlw
bW11X2lvdGxiX2ZsdXNoKHN0cnVjdCBkb21haW4gKmQsIGRmbl90IGRmbiwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCBwYWdlX2NvdW50LAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IGZs
dXNoX2ZsYWdzKQoreworICAgIEFTU0VSVChmbHVzaF9mbGFncyk7CisKKyAgICAvKiBUaGUgaGFy
ZHdhcmUgZG9lc24ndCBzdXBwb3J0IHNlbGVjdGl2ZSBUTEIgZmx1c2guICovCisgICAgcmV0dXJu
IGlwbW11X2lvdGxiX2ZsdXNoX2FsbChkKTsKK30KKworc3RhdGljIHN0cnVjdCBpcG1tdV92bXNh
X2RvbWFpbiAqaXBtbXVfZ2V0X2NhY2hlX2RvbWFpbihzdHJ1Y3QgZG9tYWluICpkLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3Qg
ZGV2aWNlICpkZXYpCit7CisgICAgc3RydWN0IGlwbW11X3Ztc2FfeGVuX2RvbWFpbiAqeGVuX2Rv
bWFpbiA9IGRvbV9pb21tdShkKS0+YXJjaC5wcml2OworICAgIHN0cnVjdCBpcG1tdV92bXNhX2Rl
dmljZSAqbW11ID0gdG9faXBtbXUoZGV2KTsKKyAgICBzdHJ1Y3QgaXBtbXVfdm1zYV9kb21haW4g
KmRvbWFpbjsKKworICAgIGlmICggIW1tdSApCisgICAgICAgIHJldHVybiBOVUxMOworCisgICAg
LyoKKyAgICAgKiBMb29wIHRocm91Z2ggYWxsIENhY2hlIElQTU1VIGRvbWFpbnMgYXNzb2NpYXRl
ZCB3aXRoIHRoaXMgWGVuIGRvbWFpbgorICAgICAqIHRvIGxvY2F0ZSBhbiBJUE1NVSBkb21haW4g
dGhpcyBJUE1NVSBkZXZpY2UgaXMgYXNzaWduZWQgdG8uCisgICAgICovCisgICAgbGlzdF9mb3Jf
ZWFjaF9lbnRyeSggZG9tYWluLCAmeGVuX2RvbWFpbi0+Y2FjaGVfZG9tYWlucywgbGlzdCApCisg
ICAgeworICAgICAgICBpZiAoIGRvbWFpbi0+bW11ID09IG1tdSApCisgICAgICAgICAgICByZXR1
cm4gZG9tYWluOworICAgIH0KKworICAgIHJldHVybiBOVUxMOworfQorCitzdGF0aWMgc3RydWN0
IGlwbW11X3Ztc2FfZG9tYWluICppcG1tdV9hbGxvY19jYWNoZV9kb21haW4oc3RydWN0IGRvbWFp
biAqZCkKK3sKKyAgICBzdHJ1Y3QgaXBtbXVfdm1zYV94ZW5fZG9tYWluICp4ZW5fZG9tYWluID0g
ZG9tX2lvbW11KGQpLT5hcmNoLnByaXY7CisgICAgc3RydWN0IGlwbW11X3Ztc2FfZG9tYWluICpk
b21haW47CisKKyAgICBkb21haW4gPSB4emFsbG9jKHN0cnVjdCBpcG1tdV92bXNhX2RvbWFpbik7
CisgICAgaWYgKCAhZG9tYWluICkKKyAgICAgICAgcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CisK
KyAgICAvKgorICAgICAqIFdlIGRvbid0IGFzc2lnbiB0aGUgQ2FjaGUgSVBNTVUgZGV2aWNlIGhl
cmUsIGl0IHdpbGwgYmUgYXNzaWduZWQgd2hlbgorICAgICAqIGF0dGFjaGluZyBtYXN0ZXIgZGV2
aWNlIHRvIHRoaXMgZG9tYWluIGluIGlwbW11X2F0dGFjaF9kZXZpY2UoKS4KKyAgICAgKiBkb21h
aW4tPm1tdSA9IE5VTEw7CisgICAgICovCisKKyAgICBkb21haW4tPmQgPSBkOworICAgIC8qIFVz
ZSB0aGUgc2FtZSBjb250ZXh0IG1hcHBlZCB0byB0aGlzIFhlbiBkb21haW4uICovCisgICAgZG9t
YWluLT5jb250ZXh0X2lkID0geGVuX2RvbWFpbi0+cm9vdF9kb21haW4tPmNvbnRleHRfaWQ7CisK
KyAgICByZXR1cm4gZG9tYWluOworfQorCitzdGF0aWMgdm9pZCBpcG1tdV9mcmVlX2NhY2hlX2Rv
bWFpbihzdHJ1Y3QgaXBtbXVfdm1zYV9kb21haW4gKmRvbWFpbikKK3sKKyAgICBsaXN0X2RlbCgm
ZG9tYWluLT5saXN0KTsKKyAgICAvKgorICAgICAqIERpc2FibGUgdGhlIGNvbnRleHQgZm9yIENh
Y2hlIElQTU1VIG9ubHkuIEZsdXNoIHRoZSBUTEIgYXMgcmVxdWlyZWQKKyAgICAgKiB3aGVuIG1v
ZGlmeWluZyB0aGUgY29udGV4dCByZWdpc3RlcnMuCisgICAgICovCisgICAgaXBtbXVfY3R4X3dy
aXRlX2NhY2hlKGRvbWFpbiwgSU1DVFIsIElNQ1RSX0ZMVVNIKTsKKyAgICB4ZnJlZShkb21haW4p
OworfQorCitzdGF0aWMgc3RydWN0IGlwbW11X3Ztc2FfZG9tYWluICppcG1tdV9hbGxvY19yb290
X2RvbWFpbihzdHJ1Y3QgZG9tYWluICpkKQoreworICAgIHN0cnVjdCBpcG1tdV92bXNhX2RvbWFp
biAqZG9tYWluOworICAgIHN0cnVjdCBpcG1tdV92bXNhX2RldmljZSAqcm9vdDsKKyAgICBpbnQg
cmV0OworCisgICAgLyogSWYgd2UgYXJlIGhlcmUgdGhlbiBSb290IGRldmljZSBtdXN0IGhhcyBi
ZWVuIHJlZ2lzdGVyZWQuICovCisgICAgcm9vdCA9IGlwbW11X2ZpbmRfcm9vdCgpOworICAgIGlm
ICggIXJvb3QgKQorICAgIHsKKyAgICAgICAgcHJpbnRrKFhFTkxPR19FUlIgImlwbW11OiBVbmFi
bGUgdG8gbG9jYXRlIFJvb3QgSVBNTVVcbiIpOworICAgICAgICByZXR1cm4gRVJSX1BUUigtRU5P
REVWKTsKKyAgICB9CisKKyAgICBkb21haW4gPSB4emFsbG9jKHN0cnVjdCBpcG1tdV92bXNhX2Rv
bWFpbik7CisgICAgaWYgKCAhZG9tYWluICkKKyAgICAgICAgcmV0dXJuIEVSUl9QVFIoLUVOT01F
TSk7CisKKyAgICBkb21haW4tPm1tdSA9IHJvb3Q7CisgICAgZG9tYWluLT5kID0gZDsKKworICAg
IC8qIEluaXRpYWxpemUgdGhlIGNvbnRleHQgdG8gYmUgbWFwcGVkIHRvIHRoaXMgWGVuIGRvbWFp
bi4gKi8KKyAgICByZXQgPSBpcG1tdV9kb21haW5faW5pdF9jb250ZXh0KGRvbWFpbik7CisgICAg
aWYgKCByZXQgPCAwICkKKyAgICB7CisgICAgICAgIGRldl9lcnIocm9vdC0+ZGV2LCAiJXBkOiBV
bmFibGUgdG8gaW5pdGlhbGl6ZSBJUE1NVSBjb250ZXh0XG4iLCBkKTsKKyAgICAgICAgeGZyZWUo
ZG9tYWluKTsKKyAgICAgICAgcmV0dXJuIEVSUl9QVFIocmV0KTsKKyAgICB9CisKKyAgICByZXR1
cm4gZG9tYWluOworfQorCitzdGF0aWMgdm9pZCBpcG1tdV9mcmVlX3Jvb3RfZG9tYWluKHN0cnVj
dCBpcG1tdV92bXNhX2RvbWFpbiAqZG9tYWluKQoreworICAgIGlwbW11X2RvbWFpbl9kZXN0cm95
X2NvbnRleHQoZG9tYWluKTsKKyAgICB4ZnJlZShkb21haW4pOworfQorCitzdGF0aWMgaW50IGlw
bW11X2Fzc2lnbl9kZXZpY2Uoc3RydWN0IGRvbWFpbiAqZCwgdTggZGV2Zm4sIHN0cnVjdCBkZXZp
Y2UgKmRldiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCBmbGFnKQor
eworICAgIHN0cnVjdCBpcG1tdV92bXNhX3hlbl9kb21haW4gKnhlbl9kb21haW4gPSBkb21faW9t
bXUoZCktPmFyY2gucHJpdjsKKyAgICBzdHJ1Y3QgaXBtbXVfdm1zYV9kb21haW4gKmRvbWFpbjsK
KyAgICBpbnQgcmV0OworCisgICAgaWYgKCAheGVuX2RvbWFpbiApCisgICAgICAgIHJldHVybiAt
RUlOVkFMOworCisgICAgaWYgKCAhdG9faXBtbXUoZGV2KSApCisgICAgICAgIHJldHVybiAtRU5P
REVWOworCisgICAgc3Bpbl9sb2NrKCZ4ZW5fZG9tYWluLT5sb2NrKTsKKworICAgIC8qCisgICAg
ICogVGhlIElQTU1VIGNvbnRleHQgZm9yIHRoZSBYZW4gZG9tYWluIGlzIG5vdCBhbGxvY2F0ZWQg
YmVmb3JlaGFuZAorICAgICAqIChhdCB0aGUgWGVuIGRvbWFpbiBjcmVhdGlvbiB0aW1lKSwgYnV0
IG9uIGRlbWFuZCBvbmx5LCB3aGVuIHRoZSBmaXJzdAorICAgICAqIG1hc3RlciBkZXZpY2UgYmVp
bmcgYXR0YWNoZWQgdG8gaXQuCisgICAgICogQ3JlYXRlIFJvb3QgSVBNTVUgZG9tYWluIHdoaWNo
IGNvbnRleHQgd2lsbCBiZSBtYXBwZWQgdG8gdGhpcyBYZW4gZG9tYWluCisgICAgICogaWYgbm90
IGV4aXRzIHlldC4KKyAgICAgKi8KKyAgICBpZiAoICF4ZW5fZG9tYWluLT5yb290X2RvbWFpbiAp
CisgICAgeworICAgICAgICBkb21haW4gPSBpcG1tdV9hbGxvY19yb290X2RvbWFpbihkKTsKKyAg
ICAgICAgaWYgKCBJU19FUlIoZG9tYWluKSApCisgICAgICAgIHsKKyAgICAgICAgICAgIHJldCA9
IFBUUl9FUlIoZG9tYWluKTsKKyAgICAgICAgICAgIGdvdG8gb3V0OworICAgICAgICB9CisKKyAg
ICAgICAgeGVuX2RvbWFpbi0+cm9vdF9kb21haW4gPSBkb21haW47CisgICAgfQorCisgICAgaWYg
KCB0b19kb21haW4oZGV2KSApCisgICAgeworICAgICAgICBkZXZfZXJyKGRldiwgIkFscmVhZHkg
YXR0YWNoZWQgdG8gSVBNTVUgZG9tYWluXG4iKTsKKyAgICAgICAgcmV0ID0gLUVFWElTVDsKKyAg
ICAgICAgZ290byBvdXQ7CisgICAgfQorCisgICAgLyoKKyAgICAgKiBNYXN0ZXIgZGV2aWNlcyBi
ZWhpbmQgdGhlIHNhbWUgQ2FjaGUgSVBNTVUgY2FuIGJlIGF0dGFjaGVkIHRvIHRoZSBzYW1lCisg
ICAgICogQ2FjaGUgSVBNTVUgZG9tYWluLgorICAgICAqIEJlZm9yZSBjcmVhdGluZyBuZXcgSVBN
TVUgZG9tYWluIGNoZWNrIHRvIHNlZSBpZiB0aGUgcmVxdWlyZWQgb25lCisgICAgICogYWxyZWFk
eSBleGlzdHMgZm9yIHRoaXMgWGVuIGRvbWFpbi4KKyAgICAgKi8KKyAgICBkb21haW4gPSBpcG1t
dV9nZXRfY2FjaGVfZG9tYWluKGQsIGRldik7CisgICAgaWYgKCAhZG9tYWluICkKKyAgICB7Cisg
ICAgICAgIC8qIENyZWF0ZSBuZXcgSVBNTVUgZG9tYWluIHRoaXMgbWFzdGVyIGRldmljZSB3aWxs
IGJlIGF0dGFjaGVkIHRvLiAqLworICAgICAgICBkb21haW4gPSBpcG1tdV9hbGxvY19jYWNoZV9k
b21haW4oZCk7CisgICAgICAgIGlmICggSVNfRVJSKGRvbWFpbikgKQorICAgICAgICB7CisgICAg
ICAgICAgICByZXQgPSBQVFJfRVJSKGRvbWFpbik7CisgICAgICAgICAgICBnb3RvIG91dDsKKyAg
ICAgICAgfQorCisgICAgICAgIC8qIENoYWluIG5ldyBJUE1NVSBkb21haW4gdG8gdGhlIFhlbiBk
b21haW4uICovCisgICAgICAgIGxpc3RfYWRkKCZkb21haW4tPmxpc3QsICZ4ZW5fZG9tYWluLT5j
YWNoZV9kb21haW5zKTsKKyAgICB9CisKKyAgICByZXQgPSBpcG1tdV9hdHRhY2hfZGV2aWNlKGRv
bWFpbiwgZGV2KTsKKyAgICBpZiAoIHJldCApCisgICAgeworICAgICAgICAvKgorICAgICAgICAg
KiBEZXN0cm95IENhY2hlIElQTU1VIGRvbWFpbiBvbmx5IGlmIHRoZXJlIGFyZSBubyBtYXN0ZXIg
ZGV2aWNlcworICAgICAgICAgKiBhdHRhY2hlZCB0byBpdC4KKyAgICAgICAgICovCisgICAgICAg
IGlmICggIWRvbWFpbi0+cmVmY291bnQgKQorICAgICAgICAgICAgaXBtbXVfZnJlZV9jYWNoZV9k
b21haW4oZG9tYWluKTsKKyAgICB9CisgICAgZWxzZQorICAgIHsKKyAgICAgICAgZG9tYWluLT5y
ZWZjb3VudCsrOworICAgICAgICBzZXRfZG9tYWluKGRldiwgZG9tYWluKTsKKyAgICB9CisKK291
dDoKKyAgICBzcGluX3VubG9jaygmeGVuX2RvbWFpbi0+bG9jayk7CisKKyAgICByZXR1cm4gcmV0
OworfQorCitzdGF0aWMgaW50IGlwbW11X2RlYXNzaWduX2RldmljZShzdHJ1Y3QgZG9tYWluICpk
LCBzdHJ1Y3QgZGV2aWNlICpkZXYpCit7CisgICAgc3RydWN0IGlwbW11X3Ztc2FfeGVuX2RvbWFp
biAqeGVuX2RvbWFpbiA9IGRvbV9pb21tdShkKS0+YXJjaC5wcml2OworICAgIHN0cnVjdCBpcG1t
dV92bXNhX2RvbWFpbiAqZG9tYWluID0gdG9fZG9tYWluKGRldik7CisKKyAgICBpZiAoICFkb21h
aW4gfHwgZG9tYWluLT5kICE9IGQgKQorICAgIHsKKyAgICAgICAgZGV2X2VycihkZXYsICJOb3Qg
YXR0YWNoZWQgdG8gJXBkXG4iLCBkKTsKKyAgICAgICAgcmV0dXJuIC1FU1JDSDsKKyAgICB9CisK
KyAgICBzcGluX2xvY2soJnhlbl9kb21haW4tPmxvY2spOworCisgICAgaXBtbXVfZGV0YWNoX2Rl
dmljZShkb21haW4sIGRldik7CisgICAgc2V0X2RvbWFpbihkZXYsIE5VTEwpOworICAgIGRvbWFp
bi0+cmVmY291bnQtLTsKKworICAgIC8qCisgICAgICogRGVzdHJveSBDYWNoZSBJUE1NVSBkb21h
aW4gb25seSBpZiB0aGVyZSBhcmUgbm8gbWFzdGVyIGRldmljZXMKKyAgICAgKiBhdHRhY2hlZCB0
byBpdC4KKyAgICAgKi8KKyAgICBpZiAoICFkb21haW4tPnJlZmNvdW50ICkKKyAgICAgICAgaXBt
bXVfZnJlZV9jYWNoZV9kb21haW4oZG9tYWluKTsKKworICAgIHNwaW5fdW5sb2NrKCZ4ZW5fZG9t
YWluLT5sb2NrKTsKKworICAgIHJldHVybiAwOworfQorCitzdGF0aWMgaW50IGlwbW11X3JlYXNz
aWduX2RldmljZShzdHJ1Y3QgZG9tYWluICpzLCBzdHJ1Y3QgZG9tYWluICp0LAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgdTggZGV2Zm4sICBzdHJ1Y3QgZGV2aWNlICpkZXYpCit7
CisgICAgaW50IHJldCA9IDA7CisKKyAgICAvKiBEb24ndCBhbGxvdyByZW1hcHBpbmcgb24gb3Ro
ZXIgZG9tYWluIHRoYW4gaHdkb20gKi8KKyAgICBpZiAoIHQgJiYgdCAhPSBoYXJkd2FyZV9kb21h
aW4gKQorICAgICAgICByZXR1cm4gLUVQRVJNOworCisgICAgaWYgKCB0ID09IHMgKQorICAgICAg
ICByZXR1cm4gMDsKKworICAgIHJldCA9IGlwbW11X2RlYXNzaWduX2RldmljZShzLCBkZXYpOwor
ICAgIGlmICggcmV0ICkKKyAgICAgICAgcmV0dXJuIHJldDsKKworICAgIGlmICggdCApCisgICAg
eworICAgICAgICAvKiBObyBmbGFncyBhcmUgZGVmaW5lZCBmb3IgQVJNLiAqLworICAgICAgICBy
ZXQgPSBpcG1tdV9hc3NpZ25fZGV2aWNlKHQsIGRldmZuLCBkZXYsIDApOworICAgICAgICBpZiAo
IHJldCApCisgICAgICAgICAgICByZXR1cm4gcmV0OworICAgIH0KKworICAgIHJldHVybiAwOwor
fQorCitzdGF0aWMgaW50IGlwbW11X2R0X3hsYXRlKHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0
IGR0X3BoYW5kbGVfYXJncyAqc3BlYykKK3sKKyAgICBpbnQgcmV0OworCisgICAgLyoKKyAgICAg
KiBQZXJmb3JtIHNhbml0eSBjaGVjayBvZiBwYXNzZWQgRFQgSU9NTVUgc3BlY2lmaWVyLiBFYWNo
IG1hc3RlciBkZXZpY2UKKyAgICAgKiBnZXRzIG1pY3JvLVRMQiAoZGV2aWNlIElEKSBhc3NpZ25t
ZW50IHZpYSB0aGUgImlvbW11cyIgcHJvcGVydHkKKyAgICAgKiBpbiBEVC4gV2UgZXhwZWN0ICNp
b21tdS1jZWxscyB0byBiZSAxIChNdWx0aXBsZS1tYXN0ZXIgSU9NTVUpIGFuZAorICAgICAqIHRo
aXMgY2VsbCBmb3IgdGhlIG1pY3JvLVRMQiAoZGV2aWNlIElEKS4KKyAgICAgKi8KKyAgICBpZiAo
IHNwZWMtPmFyZ3NfY291bnQgIT0gMSB8fCBzcGVjLT5hcmdzWzBdID49IElQTU1VX1VUTEJfTUFY
ICkKKyAgICAgICAgcmV0dXJuIC1FSU5WQUw7CisKKyAgICByZXQgPSBpb21tdV9md3NwZWNfYWRk
X2lkcyhkZXYsIHNwZWMtPmFyZ3MsIDEpOworICAgIGlmICggcmV0ICkKKyAgICAgICAgcmV0dXJu
IHJldDsKKworICAgIC8qIEluaXRpYWxpemUgb25jZSAtIHhsYXRlKCkgd2lsbCBjYWxsIG11bHRp
cGxlIHRpbWVzLiAqLworICAgIGlmICggdG9faXBtbXUoZGV2KSApCisgICAgICAgIHJldHVybiAw
OworCisgICAgcmV0dXJuIGlwbW11X2luaXRfcGxhdGZvcm1fZGV2aWNlKGRldiwgc3BlYyk7Cit9
CisKK3N0YXRpYyBpbnQgaXBtbXVfYWRkX2RldmljZSh1OCBkZXZmbiwgc3RydWN0IGRldmljZSAq
ZGV2KQoreworICAgIHN0cnVjdCBpb21tdV9md3NwZWMgKmZ3c3BlYyA9IGRldl9pb21tdV9md3Nw
ZWNfZ2V0KGRldik7CisKKyAgICAvKiBPbmx5IGxldCB0aHJvdWdoIGRldmljZXMgdGhhdCBoYXZl
IGJlZW4gdmVyaWZpZWQgaW4geGxhdGUoKS4gKi8KKyAgICBpZiAoICF0b19pcG1tdShkZXYpICkK
KyAgICAgICAgcmV0dXJuIC1FTk9ERVY7CisKKyAgICBpZiAoIGR0X2RldmljZV9pc19wcm90ZWN0
ZWQoZGV2X3RvX2R0KGRldikpICkKKyAgICB7CisgICAgICAgIGRldl9lcnIoZGV2LCAiQWxyZWFk
eSBhZGRlZCB0byBJUE1NVVxuIik7CisgICAgICAgIHJldHVybiAtRUVYSVNUOworICAgIH0KKwor
ICAgIC8qIExldCBYZW4ga25vdyB0aGF0IHRoZSBtYXN0ZXIgZGV2aWNlIGlzIHByb3RlY3RlZCBi
eSBhbiBJT01NVS4gKi8KKyAgICBkdF9kZXZpY2Vfc2V0X3Byb3RlY3RlZChkZXZfdG9fZHQoZGV2
KSk7CisKKyAgICBkZXZfaW5mbyhkZXYsICJBZGRlZCBtYXN0ZXIgZGV2aWNlIChJUE1NVSAlcyBt
aWNyby1UTEJzICV1KVxuIiwKKyAgICAgICAgICAgICBkZXZfbmFtZShmd3NwZWMtPmlvbW11X2Rl
diksIGZ3c3BlYy0+bnVtX2lkcyk7CisKKyAgICByZXR1cm4gMDsKK30KKworc3RhdGljIGludCBp
cG1tdV9pb21tdV9kb21haW5faW5pdChzdHJ1Y3QgZG9tYWluICpkKQoreworICAgIHN0cnVjdCBp
cG1tdV92bXNhX3hlbl9kb21haW4gKnhlbl9kb21haW47CisKKyAgICB4ZW5fZG9tYWluID0geHph
bGxvYyhzdHJ1Y3QgaXBtbXVfdm1zYV94ZW5fZG9tYWluKTsKKyAgICBpZiAoICF4ZW5fZG9tYWlu
ICkKKyAgICAgICAgcmV0dXJuIC1FTk9NRU07CisKKyAgICBzcGluX2xvY2tfaW5pdCgmeGVuX2Rv
bWFpbi0+bG9jayk7CisgICAgSU5JVF9MSVNUX0hFQUQoJnhlbl9kb21haW4tPmNhY2hlX2RvbWFp
bnMpOworICAgIC8qCisgICAgICogV2UgZG9uJ3QgY3JlYXRlIFJvb3QgSVBNTVUgZG9tYWluIGhl
cmUsIGl0IHdpbGwgYmUgY3JlYXRlZCBvbiBkZW1hbmQKKyAgICAgKiBvbmx5LCB3aGVuIGF0dGFj
aGluZyB0aGUgZmlyc3QgbWFzdGVyIGRldmljZSB0byB0aGlzIFhlbiBkb21haW4gaW4KKyAgICAg
KiBpcG1tdV9hc3NpZ25fZGV2aWNlKCkuCisgICAgICogeGVuX2RvbWFpbi0+cm9vdF9kb21haW4g
PSBOVUxMOworICAgICovCisKKyAgICBkb21faW9tbXUoZCktPmFyY2gucHJpdiA9IHhlbl9kb21h
aW47CisKKyAgICByZXR1cm4gMDsKK30KKworc3RhdGljIHZvaWQgX19od2RvbV9pbml0IGlwbW11
X2lvbW11X2h3ZG9tX2luaXQoc3RydWN0IGRvbWFpbiAqZCkKK3sKKyAgICAvKiBTZXQgdG8gZmFs
c2Ugb3B0aW9ucyBub3Qgc3VwcG9ydGVkIG9uIEFSTS4gKi8KKyAgICBpZiAoIGlvbW11X2h3ZG9t
X2luY2x1c2l2ZSApCisgICAgICAgIHByaW50ayhYRU5MT0dfV0FSTklORyAiaXBtbXU6IG1hcC1p
bmNsdXNpdmUgZG9tMC1pb21tdSBvcHRpb24gaXMgbm90IHN1cHBvcnRlZCBvbiBBUk1cbiIpOwor
ICAgIGlvbW11X2h3ZG9tX2luY2x1c2l2ZSA9IGZhbHNlOworICAgIGlmICggaW9tbXVfaHdkb21f
cmVzZXJ2ZWQgPT0gMSApCisgICAgICAgIHByaW50ayhYRU5MT0dfV0FSTklORyAiaXBtbXU6IG1h
cC1yZXNlcnZlZCBkb20wLWlvbW11IG9wdGlvbiBpcyBub3Qgc3VwcG9ydGVkIG9uIEFSTVxuIik7
CisgICAgaW9tbXVfaHdkb21fcmVzZXJ2ZWQgPSAwOworCisgICAgYXJjaF9pb21tdV9od2RvbV9p
bml0KGQpOworfQorCitzdGF0aWMgdm9pZCBpcG1tdV9pb21tdV9kb21haW5fdGVhcmRvd24oc3Ry
dWN0IGRvbWFpbiAqZCkKK3sKKyAgICBzdHJ1Y3QgaXBtbXVfdm1zYV94ZW5fZG9tYWluICp4ZW5f
ZG9tYWluID0gZG9tX2lvbW11KGQpLT5hcmNoLnByaXY7CisKKyAgICBpZiAoICF4ZW5fZG9tYWlu
ICkKKyAgICAgICAgcmV0dXJuOworCisgICAgLyoKKyAgICAgKiBEZXN0cm95IFJvb3QgSVBNTVUg
ZG9tYWluIHdoaWNoIGNvbnRleHQgaXMgbWFwcGVkIHRvIHRoaXMgWGVuIGRvbWFpbgorICAgICAq
IGlmIGV4aXRzLgorICAgICAqLworICAgIGlmICggeGVuX2RvbWFpbi0+cm9vdF9kb21haW4gKQor
ICAgICAgICBpcG1tdV9mcmVlX3Jvb3RfZG9tYWluKHhlbl9kb21haW4tPnJvb3RfZG9tYWluKTsK
KworICAgIC8qCisgICAgICogV2UgYXNzdW1lIHRoYXQgYWxsIG1hc3RlciBkZXZpY2VzIGhhdmUg
YWxyZWFkeSBiZWVuIGRldGFjaGVkIGZyb20KKyAgICAgKiB0aGlzIFhlbiBkb21haW4gYW5kIHRo
ZXJlIG11c3QgYmUgbm8gYXNzb2NpYXRlZCBDYWNoZSBJUE1NVSBkb21haW5zCisgICAgICogaW4g
dXNlLgorICAgICAqLworICAgIEFTU0VSVChsaXN0X2VtcHR5KCZ4ZW5fZG9tYWluLT5jYWNoZV9k
b21haW5zKSk7CisgICAgeGZyZWUoeGVuX2RvbWFpbik7CisgICAgZG9tX2lvbW11KGQpLT5hcmNo
LnByaXYgPSBOVUxMOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGlvbW11X29wcyBpcG1tdV9p
b21tdV9vcHMgPQoreworICAgIC5pbml0ICAgICAgICAgICAgPSBpcG1tdV9pb21tdV9kb21haW5f
aW5pdCwKKyAgICAuaHdkb21faW5pdCAgICAgID0gaXBtbXVfaW9tbXVfaHdkb21faW5pdCwKKyAg
ICAudGVhcmRvd24gICAgICAgID0gaXBtbXVfaW9tbXVfZG9tYWluX3RlYXJkb3duLAorICAgIC5p
b3RsYl9mbHVzaCAgICAgPSBpcG1tdV9pb3RsYl9mbHVzaCwKKyAgICAuaW90bGJfZmx1c2hfYWxs
ID0gaXBtbXVfaW90bGJfZmx1c2hfYWxsLAorICAgIC5hc3NpZ25fZGV2aWNlICAgPSBpcG1tdV9h
c3NpZ25fZGV2aWNlLAorICAgIC5yZWFzc2lnbl9kZXZpY2UgPSBpcG1tdV9yZWFzc2lnbl9kZXZp
Y2UsCisgICAgLm1hcF9wYWdlICAgICAgICA9IGFybV9pb21tdV9tYXBfcGFnZSwKKyAgICAudW5t
YXBfcGFnZSAgICAgID0gYXJtX2lvbW11X3VubWFwX3BhZ2UsCisgICAgLmR0X3hsYXRlICAgICAg
ICA9IGlwbW11X2R0X3hsYXRlLAorICAgIC5hZGRfZGV2aWNlICAgICAgPSBpcG1tdV9hZGRfZGV2
aWNlLAorfTsKKworc3RhdGljIGNvbnN0IHN0cnVjdCBkdF9kZXZpY2VfbWF0Y2ggaXBtbXVfZHRf
bWF0Y2hbXSBfX2luaXRjb25zdCA9Cit7CisgICAgRFRfTUFUQ0hfQ09NUEFUSUJMRSgicmVuZXNh
cyxpcG1tdS1yOGE3Nzk1IiksCisgICAgRFRfTUFUQ0hfQ09NUEFUSUJMRSgicmVuZXNhcyxpcG1t
dS1yOGE3Nzk2NSIpLAorICAgIERUX01BVENIX0NPTVBBVElCTEUoInJlbmVzYXMsaXBtbXUtcjhh
Nzc5NiIpLAorICAgIHsgLyogc2VudGluZWwgKi8gfSwKK307CisKK3N0YXRpYyBfX2luaXQgaW50
IGlwbW11X2luaXQoc3RydWN0IGR0X2RldmljZV9ub2RlICpub2RlLCBjb25zdCB2b2lkICpkYXRh
KQoreworICAgIGludCByZXQ7CisKKyAgICAvKgorICAgICAqIEV2ZW4gaWYgdGhlIGRldmljZSBj
YW4ndCBiZSBpbml0aWFsaXplZCwgd2UgZG9uJ3Qgd2FudCB0byBnaXZlCisgICAgICogdGhlIElQ
TU1VIGRldmljZSB0byBkb20wLgorICAgICAqLworICAgIGR0X2RldmljZV9zZXRfdXNlZF9ieShu
b2RlLCBET01JRF9YRU4pOworCisgICAgcmV0ID0gaXBtbXVfcHJvYmUobm9kZSk7CisgICAgaWYg
KCByZXQgKQorICAgIHsKKyAgICAgICAgZGV2X2Vycigmbm9kZS0+ZGV2LCAiRmFpbGVkIHRvIGlu
aXQgSVBNTVUgKCVkKVxuIiwgcmV0KTsKKyAgICAgICAgcmV0dXJuIHJldDsKKyAgICB9CisKKyAg
ICBpb21tdV9zZXRfb3BzKCZpcG1tdV9pb21tdV9vcHMpOworCisgICAgcmV0dXJuIDA7Cit9CisK
K0RUX0RFVklDRV9TVEFSVChpcG1tdSwgIlJlbmVzYXMgSVBNTVUtVk1TQSIsIERFVklDRV9JT01N
VSkKKyAgICAuZHRfbWF0Y2ggPSBpcG1tdV9kdF9tYXRjaCwKKyAgICAuaW5pdCA9IGlwbW11X2lu
aXQsCitEVF9ERVZJQ0VfRU5ECisKKy8qCisgKiBMb2NhbCB2YXJpYWJsZXM6CisgKiBtb2RlOiBD
CisgKiBjLWZpbGUtc3R5bGU6ICJCU0QiCisgKiBjLWJhc2ljLW9mZnNldDogNAorICogaW5kZW50
LXRhYnMtbW9kZTogbmlsCisgKiBFbmQ6CisgKi8KLS0gCjIuNy40CgoKX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApY
ZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9y
Zy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

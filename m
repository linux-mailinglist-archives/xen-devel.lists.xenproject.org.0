Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 1E96016AA76
	for <lists+xen-devel@lfdr.de>; Mon, 24 Feb 2020 16:49:13 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1j6FvY-000776-DZ; Mon, 24 Feb 2020 15:45:48 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=gzzy=4M=tklsoftware.com=tamas@srs-us1.protection.inumbo.net>)
 id 1j6FvX-000770-3t
 for xen-devel@lists.xenproject.org; Mon, 24 Feb 2020 15:45:47 +0000
X-Inumbo-ID: b87a4550-571c-11ea-a490-bc764e2007e4
Received: from mail-ed1-x543.google.com (unknown [2a00:1450:4864:20::543])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id b87a4550-571c-11ea-a490-bc764e2007e4;
 Mon, 24 Feb 2020 15:45:45 +0000 (UTC)
Received: by mail-ed1-x543.google.com with SMTP id c7so12405793edu.2
 for <xen-devel@lists.xenproject.org>; Mon, 24 Feb 2020 07:45:45 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=tklengyel-com.20150623.gappssmtp.com; s=20150623;
 h=mime-version:references:in-reply-to:from:date:message-id:subject:to
 :cc:content-transfer-encoding;
 bh=F1aL4iYUe3VCx1KappCkUC20sXvh9cbusoXvlY9c97I=;
 b=Ak+8yswPjkHJi65uxayusfxN5B01i1+uFxwcdVPynjBYmmwh0gk81IiGJhR8VuUtmw
 5gLwTiHwIqtmIV3ETN+xrPjpKuEccK0Y0XGm7zVx4c4IEbpQGaTry0pauVhDg/oUYDYk
 eaydVlIk9Sv6WcAWDDMBLi9LyJm2ztbnNA/i3PH/o33K2YNYgtHsOHErlCAX6kkYgsil
 gHMDbZqNenKl52WJP9jcrA8L09POHwPecG+OVUo2n5wi30AanjWSjHa0Jn80eHrlnMBL
 CjFjl6GEVf5Q/36Cv8bKX2Kzx/+xaKNHj15/BbrXhdpIV4ZIPTgcSjcaq4Qjbwv2KsPv
 wJew==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:mime-version:references:in-reply-to:from:date
 :message-id:subject:to:cc:content-transfer-encoding;
 bh=F1aL4iYUe3VCx1KappCkUC20sXvh9cbusoXvlY9c97I=;
 b=ZjSm6eLsxkP4E/3Hl9HeddBKuNk+UUwOm6aPZaVe8YyjDBlOtQGl1/jF8LhlgehTa0
 VYfxh9rtljmvFqi3baRhGTX11zDza1w16ObZfRDjHZnktgMkVHcFC896vhQcDn+urKJ5
 7vdNzWCghIEPzYdRoM0kvmz+pfcM6vClLlrTdIRcv0UYT8X8q2m38EjXL1w4J+C7njhN
 ynPCVbb4qdVjzerD7E3QlkSmdF+FCIwXN4i8EynU3/swbDNDPjum7IBmJBPru6nnQwkr
 Kdzz1fa0K3qgWxHgvrp/bM3LjHLSYZcf/JDzLVtxi0f3elM7/xXJMqyljqg5UxlbYZ14
 JkuQ==
X-Gm-Message-State: APjAAAXh9eRbX1917fFZ/br7mD+i/XRg8Z4d+dxgSHLfvZRa9oQwhCOH
 sO1E5RcQeK1fHT7nEmwkkZFuloO3srY=
X-Google-Smtp-Source: APXvYqw2Lm+0OGEaaGpYsyRkEHcny9rRp507iCg+PhlIJxHRSdFbEx8Xxg1QSYswl0Jh7CQIB4GVOA==
X-Received: by 2002:a17:906:934c:: with SMTP id
 p12mr47579207ejw.68.1582559144405; 
 Mon, 24 Feb 2020 07:45:44 -0800 (PST)
Received: from mail-wm1-f53.google.com (mail-wm1-f53.google.com.
 [209.85.128.53])
 by smtp.gmail.com with ESMTPSA id k5sm984348edx.58.2020.02.24.07.45.42
 for <xen-devel@lists.xenproject.org>
 (version=TLS1_3 cipher=TLS_AES_128_GCM_SHA256 bits=128/128);
 Mon, 24 Feb 2020 07:45:43 -0800 (PST)
Received: by mail-wm1-f53.google.com with SMTP id q9so9435269wmj.5
 for <xen-devel@lists.xenproject.org>; Mon, 24 Feb 2020 07:45:42 -0800 (PST)
X-Received: by 2002:a7b:c216:: with SMTP id x22mr23510983wmi.51.1582559142077; 
 Mon, 24 Feb 2020 07:45:42 -0800 (PST)
MIME-Version: 1.0
References: <cover.1582310142.git.tamas.lengyel@intel.com>
 <dff6668838b61fb7fe508588bef91d650cddfeb5.1582310142.git.tamas.lengyel@intel.com>
 <20200224123922.GO4679@Air-de-Roger>
In-Reply-To: <20200224123922.GO4679@Air-de-Roger>
From: Tamas K Lengyel <tamas@tklengyel.com>
Date: Mon, 24 Feb 2020 08:45:05 -0700
X-Gmail-Original-Message-ID: <CABfawh=4j1Ktt7+QhhufrwF-0gLv9TXQ_qP=79C56h_Df6FzhA@mail.gmail.com>
Message-ID: <CABfawh=4j1Ktt7+QhhufrwF-0gLv9TXQ_qP=79C56h_Df6FzhA@mail.gmail.com>
To: =?UTF-8?Q?Roger_Pau_Monn=C3=A9?= <roger.pau@citrix.com>
Subject: Re: [Xen-devel] [PATCH v9 3/5] xen/mem_sharing: VM forking
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Julien Grall <julien@xen.org>, Stefano Stabellini <sstabellini@kernel.org>,
 Tamas K Lengyel <tamas.lengyel@intel.com>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>,
 George Dunlap <george.dunlap@citrix.com>, Jan Beulich <jbeulich@suse.com>,
 Xen-devel <xen-devel@lists.xenproject.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

T24gTW9uLCBGZWIgMjQsIDIwMjAgYXQgNTozOSBBTSBSb2dlciBQYXUgTW9ubsOpIDxyb2dlci5w
YXVAY2l0cml4LmNvbT4gd3JvdGU6Cj4KPiBPbiBGcmksIEZlYiAyMSwgMjAyMCBhdCAxMDo0OToy
MUFNIC0wODAwLCBUYW1hcyBLIExlbmd5ZWwgd3JvdGU6Cj4gPiBWTSBmb3JraW5nIGlzIHRoZSBw
cm9jZXNzIG9mIGNyZWF0aW5nIGEgZG9tYWluIHdpdGggYW4gZW1wdHkgbWVtb3J5IHNwYWNlIGFu
ZCBhCj4gPiBwYXJlbnQgZG9tYWluIHNwZWNpZmllZCBmcm9tIHdoaWNoIHRvIHBvcHVsYXRlIHRo
ZSBtZW1vcnkgd2hlbiBuZWNlc3NhcnkuIEZvcgo+ID4gdGhlIG5ldyBkb21haW4gdG8gYmUgZnVu
Y3Rpb25hbCB0aGUgVk0gc3RhdGUgaXMgY29waWVkIG92ZXIgYXMgcGFydCBvZiB0aGUgZm9yawo+
ID4gb3BlcmF0aW9uIChIVk0gcGFyYW1zLCBoYXAgYWxsb2NhdGlvbiwgZXRjKS4KPiA+Cj4gPiBT
aWduZWQtb2ZmLWJ5OiBUYW1hcyBLIExlbmd5ZWwgPHRhbWFzLmxlbmd5ZWxAaW50ZWwuY29tPgo+
ID4gLS0tCj4gPiB2OTogcmVtb3ZlIHN0YWxlIGhlYWRlcgo+ID4gICAgIGZpeCB0c2MgaW5jYXJu
YXRpb24gYmVpbmcgYnVtcGVkIG9uIHNldAo+ID4gLS0tCj4gPiAgeGVuL2FyY2gveDg2L2RvbWFp
bi5jICAgICAgICAgICAgIHwgIDExICsrCj4gPiAgeGVuL2FyY2gveDg2L2h2bS9odm0uYyAgICAg
ICAgICAgIHwgICAyICstCj4gPiAgeGVuL2FyY2gveDg2L21tL21lbV9zaGFyaW5nLmMgICAgIHwg
MjIyICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwo+ID4gIHhlbi9hcmNoL3g4Ni9tbS9w
Mm0uYyAgICAgICAgICAgICB8ICAxMSArLQo+ID4gIHhlbi9pbmNsdWRlL2FzbS14ODYvbWVtX3No
YXJpbmcuaCB8ICAxNyArKysKPiA+ICB4ZW4vaW5jbHVkZS9wdWJsaWMvbWVtb3J5LmggICAgICAg
fCAgIDUgKwo+ID4gIHhlbi9pbmNsdWRlL3hlbi9zY2hlZC5oICAgICAgICAgICB8ICAgMiArCj4g
PiAgNyBmaWxlcyBjaGFuZ2VkLCAyNjggaW5zZXJ0aW9ucygrKSwgMiBkZWxldGlvbnMoLSkKPiA+
Cj4gPiBkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L2RvbWFpbi5jIGIveGVuL2FyY2gveDg2L2Rv
bWFpbi5jCj4gPiBpbmRleCBmZTYzYzIzNjc2Li4xYWIwY2EwOTQyIDEwMDY0NAo+ID4gLS0tIGEv
eGVuL2FyY2gveDg2L2RvbWFpbi5jCj4gPiArKysgYi94ZW4vYXJjaC94ODYvZG9tYWluLmMKPiA+
IEBAIC0yMjAzLDYgKzIyMDMsMTcgQEAgaW50IGRvbWFpbl9yZWxpbnF1aXNoX3Jlc291cmNlcyhz
dHJ1Y3QgZG9tYWluICpkKQo+ID4gICAgICAgICAgICAgIHJldCA9IHJlbGlucXVpc2hfc2hhcmVk
X3BhZ2VzKGQpOwo+ID4gICAgICAgICAgICAgIGlmICggcmV0ICkKPiA+ICAgICAgICAgICAgICAg
ICAgcmV0dXJuIHJldDsKPiA+ICsKPiA+ICsgICAgICAgICAgICAvKgo+ID4gKyAgICAgICAgICAg
ICAqIElmIHRoZSBkb21haW4gaXMgZm9ya2VkLCBkZWNyZW1lbnQgdGhlIHBhcmVudCdzIHBhdXNl
IGNvdW50Cj4gPiArICAgICAgICAgICAgICogYW5kIHJlbGVhc2UgdGhlIGRvbWFpbi4KPiA+ICsg
ICAgICAgICAgICAgKi8KPiA+ICsgICAgICAgICAgICBpZiAoIGQtPnBhcmVudCApCj4gPiArICAg
ICAgICAgICAgewo+ID4gKyAgICAgICAgICAgICAgICBkb21haW5fdW5wYXVzZShkLT5wYXJlbnQp
Owo+ID4gKyAgICAgICAgICAgICAgICBwdXRfZG9tYWluKGQtPnBhcmVudCk7Cj4gPiArICAgICAg
ICAgICAgICAgIGQtPnBhcmVudCA9IE5VTEw7Cj4gPiArICAgICAgICAgICAgfQo+ID4gICAgICAg
ICAgfQo+ID4gICNlbmRpZgo+ID4KPiA+IGRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvaHZtL2h2
bS5jIGIveGVuL2FyY2gveDg2L2h2bS9odm0uYwo+ID4gaW5kZXggYTMzOWIzNmEwZC4uOWJmYTYw
M2Y4YyAxMDA2NDQKPiA+IC0tLSBhL3hlbi9hcmNoL3g4Ni9odm0vaHZtLmMKPiA+ICsrKyBiL3hl
bi9hcmNoL3g4Ni9odm0vaHZtLmMKPiA+IEBAIC0xOTE1LDcgKzE5MTUsNyBAQCBpbnQgaHZtX2hh
cF9uZXN0ZWRfcGFnZV9mYXVsdChwYWRkcl90IGdwYSwgdW5zaWduZWQgbG9uZyBnbGEsCj4gPiAg
ICAgIH0KPiA+ICAjZW5kaWYKPiA+Cj4gPiAtICAgIC8qIFNwdXJpb3VzIGZhdWx0PyBQb0QgYW5k
IGxvZy1kaXJ0eSBhbHNvIHRha2UgdGhpcyBwYXRoLiAqLwo+ID4gKyAgICAvKiBTcHVyaW91cyBm
YXVsdD8gUG9ELCBsb2ctZGlydHkgYW5kIFZNIGZvcmtpbmcgYWxzbyB0YWtlIHRoaXMgcGF0aC4g
Ki8KPiA+ICAgICAgaWYgKCBwMm1faXNfcmFtKHAybXQpICkKPiA+ICAgICAgewo+ID4gICAgICAg
ICAgcmMgPSAxOwo+ID4gZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9tbS9tZW1fc2hhcmluZy5j
IGIveGVuL2FyY2gveDg2L21tL21lbV9zaGFyaW5nLmMKPiA+IGluZGV4IDM4MzViYzkyOGYuLmFk
NWRiOWQ4ZDUgMTAwNjQ0Cj4gPiAtLS0gYS94ZW4vYXJjaC94ODYvbW0vbWVtX3NoYXJpbmcuYwo+
ID4gKysrIGIveGVuL2FyY2gveDg2L21tL21lbV9zaGFyaW5nLmMKPiA+IEBAIC0yMiw2ICsyMiw3
IEBACj4gPgo+ID4gICNpbmNsdWRlIDx4ZW4vdHlwZXMuaD4KPiA+ICAjaW5jbHVkZSA8eGVuL2Rv
bWFpbl9wYWdlLmg+Cj4gPiArI2luY2x1ZGUgPHhlbi9ldmVudC5oPgo+ID4gICNpbmNsdWRlIDx4
ZW4vc3BpbmxvY2suaD4KPiA+ICAjaW5jbHVkZSA8eGVuL3J3bG9jay5oPgo+ID4gICNpbmNsdWRl
IDx4ZW4vbW0uaD4KPiA+IEBAIC0zNiw2ICszNyw5IEBACj4gPiAgI2luY2x1ZGUgPGFzbS9hbHRw
Mm0uaD4KPiA+ICAjaW5jbHVkZSA8YXNtL2F0b21pYy5oPgo+ID4gICNpbmNsdWRlIDxhc20vZXZl
bnQuaD4KPiA+ICsjaW5jbHVkZSA8YXNtL2hhcC5oPgo+ID4gKyNpbmNsdWRlIDxhc20vaHZtL2h2
bS5oPgo+ID4gKyNpbmNsdWRlIDxhc20vaHZtL3NhdmUuaD4KPiA+ICAjaW5jbHVkZSA8eHNtL3hz
bS5oPgo+ID4KPiA+ICAjaW5jbHVkZSAibW0tbG9ja3MuaCIKPiA+IEBAIC0xNDQ0LDYgKzE0NDgs
MTk0IEBAIHN0YXRpYyBpbmxpbmUgaW50IG1lbV9zaGFyaW5nX2NvbnRyb2woc3RydWN0IGRvbWFp
biAqZCwgYm9vbCBlbmFibGUpCj4gPiAgICAgIHJldHVybiAwOwo+ID4gIH0KPiA+Cj4gPiArLyoK
PiA+ICsgKiBGb3JraW5nIGEgcGFnZSBvbmx5IGdldHMgY2FsbGVkIHdoZW4gdGhlIFZNIGZhdWx0
cyBkdWUgdG8gbm8gZW50cnkgYmVpbmcKPiA+ICsgKiBpbiB0aGUgRVBUIGZvciB0aGUgYWNjZXNz
LiBEZXBlbmRpbmcgb24gdGhlIHR5cGUgb2YgYWNjZXNzIHdlIGVpdGhlcgo+ID4gKyAqIHBvcHVs
YXRlIHRoZSBwaHlzbWFwIHdpdGggYSBzaGFyZWQgZW50cnkgZm9yIHJlYWQtb25seSBhY2Nlc3Mg
b3IKPiA+ICsgKiBmb3JrIHRoZSBwYWdlIGlmIGl0cyBhIHdyaXRlIGFjY2Vzcy4KPiA+ICsgKgo+
ID4gKyAqIFRoZSBjbGllbnQgcDJtIGlzIGFscmVhZHkgbG9ja2VkIHNvIHdlIG9ubHkgbmVlZCB0
byBsb2NrCj4gPiArICogdGhlIHBhcmVudCdzIGhlcmUuCj4gPiArICovCj4gPiAraW50IG1lbV9z
aGFyaW5nX2ZvcmtfcGFnZShzdHJ1Y3QgZG9tYWluICpkLCBnZm5fdCBnZm4sIGJvb2wgdW5zaGFy
aW5nKQo+ID4gK3sKPiA+ICsgICAgaW50IHJjID0gLUVOT0VOVDsKPiA+ICsgICAgc2hyX2hhbmRs
ZV90IGhhbmRsZTsKPiA+ICsgICAgc3RydWN0IGRvbWFpbiAqcGFyZW50Owo+Cj4gQ2FuIHlvdSBj
b25zdGlmeSBwYXJlbnQsIEkgYXNzdW1lIHRoZXJlIGFyZSBubyBjaGFuZ2VzIG1hZGUgdG8gdGhl
Cj4gcGFyZW50IGRvbWFpbiwganVzdCB0aGUgZm9ya2VkIG9uZS4KClN1cmUuCgo+Cj4gPiArICAg
IHN0cnVjdCBwMm1fZG9tYWluICpwMm07Cj4gPiArICAgIHVuc2lnbmVkIGxvbmcgZ2ZuX2wgPSBn
Zm5feChnZm4pOwo+ID4gKyAgICBtZm5fdCBtZm4sIG5ld19tZm47Cj4gPiArICAgIHAybV90eXBl
X3QgcDJtdDsKPiA+ICsgICAgc3RydWN0IHBhZ2VfaW5mbyAqcGFnZTsKPiA+ICsKPiA+ICsgICAg
aWYgKCAhbWVtX3NoYXJpbmdfaXNfZm9yayhkKSApCj4gPiArICAgICAgICByZXR1cm4gLUVOT0VO
VDsKPiA+ICsKPiA+ICsgICAgcGFyZW50ID0gZC0+cGFyZW50Owo+Cj4gWW91IGNhbiBpbml0aWFs
aXplIGF0IGRlY2xhcmF0aW9uIHRpbWUuCgpTdXJlLgoKPgo+ID4gKwo+ID4gKyAgICBpZiAoICF1
bnNoYXJpbmcgKQo+ID4gKyAgICB7Cj4gPiArICAgICAgICAvKiBGb3IgcmVhZC1vbmx5IGFjY2Vz
c2VzIHdlIGp1c3QgYWRkIGEgc2hhcmVkIGVudHJ5IHRvIHRoZSBwaHlzbWFwICovCj4gPiArICAg
ICAgICB3aGlsZSAoIHBhcmVudCApCj4gPiArICAgICAgICB7Cj4gPiArICAgICAgICAgICAgaWYg
KCAhKHJjID0gbm9taW5hdGVfcGFnZShwYXJlbnQsIGdmbiwgMCwgJmhhbmRsZSkpICkKPiA+ICsg
ICAgICAgICAgICAgICAgYnJlYWs7Cj4gPiArCj4gPiArICAgICAgICAgICAgcGFyZW50ID0gcGFy
ZW50LT5wYXJlbnQ7Cj4gPiArICAgICAgICB9Cj4gPiArCj4gPiArICAgICAgICBpZiAoICFyYyAp
Cj4gPiArICAgICAgICB7Cj4gPiArICAgICAgICAgICAgLyogVGhlIGNsaWVudCdzIHAybSBpcyBh
bHJlYWR5IGxvY2tlZCAqLwo+ID4gKyAgICAgICAgICAgIHN0cnVjdCBwMm1fZG9tYWluICpwcDJt
ID0gcDJtX2dldF9ob3N0cDJtKHBhcmVudCk7Cj4gPiArCj4gPiArICAgICAgICAgICAgcDJtX2xv
Y2socHAybSk7Cj4gPiArICAgICAgICAgICAgcmMgPSBhZGRfdG9fcGh5c21hcChwYXJlbnQsIGdm
bl9sLCBoYW5kbGUsIGQsIGdmbl9sLCBmYWxzZSk7Cj4gPiArICAgICAgICAgICAgcDJtX3VubG9j
ayhwcDJtKTsKPiA+ICsKPiA+ICsgICAgICAgICAgICBpZiAoICFyYyApCj4gPiArICAgICAgICAg
ICAgICAgIHJldHVybiAwOwo+ID4gKyAgICAgICAgfQo+Cj4gRG9uJ3QgeW91IG5lZWQgdG8gcmV0
dXJuIGhlcmUsIG9yIGVsc2UgeW91IHdpbGwgZmFsbGJhY2sgaW50byB0aGUKPiB1bnNoYXJpbmcg
cGF0aD8KCk5vLCB3ZSB3YW50IHRvIGZhbGwtYmFjayB0byB1bnNoYXJpbmcgcGF0aCBpZiBwb3B1
bGF0aW5nIHdpdGggYSBzaGFyZWQKZW50cnkgZmFpbGVkLiBOb3RpY2UgYWJvdmUgd2UgcmV0dXJu
IGluIGNhc2UgdGhlcmUgd2FzIG5vIGVycm9yIHdpdGgKYWRkX3RvX3BoeXNtYXAuCgo+Cj4gPiAr
ICAgIH0KPiA+ICsKPiA+ICsgICAgLyoKPiA+ICsgICAgICogSWYgaXQncyBhIHdyaXRlIGFjY2Vz
cyAoaWUuIHVuc2hhcmluZykgb3IgaWYgYWRkaW5nIGEgc2hhcmVkIGVudHJ5IHRvCj4gPiArICAg
ICAqIHRoZSBwaHlzbWFwIGZhaWxlZCB3ZSdsbCBmb3JrIHRoZSBwYWdlIGRpcmVjdGx5Lgo+ID4g
KyAgICAgKi8KPiA+ICsgICAgcDJtID0gcDJtX2dldF9ob3N0cDJtKGQpOwo+ID4gKyAgICBwYXJl
bnQgPSBkLT5wYXJlbnQ7Cj4gPiArCj4gPiArICAgIHdoaWxlICggcGFyZW50ICkKPiA+ICsgICAg
ewo+ID4gKyAgICAgICAgbWZuID0gZ2V0X2dmbl9xdWVyeShwYXJlbnQsIGdmbl9sLCAmcDJtdCk7
Cj4gPiArCj4gPiArICAgICAgICBpZiAoIG1mbl92YWxpZChtZm4pICYmIHAybV9pc19hbnlfcmFt
KHAybXQpICkKPgo+IFRoaXMgd291bGQgYWxzbyBjb3ZlciBncmFudHMsIGJ1dCBJJ20gbm90IHN1
cmUgaG93IHRob3NlIGFyZSBoYW5kbGVkCj4gYnkgZm9ya2luZywgYXMgYWNjZXNzIHRvIHRob3Nl
IGlzIGdyYW50ZWQgb24gYSBwZXItZG9tYWluIGJhc2lzLiBJZToKPiB0aGUgcGFyZW50IHdpbGwg
aGF2ZSBhY2Nlc3MgdG8gdGhlIGdyYW50LCBidXQgbm90IHRoZSBjaGlsZC4KCkdvb2QgcXVlc3Rp
b24uIEdyYW50cyBhcmUgbm90IHNoYXJhYmxlIGJlY2F1c2UgdGhlaXIgcmVmZXJlbmNlIGNvdW50
CndpbGwgcHJldmVudCBzaGFyaW5nLCBzbyBoZXJlIHRoZSBwYWdlIGNvbnRlbnQgd291bGQganVz
dCBnZXQgY29waWVkCmFzIGEgcmVndWxhciBwYWdlIGludG8gdGhlIGZvcmsuIEkgY2FuIGNoZWNr
IHRoYXQgaWYgaW4gdGhlIHVzZWNhc2Ugd2UKaGF2ZSBhbnl0aGluZyBicmVha3MgaWYgd2UganVz
dCBza2lwIGdyYW50cyBjb21wbGV0ZWx5LCBJIGRvbid0IHRoaW5rCmEgcmVndWxhciBkb21haW4g
aGFzIGFueSBncmFudHMgYnkgZGVmYXVsdC4KCj4KPiA+ICsgICAgICAgICAgICBicmVhazsKPiA+
ICsKPiA+ICsgICAgICAgIHB1dF9nZm4ocGFyZW50LCBnZm5fbCk7Cj4gPiArICAgICAgICBwYXJl
bnQgPSBwYXJlbnQtPnBhcmVudDsKPiA+ICsgICAgfQo+ID4gKwo+ID4gKyAgICBpZiAoICFwYXJl
bnQgKQo+ID4gKyAgICAgICAgcmV0dXJuIC1FTk9FTlQ7Cj4gPiArCj4gPiArICAgIGlmICggIShw
YWdlID0gYWxsb2NfZG9taGVhcF9wYWdlKGQsIDApKSApCj4gPiArICAgIHsKPiA+ICsgICAgICAg
IHB1dF9nZm4ocGFyZW50LCBnZm5fbCk7Cj4gPiArICAgICAgICByZXR1cm4gLUVOT01FTTsKPiA+
ICsgICAgfQo+ID4gKwo+ID4gKyAgICBuZXdfbWZuID0gcGFnZV90b19tZm4ocGFnZSk7Cj4gPiAr
ICAgIGNvcHlfZG9tYWluX3BhZ2UobmV3X21mbiwgbWZuKTsKPiA+ICsgICAgc2V0X2dwZm5fZnJv
bV9tZm4obWZuX3gobmV3X21mbiksIGdmbl9sKTsKPiA+ICsKPiA+ICsgICAgcHV0X2dmbihwYXJl
bnQsIGdmbl9sKTsKPiA+ICsKPiA+ICsgICAgcmV0dXJuIHAybS0+c2V0X2VudHJ5KHAybSwgZ2Zu
LCBuZXdfbWZuLCBQQUdFX09SREVSXzRLLCBwMm1fcmFtX3J3LAo+Cj4gU28gdGhlIGNoaWxkIHAy
bSBpcyBnb2luZyB0byBiZSBwb3B1bGF0ZWQgdXNpbmcgNEsgcGFnZXMgZXhjbHVzaXZlbHk/Cj4g
TWF5YmUgaXQgd291bGQgbWFrZSBzZW5zZSB0byB0cnkgdG8gdXNlIDJNIGlmIHRoZSBwYXJlbnQg
ZG9tYWluIHBhZ2UKPiBpcyBhbHNvIGEgMk0gcGFnZSBvciBsYXJnZXI/CgpObywgbWVtb3J5IHNo
YXJpbmcgb25seSB3b3JrcyBvbiBhIDRrIGdyYW51bGFyaXR5IHNvIHRoYXQncyB3aGF0IHdlCmFy
ZSBnb2luZyB3aXRoLiBObyByZWFzb24gdG8gY29weSAyTSBwYWdlcyB3aGVuIG1vc3Qgb2YgaXQg
Y2FuIGp1c3QgYmUKc2hhcmVkIHdoZW4gYnJva2VuIHVwLgoKPgo+ID4gKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgcDJtLT5kZWZhdWx0X2FjY2VzcywgLTEpOwo+ID4gK30KPiA+ICsKPiA+ICtz
dGF0aWMgaW50IGJyaW5nX3VwX3ZjcHVzKHN0cnVjdCBkb21haW4gKmNkLCBzdHJ1Y3QgY3B1cG9v
bCAqY3B1cG9vbCkKPiA+ICt7Cj4gPiArICAgIGludCByZXQ7Cj4gPiArICAgIHVuc2lnbmVkIGlu
dCBpOwo+ID4gKwo+ID4gKyAgICBpZiAoIChyZXQgPSBjcHVwb29sX21vdmVfZG9tYWluKGNkLCBj
cHVwb29sKSkgKQo+ID4gKyAgICAgICAgcmV0dXJuIHJldDsKPiA+ICsKPiA+ICsgICAgZm9yICgg
aSA9IDA7IGkgPCBjZC0+bWF4X3ZjcHVzOyBpKysgKQo+ID4gKyAgICB7Cj4gPiArICAgICAgICBp
ZiAoIGNkLT52Y3B1W2ldICkKPiA+ICsgICAgICAgICAgICBjb250aW51ZTsKPiA+ICsKPiA+ICsg
ICAgICAgIGlmICggIXZjcHVfY3JlYXRlKGNkLCBpKSApCj4gPiArICAgICAgICAgICAgcmV0dXJu
IC1FSU5WQUw7Cj4gPiArICAgIH0KPiA+ICsKPiA+ICsgICAgZG9tYWluX3VwZGF0ZV9ub2RlX2Fm
ZmluaXR5KGNkKTsKPiA+ICsgICAgcmV0dXJuIDA7Cj4gPiArfQo+ID4gKwo+ID4gK3N0YXRpYyBp
bnQgZm9ya19oYXBfYWxsb2NhdGlvbihzdHJ1Y3QgZG9tYWluICpjZCwgc3RydWN0IGRvbWFpbiAq
ZCkKPgo+IENhbiB5b3UgY29uc3RpZnkgdGhlIHBhcmVudCBkb21haW4/CgpTdXJlCgo+Cj4gQWxz
byBjZCBhbmQgZCBhbmQgbm90IHZlcnkgaGVscGZ1bCBuYW1lcywgSSB3b3VsZCBqdXN0IHVzZSBj
aGlsZCBhbmQKPiBwYXJlbnQuCgpTdXJlLgoKPiA+ICt7Cj4gPiArICAgIGludCByYzsKPiA+ICsg
ICAgYm9vbCBwcmVlbXB0ZWQ7Cj4gPiArICAgIHVuc2lnbmVkIGxvbmcgbWIgPSBoYXBfZ2V0X2Fs
bG9jYXRpb24oZCk7Cj4gPiArCj4gPiArICAgIGlmICggbWIgPT0gaGFwX2dldF9hbGxvY2F0aW9u
KGNkKSApCj4gPiArICAgICAgICByZXR1cm4gMDsKPiA+ICsKPiA+ICsgICAgcGFnaW5nX2xvY2so
Y2QpOwo+ID4gKyAgICByYyA9IGhhcF9zZXRfYWxsb2NhdGlvbihjZCwgbWIgPDwgKDIwIC0gUEFH
RV9TSElGVCksICZwcmVlbXB0ZWQpOwo+ID4gKyAgICBwYWdpbmdfdW5sb2NrKGNkKTsKPiA+ICsK
PiA+ICsgICAgaWYgKCByYyApCj4gPiArICAgICAgICByZXR1cm4gcmM7Cj4gPiArCj4gPiArICAg
IGlmICggcHJlZW1wdGVkICkKPiA+ICsgICAgICAgIHJldHVybiAtRVJFU1RBUlQ7Cj4gPiArCj4g
PiArICAgIHJldHVybiAwOwo+Cj4gWW91IGNhbiBqb2luIGFsbCB0aGUgY2hlY2tzIGludG8gYSBz
aW5nbGUgcmV0dXJuOgo+Cj4gcmV0dXJuIHByZWVtcHRlZCA/IC1FUkVTVEFSVCA6IHJjOwoKU3Vy
ZS4KCj4gPiArfQo+ID4gKwo+ID4gK3N0YXRpYyB2b2lkIGZvcmtfdHNjKHN0cnVjdCBkb21haW4g
KmNkLCBzdHJ1Y3QgZG9tYWluICpkKQo+ID4gK3sKPiA+ICsgICAgdWludDMyX3QgdHNjX21vZGU7
Cj4gPiArICAgIHVpbnQzMl90IGd0c2Nfa2h6Owo+ID4gKyAgICB1aW50MzJfdCBpbmNhcm5hdGlv
bjsKPiA+ICsgICAgdWludDY0X3QgZWxhcHNlZF9uc2VjOwo+ID4gKwo+ID4gKyAgICB0c2NfZ2V0
X2luZm8oZCwgJnRzY19tb2RlLCAmZWxhcHNlZF9uc2VjLCAmZ3RzY19raHosICZpbmNhcm5hdGlv
bik7Cj4gPiArICAgIC8qIERvbid0IGJ1bXAgaW5jYXJuYXRpb24gb24gc2V0ICovCj4gPiArICAg
IHRzY19zZXRfaW5mbyhjZCwgdHNjX21vZGUsIGVsYXBzZWRfbnNlYywgZ3RzY19raHosIGluY2Fy
bmF0aW9uIC0gMSk7Cj4KPiBXaHkgaXMgdGhlIGluY2FybmF0aW9uIG5vdCBidW1wZWQ/CgpTZWUg
QW5kcmV3J3MgY29tbWVudCBpbiB0aGUgcHJldmlvdXMgdmVyc2lvbiBvZiB0aGUgcGF0aC4gQXBw
YXJlbnRseQp0c2Nfc2V0X2luZm8gYnVtcHMgaXQgaXRzZWxmLgoKPgo+ID4gK30KPiA+ICsKPiA+
ICtzdGF0aWMgaW50IG1lbV9zaGFyaW5nX2Zvcmsoc3RydWN0IGRvbWFpbiAqZCwgc3RydWN0IGRv
bWFpbiAqY2QpCj4gPiArewo+ID4gKyAgICBpbnQgcmMgPSAtRUlOVkFMOwo+ID4gKwo+ID4gKyAg
ICBpZiAoICFjZC0+Y29udHJvbGxlcl9wYXVzZV9jb3VudCApCj4gPiArICAgICAgICByZXR1cm4g
cmM7Cj4KPiAtRUJVU1kgbWlnaHQgYmUgYmV0dGVyIGhlcmUuCgpTdXJlLgoKPgo+ID4gKwo+ID4g
KyAgICAvKgo+ID4gKyAgICAgKiBXZSBvbmx5IHdhbnQgdG8gZ2V0IGFuZCBwYXVzZSB0aGUgcGFy
ZW50IG9uY2UsIG5vdCBlYWNoIHRpbWUgdGhpcwo+ID4gKyAgICAgKiBvcGVyYXRpb24gaXMgcmVz
dGFydGVkIGR1ZSB0byBwcmVlbXB0aW9uLgo+ID4gKyAgICAgKi8KPiA+ICsgICAgaWYgKCAhY2Qt
PnBhcmVudF9wYXVzZWQgKQo+ID4gKyAgICB7Cj4gPiArICAgICAgICBBU1NFUlQoZ2V0X2RvbWFp
bihkKSk7Cj4KPiBXZSBhcmUgdHJ5aW5nIHRvIGF2b2lkIHN1Y2ggY29uc3RydWN0cywgaW5zdGVh
ZCBJIHN1Z2dlc3Q6Cj4KPiBpZiAoICFnZXRfZG9tYWluKHBhcmVudCkgKQo+IHsKPiAgICAgQVNT
RVJUX1VOUkVBQ0hBQkxFKCk7Cj4gICAgIHJldHVybiAtRUJVU1k7Cj4gfQoKU3VyZS4KCj4gPiAr
ICAgICAgICBkb21haW5fcGF1c2UoZCk7Cj4gPiArCj4gPiArICAgICAgICBjZC0+cGFyZW50X3Bh
dXNlZCA9IHRydWU7Cj4gPiArICAgICAgICBjZC0+bWF4X3BhZ2VzID0gZC0+bWF4X3BhZ2VzOwo+
ID4gKyAgICAgICAgY2QtPm1heF92Y3B1cyA9IGQtPm1heF92Y3B1czsKPiA+ICsgICAgfQo+ID4g
Kwo+ID4gKyAgICAvKiB0aGlzIGlzIHByZWVtcHRpYmxlIHNvIGl0J3MgdGhlIGZpcnN0IHRvIGdl
dCBkb25lICovCj4gPiArICAgIGlmICggKHJjID0gZm9ya19oYXBfYWxsb2NhdGlvbihjZCwgZCkp
ICkKPiA+ICsgICAgICAgIGdvdG8gZG9uZTsKPiA+ICsKPiA+ICsgICAgaWYgKCAocmMgPSBicmlu
Z191cF92Y3B1cyhjZCwgZC0+Y3B1cG9vbCkpICkKPiA+ICsgICAgICAgIGdvdG8gZG9uZTsKPiA+
ICsKPiA+ICsgICAgaWYgKCAocmMgPSBodm1fY29weV9jb250ZXh0X2FuZF9wYXJhbXMoY2QsIGQp
KSApCj4gPiArICAgICAgICBnb3RvIGRvbmU7Cj4gPiArCj4gPiArICAgIGZvcmtfdHNjKGNkLCBk
KTsKPiA+ICsKPiA+ICsgICAgY2QtPnBhcmVudCA9IGQ7Cj4gPiArCj4gPiArIGRvbmU6Cj4gPiAr
ICAgIGlmICggcmMgJiYgcmMgIT0gLUVSRVNUQVJUICkKPiA+ICsgICAgewo+ID4gKyAgICAgICAg
ZG9tYWluX3VucGF1c2UoZCk7Cj4gPiArICAgICAgICBwdXRfZG9tYWluKGQpOwo+ID4gKyAgICAg
ICAgY2QtPnBhcmVudF9wYXVzZWQgPSBmYWxzZTsKPiA+ICsgICAgfQo+ID4gKwo+ID4gKyAgICBy
ZXR1cm4gcmM7Cj4gPiArfQo+ID4gKwo+ID4gIGludCBtZW1fc2hhcmluZ19tZW1vcChYRU5fR1VF
U1RfSEFORExFX1BBUkFNKHhlbl9tZW1fc2hhcmluZ19vcF90KSBhcmcpCj4gPiAgewo+ID4gICAg
ICBpbnQgcmM7Cj4gPiBAQCAtMTY5OCw2ICsxODkwLDM2IEBAIGludCBtZW1fc2hhcmluZ19tZW1v
cChYRU5fR1VFU1RfSEFORExFX1BBUkFNKHhlbl9tZW1fc2hhcmluZ19vcF90KSBhcmcpCj4gPiAg
ICAgICAgICByYyA9IGRlYnVnX2dyZWYoZCwgbXNvLnUuZGVidWcudS5ncmVmKTsKPiA+ICAgICAg
ICAgIGJyZWFrOwo+ID4KPiA+ICsgICAgY2FzZSBYRU5NRU1fc2hhcmluZ19vcF9mb3JrOgo+ID4g
KyAgICB7Cj4gPiArICAgICAgICBzdHJ1Y3QgZG9tYWluICpwZDsKPiA+ICsKPiA+ICsgICAgICAg
IHJjID0gLUVJTlZBTDsKPiA+ICsgICAgICAgIGlmICggbXNvLnUuZm9yay5fcGFkWzBdIHx8IG1z
by51LmZvcmsuX3BhZFsxXSB8fAo+ID4gKyAgICAgICAgICAgICBtc28udS5mb3JrLl9wYWRbMl0g
KQo+ID4gKyAgICAgICAgICAgIGdvdG8gb3V0Owo+ID4gKwo+ID4gKyAgICAgICAgcmMgPSByY3Vf
bG9ja19saXZlX3JlbW90ZV9kb21haW5fYnlfaWQobXNvLnUuZm9yay5wYXJlbnRfZG9tYWluLAo+
ID4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJnBkKTsK
PiA+ICsgICAgICAgIGlmICggcmMgKQo+ID4gKyAgICAgICAgICAgIGdvdG8gb3V0Owo+ID4gKwo+
ID4gKyAgICAgICAgaWYgKCAhbWVtX3NoYXJpbmdfZW5hYmxlZChwZCkgKQo+ID4gKyAgICAgICAg
ewo+ID4gKyAgICAgICAgICAgIGlmICggKHJjID0gbWVtX3NoYXJpbmdfY29udHJvbChwZCwgdHJ1
ZSkpICkKPiA+ICsgICAgICAgICAgICAgICAgZ290byBvdXQ7Cj4KPiBQbGVhc2Ugam9pbiBib3Ro
IGNvbmRpdGlvbnM6Cj4KPiBpZiAoICFtZW1fc2hhcmluZ19lbmFibGVkKHBkKSAmJgo+ICAgICAg
KHJjID0gbWVtX3NoYXJpbmdfY29udHJvbChwZCwgdHJ1ZSkpICkKPiAgICAgZ290byBvdXQ7CgpT
dXJlLgoKPgo+ID4gKyAgICAgICAgfQo+ID4gKwo+ID4gKyAgICAgICAgcmMgPSBtZW1fc2hhcmlu
Z19mb3JrKHBkLCBkKTsKPiA+ICsKPiA+ICsgICAgICAgIGlmICggcmMgPT0gLUVSRVNUQVJUICkK
PiA+ICsgICAgICAgICAgICByYyA9IGh5cGVyY2FsbF9jcmVhdGVfY29udGludWF0aW9uKF9fSFlQ
RVJWSVNPUl9tZW1vcnlfb3AsCj4gPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAibGgiLCBYRU5NRU1fc2hhcmluZ19vcCwKPiA+ICsgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZyk7Cj4gPiArICAgICAgICByY3Vf
dW5sb2NrX2RvbWFpbihwZCk7Cj4gPiArICAgICAgICBicmVhazsKPiA+ICsgICAgfQo+ID4gKwo+
ID4gICAgICBkZWZhdWx0Ogo+ID4gICAgICAgICAgcmMgPSAtRU5PU1lTOwo+ID4gICAgICAgICAg
YnJlYWs7Cj4gPiBkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L21tL3AybS5jIGIveGVuL2FyY2gv
eDg2L21tL3AybS5jCj4gPiBpbmRleCBjNWY0MjhkNjdjLi43YzRkMmZkN2EwIDEwMDY0NAo+ID4g
LS0tIGEveGVuL2FyY2gveDg2L21tL3AybS5jCj4gPiArKysgYi94ZW4vYXJjaC94ODYvbW0vcDJt
LmMKPiA+IEBAIC01MDksNiArNTA5LDE0IEBAIG1mbl90IF9fZ2V0X2dmbl90eXBlX2FjY2Vzcyhz
dHJ1Y3QgcDJtX2RvbWFpbiAqcDJtLCB1bnNpZ25lZCBsb25nIGdmbl9sLAo+ID4KPiA+ICAgICAg
bWZuID0gcDJtLT5nZXRfZW50cnkocDJtLCBnZm4sIHQsIGEsIHEsIHBhZ2Vfb3JkZXIsIE5VTEwp
Owo+ID4KPiA+ICsgICAgLyogQ2hlY2sgaWYgd2UgbmVlZCB0byBmb3JrIHRoZSBwYWdlICovCj4g
PiArICAgIGlmICggKHEgJiBQMk1fQUxMT0MpICYmIHAybV9pc19ob2xlKCp0KSAmJgo+ID4gKyAg
ICAgICAgICFtZW1fc2hhcmluZ19mb3JrX3BhZ2UocDJtLT5kb21haW4sIGdmbiwgISEocSAmIFAy
TV9VTlNIQVJFKSkgKQo+ID4gKyAgICB7Cj4gPiArICAgICAgICBtZm4gPSBwMm0tPmdldF9lbnRy
eShwMm0sIGdmbiwgdCwgYSwgcSwgcGFnZV9vcmRlciwgTlVMTCk7Cj4gPiArICAgIH0KPgo+IE5v
IG5lZWQgZm9yIHRoZSBicmFjZXMuCgpJIHdvdWxkIGtlZXAgdGhlbSwgaXQgaGVscHMgd2l0aCBy
ZWFkYWJpbGl0eSBpbiB0aGlzIGNhc2UuCgpUYW1hcwoKX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxA
bGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFu
L2xpc3RpbmZvL3hlbi1kZXZlbA==

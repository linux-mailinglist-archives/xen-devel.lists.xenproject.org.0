Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 3058217A51
	for <lists+xen-devel@lfdr.de>; Wed,  8 May 2019 15:19:36 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hOMR1-0008Ft-OP; Wed, 08 May 2019 13:16:35 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=RDkG=TI=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1hOMR0-0008Fo-KN
 for xen-devel@lists.xenproject.org; Wed, 08 May 2019 13:16:34 +0000
X-Inumbo-ID: 7fa392aa-7193-11e9-843c-bc764e045a96
Received: from prv1-mh.provo.novell.com (unknown [137.65.248.33])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 7fa392aa-7193-11e9-843c-bc764e045a96;
 Wed, 08 May 2019 13:16:33 +0000 (UTC)
Received: from INET-PRV1-MTA by prv1-mh.provo.novell.com
 with Novell_GroupWise; Wed, 08 May 2019 07:16:32 -0600
Message-Id: <5CD2D6AD020000780022CDAC@prv1-mh.provo.novell.com>
X-Mailer: Novell GroupWise Internet Agent 18.1.0 
Date: Wed, 08 May 2019 07:16:29 -0600
From: "Jan Beulich" <JBeulich@suse.com>
To: "xen-devel" <xen-devel@lists.xenproject.org>
References: <5CC6DD090200007800229E80@prv1-mh.provo.novell.com>
 <5CD2D2C8020000780022CCF2@prv1-mh.provo.novell.com>
 <5CD2D563020000780022CD40@prv1-mh.provo.novell.com>
In-Reply-To: <5CD2D563020000780022CD40@prv1-mh.provo.novell.com>
Mime-Version: 1.0
Content-Disposition: inline
Subject: Re: [Xen-devel] [PATCH v2 07/12] x86/IRQ: fix locking around vector
 management
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>,
 Kevin Tian <kevin.tian@intel.com>, Wei Liu <wei.liu2@citrix.com>,
 Roger Pau Monne <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

Pj4+IE9uIDA4LjA1LjE5IGF0IDE1OjEwLCA8SkJldWxpY2hAc3VzZS5jb20+IHdyb3RlOgo+IEFs
bCBvZiBfX3thc3NpZ24sYmluZCxjbGVhcn1faXJxX3ZlY3RvcigpIG1hbmlwdWxhdGUgc3RydWN0
IGlycV9kZXNjCj4gZmllbGRzLCBhbmQgaGVuY2Ugb3VnaHQgdG8gYmUgY2FsbGVkIHdpdGggdGhl
IGRlc2NyaXB0b3IgbG9jayBoZWxkIGluCj4gYWRkaXRpb24gdG8gdmVjdG9yX2xvY2suIFRoaXMg
aXMgY3VycmVudGx5IHRoZSBjYXNlIGZvciBvbmx5Cj4gc2V0X2Rlc2NfYWZmaW5pdHkoKSAoaW4g
dGhlIGNvbW1vbiBjYXNlKSBhbmQgZGVzdHJveV9pcnEoKSwgd2hpY2ggYWxzbwo+IGNsYXJpZmll
cyB3aGF0IHRoZSBuZXN0aW5nIGJlaGF2aW9yIGJldHdlZW4gdGhlIGxvY2tzIGhhcyB0byBiZS4K
PiBSZWZsZWN0IHRoZSBuZXcgZXhwZWN0YXRpb24gYnkgaGF2aW5nIHRoZXNlIGZ1bmN0aW9ucyBh
bGwgdGFrZSBhCj4gZGVzY3JpcHRvciBhcyBwYXJhbWV0ZXIgaW5zdGVhZCBvZiBhbiBpbnRlcnJ1
cHQgbnVtYmVyLgo+IAo+IEFsc28gdGFrZSBjYXJlIG9mIHRoZSB0d28gc3BlY2lhbCBjYXNlcyBv
ZiBjYWxscyB0byBzZXRfZGVzY19hZmZpbml0eSgpOgo+IHNldF9pb2FwaWNfYWZmaW5pdHlfaXJx
KCkgYW5kIFZULWQncyBkbWFfbXNpX3NldF9hZmZpbml0eSgpIGdldCBjYWxsZWQKPiBkaXJlY3Rs
eSBhcyB3ZWxsLCBhbmQgaW4gdGhlc2UgY2FzZXMgdGhlIGRlc2NyaXB0b3IgbG9ja3MgaGFkbid0
IGdvdAo+IGFjcXVpcmVkIHRpbGwgbm93LiBGb3Igc2V0X2lvYXBpY19hZmZpbml0eV9pcnEoKSB0
aGlzIG1lYW5zIGFjcXVpcmluZyAvCj4gcmVsZWFzaW5nIG9mIHRoZSBJTy1BUElDIGxvY2sgY2Fu
IGJlIHBsYWluIHNwaW5feyx1bn1sb2NrKCkgdGhlbi4KPiAKPiBEcm9wIG9uZSBvZiB0aGUgdHdv
IGxlYWRpbmcgdW5kZXJzY29yZXMgZnJvbSBhbGwgdGhyZWUgZnVuY3Rpb25zIGF0Cj4gdGhlIHNh
bWUgdGltZS4KPiAKPiBUaGVyZSdzIG9uZSBjYXNlIGxlZnQgd2hlcmUgZGVzY3JpcHRvcnMgZ2V0
IG1hbmlwdWxhdGVkIHdpdGgganVzdAo+IHZlY3Rvcl9sb2NrIGhlbGQ6IHNldHVwX3ZlY3Rvcl9p
cnEoKSBhc3N1bWVzIGl0cyBjYWxsZXIgdG8gYWNxdWlyZQo+IHZlY3Rvcl9sb2NrLCBhbmQgaGVu
Y2UgY2FuJ3QgaXRzZWxmIGFjcXVpcmUgdGhlIGRlc2NyaXB0b3IgbG9ja3MgKHdyb25nCj4gbG9j
ayBvcmRlcikuIEkgZG9uJ3QgY3VycmVudGx5IHNlZSBob3cgdG8gYWRkcmVzcyB0aGlzLgo+IAo+
IFNpZ25lZC1vZmYtYnk6IEphbiBCZXVsaWNoIDxqYmV1bGljaEBzdXNlLmNvbT4KPiAtLS0KPiB2
MjogQWxzbyBhZGp1c3Qgc2V0X2lvYXBpY19hZmZpbml0eV9pcnEoKSBhbmQgVlQtZCdzCj4gICAg
IGRtYV9tc2lfc2V0X2FmZmluaXR5KCkuCgpJJ20gc29ycnksIEtldmluLCBJIHNob3VsZCBoYXZl
IENjLWVkIHlvdSBvbiB0aGlzIG9uZS4KCkphbgoKPiAtLS0gYS94ZW4vYXJjaC94ODYvaW9fYXBp
Yy5jCj4gKysrIGIveGVuL2FyY2gveDg2L2lvX2FwaWMuYwo+IEBAIC01NTAsMTQgKzU1MCwxNCBA
QCBzdGF0aWMgdm9pZCBjbGVhcl9JT19BUElDICh2b2lkKQo+ICBzdGF0aWMgdm9pZAo+ICBzZXRf
aW9hcGljX2FmZmluaXR5X2lycShzdHJ1Y3QgaXJxX2Rlc2MgKmRlc2MsIGNvbnN0IGNwdW1hc2tf
dCAqbWFzaykKPiAgewo+IC0gICAgdW5zaWduZWQgbG9uZyBmbGFnczsKPiAgICAgIHVuc2lnbmVk
IGludCBkZXN0Owo+ICAgICAgaW50IHBpbiwgaXJxOwo+ICAgICAgc3RydWN0IGlycV9waW5fbGlz
dCAqZW50cnk7Cj4gIAo+ICAgICAgaXJxID0gZGVzYy0+aXJxOwo+ICAKPiAtICAgIHNwaW5fbG9j
a19pcnFzYXZlKCZpb2FwaWNfbG9jaywgZmxhZ3MpOwo+ICsgICAgc3Bpbl9sb2NrKCZpb2FwaWNf
bG9jayk7Cj4gKwo+ICAgICAgZGVzdCA9IHNldF9kZXNjX2FmZmluaXR5KGRlc2MsIG1hc2spOwo+
ICAgICAgaWYgKGRlc3QgIT0gQkFEX0FQSUNJRCkgewo+ICAgICAgICAgIGlmICggIXgyYXBpY19l
bmFibGVkICkKPiBAQCAtNTgwLDggKzU4MCw4IEBAIHNldF9pb2FwaWNfYWZmaW5pdHlfaXJxKHN0
cnVjdCBpcnFfZGVzYwo+ICAgICAgICAgICAgICBlbnRyeSA9IGlycV8yX3BpbiArIGVudHJ5LT5u
ZXh0Owo+ICAgICAgICAgIH0KPiAgICAgIH0KPiAtICAgIHNwaW5fdW5sb2NrX2lycXJlc3RvcmUo
JmlvYXBpY19sb2NrLCBmbGFncyk7Cj4gIAo+ICsgICAgc3Bpbl91bmxvY2soJmlvYXBpY19sb2Nr
KTsKPiAgfQo+ICAKPiAgLyoKPiBAQCAtNjc0LDE2ICs2NzQsMTkgQEAgdm9pZCAvKl9faW5pdCov
IHNldHVwX2lvYXBpY19kZXN0KHZvaWQpCj4gICAgICBmb3IgKGlvYXBpYyA9IDA7IGlvYXBpYyA8
IG5yX2lvYXBpY3M7IGlvYXBpYysrKSB7Cj4gICAgICAgICAgZm9yIChwaW4gPSAwOyBwaW4gPCBu
cl9pb2FwaWNfZW50cmllc1tpb2FwaWNdOyBwaW4rKykgewo+ICAgICAgICAgICAgICBzdHJ1Y3Qg
aXJxX2Rlc2MgKmRlc2M7Cj4gKyAgICAgICAgICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7Cj4gIAo+
ICAgICAgICAgICAgICBpcnFfZW50cnkgPSBmaW5kX2lycV9lbnRyeShpb2FwaWMsIHBpbiwgbXBf
SU5UKTsKPiAgICAgICAgICAgICAgaWYgKGlycV9lbnRyeSA9PSAtMSkKPiAgICAgICAgICAgICAg
ICAgIGNvbnRpbnVlOwo+ICAgICAgICAgICAgICBpcnEgPSBwaW5fMl9pcnEoaXJxX2VudHJ5LCBp
b2FwaWMsIHBpbik7Cj4gICAgICAgICAgICAgIGRlc2MgPSBpcnFfdG9fZGVzYyhpcnEpOwo+ICsK
PiArICAgICAgICAgICAgc3Bpbl9sb2NrX2lycXNhdmUoJmRlc2MtPmxvY2ssIGZsYWdzKTsKPiAg
ICAgICAgICAgICAgQlVHX09OKCFjcHVtYXNrX2ludGVyc2VjdHMoZGVzYy0+YXJjaC5jcHVfbWFz
aywgCj4gJmNwdV9vbmxpbmVfbWFwKSk7Cj4gICAgICAgICAgICAgIHNldF9pb2FwaWNfYWZmaW5p
dHlfaXJxKGRlc2MsIGRlc2MtPmFyY2guY3B1X21hc2spOwo+ICsgICAgICAgICAgICBzcGluX3Vu
bG9ja19pcnFyZXN0b3JlKCZkZXNjLT5sb2NrLCBmbGFncyk7Cj4gICAgICAgICAgfQo+IC0KPiAg
ICAgIH0KPiAgfQo+ICAKPiAtLS0gYS94ZW4vYXJjaC94ODYvaXJxLmMKPiArKysgYi94ZW4vYXJj
aC94ODYvaXJxLmMKPiBAQCAtMjcsNiArMjcsNyBAQAo+ICAjaW5jbHVkZSA8cHVibGljL3BoeXNk
ZXYuaD4KPiAgCj4gIHN0YXRpYyBpbnQgcGFyc2VfaXJxX3ZlY3Rvcl9tYXBfcGFyYW0oY29uc3Qg
Y2hhciAqcyk7Cj4gK3N0YXRpYyB2b2lkIF9jbGVhcl9pcnFfdmVjdG9yKHN0cnVjdCBpcnFfZGVz
YyAqZGVzYyk7Cj4gIAo+ICAvKiBvcHRfbm9pcnFiYWxhbmNlOiBJZiB0cnVlLCBzb2Z0d2FyZSBJ
UlEgYmFsYW5jaW5nL2FmZmluaXR5IGlzIGRpc2FibGVkLiAKPiAqLwo+ICBib29sIF9fcmVhZF9t
b3N0bHkgb3B0X25vaXJxYmFsYW5jZTsKPiBAQCAtMTIwLDEzICsxMjEsMTIgQEAgc3RhdGljIHZv
aWQgdHJhY2VfaXJxX21hc2sodWludDMyX3QgZXZlbgo+ICAgICAgdHJhY2VfdmFyKGV2ZW50LCAx
LCBzaXplb2YoZCksICZkKTsKPiAgfQo+ICAKPiAtc3RhdGljIGludCBfX2luaXQgX19iaW5kX2ly
cV92ZWN0b3IoaW50IGlycSwgaW50IHZlY3RvciwgY29uc3QgY3B1bWFza190IAo+ICpjcHVfbWFz
aykKPiArc3RhdGljIGludCBfX2luaXQgX2JpbmRfaXJxX3ZlY3RvcihzdHJ1Y3QgaXJxX2Rlc2Mg
KmRlc2MsIGludCB2ZWN0b3IsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
Y29uc3QgY3B1bWFza190ICpjcHVfbWFzaykKPiAgewo+ICAgICAgY3B1bWFza190IG9ubGluZV9t
YXNrOwo+ICAgICAgaW50IGNwdTsKPiAtICAgIHN0cnVjdCBpcnFfZGVzYyAqZGVzYyA9IGlycV90
b19kZXNjKGlycSk7Cj4gIAo+IC0gICAgQlVHX09OKCh1bnNpZ25lZClpcnEgPj0gbnJfaXJxcyk7
Cj4gICAgICBCVUdfT04oKHVuc2lnbmVkKXZlY3RvciA+PSBOUl9WRUNUT1JTKTsKPiAgCj4gICAg
ICBjcHVtYXNrX2FuZCgmb25saW5lX21hc2ssIGNwdV9tYXNrLCAmY3B1X29ubGluZV9tYXApOwo+
IEBAIC0xMzcsOSArMTM3LDkgQEAgc3RhdGljIGludCBfX2luaXQgX19iaW5kX2lycV92ZWN0b3Io
aW50Cj4gICAgICAgICAgcmV0dXJuIDA7Cj4gICAgICBpZiAoIGRlc2MtPmFyY2gudmVjdG9yICE9
IElSUV9WRUNUT1JfVU5BU1NJR05FRCApCj4gICAgICAgICAgcmV0dXJuIC1FQlVTWTsKPiAtICAg
IHRyYWNlX2lycV9tYXNrKFRSQ19IV19JUlFfQklORF9WRUNUT1IsIGlycSwgdmVjdG9yLCAmb25s
aW5lX21hc2spOwo+ICsgICAgdHJhY2VfaXJxX21hc2soVFJDX0hXX0lSUV9CSU5EX1ZFQ1RPUiwg
ZGVzYy0+aXJxLCB2ZWN0b3IsICZvbmxpbmVfbWFzayk7Cj4gICAgICBmb3JfZWFjaF9jcHUoY3B1
LCAmb25saW5lX21hc2spCj4gLSAgICAgICAgcGVyX2NwdSh2ZWN0b3JfaXJxLCBjcHUpW3ZlY3Rv
cl0gPSBpcnE7Cj4gKyAgICAgICAgcGVyX2NwdSh2ZWN0b3JfaXJxLCBjcHUpW3ZlY3Rvcl0gPSBk
ZXNjLT5pcnE7Cj4gICAgICBkZXNjLT5hcmNoLnZlY3RvciA9IHZlY3RvcjsKPiAgICAgIGNwdW1h
c2tfY29weShkZXNjLT5hcmNoLmNwdV9tYXNrLCAmb25saW5lX21hc2spOwo+ICAgICAgaWYgKCBk
ZXNjLT5hcmNoLnVzZWRfdmVjdG9ycyApCj4gQEAgLTE1MywxMiArMTUzLDE4IEBAIHN0YXRpYyBp
bnQgX19pbml0IF9fYmluZF9pcnFfdmVjdG9yKGludAo+ICAKPiAgaW50IF9faW5pdCBiaW5kX2ly
cV92ZWN0b3IoaW50IGlycSwgaW50IHZlY3RvciwgY29uc3QgY3B1bWFza190ICpjcHVfbWFzaykK
PiAgewo+ICsgICAgc3RydWN0IGlycV9kZXNjICpkZXNjID0gaXJxX3RvX2Rlc2MoaXJxKTsKPiAg
ICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7Cj4gICAgICBpbnQgcmV0Owo+ICAKPiAtICAgIHNwaW5f
bG9ja19pcnFzYXZlKCZ2ZWN0b3JfbG9jaywgZmxhZ3MpOwo+IC0gICAgcmV0ID0gX19iaW5kX2ly
cV92ZWN0b3IoaXJxLCB2ZWN0b3IsIGNwdV9tYXNrKTsKPiAtICAgIHNwaW5fdW5sb2NrX2lycXJl
c3RvcmUoJnZlY3Rvcl9sb2NrLCBmbGFncyk7Cj4gKyAgICBCVUdfT04oKHVuc2lnbmVkKWlycSA+
PSBucl9pcnFzKTsKPiArCj4gKyAgICBzcGluX2xvY2tfaXJxc2F2ZSgmZGVzYy0+bG9jaywgZmxh
Z3MpOwo+ICsgICAgc3Bpbl9sb2NrKCZ2ZWN0b3JfbG9jayk7Cj4gKyAgICByZXQgPSBfYmluZF9p
cnFfdmVjdG9yKGRlc2MsIHZlY3RvciwgY3B1X21hc2spOwo+ICsgICAgc3Bpbl91bmxvY2soJnZl
Y3Rvcl9sb2NrKTsKPiArICAgIHNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmRlc2MtPmxvY2ssIGZs
YWdzKTsKPiArCj4gICAgICByZXR1cm4gcmV0Owo+ICB9Cj4gIAo+IEBAIC0yNDMsNyArMjQ5LDkg
QEAgdm9pZCBkZXN0cm95X2lycSh1bnNpZ25lZCBpbnQgaXJxKQo+ICAKPiAgICAgIHNwaW5fbG9j
a19pcnFzYXZlKCZkZXNjLT5sb2NrLCBmbGFncyk7Cj4gICAgICBkZXNjLT5oYW5kbGVyID0gJm5v
X2lycV90eXBlOwo+IC0gICAgY2xlYXJfaXJxX3ZlY3RvcihpcnEpOwo+ICsgICAgc3Bpbl9sb2Nr
KCZ2ZWN0b3JfbG9jayk7Cj4gKyAgICBfY2xlYXJfaXJxX3ZlY3RvcihkZXNjKTsKPiArICAgIHNw
aW5fdW5sb2NrKCZ2ZWN0b3JfbG9jayk7Cj4gICAgICBkZXNjLT5hcmNoLnVzZWRfdmVjdG9ycyA9
IE5VTEw7Cj4gICAgICBzcGluX3VubG9ja19pcnFyZXN0b3JlKCZkZXNjLT5sb2NrLCBmbGFncyk7
Cj4gIAo+IEBAIC0yNjYsMTEgKzI3NCwxMSBAQCBzdGF0aWMgdm9pZCByZWxlYXNlX29sZF92ZWMo
c3RydWN0IGlycV9kCj4gICAgICB9Cj4gIH0KPiAgCj4gLXN0YXRpYyB2b2lkIF9fY2xlYXJfaXJx
X3ZlY3RvcihpbnQgaXJxKQo+ICtzdGF0aWMgdm9pZCBfY2xlYXJfaXJxX3ZlY3RvcihzdHJ1Y3Qg
aXJxX2Rlc2MgKmRlc2MpCj4gIHsKPiAtICAgIGludCBjcHUsIHZlY3Rvciwgb2xkX3ZlY3RvcjsK
PiArICAgIHVuc2lnbmVkIGludCBjcHU7Cj4gKyAgICBpbnQgdmVjdG9yLCBvbGRfdmVjdG9yLCBp
cnEgPSBkZXNjLT5pcnE7Cj4gICAgICBjcHVtYXNrX3QgdG1wX21hc2s7Cj4gLSAgICBzdHJ1Y3Qg
aXJxX2Rlc2MgKmRlc2MgPSBpcnFfdG9fZGVzYyhpcnEpOwo+ICAKPiAgICAgIEJVR19PTighZGVz
Yy0+YXJjaC52ZWN0b3IpOwo+ICAKPiBAQCAtMzE2LDExICszMjQsMTQgQEAgc3RhdGljIHZvaWQg
X19jbGVhcl9pcnFfdmVjdG9yKGludCBpcnEpCj4gIAo+ICB2b2lkIGNsZWFyX2lycV92ZWN0b3Io
aW50IGlycSkKPiAgewo+ICsgICAgc3RydWN0IGlycV9kZXNjICpkZXNjID0gaXJxX3RvX2Rlc2Mo
aXJxKTsKPiAgICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7Cj4gIAo+IC0gICAgc3Bpbl9sb2NrX2ly
cXNhdmUoJnZlY3Rvcl9sb2NrLCBmbGFncyk7Cj4gLSAgICBfX2NsZWFyX2lycV92ZWN0b3IoaXJx
KTsKPiAtICAgIHNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnZlY3Rvcl9sb2NrLCBmbGFncyk7Cj4g
KyAgICBzcGluX2xvY2tfaXJxc2F2ZSgmZGVzYy0+bG9jaywgZmxhZ3MpOwo+ICsgICAgc3Bpbl9s
b2NrKCZ2ZWN0b3JfbG9jayk7Cj4gKyAgICBfY2xlYXJfaXJxX3ZlY3RvcihkZXNjKTsKPiArICAg
IHNwaW5fdW5sb2NrKCZ2ZWN0b3JfbG9jayk7Cj4gKyAgICBzcGluX3VubG9ja19pcnFyZXN0b3Jl
KCZkZXNjLT5sb2NrLCBmbGFncyk7Cj4gIH0KPiAgCj4gIGludCBpcnFfdG9fdmVjdG9yKGludCBp
cnEpCj4gQEAgLTQ1NSw4ICs0NjYsNyBAQCBzdGF0aWMgdm1hc2tfdCAqaXJxX2dldF91c2VkX3Zl
Y3Rvcl9tYXNrCj4gICAgICByZXR1cm4gcmV0Owo+ICB9Cj4gIAo+IC1zdGF0aWMgaW50IF9fYXNz
aWduX2lycV92ZWN0b3IoCj4gLSAgICBpbnQgaXJxLCBzdHJ1Y3QgaXJxX2Rlc2MgKmRlc2MsIGNv
bnN0IGNwdW1hc2tfdCAqbWFzaykKPiArc3RhdGljIGludCBfYXNzaWduX2lycV92ZWN0b3Ioc3Ry
dWN0IGlycV9kZXNjICpkZXNjLCBjb25zdCBjcHVtYXNrX3QgKm1hc2spCj4gIHsKPiAgICAgIC8q
Cj4gICAgICAgKiBOT1RFISBUaGUgbG9jYWwgQVBJQyBpc24ndCB2ZXJ5IGdvb2QgYXQgaGFuZGxp
bmcKPiBAQCAtNDcwLDcgKzQ4MCw4IEBAIHN0YXRpYyBpbnQgX19hc3NpZ25faXJxX3ZlY3RvcigK
PiAgICAgICAqIDB4ODAsIGJlY2F1c2UgaW50IDB4ODAgaXMgaG0sIGtpbmQgb2YgaW1wb3J0YW50
aXNoLiA7KQo+ICAgICAgICovCj4gICAgICBzdGF0aWMgaW50IGN1cnJlbnRfdmVjdG9yID0gRklS
U1RfRFlOQU1JQ19WRUNUT1IsIGN1cnJlbnRfb2Zmc2V0ID0gMDsKPiAtICAgIGludCBjcHUsIGVy
ciwgb2xkX3ZlY3RvcjsKPiArICAgIHVuc2lnbmVkIGludCBjcHU7Cj4gKyAgICBpbnQgZXJyLCBv
bGRfdmVjdG9yLCBpcnEgPSBkZXNjLT5pcnE7Cj4gICAgICB2bWFza190ICppcnFfdXNlZF92ZWN0
b3JzID0gTlVMTDsKPiAgCj4gICAgICBvbGRfdmVjdG9yID0gaXJxX3RvX3ZlY3RvcihpcnEpOwo+
IEBAIC01ODMsOCArNTk0LDEyIEBAIGludCBhc3NpZ25faXJxX3ZlY3RvcihpbnQgaXJxLCBjb25z
dCBjcHUKPiAgICAgIAo+ICAgICAgQlVHX09OKGlycSA+PSBucl9pcnFzIHx8IGlycSA8MCk7Cj4g
IAo+IC0gICAgc3Bpbl9sb2NrX2lycXNhdmUoJnZlY3Rvcl9sb2NrLCBmbGFncyk7Cj4gLSAgICBy
ZXQgPSBfX2Fzc2lnbl9pcnFfdmVjdG9yKGlycSwgZGVzYywgbWFzayA/OiBUQVJHRVRfQ1BVUyk7
Cj4gKyAgICBzcGluX2xvY2tfaXJxc2F2ZSgmZGVzYy0+bG9jaywgZmxhZ3MpOwo+ICsKPiArICAg
IHNwaW5fbG9jaygmdmVjdG9yX2xvY2spOwo+ICsgICAgcmV0ID0gX2Fzc2lnbl9pcnFfdmVjdG9y
KGRlc2MsIG1hc2sgPzogVEFSR0VUX0NQVVMpOwo+ICsgICAgc3Bpbl91bmxvY2soJnZlY3Rvcl9s
b2NrKTsKPiArCj4gICAgICBpZiAoICFyZXQgKQo+ICAgICAgewo+ICAgICAgICAgIHJldCA9IGRl
c2MtPmFyY2gudmVjdG9yOwo+IEBAIC01OTMsNyArNjA4LDggQEAgaW50IGFzc2lnbl9pcnFfdmVj
dG9yKGludCBpcnEsIGNvbnN0IGNwdQo+ICAgICAgICAgIGVsc2UKPiAgICAgICAgICAgICAgY3B1
bWFza19zZXRhbGwoZGVzYy0+YWZmaW5pdHkpOwo+ICAgICAgfQo+IC0gICAgc3Bpbl91bmxvY2tf
aXJxcmVzdG9yZSgmdmVjdG9yX2xvY2ssIGZsYWdzKTsKPiArCj4gKyAgICBzcGluX3VubG9ja19p
cnFyZXN0b3JlKCZkZXNjLT5sb2NrLCBmbGFncyk7Cj4gIAo+ICAgICAgcmV0dXJuIHJldDsKPiAg
fQo+IEBAIC03NjcsNyArNzgzLDYgQEAgdm9pZCBpcnFfY29tcGxldGVfbW92ZShzdHJ1Y3QgaXJx
X2Rlc2MgKgo+ICAKPiAgdW5zaWduZWQgaW50IHNldF9kZXNjX2FmZmluaXR5KHN0cnVjdCBpcnFf
ZGVzYyAqZGVzYywgY29uc3QgY3B1bWFza190IAo+ICptYXNrKQo+ICB7Cj4gLSAgICB1bnNpZ25l
ZCBpbnQgaXJxOwo+ICAgICAgaW50IHJldDsKPiAgICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7Cj4g
ICAgICBjcHVtYXNrX3QgZGVzdF9tYXNrOwo+IEBAIC03NzUsMTAgKzc5MCw4IEBAIHVuc2lnbmVk
IGludCBzZXRfZGVzY19hZmZpbml0eShzdHJ1Y3QgaXIKPiAgICAgIGlmICghY3B1bWFza19pbnRl
cnNlY3RzKG1hc2ssICZjcHVfb25saW5lX21hcCkpCj4gICAgICAgICAgcmV0dXJuIEJBRF9BUElD
SUQ7Cj4gIAo+IC0gICAgaXJxID0gZGVzYy0+aXJxOwo+IC0KPiAgICAgIHNwaW5fbG9ja19pcnFz
YXZlKCZ2ZWN0b3JfbG9jaywgZmxhZ3MpOwo+IC0gICAgcmV0ID0gX19hc3NpZ25faXJxX3ZlY3Rv
cihpcnEsIGRlc2MsIG1hc2spOwo+ICsgICAgcmV0ID0gX2Fzc2lnbl9pcnFfdmVjdG9yKGRlc2Ms
IG1hc2spOwo+ICAgICAgc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmdmVjdG9yX2xvY2ssIGZsYWdz
KTsKPiAgCj4gICAgICBpZiAocmV0IDwgMCkKPiAtLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3Vn
aC92dGQvaW9tbXUuYwo+ICsrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9pb21tdS5j
Cj4gQEAgLTIxMzQsMTEgKzIxMzQsMTYgQEAgc3RhdGljIHZvaWQgYWRqdXN0X2lycV9hZmZpbml0
eShzdHJ1Y3QgYQo+ICAgICAgdW5zaWduZWQgaW50IG5vZGUgPSByaHNhID8gcHhtX3RvX25vZGUo
cmhzYS0+cHJveGltaXR5X2RvbWFpbikKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6
IE5VTUFfTk9fTk9ERTsKPiAgICAgIGNvbnN0IGNwdW1hc2tfdCAqY3B1bWFzayA9ICZjcHVfb25s
aW5lX21hcDsKPiArICAgIHN0cnVjdCBpcnFfZGVzYyAqZGVzYzsKPiAgCj4gICAgICBpZiAoIG5v
ZGUgPCBNQVhfTlVNTk9ERVMgJiYgbm9kZV9vbmxpbmUobm9kZSkgJiYKPiAgICAgICAgICAgY3B1
bWFza19pbnRlcnNlY3RzKCZub2RlX3RvX2NwdW1hc2sobm9kZSksIGNwdW1hc2spICkKPiAgICAg
ICAgICBjcHVtYXNrID0gJm5vZGVfdG9fY3B1bWFzayhub2RlKTsKPiAtICAgIGRtYV9tc2lfc2V0
X2FmZmluaXR5KGlycV90b19kZXNjKGRyaGQtPmlvbW11LT5tc2kuaXJxKSwgY3B1bWFzayk7Cj4g
Kwo+ICsgICAgZGVzYyA9IGlycV90b19kZXNjKGRyaGQtPmlvbW11LT5tc2kuaXJxKTsKPiArICAg
IHNwaW5fbG9ja19pcnEoJmRlc2MtPmxvY2spOwo+ICsgICAgZG1hX21zaV9zZXRfYWZmaW5pdHko
ZGVzYywgY3B1bWFzayk7Cj4gKyAgICBzcGluX3VubG9ja19pcnEoJmRlc2MtPmxvY2spOwo+ICB9
Cj4gIAo+ICBzdGF0aWMgaW50IGFkanVzdF92dGRfaXJxX2FmZmluaXRpZXModm9pZCkKPiAKCgoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVs
IG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0
cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

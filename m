Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id C1C02A1999
	for <lists+xen-devel@lfdr.de>; Thu, 29 Aug 2019 14:08:45 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i3JCO-0005iG-Ca; Thu, 29 Aug 2019 12:06:44 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=C/xl=WZ=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1i3JCM-0005iB-62
 for xen-devel@lists.xenproject.org; Thu, 29 Aug 2019 12:06:42 +0000
X-Inumbo-ID: 75663ffc-ca55-11e9-b95f-bc764e2007e4
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 75663ffc-ca55-11e9-b95f-bc764e2007e4;
 Thu, 29 Aug 2019 12:06:40 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id DBD5AAE2C;
 Thu, 29 Aug 2019 12:06:39 +0000 (UTC)
To: Chao Gao <chao.gao@intel.com>
References: <1566177928-19114-1-git-send-email-chao.gao@intel.com>
 <1566177928-19114-14-git-send-email-chao.gao@intel.com>
From: Jan Beulich <jbeulich@suse.com>
Message-ID: <2441e448-5fe1-bdbc-f0b6-720401fd0bf0@suse.com>
Date: Thu, 29 Aug 2019 14:06:39 +0200
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:60.0) Gecko/20100101
 Thunderbird/60.8.0
MIME-Version: 1.0
In-Reply-To: <1566177928-19114-14-git-send-email-chao.gao@intel.com>
Content-Language: en-US
Subject: Re: [Xen-devel] [PATCH v9 13/15] x86/microcode: Synchronize late
 microcode loading
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Kevin Tian <kevin.tian@intel.com>, Ashok Raj <ashok.raj@intel.com>,
 Wei Liu <wl@xen.org>, Andrew Cooper <andrew.cooper3@citrix.com>,
 Jun Nakajima <jun.nakajima@intel.com>, xen-devel@lists.xenproject.org,
 Thomas Gleixner <tglx@linutronix.de>, Borislav Petkov <bp@suse.de>,
 =?UTF-8?Q?Roger_Pau_Monn=c3=a9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

T24gMTkuMDguMjAxOSAwMzoyNSwgQ2hhbyBHYW8gd3JvdGU6Cj4gQEAgLTIzMiw2ICsyNzYsMzQg
QEAgYm9vbCBtaWNyb2NvZGVfdXBkYXRlX2NhY2hlKHN0cnVjdCBtaWNyb2NvZGVfcGF0Y2ggKnBh
dGNoKQo+ICAgICAgcmV0dXJuIHRydWU7Cj4gIH0KPiAgCj4gKy8qIFdhaXQgZm9yIGEgY29uZGl0
aW9uIHRvIGJlIG1ldCB3aXRoIGEgdGltZW91dCAodXMpLiAqLwo+ICtzdGF0aWMgaW50IHdhaXRf
Zm9yX2NvbmRpdGlvbihpbnQgKCpmdW5jKSh2b2lkICpkYXRhKSwgdm9pZCAqZGF0YSwKPiArICAg
ICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCB0aW1lb3V0KQo+ICt7Cj4gKyAgICB3
aGlsZSAoICFmdW5jKGRhdGEpICkKPiArICAgIHsKPiArICAgICAgICBpZiAoICF0aW1lb3V0LS0g
KQo+ICsgICAgICAgIHsKPiArICAgICAgICAgICAgcHJpbnRrKCJDUFUldTogVGltZW91dCBpbiAl
cFNcbiIsCj4gKyAgICAgICAgICAgICAgICAgICBzbXBfcHJvY2Vzc29yX2lkKCksIF9fYnVpbHRp
bl9yZXR1cm5fYWRkcmVzcygwKSk7Cj4gKyAgICAgICAgICAgIHJldHVybiAtRUJVU1k7Cj4gKyAg
ICAgICAgfQo+ICsgICAgICAgIHVkZWxheSgxKTsKPiArICAgIH0KPiArCj4gKyAgICByZXR1cm4g
MDsKPiArfQo+ICsKPiArc3RhdGljIGludCB3YWl0X2NwdV9jYWxsaW4odm9pZCAqbnIpCj4gK3sK
PiArICAgIHJldHVybiBjcHVtYXNrX3dlaWdodCgmY3B1X2NhbGxpbl9tYXApID49ICh1bnNpZ25l
ZCBsb25nKW5yOwo+ICt9Cj4gKwo+ICtzdGF0aWMgaW50IHdhaXRfY3B1X2NhbGxvdXQodm9pZCAq
bnIpCj4gK3sKPiArICAgIHJldHVybiBhdG9taWNfcmVhZCgmY3B1X291dCkgPj0gKHVuc2lnbmVk
IGxvbmcpbnI7Cj4gK30KClNpbmNlIHdhaXRfZm9yX2NvbmRpdGlvbigpIGlzIHVzZWQgd2l0aCBv
bmx5IHRoZXNlIHR3byBmdW5jdGlvbnMKYXMgY2FsbGJhY2tzLCB0aGV5IHNob3VsZCBpbW8gcmV0
dXJuIGJvb2wgYW5kIHRha2UgY29uc3Qgdm9pZCAqLgoKPiBAQCAtMjY1LDM3ICszMzcsMTU1IEBA
IHN0YXRpYyBpbnQgbWljcm9jb2RlX3VwZGF0ZV9jcHUoY29uc3Qgc3RydWN0IG1pY3JvY29kZV9w
YXRjaCAqcGF0Y2gpCj4gICAgICByZXR1cm4gZXJyOwo+ICB9Cj4gIAo+IC1zdGF0aWMgbG9uZyBk
b19taWNyb2NvZGVfdXBkYXRlKHZvaWQgKnBhdGNoKQo+ICtzdGF0aWMgaW50IHNsYXZlX3RocmVh
ZF9mbih2b2lkKQo+ICt7Cj4gKyAgICB1bnNpZ25lZCBpbnQgY3B1ID0gc21wX3Byb2Nlc3Nvcl9p
ZCgpOwo+ICsgICAgdW5zaWduZWQgaW50IG1hc3RlciA9IGNwdW1hc2tfZmlyc3QodGhpc19jcHUo
Y3B1X3NpYmxpbmdfbWFzaykpOwo+ICsKPiArICAgIHdoaWxlICggbG9hZGluZ19zdGF0ZSAhPSBM
T0FESU5HX0NBTExJTiApCj4gKyAgICAgICAgY3B1X3JlbGF4KCk7Cj4gKwo+ICsgICAgY3B1bWFz
a19zZXRfY3B1KGNwdSwgJmNwdV9jYWxsaW5fbWFwKTsKPiArCj4gKyAgICB3aGlsZSAoIGxvYWRp
bmdfc3RhdGUgIT0gTE9BRElOR19FWElUICkKPiArICAgICAgICBjcHVfcmVsYXgoKTsKPiArCj4g
KyAgICAvKiBDb3B5IHVwZGF0ZSByZXZpc2lvbiBmcm9tIHRoZSAibWFzdGVyIiB0aHJlYWQuICov
Cj4gKyAgICB0aGlzX2NwdShjcHVfc2lnKS5yZXYgPSBwZXJfY3B1KGNwdV9zaWcsIG1hc3Rlciku
cmV2Owo+ICsKPiArICAgIHJldHVybiAwOwo+ICt9Cj4gKwo+ICtzdGF0aWMgaW50IG1hc3Rlcl90
aHJlYWRfZm4oY29uc3Qgc3RydWN0IG1pY3JvY29kZV9wYXRjaCAqcGF0Y2gpCj4gK3sKPiArICAg
IHVuc2lnbmVkIGludCBjcHUgPSBzbXBfcHJvY2Vzc29yX2lkKCk7Cj4gKyAgICBpbnQgcmV0ID0g
MDsKPiArCj4gKyAgICB3aGlsZSAoIGxvYWRpbmdfc3RhdGUgIT0gTE9BRElOR19DQUxMSU4gKQo+
ICsgICAgICAgIGNwdV9yZWxheCgpOwo+ICsKPiArICAgIGNwdW1hc2tfc2V0X2NwdShjcHUsICZj
cHVfY2FsbGluX21hcCk7Cj4gKwo+ICsgICAgd2hpbGUgKCBsb2FkaW5nX3N0YXRlICE9IExPQURJ
TkdfRU5URVIgKQo+ICsgICAgICAgIGNwdV9yZWxheCgpOwo+ICsKPiArICAgIC8qCj4gKyAgICAg
KiBJZiBhbiBlcnJvciBoYXBwZW5lZCwgY29udHJvbCB0aHJlYWQgd291bGQgc2V0ICdsb2FkaW5n
X3N0YXRlJwo+ICsgICAgICogdG8gTE9BRElOR19FWElULiBEb24ndCBwZXJmb3JtIHVjb2RlIGxv
YWRpbmcgZm9yIHRoaXMgY2FzZQo+ICsgICAgICovCj4gKyAgICBpZiAoIGxvYWRpbmdfc3RhdGUg
PT0gTE9BRElOR19FWElUICkKPiArICAgICAgICByZXR1cm4gcmV0OwoKRXZlbiBpZiB0aGUgcHJv
ZHVjZXIgdHJhbnNpdGlvbnMgdGhpcyB0aHJvdWdoIEVOVEVSIHRvIEVYSVQsIHRoZQpvYnNlcnZl
ciBoZXJlIG1heSBuZXZlciBnZXQgdG8gc2VlIHRoZSBFTlRFUiBzdGF0ZSwgYW5kIGhlbmNlCm5l
dmVyIGV4aXQgdGhlIGxvb3AgYWJvdmUuIFlvdSB3YW50IGVpdGhlciA8IEVOVEVSIG9yID09IENB
TExJTi4KCj4gKyAgICByZXQgPSBtaWNyb2NvZGVfb3BzLT5hcHBseV9taWNyb2NvZGUocGF0Y2gp
Owo+ICsgICAgaWYgKCAhcmV0ICkKPiArICAgICAgICBhdG9taWNfaW5jKCZjcHVfdXBkYXRlZCk7
Cj4gKyAgICBhdG9taWNfaW5jKCZjcHVfb3V0KTsKPiArCj4gKyAgICB3aGlsZSAoIGxvYWRpbmdf
c3RhdGUgIT0gTE9BRElOR19FWElUICkKPiArICAgICAgICBjcHVfcmVsYXgoKTsKPiArCj4gKyAg
ICByZXR1cm4gcmV0Owo+ICt9CgpBcyBhIGNvc21ldGljIHJlbWFyaywgSSBkb24ndCB0aGluayAi
bWFzdGVyIiBhbmQgInNsYXZlIiBhcmUKc3VpdGFibGUgdGVybXMgaGVyZS4gInByaW1hcnkiIGFu
ZCAic2Vjb25kYXJ5IiB3b3VsZCBpbW8gY29tZQpjbG9zZXIgdG8gd2hhdCB0aGUgdGhyZWFkcycg
cmVsYXRpb25zaGlwIGlzLgoKPiArc3RhdGljIGludCBjb250cm9sX3RocmVhZF9mbihjb25zdCBz
dHJ1Y3QgbWljcm9jb2RlX3BhdGNoICpwYXRjaCkKPiAgewo+IC0gICAgdW5zaWduZWQgaW50IGNw
dTsKPiArICAgIHVuc2lnbmVkIGludCBjcHUgPSBzbXBfcHJvY2Vzc29yX2lkKCksIGRvbmU7Cj4g
KyAgICB1bnNpZ25lZCBsb25nIHRpY2s7Cj4gKyAgICBpbnQgcmV0Owo+ICAKPiAtICAgIC8qIFN0
b3JlIHRoZSBwYXRjaCBhZnRlciBhIHN1Y2Nlc3NmdWwgbG9hZGluZyAqLwo+IC0gICAgaWYgKCAh
bWljcm9jb2RlX3VwZGF0ZV9jcHUocGF0Y2gpICYmIHBhdGNoICkKPiArICAgIC8qIEFsbG93IHRo
cmVhZHMgdG8gY2FsbCBpbiAqLwo+ICsgICAgbG9hZGluZ19zdGF0ZSA9IExPQURJTkdfQ0FMTElO
Owo+ICsgICAgc21wX21iKCk7CgpXaHkgbm90IGp1c3Qgc21wX3dtYigpPyAoU2FtZSBmdXJ0aGVy
IGRvd24gdGhlbi4pCgo+ICsgICAgY3B1bWFza19zZXRfY3B1KGNwdSwgJmNwdV9jYWxsaW5fbWFw
KTsKPiArCj4gKyAgICAvKiBXYWl0aW5nIGZvciBhbGwgdGhyZWFkcyBjYWxsaW5nIGluICovCj4g
KyAgICByZXQgPSB3YWl0X2Zvcl9jb25kaXRpb24od2FpdF9jcHVfY2FsbGluLAo+ICsgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICh2b2lkICopKHVuc2lnbmVkIGxvbmcpbnVtX29ubGluZV9j
cHVzKCksCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTUlDUk9DT0RFX0NBTExJTl9U
SU1FT1VUX1VTKTsKPiArICAgIGlmICggcmV0ICkgewoKTWlzcGxhY2VkIGJyYWNlLgoKPiArc3Rh
dGljIGludCBkb19taWNyb2NvZGVfdXBkYXRlKHZvaWQgKnBhdGNoKQoKY29uc3Q/Cgo+IEBAIC0z
MjYsMTkgKzUyMyw2NyBAQCBpbnQgbWljcm9jb2RlX3VwZGF0ZShYRU5fR1VFU1RfSEFORExFX1BB
UkFNKGNvbnN0X3ZvaWQpIGJ1ZiwgdW5zaWduZWQgbG9uZyBsZW4pCj4gICAgICB7Cj4gICAgICAg
ICAgcmV0ID0gUFRSX0VSUihwYXRjaCk7Cj4gICAgICAgICAgcHJpbnRrKFhFTkxPR19JTkZPICJQ
YXJzaW5nIG1pY3JvY29kZSBibG9iIGVycm9yICVkXG4iLCByZXQpOwo+IC0gICAgICAgIGdvdG8g
ZnJlZTsKPiArICAgICAgICBnb3RvIHB1dDsKPiAgICAgIH0KPiAgCj4gICAgICBpZiAoICFwYXRj
aCApCj4gICAgICB7Cj4gICAgICAgICAgcHJpbnRrKFhFTkxPR19JTkZPICJObyB1Y29kZSBmb3Vu
ZC4gVXBkYXRlIGFib3J0ZWQhXG4iKTsKPiAgICAgICAgICByZXQgPSAtRUlOVkFMOwo+IC0gICAg
ICAgIGdvdG8gZnJlZTsKPiArICAgICAgICBnb3RvIHB1dDsKPiArICAgIH0KPiArCj4gKyAgICBj
cHVtYXNrX2NsZWFyKCZjcHVfY2FsbGluX21hcCk7Cj4gKyAgICBhdG9taWNfc2V0KCZjcHVfb3V0
LCAwKTsKPiArICAgIGF0b21pY19zZXQoJmNwdV91cGRhdGVkLCAwKTsKPiArICAgIGxvYWRpbmdf
c3RhdGUgPSBMT0FESU5HX1BSRVBBUkU7Cj4gKwo+ICsgICAgLyogQ2FsY3VsYXRlIHRoZSBudW1i
ZXIgb2Ygb25saW5lIENQVSBjb3JlICovCj4gKyAgICBucl9jb3JlcyA9IDA7Cj4gKyAgICBmb3Jf
ZWFjaF9vbmxpbmVfY3B1KGNwdSkKPiArICAgICAgICBpZiAoIGNwdSA9PSBjcHVtYXNrX2ZpcnN0
KHBlcl9jcHUoY3B1X3NpYmxpbmdfbWFzaywgY3B1KSkgKQo+ICsgICAgICAgICAgICBucl9jb3Jl
cysrOwo+ICsKPiArICAgIHByaW50ayhYRU5MT0dfSU5GTyAiJXUgY29yZXMgYXJlIHRvIHVwZGF0
ZSB0aGVpciBtaWNyb2NvZGVcbiIsIG5yX2NvcmVzKTsKPiArCj4gKyAgICAvKgo+ICsgICAgICog
V2UgaW50ZW5kIHRvIGRpc2FibGUgaW50ZXJydXB0IGZvciBsb25nIHRpbWUsIHdoaWNoIG1heSBs
ZWFkIHRvCj4gKyAgICAgKiB3YXRjaGRvZyB0aW1lb3V0Lgo+ICsgICAgICovCj4gKyAgICB3YXRj
aGRvZ19kaXNhYmxlKCk7Cj4gKyAgICAvKgo+ICsgICAgICogTGF0ZSBsb2FkaW5nIGRhbmNlLiBX
aHkgdGhlIGhlYXZ5LWhhbmRlZCBzdG9wX21hY2hpbmUgZWZmb3J0Pwo+ICsgICAgICoKPiArICAg
ICAqIC0gSFQgc2libGluZ3MgbXVzdCBiZSBpZGxlIGFuZCBub3QgZXhlY3V0ZSBvdGhlciBjb2Rl
IHdoaWxlIHRoZSBvdGhlcgo+ICsgICAgICogICBzaWJsaW5nIGlzIGxvYWRpbmcgbWljcm9jb2Rl
IGluIG9yZGVyIHRvIGF2b2lkIGFueSBuZWdhdGl2ZQo+ICsgICAgICogICBpbnRlcmFjdGlvbnMg
Y2F1c2UgYnkgdGhlIGxvYWRpbmcuCj4gKyAgICAgKgo+ICsgICAgICogLSBJbiBhZGRpdGlvbiwg
bWljcm9jb2RlIHVwZGF0ZSBvbiB0aGUgY29yZXMgbXVzdCBiZSBzZXJpYWxpemVkIHVudGlsCj4g
KyAgICAgKiAgIHRoaXMgcmVxdWlyZW1lbnQgY2FuIGJlIHJlbGF4ZWQgaW4gdGhlIGZ1dHVyZS4g
UmlnaHQgbm93LCB0aGlzIGlzCj4gKyAgICAgKiAgIGNvbnNlcnZhdGl2ZSBhbmQgZ29vZC4KPiAr
ICAgICAqLwo+ICsgICAgcmV0ID0gc3RvcF9tYWNoaW5lX3J1bihkb19taWNyb2NvZGVfdXBkYXRl
LCBwYXRjaCwgTlJfQ1BVUyk7Cj4gKyAgICB3YXRjaGRvZ19lbmFibGUoKTsKCkNvbnNpZGVyaW5n
IHRoYXQgc3RvcF9tYWNoaW5lX3J1bigpIGRvZXNuJ3QgaXRzZWxmIGRpc2FibGUgdGhlIHdhdGNo
ZG9nLApkaWQgeW91IGNvbnNpZGVyIGhhdmluZyB0aGUgY29udHJvbCB0aHJlYWQgZGlzYWJsZS9l
bmFibGUgdGhlIHdhdGNoZG9nLAp0aHVzIHNob3J0ZW5pbmcgdGhlIHBlcmlvZCB3aGVyZSBpdCdz
IG5vdCBhY3RpdmU/Cgo+ICsgICAgdXBkYXRlZCA9IGF0b21pY19yZWFkKCZjcHVfdXBkYXRlZCk7
Cj4gKyAgICBpZiAoIHVwZGF0ZWQgPiAwICkKPiArICAgIHsKPiArICAgICAgICBzcGluX2xvY2so
Jm1pY3JvY29kZV9tdXRleCk7Cj4gKyAgICAgICAgbWljcm9jb2RlX3VwZGF0ZV9jYWNoZShwYXRj
aCk7Cj4gKyAgICAgICAgc3Bpbl91bmxvY2soJm1pY3JvY29kZV9tdXRleCk7Cj4gICAgICB9Cj4g
KyAgICBlbHNlCj4gKyAgICAgICAgbWljcm9jb2RlX2ZyZWVfcGF0Y2gocGF0Y2gpOwo+ICAKPiAt
ICAgIHJldCA9IGNvbnRpbnVlX2h5cGVyY2FsbF9vbl9jcHUoY3B1bWFza19maXJzdCgmY3B1X29u
bGluZV9tYXApLAo+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb19taWNy
b2NvZGVfdXBkYXRlLCBwYXRjaCk7Cj4gKyAgICBpZiAoIHVwZGF0ZWQgJiYgdXBkYXRlZCAhPSBu
cl9jb3JlcyApCj4gKyAgICAgICAgcHJpbnRrKFhFTkxPR19FUlIgIkVSUk9SOiBVcGRhdGluZyBt
aWNyb2NvZGUgc3VjY2VlZGVkIG9uICV1IGNvcmVzIGFuZCBmYWlsZWRcbiIKPiArICAgICAgICAg
ICAgICAgWEVOTE9HX0VSUiAib24gb3RoZXIgJXUgY29yZXMuIEEgc3lzdGVtIHdpdGggZGlmZmVy
aW5nIG1pY3JvY29kZSBcbiIKClN0cmF5IGJsYW5rIGJlZm9yZSBuZXdsaW5lLgoKPiArICAgICAg
ICAgICAgICAgWEVOTE9HX0VSUiAicmV2aXNpb25zIGlzIGNvbnNpZGVyZWQgdW5zdGFibGUuIFBs
ZWFzZSByZWJvb3QgYW5kIGRvIG5vdFxuIgo+ICsgICAgICAgICAgICAgICBYRU5MT0dfRVJSICJs
b2FkIHRoZSBtaWNyb2NvZGUgdGhhdCB0cmlnZ2Vyc3RoaXMgd2FybmluZyFcbiIsCgpNaXNzaW5n
IGJsYW5rIGJlZm9yZSAidGhpcyIuCgpKYW4KCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3Rz
LnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0
aW5mby94ZW4tZGV2ZWw=

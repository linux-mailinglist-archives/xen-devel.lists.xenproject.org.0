Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id D650FB6B22
	for <lists+xen-devel@lfdr.de>; Wed, 18 Sep 2019 20:54:13 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iAf2m-0006IT-VA; Wed, 18 Sep 2019 18:51:12 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=9cKO=XN=epam.com=volodymyr_babchuk@srs-us1.protection.inumbo.net>)
 id 1iAf2l-0006Hs-AU
 for xen-devel@lists.xenproject.org; Wed, 18 Sep 2019 18:51:11 +0000
X-Inumbo-ID: 43de519a-da45-11e9-a337-bc764e2007e4
Received: from EUR04-VI1-obe.outbound.protection.outlook.com (unknown
 [40.107.8.43]) by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 43de519a-da45-11e9-a337-bc764e2007e4;
 Wed, 18 Sep 2019 18:51:04 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=gbZAwUMZdhftgAC/9AtTZZB5zkkY3SlZNrwjJB/lWetgObRkirHuyAqmBToAiJvZVujqpczjJ1khltmJ1NUVfka4Q/IO72V/G1EBHVAhszWgWmztB+tS36PbJ4o8hvZKBwHfCNRPXaDintHvGhLpkDYX/9dYSv0cTWrUpbuAHwNV7FvcJQawfnIBrmGGr2BQ23juZQSj14cZ1ztPs/AVvTpkGbHhNefeXjfzv5EvSr0wjRcLNTGeK4kbxwjmI3qr5D2NJ0T6OqDC5tVx+Bun9lueOMzOQ9qS6eRVbcrDKeF8hcW8Ew0Kvel6UUDKm5WSv+L42PU2pH29ANBxDquR/Q==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=pjsT0snnco0gXPBDeF57uLeR/PMguD4mh0/rGAvu1yc=;
 b=oDOu8Cq7ZU3EZbzpX/xjpmsoblgz+UeRpKcB4X8Q92rouZb8Mjn6fPMO4fAh+OwvTm074Mg0a0iTaT+nRRKMbKXNArftUN39WIwY6r+gP/dArXJXk1QcixzVZ01l0AJ9JXRtsT9Nu+5G3DJtuGK3LNeIeZ27H9pZGnJAYY+62YT6hbHgf5urhfiu35RyqMRWkEZB7Lfqsg/HkB/KVBA8cnumf8ppGrzEOUhSdkxhL3YPY1KSh+B06GF6C2r5X5MZFfBJ+OayIMYdDyACUesjCKVqCLX12bdLeB3Zx3bDGfNvV6OrBIPAmC0KdtC2joWbrsFHtEPVDiMVT5mTkmYNDQ==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=epam.com; dmarc=pass action=none header.from=epam.com;
 dkim=pass header.d=epam.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=epam.com; s=selector2; 
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=pjsT0snnco0gXPBDeF57uLeR/PMguD4mh0/rGAvu1yc=;
 b=s/zUTAzP06Fs9754xe4heu8RHccEbFBSnwyc0ZueR1DH4j6q+Lzi323yNNsdgh4zqHAa8h6l1zLtiLEKEMME0xCjNLZNeZOe5EIKtlXz0vtCQrG2ZTtH/2Y7rFKrSHLyVA16AfHajgnG9u0m7rZ7h48avnt4N5bROwOAJFXKI7s=
Received: from AM0PR03MB4148.eurprd03.prod.outlook.com (20.177.40.10) by
 AM0PR03MB5761.eurprd03.prod.outlook.com (20.179.252.211) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2263.15; Wed, 18 Sep 2019 18:51:03 +0000
Received: from AM0PR03MB4148.eurprd03.prod.outlook.com
 ([fe80::71e3:834d:5708:5a0a]) by AM0PR03MB4148.eurprd03.prod.outlook.com
 ([fe80::71e3:834d:5708:5a0a%5]) with mapi id 15.20.2199.015; Wed, 18 Sep 2019
 18:51:02 +0000
From: Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>
To: "xen-devel@lists.xenproject.org" <xen-devel@lists.xenproject.org>
Thread-Topic: [PATCH v2 4/6] xen/arm: optee: handle shared buffer translation
 error
Thread-Index: AQHVblIEDLSpGG3MwUmqKYBWTkOKGw==
Date: Wed, 18 Sep 2019 18:51:02 +0000
Message-ID: <20190918185041.22738-5-volodymyr_babchuk@epam.com>
References: <20190918185041.22738-1-volodymyr_babchuk@epam.com>
In-Reply-To: <20190918185041.22738-1-volodymyr_babchuk@epam.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
authentication-results: spf=none (sender IP is )
 smtp.mailfrom=Volodymyr_Babchuk@epam.com; 
x-originating-ip: [85.223.209.22]
x-ms-publictraffictype: Email
x-ms-office365-filtering-correlation-id: 95ae7685-a35b-4ed6-0f29-08d73c692799
x-microsoft-antispam: BCL:0; PCL:0;
 RULEID:(2390118)(7020095)(4652040)(8989299)(5600167)(711020)(4605104)(1401327)(4534185)(7168020)(4627221)(201703031133081)(201702281549075)(8990200)(2017052603328)(7193020);
 SRVR:AM0PR03MB5761; 
x-ms-traffictypediagnostic: AM0PR03MB5761:|AM0PR03MB5761:
x-ms-exchange-transport-forked: True
x-microsoft-antispam-prvs: <AM0PR03MB57617532D2E29BA32FE48344E68E0@AM0PR03MB5761.eurprd03.prod.outlook.com>
x-ms-oob-tlc-oobclassifiers: OLM:7691;
x-forefront-prvs: 01644DCF4A
x-forefront-antispam-report: SFV:NSPM;
 SFS:(10009020)(4636009)(366004)(136003)(376002)(39860400002)(346002)(396003)(189003)(51234002)(199004)(66476007)(6116002)(478600001)(14454004)(66446008)(80792005)(2616005)(55236004)(8936002)(66066001)(5660300002)(2501003)(81156014)(305945005)(7736002)(81166006)(66556008)(8676002)(256004)(71200400001)(14444005)(71190400001)(99286004)(54906003)(1076003)(86362001)(26005)(11346002)(6512007)(5640700003)(2906002)(186003)(102836004)(3846002)(64756008)(76116006)(2351001)(91956017)(6506007)(25786009)(486006)(66946007)(36756003)(476003)(446003)(4326008)(316002)(6436002)(76176011)(6486002)(6916009);
 DIR:OUT; SFP:1101; SCL:1; SRVR:AM0PR03MB5761;
 H:AM0PR03MB4148.eurprd03.prod.outlook.com; FPR:; SPF:None; LANG:en;
 PTR:InfoNoRecords; MX:1; A:1; 
received-spf: None (protection.outlook.com: epam.com does not designate
 permitted sender hosts)
x-ms-exchange-senderadcheck: 1
x-microsoft-antispam-message-info: Ynt4z/dMU2Lp6v43nTdlMnmiCPi0UJJZlBG4U4jbvxBnflH/V4MGcyeW4V7IjvjR+hGD5KUtwR4QfTjcfhPVrYeN/MFNz36uparTK8/ZUutlzhtXiwvjBVZp9+iIU8CFhuOFmVDyVw78oIJBYwiBMndRrLVsvshyPbXNWKQsNIaocvlIpXRBOIvsdKuSU86j+o5o4fT0vkP1HzSBGBNayrBlwKLYEWFqfKFo6OZlVLGFkdfWYd0lIyGfaBHCmoMR+CHpo3TVyMhYhnoEP/L7943MyUqgjHJCVoZ6lwD6yJUKQ8Oo9nWQ+B/SGKJio0Akqs6OpuOn68DaHQLW9XkjWFHI02+MG48G+tfKaSnnf+y4kglVvkj6kGHafF9MOVfeHimUThFYaqfbiogWMUT5DuUIyNbHZCKGHN2+rEZ/ZEM=
MIME-Version: 1.0
X-OriginatorOrg: epam.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 95ae7685-a35b-4ed6-0f29-08d73c692799
X-MS-Exchange-CrossTenant-originalarrivaltime: 18 Sep 2019 18:51:02.7880 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: b41b72d0-4e9f-4c26-8a69-f949f367c91d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: uCK97fWKYjcvHN5Q0Ve6iXJIKaDKKgDNksefi6ro19oHYPehBFJSiLDcP980tVo/HtxsYnjJCx7HnxVWsjGb0v/LvjM97OVDy9gQLasG0Xw=
X-MS-Exchange-Transport-CrossTenantHeadersStamped: AM0PR03MB5761
Subject: [Xen-devel] [PATCH v2 4/6] xen/arm: optee: handle shared buffer
 translation error
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: "tee-dev@lists.linaro.org" <tee-dev@lists.linaro.org>,
 Julien Grall <julien.grall@arm.com>,
 Stefano Stabellini <sstabellini@kernel.org>,
 Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhlcmUgaXMgYSBjYXNlIHBvc3NpYmxlLCB3aGVuIE9QLVRFRSBhc2tzIGd1ZXN0IHRvIGFsbG9j
YXRlIHNoYXJlZApidWZmZXIsIGJ1dCBYZW4gZm9yIHNvbWUgcmVhc29uIGNhbid0IHRyYW5zbGF0
ZSBidWZmZXIncyBhZGRyZXNzZXMuIEluCnRoaXMgc2l0dWF0aW9uIHdlIHNob3VsZCBkbyB0d28g
dGhpbmdzOgoKMS4gVGVsbCBndWVzdCB0byBmcmVlIGFsbG9jYXRlZCBidWZmZXIsIHNvIHRoZXJl
IHdpbGwgYmUgbm8gbWVtb3J5CmxlYWsgZm9yIGd1ZXN0LgoKMi4gVGVsbCBPUC1URUUgdGhhdCBi
dWZmZXIgYWxsb2NhdGlvbiBmYWlsZWQuCgpUbyBhc2sgZ3Vlc3QgdG8gZnJlZSBhbGxvY2F0ZWQg
YnVmZmVyIHdlIHNob3VsZCBwZXJmb3JtIHRoZSBzYW1lCnRoaW5nLCBhcyBPUC1URUUgZG9lcyAt
IGlzc3VlIFJQQyByZXF1ZXN0LiBUaGlzIGlzIGRvbmUgYnkgZmlsbGluZwpyZXF1ZXN0IGJ1ZmZl
ciAobHVja2lseSB3ZSBjYW4gcmV1c2UgdGhlIHNhbWUgYnVmZmVyLCB0aGF0IE9QLVRFRSB1c2Vk
CnRvIGlzc3VlIG9yaWdpbmFsIHJlcXVlc3QpIGFuZCB0aGVuIHJldHVybiB0byBndWVzdCB3aXRo
IHNwZWNpYWwKcmV0dXJuIGNvZGUuCgpUaGVuIHdlIG5lZWQgdG8gaGFuZGxlIG5leHQgY2FsbCBm
cm9tIGd1ZXN0IGluIGEgc3BlY2lhbCB3YXk6IGFzIFJQQwp3YXMgaXNzdWVkIGJ5IFhlbiwgbm90
IGJ5IE9QLVRFRSwgaXQgc2hvdWxkIGJlIGhhbmRsZWQgYnkgWGVuLgpCYXNpY2FsbHksIHRoaXMg
aXMgdGhlIG1lY2hhbmlzbSB0byBwcmVlbXB0IE9QLVRFRSBtZWRpYXRvci4KClRoZSBzYW1lIG1l
Y2hhbmlzbSBjYW4gYmUgdXNlZCBpbiB0aGUgZnV0dXJlIHRvIHByZWVtcHQgbWVkaWF0b3IKZHVy
aW5nIHRyYW5zbGF0aW9uIGxhcmdlICg+NTEyIHBhZ2VzKSBzaGFyZWQgYnVmZmVycy4KClNpZ25l
ZC1vZmYtYnk6IFZvbG9keW15ciBCYWJjaHVrIDx2b2xvZHlteXJfYmFiY2h1a0BlcGFtLmNvbT4K
Ci0tLQoKQ2hhbmdlcyBmcm9tIHYxOgogLSBSZW5hbWVkIE9QVEVFTV9DQUxMXyogdG8gT1BURUVf
Q0FMTF8qCiAtIEZpeGVkIGNvbW1lbnRzCiAtIEFkZGVkIEFTU0VSVCgpIGluICBoYW5kbGVfeGVu
X3JwY19yZXR1cm4oKQotLS0KIHhlbi9hcmNoL2FybS90ZWUvb3B0ZWUuYyB8IDE3MiArKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCAxNDEgaW5z
ZXJ0aW9ucygrKSwgMzEgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEveGVuL2FyY2gvYXJtL3Rl
ZS9vcHRlZS5jIGIveGVuL2FyY2gvYXJtL3RlZS9vcHRlZS5jCmluZGV4IDg4YmU5NTk4MTkuLjBh
MzIwNWY5ZTggMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL2FybS90ZWUvb3B0ZWUuYworKysgYi94ZW4v
YXJjaC9hcm0vdGVlL29wdGVlLmMKQEAgLTk4LDYgKzk4LDExIEBACiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBPUFRFRV9TTUNfU0VDX0NBUF9VTlJFR0lTVEVSRURfU0hNIHwgXAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgT1BURUVfU01DX1NFQ19DQVBfRFlOQU1JQ19TSE0p
CiAKK2VudW0gb3B0ZWVfY2FsbF9zdGF0ZSB7CisgICAgT1BURUVfQ0FMTF9OT1JNQUwsCisgICAg
T1BURUVfQ0FMTF9YRU5fUlBDLAorfTsKKwogc3RhdGljIHVuc2lnbmVkIGludCBfX3JlYWRfbW9z
dGx5IG1heF9vcHRlZV90aHJlYWRzOwogCiAvKgpAQCAtMTE0LDYgKzExOSw5IEBAIHN0cnVjdCBv
cHRlZV9zdGRfY2FsbCB7CiAgICAgcGFkZHJfdCBndWVzdF9hcmdfaXBhOwogICAgIGludCBvcHRl
ZV90aHJlYWRfaWQ7CiAgICAgaW50IHJwY19vcDsKKyAgICAvKiBTYXZlZCBidWZmZXIgdHlwZSBm
b3IgdGhlIGN1cnJlbnQgYnVmZmVyIGFsbG9jYXRlIHJlcXVlc3QgKi8KKyAgICB1bnNpZ25lZCBp
bnQgcnBjX2J1ZmZlcl90eXBlOworICAgIGVudW0gb3B0ZWVfY2FsbF9zdGF0ZSBzdGF0ZTsKICAg
ICB1aW50NjRfdCBycGNfZGF0YV9jb29raWU7CiAgICAgYm9vbCBpbl9mbGlnaHQ7CiAgICAgcmVn
aXN0ZXJfdCBycGNfcGFyYW1zWzJdOwpAQCAtMzAxLDYgKzMwOSw3IEBAIHN0YXRpYyBzdHJ1Y3Qg
b3B0ZWVfc3RkX2NhbGwgKmFsbG9jYXRlX3N0ZF9jYWxsKHN0cnVjdCBvcHRlZV9kb21haW4gKmN0
eCkKIAogICAgIGNhbGwtPm9wdGVlX3RocmVhZF9pZCA9IC0xOwogICAgIGNhbGwtPmluX2ZsaWdo
dCA9IHRydWU7CisgICAgY2FsbC0+c3RhdGUgPSBPUFRFRV9DQUxMX05PUk1BTDsKIAogICAgIHNw
aW5fbG9jaygmY3R4LT5sb2NrKTsKICAgICBsaXN0X2FkZF90YWlsKCZjYWxsLT5saXN0LCAmY3R4
LT5jYWxsX2xpc3QpOwpAQCAtMTA4Niw2ICsxMDk1LDEwIEBAIHN0YXRpYyBpbnQgaGFuZGxlX3Jw
Y19yZXR1cm4oc3RydWN0IG9wdGVlX2RvbWFpbiAqY3R4LAogICAgICAgICAgICAgcmV0ID0gLUVS
RVNUQVJUOwogICAgICAgICB9CiAKKyAgICAgICAgLyogU2F2ZSB0aGUgYnVmZmVyIHR5cGUgaW4g
Y2FzZSB3ZSB3aWxsIHdhbnQgdG8gZnJlZSBpdCAqLworICAgICAgICBpZiAoIHNobV9ycGMtPnhl
bl9hcmctPmNtZCA9PSBPUFRFRV9SUENfQ01EX1NITV9BTExPQyApCisgICAgICAgICAgICBjYWxs
LT5ycGNfYnVmZmVyX3R5cGUgPSBzaG1fcnBjLT54ZW5fYXJnLT5wYXJhbXNbMF0udS52YWx1ZS5h
OworCiAgICAgICAgIHVubWFwX2RvbWFpbl9wYWdlKHNobV9ycGMtPnhlbl9hcmcpOwogICAgIH0K
IApAQCAtMTI1MCwxOCArMTI2MywxMDcgQEAgZXJyOgogICAgIHJldHVybjsKIH0KIAorLyoKKyAq
IFByZXBhcmUgUlBDIHJlcXVlc3QgdG8gZnJlZSBzaGFyZWQgYnVmZmVyIGluIHRoZSBzYW1lIHdh
eSwgYXMKKyAqIE9QLVRFRSBkb2VzIHRoaXMuCisgKgorICogUmV0dXJuIHZhbHVlczoKKyAqICB0
cnVlICAtIHN1Y2Nlc3NmdWxseSBwcmVwYXJlZCBSUEMgcmVxdWVzdAorICogIGZhbHNlIC0gdGhl
cmUgd2FzIGFuIGVycm9yCisgKi8KK3N0YXRpYyBib29sIGlzc3VlX3JwY19jbWRfZnJlZShzdHJ1
Y3Qgb3B0ZWVfZG9tYWluICpjdHgsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ry
dWN0IGNwdV91c2VyX3JlZ3MgKnJlZ3MsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
c3RydWN0IG9wdGVlX3N0ZF9jYWxsICpjYWxsLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHN0cnVjdCBzaG1fcnBjICpzaG1fcnBjLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHVpbnQ2NF90IGNvb2tpZSkKK3sKKyAgICByZWdpc3Rlcl90IHIxLCByMjsKKworICAgIC8q
IEluIGNhc2UgaWYgZ3Vlc3Qgd2lsbCBmb3JnZXQgdG8gdXBkYXRlIGl0IHdpdGggbWVhbmluZ2Z1
bCB2YWx1ZSAqLworICAgIHNobV9ycGMtPnhlbl9hcmctPnJldCA9IFRFRUNfRVJST1JfR0VORVJJ
QzsKKyAgICBzaG1fcnBjLT54ZW5fYXJnLT5jbWQgPSBPUFRFRV9SUENfQ01EX1NITV9GUkVFOwor
ICAgIHNobV9ycGMtPnhlbl9hcmctPm51bV9wYXJhbXMgPSAxOworICAgIHNobV9ycGMtPnhlbl9h
cmctPnBhcmFtc1swXS5hdHRyID0gT1BURUVfTVNHX0FUVFJfVFlQRV9WQUxVRV9JTlBVVDsKKyAg
ICBzaG1fcnBjLT54ZW5fYXJnLT5wYXJhbXNbMF0udS52YWx1ZS5hID0gY2FsbC0+cnBjX2J1ZmZl
cl90eXBlOworICAgIHNobV9ycGMtPnhlbl9hcmctPnBhcmFtc1swXS51LnZhbHVlLmIgPSBjb29r
aWU7CisKKyAgICBpZiAoIGFjY2Vzc19ndWVzdF9tZW1vcnlfYnlfaXBhKGN1cnJlbnQtPmRvbWFp
biwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdmbl90b19nYWRkcihzaG1f
cnBjLT5nZm4pLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2htX3JwYy0+
eGVuX2FyZywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9QVEVFX01TR19H
RVRfQVJHX1NJWkUoMSksCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVl
KSApCisgICAgeworICAgICAgICAvKgorICAgICAgICAgKiBXZWxsLCB0aGlzIGlzIHF1aXRlIGJh
ZC4gV2UgaGF2ZSBlcnJvciBpbiB0aGUgZXJyb3IKKyAgICAgICAgICogcGF0aC4gVGhpcyBjYW4g
aGFwcGVuIG9ubHkgaWYgZ3Vlc3QgYmVoYXZlcyBiYWRseSwgc28gYWxsCisgICAgICAgICAqIHdl
IGNhbiBkbyBpcyB0byByZXR1cm4gZXJyb3IgdG8gT1AtVEVFIGFuZCBsZWF2ZSBndWVzdCdzCisg
ICAgICAgICAqIG1lbW9yeSBsZWFrZWQuIFdlIGFscmVhZHkgaGF2ZSBmcmVlZCBhbGwgcmVzb3Vy
Y2VzCisgICAgICAgICAqIGFsbG9jYXRlZCBmb3IgdGhpcyBidWZmZXIsIGJ1dCBndWVzdCB3aWxs
IG5ldmVyIHJlY2VpdmUKKyAgICAgICAgICogT1BURUVfUlBDX0NNRF9TSE1fRlJFRSByZXF1ZXN0
LCBzbyBpdCB3aWxsIG5vdCBrbm93IHRoYXQgaXQKKyAgICAgICAgICogY2FuIHJlbGVhc2UgYWxs
b2NhdGVkIGJ1ZmZlci4KKyAgICAgICAgICovCisgICAgICAgIHNobV9ycGMtPnhlbl9hcmctPnJl
dCA9IFRFRUNfRVJST1JfR0VORVJJQzsKKyAgICAgICAgc2htX3JwYy0+eGVuX2FyZy0+bnVtX3Bh
cmFtcyA9IDA7CisKKyAgICAgICAgcmV0dXJuIGZhbHNlOworICAgIH0KKworICAgIHVpbnQ2NF90
b19yZWdwYWlyKCZyMSwgJnIyLCBzaG1fcnBjLT5jb29raWUpOworCisgICAgY2FsbC0+c3RhdGUg
PSBPUFRFRV9DQUxMX1hFTl9SUEM7CisgICAgY2FsbC0+cnBjX29wID0gT1BURUVfU01DX1JQQ19G
VU5DX0NNRDsKKyAgICBjYWxsLT5ycGNfcGFyYW1zWzBdID0gcjE7CisgICAgY2FsbC0+cnBjX3Bh
cmFtc1sxXSA9IHIyOworICAgIGNhbGwtPm9wdGVlX3RocmVhZF9pZCA9IGdldF91c2VyX3JlZyhy
ZWdzLCAzKTsKKworICAgIHNldF91c2VyX3JlZyhyZWdzLCAwLCBPUFRFRV9TTUNfUkVUVVJOX1JQ
Q19DTUQpOworICAgIHNldF91c2VyX3JlZyhyZWdzLCAxLCByMSk7CisgICAgc2V0X3VzZXJfcmVn
KHJlZ3MsIDIsIHIyKTsKKworICAgIHJldHVybiB0cnVlOworfQorCisvKiBIYW5kbGVzIHJldHVy
biBmcm9tIFhlbi1pc3N1ZWQgUlBDICovCitzdGF0aWMgdm9pZCBoYW5kbGVfeGVuX3JwY19yZXR1
cm4oc3RydWN0IG9wdGVlX2RvbWFpbiAqY3R4LAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHN0cnVjdCBjcHVfdXNlcl9yZWdzICpyZWdzLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHN0cnVjdCBvcHRlZV9zdGRfY2FsbCAqY2FsbCwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBzdHJ1Y3Qgc2htX3JwYyAqc2htX3JwYykKK3sKKyAgICBjYWxs
LT5zdGF0ZSA9IE9QVEVFX0NBTExfTk9STUFMOworCisgICAgLyoKKyAgICAgKiBSaWdodCBub3cg
d2UgaGF2ZSBvbmx5IG9uZSByZWFzb24gdG8gYmUgdGhlcmUgLSB3ZSBhc2tlZCBndWVzdAorICAg
ICAqIHRvIGZyZWUgc2hhcmVkIGJ1ZmZlciBhbmQgaXQgZGlkIGl0LiBOb3cgd2UgY2FuIHRlbGwg
T1AtVEVFCisgICAgICogdGhhdCBidWZmZXIgYWxsb2NhdGlvbiBmYWlsZWQuIFdlIGFyZSBub3Qg
c3RvcmluZyBleGFjdCBjb21tYW5kCisgICAgICogdHlwZSwgb25seSB0eXBlIG9mIFJQQyByZXR1
cm4uIFNvLCB0aGlzIGlzIHRoZSBvbmx5IGNoZWNrIHdlCisgICAgICogY2FuIHBlcmZvcm0gdGhl
cmUuCisgICAgICovCisgICAgQVNTRVJUKGNhbGwtPnJwY19vcCA9PSBPUFRFRV9TTUNfUlBDX0ZV
TkNfQ01EKTsKKworICAgIC8qCisgICAgICogV2UgYXJlIG5vdCBjaGVja2luZyByZXR1cm4gdmFs
dWUgZnJvbSBhIGd1ZXN0IGJlY2F1c2Ugd2UgYXNzdW1lCisgICAgICogdGhhdCBPUFRFRV9SUENf
Q01EX1NITV9GUkVFIG5ldmVyIGZhaWxzLgorICAgICAqLworICAgIHNobV9ycGMtPnhlbl9hcmct
PnJldCA9IFRFRUNfRVJST1JfR0VORVJJQzsKKyAgICBzaG1fcnBjLT54ZW5fYXJnLT5udW1fcGFy
YW1zID0gMDsKK30KKwogLyoKICAqIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHdoZW4gZ3Vlc3Qg
aXMgZmluaXNoZWQgcHJvY2Vzc2luZyBSUEMKICAqIHJlcXVlc3QgZnJvbSBPUC1URUUgYW5kIHdp
c2hlZCB0byByZXN1bWUgdGhlIGludGVycnVwdGVkIHN0YW5kYXJkCiAgKiBjYWxsLgorICoKKyAq
IFJldHVybiB2YWx1ZXM6CisgKiAgZmFsc2UgLSB0aGVyZSB3YXMgYW4gZXJyb3IsIGRvIG5vdCBj
YWxsIE9QLVRFRQorICogIHRydWUgIC0gc3VjY2VzcywgcHJvY2VlZCBhcyBub3JtYWwKICAqLwot
c3RhdGljIHZvaWQgaGFuZGxlX3JwY19jbWRfYWxsb2Moc3RydWN0IG9wdGVlX2RvbWFpbiAqY3R4
LAorc3RhdGljIGJvb2wgaGFuZGxlX3JwY19jbWRfYWxsb2Moc3RydWN0IG9wdGVlX2RvbWFpbiAq
Y3R4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGNwdV91c2VyX3Jl
Z3MgKnJlZ3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3Qgb3B0ZWVf
c3RkX2NhbGwgKmNhbGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3Qg
c2htX3JwYyAqc2htX3JwYykKIHsKICAgICBpZiAoIHNobV9ycGMtPnhlbl9hcmctPnJldCB8fCBz
aG1fcnBjLT54ZW5fYXJnLT5udW1fcGFyYW1zICE9IDEgKQotICAgICAgICByZXR1cm47CisgICAg
ICAgIHJldHVybiB0cnVlOwogCiAgICAgaWYgKCBzaG1fcnBjLT54ZW5fYXJnLT5wYXJhbXNbMF0u
YXR0ciAhPSAoT1BURUVfTVNHX0FUVFJfVFlQRV9UTUVNX09VVFBVVCB8CiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT1BURUVfTVNHX0FUVFJfTk9OQ09OVElH
KSApCkBAIC0xMjY5LDcgKzEzNzEsNyBAQCBzdGF0aWMgdm9pZCBoYW5kbGVfcnBjX2NtZF9hbGxv
YyhzdHJ1Y3Qgb3B0ZWVfZG9tYWluICpjdHgsCiAgICAgICAgIGdkcHJpbnRrKFhFTkxPR19XQVJO
SU5HLAogICAgICAgICAgICAgICAgICAiSW52YWxpZCBhdHRycyBmb3Igc2hhcmVkIG1lbSBidWZm
ZXI6ICUiUFJJeDY0IlxuIiwKICAgICAgICAgICAgICAgICAgc2htX3JwYy0+eGVuX2FyZy0+cGFy
YW1zWzBdLmF0dHIpOwotICAgICAgICByZXR1cm47CisgICAgICAgIHJldHVybiB0cnVlOwogICAg
IH0KIAogICAgIC8qIEZyZWUgcGcgbGlzdCBmb3IgYnVmZmVyICovCkBAIC0xMjg1LDIxICsxMzg3
LDE0IEBAIHN0YXRpYyB2b2lkIGhhbmRsZV9ycGNfY21kX2FsbG9jKHN0cnVjdCBvcHRlZV9kb21h
aW4gKmN0eCwKICAgICB7CiAgICAgICAgIGNhbGwtPnJwY19kYXRhX2Nvb2tpZSA9IDA7CiAgICAg
ICAgIC8qCi0gICAgICAgICAqIE9rYXksIHNvIHRoZXJlIHdhcyBwcm9ibGVtIHdpdGggZ3Vlc3Qn
cyBidWZmZXIgYW5kIHdlIG5lZWQKLSAgICAgICAgICogdG8gdGVsbCBhYm91dCB0aGlzIHRvIE9Q
LVRFRS4KLSAgICAgICAgICovCi0gICAgICAgIHNobV9ycGMtPnhlbl9hcmctPnJldCA9IFRFRUNf
RVJST1JfR0VORVJJQzsKLSAgICAgICAgc2htX3JwYy0+eGVuX2FyZy0+bnVtX3BhcmFtcyA9IDA7
Ci0gICAgICAgIC8qCi0gICAgICAgICAqIFRPRE86IFdpdGggY3VycmVudCBpbXBsZW1lbnRhdGlv
biwgT1AtVEVFIHdpbGwgbm90IGlzc3VlCi0gICAgICAgICAqIFJQQyB0byBmcmVlIHRoaXMgYnVm
ZmVyLiBHdWVzdCBhbmQgT1AtVEVFIHdpbGwgYmUgb3V0IG9mCi0gICAgICAgICAqIHN5bmM6IGd1
ZXN0IGJlbGlldmVzIHRoYXQgaXQgcHJvdmlkZWQgYnVmZmVyIHRvIE9QLVRFRSwKLSAgICAgICAg
ICogd2hpbGUgT1AtVEVFIHRoaW5rcyBvZiBvcHBvc2l0ZS4gSWRlYWxseSwgd2UgbmVlZCB0bwot
ICAgICAgICAgKiBlbXVsYXRlIFJQQyB3aXRoIE9QVEVFX01TR19SUENfQ01EX1NITV9GUkVFIGNv
bW1hbmQuCisgICAgICAgICAqIFdlIGFyZSB1bmFibGUgdG8gdHJhbnNsYXRlIGd1ZXN0J3MgYnVm
ZmVyLCBzbyB3ZSBuZWVkIHRlbGwgZ3Vlc3QKKyAgICAgICAgICogdG8gZnJlZSBpdCwgYmVmb3Jl
IHJlcG9ydGluZyBhbiBlcnJvciB0byBPUC1URUUuCiAgICAgICAgICAqLwotICAgICAgICBncHJp
bnRrKFhFTkxPR19XQVJOSU5HLAotICAgICAgICAgICAgICAgICJ0cmFuc2xhdGVfbm9uY29udGln
KCkgZmFpbGVkLCBPUC1URUUvZ3Vlc3Qgc3RhdGUgaXMgb3V0IG9mIHN5bmMuXG4iKTsKKyAgICAg
ICAgcmV0dXJuICFpc3N1ZV9ycGNfY21kX2ZyZWUoY3R4LCByZWdzLCBjYWxsLCBzaG1fcnBjLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG1fcnBjLT54ZW5fYXJnLT5wYXJh
bXNbMF0udS50bWVtLnNobV9yZWYpOwogICAgIH0KKworICAgIHJldHVybiB0cnVlOwogfQogCiBz
dGF0aWMgdm9pZCBoYW5kbGVfcnBjX2NtZChzdHJ1Y3Qgb3B0ZWVfZG9tYWluICpjdHgsIHN0cnVj
dCBjcHVfdXNlcl9yZWdzICpyZWdzLApAQCAtMTM0OSwyMiArMTQ0NCwzNyBAQCBzdGF0aWMgdm9p
ZCBoYW5kbGVfcnBjX2NtZChzdHJ1Y3Qgb3B0ZWVfZG9tYWluICpjdHgsIHN0cnVjdCBjcHVfdXNl
cl9yZWdzICpyZWdzLAogICAgICAgICBnb3RvIG91dDsKICAgICB9CiAKLSAgICBzd2l0Y2ggKHNo
bV9ycGMtPnhlbl9hcmctPmNtZCkKKyAgICBpZiAoIGNhbGwtPnN0YXRlID09IE9QVEVFX0NBTExf
Tk9STUFMICkKICAgICB7Ci0gICAgY2FzZSBPUFRFRV9SUENfQ01EX0dFVF9USU1FOgotICAgIGNh
c2UgT1BURUVfUlBDX0NNRF9XQUlUX1FVRVVFOgotICAgIGNhc2UgT1BURUVfUlBDX0NNRF9TVVNQ
RU5EOgotICAgICAgICBicmVhazsKLSAgICBjYXNlIE9QVEVFX1JQQ19DTURfU0hNX0FMTE9DOgot
ICAgICAgICBoYW5kbGVfcnBjX2NtZF9hbGxvYyhjdHgsIHJlZ3MsIGNhbGwsIHNobV9ycGMpOwot
ICAgICAgICBicmVhazsKLSAgICBjYXNlIE9QVEVFX1JQQ19DTURfU0hNX0ZSRUU6Ci0gICAgICAg
IGZyZWVfb3B0ZWVfc2htX2J1ZihjdHgsIHNobV9ycGMtPnhlbl9hcmctPnBhcmFtc1swXS51LnZh
bHVlLmIpOwotICAgICAgICBpZiAoIGNhbGwtPnJwY19kYXRhX2Nvb2tpZSA9PSBzaG1fcnBjLT54
ZW5fYXJnLT5wYXJhbXNbMF0udS52YWx1ZS5iICkKLSAgICAgICAgICAgIGNhbGwtPnJwY19kYXRh
X2Nvb2tpZSA9IDA7Ci0gICAgICAgIGJyZWFrOwotICAgIGRlZmF1bHQ6Ci0gICAgICAgIGJyZWFr
OworICAgICAgICBzd2l0Y2ggKHNobV9ycGMtPnhlbl9hcmctPmNtZCkKKyAgICAgICAgeworICAg
ICAgICBjYXNlIE9QVEVFX1JQQ19DTURfR0VUX1RJTUU6CisgICAgICAgIGNhc2UgT1BURUVfUlBD
X0NNRF9XQUlUX1FVRVVFOgorICAgICAgICBjYXNlIE9QVEVFX1JQQ19DTURfU1VTUEVORDoKKyAg
ICAgICAgICAgIGJyZWFrOworICAgICAgICBjYXNlIE9QVEVFX1JQQ19DTURfU0hNX0FMTE9DOgor
ICAgICAgICAgICAgaWYgKCAhaGFuZGxlX3JwY19jbWRfYWxsb2MoY3R4LCByZWdzLCBjYWxsLCBz
aG1fcnBjKSApCisgICAgICAgICAgICB7CisgICAgICAgICAgICAgICAgLyogV2UgZmFpbGVkIHRv
IHRyYW5zbGF0ZSBidWZmZXIsIHJlcG9ydCBiYWNrIHRvIGd1ZXN0ICovCisgICAgICAgICAgICAg
ICAgdW5tYXBfZG9tYWluX3BhZ2Uoc2htX3JwYy0+eGVuX2FyZyk7CisgICAgICAgICAgICAgICAg
cHV0X3N0ZF9jYWxsKGN0eCwgY2FsbCk7CisKKyAgICAgICAgICAgICAgICByZXR1cm47CisgICAg
ICAgICAgICB9CisgICAgICAgICAgICBicmVhazsKKyAgICAgICAgY2FzZSBPUFRFRV9SUENfQ01E
X1NITV9GUkVFOgorICAgICAgICAgICAgZnJlZV9vcHRlZV9zaG1fYnVmKGN0eCwgc2htX3JwYy0+
eGVuX2FyZy0+cGFyYW1zWzBdLnUudmFsdWUuYik7CisgICAgICAgICAgICBpZiAoIGNhbGwtPnJw
Y19kYXRhX2Nvb2tpZSA9PQorICAgICAgICAgICAgICAgICBzaG1fcnBjLT54ZW5fYXJnLT5wYXJh
bXNbMF0udS52YWx1ZS5iICkKKyAgICAgICAgICAgICAgICBjYWxsLT5ycGNfZGF0YV9jb29raWUg
PSAwOworICAgICAgICAgICAgYnJlYWs7CisgICAgICAgIGRlZmF1bHQ6CisgICAgICAgICAgICBi
cmVhazsKKyAgICAgICAgfQorICAgIH0KKyAgICBlbHNlCisgICAgeworICAgICAgICBoYW5kbGVf
eGVuX3JwY19yZXR1cm4oY3R4LCByZWdzLCBjYWxsLCBzaG1fcnBjKTsKICAgICB9CiAKIG91dDoK
LS0gCjIuMjIuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcK
aHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

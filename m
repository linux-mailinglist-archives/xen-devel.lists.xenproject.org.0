Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 3B6DA144C7
	for <lists+xen-devel@lfdr.de>; Mon,  6 May 2019 09:00:02 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hNXYq-0002PZ-HV; Mon, 06 May 2019 06:57:16 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=XZcu=TG=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1hNXYi-00028z-AZ
 for xen-devel@lists.xenproject.org; Mon, 06 May 2019 06:57:08 +0000
X-Inumbo-ID: 211afd86-6fcc-11e9-8387-eb181d75d5a3
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 211afd86-6fcc-11e9-8387-eb181d75d5a3;
 Mon, 06 May 2019 06:56:53 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id BA714AECB;
 Mon,  6 May 2019 06:56:50 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Mon,  6 May 2019 08:56:07 +0200
Message-Id: <20190506065644.7415-9-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190506065644.7415-1-jgross@suse.com>
References: <20190506065644.7415-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH RFC V2 08/45] xen/sched: switch
 schedule_data.curr to point at sched_item
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Tim Deegan <tim@xen.org>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wei.liu2@citrix.com>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>,
 Robert VanVossen <robert.vanvossen@dornerworks.com>,
 Dario Faggioli <dfaggioli@suse.com>, Julien Grall <julien.grall@arm.com>,
 Josh Whitehead <josh.whitehead@dornerworks.com>,
 Meng Xu <mengxu@cis.upenn.edu>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SW4gcHJlcGFyYXRpb24gb2YgY29yZSBzY2hlZHVsaW5nIGxldCB0aGUgcGVyY3B1IHBvaW50ZXIK
c2NoZWR1bGVfZGF0YS5jdXJyIHBvaW50IHRvIGEgc3RyY3Qgc2NoZWRfaXRlbSBpbnN0ZWFkIG9m
IHRoZSByZWxhdGVkCnZjcHUuIEF0IHRoZSBzYW1lIHRpbWUgcmVuYW1lIHRoZSBwZXItdmNwdSBz
Y2hlZHVsZXIgc3BlY2lmaWMgc3RydWN0cwp0byBwZXItaXRlbSBvbmVzLgoKU2lnbmVkLW9mZi1i
eTogSnVlcmdlbiBHcm9zcyA8amdyb3NzQHN1c2UuY29tPgotLS0KIHhlbi9jb21tb24vc2NoZWRf
YXJpbmM2NTMuYyB8ICAgMiArLQogeGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQuYyAgIHwgMTAxICsr
KysrKysrKysrKystLS0tLS0tLS0tLS0tCiB4ZW4vY29tbW9uL3NjaGVkX2NyZWRpdDIuYyAgfCAx
NjggKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIHhlbi9jb21t
b24vc2NoZWRfbnVsbC5jICAgICB8ICA0NCArKysrKystLS0tLS0KIHhlbi9jb21tb24vc2NoZWRf
cnQuYyAgICAgICB8IDExOCArKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tCiB4ZW4vY29t
bW9uL3NjaGVkdWxlLmMgICAgICAgfCAgIDggKystCiB4ZW4vaW5jbHVkZS94ZW4vc2NoZWQtaWYu
aCAgfCAgIDIgKy0KIDcgZmlsZXMgY2hhbmdlZCwgMjIwIGluc2VydGlvbnMoKyksIDIyMyBkZWxl
dGlvbnMoLSkKCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3NjaGVkX2FyaW5jNjUzLmMgYi94ZW4v
Y29tbW9uL3NjaGVkX2FyaW5jNjUzLmMKaW5kZXggYTc3NWJlNGNiYy4uNTcwMWJhZjMzNyAxMDA2
NDQKLS0tIGEveGVuL2NvbW1vbi9zY2hlZF9hcmluYzY1My5jCisrKyBiL3hlbi9jb21tb24vc2No
ZWRfYXJpbmM2NTMuYwpAQCAtNDc1LDcgKzQ3NSw3IEBAIGE2NTNzY2hlZF9pdGVtX3NsZWVwKGNv
bnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX2l0ZW0gKml0ZW0pCiAgICAg
ICogSWYgdGhlIFZDUFUgYmVpbmcgcHV0IHRvIHNsZWVwIGlzIHRoZSBzYW1lIG9uZSB0aGF0IGlz
IGN1cnJlbnRseQogICAgICAqIHJ1bm5pbmcsIHJhaXNlIGEgc29mdGlycSB0byBpbnZva2UgdGhl
IHNjaGVkdWxlciB0byBzd2l0Y2ggZG9tYWlucy4KICAgICAgKi8KLSAgICBpZiAoIHBlcl9jcHUo
c2NoZWR1bGVfZGF0YSwgdmMtPnByb2Nlc3NvcikuY3VyciA9PSB2YyApCisgICAgaWYgKCBwZXJf
Y3B1KHNjaGVkdWxlX2RhdGEsIHZjLT5wcm9jZXNzb3IpLmN1cnIgPT0gaXRlbSApCiAgICAgICAg
IGNwdV9yYWlzZV9zb2Z0aXJxKHZjLT5wcm9jZXNzb3IsIFNDSEVEVUxFX1NPRlRJUlEpOwogfQog
CmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3NjaGVkX2NyZWRpdC5jIGIveGVuL2NvbW1vbi9zY2hl
ZF9jcmVkaXQuYwppbmRleCAxNGI3NDlkYzFhLi42NTUyZDRjMDg3IDEwMDY0NAotLS0gYS94ZW4v
Y29tbW9uL3NjaGVkX2NyZWRpdC5jCisrKyBiL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0LmMKQEAg
LTgzLDcgKzgzLDcgQEAKICAgICAoKHN0cnVjdCBjc2NoZWRfcHJpdmF0ZSAqKSgoX29wcyktPnNj
aGVkX2RhdGEpKQogI2RlZmluZSBDU0NIRURfUENQVShfYykgICAgIFwKICAgICAoKHN0cnVjdCBj
c2NoZWRfcGNwdSAqKXBlcl9jcHUoc2NoZWR1bGVfZGF0YSwgX2MpLnNjaGVkX3ByaXYpCi0jZGVm
aW5lIENTQ0hFRF9WQ1BVKF92Y3B1KSAgKChzdHJ1Y3QgY3NjaGVkX3ZjcHUgKikgKF92Y3B1KS0+
c2NoZWRfaXRlbS0+cHJpdikKKyNkZWZpbmUgQ1NDSEVEX0lURU0oaXRlbSkgICAoKHN0cnVjdCBj
c2NoZWRfaXRlbSAqKSAoaXRlbSktPnByaXYpCiAjZGVmaW5lIENTQ0hFRF9ET00oX2RvbSkgICAg
KChzdHJ1Y3QgY3NjaGVkX2RvbSAqKSAoX2RvbSktPnNjaGVkX3ByaXYpCiAjZGVmaW5lIFJVTlEo
X2NwdSkgICAgICAgICAgKCYoQ1NDSEVEX1BDUFUoX2NwdSktPnJ1bnEpKQogCkBAIC0xNjAsNyAr
MTYwLDcgQEAgc3RydWN0IGNzY2hlZF9wY3B1IHsKIC8qCiAgKiBWaXJ0dWFsIENQVQogICovCi1z
dHJ1Y3QgY3NjaGVkX3ZjcHUgeworc3RydWN0IGNzY2hlZF9pdGVtIHsKICAgICBzdHJ1Y3QgbGlz
dF9oZWFkIHJ1bnFfZWxlbTsKICAgICBzdHJ1Y3QgbGlzdF9oZWFkIGFjdGl2ZV92Y3B1X2VsZW07
CiAKQEAgLTIzMSwxNSArMjMxLDE1IEBAIHN0YXRpYyB2b2lkIGNzY2hlZF90aWNrKHZvaWQgKl9j
cHUpOwogc3RhdGljIHZvaWQgY3NjaGVkX2FjY3Qodm9pZCAqZHVtbXkpOwogCiBzdGF0aWMgaW5s
aW5lIGludAotX192Y3B1X29uX3J1bnEoc3RydWN0IGNzY2hlZF92Y3B1ICpzdmMpCitfX3ZjcHVf
b25fcnVucShzdHJ1Y3QgY3NjaGVkX2l0ZW0gKnN2YykKIHsKICAgICByZXR1cm4gIWxpc3RfZW1w
dHkoJnN2Yy0+cnVucV9lbGVtKTsKIH0KIAotc3RhdGljIGlubGluZSBzdHJ1Y3QgY3NjaGVkX3Zj
cHUgKgorc3RhdGljIGlubGluZSBzdHJ1Y3QgY3NjaGVkX2l0ZW0gKgogX19ydW5xX2VsZW0oc3Ry
dWN0IGxpc3RfaGVhZCAqZWxlbSkKIHsKLSAgICByZXR1cm4gbGlzdF9lbnRyeShlbGVtLCBzdHJ1
Y3QgY3NjaGVkX3ZjcHUsIHJ1bnFfZWxlbSk7CisgICAgcmV0dXJuIGxpc3RfZW50cnkoZWxlbSwg
c3RydWN0IGNzY2hlZF9pdGVtLCBydW5xX2VsZW0pOwogfQogCiAvKiBJcyB0aGUgZmlyc3QgZWxl
bWVudCBvZiBjcHUncyBydW5xIChpZiBhbnkpIGNwdSdzIGlkbGUgdmNwdT8gKi8KQEAgLTI3MSw3
ICsyNzEsNyBAQCBkZWNfbnJfcnVubmFibGUodW5zaWduZWQgaW50IGNwdSkKIH0KIAogc3RhdGlj
IGlubGluZSB2b2lkCi1fX3J1bnFfaW5zZXJ0KHN0cnVjdCBjc2NoZWRfdmNwdSAqc3ZjKQorX19y
dW5xX2luc2VydChzdHJ1Y3QgY3NjaGVkX2l0ZW0gKnN2YykKIHsKICAgICB1bnNpZ25lZCBpbnQg
Y3B1ID0gc3ZjLT52Y3B1LT5wcm9jZXNzb3I7CiAgICAgY29uc3Qgc3RydWN0IGxpc3RfaGVhZCAq
IGNvbnN0IHJ1bnEgPSBSVU5RKGNwdSk7CkBAIC0yODEsNyArMjgxLDcgQEAgX19ydW5xX2luc2Vy
dChzdHJ1Y3QgY3NjaGVkX3ZjcHUgKnN2YykKIAogICAgIGxpc3RfZm9yX2VhY2goIGl0ZXIsIHJ1
bnEgKQogICAgIHsKLSAgICAgICAgY29uc3Qgc3RydWN0IGNzY2hlZF92Y3B1ICogY29uc3QgaXRl
cl9zdmMgPSBfX3J1bnFfZWxlbShpdGVyKTsKKyAgICAgICAgY29uc3Qgc3RydWN0IGNzY2hlZF9p
dGVtICogY29uc3QgaXRlcl9zdmMgPSBfX3J1bnFfZWxlbShpdGVyKTsKICAgICAgICAgaWYgKCBz
dmMtPnByaSA+IGl0ZXJfc3ZjLT5wcmkgKQogICAgICAgICAgICAgYnJlYWs7CiAgICAgfQpAQCAt
MzAyLDM0ICszMDIsMzQgQEAgX19ydW5xX2luc2VydChzdHJ1Y3QgY3NjaGVkX3ZjcHUgKnN2YykK
IH0KIAogc3RhdGljIGlubGluZSB2b2lkCi1ydW5xX2luc2VydChzdHJ1Y3QgY3NjaGVkX3ZjcHUg
KnN2YykKK3J1bnFfaW5zZXJ0KHN0cnVjdCBjc2NoZWRfaXRlbSAqc3ZjKQogewogICAgIF9fcnVu
cV9pbnNlcnQoc3ZjKTsKICAgICBpbmNfbnJfcnVubmFibGUoc3ZjLT52Y3B1LT5wcm9jZXNzb3Ip
OwogfQogCiBzdGF0aWMgaW5saW5lIHZvaWQKLV9fcnVucV9yZW1vdmUoc3RydWN0IGNzY2hlZF92
Y3B1ICpzdmMpCitfX3J1bnFfcmVtb3ZlKHN0cnVjdCBjc2NoZWRfaXRlbSAqc3ZjKQogewogICAg
IEJVR19PTiggIV9fdmNwdV9vbl9ydW5xKHN2YykgKTsKICAgICBsaXN0X2RlbF9pbml0KCZzdmMt
PnJ1bnFfZWxlbSk7CiB9CiAKIHN0YXRpYyBpbmxpbmUgdm9pZAotcnVucV9yZW1vdmUoc3RydWN0
IGNzY2hlZF92Y3B1ICpzdmMpCitydW5xX3JlbW92ZShzdHJ1Y3QgY3NjaGVkX2l0ZW0gKnN2YykK
IHsKICAgICBkZWNfbnJfcnVubmFibGUoc3ZjLT52Y3B1LT5wcm9jZXNzb3IpOwogICAgIF9fcnVu
cV9yZW1vdmUoc3ZjKTsKIH0KIAotc3RhdGljIHZvaWQgYnVybl9jcmVkaXRzKHN0cnVjdCBjc2No
ZWRfdmNwdSAqc3ZjLCBzX3RpbWVfdCBub3cpCitzdGF0aWMgdm9pZCBidXJuX2NyZWRpdHMoc3Ry
dWN0IGNzY2hlZF9pdGVtICpzdmMsIHNfdGltZV90IG5vdykKIHsKICAgICBzX3RpbWVfdCBkZWx0
YTsKICAgICB1aW50NjRfdCB2YWw7CiAgICAgdW5zaWduZWQgaW50IGNyZWRpdHM7CiAKICAgICAv
KiBBc3NlcnQgc3ZjIGlzIGN1cnJlbnQgKi8KLSAgICBBU1NFUlQoIHN2YyA9PSBDU0NIRURfVkNQ
VShjdXJyX29uX2NwdShzdmMtPnZjcHUtPnByb2Nlc3NvcikpICk7CisgICAgQVNTRVJUKCBzdmMg
PT0gQ1NDSEVEX0lURU0oY3Vycl9vbl9jcHUoc3ZjLT52Y3B1LT5wcm9jZXNzb3IpKSApOwogCiAg
ICAgaWYgKCAoZGVsdGEgPSBub3cgLSBzdmMtPnN0YXJ0X3RpbWUpIDw9IDAgKQogICAgICAgICBy
ZXR1cm47CkBAIC0zNDcsMTAgKzM0NywxMCBAQCBib29sZWFuX3BhcmFtKCJ0aWNrbGVfb25lX2lk
bGVfY3B1Iiwgb3B0X3RpY2tsZV9vbmVfaWRsZSk7CiAKIERFRklORV9QRVJfQ1BVKHVuc2lnbmVk
IGludCwgbGFzdF90aWNrbGVfY3B1KTsKIAotc3RhdGljIGlubGluZSB2b2lkIF9fcnVucV90aWNr
bGUoc3RydWN0IGNzY2hlZF92Y3B1ICpuZXcpCitzdGF0aWMgaW5saW5lIHZvaWQgX19ydW5xX3Rp
Y2tsZShzdHJ1Y3QgY3NjaGVkX2l0ZW0gKm5ldykKIHsKICAgICB1bnNpZ25lZCBpbnQgY3B1ID0g
bmV3LT52Y3B1LT5wcm9jZXNzb3I7Ci0gICAgc3RydWN0IGNzY2hlZF92Y3B1ICogY29uc3QgY3Vy
ID0gQ1NDSEVEX1ZDUFUoY3Vycl9vbl9jcHUoY3B1KSk7CisgICAgc3RydWN0IGNzY2hlZF9pdGVt
ICogY29uc3QgY3VyID0gQ1NDSEVEX0lURU0oY3Vycl9vbl9jcHUoY3B1KSk7CiAgICAgc3RydWN0
IGNzY2hlZF9wcml2YXRlICpwcnYgPSBDU0NIRURfUFJJVihwZXJfY3B1KHNjaGVkdWxlciwgY3B1
KSk7CiAgICAgY3B1bWFza190IG1hc2ssIGlkbGVfbWFzaywgKm9ubGluZTsKICAgICBpbnQgYmFs
YW5jZV9zdGVwLCBpZGxlcnNfZW1wdHk7CkBAIC02MDUsNyArNjA1LDcgQEAgaW5pdF9wZGF0YShz
dHJ1Y3QgY3NjaGVkX3ByaXZhdGUgKnBydiwgc3RydWN0IGNzY2hlZF9wY3B1ICpzcGMsIGludCBj
cHUpCiAgICAgc3BjLT5pZGxlX2JpYXMgPSBucl9jcHVfaWRzIC0gMTsKIAogICAgIC8qIFN0YXJ0
IG9mZiBpZGxpbmcuLi4gKi8KLSAgICBCVUdfT04oIWlzX2lkbGVfdmNwdShjdXJyX29uX2NwdShj
cHUpKSk7CisgICAgQlVHX09OKCFpc19pZGxlX3ZjcHUoY3Vycl9vbl9jcHUoY3B1KS0+dmNwdSkp
OwogICAgIGNwdW1hc2tfc2V0X2NwdShjcHUsIHBydi0+aWRsZXJzKTsKICAgICBzcGMtPm5yX3J1
bm5hYmxlID0gMDsKIH0KQEAgLTYzNyw3ICs2MzcsNyBAQCBjc2NoZWRfc3dpdGNoX3NjaGVkKHN0
cnVjdCBzY2hlZHVsZXIgKm5ld19vcHMsIHVuc2lnbmVkIGludCBjcHUsCiB7CiAgICAgc3RydWN0
IHNjaGVkdWxlX2RhdGEgKnNkID0gJnBlcl9jcHUoc2NoZWR1bGVfZGF0YSwgY3B1KTsKICAgICBz
dHJ1Y3QgY3NjaGVkX3ByaXZhdGUgKnBydiA9IENTQ0hFRF9QUklWKG5ld19vcHMpOwotICAgIHN0
cnVjdCBjc2NoZWRfdmNwdSAqc3ZjID0gdmRhdGE7CisgICAgc3RydWN0IGNzY2hlZF9pdGVtICpz
dmMgPSB2ZGF0YTsKIAogICAgIEFTU0VSVChzdmMgJiYgaXNfaWRsZV92Y3B1KHN2Yy0+dmNwdSkp
OwogCkBAIC02NjksNyArNjY5LDcgQEAgY3NjaGVkX3N3aXRjaF9zY2hlZChzdHJ1Y3Qgc2NoZWR1
bGVyICpuZXdfb3BzLCB1bnNpZ25lZCBpbnQgY3B1LAogc3RhdGljIGlubGluZSB2b2lkCiBfX2Nz
Y2hlZF92Y3B1X2NoZWNrKHN0cnVjdCB2Y3B1ICp2YykKIHsKLSAgICBzdHJ1Y3QgY3NjaGVkX3Zj
cHUgKiBjb25zdCBzdmMgPSBDU0NIRURfVkNQVSh2Yyk7CisgICAgc3RydWN0IGNzY2hlZF9pdGVt
ICogY29uc3Qgc3ZjID0gQ1NDSEVEX0lURU0odmMtPnNjaGVkX2l0ZW0pOwogICAgIHN0cnVjdCBj
c2NoZWRfZG9tICogY29uc3Qgc2RvbSA9IHN2Yy0+c2RvbTsKIAogICAgIEJVR19PTiggc3ZjLT52
Y3B1ICE9IHZjICk7CkBAIC04NzEsNyArODcxLDcgQEAgc3RhdGljIHN0cnVjdCBzY2hlZF9yZXNv
dXJjZSAqCiBjc2NoZWRfcmVzX3BpY2soY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1
Y3Qgc2NoZWRfaXRlbSAqaXRlbSkKIHsKICAgICBzdHJ1Y3QgdmNwdSAqdmMgPSBpdGVtLT52Y3B1
OwotICAgIHN0cnVjdCBjc2NoZWRfdmNwdSAqc3ZjID0gQ1NDSEVEX1ZDUFUodmMpOworICAgIHN0
cnVjdCBjc2NoZWRfaXRlbSAqc3ZjID0gQ1NDSEVEX0lURU0oaXRlbSk7CiAKICAgICAvKgogICAg
ICAqIFdlIGhhdmUgYmVlbiBjYWxsZWQgYnkgdmNwdV9taWdyYXRlKCkgKGluIHNjaGVkdWxlLmMp
LCBhcyBwYXJ0CkBAIC04ODUsNyArODg1LDcgQEAgY3NjaGVkX3Jlc19waWNrKGNvbnN0IHN0cnVj
dCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX2l0ZW0gKml0ZW0pCiB9CiAKIHN0YXRpYyBp
bmxpbmUgdm9pZAotX19jc2NoZWRfdmNwdV9hY2N0X3N0YXJ0KHN0cnVjdCBjc2NoZWRfcHJpdmF0
ZSAqcHJ2LCBzdHJ1Y3QgY3NjaGVkX3ZjcHUgKnN2YykKK19fY3NjaGVkX3ZjcHVfYWNjdF9zdGFy
dChzdHJ1Y3QgY3NjaGVkX3ByaXZhdGUgKnBydiwgc3RydWN0IGNzY2hlZF9pdGVtICpzdmMpCiB7
CiAgICAgc3RydWN0IGNzY2hlZF9kb20gKiBjb25zdCBzZG9tID0gc3ZjLT5zZG9tOwogICAgIHVu
c2lnbmVkIGxvbmcgZmxhZ3M7CkBAIC05MTUsNyArOTE1LDcgQEAgX19jc2NoZWRfdmNwdV9hY2N0
X3N0YXJ0KHN0cnVjdCBjc2NoZWRfcHJpdmF0ZSAqcHJ2LCBzdHJ1Y3QgY3NjaGVkX3ZjcHUgKnN2
YykKIAogc3RhdGljIGlubGluZSB2b2lkCiBfX2NzY2hlZF92Y3B1X2FjY3Rfc3RvcF9sb2NrZWQo
c3RydWN0IGNzY2hlZF9wcml2YXRlICpwcnYsCi0gICAgc3RydWN0IGNzY2hlZF92Y3B1ICpzdmMp
CisgICAgc3RydWN0IGNzY2hlZF9pdGVtICpzdmMpCiB7CiAgICAgc3RydWN0IGNzY2hlZF9kb20g
KiBjb25zdCBzZG9tID0gc3ZjLT5zZG9tOwogCkBAIC05NDAsNyArOTQwLDcgQEAgX19jc2NoZWRf
dmNwdV9hY2N0X3N0b3BfbG9ja2VkKHN0cnVjdCBjc2NoZWRfcHJpdmF0ZSAqcHJ2LAogc3RhdGlj
IHZvaWQKIGNzY2hlZF92Y3B1X2FjY3Qoc3RydWN0IGNzY2hlZF9wcml2YXRlICpwcnYsIHVuc2ln
bmVkIGludCBjcHUpCiB7Ci0gICAgc3RydWN0IGNzY2hlZF92Y3B1ICogY29uc3Qgc3ZjID0gQ1ND
SEVEX1ZDUFUoY3VycmVudCk7CisgICAgc3RydWN0IGNzY2hlZF9pdGVtICogY29uc3Qgc3ZjID0g
Q1NDSEVEX0lURU0oY3VycmVudC0+c2NoZWRfaXRlbSk7CiAgICAgY29uc3Qgc3RydWN0IHNjaGVk
dWxlciAqb3BzID0gcGVyX2NwdShzY2hlZHVsZXIsIGNwdSk7CiAKICAgICBBU1NFUlQoIGN1cnJl
bnQtPnByb2Nlc3NvciA9PSBjcHUgKTsKQEAgLTEwMDksMTAgKzEwMDksMTAgQEAgY3NjaGVkX2Fs
bG9jX3ZkYXRhKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX2l0ZW0g
Kml0ZW0sCiAgICAgICAgICAgICAgICAgICAgdm9pZCAqZGQpCiB7CiAgICAgc3RydWN0IHZjcHUg
KnZjID0gaXRlbS0+dmNwdTsKLSAgICBzdHJ1Y3QgY3NjaGVkX3ZjcHUgKnN2YzsKKyAgICBzdHJ1
Y3QgY3NjaGVkX2l0ZW0gKnN2YzsKIAogICAgIC8qIEFsbG9jYXRlIHBlci1WQ1BVIGluZm8gKi8K
LSAgICBzdmMgPSB4emFsbG9jKHN0cnVjdCBjc2NoZWRfdmNwdSk7CisgICAgc3ZjID0geHphbGxv
YyhzdHJ1Y3QgY3NjaGVkX2l0ZW0pOwogICAgIGlmICggc3ZjID09IE5VTEwgKQogICAgICAgICBy
ZXR1cm4gTlVMTDsKIApAQCAtMTAzMSw3ICsxMDMxLDcgQEAgc3RhdGljIHZvaWQKIGNzY2hlZF9p
dGVtX2luc2VydChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF9pdGVt
ICppdGVtKQogewogICAgIHN0cnVjdCB2Y3B1ICp2YyA9IGl0ZW0tPnZjcHU7Ci0gICAgc3RydWN0
IGNzY2hlZF92Y3B1ICpzdmMgPSBpdGVtLT5wcml2OworICAgIHN0cnVjdCBjc2NoZWRfaXRlbSAq
c3ZjID0gaXRlbS0+cHJpdjsKICAgICBzcGlubG9ja190ICpsb2NrOwogCiAgICAgQlVHX09OKCBp
c19pZGxlX3ZjcHUodmMpICk7CkBAIC0xMDU3LDcgKzEwNTcsNyBAQCBjc2NoZWRfaXRlbV9pbnNl
cnQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfaXRlbSAqaXRlbSkK
IHN0YXRpYyB2b2lkCiBjc2NoZWRfZnJlZV92ZGF0YShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpv
cHMsIHZvaWQgKnByaXYpCiB7Ci0gICAgc3RydWN0IGNzY2hlZF92Y3B1ICpzdmMgPSBwcml2Owor
ICAgIHN0cnVjdCBjc2NoZWRfaXRlbSAqc3ZjID0gcHJpdjsKIAogICAgIEJVR19PTiggIWxpc3Rf
ZW1wdHkoJnN2Yy0+cnVucV9lbGVtKSApOwogCkBAIC0xMDY4LDggKzEwNjgsNyBAQCBzdGF0aWMg
dm9pZAogY3NjaGVkX2l0ZW1fcmVtb3ZlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3Ry
dWN0IHNjaGVkX2l0ZW0gKml0ZW0pCiB7CiAgICAgc3RydWN0IGNzY2hlZF9wcml2YXRlICpwcnYg
PSBDU0NIRURfUFJJVihvcHMpOwotICAgIHN0cnVjdCB2Y3B1ICp2YyA9IGl0ZW0tPnZjcHU7Ci0g
ICAgc3RydWN0IGNzY2hlZF92Y3B1ICogY29uc3Qgc3ZjID0gQ1NDSEVEX1ZDUFUodmMpOworICAg
IHN0cnVjdCBjc2NoZWRfaXRlbSAqIGNvbnN0IHN2YyA9IENTQ0hFRF9JVEVNKGl0ZW0pOwogICAg
IHN0cnVjdCBjc2NoZWRfZG9tICogY29uc3Qgc2RvbSA9IHN2Yy0+c2RvbTsKIAogICAgIFNDSEVE
X1NUQVRfQ1JBTksodmNwdV9yZW1vdmUpOwpAQCAtMTA5NiwxNCArMTA5NSwxNCBAQCBzdGF0aWMg
dm9pZAogY3NjaGVkX2l0ZW1fc2xlZXAoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1
Y3Qgc2NoZWRfaXRlbSAqaXRlbSkKIHsKICAgICBzdHJ1Y3QgdmNwdSAqdmMgPSBpdGVtLT52Y3B1
OwotICAgIHN0cnVjdCBjc2NoZWRfdmNwdSAqIGNvbnN0IHN2YyA9IENTQ0hFRF9WQ1BVKHZjKTsK
KyAgICBzdHJ1Y3QgY3NjaGVkX2l0ZW0gKiBjb25zdCBzdmMgPSBDU0NIRURfSVRFTShpdGVtKTsK
ICAgICB1bnNpZ25lZCBpbnQgY3B1ID0gdmMtPnByb2Nlc3NvcjsKIAogICAgIFNDSEVEX1NUQVRf
Q1JBTksodmNwdV9zbGVlcCk7CiAKICAgICBCVUdfT04oIGlzX2lkbGVfdmNwdSh2YykgKTsKIAot
ICAgIGlmICggY3Vycl9vbl9jcHUoY3B1KSA9PSB2YyApCisgICAgaWYgKCBjdXJyX29uX2NwdShj
cHUpID09IGl0ZW0gKQogICAgIHsKICAgICAgICAgLyoKICAgICAgICAgICogV2UgYXJlIGFib3V0
IHRvIHRpY2tsZSBjcHUsIHNvIHdlIHNob3VsZCBjbGVhciBpdHMgYml0IGluIGlkbGVycy4KQEAg
LTExMjEsMTIgKzExMjAsMTIgQEAgc3RhdGljIHZvaWQKIGNzY2hlZF9pdGVtX3dha2UoY29uc3Qg
c3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfaXRlbSAqaXRlbSkKIHsKICAgICBz
dHJ1Y3QgdmNwdSAqdmMgPSBpdGVtLT52Y3B1OwotICAgIHN0cnVjdCBjc2NoZWRfdmNwdSAqIGNv
bnN0IHN2YyA9IENTQ0hFRF9WQ1BVKHZjKTsKKyAgICBzdHJ1Y3QgY3NjaGVkX2l0ZW0gKiBjb25z
dCBzdmMgPSBDU0NIRURfSVRFTShpdGVtKTsKICAgICBib29sX3QgbWlncmF0aW5nOwogCiAgICAg
QlVHX09OKCBpc19pZGxlX3ZjcHUodmMpICk7CiAKLSAgICBpZiAoIHVubGlrZWx5KGN1cnJfb25f
Y3B1KHZjLT5wcm9jZXNzb3IpID09IHZjKSApCisgICAgaWYgKCB1bmxpa2VseShjdXJyX29uX2Nw
dSh2Yy0+cHJvY2Vzc29yKSA9PSBpdGVtKSApCiAgICAgewogICAgICAgICBTQ0hFRF9TVEFUX0NS
QU5LKHZjcHVfd2FrZV9ydW5uaW5nKTsKICAgICAgICAgcmV0dXJuOwpAQCAtMTE4Miw4ICsxMTgx
LDcgQEAgY3NjaGVkX2l0ZW1fd2FrZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVj
dCBzY2hlZF9pdGVtICppdGVtKQogc3RhdGljIHZvaWQKIGNzY2hlZF9pdGVtX3lpZWxkKGNvbnN0
IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX2l0ZW0gKml0ZW0pCiB7Ci0gICAg
c3RydWN0IHZjcHUgKnZjID0gaXRlbS0+dmNwdTsKLSAgICBzdHJ1Y3QgY3NjaGVkX3ZjcHUgKiBj
b25zdCBzdmMgPSBDU0NIRURfVkNQVSh2Yyk7CisgICAgc3RydWN0IGNzY2hlZF9pdGVtICogY29u
c3Qgc3ZjID0gQ1NDSEVEX0lURU0oaXRlbSk7CiAKICAgICAvKiBMZXQgdGhlIHNjaGVkdWxlciBr
bm93IHRoYXQgdGhpcyB2Y3B1IGlzIHRyeWluZyB0byB5aWVsZCAqLwogICAgIHNldF9iaXQoQ1ND
SEVEX0ZMQUdfVkNQVV9ZSUVMRCwgJnN2Yy0+ZmxhZ3MpOwpAQCAtMTIzOCw4ICsxMjM2LDcgQEAg
c3RhdGljIHZvaWQKIGNzY2hlZF9hZmZfY250bChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMs
IHN0cnVjdCBzY2hlZF9pdGVtICppdGVtLAogICAgICAgICAgICAgICAgIGNvbnN0IGNwdW1hc2tf
dCAqaGFyZCwgY29uc3QgY3B1bWFza190ICpzb2Z0KQogewotICAgIHN0cnVjdCB2Y3B1ICp2ID0g
aXRlbS0+dmNwdTsKLSAgICBzdHJ1Y3QgY3NjaGVkX3ZjcHUgKnN2YyA9IENTQ0hFRF9WQ1BVKHYp
OworICAgIHN0cnVjdCBjc2NoZWRfaXRlbSAqc3ZjID0gQ1NDSEVEX0lURU0oaXRlbSk7CiAKICAg
ICBpZiAoICFoYXJkICkKICAgICAgICAgcmV0dXJuOwpAQCAtMTM0Miw3ICsxMzM5LDcgQEAgY3Nj
aGVkX3J1bnFfc29ydChzdHJ1Y3QgY3NjaGVkX3ByaXZhdGUgKnBydiwgdW5zaWduZWQgaW50IGNw
dSkKIHsKICAgICBzdHJ1Y3QgY3NjaGVkX3BjcHUgKiBjb25zdCBzcGMgPSBDU0NIRURfUENQVShj
cHUpOwogICAgIHN0cnVjdCBsaXN0X2hlYWQgKnJ1bnEsICplbGVtLCAqbmV4dCwgKmxhc3RfdW5k
ZXI7Ci0gICAgc3RydWN0IGNzY2hlZF92Y3B1ICpzdmNfZWxlbTsKKyAgICBzdHJ1Y3QgY3NjaGVk
X2l0ZW0gKnN2Y19lbGVtOwogICAgIHNwaW5sb2NrX3QgKmxvY2s7CiAgICAgdW5zaWduZWQgbG9u
ZyBmbGFnczsKICAgICBpbnQgc29ydF9lcG9jaDsKQEAgLTEzODgsNyArMTM4NSw3IEBAIGNzY2hl
ZF9hY2N0KHZvaWQqIGR1bW15KQogICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAgICAgc3RydWN0
IGxpc3RfaGVhZCAqaXRlcl92Y3B1LCAqbmV4dF92Y3B1OwogICAgIHN0cnVjdCBsaXN0X2hlYWQg
Kml0ZXJfc2RvbSwgKm5leHRfc2RvbTsKLSAgICBzdHJ1Y3QgY3NjaGVkX3ZjcHUgKnN2YzsKKyAg
ICBzdHJ1Y3QgY3NjaGVkX2l0ZW0gKnN2YzsKICAgICBzdHJ1Y3QgY3NjaGVkX2RvbSAqc2RvbTsK
ICAgICB1aW50MzJfdCBjcmVkaXRfdG90YWw7CiAgICAgdWludDMyX3Qgd2VpZ2h0X3RvdGFsOwpA
QCAtMTUxMSw3ICsxNTA4LDcgQEAgY3NjaGVkX2FjY3Qodm9pZCogZHVtbXkpCiAKICAgICAgICAg
bGlzdF9mb3JfZWFjaF9zYWZlKCBpdGVyX3ZjcHUsIG5leHRfdmNwdSwgJnNkb20tPmFjdGl2ZV92
Y3B1ICkKICAgICAgICAgewotICAgICAgICAgICAgc3ZjID0gbGlzdF9lbnRyeShpdGVyX3ZjcHUs
IHN0cnVjdCBjc2NoZWRfdmNwdSwgYWN0aXZlX3ZjcHVfZWxlbSk7CisgICAgICAgICAgICBzdmMg
PSBsaXN0X2VudHJ5KGl0ZXJfdmNwdSwgc3RydWN0IGNzY2hlZF9pdGVtLCBhY3RpdmVfdmNwdV9l
bGVtKTsKICAgICAgICAgICAgIEJVR19PTiggc2RvbSAhPSBzdmMtPnNkb20gKTsKIAogICAgICAg
ICAgICAgLyogSW5jcmVtZW50IGNyZWRpdCAqLwpAQCAtMTYxNCwxMiArMTYxMSwxMiBAQCBjc2No
ZWRfdGljayh2b2lkICpfY3B1KQogICAgIHNldF90aW1lcigmc3BjLT50aWNrZXIsIE5PVygpICsg
TUlDUk9TRUNTKHBydi0+dGlja19wZXJpb2RfdXMpICk7CiB9CiAKLXN0YXRpYyBzdHJ1Y3QgY3Nj
aGVkX3ZjcHUgKgorc3RhdGljIHN0cnVjdCBjc2NoZWRfaXRlbSAqCiBjc2NoZWRfcnVucV9zdGVh
bChpbnQgcGVlcl9jcHUsIGludCBjcHUsIGludCBwcmksIGludCBiYWxhbmNlX3N0ZXApCiB7CiAg
ICAgY29uc3Qgc3RydWN0IGNzY2hlZF9wcml2YXRlICogY29uc3QgcHJ2ID0gQ1NDSEVEX1BSSVYo
cGVyX2NwdShzY2hlZHVsZXIsIGNwdSkpOwogICAgIGNvbnN0IHN0cnVjdCBjc2NoZWRfcGNwdSAq
IGNvbnN0IHBlZXJfcGNwdSA9IENTQ0hFRF9QQ1BVKHBlZXJfY3B1KTsKLSAgICBzdHJ1Y3QgY3Nj
aGVkX3ZjcHUgKnNwZWVyOworICAgIHN0cnVjdCBjc2NoZWRfaXRlbSAqc3BlZXI7CiAgICAgc3Ry
dWN0IGxpc3RfaGVhZCAqaXRlcjsKICAgICBzdHJ1Y3QgdmNwdSAqdmM7CiAKQEAgLTE2MjksNyAr
MTYyNiw3IEBAIGNzY2hlZF9ydW5xX3N0ZWFsKGludCBwZWVyX2NwdSwgaW50IGNwdSwgaW50IHBy
aSwgaW50IGJhbGFuY2Vfc3RlcCkKICAgICAgKiBEb24ndCBzdGVhbCBmcm9tIGFuIGlkbGUgQ1BV
J3MgcnVucSBiZWNhdXNlIGl0J3MgYWJvdXQgdG8KICAgICAgKiBwaWNrIHVwIHdvcmsgZnJvbSBp
dCBpdHNlbGYuCiAgICAgICovCi0gICAgaWYgKCB1bmxpa2VseShpc19pZGxlX3ZjcHUoY3Vycl9v
bl9jcHUocGVlcl9jcHUpKSkgKQorICAgIGlmICggdW5saWtlbHkoaXNfaWRsZV92Y3B1KGN1cnJf
b25fY3B1KHBlZXJfY3B1KS0+dmNwdSkpICkKICAgICAgICAgZ290byBvdXQ7CiAKICAgICBsaXN0
X2Zvcl9lYWNoKCBpdGVyLCAmcGVlcl9wY3B1LT5ydW5xICkKQEAgLTE2OTEsMTIgKzE2ODgsMTIg
QEAgY3NjaGVkX3J1bnFfc3RlYWwoaW50IHBlZXJfY3B1LCBpbnQgY3B1LCBpbnQgcHJpLCBpbnQg
YmFsYW5jZV9zdGVwKQogICAgIHJldHVybiBOVUxMOwogfQogCi1zdGF0aWMgc3RydWN0IGNzY2hl
ZF92Y3B1ICoKK3N0YXRpYyBzdHJ1Y3QgY3NjaGVkX2l0ZW0gKgogY3NjaGVkX2xvYWRfYmFsYW5j
ZShzdHJ1Y3QgY3NjaGVkX3ByaXZhdGUgKnBydiwgaW50IGNwdSwKLSAgICBzdHJ1Y3QgY3NjaGVk
X3ZjcHUgKnNuZXh0LCBib29sX3QgKnN0b2xlbikKKyAgICBzdHJ1Y3QgY3NjaGVkX2l0ZW0gKnNu
ZXh0LCBib29sX3QgKnN0b2xlbikKIHsKICAgICBzdHJ1Y3QgY3B1cG9vbCAqYyA9IHBlcl9jcHUo
Y3B1cG9vbCwgY3B1KTsKLSAgICBzdHJ1Y3QgY3NjaGVkX3ZjcHUgKnNwZWVyOworICAgIHN0cnVj
dCBjc2NoZWRfaXRlbSAqc3BlZXI7CiAgICAgY3B1bWFza190IHdvcmtlcnM7CiAgICAgY3B1bWFz
a190ICpvbmxpbmU7CiAgICAgaW50IHBlZXJfY3B1LCBmaXJzdF9jcHUsIHBlZXJfbm9kZSwgYnN0
ZXA7CkBAIC0xODQ1LDkgKzE4NDIsOSBAQCBjc2NoZWRfc2NoZWR1bGUoCiB7CiAgICAgY29uc3Qg
aW50IGNwdSA9IHNtcF9wcm9jZXNzb3JfaWQoKTsKICAgICBzdHJ1Y3QgbGlzdF9oZWFkICogY29u
c3QgcnVucSA9IFJVTlEoY3B1KTsKLSAgICBzdHJ1Y3QgY3NjaGVkX3ZjcHUgKiBjb25zdCBzY3Vy
ciA9IENTQ0hFRF9WQ1BVKGN1cnJlbnQpOworICAgIHN0cnVjdCBjc2NoZWRfaXRlbSAqIGNvbnN0
IHNjdXJyID0gQ1NDSEVEX0lURU0oY3VycmVudC0+c2NoZWRfaXRlbSk7CiAgICAgc3RydWN0IGNz
Y2hlZF9wcml2YXRlICpwcnYgPSBDU0NIRURfUFJJVihvcHMpOwotICAgIHN0cnVjdCBjc2NoZWRf
dmNwdSAqc25leHQ7CisgICAgc3RydWN0IGNzY2hlZF9pdGVtICpzbmV4dDsKICAgICBzdHJ1Y3Qg
dGFza19zbGljZSByZXQ7CiAgICAgc190aW1lX3QgcnVudGltZSwgdHNsaWNlOwogCkBAIC0xOTYz
LDcgKzE5NjAsNyBAQCBjc2NoZWRfc2NoZWR1bGUoCiAgICAgaWYgKCB0YXNrbGV0X3dvcmtfc2No
ZWR1bGVkICkKICAgICB7CiAgICAgICAgIFRSQUNFXzBEKFRSQ19DU0NIRURfU0NIRURfVEFTS0xF
VCk7Ci0gICAgICAgIHNuZXh0ID0gQ1NDSEVEX1ZDUFUoaWRsZV92Y3B1W2NwdV0pOworICAgICAg
ICBzbmV4dCA9IENTQ0hFRF9JVEVNKGlkbGVfdmNwdVtjcHVdLT5zY2hlZF9pdGVtKTsKICAgICAg
ICAgc25leHQtPnByaSA9IENTQ0hFRF9QUklfVFNfQk9PU1Q7CiAgICAgfQogCkBAIC0yMDE1LDcg
KzIwMTIsNyBAQCBvdXQ6CiB9CiAKIHN0YXRpYyB2b2lkCi1jc2NoZWRfZHVtcF92Y3B1KHN0cnVj
dCBjc2NoZWRfdmNwdSAqc3ZjKQorY3NjaGVkX2R1bXBfdmNwdShzdHJ1Y3QgY3NjaGVkX2l0ZW0g
KnN2YykKIHsKICAgICBzdHJ1Y3QgY3NjaGVkX2RvbSAqIGNvbnN0IHNkb20gPSBzdmMtPnNkb207
CiAKQEAgLTIwNTEsNyArMjA0OCw3IEBAIGNzY2hlZF9kdW1wX3BjcHUoY29uc3Qgc3RydWN0IHNj
aGVkdWxlciAqb3BzLCBpbnQgY3B1KQogICAgIHN0cnVjdCBsaXN0X2hlYWQgKnJ1bnEsICppdGVy
OwogICAgIHN0cnVjdCBjc2NoZWRfcHJpdmF0ZSAqcHJ2ID0gQ1NDSEVEX1BSSVYob3BzKTsKICAg
ICBzdHJ1Y3QgY3NjaGVkX3BjcHUgKnNwYzsKLSAgICBzdHJ1Y3QgY3NjaGVkX3ZjcHUgKnN2YzsK
KyAgICBzdHJ1Y3QgY3NjaGVkX2l0ZW0gKnN2YzsKICAgICBzcGlubG9ja190ICpsb2NrOwogICAg
IHVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAgICAgaW50IGxvb3A7CkBAIC0yMDc1LDcgKzIwNzIsNyBA
QCBjc2NoZWRfZHVtcF9wY3B1KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgaW50IGNwdSkK
ICAgICAgICAgICAgbnJfY3B1X2lkcywgY3B1bWFza19iaXRzKHBlcl9jcHUoY3B1X2NvcmVfbWFz
aywgY3B1KSkpOwogCiAgICAgLyogY3VycmVudCBWQ1BVIChub3RoaW5nIHRvIHNheSBpZiB0aGF0
J3MgdGhlIGlkbGUgdmNwdSkuICovCi0gICAgc3ZjID0gQ1NDSEVEX1ZDUFUoY3Vycl9vbl9jcHUo
Y3B1KSk7CisgICAgc3ZjID0gQ1NDSEVEX0lURU0oY3Vycl9vbl9jcHUoY3B1KSk7CiAgICAgaWYg
KCBzdmMgJiYgIWlzX2lkbGVfdmNwdShzdmMtPnZjcHUpICkKICAgICB7CiAgICAgICAgIHByaW50
aygiXHRydW46ICIpOwpAQCAtMjE0NCwxMCArMjE0MSwxMCBAQCBjc2NoZWRfZHVtcChjb25zdCBz
dHJ1Y3Qgc2NoZWR1bGVyICpvcHMpCiAKICAgICAgICAgbGlzdF9mb3JfZWFjaCggaXRlcl9zdmMs
ICZzZG9tLT5hY3RpdmVfdmNwdSApCiAgICAgICAgIHsKLSAgICAgICAgICAgIHN0cnVjdCBjc2No
ZWRfdmNwdSAqc3ZjOworICAgICAgICAgICAgc3RydWN0IGNzY2hlZF9pdGVtICpzdmM7CiAgICAg
ICAgICAgICBzcGlubG9ja190ICpsb2NrOwogCi0gICAgICAgICAgICBzdmMgPSBsaXN0X2VudHJ5
KGl0ZXJfc3ZjLCBzdHJ1Y3QgY3NjaGVkX3ZjcHUsIGFjdGl2ZV92Y3B1X2VsZW0pOworICAgICAg
ICAgICAgc3ZjID0gbGlzdF9lbnRyeShpdGVyX3N2Yywgc3RydWN0IGNzY2hlZF9pdGVtLCBhY3Rp
dmVfdmNwdV9lbGVtKTsKICAgICAgICAgICAgIGxvY2sgPSB2Y3B1X3NjaGVkdWxlX2xvY2soc3Zj
LT52Y3B1KTsKIAogICAgICAgICAgICAgcHJpbnRrKCJcdCUzZDogIiwgKytsb29wKTsKZGlmZiAt
LWdpdCBhL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0Mi5jIGIveGVuL2NvbW1vbi9zY2hlZF9jcmVk
aXQyLmMKaW5kZXggYzhhZTU4NTI3Mi4uNWEzYTBiYWJhYiAxMDA2NDQKLS0tIGEveGVuL2NvbW1v
bi9zY2hlZF9jcmVkaXQyLmMKKysrIGIveGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQyLmMKQEAgLTE3
Niw3ICsxNzYsNyBAQAogICogICAgIGxvYWQgYmFsYW5jaW5nOwogICogICsgc2VyaWFsaXplcyBy
dW5xdWV1ZSBvcGVyYXRpb25zIChyZW1vdmluZyBhbmQgaW5zZXJ0aW5nIHZjcHVzKTsKICAqICAr
IHByb3RlY3RzIHJ1bnF1ZXVlLXdpZGUgZGF0YSBpbiBjc2NoZWQyX3J1bnF1ZXVlX2RhdGE7Ci0g
KiAgKyBwcm90ZWN0cyB2Y3B1IHBhcmFtZXRlcnMgaW4gY3NjaGVkMl92Y3B1IGZvciB0aGUgdmNw
dSBpbiB0aGUKKyAqICArIHByb3RlY3RzIHZjcHUgcGFyYW1ldGVycyBpbiBjc2NoZWQyX2l0ZW0g
Zm9yIHRoZSB2Y3B1IGluIHRoZQogICogICAgcnVucXVldWUuCiAgKgogICogLSBQcml2YXRlIHNj
aGVkdWxlciBsb2NrCkBAIC01MTEsNyArNTExLDcgQEAgc3RydWN0IGNzY2hlZDJfcGNwdSB7CiAv
KgogICogVmlydHVhbCBDUFUKICAqLwotc3RydWN0IGNzY2hlZDJfdmNwdSB7CitzdHJ1Y3QgY3Nj
aGVkMl9pdGVtIHsKICAgICBzdHJ1Y3QgY3NjaGVkMl9kb20gKnNkb207ICAgICAgICAgIC8qIFVw
LXBvaW50ZXIgdG8gZG9tYWluICAgICAgICAgICAgICAgICovCiAgICAgc3RydWN0IHZjcHUgKnZj
cHU7ICAgICAgICAgICAgICAgICAvKiBVcC1wb2ludGVyLCB0byB2Y3B1ICAgICAgICAgICAgICAg
ICAqLwogICAgIHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZDsgLyogVXAtcG9pbnRl
ciB0byB0aGUgcnVucXVldWUgICAgICAgICAgKi8KQEAgLTU3MCw5ICs1NzAsOSBAQCBzdGF0aWMg
aW5saW5lIHN0cnVjdCBjc2NoZWQyX3BjcHUgKmNzY2hlZDJfcGNwdSh1bnNpZ25lZCBpbnQgY3B1
KQogICAgIHJldHVybiBwZXJfY3B1KHNjaGVkdWxlX2RhdGEsIGNwdSkuc2NoZWRfcHJpdjsKIH0K
IAotc3RhdGljIGlubGluZSBzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpjc2NoZWQyX3ZjcHUoY29uc3Qg
c3RydWN0IHZjcHUgKnYpCitzdGF0aWMgaW5saW5lIHN0cnVjdCBjc2NoZWQyX2l0ZW0gKmNzY2hl
ZDJfaXRlbShjb25zdCBzdHJ1Y3Qgc2NoZWRfaXRlbSAqaXRlbSkKIHsKLSAgICByZXR1cm4gdi0+
c2NoZWRfaXRlbS0+cHJpdjsKKyAgICByZXR1cm4gaXRlbS0+cHJpdjsKIH0KIAogc3RhdGljIGlu
bGluZSBzdHJ1Y3QgY3NjaGVkMl9kb20gKmNzY2hlZDJfZG9tKGNvbnN0IHN0cnVjdCBkb21haW4g
KmQpCkBAIC01OTQsNyArNTk0LDcgQEAgc3RhdGljIGlubGluZSBzdHJ1Y3QgY3NjaGVkMl9ydW5x
dWV1ZV9kYXRhICpjMnJxZChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiB9CiAKIC8qIERv
ZXMgdGhlIGRvbWFpbiBvZiB0aGlzIHZDUFUgaGF2ZSBhIGNhcD8gKi8KLXN0YXRpYyBpbmxpbmUg
Ym9vbCBoYXNfY2FwKGNvbnN0IHN0cnVjdCBjc2NoZWQyX3ZjcHUgKnN2YykKK3N0YXRpYyBpbmxp
bmUgYm9vbCBoYXNfY2FwKGNvbnN0IHN0cnVjdCBjc2NoZWQyX2l0ZW0gKnN2YykKIHsKICAgICBy
ZXR1cm4gc3ZjLT5idWRnZXQgIT0gU1RJTUVfTUFYOwogfQpAQCAtNjg4LDcgKzY4OCw3IEBAIHZv
aWQgc210X2lkbGVfbWFza19jbGVhcih1bnNpZ25lZCBpbnQgY3B1LCBjcHVtYXNrX3QgKm1hc2sp
CiAgKiBPZiBjb3Vyc2UsIDEsIDIgYW5kIDMgbWFrZXMgc2Vuc2Ugb25seSBpZiBzdmMgaGFzIGEg
c29mdCBhZmZpbml0eS4gQWxzbwogICogbm90ZSB0aGF0IGF0IGxlYXN0IDUgaXMgZ3VhcmFudGVl
ZCB0byBfYWx3YXlzXyByZXR1cm4gYXQgbGVhc3Qgb25lIHBjcHUuCiAgKi8KLXN0YXRpYyBpbnQg
Z2V0X2ZhbGxiYWNrX2NwdShzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpzdmMpCitzdGF0aWMgaW50IGdl
dF9mYWxsYmFja19jcHUoc3RydWN0IGNzY2hlZDJfaXRlbSAqc3ZjKQogewogICAgIHN0cnVjdCB2
Y3B1ICp2ID0gc3ZjLT52Y3B1OwogICAgIHVuc2lnbmVkIGludCBiczsKQEAgLTc3Myw3ICs3NzMs
NyBAQCBzdGF0aWMgaW50IGdldF9mYWxsYmFja19jcHUoc3RydWN0IGNzY2hlZDJfdmNwdSAqc3Zj
KQogICogRklYTUU6IERvIHByZS1jYWxjdWxhdGVkIGRpdmlzaW9uPwogICovCiBzdGF0aWMgdm9p
ZCB0MmNfdXBkYXRlKHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCwgc190aW1lX3Qg
dGltZSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGNzY2hlZDJfdmNwdSAqc3Zj
KQorICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl9pdGVtICpzdmMpCiB7
CiAgICAgdWludDY0X3QgdmFsID0gdGltZSAqIHJxZC0+bWF4X3dlaWdodCArIHN2Yy0+cmVzaWR1
YWw7CiAKQEAgLTc4MSw3ICs3ODEsNyBAQCBzdGF0aWMgdm9pZCB0MmNfdXBkYXRlKHN0cnVjdCBj
c2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCwgc190aW1lX3QgdGltZSwKICAgICBzdmMtPmNyZWRp
dCAtPSB2YWw7CiB9CiAKLXN0YXRpYyBzX3RpbWVfdCBjMnQoc3RydWN0IGNzY2hlZDJfcnVucXVl
dWVfZGF0YSAqcnFkLCBzX3RpbWVfdCBjcmVkaXQsIHN0cnVjdCBjc2NoZWQyX3ZjcHUgKnN2YykK
K3N0YXRpYyBzX3RpbWVfdCBjMnQoc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFkLCBz
X3RpbWVfdCBjcmVkaXQsIHN0cnVjdCBjc2NoZWQyX2l0ZW0gKnN2YykKIHsKICAgICByZXR1cm4g
Y3JlZGl0ICogc3ZjLT53ZWlnaHQgLyBycWQtPm1heF93ZWlnaHQ7CiB9CkBAIC03OTAsMTQgKzc5
MCwxNCBAQCBzdGF0aWMgc190aW1lX3QgYzJ0KHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEg
KnJxZCwgc190aW1lX3QgY3JlZGl0LCBzdHJ1Y3QgYwogICogUnVucXVldWUgcmVsYXRlZCBjb2Rl
LgogICovCiAKLXN0YXRpYyBpbmxpbmUgaW50IHZjcHVfb25fcnVucShzdHJ1Y3QgY3NjaGVkMl92
Y3B1ICpzdmMpCitzdGF0aWMgaW5saW5lIGludCB2Y3B1X29uX3J1bnEoc3RydWN0IGNzY2hlZDJf
aXRlbSAqc3ZjKQogewogICAgIHJldHVybiAhbGlzdF9lbXB0eSgmc3ZjLT5ydW5xX2VsZW0pOwog
fQogCi1zdGF0aWMgaW5saW5lIHN0cnVjdCBjc2NoZWQyX3ZjcHUgKiBydW5xX2VsZW0oc3RydWN0
IGxpc3RfaGVhZCAqZWxlbSkKK3N0YXRpYyBpbmxpbmUgc3RydWN0IGNzY2hlZDJfaXRlbSAqIHJ1
bnFfZWxlbShzdHJ1Y3QgbGlzdF9oZWFkICplbGVtKQogewotICAgIHJldHVybiBsaXN0X2VudHJ5
KGVsZW0sIHN0cnVjdCBjc2NoZWQyX3ZjcHUsIHJ1bnFfZWxlbSk7CisgICAgcmV0dXJuIGxpc3Rf
ZW50cnkoZWxlbSwgc3RydWN0IGNzY2hlZDJfaXRlbSwgcnVucV9lbGVtKTsKIH0KIAogc3RhdGlj
IHZvaWQgYWN0aXZhdGVfcnVucXVldWUoc3RydWN0IGNzY2hlZDJfcHJpdmF0ZSAqcHJ2LCBpbnQg
cnFpKQpAQCAtOTE1LDcgKzkxNSw3IEBAIHN0YXRpYyB2b2lkIHVwZGF0ZV9tYXhfd2VpZ2h0KHN0
cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCwgaW50IG5ld193ZWlnaHQsCiAKICAgICAg
ICAgbGlzdF9mb3JfZWFjaCggaXRlciwgJnJxZC0+c3ZjICkKICAgICAgICAgewotICAgICAgICAg
ICAgc3RydWN0IGNzY2hlZDJfdmNwdSAqIHN2YyA9IGxpc3RfZW50cnkoaXRlciwgc3RydWN0IGNz
Y2hlZDJfdmNwdSwgcnFkX2VsZW0pOworICAgICAgICAgICAgc3RydWN0IGNzY2hlZDJfaXRlbSAq
IHN2YyA9IGxpc3RfZW50cnkoaXRlciwgc3RydWN0IGNzY2hlZDJfaXRlbSwgcnFkX2VsZW0pOwog
CiAgICAgICAgICAgICBpZiAoIHN2Yy0+d2VpZ2h0ID4gbWF4X3dlaWdodCApCiAgICAgICAgICAg
ICAgICAgbWF4X3dlaWdodCA9IHN2Yy0+d2VpZ2h0OwpAQCAtOTQwLDcgKzk0MCw3IEBAIHN0YXRp
YyB2b2lkIHVwZGF0ZV9tYXhfd2VpZ2h0KHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJx
ZCwgaW50IG5ld193ZWlnaHQsCiAKIC8qIEFkZCBhbmQgcmVtb3ZlIGZyb20gcnVucXVldWUgYXNz
aWdubWVudCAobm90IGFjdGl2ZSBydW4gcXVldWUpICovCiBzdGF0aWMgdm9pZAotX3J1bnFfYXNz
aWduKHN0cnVjdCBjc2NoZWQyX3ZjcHUgKnN2Yywgc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0
YSAqcnFkKQorX3J1bnFfYXNzaWduKHN0cnVjdCBjc2NoZWQyX2l0ZW0gKnN2Yywgc3RydWN0IGNz
Y2hlZDJfcnVucXVldWVfZGF0YSAqcnFkKQogewogCiAgICAgc3ZjLT5ycWQgPSBycWQ7CkBAIC05
NzAsNyArOTcwLDcgQEAgX3J1bnFfYXNzaWduKHN0cnVjdCBjc2NoZWQyX3ZjcHUgKnN2Yywgc3Ry
dWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFkKQogc3RhdGljIHZvaWQKIHJ1bnFfYXNzaWdu
KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHZjcHUgKnZjKQogewotICAgIHN0
cnVjdCBjc2NoZWQyX3ZjcHUgKnN2YyA9IHZjLT5zY2hlZF9pdGVtLT5wcml2OworICAgIHN0cnVj
dCBjc2NoZWQyX2l0ZW0gKnN2YyA9IHZjLT5zY2hlZF9pdGVtLT5wcml2OwogCiAgICAgQVNTRVJU
KHN2Yy0+cnFkID09IE5VTEwpOwogCkBAIC05NzgsNyArOTc4LDcgQEAgcnVucV9hc3NpZ24oY29u
c3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgdmNwdSAqdmMpCiB9CiAKIHN0YXRpYyB2
b2lkCi1fcnVucV9kZWFzc2lnbihzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpzdmMpCitfcnVucV9kZWFz
c2lnbihzdHJ1Y3QgY3NjaGVkMl9pdGVtICpzdmMpCiB7CiAgICAgc3RydWN0IGNzY2hlZDJfcnVu
cXVldWVfZGF0YSAqcnFkID0gc3ZjLT5ycWQ7CiAKQEAgLTk5Nyw3ICs5OTcsNyBAQCBfcnVucV9k
ZWFzc2lnbihzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpzdmMpCiBzdGF0aWMgdm9pZAogcnVucV9kZWFz
c2lnbihjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCB2Y3B1ICp2YykKIHsKLSAg
ICBzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpzdmMgPSB2Yy0+c2NoZWRfaXRlbS0+cHJpdjsKKyAgICBz
dHJ1Y3QgY3NjaGVkMl9pdGVtICpzdmMgPSB2Yy0+c2NoZWRfaXRlbS0+cHJpdjsKIAogICAgIEFT
U0VSVChzdmMtPnJxZCA9PSBjMnJxZChvcHMsIHZjLT5wcm9jZXNzb3IpKTsKIApAQCAtMTE5OSw3
ICsxMTk5LDcgQEAgdXBkYXRlX3J1bnFfbG9hZChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMs
CiAKIHN0YXRpYyB2b2lkCiB1cGRhdGVfc3ZjX2xvYWQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAq
b3BzLAotICAgICAgICAgICAgICAgIHN0cnVjdCBjc2NoZWQyX3ZjcHUgKnN2YywgaW50IGNoYW5n
ZSwgc190aW1lX3Qgbm93KQorICAgICAgICAgICAgICAgIHN0cnVjdCBjc2NoZWQyX2l0ZW0gKnN2
YywgaW50IGNoYW5nZSwgc190aW1lX3Qgbm93KQogewogICAgIHN0cnVjdCBjc2NoZWQyX3ByaXZh
dGUgKnBydiA9IGNzY2hlZDJfcHJpdihvcHMpOwogICAgIHNfdGltZV90IGRlbHRhLCB2Y3B1X2xv
YWQ7CkBAIC0xMjU5LDcgKzEyNTksNyBAQCB1cGRhdGVfc3ZjX2xvYWQoY29uc3Qgc3RydWN0IHNj
aGVkdWxlciAqb3BzLAogc3RhdGljIHZvaWQKIHVwZGF0ZV9sb2FkKGNvbnN0IHN0cnVjdCBzY2hl
ZHVsZXIgKm9wcywKICAgICAgICAgICAgIHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJx
ZCwKLSAgICAgICAgICAgIHN0cnVjdCBjc2NoZWQyX3ZjcHUgKnN2YywgaW50IGNoYW5nZSwgc190
aW1lX3Qgbm93KQorICAgICAgICAgICAgc3RydWN0IGNzY2hlZDJfaXRlbSAqc3ZjLCBpbnQgY2hh
bmdlLCBzX3RpbWVfdCBub3cpCiB7CiAgICAgdHJhY2VfdmFyKFRSQ19DU0NIRUQyX1VQREFURV9M
T0FELCAxLCAwLCAgTlVMTCk7CiAKQEAgLTEyNjksNyArMTI2OSw3IEBAIHVwZGF0ZV9sb2FkKGNv
bnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKIH0KIAogc3RhdGljIHZvaWQKLXJ1bnFfaW5zZXJ0
KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IGNzY2hlZDJfdmNwdSAqc3ZjKQor
cnVucV9pbnNlcnQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgY3NjaGVkMl9p
dGVtICpzdmMpCiB7CiAgICAgc3RydWN0IGxpc3RfaGVhZCAqaXRlcjsKICAgICB1bnNpZ25lZCBp
bnQgY3B1ID0gc3ZjLT52Y3B1LT5wcm9jZXNzb3I7CkBAIC0xMjg4LDcgKzEyODgsNyBAQCBydW5x
X2luc2VydChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBjc2NoZWQyX3ZjcHUg
KnN2YykKIAogICAgIGxpc3RfZm9yX2VhY2goIGl0ZXIsIHJ1bnEgKQogICAgIHsKLSAgICAgICAg
c3RydWN0IGNzY2hlZDJfdmNwdSAqIGl0ZXJfc3ZjID0gcnVucV9lbGVtKGl0ZXIpOworICAgICAg
ICBzdHJ1Y3QgY3NjaGVkMl9pdGVtICogaXRlcl9zdmMgPSBydW5xX2VsZW0oaXRlcik7CiAKICAg
ICAgICAgaWYgKCBzdmMtPmNyZWRpdCA+IGl0ZXJfc3ZjLT5jcmVkaXQgKQogICAgICAgICAgICAg
YnJlYWs7CkBAIC0xMzEyLDEzICsxMzEyLDEzIEBAIHJ1bnFfaW5zZXJ0KGNvbnN0IHN0cnVjdCBz
Y2hlZHVsZXIgKm9wcywgc3RydWN0IGNzY2hlZDJfdmNwdSAqc3ZjKQogICAgIH0KIH0KIAotc3Rh
dGljIGlubGluZSB2b2lkIHJ1bnFfcmVtb3ZlKHN0cnVjdCBjc2NoZWQyX3ZjcHUgKnN2YykKK3N0
YXRpYyBpbmxpbmUgdm9pZCBydW5xX3JlbW92ZShzdHJ1Y3QgY3NjaGVkMl9pdGVtICpzdmMpCiB7
CiAgICAgQVNTRVJUKHZjcHVfb25fcnVucShzdmMpKTsKICAgICBsaXN0X2RlbF9pbml0KCZzdmMt
PnJ1bnFfZWxlbSk7CiB9CiAKLXZvaWQgYnVybl9jcmVkaXRzKHN0cnVjdCBjc2NoZWQyX3J1bnF1
ZXVlX2RhdGEgKnJxZCwgc3RydWN0IGNzY2hlZDJfdmNwdSAqLCBzX3RpbWVfdCk7Cit2b2lkIGJ1
cm5fY3JlZGl0cyhzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQsIHN0cnVjdCBjc2No
ZWQyX2l0ZW0gKiwgc190aW1lX3QpOwogCiBzdGF0aWMgaW5saW5lIHZvaWQKIHRpY2tsZV9jcHUo
dW5zaWduZWQgaW50IGNwdSwgc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFkKQpAQCAt
MTMzNCw3ICsxMzM0LDcgQEAgdGlja2xlX2NwdSh1bnNpZ25lZCBpbnQgY3B1LCBzdHJ1Y3QgY3Nj
aGVkMl9ydW5xdWV1ZV9kYXRhICpycWQpCiAgKiB3aGV0aGVyIG9yIG5vdCBpdCBhbHJlYWR5IHJ1
biBmb3IgbW9yZSB0aGFuIHRoZSByYXRlbGltaXQsIHRvIHdoaWNoIHdlCiAgKiBhcHBseSBzb21l
IHRvbGVyYW5jZSkuCiAgKi8KLXN0YXRpYyBpbmxpbmUgYm9vbCBpc19wcmVlbXB0YWJsZShjb25z
dCBzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpzdmMsCitzdGF0aWMgaW5saW5lIGJvb2wgaXNfcHJlZW1w
dGFibGUoY29uc3Qgc3RydWN0IGNzY2hlZDJfaXRlbSAqc3ZjLAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgc190aW1lX3Qgbm93LCBzX3RpbWVfdCByYXRlbGltaXQpCiB7CiAg
ICAgaWYgKCByYXRlbGltaXQgPD0gQ1NDSEVEMl9SQVRFTElNSVRfVElDS0xFX1RPTEVSQU5DRSAp
CkBAIC0xMzYwLDEwICsxMzYwLDEwIEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBpc19wcmVlbXB0YWJs
ZShjb25zdCBzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpzdmMsCiAgKiBXaXRoaW4gdGhlIHNhbWUgY2xh
c3MsIHRoZSBoaWdoZXN0IGRpZmZlcmVuY2Ugb2YgY3JlZGl0LgogICovCiBzdGF0aWMgc190aW1l
X3QgdGlja2xlX3Njb3JlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc190aW1lX3Qgbm93
LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpuZXcs
IHVuc2lnbmVkIGludCBjcHUpCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBj
c2NoZWQyX2l0ZW0gKm5ldywgdW5zaWduZWQgaW50IGNwdSkKIHsKICAgICBzdHJ1Y3QgY3NjaGVk
Ml9ydW5xdWV1ZV9kYXRhICpycWQgPSBjMnJxZChvcHMsIGNwdSk7Ci0gICAgc3RydWN0IGNzY2hl
ZDJfdmNwdSAqIGN1ciA9IGNzY2hlZDJfdmNwdShjdXJyX29uX2NwdShjcHUpKTsKKyAgICBzdHJ1
Y3QgY3NjaGVkMl9pdGVtICogY3VyID0gY3NjaGVkMl9pdGVtKGN1cnJfb25fY3B1KGNwdSkpOwog
ICAgIHN0cnVjdCBjc2NoZWQyX3ByaXZhdGUgKnBydiA9IGNzY2hlZDJfcHJpdihvcHMpOwogICAg
IHNfdGltZV90IHNjb3JlOwogCkBAIC0xNDMyLDcgKzE0MzIsNyBAQCBzdGF0aWMgc190aW1lX3Qg
dGlja2xlX3Njb3JlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc190aW1lX3Qgbm93LAog
ICogcGljayB1cCBzb21lIHdvcmssIHNvIGl0IHdvdWxkIGJlIHdyb25nIHRvIGNvbnNpZGVyIGl0
IGlkbGUuCiAgKi8KIHN0YXRpYyB2b2lkCi1ydW5xX3RpY2tsZShjb25zdCBzdHJ1Y3Qgc2NoZWR1
bGVyICpvcHMsIHN0cnVjdCBjc2NoZWQyX3ZjcHUgKm5ldywgc190aW1lX3Qgbm93KQorcnVucV90
aWNrbGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgY3NjaGVkMl9pdGVtICpu
ZXcsIHNfdGltZV90IG5vdykKIHsKICAgICBpbnQgaSwgaXBpZCA9IC0xOwogICAgIHNfdGltZV90
IG1heCA9IDA7CkBAIC0xNTg3LDcgKzE1ODcsNyBAQCBydW5xX3RpY2tsZShjb25zdCBzdHJ1Y3Qg
c2NoZWR1bGVyICpvcHMsIHN0cnVjdCBjc2NoZWQyX3ZjcHUgKm5ldywgc190aW1lX3Qgbm93KQog
ICAgICAgICByZXR1cm47CiAgICAgfQogCi0gICAgQVNTRVJUKCFpc19pZGxlX3ZjcHUoY3Vycl9v
bl9jcHUoaXBpZCkpKTsKKyAgICBBU1NFUlQoIWlzX2lkbGVfdmNwdShjdXJyX29uX2NwdShpcGlk
KS0+dmNwdSkpOwogICAgIFNDSEVEX1NUQVRfQ1JBTksodGlja2xlZF9idXN5X2NwdSk7CiAgdGlj
a2xlOgogICAgIEJVR19PTihpcGlkID09IC0xKTsKQEAgLTE2MTQsNyArMTYxNCw3IEBAIHJ1bnFf
dGlja2xlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IGNzY2hlZDJfdmNwdSAq
bmV3LCBzX3RpbWVfdCBub3cpCiAgKiBDcmVkaXQtcmVsYXRlZCBjb2RlCiAgKi8KIHN0YXRpYyB2
b2lkIHJlc2V0X2NyZWRpdChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGludCBjcHUsIHNf
dGltZV90IG5vdywKLSAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl92Y3B1
ICpzbmV4dCkKKyAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl9pdGVtICpz
bmV4dCkKIHsKICAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQgPSBjMnJxZChv
cHMsIGNwdSk7CiAgICAgc3RydWN0IGxpc3RfaGVhZCAqaXRlcjsKQEAgLTE2NDQsMTAgKzE2NDQs
MTAgQEAgc3RhdGljIHZvaWQgcmVzZXRfY3JlZGl0KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9w
cywgaW50IGNwdSwgc190aW1lX3Qgbm93LAogICAgIGxpc3RfZm9yX2VhY2goIGl0ZXIsICZycWQt
PnN2YyApCiAgICAgewogICAgICAgICB1bnNpZ25lZCBpbnQgc3ZjX2NwdTsKLSAgICAgICAgc3Ry
dWN0IGNzY2hlZDJfdmNwdSAqIHN2YzsKKyAgICAgICAgc3RydWN0IGNzY2hlZDJfaXRlbSAqIHN2
YzsKICAgICAgICAgaW50IHN0YXJ0X2NyZWRpdDsKIAotICAgICAgICBzdmMgPSBsaXN0X2VudHJ5
KGl0ZXIsIHN0cnVjdCBjc2NoZWQyX3ZjcHUsIHJxZF9lbGVtKTsKKyAgICAgICAgc3ZjID0gbGlz
dF9lbnRyeShpdGVyLCBzdHJ1Y3QgY3NjaGVkMl9pdGVtLCBycWRfZWxlbSk7CiAgICAgICAgIHN2
Y19jcHUgPSBzdmMtPnZjcHUtPnByb2Nlc3NvcjsKIAogICAgICAgICBBU1NFUlQoIWlzX2lkbGVf
dmNwdShzdmMtPnZjcHUpKTsKQEAgLTE2NTcsNyArMTY1Nyw3IEBAIHN0YXRpYyB2b2lkIHJlc2V0
X2NyZWRpdChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGludCBjcHUsIHNfdGltZV90IG5v
dywKICAgICAgICAgICogSWYgc3ZjIGlzIHJ1bm5pbmcsIGl0IGlzIG91ciByZXNwb25zaWJpbGl0
eSB0byBtYWtlIHN1cmUsIGhlcmUsCiAgICAgICAgICAqIHRoYXQgdGhlIGNyZWRpdCBpdCBoYXMg
c3BlbnQgc28gZmFyIGdldCBhY2NvdW50ZWQuCiAgICAgICAgICAqLwotICAgICAgICBpZiAoIHN2
Yy0+dmNwdSA9PSBjdXJyX29uX2NwdShzdmNfY3B1KSApCisgICAgICAgIGlmICggc3ZjLT52Y3B1
ID09IGN1cnJfb25fY3B1KHN2Y19jcHUpLT52Y3B1ICkKICAgICAgICAgewogICAgICAgICAgICAg
YnVybl9jcmVkaXRzKHJxZCwgc3ZjLCBub3cpOwogICAgICAgICAgICAgLyoKQEAgLTE3MDksMTEg
KzE3MDksMTEgQEAgc3RhdGljIHZvaWQgcmVzZXRfY3JlZGl0KGNvbnN0IHN0cnVjdCBzY2hlZHVs
ZXIgKm9wcywgaW50IGNwdSwgc190aW1lX3Qgbm93LAogfQogCiB2b2lkIGJ1cm5fY3JlZGl0cyhz
dHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQsCi0gICAgICAgICAgICAgICAgICBzdHJ1
Y3QgY3NjaGVkMl92Y3B1ICpzdmMsIHNfdGltZV90IG5vdykKKyAgICAgICAgICAgICAgICAgIHN0
cnVjdCBjc2NoZWQyX2l0ZW0gKnN2Yywgc190aW1lX3Qgbm93KQogewogICAgIHNfdGltZV90IGRl
bHRhOwogCi0gICAgQVNTRVJUKHN2YyA9PSBjc2NoZWQyX3ZjcHUoY3Vycl9vbl9jcHUoc3ZjLT52
Y3B1LT5wcm9jZXNzb3IpKSk7CisgICAgQVNTRVJUKHN2YyA9PSBjc2NoZWQyX2l0ZW0oY3Vycl9v
bl9jcHUoc3ZjLT52Y3B1LT5wcm9jZXNzb3IpKSk7CiAKICAgICBpZiAoIHVubGlrZWx5KGlzX2lk
bGVfdmNwdShzdmMtPnZjcHUpKSApCiAgICAgewpAQCAtMTc2Myw3ICsxNzYzLDcgQEAgdm9pZCBi
dXJuX2NyZWRpdHMoc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFkLAogICogQnVkZ2V0
LXJlbGF0ZWQgY29kZS4KICAqLwogCi1zdGF0aWMgdm9pZCBwYXJrX3ZjcHUoc3RydWN0IGNzY2hl
ZDJfdmNwdSAqc3ZjKQorc3RhdGljIHZvaWQgcGFya192Y3B1KHN0cnVjdCBjc2NoZWQyX2l0ZW0g
KnN2YykKIHsKICAgICBzdHJ1Y3QgdmNwdSAqdiA9IHN2Yy0+dmNwdTsKIApAQCAtMTc5Miw3ICsx
NzkyLDcgQEAgc3RhdGljIHZvaWQgcGFya192Y3B1KHN0cnVjdCBjc2NoZWQyX3ZjcHUgKnN2YykK
ICAgICBsaXN0X2FkZCgmc3ZjLT5wYXJrZWRfZWxlbSwgJnN2Yy0+c2RvbS0+cGFya2VkX3ZjcHVz
KTsKIH0KIAotc3RhdGljIGJvb2wgdmNwdV9ncmFiX2J1ZGdldChzdHJ1Y3QgY3NjaGVkMl92Y3B1
ICpzdmMpCitzdGF0aWMgYm9vbCB2Y3B1X2dyYWJfYnVkZ2V0KHN0cnVjdCBjc2NoZWQyX2l0ZW0g
KnN2YykKIHsKICAgICBzdHJ1Y3QgY3NjaGVkMl9kb20gKnNkb20gPSBzdmMtPnNkb207CiAgICAg
dW5zaWduZWQgaW50IGNwdSA9IHN2Yy0+dmNwdS0+cHJvY2Vzc29yOwpAQCAtMTgzOSw3ICsxODM5
LDcgQEAgc3RhdGljIGJvb2wgdmNwdV9ncmFiX2J1ZGdldChzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpz
dmMpCiB9CiAKIHN0YXRpYyB2b2lkCi12Y3B1X3JldHVybl9idWRnZXQoc3RydWN0IGNzY2hlZDJf
dmNwdSAqc3ZjLCBzdHJ1Y3QgbGlzdF9oZWFkICpwYXJrZWQpCit2Y3B1X3JldHVybl9idWRnZXQo
c3RydWN0IGNzY2hlZDJfaXRlbSAqc3ZjLCBzdHJ1Y3QgbGlzdF9oZWFkICpwYXJrZWQpCiB7CiAg
ICAgc3RydWN0IGNzY2hlZDJfZG9tICpzZG9tID0gc3ZjLT5zZG9tOwogICAgIHVuc2lnbmVkIGlu
dCBjcHUgPSBzdmMtPnZjcHUtPnByb2Nlc3NvcjsKQEAgLTE4ODIsNyArMTg4Miw3IEBAIHZjcHVf
cmV0dXJuX2J1ZGdldChzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpzdmMsIHN0cnVjdCBsaXN0X2hlYWQg
KnBhcmtlZCkKIHN0YXRpYyB2b2lkCiB1bnBhcmtfcGFya2VkX3ZjcHVzKGNvbnN0IHN0cnVjdCBz
Y2hlZHVsZXIgKm9wcywgc3RydWN0IGxpc3RfaGVhZCAqdmNwdXMpCiB7Ci0gICAgc3RydWN0IGNz
Y2hlZDJfdmNwdSAqc3ZjLCAqdG1wOworICAgIHN0cnVjdCBjc2NoZWQyX2l0ZW0gKnN2YywgKnRt
cDsKICAgICBzcGlubG9ja190ICpsb2NrOwogCiAgICAgbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZl
KHN2YywgdG1wLCB2Y3B1cywgcGFya2VkX2VsZW0pCkBAIC0yMDA0LDcgKzIwMDQsNyBAQCBzdGF0
aWMgdm9pZCByZXBsZW5pc2hfZG9tYWluX2J1ZGdldCh2b2lkKiBkYXRhKQogc3RhdGljIGlubGlu
ZSB2b2lkCiBjc2NoZWQyX3ZjcHVfY2hlY2soc3RydWN0IHZjcHUgKnZjKQogewotICAgIHN0cnVj
dCBjc2NoZWQyX3ZjcHUgKiBjb25zdCBzdmMgPSBjc2NoZWQyX3ZjcHUodmMpOworICAgIHN0cnVj
dCBjc2NoZWQyX2l0ZW0gKiBjb25zdCBzdmMgPSBjc2NoZWQyX2l0ZW0odmMtPnNjaGVkX2l0ZW0p
OwogICAgIHN0cnVjdCBjc2NoZWQyX2RvbSAqIGNvbnN0IHNkb20gPSBzdmMtPnNkb207CiAKICAg
ICBCVUdfT04oIHN2Yy0+dmNwdSAhPSB2YyApOwpAQCAtMjAzMCwxMCArMjAzMCwxMCBAQCBjc2No
ZWQyX2FsbG9jX3ZkYXRhKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVk
X2l0ZW0gKml0ZW0sCiAgICAgICAgICAgICAgICAgICAgIHZvaWQgKmRkKQogewogICAgIHN0cnVj
dCB2Y3B1ICp2YyA9IGl0ZW0tPnZjcHU7Ci0gICAgc3RydWN0IGNzY2hlZDJfdmNwdSAqc3ZjOwor
ICAgIHN0cnVjdCBjc2NoZWQyX2l0ZW0gKnN2YzsKIAogICAgIC8qIEFsbG9jYXRlIHBlci1WQ1BV
IGluZm8gKi8KLSAgICBzdmMgPSB4emFsbG9jKHN0cnVjdCBjc2NoZWQyX3ZjcHUpOworICAgIHN2
YyA9IHh6YWxsb2Moc3RydWN0IGNzY2hlZDJfaXRlbSk7CiAgICAgaWYgKCBzdmMgPT0gTlVMTCAp
CiAgICAgICAgIHJldHVybiBOVUxMOwogCkBAIC0yMDc0LDEyICsyMDc0LDEyIEBAIHN0YXRpYyB2
b2lkCiBjc2NoZWQyX2l0ZW1fc2xlZXAoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1
Y3Qgc2NoZWRfaXRlbSAqaXRlbSkKIHsKICAgICBzdHJ1Y3QgdmNwdSAqdmMgPSBpdGVtLT52Y3B1
OwotICAgIHN0cnVjdCBjc2NoZWQyX3ZjcHUgKiBjb25zdCBzdmMgPSBjc2NoZWQyX3ZjcHUodmMp
OworICAgIHN0cnVjdCBjc2NoZWQyX2l0ZW0gKiBjb25zdCBzdmMgPSBjc2NoZWQyX2l0ZW0oaXRl
bSk7CiAKICAgICBBU1NFUlQoIWlzX2lkbGVfdmNwdSh2YykpOwogICAgIFNDSEVEX1NUQVRfQ1JB
TksodmNwdV9zbGVlcCk7CiAKLSAgICBpZiAoIGN1cnJfb25fY3B1KHZjLT5wcm9jZXNzb3IpID09
IHZjICkKKyAgICBpZiAoIGN1cnJfb25fY3B1KHZjLT5wcm9jZXNzb3IpID09IGl0ZW0gKQogICAg
IHsKICAgICAgICAgdGlja2xlX2NwdSh2Yy0+cHJvY2Vzc29yLCBzdmMtPnJxZCk7CiAgICAgfQpA
QCAtMjA5Nyw3ICsyMDk3LDcgQEAgc3RhdGljIHZvaWQKIGNzY2hlZDJfaXRlbV93YWtlKGNvbnN0
IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX2l0ZW0gKml0ZW0pCiB7CiAgICAg
c3RydWN0IHZjcHUgKnZjID0gaXRlbS0+dmNwdTsKLSAgICBzdHJ1Y3QgY3NjaGVkMl92Y3B1ICog
Y29uc3Qgc3ZjID0gY3NjaGVkMl92Y3B1KHZjKTsKKyAgICBzdHJ1Y3QgY3NjaGVkMl9pdGVtICog
Y29uc3Qgc3ZjID0gY3NjaGVkMl9pdGVtKGl0ZW0pOwogICAgIHVuc2lnbmVkIGludCBjcHUgPSB2
Yy0+cHJvY2Vzc29yOwogICAgIHNfdGltZV90IG5vdzsKIApAQCAtMjEwNSw3ICsyMTA1LDcgQEAg
Y3NjaGVkMl9pdGVtX3dha2UoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2No
ZWRfaXRlbSAqaXRlbSkKIAogICAgIEFTU0VSVCghaXNfaWRsZV92Y3B1KHZjKSk7CiAKLSAgICBp
ZiAoIHVubGlrZWx5KGN1cnJfb25fY3B1KGNwdSkgPT0gdmMpICkKKyAgICBpZiAoIHVubGlrZWx5
KGN1cnJfb25fY3B1KGNwdSkgPT0gaXRlbSkgKQogICAgIHsKICAgICAgICAgU0NIRURfU1RBVF9D
UkFOSyh2Y3B1X3dha2VfcnVubmluZyk7CiAgICAgICAgIGdvdG8gb3V0OwpAQCAtMjE1Miw4ICsy
MTUyLDcgQEAgb3V0Ogogc3RhdGljIHZvaWQKIGNzY2hlZDJfaXRlbV95aWVsZChjb25zdCBzdHJ1
Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF9pdGVtICppdGVtKQogewotICAgIHN0cnVj
dCB2Y3B1ICp2ID0gaXRlbS0+dmNwdTsKLSAgICBzdHJ1Y3QgY3NjaGVkMl92Y3B1ICogY29uc3Qg
c3ZjID0gY3NjaGVkMl92Y3B1KHYpOworICAgIHN0cnVjdCBjc2NoZWQyX2l0ZW0gKiBjb25zdCBz
dmMgPSBjc2NoZWQyX2l0ZW0oaXRlbSk7CiAKICAgICBfX3NldF9iaXQoX19DU0ZMQUdfdmNwdV95
aWVsZCwgJnN2Yy0+ZmxhZ3MpOwogfQpAQCAtMjE2Miw3ICsyMTYxLDcgQEAgc3RhdGljIHZvaWQK
IGNzY2hlZDJfY29udGV4dF9zYXZlZChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVj
dCBzY2hlZF9pdGVtICppdGVtKQogewogICAgIHN0cnVjdCB2Y3B1ICp2YyA9IGl0ZW0tPnZjcHU7
Ci0gICAgc3RydWN0IGNzY2hlZDJfdmNwdSAqIGNvbnN0IHN2YyA9IGNzY2hlZDJfdmNwdSh2Yyk7
CisgICAgc3RydWN0IGNzY2hlZDJfaXRlbSAqIGNvbnN0IHN2YyA9IGNzY2hlZDJfaXRlbShpdGVt
KTsKICAgICBzcGlubG9ja190ICpsb2NrID0gdmNwdV9zY2hlZHVsZV9sb2NrX2lycSh2Yyk7CiAg
ICAgc190aW1lX3Qgbm93ID0gTk9XKCk7CiAgICAgTElTVF9IRUFEKHdlcmVfcGFya2VkKTsKQEAg
LTIyMDgsNyArMjIwNyw3IEBAIGNzY2hlZDJfcmVzX3BpY2soY29uc3Qgc3RydWN0IHNjaGVkdWxl
ciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfaXRlbSAqaXRlbSkKICAgICBzdHJ1Y3QgdmNwdSAqdmMgPSBp
dGVtLT52Y3B1OwogICAgIGludCBpLCBtaW5fcnFpID0gLTEsIG1pbl9zX3JxaSA9IC0xOwogICAg
IHVuc2lnbmVkIGludCBuZXdfY3B1LCBjcHUgPSB2Yy0+cHJvY2Vzc29yOwotICAgIHN0cnVjdCBj
c2NoZWQyX3ZjcHUgKnN2YyA9IGNzY2hlZDJfdmNwdSh2Yyk7CisgICAgc3RydWN0IGNzY2hlZDJf
aXRlbSAqc3ZjID0gY3NjaGVkMl9pdGVtKGl0ZW0pOwogICAgIHNfdGltZV90IG1pbl9hdmdsb2Fk
ID0gTUFYX0xPQUQsIG1pbl9zX2F2Z2xvYWQgPSBNQVhfTE9BRDsKICAgICBib29sIGhhc19zb2Z0
OwogCkBAIC0yNDMwLDE1ICsyNDI5LDE1IEBAIGNzY2hlZDJfcmVzX3BpY2soY29uc3Qgc3RydWN0
IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfaXRlbSAqaXRlbSkKIHR5cGVkZWYgc3RydWN0
IHsKICAgICAvKiBOQjogTW9kaWZpZWQgYnkgY29uc2lkZXIoKSAqLwogICAgIHNfdGltZV90IGxv
YWRfZGVsdGE7Ci0gICAgc3RydWN0IGNzY2hlZDJfdmNwdSAqIGJlc3RfcHVzaF9zdmMsICpiZXN0
X3B1bGxfc3ZjOworICAgIHN0cnVjdCBjc2NoZWQyX2l0ZW0gKiBiZXN0X3B1c2hfc3ZjLCAqYmVz
dF9wdWxsX3N2YzsKICAgICAvKiBOQjogUmVhZCBieSBjb25zaWRlcigpICovCiAgICAgc3RydWN0
IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqbHJxZDsKICAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1
ZV9kYXRhICpvcnFkOyAgICAgICAgICAgICAgICAgIAogfSBiYWxhbmNlX3N0YXRlX3Q7CiAKIHN0
YXRpYyB2b2lkIGNvbnNpZGVyKGJhbGFuY2Vfc3RhdGVfdCAqc3QsIAotICAgICAgICAgICAgICAg
ICAgICAgc3RydWN0IGNzY2hlZDJfdmNwdSAqcHVzaF9zdmMsCi0gICAgICAgICAgICAgICAgICAg
ICBzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpwdWxsX3N2YykKKyAgICAgICAgICAgICAgICAgICAgIHN0
cnVjdCBjc2NoZWQyX2l0ZW0gKnB1c2hfc3ZjLAorICAgICAgICAgICAgICAgICAgICAgc3RydWN0
IGNzY2hlZDJfaXRlbSAqcHVsbF9zdmMpCiB7CiAgICAgc190aW1lX3QgbF9sb2FkLCBvX2xvYWQs
IGRlbHRhOwogCkBAIC0yNDcxLDggKzI0NzAsOCBAQCBzdGF0aWMgdm9pZCBjb25zaWRlcihiYWxh
bmNlX3N0YXRlX3QgKnN0LAogCiAKIHN0YXRpYyB2b2lkIG1pZ3JhdGUoY29uc3Qgc3RydWN0IHNj
aGVkdWxlciAqb3BzLAotICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpz
dmMsIAotICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICp0
cnFkLCAKKyAgICAgICAgICAgICAgICAgICAgc3RydWN0IGNzY2hlZDJfaXRlbSAqc3ZjLAorICAg
ICAgICAgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICp0cnFkLAogICAg
ICAgICAgICAgICAgICAgICBzX3RpbWVfdCBub3cpCiB7CiAgICAgaW50IGNwdSA9IHN2Yy0+dmNw
dS0+cHJvY2Vzc29yOwpAQCAtMjU0MSw3ICsyNTQwLDcgQEAgc3RhdGljIHZvaWQgbWlncmF0ZShj
b25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAgKiAgLSBzdmMgaXMgbm90IGFscmVhZHkgZmxh
Z2dlZCB0byBtaWdyYXRlLAogICogIC0gaWYgc3ZjIGlzIGFsbG93ZWQgdG8gcnVuIG9uIGF0IGxl
YXN0IG9uZSBvZiB0aGUgcGNwdXMgb2YgcnFkLgogICovCi1zdGF0aWMgYm9vbCB2Y3B1X2lzX21p
Z3JhdGVhYmxlKHN0cnVjdCBjc2NoZWQyX3ZjcHUgKnN2YywKK3N0YXRpYyBib29sIHZjcHVfaXNf
bWlncmF0ZWFibGUoc3RydWN0IGNzY2hlZDJfaXRlbSAqc3ZjLAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCkKIHsKICAg
ICBzdHJ1Y3QgdmNwdSAqdiA9IHN2Yy0+dmNwdTsKQEAgLTI2OTEsNyArMjY5MCw3IEBAIHJldHJ5
OgogICAgIC8qIFJldXNlIGxvYWQgZGVsdGEgKGFzIHdlJ3JlIHRyeWluZyB0byBtaW5pbWl6ZSBp
dCkgKi8KICAgICBsaXN0X2Zvcl9lYWNoKCBwdXNoX2l0ZXIsICZzdC5scnFkLT5zdmMgKQogICAg
IHsKLSAgICAgICAgc3RydWN0IGNzY2hlZDJfdmNwdSAqIHB1c2hfc3ZjID0gbGlzdF9lbnRyeShw
dXNoX2l0ZXIsIHN0cnVjdCBjc2NoZWQyX3ZjcHUsIHJxZF9lbGVtKTsKKyAgICAgICAgc3RydWN0
IGNzY2hlZDJfaXRlbSAqIHB1c2hfc3ZjID0gbGlzdF9lbnRyeShwdXNoX2l0ZXIsIHN0cnVjdCBj
c2NoZWQyX2l0ZW0sIHJxZF9lbGVtKTsKIAogICAgICAgICB1cGRhdGVfc3ZjX2xvYWQob3BzLCBw
dXNoX3N2YywgMCwgbm93KTsKIApAQCAtMjcwMCw3ICsyNjk5LDcgQEAgcmV0cnk6CiAKICAgICAg
ICAgbGlzdF9mb3JfZWFjaCggcHVsbF9pdGVyLCAmc3Qub3JxZC0+c3ZjICkKICAgICAgICAgewot
ICAgICAgICAgICAgc3RydWN0IGNzY2hlZDJfdmNwdSAqIHB1bGxfc3ZjID0gbGlzdF9lbnRyeShw
dWxsX2l0ZXIsIHN0cnVjdCBjc2NoZWQyX3ZjcHUsIHJxZF9lbGVtKTsKKyAgICAgICAgICAgIHN0
cnVjdCBjc2NoZWQyX2l0ZW0gKiBwdWxsX3N2YyA9IGxpc3RfZW50cnkocHVsbF9pdGVyLCBzdHJ1
Y3QgY3NjaGVkMl9pdGVtLCBycWRfZWxlbSk7CiAgICAgICAgICAgICAKICAgICAgICAgICAgIGlm
ICggIWlubmVyX2xvYWRfdXBkYXRlZCApCiAgICAgICAgICAgICAgICAgdXBkYXRlX3N2Y19sb2Fk
KG9wcywgcHVsbF9zdmMsIDAsIG5vdyk7CkBAIC0yNzE5LDcgKzI3MTgsNyBAQCByZXRyeToKIAog
ICAgIGxpc3RfZm9yX2VhY2goIHB1bGxfaXRlciwgJnN0Lm9ycWQtPnN2YyApCiAgICAgewotICAg
ICAgICBzdHJ1Y3QgY3NjaGVkMl92Y3B1ICogcHVsbF9zdmMgPSBsaXN0X2VudHJ5KHB1bGxfaXRl
ciwgc3RydWN0IGNzY2hlZDJfdmNwdSwgcnFkX2VsZW0pOworICAgICAgICBzdHJ1Y3QgY3NjaGVk
Ml9pdGVtICogcHVsbF9zdmMgPSBsaXN0X2VudHJ5KHB1bGxfaXRlciwgc3RydWN0IGNzY2hlZDJf
aXRlbSwgcnFkX2VsZW0pOwogICAgICAgICAKICAgICAgICAgaWYgKCAhdmNwdV9pc19taWdyYXRl
YWJsZShwdWxsX3N2Yywgc3QubHJxZCkgKQogICAgICAgICAgICAgY29udGludWU7CkBAIC0yNzQ2
LDcgKzI3NDUsNyBAQCBjc2NoZWQyX2l0ZW1fbWlncmF0ZSgKIHsKICAgICBzdHJ1Y3QgdmNwdSAq
dmMgPSBpdGVtLT52Y3B1OwogICAgIHN0cnVjdCBkb21haW4gKmQgPSB2Yy0+ZG9tYWluOwotICAg
IHN0cnVjdCBjc2NoZWQyX3ZjcHUgKiBjb25zdCBzdmMgPSBjc2NoZWQyX3ZjcHUodmMpOworICAg
IHN0cnVjdCBjc2NoZWQyX2l0ZW0gKiBjb25zdCBzdmMgPSBjc2NoZWQyX2l0ZW0oaXRlbSk7CiAg
ICAgc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqdHJxZDsKICAgICBzX3RpbWVfdCBub3cg
PSBOT1coKTsKIApAQCAtMjg0Nyw3ICsyODQ2LDcgQEAgY3NjaGVkMl9kb21fY250bCgKICAgICAg
ICAgICAgIC8qIFVwZGF0ZSB3ZWlnaHRzIGZvciB2Y3B1cywgYW5kIG1heF93ZWlnaHQgZm9yIHJ1
bnF1ZXVlcyBvbiB3aGljaCB0aGV5IHJlc2lkZSAqLwogICAgICAgICAgICAgZm9yX2VhY2hfdmNw
dSAoIGQsIHYgKQogICAgICAgICAgICAgewotICAgICAgICAgICAgICAgIHN0cnVjdCBjc2NoZWQy
X3ZjcHUgKnN2YyA9IGNzY2hlZDJfdmNwdSh2KTsKKyAgICAgICAgICAgICAgICBzdHJ1Y3QgY3Nj
aGVkMl9pdGVtICpzdmMgPSBjc2NoZWQyX2l0ZW0odi0+c2NoZWRfaXRlbSk7CiAgICAgICAgICAg
ICAgICAgc3BpbmxvY2tfdCAqbG9jayA9IHZjcHVfc2NoZWR1bGVfbG9jayhzdmMtPnZjcHUpOwog
CiAgICAgICAgICAgICAgICAgQVNTRVJUKHN2Yy0+cnFkID09IGMycnFkKG9wcywgc3ZjLT52Y3B1
LT5wcm9jZXNzb3IpKTsKQEAgLTI4NjEsNyArMjg2MCw3IEBAIGNzY2hlZDJfZG9tX2NudGwoCiAg
ICAgICAgIC8qIENhcCAqLwogICAgICAgICBpZiAoIG9wLT51LmNyZWRpdDIuY2FwICE9IDAgKQog
ICAgICAgICB7Ci0gICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpzdmM7CisgICAgICAg
ICAgICBzdHJ1Y3QgY3NjaGVkMl9pdGVtICpzdmM7CiAgICAgICAgICAgICBzcGlubG9ja190ICps
b2NrOwogCiAgICAgICAgICAgICAvKiBDYXAgaXMgb25seSB2YWxpZCBpZiBpdCdzIGJlbG93IDEw
MCAqIG5yX29mX3ZDUFVTICovCkBAIC0yODg1LDcgKzI4ODQsNyBAQCBjc2NoZWQyX2RvbV9jbnRs
KAogICAgICAgICAgICAgICovCiAgICAgICAgICAgICBmb3JfZWFjaF92Y3B1ICggZCwgdiApCiAg
ICAgICAgICAgICB7Ci0gICAgICAgICAgICAgICAgc3ZjID0gY3NjaGVkMl92Y3B1KHYpOworICAg
ICAgICAgICAgICAgIHN2YyA9IGNzY2hlZDJfaXRlbSh2LT5zY2hlZF9pdGVtKTsKICAgICAgICAg
ICAgICAgICBsb2NrID0gdmNwdV9zY2hlZHVsZV9sb2NrKHN2Yy0+dmNwdSk7CiAgICAgICAgICAg
ICAgICAgLyoKICAgICAgICAgICAgICAgICAgKiBUb28gc21hbGwgcXVvdGFzIHdvdWxkIGluIHRo
ZW9yeSBjYXVzZSBhIGxvdCBvZiBvdmVyaGVhZCwKQEAgLTI5MjgsMTQgKzI5MjcsMTQgQEAgY3Nj
aGVkMl9kb21fY250bCgKICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICBmb3Jf
ZWFjaF92Y3B1ICggZCwgdiApCiAgICAgICAgICAgICAgICAgewotICAgICAgICAgICAgICAgICAg
ICBzdmMgPSBjc2NoZWQyX3ZjcHUodik7CisgICAgICAgICAgICAgICAgICAgIHN2YyA9IGNzY2hl
ZDJfaXRlbSh2LT5zY2hlZF9pdGVtKTsKICAgICAgICAgICAgICAgICAgICAgbG9jayA9IHZjcHVf
c2NoZWR1bGVfbG9jayhzdmMtPnZjcHUpOwogICAgICAgICAgICAgICAgICAgICBpZiAoIHYtPmlz
X3J1bm5pbmcgKQogICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAg
ICB1bnNpZ25lZCBpbnQgY3B1ID0gdi0+cHJvY2Vzc29yOwogICAgICAgICAgICAgICAgICAgICAg
ICAgc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFkID0gYzJycWQob3BzLCBjcHUpOwog
Ci0gICAgICAgICAgICAgICAgICAgICAgICBBU1NFUlQoY3Vycl9vbl9jcHUoY3B1KSA9PSB2KTsK
KyAgICAgICAgICAgICAgICAgICAgICAgIEFTU0VSVChjdXJyX29uX2NwdShjcHUpLT52Y3B1ID09
IHYpOwogCiAgICAgICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAg
ICAgICogV2UgYXJlIHRyaWdnZXJpbmcgYSByZXNjaGVkdWxlIG9uIHRoZSB2Q1BVJ3MKQEAgLTI5
NzUsNyArMjk3NCw3IEBAIGNzY2hlZDJfZG9tX2NudGwoCiAgICAgICAgICAgICAvKiBEaXNhYmxl
IGJ1ZGdldCBhY2NvdW50aW5nIGZvciBhbGwgdGhlIHZDUFVzLiAqLwogICAgICAgICAgICAgZm9y
X2VhY2hfdmNwdSAoIGQsIHYgKQogICAgICAgICAgICAgewotICAgICAgICAgICAgICAgIHN0cnVj
dCBjc2NoZWQyX3ZjcHUgKnN2YyA9IGNzY2hlZDJfdmNwdSh2KTsKKyAgICAgICAgICAgICAgICBz
dHJ1Y3QgY3NjaGVkMl9pdGVtICpzdmMgPSBjc2NoZWQyX2l0ZW0odi0+c2NoZWRfaXRlbSk7CiAg
ICAgICAgICAgICAgICAgc3BpbmxvY2tfdCAqbG9jayA9IHZjcHVfc2NoZWR1bGVfbG9jayhzdmMt
PnZjcHUpOwogCiAgICAgICAgICAgICAgICAgc3ZjLT5idWRnZXQgPSBTVElNRV9NQVg7CkBAIC0z
MDEyLDggKzMwMTEsNyBAQCBzdGF0aWMgdm9pZAogY3NjaGVkMl9hZmZfY250bChjb25zdCBzdHJ1
Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF9pdGVtICppdGVtLAogICAgICAgICAgICAg
ICAgICBjb25zdCBjcHVtYXNrX3QgKmhhcmQsIGNvbnN0IGNwdW1hc2tfdCAqc29mdCkKIHsKLSAg
ICBzdHJ1Y3QgdmNwdSAqdiA9IGl0ZW0tPnZjcHU7Ci0gICAgc3RydWN0IGNzY2hlZDJfdmNwdSAq
c3ZjID0gY3NjaGVkMl92Y3B1KHYpOworICAgIHN0cnVjdCBjc2NoZWQyX2l0ZW0gKnN2YyA9IGNz
Y2hlZDJfaXRlbShpdGVtKTsKIAogICAgIGlmICggIWhhcmQgKQogICAgICAgICByZXR1cm47CkBA
IC0zMTEzLDcgKzMxMTEsNyBAQCBzdGF0aWMgdm9pZAogY3NjaGVkMl9pdGVtX2luc2VydChjb25z
dCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF9pdGVtICppdGVtKQogewogICAg
IHN0cnVjdCB2Y3B1ICp2YyA9IGl0ZW0tPnZjcHU7Ci0gICAgc3RydWN0IGNzY2hlZDJfdmNwdSAq
c3ZjID0gaXRlbS0+cHJpdjsKKyAgICBzdHJ1Y3QgY3NjaGVkMl9pdGVtICpzdmMgPSBpdGVtLT5w
cml2OwogICAgIHN0cnVjdCBjc2NoZWQyX2RvbSAqIGNvbnN0IHNkb20gPSBzdmMtPnNkb207CiAg
ICAgc3BpbmxvY2tfdCAqbG9jazsKIApAQCAtMzE0NSw3ICszMTQzLDcgQEAgY3NjaGVkMl9pdGVt
X2luc2VydChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF9pdGVtICpp
dGVtKQogc3RhdGljIHZvaWQKIGNzY2hlZDJfZnJlZV92ZGF0YShjb25zdCBzdHJ1Y3Qgc2NoZWR1
bGVyICpvcHMsIHZvaWQgKnByaXYpCiB7Ci0gICAgc3RydWN0IGNzY2hlZDJfdmNwdSAqc3ZjID0g
cHJpdjsKKyAgICBzdHJ1Y3QgY3NjaGVkMl9pdGVtICpzdmMgPSBwcml2OwogCiAgICAgeGZyZWUo
c3ZjKTsKIH0KQEAgLTMxNTQsNyArMzE1Miw3IEBAIHN0YXRpYyB2b2lkCiBjc2NoZWQyX2l0ZW1f
cmVtb3ZlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX2l0ZW0gKml0
ZW0pCiB7CiAgICAgc3RydWN0IHZjcHUgKnZjID0gaXRlbS0+dmNwdTsKLSAgICBzdHJ1Y3QgY3Nj
aGVkMl92Y3B1ICogY29uc3Qgc3ZjID0gY3NjaGVkMl92Y3B1KHZjKTsKKyAgICBzdHJ1Y3QgY3Nj
aGVkMl9pdGVtICogY29uc3Qgc3ZjID0gY3NjaGVkMl9pdGVtKGl0ZW0pOwogICAgIHNwaW5sb2Nr
X3QgKmxvY2s7CiAKICAgICBBU1NFUlQoIWlzX2lkbGVfdmNwdSh2YykpOwpAQCAtMzE3NSw3ICsz
MTczLDcgQEAgY3NjaGVkMl9pdGVtX3JlbW92ZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMs
IHN0cnVjdCBzY2hlZF9pdGVtICppdGVtKQogLyogSG93IGxvbmcgc2hvdWxkIHdlIGxldCB0aGlz
IHZjcHUgcnVuIGZvcj8gKi8KIHN0YXRpYyBzX3RpbWVfdAogY3NjaGVkMl9ydW50aW1lKGNvbnN0
IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgaW50IGNwdSwKLSAgICAgICAgICAgICAgICBzdHJ1Y3Qg
Y3NjaGVkMl92Y3B1ICpzbmV4dCwgc190aW1lX3Qgbm93KQorICAgICAgICAgICAgICAgIHN0cnVj
dCBjc2NoZWQyX2l0ZW0gKnNuZXh0LCBzX3RpbWVfdCBub3cpCiB7CiAgICAgc190aW1lX3QgdGlt
ZSwgbWluX3RpbWU7CiAgICAgaW50IHJ0X2NyZWRpdDsgLyogUHJvcG9zZWQgcnVudGltZSBtZWFz
dXJlZCBpbiBjcmVkaXRzICovCkBAIC0zMjIwLDcgKzMyMTgsNyBAQCBjc2NoZWQyX3J1bnRpbWUo
Y29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBpbnQgY3B1LAogICAgICAqLwogICAgIGlmICgg
ISBsaXN0X2VtcHR5KHJ1bnEpICkKICAgICB7Ci0gICAgICAgIHN0cnVjdCBjc2NoZWQyX3ZjcHUg
KnN3YWl0ID0gcnVucV9lbGVtKHJ1bnEtPm5leHQpOworICAgICAgICBzdHJ1Y3QgY3NjaGVkMl9p
dGVtICpzd2FpdCA9IHJ1bnFfZWxlbShydW5xLT5uZXh0KTsKIAogICAgICAgICBpZiAoICEgaXNf
aWRsZV92Y3B1KHN3YWl0LT52Y3B1KQogICAgICAgICAgICAgICYmIHN3YWl0LT5jcmVkaXQgPiAw
ICkKQEAgLTMyNzEsMTQgKzMyNjksMTQgQEAgY3NjaGVkMl9ydW50aW1lKGNvbnN0IHN0cnVjdCBz
Y2hlZHVsZXIgKm9wcywgaW50IGNwdSwKIC8qCiAgKiBGaW5kIGEgY2FuZGlkYXRlLgogICovCi1z
dGF0aWMgc3RydWN0IGNzY2hlZDJfdmNwdSAqCitzdGF0aWMgc3RydWN0IGNzY2hlZDJfaXRlbSAq
CiBydW5xX2NhbmRpZGF0ZShzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQsCi0gICAg
ICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpzY3VyciwKKyAgICAgICAgICAgICAgIHN0
cnVjdCBjc2NoZWQyX2l0ZW0gKnNjdXJyLAogICAgICAgICAgICAgICAgaW50IGNwdSwgc190aW1l
X3Qgbm93LAogICAgICAgICAgICAgICAgdW5zaWduZWQgaW50ICpza2lwcGVkKQogewogICAgIHN0
cnVjdCBsaXN0X2hlYWQgKml0ZXIsICp0ZW1wOwotICAgIHN0cnVjdCBjc2NoZWQyX3ZjcHUgKnNu
ZXh0ID0gTlVMTDsKKyAgICBzdHJ1Y3QgY3NjaGVkMl9pdGVtICpzbmV4dCA9IE5VTEw7CiAgICAg
c3RydWN0IGNzY2hlZDJfcHJpdmF0ZSAqcHJ2ID0gY3NjaGVkMl9wcml2KHBlcl9jcHUoc2NoZWR1
bGVyLCBjcHUpKTsKICAgICBib29sIHlpZWxkID0gZmFsc2UsIHNvZnRfYWZmX3ByZWVtcHQgPSBm
YWxzZTsKIApAQCAtMzM1OSwxMiArMzM1NywxMiBAQCBydW5xX2NhbmRpZGF0ZShzdHJ1Y3QgY3Nj
aGVkMl9ydW5xdWV1ZV9kYXRhICpycWQsCiAgICAgaWYgKCB2Y3B1X3J1bm5hYmxlKHNjdXJyLT52
Y3B1KSAmJiAhc29mdF9hZmZfcHJlZW1wdCApCiAgICAgICAgIHNuZXh0ID0gc2N1cnI7CiAgICAg
ZWxzZQotICAgICAgICBzbmV4dCA9IGNzY2hlZDJfdmNwdShpZGxlX3ZjcHVbY3B1XSk7CisgICAg
ICAgIHNuZXh0ID0gY3NjaGVkMl9pdGVtKGlkbGVfdmNwdVtjcHVdLT5zY2hlZF9pdGVtKTsKIAog
IGNoZWNrX3J1bnE6CiAgICAgbGlzdF9mb3JfZWFjaF9zYWZlKCBpdGVyLCB0ZW1wLCAmcnFkLT5y
dW5xICkKICAgICB7Ci0gICAgICAgIHN0cnVjdCBjc2NoZWQyX3ZjcHUgKiBzdmMgPSBsaXN0X2Vu
dHJ5KGl0ZXIsIHN0cnVjdCBjc2NoZWQyX3ZjcHUsIHJ1bnFfZWxlbSk7CisgICAgICAgIHN0cnVj
dCBjc2NoZWQyX2l0ZW0gKiBzdmMgPSBsaXN0X2VudHJ5KGl0ZXIsIHN0cnVjdCBjc2NoZWQyX2l0
ZW0sIHJ1bnFfZWxlbSk7CiAKICAgICAgICAgaWYgKCB1bmxpa2VseSh0Yl9pbml0X2RvbmUpICkK
ICAgICAgICAgewpAQCAtMzQ2Myw4ICszNDYxLDggQEAgY3NjaGVkMl9zY2hlZHVsZSgKIHsKICAg
ICBjb25zdCBpbnQgY3B1ID0gc21wX3Byb2Nlc3Nvcl9pZCgpOwogICAgIHN0cnVjdCBjc2NoZWQy
X3J1bnF1ZXVlX2RhdGEgKnJxZDsKLSAgICBzdHJ1Y3QgY3NjaGVkMl92Y3B1ICogY29uc3Qgc2N1
cnIgPSBjc2NoZWQyX3ZjcHUoY3VycmVudCk7Ci0gICAgc3RydWN0IGNzY2hlZDJfdmNwdSAqc25l
eHQgPSBOVUxMOworICAgIHN0cnVjdCBjc2NoZWQyX2l0ZW0gKiBjb25zdCBzY3VyciA9IGNzY2hl
ZDJfaXRlbShjdXJyZW50LT5zY2hlZF9pdGVtKTsKKyAgICBzdHJ1Y3QgY3NjaGVkMl9pdGVtICpz
bmV4dCA9IE5VTEw7CiAgICAgdW5zaWduZWQgaW50IHNraXBwZWRfdmNwdXMgPSAwOwogICAgIHN0
cnVjdCB0YXNrX3NsaWNlIHJldDsKICAgICBib29sIHRpY2tsZWQ7CkBAIC0zNTQwLDcgKzM1Mzgs
NyBAQCBjc2NoZWQyX3NjaGVkdWxlKAogICAgIHsKICAgICAgICAgX19jbGVhcl9iaXQoX19DU0ZM
QUdfdmNwdV95aWVsZCwgJnNjdXJyLT5mbGFncyk7CiAgICAgICAgIHRyYWNlX3ZhcihUUkNfQ1ND
SEVEMl9TQ0hFRF9UQVNLTEVULCAxLCAwLCBOVUxMKTsKLSAgICAgICAgc25leHQgPSBjc2NoZWQy
X3ZjcHUoaWRsZV92Y3B1W2NwdV0pOworICAgICAgICBzbmV4dCA9IGNzY2hlZDJfaXRlbShpZGxl
X3ZjcHVbY3B1XS0+c2NoZWRfaXRlbSk7CiAgICAgfQogICAgIGVsc2UKICAgICAgICAgc25leHQg
PSBydW5xX2NhbmRpZGF0ZShycWQsIHNjdXJyLCBjcHUsIG5vdywgJnNraXBwZWRfdmNwdXMpOwpA
QCAtMzY0Myw3ICszNjQxLDcgQEAgY3NjaGVkMl9zY2hlZHVsZSgKIH0KIAogc3RhdGljIHZvaWQK
LWNzY2hlZDJfZHVtcF92Y3B1KHN0cnVjdCBjc2NoZWQyX3ByaXZhdGUgKnBydiwgc3RydWN0IGNz
Y2hlZDJfdmNwdSAqc3ZjKQorY3NjaGVkMl9kdW1wX3ZjcHUoc3RydWN0IGNzY2hlZDJfcHJpdmF0
ZSAqcHJ2LCBzdHJ1Y3QgY3NjaGVkMl9pdGVtICpzdmMpCiB7CiAgICAgcHJpbnRrKCJbJWkuJWld
IGZsYWdzPSV4IGNwdT0laSIsCiAgICAgICAgICAgICBzdmMtPnZjcHUtPmRvbWFpbi0+ZG9tYWlu
X2lkLApAQCAtMzY2Nyw3ICszNjY1LDcgQEAgc3RhdGljIGlubGluZSB2b2lkCiBkdW1wX3BjcHUo
Y29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBpbnQgY3B1KQogewogICAgIHN0cnVjdCBjc2No
ZWQyX3ByaXZhdGUgKnBydiA9IGNzY2hlZDJfcHJpdihvcHMpOwotICAgIHN0cnVjdCBjc2NoZWQy
X3ZjcHUgKnN2YzsKKyAgICBzdHJ1Y3QgY3NjaGVkMl9pdGVtICpzdmM7CiAKICAgICBwcmludGso
IkNQVVslMDJkXSBydW5xPSVkLCBzaWJsaW5nPSUqcGIsIGNvcmU9JSpwYlxuIiwKICAgICAgICAg
ICAgY3B1LCBjMnIoY3B1KSwKQEAgLTM2NzUsNyArMzY3Myw3IEBAIGR1bXBfcGNwdShjb25zdCBz
dHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGludCBjcHUpCiAgICAgICAgICAgIG5yX2NwdV9pZHMsIGNw
dW1hc2tfYml0cyhwZXJfY3B1KGNwdV9jb3JlX21hc2ssIGNwdSkpKTsKIAogICAgIC8qIGN1cnJl
bnQgVkNQVSAobm90aGluZyB0byBzYXkgaWYgdGhhdCdzIHRoZSBpZGxlIHZjcHUpICovCi0gICAg
c3ZjID0gY3NjaGVkMl92Y3B1KGN1cnJfb25fY3B1KGNwdSkpOworICAgIHN2YyA9IGNzY2hlZDJf
aXRlbShjdXJyX29uX2NwdShjcHUpKTsKICAgICBpZiAoIHN2YyAmJiAhaXNfaWRsZV92Y3B1KHN2
Yy0+dmNwdSkgKQogICAgIHsKICAgICAgICAgcHJpbnRrKCJcdHJ1bjogIik7CkBAIC0zNzQ4LDcg
KzM3NDYsNyBAQCBjc2NoZWQyX2R1bXAoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzKQogCiAg
ICAgICAgIGZvcl9lYWNoX3ZjcHUoIHNkb20tPmRvbSwgdiApCiAgICAgICAgIHsKLSAgICAgICAg
ICAgIHN0cnVjdCBjc2NoZWQyX3ZjcHUgKiBjb25zdCBzdmMgPSBjc2NoZWQyX3ZjcHUodik7Cisg
ICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl9pdGVtICogY29uc3Qgc3ZjID0gY3NjaGVkMl9pdGVt
KHYtPnNjaGVkX2l0ZW0pOwogICAgICAgICAgICAgc3BpbmxvY2tfdCAqbG9jazsKIAogICAgICAg
ICAgICAgbG9jayA9IHZjcHVfc2NoZWR1bGVfbG9jayhzdmMtPnZjcHUpOwpAQCAtMzc3Nyw3ICsz
Nzc1LDcgQEAgY3NjaGVkMl9kdW1wKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcykKICAgICAg
ICAgcHJpbnRrKCJSVU5ROlxuIik7CiAgICAgICAgIGxpc3RfZm9yX2VhY2goIGl0ZXIsIHJ1bnEg
KQogICAgICAgICB7Ci0gICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl92Y3B1ICpzdmMgPSBydW5x
X2VsZW0oaXRlcik7CisgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl9pdGVtICpzdmMgPSBydW5x
X2VsZW0oaXRlcik7CiAKICAgICAgICAgICAgIGlmICggc3ZjICkKICAgICAgICAgICAgIHsKQEAg
LTM4NzksNyArMzg3Nyw3IEBAIGNzY2hlZDJfc3dpdGNoX3NjaGVkKHN0cnVjdCBzY2hlZHVsZXIg
Km5ld19vcHMsIHVuc2lnbmVkIGludCBjcHUsCiAgICAgICAgICAgICAgICAgICAgICB2b2lkICpw
ZGF0YSwgdm9pZCAqdmRhdGEpCiB7CiAgICAgc3RydWN0IGNzY2hlZDJfcHJpdmF0ZSAqcHJ2ID0g
Y3NjaGVkMl9wcml2KG5ld19vcHMpOwotICAgIHN0cnVjdCBjc2NoZWQyX3ZjcHUgKnN2YyA9IHZk
YXRhOworICAgIHN0cnVjdCBjc2NoZWQyX2l0ZW0gKnN2YyA9IHZkYXRhOwogICAgIHVuc2lnbmVk
IHJxaTsKIAogICAgIEFTU0VSVChwZGF0YSAmJiBzdmMgJiYgaXNfaWRsZV92Y3B1KHN2Yy0+dmNw
dSkpOwpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZF9udWxsLmMgYi94ZW4vY29tbW9uL3Nj
aGVkX251bGwuYwppbmRleCBhMDhmMjM5OTNjLi5mN2EyNjUwYzQ4IDEwMDY0NAotLS0gYS94ZW4v
Y29tbW9uL3NjaGVkX251bGwuYworKysgYi94ZW4vY29tbW9uL3NjaGVkX251bGwuYwpAQCAtOTQs
NyArOTQsNyBAQCBERUZJTkVfUEVSX0NQVShzdHJ1Y3QgbnVsbF9wY3B1LCBucGMpOwogLyoKICAq
IFZpcnR1YWwgQ1BVCiAgKi8KLXN0cnVjdCBudWxsX3ZjcHUgeworc3RydWN0IG51bGxfaXRlbSB7
CiAgICAgc3RydWN0IGxpc3RfaGVhZCB3YWl0cV9lbGVtOwogICAgIHN0cnVjdCB2Y3B1ICp2Y3B1
OwogfTsKQEAgLTExNSw5ICsxMTUsOSBAQCBzdGF0aWMgaW5saW5lIHN0cnVjdCBudWxsX3ByaXZh
dGUgKm51bGxfcHJpdihjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMpCiAgICAgcmV0dXJuIG9w
cy0+c2NoZWRfZGF0YTsKIH0KIAotc3RhdGljIGlubGluZSBzdHJ1Y3QgbnVsbF92Y3B1ICpudWxs
X3ZjcHUoY29uc3Qgc3RydWN0IHZjcHUgKnYpCitzdGF0aWMgaW5saW5lIHN0cnVjdCBudWxsX2l0
ZW0gKm51bGxfaXRlbShjb25zdCBzdHJ1Y3Qgc2NoZWRfaXRlbSAqaXRlbSkKIHsKLSAgICByZXR1
cm4gdi0+c2NoZWRfaXRlbS0+cHJpdjsKKyAgICByZXR1cm4gaXRlbS0+cHJpdjsKIH0KIAogc3Rh
dGljIGlubGluZSBib29sIHZjcHVfY2hlY2tfYWZmaW5pdHkoc3RydWN0IHZjcHUgKnYsIHVuc2ln
bmVkIGludCBjcHUsCkBAIC0xOTcsOSArMTk3LDkgQEAgc3RhdGljIHZvaWQgKm51bGxfYWxsb2Nf
dmRhdGEoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgc3RydWN0IHNjaGVkX2l0ZW0gKml0ZW0sIHZvaWQgKmRkKQogewogICAgIHN0cnVj
dCB2Y3B1ICp2ID0gaXRlbS0+dmNwdTsKLSAgICBzdHJ1Y3QgbnVsbF92Y3B1ICpudmM7CisgICAg
c3RydWN0IG51bGxfaXRlbSAqbnZjOwogCi0gICAgbnZjID0geHphbGxvYyhzdHJ1Y3QgbnVsbF92
Y3B1KTsKKyAgICBudmMgPSB4emFsbG9jKHN0cnVjdCBudWxsX2l0ZW0pOwogICAgIGlmICggbnZj
ID09IE5VTEwgKQogICAgICAgICByZXR1cm4gTlVMTDsKIApAQCAtMjEzLDcgKzIxMyw3IEBAIHN0
YXRpYyB2b2lkICpudWxsX2FsbG9jX3ZkYXRhKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywK
IAogc3RhdGljIHZvaWQgbnVsbF9mcmVlX3ZkYXRhKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9w
cywgdm9pZCAqcHJpdikKIHsKLSAgICBzdHJ1Y3QgbnVsbF92Y3B1ICpudmMgPSBwcml2OworICAg
IHN0cnVjdCBudWxsX2l0ZW0gKm52YyA9IHByaXY7CiAKICAgICB4ZnJlZShudmMpOwogfQpAQCAt
MzkwLDcgKzM5MCw3IEBAIHN0YXRpYyB2b2lkIG51bGxfc3dpdGNoX3NjaGVkKHN0cnVjdCBzY2hl
ZHVsZXIgKm5ld19vcHMsIHVuc2lnbmVkIGludCBjcHUsCiB7CiAgICAgc3RydWN0IHNjaGVkdWxl
X2RhdGEgKnNkID0gJnBlcl9jcHUoc2NoZWR1bGVfZGF0YSwgY3B1KTsKICAgICBzdHJ1Y3QgbnVs
bF9wcml2YXRlICpwcnYgPSBudWxsX3ByaXYobmV3X29wcyk7Ci0gICAgc3RydWN0IG51bGxfdmNw
dSAqbnZjID0gdmRhdGE7CisgICAgc3RydWN0IG51bGxfaXRlbSAqbnZjID0gdmRhdGE7CiAKICAg
ICBBU1NFUlQobnZjICYmIGlzX2lkbGVfdmNwdShudmMtPnZjcHUpKTsKIApAQCAtNDIyLDcgKzQy
Miw3IEBAIHN0YXRpYyB2b2lkIG51bGxfaXRlbV9pbnNlcnQoY29uc3Qgc3RydWN0IHNjaGVkdWxl
ciAqb3BzLAogewogICAgIHN0cnVjdCB2Y3B1ICp2ID0gaXRlbS0+dmNwdTsKICAgICBzdHJ1Y3Qg
bnVsbF9wcml2YXRlICpwcnYgPSBudWxsX3ByaXYob3BzKTsKLSAgICBzdHJ1Y3QgbnVsbF92Y3B1
ICpudmMgPSBudWxsX3ZjcHUodik7CisgICAgc3RydWN0IG51bGxfaXRlbSAqbnZjID0gbnVsbF9p
dGVtKGl0ZW0pOwogICAgIHVuc2lnbmVkIGludCBjcHU7CiAgICAgc3BpbmxvY2tfdCAqbG9jazsK
IApAQCAtNDc5LDkgKzQ3OSw5IEBAIHN0YXRpYyB2b2lkIF92Y3B1X3JlbW92ZShzdHJ1Y3QgbnVs
bF9wcml2YXRlICpwcnYsIHN0cnVjdCB2Y3B1ICp2KQogewogICAgIHVuc2lnbmVkIGludCBiczsK
ICAgICB1bnNpZ25lZCBpbnQgY3B1ID0gdi0+cHJvY2Vzc29yOwotICAgIHN0cnVjdCBudWxsX3Zj
cHUgKnd2YzsKKyAgICBzdHJ1Y3QgbnVsbF9pdGVtICp3dmM7CiAKLSAgICBBU1NFUlQobGlzdF9l
bXB0eSgmbnVsbF92Y3B1KHYpLT53YWl0cV9lbGVtKSk7CisgICAgQVNTRVJUKGxpc3RfZW1wdHko
Jm51bGxfaXRlbSh2LT5zY2hlZF9pdGVtKS0+d2FpdHFfZWxlbSkpOwogCiAgICAgdmNwdV9kZWFz
c2lnbihwcnYsIHYsIGNwdSk7CiAKQEAgLTUxNyw3ICs1MTcsNyBAQCBzdGF0aWMgdm9pZCBudWxs
X2l0ZW1fcmVtb3ZlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKIHsKICAgICBzdHJ1Y3Qg
dmNwdSAqdiA9IGl0ZW0tPnZjcHU7CiAgICAgc3RydWN0IG51bGxfcHJpdmF0ZSAqcHJ2ID0gbnVs
bF9wcml2KG9wcyk7Ci0gICAgc3RydWN0IG51bGxfdmNwdSAqbnZjID0gbnVsbF92Y3B1KHYpOwor
ICAgIHN0cnVjdCBudWxsX2l0ZW0gKm52YyA9IG51bGxfaXRlbShpdGVtKTsKICAgICBzcGlubG9j
a190ICpsb2NrOwogCiAgICAgQVNTRVJUKCFpc19pZGxlX3ZjcHUodikpOwpAQCAtNTUyLDEzICs1
NTIsMTMgQEAgc3RhdGljIHZvaWQgbnVsbF9pdGVtX3dha2UoY29uc3Qgc3RydWN0IHNjaGVkdWxl
ciAqb3BzLAogCiAgICAgQVNTRVJUKCFpc19pZGxlX3ZjcHUodikpOwogCi0gICAgaWYgKCB1bmxp
a2VseShjdXJyX29uX2NwdSh2LT5wcm9jZXNzb3IpID09IHYpICkKKyAgICBpZiAoIHVubGlrZWx5
KGN1cnJfb25fY3B1KHYtPnByb2Nlc3NvcikgPT0gaXRlbSkgKQogICAgIHsKICAgICAgICAgU0NI
RURfU1RBVF9DUkFOSyh2Y3B1X3dha2VfcnVubmluZyk7CiAgICAgICAgIHJldHVybjsKICAgICB9
CiAKLSAgICBpZiAoIHVubGlrZWx5KCFsaXN0X2VtcHR5KCZudWxsX3ZjcHUodiktPndhaXRxX2Vs
ZW0pKSApCisgICAgaWYgKCB1bmxpa2VseSghbGlzdF9lbXB0eSgmbnVsbF9pdGVtKGl0ZW0pLT53
YWl0cV9lbGVtKSkgKQogICAgIHsKICAgICAgICAgLyogTm90IGV4YWN0bHkgIm9uIHJ1bnEiLCBi
dXQgY2xvc2UgZW5vdWdoIGZvciByZXVzaW5nIHRoZSBjb3VudGVyICovCiAgICAgICAgIFNDSEVE
X1NUQVRfQ1JBTksodmNwdV93YWtlX29ucnVucSk7CkBAIC01ODIsNyArNTgyLDcgQEAgc3RhdGlj
IHZvaWQgbnVsbF9pdGVtX3NsZWVwKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKICAgICBB
U1NFUlQoIWlzX2lkbGVfdmNwdSh2KSk7CiAKICAgICAvKiBJZiB2IGlzIG5vdCBhc3NpZ25lZCB0
byBhIHBDUFUsIG9yIGlzIG5vdCBydW5uaW5nLCBubyBuZWVkIHRvIGJvdGhlciAqLwotICAgIGlm
ICggY3Vycl9vbl9jcHUodi0+cHJvY2Vzc29yKSA9PSB2ICkKKyAgICBpZiAoIGN1cnJfb25fY3B1
KHYtPnByb2Nlc3NvcikgPT0gaXRlbSApCiAgICAgICAgIGNwdV9yYWlzZV9zb2Z0aXJxKHYtPnBy
b2Nlc3NvciwgU0NIRURVTEVfU09GVElSUSk7CiAKICAgICBTQ0hFRF9TVEFUX0NSQU5LKHZjcHVf
c2xlZXApOwpAQCAtNjAwLDcgKzYwMCw3IEBAIHN0YXRpYyB2b2lkIG51bGxfaXRlbV9taWdyYXRl
KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKIHsKICAgICBzdHJ1Y3QgdmNwdSAqdiA9IGl0
ZW0tPnZjcHU7CiAgICAgc3RydWN0IG51bGxfcHJpdmF0ZSAqcHJ2ID0gbnVsbF9wcml2KG9wcyk7
Ci0gICAgc3RydWN0IG51bGxfdmNwdSAqbnZjID0gbnVsbF92Y3B1KHYpOworICAgIHN0cnVjdCBu
dWxsX2l0ZW0gKm52YyA9IG51bGxfaXRlbShpdGVtKTsKIAogICAgIEFTU0VSVCghaXNfaWRsZV92
Y3B1KHYpKTsKIApAQCAtNjg1LDcgKzY4NSw3IEBAIHN0YXRpYyB2b2lkIG51bGxfaXRlbV9taWdy
YXRlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKICNpZm5kZWYgTkRFQlVHCiBzdGF0aWMg
aW5saW5lIHZvaWQgbnVsbF92Y3B1X2NoZWNrKHN0cnVjdCB2Y3B1ICp2KQogewotICAgIHN0cnVj
dCBudWxsX3ZjcHUgKiBjb25zdCBudmMgPSBudWxsX3ZjcHUodik7CisgICAgc3RydWN0IG51bGxf
aXRlbSAqIGNvbnN0IG52YyA9IG51bGxfaXRlbSh2LT5zY2hlZF9pdGVtKTsKICAgICBzdHJ1Y3Qg
bnVsbF9kb20gKiBjb25zdCBuZG9tID0gdi0+ZG9tYWluLT5zY2hlZF9wcml2OwogCiAgICAgQlVH
X09OKG52Yy0+dmNwdSAhPSB2KTsKQEAgLTcxNSw3ICs3MTUsNyBAQCBzdGF0aWMgc3RydWN0IHRh
c2tfc2xpY2UgbnVsbF9zY2hlZHVsZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAgICAg
dW5zaWduZWQgaW50IGJzOwogICAgIGNvbnN0IHVuc2lnbmVkIGludCBjcHUgPSBzbXBfcHJvY2Vz
c29yX2lkKCk7CiAgICAgc3RydWN0IG51bGxfcHJpdmF0ZSAqcHJ2ID0gbnVsbF9wcml2KG9wcyk7
Ci0gICAgc3RydWN0IG51bGxfdmNwdSAqd3ZjOworICAgIHN0cnVjdCBudWxsX2l0ZW0gKnd2YzsK
ICAgICBzdHJ1Y3QgdGFza19zbGljZSByZXQ7CiAKICAgICBTQ0hFRF9TVEFUX0NSQU5LKHNjaGVk
dWxlKTsKQEAgLTc5OCw3ICs3OTgsNyBAQCBzdGF0aWMgc3RydWN0IHRhc2tfc2xpY2UgbnVsbF9z
Y2hlZHVsZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAgICAgcmV0dXJuIHJldDsKIH0K
IAotc3RhdGljIGlubGluZSB2b2lkIGR1bXBfdmNwdShzdHJ1Y3QgbnVsbF9wcml2YXRlICpwcnYs
IHN0cnVjdCBudWxsX3ZjcHUgKm52YykKK3N0YXRpYyBpbmxpbmUgdm9pZCBkdW1wX3ZjcHUoc3Ry
dWN0IG51bGxfcHJpdmF0ZSAqcHJ2LCBzdHJ1Y3QgbnVsbF9pdGVtICpudmMpCiB7CiAgICAgcHJp
bnRrKCJbJWkuJWldIHBjcHU9JWQiLCBudmMtPnZjcHUtPmRvbWFpbi0+ZG9tYWluX2lkLAogICAg
ICAgICAgICAgbnZjLT52Y3B1LT52Y3B1X2lkLCBsaXN0X2VtcHR5KCZudmMtPndhaXRxX2VsZW0p
ID8KQEAgLTgwOCw3ICs4MDgsNyBAQCBzdGF0aWMgaW5saW5lIHZvaWQgZHVtcF92Y3B1KHN0cnVj
dCBudWxsX3ByaXZhdGUgKnBydiwgc3RydWN0IG51bGxfdmNwdSAqbnZjKQogc3RhdGljIHZvaWQg
bnVsbF9kdW1wX3BjcHUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBpbnQgY3B1KQogewog
ICAgIHN0cnVjdCBudWxsX3ByaXZhdGUgKnBydiA9IG51bGxfcHJpdihvcHMpOwotICAgIHN0cnVj
dCBudWxsX3ZjcHUgKm52YzsKKyAgICBzdHJ1Y3QgbnVsbF9pdGVtICpudmM7CiAgICAgc3Bpbmxv
Y2tfdCAqbG9jazsKICAgICB1bnNpZ25lZCBsb25nIGZsYWdzOwogCkBAIC04MjMsNyArODIzLDcg
QEAgc3RhdGljIHZvaWQgbnVsbF9kdW1wX3BjcHUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3Bz
LCBpbnQgY3B1KQogICAgIHByaW50aygiXG4iKTsKIAogICAgIC8qIGN1cnJlbnQgVkNQVSAobm90
aGluZyB0byBzYXkgaWYgdGhhdCdzIHRoZSBpZGxlIHZjcHUpICovCi0gICAgbnZjID0gbnVsbF92
Y3B1KGN1cnJfb25fY3B1KGNwdSkpOworICAgIG52YyA9IG51bGxfaXRlbShjdXJyX29uX2NwdShj
cHUpKTsKICAgICBpZiAoIG52YyAmJiAhaXNfaWRsZV92Y3B1KG52Yy0+dmNwdSkgKQogICAgIHsK
ICAgICAgICAgcHJpbnRrKCJcdHJ1bjogIik7CkBAIC04NTcsNyArODU3LDcgQEAgc3RhdGljIHZv
aWQgbnVsbF9kdW1wKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcykKICAgICAgICAgcHJpbnRr
KCJcdERvbWFpbjogJWRcbiIsIG5kb20tPmRvbS0+ZG9tYWluX2lkKTsKICAgICAgICAgZm9yX2Vh
Y2hfdmNwdSggbmRvbS0+ZG9tLCB2ICkKICAgICAgICAgewotICAgICAgICAgICAgc3RydWN0IG51
bGxfdmNwdSAqIGNvbnN0IG52YyA9IG51bGxfdmNwdSh2KTsKKyAgICAgICAgICAgIHN0cnVjdCBu
dWxsX2l0ZW0gKiBjb25zdCBudmMgPSBudWxsX2l0ZW0odi0+c2NoZWRfaXRlbSk7CiAgICAgICAg
ICAgICBzcGlubG9ja190ICpsb2NrOwogCiAgICAgICAgICAgICBsb2NrID0gdmNwdV9zY2hlZHVs
ZV9sb2NrKG52Yy0+dmNwdSk7CkBAIC04NzUsNyArODc1LDcgQEAgc3RhdGljIHZvaWQgbnVsbF9k
dW1wKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcykKICAgICBzcGluX2xvY2soJnBydi0+d2Fp
dHFfbG9jayk7CiAgICAgbGlzdF9mb3JfZWFjaCggaXRlciwgJnBydi0+d2FpdHEgKQogICAgIHsK
LSAgICAgICAgc3RydWN0IG51bGxfdmNwdSAqbnZjID0gbGlzdF9lbnRyeShpdGVyLCBzdHJ1Y3Qg
bnVsbF92Y3B1LCB3YWl0cV9lbGVtKTsKKyAgICAgICAgc3RydWN0IG51bGxfaXRlbSAqbnZjID0g
bGlzdF9lbnRyeShpdGVyLCBzdHJ1Y3QgbnVsbF9pdGVtLCB3YWl0cV9lbGVtKTsKIAogICAgICAg
ICBpZiAoIGxvb3ArKyAhPSAwICkKICAgICAgICAgICAgIHByaW50aygiLCAiKTsKZGlmZiAtLWdp
dCBhL3hlbi9jb21tb24vc2NoZWRfcnQuYyBiL3hlbi9jb21tb24vc2NoZWRfcnQuYwppbmRleCAy
YmQ0NjM3NTkyLi5hM2NkMDBmNzY1IDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL3NjaGVkX3J0LmMK
KysrIGIveGVuL2NvbW1vbi9zY2hlZF9ydC5jCkBAIC0xOTUsNyArMTk1LDcgQEAgc3RydWN0IHJ0
X3ByaXZhdGUgewogLyoKICAqIFZpcnR1YWwgQ1BVCiAgKi8KLXN0cnVjdCBydF92Y3B1IHsKK3N0
cnVjdCBydF9pdGVtIHsKICAgICBzdHJ1Y3QgbGlzdF9oZWFkIHFfZWxlbTsgICAgIC8qIG9uIHRo
ZSBydW5xL2RlcGxldGVkcSBsaXN0ICovCiAgICAgc3RydWN0IGxpc3RfaGVhZCByZXBscV9lbGVt
OyAvKiBvbiB0aGUgcmVwbGVuaXNobWVudCBldmVudHMgbGlzdCAqLwogCkBAIC0yMzMsOSArMjMz
LDkgQEAgc3RhdGljIGlubGluZSBzdHJ1Y3QgcnRfcHJpdmF0ZSAqcnRfcHJpdihjb25zdCBzdHJ1
Y3Qgc2NoZWR1bGVyICpvcHMpCiAgICAgcmV0dXJuIG9wcy0+c2NoZWRfZGF0YTsKIH0KIAotc3Rh
dGljIGlubGluZSBzdHJ1Y3QgcnRfdmNwdSAqcnRfdmNwdShjb25zdCBzdHJ1Y3QgdmNwdSAqdmNw
dSkKK3N0YXRpYyBpbmxpbmUgc3RydWN0IHJ0X2l0ZW0gKnJ0X2l0ZW0oY29uc3Qgc3RydWN0IHNj
aGVkX2l0ZW0gKml0ZW0pCiB7Ci0gICAgcmV0dXJuIHZjcHUtPnNjaGVkX2l0ZW0tPnByaXY7Cisg
ICAgcmV0dXJuIGl0ZW0tPnByaXY7CiB9CiAKIHN0YXRpYyBpbmxpbmUgc3RydWN0IGxpc3RfaGVh
ZCAqcnRfcnVucShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMpCkBAIC0yNTMsNyArMjUzLDcg
QEAgc3RhdGljIGlubGluZSBzdHJ1Y3QgbGlzdF9oZWFkICpydF9yZXBscShjb25zdCBzdHJ1Y3Qg
c2NoZWR1bGVyICpvcHMpCiAgICAgcmV0dXJuICZydF9wcml2KG9wcyktPnJlcGxxOwogfQogCi1z
dGF0aWMgaW5saW5lIGJvb2wgaGFzX2V4dHJhdGltZShjb25zdCBzdHJ1Y3QgcnRfdmNwdSAqc3Zj
KQorc3RhdGljIGlubGluZSBib29sIGhhc19leHRyYXRpbWUoY29uc3Qgc3RydWN0IHJ0X2l0ZW0g
KnN2YykKIHsKICAgICByZXR1cm4gc3ZjLT5mbGFncyAmIFJURFNfZXh0cmF0aW1lOwogfQpAQCAt
MjYzLDI1ICsyNjMsMjUgQEAgc3RhdGljIGlubGluZSBib29sIGhhc19leHRyYXRpbWUoY29uc3Qg
c3RydWN0IHJ0X3ZjcHUgKnN2YykKICAqIGFuZCB0aGUgcmVwbGVuaXNobWVudCBldmVudHMgcXVl
dWUuCiAgKi8KIHN0YXRpYyBpbnQKLXZjcHVfb25fcShjb25zdCBzdHJ1Y3QgcnRfdmNwdSAqc3Zj
KQordmNwdV9vbl9xKGNvbnN0IHN0cnVjdCBydF9pdGVtICpzdmMpCiB7CiAgICByZXR1cm4gIWxp
c3RfZW1wdHkoJnN2Yy0+cV9lbGVtKTsKIH0KIAotc3RhdGljIHN0cnVjdCBydF92Y3B1ICoKK3N0
YXRpYyBzdHJ1Y3QgcnRfaXRlbSAqCiBxX2VsZW0oc3RydWN0IGxpc3RfaGVhZCAqZWxlbSkKIHsK
LSAgICByZXR1cm4gbGlzdF9lbnRyeShlbGVtLCBzdHJ1Y3QgcnRfdmNwdSwgcV9lbGVtKTsKKyAg
ICByZXR1cm4gbGlzdF9lbnRyeShlbGVtLCBzdHJ1Y3QgcnRfaXRlbSwgcV9lbGVtKTsKIH0KIAot
c3RhdGljIHN0cnVjdCBydF92Y3B1ICoKK3N0YXRpYyBzdHJ1Y3QgcnRfaXRlbSAqCiByZXBscV9l
bGVtKHN0cnVjdCBsaXN0X2hlYWQgKmVsZW0pCiB7Ci0gICAgcmV0dXJuIGxpc3RfZW50cnkoZWxl
bSwgc3RydWN0IHJ0X3ZjcHUsIHJlcGxxX2VsZW0pOworICAgIHJldHVybiBsaXN0X2VudHJ5KGVs
ZW0sIHN0cnVjdCBydF9pdGVtLCByZXBscV9lbGVtKTsKIH0KIAogc3RhdGljIGludAotdmNwdV9v
bl9yZXBscShjb25zdCBzdHJ1Y3QgcnRfdmNwdSAqc3ZjKQordmNwdV9vbl9yZXBscShjb25zdCBz
dHJ1Y3QgcnRfaXRlbSAqc3ZjKQogewogICAgIHJldHVybiAhbGlzdF9lbXB0eSgmc3ZjLT5yZXBs
cV9lbGVtKTsKIH0KQEAgLTI5MSw3ICsyOTEsNyBAQCB2Y3B1X29uX3JlcGxxKGNvbnN0IHN0cnVj
dCBydF92Y3B1ICpzdmMpCiAgKiBPdGhlcndpc2UsIHJldHVybiB2YWx1ZSA8IDAKICAqLwogc3Rh
dGljIHNfdGltZV90Ci1jb21wYXJlX3ZjcHVfcHJpb3JpdHkoY29uc3Qgc3RydWN0IHJ0X3ZjcHUg
KnYxLCBjb25zdCBzdHJ1Y3QgcnRfdmNwdSAqdjIpCitjb21wYXJlX3ZjcHVfcHJpb3JpdHkoY29u
c3Qgc3RydWN0IHJ0X2l0ZW0gKnYxLCBjb25zdCBzdHJ1Y3QgcnRfaXRlbSAqdjIpCiB7CiAgICAg
aW50IHByaW8gPSB2Mi0+cHJpb3JpdHlfbGV2ZWwgLSB2MS0+cHJpb3JpdHlfbGV2ZWw7CiAKQEAg
LTMwNSw3ICszMDUsNyBAQCBjb21wYXJlX3ZjcHVfcHJpb3JpdHkoY29uc3Qgc3RydWN0IHJ0X3Zj
cHUgKnYxLCBjb25zdCBzdHJ1Y3QgcnRfdmNwdSAqdjIpCiAgKiBEZWJ1ZyByZWxhdGVkIGNvZGUs
IGR1bXAgdmNwdS9jcHUgaW5mb3JtYXRpb24KICAqLwogc3RhdGljIHZvaWQKLXJ0X2R1bXBfdmNw
dShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGNvbnN0IHN0cnVjdCBydF92Y3B1ICpzdmMp
CitydF9kdW1wX3ZjcHUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBjb25zdCBzdHJ1Y3Qg
cnRfaXRlbSAqc3ZjKQogewogICAgIGNwdW1hc2tfdCAqY3B1cG9vbF9tYXNrLCAqbWFzazsKIApA
QCAtMzUyLDEzICszNTIsMTMgQEAgc3RhdGljIHZvaWQKIHJ0X2R1bXBfcGNwdShjb25zdCBzdHJ1
Y3Qgc2NoZWR1bGVyICpvcHMsIGludCBjcHUpCiB7CiAgICAgc3RydWN0IHJ0X3ByaXZhdGUgKnBy
diA9IHJ0X3ByaXYob3BzKTsKLSAgICBzdHJ1Y3QgcnRfdmNwdSAqc3ZjOworICAgIHN0cnVjdCBy
dF9pdGVtICpzdmM7CiAgICAgdW5zaWduZWQgbG9uZyBmbGFnczsKIAogICAgIHNwaW5fbG9ja19p
cnFzYXZlKCZwcnYtPmxvY2ssIGZsYWdzKTsKICAgICBwcmludGsoIkNQVVslMDJkXVxuIiwgY3B1
KTsKICAgICAvKiBjdXJyZW50IFZDUFUgKG5vdGhpbmcgdG8gc2F5IGlmIHRoYXQncyB0aGUgaWRs
ZSB2Y3B1KS4gKi8KLSAgICBzdmMgPSBydF92Y3B1KGN1cnJfb25fY3B1KGNwdSkpOworICAgIHN2
YyA9IHJ0X2l0ZW0oY3Vycl9vbl9jcHUoY3B1KSk7CiAgICAgaWYgKCBzdmMgJiYgIWlzX2lkbGVf
dmNwdShzdmMtPnZjcHUpICkKICAgICB7CiAgICAgICAgIHJ0X2R1bXBfdmNwdShvcHMsIHN2Yyk7
CkBAIC0zNzEsNyArMzcxLDcgQEAgcnRfZHVtcChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMp
CiB7CiAgICAgc3RydWN0IGxpc3RfaGVhZCAqcnVucSwgKmRlcGxldGVkcSwgKnJlcGxxLCAqaXRl
cjsKICAgICBzdHJ1Y3QgcnRfcHJpdmF0ZSAqcHJ2ID0gcnRfcHJpdihvcHMpOwotICAgIHN0cnVj
dCBydF92Y3B1ICpzdmM7CisgICAgc3RydWN0IHJ0X2l0ZW0gKnN2YzsKICAgICBzdHJ1Y3QgcnRf
ZG9tICpzZG9tOwogICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAKQEAgLTQxNSw3ICs0MTUsNyBA
QCBydF9kdW1wKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcykKIAogICAgICAgICBmb3JfZWFj
aF92Y3B1ICggc2RvbS0+ZG9tLCB2ICkKICAgICAgICAgewotICAgICAgICAgICAgc3ZjID0gcnRf
dmNwdSh2KTsKKyAgICAgICAgICAgIHN2YyA9IHJ0X2l0ZW0odi0+c2NoZWRfaXRlbSk7CiAgICAg
ICAgICAgICBydF9kdW1wX3ZjcHUob3BzLCBzdmMpOwogICAgICAgICB9CiAgICAgfQpAQCAtNDI5
LDcgKzQyOSw3IEBAIHJ0X2R1bXAoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzKQogICogaXQg
bmVlZHMgdG8gYmUgdXBkYXRlZCB0byB0aGUgZGVhZGxpbmUgb2YgdGhlIGN1cnJlbnQgcGVyaW9k
CiAgKi8KIHN0YXRpYyB2b2lkCi1ydF91cGRhdGVfZGVhZGxpbmUoc190aW1lX3Qgbm93LCBzdHJ1
Y3QgcnRfdmNwdSAqc3ZjKQorcnRfdXBkYXRlX2RlYWRsaW5lKHNfdGltZV90IG5vdywgc3RydWN0
IHJ0X2l0ZW0gKnN2YykKIHsKICAgICBBU1NFUlQobm93ID49IHN2Yy0+Y3VyX2RlYWRsaW5lKTsK
ICAgICBBU1NFUlQoc3ZjLT5wZXJpb2QgIT0gMCk7CkBAIC01MDAsOCArNTAwLDggQEAgZGVhZGxp
bmVfcXVldWVfcmVtb3ZlKHN0cnVjdCBsaXN0X2hlYWQgKnF1ZXVlLCBzdHJ1Y3QgbGlzdF9oZWFk
ICplbGVtKQogfQogCiBzdGF0aWMgaW5saW5lIGJvb2wKLWRlYWRsaW5lX3F1ZXVlX2luc2VydChz
dHJ1Y3QgcnRfdmNwdSAqICgqcWVsZW0pKHN0cnVjdCBsaXN0X2hlYWQgKiksCi0gICAgICAgICAg
ICAgICAgICAgICAgc3RydWN0IHJ0X3ZjcHUgKnN2Yywgc3RydWN0IGxpc3RfaGVhZCAqZWxlbSwK
K2RlYWRsaW5lX3F1ZXVlX2luc2VydChzdHJ1Y3QgcnRfaXRlbSAqICgqcWVsZW0pKHN0cnVjdCBs
aXN0X2hlYWQgKiksCisgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHJ0X2l0ZW0gKnN2Yywg
c3RydWN0IGxpc3RfaGVhZCAqZWxlbSwKICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgbGlz
dF9oZWFkICpxdWV1ZSkKIHsKICAgICBzdHJ1Y3QgbGlzdF9oZWFkICppdGVyOwpAQCAtNTA5LDcg
KzUwOSw3IEBAIGRlYWRsaW5lX3F1ZXVlX2luc2VydChzdHJ1Y3QgcnRfdmNwdSAqICgqcWVsZW0p
KHN0cnVjdCBsaXN0X2hlYWQgKiksCiAKICAgICBsaXN0X2Zvcl9lYWNoICggaXRlciwgcXVldWUg
KQogICAgIHsKLSAgICAgICAgc3RydWN0IHJ0X3ZjcHUgKiBpdGVyX3N2YyA9ICgqcWVsZW0pKGl0
ZXIpOworICAgICAgICBzdHJ1Y3QgcnRfaXRlbSAqIGl0ZXJfc3ZjID0gKCpxZWxlbSkoaXRlcik7
CiAgICAgICAgIGlmICggY29tcGFyZV92Y3B1X3ByaW9yaXR5KHN2YywgaXRlcl9zdmMpID4gMCAp
CiAgICAgICAgICAgICBicmVhazsKICAgICAgICAgcG9zKys7CkBAIC01MjMsMTQgKzUyMywxNCBA
QCBkZWFkbGluZV9xdWV1ZV9pbnNlcnQoc3RydWN0IHJ0X3ZjcHUgKiAoKnFlbGVtKShzdHJ1Y3Qg
bGlzdF9oZWFkICopLAogICBkZWFkbGluZV9xdWV1ZV9pbnNlcnQoJnJlcGxxX2VsZW0sICMjX19W
QV9BUkdTX18pCiAKIHN0YXRpYyBpbmxpbmUgdm9pZAotcV9yZW1vdmUoc3RydWN0IHJ0X3ZjcHUg
KnN2YykKK3FfcmVtb3ZlKHN0cnVjdCBydF9pdGVtICpzdmMpCiB7CiAgICAgQVNTRVJUKCB2Y3B1
X29uX3Eoc3ZjKSApOwogICAgIGxpc3RfZGVsX2luaXQoJnN2Yy0+cV9lbGVtKTsKIH0KIAogc3Rh
dGljIGlubGluZSB2b2lkCi1yZXBscV9yZW1vdmUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3Bz
LCBzdHJ1Y3QgcnRfdmNwdSAqc3ZjKQorcmVwbHFfcmVtb3ZlKGNvbnN0IHN0cnVjdCBzY2hlZHVs
ZXIgKm9wcywgc3RydWN0IHJ0X2l0ZW0gKnN2YykKIHsKICAgICBzdHJ1Y3QgcnRfcHJpdmF0ZSAq
cHJ2ID0gcnRfcHJpdihvcHMpOwogICAgIHN0cnVjdCBsaXN0X2hlYWQgKnJlcGxxID0gcnRfcmVw
bHEob3BzKTsKQEAgLTU0Nyw3ICs1NDcsNyBAQCByZXBscV9yZW1vdmUoY29uc3Qgc3RydWN0IHNj
aGVkdWxlciAqb3BzLCBzdHJ1Y3QgcnRfdmNwdSAqc3ZjKQogICAgICAgICAgKi8KICAgICAgICAg
aWYgKCAhbGlzdF9lbXB0eShyZXBscSkgKQogICAgICAgICB7Ci0gICAgICAgICAgICBzdHJ1Y3Qg
cnRfdmNwdSAqc3ZjX25leHQgPSByZXBscV9lbGVtKHJlcGxxLT5uZXh0KTsKKyAgICAgICAgICAg
IHN0cnVjdCBydF9pdGVtICpzdmNfbmV4dCA9IHJlcGxxX2VsZW0ocmVwbHEtPm5leHQpOwogICAg
ICAgICAgICAgc2V0X3RpbWVyKCZwcnYtPnJlcGxfdGltZXIsIHN2Y19uZXh0LT5jdXJfZGVhZGxp
bmUpOwogICAgICAgICB9CiAgICAgICAgIGVsc2UKQEAgLTU2MSw3ICs1NjEsNyBAQCByZXBscV9y
ZW1vdmUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgcnRfdmNwdSAqc3ZjKQog
ICogSW5zZXJ0IHN2YyB3aXRob3V0IGJ1ZGdldCBpbiBEZXBsZXRlZFEgdW5zb3J0ZWQ7CiAgKi8K
IHN0YXRpYyB2b2lkCi1ydW5xX2luc2VydChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0
cnVjdCBydF92Y3B1ICpzdmMpCitydW5xX2luc2VydChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpv
cHMsIHN0cnVjdCBydF9pdGVtICpzdmMpCiB7CiAgICAgc3RydWN0IHJ0X3ByaXZhdGUgKnBydiA9
IHJ0X3ByaXYob3BzKTsKICAgICBzdHJ1Y3QgbGlzdF9oZWFkICpydW5xID0gcnRfcnVucShvcHMp
OwpAQCAtNTc5LDcgKzU3OSw3IEBAIHJ1bnFfaW5zZXJ0KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIg
Km9wcywgc3RydWN0IHJ0X3ZjcHUgKnN2YykKIH0KIAogc3RhdGljIHZvaWQKLXJlcGxxX2luc2Vy
dChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBydF92Y3B1ICpzdmMpCityZXBs
cV9pbnNlcnQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgcnRfaXRlbSAqc3Zj
KQogewogICAgIHN0cnVjdCBsaXN0X2hlYWQgKnJlcGxxID0gcnRfcmVwbHEob3BzKTsKICAgICBz
dHJ1Y3QgcnRfcHJpdmF0ZSAqcHJ2ID0gcnRfcHJpdihvcHMpOwpAQCAtNjAxLDEwICs2MDEsMTAg
QEAgcmVwbHFfaW5zZXJ0KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHJ0X3Zj
cHUgKnN2YykKICAqIGNoYW5nZWQuCiAgKi8KIHN0YXRpYyB2b2lkCi1yZXBscV9yZWluc2VydChj
b25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBydF92Y3B1ICpzdmMpCityZXBscV9y
ZWluc2VydChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBydF9pdGVtICpzdmMp
CiB7CiAgICAgc3RydWN0IGxpc3RfaGVhZCAqcmVwbHEgPSBydF9yZXBscShvcHMpOwotICAgIHN0
cnVjdCBydF92Y3B1ICpyZWFybV9zdmMgPSBzdmM7CisgICAgc3RydWN0IHJ0X2l0ZW0gKnJlYXJt
X3N2YyA9IHN2YzsKICAgICBib29sX3QgcmVhcm0gPSAwOwogCiAgICAgQVNTRVJUKCB2Y3B1X29u
X3JlcGxxKHN2YykgKTsKQEAgLTczNSw3ICs3MzUsNyBAQCBydF9zd2l0Y2hfc2NoZWQoc3RydWN0
IHNjaGVkdWxlciAqbmV3X29wcywgdW5zaWduZWQgaW50IGNwdSwKICAgICAgICAgICAgICAgICB2
b2lkICpwZGF0YSwgdm9pZCAqdmRhdGEpCiB7CiAgICAgc3RydWN0IHJ0X3ByaXZhdGUgKnBydiA9
IHJ0X3ByaXYobmV3X29wcyk7Ci0gICAgc3RydWN0IHJ0X3ZjcHUgKnN2YyA9IHZkYXRhOworICAg
IHN0cnVjdCBydF9pdGVtICpzdmMgPSB2ZGF0YTsKIAogICAgIEFTU0VSVCghcGRhdGEgJiYgc3Zj
ICYmIGlzX2lkbGVfdmNwdShzdmMtPnZjcHUpKTsKIApAQCAtODUwLDEwICs4NTAsMTAgQEAgc3Rh
dGljIHZvaWQgKgogcnRfYWxsb2NfdmRhdGEoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBz
dHJ1Y3Qgc2NoZWRfaXRlbSAqaXRlbSwgdm9pZCAqZGQpCiB7CiAgICAgc3RydWN0IHZjcHUgKnZj
ID0gaXRlbS0+dmNwdTsKLSAgICBzdHJ1Y3QgcnRfdmNwdSAqc3ZjOworICAgIHN0cnVjdCBydF9p
dGVtICpzdmM7CiAKICAgICAvKiBBbGxvY2F0ZSBwZXItVkNQVSBpbmZvICovCi0gICAgc3ZjID0g
eHphbGxvYyhzdHJ1Y3QgcnRfdmNwdSk7CisgICAgc3ZjID0geHphbGxvYyhzdHJ1Y3QgcnRfaXRl
bSk7CiAgICAgaWYgKCBzdmMgPT0gTlVMTCApCiAgICAgICAgIHJldHVybiBOVUxMOwogCkBAIC04
NzgsNyArODc4LDcgQEAgcnRfYWxsb2NfdmRhdGEoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3Bz
LCBzdHJ1Y3Qgc2NoZWRfaXRlbSAqaXRlbSwgdm9pZCAqZGQpCiBzdGF0aWMgdm9pZAogcnRfZnJl
ZV92ZGF0YShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHZvaWQgKnByaXYpCiB7Ci0gICAg
c3RydWN0IHJ0X3ZjcHUgKnN2YyA9IHByaXY7CisgICAgc3RydWN0IHJ0X2l0ZW0gKnN2YyA9IHBy
aXY7CiAKICAgICB4ZnJlZShzdmMpOwogfQpAQCAtODk0LDcgKzg5NCw3IEBAIHN0YXRpYyB2b2lk
CiBydF9pdGVtX2luc2VydChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hl
ZF9pdGVtICppdGVtKQogewogICAgIHN0cnVjdCB2Y3B1ICp2YyA9IGl0ZW0tPnZjcHU7Ci0gICAg
c3RydWN0IHJ0X3ZjcHUgKnN2YyA9IHJ0X3ZjcHUodmMpOworICAgIHN0cnVjdCBydF9pdGVtICpz
dmMgPSBydF9pdGVtKGl0ZW0pOwogICAgIHNfdGltZV90IG5vdzsKICAgICBzcGlubG9ja190ICps
b2NrOwogCkBAIC05MjMsMTMgKzkyMywxMyBAQCBydF9pdGVtX2luc2VydChjb25zdCBzdHJ1Y3Qg
c2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF9pdGVtICppdGVtKQogfQogCiAvKgotICogUmVt
b3ZlIHJ0X3ZjcHUgc3ZjIGZyb20gdGhlIG9sZCBzY2hlZHVsZXIgaW4gc291cmNlIGNwdXBvb2wu
CisgKiBSZW1vdmUgcnRfaXRlbSBzdmMgZnJvbSB0aGUgb2xkIHNjaGVkdWxlciBpbiBzb3VyY2Ug
Y3B1cG9vbC4KICAqLwogc3RhdGljIHZvaWQKIHJ0X2l0ZW1fcmVtb3ZlKGNvbnN0IHN0cnVjdCBz
Y2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX2l0ZW0gKml0ZW0pCiB7CiAgICAgc3RydWN0IHZj
cHUgKnZjID0gaXRlbS0+dmNwdTsKLSAgICBzdHJ1Y3QgcnRfdmNwdSAqIGNvbnN0IHN2YyA9IHJ0
X3ZjcHUodmMpOworICAgIHN0cnVjdCBydF9pdGVtICogY29uc3Qgc3ZjID0gcnRfaXRlbShpdGVt
KTsKICAgICBzdHJ1Y3QgcnRfZG9tICogY29uc3Qgc2RvbSA9IHN2Yy0+c2RvbTsKICAgICBzcGlu
bG9ja190ICpsb2NrOwogCkBAIC05NTEsNyArOTUxLDcgQEAgcnRfaXRlbV9yZW1vdmUoY29uc3Qg
c3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfaXRlbSAqaXRlbSkKICAqIEJ1cm4g
YnVkZ2V0IGluIG5hbm9zZWNvbmQgZ3JhbnVsYXJpdHkKICAqLwogc3RhdGljIHZvaWQKLWJ1cm5f
YnVkZ2V0KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHJ0X3ZjcHUgKnN2Yywg
c190aW1lX3Qgbm93KQorYnVybl9idWRnZXQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBz
dHJ1Y3QgcnRfaXRlbSAqc3ZjLCBzX3RpbWVfdCBub3cpCiB7CiAgICAgc190aW1lX3QgZGVsdGE7
CiAKQEAgLTEwMTUsMTMgKzEwMTUsMTMgQEAgYnVybl9idWRnZXQoY29uc3Qgc3RydWN0IHNjaGVk
dWxlciAqb3BzLCBzdHJ1Y3QgcnRfdmNwdSAqc3ZjLCBzX3RpbWVfdCBub3cpCiAgKiBSdW5RIGlz
IHNvcnRlZC4gUGljayBmaXJzdCBvbmUgd2l0aGluIGNwdW1hc2suIElmIG5vIG9uZSwgcmV0dXJu
IE5VTEwKICAqIGxvY2sgaXMgZ3JhYmJlZCBiZWZvcmUgY2FsbGluZyB0aGlzIGZ1bmN0aW9uCiAg
Ki8KLXN0YXRpYyBzdHJ1Y3QgcnRfdmNwdSAqCitzdGF0aWMgc3RydWN0IHJ0X2l0ZW0gKgogcnVu
cV9waWNrKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgY29uc3QgY3B1bWFza190ICptYXNr
KQogewogICAgIHN0cnVjdCBsaXN0X2hlYWQgKnJ1bnEgPSBydF9ydW5xKG9wcyk7CiAgICAgc3Ry
dWN0IGxpc3RfaGVhZCAqaXRlcjsKLSAgICBzdHJ1Y3QgcnRfdmNwdSAqc3ZjID0gTlVMTDsKLSAg
ICBzdHJ1Y3QgcnRfdmNwdSAqaXRlcl9zdmMgPSBOVUxMOworICAgIHN0cnVjdCBydF9pdGVtICpz
dmMgPSBOVUxMOworICAgIHN0cnVjdCBydF9pdGVtICppdGVyX3N2YyA9IE5VTEw7CiAgICAgY3B1
bWFza190IGNwdV9jb21tb247CiAgICAgY3B1bWFza190ICpvbmxpbmU7CiAKQEAgLTEwNzIsOCAr
MTA3Miw4IEBAIHJ0X3NjaGVkdWxlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc190aW1l
X3Qgbm93LCBib29sX3QgdGFza2xldF93b3JrX3NjaGVkCiB7CiAgICAgY29uc3QgaW50IGNwdSA9
IHNtcF9wcm9jZXNzb3JfaWQoKTsKICAgICBzdHJ1Y3QgcnRfcHJpdmF0ZSAqcHJ2ID0gcnRfcHJp
dihvcHMpOwotICAgIHN0cnVjdCBydF92Y3B1ICpjb25zdCBzY3VyciA9IHJ0X3ZjcHUoY3VycmVu
dCk7Ci0gICAgc3RydWN0IHJ0X3ZjcHUgKnNuZXh0ID0gTlVMTDsKKyAgICBzdHJ1Y3QgcnRfaXRl
bSAqY29uc3Qgc2N1cnIgPSBydF9pdGVtKGN1cnJlbnQtPnNjaGVkX2l0ZW0pOworICAgIHN0cnVj
dCBydF9pdGVtICpzbmV4dCA9IE5VTEw7CiAgICAgc3RydWN0IHRhc2tfc2xpY2UgcmV0ID0geyAu
bWlncmF0ZWQgPSAwIH07CiAKICAgICAvKiBUUkFDRSAqLwpAQCAtMTA5OSwxMyArMTA5OSwxMyBA
QCBydF9zY2hlZHVsZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHNfdGltZV90IG5vdywg
Ym9vbF90IHRhc2tsZXRfd29ya19zY2hlZAogICAgIGlmICggdGFza2xldF93b3JrX3NjaGVkdWxl
ZCApCiAgICAgewogICAgICAgICB0cmFjZV92YXIoVFJDX1JURFNfU0NIRURfVEFTS0xFVCwgMSwg
MCwgIE5VTEwpOwotICAgICAgICBzbmV4dCA9IHJ0X3ZjcHUoaWRsZV92Y3B1W2NwdV0pOworICAg
ICAgICBzbmV4dCA9IHJ0X2l0ZW0oaWRsZV92Y3B1W2NwdV0tPnNjaGVkX2l0ZW0pOwogICAgIH0K
ICAgICBlbHNlCiAgICAgewogICAgICAgICBzbmV4dCA9IHJ1bnFfcGljayhvcHMsIGNwdW1hc2tf
b2YoY3B1KSk7CiAgICAgICAgIGlmICggc25leHQgPT0gTlVMTCApCi0gICAgICAgICAgICBzbmV4
dCA9IHJ0X3ZjcHUoaWRsZV92Y3B1W2NwdV0pOworICAgICAgICAgICAgc25leHQgPSBydF9pdGVt
KGlkbGVfdmNwdVtjcHVdLT5zY2hlZF9pdGVtKTsKIAogICAgICAgICAvKiBpZiBzY3VyciBoYXMg
aGlnaGVyIHByaW9yaXR5IGFuZCBidWRnZXQsIHN0aWxsIHBpY2sgc2N1cnIgKi8KICAgICAgICAg
aWYgKCAhaXNfaWRsZV92Y3B1KGN1cnJlbnQpICYmCkBAIC0xMTUxLDEyICsxMTUxLDEyIEBAIHN0
YXRpYyB2b2lkCiBydF9pdGVtX3NsZWVwKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3Ry
dWN0IHNjaGVkX2l0ZW0gKml0ZW0pCiB7CiAgICAgc3RydWN0IHZjcHUgKnZjID0gaXRlbS0+dmNw
dTsKLSAgICBzdHJ1Y3QgcnRfdmNwdSAqIGNvbnN0IHN2YyA9IHJ0X3ZjcHUodmMpOworICAgIHN0
cnVjdCBydF9pdGVtICogY29uc3Qgc3ZjID0gcnRfaXRlbShpdGVtKTsKIAogICAgIEJVR19PTigg
aXNfaWRsZV92Y3B1KHZjKSApOwogICAgIFNDSEVEX1NUQVRfQ1JBTksodmNwdV9zbGVlcCk7CiAK
LSAgICBpZiAoIGN1cnJfb25fY3B1KHZjLT5wcm9jZXNzb3IpID09IHZjICkKKyAgICBpZiAoIGN1
cnJfb25fY3B1KHZjLT5wcm9jZXNzb3IpID09IGl0ZW0gKQogICAgICAgICBjcHVfcmFpc2Vfc29m
dGlycSh2Yy0+cHJvY2Vzc29yLCBTQ0hFRFVMRV9TT0ZUSVJRKTsKICAgICBlbHNlIGlmICggdmNw
dV9vbl9xKHN2YykgKQogICAgIHsKQEAgLTExODYsMTEgKzExODYsMTEgQEAgcnRfaXRlbV9zbGVl
cChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF9pdGVtICppdGVtKQog
ICogbG9jayBpcyBncmFiYmVkIGJlZm9yZSBjYWxsaW5nIHRoaXMgZnVuY3Rpb24KICAqLwogc3Rh
dGljIHZvaWQKLXJ1bnFfdGlja2xlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0
IHJ0X3ZjcHUgKm5ldykKK3J1bnFfdGlja2xlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywg
c3RydWN0IHJ0X2l0ZW0gKm5ldykKIHsKICAgICBzdHJ1Y3QgcnRfcHJpdmF0ZSAqcHJ2ID0gcnRf
cHJpdihvcHMpOwotICAgIHN0cnVjdCBydF92Y3B1ICpsYXRlc3RfZGVhZGxpbmVfdmNwdSA9IE5V
TEw7IC8qIGxvd2VzdCBwcmlvcml0eSAqLwotICAgIHN0cnVjdCBydF92Y3B1ICppdGVyX3N2YzsK
KyAgICBzdHJ1Y3QgcnRfaXRlbSAqbGF0ZXN0X2RlYWRsaW5lX3ZjcHUgPSBOVUxMOyAvKiBsb3dl
c3QgcHJpb3JpdHkgKi8KKyAgICBzdHJ1Y3QgcnRfaXRlbSAqaXRlcl9zdmM7CiAgICAgc3RydWN0
IHZjcHUgKml0ZXJfdmM7CiAgICAgaW50IGNwdSA9IDAsIGNwdV90b190aWNrbGUgPSAwOwogICAg
IGNwdW1hc2tfdCBub3RfdGlja2xlZDsKQEAgLTEyMTEsMTQgKzEyMTEsMTQgQEAgcnVucV90aWNr
bGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgcnRfdmNwdSAqbmV3KQogICAg
IGNwdSA9IGNwdW1hc2tfdGVzdF9vcl9jeWNsZShuZXctPnZjcHUtPnByb2Nlc3NvciwgJm5vdF90
aWNrbGVkKTsKICAgICB3aGlsZSAoIGNwdSE9IG5yX2NwdV9pZHMgKQogICAgIHsKLSAgICAgICAg
aXRlcl92YyA9IGN1cnJfb25fY3B1KGNwdSk7CisgICAgICAgIGl0ZXJfdmMgPSBjdXJyX29uX2Nw
dShjcHUpLT52Y3B1OwogICAgICAgICBpZiAoIGlzX2lkbGVfdmNwdShpdGVyX3ZjKSApCiAgICAg
ICAgIHsKICAgICAgICAgICAgIFNDSEVEX1NUQVRfQ1JBTksodGlja2xlZF9pZGxlX2NwdSk7CiAg
ICAgICAgICAgICBjcHVfdG9fdGlja2xlID0gY3B1OwogICAgICAgICAgICAgZ290byBvdXQ7CiAg
ICAgICAgIH0KLSAgICAgICAgaXRlcl9zdmMgPSBydF92Y3B1KGl0ZXJfdmMpOworICAgICAgICBp
dGVyX3N2YyA9IHJ0X2l0ZW0oaXRlcl92Yy0+c2NoZWRfaXRlbSk7CiAgICAgICAgIGlmICggbGF0
ZXN0X2RlYWRsaW5lX3ZjcHUgPT0gTlVMTCB8fAogICAgICAgICAgICAgIGNvbXBhcmVfdmNwdV9w
cmlvcml0eShpdGVyX3N2YywgbGF0ZXN0X2RlYWRsaW5lX3ZjcHUpIDwgMCApCiAgICAgICAgICAg
ICBsYXRlc3RfZGVhZGxpbmVfdmNwdSA9IGl0ZXJfc3ZjOwpAQCAtMTI2NywxMyArMTI2NywxMyBA
QCBzdGF0aWMgdm9pZAogcnRfaXRlbV93YWtlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywg
c3RydWN0IHNjaGVkX2l0ZW0gKml0ZW0pCiB7CiAgICAgc3RydWN0IHZjcHUgKnZjID0gaXRlbS0+
dmNwdTsKLSAgICBzdHJ1Y3QgcnRfdmNwdSAqIGNvbnN0IHN2YyA9IHJ0X3ZjcHUodmMpOworICAg
IHN0cnVjdCBydF9pdGVtICogY29uc3Qgc3ZjID0gcnRfaXRlbShpdGVtKTsKICAgICBzX3RpbWVf
dCBub3c7CiAgICAgYm9vbF90IG1pc3NlZDsKIAogICAgIEJVR19PTiggaXNfaWRsZV92Y3B1KHZj
KSApOwogCi0gICAgaWYgKCB1bmxpa2VseShjdXJyX29uX2NwdSh2Yy0+cHJvY2Vzc29yKSA9PSB2
YykgKQorICAgIGlmICggdW5saWtlbHkoY3Vycl9vbl9jcHUodmMtPnByb2Nlc3NvcikgPT0gaXRl
bSkgKQogICAgIHsKICAgICAgICAgU0NIRURfU1RBVF9DUkFOSyh2Y3B1X3dha2VfcnVubmluZyk7
CiAgICAgICAgIHJldHVybjsKQEAgLTEzMzgsNyArMTMzOCw3IEBAIHN0YXRpYyB2b2lkCiBydF9j
b250ZXh0X3NhdmVkKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX2l0
ZW0gKml0ZW0pCiB7CiAgICAgc3RydWN0IHZjcHUgKnZjID0gaXRlbS0+dmNwdTsKLSAgICBzdHJ1
Y3QgcnRfdmNwdSAqc3ZjID0gcnRfdmNwdSh2Yyk7CisgICAgc3RydWN0IHJ0X2l0ZW0gKnN2YyA9
IHJ0X2l0ZW0oaXRlbSk7CiAgICAgc3BpbmxvY2tfdCAqbG9jayA9IHZjcHVfc2NoZWR1bGVfbG9j
a19pcnEodmMpOwogCiAgICAgX19jbGVhcl9iaXQoX19SVERTX3NjaGVkdWxlZCwgJnN2Yy0+Zmxh
Z3MpOwpAQCAtMTM2OSw3ICsxMzY5LDcgQEAgcnRfZG9tX2NudGwoCiAgICAgc3RydWN0IHhlbl9k
b21jdGxfc2NoZWR1bGVyX29wICpvcCkKIHsKICAgICBzdHJ1Y3QgcnRfcHJpdmF0ZSAqcHJ2ID0g
cnRfcHJpdihvcHMpOwotICAgIHN0cnVjdCBydF92Y3B1ICpzdmM7CisgICAgc3RydWN0IHJ0X2l0
ZW0gKnN2YzsKICAgICBzdHJ1Y3QgdmNwdSAqdjsKICAgICB1bnNpZ25lZCBsb25nIGZsYWdzOwog
ICAgIGludCByYyA9IDA7CkBAIC0xMzkzLDcgKzEzOTMsNyBAQCBydF9kb21fY250bCgKICAgICAg
ICAgc3Bpbl9sb2NrX2lycXNhdmUoJnBydi0+bG9jaywgZmxhZ3MpOwogICAgICAgICBmb3JfZWFj
aF92Y3B1ICggZCwgdiApCiAgICAgICAgIHsKLSAgICAgICAgICAgIHN2YyA9IHJ0X3ZjcHUodik7
CisgICAgICAgICAgICBzdmMgPSBydF9pdGVtKHYtPnNjaGVkX2l0ZW0pOwogICAgICAgICAgICAg
c3ZjLT5wZXJpb2QgPSBNSUNST1NFQ1Mob3AtPnUucnRkcy5wZXJpb2QpOyAvKiB0cmFuc2ZlciB0
byBuYW5vc2VjICovCiAgICAgICAgICAgICBzdmMtPmJ1ZGdldCA9IE1JQ1JPU0VDUyhvcC0+dS5y
dGRzLmJ1ZGdldCk7CiAgICAgICAgIH0KQEAgLTE0MTksNyArMTQxOSw3IEBAIHJ0X2RvbV9jbnRs
KAogICAgICAgICAgICAgaWYgKCBvcC0+Y21kID09IFhFTl9ET01DVExfU0NIRURPUF9nZXR2Y3B1
aW5mbyApCiAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgc3Bpbl9sb2NrX2lycXNhdmUo
JnBydi0+bG9jaywgZmxhZ3MpOwotICAgICAgICAgICAgICAgIHN2YyA9IHJ0X3ZjcHUoZC0+dmNw
dVtsb2NhbF9zY2hlZC52Y3B1aWRdKTsKKyAgICAgICAgICAgICAgICBzdmMgPSBydF9pdGVtKGQt
PnZjcHVbbG9jYWxfc2NoZWQudmNwdWlkXS0+c2NoZWRfaXRlbSk7CiAgICAgICAgICAgICAgICAg
bG9jYWxfc2NoZWQudS5ydGRzLmJ1ZGdldCA9IHN2Yy0+YnVkZ2V0IC8gTUlDUk9TRUNTKDEpOwog
ICAgICAgICAgICAgICAgIGxvY2FsX3NjaGVkLnUucnRkcy5wZXJpb2QgPSBzdmMtPnBlcmlvZCAv
IE1JQ1JPU0VDUygxKTsKICAgICAgICAgICAgICAgICBpZiAoIGhhc19leHRyYXRpbWUoc3ZjKSAp
CkBAIC0xNDQ3LDcgKzE0NDcsNyBAQCBydF9kb21fY250bCgKICAgICAgICAgICAgICAgICB9CiAK
ICAgICAgICAgICAgICAgICBzcGluX2xvY2tfaXJxc2F2ZSgmcHJ2LT5sb2NrLCBmbGFncyk7Ci0g
ICAgICAgICAgICAgICAgc3ZjID0gcnRfdmNwdShkLT52Y3B1W2xvY2FsX3NjaGVkLnZjcHVpZF0p
OworICAgICAgICAgICAgICAgIHN2YyA9IHJ0X2l0ZW0oZC0+dmNwdVtsb2NhbF9zY2hlZC52Y3B1
aWRdLT5zY2hlZF9pdGVtKTsKICAgICAgICAgICAgICAgICBzdmMtPnBlcmlvZCA9IHBlcmlvZDsK
ICAgICAgICAgICAgICAgICBzdmMtPmJ1ZGdldCA9IGJ1ZGdldDsKICAgICAgICAgICAgICAgICBp
ZiAoIGxvY2FsX3NjaGVkLnUucnRkcy5mbGFncyAmIFhFTl9ET01DVExfU0NIRURSVF9leHRyYSAp
CkBAIC0xNDgwLDcgKzE0ODAsNyBAQCBzdGF0aWMgdm9pZCByZXBsX3RpbWVyX2hhbmRsZXIodm9p
ZCAqZGF0YSl7CiAgICAgc3RydWN0IGxpc3RfaGVhZCAqcmVwbHEgPSBydF9yZXBscShvcHMpOwog
ICAgIHN0cnVjdCBsaXN0X2hlYWQgKnJ1bnEgPSBydF9ydW5xKG9wcyk7CiAgICAgc3RydWN0IGxp
c3RfaGVhZCAqaXRlciwgKnRtcDsKLSAgICBzdHJ1Y3QgcnRfdmNwdSAqc3ZjOworICAgIHN0cnVj
dCBydF9pdGVtICpzdmM7CiAgICAgTElTVF9IRUFEKHRtcF9yZXBscSk7CiAKICAgICBzcGluX2xv
Y2tfaXJxKCZwcnYtPmxvY2spOwpAQCAtMTUyMiwxMCArMTUyMiwxMCBAQCBzdGF0aWMgdm9pZCBy
ZXBsX3RpbWVyX2hhbmRsZXIodm9pZCAqZGF0YSl7CiAgICAgewogICAgICAgICBzdmMgPSByZXBs
cV9lbGVtKGl0ZXIpOwogCi0gICAgICAgIGlmICggY3Vycl9vbl9jcHUoc3ZjLT52Y3B1LT5wcm9j
ZXNzb3IpID09IHN2Yy0+dmNwdSAmJgorICAgICAgICBpZiAoIGN1cnJfb25fY3B1KHN2Yy0+dmNw
dS0+cHJvY2Vzc29yKSA9PSBzdmMtPnZjcHUtPnNjaGVkX2l0ZW0gJiYKICAgICAgICAgICAgICAh
bGlzdF9lbXB0eShydW5xKSApCiAgICAgICAgIHsKLSAgICAgICAgICAgIHN0cnVjdCBydF92Y3B1
ICpuZXh0X29uX3J1bnEgPSBxX2VsZW0ocnVucS0+bmV4dCk7CisgICAgICAgICAgICBzdHJ1Y3Qg
cnRfaXRlbSAqbmV4dF9vbl9ydW5xID0gcV9lbGVtKHJ1bnEtPm5leHQpOwogCiAgICAgICAgICAg
ICBpZiAoIGNvbXBhcmVfdmNwdV9wcmlvcml0eShzdmMsIG5leHRfb25fcnVucSkgPCAwICkKICAg
ICAgICAgICAgICAgICBydW5xX3RpY2tsZShvcHMsIG5leHRfb25fcnVucSk7CmRpZmYgLS1naXQg
YS94ZW4vY29tbW9uL3NjaGVkdWxlLmMgYi94ZW4vY29tbW9uL3NjaGVkdWxlLmMKaW5kZXggODFl
ZWNhYTY4OS4uYjFlYjc3MjkwYSAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9zY2hlZHVsZS5jCisr
KyBiL3hlbi9jb21tb24vc2NoZWR1bGUuYwpAQCAtMzM0LDcgKzMzNCw3IEBAIGludCBzY2hlZF9p
bml0X3ZjcHUoc3RydWN0IHZjcHUgKnYsIHVuc2lnbmVkIGludCBwcm9jZXNzb3IpCiAgICAgLyog
SWRsZSBWQ1BVcyBhcmUgc2NoZWR1bGVkIGltbWVkaWF0ZWx5LCBzbyBkb24ndCBwdXQgdGhlbSBp
biBydW5xdWV1ZS4gKi8KICAgICBpZiAoIGlzX2lkbGVfZG9tYWluKGQpICkKICAgICB7Ci0gICAg
ICAgIHBlcl9jcHUoc2NoZWR1bGVfZGF0YSwgdi0+cHJvY2Vzc29yKS5jdXJyID0gdjsKKyAgICAg
ICAgcGVyX2NwdShzY2hlZHVsZV9kYXRhLCB2LT5wcm9jZXNzb3IpLmN1cnIgPSBpdGVtOwogICAg
ICAgICB2LT5pc19ydW5uaW5nID0gMTsKICAgICB9CiAgICAgZWxzZQpAQCAtMTUxMyw3ICsxNTEz
LDcgQEAgc3RhdGljIHZvaWQgc2NoZWR1bGUodm9pZCkKIAogICAgIG5leHQgPSBuZXh0X3NsaWNl
LnRhc2s7CiAKLSAgICBzZC0+Y3VyciA9IG5leHQ7CisgICAgc2QtPmN1cnIgPSBuZXh0LT5zY2hl
ZF9pdGVtOwogCiAgICAgaWYgKCBuZXh0X3NsaWNlLnRpbWUgPj0gMCApIC8qIC12ZSBtZWFucyBu
byBsaW1pdCAqLwogICAgICAgICBzZXRfdGltZXIoJnNkLT5zX3RpbWVyLCBub3cgKyBuZXh0X3Ns
aWNlLnRpbWUpOwpAQCAtMTYzNiw3ICsxNjM2LDYgQEAgc3RhdGljIGludCBjcHVfc2NoZWR1bGVf
dXAodW5zaWduZWQgaW50IGNwdSkKICAgICBwZXJfY3B1KHNjaGVkdWxlciwgY3B1KSA9ICZvcHM7
CiAgICAgc3Bpbl9sb2NrX2luaXQoJnNkLT5fbG9jayk7CiAgICAgc2QtPnNjaGVkdWxlX2xvY2sg
PSAmc2QtPl9sb2NrOwotICAgIHNkLT5jdXJyID0gaWRsZV92Y3B1W2NwdV07CiAgICAgaW5pdF90
aW1lcigmc2QtPnNfdGltZXIsIHNfdGltZXJfZm4sIE5VTEwsIGNwdSk7CiAgICAgYXRvbWljX3Nl
dCgmc2QtPnVyZ2VudF9jb3VudCwgMCk7CiAKQEAgLTE2NzAsNiArMTY2OSw4IEBAIHN0YXRpYyBp
bnQgY3B1X3NjaGVkdWxlX3VwKHVuc2lnbmVkIGludCBjcHUpCiAgICAgaWYgKCBpZGxlX3ZjcHVb
Y3B1XSA9PSBOVUxMICkKICAgICAgICAgcmV0dXJuIC1FTk9NRU07CiAKKyAgICBzZC0+Y3VyciA9
IGlkbGVfdmNwdVtjcHVdLT5zY2hlZF9pdGVtOworCiAgICAgLyoKICAgICAgKiBXZSBkb24ndCB3
YW50IHRvIHJpc2sgY2FsbGluZyB4ZnJlZSgpIG9uIGFuIHNkLT5zY2hlZF9wcml2CiAgICAgICog
KGUuZy4sIGluc2lkZSBmcmVlX3BkYXRhLCBmcm9tIGNwdV9zY2hlZHVsZV9kb3duKCkgY2FsbGVk
CkBAIC0xODM5LDYgKzE4NDAsNyBAQCB2b2lkIF9faW5pdCBzY2hlZHVsZXJfaW5pdCh2b2lkKQog
ICAgIGlkbGVfZG9tYWluLT5tYXhfdmNwdXMgPSBucl9jcHVfaWRzOwogICAgIGlmICggdmNwdV9j
cmVhdGUoaWRsZV9kb21haW4sIDAsIDApID09IE5VTEwgKQogICAgICAgICBCVUcoKTsKKyAgICB0
aGlzX2NwdShzY2hlZHVsZV9kYXRhKS5jdXJyID0gaWRsZV92Y3B1WzBdLT5zY2hlZF9pdGVtOwog
ICAgIHRoaXNfY3B1KHNjaGVkdWxlX2RhdGEpLnNjaGVkX3ByaXYgPSBzY2hlZF9hbGxvY19wZGF0
YSgmb3BzLCAwKTsKICAgICBCVUdfT04oSVNfRVJSKHRoaXNfY3B1KHNjaGVkdWxlX2RhdGEpLnNj
aGVkX3ByaXYpKTsKICAgICBzY2hlZF9pbml0X3BkYXRhKCZvcHMsIHRoaXNfY3B1KHNjaGVkdWxl
X2RhdGEpLnNjaGVkX3ByaXYsIDApOwpkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUveGVuL3NjaGVk
LWlmLmggYi94ZW4vaW5jbHVkZS94ZW4vc2NoZWQtaWYuaAppbmRleCBjNTdjZjU4ZTAzLi45YTBj
ZDA0YWY3IDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQtaWYuaAorKysgYi94ZW4v
aW5jbHVkZS94ZW4vc2NoZWQtaWYuaApAQCAtMzYsNyArMzYsNyBAQCBleHRlcm4gaW50IHNjaGVk
X3JhdGVsaW1pdF91czsKIHN0cnVjdCBzY2hlZHVsZV9kYXRhIHsKICAgICBzcGlubG9ja190ICAg
ICAgICAgKnNjaGVkdWxlX2xvY2ssCiAgICAgICAgICAgICAgICAgICAgICAgIF9sb2NrOwotICAg
IHN0cnVjdCB2Y3B1ICAgICAgICAqY3VycjsgICAgICAgICAgIC8qIGN1cnJlbnQgdGFzayAgICAg
ICAgICAgICAgICAgICAgKi8KKyAgICBzdHJ1Y3Qgc2NoZWRfaXRlbSAgKmN1cnI7ICAgICAgICAg
ICAvKiBjdXJyZW50IHRhc2sgICAgICAgICAgICAgICAgICAgICovCiAgICAgdm9pZCAgICAgICAg
ICAgICAgICpzY2hlZF9wcml2OwogICAgIHN0cnVjdCB0aW1lciAgICAgICAgc190aW1lcjsgICAg
ICAgIC8qIHNjaGVkdWxpbmcgdGltZXIgICAgICAgICAgICAgICAgKi8KICAgICBhdG9taWNfdCAg
ICAgICAgICAgIHVyZ2VudF9jb3VudDsgICAvKiBob3cgbWFueSB1cmdlbnQgdmNwdXMgICAgICAg
ICAgICovCi0tIAoyLjE2LjQKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9q
ZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVu
LWRldmVs

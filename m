Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 379D57FED6
	for <lists+xen-devel@lfdr.de>; Fri,  2 Aug 2019 18:43:18 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1htabB-0004KQ-Pc; Fri, 02 Aug 2019 16:40:09 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=/l75=V6=gmail.com=olekstysh@srs-us1.protection.inumbo.net>)
 id 1htabA-0004Ju-Kz
 for xen-devel@lists.xenproject.org; Fri, 02 Aug 2019 16:40:08 +0000
X-Inumbo-ID: 2dde1dea-b544-11e9-8980-bc764e045a96
Received: from mail-lj1-x243.google.com (unknown [2a00:1450:4864:20::243])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 2dde1dea-b544-11e9-8980-bc764e045a96;
 Fri, 02 Aug 2019 16:40:05 +0000 (UTC)
Received: by mail-lj1-x243.google.com with SMTP id i21so73458244ljj.3
 for <xen-devel@lists.xenproject.org>; Fri, 02 Aug 2019 09:40:05 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=7fl86rQ4RYRXOdn3LVY+3kxp1DY9QQ71ET6EMKzn0/I=;
 b=kgzv1VGrDH7bg/Eak3mVmCOT90ECeAmN5mTmWppAvmuwHO7ECHWHE3fvCk9FZI7nIN
 9BAClPCqpxx2U/W546cgaVpy6SlWC52TmFiqBcydROpn6oVkaNhiziB5RIEAANTjwRFT
 QwEwLohfY6oTJeCdh4tMzoL7azdJnpy9BDcYIsCKyE8zg+GD8Ge0Mjgi+OR0XRh41AYz
 fmpUxGiWoho56skRVgnX0fSrj1KQgi8vV47X/Wpg7U+ed/sMpWp2tro1IrYVW4k95HE3
 6/31nKXsIy1GqBDtdMw5/2k/8K/chGCgjAoUNUJnlE3B8jgbJi2iiAxgBXXuqtsmglkf
 ACmA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=7fl86rQ4RYRXOdn3LVY+3kxp1DY9QQ71ET6EMKzn0/I=;
 b=WlsOWTqsb6KeeEWitF60JClABB7gtnycBkoEywau5GnlQnJlGu+YTxsYFyndbu/UhR
 EwC3z1eNCkBI5cqiCixdWdfi/iZKOT0lTDThRQ2bFFNcuY31FRWTVPQpSL0QQdjKMX/U
 UvbVV+xqCW/RdoFoNbzpH+fs8D66b3O1LPv+ruhWRAFjblYKbVlJ9JVGYjW8u5AfXgpS
 5Dwv++ZsWrpSuV10s/pnw8NCcmr/h1nXBzGjhMpTG2kOCngPr317wcnXIIS2WvbUhBN5
 bl7XhDiwM7lDHFQSFgqjrKrrS+ioEXFOXR1PkZFdczjPQo6j8c8etKAPp4e1t+oENVeW
 a0DA==
X-Gm-Message-State: APjAAAVJpB7B7vIPtzd0MeuS6XUYIIVLBfjPIvW7MqY1JEjoBEvegMYA
 p7JevlhuNC5f/Cd0KJUuLDTLgTsMrJc=
X-Google-Smtp-Source: APXvYqz+x8TNfIkP9neZJLqxF3+h/kchuoP9aKjgp21nPS4AAosTkLoOHnEd8Fa23FlOIP9/96wvXQ==
X-Received: by 2002:a2e:9dca:: with SMTP id x10mr70808720ljj.17.1564764003270; 
 Fri, 02 Aug 2019 09:40:03 -0700 (PDT)
Received: from otyshchenko.kyiv.epam.com (ll-22.209.223.85.sovam.net.ua.
 [85.223.209.22])
 by smtp.gmail.com with ESMTPSA id q6sm15378998lji.70.2019.08.02.09.40.02
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-SHA bits=128/128);
 Fri, 02 Aug 2019 09:40:02 -0700 (PDT)
From: Oleksandr Tyshchenko <olekstysh@gmail.com>
To: xen-devel@lists.xenproject.org
Date: Fri,  2 Aug 2019 19:39:45 +0300
Message-Id: <1564763985-20312-7-git-send-email-olekstysh@gmail.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1564763985-20312-1-git-send-email-olekstysh@gmail.com>
References: <1564763985-20312-1-git-send-email-olekstysh@gmail.com>
Subject: [Xen-devel] [PATCH V2 6/6] iommu/arm: Add Renesas IPMMU-VMSA support
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Oleksandr Tyshchenko <oleksandr_tyshchenko@epam.com>, julien.grall@arm.com,
 sstabellini@kernel.org, Yoshihiro Shimoda <yoshihiro.shimoda.uh@renesas.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

RnJvbTogT2xla3NhbmRyIFR5c2hjaGVua28gPG9sZWtzYW5kcl90eXNoY2hlbmtvQGVwYW0uY29t
PgoKVGhlIElQTU1VLVZNU0EgaXMgVk1TQS1jb21wYXRpYmxlIEkvTyBNZW1vcnkgTWFuYWdlbWVu
dCBVbml0IChJT01NVSkKd2hpY2ggcHJvdmlkZXMgYWRkcmVzcyB0cmFuc2xhdGlvbiBhbmQgYWNj
ZXNzIHByb3RlY3Rpb24gZnVuY3Rpb25hbGl0aWVzCnRvIHByb2Nlc3NpbmcgdW5pdHMgYW5kIGlu
dGVyY29ubmVjdCBuZXR3b3Jrcy4KClBsZWFzZSBub3RlLCBjdXJyZW50IGRyaXZlciBpcyBzdXBw
b3NlZCB0byB3b3JrIG9ubHkgd2l0aCBuZXdlc3QKR2VuMyBTb0NzIHJldmlzaW9ucyB3aGljaCBJ
UE1NVSBoYXJkd2FyZSBzdXBwb3J0cyBzdGFnZSAyIHRyYW5zbGF0aW9uCnRhYmxlIGZvcm1hdCBh
bmQgaXMgYWJsZSB0byB1c2UgQ1BVJ3MgUDJNIHRhYmxlIGFzIGlzIGlmIG9uZSBpcwozLWxldmVs
IHBhZ2UgdGFibGUgKHVwIHRvIDQwIGJpdCBJUEEpLgoKVGhlIG1ham9yIGRpZmZlcmVuY2VzIGNv
bXBhcmUgdG8gdGhlIExpbnV4IGRyaXZlciBhcmU6CgoxLiBTdGFnZSAxL1N0YWdlIDIgdHJhbnNs
YXRpb24uIExpbnV4IGRyaXZlciBzdXBwb3J0cyBTdGFnZSAxCnRyYW5zbGF0aW9uIG9ubHkgKHdp
dGggU3RhZ2UgMSB0cmFuc2xhdGlvbiB0YWJsZSBmb3JtYXQpLiBJdCBtYW5hZ2VzCnBhZ2UgdGFi
bGUgYnkgaXRzZWxmLiBCdXQgWGVuIGRyaXZlciBzdXBwb3J0cyBTdGFnZSAyIHRyYW5zbGF0aW9u
Cih3aXRoIFN0YWdlIDIgdHJhbnNsYXRpb24gdGFibGUgZm9ybWF0KSB0byBiZSBhYmxlIHRvIHNo
YXJlIHRoZSBQMk0Kd2l0aCB0aGUgQ1BVLiBTdGFnZSAxIHRyYW5zbGF0aW9uIGlzIGFsd2F5cyBi
eXBhc3NlZCBpbiBYZW4gZHJpdmVyLgoKU28sIFhlbiBkcml2ZXIgaXMgc3VwcG9zZWQgdG8gYmUg
dXNlZCB3aXRoIG5ld2VzdCBHZW4zIFNvQyByZXZpc2lvbnMgb25seQooSDMgRVMzLjAsIE0zIEVT
My4wLCBldGMuKSB3aGljaCBJUE1NVSBIL1cgc3VwcG9ydHMgc3RhZ2UgMiB0cmFuc2xhdGlvbgp0
YWJsZSBmb3JtYXQuCgoyLiBBQXJjaDY0IHN1cHBvcnQuIExpbnV4IGRyaXZlciB1c2VzIFZNU0F2
OC0zMiBtb2RlLCB3aGlsZSBYZW4gZHJpdmVyCmVuYWJsZXMgQXJtdjggVk1TQXY4LTY0IG1vZGUg
dG8gY292ZXIgdXAgdG8gNDAgYml0IGlucHV0IGFkZHJlc3MuCgozLiBDb250ZXh0IGJhbmsgKHNl
dHMgb2YgcGFnZSB0YWJsZSkgdXNhZ2UuIEluIFhlbiwgZWFjaCBjb250ZXh0IGJhbmsgaXMKbWFw
cGVkIHRvIG9uZSBYZW4gZG9tYWluLiBTbywgYWxsIGRldmljZXMgYmVpbmcgcGFzcyB0aHJvdWdo
ZWQgdG8gdGhlCnNhbWUgWGVuIGRvbWFpbiBzaGFyZSB0aGUgc2FtZSBjb250ZXh0IGJhbmsuCgpT
aWduZWQtb2ZmLWJ5OiBPbGVrc2FuZHIgVHlzaGNoZW5rbyA8b2xla3NhbmRyX3R5c2hjaGVua29A
ZXBhbS5jb20+CkNDOiBKdWxpZW4gR3JhbGwgPGp1bGllbi5ncmFsbEBhcm0uY29tPgpDQzogWW9z
aGloaXJvIFNoaW1vZGEgPHlvc2hpaGlyby5zaGltb2RhLnVoQHJlbmVzYXMuY29tPgoKLS0tCkNo
YW5nZXMgVjEgLT4gVjI6CiAgICAtIHJld3JpdGVkIGRyaXZlciB0byB1c2UgaW9tbXVfZndzcGVj
CiAgICAtIHJlbW92ZWQgRFQgcGFyc2luZyBjb2RlIGZvciBtaWNyby1UTEJzCiAgICAtIHJlbW92
ZWQgc3RydWN0IGlwbW11X3Ztc2FfbWFzdGVyX2NmZywgZGV2X2FyY2hkYXRhIG1hY3JvCiAgICAt
IGFkZGVkIGlwbW11X2ZpbmRfbW11X2J5X2RldigpLCB2YXJpb3VzIGhlbHBlcnMgdG8gYWNjZXNz
CiAgICAgIGZ3c3BlYy0+aW9tbXVfcHJpdgogICAgLSBpbXBsZW1lbnRlZCBuZXcgY2FsbGJhY2sg
ImFkZF9kZXZpY2UiIHRvIGFkZCBtYXN0ZXIgZGV2aWNlIHRvIElQTU1VCiAgICAtIHJlbW92ZWQg
aXBtbXVfcHJvdGVjdF9tYXN0ZXJzKCkKICAgIC0gcmVtb3ZlZCBjb2RlIHRvIGxvY2F0ZSBSb290
IGRldmljZSBpbiB0aGUgZmlyc3QgcGxhY2UsCiAgICAgIHVzZWQgRUFHQUlOIHRvIHJlcXVlc3Qg
ZGVmZXJyZWQgcHJvYmluZwogICAgLSB1c2VkIHByaW50a19vbmNlIGZvciB0aGUgc3lzdGVtIHdp
ZGUgZXJyb3IgbWVzc2FnZXMgaW4gaXBtbXVfaW5pdCgpCiAgICAgIHdoaWNoIGRvbid0IG5lZWQg
dG8gYmUgc2hvd24gZm9yIGV2ZXJ5IGRldmljZSBiZWluZyBwcm9iZWQKICAgIC0gcmVtb3ZlZCBt
YXBfcGFnZS91bm1hcF9wYWdlIGltcGxlbWVudGF0aW9uLCByZXVzZWQgdGhlbQogICAgICBmcm9t
IGlvbW11X2hlbHBlcnMuYwogICAgLSB1c2VkICVwZCBmb3IgcHJpbnRpbmcgZG9tYWlkIGlkCiAg
ICAtIHBlcmZvcm1lZCB2YXJpb3VzIGNvc21ldGljIGZpeGVzCiAgICAtIGNoYW5nZWQgdTMyIC0+
IHVpbnQzMl90LCB1NjQgLT4gdWludDY0X3QsCiAgICAgIHVuc2lnbmVkIGludCAtPiB1aW50MzJf
dCB3aGVyZSBuZWVkZWQKICAgIC0gY2xhcmlmaWVkIFRPRE9zCiAgICAtIGNsYWZpcmllZCBzdXBw
b3J0ZWQgU29DIHZlcnNpb25zIGluIGNvbmZpZyBJUE1NVV9WTVNBLAogICAgICBzZXQgZGVmYXVs
dCB0byAibiIKICAgIC0gdXBkYXRlZCBjb21tZW50cyBpbiBjb2RlLCBwcm92aWRlZCBtb3JlIGFj
Y3VyYXRlIGRlc2NyaXB0aW9uLAogICAgICBhZGRlZCBuZXcgY29tbWVudHMgd2hlcmUgbmVlZGVk
CiAgICAtIHVwZGF0ZWQgcGF0Y2ggZGVzY3JpcHRpb24gYnkgcHJvdmlkaW5nIGRpZmZlcmVuY2Vz
IGJldHdlZW4KICAgICAgTGludXgvWGVuIGltcGxlbWVudGF0aW9ucwogICAgLSByZW1vdmVkIGZp
ZWxkcyBmb3IgY2FjaGUgc25vb3AgdHJhbnNhY3Rpb24gd2hlbiBjb25maWd1cmluZyBJTVRUQkNS
CiAgICAgICh1cGRhdGUgZnJvbSBSZW5lc2FzIEJTUCkKLS0tCiB4ZW4vYXJjaC9hcm0vcGxhdGZv
cm1zL0tjb25maWcgICAgICAgICAgIHwgICAgMSArCiB4ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9L
Y29uZmlnICAgICAgICAgIHwgICAxMyArCiB4ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hcm0vTWFr
ZWZpbGUgICAgIHwgICAgMSArCiB4ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hcm0vaXBtbXUtdm1z
YS5jIHwgMTM0MiArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKIDQgZmlsZXMgY2hhbmdl
ZCwgMTM1NyBpbnNlcnRpb25zKCspCiBjcmVhdGUgbW9kZSAxMDA2NDQgeGVuL2RyaXZlcnMvcGFz
c3Rocm91Z2gvYXJtL2lwbW11LXZtc2EuYwoKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL2FybS9wbGF0
Zm9ybXMvS2NvbmZpZyBiL3hlbi9hcmNoL2FybS9wbGF0Zm9ybXMvS2NvbmZpZwppbmRleCBiYzBl
OWNkLi5jOTNhNmIyIDEwMDY0NAotLS0gYS94ZW4vYXJjaC9hcm0vcGxhdGZvcm1zL0tjb25maWcK
KysrIGIveGVuL2FyY2gvYXJtL3BsYXRmb3Jtcy9LY29uZmlnCkBAIC0yNSw2ICsyNSw3IEBAIGNv
bmZpZyBSQ0FSMwogCWJvb2wgIlJlbmVzYXMgUkNhcjMgc3VwcG9ydCIKIAlkZXBlbmRzIG9uIEFS
TV82NAogCXNlbGVjdCBIQVNfU0NJRgorCXNlbGVjdCBJUE1NVV9WTVNBCiAJLS0taGVscC0tLQog
CUVuYWJsZSBhbGwgdGhlIHJlcXVpcmVkIGRyaXZlcnMgZm9yIFJlbmVzYXMgUkNhcjMKIApkaWZm
IC0tZ2l0IGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvS2NvbmZpZyBiL3hlbi9kcml2ZXJzL3Bh
c3N0aHJvdWdoL0tjb25maWcKaW5kZXggYTNjMDY0OS4uM2RhZWUxNiAxMDA2NDQKLS0tIGEveGVu
L2RyaXZlcnMvcGFzc3Rocm91Z2gvS2NvbmZpZworKysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3Vn
aC9LY29uZmlnCkBAIC0xMiw0ICsxMiwxNyBAQCBjb25maWcgQVJNX1NNTVUKIAogCSAgU2F5IFkg
aGVyZSBpZiB5b3VyIFNvQyBpbmNsdWRlcyBhbiBJT01NVSBkZXZpY2UgaW1wbGVtZW50aW5nIHRo
ZQogCSAgQVJNIFNNTVUgYXJjaGl0ZWN0dXJlLgorCitjb25maWcgSVBNTVVfVk1TQQorCWJvb2wg
IlJlbmVzYXMgSVBNTVUtVk1TQSBmb3VuZCBpbiBSLUNhciBHZW4zIFNvQ3MiCisJZGVmYXVsdCBu
CisJZGVwZW5kcyBvbiBBUk1fNjQKKwktLS1oZWxwLS0tCisJICBTdXBwb3J0IGZvciBpbXBsZW1l
bnRhdGlvbnMgb2YgdGhlIFJlbmVzYXMgSVBNTVUtVk1TQSBmb3VuZAorCSAgaW4gUi1DYXIgR2Vu
MyBTb0NzLgorCisJICBTYXkgWSBoZXJlIGlmIHlvdSBhcmUgdXNpbmcgbmV3ZXN0IFItQ2FyIEdl
bjMgU29DcyByZXZpc2lvbnMKKwkgIChIMyBFUzMuMCwgTTMgRVMzLjAsIGV0Yykgd2hpY2ggSVBN
TVUgaGFyZHdhcmUgc3VwcG9ydHMgc3RhZ2UgMgorCSAgdHJhbnNsYXRpb24gdGFibGUgZm9ybWF0
IGFuZCBpcyBhYmxlIHRvIHVzZSBDUFUncyBQMk0gdGFibGUgYXMgaXMuCisKIGVuZGlmCmRpZmYg
LS1naXQgYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hcm0vTWFrZWZpbGUgYi94ZW4vZHJpdmVy
cy9wYXNzdGhyb3VnaC9hcm0vTWFrZWZpbGUKaW5kZXggNWZiYWQ0NS4uZmNkOTE4ZSAxMDA2NDQK
LS0tIGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYXJtL01ha2VmaWxlCisrKyBiL3hlbi9kcml2
ZXJzL3Bhc3N0aHJvdWdoL2FybS9NYWtlZmlsZQpAQCAtMSwyICsxLDMgQEAKIG9iai15ICs9IGlv
bW11Lm8gaW9tbXVfaGVscGVycy5vIGlvbW11X2Z3c3BlYy5vCiBvYmotJChDT05GSUdfQVJNX1NN
TVUpICs9IHNtbXUubworb2JqLSQoQ09ORklHX0lQTU1VX1ZNU0EpICs9IGlwbW11LXZtc2Eubwpk
aWZmIC0tZ2l0IGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYXJtL2lwbW11LXZtc2EuYyBiL3hl
bi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FybS9pcG1tdS12bXNhLmMKbmV3IGZpbGUgbW9kZSAxMDA2
NDQKaW5kZXggMDAwMDAwMC4uYTM0YThmOAotLS0gL2Rldi9udWxsCisrKyBiL3hlbi9kcml2ZXJz
L3Bhc3N0aHJvdWdoL2FybS9pcG1tdS12bXNhLmMKQEAgLTAsMCArMSwxMzQyIEBACisvKgorICog
eGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYXJtL2lwbW11LXZtc2EuYworICoKKyAqIERyaXZlciBm
b3IgdGhlIFJlbmVzYXMgSVBNTVUtVk1TQSBmb3VuZCBpbiBSLUNhciBHZW4zIFNvQ3MuCisgKgor
ICogVGhlIElQTU1VLVZNU0EgaXMgVk1TQS1jb21wYXRpYmxlIEkvTyBNZW1vcnkgTWFuYWdlbWVu
dCBVbml0IChJT01NVSkKKyAqIHdoaWNoIHByb3ZpZGVzIGFkZHJlc3MgdHJhbnNsYXRpb24gYW5k
IGFjY2VzcyBwcm90ZWN0aW9uIGZ1bmN0aW9uYWxpdGllcworICogdG8gcHJvY2Vzc2luZyB1bml0
cyBhbmQgaW50ZXJjb25uZWN0IG5ldHdvcmtzLgorICoKKyAqIFBsZWFzZSBub3RlLCBjdXJyZW50
IGRyaXZlciBpcyBzdXBwb3NlZCB0byB3b3JrIG9ubHkgd2l0aCBuZXdlc3QgR2VuMyBTb0NzCisg
KiByZXZpc2lvbnMgd2hpY2ggSVBNTVUgaGFyZHdhcmUgc3VwcG9ydHMgc3RhZ2UgMiB0cmFuc2xh
dGlvbiB0YWJsZSBmb3JtYXQgYW5kCisgKiBpcyBhYmxlIHRvIHVzZSBDUFUncyBQMk0gdGFibGUg
YXMgaXMuCisgKgorICogQmFzZWQgb24gTGludXgncyBJUE1NVS1WTVNBIGRyaXZlciBmcm9tIFJl
bmVzYXMgQlNQOgorICogICAgZHJpdmVycy9pb21tdS9pcG1tdS12bXNhLmMKKyAqIHlvdSBjYW4g
Zm91bmQgYXQ6CisgKiAgICB1cmw6IGdpdDovL2dpdC5rZXJuZWwub3JnL3B1Yi9zY20vbGludXgv
a2VybmVsL2dpdC9ob3Jtcy9yZW5lc2FzLWJzcC5naXQKKyAqICAgIGJyYW5jaDogdjQuMTQuNzUt
bHRzaS9yY2FyLTMuOS42CisgKiAgICBjb21taXQ6IGUyMDZlYjViODFhNjBlNjRjMzVmYmMzYTk5
OWIxYTBkYjJiOTgwNDQKKyAqIGFuZCBYZW4ncyBTTU1VIGRyaXZlcjoKKyAqICAgIHhlbi9kcml2
ZXJzL3Bhc3N0aHJvdWdoL2FybS9zbW11LmMKKyAqCisgKiBDb3B5cmlnaHQgKEMpIDIwMTYtMjAx
OSBFUEFNIFN5c3RlbXMgSW5jLgorICoKKyAqIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJl
OyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IKKyAqIG1vZGlmeSBpdCB1bmRlciB0aGUg
dGVybXMgYW5kIGNvbmRpdGlvbnMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYworICogTGljZW5z
ZSwgdmVyc2lvbiAyLCBhcyBwdWJsaXNoZWQgYnkgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlv
bi4KKyAqCisgKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBp
dCB3aWxsIGJlIHVzZWZ1bCwKKyAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBl
dmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCisgKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVT
UyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlIEdOVQorICogR2VuZXJhbCBQdWJs
aWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgorICoKKyAqIFlvdSBzaG91bGQgaGF2ZSByZWNl
aXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYworICogTGljZW5zZSBhbG9uZyB3
aXRoIHRoaXMgcHJvZ3JhbTsgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNl
cy8+LgorICovCisKKyNpbmNsdWRlIDx4ZW4vZGVsYXkuaD4KKyNpbmNsdWRlIDx4ZW4vZXJyLmg+
CisjaW5jbHVkZSA8eGVuL2lycS5oPgorI2luY2x1ZGUgPHhlbi9saWIuaD4KKyNpbmNsdWRlIDx4
ZW4vbGlzdC5oPgorI2luY2x1ZGUgPHhlbi9tbS5oPgorI2luY2x1ZGUgPHhlbi9zY2hlZC5oPgor
I2luY2x1ZGUgPHhlbi92bWFwLmg+CisjaW5jbHVkZSA8YXNtL2F0b21pYy5oPgorI2luY2x1ZGUg
PGFzbS9kZXZpY2UuaD4KKyNpbmNsdWRlIDxhc20vaW8uaD4KKworI2RlZmluZSBkZXZfbmFtZShk
ZXYpIGR0X25vZGVfZnVsbF9uYW1lKGRldl90b19kdChkZXYpKQorCisvKiBEZXZpY2UgbG9nZ2Vy
IGZ1bmN0aW9ucyAqLworI2RlZmluZSBkZXZfcHJpbnQoZGV2LCBsdmwsIGZtdCwgLi4uKSAgICBc
CisgICAgcHJpbnRrKGx2bCAiaXBtbXU6ICVzOiAiIGZtdCwgZGV2X25hbWUoZGV2KSwgIyMgX19W
QV9BUkdTX18pCisKKyNkZWZpbmUgZGV2X2luZm8oZGV2LCBmbXQsIC4uLikgICAgXAorICAgIGRl
dl9wcmludChkZXYsIFhFTkxPR19JTkZPLCBmbXQsICMjIF9fVkFfQVJHU19fKQorI2RlZmluZSBk
ZXZfd2FybihkZXYsIGZtdCwgLi4uKSAgICBcCisgICAgZGV2X3ByaW50KGRldiwgWEVOTE9HX1dB
Uk5JTkcsIGZtdCwgIyMgX19WQV9BUkdTX18pCisjZGVmaW5lIGRldl9lcnIoZGV2LCBmbXQsIC4u
LikgICAgIFwKKyAgICBkZXZfcHJpbnQoZGV2LCBYRU5MT0dfRVJSLCBmbXQsICMjIF9fVkFfQVJH
U19fKQorI2RlZmluZSBkZXZfZXJyX3JhdGVsaW1pdGVkKGRldiwgZm10LCAuLi4pICAgIFwKKyAg
ICBkZXZfcHJpbnQoZGV2LCBYRU5MT0dfRVJSLCBmbXQsICMjIF9fVkFfQVJHU19fKQorCisvKgor
ICogR2VuMyBTb0NzIG1ha2UgdXNlIG9mIHVwIHRvIDggSVBNTVUgY29udGV4dHMgKHNldHMgb2Yg
cGFnZSB0YWJsZSkgYW5kCisgKiB0aGVzZSBjYW4gYmUgbWFuYWdlZCBpbmRlcGVuZGVudGx5LiBF
YWNoIGNvbnRleHQgaXMgbWFwcGVkIHRvIG9uZSBYZW4gZG9tYWluLgorICovCisjZGVmaW5lIElQ
TU1VX0NUWF9NQVggICAgIDgKKy8qIEdlbjMgU29DcyBtYWtlIHVzZSBvZiB1cCB0byA0OCBtaWNy
by1UTEJzIHBlciBJUE1NVSBkZXZpY2UuICovCisjZGVmaW5lIElQTU1VX1VUTEJfTUFYICAgIDQ4
CisKKy8qIElQTU1VIGNvbnRleHQgc3VwcG9ydHMgSVBBIHNpemUgdXAgdG8gNDAgYml0LiAqLwor
I2RlZmluZSBJUE1NVV9NQVhfUDJNX0lQQV9CSVRTICAgIDQwCisKKy8qCisgKiBYZW4ncyBkb21h
aW4gSVBNTVUgaW5mb3JtYXRpb24gc3RvcmVkIGluIGRvbV9pb21tdShkKS0+YXJjaC5wcml2Cisg
KgorICogQXMgZWFjaCBjb250ZXh0IChzZXQgb2YgcGFnZSB0YWJsZSkgaXMgbWFwcGVkIHRvIG9u
ZSBYZW4gZG9tYWluLAorICogYWxsIGFzc29jaWF0ZWQgSVBNTVUgZG9tYWlucyB1c2UgdGhlIHNh
bWUgY29udGV4dCBtYXBwZWQgdG8gdGhpcyBYZW4gZG9tYWluLgorICogVGhpcyBtYWtlcyBhbGwg
bWFzdGVyIGRldmljZXMgYmVpbmcgYXR0YWNoZWQgdG8gdGhlIHNhbWUgWGVuIGRvbWFpbiBzaGFy
ZQorICogdGhlIHNhbWUgY29udGV4dCAoUDJNIHRhYmxlKS4KKyAqLworc3RydWN0IGlwbW11X3Zt
c2FfeGVuX2RvbWFpbiB7CisgICAgLyoKKyAgICAgKiBVc2VkIHRvIHByb3RlY3QgZXZlcnl0aGlu
ZyB3aGljaCBiZWxvbmdzIHRvIHRoaXMgWGVuIGRvbWFpbjoKKyAgICAgKiBkZXZpY2UgYXNzaWdu
bWVudCwgZG9tYWluIGluaXQvZGVzdHJveSwgZmx1c2ggb3BzLCBldGMKKyAgICAgKi8KKyAgICBz
cGlubG9ja190IGxvY2s7CisgICAgLyogT25lIG9yIG1vcmUgQ2FjaGUgSVBNTVUgZG9tYWlucyBh
c3NvY2lhdGVkIHdpdGggdGhpcyBYZW4gZG9tYWluICovCisgICAgc3RydWN0IGxpc3RfaGVhZCBj
YWNoZV9kb21haW5zOworICAgIC8qIFJvb3QgSVBNTVUgZG9tYWluIGFzc29jaWF0ZWQgd2l0aCB0
aGlzIFhlbiBkb21haW4gKi8KKyAgICBzdHJ1Y3QgaXBtbXVfdm1zYV9kb21haW4gKnJvb3RfZG9t
YWluOworfTsKKworLyogWGVuIG1hc3RlciBkZXZpY2UncyBJUE1NVSBpbmZvcm1hdGlvbiBzdG9y
ZWQgaW4gZndzcGVjLT5pb21tdV9wcml2ICovCitzdHJ1Y3QgaXBtbXVfdm1zYV94ZW5fZGV2aWNl
IHsKKyAgICAvKiBDYWNoZSBJUE1NVSBkb21haW4gdGhpcyBtYXN0ZXIgZGV2aWNlIGlzIGxvZ2lj
YWxseSBhdHRhY2hlZCB0byAqLworICAgIHN0cnVjdCBpcG1tdV92bXNhX2RvbWFpbiAqZG9tYWlu
OworICAgIC8qIENhY2hlIElQTU1VIHRoaXMgbWFzdGVyIGRldmljZSBpcyBwaHlzaWNhbGx5IGNv
bm5lY3RlZCB0byAqLworICAgIHN0cnVjdCBpcG1tdV92bXNhX2RldmljZSAqbW11OworfTsKKwor
LyogUm9vdC9DYWNoZSBJUE1NVSBkZXZpY2UncyBpbmZvcm1hdGlvbiAqLworc3RydWN0IGlwbW11
X3Ztc2FfZGV2aWNlIHsKKyAgICBzdHJ1Y3QgZGV2aWNlICpkZXY7CisgICAgdm9pZCBfX2lvbWVt
ICpiYXNlOworICAgIHN0cnVjdCBpcG1tdV92bXNhX2RldmljZSAqcm9vdDsKKyAgICBzdHJ1Y3Qg
bGlzdF9oZWFkIGxpc3Q7CisgICAgdW5zaWduZWQgaW50IG51bV91dGxiczsKKyAgICB1bnNpZ25l
ZCBpbnQgbnVtX2N0eDsKKyAgICBzcGlubG9ja190IGxvY2s7ICAgIC8qIFByb3RlY3RzIGN0eCBh
bmQgZG9tYWluc1tdICovCisgICAgREVDTEFSRV9CSVRNQVAoY3R4LCBJUE1NVV9DVFhfTUFYKTsK
KyAgICBzdHJ1Y3QgaXBtbXVfdm1zYV9kb21haW4gKmRvbWFpbnNbSVBNTVVfQ1RYX01BWF07Cit9
OworCisvKgorICogUm9vdC9DYWNoZSBJUE1NVSBkb21haW4ncyBpbmZvcm1hdGlvbgorICoKKyAq
IFJvb3QgSVBNTVUgZGV2aWNlIGlzIGFzc2lnbmVkIHRvIFJvb3QgSVBNTVUgZG9tYWluIHdoaWxl
IENhY2hlIElQTU1VIGRldmljZQorICogaXMgYXNzaWduZWQgdG8gQ2FjaGUgSVBNTVUgZG9tYWlu
LiBNYXN0ZXIgZGV2aWNlcyBhcmUgY29ubmVjdGVkIHRvIENhY2hlCisgKiBJUE1NVSBkZXZpY2Vz
IHRocm91Z2ggc3BlY2lmaWMgcG9ydHMgY2FsbGVkIG1pY3JvLVRMQnMuCisgKiBBbGwgQ2FjaGUg
SVBNTVUgZGV2aWNlcywgaW4gdHVybiwgYXJlIGNvbm5lY3RlZCB0byBSb290IElQTU1VIGRldmlj
ZQorICogd2hpY2ggbWFuYWdlcyBJUE1NVSBjb250ZXh0LgorICovCitzdHJ1Y3QgaXBtbXVfdm1z
YV9kb21haW4geworICAgIC8qCisgICAgICogSVBNTVUgZGV2aWNlIGFzc2lnbmVkIHRvIHRoaXMg
SVBNTVUgZG9tYWluLgorICAgICAqIEVpdGhlciBSb290IGRldmljZSB3aGljaCBpcyBsb2NhdGVk
IGF0IHRoZSBtYWluIG1lbW9yeSBidXMgZG9tYWluIG9yCisgICAgICogQ2FjaGUgZGV2aWNlIHdo
aWNoIGlzIGxvY2F0ZWQgYXQgZWFjaCBoaWVyYXJjaHkgYnVzIGRvbWFpbi4KKyAgICAgKi8KKyAg
ICBzdHJ1Y3QgaXBtbXVfdm1zYV9kZXZpY2UgKm1tdTsKKworICAgIC8qIENvbnRleHQgdXNlZCBm
b3IgdGhpcyBJUE1NVSBkb21haW4gKi8KKyAgICB1bnNpZ25lZCBpbnQgY29udGV4dF9pZDsKKwor
ICAgIC8qIFhlbiBkb21haW4gYXNzb2NpYXRlZCB3aXRoIHRoaXMgSVBNTVUgZG9tYWluICovCisg
ICAgc3RydWN0IGRvbWFpbiAqZDsKKworICAgIC8qIFRoZSBmaWVsZHMgYmVsb3cgYXJlIHVzZWQg
Zm9yIENhY2hlIElQTU1VIGRvbWFpbiBvbmx5ICovCisKKyAgICAvKgorICAgICAqIFVzZWQgdG8g
a2VlcCB0cmFjayBvZiB0aGUgbWFzdGVyIGRldmljZXMgd2hpY2ggYXJlIGF0dGFjaGVkIHRvIHRo
aXMKKyAgICAgKiBJUE1NVSBkb21haW4gKGRvbWFpbiB1c2VycykuIE1hc3RlciBkZXZpY2VzIGJl
aGluZCB0aGUgc2FtZSBJUE1NVSBkZXZpY2UKKyAgICAgKiBhcmUgZ3JvdXBlZCB0b2dldGhlciBi
eSBwdXR0aW5nIGludG8gdGhlIHNhbWUgSVBNTVUgZG9tYWluLgorICAgICAqIE9ubHkgd2hlbiB0
aGUgcmVmY291bnQgcmVhY2hlcyAwIHRoaXMgSVBNTVUgZG9tYWluIGNhbiBiZSBkZXN0cm95ZWQu
CisgICAgICovCisgICAgdW5zaWduZWQgaW50IHJlZmNvdW50OworICAgIC8qIFVzZWQgdG8gbGlu
ayB0aGlzIElQTU1VIGRvbWFpbiBmb3IgdGhlIHNhbWUgWGVuIGRvbWFpbiAqLworICAgIHN0cnVj
dCBsaXN0X2hlYWQgbGlzdDsKK307CisKKy8qIFVzZWQgdG8ga2VlcCB0cmFjayBvZiByZWdpc3Rl
cmVkIElQTU1VIGRldmljZXMgKi8KK3N0YXRpYyBMSVNUX0hFQUQoaXBtbXVfZGV2aWNlcyk7Citz
dGF0aWMgREVGSU5FX1NQSU5MT0NLKGlwbW11X2RldmljZXNfbG9jayk7CisKKyNkZWZpbmUgVExC
X0xPT1BfVElNRU9VVCAgICAxMDAgLyogMTAwdXMgKi8KKworLyogUmVnaXN0ZXJzIERlZmluaXRp
b24gKi8KKyNkZWZpbmUgSU1fQ1RYX1NJWkUgICAgMHg0MAorCisjZGVmaW5lIElNQ1RSICAgICAg
ICAgICAgICAgIDB4MDAwMAorLyoKKyAqIFRoZXNlIGZpZWxkcyBhcmUgaW1wbGVtZW50ZWQgaW4g
SVBNTVUtTU0gb25seS4gU28sIGNhbiBiZSBzZXQgZm9yCisgKiBSb290IElQTU1VIG9ubHkuCisg
Ki8KKyNkZWZpbmUgSU1DVFJfVkE2NCAgICAgICAgICAgKDEgPDwgMjkpCisjZGVmaW5lIElNQ1RS
X1RSRSAgICAgICAgICAgICgxIDw8IDE3KQorI2RlZmluZSBJTUNUUl9BRkUgICAgICAgICAgICAo
MSA8PCAxNikKKyNkZWZpbmUgSU1DVFJfUlRTRUxfTUFTSyAgICAgKDMgPDwgNCkKKyNkZWZpbmUg
SU1DVFJfUlRTRUxfU0hJRlQgICAgNAorI2RlZmluZSBJTUNUUl9UUkVOICAgICAgICAgICAoMSA8
PCAzKQorLyoKKyAqIFRoZXNlIGZpZWxkcyBhcmUgY29tbW9uIGZvciBhbGwgSVBNTVUgZGV2aWNl
cy4gU28sIGNhbiBiZSBzZXQgZm9yCisgKiBDYWNoZSBJUE1NVXMgYXMgd2VsbC4KKyAqLworI2Rl
ZmluZSBJTUNUUl9JTlRFTiAgICAgICAgICAoMSA8PCAyKQorI2RlZmluZSBJTUNUUl9GTFVTSCAg
ICAgICAgICAoMSA8PCAxKQorI2RlZmluZSBJTUNUUl9NTVVFTiAgICAgICAgICAoMSA8PCAwKQor
I2RlZmluZSBJTUNUUl9DT01NT05fTUFTSyAgICAoNyA8PCAwKQorCisjZGVmaW5lIElNQ0FBUiAg
ICAgICAgICAgICAgIDB4MDAwNAorCisjZGVmaW5lIElNVFRCQ1IgICAgICAgICAgICAgICAgICAg
ICAgICAweDAwMDgKKyNkZWZpbmUgSU1UVEJDUl9FQUUgICAgICAgICAgICAgICAgICAgICgxIDw8
IDMxKQorI2RlZmluZSBJTVRUQkNSX1BNQiAgICAgICAgICAgICAgICAgICAgKDEgPDwgMzApCisj
ZGVmaW5lIElNVFRCQ1JfU0gxX05PTl9TSEFSRUFCTEUgICAgICAoMCA8PCAyOCkKKyNkZWZpbmUg
SU1UVEJDUl9TSDFfT1VURVJfU0hBUkVBQkxFICAgICgyIDw8IDI4KQorI2RlZmluZSBJTVRUQkNS
X1NIMV9JTk5FUl9TSEFSRUFCTEUgICAgKDMgPDwgMjgpCisjZGVmaW5lIElNVFRCQ1JfU0gxX01B
U0sgICAgICAgICAgICAgICAoMyA8PCAyOCkKKyNkZWZpbmUgSU1UVEJDUl9PUkdOMV9OQyAgICAg
ICAgICAgICAgICgwIDw8IDI2KQorI2RlZmluZSBJTVRUQkNSX09SR04xX1dCX1dBICAgICAgICAg
ICAgKDEgPDwgMjYpCisjZGVmaW5lIElNVFRCQ1JfT1JHTjFfV1QgICAgICAgICAgICAgICAoMiA8
PCAyNikKKyNkZWZpbmUgSU1UVEJDUl9PUkdOMV9XQiAgICAgICAgICAgICAgICgzIDw8IDI2KQor
I2RlZmluZSBJTVRUQkNSX09SR04xX01BU0sgICAgICAgICAgICAgKDMgPDwgMjYpCisjZGVmaW5l
IElNVFRCQ1JfSVJHTjFfTkMgICAgICAgICAgICAgICAoMCA8PCAyNCkKKyNkZWZpbmUgSU1UVEJD
Ul9JUkdOMV9XQl9XQSAgICAgICAgICAgICgxIDw8IDI0KQorI2RlZmluZSBJTVRUQkNSX0lSR04x
X1dUICAgICAgICAgICAgICAgKDIgPDwgMjQpCisjZGVmaW5lIElNVFRCQ1JfSVJHTjFfV0IgICAg
ICAgICAgICAgICAoMyA8PCAyNCkKKyNkZWZpbmUgSU1UVEJDUl9JUkdOMV9NQVNLICAgICAgICAg
ICAgICgzIDw8IDI0KQorI2RlZmluZSBJTVRUQkNSX1RTWjFfTUFTSyAgICAgICAgICAgICAgKDFm
IDw8IDE2KQorI2RlZmluZSBJTVRUQkNSX1RTWjFfU0hJRlQgICAgICAgICAgICAgMTYKKyNkZWZp
bmUgSU1UVEJDUl9TSDBfTk9OX1NIQVJFQUJMRSAgICAgICgwIDw8IDEyKQorI2RlZmluZSBJTVRU
QkNSX1NIMF9PVVRFUl9TSEFSRUFCTEUgICAgKDIgPDwgMTIpCisjZGVmaW5lIElNVFRCQ1JfU0gw
X0lOTkVSX1NIQVJFQUJMRSAgICAoMyA8PCAxMikKKyNkZWZpbmUgSU1UVEJDUl9TSDBfTUFTSyAg
ICAgICAgICAgICAgICgzIDw8IDEyKQorI2RlZmluZSBJTVRUQkNSX09SR04wX05DICAgICAgICAg
ICAgICAgKDAgPDwgMTApCisjZGVmaW5lIElNVFRCQ1JfT1JHTjBfV0JfV0EgICAgICAgICAgICAo
MSA8PCAxMCkKKyNkZWZpbmUgSU1UVEJDUl9PUkdOMF9XVCAgICAgICAgICAgICAgICgyIDw8IDEw
KQorI2RlZmluZSBJTVRUQkNSX09SR04wX1dCICAgICAgICAgICAgICAgKDMgPDwgMTApCisjZGVm
aW5lIElNVFRCQ1JfT1JHTjBfTUFTSyAgICAgICAgICAgICAoMyA8PCAxMCkKKyNkZWZpbmUgSU1U
VEJDUl9JUkdOMF9OQyAgICAgICAgICAgICAgICgwIDw8IDgpCisjZGVmaW5lIElNVFRCQ1JfSVJH
TjBfV0JfV0EgICAgICAgICAgICAoMSA8PCA4KQorI2RlZmluZSBJTVRUQkNSX0lSR04wX1dUICAg
ICAgICAgICAgICAgKDIgPDwgOCkKKyNkZWZpbmUgSU1UVEJDUl9JUkdOMF9XQiAgICAgICAgICAg
ICAgICgzIDw8IDgpCisjZGVmaW5lIElNVFRCQ1JfSVJHTjBfTUFTSyAgICAgICAgICAgICAoMyA8
PCA4KQorI2RlZmluZSBJTVRUQkNSX1NMMF9MVkxfMiAgICAgICAgICAgICAgKDAgPDwgNikKKyNk
ZWZpbmUgSU1UVEJDUl9TTDBfTFZMXzEgICAgICAgICAgICAgICgxIDw8IDYpCisjZGVmaW5lIElN
VFRCQ1JfVFNaMF9NQVNLICAgICAgICAgICAgICAoMHgxZiA8PCAwKQorI2RlZmluZSBJTVRUQkNS
X1RTWjBfU0hJRlQgICAgICAgICAgICAgMAorCisjZGVmaW5lIElNVFRMQlIwICAgICAgICAgICAg
ICAweDAwMTAKKyNkZWZpbmUgSU1UVExCUjBfVFRCUl9NQVNLICAgICgweGZmZmZmIDw8IDEyKQor
I2RlZmluZSBJTVRUVUJSMCAgICAgICAgICAgICAgMHgwMDE0CisjZGVmaW5lIElNVFRVQlIwX1RU
QlJfTUFTSyAgICAoMHhmZiA8PCAwKQorI2RlZmluZSBJTVRUTEJSMSAgICAgICAgICAgICAgMHgw
MDE4CisjZGVmaW5lIElNVFRMQlIxX1RUQlJfTUFTSyAgICAoMHhmZmZmZiA8PCAxMikKKyNkZWZp
bmUgSU1UVFVCUjEgICAgICAgICAgICAgIDB4MDAxYworI2RlZmluZSBJTVRUVUJSMV9UVEJSX01B
U0sgICAgKDB4ZmYgPDwgMCkKKworI2RlZmluZSBJTVNUUiAgICAgICAgICAgICAgICAgICAgICAg
ICAgMHgwMDIwCisjZGVmaW5lIElNU1RSX0VSUkxWTF9NQVNLICAgICAgICAgICAgICAoMyA8PCAx
MikKKyNkZWZpbmUgSU1TVFJfRVJSTFZMX1NISUZUICAgICAgICAgICAgIDEyCisjZGVmaW5lIElN
U1RSX0VSUkNPREVfVExCX0ZPUk1BVCAgICAgICAoMSA8PCA4KQorI2RlZmluZSBJTVNUUl9FUlJD
T0RFX0FDQ0VTU19QRVJNICAgICAgKDQgPDwgOCkKKyNkZWZpbmUgSU1TVFJfRVJSQ09ERV9TRUNV
UkVfQUNDRVNTICAgICg1IDw8IDgpCisjZGVmaW5lIElNU1RSX0VSUkNPREVfTUFTSyAgICAgICAg
ICAgICAoNyA8PCA4KQorI2RlZmluZSBJTVNUUl9NSElUICAgICAgICAgICAgICAgICAgICAgKDEg
PDwgNCkKKyNkZWZpbmUgSU1TVFJfQUJPUlQgICAgICAgICAgICAgICAgICAgICgxIDw8IDIpCisj
ZGVmaW5lIElNU1RSX1BGICAgICAgICAgICAgICAgICAgICAgICAoMSA8PCAxKQorI2RlZmluZSBJ
TVNUUl9URiAgICAgICAgICAgICAgICAgICAgICAgKDEgPDwgMCkKKworI2RlZmluZSBJTUVMQVIg
ICAgMHgwMDMwCisjZGVmaW5lIElNRVVBUiAgICAweDAwMzQKKworI2RlZmluZSBJTVVDVFIobikg
ICAgICAgICAgICAgICgobikgPCAzMiA/IElNVUNUUjAobikgOiBJTVVDVFIzMihuKSkKKyNkZWZp
bmUgSU1VQ1RSMChuKSAgICAgICAgICAgICAoMHgwMzAwICsgKChuKSAqIDE2KSkKKyNkZWZpbmUg
SU1VQ1RSMzIobikgICAgICAgICAgICAoMHgwNjAwICsgKCgobikgLSAzMikgKiAxNikpCisjZGVm
aW5lIElNVUNUUl9GSVhBRERFTiAgICAgICAgKDEgPDwgMzEpCisjZGVmaW5lIElNVUNUUl9GSVhB
RERfTUFTSyAgICAgKDB4ZmYgPDwgMTYpCisjZGVmaW5lIElNVUNUUl9GSVhBRERfU0hJRlQgICAg
MTYKKyNkZWZpbmUgSU1VQ1RSX1RUU0VMX01NVShuKSAgICAoKG4pIDw8IDQpCisjZGVmaW5lIElN
VUNUUl9UVFNFTF9QTUIgICAgICAgKDggPDwgNCkKKyNkZWZpbmUgSU1VQ1RSX1RUU0VMX01BU0sg
ICAgICAoMTUgPDwgNCkKKyNkZWZpbmUgSU1VQ1RSX0ZMVVNIICAgICAgICAgICAoMSA8PCAxKQor
I2RlZmluZSBJTVVDVFJfTU1VRU4gICAgICAgICAgICgxIDw8IDApCisKKyNkZWZpbmUgSU1VQVNJ
RChuKSAgICAgICAgICAgICAoKG4pIDwgMzIgPyBJTVVBU0lEMChuKSA6IElNVUFTSUQzMihuKSkK
KyNkZWZpbmUgSU1VQVNJRDAobikgICAgICAgICAgICAoMHgwMzA4ICsgKChuKSAqIDE2KSkKKyNk
ZWZpbmUgSU1VQVNJRDMyKG4pICAgICAgICAgICAoMHgwNjA4ICsgKCgobikgLSAzMikgKiAxNikp
CisjZGVmaW5lIElNVUFTSURfQVNJRDhfTUFTSyAgICAgKDB4ZmYgPDwgOCkKKyNkZWZpbmUgSU1V
QVNJRF9BU0lEOF9TSElGVCAgICA4CisjZGVmaW5lIElNVUFTSURfQVNJRDBfTUFTSyAgICAgKDB4
ZmYgPDwgMCkKKyNkZWZpbmUgSU1VQVNJRF9BU0lEMF9TSElGVCAgICAwCisKKyNkZWZpbmUgSU1T
QVVYQ1RMUiAgICAgICAgICAweDA1MDQKKyNkZWZpbmUgSU1TQVVYQ1RMUl9TMlBURSAgICAoMSA8
PCAzKQorCitzdGF0aWMgc3RydWN0IGlwbW11X3Ztc2FfZGV2aWNlICp0b19pcG1tdShzdHJ1Y3Qg
ZGV2aWNlICpkZXYpCit7CisgICAgc3RydWN0IGlvbW11X2Z3c3BlYyAqZndzcGVjID0gZGV2X2lv
bW11X2Z3c3BlY19nZXQoZGV2KTsKKworICAgIHJldHVybiBmd3NwZWMgJiYgZndzcGVjLT5pb21t
dV9wcml2ID8KKyAgICAgICAgKChzdHJ1Y3QgaXBtbXVfdm1zYV94ZW5fZGV2aWNlICopZndzcGVj
LT5pb21tdV9wcml2KS0+bW11IDogTlVMTDsKK30KKworc3RhdGljIHZvaWQgc2V0X2lwbW11KHN0
cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IGlwbW11X3Ztc2FfZGV2aWNlICptbXUpCit7CisgICAg
c3RydWN0IGlvbW11X2Z3c3BlYyAqZndzcGVjID0gZGV2X2lvbW11X2Z3c3BlY19nZXQoZGV2KTsK
KworICAgICgoc3RydWN0IGlwbW11X3Ztc2FfeGVuX2RldmljZSAqKWZ3c3BlYy0+aW9tbXVfcHJp
diktPm1tdSA9IG1tdTsKK30KKworc3RhdGljIHN0cnVjdCBpcG1tdV92bXNhX2RvbWFpbiAqdG9f
ZG9tYWluKHN0cnVjdCBkZXZpY2UgKmRldikKK3sKKyAgICBzdHJ1Y3QgaW9tbXVfZndzcGVjICpm
d3NwZWMgPSBkZXZfaW9tbXVfZndzcGVjX2dldChkZXYpOworCisgICAgcmV0dXJuIGZ3c3BlYyAm
JiBmd3NwZWMtPmlvbW11X3ByaXYgPworICAgICAgICAoKHN0cnVjdCBpcG1tdV92bXNhX3hlbl9k
ZXZpY2UgKilmd3NwZWMtPmlvbW11X3ByaXYpLT5kb21haW4gOiBOVUxMOworfQorCitzdGF0aWMg
dm9pZCBzZXRfZG9tYWluKHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IGlwbW11X3Ztc2FfZG9t
YWluICpkb21haW4pCit7CisgICAgc3RydWN0IGlvbW11X2Z3c3BlYyAqZndzcGVjID0gZGV2X2lv
bW11X2Z3c3BlY19nZXQoZGV2KTsKKworICAgICgoc3RydWN0IGlwbW11X3Ztc2FfeGVuX2Rldmlj
ZSAqKWZ3c3BlYy0+aW9tbXVfcHJpdiktPmRvbWFpbiA9IGRvbWFpbjsKK30KKworc3RhdGljIHN0
cnVjdCBpcG1tdV92bXNhX2RldmljZSAqaXBtbXVfZmluZF9tbXVfYnlfZGV2KHN0cnVjdCBkZXZp
Y2UgKmRldikKK3sKKyAgICBzdHJ1Y3QgaXBtbXVfdm1zYV9kZXZpY2UgKm1tdSA9IE5VTEw7Cisg
ICAgYm9vbCBmb3VuZCA9IGZhbHNlOworCisgICAgc3Bpbl9sb2NrKCZpcG1tdV9kZXZpY2VzX2xv
Y2spOworCisgICAgbGlzdF9mb3JfZWFjaF9lbnRyeSAoIG1tdSwgJmlwbW11X2RldmljZXMsIGxp
c3QgKQorICAgIHsKKyAgICAgICAgaWYgKCBtbXUtPmRldiA9PSBkZXYgKQorICAgICAgICB7Cisg
ICAgICAgICAgICBmb3VuZCA9IHRydWU7CisgICAgICAgICAgICBicmVhazsKKyAgICAgICAgfQor
ICAgIH0KKworICAgIHNwaW5fdW5sb2NrKCZpcG1tdV9kZXZpY2VzX2xvY2spOworCisgICAgcmV0
dXJuIGZvdW5kID8gbW11IDogTlVMTDsKK30KKworLyogUm9vdCBkZXZpY2UgaGFuZGxpbmcgKi8K
K3N0YXRpYyBib29sIGlwbW11X2lzX3Jvb3Qoc3RydWN0IGlwbW11X3Ztc2FfZGV2aWNlICptbXUp
Cit7CisgICAgcmV0dXJuIG1tdS0+cm9vdCA9PSBtbXU7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgaXBt
bXVfdm1zYV9kZXZpY2UgKmlwbW11X2ZpbmRfcm9vdCh2b2lkKQoreworICAgIHN0cnVjdCBpcG1t
dV92bXNhX2RldmljZSAqbW11ID0gTlVMTDsKKyAgICBib29sIGZvdW5kID0gZmFsc2U7CisKKyAg
ICBzcGluX2xvY2soJmlwbW11X2RldmljZXNfbG9jayk7CisKKyAgICBsaXN0X2Zvcl9lYWNoX2Vu
dHJ5KCBtbXUsICZpcG1tdV9kZXZpY2VzLCBsaXN0ICkKKyAgICB7CisgICAgICAgIGlmICggaXBt
bXVfaXNfcm9vdChtbXUpICkKKyAgICAgICAgeworICAgICAgICAgICAgZm91bmQgPSB0cnVlOwor
ICAgICAgICAgICAgYnJlYWs7CisgICAgICAgIH0KKyAgICB9CisKKyAgICBzcGluX3VubG9jaygm
aXBtbXVfZGV2aWNlc19sb2NrKTsKKworICAgIHJldHVybiBmb3VuZCA/IG1tdSA6IE5VTEw7Cit9
CisKKy8qIFJlYWQvV3JpdGUgQWNjZXNzICovCitzdGF0aWMgdWludDMyX3QgaXBtbXVfcmVhZChz
dHJ1Y3QgaXBtbXVfdm1zYV9kZXZpY2UgKm1tdSwgdWludDMyX3Qgb2Zmc2V0KQoreworICAgIHJl
dHVybiByZWFkbChtbXUtPmJhc2UgKyBvZmZzZXQpOworfQorCitzdGF0aWMgdm9pZCBpcG1tdV93
cml0ZShzdHJ1Y3QgaXBtbXVfdm1zYV9kZXZpY2UgKm1tdSwgdWludDMyX3Qgb2Zmc2V0LAorICAg
ICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgZGF0YSkKK3sKKyAgICB3cml0ZWwoZGF0YSwg
bW11LT5iYXNlICsgb2Zmc2V0KTsKK30KKworc3RhdGljIHVpbnQzMl90IGlwbW11X2N0eF9yZWFk
X3Jvb3Qoc3RydWN0IGlwbW11X3Ztc2FfZG9tYWluICpkb21haW4sCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCByZWcpCit7CisgICAgcmV0dXJuIGlwbW11X3Jl
YWQoZG9tYWluLT5tbXUtPnJvb3QsCisgICAgICAgICAgICAgICAgICAgICAgZG9tYWluLT5jb250
ZXh0X2lkICogSU1fQ1RYX1NJWkUgKyByZWcpOworfQorCitzdGF0aWMgdm9pZCBpcG1tdV9jdHhf
d3JpdGVfcm9vdChzdHJ1Y3QgaXBtbXVfdm1zYV9kb21haW4gKmRvbWFpbiwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90IHJlZywgdWludDMyX3QgZGF0YSkKK3sKKyAg
ICBpcG1tdV93cml0ZShkb21haW4tPm1tdS0+cm9vdCwKKyAgICAgICAgICAgICAgICBkb21haW4t
PmNvbnRleHRfaWQgKiBJTV9DVFhfU0laRSArIHJlZywgZGF0YSk7Cit9CisKK3N0YXRpYyB2b2lk
IGlwbW11X2N0eF93cml0ZV9jYWNoZShzdHJ1Y3QgaXBtbXVfdm1zYV9kb21haW4gKmRvbWFpbiwK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCByZWcsIHVpbnQzMl90
IGRhdGEpCit7CisgICAgLyogV2UgZXhwZWN0IG9ubHkgSU1DVFIgdmFsdWUgdG8gYmUgcGFzc2Vk
IGFzIGEgcmVnLiAqLworICAgIEFTU0VSVChyZWcgPT0gSU1DVFIpOworCisgICAgLyogTWFzayBm
aWVsZHMgd2hpY2ggYXJlIGltcGxlbWVudGVkIGluIElQTU1VLU1NIG9ubHkuICovCisgICAgaWYg
KCAhaXBtbXVfaXNfcm9vdChkb21haW4tPm1tdSkgKQorICAgICAgICBpcG1tdV93cml0ZShkb21h
aW4tPm1tdSwgZG9tYWluLT5jb250ZXh0X2lkICogSU1fQ1RYX1NJWkUgKyByZWcsCisgICAgICAg
ICAgICAgICAgICAgIGRhdGEgJiBJTUNUUl9DT01NT05fTUFTSyk7Cit9CisKKy8qCisgKiBXcml0
ZSB0aGUgY29udGV4dCB0byBib3RoIFJvb3QgSVBNTVUgYW5kIGFsbCBDYWNoZSBJUE1NVXMgYXNz
aWduZWQKKyAqIHRvIHRoaXMgWGVuIGRvbWFpbi4KKyAqLworc3RhdGljIHZvaWQgaXBtbXVfY3R4
X3dyaXRlX2FsbChzdHJ1Y3QgaXBtbXVfdm1zYV9kb21haW4gKmRvbWFpbiwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgcmVnLCB1aW50MzJfdCBkYXRhKQoreworICAg
IHN0cnVjdCBpcG1tdV92bXNhX3hlbl9kb21haW4gKnhlbl9kb21haW4gPSBkb21faW9tbXUoZG9t
YWluLT5kKS0+YXJjaC5wcml2OworICAgIHN0cnVjdCBpcG1tdV92bXNhX2RvbWFpbiAqY2FjaGVf
ZG9tYWluOworCisgICAgbGlzdF9mb3JfZWFjaF9lbnRyeSggY2FjaGVfZG9tYWluLCAmeGVuX2Rv
bWFpbi0+Y2FjaGVfZG9tYWlucywgbGlzdCApCisgICAgICAgIGlwbW11X2N0eF93cml0ZV9jYWNo
ZShjYWNoZV9kb21haW4sIHJlZywgZGF0YSk7CisKKyAgICBpcG1tdV9jdHhfd3JpdGVfcm9vdChk
b21haW4sIHJlZywgZGF0YSk7Cit9CisKKy8qIFRMQiBhbmQgbWljcm8tVExCIE1hbmFnZW1lbnQg
Ki8KKworLyogV2FpdCBmb3IgYW55IHBlbmRpbmcgVExCIGludmFsaWRhdGlvbnMgdG8gY29tcGxl
dGUuICovCitzdGF0aWMgdm9pZCBpcG1tdV90bGJfc3luYyhzdHJ1Y3QgaXBtbXVfdm1zYV9kb21h
aW4gKmRvbWFpbikKK3sKKyAgICB1bnNpZ25lZCBpbnQgY291bnQgPSAwOworCisgICAgd2hpbGUg
KCBpcG1tdV9jdHhfcmVhZF9yb290KGRvbWFpbiwgSU1DVFIpICYgSU1DVFJfRkxVU0ggKQorICAg
IHsKKyAgICAgICAgY3B1X3JlbGF4KCk7CisgICAgICAgIGlmICggKytjb3VudCA9PSBUTEJfTE9P
UF9USU1FT1VUICkKKyAgICAgICAgeworICAgICAgICAgICAgZGV2X2Vycl9yYXRlbGltaXRlZChk
b21haW4tPm1tdS0+ZGV2LCAiVExCIHN5bmMgdGltZWQgb3V0IC0tIE1NVSBtYXkgYmUgZGVhZGxv
Y2tlZFxuIik7CisgICAgICAgICAgICByZXR1cm47CisgICAgICAgIH0KKyAgICAgICAgdWRlbGF5
KDEpOworICAgIH0KK30KKworc3RhdGljIHZvaWQgaXBtbXVfdGxiX2ludmFsaWRhdGUoc3RydWN0
IGlwbW11X3Ztc2FfZG9tYWluICpkb21haW4pCit7CisgICAgdWludDMyX3QgZGF0YTsKKworICAg
IGRhdGEgPSBpcG1tdV9jdHhfcmVhZF9yb290KGRvbWFpbiwgSU1DVFIpOworICAgIGRhdGEgfD0g
SU1DVFJfRkxVU0g7CisgICAgaXBtbXVfY3R4X3dyaXRlX2FsbChkb21haW4sIElNQ1RSLCBkYXRh
KTsKKworICAgIGlwbW11X3RsYl9zeW5jKGRvbWFpbik7Cit9CisKKy8qIEVuYWJsZSBNTVUgdHJh
bnNsYXRpb24gZm9yIHRoZSBtaWNyby1UTEIuICovCitzdGF0aWMgdm9pZCBpcG1tdV91dGxiX2Vu
YWJsZShzdHJ1Y3QgaXBtbXVfdm1zYV9kb21haW4gKmRvbWFpbiwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHVuc2lnbmVkIGludCB1dGxiKQoreworICAgIHN0cnVjdCBpcG1tdV92bXNh
X2RldmljZSAqbW11ID0gZG9tYWluLT5tbXU7CisKKyAgICAvKgorICAgICAqIFRPRE86IFJlZmVy
ZW5jZS1jb3VudCB0aGUgbWljcm8tVExCIGFzIHNldmVyYWwgYnVzIG1hc3RlcnMgY2FuIGJlCisg
ICAgICogY29ubmVjdGVkIHRvIHRoZSBzYW1lIG1pY3JvLVRMQi4gUHJldmVudCB0aGUgdXNlIGNh
c2VzIHdoZXJlCisgICAgICogdGhlIHNhbWUgbWljcm8tVExCIGNvdWxkIGJlIHNoYXJlZCBiZXR3
ZWVuIG11bHRpcGxlIFhlbiBkb21haW5zLgorICAgICAqLworICAgIGlwbW11X3dyaXRlKG1tdSwg
SU1VQVNJRCh1dGxiKSwgMCk7CisgICAgaXBtbXVfd3JpdGUobW11LCBJTVVDVFIodXRsYiksIGlw
bW11X3JlYWQobW11LCBJTVVDVFIodXRsYikpIHwKKyAgICAgICAgICAgICAgICBJTVVDVFJfVFRT
RUxfTU1VKGRvbWFpbi0+Y29udGV4dF9pZCkgfCBJTVVDVFJfTU1VRU4pOworfQorCisvKiBEaXNh
YmxlIE1NVSB0cmFuc2xhdGlvbiBmb3IgdGhlIG1pY3JvLVRMQi4gKi8KK3N0YXRpYyB2b2lkIGlw
bW11X3V0bGJfZGlzYWJsZShzdHJ1Y3QgaXBtbXVfdm1zYV9kb21haW4gKmRvbWFpbiwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgdXRsYikKK3sKKyAgICBzdHJ1
Y3QgaXBtbXVfdm1zYV9kZXZpY2UgKm1tdSA9IGRvbWFpbi0+bW11OworCisgICAgaXBtbXVfd3Jp
dGUobW11LCBJTVVDVFIodXRsYiksIDApOworfQorCisvKiBEb21haW4vQ29udGV4dCBNYW5hZ2Vt
ZW50ICovCitzdGF0aWMgaW50IGlwbW11X2RvbWFpbl9hbGxvY2F0ZV9jb250ZXh0KHN0cnVjdCBp
cG1tdV92bXNhX2RldmljZSAqbW11LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBzdHJ1Y3QgaXBtbXVfdm1zYV9kb21haW4gKmRvbWFpbikKK3sKKyAgICB1bnNpZ25l
ZCBsb25nIGZsYWdzOworICAgIGludCByZXQ7CisKKyAgICBzcGluX2xvY2tfaXJxc2F2ZSgmbW11
LT5sb2NrLCBmbGFncyk7CisKKyAgICByZXQgPSBmaW5kX2ZpcnN0X3plcm9fYml0KG1tdS0+Y3R4
LCBtbXUtPm51bV9jdHgpOworICAgIGlmICggcmV0ICE9IG1tdS0+bnVtX2N0eCApCisgICAgewor
ICAgICAgICBtbXUtPmRvbWFpbnNbcmV0XSA9IGRvbWFpbjsKKyAgICAgICAgc2V0X2JpdChyZXQs
IG1tdS0+Y3R4KTsKKyAgICB9CisgICAgZWxzZQorICAgICAgICByZXQgPSAtRUJVU1k7CisKKyAg
ICBzcGluX3VubG9ja19pcnFyZXN0b3JlKCZtbXUtPmxvY2ssIGZsYWdzKTsKKworICAgIHJldHVy
biByZXQ7Cit9CisKK3N0YXRpYyB2b2lkIGlwbW11X2RvbWFpbl9mcmVlX2NvbnRleHQoc3RydWN0
IGlwbW11X3Ztc2FfZGV2aWNlICptbXUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHVuc2lnbmVkIGludCBjb250ZXh0X2lkKQoreworICAgIHVuc2lnbmVkIGxvbmcgZmxh
Z3M7CisKKyAgICBzcGluX2xvY2tfaXJxc2F2ZSgmbW11LT5sb2NrLCBmbGFncyk7CisKKyAgICBj
bGVhcl9iaXQoY29udGV4dF9pZCwgbW11LT5jdHgpOworICAgIG1tdS0+ZG9tYWluc1tjb250ZXh0
X2lkXSA9IE5VTEw7CisKKyAgICBzcGluX3VubG9ja19pcnFyZXN0b3JlKCZtbXUtPmxvY2ssIGZs
YWdzKTsKK30KKworc3RhdGljIGludCBpcG1tdV9kb21haW5faW5pdF9jb250ZXh0KHN0cnVjdCBp
cG1tdV92bXNhX2RvbWFpbiAqZG9tYWluKQoreworICAgIHVpbnQ2NF90IHR0YnI7CisgICAgdWlu
dDMyX3QgdHN6MDsKKyAgICBpbnQgcmV0OworCisgICAgLyogRmluZCBhbiB1bnVzZWQgY29udGV4
dC4gKi8KKyAgICByZXQgPSBpcG1tdV9kb21haW5fYWxsb2NhdGVfY29udGV4dChkb21haW4tPm1t
dS0+cm9vdCwgZG9tYWluKTsKKyAgICBpZiAoIHJldCA8IDAgKQorICAgICAgICByZXR1cm4gcmV0
OworCisgICAgZG9tYWluLT5jb250ZXh0X2lkID0gcmV0OworCisgICAgLyoKKyAgICAgKiBUVEJS
MAorICAgICAqIFVzZSBQMk0gdGFibGUgZm9yIHRoaXMgWGVuIGRvbWFpbi4KKyAgICAgKi8KKyAg
ICBBU1NFUlQoZG9tYWluLT5kICE9IE5VTEwpOworICAgIHR0YnIgPSBwYWdlX3RvX21hZGRyKGRv
bWFpbi0+ZC0+YXJjaC5wMm0ucm9vdCk7CisKKyAgICBkZXZfaW5mbyhkb21haW4tPm1tdS0+cm9v
dC0+ZGV2LCAiJXBkOiBTZXQgSVBNTVUgY29udGV4dCAldSAocGdkIDB4JSJQUkl4NjQiKVxuIiwK
KyAgICAgICAgICAgICBkb21haW4tPmQsIGRvbWFpbi0+Y29udGV4dF9pZCwgdHRicik7CisKKyAg
ICBpcG1tdV9jdHhfd3JpdGVfcm9vdChkb21haW4sIElNVFRMQlIwLCB0dGJyICYgSU1UVExCUjBf
VFRCUl9NQVNLKTsKKyAgICBpcG1tdV9jdHhfd3JpdGVfcm9vdChkb21haW4sIElNVFRVQlIwLCAo
dHRiciA+PiAzMikgJiBJTVRUVUJSMF9UVEJSX01BU0spOworCisgICAgLyoKKyAgICAgKiBUVEJD
UgorICAgICAqIFdlIHVzZSBsb25nIGRlc2NyaXB0b3JzIGFuZCBhbGxvY2F0ZSB0aGUgd2hvbGUg
InAybV9pcGFfYml0cyIgSVBBIHNwYWNlCisgICAgICogdG8gVFRCUjAuIFVzZSA0S0IgcGFnZSBn
cmFudWxlLiBTdGFydCBwYWdlIHRhYmxlIHdhbGtzIGF0IGZpcnN0IGxldmVsLgorICAgICAqIEFs
d2F5cyBieXBhc3Mgc3RhZ2UgMSB0cmFuc2xhdGlvbi4KKyAgICAgKi8KKyAgICB0c3owID0gKDY0
IC0gcDJtX2lwYV9iaXRzKSA8PCBJTVRUQkNSX1RTWjBfU0hJRlQ7CisgICAgaXBtbXVfY3R4X3dy
aXRlX3Jvb3QoZG9tYWluLCBJTVRUQkNSLCBJTVRUQkNSX0VBRSB8IElNVFRCQ1JfUE1CIHwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICBJTVRUQkNSX1NMMF9MVkxfMSB8IHRzejApOworCisgICAg
LyoKKyAgICAgKiBJTVNUUgorICAgICAqIENsZWFyIGFsbCBpbnRlcnJ1cHQgZmxhZ3MuCisgICAg
ICovCisgICAgaXBtbXVfY3R4X3dyaXRlX3Jvb3QoZG9tYWluLCBJTVNUUiwgaXBtbXVfY3R4X3Jl
YWRfcm9vdChkb21haW4sIElNU1RSKSk7CisKKyAgICAvKgorICAgICAqIElNQ1RSCisgICAgICog
RW5hYmxlIHRoZSBNTVUgYW5kIGludGVycnVwdCBnZW5lcmF0aW9uLiBUaGUgbG9uZy1kZXNjcmlw
dG9yCisgICAgICogdHJhbnNsYXRpb24gdGFibGUgZm9ybWF0IGRvZXNuJ3QgdXNlIFRFWCByZW1h
cHBpbmcuIERvbid0IGVuYWJsZSBBRgorICAgICAqIHNvZnR3YXJlIG1hbmFnZW1lbnQgYXMgd2Ug
aGF2ZSBubyB1c2UgZm9yIGl0LiBVc2UgVk1TQXY4LTY0IG1vZGUuCisgICAgICogRW5hYmxlIHRo
ZSBjb250ZXh0IGZvciBSb290IElQTU1VIG9ubHkuIEZsdXNoIHRoZSBUTEIgYXMgcmVxdWlyZWQK
KyAgICAgKiB3aGVuIG1vZGlmeWluZyB0aGUgY29udGV4dCByZWdpc3RlcnMuCisgICAgICovCisg
ICAgaXBtbXVfY3R4X3dyaXRlX3Jvb3QoZG9tYWluLCBJTUNUUiwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICBJTUNUUl9WQTY0IHwgSU1DVFJfSU5URU4gfCBJTUNUUl9GTFVTSCB8IElNQ1RSX01N
VUVOKTsKKworICAgIHJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCBpcG1tdV9kb21haW5fZGVz
dHJveV9jb250ZXh0KHN0cnVjdCBpcG1tdV92bXNhX2RvbWFpbiAqZG9tYWluKQoreworICAgIGlm
ICggIWRvbWFpbi0+bW11ICkKKyAgICAgICAgcmV0dXJuOworCisgICAgLyoKKyAgICAgKiBEaXNh
YmxlIHRoZSBjb250ZXh0IGZvciBSb290IElQTU1VIG9ubHkuIEZsdXNoIHRoZSBUTEIgYXMgcmVx
dWlyZWQKKyAgICAgKiB3aGVuIG1vZGlmeWluZyB0aGUgY29udGV4dCByZWdpc3RlcnMuCisgICAg
ICovCisgICAgaXBtbXVfY3R4X3dyaXRlX3Jvb3QoZG9tYWluLCBJTUNUUiwgSU1DVFJfRkxVU0gp
OworICAgIGlwbW11X3RsYl9zeW5jKGRvbWFpbik7CisKKyAgICBpcG1tdV9kb21haW5fZnJlZV9j
b250ZXh0KGRvbWFpbi0+bW11LT5yb290LCBkb21haW4tPmNvbnRleHRfaWQpOworfQorCisvKiBG
YXVsdCBIYW5kbGluZyAqLworc3RhdGljIHZvaWQgaXBtbXVfZG9tYWluX2lycShzdHJ1Y3QgaXBt
bXVfdm1zYV9kb21haW4gKmRvbWFpbikKK3sKKyAgICBjb25zdCB1aW50MzJfdCBlcnJfbWFzayA9
IElNU1RSX01ISVQgfCBJTVNUUl9BQk9SVCB8IElNU1RSX1BGIHwgSU1TVFJfVEY7CisgICAgc3Ry
dWN0IGlwbW11X3Ztc2FfZGV2aWNlICptbXUgPSBkb21haW4tPm1tdTsKKyAgICB1aW50MzJfdCBz
dGF0dXM7CisgICAgdWludDY0X3QgaW92YTsKKworICAgIHN0YXR1cyA9IGlwbW11X2N0eF9yZWFk
X3Jvb3QoZG9tYWluLCBJTVNUUik7CisgICAgaWYgKCAhKHN0YXR1cyAmIGVycl9tYXNrKSApCisg
ICAgICAgIHJldHVybjsKKworICAgIGlvdmEgPSBpcG1tdV9jdHhfcmVhZF9yb290KGRvbWFpbiwg
SU1FTEFSKSB8CisgICAgICAgICgodWludDY0X3QpaXBtbXVfY3R4X3JlYWRfcm9vdChkb21haW4s
IElNRVVBUikgPDwgMzIpOworCisgICAgLyoKKyAgICAgKiBDbGVhciB0aGUgZXJyb3Igc3RhdHVz
IGZsYWdzLiBVbmxpa2UgdHJhZGl0aW9uYWwgaW50ZXJydXB0IGZsYWcKKyAgICAgKiByZWdpc3Rl
cnMgdGhhdCBtdXN0IGJlIGNsZWFyZWQgYnkgd3JpdGluZyAxLCB0aGlzIHN0YXR1cyByZWdpc3Rl
cgorICAgICAqIHNlZW1zIHRvIHJlcXVpcmUgMC4gVGhlIGVycm9yIGFkZHJlc3MgcmVnaXN0ZXIg
bXVzdCBiZSByZWFkIGJlZm9yZSwKKyAgICAgKiBvdGhlcndpc2UgaXRzIHZhbHVlIHdpbGwgYmUg
MC4KKyAgICAgKi8KKyAgICBpcG1tdV9jdHhfd3JpdGVfcm9vdChkb21haW4sIElNU1RSLCAwKTsK
KworICAgIC8qIExvZyBmYXRhbCBlcnJvcnMuICovCisgICAgaWYgKCBzdGF0dXMgJiBJTVNUUl9N
SElUICkKKyAgICAgICAgZGV2X2Vycl9yYXRlbGltaXRlZChtbXUtPmRldiwgIiVwZDogTXVsdGlw
bGUgVExCIGhpdHMgQDB4JSJQUkl4NjQiXG4iLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGRvbWFpbi0+ZCwgaW92YSk7CisgICAgaWYgKCBzdGF0dXMgJiBJTVNUUl9BQk9SVCApCisgICAg
ICAgIGRldl9lcnJfcmF0ZWxpbWl0ZWQobW11LT5kZXYsICIlcGQ6IFBhZ2UgVGFibGUgV2FsayBB
Ym9ydCBAMHglIlBSSXg2NCJcbiIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9tYWlu
LT5kLCBpb3ZhKTsKKworICAgIC8qIFJldHVybiBpZiBpdCBpcyBuZWl0aGVyIFBlcm1pc3Npb24g
RmF1bHQgbm9yIFRyYW5zbGF0aW9uIEZhdWx0LiAqLworICAgIGlmICggIShzdGF0dXMgJiAoSU1T
VFJfUEYgfCBJTVNUUl9URikpICkKKyAgICAgICAgcmV0dXJuOworCisgICAgLyogRmx1c2ggdGhl
IFRMQiBhcyByZXF1aXJlZCB3aGVuIElQTU1VIHRyYW5zbGF0aW9uIGVycm9yIG9jY3VycmVkLiAq
LworICAgIGlwbW11X3RsYl9pbnZhbGlkYXRlKGRvbWFpbik7CisKKyAgICBkZXZfZXJyX3JhdGVs
aW1pdGVkKG1tdS0+ZGV2LCAiJXBkOiBVbmhhbmRsZWQgZmF1bHQ6IHN0YXR1cyAweCUwOHggaW92
YSAweCUiUFJJeDY0IlxuIiwKKyAgICAgICAgICAgICAgICAgICAgICAgIGRvbWFpbi0+ZCwgc3Rh
dHVzLCBpb3ZhKTsKK30KKworc3RhdGljIHZvaWQgaXBtbXVfaXJxKGludCBpcnEsIHZvaWQgKmRl
diwgc3RydWN0IGNwdV91c2VyX3JlZ3MgKnJlZ3MpCit7CisgICAgc3RydWN0IGlwbW11X3Ztc2Ff
ZGV2aWNlICptbXUgPSBkZXY7CisgICAgdW5zaWduZWQgaW50IGk7CisgICAgdW5zaWduZWQgbG9u
ZyBmbGFnczsKKworICAgIHNwaW5fbG9ja19pcnFzYXZlKCZtbXUtPmxvY2ssIGZsYWdzKTsKKwor
ICAgIC8qCisgICAgICogV2hlbiBpbnRlcnJ1cHQgYXJyaXZlcywgd2UgZG9uJ3Qga25vdyB0aGUg
Y29udGV4dCBpdCBpcyByZWxhdGVkIHRvLgorICAgICAqIFNvLCBjaGVjayBpbnRlcnJ1cHRzIGZv
ciBhbGwgYWN0aXZlIGNvbnRleHRzIHRvIGxvY2F0ZSBhIGNvbnRleHQKKyAgICAgKiB3aXRoIHN0
YXR1cyBiaXRzIHNldC4KKyAgICAqLworICAgIGZvciAoIGkgPSAwOyBpIDwgbW11LT5udW1fY3R4
OyBpKysgKQorICAgIHsKKyAgICAgICAgaWYgKCAhbW11LT5kb21haW5zW2ldICkKKyAgICAgICAg
ICAgIGNvbnRpbnVlOworICAgICAgICBpcG1tdV9kb21haW5faXJxKG1tdS0+ZG9tYWluc1tpXSk7
CisgICAgfQorCisgICAgc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmbW11LT5sb2NrLCBmbGFncyk7
Cit9CisKKy8qIE1hc3RlciBkZXZpY2VzIG1hbmFnZW1lbnQgKi8KK3N0YXRpYyBpbnQgaXBtbXVf
YXR0YWNoX2RldmljZShzdHJ1Y3QgaXBtbXVfdm1zYV9kb21haW4gKmRvbWFpbiwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgZGV2aWNlICpkZXYpCit7CisgICAgc3RydWN0
IGlvbW11X2Z3c3BlYyAqZndzcGVjID0gZGV2X2lvbW11X2Z3c3BlY19nZXQoZGV2KTsKKyAgICBz
dHJ1Y3QgaXBtbXVfdm1zYV9kZXZpY2UgKm1tdSA9IHRvX2lwbW11KGRldik7CisgICAgdW5zaWdu
ZWQgaW50IGk7CisKKyAgICBpZiAoICFtbXUgKQorICAgIHsKKyAgICAgICAgZGV2X2VycihkZXYs
ICJDYW5ub3QgYXR0YWNoIHRvIElQTU1VXG4iKTsKKyAgICAgICAgcmV0dXJuIC1FTlhJTzsKKyAg
ICB9CisKKyAgICBpZiAoICFkb21haW4tPm1tdSApCisgICAgeworICAgICAgICAvKiBUaGUgZG9t
YWluIGhhc24ndCBiZWVuIHVzZWQgeWV0LCBpbml0aWFsaXplIGl0LiAqLworICAgICAgICBkb21h
aW4tPm1tdSA9IG1tdTsKKworICAgICAgICAvKgorICAgICAgICAgKiBXZSBoYXZlIGFscmVhZHkg
ZW5hYmxlZCBjb250ZXh0IGZvciBSb290IElQTU1VIGFzc2lnbmVkIHRvIHRoaXMKKyAgICAgICAg
ICogWGVuIGRvbWFpbiBpbiBpcG1tdV9kb21haW5faW5pdF9jb250ZXh0KCkuCisgICAgICAgICAq
IEVuYWJsZSB0aGUgY29udGV4dCBmb3IgQ2FjaGUgSVBNTVUgb25seS4gRmx1c2ggdGhlIFRMQiBh
cyByZXF1aXJlZAorICAgICAgICAgKiB3aGVuIG1vZGlmeWluZyB0aGUgY29udGV4dCByZWdpc3Rl
cnMuCisgICAgICAgICAqLworICAgICAgICBpcG1tdV9jdHhfd3JpdGVfY2FjaGUoZG9tYWluLCBJ
TUNUUiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlwbW11X2N0eF9yZWFkX3Jvb3Qo
ZG9tYWluLCBJTUNUUikgfCBJTUNUUl9GTFVTSCk7CisKKyAgICAgICAgZGV2X2luZm8oZGV2LCAi
VXNpbmcgSVBNTVUgY29udGV4dCAldVxuIiwgZG9tYWluLT5jb250ZXh0X2lkKTsKKyAgICB9Cisg
ICAgZWxzZSBpZiAoIGRvbWFpbi0+bW11ICE9IG1tdSApCisgICAgeworICAgICAgICAvKgorICAg
ICAgICAgKiBTb21ldGhpbmcgaXMgd3JvbmcsIHdlIGNhbid0IGF0dGFjaCB0d28gbWFzdGVyIGRl
dmljZXMgdXNpbmcKKyAgICAgICAgICogZGlmZmVyZW50IElPTU1VcyB0byB0aGUgc2FtZSBJUE1N
VSBkb21haW4uCisgICAgICAgICAqLworICAgICAgICBkZXZfZXJyKGRldiwgIkNhbid0IGF0dGFj
aCBJUE1NVSAlcyB0byBkb21haW4gb24gSVBNTVUgJXNcbiIsCisgICAgICAgICAgICAgICAgZGV2
X25hbWUobW11LT5kZXYpLCBkZXZfbmFtZShkb21haW4tPm1tdS0+ZGV2KSk7CisgICAgICAgIHJl
dHVybiAtRUlOVkFMOworICAgIH0KKyAgICBlbHNlCisgICAgICAgIGRldl9pbmZvKGRldiwgIlJl
dXNpbmcgSVBNTVUgY29udGV4dCAldVxuIiwgZG9tYWluLT5jb250ZXh0X2lkKTsKKworICAgIGZv
ciAoIGkgPSAwOyBpIDwgZndzcGVjLT5udW1faWRzOyArK2kgKQorICAgICAgICBpcG1tdV91dGxi
X2VuYWJsZShkb21haW4sIGZ3c3BlYy0+aWRzW2ldKTsKKworICAgIHJldHVybiAwOworfQorCitz
dGF0aWMgdm9pZCBpcG1tdV9kZXRhY2hfZGV2aWNlKHN0cnVjdCBpcG1tdV92bXNhX2RvbWFpbiAq
ZG9tYWluLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgZGV2aWNlICpk
ZXYpCit7CisgICAgc3RydWN0IGlvbW11X2Z3c3BlYyAqZndzcGVjID0gZGV2X2lvbW11X2Z3c3Bl
Y19nZXQoZGV2KTsKKyAgICB1bnNpZ25lZCBpbnQgaTsKKworICAgIGZvciAoIGkgPSAwOyBpIDwg
ZndzcGVjLT5udW1faWRzOyArK2kgKQorICAgICAgICBpcG1tdV91dGxiX2Rpc2FibGUoZG9tYWlu
LCBmd3NwZWMtPmlkc1tpXSk7Cit9CisKK3N0YXRpYyB2b2lkIGlwbW11X2RldmljZV9yZXNldChz
dHJ1Y3QgaXBtbXVfdm1zYV9kZXZpY2UgKm1tdSkKK3sKKyAgICB1bnNpZ25lZCBpbnQgaTsKKwor
ICAgIC8qIERpc2FibGUgYWxsIGNvbnRleHRzLiAqLworICAgIGZvciAoIGkgPSAwOyBpIDwgbW11
LT5udW1fY3R4OyArK2kgKQorICAgICAgICBpcG1tdV93cml0ZShtbXUsIGkgKiBJTV9DVFhfU0la
RSArIElNQ1RSLCAwKTsKK30KKworLyoKKyAqIFRoaXMgZnVuY3Rpb24gcmVsaWVzIG9uIHRoZSBm
YWN0IHRoYXQgUm9vdCBJUE1NVSBkZXZpY2UgaXMgYmVpbmcgcHJvYmVkCisgKiB0aGUgZmlyc3Qu
IElmIG5vdCB0aGUgY2FzZSwgaXQgZGVuaWVzIGZ1cnRoZXIgQ2FjaGUgSVBNTVUgZGV2aWNlIHBy
b2JlcworICogKHJldHVybnMgdGhlIC1FQUdBSU4pIHVudGlsIHRoZSBSb290IElQTU1VIGRldmlj
ZSBoYXMgYmVlbiByZWdpc3RlcmVkCisgKiBmb3Igc3VyZS4KKyAqLworc3RhdGljIGludCBpcG1t
dV9wcm9iZShzdHJ1Y3QgZHRfZGV2aWNlX25vZGUgKm5vZGUpCit7CisgICAgc3RydWN0IGlwbW11
X3Ztc2FfZGV2aWNlICptbXU7CisgICAgdWludDY0X3QgYWRkciwgc2l6ZTsKKyAgICBpbnQgaXJx
LCByZXQ7CisKKyAgICBtbXUgPSB4emFsbG9jKHN0cnVjdCBpcG1tdV92bXNhX2RldmljZSk7Cisg
ICAgaWYgKCAhbW11ICkKKyAgICB7CisgICAgICAgIGRldl9lcnIoJm5vZGUtPmRldiwgIkNhbm5v
dCBhbGxvY2F0ZSBkZXZpY2UgZGF0YVxuIik7CisgICAgICAgIHJldHVybiAtRU5PTUVNOworICAg
IH0KKworICAgIG1tdS0+ZGV2ID0gJm5vZGUtPmRldjsKKyAgICBtbXUtPm51bV91dGxicyA9IElQ
TU1VX1VUTEJfTUFYOworICAgIG1tdS0+bnVtX2N0eCA9IElQTU1VX0NUWF9NQVg7CisgICAgc3Bp
bl9sb2NrX2luaXQoJm1tdS0+bG9jayk7CisgICAgYml0bWFwX3plcm8obW11LT5jdHgsIElQTU1V
X0NUWF9NQVgpOworCisgICAgLyogTWFwIEkvTyBtZW1vcnkgYW5kIHJlcXVlc3QgSVJRLiAqLwor
ICAgIHJldCA9IGR0X2RldmljZV9nZXRfYWRkcmVzcyhub2RlLCAwLCAmYWRkciwgJnNpemUpOwor
ICAgIGlmICggcmV0ICkKKyAgICB7CisgICAgICAgIGRldl9lcnIoJm5vZGUtPmRldiwgIkZhaWxl
ZCB0byBnZXQgTU1JT1xuIik7CisgICAgICAgIGdvdG8gb3V0OworICAgIH0KKworICAgIG1tdS0+
YmFzZSA9IGlvcmVtYXBfbm9jYWNoZShhZGRyLCBzaXplKTsKKyAgICBpZiAoICFtbXUtPmJhc2Ug
KQorICAgIHsKKyAgICAgICAgZGV2X2Vycigmbm9kZS0+ZGV2LCAiRmFpbGVkIHRvIGlvcmVtYXAg
TU1JTyAoYWRkciAweCUiUFJJeDY0IiBzaXplIDB4JSJQUkl4NjQiKVxuIiwKKyAgICAgICAgICAg
ICAgICBhZGRyLCBzaXplKTsKKyAgICAgICAgcmV0ID0gLUVOT01FTTsKKyAgICAgICAgZ290byBv
dXQ7CisgICAgfQorCisgICAgLyoKKyAgICAgKiBEZXRlcm1pbmUgaWYgdGhpcyBJUE1NVSBub2Rl
IGlzIGEgUm9vdCBkZXZpY2UgYnkgY2hlY2tpbmcgZm9yCisgICAgICogdGhlIGxhY2sgb2YgcmVu
ZXNhcyxpcG1tdS1tYWluIHByb3BlcnR5LgorICAgICAqLworICAgIGlmICggIWR0X2ZpbmRfcHJv
cGVydHkobm9kZSwgInJlbmVzYXMsaXBtbXUtbWFpbiIsIE5VTEwpICkKKyAgICAgICAgbW11LT5y
b290ID0gbW11OworICAgIGVsc2UKKyAgICAgICAgbW11LT5yb290ID0gaXBtbXVfZmluZF9yb290
KCk7CisKKyAgICAvKiBXYWl0IHVudGlsIHRoZSBSb290IGRldmljZSBoYXMgYmVlbiByZWdpc3Rl
cmVkIGZvciBzdXJlLiAqLworICAgIGlmICggIW1tdS0+cm9vdCApCisgICAgeworICAgICAgICBk
ZXZfZXJyKCZub2RlLT5kZXYsICJSb290IElQTU1VIGhhc24ndCBiZWVuIHJlZ2lzdGVyZWQgeWV0
XG4iKTsKKyAgICAgICAgcmV0ID0gLUVBR0FJTjsKKyAgICAgICAgZ290byBvdXQ7CisgICAgfQor
CisgICAgLyogUm9vdCBkZXZpY2VzIGhhdmUgbWFuZGF0b3J5IElSUXMuICovCisgICAgaWYgKCBp
cG1tdV9pc19yb290KG1tdSkgKQorICAgIHsKKyAgICAgICAgaXJxID0gcGxhdGZvcm1fZ2V0X2ly
cShub2RlLCAwKTsKKyAgICAgICAgaWYgKCBpcnEgPCAwICkKKyAgICAgICAgeworICAgICAgICAg
ICAgZGV2X2Vycigmbm9kZS0+ZGV2LCAiTm8gSVJRIGZvdW5kXG4iKTsKKyAgICAgICAgICAgIHJl
dCA9IGlycTsKKyAgICAgICAgICAgIGdvdG8gb3V0OworICAgICAgICB9CisKKyAgICAgICAgcmV0
ID0gcmVxdWVzdF9pcnEoaXJxLCAwLCBpcG1tdV9pcnEsIGRldl9uYW1lKCZub2RlLT5kZXYpLCBt
bXUpOworICAgICAgICBpZiAoIHJldCA8IDAgKQorICAgICAgICB7CisgICAgICAgICAgICBkZXZf
ZXJyKCZub2RlLT5kZXYsICJGYWlsZWQgdG8gcmVxdWVzdCBJUlEgJWRcbiIsIGlycSk7CisgICAg
ICAgICAgICBnb3RvIG91dDsKKyAgICAgICAgfQorCisgICAgICAgIGlwbW11X2RldmljZV9yZXNl
dChtbXUpOworCisgICAgICAgIC8qCisgICAgICAgICAqIFVzZSBzdGFnZSAyIHRyYW5zbGF0aW9u
IHRhYmxlIGZvcm1hdCB3aGVuIHN0YWdlIDIgdHJhbnNsYXRpb24KKyAgICAgICAgICogZW5hYmxl
ZC4KKyAgICAgICAgICovCisgICAgICAgIGlwbW11X3dyaXRlKG1tdSwgSU1TQVVYQ1RMUiwKKyAg
ICAgICAgICAgICAgICAgICAgaXBtbXVfcmVhZChtbXUsIElNU0FVWENUTFIpIHwgSU1TQVVYQ1RM
Ul9TMlBURSk7CisKKyAgICAgICAgZGV2X2luZm8oJm5vZGUtPmRldiwgIklQTU1VIGNvbnRleHQg
MCBpcyByZXNlcnZlZFxuIik7CisgICAgICAgIHNldF9iaXQoMCwgbW11LT5jdHgpOworICAgIH0K
KworICAgIHNwaW5fbG9jaygmaXBtbXVfZGV2aWNlc19sb2NrKTsKKyAgICBsaXN0X2FkZCgmbW11
LT5saXN0LCAmaXBtbXVfZGV2aWNlcyk7CisgICAgc3Bpbl91bmxvY2soJmlwbW11X2RldmljZXNf
bG9jayk7CisKKyAgICBkZXZfaW5mbygmbm9kZS0+ZGV2LCAiUmVnaXN0ZXJlZCAlcyBJUE1NVVxu
IiwKKyAgICAgICAgICAgICBpcG1tdV9pc19yb290KG1tdSkgPyAiUm9vdCIgOiAiQ2FjaGUiKTsK
KworICAgIHJldHVybiAwOworCitvdXQ6CisgICAgaWYgKCBtbXUtPmJhc2UgKQorICAgICAgICBp
b3VubWFwKG1tdS0+YmFzZSk7CisgICAgeGZyZWUobW11KTsKKworICAgIHJldHVybiByZXQ7Cit9
CisKKy8qIFhlbiBJT01NVSBvcHMgKi8KK3N0YXRpYyBpbnQgX19tdXN0X2NoZWNrIGlwbW11X2lv
dGxiX2ZsdXNoX2FsbChzdHJ1Y3QgZG9tYWluICpkKQoreworICAgIHN0cnVjdCBpcG1tdV92bXNh
X3hlbl9kb21haW4gKnhlbl9kb21haW4gPSBkb21faW9tbXUoZCktPmFyY2gucHJpdjsKKworICAg
IGlmICggIXhlbl9kb21haW4gfHwgIXhlbl9kb21haW4tPnJvb3RfZG9tYWluICkKKyAgICAgICAg
cmV0dXJuIDA7CisKKyAgICBzcGluX2xvY2soJnhlbl9kb21haW4tPmxvY2spOworICAgIGlwbW11
X3RsYl9pbnZhbGlkYXRlKHhlbl9kb21haW4tPnJvb3RfZG9tYWluKTsKKyAgICBzcGluX3VubG9j
aygmeGVuX2RvbWFpbi0+bG9jayk7CisKKyAgICByZXR1cm4gMDsKK30KKworc3RhdGljIGludCBf
X211c3RfY2hlY2sgaXBtbXVfaW90bGJfZmx1c2goc3RydWN0IGRvbWFpbiAqZCwgZGZuX3QgZGZu
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50
IHBhZ2VfY291bnQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1
bnNpZ25lZCBpbnQgZmx1c2hfZmxhZ3MpCit7CisgICAgQVNTRVJUKGZsdXNoX2ZsYWdzKTsKKwor
ICAgIC8qIFRoZSBoYXJkd2FyZSBkb2Vzbid0IHN1cHBvcnQgc2VsZWN0aXZlIFRMQiBmbHVzaC4g
Ki8KKyAgICByZXR1cm4gaXBtbXVfaW90bGJfZmx1c2hfYWxsKGQpOworfQorCitzdGF0aWMgc3Ry
dWN0IGlwbW11X3Ztc2FfZG9tYWluICppcG1tdV9nZXRfY2FjaGVfZG9tYWluKHN0cnVjdCBkb21h
aW4gKmQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHN0cnVjdCBkZXZpY2UgKmRldikKK3sKKyAgICBzdHJ1Y3QgaXBtbXVfdm1zYV94ZW5f
ZG9tYWluICp4ZW5fZG9tYWluID0gZG9tX2lvbW11KGQpLT5hcmNoLnByaXY7CisgICAgc3RydWN0
IGlwbW11X3Ztc2FfZGV2aWNlICptbXUgPSB0b19pcG1tdShkZXYpOworICAgIHN0cnVjdCBpcG1t
dV92bXNhX2RvbWFpbiAqZG9tYWluOworCisgICAgaWYgKCAhbW11ICkKKyAgICAgICAgcmV0dXJu
IE5VTEw7CisKKyAgICAvKgorICAgICAqIExvb3AgdGhyb3VnaCBhbGwgQ2FjaGUgSVBNTVUgZG9t
YWlucyBhc3NvY2lhdGVkIHdpdGggdGhpcyBYZW4gZG9tYWluCisgICAgICogdG8gbG9jYXRlIGFu
IElQTU1VIGRvbWFpbiB0aGlzIElQTU1VIGRldmljZSBpcyBhc3NpZ25lZCB0by4KKyAgICAgKi8K
KyAgICBsaXN0X2Zvcl9lYWNoX2VudHJ5KCBkb21haW4sICZ4ZW5fZG9tYWluLT5jYWNoZV9kb21h
aW5zLCBsaXN0ICkKKyAgICB7CisgICAgICAgIGlmICggZG9tYWluLT5tbXUgPT0gbW11ICkKKyAg
ICAgICAgICAgIHJldHVybiBkb21haW47CisgICAgfQorCisgICAgcmV0dXJuIE5VTEw7Cit9CisK
K3N0YXRpYyBzdHJ1Y3QgaXBtbXVfdm1zYV9kb21haW4gKmlwbW11X2FsbG9jX2NhY2hlX2RvbWFp
bihzdHJ1Y3QgZG9tYWluICpkKQoreworICAgIHN0cnVjdCBpcG1tdV92bXNhX3hlbl9kb21haW4g
Knhlbl9kb21haW4gPSBkb21faW9tbXUoZCktPmFyY2gucHJpdjsKKyAgICBzdHJ1Y3QgaXBtbXVf
dm1zYV9kb21haW4gKmRvbWFpbjsKKworICAgIGRvbWFpbiA9IHh6YWxsb2Moc3RydWN0IGlwbW11
X3Ztc2FfZG9tYWluKTsKKyAgICBpZiAoICFkb21haW4gKQorICAgICAgICByZXR1cm4gRVJSX1BU
UigtRU5PTUVNKTsKKworICAgIC8qCisgICAgICogV2UgZG9uJ3QgYXNzaWduIHRoZSBDYWNoZSBJ
UE1NVSBkZXZpY2UgaGVyZSwgaXQgd2lsbCBiZSBhc3NpZ25lZCB3aGVuCisgICAgICogYXR0YWNo
aW5nIG1hc3RlciBkZXZpY2UgdG8gdGhpcyBkb21haW4gaW4gaXBtbXVfYXR0YWNoX2RldmljZSgp
LgorICAgICAqIGRvbWFpbi0+bW11ID0gTlVMTDsKKyAgICAgKi8KKworICAgIGRvbWFpbi0+ZCA9
IGQ7CisgICAgLyogVXNlIHRoZSBzYW1lIGNvbnRleHQgbWFwcGVkIHRvIHRoaXMgWGVuIGRvbWFp
bi4gKi8KKyAgICBkb21haW4tPmNvbnRleHRfaWQgPSB4ZW5fZG9tYWluLT5yb290X2RvbWFpbi0+
Y29udGV4dF9pZDsKKworICAgIHJldHVybiBkb21haW47Cit9CisKK3N0YXRpYyB2b2lkIGlwbW11
X2ZyZWVfY2FjaGVfZG9tYWluKHN0cnVjdCBpcG1tdV92bXNhX2RvbWFpbiAqZG9tYWluKQorewor
ICAgIGxpc3RfZGVsKCZkb21haW4tPmxpc3QpOworICAgIC8qCisgICAgICogRGlzYWJsZSB0aGUg
Y29udGV4dCBmb3IgQ2FjaGUgSVBNTVUgb25seS4gRmx1c2ggdGhlIFRMQiBhcyByZXF1aXJlZAor
ICAgICAqIHdoZW4gbW9kaWZ5aW5nIHRoZSBjb250ZXh0IHJlZ2lzdGVycy4KKyAgICAgKi8KKyAg
ICBpcG1tdV9jdHhfd3JpdGVfY2FjaGUoZG9tYWluLCBJTUNUUiwgSU1DVFJfRkxVU0gpOworICAg
IHhmcmVlKGRvbWFpbik7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgaXBtbXVfdm1zYV9kb21haW4gKmlw
bW11X2FsbG9jX3Jvb3RfZG9tYWluKHN0cnVjdCBkb21haW4gKmQpCit7CisgICAgc3RydWN0IGlw
bW11X3Ztc2FfZG9tYWluICpkb21haW47CisgICAgc3RydWN0IGlwbW11X3Ztc2FfZGV2aWNlICpy
b290OworICAgIGludCByZXQ7CisKKyAgICAvKiBJZiB3ZSBhcmUgaGVyZSB0aGVuIFJvb3QgZGV2
aWNlIG11c3QgaGFzIGJlZW4gcmVnaXN0ZXJlZC4gKi8KKyAgICByb290ID0gaXBtbXVfZmluZF9y
b290KCk7CisgICAgaWYgKCAhcm9vdCApCisgICAgeworICAgICAgICBwcmludGsoWEVOTE9HX0VS
UiAiaXBtbXU6IFVuYWJsZSB0byBsb2NhdGUgUm9vdCBJUE1NVVxuIik7CisgICAgICAgIHJldHVy
biBFUlJfUFRSKC1FTk9ERVYpOworICAgIH0KKworICAgIGRvbWFpbiA9IHh6YWxsb2Moc3RydWN0
IGlwbW11X3Ztc2FfZG9tYWluKTsKKyAgICBpZiAoICFkb21haW4gKQorICAgICAgICByZXR1cm4g
RVJSX1BUUigtRU5PTUVNKTsKKworICAgIGRvbWFpbi0+bW11ID0gcm9vdDsKKyAgICBkb21haW4t
PmQgPSBkOworCisgICAgLyogSW5pdGlhbGl6ZSB0aGUgY29udGV4dCB0byBiZSBtYXBwZWQgdG8g
dGhpcyBYZW4gZG9tYWluLiAqLworICAgIHJldCA9IGlwbW11X2RvbWFpbl9pbml0X2NvbnRleHQo
ZG9tYWluKTsKKyAgICBpZiAoIHJldCA8IDAgKQorICAgIHsKKyAgICAgICAgZGV2X2Vycihyb290
LT5kZXYsICIlcGQ6IFVuYWJsZSB0byBpbml0aWFsaXplIElQTU1VIGNvbnRleHRcbiIsIGQpOwor
ICAgICAgICB4ZnJlZShkb21haW4pOworICAgICAgICByZXR1cm4gRVJSX1BUUihyZXQpOworICAg
IH0KKworICAgIHJldHVybiBkb21haW47Cit9CisKK3N0YXRpYyB2b2lkIGlwbW11X2ZyZWVfcm9v
dF9kb21haW4oc3RydWN0IGlwbW11X3Ztc2FfZG9tYWluICpkb21haW4pCit7CisgICAgaXBtbXVf
ZG9tYWluX2Rlc3Ryb3lfY29udGV4dChkb21haW4pOworICAgIHhmcmVlKGRvbWFpbik7Cit9CisK
K3N0YXRpYyBpbnQgaXBtbXVfYXNzaWduX2RldmljZShzdHJ1Y3QgZG9tYWluICpkLCB1OCBkZXZm
biwgc3RydWN0IGRldmljZSAqZGV2LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVp
bnQzMl90IGZsYWcpCit7CisgICAgc3RydWN0IGlwbW11X3Ztc2FfeGVuX2RvbWFpbiAqeGVuX2Rv
bWFpbiA9IGRvbV9pb21tdShkKS0+YXJjaC5wcml2OworICAgIHN0cnVjdCBpcG1tdV92bXNhX2Rv
bWFpbiAqZG9tYWluOworICAgIGludCByZXQ7CisKKyAgICBpZiAoICF4ZW5fZG9tYWluICkKKyAg
ICAgICAgcmV0dXJuIC1FSU5WQUw7CisKKyAgICBpZiAoICF0b19pcG1tdShkZXYpICkKKyAgICAg
ICAgcmV0dXJuIC1FTk9ERVY7CisKKyAgICBzcGluX2xvY2soJnhlbl9kb21haW4tPmxvY2spOwor
CisgICAgLyoKKyAgICAgKiBUaGUgSVBNTVUgY29udGV4dCBmb3IgdGhlIFhlbiBkb21haW4gaXMg
bm90IGFsbG9jYXRlZCBiZWZvcmVoYW5kCisgICAgICogKGF0IHRoZSBYZW4gZG9tYWluIGNyZWF0
aW9uIHRpbWUpLCBidXQgb24gZGVtYW5kIG9ubHksIHdoZW4gdGhlIGZpcnN0CisgICAgICogbWFz
dGVyIGRldmljZSBiZWluZyBhdHRhY2hlZCB0byBpdC4KKyAgICAgKiBDcmVhdGUgUm9vdCBJUE1N
VSBkb21haW4gd2hpY2ggY29udGV4dCB3aWxsIGJlIG1hcHBlZCB0byB0aGlzIFhlbiBkb21haW4K
KyAgICAgKiBpZiBub3QgZXhpdHMgeWV0LgorICAgICAqLworICAgIGlmICggIXhlbl9kb21haW4t
PnJvb3RfZG9tYWluICkKKyAgICB7CisgICAgICAgIGRvbWFpbiA9IGlwbW11X2FsbG9jX3Jvb3Rf
ZG9tYWluKGQpOworICAgICAgICBpZiAoIElTX0VSUihkb21haW4pICkKKyAgICAgICAgeworICAg
ICAgICAgICAgcmV0ID0gUFRSX0VSUihkb21haW4pOworICAgICAgICAgICAgZ290byBvdXQ7Cisg
ICAgICAgIH0KKworICAgICAgICB4ZW5fZG9tYWluLT5yb290X2RvbWFpbiA9IGRvbWFpbjsKKyAg
ICB9CisKKyAgICBpZiAoIHRvX2RvbWFpbihkZXYpICkKKyAgICB7CisgICAgICAgIGRldl9lcnIo
ZGV2LCAiQWxyZWFkeSBhdHRhY2hlZCB0byBJUE1NVSBkb21haW5cbiIpOworICAgICAgICByZXQg
PSAtRUVYSVNUOworICAgICAgICBnb3RvIG91dDsKKyAgICB9CisKKyAgICAvKgorICAgICAqIE1h
c3RlciBkZXZpY2VzIGJlaGluZCB0aGUgc2FtZSBDYWNoZSBJUE1NVSBjYW4gYmUgYXR0YWNoZWQg
dG8gdGhlIHNhbWUKKyAgICAgKiBDYWNoZSBJUE1NVSBkb21haW4uCisgICAgICogQmVmb3JlIGNy
ZWF0aW5nIG5ldyBJUE1NVSBkb21haW4gY2hlY2sgdG8gc2VlIGlmIHRoZSByZXF1aXJlZCBvbmUK
KyAgICAgKiBhbHJlYWR5IGV4aXN0cyBmb3IgdGhpcyBYZW4gZG9tYWluLgorICAgICAqLworICAg
IGRvbWFpbiA9IGlwbW11X2dldF9jYWNoZV9kb21haW4oZCwgZGV2KTsKKyAgICBpZiAoICFkb21h
aW4gKQorICAgIHsKKyAgICAgICAgLyogQ3JlYXRlIG5ldyBJUE1NVSBkb21haW4gdGhpcyBtYXN0
ZXIgZGV2aWNlIHdpbGwgYmUgYXR0YWNoZWQgdG8uICovCisgICAgICAgIGRvbWFpbiA9IGlwbW11
X2FsbG9jX2NhY2hlX2RvbWFpbihkKTsKKyAgICAgICAgaWYgKCBJU19FUlIoZG9tYWluKSApCisg
ICAgICAgIHsKKyAgICAgICAgICAgIHJldCA9IFBUUl9FUlIoZG9tYWluKTsKKyAgICAgICAgICAg
IGdvdG8gb3V0OworICAgICAgICB9CisKKyAgICAgICAgLyogQ2hhaW4gbmV3IElQTU1VIGRvbWFp
biB0byB0aGUgWGVuIGRvbWFpbi4gKi8KKyAgICAgICAgbGlzdF9hZGQoJmRvbWFpbi0+bGlzdCwg
Jnhlbl9kb21haW4tPmNhY2hlX2RvbWFpbnMpOworICAgIH0KKworICAgIHJldCA9IGlwbW11X2F0
dGFjaF9kZXZpY2UoZG9tYWluLCBkZXYpOworICAgIGlmICggcmV0ICkKKyAgICB7CisgICAgICAg
IC8qCisgICAgICAgICAqIERlc3Ryb3kgQ2FjaGUgSVBNTVUgZG9tYWluIG9ubHkgaWYgdGhlcmUg
YXJlIG5vIG1hc3RlciBkZXZpY2VzCisgICAgICAgICAqIGF0dGFjaGVkIHRvIGl0LgorICAgICAg
ICAgKi8KKyAgICAgICAgaWYgKCAhZG9tYWluLT5yZWZjb3VudCApCisgICAgICAgICAgICBpcG1t
dV9mcmVlX2NhY2hlX2RvbWFpbihkb21haW4pOworICAgIH0KKyAgICBlbHNlCisgICAgeworICAg
ICAgICBkb21haW4tPnJlZmNvdW50Kys7CisgICAgICAgIHNldF9kb21haW4oZGV2LCBkb21haW4p
OworICAgIH0KKworb3V0OgorICAgIHNwaW5fdW5sb2NrKCZ4ZW5fZG9tYWluLT5sb2NrKTsKKwor
ICAgIHJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBpbnQgaXBtbXVfZGVhc3NpZ25fZGV2aWNlKHN0
cnVjdCBkb21haW4gKmQsIHN0cnVjdCBkZXZpY2UgKmRldikKK3sKKyAgICBzdHJ1Y3QgaXBtbXVf
dm1zYV94ZW5fZG9tYWluICp4ZW5fZG9tYWluID0gZG9tX2lvbW11KGQpLT5hcmNoLnByaXY7Cisg
ICAgc3RydWN0IGlwbW11X3Ztc2FfZG9tYWluICpkb21haW4gPSB0b19kb21haW4oZGV2KTsKKwor
ICAgIGlmICggIWRvbWFpbiB8fCBkb21haW4tPmQgIT0gZCApCisgICAgeworICAgICAgICBkZXZf
ZXJyKGRldiwgIk5vdCBhdHRhY2hlZCB0byAlcGRcbiIsIGQpOworICAgICAgICByZXR1cm4gLUVT
UkNIOworICAgIH0KKworICAgIHNwaW5fbG9jaygmeGVuX2RvbWFpbi0+bG9jayk7CisKKyAgICBp
cG1tdV9kZXRhY2hfZGV2aWNlKGRvbWFpbiwgZGV2KTsKKyAgICBzZXRfZG9tYWluKGRldiwgTlVM
TCk7CisgICAgZG9tYWluLT5yZWZjb3VudC0tOworCisgICAgLyoKKyAgICAgKiBEZXN0cm95IENh
Y2hlIElQTU1VIGRvbWFpbiBvbmx5IGlmIHRoZXJlIGFyZSBubyBtYXN0ZXIgZGV2aWNlcworICAg
ICAqIGF0dGFjaGVkIHRvIGl0LgorICAgICAqLworICAgIGlmICggIWRvbWFpbi0+cmVmY291bnQg
KQorICAgICAgICBpcG1tdV9mcmVlX2NhY2hlX2RvbWFpbihkb21haW4pOworCisgICAgc3Bpbl91
bmxvY2soJnhlbl9kb21haW4tPmxvY2spOworCisgICAgcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBp
bnQgaXBtbXVfcmVhc3NpZ25fZGV2aWNlKHN0cnVjdCBkb21haW4gKnMsIHN0cnVjdCBkb21haW4g
KnQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1OCBkZXZmbiwgIHN0cnVjdCBk
ZXZpY2UgKmRldikKK3sKKyAgICBpbnQgcmV0ID0gMDsKKworICAgIC8qIERvbid0IGFsbG93IHJl
bWFwcGluZyBvbiBvdGhlciBkb21haW4gdGhhbiBod2RvbSAqLworICAgIGlmICggdCAmJiB0ICE9
IGhhcmR3YXJlX2RvbWFpbiApCisgICAgICAgIHJldHVybiAtRVBFUk07CisKKyAgICBpZiAoIHQg
PT0gcyApCisgICAgICAgIHJldHVybiAwOworCisgICAgcmV0ID0gaXBtbXVfZGVhc3NpZ25fZGV2
aWNlKHMsIGRldik7CisgICAgaWYgKCByZXQgKQorICAgICAgICByZXR1cm4gcmV0OworCisgICAg
aWYgKCB0ICkKKyAgICB7CisgICAgICAgIC8qIE5vIGZsYWdzIGFyZSBkZWZpbmVkIGZvciBBUk0u
ICovCisgICAgICAgIHJldCA9IGlwbW11X2Fzc2lnbl9kZXZpY2UodCwgZGV2Zm4sIGRldiwgMCk7
CisgICAgICAgIGlmICggcmV0ICkKKyAgICAgICAgICAgIHJldHVybiByZXQ7CisgICAgfQorCisg
ICAgcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgaXBtbXVfYWRkX2RldmljZSh1OCBkZXZmbiwg
c3RydWN0IGRldmljZSAqZGV2KQoreworICAgIHN0cnVjdCBpb21tdV9md3NwZWMgKmZ3c3BlYyA9
IGRldl9pb21tdV9md3NwZWNfZ2V0KGRldik7CisgICAgc3RydWN0IGlwbW11X3Ztc2FfZGV2aWNl
ICptbXU7CisgICAgdW5zaWduZWQgaW50IGk7CisKKyAgICBpZiAoICFmd3NwZWMgfHwgIWZ3c3Bl
Yy0+aW9tbXVfZGV2ICkKKyAgICAgICAgcmV0dXJuIC1FSU5WQUw7CisKKyAgICBtbXUgPSBpcG1t
dV9maW5kX21tdV9ieV9kZXYoZndzcGVjLT5pb21tdV9kZXYpOworICAgIGlmICggIW1tdSApCisg
ICAgICAgIHJldHVybiAtRU5PREVWOworCisgICAgLyoKKyAgICAgKiBQZXJmb3JtIHNhbml0eSBj
aGVjayBvZiBmd3NwZWMtPm51bV9pZHMgYW5kIGZ3c3BlYy0+aWRzWzFdIGZpZWxkcy4KKyAgICAg
KiBUaGVzZSBmaWVsZHMgZGVzY3JpYmUgbWFzdGVyIGRldmljZSdzIGNvbm5lY3Rpb24gdG8gQ2Fj
aGUgSVBNTVUKKyAgICAgKiAobWljcm8tVExCcykuIEVhY2ggbWFzdGVyIGRldmljZSBnZXRzIG1p
Y3JvLVRMQiBhc3NpZ25tZW50IHZpYQorICAgICAqIHRoZSAiaW9tbXVzIiBwcm9wZXJ0eSBpbiBE
VC4KKyAgICAgKi8KKyAgICBpZiAoIGZ3c3BlYy0+bnVtX2lkcyA9PSAwICkKKyAgICAgICAgcmV0
dXJuIC1FSU5WQUw7CisKKyAgICBmb3IgKCBpID0gMDsgaSA8IGZ3c3BlYy0+bnVtX2lkczsgKytp
ICkKKyAgICB7CisgICAgICAgIGlmICggZndzcGVjLT5pZHNbaV0gPj0gbW11LT5udW1fdXRsYnMg
KQorICAgICAgICAgICAgcmV0dXJuIC1FSU5WQUw7CisgICAgfQorCisgICAgaWYgKCB0b19pcG1t
dShkZXYpICkKKyAgICB7CisgICAgICAgIGRldl9lcnIoZGV2LCAiQWxyZWFkeSBhZGRlZCB0byBJ
UE1NVVxuIik7CisgICAgICAgIHJldHVybiAtRUVYSVNUOworICAgIH0KKworICAgIGZ3c3BlYy0+
aW9tbXVfcHJpdiA9IHh6YWxsb2Moc3RydWN0IGlwbW11X3Ztc2FfeGVuX2RldmljZSk7CisgICAg
aWYgKCAhZndzcGVjLT5pb21tdV9wcml2ICkKKyAgICAgICAgcmV0dXJuIC1FTk9NRU07CisKKyAg
ICBzZXRfaXBtbXUoZGV2LCBtbXUpOworCisgICAgLyogTGV0IFhlbiBrbm93IHRoYXQgdGhlIG1h
c3RlciBkZXZpY2UgaXMgcHJvdGVjdGVkIGJ5IGFuIElPTU1VLiAqLworICAgIGR0X2RldmljZV9z
ZXRfcHJvdGVjdGVkKGRldl90b19kdChkZXYpKTsKKworICAgIGRldl9pbmZvKGRldiwgIkFkZGVk
IG1hc3RlciBkZXZpY2UgKElQTU1VICVzIG1pY3JvLVRMQnMgJXUpXG4iLAorICAgICAgICAgICAg
IGRldl9uYW1lKG1tdS0+ZGV2KSwgZndzcGVjLT5udW1faWRzKTsKKworICAgIHJldHVybiAwOwor
fQorCitzdGF0aWMgaW50IGlwbW11X2lvbW11X2RvbWFpbl9pbml0KHN0cnVjdCBkb21haW4gKmQp
Cit7CisgICAgc3RydWN0IGlwbW11X3Ztc2FfeGVuX2RvbWFpbiAqeGVuX2RvbWFpbjsKKworICAg
IHhlbl9kb21haW4gPSB4emFsbG9jKHN0cnVjdCBpcG1tdV92bXNhX3hlbl9kb21haW4pOworICAg
IGlmICggIXhlbl9kb21haW4gKQorICAgICAgICByZXR1cm4gLUVOT01FTTsKKworICAgIHNwaW5f
bG9ja19pbml0KCZ4ZW5fZG9tYWluLT5sb2NrKTsKKyAgICBJTklUX0xJU1RfSEVBRCgmeGVuX2Rv
bWFpbi0+Y2FjaGVfZG9tYWlucyk7CisgICAgLyoKKyAgICAgKiBXZSBkb24ndCBjcmVhdGUgUm9v
dCBJUE1NVSBkb21haW4gaGVyZSwgaXQgd2lsbCBiZSBjcmVhdGVkIG9uIGRlbWFuZAorICAgICAq
IG9ubHksIHdoZW4gYXR0YWNoaW5nIHRoZSBmaXJzdCBtYXN0ZXIgZGV2aWNlIHRvIHRoaXMgWGVu
IGRvbWFpbiBpbgorICAgICAqIGlwbW11X2Fzc2lnbl9kZXZpY2UoKS4KKyAgICAgKiB4ZW5fZG9t
YWluLT5yb290X2RvbWFpbiA9IE5VTEw7CisgICAgKi8KKworICAgIGRvbV9pb21tdShkKS0+YXJj
aC5wcml2ID0geGVuX2RvbWFpbjsKKworICAgIHJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCBf
X2h3ZG9tX2luaXQgaXBtbXVfaW9tbXVfaHdkb21faW5pdChzdHJ1Y3QgZG9tYWluICpkKQorewor
ICAgIC8qIFNldCB0byBmYWxzZSBvcHRpb25zIG5vdCBzdXBwb3J0ZWQgb24gQVJNLiAqLworICAg
IGlmICggaW9tbXVfaHdkb21faW5jbHVzaXZlICkKKyAgICAgICAgcHJpbnRrKFhFTkxPR19XQVJO
SU5HICJpcG1tdTogbWFwLWluY2x1c2l2ZSBkb20wLWlvbW11IG9wdGlvbiBpcyBub3Qgc3VwcG9y
dGVkIG9uIEFSTVxuIik7CisgICAgaW9tbXVfaHdkb21faW5jbHVzaXZlID0gZmFsc2U7CisgICAg
aWYgKCBpb21tdV9od2RvbV9yZXNlcnZlZCA9PSAxICkKKyAgICAgICAgcHJpbnRrKFhFTkxPR19X
QVJOSU5HICJpcG1tdTogbWFwLXJlc2VydmVkIGRvbTAtaW9tbXUgb3B0aW9uIGlzIG5vdCBzdXBw
b3J0ZWQgb24gQVJNXG4iKTsKKyAgICBpb21tdV9od2RvbV9yZXNlcnZlZCA9IDA7CisKKyAgICBh
cmNoX2lvbW11X2h3ZG9tX2luaXQoZCk7Cit9CisKK3N0YXRpYyB2b2lkIGlwbW11X2lvbW11X2Rv
bWFpbl90ZWFyZG93bihzdHJ1Y3QgZG9tYWluICpkKQoreworICAgIHN0cnVjdCBpcG1tdV92bXNh
X3hlbl9kb21haW4gKnhlbl9kb21haW4gPSBkb21faW9tbXUoZCktPmFyY2gucHJpdjsKKworICAg
IGlmICggIXhlbl9kb21haW4gKQorICAgICAgICByZXR1cm47CisKKyAgICBzcGluX2xvY2soJnhl
bl9kb21haW4tPmxvY2spOworICAgIC8qCisgICAgICogRGVzdHJveSBSb290IElQTU1VIGRvbWFp
biB3aGljaCBjb250ZXh0IGlzIG1hcHBlZCB0byB0aGlzIFhlbiBkb21haW4KKyAgICAgKiBpZiBl
eGl0cy4KKyAgICAgKi8KKyAgICBpZiAoIHhlbl9kb21haW4tPnJvb3RfZG9tYWluICkKKyAgICAg
ICAgaXBtbXVfZnJlZV9yb290X2RvbWFpbih4ZW5fZG9tYWluLT5yb290X2RvbWFpbik7CisKKyAg
ICBzcGluX3VubG9jaygmeGVuX2RvbWFpbi0+bG9jayk7CisKKyAgICAvKgorICAgICAqIFdlIGFz
c3VtZSB0aGF0IGFsbCBtYXN0ZXIgZGV2aWNlcyBoYXZlIGFscmVhZHkgYmVlbiBkZXRhY2hlZCBm
cm9tCisgICAgICogdGhpcyBYZW4gZG9tYWluIGFuZCB0aGVyZSBtdXN0IGJlIG5vIGFzc29jaWF0
ZWQgQ2FjaGUgSVBNTVUgZG9tYWlucworICAgICAqIGluIHVzZS4KKyAgICAgKi8KKyAgICBBU1NF
UlQobGlzdF9lbXB0eSgmeGVuX2RvbWFpbi0+Y2FjaGVfZG9tYWlucykpOworICAgIHhmcmVlKHhl
bl9kb21haW4pOworICAgIGRvbV9pb21tdShkKS0+YXJjaC5wcml2ID0gTlVMTDsKK30KKworc3Rh
dGljIGNvbnN0IHN0cnVjdCBpb21tdV9vcHMgaXBtbXVfaW9tbXVfb3BzID0KK3sKKyAgICAuaW5p
dCAgICAgICAgICAgID0gaXBtbXVfaW9tbXVfZG9tYWluX2luaXQsCisgICAgLmh3ZG9tX2luaXQg
ICAgICA9IGlwbW11X2lvbW11X2h3ZG9tX2luaXQsCisgICAgLnRlYXJkb3duICAgICAgICA9IGlw
bW11X2lvbW11X2RvbWFpbl90ZWFyZG93biwKKyAgICAuaW90bGJfZmx1c2ggICAgID0gaXBtbXVf
aW90bGJfZmx1c2gsCisgICAgLmlvdGxiX2ZsdXNoX2FsbCA9IGlwbW11X2lvdGxiX2ZsdXNoX2Fs
bCwKKyAgICAuYXNzaWduX2RldmljZSAgID0gaXBtbXVfYXNzaWduX2RldmljZSwKKyAgICAucmVh
c3NpZ25fZGV2aWNlID0gaXBtbXVfcmVhc3NpZ25fZGV2aWNlLAorICAgIC5tYXBfcGFnZSAgICAg
ICAgPSBhcm1faW9tbXVfbWFwX3BhZ2UsCisgICAgLnVubWFwX3BhZ2UgICAgICA9IGFybV9pb21t
dV91bm1hcF9wYWdlLAorICAgIC5hZGRfZGV2aWNlICAgICAgPSBpcG1tdV9hZGRfZGV2aWNlLAor
fTsKKworLyogUkNBUiBHRU4zIHByb2R1Y3QgYW5kIGN1dCBpbmZvcm1hdGlvbi4gKi8KKyNkZWZp
bmUgUkNBUl9QUk9EVUNUX01BU0sgICAgMHgwMDAwN0YwMAorI2RlZmluZSBSQ0FSX1BST0RVQ1Rf
SDMgICAgICAweDAwMDA0RjAwCisjZGVmaW5lIFJDQVJfUFJPRFVDVF9NMyAgICAgIDB4MDAwMDUy
MDAKKyNkZWZpbmUgUkNBUl9QUk9EVUNUX00zTiAgICAgMHgwMDAwNTUwMAorI2RlZmluZSBSQ0FS
X0NVVF9NQVNLICAgICAgICAweDAwMDAwMEZGCisjZGVmaW5lIFJDQVJfQ1VUX1ZFUjMwICAgICAg
IDB4MDAwMDAwMjAKKworc3RhdGljIF9faW5pdCBib29sIGlwbW11X3N0YWdlMl9zdXBwb3J0ZWQo
dm9pZCkKK3sKKyAgICBzdHJ1Y3QgZHRfZGV2aWNlX25vZGUgKm5wOworICAgIHVpbnQ2NF90IGFk
ZHIsIHNpemU7CisgICAgdm9pZCBfX2lvbWVtICpiYXNlOworICAgIHVpbnQzMl90IHByb2R1Y3Qs
IGN1dDsKKyAgICBzdGF0aWMgZW51bQorICAgIHsKKyAgICAgICAgVU5LTk9XTiwKKyAgICAgICAg
U1VQUE9SVEVELAorICAgICAgICBOT1RTVVBQT1JURUQKKyAgICB9IHN0YWdlMl9zdXBwb3J0ZWQg
PSBVTktOT1dOOworCisgICAgLyogVXNlIHRoZSBmbGFnIHRvIGF2b2lkIGNoZWNraW5nIGZvciB0
aGUgY29tcGF0aWJpbGl0eSBtb3JlIHRoZW4gb25jZS4gKi8KKyAgICBzd2l0Y2ggKCBzdGFnZTJf
c3VwcG9ydGVkICkKKyAgICB7CisgICAgY2FzZSBTVVBQT1JURUQ6CisgICAgICAgIHJldHVybiB0
cnVlOworCisgICAgY2FzZSBOT1RTVVBQT1JURUQ6CisgICAgICAgIHJldHVybiBmYWxzZTsKKwor
ICAgIGNhc2UgVU5LTk9XTjoKKyAgICBkZWZhdWx0OgorICAgICAgICBzdGFnZTJfc3VwcG9ydGVk
ID0gTk9UU1VQUE9SVEVEOworICAgICAgICBicmVhazsKKyAgICB9CisKKyAgICBucCA9IGR0X2Zp
bmRfY29tcGF0aWJsZV9ub2RlKE5VTEwsIE5VTEwsICJyZW5lc2FzLHByciIpOworICAgIGlmICgg
IW5wICkKKyAgICB7CisgICAgICAgIHByaW50ayhYRU5MT0dfRVJSICJpcG1tdTogRmFpbGVkIHRv
IGZpbmQgUFJSIG5vZGVcbiIpOworICAgICAgICByZXR1cm4gZmFsc2U7CisgICAgfQorCisgICAg
aWYgKCBkdF9kZXZpY2VfZ2V0X2FkZHJlc3MobnAsIDAsICZhZGRyLCAmc2l6ZSkgKQorICAgIHsK
KyAgICAgICAgcHJpbnRrKFhFTkxPR19FUlIgImlwbW11OiBGYWlsZWQgdG8gZ2V0IFBSUiBNTUlP
XG4iKTsKKyAgICAgICAgcmV0dXJuIGZhbHNlOworICAgIH0KKworICAgIGJhc2UgPSBpb3JlbWFw
X25vY2FjaGUoYWRkciwgc2l6ZSk7CisgICAgaWYgKCAhYmFzZSApCisgICAgeworICAgICAgICBw
cmludGsoWEVOTE9HX0VSUiAiaXBtbXU6IEZhaWxlZCB0byBpb3JlbWFwIFBSUiBNTUlPXG4iKTsK
KyAgICAgICAgcmV0dXJuIGZhbHNlOworICAgIH0KKworICAgIHByb2R1Y3QgPSByZWFkbChiYXNl
KTsKKyAgICBjdXQgPSBwcm9kdWN0ICYgUkNBUl9DVVRfTUFTSzsKKyAgICBwcm9kdWN0ICY9IFJD
QVJfUFJPRFVDVF9NQVNLOworCisgICAgc3dpdGNoICggcHJvZHVjdCApCisgICAgeworICAgIGNh
c2UgUkNBUl9QUk9EVUNUX0gzOgorICAgIGNhc2UgUkNBUl9QUk9EVUNUX00zOgorICAgICAgICBp
ZiAoIGN1dCA+PSBSQ0FSX0NVVF9WRVIzMCApCisgICAgICAgICAgICBzdGFnZTJfc3VwcG9ydGVk
ID0gU1VQUE9SVEVEOworICAgICAgICBicmVhazsKKworICAgIGNhc2UgUkNBUl9QUk9EVUNUX00z
TjoKKyAgICAgICAgc3RhZ2UyX3N1cHBvcnRlZCA9IFNVUFBPUlRFRDsKKyAgICAgICAgYnJlYWs7
CisKKyAgICBkZWZhdWx0OgorICAgICAgICBwcmludGsoWEVOTE9HX0VSUiAiaXBtbXU6IFVuc3Vw
cG9ydGVkIFNvQyB2ZXJzaW9uXG4iKTsKKyAgICAgICAgYnJlYWs7CisgICAgfQorCisgICAgaW91
bm1hcChiYXNlKTsKKworICAgIHJldHVybiBzdGFnZTJfc3VwcG9ydGVkID09IFNVUFBPUlRFRDsK
K30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBkdF9kZXZpY2VfbWF0Y2ggaXBtbXVfZHRfbWF0Y2hb
XSBfX2luaXRjb25zdCA9Cit7CisgICAgRFRfTUFUQ0hfQ09NUEFUSUJMRSgicmVuZXNhcyxpcG1t
dS1yOGE3Nzk1IiksCisgICAgRFRfTUFUQ0hfQ09NUEFUSUJMRSgicmVuZXNhcyxpcG1tdS1yOGE3
Nzk2NSIpLAorICAgIERUX01BVENIX0NPTVBBVElCTEUoInJlbmVzYXMsaXBtbXUtcjhhNzc5NiIp
LAorICAgIHsgLyogc2VudGluZWwgKi8gfSwKK307CisKK3N0YXRpYyBfX2luaXQgaW50IGlwbW11
X2luaXQoc3RydWN0IGR0X2RldmljZV9ub2RlICpub2RlLCBjb25zdCB2b2lkICpkYXRhKQorewor
ICAgIGludCByZXQ7CisKKyAgICAvKgorICAgICAqIEV2ZW4gaWYgdGhlIGRldmljZSBjYW4ndCBi
ZSBpbml0aWFsaXplZCwgd2UgZG9uJ3Qgd2FudCB0byBnaXZlCisgICAgICogdGhlIElQTU1VIGRl
dmljZSB0byBkb20wLgorICAgICAqLworICAgIGR0X2RldmljZV9zZXRfdXNlZF9ieShub2RlLCBE
T01JRF9YRU4pOworCisgICAgaWYgKCAhaW9tbXVfaGFwX3B0X3NoYXJlICkKKyAgICB7CisgICAg
ICAgIHByaW50a19vbmNlKFhFTkxPR19FUlIgImlwbW11OiBQMk0gdGFibGUgbXVzdCBhbHdheXMg
YmUgc2hhcmVkIGJldHdlZW4gdGhlIENQVSBhbmQgdGhlIElQTU1VXG4iKTsKKyAgICAgICAgcmV0
dXJuIC1FSU5WQUw7CisgICAgfQorCisgICAgaWYgKCAhaXBtbXVfc3RhZ2UyX3N1cHBvcnRlZCgp
ICkKKyAgICB7CisgICAgICAgIHByaW50a19vbmNlKFhFTkxPR19FUlIgImlwbW11OiBQMk0gc2hh
cmluZyBpcyBub3Qgc3VwcG9ydGVkIGluIGN1cnJlbnQgU29DIHJldmlzaW9uXG4iKTsKKyAgICAg
ICAgcmV0dXJuIC1FT1BOT1RTVVBQOworICAgIH0KKyAgICBlbHNlCisgICAgeworICAgICAgICAv
KgorICAgICAgICAgKiBBcyA0LWxldmVsIHRyYW5zbGF0aW9uIHRhYmxlIGlzIG5vdCBzdXBwb3J0
ZWQgaW4gSVBNTVUsIHdlIG5lZWQKKyAgICAgICAgICogdG8gY2hlY2sgSVBBIHNpemUgdXNlZCBm
b3IgUDJNIHRhYmxlIGJlZm9yZWhhbmQgdG8gYmUgc3VyZSBpdCBpcworICAgICAgICAgKiAzLWxl
dmVsIGFuZCB0aGUgSVBNTVUgd2lsbCBiZSBhYmxlIHRvIHVzZSBpdC4KKyAgICAgICAgICoKKyAg
ICAgICAgICogVE9ETzogRmlyc3QgaW5pdGlhbGl6ZSB0aGUgSU9NTVUgYW5kIGdhdGhlciB0aGUg
cmVxdWlyZW1lbnRzIGFuZAorICAgICAgICAgKiB0aGVuIGluaXRpYWxpemUgdGhlIFAyTS4gSW4g
dGhlIFAyTSBjb2RlLCB0YWtlIGludG8gdGhlIGFjY291bnQKKyAgICAgICAgICogdGhlIElPTU1V
IHJlcXVpcmVtZW50cyBhbmQgcmVzdHJpY3QgInBhX3JhbmdlIiBpZiBuZWNlc3NhcnkuCisgICAg
ICAgICAqLworICAgICAgICBpZiAoIElQTU1VX01BWF9QMk1fSVBBX0JJVFMgPCBwMm1faXBhX2Jp
dHMgKQorICAgICAgICB7CisgICAgICAgICAgICBwcmludGtfb25jZShYRU5MT0dfRVJSICJpcG1t
dTogUDJNIElQQSBzaXplIGlzIG5vdCBzdXBwb3J0ZWQgKFAyTT0ldSBJUE1NVT0ldSkhXG4iLAor
ICAgICAgICAgICAgICAgICAgICAgICAgcDJtX2lwYV9iaXRzLCBJUE1NVV9NQVhfUDJNX0lQQV9C
SVRTKTsKKyAgICAgICAgICAgIHJldHVybiAtRU9QTk9UU1VQUDsKKyAgICAgICAgfQorICAgIH0K
KworICAgIHJldCA9IGlwbW11X3Byb2JlKG5vZGUpOworICAgIGlmICggcmV0ICkKKyAgICB7Cisg
ICAgICAgIGRldl9lcnIoJm5vZGUtPmRldiwgIkZhaWxlZCB0byBpbml0IElQTU1VICglZClcbiIs
IHJldCk7CisgICAgICAgIHJldHVybiByZXQ7CisgICAgfQorCisgICAgaW9tbXVfc2V0X29wcygm
aXBtbXVfaW9tbXVfb3BzKTsKKworICAgIHJldHVybiAwOworfQorCitEVF9ERVZJQ0VfU1RBUlQo
aXBtbXUsICJSZW5lc2FzIElQTU1VLVZNU0EiLCBERVZJQ0VfSU9NTVUpCisgICAgLmR0X21hdGNo
ID0gaXBtbXVfZHRfbWF0Y2gsCisgICAgLmluaXQgPSBpcG1tdV9pbml0LAorRFRfREVWSUNFX0VO
RAorCisvKgorICogTG9jYWwgdmFyaWFibGVzOgorICogbW9kZTogQworICogYy1maWxlLXN0eWxl
OiAiQlNEIgorICogYy1iYXNpYy1vZmZzZXQ6IDQKKyAqIGluZGVudC10YWJzLW1vZGU6IG5pbAor
ICogRW5kOgorICovCi0tIAoyLjcuNAoKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhl
bnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5m
by94ZW4tZGV2ZWw=

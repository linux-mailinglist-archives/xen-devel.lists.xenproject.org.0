Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id A168CFE5FA
	for <lists+xen-devel@lfdr.de>; Fri, 15 Nov 2019 20:48:24 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iVhY8-0002Hr-Lx; Fri, 15 Nov 2019 19:46:32 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=1SQg=ZH=gmail.com=rosbrookn@srs-us1.protection.inumbo.net>)
 id 1iVhY6-0002G5-J1
 for xen-devel@lists.xenproject.org; Fri, 15 Nov 2019 19:46:30 +0000
X-Inumbo-ID: 766537aa-07e0-11ea-9631-bc764e2007e4
Received: from mail-qk1-x72d.google.com (unknown [2607:f8b0:4864:20::72d])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 766537aa-07e0-11ea-9631-bc764e2007e4;
 Fri, 15 Nov 2019 19:45:22 +0000 (UTC)
Received: by mail-qk1-x72d.google.com with SMTP id h15so9013972qka.13
 for <xen-devel@lists.xenproject.org>; Fri, 15 Nov 2019 11:45:22 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=fnAElMGVjfn1KiVm1OcbEYUCfKqn8iqQYsCxCraHgQg=;
 b=U5TFIPe141YQHb1RISrdbHPm3C4caPZR/AQScQz/TFfFRqA2+3QtZexpRgAxO7wK96
 BMK32cC5BTIwWOLB0KbrwyJ+CD4sieHmdXOKtCQsVaOUQqXfa5kGb2vhhUtKnyGjfOJH
 zoWdZWOcPoK8PmAzO4Acd35E+H6yX7ZZpzC8C8VGMfHkGIr5zPl7C6TU1B86EaqsMYpt
 ayngKdL8LQSysCafXjFTWDbJdZCVx/dLvaRBCtYq6XEvpnTC03jwfydBppSaJTWhbZHo
 F2f/d26Q+soTobKIfcVaivRHdWgyGsDLaNPJYgQr5PdaJMXv0PsH4lkgomQ7PLNk1LnB
 ZSeA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=fnAElMGVjfn1KiVm1OcbEYUCfKqn8iqQYsCxCraHgQg=;
 b=gvqq1Wd+iyyONVLvhNOvLm2CasP527obc9tQuBrwLf6lX4mBUxgyGtl+8XzOAidBfs
 PXv+rUjXEq/tMKSKgz4xHSZ7L2WJdbD+ze4XgjCCuFBWA3DhqajOl22UE5oDKWJZnxFE
 KSQr65gIHPIHAmpkfVwybndDyG3KbtJUfKikx4UVUg6e0pFWihhNnBVa7g0+A8jacYPE
 1HQiDJvXUkOpNBk2oj9IeogAUI5j+RpD5ESi2l+k+JvtuL6gwb+hGcG+a7qhWbeBNfYM
 ZtNsLDNVJ956y2LVOBJY1cnw+lNgIX9seI9uT/PI2WC1XCchQqv36DUPLbQnvatYoUdH
 SlAg==
X-Gm-Message-State: APjAAAXd2sMB/sOaffVd/GrGXM/SxKMqsOm9ju2hq5or8+D2XklEPF5c
 5JYaugMMw2FYAnswBNZoULprfXUZ
X-Google-Smtp-Source: APXvYqyYyJUIxSYu/AsVlLpgAW7jdRZ3fEza9PAgonhUcEQqJAyef+sER2ZXkrf8C8itbkS91cRHZQ==
X-Received: by 2002:ae9:e201:: with SMTP id c1mr14185070qkc.416.1573847122023; 
 Fri, 15 Nov 2019 11:45:22 -0800 (PST)
Received: from five.crux.rad.ainfosec.com (209-217-208-226.northland.net.
 [209.217.208.226])
 by smtp.googlemail.com with ESMTPSA id y10sm4649679qkb.55.2019.11.15.11.45.20
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Fri, 15 Nov 2019 11:45:21 -0800 (PST)
From: Nick Rosbrook <rosbrookn@gmail.com>
To: xen-devel@lists.xenproject.org
Date: Fri, 15 Nov 2019 14:44:26 -0500
Message-Id: <e059da181cd4c1997d24113dac8cb04c510d83b9.1573840474.git.rosbrookn@ainfosec.com>
X-Mailer: git-send-email 2.19.1
In-Reply-To: <cover.1573840473.git.rosbrookn@ainfosec.com>
References: <cover.1573840473.git.rosbrookn@ainfosec.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v2 19/22] golang/xenlight: implement keyed union
 Go to C marshaling
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Nick Rosbrook <rosbrookn@ainfosec.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, kerriganb@ainfosec.com,
 George Dunlap <george.dunlap@citrix.com>, Wei Liu <wl@xen.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

RnJvbTogTmljayBSb3Nicm9vayA8cm9zYnJvb2tuQGFpbmZvc2VjLmNvbT4KClNpbmNlIHRoZSBD
IHVuaW9uIGNhbm5vdCBiZSBkaXJlY3RseSBwb3B1bGF0ZWQsIHBvcHVsYXRlIHRoZSBmaWVsZHMg
b2YgdGhlCmNvcnJlc3BvbmRpbmcgQyBzdHJ1Y3QgZGVmaW5lZCBpbiB0aGUgY2dvIHByZWFtYmxl
LCBhbmQgdGhlbiBjb3B5IHRoYXQKc3RydWN0IGFzIGJ5dGVzIGludG8gdGhlIGJ5dGUgc2xpY2Ug
dGhhdCBHbyB1c2VzIGFzIHRoZSB1bmlvbi4KClNpZ25lZC1vZmYtYnk6IE5pY2sgUm9zYnJvb2sg
PHJvc2Jyb29rbkBhaW5mb3NlYy5jb20+Ci0tLQogdG9vbHMvZ29sYW5nL3hlbmxpZ2h0L2dlbmdv
dHlwZXMucHkgIHwgIDc3ICsrKysrKy0KIHRvb2xzL2dvbGFuZy94ZW5saWdodC9oZWxwZXJzLmdl
bi5nbyB8IDMyNSArKysrKysrKysrKysrKysrKysrKysrKysrKysKIDIgZmlsZXMgY2hhbmdlZCwg
NDAwIGluc2VydGlvbnMoKyksIDIgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvdG9vbHMvZ29s
YW5nL3hlbmxpZ2h0L2dlbmdvdHlwZXMucHkgYi90b29scy9nb2xhbmcveGVubGlnaHQvZ2VuZ290
eXBlcy5weQppbmRleCAxNTIyNjMzZjgzLi41ZmEwNzBiMzIwIDEwMDY0NAotLS0gYS90b29scy9n
b2xhbmcveGVubGlnaHQvZ2VuZ290eXBlcy5weQorKysgYi90b29scy9nb2xhbmcveGVubGlnaHQv
Z2VuZ290eXBlcy5weQpAQCAtNTQ2LDggKzU0Niw3IEBAIGRlZiB4ZW5saWdodF9nb2xhbmdfZGVm
aW5lX3RvX0ModHkgPSBOb25lLCB0eXBlbmFtZSA9IE5vbmUsIG5lc3RlZCA9IEZhbHNlKToKICAg
ICAgICAgICAgIHMgKz0geGVubGlnaHRfZ29sYW5nX2RlZmluZV90b19DKGYudHlwZSwgdHlwZW5h
bWU9Zi5uYW1lLCBuZXN0ZWQ9VHJ1ZSkKIAogICAgICAgICBlbGlmIGlzaW5zdGFuY2UoZi50eXBl
LCBpZGwuS2V5ZWRVbmlvbik6Ci0gICAgICAgICAgICAjIFRPRE8KLSAgICAgICAgICAgIHBhc3MK
KyAgICAgICAgICAgIHMgKz0geGVubGlnaHRfZ29sYW5nX3VuaW9uX3RvX0MoZi50eXBlLCBmLm5h
bWUsIHR5LnR5cGVuYW1lLCB0eS5kaXNwb3NlX2ZuKQogCiAgICAgICAgIGVsc2U6CiAgICAgICAg
ICAgICByYWlzZSBFeGNlcHRpb24oJ3R5cGUge30gbm90IHN1cHBvcnRlZCcuZm9ybWF0KGYudHlw
ZSkpCkBAIC01NTgsNiArNTU3LDgwIEBAIGRlZiB4ZW5saWdodF9nb2xhbmdfZGVmaW5lX3RvX0Mo
dHkgPSBOb25lLCB0eXBlbmFtZSA9IE5vbmUsIG5lc3RlZCA9IEZhbHNlKToKIAogICAgIHJldHVy
biBzCiAKK2RlZiB4ZW5saWdodF9nb2xhbmdfdW5pb25fdG9fQyh0eSA9IE5vbmUsIHVuaW9uX25h
bWUgPSAnJywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3RfbmFtZSA9ICcn
LCBkaXNwb3NlX2ZuID0gJycpOgorICAgIGtleW5hbWUgICA9IHR5LmtleXZhci5uYW1lCisgICAg
Z29rZXluYW1lID0geGVubGlnaHRfZ29sYW5nX2ZtdF9uYW1lKGtleW5hbWUpCisgICAga2V5dHlw
ZSAgID0gdHkua2V5dmFyLnR5cGUudHlwZW5hbWUKKyAgICBnb2tleXR5cGUgPSB4ZW5saWdodF9n
b2xhbmdfZm10X25hbWUoa2V5dHlwZSkKKworICAgIGludGVyZmFjZV9uYW1lID0gJ3t9X3t9X3Vu
aW9uJy5mb3JtYXQoc3RydWN0X25hbWUsIGtleW5hbWUpCisgICAgaW50ZXJmYWNlX25hbWUgPSB4
ZW5saWdodF9nb2xhbmdfZm10X25hbWUoaW50ZXJmYWNlX25hbWUsIGV4cG9ydGVkPUZhbHNlKQor
CisgICAgY2dvX2tleW5hbWUgPSBrZXluYW1lCisgICAgaWYgY2dvX2tleW5hbWUgaW4gZ29fa2V5
d29yZHM6CisgICAgICAgIGNnb19rZXluYW1lID0gJ18nICsgY2dvX2tleW5hbWUKKworCisgICAg
cyA9ICd4Yy57fSA9IEMue30oeC57fSlcbicuZm9ybWF0KGNnb19rZXluYW1lLGtleXR5cGUsZ29r
ZXluYW1lKQorICAgIHMgKz0gJ3N3aXRjaCB4Lnt9e3tcbicuZm9ybWF0KGdva2V5bmFtZSkKKwor
ICAgICMgQ3JlYXRlIHN3aXRjaCBzdGF0ZW1lbnQgdG8gZGV0ZXJtaW5lIGhvdyB0byBwb3B1bGF0
ZSB0aGUgQyB1bmlvbi4KKyAgICBmb3IgZiBpbiB0eS5maWVsZHM6CisgICAgICAgIGtleV92YWwg
PSAne31fe30nLmZvcm1hdChrZXl0eXBlLCBmLm5hbWUpCisgICAgICAgIGtleV92YWwgPSB4ZW5s
aWdodF9nb2xhbmdfZm10X25hbWUoa2V5X3ZhbCkKKyAgICAgICAgaWYgZi50eXBlIGlzIE5vbmU6
CisgICAgICAgICAgICBjb250aW51ZQorCisgICAgICAgIHMgKz0gJ2Nhc2Uge306XG4nLmZvcm1h
dChrZXlfdmFsKQorICAgICAgICBjZ290eXBlID0gJ3t9X3t9X3VuaW9uX3t9Jy5mb3JtYXQoc3Ry
dWN0X25hbWUsa2V5bmFtZSxmLm5hbWUpCisgICAgICAgIGdvdHlwZSAgPSB4ZW5saWdodF9nb2xh
bmdfZm10X25hbWUoY2dvdHlwZSkKKyAgICAgICAgZ29uYW1lICA9ICd7fV97fScuZm9ybWF0KGtl
eW5hbWUsZi5uYW1lKQorICAgICAgICBnb25hbWUgID0geGVubGlnaHRfZ29sYW5nX2ZtdF9uYW1l
KGdvbmFtZSxleHBvcnRlZD1GYWxzZSkKKworICAgICAgICBmaWVsZF9uYW1lID0geGVubGlnaHRf
Z29sYW5nX2ZtdF9uYW1lKCd7fV91bmlvbicuZm9ybWF0KGtleW5hbWUpKQorICAgICAgICBzICs9
ICd0bXAsIG9rIDo9IHgue30uKHt9KVxuJy5mb3JtYXQoZmllbGRfbmFtZSxnb3R5cGUpCisgICAg
ICAgIHMgKz0gJ2lmICFvayB7XG4nCisgICAgICAgIHMgKz0gJ0Mue30oJnhjKVxuJy5mb3JtYXQo
ZGlzcG9zZV9mbikKKyAgICAgICAgcyArPSAncmV0dXJuIHhjLGVycm9ycy5OZXcoIndyb25nIHR5
cGUgZm9yIHVuaW9uIGtleSB7fSIpXG4nLmZvcm1hdChrZXluYW1lKQorICAgICAgICBzICs9ICd9
XG4nCisKKyAgICAgICAgcyArPSAndmFyIHt9IEMue31cbicuZm9ybWF0KGYubmFtZSxjZ290eXBl
KQorICAgICAgICBmb3IgdWYgaW4gZi50eXBlLmZpZWxkczoKKyAgICAgICAgICAgIGdvdHlwZW5h
bWUgPSB4ZW5saWdodF9nb2xhbmdfZm10X25hbWUodWYudHlwZS50eXBlbmFtZSkKKyAgICAgICAg
ICAgIGN0eXBlbmFtZSAgPSB1Zi50eXBlLnR5cGVuYW1lCisgICAgICAgICAgICBnb2ZuYW1lICAg
ID0geGVubGlnaHRfZ29sYW5nX2ZtdF9uYW1lKHVmLm5hbWUpCisKKyAgICAgICAgICAgIGlzX2Nh
c3RhYmxlID0gKHVmLnR5cGUuanNvbl9wYXJzZV90eXBlID09ICdKU09OX0lOVEVHRVInIG9yCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICBpc2luc3RhbmNlKHVmLnR5cGUsIGlkbC5FbnVtZXJh
dGlvbikgb3IKKyAgICAgICAgICAgICAgICAgICAgICAgICAgIGdvdHlwZW5hbWUgaW4gZ29fYnVp
bHRpbl90eXBlcykKKworICAgICAgICAgICAgaWYgbm90IGlzX2Nhc3RhYmxlOgorICAgICAgICAg
ICAgICAgIHMgKz0gJ3t9Lnt9LCBlcnIgPSB0bXAue30udG9DKClcbicuZm9ybWF0KGYubmFtZSx1
Zi5uYW1lLGdvZm5hbWUpCisgICAgICAgICAgICAgICAgcyArPSAnaWYgZXJyICE9IG5pbCB7XG4n
CisgICAgICAgICAgICAgICAgcyArPSAnQy57fSgmeGMpXG4nLmZvcm1hdChkaXNwb3NlX2ZuKQor
ICAgICAgICAgICAgICAgIHMgKz0gJ3JldHVybiB4YyxlcnIgXG59XG4nCisKKyAgICAgICAgICAg
IGVsaWYgZ290eXBlbmFtZSA9PSAnc3RyaW5nJzoKKyAgICAgICAgICAgICAgICBzICs9ICd7fS57
fSA9IEMuQ1N0cmluZyh0bXAue30pXG4nLmZvcm1hdChmLm5hbWUsdWYubmFtZSxnb2ZuYW1lKQor
CisgICAgICAgICAgICBlbHNlOgorICAgICAgICAgICAgICAgIHMgKz0gJ3t9Lnt9ID0gQy57fSh0
bXAue30pXG4nLmZvcm1hdChmLm5hbWUsdWYubmFtZSxjdHlwZW5hbWUsZ29mbmFtZSkKKworICAg
ICAgICAjIFRoZSB1bmlvbiBpcyBzdGlsbCByZXByZXNlbnRlZCBhcyBHbyBbXWJ5dGUuCisgICAg
ICAgIHMgKz0gJ3t9Qnl0ZXMgOj0gQy5Hb0J5dGVzKHVuc2FmZS5Qb2ludGVyKCZ7fSksQy5zaXpl
b2Zfe30pXG4nLmZvcm1hdChmLm5hbWUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLm5hbWUsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBjZ290eXBlKQorICAgICAgICBzICs9ICdjb3B5KHhjLnt9Wzpd
LHt9Qnl0ZXMpXG4nLmZvcm1hdCh1bmlvbl9uYW1lLGYubmFtZSkKKworICAgICMgRW5kIHN3aXRj
aCBzdGF0ZW1lbnQKKyAgICBzICs9ICdkZWZhdWx0OlxuJworICAgIGVycl9zdHJpbmcgPSAnImlu
dmFsaWQgdW5pb24ga2V5IFwnJXZcJyIsIHgue30nLmZvcm1hdChnb2tleW5hbWUpCisgICAgcyAr
PSAncmV0dXJuIHhjLCBmbXQuRXJyb3JmKHt9KScuZm9ybWF0KGVycl9zdHJpbmcpCisgICAgcyAr
PSAnfVxuJworCisgICAgcmV0dXJuIHMKKwogZGVmIHhlbmxpZ2h0X2dvbGFuZ19mbXRfbmFtZShu
YW1lLCBleHBvcnRlZCA9IFRydWUpOgogICAgICIiIgogICAgIFRha2UgYSBnaXZlbiB0eXBlIG5h
bWUgYW5kIHJldHVybiBhbgpkaWZmIC0tZ2l0IGEvdG9vbHMvZ29sYW5nL3hlbmxpZ2h0L2hlbHBl
cnMuZ2VuLmdvIGIvdG9vbHMvZ29sYW5nL3hlbmxpZ2h0L2hlbHBlcnMuZ2VuLmdvCmluZGV4IDQ5
NTYwMWY3MzguLmJjOTRlMTNkNzAgMTAwNjQ0Ci0tLSBhL3Rvb2xzL2dvbGFuZy94ZW5saWdodC9o
ZWxwZXJzLmdlbi5nbworKysgYi90b29scy9nb2xhbmcveGVubGlnaHQvaGVscGVycy5nZW4uZ28K
QEAgLTQzMyw2ICs0MzMsMjEgQEAgZnVuYyAoeCAqQ2hhbm5lbGluZm8pIHRvQygpICh4YyBDLmxp
YnhsX2NoYW5uZWxpbmZvLCBlcnIgZXJyb3IpIHsKIAl4Yy5zdGF0ZSA9IEMuaW50KHguU3RhdGUp
CiAJeGMuZXZ0Y2ggPSBDLmludCh4LkV2dGNoKQogCXhjLnJyZWYgPSBDLmludCh4LlJyZWYpCisJ
eGMuY29ubmVjdGlvbiA9IEMubGlieGxfY2hhbm5lbF9jb25uZWN0aW9uKHguQ29ubmVjdGlvbikK
Kwlzd2l0Y2ggeC5Db25uZWN0aW9uIHsKKwljYXNlIENoYW5uZWxDb25uZWN0aW9uUHR5OgorCQl0
bXAsIG9rIDo9IHguQ29ubmVjdGlvblVuaW9uLihDaGFubmVsaW5mb0Nvbm5lY3Rpb25VbmlvblB0
eSkKKwkJaWYgIW9rIHsKKwkJCUMubGlieGxfY2hhbm5lbGluZm9fZGlzcG9zZSgmeGMpCisJCQly
ZXR1cm4geGMsIGVycm9ycy5OZXcoIndyb25nIHR5cGUgZm9yIHVuaW9uIGtleSBjb25uZWN0aW9u
IikKKwkJfQorCQl2YXIgcHR5IEMubGlieGxfY2hhbm5lbGluZm9fY29ubmVjdGlvbl91bmlvbl9w
dHkKKwkJcHR5LnBhdGggPSBDLkNTdHJpbmcodG1wLlBhdGgpCisJCXB0eUJ5dGVzIDo9IEMuR29C
eXRlcyh1bnNhZmUuUG9pbnRlcigmcHR5KSwgQy5zaXplb2ZfbGlieGxfY2hhbm5lbGluZm9fY29u
bmVjdGlvbl91bmlvbl9wdHkpCisJCWNvcHkoeGMudVs6XSwgcHR5Qnl0ZXMpCisJZGVmYXVsdDoK
KwkJcmV0dXJuIHhjLCBmbXQuRXJyb3JmKCJpbnZhbGlkIHVuaW9uIGtleSAnJXYnIiwgeC5Db25u
ZWN0aW9uKQorCX0KIAlyZXR1cm4geGMsIG5pbAogfQogCkBAIC0xMTg0LDYgKzExOTksMjE2IEBA
IGZ1bmMgKHggKkRvbWFpbkJ1aWxkSW5mbykgdG9DKCkgKHhjIEMubGlieGxfZG9tYWluX2J1aWxk
X2luZm8sIGVyciBlcnJvcikgewogCQlyZXR1cm4geGMsIGVycgogCX0KIAl4Yy50ZWUgPSBDLmxp
YnhsX3RlZV90eXBlKHguVGVlKQorCXhjLl90eXBlID0gQy5saWJ4bF9kb21haW5fdHlwZSh4LlR5
cGUpCisJc3dpdGNoIHguVHlwZSB7CisJY2FzZSBEb21haW5UeXBlSHZtOgorCQl0bXAsIG9rIDo9
IHguVHlwZVVuaW9uLihEb21haW5CdWlsZEluZm9UeXBlVW5pb25Idm0pCisJCWlmICFvayB7CisJ
CQlDLmxpYnhsX2RvbWFpbl9idWlsZF9pbmZvX2Rpc3Bvc2UoJnhjKQorCQkJcmV0dXJuIHhjLCBl
cnJvcnMuTmV3KCJ3cm9uZyB0eXBlIGZvciB1bmlvbiBrZXkgdHlwZSIpCisJCX0KKwkJdmFyIGh2
bSBDLmxpYnhsX2RvbWFpbl9idWlsZF9pbmZvX3R5cGVfdW5pb25faHZtCisJCWh2bS5maXJtd2Fy
ZSA9IEMuQ1N0cmluZyh0bXAuRmlybXdhcmUpCisJCWh2bS5iaW9zID0gQy5saWJ4bF9iaW9zX3R5
cGUodG1wLkJpb3MpCisJCWh2bS5wYWUsIGVyciA9IHRtcC5QYWUudG9DKCkKKwkJaWYgZXJyICE9
IG5pbCB7CisJCQlDLmxpYnhsX2RvbWFpbl9idWlsZF9pbmZvX2Rpc3Bvc2UoJnhjKQorCQkJcmV0
dXJuIHhjLCBlcnIKKwkJfQorCQlodm0uYXBpYywgZXJyID0gdG1wLkFwaWMudG9DKCkKKwkJaWYg
ZXJyICE9IG5pbCB7CisJCQlDLmxpYnhsX2RvbWFpbl9idWlsZF9pbmZvX2Rpc3Bvc2UoJnhjKQor
CQkJcmV0dXJuIHhjLCBlcnIKKwkJfQorCQlodm0uYWNwaSwgZXJyID0gdG1wLkFjcGkudG9DKCkK
KwkJaWYgZXJyICE9IG5pbCB7CisJCQlDLmxpYnhsX2RvbWFpbl9idWlsZF9pbmZvX2Rpc3Bvc2Uo
JnhjKQorCQkJcmV0dXJuIHhjLCBlcnIKKwkJfQorCQlodm0uYWNwaV9zMywgZXJyID0gdG1wLkFj
cGlTMy50b0MoKQorCQlpZiBlcnIgIT0gbmlsIHsKKwkJCUMubGlieGxfZG9tYWluX2J1aWxkX2lu
Zm9fZGlzcG9zZSgmeGMpCisJCQlyZXR1cm4geGMsIGVycgorCQl9CisJCWh2bS5hY3BpX3M0LCBl
cnIgPSB0bXAuQWNwaVM0LnRvQygpCisJCWlmIGVyciAhPSBuaWwgeworCQkJQy5saWJ4bF9kb21h
aW5fYnVpbGRfaW5mb19kaXNwb3NlKCZ4YykKKwkJCXJldHVybiB4YywgZXJyCisJCX0KKwkJaHZt
LmFjcGlfbGFwdG9wX3NsYXRlLCBlcnIgPSB0bXAuQWNwaUxhcHRvcFNsYXRlLnRvQygpCisJCWlm
IGVyciAhPSBuaWwgeworCQkJQy5saWJ4bF9kb21haW5fYnVpbGRfaW5mb19kaXNwb3NlKCZ4YykK
KwkJCXJldHVybiB4YywgZXJyCisJCX0KKwkJaHZtLm54LCBlcnIgPSB0bXAuTngudG9DKCkKKwkJ
aWYgZXJyICE9IG5pbCB7CisJCQlDLmxpYnhsX2RvbWFpbl9idWlsZF9pbmZvX2Rpc3Bvc2UoJnhj
KQorCQkJcmV0dXJuIHhjLCBlcnIKKwkJfQorCQlodm0udmlyaWRpYW4sIGVyciA9IHRtcC5WaXJp
ZGlhbi50b0MoKQorCQlpZiBlcnIgIT0gbmlsIHsKKwkJCUMubGlieGxfZG9tYWluX2J1aWxkX2lu
Zm9fZGlzcG9zZSgmeGMpCisJCQlyZXR1cm4geGMsIGVycgorCQl9CisJCWh2bS52aXJpZGlhbl9l
bmFibGUsIGVyciA9IHRtcC5WaXJpZGlhbkVuYWJsZS50b0MoKQorCQlpZiBlcnIgIT0gbmlsIHsK
KwkJCUMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fZGlzcG9zZSgmeGMpCisJCQlyZXR1cm4geGMs
IGVycgorCQl9CisJCWh2bS52aXJpZGlhbl9kaXNhYmxlLCBlcnIgPSB0bXAuVmlyaWRpYW5EaXNh
YmxlLnRvQygpCisJCWlmIGVyciAhPSBuaWwgeworCQkJQy5saWJ4bF9kb21haW5fYnVpbGRfaW5m
b19kaXNwb3NlKCZ4YykKKwkJCXJldHVybiB4YywgZXJyCisJCX0KKwkJaHZtLnRpbWVvZmZzZXQg
PSBDLkNTdHJpbmcodG1wLlRpbWVvZmZzZXQpCisJCWh2bS5ocGV0LCBlcnIgPSB0bXAuSHBldC50
b0MoKQorCQlpZiBlcnIgIT0gbmlsIHsKKwkJCUMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fZGlz
cG9zZSgmeGMpCisJCQlyZXR1cm4geGMsIGVycgorCQl9CisJCWh2bS52cHRfYWxpZ24sIGVyciA9
IHRtcC5WcHRBbGlnbi50b0MoKQorCQlpZiBlcnIgIT0gbmlsIHsKKwkJCUMubGlieGxfZG9tYWlu
X2J1aWxkX2luZm9fZGlzcG9zZSgmeGMpCisJCQlyZXR1cm4geGMsIGVycgorCQl9CisJCWh2bS5t
bWlvX2hvbGVfbWVta2IgPSBDLnVpbnQ2NF90KHRtcC5NbWlvSG9sZU1lbWtiKQorCQlodm0udGlt
ZXJfbW9kZSA9IEMubGlieGxfdGltZXJfbW9kZSh0bXAuVGltZXJNb2RlKQorCQlodm0ubmVzdGVk
X2h2bSwgZXJyID0gdG1wLk5lc3RlZEh2bS50b0MoKQorCQlpZiBlcnIgIT0gbmlsIHsKKwkJCUMu
bGlieGxfZG9tYWluX2J1aWxkX2luZm9fZGlzcG9zZSgmeGMpCisJCQlyZXR1cm4geGMsIGVycgor
CQl9CisJCWh2bS5hbHRwMm0sIGVyciA9IHRtcC5BbHRwMk0udG9DKCkKKwkJaWYgZXJyICE9IG5p
bCB7CisJCQlDLmxpYnhsX2RvbWFpbl9idWlsZF9pbmZvX2Rpc3Bvc2UoJnhjKQorCQkJcmV0dXJu
IHhjLCBlcnIKKwkJfQorCQlodm0uc3lzdGVtX2Zpcm13YXJlID0gQy5DU3RyaW5nKHRtcC5TeXN0
ZW1GaXJtd2FyZSkKKwkJaHZtLnNtYmlvc19maXJtd2FyZSA9IEMuQ1N0cmluZyh0bXAuU21iaW9z
RmlybXdhcmUpCisJCWh2bS5hY3BpX2Zpcm13YXJlID0gQy5DU3RyaW5nKHRtcC5BY3BpRmlybXdh
cmUpCisJCWh2bS5oZHR5cGUgPSBDLmxpYnhsX2hkdHlwZSh0bXAuSGR0eXBlKQorCQlodm0ubm9n
cmFwaGljLCBlcnIgPSB0bXAuTm9ncmFwaGljLnRvQygpCisJCWlmIGVyciAhPSBuaWwgeworCQkJ
Qy5saWJ4bF9kb21haW5fYnVpbGRfaW5mb19kaXNwb3NlKCZ4YykKKwkJCXJldHVybiB4YywgZXJy
CisJCX0KKwkJaHZtLnZnYSwgZXJyID0gdG1wLlZnYS50b0MoKQorCQlpZiBlcnIgIT0gbmlsIHsK
KwkJCUMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fZGlzcG9zZSgmeGMpCisJCQlyZXR1cm4geGMs
IGVycgorCQl9CisJCWh2bS52bmMsIGVyciA9IHRtcC5WbmMudG9DKCkKKwkJaWYgZXJyICE9IG5p
bCB7CisJCQlDLmxpYnhsX2RvbWFpbl9idWlsZF9pbmZvX2Rpc3Bvc2UoJnhjKQorCQkJcmV0dXJu
IHhjLCBlcnIKKwkJfQorCQlodm0ua2V5bWFwID0gQy5DU3RyaW5nKHRtcC5LZXltYXApCisJCWh2
bS5zZGwsIGVyciA9IHRtcC5TZGwudG9DKCkKKwkJaWYgZXJyICE9IG5pbCB7CisJCQlDLmxpYnhs
X2RvbWFpbl9idWlsZF9pbmZvX2Rpc3Bvc2UoJnhjKQorCQkJcmV0dXJuIHhjLCBlcnIKKwkJfQor
CQlodm0uc3BpY2UsIGVyciA9IHRtcC5TcGljZS50b0MoKQorCQlpZiBlcnIgIT0gbmlsIHsKKwkJ
CUMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fZGlzcG9zZSgmeGMpCisJCQlyZXR1cm4geGMsIGVy
cgorCQl9CisJCWh2bS5nZnhfcGFzc3RocnUsIGVyciA9IHRtcC5HZnhQYXNzdGhydS50b0MoKQor
CQlpZiBlcnIgIT0gbmlsIHsKKwkJCUMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fZGlzcG9zZSgm
eGMpCisJCQlyZXR1cm4geGMsIGVycgorCQl9CisJCWh2bS5nZnhfcGFzc3RocnVfa2luZCA9IEMu
bGlieGxfZ2Z4X3Bhc3N0aHJ1X2tpbmQodG1wLkdmeFBhc3N0aHJ1S2luZCkKKwkJaHZtLnNlcmlh
bCA9IEMuQ1N0cmluZyh0bXAuU2VyaWFsKQorCQlodm0uYm9vdCA9IEMuQ1N0cmluZyh0bXAuQm9v
dCkKKwkJaHZtLnVzYiwgZXJyID0gdG1wLlVzYi50b0MoKQorCQlpZiBlcnIgIT0gbmlsIHsKKwkJ
CUMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fZGlzcG9zZSgmeGMpCisJCQlyZXR1cm4geGMsIGVy
cgorCQl9CisJCWh2bS51c2J2ZXJzaW9uID0gQy5pbnQodG1wLlVzYnZlcnNpb24pCisJCWh2bS51
c2JkZXZpY2UgPSBDLkNTdHJpbmcodG1wLlVzYmRldmljZSkKKwkJaHZtLnZrYl9kZXZpY2UsIGVy
ciA9IHRtcC5Wa2JEZXZpY2UudG9DKCkKKwkJaWYgZXJyICE9IG5pbCB7CisJCQlDLmxpYnhsX2Rv
bWFpbl9idWlsZF9pbmZvX2Rpc3Bvc2UoJnhjKQorCQkJcmV0dXJuIHhjLCBlcnIKKwkJfQorCQlo
dm0uc291bmRodyA9IEMuQ1N0cmluZyh0bXAuU291bmRodykKKwkJaHZtLnhlbl9wbGF0Zm9ybV9w
Y2ksIGVyciA9IHRtcC5YZW5QbGF0Zm9ybVBjaS50b0MoKQorCQlpZiBlcnIgIT0gbmlsIHsKKwkJ
CUMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fZGlzcG9zZSgmeGMpCisJCQlyZXR1cm4geGMsIGVy
cgorCQl9CisJCWh2bS51c2JkZXZpY2VfbGlzdCwgZXJyID0gdG1wLlVzYmRldmljZUxpc3QudG9D
KCkKKwkJaWYgZXJyICE9IG5pbCB7CisJCQlDLmxpYnhsX2RvbWFpbl9idWlsZF9pbmZvX2Rpc3Bv
c2UoJnhjKQorCQkJcmV0dXJuIHhjLCBlcnIKKwkJfQorCQlodm0udmVuZG9yX2RldmljZSA9IEMu
bGlieGxfdmVuZG9yX2RldmljZSh0bXAuVmVuZG9yRGV2aWNlKQorCQlodm0ubXNfdm1fZ2VuaWQs
IGVyciA9IHRtcC5Nc1ZtR2VuaWQudG9DKCkKKwkJaWYgZXJyICE9IG5pbCB7CisJCQlDLmxpYnhs
X2RvbWFpbl9idWlsZF9pbmZvX2Rpc3Bvc2UoJnhjKQorCQkJcmV0dXJuIHhjLCBlcnIKKwkJfQor
CQlodm0uc2VyaWFsX2xpc3QsIGVyciA9IHRtcC5TZXJpYWxMaXN0LnRvQygpCisJCWlmIGVyciAh
PSBuaWwgeworCQkJQy5saWJ4bF9kb21haW5fYnVpbGRfaW5mb19kaXNwb3NlKCZ4YykKKwkJCXJl
dHVybiB4YywgZXJyCisJCX0KKwkJaHZtLnJkbSwgZXJyID0gdG1wLlJkbS50b0MoKQorCQlpZiBl
cnIgIT0gbmlsIHsKKwkJCUMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fZGlzcG9zZSgmeGMpCisJ
CQlyZXR1cm4geGMsIGVycgorCQl9CisJCWh2bS5yZG1fbWVtX2JvdW5kYXJ5X21lbWtiID0gQy51
aW50NjRfdCh0bXAuUmRtTWVtQm91bmRhcnlNZW1rYikKKwkJaHZtLm1jYV9jYXBzID0gQy51aW50
NjRfdCh0bXAuTWNhQ2FwcykKKwkJaHZtQnl0ZXMgOj0gQy5Hb0J5dGVzKHVuc2FmZS5Qb2ludGVy
KCZodm0pLCBDLnNpemVvZl9saWJ4bF9kb21haW5fYnVpbGRfaW5mb190eXBlX3VuaW9uX2h2bSkK
KwkJY29weSh4Yy51WzpdLCBodm1CeXRlcykKKwljYXNlIERvbWFpblR5cGVQdjoKKwkJdG1wLCBv
ayA6PSB4LlR5cGVVbmlvbi4oRG9tYWluQnVpbGRJbmZvVHlwZVVuaW9uUHYpCisJCWlmICFvayB7
CisJCQlDLmxpYnhsX2RvbWFpbl9idWlsZF9pbmZvX2Rpc3Bvc2UoJnhjKQorCQkJcmV0dXJuIHhj
LCBlcnJvcnMuTmV3KCJ3cm9uZyB0eXBlIGZvciB1bmlvbiBrZXkgdHlwZSIpCisJCX0KKwkJdmFy
IHB2IEMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fdHlwZV91bmlvbl9wdgorCQlwdi5rZXJuZWwg
PSBDLkNTdHJpbmcodG1wLktlcm5lbCkKKwkJcHYuc2xhY2tfbWVta2IgPSBDLnVpbnQ2NF90KHRt
cC5TbGFja01lbWtiKQorCQlwdi5ib290bG9hZGVyID0gQy5DU3RyaW5nKHRtcC5Cb290bG9hZGVy
KQorCQlwdi5ib290bG9hZGVyX2FyZ3MsIGVyciA9IHRtcC5Cb290bG9hZGVyQXJncy50b0MoKQor
CQlpZiBlcnIgIT0gbmlsIHsKKwkJCUMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fZGlzcG9zZSgm
eGMpCisJCQlyZXR1cm4geGMsIGVycgorCQl9CisJCXB2LmNtZGxpbmUgPSBDLkNTdHJpbmcodG1w
LkNtZGxpbmUpCisJCXB2LnJhbWRpc2sgPSBDLkNTdHJpbmcodG1wLlJhbWRpc2spCisJCXB2LmZl
YXR1cmVzID0gQy5DU3RyaW5nKHRtcC5GZWF0dXJlcykKKwkJcHYuZTgyMF9ob3N0LCBlcnIgPSB0
bXAuRTgyMEhvc3QudG9DKCkKKwkJaWYgZXJyICE9IG5pbCB7CisJCQlDLmxpYnhsX2RvbWFpbl9i
dWlsZF9pbmZvX2Rpc3Bvc2UoJnhjKQorCQkJcmV0dXJuIHhjLCBlcnIKKwkJfQorCQlwdkJ5dGVz
IDo9IEMuR29CeXRlcyh1bnNhZmUuUG9pbnRlcigmcHYpLCBDLnNpemVvZl9saWJ4bF9kb21haW5f
YnVpbGRfaW5mb190eXBlX3VuaW9uX3B2KQorCQljb3B5KHhjLnVbOl0sIHB2Qnl0ZXMpCisJY2Fz
ZSBEb21haW5UeXBlUHZoOgorCQl0bXAsIG9rIDo9IHguVHlwZVVuaW9uLihEb21haW5CdWlsZElu
Zm9UeXBlVW5pb25QdmgpCisJCWlmICFvayB7CisJCQlDLmxpYnhsX2RvbWFpbl9idWlsZF9pbmZv
X2Rpc3Bvc2UoJnhjKQorCQkJcmV0dXJuIHhjLCBlcnJvcnMuTmV3KCJ3cm9uZyB0eXBlIGZvciB1
bmlvbiBrZXkgdHlwZSIpCisJCX0KKwkJdmFyIHB2aCBDLmxpYnhsX2RvbWFpbl9idWlsZF9pbmZv
X3R5cGVfdW5pb25fcHZoCisJCXB2aC5wdnNoaW0sIGVyciA9IHRtcC5QdnNoaW0udG9DKCkKKwkJ
aWYgZXJyICE9IG5pbCB7CisJCQlDLmxpYnhsX2RvbWFpbl9idWlsZF9pbmZvX2Rpc3Bvc2UoJnhj
KQorCQkJcmV0dXJuIHhjLCBlcnIKKwkJfQorCQlwdmgucHZzaGltX3BhdGggPSBDLkNTdHJpbmco
dG1wLlB2c2hpbVBhdGgpCisJCXB2aC5wdnNoaW1fY21kbGluZSA9IEMuQ1N0cmluZyh0bXAuUHZz
aGltQ21kbGluZSkKKwkJcHZoLnB2c2hpbV9leHRyYSA9IEMuQ1N0cmluZyh0bXAuUHZzaGltRXh0
cmEpCisJCXB2aEJ5dGVzIDo9IEMuR29CeXRlcyh1bnNhZmUuUG9pbnRlcigmcHZoKSwgQy5zaXpl
b2ZfbGlieGxfZG9tYWluX2J1aWxkX2luZm9fdHlwZV91bmlvbl9wdmgpCisJCWNvcHkoeGMudVs6
XSwgcHZoQnl0ZXMpCisJZGVmYXVsdDoKKwkJcmV0dXJuIHhjLCBmbXQuRXJyb3JmKCJpbnZhbGlk
IHVuaW9uIGtleSAnJXYnIiwgeC5UeXBlKQorCX0KIAl4Yy5hcmNoX2FybS5naWNfdmVyc2lvbiA9
IEMubGlieGxfZ2ljX3ZlcnNpb24oeC5BcmNoQXJtLkdpY1ZlcnNpb24pCiAJeGMuYXJjaF9hcm0u
dnVhcnQgPSBDLmxpYnhsX3Z1YXJ0X3R5cGUoeC5BcmNoQXJtLlZ1YXJ0KQogCXhjLmFsdHAybSA9
IEMubGlieGxfYWx0cDJtX21vZGUoeC5BbHRwMk0pCkBAIC0xNTc5LDYgKzE4MDQsMjIgQEAgZnVu
YyAoeCAqRGV2aWNlVXNiZGV2KSB0b0MoKSAoeGMgQy5saWJ4bF9kZXZpY2VfdXNiZGV2LCBlcnIg
ZXJyb3IpIHsKIAlDLmxpYnhsX2RldmljZV91c2JkZXZfaW5pdCgmeGMpCiAJeGMuY3RybCA9IEMu
bGlieGxfZGV2aWQoeC5DdHJsKQogCXhjLnBvcnQgPSBDLmludCh4LlBvcnQpCisJeGMuX3R5cGUg
PSBDLmxpYnhsX3VzYmRldl90eXBlKHguVHlwZSkKKwlzd2l0Y2ggeC5UeXBlIHsKKwljYXNlIFVz
YmRldlR5cGVIb3N0ZGV2OgorCQl0bXAsIG9rIDo9IHguVHlwZVVuaW9uLihEZXZpY2VVc2JkZXZU
eXBlVW5pb25Ib3N0ZGV2KQorCQlpZiAhb2sgeworCQkJQy5saWJ4bF9kZXZpY2VfdXNiZGV2X2Rp
c3Bvc2UoJnhjKQorCQkJcmV0dXJuIHhjLCBlcnJvcnMuTmV3KCJ3cm9uZyB0eXBlIGZvciB1bmlv
biBrZXkgdHlwZSIpCisJCX0KKwkJdmFyIGhvc3RkZXYgQy5saWJ4bF9kZXZpY2VfdXNiZGV2X3R5
cGVfdW5pb25faG9zdGRldgorCQlob3N0ZGV2Lmhvc3RidXMgPSBDLnVpbnQ4X3QodG1wLkhvc3Ri
dXMpCisJCWhvc3RkZXYuaG9zdGFkZHIgPSBDLnVpbnQ4X3QodG1wLkhvc3RhZGRyKQorCQlob3N0
ZGV2Qnl0ZXMgOj0gQy5Hb0J5dGVzKHVuc2FmZS5Qb2ludGVyKCZob3N0ZGV2KSwgQy5zaXplb2Zf
bGlieGxfZGV2aWNlX3VzYmRldl90eXBlX3VuaW9uX2hvc3RkZXYpCisJCWNvcHkoeGMudVs6XSwg
aG9zdGRldkJ5dGVzKQorCWRlZmF1bHQ6CisJCXJldHVybiB4YywgZm10LkVycm9yZigiaW52YWxp
ZCB1bmlvbiBrZXkgJyV2JyIsIHguVHlwZSkKKwl9CiAJcmV0dXJuIHhjLCBuaWwKIH0KIApAQCAt
MTY4OSw2ICsxOTMwLDIxIEBAIGZ1bmMgKHggKkRldmljZUNoYW5uZWwpIHRvQygpICh4YyBDLmxp
YnhsX2RldmljZV9jaGFubmVsLCBlcnIgZXJyb3IpIHsKIAl4Yy5iYWNrZW5kX2RvbW5hbWUgPSBD
LkNTdHJpbmcoeC5CYWNrZW5kRG9tbmFtZSkKIAl4Yy5kZXZpZCA9IEMubGlieGxfZGV2aWQoeC5E
ZXZpZCkKIAl4Yy5uYW1lID0gQy5DU3RyaW5nKHguTmFtZSkKKwl4Yy5jb25uZWN0aW9uID0gQy5s
aWJ4bF9jaGFubmVsX2Nvbm5lY3Rpb24oeC5Db25uZWN0aW9uKQorCXN3aXRjaCB4LkNvbm5lY3Rp
b24geworCWNhc2UgQ2hhbm5lbENvbm5lY3Rpb25Tb2NrZXQ6CisJCXRtcCwgb2sgOj0geC5Db25u
ZWN0aW9uVW5pb24uKERldmljZUNoYW5uZWxDb25uZWN0aW9uVW5pb25Tb2NrZXQpCisJCWlmICFv
ayB7CisJCQlDLmxpYnhsX2RldmljZV9jaGFubmVsX2Rpc3Bvc2UoJnhjKQorCQkJcmV0dXJuIHhj
LCBlcnJvcnMuTmV3KCJ3cm9uZyB0eXBlIGZvciB1bmlvbiBrZXkgY29ubmVjdGlvbiIpCisJCX0K
KwkJdmFyIHNvY2tldCBDLmxpYnhsX2RldmljZV9jaGFubmVsX2Nvbm5lY3Rpb25fdW5pb25fc29j
a2V0CisJCXNvY2tldC5wYXRoID0gQy5DU3RyaW5nKHRtcC5QYXRoKQorCQlzb2NrZXRCeXRlcyA6
PSBDLkdvQnl0ZXModW5zYWZlLlBvaW50ZXIoJnNvY2tldCksIEMuc2l6ZW9mX2xpYnhsX2Rldmlj
ZV9jaGFubmVsX2Nvbm5lY3Rpb25fdW5pb25fc29ja2V0KQorCQljb3B5KHhjLnVbOl0sIHNvY2tl
dEJ5dGVzKQorCWRlZmF1bHQ6CisJCXJldHVybiB4YywgZm10LkVycm9yZigiaW52YWxpZCB1bmlv
biBrZXkgJyV2JyIsIHguQ29ubmVjdGlvbikKKwl9CiAJcmV0dXJuIHhjLCBuaWwKIH0KIApAQCAt
MjY1MSw2ICsyOTA3LDQ2IEBAIGZ1bmMgKHggKkV2ZW50KSB0b0MoKSAoeGMgQy5saWJ4bF9ldmVu
dCwgZXJyIGVycm9yKSB7CiAJCXJldHVybiB4YywgZXJyCiAJfQogCXhjLmZvcl91c2VyID0gQy51
aW50NjRfdCh4LkZvclVzZXIpCisJeGMuX3R5cGUgPSBDLmxpYnhsX2V2ZW50X3R5cGUoeC5UeXBl
KQorCXN3aXRjaCB4LlR5cGUgeworCWNhc2UgRXZlbnRUeXBlRG9tYWluU2h1dGRvd246CisJCXRt
cCwgb2sgOj0geC5UeXBlVW5pb24uKEV2ZW50VHlwZVVuaW9uRG9tYWluU2h1dGRvd24pCisJCWlm
ICFvayB7CisJCQlDLmxpYnhsX2V2ZW50X2Rpc3Bvc2UoJnhjKQorCQkJcmV0dXJuIHhjLCBlcnJv
cnMuTmV3KCJ3cm9uZyB0eXBlIGZvciB1bmlvbiBrZXkgdHlwZSIpCisJCX0KKwkJdmFyIGRvbWFp
bl9zaHV0ZG93biBDLmxpYnhsX2V2ZW50X3R5cGVfdW5pb25fZG9tYWluX3NodXRkb3duCisJCWRv
bWFpbl9zaHV0ZG93bi5zaHV0ZG93bl9yZWFzb24gPSBDLnVpbnQ4X3QodG1wLlNodXRkb3duUmVh
c29uKQorCQlkb21haW5fc2h1dGRvd25CeXRlcyA6PSBDLkdvQnl0ZXModW5zYWZlLlBvaW50ZXIo
JmRvbWFpbl9zaHV0ZG93biksIEMuc2l6ZW9mX2xpYnhsX2V2ZW50X3R5cGVfdW5pb25fZG9tYWlu
X3NodXRkb3duKQorCQljb3B5KHhjLnVbOl0sIGRvbWFpbl9zaHV0ZG93bkJ5dGVzKQorCWNhc2Ug
RXZlbnRUeXBlRGlza0VqZWN0OgorCQl0bXAsIG9rIDo9IHguVHlwZVVuaW9uLihFdmVudFR5cGVV
bmlvbkRpc2tFamVjdCkKKwkJaWYgIW9rIHsKKwkJCUMubGlieGxfZXZlbnRfZGlzcG9zZSgmeGMp
CisJCQlyZXR1cm4geGMsIGVycm9ycy5OZXcoIndyb25nIHR5cGUgZm9yIHVuaW9uIGtleSB0eXBl
IikKKwkJfQorCQl2YXIgZGlza19lamVjdCBDLmxpYnhsX2V2ZW50X3R5cGVfdW5pb25fZGlza19l
amVjdAorCQlkaXNrX2VqZWN0LnZkZXYgPSBDLkNTdHJpbmcodG1wLlZkZXYpCisJCWRpc2tfZWpl
Y3QuZGlzaywgZXJyID0gdG1wLkRpc2sudG9DKCkKKwkJaWYgZXJyICE9IG5pbCB7CisJCQlDLmxp
YnhsX2V2ZW50X2Rpc3Bvc2UoJnhjKQorCQkJcmV0dXJuIHhjLCBlcnIKKwkJfQorCQlkaXNrX2Vq
ZWN0Qnl0ZXMgOj0gQy5Hb0J5dGVzKHVuc2FmZS5Qb2ludGVyKCZkaXNrX2VqZWN0KSwgQy5zaXpl
b2ZfbGlieGxfZXZlbnRfdHlwZV91bmlvbl9kaXNrX2VqZWN0KQorCQljb3B5KHhjLnVbOl0sIGRp
c2tfZWplY3RCeXRlcykKKwljYXNlIEV2ZW50VHlwZU9wZXJhdGlvbkNvbXBsZXRlOgorCQl0bXAs
IG9rIDo9IHguVHlwZVVuaW9uLihFdmVudFR5cGVVbmlvbk9wZXJhdGlvbkNvbXBsZXRlKQorCQlp
ZiAhb2sgeworCQkJQy5saWJ4bF9ldmVudF9kaXNwb3NlKCZ4YykKKwkJCXJldHVybiB4YywgZXJy
b3JzLk5ldygid3JvbmcgdHlwZSBmb3IgdW5pb24ga2V5IHR5cGUiKQorCQl9CisJCXZhciBvcGVy
YXRpb25fY29tcGxldGUgQy5saWJ4bF9ldmVudF90eXBlX3VuaW9uX29wZXJhdGlvbl9jb21wbGV0
ZQorCQlvcGVyYXRpb25fY29tcGxldGUucmMgPSBDLmludCh0bXAuUmMpCisJCW9wZXJhdGlvbl9j
b21wbGV0ZUJ5dGVzIDo9IEMuR29CeXRlcyh1bnNhZmUuUG9pbnRlcigmb3BlcmF0aW9uX2NvbXBs
ZXRlKSwgQy5zaXplb2ZfbGlieGxfZXZlbnRfdHlwZV91bmlvbl9vcGVyYXRpb25fY29tcGxldGUp
CisJCWNvcHkoeGMudVs6XSwgb3BlcmF0aW9uX2NvbXBsZXRlQnl0ZXMpCisJZGVmYXVsdDoKKwkJ
cmV0dXJuIHhjLCBmbXQuRXJyb3JmKCJpbnZhbGlkIHVuaW9uIGtleSAnJXYnIiwgeC5UeXBlKQor
CX0KIAlyZXR1cm4geGMsIG5pbAogfQogCkBAIC0yNzIwLDUgKzMwMTYsMzQgQEAgZnVuYyAoeCAq
UHNySHdJbmZvVHlwZVVuaW9uTWJhKSBmcm9tQyh4YyAqQy5saWJ4bF9wc3JfaHdfaW5mbykgZXJy
b3IgewogZnVuYyAoeCAqUHNySHdJbmZvKSB0b0MoKSAoeGMgQy5saWJ4bF9wc3JfaHdfaW5mbywg
ZXJyIGVycm9yKSB7CiAJQy5saWJ4bF9wc3JfaHdfaW5mb19pbml0KCZ4YykKIAl4Yy5pZCA9IEMu
dWludDMyX3QoeC5JZCkKKwl4Yy5fdHlwZSA9IEMubGlieGxfcHNyX2ZlYXRfdHlwZSh4LlR5cGUp
CisJc3dpdGNoIHguVHlwZSB7CisJY2FzZSBQc3JGZWF0VHlwZUNhdDoKKwkJdG1wLCBvayA6PSB4
LlR5cGVVbmlvbi4oUHNySHdJbmZvVHlwZVVuaW9uQ2F0KQorCQlpZiAhb2sgeworCQkJQy5saWJ4
bF9wc3JfaHdfaW5mb19kaXNwb3NlKCZ4YykKKwkJCXJldHVybiB4YywgZXJyb3JzLk5ldygid3Jv
bmcgdHlwZSBmb3IgdW5pb24ga2V5IHR5cGUiKQorCQl9CisJCXZhciBjYXQgQy5saWJ4bF9wc3Jf
aHdfaW5mb190eXBlX3VuaW9uX2NhdAorCQljYXQuY29zX21heCA9IEMudWludDMyX3QodG1wLkNv
c01heCkKKwkJY2F0LmNibV9sZW4gPSBDLnVpbnQzMl90KHRtcC5DYm1MZW4pCisJCWNhdC5jZHBf
ZW5hYmxlZCA9IEMuYm9vbCh0bXAuQ2RwRW5hYmxlZCkKKwkJY2F0Qnl0ZXMgOj0gQy5Hb0J5dGVz
KHVuc2FmZS5Qb2ludGVyKCZjYXQpLCBDLnNpemVvZl9saWJ4bF9wc3JfaHdfaW5mb190eXBlX3Vu
aW9uX2NhdCkKKwkJY29weSh4Yy51WzpdLCBjYXRCeXRlcykKKwljYXNlIFBzckZlYXRUeXBlTWJh
OgorCQl0bXAsIG9rIDo9IHguVHlwZVVuaW9uLihQc3JId0luZm9UeXBlVW5pb25NYmEpCisJCWlm
ICFvayB7CisJCQlDLmxpYnhsX3Bzcl9od19pbmZvX2Rpc3Bvc2UoJnhjKQorCQkJcmV0dXJuIHhj
LCBlcnJvcnMuTmV3KCJ3cm9uZyB0eXBlIGZvciB1bmlvbiBrZXkgdHlwZSIpCisJCX0KKwkJdmFy
IG1iYSBDLmxpYnhsX3Bzcl9od19pbmZvX3R5cGVfdW5pb25fbWJhCisJCW1iYS5jb3NfbWF4ID0g
Qy51aW50MzJfdCh0bXAuQ29zTWF4KQorCQltYmEudGhydGxfbWF4ID0gQy51aW50MzJfdCh0bXAu
VGhydGxNYXgpCisJCW1iYS5saW5lYXIgPSBDLmJvb2wodG1wLkxpbmVhcikKKwkJbWJhQnl0ZXMg
Oj0gQy5Hb0J5dGVzKHVuc2FmZS5Qb2ludGVyKCZtYmEpLCBDLnNpemVvZl9saWJ4bF9wc3JfaHdf
aW5mb190eXBlX3VuaW9uX21iYSkKKwkJY29weSh4Yy51WzpdLCBtYmFCeXRlcykKKwlkZWZhdWx0
OgorCQlyZXR1cm4geGMsIGZtdC5FcnJvcmYoImludmFsaWQgdW5pb24ga2V5ICcldiciLCB4LlR5
cGUpCisJfQogCXJldHVybiB4YywgbmlsCiB9Ci0tIAoyLjE5LjEKCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhl
bi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3Jn
L21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

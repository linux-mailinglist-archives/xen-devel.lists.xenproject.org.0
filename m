Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 6F252BFF99
	for <lists+xen-devel@lfdr.de>; Fri, 27 Sep 2019 09:04:25 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iDkFl-0003IC-JJ; Fri, 27 Sep 2019 07:01:21 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=Rbpq=XW=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1iDkFk-0003HC-5n
 for xen-devel@lists.xenproject.org; Fri, 27 Sep 2019 07:01:20 +0000
X-Inumbo-ID: 8fce4bfe-e0f4-11e9-966c-12813bfff9fa
Received: from mx1.suse.de (unknown [195.135.220.15])
 by localhost (Halon) with ESMTPS
 id 8fce4bfe-e0f4-11e9-966c-12813bfff9fa;
 Fri, 27 Sep 2019 07:01:00 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 4BB1AAFF3;
 Fri, 27 Sep 2019 07:00:57 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Fri, 27 Sep 2019 09:00:13 +0200
Message-Id: <20190927070050.12405-10-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190927070050.12405-1-jgross@suse.com>
References: <20190927070050.12405-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v4 09/46] xen/sched: move some per-vcpu items to
 struct sched_unit
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Meng Xu <mengxu@cis.upenn.edu>,
 Jan Beulich <jbeulich@suse.com>, Dario Faggioli <dfaggioli@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

QWZmaW5pdGllcyBhcmUgc2NoZWR1bGVyIHNwZWNpZmljIGF0dHJpYnV0ZXMsIHRoZXkgc2hvdWxk
IGJlIHBlcgpzY2hlZHVsaW5nIHVuaXQuIFNvIG1vdmUgYWxsIGFmZmluaXR5IHJlbGF0ZWQgZmll
bGRzIGluIHN0cnVjdCB2Y3B1CnRvIHN0cnVjdCBzY2hlZF91bml0LiBXaGlsZSBhdCBpdCBzd2l0
Y2ggYWZmaW5pdHkgcmVsYXRlZCBmdW5jdGlvbnMgaW4Kc2NoZWQtaWYuaCB0byB1c2UgYSBwb2lu
dGVyIHRvIHNjaGVkX3VuaXQgaW5zdGVhZCB0byB2Y3B1IGFzIHBhcmFtZXRlci4KClRoZSBhZmZp
bml0eV9icm9rZW4gZmxhZyBtdXN0IGJlIGtlcHQgcGVyIHZjcHUgYXMgaXQgaXMgcmVsYXRlZCB0
bwpndWVzdCBhY3Rpb25zIG9uIHNwZWNpZmljIHZjcHVzLiBXaGVuIHN1cHBvcnQgb2YgbXVsdGlw
bGUgdmNwdXMgcGVyCnNjaGVkX3VuaXQgaXMgYmVpbmcgYWRkZWQsIGEgdW5pdCBpcyByZWdhcmRl
ZCBhcyBiZWluZyBzdWJqZWN0IHRvCiJicm9rZW4gYWZmaW5pdHkiIHdoZW4gYW55IG9mIGl0cyB2
Y3B1cyBoYXMgdGhlIGFmZmluaXR5X2Jyb2tlbiBmbGFnCnNldC4KClNpZ25lZC1vZmYtYnk6IEp1
ZXJnZW4gR3Jvc3MgPGpncm9zc0BzdXNlLmNvbT4KQWNrZWQtYnk6IEphbiBCZXVsaWNoIDxqYmV1
bGljaEBzdXNlLmNvbT4KUmV2aWV3ZWQtYnk6IERhcmlvIEZhZ2dpb2xpIDxkZmFnZ2lvbGlAc3Vz
ZS5jb20+Ci0tLQpWMjoKLSBtb3ZlIGFmZmluaXR5X2Jyb2tlbiBiYWNrIHRvIHN0cnVjdCB2Y3B1
IChKYW4gQmV1bGljaCkKLSBwcmludCBhZmZpbml0aWVzIG9ubHkgb25jZSBwZXIgdW5pdCAoSmFu
IEJldWxpY2gpClY0OgotIG1ha2UgdW5pdCBwb2ludGVyIGluIGtleWhhbmRsZXIgY29uc3QgKEph
biBCZXVsaWNoKQotLS0KIHhlbi9jb21tb24vZG9tYWluLmMgICAgICAgIHwgMTUgKystLS0tLS0K
IHhlbi9jb21tb24vZG9tY3RsLmMgICAgICAgIHwgMTMgKysrKy0tLQogeGVuL2NvbW1vbi9rZXlo
YW5kbGVyLmMgICAgfCA1OCArKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tLS0KIHhlbi9jb21t
b24vc2NoZWRfY3JlZGl0LmMgIHwgMTggKysrKystLS0tLQogeGVuL2NvbW1vbi9zY2hlZF9jcmVk
aXQyLmMgfCA0MiArKysrKysrKysrKy0tLS0tLS0tLS0tCiB4ZW4vY29tbW9uL3NjaGVkX251bGwu
YyAgICB8IDE4ICsrKysrLS0tLS0KIHhlbi9jb21tb24vc2NoZWRfcnQuYyAgICAgIHwgIDkgKyst
LS0KIHhlbi9jb21tb24vc2NoZWR1bGUuYyAgICAgIHwgOTAgKysrKysrKysrKysrKysrKysrKysr
KysrKysrKy0tLS0tLS0tLS0tLS0tLS0tLQogeGVuL2luY2x1ZGUveGVuL3NjaGVkLWlmLmggfCAx
NyArKysrLS0tLS0KIHhlbi9pbmNsdWRlL3hlbi9zY2hlZC5oICAgIHwgMjIgKysrKysrLS0tLS0t
CiAxMCBmaWxlcyBjaGFuZ2VkLCAxNjMgaW5zZXJ0aW9ucygrKSwgMTM5IGRlbGV0aW9ucygtKQoK
ZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vZG9tYWluLmMgYi94ZW4vY29tbW9uL2RvbWFpbi5jCmlu
ZGV4IGQxMDNmY2IyZGEuLjI1YTEzODYwNTcgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vZG9tYWlu
LmMKKysrIGIveGVuL2NvbW1vbi9kb21haW4uYwpAQCAtMTMyLDEwICsxMzIsNiBAQCBzdGF0aWMg
dm9pZCB2Y3B1X2luZm9fcmVzZXQoc3RydWN0IHZjcHUgKnYpCiAKIHN0YXRpYyB2b2lkIHZjcHVf
ZGVzdHJveShzdHJ1Y3QgdmNwdSAqdikKIHsKLSAgICBmcmVlX2NwdW1hc2tfdmFyKHYtPmNwdV9o
YXJkX2FmZmluaXR5KTsKLSAgICBmcmVlX2NwdW1hc2tfdmFyKHYtPmNwdV9oYXJkX2FmZmluaXR5
X3NhdmVkKTsKLSAgICBmcmVlX2NwdW1hc2tfdmFyKHYtPmNwdV9zb2Z0X2FmZmluaXR5KTsKLQog
ICAgIGZyZWVfdmNwdV9zdHJ1Y3Qodik7CiB9CiAKQEAgLTE1OSwxMSArMTU1LDYgQEAgc3RydWN0
IHZjcHUgKnZjcHVfY3JlYXRlKAogCiAgICAgZ3JhbnRfdGFibGVfaW5pdF92Y3B1KHYpOwogCi0g
ICAgaWYgKCAhemFsbG9jX2NwdW1hc2tfdmFyKCZ2LT5jcHVfaGFyZF9hZmZpbml0eSkgfHwKLSAg
ICAgICAgICF6YWxsb2NfY3B1bWFza192YXIoJnYtPmNwdV9oYXJkX2FmZmluaXR5X3NhdmVkKSB8
fAotICAgICAgICAgIXphbGxvY19jcHVtYXNrX3Zhcigmdi0+Y3B1X3NvZnRfYWZmaW5pdHkpICkK
LSAgICAgICAgZ290byBmYWlsOwotCiAgICAgaWYgKCBpc19pZGxlX2RvbWFpbihkKSApCiAgICAg
ewogICAgICAgICB2LT5ydW5zdGF0ZS5zdGF0ZSA9IFJVTlNUQVRFX3J1bm5pbmc7CkBAIC0yMDMs
NyArMTk0LDYgQEAgc3RydWN0IHZjcHUgKnZjcHVfY3JlYXRlKAogICAgIHNjaGVkX2Rlc3Ryb3lf
dmNwdSh2KTsKICBmYWlsX3dxOgogICAgIGRlc3Ryb3lfd2FpdHF1ZXVlX3ZjcHUodik7Ci0gZmFp
bDoKICAgICB2Y3B1X2Rlc3Ryb3kodik7CiAKICAgICByZXR1cm4gTlVMTDsKQEAgLTYxNCw5ICs2
MDQsMTAgQEAgdm9pZCBkb21haW5fdXBkYXRlX25vZGVfYWZmaW5pdHkoc3RydWN0IGRvbWFpbiAq
ZCkKICAgICAgICAgICovCiAgICAgICAgIGZvcl9lYWNoX3ZjcHUgKCBkLCB2ICkKICAgICAgICAg
ewotICAgICAgICAgICAgY3B1bWFza19vcihkb21fY3B1bWFzaywgZG9tX2NwdW1hc2ssIHYtPmNw
dV9oYXJkX2FmZmluaXR5KTsKKyAgICAgICAgICAgIGNwdW1hc2tfb3IoZG9tX2NwdW1hc2ssIGRv
bV9jcHVtYXNrLAorICAgICAgICAgICAgICAgICAgICAgICB2LT5zY2hlZF91bml0LT5jcHVfaGFy
ZF9hZmZpbml0eSk7CiAgICAgICAgICAgICBjcHVtYXNrX29yKGRvbV9jcHVtYXNrX3NvZnQsIGRv
bV9jcHVtYXNrX3NvZnQsCi0gICAgICAgICAgICAgICAgICAgICAgIHYtPmNwdV9zb2Z0X2FmZmlu
aXR5KTsKKyAgICAgICAgICAgICAgICAgICAgICAgdi0+c2NoZWRfdW5pdC0+Y3B1X3NvZnRfYWZm
aW5pdHkpOwogICAgICAgICB9CiAgICAgICAgIC8qIEZpbHRlciBvdXQgbm9uLW9ubGluZSBjcHVz
ICovCiAgICAgICAgIGNwdW1hc2tfYW5kKGRvbV9jcHVtYXNrLCBkb21fY3B1bWFzaywgb25saW5l
KTsKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vZG9tY3RsLmMgYi94ZW4vY29tbW9uL2RvbWN0bC5j
CmluZGV4IDZlNmU5Yjk4NjYuLjJmOTc2OGYwOGYgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vZG9t
Y3RsLmMKKysrIGIveGVuL2NvbW1vbi9kb21jdGwuYwpAQCAtNjA2LDYgKzYwNiw3IEBAIGxvbmcg
ZG9fZG9tY3RsKFhFTl9HVUVTVF9IQU5ETEVfUEFSQU0oeGVuX2RvbWN0bF90KSB1X2RvbWN0bCkK
ICAgICBjYXNlIFhFTl9ET01DVExfZ2V0dmNwdWFmZmluaXR5OgogICAgIHsKICAgICAgICAgc3Ry
dWN0IHZjcHUgKnY7CisgICAgICAgIGNvbnN0IHN0cnVjdCBzY2hlZF91bml0ICp1bml0OwogICAg
ICAgICBzdHJ1Y3QgeGVuX2RvbWN0bF92Y3B1YWZmaW5pdHkgKnZjcHVhZmYgPSAmb3AtPnUudmNw
dWFmZmluaXR5OwogCiAgICAgICAgIHJldCA9IC1FSU5WQUw7CkBAIC02MTYsNiArNjE3LDcgQEAg
bG9uZyBkb19kb21jdGwoWEVOX0dVRVNUX0hBTkRMRV9QQVJBTSh4ZW5fZG9tY3RsX3QpIHVfZG9t
Y3RsKQogICAgICAgICBpZiAoICh2ID0gZC0+dmNwdVt2Y3B1YWZmLT52Y3B1XSkgPT0gTlVMTCAp
CiAgICAgICAgICAgICBicmVhazsKIAorICAgICAgICB1bml0ID0gdi0+c2NoZWRfdW5pdDsKICAg
ICAgICAgcmV0ID0gLUVJTlZBTDsKICAgICAgICAgaWYgKCB2Y3B1YWZmaW5pdHlfcGFyYW1zX2lu
dmFsaWQodmNwdWFmZikgKQogICAgICAgICAgICAgYnJlYWs7CkBAIC02MzUsNyArNjM3LDcgQEAg
bG9uZyBkb19kb21jdGwoWEVOX0dVRVNUX0hBTkRMRV9QQVJBTSh4ZW5fZG9tY3RsX3QpIHVfZG9t
Y3RsKQogICAgICAgICAgICAgICAgIHJldCA9IC1FTk9NRU07CiAgICAgICAgICAgICAgICAgYnJl
YWs7CiAgICAgICAgICAgICB9Ci0gICAgICAgICAgICBjcHVtYXNrX2NvcHkob2xkX2FmZmluaXR5
LCB2LT5jcHVfaGFyZF9hZmZpbml0eSk7CisgICAgICAgICAgICBjcHVtYXNrX2NvcHkob2xkX2Fm
ZmluaXR5LCB1bml0LT5jcHVfaGFyZF9hZmZpbml0eSk7CiAKICAgICAgICAgICAgIGlmICggIWFs
bG9jX2NwdW1hc2tfdmFyKCZuZXdfYWZmaW5pdHkpICkKICAgICAgICAgICAgIHsKQEAgLTY2OCw3
ICs2NzAsNyBAQCBsb25nIGRvX2RvbWN0bChYRU5fR1VFU1RfSEFORExFX1BBUkFNKHhlbl9kb21j
dGxfdCkgdV9kb21jdGwpCiAgICAgICAgICAgICAgICAgICogRm9yIGhhcmQgYWZmaW5pdHksIHdo
YXQgd2UgcmV0dXJuIGlzIHRoZSBpbnRlcnNlY3Rpb24gb2YKICAgICAgICAgICAgICAgICAgKiBj
cHVwb29sJ3Mgb25saW5lIG1hc2sgYW5kIHRoZSBuZXcgaGFyZCBhZmZpbml0eS4KICAgICAgICAg
ICAgICAgICAgKi8KLSAgICAgICAgICAgICAgICBjcHVtYXNrX2FuZChuZXdfYWZmaW5pdHksIG9u
bGluZSwgdi0+Y3B1X2hhcmRfYWZmaW5pdHkpOworICAgICAgICAgICAgICAgIGNwdW1hc2tfYW5k
KG5ld19hZmZpbml0eSwgb25saW5lLCB1bml0LT5jcHVfaGFyZF9hZmZpbml0eSk7CiAgICAgICAg
ICAgICAgICAgcmV0ID0gY3B1bWFza190b194ZW5jdGxfYml0bWFwKCZ2Y3B1YWZmLT5jcHVtYXBf
aGFyZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3
X2FmZmluaXR5KTsKICAgICAgICAgICAgIH0KQEAgLTY5Nyw3ICs2OTksOCBAQCBsb25nIGRvX2Rv
bWN0bChYRU5fR1VFU1RfSEFORExFX1BBUkFNKHhlbl9kb21jdGxfdCkgdV9kb21jdGwpCiAgICAg
ICAgICAgICAgICAgICogaGFyZCBhZmZpbml0eS4KICAgICAgICAgICAgICAgICAgKi8KICAgICAg
ICAgICAgICAgICBjcHVtYXNrX2FuZChuZXdfYWZmaW5pdHksIG5ld19hZmZpbml0eSwgb25saW5l
KTsKLSAgICAgICAgICAgICAgICBjcHVtYXNrX2FuZChuZXdfYWZmaW5pdHksIG5ld19hZmZpbml0
eSwgdi0+Y3B1X2hhcmRfYWZmaW5pdHkpOworICAgICAgICAgICAgICAgIGNwdW1hc2tfYW5kKG5l
d19hZmZpbml0eSwgbmV3X2FmZmluaXR5LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVu
aXQtPmNwdV9oYXJkX2FmZmluaXR5KTsKICAgICAgICAgICAgICAgICByZXQgPSBjcHVtYXNrX3Rv
X3hlbmN0bF9iaXRtYXAoJnZjcHVhZmYtPmNwdW1hcF9zb2Z0LAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdfYWZmaW5pdHkpOwogICAgICAgICAgICAg
fQpAQCAtNzEwLDEwICs3MTMsMTAgQEAgbG9uZyBkb19kb21jdGwoWEVOX0dVRVNUX0hBTkRMRV9Q
QVJBTSh4ZW5fZG9tY3RsX3QpIHVfZG9tY3RsKQogICAgICAgICB7CiAgICAgICAgICAgICBpZiAo
IHZjcHVhZmYtPmZsYWdzICYgWEVOX1ZDUFVBRkZJTklUWV9IQVJEICkKICAgICAgICAgICAgICAg
ICByZXQgPSBjcHVtYXNrX3RvX3hlbmN0bF9iaXRtYXAoJnZjcHVhZmYtPmNwdW1hcF9oYXJkLAot
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2LT5jcHVfaGFy
ZF9hZmZpbml0eSk7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5KTsKICAgICAgICAgICAgIGlmICggdmNwdWFmZi0+
ZmxhZ3MgJiBYRU5fVkNQVUFGRklOSVRZX1NPRlQgKQogICAgICAgICAgICAgICAgIHJldCA9IGNw
dW1hc2tfdG9feGVuY3RsX2JpdG1hcCgmdmNwdWFmZi0+Y3B1bWFwX3NvZnQsCi0gICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYtPmNwdV9zb2Z0X2FmZmluaXR5
KTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5pdC0+
Y3B1X3NvZnRfYWZmaW5pdHkpOwogICAgICAgICB9CiAgICAgICAgIGJyZWFrOwogICAgIH0KZGlm
ZiAtLWdpdCBhL3hlbi9jb21tb24va2V5aGFuZGxlci5jIGIveGVuL2NvbW1vbi9rZXloYW5kbGVy
LmMKaW5kZXggYzM2YmFhNGRmZi4uZGM2Mzk2YjIyNSAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9r
ZXloYW5kbGVyLmMKKysrIGIveGVuL2NvbW1vbi9rZXloYW5kbGVyLmMKQEAgLTI1MSw2ICsyNTEs
NyBAQCBzdGF0aWMgdm9pZCByZWJvb3RfbWFjaGluZSh1bnNpZ25lZCBjaGFyIGtleSwgc3RydWN0
IGNwdV91c2VyX3JlZ3MgKnJlZ3MpCiBzdGF0aWMgdm9pZCBkdW1wX2RvbWFpbnModW5zaWduZWQg
Y2hhciBrZXkpCiB7CiAgICAgc3RydWN0IGRvbWFpbiAqZDsKKyAgICBjb25zdCBzdHJ1Y3Qgc2No
ZWRfdW5pdCAqdW5pdDsKICAgICBzdHJ1Y3QgdmNwdSAgICp2OwogICAgIHNfdGltZV90ICAgICAg
IG5vdyA9IE5PVygpOwogCkBAIC0yOTcsMzMgKzI5OCwzOCBAQCBzdGF0aWMgdm9pZCBkdW1wX2Rv
bWFpbnModW5zaWduZWQgY2hhciBrZXkpCiAKICAgICAgICAgcHJpbnRrKCJWQ1BVIGluZm9ybWF0
aW9uIGFuZCBjYWxsYmFja3MgZm9yIGRvbWFpbiAldTpcbiIsCiAgICAgICAgICAgICAgICBkLT5k
b21haW5faWQpOwotICAgICAgICBmb3JfZWFjaF92Y3B1ICggZCwgdiApCi0gICAgICAgIHsKLSAg
ICAgICAgICAgIGlmICggISh2LT52Y3B1X2lkICYgMHgzZikgKQotICAgICAgICAgICAgICAgIHBy
b2Nlc3NfcGVuZGluZ19zb2Z0aXJxcygpOwogCi0gICAgICAgICAgICBwcmludGsoIiAgICBWQ1BV
JWQ6IENQVSVkIFtoYXM9JWNdIHBvbGw9JWQgIgotICAgICAgICAgICAgICAgICAgICJ1cGNhbGxf
cGVuZD0lMDJ4IHVwY2FsbF9tYXNrPSUwMnggIiwKLSAgICAgICAgICAgICAgICAgICB2LT52Y3B1
X2lkLCB2LT5wcm9jZXNzb3IsCi0gICAgICAgICAgICAgICAgICAgdi0+aXNfcnVubmluZyA/ICdU
JzonRicsIHYtPnBvbGxfZXZ0Y2huLAotICAgICAgICAgICAgICAgICAgIHZjcHVfaW5mbyh2LCBl
dnRjaG5fdXBjYWxsX3BlbmRpbmcpLAotICAgICAgICAgICAgICAgICAgICF2Y3B1X2V2ZW50X2Rl
bGl2ZXJ5X2lzX2VuYWJsZWQodikpOwotICAgICAgICAgICAgaWYgKCB2Y3B1X2NwdV9kaXJ0eSh2
KSApCi0gICAgICAgICAgICAgICAgcHJpbnRrKCJkaXJ0eV9jcHU9JXUiLCB2LT5kaXJ0eV9jcHUp
OwotICAgICAgICAgICAgcHJpbnRrKCJcbiIpOwotICAgICAgICAgICAgcHJpbnRrKCIgICAgY3B1
X2hhcmRfYWZmaW5pdHk9eyUqcGJsfSBjcHVfc29mdF9hZmZpbml0eT17JSpwYmx9XG4iLAotICAg
ICAgICAgICAgICAgICAgIENQVU1BU0tfUFIodi0+Y3B1X2hhcmRfYWZmaW5pdHkpLAotICAgICAg
ICAgICAgICAgICAgIENQVU1BU0tfUFIodi0+Y3B1X3NvZnRfYWZmaW5pdHkpKTsKLSAgICAgICAg
ICAgIHByaW50aygiICAgIHBhdXNlX2NvdW50PSVkIHBhdXNlX2ZsYWdzPSVseFxuIiwKLSAgICAg
ICAgICAgICAgICAgICBhdG9taWNfcmVhZCgmdi0+cGF1c2VfY291bnQpLCB2LT5wYXVzZV9mbGFn
cyk7Ci0gICAgICAgICAgICBhcmNoX2R1bXBfdmNwdV9pbmZvKHYpOwotCi0gICAgICAgICAgICBp
ZiAoIHYtPnBlcmlvZGljX3BlcmlvZCA9PSAwICkKLSAgICAgICAgICAgICAgICBwcmludGsoIk5v
IHBlcmlvZGljIHRpbWVyXG4iKTsKLSAgICAgICAgICAgIGVsc2UKLSAgICAgICAgICAgICAgICBw
cmludGsoIiUiUFJJX3N0aW1lIiBIeiBwZXJpb2RpYyB0aW1lciAocGVyaW9kICUiUFJJX3N0aW1l
IiBtcylcbiIsCi0gICAgICAgICAgICAgICAgICAgICAgIDEwMDAwMDAwMDAgLyB2LT5wZXJpb2Rp
Y19wZXJpb2QsCi0gICAgICAgICAgICAgICAgICAgICAgIHYtPnBlcmlvZGljX3BlcmlvZCAvIDEw
MDAwMDApOworICAgICAgICBmb3JfZWFjaF9zY2hlZF91bml0ICggZCwgdW5pdCApCisgICAgICAg
IHsKKyAgICAgICAgICAgIHByaW50aygiICBVTklUJWQgYWZmaW5pdGllczogaGFyZD17JSpwYmx9
IHNvZnQ9eyUqcGJsfVxuIiwKKyAgICAgICAgICAgICAgICAgICB1bml0LT51bml0X2lkLCBDUFVN
QVNLX1BSKHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5KSwKKyAgICAgICAgICAgICAgICAgICBDUFVN
QVNLX1BSKHVuaXQtPmNwdV9zb2Z0X2FmZmluaXR5KSk7CisKKyAgICAgICAgICAgIGZvcl9lYWNo
X3NjaGVkX3VuaXRfdmNwdSAoIHVuaXQsIHYgKQorICAgICAgICAgICAgeworICAgICAgICAgICAg
ICAgIGlmICggISh2LT52Y3B1X2lkICYgMHgzZikgKQorICAgICAgICAgICAgICAgICAgICBwcm9j
ZXNzX3BlbmRpbmdfc29mdGlycXMoKTsKKworICAgICAgICAgICAgICAgIHByaW50aygiICAgIFZD
UFUlZDogQ1BVJWQgW2hhcz0lY10gcG9sbD0lZCAiCisgICAgICAgICAgICAgICAgICAgICAgICJ1
cGNhbGxfcGVuZD0lMDJ4IHVwY2FsbF9tYXNrPSUwMnggIiwKKyAgICAgICAgICAgICAgICAgICAg
ICAgdi0+dmNwdV9pZCwgdi0+cHJvY2Vzc29yLAorICAgICAgICAgICAgICAgICAgICAgICB2LT5p
c19ydW5uaW5nID8gJ1QnOidGJywgdi0+cG9sbF9ldnRjaG4sCisgICAgICAgICAgICAgICAgICAg
ICAgIHZjcHVfaW5mbyh2LCBldnRjaG5fdXBjYWxsX3BlbmRpbmcpLAorICAgICAgICAgICAgICAg
ICAgICAgICAhdmNwdV9ldmVudF9kZWxpdmVyeV9pc19lbmFibGVkKHYpKTsKKyAgICAgICAgICAg
ICAgICBpZiAoIHZjcHVfY3B1X2RpcnR5KHYpICkKKyAgICAgICAgICAgICAgICAgICAgcHJpbnRr
KCJkaXJ0eV9jcHU9JXUiLCB2LT5kaXJ0eV9jcHUpOworICAgICAgICAgICAgICAgIHByaW50aygi
XG4iKTsKKyAgICAgICAgICAgICAgICBwcmludGsoIiAgICBwYXVzZV9jb3VudD0lZCBwYXVzZV9m
bGFncz0lbHhcbiIsCisgICAgICAgICAgICAgICAgICAgICAgIGF0b21pY19yZWFkKCZ2LT5wYXVz
ZV9jb3VudCksIHYtPnBhdXNlX2ZsYWdzKTsKKyAgICAgICAgICAgICAgICBhcmNoX2R1bXBfdmNw
dV9pbmZvKHYpOworCisgICAgICAgICAgICAgICAgaWYgKCB2LT5wZXJpb2RpY19wZXJpb2QgPT0g
MCApCisgICAgICAgICAgICAgICAgICAgIHByaW50aygiTm8gcGVyaW9kaWMgdGltZXJcbiIpOwor
ICAgICAgICAgICAgICAgIGVsc2UKKyAgICAgICAgICAgICAgICAgICAgcHJpbnRrKCIlIlBSSV9z
dGltZSIgSHogcGVyaW9kaWMgdGltZXIgKHBlcmlvZCAlIlBSSV9zdGltZSIgbXMpXG4iLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgMTAwMDAwMDAwMCAvIHYtPnBlcmlvZGljX3BlcmlvZCwK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgIHYtPnBlcmlvZGljX3BlcmlvZCAvIDEwMDAwMDAp
OworICAgICAgICAgICAgfQogICAgICAgICB9CiAgICAgfQogCmRpZmYgLS1naXQgYS94ZW4vY29t
bW9uL3NjaGVkX2NyZWRpdC5jIGIveGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQuYwppbmRleCBkMGU0
ZGRjNzZiLi5jYjdiOWM1ZDkxIDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL3NjaGVkX2NyZWRpdC5j
CisrKyBiL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0LmMKQEAgLTM1Miw2ICszNTIsNyBAQCBERUZJ
TkVfUEVSX0NQVSh1bnNpZ25lZCBpbnQsIGxhc3RfdGlja2xlX2NwdSk7CiBzdGF0aWMgaW5saW5l
IHZvaWQgX19ydW5xX3RpY2tsZShzdHJ1Y3QgY3NjaGVkX3VuaXQgKm5ldykKIHsKICAgICB1bnNp
Z25lZCBpbnQgY3B1ID0gbmV3LT52Y3B1LT5wcm9jZXNzb3I7CisgICAgc3RydWN0IHNjaGVkX3Vu
aXQgKnVuaXQgPSBuZXctPnZjcHUtPnNjaGVkX3VuaXQ7CiAgICAgc3RydWN0IGNzY2hlZF91bml0
ICogY29uc3QgY3VyID0gQ1NDSEVEX1VOSVQoY3Vycl9vbl9jcHUoY3B1KSk7CiAgICAgc3RydWN0
IGNzY2hlZF9wcml2YXRlICpwcnYgPSBDU0NIRURfUFJJVihwZXJfY3B1KHNjaGVkdWxlciwgY3B1
KSk7CiAgICAgY3B1bWFza190IG1hc2ssIGlkbGVfbWFzaywgKm9ubGluZTsKQEAgLTM3Nyw3ICsz
NzgsNyBAQCBzdGF0aWMgaW5saW5lIHZvaWQgX19ydW5xX3RpY2tsZShzdHJ1Y3QgY3NjaGVkX3Vu
aXQgKm5ldykKICAgICBpZiAoIHVubGlrZWx5KHRlc3RfYml0KENTQ0hFRF9GTEFHX1ZDUFVfUElO
TkVELCAmbmV3LT5mbGFncykgJiYKICAgICAgICAgICAgICAgICAgIGNwdW1hc2tfdGVzdF9jcHUo
Y3B1LCAmaWRsZV9tYXNrKSkgKQogICAgIHsKLSAgICAgICAgQVNTRVJUKGNwdW1hc2tfY3ljbGUo
Y3B1LCBuZXctPnZjcHUtPmNwdV9oYXJkX2FmZmluaXR5KSA9PSBjcHUpOworICAgICAgICBBU1NF
UlQoY3B1bWFza19jeWNsZShjcHUsIHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5KSA9PSBjcHUpOwog
ICAgICAgICBTQ0hFRF9TVEFUX0NSQU5LKHRpY2tsZWRfaWRsZV9jcHVfZXhjbCk7CiAgICAgICAg
IF9fY3B1bWFza19zZXRfY3B1KGNwdSwgJm1hc2spOwogICAgICAgICBnb3RvIHRpY2tsZTsKQEAg
LTQxMiwxMSArNDEzLDExIEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBfX3J1bnFfdGlja2xlKHN0cnVj
dCBjc2NoZWRfdW5pdCAqbmV3KQogICAgICAgICAgICAgaW50IG5ld19pZGxlcnNfZW1wdHk7CiAK
ICAgICAgICAgICAgIGlmICggYmFsYW5jZV9zdGVwID09IEJBTEFOQ0VfU09GVF9BRkZJTklUWQot
ICAgICAgICAgICAgICAgICAmJiAhaGFzX3NvZnRfYWZmaW5pdHkobmV3LT52Y3B1KSApCisgICAg
ICAgICAgICAgICAgICYmICFoYXNfc29mdF9hZmZpbml0eSh1bml0KSApCiAgICAgICAgICAgICAg
ICAgY29udGludWU7CiAKICAgICAgICAgICAgIC8qIEFyZSB0aGVyZSBpZGxlcnMgc3VpdGFibGUg
Zm9yIG5ldyAoZm9yIHRoaXMgYmFsYW5jZSBzdGVwKT8gKi8KLSAgICAgICAgICAgIGFmZmluaXR5
X2JhbGFuY2VfY3B1bWFzayhuZXctPnZjcHUsIGJhbGFuY2Vfc3RlcCwKKyAgICAgICAgICAgIGFm
ZmluaXR5X2JhbGFuY2VfY3B1bWFzayh1bml0LCBiYWxhbmNlX3N0ZXAsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgY3B1bWFza19zY3JhdGNoX2NwdShjcHUpKTsKICAgICAg
ICAgICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwKICAgICAgICAgICAg
ICAgICAgICAgICAgIGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwgJmlkbGVfbWFzayk7CkBAIC00
NDUsOCArNDQ2LDcgQEAgc3RhdGljIGlubGluZSB2b2lkIF9fcnVucV90aWNrbGUoc3RydWN0IGNz
Y2hlZF91bml0ICpuZXcpCiAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgIGlmICggbmV3X2lk
bGVyc19lbXB0eSAmJiBuZXctPnByaSA+IGN1ci0+cHJpICkKICAgICAgICAgICAgIHsKLSAgICAg
ICAgICAgICAgICBpZiAoIGNwdW1hc2tfaW50ZXJzZWN0cyhjdXItPnZjcHUtPmNwdV9oYXJkX2Fm
ZmluaXR5LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZpZGxlX21h
c2spICkKKyAgICAgICAgICAgICAgICBpZiAoIGNwdW1hc2tfaW50ZXJzZWN0cyh1bml0LT5jcHVf
aGFyZF9hZmZpbml0eSwgJmlkbGVfbWFzaykgKQogICAgICAgICAgICAgICAgIHsKICAgICAgICAg
ICAgICAgICAgICAgU0NIRURfVkNQVV9TVEFUX0NSQU5LKGN1ciwga2lja2VkX2F3YXkpOwogICAg
ICAgICAgICAgICAgICAgICBTQ0hFRF9WQ1BVX1NUQVRfQ1JBTksoY3VyLCBtaWdyYXRlX3IpOwpA
QCAtNzI4LDcgKzcyOCw3IEBAIF9jc2NoZWRfY3B1X3BpY2soY29uc3Qgc3RydWN0IHNjaGVkdWxl
ciAqb3BzLCBzdHJ1Y3QgdmNwdSAqdmMsIGJvb2xfdCBjb21taXQpCiAKICAgICBmb3JfZWFjaF9h
ZmZpbml0eV9iYWxhbmNlX3N0ZXAoIGJhbGFuY2Vfc3RlcCApCiAgICAgewotICAgICAgICBhZmZp
bml0eV9iYWxhbmNlX2NwdW1hc2sodmMsIGJhbGFuY2Vfc3RlcCwgY3B1cyk7CisgICAgICAgIGFm
ZmluaXR5X2JhbGFuY2VfY3B1bWFzayh2Yy0+c2NoZWRfdW5pdCwgYmFsYW5jZV9zdGVwLCBjcHVz
KTsKICAgICAgICAgY3B1bWFza19hbmQoY3B1cywgb25saW5lLCBjcHVzKTsKICAgICAgICAgLyoK
ICAgICAgICAgICogV2Ugd2FudCB0byBwaWNrIHVwIGEgcGNwdSBhbW9uZyB0aGUgb25lcyB0aGF0
IGFyZSBvbmxpbmUgYW5kCkBAIC03NDcsNyArNzQ3LDcgQEAgX2NzY2hlZF9jcHVfcGljayhjb25z
dCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCB2Y3B1ICp2YywgYm9vbF90IGNvbW1pdCkK
ICAgICAgICAgICogYmFsYW5jaW5nIHN0ZXAgYWxsIHRvZ2V0aGVyLgogICAgICAgICAgKi8KICAg
ICAgICAgaWYgKCBiYWxhbmNlX3N0ZXAgPT0gQkFMQU5DRV9TT0ZUX0FGRklOSVRZICYmCi0gICAg
ICAgICAgICAgKCFoYXNfc29mdF9hZmZpbml0eSh2YykgfHwgY3B1bWFza19lbXB0eShjcHVzKSkg
KQorICAgICAgICAgICAgICghaGFzX3NvZnRfYWZmaW5pdHkodmMtPnNjaGVkX3VuaXQpIHx8IGNw
dW1hc2tfZW1wdHkoY3B1cykpICkKICAgICAgICAgICAgIGNvbnRpbnVlOwogCiAgICAgICAgIC8q
IElmIHByZXNlbnQsIHByZWZlciB2YydzIGN1cnJlbnQgcHJvY2Vzc29yICovCkBAIC0xNjQ3LDEw
ICsxNjQ3LDEwIEBAIGNzY2hlZF9ydW5xX3N0ZWFsKGludCBwZWVyX2NwdSwgaW50IGNwdSwgaW50
IHByaSwgaW50IGJhbGFuY2Vfc3RlcCkKICAgICAgICAgICogb3IgY291bnRlci4KICAgICAgICAg
ICovCiAgICAgICAgIGlmICggdmMtPmlzX3J1bm5pbmcgfHwgKGJhbGFuY2Vfc3RlcCA9PSBCQUxB
TkNFX1NPRlRfQUZGSU5JVFkgJiYKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIWhh
c19zb2Z0X2FmZmluaXR5KHZjKSkgKQorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAh
aGFzX3NvZnRfYWZmaW5pdHkodmMtPnNjaGVkX3VuaXQpKSApCiAgICAgICAgICAgICBjb250aW51
ZTsKIAotICAgICAgICBhZmZpbml0eV9iYWxhbmNlX2NwdW1hc2sodmMsIGJhbGFuY2Vfc3RlcCwg
Y3B1bWFza19zY3JhdGNoKTsKKyAgICAgICAgYWZmaW5pdHlfYmFsYW5jZV9jcHVtYXNrKHZjLT5z
Y2hlZF91bml0LCBiYWxhbmNlX3N0ZXAsIGNwdW1hc2tfc2NyYXRjaCk7CiAgICAgICAgIGlmICgg
X19jc2NoZWRfdmNwdV9pc19taWdyYXRlYWJsZShwcnYsIHZjLCBjcHUsIGNwdW1hc2tfc2NyYXRj
aCkgKQogICAgICAgICB7CiAgICAgICAgICAgICAvKiBXZSBnb3QgYSBjYW5kaWRhdGUuIEdyYWIg
aXQhICovCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3NjaGVkX2NyZWRpdDIuYyBiL3hlbi9jb21t
b24vc2NoZWRfY3JlZGl0Mi5jCmluZGV4IDgyZDAzYTA2ODMuLjRjMGYzMTczM2QgMTAwNjQ0Ci0t
LSBhL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0Mi5jCisrKyBiL3hlbi9jb21tb24vc2NoZWRfY3Jl
ZGl0Mi5jCkBAIC03MDAsMTAgKzcwMCwxMCBAQCBzdGF0aWMgaW50IGdldF9mYWxsYmFja19jcHUo
c3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjKQogICAgIHsKICAgICAgICAgaW50IGNwdSA9IHYtPnBy
b2Nlc3NvcjsKIAotICAgICAgICBpZiAoIGJzID09IEJBTEFOQ0VfU09GVF9BRkZJTklUWSAmJiAh
aGFzX3NvZnRfYWZmaW5pdHkodikgKQorICAgICAgICBpZiAoIGJzID09IEJBTEFOQ0VfU09GVF9B
RkZJTklUWSAmJiAhaGFzX3NvZnRfYWZmaW5pdHkodi0+c2NoZWRfdW5pdCkgKQogICAgICAgICAg
ICAgY29udGludWU7CiAKLSAgICAgICAgYWZmaW5pdHlfYmFsYW5jZV9jcHVtYXNrKHYsIGJzLCBj
cHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSkpOworICAgICAgICBhZmZpbml0eV9iYWxhbmNlX2NwdW1h
c2sodi0+c2NoZWRfdW5pdCwgYnMsIGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSk7CiAgICAgICAg
IGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwgY3B1bWFza19zY3JhdGNoX2Nw
dShjcHUpLAogICAgICAgICAgICAgICAgICAgICBjcHVwb29sX2RvbWFpbl9jcHVtYXNrKHYtPmRv
bWFpbikpOwogCkBAIC0xMzkxLDEwICsxMzkxLDEwIEBAIHN0YXRpYyBzX3RpbWVfdCB0aWNrbGVf
c2NvcmUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzX3RpbWVfdCBub3csCiAgICAgICov
CiAgICAgaWYgKCBzY29yZSA+IDAgKQogICAgIHsKLSAgICAgICAgaWYgKCBjcHVtYXNrX3Rlc3Rf
Y3B1KGNwdSwgbmV3LT52Y3B1LT5jcHVfc29mdF9hZmZpbml0eSkgKQorICAgICAgICBpZiAoIGNw
dW1hc2tfdGVzdF9jcHUoY3B1LCBuZXctPnZjcHUtPnNjaGVkX3VuaXQtPmNwdV9zb2Z0X2FmZmlu
aXR5KSApCiAgICAgICAgICAgICBzY29yZSArPSBDU0NIRUQyX0NSRURJVF9JTklUOwogCi0gICAg
ICAgIGlmICggIWNwdW1hc2tfdGVzdF9jcHUoY3B1LCBjdXItPnZjcHUtPmNwdV9zb2Z0X2FmZmlu
aXR5KSApCisgICAgICAgIGlmICggIWNwdW1hc2tfdGVzdF9jcHUoY3B1LCBjdXItPnZjcHUtPnNj
aGVkX3VuaXQtPmNwdV9zb2Z0X2FmZmluaXR5KSApCiAgICAgICAgICAgICBzY29yZSArPSBDU0NI
RUQyX0NSRURJVF9JTklUOwogICAgIH0KIApAQCAtMTQzNyw2ICsxNDM3LDcgQEAgcnVucV90aWNr
bGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgY3NjaGVkMl91bml0ICpuZXcs
IHNfdGltZV90IG5vdykKIHsKICAgICBpbnQgaSwgaXBpZCA9IC0xOwogICAgIHNfdGltZV90IG1h
eCA9IDA7CisgICAgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQgPSBuZXctPnZjcHUtPnNjaGVkX3Vu
aXQ7CiAgICAgdW5zaWduZWQgaW50IGJzLCBjcHUgPSBuZXctPnZjcHUtPnByb2Nlc3NvcjsKICAg
ICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQgPSBjMnJxZChvcHMsIGNwdSk7CiAg
ICAgY3B1bWFza190ICpvbmxpbmUgPSBjcHVwb29sX2RvbWFpbl9jcHVtYXNrKG5ldy0+dmNwdS0+
ZG9tYWluKTsKQEAgLTE0NzQsNyArMTQ3NSw3IEBAIHJ1bnFfdGlja2xlKGNvbnN0IHN0cnVjdCBz
Y2hlZHVsZXIgKm9wcywgc3RydWN0IGNzY2hlZDJfdW5pdCAqbmV3LCBzX3RpbWVfdCBub3cpCiAg
ICAgICAgICAgICAgICAgICBjcHVtYXNrX3Rlc3RfY3B1KGNwdSwgJnJxZC0+aWRsZSkgJiYKICAg
ICAgICAgICAgICAgICAgICFjcHVtYXNrX3Rlc3RfY3B1KGNwdSwgJnJxZC0+dGlja2xlZCkpICkK
ICAgICB7Ci0gICAgICAgIEFTU0VSVChjcHVtYXNrX2N5Y2xlKGNwdSwgbmV3LT52Y3B1LT5jcHVf
aGFyZF9hZmZpbml0eSkgPT0gY3B1KTsKKyAgICAgICAgQVNTRVJUKGNwdW1hc2tfY3ljbGUoY3B1
LCB1bml0LT5jcHVfaGFyZF9hZmZpbml0eSkgPT0gY3B1KTsKICAgICAgICAgU0NIRURfU1RBVF9D
UkFOSyh0aWNrbGVkX2lkbGVfY3B1X2V4Y2wpOwogICAgICAgICBpcGlkID0gY3B1OwogICAgICAg
ICBnb3RvIHRpY2tsZTsKQEAgLTE0ODMsMTAgKzE0ODQsMTAgQEAgcnVucV90aWNrbGUoY29uc3Qg
c3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgY3NjaGVkMl91bml0ICpuZXcsIHNfdGltZV90
IG5vdykKICAgICBmb3JfZWFjaF9hZmZpbml0eV9iYWxhbmNlX3N0ZXAoIGJzICkKICAgICB7CiAg
ICAgICAgIC8qIEp1c3Qgc2tpcCBmaXJzdCBzdGVwLCBpZiB3ZSBkb24ndCBoYXZlIGEgc29mdCBh
ZmZpbml0eSAqLwotICAgICAgICBpZiAoIGJzID09IEJBTEFOQ0VfU09GVF9BRkZJTklUWSAmJiAh
aGFzX3NvZnRfYWZmaW5pdHkobmV3LT52Y3B1KSApCisgICAgICAgIGlmICggYnMgPT0gQkFMQU5D
RV9TT0ZUX0FGRklOSVRZICYmICFoYXNfc29mdF9hZmZpbml0eSh1bml0KSApCiAgICAgICAgICAg
ICBjb250aW51ZTsKIAotICAgICAgICBhZmZpbml0eV9iYWxhbmNlX2NwdW1hc2sobmV3LT52Y3B1
LCBicywgY3B1bWFza19zY3JhdGNoX2NwdShjcHUpKTsKKyAgICAgICAgYWZmaW5pdHlfYmFsYW5j
ZV9jcHVtYXNrKHVuaXQsIGJzLCBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSkpOwogCiAgICAgICAg
IC8qCiAgICAgICAgICAqIEZpcnN0IG9mIGFsbCwgY29uc2lkZXIgaWRsZSBjcHVzLCBjaGVja2lu
ZyBpZiB3ZSBjYW4ganVzdApAQCAtMTU1OCw3ICsxNTU5LDcgQEAgcnVucV90aWNrbGUoY29uc3Qg
c3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgY3NjaGVkMl91bml0ICpuZXcsIHNfdGltZV90
IG5vdykKICAgICAgICAgICAgIGlwaWQgPSBjcHU7CiAKICAgICAgICAgICAgIC8qIElmIHRoaXMg
aXMgaW4gbmV3J3Mgc29mdCBhZmZpbml0eSwganVzdCB0YWtlIGl0ICovCi0gICAgICAgICAgICBp
ZiAoIGNwdW1hc2tfdGVzdF9jcHUoY3B1LCBuZXctPnZjcHUtPmNwdV9zb2Z0X2FmZmluaXR5KSAp
CisgICAgICAgICAgICBpZiAoIGNwdW1hc2tfdGVzdF9jcHUoY3B1LCB1bml0LT5jcHVfc29mdF9h
ZmZpbml0eSkgKQogICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIFNDSEVEX1NUQVRfQ1JB
TksodGlja2xlZF9idXN5X2NwdSk7CiAgICAgICAgICAgICAgICAgZ290byB0aWNrbGU7CkBAIC0y
MjQ0LDcgKzIyNDUsNyBAQCBjc2NoZWQyX3Jlc19waWNrKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIg
Km9wcywgY29uc3Qgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiAgICAgICAgIGdvdG8gb3V0Owog
ICAgIH0KIAotICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwgdmMtPmNw
dV9oYXJkX2FmZmluaXR5LAorICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1
KSwgdW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHksCiAgICAgICAgICAgICAgICAgY3B1cG9vbF9kb21h
aW5fY3B1bWFzayh2Yy0+ZG9tYWluKSk7CiAKICAgICAvKgpAQCAtMjI4OSw3ICsyMjkwLDcgQEAg
Y3NjaGVkMl9yZXNfcGljayhjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGNvbnN0IHN0cnVj
dCBzY2hlZF91bml0ICp1bml0KQogICAgICAqCiAgICAgICogRmluZCBib3RoIHJ1bnF1ZXVlcyBp
biBvbmUgcGFzcy4KICAgICAgKi8KLSAgICBoYXNfc29mdCA9IGhhc19zb2Z0X2FmZmluaXR5KHZj
KTsKKyAgICBoYXNfc29mdCA9IGhhc19zb2Z0X2FmZmluaXR5KHVuaXQpOwogICAgIGZvcl9lYWNo
X2NwdShpLCAmcHJ2LT5hY3RpdmVfcXVldWVzKQogICAgIHsKICAgICAgICAgc3RydWN0IGNzY2hl
ZDJfcnVucXVldWVfZGF0YSAqcnFkOwpAQCAtMjMzNiw3ICsyMzM3LDcgQEAgY3NjaGVkMl9yZXNf
cGljayhjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGNvbnN0IHN0cnVjdCBzY2hlZF91bml0
ICp1bml0KQogICAgICAgICAgICAgY3B1bWFza190IG1hc2s7CiAKICAgICAgICAgICAgIGNwdW1h
c2tfYW5kKCZtYXNrLCBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksICZycWQtPmFjdGl2ZSk7Ci0g
ICAgICAgICAgICBpZiAoIGNwdW1hc2tfaW50ZXJzZWN0cygmbWFzaywgc3ZjLT52Y3B1LT5jcHVf
c29mdF9hZmZpbml0eSkgKQorICAgICAgICAgICAgaWYgKCBjcHVtYXNrX2ludGVyc2VjdHMoJm1h
c2ssIHVuaXQtPmNwdV9zb2Z0X2FmZmluaXR5KSApCiAgICAgICAgICAgICB7CiAgICAgICAgICAg
ICAgICAgbWluX3NfYXZnbG9hZCA9IHJxZF9hdmdsb2FkOwogICAgICAgICAgICAgICAgIG1pbl9z
X3JxaSA9IGk7CkBAIC0yMzU4LDkgKzIzNTksOSBAQCBjc2NoZWQyX3Jlc19waWNrKGNvbnN0IHN0
cnVjdCBzY2hlZHVsZXIgKm9wcywgY29uc3Qgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiAgICAg
ICAgICAqIE5vdGUgdGhhdCwgdG8gb2J0YWluIHRoZSBzb2Z0LWFmZmluaXR5IG1hc2ssIHdlICJq
dXN0IiBwdXQgd2hhdCB3ZQogICAgICAgICAgKiBoYXZlIGluIGNwdW1hc2tfc2NyYXRjaCBpbiAm
JiB3aXRoIHZjLT5jcHVfc29mdF9hZmZpbml0eS4gVGhpcyBpcwogICAgICAgICAgKiBvayBiZWNh
dXNlOgotICAgICAgICAgKiAtIHdlIGtub3cgdGhhdCB2Yy0+Y3B1X2hhcmRfYWZmaW5pdHkgYW5k
IHZjLT5jcHVfc29mdF9hZmZpbml0eSBoYXZlCisgICAgICAgICAqIC0gd2Uga25vdyB0aGF0IHVu
aXQtPmNwdV9oYXJkX2FmZmluaXR5IGFuZCAtPmNwdV9zb2Z0X2FmZmluaXR5IGhhdmUKICAgICAg
ICAgICogICBhIG5vbi1lbXB0eSBpbnRlcnNlY3Rpb24gKGJlY2F1c2UgaGFzX3NvZnQgaXMgdHJ1
ZSk7Ci0gICAgICAgICAqIC0gd2UgaGF2ZSB2Yy0+Y3B1X2hhcmRfYWZmaW5pdHkgJiBjcHVwb29s
X2RvbWFpbl9jcHVtYXNrKCkgYWxyZWFkeQorICAgICAgICAgKiAtIHdlIGhhdmUgdW5pdC0+Y3B1
X2hhcmRfYWZmaW5pdHkgJiBjcHVwb29sX2RvbWFpbl9jcHVtYXNrKCkgYWxyZWFkeQogICAgICAg
ICAgKiAgIGluIGNwdW1hc2tfc2NyYXRjaCwgd2UgZG8gc2F2ZSBhIGxvdCBkb2luZyBsaWtlIHRo
aXMuCiAgICAgICAgICAqCiAgICAgICAgICAqIEl0J3Mga2luZCBvZiBsaWtlIG9wZW4gY29kaW5n
IGFmZmluaXR5X2JhbGFuY2VfY3B1bWFzaygpIGJ1dCwgaW4KQEAgLTIzNjgsNyArMjM2OSw3IEBA
IGNzY2hlZDJfcmVzX3BpY2soY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBjb25zdCBzdHJ1
Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKICAgICAgICAgICogY3B1bWFzayBvcGVyYXRpb25zLgogICAg
ICAgICAgKi8KICAgICAgICAgY3B1bWFza19hbmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCBj
cHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksCi0gICAgICAgICAgICAgICAgICAgIHZjLT5jcHVfc29m
dF9hZmZpbml0eSk7CisgICAgICAgICAgICAgICAgICAgIHVuaXQtPmNwdV9zb2Z0X2FmZmluaXR5
KTsKICAgICAgICAgY3B1bWFza19hbmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCBjcHVtYXNr
X3NjcmF0Y2hfY3B1KGNwdSksCiAgICAgICAgICAgICAgICAgICAgICZwcnYtPnJxZFttaW5fc19y
cWldLmFjdGl2ZSk7CiAgICAgfQpAQCAtMjQ3Niw2ICsyNDc3LDcgQEAgc3RhdGljIHZvaWQgbWln
cmF0ZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAgICAgICAgICAgICAgICAgICAgIHNf
dGltZV90IG5vdykKIHsKICAgICBpbnQgY3B1ID0gc3ZjLT52Y3B1LT5wcm9jZXNzb3I7CisgICAg
c3RydWN0IHNjaGVkX3VuaXQgKnVuaXQgPSBzdmMtPnZjcHUtPnNjaGVkX3VuaXQ7CiAKICAgICBp
ZiAoIHVubGlrZWx5KHRiX2luaXRfZG9uZSkgKQogICAgIHsKQEAgLTI1MTMsNyArMjUxNSw3IEBA
IHN0YXRpYyB2b2lkIG1pZ3JhdGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAgICAg
ICB9CiAgICAgICAgIF9ydW5xX2RlYXNzaWduKHN2Yyk7CiAKLSAgICAgICAgY3B1bWFza19hbmQo
Y3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCBzdmMtPnZjcHUtPmNwdV9oYXJkX2FmZmluaXR5LAor
ICAgICAgICBjcHVtYXNrX2FuZChjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksIHVuaXQtPmNwdV9o
YXJkX2FmZmluaXR5LAogICAgICAgICAgICAgICAgICAgICBjcHVwb29sX2RvbWFpbl9jcHVtYXNr
KHN2Yy0+dmNwdS0+ZG9tYWluKSk7CiAgICAgICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRj
aF9jcHUoY3B1KSwgY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLAogICAgICAgICAgICAgICAgICAg
ICAmdHJxZC0+YWN0aXZlKTsKQEAgLTI1NDcsNyArMjU0OSw3IEBAIHN0YXRpYyBib29sIHZjcHVf
aXNfbWlncmF0ZWFibGUoc3RydWN0IGNzY2hlZDJfdW5pdCAqc3ZjLAogICAgIHN0cnVjdCB2Y3B1
ICp2ID0gc3ZjLT52Y3B1OwogICAgIGludCBjcHUgPSBzdmMtPnZjcHUtPnByb2Nlc3NvcjsKIAot
ICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwgdi0+Y3B1X2hhcmRfYWZm
aW5pdHksCisgICAgY3B1bWFza19hbmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCB2LT5zY2hl
ZF91bml0LT5jcHVfaGFyZF9hZmZpbml0eSwKICAgICAgICAgICAgICAgICBjcHVwb29sX2RvbWFp
bl9jcHVtYXNrKHYtPmRvbWFpbikpOwogCiAgICAgcmV0dXJuICEoc3ZjLT5mbGFncyAmIENTRkxB
R19ydW5xX21pZ3JhdGVfcmVxdWVzdCkgJiYKQEAgLTI3ODEsNyArMjc4Myw3IEBAIGNzY2hlZDJf
dW5pdF9taWdyYXRlKAogCiAgICAgLyogSWYgaGVyZSwgbmV3X2NwdSBtdXN0IGJlIGEgdmFsaWQg
Q3JlZGl0MiBwQ1BVLCBhbmQgaW4gb3VyIGFmZmluaXR5LiAqLwogICAgIEFTU0VSVChjcHVtYXNr
X3Rlc3RfY3B1KG5ld19jcHUsICZjc2NoZWQyX3ByaXYob3BzKS0+aW5pdGlhbGl6ZWQpKTsKLSAg
ICBBU1NFUlQoY3B1bWFza190ZXN0X2NwdShuZXdfY3B1LCB2Yy0+Y3B1X2hhcmRfYWZmaW5pdHkp
KTsKKyAgICBBU1NFUlQoY3B1bWFza190ZXN0X2NwdShuZXdfY3B1LCB1bml0LT5jcHVfaGFyZF9h
ZmZpbml0eSkpOwogCiAgICAgdHJxZCA9IGMycnFkKG9wcywgbmV3X2NwdSk7CiAKQEAgLTMzMjEs
OSArMzMyMyw5IEBAIHJ1bnFfY2FuZGlkYXRlKHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEg
KnJxZCwKICAgICB9CiAKICAgICAvKiBJZiBzY3VyciBoYXMgYSBzb2Z0LWFmZmluaXR5LCBsZXQn
cyBjaGVjayB3aGV0aGVyIGNwdSBpcyBwYXJ0IG9mIGl0ICovCi0gICAgaWYgKCBoYXNfc29mdF9h
ZmZpbml0eShzY3Vyci0+dmNwdSkgKQorICAgIGlmICggaGFzX3NvZnRfYWZmaW5pdHkoc2N1cnIt
PnZjcHUtPnNjaGVkX3VuaXQpICkKICAgICB7Ci0gICAgICAgIGFmZmluaXR5X2JhbGFuY2VfY3B1
bWFzayhzY3Vyci0+dmNwdSwgQkFMQU5DRV9TT0ZUX0FGRklOSVRZLAorICAgICAgICBhZmZpbml0
eV9iYWxhbmNlX2NwdW1hc2soc2N1cnItPnZjcHUtPnNjaGVkX3VuaXQsIEJBTEFOQ0VfU09GVF9B
RkZJTklUWSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNwdW1hc2tfc2NyYXRj
aCk7CiAgICAgICAgIGlmICggdW5saWtlbHkoIWNwdW1hc2tfdGVzdF9jcHUoY3B1LCBjcHVtYXNr
X3NjcmF0Y2gpKSApCiAgICAgICAgIHsKQEAgLTMzNzgsNyArMzM4MCw3IEBAIHJ1bnFfY2FuZGlk
YXRlKHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCwKICAgICAgICAgfQogCiAgICAg
ICAgIC8qIE9ubHkgY29uc2lkZXIgdmNwdXMgdGhhdCBhcmUgYWxsb3dlZCB0byBydW4gb24gdGhp
cyBwcm9jZXNzb3IuICovCi0gICAgICAgIGlmICggIWNwdW1hc2tfdGVzdF9jcHUoY3B1LCBzdmMt
PnZjcHUtPmNwdV9oYXJkX2FmZmluaXR5KSApCisgICAgICAgIGlmICggIWNwdW1hc2tfdGVzdF9j
cHUoY3B1LCBzdmMtPnZjcHUtPnNjaGVkX3VuaXQtPmNwdV9oYXJkX2FmZmluaXR5KSApCiAgICAg
ICAgIHsKICAgICAgICAgICAgICgqc2tpcHBlZCkrKzsKICAgICAgICAgICAgIGNvbnRpbnVlOwpk
aWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZF9udWxsLmMgYi94ZW4vY29tbW9uL3NjaGVkX251
bGwuYwppbmRleCA0N2QxYjJhYjU2Li4yM2UwMjlhNGRkIDEwMDY0NAotLS0gYS94ZW4vY29tbW9u
L3NjaGVkX251bGwuYworKysgYi94ZW4vY29tbW9uL3NjaGVkX251bGwuYwpAQCAtMTIyLDcgKzEy
Miw4IEBAIHN0YXRpYyBpbmxpbmUgc3RydWN0IG51bGxfdW5pdCAqbnVsbF91bml0KGNvbnN0IHN0
cnVjdCBzY2hlZF91bml0ICp1bml0KQogc3RhdGljIGlubGluZSBib29sIHZjcHVfY2hlY2tfYWZm
aW5pdHkoc3RydWN0IHZjcHUgKnYsIHVuc2lnbmVkIGludCBjcHUsCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgYmFsYW5jZV9zdGVwKQogewotICAg
IGFmZmluaXR5X2JhbGFuY2VfY3B1bWFzayh2LCBiYWxhbmNlX3N0ZXAsIGNwdW1hc2tfc2NyYXRj
aF9jcHUoY3B1KSk7CisgICAgYWZmaW5pdHlfYmFsYW5jZV9jcHVtYXNrKHYtPnNjaGVkX3VuaXQs
IGJhbGFuY2Vfc3RlcCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3B1bWFza19zY3Jh
dGNoX2NwdShjcHUpKTsKICAgICBjcHVtYXNrX2FuZChjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSks
IGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwKICAgICAgICAgICAgICAgICBjcHVwb29sX2RvbWFp
bl9jcHVtYXNrKHYtPmRvbWFpbikpOwogCkBAIC0yNzMsMTAgKzI3NCwxMCBAQCBwaWNrX3Jlcyhz
dHJ1Y3QgbnVsbF9wcml2YXRlICpwcnYsIGNvbnN0IHN0cnVjdCBzY2hlZF91bml0ICp1bml0KQog
CiAgICAgZm9yX2VhY2hfYWZmaW5pdHlfYmFsYW5jZV9zdGVwKCBicyApCiAgICAgewotICAgICAg
ICBpZiAoIGJzID09IEJBTEFOQ0VfU09GVF9BRkZJTklUWSAmJiAhaGFzX3NvZnRfYWZmaW5pdHko
dikgKQorICAgICAgICBpZiAoIGJzID09IEJBTEFOQ0VfU09GVF9BRkZJTklUWSAmJiAhaGFzX3Nv
ZnRfYWZmaW5pdHkodW5pdCkgKQogICAgICAgICAgICAgY29udGludWU7CiAKLSAgICAgICAgYWZm
aW5pdHlfYmFsYW5jZV9jcHVtYXNrKHYsIGJzLCBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSkpOwor
ICAgICAgICBhZmZpbml0eV9iYWxhbmNlX2NwdW1hc2sodW5pdCwgYnMsIGNwdW1hc2tfc2NyYXRj
aF9jcHUoY3B1KSk7CiAgICAgICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1
KSwgY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCBjcHVzKTsKIAogICAgICAgICAvKgpAQCAtMzEz
LDcgKzMxNCw3IEBAIHBpY2tfcmVzKHN0cnVjdCBudWxsX3ByaXZhdGUgKnBydiwgY29uc3Qgc3Ry
dWN0IHNjaGVkX3VuaXQgKnVuaXQpCiAgICAgICogYXMgd2Ugd2lsbCBhY3R1YWxseSBhc3NpZ24g
dGhlIHZDUFUgdG8gdGhlIHBDUFUgd2UgcmV0dXJuIGZyb20gaGVyZSwKICAgICAgKiBvbmx5IGlm
IHRoZSBwQ1BVIGlzIGZyZWUuCiAgICAgICovCi0gICAgY3B1bWFza19hbmQoY3B1bWFza19zY3Jh
dGNoX2NwdShjcHUpLCBjcHVzLCB2LT5jcHVfaGFyZF9hZmZpbml0eSk7CisgICAgY3B1bWFza19h
bmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCBjcHVzLCB1bml0LT5jcHVfaGFyZF9hZmZpbml0
eSk7CiAgICAgbmV3X2NwdSA9IGNwdW1hc2tfYW55KGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSk7
CiAKICBvdXQ6CkBAIC0zOTYsNyArMzk3LDggQEAgc3RhdGljIGJvb2wgdmNwdV9kZWFzc2lnbihz
dHJ1Y3QgbnVsbF9wcml2YXRlICpwcnYsIHN0cnVjdCB2Y3B1ICp2KQogICAgIHsKICAgICAgICAg
bGlzdF9mb3JfZWFjaF9lbnRyeSggd3ZjLCAmcHJ2LT53YWl0cSwgd2FpdHFfZWxlbSApCiAgICAg
ICAgIHsKLSAgICAgICAgICAgIGlmICggYnMgPT0gQkFMQU5DRV9TT0ZUX0FGRklOSVRZICYmICFo
YXNfc29mdF9hZmZpbml0eSh3dmMtPnZjcHUpICkKKyAgICAgICAgICAgIGlmICggYnMgPT0gQkFM
QU5DRV9TT0ZUX0FGRklOSVRZICYmCisgICAgICAgICAgICAgICAgICFoYXNfc29mdF9hZmZpbml0
eSh3dmMtPnZjcHUtPnNjaGVkX3VuaXQpICkKICAgICAgICAgICAgICAgICBjb250aW51ZTsKIAog
ICAgICAgICAgICAgaWYgKCB2Y3B1X2NoZWNrX2FmZmluaXR5KHd2Yy0+dmNwdSwgY3B1LCBicykg
KQpAQCAtNDY2LDcgKzQ2OCw3IEBAIHN0YXRpYyB2b2lkIG51bGxfdW5pdF9pbnNlcnQoY29uc3Qg
c3RydWN0IHNjaGVkdWxlciAqb3BzLAogCiAgICAgbG9jayA9IHVuaXRfc2NoZWR1bGVfbG9jayh1
bml0KTsKIAotICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwgdi0+Y3B1
X2hhcmRfYWZmaW5pdHksCisgICAgY3B1bWFza19hbmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUp
LCB1bml0LT5jcHVfaGFyZF9hZmZpbml0eSwKICAgICAgICAgICAgICAgICBjcHVwb29sX2RvbWFp
bl9jcHVtYXNrKHYtPmRvbWFpbikpOwogCiAgICAgLyogSWYgdGhlIHBDUFUgaXMgZnJlZSwgd2Ug
YXNzaWduIHYgdG8gaXQgKi8KQEAgLTU3OSw3ICs1ODEsNyBAQCBzdGF0aWMgdm9pZCBudWxsX3Vu
aXRfd2FrZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAgICAgICAgIGxpc3RfYWRkX3Rh
aWwoJm52Yy0+d2FpdHFfZWxlbSwgJnBydi0+d2FpdHEpOwogICAgICAgICBzcGluX3VubG9jaygm
cHJ2LT53YWl0cV9sb2NrKTsKIAotICAgICAgICBjcHVtYXNrX2FuZChjcHVtYXNrX3NjcmF0Y2hf
Y3B1KGNwdSksIHYtPmNwdV9oYXJkX2FmZmluaXR5LAorICAgICAgICBjcHVtYXNrX2FuZChjcHVt
YXNrX3NjcmF0Y2hfY3B1KGNwdSksIHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5LAogICAgICAgICAg
ICAgICAgICAgICBjcHVwb29sX2RvbWFpbl9jcHVtYXNrKHYtPmRvbWFpbikpOwogCiAgICAgICAg
IGlmICggIWNwdW1hc2tfaW50ZXJzZWN0cygmcHJ2LT5jcHVzX2ZyZWUsIGNwdW1hc2tfc2NyYXRj
aF9jcHUoY3B1KSkgKQpAQCAtODQ4LDcgKzg1MCw3IEBAIHN0YXRpYyBzdHJ1Y3QgdGFza19zbGlj
ZSBudWxsX3NjaGVkdWxlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKICAgICAgICAgICAg
IGxpc3RfZm9yX2VhY2hfZW50cnkoIHd2YywgJnBydi0+d2FpdHEsIHdhaXRxX2VsZW0gKQogICAg
ICAgICAgICAgewogICAgICAgICAgICAgICAgIGlmICggYnMgPT0gQkFMQU5DRV9TT0ZUX0FGRklO
SVRZICYmCi0gICAgICAgICAgICAgICAgICAgICAhaGFzX3NvZnRfYWZmaW5pdHkod3ZjLT52Y3B1
KSApCisgICAgICAgICAgICAgICAgICAgICAhaGFzX3NvZnRfYWZmaW5pdHkod3ZjLT52Y3B1LT5z
Y2hlZF91bml0KSApCiAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogCiAgICAgICAgICAg
ICAgICAgaWYgKCB2Y3B1X2NoZWNrX2FmZmluaXR5KHd2Yy0+dmNwdSwgY3B1LCBicykgKQpkaWZm
IC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZF9ydC5jIGIveGVuL2NvbW1vbi9zY2hlZF9ydC5jCmlu
ZGV4IGRhMGE5YzQwMmYuLmRiMjRhNzBhOTEgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWRf
cnQuYworKysgYi94ZW4vY29tbW9uL3NjaGVkX3J0LmMKQEAgLTMyNyw3ICszMjcsNyBAQCBydF9k
dW1wX3ZjcHUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBjb25zdCBzdHJ1Y3QgcnRfdW5p
dCAqc3ZjKQogICAgIG1hc2sgPSBjcHVtYXNrX3NjcmF0Y2hfY3B1KHN2Yy0+dmNwdS0+cHJvY2Vz
c29yKTsKIAogICAgIGNwdXBvb2xfbWFzayA9IGNwdXBvb2xfZG9tYWluX2NwdW1hc2soc3ZjLT52
Y3B1LT5kb21haW4pOwotICAgIGNwdW1hc2tfYW5kKG1hc2ssIGNwdXBvb2xfbWFzaywgc3ZjLT52
Y3B1LT5jcHVfaGFyZF9hZmZpbml0eSk7CisgICAgY3B1bWFza19hbmQobWFzaywgY3B1cG9vbF9t
YXNrLCBzdmMtPnZjcHUtPnNjaGVkX3VuaXQtPmNwdV9oYXJkX2FmZmluaXR5KTsKICAgICBwcmlu
dGsoIlslNWQuJS0ydV0gY3B1ICV1LCAoJSJQUklfc3RpbWUiLCAlIlBSSV9zdGltZSIpLCIKICAg
ICAgICAgICAgIiBjdXJfYj0lIlBSSV9zdGltZSIgY3VyX2Q9JSJQUklfc3RpbWUiIGxhc3Rfc3Rh
cnQ9JSJQUklfc3RpbWUiXG4iCiAgICAgICAgICAgICIgXHRcdCBwcmlvcml0eV9sZXZlbD0lZCBo
YXNfZXh0cmF0aW1lPSVkXG4iCkBAIC02NDQsNyArNjQ0LDcgQEAgcnRfcmVzX3BpY2soY29uc3Qg
c3RydWN0IHNjaGVkdWxlciAqb3BzLCBjb25zdCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKICAg
ICBpbnQgY3B1OwogCiAgICAgb25saW5lID0gY3B1cG9vbF9kb21haW5fY3B1bWFzayh2Yy0+ZG9t
YWluKTsKLSAgICBjcHVtYXNrX2FuZCgmY3B1cywgb25saW5lLCB2Yy0+Y3B1X2hhcmRfYWZmaW5p
dHkpOworICAgIGNwdW1hc2tfYW5kKCZjcHVzLCBvbmxpbmUsIHVuaXQtPmNwdV9oYXJkX2FmZmlu
aXR5KTsKIAogICAgIGNwdSA9IGNwdW1hc2tfdGVzdF9jcHUodmMtPnByb2Nlc3NvciwgJmNwdXMp
CiAgICAgICAgICAgICA/IHZjLT5wcm9jZXNzb3IKQEAgLTEwMjEsNyArMTAyMSw4IEBAIHJ1bnFf
cGljayhjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGNvbnN0IGNwdW1hc2tfdCAqbWFzaykK
IAogICAgICAgICAvKiBtYXNrIGNwdV9oYXJkX2FmZmluaXR5ICYgY3B1cG9vbCAmIG1hc2sgKi8K
ICAgICAgICAgb25saW5lID0gY3B1cG9vbF9kb21haW5fY3B1bWFzayhpdGVyX3N2Yy0+dmNwdS0+
ZG9tYWluKTsKLSAgICAgICAgY3B1bWFza19hbmQoJmNwdV9jb21tb24sIG9ubGluZSwgaXRlcl9z
dmMtPnZjcHUtPmNwdV9oYXJkX2FmZmluaXR5KTsKKyAgICAgICAgY3B1bWFza19hbmQoJmNwdV9j
b21tb24sIG9ubGluZSwKKyAgICAgICAgICAgICAgICAgICAgaXRlcl9zdmMtPnZjcHUtPnNjaGVk
X3VuaXQtPmNwdV9oYXJkX2FmZmluaXR5KTsKICAgICAgICAgY3B1bWFza19hbmQoJmNwdV9jb21t
b24sIG1hc2ssICZjcHVfY29tbW9uKTsKICAgICAgICAgaWYgKCBjcHVtYXNrX2VtcHR5KCZjcHVf
Y29tbW9uKSApCiAgICAgICAgICAgICBjb250aW51ZTsKQEAgLTExOTAsNyArMTE5MSw3IEBAIHJ1
bnFfdGlja2xlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHJ0X3VuaXQgKm5l
dykKICAgICAgICAgcmV0dXJuOwogCiAgICAgb25saW5lID0gY3B1cG9vbF9kb21haW5fY3B1bWFz
ayhuZXctPnZjcHUtPmRvbWFpbik7Ci0gICAgY3B1bWFza19hbmQoJm5vdF90aWNrbGVkLCBvbmxp
bmUsIG5ldy0+dmNwdS0+Y3B1X2hhcmRfYWZmaW5pdHkpOworICAgIGNwdW1hc2tfYW5kKCZub3Rf
dGlja2xlZCwgb25saW5lLCBuZXctPnZjcHUtPnNjaGVkX3VuaXQtPmNwdV9oYXJkX2FmZmluaXR5
KTsKICAgICBjcHVtYXNrX2FuZG5vdCgmbm90X3RpY2tsZWQsICZub3RfdGlja2xlZCwgJnBydi0+
dGlja2xlZCk7CiAKICAgICAvKgpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZHVsZS5jIGIv
eGVuL2NvbW1vbi9zY2hlZHVsZS5jCmluZGV4IDZjOGZhMzgwNTIuLjc0N2RmYzBlYWIgMTAwNjQ0
Ci0tLSBhL3hlbi9jb21tb24vc2NoZWR1bGUuYworKysgYi94ZW4vY29tbW9uL3NjaGVkdWxlLmMK
QEAgLTMyOSw2ICszMjksMTEgQEAgc3RhdGljIHZvaWQgc2NoZWRfZnJlZV91bml0KHN0cnVjdCBz
Y2hlZF91bml0ICp1bml0KQogICAgIH0KIAogICAgIHVuaXQtPnZjcHVfbGlzdC0+c2NoZWRfdW5p
dCA9IE5VTEw7CisKKyAgICBmcmVlX2NwdW1hc2tfdmFyKHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5
KTsKKyAgICBmcmVlX2NwdW1hc2tfdmFyKHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5X3NhdmVkKTsK
KyAgICBmcmVlX2NwdW1hc2tfdmFyKHVuaXQtPmNwdV9zb2Z0X2FmZmluaXR5KTsKKwogICAgIHhm
cmVlKHVuaXQpOwogfQogCkBAIC0zNTMsOSArMzU4LDE4IEBAIHN0YXRpYyBzdHJ1Y3Qgc2NoZWRf
dW5pdCAqc2NoZWRfYWxsb2NfdW5pdChzdHJ1Y3QgdmNwdSAqdikKICAgICB1bml0LT5uZXh0X2lu
X2xpc3QgPSAqcHJldl91bml0OwogICAgICpwcmV2X3VuaXQgPSB1bml0OwogCisgICAgaWYgKCAh
emFsbG9jX2NwdW1hc2tfdmFyKCZ1bml0LT5jcHVfaGFyZF9hZmZpbml0eSkgfHwKKyAgICAgICAg
ICF6YWxsb2NfY3B1bWFza192YXIoJnVuaXQtPmNwdV9oYXJkX2FmZmluaXR5X3NhdmVkKSB8fAor
ICAgICAgICAgIXphbGxvY19jcHVtYXNrX3ZhcigmdW5pdC0+Y3B1X3NvZnRfYWZmaW5pdHkpICkK
KyAgICAgICAgZ290byBmYWlsOworCiAgICAgdi0+c2NoZWRfdW5pdCA9IHVuaXQ7CiAKICAgICBy
ZXR1cm4gdW5pdDsKKworIGZhaWw6CisgICAgc2NoZWRfZnJlZV91bml0KHVuaXQpOworICAgIHJl
dHVybiBOVUxMOwogfQogCiBpbnQgc2NoZWRfaW5pdF92Y3B1KHN0cnVjdCB2Y3B1ICp2LCB1bnNp
Z25lZCBpbnQgcHJvY2Vzc29yKQpAQCAtNzQ1LDcgKzc1OSw3IEBAIHN0YXRpYyB2b2lkIHZjcHVf
bWlncmF0ZV9maW5pc2goc3RydWN0IHZjcHUgKnYpCiAgICAgICAgICAgICAgKi8KICAgICAgICAg
ICAgIGlmICggcGlja19jYWxsZWQgJiYKICAgICAgICAgICAgICAgICAgKG5ld19sb2NrID09IGdl
dF9zY2hlZF9yZXMobmV3X2NwdSktPnNjaGVkdWxlX2xvY2spICYmCi0gICAgICAgICAgICAgICAg
IGNwdW1hc2tfdGVzdF9jcHUobmV3X2NwdSwgdi0+Y3B1X2hhcmRfYWZmaW5pdHkpICYmCisgICAg
ICAgICAgICAgICAgIGNwdW1hc2tfdGVzdF9jcHUobmV3X2NwdSwgdi0+c2NoZWRfdW5pdC0+Y3B1
X2hhcmRfYWZmaW5pdHkpICYmCiAgICAgICAgICAgICAgICAgIGNwdW1hc2tfdGVzdF9jcHUobmV3
X2NwdSwgdi0+ZG9tYWluLT5jcHVwb29sLT5jcHVfdmFsaWQpICkKICAgICAgICAgICAgICAgICBi
cmVhazsKIApAQCAtODAzLDYgKzgxNyw3IEBAIHZvaWQgcmVzdG9yZV92Y3B1X2FmZmluaXR5KHN0
cnVjdCBkb21haW4gKmQpCiAgICAgewogICAgICAgICBzcGlubG9ja190ICpsb2NrOwogICAgICAg
ICB1bnNpZ25lZCBpbnQgb2xkX2NwdSA9IHYtPnByb2Nlc3NvcjsKKyAgICAgICAgc3RydWN0IHNj
aGVkX3VuaXQgKnVuaXQgPSB2LT5zY2hlZF91bml0OwogCiAgICAgICAgIEFTU0VSVCghdmNwdV9y
dW5uYWJsZSh2KSk7CiAKQEAgLTgxNCwxNyArODI5LDE3IEBAIHZvaWQgcmVzdG9yZV92Y3B1X2Fm
ZmluaXR5KHN0cnVjdCBkb21haW4gKmQpCiAgICAgICAgICAqIHNldCB2LT5wcm9jZXNzb3Igb2Yg
ZWFjaCBvZiB0aGVpciB2Q1BVcyB0byBzb21ldGhpbmcgdGhhdCB3aWxsCiAgICAgICAgICAqIG1h
a2Ugc2Vuc2UgZm9yIHRoZSBzY2hlZHVsZXIgb2YgdGhlIGNwdXBvb2wgaW4gd2hpY2ggdGhleSBh
cmUgaW4uCiAgICAgICAgICAqLwotICAgICAgICBsb2NrID0gdW5pdF9zY2hlZHVsZV9sb2NrX2ly
cSh2LT5zY2hlZF91bml0KTsKKyAgICAgICAgbG9jayA9IHVuaXRfc2NoZWR1bGVfbG9ja19pcnEo
dW5pdCk7CiAKLSAgICAgICAgY3B1bWFza19hbmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCB2
LT5jcHVfaGFyZF9hZmZpbml0eSwKKyAgICAgICAgY3B1bWFza19hbmQoY3B1bWFza19zY3JhdGNo
X2NwdShjcHUpLCB1bml0LT5jcHVfaGFyZF9hZmZpbml0eSwKICAgICAgICAgICAgICAgICAgICAg
Y3B1cG9vbF9kb21haW5fY3B1bWFzayhkKSk7CiAgICAgICAgIGlmICggY3B1bWFza19lbXB0eShj
cHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSkpICkKICAgICAgICAgewogICAgICAgICAgICAgaWYgKCB2
LT5hZmZpbml0eV9icm9rZW4gKQogICAgICAgICAgICAgewotICAgICAgICAgICAgICAgIHNjaGVk
X3NldF9hZmZpbml0eSh2LCB2LT5jcHVfaGFyZF9hZmZpbml0eV9zYXZlZCwgTlVMTCk7CisgICAg
ICAgICAgICAgICAgc2NoZWRfc2V0X2FmZmluaXR5KHYsIHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5
X3NhdmVkLCBOVUxMKTsKICAgICAgICAgICAgICAgICB2LT5hZmZpbml0eV9icm9rZW4gPSAwOwot
ICAgICAgICAgICAgICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwgdi0+
Y3B1X2hhcmRfYWZmaW5pdHksCisgICAgICAgICAgICAgICAgY3B1bWFza19hbmQoY3B1bWFza19z
Y3JhdGNoX2NwdShjcHUpLCB1bml0LT5jcHVfaGFyZF9hZmZpbml0eSwKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBjcHVwb29sX2RvbWFpbl9jcHVtYXNrKGQpKTsKICAgICAgICAgICAgIH0K
IApAQCAtODMyLDIxICs4NDcsMjAgQEAgdm9pZCByZXN0b3JlX3ZjcHVfYWZmaW5pdHkoc3RydWN0
IGRvbWFpbiAqZCkKICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICBwcmludGsoWEVOTE9H
X0RFQlVHICJCcmVha2luZyBhZmZpbml0eSBmb3IgJXB2XG4iLCB2KTsKICAgICAgICAgICAgICAg
ICBzY2hlZF9zZXRfYWZmaW5pdHkodiwgJmNwdW1hc2tfYWxsLCBOVUxMKTsKLSAgICAgICAgICAg
ICAgICBjcHVtYXNrX2FuZChjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksIHYtPmNwdV9oYXJkX2Fm
ZmluaXR5LAorICAgICAgICAgICAgICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9jcHUo
Y3B1KSwgdW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHksCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgY3B1cG9vbF9kb21haW5fY3B1bWFzayhkKSk7CiAgICAgICAgICAgICB9CiAgICAgICAgIH0K
IAogICAgICAgICB2LT5wcm9jZXNzb3IgPSBjcHVtYXNrX2FueShjcHVtYXNrX3NjcmF0Y2hfY3B1
KGNwdSkpOwotICAgICAgICB2LT5zY2hlZF91bml0LT5yZXMgPSBnZXRfc2NoZWRfcmVzKHYtPnBy
b2Nlc3Nvcik7CisgICAgICAgIHVuaXQtPnJlcyA9IGdldF9zY2hlZF9yZXModi0+cHJvY2Vzc29y
KTsKIAogICAgICAgICBzcGluX3VubG9ja19pcnEobG9jayk7CiAKICAgICAgICAgLyogdi0+cHJv
Y2Vzc29yIG1pZ2h0IGhhdmUgY2hhbmdlZCwgc28gcmVhY3F1aXJlIHRoZSBsb2NrLiAqLwotICAg
ICAgICBsb2NrID0gdW5pdF9zY2hlZHVsZV9sb2NrX2lycSh2LT5zY2hlZF91bml0KTsKLSAgICAg
ICAgdi0+c2NoZWRfdW5pdC0+cmVzID0gc2NoZWRfcGlja19yZXNvdXJjZSh2Y3B1X3NjaGVkdWxl
cih2KSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2
LT5zY2hlZF91bml0KTsKLSAgICAgICAgdi0+cHJvY2Vzc29yID0gdi0+c2NoZWRfdW5pdC0+cmVz
LT5tYXN0ZXJfY3B1OworICAgICAgICBsb2NrID0gdW5pdF9zY2hlZHVsZV9sb2NrX2lycSh1bml0
KTsKKyAgICAgICAgdW5pdC0+cmVzID0gc2NoZWRfcGlja19yZXNvdXJjZSh2Y3B1X3NjaGVkdWxl
cih2KSwgdW5pdCk7CisgICAgICAgIHYtPnByb2Nlc3NvciA9IHVuaXQtPnJlcy0+bWFzdGVyX2Nw
dTsKICAgICAgICAgc3Bpbl91bmxvY2tfaXJxKGxvY2spOwogCiAgICAgICAgIGlmICggb2xkX2Nw
dSAhPSB2LT5wcm9jZXNzb3IgKQpAQCAtODc4LDE2ICs4OTIsMTcgQEAgaW50IGNwdV9kaXNhYmxl
X3NjaGVkdWxlcih1bnNpZ25lZCBpbnQgY3B1KQogICAgICAgICBmb3JfZWFjaF92Y3B1ICggZCwg
diApCiAgICAgICAgIHsKICAgICAgICAgICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7Ci0gICAgICAg
ICAgICBzcGlubG9ja190ICpsb2NrID0gdW5pdF9zY2hlZHVsZV9sb2NrX2lycXNhdmUodi0+c2No
ZWRfdW5pdCwgJmZsYWdzKTsKKyAgICAgICAgICAgIHN0cnVjdCBzY2hlZF91bml0ICp1bml0ID0g
di0+c2NoZWRfdW5pdDsKKyAgICAgICAgICAgIHNwaW5sb2NrX3QgKmxvY2sgPSB1bml0X3NjaGVk
dWxlX2xvY2tfaXJxc2F2ZSh1bml0LCAmZmxhZ3MpOwogCi0gICAgICAgICAgICBjcHVtYXNrX2Fu
ZCgmb25saW5lX2FmZmluaXR5LCB2LT5jcHVfaGFyZF9hZmZpbml0eSwgYy0+Y3B1X3ZhbGlkKTsK
KyAgICAgICAgICAgIGNwdW1hc2tfYW5kKCZvbmxpbmVfYWZmaW5pdHksIHVuaXQtPmNwdV9oYXJk
X2FmZmluaXR5LCBjLT5jcHVfdmFsaWQpOwogICAgICAgICAgICAgaWYgKCBjcHVtYXNrX2VtcHR5
KCZvbmxpbmVfYWZmaW5pdHkpICYmCi0gICAgICAgICAgICAgICAgIGNwdW1hc2tfdGVzdF9jcHUo
Y3B1LCB2LT5jcHVfaGFyZF9hZmZpbml0eSkgKQorICAgICAgICAgICAgICAgICBjcHVtYXNrX3Rl
c3RfY3B1KGNwdSwgdW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHkpICkKICAgICAgICAgICAgIHsKICAg
ICAgICAgICAgICAgICBpZiAoIHYtPmFmZmluaXR5X2Jyb2tlbiApCiAgICAgICAgICAgICAgICAg
ewogICAgICAgICAgICAgICAgICAgICAvKiBUaGUgdmNwdSBpcyB0ZW1wb3JhcmlseSBwaW5uZWQs
IGNhbid0IG1vdmUgaXQuICovCi0gICAgICAgICAgICAgICAgICAgIHVuaXRfc2NoZWR1bGVfdW5s
b2NrX2lycXJlc3RvcmUobG9jaywgZmxhZ3MsIHYtPnNjaGVkX3VuaXQpOworICAgICAgICAgICAg
ICAgICAgICB1bml0X3NjaGVkdWxlX3VubG9ja19pcnFyZXN0b3JlKGxvY2ssIGZsYWdzLCB1bml0
KTsKICAgICAgICAgICAgICAgICAgICAgcmV0ID0gLUVBRERSSU5VU0U7CiAgICAgICAgICAgICAg
ICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgIH0KQEAgLTkwMCw3ICs5MTUsNyBAQCBpbnQg
Y3B1X2Rpc2FibGVfc2NoZWR1bGVyKHVuc2lnbmVkIGludCBjcHUpCiAgICAgICAgICAgICBpZiAo
IHYtPnByb2Nlc3NvciAhPSBjcHUgKQogICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIC8q
IFRoZSB2Y3B1IGlzIG5vdCBvbiB0aGlzIGNwdSwgc28gd2UgY2FuIG1vdmUgb24uICovCi0gICAg
ICAgICAgICAgICAgdW5pdF9zY2hlZHVsZV91bmxvY2tfaXJxcmVzdG9yZShsb2NrLCBmbGFncywg
di0+c2NoZWRfdW5pdCk7CisgICAgICAgICAgICAgICAgdW5pdF9zY2hlZHVsZV91bmxvY2tfaXJx
cmVzdG9yZShsb2NrLCBmbGFncywgdW5pdCk7CiAgICAgICAgICAgICAgICAgY29udGludWU7CiAg
ICAgICAgICAgICB9CiAKQEAgLTkxMyw3ICs5MjgsNyBAQCBpbnQgY3B1X2Rpc2FibGVfc2NoZWR1
bGVyKHVuc2lnbmVkIGludCBjcHUpCiAgICAgICAgICAgICAgKiAgICB0aGluZ3Mgd291bGQgaGF2
ZSBmYWlsZWQgYmVmb3JlIGdldHRpbmcgaW4gaGVyZS4KICAgICAgICAgICAgICAqLwogICAgICAg
ICAgICAgdmNwdV9taWdyYXRlX3N0YXJ0KHYpOwotICAgICAgICAgICAgdW5pdF9zY2hlZHVsZV91
bmxvY2tfaXJxcmVzdG9yZShsb2NrLCBmbGFncywgdi0+c2NoZWRfdW5pdCk7CisgICAgICAgICAg
ICB1bml0X3NjaGVkdWxlX3VubG9ja19pcnFyZXN0b3JlKGxvY2ssIGZsYWdzLCB1bml0KTsKIAog
ICAgICAgICAgICAgdmNwdV9taWdyYXRlX2ZpbmlzaCh2KTsKIApAQCAtOTU4LDI2ICs5NzMsMjkg
QEAgc3RhdGljIGludCBjcHVfZGlzYWJsZV9zY2hlZHVsZXJfY2hlY2sodW5zaWduZWQgaW50IGNw
dSkKIHZvaWQgc2NoZWRfc2V0X2FmZmluaXR5KAogICAgIHN0cnVjdCB2Y3B1ICp2LCBjb25zdCBj
cHVtYXNrX3QgKmhhcmQsIGNvbnN0IGNwdW1hc2tfdCAqc29mdCkKIHsKLSAgICBzY2hlZF9hZGp1
c3RfYWZmaW5pdHkoZG9tX3NjaGVkdWxlcih2LT5kb21haW4pLCB2LT5zY2hlZF91bml0LCBoYXJk
LCBzb2Z0KTsKKyAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCA9IHYtPnNjaGVkX3VuaXQ7CisK
KyAgICBzY2hlZF9hZGp1c3RfYWZmaW5pdHkoZG9tX3NjaGVkdWxlcih2LT5kb21haW4pLCB1bml0
LCBoYXJkLCBzb2Z0KTsKIAogICAgIGlmICggaGFyZCApCi0gICAgICAgIGNwdW1hc2tfY29weSh2
LT5jcHVfaGFyZF9hZmZpbml0eSwgaGFyZCk7CisgICAgICAgIGNwdW1hc2tfY29weSh1bml0LT5j
cHVfaGFyZF9hZmZpbml0eSwgaGFyZCk7CiAgICAgaWYgKCBzb2Z0ICkKLSAgICAgICAgY3B1bWFz
a19jb3B5KHYtPmNwdV9zb2Z0X2FmZmluaXR5LCBzb2Z0KTsKKyAgICAgICAgY3B1bWFza19jb3B5
KHVuaXQtPmNwdV9zb2Z0X2FmZmluaXR5LCBzb2Z0KTsKIAotICAgIHYtPnNvZnRfYWZmX2VmZmVj
dGl2ZSA9ICFjcHVtYXNrX3N1YnNldCh2LT5jcHVfaGFyZF9hZmZpbml0eSwKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi0+Y3B1X3NvZnRfYWZmaW5pdHkpICYm
Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3B1bWFza19pbnRlcnNlY3RzKHYtPmNwdV9z
b2Z0X2FmZmluaXR5LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICB2LT5jcHVfaGFyZF9hZmZpbml0eSk7CisgICAgdW5pdC0+c29mdF9hZmZfZWZmZWN0aXZl
ID0gIWNwdW1hc2tfc3Vic2V0KHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5LAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bml0LT5jcHVfc29mdF9hZmZpbml0
eSkgJiYKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcHVtYXNrX2ludGVyc2VjdHMo
dW5pdC0+Y3B1X3NvZnRfYWZmaW5pdHksCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5KTsKIH0KIAogc3RhdGlj
IGludCB2Y3B1X3NldF9hZmZpbml0eSgKICAgICBzdHJ1Y3QgdmNwdSAqdiwgY29uc3QgY3B1bWFz
a190ICphZmZpbml0eSwgY29uc3QgY3B1bWFza190ICp3aGljaCkKIHsKKyAgICBzdHJ1Y3Qgc2No
ZWRfdW5pdCAqdW5pdCA9IHYtPnNjaGVkX3VuaXQ7CiAgICAgc3BpbmxvY2tfdCAqbG9jazsKICAg
ICBpbnQgcmV0ID0gMDsKIAotICAgIGxvY2sgPSB1bml0X3NjaGVkdWxlX2xvY2tfaXJxKHYtPnNj
aGVkX3VuaXQpOworICAgIGxvY2sgPSB1bml0X3NjaGVkdWxlX2xvY2tfaXJxKHVuaXQpOwogCiAg
ICAgaWYgKCB2LT5hZmZpbml0eV9icm9rZW4gKQogICAgICAgICByZXQgPSAtRUJVU1k7CkBAIC05
ODcsMTkgKzEwMDUsMTkgQEAgc3RhdGljIGludCB2Y3B1X3NldF9hZmZpbml0eSgKICAgICAgICAg
ICogVGVsbCB0aGUgc2NoZWR1bGVyIHdlIGNoYW5nZXMgc29tZXRoaW5nIGFib3V0IGFmZmluaXR5
LAogICAgICAgICAgKiBhbmQgYXNrIHRvIHJlLWV2YWx1YXRlIHZjcHUgcGxhY2VtZW50LgogICAg
ICAgICAgKi8KLSAgICAgICAgaWYgKCB3aGljaCA9PSB2LT5jcHVfaGFyZF9hZmZpbml0eSApCisg
ICAgICAgIGlmICggd2hpY2ggPT0gdW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHkgKQogICAgICAgICB7
CiAgICAgICAgICAgICBzY2hlZF9zZXRfYWZmaW5pdHkodiwgYWZmaW5pdHksIE5VTEwpOwogICAg
ICAgICB9CiAgICAgICAgIGVsc2UKICAgICAgICAgewotICAgICAgICAgICAgQVNTRVJUKHdoaWNo
ID09IHYtPmNwdV9zb2Z0X2FmZmluaXR5KTsKKyAgICAgICAgICAgIEFTU0VSVCh3aGljaCA9PSB1
bml0LT5jcHVfc29mdF9hZmZpbml0eSk7CiAgICAgICAgICAgICBzY2hlZF9zZXRfYWZmaW5pdHko
diwgTlVMTCwgYWZmaW5pdHkpOwogICAgICAgICB9CiAgICAgICAgIHZjcHVfbWlncmF0ZV9zdGFy
dCh2KTsKICAgICB9CiAKLSAgICB1bml0X3NjaGVkdWxlX3VubG9ja19pcnEobG9jaywgdi0+c2No
ZWRfdW5pdCk7CisgICAgdW5pdF9zY2hlZHVsZV91bmxvY2tfaXJxKGxvY2ssIHVuaXQpOwogCiAg
ICAgZG9tYWluX3VwZGF0ZV9ub2RlX2FmZmluaXR5KHYtPmRvbWFpbik7CiAKQEAgLTEwMTgsMTIg
KzEwMzYsMTIgQEAgaW50IHZjcHVfc2V0X2hhcmRfYWZmaW5pdHkoc3RydWN0IHZjcHUgKnYsIGNv
bnN0IGNwdW1hc2tfdCAqYWZmaW5pdHkpCiAgICAgaWYgKCBjcHVtYXNrX2VtcHR5KCZvbmxpbmVf
YWZmaW5pdHkpICkKICAgICAgICAgcmV0dXJuIC1FSU5WQUw7CiAKLSAgICByZXR1cm4gdmNwdV9z
ZXRfYWZmaW5pdHkodiwgYWZmaW5pdHksIHYtPmNwdV9oYXJkX2FmZmluaXR5KTsKKyAgICByZXR1
cm4gdmNwdV9zZXRfYWZmaW5pdHkodiwgYWZmaW5pdHksIHYtPnNjaGVkX3VuaXQtPmNwdV9oYXJk
X2FmZmluaXR5KTsKIH0KIAogaW50IHZjcHVfc2V0X3NvZnRfYWZmaW5pdHkoc3RydWN0IHZjcHUg
KnYsIGNvbnN0IGNwdW1hc2tfdCAqYWZmaW5pdHkpCiB7Ci0gICAgcmV0dXJuIHZjcHVfc2V0X2Fm
ZmluaXR5KHYsIGFmZmluaXR5LCB2LT5jcHVfc29mdF9hZmZpbml0eSk7CisgICAgcmV0dXJuIHZj
cHVfc2V0X2FmZmluaXR5KHYsIGFmZmluaXR5LCB2LT5zY2hlZF91bml0LT5jcHVfc29mdF9hZmZp
bml0eSk7CiB9CiAKIC8qIEJsb2NrIHRoZSBjdXJyZW50bHktZXhlY3V0aW5nIGRvbWFpbiB1bnRp
bCBhIHBlcnRpbmVudCBldmVudCBvY2N1cnMuICovCkBAIC0xMjI3LDExICsxMjQ1LDEyIEBAIHZv
aWQgd2F0Y2hkb2dfZG9tYWluX2Rlc3Ryb3koc3RydWN0IGRvbWFpbiAqZCkKICAqLwogaW50IHZj
cHVfdGVtcG9yYXJ5X2FmZmluaXR5KHN0cnVjdCB2Y3B1ICp2LCB1bnNpZ25lZCBpbnQgY3B1LCB1
aW50OF90IHJlYXNvbikKIHsKKyAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCA9IHYtPnNjaGVk
X3VuaXQ7CiAgICAgc3BpbmxvY2tfdCAqbG9jazsKICAgICBpbnQgcmV0ID0gLUVJTlZBTDsKICAg
ICBib29sIG1pZ3JhdGU7CiAKLSAgICBsb2NrID0gdW5pdF9zY2hlZHVsZV9sb2NrX2lycSh2LT5z
Y2hlZF91bml0KTsKKyAgICBsb2NrID0gdW5pdF9zY2hlZHVsZV9sb2NrX2lycSh1bml0KTsKIAog
ICAgIGlmICggY3B1ID09IE5SX0NQVVMgKQogICAgIHsKQEAgLTEyNDEsNyArMTI2MCw3IEBAIGlu
dCB2Y3B1X3RlbXBvcmFyeV9hZmZpbml0eShzdHJ1Y3QgdmNwdSAqdiwgdW5zaWduZWQgaW50IGNw
dSwgdWludDhfdCByZWFzb24pCiAgICAgICAgICAgICB2LT5hZmZpbml0eV9icm9rZW4gJj0gfnJl
YXNvbjsKICAgICAgICAgfQogICAgICAgICBpZiAoICFyZXQgJiYgIXYtPmFmZmluaXR5X2Jyb2tl
biApCi0gICAgICAgICAgICBzY2hlZF9zZXRfYWZmaW5pdHkodiwgdi0+Y3B1X2hhcmRfYWZmaW5p
dHlfc2F2ZWQsIE5VTEwpOworICAgICAgICAgICAgc2NoZWRfc2V0X2FmZmluaXR5KHYsIHVuaXQt
PmNwdV9oYXJkX2FmZmluaXR5X3NhdmVkLCBOVUxMKTsKICAgICB9CiAgICAgZWxzZSBpZiAoIGNw
dSA8IG5yX2NwdV9pZHMgKQogICAgIHsKQEAgLTEyNTIsNyArMTI3MSw4IEBAIGludCB2Y3B1X3Rl
bXBvcmFyeV9hZmZpbml0eShzdHJ1Y3QgdmNwdSAqdiwgdW5zaWduZWQgaW50IGNwdSwgdWludDhf
dCByZWFzb24pCiAgICAgICAgIHsKICAgICAgICAgICAgIGlmICggIXYtPmFmZmluaXR5X2Jyb2tl
biApCiAgICAgICAgICAgICB7Ci0gICAgICAgICAgICAgICAgY3B1bWFza19jb3B5KHYtPmNwdV9o
YXJkX2FmZmluaXR5X3NhdmVkLCB2LT5jcHVfaGFyZF9hZmZpbml0eSk7CisgICAgICAgICAgICAg
ICAgY3B1bWFza19jb3B5KHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5X3NhdmVkLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICB1bml0LT5jcHVfaGFyZF9hZmZpbml0eSk7CiAgICAgICAgICAg
ICAgICAgc2NoZWRfc2V0X2FmZmluaXR5KHYsIGNwdW1hc2tfb2YoY3B1KSwgTlVMTCk7CiAgICAg
ICAgICAgICB9CiAgICAgICAgICAgICB2LT5hZmZpbml0eV9icm9rZW4gfD0gcmVhc29uOwpAQCAt
MTI2MCwxMSArMTI4MCwxMSBAQCBpbnQgdmNwdV90ZW1wb3JhcnlfYWZmaW5pdHkoc3RydWN0IHZj
cHUgKnYsIHVuc2lnbmVkIGludCBjcHUsIHVpbnQ4X3QgcmVhc29uKQogICAgICAgICB9CiAgICAg
fQogCi0gICAgbWlncmF0ZSA9ICFyZXQgJiYgIWNwdW1hc2tfdGVzdF9jcHUodi0+cHJvY2Vzc29y
LCB2LT5jcHVfaGFyZF9hZmZpbml0eSk7CisgICAgbWlncmF0ZSA9ICFyZXQgJiYgIWNwdW1hc2tf
dGVzdF9jcHUodi0+cHJvY2Vzc29yLCB1bml0LT5jcHVfaGFyZF9hZmZpbml0eSk7CiAgICAgaWYg
KCBtaWdyYXRlICkKICAgICAgICAgdmNwdV9taWdyYXRlX3N0YXJ0KHYpOwogCi0gICAgdW5pdF9z
Y2hlZHVsZV91bmxvY2tfaXJxKGxvY2ssIHYtPnNjaGVkX3VuaXQpOworICAgIHVuaXRfc2NoZWR1
bGVfdW5sb2NrX2lycShsb2NrLCB1bml0KTsKIAogICAgIGlmICggbWlncmF0ZSApCiAgICAgICAg
IHZjcHVfbWlncmF0ZV9maW5pc2godik7CmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS94ZW4vc2No
ZWQtaWYuaCBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5oCmluZGV4IGYyYzA3MTM1OGYuLjZl
NWQ4MTNkNmMgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5oCisrKyBiL3hl
bi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5oCkBAIC00NDIsMTEgKzQ0MiwxMSBAQCBzdGF0aWMgaW5s
aW5lIGNwdW1hc2tfdCogY3B1cG9vbF9kb21haW5fY3B1bWFzayhzdHJ1Y3QgZG9tYWluICpkKQog
ICogKiBUaGUgaGFyZCBhZmZpbml0eSBpcyBub3QgYSBzdWJzZXQgb2Ygc29mdCBhZmZpbml0eQog
ICogKiBUaGVyZSBpcyBhbiBvdmVybGFwIGJldHdlZW4gdGhlIHNvZnQgYW5kIGhhcmQgYWZmaW5p
dHkgbWFza3MKICAqLwotc3RhdGljIGlubGluZSBpbnQgaGFzX3NvZnRfYWZmaW5pdHkoY29uc3Qg
c3RydWN0IHZjcHUgKnYpCitzdGF0aWMgaW5saW5lIGludCBoYXNfc29mdF9hZmZpbml0eShjb25z
dCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIHsKLSAgICByZXR1cm4gdi0+c29mdF9hZmZfZWZm
ZWN0aXZlICYmCi0gICAgICAgICAgICFjcHVtYXNrX3N1YnNldChjcHVwb29sX2RvbWFpbl9jcHVt
YXNrKHYtPmRvbWFpbiksCi0gICAgICAgICAgICAgICAgICAgICAgICAgICB2LT5jcHVfc29mdF9h
ZmZpbml0eSk7CisgICAgcmV0dXJuIHVuaXQtPnNvZnRfYWZmX2VmZmVjdGl2ZSAmJgorICAgICAg
ICAgICAhY3B1bWFza19zdWJzZXQoY3B1cG9vbF9kb21haW5fY3B1bWFzayh1bml0LT5kb21haW4p
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5pdC0+Y3B1X3NvZnRfYWZmaW5pdHkpOwog
fQogCiAvKgpAQCAtNDU2LDE3ICs0NTYsMTggQEAgc3RhdGljIGlubGluZSBpbnQgaGFzX3NvZnRf
YWZmaW5pdHkoY29uc3Qgc3RydWN0IHZjcHUgKnYpCiAgKiB0byBhdm9pZCBydW5uaW5nIGEgdmNw
dSB3aGVyZSBpdCB3b3VsZCBsaWtlLCBidXQgaXMgbm90IGFsbG93ZWQgdG8hCiAgKi8KIHN0YXRp
YyBpbmxpbmUgdm9pZAotYWZmaW5pdHlfYmFsYW5jZV9jcHVtYXNrKGNvbnN0IHN0cnVjdCB2Y3B1
ICp2LCBpbnQgc3RlcCwgY3B1bWFza190ICptYXNrKQorYWZmaW5pdHlfYmFsYW5jZV9jcHVtYXNr
KGNvbnN0IHN0cnVjdCBzY2hlZF91bml0ICp1bml0LCBpbnQgc3RlcCwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICBjcHVtYXNrX3QgKm1hc2spCiB7CiAgICAgaWYgKCBzdGVwID09IEJBTEFOQ0Vf
U09GVF9BRkZJTklUWSApCiAgICAgewotICAgICAgICBjcHVtYXNrX2FuZChtYXNrLCB2LT5jcHVf
c29mdF9hZmZpbml0eSwgdi0+Y3B1X2hhcmRfYWZmaW5pdHkpOworICAgICAgICBjcHVtYXNrX2Fu
ZChtYXNrLCB1bml0LT5jcHVfc29mdF9hZmZpbml0eSwgdW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHkp
OwogCiAgICAgICAgIGlmICggdW5saWtlbHkoY3B1bWFza19lbXB0eShtYXNrKSkgKQotICAgICAg
ICAgICAgY3B1bWFza19jb3B5KG1hc2ssIHYtPmNwdV9oYXJkX2FmZmluaXR5KTsKKyAgICAgICAg
ICAgIGNwdW1hc2tfY29weShtYXNrLCB1bml0LT5jcHVfaGFyZF9hZmZpbml0eSk7CiAgICAgfQog
ICAgIGVsc2UgLyogc3RlcCA9PSBCQUxBTkNFX0hBUkRfQUZGSU5JVFkgKi8KLSAgICAgICAgY3B1
bWFza19jb3B5KG1hc2ssIHYtPmNwdV9oYXJkX2FmZmluaXR5KTsKKyAgICAgICAgY3B1bWFza19j
b3B5KG1hc2ssIHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5KTsKIH0KIAogdm9pZCBzY2hlZF9ybV9j
cHUodW5zaWduZWQgaW50IGNwdSk7CmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQu
aCBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCmluZGV4IGZjMjlkNzJiNTcuLjMyMjdkMmZlNzEg
MTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCisrKyBiL3hlbi9pbmNsdWRlL3hl
bi9zY2hlZC5oCkBAIC0yMTIsOSArMjEyLDYgQEAgc3RydWN0IHZjcHUKICAgICBib29sICAgICAg
ICAgICAgIGhjYWxsX2NvbXBhdDsKICNlbmRpZgogCi0gICAgLyogRG9lcyBzb2Z0IGFmZmluaXR5
IGFjdHVhbGx5IHBsYXkgYSByb2xlIChnaXZlbiBoYXJkIGFmZmluaXR5KT8gKi8KLSAgICBib29s
ICAgICAgICAgICAgIHNvZnRfYWZmX2VmZmVjdGl2ZTsKLQogICAgIC8qIFRoZSBDUFUsIGlmIGFu
eSwgd2hpY2ggaXMgaG9sZGluZyBvbnRvIHRoaXMgVkNQVSdzIHN0YXRlLiAqLwogI2RlZmluZSBW
Q1BVX0NQVV9DTEVBTiAofjB1KQogICAgIHVuc2lnbmVkIGludCAgICAgZGlydHlfY3B1OwpAQCAt
MjQ2LDE0ICsyNDMsNiBAQCBzdHJ1Y3QgdmNwdQogICAgIGV2dGNobl9wb3J0X3QgICAgdmlycV90
b19ldnRjaG5bTlJfVklSUVNdOwogICAgIHNwaW5sb2NrX3QgICAgICAgdmlycV9sb2NrOwogCi0g
ICAgLyogQml0bWFzayBvZiBDUFVzIG9uIHdoaWNoIHRoaXMgVkNQVSBtYXkgcnVuLiAqLwotICAg
IGNwdW1hc2tfdmFyX3QgICAgY3B1X2hhcmRfYWZmaW5pdHk7Ci0gICAgLyogVXNlZCB0byBzYXZl
IGFmZmluaXR5IGR1cmluZyB0ZW1wb3JhcnkgcGlubmluZy4gKi8KLSAgICBjcHVtYXNrX3Zhcl90
ICAgIGNwdV9oYXJkX2FmZmluaXR5X3NhdmVkOwotCi0gICAgLyogQml0bWFzayBvZiBDUFVzIG9u
IHdoaWNoIHRoaXMgVkNQVSBwcmVmZXJzIHRvIHJ1bi4gKi8KLSAgICBjcHVtYXNrX3Zhcl90ICAg
IGNwdV9zb2Z0X2FmZmluaXR5OwotCiAgICAgLyogVGFza2xldCBmb3IgY29udGludWVfaHlwZXJj
YWxsX29uX2NwdSgpLiAqLwogICAgIHN0cnVjdCB0YXNrbGV0ICAgY29udGludWVfaHlwZXJjYWxs
X3Rhc2tsZXQ7CiAKQEAgLTI4MCw2ICsyNjksMTUgQEAgc3RydWN0IHNjaGVkX3VuaXQgewogICAg
IHN0cnVjdCBzY2hlZF91bml0ICAgICAqbmV4dF9pbl9saXN0OwogICAgIHN0cnVjdCBzY2hlZF9y
ZXNvdXJjZSAqcmVzOwogICAgIHVuc2lnbmVkIGludCAgICAgICAgICAgdW5pdF9pZDsKKworICAg
IC8qIERvZXMgc29mdCBhZmZpbml0eSBhY3R1YWxseSBwbGF5IGEgcm9sZSAoZ2l2ZW4gaGFyZCBh
ZmZpbml0eSk/ICovCisgICAgYm9vbCAgICAgICAgICAgICAgICAgICBzb2Z0X2FmZl9lZmZlY3Rp
dmU7CisgICAgLyogQml0bWFzayBvZiBDUFVzIG9uIHdoaWNoIHRoaXMgVkNQVSBtYXkgcnVuLiAq
LworICAgIGNwdW1hc2tfdmFyX3QgICAgICAgICAgY3B1X2hhcmRfYWZmaW5pdHk7CisgICAgLyog
VXNlZCB0byBzYXZlIGFmZmluaXR5IGR1cmluZyB0ZW1wb3JhcnkgcGlubmluZy4gKi8KKyAgICBj
cHVtYXNrX3Zhcl90ICAgICAgICAgIGNwdV9oYXJkX2FmZmluaXR5X3NhdmVkOworICAgIC8qIEJp
dG1hc2sgb2YgQ1BVcyBvbiB3aGljaCB0aGlzIFZDUFUgcHJlZmVycyB0byBydW4uICovCisgICAg
Y3B1bWFza192YXJfdCAgICAgICAgICBjcHVfc29mdF9hZmZpbml0eTsKIH07CiAKICNkZWZpbmUg
Zm9yX2VhY2hfc2NoZWRfdW5pdChkLCB1KSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgXApAQCAtOTk4LDcgKzk5Niw3IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBoYXBfZW5h
YmxlZChjb25zdCBzdHJ1Y3QgZG9tYWluICpkKQogc3RhdGljIGlubGluZSBib29sIGlzX2h3ZG9t
X3Bpbm5lZF92Y3B1KGNvbnN0IHN0cnVjdCB2Y3B1ICp2KQogewogICAgIHJldHVybiAoaXNfaGFy
ZHdhcmVfZG9tYWluKHYtPmRvbWFpbikgJiYKLSAgICAgICAgICAgIGNwdW1hc2tfd2VpZ2h0KHYt
PmNwdV9oYXJkX2FmZmluaXR5KSA9PSAxKTsKKyAgICAgICAgICAgIGNwdW1hc2tfd2VpZ2h0KHYt
PnNjaGVkX3VuaXQtPmNwdV9oYXJkX2FmZmluaXR5KSA9PSAxKTsKIH0KIAogc3RhdGljIGlubGlu
ZSBib29sIGlzX3ZjcHVfb25saW5lKGNvbnN0IHN0cnVjdCB2Y3B1ICp2KQotLSAKMi4xNi40CgoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVs
IG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0
cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

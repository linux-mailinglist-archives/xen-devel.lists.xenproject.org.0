Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 19F0BBFFAC
	for <lists+xen-devel@lfdr.de>; Fri, 27 Sep 2019 09:05:16 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iDkH3-0005MU-K2; Fri, 27 Sep 2019 07:02:41 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=Rbpq=XW=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1iDkGz-0005Ge-Sw
 for xen-devel@lists.xenproject.org; Fri, 27 Sep 2019 07:02:37 +0000
X-Inumbo-ID: 95397b5e-e0f4-11e9-b588-bc764e2007e4
Received: from mx1.suse.de (unknown [195.135.220.15])
 by localhost (Halon) with ESMTPS
 id 95397b5e-e0f4-11e9-b588-bc764e2007e4;
 Fri, 27 Sep 2019 07:01:09 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 0417AAE61;
 Fri, 27 Sep 2019 07:01:08 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Fri, 27 Sep 2019 09:00:48 +0200
Message-Id: <20190927070050.12405-45-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190927070050.12405-1-jgross@suse.com>
References: <20190927070050.12405-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v4 44/46] xen/sched: support core scheduling for
 moving cpus to/from cpupools
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Tim Deegan <tim@xen.org>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Dario Faggioli <dfaggioli@suse.com>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

V2l0aCBjb3JlIHNjaGVkdWxpbmcgYWN0aXZlIGl0IGlzIG5lY2Vzc2FyeSB0byBtb3ZlIG11bHRp
cGxlIGNwdXMgYXQKdGhlIHNhbWUgdGltZSB0byBvciBmcm9tIGEgY3B1cG9vbCBpbiBvcmRlciB0
byBhdm9pZCBzcGxpdCBzY2hlZHVsaW5nCnJlc291cmNlcyBpbiBiZXR3ZWVuLgoKU2lnbmVkLW9m
Zi1ieTogSnVlcmdlbiBHcm9zcyA8amdyb3NzQHN1c2UuY29tPgotLS0KVjE6IG5ldyBwYXRjaAot
LS0KIHhlbi9jb21tb24vY3B1cG9vbC5jICAgICAgIHwgMTAwICsrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKy0tLS0tLS0tLS0tLQogeGVuL2NvbW1vbi9zY2hlZHVsZS5jICAgICAgfCAg
IDMgKy0KIHhlbi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5oIHwgICAxICsKIDMgZmlsZXMgY2hhbmdl
ZCwgNzYgaW5zZXJ0aW9ucygrKSwgMjggZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEveGVuL2Nv
bW1vbi9jcHVwb29sLmMgYi94ZW4vY29tbW9uL2NwdXBvb2wuYwppbmRleCAwNGMzYjNjMDRiLi5m
N2ExM2M3YTRjIDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL2NwdXBvb2wuYworKysgYi94ZW4vY29t
bW9uL2NwdXBvb2wuYwpAQCAtMjY4LDIzICsyNjgsMzAgQEAgc3RhdGljIGludCBjcHVwb29sX2Fz
c2lnbl9jcHVfbG9ja2VkKHN0cnVjdCBjcHVwb29sICpjLCB1bnNpZ25lZCBpbnQgY3B1KQogewog
ICAgIGludCByZXQ7CiAgICAgc3RydWN0IGRvbWFpbiAqZDsKKyAgICBjb25zdCBjcHVtYXNrX3Qg
KmNwdXM7CisKKyAgICBjcHVzID0gc2NoZWRfZ2V0X29wdF9jcHVtYXNrKGMtPmdyYW4sIGNwdSk7
CiAKICAgICBpZiAoIChjcHVwb29sX21vdmluZ19jcHUgPT0gY3B1KSAmJiAoYyAhPSBjcHVwb29s
X2NwdV9tb3ZpbmcpICkKICAgICAgICAgcmV0dXJuIC1FQUREUk5PVEFWQUlMOwotICAgIHJldCA9
IHNjaGVkdWxlX2NwdV9hZGQoY3B1LCBjKTsKKyAgICByZXQgPSBzY2hlZHVsZV9jcHVfYWRkKGNw
dW1hc2tfZmlyc3QoY3B1cyksIGMpOwogICAgIGlmICggcmV0ICkKICAgICAgICAgcmV0dXJuIHJl
dDsKIAotICAgIGNwdW1hc2tfY2xlYXJfY3B1KGNwdSwgJmNwdXBvb2xfZnJlZV9jcHVzKTsKKyAg
ICByY3VfcmVhZF9sb2NrKCZzY2hlZF9yZXNfcmN1bG9jayk7CisKKyAgICBjcHVtYXNrX2FuZG5v
dCgmY3B1cG9vbF9mcmVlX2NwdXMsICZjcHVwb29sX2ZyZWVfY3B1cywgY3B1cyk7CiAgICAgaWYg
KGNwdXBvb2xfbW92aW5nX2NwdSA9PSBjcHUpCiAgICAgewogICAgICAgICBjcHVwb29sX21vdmlu
Z19jcHUgPSAtMTsKICAgICAgICAgY3B1cG9vbF9wdXQoY3B1cG9vbF9jcHVfbW92aW5nKTsKICAg
ICAgICAgY3B1cG9vbF9jcHVfbW92aW5nID0gTlVMTDsKICAgICB9Ci0gICAgY3B1bWFza19zZXRf
Y3B1KGNwdSwgYy0+Y3B1X3ZhbGlkKTsKKyAgICBjcHVtYXNrX29yKGMtPmNwdV92YWxpZCwgYy0+
Y3B1X3ZhbGlkLCBjcHVzKTsKICAgICBjcHVtYXNrX2FuZChjLT5yZXNfdmFsaWQsIGMtPmNwdV92
YWxpZCwgJnNjaGVkX3Jlc19tYXNrKTsKIAorICAgIHJjdV9yZWFkX3VubG9jaygmc2NoZWRfcmVz
X3JjdWxvY2spOworCiAgICAgcmN1X3JlYWRfbG9jaygmZG9tbGlzdF9yZWFkX2xvY2spOwogICAg
IGZvcl9lYWNoX2RvbWFpbl9pbl9jcHVwb29sKGQsIGMpCiAgICAgewpAQCAtMjk4LDYgKzMwNSw3
IEBAIHN0YXRpYyBpbnQgY3B1cG9vbF9hc3NpZ25fY3B1X2xvY2tlZChzdHJ1Y3QgY3B1cG9vbCAq
YywgdW5zaWduZWQgaW50IGNwdSkKIHN0YXRpYyBpbnQgY3B1cG9vbF91bmFzc2lnbl9jcHVfZmlu
aXNoKHN0cnVjdCBjcHVwb29sICpjKQogewogICAgIGludCBjcHUgPSBjcHVwb29sX21vdmluZ19j
cHU7CisgICAgY29uc3QgY3B1bWFza190ICpjcHVzOwogICAgIHN0cnVjdCBkb21haW4gKmQ7CiAg
ICAgaW50IHJldDsKIApAQCAtMzEwLDcgKzMxOCwxMCBAQCBzdGF0aWMgaW50IGNwdXBvb2xfdW5h
c3NpZ25fY3B1X2ZpbmlzaChzdHJ1Y3QgY3B1cG9vbCAqYykKICAgICAgKi8KICAgICByY3VfcmVh
ZF9sb2NrKCZkb21saXN0X3JlYWRfbG9jayk7CiAgICAgcmV0ID0gY3B1X2Rpc2FibGVfc2NoZWR1
bGVyKGNwdSk7Ci0gICAgY3B1bWFza19zZXRfY3B1KGNwdSwgJmNwdXBvb2xfZnJlZV9jcHVzKTsK
KworICAgIHJjdV9yZWFkX2xvY2soJnNjaGVkX3Jlc19yY3Vsb2NrKTsKKyAgICBjcHVzID0gZ2V0
X3NjaGVkX3JlcyhjcHUpLT5jcHVzOworICAgIGNwdW1hc2tfb3IoJmNwdXBvb2xfZnJlZV9jcHVz
LCAmY3B1cG9vbF9mcmVlX2NwdXMsIGNwdXMpOwogCiAgICAgLyoKICAgICAgKiBjcHVfZGlzYWJs
ZV9zY2hlZHVsZXIoKSByZXR1cm5pbmcgYW4gZXJyb3IgZG9lc24ndCByZXF1aXJlIHJlc2V0dGlu
ZwpAQCAtMzIzLDcgKzMzNCw3IEBAIHN0YXRpYyBpbnQgY3B1cG9vbF91bmFzc2lnbl9jcHVfZmlu
aXNoKHN0cnVjdCBjcHVwb29sICpjKQogICAgIHsKICAgICAgICAgcmV0ID0gc2NoZWR1bGVfY3B1
X3JtKGNwdSk7CiAgICAgICAgIGlmICggcmV0ICkKLSAgICAgICAgICAgIGNwdW1hc2tfY2xlYXJf
Y3B1KGNwdSwgJmNwdXBvb2xfZnJlZV9jcHVzKTsKKyAgICAgICAgICAgIGNwdW1hc2tfYW5kbm90
KCZjcHVwb29sX2ZyZWVfY3B1cywgJmNwdXBvb2xfZnJlZV9jcHVzLCBjcHVzKTsKICAgICAgICAg
ZWxzZQogICAgICAgICB7CiAgICAgICAgICAgICBjcHVwb29sX21vdmluZ19jcHUgPSAtMTsKQEAg
LTMzMSw2ICszNDIsNyBAQCBzdGF0aWMgaW50IGNwdXBvb2xfdW5hc3NpZ25fY3B1X2ZpbmlzaChz
dHJ1Y3QgY3B1cG9vbCAqYykKICAgICAgICAgICAgIGNwdXBvb2xfY3B1X21vdmluZyA9IE5VTEw7
CiAgICAgICAgIH0KICAgICB9CisgICAgcmN1X3JlYWRfdW5sb2NrKCZzY2hlZF9yZXNfcmN1bG9j
ayk7CiAKICAgICBmb3JfZWFjaF9kb21haW5faW5fY3B1cG9vbChkLCBjKQogICAgIHsKQEAgLTM0
NSw2ICszNTcsNyBAQCBzdGF0aWMgaW50IGNwdXBvb2xfdW5hc3NpZ25fY3B1X3N0YXJ0KHN0cnVj
dCBjcHVwb29sICpjLCB1bnNpZ25lZCBpbnQgY3B1KQogewogICAgIGludCByZXQ7CiAgICAgc3Ry
dWN0IGRvbWFpbiAqZDsKKyAgICBjb25zdCBjcHVtYXNrX3QgKmNwdXM7CiAKICAgICBzcGluX2xv
Y2soJmNwdXBvb2xfbG9jayk7CiAgICAgcmV0ID0gLUVBRERSTk9UQVZBSUw7CkBAIC0zNTMsNyAr
MzY2LDExIEBAIHN0YXRpYyBpbnQgY3B1cG9vbF91bmFzc2lnbl9jcHVfc3RhcnQoc3RydWN0IGNw
dXBvb2wgKmMsIHVuc2lnbmVkIGludCBjcHUpCiAgICAgICAgIGdvdG8gb3V0OwogCiAgICAgcmV0
ID0gMDsKLSAgICBpZiAoIChjLT5uX2RvbSA+IDApICYmIChjcHVtYXNrX3dlaWdodChjLT5jcHVf
dmFsaWQpID09IDEpICYmCisgICAgcmN1X3JlYWRfbG9jaygmc2NoZWRfcmVzX3JjdWxvY2spOwor
ICAgIGNwdXMgPSBnZXRfc2NoZWRfcmVzKGNwdSktPmNwdXM7CisKKyAgICBpZiAoIChjLT5uX2Rv
bSA+IDApICYmCisgICAgICAgICAoY3B1bWFza193ZWlnaHQoYy0+Y3B1X3ZhbGlkKSA9PSBjcHVt
YXNrX3dlaWdodChjcHVzKSkgJiYKICAgICAgICAgIChjcHUgIT0gY3B1cG9vbF9tb3ZpbmdfY3B1
KSApCiAgICAgewogICAgICAgICByY3VfcmVhZF9sb2NrKCZkb21saXN0X3JlYWRfbG9jayk7CkBA
IC0zNzUsOSArMzkyLDEwIEBAIHN0YXRpYyBpbnQgY3B1cG9vbF91bmFzc2lnbl9jcHVfc3RhcnQo
c3RydWN0IGNwdXBvb2wgKmMsIHVuc2lnbmVkIGludCBjcHUpCiAgICAgY3B1cG9vbF9tb3Zpbmdf
Y3B1ID0gY3B1OwogICAgIGF0b21pY19pbmMoJmMtPnJlZmNudCk7CiAgICAgY3B1cG9vbF9jcHVf
bW92aW5nID0gYzsKLSAgICBjcHVtYXNrX2NsZWFyX2NwdShjcHUsIGMtPmNwdV92YWxpZCk7Cisg
ICAgY3B1bWFza19hbmRub3QoYy0+Y3B1X3ZhbGlkLCBjLT5jcHVfdmFsaWQsIGNwdXMpOwogICAg
IGNwdW1hc2tfYW5kKGMtPnJlc192YWxpZCwgYy0+Y3B1X3ZhbGlkLCAmc2NoZWRfcmVzX21hc2sp
OwogCisgICAgcmN1X3JlYWRfdW5sb2NrKCZkb21saXN0X3JlYWRfbG9jayk7CiBvdXQ6CiAgICAg
c3Bpbl91bmxvY2soJmNwdXBvb2xfbG9jayk7CiAKQEAgLTQxNywxMSArNDM1LDEzIEBAIHN0YXRp
YyBpbnQgY3B1cG9vbF91bmFzc2lnbl9jcHUoc3RydWN0IGNwdXBvb2wgKmMsIHVuc2lnbmVkIGlu
dCBjcHUpCiB7CiAgICAgaW50IHdvcmtfY3B1OwogICAgIGludCByZXQ7CisgICAgdW5zaWduZWQg
aW50IG1hc3Rlcl9jcHU7CiAKICAgICBkZWJ1Z3RyYWNlX3ByaW50aygiY3B1cG9vbF91bmFzc2ln
bl9jcHUocG9vbD0lZCxjcHU9JWQpXG4iLAogICAgICAgICAgICAgICAgICAgICAgIGMtPmNwdXBv
b2xfaWQsIGNwdSk7CiAKLSAgICByZXQgPSBjcHVwb29sX3VuYXNzaWduX2NwdV9zdGFydChjLCBj
cHUpOworICAgIG1hc3Rlcl9jcHUgPSBzY2hlZF9nZXRfcmVzb3VyY2VfY3B1KGNwdSk7CisgICAg
cmV0ID0gY3B1cG9vbF91bmFzc2lnbl9jcHVfc3RhcnQoYywgbWFzdGVyX2NwdSk7CiAgICAgaWYg
KCByZXQgKQogICAgIHsKICAgICAgICAgZGVidWd0cmFjZV9wcmludGsoImNwdXBvb2xfdW5hc3Np
Z25fY3B1KHBvb2w9JWQsY3B1PSVkKSByZXQgJWRcbiIsCkBAIC00MjksMTIgKzQ0OSwxMiBAQCBz
dGF0aWMgaW50IGNwdXBvb2xfdW5hc3NpZ25fY3B1KHN0cnVjdCBjcHVwb29sICpjLCB1bnNpZ25l
ZCBpbnQgY3B1KQogICAgICAgICByZXR1cm4gcmV0OwogICAgIH0KIAotICAgIHdvcmtfY3B1ID0g
c21wX3Byb2Nlc3Nvcl9pZCgpOwotICAgIGlmICggd29ya19jcHUgPT0gY3B1ICkKKyAgICB3b3Jr
X2NwdSA9IHNjaGVkX2dldF9yZXNvdXJjZV9jcHUoc21wX3Byb2Nlc3Nvcl9pZCgpKTsKKyAgICBp
ZiAoIHdvcmtfY3B1ID09IG1hc3Rlcl9jcHUgKQogICAgIHsKICAgICAgICAgd29ya19jcHUgPSBj
cHVtYXNrX2ZpcnN0KGNwdXBvb2wwLT5jcHVfdmFsaWQpOwotICAgICAgICBpZiAoIHdvcmtfY3B1
ID09IGNwdSApCi0gICAgICAgICAgICB3b3JrX2NwdSA9IGNwdW1hc2tfbmV4dChjcHUsIGNwdXBv
b2wwLT5jcHVfdmFsaWQpOworICAgICAgICBpZiAoIHdvcmtfY3B1ID09IG1hc3Rlcl9jcHUgKQor
ICAgICAgICAgICAgd29ya19jcHUgPSBjcHVtYXNrX2xhc3QoY3B1cG9vbDAtPmNwdV92YWxpZCk7
CiAgICAgfQogICAgIHJldHVybiBjb250aW51ZV9oeXBlcmNhbGxfb25fY3B1KHdvcmtfY3B1LCBj
cHVwb29sX3VuYXNzaWduX2NwdV9oZWxwZXIsIGMpOwogfQpAQCAtNTAwLDYgKzUyMCw3IEBAIHZv
aWQgY3B1cG9vbF9ybV9kb21haW4oc3RydWN0IGRvbWFpbiAqZCkKIHN0YXRpYyBpbnQgY3B1cG9v
bF9jcHVfYWRkKHVuc2lnbmVkIGludCBjcHUpCiB7CiAgICAgaW50IHJldCA9IDA7CisgICAgY29u
c3QgY3B1bWFza190ICpjcHVzOwogCiAgICAgc3Bpbl9sb2NrKCZjcHVwb29sX2xvY2spOwogICAg
IGNwdW1hc2tfY2xlYXJfY3B1KGNwdSwgJmNwdXBvb2xfbG9ja2VkX2NwdXMpOwpAQCAtNTEzLDcg
KzUzNCwxMSBAQCBzdGF0aWMgaW50IGNwdXBvb2xfY3B1X2FkZCh1bnNpZ25lZCBpbnQgY3B1KQog
ICAgICAqLwogICAgIHJjdV9yZWFkX2xvY2soJnNjaGVkX3Jlc19yY3Vsb2NrKTsKICAgICBnZXRf
c2NoZWRfcmVzKGNwdSktPmNwdXBvb2wgPSBOVUxMOwotICAgIHJldCA9IGNwdXBvb2xfYXNzaWdu
X2NwdV9sb2NrZWQoY3B1cG9vbDAsIGNwdSk7CisKKyAgICBjcHVzID0gc2NoZWRfZ2V0X29wdF9j
cHVtYXNrKGNwdXBvb2wwLT5ncmFuLCBjcHUpOworICAgIGlmICggY3B1bWFza19zdWJzZXQoY3B1
cywgJmNwdXBvb2xfZnJlZV9jcHVzKSApCisgICAgICAgIHJldCA9IGNwdXBvb2xfYXNzaWduX2Nw
dV9sb2NrZWQoY3B1cG9vbDAsIGNwdSk7CisKICAgICByY3VfcmVhZF91bmxvY2soJnNjaGVkX3Jl
c19yY3Vsb2NrKTsKIAogICAgIHNwaW5fdW5sb2NrKCZjcHVwb29sX2xvY2spOwpAQCAtNTQ4LDI3
ICs1NzMsMzMgQEAgc3RhdGljIHZvaWQgY3B1cG9vbF9jcHVfcmVtb3ZlKHVuc2lnbmVkIGludCBj
cHUpCiBzdGF0aWMgaW50IGNwdXBvb2xfY3B1X3JlbW92ZV9wcm9sb2d1ZSh1bnNpZ25lZCBpbnQg
Y3B1KQogewogICAgIGludCByZXQgPSAwOworICAgIGNwdW1hc2tfdCAqY3B1czsKKyAgICB1bnNp
Z25lZCBpbnQgbWFzdGVyX2NwdTsKIAogICAgIHNwaW5fbG9jaygmY3B1cG9vbF9sb2NrKTsKIAot
ICAgIGlmICggY3B1bWFza190ZXN0X2NwdShjcHUsICZjcHVwb29sX2xvY2tlZF9jcHVzKSApCisg
ICAgcmN1X3JlYWRfbG9jaygmc2NoZWRfcmVzX3JjdWxvY2spOworICAgIGNwdXMgPSBnZXRfc2No
ZWRfcmVzKGNwdSktPmNwdXM7CisgICAgbWFzdGVyX2NwdSA9IHNjaGVkX2dldF9yZXNvdXJjZV9j
cHUoY3B1KTsKKyAgICBpZiAoIGNwdW1hc2tfaW50ZXJzZWN0cyhjcHVzLCAmY3B1cG9vbF9sb2Nr
ZWRfY3B1cykgKQogICAgICAgICByZXQgPSAtRUJVU1k7CiAgICAgZWxzZQogICAgICAgICBjcHVt
YXNrX3NldF9jcHUoY3B1LCAmY3B1cG9vbF9sb2NrZWRfY3B1cyk7CisgICAgcmN1X3JlYWRfdW5s
b2NrKCZzY2hlZF9yZXNfcmN1bG9jayk7CiAKICAgICBzcGluX3VubG9jaygmY3B1cG9vbF9sb2Nr
KTsKIAogICAgIGlmICggcmV0ICkKICAgICAgICAgcmV0dXJuICByZXQ7CiAKLSAgICBpZiAoIGNw
dW1hc2tfdGVzdF9jcHUoY3B1LCBjcHVwb29sMC0+Y3B1X3ZhbGlkKSApCisgICAgaWYgKCBjcHVt
YXNrX3Rlc3RfY3B1KG1hc3Rlcl9jcHUsIGNwdXBvb2wwLT5jcHVfdmFsaWQpICkKICAgICB7CiAg
ICAgICAgIC8qIENwdXBvb2wwIGlzIHBvcHVsYXRlZCBvbmx5IGFmdGVyIGFsbCBjcHVzIGFyZSB1
cC4gKi8KICAgICAgICAgQVNTRVJUKHN5c3RlbV9zdGF0ZSA9PSBTWVNfU1RBVEVfYWN0aXZlKTsK
IAotICAgICAgICByZXQgPSBjcHVwb29sX3VuYXNzaWduX2NwdV9zdGFydChjcHVwb29sMCwgY3B1
KTsKKyAgICAgICAgcmV0ID0gY3B1cG9vbF91bmFzc2lnbl9jcHVfc3RhcnQoY3B1cG9vbDAsIG1h
c3Rlcl9jcHUpOwogICAgIH0KLSAgICBlbHNlIGlmICggIWNwdW1hc2tfdGVzdF9jcHUoY3B1LCAm
Y3B1cG9vbF9mcmVlX2NwdXMpICkKKyAgICBlbHNlIGlmICggIWNwdW1hc2tfdGVzdF9jcHUobWFz
dGVyX2NwdSwgJmNwdXBvb2xfZnJlZV9jcHVzKSApCiAgICAgICAgIHJldCA9IC1FTk9ERVY7CiAK
ICAgICByZXR1cm4gcmV0OwpAQCAtNTg1LDEyICs2MTYsMTMgQEAgc3RhdGljIHZvaWQgY3B1cG9v
bF9jcHVfcmVtb3ZlX2ZvcmNlZCh1bnNpZ25lZCBpbnQgY3B1KQogewogICAgIHN0cnVjdCBjcHVw
b29sICoqYzsKICAgICBpbnQgcmV0OworICAgIHVuc2lnbmVkIGludCBtYXN0ZXJfY3B1ID0gc2No
ZWRfZ2V0X3Jlc291cmNlX2NwdShjcHUpOwogCiAgICAgZm9yX2VhY2hfY3B1cG9vbCAoIGMgKQog
ICAgIHsKLSAgICAgICAgaWYgKCBjcHVtYXNrX3Rlc3RfY3B1KGNwdSwgKCpjKS0+Y3B1X3ZhbGlk
KSApCisgICAgICAgIGlmICggY3B1bWFza190ZXN0X2NwdShtYXN0ZXJfY3B1LCAoKmMpLT5jcHVf
dmFsaWQpICkKICAgICAgICAgewotICAgICAgICAgICAgcmV0ID0gY3B1cG9vbF91bmFzc2lnbl9j
cHVfc3RhcnQoKmMsIGNwdSk7CisgICAgICAgICAgICByZXQgPSBjcHVwb29sX3VuYXNzaWduX2Nw
dV9zdGFydCgqYywgbWFzdGVyX2NwdSk7CiAgICAgICAgICAgICBCVUdfT04ocmV0KTsKICAgICAg
ICAgICAgIHJldCA9IGNwdXBvb2xfdW5hc3NpZ25fY3B1X2ZpbmlzaCgqYyk7CiAgICAgICAgICAg
ICBCVUdfT04ocmV0KTsKQEAgLTY1OCwyOSArNjkwLDQ1IEBAIGludCBjcHVwb29sX2RvX3N5c2N0
bChzdHJ1Y3QgeGVuX3N5c2N0bF9jcHVwb29sX29wICpvcCkKICAgICBjYXNlIFhFTl9TWVNDVExf
Q1BVUE9PTF9PUF9BRERDUFU6CiAgICAgewogICAgICAgICB1bnNpZ25lZCBjcHU7CisgICAgICAg
IGNvbnN0IGNwdW1hc2tfdCAqY3B1czsKIAogICAgICAgICBjcHUgPSBvcC0+Y3B1OwogICAgICAg
ICBkZWJ1Z3RyYWNlX3ByaW50aygiY3B1cG9vbF9hc3NpZ25fY3B1KHBvb2w9JWQsY3B1PSVkKVxu
IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgb3AtPmNwdXBvb2xfaWQsIGNwdSk7CisKICAg
ICAgICAgc3Bpbl9sb2NrKCZjcHVwb29sX2xvY2spOworCisgICAgICAgIGMgPSBjcHVwb29sX2Zp
bmRfYnlfaWQob3AtPmNwdXBvb2xfaWQpOworICAgICAgICByZXQgPSAtRU5PRU5UOworICAgICAg
ICBpZiAoIGMgPT0gTlVMTCApCisgICAgICAgICAgICBnb3RvIGFkZGNwdV9vdXQ7CiAgICAgICAg
IGlmICggY3B1ID09IFhFTl9TWVNDVExfQ1BVUE9PTF9QQVJfQU5ZICkKLSAgICAgICAgICAgIGNw
dSA9IGNwdW1hc2tfZmlyc3QoJmNwdXBvb2xfZnJlZV9jcHVzKTsKKyAgICAgICAgeworICAgICAg
ICAgICAgZm9yX2VhY2hfY3B1ICggY3B1LCAmY3B1cG9vbF9mcmVlX2NwdXMgKQorICAgICAgICAg
ICAgeworICAgICAgICAgICAgICAgIGNwdXMgPSBzY2hlZF9nZXRfb3B0X2NwdW1hc2soYy0+Z3Jh
biwgY3B1KTsKKyAgICAgICAgICAgICAgICBpZiAoIGNwdW1hc2tfc3Vic2V0KGNwdXMsICZjcHVw
b29sX2ZyZWVfY3B1cykgKQorICAgICAgICAgICAgICAgICAgICBicmVhazsKKyAgICAgICAgICAg
IH0KKyAgICAgICAgICAgIHJldCA9IC1FTk9ERVY7CisgICAgICAgICAgICBpZiAoIGNwdSA+PSBu
cl9jcHVfaWRzICkKKyAgICAgICAgICAgICAgICBnb3RvIGFkZGNwdV9vdXQ7CisgICAgICAgIH0K
ICAgICAgICAgcmV0ID0gLUVJTlZBTDsKICAgICAgICAgaWYgKCBjcHUgPj0gbnJfY3B1X2lkcyAp
CiAgICAgICAgICAgICBnb3RvIGFkZGNwdV9vdXQ7CiAgICAgICAgIHJldCA9IC1FTk9ERVY7Ci0g
ICAgICAgIGlmICggIWNwdW1hc2tfdGVzdF9jcHUoY3B1LCAmY3B1cG9vbF9mcmVlX2NwdXMpIHx8
Ci0gICAgICAgICAgICAgY3B1bWFza190ZXN0X2NwdShjcHUsICZjcHVwb29sX2xvY2tlZF9jcHVz
KSApCi0gICAgICAgICAgICBnb3RvIGFkZGNwdV9vdXQ7Ci0gICAgICAgIGMgPSBjcHVwb29sX2Zp
bmRfYnlfaWQob3AtPmNwdXBvb2xfaWQpOwotICAgICAgICByZXQgPSAtRU5PRU5UOwotICAgICAg
ICBpZiAoIGMgPT0gTlVMTCApCisgICAgICAgIGNwdXMgPSBzY2hlZF9nZXRfb3B0X2NwdW1hc2so
Yy0+Z3JhbiwgY3B1KTsKKyAgICAgICAgaWYgKCAhY3B1bWFza19zdWJzZXQoY3B1cywgJmNwdXBv
b2xfZnJlZV9jcHVzKSB8fAorICAgICAgICAgICAgIGNwdW1hc2tfaW50ZXJzZWN0cyhjcHVzLCAm
Y3B1cG9vbF9sb2NrZWRfY3B1cykgKQogICAgICAgICAgICAgZ290byBhZGRjcHVfb3V0OwogICAg
ICAgICByZXQgPSBjcHVwb29sX2Fzc2lnbl9jcHVfbG9ja2VkKGMsIGNwdSk7CisKICAgICBhZGRj
cHVfb3V0OgogICAgICAgICBzcGluX3VubG9jaygmY3B1cG9vbF9sb2NrKTsKICAgICAgICAgZGVi
dWd0cmFjZV9wcmludGsoImNwdXBvb2xfYXNzaWduX2NwdShwb29sPSVkLGNwdT0lZCkgcmV0ICVk
XG4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICBvcC0+Y3B1cG9vbF9pZCwgY3B1LCByZXQp
OworCiAgICAgfQogICAgIGJyZWFrOwogCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3NjaGVkdWxl
LmMgYi94ZW4vY29tbW9uL3NjaGVkdWxlLmMKaW5kZXggODkyMzhmODAxZC4uZDIxMzM1NThjOCAx
MDA2NDQKLS0tIGEveGVuL2NvbW1vbi9zY2hlZHVsZS5jCisrKyBiL3hlbi9jb21tb24vc2NoZWR1
bGUuYwpAQCAtMjU5MSw4ICsyNTkxLDcgQEAgc3RhdGljIHN0cnVjdCBub3RpZmllcl9ibG9jayBj
cHVfc2NoZWR1bGVfbmZiID0gewogICAgIC5ub3RpZmllcl9jYWxsID0gY3B1X3NjaGVkdWxlX2Nh
bGxiYWNrCiB9OwogCi1zdGF0aWMgY29uc3QgY3B1bWFza190ICpzY2hlZF9nZXRfb3B0X2NwdW1h
c2soZW51bSBzY2hlZF9ncmFuIG9wdCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgY3B1KQorY29uc3QgY3B1bWFza190ICpzY2hlZF9n
ZXRfb3B0X2NwdW1hc2soZW51bSBzY2hlZF9ncmFuIG9wdCwgdW5zaWduZWQgaW50IGNwdSkKIHsK
ICAgICBjb25zdCBjcHVtYXNrX3QgKm1hc2s7CiAKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL3hl
bi9zY2hlZC1pZi5oIGIveGVuL2luY2x1ZGUveGVuL3NjaGVkLWlmLmgKaW5kZXggNzgwNzM1ZGRh
My4uY2Q3MzFkNzE3MiAxMDA2NDQKLS0tIGEveGVuL2luY2x1ZGUveGVuL3NjaGVkLWlmLmgKKysr
IGIveGVuL2luY2x1ZGUveGVuL3NjaGVkLWlmLmgKQEAgLTYzOCw1ICs2MzgsNiBAQCBhZmZpbml0
eV9iYWxhbmNlX2NwdW1hc2soY29uc3Qgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQsIGludCBzdGVw
LAogfQogCiB2b2lkIHNjaGVkX3JtX2NwdSh1bnNpZ25lZCBpbnQgY3B1KTsKK2NvbnN0IGNwdW1h
c2tfdCAqc2NoZWRfZ2V0X29wdF9jcHVtYXNrKGVudW0gc2NoZWRfZ3JhbiBvcHQsIHVuc2lnbmVk
IGludCBjcHUpOwogCiAjZW5kaWYgLyogX19YRU5fU0NIRURfSUZfSF9fICovCi0tIAoyLjE2LjQK
CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2
ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xp
c3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

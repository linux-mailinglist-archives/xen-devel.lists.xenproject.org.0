Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 5E9D3144BB
	for <lists+xen-devel@lfdr.de>; Mon,  6 May 2019 08:59:44 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hNXYu-0002aD-Sw; Mon, 06 May 2019 06:57:20 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=XZcu=TG=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1hNXYk-0002Ck-4y
 for xen-devel@lists.xenproject.org; Mon, 06 May 2019 06:57:10 +0000
X-Inumbo-ID: 26aa375c-6fcc-11e9-843c-bc764e045a96
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 26aa375c-6fcc-11e9-843c-bc764e045a96;
 Mon, 06 May 2019 06:57:03 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 5AF5DAF35;
 Mon,  6 May 2019 06:56:57 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Mon,  6 May 2019 08:56:31 +0200
Message-Id: <20190506065644.7415-33-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190506065644.7415-1-jgross@suse.com>
References: <20190506065644.7415-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH RFC V2 32/45] xen/sched: move struct task_slice
 into struct sched_item
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Tim Deegan <tim@xen.org>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wei.liu2@citrix.com>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>,
 Robert VanVossen <robert.vanvossen@dornerworks.com>,
 Dario Faggioli <dfaggioli@suse.com>, Julien Grall <julien.grall@arm.com>,
 Josh Whitehead <josh.whitehead@dornerworks.com>,
 Meng Xu <mengxu@cis.upenn.edu>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SW4gb3JkZXIgdG8gcHJlcGFyZSBmb3IgbXVsdGlwbGUgdmNwdXMgcGVyIHNjaGVkdWxlIGl0ZW0g
bW92ZSBzdHJ1Y3QKdGFza19zbGljZSBpbiBzY2hlZHVsZSgpIGZyb20gdGhlIGxvY2FsIHN0YWNr
IGludG8gc3RydWN0IHNjaGVkX2l0ZW0Kb2YgdGhlIGN1cnJlbnRseSBydW5uaW5nIGl0ZW0uIFRv
IG1ha2UgYWNjZXNzIGVhc2llciBmb3IgdGhlIHNpbmdsZQpzY2hlZHVsZXJzIGFkZCB0aGUgcG9p
bnRlciBvZiB0aGUgY3VycmVudGx5IHJ1bm5pbmcgaXRlbSBhcyBhIHBhcmFtZXRlcgpvZiBkb19z
Y2hlZHVsZSgpLgoKV2hpbGUgYXQgaXQgc3dpdGNoIHRoZSB0YXNrbGV0X3dvcmtfc2NoZWR1bGVk
IHBhcmFtZXRlciBvZgpkb19zY2hlZHVsZSgpIGZyb20gYm9vbF90IHRvIGJvb2wuCgpBcyBzdHJ1
Y3QgdGFza19zbGljZSBpcyBvbmx5IGV2ZXIgbW9kaWZpZWQgd2l0aCB0aGUgbG9jYWwgc2NoZWR1
bGUKbG9jayBoZWxkIGl0IGlzIHNhZmUgdG8gZGlyZWN0bHkgc2V0IHRoZSBkaWZmZXJlbnQgaXRl
bXMgaW4gc3RydWN0CnNjaGVkX2l0ZW0gaW5zdGVhZCBvZiB1c2luZyBhbiBvbi1zdGFjayBjb3B5
IGZvciByZXR1cm5pbmcgdGhlIGRhdGEuCgpTaWduZWQtb2ZmLWJ5OiBKdWVyZ2VuIEdyb3NzIDxq
Z3Jvc3NAc3VzZS5jb20+Ci0tLQogeGVuL2NvbW1vbi9zY2hlZF9hcmluYzY1My5jIHwgMjAgKysr
KysrKy0tLS0tLS0tLS0tLS0KIHhlbi9jb21tb24vc2NoZWRfY3JlZGl0LmMgICB8IDI1ICsrKysr
KysrKysrLS0tLS0tLS0tLS0tLS0KIHhlbi9jb21tb24vc2NoZWRfY3JlZGl0Mi5jICB8IDIxICsr
KysrKysrKy0tLS0tLS0tLS0tLQogeGVuL2NvbW1vbi9zY2hlZF9udWxsLmMgICAgIHwgMjYgKysr
KysrKysrKysrLS0tLS0tLS0tLS0tLS0KIHhlbi9jb21tb24vc2NoZWRfcnQuYyAgICAgICB8IDIy
ICsrKysrKysrKysrLS0tLS0tLS0tLS0KIHhlbi9jb21tb24vc2NoZWR1bGUuYyAgICAgICB8IDIx
ICsrKysrKysrKystLS0tLS0tLS0tLQogeGVuL2luY2x1ZGUveGVuL3NjaGVkLWlmLmggIHwgMTEg
KysrLS0tLS0tLS0KIHhlbi9pbmNsdWRlL3hlbi9zY2hlZC5oICAgICB8ICA2ICsrKysrKwogOCBm
aWxlcyBjaGFuZ2VkLCA2OSBpbnNlcnRpb25zKCspLCA4MyBkZWxldGlvbnMoLSkKCmRpZmYgLS1n
aXQgYS94ZW4vY29tbW9uL3NjaGVkX2FyaW5jNjUzLmMgYi94ZW4vY29tbW9uL3NjaGVkX2FyaW5j
NjUzLmMKaW5kZXggMzkxOWMwYTNlOS4uZTk4ZTk4MTE2YiAxMDA2NDQKLS0tIGEveGVuL2NvbW1v
bi9zY2hlZF9hcmluYzY1My5jCisrKyBiL3hlbi9jb21tb24vc2NoZWRfYXJpbmM2NTMuYwpAQCAt
NDk3LDE4ICs0OTcsMTQgQEAgYTY1M3NjaGVkX2l0ZW1fd2FrZShjb25zdCBzdHJ1Y3Qgc2NoZWR1
bGVyICpvcHMsIHN0cnVjdCBzY2hlZF9pdGVtICppdGVtKQogICoKICAqIEBwYXJhbSBvcHMgICAg
ICAgUG9pbnRlciB0byB0aGlzIGluc3RhbmNlIG9mIHRoZSBzY2hlZHVsZXIgc3RydWN0dXJlCiAg
KiBAcGFyYW0gbm93ICAgICAgIEN1cnJlbnQgdGltZQotICoKLSAqIEByZXR1cm4gICAgICAgICAg
QWRkcmVzcyBvZiB0aGUgSVRFTSBzdHJ1Y3R1cmUgc2NoZWR1bGVkIHRvIGJlIHJ1biBuZXh0Ci0g
KiAgICAgICAgICAgICAgICAgIEFtb3VudCBvZiB0aW1lIHRvIGV4ZWN1dGUgdGhlIHJldHVybmVk
IElURU0KLSAqICAgICAgICAgICAgICAgICAgRmxhZyBmb3Igd2hldGhlciB0aGUgSVRFTSB3YXMg
bWlncmF0ZWQKICAqLwotc3RhdGljIHN0cnVjdCB0YXNrX3NsaWNlCitzdGF0aWMgdm9pZAogYTY1
M3NjaGVkX2RvX3NjaGVkdWxlKAogICAgIGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKKyAg
ICBzdHJ1Y3Qgc2NoZWRfaXRlbSAqcHJldiwKICAgICBzX3RpbWVfdCBub3csCi0gICAgYm9vbF90
IHRhc2tsZXRfd29ya19zY2hlZHVsZWQpCisgICAgYm9vbCB0YXNrbGV0X3dvcmtfc2NoZWR1bGVk
KQogewotICAgIHN0cnVjdCB0YXNrX3NsaWNlIHJldDsgICAgICAgICAgICAgICAgICAgICAgLyog
aG9sZCB0aGUgY2hvc2VuIGRvbWFpbiAqLwogICAgIHN0cnVjdCBzY2hlZF9pdGVtICpuZXdfdGFz
ayA9IE5VTEw7CiAgICAgc3RhdGljIHVuc2lnbmVkIGludCBzY2hlZF9pbmRleCA9IDA7CiAgICAg
c3RhdGljIHNfdGltZV90IG5leHRfc3dpdGNoX3RpbWU7CkBAIC01ODYsMTMgKzU4MiwxMSBAQCBh
NjUzc2NoZWRfZG9fc2NoZWR1bGUoCiAgICAgICogUmV0dXJuIHRoZSBhbW91bnQgb2YgdGltZSB0
aGUgbmV4dCBkb21haW4gaGFzIHRvIHJ1biBhbmQgdGhlIGFkZHJlc3MKICAgICAgKiBvZiB0aGUg
c2VsZWN0ZWQgdGFzaydzIElURU0gc3RydWN0dXJlLgogICAgICAqLwotICAgIHJldC50aW1lID0g
bmV4dF9zd2l0Y2hfdGltZSAtIG5vdzsKLSAgICByZXQudGFzayA9IG5ld190YXNrOwotICAgIHJl
dC5taWdyYXRlZCA9IDA7Ci0KLSAgICBCVUdfT04ocmV0LnRpbWUgPD0gMCk7CisgICAgcHJldi0+
bmV4dF90aW1lID0gbmV4dF9zd2l0Y2hfdGltZSAtIG5vdzsKKyAgICBwcmV2LT5uZXh0X3Rhc2sg
PSBuZXdfdGFzazsKKyAgICBuZXdfdGFzay0+bWlncmF0ZWQgPSBmYWxzZTsKIAotICAgIHJldHVy
biByZXQ7CisgICAgQlVHX09OKHByZXYtPm5leHRfdGltZSA8PSAwKTsKIH0KIAogLyoqCmRpZmYg
LS1naXQgYS94ZW4vY29tbW9uL3NjaGVkX2NyZWRpdC5jIGIveGVuL2NvbW1vbi9zY2hlZF9jcmVk
aXQuYwppbmRleCA0NzM0ZjUyZmM3Li4wNjRmODhhYjIzIDEwMDY0NAotLS0gYS94ZW4vY29tbW9u
L3NjaGVkX2NyZWRpdC5jCisrKyBiL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0LmMKQEAgLTE2ODks
NyArMTY4OSw3IEBAIGNzY2hlZF9ydW5xX3N0ZWFsKGludCBwZWVyX2NwdSwgaW50IGNwdSwgaW50
IHByaSwgaW50IGJhbGFuY2Vfc3RlcCkKIAogc3RhdGljIHN0cnVjdCBjc2NoZWRfaXRlbSAqCiBj
c2NoZWRfbG9hZF9iYWxhbmNlKHN0cnVjdCBjc2NoZWRfcHJpdmF0ZSAqcHJ2LCBpbnQgY3B1LAot
ICAgIHN0cnVjdCBjc2NoZWRfaXRlbSAqc25leHQsIGJvb2xfdCAqc3RvbGVuKQorICAgIHN0cnVj
dCBjc2NoZWRfaXRlbSAqc25leHQsIGJvb2wgKnN0b2xlbikKIHsKICAgICBzdHJ1Y3QgY3B1cG9v
bCAqYyA9IHBlcl9jcHUoY3B1cG9vbCwgY3B1KTsKICAgICBzdHJ1Y3QgY3NjaGVkX2l0ZW0gKnNw
ZWVyOwpAQCAtMTgwNSw3ICsxODA1LDcgQEAgY3NjaGVkX2xvYWRfYmFsYW5jZShzdHJ1Y3QgY3Nj
aGVkX3ByaXZhdGUgKnBydiwgaW50IGNwdSwKICAgICAgICAgICAgICAgICAvKiBBcyBzb29uIGFz
IG9uZSBpdGVtIGlzIGZvdW5kLCBiYWxhbmNpbmcgZW5kcyAqLwogICAgICAgICAgICAgICAgIGlm
ICggc3BlZXIgIT0gTlVMTCApCiAgICAgICAgICAgICAgICAgewotICAgICAgICAgICAgICAgICAg
ICAqc3RvbGVuID0gMTsKKyAgICAgICAgICAgICAgICAgICAgKnN0b2xlbiA9IHRydWU7CiAgICAg
ICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAgICAqIE5leHQgdGltZSB3ZSds
bCBsb29rIGZvciB3b3JrIHRvIHN0ZWFsIG9uIHRoaXMgbm9kZSwgd2UKICAgICAgICAgICAgICAg
ICAgICAgICogd2lsbCBzdGFydCBmcm9tIHRoZSBuZXh0IHBDUFUsIHdpdGggcmVzcGVjdCB0byB0
aGlzIG9uZSwKQEAgLTE4MzUsMTkgKzE4MzUsMTggQEAgY3NjaGVkX2xvYWRfYmFsYW5jZShzdHJ1
Y3QgY3NjaGVkX3ByaXZhdGUgKnBydiwgaW50IGNwdSwKICAqIFRoaXMgZnVuY3Rpb24gaXMgaW4g
dGhlIGNyaXRpY2FsIHBhdGguIEl0IGlzIGRlc2lnbmVkIHRvIGJlIHNpbXBsZSBhbmQKICAqIGZh
c3QgZm9yIHRoZSBjb21tb24gY2FzZS4KICAqLwotc3RhdGljIHN0cnVjdCB0YXNrX3NsaWNlCi1j
c2NoZWRfc2NoZWR1bGUoCi0gICAgY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzX3RpbWVf
dCBub3csIGJvb2xfdCB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkKQorc3RhdGljIHZvaWQgY3NjaGVk
X3NjaGVkdWxlKAorICAgIGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVk
X2l0ZW0gKml0ZW0sIHNfdGltZV90IG5vdywKKyAgICBib29sIHRhc2tsZXRfd29ya19zY2hlZHVs
ZWQpCiB7CiAgICAgY29uc3QgdW5zaWduZWQgaW50IGNwdSA9IHNtcF9wcm9jZXNzb3JfaWQoKTsK
ICAgICBjb25zdCB1bnNpZ25lZCBpbnQgc2NoZWRfY3B1ID0gc2NoZWRfZ2V0X3Jlc291cmNlX2Nw
dShjcHUpOwogICAgIHN0cnVjdCBsaXN0X2hlYWQgKiBjb25zdCBydW5xID0gUlVOUShzY2hlZF9j
cHUpOwotICAgIHN0cnVjdCBzY2hlZF9pdGVtICppdGVtID0gY3VycmVudC0+c2NoZWRfaXRlbTsK
ICAgICBzdHJ1Y3QgY3NjaGVkX2l0ZW0gKiBjb25zdCBzY3VyciA9IENTQ0hFRF9JVEVNKGl0ZW0p
OwogICAgIHN0cnVjdCBjc2NoZWRfcHJpdmF0ZSAqcHJ2ID0gQ1NDSEVEX1BSSVYob3BzKTsKICAg
ICBzdHJ1Y3QgY3NjaGVkX2l0ZW0gKnNuZXh0OwotICAgIHN0cnVjdCB0YXNrX3NsaWNlIHJldDsK
ICAgICBzX3RpbWVfdCBydW50aW1lLCB0c2xpY2U7CisgICAgYm9vbCBtaWdyYXRlZCA9IGZhbHNl
OwogCiAgICAgU0NIRURfU1RBVF9DUkFOSyhzY2hlZHVsZSk7CiAgICAgQ1NDSEVEX0lURU1fQ0hF
Q0soaXRlbSk7CkBAIC0xOTM3LDcgKzE5MzYsNiBAQCBjc2NoZWRfc2NoZWR1bGUoCiAgICAgICAg
ICAgICAgICAgICAgICAgICAodW5zaWduZWQgY2hhciAqKSZkKTsKICAgICAgICAgfQogCi0gICAg
ICAgIHJldC5taWdyYXRlZCA9IDA7CiAgICAgICAgIGdvdG8gb3V0OwogICAgIH0KICAgICB0c2xp
Y2UgPSBwcnYtPnRzbGljZTsKQEAgLTE5NTUsNyArMTk1Myw2IEBAIGNzY2hlZF9zY2hlZHVsZSgK
ICAgICB9CiAKICAgICBzbmV4dCA9IF9fcnVucV9lbGVtKHJ1bnEtPm5leHQpOwotICAgIHJldC5t
aWdyYXRlZCA9IDA7CiAKICAgICAvKiBUYXNrbGV0IHdvcmsgKHdoaWNoIHJ1bnMgaW4gaWRsZSBJ
VEVNIGNvbnRleHQpIG92ZXJyaWRlcyBhbGwgZWxzZS4gKi8KICAgICBpZiAoIHRhc2tsZXRfd29y
a19zY2hlZHVsZWQgKQpAQCAtMTk4MSw3ICsxOTc4LDcgQEAgY3NjaGVkX3NjaGVkdWxlKAogICAg
IGlmICggc25leHQtPnByaSA+IENTQ0hFRF9QUklfVFNfT1ZFUiApCiAgICAgICAgIF9fcnVucV9y
ZW1vdmUoc25leHQpOwogICAgIGVsc2UKLSAgICAgICAgc25leHQgPSBjc2NoZWRfbG9hZF9iYWxh
bmNlKHBydiwgc2NoZWRfY3B1LCBzbmV4dCwgJnJldC5taWdyYXRlZCk7CisgICAgICAgIHNuZXh0
ID0gY3NjaGVkX2xvYWRfYmFsYW5jZShwcnYsIHNjaGVkX2NwdSwgc25leHQsICZtaWdyYXRlZCk7
CiAKICAgICAvKgogICAgICAqIFVwZGF0ZSBpZGxlcnMgbWFzayBpZiBuZWNlc3NhcnkuIFdoZW4g
d2UncmUgaWRsaW5nLCBvdGhlciBDUFVzCkBAIC0yMDA0LDEyICsyMDAxLDEyIEBAIG91dDoKICAg
ICAvKgogICAgICAqIFJldHVybiB0YXNrIHRvIHJ1biBuZXh0Li4uCiAgICAgICovCi0gICAgcmV0
LnRpbWUgPSAoaXNfaWRsZV9pdGVtKHNuZXh0LT5pdGVtKSA/CisgICAgaXRlbS0+bmV4dF90aW1l
ID0gKGlzX2lkbGVfaXRlbShzbmV4dC0+aXRlbSkgPwogICAgICAgICAgICAgICAgIC0xIDogdHNs
aWNlKTsKLSAgICByZXQudGFzayA9IHNuZXh0LT5pdGVtOworICAgIGl0ZW0tPm5leHRfdGFzayA9
IHNuZXh0LT5pdGVtOworICAgIHNuZXh0LT5pdGVtLT5taWdyYXRlZCA9IG1pZ3JhdGVkOwogCi0g
ICAgQ1NDSEVEX0lURU1fQ0hFQ0socmV0LnRhc2spOwotICAgIHJldHVybiByZXQ7CisgICAgQ1ND
SEVEX0lURU1fQ0hFQ0soaXRlbS0+bmV4dF90YXNrKTsKIH0KIAogc3RhdGljIHZvaWQKZGlmZiAt
LWdpdCBhL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0Mi5jIGIveGVuL2NvbW1vbi9zY2hlZF9jcmVk
aXQyLmMKaW5kZXggZDVjYjhjMDIwMC4uZjEwNzRiZTI1ZCAxMDA2NDQKLS0tIGEveGVuL2NvbW1v
bi9zY2hlZF9jcmVkaXQyLmMKKysrIGIveGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQyLmMKQEAgLTM0
NDMsMTkgKzM0NDMsMTggQEAgcnVucV9jYW5kaWRhdGUoc3RydWN0IGNzY2hlZDJfcnVucXVldWVf
ZGF0YSAqcnFkLAogICogVGhpcyBmdW5jdGlvbiBpcyBpbiB0aGUgY3JpdGljYWwgcGF0aC4gSXQg
aXMgZGVzaWduZWQgdG8gYmUgc2ltcGxlIGFuZAogICogZmFzdCBmb3IgdGhlIGNvbW1vbiBjYXNl
LgogICovCi1zdGF0aWMgc3RydWN0IHRhc2tfc2xpY2UKLWNzY2hlZDJfc2NoZWR1bGUoCi0gICAg
Y29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzX3RpbWVfdCBub3csIGJvb2wgdGFza2xldF93
b3JrX3NjaGVkdWxlZCkKK3N0YXRpYyB2b2lkIGNzY2hlZDJfc2NoZWR1bGUoCisgICAgY29uc3Qg
c3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfaXRlbSAqY3Vycml0ZW0sIHNfdGlt
ZV90IG5vdywKKyAgICBib29sIHRhc2tsZXRfd29ya19zY2hlZHVsZWQpCiB7CiAgICAgY29uc3Qg
dW5zaWduZWQgaW50IGNwdSA9IHNtcF9wcm9jZXNzb3JfaWQoKTsKICAgICBjb25zdCB1bnNpZ25l
ZCBpbnQgc2NoZWRfY3B1ID0gc2NoZWRfZ2V0X3Jlc291cmNlX2NwdShjcHUpOwogICAgIHN0cnVj
dCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZDsKLSAgICBzdHJ1Y3Qgc2NoZWRfaXRlbSAqY3Vy
cml0ZW0gPSBjdXJyZW50LT5zY2hlZF9pdGVtOwogICAgIHN0cnVjdCBjc2NoZWQyX2l0ZW0gKiBj
b25zdCBzY3VyciA9IGNzY2hlZDJfaXRlbShjdXJyaXRlbSk7CiAgICAgc3RydWN0IGNzY2hlZDJf
aXRlbSAqc25leHQgPSBOVUxMOwogICAgIHVuc2lnbmVkIGludCBza2lwcGVkX2l0ZW1zID0gMDsK
LSAgICBzdHJ1Y3QgdGFza19zbGljZSByZXQ7CiAgICAgYm9vbCB0aWNrbGVkOworICAgIGJvb2wg
bWlncmF0ZWQgPSBmYWxzZTsKIAogICAgIFNDSEVEX1NUQVRfQ1JBTksoc2NoZWR1bGUpOwogICAg
IENTQ0hFRDJfSVRFTV9DSEVDSyhjdXJyaXRlbSk7CkBAIC0zNTQwLDggKzM1MzksNiBAQCBjc2No
ZWQyX3NjaGVkdWxlKAogICAgICAgICAgJiYgaXRlbV9ydW5uYWJsZShjdXJyaXRlbSkgKQogICAg
ICAgICBfX3NldF9iaXQoX19DU0ZMQUdfZGVsYXllZF9ydW5xX2FkZCwgJnNjdXJyLT5mbGFncyk7
CiAKLSAgICByZXQubWlncmF0ZWQgPSAwOwotCiAgICAgLyogQWNjb3VudGluZyBmb3Igbm9uLWlk
bGUgdGFza3MgKi8KICAgICBpZiAoICFpc19pZGxlX2l0ZW0oc25leHQtPml0ZW0pICkKICAgICB7
CkBAIC0zNTkxLDcgKzM1ODgsNyBAQCBjc2NoZWQyX3NjaGVkdWxlKAogICAgICAgICAgICAgc25l
eHQtPmNyZWRpdCArPSBDU0NIRUQyX01JR1JBVEVfQ09NUEVOU0FUSU9OOwogICAgICAgICAgICAg
c2NoZWRfc2V0X3JlcyhzbmV4dC0+aXRlbSwgcGVyX2NwdShzY2hlZF9yZXMsIHNjaGVkX2NwdSkp
OwogICAgICAgICAgICAgU0NIRURfU1RBVF9DUkFOSyhtaWdyYXRlZCk7Ci0gICAgICAgICAgICBy
ZXQubWlncmF0ZWQgPSAxOworICAgICAgICAgICAgbWlncmF0ZWQgPSB0cnVlOwogICAgICAgICB9
CiAgICAgfQogICAgIGVsc2UKQEAgLTM2MjIsMTEgKzM2MTksMTEgQEAgY3NjaGVkMl9zY2hlZHVs
ZSgKICAgICAvKgogICAgICAqIFJldHVybiB0YXNrIHRvIHJ1biBuZXh0Li4uCiAgICAgICovCi0g
ICAgcmV0LnRpbWUgPSBjc2NoZWQyX3J1bnRpbWUob3BzLCBzY2hlZF9jcHUsIHNuZXh0LCBub3cp
OwotICAgIHJldC50YXNrID0gc25leHQtPml0ZW07CisgICAgY3Vycml0ZW0tPm5leHRfdGltZSA9
IGNzY2hlZDJfcnVudGltZShvcHMsIHNjaGVkX2NwdSwgc25leHQsIG5vdyk7CisgICAgY3Vycml0
ZW0tPm5leHRfdGFzayA9IHNuZXh0LT5pdGVtOworICAgIHNuZXh0LT5pdGVtLT5taWdyYXRlZCA9
IG1pZ3JhdGVkOwogCi0gICAgQ1NDSEVEMl9JVEVNX0NIRUNLKHJldC50YXNrKTsKLSAgICByZXR1
cm4gcmV0OworICAgIENTQ0hFRDJfSVRFTV9DSEVDSyhjdXJyaXRlbS0+bmV4dF90YXNrKTsKIH0K
IAogc3RhdGljIHZvaWQKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vc2NoZWRfbnVsbC5jIGIveGVu
L2NvbW1vbi9zY2hlZF9udWxsLmMKaW5kZXggMzRjZTdhMDVkMy4uMWFmMzk2ZGNkYiAxMDA2NDQK
LS0tIGEveGVuL2NvbW1vbi9zY2hlZF9udWxsLmMKKysrIGIveGVuL2NvbW1vbi9zY2hlZF9udWxs
LmMKQEAgLTcwMywxNiArNzAzLDE0IEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBudWxsX2l0ZW1fY2hl
Y2soc3RydWN0IHNjaGVkX2l0ZW0gKml0ZW0pCiAgKiAgLSB0aGUgaXRlbSBhc3NpZ25lZCB0byB0
aGUgcENQVSwgaWYgdGhlcmUncyBvbmUgYW5kIGl0IGNhbiBydW47CiAgKiAgLSB0aGUgaWRsZSBp
dGVtLCBvdGhlcndpc2UuCiAgKi8KLXN0YXRpYyBzdHJ1Y3QgdGFza19zbGljZSBudWxsX3NjaGVk
dWxlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHNfdGltZV90IG5vdywKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIGJvb2xfdCB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkKQorc3RhdGljIHZvaWQg
bnVsbF9zY2hlZHVsZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF9p
dGVtICpwcmV2LAorICAgICAgICAgICAgICAgICAgICAgICAgICBzX3RpbWVfdCBub3csIGJvb2wg
dGFza2xldF93b3JrX3NjaGVkdWxlZCkKIHsKICAgICB1bnNpZ25lZCBpbnQgYnM7CiAgICAgY29u
c3QgdW5zaWduZWQgaW50IGNwdSA9IHNtcF9wcm9jZXNzb3JfaWQoKTsKICAgICBjb25zdCB1bnNp
Z25lZCBpbnQgc2NoZWRfY3B1ID0gc2NoZWRfZ2V0X3Jlc291cmNlX2NwdShjcHUpOwogICAgIHN0
cnVjdCBudWxsX3ByaXZhdGUgKnBydiA9IG51bGxfcHJpdihvcHMpOwogICAgIHN0cnVjdCBudWxs
X2l0ZW0gKnd2YzsKLSAgICBzdHJ1Y3QgdGFza19zbGljZSByZXQ7CiAKICAgICBTQ0hFRF9TVEFU
X0NSQU5LKHNjaGVkdWxlKTsKICAgICBOVUxMX0lURU1fQ0hFQ0soY3VycmVudC0+c2NoZWRfaXRl
bSk7CkBAIC03NDAsMTkgKzczOCwxOCBAQCBzdGF0aWMgc3RydWN0IHRhc2tfc2xpY2UgbnVsbF9z
Y2hlZHVsZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAgICAgaWYgKCB0YXNrbGV0X3dv
cmtfc2NoZWR1bGVkICkKICAgICB7CiAgICAgICAgIHRyYWNlX3ZhcihUUkNfU05VTExfVEFTS0xF
VCwgMSwgMCwgTlVMTCk7Ci0gICAgICAgIHJldC50YXNrID0gc2NoZWRfaWRsZV9pdGVtKHNjaGVk
X2NwdSk7CisgICAgICAgIHByZXYtPm5leHRfdGFzayA9IHNjaGVkX2lkbGVfaXRlbShzY2hlZF9j
cHUpOwogICAgIH0KICAgICBlbHNlCi0gICAgICAgIHJldC50YXNrID0gcGVyX2NwdShucGMsIHNj
aGVkX2NwdSkuaXRlbTsKLSAgICByZXQubWlncmF0ZWQgPSAwOwotICAgIHJldC50aW1lID0gLTE7
CisgICAgICAgIHByZXYtPm5leHRfdGFzayA9IHBlcl9jcHUobnBjLCBzY2hlZF9jcHUpLml0ZW07
CisgICAgcHJldi0+bmV4dF90aW1lID0gLTE7CiAKICAgICAvKgogICAgICAqIFdlIG1heSBiZSBu
ZXcgaW4gdGhlIGNwdXBvb2wsIG9yIGp1c3QgY29taW5nIGJhY2sgb25saW5lLiBJbiB3aGljaAog
ICAgICAqIGNhc2UsIHRoZXJlIG1heSBiZSBpdGVtcyBpbiB0aGUgd2FpdHF1ZXVlIHRoYXQgd2Ug
Y2FuIGFzc2lnbiB0byB1cwogICAgICAqIGFuZCBydW4uCiAgICAgICovCi0gICAgaWYgKCB1bmxp
a2VseShyZXQudGFzayA9PSBOVUxMKSApCisgICAgaWYgKCB1bmxpa2VseShwcmV2LT5uZXh0X3Rh
c2sgPT0gTlVMTCkgKQogICAgIHsKICAgICAgICAgc3Bpbl9sb2NrKCZwcnYtPndhaXRxX2xvY2sp
OwogCkBAIC03NzgsNyArNzc1LDcgQEAgc3RhdGljIHN0cnVjdCB0YXNrX3NsaWNlIG51bGxfc2No
ZWR1bGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAgICAgICAgICAgICAgIHsKICAg
ICAgICAgICAgICAgICAgICAgaXRlbV9hc3NpZ24ocHJ2LCB3dmMtPml0ZW0sIHNjaGVkX2NwdSk7
CiAgICAgICAgICAgICAgICAgICAgIGxpc3RfZGVsX2luaXQoJnd2Yy0+d2FpdHFfZWxlbSk7Ci0g
ICAgICAgICAgICAgICAgICAgIHJldC50YXNrID0gd3ZjLT5pdGVtOworICAgICAgICAgICAgICAg
ICAgICBwcmV2LT5uZXh0X3Rhc2sgPSB3dmMtPml0ZW07CiAgICAgICAgICAgICAgICAgICAgIGdv
dG8gdW5sb2NrOwogICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgIH0KQEAgLTc4NywxMSAr
Nzg0LDEyIEBAIHN0YXRpYyBzdHJ1Y3QgdGFza19zbGljZSBudWxsX3NjaGVkdWxlKGNvbnN0IHN0
cnVjdCBzY2hlZHVsZXIgKm9wcywKICAgICAgICAgc3Bpbl91bmxvY2soJnBydi0+d2FpdHFfbG9j
ayk7CiAgICAgfQogCi0gICAgaWYgKCB1bmxpa2VseShyZXQudGFzayA9PSBOVUxMIHx8ICFpdGVt
X3J1bm5hYmxlKHJldC50YXNrKSkgKQotICAgICAgICByZXQudGFzayA9IHNjaGVkX2lkbGVfaXRl
bShzY2hlZF9jcHUpOworICAgIGlmICggdW5saWtlbHkocHJldi0+bmV4dF90YXNrID09IE5VTEwg
fHwgIWl0ZW1fcnVubmFibGUocHJldi0+bmV4dF90YXNrKSkgKQorICAgICAgICBwcmV2LT5uZXh0
X3Rhc2sgPSBzY2hlZF9pZGxlX2l0ZW0oc2NoZWRfY3B1KTsKIAotICAgIE5VTExfSVRFTV9DSEVD
SyhyZXQudGFzayk7Ci0gICAgcmV0dXJuIHJldDsKKyAgICBOVUxMX0lURU1fQ0hFQ0socHJldi0+
bmV4dF90YXNrKTsKKworICAgIHByZXYtPm5leHRfdGFzay0+bWlncmF0ZWQgPSBmYWxzZTsKIH0K
IAogc3RhdGljIGlubGluZSB2b2lkIGR1bXBfaXRlbShzdHJ1Y3QgbnVsbF9wcml2YXRlICpwcnYs
IHN0cnVjdCBudWxsX2l0ZW0gKm52YykKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vc2NoZWRfcnQu
YyBiL3hlbi9jb21tb24vc2NoZWRfcnQuYwppbmRleCAyMzY2ZTMzYmViLi5jNWU4YjU1OWYzIDEw
MDY0NAotLS0gYS94ZW4vY29tbW9uL3NjaGVkX3J0LmMKKysrIGIveGVuL2NvbW1vbi9zY2hlZF9y
dC5jCkBAIC0xMDYyLDE2ICsxMDYyLDE2IEBAIHJ1bnFfcGljayhjb25zdCBzdHJ1Y3Qgc2NoZWR1
bGVyICpvcHMsIGNvbnN0IGNwdW1hc2tfdCAqbWFzaykKICAqIHNjaGVkdWxlIGZ1bmN0aW9uIGZv
ciBydCBzY2hlZHVsZXIuCiAgKiBUaGUgbG9jayBpcyBhbHJlYWR5IGdyYWJiZWQgaW4gc2NoZWR1
bGUuYywgbm8gbmVlZCB0byBsb2NrIGhlcmUKICAqLwotc3RhdGljIHN0cnVjdCB0YXNrX3NsaWNl
Ci1ydF9zY2hlZHVsZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHNfdGltZV90IG5vdywg
Ym9vbF90IHRhc2tsZXRfd29ya19zY2hlZHVsZWQpCitzdGF0aWMgdm9pZAorcnRfc2NoZWR1bGUo
Y29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfaXRlbSAqY3Vycml0ZW0s
CisgICAgICAgICAgICBzX3RpbWVfdCBub3csIGJvb2wgdGFza2xldF93b3JrX3NjaGVkdWxlZCkK
IHsKICAgICBjb25zdCB1bnNpZ25lZCBpbnQgY3B1ID0gc21wX3Byb2Nlc3Nvcl9pZCgpOwogICAg
IGNvbnN0IHVuc2lnbmVkIGludCBzY2hlZF9jcHUgPSBzY2hlZF9nZXRfcmVzb3VyY2VfY3B1KGNw
dSk7CiAgICAgc3RydWN0IHJ0X3ByaXZhdGUgKnBydiA9IHJ0X3ByaXYob3BzKTsKLSAgICBzdHJ1
Y3QgcnRfaXRlbSAqY29uc3Qgc2N1cnIgPSBydF9pdGVtKGN1cnJlbnQtPnNjaGVkX2l0ZW0pOwor
ICAgIHN0cnVjdCBydF9pdGVtICpjb25zdCBzY3VyciA9IHJ0X2l0ZW0oY3Vycml0ZW0pOwogICAg
IHN0cnVjdCBydF9pdGVtICpzbmV4dCA9IE5VTEw7Ci0gICAgc3RydWN0IHRhc2tfc2xpY2UgcmV0
ID0geyAubWlncmF0ZWQgPSAwIH07Ci0gICAgc3RydWN0IHNjaGVkX2l0ZW0gKmN1cnJpdGVtID0g
Y3VycmVudC0+c2NoZWRfaXRlbTsKKyAgICBib29sIG1pZ3JhdGVkID0gZmFsc2U7CiAKICAgICAv
KiBUUkFDRSAqLwogICAgIHsKQEAgLTExMTksNyArMTExOSw3IEBAIHJ0X3NjaGVkdWxlKGNvbnN0
IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc190aW1lX3Qgbm93LCBib29sX3QgdGFza2xldF93b3Jr
X3NjaGVkCiAgICAgICAgIF9fc2V0X2JpdChfX1JURFNfZGVsYXllZF9ydW5xX2FkZCwgJnNjdXJy
LT5mbGFncyk7CiAKICAgICBzbmV4dC0+bGFzdF9zdGFydCA9IG5vdzsKLSAgICByZXQudGltZSA9
ICAtMTsgLyogaWYgYW4gaWRsZSBpdGVtIGlzIHBpY2tlZCAqLworICAgIGN1cnJpdGVtLT5uZXh0
X3RpbWUgPSAgLTE7IC8qIGlmIGFuIGlkbGUgaXRlbSBpcyBwaWNrZWQgKi8KICAgICBpZiAoICFp
c19pZGxlX2l0ZW0oc25leHQtPml0ZW0pICkKICAgICB7CiAgICAgICAgIGlmICggc25leHQgIT0g
c2N1cnIgKQpAQCAtMTEzMCwxMyArMTEzMCwxMyBAQCBydF9zY2hlZHVsZShjb25zdCBzdHJ1Y3Qg
c2NoZWR1bGVyICpvcHMsIHNfdGltZV90IG5vdywgYm9vbF90IHRhc2tsZXRfd29ya19zY2hlZAog
ICAgICAgICBpZiAoIHNjaGVkX2l0ZW1fY3B1KHNuZXh0LT5pdGVtKSAhPSBzY2hlZF9jcHUgKQog
ICAgICAgICB7CiAgICAgICAgICAgICBzY2hlZF9zZXRfcmVzKHNuZXh0LT5pdGVtLCBwZXJfY3B1
KHNjaGVkX3Jlcywgc2NoZWRfY3B1KSk7Ci0gICAgICAgICAgICByZXQubWlncmF0ZWQgPSAxOwor
ICAgICAgICAgICAgbWlncmF0ZWQgPSB0cnVlOwogICAgICAgICB9Ci0gICAgICAgIHJldC50aW1l
ID0gc25leHQtPmN1cl9idWRnZXQ7IC8qIGludm9rZSB0aGUgc2NoZWR1bGVyIG5leHQgdGltZSAq
LworICAgICAgICAvKiBJbnZva2UgdGhlIHNjaGVkdWxlciBuZXh0IHRpbWUuICovCisgICAgICAg
IGN1cnJpdGVtLT5uZXh0X3RpbWUgPSBzbmV4dC0+Y3VyX2J1ZGdldDsKICAgICB9Ci0gICAgcmV0
LnRhc2sgPSBzbmV4dC0+aXRlbTsKLQotICAgIHJldHVybiByZXQ7CisgICAgY3Vycml0ZW0tPm5l
eHRfdGFzayA9IHNuZXh0LT5pdGVtOworICAgIHNuZXh0LT5pdGVtLT5taWdyYXRlZCA9IG1pZ3Jh
dGVkOwogfQogCiAvKgpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZHVsZS5jIGIveGVuL2Nv
bW1vbi9zY2hlZHVsZS5jCmluZGV4IDlmOWQ2ZWI5NWIuLmI1ZmI0OGM1NTMgMTAwNjQ0Ci0tLSBh
L3hlbi9jb21tb24vc2NoZWR1bGUuYworKysgYi94ZW4vY29tbW9uL3NjaGVkdWxlLmMKQEAgLTE1
NzUsMTAgKzE1NzUsOSBAQCBzdGF0aWMgdm9pZCBzY2hlZHVsZSh2b2lkKQogICAgIHNfdGltZV90
ICAgICAgICAgICAgICBub3c7CiAgICAgc3RydWN0IHNjaGVkdWxlciAgICAgKnNjaGVkOwogICAg
IHVuc2lnbmVkIGxvbmcgICAgICAgICp0YXNrbGV0X3dvcmsgPSAmdGhpc19jcHUodGFza2xldF93
b3JrX3RvX2RvKTsKLSAgICBib29sX3QgICAgICAgICAgICAgICAgdGFza2xldF93b3JrX3NjaGVk
dWxlZCA9IDA7CisgICAgYm9vbCAgICAgICAgICAgICAgICAgIHRhc2tsZXRfd29ya19zY2hlZHVs
ZWQgPSBmYWxzZTsKICAgICBzdHJ1Y3Qgc2NoZWRfcmVzb3VyY2UgKnNkOwogICAgIHNwaW5sb2Nr
X3QgICAgICAgICAgICpsb2NrOwotICAgIHN0cnVjdCB0YXNrX3NsaWNlICAgICBuZXh0X3NsaWNl
OwogICAgIGludCBjcHUgPSBzbXBfcHJvY2Vzc29yX2lkKCk7CiAKICAgICBBU1NFUlRfTk9UX0lO
X0FUT01JQygpOwpAQCAtMTU5NCwxMiArMTU5MywxMiBAQCBzdGF0aWMgdm9pZCBzY2hlZHVsZSh2
b2lkKQogICAgICAgICBzZXRfYml0KF9UQVNLTEVUX3NjaGVkdWxlZCwgdGFza2xldF93b3JrKTsK
ICAgICAgICAgLyogZmFsbHRocm91Z2ggKi8KICAgICBjYXNlIFRBU0tMRVRfZW5xdWV1ZWR8VEFT
S0xFVF9zY2hlZHVsZWQ6Ci0gICAgICAgIHRhc2tsZXRfd29ya19zY2hlZHVsZWQgPSAxOworICAg
ICAgICB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkID0gdHJ1ZTsKICAgICAgICAgYnJlYWs7CiAgICAg
Y2FzZSBUQVNLTEVUX3NjaGVkdWxlZDoKICAgICAgICAgY2xlYXJfYml0KF9UQVNLTEVUX3NjaGVk
dWxlZCwgdGFza2xldF93b3JrKTsKICAgICBjYXNlIDA6Ci0gICAgICAgIC8qdGFza2xldF93b3Jr
X3NjaGVkdWxlZCA9IDA7Ki8KKyAgICAgICAgLyp0YXNrbGV0X3dvcmtfc2NoZWR1bGVkID0gZmFs
c2U7Ki8KICAgICAgICAgYnJlYWs7CiAgICAgZGVmYXVsdDoKICAgICAgICAgQlVHKCk7CkBAIC0x
NjEzLDE0ICsxNjEyLDE0IEBAIHN0YXRpYyB2b2lkIHNjaGVkdWxlKHZvaWQpCiAKICAgICAvKiBn
ZXQgcG9saWN5LXNwZWNpZmljIGRlY2lzaW9uIG9uIHNjaGVkdWxpbmcuLi4gKi8KICAgICBzY2hl
ZCA9IHRoaXNfY3B1KHNjaGVkdWxlcik7Ci0gICAgbmV4dF9zbGljZSA9IHNjaGVkLT5kb19zY2hl
ZHVsZShzY2hlZCwgbm93LCB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkKTsKKyAgICBzY2hlZC0+ZG9f
c2NoZWR1bGUoc2NoZWQsIHByZXYsIG5vdywgdGFza2xldF93b3JrX3NjaGVkdWxlZCk7CiAKLSAg
ICBuZXh0ID0gbmV4dF9zbGljZS50YXNrOworICAgIG5leHQgPSBwcmV2LT5uZXh0X3Rhc2s7CiAK
ICAgICBzZC0+Y3VyciA9IG5leHQ7CiAKLSAgICBpZiAoIG5leHRfc2xpY2UudGltZSA+PSAwICkg
LyogLXZlIG1lYW5zIG5vIGxpbWl0ICovCi0gICAgICAgIHNldF90aW1lcigmc2QtPnNfdGltZXIs
IG5vdyArIG5leHRfc2xpY2UudGltZSk7CisgICAgaWYgKCBwcmV2LT5uZXh0X3RpbWUgPj0gMCAp
IC8qIC12ZSBtZWFucyBubyBsaW1pdCAqLworICAgICAgICBzZXRfdGltZXIoJnNkLT5zX3RpbWVy
LCBub3cgKyBwcmV2LT5uZXh0X3RpbWUpOwogCiAgICAgaWYgKCB1bmxpa2VseShwcmV2ID09IG5l
eHQpICkKICAgICB7CkBAIC0xNjI4LDcgKzE2MjcsNyBAQCBzdGF0aWMgdm9pZCBzY2hlZHVsZSh2
b2lkKQogICAgICAgICBUUkFDRV80RChUUkNfU0NIRURfU1dJVENIX0lORkNPTlQsCiAgICAgICAg
ICAgICAgICAgIG5leHQtPmRvbWFpbi0+ZG9tYWluX2lkLCBuZXh0LT5pdGVtX2lkLAogICAgICAg
ICAgICAgICAgICBub3cgLSBwcmV2LT5zdGF0ZV9lbnRyeV90aW1lLAotICAgICAgICAgICAgICAg
ICBuZXh0X3NsaWNlLnRpbWUpOworICAgICAgICAgICAgICAgICBwcmV2LT5uZXh0X3RpbWUpOwog
ICAgICAgICB0cmFjZV9jb250aW51ZV9ydW5uaW5nKG5leHQtPnZjcHUpOwogICAgICAgICByZXR1
cm4gY29udGludWVfcnVubmluZyhwcmV2LT52Y3B1KTsKICAgICB9CkBAIC0xNjQwLDcgKzE2Mzks
NyBAQCBzdGF0aWMgdm9pZCBzY2hlZHVsZSh2b2lkKQogICAgICAgICAgICAgIG5leHQtPmRvbWFp
bi0+ZG9tYWluX2lkLCBuZXh0LT5pdGVtX2lkLAogICAgICAgICAgICAgIChuZXh0LT52Y3B1LT5y
dW5zdGF0ZS5zdGF0ZSA9PSBSVU5TVEFURV9ydW5uYWJsZSkgPwogICAgICAgICAgICAgIChub3cg
LSBuZXh0LT5zdGF0ZV9lbnRyeV90aW1lKSA6IDAsCi0gICAgICAgICAgICAgbmV4dF9zbGljZS50
aW1lKTsKKyAgICAgICAgICAgICBwcmV2LT5uZXh0X3RpbWUpOwogCiAgICAgQVNTRVJUKHByZXYt
PnZjcHUtPnJ1bnN0YXRlLnN0YXRlID09IFJVTlNUQVRFX3J1bm5pbmcpOwogCkBAIC0xNjcwLDcg
KzE2NjksNyBAQCBzdGF0aWMgdm9pZCBzY2hlZHVsZSh2b2lkKQogCiAgICAgc3RvcF90aW1lcigm
cHJldi0+dmNwdS0+cGVyaW9kaWNfdGltZXIpOwogCi0gICAgaWYgKCBuZXh0X3NsaWNlLm1pZ3Jh
dGVkICkKKyAgICBpZiAoIG5leHQtPm1pZ3JhdGVkICkKICAgICAgICAgdmNwdV9tb3ZlX2lycXMo
bmV4dC0+dmNwdSk7CiAKICAgICB2Y3B1X3BlcmlvZGljX3RpbWVyX3dvcmsobmV4dC0+dmNwdSk7
CmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQtaWYuaCBiL3hlbi9pbmNsdWRlL3hl
bi9zY2hlZC1pZi5oCmluZGV4IDI1MDY1Mzg2NDkuLjA5NTQ0ZTA1YzAgMTAwNjQ0Ci0tLSBhL3hl
bi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5oCisrKyBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5o
CkBAIC0xODAsMTIgKzE4MCw2IEBAIHN0YXRpYyBpbmxpbmUgc3BpbmxvY2tfdCAqcGNwdV9zY2hl
ZHVsZV90cnlsb2NrKHVuc2lnbmVkIGludCBjcHUpCiAgICAgcmV0dXJuIE5VTEw7CiB9CiAKLXN0
cnVjdCB0YXNrX3NsaWNlIHsKLSAgICBzdHJ1Y3Qgc2NoZWRfaXRlbSAqdGFzazsKLSAgICBzX3Rp
bWVfdCAgICAgICAgICAgdGltZTsKLSAgICBib29sX3QgICAgICAgICAgICAgbWlncmF0ZWQ7Ci19
OwotCiBzdHJ1Y3Qgc2NoZWR1bGVyIHsKICAgICBjaGFyICpuYW1lOyAgICAgICAgICAgICAvKiBm
dWxsIG5hbWUgZm9yIHRoaXMgc2NoZWR1bGVyICAgICAgKi8KICAgICBjaGFyICpvcHRfbmFtZTsg
ICAgICAgICAvKiBvcHRpb24gbmFtZSBmb3IgdGhpcyBzY2hlZHVsZXIgICAgKi8KQEAgLTIyOCw4
ICsyMjIsOSBAQCBzdHJ1Y3Qgc2NoZWR1bGVyIHsKICAgICB2b2lkICAgICAgICAgKCpjb250ZXh0
X3NhdmVkKSAgKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKiwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHN0cnVjdCBzY2hlZF9pdGVtICopOwogCi0gICAgc3RydWN0IHRhc2tf
c2xpY2UgKCpkb19zY2hlZHVsZSkgKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKiwgc190aW1lX3Qs
Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2xfdCB0YXNrbGV0X3dv
cmtfc2NoZWR1bGVkKTsKKyAgICB2b2lkICAgICAgICAgKCpkb19zY2hlZHVsZSkgICAgKGNvbnN0
IHN0cnVjdCBzY2hlZHVsZXIgKiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHN0cnVjdCBzY2hlZF9pdGVtICosIHNfdGltZV90LAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgYm9vbCB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkKTsKIAogICAgIHN0cnVjdCBz
Y2hlZF9yZXNvdXJjZSAqICgqcGlja19yZXNvdXJjZSkgKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIg
KiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3Qg
c2NoZWRfaXRlbSAqKTsKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oIGIveGVu
L2luY2x1ZGUveGVuL3NjaGVkLmgKaW5kZXggY2JkOTdmMzRjNy4uOGJkZTc5MGQyNyAxMDA2NDQK
LS0tIGEveGVuL2luY2x1ZGUveGVuL3NjaGVkLmgKKysrIGIveGVuL2luY2x1ZGUveGVuL3NjaGVk
LmgKQEAgLTI4MSw2ICsyODEsOCBAQCBzdHJ1Y3Qgc2NoZWRfaXRlbSB7CiAgICAgYm9vbCAgICAg
ICAgICAgICAgICAgICBhZmZpbml0eV9icm9rZW47CiAgICAgLyogRG9lcyBzb2Z0IGFmZmluaXR5
IGFjdHVhbGx5IHBsYXkgYSByb2xlIChnaXZlbiBoYXJkIGFmZmluaXR5KT8gKi8KICAgICBib29s
ICAgICAgICAgICAgICAgICAgIHNvZnRfYWZmX2VmZmVjdGl2ZTsKKyAgICAvKiBJdGVtIGhhcyBi
ZWVuIG1pZ3JhdGVkIHRvIG90aGVyIGNwdShzKS4gKi8KKyAgICBib29sICAgICAgICAgICAgICAg
ICAgIG1pZ3JhdGVkOwogICAgIC8qIEJpdG1hc2sgb2YgQ1BVcyBvbiB3aGljaCB0aGlzIFZDUFUg
bWF5IHJ1bi4gKi8KICAgICBjcHVtYXNrX3Zhcl90ICAgICAgICAgIGNwdV9oYXJkX2FmZmluaXR5
OwogICAgIC8qIFVzZWQgdG8gY2hhbmdlIGFmZmluaXR5IHRlbXBvcmFyaWx5LiAqLwpAQCAtMjg5
LDYgKzI5MSwxMCBAQCBzdHJ1Y3Qgc2NoZWRfaXRlbSB7CiAgICAgY3B1bWFza192YXJfdCAgICAg
ICAgICBjcHVfaGFyZF9hZmZpbml0eV9zYXZlZDsKICAgICAvKiBCaXRtYXNrIG9mIENQVXMgb24g
d2hpY2ggdGhpcyBWQ1BVIHByZWZlcnMgdG8gcnVuLiAqLwogICAgIGNwdW1hc2tfdmFyX3QgICAg
ICAgICAgY3B1X3NvZnRfYWZmaW5pdHk7CisKKyAgICAvKiBOZXh0IGl0ZW0gdG8gcnVuLiAqLwor
ICAgIHN0cnVjdCBzY2hlZF9pdGVtICAgICAgKm5leHRfdGFzazsKKyAgICBzX3RpbWVfdCAgICAg
ICAgICAgICAgICBuZXh0X3RpbWU7CiB9OwogCiAjZGVmaW5lIGZvcl9lYWNoX3NjaGVkX2l0ZW0o
ZCwgZSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwKLS0gCjIuMTYu
NAoKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1k
ZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8v
bGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

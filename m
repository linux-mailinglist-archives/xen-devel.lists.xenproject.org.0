Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 4A9C117D72
	for <lists+xen-devel@lfdr.de>; Wed,  8 May 2019 17:42:35 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hOOgC-0004kG-BD; Wed, 08 May 2019 15:40:24 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=7fFX=TI=arm.com=julien.grall@srs-us1.protection.inumbo.net>)
 id 1hOOgA-0004k6-LS
 for xen-devel@lists.xen.org; Wed, 08 May 2019 15:40:22 +0000
X-Inumbo-ID: 9656eab0-71a7-11e9-b239-87accbc01af8
Received: from foss.arm.com (unknown [217.140.101.70])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTP
 id 9656eab0-71a7-11e9-b239-87accbc01af8;
 Wed, 08 May 2019 15:40:20 +0000 (UTC)
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.72.51.249])
 by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id 59CE6374;
 Wed,  8 May 2019 08:40:20 -0700 (PDT)
Received: from [10.1.196.50] (e108454-lin.cambridge.arm.com [10.1.196.50])
 by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPSA id 1D2683F238;
 Wed,  8 May 2019 08:40:17 -0700 (PDT)
To: Andrii Anisov <andrii.anisov@gmail.com>, xen-devel@lists.xen.org
References: <1556007026-31057-1-git-send-email-andrii.anisov@gmail.com>
 <1556007026-31057-3-git-send-email-andrii.anisov@gmail.com>
From: Julien Grall <julien.grall@arm.com>
Message-ID: <e248dae9-c91c-c735-ea16-9bcb70c65e9d@arm.com>
Date: Wed, 8 May 2019 16:40:16 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.6.1
MIME-Version: 1.0
In-Reply-To: <1556007026-31057-3-git-send-email-andrii.anisov@gmail.com>
Content-Language: en-US
Subject: Re: [Xen-devel] [PATCH v2 2/2] xen: implement
 VCPUOP_register_runstate_phys_memory_area
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Stefano Stabellini <sstabellini@kernel.org>,
 Andrii Anisov <andrii_anisov@epam.com>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Jan Beulich <JBeulich@suse.com>, xen-devel@lists.xenproject.org,
 Wei Liu <wei.liu2@citrix.com>,
 =?UTF-8?Q?Roger_Pau_Monn=c3=a9?= <roger.pau@citrix.com>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SGksCgpPbiAyMy8wNC8yMDE5IDA5OjEwLCBBbmRyaWkgQW5pc292IHdyb3RlOgo+IEZyb206IEFu
ZHJpaSBBbmlzb3YgPGFuZHJpaV9hbmlzb3ZAZXBhbS5jb20+Cj4gCj4gVkNQVU9QX3JlZ2lzdGVy
X3J1bnN0YXRlX3BoeXNfbWVtb3J5X2FyZWEgaXMgaW1wbGVtZW50ZWQgdmlhIHJ1bnN0YXRlCj4g
YXJlYSBtYXBwaW5nLiA+Cj4gU2lnbmVkLW9mZi1ieTogQW5kcmlpIEFuaXNvdiA8YW5kcmlpX2Fu
aXNvdkBlcGFtLmNvbT4KPiAtLS0KPiAgIHhlbi9hcmNoL2FybS9kb21haW4uYyAgICAgICAgfCAg
NjIgKysrKysrKysrKysrKysrKystLS0tLS0tLQo+ICAgeGVuL2FyY2gveDg2L2RvbWFpbi5jICAg
ICAgICB8IDEwNSArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tCj4g
ICB4ZW4vY29tbW9uL2RvbWFpbi5jICAgICAgICAgIHwgIDgwICsrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrLQo+ICAgeGVuL2luY2x1ZGUvYXNtLWFybS9kb21haW4uaCB8ICAgMiArCj4g
ICB4ZW4vaW5jbHVkZS94ZW4vZG9tYWluLmggICAgIHwgICAyICsKPiAgIHhlbi9pbmNsdWRlL3hl
bi9zY2hlZC5oICAgICAgfCAgIDggKysrKwo+ICAgNiBmaWxlcyBjaGFuZ2VkLCAyMTAgaW5zZXJ0
aW9ucygrKSwgNDkgZGVsZXRpb25zKC0pCgpUaGlzIHBhdGNoIGlzIHF1aXRlIGhhcmQgdG8gcmVh
ZCBiZWNhdXNlIHlvdSBhcmUgcmV3b3JraW5nIHRoZSBjb2RlIGFuZCBhdCB0aGUgCnNhbWUgdGlt
ZSBpbXBsZW1lbnRpbmcgdGhlIG5ldyBWQ1BVT1AuIEhvdyBhYm91dCBtb3ZpbmcgdGhlIHJld29y
ayBpbiBhIHNlcGFyYXRlIApwYXRjaD8gVGhlIGltcGxlbWVudGF0aW9uIGNhbiB0aGVuIGJlIGZv
bGQgaW4gdGhlIHByZXZpb3VzIHBhdGNoIGFzIHN1Z2dlc3RlZCBieSAKR2VvcmdlLgoKPiAKPiBk
aWZmIC0tZ2l0IGEveGVuL2FyY2gvYXJtL2RvbWFpbi5jIGIveGVuL2FyY2gvYXJtL2RvbWFpbi5j
Cj4gaW5kZXggNmRjNjMzZS4uOGUyNGU2MyAxMDA2NDQKPiAtLS0gYS94ZW4vYXJjaC9hcm0vZG9t
YWluLmMKPiArKysgYi94ZW4vYXJjaC9hcm0vZG9tYWluLmMKPiBAQCAtMjc1LDMyICsyNzUsNTUg
QEAgc3RhdGljIHZvaWQgY3R4dF9zd2l0Y2hfdG8oc3RydWN0IHZjcHUgKm4pCj4gICB9Cj4gICAK
PiAgIC8qIFVwZGF0ZSBwZXItVkNQVSBndWVzdCBydW5zdGF0ZSBzaGFyZWQgbWVtb3J5IGFyZWEg
KGlmIHJlZ2lzdGVyZWQpLiAqLwo+IC1zdGF0aWMgdm9pZCB1cGRhdGVfcnVuc3RhdGVfYXJlYShz
dHJ1Y3QgdmNwdSAqdikKPiArdm9pZCB1cGRhdGVfcnVuc3RhdGVfYXJlYShzdHJ1Y3QgdmNwdSAq
dikKCldoeSBkbyB5b3UgZXhwb3J0IHVwZGF0ZV9ydW5zdGF0ZV9hcmVhPyBUaGUgZnVuY3Rpb24g
ZG9lcyBub3Qgc2VlbSB0byBiZSBjYWxsZWQgCm91dHNpZGUuCgo+ICAgewo+IC0gICAgdm9pZCBf
X3VzZXIgKmd1ZXN0X2hhbmRsZSA9IE5VTEw7Cj4gKyAgICBpZiAoICFndWVzdF9oYW5kbGVfaXNf
bnVsbChydW5zdGF0ZV9ndWVzdCh2KSkgKQo+ICsgICAgewo+ICsgICAgICAgIHZvaWQgX191c2Vy
ICpndWVzdF9oYW5kbGUgPSBOVUxMOwo+ICsgICAgICAgIGlmICggVk1fQVNTSVNUKHYtPmRvbWFp
biwgcnVuc3RhdGVfdXBkYXRlX2ZsYWcpICkKPiArICAgICAgICB7Cj4gKyAgICAgICAgICAgIGd1
ZXN0X2hhbmRsZSA9ICZ2LT5ydW5zdGF0ZV9ndWVzdC5wLT5zdGF0ZV9lbnRyeV90aW1lICsgMTsK
PiArICAgICAgICAgICAgZ3Vlc3RfaGFuZGxlLS07Cj4gKyAgICAgICAgICAgIHYtPnJ1bnN0YXRl
LnN0YXRlX2VudHJ5X3RpbWUgfD0gWEVOX1JVTlNUQVRFX1VQREFURTsKPiArICAgICAgICAgICAg
X19yYXdfY29weV90b19ndWVzdChndWVzdF9oYW5kbGUsCj4gKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgKHZvaWQgKikoJnYtPnJ1bnN0YXRlLnN0YXRlX2VudHJ5X3RpbWUgKyAxKSAt
IDEsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMSk7Cj4gKyAgICAgICAgICAg
IHNtcF93bWIoKTsKPiArICAgICAgICB9Cj4gICAKPiAtICAgIGlmICggZ3Vlc3RfaGFuZGxlX2lz
X251bGwocnVuc3RhdGVfZ3Vlc3QodikpICkKPiAtICAgICAgICByZXR1cm47Cj4gKyAgICAgICAg
X19jb3B5X3RvX2d1ZXN0KHJ1bnN0YXRlX2d1ZXN0KHYpLCAmdi0+cnVuc3RhdGUsIDEpOwo+ICAg
Cj4gLSAgICBpZiAoIFZNX0FTU0lTVCh2LT5kb21haW4sIHJ1bnN0YXRlX3VwZGF0ZV9mbGFnKSAp
Cj4gLSAgICB7Cj4gLSAgICAgICAgZ3Vlc3RfaGFuZGxlID0gJnYtPnJ1bnN0YXRlX2d1ZXN0LnAt
PnN0YXRlX2VudHJ5X3RpbWUgKyAxOwo+IC0gICAgICAgIGd1ZXN0X2hhbmRsZS0tOwo+IC0gICAg
ICAgIHYtPnJ1bnN0YXRlLnN0YXRlX2VudHJ5X3RpbWUgfD0gWEVOX1JVTlNUQVRFX1VQREFURTsK
PiAtICAgICAgICBfX3Jhd19jb3B5X3RvX2d1ZXN0KGd1ZXN0X2hhbmRsZSwKPiAtICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICh2b2lkICopKCZ2LT5ydW5zdGF0ZS5zdGF0ZV9lbnRyeV90aW1l
ICsgMSkgLSAxLCAxKTsKPiAtICAgICAgICBzbXBfd21iKCk7Cj4gKyAgICAgICAgaWYgKCBndWVz
dF9oYW5kbGUgKQo+ICsgICAgICAgIHsKPiArICAgICAgICAgICAgdi0+cnVuc3RhdGUuc3RhdGVf
ZW50cnlfdGltZSAmPSB+WEVOX1JVTlNUQVRFX1VQREFURTsKPiArICAgICAgICAgICAgc21wX3dt
YigpOwo+ICsgICAgICAgICAgICBfX3Jhd19jb3B5X3RvX2d1ZXN0KGd1ZXN0X2hhbmRsZSwKPiAr
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAodm9pZCAqKSgmdi0+cnVuc3RhdGUuc3Rh
dGVfZW50cnlfdGltZSArIDEpIC0gMSwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAxKTsKPiArICAgICAgICB9Cj4gICAgICAgfQo+ICAgCj4gLSAgICBfX2NvcHlfdG9fZ3Vlc3Qo
cnVuc3RhdGVfZ3Vlc3QodiksICZ2LT5ydW5zdGF0ZSwgMSk7Cj4gLQo+IC0gICAgaWYgKCBndWVz
dF9oYW5kbGUgKQo+ICsgICAgc3Bpbl9sb2NrKCZ2LT5tYXBwZWRfcnVuc3RhdGVfbG9jayk7Cj4g
KyAgICBpZiAoIHYtPm1hcHBlZF9ydW5zdGF0ZSApCgpUaGUgY29kZSBsb29rcyBhIGJpdCBvZGQg
dG8gbWUsIHlvdSBzZWVtIHRvIGFsbG93IGEgZ3Vlc3QgdG8gcHJvdmlkZSAyIHJ1bnN0YXRlIAph
cmVhczogb25lIHVzaW5nIGd1ZXN0IHZpcnR1YWwgYWRkcmVzcyB0aGUgb3RoZXIgdXNpbmcgZ3Vl
c3QgcGh5c2ljYWwgYWRkcmVzcy4KCkl0IHdvdWxkIGJlIGJlc3QgaWYgd2UgcHJldmVudCBhIGd1
ZXN0IHRvIG1peCBtYXRjaCB0aGVtLiBJT1csIGlmIHRoZSBndWVzdCAKcHJvdmlkZSBhIHBoeXNp
Y2FsIGFkZHJlc3MgZmlyc3QsIHRoZW4gKmFsbCogdGhlIGNhbGwgc2hvdWxkIGJlIHBoeXNpY2Fs
IAphZGRyZXNzLiBBbHRlcm5hdGl2ZWx5IHRoaXMgY291bGQgYmUgYSBwZXIgdkNQVSBkZWNpc2lv
bi4KCj4gICAgICAgewo+IC0gICAgICAgIHYtPnJ1bnN0YXRlLnN0YXRlX2VudHJ5X3RpbWUgJj0g
flhFTl9SVU5TVEFURV9VUERBVEU7Cj4gLSAgICAgICAgc21wX3dtYigpOwo+IC0gICAgICAgIF9f
cmF3X2NvcHlfdG9fZ3Vlc3QoZ3Vlc3RfaGFuZGxlLAo+IC0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgKHZvaWQgKikoJnYtPnJ1bnN0YXRlLnN0YXRlX2VudHJ5X3RpbWUgKyAxKSAtIDEsIDEp
Owo+ICsgICAgICAgIGlmICggVk1fQVNTSVNUKHYtPmRvbWFpbiwgcnVuc3RhdGVfdXBkYXRlX2Zs
YWcpICkKPiArICAgICAgICB7Cj4gKyAgICAgICAgICAgIHYtPm1hcHBlZF9ydW5zdGF0ZS0+c3Rh
dGVfZW50cnlfdGltZSB8PSBYRU5fUlVOU1RBVEVfVVBEQVRFOwo+ICsgICAgICAgICAgICBzbXBf
d21iKCk7Cj4gKyAgICAgICAgICAgIHYtPnJ1bnN0YXRlLnN0YXRlX2VudHJ5X3RpbWUgfD0gWEVO
X1JVTlNUQVRFX1VQREFURTsKPiArICAgICAgICB9Cj4gKwo+ICsgICAgICAgIG1lbWNweSh2LT5t
YXBwZWRfcnVuc3RhdGUsICZ2LT5ydW5zdGF0ZSwgc2l6ZW9mKHYtPnJ1bnN0YXRlKSk7Cj4gKwo+
ICsgICAgICAgIGlmICggVk1fQVNTSVNUKHYtPmRvbWFpbiwgcnVuc3RhdGVfdXBkYXRlX2ZsYWcp
ICkKPiArICAgICAgICB7Cj4gKyAgICAgICAgICAgIHYtPm1hcHBlZF9ydW5zdGF0ZS0+c3RhdGVf
ZW50cnlfdGltZSAmPSB+WEVOX1JVTlNUQVRFX1VQREFURTsKPiArICAgICAgICAgICAgc21wX3dt
YigpOwo+ICsgICAgICAgICAgICB2LT5ydW5zdGF0ZS5zdGF0ZV9lbnRyeV90aW1lICY9IH5YRU5f
UlVOU1RBVEVfVVBEQVRFOwo+ICsgICAgICAgIH0KPiAgICAgICB9Cj4gKyAgICBzcGluX3VubG9j
aygmdi0+bWFwcGVkX3J1bnN0YXRlX2xvY2spOwo+ICsKCk5JVDogVGhlIG5ld2xpbmUgaXMgbm90
IG5lY2Vzc2FyeSBoZXJlLgoKPiAgIH0KPiAgIAo+ICAgc3RhdGljIHZvaWQgc2NoZWR1bGVfdGFp
bChzdHJ1Y3QgdmNwdSAqcHJldikKPiBAQCAtOTk4LDYgKzEwMjEsNyBAQCBsb25nIGRvX2FybV92
Y3B1X29wKGludCBjbWQsIHVuc2lnbmVkIGludCB2Y3B1aWQsIFhFTl9HVUVTVF9IQU5ETEVfUEFS
QU0odm9pZCkgYQo+ICAgICAgIHsKPiAgICAgICAgICAgY2FzZSBWQ1BVT1BfcmVnaXN0ZXJfdmNw
dV9pbmZvOgo+ICAgICAgICAgICBjYXNlIFZDUFVPUF9yZWdpc3Rlcl9ydW5zdGF0ZV9tZW1vcnlf
YXJlYToKPiArICAgICAgICBjYXNlIFZDUFVPUF9yZWdpc3Rlcl9ydW5zdGF0ZV9waHlzX21lbW9y
eV9hcmVhOgo+ICAgICAgICAgICAgICAgcmV0dXJuIGRvX3ZjcHVfb3AoY21kLCB2Y3B1aWQsIGFy
Zyk7Cj4gICAgICAgICAgIGRlZmF1bHQ6Cj4gICAgICAgICAgICAgICByZXR1cm4gLUVJTlZBTDsK
CgpbLi4uXQoKPiBkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9kb21haW4uYyBiL3hlbi9jb21tb24v
ZG9tYWluLmMKPiBpbmRleCBhZTIyMDQ5Li42ZGY3NmM2IDEwMDY0NAo+IC0tLSBhL3hlbi9jb21t
b24vZG9tYWluLmMKPiArKysgYi94ZW4vY29tbW9uL2RvbWFpbi5jCj4gQEAgLTE0OSw2ICsxNDks
NyBAQCBzdHJ1Y3QgdmNwdSAqdmNwdV9jcmVhdGUoCj4gICAgICAgdi0+ZGlydHlfY3B1ID0gVkNQ
VV9DUFVfQ0xFQU47Cj4gICAKPiAgICAgICBzcGluX2xvY2tfaW5pdCgmdi0+dmlycV9sb2NrKTsK
PiArICAgIHNwaW5fbG9ja19pbml0KCZ2LT5tYXBwZWRfcnVuc3RhdGVfbG9jayk7Cj4gICAKPiAg
ICAgICB0YXNrbGV0X2luaXQoJnYtPmNvbnRpbnVlX2h5cGVyY2FsbF90YXNrbGV0LCBOVUxMLCAw
KTsKPiAgIAo+IEBAIC02OTksNiArNzAwLDY5IEBAIGludCByY3VfbG9ja19saXZlX3JlbW90ZV9k
b21haW5fYnlfaWQoZG9taWRfdCBkb20sIHN0cnVjdCBkb21haW4gKipkKQo+ICAgICAgIHJldHVy
biAwOwo+ICAgfQo+ICAgCj4gK3N0YXRpYyB2b2lkIF91bm1hcF9ydW5zdGF0ZV9hcmVhKHN0cnVj
dCB2Y3B1ICp2KQpBIGJldHRlciBuYW1lIHdvdWxkIGJlIHVuYW1lcF9ydW5zdGF0ZV9hcmVhX2xv
Y2tlZCgpIHNvIHlvdSBhdm9pZCB0aGUgcmVzZXJ2ZWQgCm5hbWUgYW5kIG1ha2UgY2xlYXIgb2Yg
dGhlIHVzZS4KCj4gK3sKPiArICAgIG1mbl90IG1mbjsKPiArCj4gKyAgICBpZiAoICF2LT5tYXBw
ZWRfcnVuc3RhdGUgKQo+ICsgICAgICAgIHJldHVybjsKPiArCj4gKyAgICBtZm4gPSBfbWZuKHZp
cnRfdG9fbWZuKHJ1bnN0YXRlX2d1ZXN0KHYpLnApKTsKCkFzIHBvaW50ZWQgb3V0IGJ5IEphbiBp
biB0aGUgcHJldmlvdXMgdmVyc2lvbjoKClRoZSBwb2ludGVyIGlzIHRoZSByZXN1bHQgb2YgX19t
YXBfZG9tYWluX3BhZ2VfZ2xvYmFsKCkuIFNvIEkgZG9uJ3QgdGhpbmsgeW91CmRvbid0IHRoaW5r
IHlvdSBjYW4gbGVnaXRpbWF0ZWx5IHVzZSB2aXJ0X3RvX21mbigpIG9uIGl0LCBhdApsZWFzdCBu
b3Qgb24geDg2OyBkb21haW5fcGFnZV9tYXBfdG9fbWZuKCkgaXMgd2hhdCB5b3UKd2FudCB0byB1
c2UgaGVyZS4KCj4gKwo+ICsgICAgdW5tYXBfZG9tYWluX3BhZ2VfZ2xvYmFsKCh2b2lkICopCj4g
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCh1bnNpZ25lZCBsb25nKXYtPm1hcHBlZF9y
dW5zdGF0ZSAmCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBBR0VfTUFTSykpOwo+
ICsKPiArICAgIHYtPm1hcHBlZF9ydW5zdGF0ZSA9IE5VTEw7Cj4gKyAgICBwdXRfcGFnZV9hbmRf
dHlwZShtZm5fdG9fcGFnZShtZm4pKTsKPiArfQoKV2Ugc2VlbSB0byBoYXZlIHRoaXMgcGF0dGVy
biBpbiBhIGZldyBwbGFjZXMgbm93IChzZWUgdW5tYXBfZ3Vlc3RfcGFnZSkuIEl0IAp3b3VsZCBi
ZSBnb29kIHRvIGludHJvZHVjZSBoZWxwZXJzIHRoYXQgY2FuIGJlIHVzZWQgZXZlcnl3aGVyZSAo
cHJvYmFibHkgbGlmdGVkIApmcm9tIGNvbW1vbi9ldmVudF9maWZvLmMuCgo+ICsKPiArc3RhdGlj
IGludCBtYXBfcnVuc3RhdGVfYXJlYShzdHJ1Y3QgdmNwdSAqdiwKPiArICAgICAgICAgICAgICAg
ICAgICAgIHN0cnVjdCB2Y3B1X3JlZ2lzdGVyX3J1bnN0YXRlX21lbW9yeV9hcmVhICphcmVhKQo+
ICt7Cj4gKyAgICB1bnNpZ25lZCBsb25nIG9mZnNldCA9IGFyZWEtPmFkZHIucCAmIH5QQUdFX01B
U0s7Cj4gKyAgICBnZm5fdCBnZm4gPSBnYWRkcl90b19nZm4oYXJlYS0+YWRkci5wKTsKPiArICAg
IHN0cnVjdCBkb21haW4gKmQgPSB2LT5kb21haW47Cj4gKyAgICB2b2lkICptYXBwaW5nOwo+ICsg
ICAgc3RydWN0IHBhZ2VfaW5mbyAqcGFnZTsKPiArICAgIHNpemVfdCBzaXplID0gc2l6ZW9mIChz
dHJ1Y3QgdmNwdV9ydW5zdGF0ZV9pbmZvICk7CgpzcGFjZSBpcyBub3QgbmVjZXNzYXJ5IGJlZm9y
ZSApLgoKQnV0IGlzIHRoZSB2YXJpYWJsZSByZWFsbHkgbmVjZXNzYXJ5PwoKPiArCj4gKyAgICBp
ZiAoIG9mZnNldCA+IChQQUdFX1NJWkUgLSBzaXplKSApCj4gKyAgICAgICAgcmV0dXJuIC1FSU5W
QUw7Cj4gKwo+ICsgICAgcGFnZSA9IGdldF9wYWdlX2Zyb21fZ2ZuKGQsIGdmbl94KGdmbiksIE5V
TEwsIFAyTV9BTExPQyk7Cj4gKyAgICBpZiAoICFwYWdlICkKPiArICAgICAgICByZXR1cm4gLUVJ
TlZBTDsKPiArCj4gKyAgICBpZiAoICFnZXRfcGFnZV90eXBlKHBhZ2UsIFBHVF93cml0YWJsZV9w
YWdlKSApCj4gKyAgICB7Cj4gKyAgICAgICAgcHV0X3BhZ2UocGFnZSk7Cj4gKyAgICAgICAgcmV0
dXJuIC1FSU5WQUw7Cj4gKyAgICB9Cj4gKwo+ICsgICAgbWFwcGluZyA9IF9fbWFwX2RvbWFpbl9w
YWdlX2dsb2JhbChwYWdlKTsKPiArCj4gKyAgICBpZiAoIG1hcHBpbmcgPT0gTlVMTCApCj4gKyAg
ICB7Cj4gKyAgICAgICAgcHV0X3BhZ2VfYW5kX3R5cGUocGFnZSk7Cj4gKyAgICAgICAgcmV0dXJu
IC1FTk9NRU07Cj4gKyAgICB9Cj4gKwo+ICsgICAgc3Bpbl9sb2NrKCZ2LT5tYXBwZWRfcnVuc3Rh
dGVfbG9jayk7Cj4gKyAgICBfdW5tYXBfcnVuc3RhdGVfYXJlYSh2KTsKPiArICAgIHYtPm1hcHBl
ZF9ydW5zdGF0ZSA9IG1hcHBpbmcgKyBvZmZzZXQ7Cj4gKyAgICBzcGluX3VubG9jaygmdi0+bWFw
cGVkX3J1bnN0YXRlX2xvY2spOwo+ICsKPiArICAgIHJldHVybiAwOwo+ICt9Cj4gKwo+ICtzdGF0
aWMgdm9pZCB1bm1hcF9ydW5zdGF0ZV9hcmVhKHN0cnVjdCB2Y3B1ICp2KQo+ICt7Cj4gKyAgICBz
cGluX2xvY2soJnYtPm1hcHBlZF9ydW5zdGF0ZV9sb2NrKTsKPiArICAgIF91bm1hcF9ydW5zdGF0
ZV9hcmVhKHYpOwo+ICsgICAgc3Bpbl91bmxvY2soJnYtPm1hcHBlZF9ydW5zdGF0ZV9sb2NrKTsK
PiArfQo+ICsKPiAgIGludCBkb21haW5fa2lsbChzdHJ1Y3QgZG9tYWluICpkKQo+ICAgewo+ICAg
ICAgIGludCByYyA9IDA7Cj4gQEAgLTczNyw3ICs4MDEsMTEgQEAgaW50IGRvbWFpbl9raWxsKHN0
cnVjdCBkb21haW4gKmQpCj4gICAgICAgICAgIGlmICggY3B1cG9vbF9tb3ZlX2RvbWFpbihkLCBj
cHVwb29sMCkgKQo+ICAgICAgICAgICAgICAgcmV0dXJuIC1FUkVTVEFSVDsKPiAgICAgICAgICAg
Zm9yX2VhY2hfdmNwdSAoIGQsIHYgKQo+ICsgICAgICAgIHsKPiArICAgICAgICAgICAgc2V0X3hl
bl9ndWVzdF9oYW5kbGUocnVuc3RhdGVfZ3Vlc3QodiksIE5VTEwpOwo+ICsgICAgICAgICAgICB1
bm1hcF9ydW5zdGF0ZV9hcmVhKHYpOwo+ICAgICAgICAgICAgICAgdW5tYXBfdmNwdV9pbmZvKHYp
Owo+ICsgICAgICAgIH0KPiAgICAgICAgICAgZC0+aXNfZHlpbmcgPSBET01EWUlOR19kZWFkOwo+
ICAgICAgICAgICAvKiBNZW0gZXZlbnQgY2xlYW51cCBoYXMgdG8gZ28gaGVyZSBiZWNhdXNlIHRo
ZSByaW5ncwo+ICAgICAgICAgICAgKiBoYXZlIHRvIGJlIHB1dCBiZWZvcmUgd2UgY2FsbCBwdXRf
ZG9tYWluLiAqLwo+IEBAIC0xMTkyLDYgKzEyNjAsNyBAQCBpbnQgZG9tYWluX3NvZnRfcmVzZXQo
c3RydWN0IGRvbWFpbiAqZCkKPiAgICAgICBmb3JfZWFjaF92Y3B1ICggZCwgdiApCj4gICAgICAg
ewo+ICAgICAgICAgICBzZXRfeGVuX2d1ZXN0X2hhbmRsZShydW5zdGF0ZV9ndWVzdCh2KSwgTlVM
TCk7Cj4gKyAgICAgICAgdW5tYXBfcnVuc3RhdGVfYXJlYSh2KTsKPiAgICAgICAgICAgdW5tYXBf
dmNwdV9pbmZvKHYpOwo+ICAgICAgIH0KPiAgIAo+IEBAIC0xNTM2LDggKzE2MDUsMTcgQEAgbG9u
ZyBkb192Y3B1X29wKGludCBjbWQsIHVuc2lnbmVkIGludCB2Y3B1aWQsIFhFTl9HVUVTVF9IQU5E
TEVfUEFSQU0odm9pZCkgYXJnKQo+ICAgICAgIH0KPiAgIAo+ICAgICAgIGNhc2UgVkNQVU9QX3Jl
Z2lzdGVyX3J1bnN0YXRlX3BoeXNfbWVtb3J5X2FyZWE6Cj4gLSAgICAgICAgcmMgPSAtRU9QTk9U
U1VQUDsKPiArICAgIHsKPiArICAgICAgICBzdHJ1Y3QgdmNwdV9yZWdpc3Rlcl9ydW5zdGF0ZV9t
ZW1vcnlfYXJlYSBhcmVhOwo+ICsKPiArICAgICAgICByYyA9IC1FRkFVTFQ7Cj4gKyAgICAgICAg
aWYgKCBjb3B5X2Zyb21fZ3Vlc3QoJmFyZWEsIGFyZywgMSkgKQo+ICsgICAgICAgICAgICBicmVh
azsKPiArCj4gKyAgICAgICAgcmMgPSBtYXBfcnVuc3RhdGVfYXJlYSh2LCAmYXJlYSk7Cj4gKwo+
ICAgICAgICAgICBicmVhazsKPiArICAgIH0KPiAgIAo+ICAgI2lmZGVmIFZDUFVfVFJBUF9OTUkK
PiAgICAgICBjYXNlIFZDUFVPUF9zZW5kX25taToKPiBkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUv
YXNtLWFybS9kb21haW4uaCBiL3hlbi9pbmNsdWRlL2FzbS1hcm0vZG9tYWluLmgKPiBpbmRleCAz
MTJmZWM4Li4zZmI2ZWEyIDEwMDY0NAo+IC0tLSBhL3hlbi9pbmNsdWRlL2FzbS1hcm0vZG9tYWlu
LmgKPiArKysgYi94ZW4vaW5jbHVkZS9hc20tYXJtL2RvbWFpbi5oCj4gQEAgLTIxNyw2ICsyMTcs
OCBAQCB2b2lkIHZjcHVfc2hvd19leGVjdXRpb25fc3RhdGUoc3RydWN0IHZjcHUgKik7Cj4gICB2
b2lkIHZjcHVfc2hvd19yZWdpc3RlcnMoY29uc3Qgc3RydWN0IHZjcHUgKik7Cj4gICB2b2lkIHZj
cHVfc3dpdGNoX3RvX2FhcmNoNjRfbW9kZShzdHJ1Y3QgdmNwdSAqKTsKPiAgIAo+ICt2b2lkIHVw
ZGF0ZV9ydW5zdGF0ZV9hcmVhKHN0cnVjdCB2Y3B1ICopOwo+ICsKPiAgIC8qCj4gICAgKiBEdWUg
dG8gdGhlIHJlc3RyaWN0aW9uIG9mIEdJQ3YzLCB0aGUgbnVtYmVyIG9mIHZDUFVzIGluIEFGRjAg
aXMKPiAgICAqIGxpbWl0ZWQgdG8gMTYsIHRodXMgb25seSB0aGUgZmlyc3QgNCBiaXRzIG9mIEFG
RjAgYXJlIGxlZ2FsLiBXZSB3aWxsCj4gZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL3hlbi9kb21h
aW4uaCBiL3hlbi9pbmNsdWRlL3hlbi9kb21haW4uaAo+IGluZGV4IGQxYmZjODIuLmVjZGRjZmUg
MTAwNjQ0Cj4gLS0tIGEveGVuL2luY2x1ZGUveGVuL2RvbWFpbi5oCj4gKysrIGIveGVuL2luY2x1
ZGUveGVuL2RvbWFpbi5oCj4gQEAgLTExOCw0ICsxMTgsNiBAQCBzdHJ1Y3Qgdm51bWFfaW5mbyB7
Cj4gICAKPiAgIHZvaWQgdm51bWFfZGVzdHJveShzdHJ1Y3Qgdm51bWFfaW5mbyAqdm51bWEpOwo+
ICAgCj4gK3N0cnVjdCB2Y3B1X3JlZ2lzdGVyX3J1bnN0YXRlX21lbW9yeV9hcmVhOwo+ICsKPiAg
ICNlbmRpZiAvKiBfX1hFTl9ET01BSU5fSF9fICovCj4gZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRl
L3hlbi9zY2hlZC5oIGIveGVuL2luY2x1ZGUveGVuL3NjaGVkLmgKPiBpbmRleCA3NDhiYjBmLi4y
YWZlMzFjIDEwMDY0NAo+IC0tLSBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCj4gKysrIGIveGVu
L2luY2x1ZGUveGVuL3NjaGVkLmgKPiBAQCAtMTYzLDE1ICsxNjMsMjMgQEAgc3RydWN0IHZjcHUK
PiAgICAgICB2b2lkICAgICAgICAgICAgKnNjaGVkX3ByaXY7ICAgIC8qIHNjaGVkdWxlci1zcGVj
aWZpYyBkYXRhICovCj4gICAKPiAgICAgICBzdHJ1Y3QgdmNwdV9ydW5zdGF0ZV9pbmZvIHJ1bnN0
YXRlOwo+ICsKPiArICAgIHNwaW5sb2NrX3QgICAgICBtYXBwZWRfcnVuc3RhdGVfbG9jazsKPiAr
Cj4gICAjaWZuZGVmIENPTkZJR19DT01QQVQKPiAgICMgZGVmaW5lIHJ1bnN0YXRlX2d1ZXN0KHYp
ICgodiktPnJ1bnN0YXRlX2d1ZXN0KQo+ICAgICAgIFhFTl9HVUVTVF9IQU5ETEUodmNwdV9ydW5z
dGF0ZV9pbmZvX3QpIHJ1bnN0YXRlX2d1ZXN0OyAvKiBndWVzdCBhZGRyZXNzICovCj4gKyAgICB2
Y3B1X3J1bnN0YXRlX2luZm9fdCAqbWFwcGVkX3J1bnN0YXRlOwo+ICAgI2Vsc2UKPiAgICMgZGVm
aW5lIHJ1bnN0YXRlX2d1ZXN0KHYpICgodiktPnJ1bnN0YXRlX2d1ZXN0Lm5hdGl2ZSkKPiAgICAg
ICB1bmlvbiB7Cj4gICAgICAgICAgIFhFTl9HVUVTVF9IQU5ETEUodmNwdV9ydW5zdGF0ZV9pbmZv
X3QpIG5hdGl2ZTsKPiAgICAgICAgICAgWEVOX0dVRVNUX0hBTkRMRSh2Y3B1X3J1bnN0YXRlX2lu
Zm9fY29tcGF0X3QpIGNvbXBhdDsKPiAgICAgICB9IHJ1bnN0YXRlX2d1ZXN0OyAvKiBndWVzdCBh
ZGRyZXNzICovCj4gKyAgICB1bmlvbiB7Cj4gKyAgICAgICAgdmNwdV9ydW5zdGF0ZV9pbmZvX3Qq
IG5hdGl2ZTsKPiArICAgICAgICB2Y3B1X3J1bnN0YXRlX2luZm9fY29tcGF0X3QqIGNvbXBhdDsK
PiArICAgIH0gbWFwcGVkX3J1bnN0YXRlOyAvKiBndWVzdCBhZGRyZXNzICovCgpUaGUgY29tYmlu
YXRpb24gb2YgbWFwcGVkX3J1bnN0YXRlIGFuZCBydW5zdGF0ZV9ndWVzdCBpcyBhIGJpdCBjb25m
dXNpbmcuIEkgCnRoaW5rIHlvdSB3YW50IHRvIHJld29yayB0aGUgaW50ZXJmYWNlIHRvIHNob3cg
dGhhdCBvbmx5IG9uZSBpcyBwb3NzaWJsZSBhdCB0aGUgCnRpbWUgYW5kIG1ha2UgY2xlYXIgd2hp
Y2ggb25lIGlzIHVzZWQgYnkgd2hvLiBNYXliZToKCnVuaW9uCnsKICAgIC8qIExlZ2FjeSBpbnRl
cmZhY2UgdG8gYmUgdXNlZCB3aGVuIHRoZSBndWVzdCBwcm92aWRlcyBhIHZpcnR1YWwgYWRkcmVz
cyAqLwogICAgdW5pb24gewogICAgICAgWEVOX0dVRVNUX0hBTkRMRSh2Y3B1X3J1bnN0YXRlX2lu
Zm9fdCkgbmF0aXZlOwogICAgICAgLi4uCiAgICB9IHZpcnQ7CgogICAgLyogSW50ZXJmYWNlIHVz
ZWQgd2hlbiB0aGUgZ3Vlc3QgcHJvdmlkZXMgYSBwaHlzaWNhbCBhZGRyZXNzICovCiAgICB1bmlv
biB7CiAgICB9IHBoeXM7Cn0gcnVuc3RhdGVfZ3Vlc3QuCgpydW5zdGF0ZV9ndWVzdF90eXBlIC8q
IGNvdWxkIGJlIGEgYm9vbCBvciBlbnVtICovCgpKYW4gd2hhdCBkbyB5b3UgdGhpbms/CgpDaGVl
cnMsCgotLSAKSnVsaWVuIEdyYWxsCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5w
cm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8v
eGVuLWRldmVs

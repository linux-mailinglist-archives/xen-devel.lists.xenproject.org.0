Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 53898CE722
	for <lists+xen-devel@lfdr.de>; Mon,  7 Oct 2019 17:17:17 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iHUiq-0007de-PQ; Mon, 07 Oct 2019 15:14:52 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=0SFq=YA=gmail.com=rosbrookn@srs-us1.protection.inumbo.net>)
 id 1iHUip-0007d0-Pr
 for xen-devel@lists.xenproject.org; Mon, 07 Oct 2019 15:14:51 +0000
X-Inumbo-ID: 0b1204cc-e915-11e9-8c93-bc764e2007e4
Received: from mail-qt1-x82c.google.com (unknown [2607:f8b0:4864:20::82c])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 0b1204cc-e915-11e9-8c93-bc764e2007e4;
 Mon, 07 Oct 2019 15:13:40 +0000 (UTC)
Received: by mail-qt1-x82c.google.com with SMTP id u22so19592333qtq.13
 for <xen-devel@lists.xenproject.org>; Mon, 07 Oct 2019 08:13:40 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=LUYRgjlAufinBicA8NtCPTHU6A7dJzgpXyfy8a3qo9M=;
 b=hsaB+s9oggH0saICrOWav874+d7YCdVHkvyGZhy9PCMZOUkK0HLakJhGW2haOxuvpX
 Pw6pFbZ/2gABPyyDRC1esPSyn5lk2AklVbY1xdovqUzNZBHiGmv4r122KXJh8D+Ps0qG
 Ib6nydaOPFHfBnIuTHgy+8iYH91Meg1BYoK+uAO5Sagofu69YYKIvthX7q0LNfGUyDqs
 zYewa9XHx3+QFd3eIcLotafBLDEVeanUKB2AUX1uNZUOknr0GDgkfixvME29HqlaQ8Ju
 RRbdDndLrYV0g5YD7n1fAraFDpPN6TuQTkTTOzNnxcZH227OO+Ls8y5ebYnYRoNLlKKH
 Uxgg==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=LUYRgjlAufinBicA8NtCPTHU6A7dJzgpXyfy8a3qo9M=;
 b=kgOgBCpae09z2xwYlu7oYRAV7ZcMHHVMb6om/LVIBhyOekrlsHibKNeHAXXnxleuDd
 mnOJDrcdiAvACgCId1RRfha13flRNXnY8z8i49JSXX1/Ty6S3Nln49l82dVmuP/m9tJW
 mFJ5/BwaPWjXAlI7Qda9Q8UL1dp0fEMpLvtBn+9Oc8MmS7Z3yyncfq8F+D28Ax+v4xPD
 /Csf7zPawhGCX7Vq2idM6rE6ECguLmusnugZXKCgEhhAiTDLcQoVoCDowVHJ9ftwJ2ox
 4TtvCg0vvvyHzfIBLivRdTyozKlz1E0WaVbQILncR2vYYv8VJLRLyJMm7A8N3ZdCqQS5
 ORPQ==
X-Gm-Message-State: APjAAAXLjY8uhe56S/ksFOWKx+jBrg1oPwddQyFLmio/vIcj/dCBEfSp
 oPGoUjPePBZaDAnhztZhLfe7TcGk
X-Google-Smtp-Source: APXvYqxs7dTgrzPWibkVI7+mLjepb1Mbcys3EohzibKSCnroqA49Rwb7XytQ17bewv70ZgDiGP+0Nw==
X-Received: by 2002:ac8:7604:: with SMTP id t4mr30475588qtq.34.1570461219283; 
 Mon, 07 Oct 2019 08:13:39 -0700 (PDT)
Received: from five.crux.rad.ainfosec.com (209-217-208-226.northland.net.
 [209.217.208.226])
 by smtp.googlemail.com with ESMTPSA id c185sm8354313qkg.74.2019.10.07.08.13.38
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Mon, 07 Oct 2019 08:13:38 -0700 (PDT)
From: Nick Rosbrook <rosbrookn@gmail.com>
To: xen-devel@lists.xenproject.org
Date: Mon,  7 Oct 2019 11:13:07 -0400
Message-Id: <938d9d152a9e31ca5b40e10282bd9c3c34c4348b.1570456846.git.rosbrookn@ainfosec.com>
X-Mailer: git-send-email 2.19.1
In-Reply-To: <cover.1570456846.git.rosbrookn@ainfosec.com>
References: <cover.1570456846.git.rosbrookn@ainfosec.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH 20/24] golang/xenlight: implement keyed union Go
 to C marshaling
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Nick Rosbrook <rosbrookn@ainfosec.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, kerriganb@ainfosec.com,
 George Dunlap <george.dunlap@citrix.com>, Wei Liu <wl@xen.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

RnJvbTogTmljayBSb3Nicm9vayA8cm9zYnJvb2tuQGFpbmZvc2VjLmNvbT4KClNpbmNlIHRoZSBD
IHVuaW9uIGNhbm5vdCBiZSBkaXJlY3RseSBwb3B1bGF0ZWQsIHBvcHVsYXRlIHRoZSBmaWVsZHMg
b2YgdGhlCmNvcnJlc3BvbmRpbmcgQyBzdHJ1Y3QgZGVmaW5lZCBpbiB0aGUgY2dvIHByZWFtYmxl
LCBhbmQgdGhlbiBjb3B5IHRoYXQKc3RydWN0IGFzIGJ5dGVzIGludG8gdGhlIGJ5dGUgc2xpY2Ug
dGhhdCBHbyB1c2VzIGFzIHRoZSB1bmlvbi4KClNpZ25lZC1vZmYtYnk6IE5pY2sgUm9zYnJvb2sg
PHJvc2Jyb29rbkBhaW5mb3NlYy5jb20+Ci0tLQpDYzogR2VvcmdlIER1bmxhcCA8Z2VvcmdlLmR1
bmxhcEBjaXRyaXguY29tPgpDYzogSWFuIEphY2tzb24gPGlhbi5qYWNrc29uQGV1LmNpdHJpeC5j
b20+CkNjOiBXZWkgTGl1IDx3bEB4ZW4ub3JnPgoKIHRvb2xzL2dvbGFuZy94ZW5saWdodC9nZW5n
b3R5cGVzLnB5ICAgICAgIHwgIDc3ICsrKystCiB0b29scy9nb2xhbmcveGVubGlnaHQveGVubGln
aHRfaGVscGVycy5nbyB8IDMyNSArKysrKysrKysrKysrKysrKysrKysrCiAyIGZpbGVzIGNoYW5n
ZWQsIDQwMCBpbnNlcnRpb25zKCspLCAyIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3Rvb2xz
L2dvbGFuZy94ZW5saWdodC9nZW5nb3R5cGVzLnB5IGIvdG9vbHMvZ29sYW5nL3hlbmxpZ2h0L2dl
bmdvdHlwZXMucHkKaW5kZXggZWNjYzMzNGI0MS4uMzVkOWRmZWE0MCAxMDA2NDQKLS0tIGEvdG9v
bHMvZ29sYW5nL3hlbmxpZ2h0L2dlbmdvdHlwZXMucHkKKysrIGIvdG9vbHMvZ29sYW5nL3hlbmxp
Z2h0L2dlbmdvdHlwZXMucHkKQEAgLTUyNSw4ICs1MjUsNyBAQCBkZWYgeGVubGlnaHRfZ29sYW5n
X2RlZmluZV90b19DKHR5ID0gTm9uZSwgdHlwZW5hbWUgPSBOb25lLCBuZXN0ZWQgPSBGYWxzZSk6
CiAgICAgICAgICAgICBzICs9IHhlbmxpZ2h0X2dvbGFuZ19kZWZpbmVfdG9fQyhmLnR5cGUsIHR5
cGVuYW1lPWYubmFtZSwgbmVzdGVkPVRydWUpCiAKICAgICAgICAgZWxpZiBpc2luc3RhbmNlKGYu
dHlwZSwgaWRsLktleWVkVW5pb24pOgotICAgICAgICAgICAgIyBUT0RPCi0gICAgICAgICAgICBw
YXNzCisgICAgICAgICAgICBzICs9IHhlbmxpZ2h0X2dvbGFuZ191bmlvbl90b19DKGYudHlwZSwg
Zi5uYW1lLCB0eS50eXBlbmFtZSwgdHkuZGlzcG9zZV9mbikKIAogICAgICAgICBlbHNlOgogICAg
ICAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCd0eXBlIHt9IG5vdCBzdXBwb3J0ZWQnLmZvcm1hdChm
LnR5cGUpKQpAQCAtNTM3LDYgKzUzNiw4MCBAQCBkZWYgeGVubGlnaHRfZ29sYW5nX2RlZmluZV90
b19DKHR5ID0gTm9uZSwgdHlwZW5hbWUgPSBOb25lLCBuZXN0ZWQgPSBGYWxzZSk6CiAKICAgICBy
ZXR1cm4gcwogCitkZWYgeGVubGlnaHRfZ29sYW5nX3VuaW9uX3RvX0ModHkgPSBOb25lLCB1bmlv
bl9uYW1lID0gJycsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0X25hbWUg
PSAnJywgZGlzcG9zZV9mbiA9ICcnKToKKyAgICBrZXluYW1lICAgPSB0eS5rZXl2YXIubmFtZQor
ICAgIGdva2V5bmFtZSA9IHhlbmxpZ2h0X2dvbGFuZ19mbXRfbmFtZShrZXluYW1lKQorICAgIGtl
eXR5cGUgICA9IHR5LmtleXZhci50eXBlLnR5cGVuYW1lCisgICAgZ29rZXl0eXBlID0geGVubGln
aHRfZ29sYW5nX2ZtdF9uYW1lKGtleXR5cGUpCisKKyAgICBpbnRlcmZhY2VfbmFtZSA9ICd7fV97
fV91bmlvbicuZm9ybWF0KHN0cnVjdF9uYW1lLCBrZXluYW1lKQorICAgIGludGVyZmFjZV9uYW1l
ID0geGVubGlnaHRfZ29sYW5nX2ZtdF9uYW1lKGludGVyZmFjZV9uYW1lLCBleHBvcnRlZD1GYWxz
ZSkKKworICAgIGNnb19rZXluYW1lID0ga2V5bmFtZQorICAgIGlmIGNnb19rZXluYW1lIGluIGdv
X2tleXdvcmRzOgorICAgICAgICBjZ29fa2V5bmFtZSA9ICdfJyArIGNnb19rZXluYW1lCisKKwor
ICAgIHMgPSAneGMue30gPSBDLnt9KHgue30pXG4nLmZvcm1hdChjZ29fa2V5bmFtZSxrZXl0eXBl
LGdva2V5bmFtZSkKKyAgICBzICs9ICdzd2l0Y2ggeC57fXt7XG4nLmZvcm1hdChnb2tleW5hbWUp
CisKKyAgICAjIENyZWF0ZSBzd2l0Y2ggc3RhdGVtZW50IHRvIGRldGVybWluZSBob3cgdG8gcG9w
dWxhdGUgdGhlIEMgdW5pb24uCisgICAgZm9yIGYgaW4gdHkuZmllbGRzOgorICAgICAgICBrZXlf
dmFsID0gJ3t9X3t9Jy5mb3JtYXQoa2V5dHlwZSwgZi5uYW1lKQorICAgICAgICBrZXlfdmFsID0g
eGVubGlnaHRfZ29sYW5nX2ZtdF9uYW1lKGtleV92YWwpCisgICAgICAgIGlmIGYudHlwZSBpcyBO
b25lOgorICAgICAgICAgICAgY29udGludWUKKworICAgICAgICBzICs9ICdjYXNlIHt9OlxuJy5m
b3JtYXQoa2V5X3ZhbCkKKyAgICAgICAgY2dvdHlwZSA9ICd7fV97fV91bmlvbl97fScuZm9ybWF0
KHN0cnVjdF9uYW1lLGtleW5hbWUsZi5uYW1lKQorICAgICAgICBnb3R5cGUgID0geGVubGlnaHRf
Z29sYW5nX2ZtdF9uYW1lKGNnb3R5cGUpCisgICAgICAgIGdvbmFtZSAgPSAne31fe30nLmZvcm1h
dChrZXluYW1lLGYubmFtZSkKKyAgICAgICAgZ29uYW1lICA9IHhlbmxpZ2h0X2dvbGFuZ19mbXRf
bmFtZShnb25hbWUsZXhwb3J0ZWQ9RmFsc2UpCisKKyAgICAgICAgZmllbGRfbmFtZSA9IHhlbmxp
Z2h0X2dvbGFuZ19mbXRfbmFtZSgne31fdW5pb24nLmZvcm1hdChrZXluYW1lKSkKKyAgICAgICAg
cyArPSAndG1wLCBvayA6PSB4Lnt9Lih7fSlcbicuZm9ybWF0KGZpZWxkX25hbWUsZ290eXBlKQor
ICAgICAgICBzICs9ICdpZiAhb2sge1xuJworICAgICAgICBzICs9ICdDLnt9KCZ4YylcbicuZm9y
bWF0KGRpc3Bvc2VfZm4pCisgICAgICAgIHMgKz0gJ3JldHVybiB4YyxlcnJvcnMuTmV3KCJ3cm9u
ZyB0eXBlIGZvciB1bmlvbiBrZXkge30iKVxuJy5mb3JtYXQoa2V5bmFtZSkKKyAgICAgICAgcyAr
PSAnfVxuJworCisgICAgICAgIHMgKz0gJ3ZhciB7fSBDLnt9XG4nLmZvcm1hdChmLm5hbWUsY2dv
dHlwZSkKKyAgICAgICAgZm9yIHVmIGluIGYudHlwZS5maWVsZHM6CisgICAgICAgICAgICBnb3R5
cGVuYW1lID0geGVubGlnaHRfZ29sYW5nX2ZtdF9uYW1lKHVmLnR5cGUudHlwZW5hbWUpCisgICAg
ICAgICAgICBjdHlwZW5hbWUgID0gdWYudHlwZS50eXBlbmFtZQorICAgICAgICAgICAgZ29mbmFt
ZSAgICA9IHhlbmxpZ2h0X2dvbGFuZ19mbXRfbmFtZSh1Zi5uYW1lKQorCisgICAgICAgICAgICBp
c19jYXN0YWJsZSA9ICh1Zi50eXBlLmpzb25fcGFyc2VfdHlwZSA9PSAnSlNPTl9JTlRFR0VSJyBv
cgorICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNpbnN0YW5jZSh1Zi50eXBlLCBpZGwuRW51
bWVyYXRpb24pIG9yCisgICAgICAgICAgICAgICAgICAgICAgICAgICBnb3R5cGVuYW1lIGluIGdv
X2J1aWx0aW5fdHlwZXMpCisKKyAgICAgICAgICAgIGlmIG5vdCBpc19jYXN0YWJsZToKKyAgICAg
ICAgICAgICAgICBzICs9ICd7fS57fSwgZXJyID0gdG1wLnt9LnRvQygpXG4nLmZvcm1hdChmLm5h
bWUsdWYubmFtZSxnb2ZuYW1lKQorICAgICAgICAgICAgICAgIHMgKz0gJ2lmIGVyciAhPSBuaWwg
e1xuJworICAgICAgICAgICAgICAgIHMgKz0gJ0Mue30oJnhjKVxuJy5mb3JtYXQoZGlzcG9zZV9m
bikKKyAgICAgICAgICAgICAgICBzICs9ICdyZXR1cm4geGMsZXJyIFxufVxuJworCisgICAgICAg
ICAgICBlbGlmIGdvdHlwZW5hbWUgPT0gJ3N0cmluZyc6CisgICAgICAgICAgICAgICAgcyArPSAn
e30ue30gPSBDLkNTdHJpbmcodG1wLnt9KVxuJy5mb3JtYXQoZi5uYW1lLHVmLm5hbWUsZ29mbmFt
ZSkKKworICAgICAgICAgICAgZWxzZToKKyAgICAgICAgICAgICAgICBzICs9ICd7fS57fSA9IEMu
e30odG1wLnt9KVxuJy5mb3JtYXQoZi5uYW1lLHVmLm5hbWUsY3R5cGVuYW1lLGdvZm5hbWUpCisK
KyAgICAgICAgIyBUaGUgdW5pb24gaXMgc3RpbGwgcmVwcmVzZW50ZWQgYXMgR28gW11ieXRlLgor
ICAgICAgICBzICs9ICd7fUJ5dGVzIDo9IEMuR29CeXRlcyh1bnNhZmUuUG9pbnRlcigme30pLEMu
c2l6ZW9mX3t9KVxuJy5mb3JtYXQoZi5uYW1lLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZi5uYW1l
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgY2dvdHlwZSkKKyAgICAgICAgcyArPSAnY29weSh4Yy57
fVs6XSx7fUJ5dGVzKVxuJy5mb3JtYXQodW5pb25fbmFtZSxmLm5hbWUpCisKKyAgICAjIEVuZCBz
d2l0Y2ggc3RhdGVtZW50CisgICAgcyArPSAnZGVmYXVsdDpcbicKKyAgICBlcnJfc3RyaW5nID0g
JyJpbnZhbGlkIHVuaW9uIGtleSBcJyV2XCciLCB4Lnt9Jy5mb3JtYXQoZ29rZXluYW1lKQorICAg
IHMgKz0gJ3JldHVybiB4YywgZm10LkVycm9yZih7fSknLmZvcm1hdChlcnJfc3RyaW5nKQorICAg
IHMgKz0gJ31cbicKKworICAgIHJldHVybiBzCisKIGRlZiB4ZW5saWdodF9nb2xhbmdfZm10X25h
bWUobmFtZSwgZXhwb3J0ZWQgPSBUcnVlKToKICAgICAiIiIKICAgICBUYWtlIGEgZ2l2ZW4gdHlw
ZSBuYW1lIGFuZCByZXR1cm4gYW4KZGlmZiAtLWdpdCBhL3Rvb2xzL2dvbGFuZy94ZW5saWdodC94
ZW5saWdodF9oZWxwZXJzLmdvIGIvdG9vbHMvZ29sYW5nL3hlbmxpZ2h0L3hlbmxpZ2h0X2hlbHBl
cnMuZ28KaW5kZXggOTJlNmFmY2QxMC4uMmNiNWFkYWVjNSAxMDA2NDQKLS0tIGEvdG9vbHMvZ29s
YW5nL3hlbmxpZ2h0L3hlbmxpZ2h0X2hlbHBlcnMuZ28KKysrIGIvdG9vbHMvZ29sYW5nL3hlbmxp
Z2h0L3hlbmxpZ2h0X2hlbHBlcnMuZ28KQEAgLTQzMyw2ICs0MzMsMjEgQEAgZnVuYyAoeCAqQ2hh
bm5lbGluZm8pIHRvQygpICh4YyBDLmxpYnhsX2NoYW5uZWxpbmZvLCBlcnIgZXJyb3IpIHsKIAl4
Yy5zdGF0ZSA9IEMuaW50KHguU3RhdGUpCiAJeGMuZXZ0Y2ggPSBDLmludCh4LkV2dGNoKQogCXhj
LnJyZWYgPSBDLmludCh4LlJyZWYpCisJeGMuY29ubmVjdGlvbiA9IEMubGlieGxfY2hhbm5lbF9j
b25uZWN0aW9uKHguQ29ubmVjdGlvbikKKwlzd2l0Y2ggeC5Db25uZWN0aW9uIHsKKwljYXNlIENo
YW5uZWxDb25uZWN0aW9uUHR5OgorCQl0bXAsIG9rIDo9IHguQ29ubmVjdGlvblVuaW9uLihDaGFu
bmVsaW5mb0Nvbm5lY3Rpb25VbmlvblB0eSkKKwkJaWYgIW9rIHsKKwkJCUMubGlieGxfY2hhbm5l
bGluZm9fZGlzcG9zZSgmeGMpCisJCQlyZXR1cm4geGMsIGVycm9ycy5OZXcoIndyb25nIHR5cGUg
Zm9yIHVuaW9uIGtleSBjb25uZWN0aW9uIikKKwkJfQorCQl2YXIgcHR5IEMubGlieGxfY2hhbm5l
bGluZm9fY29ubmVjdGlvbl91bmlvbl9wdHkKKwkJcHR5LnBhdGggPSBDLkNTdHJpbmcodG1wLlBh
dGgpCisJCXB0eUJ5dGVzIDo9IEMuR29CeXRlcyh1bnNhZmUuUG9pbnRlcigmcHR5KSwgQy5zaXpl
b2ZfbGlieGxfY2hhbm5lbGluZm9fY29ubmVjdGlvbl91bmlvbl9wdHkpCisJCWNvcHkoeGMudVs6
XSwgcHR5Qnl0ZXMpCisJZGVmYXVsdDoKKwkJcmV0dXJuIHhjLCBmbXQuRXJyb3JmKCJpbnZhbGlk
IHVuaW9uIGtleSAnJXYnIiwgeC5Db25uZWN0aW9uKQorCX0KIAlyZXR1cm4geGMsIG5pbAogfQog
CkBAIC0xMTgwLDYgKzExOTUsMjE2IEBAIGZ1bmMgKHggKkRvbWFpbkJ1aWxkSW5mbykgdG9DKCkg
KHhjIEMubGlieGxfZG9tYWluX2J1aWxkX2luZm8sIGVyciBlcnJvcikgewogCQlyZXR1cm4geGMs
IGVycgogCX0KIAl4Yy50ZWUgPSBDLmxpYnhsX3RlZV90eXBlKHguVGVlKQorCXhjLl90eXBlID0g
Qy5saWJ4bF9kb21haW5fdHlwZSh4LlR5cGUpCisJc3dpdGNoIHguVHlwZSB7CisJY2FzZSBEb21h
aW5UeXBlSHZtOgorCQl0bXAsIG9rIDo9IHguVHlwZVVuaW9uLihEb21haW5CdWlsZEluZm9UeXBl
VW5pb25Idm0pCisJCWlmICFvayB7CisJCQlDLmxpYnhsX2RvbWFpbl9idWlsZF9pbmZvX2Rpc3Bv
c2UoJnhjKQorCQkJcmV0dXJuIHhjLCBlcnJvcnMuTmV3KCJ3cm9uZyB0eXBlIGZvciB1bmlvbiBr
ZXkgdHlwZSIpCisJCX0KKwkJdmFyIGh2bSBDLmxpYnhsX2RvbWFpbl9idWlsZF9pbmZvX3R5cGVf
dW5pb25faHZtCisJCWh2bS5maXJtd2FyZSA9IEMuQ1N0cmluZyh0bXAuRmlybXdhcmUpCisJCWh2
bS5iaW9zID0gQy5saWJ4bF9iaW9zX3R5cGUodG1wLkJpb3MpCisJCWh2bS5wYWUsIGVyciA9IHRt
cC5QYWUudG9DKCkKKwkJaWYgZXJyICE9IG5pbCB7CisJCQlDLmxpYnhsX2RvbWFpbl9idWlsZF9p
bmZvX2Rpc3Bvc2UoJnhjKQorCQkJcmV0dXJuIHhjLCBlcnIKKwkJfQorCQlodm0uYXBpYywgZXJy
ID0gdG1wLkFwaWMudG9DKCkKKwkJaWYgZXJyICE9IG5pbCB7CisJCQlDLmxpYnhsX2RvbWFpbl9i
dWlsZF9pbmZvX2Rpc3Bvc2UoJnhjKQorCQkJcmV0dXJuIHhjLCBlcnIKKwkJfQorCQlodm0uYWNw
aSwgZXJyID0gdG1wLkFjcGkudG9DKCkKKwkJaWYgZXJyICE9IG5pbCB7CisJCQlDLmxpYnhsX2Rv
bWFpbl9idWlsZF9pbmZvX2Rpc3Bvc2UoJnhjKQorCQkJcmV0dXJuIHhjLCBlcnIKKwkJfQorCQlo
dm0uYWNwaV9zMywgZXJyID0gdG1wLkFjcGlTMy50b0MoKQorCQlpZiBlcnIgIT0gbmlsIHsKKwkJ
CUMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fZGlzcG9zZSgmeGMpCisJCQlyZXR1cm4geGMsIGVy
cgorCQl9CisJCWh2bS5hY3BpX3M0LCBlcnIgPSB0bXAuQWNwaVM0LnRvQygpCisJCWlmIGVyciAh
PSBuaWwgeworCQkJQy5saWJ4bF9kb21haW5fYnVpbGRfaW5mb19kaXNwb3NlKCZ4YykKKwkJCXJl
dHVybiB4YywgZXJyCisJCX0KKwkJaHZtLmFjcGlfbGFwdG9wX3NsYXRlLCBlcnIgPSB0bXAuQWNw
aUxhcHRvcFNsYXRlLnRvQygpCisJCWlmIGVyciAhPSBuaWwgeworCQkJQy5saWJ4bF9kb21haW5f
YnVpbGRfaW5mb19kaXNwb3NlKCZ4YykKKwkJCXJldHVybiB4YywgZXJyCisJCX0KKwkJaHZtLm54
LCBlcnIgPSB0bXAuTngudG9DKCkKKwkJaWYgZXJyICE9IG5pbCB7CisJCQlDLmxpYnhsX2RvbWFp
bl9idWlsZF9pbmZvX2Rpc3Bvc2UoJnhjKQorCQkJcmV0dXJuIHhjLCBlcnIKKwkJfQorCQlodm0u
dmlyaWRpYW4sIGVyciA9IHRtcC5WaXJpZGlhbi50b0MoKQorCQlpZiBlcnIgIT0gbmlsIHsKKwkJ
CUMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fZGlzcG9zZSgmeGMpCisJCQlyZXR1cm4geGMsIGVy
cgorCQl9CisJCWh2bS52aXJpZGlhbl9lbmFibGUsIGVyciA9IHRtcC5WaXJpZGlhbkVuYWJsZS50
b0MoKQorCQlpZiBlcnIgIT0gbmlsIHsKKwkJCUMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fZGlz
cG9zZSgmeGMpCisJCQlyZXR1cm4geGMsIGVycgorCQl9CisJCWh2bS52aXJpZGlhbl9kaXNhYmxl
LCBlcnIgPSB0bXAuVmlyaWRpYW5EaXNhYmxlLnRvQygpCisJCWlmIGVyciAhPSBuaWwgeworCQkJ
Qy5saWJ4bF9kb21haW5fYnVpbGRfaW5mb19kaXNwb3NlKCZ4YykKKwkJCXJldHVybiB4YywgZXJy
CisJCX0KKwkJaHZtLnRpbWVvZmZzZXQgPSBDLkNTdHJpbmcodG1wLlRpbWVvZmZzZXQpCisJCWh2
bS5ocGV0LCBlcnIgPSB0bXAuSHBldC50b0MoKQorCQlpZiBlcnIgIT0gbmlsIHsKKwkJCUMubGli
eGxfZG9tYWluX2J1aWxkX2luZm9fZGlzcG9zZSgmeGMpCisJCQlyZXR1cm4geGMsIGVycgorCQl9
CisJCWh2bS52cHRfYWxpZ24sIGVyciA9IHRtcC5WcHRBbGlnbi50b0MoKQorCQlpZiBlcnIgIT0g
bmlsIHsKKwkJCUMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fZGlzcG9zZSgmeGMpCisJCQlyZXR1
cm4geGMsIGVycgorCQl9CisJCWh2bS5tbWlvX2hvbGVfbWVta2IgPSBDLnVpbnQ2NF90KHRtcC5N
bWlvSG9sZU1lbWtiKQorCQlodm0udGltZXJfbW9kZSA9IEMubGlieGxfdGltZXJfbW9kZSh0bXAu
VGltZXJNb2RlKQorCQlodm0ubmVzdGVkX2h2bSwgZXJyID0gdG1wLk5lc3RlZEh2bS50b0MoKQor
CQlpZiBlcnIgIT0gbmlsIHsKKwkJCUMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fZGlzcG9zZSgm
eGMpCisJCQlyZXR1cm4geGMsIGVycgorCQl9CisJCWh2bS5hbHRwMm0sIGVyciA9IHRtcC5BbHRw
Mk0udG9DKCkKKwkJaWYgZXJyICE9IG5pbCB7CisJCQlDLmxpYnhsX2RvbWFpbl9idWlsZF9pbmZv
X2Rpc3Bvc2UoJnhjKQorCQkJcmV0dXJuIHhjLCBlcnIKKwkJfQorCQlodm0uc3lzdGVtX2Zpcm13
YXJlID0gQy5DU3RyaW5nKHRtcC5TeXN0ZW1GaXJtd2FyZSkKKwkJaHZtLnNtYmlvc19maXJtd2Fy
ZSA9IEMuQ1N0cmluZyh0bXAuU21iaW9zRmlybXdhcmUpCisJCWh2bS5hY3BpX2Zpcm13YXJlID0g
Qy5DU3RyaW5nKHRtcC5BY3BpRmlybXdhcmUpCisJCWh2bS5oZHR5cGUgPSBDLmxpYnhsX2hkdHlw
ZSh0bXAuSGR0eXBlKQorCQlodm0ubm9ncmFwaGljLCBlcnIgPSB0bXAuTm9ncmFwaGljLnRvQygp
CisJCWlmIGVyciAhPSBuaWwgeworCQkJQy5saWJ4bF9kb21haW5fYnVpbGRfaW5mb19kaXNwb3Nl
KCZ4YykKKwkJCXJldHVybiB4YywgZXJyCisJCX0KKwkJaHZtLnZnYSwgZXJyID0gdG1wLlZnYS50
b0MoKQorCQlpZiBlcnIgIT0gbmlsIHsKKwkJCUMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fZGlz
cG9zZSgmeGMpCisJCQlyZXR1cm4geGMsIGVycgorCQl9CisJCWh2bS52bmMsIGVyciA9IHRtcC5W
bmMudG9DKCkKKwkJaWYgZXJyICE9IG5pbCB7CisJCQlDLmxpYnhsX2RvbWFpbl9idWlsZF9pbmZv
X2Rpc3Bvc2UoJnhjKQorCQkJcmV0dXJuIHhjLCBlcnIKKwkJfQorCQlodm0ua2V5bWFwID0gQy5D
U3RyaW5nKHRtcC5LZXltYXApCisJCWh2bS5zZGwsIGVyciA9IHRtcC5TZGwudG9DKCkKKwkJaWYg
ZXJyICE9IG5pbCB7CisJCQlDLmxpYnhsX2RvbWFpbl9idWlsZF9pbmZvX2Rpc3Bvc2UoJnhjKQor
CQkJcmV0dXJuIHhjLCBlcnIKKwkJfQorCQlodm0uc3BpY2UsIGVyciA9IHRtcC5TcGljZS50b0Mo
KQorCQlpZiBlcnIgIT0gbmlsIHsKKwkJCUMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fZGlzcG9z
ZSgmeGMpCisJCQlyZXR1cm4geGMsIGVycgorCQl9CisJCWh2bS5nZnhfcGFzc3RocnUsIGVyciA9
IHRtcC5HZnhQYXNzdGhydS50b0MoKQorCQlpZiBlcnIgIT0gbmlsIHsKKwkJCUMubGlieGxfZG9t
YWluX2J1aWxkX2luZm9fZGlzcG9zZSgmeGMpCisJCQlyZXR1cm4geGMsIGVycgorCQl9CisJCWh2
bS5nZnhfcGFzc3RocnVfa2luZCA9IEMubGlieGxfZ2Z4X3Bhc3N0aHJ1X2tpbmQodG1wLkdmeFBh
c3N0aHJ1S2luZCkKKwkJaHZtLnNlcmlhbCA9IEMuQ1N0cmluZyh0bXAuU2VyaWFsKQorCQlodm0u
Ym9vdCA9IEMuQ1N0cmluZyh0bXAuQm9vdCkKKwkJaHZtLnVzYiwgZXJyID0gdG1wLlVzYi50b0Mo
KQorCQlpZiBlcnIgIT0gbmlsIHsKKwkJCUMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fZGlzcG9z
ZSgmeGMpCisJCQlyZXR1cm4geGMsIGVycgorCQl9CisJCWh2bS51c2J2ZXJzaW9uID0gQy5pbnQo
dG1wLlVzYnZlcnNpb24pCisJCWh2bS51c2JkZXZpY2UgPSBDLkNTdHJpbmcodG1wLlVzYmRldmlj
ZSkKKwkJaHZtLnZrYl9kZXZpY2UsIGVyciA9IHRtcC5Wa2JEZXZpY2UudG9DKCkKKwkJaWYgZXJy
ICE9IG5pbCB7CisJCQlDLmxpYnhsX2RvbWFpbl9idWlsZF9pbmZvX2Rpc3Bvc2UoJnhjKQorCQkJ
cmV0dXJuIHhjLCBlcnIKKwkJfQorCQlodm0uc291bmRodyA9IEMuQ1N0cmluZyh0bXAuU291bmRo
dykKKwkJaHZtLnhlbl9wbGF0Zm9ybV9wY2ksIGVyciA9IHRtcC5YZW5QbGF0Zm9ybVBjaS50b0Mo
KQorCQlpZiBlcnIgIT0gbmlsIHsKKwkJCUMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fZGlzcG9z
ZSgmeGMpCisJCQlyZXR1cm4geGMsIGVycgorCQl9CisJCWh2bS51c2JkZXZpY2VfbGlzdCwgZXJy
ID0gdG1wLlVzYmRldmljZUxpc3QudG9DKCkKKwkJaWYgZXJyICE9IG5pbCB7CisJCQlDLmxpYnhs
X2RvbWFpbl9idWlsZF9pbmZvX2Rpc3Bvc2UoJnhjKQorCQkJcmV0dXJuIHhjLCBlcnIKKwkJfQor
CQlodm0udmVuZG9yX2RldmljZSA9IEMubGlieGxfdmVuZG9yX2RldmljZSh0bXAuVmVuZG9yRGV2
aWNlKQorCQlodm0ubXNfdm1fZ2VuaWQsIGVyciA9IHRtcC5Nc1ZtR2VuaWQudG9DKCkKKwkJaWYg
ZXJyICE9IG5pbCB7CisJCQlDLmxpYnhsX2RvbWFpbl9idWlsZF9pbmZvX2Rpc3Bvc2UoJnhjKQor
CQkJcmV0dXJuIHhjLCBlcnIKKwkJfQorCQlodm0uc2VyaWFsX2xpc3QsIGVyciA9IHRtcC5TZXJp
YWxMaXN0LnRvQygpCisJCWlmIGVyciAhPSBuaWwgeworCQkJQy5saWJ4bF9kb21haW5fYnVpbGRf
aW5mb19kaXNwb3NlKCZ4YykKKwkJCXJldHVybiB4YywgZXJyCisJCX0KKwkJaHZtLnJkbSwgZXJy
ID0gdG1wLlJkbS50b0MoKQorCQlpZiBlcnIgIT0gbmlsIHsKKwkJCUMubGlieGxfZG9tYWluX2J1
aWxkX2luZm9fZGlzcG9zZSgmeGMpCisJCQlyZXR1cm4geGMsIGVycgorCQl9CisJCWh2bS5yZG1f
bWVtX2JvdW5kYXJ5X21lbWtiID0gQy51aW50NjRfdCh0bXAuUmRtTWVtQm91bmRhcnlNZW1rYikK
KwkJaHZtLm1jYV9jYXBzID0gQy51aW50NjRfdCh0bXAuTWNhQ2FwcykKKwkJaHZtQnl0ZXMgOj0g
Qy5Hb0J5dGVzKHVuc2FmZS5Qb2ludGVyKCZodm0pLCBDLnNpemVvZl9saWJ4bF9kb21haW5fYnVp
bGRfaW5mb190eXBlX3VuaW9uX2h2bSkKKwkJY29weSh4Yy51WzpdLCBodm1CeXRlcykKKwljYXNl
IERvbWFpblR5cGVQdjoKKwkJdG1wLCBvayA6PSB4LlR5cGVVbmlvbi4oRG9tYWluQnVpbGRJbmZv
VHlwZVVuaW9uUHYpCisJCWlmICFvayB7CisJCQlDLmxpYnhsX2RvbWFpbl9idWlsZF9pbmZvX2Rp
c3Bvc2UoJnhjKQorCQkJcmV0dXJuIHhjLCBlcnJvcnMuTmV3KCJ3cm9uZyB0eXBlIGZvciB1bmlv
biBrZXkgdHlwZSIpCisJCX0KKwkJdmFyIHB2IEMubGlieGxfZG9tYWluX2J1aWxkX2luZm9fdHlw
ZV91bmlvbl9wdgorCQlwdi5rZXJuZWwgPSBDLkNTdHJpbmcodG1wLktlcm5lbCkKKwkJcHYuc2xh
Y2tfbWVta2IgPSBDLnVpbnQ2NF90KHRtcC5TbGFja01lbWtiKQorCQlwdi5ib290bG9hZGVyID0g
Qy5DU3RyaW5nKHRtcC5Cb290bG9hZGVyKQorCQlwdi5ib290bG9hZGVyX2FyZ3MsIGVyciA9IHRt
cC5Cb290bG9hZGVyQXJncy50b0MoKQorCQlpZiBlcnIgIT0gbmlsIHsKKwkJCUMubGlieGxfZG9t
YWluX2J1aWxkX2luZm9fZGlzcG9zZSgmeGMpCisJCQlyZXR1cm4geGMsIGVycgorCQl9CisJCXB2
LmNtZGxpbmUgPSBDLkNTdHJpbmcodG1wLkNtZGxpbmUpCisJCXB2LnJhbWRpc2sgPSBDLkNTdHJp
bmcodG1wLlJhbWRpc2spCisJCXB2LmZlYXR1cmVzID0gQy5DU3RyaW5nKHRtcC5GZWF0dXJlcykK
KwkJcHYuZTgyMF9ob3N0LCBlcnIgPSB0bXAuRTgyMEhvc3QudG9DKCkKKwkJaWYgZXJyICE9IG5p
bCB7CisJCQlDLmxpYnhsX2RvbWFpbl9idWlsZF9pbmZvX2Rpc3Bvc2UoJnhjKQorCQkJcmV0dXJu
IHhjLCBlcnIKKwkJfQorCQlwdkJ5dGVzIDo9IEMuR29CeXRlcyh1bnNhZmUuUG9pbnRlcigmcHYp
LCBDLnNpemVvZl9saWJ4bF9kb21haW5fYnVpbGRfaW5mb190eXBlX3VuaW9uX3B2KQorCQljb3B5
KHhjLnVbOl0sIHB2Qnl0ZXMpCisJY2FzZSBEb21haW5UeXBlUHZoOgorCQl0bXAsIG9rIDo9IHgu
VHlwZVVuaW9uLihEb21haW5CdWlsZEluZm9UeXBlVW5pb25QdmgpCisJCWlmICFvayB7CisJCQlD
LmxpYnhsX2RvbWFpbl9idWlsZF9pbmZvX2Rpc3Bvc2UoJnhjKQorCQkJcmV0dXJuIHhjLCBlcnJv
cnMuTmV3KCJ3cm9uZyB0eXBlIGZvciB1bmlvbiBrZXkgdHlwZSIpCisJCX0KKwkJdmFyIHB2aCBD
LmxpYnhsX2RvbWFpbl9idWlsZF9pbmZvX3R5cGVfdW5pb25fcHZoCisJCXB2aC5wdnNoaW0sIGVy
ciA9IHRtcC5QdnNoaW0udG9DKCkKKwkJaWYgZXJyICE9IG5pbCB7CisJCQlDLmxpYnhsX2RvbWFp
bl9idWlsZF9pbmZvX2Rpc3Bvc2UoJnhjKQorCQkJcmV0dXJuIHhjLCBlcnIKKwkJfQorCQlwdmgu
cHZzaGltX3BhdGggPSBDLkNTdHJpbmcodG1wLlB2c2hpbVBhdGgpCisJCXB2aC5wdnNoaW1fY21k
bGluZSA9IEMuQ1N0cmluZyh0bXAuUHZzaGltQ21kbGluZSkKKwkJcHZoLnB2c2hpbV9leHRyYSA9
IEMuQ1N0cmluZyh0bXAuUHZzaGltRXh0cmEpCisJCXB2aEJ5dGVzIDo9IEMuR29CeXRlcyh1bnNh
ZmUuUG9pbnRlcigmcHZoKSwgQy5zaXplb2ZfbGlieGxfZG9tYWluX2J1aWxkX2luZm9fdHlwZV91
bmlvbl9wdmgpCisJCWNvcHkoeGMudVs6XSwgcHZoQnl0ZXMpCisJZGVmYXVsdDoKKwkJcmV0dXJu
IHhjLCBmbXQuRXJyb3JmKCJpbnZhbGlkIHVuaW9uIGtleSAnJXYnIiwgeC5UeXBlKQorCX0KIAl4
Yy5hcmNoX2FybS5naWNfdmVyc2lvbiA9IEMubGlieGxfZ2ljX3ZlcnNpb24oeC5BcmNoQXJtLkdp
Y1ZlcnNpb24pCiAJeGMuYXJjaF9hcm0udnVhcnQgPSBDLmxpYnhsX3Z1YXJ0X3R5cGUoeC5BcmNo
QXJtLlZ1YXJ0KQogCXhjLmFsdHAybSA9IEMubGlieGxfYWx0cDJtX21vZGUoeC5BbHRwMk0pCkBA
IC0xNTc1LDYgKzE4MDAsMjIgQEAgZnVuYyAoeCAqRGV2aWNlVXNiZGV2KSB0b0MoKSAoeGMgQy5s
aWJ4bF9kZXZpY2VfdXNiZGV2LCBlcnIgZXJyb3IpIHsKIAlDLmxpYnhsX2RldmljZV91c2JkZXZf
aW5pdCgmeGMpCiAJeGMuY3RybCA9IEMubGlieGxfZGV2aWQoeC5DdHJsKQogCXhjLnBvcnQgPSBD
LmludCh4LlBvcnQpCisJeGMuX3R5cGUgPSBDLmxpYnhsX3VzYmRldl90eXBlKHguVHlwZSkKKwlz
d2l0Y2ggeC5UeXBlIHsKKwljYXNlIFVzYmRldlR5cGVIb3N0ZGV2OgorCQl0bXAsIG9rIDo9IHgu
VHlwZVVuaW9uLihEZXZpY2VVc2JkZXZUeXBlVW5pb25Ib3N0ZGV2KQorCQlpZiAhb2sgeworCQkJ
Qy5saWJ4bF9kZXZpY2VfdXNiZGV2X2Rpc3Bvc2UoJnhjKQorCQkJcmV0dXJuIHhjLCBlcnJvcnMu
TmV3KCJ3cm9uZyB0eXBlIGZvciB1bmlvbiBrZXkgdHlwZSIpCisJCX0KKwkJdmFyIGhvc3RkZXYg
Qy5saWJ4bF9kZXZpY2VfdXNiZGV2X3R5cGVfdW5pb25faG9zdGRldgorCQlob3N0ZGV2Lmhvc3Ri
dXMgPSBDLnVpbnQ4X3QodG1wLkhvc3RidXMpCisJCWhvc3RkZXYuaG9zdGFkZHIgPSBDLnVpbnQ4
X3QodG1wLkhvc3RhZGRyKQorCQlob3N0ZGV2Qnl0ZXMgOj0gQy5Hb0J5dGVzKHVuc2FmZS5Qb2lu
dGVyKCZob3N0ZGV2KSwgQy5zaXplb2ZfbGlieGxfZGV2aWNlX3VzYmRldl90eXBlX3VuaW9uX2hv
c3RkZXYpCisJCWNvcHkoeGMudVs6XSwgaG9zdGRldkJ5dGVzKQorCWRlZmF1bHQ6CisJCXJldHVy
biB4YywgZm10LkVycm9yZigiaW52YWxpZCB1bmlvbiBrZXkgJyV2JyIsIHguVHlwZSkKKwl9CiAJ
cmV0dXJuIHhjLCBuaWwKIH0KIApAQCAtMTY4NSw2ICsxOTI2LDIxIEBAIGZ1bmMgKHggKkRldmlj
ZUNoYW5uZWwpIHRvQygpICh4YyBDLmxpYnhsX2RldmljZV9jaGFubmVsLCBlcnIgZXJyb3IpIHsK
IAl4Yy5iYWNrZW5kX2RvbW5hbWUgPSBDLkNTdHJpbmcoeC5CYWNrZW5kRG9tbmFtZSkKIAl4Yy5k
ZXZpZCA9IEMubGlieGxfZGV2aWQoeC5EZXZpZCkKIAl4Yy5uYW1lID0gQy5DU3RyaW5nKHguTmFt
ZSkKKwl4Yy5jb25uZWN0aW9uID0gQy5saWJ4bF9jaGFubmVsX2Nvbm5lY3Rpb24oeC5Db25uZWN0
aW9uKQorCXN3aXRjaCB4LkNvbm5lY3Rpb24geworCWNhc2UgQ2hhbm5lbENvbm5lY3Rpb25Tb2Nr
ZXQ6CisJCXRtcCwgb2sgOj0geC5Db25uZWN0aW9uVW5pb24uKERldmljZUNoYW5uZWxDb25uZWN0
aW9uVW5pb25Tb2NrZXQpCisJCWlmICFvayB7CisJCQlDLmxpYnhsX2RldmljZV9jaGFubmVsX2Rp
c3Bvc2UoJnhjKQorCQkJcmV0dXJuIHhjLCBlcnJvcnMuTmV3KCJ3cm9uZyB0eXBlIGZvciB1bmlv
biBrZXkgY29ubmVjdGlvbiIpCisJCX0KKwkJdmFyIHNvY2tldCBDLmxpYnhsX2RldmljZV9jaGFu
bmVsX2Nvbm5lY3Rpb25fdW5pb25fc29ja2V0CisJCXNvY2tldC5wYXRoID0gQy5DU3RyaW5nKHRt
cC5QYXRoKQorCQlzb2NrZXRCeXRlcyA6PSBDLkdvQnl0ZXModW5zYWZlLlBvaW50ZXIoJnNvY2tl
dCksIEMuc2l6ZW9mX2xpYnhsX2RldmljZV9jaGFubmVsX2Nvbm5lY3Rpb25fdW5pb25fc29ja2V0
KQorCQljb3B5KHhjLnVbOl0sIHNvY2tldEJ5dGVzKQorCWRlZmF1bHQ6CisJCXJldHVybiB4Yywg
Zm10LkVycm9yZigiaW52YWxpZCB1bmlvbiBrZXkgJyV2JyIsIHguQ29ubmVjdGlvbikKKwl9CiAJ
cmV0dXJuIHhjLCBuaWwKIH0KIApAQCAtMjY0Nyw2ICsyOTAzLDQ2IEBAIGZ1bmMgKHggKkV2ZW50
KSB0b0MoKSAoeGMgQy5saWJ4bF9ldmVudCwgZXJyIGVycm9yKSB7CiAJCXJldHVybiB4YywgZXJy
CiAJfQogCXhjLmZvcl91c2VyID0gQy51aW50NjRfdCh4LkZvclVzZXIpCisJeGMuX3R5cGUgPSBD
LmxpYnhsX2V2ZW50X3R5cGUoeC5UeXBlKQorCXN3aXRjaCB4LlR5cGUgeworCWNhc2UgRXZlbnRU
eXBlRG9tYWluU2h1dGRvd246CisJCXRtcCwgb2sgOj0geC5UeXBlVW5pb24uKEV2ZW50VHlwZVVu
aW9uRG9tYWluU2h1dGRvd24pCisJCWlmICFvayB7CisJCQlDLmxpYnhsX2V2ZW50X2Rpc3Bvc2Uo
JnhjKQorCQkJcmV0dXJuIHhjLCBlcnJvcnMuTmV3KCJ3cm9uZyB0eXBlIGZvciB1bmlvbiBrZXkg
dHlwZSIpCisJCX0KKwkJdmFyIGRvbWFpbl9zaHV0ZG93biBDLmxpYnhsX2V2ZW50X3R5cGVfdW5p
b25fZG9tYWluX3NodXRkb3duCisJCWRvbWFpbl9zaHV0ZG93bi5zaHV0ZG93bl9yZWFzb24gPSBD
LnVpbnQ4X3QodG1wLlNodXRkb3duUmVhc29uKQorCQlkb21haW5fc2h1dGRvd25CeXRlcyA6PSBD
LkdvQnl0ZXModW5zYWZlLlBvaW50ZXIoJmRvbWFpbl9zaHV0ZG93biksIEMuc2l6ZW9mX2xpYnhs
X2V2ZW50X3R5cGVfdW5pb25fZG9tYWluX3NodXRkb3duKQorCQljb3B5KHhjLnVbOl0sIGRvbWFp
bl9zaHV0ZG93bkJ5dGVzKQorCWNhc2UgRXZlbnRUeXBlRGlza0VqZWN0OgorCQl0bXAsIG9rIDo9
IHguVHlwZVVuaW9uLihFdmVudFR5cGVVbmlvbkRpc2tFamVjdCkKKwkJaWYgIW9rIHsKKwkJCUMu
bGlieGxfZXZlbnRfZGlzcG9zZSgmeGMpCisJCQlyZXR1cm4geGMsIGVycm9ycy5OZXcoIndyb25n
IHR5cGUgZm9yIHVuaW9uIGtleSB0eXBlIikKKwkJfQorCQl2YXIgZGlza19lamVjdCBDLmxpYnhs
X2V2ZW50X3R5cGVfdW5pb25fZGlza19lamVjdAorCQlkaXNrX2VqZWN0LnZkZXYgPSBDLkNTdHJp
bmcodG1wLlZkZXYpCisJCWRpc2tfZWplY3QuZGlzaywgZXJyID0gdG1wLkRpc2sudG9DKCkKKwkJ
aWYgZXJyICE9IG5pbCB7CisJCQlDLmxpYnhsX2V2ZW50X2Rpc3Bvc2UoJnhjKQorCQkJcmV0dXJu
IHhjLCBlcnIKKwkJfQorCQlkaXNrX2VqZWN0Qnl0ZXMgOj0gQy5Hb0J5dGVzKHVuc2FmZS5Qb2lu
dGVyKCZkaXNrX2VqZWN0KSwgQy5zaXplb2ZfbGlieGxfZXZlbnRfdHlwZV91bmlvbl9kaXNrX2Vq
ZWN0KQorCQljb3B5KHhjLnVbOl0sIGRpc2tfZWplY3RCeXRlcykKKwljYXNlIEV2ZW50VHlwZU9w
ZXJhdGlvbkNvbXBsZXRlOgorCQl0bXAsIG9rIDo9IHguVHlwZVVuaW9uLihFdmVudFR5cGVVbmlv
bk9wZXJhdGlvbkNvbXBsZXRlKQorCQlpZiAhb2sgeworCQkJQy5saWJ4bF9ldmVudF9kaXNwb3Nl
KCZ4YykKKwkJCXJldHVybiB4YywgZXJyb3JzLk5ldygid3JvbmcgdHlwZSBmb3IgdW5pb24ga2V5
IHR5cGUiKQorCQl9CisJCXZhciBvcGVyYXRpb25fY29tcGxldGUgQy5saWJ4bF9ldmVudF90eXBl
X3VuaW9uX29wZXJhdGlvbl9jb21wbGV0ZQorCQlvcGVyYXRpb25fY29tcGxldGUucmMgPSBDLmlu
dCh0bXAuUmMpCisJCW9wZXJhdGlvbl9jb21wbGV0ZUJ5dGVzIDo9IEMuR29CeXRlcyh1bnNhZmUu
UG9pbnRlcigmb3BlcmF0aW9uX2NvbXBsZXRlKSwgQy5zaXplb2ZfbGlieGxfZXZlbnRfdHlwZV91
bmlvbl9vcGVyYXRpb25fY29tcGxldGUpCisJCWNvcHkoeGMudVs6XSwgb3BlcmF0aW9uX2NvbXBs
ZXRlQnl0ZXMpCisJZGVmYXVsdDoKKwkJcmV0dXJuIHhjLCBmbXQuRXJyb3JmKCJpbnZhbGlkIHVu
aW9uIGtleSAnJXYnIiwgeC5UeXBlKQorCX0KIAlyZXR1cm4geGMsIG5pbAogfQogCkBAIC0yNzE2
LDUgKzMwMTIsMzQgQEAgZnVuYyAoeCAqUHNySHdJbmZvVHlwZVVuaW9uTWJhKSBmcm9tQyh4YyAq
Qy5saWJ4bF9wc3JfaHdfaW5mbykgZXJyb3IgewogZnVuYyAoeCAqUHNySHdJbmZvKSB0b0MoKSAo
eGMgQy5saWJ4bF9wc3JfaHdfaW5mbywgZXJyIGVycm9yKSB7CiAJQy5saWJ4bF9wc3JfaHdfaW5m
b19pbml0KCZ4YykKIAl4Yy5pZCA9IEMudWludDMyX3QoeC5JZCkKKwl4Yy5fdHlwZSA9IEMubGli
eGxfcHNyX2ZlYXRfdHlwZSh4LlR5cGUpCisJc3dpdGNoIHguVHlwZSB7CisJY2FzZSBQc3JGZWF0
VHlwZUNhdDoKKwkJdG1wLCBvayA6PSB4LlR5cGVVbmlvbi4oUHNySHdJbmZvVHlwZVVuaW9uQ2F0
KQorCQlpZiAhb2sgeworCQkJQy5saWJ4bF9wc3JfaHdfaW5mb19kaXNwb3NlKCZ4YykKKwkJCXJl
dHVybiB4YywgZXJyb3JzLk5ldygid3JvbmcgdHlwZSBmb3IgdW5pb24ga2V5IHR5cGUiKQorCQl9
CisJCXZhciBjYXQgQy5saWJ4bF9wc3JfaHdfaW5mb190eXBlX3VuaW9uX2NhdAorCQljYXQuY29z
X21heCA9IEMudWludDMyX3QodG1wLkNvc01heCkKKwkJY2F0LmNibV9sZW4gPSBDLnVpbnQzMl90
KHRtcC5DYm1MZW4pCisJCWNhdC5jZHBfZW5hYmxlZCA9IEMuYm9vbCh0bXAuQ2RwRW5hYmxlZCkK
KwkJY2F0Qnl0ZXMgOj0gQy5Hb0J5dGVzKHVuc2FmZS5Qb2ludGVyKCZjYXQpLCBDLnNpemVvZl9s
aWJ4bF9wc3JfaHdfaW5mb190eXBlX3VuaW9uX2NhdCkKKwkJY29weSh4Yy51WzpdLCBjYXRCeXRl
cykKKwljYXNlIFBzckZlYXRUeXBlTWJhOgorCQl0bXAsIG9rIDo9IHguVHlwZVVuaW9uLihQc3JI
d0luZm9UeXBlVW5pb25NYmEpCisJCWlmICFvayB7CisJCQlDLmxpYnhsX3Bzcl9od19pbmZvX2Rp
c3Bvc2UoJnhjKQorCQkJcmV0dXJuIHhjLCBlcnJvcnMuTmV3KCJ3cm9uZyB0eXBlIGZvciB1bmlv
biBrZXkgdHlwZSIpCisJCX0KKwkJdmFyIG1iYSBDLmxpYnhsX3Bzcl9od19pbmZvX3R5cGVfdW5p
b25fbWJhCisJCW1iYS5jb3NfbWF4ID0gQy51aW50MzJfdCh0bXAuQ29zTWF4KQorCQltYmEudGhy
dGxfbWF4ID0gQy51aW50MzJfdCh0bXAuVGhydGxNYXgpCisJCW1iYS5saW5lYXIgPSBDLmJvb2wo
dG1wLkxpbmVhcikKKwkJbWJhQnl0ZXMgOj0gQy5Hb0J5dGVzKHVuc2FmZS5Qb2ludGVyKCZtYmEp
LCBDLnNpemVvZl9saWJ4bF9wc3JfaHdfaW5mb190eXBlX3VuaW9uX21iYSkKKwkJY29weSh4Yy51
WzpdLCBtYmFCeXRlcykKKwlkZWZhdWx0OgorCQlyZXR1cm4geGMsIGZtdC5FcnJvcmYoImludmFs
aWQgdW5pb24ga2V5ICcldiciLCB4LlR5cGUpCisJfQogCXJldHVybiB4YywgbmlsCiB9Ci0tIAoy
LjE5LjEKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpY
ZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRw
czovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

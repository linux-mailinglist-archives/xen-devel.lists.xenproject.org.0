Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id B9218BFFBC
	for <lists+xen-devel@lfdr.de>; Fri, 27 Sep 2019 09:05:48 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iDkGz-0005G2-U6; Fri, 27 Sep 2019 07:02:37 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=Rbpq=XW=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1iDkGx-0005Bw-AL
 for xen-devel@lists.xenproject.org; Fri, 27 Sep 2019 07:02:35 +0000
X-Inumbo-ID: 94e035db-e0f4-11e9-966c-12813bfff9fa
Received: from mx1.suse.de (unknown [195.135.220.15])
 by localhost (Halon) with ESMTPS
 id 94e035db-e0f4-11e9-966c-12813bfff9fa;
 Fri, 27 Sep 2019 07:01:09 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id B8CB1AD63;
 Fri, 27 Sep 2019 07:01:06 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Fri, 27 Sep 2019 09:00:44 +0200
Message-Id: <20190927070050.12405-41-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190927070050.12405-1-jgross@suse.com>
References: <20190927070050.12405-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v4 40/46] xen/sched: split schedule_cpu_switch()
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Tim Deegan <tim@xen.org>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Dario Faggioli <dfaggioli@suse.com>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SW5zdGVhZCBvZiBsZXR0aW5nIHNjaGVkdWxlX2NwdV9zd2l0Y2goKSBoYW5kbGUgbW92aW5nIGNw
dXMgZnJvbSBhbmQKdG8gY3B1cG9vbHMsIHNwbGl0IGl0IGludG8gc2NoZWR1bGVfY3B1X2FkZCgp
IGFuZCBzY2hlZHVsZV9jcHVfcm0oKS4KClRoaXMgd2lsbCBhbGxvdyB1cyB0byBkcm9wIGFsbG9j
YXRpbmcvZnJlZWluZyBzY2hlZHVsZXIgZGF0YSBmb3IgZnJlZQpjcHVzIGFzIHRoZSBpZGxlIHNj
aGVkdWxlciBkb2Vzbid0IG5lZWQgc3VjaCBkYXRhLgoKU2lnbmVkLW9mZi1ieTogSnVlcmdlbiBH
cm9zcyA8amdyb3NzQHN1c2UuY29tPgotLS0KVjE6IG5ldyBwYXRjaApWNDoKLSByZW5hbWUgc2Qg
LT4gc3IgKEphbiBCZXVsaWNoKQotLS0KIHhlbi9jb21tb24vY3B1cG9vbC5jICAgIHwgICA0ICst
CiB4ZW4vY29tbW9uL3NjaGVkdWxlLmMgICB8IDEzMyArKysrKysrKysrKysrKysrKysrKysrKysr
KystLS0tLS0tLS0tLS0tLS0tLS0tLS0KIHhlbi9pbmNsdWRlL3hlbi9zY2hlZC5oIHwgICAzICst
CiAzIGZpbGVzIGNoYW5nZWQsIDc4IGluc2VydGlvbnMoKyksIDYyIGRlbGV0aW9ucygtKQoKZGlm
ZiAtLWdpdCBhL3hlbi9jb21tb24vY3B1cG9vbC5jIGIveGVuL2NvbW1vbi9jcHVwb29sLmMKaW5k
ZXggNTFmMGZmMGQ4OC4uMDI4MjVlNzc5ZCAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9jcHVwb29s
LmMKKysrIGIveGVuL2NvbW1vbi9jcHVwb29sLmMKQEAgLTI3MSw3ICsyNzEsNyBAQCBzdGF0aWMg
aW50IGNwdXBvb2xfYXNzaWduX2NwdV9sb2NrZWQoc3RydWN0IGNwdXBvb2wgKmMsIHVuc2lnbmVk
IGludCBjcHUpCiAKICAgICBpZiAoIChjcHVwb29sX21vdmluZ19jcHUgPT0gY3B1KSAmJiAoYyAh
PSBjcHVwb29sX2NwdV9tb3ZpbmcpICkKICAgICAgICAgcmV0dXJuIC1FQUREUk5PVEFWQUlMOwot
ICAgIHJldCA9IHNjaGVkdWxlX2NwdV9zd2l0Y2goY3B1LCBjKTsKKyAgICByZXQgPSBzY2hlZHVs
ZV9jcHVfYWRkKGNwdSwgYyk7CiAgICAgaWYgKCByZXQgKQogICAgICAgICByZXR1cm4gcmV0Owog
CkBAIC0zMjEsNyArMzIxLDcgQEAgc3RhdGljIGludCBjcHVwb29sX3VuYXNzaWduX2NwdV9maW5p
c2goc3RydWN0IGNwdXBvb2wgKmMpCiAgICAgICovCiAgICAgaWYgKCAhcmV0ICkKICAgICB7Ci0g
ICAgICAgIHJldCA9IHNjaGVkdWxlX2NwdV9zd2l0Y2goY3B1LCBOVUxMKTsKKyAgICAgICAgcmV0
ID0gc2NoZWR1bGVfY3B1X3JtKGNwdSk7CiAgICAgICAgIGlmICggcmV0ICkKICAgICAgICAgICAg
IGNwdW1hc2tfY2xlYXJfY3B1KGNwdSwgJmNwdXBvb2xfZnJlZV9jcHVzKTsKICAgICAgICAgZWxz
ZQpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZHVsZS5jIGIveGVuL2NvbW1vbi9zY2hlZHVs
ZS5jCmluZGV4IDYzZmZlMWE4MjQuLmM3NWVjOTY5YzIgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24v
c2NoZWR1bGUuYworKysgYi94ZW4vY29tbW9uL3NjaGVkdWxlLmMKQEAgLTkxLDE1ICs5MSw2IEBA
IHN0YXRpYyBzdHJ1Y3Qgc2NoZWR1bGVyIF9fcmVhZF9tb3N0bHkgb3BzOwogc3RhdGljIHZvaWQg
c2NoZWRfc2V0X2FmZmluaXR5KAogICAgIHN0cnVjdCBzY2hlZF91bml0ICp1bml0LCBjb25zdCBj
cHVtYXNrX3QgKmhhcmQsIGNvbnN0IGNwdW1hc2tfdCAqc29mdCk7CiAKLXN0YXRpYyBzcGlubG9j
a190ICoKLXNjaGVkX2lkbGVfc3dpdGNoX3NjaGVkKHN0cnVjdCBzY2hlZHVsZXIgKm5ld19vcHMs
IHVuc2lnbmVkIGludCBjcHUsCi0gICAgICAgICAgICAgICAgICAgICAgICB2b2lkICpwZGF0YSwg
dm9pZCAqdmRhdGEpCi17Ci0gICAgc2NoZWRfaWRsZV91bml0KGNwdSktPnByaXYgPSBOVUxMOwot
Ci0gICAgcmV0dXJuICZzY2hlZF9mcmVlX2NwdV9sb2NrOwotfQotCiBzdGF0aWMgc3RydWN0IHNj
aGVkX3Jlc291cmNlICoKIHNjaGVkX2lkbGVfcmVzX3BpY2soY29uc3Qgc3RydWN0IHNjaGVkdWxl
ciAqb3BzLCBjb25zdCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIHsKQEAgLTEzOSw3ICsxMzAs
NiBAQCBzdGF0aWMgc3RydWN0IHNjaGVkdWxlciBzY2hlZF9pZGxlX29wcyA9IHsKIAogICAgIC5h
bGxvY191ZGF0YSAgICA9IHNjaGVkX2lkbGVfYWxsb2NfdWRhdGEsCiAgICAgLmZyZWVfdWRhdGEg
ICAgID0gc2NoZWRfaWRsZV9mcmVlX3VkYXRhLAotICAgIC5zd2l0Y2hfc2NoZWQgICA9IHNjaGVk
X2lkbGVfc3dpdGNoX3NjaGVkLAogfTsKIAogc3RhdGljIGlubGluZSBzdHJ1Y3QgdmNwdSAqdW5p
dDJ2Y3B1X2NwdShjb25zdCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCwKQEAgLTI1MzIsMzYgKzI1
MjIsMjIgQEAgdm9pZCBfX2luaXQgc2NoZWR1bGVyX2luaXQodm9pZCkKIH0KIAogLyoKLSAqIE1v
dmUgYSBwQ1BVIG91dHNpZGUgb2YgdGhlIGluZmx1ZW5jZSBvZiB0aGUgc2NoZWR1bGVyIG9mIGl0
cyBjdXJyZW50Ci0gKiBjcHVwb29sLCBvciBzdWJqZWN0IGl0IHRvIHRoZSBzY2hlZHVsZXIgb2Yg
YSBuZXcgY3B1cG9vbC4KLSAqCi0gKiBGb3IgdGhlIHBDUFVzIHRoYXQgYXJlIHJlbW92ZWQgZnJv
bSB0aGVpciBjcHVwb29sLCB0aGVpciBzY2hlZHVsZXIgYmVjb21lcwotICogJnNjaGVkX2lkbGVf
b3BzICh0aGUgaWRsZSBzY2hlZHVsZXIpLgorICogTW92ZSBhIHBDUFUgZnJvbSBmcmVlIGNwdXMg
KHJ1bm5pbmcgdGhlIGlkbGUgc2NoZWR1bGVyKSB0byBhIGNwdXBvb2wKKyAqIHVzaW5nIGFueSAi
cmVhbCIgc2NoZWR1bGVyLgorICogVGhlIGNwdSBpcyBzdGlsbCBtYXJrZWQgYXMgImZyZWUiIGFu
ZCBub3QgeWV0IHZhbGlkIGZvciBpdHMgY3B1cG9vbC4KICAqLwotaW50IHNjaGVkdWxlX2NwdV9z
d2l0Y2godW5zaWduZWQgaW50IGNwdSwgc3RydWN0IGNwdXBvb2wgKmMpCitpbnQgc2NoZWR1bGVf
Y3B1X2FkZCh1bnNpZ25lZCBpbnQgY3B1LCBzdHJ1Y3QgY3B1cG9vbCAqYykKIHsKICAgICBzdHJ1
Y3QgdmNwdSAqaWRsZTsKLSAgICB2b2lkICpwcHJpdiwgKnBwcml2X29sZCwgKnZwcml2LCAqdnBy
aXZfb2xkOwotICAgIHN0cnVjdCBzY2hlZHVsZXIgKm9sZF9vcHMgPSBnZXRfc2NoZWRfcmVzKGNw
dSktPnNjaGVkdWxlcjsKLSAgICBzdHJ1Y3Qgc2NoZWR1bGVyICpuZXdfb3BzID0gKGMgPT0gTlVM
TCkgPyAmc2NoZWRfaWRsZV9vcHMgOiBjLT5zY2hlZDsKLSAgICBzdHJ1Y3Qgc2NoZWRfcmVzb3Vy
Y2UgKnNkID0gZ2V0X3NjaGVkX3JlcyhjcHUpOwotICAgIHN0cnVjdCBjcHVwb29sICpvbGRfcG9v
bCA9IHNkLT5jcHVwb29sOworICAgIHZvaWQgKnBwcml2LCAqdnByaXY7CisgICAgc3RydWN0IHNj
aGVkdWxlciAqbmV3X29wcyA9IGMtPnNjaGVkOworICAgIHN0cnVjdCBzY2hlZF9yZXNvdXJjZSAq
c3IgPSBnZXRfc2NoZWRfcmVzKGNwdSk7CiAgICAgc3BpbmxvY2tfdCAqb2xkX2xvY2ssICpuZXdf
bG9jazsKICAgICB1bnNpZ25lZCBsb25nIGZsYWdzOwogCi0gICAgLyoKLSAgICAgKiBwQ1BVcyBv
bmx5IG1vdmUgZnJvbSBhIHZhbGlkIGNwdXBvb2wgdG8gZnJlZSAoaS5lLiwgb3V0IG9mIGFueSBw
b29sKSwKLSAgICAgKiBvciBmcm9tIGZyZWUgdG8gYSB2YWxpZCBjcHVwb29sLiBJbiB0aGUgZm9y
bWVyIGNhc2UgKHdoaWNoIGhhcHBlbnMgd2hlbgotICAgICAqIGMgaXMgTlVMTCksIHdlIHdhbnQg
dGhlIENQVSB0byBoYXZlIGJlZW4gbWFya2VkIGFzIGZyZWUgYWxyZWFkeSwgYXMKLSAgICAgKiB3
ZWxsIGFzIHRvIG5vdCBiZSB2YWxpZCBmb3IgdGhlIHNvdXJjZSBwb29sIGFueSBsb25nZXIsIHdo
ZW4gd2UgZ2V0IHRvCi0gICAgICogaGVyZS4gSW4gdGhlIGxhdHRlciBjYXNlICh3aGljaCBoYXBw
ZW5zIHdoZW4gYyBpcyBhIHZhbGlkIGNwdXBvb2wpLCB3ZQotICAgICAqIHdhbnQgdGhlIENQVSB0
byBzdGlsbCBiZSBtYXJrZWQgYXMgZnJlZSwgYXMgd2VsbCBhcyB0byBub3QgeWV0IGJlIHZhbGlk
Ci0gICAgICogZm9yIHRoZSBkZXN0aW5hdGlvbiBwb29sLgotICAgICAqLwotICAgIEFTU0VSVChj
ICE9IG9sZF9wb29sICYmIChjICE9IE5VTEwgfHwgb2xkX3Bvb2wgIT0gTlVMTCkpOwogICAgIEFT
U0VSVChjcHVtYXNrX3Rlc3RfY3B1KGNwdSwgJmNwdXBvb2xfZnJlZV9jcHVzKSk7Ci0gICAgQVNT
RVJUKChjID09IE5VTEwgJiYgIWNwdW1hc2tfdGVzdF9jcHUoY3B1LCBvbGRfcG9vbC0+Y3B1X3Zh
bGlkKSkgfHwKLSAgICAgICAgICAgKGMgIT0gTlVMTCAmJiAhY3B1bWFza190ZXN0X2NwdShjcHUs
IGMtPmNwdV92YWxpZCkpKTsKKyAgICBBU1NFUlQoIWNwdW1hc2tfdGVzdF9jcHUoY3B1LCBjLT5j
cHVfdmFsaWQpKTsKKyAgICBBU1NFUlQoZ2V0X3NjaGVkX3JlcyhjcHUpLT5jcHVwb29sID09IE5V
TEwpOwogCiAgICAgLyoKICAgICAgKiBUbyBzZXR1cCB0aGUgY3B1IGZvciB0aGUgbmV3IHNjaGVk
dWxlciB3ZSBuZWVkOgpAQCAtMjU4Niw1MiArMjU2Miw5MSBAQCBpbnQgc2NoZWR1bGVfY3B1X3N3
aXRjaCh1bnNpZ25lZCBpbnQgY3B1LCBzdHJ1Y3QgY3B1cG9vbCAqYykKICAgICAgICAgcmV0dXJu
IC1FTk9NRU07CiAgICAgfQogCi0gICAgc2NoZWRfZG9fdGlja19zdXNwZW5kKG9sZF9vcHMsIGNw
dSk7Ci0KICAgICAvKgotICAgICAqIFRoZSBhY3R1YWwgc3dpdGNoLCBpbmNsdWRpbmcgKGlmIG5l
Y2Vzc2FyeSkgdGhlIHJlcm91dGluZyBvZiB0aGUKLSAgICAgKiBzY2hlZHVsZXIgbG9jayB0byB3
aGF0ZXZlciBuZXdfb3BzIHByZWZlcnMsICBuZWVkcyB0byBoYXBwZW4gaW4gb25lCi0gICAgICog
Y3JpdGljYWwgc2VjdGlvbiwgcHJvdGVjdGVkIGJ5IG9sZF9vcHMnIGxvY2ssIG9yIHJhY2VzIGFy
ZSBwb3NzaWJsZS4KLSAgICAgKiBJdCBpcywgaW4gZmFjdCwgdGhlIGxvY2sgb2YgYW5vdGhlciBz
Y2hlZHVsZXIgdGhhdCB3ZSBhcmUgdGFraW5nICh0aGUKLSAgICAgKiBzY2hlZHVsZXIgb2YgdGhl
IGNwdXBvb2wgdGhhdCBjcHUgc3RpbGwgYmVsb25ncyB0bykuIEJ1dCB0aGF0IGlzIG9rCi0gICAg
ICogYXMsIGFueW9uZSB0cnlpbmcgdG8gc2NoZWR1bGUgb24gdGhpcyBjcHUgd2lsbCBzcGluIHVu
dGlsIHdoZW4gd2UKLSAgICAgKiByZWxlYXNlIHRoYXQgbG9jayAoYm90dG9tIG9mIHRoaXMgZnVu
Y3Rpb24pLiBXaGVuIGhlJ2xsIGdldCB0aGUgbG9jawotICAgICAqIC0tdGhhbmtzIHRvIHRoZSBs
b29wIGluc2lkZSAqX3NjaGVkdWxlX2xvY2soKSBmdW5jdGlvbnMtLSBoZSdsbCBub3RpY2UKLSAg
ICAgKiB0aGF0IHRoZSBsb2NrIGl0c2VsZiBjaGFuZ2VkLCBhbmQgcmV0cnkgYWNxdWlyaW5nIHRo
ZSBuZXcgb25lICh3aGljaAotICAgICAqIHdpbGwgYmUgdGhlIGNvcnJlY3QsIHJlbWFwcGVkIG9u
ZSwgYXQgdGhhdCBwb2ludCkuCisgICAgICogVGhlIGFjdHVhbCBzd2l0Y2gsIGluY2x1ZGluZyB0
aGUgcmVyb3V0aW5nIG9mIHRoZSBzY2hlZHVsZXIgbG9jayB0bworICAgICAqIHdoYXRldmVyIG5l
d19vcHMgcHJlZmVycywgbmVlZHMgdG8gaGFwcGVuIGluIG9uZSBjcml0aWNhbCBzZWN0aW9uLAor
ICAgICAqIHByb3RlY3RlZCBieSBvbGRfb3BzJyBsb2NrLCBvciByYWNlcyBhcmUgcG9zc2libGUu
CisgICAgICogSXQgaXMsIGluIGZhY3QsIHRoZSBsb2NrIG9mIHRoZSBpZGxlIHNjaGVkdWxlciB0
aGF0IHdlIGFyZSB0YWtpbmcuCisgICAgICogQnV0IHRoYXQgaXMgb2sgYXMgYW55b25lIHRyeWlu
ZyB0byBzY2hlZHVsZSBvbiB0aGlzIGNwdSB3aWxsIHNwaW4gdW50aWwKKyAgICAgKiB3aGVuIHdl
IHJlbGVhc2UgdGhhdCBsb2NrIChib3R0b20gb2YgdGhpcyBmdW5jdGlvbikuIFdoZW4gaGUnbGwg
Z2V0IHRoZQorICAgICAqIGxvY2sgLS10aGFua3MgdG8gdGhlIGxvb3AgaW5zaWRlICpfc2NoZWR1
bGVfbG9jaygpIGZ1bmN0aW9ucy0tIGhlJ2xsCisgICAgICogbm90aWNlIHRoYXQgdGhlIGxvY2sg
aXRzZWxmIGNoYW5nZWQsIGFuZCByZXRyeSBhY3F1aXJpbmcgdGhlIG5ldyBvbmUKKyAgICAgKiAo
d2hpY2ggd2lsbCBiZSB0aGUgY29ycmVjdCwgcmVtYXBwZWQgb25lLCBhdCB0aGF0IHBvaW50KS4K
ICAgICAgKi8KICAgICBvbGRfbG9jayA9IHBjcHVfc2NoZWR1bGVfbG9ja19pcnFzYXZlKGNwdSwg
JmZsYWdzKTsKIAotICAgIHZwcml2X29sZCA9IGlkbGUtPnNjaGVkX3VuaXQtPnByaXY7Ci0gICAg
cHByaXZfb2xkID0gc2QtPnNjaGVkX3ByaXY7CiAgICAgbmV3X2xvY2sgPSBzY2hlZF9zd2l0Y2hf
c2NoZWQobmV3X29wcywgY3B1LCBwcHJpdiwgdnByaXYpOwogCi0gICAgc2QtPnNjaGVkdWxlciA9
IG5ld19vcHM7Ci0gICAgc2QtPnNjaGVkX3ByaXYgPSBwcHJpdjsKKyAgICBzci0+c2NoZWR1bGVy
ID0gbmV3X29wczsKKyAgICBzci0+c2NoZWRfcHJpdiA9IHBwcml2OwogCiAgICAgLyoKLSAgICAg
KiBUaGUgZGF0YSBhYm92ZSBpcyBwcm90ZWN0ZWQgdW5kZXIgbmV3X2xvY2ssIHdoaWNoIG1heSBi
ZSB1bmxvY2tlZC4KLSAgICAgKiBBbm90aGVyIENQVSBjYW4gdGFrZSBuZXdfbG9jayBhcyBzb29u
IGFzIHNkLT5zY2hlZHVsZV9sb2NrIGlzIHZpc2libGUsCi0gICAgICogYW5kIG11c3Qgb2JzZXJ2
ZSBhbGwgcHJpb3IgaW5pdGlhbGlzYXRpb24uCisgICAgICogUmVyb3V0ZSB0aGUgbG9jayB0byB0
aGUgcGVyIHBDUFUgbG9jayBhcyAvbGFzdC8gdGhpbmcuIEluIGZhY3QsCisgICAgICogaWYgaXQg
aXMgZnJlZSAoYW5kIGl0IGNhbiBiZSkgd2Ugd2FudCB0aGF0IGFueW9uZSB0aGF0IG1hbmFnZXMK
KyAgICAgKiB0YWtpbmcgaXQsIGZpbmRzIGFsbCB0aGUgaW5pdGlhbGl6YXRpb25zIHdlJ3ZlIGRv
bmUgYWJvdmUgaW4gcGxhY2UuCiAgICAgICovCiAgICAgc21wX3dtYigpOwotICAgIHNkLT5zY2hl
ZHVsZV9sb2NrID0gbmV3X2xvY2s7CisgICAgc3ItPnNjaGVkdWxlX2xvY2sgPSBuZXdfbG9jazsK
IAotICAgIC8qIF9Ob3RfIHBjcHVfc2NoZWR1bGVfdW5sb2NrKCk6IHNjaGVkdWxlX2xvY2sgbWF5
IGhhdmUgY2hhbmdlZCEgKi8KKyAgICAvKiBfTm90XyBwY3B1X3NjaGVkdWxlX3VubG9jaygpOiBz
Y2hlZHVsZV9sb2NrIGhhcyBjaGFuZ2VkISAqLwogICAgIHNwaW5fdW5sb2NrX2lycXJlc3RvcmUo
b2xkX2xvY2ssIGZsYWdzKTsKIAogICAgIHNjaGVkX2RvX3RpY2tfcmVzdW1lKG5ld19vcHMsIGNw
dSk7CiAKKyAgICBzci0+Z3JhbnVsYXJpdHkgPSBjcHVwb29sX2dldF9ncmFudWxhcml0eShjKTsK
KyAgICBzci0+Y3B1cG9vbCA9IGM7CisgICAgLyogVGhlICBjcHUgaXMgYWRkZWQgdG8gYSBwb29s
LCB0cmlnZ2VyIGl0IHRvIGdvIHBpY2sgdXAgc29tZSB3b3JrICovCisgICAgY3B1X3JhaXNlX3Nv
ZnRpcnEoY3B1LCBTQ0hFRFVMRV9TT0ZUSVJRKTsKKworICAgIHJldHVybiAwOworfQorCisvKgor
ICogUmVtb3ZlIGEgcENQVSBmcm9tIGl0cyBjcHVwb29sLiBJdHMgc2NoZWR1bGVyIGJlY29tZXMg
JnNjaGVkX2lkbGVfb3BzCisgKiAodGhlIGlkbGUgc2NoZWR1bGVyKS4KKyAqIFRoZSBjcHUgaXMg
YWxyZWFkeSBtYXJrZWQgYXMgImZyZWUiIGFuZCBub3QgdmFsaWQgYW55IGxvbmdlciBmb3IgaXRz
CisgKiBjcHVwb29sLgorICovCitpbnQgc2NoZWR1bGVfY3B1X3JtKHVuc2lnbmVkIGludCBjcHUp
Cit7CisgICAgc3RydWN0IHZjcHUgKmlkbGU7CisgICAgdm9pZCAqcHByaXZfb2xkLCAqdnByaXZf
b2xkOworICAgIHN0cnVjdCBzY2hlZF9yZXNvdXJjZSAqc3IgPSBnZXRfc2NoZWRfcmVzKGNwdSk7
CisgICAgc3RydWN0IHNjaGVkdWxlciAqb2xkX29wcyA9IHNyLT5zY2hlZHVsZXI7CisgICAgc3Bp
bmxvY2tfdCAqb2xkX2xvY2s7CisgICAgdW5zaWduZWQgbG9uZyBmbGFnczsKKworICAgIEFTU0VS
VChzci0+Y3B1cG9vbCAhPSBOVUxMKTsKKyAgICBBU1NFUlQoY3B1bWFza190ZXN0X2NwdShjcHUs
ICZjcHVwb29sX2ZyZWVfY3B1cykpOworICAgIEFTU0VSVCghY3B1bWFza190ZXN0X2NwdShjcHUs
IHNyLT5jcHVwb29sLT5jcHVfdmFsaWQpKTsKKworICAgIGlkbGUgPSBpZGxlX3ZjcHVbY3B1XTsK
KworICAgIHNjaGVkX2RvX3RpY2tfc3VzcGVuZChvbGRfb3BzLCBjcHUpOworCisgICAgLyogU2Vl
IGNvbW1lbnQgaW4gc2NoZWR1bGVfY3B1X2FkZCgpIHJlZ2FyZGluZyBsb2NrIHN3aXRjaGluZy4g
Ki8KKyAgICBvbGRfbG9jayA9IHBjcHVfc2NoZWR1bGVfbG9ja19pcnFzYXZlKGNwdSwgJmZsYWdz
KTsKKworICAgIHZwcml2X29sZCA9IGlkbGUtPnNjaGVkX3VuaXQtPnByaXY7CisgICAgcHByaXZf
b2xkID0gc3ItPnNjaGVkX3ByaXY7CisKKyAgICBpZGxlLT5zY2hlZF91bml0LT5wcml2ID0gTlVM
TDsKKyAgICBzci0+c2NoZWR1bGVyID0gJnNjaGVkX2lkbGVfb3BzOworICAgIHNyLT5zY2hlZF9w
cml2ID0gTlVMTDsKKworICAgIHNtcF9tYigpOworICAgIHNyLT5zY2hlZHVsZV9sb2NrID0gJnNj
aGVkX2ZyZWVfY3B1X2xvY2s7CisKKyAgICAvKiBfTm90XyBwY3B1X3NjaGVkdWxlX3VubG9jaygp
OiBzY2hlZHVsZV9sb2NrIG1heSBoYXZlIGNoYW5nZWQhICovCisgICAgc3Bpbl91bmxvY2tfaXJx
cmVzdG9yZShvbGRfbG9jaywgZmxhZ3MpOworCiAgICAgc2NoZWRfZGVpbml0X3BkYXRhKG9sZF9v
cHMsIHBwcml2X29sZCwgY3B1KTsKIAogICAgIHNjaGVkX2ZyZWVfdWRhdGEob2xkX29wcywgdnBy
aXZfb2xkKTsKICAgICBzY2hlZF9mcmVlX3BkYXRhKG9sZF9vcHMsIHBwcml2X29sZCwgY3B1KTsK
IAotICAgIGdldF9zY2hlZF9yZXMoY3B1KS0+Z3JhbnVsYXJpdHkgPSBjcHVwb29sX2dldF9ncmFu
dWxhcml0eShjKTsKLSAgICBnZXRfc2NoZWRfcmVzKGNwdSktPmNwdXBvb2wgPSBjOwotICAgIC8q
IFdoZW4gYSBjcHUgaXMgYWRkZWQgdG8gYSBwb29sLCB0cmlnZ2VyIGl0IHRvIGdvIHBpY2sgdXAg
c29tZSB3b3JrICovCi0gICAgaWYgKCBjICE9IE5VTEwgKQotICAgICAgICBjcHVfcmFpc2Vfc29m
dGlycShjcHUsIFNDSEVEVUxFX1NPRlRJUlEpOworICAgIHNyLT5ncmFudWxhcml0eSA9IDE7Cisg
ICAgc3ItPmNwdXBvb2wgPSBOVUxMOwogCiAgICAgcmV0dXJuIDA7CiB9CmRpZmYgLS1naXQgYS94
ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaCBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCmluZGV4IGFh
ODI1N2VkYzkuLmE0MGJkNWZiNTYgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5o
CisrKyBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5oCkBAIC05MjAsNyArOTIwLDggQEAgc3RydWN0
IHNjaGVkdWxlcjsKIHN0cnVjdCBzY2hlZHVsZXIgKnNjaGVkdWxlcl9nZXRfZGVmYXVsdCh2b2lk
KTsKIHN0cnVjdCBzY2hlZHVsZXIgKnNjaGVkdWxlcl9hbGxvYyh1bnNpZ25lZCBpbnQgc2NoZWRf
aWQsIGludCAqcGVycik7CiB2b2lkIHNjaGVkdWxlcl9mcmVlKHN0cnVjdCBzY2hlZHVsZXIgKnNj
aGVkKTsKLWludCBzY2hlZHVsZV9jcHVfc3dpdGNoKHVuc2lnbmVkIGludCBjcHUsIHN0cnVjdCBj
cHVwb29sICpjKTsKK2ludCBzY2hlZHVsZV9jcHVfYWRkKHVuc2lnbmVkIGludCBjcHUsIHN0cnVj
dCBjcHVwb29sICpjKTsKK2ludCBzY2hlZHVsZV9jcHVfcm0odW5zaWduZWQgaW50IGNwdSk7CiB2
b2lkIHZjcHVfc2V0X3BlcmlvZGljX3RpbWVyKHN0cnVjdCB2Y3B1ICp2LCBzX3RpbWVfdCB2YWx1
ZSk7CiBpbnQgY3B1X2Rpc2FibGVfc2NoZWR1bGVyKHVuc2lnbmVkIGludCBjcHUpOwogdm9pZCBz
Y2hlZF9zZXR1cF9kb20wX3ZjcHVzKHN0cnVjdCBkb21haW4gKmQpOwotLSAKMi4xNi40CgoKX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1h
aWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54
ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

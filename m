Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 45A68BE1BD
	for <lists+xen-devel@lfdr.de>; Wed, 25 Sep 2019 17:53:00 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iD9YG-00015x-6U; Wed, 25 Sep 2019 15:50:00 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=mFb1=XU=intel.com=tamas.lengyel@srs-us1.protection.inumbo.net>)
 id 1iD9YD-000147-UH
 for xen-devel@lists.xenproject.org; Wed, 25 Sep 2019 15:49:57 +0000
X-Inumbo-ID: 15103845-dfac-11e9-9637-12813bfff9fa
Received: from mga12.intel.com (unknown [192.55.52.136])
 by localhost (Halon) with ESMTPS
 id 15103845-dfac-11e9-9637-12813bfff9fa;
 Wed, 25 Sep 2019 15:49:40 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga006.jf.intel.com ([10.7.209.51])
 by fmsmga106.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 25 Sep 2019 08:49:39 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,548,1559545200"; d="scan'208";a="193812722"
Received: from tlengyel-mobl2.amr.corp.intel.com (HELO localhost.localdomain)
 ([10.252.129.153])
 by orsmga006.jf.intel.com with ESMTP; 25 Sep 2019 08:49:39 -0700
From: Tamas K Lengyel <tamas.lengyel@intel.com>
To: xen-devel@lists.xenproject.org
Date: Wed, 25 Sep 2019 08:48:56 -0700
Message-Id: <bc66118f3a6ca24d6c28a4ce577e23a3ab6b709a.1569425745.git.tamas.lengyel@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <cover.1569425745.git.tamas.lengyel@intel.com>
References: <cover.1569425745.git.tamas.lengyel@intel.com>
MIME-Version: 1.0
Subject: [Xen-devel] [RFC PATCH for-next 18/18] xen/tools: VM forking
 toolstack side
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Anthony PERARD <anthony.perard@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>,
 Tamas K Lengyel <tamas.lengyel@intel.com>, Wei Liu <wl@xen.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

QWRkIG5lY2Vzc2FyeSBiaXRzIHRvIGltcGxlbWVudCAieGwgZm9yay12bSIgYW5kICJ4bCBmb3Jr
LWxhdW5jaC1kbSIgY29tbWFuZHMuClRoZSBwcm9jZXNzIGlzIHNwbGl0IGluIHR3byB0byBhbGxv
dyB0b29scyBuZWVkaW5nIGFjY2VzcyB0byB0aGUgbmV3IFZNIGFzIGZhc3QKYXMgcG9zc2libGUg
YWZ0ZXIgaXQgd2FzIGZvcmtlZC4gSXQgaXMgZXhwZWN0ZWQgdGhhdCB1bmRlciBjZXJ0YWluIHVz
ZS1jYXNlcwp0aGUgc2Vjb25kIGNvbW1hbmQgdGhhdCBsYXVuY2hlcyBRRU1VIHdpbGwgYmUgc2tp
cHBlZCBlbnRpcmVseS4KClNpZ25lZC1vZmYtYnk6IFRhbWFzIEsgTGVuZ3llbCA8dGFtYXMubGVu
Z3llbEBpbnRlbC5jb20+Ci0tLQogdG9vbHMvbGlieGMvaW5jbHVkZS94ZW5jdHJsLmggfCAgIDQg
KwogdG9vbHMvbGlieGMveGNfbWVtc2hyLmMgICAgICAgfCAgMTIgKysKIHRvb2xzL2xpYnhsL2xp
YnhsLmggICAgICAgICAgIHwgICA2ICsKIHRvb2xzL2xpYnhsL2xpYnhsX2NyZWF0ZS5jICAgIHwg
MjEyICsrKysrKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0KIHRvb2xzL2xpYnhsL2xpYnhs
X2RtLmMgICAgICAgIHwgICAyICstCiB0b29scy9saWJ4bC9saWJ4bF9kb20uYyAgICAgICB8ICA4
MyArKysrKysrKy0tLS0tCiB0b29scy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5oICB8ICAgMSArCiB0
b29scy9saWJ4bC9saWJ4bF90eXBlcy5pZGwgICB8ICAgMSArCiB0b29scy94bC94bC5oICAgICAg
ICAgICAgICAgICB8ICAgNCArCiB0b29scy94bC94bF9jbWR0YWJsZS5jICAgICAgICB8ICAxNSAr
KysKIHRvb2xzL3hsL3hsX3NhdmVyZXN0b3JlLmMgICAgIHwgIDY5ICsrKysrKysrKysrCiB0b29s
cy94bC94bF92bWNvbnRyb2wuYyAgICAgICB8ICAgOCArKwogMTIgZmlsZXMgY2hhbmdlZCwgMzIz
IGluc2VydGlvbnMoKyksIDk0IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3Rvb2xzL2xpYnhj
L2luY2x1ZGUveGVuY3RybC5oIGIvdG9vbHMvbGlieGMvaW5jbHVkZS94ZW5jdHJsLmgKaW5kZXgg
YjdjOTkwYWFmZC4uODcxOTg5M2YxYiAxMDA2NDQKLS0tIGEvdG9vbHMvbGlieGMvaW5jbHVkZS94
ZW5jdHJsLmgKKysrIGIvdG9vbHMvbGlieGMvaW5jbHVkZS94ZW5jdHJsLmgKQEAgLTIyMjEsNiAr
MjIyMSwxMCBAQCBpbnQgeGNfbWVtc2hyX3JhbmdlX3NoYXJlKHhjX2ludGVyZmFjZSAqeGNoLAog
ICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50NjRfdCBmaXJzdF9nZm4sCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHVpbnQ2NF90IGxhc3RfZ2ZuKTsKIAoraW50IHhjX21lbXNocl9mb3Jr
KHhjX2ludGVyZmFjZSAqeGNoLAorICAgICAgICAgICAgICAgICAgIHVpbnQzMl90IHNvdXJjZV9k
b21haW4sCisgICAgICAgICAgICAgICAgICAgdWludDMyX3QgY2xpZW50X2RvbWFpbik7CisKIC8q
IERlYnVnIGNhbGxzOiByZXR1cm4gdGhlIG51bWJlciBvZiBwYWdlcyByZWZlcmVuY2luZyB0aGUg
c2hhcmVkIGZyYW1lIGJhY2tpbmcKICAqIHRoZSBpbnB1dCBhcmd1bWVudC4gU2hvdWxkIGJlIG9u
ZSBvciBncmVhdGVyLgogICoKZGlmZiAtLWdpdCBhL3Rvb2xzL2xpYnhjL3hjX21lbXNoci5jIGIv
dG9vbHMvbGlieGMveGNfbWVtc2hyLmMKaW5kZXggNWVmNTZhNjkzMy4uMWUwMTE0MGUxZCAxMDA2
NDQKLS0tIGEvdG9vbHMvbGlieGMveGNfbWVtc2hyLmMKKysrIGIvdG9vbHMvbGlieGMveGNfbWVt
c2hyLmMKQEAgLTIzNyw2ICsyMzcsMTggQEAgaW50IHhjX21lbXNocl9kZWJ1Z19ncmVmKHhjX2lu
dGVyZmFjZSAqeGNoLAogICAgIHJldHVybiB4Y19tZW1zaHJfbWVtb3AoeGNoLCBkb21pZCwgJm1z
byk7CiB9CiAKK2ludCB4Y19tZW1zaHJfZm9yayh4Y19pbnRlcmZhY2UgKnhjaCwgdWludDMyX3Qg
cGRvbWlkLCB1aW50MzJfdCBkb21pZCkKK3sKKyAgICB4ZW5fbWVtX3NoYXJpbmdfb3BfdCBtc287
CisKKyAgICBtZW1zZXQoJm1zbywgMCwgc2l6ZW9mKG1zbykpOworCisgICAgbXNvLm9wID0gWEVO
TUVNX3NoYXJpbmdfb3BfZm9yazsKKyAgICBtc28udS5mb3JrLnBhcmVudF9kb21haW4gPSBwZG9t
aWQ7CisKKyAgICByZXR1cm4geGNfbWVtc2hyX21lbW9wKHhjaCwgZG9taWQsICZtc28pOworfQor
CiBpbnQgeGNfbWVtc2hyX2F1ZGl0KHhjX2ludGVyZmFjZSAqeGNoKQogewogICAgIHhlbl9tZW1f
c2hhcmluZ19vcF90IG1zbzsKZGlmZiAtLWdpdCBhL3Rvb2xzL2xpYnhsL2xpYnhsLmggYi90b29s
cy9saWJ4bC9saWJ4bC5oCmluZGV4IDM0MjFlNWFhOTguLjFjZWRhNmY3ZGUgMTAwNjQ0Ci0tLSBh
L3Rvb2xzL2xpYnhsL2xpYnhsLmgKKysrIGIvdG9vbHMvbGlieGwvbGlieGwuaApAQCAtMTQ5NCw2
ICsxNDk0LDEyIEBAIGludCBsaWJ4bF9kb21haW5fY3JlYXRlX25ldyhsaWJ4bF9jdHggKmN0eCwg
bGlieGxfZG9tYWluX2NvbmZpZyAqZF9jb25maWcsCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgY29uc3QgbGlieGxfYXN5bmNvcF9ob3cgKmFvX2hvdywKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBjb25zdCBsaWJ4bF9hc3luY3Byb2dyZXNzX2hvdyAqYW9wX2NvbnNvbGVfaG93KQog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIExJQlhMX0VYVEVSTkFMX0NBTExFUlNfT05MWTsK
K2ludCBsaWJ4bF9kb21haW5fZm9ya192bShsaWJ4bF9jdHggKmN0eCwgdWludDMyX3QgcGRvbWlk
LCB1aW50MzJfdCAqZG9taWQpCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExJQlhMX0VY
VEVSTkFMX0NBTExFUlNfT05MWTsKK2ludCBsaWJ4bF9kb21haW5fZm9ya19sYXVuY2hfZG0obGli
eGxfY3R4ICpjdHgsIGxpYnhsX2RvbWFpbl9jb25maWcgKmRfY29uZmlnLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCBkb21pZCwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgY29uc3QgbGlieGxfYXN5bmNwcm9ncmVzc19ob3cgKmFvcF9jb25zb2xlX2hv
dykKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTElCWExfRVhURVJOQUxfQ0FMTEVS
U19PTkxZOwogaW50IGxpYnhsX2RvbWFpbl9jcmVhdGVfcmVzdG9yZShsaWJ4bF9jdHggKmN0eCwg
bGlieGxfZG9tYWluX2NvbmZpZyAqZF9jb25maWcsCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHVpbnQzMl90ICpkb21pZCwgaW50IHJlc3RvcmVfZmQsCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGludCBzZW5kX2JhY2tfZmQsCmRpZmYgLS1naXQgYS90b29scy9saWJ4
bC9saWJ4bF9jcmVhdGUuYyBiL3Rvb2xzL2xpYnhsL2xpYnhsX2NyZWF0ZS5jCmluZGV4IDkzZmJl
MWQ3NDAuLmMzOGFmMGEyMTQgMTAwNjQ0Ci0tLSBhL3Rvb2xzL2xpYnhsL2xpYnhsX2NyZWF0ZS5j
CisrKyBiL3Rvb2xzL2xpYnhsL2xpYnhsX2NyZWF0ZS5jCkBAIC01MzUsMTIgKzUzNSwxMiBAQCBv
dXQ6CiAgICAgcmV0dXJuIHJldDsKIH0KIAotaW50IGxpYnhsX19kb21haW5fbWFrZShsaWJ4bF9f
Z2MgKmdjLCBsaWJ4bF9kb21haW5fY29uZmlnICpkX2NvbmZpZywKLSAgICAgICAgICAgICAgICAg
ICAgICAgbGlieGxfX2RvbWFpbl9idWlsZF9zdGF0ZSAqc3RhdGUsCi0gICAgICAgICAgICAgICAg
ICAgICAgIHVpbnQzMl90ICpkb21pZCkKK3N0YXRpYyBpbnQgbGlieGxfX2RvbWFpbl9tYWtlX3hz
X2VudHJpZXMobGlieGxfX2djICpnYywgbGlieGxfZG9tYWluX2NvbmZpZyAqZF9jb25maWcsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnhsX19kb21haW5fYnVp
bGRfc3RhdGUgKnN0YXRlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICB1aW50MzJfdCBkb21pZCkKIHsKICAgICBsaWJ4bF9jdHggKmN0eCA9IGxpYnhsX19nY19vd25l
cihnYyk7Ci0gICAgaW50IHJldCwgcmMsIG5iX3ZtOworICAgIGludCByYywgbmJfdm07CiAgICAg
Y29uc3QgY2hhciAqZG9tX3R5cGU7CiAgICAgY2hhciAqdXVpZF9zdHJpbmc7CiAgICAgY2hhciAq
ZG9tX3BhdGgsICp2bV9wYXRoLCAqbGlieGxfcGF0aDsKQEAgLTU1Miw3ICs1NTIsNiBAQCBpbnQg
bGlieGxfX2RvbWFpbl9tYWtlKGxpYnhsX19nYyAqZ2MsIGxpYnhsX2RvbWFpbl9jb25maWcgKmRf
Y29uZmlnLAogCiAgICAgLyogY29udmVuaWVuY2UgYWxpYXNlcyAqLwogICAgIGxpYnhsX2RvbWFp
bl9jcmVhdGVfaW5mbyAqaW5mbyA9ICZkX2NvbmZpZy0+Y19pbmZvOwotICAgIGxpYnhsX2RvbWFp
bl9idWlsZF9pbmZvICpiX2luZm8gPSAmZF9jb25maWctPmJfaW5mbzsKIAogICAgIHV1aWRfc3Ry
aW5nID0gbGlieGxfX3V1aWQyc3RyaW5nKGdjLCBpbmZvLT51dWlkKTsKICAgICBpZiAoIXV1aWRf
c3RyaW5nKSB7CkBAIC01NjAsNTQgKzU1OSw3IEBAIGludCBsaWJ4bF9fZG9tYWluX21ha2UobGli
eGxfX2djICpnYywgbGlieGxfZG9tYWluX2NvbmZpZyAqZF9jb25maWcsCiAgICAgICAgIGdvdG8g
b3V0OwogICAgIH0KIAotICAgIC8qIFZhbGlkIGRvbWlkIGhlcmUgbWVhbnMgd2UncmUgc29mdCBy
ZXNldHRpbmcuICovCi0gICAgaWYgKCFsaWJ4bF9kb21pZF92YWxpZF9ndWVzdCgqZG9taWQpKSB7
Ci0gICAgICAgIHN0cnVjdCB4ZW5fZG9tY3RsX2NyZWF0ZWRvbWFpbiBjcmVhdGUgPSB7Ci0gICAg
ICAgICAgICAuc3NpZHJlZiA9IGluZm8tPnNzaWRyZWYsCi0gICAgICAgICAgICAubWF4X3ZjcHVz
ID0gYl9pbmZvLT5tYXhfdmNwdXMsCi0gICAgICAgICAgICAubWF4X2V2dGNobl9wb3J0ID0gYl9p
bmZvLT5ldmVudF9jaGFubmVscywKLSAgICAgICAgICAgIC5tYXhfZ3JhbnRfZnJhbWVzID0gYl9p
bmZvLT5tYXhfZ3JhbnRfZnJhbWVzLAotICAgICAgICAgICAgLm1heF9tYXB0cmFja19mcmFtZXMg
PSBiX2luZm8tPm1heF9tYXB0cmFja19mcmFtZXMsCi0gICAgICAgIH07Ci0KLSAgICAgICAgaWYg
KGluZm8tPnR5cGUgIT0gTElCWExfRE9NQUlOX1RZUEVfUFYpIHsKLSAgICAgICAgICAgIGNyZWF0
ZS5mbGFncyB8PSBYRU5fRE9NQ1RMX0NERl9odm07Ci0gICAgICAgICAgICBjcmVhdGUuZmxhZ3Mg
fD0KLSAgICAgICAgICAgICAgICBsaWJ4bF9kZWZib29sX3ZhbChpbmZvLT5oYXApID8gWEVOX0RP
TUNUTF9DREZfaGFwIDogMDsKLSAgICAgICAgICAgIGNyZWF0ZS5mbGFncyB8PQotICAgICAgICAg
ICAgICAgIGxpYnhsX2RlZmJvb2xfdmFsKGluZm8tPm9vcykgPyAwIDogWEVOX0RPTUNUTF9DREZf
b29zX29mZjsKLSAgICAgICAgfQotCi0gICAgICAgIC8qIFVsdGltYXRlbHksIGhhbmRsZSBpcyBh
biBhcnJheSBvZiAxNiB1aW50OF90LCBzYW1lIGFzIHV1aWQgKi8KLSAgICAgICAgbGlieGxfdXVp
ZF9jb3B5KGN0eCwgKGxpYnhsX3V1aWQgKikmY3JlYXRlLmhhbmRsZSwgJmluZm8tPnV1aWQpOwot
Ci0gICAgICAgIHJldCA9IGxpYnhsX19hcmNoX2RvbWFpbl9wcmVwYXJlX2NvbmZpZyhnYywgZF9j
b25maWcsICZjcmVhdGUpOwotICAgICAgICBpZiAocmV0IDwgMCkgewotICAgICAgICAgICAgTE9H
RUQoRVJST1IsICpkb21pZCwgImZhaWwgdG8gZ2V0IGRvbWFpbiBjb25maWciKTsKLSAgICAgICAg
ICAgIHJjID0gRVJST1JfRkFJTDsKLSAgICAgICAgICAgIGdvdG8gb3V0OwotICAgICAgICB9Ci0K
LSAgICAgICAgcmV0ID0geGNfZG9tYWluX2NyZWF0ZShjdHgtPnhjaCwgZG9taWQsICZjcmVhdGUp
OwotICAgICAgICBpZiAocmV0IDwgMCkgewotICAgICAgICAgICAgTE9HRUQoRVJST1IsICpkb21p
ZCwgImRvbWFpbiBjcmVhdGlvbiBmYWlsIik7Ci0gICAgICAgICAgICByYyA9IEVSUk9SX0ZBSUw7
Ci0gICAgICAgICAgICBnb3RvIG91dDsKLSAgICAgICAgfQotCi0gICAgICAgIHJjID0gbGlieGxf
X2FyY2hfZG9tYWluX3NhdmVfY29uZmlnKGdjLCBkX2NvbmZpZywgc3RhdGUsICZjcmVhdGUpOwot
ICAgICAgICBpZiAocmMgPCAwKQotICAgICAgICAgICAgZ290byBvdXQ7Ci0gICAgfQotCi0gICAg
cmV0ID0geGNfY3B1cG9vbF9tb3ZlZG9tYWluKGN0eC0+eGNoLCBpbmZvLT5wb29saWQsICpkb21p
ZCk7Ci0gICAgaWYgKHJldCA8IDApIHsKLSAgICAgICAgTE9HRUQoRVJST1IsICpkb21pZCwgImRv
bWFpbiBtb3ZlIGZhaWwiKTsKLSAgICAgICAgcmMgPSBFUlJPUl9GQUlMOwotICAgICAgICBnb3Rv
IG91dDsKLSAgICB9Ci0KLSAgICBkb21fcGF0aCA9IGxpYnhsX194c19nZXRfZG9tcGF0aChnYywg
KmRvbWlkKTsKKyAgICBkb21fcGF0aCA9IGxpYnhsX194c19nZXRfZG9tcGF0aChnYywgZG9taWQp
OwogICAgIGlmICghZG9tX3BhdGgpIHsKICAgICAgICAgcmMgPSBFUlJPUl9GQUlMOwogICAgICAg
ICBnb3RvIG91dDsKQEAgLTYxNSwxMiArNTY3LDEyIEBAIGludCBsaWJ4bF9fZG9tYWluX21ha2Uo
bGlieGxfX2djICpnYywgbGlieGxfZG9tYWluX2NvbmZpZyAqZF9jb25maWcsCiAKICAgICB2bV9w
YXRoID0gR0NTUFJJTlRGKCIvdm0vJXMiLCB1dWlkX3N0cmluZyk7CiAgICAgaWYgKCF2bV9wYXRo
KSB7Ci0gICAgICAgIExPR0QoRVJST1IsICpkb21pZCwgImNhbm5vdCBhbGxvY2F0ZSBjcmVhdGUg
cGF0aHMiKTsKKyAgICAgICAgTE9HRChFUlJPUiwgZG9taWQsICJjYW5ub3QgYWxsb2NhdGUgY3Jl
YXRlIHBhdGhzIik7CiAgICAgICAgIHJjID0gRVJST1JfRkFJTDsKICAgICAgICAgZ290byBvdXQ7
CiAgICAgfQogCi0gICAgbGlieGxfcGF0aCA9IGxpYnhsX194c19saWJ4bF9wYXRoKGdjLCAqZG9t
aWQpOworICAgIGxpYnhsX3BhdGggPSBsaWJ4bF9feHNfbGlieGxfcGF0aChnYywgZG9taWQpOwog
ICAgIGlmICghbGlieGxfcGF0aCkgewogICAgICAgICByYyA9IEVSUk9SX0ZBSUw7CiAgICAgICAg
IGdvdG8gb3V0OwpAQCAtNjMxLDEwICs1ODMsMTAgQEAgaW50IGxpYnhsX19kb21haW5fbWFrZShs
aWJ4bF9fZ2MgKmdjLCBsaWJ4bF9kb21haW5fY29uZmlnICpkX2NvbmZpZywKIAogICAgIHJvcGVy
bVswXS5pZCA9IDA7CiAgICAgcm9wZXJtWzBdLnBlcm1zID0gWFNfUEVSTV9OT05FOwotICAgIHJv
cGVybVsxXS5pZCA9ICpkb21pZDsKKyAgICByb3Blcm1bMV0uaWQgPSBkb21pZDsKICAgICByb3Bl
cm1bMV0ucGVybXMgPSBYU19QRVJNX1JFQUQ7CiAKLSAgICByd3Blcm1bMF0uaWQgPSAqZG9taWQ7
CisgICAgcndwZXJtWzBdLmlkID0gZG9taWQ7CiAgICAgcndwZXJtWzBdLnBlcm1zID0gWFNfUEVS
TV9OT05FOwogCiByZXRyeV90cmFuc2FjdGlvbjoKQEAgLTY1Miw3ICs2MDQsNyBAQCByZXRyeV90
cmFuc2FjdGlvbjoKICAgICAgICAgICAgICAgICAgICAgbm9wZXJtLCBBUlJBWV9TSVpFKG5vcGVy
bSkpOwogCiAgICAgeHNfd3JpdGUoY3R4LT54c2gsIHQsIEdDU1BSSU5URigiJXMvdm0iLCBkb21f
cGF0aCksIHZtX3BhdGgsIHN0cmxlbih2bV9wYXRoKSk7Ci0gICAgcmMgPSBsaWJ4bF9fZG9tYWlu
X3JlbmFtZShnYywgKmRvbWlkLCAwLCBpbmZvLT5uYW1lLCB0KTsKKyAgICByYyA9IGxpYnhsX19k
b21haW5fcmVuYW1lKGdjLCBkb21pZCwgMCwgaW5mby0+bmFtZSwgdCk7CiAgICAgaWYgKHJjKQog
ICAgICAgICBnb3RvIG91dDsKIApAQCAtNzI5LDcgKzY4MSw3IEBAIHJldHJ5X3RyYW5zYWN0aW9u
OgogCiAgICAgdm1fbGlzdCA9IGxpYnhsX2xpc3Rfdm0oY3R4LCAmbmJfdm0pOwogICAgIGlmICgh
dm1fbGlzdCkgewotICAgICAgICBMT0dEKEVSUk9SLCAqZG9taWQsICJjYW5ub3QgZ2V0IG51bWJl
ciBvZiBydW5uaW5nIGd1ZXN0cyIpOworICAgICAgICBMT0dEKEVSUk9SLCBkb21pZCwgImNhbm5v
dCBnZXQgbnVtYmVyIG9mIHJ1bm5pbmcgZ3Vlc3RzIik7CiAgICAgICAgIHJjID0gRVJST1JfRkFJ
TDsKICAgICAgICAgZ290byBvdXQ7CiAgICAgfQpAQCAtNzUzLDcgKzcwNSw3IEBAIHJldHJ5X3Ry
YW5zYWN0aW9uOgogICAgICAgICAgICAgdCA9IDA7CiAgICAgICAgICAgICBnb3RvIHJldHJ5X3Ry
YW5zYWN0aW9uOwogICAgICAgICB9Ci0gICAgICAgIExPR0VEKEVSUk9SLCAqZG9taWQsICJkb21h
aW4gY3JlYXRpb24gIiJ4ZW5zdG9yZSB0cmFuc2FjdGlvbiBjb21taXQgZmFpbGVkIik7CisgICAg
ICAgIExPR0VEKEVSUk9SLCBkb21pZCwgImRvbWFpbiBjcmVhdGlvbiAiInhlbnN0b3JlIHRyYW5z
YWN0aW9uIGNvbW1pdCBmYWlsZWQiKTsKICAgICAgICAgcmMgPSBFUlJPUl9GQUlMOwogICAgICAg
ICBnb3RvIG91dDsKICAgICB9CkBAIC03NjUsNiArNzE3LDcwIEBAIHJldHJ5X3RyYW5zYWN0aW9u
OgogICAgIHJldHVybiByYzsKIH0KIAoraW50IGxpYnhsX19kb21haW5fbWFrZShsaWJ4bF9fZ2Mg
KmdjLCBsaWJ4bF9kb21haW5fY29uZmlnICpkX2NvbmZpZywKKyAgICAgICAgICAgICAgICAgICAg
ICAgbGlieGxfX2RvbWFpbl9idWlsZF9zdGF0ZSAqc3RhdGUsCisgICAgICAgICAgICAgICAgICAg
ICAgIHVpbnQzMl90ICpkb21pZCkKK3sKKyAgICBsaWJ4bF9jdHggKmN0eCA9IGxpYnhsX19nY19v
d25lcihnYyk7CisgICAgaW50IHJldCwgcmM7CisKKyAgICAvKiBjb252ZW5pZW5jZSBhbGlhc2Vz
ICovCisgICAgbGlieGxfZG9tYWluX2NyZWF0ZV9pbmZvICppbmZvID0gJmRfY29uZmlnLT5jX2lu
Zm87CisgICAgbGlieGxfZG9tYWluX2J1aWxkX2luZm8gKmJfaW5mbyA9ICZkX2NvbmZpZy0+Yl9p
bmZvOworCisgICAgLyogVmFsaWQgZG9taWQgaGVyZSBtZWFucyB3ZSdyZSBzb2Z0IHJlc2V0dGlu
Zy4gKi8KKyAgICBpZiAoIWxpYnhsX2RvbWlkX3ZhbGlkX2d1ZXN0KCpkb21pZCkpIHsKKyAgICAg
ICAgc3RydWN0IHhlbl9kb21jdGxfY3JlYXRlZG9tYWluIGNyZWF0ZSA9IHsKKyAgICAgICAgICAg
IC5zc2lkcmVmID0gaW5mby0+c3NpZHJlZiwKKyAgICAgICAgICAgIC5tYXhfdmNwdXMgPSBiX2lu
Zm8tPm1heF92Y3B1cywKKyAgICAgICAgICAgIC5tYXhfZXZ0Y2huX3BvcnQgPSBiX2luZm8tPmV2
ZW50X2NoYW5uZWxzLAorICAgICAgICAgICAgLm1heF9ncmFudF9mcmFtZXMgPSBiX2luZm8tPm1h
eF9ncmFudF9mcmFtZXMsCisgICAgICAgICAgICAubWF4X21hcHRyYWNrX2ZyYW1lcyA9IGJfaW5m
by0+bWF4X21hcHRyYWNrX2ZyYW1lcywKKyAgICAgICAgfTsKKworICAgICAgICBpZiAoaW5mby0+
dHlwZSAhPSBMSUJYTF9ET01BSU5fVFlQRV9QVikgeworICAgICAgICAgICAgY3JlYXRlLmZsYWdz
IHw9IFhFTl9ET01DVExfQ0RGX2h2bTsKKyAgICAgICAgICAgIGNyZWF0ZS5mbGFncyB8PQorICAg
ICAgICAgICAgICAgIGxpYnhsX2RlZmJvb2xfdmFsKGluZm8tPmhhcCkgPyBYRU5fRE9NQ1RMX0NE
Rl9oYXAgOiAwOworICAgICAgICAgICAgY3JlYXRlLmZsYWdzIHw9CisgICAgICAgICAgICAgICAg
bGlieGxfZGVmYm9vbF92YWwoaW5mby0+b29zKSA/IDAgOiBYRU5fRE9NQ1RMX0NERl9vb3Nfb2Zm
OworICAgICAgICB9CisKKyAgICAgICAgLyogVWx0aW1hdGVseSwgaGFuZGxlIGlzIGFuIGFycmF5
IG9mIDE2IHVpbnQ4X3QsIHNhbWUgYXMgdXVpZCAqLworICAgICAgICBsaWJ4bF91dWlkX2NvcHko
Y3R4LCAobGlieGxfdXVpZCAqKSZjcmVhdGUuaGFuZGxlLCAmaW5mby0+dXVpZCk7CisKKyAgICAg
ICAgcmV0ID0gbGlieGxfX2FyY2hfZG9tYWluX3ByZXBhcmVfY29uZmlnKGdjLCBkX2NvbmZpZywg
JmNyZWF0ZSk7CisgICAgICAgIGlmIChyZXQgPCAwKSB7CisgICAgICAgICAgICBMT0dFRChFUlJP
UiwgKmRvbWlkLCAiZmFpbCB0byBnZXQgZG9tYWluIGNvbmZpZyIpOworICAgICAgICAgICAgcmMg
PSBFUlJPUl9GQUlMOworICAgICAgICAgICAgZ290byBvdXQ7CisgICAgICAgIH0KKworICAgICAg
ICByZXQgPSB4Y19kb21haW5fY3JlYXRlKGN0eC0+eGNoLCBkb21pZCwgJmNyZWF0ZSk7CisgICAg
ICAgIGlmIChyZXQgPCAwKSB7CisgICAgICAgICAgICBMT0dFRChFUlJPUiwgKmRvbWlkLCAiZG9t
YWluIGNyZWF0aW9uIGZhaWwiKTsKKyAgICAgICAgICAgIHJjID0gRVJST1JfRkFJTDsKKyAgICAg
ICAgICAgIGdvdG8gb3V0OworICAgICAgICB9CisKKyAgICAgICAgcmMgPSBsaWJ4bF9fYXJjaF9k
b21haW5fc2F2ZV9jb25maWcoZ2MsIGRfY29uZmlnLCBzdGF0ZSwgJmNyZWF0ZSk7CisgICAgICAg
IGlmIChyYyA8IDApCisgICAgICAgICAgICBnb3RvIG91dDsKKyAgICB9CisKKyAgICByZXQgPSB4
Y19jcHVwb29sX21vdmVkb21haW4oY3R4LT54Y2gsIGluZm8tPnBvb2xpZCwgKmRvbWlkKTsKKyAg
ICBpZiAocmV0IDwgMCkgeworICAgICAgICBMT0dFRChFUlJPUiwgKmRvbWlkLCAiZG9tYWluIG1v
dmUgZmFpbCIpOworICAgICAgICByYyA9IEVSUk9SX0ZBSUw7CisgICAgICAgIGdvdG8gb3V0Owor
ICAgIH0KKworICAgIHJjID0gbGlieGxfX2RvbWFpbl9tYWtlX3hzX2VudHJpZXMoZ2MsIGRfY29u
ZmlnLCBzdGF0ZSwgKmRvbWlkKTsKKworb3V0OgorICAgIHJldHVybiByYzsKK30KKwogc3RhdGlj
IGludCBzdG9yZV9saWJ4bF9lbnRyeShsaWJ4bF9fZ2MgKmdjLCB1aW50MzJfdCBkb21pZCwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlieGxfZG9tYWluX2J1aWxkX2luZm8gKmJfaW5m
bykKIHsKQEAgLTk4NSwxNSArMTAwMSwzMSBAQCBzdGF0aWMgdm9pZCBpbml0aWF0ZV9kb21haW5f
Y3JlYXRlKGxpYnhsX19lZ2MgKmVnYywKICAgICAgICAgZ290byBlcnJvcl9vdXQ7CiAgICAgfQog
Ci0gICAgcmV0ID0gbGlieGxfX2RvbWFpbl9tYWtlKGdjLCBkX2NvbmZpZywgJmRjcy0+YnVpbGRf
c3RhdGUsICZkb21pZCk7Ci0gICAgaWYgKHJldCkgewotICAgICAgICBMT0dEKEVSUk9SLCBkb21p
ZCwgImNhbm5vdCBtYWtlIGRvbWFpbjogJWQiLCByZXQpOworICAgIGlmICggIWRfY29uZmlnLT5k
bV9yZXN0b3JlX2ZpbGUgKQorICAgIHsKKyAgICAgICAgcmV0ID0gbGlieGxfX2RvbWFpbl9tYWtl
KGdjLCBkX2NvbmZpZywgJmRjcy0+YnVpbGRfc3RhdGUsICZkb21pZCk7CiAgICAgICAgIGRjcy0+
Z3Vlc3RfZG9taWQgPSBkb21pZDsKKworICAgICAgICBpZiAocmV0KSB7CisgICAgICAgICAgICBM
T0dEKEVSUk9SLCBkb21pZCwgImNhbm5vdCBtYWtlIGRvbWFpbjogJWQiLCByZXQpOworICAgICAg
ICAgICAgcmV0ID0gRVJST1JfRkFJTDsKKyAgICAgICAgICAgIGdvdG8gZXJyb3Jfb3V0OworICAg
ICAgICB9CisgICAgfSBlbHNlIGlmICggZGNzLT5ndWVzdF9kb21pZCAhPSBJTlZBTElEX0RPTUlE
ICkgeworICAgICAgICBkb21pZCA9IGRjcy0+Z3Vlc3RfZG9taWQ7CisKKyAgICAgICAgcmV0ID0g
bGlieGxfX2RvbWFpbl9tYWtlX3hzX2VudHJpZXMoZ2MsIGRfY29uZmlnLCAmZGNzLT5idWlsZF9z
dGF0ZSwgZG9taWQpOworICAgICAgICBpZiAocmV0KSB7CisgICAgICAgICAgICBMT0dEKEVSUk9S
LCBkb21pZCwgImNhbm5vdCBtYWtlIGRvbWFpbjogJWQiLCByZXQpOworICAgICAgICAgICAgcmV0
ID0gRVJST1JfRkFJTDsKKyAgICAgICAgICAgIGdvdG8gZXJyb3Jfb3V0OworICAgICAgICB9Cisg
ICAgfSBlbHNlIHsKKyAgICAgICAgTE9HRChFUlJPUiwgZG9taWQsICJjYW5ub3QgbWFrZSBkb21h
aW4iKTsKICAgICAgICAgcmV0ID0gRVJST1JfRkFJTDsKICAgICAgICAgZ290byBlcnJvcl9vdXQ7
CiAgICAgfQogCi0gICAgZGNzLT5ndWVzdF9kb21pZCA9IGRvbWlkOwogICAgIGRjcy0+c2Rzcy5k
bS5ndWVzdF9kb21pZCA9IDA7IC8qIG1lYW5zIHdlIGhhdmVuJ3Qgc3Bhd25lZCAqLwogCiAgICAg
LyoKQEAgLTEwMjYsNyArMTA1OCw3IEBAIHN0YXRpYyB2b2lkIGluaXRpYXRlX2RvbWFpbl9jcmVh
dGUobGlieGxfX2VnYyAqZWdjLAogICAgIGlmIChyZXQpCiAgICAgICAgIGdvdG8gZXJyb3Jfb3V0
OwogCi0gICAgaWYgKHJlc3RvcmVfZmQgPj0gMCB8fCBkY3MtPmRvbWlkX3NvZnRfcmVzZXQgIT0g
SU5WQUxJRF9ET01JRCkgeworICAgIGlmIChyZXN0b3JlX2ZkID49IDAgfHwgZGNzLT5kb21pZF9z
b2Z0X3Jlc2V0ICE9IElOVkFMSURfRE9NSUQgfHwgZF9jb25maWctPmRtX3Jlc3RvcmVfZmlsZSkg
ewogICAgICAgICBMT0dEKERFQlVHLCBkb21pZCwgInJlc3RvcmluZywgbm90IHJ1bm5pbmcgYm9v
dGxvYWRlciIpOwogICAgICAgICBkb21jcmVhdGVfYm9vdGxvYWRlcl9kb25lKGVnYywgJmRjcy0+
YmwsIDApOwogICAgIH0gZWxzZSAgewpAQCAtMTEwMiw3ICsxMTM0LDE2IEBAIHN0YXRpYyB2b2lk
IGRvbWNyZWF0ZV9ib290bG9hZGVyX2RvbmUobGlieGxfX2VnYyAqZWdjLAogICAgIGRjcy0+c2Rz
cy5kbS5jYWxsYmFjayA9IGRvbWNyZWF0ZV9kZXZtb2RlbF9zdGFydGVkOwogICAgIGRjcy0+c2Rz
cy5jYWxsYmFjayA9IGRvbWNyZWF0ZV9kZXZtb2RlbF9zdGFydGVkOwogCi0gICAgaWYgKHJlc3Rv
cmVfZmQgPCAwICYmIGRjcy0+ZG9taWRfc29mdF9yZXNldCA9PSBJTlZBTElEX0RPTUlEKSB7Cisg
ICAgaWYgKHJlc3RvcmVfZmQgPCAwICYmIGRjcy0+ZG9taWRfc29mdF9yZXNldCA9PSBJTlZBTElE
X0RPTUlEICYmICFkX2NvbmZpZy0+ZG1fcmVzdG9yZV9maWxlKSB7CisgICAgICAgIHJjID0gbGli
eGxfX2RvbWFpbl9idWlsZChnYywgZF9jb25maWcsIGRvbWlkLCBzdGF0ZSk7CisgICAgICAgIGRv
bWNyZWF0ZV9yZWJ1aWxkX2RvbmUoZWdjLCBkY3MsIHJjKTsKKyAgICAgICAgcmV0dXJuOworICAg
IH0KKworICAgIGlmICggZF9jb25maWctPmRtX3Jlc3RvcmVfZmlsZSApIHsKKyAgICAgICAgZGNz
LT5zcnMuZGNzID0gZGNzOworICAgICAgICBkY3MtPnNycy5hbyA9IGFvOworICAgICAgICBzdGF0
ZS0+Zm9ya2VkX3ZtID0gdHJ1ZTsKICAgICAgICAgcmMgPSBsaWJ4bF9fZG9tYWluX2J1aWxkKGdj
LCBkX2NvbmZpZywgZG9taWQsIHN0YXRlKTsKICAgICAgICAgZG9tY3JlYXRlX3JlYnVpbGRfZG9u
ZShlZ2MsIGRjcywgcmMpOwogICAgICAgICByZXR1cm47CkBAIC0xMzAwLDYgKzEzNDEsNyBAQCBz
dGF0aWMgdm9pZCBkb21jcmVhdGVfcmVidWlsZF9kb25lKGxpYnhsX19lZ2MgKmVnYywKICAgICAv
KiBjb252ZW5pZW5jZSBhbGlhc2VzICovCiAgICAgY29uc3QgdWludDMyX3QgZG9taWQgPSBkY3Mt
Pmd1ZXN0X2RvbWlkOwogICAgIGxpYnhsX2RvbWFpbl9jb25maWcgKmNvbnN0IGRfY29uZmlnID0g
ZGNzLT5ndWVzdF9jb25maWc7CisgICAgbGlieGxfX2RvbWFpbl9idWlsZF9zdGF0ZSAqY29uc3Qg
c3RhdGUgPSAmZGNzLT5idWlsZF9zdGF0ZTsKIAogICAgIGlmIChyZXQpIHsKICAgICAgICAgTE9H
RChFUlJPUiwgZG9taWQsICJjYW5ub3QgKHJlLSlidWlsZCBkb21haW46ICVkIiwgcmV0KTsKQEAg
LTEzMDcsNiArMTM0OSw5IEBAIHN0YXRpYyB2b2lkIGRvbWNyZWF0ZV9yZWJ1aWxkX2RvbmUobGli
eGxfX2VnYyAqZWdjLAogICAgICAgICBnb3RvIGVycm9yX291dDsKICAgICB9CiAKKyAgICBpZiAo
IGRfY29uZmlnLT5kbV9yZXN0b3JlX2ZpbGUgKQorICAgICAgICBzdGF0ZS0+c2F2ZWRfc3RhdGUg
PSBHQ1NQUklOVEYoIiVzIiwgZF9jb25maWctPmRtX3Jlc3RvcmVfZmlsZSk7CisKICAgICBzdG9y
ZV9saWJ4bF9lbnRyeShnYywgZG9taWQsICZkX2NvbmZpZy0+Yl9pbmZvKTsKIAogICAgIGxpYnhs
X19tdWx0aWRldl9iZWdpbihhbywgJmRjcy0+bXVsdGlkZXYpOwpAQCAtMTcwOCwxMCArMTc1Mywx
MyBAQCBzdGF0aWMgaW50IGRvX2RvbWFpbl9jcmVhdGUobGlieGxfY3R4ICpjdHgsIGxpYnhsX2Rv
bWFpbl9jb25maWcgKmRfY29uZmlnLAogICAgIEdDTkVXKGNkY3MpOwogICAgIGNkY3MtPmRjcy5h
byA9IGFvOwogICAgIGNkY3MtPmRjcy5ndWVzdF9jb25maWcgPSBkX2NvbmZpZzsKKyAgICBjZGNz
LT5kY3MuZ3Vlc3RfZG9taWQgPSAqZG9taWQ7CisKICAgICBsaWJ4bF9kb21haW5fY29uZmlnX2lu
aXQoJmNkY3MtPmRjcy5ndWVzdF9jb25maWdfc2F2ZWQpOwogICAgIGxpYnhsX2RvbWFpbl9jb25m
aWdfY29weShjdHgsICZjZGNzLT5kY3MuZ3Vlc3RfY29uZmlnX3NhdmVkLCBkX2NvbmZpZyk7CiAg
ICAgY2Rjcy0+ZGNzLnJlc3RvcmVfZmQgPSBjZGNzLT5kY3MubGlieGNfZmQgPSByZXN0b3JlX2Zk
OwogICAgIGNkY3MtPmRjcy5zZW5kX2JhY2tfZmQgPSBzZW5kX2JhY2tfZmQ7CisKICAgICBpZiAo
cmVzdG9yZV9mZCA+IC0xKSB7CiAgICAgICAgIGNkY3MtPmRjcy5yZXN0b3JlX3BhcmFtcyA9ICpw
YXJhbXM7CiAgICAgICAgIHJjID0gbGlieGxfX2ZkX2ZsYWdzX21vZGlmeV9zYXZlKGdjLCBjZGNz
LT5kY3MucmVzdG9yZV9mZCwKQEAgLTE5NTQsNiArMjAwMiwzOCBAQCBpbnQgbGlieGxfZG9tYWlu
X2NyZWF0ZV9uZXcobGlieGxfY3R4ICpjdHgsIGxpYnhsX2RvbWFpbl9jb25maWcgKmRfY29uZmln
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFvX2hvdywgYW9wX2NvbnNvbGVfaG93KTsK
IH0KIAoraW50IGxpYnhsX2RvbWFpbl9mb3JrX3ZtKGxpYnhsX2N0eCAqY3R4LCB1aW50MzJfdCBw
ZG9taWQsIHVpbnQzMl90ICpkb21pZCkKK3sKKyAgICBpbnQgcmM7CisgICAgc3RydWN0IHhlbl9k
b21jdGxfY3JlYXRlZG9tYWluIGNyZWF0ZSA9IHswfTsKKyAgICBjcmVhdGUuZmxhZ3MgfD0gWEVO
X0RPTUNUTF9DREZfaHZtOworICAgIGNyZWF0ZS5mbGFncyB8PSBYRU5fRE9NQ1RMX0NERl9oYXA7
CisgICAgY3JlYXRlLmZsYWdzIHw9IFhFTl9ET01DVExfQ0RGX29vc19vZmY7CisgICAgY3JlYXRl
LmFyY2guZW11bGF0aW9uX2ZsYWdzID0gKFhFTl9YODZfRU1VX0FMTCAmIH5YRU5fWDg2X0VNVV9W
UENJKTsKKworICAgIGNyZWF0ZS5zc2lkcmVmID0gU0VDSU5JVFNJRF9ET01VOworICAgIGNyZWF0
ZS5tYXhfdmNwdXMgPSAxOyAvLyBwbGFjZWhvbGRlciwgd2lsbCBiZSBjbG9uZWQgZnJvbSBwZG9t
aWQKKyAgICBjcmVhdGUubWF4X2V2dGNobl9wb3J0ID0gMTAyMzsKKyAgICBjcmVhdGUubWF4X2dy
YW50X2ZyYW1lcyA9IExJQlhMX01BWF9HUkFOVF9GUkFNRVNfREVGQVVMVDsKKyAgICBjcmVhdGUu
bWF4X21hcHRyYWNrX2ZyYW1lcyA9IExJQlhMX01BWF9NQVBUUkFDS19GUkFNRVNfREVGQVVMVDsK
KworICAgIGlmICggKHJjID0geGNfZG9tYWluX2NyZWF0ZShjdHgtPnhjaCwgZG9taWQsICZjcmVh
dGUpKSApCisgICAgICAgIHJldHVybiByYzsKKworICAgIGlmICggKHJjID0geGNfbWVtc2hyX2Zv
cmsoY3R4LT54Y2gsIHBkb21pZCwgKmRvbWlkKSkgKQorICAgICAgICB4Y19kb21haW5fZGVzdHJv
eShjdHgtPnhjaCwgKmRvbWlkKTsKKworICAgIHJldHVybiByYzsKK30KKworaW50IGxpYnhsX2Rv
bWFpbl9mb3JrX2xhdW5jaF9kbShsaWJ4bF9jdHggKmN0eCwgbGlieGxfZG9tYWluX2NvbmZpZyAq
ZF9jb25maWcsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90IGRvbWlk
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsaWJ4bF9hc3luY3Byb2dy
ZXNzX2hvdyAqYW9wX2NvbnNvbGVfaG93KQoreworICAgIHVuc2V0X2Rpc2tfY29sb19yZXN0b3Jl
KGRfY29uZmlnKTsKKyAgICByZXR1cm4gZG9fZG9tYWluX2NyZWF0ZShjdHgsIGRfY29uZmlnLCAm
ZG9taWQsIC0xLCAtMSwgMCwgMCwgYW9wX2NvbnNvbGVfaG93KTsKK30KKwogaW50IGxpYnhsX2Rv
bWFpbl9jcmVhdGVfcmVzdG9yZShsaWJ4bF9jdHggKmN0eCwgbGlieGxfZG9tYWluX2NvbmZpZyAq
ZF9jb25maWcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90ICpkb21p
ZCwgaW50IHJlc3RvcmVfZmQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBz
ZW5kX2JhY2tfZmQsCmRpZmYgLS1naXQgYS90b29scy9saWJ4bC9saWJ4bF9kbS5jIGIvdG9vbHMv
bGlieGwvbGlieGxfZG0uYwppbmRleCBjMDAzNTZhMmYxLi43MmM2ZmI3NTQxIDEwMDY0NAotLS0g
YS90b29scy9saWJ4bC9saWJ4bF9kbS5jCisrKyBiL3Rvb2xzL2xpYnhsL2xpYnhsX2RtLmMKQEAg
LTI3ODUsNyArMjc4NSw3IEBAIHN0YXRpYyB2b2lkIGRldmljZV9tb2RlbF9zcGF3bl9vdXRjb21l
KGxpYnhsX19lZ2MgKmVnYywKIAogICAgIGxpYnhsX19kb21haW5fYnVpbGRfc3RhdGUgKnN0YXRl
ID0gZG1zcy0+YnVpbGRfc3RhdGU7CiAKLSAgICBpZiAoc3RhdGUtPnNhdmVkX3N0YXRlKSB7Cisg
ICAgaWYgKHN0YXRlLT5zYXZlZF9zdGF0ZSAmJiAhc3RhdGUtPmZvcmtlZF92bSkgewogICAgICAg
ICByZXQyID0gdW5saW5rKHN0YXRlLT5zYXZlZF9zdGF0ZSk7CiAgICAgICAgIGlmIChyZXQyKSB7
CiAgICAgICAgICAgICBMT0dFRChFUlJPUiwgZG1zcy0+Z3Vlc3RfZG9taWQsICIlczogZmFpbGVk
IHRvIHJlbW92ZSBkZXZpY2UtbW9kZWwgc3RhdGUgJXMiLApkaWZmIC0tZ2l0IGEvdG9vbHMvbGli
eGwvbGlieGxfZG9tLmMgYi90b29scy9saWJ4bC9saWJ4bF9kb20uYwppbmRleCBjNTY4NWIwNjFj
Li42ZTA3ODkzZTNlIDEwMDY0NAotLS0gYS90b29scy9saWJ4bC9saWJ4bF9kb20uYworKysgYi90
b29scy9saWJ4bC9saWJ4bF9kb20uYwpAQCAtMzkxLDkgKzM5MSwxMiBAQCBpbnQgbGlieGxfX2J1
aWxkX3ByZShsaWJ4bF9fZ2MgKmdjLCB1aW50MzJfdCBkb21pZCwKICAgICBsaWJ4bF9kb21haW5f
YnVpbGRfaW5mbyAqY29uc3QgaW5mbyA9ICZkX2NvbmZpZy0+Yl9pbmZvOwogICAgIGxpYnhsX2N0
eCAqY3R4ID0gbGlieGxfX2djX293bmVyKGdjKTsKICAgICBjaGFyICp4c19kb21pZCwgKmNvbl9k
b21pZDsKLSAgICBpbnQgcmM7CisgICAgaW50IHJjID0gMDsKICAgICB1aW50NjRfdCBzaXplOwog
CisgICAgaWYgKCBzdGF0ZS0+Zm9ya2VkX3ZtICkKKyAgICAgICAgZ290byBza2lwX2Zvcms7CisK
ICAgICBpZiAoeGNfZG9tYWluX21heF92Y3B1cyhjdHgtPnhjaCwgZG9taWQsIGluZm8tPm1heF92
Y3B1cykgIT0gMCkgewogICAgICAgICBMT0coRVJST1IsICJDb3VsZG4ndCBzZXQgbWF4IHZjcHUg
Y291bnQiKTsKICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUw7CkBAIC00OTgsMjkgKzUwMSw2IEBA
IGludCBsaWJ4bF9fYnVpbGRfcHJlKGxpYnhsX19nYyAqZ2MsIHVpbnQzMl90IGRvbWlkLAogICAg
ICAgICB9CiAgICAgfQogCi0KLSAgICByYyA9IGxpYnhsX19hcmNoX2V4dHJhX21lbW9yeShnYywg
aW5mbywgJnNpemUpOwotICAgIGlmIChyYyA8IDApIHsKLSAgICAgICAgTE9HRShFUlJPUiwgIkNv
dWxkbid0IGdldCBhcmNoIGV4dHJhIGNvbnN0YW50IG1lbW9yeSBzaXplIik7Ci0gICAgICAgIHJl
dHVybiBFUlJPUl9GQUlMOwotICAgIH0KLQotICAgIGlmICh4Y19kb21haW5fc2V0bWF4bWVtKGN0
eC0+eGNoLCBkb21pZCwgaW5mby0+dGFyZ2V0X21lbWtiICsgc2l6ZSkgPCAwKSB7Ci0gICAgICAg
IExPR0UoRVJST1IsICJDb3VsZG4ndCBzZXQgbWF4IG1lbW9yeSIpOwotICAgICAgICByZXR1cm4g
RVJST1JfRkFJTDsKLSAgICB9Ci0KLSAgICB4c19kb21pZCA9IHhzX3JlYWQoY3R4LT54c2gsIFhC
VF9OVUxMLCAiL3Rvb2wveGVuc3RvcmVkL2RvbWlkIiwgTlVMTCk7Ci0gICAgc3RhdGUtPnN0b3Jl
X2RvbWlkID0geHNfZG9taWQgPyBhdG9pKHhzX2RvbWlkKSA6IDA7Ci0gICAgZnJlZSh4c19kb21p
ZCk7Ci0KLSAgICBjb25fZG9taWQgPSB4c19yZWFkKGN0eC0+eHNoLCBYQlRfTlVMTCwgIi90b29s
L3hlbmNvbnNvbGVkL2RvbWlkIiwgTlVMTCk7Ci0gICAgc3RhdGUtPmNvbnNvbGVfZG9taWQgPSBj
b25fZG9taWQgPyBhdG9pKGNvbl9kb21pZCkgOiAwOwotICAgIGZyZWUoY29uX2RvbWlkKTsKLQot
ICAgIHN0YXRlLT5zdG9yZV9wb3J0ID0geGNfZXZ0Y2huX2FsbG9jX3VuYm91bmQoY3R4LT54Y2gs
IGRvbWlkLCBzdGF0ZS0+c3RvcmVfZG9taWQpOwotICAgIHN0YXRlLT5jb25zb2xlX3BvcnQgPSB4
Y19ldnRjaG5fYWxsb2NfdW5ib3VuZChjdHgtPnhjaCwgZG9taWQsIHN0YXRlLT5jb25zb2xlX2Rv
bWlkKTsKLQogICAgIGlmIChpbmZvLT50eXBlICE9IExJQlhMX0RPTUFJTl9UWVBFX1BWKQogICAg
ICAgICBodm1fc2V0X2NvbmZfcGFyYW1zKGN0eC0+eGNoLCBkb21pZCwgaW5mbyk7CiAKQEAgLTU1
NSw4ICs1MzUsMzQgQEAgaW50IGxpYnhsX19idWlsZF9wcmUobGlieGxfX2djICpnYywgdWludDMy
X3QgZG9taWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mby0+YWx0cDJtKTsKICAgICB9
CiAKKyAgICByYyA9IGxpYnhsX19hcmNoX2V4dHJhX21lbW9yeShnYywgaW5mbywgJnNpemUpOwor
ICAgIGlmIChyYyA8IDApIHsKKyAgICAgICAgTE9HRShFUlJPUiwgIkNvdWxkbid0IGdldCBhcmNo
IGV4dHJhIGNvbnN0YW50IG1lbW9yeSBzaXplIik7CisgICAgICAgIHJldHVybiBFUlJPUl9GQUlM
OworICAgIH0KKworICAgIGlmICh4Y19kb21haW5fc2V0bWF4bWVtKGN0eC0+eGNoLCBkb21pZCwg
aW5mby0+dGFyZ2V0X21lbWtiICsgc2l6ZSkgPCAwKSB7CisgICAgICAgIExPR0UoRVJST1IsICJD
b3VsZG4ndCBzZXQgbWF4IG1lbW9yeSIpOworICAgICAgICByZXR1cm4gRVJST1JfRkFJTDsKKyAg
ICB9CisKICAgICByYyA9IGxpYnhsX19hcmNoX2RvbWFpbl9jcmVhdGUoZ2MsIGRfY29uZmlnLCBk
b21pZCk7CisgICAgaWYgKCByYyApCisgICAgICAgIGdvdG8gb3V0OwogCitza2lwX2Zvcms6Cisg
ICAgeHNfZG9taWQgPSB4c19yZWFkKGN0eC0+eHNoLCBYQlRfTlVMTCwgIi90b29sL3hlbnN0b3Jl
ZC9kb21pZCIsIE5VTEwpOworICAgIHN0YXRlLT5zdG9yZV9kb21pZCA9IHhzX2RvbWlkID8gYXRv
aSh4c19kb21pZCkgOiAwOworICAgIGZyZWUoeHNfZG9taWQpOworCisgICAgY29uX2RvbWlkID0g
eHNfcmVhZChjdHgtPnhzaCwgWEJUX05VTEwsICIvdG9vbC94ZW5jb25zb2xlZC9kb21pZCIsIE5V
TEwpOworICAgIHN0YXRlLT5jb25zb2xlX2RvbWlkID0gY29uX2RvbWlkID8gYXRvaShjb25fZG9t
aWQpIDogMDsKKyAgICBmcmVlKGNvbl9kb21pZCk7CisKKyAgICBzdGF0ZS0+c3RvcmVfcG9ydCA9
IHhjX2V2dGNobl9hbGxvY191bmJvdW5kKGN0eC0+eGNoLCBkb21pZCwgc3RhdGUtPnN0b3JlX2Rv
bWlkKTsKKyAgICBzdGF0ZS0+Y29uc29sZV9wb3J0ID0geGNfZXZ0Y2huX2FsbG9jX3VuYm91bmQo
Y3R4LT54Y2gsIGRvbWlkLCBzdGF0ZS0+Y29uc29sZV9kb21pZCk7CisKK291dDoKICAgICByZXR1
cm4gcmM7CiB9CiAKQEAgLTYxNCw2ICs2MjAsOSBAQCBpbnQgbGlieGxfX2J1aWxkX3Bvc3QobGli
eGxfX2djICpnYywgdWludDMyX3QgZG9taWQsCiAgICAgY2hhciAqKmVudHM7CiAgICAgaW50IGks
IHJjOwogCisgICAgaWYgKCBzdGF0ZS0+Zm9ya2VkX3ZtICkKKyAgICAgICAgZ290byBza2lwX2Zv
cms7CisKICAgICBpZiAoaW5mby0+bnVtX3ZudW1hX25vZGVzICYmICFpbmZvLT5udW1fdmNwdV9z
b2Z0X2FmZmluaXR5KSB7CiAgICAgICAgIHJjID0gc2V0X3ZudW1hX2FmZmluaXR5KGdjLCBkb21p
ZCwgaW5mbyk7CiAgICAgICAgIGlmIChyYykKQEAgLTYzOCw2ICs2NDcsNyBAQCBpbnQgbGlieGxf
X2J1aWxkX3Bvc3QobGlieGxfX2djICpnYywgdWludDMyX3QgZG9taWQsCiAgICAgICAgIH0KICAg
ICB9CiAKK3NraXBfZm9yazoKICAgICBlbnRzID0gbGlieGxfX2NhbGxvYyhnYywgMTIgKyAoaW5m
by0+bWF4X3ZjcHVzICogMikgKyAyLCBzaXplb2YoY2hhciAqKSk7CiAgICAgZW50c1swXSA9ICJt
ZW1vcnkvc3RhdGljLW1heCI7CiAgICAgZW50c1sxXSA9IEdDU1BSSU5URigiJSJQUklkNjQsIGlu
Zm8tPm1heF9tZW1rYik7CkBAIC05MDAsMTQgKzkxMCwxNiBAQCBzdGF0aWMgaW50IGh2bV9idWls
ZF9zZXRfcGFyYW1zKHhjX2ludGVyZmFjZSAqaGFuZGxlLCB1aW50MzJfdCBkb21pZCwKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlieGxfZG9tYWluX2J1aWxkX2luZm8gKmluZm8s
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBzdG9yZV9ldnRjaG4sIHVuc2ln
bmVkIGxvbmcgKnN0b3JlX21mbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50
IGNvbnNvbGVfZXZ0Y2huLCB1bnNpZ25lZCBsb25nICpjb25zb2xlX21mbiwKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgZG9taWRfdCBzdG9yZV9kb21pZCwgZG9taWRfdCBjb25zb2xl
X2RvbWlkKQorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb21pZF90IHN0b3JlX2Rv
bWlkLCBkb21pZF90IGNvbnNvbGVfZG9taWQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGJvb2wgZm9ya2VkX3ZtKQogewogICAgIHN0cnVjdCBodm1faW5mb190YWJsZSAqdmFfaHZt
OwogICAgIHVpbnQ4X3QgKnZhX21hcCwgc3VtOwogICAgIHVpbnQ2NF90IHN0cl9tZm4sIGNvbnNf
bWZuOwogICAgIGludCBpOwogCi0gICAgaWYgKGluZm8tPnR5cGUgPT0gTElCWExfRE9NQUlOX1RZ
UEVfSFZNKSB7CisgICAgaWYgKCBpbmZvLT50eXBlID09IExJQlhMX0RPTUFJTl9UWVBFX0hWTSAm
JiAhZm9ya2VkX3ZtICkKKyAgICB7CiAgICAgICAgIHZhX21hcCA9IHhjX21hcF9mb3JlaWduX3Jh
bmdlKGhhbmRsZSwgZG9taWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IFhDX1BBR0VfU0laRSwgUFJPVF9SRUFEIHwgUFJPVF9XUklURSwKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgSFZNX0lORk9fUEZOKTsKQEAgLTEyMjMsNiArMTIzNSwyMyBA
QCBpbnQgbGlieGxfX2J1aWxkX2h2bShsaWJ4bF9fZ2MgKmdjLCB1aW50MzJfdCBkb21pZCwKICAg
ICBzdHJ1Y3QgeGNfZG9tX2ltYWdlICpkb20gPSBOVUxMOwogICAgIGJvb2wgZGV2aWNlX21vZGVs
ID0gaW5mby0+dHlwZSA9PSBMSUJYTF9ET01BSU5fVFlQRV9IVk0gPyB0cnVlIDogZmFsc2U7CiAK
KyAgICBpZiAoIHN0YXRlLT5mb3JrZWRfdm0gKQorICAgIHsKKyAgICAgICAgcmMgPSBodm1fYnVp
bGRfc2V0X3BhcmFtcyhjdHgtPnhjaCwgZG9taWQsIGluZm8sIHN0YXRlLT5zdG9yZV9wb3J0LAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZzdGF0ZS0+c3RvcmVfbWZuLCBzdGF0
ZS0+Y29uc29sZV9wb3J0LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZzdGF0
ZS0+Y29uc29sZV9tZm4sIHN0YXRlLT5zdG9yZV9kb21pZCwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBzdGF0ZS0+Y29uc29sZV9kb21pZCwgc3RhdGUtPmZvcmtlZF92bSk7CisK
KyAgICAgICAgaWYgKCByYyApCisgICAgICAgICAgICByZXR1cm4gcmM7CisKKyAgICAgICAgcmV0
dXJuIHhjX2RvbV9nbnR0YWJfc2VlZChjdHgtPnhjaCwgZG9taWQsIHRydWUsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUtPmNvbnNvbGVfbWZuLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLT5zdG9yZV9tZm4sCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgc3RhdGUtPmNvbnNvbGVfZG9taWQsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgc3RhdGUtPnN0b3JlX2RvbWlkKTsKKyAgICB9CisKICAgICB4Y19k
b21fbG9naW5pdChjdHgtPnhjaCk7CiAKICAgICAvKgpAQCAtMTM0Nyw3ICsxMzc2LDcgQEAgaW50
IGxpYnhsX19idWlsZF9odm0obGlieGxfX2djICpnYywgdWludDMyX3QgZG9taWQsCiAgICAgcmMg
PSBodm1fYnVpbGRfc2V0X3BhcmFtcyhjdHgtPnhjaCwgZG9taWQsIGluZm8sIHN0YXRlLT5zdG9y
ZV9wb3J0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZzdGF0ZS0+c3RvcmVfbWZu
LCBzdGF0ZS0+Y29uc29sZV9wb3J0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZz
dGF0ZS0+Y29uc29sZV9tZm4sIHN0YXRlLT5zdG9yZV9kb21pZCwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBzdGF0ZS0+Y29uc29sZV9kb21pZCk7CisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgc3RhdGUtPmNvbnNvbGVfZG9taWQsIGZhbHNlKTsKICAgICBpZiAocmMgIT0g
MCkgewogICAgICAgICBMT0coRVJST1IsICJodm0gYnVpbGQgc2V0IHBhcmFtcyBmYWlsZWQiKTsK
ICAgICAgICAgZ290byBvdXQ7CmRpZmYgLS1naXQgYS90b29scy9saWJ4bC9saWJ4bF9pbnRlcm5h
bC5oIGIvdG9vbHMvbGlieGwvbGlieGxfaW50ZXJuYWwuaAppbmRleCBiZmViMzhlMGVkLi4wYmVj
ZmMzZTMxIDEwMDY0NAotLS0gYS90b29scy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5oCisrKyBiL3Rv
b2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmgKQEAgLTEyNzEsNiArMTI3MSw3IEBAIHR5cGVkZWYg
c3RydWN0IHsKIAogICAgIGNoYXIgKnNhdmVkX3N0YXRlOwogICAgIGludCBkbV9tb25pdG9yX2Zk
OworICAgIGJvb2wgZm9ya2VkX3ZtOwogCiAgICAgbGlieGxfX2ZpbGVfcmVmZXJlbmNlIHB2X2tl
cm5lbDsKICAgICBsaWJ4bF9fZmlsZV9yZWZlcmVuY2UgcHZfcmFtZGlzazsKZGlmZiAtLWdpdCBh
L3Rvb2xzL2xpYnhsL2xpYnhsX3R5cGVzLmlkbCBiL3Rvb2xzL2xpYnhsL2xpYnhsX3R5cGVzLmlk
bAppbmRleCAwNGM5NzYyYWYxLi5mMTJjMTg4MmRjIDEwMDY0NAotLS0gYS90b29scy9saWJ4bC9s
aWJ4bF90eXBlcy5pZGwKKysrIGIvdG9vbHMvbGlieGwvbGlieGxfdHlwZXMuaWRsCkBAIC05NDYs
NiArOTQ2LDcgQEAgbGlieGxfZG9tYWluX2NvbmZpZyA9IFN0cnVjdCgiZG9tYWluX2NvbmZpZyIs
IFsKICAgICAoIm9uX3dhdGNoZG9nIiwgbGlieGxfYWN0aW9uX29uX3NodXRkb3duKSwKICAgICAo
Im9uX2NyYXNoIiwgbGlieGxfYWN0aW9uX29uX3NodXRkb3duKSwKICAgICAoIm9uX3NvZnRfcmVz
ZXQiLCBsaWJ4bF9hY3Rpb25fb25fc2h1dGRvd24pLAorICAgICgiZG1fcmVzdG9yZV9maWxlIiwg
c3RyaW5nLCB7J2NvbnN0JzogVHJ1ZX0pLAogICAgIF0sIGRpcj1ESVJfSU4pCiAKIGxpYnhsX2Rp
c2tpbmZvID0gU3RydWN0KCJkaXNraW5mbyIsIFsKZGlmZiAtLWdpdCBhL3Rvb2xzL3hsL3hsLmgg
Yi90b29scy94bC94bC5oCmluZGV4IDYwYmRhZDhmZmIuLjk5M2E2M2QyNjggMTAwNjQ0Ci0tLSBh
L3Rvb2xzL3hsL3hsLmgKKysrIGIvdG9vbHMveGwveGwuaApAQCAtMzEsNiArMzEsNyBAQCBzdHJ1
Y3QgY21kX3NwZWMgewogfTsKIAogc3RydWN0IGRvbWFpbl9jcmVhdGUgeworICAgIHVpbnQzMl90
IGRkb21pZDsgLyogZm9yayBsYXVuY2ggZG0gZm9yIHRoaXMgZG9taWQgKi8KICAgICBpbnQgZGVi
dWc7CiAgICAgaW50IGRhZW1vbml6ZTsKICAgICBpbnQgbW9uaXRvcjsgLyogaGFuZGxlIGd1ZXN0
IHJlYm9vdHMgZXRjICovCkBAIC00NSw2ICs0Niw3IEBAIHN0cnVjdCBkb21haW5fY3JlYXRlIHsK
ICAgICBjb25zdCBjaGFyICpjb25maWdfZmlsZTsKICAgICBjaGFyICpleHRyYV9jb25maWc7IC8q
IGV4dHJhIGNvbmZpZyBzdHJpbmcgKi8KICAgICBjb25zdCBjaGFyICpyZXN0b3JlX2ZpbGU7Cisg
ICAgY29uc3QgY2hhciAqZG1fcmVzdG9yZV9maWxlOwogICAgIGNoYXIgKmNvbG9fcHJveHlfc2Ny
aXB0OwogICAgIGJvb2wgdXNlcnNwYWNlX2NvbG9fcHJveHk7CiAgICAgaW50IG1pZ3JhdGVfZmQ7
IC8qIC0xIG1lYW5zIG5vbmUgKi8KQEAgLTEyNyw2ICsxMjksOCBAQCBpbnQgbWFpbl9wY2lhc3Np
Z25hYmxlX3JlbW92ZShpbnQgYXJnYywgY2hhciAqKmFyZ3YpOwogaW50IG1haW5fcGNpYXNzaWdu
YWJsZV9saXN0KGludCBhcmdjLCBjaGFyICoqYXJndik7CiAjaWZuZGVmIExJQlhMX0hBVkVfTk9f
U1VTUEVORF9SRVNVTUUKIGludCBtYWluX3Jlc3RvcmUoaW50IGFyZ2MsIGNoYXIgKiphcmd2KTsK
K2ludCBtYWluX2Zvcmtfdm0oaW50IGFyZ2MsIGNoYXIgKiphcmd2KTsKK2ludCBtYWluX2Zvcmtf
bGF1bmNoX2RtKGludCBhcmdjLCBjaGFyICoqYXJndik7CiBpbnQgbWFpbl9taWdyYXRlX3JlY2Vp
dmUoaW50IGFyZ2MsIGNoYXIgKiphcmd2KTsKIGludCBtYWluX3NhdmUoaW50IGFyZ2MsIGNoYXIg
Kiphcmd2KTsKIGludCBtYWluX21pZ3JhdGUoaW50IGFyZ2MsIGNoYXIgKiphcmd2KTsKZGlmZiAt
LWdpdCBhL3Rvb2xzL3hsL3hsX2NtZHRhYmxlLmMgYi90b29scy94bC94bF9jbWR0YWJsZS5jCmlu
ZGV4IDViYWE2MDIzYWEuLjkwMmIzZDdiMDEgMTAwNjQ0Ci0tLSBhL3Rvb2xzL3hsL3hsX2NtZHRh
YmxlLmMKKysrIGIvdG9vbHMveGwveGxfY21kdGFibGUuYwpAQCAtMTgwLDYgKzE4MCwyMSBAQCBz
dHJ1Y3QgY21kX3NwZWMgY21kX3RhYmxlW10gPSB7CiAgICAgICAiLVYsIC0tdm5jdmlld2VyICAg
ICAgICAgIENvbm5lY3QgdG8gdGhlIFZOQyBkaXNwbGF5IGFmdGVyIHRoZSBkb21haW4gaXMgY3Jl
YXRlZC5cbiIKICAgICAgICItQSwgLS12bmN2aWV3ZXItYXV0b3Bhc3MgUGFzcyBWTkMgcGFzc3dv
cmQgdG8gdmlld2VyIHZpYSBzdGRpbi4iCiAgICAgfSwKKyAgICB7ICJmb3JrLXZtIiwKKyAgICAg
ICZtYWluX2Zvcmtfdm0sIDAsIDEsCisgICAgICAiRm9yayBhIGRvbWFpbiBmcm9tIHRoZSBydW5u
aW5nIHBhcmVudCBkb21pZCIsCisgICAgICAiW29wdGlvbnNdIDxQYXJlbnREb21pZD4iLAorICAg
ICAgIi1oICAgICAgICAgICAgICAgICAgICAgICBQcmludCB0aGlzIGhlbHAuXG4iCisgICAgICAi
LWQgICAgICAgICAgICAgICAgICAgICAgIEVuYWJsZSBkZWJ1ZyBtZXNzYWdlcy5cbiIKKyAgICB9
LAorICAgIHsgImZvcmstbGF1bmNoLWRtIiwKKyAgICAgICZtYWluX2ZvcmtfbGF1bmNoX2RtLCAw
LCAxLAorICAgICAgIkxhdW5jaCB0aGUgZGV2aWNlIG1vZGVsIGZvciBhIGZvcmtlZCBWTSIsCisg
ICAgICAiW29wdGlvbnNdIDxDb25maWdGaWxlPiA8RG1SZXN0b3JlRmlsZT4gPERvbWlkPiIsCisg
ICAgICAiLWggICAgICAgICAgICAgICAgICAgICAgIFByaW50IHRoaXMgaGVscC5cbiIKKyAgICAg
ICItcCAgICAgICAgICAgICAgICAgICAgICAgRG8gbm90IHVucGF1c2UgZG9tYWluIGFmdGVyIHJl
c3RvcmluZyBpdC5cbiIKKyAgICAgICItZCAgICAgICAgICAgICAgICAgICAgICAgRW5hYmxlIGRl
YnVnIG1lc3NhZ2VzLlxuIgorICAgIH0sCiAgICAgeyAibWlncmF0ZS1yZWNlaXZlIiwKICAgICAg
ICZtYWluX21pZ3JhdGVfcmVjZWl2ZSwgMCwgMSwKICAgICAgICJSZXN0b3JlIGEgZG9tYWluIGZy
b20gYSBzYXZlZCBzdGF0ZSIsCmRpZmYgLS1naXQgYS90b29scy94bC94bF9zYXZlcmVzdG9yZS5j
IGIvdG9vbHMveGwveGxfc2F2ZXJlc3RvcmUuYwppbmRleCA5YmUwMzNmZTY1Li5iYTBlMzAwZjJj
IDEwMDY0NAotLS0gYS90b29scy94bC94bF9zYXZlcmVzdG9yZS5jCisrKyBiL3Rvb2xzL3hsL3hs
X3NhdmVyZXN0b3JlLmMKQEAgLTIyOSw2ICsyMjksNzUgQEAgaW50IG1haW5fcmVzdG9yZShpbnQg
YXJnYywgY2hhciAqKmFyZ3YpCiAgICAgcmV0dXJuIEVYSVRfU1VDQ0VTUzsKIH0KIAoraW50IG1h
aW5fZm9ya192bShpbnQgYXJnYywgY2hhciAqKmFyZ3YpCit7CisgICAgaW50IGRlYnVnID0gMDsK
KyAgICB1aW50MzJfdCBwZG9taWQgPSAwLCBkb21pZCA9IElOVkFMSURfRE9NSUQ7CisgICAgaW50
IG9wdDsKKworICAgIFNXSVRDSF9GT1JFQUNIX09QVChvcHQsICJkIiwgTlVMTCwgImZvcmstdm0i
LCAxKSB7CisgICAgY2FzZSAnZCc6CisgICAgICAgIGRlYnVnID0gMTsKKyAgICAgICAgYnJlYWs7
CisgICAgfQorCisgICAgaWYgKGFyZ2Mtb3B0aW5kID09IDEpIHsKKyAgICAgICAgcGRvbWlkID0g
YXRvaShhcmd2W29wdGluZF0pOworICAgIH0gZWxzZSB7CisgICAgICAgIGhlbHAoImZvcmstdm0i
KTsKKyAgICAgICAgcmV0dXJuIEVYSVRfRkFJTFVSRTsKKyAgICB9CisKKyAgICBpZiAobGlieGxf
ZG9tYWluX2Zvcmtfdm0oY3R4LCBwZG9taWQsICZkb21pZCkgfHwgZG9taWQgPT0gSU5WQUxJRF9E
T01JRCkKKyAgICAgICAgcmV0dXJuIEVYSVRfRkFJTFVSRTsKKworICAgIGZwcmludGYoc3RkZXJy
LCAiVk0gZm9yayBjcmVhdGVkIHdpdGggZG9taWQ6ICV1XG4iLCBkb21pZCk7CisgICAgcmV0dXJu
IEVYSVRfU1VDQ0VTUzsKK30KKworaW50IG1haW5fZm9ya19sYXVuY2hfZG0oaW50IGFyZ2MsIGNo
YXIgKiphcmd2KQoreworICAgIGNvbnN0IGNoYXIgKmNvbmZpZ19maWxlID0gTlVMTDsKKyAgICBj
b25zdCBjaGFyICpkbV9yZXN0b3JlX2ZpbGUgPSBOVUxMOworICAgIHN0cnVjdCBkb21haW5fY3Jl
YXRlIGRvbV9pbmZvOworICAgIGludCBwYXVzZWQgPSAwLCBkZWJ1ZyA9IDA7CisgICAgdWludDMy
X3QgZGRvbWlkID0gMDsKKyAgICBpbnQgb3B0LCByYzsKKworICAgIFNXSVRDSF9GT1JFQUNIX09Q
VChvcHQsICJwZCIsIE5VTEwsICJmb3JrLWxhdW5jaC1kbSIsIDEpIHsKKyAgICBjYXNlICdwJzoK
KyAgICAgICAgcGF1c2VkID0gMTsKKyAgICAgICAgYnJlYWs7CisgICAgY2FzZSAnZCc6CisgICAg
ICAgIGRlYnVnID0gMTsKKyAgICAgICAgYnJlYWs7CisgICAgfQorCisgICAgaWYgKGFyZ2Mtb3B0
aW5kID09IDMpIHsKKyAgICAgICAgY29uZmlnX2ZpbGUgPSBhcmd2W29wdGluZF07CisgICAgICAg
IGRtX3Jlc3RvcmVfZmlsZSA9IGFyZ3Zbb3B0aW5kICsgMV07CisgICAgICAgIGRkb21pZCA9IGF0
b2koYXJndltvcHRpbmQgKyAyXSk7CisgICAgfSBlbHNlIHsKKyAgICAgICAgaGVscCgiZm9yay1s
YXVuY2gtZG0iKTsKKyAgICAgICAgcmV0dXJuIEVYSVRfRkFJTFVSRTsKKyAgICB9CisKKyAgICBt
ZW1zZXQoJmRvbV9pbmZvLCAwLCBzaXplb2YoZG9tX2luZm8pKTsKKyAgICBkb21faW5mby5kZG9t
aWQgPSBkZG9taWQ7CisgICAgZG9tX2luZm8uZG1fcmVzdG9yZV9maWxlID0gZG1fcmVzdG9yZV9m
aWxlOworICAgIGRvbV9pbmZvLmRlYnVnID0gZGVidWc7CisgICAgZG9tX2luZm8ucGF1c2VkID0g
cGF1c2VkOworICAgIGRvbV9pbmZvLmNvbmZpZ19maWxlID0gY29uZmlnX2ZpbGU7CisgICAgZG9t
X2luZm8ubWlncmF0ZV9mZCA9IC0xOworICAgIGRvbV9pbmZvLnNlbmRfYmFja19mZCA9IC0xOwor
CisgICAgcmMgPSBjcmVhdGVfZG9tYWluKCZkb21faW5mbyk7CisgICAgaWYgKHJjIDwgMCkKKyAg
ICAgICAgcmV0dXJuIEVYSVRfRkFJTFVSRTsKKworICAgIHJldHVybiBFWElUX1NVQ0NFU1M7Cit9
CisKIGludCBtYWluX3NhdmUoaW50IGFyZ2MsIGNoYXIgKiphcmd2KQogewogICAgIHVpbnQzMl90
IGRvbWlkOwpkaWZmIC0tZ2l0IGEvdG9vbHMveGwveGxfdm1jb250cm9sLmMgYi90b29scy94bC94
bF92bWNvbnRyb2wuYwppbmRleCBlYjY3NzlhNTYxLi5mMzJhNDcxNGVlIDEwMDY0NAotLS0gYS90
b29scy94bC94bF92bWNvbnRyb2wuYworKysgYi90b29scy94bC94bF92bWNvbnRyb2wuYwpAQCAt
NjQ1LDYgKzY0NSw3IEBAIGludCBjcmVhdGVfZG9tYWluKHN0cnVjdCBkb21haW5fY3JlYXRlICpk
b21faW5mbykKIAogICAgIGxpYnhsX2RvbWFpbl9jb25maWcgZF9jb25maWc7CiAKKyAgICB1aW50
MzJfdCBkZG9taWQgPSBkb21faW5mby0+ZGRvbWlkOyAvLyBsYXVuY2ggZG0gZm9yIHRoaXMgZG9t
YWluIGlmZiBzZXQKICAgICBpbnQgZGVidWcgPSBkb21faW5mby0+ZGVidWc7CiAgICAgaW50IGRh
ZW1vbml6ZSA9IGRvbV9pbmZvLT5kYWVtb25pemU7CiAgICAgaW50IG1vbml0b3IgPSBkb21faW5m
by0+bW9uaXRvcjsKQEAgLTY1NSw2ICs2NTYsNyBAQCBpbnQgY3JlYXRlX2RvbWFpbihzdHJ1Y3Qg
ZG9tYWluX2NyZWF0ZSAqZG9tX2luZm8pCiAgICAgY29uc3QgY2hhciAqcmVzdG9yZV9maWxlID0g
ZG9tX2luZm8tPnJlc3RvcmVfZmlsZTsKICAgICBjb25zdCBjaGFyICpjb25maWdfc291cmNlID0g
TlVMTDsKICAgICBjb25zdCBjaGFyICpyZXN0b3JlX3NvdXJjZSA9IE5VTEw7CisgICAgY29uc3Qg
Y2hhciAqZG1fcmVzdG9yZV9maWxlID0gZG9tX2luZm8tPmRtX3Jlc3RvcmVfZmlsZTsKICAgICBp
bnQgbWlncmF0ZV9mZCA9IGRvbV9pbmZvLT5taWdyYXRlX2ZkOwogICAgIGJvb2wgY29uZmlnX2lu
X2pzb247CiAKQEAgLTkyMyw2ICs5MjUsMTIgQEAgc3RhcnQ6CiAgICAgICAgICAqIHJlc3RvcmUv
bWlncmF0ZS1yZWNlaXZlIGl0IGFnYWluLgogICAgICAgICAgKi8KICAgICAgICAgcmVzdG9yaW5n
ID0gMDsKKyAgICB9IGVsc2UgaWYgKCBkZG9taWQgKSB7CisgICAgICAgIGRfY29uZmlnLmRtX3Jl
c3RvcmVfZmlsZSA9IGRtX3Jlc3RvcmVfZmlsZTsKKyAgICAgICAgcmV0ID0gbGlieGxfZG9tYWlu
X2ZvcmtfbGF1bmNoX2RtKGN0eCwgJmRfY29uZmlnLCBkZG9taWQsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvY29ubmVjdF9jb25zb2xlX2hvdyk7CisgICAg
ICAgIGRvbWlkID0gZGRvbWlkOworICAgICAgICBkZG9taWQgPSBJTlZBTElEX0RPTUlEOwogICAg
IH0gZWxzZSBpZiAoZG9taWRfc29mdF9yZXNldCAhPSBJTlZBTElEX0RPTUlEKSB7CiAgICAgICAg
IC8qIERvIHNvZnQgcmVzZXQuICovCiAgICAgICAgIHJldCA9IGxpYnhsX2RvbWFpbl9zb2Z0X3Jl
c2V0KGN0eCwgJmRfY29uZmlnLCBkb21pZF9zb2Z0X3Jlc2V0LAotLSAKMi4yMC4xCgoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxp
bmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5w
cm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id AD248C2AF3
	for <lists+xen-devel@lfdr.de>; Tue,  1 Oct 2019 01:33:06 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iF57k-0001y6-CZ; Mon, 30 Sep 2019 23:30:36 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=/D4s=XZ=kernel.org=sstabellini@srs-us1.protection.inumbo.net>)
 id 1iF57i-0001xW-L8
 for xen-devel@lists.xen.org; Mon, 30 Sep 2019 23:30:34 +0000
X-Inumbo-ID: 4c8fddba-e3da-11e9-bf31-bc764e2007e4
Received: from mail.kernel.org (unknown [198.145.29.99])
 by localhost (Halon) with ESMTPS
 id 4c8fddba-e3da-11e9-bf31-bc764e2007e4;
 Mon, 30 Sep 2019 23:30:34 +0000 (UTC)
Received: from sstabellini-ThinkPad-T480s.xilinx.com
 (c-67-164-102-47.hsd1.ca.comcast.net [67.164.102.47])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
 (No client certificate requested)
 by mail.kernel.org (Postfix) with ESMTPSA id 4B49520815;
 Mon, 30 Sep 2019 23:30:33 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
 s=default; t=1569886233;
 bh=HaY4kOXVJcylrsj+hflyHE8r5f9X6kHzwd1zKTdDOQA=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=efEMT5RPcasoj6ntE5yLfr921VbEdX2cPCL45CmbT1aCj1NhC6IWXMeEXwF8s0ust
 cprbNOQPSbSJuGJ93SX59XOWz3CxwgLAg7LmBjCAnWRqy9IpYp7vIduDDfddA+ylWR
 Rl4Mt4dqjuB3I61RSelFm9czHRxBGOQeHud0W+BQ=
From: Stefano Stabellini <sstabellini@kernel.org>
To: julien.grall@arm.com
Date: Mon, 30 Sep 2019 16:30:25 -0700
Message-Id: <20190930233032.2120-1-sstabellini@kernel.org>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <alpine.DEB.2.21.1909301628540.2594@sstabellini-ThinkPad-T480s>
References: <alpine.DEB.2.21.1909301628540.2594@sstabellini-ThinkPad-T480s>
Subject: [Xen-devel] [PATCH v7b 1/8] xen/arm: introduce
 handle_device_interrupts
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Stefano Stabellini <stefanos@xilinx.com>, sstabellini@kernel.org,
 andrii_anisov@epam.com, Achin.Gupta@arm.com, xen-devel@lists.xen.org,
 Volodymyr_Babchuk@epam.com
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

TW92ZSB0aGUgaW50ZXJydXB0IGhhbmRsaW5nIGNvZGUgb3V0IG9mIGhhbmRsZV9kZXZpY2UgdG8g
YSBuZXcgZnVuY3Rpb24Kc28gdGhhdCBpdCBjYW4gYmUgcmV1c2VkIGZvciBkb20wbGVzcyBWTXMg
KGl0IHdpbGwgYmUgdXNlZCBpbiBsYXRlcgpwYXRjaGVzKS4KClNpZ25lZC1vZmYtYnk6IFN0ZWZh
bm8gU3RhYmVsbGluaSA8c3RlZmFub3NAeGlsaW54LmNvbT4KQWNrZWQtYnk6IEp1bGllbiBHcmFs
bCA8anVsaWVuLmdyYWxsQGFybS5jb20+Ci0tLQpDaGFuZ2VzIGluIHY0OgotIHJlbmFtZSBoYW5k
bGVfaW50ZXJydXB0cyB0byBoYW5kbGVfZGV2aWNlX2ludGVycnVwdHMKLSBpbXByb3ZlIGluLWNv
ZGUgY29tbWVudAotIHJlbW92ZSByZXR1cm4gMSBpZiBtYXBwaW5nIGlzIGRvbmUKLSB1c2UgdW5z
aWduZWQKCkNoYW5nZXMgaW4gdjM6Ci0gYWRkIHBhdGNoCgpUaGUgZGlmZiBpcyBoYXJkIHRvIHJl
YWQgYnV0IEkganVzdCBtb3ZlZCB0aGUgaW50ZXJydXB0cyByZWxhdGVkIGNvZGUKZnJvbSBoYW5k
bGVfZGV2aWNlcyB0byBhIG5ldyBmdW5jdGlvbiBoYW5kbGVfZGV2aWNlX2ludGVycnVwdHMsIGFu
ZCB2ZXJ5CmxpdHRsZSBlbHNlLgotLS0KIHhlbi9hcmNoL2FybS9kb21haW5fYnVpbGQuYyB8IDEw
MCArKysrKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCA2
MSBpbnNlcnRpb25zKCspLCAzOSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS94ZW4vYXJjaC9h
cm0vZG9tYWluX2J1aWxkLmMgYi94ZW4vYXJjaC9hcm0vZG9tYWluX2J1aWxkLmMKaW5kZXggMzM3
YTg5ZTUxOC4uZmIzNTY2MDNlMiAxMDA2NDQKLS0tIGEveGVuL2FyY2gvYXJtL2RvbWFpbl9idWls
ZC5jCisrKyBiL3hlbi9hcmNoL2FybS9kb21haW5fYnVpbGQuYwpAQCAtMTIzOCw2ICsxMjM4LDYy
IEBAIHN0YXRpYyBpbnQgX19pbml0IG1hcF9kZXZpY2VfY2hpbGRyZW4oc3RydWN0IGRvbWFpbiAq
ZCwKICAgICByZXR1cm4gMDsKIH0KIAorLyoKKyAqIGhhbmRsZV9kZXZpY2VfaW50ZXJydXB0cyBy
ZXRyaWV2ZXMgdGhlIGludGVycnVwdHMgY29uZmlndXJhdGlvbiBmcm9tCisgKiBhIGRldmljZSB0
cmVlIG5vZGUgYW5kIG1hcHMgdGhvc2UgaW50ZXJydXB0cyB0byB0aGUgdGFyZ2V0IGRvbWFpbi4K
KyAqCisgKiBSZXR1cm5zOgorICogICA8IDAgZXJyb3IKKyAqICAgMCAgIHN1Y2Nlc3MKKyAqLwor
c3RhdGljIGludCBfX2luaXQgaGFuZGxlX2RldmljZV9pbnRlcnJ1cHRzKHN0cnVjdCBkb21haW4g
KmQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGR0
X2RldmljZV9ub2RlICpkZXYsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgYm9vbCBuZWVkX21hcHBpbmcpCit7CisgICAgdW5zaWduZWQgaW50IGksIG5pcnE7Cisg
ICAgaW50IHJlczsKKyAgICBzdHJ1Y3QgZHRfcmF3X2lycSByaXJxOworCisgICAgbmlycSA9IGR0
X251bWJlcl9vZl9pcnEoZGV2KTsKKworICAgIC8qIEdpdmUgcGVybWlzc2lvbiBhbmQgbWFwIElS
UXMgKi8KKyAgICBmb3IgKCBpID0gMDsgaSA8IG5pcnE7IGkrKyApCisgICAgeworICAgICAgICBy
ZXMgPSBkdF9kZXZpY2VfZ2V0X3Jhd19pcnEoZGV2LCBpLCAmcmlycSk7CisgICAgICAgIGlmICgg
cmVzICkKKyAgICAgICAgeworICAgICAgICAgICAgcHJpbnRrKFhFTkxPR19FUlIgIlVuYWJsZSB0
byByZXRyaWV2ZSBpcnEgJXUgZm9yICVzXG4iLAorICAgICAgICAgICAgICAgICAgIGksIGR0X25v
ZGVfZnVsbF9uYW1lKGRldikpOworICAgICAgICAgICAgcmV0dXJuIHJlczsKKyAgICAgICAgfQor
CisgICAgICAgIC8qCisgICAgICAgICAqIERvbid0IG1hcCBJUlEgdGhhdCBoYXZlIG5vIHBoeXNp
Y2FsIG1lYW5pbmcKKyAgICAgICAgICogaWU6IElSUSB3aG9zZSBjb250cm9sbGVyIGlzIG5vdCB0
aGUgR0lDCisgICAgICAgICAqLworICAgICAgICBpZiAoIHJpcnEuY29udHJvbGxlciAhPSBkdF9p
bnRlcnJ1cHRfY29udHJvbGxlciApCisgICAgICAgIHsKKyAgICAgICAgICAgIGR0X2RwcmludGso
ImlycSAldSBub3QgY29ubmVjdGVkIHRvIHByaW1hcnkgY29udHJvbGxlci4gQ29ubmVjdGVkIHRv
ICVzXG4iLAorICAgICAgICAgICAgICAgICAgICAgIGksIGR0X25vZGVfZnVsbF9uYW1lKHJpcnEu
Y29udHJvbGxlcikpOworICAgICAgICAgICAgY29udGludWU7CisgICAgICAgIH0KKworICAgICAg
ICByZXMgPSBwbGF0Zm9ybV9nZXRfaXJxKGRldiwgaSk7CisgICAgICAgIGlmICggcmVzIDwgMCAp
CisgICAgICAgIHsKKyAgICAgICAgICAgIHByaW50ayhYRU5MT0dfRVJSICJVbmFibGUgdG8gZ2V0
IGlycSAldSBmb3IgJXNcbiIsCisgICAgICAgICAgICAgICAgICAgaSwgZHRfbm9kZV9mdWxsX25h
bWUoZGV2KSk7CisgICAgICAgICAgICByZXR1cm4gcmVzOworICAgICAgICB9CisKKyAgICAgICAg
cmVzID0gbWFwX2lycV90b19kb21haW4oZCwgcmVzLCBuZWVkX21hcHBpbmcsIGR0X25vZGVfbmFt
ZShkZXYpKTsKKyAgICAgICAgaWYgKCByZXMgKQorICAgICAgICAgICAgcmV0dXJuIHJlczsKKyAg
ICB9CisKKyAgICByZXR1cm4gMDsKK30KKwogLyoKICAqIEZvciBhIGdpdmVuIGRldmljZSBub2Rl
OgogICogIC0gR2l2ZSBwZXJtaXNzaW9uIHRvIHRoZSBndWVzdCB0byBtYW5hZ2UgSVJRIGFuZCBN
TUlPIHJhbmdlCkBAIC0xMjUwLDE5ICsxMzA2LDE2IEBAIHN0YXRpYyBpbnQgX19pbml0IG1hcF9k
ZXZpY2VfY2hpbGRyZW4oc3RydWN0IGRvbWFpbiAqZCwKIHN0YXRpYyBpbnQgX19pbml0IGhhbmRs
ZV9kZXZpY2Uoc3RydWN0IGRvbWFpbiAqZCwgc3RydWN0IGR0X2RldmljZV9ub2RlICpkZXYsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAybV90eXBlX3QgcDJtdCkKIHsKLSAgICB1
bnNpZ25lZCBpbnQgbmlycTsKICAgICB1bnNpZ25lZCBpbnQgbmFkZHI7CiAgICAgdW5zaWduZWQg
aW50IGk7CiAgICAgaW50IHJlczsKLSAgICBzdHJ1Y3QgZHRfcmF3X2lycSByaXJxOwogICAgIHU2
NCBhZGRyLCBzaXplOwogICAgIGJvb2wgbmVlZF9tYXBwaW5nID0gIWR0X2RldmljZV9mb3JfcGFz
c3Rocm91Z2goZGV2KTsKIAotICAgIG5pcnEgPSBkdF9udW1iZXJfb2ZfaXJxKGRldik7CiAgICAg
bmFkZHIgPSBkdF9udW1iZXJfb2ZfYWRkcmVzcyhkZXYpOwogCi0gICAgZHRfZHByaW50aygiJXMg
cGFzc3Rocm91Z2ggPSAlZCBuaXJxID0gJWQgbmFkZHIgPSAldVxuIiwKLSAgICAgICAgICAgICAg
IGR0X25vZGVfZnVsbF9uYW1lKGRldiksIG5lZWRfbWFwcGluZywgbmlycSwgbmFkZHIpOworICAg
IGR0X2RwcmludGsoIiVzIHBhc3N0aHJvdWdoID0gJWQgbmFkZHIgPSAldVxuIiwKKyAgICAgICAg
ICAgICAgIGR0X25vZGVfZnVsbF9uYW1lKGRldiksIG5lZWRfbWFwcGluZywgbmFkZHIpOwogCiAg
ICAgaWYgKCBuZWVkX21hcHBpbmcgKQogICAgIHsKQEAgLTEyOTAsNDAgKzEzNDMsOSBAQCBzdGF0
aWMgaW50IF9faW5pdCBoYW5kbGVfZGV2aWNlKHN0cnVjdCBkb21haW4gKmQsIHN0cnVjdCBkdF9k
ZXZpY2Vfbm9kZSAqZGV2LAogICAgICAgICB9CiAgICAgfQogCi0gICAgLyogR2l2ZSBwZXJtaXNz
aW9uIGFuZCBtYXAgSVJRcyAqLwotICAgIGZvciAoIGkgPSAwOyBpIDwgbmlycTsgaSsrICkKLSAg
ICB7Ci0gICAgICAgIHJlcyA9IGR0X2RldmljZV9nZXRfcmF3X2lycShkZXYsIGksICZyaXJxKTsK
LSAgICAgICAgaWYgKCByZXMgKQotICAgICAgICB7Ci0gICAgICAgICAgICBwcmludGsoWEVOTE9H
X0VSUiAiVW5hYmxlIHRvIHJldHJpZXZlIGlycSAldSBmb3IgJXNcbiIsCi0gICAgICAgICAgICAg
ICAgICAgaSwgZHRfbm9kZV9mdWxsX25hbWUoZGV2KSk7Ci0gICAgICAgICAgICByZXR1cm4gcmVz
OwotICAgICAgICB9Ci0KLSAgICAgICAgLyoKLSAgICAgICAgICogRG9uJ3QgbWFwIElSUSB0aGF0
IGhhdmUgbm8gcGh5c2ljYWwgbWVhbmluZwotICAgICAgICAgKiBpZTogSVJRIHdob3NlIGNvbnRy
b2xsZXIgaXMgbm90IHRoZSBHSUMKLSAgICAgICAgICovCi0gICAgICAgIGlmICggcmlycS5jb250
cm9sbGVyICE9IGR0X2ludGVycnVwdF9jb250cm9sbGVyICkKLSAgICAgICAgewotICAgICAgICAg
ICAgZHRfZHByaW50aygiaXJxICV1IG5vdCBjb25uZWN0ZWQgdG8gcHJpbWFyeSBjb250cm9sbGVy
LiBDb25uZWN0ZWQgdG8gJXNcbiIsCi0gICAgICAgICAgICAgICAgICAgICAgaSwgZHRfbm9kZV9m
dWxsX25hbWUocmlycS5jb250cm9sbGVyKSk7Ci0gICAgICAgICAgICBjb250aW51ZTsKLSAgICAg
ICAgfQotCi0gICAgICAgIHJlcyA9IHBsYXRmb3JtX2dldF9pcnEoZGV2LCBpKTsKLSAgICAgICAg
aWYgKCByZXMgPCAwICkKLSAgICAgICAgewotICAgICAgICAgICAgcHJpbnRrKFhFTkxPR19FUlIg
IlVuYWJsZSB0byBnZXQgaXJxICV1IGZvciAlc1xuIiwKLSAgICAgICAgICAgICAgICAgICBpLCBk
dF9ub2RlX2Z1bGxfbmFtZShkZXYpKTsKLSAgICAgICAgICAgIHJldHVybiByZXM7Ci0gICAgICAg
IH0KLQotICAgICAgICByZXMgPSBtYXBfaXJxX3RvX2RvbWFpbihkLCByZXMsIG5lZWRfbWFwcGlu
ZywgZHRfbm9kZV9uYW1lKGRldikpOwotICAgICAgICBpZiAoIHJlcyApCi0gICAgICAgICAgICBy
ZXR1cm4gcmVzOwotICAgIH0KKyAgICByZXMgPSBoYW5kbGVfZGV2aWNlX2ludGVycnVwdHMoZCwg
ZGV2LCBuZWVkX21hcHBpbmcpOworICAgIGlmICggcmVzIDwgMCApCisgICAgICAgIHJldHVybiBy
ZXM7CiAKICAgICAvKiBHaXZlIHBlcm1pc3Npb24gYW5kIG1hcCBNTUlPcyAqLwogICAgIGZvciAo
IGkgPSAwOyBpIDwgbmFkZHI7IGkrKyApCi0tIAoyLjE3LjEKCgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1k
ZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21h
aWxtYW4vbGlzdGluZm8veGVuLWRldmVs

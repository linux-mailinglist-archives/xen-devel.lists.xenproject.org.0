Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 1626FB7A72
	for <lists+xen-devel@lfdr.de>; Thu, 19 Sep 2019 15:27:04 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iAwQt-000095-3H; Thu, 19 Sep 2019 13:25:15 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=5hYN=XO=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1iAwQs-00008o-2i
 for xen-devel@lists.xenproject.org; Thu, 19 Sep 2019 13:25:14 +0000
X-Inumbo-ID: e82d5cb5-dae0-11e9-965d-12813bfff9fa
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id e82d5cb5-dae0-11e9-965d-12813bfff9fa;
 Thu, 19 Sep 2019 13:25:12 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 127BDAFB1;
 Thu, 19 Sep 2019 13:25:12 +0000 (UTC)
From: Jan Beulich <jbeulich@suse.com>
To: "xen-devel@lists.xenproject.org" <xen-devel@lists.xenproject.org>
References: <aa62726c-5aa4-8bcd-dc35-61eb8dfeaee3@suse.com>
Message-ID: <c5d2eaf3-77f6-f87e-6898-c4c475f607c1@suse.com>
Date: Thu, 19 Sep 2019 15:25:20 +0200
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:60.0) Gecko/20100101
 Thunderbird/60.9.0
MIME-Version: 1.0
In-Reply-To: <aa62726c-5aa4-8bcd-dc35-61eb8dfeaee3@suse.com>
Content-Language: en-US
Subject: [Xen-devel] [PATCH v6 8/8] AMD/IOMMU: pre-fill all DTEs right after
 table allocation
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>,
 Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

TWFrZSBzdXJlIHdlIGRvbid0IGxlYXZlIGFueSBEVEVzIHVuZXhwZWN0ZWQgcmVxdWVzdHMgdGhy
b3VnaCB3aGljaAp3b3VsZCBiZSBwYXNzZWQgdGhyb3VnaCB1bnRyYW5zbGF0ZWQuIFNldCBWIGFu
ZCBJViByaWdodCBhd2F5ICh3aXRoCmFsbCBvdGhlciBmaWVsZHMgbGVmdCBhcyB6ZXJvKSwgcmVs
eWluZyBvbiB0aGUgViBhbmQvb3IgSVYgYml0cwpnZXR0aW5nIGNsZWFyZWQgb25seSBieSBhbWRf
aW9tbXVfc2V0X3Jvb3RfcGFnZV90YWJsZSgpIGFuZAphbWRfaW9tbXVfc2V0X2ludHJlbWFwX3Rh
YmxlKCkgdW5kZXIgc3BlY2lhbCBwYXNzLXRocm91Z2ggY2lyY3Vtc3RhbmNlcy4KU3dpdGNoIGJh
Y2sgdG8gaW5pdGlhbCBzZXR0aW5ncyBpbiBhbWRfaW9tbXVfZGlzYWJsZV9kb21haW5fZGV2aWNl
KCkuCgpUYWtlIHRoZSBsaWJlcnR5IGFuZCBhbHNvIG1ha2UgdGhlIGxhdHRlciBmdW5jdGlvbiBz
dGF0aWMsIGNvbnN0aWZ5aW5nCml0cyBmaXJzdCBwYXJhbWV0ZXIgYXQgdGhlIHNhbWUgdGltZSwg
YXQgdGhpcyBvY2Nhc2lvbi4KClNpZ25lZC1vZmYtYnk6IEphbiBCZXVsaWNoIDxqYmV1bGljaEBz
dXNlLmNvbT4KLS0tCnY2OiBOZXcuCgotLS0KIHhlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9p
b21tdV9pbml0LmMgICAgfCAgIDIyICsrKysrKysrKysrKysrKysrKystLS0KIHhlbi9kcml2ZXJz
L3Bhc3N0aHJvdWdoL2FtZC9wY2lfYW1kX2lvbW11LmMgfCAgIDIwICsrKysrKysrKysrKysrKyst
LS0tCiAyIGZpbGVzIGNoYW5nZWQsIDM1IGluc2VydGlvbnMoKyksIDcgZGVsZXRpb25zKC0pCgot
LS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfaW5pdC5jCisrKyBiL3hlbi9k
cml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9pb21tdV9pbml0LmMKQEAgLTEyNTUsMTIgKzEyNTUsMjgg
QEAgc3RhdGljIGludCBfX2luaXQgYW1kX2lvbW11X3NldHVwX2RldmljZQogCiAgICAgaWYgKCAh
ZHQgKQogICAgIHsKKyAgICAgICAgdW5zaWduZWQgaW50IHNpemUgPSBkdF9hbGxvY19zaXplKCk7
CisKICAgICAgICAgLyogYWxsb2NhdGUgJ2RldmljZSB0YWJsZScgb24gYSA0SyBib3VuZGFyeSAq
LwogICAgICAgICBkdCA9IElWUlNfTUFQUElOR1NfREVWVEFCKGl2cnNfbWFwcGluZ3MpID0KLSAg
ICAgICAgICAgIGFsbG9jYXRlX2J1ZmZlcihkdF9hbGxvY19zaXplKCksICJEZXZpY2UgVGFibGUi
KTsKKyAgICAgICAgICAgIGFsbG9jYXRlX2J1ZmZlcihzaXplLCAiRGV2aWNlIFRhYmxlIik7Cisg
ICAgICAgIGlmICggIWR0ICkKKyAgICAgICAgICAgIHJldHVybiAtRU5PTUVNOworCisgICAgICAg
IC8qCisgICAgICAgICAqIFByZWZpbGwgZXZlcnkgRFRFIHN1Y2ggdGhhdCBhbGwga2luZHMgb2Yg
cmVxdWVzdHMgd2lsbCBnZXQgYWJvcnRlZC4KKyAgICAgICAgICogQmVzaWRlcyB0aGUgdHdvIGJp
dHMgc2V0IHRvIHRydWUgYmVsb3cgdGhpcyBidWlsZHMgdXBvbgorICAgICAgICAgKiBJT01NVV9E
RVZfVEFCTEVfU1lTX01HVF9ETUFfQUJPUlRFRCwKKyAgICAgICAgICogSU9NTVVfREVWX1RBQkxF
X0lPX0NPTlRST0xfQUJPUlRFRCwgYXMgd2VsbCBhcworICAgICAgICAgKiBJT01NVV9ERVZfVEFC
TEVfSU5UX0NPTlRST0xfQUJPUlRFRCBhbGwgYmVpbmcgemVybywgYW5kIHVzIGFsc28KKyAgICAg
ICAgICogd2FudGluZyBhdCBsZWFzdCBUViwgR1YsIEksIGFuZCBFWCBzZXQgdG8gZmFsc2UuCisg
ICAgICAgICAqLworICAgICAgICBmb3IgKCBiZGYgPSAwLCBzaXplIC89IHNpemVvZigqZHQpOyBi
ZGYgPCBzaXplOyArK2JkZiApCisgICAgICAgIHsKKyAgICAgICAgICAgIGR0W2JkZl0udiA9IHRy
dWU7CisgICAgICAgICAgICBkdFtiZGZdLml2ID0gdHJ1ZTsKKyAgICAgICAgfQogICAgIH0KLSAg
ICBpZiAoICFkdCApCi0gICAgICAgIHJldHVybiAtRU5PTUVNOwogCiAgICAgLyogQWRkIGRldmlj
ZSB0YWJsZSBlbnRyaWVzICovCiAgICAgZm9yICggYmRmID0gMDsgYmRmIDwgaXZyc19iZGZfZW50
cmllczsgYmRmKysgKQotLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvcGNpX2FtZF9p
b21tdS5jCisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9wY2lfYW1kX2lvbW11LmMK
QEAgLTI2Nyw5ICsyNjcsOSBAQCBzdGF0aWMgdm9pZCBfX2h3ZG9tX2luaXQgYW1kX2lvbW11X2h3
ZG9tCiAgICAgc2V0dXBfaHdkb21fcGNpX2RldmljZXMoZCwgYW1kX2lvbW11X2FkZF9kZXZpY2Up
OwogfQogCi12b2lkIGFtZF9pb21tdV9kaXNhYmxlX2RvbWFpbl9kZXZpY2Uoc3RydWN0IGRvbWFp
biAqZG9tYWluLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBh
bWRfaW9tbXUgKmlvbW11LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHU4
IGRldmZuLCBzdHJ1Y3QgcGNpX2RldiAqcGRldikKK3N0YXRpYyB2b2lkIGFtZF9pb21tdV9kaXNh
YmxlX2RvbWFpbl9kZXZpY2UoY29uc3Qgc3RydWN0IGRvbWFpbiAqZG9tYWluLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgYW1kX2lvbW11ICppb21t
dSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDhfdCBk
ZXZmbiwgc3RydWN0IHBjaV9kZXYgKnBkZXYpCiB7CiAgICAgc3RydWN0IGFtZF9pb21tdV9kdGUg
KnRhYmxlLCAqZHRlOwogICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7CkBAIC0yODQsOSArMjg0LDIx
IEBAIHZvaWQgYW1kX2lvbW11X2Rpc2FibGVfZG9tYWluX2RldmljZShzdHIKICAgICBzcGluX2xv
Y2tfaXJxc2F2ZSgmaW9tbXUtPmxvY2ssIGZsYWdzKTsKICAgICBpZiAoIGR0ZS0+dHYgfHwgZHRl
LT52ICkKICAgICB7CisgICAgICAgIC8qIFNlZSB0aGUgY29tbWVudCBpbiBhbWRfaW9tbXVfc2V0
dXBfZGV2aWNlX3RhYmxlKCkuICovCisgICAgICAgIGR0ZS0+aW50X2N0bCA9IElPTU1VX0RFVl9U
QUJMRV9JTlRfQ09OVFJPTF9BQk9SVEVEOworICAgICAgICBzbXBfd21iKCk7CisgICAgICAgIGR0
ZS0+aXYgPSB0cnVlOwogICAgICAgICBkdGUtPnR2ID0gZmFsc2U7Ci0gICAgICAgIGR0ZS0+diA9
IGZhbHNlOworICAgICAgICBkdGUtPmd2ID0gZmFsc2U7CiAgICAgICAgIGR0ZS0+aSA9IGZhbHNl
OworICAgICAgICBkdGUtPmV4ID0gZmFsc2U7CisgICAgICAgIGR0ZS0+c2EgPSBmYWxzZTsKKyAg
ICAgICAgZHRlLT5zZSA9IGZhbHNlOworICAgICAgICBkdGUtPnNkID0gZmFsc2U7CisgICAgICAg
IGR0ZS0+c3lzX21ndCA9IElPTU1VX0RFVl9UQUJMRV9TWVNfTUdUX0RNQV9BQk9SVEVEOworICAg
ICAgICBkdGUtPmlvY3RsID0gSU9NTVVfREVWX1RBQkxFX0lPX0NPTlRST0xfQUJPUlRFRDsKKyAg
ICAgICAgc21wX3dtYigpOworICAgICAgICBkdGUtPnYgPSB0cnVlOwogCiAgICAgICAgIGFtZF9p
b21tdV9mbHVzaF9kZXZpY2UoaW9tbXUsIHJlcV9pZCk7CiAKCgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1k
ZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21h
aWxtYW4vbGlzdGluZm8veGVuLWRldmVs

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 1B26814F0D7
	for <lists+xen-devel@lfdr.de>; Fri, 31 Jan 2020 17:47:48 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1ixZPh-0000CA-A6; Fri, 31 Jan 2020 16:45:01 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=r7oN=3U=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1ixZPf-0000Bl-Ak
 for xen-devel@lists.xenproject.org; Fri, 31 Jan 2020 16:44:59 +0000
X-Inumbo-ID: 03d83458-4449-11ea-b211-bc764e2007e4
Received: from mx2.suse.de (unknown [195.135.220.15])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 03d83458-4449-11ea-b211-bc764e2007e4;
 Fri, 31 Jan 2020 16:44:58 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx2.suse.de (Postfix) with ESMTP id 5052AAD3C;
 Fri, 31 Jan 2020 16:44:57 +0000 (UTC)
From: Jan Beulich <jbeulich@suse.com>
To: "xen-devel@lists.xenproject.org" <xen-devel@lists.xenproject.org>
References: <d9ac8ea4-9f2a-93d5-7656-48d93930ed2e@suse.com>
Message-ID: <2c9ef202-a878-ab7b-5bfc-f9738d52d291@suse.com>
Date: Fri, 31 Jan 2020 17:45:00 +0100
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:68.0) Gecko/20100101
 Thunderbird/68.4.2
MIME-Version: 1.0
In-Reply-To: <d9ac8ea4-9f2a-93d5-7656-48d93930ed2e@suse.com>
Content-Language: en-US
Subject: [Xen-devel] [PATCH v4 5/7] x86/mm: use cache in guest_walk_tables()
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Wei Liu <wl@xen.org>, Paul Durrant <paul@xen.org>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>, Tim Deegan <tim@xen.org>,
 =?UTF-8?Q?Roger_Pau_Monn=c3=a9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

RW11bGF0aW9uIHJlcXVpcmluZyBkZXZpY2UgbW9kZWwgYXNzaXN0YW5jZSB1c2VzIGEgZm9ybSBv
ZiBpbnN0cnVjdGlvbgpyZS1leGVjdXRpb24sIGFzc3VtaW5nIHRoYXQgdGhlIHNlY29uZCAoYW5k
IGFueSBmdXJ0aGVyKSBwYXNzIHRha2VzCmV4YWN0bHkgdGhlIHNhbWUgcGF0aC4gVGhpcyBpcyBh
IHZhbGlkIGFzc3VtcHRpb24gYXMgZmFyIGFzIHVzZSBvZiBDUFUKcmVnaXN0ZXJzIGdvZXMgKGFz
IHRob3NlIGNhbid0IGNoYW5nZSB3aXRob3V0IGFueSBvdGhlciBpbnN0cnVjdGlvbgpleGVjdXRp
bmcgaW4gYmV0d2VlbiksIGJ1dCBpcyB3cm9uZyBmb3IgbWVtb3J5IGFjY2Vzc2VzLiBJbiBwYXJ0
aWN1bGFyCml0IGhhcyBiZWVuIG9ic2VydmVkIHRoYXQgV2luZG93cyBtaWdodCBwYWdlIG91dCBi
dWZmZXJzIHVuZGVybmVhdGggYW4KaW5zdHJ1Y3Rpb24gY3VycmVudGx5IHVuZGVyIGVtdWxhdGlv
biAoaGl0dGluZyBiZXR3ZWVuIHR3byBwYXNzZXMpLiBJZgp0aGUgZmlyc3QgcGFzcyB0cmFuc2xh
dGVkIGEgbGluZWFyIGFkZHJlc3Mgc3VjY2Vzc2Z1bGx5LCBhbnkgc3Vic2VxdWVudApwYXNzIG5l
ZWRzIHRvIGRvIHNvIHRvbywgeWllbGRpbmcgdGhlIGV4YWN0IHNhbWUgdHJhbnNsYXRpb24uIFRv
Cmd1YXJhbnRlZSB0aGlzLCBsZXZlcmFnZSB0aGUgY2FjaGluZyB0aGF0IG5vdyBiYWNrcyBIVk0g
aW5zbiBlbXVsYXRpb24uCgpTaWduZWQtb2ZmLWJ5OiBKYW4gQmV1bGljaCA8amJldWxpY2hAc3Vz
ZS5jb20+Ci0tLQp2NDogQWRqdXN0IGZvciBjYWNoZSBub3cgKGVsc2V3aGVyZSkgYmVpbmcgdHJh
bnNwYXJlbnQgdG8gY2FsbGVycy4KICAgIFByb3ZpZGUgaW5saW5lIHN0dWJzIGZvciB0aGUgIUhW
TSBjYXNlLgp2MjogRG9uJ3Qgd3JvbmdseSB1c2UgdG9wX2dmbiBmb3Igbm9uLXJvb3QgZ3BhIGNh
bGN1bGF0aW9uLiBSZS13cml0ZQogICAgY2FjaGUgZW50cmllcyBhZnRlciBzZXR0aW5nIEEvRCBi
aXRzIChhbiBhbHRlcm5hdGl2ZSB3b3VsZCBiZSB0bwogICAgc3VwcHJlc3MgdGhlaXIgc2V0dGlu
ZyB1cG9uIGNhY2hlIGhpdHMpLgoKLS0tIGEveGVuL2FyY2gveDg2L2h2bS9lbXVsYXRlLmMKKysr
IGIveGVuL2FyY2gveDg2L2h2bS9lbXVsYXRlLmMKQEAgLTI5MTgsNyArMjkxOCw3IEBAIGJvb2wg
aHZtZW11bF9yZWFkX2NhY2hlKGNvbnN0IHN0cnVjdCB2Y3AKICAgICB1bnNpZ25lZCBpbnQgaTsK
IAogICAgIC8qIENhY2hlIHVuYXZhaWxhYmxlPyAqLwotICAgIGlmICggY2FjaGUtPm51bV9lbnRz
ID4gY2FjaGUtPm1heF9lbnRzICkKKyAgICBpZiAoICFpc19odm1fdmNwdSh2KSB8fCBjYWNoZS0+
bnVtX2VudHMgPiBjYWNoZS0+bWF4X2VudHMgKQogICAgICAgICByZXR1cm4gZmFsc2U7CiAKICAg
ICB3aGlsZSAoIHNpemUgPiBzaXplb2YoY2FjaGUtPmVudHMtPmRhdGEpICkKQEAgLTI5NTAsNyAr
Mjk1MCw3IEBAIHZvaWQgaHZtZW11bF93cml0ZV9jYWNoZShjb25zdCBzdHJ1Y3QgdmMKICAgICB1
bnNpZ25lZCBpbnQgaTsKIAogICAgIC8qIENhY2hlIHVuYXZhaWxhYmxlPyAqLwotICAgIGlmICgg
Y2FjaGUtPm51bV9lbnRzID4gY2FjaGUtPm1heF9lbnRzICkKKyAgICBpZiAoICFpc19odm1fdmNw
dSh2KSB8fCBjYWNoZS0+bnVtX2VudHMgPiBjYWNoZS0+bWF4X2VudHMgKQogICAgICAgICByZXR1
cm47CiAKICAgICB3aGlsZSAoIHNpemUgPiBzaXplb2YoY2FjaGUtPmVudHMtPmRhdGEpICkKLS0t
IGEveGVuL2FyY2gveDg2L21tL2d1ZXN0X3dhbGsuYworKysgYi94ZW4vYXJjaC94ODYvbW0vZ3Vl
c3Rfd2Fsay5jCkBAIC0zMSw2ICszMSw3IEBAIGFzbSgiLmZpbGUgXCIiIF9fT0JKRUNUX0ZJTEVf
XyAiXCIiKTsKICNpbmNsdWRlIDx4ZW4vc2NoZWQuaD4KICNpbmNsdWRlIDxhc20vcGFnZS5oPgog
I2luY2x1ZGUgPGFzbS9ndWVzdF9wdC5oPgorI2luY2x1ZGUgPGFzbS9odm0vZW11bGF0ZS5oPgog
CiAvKgogICogTW9kaWZ5IGEgZ3Vlc3QgcGFnZXRhYmxlIGVudHJ5IHRvIHNldCB0aGUgQWNjZXNz
ZWQgYW5kIERpcnR5IGJpdHMuCkBAIC04MCw5ICs4MSw5IEBAIHN0YXRpYyBib29sIHNldF9hZF9i
aXRzKGd1ZXN0X2ludHB0ZV90ICoKICAqIHJlcXVlc3RlZCB3YWxrLCB0byBzZWUgd2hldGhlciB0
aGUgYWNjZXNzIGlzIHBlcm1pdHRlZC4KICAqLwogYm9vbAotZ3Vlc3Rfd2Fsa190YWJsZXMoc3Ry
dWN0IHZjcHUgKnYsIHN0cnVjdCBwMm1fZG9tYWluICpwMm0sCi0gICAgICAgICAgICAgICAgICB1
bnNpZ25lZCBsb25nIHZhLCB3YWxrX3QgKmd3LAotICAgICAgICAgICAgICAgICAgdWludDMyX3Qg
d2FsaywgbWZuX3QgdG9wX21mbiwgdm9pZCAqdG9wX21hcCkKK2d1ZXN0X3dhbGtfdGFibGVzKGNv
bnN0IHN0cnVjdCB2Y3B1ICp2LCBzdHJ1Y3QgcDJtX2RvbWFpbiAqcDJtLAorICAgICAgICAgICAg
ICAgICAgdW5zaWduZWQgbG9uZyB2YSwgd2Fsa190ICpndywgdWludDMyX3Qgd2FsaywKKyAgICAg
ICAgICAgICAgICAgIGdmbl90IHRvcF9nZm4sIG1mbl90IHRvcF9tZm4sIHZvaWQgKnRvcF9tYXAp
CiB7CiAgICAgc3RydWN0IGRvbWFpbiAqZCA9IHYtPmRvbWFpbjsKICAgICBwMm1fdHlwZV90IHAy
bXQ7CkBAIC05MSw4ICs5MiwxMyBAQCBndWVzdF93YWxrX3RhYmxlcyhzdHJ1Y3QgdmNwdSAqdiwg
c3RydWN0CiAjaWYgR1VFU1RfUEFHSU5HX0xFVkVMUyA+PSA0IC8qIDY0LWJpdCBvbmx5Li4uICov
CiAgICAgZ3Vlc3RfbDNlX3QgKmwzcCA9IE5VTEw7CiAgICAgZ3Vlc3RfbDRlX3QgKmw0cDsKKyAg
ICBwYWRkcl90IGw0Z3BhOworI2VuZGlmCisjaWYgR1VFU1RfUEFHSU5HX0xFVkVMUyA+PSAzIC8q
IFBBRSBvciA2NC4uLiAqLworICAgIHBhZGRyX3QgbDNncGE7CiAjZW5kaWYKICAgICB1aW50MzJf
dCBnZmxhZ3MsIHJjOworICAgIHBhZGRyX3QgbDFncGEgPSAwLCBsMmdwYSA9IDA7CiAgICAgdW5z
aWduZWQgaW50IGxlYWZfbGV2ZWw7CiAgICAgcDJtX3F1ZXJ5X3QgcXQgPSBQMk1fQUxMT0MgfCBQ
Mk1fVU5TSEFSRTsKIApAQCAtMTMzLDcgKzEzOSwxMyBAQCBndWVzdF93YWxrX3RhYmxlcyhzdHJ1
Y3QgdmNwdSAqdiwgc3RydWN0CiAgICAgLyogR2V0IHRoZSBsNGUgZnJvbSB0aGUgdG9wIGxldmVs
IHRhYmxlIGFuZCBjaGVjayBpdHMgZmxhZ3MqLwogICAgIGd3LT5sNG1mbiA9IHRvcF9tZm47CiAg
ICAgbDRwID0gKGd1ZXN0X2w0ZV90ICopIHRvcF9tYXA7Ci0gICAgZ3ctPmw0ZSA9IGw0cFtndWVz
dF9sNF90YWJsZV9vZmZzZXQodmEpXTsKKyAgICBsNGdwYSA9IGdmbl90b19nYWRkcih0b3BfZ2Zu
KSArCisgICAgICAgICAgICBndWVzdF9sNF90YWJsZV9vZmZzZXQodmEpICogc2l6ZW9mKGd3LT5s
NGUpOworICAgIGlmICggIWh2bWVtdWxfcmVhZF9jYWNoZSh2LCBsNGdwYSwgJmd3LT5sNGUsIHNp
emVvZihndy0+bDRlKSkgKQorICAgIHsKKyAgICAgICAgZ3ctPmw0ZSA9IGw0cFtndWVzdF9sNF90
YWJsZV9vZmZzZXQodmEpXTsKKyAgICAgICAgaHZtZW11bF93cml0ZV9jYWNoZSh2LCBsNGdwYSwg
Jmd3LT5sNGUsIHNpemVvZihndy0+bDRlKSk7CisgICAgfQogICAgIGdmbGFncyA9IGd1ZXN0X2w0
ZV9nZXRfZmxhZ3MoZ3ctPmw0ZSk7CiAgICAgaWYgKCAhKGdmbGFncyAmIF9QQUdFX1BSRVNFTlQp
ICkKICAgICAgICAgZ290byBvdXQ7CkBAIC0xNjMsNyArMTc1LDEzIEBAIGd1ZXN0X3dhbGtfdGFi
bGVzKHN0cnVjdCB2Y3B1ICp2LCBzdHJ1Y3QKICAgICB9CiAKICAgICAvKiBHZXQgdGhlIGwzZSBh
bmQgY2hlY2sgaXRzIGZsYWdzKi8KLSAgICBndy0+bDNlID0gbDNwW2d1ZXN0X2wzX3RhYmxlX29m
ZnNldCh2YSldOworICAgIGwzZ3BhID0gZ2ZuX3RvX2dhZGRyKGd1ZXN0X2w0ZV9nZXRfZ2ZuKGd3
LT5sNGUpKSArCisgICAgICAgICAgICBndWVzdF9sM190YWJsZV9vZmZzZXQodmEpICogc2l6ZW9m
KGd3LT5sM2UpOworICAgIGlmICggIWh2bWVtdWxfcmVhZF9jYWNoZSh2LCBsM2dwYSwgJmd3LT5s
M2UsIHNpemVvZihndy0+bDNlKSkgKQorICAgIHsKKyAgICAgICAgZ3ctPmwzZSA9IGwzcFtndWVz
dF9sM190YWJsZV9vZmZzZXQodmEpXTsKKyAgICAgICAgaHZtZW11bF93cml0ZV9jYWNoZSh2LCBs
M2dwYSwgJmd3LT5sM2UsIHNpemVvZihndy0+bDNlKSk7CisgICAgfQogICAgIGdmbGFncyA9IGd1
ZXN0X2wzZV9nZXRfZmxhZ3MoZ3ctPmwzZSk7CiAgICAgaWYgKCAhKGdmbGFncyAmIF9QQUdFX1BS
RVNFTlQpICkKICAgICAgICAgZ290byBvdXQ7CkBAIC0yMTUsNyArMjMzLDE0IEBAIGd1ZXN0X3dh
bGtfdGFibGVzKHN0cnVjdCB2Y3B1ICp2LCBzdHJ1Y3QKICNlbHNlIC8qIFBBRSBvbmx5Li4uICov
CiAKICAgICAvKiBHZXQgdGhlIGwzZSBhbmQgY2hlY2sgaXRzIGZsYWcgKi8KLSAgICBndy0+bDNl
ID0gKChndWVzdF9sM2VfdCAqKSB0b3BfbWFwKVtndWVzdF9sM190YWJsZV9vZmZzZXQodmEpXTsK
KyAgICBsM2dwYSA9IGdmbl90b19nYWRkcih0b3BfZ2ZuKSArICgodW5zaWduZWQgbG9uZyl0b3Bf
bWFwICYgflBBR0VfTUFTSykgKworICAgICAgICAgICAgZ3Vlc3RfbDNfdGFibGVfb2Zmc2V0KHZh
KSAqIHNpemVvZihndy0+bDNlKTsKKyAgICBpZiAoICFodm1lbXVsX3JlYWRfY2FjaGUodiwgbDNn
cGEsICZndy0+bDNlLCBzaXplb2YoZ3ctPmwzZSkpICkKKyAgICB7CisgICAgICAgIGd3LT5sM2Ug
PSAoKGd1ZXN0X2wzZV90ICopdG9wX21hcClbZ3Vlc3RfbDNfdGFibGVfb2Zmc2V0KHZhKV07Cisg
ICAgICAgIGh2bWVtdWxfd3JpdGVfY2FjaGUodiwgbDNncGEsICZndy0+bDNlLCBzaXplb2YoZ3ct
PmwzZSkpOworICAgIH0KKwogICAgIGdmbGFncyA9IGd1ZXN0X2wzZV9nZXRfZmxhZ3MoZ3ctPmwz
ZSk7CiAgICAgaWYgKCAhKGdmbGFncyAmIF9QQUdFX1BSRVNFTlQpICkKICAgICAgICAgZ290byBv
dXQ7CkBAIC0yNDEsMTggKzI2NiwyNCBAQCBndWVzdF93YWxrX3RhYmxlcyhzdHJ1Y3QgdmNwdSAq
diwgc3RydWN0CiAgICAgICAgIGdvdG8gb3V0OwogICAgIH0KIAotICAgIC8qIEdldCB0aGUgbDJl
ICovCi0gICAgZ3ctPmwyZSA9IGwycFtndWVzdF9sMl90YWJsZV9vZmZzZXQodmEpXTsKKyAgICBs
MmdwYSA9IGdmbl90b19nYWRkcihndWVzdF9sM2VfZ2V0X2dmbihndy0+bDNlKSk7CiAKICNlbHNl
IC8qIDMyLWJpdCBvbmx5Li4uICovCiAKLSAgICAvKiBHZXQgbDJlIGZyb20gdGhlIHRvcCBsZXZl
bCB0YWJsZSAqLwogICAgIGd3LT5sMm1mbiA9IHRvcF9tZm47CiAgICAgbDJwID0gKGd1ZXN0X2wy
ZV90ICopIHRvcF9tYXA7Ci0gICAgZ3ctPmwyZSA9IGwycFtndWVzdF9sMl90YWJsZV9vZmZzZXQo
dmEpXTsKKyAgICBsMmdwYSA9IGdmbl90b19nYWRkcih0b3BfZ2ZuKTsKIAogI2VuZGlmIC8qIEFs
bCBsZXZlbHMuLi4gKi8KIAorICAgIC8qIEdldCB0aGUgbDJlICovCisgICAgbDJncGEgKz0gZ3Vl
c3RfbDJfdGFibGVfb2Zmc2V0KHZhKSAqIHNpemVvZihndy0+bDJlKTsKKyAgICBpZiAoICFodm1l
bXVsX3JlYWRfY2FjaGUodiwgbDJncGEsICZndy0+bDJlLCBzaXplb2YoZ3ctPmwyZSkpICkKKyAg
ICB7CisgICAgICAgIGd3LT5sMmUgPSBsMnBbZ3Vlc3RfbDJfdGFibGVfb2Zmc2V0KHZhKV07Cisg
ICAgICAgIGh2bWVtdWxfd3JpdGVfY2FjaGUodiwgbDJncGEsICZndy0+bDJlLCBzaXplb2YoZ3ct
PmwyZSkpOworICAgIH0KKwogICAgIC8qIENoZWNrIHRoZSBsMmUgZmxhZ3MuICovCiAgICAgZ2Zs
YWdzID0gZ3Vlc3RfbDJlX2dldF9mbGFncyhndy0+bDJlKTsKICAgICBpZiAoICEoZ2ZsYWdzICYg
X1BBR0VfUFJFU0VOVCkgKQpAQCAtMzM0LDcgKzM2NSwxNSBAQCBndWVzdF93YWxrX3RhYmxlcyhz
dHJ1Y3QgdmNwdSAqdiwgc3RydWN0CiAgICAgICAgIGd3LT5wZmVjIHw9IHJjICYgUEZFQ19zeW50
aF9tYXNrOwogICAgICAgICBnb3RvIG91dDsKICAgICB9Ci0gICAgZ3ctPmwxZSA9IGwxcFtndWVz
dF9sMV90YWJsZV9vZmZzZXQodmEpXTsKKworICAgIGwxZ3BhID0gZ2ZuX3RvX2dhZGRyKGd1ZXN0
X2wyZV9nZXRfZ2ZuKGd3LT5sMmUpKSArCisgICAgICAgICAgICBndWVzdF9sMV90YWJsZV9vZmZz
ZXQodmEpICogc2l6ZW9mKGd3LT5sMWUpOworICAgIGlmICggIWh2bWVtdWxfcmVhZF9jYWNoZSh2
LCBsMWdwYSwgJmd3LT5sMWUsIHNpemVvZihndy0+bDFlKSkgKQorICAgIHsKKyAgICAgICAgZ3ct
PmwxZSA9IGwxcFtndWVzdF9sMV90YWJsZV9vZmZzZXQodmEpXTsKKyAgICAgICAgaHZtZW11bF93
cml0ZV9jYWNoZSh2LCBsMWdwYSwgJmd3LT5sMWUsIHNpemVvZihndy0+bDFlKSk7CisgICAgfQor
CiAgICAgZ2ZsYWdzID0gZ3Vlc3RfbDFlX2dldF9mbGFncyhndy0+bDFlKTsKICAgICBpZiAoICEo
Z2ZsYWdzICYgX1BBR0VfUFJFU0VOVCkgKQogICAgICAgICBnb3RvIG91dDsKQEAgLTQ0NSwyMiAr
NDg0LDM0IEBAIGd1ZXN0X3dhbGtfdGFibGVzKHN0cnVjdCB2Y3B1ICp2LCBzdHJ1Y3QKICAgICBj
YXNlIDE6CiAgICAgICAgIGlmICggc2V0X2FkX2JpdHMoJmwxcFtndWVzdF9sMV90YWJsZV9vZmZz
ZXQodmEpXS5sMSwgJmd3LT5sMWUubDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgKHdhbGsg
JiBQRkVDX3dyaXRlX2FjY2VzcykpICkKKyAgICAgICAgewogICAgICAgICAgICAgcGFnaW5nX21h
cmtfZGlydHkoZCwgZ3ctPmwxbWZuKTsKKyAgICAgICAgICAgIGh2bWVtdWxfd3JpdGVfY2FjaGUo
diwgbDFncGEsICZndy0+bDFlLCBzaXplb2YoZ3ctPmwxZSkpOworICAgICAgICB9CiAgICAgICAg
IC8qIEZhbGx0aHJvdWdoICovCiAgICAgY2FzZSAyOgogICAgICAgICBpZiAoIHNldF9hZF9iaXRz
KCZsMnBbZ3Vlc3RfbDJfdGFibGVfb2Zmc2V0KHZhKV0ubDIsICZndy0+bDJlLmwyLAogICAgICAg
ICAgICAgICAgICAgICAgICAgICh3YWxrICYgUEZFQ193cml0ZV9hY2Nlc3MpICYmIGxlYWZfbGV2
ZWwgPT0gMikgKQorICAgICAgICB7CiAgICAgICAgICAgICBwYWdpbmdfbWFya19kaXJ0eShkLCBn
dy0+bDJtZm4pOworICAgICAgICAgICAgaHZtZW11bF93cml0ZV9jYWNoZSh2LCBsMmdwYSwgJmd3
LT5sMmUsIHNpemVvZihndy0+bDJlKSk7CisgICAgICAgIH0KICAgICAgICAgLyogRmFsbHRocm91
Z2ggKi8KICNpZiBHVUVTVF9QQUdJTkdfTEVWRUxTID09IDQgLyogNjQtYml0IG9ubHkuLi4gKi8K
ICAgICBjYXNlIDM6CiAgICAgICAgIGlmICggc2V0X2FkX2JpdHMoJmwzcFtndWVzdF9sM190YWJs
ZV9vZmZzZXQodmEpXS5sMywgJmd3LT5sM2UubDMsCiAgICAgICAgICAgICAgICAgICAgICAgICAg
KHdhbGsgJiBQRkVDX3dyaXRlX2FjY2VzcykgJiYgbGVhZl9sZXZlbCA9PSAzKSApCisgICAgICAg
IHsKICAgICAgICAgICAgIHBhZ2luZ19tYXJrX2RpcnR5KGQsIGd3LT5sM21mbik7CisgICAgICAg
ICAgICBodm1lbXVsX3dyaXRlX2NhY2hlKHYsIGwzZ3BhLCAmZ3ctPmwzZSwgc2l6ZW9mKGd3LT5s
M2UpKTsKKyAgICAgICAgfQogCiAgICAgICAgIGlmICggc2V0X2FkX2JpdHMoJmw0cFtndWVzdF9s
NF90YWJsZV9vZmZzZXQodmEpXS5sNCwgJmd3LT5sNGUubDQsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgZmFsc2UpICkKKyAgICAgICAgewogICAgICAgICAgICAgcGFnaW5nX21hcmtfZGlydHko
ZCwgZ3ctPmw0bWZuKTsKKyAgICAgICAgICAgIGh2bWVtdWxfd3JpdGVfY2FjaGUodiwgbDRncGEs
ICZndy0+bDRlLCBzaXplb2YoZ3ctPmw0ZSkpOworICAgICAgICB9CiAjZW5kaWYKICAgICB9CiAK
LS0tIGEveGVuL2FyY2gveDg2L21tL2hhcC9ndWVzdF93YWxrLmMKKysrIGIveGVuL2FyY2gveDg2
L21tL2hhcC9ndWVzdF93YWxrLmMKQEAgLTkxLDcgKzkxLDggQEAgdW5zaWduZWQgbG9uZyBoYXBf
cDJtX2dhX3RvX2dmbihHVUVTVF9QQQogI2lmIEdVRVNUX1BBR0lOR19MRVZFTFMgPT0gMwogICAg
IHRvcF9tYXAgKz0gKGNyMyAmIH4oUEFHRV9NQVNLIHwgMzEpKTsKICNlbmRpZgotICAgIHdhbGtf
b2sgPSBndWVzdF93YWxrX3RhYmxlcyh2LCBwMm0sIGdhLCAmZ3csICpwZmVjLCB0b3BfbWZuLCB0
b3BfbWFwKTsKKyAgICB3YWxrX29rID0gZ3Vlc3Rfd2Fsa190YWJsZXModiwgcDJtLCBnYSwgJmd3
LCAqcGZlYywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wX2dmbiwgdG9wX21m
biwgdG9wX21hcCk7CiAgICAgdW5tYXBfZG9tYWluX3BhZ2UodG9wX21hcCk7CiAgICAgcHV0X3Bh
Z2UodG9wX3BhZ2UpOwogCi0tLSBhL3hlbi9hcmNoL3g4Ni9tbS9zaGFkb3cvbXVsdGkuYworKysg
Yi94ZW4vYXJjaC94ODYvbW0vc2hhZG93L211bHRpLmMKQEAgLTE3NSw5ICsxNzUsMTMgQEAgc3Rh
dGljIGlubGluZSBib29sCiBzaF93YWxrX2d1ZXN0X3RhYmxlcyhzdHJ1Y3QgdmNwdSAqdiwgdW5z
aWduZWQgbG9uZyB2YSwgd2Fsa190ICpndywKICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90
IHBmZWMpCiB7CisgICAgZ2ZuX3Qgcm9vdF9nZm4gPSBfZ2ZuKHBhZ2luZ19tb2RlX2V4dGVybmFs
KHYtPmRvbWFpbikKKyAgICAgICAgICAgICAgICAgICAgICAgICAgPyBjcjNfcGEodi0+YXJjaC5o
dm0uZ3Vlc3RfY3JbM10pID4+IFBBR0VfU0hJRlQKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
OiBwYWdldGFibGVfZ2V0X3Bmbih2LT5hcmNoLmd1ZXN0X3RhYmxlKSk7CisKICNpZiBHVUVTVF9Q
QUdJTkdfTEVWRUxTID09IDMgLyogUEFFICovCiAgICAgcmV0dXJuIGd1ZXN0X3dhbGtfdGFibGVz
KHYsIHAybV9nZXRfaG9zdHAybSh2LT5kb21haW4pLCB2YSwgZ3csIHBmZWMsCi0gICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIElOVkFMSURfTUZOLCB2LT5hcmNoLnBhZ2luZy5zaGFkb3cuZ2wz
ZSk7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvb3RfZ2ZuLCBJTlZBTElEX01GTiwg
di0+YXJjaC5wYWdpbmcuc2hhZG93LmdsM2UpOwogI2Vsc2UgLyogMzIgb3IgNjQgKi8KICAgICBj
b25zdCBzdHJ1Y3QgZG9tYWluICpkID0gdi0+ZG9tYWluOwogICAgIG1mbl90IHJvb3RfbWZuID0g
KHYtPmFyY2guZmxhZ3MgJiBURl9rZXJuZWxfbW9kZQpAQCAtMTg1LDcgKzE4OSw3IEBAIHNoX3dh
bGtfZ3Vlc3RfdGFibGVzKHN0cnVjdCB2Y3B1ICp2LCB1bnMKICAgICAgICAgICAgICAgICAgICAg
ICA6IHBhZ2V0YWJsZV9nZXRfbWZuKHYtPmFyY2guZ3Vlc3RfdGFibGVfdXNlcikpOwogICAgIHZv
aWQgKnJvb3RfbWFwID0gbWFwX2RvbWFpbl9wYWdlKHJvb3RfbWZuKTsKICAgICBib29sIG9rID0g
Z3Vlc3Rfd2Fsa190YWJsZXModiwgcDJtX2dldF9ob3N0cDJtKGQpLCB2YSwgZ3csIHBmZWMsCi0g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvb3RfbWZuLCByb290X21hcCk7CisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvb3RfZ2ZuLCByb290X21mbiwgcm9vdF9tYXAp
OwogCiAgICAgdW5tYXBfZG9tYWluX3BhZ2Uocm9vdF9tYXApOwogCi0tLSBhL3hlbi9pbmNsdWRl
L2FzbS14ODYvZ3Vlc3RfcHQuaAorKysgYi94ZW4vaW5jbHVkZS9hc20teDg2L2d1ZXN0X3B0LmgK
QEAgLTQyOCw4ICs0MjgsOSBAQCBzdGF0aWMgaW5saW5lIHVuc2lnbmVkIGludCBndWVzdF93YWxr
X3RvCiAjZGVmaW5lIGd1ZXN0X3dhbGtfdGFibGVzIEdQVF9SRU5BTUUoZ3Vlc3Rfd2Fsa190YWJs
ZXMsIEdVRVNUX1BBR0lOR19MRVZFTFMpCiAKIGJvb2wKLWd1ZXN0X3dhbGtfdGFibGVzKHN0cnVj
dCB2Y3B1ICp2LCBzdHJ1Y3QgcDJtX2RvbWFpbiAqcDJtLCB1bnNpZ25lZCBsb25nIHZhLAotICAg
ICAgICAgICAgICAgICAgd2Fsa190ICpndywgdWludDMyX3QgcGZlYywgbWZuX3QgdG9wX21mbiwg
dm9pZCAqdG9wX21hcCk7CitndWVzdF93YWxrX3RhYmxlcyhjb25zdCBzdHJ1Y3QgdmNwdSAqdiwg
c3RydWN0IHAybV9kb21haW4gKnAybSwKKyAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGxvbmcg
dmEsIHdhbGtfdCAqZ3csIHVpbnQzMl90IHBmZWMsCisgICAgICAgICAgICAgICAgICBnZm5fdCB0
b3BfZ2ZuLCBtZm5fdCB0b3BfbWZuLCB2b2lkICp0b3BfbWFwKTsKIAogLyogUHJldHR5LXByaW50
IHRoZSBjb250ZW50cyBvZiBhIGd1ZXN0LXdhbGsgKi8KIHN0YXRpYyBpbmxpbmUgdm9pZCBwcmlu
dF9ndyhjb25zdCB3YWxrX3QgKmd3KQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVu
cHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZv
L3hlbi1kZXZlbA==

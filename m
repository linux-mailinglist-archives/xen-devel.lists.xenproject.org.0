Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 37A32BFF9A
	for <lists+xen-devel@lfdr.de>; Fri, 27 Sep 2019 09:04:28 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iDkGM-000450-SG; Fri, 27 Sep 2019 07:01:58 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=Rbpq=XW=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1iDkGL-00043y-Qq
 for xen-devel@lists.xenproject.org; Fri, 27 Sep 2019 07:01:57 +0000
X-Inumbo-ID: 92a56966-e0f4-11e9-bf31-bc764e2007e4
Received: from mx1.suse.de (unknown [195.135.220.15])
 by localhost (Halon) with ESMTPS
 id 92a56966-e0f4-11e9-bf31-bc764e2007e4;
 Fri, 27 Sep 2019 07:01:05 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 9DD72B17D;
 Fri, 27 Sep 2019 07:01:02 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Fri, 27 Sep 2019 09:00:31 +0200
Message-Id: <20190927070050.12405-28-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190927070050.12405-1-jgross@suse.com>
References: <20190927070050.12405-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v4 27/46] xen/sched: move struct task_slice into
 struct sched_unit
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Tim Deegan <tim@xen.org>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>,
 Robert VanVossen <robert.vanvossen@dornerworks.com>,
 Dario Faggioli <dfaggioli@suse.com>, Julien Grall <julien.grall@arm.com>,
 Josh Whitehead <josh.whitehead@dornerworks.com>,
 Meng Xu <mengxu@cis.upenn.edu>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SW4gb3JkZXIgdG8gcHJlcGFyZSBmb3IgbXVsdGlwbGUgdmNwdXMgcGVyIHNjaGVkdWxlIHVuaXQg
bW92ZSBzdHJ1Y3QKdGFza19zbGljZSBpbiBzY2hlZHVsZSgpIGZyb20gdGhlIGxvY2FsIHN0YWNr
IGludG8gc3RydWN0IHNjaGVkX3VuaXQKb2YgdGhlIGN1cnJlbnRseSBydW5uaW5nIHVuaXQuIFRv
IG1ha2UgYWNjZXNzIGVhc2llciBmb3IgdGhlIHNpbmdsZQpzY2hlZHVsZXJzIGFkZCB0aGUgcG9p
bnRlciBvZiB0aGUgY3VycmVudGx5IHJ1bm5pbmcgdW5pdCBhcyBhIHBhcmFtZXRlcgpvZiBkb19z
Y2hlZHVsZSgpLgoKV2hpbGUgYXQgaXQgc3dpdGNoIHRoZSB0YXNrbGV0X3dvcmtfc2NoZWR1bGVk
IHBhcmFtZXRlciBvZgpkb19zY2hlZHVsZSgpIGZyb20gYm9vbF90IHRvIGJvb2wuCgpBcyBzdHJ1
Y3QgdGFza19zbGljZSBpcyBvbmx5IGV2ZXIgbW9kaWZpZWQgd2l0aCB0aGUgbG9jYWwgc2NoZWR1
bGUKbG9jayBoZWxkIGl0IGlzIHNhZmUgdG8gZGlyZWN0bHkgc2V0IHRoZSBkaWZmZXJlbnQgdW5p
dHMgaW4gc3RydWN0CnNjaGVkX3VuaXQgaW5zdGVhZCBvZiB1c2luZyBhbiBvbi1zdGFjayBjb3B5
IGZvciByZXR1cm5pbmcgdGhlIGRhdGEuCgpTaWduZWQtb2ZmLWJ5OiBKdWVyZ2VuIEdyb3NzIDxq
Z3Jvc3NAc3VzZS5jb20+ClJldmlld2VkLWJ5OiBEYXJpbyBGYWdnaW9saSA8ZGZhZ2dpb2xpQHN1
c2UuY29tPgotLS0KVjM6Ci0gcmVhZGQgYWNjaWRlbnRhbGx5IGRyb3BwZWQgY2FsbCBvZiBjb250
aW51ZV9ydW5uaW5nKCkgKERhcmlvIEZhZ2dpb2xpKQotLS0KIHhlbi9jb21tb24vc2NoZWRfYXJp
bmM2NTMuYyB8IDIwICsrKysrKystLS0tLS0tLS0tLS0tCiB4ZW4vY29tbW9uL3NjaGVkX2NyZWRp
dC5jICAgfCAyNSArKysrKysrKysrKy0tLS0tLS0tLS0tLS0tCiB4ZW4vY29tbW9uL3NjaGVkX2Ny
ZWRpdDIuYyAgfCAyMSArKysrKysrKystLS0tLS0tLS0tLS0KIHhlbi9jb21tb24vc2NoZWRfbnVs
bC5jICAgICB8IDI5ICsrKysrKysrKysrKysrLS0tLS0tLS0tLS0tLS0tCiB4ZW4vY29tbW9uL3Nj
aGVkX3J0LmMgICAgICAgfCAyMiArKysrKysrKysrKy0tLS0tLS0tLS0tCiB4ZW4vY29tbW9uL3Nj
aGVkdWxlLmMgICAgICAgfCAzMCArKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tLS0KIHhlbi9p
bmNsdWRlL3hlbi9zY2hlZC1pZi5oICB8IDExICsrKy0tLS0tLS0tCiB4ZW4vaW5jbHVkZS94ZW4v
c2NoZWQuaCAgICAgfCAgNiArKysrKysKIDggZmlsZXMgY2hhbmdlZCwgNzUgaW5zZXJ0aW9ucygr
KSwgODkgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZF9hcmluYzY1
My5jIGIveGVuL2NvbW1vbi9zY2hlZF9hcmluYzY1My5jCmluZGV4IDJiYzE4N2M5MmIuLmZjZjgx
ZGIxOWEgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWRfYXJpbmM2NTMuYworKysgYi94ZW4v
Y29tbW9uL3NjaGVkX2FyaW5jNjUzLmMKQEAgLTUwMywxOCArNTAzLDE0IEBAIGE2NTNzY2hlZF91
bml0X3dha2UoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAq
dW5pdCkKICAqCiAgKiBAcGFyYW0gb3BzICAgICAgIFBvaW50ZXIgdG8gdGhpcyBpbnN0YW5jZSBv
ZiB0aGUgc2NoZWR1bGVyIHN0cnVjdHVyZQogICogQHBhcmFtIG5vdyAgICAgICBDdXJyZW50IHRp
bWUKLSAqCi0gKiBAcmV0dXJuICAgICAgICAgIEFkZHJlc3Mgb2YgdGhlIFVOSVQgc3RydWN0dXJl
IHNjaGVkdWxlZCB0byBiZSBydW4gbmV4dAotICogICAgICAgICAgICAgICAgICBBbW91bnQgb2Yg
dGltZSB0byBleGVjdXRlIHRoZSByZXR1cm5lZCBVTklUCi0gKiAgICAgICAgICAgICAgICAgIEZs
YWcgZm9yIHdoZXRoZXIgdGhlIFVOSVQgd2FzIG1pZ3JhdGVkCiAgKi8KLXN0YXRpYyBzdHJ1Y3Qg
dGFza19zbGljZQorc3RhdGljIHZvaWQKIGE2NTNzY2hlZF9kb19zY2hlZHVsZSgKICAgICBjb25z
dCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCisgICAgc3RydWN0IHNjaGVkX3VuaXQgKnByZXYsCiAg
ICAgc190aW1lX3Qgbm93LAotICAgIGJvb2xfdCB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkKQorICAg
IGJvb2wgdGFza2xldF93b3JrX3NjaGVkdWxlZCkKIHsKLSAgICBzdHJ1Y3QgdGFza19zbGljZSBy
ZXQ7ICAgICAgICAgICAgICAgICAgICAgIC8qIGhvbGQgdGhlIGNob3NlbiBkb21haW4gKi8KICAg
ICBzdHJ1Y3Qgc2NoZWRfdW5pdCAqbmV3X3Rhc2sgPSBOVUxMOwogICAgIHN0YXRpYyB1bnNpZ25l
ZCBpbnQgc2NoZWRfaW5kZXggPSAwOwogICAgIHN0YXRpYyBzX3RpbWVfdCBuZXh0X3N3aXRjaF90
aW1lOwpAQCAtNTkyLDEzICs1ODgsMTEgQEAgYTY1M3NjaGVkX2RvX3NjaGVkdWxlKAogICAgICAq
IFJldHVybiB0aGUgYW1vdW50IG9mIHRpbWUgdGhlIG5leHQgZG9tYWluIGhhcyB0byBydW4gYW5k
IHRoZSBhZGRyZXNzCiAgICAgICogb2YgdGhlIHNlbGVjdGVkIHRhc2sncyBVTklUIHN0cnVjdHVy
ZS4KICAgICAgKi8KLSAgICByZXQudGltZSA9IG5leHRfc3dpdGNoX3RpbWUgLSBub3c7Ci0gICAg
cmV0LnRhc2sgPSBuZXdfdGFzazsKLSAgICByZXQubWlncmF0ZWQgPSAwOwotCi0gICAgQlVHX09O
KHJldC50aW1lIDw9IDApOworICAgIHByZXYtPm5leHRfdGltZSA9IG5leHRfc3dpdGNoX3RpbWUg
LSBub3c7CisgICAgcHJldi0+bmV4dF90YXNrID0gbmV3X3Rhc2s7CisgICAgbmV3X3Rhc2stPm1p
Z3JhdGVkID0gZmFsc2U7CiAKLSAgICByZXR1cm4gcmV0OworICAgIEJVR19PTihwcmV2LT5uZXh0
X3RpbWUgPD0gMCk7CiB9CiAKIC8qKgpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZF9jcmVk
aXQuYyBiL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0LmMKaW5kZXggN2Y2YmEzNTc2Ni4uMjk5ZWZm
MjFhYyAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQuYworKysgYi94ZW4vY29t
bW9uL3NjaGVkX2NyZWRpdC5jCkBAIC0xNjc1LDcgKzE2NzUsNyBAQCBjc2NoZWRfcnVucV9zdGVh
bChpbnQgcGVlcl9jcHUsIGludCBjcHUsIGludCBwcmksIGludCBiYWxhbmNlX3N0ZXApCiAKIHN0
YXRpYyBzdHJ1Y3QgY3NjaGVkX3VuaXQgKgogY3NjaGVkX2xvYWRfYmFsYW5jZShzdHJ1Y3QgY3Nj
aGVkX3ByaXZhdGUgKnBydiwgaW50IGNwdSwKLSAgICBzdHJ1Y3QgY3NjaGVkX3VuaXQgKnNuZXh0
LCBib29sX3QgKnN0b2xlbikKKyAgICBzdHJ1Y3QgY3NjaGVkX3VuaXQgKnNuZXh0LCBib29sICpz
dG9sZW4pCiB7CiAgICAgc3RydWN0IGNwdXBvb2wgKmMgPSBwZXJfY3B1KGNwdXBvb2wsIGNwdSk7
CiAgICAgc3RydWN0IGNzY2hlZF91bml0ICpzcGVlcjsKQEAgLTE3OTEsNyArMTc5MSw3IEBAIGNz
Y2hlZF9sb2FkX2JhbGFuY2Uoc3RydWN0IGNzY2hlZF9wcml2YXRlICpwcnYsIGludCBjcHUsCiAg
ICAgICAgICAgICAgICAgLyogQXMgc29vbiBhcyBvbmUgdW5pdCBpcyBmb3VuZCwgYmFsYW5jaW5n
IGVuZHMgKi8KICAgICAgICAgICAgICAgICBpZiAoIHNwZWVyICE9IE5VTEwgKQogICAgICAgICAg
ICAgICAgIHsKLSAgICAgICAgICAgICAgICAgICAgKnN0b2xlbiA9IDE7CisgICAgICAgICAgICAg
ICAgICAgICpzdG9sZW4gPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAg
ICAgICAgICAgICAgKiBOZXh0IHRpbWUgd2UnbGwgbG9vayBmb3Igd29yayB0byBzdGVhbCBvbiB0
aGlzIG5vZGUsIHdlCiAgICAgICAgICAgICAgICAgICAgICAqIHdpbGwgc3RhcnQgZnJvbSB0aGUg
bmV4dCBwQ1BVLCB3aXRoIHJlc3BlY3QgdG8gdGhpcyBvbmUsCkBAIC0xODIxLDE5ICsxODIxLDE4
IEBAIGNzY2hlZF9sb2FkX2JhbGFuY2Uoc3RydWN0IGNzY2hlZF9wcml2YXRlICpwcnYsIGludCBj
cHUsCiAgKiBUaGlzIGZ1bmN0aW9uIGlzIGluIHRoZSBjcml0aWNhbCBwYXRoLiBJdCBpcyBkZXNp
Z25lZCB0byBiZSBzaW1wbGUgYW5kCiAgKiBmYXN0IGZvciB0aGUgY29tbW9uIGNhc2UuCiAgKi8K
LXN0YXRpYyBzdHJ1Y3QgdGFza19zbGljZQotY3NjaGVkX3NjaGVkdWxlKAotICAgIGNvbnN0IHN0
cnVjdCBzY2hlZHVsZXIgKm9wcywgc190aW1lX3Qgbm93LCBib29sX3QgdGFza2xldF93b3JrX3Nj
aGVkdWxlZCkKK3N0YXRpYyB2b2lkIGNzY2hlZF9zY2hlZHVsZSgKKyAgICBjb25zdCBzdHJ1Y3Qg
c2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0LCBzX3RpbWVfdCBub3csCisg
ICAgYm9vbCB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkKQogewogICAgIGNvbnN0IHVuc2lnbmVkIGlu
dCBjdXJfY3B1ID0gc21wX3Byb2Nlc3Nvcl9pZCgpOwogICAgIGNvbnN0IHVuc2lnbmVkIGludCBz
Y2hlZF9jcHUgPSBzY2hlZF9nZXRfcmVzb3VyY2VfY3B1KGN1cl9jcHUpOwogICAgIHN0cnVjdCBs
aXN0X2hlYWQgKiBjb25zdCBydW5xID0gUlVOUShzY2hlZF9jcHUpOwotICAgIHN0cnVjdCBzY2hl
ZF91bml0ICp1bml0ID0gY3VycmVudC0+c2NoZWRfdW5pdDsKICAgICBzdHJ1Y3QgY3NjaGVkX3Vu
aXQgKiBjb25zdCBzY3VyciA9IENTQ0hFRF9VTklUKHVuaXQpOwogICAgIHN0cnVjdCBjc2NoZWRf
cHJpdmF0ZSAqcHJ2ID0gQ1NDSEVEX1BSSVYob3BzKTsKICAgICBzdHJ1Y3QgY3NjaGVkX3VuaXQg
KnNuZXh0OwotICAgIHN0cnVjdCB0YXNrX3NsaWNlIHJldDsKICAgICBzX3RpbWVfdCBydW50aW1l
LCB0c2xpY2U7CisgICAgYm9vbCBtaWdyYXRlZCA9IGZhbHNlOwogCiAgICAgU0NIRURfU1RBVF9D
UkFOSyhzY2hlZHVsZSk7CiAgICAgQ1NDSEVEX1VOSVRfQ0hFQ0sodW5pdCk7CkBAIC0xOTI0LDcg
KzE5MjMsNiBAQCBjc2NoZWRfc2NoZWR1bGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAodW5z
aWduZWQgY2hhciAqKSZkKTsKICAgICAgICAgfQogCi0gICAgICAgIHJldC5taWdyYXRlZCA9IDA7
CiAgICAgICAgIGdvdG8gb3V0OwogICAgIH0KICAgICB0c2xpY2UgPSBwcnYtPnRzbGljZTsKQEAg
LTE5NDIsNyArMTk0MCw2IEBAIGNzY2hlZF9zY2hlZHVsZSgKICAgICB9CiAKICAgICBzbmV4dCA9
IF9fcnVucV9lbGVtKHJ1bnEtPm5leHQpOwotICAgIHJldC5taWdyYXRlZCA9IDA7CiAKICAgICAv
KiBUYXNrbGV0IHdvcmsgKHdoaWNoIHJ1bnMgaW4gaWRsZSBVTklUIGNvbnRleHQpIG92ZXJyaWRl
cyBhbGwgZWxzZS4gKi8KICAgICBpZiAoIHRhc2tsZXRfd29ya19zY2hlZHVsZWQgKQpAQCAtMTk2
OCw3ICsxOTY1LDcgQEAgY3NjaGVkX3NjaGVkdWxlKAogICAgIGlmICggc25leHQtPnByaSA+IENT
Q0hFRF9QUklfVFNfT1ZFUiApCiAgICAgICAgIF9fcnVucV9yZW1vdmUoc25leHQpOwogICAgIGVs
c2UKLSAgICAgICAgc25leHQgPSBjc2NoZWRfbG9hZF9iYWxhbmNlKHBydiwgc2NoZWRfY3B1LCBz
bmV4dCwgJnJldC5taWdyYXRlZCk7CisgICAgICAgIHNuZXh0ID0gY3NjaGVkX2xvYWRfYmFsYW5j
ZShwcnYsIHNjaGVkX2NwdSwgc25leHQsICZtaWdyYXRlZCk7CiAKICAgICAvKgogICAgICAqIFVw
ZGF0ZSBpZGxlcnMgbWFzayBpZiBuZWNlc3NhcnkuIFdoZW4gd2UncmUgaWRsaW5nLCBvdGhlciBD
UFVzCkBAIC0xOTkxLDEyICsxOTg4LDEyIEBAIG91dDoKICAgICAvKgogICAgICAqIFJldHVybiB0
YXNrIHRvIHJ1biBuZXh0Li4uCiAgICAgICovCi0gICAgcmV0LnRpbWUgPSAoaXNfaWRsZV91bml0
KHNuZXh0LT51bml0KSA/CisgICAgdW5pdC0+bmV4dF90aW1lID0gKGlzX2lkbGVfdW5pdChzbmV4
dC0+dW5pdCkgPwogICAgICAgICAgICAgICAgIC0xIDogdHNsaWNlKTsKLSAgICByZXQudGFzayA9
IHNuZXh0LT51bml0OworICAgIHVuaXQtPm5leHRfdGFzayA9IHNuZXh0LT51bml0OworICAgIHNu
ZXh0LT51bml0LT5taWdyYXRlZCA9IG1pZ3JhdGVkOwogCi0gICAgQ1NDSEVEX1VOSVRfQ0hFQ0so
cmV0LnRhc2spOwotICAgIHJldHVybiByZXQ7CisgICAgQ1NDSEVEX1VOSVRfQ0hFQ0sodW5pdC0+
bmV4dF90YXNrKTsKIH0KIAogc3RhdGljIHZvaWQKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vc2No
ZWRfY3JlZGl0Mi5jIGIveGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQyLmMKaW5kZXggYzRjNmM2OWEw
ZS4uODdkMTQyYmJlNCAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQyLmMKKysr
IGIveGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQyLmMKQEAgLTM0NDYsMTkgKzM0NDYsMTggQEAgcnVu
cV9jYW5kaWRhdGUoc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFkLAogICogVGhpcyBm
dW5jdGlvbiBpcyBpbiB0aGUgY3JpdGljYWwgcGF0aC4gSXQgaXMgZGVzaWduZWQgdG8gYmUgc2lt
cGxlIGFuZAogICogZmFzdCBmb3IgdGhlIGNvbW1vbiBjYXNlLgogICovCi1zdGF0aWMgc3RydWN0
IHRhc2tfc2xpY2UKLWNzY2hlZDJfc2NoZWR1bGUoCi0gICAgY29uc3Qgc3RydWN0IHNjaGVkdWxl
ciAqb3BzLCBzX3RpbWVfdCBub3csIGJvb2wgdGFza2xldF93b3JrX3NjaGVkdWxlZCkKK3N0YXRp
YyB2b2lkIGNzY2hlZDJfc2NoZWR1bGUoCisgICAgY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3Bz
LCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqY3VycnVuaXQsIHNfdGltZV90IG5vdywKKyAgICBib29sIHRh
c2tsZXRfd29ya19zY2hlZHVsZWQpCiB7CiAgICAgY29uc3QgdW5zaWduZWQgaW50IGN1cl9jcHUg
PSBzbXBfcHJvY2Vzc29yX2lkKCk7CiAgICAgY29uc3QgdW5zaWduZWQgaW50IHNjaGVkX2NwdSA9
IHNjaGVkX2dldF9yZXNvdXJjZV9jcHUoY3VyX2NwdSk7CiAgICAgc3RydWN0IGNzY2hlZDJfcnVu
cXVldWVfZGF0YSAqcnFkOwotICAgIHN0cnVjdCBzY2hlZF91bml0ICpjdXJydW5pdCA9IGN1cnJl
bnQtPnNjaGVkX3VuaXQ7CiAgICAgc3RydWN0IGNzY2hlZDJfdW5pdCAqIGNvbnN0IHNjdXJyID0g
Y3NjaGVkMl91bml0KGN1cnJ1bml0KTsKICAgICBzdHJ1Y3QgY3NjaGVkMl91bml0ICpzbmV4dCA9
IE5VTEw7CiAgICAgdW5zaWduZWQgaW50IHNraXBwZWRfdW5pdHMgPSAwOwotICAgIHN0cnVjdCB0
YXNrX3NsaWNlIHJldDsKICAgICBib29sIHRpY2tsZWQ7CisgICAgYm9vbCBtaWdyYXRlZCA9IGZh
bHNlOwogCiAgICAgU0NIRURfU1RBVF9DUkFOSyhzY2hlZHVsZSk7CiAgICAgQ1NDSEVEMl9VTklU
X0NIRUNLKGN1cnJ1bml0KTsKQEAgLTM1NDMsOCArMzU0Miw2IEBAIGNzY2hlZDJfc2NoZWR1bGUo
CiAgICAgICAgICAmJiB1bml0X3J1bm5hYmxlKGN1cnJ1bml0KSApCiAgICAgICAgIF9fc2V0X2Jp
dChfX0NTRkxBR19kZWxheWVkX3J1bnFfYWRkLCAmc2N1cnItPmZsYWdzKTsKIAotICAgIHJldC5t
aWdyYXRlZCA9IDA7Ci0KICAgICAvKiBBY2NvdW50aW5nIGZvciBub24taWRsZSB0YXNrcyAqLwog
ICAgIGlmICggIWlzX2lkbGVfdW5pdChzbmV4dC0+dW5pdCkgKQogICAgIHsKQEAgLTM1OTQsNyAr
MzU5MSw3IEBAIGNzY2hlZDJfc2NoZWR1bGUoCiAgICAgICAgICAgICBzbmV4dC0+Y3JlZGl0ICs9
IENTQ0hFRDJfTUlHUkFURV9DT01QRU5TQVRJT047CiAgICAgICAgICAgICBzY2hlZF9zZXRfcmVz
KHNuZXh0LT51bml0LCBnZXRfc2NoZWRfcmVzKHNjaGVkX2NwdSkpOwogICAgICAgICAgICAgU0NI
RURfU1RBVF9DUkFOSyhtaWdyYXRlZCk7Ci0gICAgICAgICAgICByZXQubWlncmF0ZWQgPSAxOwor
ICAgICAgICAgICAgbWlncmF0ZWQgPSB0cnVlOwogICAgICAgICB9CiAgICAgfQogICAgIGVsc2UK
QEAgLTM2MjUsMTEgKzM2MjIsMTEgQEAgY3NjaGVkMl9zY2hlZHVsZSgKICAgICAvKgogICAgICAq
IFJldHVybiB0YXNrIHRvIHJ1biBuZXh0Li4uCiAgICAgICovCi0gICAgcmV0LnRpbWUgPSBjc2No
ZWQyX3J1bnRpbWUob3BzLCBzY2hlZF9jcHUsIHNuZXh0LCBub3cpOwotICAgIHJldC50YXNrID0g
c25leHQtPnVuaXQ7CisgICAgY3VycnVuaXQtPm5leHRfdGltZSA9IGNzY2hlZDJfcnVudGltZShv
cHMsIHNjaGVkX2NwdSwgc25leHQsIG5vdyk7CisgICAgY3VycnVuaXQtPm5leHRfdGFzayA9IHNu
ZXh0LT51bml0OworICAgIHNuZXh0LT51bml0LT5taWdyYXRlZCA9IG1pZ3JhdGVkOwogCi0gICAg
Q1NDSEVEMl9VTklUX0NIRUNLKHJldC50YXNrKTsKLSAgICByZXR1cm4gcmV0OworICAgIENTQ0hF
RDJfVU5JVF9DSEVDSyhjdXJydW5pdC0+bmV4dF90YXNrKTsKIH0KIAogc3RhdGljIHZvaWQKZGlm
ZiAtLWdpdCBhL3hlbi9jb21tb24vc2NoZWRfbnVsbC5jIGIveGVuL2NvbW1vbi9zY2hlZF9udWxs
LmMKaW5kZXggNTFlZGMzZGJiOS4uODBhN2Q0NTkzNSAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9z
Y2hlZF9udWxsLmMKKysrIGIveGVuL2NvbW1vbi9zY2hlZF9udWxsLmMKQEAgLTc3OSwxNiArNzc5
LDE0IEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBudWxsX3VuaXRfY2hlY2soc3RydWN0IHNjaGVkX3Vu
aXQgKnVuaXQpCiAgKiAgLSB0aGUgdW5pdCBhc3NpZ25lZCB0byB0aGUgcENQVSwgaWYgdGhlcmUn
cyBvbmUgYW5kIGl0IGNhbiBydW47CiAgKiAgLSB0aGUgaWRsZSB1bml0LCBvdGhlcndpc2UuCiAg
Ki8KLXN0YXRpYyBzdHJ1Y3QgdGFza19zbGljZSBudWxsX3NjaGVkdWxlKGNvbnN0IHN0cnVjdCBz
Y2hlZHVsZXIgKm9wcywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNf
dGltZV90IG5vdywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2xf
dCB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkKQorc3RhdGljIHZvaWQgbnVsbF9zY2hlZHVsZShjb25z
dCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICpwcmV2LAorICAgICAg
ICAgICAgICAgICAgICAgICAgICBzX3RpbWVfdCBub3csIGJvb2wgdGFza2xldF93b3JrX3NjaGVk
dWxlZCkKIHsKICAgICB1bnNpZ25lZCBpbnQgYnM7CiAgICAgY29uc3QgdW5zaWduZWQgaW50IGN1
cl9jcHUgPSBzbXBfcHJvY2Vzc29yX2lkKCk7CiAgICAgY29uc3QgdW5zaWduZWQgaW50IHNjaGVk
X2NwdSA9IHNjaGVkX2dldF9yZXNvdXJjZV9jcHUoY3VyX2NwdSk7CiAgICAgc3RydWN0IG51bGxf
cHJpdmF0ZSAqcHJ2ID0gbnVsbF9wcml2KG9wcyk7CiAgICAgc3RydWN0IG51bGxfdW5pdCAqd3Zj
OwotICAgIHN0cnVjdCB0YXNrX3NsaWNlIHJldDsKIAogICAgIFNDSEVEX1NUQVRfQ1JBTksoc2No
ZWR1bGUpOwogICAgIE5VTExfVU5JVF9DSEVDSyhjdXJyZW50LT5zY2hlZF91bml0KTsKQEAgLTgx
NiwxOSArODE0LDE4IEBAIHN0YXRpYyBzdHJ1Y3QgdGFza19zbGljZSBudWxsX3NjaGVkdWxlKGNv
bnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKICAgICBpZiAoIHRhc2tsZXRfd29ya19zY2hlZHVs
ZWQgKQogICAgIHsKICAgICAgICAgdHJhY2VfdmFyKFRSQ19TTlVMTF9UQVNLTEVULCAxLCAwLCBO
VUxMKTsKLSAgICAgICAgcmV0LnRhc2sgPSBzY2hlZF9pZGxlX3VuaXQoc2NoZWRfY3B1KTsKKyAg
ICAgICAgcHJldi0+bmV4dF90YXNrID0gc2NoZWRfaWRsZV91bml0KHNjaGVkX2NwdSk7CiAgICAg
fQogICAgIGVsc2UKLSAgICAgICAgcmV0LnRhc2sgPSBwZXJfY3B1KG5wYywgc2NoZWRfY3B1KS51
bml0OwotICAgIHJldC5taWdyYXRlZCA9IDA7Ci0gICAgcmV0LnRpbWUgPSAtMTsKKyAgICAgICAg
cHJldi0+bmV4dF90YXNrID0gcGVyX2NwdShucGMsIHNjaGVkX2NwdSkudW5pdDsKKyAgICBwcmV2
LT5uZXh0X3RpbWUgPSAtMTsKIAogICAgIC8qCiAgICAgICogV2UgbWF5IGJlIG5ldyBpbiB0aGUg
Y3B1cG9vbCwgb3IganVzdCBjb21pbmcgYmFjayBvbmxpbmUuIEluIHdoaWNoCiAgICAgICogY2Fz
ZSwgdGhlcmUgbWF5IGJlIHVuaXRzIGluIHRoZSB3YWl0cXVldWUgdGhhdCB3ZSBjYW4gYXNzaWdu
IHRvIHVzCiAgICAgICogYW5kIHJ1bi4KICAgICAgKi8KLSAgICBpZiAoIHVubGlrZWx5KHJldC50
YXNrID09IE5VTEwpICkKKyAgICBpZiAoIHVubGlrZWx5KHByZXYtPm5leHRfdGFzayA9PSBOVUxM
KSApCiAgICAgewogICAgICAgICBzcGluX2xvY2soJnBydi0+d2FpdHFfbG9jayk7CiAKQEAgLTg1
NCw3ICs4NTEsNyBAQCBzdGF0aWMgc3RydWN0IHRhc2tfc2xpY2UgbnVsbF9zY2hlZHVsZShjb25z
dCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAg
ICAgICAgICB1bml0X2Fzc2lnbihwcnYsIHd2Yy0+dW5pdCwgc2NoZWRfY3B1KTsKICAgICAgICAg
ICAgICAgICAgICAgbGlzdF9kZWxfaW5pdCgmd3ZjLT53YWl0cV9lbGVtKTsKLSAgICAgICAgICAg
ICAgICAgICAgcmV0LnRhc2sgPSB3dmMtPnVuaXQ7CisgICAgICAgICAgICAgICAgICAgIHByZXYt
Pm5leHRfdGFzayA9IHd2Yy0+dW5pdDsKICAgICAgICAgICAgICAgICAgICAgZ290byB1bmxvY2s7
CiAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgfQpAQCAtODYyLDE1ICs4NTksMTcgQEAg
c3RhdGljIHN0cnVjdCB0YXNrX3NsaWNlIG51bGxfc2NoZWR1bGUoY29uc3Qgc3RydWN0IHNjaGVk
dWxlciAqb3BzLAogIHVubG9jazoKICAgICAgICAgc3Bpbl91bmxvY2soJnBydi0+d2FpdHFfbG9j
ayk7CiAKLSAgICAgICAgaWYgKCByZXQudGFzayA9PSBOVUxMICYmICFjcHVtYXNrX3Rlc3RfY3B1
KHNjaGVkX2NwdSwgJnBydi0+Y3B1c19mcmVlKSApCisgICAgICAgIGlmICggcHJldi0+bmV4dF90
YXNrID09IE5VTEwgJiYKKyAgICAgICAgICAgICAhY3B1bWFza190ZXN0X2NwdShzY2hlZF9jcHUs
ICZwcnYtPmNwdXNfZnJlZSkgKQogICAgICAgICAgICAgY3B1bWFza19zZXRfY3B1KHNjaGVkX2Nw
dSwgJnBydi0+Y3B1c19mcmVlKTsKICAgICB9CiAKLSAgICBpZiAoIHVubGlrZWx5KHJldC50YXNr
ID09IE5VTEwgfHwgIXVuaXRfcnVubmFibGUocmV0LnRhc2spKSApCi0gICAgICAgIHJldC50YXNr
ID0gc2NoZWRfaWRsZV91bml0KHNjaGVkX2NwdSk7CisgICAgaWYgKCB1bmxpa2VseShwcmV2LT5u
ZXh0X3Rhc2sgPT0gTlVMTCB8fCAhdW5pdF9ydW5uYWJsZShwcmV2LT5uZXh0X3Rhc2spKSApCisg
ICAgICAgIHByZXYtPm5leHRfdGFzayA9IHNjaGVkX2lkbGVfdW5pdChzY2hlZF9jcHUpOwogCi0g
ICAgTlVMTF9VTklUX0NIRUNLKHJldC50YXNrKTsKLSAgICByZXR1cm4gcmV0OworICAgIE5VTExf
VU5JVF9DSEVDSyhwcmV2LT5uZXh0X3Rhc2spOworCisgICAgcHJldi0+bmV4dF90YXNrLT5taWdy
YXRlZCA9IGZhbHNlOwogfQogCiBzdGF0aWMgaW5saW5lIHZvaWQgZHVtcF91bml0KHN0cnVjdCBu
dWxsX3ByaXZhdGUgKnBydiwgc3RydWN0IG51bGxfdW5pdCAqbnZjKQpkaWZmIC0tZ2l0IGEveGVu
L2NvbW1vbi9zY2hlZF9ydC5jIGIveGVuL2NvbW1vbi9zY2hlZF9ydC5jCmluZGV4IDE1MTM1M2I5
YTAuLmNmZDdkMzM0ZmEgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWRfcnQuYworKysgYi94
ZW4vY29tbW9uL3NjaGVkX3J0LmMKQEAgLTEwNTMsMTYgKzEwNTMsMTYgQEAgcnVucV9waWNrKGNv
bnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgY29uc3QgY3B1bWFza190ICptYXNrKQogICogc2No
ZWR1bGUgZnVuY3Rpb24gZm9yIHJ0IHNjaGVkdWxlci4KICAqIFRoZSBsb2NrIGlzIGFscmVhZHkg
Z3JhYmJlZCBpbiBzY2hlZHVsZS5jLCBubyBuZWVkIHRvIGxvY2sgaGVyZQogICovCi1zdGF0aWMg
c3RydWN0IHRhc2tfc2xpY2UKLXJ0X3NjaGVkdWxlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9w
cywgc190aW1lX3Qgbm93LCBib29sX3QgdGFza2xldF93b3JrX3NjaGVkdWxlZCkKK3N0YXRpYyB2
b2lkCitydF9zY2hlZHVsZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hl
ZF91bml0ICpjdXJydW5pdCwKKyAgICAgICAgICAgIHNfdGltZV90IG5vdywgYm9vbCB0YXNrbGV0
X3dvcmtfc2NoZWR1bGVkKQogewogICAgIGNvbnN0IHVuc2lnbmVkIGludCBjdXJfY3B1ID0gc21w
X3Byb2Nlc3Nvcl9pZCgpOwogICAgIGNvbnN0IHVuc2lnbmVkIGludCBzY2hlZF9jcHUgPSBzY2hl
ZF9nZXRfcmVzb3VyY2VfY3B1KGN1cl9jcHUpOwogICAgIHN0cnVjdCBydF9wcml2YXRlICpwcnYg
PSBydF9wcml2KG9wcyk7Ci0gICAgc3RydWN0IHJ0X3VuaXQgKmNvbnN0IHNjdXJyID0gcnRfdW5p
dChjdXJyZW50LT5zY2hlZF91bml0KTsKKyAgICBzdHJ1Y3QgcnRfdW5pdCAqY29uc3Qgc2N1cnIg
PSBydF91bml0KGN1cnJ1bml0KTsKICAgICBzdHJ1Y3QgcnRfdW5pdCAqc25leHQgPSBOVUxMOwot
ICAgIHN0cnVjdCB0YXNrX3NsaWNlIHJldCA9IHsgLm1pZ3JhdGVkID0gMCB9OwotICAgIHN0cnVj
dCBzY2hlZF91bml0ICpjdXJydW5pdCA9IGN1cnJlbnQtPnNjaGVkX3VuaXQ7CisgICAgYm9vbCBt
aWdyYXRlZCA9IGZhbHNlOwogCiAgICAgLyogVFJBQ0UgKi8KICAgICB7CkBAIC0xMTEwLDcgKzEx
MTAsNyBAQCBydF9zY2hlZHVsZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHNfdGltZV90
IG5vdywgYm9vbF90IHRhc2tsZXRfd29ya19zY2hlZAogICAgICAgICBfX3NldF9iaXQoX19SVERT
X2RlbGF5ZWRfcnVucV9hZGQsICZzY3Vyci0+ZmxhZ3MpOwogCiAgICAgc25leHQtPmxhc3Rfc3Rh
cnQgPSBub3c7Ci0gICAgcmV0LnRpbWUgPSAgLTE7IC8qIGlmIGFuIGlkbGUgdW5pdCBpcyBwaWNr
ZWQgKi8KKyAgICBjdXJydW5pdC0+bmV4dF90aW1lID0gIC0xOyAvKiBpZiBhbiBpZGxlIHVuaXQg
aXMgcGlja2VkICovCiAgICAgaWYgKCAhaXNfaWRsZV91bml0KHNuZXh0LT51bml0KSApCiAgICAg
ewogICAgICAgICBpZiAoIHNuZXh0ICE9IHNjdXJyICkKQEAgLTExMjEsMTMgKzExMjEsMTMgQEAg
cnRfc2NoZWR1bGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzX3RpbWVfdCBub3csIGJv
b2xfdCB0YXNrbGV0X3dvcmtfc2NoZWQKICAgICAgICAgaWYgKCBzY2hlZF91bml0X21hc3Rlcihz
bmV4dC0+dW5pdCkgIT0gc2NoZWRfY3B1ICkKICAgICAgICAgewogICAgICAgICAgICAgc2NoZWRf
c2V0X3JlcyhzbmV4dC0+dW5pdCwgZ2V0X3NjaGVkX3JlcyhzY2hlZF9jcHUpKTsKLSAgICAgICAg
ICAgIHJldC5taWdyYXRlZCA9IDE7CisgICAgICAgICAgICBtaWdyYXRlZCA9IHRydWU7CiAgICAg
ICAgIH0KLSAgICAgICAgcmV0LnRpbWUgPSBzbmV4dC0+Y3VyX2J1ZGdldDsgLyogaW52b2tlIHRo
ZSBzY2hlZHVsZXIgbmV4dCB0aW1lICovCisgICAgICAgIC8qIEludm9rZSB0aGUgc2NoZWR1bGVy
IG5leHQgdGltZS4gKi8KKyAgICAgICAgY3VycnVuaXQtPm5leHRfdGltZSA9IHNuZXh0LT5jdXJf
YnVkZ2V0OwogICAgIH0KLSAgICByZXQudGFzayA9IHNuZXh0LT51bml0OwotCi0gICAgcmV0dXJu
IHJldDsKKyAgICBjdXJydW5pdC0+bmV4dF90YXNrID0gc25leHQtPnVuaXQ7CisgICAgc25leHQt
PnVuaXQtPm1pZ3JhdGVkID0gbWlncmF0ZWQ7CiB9CiAKIC8qCmRpZmYgLS1naXQgYS94ZW4vY29t
bW9uL3NjaGVkdWxlLmMgYi94ZW4vY29tbW9uL3NjaGVkdWxlLmMKaW5kZXggODNmNWI4MzdhOS4u
NmYxYTZmYmQ2ZSAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9zY2hlZHVsZS5jCisrKyBiL3hlbi9j
b21tb24vc2NoZWR1bGUuYwpAQCAtMTE1LDE1ICsxMTUsMTQgQEAgc2NoZWRfaWRsZV9mcmVlX3Vk
YXRhKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgdm9pZCAqcHJpdikKIHsKIH0KIAotc3Rh
dGljIHN0cnVjdCB0YXNrX3NsaWNlIHNjaGVkX2lkbGVfc2NoZWR1bGUoCi0gICAgY29uc3Qgc3Ry
dWN0IHNjaGVkdWxlciAqb3BzLCBzX3RpbWVfdCBub3csCitzdGF0aWMgdm9pZCBzY2hlZF9pZGxl
X3NjaGVkdWxlKAorICAgIGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVk
X3VuaXQgKnVuaXQsIHNfdGltZV90IG5vdywKICAgICBib29sIHRhc2tsZXRfd29ya19zY2hlZHVs
ZWQpCiB7CiAgICAgY29uc3QgdW5zaWduZWQgaW50IGNwdSA9IHNtcF9wcm9jZXNzb3JfaWQoKTsK
LSAgICBzdHJ1Y3QgdGFza19zbGljZSByZXQgPSB7IC50aW1lID0gLTEgfTsKIAotICAgIHJldC50
YXNrID0gc2NoZWRfaWRsZV91bml0KGNwdSk7Ci0gICAgcmV0dXJuIHJldDsKKyAgICB1bml0LT5u
ZXh0X3RpbWUgPSAtMTsKKyAgICB1bml0LT5uZXh0X3Rhc2sgPSBzY2hlZF9pZGxlX3VuaXQoY3B1
KTsKIH0KIAogc3RhdGljIHN0cnVjdCBzY2hlZHVsZXIgc2NoZWRfaWRsZV9vcHMgPSB7CkBAIC0x
NzI0LDEwICsxNzIzLDkgQEAgc3RhdGljIHZvaWQgc2NoZWR1bGUodm9pZCkKICAgICBzX3RpbWVf
dCAgICAgICAgICAgICAgbm93OwogICAgIHN0cnVjdCBzY2hlZHVsZXIgICAgICpzY2hlZDsKICAg
ICB1bnNpZ25lZCBsb25nICAgICAgICAqdGFza2xldF93b3JrID0gJnRoaXNfY3B1KHRhc2tsZXRf
d29ya190b19kbyk7Ci0gICAgYm9vbF90ICAgICAgICAgICAgICAgIHRhc2tsZXRfd29ya19zY2hl
ZHVsZWQgPSAwOworICAgIGJvb2wgICAgICAgICAgICAgICAgICB0YXNrbGV0X3dvcmtfc2NoZWR1
bGVkID0gZmFsc2U7CiAgICAgc3RydWN0IHNjaGVkX3Jlc291cmNlICpzZDsKICAgICBzcGlubG9j
a190ICAgICAgICAgICAqbG9jazsKLSAgICBzdHJ1Y3QgdGFza19zbGljZSAgICAgbmV4dF9zbGlj
ZTsKICAgICBpbnQgY3B1ID0gc21wX3Byb2Nlc3Nvcl9pZCgpOwogCiAgICAgQVNTRVJUX05PVF9J
Tl9BVE9NSUMoKTsKQEAgLTE3NDMsMTIgKzE3NDEsMTIgQEAgc3RhdGljIHZvaWQgc2NoZWR1bGUo
dm9pZCkKICAgICAgICAgc2V0X2JpdChfVEFTS0xFVF9zY2hlZHVsZWQsIHRhc2tsZXRfd29yayk7
CiAgICAgICAgIC8qIGZhbGx0aHJvdWdoICovCiAgICAgY2FzZSBUQVNLTEVUX2VucXVldWVkfFRB
U0tMRVRfc2NoZWR1bGVkOgotICAgICAgICB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkID0gMTsKKyAg
ICAgICAgdGFza2xldF93b3JrX3NjaGVkdWxlZCA9IHRydWU7CiAgICAgICAgIGJyZWFrOwogICAg
IGNhc2UgVEFTS0xFVF9zY2hlZHVsZWQ6CiAgICAgICAgIGNsZWFyX2JpdChfVEFTS0xFVF9zY2hl
ZHVsZWQsIHRhc2tsZXRfd29yayk7CiAgICAgY2FzZSAwOgotICAgICAgICAvKnRhc2tsZXRfd29y
a19zY2hlZHVsZWQgPSAwOyovCisgICAgICAgIC8qdGFza2xldF93b3JrX3NjaGVkdWxlZCA9IGZh
bHNlOyovCiAgICAgICAgIGJyZWFrOwogICAgIGRlZmF1bHQ6CiAgICAgICAgIEJVRygpOwpAQCAt
MTc2MiwxNCArMTc2MCwxNCBAQCBzdGF0aWMgdm9pZCBzY2hlZHVsZSh2b2lkKQogCiAgICAgLyog
Z2V0IHBvbGljeS1zcGVjaWZpYyBkZWNpc2lvbiBvbiBzY2hlZHVsaW5nLi4uICovCiAgICAgc2No
ZWQgPSB0aGlzX2NwdShzY2hlZHVsZXIpOwotICAgIG5leHRfc2xpY2UgPSBzY2hlZC0+ZG9fc2No
ZWR1bGUoc2NoZWQsIG5vdywgdGFza2xldF93b3JrX3NjaGVkdWxlZCk7CisgICAgc2NoZWQtPmRv
X3NjaGVkdWxlKHNjaGVkLCBwcmV2LCBub3csIHRhc2tsZXRfd29ya19zY2hlZHVsZWQpOwogCi0g
ICAgbmV4dCA9IG5leHRfc2xpY2UudGFzazsKKyAgICBuZXh0ID0gcHJldi0+bmV4dF90YXNrOwog
CiAgICAgc2QtPmN1cnIgPSBuZXh0OwogCi0gICAgaWYgKCBuZXh0X3NsaWNlLnRpbWUgPj0gMCAp
IC8qIC12ZSBtZWFucyBubyBsaW1pdCAqLwotICAgICAgICBzZXRfdGltZXIoJnNkLT5zX3RpbWVy
LCBub3cgKyBuZXh0X3NsaWNlLnRpbWUpOworICAgIGlmICggcHJldi0+bmV4dF90aW1lID49IDAg
KSAvKiAtdmUgbWVhbnMgbm8gbGltaXQgKi8KKyAgICAgICAgc2V0X3RpbWVyKCZzZC0+c190aW1l
ciwgbm93ICsgcHJldi0+bmV4dF90aW1lKTsKIAogICAgIGlmICggdW5saWtlbHkocHJldiA9PSBu
ZXh0KSApCiAgICAgewpAQCAtMTc3Nyw3ICsxNzc1LDcgQEAgc3RhdGljIHZvaWQgc2NoZWR1bGUo
dm9pZCkKICAgICAgICAgVFJBQ0VfNEQoVFJDX1NDSEVEX1NXSVRDSF9JTkZDT05ULAogICAgICAg
ICAgICAgICAgICBuZXh0LT5kb21haW4tPmRvbWFpbl9pZCwgbmV4dC0+dW5pdF9pZCwKICAgICAg
ICAgICAgICAgICAgbm93IC0gcHJldi0+c3RhdGVfZW50cnlfdGltZSwKLSAgICAgICAgICAgICAg
ICAgbmV4dF9zbGljZS50aW1lKTsKKyAgICAgICAgICAgICAgICAgcHJldi0+bmV4dF90aW1lKTsK
ICAgICAgICAgdHJhY2VfY29udGludWVfcnVubmluZyhuZXh0LT52Y3B1X2xpc3QpOwogICAgICAg
ICByZXR1cm4gY29udGludWVfcnVubmluZyhwcmV2LT52Y3B1X2xpc3QpOwogICAgIH0KQEAgLTE3
ODksNyArMTc4Nyw3IEBAIHN0YXRpYyB2b2lkIHNjaGVkdWxlKHZvaWQpCiAgICAgICAgICAgICAg
bmV4dC0+ZG9tYWluLT5kb21haW5faWQsIG5leHQtPnVuaXRfaWQsCiAgICAgICAgICAgICAgKG5l
eHQtPnZjcHVfbGlzdC0+cnVuc3RhdGUuc3RhdGUgPT0gUlVOU1RBVEVfcnVubmFibGUpID8KICAg
ICAgICAgICAgICAobm93IC0gbmV4dC0+c3RhdGVfZW50cnlfdGltZSkgOiAwLAotICAgICAgICAg
ICAgIG5leHRfc2xpY2UudGltZSk7CisgICAgICAgICAgICAgcHJldi0+bmV4dF90aW1lKTsKIAog
ICAgIEFTU0VSVChwcmV2LT52Y3B1X2xpc3QtPnJ1bnN0YXRlLnN0YXRlID09IFJVTlNUQVRFX3J1
bm5pbmcpOwogCkBAIC0xODE4LDcgKzE4MTYsNyBAQCBzdGF0aWMgdm9pZCBzY2hlZHVsZSh2b2lk
KQogCiAgICAgc3RvcF90aW1lcigmcHJldi0+dmNwdV9saXN0LT5wZXJpb2RpY190aW1lcik7CiAK
LSAgICBpZiAoIG5leHRfc2xpY2UubWlncmF0ZWQgKQorICAgIGlmICggbmV4dC0+bWlncmF0ZWQg
KQogICAgICAgICB2Y3B1X21vdmVfaXJxcyhuZXh0LT52Y3B1X2xpc3QpOwogCiAgICAgdmNwdV9w
ZXJpb2RpY190aW1lcl93b3JrKG5leHQtPnZjcHVfbGlzdCk7CmRpZmYgLS1naXQgYS94ZW4vaW5j
bHVkZS94ZW4vc2NoZWQtaWYuaCBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5oCmluZGV4IGQ3
ZmFkMGNiY2MuLjA0MjNiZTk4N2QgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC1p
Zi5oCisrKyBiL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5oCkBAIC0yMzAsMTIgKzIzMCw2IEBA
IHN0YXRpYyBpbmxpbmUgc3BpbmxvY2tfdCAqcGNwdV9zY2hlZHVsZV90cnlsb2NrKHVuc2lnbmVk
IGludCBjcHUpCiAgICAgcmV0dXJuIE5VTEw7CiB9CiAKLXN0cnVjdCB0YXNrX3NsaWNlIHsKLSAg
ICBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdGFzazsKLSAgICBzX3RpbWVfdCAgICAgICAgICAgdGltZTsK
LSAgICBib29sX3QgICAgICAgICAgICAgbWlncmF0ZWQ7Ci19OwotCiBzdHJ1Y3Qgc2NoZWR1bGVy
IHsKICAgICBjaGFyICpuYW1lOyAgICAgICAgICAgICAvKiBmdWxsIG5hbWUgZm9yIHRoaXMgc2No
ZWR1bGVyICAgICAgKi8KICAgICBjaGFyICpvcHRfbmFtZTsgICAgICAgICAvKiBvcHRpb24gbmFt
ZSBmb3IgdGhpcyBzY2hlZHVsZXIgICAgKi8KQEAgLTI3OCw4ICsyNzIsOSBAQCBzdHJ1Y3Qgc2No
ZWR1bGVyIHsKICAgICB2b2lkICAgICAgICAgKCpjb250ZXh0X3NhdmVkKSAgKGNvbnN0IHN0cnVj
dCBzY2hlZHVsZXIgKiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVj
dCBzY2hlZF91bml0ICopOwogCi0gICAgc3RydWN0IHRhc2tfc2xpY2UgKCpkb19zY2hlZHVsZSkg
KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKiwgc190aW1lX3QsCi0gICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGJvb2xfdCB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkKTsKKyAgICB2
b2lkICAgICAgICAgKCpkb19zY2hlZHVsZSkgICAgKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKiwK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBzY2hlZF91bml0ICos
IHNfdGltZV90LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9vbCB0YXNr
bGV0X3dvcmtfc2NoZWR1bGVkKTsKIAogICAgIHN0cnVjdCBzY2hlZF9yZXNvdXJjZSAqKCpwaWNr
X3Jlc291cmNlKShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICosCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cnVjdCBzY2hlZF91bml0ICopOwpkaWZm
IC0tZ2l0IGEveGVuL2luY2x1ZGUveGVuL3NjaGVkLmggYi94ZW4vaW5jbHVkZS94ZW4vc2NoZWQu
aAppbmRleCA5MjI3MjI1NmVhLi5lYmY3MjNhODY2IDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS94
ZW4vc2NoZWQuaAorKysgYi94ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaApAQCAtMjc0LDYgKzI3NCw4
IEBAIHN0cnVjdCBzY2hlZF91bml0IHsKICAgICBib29sICAgICAgICAgICAgICAgICAgIGlzX3J1
bm5pbmc7CiAgICAgLyogRG9lcyBzb2Z0IGFmZmluaXR5IGFjdHVhbGx5IHBsYXkgYSByb2xlIChn
aXZlbiBoYXJkIGFmZmluaXR5KT8gKi8KICAgICBib29sICAgICAgICAgICAgICAgICAgIHNvZnRf
YWZmX2VmZmVjdGl2ZTsKKyAgICAvKiBJdGVtIGhhcyBiZWVuIG1pZ3JhdGVkIHRvIG90aGVyIGNw
dShzKS4gKi8KKyAgICBib29sICAgICAgICAgICAgICAgICAgIG1pZ3JhdGVkOwogCiAgICAgLyog
TGFzdCB0aW1lIHVuaXQgZ290IChkZS0pc2NoZWR1bGVkLiAqLwogICAgIHVpbnQ2NF90ICAgICAg
ICAgICAgICAgc3RhdGVfZW50cnlfdGltZTsKQEAgLTI4Niw2ICsyODgsMTAgQEAgc3RydWN0IHNj
aGVkX3VuaXQgewogICAgIGNwdW1hc2tfdmFyX3QgICAgICAgICAgY3B1X2hhcmRfYWZmaW5pdHlf
c2F2ZWQ7CiAgICAgLyogQml0bWFzayBvZiBDUFVzIG9uIHdoaWNoIHRoaXMgVkNQVSBwcmVmZXJz
IHRvIHJ1bi4gKi8KICAgICBjcHVtYXNrX3Zhcl90ICAgICAgICAgIGNwdV9zb2Z0X2FmZmluaXR5
OworCisgICAgLyogTmV4dCB1bml0IHRvIHJ1bi4gKi8KKyAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCAg
ICAgICpuZXh0X3Rhc2s7CisgICAgc190aW1lX3QgICAgICAgICAgICAgICAgbmV4dF90aW1lOwog
fTsKIAogI2RlZmluZSBmb3JfZWFjaF9zY2hlZF91bml0KGQsIHUpICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBcCi0tIAoyLjE2LjQKCgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1k
ZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21h
aWxtYW4vbGlzdGluZm8veGVuLWRldmVs

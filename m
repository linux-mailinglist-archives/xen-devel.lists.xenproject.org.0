Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 39FB8E9419
	for <lists+xen-devel@lfdr.de>; Wed, 30 Oct 2019 01:24:36 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iPbiv-0001Gi-Ka; Wed, 30 Oct 2019 00:20:29 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=wqvR=YX=oracle.com=joe.jin@srs-us1.protection.inumbo.net>)
 id 1iPbiu-0001Gd-MD
 for xen-devel@lists.xenproject.org; Wed, 30 Oct 2019 00:20:28 +0000
X-Inumbo-ID: 123c70f0-faab-11e9-951c-12813bfff9fa
Received: from aserp2120.oracle.com (unknown [141.146.126.78])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 123c70f0-faab-11e9-951c-12813bfff9fa;
 Wed, 30 Oct 2019 00:20:26 +0000 (UTC)
Received: from pps.filterd (aserp2120.oracle.com [127.0.0.1])
 by aserp2120.oracle.com (8.16.0.27/8.16.0.27) with SMTP id x9U0IsK5050339;
 Wed, 30 Oct 2019 00:20:23 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=oracle.com;
 h=subject : to : cc :
 references : from : message-id : date : mime-version : in-reply-to :
 content-type : content-transfer-encoding; s=corp-2019-08-05;
 bh=njqNI0jqRhuMYLK8yU65pH/44cLvOkc5VVQEpAjm1vw=;
 b=nLfyg0kl05yWaRUPa5LgIdZhoj68gS9jY+tSc+JzVZg1Y1f2v/s7YsjkaUMCUmGD4/uU
 vSQb5jtWuuQ806exujJDWQdUNf6gLKFR6PqUGipemRYi4++0vnp3b5wQJoRZgVPTgT9g
 ERVQDBbOi9aPM3iUGN3txMYx66UkRsJJKr9/OD/ulotAme+PKlEpNCIP6DHSp+/i9EA2
 TvG95IEU3U4utbRgJH3hS4uXFfHIpTIaFeBrLvDgF5yysitIW6y+kluQSuWcTwPJ5TG7
 tGTxNbt6yxneaHUxA8LdHwusN4DbpQn9BSXjqoLXA2rTJF2jSwq3HD0R8lVLEOVbxwh0 cg== 
Received: from aserp3020.oracle.com (aserp3020.oracle.com [141.146.126.70])
 by aserp2120.oracle.com with ESMTP id 2vxwhf8f80-1
 (version=TLSv1.2 cipher=ECDHE-RSA-AES256-GCM-SHA384 bits=256 verify=OK);
 Wed, 30 Oct 2019 00:20:22 +0000
Received: from pps.filterd (aserp3020.oracle.com [127.0.0.1])
 by aserp3020.oracle.com (8.16.0.27/8.16.0.27) with SMTP id x9U0IG8q077637;
 Wed, 30 Oct 2019 00:20:22 GMT
Received: from aserv0121.oracle.com (aserv0121.oracle.com [141.146.126.235])
 by aserp3020.oracle.com with ESMTP id 2vxwj578hn-1
 (version=TLSv1.2 cipher=ECDHE-RSA-AES256-GCM-SHA384 bits=256 verify=OK);
 Wed, 30 Oct 2019 00:20:22 +0000
Received: from abhmp0018.oracle.com (abhmp0018.oracle.com [141.146.116.24])
 by aserv0121.oracle.com (8.14.4/8.13.8) with ESMTP id x9U0KK4i007162;
 Wed, 30 Oct 2019 00:20:20 GMT
Received: from [10.159.241.152] (/10.159.241.152)
 by default (Oracle Beehive Gateway v4.0)
 with ESMTP ; Tue, 29 Oct 2019 17:20:20 -0700
To: Roger Pau Monne <roger.pau@citrix.com>, xen-devel@lists.xenproject.org
References: <20191009125252.3112-1-roger.pau@citrix.com>
From: Joe Jin <joe.jin@oracle.com>
Message-ID: <c42e0852-2eb5-63e8-f542-b4f5d4a1e0a8@oracle.com>
Date: Tue, 29 Oct 2019 17:20:18 -0700
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:60.0)
 Gecko/20100101 Thunderbird/60.9.0
MIME-Version: 1.0
In-Reply-To: <20191009125252.3112-1-roger.pau@citrix.com>
Content-Language: en-US
X-Proofpoint-Virus-Version: vendor=nai engine=6000 definitions=9425
 signatures=668685
X-Proofpoint-Spam-Details: rule=notspam policy=default score=0 suspectscore=0
 malwarescore=0
 phishscore=0 bulkscore=0 spamscore=0 mlxscore=0 mlxlogscore=999
 adultscore=0 classifier=spam adjust=0 reason=mlx scancount=1
 engine=8.0.1-1908290000 definitions=main-1910300002
X-Proofpoint-Virus-Version: vendor=nai engine=6000 definitions=9425
 signatures=668685
X-Proofpoint-Spam-Details: rule=notspam policy=default score=0
 priorityscore=1501 malwarescore=0
 suspectscore=0 phishscore=0 bulkscore=0 spamscore=0 clxscore=1015
 lowpriorityscore=0 mlxscore=0 impostorscore=0 mlxlogscore=999 adultscore=0
 classifier=spam adjust=0 reason=mlx scancount=1 engine=8.0.1-1908290000
 definitions=main-1910300002
Subject: Re: [Xen-devel] [PATCH v2] x86/passthrough: fix migration of MSI
 when using posted interrupts
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Andrew Cooper <andrew.cooper3@citrix.com>,
 Kevin Tian <kevin.tian@intel.com>, Wei Liu <wl@xen.org>,
 Jan Beulich <jbeulich@suse.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SGkgUm9nZXIgJiBKYW4sCgpJIGdvdCBteSB0ZXN0IGVudiBiYWNrLCBhbmQgYmFjayB0aGUgcGF0
Y2ggdG8gc3RhYmxlLTQuMTIsIHJ1biBzYW1lCnRlc3QsIEkgc3RpbGwgc2VlbiBvcmlnaW5hbCBp
c3N1ZSwgZ3Vlc3Qga2VybmVsIHByaW50ZWQgZXJyb3I6Cgoga2VybmVsOmRvX0lSUTogMjAuMTE0
IE5vIGlycSBoYW5kbGVyIGZvciB2ZWN0b3IgKGlycSAtMSkKCkFmdGVyIHRoYXQsIHBhc3MgdGhy
b3VnaCBpbmZpbmliYW5kIFZGIHN0b3BwZWQgdG8gd29yay4KCk15IHBhdGNoIGFzIGJlbG93LCBw
bGVhc2UgY2hlY2s6CgpkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L2h2bS92bGFwaWMuYyBiL3hl
bi9hcmNoL3g4Ni9odm0vdmxhcGljLmMKaW5kZXggYTFhNDNjZDc5Mi4uMmQxNzVkMmEwMCAxMDA2
NDQKLS0tIGEveGVuL2FyY2gveDg2L2h2bS92bGFwaWMuYworKysgYi94ZW4vYXJjaC94ODYvaHZt
L3ZsYXBpYy5jCkBAIC0xMTEsNiArMTExLDEyIEBAIHN0YXRpYyB2b2lkIHZsYXBpY19jbGVhcl9p
cnIoaW50IHZlY3Rvciwgc3RydWN0IHZsYXBpYyAqdmxhcGljKQogICAgIHZsYXBpY19jbGVhcl92
ZWN0b3IodmVjdG9yLCAmdmxhcGljLT5yZWdzLT5kYXRhW0FQSUNfSVJSXSk7CiB9CiAKK3ZvaWQg
dmxhcGljX3N5bmNfcGlyX3RvX2lycihzdHJ1Y3QgdmNwdSAqdikKK3sKKyAgICBpZiAoIGh2bV9m
dW5jcy5zeW5jX3Bpcl90b19pcnIgKQorICAgICAgICBodm1fZnVuY3Muc3luY19waXJfdG9faXJy
KHYpOworfQorCiBzdGF0aWMgaW50IHZsYXBpY19maW5kX2hpZ2hlc3RfaXJyKHN0cnVjdCB2bGFw
aWMgKnZsYXBpYykKIHsKICAgICBpZiAoIGh2bV9mdW5jcy5zeW5jX3Bpcl90b19pcnIgKQpkaWZm
IC0tZ2l0IGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvaW8uYyBiL3hlbi9kcml2ZXJzL3Bhc3N0
aHJvdWdoL2lvLmMKaW5kZXggNDI5MGM3YzcxMC4uYjYyOGFkZWE0YyAxMDA2NDQKLS0tIGEveGVu
L2RyaXZlcnMvcGFzc3Rocm91Z2gvaW8uYworKysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9p
by5jCkBAIC0zNDEsNyArMzQxLDcgQEAgaW50IHB0X2lycV9jcmVhdGVfYmluZCgKICAgICB7CiAg
ICAgICAgIHVpbnQ4X3QgZGVzdCwgZGVsaXZlcnlfbW9kZTsKICAgICAgICAgYm9vbCBkZXN0X21v
ZGU7Ci0gICAgICAgIGludCBkZXN0X3ZjcHVfaWQ7CisgICAgICAgIGludCBkZXN0X3ZjcHVfaWQs
IHByZXZfdmNwdV9pZCA9IC0xOwogICAgICAgICBjb25zdCBzdHJ1Y3QgdmNwdSAqdmNwdTsKICAg
ICAgICAgdWludDMyX3QgZ2ZsYWdzID0gcHRfaXJxX2JpbmQtPnUubXNpLmdmbGFncyAmCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgIH5YRU5fRE9NQ1RMX1ZNU0lfWDg2X1VOTUFTS0VEOwpAQCAt
NDExLDYgKzQxMSw3IEBAIGludCBwdF9pcnFfY3JlYXRlX2JpbmQoCiAKICAgICAgICAgICAgICAg
ICBwaXJxX2RwY2ktPmdtc2kuZ3ZlYyA9IHB0X2lycV9iaW5kLT51Lm1zaS5ndmVjOwogICAgICAg
ICAgICAgICAgIHBpcnFfZHBjaS0+Z21zaS5nZmxhZ3MgPSBnZmxhZ3M7CisgICAgICAgICAgICAg
ICAgcHJldl92Y3B1X2lkID0gcGlycV9kcGNpLT5nbXNpLmRlc3RfdmNwdV9pZDsKICAgICAgICAg
ICAgIH0KICAgICAgICAgfQogICAgICAgICAvKiBDYWxjdWxhdGUgZGVzdF92Y3B1X2lkIGZvciBN
U0ktdHlwZSBwaXJxIG1pZ3JhdGlvbi4gKi8KQEAgLTQzMiw3ICs0MzMsMTAgQEAgaW50IHB0X2ly
cV9jcmVhdGVfYmluZCgKICAgICAgICAgICAgICAgICB2Y3B1ID0gdmVjdG9yX2hhc2hpbmdfZGVz
dChkLCBkZXN0LCBkZXN0X21vZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgcGlycV9kcGNpLT5nbXNpLmd2ZWMpOwogICAgICAgICAgICAgaWYgKCB2Y3B1ICkK
KyAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICBwaXJxX2RwY2ktPmdtc2kucG9zdGVkID0g
dHJ1ZTsKKyAgICAgICAgICAgICAgICBwaXJxX2RwY2ktPmdtc2kuZGVzdF92Y3B1X2lkID0gdmNw
dS0+dmNwdV9pZDsKKyAgICAgICAgICAgIH0KICAgICAgICAgfQogICAgICAgICBpZiAoIHZjcHUg
JiYgaW9tbXVfZW5hYmxlZCApCiAgICAgICAgICAgICBodm1fbWlncmF0ZV9waXJxKHBpcnFfZHBj
aSwgdmNwdSk7CkBAIC00NDAsNyArNDQ0LDggQEAgaW50IHB0X2lycV9jcmVhdGVfYmluZCgKICAg
ICAgICAgLyogVXNlIGludGVycnVwdCBwb3N0aW5nIGlmIGl0IGlzIHN1cHBvcnRlZC4gKi8KICAg
ICAgICAgaWYgKCBpb21tdV9pbnRwb3N0ICkKICAgICAgICAgICAgIHBpX3VwZGF0ZV9pcnRlKHZj
cHUgPyAmdmNwdS0+YXJjaC5odm0udm14LnBpX2Rlc2MgOiBOVUxMLAotICAgICAgICAgICAgICAg
ICAgICAgICAgICAgaW5mbywgcGlycV9kcGNpLT5nbXNpLmd2ZWMpOworICAgICAgICAgICAgICAg
ICAgICAgICAgICAgaW5mbywgcGlycV9kcGNpLT5nbXNpLmd2ZWMsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICBwcmV2X3ZjcHVfaWQgPj0gMCA/IGQtPnZjcHVbcHJldl92Y3B1X2lkXSA6IE5V
TEwpOwogCiAgICAgICAgIGlmICggcHRfaXJxX2JpbmQtPnUubXNpLmdmbGFncyAmIFhFTl9ET01D
VExfVk1TSV9YODZfVU5NQVNLRUQgKQogICAgICAgICB7CkBAIC03MjksNyArNzM0LDkgQEAgaW50
IHB0X2lycV9kZXN0cm95X2JpbmQoCiAgICAgICAgICAgICB3aGF0ID0gImJvZ3VzIjsKICAgICB9
CiAgICAgZWxzZSBpZiAoIHBpcnFfZHBjaSAmJiBwaXJxX2RwY2ktPmdtc2kucG9zdGVkICkKLSAg
ICAgICAgcGlfdXBkYXRlX2lydGUoTlVMTCwgcGlycSwgMCk7CisgICAgICAgIHBpX3VwZGF0ZV9p
cnRlKE5VTEwsIHBpcnEsIDAsCisgICAgICAgICAgICAgICAgICAgICAgIHBpcnFfZHBjaS0+Z21z
aS5kZXN0X3ZjcHVfaWQgPj0gMAorICAgICAgICAgICAgICAgICAgICAgICA/IGQtPnZjcHVbcGly
cV9kcGNpLT5nbXNpLmRlc3RfdmNwdV9pZF0gOiBOVUxMKTsKIAogICAgIGlmICggcGlycV9kcGNp
ICYmIChwaXJxX2RwY2ktPmZsYWdzICYgSFZNX0lSUV9EUENJX01BUFBFRCkgJiYKICAgICAgICAg
IGxpc3RfZW1wdHkoJnBpcnFfZHBjaS0+ZGlnbF9saXN0KSApCmRpZmYgLS1naXQgYS94ZW4vZHJp
dmVycy9wYXNzdGhyb3VnaC92dGQvaW50cmVtYXAuYyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdo
L3Z0ZC9pbnRyZW1hcC5jCmluZGV4IGM5OTI3ZTQ3MDYuLmQ3ODhhNGI5ZTcgMTAwNjQ0Ci0tLSBh
L3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9pbnRyZW1hcC5jCisrKyBiL3hlbi9kcml2ZXJz
L3Bhc3N0aHJvdWdoL3Z0ZC9pbnRyZW1hcC5jCkBAIC05NjEsMTIgKzk2MSwxMyBAQCB2b2lkIGlv
bW11X2Rpc2FibGVfeDJhcGljX0lSKHZvaWQpCiAgICAgICAgIGRpc2FibGVfcWludmFsKGRyaGQt
PmlvbW11KTsKIH0KIAorI2lmZGVmIENPTkZJR19IVk0KIC8qCiAgKiBUaGlzIGZ1bmN0aW9uIGlz
IHVzZWQgdG8gdXBkYXRlIHRoZSBJUlRFIGZvciBwb3N0ZWQtaW50ZXJydXB0CiAgKiB3aGVuIGd1
ZXN0IGNoYW5nZXMgTVNJL01TSS1YIGluZm9ybWF0aW9uLgogICovCiBpbnQgcGlfdXBkYXRlX2ly
dGUoY29uc3Qgc3RydWN0IHBpX2Rlc2MgKnBpX2Rlc2MsIGNvbnN0IHN0cnVjdCBwaXJxICpwaXJx
LAotICAgIGNvbnN0IHVpbnQ4X3QgZ3ZlYykKKyAgICBjb25zdCB1aW50OF90IGd2ZWMsIHN0cnVj
dCB2Y3B1ICpwcmV2KQogewogICAgIHN0cnVjdCBpcnFfZGVzYyAqZGVzYzsKICAgICBzdHJ1Y3Qg
bXNpX2Rlc2MgKm1zaV9kZXNjOwpAQCAtOTc5LDggKzk4MCw4IEBAIGludCBwaV91cGRhdGVfaXJ0
ZShjb25zdCBzdHJ1Y3QgcGlfZGVzYyAqcGlfZGVzYywgY29uc3Qgc3RydWN0IHBpcnEgKnBpcnEs
CiAgICAgbXNpX2Rlc2MgPSBkZXNjLT5tc2lfZGVzYzsKICAgICBpZiAoICFtc2lfZGVzYyApCiAg
ICAgewotICAgICAgICByYyA9IC1FTk9ERVY7Ci0gICAgICAgIGdvdG8gdW5sb2NrX291dDsKKyAg
ICAgICAgc3Bpbl91bmxvY2tfaXJxKCZkZXNjLT5sb2NrKTsKKyAgICAgICAgcmV0dXJuIC1FTk9E
RVY7CiAgICAgfQogICAgIG1zaV9kZXNjLT5waV9kZXNjID0gcGlfZGVzYzsKICAgICBtc2lfZGVz
Yy0+Z3ZlYyA9IGd2ZWM7CkBAIC05ODksMTAgKzk5MCwxMCBAQCBpbnQgcGlfdXBkYXRlX2lydGUo
Y29uc3Qgc3RydWN0IHBpX2Rlc2MgKnBpX2Rlc2MsIGNvbnN0IHN0cnVjdCBwaXJxICpwaXJxLAog
CiAgICAgQVNTRVJUKHBjaWRldnNfbG9ja2VkKCkpOwogCi0gICAgcmV0dXJuIG1zaV9tc2dfd3Jp
dGVfcmVtYXBfcnRlKG1zaV9kZXNjLCAmbXNpX2Rlc2MtPm1zZyk7Ci0KLSB1bmxvY2tfb3V0Ogot
ICAgIHNwaW5fdW5sb2NrX2lycSgmZGVzYy0+bG9jayk7CisgICAgcmMgPSBtc2lfbXNnX3dyaXRl
X3JlbWFwX3J0ZShtc2lfZGVzYywgJm1zaV9kZXNjLT5tc2cpOworICAgIGlmICggIXJjICYmIHBy
ZXYgKQorICAgICAgICAgdmxhcGljX3N5bmNfcGlyX3RvX2lycihwcmV2KTsKIAogICAgIHJldHVy
biByYzsKIH0KKyNlbmRpZgpkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUvYXNtLXg4Ni9odm0vdmxh
cGljLmggYi94ZW4vaW5jbHVkZS9hc20teDg2L2h2bS92bGFwaWMuaAppbmRleCBkZGU2NmI0ZjBm
Li5iMDAxN2QxZGFlIDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS9hc20teDg2L2h2bS92bGFwaWMu
aAorKysgYi94ZW4vaW5jbHVkZS9hc20teDg2L2h2bS92bGFwaWMuaApAQCAtMTUwLDQgKzE1MCw2
IEBAIGJvb2xfdCB2bGFwaWNfbWF0Y2hfZGVzdCgKICAgICBjb25zdCBzdHJ1Y3QgdmxhcGljICp0
YXJnZXQsIGNvbnN0IHN0cnVjdCB2bGFwaWMgKnNvdXJjZSwKICAgICBpbnQgc2hvcnRfaGFuZCwg
dWludDMyX3QgZGVzdCwgYm9vbF90IGRlc3RfbW9kZSk7CiAKK3ZvaWQgdmxhcGljX3N5bmNfcGly
X3RvX2lycihzdHJ1Y3QgdmNwdSAqdik7CisKICNlbmRpZiAvKiBfX0FTTV9YODZfSFZNX1ZMQVBJ
Q19IX18gKi8KZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL2FzbS14ODYvaW9tbXUuaCBiL3hlbi9p
bmNsdWRlL2FzbS14ODYvaW9tbXUuaAppbmRleCA4ZGMzOTI0NzNkLi4zMmJmYTIzNjQ4IDEwMDY0
NAotLS0gYS94ZW4vaW5jbHVkZS9hc20teDg2L2lvbW11LmgKKysrIGIveGVuL2luY2x1ZGUvYXNt
LXg4Ni9pb21tdS5oCkBAIC05OSw3ICs5OSw3IEBAIHZvaWQgaW9tbXVfZGlzYWJsZV94MmFwaWNf
SVIodm9pZCk7CiBleHRlcm4gYm9vbCB1bnRydXN0ZWRfbXNpOwogCiBpbnQgcGlfdXBkYXRlX2ly
dGUoY29uc3Qgc3RydWN0IHBpX2Rlc2MgKnBpX2Rlc2MsIGNvbnN0IHN0cnVjdCBwaXJxICpwaXJx
LAotICAgICAgICAgICAgICAgICAgIGNvbnN0IHVpbnQ4X3QgZ3ZlYyk7CisgICAgICAgICAgICAg
ICAgICAgY29uc3QgdWludDhfdCBndmVjLCBzdHJ1Y3QgdmNwdSAqcHJldik7CiAKICNlbmRpZiAv
KiAhX19BUkNIX1g4Nl9JT01NVV9IX18gKi8KIC8qCgpUaGFua3MsCkpvZQoKT24gMTAvOS8xOSA1
OjUyIEFNLCBSb2dlciBQYXUgTW9ubmUgd3JvdGU6Cj4gV2hlbiB1c2luZyBwb3N0ZWQgaW50ZXJy
dXB0cyBhbmQgdGhlIGd1ZXN0IG1pZ3JhdGVzIE1TSSBmcm9tIHZDUFVzIFhlbgo+IG5lZWRzIHRv
IGZsdXNoIGFueSBwZW5kaW5nIFBJUlIgdmVjdG9ycyBvbiB0aGUgcHJldmlvdXMgdkNQVSwgb3Ig
ZWxzZQo+IHRob3NlIHZlY3RvcnMgY291bGQgZ2V0IHdyb25nbHkgaW5qZWN0ZWQgYXQgYSBsYXRl
ciBwb2ludCB3aGVuIHRoZSBNU0kKPiBmaWVsZHMgYXJlIGFscmVhZHkgdXBkYXRlZC4KPiAKPiBS
ZW5hbWUgc3luY19waXJfdG9faXJyIHRvIHZsYXBpY19zeW5jX3Bpcl90b19pcnIgYW5kIGV4cG9y
dCBpdCBzbyBpdAo+IGNhbiBiZSBjYWxsZWQgd2hlbiB1cGRhdGluZyB0aGUgcG9zdGVkIGludGVy
cnVwdCBkZXNjcmlwdG9yIGZpZWxkIGluCj4gcGlfdXBkYXRlX2lydGUuIFdoaWxlIHRoZXJlIGFs
c28gcmVtb3ZlIHRoZSB1bmxvY2tfb3V0IGZyb20KPiBwaV91cGRhdGVfaXJ0ZSwgaXQncyB1c2Vk
IGluIGEgc2luZ2xlIGdvdG8gYW5kIHJlbW92aW5nIGl0IG1ha2VzIHRoZQo+IGZ1bmN0aW9uIHNt
YWxsZXIuCj4gCj4gTm90ZSB0aGF0IFBJUlIgaXMgc3luY2VkIHRvIElSUiBib3RoIGluIHB0X2ly
cV9kZXN0cm95X2JpbmQgYW5kCj4gcHRfaXJxX2NyZWF0ZV9iaW5kIHdoZW4gdGhlIGludGVycnVw
dCBkZWxpdmVyeSBkYXRhIGlzIGJlaW5nIHVwZGF0ZWQuCj4gCj4gQWxzbyBzdG9yZSB0aGUgdkNQ
VSBJRCBpbiBtdWx0aS1kZXN0aW5hdGlvbiBtb2RlIHdoZW4gdXNpbmcgcG9zdGVkCj4gaW50ZXJy
dXB0cyBhbmQgdGhlIGludGVycnVwdCBpcyBib3VuZCB0byBhIHNpbmdsZSB2Q1BVIGluIG9yZGVy
IGZvcgo+IHBvc3RlZCBpbnRlcnJ1cHRzIHRvIGJlIHVzZWQuCj4gCj4gV2hpbGUgdGhlcmUgZ3Vh
cmQgcGlfdXBkYXRlX2lydGUgd2l0aCBDT05GSUdfSFZNIHNpbmNlIGl0J3Mgb25seSB1c2VkCj4g
d2l0aCBIVk0gZ3Vlc3RzLgo+IAo+IFJlcG9ydGVkLWJ5OiBKb2UgSmluIDxqb2UuamluQG9yYWNs
ZS5jb20+Cj4gU2lnbmVkLW9mZi1ieTogUm9nZXIgUGF1IE1vbm7DqSA8cm9nZXIucGF1QGNpdHJp
eC5jb20+Cj4gLS0tCj4gQ2M6IEpvZSBKaW4gPGpvZS5qaW5Ab3JhY2xlLmNvbT4KPiBDYzogSnVl
cmdlbiBHcm9zcyA8amdyb3NzQHN1c2UuY29tPgo+IC0tLQo+IEkgd291bGQgbGlrZSB0byBzZWUg
YSBidWcgZml4IGZvciB0aGlzIGlzc3VlIGluIDQuMTMuIFRoZSBmaXggaGVyZSBvbmx5Cj4gYWZm
ZWN0cyBwb3N0ZWQgaW50ZXJydXB0cywgaGVuY2UgSSB0aGluayB0aGUgcmlzayBvZiBicmVha2lu
ZyBhbnl0aGluZwo+IGVsc2UgaXMgbG93Lgo+IC0tLQo+IENoYW5nZXMgc2luY2UgdjE6Cj4gIC0g
U3RvcmUgdGhlIHZjcHUgaWQgYWxzbyBpbiBtdWx0aS1kZXN0IG1vZGUgaWYgdGhlIGludGVycnVw
dCBpcyBib3VuZAo+ICAgIHRvIGEgdmNwdSBmb3IgcG9zdGVkIGRlbGl2ZXJ5Lgo+ICAtIHMvI2lm
LyNpZmRlZi8uCj4gLS0tCj4gIHhlbi9hcmNoL3g4Ni9odm0vdmxhcGljLmMgICAgICAgICAgICAg
IHwgIDYgKysrLS0tCj4gIHhlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2lvLmMgICAgICAgICAgIHwg
MTMgKysrKysrKysrKy0tLQo+ICB4ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC92dGQvaW50cmVtYXAu
YyB8IDE1ICsrKysrKysrLS0tLS0tLQo+ICB4ZW4vaW5jbHVkZS9hc20teDg2L2h2bS92bGFwaWMu
aCAgICAgICB8ICAyICsrCj4gIHhlbi9pbmNsdWRlL2FzbS14ODYvaW9tbXUuaCAgICAgICAgICAg
IHwgIDIgKy0KPiAgNSBmaWxlcyBjaGFuZ2VkLCAyNCBpbnNlcnRpb25zKCspLCAxNCBkZWxldGlv
bnMoLSkKPiAKPiBkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L2h2bS92bGFwaWMuYyBiL3hlbi9h
cmNoL3g4Ni9odm0vdmxhcGljLmMKPiBpbmRleCA5NDY2MjU4ZDZmLi5kMjU1YWQ4ZGI3IDEwMDY0
NAo+IC0tLSBhL3hlbi9hcmNoL3g4Ni9odm0vdmxhcGljLmMKPiArKysgYi94ZW4vYXJjaC94ODYv
aHZtL3ZsYXBpYy5jCj4gQEAgLTEwNiw3ICsxMDYsNyBAQCBzdGF0aWMgdm9pZCB2bGFwaWNfY2xl
YXJfaXJyKGludCB2ZWN0b3IsIHN0cnVjdCB2bGFwaWMgKnZsYXBpYykKPiAgICAgIHZsYXBpY19j
bGVhcl92ZWN0b3IodmVjdG9yLCAmdmxhcGljLT5yZWdzLT5kYXRhW0FQSUNfSVJSXSk7Cj4gIH0K
PiAgCj4gLXN0YXRpYyB2b2lkIHN5bmNfcGlyX3RvX2lycihzdHJ1Y3QgdmNwdSAqdikKPiArdm9p
ZCB2bGFwaWNfc3luY19waXJfdG9faXJyKHN0cnVjdCB2Y3B1ICp2KQo+ICB7Cj4gICAgICBpZiAo
IGh2bV9mdW5jcy5zeW5jX3Bpcl90b19pcnIgKQo+ICAgICAgICAgIGFsdGVybmF0aXZlX3ZjYWxs
KGh2bV9mdW5jcy5zeW5jX3Bpcl90b19pcnIsIHYpOwo+IEBAIC0xMTQsNyArMTE0LDcgQEAgc3Rh
dGljIHZvaWQgc3luY19waXJfdG9faXJyKHN0cnVjdCB2Y3B1ICp2KQo+ICAKPiAgc3RhdGljIGlu
dCB2bGFwaWNfZmluZF9oaWdoZXN0X2lycihzdHJ1Y3QgdmxhcGljICp2bGFwaWMpCj4gIHsKPiAt
ICAgIHN5bmNfcGlyX3RvX2lycih2bGFwaWNfdmNwdSh2bGFwaWMpKTsKPiArICAgIHZsYXBpY19z
eW5jX3Bpcl90b19pcnIodmxhcGljX3ZjcHUodmxhcGljKSk7Cj4gIAo+ICAgICAgcmV0dXJuIHZs
YXBpY19maW5kX2hpZ2hlc3RfdmVjdG9yKCZ2bGFwaWMtPnJlZ3MtPmRhdGFbQVBJQ19JUlJdKTsK
PiAgfQo+IEBAIC0xNDkzLDcgKzE0OTMsNyBAQCBzdGF0aWMgaW50IGxhcGljX3NhdmVfcmVncyhz
dHJ1Y3QgdmNwdSAqdiwgaHZtX2RvbWFpbl9jb250ZXh0X3QgKmgpCj4gICAgICBpZiAoICFoYXNf
dmxhcGljKHYtPmRvbWFpbikgKQo+ICAgICAgICAgIHJldHVybiAwOwo+ICAKPiAtICAgIHN5bmNf
cGlyX3RvX2lycih2KTsKPiArICAgIHZsYXBpY19zeW5jX3Bpcl90b19pcnIodik7Cj4gIAo+ICAg
ICAgcmV0dXJuIGh2bV9zYXZlX2VudHJ5KExBUElDX1JFR1MsIHYtPnZjcHVfaWQsIGgsIHZjcHVf
dmxhcGljKHYpLT5yZWdzKTsKPiAgfQo+IGRpZmYgLS1naXQgYS94ZW4vZHJpdmVycy9wYXNzdGhy
b3VnaC9pby5jIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvaW8uYwo+IGluZGV4IGIyOTJlNzkz
ODIuLjViZjE4Nzc3MjYgMTAwNjQ0Cj4gLS0tIGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvaW8u
Ywo+ICsrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2lvLmMKPiBAQCAtMzQxLDcgKzM0MSw3
IEBAIGludCBwdF9pcnFfY3JlYXRlX2JpbmQoCj4gICAgICB7Cj4gICAgICAgICAgdWludDhfdCBk
ZXN0LCBkZWxpdmVyeV9tb2RlOwo+ICAgICAgICAgIGJvb2wgZGVzdF9tb2RlOwo+IC0gICAgICAg
IGludCBkZXN0X3ZjcHVfaWQ7Cj4gKyAgICAgICAgaW50IGRlc3RfdmNwdV9pZCwgcHJldl92Y3B1
X2lkID0gLTE7Cj4gICAgICAgICAgY29uc3Qgc3RydWN0IHZjcHUgKnZjcHU7Cj4gICAgICAgICAg
dWludDMyX3QgZ2ZsYWdzID0gcHRfaXJxX2JpbmQtPnUubXNpLmdmbGFncyAmCj4gICAgICAgICAg
ICAgICAgICAgICAgICAgICAgflhFTl9ET01DVExfVk1TSV9YODZfVU5NQVNLRUQ7Cj4gQEAgLTQx
MSw2ICs0MTEsNyBAQCBpbnQgcHRfaXJxX2NyZWF0ZV9iaW5kKAo+ICAKPiAgICAgICAgICAgICAg
ICAgIHBpcnFfZHBjaS0+Z21zaS5ndmVjID0gcHRfaXJxX2JpbmQtPnUubXNpLmd2ZWM7Cj4gICAg
ICAgICAgICAgICAgICBwaXJxX2RwY2ktPmdtc2kuZ2ZsYWdzID0gZ2ZsYWdzOwo+ICsgICAgICAg
ICAgICAgICAgcHJldl92Y3B1X2lkID0gcGlycV9kcGNpLT5nbXNpLmRlc3RfdmNwdV9pZDsKPiAg
ICAgICAgICAgICAgfQo+ICAgICAgICAgIH0KPiAgICAgICAgICAvKiBDYWxjdWxhdGUgZGVzdF92
Y3B1X2lkIGZvciBNU0ktdHlwZSBwaXJxIG1pZ3JhdGlvbi4gKi8KPiBAQCAtNDMyLDcgKzQzMywx
MCBAQCBpbnQgcHRfaXJxX2NyZWF0ZV9iaW5kKAo+ICAgICAgICAgICAgICAgICAgdmNwdSA9IHZl
Y3Rvcl9oYXNoaW5nX2Rlc3QoZCwgZGVzdCwgZGVzdF9tb2RlLAo+ICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgcGlycV9kcGNpLT5nbXNpLmd2ZWMpOwo+ICAgICAg
ICAgICAgICBpZiAoIHZjcHUgKQo+ICsgICAgICAgICAgICB7Cj4gICAgICAgICAgICAgICAgICBw
aXJxX2RwY2ktPmdtc2kucG9zdGVkID0gdHJ1ZTsKPiArICAgICAgICAgICAgICAgIHBpcnFfZHBj
aS0+Z21zaS5kZXN0X3ZjcHVfaWQgPSB2Y3B1LT52Y3B1X2lkOwo+ICsgICAgICAgICAgICB9Cj4g
ICAgICAgICAgfQo+ICAgICAgICAgIGlmICggdmNwdSAmJiBpc19pb21tdV9lbmFibGVkKGQpICkK
PiAgICAgICAgICAgICAgaHZtX21pZ3JhdGVfcGlycShwaXJxX2RwY2ksIHZjcHUpOwo+IEBAIC00
NDAsNyArNDQ0LDggQEAgaW50IHB0X2lycV9jcmVhdGVfYmluZCgKPiAgICAgICAgICAvKiBVc2Ug
aW50ZXJydXB0IHBvc3RpbmcgaWYgaXQgaXMgc3VwcG9ydGVkLiAqLwo+ICAgICAgICAgIGlmICgg
aW9tbXVfaW50cG9zdCApCj4gICAgICAgICAgICAgIHBpX3VwZGF0ZV9pcnRlKHZjcHUgPyAmdmNw
dS0+YXJjaC5odm0udm14LnBpX2Rlc2MgOiBOVUxMLAo+IC0gICAgICAgICAgICAgICAgICAgICAg
ICAgICBpbmZvLCBwaXJxX2RwY2ktPmdtc2kuZ3ZlYyk7Cj4gKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGluZm8sIHBpcnFfZHBjaS0+Z21zaS5ndmVjLAo+ICsgICAgICAgICAgICAgICAgICAg
ICAgICAgICBwcmV2X3ZjcHVfaWQgPj0gMCA/IGQtPnZjcHVbcHJldl92Y3B1X2lkXSA6IE5VTEwp
Owo+ICAKPiAgICAgICAgICBpZiAoIHB0X2lycV9iaW5kLT51Lm1zaS5nZmxhZ3MgJiBYRU5fRE9N
Q1RMX1ZNU0lfWDg2X1VOTUFTS0VEICkKPiAgICAgICAgICB7Cj4gQEAgLTcyOSw3ICs3MzQsOSBA
QCBpbnQgcHRfaXJxX2Rlc3Ryb3lfYmluZCgKPiAgICAgICAgICAgICAgd2hhdCA9ICJib2d1cyI7
Cj4gICAgICB9Cj4gICAgICBlbHNlIGlmICggcGlycV9kcGNpICYmIHBpcnFfZHBjaS0+Z21zaS5w
b3N0ZWQgKQo+IC0gICAgICAgIHBpX3VwZGF0ZV9pcnRlKE5VTEwsIHBpcnEsIDApOwo+ICsgICAg
ICAgIHBpX3VwZGF0ZV9pcnRlKE5VTEwsIHBpcnEsIDAsCj4gKyAgICAgICAgICAgICAgICAgICAg
ICAgcGlycV9kcGNpLT5nbXNpLmRlc3RfdmNwdV9pZCA+PSAwCj4gKyAgICAgICAgICAgICAgICAg
ICAgICAgPyBkLT52Y3B1W3BpcnFfZHBjaS0+Z21zaS5kZXN0X3ZjcHVfaWRdIDogTlVMTCk7Cj4g
IAo+ICAgICAgaWYgKCBwaXJxX2RwY2kgJiYgKHBpcnFfZHBjaS0+ZmxhZ3MgJiBIVk1fSVJRX0RQ
Q0lfTUFQUEVEKSAmJgo+ICAgICAgICAgICBsaXN0X2VtcHR5KCZwaXJxX2RwY2ktPmRpZ2xfbGlz
dCkgKQo+IGRpZmYgLS1naXQgYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC92dGQvaW50cmVtYXAu
YyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9pbnRyZW1hcC5jCj4gaW5kZXggYmY4NDYx
OTVjNC4uMDdjMWMxNjI3YSAxMDA2NDQKPiAtLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC92
dGQvaW50cmVtYXAuYwo+ICsrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9pbnRyZW1h
cC5jCj4gQEAgLTk0NiwxMiArOTQ2LDEzIEBAIHZvaWQgaW50ZWxfaW9tbXVfZGlzYWJsZV9laW0o
dm9pZCkKPiAgICAgICAgICBkaXNhYmxlX3FpbnZhbChkcmhkLT5pb21tdSk7Cj4gIH0KPiAgCj4g
KyNpZmRlZiBDT05GSUdfSFZNCj4gIC8qCj4gICAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byB1
cGRhdGUgdGhlIElSVEUgZm9yIHBvc3RlZC1pbnRlcnJ1cHQKPiAgICogd2hlbiBndWVzdCBjaGFu
Z2VzIE1TSS9NU0ktWCBpbmZvcm1hdGlvbi4KPiAgICovCj4gIGludCBwaV91cGRhdGVfaXJ0ZShj
b25zdCBzdHJ1Y3QgcGlfZGVzYyAqcGlfZGVzYywgY29uc3Qgc3RydWN0IHBpcnEgKnBpcnEsCj4g
LSAgICBjb25zdCB1aW50OF90IGd2ZWMpCj4gKyAgICBjb25zdCB1aW50OF90IGd2ZWMsIHN0cnVj
dCB2Y3B1ICpwcmV2KQo+ICB7Cj4gICAgICBzdHJ1Y3QgaXJxX2Rlc2MgKmRlc2M7Cj4gICAgICBz
dHJ1Y3QgbXNpX2Rlc2MgKm1zaV9kZXNjOwo+IEBAIC05NjQsOCArOTY1LDggQEAgaW50IHBpX3Vw
ZGF0ZV9pcnRlKGNvbnN0IHN0cnVjdCBwaV9kZXNjICpwaV9kZXNjLCBjb25zdCBzdHJ1Y3QgcGly
cSAqcGlycSwKPiAgICAgIG1zaV9kZXNjID0gZGVzYy0+bXNpX2Rlc2M7Cj4gICAgICBpZiAoICFt
c2lfZGVzYyApCj4gICAgICB7Cj4gLSAgICAgICAgcmMgPSAtRU5PREVWOwo+IC0gICAgICAgIGdv
dG8gdW5sb2NrX291dDsKPiArICAgICAgICBzcGluX3VubG9ja19pcnEoJmRlc2MtPmxvY2spOwo+
ICsgICAgICAgIHJldHVybiAtRU5PREVWOwo+ICAgICAgfQo+ICAgICAgbXNpX2Rlc2MtPnBpX2Rl
c2MgPSBwaV9kZXNjOwo+ICAgICAgbXNpX2Rlc2MtPmd2ZWMgPSBndmVjOwo+IEBAIC05NzQsMTAg
Kzk3NSwxMCBAQCBpbnQgcGlfdXBkYXRlX2lydGUoY29uc3Qgc3RydWN0IHBpX2Rlc2MgKnBpX2Rl
c2MsIGNvbnN0IHN0cnVjdCBwaXJxICpwaXJxLAo+ICAKPiAgICAgIEFTU0VSVChwY2lkZXZzX2xv
Y2tlZCgpKTsKPiAgCj4gLSAgICByZXR1cm4gbXNpX21zZ193cml0ZV9yZW1hcF9ydGUobXNpX2Rl
c2MsICZtc2lfZGVzYy0+bXNnKTsKPiAtCj4gLSB1bmxvY2tfb3V0Ogo+IC0gICAgc3Bpbl91bmxv
Y2tfaXJxKCZkZXNjLT5sb2NrKTsKPiArICAgIHJjID0gbXNpX21zZ193cml0ZV9yZW1hcF9ydGUo
bXNpX2Rlc2MsICZtc2lfZGVzYy0+bXNnKTsKPiArICAgIGlmICggIXJjICYmIHByZXYgKQo+ICsg
ICAgICAgICB2bGFwaWNfc3luY19waXJfdG9faXJyKHByZXYpOwo+ICAKPiAgICAgIHJldHVybiBy
YzsKPiAgfQo+ICsjZW5kaWYKPiBkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUvYXNtLXg4Ni9odm0v
dmxhcGljLmggYi94ZW4vaW5jbHVkZS9hc20teDg2L2h2bS92bGFwaWMuaAo+IGluZGV4IGRkZTY2
YjRmMGYuLmIwMDE3ZDFkYWUgMTAwNjQ0Cj4gLS0tIGEveGVuL2luY2x1ZGUvYXNtLXg4Ni9odm0v
dmxhcGljLmgKPiArKysgYi94ZW4vaW5jbHVkZS9hc20teDg2L2h2bS92bGFwaWMuaAo+IEBAIC0x
NTAsNCArMTUwLDYgQEAgYm9vbF90IHZsYXBpY19tYXRjaF9kZXN0KAo+ICAgICAgY29uc3Qgc3Ry
dWN0IHZsYXBpYyAqdGFyZ2V0LCBjb25zdCBzdHJ1Y3QgdmxhcGljICpzb3VyY2UsCj4gICAgICBp
bnQgc2hvcnRfaGFuZCwgdWludDMyX3QgZGVzdCwgYm9vbF90IGRlc3RfbW9kZSk7Cj4gIAo+ICt2
b2lkIHZsYXBpY19zeW5jX3Bpcl90b19pcnIoc3RydWN0IHZjcHUgKnYpOwo+ICsKPiAgI2VuZGlm
IC8qIF9fQVNNX1g4Nl9IVk1fVkxBUElDX0hfXyAqLwo+IGRpZmYgLS1naXQgYS94ZW4vaW5jbHVk
ZS9hc20teDg2L2lvbW11LmggYi94ZW4vaW5jbHVkZS9hc20teDg2L2lvbW11LmgKPiBpbmRleCA4
NTc0MWY3Yzk2Li4zMTRkY2ZiZTQ3IDEwMDY0NAo+IC0tLSBhL3hlbi9pbmNsdWRlL2FzbS14ODYv
aW9tbXUuaAo+ICsrKyBiL3hlbi9pbmNsdWRlL2FzbS14ODYvaW9tbXUuaAo+IEBAIC0xMTksNyAr
MTE5LDcgQEAgc3RhdGljIGlubGluZSB2b2lkIGlvbW11X2Rpc2FibGVfeDJhcGljKHZvaWQpCj4g
IGV4dGVybiBib29sIHVudHJ1c3RlZF9tc2k7Cj4gIAo+ICBpbnQgcGlfdXBkYXRlX2lydGUoY29u
c3Qgc3RydWN0IHBpX2Rlc2MgKnBpX2Rlc2MsIGNvbnN0IHN0cnVjdCBwaXJxICpwaXJxLAo+IC0g
ICAgICAgICAgICAgICAgICAgY29uc3QgdWludDhfdCBndmVjKTsKPiArICAgICAgICAgICAgICAg
ICAgIGNvbnN0IHVpbnQ4X3QgZ3ZlYywgc3RydWN0IHZjcHUgKnByZXYpOwo+ICAKPiAgI2VuZGlm
IC8qICFfX0FSQ0hfWDg2X0lPTU1VX0hfXyAqLwo+ICAvKgo+IAoKCl9fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVu
LWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcv
bWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

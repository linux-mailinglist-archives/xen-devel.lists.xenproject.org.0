Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 56C281467E2
	for <lists+xen-devel@lfdr.de>; Thu, 23 Jan 2020 13:24:33 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iubVE-00072o-B0; Thu, 23 Jan 2020 12:22:28 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=wqmU=3M=amazon.co.uk=prvs=2848fc5af=pdurrant@srs-us1.protection.inumbo.net>)
 id 1iubVD-00072R-0h
 for xen-devel@lists.xenproject.org; Thu, 23 Jan 2020 12:22:27 +0000
X-Inumbo-ID: fed7bc04-3dda-11ea-b833-bc764e2007e4
Received: from smtp-fw-33001.amazon.com (unknown [207.171.190.10])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id fed7bc04-3dda-11ea-b833-bc764e2007e4;
 Thu, 23 Jan 2020 12:22:18 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amazon.com; i=@amazon.com; q=dns/txt; s=amazon201209;
 t=1579782138; x=1611318138;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=F2Jn7Oj/403sGkcntZ7Z+Hp3IyknzYHqJrAEOkEXvgM=;
 b=f03T112pzTV3vMyGfDFNV9Z1SZLot/A/a/mQfabFfYjVBfNyg9LERSEL
 FEMya5DfY1SXGAKJ4tUr+3MamMvmlJ2Q416IddvjvUnTS2dj5Ym+yEens
 PYsoWTg+uZU8ATAGVyUVz5PYjZqnRaDK9b6o7KCT/g4JaqC69TSan6EFD I=;
IronPort-SDR: k6Ffq+ajyQUoUFpuFsUWmqypjdgFDNX6SaoW9xMH+X2AN/kF0xXgEGj0cmwJp25U3EL6J7ohuZ
 g+VKeanmIz+g==
X-IronPort-AV: E=Sophos;i="5.70,353,1574121600"; d="scan'208";a="21944591"
Received: from sea32-co-svc-lb4-vlan3.sea.corp.amazon.com (HELO
 email-inbound-relay-2b-4ff6265a.us-west-2.amazon.com) ([10.47.23.38])
 by smtp-border-fw-out-33001.sea14.amazon.com with ESMTP;
 23 Jan 2020 12:22:17 +0000
Received: from EX13MTAUEA002.ant.amazon.com
 (pdx4-ws-svc-p6-lb7-vlan3.pdx.amazon.com [10.170.41.166])
 by email-inbound-relay-2b-4ff6265a.us-west-2.amazon.com (Postfix) with ESMTPS
 id 6E91AA2AD3; Thu, 23 Jan 2020 12:22:16 +0000 (UTC)
Received: from EX13D32EUB002.ant.amazon.com (10.43.166.114) by
 EX13MTAUEA002.ant.amazon.com (10.43.61.77) with Microsoft SMTP Server (TLS)
 id 15.0.1236.3; Thu, 23 Jan 2020 12:21:58 +0000
Received: from EX13MTAUEA001.ant.amazon.com (10.43.61.82) by
 EX13D32EUB002.ant.amazon.com (10.43.166.114) with Microsoft SMTP Server (TLS)
 id 15.0.1367.3; Thu, 23 Jan 2020 12:21:57 +0000
Received: from u2f063a87eabd5f.cbg10.amazon.com (10.125.106.135) by
 mail-relay.amazon.com (10.43.61.243) with Microsoft SMTP Server id
 15.0.1367.3 via Frontend Transport; Thu, 23 Jan 2020 12:21:55 +0000
From: Paul Durrant <pdurrant@amazon.com>
To: <xen-devel@lists.xenproject.org>
Date: Thu, 23 Jan 2020 12:21:40 +0000
Message-ID: <20200123122141.1419-4-pdurrant@amazon.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20200123122141.1419-1-pdurrant@amazon.com>
References: <20200123122141.1419-1-pdurrant@amazon.com>
MIME-Version: 1.0
Precedence: Bulk
Subject: [Xen-devel] [PATCH v2 3/3] x86 / vmx: use a 'normal' domheap page
 for APIC_DEFAULT_PHYS_BASE
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Kevin Tian <kevin.tian@intel.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Julien Grall <julien@xen.org>,
 Jun Nakajima <jun.nakajima@intel.com>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>, Paul Durrant <pdurrant@amazon.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

dm14X2FsbG9jX3ZsYXBpY19tYXBwaW5nKCkgY3VycmVudGx5IGNvbnRhaW5zIHNvbWUgdmVyeSBv
ZGQgbG9va2luZyBjb2RlCnRoYXQgYWxsb2NhdGVzIGEgTUVNRl9ub19vd25lciBkb21oZWFwIHBh
Z2UgYW5kIHRoZW4gc2hhcmVzIHdpdGggdGhlIGd1ZXN0CmFzIGlmIGl0IHdlcmUgYSB4ZW5oZWFw
IHBhZ2UuIFRoaXMgdGhlbiByZXF1aXJlcyB2bXhfZnJlZV92bGFwaWNfbWFwcGluZygpCnRvIGNh
bGwgYSBzcGVjaWFsIGZ1bmN0aW9uIGluIHRoZSBtbSBjb2RlOiBmcmVlX3NoYXJlZF9kb21oZWFw
X3BhZ2UoKS4KCkJ5IHVzaW5nIGEgJ25vcm1hbCcgZG9taGVhcCBwYWdlIChpLmUuIGJ5IG5vdCBw
YXNzaW5nIE1FTUZfbm9fb3duZXIgdG8KYWxsb2NfZG9taGVhcF9wYWdlKCkpLCB0aGUgb2RkIGxv
b2tpbmcgY29kZSBpbiB2bXhfYWxsb2NfdmxhcGljX21hcHBpbmcoKQpjYW4gc2ltcGx5IHVzZSBn
ZXRfcGFnZV9hbmRfdHlwZSgpIHRvIHNldCB1cCBhIHdyaXRhYmxlIG1hcHBpbmcgYmVmb3JlCmlu
c2VydGlvbiBpbiB0aGUgUDJNIGFuZCB2bXhfZnJlZV92bGFwaWNfbWFwcGluZygpIGNhbiBzaW1w
bHkgcmVsZWFzZSB0aGUKcGFnZSB1c2luZyBwdXRfcGFnZV9hbGxvY19yZWYoKSBmb2xsb3dlZCBi
eSBwdXRfcGFnZV9hbmRfdHlwZSgpLiBUaGlzCnRoZW4gYWxsb3dzIGZyZWVfc2hhcmVkX2RvbWhl
YXBfcGFnZSgpIHRvIGJlIHB1cmdlZC4KClRoZXJlIGlzLCBob3dldmVyLCBzb21lIGZhbGwtb3V0
IGZyb20gdGhpcyBzaW1wbGlmaWNhdGlvbjoKCi0gYWxsb2NfZG9taGVhcF9wYWdlKCkgd2lsbCBu
b3cgY2FsbCBhc3NpZ25fcGFnZXMoKSBhbmQgcnVuIGludG8gdGhlIGZhY3QKICB0aGF0ICdtYXhf
cGFnZXMnIGlzIG5vdCBzZXQgdW50aWwgc29tZSB0aW1lIGFmdGVyIGRvbWFpbl9jcmVhdGUoKS4g
VG8KICBhdm9pZCBhbiBhbGxvY2F0aW9uIGZhaWx1cmUsIGRvbWFpbl9jcmVhdGUoKSBpcyBtb2Rp
ZmllZCB0byBzZXQKICBtYXhfcGFnZXMgdG8gYW4gaW5pdGlhbCB2YWx1ZSwgc3VmZmljaWVudCB0
byBjb3ZlciBhbnkgZG9taGVhcAogIGFsbG9jYXRpb25zIHJlcXVpcmVkIHRvIGNvbXBsZXRlIGRv
bWFpbiBjcmVhdGlvbi4gVGhlIHZhbHVlIHdpbGwgYmUKICBzZXQgdG8gdGhlICdyZWFsJyBtYXhf
cGFnZXMgd2hlbiB0aGUgdG9vbC1zdGFjayBsYXRlciBwZXJmb3JtcyB0aGUKICBYRU5fRE9NQ1RM
X21heF9tZW0gb3BlcmF0aW9uLCB0aHVzIGFsbG93aW5nIHRoZSByZXN0IG9mIHRoZSBkb21haW4n
cwogIG1lbW9yeSB0byBiZSBhbGxvY2F0ZWQuCgotIEJlY2F1c2UgdGhlIGRvbWhlYXAgcGFnZSBp
cyBubyBsb25nZXIgYSBwc2V1ZG8teGVuaGVhcCBwYWdlLCB0aGUKICByZWZlcmVuY2UgY291bnRp
bmcgd2lsbCBwcmV2ZW50IHRoZSBkb21haW4gZnJvbSBiZWluZyBkZXN0cm95ZWQuIFRodXMKICB0
aGUgY2FsbCB0byB2bXhfZnJlZV92bGFwaWNfbWFwcGluZygpIGlzIG1vdmVkIGZyb20gdGhlCiAg
ZG9tYWluX2Rlc3Ryb3koKSBtZXRob2QgaW50byB0aGUgZG9tYWluX3JlbGlucXVpc2hfcmVzb3Vy
Y2VzKCkgbWV0aG9kLgogIFdoaWxzdCBpbiB0aGUgYXJlYSwgbWFrZSB0aGUgZG9tYWluX2Rlc3Ry
b3koKSBtZXRob2QgYW4gb3B0aW9uYWwKICBhbHRlcm5hdGl2ZV92Y2FsbCgpIChzaW5jZSBpdCB3
aWxsIG5vIGxvbmdlciBwZWZvcm0gYW55IGZ1bmN0aW9uIGluIFZNWAogIGFuZCBpcyBzdHViYmVk
IGluIFNWTSBhbnl3YXkpLgoKU2lnbmVkLW9mZi1ieTogUGF1bCBEdXJyYW50IDxwZHVycmFudEBh
bWF6b24uY29tPgotLS0KQ2M6IEphbiBCZXVsaWNoIDxqYmV1bGljaEBzdXNlLmNvbT4KQ2M6IEFu
ZHJldyBDb29wZXIgPGFuZHJldy5jb29wZXIzQGNpdHJpeC5jb20+CkNjOiBXZWkgTGl1IDx3bEB4
ZW4ub3JnPgpDYzogIlJvZ2VyIFBhdSBNb25uw6kiIDxyb2dlci5wYXVAY2l0cml4LmNvbT4KQ2M6
IEdlb3JnZSBEdW5sYXAgPEdlb3JnZS5EdW5sYXBAZXUuY2l0cml4LmNvbT4KQ2M6IElhbiBKYWNr
c29uIDxpYW4uamFja3NvbkBldS5jaXRyaXguY29tPgpDYzogSnVsaWVuIEdyYWxsIDxqdWxpZW5A
eGVuLm9yZz4KQ2M6IEtvbnJhZCBSemVzenV0ZWsgV2lsayA8a29ucmFkLndpbGtAb3JhY2xlLmNv
bT4KQ2M6IFN0ZWZhbm8gU3RhYmVsbGluaSA8c3N0YWJlbGxpbmlAa2VybmVsLm9yZz4KQ2M6IEp1
biBOYWthamltYSA8anVuLm5ha2FqaW1hQGludGVsLmNvbT4KQ2M6IEtldmluIFRpYW4gPGtldmlu
LnRpYW5AaW50ZWwuY29tPgoKdjI6CiAtIFNldCBhbiBpbml0aWFsIHZhbHVlIGZvciBtYXhfcGFn
ZXMgcmF0aGVyIHRoYW4gYXZvaWRpbmcgdGhlIGNoZWNrIGluCiAgIGFzc2lnbl9wYWdlcygpCiAt
IE1ha2UgZG9tYWluX2Rlc3Ryb3koKSBvcHRpb25hbAotLS0KIHhlbi9hcmNoL3g4Ni9odm0vaHZt
LmMgICAgIHwgIDQgKysrLQogeGVuL2FyY2gveDg2L2h2bS9zdm0vc3ZtLmMgfCAgNSAtLS0tLQog
eGVuL2FyY2gveDg2L2h2bS92bXgvdm14LmMgfCAyNSArKysrKysrKysrKysrKysrKysrKy0tLS0t
CiB4ZW4vYXJjaC94ODYvbW0uYyAgICAgICAgICB8IDEwIC0tLS0tLS0tLS0KIHhlbi9jb21tb24v
ZG9tYWluLmMgICAgICAgIHwgIDggKysrKysrKysKIHhlbi9pbmNsdWRlL2FzbS14ODYvbW0uaCAg
IHwgIDIgLS0KIDYgZmlsZXMgY2hhbmdlZCwgMzEgaW5zZXJ0aW9ucygrKSwgMjMgZGVsZXRpb25z
KC0pCgpkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L2h2bS9odm0uYyBiL3hlbi9hcmNoL3g4Ni9o
dm0vaHZtLmMKaW5kZXggZTUxYzA3NzI2OS4uZDI2MTBmNWYwMSAxMDA2NDQKLS0tIGEveGVuL2Fy
Y2gveDg2L2h2bS9odm0uYworKysgYi94ZW4vYXJjaC94ODYvaHZtL2h2bS5jCkBAIC03NDYsNyAr
NzQ2LDkgQEAgdm9pZCBodm1fZG9tYWluX2Rlc3Ryb3koc3RydWN0IGRvbWFpbiAqZCkKIAogICAg
IGh2bV9kZXN0cm95X2NhY2hlYXR0cl9yZWdpb25fbGlzdChkKTsKIAotICAgIGh2bV9mdW5jcy5k
b21haW5fZGVzdHJveShkKTsKKyAgICBpZiAoIGh2bV9mdW5jcy5kb21haW5fZGVzdHJveSApCisg
ICAgICAgIGFsdGVybmF0aXZlX3ZjYWxsKGh2bV9mdW5jcy5kb21haW5fZGVzdHJveSwgZCk7CisK
ICAgICBydGNfZGVpbml0KGQpOwogICAgIHN0ZHZnYV9kZWluaXQoZCk7CiAgICAgdmlvYXBpY19k
ZWluaXQoZCk7CmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvaHZtL3N2bS9zdm0uYyBiL3hlbi9h
cmNoL3g4Ni9odm0vc3ZtL3N2bS5jCmluZGV4IGIxYzM3NmQ0NTUuLmI3ZjY3ZjlmMDMgMTAwNjQ0
Ci0tLSBhL3hlbi9hcmNoL3g4Ni9odm0vc3ZtL3N2bS5jCisrKyBiL3hlbi9hcmNoL3g4Ni9odm0v
c3ZtL3N2bS5jCkBAIC0xMTU1LDEwICsxMTU1LDYgQEAgc3RhdGljIGludCBzdm1fZG9tYWluX2lu
aXRpYWxpc2Uoc3RydWN0IGRvbWFpbiAqZCkKICAgICByZXR1cm4gMDsKIH0KIAotc3RhdGljIHZv
aWQgc3ZtX2RvbWFpbl9kZXN0cm95KHN0cnVjdCBkb21haW4gKmQpCi17Ci19Ci0KIHN0YXRpYyBp
bnQgc3ZtX3ZjcHVfaW5pdGlhbGlzZShzdHJ1Y3QgdmNwdSAqdikKIHsKICAgICBpbnQgcmM7CkBA
IC0yNDI1LDcgKzI0MjEsNiBAQCBzdGF0aWMgc3RydWN0IGh2bV9mdW5jdGlvbl90YWJsZSBfX2lu
aXRkYXRhIHN2bV9mdW5jdGlvbl90YWJsZSA9IHsKICAgICAuY3B1X3VwICAgICAgICAgICAgICAg
PSBzdm1fY3B1X3VwLAogICAgIC5jcHVfZG93biAgICAgICAgICAgICA9IHN2bV9jcHVfZG93biwK
ICAgICAuZG9tYWluX2luaXRpYWxpc2UgICAgPSBzdm1fZG9tYWluX2luaXRpYWxpc2UsCi0gICAg
LmRvbWFpbl9kZXN0cm95ICAgICAgID0gc3ZtX2RvbWFpbl9kZXN0cm95LAogICAgIC52Y3B1X2lu
aXRpYWxpc2UgICAgICA9IHN2bV92Y3B1X2luaXRpYWxpc2UsCiAgICAgLnZjcHVfZGVzdHJveSAg
ICAgICAgID0gc3ZtX3ZjcHVfZGVzdHJveSwKICAgICAuc2F2ZV9jcHVfY3R4dCAgICAgICAgPSBz
dm1fc2F2ZV92bWNiX2N0eHQsCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvaHZtL3ZteC92bXgu
YyBiL3hlbi9hcmNoL3g4Ni9odm0vdm14L3ZteC5jCmluZGV4IDg3MDY5NTRkNzMuLmY3NmZkZDRm
OTYgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9odm0vdm14L3ZteC5jCisrKyBiL3hlbi9hcmNo
L3g4Ni9odm0vdm14L3ZteC5jCkBAIC00MjAsNyArNDIwLDcgQEAgc3RhdGljIGludCB2bXhfZG9t
YWluX2luaXRpYWxpc2Uoc3RydWN0IGRvbWFpbiAqZCkKICAgICByZXR1cm4gMDsKIH0KIAotc3Rh
dGljIHZvaWQgdm14X2RvbWFpbl9kZXN0cm95KHN0cnVjdCBkb21haW4gKmQpCitzdGF0aWMgdm9p
ZCB2bXhfZG9tYWluX3JlbGlucXVpc2hfcmVzb3VyY2VzKHN0cnVjdCBkb21haW4gKmQpCiB7CiAg
ICAgaWYgKCAhaGFzX3ZsYXBpYyhkKSApCiAgICAgICAgIHJldHVybjsKQEAgLTIyNDEsNyArMjI0
MSw3IEBAIHN0YXRpYyBzdHJ1Y3QgaHZtX2Z1bmN0aW9uX3RhYmxlIF9faW5pdGRhdGEgdm14X2Z1
bmN0aW9uX3RhYmxlID0gewogICAgIC5jcHVfdXBfcHJlcGFyZSAgICAgICA9IHZteF9jcHVfdXBf
cHJlcGFyZSwKICAgICAuY3B1X2RlYWQgICAgICAgICAgICAgPSB2bXhfY3B1X2RlYWQsCiAgICAg
LmRvbWFpbl9pbml0aWFsaXNlICAgID0gdm14X2RvbWFpbl9pbml0aWFsaXNlLAotICAgIC5kb21h
aW5fZGVzdHJveSAgICAgICA9IHZteF9kb21haW5fZGVzdHJveSwKKyAgICAuZG9tYWluX3JlbGlu
cXVpc2hfcmVzb3VyY2VzID0gdm14X2RvbWFpbl9yZWxpbnF1aXNoX3Jlc291cmNlcywKICAgICAu
dmNwdV9pbml0aWFsaXNlICAgICAgPSB2bXhfdmNwdV9pbml0aWFsaXNlLAogICAgIC52Y3B1X2Rl
c3Ryb3kgICAgICAgICA9IHZteF92Y3B1X2Rlc3Ryb3ksCiAgICAgLnNhdmVfY3B1X2N0eHQgICAg
ICAgID0gdm14X3NhdmVfdm1jc19jdHh0LApAQCAtMzAyOSwxMiArMzAyOSwyMiBAQCBzdGF0aWMg
aW50IHZteF9hbGxvY192bGFwaWNfbWFwcGluZyhzdHJ1Y3QgZG9tYWluICpkKQogICAgIGlmICgg
IWNwdV9oYXNfdm14X3ZpcnR1YWxpemVfYXBpY19hY2Nlc3NlcyApCiAgICAgICAgIHJldHVybiAw
OwogCi0gICAgcGcgPSBhbGxvY19kb21oZWFwX3BhZ2UoZCwgTUVNRl9ub19vd25lcik7CisgICAg
cGcgPSBhbGxvY19kb21oZWFwX3BhZ2UoZCwgMCk7CiAgICAgaWYgKCAhcGcgKQogICAgICAgICBy
ZXR1cm4gLUVOT01FTTsKKworICAgIGlmICggIWdldF9wYWdlX2FuZF90eXBlKHBnLCBkLCBQR1Rf
d3JpdGFibGVfcGFnZSkgKQorICAgIHsKKyAgICAgICAgLyoKKyAgICAgICAgICogVGhlIGRvbWFp
biBjYW4ndCBwb3NzaWJseSBrbm93IGFib3V0IHRoaXMgcGFnZSB5ZXQsIHNvIGZhaWx1cmUKKyAg
ICAgICAgICogaGVyZSBpcyBhIGNsZWFyIGluZGljYXRpb24gb2Ygc29tZXRoaW5nIGZpc2h5IGdv
aW5nIG9uLgorICAgICAgICAgKi8KKyAgICAgICAgZG9tYWluX2NyYXNoKGQpOworICAgICAgICBy
ZXR1cm4gLUVOT0RBVEE7CisgICAgfQorCiAgICAgbWZuID0gcGFnZV90b19tZm4ocGcpOwogICAg
IGNsZWFyX2RvbWFpbl9wYWdlKG1mbik7Ci0gICAgc2hhcmVfeGVuX3BhZ2Vfd2l0aF9ndWVzdChw
ZywgZCwgU0hBUkVfcncpOwogICAgIGQtPmFyY2guaHZtLnZteC5hcGljX2FjY2Vzc19tZm4gPSBt
Zm47CiAKICAgICByZXR1cm4gc2V0X21taW9fcDJtX2VudHJ5KGQsIHBhZGRyX3RvX3BmbihBUElD
X0RFRkFVTFRfUEhZU19CQVNFKSwgbWZuLApAQCAtMzA0OCw3ICszMDU4LDEyIEBAIHN0YXRpYyB2
b2lkIHZteF9mcmVlX3ZsYXBpY19tYXBwaW5nKHN0cnVjdCBkb21haW4gKmQpCiAKICAgICBkLT5h
cmNoLmh2bS52bXguYXBpY19hY2Nlc3NfbWZuID0gSU5WQUxJRF9NRk47CiAgICAgaWYgKCAhbWZu
X2VxKG1mbiwgSU5WQUxJRF9NRk4pICkKLSAgICAgICAgZnJlZV9zaGFyZWRfZG9taGVhcF9wYWdl
KG1mbl90b19wYWdlKG1mbikpOworICAgIHsKKyAgICAgICAgc3RydWN0IHBhZ2VfaW5mbyAqcGcg
PSBtZm5fdG9fcGFnZShtZm4pOworCisgICAgICAgIHB1dF9wYWdlX2FsbG9jX3JlZihwZyk7Cisg
ICAgICAgIHB1dF9wYWdlX2FuZF90eXBlKHBnKTsKKyAgICB9CiB9CiAKIHN0YXRpYyB2b2lkIHZt
eF9pbnN0YWxsX3ZsYXBpY19tYXBwaW5nKHN0cnVjdCB2Y3B1ICp2KQpkaWZmIC0tZ2l0IGEveGVu
L2FyY2gveDg2L21tLmMgYi94ZW4vYXJjaC94ODYvbW0uYwppbmRleCA2NTQxOTBlOWU5Li4yYTZk
MmU4YWY5IDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYvbW0uYworKysgYi94ZW4vYXJjaC94ODYv
bW0uYwpAQCAtNDk2LDE2ICs0OTYsNiBAQCB2b2lkIHNoYXJlX3hlbl9wYWdlX3dpdGhfZ3Vlc3Qo
c3RydWN0IHBhZ2VfaW5mbyAqcGFnZSwgc3RydWN0IGRvbWFpbiAqZCwKICAgICBzcGluX3VubG9j
aygmZC0+cGFnZV9hbGxvY19sb2NrKTsKIH0KIAotdm9pZCBmcmVlX3NoYXJlZF9kb21oZWFwX3Bh
Z2Uoc3RydWN0IHBhZ2VfaW5mbyAqcGFnZSkKLXsKLSAgICBwdXRfcGFnZV9hbGxvY19yZWYocGFn
ZSk7Ci0gICAgaWYgKCAhdGVzdF9hbmRfY2xlYXJfYml0KF9QR0NfeGVuX2hlYXAsICZwYWdlLT5j
b3VudF9pbmZvKSApCi0gICAgICAgIEFTU0VSVF9VTlJFQUNIQUJMRSgpOwotICAgIHBhZ2UtPnUu
aW51c2UudHlwZV9pbmZvID0gMDsKLSAgICBwYWdlX3NldF9vd25lcihwYWdlLCBOVUxMKTsKLSAg
ICBmcmVlX2RvbWhlYXBfcGFnZShwYWdlKTsKLX0KLQogdm9pZCBtYWtlX2NyMyhzdHJ1Y3QgdmNw
dSAqdiwgbWZuX3QgbWZuKQogewogICAgIHN0cnVjdCBkb21haW4gKmQgPSB2LT5kb21haW47CmRp
ZmYgLS1naXQgYS94ZW4vY29tbW9uL2RvbWFpbi5jIGIveGVuL2NvbW1vbi9kb21haW4uYwppbmRl
eCBlZTNmOWZmZDNlLi4zMGM3NzdhY2I4IDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL2RvbWFpbi5j
CisrKyBiL3hlbi9jb21tb24vZG9tYWluLmMKQEAgLTMzOSw2ICszMzksOCBAQCBzdGF0aWMgaW50
IHNhbml0aXNlX2RvbWFpbl9jb25maWcoc3RydWN0IHhlbl9kb21jdGxfY3JlYXRlZG9tYWluICpj
b25maWcpCiAgICAgcmV0dXJuIGFyY2hfc2FuaXRpc2VfZG9tYWluX2NvbmZpZyhjb25maWcpOwog
fQogCisjZGVmaW5lIERPTUFJTl9JTklUX1BBR0VTIDEKKwogc3RydWN0IGRvbWFpbiAqZG9tYWlu
X2NyZWF0ZShkb21pZF90IGRvbWlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1
Y3QgeGVuX2RvbWN0bF9jcmVhdGVkb21haW4gKmNvbmZpZywKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgYm9vbCBpc19wcml2KQpAQCAtNDQxLDYgKzQ0MywxMiBAQCBzdHJ1Y3QgZG9tYWlu
ICpkb21haW5fY3JlYXRlKGRvbWlkX3QgZG9taWQsCiAgICAgICAgIHJhZGl4X3RyZWVfaW5pdCgm
ZC0+cGlycV90cmVlKTsKICAgICB9CiAKKyAgICAvKgorICAgICAqIEFsbG93IGEgbGltaXRlZCBu
dW1iZXIgb2Ygc3BlY2lhbCBwYWdlcyB0byBiZSBhbGxvY2F0ZWQgZm9yIHRoZQorICAgICAqIGRv
bWFpbgorICAgICAqLworICAgIGQtPm1heF9wYWdlcyA9IERPTUFJTl9JTklUX1BBR0VTOworCiAg
ICAgaWYgKCAoZXJyID0gYXJjaF9kb21haW5fY3JlYXRlKGQsIGNvbmZpZykpICE9IDAgKQogICAg
ICAgICBnb3RvIGZhaWw7CiAgICAgaW5pdF9zdGF0dXMgfD0gSU5JVF9hcmNoOwpkaWZmIC0tZ2l0
IGEveGVuL2luY2x1ZGUvYXNtLXg4Ni9tbS5oIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9tbS5oCmlu
ZGV4IDJjYTg4ODJhZDAuLmU0MjlmMzgyMjggMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL2FzbS14
ODYvbW0uaAorKysgYi94ZW4vaW5jbHVkZS9hc20teDg2L21tLmgKQEAgLTMxNyw4ICszMTcsNiBA
QCBzdHJ1Y3QgcGFnZV9pbmZvCiAKICNkZWZpbmUgbWFkZHJfZ2V0X293bmVyKG1hKSAgIChwYWdl
X2dldF9vd25lcihtYWRkcl90b19wYWdlKChtYSkpKSkKIAotZXh0ZXJuIHZvaWQgZnJlZV9zaGFy
ZWRfZG9taGVhcF9wYWdlKHN0cnVjdCBwYWdlX2luZm8gKnBhZ2UpOwotCiAjZGVmaW5lIGZyYW1l
X3RhYmxlICgoc3RydWN0IHBhZ2VfaW5mbyAqKUZSQU1FVEFCTEVfVklSVF9TVEFSVCkKIGV4dGVy
biB1bnNpZ25lZCBsb25nIG1heF9wYWdlOwogZXh0ZXJuIHVuc2lnbmVkIGxvbmcgdG90YWxfcGFn
ZXM7Ci0tIAoyLjIwLjEKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0
Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRl
dmVs

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 9731B87DA9
	for <lists+xen-devel@lfdr.de>; Fri,  9 Aug 2019 17:04:24 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hw6Mv-000050-Iq; Fri, 09 Aug 2019 14:59:49 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=yG4W=WF=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1hw6MG-00076M-N2
 for xen-devel@lists.xenproject.org; Fri, 09 Aug 2019 14:59:08 +0000
X-Inumbo-ID: 2eab5001-bab6-11e9-8980-bc764e045a96
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 2eab5001-bab6-11e9-8980-bc764e045a96;
 Fri, 09 Aug 2019 14:58:44 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 1F91BB03C;
 Fri,  9 Aug 2019 14:58:43 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Fri,  9 Aug 2019 16:58:00 +0200
Message-Id: <20190809145833.1020-16-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190809145833.1020-1-jgross@suse.com>
References: <20190809145833.1020-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v2 15/48] xen/sched: make rt scheduler vcpu
 agnostic.
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 George Dunlap <george.dunlap@eu.citrix.com>, Meng Xu <mengxu@cis.upenn.edu>,
 Dario Faggioli <dfaggioli@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

U3dpdGNoIHJ0IHNjaGVkdWxlciBjb21wbGV0ZWx5IGZyb20gdmNwdSB0byBzY2hlZF91bml0IHVz
YWdlLgoKU2lnbmVkLW9mZi1ieTogSnVlcmdlbiBHcm9zcyA8amdyb3NzQHN1c2UuY29tPgotLS0K
IHhlbi9jb21tb24vc2NoZWRfcnQuYyB8IDM1NiArKysrKysrKysrKysrKysrKysrKysrKystLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDE3NCBpbnNlcnRpb25zKCsp
LCAxODIgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZF9ydC5jIGIv
eGVuL2NvbW1vbi9zY2hlZF9ydC5jCmluZGV4IGRmMWE4NzRjOTcuLjk1MjYyYWZmOTUgMTAwNjQ0
Ci0tLSBhL3hlbi9jb21tb24vc2NoZWRfcnQuYworKysgYi94ZW4vY29tbW9uL3NjaGVkX3J0LmMK
QEAgLTM2LDcgKzM2LDcgQEAKICAqCiAgKiBNaWdyYXRpb24gY29tcGVuc2F0aW9uIGFuZCByZXNp
c3QgbGlrZSBjcmVkaXQyIHRvIGJldHRlciB1c2UgY2FjaGU7CiAgKiBMb2NrIEhvbGRlciBQcm9i
bGVtLCB1c2luZyB5aWVsZD8KLSAqIFNlbGYgc3dpdGNoIHByb2JsZW06IFZDUFVzIG9mIHRoZSBz
YW1lIGRvbWFpbiBtYXkgcHJlZW1wdCBlYWNoIG90aGVyOworICogU2VsZiBzd2l0Y2ggcHJvYmxl
bTogVU5JVHMgb2YgdGhlIHNhbWUgZG9tYWluIG1heSBwcmVlbXB0IGVhY2ggb3RoZXI7CiAgKi8K
IAogLyoKQEAgLTQ0LDMwICs0NCwzMCBAQAogICoKICAqIFRoaXMgc2NoZWR1bGVyIGZvbGxvd3Mg
dGhlIFByZWVtcHRpdmUgR2xvYmFsIEVhcmxpZXN0IERlYWRsaW5lIEZpcnN0IChFREYpCiAgKiB0
aGVvcnkgaW4gcmVhbC10aW1lIGZpZWxkLgotICogQXQgYW55IHNjaGVkdWxpbmcgcG9pbnQsIHRo
ZSBWQ1BVIHdpdGggZWFybGllciBkZWFkbGluZSBoYXMgaGlnaGVyIHByaW9yaXR5LgotICogVGhl
IHNjaGVkdWxlciBhbHdheXMgcGlja3MgaGlnaGVzdCBwcmlvcml0eSBWQ1BVIHRvIHJ1biBvbiBh
IGZlYXNpYmxlIFBDUFUuCi0gKiBBIFBDUFUgaXMgZmVhc2libGUgaWYgdGhlIFZDUFUgY2FuIHJ1
biBvbiB0aGlzIFBDUFUgYW5kICh0aGUgUENQVSBpcyBpZGxlIG9yCi0gKiBoYXMgYSBsb3dlci1w
cmlvcml0eSBWQ1BVIHJ1bm5pbmcgb24gaXQuKQorICogQXQgYW55IHNjaGVkdWxpbmcgcG9pbnQs
IHRoZSBVTklUIHdpdGggZWFybGllciBkZWFkbGluZSBoYXMgaGlnaGVyIHByaW9yaXR5LgorICog
VGhlIHNjaGVkdWxlciBhbHdheXMgcGlja3MgaGlnaGVzdCBwcmlvcml0eSBVTklUIHRvIHJ1biBv
biBhIGZlYXNpYmxlIFBDUFUuCisgKiBBIFBDUFUgaXMgZmVhc2libGUgaWYgdGhlIFVOSVQgY2Fu
IHJ1biBvbiB0aGlzIFBDUFUgYW5kICh0aGUgUENQVSBpcyBpZGxlIG9yCisgKiBoYXMgYSBsb3dl
ci1wcmlvcml0eSBVTklUIHJ1bm5pbmcgb24gaXQuKQogICoKLSAqIEVhY2ggVkNQVSBoYXMgYSBk
ZWRpY2F0ZWQgcGVyaW9kLCBidWRnZXQgYW5kIGEgZXh0cmF0aW1lIGZsYWcKLSAqIFRoZSBkZWFk
bGluZSBvZiBhIFZDUFUgaXMgYXQgdGhlIGVuZCBvZiBlYWNoIHBlcmlvZDsKLSAqIEEgVkNQVSBo
YXMgaXRzIGJ1ZGdldCByZXBsZW5pc2hlZCBhdCB0aGUgYmVnaW5uaW5nIG9mIGVhY2ggcGVyaW9k
OwotICogV2hpbGUgc2NoZWR1bGVkLCBhIFZDUFUgYnVybnMgaXRzIGJ1ZGdldC4KLSAqIFRoZSBW
Q1BVIG5lZWRzIHRvIGZpbmlzaCBpdHMgYnVkZ2V0IGJlZm9yZSBpdHMgZGVhZGxpbmUgaW4gZWFj
aCBwZXJpb2Q7Ci0gKiBUaGUgVkNQVSBkaXNjYXJkcyBpdHMgdW51c2VkIGJ1ZGdldCBhdCB0aGUg
ZW5kIG9mIGVhY2ggcGVyaW9kLgotICogV2hlbiBhIFZDUFUgcnVucyBvdXQgb2YgYnVkZ2V0IGlu
IGEgcGVyaW9kLCBpZiBpdHMgZXh0cmF0aW1lIGZsYWcgaXMgc2V0LAotICogdGhlIFZDUFUgaW5j
cmVhc2VzIGl0cyBwcmlvcml0eV9sZXZlbCBieSAxIGFuZCByZWZpbGxzIGl0cyBidWRnZXQ7IG90
aGVyd2lzZSwKKyAqIEVhY2ggVU5JVCBoYXMgYSBkZWRpY2F0ZWQgcGVyaW9kLCBidWRnZXQgYW5k
IGEgZXh0cmF0aW1lIGZsYWcKKyAqIFRoZSBkZWFkbGluZSBvZiBhbiBVTklUIGlzIGF0IHRoZSBl
bmQgb2YgZWFjaCBwZXJpb2Q7CisgKiBBbiBVTklUIGhhcyBpdHMgYnVkZ2V0IHJlcGxlbmlzaGVk
IGF0IHRoZSBiZWdpbm5pbmcgb2YgZWFjaCBwZXJpb2Q7CisgKiBXaGlsZSBzY2hlZHVsZWQsIGFu
IFVOSVQgYnVybnMgaXRzIGJ1ZGdldC4KKyAqIFRoZSBVTklUIG5lZWRzIHRvIGZpbmlzaCBpdHMg
YnVkZ2V0IGJlZm9yZSBpdHMgZGVhZGxpbmUgaW4gZWFjaCBwZXJpb2Q7CisgKiBUaGUgVU5JVCBk
aXNjYXJkcyBpdHMgdW51c2VkIGJ1ZGdldCBhdCB0aGUgZW5kIG9mIGVhY2ggcGVyaW9kLgorICog
V2hlbiBhbiBVTklUIHJ1bnMgb3V0IG9mIGJ1ZGdldCBpbiBhIHBlcmlvZCwgaWYgaXRzIGV4dHJh
dGltZSBmbGFnIGlzIHNldCwKKyAqIHRoZSBVTklUIGluY3JlYXNlcyBpdHMgcHJpb3JpdHlfbGV2
ZWwgYnkgMSBhbmQgcmVmaWxscyBpdHMgYnVkZ2V0OyBvdGhlcndpc2UsCiAgKiBpdCBoYXMgdG8g
d2FpdCB1bnRpbCBuZXh0IHBlcmlvZC4KICAqCi0gKiBFYWNoIFZDUFUgaXMgaW1wbGVtZW50ZWQg
YXMgYSBkZWZlcmFibGUgc2VydmVyLgotICogV2hlbiBhIFZDUFUgaGFzIGEgdGFzayBydW5uaW5n
IG9uIGl0LCBpdHMgYnVkZ2V0IGlzIGNvbnRpbnVvdXNseSBidXJuZWQ7Ci0gKiBXaGVuIGEgVkNQ
VSBoYXMgbm8gdGFzayBidXQgd2l0aCBidWRnZXQgbGVmdCwgaXRzIGJ1ZGdldCBpcyBwcmVzZXJ2
ZWQuCisgKiBFYWNoIFVOSVQgaXMgaW1wbGVtZW50ZWQgYXMgYSBkZWZlcmFibGUgc2VydmVyLgor
ICogV2hlbiBhbiBVTklUIGhhcyBhIHRhc2sgcnVubmluZyBvbiBpdCwgaXRzIGJ1ZGdldCBpcyBj
b250aW51b3VzbHkgYnVybmVkOworICogV2hlbiBhbiBVTklUIGhhcyBubyB0YXNrIGJ1dCB3aXRo
IGJ1ZGdldCBsZWZ0LCBpdHMgYnVkZ2V0IGlzIHByZXNlcnZlZC4KICAqCiAgKiBRdWV1ZSBzY2hl
bWU6CiAgKiBBIGdsb2JhbCBydW5xdWV1ZSBhbmQgYSBnbG9iYWwgZGVwbGV0ZWRxdWV1ZSBmb3Ig
ZWFjaCBDUFUgcG9vbC4KLSAqIFRoZSBydW5xdWV1ZSBob2xkcyBhbGwgcnVubmFibGUgVkNQVXMg
d2l0aCBidWRnZXQsCisgKiBUaGUgcnVucXVldWUgaG9sZHMgYWxsIHJ1bm5hYmxlIFVOSVRzIHdp
dGggYnVkZ2V0LAogICogc29ydGVkIGJ5IHByaW9yaXR5X2xldmVsIGFuZCBkZWFkbGluZTsKLSAq
IFRoZSBkZXBsZXRlZHF1ZXVlIGhvbGRzIGFsbCBWQ1BVcyB3aXRob3V0IGJ1ZGdldCwgdW5zb3J0
ZWQ7CisgKiBUaGUgZGVwbGV0ZWRxdWV1ZSBob2xkcyBhbGwgVU5JVHMgd2l0aG91dCBidWRnZXQs
IHVuc29ydGVkOwogICoKICAqIE5vdGU6IGNwdW1hc2sgYW5kIGNwdXBvb2wgaXMgc3VwcG9ydGVk
LgogICovCkBAIC04Miw3ICs4Miw3IEBACiAgKiBpbiBzY2hlZHVsZS5jCiAgKgogICogVGhlIGZ1
bmN0aW9ucyBpbnZvbGVzIFJ1blEgYW5kIG5lZWRzIHRvIGdyYWIgbG9ja3MgYXJlOgotICogICAg
dmNwdV9pbnNlcnQsIHZjcHVfcmVtb3ZlLCBjb250ZXh0X3NhdmVkLCBydW5xX2luc2VydAorICog
ICAgdW5pdF9pbnNlcnQsIHVuaXRfcmVtb3ZlLCBjb250ZXh0X3NhdmVkLCBydW5xX2luc2VydAog
ICovCiAKIApAQCAtOTUsNyArOTUsNyBAQAogCiAvKgogICogTWF4IHBlcmlvZDogbWF4IGRlbHRh
IG9mIHRpbWUgdHlwZSwgYmVjYXVzZSBwZXJpb2QgaXMgYWRkZWQgdG8gdGhlIHRpbWUKLSAqIGEg
dmNwdSBhY3RpdmF0ZXMsIHNvIHRoaXMgbXVzdCBub3Qgb3ZlcmZsb3cuCisgKiBhbiB1bml0IGFj
dGl2YXRlcywgc28gdGhpcyBtdXN0IG5vdCBvdmVyZmxvdy4KICAqIE1pbiBwZXJpb2Q6IDEwIHVz
LCBjb25zaWRlcmluZyB0aGUgc2NoZWR1bGluZyBvdmVyaGVhZCAod2hlbiBwZXJpb2QgaXMKICAq
IHRvbyBsb3csIHNjaGVkdWxpbmcgaXMgaW52b2tlZCB0b28gZnJlcXVlbnRseSwgY2F1c2luZyBo
aWdoIG92ZXJoZWFkKS4KICAqLwpAQCAtMTIxLDEyICsxMjEsMTIgQEAKICAqIEZsYWdzCiAgKi8K
IC8qCi0gKiBSVERTX3NjaGVkdWxlZDogSXMgdGhpcyB2Y3B1IGVpdGhlciBydW5uaW5nIG9uLCBv
ciBjb250ZXh0LXN3aXRjaGluZyBvZmYsCisgKiBSVERTX3NjaGVkdWxlZDogSXMgdGhpcyB1bml0
IGVpdGhlciBydW5uaW5nIG9uLCBvciBjb250ZXh0LXN3aXRjaGluZyBvZmYsCiAgKiBhIHBoeWlz
Y2FsIGNwdT8KICAqICsgQWNjZXNzZWQgb25seSB3aXRoIGdsb2JhbCBsb2NrIGhlbGQuCiAgKiAr
IFNldCB3aGVuIGNob3NlbiBhcyBuZXh0IGluIHJ0X3NjaGVkdWxlKCkuCiAgKiArIENsZWFyZWQg
YWZ0ZXIgY29udGV4dCBzd2l0Y2ggaGFzIGJlZW4gc2F2ZWQgaW4gcnRfY29udGV4dF9zYXZlZCgp
Ci0gKiArIENoZWNrZWQgaW4gdmNwdV93YWtlIHRvIHNlZSBpZiB3ZSBjYW4gYWRkIHRvIHRoZSBS
dW5xdWV1ZSwgb3IgaWYgd2Ugc2hvdWxkCisgKiArIENoZWNrZWQgaW4gdW5pdF93YWtlIHRvIHNl
ZSBpZiB3ZSBjYW4gYWRkIHRvIHRoZSBSdW5xdWV1ZSwgb3IgaWYgd2Ugc2hvdWxkCiAgKiAgIHNl
dCBSVERTX2RlbGF5ZWRfcnVucV9hZGQKICAqICsgQ2hlY2tlZCB0byBiZSBmYWxzZSBpbiBydW5x
X2luc2VydC4KICAqLwpAQCAtMTQ2LDE1ICsxNDYsMTUgQEAKIC8qCiAgKiBSVERTX2RlcGxldGVk
OiBEb2VzIHRoaXMgdmNwIHJ1biBvdXQgb2YgYnVkZ2V0PwogICogVGhpcyBmbGFnIGlzCi0gKiAr
IHNldCBpbiBidXJuX2J1ZGdldCgpIGlmIGEgdmNwdSBoYXMgemVybyBidWRnZXQgbGVmdDsKKyAq
ICsgc2V0IGluIGJ1cm5fYnVkZ2V0KCkgaWYgYW4gdW5pdCBoYXMgemVybyBidWRnZXQgbGVmdDsK
ICAqICsgY2xlYXJlZCBhbmQgY2hlY2tlZCBpbiB0aGUgcmVwZW5pc2htZW50IGhhbmRsZXIsCi0g
KiAgIGZvciB0aGUgdmNwdXMgdGhhdCBhcmUgYmVpbmcgcmVwbGVuaXNoZWQuCisgKiAgIGZvciB0
aGUgdW5pdHMgdGhhdCBhcmUgYmVpbmcgcmVwbGVuaXNoZWQuCiAgKi8KICNkZWZpbmUgX19SVERT
X2RlcGxldGVkICAgICAzCiAjZGVmaW5lIFJURFNfZGVwbGV0ZWQgKDE8PF9fUlREU19kZXBsZXRl
ZCkKIAogLyoKLSAqIFJURFNfZXh0cmF0aW1lOiBDYW4gdGhlIHZjcHUgcnVuIGluIHRoZSB0aW1l
IHRoYXQgaXMKKyAqIFJURFNfZXh0cmF0aW1lOiBDYW4gdGhlIHVuaXQgcnVuIGluIHRoZSB0aW1l
IHRoYXQgaXMKICAqIG5vdCBwYXJ0IG9mIGFueSByZWFsLXRpbWUgcmVzZXJ2YXRpb24sIGFuZCB3
b3VsZCB0aGVyZWZvcmUKICAqIGJlIG90aGVyd2lzZSBsZWZ0IGlkbGU/CiAgKi8KQEAgLTE4Mywx
MSArMTgzLDExIEBAIHN0cnVjdCBydF9wcml2YXRlIHsKICAgICBzcGlubG9ja190IGxvY2s7ICAg
ICAgICAgICAgLyogdGhlIGdsb2JhbCBjb2Fyc2UtZ3JhaW5lZCBsb2NrICovCiAgICAgc3RydWN0
IGxpc3RfaGVhZCBzZG9tOyAgICAgIC8qIGxpc3Qgb2YgYXZhaWxhbGJlIGRvbWFpbnMsIHVzZWQg
Zm9yIGR1bXAgKi8KIAotICAgIHN0cnVjdCBsaXN0X2hlYWQgcnVucTsgICAgICAvKiBvcmRlcmVk
IGxpc3Qgb2YgcnVubmFibGUgdmNwdXMgKi8KLSAgICBzdHJ1Y3QgbGlzdF9oZWFkIGRlcGxldGVk
cTsgLyogdW5vcmRlcmVkIGxpc3Qgb2YgZGVwbGV0ZWQgdmNwdXMgKi8KKyAgICBzdHJ1Y3QgbGlz
dF9oZWFkIHJ1bnE7ICAgICAgLyogb3JkZXJlZCBsaXN0IG9mIHJ1bm5hYmxlIHVuaXRzICovCisg
ICAgc3RydWN0IGxpc3RfaGVhZCBkZXBsZXRlZHE7IC8qIHVub3JkZXJlZCBsaXN0IG9mIGRlcGxl
dGVkIHVuaXRzICovCiAKICAgICBzdHJ1Y3QgdGltZXIgcmVwbF90aW1lcjsgICAgLyogcmVwbGVu
aXNobWVudCB0aW1lciAqLwotICAgIHN0cnVjdCBsaXN0X2hlYWQgcmVwbHE7ICAgICAvKiBvcmRl
cmVkIGxpc3Qgb2YgdmNwdXMgdGhhdCBuZWVkIHJlcGxlbmlzaG1lbnQgKi8KKyAgICBzdHJ1Y3Qg
bGlzdF9oZWFkIHJlcGxxOyAgICAgLyogb3JkZXJlZCBsaXN0IG9mIHVuaXRzIHRoYXQgbmVlZCBy
ZXBsZW5pc2htZW50ICovCiAKICAgICBjcHVtYXNrX3QgdGlja2xlZDsgICAgICAgICAgLyogY3B1
cyBiZWVuIHRpY2tsZWQgKi8KIH07CkBAIC0xOTksMTggKzE5OSwxOCBAQCBzdHJ1Y3QgcnRfdW5p
dCB7CiAgICAgc3RydWN0IGxpc3RfaGVhZCBxX2VsZW07ICAgICAvKiBvbiB0aGUgcnVucS9kZXBs
ZXRlZHEgbGlzdCAqLwogICAgIHN0cnVjdCBsaXN0X2hlYWQgcmVwbHFfZWxlbTsgLyogb24gdGhl
IHJlcGxlbmlzaG1lbnQgZXZlbnRzIGxpc3QgKi8KIAotICAgIC8qIFZDUFUgcGFyYW1ldGVycywg
aW4gbmFub3NlY29uZHMgKi8KKyAgICAvKiBVTklUIHBhcmFtZXRlcnMsIGluIG5hbm9zZWNvbmRz
ICovCiAgICAgc190aW1lX3QgcGVyaW9kOwogICAgIHNfdGltZV90IGJ1ZGdldDsKIAotICAgIC8q
IFZDUFUgY3VycmVudCBpbmZvcm1hdGlvbiBpbiBuYW5vc2Vjb25kICovCisgICAgLyogVU5JVCBj
dXJyZW50IGluZm9ybWF0aW9uIGluIG5hbm9zZWNvbmQgKi8KICAgICBzX3RpbWVfdCBjdXJfYnVk
Z2V0OyAgICAgICAgIC8qIGN1cnJlbnQgYnVkZ2V0ICovCiAgICAgc190aW1lX3QgbGFzdF9zdGFy
dDsgICAgICAgICAvKiBsYXN0IHN0YXJ0IHRpbWUgKi8KICAgICBzX3RpbWVfdCBjdXJfZGVhZGxp
bmU7ICAgICAgIC8qIGN1cnJlbnQgZGVhZGxpbmUgZm9yIEVERiAqLwogCiAgICAgLyogVXAtcG9p
bnRlcnMgKi8KICAgICBzdHJ1Y3QgcnRfZG9tICpzZG9tOwotICAgIHN0cnVjdCB2Y3B1ICp2Y3B1
OworICAgIHN0cnVjdCBzY2hlZF91bml0ICp1bml0OwogCiAgICAgdW5zaWduZWQgcHJpb3JpdHlf
bGV2ZWw7CiAKQEAgLTI2Myw3ICsyNjMsNyBAQCBzdGF0aWMgaW5saW5lIGJvb2wgaGFzX2V4dHJh
dGltZShjb25zdCBzdHJ1Y3QgcnRfdW5pdCAqc3ZjKQogICogYW5kIHRoZSByZXBsZW5pc2htZW50
IGV2ZW50cyBxdWV1ZS4KICAqLwogc3RhdGljIGludAotdmNwdV9vbl9xKGNvbnN0IHN0cnVjdCBy
dF91bml0ICpzdmMpCit1bml0X29uX3EoY29uc3Qgc3RydWN0IHJ0X3VuaXQgKnN2YykKIHsKICAg
IHJldHVybiAhbGlzdF9lbXB0eSgmc3ZjLT5xX2VsZW0pOwogfQpAQCAtMjgxLDcgKzI4MSw3IEBA
IHJlcGxxX2VsZW0oc3RydWN0IGxpc3RfaGVhZCAqZWxlbSkKIH0KIAogc3RhdGljIGludAotdmNw
dV9vbl9yZXBscShjb25zdCBzdHJ1Y3QgcnRfdW5pdCAqc3ZjKQordW5pdF9vbl9yZXBscShjb25z
dCBzdHJ1Y3QgcnRfdW5pdCAqc3ZjKQogewogICAgIHJldHVybiAhbGlzdF9lbXB0eSgmc3ZjLT5y
ZXBscV9lbGVtKTsKIH0KQEAgLTI5MSw3ICsyOTEsNyBAQCB2Y3B1X29uX3JlcGxxKGNvbnN0IHN0
cnVjdCBydF91bml0ICpzdmMpCiAgKiBPdGhlcndpc2UsIHJldHVybiB2YWx1ZSA8IDAKICAqLwog
c3RhdGljIHNfdGltZV90Ci1jb21wYXJlX3ZjcHVfcHJpb3JpdHkoY29uc3Qgc3RydWN0IHJ0X3Vu
aXQgKnYxLCBjb25zdCBzdHJ1Y3QgcnRfdW5pdCAqdjIpCitjb21wYXJlX3VuaXRfcHJpb3JpdHko
Y29uc3Qgc3RydWN0IHJ0X3VuaXQgKnYxLCBjb25zdCBzdHJ1Y3QgcnRfdW5pdCAqdjIpCiB7CiAg
ICAgaW50IHByaW8gPSB2Mi0+cHJpb3JpdHlfbGV2ZWwgLSB2MS0+cHJpb3JpdHlfbGV2ZWw7CiAK
QEAgLTMwMiwxNSArMzAyLDE1IEBAIGNvbXBhcmVfdmNwdV9wcmlvcml0eShjb25zdCBzdHJ1Y3Qg
cnRfdW5pdCAqdjEsIGNvbnN0IHN0cnVjdCBydF91bml0ICp2MikKIH0KIAogLyoKLSAqIERlYnVn
IHJlbGF0ZWQgY29kZSwgZHVtcCB2Y3B1L2NwdSBpbmZvcm1hdGlvbgorICogRGVidWcgcmVsYXRl
ZCBjb2RlLCBkdW1wIHVuaXQvY3B1IGluZm9ybWF0aW9uCiAgKi8KIHN0YXRpYyB2b2lkCi1ydF9k
dW1wX3ZjcHUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBjb25zdCBzdHJ1Y3QgcnRfdW5p
dCAqc3ZjKQorcnRfZHVtcF91bml0KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgY29uc3Qg
c3RydWN0IHJ0X3VuaXQgKnN2YykKIHsKICAgICBjcHVtYXNrX3QgKmNwdXBvb2xfbWFzaywgKm1h
c2s7CiAKICAgICBBU1NFUlQoc3ZjICE9IE5VTEwpOwotICAgIC8qIGlkbGUgdmNwdSAqLworICAg
IC8qIGlkbGUgdW5pdCAqLwogICAgIGlmKCBzdmMtPnNkb20gPT0gTlVMTCApCiAgICAgewogICAg
ICAgICBwcmludGsoIlxuIik7CkBAIC0zMjEsMjAgKzMyMSwyMCBAQCBydF9kdW1wX3ZjcHUoY29u
c3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBjb25zdCBzdHJ1Y3QgcnRfdW5pdCAqc3ZjKQogICAg
ICAqIFdlIGNhbid0IGp1c3QgdXNlICdjcHVtYXNrX3NjcmF0Y2gnIGJlY2F1c2UgdGhlIGR1bXBp
bmcgY2FuCiAgICAgICogaGFwcGVuIGZyb20gYSBwQ1BVIG91dHNpZGUgb2YgdGhpcyBzY2hlZHVs
ZXIncyBjcHVwb29sLCBhbmQKICAgICAgKiBoZW5jZSBpdCdzIG5vdCByaWdodCB0byB1c2UgaXRz
IHBDUFUncyBzY3JhdGNoIG1hc2suCi0gICAgICogT24gdGhlIG90aGVyIGhhbmQsIGl0IGlzIHNh
ZmUgdG8gdXNlIHN2Yy0+dmNwdS0+cHJvY2Vzc29yJ3MKKyAgICAgKiBPbiB0aGUgb3RoZXIgaGFu
ZCwgaXQgaXMgc2FmZSB0byB1c2Ugc2NoZWRfdW5pdF9jcHUoc3ZjLT51bml0KSdzCiAgICAgICog
b3duIHNjcmF0Y2ggc3BhY2UsIHNpbmNlIHdlIGhvbGQgdGhlIHJ1bnF1ZXVlIGxvY2suCiAgICAg
ICovCi0gICAgbWFzayA9IGNwdW1hc2tfc2NyYXRjaF9jcHUoc3ZjLT52Y3B1LT5wcm9jZXNzb3Ip
OworICAgIG1hc2sgPSBjcHVtYXNrX3NjcmF0Y2hfY3B1KHNjaGVkX3VuaXRfY3B1KHN2Yy0+dW5p
dCkpOwogCi0gICAgY3B1cG9vbF9tYXNrID0gY3B1cG9vbF9kb21haW5fY3B1bWFzayhzdmMtPnZj
cHUtPmRvbWFpbik7Ci0gICAgY3B1bWFza19hbmQobWFzaywgY3B1cG9vbF9tYXNrLCBzdmMtPnZj
cHUtPnNjaGVkX3VuaXQtPmNwdV9oYXJkX2FmZmluaXR5KTsKKyAgICBjcHVwb29sX21hc2sgPSBj
cHVwb29sX2RvbWFpbl9jcHVtYXNrKHN2Yy0+dW5pdC0+ZG9tYWluKTsKKyAgICBjcHVtYXNrX2Fu
ZChtYXNrLCBjcHVwb29sX21hc2ssIHN2Yy0+dW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHkpOwogICAg
IHByaW50aygiWyU1ZC4lLTJ1XSBjcHUgJXUsICglIlBSSV9zdGltZSIsICUiUFJJX3N0aW1lIiks
IgogICAgICAgICAgICAiIGN1cl9iPSUiUFJJX3N0aW1lIiBjdXJfZD0lIlBSSV9zdGltZSIgbGFz
dF9zdGFydD0lIlBSSV9zdGltZSJcbiIKICAgICAgICAgICAgIiBcdFx0IHByaW9yaXR5X2xldmVs
PSVkIGhhc19leHRyYXRpbWU9JWRcbiIKICAgICAgICAgICAgIiBcdFx0IG9uUT0lZCBydW5uYWJs
ZT0lZCBmbGFncz0leCBlZmZlY3RpdmUgaGFyZF9hZmZpbml0eT0lKnBibFxuIiwKLSAgICAgICAg
ICAgIHN2Yy0+dmNwdS0+ZG9tYWluLT5kb21haW5faWQsCi0gICAgICAgICAgICBzdmMtPnZjcHUt
PnZjcHVfaWQsCi0gICAgICAgICAgICBzdmMtPnZjcHUtPnByb2Nlc3NvciwKKyAgICAgICAgICAg
IHN2Yy0+dW5pdC0+ZG9tYWluLT5kb21haW5faWQsCisgICAgICAgICAgICBzdmMtPnVuaXQtPnVu
aXRfaWQsCisgICAgICAgICAgICBzY2hlZF91bml0X2NwdShzdmMtPnVuaXQpLAogICAgICAgICAg
ICAgc3ZjLT5wZXJpb2QsCiAgICAgICAgICAgICBzdmMtPmJ1ZGdldCwKICAgICAgICAgICAgIHN2
Yy0+Y3VyX2J1ZGdldCwKQEAgLTM0Miw4ICszNDIsOCBAQCBydF9kdW1wX3ZjcHUoY29uc3Qgc3Ry
dWN0IHNjaGVkdWxlciAqb3BzLCBjb25zdCBzdHJ1Y3QgcnRfdW5pdCAqc3ZjKQogICAgICAgICAg
ICAgc3ZjLT5sYXN0X3N0YXJ0LAogICAgICAgICAgICAgc3ZjLT5wcmlvcml0eV9sZXZlbCwKICAg
ICAgICAgICAgIGhhc19leHRyYXRpbWUoc3ZjKSwKLSAgICAgICAgICAgIHZjcHVfb25fcShzdmMp
LAotICAgICAgICAgICAgdmNwdV9ydW5uYWJsZShzdmMtPnZjcHUpLAorICAgICAgICAgICAgdW5p
dF9vbl9xKHN2YyksCisgICAgICAgICAgICB1bml0X3J1bm5hYmxlKHN2Yy0+dW5pdCksCiAgICAg
ICAgICAgICBzdmMtPmZsYWdzLCBDUFVNQVNLX1BSKG1hc2spKTsKIH0KIApAQCAtMzU2LDExICsz
NTYsMTEgQEAgcnRfZHVtcF9wY3B1KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgaW50IGNw
dSkKIAogICAgIHNwaW5fbG9ja19pcnFzYXZlKCZwcnYtPmxvY2ssIGZsYWdzKTsKICAgICBwcmlu
dGsoIkNQVVslMDJkXVxuIiwgY3B1KTsKLSAgICAvKiBjdXJyZW50IFZDUFUgKG5vdGhpbmcgdG8g
c2F5IGlmIHRoYXQncyB0aGUgaWRsZSB2Y3B1KS4gKi8KKyAgICAvKiBjdXJyZW50IFVOSVQgKG5v
dGhpbmcgdG8gc2F5IGlmIHRoYXQncyB0aGUgaWRsZSB1bml0KS4gKi8KICAgICBzdmMgPSBydF91
bml0KGN1cnJfb25fY3B1KGNwdSkpOwotICAgIGlmICggc3ZjICYmICFpc19pZGxlX3ZjcHUoc3Zj
LT52Y3B1KSApCisgICAgaWYgKCBzdmMgJiYgIWlzX2lkbGVfdW5pdChzdmMtPnVuaXQpICkKICAg
ICB7Ci0gICAgICAgIHJ0X2R1bXBfdmNwdShvcHMsIHN2Yyk7CisgICAgICAgIHJ0X2R1bXBfdW5p
dChvcHMsIHN2Yyk7CiAgICAgfQogICAgIHNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnBydi0+bG9j
aywgZmxhZ3MpOwogfQpAQCAtMzg3LDM1ICszODcsMzUgQEAgcnRfZHVtcChjb25zdCBzdHJ1Y3Qg
c2NoZWR1bGVyICpvcHMpCiAgICAgbGlzdF9mb3JfZWFjaCAoIGl0ZXIsIHJ1bnEgKQogICAgIHsK
ICAgICAgICAgc3ZjID0gcV9lbGVtKGl0ZXIpOwotICAgICAgICBydF9kdW1wX3ZjcHUob3BzLCBz
dmMpOworICAgICAgICBydF9kdW1wX3VuaXQob3BzLCBzdmMpOwogICAgIH0KIAogICAgIHByaW50
aygiR2xvYmFsIERlcGxldGVkUXVldWUgaW5mbzpcbiIpOwogICAgIGxpc3RfZm9yX2VhY2ggKCBp
dGVyLCBkZXBsZXRlZHEgKQogICAgIHsKICAgICAgICAgc3ZjID0gcV9lbGVtKGl0ZXIpOwotICAg
ICAgICBydF9kdW1wX3ZjcHUob3BzLCBzdmMpOworICAgICAgICBydF9kdW1wX3VuaXQob3BzLCBz
dmMpOwogICAgIH0KIAogICAgIHByaW50aygiR2xvYmFsIFJlcGxlbmlzaG1lbnQgRXZlbnRzIGlu
Zm86XG4iKTsKICAgICBsaXN0X2Zvcl9lYWNoICggaXRlciwgcmVwbHEgKQogICAgIHsKICAgICAg
ICAgc3ZjID0gcmVwbHFfZWxlbShpdGVyKTsKLSAgICAgICAgcnRfZHVtcF92Y3B1KG9wcywgc3Zj
KTsKKyAgICAgICAgcnRfZHVtcF91bml0KG9wcywgc3ZjKTsKICAgICB9CiAKICAgICBwcmludGso
IkRvbWFpbiBpbmZvOlxuIik7CiAgICAgbGlzdF9mb3JfZWFjaCAoIGl0ZXIsICZwcnYtPnNkb20g
KQogICAgIHsKLSAgICAgICAgc3RydWN0IHZjcHUgKnY7CisgICAgICAgIHN0cnVjdCBzY2hlZF91
bml0ICp1bml0OwogCiAgICAgICAgIHNkb20gPSBsaXN0X2VudHJ5KGl0ZXIsIHN0cnVjdCBydF9k
b20sIHNkb21fZWxlbSk7CiAgICAgICAgIHByaW50aygiXHRkb21haW46ICVkXG4iLCBzZG9tLT5k
b20tPmRvbWFpbl9pZCk7CiAKLSAgICAgICAgZm9yX2VhY2hfdmNwdSAoIHNkb20tPmRvbSwgdiAp
CisgICAgICAgIGZvcl9lYWNoX3NjaGVkX3VuaXQgKCBzZG9tLT5kb20sIHVuaXQgKQogICAgICAg
ICB7Ci0gICAgICAgICAgICBzdmMgPSBydF91bml0KHYtPnNjaGVkX3VuaXQpOwotICAgICAgICAg
ICAgcnRfZHVtcF92Y3B1KG9wcywgc3ZjKTsKKyAgICAgICAgICAgIHN2YyA9IHJ0X3VuaXQodW5p
dCk7CisgICAgICAgICAgICBydF9kdW1wX3VuaXQob3BzLCBzdmMpOwogICAgICAgICB9CiAgICAg
fQogCkBAIC00NTcsMTIgKzQ1NywxMiBAQCBydF91cGRhdGVfZGVhZGxpbmUoc190aW1lX3Qgbm93
LCBzdHJ1Y3QgcnRfdW5pdCAqc3ZjKQogICAgIC8qIFRSQUNFICovCiAgICAgewogICAgICAgICBz
dHJ1Y3QgX19wYWNrZWQgewotICAgICAgICAgICAgdW5zaWduZWQgdmNwdToxNiwgZG9tOjE2Owor
ICAgICAgICAgICAgdW5zaWduZWQgdW5pdDoxNiwgZG9tOjE2OwogICAgICAgICAgICAgdW5zaWdu
ZWQgcHJpb3JpdHlfbGV2ZWw7CiAgICAgICAgICAgICB1aW50NjRfdCBjdXJfZGVhZGxpbmUsIGN1
cl9idWRnZXQ7CiAgICAgICAgIH0gZDsKLSAgICAgICAgZC5kb20gPSBzdmMtPnZjcHUtPmRvbWFp
bi0+ZG9tYWluX2lkOwotICAgICAgICBkLnZjcHUgPSBzdmMtPnZjcHUtPnZjcHVfaWQ7CisgICAg
ICAgIGQuZG9tID0gc3ZjLT51bml0LT5kb21haW4tPmRvbWFpbl9pZDsKKyAgICAgICAgZC51bml0
ID0gc3ZjLT51bml0LT51bml0X2lkOwogICAgICAgICBkLnByaW9yaXR5X2xldmVsID0gc3ZjLT5w
cmlvcml0eV9sZXZlbDsKICAgICAgICAgZC5jdXJfZGVhZGxpbmUgPSAodWludDY0X3QpIHN2Yy0+
Y3VyX2RlYWRsaW5lOwogICAgICAgICBkLmN1cl9idWRnZXQgPSAodWludDY0X3QpIHN2Yy0+Y3Vy
X2J1ZGdldDsKQEAgLTQ3NSwxNSArNDc1LDE1IEBAIHJ0X3VwZGF0ZV9kZWFkbGluZShzX3RpbWVf
dCBub3csIHN0cnVjdCBydF91bml0ICpzdmMpCiB9CiAKIC8qCi0gKiBIZWxwZXJzIGZvciByZW1v
dmluZyBhbmQgaW5zZXJ0aW5nIGEgdmNwdSBpbiBhIHF1ZXVlCi0gKiB0aGF0IGlzIGJlaW5nIGtl
cHQgb3JkZXJlZCBieSB0aGUgdmNwdXMnIGRlYWRsaW5lcyAoYXMgRURGCisgKiBIZWxwZXJzIGZv
ciByZW1vdmluZyBhbmQgaW5zZXJ0aW5nIGFuIHVuaXQgaW4gYSBxdWV1ZQorICogdGhhdCBpcyBi
ZWluZyBrZXB0IG9yZGVyZWQgYnkgdGhlIHVuaXRzJyBkZWFkbGluZXMgKGFzIEVERgogICogbWFu
ZGF0ZXMpLgogICoKLSAqIEZvciBjYWxsZXJzJyBjb252ZW5pZW5jZSwgdGhlIHZjcHUgcmVtb3Zp
bmcgaGVscGVyIHJldHVybnMKLSAqIHRydWUgaWYgdGhlIHZjcHUgcmVtb3ZlZCB3YXMgdGhlIG9u
ZSBhdCB0aGUgZnJvbnQgb2YgdGhlCisgKiBGb3IgY2FsbGVycycgY29udmVuaWVuY2UsIHRoZSB1
bml0IHJlbW92aW5nIGhlbHBlciByZXR1cm5zCisgKiB0cnVlIGlmIHRoZSB1bml0IHJlbW92ZWQg
d2FzIHRoZSBvbmUgYXQgdGhlIGZyb250IG9mIHRoZQogICogcXVldWU7IHNpbWlsYXJseSwgdGhl
IGluc2VydGluZyBoZWxwZXIgcmV0dXJucyB0cnVlIGlmIHRoZQogICogaW5zZXJ0ZWQgZW5kZWQg
YXQgdGhlIGZyb250IG9mIHRoZSBxdWV1ZSAoaS5lLiwgaW4gYm90aAotICogY2FzZXMsIGlmIHRo
ZSB2Y3B1IHdpdGggdGhlIGVhcmxpZXN0IGRlYWRsaW5lIGlzIHdoYXQgd2UKKyAqIGNhc2VzLCBp
ZiB0aGUgdW5pdCB3aXRoIHRoZSBlYXJsaWVzdCBkZWFkbGluZSBpcyB3aGF0IHdlCiAgKiBhcmUg
ZGVhbGluZyB3aXRoKS4KICAqLwogc3RhdGljIGlubGluZSBib29sCkBAIC01MDksNyArNTA5LDcg
QEAgZGVhZGxpbmVfcXVldWVfaW5zZXJ0KHN0cnVjdCBydF91bml0ICogKCpxZWxlbSkoc3RydWN0
IGxpc3RfaGVhZCAqKSwKICAgICBsaXN0X2Zvcl9lYWNoICggaXRlciwgcXVldWUgKQogICAgIHsK
ICAgICAgICAgc3RydWN0IHJ0X3VuaXQgKiBpdGVyX3N2YyA9ICgqcWVsZW0pKGl0ZXIpOwotICAg
ICAgICBpZiAoIGNvbXBhcmVfdmNwdV9wcmlvcml0eShzdmMsIGl0ZXJfc3ZjKSA+IDAgKQorICAg
ICAgICBpZiAoIGNvbXBhcmVfdW5pdF9wcmlvcml0eShzdmMsIGl0ZXJfc3ZjKSA+IDAgKQogICAg
ICAgICAgICAgYnJlYWs7CiAgICAgICAgIHBvcysrOwogICAgIH0KQEAgLTUyNCw3ICs1MjQsNyBA
QCBkZWFkbGluZV9xdWV1ZV9pbnNlcnQoc3RydWN0IHJ0X3VuaXQgKiAoKnFlbGVtKShzdHJ1Y3Qg
bGlzdF9oZWFkICopLAogc3RhdGljIGlubGluZSB2b2lkCiBxX3JlbW92ZShzdHJ1Y3QgcnRfdW5p
dCAqc3ZjKQogewotICAgIEFTU0VSVCggdmNwdV9vbl9xKHN2YykgKTsKKyAgICBBU1NFUlQoIHVu
aXRfb25fcShzdmMpICk7CiAgICAgbGlzdF9kZWxfaW5pdCgmc3ZjLT5xX2VsZW0pOwogfQogCkBA
IC01MzQsMTQgKzUzNCwxNCBAQCByZXBscV9yZW1vdmUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAq
b3BzLCBzdHJ1Y3QgcnRfdW5pdCAqc3ZjKQogICAgIHN0cnVjdCBydF9wcml2YXRlICpwcnYgPSBy
dF9wcml2KG9wcyk7CiAgICAgc3RydWN0IGxpc3RfaGVhZCAqcmVwbHEgPSBydF9yZXBscShvcHMp
OwogCi0gICAgQVNTRVJUKCB2Y3B1X29uX3JlcGxxKHN2YykgKTsKKyAgICBBU1NFUlQoIHVuaXRf
b25fcmVwbHEoc3ZjKSApOwogCiAgICAgaWYgKCBkZWFkbGluZV9xdWV1ZV9yZW1vdmUocmVwbHEs
ICZzdmMtPnJlcGxxX2VsZW0pICkKICAgICB7CiAgICAgICAgIC8qCiAgICAgICAgICAqIFRoZSBy
ZXBsZW5pc2htZW50IHRpbWVyIG5lZWRzIHRvIGJlIHNldCB0byBmaXJlIHdoZW4gYQotICAgICAg
ICAgKiByZXBsZW5pc2htZW50IGZvciB0aGUgdmNwdSBhdCB0aGUgZnJvbnQgb2YgdGhlIHJlcGxl
bmlzaG1lbnQKLSAgICAgICAgICogcXVldWUgaXMgZHVlLiBJZiBpdCBpcyBzdWNoIHZjcHUgdGhh
dCB3ZSBqdXN0IHJlbW92ZWQsIHdlIG1heQorICAgICAgICAgKiByZXBsZW5pc2htZW50IGZvciB0
aGUgdW5pdCBhdCB0aGUgZnJvbnQgb2YgdGhlIHJlcGxlbmlzaG1lbnQKKyAgICAgICAgICogcXVl
dWUgaXMgZHVlLiBJZiBpdCBpcyBzdWNoIHVuaXQgdGhhdCB3ZSBqdXN0IHJlbW92ZWQsIHdlIG1h
eQogICAgICAgICAgKiBuZWVkIHRvIHJlcHJvZ3JhbSB0aGUgdGltZXIuCiAgICAgICAgICAqLwog
ICAgICAgICBpZiAoICFsaXN0X2VtcHR5KHJlcGxxKSApCkBAIC01NTYsNyArNTU2LDcgQEAgcmVw
bHFfcmVtb3ZlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHJ0X3VuaXQgKnN2
YykKIAogLyoKICAqIEluc2VydCBzdmMgd2l0aCBidWRnZXQgaW4gUnVuUSBhY2NvcmRpbmcgdG8g
RURGOgotICogdmNwdXMgd2l0aCBzbWFsbGVyIGRlYWRsaW5lcyBnbyBmaXJzdC4KKyAqIHVuaXRz
IHdpdGggc21hbGxlciBkZWFkbGluZXMgZ28gZmlyc3QuCiAgKiBJbnNlcnQgc3ZjIHdpdGhvdXQg
YnVkZ2V0IGluIERlcGxldGVkUSB1bnNvcnRlZDsKICAqLwogc3RhdGljIHZvaWQKQEAgLTU2Niw4
ICs1NjYsOCBAQCBydW5xX2luc2VydChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVj
dCBydF91bml0ICpzdmMpCiAgICAgc3RydWN0IGxpc3RfaGVhZCAqcnVucSA9IHJ0X3J1bnEob3Bz
KTsKIAogICAgIEFTU0VSVCggc3Bpbl9pc19sb2NrZWQoJnBydi0+bG9jaykgKTsKLSAgICBBU1NF
UlQoICF2Y3B1X29uX3Eoc3ZjKSApOwotICAgIEFTU0VSVCggdmNwdV9vbl9yZXBscShzdmMpICk7
CisgICAgQVNTRVJUKCAhdW5pdF9vbl9xKHN2YykgKTsKKyAgICBBU1NFUlQoIHVuaXRfb25fcmVw
bHEoc3ZjKSApOwogCiAgICAgLyogYWRkIHN2YyB0byBydW5xIGlmIHN2YyBzdGlsbCBoYXMgYnVk
Z2V0IG9yIGl0cyBleHRyYXRpbWUgaXMgc2V0ICovCiAgICAgaWYgKCBzdmMtPmN1cl9idWRnZXQg
PiAwIHx8CkBAIC01ODMsNyArNTgzLDcgQEAgcmVwbHFfaW5zZXJ0KGNvbnN0IHN0cnVjdCBzY2hl
ZHVsZXIgKm9wcywgc3RydWN0IHJ0X3VuaXQgKnN2YykKICAgICBzdHJ1Y3QgbGlzdF9oZWFkICpy
ZXBscSA9IHJ0X3JlcGxxKG9wcyk7CiAgICAgc3RydWN0IHJ0X3ByaXZhdGUgKnBydiA9IHJ0X3By
aXYob3BzKTsKIAotICAgIEFTU0VSVCggIXZjcHVfb25fcmVwbHEoc3ZjKSApOworICAgIEFTU0VS
VCggIXVuaXRfb25fcmVwbHEoc3ZjKSApOwogCiAgICAgLyoKICAgICAgKiBUaGUgdGltZXIgbWF5
IGJlIHJlLXByb2dyYW1tZWQgaWYgc3ZjIGlzIGluc2VydGVkCkBAIC02MDYsMTIgKzYwNiwxMiBA
QCByZXBscV9yZWluc2VydChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBydF91
bml0ICpzdmMpCiAgICAgc3RydWN0IHJ0X3VuaXQgKnJlYXJtX3N2YyA9IHN2YzsKICAgICBib29s
X3QgcmVhcm0gPSAwOwogCi0gICAgQVNTRVJUKCB2Y3B1X29uX3JlcGxxKHN2YykgKTsKKyAgICBB
U1NFUlQoIHVuaXRfb25fcmVwbHEoc3ZjKSApOwogCiAgICAgLyoKICAgICAgKiBJZiBzdmMgd2Fz
IGF0IHRoZSBmcm9udCBvZiB0aGUgcmVwbGVuaXNobWVudCBxdWV1ZSwgd2UgY2VydGFpbmx5CiAg
ICAgICogbmVlZCB0byByZS1wcm9ncmFtIHRoZSB0aW1lciwgYW5kIHdlIHdhbnQgdG8gdXNlIHRo
ZSBkZWFkbGluZSBvZgotICAgICAqIHRoZSB2Y3B1IHdoaWNoIGlzIG5vdyBhdCB0aGUgZnJvbnQg
b2YgdGhlIHF1ZXVlICh3aGljaCBtYXkgc3RpbGwKKyAgICAgKiB0aGUgdW5pdCB3aGljaCBpcyBu
b3cgYXQgdGhlIGZyb250IG9mIHRoZSBxdWV1ZSAod2hpY2ggbWF5IHN0aWxsCiAgICAgICogYmUg
c3ZjIG9yIG5vdCkuCiAgICAgICoKICAgICAgKiBXZSBtYXkgYWxzbyBuZWVkIHRvIHJlLXByb2dy
YW0sIGlmIHN2YyBoYXMgYmVlbiBwdXQgYXQgdGhlIGZyb250CkBAIC02MzEsMjQgKzYzMSwyMyBA
QCByZXBscV9yZWluc2VydChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBydF91
bml0ICpzdmMpCiB9CiAKIC8qCi0gKiBQaWNrIGEgdmFsaWQgcmVzb3VyY2UgZm9yIHRoZSB2Y3B1
IHZjCi0gKiBWYWxpZCByZXNvdXJjZSBvZiBhIHZjcHUgaXMgaW50ZXNlY3Rpb24gb2YgdmNwdSdz
IGFmZmluaXR5CisgKiBQaWNrIGEgdmFsaWQgcmVzb3VyY2UgZm9yIHRoZSB1bml0IHZjCisgKiBW
YWxpZCByZXNvdXJjZSBvZiBhbiB1bml0IGlzIGludGVzZWN0aW9uIG9mIHVuaXQncyBhZmZpbml0
eQogICogYW5kIGF2YWlsYWJsZSByZXNvdXJjZXMKICAqLwogc3RhdGljIHN0cnVjdCBzY2hlZF9y
ZXNvdXJjZSAqCiBydF9yZXNfcGljayhjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVj
dCBzY2hlZF91bml0ICp1bml0KQogewotICAgIHN0cnVjdCB2Y3B1ICp2YyA9IHVuaXQtPnZjcHVf
bGlzdDsKICAgICBjcHVtYXNrX3QgY3B1czsKICAgICBjcHVtYXNrX3QgKm9ubGluZTsKICAgICBp
bnQgY3B1OwogCi0gICAgb25saW5lID0gY3B1cG9vbF9kb21haW5fY3B1bWFzayh2Yy0+ZG9tYWlu
KTsKKyAgICBvbmxpbmUgPSBjcHVwb29sX2RvbWFpbl9jcHVtYXNrKHVuaXQtPmRvbWFpbik7CiAg
ICAgY3B1bWFza19hbmQoJmNwdXMsIG9ubGluZSwgdW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHkpOwog
Ci0gICAgY3B1ID0gY3B1bWFza190ZXN0X2NwdSh2Yy0+cHJvY2Vzc29yLCAmY3B1cykKLSAgICAg
ICAgICAgID8gdmMtPnByb2Nlc3NvcgotICAgICAgICAgICAgOiBjcHVtYXNrX2N5Y2xlKHZjLT5w
cm9jZXNzb3IsICZjcHVzKTsKKyAgICBjcHUgPSBjcHVtYXNrX3Rlc3RfY3B1KHNjaGVkX3VuaXRf
Y3B1KHVuaXQpLCAmY3B1cykKKyAgICAgICAgICAgID8gc2NoZWRfdW5pdF9jcHUodW5pdCkKKyAg
ICAgICAgICAgIDogY3B1bWFza19jeWNsZShzY2hlZF91bml0X2NwdSh1bml0KSwgJmNwdXMpOwog
ICAgIEFTU0VSVCggIWNwdW1hc2tfZW1wdHkoJmNwdXMpICYmIGNwdW1hc2tfdGVzdF9jcHUoY3B1
LCAmY3B1cykgKTsKIAogICAgIHJldHVybiBnZXRfc2NoZWRfcmVzKGNwdSk7CkBAIC03MzcsNyAr
NzM2LDcgQEAgcnRfc3dpdGNoX3NjaGVkKHN0cnVjdCBzY2hlZHVsZXIgKm5ld19vcHMsIHVuc2ln
bmVkIGludCBjcHUsCiAgICAgc3RydWN0IHJ0X3VuaXQgKnN2YyA9IHZkYXRhOwogICAgIHN0cnVj
dCBzY2hlZF9yZXNvdXJjZSAqc2QgPSBnZXRfc2NoZWRfcmVzKGNwdSk7CiAKLSAgICBBU1NFUlQo
IXBkYXRhICYmIHN2YyAmJiBpc19pZGxlX3ZjcHUoc3ZjLT52Y3B1KSk7CisgICAgQVNTRVJUKCFw
ZGF0YSAmJiBzdmMgJiYgaXNfaWRsZV91bml0KHN2Yy0+dW5pdCkpOwogCiAgICAgLyoKICAgICAg
KiBXZSBhcmUgaG9sZGluZyB0aGUgcnVucXVldWUgbG9jayBhbHJlYWR5IChpdCdzIGJlZW4gdGFr
ZW4gaW4KQEAgLTc2MSw3ICs3NjAsNyBAQCBydF9zd2l0Y2hfc2NoZWQoc3RydWN0IHNjaGVkdWxl
ciAqbmV3X29wcywgdW5zaWduZWQgaW50IGNwdSwKICAgICAgICAgZHByaW50ayhYRU5MT0dfREVC
VUcsICJSVERTOiB0aW1lciBpbml0aWFsaXplZCBvbiBjcHUgJXVcbiIsIGNwdSk7CiAgICAgfQog
Ci0gICAgaWRsZV92Y3B1W2NwdV0tPnNjaGVkX3VuaXQtPnByaXYgPSB2ZGF0YTsKKyAgICBzY2hl
ZF9pZGxlX3VuaXQoY3B1KS0+cHJpdiA9IHZkYXRhOwogCiAgICAgcmV0dXJuICZwcnYtPmxvY2s7
CiB9CkBAIC04NDEsMTAgKzg0MCw5IEBAIHJ0X2ZyZWVfZG9tZGF0YShjb25zdCBzdHJ1Y3Qgc2No
ZWR1bGVyICpvcHMsIHZvaWQgKmRhdGEpCiBzdGF0aWMgdm9pZCAqCiBydF9hbGxvY192ZGF0YShj
b25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91bml0ICp1bml0LCB2b2lk
ICpkZCkKIHsKLSAgICBzdHJ1Y3QgdmNwdSAqdmMgPSB1bml0LT52Y3B1X2xpc3Q7CiAgICAgc3Ry
dWN0IHJ0X3VuaXQgKnN2YzsKIAotICAgIC8qIEFsbG9jYXRlIHBlci1WQ1BVIGluZm8gKi8KKyAg
ICAvKiBBbGxvY2F0ZSBwZXItVU5JVCBpbmZvICovCiAgICAgc3ZjID0geHphbGxvYyhzdHJ1Y3Qg
cnRfdW5pdCk7CiAgICAgaWYgKCBzdmMgPT0gTlVMTCApCiAgICAgICAgIHJldHVybiBOVUxMOwpA
QCAtODUzLDEzICs4NTEsMTMgQEAgcnRfYWxsb2NfdmRhdGEoY29uc3Qgc3RydWN0IHNjaGVkdWxl
ciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCwgdm9pZCAqZGQpCiAgICAgSU5JVF9MSVNU
X0hFQUQoJnN2Yy0+cmVwbHFfZWxlbSk7CiAgICAgc3ZjLT5mbGFncyA9IDBVOwogICAgIHN2Yy0+
c2RvbSA9IGRkOwotICAgIHN2Yy0+dmNwdSA9IHZjOworICAgIHN2Yy0+dW5pdCA9IHVuaXQ7CiAg
ICAgc3ZjLT5sYXN0X3N0YXJ0ID0gMDsKIAogICAgIF9fc2V0X2JpdChfX1JURFNfZXh0cmF0aW1l
LCAmc3ZjLT5mbGFncyk7CiAgICAgc3ZjLT5wcmlvcml0eV9sZXZlbCA9IDA7CiAgICAgc3ZjLT5w
ZXJpb2QgPSBSVERTX0RFRkFVTFRfUEVSSU9EOwotICAgIGlmICggIWlzX2lkbGVfdmNwdSh2Yykg
KQorICAgIGlmICggIWlzX2lkbGVfdW5pdCh1bml0KSApCiAgICAgICAgIHN2Yy0+YnVkZ2V0ID0g
UlREU19ERUZBVUxUX0JVREdFVDsKIAogICAgIFNDSEVEX1NUQVRfQ1JBTksodW5pdF9hbGxvYyk7
CkBAIC04NzksMjIgKzg3NywyMCBAQCBydF9mcmVlX3ZkYXRhKGNvbnN0IHN0cnVjdCBzY2hlZHVs
ZXIgKm9wcywgdm9pZCAqcHJpdikKICAqIEl0IGlzIGNhbGxlZCBpbiBzY2hlZF9tb3ZlX2RvbWFp
bigpIGFuZCBzY2hlZF9pbml0X3ZjcHUKICAqIGluIHNjaGVkdWxlLmMuCiAgKiBXaGVuIG1vdmUg
YSBkb21haW4gdG8gYSBuZXcgY3B1cG9vbC4KLSAqIEl0IGluc2VydHMgdmNwdXMgb2YgbW92aW5n
IGRvbWFpbiB0byB0aGUgc2NoZWR1bGVyJ3MgUnVuUSBpbgorICogSXQgaW5zZXJ0cyB1bml0cyBv
ZiBtb3ZpbmcgZG9tYWluIHRvIHRoZSBzY2hlZHVsZXIncyBSdW5RIGluCiAgKiBkZXN0LiBjcHVw
b29sLgogICovCiBzdGF0aWMgdm9pZAogcnRfdW5pdF9pbnNlcnQoY29uc3Qgc3RydWN0IHNjaGVk
dWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIHsKLSAgICBzdHJ1Y3QgdmNwdSAq
dmMgPSB1bml0LT52Y3B1X2xpc3Q7CiAgICAgc3RydWN0IHJ0X3VuaXQgKnN2YyA9IHJ0X3VuaXQo
dW5pdCk7CiAgICAgc190aW1lX3Qgbm93OwogICAgIHNwaW5sb2NrX3QgKmxvY2s7CiAKLSAgICBC
VUdfT04oIGlzX2lkbGVfdmNwdSh2YykgKTsKKyAgICBCVUdfT04oIGlzX2lkbGVfdW5pdCh1bml0
KSApOwogCi0gICAgLyogVGhpcyBpcyBzYWZlIGJlY2F1c2UgdmMgaXNuJ3QgeWV0IGJlaW5nIHNj
aGVkdWxlZCAqLwotICAgIHVuaXQtPnJlcyA9IHJ0X3Jlc19waWNrKG9wcywgdW5pdCk7Ci0gICAg
dmMtPnByb2Nlc3NvciA9IHVuaXQtPnJlcy0+cHJvY2Vzc29yOworICAgIC8qIFRoaXMgaXMgc2Fm
ZSBiZWNhdXNlIHVuaXQgaXNuJ3QgeWV0IGJlaW5nIHNjaGVkdWxlZCAqLworICAgIHNjaGVkX3Nl
dF9yZXModW5pdCwgcnRfcmVzX3BpY2sob3BzLCB1bml0KSk7CiAKICAgICBsb2NrID0gdW5pdF9z
Y2hlZHVsZV9sb2NrX2lycSh1bml0KTsKIApAQCAtOTAyLDcgKzg5OCw3IEBAIHJ0X3VuaXRfaW5z
ZXJ0KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQp
CiAgICAgaWYgKCBub3cgPj0gc3ZjLT5jdXJfZGVhZGxpbmUgKQogICAgICAgICBydF91cGRhdGVf
ZGVhZGxpbmUobm93LCBzdmMpOwogCi0gICAgaWYgKCAhdmNwdV9vbl9xKHN2YykgJiYgdmNwdV9y
dW5uYWJsZSh2YykgKQorICAgIGlmICggIXVuaXRfb25fcShzdmMpICYmIHVuaXRfcnVubmFibGUo
dW5pdCkgKQogICAgIHsKICAgICAgICAgcmVwbHFfaW5zZXJ0KG9wcywgc3ZjKTsKIApAQCAtOTI5
LDEwICs5MjUsMTAgQEAgcnRfdW5pdF9yZW1vdmUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3Bz
LCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKICAgICBCVUdfT04oIHNkb20gPT0gTlVMTCApOwog
CiAgICAgbG9jayA9IHVuaXRfc2NoZWR1bGVfbG9ja19pcnEodW5pdCk7Ci0gICAgaWYgKCB2Y3B1
X29uX3Eoc3ZjKSApCisgICAgaWYgKCB1bml0X29uX3Eoc3ZjKSApCiAgICAgICAgIHFfcmVtb3Zl
KHN2Yyk7CiAKLSAgICBpZiAoIHZjcHVfb25fcmVwbHEoc3ZjKSApCisgICAgaWYgKCB1bml0X29u
X3JlcGxxKHN2YykgKQogICAgICAgICByZXBscV9yZW1vdmUob3BzLHN2Yyk7CiAKICAgICB1bml0
X3NjaGVkdWxlX3VubG9ja19pcnEobG9jaywgdW5pdCk7CkBAIC05NDYsOCArOTQyLDggQEAgYnVy
bl9idWRnZXQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgcnRfdW5pdCAqc3Zj
LCBzX3RpbWVfdCBub3cpCiB7CiAgICAgc190aW1lX3QgZGVsdGE7CiAKLSAgICAvKiBkb24ndCBi
dXJuIGJ1ZGdldCBmb3IgaWRsZSBWQ1BVICovCi0gICAgaWYgKCBpc19pZGxlX3ZjcHUoc3ZjLT52
Y3B1KSApCisgICAgLyogZG9uJ3QgYnVybiBidWRnZXQgZm9yIGlkbGUgVU5JVCAqLworICAgIGlm
ICggaXNfaWRsZV91bml0KHN2Yy0+dW5pdCkgKQogICAgICAgICByZXR1cm47CiAKICAgICAvKiBi
dXJuIGF0IG5hbm9zZWNvbmRzIGxldmVsICovCkBAIC05ODQsMTQgKzk4MCwxNCBAQCBidXJuX2J1
ZGdldChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBydF91bml0ICpzdmMsIHNf
dGltZV90IG5vdykKICAgICAvKiBUUkFDRSAqLwogICAgIHsKICAgICAgICAgc3RydWN0IF9fcGFj
a2VkIHsKLSAgICAgICAgICAgIHVuc2lnbmVkIHZjcHU6MTYsIGRvbToxNjsKKyAgICAgICAgICAg
IHVuc2lnbmVkIHVuaXQ6MTYsIGRvbToxNjsKICAgICAgICAgICAgIHVpbnQ2NF90IGN1cl9idWRn
ZXQ7CiAgICAgICAgICAgICBpbnQgZGVsdGE7CiAgICAgICAgICAgICB1bnNpZ25lZCBwcmlvcml0
eV9sZXZlbDsKICAgICAgICAgICAgIGJvb2wgaGFzX2V4dHJhdGltZTsKICAgICAgICAgfSBkOwot
ICAgICAgICBkLmRvbSA9IHN2Yy0+dmNwdS0+ZG9tYWluLT5kb21haW5faWQ7Ci0gICAgICAgIGQu
dmNwdSA9IHN2Yy0+dmNwdS0+dmNwdV9pZDsKKyAgICAgICAgZC5kb20gPSBzdmMtPnVuaXQtPmRv
bWFpbi0+ZG9tYWluX2lkOworICAgICAgICBkLnVuaXQgPSBzdmMtPnVuaXQtPnVuaXRfaWQ7CiAg
ICAgICAgIGQuY3VyX2J1ZGdldCA9ICh1aW50NjRfdCkgc3ZjLT5jdXJfYnVkZ2V0OwogICAgICAg
ICBkLmRlbHRhID0gZGVsdGE7CiAgICAgICAgIGQucHJpb3JpdHlfbGV2ZWwgPSBzdmMtPnByaW9y
aXR5X2xldmVsOwpAQCAtMTAyMSw5ICsxMDE3LDggQEAgcnVucV9waWNrKGNvbnN0IHN0cnVjdCBz
Y2hlZHVsZXIgKm9wcywgY29uc3QgY3B1bWFza190ICptYXNrKQogICAgICAgICBpdGVyX3N2YyA9
IHFfZWxlbShpdGVyKTsKIAogICAgICAgICAvKiBtYXNrIGNwdV9oYXJkX2FmZmluaXR5ICYgY3B1
cG9vbCAmIG1hc2sgKi8KLSAgICAgICAgb25saW5lID0gY3B1cG9vbF9kb21haW5fY3B1bWFzayhp
dGVyX3N2Yy0+dmNwdS0+ZG9tYWluKTsKLSAgICAgICAgY3B1bWFza19hbmQoJmNwdV9jb21tb24s
IG9ubGluZSwKLSAgICAgICAgICAgICAgICAgICAgaXRlcl9zdmMtPnZjcHUtPnNjaGVkX3VuaXQt
PmNwdV9oYXJkX2FmZmluaXR5KTsKKyAgICAgICAgb25saW5lID0gY3B1cG9vbF9kb21haW5fY3B1
bWFzayhpdGVyX3N2Yy0+dW5pdC0+ZG9tYWluKTsKKyAgICAgICAgY3B1bWFza19hbmQoJmNwdV9j
b21tb24sIG9ubGluZSwgaXRlcl9zdmMtPnVuaXQtPmNwdV9oYXJkX2FmZmluaXR5KTsKICAgICAg
ICAgY3B1bWFza19hbmQoJmNwdV9jb21tb24sIG1hc2ssICZjcHVfY29tbW9uKTsKICAgICAgICAg
aWYgKCBjcHVtYXNrX2VtcHR5KCZjcHVfY29tbW9uKSApCiAgICAgICAgICAgICBjb250aW51ZTsK
QEAgLTEwMzksMTEgKzEwMzQsMTEgQEAgcnVucV9waWNrKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIg
Km9wcywgY29uc3QgY3B1bWFza190ICptYXNrKQogICAgICAgICBpZiggc3ZjICE9IE5VTEwgKQog
ICAgICAgICB7CiAgICAgICAgICAgICBzdHJ1Y3QgX19wYWNrZWQgewotICAgICAgICAgICAgICAg
IHVuc2lnbmVkIHZjcHU6MTYsIGRvbToxNjsKKyAgICAgICAgICAgICAgICB1bnNpZ25lZCB1bml0
OjE2LCBkb206MTY7CiAgICAgICAgICAgICAgICAgdWludDY0X3QgY3VyX2RlYWRsaW5lLCBjdXJf
YnVkZ2V0OwogICAgICAgICAgICAgfSBkOwotICAgICAgICAgICAgZC5kb20gPSBzdmMtPnZjcHUt
PmRvbWFpbi0+ZG9tYWluX2lkOwotICAgICAgICAgICAgZC52Y3B1ID0gc3ZjLT52Y3B1LT52Y3B1
X2lkOworICAgICAgICAgICAgZC5kb20gPSBzdmMtPnVuaXQtPmRvbWFpbi0+ZG9tYWluX2lkOwor
ICAgICAgICAgICAgZC51bml0ID0gc3ZjLT51bml0LT51bml0X2lkOwogICAgICAgICAgICAgZC5j
dXJfZGVhZGxpbmUgPSAodWludDY0X3QpIHN2Yy0+Y3VyX2RlYWRsaW5lOwogICAgICAgICAgICAg
ZC5jdXJfYnVkZ2V0ID0gKHVpbnQ2NF90KSBzdmMtPmN1cl9idWRnZXQ7CiAgICAgICAgICAgICB0
cmFjZV92YXIoVFJDX1JURFNfUlVOUV9QSUNLLCAxLApAQCAtMTA2Nyw2ICsxMDYyLDcgQEAgcnRf
c2NoZWR1bGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzX3RpbWVfdCBub3csIGJvb2xf
dCB0YXNrbGV0X3dvcmtfc2NoZWQKICAgICBzdHJ1Y3QgcnRfdW5pdCAqY29uc3Qgc2N1cnIgPSBy
dF91bml0KGN1cnJlbnQtPnNjaGVkX3VuaXQpOwogICAgIHN0cnVjdCBydF91bml0ICpzbmV4dCA9
IE5VTEw7CiAgICAgc3RydWN0IHRhc2tfc2xpY2UgcmV0ID0geyAubWlncmF0ZWQgPSAwIH07Cisg
ICAgc3RydWN0IHNjaGVkX3VuaXQgKmN1cnJ1bml0ID0gY3VycmVudC0+c2NoZWRfdW5pdDsKIAog
ICAgIC8qIFRSQUNFICovCiAgICAgewpAQCAtMTA3Niw3ICsxMDcyLDcgQEAgcnRfc2NoZWR1bGUo
Y29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzX3RpbWVfdCBub3csIGJvb2xfdCB0YXNrbGV0
X3dvcmtfc2NoZWQKICAgICAgICAgZC5jcHUgPSBjcHU7CiAgICAgICAgIGQudGFza2xldCA9IHRh
c2tsZXRfd29ya19zY2hlZHVsZWQ7CiAgICAgICAgIGQudGlja2xlZCA9IGNwdW1hc2tfdGVzdF9j
cHUoY3B1LCAmcHJ2LT50aWNrbGVkKTsKLSAgICAgICAgZC5pZGxlID0gaXNfaWRsZV92Y3B1KGN1
cnJlbnQpOworICAgICAgICBkLmlkbGUgPSBpc19pZGxlX3VuaXQoY3VycnVuaXQpOwogICAgICAg
ICB0cmFjZV92YXIoVFJDX1JURFNfU0NIRURVTEUsIDEsCiAgICAgICAgICAgICAgICAgICBzaXpl
b2YoZCksCiAgICAgICAgICAgICAgICAgICAodW5zaWduZWQgY2hhciAqKSZkKTsKQEAgLTEwODUs
NzIgKzEwODEsNzAgQEAgcnRfc2NoZWR1bGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBz
X3RpbWVfdCBub3csIGJvb2xfdCB0YXNrbGV0X3dvcmtfc2NoZWQKICAgICAvKiBjbGVhciB0aWNr
ZWQgYml0IG5vdyB0aGF0IHdlJ3ZlIGJlZW4gc2NoZWR1bGVkICovCiAgICAgY3B1bWFza19jbGVh
cl9jcHUoY3B1LCAmcHJ2LT50aWNrbGVkKTsKIAotICAgIC8qIGJ1cm5fYnVkZ2V0IHdvdWxkIHJl
dHVybiBmb3IgSURMRSBWQ1BVICovCisgICAgLyogYnVybl9idWRnZXQgd291bGQgcmV0dXJuIGZv
ciBJRExFIFVOSVQgKi8KICAgICBidXJuX2J1ZGdldChvcHMsIHNjdXJyLCBub3cpOwogCiAgICAg
aWYgKCB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkICkKICAgICB7CiAgICAgICAgIHRyYWNlX3ZhcihU
UkNfUlREU19TQ0hFRF9UQVNLTEVULCAxLCAwLCAgTlVMTCk7Ci0gICAgICAgIHNuZXh0ID0gcnRf
dW5pdChpZGxlX3ZjcHVbY3B1XS0+c2NoZWRfdW5pdCk7CisgICAgICAgIHNuZXh0ID0gcnRfdW5p
dChzY2hlZF9pZGxlX3VuaXQoY3B1KSk7CiAgICAgfQogICAgIGVsc2UKICAgICB7CiAgICAgICAg
IHNuZXh0ID0gcnVucV9waWNrKG9wcywgY3B1bWFza19vZihjcHUpKTsKICAgICAgICAgaWYgKCBz
bmV4dCA9PSBOVUxMICkKLSAgICAgICAgICAgIHNuZXh0ID0gcnRfdW5pdChpZGxlX3ZjcHVbY3B1
XS0+c2NoZWRfdW5pdCk7CisgICAgICAgICAgICBzbmV4dCA9IHJ0X3VuaXQoc2NoZWRfaWRsZV91
bml0KGNwdSkpOwogCiAgICAgICAgIC8qIGlmIHNjdXJyIGhhcyBoaWdoZXIgcHJpb3JpdHkgYW5k
IGJ1ZGdldCwgc3RpbGwgcGljayBzY3VyciAqLwotICAgICAgICBpZiAoICFpc19pZGxlX3ZjcHUo
Y3VycmVudCkgJiYKLSAgICAgICAgICAgICB2Y3B1X3J1bm5hYmxlKGN1cnJlbnQpICYmCisgICAg
ICAgIGlmICggIWlzX2lkbGVfdW5pdChjdXJydW5pdCkgJiYKKyAgICAgICAgICAgICB1bml0X3J1
bm5hYmxlKGN1cnJ1bml0KSAmJgogICAgICAgICAgICAgIHNjdXJyLT5jdXJfYnVkZ2V0ID4gMCAm
JgotICAgICAgICAgICAgICggaXNfaWRsZV92Y3B1KHNuZXh0LT52Y3B1KSB8fAotICAgICAgICAg
ICAgICAgY29tcGFyZV92Y3B1X3ByaW9yaXR5KHNjdXJyLCBzbmV4dCkgPiAwICkgKQorICAgICAg
ICAgICAgICggaXNfaWRsZV91bml0KHNuZXh0LT51bml0KSB8fAorICAgICAgICAgICAgICAgY29t
cGFyZV91bml0X3ByaW9yaXR5KHNjdXJyLCBzbmV4dCkgPiAwICkgKQogICAgICAgICAgICAgc25l
eHQgPSBzY3VycjsKICAgICB9CiAKICAgICBpZiAoIHNuZXh0ICE9IHNjdXJyICYmCi0gICAgICAg
ICAhaXNfaWRsZV92Y3B1KGN1cnJlbnQpICYmCi0gICAgICAgICB2Y3B1X3J1bm5hYmxlKGN1cnJl
bnQpICkKKyAgICAgICAgICFpc19pZGxlX3VuaXQoY3VycnVuaXQpICYmCisgICAgICAgICB1bml0
X3J1bm5hYmxlKGN1cnJ1bml0KSApCiAgICAgICAgIF9fc2V0X2JpdChfX1JURFNfZGVsYXllZF9y
dW5xX2FkZCwgJnNjdXJyLT5mbGFncyk7CiAKICAgICBzbmV4dC0+bGFzdF9zdGFydCA9IG5vdzsK
LSAgICByZXQudGltZSA9ICAtMTsgLyogaWYgYW4gaWRsZSB2Y3B1IGlzIHBpY2tlZCAqLwotICAg
IGlmICggIWlzX2lkbGVfdmNwdShzbmV4dC0+dmNwdSkgKQorICAgIHJldC50aW1lID0gIC0xOyAv
KiBpZiBhbiBpZGxlIHVuaXQgaXMgcGlja2VkICovCisgICAgaWYgKCAhaXNfaWRsZV91bml0KHNu
ZXh0LT51bml0KSApCiAgICAgewogICAgICAgICBpZiAoIHNuZXh0ICE9IHNjdXJyICkKICAgICAg
ICAgewogICAgICAgICAgICAgcV9yZW1vdmUoc25leHQpOwogICAgICAgICAgICAgX19zZXRfYml0
KF9fUlREU19zY2hlZHVsZWQsICZzbmV4dC0+ZmxhZ3MpOwogICAgICAgICB9Ci0gICAgICAgIGlm
ICggc25leHQtPnZjcHUtPnByb2Nlc3NvciAhPSBjcHUgKQorICAgICAgICBpZiAoIHNjaGVkX3Vu
aXRfY3B1KHNuZXh0LT51bml0KSAhPSBjcHUgKQogICAgICAgICB7Ci0gICAgICAgICAgICBzbmV4
dC0+dmNwdS0+cHJvY2Vzc29yID0gY3B1OwotICAgICAgICAgICAgc25leHQtPnZjcHUtPnNjaGVk
X3VuaXQtPnJlcyA9IGdldF9zY2hlZF9yZXMoY3B1KTsKKyAgICAgICAgICAgIHNjaGVkX3NldF9y
ZXMoc25leHQtPnVuaXQsIGdldF9zY2hlZF9yZXMoY3B1KSk7CiAgICAgICAgICAgICByZXQubWln
cmF0ZWQgPSAxOwogICAgICAgICB9CiAgICAgICAgIHJldC50aW1lID0gc25leHQtPmN1cl9idWRn
ZXQ7IC8qIGludm9rZSB0aGUgc2NoZWR1bGVyIG5leHQgdGltZSAqLwogICAgIH0KLSAgICByZXQu
dGFzayA9IHNuZXh0LT52Y3B1LT5zY2hlZF91bml0OworICAgIHJldC50YXNrID0gc25leHQtPnVu
aXQ7CiAKICAgICByZXR1cm4gcmV0OwogfQogCiAvKgotICogUmVtb3ZlIFZDUFUgZnJvbSBSdW5R
CisgKiBSZW1vdmUgVU5JVCBmcm9tIFJ1blEKICAqIFRoZSBsb2NrIGlzIGFscmVhZHkgZ3JhYmJl
ZCBpbiBzY2hlZHVsZS5jLCBubyBuZWVkIHRvIGxvY2sgaGVyZQogICovCiBzdGF0aWMgdm9pZAog
cnRfdW5pdF9zbGVlcChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF91
bml0ICp1bml0KQogewotICAgIHN0cnVjdCB2Y3B1ICp2YyA9IHVuaXQtPnZjcHVfbGlzdDsKICAg
ICBzdHJ1Y3QgcnRfdW5pdCAqIGNvbnN0IHN2YyA9IHJ0X3VuaXQodW5pdCk7CiAKLSAgICBCVUdf
T04oIGlzX2lkbGVfdmNwdSh2YykgKTsKKyAgICBCVUdfT04oIGlzX2lkbGVfdW5pdCh1bml0KSAp
OwogICAgIFNDSEVEX1NUQVRfQ1JBTksodW5pdF9zbGVlcCk7CiAKLSAgICBpZiAoIGN1cnJfb25f
Y3B1KHZjLT5wcm9jZXNzb3IpID09IHVuaXQgKQotICAgICAgICBjcHVfcmFpc2Vfc29mdGlycSh2
Yy0+cHJvY2Vzc29yLCBTQ0hFRFVMRV9TT0ZUSVJRKTsKLSAgICBlbHNlIGlmICggdmNwdV9vbl9x
KHN2YykgKQorICAgIGlmICggY3Vycl9vbl9jcHUoc2NoZWRfdW5pdF9jcHUodW5pdCkpID09IHVu
aXQgKQorICAgICAgICBjcHVfcmFpc2Vfc29mdGlycShzY2hlZF91bml0X2NwdSh1bml0KSwgU0NI
RURVTEVfU09GVElSUSk7CisgICAgZWxzZSBpZiAoIHVuaXRfb25fcShzdmMpICkKICAgICB7CiAg
ICAgICAgIHFfcmVtb3ZlKHN2Yyk7CiAgICAgICAgIHJlcGxxX3JlbW92ZShvcHMsIHN2Yyk7CkBA
IC0xMTYwLDIwICsxMTU0LDIwIEBAIHJ0X3VuaXRfc2xlZXAoY29uc3Qgc3RydWN0IHNjaGVkdWxl
ciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIH0KIAogLyoKLSAqIFBpY2sgYSBjcHUg
d2hlcmUgdG8gcnVuIGEgdmNwdSwKLSAqIHBvc3NpYmx5IGtpY2tpbmcgb3V0IHRoZSB2Y3B1IHJ1
bm5pbmcgdGhlcmUKKyAqIFBpY2sgYSBjcHUgd2hlcmUgdG8gcnVuIGFuIHVuaXQsCisgKiBwb3Nz
aWJseSBraWNraW5nIG91dCB0aGUgdW5pdCBydW5uaW5nIHRoZXJlCiAgKiBDYWxsZWQgYnkgd2Fr
ZSgpIGFuZCBjb250ZXh0X3NhdmVkKCkKICAqIFdlIGhhdmUgYSBydW5uaW5nIGNhbmRpZGF0ZSBo
ZXJlLCB0aGUga2ljayBsb2dpYyBpczoKICAqIEFtb25nIGFsbCB0aGUgY3B1cyB0aGF0IGFyZSB3
aXRoaW4gdGhlIGNwdSBhZmZpbml0eQogICogMSkgaWYgdGhlcmUgYXJlIGFueSBpZGxlIENQVXMs
IGtpY2sgb25lLgogICAgICAgRm9yIGNhY2hlIGJlbmVmaXQsIHdlIGNoZWNrIG5ldy0+Y3B1IGFz
IGZpcnN0CiAgKiAyKSBub3cgYWxsIHBjcHVzIGFyZSBidXN5OwotICogICAgYW1vbmcgYWxsIHRo
ZSBydW5uaW5nIHZjcHVzLCBwaWNrIGxvd2VzdCBwcmlvcml0eSBvbmUKKyAqICAgIGFtb25nIGFs
bCB0aGUgcnVubmluZyB1bml0cywgcGljayBsb3dlc3QgcHJpb3JpdHkgb25lCiAgKiAgICBpZiBz
bmV4dCBoYXMgaGlnaGVyIHByaW9yaXR5LCBraWNrIGl0LgogICoKICAqIFRPRE86Ci0gKiAxKSB3
aGF0IGlmIHRoZXNlIHR3byB2Y3B1cyBiZWxvbmdzIHRvIHRoZSBzYW1lIGRvbWFpbj8KLSAqICAg
IHJlcGxhY2UgYSB2Y3B1IGJlbG9uZ2luZyB0byB0aGUgc2FtZSBkb21haW4gaW50cm9kdWNlcyBt
b3JlIG92ZXJoZWFkCisgKiAxKSB3aGF0IGlmIHRoZXNlIHR3byB1bml0cyBiZWxvbmdzIHRvIHRo
ZSBzYW1lIGRvbWFpbj8KKyAqICAgIHJlcGxhY2UgYW4gdW5pdCBiZWxvbmdpbmcgdG8gdGhlIHNh
bWUgZG9tYWluIGludHJvZHVjZXMgbW9yZSBvdmVyaGVhZAogICoKICAqIGxvY2sgaXMgZ3JhYmJl
ZCBiZWZvcmUgY2FsbGluZyB0aGlzIGZ1bmN0aW9uCiAgKi8KQEAgLTExODEsMTggKzExNzUsMTgg
QEAgc3RhdGljIHZvaWQKIHJ1bnFfdGlja2xlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywg
c3RydWN0IHJ0X3VuaXQgKm5ldykKIHsKICAgICBzdHJ1Y3QgcnRfcHJpdmF0ZSAqcHJ2ID0gcnRf
cHJpdihvcHMpOwotICAgIHN0cnVjdCBydF91bml0ICpsYXRlc3RfZGVhZGxpbmVfdmNwdSA9IE5V
TEw7IC8qIGxvd2VzdCBwcmlvcml0eSAqLworICAgIHN0cnVjdCBydF91bml0ICpsYXRlc3RfZGVh
ZGxpbmVfdW5pdCA9IE5VTEw7IC8qIGxvd2VzdCBwcmlvcml0eSAqLwogICAgIHN0cnVjdCBydF91
bml0ICppdGVyX3N2YzsKLSAgICBzdHJ1Y3QgdmNwdSAqaXRlcl92YzsKKyAgICBzdHJ1Y3Qgc2No
ZWRfdW5pdCAqaXRlcl91bml0OwogICAgIGludCBjcHUgPSAwLCBjcHVfdG9fdGlja2xlID0gMDsK
ICAgICBjcHVtYXNrX3Qgbm90X3RpY2tsZWQ7CiAgICAgY3B1bWFza190ICpvbmxpbmU7CiAKLSAg
ICBpZiAoIG5ldyA9PSBOVUxMIHx8IGlzX2lkbGVfdmNwdShuZXctPnZjcHUpICkKKyAgICBpZiAo
IG5ldyA9PSBOVUxMIHx8IGlzX2lkbGVfdW5pdChuZXctPnVuaXQpICkKICAgICAgICAgcmV0dXJu
OwogCi0gICAgb25saW5lID0gY3B1cG9vbF9kb21haW5fY3B1bWFzayhuZXctPnZjcHUtPmRvbWFp
bik7Ci0gICAgY3B1bWFza19hbmQoJm5vdF90aWNrbGVkLCBvbmxpbmUsIG5ldy0+dmNwdS0+c2No
ZWRfdW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHkpOworICAgIG9ubGluZSA9IGNwdXBvb2xfZG9tYWlu
X2NwdW1hc2sobmV3LT51bml0LT5kb21haW4pOworICAgIGNwdW1hc2tfYW5kKCZub3RfdGlja2xl
ZCwgb25saW5lLCBuZXctPnVuaXQtPmNwdV9oYXJkX2FmZmluaXR5KTsKICAgICBjcHVtYXNrX2Fu
ZG5vdCgmbm90X3RpY2tsZWQsICZub3RfdGlja2xlZCwgJnBydi0+dGlja2xlZCk7CiAKICAgICAv
KgpAQCAtMTIwMCwzMSArMTE5NCwzMSBAQCBydW5xX3RpY2tsZShjb25zdCBzdHJ1Y3Qgc2NoZWR1
bGVyICpvcHMsIHN0cnVjdCBydF91bml0ICpuZXcpCiAgICAgICogICAgRm9yIGNhY2hlIGJlbmVm
aXQsd2UgZmlyc3Qgc2VhcmNoIG5ldy0+Y3B1LgogICAgICAqICAgIFRoZSBzYW1lIGxvb3AgYWxz
byBmaW5kIHRoZSBvbmUgd2l0aCBsb3dlc3QgcHJpb3JpdHkuCiAgICAgICovCi0gICAgY3B1ID0g
Y3B1bWFza190ZXN0X29yX2N5Y2xlKG5ldy0+dmNwdS0+cHJvY2Vzc29yLCAmbm90X3RpY2tsZWQp
OworICAgIGNwdSA9IGNwdW1hc2tfdGVzdF9vcl9jeWNsZShzY2hlZF91bml0X2NwdShuZXctPnVu
aXQpLCAmbm90X3RpY2tsZWQpOwogICAgIHdoaWxlICggY3B1IT0gbnJfY3B1X2lkcyApCiAgICAg
ewotICAgICAgICBpdGVyX3ZjID0gY3Vycl9vbl9jcHUoY3B1KS0+dmNwdV9saXN0OwotICAgICAg
ICBpZiAoIGlzX2lkbGVfdmNwdShpdGVyX3ZjKSApCisgICAgICAgIGl0ZXJfdW5pdCA9IGN1cnJf
b25fY3B1KGNwdSk7CisgICAgICAgIGlmICggaXNfaWRsZV91bml0KGl0ZXJfdW5pdCkgKQogICAg
ICAgICB7CiAgICAgICAgICAgICBTQ0hFRF9TVEFUX0NSQU5LKHRpY2tsZWRfaWRsZV9jcHUpOwog
ICAgICAgICAgICAgY3B1X3RvX3RpY2tsZSA9IGNwdTsKICAgICAgICAgICAgIGdvdG8gb3V0Owog
ICAgICAgICB9Ci0gICAgICAgIGl0ZXJfc3ZjID0gcnRfdW5pdChpdGVyX3ZjLT5zY2hlZF91bml0
KTsKLSAgICAgICAgaWYgKCBsYXRlc3RfZGVhZGxpbmVfdmNwdSA9PSBOVUxMIHx8Ci0gICAgICAg
ICAgICAgY29tcGFyZV92Y3B1X3ByaW9yaXR5KGl0ZXJfc3ZjLCBsYXRlc3RfZGVhZGxpbmVfdmNw
dSkgPCAwICkKLSAgICAgICAgICAgIGxhdGVzdF9kZWFkbGluZV92Y3B1ID0gaXRlcl9zdmM7Cisg
ICAgICAgIGl0ZXJfc3ZjID0gcnRfdW5pdChpdGVyX3VuaXQpOworICAgICAgICBpZiAoIGxhdGVz
dF9kZWFkbGluZV91bml0ID09IE5VTEwgfHwKKyAgICAgICAgICAgICBjb21wYXJlX3VuaXRfcHJp
b3JpdHkoaXRlcl9zdmMsIGxhdGVzdF9kZWFkbGluZV91bml0KSA8IDAgKQorICAgICAgICAgICAg
bGF0ZXN0X2RlYWRsaW5lX3VuaXQgPSBpdGVyX3N2YzsKIAogICAgICAgICBjcHVtYXNrX2NsZWFy
X2NwdShjcHUsICZub3RfdGlja2xlZCk7CiAgICAgICAgIGNwdSA9IGNwdW1hc2tfY3ljbGUoY3B1
LCAmbm90X3RpY2tsZWQpOwogICAgIH0KIAotICAgIC8qIDIpIGNhbmRpY2F0ZSBoYXMgaGlnaGVy
IHByaW9yaXR5LCBraWNrIG91dCBsb3dlc3QgcHJpb3JpdHkgdmNwdSAqLwotICAgIGlmICggbGF0
ZXN0X2RlYWRsaW5lX3ZjcHUgIT0gTlVMTCAmJgotICAgICAgICAgY29tcGFyZV92Y3B1X3ByaW9y
aXR5KGxhdGVzdF9kZWFkbGluZV92Y3B1LCBuZXcpIDwgMCApCisgICAgLyogMikgY2FuZGljYXRl
IGhhcyBoaWdoZXIgcHJpb3JpdHksIGtpY2sgb3V0IGxvd2VzdCBwcmlvcml0eSB1bml0ICovCisg
ICAgaWYgKCBsYXRlc3RfZGVhZGxpbmVfdW5pdCAhPSBOVUxMICYmCisgICAgICAgICBjb21wYXJl
X3VuaXRfcHJpb3JpdHkobGF0ZXN0X2RlYWRsaW5lX3VuaXQsIG5ldykgPCAwICkKICAgICB7CiAg
ICAgICAgIFNDSEVEX1NUQVRfQ1JBTksodGlja2xlZF9idXN5X2NwdSk7Ci0gICAgICAgIGNwdV90
b190aWNrbGUgPSBsYXRlc3RfZGVhZGxpbmVfdmNwdS0+dmNwdS0+cHJvY2Vzc29yOworICAgICAg
ICBjcHVfdG9fdGlja2xlID0gc2NoZWRfdW5pdF9jcHUobGF0ZXN0X2RlYWRsaW5lX3VuaXQtPnVu
aXQpOwogICAgICAgICBnb3RvIG91dDsKICAgICB9CiAKQEAgLTEyNTAsMzUgKzEyNDQsMzQgQEAg
cnVucV90aWNrbGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgcnRfdW5pdCAq
bmV3KQogfQogCiAvKgotICogU2hvdWxkIGFsd2F5cyB3YWtlIHVwIHJ1bm5hYmxlIHZjcHUsIHB1
dCBpdCBiYWNrIHRvIFJ1blEuCisgKiBTaG91bGQgYWx3YXlzIHdha2UgdXAgcnVubmFibGUgdW5p
dCwgcHV0IGl0IGJhY2sgdG8gUnVuUS4KICAqIENoZWNrIHByaW9yaXR5IHRvIHJhaXNlIGludGVy
cnVwdAogICogVGhlIGxvY2sgaXMgYWxyZWFkeSBncmFiYmVkIGluIHNjaGVkdWxlLmMsIG5vIG5l
ZWQgdG8gbG9jayBoZXJlCi0gKiBUT0RPOiB3aGF0IGlmIHRoZXNlIHR3byB2Y3B1cyBiZWxvbmdz
IHRvIHRoZSBzYW1lIGRvbWFpbj8KKyAqIFRPRE86IHdoYXQgaWYgdGhlc2UgdHdvIHVuaXRzIGJl
bG9uZ3MgdG8gdGhlIHNhbWUgZG9tYWluPwogICovCiBzdGF0aWMgdm9pZAogcnRfdW5pdF93YWtl
KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiB7
Ci0gICAgc3RydWN0IHZjcHUgKnZjID0gdW5pdC0+dmNwdV9saXN0OwogICAgIHN0cnVjdCBydF91
bml0ICogY29uc3Qgc3ZjID0gcnRfdW5pdCh1bml0KTsKICAgICBzX3RpbWVfdCBub3c7CiAgICAg
Ym9vbF90IG1pc3NlZDsKIAotICAgIEJVR19PTiggaXNfaWRsZV92Y3B1KHZjKSApOworICAgIEJV
R19PTiggaXNfaWRsZV91bml0KHVuaXQpICk7CiAKLSAgICBpZiAoIHVubGlrZWx5KGN1cnJfb25f
Y3B1KHZjLT5wcm9jZXNzb3IpID09IHVuaXQpICkKKyAgICBpZiAoIHVubGlrZWx5KGN1cnJfb25f
Y3B1KHNjaGVkX3VuaXRfY3B1KHVuaXQpKSA9PSB1bml0KSApCiAgICAgewogICAgICAgICBTQ0hF
RF9TVEFUX0NSQU5LKHVuaXRfd2FrZV9ydW5uaW5nKTsKICAgICAgICAgcmV0dXJuOwogICAgIH0K
IAogICAgIC8qIG9uIFJ1blEvRGVwbGV0ZWRRLCBqdXN0IHVwZGF0ZSBpbmZvIGlzIG9rICovCi0g
ICAgaWYgKCB1bmxpa2VseSh2Y3B1X29uX3Eoc3ZjKSkgKQorICAgIGlmICggdW5saWtlbHkodW5p
dF9vbl9xKHN2YykpICkKICAgICB7CiAgICAgICAgIFNDSEVEX1NUQVRfQ1JBTksodW5pdF93YWtl
X29ucnVucSk7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKLSAgICBpZiAoIGxpa2VseSh2Y3B1
X3J1bm5hYmxlKHZjKSkgKQorICAgIGlmICggbGlrZWx5KHVuaXRfcnVubmFibGUodW5pdCkpICkK
ICAgICAgICAgU0NIRURfU1RBVF9DUkFOSyh1bml0X3dha2VfcnVubmFibGUpOwogICAgIGVsc2UK
ICAgICAgICAgU0NIRURfU1RBVF9DUkFOSyh1bml0X3dha2Vfbm90X3J1bm5hYmxlKTsKQEAgLTEy
OTQsMTYgKzEyODcsMTYgQEAgcnRfdW5pdF93YWtlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9w
cywgc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiAgICAgICAgIHJ0X3VwZGF0ZV9kZWFkbGluZShu
b3csIHN2Yyk7CiAKICAgICAvKgotICAgICAqIElmIGNvbnRleHQgaGFzbid0IGJlZW4gc2F2ZWQg
Zm9yIHRoaXMgdmNwdSB5ZXQsIHdlIGNhbid0IHB1dCBpdCBvbgorICAgICAqIElmIGNvbnRleHQg
aGFzbid0IGJlZW4gc2F2ZWQgZm9yIHRoaXMgdW5pdCB5ZXQsIHdlIGNhbid0IHB1dCBpdCBvbgog
ICAgICAqIHRoZSBydW4tcXVldWUvZGVwbGV0ZWQtcXVldWUuIEluc3RlYWQsIHdlIHNldCB0aGUg
YXBwcm9wcmlhdGUgZmxhZywKLSAgICAgKiB0aGUgdmNwdSB3aWxsIGJlIHB1dCBiYWNrIG9uIHF1
ZXVlIGFmdGVyIHRoZSBjb250ZXh0IGhhcyBiZWVuIHNhdmVkCisgICAgICogdGhlIHVuaXQgd2ls
bCBiZSBwdXQgYmFjayBvbiBxdWV1ZSBhZnRlciB0aGUgY29udGV4dCBoYXMgYmVlbiBzYXZlZAog
ICAgICAqIChpbiBydF9jb250ZXh0X3NhdmUoKSkuCiAgICAgICovCiAgICAgaWYgKCB1bmxpa2Vs
eShzdmMtPmZsYWdzICYgUlREU19zY2hlZHVsZWQpICkKICAgICB7CiAgICAgICAgIF9fc2V0X2Jp
dChfX1JURFNfZGVsYXllZF9ydW5xX2FkZCwgJnN2Yy0+ZmxhZ3MpOwogICAgICAgICAvKgotICAg
ICAgICAgKiBUaGUgdmNwdSBpcyB3YWtpbmcgdXAgYWxyZWFkeSwgYW5kIHdlIGRpZG4ndCBldmVu
IGhhZCB0aGUgdGltZSB0bworICAgICAgICAgKiBUaGUgdW5pdCBpcyB3YWtpbmcgdXAgYWxyZWFk
eSwgYW5kIHdlIGRpZG4ndCBldmVuIGhhZCB0aGUgdGltZSB0bwogICAgICAgICAgKiByZW1vdmUg
aXRzIG5leHQgcmVwbGVuaXNobWVudCBldmVudCBmcm9tIHRoZSByZXBsZW5pc2htZW50IHF1ZXVl
CiAgICAgICAgICAqIHdoZW4gaXQgYmxvY2tlZCEgTm8gYmlnIGRlYWwuIElmIHdlIGRpZCBub3Qg
bWlzcyB0aGUgZGVhZGxpbmUgaW4KICAgICAgICAgICogdGhlIG1lYW50aW1lLCBsZXQncyBqdXN0
IGxlYXZlIGl0IHRoZXJlLiBJZiB3ZSBkaWQsIGxldCdzIHJlbW92ZSBpdApAQCAtMTMyNCwyMiAr
MTMxNywyMSBAQCBydF91bml0X3dha2UoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1
Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIAogLyoKICAqIHNjdXJyIGhhcyBmaW5pc2hlZCBjb250ZXh0
IHN3aXRjaCwgaW5zZXJ0IGl0IGJhY2sgdG8gdGhlIFJ1blEsCi0gKiBhbmQgdGhlbiBwaWNrIHRo
ZSBoaWdoZXN0IHByaW9yaXR5IHZjcHUgZnJvbSBydW5xIHRvIHJ1bgorICogYW5kIHRoZW4gcGlj
ayB0aGUgaGlnaGVzdCBwcmlvcml0eSB1bml0IGZyb20gcnVucSB0byBydW4KICAqLwogc3RhdGlj
IHZvaWQKIHJ0X2NvbnRleHRfc2F2ZWQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1
Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKIHsKLSAgICBzdHJ1Y3QgdmNwdSAqdmMgPSB1bml0LT52Y3B1
X2xpc3Q7CiAgICAgc3RydWN0IHJ0X3VuaXQgKnN2YyA9IHJ0X3VuaXQodW5pdCk7CiAgICAgc3Bp
bmxvY2tfdCAqbG9jayA9IHVuaXRfc2NoZWR1bGVfbG9ja19pcnEodW5pdCk7CiAKICAgICBfX2Ns
ZWFyX2JpdChfX1JURFNfc2NoZWR1bGVkLCAmc3ZjLT5mbGFncyk7Ci0gICAgLyogbm90IGluc2Vy
dCBpZGxlIHZjcHUgdG8gcnVucSAqLwotICAgIGlmICggaXNfaWRsZV92Y3B1KHZjKSApCisgICAg
Lyogbm90IGluc2VydCBpZGxlIHVuaXQgdG8gcnVucSAqLworICAgIGlmICggaXNfaWRsZV91bml0
KHVuaXQpICkKICAgICAgICAgZ290byBvdXQ7CiAKICAgICBpZiAoIF9fdGVzdF9hbmRfY2xlYXJf
Yml0KF9fUlREU19kZWxheWVkX3J1bnFfYWRkLCAmc3ZjLT5mbGFncykgJiYKLSAgICAgICAgIGxp
a2VseSh2Y3B1X3J1bm5hYmxlKHZjKSkgKQorICAgICAgICAgbGlrZWx5KHVuaXRfcnVubmFibGUo
dW5pdCkpICkKICAgICB7CiAgICAgICAgIHJ1bnFfaW5zZXJ0KG9wcywgc3ZjKTsKICAgICAgICAg
cnVucV90aWNrbGUob3BzLCBzdmMpOwpAQCAtMTM1Miw3ICsxMzQ0LDcgQEAgb3V0OgogfQogCiAv
KgotICogc2V0L2dldCBlYWNoIHZjcHUgaW5mbyBvZiBlYWNoIGRvbWFpbgorICogc2V0L2dldCBl
YWNoIHVuaXQgaW5mbyBvZiBlYWNoIGRvbWFpbgogICovCiBzdGF0aWMgaW50CiBydF9kb21fY250
bCgKQEAgLTEzNjIsNyArMTM1NCw3IEBAIHJ0X2RvbV9jbnRsKAogewogICAgIHN0cnVjdCBydF9w
cml2YXRlICpwcnYgPSBydF9wcml2KG9wcyk7CiAgICAgc3RydWN0IHJ0X3VuaXQgKnN2YzsKLSAg
ICBzdHJ1Y3QgdmNwdSAqdjsKKyAgICBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdDsKICAgICB1bnNp
Z25lZCBsb25nIGZsYWdzOwogICAgIGludCByYyA9IDA7CiAgICAgc3RydWN0IHhlbl9kb21jdGxf
c2NoZWRwYXJhbV92Y3B1IGxvY2FsX3NjaGVkOwpAQCAtMTM4Myw5ICsxMzc1LDkgQEAgcnRfZG9t
X2NudGwoCiAgICAgICAgICAgICBicmVhazsKICAgICAgICAgfQogICAgICAgICBzcGluX2xvY2tf
aXJxc2F2ZSgmcHJ2LT5sb2NrLCBmbGFncyk7Ci0gICAgICAgIGZvcl9lYWNoX3ZjcHUgKCBkLCB2
ICkKKyAgICAgICAgZm9yX2VhY2hfc2NoZWRfdW5pdCAoIGQsIHVuaXQgKQogICAgICAgICB7Ci0g
ICAgICAgICAgICBzdmMgPSBydF91bml0KHYtPnNjaGVkX3VuaXQpOworICAgICAgICAgICAgc3Zj
ID0gcnRfdW5pdCh1bml0KTsKICAgICAgICAgICAgIHN2Yy0+cGVyaW9kID0gTUlDUk9TRUNTKG9w
LT51LnJ0ZHMucGVyaW9kKTsgLyogdHJhbnNmZXIgdG8gbmFub3NlYyAqLwogICAgICAgICAgICAg
c3ZjLT5idWRnZXQgPSBNSUNST1NFQ1Mob3AtPnUucnRkcy5idWRnZXQpOwogICAgICAgICB9CkBA
IC0xNDUzLDcgKzE0NDUsNyBAQCBydF9kb21fY250bCgKICAgICAgICAgICAgICAgICBicmVhazsK
ICAgICAgICAgfQogICAgICAgICBpZiAoICFyYyApCi0gICAgICAgICAgICAvKiBub3RpZnkgdXBw
ZXIgY2FsbGVyIGhvdyBtYW55IHZjcHVzIGhhdmUgYmVlbiBwcm9jZXNzZWQuICovCisgICAgICAg
ICAgICAvKiBub3RpZnkgdXBwZXIgY2FsbGVyIGhvdyBtYW55IHVuaXRzIGhhdmUgYmVlbiBwcm9j
ZXNzZWQuICovCiAgICAgICAgICAgICBvcC0+dS52Lm5yX3ZjcHVzID0gaW5kZXg7CiAgICAgICAg
IGJyZWFrOwogICAgIH0KQEAgLTE0NjIsNyArMTQ1NCw3IEBAIHJ0X2RvbV9jbnRsKAogfQogCiAv
KgotICogVGhlIHJlcGxlbmlzaG1lbnQgdGltZXIgaGFuZGxlciBwaWNrcyB2Y3B1cworICogVGhl
IHJlcGxlbmlzaG1lbnQgdGltZXIgaGFuZGxlciBwaWNrcyB1bml0cwogICogZnJvbSB0aGUgcmVw
bHEgYW5kIGRvZXMgdGhlIGFjdHVhbCByZXBsZW5pc2htZW50LgogICovCiBzdGF0aWMgdm9pZCBy
ZXBsX3RpbWVyX2hhbmRsZXIodm9pZCAqZGF0YSl7CkBAIC0xNDgwLDcgKzE0NzIsNyBAQCBzdGF0
aWMgdm9pZCByZXBsX3RpbWVyX2hhbmRsZXIodm9pZCAqZGF0YSl7CiAgICAgbm93ID0gTk9XKCk7
CiAKICAgICAvKgotICAgICAqIERvIHRoZSByZXBsZW5pc2htZW50IGFuZCBtb3ZlIHJlcGxlbmlz
aGVkIHZjcHVzCisgICAgICogRG8gdGhlIHJlcGxlbmlzaG1lbnQgYW5kIG1vdmUgcmVwbGVuaXNo
ZWQgdW5pdHMKICAgICAgKiB0byB0aGUgdGVtcG9yYXJ5IGxpc3QgdG8gdGlja2xlLgogICAgICAq
IElmIHN2YyBpcyBvbiBydW4gcXVldWUsIHdlIG5lZWQgdG8gcHV0IGl0IGF0CiAgICAgICogdGhl
IGNvcnJlY3QgcGxhY2Ugc2luY2UgaXRzIGRlYWRsaW5lIGNoYW5nZXMuCkBAIC0xNDk2LDcgKzE0
ODgsNyBAQCBzdGF0aWMgdm9pZCByZXBsX3RpbWVyX2hhbmRsZXIodm9pZCAqZGF0YSl7CiAgICAg
ICAgIHJ0X3VwZGF0ZV9kZWFkbGluZShub3csIHN2Yyk7CiAgICAgICAgIGxpc3RfYWRkKCZzdmMt
PnJlcGxxX2VsZW0sICZ0bXBfcmVwbHEpOwogCi0gICAgICAgIGlmICggdmNwdV9vbl9xKHN2Yykg
KQorICAgICAgICBpZiAoIHVuaXRfb25fcShzdmMpICkKICAgICAgICAgewogICAgICAgICAgICAg
cV9yZW1vdmUoc3ZjKTsKICAgICAgICAgICAgIHJ1bnFfaW5zZXJ0KG9wcywgc3ZjKTsKQEAgLTE1
MDQsMjYgKzE0OTYsMjYgQEAgc3RhdGljIHZvaWQgcmVwbF90aW1lcl9oYW5kbGVyKHZvaWQgKmRh
dGEpewogICAgIH0KIAogICAgIC8qCi0gICAgICogSXRlcmF0ZSB0aHJvdWdoIHRoZSBsaXN0IG9m
IHVwZGF0ZWQgdmNwdXMuCi0gICAgICogSWYgYW4gdXBkYXRlZCB2Y3B1IGlzIHJ1bm5pbmcsIHRp
Y2tsZSB0aGUgaGVhZCBvZiB0aGUKKyAgICAgKiBJdGVyYXRlIHRocm91Z2ggdGhlIGxpc3Qgb2Yg
dXBkYXRlZCB1bml0cy4KKyAgICAgKiBJZiBhbiB1cGRhdGVkIHVuaXQgaXMgcnVubmluZywgdGlj
a2xlIHRoZSBoZWFkIG9mIHRoZQogICAgICAqIHJ1bnF1ZXVlIGlmIGl0IGhhcyBhIGhpZ2hlciBw
cmlvcml0eS4KLSAgICAgKiBJZiBhbiB1cGRhdGVkIHZjcHUgd2FzIGRlcGxldGVkIGFuZCBvbiB0
aGUgcnVucXVldWUsIHRpY2tsZSBpdC4KLSAgICAgKiBGaW5hbGx5LCByZWluc2VydCB0aGUgdmNw
dXMgYmFjayB0byByZXBsZW5pc2hlbWVudCBldmVudHMgbGlzdC4KKyAgICAgKiBJZiBhbiB1cGRh
dGVkIHVuaXQgd2FzIGRlcGxldGVkIGFuZCBvbiB0aGUgcnVucXVldWUsIHRpY2tsZSBpdC4KKyAg
ICAgKiBGaW5hbGx5LCByZWluc2VydCB0aGUgdW5pdHMgYmFjayB0byByZXBsZW5pc2hlbWVudCBl
dmVudHMgbGlzdC4KICAgICAgKi8KICAgICBsaXN0X2Zvcl9lYWNoX3NhZmUgKCBpdGVyLCB0bXAs
ICZ0bXBfcmVwbHEgKQogICAgIHsKICAgICAgICAgc3ZjID0gcmVwbHFfZWxlbShpdGVyKTsKIAot
ICAgICAgICBpZiAoIGN1cnJfb25fY3B1KHN2Yy0+dmNwdS0+cHJvY2Vzc29yKSA9PSBzdmMtPnZj
cHUtPnNjaGVkX3VuaXQgJiYKKyAgICAgICAgaWYgKCBjdXJyX29uX2NwdShzY2hlZF91bml0X2Nw
dShzdmMtPnVuaXQpKSA9PSBzdmMtPnVuaXQgJiYKICAgICAgICAgICAgICAhbGlzdF9lbXB0eShy
dW5xKSApCiAgICAgICAgIHsKICAgICAgICAgICAgIHN0cnVjdCBydF91bml0ICpuZXh0X29uX3J1
bnEgPSBxX2VsZW0ocnVucS0+bmV4dCk7CiAKLSAgICAgICAgICAgIGlmICggY29tcGFyZV92Y3B1
X3ByaW9yaXR5KHN2YywgbmV4dF9vbl9ydW5xKSA8IDAgKQorICAgICAgICAgICAgaWYgKCBjb21w
YXJlX3VuaXRfcHJpb3JpdHkoc3ZjLCBuZXh0X29uX3J1bnEpIDwgMCApCiAgICAgICAgICAgICAg
ICAgcnVucV90aWNrbGUob3BzLCBuZXh0X29uX3J1bnEpOwogICAgICAgICB9CiAgICAgICAgIGVs
c2UgaWYgKCBfX3Rlc3RfYW5kX2NsZWFyX2JpdChfX1JURFNfZGVwbGV0ZWQsICZzdmMtPmZsYWdz
KSAmJgotICAgICAgICAgICAgICAgICAgdmNwdV9vbl9xKHN2YykgKQorICAgICAgICAgICAgICAg
ICAgdW5pdF9vbl9xKHN2YykgKQogICAgICAgICAgICAgcnVucV90aWNrbGUob3BzLCBzdmMpOwog
CiAgICAgICAgIGxpc3RfZGVsKCZzdmMtPnJlcGxxX2VsZW0pOwpAQCAtMTUzMSw3ICsxNTIzLDcg
QEAgc3RhdGljIHZvaWQgcmVwbF90aW1lcl9oYW5kbGVyKHZvaWQgKmRhdGEpewogICAgIH0KIAog
ICAgIC8qCi0gICAgICogSWYgdGhlcmUgYXJlIHZjcHVzIGxlZnQgaW4gdGhlIHJlcGxlbmlzaG1l
bnQgZXZlbnQgbGlzdCwKKyAgICAgKiBJZiB0aGVyZSBhcmUgdW5pdHMgbGVmdCBpbiB0aGUgcmVw
bGVuaXNobWVudCBldmVudCBsaXN0LAogICAgICAqIHNldCB0aGUgbmV4dCByZXBsZW5pc2htZW50
IHRvIGhhcHBlbiBhdCB0aGUgZGVhZGxpbmUgb2YKICAgICAgKiB0aGUgb25lIGluIHRoZSBmcm9u
dC4KICAgICAgKi8KLS0gCjIuMTYuNAoKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhl
bnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5m
by94ZW4tZGV2ZWw=

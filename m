Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 972B7BB965
	for <lists+xen-devel@lfdr.de>; Mon, 23 Sep 2019 18:17:07 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iCQy4-0000pJ-80; Mon, 23 Sep 2019 16:13:40 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=cYas=XS=citrix.com=paul.durrant@srs-us1.protection.inumbo.net>)
 id 1iCQy3-0000pD-5m
 for xen-devel@lists.xenproject.org; Mon, 23 Sep 2019 16:13:39 +0000
X-Inumbo-ID: 19388f9c-de1d-11e9-9604-12813bfff9fa
Received: from esa4.hc3370-68.iphmx.com (unknown [216.71.155.144])
 by localhost (Halon) with ESMTPS
 id 19388f9c-de1d-11e9-9604-12813bfff9fa;
 Mon, 23 Sep 2019 16:13:37 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1569255217;
 h=from:to:cc:subject:date:message-id:references:
 in-reply-to:content-transfer-encoding:mime-version;
 bh=ZFhMf3Vd4dMsxwwfChS4zvRFpb6SvrJ9sVZi/kHYKIQ=;
 b=h3TnFeC1+caay6i6/jAeWhAERYeNBvDf0FfF9ULQzU3OsOeq6AbFyrJJ
 qRWwJAwNr4qnLRzYH5Uejfjj3zkwp3XbNFIsIUmfa+Up7nJl9XLYl3IvV
 qw6MCC6tBq9retdcq6rV5evbYrC58cZVBqbP1r0g7deBwGuIFf3kumcKa Y=;
Authentication-Results: esa4.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=Paul.Durrant@citrix.com;
 spf=Pass smtp.mailfrom=Paul.Durrant@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa4.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 Paul.Durrant@citrix.com) identity=pra;
 client-ip=162.221.158.21; receiver=esa4.hc3370-68.iphmx.com;
 envelope-from="Paul.Durrant@citrix.com";
 x-sender="Paul.Durrant@citrix.com"; x-conformance=sidf_compatible
Received-SPF: Pass (esa4.hc3370-68.iphmx.com: domain of
 Paul.Durrant@citrix.com designates 162.221.158.21 as
 permitted sender) identity=mailfrom;
 client-ip=162.221.158.21; receiver=esa4.hc3370-68.iphmx.com;
 envelope-from="Paul.Durrant@citrix.com";
 x-sender="Paul.Durrant@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83 ~all"
Received-SPF: None (esa4.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa4.hc3370-68.iphmx.com;
 envelope-from="Paul.Durrant@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: McbIIC/n2KIeUdsviV8j4rJ0prHyyZ89XqRtMY7yEDZpuboVm2mfEs6VQPm+lbHHHsrDtd5+H2
 k2TYQvYBPhp4/1sZBfAWjlFRgYzxkOlRJ81QE2vUi9dC4g00ibjFjUwy/hprKTUrWgbvjBJ79O
 WAf7tbrYimZZto8Sr41B/12rn+qVkQ3F89xVG7gks1g8cDsUkSy77E1Ay5ICccA4G4DYsABho3
 JYyJQV3l9a0NiHtxC+scl3udSiGs11aLid9yXh7ufBxYkLAxHyS2YURUbKIS98508N9fKTyeVN
 OHA=
X-SBRS: 2.7
X-MesageID: 6269482
X-Ironport-Server: esa4.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.64,541,1559534400"; 
   d="scan'208";a="6269482"
From: Paul Durrant <Paul.Durrant@citrix.com>
To: 'Jan Beulich' <jbeulich@suse.com>, "xen-devel@lists.xenproject.org"
 <xen-devel@lists.xenproject.org>
Thread-Topic: [Xen-devel] [PATCH v6 4/8] AMD/IOMMU: replace INTREMAP_ENTRIES
Thread-Index: AQHVbu2eDf9I8bJPeUmriQ88lc/4jqc5dUeQ
Date: Mon, 23 Sep 2019 16:13:33 +0000
Message-ID: <889f182f55bf44b293bd2fd18043dadb@AMSPEX02CL03.citrite.net>
References: <aa62726c-5aa4-8bcd-dc35-61eb8dfeaee3@suse.com>
 <e8359b69-1e7c-6b3d-a7ce-7a7974dd0ac3@suse.com>
In-Reply-To: <e8359b69-1e7c-6b3d-a7ce-7a7974dd0ac3@suse.com>
Accept-Language: en-GB, en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-ms-exchange-transport-fromentityheader: Hosted
MIME-Version: 1.0
Subject: Re: [Xen-devel] [PATCH v6 4/8] AMD/IOMMU: replace INTREMAP_ENTRIES
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <Andrew.Cooper3@citrix.com>,
 Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

PiAtLS0tLU9yaWdpbmFsIE1lc3NhZ2UtLS0tLQ0KPiBGcm9tOiBYZW4tZGV2ZWwgPHhlbi1kZXZl
bC1ib3VuY2VzQGxpc3RzLnhlbnByb2plY3Qub3JnPiBPbiBCZWhhbGYgT2YgSmFuIEJldWxpY2gN
Cj4gU2VudDogMTkgU2VwdGVtYmVyIDIwMTkgMTQ6MjMNCj4gVG86IHhlbi1kZXZlbEBsaXN0cy54
ZW5wcm9qZWN0Lm9yZw0KPiBDYzogQW5kcmV3IENvb3BlciA8QW5kcmV3LkNvb3BlcjNAY2l0cml4
LmNvbT47IFN1cmF2ZWUgU3V0aGlrdWxwYW5pdCA8c3VyYXZlZS5zdXRoaWt1bHBhbml0QGFtZC5j
b20+DQo+IFN1YmplY3Q6IFtYZW4tZGV2ZWxdIFtQQVRDSCB2NiA0LzhdIEFNRC9JT01NVTogcmVw
bGFjZSBJTlRSRU1BUF9FTlRSSUVTDQo+IA0KPiBQcmVwYXJlIGZvciB0aGUgbnVtYmVyIG9mIGVu
dHJpZXMgdG8gbm90IGJlIHRoZSBtYXhpbXVtIHBvc3NpYmxlLCBieQ0KPiBzZXBhcmF0aW5nIGNo
ZWNrcyBhZ2FpbnN0IG1heGltdW0gc2l6ZSBmcm9tIG9uZXMgYWdhaW5zdCBhY3R1YWwgc2l6ZS4N
Cj4gRm9yIGNhbGxlciBzaWRlIHNpbXBsaWNpdHkgaGF2ZSBhbGxvY19pbnRyZW1hcF9lbnRyeSgp
IHJldHVybiB0aGUNCj4gbWF4aW11bSBwb3NzaWJsZSB2YWx1ZSB1cG9uIGFsbG9jYXRpb24gZmFp
bHVyZSwgcmF0aGVyIHRoYW4gdGhlIGZpcnN0DQo+IGp1c3Qgb3V0LW9mLWJvdW5kcyBvbmUuDQo+
IA0KPiBIYXZlIHRoZSBpbnZvbHZlZCBmdW5jdGlvbnMgYWxyZWFkeSB0YWtlIGFsbCB0aGUgc3Vi
c2VxdWVudGx5IG5lZWRlZA0KPiBhcmd1bWVudHMgaGVyZSBhbHJlYWR5LCB0byByZWR1Y2UgY29k
ZSBjaHVybiBpbiB0aGUgcGF0Y2ggYWN0dWFsbHkNCj4gbWFraW5nIHRoZSBhbGxvY2F0aW9uIHNp
emUgZHluYW1pYy4NCj4gDQo+IFNpZ25lZC1vZmYtYnk6IEphbiBCZXVsaWNoIDxqYmV1bGljaEBz
dXNlLmNvbT4NCj4gQWNrZWQtYnk6IEFuZHJldyBDb29wZXIgPGFuZHJldy5jb29wZXIzQGNpdHJp
eC5jb20+DQoNClJldmlld2VkLWJ5OiBQYXVsIER1cnJhbnQgPHBhdWwuZHVycmFudEBjaXRyaXgu
Y29tPg0KDQo+IC0tLQ0KPiB2NTogTmV3Lg0KPiANCj4gLS0tDQo+ICB4ZW4vZHJpdmVycy9wYXNz
dGhyb3VnaC9hbWQvaW9tbXVfaW50ci5jICAgICAgfCAgIDkzICsrKysrKysrKysrKysrKy0tLS0t
LS0tLS0tDQo+ICB4ZW4vaW5jbHVkZS9hc20teDg2L2h2bS9zdm0vYW1kLWlvbW11LXByb3RvLmgg
fCAgICAyDQo+ICAyIGZpbGVzIGNoYW5nZWQsIDU5IGluc2VydGlvbnMoKyksIDM2IGRlbGV0aW9u
cygtKQ0KPiANCj4gLS0tIGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL2lvbW11X2ludHIu
Yw0KPiArKysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfaW50ci5jDQo+IEBA
IC02OSw3ICs2OSw3IEBAIHVuaW9uIGlydGVfY3B0ciB7DQo+ICAgICAgY29uc3QgdW5pb24gaXJ0
ZTEyOCAqcHRyMTI4Ow0KPiAgfSBfX3RyYW5zcGFyZW50X187DQo+IA0KPiAtI2RlZmluZSBJTlRS
RU1BUF9FTlRSSUVTICgxIDw8IElPTU1VX0lOVFJFTUFQX09SREVSKQ0KPiArI2RlZmluZSBJTlRS
RU1BUF9NQVhfRU5UUklFUyAoMSA8PCBJT01NVV9JTlRSRU1BUF9PUkRFUikNCj4gDQo+ICBzdHJ1
Y3QgaW9hcGljX3NiZGYgaW9hcGljX3NiZGZbTUFYX0lPX0FQSUNTXTsNCj4gIHN0cnVjdCBocGV0
X3NiZGYgaHBldF9zYmRmOw0KPiBAQCAtODMsOCArODMsMjAgQEAgc3RhdGljIHZvaWQgZHVtcF9p
bnRyZW1hcF90YWJsZXModW5zaWduZQ0KPiAgc3RhdGljIHVuc2lnbmVkIGludCBfX2luaXQgaW50
cmVtYXBfdGFibGVfb3JkZXIoY29uc3Qgc3RydWN0IGFtZF9pb21tdSAqaW9tbXUpDQo+ICB7DQo+
ICAgICAgcmV0dXJuIGlvbW11LT5jdHJsLmdhX2VuDQo+IC0gICAgICAgICAgID8gZ2V0X29yZGVy
X2Zyb21fYnl0ZXMoSU5UUkVNQVBfRU5UUklFUyAqIHNpemVvZih1bmlvbiBpcnRlMTI4KSkNCj4g
LSAgICAgICAgICAgOiBnZXRfb3JkZXJfZnJvbV9ieXRlcyhJTlRSRU1BUF9FTlRSSUVTICogc2l6
ZW9mKHVuaW9uIGlydGUzMikpOw0KPiArICAgICAgICAgICA/IGdldF9vcmRlcl9mcm9tX2J5dGVz
KElOVFJFTUFQX01BWF9FTlRSSUVTICogc2l6ZW9mKHVuaW9uIGlydGUxMjgpKQ0KPiArICAgICAg
ICAgICA6IGdldF9vcmRlcl9mcm9tX2J5dGVzKElOVFJFTUFQX01BWF9FTlRSSUVTICogc2l6ZW9m
KHVuaW9uIGlydGUzMikpOw0KPiArfQ0KPiArDQo+ICt1bnNpZ25lZCBpbnQgYW1kX2lvbW11X2lu
dHJlbWFwX3RhYmxlX29yZGVyKA0KPiArICAgIGNvbnN0IHZvaWQgKmlydCwgY29uc3Qgc3RydWN0
IGFtZF9pb21tdSAqaW9tbXUpDQo+ICt7DQo+ICsgICAgcmV0dXJuIElPTU1VX0lOVFJFTUFQX09S
REVSOw0KPiArfQ0KPiArDQo+ICtzdGF0aWMgdW5zaWduZWQgaW50IGludHJlbWFwX3RhYmxlX2Vu
dHJpZXMoDQo+ICsgICAgY29uc3Qgdm9pZCAqaXJ0LCBjb25zdCBzdHJ1Y3QgYW1kX2lvbW11ICpp
b21tdSkNCj4gK3sNCj4gKyAgICByZXR1cm4gMXUgPDwgYW1kX2lvbW11X2ludHJlbWFwX3RhYmxl
X29yZGVyKGlydCwgaW9tbXUpOw0KPiAgfQ0KPiANCj4gIHVuc2lnbmVkIGludCBpb2FwaWNfaWRf
dG9faW5kZXgodW5zaWduZWQgaW50IGFwaWNfaWQpDQo+IEBAIC0xMjIsMjAgKzEzNCwyNCBAQCBz
dGF0aWMgaW50IGdldF9pbnRyZW1hcF9yZXF1ZXN0b3JfaWQoaW50DQo+ICAgICAgcmV0dXJuIGdl
dF9pdnJzX21hcHBpbmdzKHNlZylbYmRmXS5kdGVfcmVxdWVzdG9yX2lkOw0KPiAgfQ0KPiANCj4g
LXN0YXRpYyB1bnNpZ25lZCBpbnQgYWxsb2NfaW50cmVtYXBfZW50cnkoaW50IHNlZywgaW50IGJk
ZiwgdW5zaWduZWQgaW50IG5yKQ0KPiArc3RhdGljIHVuc2lnbmVkIGludCBhbGxvY19pbnRyZW1h
cF9lbnRyeShjb25zdCBzdHJ1Y3QgYW1kX2lvbW11ICppb21tdSwNCj4gKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IGJkZiwgdW5zaWduZWQgaW50
IG5yKQ0KPiAgew0KPiAtICAgIHVuc2lnbmVkIGxvbmcgKmludXNlID0gZ2V0X2l2cnNfbWFwcGlu
Z3Moc2VnKVtiZGZdLmludHJlbWFwX2ludXNlOw0KPiAtICAgIHVuc2lnbmVkIGludCBzbG90ID0g
ZmluZF9maXJzdF96ZXJvX2JpdChpbnVzZSwgSU5UUkVNQVBfRU5UUklFUyk7DQo+ICsgICAgY29u
c3Qgc3RydWN0IGl2cnNfbWFwcGluZ3MgKml2cnNfbWFwcGluZ3MgPSBnZXRfaXZyc19tYXBwaW5n
cyhpb21tdS0+c2VnKTsNCj4gKyAgICB1bnNpZ25lZCBsb25nICppbnVzZSA9IGl2cnNfbWFwcGlu
Z3NbYmRmXS5pbnRyZW1hcF9pbnVzZTsNCj4gKyAgICB1bnNpZ25lZCBpbnQgbnJfZW50cyA9DQo+
ICsgICAgICAgIGludHJlbWFwX3RhYmxlX2VudHJpZXMoaXZyc19tYXBwaW5nc1tiZGZdLmludHJl
bWFwX3RhYmxlLCBpb21tdSk7DQo+ICsgICAgdW5zaWduZWQgaW50IHNsb3QgPSBmaW5kX2ZpcnN0
X3plcm9fYml0KGludXNlLCBucl9lbnRzKTsNCj4gDQo+ICAgICAgZm9yICggOyA7ICkNCj4gICAg
ICB7DQo+ICAgICAgICAgIHVuc2lnbmVkIGludCBlbmQ7DQo+IA0KPiAtICAgICAgICBpZiAoIHNs
b3QgPj0gSU5UUkVNQVBfRU5UUklFUyApDQo+ICsgICAgICAgIGlmICggc2xvdCA+PSBucl9lbnRz
ICkNCj4gICAgICAgICAgICAgIGJyZWFrOw0KPiAtICAgICAgICBlbmQgPSBmaW5kX25leHRfYml0
KGludXNlLCBJTlRSRU1BUF9FTlRSSUVTLCBzbG90ICsgMSk7DQo+IC0gICAgICAgIGlmICggZW5k
ID4gSU5UUkVNQVBfRU5UUklFUyApDQo+IC0gICAgICAgICAgICBlbmQgPSBJTlRSRU1BUF9FTlRS
SUVTOw0KPiArICAgICAgICBlbmQgPSBmaW5kX25leHRfYml0KGludXNlLCBucl9lbnRzLCBzbG90
ICsgMSk7DQo+ICsgICAgICAgIGlmICggZW5kID4gbnJfZW50cyApDQo+ICsgICAgICAgICAgICBl
bmQgPSBucl9lbnRzOw0KPiAgICAgICAgICBzbG90ID0gKHNsb3QgKyBuciAtIDEpICYgfihuciAt
IDEpOw0KPiAgICAgICAgICBpZiAoIHNsb3QgKyBuciA8PSBlbmQgKQ0KPiAgICAgICAgICB7DQo+
IEBAIC0xNDQsMTIgKzE2MCwxMiBAQCBzdGF0aWMgdW5zaWduZWQgaW50IGFsbG9jX2ludHJlbWFw
X2VudHJ5DQo+ICAgICAgICAgICAgICBicmVhazsNCj4gICAgICAgICAgfQ0KPiAgICAgICAgICBz
bG90ID0gKGVuZCArIG5yKSAmIH4obnIgLSAxKTsNCj4gLSAgICAgICAgaWYgKCBzbG90ID49IElO
VFJFTUFQX0VOVFJJRVMgKQ0KPiArICAgICAgICBpZiAoIHNsb3QgPj0gbnJfZW50cyApDQo+ICAg
ICAgICAgICAgICBicmVhazsNCj4gLSAgICAgICAgc2xvdCA9IGZpbmRfbmV4dF96ZXJvX2JpdChp
bnVzZSwgSU5UUkVNQVBfRU5UUklFUywgc2xvdCk7DQo+ICsgICAgICAgIHNsb3QgPSBmaW5kX25l
eHRfemVyb19iaXQoaW51c2UsIG5yX2VudHMsIHNsb3QpOw0KPiAgICAgIH0NCj4gDQo+IC0gICAg
cmV0dXJuIHNsb3Q7DQo+ICsgICAgcmV0dXJuIHNsb3QgPCBucl9lbnRzID8gc2xvdCA6IElOVFJF
TUFQX01BWF9FTlRSSUVTOw0KPiAgfQ0KPiANCj4gIHN0YXRpYyB1bmlvbiBpcnRlX3B0ciBnZXRf
aW50cmVtYXBfZW50cnkoY29uc3Qgc3RydWN0IGFtZF9pb21tdSAqaW9tbXUsDQo+IEBAIC0xNTks
NyArMTc1LDcgQEAgc3RhdGljIHVuaW9uIGlydGVfcHRyIGdldF9pbnRyZW1hcF9lbnRyeQ0KPiAg
ICAgICAgICAucHRyID0gZ2V0X2l2cnNfbWFwcGluZ3MoaW9tbXUtPnNlZylbYmRmXS5pbnRyZW1h
cF90YWJsZQ0KPiAgICAgIH07DQo+IA0KPiAtICAgIEFTU0VSVCh0YWJsZS5wdHIgJiYgKGluZGV4
IDwgSU5UUkVNQVBfRU5UUklFUykpOw0KPiArICAgIEFTU0VSVCh0YWJsZS5wdHIgJiYgKGluZGV4
IDwgaW50cmVtYXBfdGFibGVfZW50cmllcyh0YWJsZS5wdHIsIGlvbW11KSkpOw0KPiANCj4gICAg
ICBpZiAoIGlvbW11LT5jdHJsLmdhX2VuICkNCj4gICAgICAgICAgdGFibGUucHRyMTI4ICs9IGlu
ZGV4Ow0KPiBAQCAtMjc5LDEwICsyOTUsMTAgQEAgc3RhdGljIGludCB1cGRhdGVfaW50cmVtYXBf
ZW50cnlfZnJvbV9pbw0KPiAgICAgIHNwaW5fbG9ja19pcnFzYXZlKGxvY2ssIGZsYWdzKTsNCj4g
DQo+ICAgICAgb2Zmc2V0ID0gKmluZGV4Ow0KPiAtICAgIGlmICggb2Zmc2V0ID49IElOVFJFTUFQ
X0VOVFJJRVMgKQ0KPiArICAgIGlmICggb2Zmc2V0ID49IElOVFJFTUFQX01BWF9FTlRSSUVTICkN
Cj4gICAgICB7DQo+IC0gICAgICAgIG9mZnNldCA9IGFsbG9jX2ludHJlbWFwX2VudHJ5KGlvbW11
LT5zZWcsIHJlcV9pZCwgMSk7DQo+IC0gICAgICAgIGlmICggb2Zmc2V0ID49IElOVFJFTUFQX0VO
VFJJRVMgKQ0KPiArICAgICAgICBvZmZzZXQgPSBhbGxvY19pbnRyZW1hcF9lbnRyeShpb21tdSwg
cmVxX2lkLCAxKTsNCj4gKyAgICAgICAgaWYgKCBvZmZzZXQgPj0gSU5UUkVNQVBfTUFYX0VOVFJJ
RVMgKQ0KPiAgICAgICAgICB7DQo+ICAgICAgICAgICAgICBzcGluX3VubG9ja19pcnFyZXN0b3Jl
KGxvY2ssIGZsYWdzKTsNCj4gICAgICAgICAgICAgIHJ0ZS0+bWFzayA9IDE7DQo+IEBAIC00MDAs
OCArNDE2LDggQEAgaW50IF9faW5pdCBhbWRfaW9tbXVfc2V0dXBfaW9hcGljX3JlbWFwcA0KPiAg
ICAgICAgICAgICAgfQ0KPiANCj4gICAgICAgICAgICAgIHNwaW5fbG9ja19pcnFzYXZlKGxvY2ss
IGZsYWdzKTsNCj4gLSAgICAgICAgICAgIG9mZnNldCA9IGFsbG9jX2ludHJlbWFwX2VudHJ5KHNl
ZywgcmVxX2lkLCAxKTsNCj4gLSAgICAgICAgICAgIEJVR19PTihvZmZzZXQgPj0gSU5UUkVNQVBf
RU5UUklFUyk7DQo+ICsgICAgICAgICAgICBvZmZzZXQgPSBhbGxvY19pbnRyZW1hcF9lbnRyeShp
b21tdSwgcmVxX2lkLCAxKTsNCj4gKyAgICAgICAgICAgIEJVR19PTihvZmZzZXQgPj0gSU5UUkVN
QVBfTUFYX0VOVFJJRVMpOw0KPiAgICAgICAgICAgICAgZW50cnkgPSBnZXRfaW50cmVtYXBfZW50
cnkoaW9tbXUsIHJlcV9pZCwgb2Zmc2V0KTsNCj4gICAgICAgICAgICAgIHVwZGF0ZV9pbnRyZW1h
cF9lbnRyeShpb21tdSwgZW50cnksIHZlY3RvciwNCj4gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBkZWxpdmVyeV9tb2RlLCBkZXN0X21vZGUsIGRlc3QpOw0KPiBAQCAtNDc2LDcg
KzQ5Miw3IEBAIHZvaWQgYW1kX2lvbW11X2lvYXBpY191cGRhdGVfaXJlKA0KPiAgICAgICAgICAq
KCgodTMyICopJm5ld19ydGUpICsgMSkgPSB2YWx1ZTsNCj4gICAgICB9DQo+IA0KPiAtICAgIGlm
ICggaW9hcGljX3NiZGZbaWR4XS5waW5fMl9pZHhbcGluXSA+PSBJTlRSRU1BUF9FTlRSSUVTICkN
Cj4gKyAgICBpZiAoIGlvYXBpY19zYmRmW2lkeF0ucGluXzJfaWR4W3Bpbl0gPj0gSU5UUkVNQVBf
TUFYX0VOVFJJRVMgKQ0KPiAgICAgIHsNCj4gICAgICAgICAgQVNTRVJUKHNhdmVkX21hc2spOw0K
PiANCj4gQEAgLTU0OCw3ICs1NjQsNyBAQCB1bnNpZ25lZCBpbnQgYW1kX2lvbW11X3JlYWRfaW9h
cGljX2Zyb21fDQo+ICAgICAgICAgIHJldHVybiB2YWw7DQo+IA0KPiAgICAgIG9mZnNldCA9IGlv
YXBpY19zYmRmW2lkeF0ucGluXzJfaWR4W3Bpbl07DQo+IC0gICAgaWYgKCBvZmZzZXQgPj0gSU5U
UkVNQVBfRU5UUklFUyApDQo+ICsgICAgaWYgKCBvZmZzZXQgPj0gSU5UUkVNQVBfTUFYX0VOVFJJ
RVMgKQ0KPiAgICAgICAgICByZXR1cm4gdmFsOw0KPiANCj4gICAgICBzZWcgPSBpb2FwaWNfc2Jk
ZltpZHhdLnNlZzsNCj4gQEAgLTU2MSw4ICs1NzcsOCBAQCB1bnNpZ25lZCBpbnQgYW1kX2lvbW11
X3JlYWRfaW9hcGljX2Zyb21fDQo+IA0KPiAgICAgIGlmICggIShyZWcgJiAxKSApDQo+ICAgICAg
ew0KPiAtICAgICAgICBBU1NFUlQob2Zmc2V0ID09ICh2YWwgJiAoSU5UUkVNQVBfRU5UUklFUyAt
IDEpKSk7DQo+IC0gICAgICAgIHZhbCAmPSB+KElOVFJFTUFQX0VOVFJJRVMgLSAxKTsNCj4gKyAg
ICAgICAgQVNTRVJUKG9mZnNldCA9PSAodmFsICYgKElOVFJFTUFQX01BWF9FTlRSSUVTIC0gMSkp
KTsNCj4gKyAgICAgICAgdmFsICY9IH4oSU5UUkVNQVBfTUFYX0VOVFJJRVMgLSAxKTsNCj4gICAg
ICAgICAgLyogVGhlIEludFR5cGUgZmllbGRzIG1hdGNoIGZvciBib3RoIGZvcm1hdHMuICovDQo+
ICAgICAgICAgIHZhbCB8PSBNQVNLX0lOU1IoZW50cnkucHRyMzItPmZsZHMuaW50X3R5cGUsDQo+
ICAgICAgICAgICAgICAgICAgICAgICAgICAgSU9fQVBJQ19SRURJUl9ERUxJVl9NT0RFX01BU0sp
Ow0KPiBAQCAtNjIyLDExICs2MzgsMTEgQEAgc3RhdGljIGludCB1cGRhdGVfaW50cmVtYXBfZW50
cnlfZnJvbV9tcw0KPiAgICAgICAgICBkZXN0ID0gTUFTS19FWFRSKG1zZy0+YWRkcmVzc19sbywg
TVNJX0FERFJfREVTVF9JRF9NQVNLKTsNCj4gDQo+ICAgICAgb2Zmc2V0ID0gKnJlbWFwX2luZGV4
Ow0KPiAtICAgIGlmICggb2Zmc2V0ID49IElOVFJFTUFQX0VOVFJJRVMgKQ0KPiArICAgIGlmICgg
b2Zmc2V0ID49IElOVFJFTUFQX01BWF9FTlRSSUVTICkNCj4gICAgICB7DQo+ICAgICAgICAgIEFT
U0VSVChucik7DQo+IC0gICAgICAgIG9mZnNldCA9IGFsbG9jX2ludHJlbWFwX2VudHJ5KGlvbW11
LT5zZWcsIGJkZiwgbnIpOw0KPiAtICAgICAgICBpZiAoIG9mZnNldCA+PSBJTlRSRU1BUF9FTlRS
SUVTICkNCj4gKyAgICAgICAgb2Zmc2V0ID0gYWxsb2NfaW50cmVtYXBfZW50cnkoaW9tbXUsIGJk
ZiwgbnIpOw0KPiArICAgICAgICBpZiAoIG9mZnNldCA+PSBJTlRSRU1BUF9NQVhfRU5UUklFUyAp
DQo+ICAgICAgICAgIHsNCj4gICAgICAgICAgICAgIHNwaW5fdW5sb2NrX2lycXJlc3RvcmUobG9j
aywgZmxhZ3MpOw0KPiAgICAgICAgICAgICAgcmV0dXJuIC1FTk9TUEM7DQo+IEBAIC02NTQsNyAr
NjcwLDcgQEAgc3RhdGljIGludCB1cGRhdGVfaW50cmVtYXBfZW50cnlfZnJvbV9tcw0KPiAgICAg
IHVwZGF0ZV9pbnRyZW1hcF9lbnRyeShpb21tdSwgZW50cnksIHZlY3RvciwgZGVsaXZlcnlfbW9k
ZSwgZGVzdF9tb2RlLCBkZXN0KTsNCj4gICAgICBzcGluX3VubG9ja19pcnFyZXN0b3JlKGxvY2ss
IGZsYWdzKTsNCj4gDQo+IC0gICAgKmRhdGEgPSAobXNnLT5kYXRhICYgfihJTlRSRU1BUF9FTlRS
SUVTIC0gMSkpIHwgb2Zmc2V0Ow0KPiArICAgICpkYXRhID0gKG1zZy0+ZGF0YSAmIH4oSU5UUkVN
QVBfTUFYX0VOVFJJRVMgLSAxKSkgfCBvZmZzZXQ7DQo+IA0KPiAgICAgIC8qDQo+ICAgICAgICog
SW4gc29tZSBzcGVjaWFsIGNhc2VzLCBhIHBjaS1lIGRldmljZShlLmcgU0FUQSBjb250cm9sbGVy
IGluIElERSBtb2RlKQ0KPiBAQCAtNzM4LDcgKzc1NCw3IEBAIGludCBhbWRfaW9tbXVfbXNpX21z
Z191cGRhdGVfaXJlKA0KPiAgdm9pZCBhbWRfaW9tbXVfcmVhZF9tc2lfZnJvbV9pcmUoDQo+ICAg
ICAgc3RydWN0IG1zaV9kZXNjICptc2lfZGVzYywgc3RydWN0IG1zaV9tc2cgKm1zZykNCj4gIHsN
Cj4gLSAgICB1bnNpZ25lZCBpbnQgb2Zmc2V0ID0gbXNnLT5kYXRhICYgKElOVFJFTUFQX0VOVFJJ
RVMgLSAxKTsNCj4gKyAgICB1bnNpZ25lZCBpbnQgb2Zmc2V0ID0gbXNnLT5kYXRhICYgKElOVFJF
TUFQX01BWF9FTlRSSUVTIC0gMSk7DQo+ICAgICAgY29uc3Qgc3RydWN0IHBjaV9kZXYgKnBkZXYg
PSBtc2lfZGVzYy0+ZGV2Ow0KPiAgICAgIHUxNiBiZGYgPSBwZGV2ID8gUENJX0JERjIocGRldi0+
YnVzLCBwZGV2LT5kZXZmbikgOiBocGV0X3NiZGYuYmRmOw0KPiAgICAgIHUxNiBzZWcgPSBwZGV2
ID8gcGRldi0+c2VnIDogaHBldF9zYmRmLnNlZzsNCj4gQEAgLTc1OCw3ICs3NzQsNyBAQCB2b2lk
IGFtZF9pb21tdV9yZWFkX21zaV9mcm9tX2lyZSgNCj4gICAgICAgICAgb2Zmc2V0IHw9IG5yOw0K
PiAgICAgIH0NCj4gDQo+IC0gICAgbXNnLT5kYXRhICY9IH4oSU5UUkVNQVBfRU5UUklFUyAtIDEp
Ow0KPiArICAgIG1zZy0+ZGF0YSAmPSB+KElOVFJFTUFQX01BWF9FTlRSSUVTIC0gMSk7DQo+ICAg
ICAgLyogVGhlIEludFR5cGUgZmllbGRzIG1hdGNoIGZvciBib3RoIGZvcm1hdHMuICovDQo+ICAg
ICAgbXNnLT5kYXRhIHw9IE1BU0tfSU5TUihlbnRyeS5wdHIzMi0+Zmxkcy5pbnRfdHlwZSwNCj4g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1TSV9EQVRBX0RFTElWRVJZX01PREVfTUFTSyk7
DQo+IEBAIC04MjQsOCArODQwLDkgQEAgdm9pZCAqYW1kX2lvbW11X2FsbG9jX2ludHJlbWFwX3Rh
YmxlKA0KPiANCj4gICAgICBpZiAoIHRiICkNCj4gICAgICB7DQo+IC0gICAgICAgICppbnVzZV9t
YXAgPSB4emFsbG9jX2FycmF5KHVuc2lnbmVkIGxvbmcsDQo+IC0gICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIEJJVFNfVE9fTE9OR1MoSU5UUkVNQVBfRU5UUklFUykpOw0KPiArICAg
ICAgICB1bnNpZ25lZCBpbnQgbnIgPSBpbnRyZW1hcF90YWJsZV9lbnRyaWVzKHRiLCBpb21tdSk7
DQo+ICsNCj4gKyAgICAgICAgKmludXNlX21hcCA9IHh6YWxsb2NfYXJyYXkodW5zaWduZWQgbG9u
ZywgQklUU19UT19MT05HUyhucikpOw0KPiAgICAgICAgICBpZiAoICppbnVzZV9tYXAgKQ0KPiAg
ICAgICAgICAgICAgbWVtc2V0KHRiLCAwLCBQQUdFX1NJWkUgPDwgb3JkZXIpOw0KPiAgICAgICAg
ICBlbHNlDQo+IEBAIC04NjksNiArODg2LDcgQEAgYm9vbCBfX2luaXQgaW92X3N1cHBvcnRzX3h0
KHZvaWQpDQo+IA0KPiAgaW50IF9faW5pdCBhbWRfc2V0dXBfaHBldF9tc2koc3RydWN0IG1zaV9k
ZXNjICptc2lfZGVzYykNCj4gIHsNCj4gKyAgICBjb25zdCBzdHJ1Y3QgYW1kX2lvbW11ICppb21t
dTsNCj4gICAgICBzcGlubG9ja190ICpsb2NrOw0KPiAgICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7
DQo+ICAgICAgaW50IHJjID0gMDsNCj4gQEAgLTg4NiwxMiArOTA0LDE1IEBAIGludCBfX2luaXQg
YW1kX3NldHVwX2hwZXRfbXNpKHN0cnVjdCBtc2kNCj4gICAgICAgICAgcmV0dXJuIC1FTk9ERVY7
DQo+ICAgICAgfQ0KPiANCj4gKyAgICBpb21tdSA9IGZpbmRfaW9tbXVfZm9yX2RldmljZShocGV0
X3NiZGYuc2VnLCBocGV0X3NiZGYuYmRmKTsNCj4gKyAgICBpZiAoICFpb21tdSApDQo+ICsgICAg
ICAgIHJldHVybiAtRU5YSU87DQo+ICsNCj4gICAgICBsb2NrID0gZ2V0X2ludHJlbWFwX2xvY2so
aHBldF9zYmRmLnNlZywgaHBldF9zYmRmLmJkZik7DQo+ICAgICAgc3Bpbl9sb2NrX2lycXNhdmUo
bG9jaywgZmxhZ3MpOw0KPiANCj4gLSAgICBtc2lfZGVzYy0+cmVtYXBfaW5kZXggPSBhbGxvY19p
bnRyZW1hcF9lbnRyeShocGV0X3NiZGYuc2VnLA0KPiAtICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGhwZXRfc2JkZi5iZGYsIDEpOw0KPiAtICAgIGlmICgg
bXNpX2Rlc2MtPnJlbWFwX2luZGV4ID49IElOVFJFTUFQX0VOVFJJRVMgKQ0KPiArICAgIG1zaV9k
ZXNjLT5yZW1hcF9pbmRleCA9IGFsbG9jX2ludHJlbWFwX2VudHJ5KGlvbW11LCBocGV0X3NiZGYu
YmRmLCAxKTsNCj4gKyAgICBpZiAoIG1zaV9kZXNjLT5yZW1hcF9pbmRleCA+PSBJTlRSRU1BUF9N
QVhfRU5UUklFUyApDQo+ICAgICAgew0KPiAgICAgICAgICBtc2lfZGVzYy0+cmVtYXBfaW5kZXgg
PSAtMTsNCj4gICAgICAgICAgcmMgPSAtRU5YSU87DQo+IEBAIC05MDYsMTIgKzkyNywxMiBAQCBz
dGF0aWMgdm9pZCBkdW1wX2ludHJlbWFwX3RhYmxlKGNvbnN0IHN0DQo+ICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHVuaW9uIGlydGVfY3B0ciB0YmwsDQo+ICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cnVjdCBpdnJzX21hcHBpbmdzICppdnJzX21hcHBp
bmcpDQo+ICB7DQo+IC0gICAgdW5zaWduZWQgaW50IGNvdW50Ow0KPiArICAgIHVuc2lnbmVkIGlu
dCBjb3VudCwgbnIgPSBpbnRyZW1hcF90YWJsZV9lbnRyaWVzKHRibC5wdHIsIGlvbW11KTsNCj4g
DQo+ICAgICAgaWYgKCAhdGJsLnB0ciApDQo+ICAgICAgICAgIHJldHVybjsNCj4gDQo+IC0gICAg
Zm9yICggY291bnQgPSAwOyBjb3VudCA8IElOVFJFTUFQX0VOVFJJRVM7IGNvdW50KysgKQ0KPiAr
ICAgIGZvciAoIGNvdW50ID0gMDsgY291bnQgPCBucjsgY291bnQrKyApDQo+ICAgICAgew0KPiAg
ICAgICAgICBpZiAoIGlvbW11LT5jdHJsLmdhX2VuDQo+ICAgICAgICAgICAgICAgPyAhdGJsLnB0
cjEyOFtjb3VudF0ucmF3WzBdICYmICF0YmwucHRyMTI4W2NvdW50XS5yYXdbMV0NCj4gLS0tIGEv
eGVuL2luY2x1ZGUvYXNtLXg4Ni9odm0vc3ZtL2FtZC1pb21tdS1wcm90by5oDQo+ICsrKyBiL3hl
bi9pbmNsdWRlL2FzbS14ODYvaHZtL3N2bS9hbWQtaW9tbXUtcHJvdG8uaA0KPiBAQCAtMTAyLDYg
KzEwMiw4IEBAIHZvaWQgKmFtZF9pb21tdV9hbGxvY19pbnRyZW1hcF90YWJsZSgNCj4gICAgICBj
b25zdCBzdHJ1Y3QgYW1kX2lvbW11ICosIHVuc2lnbmVkIGxvbmcgKiopOw0KPiAgaW50IGFtZF9p
b21tdV9mcmVlX2ludHJlbWFwX3RhYmxlKA0KPiAgICAgIGNvbnN0IHN0cnVjdCBhbWRfaW9tbXUg
Kiwgc3RydWN0IGl2cnNfbWFwcGluZ3MgKiwgdWludDE2X3QpOw0KPiArdW5zaWduZWQgaW50IGFt
ZF9pb21tdV9pbnRyZW1hcF90YWJsZV9vcmRlcigNCj4gKyAgICBjb25zdCB2b2lkICppcnQsIGNv
bnN0IHN0cnVjdCBhbWRfaW9tbXUgKmlvbW11KTsNCj4gIHZvaWQgYW1kX2lvbW11X2lvYXBpY191
cGRhdGVfaXJlKA0KPiAgICAgIHVuc2lnbmVkIGludCBhcGljLCB1bnNpZ25lZCBpbnQgcmVnLCB1
bnNpZ25lZCBpbnQgdmFsdWUpOw0KPiAgdW5zaWduZWQgaW50IGFtZF9pb21tdV9yZWFkX2lvYXBp
Y19mcm9tX2lyZSgNCj4gDQo+IA0KPiBfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fXw0KPiBYZW4tZGV2ZWwgbWFpbGluZyBsaXN0DQo+IFhlbi1kZXZlbEBsaXN0
cy54ZW5wcm9qZWN0Lm9yZw0KPiBodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4v
bGlzdGluZm8veGVuLWRldmVsDQpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9q
ZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVu
LWRldmVs

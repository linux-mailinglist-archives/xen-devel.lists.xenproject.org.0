Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id B5498B803D
	for <lists+xen-devel@lfdr.de>; Thu, 19 Sep 2019 19:43:47 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iB0QS-0004Kq-IM; Thu, 19 Sep 2019 17:41:04 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=vwgP=XO=citrix.com=anthony.perard@srs-us1.protection.inumbo.net>)
 id 1iB0QR-0004Jg-5B
 for xen-devel@lists.xenproject.org; Thu, 19 Sep 2019 17:41:03 +0000
X-Inumbo-ID: a032eb1c-db04-11e9-978d-bc764e2007e4
Received: from esa6.hc3370-68.iphmx.com (unknown [216.71.155.175])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id a032eb1c-db04-11e9-978d-bc764e2007e4;
 Thu, 19 Sep 2019 17:40:53 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1568914853;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=Iw2I/B7s31ISX9CNu9mPm0iEg1wk29jTSAZB3WChcrg=;
 b=dcRx/BsENo0h1agXijp3P+S5Qf7jcvrwE9Ige8tUDYKH6KVaIEpr1m0d
 Zrmt3cNqx8uX+z1nCsabYxR4Roak3vi065TfaXNVMccgYRuVZ/fQrwEQu
 57KI0qb7s+h2ZGPHU2xkkJx2IppWuGfciA4sfEMH+NdfgaB1TDzPo8GaT g=;
Authentication-Results: esa6.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=anthony.perard@citrix.com;
 spf=Pass smtp.mailfrom=anthony.perard@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa6.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 anthony.perard@citrix.com) identity=pra;
 client-ip=162.221.158.21; receiver=esa6.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="anthony.perard@citrix.com";
 x-conformance=sidf_compatible
Received-SPF: Pass (esa6.hc3370-68.iphmx.com: domain of
 anthony.perard@citrix.com designates 162.221.158.21 as
 permitted sender) identity=mailfrom;
 client-ip=162.221.158.21; receiver=esa6.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="anthony.perard@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83 ~all"
Received-SPF: None (esa6.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa6.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: pBN10+tdxjkB7w5JiUvBBuN+9OGHvd0MRkAAgcs5M97C6rEZSJvYLeJVBRpgew7DufOASg5v97
 Bio8Fi7/lAHciPFTf9tPX8AJz1VAIv0ENuE55z+FUssTrgq+Fmh6Fw86t/w0anDLnnhPZpOVCU
 ToYCBvuGYmA9UOyTCvtzm6SaJNzl+GPWPyGy9S9YExPkk3HtPQffkv5x8LDCFFbd85y/6WGkcd
 oso0Ru8CcE4mJuIHnBY9olKvOUa7U/sfTI6fWUiHtOpsZkTJa+FYYyx8LX9u7ntHfvTe5PZwnU
 fDc=
X-SBRS: 2.7
X-MesageID: 6064338
X-Ironport-Server: esa6.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.64,524,1559534400"; 
   d="scan'208";a="6064338"
From: Anthony PERARD <anthony.perard@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Thu, 19 Sep 2019 18:16:50 +0100
Message-ID: <20190919171656.899649-31-anthony.perard@citrix.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190919171656.899649-1-anthony.perard@citrix.com>
References: <20190919171656.899649-1-anthony.perard@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v2 30/35] libxl_pci: Use ev_qmp for pci_remove
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Anthony PERARD <anthony.perard@citrix.com>, Ian
 Jackson <ian.jackson@eu.citrix.com>, Wei Liu <wl@xen.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhpcyBwYXRjaCBhbHNvIHJlcGxhY2VzIHRoZSB1c2Ugb2YKbGlieGxfX3dhaXRfZm9yX2Rldmlj
ZV9tb2RlbF9kZXByZWNhdGVkKCkgYnkgaXRzIGVxdWl2YWxlbnQKd2l0aG91dCB0aGUgbmVlZCBm
b3IgYSB0aHJlYWQuCgpTaWduZWQtb2ZmLWJ5OiBBbnRob255IFBFUkFSRCA8YW50aG9ueS5wZXJh
cmRAY2l0cml4LmNvbT4KQWNrZWQtYnk6IElhbiBKYWNrc29uIDxpYW4uamFja3NvbkBldS5jaXRy
aXguY29tPgotLS0KIHRvb2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmggfCAgIDIgLQogdG9vbHMv
bGlieGwvbGlieGxfcGNpLmMgICAgICB8IDIyMiArKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKystLQogdG9vbHMvbGlieGwvbGlieGxfcW1wLmMgICAgICB8ICA3NyAtLS0tLS0tLS0tLS0K
IDMgZmlsZXMgY2hhbmdlZCwgMjEwIGluc2VydGlvbnMoKyksIDkxIGRlbGV0aW9ucygtKQoKZGlm
ZiAtLWdpdCBhL3Rvb2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmggYi90b29scy9saWJ4bC9saWJ4
bF9pbnRlcm5hbC5oCmluZGV4IDc4MmNiZmMwOWFmYi4uMDBlM2NhZDk5NmM0IDEwMDY0NAotLS0g
YS90b29scy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5oCisrKyBiL3Rvb2xzL2xpYnhsL2xpYnhsX2lu
dGVybmFsLmgKQEAgLTE5ODQsOCArMTk4NCw2IEBAIHR5cGVkZWYgc3RydWN0IGxpYnhsX19xbXBf
aGFuZGxlciBsaWJ4bF9fcW1wX2hhbmRsZXI7CiAgKi8KIF9oaWRkZW4gbGlieGxfX3FtcF9oYW5k
bGVyICpsaWJ4bF9fcW1wX2luaXRpYWxpemUobGlieGxfX2djICpnYywKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgZG9taWQpOwotX2hp
ZGRlbiBpbnQgbGlieGxfX3FtcF9wY2lfZGVsKGxpYnhsX19nYyAqZ2MsIGludCBkb21pZCwKLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ4bF9kZXZpY2VfcGNpICpwY2lkZXYpOwog
LyogUmVzdW1lIGh2bSBkb21haW4gKi8KIF9oaWRkZW4gaW50IGxpYnhsX19xbXBfc3lzdGVtX3dh
a2V1cChsaWJ4bF9fZ2MgKmdjLCBpbnQgZG9taWQpOwogLyogUmVzdW1lIFFFTVUuICovCmRpZmYg
LS1naXQgYS90b29scy9saWJ4bC9saWJ4bF9wY2kuYyBiL3Rvb2xzL2xpYnhsL2xpYnhsX3BjaS5j
CmluZGV4IGE1ZjcwMGYwYmY2NC4uMmM0ZTJlNWNmZjVlIDEwMDY0NAotLS0gYS90b29scy9saWJ4
bC9saWJ4bF9wY2kuYworKysgYi90b29scy9saWJ4bC9saWJ4bF9wY2kuYwpAQCAtMTc0MCw2ICsx
NzQwLDEwIEBAIHR5cGVkZWYgc3RydWN0IHBjaV9yZW1vdmVfc3RhdGUgewogICAgIHVuc2lnbmVk
IGludCBwZnVuY19tYXNrOwogICAgIGludCBuZXh0X2Z1bmM7CiAgICAgbGlieGxfX2FvX2Rldmlj
ZSBzdHViZG9tX2FvZGV2OworICAgIGxpYnhsX194c3dhaXRfc3RhdGUgeHN3YWl0OworICAgIGxp
YnhsX19ldl9xbXAgcW1wOworICAgIGxpYnhsX19ldl90aW1lIHRpbWVvdXQ7CisgICAgbGlieGxf
X2V2X3RpbWUgcmV0cnlfdGltZXI7CiB9IHBjaV9yZW1vdmVfc3RhdGU7CiAKIHN0YXRpYyB2b2lk
IGxpYnhsX19kZXZpY2VfcGNpX3JlbW92ZV9jb21tb24obGlieGxfX2VnYyAqZWdjLApAQCAtMTc0
NywxMCArMTc1MSwyMyBAQCBzdGF0aWMgdm9pZCBsaWJ4bF9fZGV2aWNlX3BjaV9yZW1vdmVfY29t
bW9uKGxpYnhsX19lZ2MgKmVnYywKICAgICBsaWJ4bF9fYW9fZGV2aWNlICphb2Rldik7CiBzdGF0
aWMgdm9pZCBkZXZpY2VfcGNpX3JlbW92ZV9jb21tb25fbmV4dChsaWJ4bF9fZWdjICplZ2MsCiAg
ICAgcGNpX3JlbW92ZV9zdGF0ZSAqcHJzLCBpbnQgcmMpOworCitzdGF0aWMgdm9pZCBwY2lfcmVt
b3ZlX3FlbXVfdHJhZF93YXRjaF9zdGF0ZV9jYihsaWJ4bF9fZWdjICplZ2MsCisgICAgbGlieGxf
X3hzd2FpdF9zdGF0ZSAqeHN3YSwgaW50IHJjLCBjb25zdCBjaGFyICpzdGF0ZSk7CitzdGF0aWMg
dm9pZCBwY2lfcmVtb3ZlX3FtcF9kZXZpY2VfZGVsKGxpYnhsX19lZ2MgKmVnYywKKyAgICBwY2lf
cmVtb3ZlX3N0YXRlICpwcnMpOworc3RhdGljIHZvaWQgcGNpX3JlbW92ZV9xbXBfZGV2aWNlX2Rl
bF9jYihsaWJ4bF9fZWdjICplZ2MsCisgICAgbGlieGxfX2V2X3FtcCAqcW1wLCBjb25zdCBsaWJ4
bF9fanNvbl9vYmplY3QgKnJlc3BvbnNlLCBpbnQgcmMpOworc3RhdGljIHZvaWQgcGNpX3JlbW92
ZV9xbXBfcmV0cnlfdGltZXJfY2IobGlieGxfX2VnYyAqZWdjLAorICAgIGxpYnhsX19ldl90aW1l
ICpldiwgY29uc3Qgc3RydWN0IHRpbWV2YWwgKnJlcXVlc3RlZF9hYnMsIGludCByYyk7CitzdGF0
aWMgdm9pZCBwY2lfcmVtb3ZlX3FtcF9xdWVyeV9jYihsaWJ4bF9fZWdjICplZ2MsCisgICAgbGli
eGxfX2V2X3FtcCAqcW1wLCBjb25zdCBsaWJ4bF9fanNvbl9vYmplY3QgKnJlc3BvbnNlLCBpbnQg
cmMpOwogc3RhdGljIHZvaWQgcGNpX3JlbW92ZV9kZXRhdGNoZWQobGlieGxfX2VnYyAqZWdjLAog
ICAgIHBjaV9yZW1vdmVfc3RhdGUgKnBycywgaW50IHJjKTsKIHN0YXRpYyB2b2lkIHBjaV9yZW1v
dmVfc3R1YmRvbV9kb25lKGxpYnhsX19lZ2MgKmVnYywKICAgICBsaWJ4bF9fYW9fZGV2aWNlICph
b2Rldik7CitzdGF0aWMgdm9pZCBwY2lfcmVtb3ZlX3RpbWVvdXQobGlieGxfX2VnYyAqZWdjLAor
ICAgIGxpYnhsX19ldl90aW1lICpldiwgY29uc3Qgc3RydWN0IHRpbWV2YWwgKnJlcXVlc3RlZF9h
YnMsIGludCByYyk7CiBzdGF0aWMgdm9pZCBwY2lfcmVtb3ZlX2RvbmUobGlieGxfX2VnYyAqZWdj
LAogICAgIHBjaV9yZW1vdmVfc3RhdGUgKnBycywgaW50IHJjKTsKIApAQCAtMTc4NCwyMiArMTgw
MSwyMiBAQCBzdGF0aWMgdm9pZCBkb19wY2lfcmVtb3ZlKGxpYnhsX19lZ2MgKmVnYywgdWludDMy
X3QgZG9taWQsCiAgICAgICAgIHBycy0+aHZtID0gdHJ1ZTsKICAgICAgICAgc3dpdGNoIChsaWJ4
bF9fZGV2aWNlX21vZGVsX3ZlcnNpb25fcnVubmluZyhnYywgZG9taWQpKSB7CiAgICAgICAgIGNh
c2UgTElCWExfREVWSUNFX01PREVMX1ZFUlNJT05fUUVNVV9YRU5fVFJBRElUSU9OQUw6Ci0gICAg
ICAgICAgICBpZiAobGlieGxfX3dhaXRfZm9yX2RldmljZV9tb2RlbF9kZXByZWNhdGVkKGdjLCBk
b21pZCwKLSAgICAgICAgICAgICAgICAgICAgInJ1bm5pbmciLCBOVUxMLCBOVUxMLCBOVUxMKSA8
IDApCi0gICAgICAgICAgICAgICAgZ290byBvdXRfZmFpbDsKLSAgICAgICAgICAgIHJjID0gcWVt
dV9wY2lfcmVtb3ZlX3hlbnN0b3JlKGdjLCBkb21pZCwgcGNpZGV2LCBmb3JjZSk7Ci0gICAgICAg
ICAgICBicmVhazsKKyAgICAgICAgICAgIHBycy0+eHN3YWl0LmFvID0gYW87CisgICAgICAgICAg
ICBwcnMtPnhzd2FpdC53aGF0ID0gIkRldmljZSBNb2RlbCI7CisgICAgICAgICAgICBwcnMtPnhz
d2FpdC5wYXRoID0gREVWSUNFX01PREVMX1hTX1BBVEgoZ2MsCisgICAgICAgICAgICAgICAgbGli
eGxfZ2V0X3N0dWJkb21faWQoQ1RYLCBkb21pZCksIGRvbWlkLCAiL3N0YXRlIik7CisgICAgICAg
ICAgICBwcnMtPnhzd2FpdC50aW1lb3V0X21zID0gTElCWExfREVWSUNFX01PREVMX1NUQVJUX1RJ
TUVPVVQgKiAxMDAwOworICAgICAgICAgICAgcHJzLT54c3dhaXQuY2FsbGJhY2sgPSBwY2lfcmVt
b3ZlX3FlbXVfdHJhZF93YXRjaF9zdGF0ZV9jYjsKKyAgICAgICAgICAgIHJjID0gbGlieGxfX3hz
d2FpdF9zdGFydChnYywgJnBycy0+eHN3YWl0KTsKKyAgICAgICAgICAgIGlmIChyYykgZ290byBv
dXRfZmFpbDsKKyAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgY2FzZSBMSUJYTF9ERVZJQ0Vf
TU9ERUxfVkVSU0lPTl9RRU1VX1hFTjoKLSAgICAgICAgICAgIHJjID0gbGlieGxfX3FtcF9wY2lf
ZGVsKGdjLCBkb21pZCwgcGNpZGV2KTsKLSAgICAgICAgICAgIGJyZWFrOworICAgICAgICAgICAg
cGNpX3JlbW92ZV9xbXBfZGV2aWNlX2RlbChlZ2MsIHBycyk7IC8qIG11c3QgYmUgbGFzdCAqLwor
ICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgcmMgPSBF
UlJPUl9JTlZBTDsKICAgICAgICAgICAgIGdvdG8gb3V0X2ZhaWw7CiAgICAgICAgIH0KLSAgICAg
ICAgaWYgKHJjICYmICFmb3JjZSkgewotICAgICAgICAgICAgcmMgPSBFUlJPUl9GQUlMOwotICAg
ICAgICAgICAgZ290byBvdXRfZmFpbDsKLSAgICAgICAgfQogICAgIH0gZWxzZSB7CiAgICAgICAg
IGFzc2VydCh0eXBlID09IExJQlhMX0RPTUFJTl9UWVBFX1BWKTsKIApAQCAtMTg2MSw5ICsxODc4
LDE2MyBAQCBzdGF0aWMgdm9pZCBkb19wY2lfcmVtb3ZlKGxpYnhsX19lZ2MgKmVnYywgdWludDMy
X3QgZG9taWQsCiBza2lwX2lycToKICAgICByYyA9IDA7CiBvdXRfZmFpbDoKKyAgICBwY2lfcmVt
b3ZlX2RldGF0Y2hlZChlZ2MsIHBycywgcmMpOyAvKiBtdXN0IGJlIGxhc3QgKi8KK30KKworc3Rh
dGljIHZvaWQgcGNpX3JlbW92ZV9xZW11X3RyYWRfd2F0Y2hfc3RhdGVfY2IobGlieGxfX2VnYyAq
ZWdjLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGli
eGxfX3hzd2FpdF9zdGF0ZSAqeHN3YSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGludCByYywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGNvbnN0IGNoYXIgKnN0YXRlKQoreworICAgIHBjaV9yZW1vdmVfc3Rh
dGUgKnBycyA9IENPTlRBSU5FUl9PRih4c3dhLCAqcHJzLCB4c3dhaXQpOworICAgIFNUQVRFX0FP
X0dDKHBycy0+YW9kZXYtPmFvKTsKKworICAgIC8qIENvbnZlbmllbmNlIGFsaWFzZXMgKi8KKyAg
ICBsaWJ4bF9kb21pZCBkb21pZCA9IHBycy0+ZG9taWQ7CisgICAgbGlieGxfZGV2aWNlX3BjaSAq
Y29uc3QgcGNpZGV2ID0gcHJzLT5wY2lkZXY7CisKKyAgICBpZiAocmMpIHsKKyAgICAgICAgaWYg
KHJjID09IEVSUk9SX1RJTUVET1VUKSB7CisgICAgICAgICAgICBMT0dEKEVSUk9SLCBkb21pZCwg
IiVzIG5vdCByZWFkeSIsIHhzd2EtPndoYXQpOworICAgICAgICB9CisgICAgICAgIGdvdG8gb3V0
OworICAgIH0KKworICAgIGlmICghc3RhdGUpCisgICAgICAgIHJldHVybjsKKyAgICBpZiAoc3Ry
Y21wKHN0YXRlLCAicnVubmluZyIpKQorICAgICAgICByZXR1cm47CisKKyAgICByYyA9IHFlbXVf
cGNpX3JlbW92ZV94ZW5zdG9yZShnYywgZG9taWQsIHBjaWRldiwgcHJzLT5mb3JjZSk7CisKK291
dDoKKyAgICBsaWJ4bF9feHN3YWl0X3N0b3AoZ2MsIHhzd2EpOwogICAgIHBjaV9yZW1vdmVfZGV0
YXRjaGVkKGVnYywgcHJzLCByYyk7CiB9CiAKK3N0YXRpYyB2b2lkIHBjaV9yZW1vdmVfcW1wX2Rl
dmljZV9kZWwobGlieGxfX2VnYyAqZWdjLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBwY2lfcmVtb3ZlX3N0YXRlICpwcnMpCit7CisgICAgU1RBVEVfQU9fR0MocHJzLT5h
b2Rldi0+YW8pOworICAgIGxpYnhsX19qc29uX29iamVjdCAqYXJncyA9IE5VTEw7CisgICAgaW50
IHJjOworCisgICAgLyogQ29udmVuaWVuY2UgYWxpYXNlcyAqLworICAgIGxpYnhsX2RldmljZV9w
Y2kgKmNvbnN0IHBjaWRldiA9IHBycy0+cGNpZGV2OworCisgICAgcmMgPSBsaWJ4bF9fZXZfdGlt
ZV9yZWdpc3Rlcl9yZWwoYW8sICZwcnMtPnRpbWVvdXQsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgcGNpX3JlbW92ZV90aW1lb3V0LAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIExJQlhMX1FNUF9DTURfVElNRU9VVCAqIDEwMDApOworICAgIGlmIChy
YykgZ290byBvdXQ7CisKKyAgICBRTVBfUEFSQU1FVEVSU19TUFJJTlRGKCZhcmdzLCAiaWQiLCBQ
Q0lfUFRfUURFVl9JRCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgIHBjaWRldi0+YnVzLCBw
Y2lkZXYtPmRldiwgcGNpZGV2LT5mdW5jKTsKKyAgICBwcnMtPnFtcC5jYWxsYmFjayA9IHBjaV9y
ZW1vdmVfcW1wX2RldmljZV9kZWxfY2I7CisgICAgcmMgPSBsaWJ4bF9fZXZfcW1wX3NlbmQoZ2Ms
ICZwcnMtPnFtcCwgImRldmljZV9kZWwiLCBhcmdzKTsKKyAgICBpZiAocmMpIGdvdG8gb3V0Owor
ICAgIHJldHVybjsKKworb3V0OgorICAgIHBjaV9yZW1vdmVfZGV0YXRjaGVkKGVnYywgcHJzLCBy
Yyk7Cit9CisKK3N0YXRpYyB2b2lkIHBjaV9yZW1vdmVfcW1wX2RldmljZV9kZWxfY2IobGlieGxf
X2VnYyAqZWdjLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ4
bF9fZXZfcW1wICpxbXAsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGNvbnN0IGxpYnhsX19qc29uX29iamVjdCAqcmVzcG9uc2UsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGludCByYykKK3sKKyAgICBFR0NfR0M7CisgICAgcGNpX3Jl
bW92ZV9zdGF0ZSAqcHJzID0gQ09OVEFJTkVSX09GKHFtcCwgKnBycywgcW1wKTsKKworICAgIGlm
IChyYykgZ290byBvdXQ7CisKKyAgICAvKiBOb3cgdGhhdCB0aGUgY29tbWFuZCBpcyBzZW50LCB3
ZSB3YW50IHRvIHdhaXQgdW50aWwgUUVNVSBoYXMKKyAgICAgKiBjb25maXJtZWQgdGhhdCB0aGUg
ZGV2aWNlIGlzIHJlbW92ZWQuICovCisgICAgLyogVE9ETzogSW5zdGVhZCBvZiB1c2luZyBhIHBv
bGwgbG9vcCB7IGV2X3RpbWVyIDsgcXVlcnktcGNpIH0sIGl0CisgICAgICogY291bGQgYmUgcG9z
c2libGUgdG8gbGlzdGVuIHRvIGV2ZW50cyBzZW50IGJ5IFFFTVUgdmlhIFFNUCBpbiBvcmRlcgor
ICAgICAqIHRvIHdhaXQgZm9yIHRoZSBwYXNzdGhyb3VnaCBwY2ktZGV2aWNlIHRvIGJlIHJlbW92
ZWQgZnJvbSBRRU1VLiAgKi8KKyAgICBwY2lfcmVtb3ZlX3FtcF9yZXRyeV90aW1lcl9jYihlZ2Ms
ICZwcnMtPnJldHJ5X3RpbWVyLCBOVUxMLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIEVSUk9SX1RJTUVET1VUKTsKKyAgICByZXR1cm47CisKK291dDoKKyAgICBwY2lfcmVtb3Zl
X2RldGF0Y2hlZChlZ2MsIHBycywgcmMpOworfQorCitzdGF0aWMgdm9pZCBwY2lfcmVtb3ZlX3Ft
cF9yZXRyeV90aW1lcl9jYihsaWJ4bF9fZWdjICplZ2MsIGxpYnhsX19ldl90aW1lICpldiwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cnVjdCB0aW1l
dmFsICpyZXF1ZXN0ZWRfYWJzLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgaW50IHJjKQoreworICAgIEVHQ19HQzsKKyAgICBwY2lfcmVtb3ZlX3N0YXRlICpwcnMg
PSBDT05UQUlORVJfT0YoZXYsICpwcnMsIHJldHJ5X3RpbWVyKTsKKworICAgIHBycy0+cW1wLmNh
bGxiYWNrID0gcGNpX3JlbW92ZV9xbXBfcXVlcnlfY2I7CisgICAgcmMgPSBsaWJ4bF9fZXZfcW1w
X3NlbmQoZ2MsICZwcnMtPnFtcCwgInF1ZXJ5LXBjaSIsIE5VTEwpOworICAgIGlmIChyYykgZ290
byBvdXQ7CisgICAgcmV0dXJuOworCitvdXQ6CisgICAgcGNpX3JlbW92ZV9kZXRhdGNoZWQoZWdj
LCBwcnMsIHJjKTsKK30KKworc3RhdGljIHZvaWQgcGNpX3JlbW92ZV9xbXBfcXVlcnlfY2IobGli
eGxfX2VnYyAqZWdjLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlieGxf
X2V2X3FtcCAqcW1wLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qg
bGlieGxfX2pzb25fb2JqZWN0ICpyZXNwb25zZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGludCByYykKK3sKKyAgICBFR0NfR0M7CisgICAgcGNpX3JlbW92ZV9zdGF0ZSAq
cHJzID0gQ09OVEFJTkVSX09GKHFtcCwgKnBycywgcW1wKTsKKyAgICBjb25zdCBsaWJ4bF9fanNv
bl9vYmplY3QgKmJ1cyA9IE5VTEw7CisgICAgY29uc3QgY2hhciAqYXNrZWRfaWQ7CisgICAgaW50
IGksIGo7CisKKyAgICAvKiBDb252ZW5pZW5jZSBhbGlhc2VzICovCisgICAgbGlieGxfX2FvICpj
b25zdCBhbyA9IHBycy0+YW9kZXYtPmFvOworICAgIGxpYnhsX2RldmljZV9wY2kgKmNvbnN0IHBj
aWRldiA9IHBycy0+cGNpZGV2OworCisgICAgaWYgKHJjKSBnb3RvIG91dDsKKworICAgIGFza2Vk
X2lkID0gR0NTUFJJTlRGKFBDSV9QVF9RREVWX0lELAorICAgICAgICAgICAgICAgICAgICAgICAg
IHBjaWRldi0+YnVzLCBwY2lkZXYtPmRldiwgcGNpZGV2LT5mdW5jKTsKKworICAgIC8qIHF1ZXJ5
LXBjaSByZXNwb25zZToKKyAgICAgKiBbeyAnZGV2aWNlcyc6IFsgJ3FkZXZfaWQnOiAnc3RyJywg
Li4uICBdLCAuLi4gfV0KKyAgICAgKiAqLworCisgICAgZm9yIChpID0gMDsgKGJ1cyA9IGxpYnhs
X19qc29uX2FycmF5X2dldChyZXNwb25zZSwgaSkpOyBpKyspIHsKKyAgICAgICAgY29uc3QgbGli
eGxfX2pzb25fb2JqZWN0ICpkZXZpY2VzID0gTlVMTDsKKyAgICAgICAgY29uc3QgbGlieGxfX2pz
b25fb2JqZWN0ICpkZXZpY2UgPSBOVUxMOworICAgICAgICBjb25zdCBsaWJ4bF9fanNvbl9vYmpl
Y3QgKm8gPSBOVUxMOworICAgICAgICBjb25zdCBjaGFyICppZCA9IE5VTEw7CisKKyAgICAgICAg
ZGV2aWNlcyA9IGxpYnhsX19qc29uX21hcF9nZXQoImRldmljZXMiLCBidXMsIEpTT05fQVJSQVkp
OworICAgICAgICBpZiAoIWRldmljZXMpIHsKKyAgICAgICAgICAgIHJjID0gRVJST1JfUUVNVV9B
UEk7CisgICAgICAgICAgICBnb3RvIG91dDsKKyAgICAgICAgfQorCisgICAgICAgIGZvciAoaiA9
IDA7IChkZXZpY2UgPSBsaWJ4bF9fanNvbl9hcnJheV9nZXQoZGV2aWNlcywgaikpOyBqKyspIHsK
KyAgICAgICAgICAgICBvID0gbGlieGxfX2pzb25fbWFwX2dldCgicWRldl9pZCIsIGRldmljZSwg
SlNPTl9TVFJJTkcpOworICAgICAgICAgICAgIGlmICghbykgeworICAgICAgICAgICAgICAgICBy
YyA9IEVSUk9SX1FFTVVfQVBJOworICAgICAgICAgICAgICAgICBnb3RvIG91dDsKKyAgICAgICAg
ICAgICB9CisgICAgICAgICAgICAgaWQgPSBsaWJ4bF9fanNvbl9vYmplY3RfZ2V0X3N0cmluZyhv
KTsKKworICAgICAgICAgICAgIGlmIChpZCAmJiAhc3RyY21wKGFza2VkX2lkLCBpZCkpIHsKKyAg
ICAgICAgICAgICAgICAgLyogRGV2aWNlIHN0aWxsIGluIFFFTVUsIG5lZWQgdG8gd2FpdCBsb25n
dWVyLiAqLworICAgICAgICAgICAgICAgICByYyA9IGxpYnhsX19ldl90aW1lX3JlZ2lzdGVyX3Jl
bChhbywgJnBycy0+cmV0cnlfdGltZXIsCisgICAgICAgICAgICAgICAgICAgICBwY2lfcmVtb3Zl
X3FtcF9yZXRyeV90aW1lcl9jYiwgMTAwMCk7CisgICAgICAgICAgICAgICAgIGlmIChyYykgZ290
byBvdXQ7CisgICAgICAgICAgICAgICAgIHJldHVybjsKKyAgICAgICAgICAgICB9CisgICAgICAg
IH0KKyAgICB9CisKK291dDoKKyAgICBwY2lfcmVtb3ZlX2RldGF0Y2hlZChlZ2MsIHBycywgcmMp
OyAvKiBtdXN0IGJlIGxhc3QgKi8KK30KKwogc3RhdGljIHZvaWQgcGNpX3JlbW92ZV9kZXRhdGNo
ZWQobGlieGxfX2VnYyAqZWdjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGNp
X3JlbW92ZV9zdGF0ZSAqcHJzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50
IHJjKQpAQCAtMTg3Nyw3ICsyMDQ4LDggQEAgc3RhdGljIHZvaWQgcGNpX3JlbW92ZV9kZXRhdGNo
ZWQobGlieGxfX2VnYyAqZWdjLAogICAgIGxpYnhsX2RldmljZV9wY2kgKmNvbnN0IHBjaWRldiA9
IHBycy0+cGNpZGV2OwogICAgIGxpYnhsX2RvbWlkIGRvbWlkID0gcHJzLT5kb21pZDsKIAotICAg
IGlmIChyYykgZ290byBvdXQ7CisgICAgaWYgKHJjICYmICFwcnMtPmZvcmNlKQorICAgICAgICBn
b3RvIG91dDsKIAogICAgIGlzc3R1YmRvbSA9IGxpYnhsX2lzX3N0dWJkb20oQ1RYLCBkb21pZCwg
JmRvbWFpbmlkKTsKIApAQCAtMTkyMyw2ICsyMDk1LDE1IEBAIHN0YXRpYyB2b2lkIHBjaV9yZW1v
dmVfc3R1YmRvbV9kb25lKGxpYnhsX19lZ2MgKmVnYywKICAgICBwY2lfcmVtb3ZlX2RvbmUoZWdj
LCBwcnMsIDApOwogfQogCitzdGF0aWMgdm9pZCBwY2lfcmVtb3ZlX3RpbWVvdXQobGlieGxfX2Vn
YyAqZWdjLCBsaWJ4bF9fZXZfdGltZSAqZXYsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgY29uc3Qgc3RydWN0IHRpbWV2YWwgKnJlcXVlc3RlZF9hYnMsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgaW50IHJjKQoreworICAgIHBjaV9yZW1vdmVfc3RhdGUgKnBycyA9IENP
TlRBSU5FUl9PRihldiwgKnBycywgdGltZW91dCk7CisKKyAgICBwY2lfcmVtb3ZlX2RvbmUoZWdj
LCBwcnMsIHJjKTsKK30KKwogc3RhdGljIHZvaWQgcGNpX3JlbW92ZV9kb25lKGxpYnhsX19lZ2Mg
KmVnYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwY2lfcmVtb3ZlX3N0YXRlICpwcnMs
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IHJjKQpAQCAtMTkzMSw2ICsyMTEyLDEw
IEBAIHN0YXRpYyB2b2lkIHBjaV9yZW1vdmVfZG9uZShsaWJ4bF9fZWdjICplZ2MsCiAKICAgICBp
ZiAocmMpIGdvdG8gb3V0OwogCisgICAgbGlieGxfX2V2X3FtcF9kaXNwb3NlKGdjLCAmcHJzLT5x
bXApOworICAgIGxpYnhsX19ldl90aW1lX2RlcmVnaXN0ZXIoZ2MsICZwcnMtPnRpbWVvdXQpOwor
ICAgIGxpYnhsX19ldl90aW1lX2RlcmVnaXN0ZXIoZ2MsICZwcnMtPnJldHJ5X3RpbWVyKTsKKwog
ICAgIGxpYnhsX19kZXZpY2VfcGNpX3JlbW92ZV94ZW5zdG9yZShnYywgcHJzLT5kb21pZCwgcHJz
LT5wY2lkZXYpOwogb3V0OgogICAgIGRldmljZV9wY2lfcmVtb3ZlX2NvbW1vbl9uZXh0KGVnYywg
cHJzLCByYyk7CkBAIC0xOTUxLDYgKzIxMzYsMTMgQEAgc3RhdGljIHZvaWQgbGlieGxfX2Rldmlj
ZV9wY2lfcmVtb3ZlX2NvbW1vbihsaWJ4bF9fZWdjICplZ2MsCiAgICAgcHJzLT5kb21pZCA9IGRv
bWlkOwogICAgIHBycy0+cGNpZGV2ID0gcGNpZGV2OwogICAgIHBycy0+Zm9yY2UgPSBmb3JjZTsK
KyAgICBsaWJ4bF9feHN3YWl0X2luaXQoJnBycy0+eHN3YWl0KTsKKyAgICBsaWJ4bF9fZXZfcW1w
X2luaXQoJnBycy0+cW1wKTsKKyAgICBwcnMtPnFtcC5hbyA9IHBycy0+YW9kZXYtPmFvOworICAg
IHBycy0+cW1wLmRvbWlkID0gcHJzLT5kb21pZDsKKyAgICBwcnMtPnFtcC5wYXlsb2FkX2ZkID0g
LTE7CisgICAgbGlieGxfX2V2X3RpbWVfaW5pdCgmcHJzLT50aW1lb3V0KTsKKyAgICBsaWJ4bF9f
ZXZfdGltZV9pbml0KCZwcnMtPnJldHJ5X3RpbWVyKTsKIAogICAgIHBycy0+b3JpZ192ZGV2ID0g
cGNpZGV2LT52ZGV2Zm4gJiB+N1U7CiAKQEAgLTE5NzQsNiArMjE2Niw4IEBAIHN0YXRpYyB2b2lk
IGRldmljZV9wY2lfcmVtb3ZlX2NvbW1vbl9uZXh0KGxpYnhsX19lZ2MgKmVnYywKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBjaV9yZW1vdmVfc3RhdGUgKnBycywK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCByYykKIHsKKyAg
ICBFR0NfR0M7CisKICAgICAvKiBDb252ZW5pZW5jZSBhbGlhc2VzICovCiAgICAgbGlieGxfZG9t
aWQgZG9taWQgPSBwcnMtPmRvbWlkOwogICAgIGxpYnhsX2RldmljZV9wY2kgKmNvbnN0IHBjaWRl
diA9IHBycy0+cGNpZGV2OwpAQCAtMjAwMCw2ICsyMTk0LDEwIEBAIHN0YXRpYyB2b2lkIGRldmlj
ZV9wY2lfcmVtb3ZlX2NvbW1vbl9uZXh0KGxpYnhsX19lZ2MgKmVnYywKIAogICAgIHJjID0gMDsK
IG91dDoKKyAgICBsaWJ4bF9fZXZfcW1wX2Rpc3Bvc2UoZ2MsICZwcnMtPnFtcCk7CisgICAgbGli
eGxfX3hzd2FpdF9zdG9wKGdjLCAmcHJzLT54c3dhaXQpOworICAgIGxpYnhsX19ldl90aW1lX2Rl
cmVnaXN0ZXIoZ2MsICZwcnMtPnRpbWVvdXQpOworICAgIGxpYnhsX19ldl90aW1lX2RlcmVnaXN0
ZXIoZ2MsICZwcnMtPnJldHJ5X3RpbWVyKTsKICAgICBhb2Rldi0+cmMgPSByYzsKICAgICBhb2Rl
di0+Y2FsbGJhY2soZWdjLCBhb2Rldik7CiB9CmRpZmYgLS1naXQgYS90b29scy9saWJ4bC9saWJ4
bF9xbXAuYyBiL3Rvb2xzL2xpYnhsL2xpYnhsX3FtcC5jCmluZGV4IDM4YmE2M2Q1YjkyMC4uOGZh
YzczN2ZhZDAzIDEwMDY0NAotLS0gYS90b29scy9saWJ4bC9saWJ4bF9xbXAuYworKysgYi90b29s
cy9saWJ4bC9saWJ4bF9xbXAuYwpAQCAtODcsNyArODcsNiBAQAogCiAjZGVmaW5lIFFNUF9SRUNF
SVZFX0JVRkZFUl9TSVpFIDQwOTYKICNkZWZpbmUgUU1QX01BWF9TSVpFX1JYX0JVRiBNQigxKQot
I2RlZmluZSBQQ0lfUFRfUURFVl9JRCAicGNpLXB0LSUwMnhfJTAyeC4lMDF4IgogCiAvKgogICog
cW1wX2NhbGxiYWNrX3QgaXMgY2FsbCB3aGVuZXZlciBhIG1lc3NhZ2UgZnJvbSBRTVAgY29udGFp
biB0aGUgImlkIgpAQCAtNzM2LDM4ICs3MzUsNiBAQCB2b2lkIGxpYnhsX19xbXBfY2xlYW51cChs
aWJ4bF9fZ2MgKmdjLCB1aW50MzJfdCBkb21pZCkKICAgICB9CiB9CiAKLXN0YXRpYyBpbnQgcGNp
X2RlbF9jYWxsYmFjayhsaWJ4bF9fcW1wX2hhbmRsZXIgKnFtcCwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBjb25zdCBsaWJ4bF9fanNvbl9vYmplY3QgKnJlc3BvbnNlLCB2b2lkICpvcGFx
dWUpCi17Ci0gICAgY29uc3QgY2hhciAqYXNrZWRfaWQgPSBvcGFxdWU7Ci0gICAgY29uc3QgbGli
eGxfX2pzb25fb2JqZWN0ICpidXMgPSBOVUxMOwotICAgIEdDX0lOSVQocW1wLT5jdHgpOwotICAg
IGludCBpLCBqLCByYyA9IDA7Ci0KLSAgICBmb3IgKGkgPSAwOyAoYnVzID0gbGlieGxfX2pzb25f
YXJyYXlfZ2V0KHJlc3BvbnNlLCBpKSk7IGkrKykgewotICAgICAgICBjb25zdCBsaWJ4bF9fanNv
bl9vYmplY3QgKmRldmljZXMgPSBOVUxMOwotICAgICAgICBjb25zdCBsaWJ4bF9fanNvbl9vYmpl
Y3QgKmRldmljZSA9IE5VTEw7Ci0gICAgICAgIGNvbnN0IGxpYnhsX19qc29uX29iamVjdCAqbyA9
IE5VTEw7Ci0gICAgICAgIGNvbnN0IGNoYXIgKmlkID0gTlVMTDsKLQotICAgICAgICBkZXZpY2Vz
ID0gbGlieGxfX2pzb25fbWFwX2dldCgiZGV2aWNlcyIsIGJ1cywgSlNPTl9BUlJBWSk7Ci0KLSAg
ICAgICAgZm9yIChqID0gMDsgKGRldmljZSA9IGxpYnhsX19qc29uX2FycmF5X2dldChkZXZpY2Vz
LCBqKSk7IGorKykgewotICAgICAgICAgICAgIG8gPSBsaWJ4bF9fanNvbl9tYXBfZ2V0KCJxZGV2
X2lkIiwgZGV2aWNlLCBKU09OX1NUUklORyk7Ci0gICAgICAgICAgICAgaWQgPSBsaWJ4bF9fanNv
bl9vYmplY3RfZ2V0X3N0cmluZyhvKTsKLQotICAgICAgICAgICAgIGlmIChpZCAmJiBzdHJjbXAo
YXNrZWRfaWQsIGlkKSA9PSAwKSB7Ci0gICAgICAgICAgICAgICAgIHJjID0gMTsKLSAgICAgICAg
ICAgICAgICAgZ290byBvdXQ7Ci0gICAgICAgICAgICAgfQotICAgICAgICB9Ci0gICAgfQotCi1v
dXQ6Ci0gICAgR0NfRlJFRTsKLSAgICByZXR1cm4gcmM7Ci19Ci0KIHN0YXRpYyBpbnQgcW1wX3J1
bl9jb21tYW5kKGxpYnhsX19nYyAqZ2MsIGludCBkb21pZCwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGNvbnN0IGNoYXIgKmNtZCwgbGlieGxfX2pzb25fb2JqZWN0ICphcmdzLAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgcW1wX2NhbGxiYWNrX3QgY2FsbGJhY2ssIHZvaWQgKm9wYXF1
ZSkKQEAgLTc4NSw1MCArNzUyLDYgQEAgc3RhdGljIGludCBxbXBfcnVuX2NvbW1hbmQobGlieGxf
X2djICpnYywgaW50IGRvbWlkLAogICAgIHJldHVybiByYzsKIH0KIAotc3RhdGljIGludCBxbXBf
ZGV2aWNlX2RlbChsaWJ4bF9fZ2MgKmdjLCBpbnQgZG9taWQsIGNoYXIgKmlkKQotewotICAgIGxp
YnhsX19qc29uX29iamVjdCAqYXJncyA9IE5VTEw7Ci0gICAgbGlieGxfX3FtcF9oYW5kbGVyICpx
bXAgPSBOVUxMOwotICAgIGludCByYyA9IDA7Ci0KLSAgICBxbXAgPSBsaWJ4bF9fcW1wX2luaXRp
YWxpemUoZ2MsIGRvbWlkKTsKLSAgICBpZiAoIXFtcCkKLSAgICAgICAgcmV0dXJuIEVSUk9SX0ZB
SUw7Ci0KLSAgICBsaWJ4bF9fcW1wX3BhcmFtX2FkZF9zdHJpbmcoZ2MsICZhcmdzLCAiaWQiLCBp
ZCk7Ci0gICAgcmMgPSBxbXBfc3luY2hyb25vdXNfc2VuZChxbXAsICJkZXZpY2VfZGVsIiwgYXJn
cywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5VTEwsIE5VTEwsIHFtcC0+dGltZW91
dCk7Ci0gICAgaWYgKHJjID09IDApIHsKLSAgICAgICAgdW5zaWduZWQgaW50IHJldHJ5ID0gMDsK
LQotICAgICAgICBkbyB7Ci0gICAgICAgICAgICByYyA9IHFtcF9zeW5jaHJvbm91c19zZW5kKHFt
cCwgInF1ZXJ5LXBjaSIsIE5VTEwsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHBjaV9kZWxfY2FsbGJhY2ssIGlkLCBxbXAtPnRpbWVvdXQpOwotICAgICAgICAgICAgaWYg
KHJjICE9IDEpIHsKLSAgICAgICAgICAgICAgICBicmVhazsKLSAgICAgICAgICAgIH0KLSAgICAg
ICAgICAgIHNsZWVwKDEpOwotICAgICAgICB9IHdoaWxlIChyZXRyeSsrIDwgNSk7Ci0KLSAgICAg
ICAgaWYgKHJjICE9IDApIHsKLSAgICAgICAgICAgIExPR0QoV0FSTiwgcW1wLT5kb21pZCwKLSAg
ICAgICAgICAgICAgICAgImRldmljZSBtb2RlbCBtYXkgbm90IGNvbXBsZXRlIHJlbW92aW5nIGRl
dmljZSAlcyIsIGlkKTsKLSAgICAgICAgfQotICAgIH0KLQotICAgIGxpYnhsX19xbXBfY2xvc2Uo
cW1wKTsKLSAgICByZXR1cm4gcmM7Ci19Ci0KLWludCBsaWJ4bF9fcW1wX3BjaV9kZWwobGlieGxf
X2djICpnYywgaW50IGRvbWlkLCBsaWJ4bF9kZXZpY2VfcGNpICpwY2lkZXYpCi17Ci0gICAgY2hh
ciAqaWQgPSBOVUxMOwotCi0gICAgaWQgPSBHQ1NQUklOVEYoUENJX1BUX1FERVZfSUQsIHBjaWRl
di0+YnVzLCBwY2lkZXYtPmRldiwgcGNpZGV2LT5mdW5jKTsKLQotICAgIHJldHVybiBxbXBfZGV2
aWNlX2RlbChnYywgZG9taWQsIGlkKTsKLX0KLQogaW50IGxpYnhsX19xbXBfc3lzdGVtX3dha2V1
cChsaWJ4bF9fZ2MgKmdjLCBpbnQgZG9taWQpCiB7CiAgICAgcmV0dXJuIHFtcF9ydW5fY29tbWFu
ZChnYywgZG9taWQsICJzeXN0ZW1fd2FrZXVwIiwgTlVMTCwgTlVMTCwgTlVMTCk7Ci0tIApBbnRo
b255IFBFUkFSRAoKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3Jn
Cmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

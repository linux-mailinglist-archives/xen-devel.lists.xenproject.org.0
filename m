Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 854D0BFFB2
	for <lists+xen-devel@lfdr.de>; Fri, 27 Sep 2019 09:05:24 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iDkGQ-0004BG-E4; Fri, 27 Sep 2019 07:02:02 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=Rbpq=XW=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1iDkGO-00048K-72
 for xen-devel@lists.xenproject.org; Fri, 27 Sep 2019 07:02:00 +0000
X-Inumbo-ID: 919739a3-e0f4-11e9-966c-12813bfff9fa
Received: from mx1.suse.de (unknown [195.135.220.15])
 by localhost (Halon) with ESMTPS
 id 919739a3-e0f4-11e9-966c-12813bfff9fa;
 Fri, 27 Sep 2019 07:01:05 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 23B88B17A;
 Fri, 27 Sep 2019 07:01:02 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Fri, 27 Sep 2019 09:00:30 +0200
Message-Id: <20190927070050.12405-27-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190927070050.12405-1-jgross@suse.com>
References: <20190927070050.12405-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v4 26/46] xen/sched: Change vcpu_migrate_*() to
 operate on schedule unit
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Dario Faggioli <dfaggioli@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

dmNwdV9taWdyYXRlX3N0YXJ0KCkgYW5kIHZjcHVfbWlncmF0ZV9maW5pc2goKSBhcmUgdXNlZCBv
bmx5IHRvIGVuc3VyZQphIHZjcHUgaXMgcnVubmluZyBvbiBhIHN1aXRhYmxlIHByb2Nlc3Nvciwg
c28gdGhleSBjYW4gYmUgc3dpdGNoZWQgdG8Kb3BlcmF0ZSBvbiBzY2hlZHVsZSB1bml0cyBpbnN0
ZWFkIG9mIHZjcHVzLgoKV2hpbGUgZG9pbmcgdGhhdCByZW5hbWUgdGhlbSBhY2NvcmRpbmdseS4K
CkNhbGwgdmNwdV9zeW5jX2V4ZWNzdGF0ZSgpIGZvciBlYWNoIHZjcHUgb2YgdGhlIHVuaXQgd2hl
biBjaGFuZ2luZwpwcm9jZXNzb3JzIGluIG9yZGVyIHRvIG1ha2UgdGhhdCBhbiBleHBsaWNpdCBh
Y3Rpb24gKG90aGVyd2lzZSB0aGlzCndvdWxkIGhhcHBlbiBsYXRlciB3aGVuIGVpdGhlciB0aGUg
dmNwdSBpcyBzY2hlZHVsZWQgb24gdGhlIG5ldwpwcm9jZXNzb3Igb3IgYW5vdGhlciBub24taWRs
ZSB2Y3B1IGlzIHNjaGVkdWxlZCBvbiB0aGUgb2xkIHByb2Nlc3NvcikuCgp2Y3B1X21vdmVfbG9j
a2VkKCkgaXMgc3dpdGNoZWQgdG8gc2NoZWR1bGUgdW5pdCwgdG9vLgoKU2lnbmVkLW9mZi1ieTog
SnVlcmdlbiBHcm9zcyA8amdyb3NzQHN1c2UuY29tPgotLS0KVjM6Ci0gbW92ZSB0ZXN0ZWQgaW52
YXJpYW50IGNvbmRpdGlvbiBvdXQgb2YgbG9vcCAoSmFuIEJldWxpY2gpCi0gYWRkIGNvbW1lbnQg
cmVnYXJkaW5nIGNhbGwgb2YgdmNwdV9zeW5jX2V4ZWNzdGF0ZSgpIChKYW4gQmV1bGljaCkKVjQ6
Ci0gcmVwaHJhc2UgY29tbWVudCAoRGFyaW8gRmFnZ2lvbGkpCi0tLQogeGVuL2NvbW1vbi9zY2hl
ZHVsZS5jIHwgMTA4ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0t
LS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgNjYgaW5zZXJ0aW9ucygrKSwgNDIgZGVsZXRpb25zKC0p
CgpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZHVsZS5jIGIveGVuL2NvbW1vbi9zY2hlZHVs
ZS5jCmluZGV4IDc3MmRlOGRlOTYuLjgzZjViODM3YTkgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24v
c2NoZWR1bGUuYworKysgYi94ZW4vY29tbW9uL3NjaGVkdWxlLmMKQEAgLTc1NCwzNiArNzU0LDQx
IEBAIHZvaWQgdmNwdV91bmJsb2NrKHN0cnVjdCB2Y3B1ICp2KQogfQogCiAvKgotICogRG8gdGhl
IGFjdHVhbCBtb3ZlbWVudCBvZiBhIHZjcHUgZnJvbSBvbGQgdG8gbmV3IENQVS4gTG9ja3MgZm9y
ICpib3RoKgorICogRG8gdGhlIGFjdHVhbCBtb3ZlbWVudCBvZiBhbiB1bml0IGZyb20gb2xkIHRv
IG5ldyBDUFUuIExvY2tzIGZvciAqYm90aCoKICAqIENQVXMgbmVlZHMgdG8gaGF2ZSBiZWVuIHRh
a2VuIGFscmVhZHkgd2hlbiBjYWxsaW5nIHRoaXMhCiAgKi8KLXN0YXRpYyB2b2lkIHZjcHVfbW92
ZV9sb2NrZWQoc3RydWN0IHZjcHUgKnYsIHVuc2lnbmVkIGludCBuZXdfY3B1KQorc3RhdGljIHZv
aWQgc2NoZWRfdW5pdF9tb3ZlX2xvY2tlZChzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IG5ld19jcHUpCiB7Ci0g
ICAgdW5zaWduZWQgaW50IG9sZF9jcHUgPSB2LT5wcm9jZXNzb3I7CisgICAgdW5zaWduZWQgaW50
IG9sZF9jcHUgPSB1bml0LT5yZXMtPm1hc3Rlcl9jcHU7CisgICAgc3RydWN0IHZjcHUgKnY7CiAK
ICAgICAvKgogICAgICAqIFRyYW5zZmVyIHVyZ2VuY3kgc3RhdHVzIHRvIG5ldyBDUFUgYmVmb3Jl
IHN3aXRjaGluZyBDUFVzLCBhcwogICAgICAqIG9uY2UgdGhlIHN3aXRjaCBvY2N1cnMsIHYtPmlz
X3VyZ2VudCBpcyBubyBsb25nZXIgcHJvdGVjdGVkIGJ5CiAgICAgICogdGhlIHBlci1DUFUgc2No
ZWR1bGVyIGxvY2sgd2UgYXJlIGhvbGRpbmcuCiAgICAgICovCi0gICAgaWYgKCB1bmxpa2VseSh2
LT5pc191cmdlbnQpICYmIChvbGRfY3B1ICE9IG5ld19jcHUpICkKKyAgICBmb3JfZWFjaF9zY2hl
ZF91bml0X3ZjcHUgKCB1bml0LCB2ICkKICAgICB7Ci0gICAgICAgIGF0b21pY19pbmMoJnBlcl9j
cHUoc2NoZWRfdXJnZW50X2NvdW50LCBuZXdfY3B1KSk7Ci0gICAgICAgIGF0b21pY19kZWMoJnBl
cl9jcHUoc2NoZWRfdXJnZW50X2NvdW50LCBvbGRfY3B1KSk7CisgICAgICAgIGlmICggdW5saWtl
bHkodi0+aXNfdXJnZW50KSAmJiAob2xkX2NwdSAhPSBuZXdfY3B1KSApCisgICAgICAgIHsKKyAg
ICAgICAgICAgIGF0b21pY19pbmMoJnBlcl9jcHUoc2NoZWRfdXJnZW50X2NvdW50LCBuZXdfY3B1
KSk7CisgICAgICAgICAgICBhdG9taWNfZGVjKCZwZXJfY3B1KHNjaGVkX3VyZ2VudF9jb3VudCwg
b2xkX2NwdSkpOworICAgICAgICB9CiAgICAgfQogCiAgICAgLyoKICAgICAgKiBBY3R1YWwgQ1BV
IHN3aXRjaCB0byBuZXcgQ1BVLiAgVGhpcyBpcyBzYWZlIGJlY2F1c2UgdGhlIGxvY2sKICAgICAg
KiBwb2ludGVyIGNhbid0IGNoYW5nZSB3aGlsZSB0aGUgY3VycmVudCBsb2NrIGlzIGhlbGQuCiAg
ICAgICovCi0gICAgc2NoZWRfbWlncmF0ZSh2Y3B1X3NjaGVkdWxlcih2KSwgdi0+c2NoZWRfdW5p
dCwgbmV3X2NwdSk7CisgICAgc2NoZWRfbWlncmF0ZSh1bml0X3NjaGVkdWxlcih1bml0KSwgdW5p
dCwgbmV3X2NwdSk7CiB9CiAKIC8qCiAgKiBJbml0aWF0aW5nIG1pZ3JhdGlvbgogICoKLSAqIElu
IG9yZGVyIHRvIG1pZ3JhdGUsIHdlIG5lZWQgdGhlIHZjcHUgaW4gcXVlc3Rpb24gdG8gaGF2ZSBz
dG9wcGVkCi0gKiBydW5uaW5nIGFuZCBoYWQgc2NoZWRfc2xlZXAoKSBjYWxsZWQgKHRvIHRha2Ug
aXQgb2ZmIGFueQorICogSW4gb3JkZXIgdG8gbWlncmF0ZSwgd2UgbmVlZCB0aGUgdW5pdCBpbiBx
dWVzdGlvbiB0byBoYXZlIHN0b3BwZWQKKyAqIHJ1bm5pbmcgYW5kIGhhdmUgY2FsbGVkIHNjaGVk
X3NsZWVwKCkgKHRvIHRha2UgaXQgb2ZmIGFueQogICogcnVucXVldWVzLCBmb3IgaW5zdGFuY2Up
OyBhbmQgaWYgaXQgaXMgY3VycmVudGx5IHJ1bm5pbmcsIGl0IG5lZWRzCiAgKiB0byBiZSBzY2hl
ZHVsZWQgb3V0LiAgRmluYWxseSwgd2UgbmVlZCB0byBob2xkIHRoZSBzY2hlZHVsaW5nIGxvY2tz
CiAgKiBmb3IgYm90aCB0aGUgcHJvY2Vzc29yIHdlJ3JlIG1pZ3JhdGluZyBmcm9tLCBhbmQgdGhl
IHByb2Nlc3NvcgpAQCAtNzk4LDM3ICs4MDMsNDUgQEAgc3RhdGljIHZvaWQgdmNwdV9tb3ZlX2xv
Y2tlZChzdHJ1Y3QgdmNwdSAqdiwgdW5zaWduZWQgaW50IG5ld19jcHUpCiAgKiBzaG91bGQgYmUg
Y2FsbGVkIGxpa2UgdGhpczoKICAqCiAgKiAgICAgbG9jayA9IHVuaXRfc2NoZWR1bGVfbG9ja19p
cnEodW5pdCk7Ci0gKiAgICAgdmNwdV9taWdyYXRlX3N0YXJ0KHYpOworICogICAgIHNjaGVkX3Vu
aXRfbWlncmF0ZV9zdGFydCh1bml0KTsKICAqICAgICB1bml0X3NjaGVkdWxlX3VubG9ja19pcnEo
bG9jaywgdW5pdCkKLSAqICAgICB2Y3B1X21pZ3JhdGVfZmluaXNoKHYpOworICogICAgIHNjaGVk
X3VuaXRfbWlncmF0ZV9maW5pc2godW5pdCk7CiAgKgotICogdmNwdV9taWdyYXRlX2ZpbmlzaCgp
IHdpbGwgZG8gdGhlIHdvcmsgbm93IGlmIGl0IGNhbiwgb3Igc2ltcGx5Ci0gKiByZXR1cm4gaWYg
aXQgY2FuJ3QgKGJlY2F1c2UgdiBpcyBzdGlsbCBydW5uaW5nKTsgaW4gdGhhdCBjYXNlCi0gKiB2
Y3B1X21pZ3JhdGVfZmluaXNoKCkgd2lsbCBiZSBjYWxsZWQgYnkgY29udGV4dF9zYXZlZCgpLgor
ICogc2NoZWRfdW5pdF9taWdyYXRlX2ZpbmlzaCgpIHdpbGwgZG8gdGhlIHdvcmsgbm93IGlmIGl0
IGNhbiwgb3Igc2ltcGx5CisgKiByZXR1cm4gaWYgaXQgY2FuJ3QgKGJlY2F1c2UgdW5pdCBpcyBz
dGlsbCBydW5uaW5nKTsgaW4gdGhhdCBjYXNlCisgKiBzY2hlZF91bml0X21pZ3JhdGVfZmluaXNo
KCkgd2lsbCBiZSBjYWxsZWQgYnkgY29udGV4dF9zYXZlZCgpLgogICovCi1zdGF0aWMgdm9pZCB2
Y3B1X21pZ3JhdGVfc3RhcnQoc3RydWN0IHZjcHUgKnYpCitzdGF0aWMgdm9pZCBzY2hlZF91bml0
X21pZ3JhdGVfc3RhcnQoc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiB7Ci0gICAgc2V0X2JpdChf
VlBGX21pZ3JhdGluZywgJnYtPnBhdXNlX2ZsYWdzKTsKLSAgICB2Y3B1X3NsZWVwX25vc3luY19s
b2NrZWQodik7CisgICAgc3RydWN0IHZjcHUgKnY7CisKKyAgICBmb3JfZWFjaF9zY2hlZF91bml0
X3ZjcHUgKCB1bml0LCB2ICkKKyAgICB7CisgICAgICAgIHNldF9iaXQoX1ZQRl9taWdyYXRpbmcs
ICZ2LT5wYXVzZV9mbGFncyk7CisgICAgICAgIHZjcHVfc2xlZXBfbm9zeW5jX2xvY2tlZCh2KTsK
KyAgICB9CiB9CiAKLXN0YXRpYyB2b2lkIHZjcHVfbWlncmF0ZV9maW5pc2goc3RydWN0IHZjcHUg
KnYpCitzdGF0aWMgdm9pZCBzY2hlZF91bml0X21pZ3JhdGVfZmluaXNoKHN0cnVjdCBzY2hlZF91
bml0ICp1bml0KQogewogICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAgICAgdW5zaWduZWQgaW50
IG9sZF9jcHUsIG5ld19jcHU7CiAgICAgc3BpbmxvY2tfdCAqb2xkX2xvY2ssICpuZXdfbG9jazsK
ICAgICBib29sX3QgcGlja19jYWxsZWQgPSAwOworICAgIHN0cnVjdCB2Y3B1ICp2OwogCiAgICAg
LyoKLSAgICAgKiBJZiB0aGUgdmNwdSBpcyBjdXJyZW50bHkgcnVubmluZywgdGhpcyB3aWxsIGJl
IGhhbmRsZWQgYnkKKyAgICAgKiBJZiB0aGUgdW5pdCBpcyBjdXJyZW50bHkgcnVubmluZywgdGhp
cyB3aWxsIGJlIGhhbmRsZWQgYnkKICAgICAgKiBjb250ZXh0X3NhdmVkKCk7IGFuZCBpbiBhbnkg
Y2FzZSwgaWYgdGhlIGJpdCBpcyBjbGVhcmVkLCB0aGVuCiAgICAgICogc29tZW9uZSBlbHNlIGhh
cyBhbHJlYWR5IGRvbmUgdGhlIHdvcmsgc28gd2UgZG9uJ3QgbmVlZCB0by4KICAgICAgKi8KLSAg
ICBpZiAoIHYtPnNjaGVkX3VuaXQtPmlzX3J1bm5pbmcgfHwKLSAgICAgICAgICF0ZXN0X2JpdChf
VlBGX21pZ3JhdGluZywgJnYtPnBhdXNlX2ZsYWdzKSApCisgICAgaWYgKCB1bml0LT5pc19ydW5u
aW5nICkKICAgICAgICAgcmV0dXJuOworICAgIGZvcl9lYWNoX3NjaGVkX3VuaXRfdmNwdSAoIHVu
aXQsIHYgKQorICAgICAgICBpZiAoICF0ZXN0X2JpdChfVlBGX21pZ3JhdGluZywgJnYtPnBhdXNl
X2ZsYWdzKSApCisgICAgICAgICAgICByZXR1cm47CiAKLSAgICBvbGRfY3B1ID0gbmV3X2NwdSA9
IHYtPnByb2Nlc3NvcjsKKyAgICBvbGRfY3B1ID0gbmV3X2NwdSA9IHVuaXQtPnJlcy0+bWFzdGVy
X2NwdTsKICAgICBmb3IgKCA7IDsgKQogICAgIHsKICAgICAgICAgLyoKQEAgLTg0MSw3ICs4NTQs
NyBAQCBzdGF0aWMgdm9pZCB2Y3B1X21pZ3JhdGVfZmluaXNoKHN0cnVjdCB2Y3B1ICp2KQogCiAg
ICAgICAgIHNjaGVkX3NwaW5fbG9ja19kb3VibGUob2xkX2xvY2ssIG5ld19sb2NrLCAmZmxhZ3Mp
OwogCi0gICAgICAgIG9sZF9jcHUgPSB2LT5wcm9jZXNzb3I7CisgICAgICAgIG9sZF9jcHUgPSB1
bml0LT5yZXMtPm1hc3Rlcl9jcHU7CiAgICAgICAgIGlmICggb2xkX2xvY2sgPT0gZ2V0X3NjaGVk
X3JlcyhvbGRfY3B1KS0+c2NoZWR1bGVfbG9jayApCiAgICAgICAgIHsKICAgICAgICAgICAgIC8q
CkBAIC04NTAsMTUgKzg2MywxNSBAQCBzdGF0aWMgdm9pZCB2Y3B1X21pZ3JhdGVfZmluaXNoKHN0
cnVjdCB2Y3B1ICp2KQogICAgICAgICAgICAgICovCiAgICAgICAgICAgICBpZiAoIHBpY2tfY2Fs
bGVkICYmCiAgICAgICAgICAgICAgICAgIChuZXdfbG9jayA9PSBnZXRfc2NoZWRfcmVzKG5ld19j
cHUpLT5zY2hlZHVsZV9sb2NrKSAmJgotICAgICAgICAgICAgICAgICBjcHVtYXNrX3Rlc3RfY3B1
KG5ld19jcHUsIHYtPnNjaGVkX3VuaXQtPmNwdV9oYXJkX2FmZmluaXR5KSAmJgotICAgICAgICAg
ICAgICAgICBjcHVtYXNrX3Rlc3RfY3B1KG5ld19jcHUsIHYtPmRvbWFpbi0+Y3B1cG9vbC0+Y3B1
X3ZhbGlkKSApCisgICAgICAgICAgICAgICAgIGNwdW1hc2tfdGVzdF9jcHUobmV3X2NwdSwgdW5p
dC0+Y3B1X2hhcmRfYWZmaW5pdHkpICYmCisgICAgICAgICAgICAgICAgIGNwdW1hc2tfdGVzdF9j
cHUobmV3X2NwdSwgdW5pdC0+ZG9tYWluLT5jcHVwb29sLT5jcHVfdmFsaWQpICkKICAgICAgICAg
ICAgICAgICBicmVhazsKIAogICAgICAgICAgICAgLyogU2VsZWN0IGEgbmV3IENQVS4gKi8KLSAg
ICAgICAgICAgIG5ld19jcHUgPSBzY2hlZF9waWNrX3Jlc291cmNlKHZjcHVfc2NoZWR1bGVyKHYp
LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi0+c2NoZWRfdW5p
dCktPm1hc3Rlcl9jcHU7CisgICAgICAgICAgICBuZXdfY3B1ID0gc2NoZWRfcGlja19yZXNvdXJj
ZSh1bml0X3NjaGVkdWxlcih1bml0KSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHVuaXQpLT5tYXN0ZXJfY3B1OwogICAgICAgICAgICAgaWYgKCAobmV3X2xvY2sg
PT0gZ2V0X3NjaGVkX3JlcyhuZXdfY3B1KS0+c2NoZWR1bGVfbG9jaykgJiYKLSAgICAgICAgICAg
ICAgICAgY3B1bWFza190ZXN0X2NwdShuZXdfY3B1LCB2LT5kb21haW4tPmNwdXBvb2wtPmNwdV92
YWxpZCkgKQorICAgICAgICAgICAgICAgICBjcHVtYXNrX3Rlc3RfY3B1KG5ld19jcHUsIHVuaXQt
PmRvbWFpbi0+Y3B1cG9vbC0+Y3B1X3ZhbGlkKSApCiAgICAgICAgICAgICAgICAgYnJlYWs7CiAg
ICAgICAgICAgICBwaWNrX2NhbGxlZCA9IDE7CiAgICAgICAgIH0KQEAgLTg3OSwyMiArODkyLDM1
IEBAIHN0YXRpYyB2b2lkIHZjcHVfbWlncmF0ZV9maW5pc2goc3RydWN0IHZjcHUgKnYpCiAgICAg
ICogYmVjYXVzZSB0aGV5IGJvdGggaGFwcGVuIGluIChkaWZmZXJlbnQpIHNwaW5sb2NrIHJlZ2lv
bnMsIGFuZCB0aG9zZQogICAgICAqIHJlZ2lvbnMgYXJlIHN0cmljdGx5IHNlcmlhbGlzZWQuCiAg
ICAgICovCi0gICAgaWYgKCB2LT5zY2hlZF91bml0LT5pc19ydW5uaW5nIHx8Ci0gICAgICAgICAh
dGVzdF9hbmRfY2xlYXJfYml0KF9WUEZfbWlncmF0aW5nLCAmdi0+cGF1c2VfZmxhZ3MpICkKKyAg
ICBpZiAoIHVuaXQtPmlzX3J1bm5pbmcgKQogICAgIHsKICAgICAgICAgc2NoZWRfc3Bpbl91bmxv
Y2tfZG91YmxlKG9sZF9sb2NrLCBuZXdfbG9jaywgZmxhZ3MpOwogICAgICAgICByZXR1cm47CiAg
ICAgfQorICAgIGZvcl9lYWNoX3NjaGVkX3VuaXRfdmNwdSAoIHVuaXQsIHYgKQorICAgIHsKKyAg
ICAgICAgaWYgKCAhdGVzdF9hbmRfY2xlYXJfYml0KF9WUEZfbWlncmF0aW5nLCAmdi0+cGF1c2Vf
ZmxhZ3MpICkKKyAgICAgICAgeworICAgICAgICAgICAgc2NoZWRfc3Bpbl91bmxvY2tfZG91Ymxl
KG9sZF9sb2NrLCBuZXdfbG9jaywgZmxhZ3MpOworICAgICAgICAgICAgcmV0dXJuOworICAgICAg
ICB9CisgICAgfQogCi0gICAgdmNwdV9tb3ZlX2xvY2tlZCh2LCBuZXdfY3B1KTsKKyAgICBzY2hl
ZF91bml0X21vdmVfbG9ja2VkKHVuaXQsIG5ld19jcHUpOwogCiAgICAgc2NoZWRfc3Bpbl91bmxv
Y2tfZG91YmxlKG9sZF9sb2NrLCBuZXdfbG9jaywgZmxhZ3MpOwogCiAgICAgaWYgKCBvbGRfY3B1
ICE9IG5ld19jcHUgKQotICAgICAgICBzY2hlZF9tb3ZlX2lycXModi0+c2NoZWRfdW5pdCk7Cisg
ICAgeworICAgICAgICAvKiBWY3B1cyBhcmUgbW92ZWQgdG8gb3RoZXIgcGNwdXMsIGNvbW1pdCB0
aGVpciBzdGF0ZXMgdG8gbWVtb3J5LiAqLworICAgICAgICBmb3JfZWFjaF9zY2hlZF91bml0X3Zj
cHUgKCB1bml0LCB2ICkKKyAgICAgICAgICAgIHN5bmNfdmNwdV9leGVjc3RhdGUodik7CisgICAg
ICAgIHNjaGVkX21vdmVfaXJxcyh1bml0KTsKKyAgICB9CiAKICAgICAvKiBXYWtlIG9uIG5ldyBD
UFUuICovCi0gICAgdmNwdV93YWtlKHYpOworICAgIGZvcl9lYWNoX3NjaGVkX3VuaXRfdmNwdSAo
IHVuaXQsIHYgKQorICAgICAgICB2Y3B1X3dha2Uodik7CiB9CiAKIHN0YXRpYyBib29sIHNjaGVk
X2NoZWNrX2FmZmluaXR5X2Jyb2tlbihjb25zdCBzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkKQEAg
LTEwNDAsMTEgKzEwNjYsOSBAQCBpbnQgY3B1X2Rpc2FibGVfc2NoZWR1bGVyKHVuc2lnbmVkIGlu
dCBjcHUpCiAgICAgICAgICAgICAgKiAgKiB0aGUgc2NoZWR1bGVyIHdpbGwgYWx3YXlzIGZpbmQg
YSBzdWl0YWJsZSBzb2x1dGlvbiwgb3IKICAgICAgICAgICAgICAqICAgIHRoaW5ncyB3b3VsZCBo
YXZlIGZhaWxlZCBiZWZvcmUgZ2V0dGluZyBpbiBoZXJlLgogICAgICAgICAgICAgICovCi0gICAg
ICAgICAgICAvKiBUT0RPOiBtdWx0aXBsZSB2Y3B1cyBwZXIgdW5pdC4gKi8KLSAgICAgICAgICAg
IHZjcHVfbWlncmF0ZV9zdGFydCh1bml0LT52Y3B1X2xpc3QpOworICAgICAgICAgICAgc2NoZWRf
dW5pdF9taWdyYXRlX3N0YXJ0KHVuaXQpOwogICAgICAgICAgICAgdW5pdF9zY2hlZHVsZV91bmxv
Y2tfaXJxcmVzdG9yZShsb2NrLCBmbGFncywgdW5pdCk7Ci0KLSAgICAgICAgICAgIHZjcHVfbWln
cmF0ZV9maW5pc2godW5pdC0+dmNwdV9saXN0KTsKKyAgICAgICAgICAgIHNjaGVkX3VuaXRfbWln
cmF0ZV9maW5pc2godW5pdCk7CiAKICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgKiBUaGUg
b25seSBjYXZlYXQsIGluIHRoaXMgY2FzZSwgaXMgdGhhdCBpZiBhIHZjcHUgYWN0aXZlIGluCkBA
IC0xMTI2LDE0ICsxMTUwLDE0IEBAIHN0YXRpYyBpbnQgdmNwdV9zZXRfYWZmaW5pdHkoCiAgICAg
ICAgICAgICBBU1NFUlQod2hpY2ggPT0gdW5pdC0+Y3B1X3NvZnRfYWZmaW5pdHkpOwogICAgICAg
ICAgICAgc2NoZWRfc2V0X2FmZmluaXR5KHVuaXQsIE5VTEwsIGFmZmluaXR5KTsKICAgICAgICAg
fQotICAgICAgICB2Y3B1X21pZ3JhdGVfc3RhcnQodik7CisgICAgICAgIHNjaGVkX3VuaXRfbWln
cmF0ZV9zdGFydCh1bml0KTsKICAgICB9CiAKICAgICB1bml0X3NjaGVkdWxlX3VubG9ja19pcnEo
bG9jaywgdW5pdCk7CiAKICAgICBkb21haW5fdXBkYXRlX25vZGVfYWZmaW5pdHkodi0+ZG9tYWlu
KTsKIAotICAgIHZjcHVfbWlncmF0ZV9maW5pc2godik7CisgICAgc2NoZWRfdW5pdF9taWdyYXRl
X2ZpbmlzaCh1bml0KTsKIAogICAgIHJldHVybiByZXQ7CiB9CkBAIC0xMzk0LDEyICsxNDE4LDEy
IEBAIGludCB2Y3B1X3RlbXBvcmFyeV9hZmZpbml0eShzdHJ1Y3QgdmNwdSAqdiwgdW5zaWduZWQg
aW50IGNwdSwgdWludDhfdCByZWFzb24pCiAKICAgICBtaWdyYXRlID0gIXJldCAmJiAhY3B1bWFz
a190ZXN0X2NwdSh2LT5wcm9jZXNzb3IsIHVuaXQtPmNwdV9oYXJkX2FmZmluaXR5KTsKICAgICBp
ZiAoIG1pZ3JhdGUgKQotICAgICAgICB2Y3B1X21pZ3JhdGVfc3RhcnQodik7CisgICAgICAgIHNj
aGVkX3VuaXRfbWlncmF0ZV9zdGFydCh1bml0KTsKIAogICAgIHVuaXRfc2NoZWR1bGVfdW5sb2Nr
X2lycShsb2NrLCB1bml0KTsKIAogICAgIGlmICggbWlncmF0ZSApCi0gICAgICAgIHZjcHVfbWln
cmF0ZV9maW5pc2godik7CisgICAgICAgIHNjaGVkX3VuaXRfbWlncmF0ZV9maW5pc2godW5pdCk7
CiAKICAgICByZXR1cm4gcmV0OwogfQpAQCAtMTgxNiw3ICsxODQwLDcgQEAgdm9pZCBjb250ZXh0
X3NhdmVkKHN0cnVjdCB2Y3B1ICpwcmV2KQogCiAgICAgc2NoZWRfY29udGV4dF9zYXZlZCh2Y3B1
X3NjaGVkdWxlcihwcmV2KSwgcHJldi0+c2NoZWRfdW5pdCk7CiAKLSAgICB2Y3B1X21pZ3JhdGVf
ZmluaXNoKHByZXYpOworICAgIHNjaGVkX3VuaXRfbWlncmF0ZV9maW5pc2gocHJldi0+c2NoZWRf
dW5pdCk7CiB9CiAKIC8qIFRoZSBzY2hlZHVsZXIgdGltZXI6IGZvcmNlIGEgcnVuIHRocm91Z2gg
dGhlIHNjaGVkdWxlciAqLwotLSAKMi4xNi40CgoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlz
dHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xp
c3RpbmZvL3hlbi1kZXZlbA==

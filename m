Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 80B7F18BB21
	for <lists+xen-devel@lfdr.de>; Thu, 19 Mar 2020 16:29:43 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1jEx4Y-0003Xl-K4; Thu, 19 Mar 2020 15:27:02 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=kuhB=5E=citrix.com=andrew.cooper3@srs-us1.protection.inumbo.net>)
 id 1jEx4X-0003XG-2H
 for xen-devel@lists.xenproject.org; Thu, 19 Mar 2020 15:27:01 +0000
X-Inumbo-ID: 13628a9a-69f6-11ea-a6c1-bc764e2007e4
Received: from esa6.hc3370-68.iphmx.com (unknown [216.71.155.175])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 13628a9a-69f6-11ea-a6c1-bc764e2007e4;
 Thu, 19 Mar 2020 15:27:00 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1584631620;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=t+0wL690QLRI2X2xlJ9FWS9trSb3uXbLf7OPjapmSoI=;
 b=TwLs7+qy9PZwzy73foId84CP39XcvGQ0Eiz228me5ZVlT88mvUGX7dS9
 xMEbYOkGDQNz1QqMc+pVNiWwZ50tVn/GXYf0nOFsoWHYDn/LjdllzDg9L
 kzqXBUNMaEQGj8YEP9WRi1sG+nXaPfIaJyufYJfDtGz0/Rd6bCCIwQdM6 8=;
Authentication-Results: esa6.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=andrew.cooper3@citrix.com;
 spf=Pass smtp.mailfrom=Andrew.Cooper3@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa6.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 andrew.cooper3@citrix.com) identity=pra;
 client-ip=162.221.158.21; receiver=esa6.hc3370-68.iphmx.com;
 envelope-from="Andrew.Cooper3@citrix.com";
 x-sender="andrew.cooper3@citrix.com";
 x-conformance=sidf_compatible
Received-SPF: Pass (esa6.hc3370-68.iphmx.com: domain of
 Andrew.Cooper3@citrix.com designates 162.221.158.21 as
 permitted sender) identity=mailfrom;
 client-ip=162.221.158.21; receiver=esa6.hc3370-68.iphmx.com;
 envelope-from="Andrew.Cooper3@citrix.com";
 x-sender="Andrew.Cooper3@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83
 ip4:168.245.78.127 ~all"
Received-SPF: None (esa6.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa6.hc3370-68.iphmx.com;
 envelope-from="Andrew.Cooper3@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: ZoQGFsLuSCPaNyAAiPkRhKvoCCMw54cHtgUr6hRBr6bj4lX36NjoFiE+i5Fb9FbuzGtXZndonk
 z3kShYFu1IXYo1lNM1IKBvH3rHQRf0I75+X/7RxghZBEgFLvwrvU9z4+xKmdiCVbPxd9h7X5i+
 3yTPjDHAuNogy3b5RwQhMOaGKOeuRwKQR0Hm/g4NqQpGcGhvqTCUVbE6XQ2TaqQ+PvvXRsGbDY
 RT+Iymb2o1xgBgh+dNZdJhM+kii/TCPcVbaAz7lmf4DyE+zkKxdtBZYtFDBb1GnK2Ew9z7i3E0
 /Io=
X-SBRS: 2.7
X-MesageID: 14703418
X-Ironport-Server: esa6.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.70,572,1574139600"; d="scan'208";a="14703418"
From: Andrew Cooper <andrew.cooper3@citrix.com>
To: Xen-devel <xen-devel@lists.xenproject.org>
Date: Thu, 19 Mar 2020 15:26:20 +0000
Message-ID: <20200319152622.31758-5-andrew.cooper3@citrix.com>
X-Mailer: git-send-email 2.11.0
In-Reply-To: <20200319152622.31758-1-andrew.cooper3@citrix.com>
References: <20200319152622.31758-1-andrew.cooper3@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH 4/6] x86/ucode: Rationalise startup and
 family/model checks
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>, Wei Liu <wl@xen.org>,
 Jan Beulich <JBeulich@suse.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

RHJvcCBtaWNyb2NvZGVfaW5pdF97aW50ZWwsYW1kfSgpLCBleHBvcnQge2ludGVsLGFtZH1fdWNv
ZGVfb3BzLCBhbmQgdXNlIGEKc3dpdGNoIHN0YXRlbWVudCBpbiBlYXJseV9taWNyb2NvZGVfaW5p
dCgpIHJhdGhlciB0aGFuIHByb2JpbmcgZWFjaCB2ZW5kb3IgaW4KdHVybi4gIFRoaXMgYWxsb3dz
IHRoZSBtaWNyb2NvZGVfb3BzIHBvaW50ZXIgdG8gYmVjb21lIGxvY2FsIHRvIGNvcmUuYy4KCkFz
IHRoZXJlIGFyZSBubyBleHRlcm5hbCB1c2VycyBvZiBtaWNyb2NvZGVfb3BzLCB0aGVyZSBpcyBu
byBuZWVkIGZvcgpjb2xsZWN0X2NwdV9pbmZvKCkgdG8gaW1wbGVtZW50IHNhbml0eSBjaGVja3Mu
ICBNb3ZlIGFwcGxpY2FibGUgY2hlY2tzIHRvCmVhcmx5X21pY3JvY29kZV9pbml0KCkgc28gdGhl
eSBhcmUgcGVyZm9ybWVkIG9uY2UsIHJhdGhlciB0aGFuIHJlcGVhdGVkbHkuCgpJdGVtcyB0byBu
b3RlOgogKiBUaGUgQU1EIHVjb2RlIGRyaXZlciBkb2VzIGhhdmUgYW4gdXBwZXIgZmFtaWxpeSBs
aW1pdCBvZiAweDE3LCBhcyBhIHNpZGUKICAgZWZmZWN0IG9mIHRoZSBsb2dpYyBpbiB2ZXJpZnlf
cGF0Y2hfc2l6ZSgpIHdoaWNoIGRvZXMgbmVlZCB1cGRhdGluZyBmb3IKICAgZWFjaCBuZXcgbW9k
ZWwuCiAqIFRoZSBJbnRlbCBsb2dpYyBndWFyZGluZyB0aGUgcmVhZCBvZiBNU1JfUExBVEZPUk1f
SUQgaXMgY29udHJhcnkgdG8gdGhlCiAgIFNETSwgd2hpY2ggc3RhdGVzIHRoYXQgdGhlIE1TUiBo
YXMgYmVlbiBhcmNoaXRlY3R1cmFsIHNpbmNlIHRoZSBQZW50aXVtCiAgIFBybyAoMDYtMDEteHgp
LCBhbmQgbGlzdHMgbm8gZmFtaWx5L21vZGVsIHJlc3RyaWN0aW9ucyBpbiB0aGUgcHNldWRvY29k
ZQogICBmb3IgbWljcm9jb2RlIGxvYWRpbmcuICBFaXRoZXIgd2F5LCBYZW4ncyA2NGJpdC1vbmx5
IG5hdHVyZSBhbHJlYWR5IG1ha2VzCiAgIHRoaXMgY2hlY2sgcmVkdW5kYW50LgoKU2lnbmVkLW9m
Zi1ieTogQW5kcmV3IENvb3BlciA8YW5kcmV3LmNvb3BlcjNAY2l0cml4LmNvbT4KLS0tCkNDOiBK
YW4gQmV1bGljaCA8SkJldWxpY2hAc3VzZS5jb20+CkNDOiBXZWkgTGl1IDx3bEB4ZW4ub3JnPgpD
QzogUm9nZXIgUGF1IE1vbm7DqSA8cm9nZXIucGF1QGNpdHJpeC5jb20+CgpUaGUgTVNSX1BMQVRG
T1JNX0lEIGd1YXJkIHdhcyBpbmhlcml0ZWQgZnJvbSBMaW51eCwgYW5kIGhhcyBleGlzdGVkIHRo
ZXJlCnNpbmNlIHRoZSBjb2RlJ3MgaW50cm9kdWN0aW9uLiAgTXkgYmVzdCBndWVzcyBpcyB0aGF0
IHRoZSBNU1IgbGlzdCBpbiB0aGUgU0RNCmdvdCBhbHRlcmVkIGF0IHNvbWUgcG9pbnQgYmV0d2Vl
biB0aGVuIGFuZCBub3cuCi0tLQogeGVuL2FyY2gveDg2L2NwdS9taWNyb2NvZGUvYW1kLmMgICAg
IHwgMjEgKystLS0tLS0tLS0tLS0tLS0tLS0KIHhlbi9hcmNoL3g4Ni9jcHUvbWljcm9jb2RlL2Nv
cmUuYyAgICB8IDM3ICsrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLQogeGVuL2Fy
Y2gveDg2L2NwdS9taWNyb2NvZGUvaW50ZWwuYyAgIHwgMjYgKysrLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLQogeGVuL2FyY2gveDg2L2NwdS9taWNyb2NvZGUvcHJpdmF0ZS5oIHwgIDUgKy0tLS0KIDQg
ZmlsZXMgY2hhbmdlZCwgMjkgaW5zZXJ0aW9ucygrKSwgNjAgZGVsZXRpb25zKC0pCgpkaWZmIC0t
Z2l0IGEveGVuL2FyY2gveDg2L2NwdS9taWNyb2NvZGUvYW1kLmMgYi94ZW4vYXJjaC94ODYvY3B1
L21pY3JvY29kZS9hbWQuYwppbmRleCA5MDI4ODg5ODEzLi43NjhmYmNmMzIyIDEwMDY0NAotLS0g
YS94ZW4vYXJjaC94ODYvY3B1L21pY3JvY29kZS9hbWQuYworKysgYi94ZW4vYXJjaC94ODYvY3B1
L21pY3JvY29kZS9hbWQuYwpAQCAtNzYsMjIgKzc2LDEyIEBAIHN0cnVjdCBtcGJoZHIgewogLyog
U2VlIGNvbW1lbnQgaW4gc3RhcnRfdXBkYXRlKCkgZm9yIGNhc2VzIHdoZW4gdGhpcyByb3V0aW5l
IGZhaWxzICovCiBzdGF0aWMgaW50IGNvbGxlY3RfY3B1X2luZm8oc3RydWN0IGNwdV9zaWduYXR1
cmUgKmNzaWcpCiB7Ci0gICAgdW5zaWduZWQgaW50IGNwdSA9IHNtcF9wcm9jZXNzb3JfaWQoKTsK
LSAgICBzdHJ1Y3QgY3B1aW5mb194ODYgKmMgPSAmY3B1X2RhdGFbY3B1XTsKLQogICAgIG1lbXNl
dChjc2lnLCAwLCBzaXplb2YoKmNzaWcpKTsKIAotICAgIGlmICggKGMtPng4Nl92ZW5kb3IgIT0g
WDg2X1ZFTkRPUl9BTUQpIHx8IChjLT54ODYgPCAweDEwKSApCi0gICAgewotICAgICAgICBwcmlu
dGsoS0VSTl9FUlIgIm1pY3JvY29kZTogQ1BVJWQgbm90IGEgY2FwYWJsZSBBTUQgcHJvY2Vzc29y
XG4iLAotICAgICAgICAgICAgICAgY3B1KTsKLSAgICAgICAgcmV0dXJuIC1FSU5WQUw7Ci0gICAg
fQotCiAgICAgcmRtc3JsKE1TUl9BTURfUEFUQ0hMRVZFTCwgY3NpZy0+cmV2KTsKIAogICAgIHBy
X2RlYnVnKCJtaWNyb2NvZGU6IENQVSVkIGNvbGxlY3RfY3B1X2luZm86IHBhdGNoX2lkPSUjeFxu
IiwKLSAgICAgICAgICAgICBjcHUsIGNzaWctPnJldik7CisgICAgICAgICAgICAgc21wX3Byb2Nl
c3Nvcl9pZCgpLCBjc2lnLT5yZXYpOwogCiAgICAgcmV0dXJuIDA7CiB9CkBAIC02MDEsNyArNTkx
LDcgQEAgc3RhdGljIGludCBzdGFydF91cGRhdGUodm9pZCkKIH0KICNlbmRpZgogCi1zdGF0aWMg
Y29uc3Qgc3RydWN0IG1pY3JvY29kZV9vcHMgbWljcm9jb2RlX2FtZF9vcHMgPSB7Citjb25zdCBz
dHJ1Y3QgbWljcm9jb2RlX29wcyBhbWRfdWNvZGVfb3BzID0gewogICAgIC5jcHVfcmVxdWVzdF9t
aWNyb2NvZGUgICAgICAgICAgICA9IGNwdV9yZXF1ZXN0X21pY3JvY29kZSwKICAgICAuY29sbGVj
dF9jcHVfaW5mbyAgICAgICAgICAgICAgICAgPSBjb2xsZWN0X2NwdV9pbmZvLAogICAgIC5hcHBs
eV9taWNyb2NvZGUgICAgICAgICAgICAgICAgICA9IGFwcGx5X21pY3JvY29kZSwKQEAgLTYxMywx
MCArNjAzLDMgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBtaWNyb2NvZGVfb3BzIG1pY3JvY29kZV9h
bWRfb3BzID0gewogICAgIC5jb21wYXJlX3BhdGNoICAgICAgICAgICAgICAgICAgICA9IGNvbXBh
cmVfcGF0Y2gsCiAgICAgLm1hdGNoX2NwdSAgICAgICAgICAgICAgICAgICAgICAgID0gbWF0Y2hf
Y3B1LAogfTsKLQotaW50IF9faW5pdCBtaWNyb2NvZGVfaW5pdF9hbWQodm9pZCkKLXsKLSAgICBp
ZiAoIGJvb3RfY3B1X2RhdGEueDg2X3ZlbmRvciA9PSBYODZfVkVORE9SX0FNRCApCi0gICAgICAg
IG1pY3JvY29kZV9vcHMgPSAmbWljcm9jb2RlX2FtZF9vcHM7Ci0gICAgcmV0dXJuIDA7Ci19CmRp
ZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvY3B1L21pY3JvY29kZS9jb3JlLmMgYi94ZW4vYXJjaC94
ODYvY3B1L21pY3JvY29kZS9jb3JlLmMKaW5kZXggYWM1ZGE2YjJmZS4uNjFlNGI5YjdhYiAxMDA2
NDQKLS0tIGEveGVuL2FyY2gveDg2L2NwdS9taWNyb2NvZGUvY29yZS5jCisrKyBiL3hlbi9hcmNo
L3g4Ni9jcHUvbWljcm9jb2RlL2NvcmUuYwpAQCAtMjEwLDcgKzIxMCw3IEBAIHZvaWQgX19pbml0
IG1pY3JvY29kZV9ncmFiX21vZHVsZSgKICAgICAgICAgbWljcm9jb2RlX3NjYW5fbW9kdWxlKG1v
ZHVsZV9tYXAsIG1iaSk7CiB9CiAKLWNvbnN0IHN0cnVjdCBtaWNyb2NvZGVfb3BzICptaWNyb2Nv
ZGVfb3BzOworc3RhdGljIGNvbnN0IHN0cnVjdCBtaWNyb2NvZGVfb3BzIF9fcmVhZF9tb3N0bHkg
Km1pY3JvY29kZV9vcHM7CiAKIHN0YXRpYyBERUZJTkVfU1BJTkxPQ0sobWljcm9jb2RlX211dGV4
KTsKIApAQCAtNzk4LDIzICs3OTgsMzIgQEAgc3RhdGljIGludCBfX2luaXQgZWFybHlfbWljcm9j
b2RlX3VwZGF0ZV9jcHUodm9pZCkKIAogaW50IF9faW5pdCBlYXJseV9taWNyb2NvZGVfaW5pdCh2
b2lkKQogewotICAgIGludCByYzsKLQotICAgIHJjID0gbWljcm9jb2RlX2luaXRfaW50ZWwoKTsK
LSAgICBpZiAoIHJjICkKLSAgICAgICAgcmV0dXJuIHJjOwotCi0gICAgcmMgPSBtaWNyb2NvZGVf
aW5pdF9hbWQoKTsKLSAgICBpZiAoIHJjICkKLSAgICAgICAgcmV0dXJuIHJjOworICAgIGNvbnN0
IHN0cnVjdCBjcHVpbmZvX3g4NiAqYyA9ICZib290X2NwdV9kYXRhOworICAgIGludCByYyA9IDA7
CiAKLSAgICBpZiAoIG1pY3JvY29kZV9vcHMgKQorICAgIHN3aXRjaCAoIGMtPng4Nl92ZW5kb3Ig
KQogICAgIHsKLSAgICAgICAgbWljcm9jb2RlX29wcy0+Y29sbGVjdF9jcHVfaW5mbygmdGhpc19j
cHUoY3B1X3NpZykpOworICAgIGNhc2UgWDg2X1ZFTkRPUl9BTUQ6CisgICAgICAgIGlmICggYy0+
eDg2ID49IDB4MTAgJiYgYy0+eDg2IDw9IDB4MTcgKQorICAgICAgICAgICAgbWljcm9jb2RlX29w
cyA9ICZhbWRfdWNvZGVfb3BzOworICAgICAgICBicmVhazsKKworICAgIGNhc2UgWDg2X1ZFTkRP
Ul9JTlRFTDoKKyAgICAgICAgaWYgKCBjLT54ODYgPj0gNiApCisgICAgICAgICAgICBtaWNyb2Nv
ZGVfb3BzID0gJmludGVsX3Vjb2RlX29wczsKKyAgICAgICAgYnJlYWs7CisgICAgfQogCi0gICAg
ICAgIGlmICggdWNvZGVfbW9kLm1vZF9lbmQgfHwgdWNvZGVfYmxvYi5zaXplICkKLSAgICAgICAg
ICAgIHJjID0gZWFybHlfbWljcm9jb2RlX3VwZGF0ZV9jcHUoKTsKKyAgICBpZiAoICFtaWNyb2Nv
ZGVfb3BzICkKKyAgICB7CisgICAgICAgIHByaW50ayhYRU5MT0dfV0FSTklORyAiTWljcm9jb2Rl
IGxvYWRpbmcgbm90IGF2YWlsYWJsZVxuIik7CisgICAgICAgIHJldHVybiAtRU5PREVWOwogICAg
IH0KIAorICAgIG1pY3JvY29kZV9vcHMtPmNvbGxlY3RfY3B1X2luZm8oJnRoaXNfY3B1KGNwdV9z
aWcpKTsKKworICAgIGlmICggdWNvZGVfbW9kLm1vZF9lbmQgfHwgdWNvZGVfYmxvYi5zaXplICkK
KyAgICAgICAgcmMgPSBlYXJseV9taWNyb2NvZGVfdXBkYXRlX2NwdSgpOworCiAgICAgcmV0dXJu
IHJjOwogfQpkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L2NwdS9taWNyb2NvZGUvaW50ZWwuYyBi
L3hlbi9hcmNoL3g4Ni9jcHUvbWljcm9jb2RlL2ludGVsLmMKaW5kZXggOTBmYjAwNmM5NC4uNDg1
NDRlOGQ2ZCAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L2NwdS9taWNyb2NvZGUvaW50ZWwuYwor
KysgYi94ZW4vYXJjaC94ODYvY3B1L21pY3JvY29kZS9pbnRlbC5jCkBAIC05MywyNyArOTMsMTQg
QEAgc3RydWN0IGV4dGVuZGVkX3NpZ3RhYmxlIHsKIAogc3RhdGljIGludCBjb2xsZWN0X2NwdV9p
bmZvKHN0cnVjdCBjcHVfc2lnbmF0dXJlICpjc2lnKQogewotICAgIHVuc2lnbmVkIGludCBjcHVf
bnVtID0gc21wX3Byb2Nlc3Nvcl9pZCgpOwotICAgIHN0cnVjdCBjcHVpbmZvX3g4NiAqYyA9ICZj
cHVfZGF0YVtjcHVfbnVtXTsKICAgICB1aW50NjRfdCBtc3JfY29udGVudDsKIAogICAgIG1lbXNl
dChjc2lnLCAwLCBzaXplb2YoKmNzaWcpKTsKIAotICAgIGlmICggKGMtPng4Nl92ZW5kb3IgIT0g
WDg2X1ZFTkRPUl9JTlRFTCkgfHwgKGMtPng4NiA8IDYpICkKLSAgICB7Ci0gICAgICAgIHByaW50
ayhLRVJOX0VSUiAibWljcm9jb2RlOiBDUFUlZCBub3QgYSBjYXBhYmxlIEludGVsICIKLSAgICAg
ICAgICAgICAgICJwcm9jZXNzb3JcbiIsIGNwdV9udW0pOwotICAgICAgICByZXR1cm4gLTE7Ci0g
ICAgfQotCiAgICAgY3NpZy0+c2lnID0gY3B1aWRfZWF4KDB4MDAwMDAwMDEpOwogCi0gICAgaWYg
KCAoYy0+eDg2X21vZGVsID49IDUpIHx8IChjLT54ODYgPiA2KSApCi0gICAgewotICAgICAgICAv
KiBnZXQgcHJvY2Vzc29yIGZsYWdzIGZyb20gTVNSIDB4MTcgKi8KLSAgICAgICAgcmRtc3JsKE1T
Ul9JQTMyX1BMQVRGT1JNX0lELCBtc3JfY29udGVudCk7Ci0gICAgICAgIGNzaWctPnBmID0gMSA8
PCAoKG1zcl9jb250ZW50ID4+IDUwKSAmIDcpOwotICAgIH0KKyAgICByZG1zcmwoTVNSX0lBMzJf
UExBVEZPUk1fSUQsIG1zcl9jb250ZW50KTsKKyAgICBjc2lnLT5wZiA9IDEgPDwgKChtc3JfY29u
dGVudCA+PiA1MCkgJiA3KTsKIAogICAgIHdybXNybChNU1JfSUEzMl9VQ09ERV9SRVYsIDB4MFVM
TCk7CiAgICAgLyogQXMgZG9jdW1lbnRlZCBpbiB0aGUgU0RNOiBEbyBhIENQVUlEIDEgaGVyZSAq
LwpAQCAtNDA1LDcgKzM5Miw3IEBAIHN0YXRpYyBzdHJ1Y3QgbWljcm9jb2RlX3BhdGNoICpjcHVf
cmVxdWVzdF9taWNyb2NvZGUoY29uc3Qgdm9pZCAqYnVmLAogICAgIHJldHVybiBwYXRjaDsKIH0K
IAotc3RhdGljIGNvbnN0IHN0cnVjdCBtaWNyb2NvZGVfb3BzIG1pY3JvY29kZV9pbnRlbF9vcHMg
PSB7Citjb25zdCBzdHJ1Y3QgbWljcm9jb2RlX29wcyBpbnRlbF91Y29kZV9vcHMgPSB7CiAgICAg
LmNwdV9yZXF1ZXN0X21pY3JvY29kZSAgICAgICAgICAgID0gY3B1X3JlcXVlc3RfbWljcm9jb2Rl
LAogICAgIC5jb2xsZWN0X2NwdV9pbmZvICAgICAgICAgICAgICAgICA9IGNvbGxlY3RfY3B1X2lu
Zm8sCiAgICAgLmFwcGx5X21pY3JvY29kZSAgICAgICAgICAgICAgICAgID0gYXBwbHlfbWljcm9j
b2RlLApAQCAtNDEzLDEwICs0MDAsMyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IG1pY3JvY29kZV9v
cHMgbWljcm9jb2RlX2ludGVsX29wcyA9IHsKICAgICAuY29tcGFyZV9wYXRjaCAgICAgICAgICAg
ICAgICAgICAgPSBjb21wYXJlX3BhdGNoLAogICAgIC5tYXRjaF9jcHUgICAgICAgICAgICAgICAg
ICAgICAgICA9IG1hdGNoX2NwdSwKIH07Ci0KLWludCBfX2luaXQgbWljcm9jb2RlX2luaXRfaW50
ZWwodm9pZCkKLXsKLSAgICBpZiAoIGJvb3RfY3B1X2RhdGEueDg2X3ZlbmRvciA9PSBYODZfVkVO
RE9SX0lOVEVMICkKLSAgICAgICAgbWljcm9jb2RlX29wcyA9ICZtaWNyb2NvZGVfaW50ZWxfb3Bz
OwotICAgIHJldHVybiAwOwotfQpkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L2NwdS9taWNyb2Nv
ZGUvcHJpdmF0ZS5oIGIveGVuL2FyY2gveDg2L2NwdS9taWNyb2NvZGUvcHJpdmF0ZS5oCmluZGV4
IDQ1OWI2YTRjNTQuLmMzMmRkYzhkMTkgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9jcHUvbWlj
cm9jb2RlL3ByaXZhdGUuaAorKysgYi94ZW4vYXJjaC94ODYvY3B1L21pY3JvY29kZS9wcml2YXRl
LmgKQEAgLTMyLDkgKzMyLDYgQEAgc3RydWN0IG1pY3JvY29kZV9vcHMgewogICAgICAgICBjb25z
dCBzdHJ1Y3QgbWljcm9jb2RlX3BhdGNoICpuZXcsIGNvbnN0IHN0cnVjdCBtaWNyb2NvZGVfcGF0
Y2ggKm9sZCk7CiB9OwogCi1leHRlcm4gY29uc3Qgc3RydWN0IG1pY3JvY29kZV9vcHMgKm1pY3Jv
Y29kZV9vcHM7Ci0KLWludCBtaWNyb2NvZGVfaW5pdF9pbnRlbCh2b2lkKTsKLWludCBtaWNyb2Nv
ZGVfaW5pdF9hbWQodm9pZCk7CitleHRlcm4gY29uc3Qgc3RydWN0IG1pY3JvY29kZV9vcHMgYW1k
X3Vjb2RlX29wcywgaW50ZWxfdWNvZGVfb3BzOwogCiAjZW5kaWYgLyogQVNNX1g4Nl9NSUNST0NP
REVfUFJJVkFURV9IICovCi0tIAoyLjExLjAKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0
cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlz
dGluZm8veGVuLWRldmVs

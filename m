Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id E102CCB2EB
	for <lists+xen-devel@lfdr.de>; Fri,  4 Oct 2019 03:18:11 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iGCBY-0003NY-GB; Fri, 04 Oct 2019 01:15:08 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=+Z5s=X5=kernel.org=sstabellini@srs-us1.protection.inumbo.net>)
 id 1iGCBW-0003MF-Lk
 for xen-devel@lists.xen.org; Fri, 04 Oct 2019 01:15:06 +0000
X-Inumbo-ID: 63754a80-e644-11e9-973b-12813bfff9fa
Received: from mail.kernel.org (unknown [198.145.29.99])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 63754a80-e644-11e9-973b-12813bfff9fa;
 Fri, 04 Oct 2019 01:15:01 +0000 (UTC)
Received: from sstabellini-ThinkPad-T480s.hsd1.ca.comcast.net
 (c-67-164-102-47.hsd1.ca.comcast.net [67.164.102.47])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
 (No client certificate requested)
 by mail.kernel.org (Postfix) with ESMTPSA id B318F21A4C;
 Fri,  4 Oct 2019 01:15:00 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
 s=default; t=1570151701;
 bh=xSjvFLbUvmE6IEZYPdgneoijM6lKVbFsk/AXDVws6S0=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=DNuYoE92fxOjm2zRe53BB/ft84ESpShNX85+q+vuCYsWlhBKsr9roJU50bDZjUA2q
 y0tBIMS1b7+PN95++vWQKea61dHKB1AtLtb9Ghb3j0IlWXdpKRVr6GgJHlgRNitV6E
 i8ih6mgB7zrGAuc94JxzAh3bVz6YaDNQ5OOCLCUA=
From: Stefano Stabellini <sstabellini@kernel.org>
To: julien.grall@arm.com
Date: Thu,  3 Oct 2019 18:14:54 -0700
Message-Id: <20191004011457.11126-5-sstabellini@kernel.org>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <alpine.DEB.2.21.1910031812380.30844@sstabellini-ThinkPad-T480s>
References: <alpine.DEB.2.21.1910031812380.30844@sstabellini-ThinkPad-T480s>
Subject: [Xen-devel] [PATCH v9 5/8] xen/arm: assign devices to boot domains
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Stefano Stabellini <stefanos@xilinx.com>, sstabellini@kernel.org,
 andrii_anisov@epam.com, Achin.Gupta@arm.com, xen-devel@lists.xen.org,
 Volodymyr_Babchuk@epam.com
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

U2NhbiB0aGUgdXNlciBwcm92aWRlZCBkdGIgZnJhZ21lbnQgYXQgYm9vdC4gRm9yIGVhY2ggZGV2
aWNlIG5vZGUsIG1hcAptZW1vcnkgdG8gZ3Vlc3RzLCBhbmQgcm91dGUgaW50ZXJydXB0cyBhbmQg
c2V0dXAgdGhlIGlvbW11LgoKVGhlIG1lbW9yeSByZWdpb24gdG8gcmVtYXAgaXMgc3BlY2lmaWVk
IGJ5IHRoZSAieGVuLHJlZyIgcHJvcGVydHkuCgpUaGUgaW9tbXUgaXMgc2V0dXAgYnkgcGFzc2lu
ZyB0aGUgbm9kZSBvZiB0aGUgZGV2aWNlIHRvIGFzc2lnbiBvbiB0aGUKaG9zdCBkZXZpY2UgdHJl
ZS4gVGhlIHBhdGggaXMgc3BlY2lmaWVkIGluIHRoZSBkZXZpY2UgdHJlZSBmcmFnbWVudCBhcwp0
aGUgInhlbixwYXRoIiBzdHJpbmcgcHJvcGVydHkuCgpUaGUgaW50ZXJydXB0cyBhcmUgcmVtYXBw
ZWQgYmFzZWQgb24gdGhlIGluZm9ybWF0aW9uIGZyb20gdGhlCmNvcnJlc3BvbmRpbmcgbm9kZSBv
biB0aGUgaG9zdCBkZXZpY2UgdHJlZS4gQ2FsbApoYW5kbGVfZGV2aWNlX2ludGVycnVwdHMgdG8g
cmVtYXAgaW50ZXJydXB0cy4gSW50ZXJydXB0cyByZWxhdGVkIGRldmljZQp0cmVlIHByb3BlcnRp
ZXMgYXJlIGNvcGllZCBmcm9tIHRoZSBkZXZpY2UgdHJlZSBmcmFnbWVudCwgc2FtZSBhcyBhbGwK
dGhlIG90aGVyIHByb3BlcnRpZXMuCgpSZXF1aXJlIGJvdGggeGVuLHJlZyBhbmQgeGVuLHBhdGgg
dG8gYmUgcHJlc2VudCwgdW5sZXNzCnhlbixmb3JjZS1hc3NpZ24td2l0aG91dC1pb21tdSBpcyBh
bHNvIHNldC4gSW4gdGhhdCBjYXNlLCB0b2xlcmF0ZSBhCm1pc3NpbmcgeGVuLHBhdGgsIGFsc28g
dG9sZXJhdGUgaW9tbXUgc2V0dXAgZmFpbHVyZSBmb3IgdGhlIHBhc3N0aHJvdWdoCmRldmljZS4K
CkFsc28gc2V0IGFkZCB0aGUgbmV3IGZsYWcgWEVOX0RPTUNUTF9DREZfaW9tbXUgc28gdGhhdCBk
b20wbGVzcyBkb21VCmNhbiB1c2UgdGhlIElPTU1VIGlmIGEgcGFydGlhbCBkdGIgaXMgc3BlY2lm
aWVkLgoKU2lnbmVkLW9mZi1ieTogU3RlZmFubyBTdGFiZWxsaW5pIDxzdGVmYW5vc0B4aWxpbngu
Y29tPgotLS0KQ2hhbmdlcyBpbiB2OToKLSBhZGQgYSBjaGVjayBvbiB4ZW4scmVnIG9yIHhlbixw
YXRoIG1pc3NpbmcKLSBkb24ndCBjb250aW51ZSB3aGVuIElPTU1VIHNldHVwIGZhaWxzIHdpdGgg
YW4gZXJyb3IKCkNoYW5nZXMgaW4gdjg6Ci0gYmV0dGVyIGluLWNvZGUgY29tbWVudAotIGNvZGUg
c3R5bGUKLSBhZGQgYSBwcmluayBpbiBjYXNlIG9mIGVycm9yCgpDaGFuZ2VzIGluIHY3OgotIGlt
cHJvdmUgaW4tY29kZSBjb21tZW50Ci0gY29kZSBzdHlsZQotIHJldHVybiAxIGluc3RlYWQgb2Yg
RU5PRU5UCi0gaW50cm9kdWNlICJ4ZW4sZm9yY2UtYXNzaWduLXdpdGhvdXQtaW9tbXUiCi0gcmVx
dWlyZSBib3RoICJ4ZW4scmVnIiBhbmQgInhlbixwYXRoIiB1bmxlc3MKICAieGVuLGZvcmNlLWFz
c2lnbi13aXRob3V0LWlvbW11IgoKQ2hhbmdlcyBpbiB2NjoKLSB0dXJuIGRwcmludGtzIGludG8g
cHJpbnRrcwotIHJldHVybiBlcnJvciBvbiBwYWdlIGFsaWdubWVudCBjaGVjayBmYWlsdXJlCi0g
c2V0IFhFTl9ET01DVExfQ0RGX2lvbW11IGlmIHBhcnRpYWwgZHRiIGlzIHNwZWNpZmllZAoKQ2hh
bmdlcyBpbiB2NToKLSB1c2UgbG9jYWwgdmFyaWFibGUgZm9yIG5hbWUKLSB1c2UgbWFwX3JlZ2lv
bnNfcDJtdAotIGFkZCB3YXJuaW5nIGZvciBub3QgcGFnZSBhbGlnbmVkIGFkZHJlc3Nlcy9zaXpl
cwotIGludHJvZHVjZSBoYW5kbGVfcGFzc3Rocm91Z2hfcHJvcAoKQ2hhbmdlcyBpbiB2NDoKLSB1
c2UgdW5zaWduZWQKLSBpbXByb3ZlIGNvbW1pdCBtZXNzYWdlCi0gY29kZSBzdHlsZQotIHVzZSBk
dF9wcm9wX2NtcAotIHVzZSBkZXZpY2VfdHJlZV9nZXRfcmVnCi0gZG9uJ3QgY29weSBvdmVyIHhl
bixyZWcgYW5kIHhlbixwYXRoCi0gZG9uJ3QgY3JlYXRlIHNwZWNpYWwgaW50ZXJydXB0IHByb3Bl
cnRpZXMgZm9yIGRvbVU6IGNvcHkgdGhlbSBmcm9tIHRoZQogIGZyYWdtZW50Ci0gaW4tY29kZSBj
b21tZW50CgpDaGFuZ2VzIGluIHYzOgotIGltcHJvdmUgY29tbWl0IG1lc3NhZ2UKLSByZW1vdmUg
c3VwZXJmbHVvdXMgY2FzdAotIG1lcmdlIGNvZGUgd2l0aCB0aGUgY29weSBjb2RlCi0gYWRkIGlu
dGVycnVwLXBhcmVudAotIGRlbW92ZSBkZXB0aCA+IDIgY2hlY2sKLSByZXVzZSBjb2RlIGZyb20g
aGFuZGxlX2RldmljZV9pbnRlcnJ1cHRzCi0gY29weSBpbnRlcnJ1cHRzIGZyb20gaG9zdCBkdAoK
Q2hhbmdlcyBpbiB2MjoKLSByZW5hbWUgInBhdGgiIHRvICJ4ZW4scGF0aCIKLSBncmFtbWFyIGZp
eAotIHVzZSBnYWRkcl90b19nZm4gYW5kIG1hZGRyX3RvX21mbgotIHJlbW92ZSBkZXB0aCA8PSAy
IGxpbWl0YXRpb24gaW4gc2Nhbm5pbmcgdGhlIGR0YiBmcmFnbWVudAotIGludHJvZHVjZSBhbmQg
cGFyc2UgeGVuLHJlZwotIGNvZGUgc3R5bGUKLSBzdXBwb3J0IG1vcmUgdGhhbiBvbmUgaW50ZXJy
dXB0IHBlciBkZXZpY2UKLSBzcGVjaWZ5IG9ubHkgdGhlIEdJQyBpcyBzdXBwb3J0ZWQKLS0tCiB4
ZW4vYXJjaC9hcm0vZG9tYWluX2J1aWxkLmMgfCAxNDcgKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKystCiAxIGZpbGUgY2hhbmdlZCwgMTQzIGluc2VydGlvbnMoKyksIDQgZGVsZXRp
b25zKC0pCgpkaWZmIC0tZ2l0IGEveGVuL2FyY2gvYXJtL2RvbWFpbl9idWlsZC5jIGIveGVuL2Fy
Y2gvYXJtL2RvbWFpbl9idWlsZC5jCmluZGV4IDg0YjY1YjhmMjUuLjAzMGZjMzI0MTYgMTAwNjQ0
Ci0tLSBhL3hlbi9hcmNoL2FybS9kb21haW5fYnVpbGQuYworKysgYi94ZW4vYXJjaC9hcm0vZG9t
YWluX2J1aWxkLmMKQEAgLTE3MTQsNiArMTcxNCw5MCBAQCBzdGF0aWMgaW50IF9faW5pdCBtYWtl
X3ZwbDAxMV91YXJ0X25vZGUoc3RydWN0IGtlcm5lbF9pbmZvICpraW5mbykKIH0KICNlbmRpZgog
CisvKgorICogU2NhbiBkZXZpY2UgdHJlZSBwcm9wZXJ0aWVzIGZvciBwYXNzdGhyb3VnaCBzcGVj
aWZpYyBpbmZvcm1hdGlvbi4KKyAqIFJldHVybnMgPCAwIG9uIGVycm9yCisgKiAgICAgICAgIDAg
b24gc3VjY2VzcworICovCitzdGF0aWMgaW50IF9faW5pdCBoYW5kbGVfcGFzc3Rocm91Z2hfcHJv
cChzdHJ1Y3Qga2VybmVsX2luZm8gKmtpbmZvLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgY29uc3Qgc3RydWN0IGZkdF9wcm9wZXJ0eSAqeGVuX3JlZywKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cnVjdCBmZHRfcHJv
cGVydHkgKnhlbl9wYXRoLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgYm9vbCB4ZW5fZm9yY2UsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICB1aW50MzJfdCBhZGRyZXNzX2NlbGxzLCB1aW50MzJfdCBzaXplX2NlbGxzKQoreworICAg
IGNvbnN0IF9fYmUzMiAqY2VsbDsKKyAgICB1bnNpZ25lZCBpbnQgaSwgbGVuOworICAgIHN0cnVj
dCBkdF9kZXZpY2Vfbm9kZSAqbm9kZTsKKyAgICBpbnQgcmVzOworICAgIHBhZGRyX3QgbXN0YXJ0
LCBzaXplLCBnc3RhcnQ7CisKKyAgICAvKiB4ZW4scmVnIHNwZWNpZmllcyB3aGVyZSB0byBtYXAg
dGhlIE1NSU8gcmVnaW9uICovCisgICAgY2VsbCA9IChjb25zdCBfX2JlMzIgKil4ZW5fcmVnLT5k
YXRhOworICAgIGxlbiA9IGZkdDMyX3RvX2NwdSh4ZW5fcmVnLT5sZW4pIC8gKChhZGRyZXNzX2Nl
bGxzICogMiArIHNpemVfY2VsbHMpICoKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBzaXplb2YodWludDMyX3QpKTsKKworICAgIGZvciAoIGkgPSAwOyBpIDwgbGVuOyBp
KysgKQorICAgIHsKKyAgICAgICAgZGV2aWNlX3RyZWVfZ2V0X3JlZygmY2VsbCwgYWRkcmVzc19j
ZWxscywgc2l6ZV9jZWxscywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAmbXN0YXJ0LCAm
c2l6ZSk7CisgICAgICAgIGdzdGFydCA9IGR0X25leHRfY2VsbChhZGRyZXNzX2NlbGxzLCAmY2Vs
bCk7CisKKyAgICAgICAgaWYgKCBnc3RhcnQgJiB+UEFHRV9NQVNLIHx8IG1zdGFydCAmIH5QQUdF
X01BU0sgfHwgc2l6ZSAmIH5QQUdFX01BU0sgKQorICAgICAgICB7CisgICAgICAgICAgICBwcmlu
dGsoWEVOTE9HX0VSUgorICAgICAgICAgICAgICAgICAgICAiRG9tVSBwYXNzdGhyb3VnaCBjb25m
aWcgaGFzIG5vdCBwYWdlIGFsaWduZWQgYWRkcmVzc2VzL3NpemVzXG4iKTsKKyAgICAgICAgICAg
IHJldHVybiAtRUlOVkFMOworICAgICAgICB9CisKKyAgICAgICAgcmVzID0gbWFwX3JlZ2lvbnNf
cDJtdChraW5mby0+ZCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYWRkcl90b19n
Zm4oZ3N0YXJ0KSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQRk5fRE9XTihzaXpl
KSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWRkcl90b19tZm4obXN0YXJ0KSwK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwMm1fbW1pb19kaXJlY3RfZGV2KTsKKyAg
ICAgICAgaWYgKCByZXMgPCAwICkKKyAgICAgICAgeworICAgICAgICAgICAgcHJpbnRrKFhFTkxP
R19FUlIKKyAgICAgICAgICAgICAgICAgICAiRmFpbGVkIHRvIG1hcCAlIlBSSXBhZGRyIiB0byB0
aGUgZ3Vlc3QgYXQlIlBSSXBhZGRyIlxuIiwKKyAgICAgICAgICAgICAgICAgICBtc3RhcnQsIGdz
dGFydCk7CisgICAgICAgICAgICByZXR1cm4gLUVGQVVMVDsKKyAgICAgICAgfQorICAgIH0KKwor
ICAgIC8qCisgICAgICogSWYgeGVuX2ZvcmNlLCB3ZSBsZXQgdGhlIHVzZXIgYXNzaWduIGEgTU1J
TyByZWdpb24gd2l0aCBubworICAgICAqIGFzc29jaWF0ZWQgcGF0aC4KKyAgICAgKi8KKyAgICBp
ZiAoIHhlbl9wYXRoID09IE5VTEwgKQorICAgICAgICByZXR1cm4geGVuX2ZvcmNlID8gMCA6IC1F
SU5WQUw7CisKKyAgICAvKgorICAgICAqIHhlbixwYXRoIHNwZWNpZmllcyB0aGUgY29ycmVzcG9u
ZGluZyBub2RlIGluIHRoZSBob3N0IERULgorICAgICAqIEJvdGggaW50ZXJydXB0IG1hcHBpbmdz
IGFuZCBJT01NVSBzZXR0aW5ncyBhcmUgYmFzZWQgb24gaXQsCisgICAgICogYXMgdGhleSBhcmUg
ZG9uZSBiYXNlZCBvbiB0aGUgY29ycmVzcG9uZGluZyBob3N0IERUIG5vZGUuCisgICAgICovCisg
ICAgbm9kZSA9IGR0X2ZpbmRfbm9kZV9ieV9wYXRoKHhlbl9wYXRoLT5kYXRhKTsKKyAgICBpZiAo
IG5vZGUgPT0gTlVMTCApCisgICAgeworICAgICAgICBwcmludGsoWEVOTE9HX0VSUiAiQ291bGRu
J3QgZmluZCBub2RlICVzIGluIGhvc3RfZHQhXG4iLAorICAgICAgICAgICAgICAgKGNoYXIgKil4
ZW5fcGF0aC0+ZGF0YSk7CisgICAgICAgIHJldHVybiAtRUlOVkFMOworICAgIH0KKworICAgIHJl
cyA9IGhhbmRsZV9kZXZpY2VfaW50ZXJydXB0cyhraW5mby0+ZCwgbm9kZSwgdHJ1ZSk7CisgICAg
aWYgKCByZXMgPCAwICkKKyAgICAgICAgcmV0dXJuIHJlczsKKworICAgIHJlcyA9IGlvbW11X2Fk
ZF9kdF9kZXZpY2Uobm9kZSk7CisgICAgaWYgKCByZXMgPCAwICkKKyAgICAgICAgcmV0dXJuIHJl
czsKKworICAgIC8qIElmIHhlbl9mb3JjZSwgd2UgYWxsb3cgYXNzaWdubWVudCBvZiBkZXZpY2Vz
IHdpdGhvdXQgSU9NTVUgcHJvdGVjdGlvbi4gKi8KKyAgICBpZiAoIHhlbl9mb3JjZSAmJiAhZHRf
ZGV2aWNlX2lzX3Byb3RlY3RlZChub2RlKSApCisgICAgICAgIHJldHVybiAwOworCisgICAgcmV0
dXJuIGlvbW11X2Fzc2lnbl9kdF9kZXZpY2Uoa2luZm8tPmQsIG5vZGUpOworfQorCiBzdGF0aWMg
aW50IF9faW5pdCBoYW5kbGVfcHJvcF9wZmR0KHN0cnVjdCBrZXJuZWxfaW5mbyAqa2luZm8sCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZvaWQgKnBmZHQsIGludCBu
b2Rlb2ZmLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCBhZGRy
ZXNzX2NlbGxzLCB1aW50MzJfdCBzaXplX2NlbGxzLApAQCAtMTcyMSw3ICsxODA1LDkgQEAgc3Rh
dGljIGludCBfX2luaXQgaGFuZGxlX3Byb3BfcGZkdChzdHJ1Y3Qga2VybmVsX2luZm8gKmtpbmZv
LAogewogICAgIHZvaWQgKmZkdCA9IGtpbmZvLT5mZHQ7CiAgICAgaW50IHByb3BvZmYsIG5hbWVv
ZmYsIHJlczsKLSAgICBjb25zdCBzdHJ1Y3QgZmR0X3Byb3BlcnR5ICpwcm9wOworICAgIGNvbnN0
IHN0cnVjdCBmZHRfcHJvcGVydHkgKnByb3AsICp4ZW5fcmVnID0gTlVMTCwgKnhlbl9wYXRoID0g
TlVMTDsKKyAgICBjb25zdCBjaGFyICpuYW1lOworICAgIGJvb2wgZm91bmQsIHhlbl9mb3JjZSA9
IGZhbHNlOwogCiAgICAgZm9yICggcHJvcG9mZiA9IGZkdF9maXJzdF9wcm9wZXJ0eV9vZmZzZXQo
cGZkdCwgbm9kZW9mZik7CiAgICAgICAgICAgcHJvcG9mZiA+PSAwOwpAQCAtMTczMCwxMSArMTgx
Niw2MSBAQCBzdGF0aWMgaW50IF9faW5pdCBoYW5kbGVfcHJvcF9wZmR0KHN0cnVjdCBrZXJuZWxf
aW5mbyAqa2luZm8sCiAgICAgICAgIGlmICggIShwcm9wID0gZmR0X2dldF9wcm9wZXJ0eV9ieV9v
ZmZzZXQocGZkdCwgcHJvcG9mZiwgTlVMTCkpICkKICAgICAgICAgICAgIHJldHVybiAtRkRUX0VS
Ul9JTlRFUk5BTDsKIAorICAgICAgICBmb3VuZCA9IGZhbHNlOwogICAgICAgICBuYW1lb2ZmID0g
ZmR0MzJfdG9fY3B1KHByb3AtPm5hbWVvZmYpOwotICAgICAgICByZXMgPSBmZHRfcHJvcGVydHko
ZmR0LCBmZHRfc3RyaW5nKHBmZHQsIG5hbWVvZmYpLAotICAgICAgICAgICAgICAgICAgICAgICAg
ICAgcHJvcC0+ZGF0YSwgZmR0MzJfdG9fY3B1KHByb3AtPmxlbikpOwotICAgICAgICBpZiAoIHJl
cyApCisgICAgICAgIG5hbWUgPSBmZHRfc3RyaW5nKHBmZHQsIG5hbWVvZmYpOworCisgICAgICAg
IGlmICggc2Nhbl9wYXNzdGhyb3VnaF9wcm9wICkKKyAgICAgICAgeworICAgICAgICAgICAgaWYg
KCBkdF9wcm9wX2NtcCgieGVuLHJlZyIsIG5hbWUpID09IDAgKQorICAgICAgICAgICAgeworICAg
ICAgICAgICAgICAgIHhlbl9yZWcgPSBwcm9wOworICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1
ZTsKKyAgICAgICAgICAgIH0KKyAgICAgICAgICAgIGVsc2UgaWYgKCBkdF9wcm9wX2NtcCgieGVu
LHBhdGgiLCBuYW1lKSA9PSAwICkKKyAgICAgICAgICAgIHsKKyAgICAgICAgICAgICAgICB4ZW5f
cGF0aCA9IHByb3A7CisgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOworICAgICAgICAgICAg
fQorICAgICAgICAgICAgZWxzZSBpZiAoIGR0X3Byb3BfY21wKCJ4ZW4sZm9yY2UtYXNzaWduLXdp
dGhvdXQtaW9tbXUiLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUpID09
IDAgKQorICAgICAgICAgICAgeworICAgICAgICAgICAgICAgIHhlbl9mb3JjZSA9IHRydWU7Cisg
ICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOworICAgICAgICAgICAgfQorICAgICAgICB9CisK
KyAgICAgICAgLyoKKyAgICAgICAgICogQ29weSBwcm9wZXJ0aWVzIG90aGVyIHRoYW4gdGhlIG9u
ZXMgYWJvdmU6IHhlbixyZWcsIHhlbixwYXRoLAorICAgICAgICAgKiBhbmQgeGVuLGZvcmNlLWFz
c2lnbi13aXRob3V0LWlvbW11LgorICAgICAgICAgKi8KKyAgICAgICAgaWYgKCAhZm91bmQgKQor
ICAgICAgICB7CisgICAgICAgICAgICByZXMgPSBmZHRfcHJvcGVydHkoZmR0LCBuYW1lLCBwcm9w
LT5kYXRhLCBmZHQzMl90b19jcHUocHJvcC0+bGVuKSk7CisgICAgICAgICAgICBpZiAoIHJlcyAp
CisgICAgICAgICAgICAgICAgcmV0dXJuIHJlczsKKyAgICAgICAgfQorICAgIH0KKworICAgIC8q
CisgICAgICogT25seSBoYW5kbGUgcGFzc3Rocm91Z2ggcHJvcGVydGllcyBpZiBib3RoIHhlbixy
ZWcgYW5kIHhlbixwYXRoCisgICAgICogYXJlIHByZXNlbnQsIG9yIGlmIHhlbixmb3JjZS1hc3Np
Z24td2l0aG91dC1pb21tdSBpcyBzcGVjaWZpZWQuCisgICAgICovCisgICAgaWYgKCB4ZW5fcmVn
ICE9IE5VTEwgJiYgKHhlbl9wYXRoICE9IE5VTEwgfHwgeGVuX2ZvcmNlKSApCisgICAgeworICAg
ICAgICByZXMgPSBoYW5kbGVfcGFzc3Rocm91Z2hfcHJvcChraW5mbywgeGVuX3JlZywgeGVuX3Bh
dGgsIHhlbl9mb3JjZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRk
cmVzc19jZWxscywgc2l6ZV9jZWxscyk7CisgICAgICAgIGlmICggcmVzIDwgMCApCisgICAgICAg
IHsKKyAgICAgICAgICAgIHByaW50ayhYRU5MT0dfRVJSICJGYWlsZWQgdG8gYXNzaWduIGRldmlj
ZSB0byAlcGRcbiIsIGtpbmZvLT5kKTsKICAgICAgICAgICAgIHJldHVybiByZXM7CisgICAgICAg
IH0KKyAgICB9CisgICAgZWxzZSBpZiAoICh4ZW5fcGF0aCAmJiAheGVuX3JlZykgfHwgKHhlbl9y
ZWcgJiYgIXhlbl9wYXRoICYmICF4ZW5fZm9yY2UpICkKKyAgICB7CisgICAgICAgIHByaW50ayhY
RU5MT0dfRVJSICJ4ZW4scmVnIG9yIHhlbixwYXRoIG1pc3NpbmcgZm9yICVwZFxuIiwKKyAgICAg
ICAgICAgICAgIGtpbmZvLT5kKTsKKyAgICAgICAgcmV0dXJuIC1FSU5WQUw7CiAgICAgfQogCiAg
ICAgLyogRkRUX0VSUl9OT1RGT1VORCA9PiBUaGVyZSBpcyBubyBtb3JlIHByb3BlcnRpZXMgZm9y
IHRoaXMgbm9kZSAqLwpAQCAtMjI5MSw2ICsyNDI3LDkgQEAgdm9pZCBfX2luaXQgY3JlYXRlX2Rv
bVVzKHZvaWQpCiAgICAgICAgICAgICBwYW5pYygiTWlzc2luZyBwcm9wZXJ0eSAnY3B1cycgZm9y
IGRvbWFpbiAlc1xuIiwKICAgICAgICAgICAgICAgICAgIGR0X25vZGVfbmFtZShub2RlKSk7CiAK
KyAgICAgICAgaWYgKCBkdF9maW5kX2NvbXBhdGlibGVfbm9kZShub2RlLCBOVUxMLCAibXVsdGli
b290LGRldmljZS10cmVlIikgKQorICAgICAgICAgICAgZF9jZmcuZmxhZ3MgfD0gWEVOX0RPTUNU
TF9DREZfaW9tbXU7CisKICAgICAgICAgZCA9IGRvbWFpbl9jcmVhdGUoKyttYXhfaW5pdF9kb21p
ZCwgJmRfY2ZnLCBmYWxzZSk7CiAgICAgICAgIGlmICggSVNfRVJSKGQpICkKICAgICAgICAgICAg
IHBhbmljKCJFcnJvciBjcmVhdGluZyBkb21haW4gJXNcbiIsIGR0X25vZGVfbmFtZShub2RlKSk7
Ci0tIAoyLjE3LjEKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9y
ZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

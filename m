Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id DD8F4158166
	for <lists+xen-devel@lfdr.de>; Mon, 10 Feb 2020 18:31:48 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1j1Crv-0006aN-B2; Mon, 10 Feb 2020 17:29:11 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=rnvo=36=citrix.com=roger.pau@srs-us1.protection.inumbo.net>)
 id 1j1Crt-0006ZT-Le
 for xen-devel@lists.xenproject.org; Mon, 10 Feb 2020 17:29:09 +0000
X-Inumbo-ID: d2679eba-4c2a-11ea-b4ed-12813bfff9fa
Received: from esa1.hc3370-68.iphmx.com (unknown [216.71.145.142])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id d2679eba-4c2a-11ea-b4ed-12813bfff9fa;
 Mon, 10 Feb 2020 17:28:59 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1581355740;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=bIMAq1yeMBtAgkd79KPlvwPCVQkChFAp60hma01yb5w=;
 b=DSv14XJztfr9A+o7mQ5deEh7HaQpuwP3THQzbyH0cVmNe56/vfGLYlJZ
 fNUn7mOzJ3bkx6ovhXLrjNn+ZF+oCErtv2bxmwSnvCqSYad1k+FujRAgB
 smosMmGQFUq5hQkW+iI99EZsT1Iim5bchtd+f4DtiKOibMiHwqzT1X5xr o=;
Authentication-Results: esa1.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=roger.pau@citrix.com;
 spf=Pass smtp.mailfrom=roger.pau@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa1.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 roger.pau@citrix.com) identity=pra; client-ip=162.221.158.21;
 receiver=esa1.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="roger.pau@citrix.com"; x-conformance=sidf_compatible
Received-SPF: Pass (esa1.hc3370-68.iphmx.com: domain of
 roger.pau@citrix.com designates 162.221.158.21 as permitted
 sender) identity=mailfrom; client-ip=162.221.158.21;
 receiver=esa1.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="roger.pau@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83
 ip4:168.245.78.127 ~all"
Received-SPF: None (esa1.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa1.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: 270QI1vtSaiLdii97ZC2lBN19TScALVTmvuZmzKPExK4jlV9VB04mdrar8axyCssnPWxg+JSn4
 0bNYWMDsqXTxi2PX6wSU1TIWuZscbUs6nRf2YR1UyMzmS6sLMfl0s+R9MCrl1t42ahCJTSv7nJ
 gmyfR0PeYQj11nIsdlDOUGuc2AuFtHOdIt4/OQeGgNVpxPKQETpkIc6HQ82L+lNnR+JF+lGLzI
 hES29SU+IXaOeImlBvzInL5Hy9uin9JO7pka1cJu76ajhmEDuyu6nmC0wztMoOv1yTQ4CRl/hc
 V6U=
X-SBRS: 2.7
X-MesageID: 12394562
X-Ironport-Server: esa1.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.70,425,1574139600"; d="scan'208";a="12394562"
From: Roger Pau Monne <roger.pau@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Mon, 10 Feb 2020 18:28:26 +0100
Message-ID: <20200210172829.43604-5-roger.pau@citrix.com>
X-Mailer: git-send-email 2.25.0
In-Reply-To: <20200210172829.43604-1-roger.pau@citrix.com>
References: <20200210172829.43604-1-roger.pau@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v4 4/7] x86/tlb: introduce a flush guests TLB
 flag
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Wei Liu <wl@xen.org>, George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>, Tim Deegan <tim@xen.org>,
 Jan Beulich <jbeulich@suse.com>, Roger Pau Monne <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SW50cm9kdWNlIGEgc3BlY2lmaWMgZmxhZyB0byByZXF1ZXN0IGEgSFZNIGd1ZXN0IFRMQiBmbHVz
aCwgd2hpY2ggaXMKYW4gQVNJRC9WUElEIHRpY2tsZSB0aGF0IGZvcmNlcyBhIGxpbmVhciBUTEIg
Zmx1c2ggZm9yIGFsbCBIVk0gZ3Vlc3RzLgoKVGhpcyB3YXMgcHJldmlvdXNseSB1bmNvbmRpdGlv
bmFsbHkgZG9uZSBpbiBlYWNoIHByZV9mbHVzaCBjYWxsLCBidXQKdGhhdCdzIG5vdCByZXF1aXJl
ZDogSFZNIGd1ZXN0cyBub3QgdXNpbmcgc2hhZG93IGRvbid0IHJlcXVpcmUgbGluZWFyClRMQiBm
bHVzaGVzIGFzIFhlbiBkb2Vzbid0IG1vZGlmeSB0aGUgZ3Vlc3QgcGFnZSB0YWJsZXMgaW4gdGhh
dCBjYXNlCihpZTogd2hlbiB1c2luZyBIQVApLgoKTW9kaWZ5IGFsbCBzaGFkb3cgY29kZSBUTEIg
Zmx1c2hlcyB0byBhbHNvIGZsdXNoIHRoZSBndWVzdCBUTEIsIGluCm9yZGVyIHRvIGtlZXAgdGhl
IHByZXZpb3VzIGJlaGF2aW9yLiBJIGhhdmVuJ3QgbG9va2VkIGF0IGVhY2ggc3BlY2lmaWMKc2hh
ZG93IGNvZGUgVExCIGZsdXNoIGluIG9yZGVyIHRvIGZpZ3VyZSBvdXQgd2hldGhlciBpdCBhY3R1
YWxseQpyZXF1aXJlcyBhIGd1ZXN0IFRMQiBmbHVzaCBvciBub3QsIHNvIHRoZXJlIG1pZ2h0IGJl
IHJvb20gZm9yCmltcHJvdmVtZW50IGluIHRoYXQgcmVnYXJkLgoKU2lnbmVkLW9mZi1ieTogUm9n
ZXIgUGF1IE1vbm7DqSA8cm9nZXIucGF1QGNpdHJpeC5jb20+ClJldmlld2VkLWJ5OiBXZWkgTGl1
IDx3bEB4ZW4ub3JnPgotLS0KIHhlbi9hcmNoL3g4Ni9mbHVzaHRsYi5jICAgICAgICAgfCAgNSAr
KystLQogeGVuL2FyY2gveDg2L21tL3NoYWRvdy9jb21tb24uYyB8IDE4ICsrKysrKysrKy0tLS0t
LS0tLQogeGVuL2FyY2gveDg2L21tL3NoYWRvdy9odm0uYyAgICB8ICAyICstCiB4ZW4vYXJjaC94
ODYvbW0vc2hhZG93L211bHRpLmMgIHwgMTYgKysrKysrKystLS0tLS0tLQogeGVuL2luY2x1ZGUv
YXNtLXg4Ni9mbHVzaHRsYi5oICB8ICAyICsrCiA1IGZpbGVzIGNoYW5nZWQsIDIzIGluc2VydGlv
bnMoKyksIDIwIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9mbHVzaHRs
Yi5jIGIveGVuL2FyY2gveDg2L2ZsdXNodGxiLmMKaW5kZXggMDNmOTJjMjNkYy4uZTdjY2Q0ZWM3
YiAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L2ZsdXNodGxiLmMKKysrIGIveGVuL2FyY2gveDg2
L2ZsdXNodGxiLmMKQEAgLTU5LDggKzU5LDYgQEAgc3RhdGljIHUzMiBwcmVfZmx1c2godm9pZCkK
ICAgICAgICAgcmFpc2Vfc29mdGlycShORVdfVExCRkxVU0hfQ0xPQ0tfUEVSSU9EX1NPRlRJUlEp
OwogCiAgc2tpcF9jbG9ja3RpY2s6Ci0gICAgaHZtX2ZsdXNoX2d1ZXN0X3RsYnMoKTsKLQogICAg
IHJldHVybiB0MjsKIH0KIApAQCAtMjIxLDYgKzIxOSw5IEBAIHVuc2lnbmVkIGludCBmbHVzaF9h
cmVhX2xvY2FsKGNvbnN0IHZvaWQgKnZhLCB1bnNpZ25lZCBpbnQgZmxhZ3MpCiAgICAgICAgICAg
ICBkb190bGJfZmx1c2goKTsKICAgICB9CiAKKyAgICBpZiAoIGZsYWdzICYgRkxVU0hfR1VFU1RT
X1RMQiApCisgICAgICAgIGh2bV9mbHVzaF9ndWVzdF90bGJzKCk7CisKICAgICBpZiAoIGZsYWdz
ICYgRkxVU0hfQ0FDSEUgKQogICAgIHsKICAgICAgICAgY29uc3Qgc3RydWN0IGNwdWluZm9feDg2
ICpjID0gJmN1cnJlbnRfY3B1X2RhdGE7CmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvbW0vc2hh
ZG93L2NvbW1vbi5jIGIveGVuL2FyY2gveDg2L21tL3NoYWRvdy9jb21tb24uYwppbmRleCBlZTkw
ZTU1YjQxLi4yYTg1ZTEwMTEyIDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYvbW0vc2hhZG93L2Nv
bW1vbi5jCisrKyBiL3hlbi9hcmNoL3g4Ni9tbS9zaGFkb3cvY29tbW9uLmMKQEAgLTM2Myw3ICsz
NjMsNyBAQCBzdGF0aWMgaW50IG9vc19yZW1vdmVfd3JpdGVfYWNjZXNzKHN0cnVjdCB2Y3B1ICp2
LCBtZm5fdCBnbWZuLAogICAgIH0KIAogICAgIGlmICggZnRsYiApCi0gICAgICAgIGZsdXNoX3Rs
Yl9tYXNrKGQtPmRpcnR5X2NwdW1hc2spOworICAgICAgICBmbHVzaF9tYXNrKGQtPmRpcnR5X2Nw
dW1hc2ssIEZMVVNIX1RMQiB8IEZMVVNIX0dVRVNUU19UTEIpOwogCiAgICAgcmV0dXJuIDA7CiB9
CkBAIC05MzksNyArOTM5LDcgQEAgc3RhdGljIHZvaWQgX3NoYWRvd19wcmVhbGxvYyhzdHJ1Y3Qg
ZG9tYWluICpkLCB1bnNpZ25lZCBpbnQgcGFnZXMpCiAgICAgICAgICAgICAgICAgLyogU2VlIGlm
IHRoYXQgZnJlZWQgdXAgZW5vdWdoIHNwYWNlICovCiAgICAgICAgICAgICAgICAgaWYgKCBkLT5h
cmNoLnBhZ2luZy5zaGFkb3cuZnJlZV9wYWdlcyA+PSBwYWdlcyApCiAgICAgICAgICAgICAgICAg
ewotICAgICAgICAgICAgICAgICAgICBmbHVzaF90bGJfbWFzayhkLT5kaXJ0eV9jcHVtYXNrKTsK
KyAgICAgICAgICAgICAgICAgICAgZmx1c2hfbWFzayhkLT5kaXJ0eV9jcHVtYXNrLCBGTFVTSF9U
TEIgfCBGTFVTSF9HVUVTVFNfVExCKTsKICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAg
ICAgICAgICAgICAgIH0KICAgICAgICAgICAgIH0KQEAgLTk5Myw3ICs5OTMsNyBAQCBzdGF0aWMg
dm9pZCBzaGFkb3dfYmxvd190YWJsZXMoc3RydWN0IGRvbWFpbiAqZCkKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBwYWdldGFibGVfZ2V0X21mbih2LT5hcmNoLnNoYWRvd190YWJsZVtp
XSksIDApOwogCiAgICAgLyogTWFrZSBzdXJlIGV2ZXJ5b25lIHNlZXMgdGhlIHVuc2hhZG93aW5n
cyAqLwotICAgIGZsdXNoX3RsYl9tYXNrKGQtPmRpcnR5X2NwdW1hc2spOworICAgIGZsdXNoX21h
c2soZC0+ZGlydHlfY3B1bWFzaywgRkxVU0hfVExCIHwgRkxVU0hfR1VFU1RTX1RMQik7CiB9CiAK
IHZvaWQgc2hhZG93X2Jsb3dfdGFibGVzX3Blcl9kb21haW4oc3RydWN0IGRvbWFpbiAqZCkKQEAg
LTExMDIsNyArMTEwMiw3IEBAIG1mbl90IHNoYWRvd19hbGxvYyhzdHJ1Y3QgZG9tYWluICpkLAog
ICAgICAgICBpZiAoIHVubGlrZWx5KCFjcHVtYXNrX2VtcHR5KCZtYXNrKSkgKQogICAgICAgICB7
CiAgICAgICAgICAgICBwZXJmY19pbmNyKHNoYWRvd19hbGxvY190bGJmbHVzaCk7Ci0gICAgICAg
ICAgICBmbHVzaF90bGJfbWFzaygmbWFzayk7CisgICAgICAgICAgICBmbHVzaF9tYXNrKCZtYXNr
LCBGTFVTSF9UTEIgfCBGTFVTSF9HVUVTVFNfVExCKTsKICAgICAgICAgfQogICAgICAgICAvKiBO
b3cgc2FmZSB0byBjbGVhciB0aGUgcGFnZSBmb3IgcmV1c2UgKi8KICAgICAgICAgY2xlYXJfZG9t
YWluX3BhZ2UocGFnZV90b19tZm4oc3ApKTsKQEAgLTIyOTAsNyArMjI5MCw3IEBAIHZvaWQgc2hf
cmVtb3ZlX3NoYWRvd3Moc3RydWN0IGRvbWFpbiAqZCwgbWZuX3QgZ21mbiwgaW50IGZhc3QsIGlu
dCBhbGwpCiAKICAgICAvKiBOZWVkIHRvIGZsdXNoIFRMQnMgbm93LCBzbyB0aGF0IGxpbmVhciBt
YXBzIGFyZSBzYWZlIG5leHQgdGltZSB3ZQogICAgICAqIHRha2UgYSBmYXVsdC4gKi8KLSAgICBm
bHVzaF90bGJfbWFzayhkLT5kaXJ0eV9jcHVtYXNrKTsKKyAgICBmbHVzaF9tYXNrKGQtPmRpcnR5
X2NwdW1hc2ssIEZMVVNIX1RMQiB8IEZMVVNIX0dVRVNUU19UTEIpOwogCiAgICAgcGFnaW5nX3Vu
bG9jayhkKTsKIH0KQEAgLTMwMDUsNyArMzAwNSw3IEBAIHN0YXRpYyB2b2lkIHNoX3Vuc2hhZG93
X2Zvcl9wMm1fY2hhbmdlKHN0cnVjdCBkb21haW4gKmQsIHVuc2lnbmVkIGxvbmcgZ2ZuLAogICAg
ICAgICB7CiAgICAgICAgICAgICBzaF9yZW1vdmVfYWxsX3NoYWRvd3NfYW5kX3BhcmVudHMoZCwg
bWZuKTsKICAgICAgICAgICAgIGlmICggc2hfcmVtb3ZlX2FsbF9tYXBwaW5ncyhkLCBtZm4sIF9n
Zm4oZ2ZuKSkgKQotICAgICAgICAgICAgICAgIGZsdXNoX3RsYl9tYXNrKGQtPmRpcnR5X2NwdW1h
c2spOworICAgICAgICAgICAgICAgIGZsdXNoX21hc2soZC0+ZGlydHlfY3B1bWFzaywgRkxVU0hf
VExCIHwgRkxVU0hfR1VFU1RTX1RMQik7CiAgICAgICAgIH0KICAgICB9CiAKQEAgLTMwNDUsNyAr
MzA0NSw3IEBAIHN0YXRpYyB2b2lkIHNoX3Vuc2hhZG93X2Zvcl9wMm1fY2hhbmdlKHN0cnVjdCBk
b21haW4gKmQsIHVuc2lnbmVkIGxvbmcgZ2ZuLAogICAgICAgICAgICAgICAgIH0KICAgICAgICAg
ICAgICAgICBvbWZuID0gbWZuX2FkZChvbWZuLCAxKTsKICAgICAgICAgICAgIH0KLSAgICAgICAg
ICAgIGZsdXNoX3RsYl9tYXNrKCZmbHVzaG1hc2spOworICAgICAgICAgICAgZmx1c2hfbWFzaygm
Zmx1c2htYXNrLCBGTFVTSF9UTEIgfCBGTFVTSF9HVUVTVFNfVExCKTsKIAogICAgICAgICAgICAg
aWYgKCBucHRlICkKICAgICAgICAgICAgICAgICB1bm1hcF9kb21haW5fcGFnZShucHRlKTsKQEAg
LTMzMzIsNyArMzMzMiw3IEBAIGludCBzaGFkb3dfdHJhY2tfZGlydHlfdnJhbShzdHJ1Y3QgZG9t
YWluICpkLAogICAgICAgICB9CiAgICAgfQogICAgIGlmICggZmx1c2hfdGxiICkKLSAgICAgICAg
Zmx1c2hfdGxiX21hc2soZC0+ZGlydHlfY3B1bWFzayk7CisgICAgICAgIGZsdXNoX21hc2soZC0+
ZGlydHlfY3B1bWFzaywgRkxVU0hfVExCIHwgRkxVU0hfR1VFU1RTX1RMQik7CiAgICAgZ290byBv
dXQ7CiAKIG91dF9zbDFtYToKQEAgLTM0MDIsNyArMzQwMiw3IEBAIGJvb2wgc2hhZG93X2ZsdXNo
X3RsYihib29sICgqZmx1c2hfdmNwdSkodm9pZCAqY3R4dCwgc3RydWN0IHZjcHUgKnYpLAogICAg
IH0KIAogICAgIC8qIEZsdXNoIFRMQnMgb24gYWxsIENQVXMgd2l0aCBkaXJ0eSB2Y3B1IHN0YXRl
LiAqLwotICAgIGZsdXNoX3RsYl9tYXNrKG1hc2spOworICAgIGZsdXNoX21hc2sobWFzaywgRkxV
U0hfVExCIHwgRkxVU0hfR1VFU1RTX1RMQik7CiAKICAgICAvKiBEb25lLiAqLwogICAgIGZvcl9l
YWNoX3ZjcHUgKCBkLCB2ICkKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9tbS9zaGFkb3cvaHZt
LmMgYi94ZW4vYXJjaC94ODYvbW0vc2hhZG93L2h2bS5jCmluZGV4IGEyMTkyNjZmYTIuLjY0MDc3
ZDE4MWIgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9tbS9zaGFkb3cvaHZtLmMKKysrIGIveGVu
L2FyY2gveDg2L21tL3NoYWRvdy9odm0uYwpAQCAtNTkwLDcgKzU5MCw3IEBAIHN0YXRpYyB2b2lk
IHZhbGlkYXRlX2d1ZXN0X3B0X3dyaXRlKHN0cnVjdCB2Y3B1ICp2LCBtZm5fdCBnbWZuLAogCiAg
ICAgaWYgKCByYyAmIFNIQURPV19TRVRfRkxVU0ggKQogICAgICAgICAvKiBOZWVkIHRvIGZsdXNo
IFRMQnMgdG8gcGljayB1cCBzaGFkb3cgUFQgY2hhbmdlcyAqLwotICAgICAgICBmbHVzaF90bGJf
bWFzayhkLT5kaXJ0eV9jcHVtYXNrKTsKKyAgICAgICAgZmx1c2hfbWFzayhkLT5kaXJ0eV9jcHVt
YXNrLCBGTFVTSF9UTEIgfCBGTFVTSF9HVUVTVFNfVExCKTsKIAogICAgIGlmICggcmMgJiBTSEFE
T1dfU0VUX0VSUk9SICkKICAgICB7CmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvbW0vc2hhZG93
L211bHRpLmMgYi94ZW4vYXJjaC94ODYvbW0vc2hhZG93L211bHRpLmMKaW5kZXggMjY3OThiMzE3
Yy4uMjJhZWI5N2IxZSAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L21tL3NoYWRvdy9tdWx0aS5j
CisrKyBiL3hlbi9hcmNoL3g4Ni9tbS9zaGFkb3cvbXVsdGkuYwpAQCAtMzA2Niw3ICszMDY2LDcg
QEAgc3RhdGljIGludCBzaF9wYWdlX2ZhdWx0KHN0cnVjdCB2Y3B1ICp2LAogICAgICAgICBwZXJm
Y19pbmNyKHNoYWRvd19ybV93cml0ZV9mbHVzaF90bGIpOwogICAgICAgICBzbXBfd21iKCk7CiAg
ICAgICAgIGF0b21pY19pbmMoJmQtPmFyY2gucGFnaW5nLnNoYWRvdy5ndGFibGVfZGlydHlfdmVy
c2lvbik7Ci0gICAgICAgIGZsdXNoX3RsYl9tYXNrKGQtPmRpcnR5X2NwdW1hc2spOworICAgICAg
ICBmbHVzaF9tYXNrKGQtPmRpcnR5X2NwdW1hc2ssIEZMVVNIX1RMQiB8IEZMVVNIX0dVRVNUU19U
TEIpOwogICAgIH0KIAogI2lmIChTSEFET1dfT1BUSU1JWkFUSU9OUyAmIFNIT1BUX09VVF9PRl9T
WU5DKQpAQCAtMzU3NSw3ICszNTc1LDcgQEAgc3RhdGljIGJvb2wgc2hfaW52bHBnKHN0cnVjdCB2
Y3B1ICp2LCB1bnNpZ25lZCBsb25nIGxpbmVhcikKICAgICBpZiAoIG1mbl90b19wYWdlKHNsMW1m
biktPnUuc2gudHlwZQogICAgICAgICAgPT0gU0hfdHlwZV9mbDFfc2hhZG93ICkKICAgICB7Ci0g
ICAgICAgIGZsdXNoX3RsYl9sb2NhbCgpOworICAgICAgICBmbHVzaF9sb2NhbChGTFVTSF9UTEIg
fCBGTFVTSF9HVUVTVFNfVExCKTsKICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgIH0KIApAQCAt
MzgxMCw3ICszODEwLDcgQEAgc2hfdXBkYXRlX2xpbmVhcl9lbnRyaWVzKHN0cnVjdCB2Y3B1ICp2
KQogICAgICAgICAgKiB0YWJsZSBlbnRyeS4gQnV0LCB3aXRob3V0IHRoaXMgY2hhbmdlLCBpdCB3
b3VsZCBmZXRjaCB0aGUgd3JvbmcKICAgICAgICAgICogdmFsdWUgZHVlIHRvIGEgc3RhbGUgVExC
LgogICAgICAgICAgKi8KLSAgICAgICAgZmx1c2hfdGxiX2xvY2FsKCk7CisgICAgICAgIGZsdXNo
X2xvY2FsKEZMVVNIX1RMQiB8IEZMVVNIX0dVRVNUU19UTEIpOwogICAgIH0KIH0KIApAQCAtNDAx
MSw3ICs0MDExLDcgQEAgc2hfdXBkYXRlX2NyMyhzdHJ1Y3QgdmNwdSAqdiwgaW50IGRvX2xvY2tp
bmcsIGJvb2wgbm9mbHVzaCkKICAgICAgKiAob2xkKSBzaGFkb3cgbGluZWFyIG1hcHMgaW4gdGhl
IHdyaXRlYWJsZSBtYXBwaW5nIGhldXJpc3RpY3MuICovCiAjaWYgR1VFU1RfUEFHSU5HX0xFVkVM
UyA9PSAyCiAgICAgaWYgKCBzaF9yZW1vdmVfd3JpdGVfYWNjZXNzKGQsIGdtZm4sIDIsIDApICE9
IDAgKQotICAgICAgICBmbHVzaF90bGJfbWFzayhkLT5kaXJ0eV9jcHVtYXNrKTsKKyAgICAgICAg
Zmx1c2hfbWFzayhkLT5kaXJ0eV9jcHVtYXNrLCBGTFVTSF9UTEIgfCBGTFVTSF9HVUVTVFNfVExC
KTsKICAgICBzaF9zZXRfdG9wbGV2ZWxfc2hhZG93KHYsIDAsIGdtZm4sIFNIX3R5cGVfbDJfc2hh
ZG93KTsKICNlbGlmIEdVRVNUX1BBR0lOR19MRVZFTFMgPT0gMwogICAgIC8qIFBBRSBndWVzdHMg
aGF2ZSBmb3VyIHNoYWRvd190YWJsZSBlbnRyaWVzLCBiYXNlZCBvbiB0aGUKQEAgLTQwMzUsNyAr
NDAzNSw3IEBAIHNoX3VwZGF0ZV9jcjMoc3RydWN0IHZjcHUgKnYsIGludCBkb19sb2NraW5nLCBi
b29sIG5vZmx1c2gpCiAgICAgICAgICAgICB9CiAgICAgICAgIH0KICAgICAgICAgaWYgKCBmbHVz
aCApCi0gICAgICAgICAgICBmbHVzaF90bGJfbWFzayhkLT5kaXJ0eV9jcHVtYXNrKTsKKyAgICAg
ICAgICAgIGZsdXNoX21hc2soZC0+ZGlydHlfY3B1bWFzaywgRkxVU0hfVExCIHwgRkxVU0hfR1VF
U1RTX1RMQik7CiAgICAgICAgIC8qIE5vdyBpbnN0YWxsIHRoZSBuZXcgc2hhZG93cy4gKi8KICAg
ICAgICAgZm9yICggaSA9IDA7IGkgPCA0OyBpKysgKQogICAgICAgICB7CkBAIC00MDU2LDcgKzQw
NTYsNyBAQCBzaF91cGRhdGVfY3IzKHN0cnVjdCB2Y3B1ICp2LCBpbnQgZG9fbG9ja2luZywgYm9v
bCBub2ZsdXNoKQogICAgIH0KICNlbGlmIEdVRVNUX1BBR0lOR19MRVZFTFMgPT0gNAogICAgIGlm
ICggc2hfcmVtb3ZlX3dyaXRlX2FjY2VzcyhkLCBnbWZuLCA0LCAwKSAhPSAwICkKLSAgICAgICAg
Zmx1c2hfdGxiX21hc2soZC0+ZGlydHlfY3B1bWFzayk7CisgICAgICAgIGZsdXNoX21hc2soZC0+
ZGlydHlfY3B1bWFzaywgRkxVU0hfVExCIHwgRkxVU0hfR1VFU1RTX1RMQik7CiAgICAgc2hfc2V0
X3RvcGxldmVsX3NoYWRvdyh2LCAwLCBnbWZuLCBTSF90eXBlX2w0X3NoYWRvdyk7CiAgICAgaWYg
KCAhc2hhZG93X21vZGVfZXh0ZXJuYWwoZCkgJiYgIWlzX3B2XzMyYml0X2RvbWFpbihkKSApCiAg
ICAgewpAQCAtNDUwMiw3ICs0NTAyLDcgQEAgc3RhdGljIHZvaWQgc2hfcGFnZXRhYmxlX2R5aW5n
KHBhZGRyX3QgZ3BhKQogICAgICAgICB9CiAgICAgfQogICAgIGlmICggZmx1c2ggKQotICAgICAg
ICBmbHVzaF90bGJfbWFzayhkLT5kaXJ0eV9jcHVtYXNrKTsKKyAgICAgICAgZmx1c2hfbWFzayhk
LT5kaXJ0eV9jcHVtYXNrLCBGTFVTSF9UTEIgfCBGTFVTSF9HVUVTVFNfVExCKTsKIAogICAgIC8q
IFJlbWVtYmVyIHRoYXQgd2UndmUgc2VlbiB0aGUgZ3Vlc3QgdXNlIHRoaXMgaW50ZXJmYWNlLCBz
byB3ZQogICAgICAqIGNhbiByZWx5IG9uIGl0IHVzaW5nIGl0IGluIGZ1dHVyZSwgaW5zdGVhZCBv
ZiBndWVzc2luZyBhdApAQCAtNDUzOSw3ICs0NTM5LDcgQEAgc3RhdGljIHZvaWQgc2hfcGFnZXRh
YmxlX2R5aW5nKHBhZGRyX3QgZ3BhKQogICAgICAgICBtZm5fdG9fcGFnZShnbWZuKS0+cGFnZXRh
YmxlX2R5aW5nID0gdHJ1ZTsKICAgICAgICAgc2hhZG93X3VuaG9va19tYXBwaW5ncyhkLCBzbWZu
LCAxLyogdXNlciBwYWdlcyBvbmx5ICovKTsKICAgICAgICAgLyogTm93IGZsdXNoIHRoZSBUTEI6
IHdlIHJlbW92ZWQgdG9wbGV2ZWwgbWFwcGluZ3MuICovCi0gICAgICAgIGZsdXNoX3RsYl9tYXNr
KGQtPmRpcnR5X2NwdW1hc2spOworICAgICAgICBmbHVzaF9tYXNrKGQtPmRpcnR5X2NwdW1hc2ss
IEZMVVNIX1RMQiB8IEZMVVNIX0dVRVNUU19UTEIpOwogICAgIH0KIAogICAgIC8qIFJlbWVtYmVy
IHRoYXQgd2UndmUgc2VlbiB0aGUgZ3Vlc3QgdXNlIHRoaXMgaW50ZXJmYWNlLCBzbyB3ZQpkaWZm
IC0tZ2l0IGEveGVuL2luY2x1ZGUvYXNtLXg4Ni9mbHVzaHRsYi5oIGIveGVuL2luY2x1ZGUvYXNt
LXg4Ni9mbHVzaHRsYi5oCmluZGV4IDJjZmU0ZTZlOTcuLjA3ZjliYzYxMDMgMTAwNjQ0Ci0tLSBh
L3hlbi9pbmNsdWRlL2FzbS14ODYvZmx1c2h0bGIuaAorKysgYi94ZW4vaW5jbHVkZS9hc20teDg2
L2ZsdXNodGxiLmgKQEAgLTEwNSw2ICsxMDUsOCBAQCB2b2lkIHN3aXRjaF9jcjNfY3I0KHVuc2ln
bmVkIGxvbmcgY3IzLCB1bnNpZ25lZCBsb25nIGNyNCk7CiAjZGVmaW5lIEZMVVNIX1ZDUFVfU1RB
VEUgMHgxMDAwCiAgLyogRmx1c2ggdGhlIHBlci1jcHUgcm9vdCBwYWdlIHRhYmxlICovCiAjZGVm
aW5lIEZMVVNIX1JPT1RfUEdUQkwgMHgyMDAwCisgLyogRmx1c2ggYWxsIEhWTSBndWVzdHMgbGlu
ZWFyIFRMQiAodXNpbmcgQVNJRC9WUElEKSAqLworI2RlZmluZSBGTFVTSF9HVUVTVFNfVExCIDB4
NDAwMAogCiAvKiBGbHVzaCBsb2NhbCBUTEJzL2NhY2hlcy4gKi8KIHVuc2lnbmVkIGludCBmbHVz
aF9hcmVhX2xvY2FsKGNvbnN0IHZvaWQgKnZhLCB1bnNpZ25lZCBpbnQgZmxhZ3MpOwotLSAKMi4y
NS4wCgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVu
LWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6
Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

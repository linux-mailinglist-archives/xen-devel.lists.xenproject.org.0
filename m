Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 6B7FE100A07
	for <lists+xen-devel@lfdr.de>; Mon, 18 Nov 2019 18:15:22 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iWkag-00063c-2n; Mon, 18 Nov 2019 17:13:30 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=vqm6=ZK=citrix.com=anthony.perard@srs-us1.protection.inumbo.net>)
 id 1iWkae-000634-DN
 for xen-devel@lists.xenproject.org; Mon, 18 Nov 2019 17:13:28 +0000
X-Inumbo-ID: b2e61eeb-0a26-11ea-a2db-12813bfff9fa
Received: from esa1.hc3370-68.iphmx.com (unknown [216.71.145.142])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id b2e61eeb-0a26-11ea-a2db-12813bfff9fa;
 Mon, 18 Nov 2019 17:13:13 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1574097194;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=a3skFAd4t1WXNTVyZd0fKvhw//JI7l7pv3gnWT3Cv4k=;
 b=E8mfQJR1UsQphfynKgdnad5BMsX4aTzaLaBo+i9GcPLgrtONwzsy+c8T
 mNaF8FtPotEx3ZPEZ8UOgJgnhADYtEVfZDuYTya+JItTI4d+xB/g2JRSr
 G89V4wYgda3edh+Ocl8GP0nofUS0xlG8289Nmuvg22t4SKbgFZKaFwfms w=;
Authentication-Results: esa1.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=anthony.perard@citrix.com;
 spf=Pass smtp.mailfrom=anthony.perard@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa1.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 anthony.perard@citrix.com) identity=pra;
 client-ip=162.221.158.21; receiver=esa1.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="anthony.perard@citrix.com";
 x-conformance=sidf_compatible
Received-SPF: Pass (esa1.hc3370-68.iphmx.com: domain of
 anthony.perard@citrix.com designates 162.221.158.21 as
 permitted sender) identity=mailfrom;
 client-ip=162.221.158.21; receiver=esa1.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="anthony.perard@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83
 ip4:168.245.78.127 ~all"
Received-SPF: None (esa1.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa1.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: her1wDWF6ZDH/p5/sWQvx9w56QyR9v4HgMk5tJFXc95i7DVjMPeNUwOrb6/j1n56jGP2LUJ04I
 6MRUbMJ9TqLQemUWJiWqvNwo0jVHsdfdBHolBsOBgqEWaoA/+j/8AT07621o9JiOlG7gJ2fHC7
 VVJ/a1L+1tklBPSKYagYdMCnScXmLYkx+2+9kWexxKbnO2HGP6qgQ4qpHmr52ZMOO1V7qb/wVl
 kEMMb9hHdODk0Pz8ru//eDRfvoe+/VI2MpCRmaIYA7Te7tV/bn7N54SgQ2IMbuLWK1d6AYKwyv
 n3M=
X-SBRS: 2.7
X-MesageID: 8592406
X-Ironport-Server: esa1.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.68,320,1569297600"; 
   d="scan'208";a="8592406"
From: Anthony PERARD <anthony.perard@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Mon, 18 Nov 2019 17:13:08 +0000
Message-ID: <20191118171309.1459302-8-anthony.perard@citrix.com>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191118171309.1459302-1-anthony.perard@citrix.com>
References: <20191118171309.1459302-1-anthony.perard@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [XEN PATCH for-4.13 v3 7/7] libxl_qmp: Have a lock for
 QMP socket access
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Anthony PERARD <anthony.perard@citrix.com>,
 Sander Eikelenboom <linux@eikelenboom.it>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Wei Liu <wl@xen.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhpcyBwYXRjaCB3b3JrYXJvdW5kIHRoZSBmYWN0IHRoYXQgaXQncyBub3QgcG9zc2libGUgdG8g
Y29ubmVjdAptdWx0aXBsZSB0aW1lIHRvIGEgc2luZ2xlIFFNUCBzb2NrZXQuIFFFTVUgbGlzdGVu
IG9uIHRoZSBzb2NrZXQgd2l0aAphIGJhY2tsb2cgdmFsdWUgb2YgMSwgd2hpY2ggbWVhbiB0aGF0
IG9uIExpbnV4IHdoZW4gY29uY3VycmVudCB0aHJlYWQKY2FsbCBjb25uZWN0KCkgb24gdGhlIHNv
Y2tldCwgdGhleSBnZXQgRUFHQUlOLgoKQmFja2dyb3VuZDoKICAgIFRoaXMgaGFwcGVucyB3aGVu
IGF0dGVtcHRpbmcgdG8gY3JlYXRlIGEgZ3Vlc3Qgd2l0aCBtdWx0aXBsZQogICAgcGNpIGRldmlj
ZXMgcGFzc3Rocm91Z2gsIGxpYnhsIGNyZWF0ZXMgb25lIGNvbm5lY3Rpb24gcGVyIGRldmljZSB0
bwogICAgYXR0YWNoIGFuZCBleGVjdXRlIGNvbm5lY3QoKSBvbiBhbGwgYXQgb25jZSBiZWZvcmUg
YW55IHNpbmdsZQogICAgY29ubmVjdGlvbiBoYXMgZmluaXNoZWQuCgpUbyB3b3JrIGFyb3VuZCB0
aGlzLCB3ZSB1c2UgYSBuZXcgbG9jay4KClJlcG9ydGVkLWJ5OiBTYW5kZXIgRWlrZWxlbmJvb20g
PGxpbnV4QGVpa2VsZW5ib29tLml0PgpTaWduZWQtb2ZmLWJ5OiBBbnRob255IFBFUkFSRCA8YW50
aG9ueS5wZXJhcmRAY2l0cml4LmNvbT4KLS0tCgpOb3RlczoKICAgIHYzOgogICAgLSBVc2UgbmV3
IGxpYnhsX2V2X2ltbWVkaWF0ZSBpbiBxbXBfZXZfY29ubmVjdCdzIGNhbGxiYWNrcyBlcnJvciBw
YXRoLgogICAgLSBBZGQgYGxvY2snIHN0YXRlIGludG8gdGhlIGludGVybmFsIHN0YXRlIHRhYmxl
LgogICAgICBBbmQgYWRkIGNvbW1lbnRzIGFib3V0IHN0YXRlIGNoYW5nZXMgdG8gdGhlIG5ldyBm
dW5jdGlvbnMuCiAgICAKICAgIHYyOgogICAgLSBIYW5kbGUgZXJyb3IgcGF0aAoKIHRvb2xzL2xp
YnhsL2xpYnhsX2ludGVybmFsLmMgfCAgIDUgKysKIHRvb2xzL2xpYnhsL2xpYnhsX2ludGVybmFs
LmggfCAgIDkgKysrCiB0b29scy9saWJ4bC9saWJ4bF9xbXAuYyAgICAgIHwgMTE4ICsrKysrKysr
KysrKysrKysrKysrKysrKysrKy0tLS0tLS0tCiAzIGZpbGVzIGNoYW5nZWQsIDEwNyBpbnNlcnRp
b25zKCspLCAyNSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS90b29scy9saWJ4bC9saWJ4bF9p
bnRlcm5hbC5jIGIvdG9vbHMvbGlieGwvbGlieGxfaW50ZXJuYWwuYwppbmRleCBiMjA4NDE1N2U0
Y2QuLmJhNTYzNzM1OGU3YyAxMDA2NDQKLS0tIGEvdG9vbHMvbGlieGwvbGlieGxfaW50ZXJuYWwu
YworKysgYi90b29scy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5jCkBAIC01OTAsNiArNTkwLDExIEBA
IHZvaWQgbGlieGxfX2V2X2RldmxvY2tfaW5pdChsaWJ4bF9fZXZfc2xvd2xvY2sgKmxvY2spCiAg
ICAgZXZfc2xvd2xvY2tfaW5pdF9pbnRlcm5hbChsb2NrLCAibGlieGwtZGV2aWNlLWNoYW5nZXMt
bG9jayIpOwogfQogCit2b2lkIGxpYnhsX19ldl9xbXBsb2NrX2luaXQobGlieGxfX2V2X3Nsb3ds
b2NrICpsb2NrKQoreworICAgIGV2X3Nsb3dsb2NrX2luaXRfaW50ZXJuYWwobG9jaywgInFtcC1z
b2NrZXQtbG9jayIpOworfQorCiBzdGF0aWMgdm9pZCBldl9sb2NrX3ByZXBhcmVfZm9yayhsaWJ4
bF9fZWdjICplZ2MsIGxpYnhsX19ldl9zbG93bG9jayAqbG9jayk7CiBzdGF0aWMgdm9pZCBldl9s
b2NrX2NoaWxkX2NhbGxiYWNrKGxpYnhsX19lZ2MgKmVnYywgbGlieGxfX2V2X2NoaWxkICpjaGls
ZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGlkX3QgcGlkLCBpbnQgc3Rh
dHVzKTsKZGlmZiAtLWdpdCBhL3Rvb2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmggYi90b29scy9s
aWJ4bC9saWJ4bF9pbnRlcm5hbC5oCmluZGV4IDQwMDc1MmE3ZjhmZS4uODk4ODgzMWFlNWY3IDEw
MDY0NAotLS0gYS90b29scy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5oCisrKyBiL3Rvb2xzL2xpYnhs
L2xpYnhsX2ludGVybmFsLmgKQEAgLTM4Niw2ICszODYsOSBAQCB2b2lkIGxpYnhsX19ldl9pbW1l
ZGlhdGVfcmVnaXN0ZXIobGlieGxfX2VnYyAqLCBsaWJ4bF9fZXZfaW1tZWRpYXRlICopOwogICog
d2hpY2ggbWF5IHRha2UgYSBzaWduaWZpY2FudCBhbW91bnQgdGltZS4KICAqIEl0IGlzIHRvIGJl
IGFjcXVpcmVkIGJ5IGFuIGFvIGV2ZW50IGNhbGxiYWNrLgogICoKKyAqIElmIGxpYnhsX19ldl9k
ZXZsb2NrIGlzIG5lZWRlZCwgaXQgc2hvdWxkIGJlIGFjcXVpcmVkIHdoaWxlIGV2ZXJ5CisgKiBs
aWJ4bF9fZXZfcW1wIGFyZSBJZGxlIGZvciB0aGUgY3VycmVudCBkb21haW4uCisgKgogICogSXQg
aXMgdG8gYmUgYWNxdWlyZWQgd2hlbiBhZGRpbmcvcmVtb3ZpbmcgZGV2aWNlcyBvciBtYWtpbmcg
Y2hhbmdlcwogICogdG8gdGhlbSB3aGVuIHRoaXMgaXMgYSBzbG93IG9wZXJhdGlvbiBhbmQganNv
bl9sb2NrIGlzbid0IGFwcHJvcHJpYXRlLgogICoKQEAgLTQyNiw2ICs0MjksNyBAQCBzdHJ1Y3Qg
bGlieGxfX2V2X3Nsb3dsb2NrIHsKICAgICBib29sIGhlbGQ7CiB9OwogX2hpZGRlbiB2b2lkIGxp
YnhsX19ldl9kZXZsb2NrX2luaXQobGlieGxfX2V2X3Nsb3dsb2NrICopOworX2hpZGRlbiB2b2lk
IGxpYnhsX19ldl9xbXBsb2NrX2luaXQobGlieGxfX2V2X3Nsb3dsb2NrICopOwogX2hpZGRlbiB2
b2lkIGxpYnhsX19ldl9zbG93bG9ja19sb2NrKGxpYnhsX19lZ2MgKiwgbGlieGxfX2V2X3Nsb3ds
b2NrICopOwogX2hpZGRlbiB2b2lkIGxpYnhsX19ldl9zbG93bG9ja191bmxvY2sobGlieGxfX2dj
ICosIGxpYnhsX19ldl9zbG93bG9jayAqKTsKIF9oaWRkZW4gdm9pZCBsaWJ4bF9fZXZfc2xvd2xv
Y2tfZGlzcG9zZShsaWJ4bF9fZ2MgKiwgbGlieGxfX2V2X3Nsb3dsb2NrICopOwpAQCAtNDk0LDYg
KzQ5OCw4IEBAIF9oaWRkZW4gdm9pZCBsaWJ4bF9fZXZfcW1wX2Rpc3Bvc2UobGlieGxfX2djICpn
YywgbGlieGxfX2V2X3FtcCAqZXYpOwogdHlwZWRlZiBlbnVtIHsKICAgICAvKiBpbml0aWFsIHN0
YXRlICovCiAgICAgcW1wX3N0YXRlX2Rpc2Nvbm5lY3RlZCA9IDEsCisgICAgLyogd2FpdGluZyBm
b3IgbG9jayAqLworICAgIHFtcF9zdGF0ZV93YWl0aW5nX2xvY2ssCiAgICAgLyogY29ubmVjdGVk
IHRvIFFNUCBzb2NrZXQsIHdhaXRpbmcgZm9yIGdyZWV0aW5nIG1lc3NhZ2UgKi8KICAgICBxbXBf
c3RhdGVfY29ubmVjdGluZywKICAgICAvKiBxbXBfY2FwYWJpbGl0aWVzIGNvbW1hbmQgc2VudCwg
d2FpdGluZyBmb3IgcmVwbHkgKi8KQEAgLTUyNyw2ICs1MzMsOSBAQCBzdHJ1Y3QgbGlieGxfX2V2
X3FtcCB7CiAgICAgbGlieGxfX2NhcmVmZCAqY2ZkOwogICAgIGxpYnhsX19ldl9mZCBlZmQ7CiAg
ICAgbGlieGxfX3FtcF9zdGF0ZSBzdGF0ZTsKKyAgICBsaWJ4bF9fZXZfc2xvd2xvY2sgbG9jazsK
KyAgICBsaWJ4bF9fZXZfaW1tZWRpYXRlIGVpOworICAgIGludCByYzsKICAgICBpbnQgaWQ7CiAg
ICAgaW50IG5leHRfaWQ7ICAgICAgICAvKiBuZXh0IGlkIHRvIHVzZSAqLwogICAgIC8qIHJlY2Vp
dmUgYnVmZmVyICovCmRpZmYgLS1naXQgYS90b29scy9saWJ4bC9saWJ4bF9xbXAuYyBiL3Rvb2xz
L2xpYnhsL2xpYnhsX3FtcC5jCmluZGV4IGYwZTBiNTBiZDFjNS4uYzhlYWMyNTg4YTg5IDEwMDY0
NAotLS0gYS90b29scy9saWJ4bC9saWJ4bF9xbXAuYworKysgYi90b29scy9saWJ4bC9saWJ4bF9x
bXAuYwpAQCAtMTA4MiwxNiArMTA4MiwxNyBAQCBzdGF0aWMgdm9pZCBkbV9zdGF0ZV9zYXZlZChs
aWJ4bF9fZWdjICplZ2MsIGxpYnhsX19ldl9xbXAgKmV2LAogLyoKICAqIFBvc3NpYmxlIGludGVy
bmFsIHN0YXRlIGNvbXBhcmVkIHRvIHFtcF9zdGF0ZToKICAqCi0gKiBxbXBfc3RhdGUgICAgIEV4
dGVybmFsICAgY2ZkICAgIGVmZCAgICAgaWQgICAgIHJ4X2J1ZiogdHhfYnVmKiBtc2cqCi0gKiBk
aXNjb25uZWN0ZWQgICBJZGxlICAgICAgIE5VTEwgICBJZGxlICAgIHJlc2V0ICBmcmVlICAgIGZy
ZWUgICAgZnJlZQotICogY29ubmVjdGluZyAgICAgQWN0aXZlICAgICBvcGVuICAgSU4gICAgICBy
ZXNldCAgdXNlZCAgICBmcmVlICAgIHNldAotICogY2FwLm5lZyAgICAgICAgQWN0aXZlICAgICBv
cGVuICAgSU58T1VUICBzZW50ICAgdXNlZCAgICBjYXBfbmVnIHNldAotICogY2FwLm5lZyAgICAg
ICAgQWN0aXZlICAgICBvcGVuICAgSU4gICAgICBzZW50ICAgdXNlZCAgICBmcmVlICAgIHNldAot
ICogY29ubmVjdGVkICAgICAgQ29ubmVjdGVkICBvcGVuICAgSU4gICAgICBhbnkgICAgdXNlZCAg
ICBmcmVlICAgIGZyZWUKLSAqIHdhaXRpbmdfcmVwbHkgIEFjdGl2ZSAgICAgb3BlbiAgIElOfE9V
VCAgc2VudCAgIHVzZWQgICAgZnJlZSAgICBzZXQKLSAqIHdhaXRpbmdfcmVwbHkgIEFjdGl2ZSAg
ICAgb3BlbiAgIElOfE9VVCAgc2VudCAgIHVzZWQgICAgdXNlcidzICBmcmVlCi0gKiB3YWl0aW5n
X3JlcGx5ICBBY3RpdmUgICAgIG9wZW4gICBJTiAgICAgIHNlbnQgICB1c2VkICAgIGZyZWUgICAg
ZnJlZQotICogYnJva2VuWzFdICAgICAgbm9uZVsyXSAgICBhbnkgICAgQWN0aXZlICBhbnkgICAg
YW55ICAgICBhbnkgICAgIGFueQorICogcW1wX3N0YXRlICAgICBFeHRlcm5hbCAgIGNmZCAgICBl
ZmQgICAgIGlkICAgICByeF9idWYqIHR4X2J1ZiogbXNnKiBsb2NrCisgKiBkaXNjb25uZWN0ZWQg
ICBJZGxlICAgICAgIE5VTEwgICBJZGxlICAgIHJlc2V0ICBmcmVlICAgIGZyZWUgICAgZnJlZSBJ
ZGxlCisgKiB3YWl0aW5nX2xvY2sgICBBY3RpdmUgICAgIG9wZW4gICBJZGxlICAgIHJlc2V0ICB1
c2VkICAgIGZyZWUgICAgc2V0ICBBY3RpdmUKKyAqIGNvbm5lY3RpbmcgICAgIEFjdGl2ZSAgICAg
b3BlbiAgIElOICAgICAgcmVzZXQgIHVzZWQgICAgZnJlZSAgICBzZXQgIEFjcXVpcmVkCisgKiBj
YXAubmVnICAgICAgICBBY3RpdmUgICAgIG9wZW4gICBJTnxPVVQgIHNlbnQgICB1c2VkICAgIGNh
cF9uZWcgc2V0ICBBY3F1aXJlZAorICogY2FwLm5lZyAgICAgICAgQWN0aXZlICAgICBvcGVuICAg
SU4gICAgICBzZW50ICAgdXNlZCAgICBmcmVlICAgIHNldCAgQWNxdWlyZWQKKyAqIGNvbm5lY3Rl
ZCAgICAgIENvbm5lY3RlZCAgb3BlbiAgIElOICAgICAgYW55ICAgIHVzZWQgICAgZnJlZSAgICBm
cmVlIEFjcXVpcmVkCisgKiB3YWl0aW5nX3JlcGx5ICBBY3RpdmUgICAgIG9wZW4gICBJTnxPVVQg
IHNlbnQgICB1c2VkICAgIGZyZWUgICAgc2V0ICBBY3F1aXJlZAorICogd2FpdGluZ19yZXBseSAg
QWN0aXZlICAgICBvcGVuICAgSU58T1VUICBzZW50ICAgdXNlZCAgICB1c2VyJ3MgIGZyZWUgQWNx
dWlyZWQKKyAqIHdhaXRpbmdfcmVwbHkgIEFjdGl2ZSAgICAgb3BlbiAgIElOICAgICAgc2VudCAg
IHVzZWQgICAgZnJlZSAgICBmcmVlIEFjcXVpcmVkCisgKiBicm9rZW5bMV0gICAgICBub25lWzJd
ICAgIGFueSAgICBBY3RpdmUgIGFueSAgICBhbnkgICAgIGFueSAgICAgYW55ICBhbnkKICAqCiAg
KiBbMV0gV2hlbiBhbiBpbnRlcm5hbCBmdW5jdGlvbiByZXR1cm4gYW4gZXJyb3IsIGl0IGNhbiBs
ZWF2ZSBldl9xbXAgaW4gYQogICogYGJyb2tlbmAgc3RhdGUgYnV0IG9ubHkgaWYgdGhlIGNhbGxl
ciBpcyBhbm90aGVyIGludGVybmFsIGZ1bmN0aW9uLgpAQCAtMTExOCw3ICsxMTE5LDggQEAgc3Rh
dGljIHZvaWQgZG1fc3RhdGVfc2F2ZWQobGlieGxfX2VnYyAqZWdjLCBsaWJ4bF9fZXZfcW1wICpl
diwKICAqICAgICBtc2dfaWQgICAgICAgICAgIDAgICAgIGlkIGFzc29jdGlhdGVkIHdpdGggdGhl
IGNvbW1hbmQgaW4gYG1zZ2AKICAqCiAgKiAtIEFsbG93ZWQgaW50ZXJuYWwgc3RhdGUgdHJhbnNp
dGlvbjoKLSAqIGRpc2Nvbm5lY3RlZCAgICAgICAgICAgICAgICAgICAgIC0+IGNvbm5lY3RpbmcK
KyAqIGRpc2Nvbm5lY3RlZCAgICAgICAgICAgICAgICAgICAgIC0+IHdhaXRpbmdfbG9jaworICog
d2FpdGluZ19sb2NrICAgICAgICAgICAgICAgICAgICAgLT4gY29ubmVjdGluZwogICogY29ubmVj
dGlvbiAgICAgICAgICAgICAgICAgICAgICAgLT4gY2FwYWJpbGl0eV9uZWdvdGlhdGlvbgogICog
Y2FwYWJpbGl0eV9uZWdvdGlhdGlvbi9jb25uZWN0ZWQgLT4gd2FpdGluZ19yZXBseQogICogd2Fp
dGluZ19yZXBseSAgICAgICAgICAgICAgICAgICAgLT4gY29ubmVjdGVkCkBAIC0xMTUzLDYgKzEx
NTUsMTAgQEAgc3RhdGljIHZvaWQgcW1wX2V2X2Vuc3VyZV9yZWFkaW5nX3dyaXRpbmcobGlieGxf
X2djICpnYywgbGlieGxfX2V2X3FtcCAqZXYpCiB7CiAgICAgc2hvcnQgZXZlbnRzID0gUE9MTElO
OwogCisgICAgaWYgKGV2LT5zdGF0ZSA9PSBxbXBfc3RhdGVfd2FpdGluZ19sb2NrKQorICAgICAg
ICAvKiBXZSBjYW4ndCBtb2RpZmllIHRoZSBlZmQgeWV0LCBhcyBpdCBpc24ndCByZWdpc3RlcmVk
LiAqLworICAgICAgICByZXR1cm47CisKICAgICBpZiAoZXYtPnR4X2J1ZikKICAgICAgICAgZXZl
bnRzIHw9IFBPTExPVVQ7CiAgICAgZWxzZSBpZiAoKGV2LT5zdGF0ZSA9PSBxbXBfc3RhdGVfd2Fp
dGluZ19yZXBseSkgJiYgZXYtPm1zZykKQEAgLTExNjgsOSArMTE3NCwxMiBAQCBzdGF0aWMgdm9p
ZCBxbXBfZXZfc2V0X3N0YXRlKGxpYnhsX19nYyAqZ2MsIGxpYnhsX19ldl9xbXAgKmV2LAogICAg
IHN3aXRjaCAobmV3X3N0YXRlKSB7CiAgICAgY2FzZSBxbXBfc3RhdGVfZGlzY29ubmVjdGVkOgog
ICAgICAgICBicmVhazsKLSAgICBjYXNlIHFtcF9zdGF0ZV9jb25uZWN0aW5nOgorICAgIGNhc2Ug
cW1wX3N0YXRlX3dhaXRpbmdfbG9jazoKICAgICAgICAgYXNzZXJ0KGV2LT5zdGF0ZSA9PSBxbXBf
c3RhdGVfZGlzY29ubmVjdGVkKTsKICAgICAgICAgYnJlYWs7CisgICAgY2FzZSBxbXBfc3RhdGVf
Y29ubmVjdGluZzoKKyAgICAgICAgYXNzZXJ0KGV2LT5zdGF0ZSA9PSBxbXBfc3RhdGVfd2FpdGlu
Z19sb2NrKTsKKyAgICAgICAgYnJlYWs7CiAgICAgY2FzZSBxbXBfc3RhdGVfY2FwYWJpbGl0eV9u
ZWdvdGlhdGlvbjoKICAgICAgICAgYXNzZXJ0KGV2LT5zdGF0ZSA9PSBxbXBfc3RhdGVfY29ubmVj
dGluZyk7CiAgICAgICAgIGJyZWFrOwpAQCAtMTIzMSwyMCArMTI0MCwyMiBAQCBzdGF0aWMgaW50
IHFtcF9lcnJvcl9jbGFzc190b19saWJ4bF9lcnJvcl9jb2RlKGxpYnhsX19nYyAqZ2MsCiAKIC8q
IFNldHVwIGNvbm5lY3Rpb24gKi8KIAotc3RhdGljIGludCBxbXBfZXZfY29ubmVjdChsaWJ4bF9f
Z2MgKmdjLCBsaWJ4bF9fZXZfcW1wICpldikKLSAgICAvKiBkaXNjb25uZWN0ZWQgLT4gY29ubmVj
dGluZyBidXQgd2l0aCBgbXNnYCBmcmVlCitzdGF0aWMgdm9pZCBxbXBfZXZfbG9ja19hcXVpcmVk
KGxpYnhsX19lZ2MgKiwgbGlieGxfX2V2X3Nsb3dsb2NrICosCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIGludCByYyk7CitzdGF0aWMgdm9pZCBsb2NrX2Vycm9yX2NhbGxiYWNrKGxp
YnhsX19lZ2MgKiwgbGlieGxfX2V2X2ltbWVkaWF0ZSAqKTsKKworc3RhdGljIGludCBxbXBfZXZf
Y29ubmVjdChsaWJ4bF9fZWdjICplZ2MsIGxpYnhsX19ldl9xbXAgKmV2KQorICAgIC8qIGRpc2Nv
bm5lY3RlZCAtPiB3YWl0aW5nX2xvY2svY29ubmVjdGluZyBidXQgd2l0aCBgbXNnYCBmcmVlCiAg
ICAgICogb24gZXJyb3I6IGJyb2tlbiAqLwogeworICAgIEVHQ19HQzsKICAgICBpbnQgZmQ7Ci0g
ICAgaW50IHJjLCByOwotICAgIHN0cnVjdCBzb2NrYWRkcl91biB1bjsKLSAgICBjb25zdCBjaGFy
ICpxbXBfc29ja2V0X3BhdGg7Ci0KLSAgICBhc3NlcnQoZXYtPnN0YXRlID09IHFtcF9zdGF0ZV9k
aXNjb25uZWN0ZWQpOworICAgIGludCByYzsKIAotICAgIHFtcF9zb2NrZXRfcGF0aCA9IGxpYnhs
X19xZW11X3FtcF9wYXRoKGdjLCBldi0+ZG9taWQpOworICAgIC8qIENvbnZlbmllbmNlIGFsaWFz
ZXMgKi8KKyAgICBsaWJ4bF9fZXZfc2xvd2xvY2sgKmxvY2sgPSAmZXYtPmxvY2s7CiAKLSAgICBM
T0dEKERFQlVHLCBldi0+ZG9taWQsICJDb25uZWN0aW5nIHRvICVzIiwgcW1wX3NvY2tldF9wYXRo
KTsKKyAgICBhc3NlcnQoZXYtPnN0YXRlID09IHFtcF9zdGF0ZV9kaXNjb25uZWN0ZWQpOwogCiAg
ICAgbGlieGxfX2NhcmVmZF9iZWdpbigpOwogICAgIGZkID0gc29ja2V0KEFGX1VOSVgsIFNPQ0tf
U1RSRUFNLCAwKTsKQEAgLTEyNTgsNiArMTI2OSwzNiBAQCBzdGF0aWMgaW50IHFtcF9ldl9jb25u
ZWN0KGxpYnhsX19nYyAqZ2MsIGxpYnhsX19ldl9xbXAgKmV2KQogICAgIGlmIChyYykKICAgICAg
ICAgZ290byBvdXQ7CiAKKyAgICBxbXBfZXZfc2V0X3N0YXRlKGdjLCBldiwgcW1wX3N0YXRlX3dh
aXRpbmdfbG9jayk7CisKKyAgICBsb2NrLT5hbyA9IGV2LT5hbzsKKyAgICBsb2NrLT5kb21pZCA9
IGV2LT5kb21pZDsKKyAgICBsb2NrLT5jYWxsYmFjayA9IHFtcF9ldl9sb2NrX2FxdWlyZWQ7Cisg
ICAgbGlieGxfX2V2X3Nsb3dsb2NrX2xvY2soZWdjLCAmZXYtPmxvY2spOworCisgICAgcmV0dXJu
IDA7CisKK291dDoKKyAgICByZXR1cm4gcmM7Cit9CisKK3N0YXRpYyB2b2lkIHFtcF9ldl9sb2Nr
X2FxdWlyZWQobGlieGxfX2VnYyAqZWdjLCBsaWJ4bF9fZXZfc2xvd2xvY2sgKmxvY2ssCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCByYykKKyAgICAvKiB3YWl0aW5nX2xvY2sg
KHdpdGggYGxvY2snIEFjcXVpcmVkKSAtPiBjb25uZWN0aW5nCisgICAgICogb24gZXJyb3I6IGJy
b2tlbiAqLworeworICAgIGxpYnhsX19ldl9xbXAgKmV2ID0gQ09OVEFJTkVSX09GKGxvY2ssICpl
diwgbG9jayk7CisgICAgRUdDX0dDOworICAgIGNvbnN0IGNoYXIgKnFtcF9zb2NrZXRfcGF0aDsK
KyAgICBzdHJ1Y3Qgc29ja2FkZHJfdW4gdW47CisgICAgaW50IHI7CisKKyAgICBpZiAocmMpIGdv
dG8gb3V0OworCisgICAgcW1wX3NvY2tldF9wYXRoID0gbGlieGxfX3FlbXVfcW1wX3BhdGgoZ2Ms
IGV2LT5kb21pZCk7CisKKyAgICBMT0dEKERFQlVHLCBldi0+ZG9taWQsICJDb25uZWN0aW5nIHRv
ICVzIiwgcW1wX3NvY2tldF9wYXRoKTsKKwogICAgIHJjID0gbGlieGxfX3ByZXBhcmVfc29ja2Fk
ZHJfdW4oZ2MsICZ1biwgcW1wX3NvY2tldF9wYXRoLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIlFNUCBzb2NrZXQiKTsKICAgICBpZiAocmMpCkBAIC0xMjc5LDEwICsxMzIw
LDMzIEBAIHN0YXRpYyBpbnQgcW1wX2V2X2Nvbm5lY3QobGlieGxfX2djICpnYywgbGlieGxfX2V2
X3FtcCAqZXYpCiAKICAgICBxbXBfZXZfc2V0X3N0YXRlKGdjLCBldiwgcW1wX3N0YXRlX2Nvbm5l
Y3RpbmcpOwogCi0gICAgcmV0dXJuIDA7CisgICAgcmV0dXJuOwogCiBvdXQ6Ci0gICAgcmV0dXJu
IHJjOworICAgIC8qIEFuIGVycm9yIG9jY3VycmVkIGFuZCB3ZSBuZWVkIHRvIGxldCB0aGUgY2Fs
bGVyIGtub3cuICBBdCB0aGlzCisgICAgICogcG9pbnQsIHdlIGNhbiBvbmx5IGRvIHNvIHZpYSB0
aGUgY2FsbGJhY2suIFVuZm9ydHVuYXRlbHksIHRoZQorICAgICAqIGNhbGxiYWNrIG9mIGxpYnhs
X19ldl9zbG93bG9ja19sb2NrKCkgbWlnaHQgYmUgY2FsbGVkIHN5bmNocm9ub3VzbHksCisgICAg
ICogYnV0IGxpYnhsX19ldl9xbXBfc2VuZCgpIHByb21pc2UgdGhhdCBpdCB3aWxsIG5vdCBjYWxs
IHRoZSBjYWxsYmFjaworICAgICAqIHN5bmNocm9ub3VzbHkuIFNvIHdlIGhhdmUgdG8gYXJyYW5n
ZSB0byBjYWxsIHRoZSBjYWxsYmFjaworICAgICAqIGFzeW5jaHJvbm91c2x5LiAqLworICAgIGV2
LT5yYyA9IHJjOworICAgIGV2LT5laS5jYWxsYmFjayA9IGxvY2tfZXJyb3JfY2FsbGJhY2s7Cisg
ICAgbGlieGxfX2V2X2ltbWVkaWF0ZV9yZWdpc3RlcihlZ2MsICZldi0+ZWkpOworfQorCitzdGF0
aWMgdm9pZCBsb2NrX2Vycm9yX2NhbGxiYWNrKGxpYnhsX19lZ2MgKmVnYywgbGlieGxfX2V2X2lt
bWVkaWF0ZSAqZWkpCisgICAgLyogYnJva2VuIC0+IGRpc2Nvbm5lY3RlZCAqLworeworICAgIEVH
Q19HQzsKKyAgICBsaWJ4bF9fZXZfcW1wICpldiA9IENPTlRBSU5FUl9PRihlaSwgKmV2LCBlaSk7
CisKKyAgICBpbnQgcmMgPSBldi0+cmM7CisKKyAgICAvKiBPbiBlcnJvciwgZGVhbGxvY2F0ZSBh
bGwgcHJpdmF0ZSByZXNvdXJjZXMgKi8KKyAgICBsaWJ4bF9fZXZfcW1wX2Rpc3Bvc2UoZ2MsIGV2
KTsKKworICAgIC8qIEFuZCB0ZWxsIGxpYnhsX19ldl9xbXAgdXNlciBhYm91dCB0aGUgZXJyb3Ig
Ki8KKyAgICBldi0+Y2FsbGJhY2soZWdjLCBldiwgTlVMTCwgcmMpOyAvKiBtdXN0IGJlIGxhc3Qg
Ki8KIH0KIAogLyogUU1QIEZEIGNhbGxiYWNrcyAqLwpAQCAtMTc3OSwxMSArMTg0MywxNCBAQCB2
b2lkIGxpYnhsX19ldl9xbXBfaW5pdChsaWJ4bF9fZXZfcW1wICpldikKICAgICBldi0+cWVtdV92
ZXJzaW9uLm1ham9yID0gLTE7CiAgICAgZXYtPnFlbXVfdmVyc2lvbi5taW5vciA9IC0xOwogICAg
IGV2LT5xZW11X3ZlcnNpb24ubWljcm8gPSAtMTsKKworICAgIGxpYnhsX19ldl9xbXBsb2NrX2lu
aXQoJmV2LT5sb2NrKTsKKyAgICBldi0+cmMgPSAwOwogfQogCiBpbnQgbGlieGxfX2V2X3FtcF9z
ZW5kKGxpYnhsX19lZ2MgKmVnYywgbGlieGxfX2V2X3FtcCAqZXYsCiAgICAgICAgICAgICAgICAg
ICAgICAgIGNvbnN0IGNoYXIgKmNtZCwgbGlieGxfX2pzb25fb2JqZWN0ICphcmdzKQotICAgIC8q
IGRpc2Nvbm5lY3RlZCAtPiBjb25uZWN0aW5nCisgICAgLyogZGlzY29ubmVjdGVkIC0+IHdhaXRp
bmdfbG9jay9jb25uZWN0aW5nCiAgICAgICogY29ubmVjdGVkIC0+IHdhaXRpbmdfcmVwbHkgKHdp
dGggbXNnIHNldCkKICAgICAgKiBvbiBlcnJvcjogZGlzY29ubmVjdGVkICovCiB7CkBAIC0xNzk4
LDcgKzE4NjUsNyBAQCBpbnQgbGlieGxfX2V2X3FtcF9zZW5kKGxpYnhsX19lZ2MgKmVnYywgbGli
eGxfX2V2X3FtcCAqZXYsCiAKICAgICAvKiBDb25uZWN0IHRvIFFFTVUgaWYgbm90IGFscmVhZHkg
Y29ubmVjdGVkICovCiAgICAgaWYgKGV2LT5zdGF0ZSA9PSBxbXBfc3RhdGVfZGlzY29ubmVjdGVk
KSB7Ci0gICAgICAgIHJjID0gcW1wX2V2X2Nvbm5lY3QoZ2MsIGV2KTsKKyAgICAgICAgcmMgPSBx
bXBfZXZfY29ubmVjdChlZ2MsIGV2KTsKICAgICAgICAgaWYgKHJjKQogICAgICAgICAgICAgZ290
byBlcnJvcjsKICAgICB9CkBAIC0xODMwLDYgKzE4OTcsNyBAQCB2b2lkIGxpYnhsX19ldl9xbXBf
ZGlzcG9zZShsaWJ4bF9fZ2MgKmdjLCBsaWJ4bF9fZXZfcW1wICpldikKIAogICAgIGxpYnhsX19l
dl9mZF9kZXJlZ2lzdGVyKGdjLCAmZXYtPmVmZCk7CiAgICAgbGlieGxfX2NhcmVmZF9jbG9zZShl
di0+Y2ZkKTsKKyAgICBsaWJ4bF9fZXZfc2xvd2xvY2tfZGlzcG9zZShnYywgJmV2LT5sb2NrKTsK
IAogICAgIGxpYnhsX19ldl9xbXBfaW5pdChldik7CiB9Ci0tIApBbnRob255IFBFUkFSRAoKCl9f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBt
YWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMu
eGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

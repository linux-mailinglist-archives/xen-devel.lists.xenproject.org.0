Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 04B89127C12
	for <lists+xen-devel@lfdr.de>; Fri, 20 Dec 2019 14:58:10 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iiIkR-0001Pp-5z; Fri, 20 Dec 2019 13:55:19 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=fFWP=2K=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1iiIkP-0001P4-FZ
 for xen-devel@lists.xenproject.org; Fri, 20 Dec 2019 13:55:17 +0000
X-Inumbo-ID: 551c9370-2330-11ea-88e7-bc764e2007e4
Received: from mx2.suse.de (unknown [195.135.220.15])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 551c9370-2330-11ea-88e7-bc764e2007e4;
 Fri, 20 Dec 2019 13:55:08 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx2.suse.de (Postfix) with ESMTP id AC3BDACC9;
 Fri, 20 Dec 2019 13:55:07 +0000 (UTC)
To: "xen-devel@lists.xenproject.org" <xen-devel@lists.xenproject.org>
From: Jan Beulich <jbeulich@suse.com>
Message-ID: <ce92465a-8a54-e8b3-035f-46b695704169@suse.com>
Date: Fri, 20 Dec 2019 14:55:36 +0100
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:60.0) Gecko/20100101
 Thunderbird/60.9.1
MIME-Version: 1.0
Content-Language: en-US
Subject: [Xen-devel] [PATCH] x86: move vgc_flags to struct pv_vcpu
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Stefano Stabellini <sstabellini@kernel.org>, Julien Grall <julien@xen.org>,
 Wei Liu <wl@xen.org>, Andrew Cooper <andrew.cooper3@citrix.com>,
 Volodymyr Babchuk <volodymyr_babchuk@epam.com>,
 =?UTF-8?Q?Roger_Pau_Monn=c3=a9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhlcmUncyBiZWVuIGVmZmVjdGl2ZWx5IG5vIHVzZSBvZiB0aGUgZmllbGQgZm9yIEhWTS4KCkFs
c28gc2hyaW5rIHRoZSBmaWVsZCB0byB1bnNpZ25lZCBpbnQsIGV2ZW4gaWYgdGhpcyBkb2Vzbid0
IGltbWVkaWF0ZWx5CnlpZWxkIGFueSBzcGFjZSBiZW5lZml0IGZvciB0aGUgc3RydWN0dXJlIGl0
c2VsZi4gVGhlIHJlc3VsdGluZyAzMi1iaXQKcGFkZGluZyBzbG90IGNhbiBldmVudHVhbGx5IGJl
IHVzZWQgZm9yIHNvbWUgb3RoZXIgZmllbGQuIFRoZSBjaGFuZ2UgaW4Kc2l6ZSBtYWtlcyBhY2Nl
c3NlcyBzbGlnaHRseSBtb3JlIGVmZmljaWVudCB0aG91Z2gsIGFzIG5vIFJFWC5XIHByZWZpeApp
cyBnb2luZyB0byBiZSBuZWVkZWQgYW55bW9yZSBvbiB0aGUgcmVzcGVjdGl2ZSBpbnNucy4KCk1p
cnJvciB0aGUgSFZNIHNpZGUgY2hhbmdlIGhlcmUgKGRyb3BwaW5nIG9mIHNldHRpbmcgdGhlIGZp
ZWxkIHRvClZHQ0Zfb25saW5lKSBhbHNvIHRvIEFybSwgb24gdGhlIGFzc3VtcHRpb24gdGhhdCBp
dCB3YXMgY2xvbmVkIGxpa2UKdGhpcyBvcmlnaW5hbGx5LiBWR0NGX29ubGluZSByZWFsbHkgc2hv
dWxkIHNpbXBseSBhbmQgY29uc2lzdGVudGx5IGJlCnRoZSBndWVzdCB2aWV3IG9mIHRoZSBpbnZl
cnNlIG9mIFZQRl9kb3duLCBhbmQgaGVuY2UgbmVlZHMgcmVwcmVzZW50aW5nCm9ubHkgaW4gdGhl
IGdldC9zZXQgdkNQVSBjb250ZXh0IGludGVyZmFjZXMuCgpTaWduZWQtb2ZmLWJ5OiBKYW4gQmV1
bGljaCA8amJldWxpY2hAc3VzZS5jb20+CgotLS0gYS94ZW4vYXJjaC9hcm0vdnBzY2kuYworKysg
Yi94ZW4vYXJjaC9hcm0vdnBzY2kuYwpAQCAtNzgsNyArNzgsNiBAQCBzdGF0aWMgaW50IGRvX2Nv
bW1vbl9jcHVfb24ocmVnaXN0ZXJfdCB0CiAgICAgICAgIGN0eHQtPnVzZXJfcmVncy54MCA9IGNv
bnRleHRfaWQ7CiAgICAgfQogI2VuZGlmCi0gICAgY3R4dC0+ZmxhZ3MgPSBWR0NGX29ubGluZTsK
IAogICAgIGRvbWFpbl9sb2NrKGQpOwogICAgIHJjID0gYXJjaF9zZXRfaW5mb19ndWVzdCh2LCBj
dHh0KTsKLS0tIGEveGVuL2FyY2gveDg2L2RvbWFpbi5jCisrKyBiL3hlbi9hcmNoL3g4Ni9kb21h
aW4uYwpAQCAtODk2LDYgKzg5Niw4IEBAIGludCBhcmNoX3NldF9pbmZvX2d1ZXN0KAogICAgICAg
ICBpZiAoICgoYyhsZHRfYmFzZSkgJiAoUEFHRV9TSVpFIC0gMSkpICE9IDApIHx8CiAgICAgICAg
ICAgICAgKGMobGR0X2VudHMpID4gODE5MikgKQogICAgICAgICAgICAgcmV0dXJuIC1FSU5WQUw7
CisKKyAgICAgICAgdi0+YXJjaC5wdi52Z2NfZmxhZ3MgPSBmbGFnczsKICAgICB9CiAKICAgICB2
LT5hcmNoLmZsYWdzIHw9IFRGX2tlcm5lbF9tb2RlOwpAQCAtOTA4LDggKzkxMCw2IEBAIGludCBh
cmNoX3NldF9pbmZvX2d1ZXN0KAogICAgICAgICAgIWlzX2h2bV9kb21haW4oZCkgJiYgIWlzX3B2
XzMyYml0X2RvbWFpbihkKSApCiAgICAgICAgIHYtPmFyY2guZmxhZ3MgJj0gflRGX2tlcm5lbF9t
b2RlOwogCi0gICAgdi0+YXJjaC52Z2NfZmxhZ3MgPSBmbGFnczsKLQogICAgIHZjcHVfc2V0dXBf
ZnB1KHYsIHYtPmFyY2gueHNhdmVfYXJlYSwKICAgICAgICAgICAgICAgICAgICBmbGFncyAmIFZH
Q0ZfSTM4N19WQUxJRCA/ICZjLm5hdC0+ZnB1X2N0eHQgOiBOVUxMLAogICAgICAgICAgICAgICAg
ICAgIEZDV19ERUZBVUxUKTsKQEAgLTE0ODgsNyArMTQ4OCw3IEBAIHN0YXRpYyB2b2lkIGxvYWRf
c2VnbWVudHMoc3RydWN0IHZjcHUgKm4KICAgICAgICAgICAgICAgICBkb21haW5fY3Jhc2gobi0+
ZG9tYWluKTsKICAgICAgICAgICAgIH0KIAotICAgICAgICAgICAgaWYgKCBuLT5hcmNoLnZnY19m
bGFncyAmIFZHQ0ZfZmFpbHNhZmVfZGlzYWJsZXNfZXZlbnRzICkKKyAgICAgICAgICAgIGlmICgg
bi0+YXJjaC5wdi52Z2NfZmxhZ3MgJiBWR0NGX2ZhaWxzYWZlX2Rpc2FibGVzX2V2ZW50cyApCiAg
ICAgICAgICAgICAgICAgdmNwdV9pbmZvKG4sIGV2dGNobl91cGNhbGxfbWFzaykgPSAxOwogCiAg
ICAgICAgICAgICByZWdzLT5lbnRyeV92ZWN0b3IgfD0gVFJBUF9zeXNjYWxsOwpAQCAtMTUyNyw3
ICsxNTI3LDcgQEAgc3RhdGljIHZvaWQgbG9hZF9zZWdtZW50cyhzdHJ1Y3QgdmNwdSAqbgogICAg
ICAgICAgICAgZG9tYWluX2NyYXNoKG4tPmRvbWFpbik7CiAgICAgICAgIH0KIAotICAgICAgICBp
ZiAoIG4tPmFyY2gudmdjX2ZsYWdzICYgVkdDRl9mYWlsc2FmZV9kaXNhYmxlc19ldmVudHMgKQor
ICAgICAgICBpZiAoIG4tPmFyY2gucHYudmdjX2ZsYWdzICYgVkdDRl9mYWlsc2FmZV9kaXNhYmxl
c19ldmVudHMgKQogICAgICAgICAgICAgdmNwdV9pbmZvKG4sIGV2dGNobl91cGNhbGxfbWFzaykg
PSAxOwogCiAgICAgICAgIHJlZ3MtPmVudHJ5X3ZlY3RvciB8PSBUUkFQX3N5c2NhbGw7Ci0tLSBh
L3hlbi9hcmNoL3g4Ni9kb21jdGwuYworKysgYi94ZW4vYXJjaC94ODYvZG9tY3RsLmMKQEAgLTE1
MDAsNyArMTUwMCwxMCBAQCB2b2lkIGFyY2hfZ2V0X2luZm9fZ3Vlc3Qoc3RydWN0IHZjcHUgKnYs
CiAjZGVmaW5lIGMoZmxkKSAoIWNvbXBhdCA/IChjLm5hdC0+ZmxkKSA6IChjLmNtcC0+ZmxkKSkK
IAogICAgIG1lbWNweSgmYy5uYXQtPmZwdV9jdHh0LCB2LT5hcmNoLmZwdV9jdHh0LCBzaXplb2Yo
Yy5uYXQtPmZwdV9jdHh0KSk7Ci0gICAgYyhmbGFncyA9IHYtPmFyY2gudmdjX2ZsYWdzICYgfihW
R0NGX2kzODdfdmFsaWR8VkdDRl9pbl9rZXJuZWwpKTsKKyAgICBpZiAoIGlzX3B2X2RvbWFpbihk
KSApCisgICAgICAgIGMoZmxhZ3MgPSB2LT5hcmNoLnB2LnZnY19mbGFncyAmIH4oVkdDRl9pMzg3
X3ZhbGlkfFZHQ0ZfaW5fa2VybmVsKSk7CisgICAgZWxzZQorICAgICAgICBjKGZsYWdzID0gMCk7
CiAgICAgaWYgKCB2LT5mcHVfaW5pdGlhbGlzZWQgKQogICAgICAgICBjKGZsYWdzIHw9IFZHQ0Zf
aTM4N192YWxpZCk7CiAgICAgaWYgKCAhKHYtPnBhdXNlX2ZsYWdzICYgVlBGX2Rvd24pICkKLS0t
IGEveGVuL2FyY2gveDg2L2h2bS9odm0uYworKysgYi94ZW4vYXJjaC94ODYvaHZtL2h2bS5jCkBA
IC0xMTUxLDggKzExNTEsNiBAQCBzdGF0aWMgaW50IGh2bV9sb2FkX2NwdV9jdHh0KHN0cnVjdCBk
b21hCiAgICAgdi0+YXJjaC5kcjYgICA9IGN0eHQuZHI2OwogICAgIHYtPmFyY2guZHI3ICAgPSBj
dHh0LmRyNzsKIAotICAgIHYtPmFyY2gudmdjX2ZsYWdzID0gVkdDRl9vbmxpbmU7Ci0KICAgICAv
KiBBdXhpbGlhcnkgcHJvY2Vzc29ycyBzaG91bGQgYmUgd29rZW4gaW1tZWRpYXRlbHkuICovCiAg
ICAgdi0+aXNfaW5pdGlhbGlzZWQgPSAxOwogICAgIGNsZWFyX2JpdChfVlBGX2Rvd24sICZ2LT5w
YXVzZV9mbGFncyk7CkBAIC0zODY0LDggKzM4NjIsNiBAQCB2b2lkIGh2bV92Y3B1X3Jlc2V0X3N0
YXRlKHN0cnVjdCB2Y3B1ICp2CiAgICAgICAgIHYtPmFyY2gueHNhdmVfYXJlYS0+eHNhdmVfaGRy
LnhzdGF0ZV9idiA9IDA7CiAgICAgdmNwdV9zZXR1cF9mcHUodiwgdi0+YXJjaC54c2F2ZV9hcmVh
LCBOVUxMLCBGQ1dfUkVTRVQpOwogCi0gICAgdi0+YXJjaC52Z2NfZmxhZ3MgPSBWR0NGX29ubGlu
ZTsKLQogICAgIGFyY2hfdmNwdV9yZWdzX2luaXQodik7CiAgICAgdi0+YXJjaC51c2VyX3JlZ3Mu
cmlwID0gaXA7CiAKLS0tIGEveGVuL2FyY2gveDg2L3B2L2NhbGxiYWNrLmMKKysrIGIveGVuL2Fy
Y2gveDg2L3B2L2NhbGxiYWNrLmMKQEAgLTgyLDE3ICs4MiwxNyBAQCBzdGF0aWMgbG9uZyByZWdp
c3Rlcl9ndWVzdF9jYWxsYmFjayhzdHJ1CiAgICAgY2FzZSBDQUxMQkFDS1RZUEVfZmFpbHNhZmU6
CiAgICAgICAgIGN1cnItPmFyY2gucHYuZmFpbHNhZmVfY2FsbGJhY2tfZWlwID0gcmVnLT5hZGRy
ZXNzOwogICAgICAgICBpZiAoIHJlZy0+ZmxhZ3MgJiBDQUxMQkFDS0ZfbWFza19ldmVudHMgKQot
ICAgICAgICAgICAgY3Vyci0+YXJjaC52Z2NfZmxhZ3MgfD0gVkdDRl9mYWlsc2FmZV9kaXNhYmxl
c19ldmVudHM7CisgICAgICAgICAgICBjdXJyLT5hcmNoLnB2LnZnY19mbGFncyB8PSBWR0NGX2Zh
aWxzYWZlX2Rpc2FibGVzX2V2ZW50czsKICAgICAgICAgZWxzZQotICAgICAgICAgICAgY3Vyci0+
YXJjaC52Z2NfZmxhZ3MgJj0gflZHQ0ZfZmFpbHNhZmVfZGlzYWJsZXNfZXZlbnRzOworICAgICAg
ICAgICAgY3Vyci0+YXJjaC5wdi52Z2NfZmxhZ3MgJj0gflZHQ0ZfZmFpbHNhZmVfZGlzYWJsZXNf
ZXZlbnRzOwogICAgICAgICBicmVhazsKIAogICAgIGNhc2UgQ0FMTEJBQ0tUWVBFX3N5c2NhbGw6
CiAgICAgICAgIGN1cnItPmFyY2gucHYuc3lzY2FsbF9jYWxsYmFja19laXAgPSByZWctPmFkZHJl
c3M7CiAgICAgICAgIGlmICggcmVnLT5mbGFncyAmIENBTExCQUNLRl9tYXNrX2V2ZW50cyApCi0g
ICAgICAgICAgICBjdXJyLT5hcmNoLnZnY19mbGFncyB8PSBWR0NGX3N5c2NhbGxfZGlzYWJsZXNf
ZXZlbnRzOworICAgICAgICAgICAgY3Vyci0+YXJjaC5wdi52Z2NfZmxhZ3MgfD0gVkdDRl9zeXNj
YWxsX2Rpc2FibGVzX2V2ZW50czsKICAgICAgICAgZWxzZQotICAgICAgICAgICAgY3Vyci0+YXJj
aC52Z2NfZmxhZ3MgJj0gflZHQ0Zfc3lzY2FsbF9kaXNhYmxlc19ldmVudHM7CisgICAgICAgICAg
ICBjdXJyLT5hcmNoLnB2LnZnY19mbGFncyAmPSB+VkdDRl9zeXNjYWxsX2Rpc2FibGVzX2V2ZW50
czsKICAgICAgICAgYnJlYWs7CiAKICAgICBjYXNlIENBTExCQUNLVFlQRV9zeXNjYWxsMzI6CkBA
IC0yMjYsOSArMjI2LDkgQEAgc3RhdGljIGxvbmcgY29tcGF0X3JlZ2lzdGVyX2d1ZXN0X2NhbGxi
YQogICAgICAgICBjdXJyLT5hcmNoLnB2LmZhaWxzYWZlX2NhbGxiYWNrX2NzID0gcmVnLT5hZGRy
ZXNzLmNzOwogICAgICAgICBjdXJyLT5hcmNoLnB2LmZhaWxzYWZlX2NhbGxiYWNrX2VpcCA9IHJl
Zy0+YWRkcmVzcy5laXA7CiAgICAgICAgIGlmICggcmVnLT5mbGFncyAmIENBTExCQUNLRl9tYXNr
X2V2ZW50cyApCi0gICAgICAgICAgICBjdXJyLT5hcmNoLnZnY19mbGFncyB8PSBWR0NGX2ZhaWxz
YWZlX2Rpc2FibGVzX2V2ZW50czsKKyAgICAgICAgICAgIGN1cnItPmFyY2gucHYudmdjX2ZsYWdz
IHw9IFZHQ0ZfZmFpbHNhZmVfZGlzYWJsZXNfZXZlbnRzOwogICAgICAgICBlbHNlCi0gICAgICAg
ICAgICBjdXJyLT5hcmNoLnZnY19mbGFncyAmPSB+VkdDRl9mYWlsc2FmZV9kaXNhYmxlc19ldmVu
dHM7CisgICAgICAgICAgICBjdXJyLT5hcmNoLnB2LnZnY19mbGFncyAmPSB+VkdDRl9mYWlsc2Fm
ZV9kaXNhYmxlc19ldmVudHM7CiAgICAgICAgIGJyZWFrOwogCiAgICAgY2FzZSBDQUxMQkFDS1RZ
UEVfc3lzY2FsbDMyOgotLS0gYS94ZW4vYXJjaC94ODYveDg2XzY0L2FzbS1vZmZzZXRzLmMKKysr
IGIveGVuL2FyY2gveDg2L3g4Nl82NC9hc20tb2Zmc2V0cy5jCkBAIC02OSw3ICs2OSw3IEBAIHZv
aWQgX19kdW1teV9fKHZvaWQpCiAgICAgT0ZGU0VUKFZDUFVfa2VybmVsX3NwLCBzdHJ1Y3QgdmNw
dSwgYXJjaC5wdi5rZXJuZWxfc3ApOwogICAgIE9GRlNFVChWQ1BVX2tlcm5lbF9zcywgc3RydWN0
IHZjcHUsIGFyY2gucHYua2VybmVsX3NzKTsKICAgICBPRkZTRVQoVkNQVV9pb3BsLCBzdHJ1Y3Qg
dmNwdSwgYXJjaC5wdi5pb3BsKTsKLSAgICBPRkZTRVQoVkNQVV9ndWVzdF9jb250ZXh0X2ZsYWdz
LCBzdHJ1Y3QgdmNwdSwgYXJjaC52Z2NfZmxhZ3MpOworICAgIE9GRlNFVChWQ1BVX2d1ZXN0X2Nv
bnRleHRfZmxhZ3MsIHN0cnVjdCB2Y3B1LCBhcmNoLnB2LnZnY19mbGFncyk7CiAgICAgT0ZGU0VU
KFZDUFVfY3IzLCBzdHJ1Y3QgdmNwdSwgYXJjaC5jcjMpOwogICAgIE9GRlNFVChWQ1BVX2FyY2hf
bXNycywgc3RydWN0IHZjcHUsIGFyY2gubXNycyk7CiAgICAgT0ZGU0VUKFZDUFVfbm1pX3BlbmRp
bmcsIHN0cnVjdCB2Y3B1LCBubWlfcGVuZGluZyk7Ci0tLSBhL3hlbi9pbmNsdWRlL2FzbS14ODYv
ZG9tYWluLmgKKysrIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9kb21haW4uaApAQCAtNDc2LDYgKzQ3
Niw4IEBAIHN0cnVjdCBwdl92Y3B1CiAgICAgLyogbWFwX2RvbWFpbl9wYWdlKCkgbWFwcGluZyBj
YWNoZS4gKi8KICAgICBzdHJ1Y3QgbWFwY2FjaGVfdmNwdSBtYXBjYWNoZTsKIAorICAgIHVuc2ln
bmVkIGludCB2Z2NfZmxhZ3M7CisKICAgICBzdHJ1Y3QgdHJhcF9pbmZvICp0cmFwX2N0eHQ7CiAK
ICAgICB1bnNpZ25lZCBsb25nIGdkdF9mcmFtZXNbRklSU1RfUkVTRVJWRURfR0RUX1BBR0VdOwpA
QCAtNTQyLDcgKzU0NCw2IEBAIHN0cnVjdCBhcmNoX3ZjcHUKICAgICAgKi8KIAogICAgIHZvaWQg
ICAgICAgICAgICAgICpmcHVfY3R4dDsKLSAgICB1bnNpZ25lZCBsb25nICAgICAgdmdjX2ZsYWdz
OwogICAgIHN0cnVjdCBjcHVfdXNlcl9yZWdzIHVzZXJfcmVnczsKIAogICAgIC8qIERlYnVnIHJl
Z2lzdGVycy4gKi8KCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3Jn
Cmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

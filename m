Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id CF94FC3110
	for <lists+xen-devel@lfdr.de>; Tue,  1 Oct 2019 12:17:09 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iFF9e-0002Oz-8M; Tue, 01 Oct 2019 10:13:14 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=hWiX=X2=citrix.com=roger.pau@srs-us1.protection.inumbo.net>)
 id 1iFF9c-0002Ou-0E
 for xen-devel@lists.xenproject.org; Tue, 01 Oct 2019 10:13:12 +0000
X-Inumbo-ID: 121f7636-e434-11e9-96f7-12813bfff9fa
Received: from esa2.hc3370-68.iphmx.com (unknown [216.71.145.153])
 by localhost (Halon) with ESMTPS
 id 121f7636-e434-11e9-96f7-12813bfff9fa;
 Tue, 01 Oct 2019 10:13:11 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1569924791;
 h=from:to:cc:subject:date:message-id:mime-version:
 content-transfer-encoding;
 bh=ZwlN+mVM0FYnJ/ikyud9Z0KYmDUi6Ki6lAWYMxfy0zo=;
 b=H5MvhwpJaJHvi1C+RB+YoDwEn5JXTzLaBfbs5LCe8tXf3E/6xPlYjpC4
 QH7lmR58kDV/UTclrVlAnG4SsWM6ZJsb5CBzEIEbZIAuXdjSLToOJja89
 2F8WCRgoWshNVITIejQU92lVlH31xQFSpBU7ZdB3/YB0Yw65G7wi51Vaq s=;
Authentication-Results: esa2.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=roger.pau@citrix.com;
 spf=Pass smtp.mailfrom=roger.pau@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa2.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 roger.pau@citrix.com) identity=pra; client-ip=162.221.158.21;
 receiver=esa2.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="roger.pau@citrix.com"; x-conformance=sidf_compatible
Received-SPF: Pass (esa2.hc3370-68.iphmx.com: domain of
 roger.pau@citrix.com designates 162.221.158.21 as permitted
 sender) identity=mailfrom; client-ip=162.221.158.21;
 receiver=esa2.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="roger.pau@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83 ~all"
Received-SPF: None (esa2.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa2.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: QkMGjQaXorGRRw07deqrEe/uTkSiTxKgXpN+Gm1RkjWE0ier3f4OBmE6pkoTO1zGFIT9ov/FhZ
 7H7xCKuxenaPstn5SPFCSNQfb5IlCyWb5jxDvb9nrGw8k+oKsgOZxDOPYHG/KSIpac1fOeMr0e
 /pPJ3pBsPwX5TFPqAroajbZIyBlRSzWkxPcNNljC9xr7acUlVktn4PFkogn7zFEFam6V32KM/d
 2WR14OonAAWgCI/eYzStMj95QlH8PmmJaK9WVDhEB76WzJaveZCj9QaU/vjVIKi94std8XQU6q
 WLM=
X-SBRS: 2.7
X-MesageID: 6297545
X-Ironport-Server: esa2.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.64,570,1559534400"; 
   d="scan'208";a="6297545"
From: Roger Pau Monne <roger.pau@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Tue, 1 Oct 2019 12:12:59 +0200
Message-ID: <20191001101259.53162-1-roger.pau@citrix.com>
X-Mailer: git-send-email 2.23.0
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH] libxl: wait for the ack when issuing power
 control requests
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Wei Liu <wl@xen.org>, Ian Jackson <ian.jackson@eu.citrix.com>,
 Ross Lagerwall <ross.lagerwall@citrix.com>,
 Christian Lindig <christian.lindig@citrix.com>, David Scott <dave@recoil.org>,
 Anthony PERARD <anthony.perard@citrix.com>,
 Roger Pau Monne <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

Q3VycmVudGx5IG9ubHkgc3VzcGVuZCBwb3dlciBjb250cm9sIHJlcXVlc3RzIHdhaXQgZm9yIGFu
IGFjayBmcm9tIHRoZQpkb21haW4sIHdoaWxlIHBvd2VyIG9mZiBvciByZWJvb3QgcmVxdWVzdHMg
c2ltcGx5IHdyaXRlIHRoZSBjb21tYW5kIHRvCnhlbnN0b3JlIGFuZCBleGl0LgoKSW50cm9kdWNl
IGEgMSBtaW51dGUgd2FpdCBmb3IgdGhlIGRvbWFpbiB0byBhY2tub3dsZWRnZSB0aGUgcmVxdWVz
dCwgb3IKZWxzZSByZXR1cm4gYW4gZXJyb3IuIFRoZSBzdXNwZW5kIGNvZGUgaXMgc2xpZ2h0bHkg
bW9kaWZpZWQgdG8gdXNlIHRoZQpuZXcgaW5mcmFzdHJ1Y3R1cmUgYWRkZWQsIGJ1dCBzaG91bGRu
J3QgaGF2ZSBhbnkgZnVuY3Rpb25hbCBjaGFuZ2UuCgpGaXggdGhlIG9jYW1sIGJpbmRpbmdzIGFu
ZCBhbHNvIHByb3ZpZGUgYSBiYWNrd2FyZHMgY29tcGF0aWJsZQppbnRlcmZhY2UgZm9yIHRoZSBy
ZWJvb3QgYW5kIHBvd2Vyb2ZmIGxpYnhsIEFQSSBmdW5jdGlvbnMuCgpSZXBvcnRlZC1ieTogUm9z
cyBMYWdlcndhbGwgPHJvc3MubGFnZXJ3YWxsQGNpdHJpeC5jb20+ClNpZ25lZC1vZmYtYnk6IFJv
Z2VyIFBhdSBNb25uw6kgPHJvZ2VyLnBhdUBjaXRyaXguY29tPgotLS0KSSBiZWxpZXZlIGFwcGx5
aW5nIHRoaXMgcGF0Y2ggaXMgbm90IGdvaW5nIHRvIGNhdXNlIHJlZ3Jlc3Npb25zIGluCm9zc3Rl
c3QsIGFsYmVpdCBGcmVlQlNEIGRvZXNuJ3QgYWNrbm93bGVkZ2UgcG93ZXJvZmYvcmVib290IHJl
cXVlc3RzCmluIHRoZSBjdXJyZW50bHkgdGVzdGVkIHZlcnNpb25zLCBpdCB3aWxsIHNodXRkb3du
IGluIGxlc3MgdGhhbiBvbmUKbWludXRlLCBhbmQgdGh1cyB0aGUgdG9vbHN0YWNrIHdvbid0IGNv
bXBsYWluIGJlY2F1c2UgdGhlIGNvbnRyb2wgbm9kZQppcyBnb2luZyB0byBiZSByZW1vdmVkIGZy
b20geGVuc3RvcmUuCi0tLQogdG9vbHMvbGlieGwvbGlieGwuaCAgICAgICAgICAgICAgICAgIHwg
MjMgKysrKysrKy0KIHRvb2xzL2xpYnhsL2xpYnhsX2RvbV9zdXNwZW5kLmMgICAgICB8IDExICsr
LS0KIHRvb2xzL2xpYnhsL2xpYnhsX2RvbWFpbi5jICAgICAgICAgICB8IDgxICsrKysrKysrKysr
KysrKysrKysrLS0tLS0tLS0KIHRvb2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmggICAgICAgICB8
ICA3ICsrLQogdG9vbHMvb2NhbWwvbGlicy94bC94ZW5saWdodF9zdHVicy5jIHwgMTggKysrKy0t
LQogdG9vbHMveGwveGxfdm1jb250cm9sLmMgICAgICAgICAgICAgIHwgIDQgKy0KIDYgZmlsZXMg
Y2hhbmdlZCwgMTAyIGluc2VydGlvbnMoKyksIDQyIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBh
L3Rvb2xzL2xpYnhsL2xpYnhsLmggYi90b29scy9saWJ4bC9saWJ4bC5oCmluZGV4IGY3MTFjZmM3
NTAuLjAzZWE1Y2E3NDAgMTAwNjQ0Ci0tLSBhL3Rvb2xzL2xpYnhsL2xpYnhsLmgKKysrIGIvdG9v
bHMvbGlieGwvbGlieGwuaApAQCAtMTYyOCw4ICsxNjI4LDI3IEBAIGludCBsaWJ4bF9kb21haW5f
cmVtdXNfc3RhcnQobGlieGxfY3R4ICpjdHgsIGxpYnhsX2RvbWFpbl9yZW11c19pbmZvICppbmZv
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsaWJ4bF9hc3luY29wX2hvdyAq
YW9faG93KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMSUJYTF9FWFRFUk5BTF9DQUxM
RVJTX09OTFk7CiAKLWludCBsaWJ4bF9kb21haW5fc2h1dGRvd24obGlieGxfY3R4ICpjdHgsIHVp
bnQzMl90IGRvbWlkKTsKLWludCBsaWJ4bF9kb21haW5fcmVib290KGxpYnhsX2N0eCAqY3R4LCB1
aW50MzJfdCBkb21pZCk7CitpbnQgbGlieGxfZG9tYWluX3NodXRkb3duKGxpYnhsX2N0eCAqY3R4
LCB1aW50MzJfdCBkb21pZCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGlieGxf
YXN5bmNvcF9ob3cgKmFvX2hvdykKKyAgICAgICAgICAgICAgICAgICAgICAgICAgTElCWExfRVhU
RVJOQUxfQ0FMTEVSU19PTkxZOworaW50IGxpYnhsX2RvbWFpbl9yZWJvb3QobGlieGxfY3R4ICpj
dHgsIHVpbnQzMl90IGRvbWlkLAorICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGlieGxf
YXN5bmNvcF9ob3cgKmFvX2hvdykKKyAgICAgICAgICAgICAgICAgICAgICAgIExJQlhMX0VYVEVS
TkFMX0NBTExFUlNfT05MWTsKKyNpZiBkZWZpbmVkKExJQlhMX0FQSV9WRVJTSU9OKSAmJiBMSUJY
TF9BUElfVkVSU0lPTiA8IDB4MDQxMzAwCitzdGF0aWMgaW5saW5lIGludCBsaWJ4bF9kb21haW5f
c2h1dGRvd25fMHgwNDEyMDAobGlieGxfY3R4ICpjdHgsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgZG9taWQpCit7CisgICAgcmV0dXJu
IGxpYnhsX2RvbWFpbl9zaHV0ZG93bihjdHgsIGRvbWlkLCBOVUxMKTsKK30KKyNkZWZpbmUgbGli
eGxfZG9tYWluX3NodXRkb3duIGxpYnhsX2RvbWFpbl9zaHV0ZG93bl8weDA0MTIwMAorc3RhdGlj
IGlubGluZSBpbnQgbGlieGxfZG9tYWluX3JlYm9vdF8weDA0MTIwMChsaWJ4bF9jdHggKmN0eCwK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3Qg
ZG9taWQpCit7CisgICAgcmV0dXJuIGxpYnhsX2RvbWFpbl9yZWJvb3QoY3R4LCBkb21pZCwgTlVM
TCk7Cit9CisjZGVmaW5lIGxpYnhsX2RvbWFpbl9yZWJvb3QgbGlieGxfZG9tYWluX3JlYm9vdF8w
eDA0MTIwMAorI2VuZGlmCisKIGludCBsaWJ4bF9kb21haW5fZGVzdHJveShsaWJ4bF9jdHggKmN0
eCwgdWludDMyX3QgZG9taWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGlieGxf
YXN5bmNvcF9ob3cgKmFvX2hvdykKICAgICAgICAgICAgICAgICAgICAgICAgICBMSUJYTF9FWFRF
Uk5BTF9DQUxMRVJTX09OTFk7CmRpZmYgLS1naXQgYS90b29scy9saWJ4bC9saWJ4bF9kb21fc3Vz
cGVuZC5jIGIvdG9vbHMvbGlieGwvbGlieGxfZG9tX3N1c3BlbmQuYwppbmRleCA5YmIyZDAwYmVj
Li4yNDhkYmMzM2UzIDEwMDY0NAotLS0gYS90b29scy9saWJ4bC9saWJ4bF9kb21fc3VzcGVuZC5j
CisrKyBiL3Rvb2xzL2xpYnhsL2xpYnhsX2RvbV9zdXNwZW5kLmMKQEAgLTE5MywxNiArMTkzLDEx
IEBAIHN0YXRpYyB2b2lkIGRvbWFpbl9zdXNwZW5kX2NhbGxiYWNrX2NvbW1vbihsaWJ4bF9fZWdj
ICplZ2MsCiAgICAgTE9HRChERUJVRywgZG9taWQsICJpc3N1aW5nICVzIHN1c3BlbmQgcmVxdWVz
dCB2aWEgWGVuQnVzIGNvbnRyb2wgbm9kZSIsCiAgICAgICAgIGRzcHMtPnR5cGUgIT0gTElCWExf
RE9NQUlOX1RZUEVfUFYgPyAiUFZIL0hWTSIgOiAiUFYiKTsKIAotICAgIGxpYnhsX19kb21haW5f
cHZjb250cm9sX3dyaXRlKGdjLCBYQlRfTlVMTCwgZG9taWQsICJzdXNwZW5kIik7Ci0KLSAgICBk
c3BzLT5wdmNvbnRyb2wucGF0aCA9IGxpYnhsX19kb21haW5fcHZjb250cm9sX3hzcGF0aChnYywg
ZG9taWQpOwotICAgIGlmICghZHNwcy0+cHZjb250cm9sLnBhdGgpIHsgcmMgPSBFUlJPUl9GQUlM
OyBnb3RvIGVycjsgfQotCiAgICAgZHNwcy0+cHZjb250cm9sLmFvID0gYW87Ci0gICAgZHNwcy0+
cHZjb250cm9sLndoYXQgPSAiZ3Vlc3QgYWNrbm93bGVkZ2VtZW50IG9mIHN1c3BlbmQgcmVxdWVz
dCI7Ci0gICAgZHNwcy0+cHZjb250cm9sLnRpbWVvdXRfbXMgPSA2MCAqIDEwMDA7CiAgICAgZHNw
cy0+cHZjb250cm9sLmNhbGxiYWNrID0gZG9tYWluX3N1c3BlbmRfY29tbW9uX3B2Y29udHJvbF9z
dXNwZW5kaW5nOwotICAgIGxpYnhsX194c3dhaXRfc3RhcnQoZ2MsICZkc3BzLT5wdmNvbnRyb2wp
OworICAgIHJjID0gbGlieGxfX2RvbWFpbl9wdmNvbnRyb2woZWdjLCAmZHNwcy0+cHZjb250cm9s
LCBkb21pZCwgInN1c3BlbmQiKTsKKyAgICBpZiAocmMpIGdvdG8gZXJyOworCiAgICAgcmV0dXJu
OwogCiAgZXJyOgpkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGlieGxfZG9tYWluLmMgYi90b29s
cy9saWJ4bC9saWJ4bF9kb21haW4uYwppbmRleCAwZGQ1YjdmZmE5Li4wNThmM2M3N2VjIDEwMDY0
NAotLS0gYS90b29scy9saWJ4bC9saWJ4bF9kb21haW4uYworKysgYi90b29scy9saWJ4bC9saWJ4
bF9kb21haW4uYwpAQCAtNzYzLDQ5ICs3NjMsODYgQEAgY2hhciAqIGxpYnhsX19kb21haW5fcHZj
b250cm9sX3JlYWQobGlieGxfX2djICpnYywgeHNfdHJhbnNhY3Rpb25fdCB0LAogICAgIHJldHVy
biBsaWJ4bF9feHNfcmVhZChnYywgdCwgc2h1dGRvd25fcGF0aCk7CiB9CiAKLWludCBsaWJ4bF9f
ZG9tYWluX3B2Y29udHJvbF93cml0ZShsaWJ4bF9fZ2MgKmdjLCB4c190cmFuc2FjdGlvbl90IHQs
Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgZG9taWQsIGNvbnN0
IGNoYXIgKmNtZCkKK2ludCBsaWJ4bF9fZG9tYWluX3B2Y29udHJvbChsaWJ4bF9fZWdjICplZ2Ms
IGxpYnhsX194c3dhaXRfc3RhdGUgKnB2Y29udHJvbCwKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBkb21pZF90IGRvbWlkLCBjb25zdCBjaGFyICpjbWQpCiB7CisgICAgU1RBVEVfQU9fR0Mo
cHZjb250cm9sLT5hbyk7CiAgICAgY29uc3QgY2hhciAqc2h1dGRvd25fcGF0aDsKKyAgICBpbnQg
cmM7CisKKyAgICByYyA9IGxpYnhsX19kb21haW5fcHZjb250cm9sX2F2YWlsYWJsZShnYywgZG9t
aWQpOworICAgIGlmIChyYyA8IDApCisgICAgICAgIHJldHVybiByYzsKIAogICAgIHNodXRkb3du
X3BhdGggPSBsaWJ4bF9fZG9tYWluX3B2Y29udHJvbF94c3BhdGgoZ2MsIGRvbWlkKTsKICAgICBp
ZiAoIXNodXRkb3duX3BhdGgpCiAgICAgICAgIHJldHVybiBFUlJPUl9GQUlMOwogCi0gICAgcmV0
dXJuIGxpYnhsX194c19wcmludGYoZ2MsIHQsIHNodXRkb3duX3BhdGgsICIlcyIsIGNtZCk7Cisg
ICAgcmMgPSBsaWJ4bF9feHNfcHJpbnRmKGdjLCBYQlRfTlVMTCwgc2h1dGRvd25fcGF0aCwgIiVz
IiwgY21kKTsKKyAgICBpZiAocmMpCisgICAgICAgIHJldHVybiByYzsKKworICAgIHB2Y29udHJv
bC0+cGF0aCA9IHNodXRkb3duX3BhdGg7CisgICAgcHZjb250cm9sLT53aGF0ID0gR0NTUFJJTlRG
KCJndWVzdCBhY2tub3dsZWRnZW1lbnQgb2YgJXMgcmVxdWVzdCIsIGNtZCk7CisgICAgcHZjb250
cm9sLT50aW1lb3V0X21zID0gNjAgKiAxMDAwOworICAgIGxpYnhsX194c3dhaXRfc3RhcnQoZ2Ms
IHB2Y29udHJvbCk7CisKKyAgICByZXR1cm4gMDsKIH0KIAotc3RhdGljIGludCBsaWJ4bF9fZG9t
YWluX3B2Y29udHJvbChsaWJ4bF9fZ2MgKmdjLCB1aW50MzJfdCBkb21pZCwKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hhciAqY21kKQorc3RhdGljIGJvb2wgcHZj
b250cm9sX2Fja2VkKGNvbnN0IGNoYXIgKnN0YXRlKQogewotICAgIGludCByZXQ7CisgICAgaWYg
KCFzdGF0ZSB8fCAhc3RyY21wKHN0YXRlLCIiKSkKKyAgICAgICAgcmV0dXJuIHRydWU7CisKKyAg
ICByZXR1cm4gZmFsc2U7Cit9CisKK3N0YXRpYyB2b2lkIHB2Y29udHJvbF9jYihsaWJ4bF9fZWdj
ICplZ2MsIGxpYnhsX194c3dhaXRfc3RhdGUgKnhzd2EsIGludCByYywKKyAgICAgICAgICAgICAg
ICAgICAgICAgICBjb25zdCBjaGFyICpzdGF0ZSkKK3sKKyAgICBTVEFURV9BT19HQyh4c3dhLT5h
byk7CisKKyAgICBpZiAoIXJjICYmICFwdmNvbnRyb2xfYWNrZWQoc3RhdGUpKQorICAgICAgICBy
ZXR1cm47CiAKLSAgICByZXQgPSBsaWJ4bF9fZG9tYWluX3B2Y29udHJvbF9hdmFpbGFibGUoZ2Ms
IGRvbWlkKTsKLSAgICBpZiAocmV0IDwgMCkKLSAgICAgICAgcmV0dXJuIHJldDsKKyAgICBsaWJ4
bF9feHN3YWl0X3N0b3AoZ2MsIHhzd2EpOwogCi0gICAgaWYgKCFyZXQpCi0gICAgICAgIHJldHVy
biBFUlJPUl9OT1BBUkFWSVJUOworICAgIGlmIChyYykKKyAgICAgICAgTE9HKEVSUk9SLCAiZ3Vl
c3QgZGlkbid0IGFja25vd2xlZGdlIGNvbnRyb2wgcmVxdWVzdDogJWQiLCByYyk7CiAKLSAgICBy
ZXR1cm4gbGlieGxfX2RvbWFpbl9wdmNvbnRyb2xfd3JpdGUoZ2MsIFhCVF9OVUxMLCBkb21pZCwg
Y21kKTsKKyAgICBsaWJ4bF9fYW9fY29tcGxldGUoZWdjLCBhbywgcmMpOwogfQogCi1pbnQgbGli
eGxfZG9tYWluX3NodXRkb3duKGxpYnhsX2N0eCAqY3R4LCB1aW50MzJfdCBkb21pZCkKKworaW50
IGxpYnhsX2RvbWFpbl9zaHV0ZG93bihsaWJ4bF9jdHggKmN0eCwgdWludDMyX3QgZG9taWQsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxpYnhsX2FzeW5jb3BfaG93ICphb19ob3cp
CiB7Ci0gICAgR0NfSU5JVChjdHgpOworICAgIEFPX0NSRUFURShjdHgsIGRvbWlkLCBhb19ob3cp
OworICAgIGxpYnhsX194c3dhaXRfc3RhdGUgKnB2Y29udHJvbDsKICAgICBpbnQgcmV0OwotICAg
IHJldCA9IGxpYnhsX19kb21haW5fcHZjb250cm9sKGdjLCBkb21pZCwgInBvd2Vyb2ZmIik7Ci0g
ICAgR0NfRlJFRTsKLSAgICByZXR1cm4gcmV0OworCisgICAgR0NORVcocHZjb250cm9sKTsKKyAg
ICBwdmNvbnRyb2wtPmFvID0gYW87CisgICAgcHZjb250cm9sLT5jYWxsYmFjayA9IHB2Y29udHJv
bF9jYjsKKyAgICByZXQgPSBsaWJ4bF9fZG9tYWluX3B2Y29udHJvbChlZ2MsIHB2Y29udHJvbCwg
ZG9taWQsICJwb3dlcm9mZiIpOworCisgICAgcmV0dXJuIHJldCA/IEFPX0NSRUFURV9GQUlMKHJl
dCkgOiBBT19JTlBST0dSRVNTOwogfQogCi1pbnQgbGlieGxfZG9tYWluX3JlYm9vdChsaWJ4bF9j
dHggKmN0eCwgdWludDMyX3QgZG9taWQpCitpbnQgbGlieGxfZG9tYWluX3JlYm9vdChsaWJ4bF9j
dHggKmN0eCwgdWludDMyX3QgZG9taWQsCisgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBs
aWJ4bF9hc3luY29wX2hvdyAqYW9faG93KQogewotICAgIEdDX0lOSVQoY3R4KTsKKyAgICBBT19D
UkVBVEUoY3R4LCBkb21pZCwgYW9faG93KTsKKyAgICBsaWJ4bF9feHN3YWl0X3N0YXRlICpwdmNv
bnRyb2w7CiAgICAgaW50IHJldDsKLSAgICByZXQgPSBsaWJ4bF9fZG9tYWluX3B2Y29udHJvbChn
YywgZG9taWQsICJyZWJvb3QiKTsKLSAgICBHQ19GUkVFOwotICAgIHJldHVybiByZXQ7CisKKyAg
ICBHQ05FVyhwdmNvbnRyb2wpOworICAgIHB2Y29udHJvbC0+YW8gPSBhbzsKKyAgICBwdmNvbnRy
b2wtPmNhbGxiYWNrID0gcHZjb250cm9sX2NiOworICAgIHJldCA9IGxpYnhsX19kb21haW5fcHZj
b250cm9sKGVnYywgcHZjb250cm9sLCBkb21pZCwgInJlYm9vdCIpOworCisgICAgcmV0dXJuIHJl
dCA/IEFPX0NSRUFURV9GQUlMKHJldCkgOiBBT19JTlBST0dSRVNTOwogfQogCiBzdGF0aWMgdm9p
ZCBkb21haW5fZGVhdGhfb2NjdXJyZWQobGlieGxfX2VnYyAqZWdjLApkaWZmIC0tZ2l0IGEvdG9v
bHMvbGlieGwvbGlieGxfaW50ZXJuYWwuaCBiL3Rvb2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmgK
aW5kZXggYmZlYjM4ZTBlZC4uZDJkNWFmNzQ2YiAxMDA2NDQKLS0tIGEvdG9vbHMvbGlieGwvbGli
eGxfaW50ZXJuYWwuaAorKysgYi90b29scy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5oCkBAIC0xMzc4
LDggKzEzNzgsNiBAQCBfaGlkZGVuIGludCBsaWJ4bF9fZG9tYWluX3B2Y29udHJvbF9hdmFpbGFi
bGUobGlieGxfX2djICpnYywgdWludDMyX3QgZG9taWQpOwogX2hpZGRlbiBjb25zdCBjaGFyICps
aWJ4bF9fZG9tYWluX3B2Y29udHJvbF94c3BhdGgobGlieGxfX2djKiwgdWludDMyX3QgZG9taWQp
OwogX2hpZGRlbiBjaGFyICogbGlieGxfX2RvbWFpbl9wdmNvbnRyb2xfcmVhZChsaWJ4bF9fZ2Mg
KmdjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4c190cmFu
c2FjdGlvbl90IHQsIHVpbnQzMl90IGRvbWlkKTsKLV9oaWRkZW4gaW50IGxpYnhsX19kb21haW5f
cHZjb250cm9sX3dyaXRlKGxpYnhsX19nYyAqZ2MsIHhzX3RyYW5zYWN0aW9uX3QgdCwKLSAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90IGRvbWlkLCBjb25z
dCBjaGFyICpjbWQpOwogCiAvKiBmcm9tIHhsX2RldmljZSAqLwogX2hpZGRlbiBjaGFyICpsaWJ4
bF9fZGV2aWNlX2Rpc2tfc3RyaW5nX29mX2JhY2tlbmQobGlieGxfZGlza19iYWNrZW5kIGJhY2tl
bmQpOwpAQCAtNDcxOSw2ICs0NzE3LDExIEBAIF9oaWRkZW4gdm9pZCBsaWJ4bF9fZXZfZGV2bG9j
a19pbml0KGxpYnhsX19ldl9kZXZsb2NrICopOwogX2hpZGRlbiB2b2lkIGxpYnhsX19ldl9kZXZs
b2NrX2xvY2sobGlieGxfX2VnYyAqLCBsaWJ4bF9fZXZfZGV2bG9jayAqKTsKIF9oaWRkZW4gdm9p
ZCBsaWJ4bF9fZXZfZGV2bG9ja191bmxvY2sobGlieGxfX2djICosIGxpYnhsX19ldl9kZXZsb2Nr
ICopOwogCisvKiBTZW5kIGNvbnRyb2wgY29tbWFuZHMgb3ZlciB4ZW5zdG9yZSBhbmQgd2FpdCBm
b3IgYW4gQWNrLiAqLworX2hpZGRlbiBpbnQgbGlieGxfX2RvbWFpbl9wdmNvbnRyb2wobGlieGxf
X2VnYyAqZWdjLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlieGxfX3hz
d2FpdF9zdGF0ZSAqcHZjb250cm9sLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgZG9taWRfdCBkb21pZCwgY29uc3QgY2hhciAqY21kKTsKKwogI2VuZGlmCiAKIC8qCmRpZmYg
LS1naXQgYS90b29scy9vY2FtbC9saWJzL3hsL3hlbmxpZ2h0X3N0dWJzLmMgYi90b29scy9vY2Ft
bC9saWJzL3hsL3hlbmxpZ2h0X3N0dWJzLmMKaW5kZXggMzdiMDQ2ZGY2My4uZmYxNmI4NzEwYiAx
MDA2NDQKLS0tIGEvdG9vbHMvb2NhbWwvbGlicy94bC94ZW5saWdodF9zdHVicy5jCisrKyBiL3Rv
b2xzL29jYW1sL2xpYnMveGwveGVubGlnaHRfc3R1YnMuYwpAQCAtNTUxLDMyICs1NTEsMzggQEAg
dmFsdWUgc3R1Yl9saWJ4bF9kb21haW5fY3JlYXRlX3Jlc3RvcmUodmFsdWUgY3R4LCB2YWx1ZSBk
b21haW5fY29uZmlnLCB2YWx1ZSBwYXIKIAlDQU1McmV0dXJuKFZhbF9pbnQoY19kb21pZCkpOwog
fQogCi12YWx1ZSBzdHViX2xpYnhsX2RvbWFpbl9zaHV0ZG93bih2YWx1ZSBjdHgsIHZhbHVlIGRv
bWlkKQordmFsdWUgc3R1Yl9saWJ4bF9kb21haW5fc2h1dGRvd24odmFsdWUgY3R4LCB2YWx1ZSBk
b21pZCwgdmFsdWUgYXN5bmMsIHZhbHVlIHVuaXQpCiB7Ci0JQ0FNTHBhcmFtMihjdHgsIGRvbWlk
KTsKKwlDQU1McGFyYW00KGN0eCwgZG9taWQsIGFzeW5jLCB1bml0KTsKIAlpbnQgcmV0OwogCXVp
bnQzMl90IGNfZG9taWQgPSBJbnRfdmFsKGRvbWlkKTsKKwlsaWJ4bF9hc3luY29wX2hvdyAqYW9f
aG93ID0gYW9ob3dfdmFsKGFzeW5jKTsKIAogCWNhbWxfZW50ZXJfYmxvY2tpbmdfc2VjdGlvbigp
OwotCXJldCA9IGxpYnhsX2RvbWFpbl9zaHV0ZG93bihDVFgsIGNfZG9taWQpOworCXJldCA9IGxp
YnhsX2RvbWFpbl9zaHV0ZG93bihDVFgsIGNfZG9taWQsIGFvX2hvdyk7CiAJY2FtbF9sZWF2ZV9i
bG9ja2luZ19zZWN0aW9uKCk7CiAKKwlmcmVlKGFvX2hvdyk7CisKIAlpZiAocmV0ICE9IDApCiAJ
CWZhaWx3aXRoX3hsKHJldCwgImRvbWFpbl9zaHV0ZG93biIpOwogCiAJQ0FNTHJldHVybihWYWxf
dW5pdCk7CiB9CiAKLXZhbHVlIHN0dWJfbGlieGxfZG9tYWluX3JlYm9vdCh2YWx1ZSBjdHgsIHZh
bHVlIGRvbWlkKQordmFsdWUgc3R1Yl9saWJ4bF9kb21haW5fcmVib290KHZhbHVlIGN0eCwgdmFs
dWUgZG9taWQsIHZhbHVlIGFzeW5jLCB2YWx1ZSB1bml0KQogewotCUNBTUxwYXJhbTIoY3R4LCBk
b21pZCk7CisJQ0FNTHBhcmFtNChjdHgsIGRvbWlkLCBhc3luYywgdW5pdCk7CiAJaW50IHJldDsK
IAl1aW50MzJfdCBjX2RvbWlkID0gSW50X3ZhbChkb21pZCk7CisJbGlieGxfYXN5bmNvcF9ob3cg
KmFvX2hvdyA9IGFvaG93X3ZhbChhc3luYyk7CiAKIAljYW1sX2VudGVyX2Jsb2NraW5nX3NlY3Rp
b24oKTsKLQlyZXQgPSBsaWJ4bF9kb21haW5fcmVib290KENUWCwgY19kb21pZCk7CisJcmV0ID0g
bGlieGxfZG9tYWluX3JlYm9vdChDVFgsIGNfZG9taWQsIGFvX2hvdyk7CiAJY2FtbF9sZWF2ZV9i
bG9ja2luZ19zZWN0aW9uKCk7CiAKKwlmcmVlKGFvX2hvdyk7CisKIAlpZiAocmV0ICE9IDApCiAJ
CWZhaWx3aXRoX3hsKHJldCwgImRvbWFpbl9yZWJvb3QiKTsKIApkaWZmIC0tZ2l0IGEvdG9vbHMv
eGwveGxfdm1jb250cm9sLmMgYi90b29scy94bC94bF92bWNvbnRyb2wuYwppbmRleCBlYjY3Nzlh
NTYxLi5iMjA1ODJlMTViIDEwMDY0NAotLS0gYS90b29scy94bC94bF92bWNvbnRyb2wuYworKysg
Yi90b29scy94bC94bF92bWNvbnRyb2wuYwpAQCAtMTAzLDcgKzEwMyw3IEBAIHN0YXRpYyB2b2lk
IHJlYm9vdF9kb21haW4odWludDMyX3QgZG9taWQsIGxpYnhsX2V2Z2VuX2RvbWFpbl9kZWF0aCAq
KmRlYXRodywKICAgICBpbnQgcmM7CiAKICAgICBmcHJpbnRmKHN0ZGVyciwgIlJlYm9vdGluZyBk
b21haW4gJXVcbiIsIGRvbWlkKTsKLSAgICByYz1saWJ4bF9kb21haW5fcmVib290KGN0eCwgZG9t
aWQpOworICAgIHJjID0gbGlieGxfZG9tYWluX3JlYm9vdChjdHgsIGRvbWlkLCBOVUxMKTsKICAg
ICBpZiAocmMgPT0gRVJST1JfTk9QQVJBVklSVCkgewogICAgICAgICBpZiAoZmFsbGJhY2tfdHJp
Z2dlcikgewogICAgICAgICAgICAgZnByaW50ZihzdGRlcnIsICJQViBjb250cm9sIGludGVyZmFj
ZSBub3QgYXZhaWxhYmxlOiIKQEAgLTEzNiw3ICsxMzYsNyBAQCBzdGF0aWMgdm9pZCBzaHV0ZG93
bl9kb21haW4odWludDMyX3QgZG9taWQsCiAgICAgaW50IHJjOwogCiAgICAgZnByaW50ZihzdGRl
cnIsICJTaHV0dGluZyBkb3duIGRvbWFpbiAldVxuIiwgZG9taWQpOwotICAgIHJjPWxpYnhsX2Rv
bWFpbl9zaHV0ZG93bihjdHgsIGRvbWlkKTsKKyAgICByYyA9IGxpYnhsX2RvbWFpbl9zaHV0ZG93
bihjdHgsIGRvbWlkLCBOVUxMKTsKICAgICBpZiAocmMgPT0gRVJST1JfTk9QQVJBVklSVCkgewog
ICAgICAgICBpZiAoZmFsbGJhY2tfdHJpZ2dlcikgewogICAgICAgICAgICAgZnByaW50ZihzdGRl
cnIsICJQViBjb250cm9sIGludGVyZmFjZSBub3QgYXZhaWxhYmxlOiIKLS0gCjIuMjMuMAoKCl9f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBt
YWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMu
eGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

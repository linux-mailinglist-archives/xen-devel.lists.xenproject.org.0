Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 968E1B802E
	for <lists+xen-devel@lfdr.de>; Thu, 19 Sep 2019 19:43:09 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iB0QK-0004EN-8t; Thu, 19 Sep 2019 17:40:56 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=vwgP=XO=citrix.com=anthony.perard@srs-us1.protection.inumbo.net>)
 id 1iB0QJ-0004Dp-A0
 for xen-devel@lists.xenproject.org; Thu, 19 Sep 2019 17:40:55 +0000
X-Inumbo-ID: 9a99338c-db04-11e9-966e-12813bfff9fa
Received: from esa4.hc3370-68.iphmx.com (unknown [216.71.155.144])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 9a99338c-db04-11e9-966e-12813bfff9fa;
 Thu, 19 Sep 2019 17:40:43 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1568914843;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=YcdgtDOS0It6R3sB2Vb/MCDmoZKjt5H1K1hjKlUsM44=;
 b=QGRTMqGa9IFVJxBXsBJF1SNoOUFGGsZCcFk3kM8Z5iRI2d3nl9vWmvat
 atCL2BnQpsZ5gDrzkcPHN7MWqDamNxEJR6oDsj8flOzfFNZf5RJPRcpJl
 Nb/yRkfUgzHglhXUMZ4JGHatfEvsybTKpr9JQUsp88MISW1CYi5hkvpek A=;
Authentication-Results: esa4.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=anthony.perard@citrix.com;
 spf=Pass smtp.mailfrom=anthony.perard@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa4.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 anthony.perard@citrix.com) identity=pra;
 client-ip=162.221.158.21; receiver=esa4.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="anthony.perard@citrix.com";
 x-conformance=sidf_compatible
Received-SPF: Pass (esa4.hc3370-68.iphmx.com: domain of
 anthony.perard@citrix.com designates 162.221.158.21 as
 permitted sender) identity=mailfrom;
 client-ip=162.221.158.21; receiver=esa4.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="anthony.perard@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83 ~all"
Received-SPF: None (esa4.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa4.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: 6Tg0k52GRN330BqJtgh3ZdTPyS6a7YhqpLsEOa35yqHtdbd4F7oQ3zTu4V8WXTrDmGJGmr1liQ
 3dd11Citpm82b8e+RaYqhDonIEF5Qn/rF3W4JE/EM7PnjRoWjEXt3APGjWRc7tobN8ggzPfEtm
 B7I2zE2w8tsxnjXYc0oLagS1uY5XhqpGrmsr/f3/JbihKDXfcByYsosjUf3IlAnkXmVEDVHT/K
 dJxoeQmV2ljvAHbwrgMz9iaDWSqAHA1VcYGqH3vA+7IeRGvr5/07s9Gb4P5pfyDb9AJEkVCiw/
 tgA=
X-SBRS: 2.7
X-MesageID: 6125207
X-Ironport-Server: esa4.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.64,524,1559534400"; 
   d="scan'208";a="6125207"
From: Anthony PERARD <anthony.perard@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Thu, 19 Sep 2019 18:16:52 +0100
Message-ID: <20190919171656.899649-33-anthony.perard@citrix.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190919171656.899649-1-anthony.perard@citrix.com>
References: <20190919171656.899649-1-anthony.perard@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v2 32/35] libxl: Use ev_qmp in
 libxl_set_vcpuonline
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Anthony PERARD <anthony.perard@citrix.com>, Ian
 Jackson <ian.jackson@eu.citrix.com>, Wei Liu <wl@xen.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

UmVtb3ZlZCBsaWJ4bF9fcW1wX2NwdV9hZGQgc2luY2UgaXQncyBub3QgdXNlZCBhbnltb3JlLgoK
YGNwdW1hcCcgYXJnIG9mIGxpYnhsX19zZXRfdmNwdW9ubGluZV94ZW5zdG9yZSBpcyBjb25zdGlm
aWVkLgoKVGhlIFFNUCBjb21tYW5kICJxdWVyeS1jcHVzIiBpcyBnb2luZyB0byBiZSBjYWxsZWQg
ZnJvbSBkaWZmZXJlbnQKcGxhY2VzLCBzbyB0aGUgYWxnb3JpdGhtIHRoYXQgcGFyc2UgdGhlIGFu
c3dlciBpcyBpbiBhIHNlcGFyYXRlCmZ1bmN0aW9uLCBxbXBfcGFyc2VfcXVlcnlfY3B1cy4KClNp
Z25lZC1vZmYtYnk6IEFudGhvbnkgUEVSQVJEIDxhbnRob255LnBlcmFyZEBjaXRyaXguY29tPgot
LS0KCk5vdGVzOgogICAgdjI6CiAgICAtIHRoZSBwYXRjaCAibGlieGw6IEV4dHJhY3QgcW1wX3Bh
cnNlX3F1ZXJ5X2NwdXMiIGhhdmUgYmVlbiBzcXVhc2hlZAogICAgICBpbnRvIHRoaXMgb25lLgoK
IHRvb2xzL2xpYnhsL2xpYnhsX2RvbWFpbi5jICAgfCAyMDQgKysrKysrKysrKysrKysrKysrKysr
KysrKysrLS0tLS0tLS0KIHRvb2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmggfCAgIDIgLQogdG9v
bHMvbGlieGwvbGlieGxfcW1wLmMgICAgICB8ICAgOSAtLQogMyBmaWxlcyBjaGFuZ2VkLCAxNTgg
aW5zZXJ0aW9ucygrKSwgNTcgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwv
bGlieGxfZG9tYWluLmMgYi90b29scy9saWJ4bC9saWJ4bF9kb21haW4uYwppbmRleCAwOGQzZmM5
ZmJjMDMuLmI5N2U4NzRhOWMwNSAxMDA2NDQKLS0tIGEvdG9vbHMvbGlieGwvbGlieGxfZG9tYWlu
LmMKKysrIGIvdG9vbHMvbGlieGwvbGlieGxfZG9tYWluLmMKQEAgLTE0MzIsOCArMTQzMiw4IEBA
IGxpYnhsX3ZjcHVpbmZvICpsaWJ4bF9saXN0X3ZjcHUobGlieGxfY3R4ICpjdHgsIHVpbnQzMl90
IGRvbWlkLAogfQogCiBzdGF0aWMgaW50IGxpYnhsX19zZXRfdmNwdW9ubGluZV94ZW5zdG9yZShs
aWJ4bF9fZ2MgKmdjLCB1aW50MzJfdCBkb21pZCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgbGlieGxfYml0bWFwICpjcHVtYXAsCi0gICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxpYnhsX2RvbWluZm8gKmluZm8pCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsaWJ4bF9iaXRtYXAgKmNw
dW1hcCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxp
YnhsX2RvbWluZm8gKmluZm8pCiB7CiAgICAgY2hhciAqZG9tcGF0aDsKICAgICB4c190cmFuc2Fj
dGlvbl90IHQ7CkBAIC0xNDU3LDU1ICsxNDU3LDc2IEBAIHN0YXRpYyBpbnQgbGlieGxfX3NldF92
Y3B1b25saW5lX3hlbnN0b3JlKGxpYnhsX19nYyAqZ2MsIHVpbnQzMl90IGRvbWlkLAogICAgIHJl
dHVybiByYzsKIH0KIAotc3RhdGljIGludCBsaWJ4bF9fc2V0X3ZjcHVvbmxpbmVfcW1wKGxpYnhs
X19nYyAqZ2MsIHVpbnQzMl90IGRvbWlkLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGxpYnhsX2JpdG1hcCAqY3B1bWFwLAotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGNvbnN0IGxpYnhsX2RvbWluZm8gKmluZm8pCitzdGF0aWMgaW50IHFtcF9wYXJz
ZV9xdWVyeV9jcHVzKGxpYnhsX19nYyAqZ2MsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGxpYnhsX2RvbWlkIGRvbWlkLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBj
b25zdCBsaWJ4bF9fanNvbl9vYmplY3QgKnJlc3BvbnNlLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBsaWJ4bF9iaXRtYXAgKmNvbnN0IG1hcCkKIHsKLSAgICBpbnQgaSwgcmM7Ci0g
ICAgbGlieGxfYml0bWFwIGN1cnJlbnRfbWFwLCBmaW5hbF9tYXA7CisgICAgaW50IGk7CisgICAg
Y29uc3QgbGlieGxfX2pzb25fb2JqZWN0ICpjcHU7CiAKLSAgICBsaWJ4bF9iaXRtYXBfaW5pdCgm
Y3VycmVudF9tYXApOwotICAgIGxpYnhsX2JpdG1hcF9pbml0KCZmaW5hbF9tYXApOwotCi0gICAg
bGlieGxfYml0bWFwX2FsbG9jKENUWCwgJmN1cnJlbnRfbWFwLCBpbmZvLT52Y3B1X21heF9pZCAr
IDEpOwotICAgIGxpYnhsX2JpdG1hcF9zZXRfbm9uZSgmY3VycmVudF9tYXApOwotICAgIHJjID0g
bGlieGxfX3FtcF9xdWVyeV9jcHVzKGdjLCBkb21pZCwgJmN1cnJlbnRfbWFwKTsKLSAgICBpZiAo
cmMpIHsKLSAgICAgICAgTE9HRChFUlJPUiwgZG9taWQsICJGYWlsZWQgdG8gcXVlcnkgY3B1cyIp
OwotICAgICAgICBnb3RvIG91dDsKLSAgICB9Ci0KLSAgICBsaWJ4bF9iaXRtYXBfY29weV9hbGxv
YyhDVFgsICZmaW5hbF9tYXAsIGNwdW1hcCk7Ci0KLSAgICBsaWJ4bF9mb3JfZWFjaF9zZXRfYml0
KGksIGN1cnJlbnRfbWFwKQotICAgICAgICBsaWJ4bF9iaXRtYXBfcmVzZXQoJmZpbmFsX21hcCwg
aSk7Ci0KLSAgICBsaWJ4bF9mb3JfZWFjaF9zZXRfYml0KGksIGZpbmFsX21hcCkgewotICAgICAg
ICByYyA9IGxpYnhsX19xbXBfY3B1X2FkZChnYywgZG9taWQsIGkpOwotICAgICAgICBpZiAocmMp
IHsKLSAgICAgICAgICAgIExPR0QoRVJST1IsIGRvbWlkLCAiRmFpbGVkIHRvIGFkZCBjcHUgJWQi
LCBpKTsKLSAgICAgICAgICAgIGdvdG8gb3V0OworICAgIGxpYnhsX2JpdG1hcF9zZXRfbm9uZSht
YXApOworICAgIC8qIFBhcnNlIHJlc3BvbnNlIHRvIFFNUCBjb21tYW5kICJxdWVyeS1jcHVzIjoK
KyAgICAgKiBbIHsgJ0NQVSc6ICdpbnQnLC4uLn0gXQorICAgICAqLworICAgIGZvciAoaSA9IDA7
IChjcHUgPSBsaWJ4bF9fanNvbl9hcnJheV9nZXQocmVzcG9uc2UsIGkpKTsgaSsrKSB7CisgICAg
ICAgIHVuc2lnbmVkIGludCBjcHVfaW5kZXg7CisgICAgICAgIGNvbnN0IGxpYnhsX19qc29uX29i
amVjdCAqbzsKKworICAgICAgICBvID0gbGlieGxfX2pzb25fbWFwX2dldCgiQ1BVIiwgY3B1LCBK
U09OX0lOVEVHRVIpOworICAgICAgICBpZiAoIW8pIHsKKyAgICAgICAgICAgIExPR0QoRVJST1Is
IGRvbWlkLCAiRmFpbGVkIHRvIHJldHJpZXZlIENQVSBpbmRleC4iKTsKKyAgICAgICAgICAgIHJl
dHVybiBFUlJPUl9RRU1VX0FQSTsKICAgICAgICAgfQorCisgICAgICAgIGNwdV9pbmRleCA9IGxp
YnhsX19qc29uX29iamVjdF9nZXRfaW50ZWdlcihvKTsKKyAgICAgICAgbGlieGxfYml0bWFwX3Nl
dChtYXAsIGNwdV9pbmRleCk7CiAgICAgfQogCi0gICAgcmMgPSAwOwotb3V0OgotICAgIGxpYnhs
X2JpdG1hcF9kaXNwb3NlKCZjdXJyZW50X21hcCk7Ci0gICAgbGlieGxfYml0bWFwX2Rpc3Bvc2Uo
JmZpbmFsX21hcCk7Ci0gICAgcmV0dXJuIHJjOworICAgIHJldHVybiAwOwogfQogCit0eXBlZGVm
IHN0cnVjdCBzZXRfdmNwdW9ubGluZV9zdGF0ZSB7CisgICAgbGlieGxfX2V2X3FtcCBxbXA7Cisg
ICAgbGlieGxfX2V2X3RpbWUgdGltZW91dDsKKyAgICBjb25zdCBsaWJ4bF9iaXRtYXAgKmNwdW1h
cDsKKyAgICBsaWJ4bF9kb21pbmZvIGluZm87CisgICAgbGlieGxfYml0bWFwIGZpbmFsX21hcDsK
KyAgICBpbnQgaW5kZXg7IC8qIGZvciBsb29wIG9uIGZpbmFsX21hcCAqLworfSBzZXRfdmNwdW9u
bGluZV9zdGF0ZTsKKworc3RhdGljIHZvaWQgc2V0X3ZjcHVvbmxpbmVfcW1wX2NwdXNfcXVlcmll
ZChsaWJ4bF9fZWdjICosCisgICAgbGlieGxfX2V2X3FtcCAqLCBjb25zdCBsaWJ4bF9fanNvbl9v
YmplY3QgKiwgaW50IHJjKTsKK3N0YXRpYyB2b2lkIHNldF92Y3B1b25saW5lX3FtcF9hZGRfY3B1
KGxpYnhsX19lZ2MgKiwKKyAgICBsaWJ4bF9fZXZfcW1wICosIGNvbnN0IGxpYnhsX19qc29uX29i
amVjdCAqcmVzcG9uc2UsIGludCByYyk7CitzdGF0aWMgdm9pZCBzZXRfdmNwdW9ubGluZV90aW1l
b3V0KGxpYnhsX19lZ2MgKmVnYywKKyAgICBsaWJ4bF9fZXZfdGltZSAqZXYsIGNvbnN0IHN0cnVj
dCB0aW1ldmFsICpyZXF1ZXN0ZWRfYWJzLCBpbnQgcmMpOworc3RhdGljIHZvaWQgc2V0X3ZjcHVv
bmxpbmVfZG9uZShsaWJ4bF9fZWdjICplZ2MsCisgICAgc2V0X3ZjcHVvbmxpbmVfc3RhdGUgKnN2
b3MsIGludCByYyk7CisKIGludCBsaWJ4bF9zZXRfdmNwdW9ubGluZShsaWJ4bF9jdHggKmN0eCwg
dWludDMyX3QgZG9taWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgbGlieGxfYml0bWFwICpj
cHVtYXAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGlieGxfYXN5bmNvcF9ob3cg
KmFvX2hvdykKIHsKICAgICBBT19DUkVBVEUoY3R4LCBkb21pZCwgYW9faG93KTsKICAgICBpbnQg
cmMsIG1heGNwdXM7Ci0gICAgbGlieGxfZG9taW5mbyBpbmZvOworICAgIHNldF92Y3B1b25saW5l
X3N0YXRlICpzdm9zOworCisgICAgR0NORVcoc3Zvcyk7CisgICAgbGlieGxfX2V2X3FtcF9pbml0
KCZzdm9zLT5xbXApOworICAgIHN2b3MtPnFtcC5hbyA9IGFvOworICAgIHN2b3MtPnFtcC5kb21p
ZCA9IGRvbWlkOworICAgIHN2b3MtPnFtcC5wYXlsb2FkX2ZkID0gLTE7CisgICAgbGlieGxfX2V2
X3RpbWVfaW5pdCgmc3Zvcy0+dGltZW91dCk7CisgICAgc3Zvcy0+Y3B1bWFwID0gY3B1bWFwOwor
ICAgIGxpYnhsX2RvbWluZm9faW5pdCgmc3Zvcy0+aW5mbyk7CisgICAgbGlieGxfYml0bWFwX2lu
aXQoJnN2b3MtPmZpbmFsX21hcCk7CiAKLSAgICBsaWJ4bF9kb21pbmZvX2luaXQoJmluZm8pOwor
ICAgIC8qIENvbnZlbmllbmNlIGFsaWFzZXMgKi8KKyAgICBsaWJ4bF9kb21pbmZvICppbmZvID0g
JnN2b3MtPmluZm87CisgICAgbGlieGxfX2V2X3FtcCAqcW1wID0gJnN2b3MtPnFtcDsKIAotICAg
IHJjID0gbGlieGxfZG9tYWluX2luZm8oQ1RYLCAmaW5mbywgZG9taWQpOworICAgIHJjID0gbGli
eGxfZG9tYWluX2luZm8oQ1RYLCBpbmZvLCBkb21pZCk7CiAgICAgaWYgKHJjIDwgMCkgewogICAg
ICAgICBMT0dFRChFUlJPUiwgZG9taWQsICJHZXR0aW5nIGRvbWFpbiBpbmZvIGxpc3QiKTsKICAg
ICAgICAgZ290byBvdXQ7CkBAIC0xNTE4LDEwICsxNTM5LDEwIEBAIGludCBsaWJ4bF9zZXRfdmNw
dW9ubGluZShsaWJ4bF9jdHggKmN0eCwgdWludDMyX3QgZG9taWQsCiAgICAgICAgIHJjID0gRVJS
T1JfRkFJTDsKICAgICAgICAgZ290byBvdXQ7CiAgICAgfQotICAgIGlmIChtYXhjcHVzID4gaW5m
by52Y3B1X21heF9pZCArIDEpCisgICAgaWYgKG1heGNwdXMgPiBpbmZvLT52Y3B1X21heF9pZCAr
IDEpCiAgICAgewogICAgICAgICBMT0dFRChFUlJPUiwgZG9taWQsICJSZXF1ZXN0ZWQgJWQgVkNQ
VXMsIGhvd2V2ZXIgbWF4Y3B1cyBpcyAlZCEiLAotICAgICAgICAgICAgICBtYXhjcHVzLCBpbmZv
LnZjcHVfbWF4X2lkICsgMSk7CisgICAgICAgICAgICAgIG1heGNwdXMsIGluZm8tPnZjcHVfbWF4
X2lkICsgMSk7CiAgICAgICAgIHJjID0gRVJST1JfRkFJTDsKICAgICAgICAgZ290byBvdXQ7CiAg
ICAgfQpAQCAtMTUzMiw4ICsxNTUzLDE0IEBAIGludCBsaWJ4bF9zZXRfdmNwdW9ubGluZShsaWJ4
bF9jdHggKmN0eCwgdWludDMyX3QgZG9taWQsCiAgICAgICAgIGNhc2UgTElCWExfREVWSUNFX01P
REVMX1ZFUlNJT05fUUVNVV9YRU5fVFJBRElUSU9OQUw6CiAgICAgICAgICAgICBicmVhazsKICAg
ICAgICAgY2FzZSBMSUJYTF9ERVZJQ0VfTU9ERUxfVkVSU0lPTl9RRU1VX1hFTjoKLSAgICAgICAg
ICAgIHJjID0gbGlieGxfX3NldF92Y3B1b25saW5lX3FtcChnYywgZG9taWQsIGNwdW1hcCwgJmlu
Zm8pOwotICAgICAgICAgICAgYnJlYWs7CisgICAgICAgICAgICByYyA9IGxpYnhsX19ldl90aW1l
X3JlZ2lzdGVyX3JlbChhbywgJnN2b3MtPnRpbWVvdXQsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBzZXRfdmNwdW9ubGluZV90aW1lb3V0LAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTElCWExfUU1QX0NNRF9USU1FT1VU
ICogMTAwMCk7CisgICAgICAgICAgICBpZiAocmMpIGdvdG8gb3V0OworICAgICAgICAgICAgcW1w
LT5jYWxsYmFjayA9IHNldF92Y3B1b25saW5lX3FtcF9jcHVzX3F1ZXJpZWQ7CisgICAgICAgICAg
ICByYyA9IGxpYnhsX19ldl9xbXBfc2VuZChnYywgcW1wLCAicXVlcnktY3B1cyIsIE5VTEwpOwor
ICAgICAgICAgICAgaWYgKHJjKSBnb3RvIG91dDsKKyAgICAgICAgICAgIHJldHVybiBBT19JTlBS
T0dSRVNTOwogICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgcmMgPSBFUlJPUl9JTlZBTDsK
ICAgICAgICAgfQpAQCAtMTU0NSwxNSArMTU3MiwxMDAgQEAgaW50IGxpYnhsX3NldF92Y3B1b25s
aW5lKGxpYnhsX2N0eCAqY3R4LCB1aW50MzJfdCBkb21pZCwKICAgICAgICAgcmMgPSBFUlJPUl9J
TlZBTDsKICAgICB9CiAKLSAgICBpZiAoIXJjKQotICAgICAgICByYyA9IGxpYnhsX19zZXRfdmNw
dW9ubGluZV94ZW5zdG9yZShnYywgZG9taWQsIGNwdW1hcCwgJmluZm8pOworb3V0OgorICAgIHNl
dF92Y3B1b25saW5lX2RvbmUoZWdjLCBzdm9zLCByYyk7IC8qIG11c3QgYmUgbGFzdCAqLworICAg
IHJldHVybiBBT19JTlBST0dSRVNTOworfQorCitzdGF0aWMgdm9pZCBzZXRfdmNwdW9ubGluZV9x
bXBfY3B1c19xdWVyaWVkKGxpYnhsX19lZ2MgKmVnYywKKyAgICBsaWJ4bF9fZXZfcW1wICpxbXAs
IGNvbnN0IGxpYnhsX19qc29uX29iamVjdCAqcmVzcG9uc2UsIGludCByYykKK3sKKyAgICBFR0Nf
R0M7CisgICAgc2V0X3ZjcHVvbmxpbmVfc3RhdGUgKnN2b3MgPSBDT05UQUlORVJfT0YocW1wLCAq
c3ZvcywgcW1wKTsKKyAgICBpbnQgaTsKKyAgICBsaWJ4bF9iaXRtYXAgY3VycmVudF9tYXA7CisK
KyAgICAvKiBDb252ZW5pZW5jZSBhbGlhc2VzICovCisgICAgbGlieGxfYml0bWFwICpmaW5hbF9t
YXAgPSAmc3Zvcy0+ZmluYWxfbWFwOworCisgICAgbGlieGxfYml0bWFwX2luaXQoJmN1cnJlbnRf
bWFwKTsKKworICAgIGlmIChyYykgZ290byBvdXQ7CisKKyAgICBsaWJ4bF9iaXRtYXBfYWxsb2Mo
Q1RYLCAmY3VycmVudF9tYXAsIHN2b3MtPmluZm8udmNwdV9tYXhfaWQgKyAxKTsKKyAgICByYyA9
IHFtcF9wYXJzZV9xdWVyeV9jcHVzKGdjLCBxbXAtPmRvbWlkLCByZXNwb25zZSwgJmN1cnJlbnRf
bWFwKTsKKyAgICBpZiAocmMpIGdvdG8gb3V0OworCisgICAgbGlieGxfYml0bWFwX2NvcHlfYWxs
b2MoQ1RYLCBmaW5hbF9tYXAsIHN2b3MtPmNwdW1hcCk7CisKKyAgICBsaWJ4bF9mb3JfZWFjaF9z
ZXRfYml0KGksIGN1cnJlbnRfbWFwKSB7CisgICAgICAgIGxpYnhsX2JpdG1hcF9yZXNldChmaW5h
bF9tYXAsIGkpOworICAgIH0KIAogb3V0OgotICAgIGxpYnhsX2RvbWluZm9fZGlzcG9zZSgmaW5m
byk7Ci0gICAgaWYgKHJjKQotICAgICAgICByZXR1cm4gQU9fQ1JFQVRFX0ZBSUwocmMpOworICAg
IGxpYnhsX2JpdG1hcF9kaXNwb3NlKCZjdXJyZW50X21hcCk7CisgICAgc3Zvcy0+aW5kZXggPSAt
MTsKKyAgICBzZXRfdmNwdW9ubGluZV9xbXBfYWRkX2NwdShlZ2MsIHFtcCwgTlVMTCwgcmMpOyAv
KiBtdXN0IGJlIGxhc3QgKi8KK30KKworc3RhdGljIHZvaWQgc2V0X3ZjcHVvbmxpbmVfcW1wX2Fk
ZF9jcHUobGlieGxfX2VnYyAqZWdjLAorICAgIGxpYnhsX19ldl9xbXAgKnFtcCwgY29uc3QgbGli
eGxfX2pzb25fb2JqZWN0ICpyZXNwb25zZSwgaW50IHJjKQoreworICAgIFNUQVRFX0FPX0dDKHFt
cC0+YW8pOworICAgIHNldF92Y3B1b25saW5lX3N0YXRlICpzdm9zID0gQ09OVEFJTkVSX09GKHFt
cCwgKnN2b3MsIHFtcCk7CisgICAgbGlieGxfX2pzb25fb2JqZWN0ICphcmdzID0gTlVMTDsKKwor
ICAgIC8qIENvbnZlbmllbmNlIGFsaWFzZXMgKi8KKyAgICBsaWJ4bF9iaXRtYXAgKm1hcCA9ICZz
dm9zLT5maW5hbF9tYXA7CisKKyAgICBpZiAocmMpIGdvdG8gb3V0OworCisgICAgd2hpbGUgKGxp
YnhsX2JpdG1hcF9jcHVfdmFsaWQobWFwLCArK3N2b3MtPmluZGV4KSkgeworICAgICAgICBpZiAo
bGlieGxfYml0bWFwX3Rlc3QobWFwLCBzdm9zLT5pbmRleCkpIHsKKyAgICAgICAgICAgIHFtcC0+
Y2FsbGJhY2sgPSBzZXRfdmNwdW9ubGluZV9xbXBfYWRkX2NwdTsKKyAgICAgICAgICAgIGxpYnhs
X19xbXBfcGFyYW1fYWRkX2ludGVnZXIoZ2MsICZhcmdzLCAiaWQiLCBzdm9zLT5pbmRleCk7Cisg
ICAgICAgICAgICByYyA9IGxpYnhsX19ldl9xbXBfc2VuZChnYywgcW1wLCAiY3B1LWFkZCIsIGFy
Z3MpOworICAgICAgICAgICAgaWYgKHJjKSBnb3RvIG91dDsKKyAgICAgICAgICAgIHJldHVybjsK
KyAgICAgICAgfQorICAgIH0KKworb3V0OgorICAgIHNldF92Y3B1b25saW5lX2RvbmUoZWdjLCBz
dm9zLCByYyk7Cit9CisKK3N0YXRpYyB2b2lkIHNldF92Y3B1b25saW5lX3RpbWVvdXQobGlieGxf
X2VnYyAqZWdjLCBsaWJ4bF9fZXZfdGltZSAqZXYsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGNvbnN0IHN0cnVjdCB0aW1ldmFsICpyZXF1ZXN0ZWRfYWJzLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgcmMpCit7CisgICAgRUdDX0dDOworICAgIHNl
dF92Y3B1b25saW5lX3N0YXRlICpzdm9zID0gQ09OVEFJTkVSX09GKGV2LCAqc3ZvcywgdGltZW91
dCk7CisKKyAgICBpZiAocmMgPT0gRVJST1JfVElNRURPVVQpCisgICAgICAgIExPR0QoRVJST1Is
IHN2b3MtPnFtcC5kb21pZCwKKyAgICAgICAgICAgICAiU2V0dGluZyBDUFUgb25saW5lIGluIFFF
TVUgdGltZWQgb3V0Iik7CisKKyAgICBzZXRfdmNwdW9ubGluZV9kb25lKGVnYywgc3ZvcywgcmMp
OworfQorCitzdGF0aWMgdm9pZCBzZXRfdmNwdW9ubGluZV9kb25lKGxpYnhsX19lZ2MgKmVnYywK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0X3ZjcHVvbmxpbmVfc3RhdGUgKnN2
b3MsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCByYykKK3sKKyAgICBTVEFU
RV9BT19HQyhzdm9zLT5xbXAuYW8pOworCisgICAgLyogQ29udmVuaWVuY2UgYWxpYXNlcyAqLwor
ICAgIGxpYnhsX2RvbWlkIGRvbWlkID0gc3Zvcy0+cW1wLmRvbWlkOworCisgICAgaWYgKCFyYykK
KyAgICAgICAgcmMgPSBsaWJ4bF9fc2V0X3ZjcHVvbmxpbmVfeGVuc3RvcmUoZ2MsIGRvbWlkLCBz
dm9zLT5jcHVtYXAsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICZzdm9zLT5pbmZvKTsKKworICAgIGxpYnhsX2JpdG1hcF9kaXNwb3NlKCZzdm9zLT5maW5hbF9t
YXApOworICAgIGxpYnhsX2RvbWluZm9fZGlzcG9zZSgmc3Zvcy0+aW5mbyk7CisgICAgbGlieGxf
X2V2X3RpbWVfZGVyZWdpc3RlcihnYywgJnN2b3MtPnRpbWVvdXQpOworICAgIGxpYnhsX19ldl9x
bXBfZGlzcG9zZShnYywgJnN2b3MtPnFtcCk7CiAgICAgbGlieGxfX2FvX2NvbXBsZXRlKGVnYywg
YW8sIHJjKTsKLSAgICByZXR1cm4gQU9fSU5QUk9HUkVTUzsKIH0KIAogc3RhdGljIHZvaWQgZG9t
YWluX3MzX3Jlc3VtZV9kb25lKGxpYnhsX19lZ2MgKmVnYywgbGlieGxfX2V2X3FtcCAqcW1wLApk
aWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGlieGxfaW50ZXJuYWwuaCBiL3Rvb2xzL2xpYnhsL2xp
YnhsX2ludGVybmFsLmgKaW5kZXggN2FhMWE2YTkyNDA5Li4xZWNlYmYxMzY5ODQgMTAwNjQ0Ci0t
LSBhL3Rvb2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmgKKysrIGIvdG9vbHMvbGlieGwvbGlieGxf
aW50ZXJuYWwuaApAQCAtMTk4OCw4ICsxOTg4LDYgQEAgX2hpZGRlbiBsaWJ4bF9fcW1wX2hhbmRs
ZXIgKmxpYnhsX19xbXBfaW5pdGlhbGl6ZShsaWJ4bF9fZ2MgKmdjLAogX2hpZGRlbiBpbnQgbGli
eGxfX3FtcF9yZXN1bWUobGlieGxfX2djICpnYywgaW50IGRvbWlkKTsKIC8qIExvYWQgY3VycmVu
dCBRRU1VIHN0YXRlIGZyb20gZmlsZS4gKi8KIF9oaWRkZW4gaW50IGxpYnhsX19xbXBfcmVzdG9y
ZShsaWJ4bF9fZ2MgKmdjLCBpbnQgZG9taWQsIGNvbnN0IGNoYXIgKmZpbGVuYW1lKTsKLS8qIEFk
ZCBhIHZpcnR1YWwgQ1BVICovCi1faGlkZGVuIGludCBsaWJ4bF9fcW1wX2NwdV9hZGQobGlieGxf
X2djICpnYywgaW50IGRvbWlkLCBpbnQgaW5kZXgpOwogLyogUXVlcnkgdGhlIGJpdG1hcCBvZiBD
UFVzICovCiBfaGlkZGVuIGludCBsaWJ4bF9fcW1wX3F1ZXJ5X2NwdXMobGlieGxfX2djICpnYywg
aW50IGRvbWlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnhsX2JpdG1h
cCAqbWFwKTsKZGlmZiAtLWdpdCBhL3Rvb2xzL2xpYnhsL2xpYnhsX3FtcC5jIGIvdG9vbHMvbGli
eGwvbGlieGxfcW1wLmMKaW5kZXggNDAwNDNhMGE0NWIyLi4yNzE4M2JjNmM0YTMgMTAwNjQ0Ci0t
LSBhL3Rvb2xzL2xpYnhsL2xpYnhsX3FtcC5jCisrKyBiL3Rvb2xzL2xpYnhsL2xpYnhsX3FtcC5j
CkBAIC03NjcsMTUgKzc2Nyw2IEBAIGludCBsaWJ4bF9fcW1wX3Jlc3VtZShsaWJ4bF9fZ2MgKmdj
LCBpbnQgZG9taWQpCiAgICAgcmV0dXJuIHFtcF9ydW5fY29tbWFuZChnYywgZG9taWQsICJjb250
IiwgTlVMTCwgTlVMTCwgTlVMTCk7CiB9CiAKLWludCBsaWJ4bF9fcW1wX2NwdV9hZGQobGlieGxf
X2djICpnYywgaW50IGRvbWlkLCBpbnQgaWR4KQotewotICAgIGxpYnhsX19qc29uX29iamVjdCAq
YXJncyA9IE5VTEw7Ci0KLSAgICBsaWJ4bF9fcW1wX3BhcmFtX2FkZF9pbnRlZ2VyKGdjLCAmYXJn
cywgImlkIiwgaWR4KTsKLQotICAgIHJldHVybiBxbXBfcnVuX2NvbW1hbmQoZ2MsIGRvbWlkLCAi
Y3B1LWFkZCIsIGFyZ3MsIE5VTEwsIE5VTEwpOwotfQotCiBzdGF0aWMgaW50IHF1ZXJ5X2NwdXNf
Y2FsbGJhY2sobGlieGxfX3FtcF9oYW5kbGVyICpxbXAsCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgY29uc3QgbGlieGxfX2pzb25fb2JqZWN0ICpyZXNwb25zZSwKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICB2b2lkICpvcGFxdWUpCi0tIApBbnRob255IFBFUkFSRAoKCl9f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBt
YWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMu
eGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 6F3FE12A199
	for <lists+xen-devel@lfdr.de>; Tue, 24 Dec 2019 14:07:16 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1ijjrU-0005Jl-FN; Tue, 24 Dec 2019 13:04:32 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=ZIBU=2O=amazon.com=prvs=254c36092=pdurrant@srs-us1.protection.inumbo.net>)
 id 1ijjrS-0005Jg-QI
 for xen-devel@lists.xenproject.org; Tue, 24 Dec 2019 13:04:30 +0000
X-Inumbo-ID: ec36c21a-264d-11ea-88e7-bc764e2007e4
Received: from smtp-fw-2101.amazon.com (unknown [72.21.196.25])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id ec36c21a-264d-11ea-88e7-bc764e2007e4;
 Tue, 24 Dec 2019 13:04:30 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amazon.com; i=@amazon.com; q=dns/txt; s=amazon201209;
 t=1577192671; x=1608728671;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=4er4aabZxAAP3Rixtz+L7ZX3xEDnIZOQ1o/sNLOEz9s=;
 b=I2MW6jPYEiurMhwWXdF35t0nU+5v7PB6GJvrblpfdN+F+H78sgcS10bR
 KldXbzL2bJnGz4Qsh9wH+dqleFhsv9PmqM74xFv3HDVFfu6KWXvjMt3p0
 DMRmnwe+6E3b8O4FXh4RBd0zg6+jn3e7unnlsd/WqduqUDMPs6M7jozUt U=;
IronPort-SDR: ut5495J8PJjLX3iUEedzGfKsCb+GjBBYxyQ8wglAzmNlc5QALIgpSP1rcWq+4TqzLUnsLekj67
 /fLNuBUCiMhA==
X-IronPort-AV: E=Sophos;i="5.69,351,1571702400"; 
   d="scan'208";a="9936002"
Received: from iad12-co-svc-p1-lb1-vlan2.amazon.com (HELO
 email-inbound-relay-1e-c7c08562.us-east-1.amazon.com) ([10.43.8.2])
 by smtp-border-fw-out-2101.iad2.amazon.com with ESMTP;
 24 Dec 2019 13:04:30 +0000
Received: from EX13MTAUEA002.ant.amazon.com
 (iad55-ws-svc-p15-lb9-vlan2.iad.amazon.com [10.40.159.162])
 by email-inbound-relay-1e-c7c08562.us-east-1.amazon.com (Postfix) with ESMTPS
 id ECE07242180; Tue, 24 Dec 2019 13:04:28 +0000 (UTC)
Received: from EX13D32EUB002.ant.amazon.com (10.43.166.114) by
 EX13MTAUEA002.ant.amazon.com (10.43.61.77) with Microsoft SMTP Server (TLS)
 id 15.0.1236.3; Tue, 24 Dec 2019 13:04:28 +0000
Received: from EX13MTAUWB001.ant.amazon.com (10.43.161.207) by
 EX13D32EUB002.ant.amazon.com (10.43.166.114) with Microsoft SMTP Server (TLS)
 id 15.0.1367.3; Tue, 24 Dec 2019 13:04:26 +0000
Received: from u2f063a87eabd5f.cbg10.amazon.com (10.125.106.135) by
 mail-relay.amazon.com (10.43.161.249) with Microsoft SMTP Server id
 15.0.1367.3 via Frontend Transport; Tue, 24 Dec 2019 13:04:24 +0000
From: Paul Durrant <pdurrant@amazon.com>
To: <xen-devel@lists.xenproject.org>
Date: Tue, 24 Dec 2019 13:04:12 +0000
Message-ID: <20191224130416.3570-3-pdurrant@amazon.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20191224130416.3570-1-pdurrant@amazon.com>
References: <20191224130416.3570-1-pdurrant@amazon.com>
MIME-Version: 1.0
Precedence: Bulk
Subject: [Xen-devel] [PATCH 2/6] libxl_create: make 'soft reset' explicit
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Anthony PERARD <anthony.perard@citrix.com>,
 Paul Durrant <pdurrant@amazon.com>, Ian Jackson <ian.jackson@eu.citrix.com>,
 Wei Liu <wl@xen.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhlICdzb2Z0IHJlc2V0JyBjb2RlIHBhdGggaW4gbGlieGxfX2RvbWFpbl9tYWtlKCkgaXMgY3Vy
cmVudGx5IHRha2VuIGlmIGEKdmFsaWQgZG9taWQgaXMgcGFzc2VkIGludG8gdGhlIGZ1bmN0aW9u
LiBBIHN1YnNlcXVlbnQgcGF0Y2ggd2lsbCBlbmFibGUKaGlnaGVyIGxldmVscyBvZiB0aGUgdG9v
bHN0YWNrIHRvIGRldGVybWluZSB0aGUgZG9taWQgb2YgbmV3bHkgY3JlYXRlZCBvcgpyZXN0b3Jl
ZCBkb21haW5zIGFuZCB0aGVyZWZvcmUgdGhpcyBjcml0ZXJpYSBmb3IgY2hvb3NpbmcgJ3NvZnQg
cmVzZXQnCndpbGwgbm8gbG9uZ2VyIGJlIHVzYWJsZS4KClRoaXMgcGF0Y2ggYWRkcyBhbiBleHRy
YSBib29sZWFuIG9wdGlvbiB0byBsaWJ4bF9fZG9tYWluX21ha2UoKSB0byBzcGVjaWZ5CndoZXRo
ZXIgaXQgaXMgYmVpbmcgaW52b2tlZCBpbiBzb2Z0IHJlc2V0IGNvbnRleHQgYW5kIGFwcHJvcHJp
YXRlbHkKbW9kaWZpZXMgY2FsbGVycyB0byBjaG9vc2UgdGhlIHJpZ2h0IHZhbHVlLiBUbyBmYWNp
bGl0YXRlIHRoaXMsIGEgbmV3Cidzb2Z0X3Jlc2V0JyBib29sZWFuIGZpZWxkIGlzIGFkZGVkIHRv
IHN0cnVjdCBsaWJ4bF9fZG9tYWluX2NyZWF0ZV9zdGF0ZQphbmQgdGhlICdkb21pZF9zb2Z0X3Jl
c2V0JyBmaWVsZCBpcyByZW5hbWVkIHRvICdkb21pZCcgaW4gYW50aWNpcGF0aW9uIG9mCml0cyB3
aWRlciByZW1pdC4gRm9yIHRoZSBtb21lbnQgZG9fZG9tYWluX2NyZWF0ZSgpIHdpbGwgYWx3YXlz
IHNldApkb21pZCB0byBJTlZBTElEX0RPTUlEIGFuZCBoZW5jZSB3ZSBjYW4gYWRkIGFuIGFzc2Vy
dGlvbiBpbnRvCmxpYnhsX19kb21haW5fY3JlYXRlKCkgdGhhdCwgaWYgaXQgaXMgbm90IGNhbGxl
ZCBpbiBzb2Z0IHJlc2V0IGNvbnRleHQsCnRoZSBwYXNzZWQgaW4gZG9taWQgaXMgZXhhY3RseSB0
aGF0IHZhbHVlLgoKV2hpbHN0IGluIHRoZSBuZWlnaGJvdXJob29kLCBzb21lIGNoZWNrcyBvZiAn
cmVzdG9yZV9mZCA+IC0xJyBoYXZlIGJlZW4KcmVwbGFjZWQgYnkgJ3Jlc3RvcmVfZmQgPj0gMCcg
dG8gYmUgbW9yZSBjb252ZW50aW9uYWwgYW5kIGNvbnNpc3RlbnQgd2l0aApjaGVja3Mgb2YgJ3Jl
c3RvcmVfZmQgPCAwJy4KClNpZ25lZC1vZmYtYnk6IFBhdWwgRHVycmFudCA8cGR1cnJhbnRAYW1h
em9uLmNvbT4KLS0tCkNjOiBJYW4gSmFja3NvbiA8aWFuLmphY2tzb25AZXUuY2l0cml4LmNvbT4K
Q2M6IFdlaSBMaXUgPHdsQHhlbi5vcmc+CkNjOiBBbnRob255IFBFUkFSRCA8YW50aG9ueS5wZXJh
cmRAY2l0cml4LmNvbT4KLS0tCiB0b29scy9saWJ4bC9saWJ4bF9jcmVhdGUuYyAgIHwgNTYgKysr
KysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tCiB0b29scy9saWJ4bC9saWJ4bF9kbS5j
ICAgICAgIHwgIDIgKy0KIHRvb2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmggfCAgNSArKy0tCiAz
IGZpbGVzIGNoYW5nZWQsIDM4IGluc2VydGlvbnMoKyksIDI1IGRlbGV0aW9ucygtKQoKZGlmZiAt
LWdpdCBhL3Rvb2xzL2xpYnhsL2xpYnhsX2NyZWF0ZS5jIGIvdG9vbHMvbGlieGwvbGlieGxfY3Jl
YXRlLmMKaW5kZXggYmM0MjVmZWUzMi4uMTgzNWE1NTAyYyAxMDA2NDQKLS0tIGEvdG9vbHMvbGli
eGwvbGlieGxfY3JlYXRlLmMKKysrIGIvdG9vbHMvbGlieGwvbGlieGxfY3JlYXRlLmMKQEAgLTUz
OCw3ICs1MzgsNyBAQCBvdXQ6CiAKIGludCBsaWJ4bF9fZG9tYWluX21ha2UobGlieGxfX2djICpn
YywgbGlieGxfZG9tYWluX2NvbmZpZyAqZF9jb25maWcsCiAgICAgICAgICAgICAgICAgICAgICAg
IGxpYnhsX19kb21haW5fYnVpbGRfc3RhdGUgKnN0YXRlLAotICAgICAgICAgICAgICAgICAgICAg
ICB1aW50MzJfdCAqZG9taWQpCisgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90ICpkb21p
ZCwgYm9vbCBzb2Z0X3Jlc2V0KQogewogICAgIGxpYnhsX2N0eCAqY3R4ID0gbGlieGxfX2djX293
bmVyKGdjKTsKICAgICBpbnQgcmV0LCByYywgbmJfdm07CkBAIC01NTUsMTQgKzU1NSwxNSBAQCBp
bnQgbGlieGxfX2RvbWFpbl9tYWtlKGxpYnhsX19nYyAqZ2MsIGxpYnhsX2RvbWFpbl9jb25maWcg
KmRfY29uZmlnLAogICAgIGxpYnhsX2RvbWFpbl9jcmVhdGVfaW5mbyAqaW5mbyA9ICZkX2NvbmZp
Zy0+Y19pbmZvOwogICAgIGxpYnhsX2RvbWFpbl9idWlsZF9pbmZvICpiX2luZm8gPSAmZF9jb25m
aWctPmJfaW5mbzsKIAorICAgIGFzc2VydChzb2Z0X3Jlc2V0IHx8ICpkb21pZCA9PSBJTlZBTElE
X0RPTUlEKTsKKwogICAgIHV1aWRfc3RyaW5nID0gbGlieGxfX3V1aWQyc3RyaW5nKGdjLCBpbmZv
LT51dWlkKTsKICAgICBpZiAoIXV1aWRfc3RyaW5nKSB7CiAgICAgICAgIHJjID0gRVJST1JfTk9N
RU07CiAgICAgICAgIGdvdG8gb3V0OwogICAgIH0KIAotICAgIC8qIFZhbGlkIGRvbWlkIGhlcmUg
bWVhbnMgd2UncmUgc29mdCByZXNldHRpbmcuICovCi0gICAgaWYgKCFsaWJ4bF9kb21pZF92YWxp
ZF9ndWVzdCgqZG9taWQpKSB7CisgICAgaWYgKCFzb2Z0X3Jlc2V0KSB7CiAgICAgICAgIHN0cnVj
dCB4ZW5fZG9tY3RsX2NyZWF0ZWRvbWFpbiBjcmVhdGUgPSB7CiAgICAgICAgICAgICAuc3NpZHJl
ZiA9IGluZm8tPnNzaWRyZWYsCiAgICAgICAgICAgICAubWF4X3ZjcHVzID0gYl9pbmZvLT5tYXhf
dmNwdXMsCkBAIC02MTEsNiArNjEyLDE0IEBAIGludCBsaWJ4bF9fZG9tYWluX21ha2UobGlieGxf
X2djICpnYywgbGlieGxfZG9tYWluX2NvbmZpZyAqZF9jb25maWcsCiAgICAgICAgICAgICBnb3Rv
IG91dDsKICAgICB9CiAKKyAgICAvKgorICAgICAqIElmIHNvZnRfcmVzZXQgaXMgc2V0IHRoZSB0
aGUgZG9taWQgd2lsbCBoYXZlIGJlZW4gdmFsaWQgb24gZW50cnkuCisgICAgICogSWYgaXQgd2Fz
IG5vdCBzZXQgdGhlbiB4Y19kb21haW5fY3JlYXRlKCkgc2hvdWxkIGhhdmUgYXNzaWduZWQgYQor
ICAgICAqIHZhbGlkIHZhbHVlLiBFaXRoZXIgd2F5LCBpZiB3ZSByZWFjaCB0aGlzIHBvaW50LCBk
b21pZCBzaG91bGQgYmUKKyAgICAgKiB2YWxpZC4KKyAgICAgKi8KKyAgICBhc3NlcnQobGlieGxf
ZG9taWRfdmFsaWRfZ3Vlc3QoKmRvbWlkKSk7CisKICAgICByZXQgPSB4Y19jcHVwb29sX21vdmVk
b21haW4oY3R4LT54Y2gsIGluZm8tPnBvb2xpZCwgKmRvbWlkKTsKICAgICBpZiAocmV0IDwgMCkg
ewogICAgICAgICBMT0dFRChFUlJPUiwgKmRvbWlkLCAiZG9tYWluIG1vdmUgZmFpbCIpOwpAQCAt
MTA5MSwxMyArMTEwMCwxNCBAQCBzdGF0aWMgdm9pZCBpbml0aWF0ZV9kb21haW5fY3JlYXRlKGxp
YnhsX19lZ2MgKmVnYywKICAgICBsaWJ4bF9kb21haW5fY29uZmlnICpjb25zdCBkX2NvbmZpZyA9
IGRjcy0+Z3Vlc3RfY29uZmlnOwogICAgIGNvbnN0IGludCByZXN0b3JlX2ZkID0gZGNzLT5yZXN0
b3JlX2ZkOwogCi0gICAgZG9taWQgPSBkY3MtPmRvbWlkX3NvZnRfcmVzZXQ7CisgICAgZG9taWQg
PSBkY3MtPmRvbWlkOwogICAgIGxpYnhsX19kb21haW5fYnVpbGRfc3RhdGVfaW5pdCgmZGNzLT5i
dWlsZF9zdGF0ZSk7CiAKICAgICByZXQgPSBsaWJ4bF9fZG9tYWluX2NvbmZpZ19zZXRkZWZhdWx0
KGdjLGRfY29uZmlnLGRvbWlkKTsKICAgICBpZiAocmV0KSBnb3RvIGVycm9yX291dDsKIAotICAg
IHJldCA9IGxpYnhsX19kb21haW5fbWFrZShnYywgZF9jb25maWcsICZkY3MtPmJ1aWxkX3N0YXRl
LCAmZG9taWQpOworICAgIHJldCA9IGxpYnhsX19kb21haW5fbWFrZShnYywgZF9jb25maWcsICZk
Y3MtPmJ1aWxkX3N0YXRlLCAmZG9taWQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRj
cy0+c29mdF9yZXNldCk7CiAgICAgaWYgKHJldCkgewogICAgICAgICBMT0dEKEVSUk9SLCBkb21p
ZCwgImNhbm5vdCBtYWtlIGRvbWFpbjogJWQiLCByZXQpOwogICAgICAgICBkY3MtPmd1ZXN0X2Rv
bWlkID0gZG9taWQ7CkBAIC0xMTQxLDcgKzExNTEsNyBAQCBzdGF0aWMgdm9pZCBpbml0aWF0ZV9k
b21haW5fY3JlYXRlKGxpYnhsX19lZ2MgKmVnYywKICAgICBpZiAocmV0KQogICAgICAgICBnb3Rv
IGVycm9yX291dDsKIAotICAgIGlmIChyZXN0b3JlX2ZkID49IDAgfHwgZGNzLT5kb21pZF9zb2Z0
X3Jlc2V0ICE9IElOVkFMSURfRE9NSUQpIHsKKyAgICBpZiAocmVzdG9yZV9mZCA+PSAwIHx8IGRj
cy0+c29mdF9yZXNldCkgewogICAgICAgICBMT0dEKERFQlVHLCBkb21pZCwgInJlc3RvcmluZywg
bm90IHJ1bm5pbmcgYm9vdGxvYWRlciIpOwogICAgICAgICBkb21jcmVhdGVfYm9vdGxvYWRlcl9k
b25lKGVnYywgJmRjcy0+YmwsIDApOwogICAgIH0gZWxzZSAgewpAQCAtMTIxNyw3ICsxMjI3LDcg
QEAgc3RhdGljIHZvaWQgZG9tY3JlYXRlX2Jvb3Rsb2FkZXJfZG9uZShsaWJ4bF9fZWdjICplZ2Ms
CiAgICAgZGNzLT5zZHNzLmRtLmNhbGxiYWNrID0gZG9tY3JlYXRlX2Rldm1vZGVsX3N0YXJ0ZWQ7
CiAgICAgZGNzLT5zZHNzLmNhbGxiYWNrID0gZG9tY3JlYXRlX2Rldm1vZGVsX3N0YXJ0ZWQ7CiAK
LSAgICBpZiAocmVzdG9yZV9mZCA8IDAgJiYgZGNzLT5kb21pZF9zb2Z0X3Jlc2V0ID09IElOVkFM
SURfRE9NSUQpIHsKKyAgICBpZiAocmVzdG9yZV9mZCA8IDAgJiYgIWRjcy0+c29mdF9yZXNldCkg
ewogICAgICAgICByYyA9IGxpYnhsX19kb21haW5fYnVpbGQoZ2MsIGRfY29uZmlnLCBkb21pZCwg
c3RhdGUpOwogICAgICAgICBkb21jcmVhdGVfcmVidWlsZF9kb25lKGVnYywgZGNzLCByYyk7CiAg
ICAgICAgIHJldHVybjsKQEAgLTE4MjcsNyArMTgzNyw3IEBAIHN0YXRpYyBpbnQgZG9fZG9tYWlu
X2NyZWF0ZShsaWJ4bF9jdHggKmN0eCwgbGlieGxfZG9tYWluX2NvbmZpZyAqZF9jb25maWcsCiAg
ICAgbGlieGxfZG9tYWluX2NvbmZpZ19jb3B5KGN0eCwgJmNkY3MtPmRjcy5ndWVzdF9jb25maWdf
c2F2ZWQsIGRfY29uZmlnKTsKICAgICBjZGNzLT5kY3MucmVzdG9yZV9mZCA9IGNkY3MtPmRjcy5s
aWJ4Y19mZCA9IHJlc3RvcmVfZmQ7CiAgICAgY2Rjcy0+ZGNzLnNlbmRfYmFja19mZCA9IHNlbmRf
YmFja19mZDsKLSAgICBpZiAocmVzdG9yZV9mZCA+IC0xKSB7CisgICAgaWYgKHJlc3RvcmVfZmQg
Pj0gMCkgewogICAgICAgICBjZGNzLT5kY3MucmVzdG9yZV9wYXJhbXMgPSAqcGFyYW1zOwogICAg
ICAgICByYyA9IGxpYnhsX19mZF9mbGFnc19tb2RpZnlfc2F2ZShnYywgY2Rjcy0+ZGNzLnJlc3Rv
cmVfZmQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH4oT19OT05C
TE9DS3xPX05ERUxBWSksIDAsCkBAIC0xODM1LDcgKzE4NDUsOCBAQCBzdGF0aWMgaW50IGRvX2Rv
bWFpbl9jcmVhdGUobGlieGxfY3R4ICpjdHgsIGxpYnhsX2RvbWFpbl9jb25maWcgKmRfY29uZmln
LAogICAgICAgICBpZiAocmMgPCAwKSBnb3RvIG91dF9lcnI7CiAgICAgfQogICAgIGNkY3MtPmRj
cy5jYWxsYmFjayA9IGRvbWFpbl9jcmVhdGVfY2I7Ci0gICAgY2Rjcy0+ZGNzLmRvbWlkX3NvZnRf
cmVzZXQgPSBJTlZBTElEX0RPTUlEOworICAgIGNkY3MtPmRjcy5kb21pZCA9IElOVkFMSURfRE9N
SUQ7CisgICAgY2Rjcy0+ZGNzLnNvZnRfcmVzZXQgPSBmYWxzZTsKIAogICAgIGlmIChjZGNzLT5k
Y3MucmVzdG9yZV9wYXJhbXMuY2hlY2twb2ludGVkX3N0cmVhbSA9PQogICAgICAgICBMSUJYTF9D
SEVDS1BPSU5URURfU1RSRUFNX0NPTE8pIHsKQEAgLTE5MDUsNyArMTkxNiw3IEBAIHN0YXRpYyB2
b2lkIHNvZnRfcmVzZXRfZG1fc3VzcGVuZGVkKGxpYnhsX19lZ2MgKmVnYywKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGludCByYyk7CiBzdGF0aWMgaW50IGRvX2RvbWFpbl9z
b2Z0X3Jlc2V0KGxpYnhsX2N0eCAqY3R4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBsaWJ4bF9kb21haW5fY29uZmlnICpkX2NvbmZpZywKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgdWludDMyX3QgZG9taWRfc29mdF9yZXNldCwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgdWludDMyX3QgZG9taWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGNvbnN0IGxpYnhsX2FzeW5jb3BfaG93ICphb19ob3csCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIGNvbnN0IGxpYnhsX2FzeW5jcHJvZ3Jlc3NfaG93CiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICphb3BfY29uc29sZV9ob3cpCkBAIC0xOTMzLDE1ICsxOTQ0LDE2
IEBAIHN0YXRpYyBpbnQgZG9fZG9tYWluX3NvZnRfcmVzZXQobGlieGxfY3R4ICpjdHgsCiAgICAg
bGlieGxfZG9tYWluX2NvbmZpZ19jb3B5KGN0eCwgJnNycy0+Y2Rjcy5kY3MuZ3Vlc3RfY29uZmln
X3NhdmVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkX2NvbmZpZyk7CiAgICAgY2Rj
cy0+ZGNzLnJlc3RvcmVfZmQgPSAtMTsKLSAgICBjZGNzLT5kY3MuZG9taWRfc29mdF9yZXNldCA9
IGRvbWlkX3NvZnRfcmVzZXQ7CisgICAgY2Rjcy0+ZGNzLmRvbWlkID0gZG9taWQ7CisgICAgY2Rj
cy0+ZGNzLnNvZnRfcmVzZXQgPSB0cnVlOwogICAgIGNkY3MtPmRjcy5jYWxsYmFjayA9IGRvbWFp
bl9jcmVhdGVfY2I7CiAgICAgbGlieGxfX2FvX3Byb2dyZXNzX2dldGhvdygmc3JzLT5jZGNzLmRj
cy5hb3BfY29uc29sZV9ob3csCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhb3BfY29u
c29sZV9ob3cpOwogICAgIGNkY3MtPmRvbWlkX291dCA9ICZkb21pZF9vdXQ7CiAKLSAgICBkb21f
cGF0aCA9IGxpYnhsX194c19nZXRfZG9tcGF0aChnYywgZG9taWRfc29mdF9yZXNldCk7CisgICAg
ZG9tX3BhdGggPSBsaWJ4bF9feHNfZ2V0X2RvbXBhdGgoZ2MsIGRvbWlkKTsKICAgICBpZiAoIWRv
bV9wYXRoKSB7Ci0gICAgICAgIExPR0QoRVJST1IsIGRvbWlkX3NvZnRfcmVzZXQsICJmYWlsZWQg
dG8gcmVhZCBkb21haW4gcGF0aCIpOworICAgICAgICBMT0dEKEVSUk9SLCBkb21pZCwgImZhaWxl
ZCB0byByZWFkIGRvbWFpbiBwYXRoIik7CiAgICAgICAgIHJjID0gRVJST1JfRkFJTDsKICAgICAg
ICAgZ290byBvdXQ7CiAgICAgfQpAQCAtMTk1MCw3ICsxOTYyLDcgQEAgc3RhdGljIGludCBkb19k
b21haW5fc29mdF9yZXNldChsaWJ4bF9jdHggKmN0eCwKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgR0NTUFJJTlRGKCIlcy9zdG9yZS9yaW5nLXJlZiIsIGRvbV9wYXRoKSwKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgJnhzX3N0b3JlX21mbik7CiAgICAgaWYgKHJjKSB7
Ci0gICAgICAgIExPR0QoRVJST1IsIGRvbWlkX3NvZnRfcmVzZXQsICJmYWlsZWQgdG8gcmVhZCBz
dG9yZS9yaW5nLXJlZi4iKTsKKyAgICAgICAgTE9HRChFUlJPUiwgZG9taWQsICJmYWlsZWQgdG8g
cmVhZCBzdG9yZS9yaW5nLXJlZi4iKTsKICAgICAgICAgZ290byBvdXQ7CiAgICAgfQogICAgIHN0
YXRlLT5zdG9yZV9tZm4gPSB4c19zdG9yZV9tZm4gPyBhdG9sKHhzX3N0b3JlX21mbik6IDA7CkBA
IC0xOTU5LDcgKzE5NzEsNyBAQCBzdGF0aWMgaW50IGRvX2RvbWFpbl9zb2Z0X3Jlc2V0KGxpYnhs
X2N0eCAqY3R4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHQ1NQUklOVEYoIiVz
L2NvbnNvbGUvcmluZy1yZWYiLCBkb21fcGF0aCksCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICZ4c19jb25zb2xlX21mbik7CiAgICAgaWYgKHJjKSB7Ci0gICAgICAgIExPR0QoRVJS
T1IsIGRvbWlkX3NvZnRfcmVzZXQsICJmYWlsZWQgdG8gcmVhZCBjb25zb2xlL3JpbmctcmVmLiIp
OworICAgICAgICBMT0dEKEVSUk9SLCBkb21pZCwgImZhaWxlZCB0byByZWFkIGNvbnNvbGUvcmlu
Zy1yZWYuIik7CiAgICAgICAgIGdvdG8gb3V0OwogICAgIH0KICAgICBzdGF0ZS0+Y29uc29sZV9t
Zm4gPSB4c19jb25zb2xlX21mbiA/IGF0b2woeHNfY29uc29sZV9tZm4pOiAwOwpAQCAtMTk2OCwy
MCArMTk4MCwyMCBAQCBzdGF0aWMgaW50IGRvX2RvbWFpbl9zb2Z0X3Jlc2V0KGxpYnhsX2N0eCAq
Y3R4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdDU1BSSU5URigiJXMvY29u
c29sZS90dHkiLCBkb21fcGF0aCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
JmNvbnNvbGVfdHR5KTsKICAgICBpZiAocmMpIHsKLSAgICAgICAgTE9HRChFUlJPUiwgZG9taWRf
c29mdF9yZXNldCwgImZhaWxlZCB0byByZWFkIGNvbnNvbGUvdHR5LiIpOworICAgICAgICBMT0dE
KEVSUk9SLCBkb21pZCwgImZhaWxlZCB0byByZWFkIGNvbnNvbGUvdHR5LiIpOwogICAgICAgICBn
b3RvIG91dDsKICAgICB9CiAgICAgc3RhdGUtPmNvbnNvbGVfdHR5ID0gbGlieGxfX3N0cmR1cChn
YywgY29uc29sZV90dHkpOwogCiAgICAgZHNzLT5hbyA9IGFvOwotICAgIGRzcy0+ZG9taWQgPSBk
c3MtPmRzcHMuZG9taWQgPSBkb21pZF9zb2Z0X3Jlc2V0OworICAgIGRzcy0+ZG9taWQgPSBkc3Mt
PmRzcHMuZG9taWQgPSBkb21pZDsKICAgICBkc3MtPmRzcHMuZG1fc2F2ZWZpbGUgPSBHQ1NQUklO
VEYoTElCWExfREVWSUNFX01PREVMX1NBVkVfRklMRSIuJWQiLAotICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBkb21pZF9zb2Z0X3Jlc2V0KTsKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgZG9taWQpOwogCiAgICAgcmMgPSBsaWJ4bF9fc2F2ZV9lbXVs
YXRvcl94ZW5zdG9yZV9kYXRhKGRzcywgJnNycy0+dG9vbHN0YWNrX2J1ZiwKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJnNycy0+dG9vbHN0YWNrX2xlbik7CiAg
ICAgaWYgKHJjKSB7Ci0gICAgICAgIExPR0QoRVJST1IsIGRvbWlkX3NvZnRfcmVzZXQsICJmYWls
ZWQgdG8gc2F2ZSB0b29sc3RhY2sgcmVjb3JkLiIpOworICAgICAgICBMT0dEKEVSUk9SLCBkb21p
ZCwgImZhaWxlZCB0byBzYXZlIHRvb2xzdGFjayByZWNvcmQuIik7CiAgICAgICAgIGdvdG8gb3V0
OwogICAgIH0KIApAQCAtMjAxMCwxMCArMjAyMiwxMCBAQCBzdGF0aWMgdm9pZCBzb2Z0X3Jlc2V0
X2RtX3N1c3BlbmRlZChsaWJ4bF9fZWdjICplZ2MsCiAgICAgICogeGVuc3RvcmUgYWdhaW4gd2l0
aCBwcm9iYWJseSBkaWZmZXJlbnQgc3RvcmUvY29uc29sZS8uLi4KICAgICAgKiBjaGFubmVscy4K
ICAgICAgKi8KLSAgICB4c19yZWxlYXNlX2RvbWFpbihDVFgtPnhzaCwgY2Rjcy0+ZGNzLmRvbWlk
X3NvZnRfcmVzZXQpOworICAgIHhzX3JlbGVhc2VfZG9tYWluKENUWC0+eHNoLCBjZGNzLT5kY3Mu
ZG9taWQpOwogCiAgICAgc3JzLT5kZHMuYW8gPSBhbzsKLSAgICBzcnMtPmRkcy5kb21pZCA9IGNk
Y3MtPmRjcy5kb21pZF9zb2Z0X3Jlc2V0OworICAgIHNycy0+ZGRzLmRvbWlkID0gY2Rjcy0+ZGNz
LmRvbWlkOwogICAgIHNycy0+ZGRzLmNhbGxiYWNrID0gZG9tYWluX3NvZnRfcmVzZXRfY2I7CiAg
ICAgc3JzLT5kZHMuc29mdF9yZXNldCA9IHRydWU7CiAgICAgbGlieGxfX2RvbWFpbl9kZXN0cm95
KGVnYywgJnNycy0+ZGRzKTsKQEAgLTIwMjksNyArMjA0MSw3IEBAIHN0YXRpYyB2b2lkIGRvbWFp
bl9jcmVhdGVfY2IobGlieGxfX2VnYyAqZWdjLAogCiAgICAgKmNkY3MtPmRvbWlkX291dCA9IGRv
bWlkOwogCi0gICAgaWYgKGRjcy0+cmVzdG9yZV9mZCA+IC0xKSB7CisgICAgaWYgKGRjcy0+cmVz
dG9yZV9mZCA+PSAwKSB7CiAgICAgICAgIGZscmMgPSBsaWJ4bF9fZmRfZmxhZ3NfcmVzdG9yZShn
YywKICAgICAgICAgICAgICAgICBkY3MtPnJlc3RvcmVfZmQsIGRjcy0+cmVzdG9yZV9mZGZsKTsK
ICAgICAgICAgLyoKZGlmZiAtLWdpdCBhL3Rvb2xzL2xpYnhsL2xpYnhsX2RtLmMgYi90b29scy9s
aWJ4bC9saWJ4bF9kbS5jCmluZGV4IGRhYzFiOGRkYjguLmFjNzgwNjYwNGEgMTAwNjQ0Ci0tLSBh
L3Rvb2xzL2xpYnhsL2xpYnhsX2RtLmMKKysrIGIvdG9vbHMvbGlieGwvbGlieGxfZG0uYwpAQCAt
MjE5MCw3ICsyMTkwLDcgQEAgdm9pZCBsaWJ4bF9fc3Bhd25fc3R1Yl9kbShsaWJ4bF9fZWdjICpl
Z2MsIGxpYnhsX19zdHViX2RtX3NwYXduX3N0YXRlICpzZHNzKQogCiAgICAgLyogZml4bWU6IHRo
aXMgZnVuY3Rpb24gY2FuIGxlYWsgdGhlIHN0dWJkb20gaWYgaXQgZmFpbHMgKi8KICAgICByZXQg
PSBsaWJ4bF9fZG9tYWluX21ha2UoZ2MsIGRtX2NvbmZpZywgc3R1YmRvbV9zdGF0ZSwKLSAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgJnNkc3MtPnB2cWVtdS5ndWVzdF9kb21pZCk7CisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICZzZHNzLT5wdnFlbXUuZ3Vlc3RfZG9taWQsIGZhbHNl
KTsKICAgICBpZiAocmV0KQogICAgICAgICBnb3RvIG91dDsKICAgICB1aW50MzJfdCBkbV9kb21p
ZCA9IHNkc3MtPnB2cWVtdS5ndWVzdF9kb21pZDsKZGlmZiAtLWdpdCBhL3Rvb2xzL2xpYnhsL2xp
YnhsX2ludGVybmFsLmggYi90b29scy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5oCmluZGV4IGExNTc3
ODk1MmMuLjE1ZjE2N2E2YzQgMTAwNjQ0Ci0tLSBhL3Rvb2xzL2xpYnhsL2xpYnhsX2ludGVybmFs
LmgKKysrIGIvdG9vbHMvbGlieGwvbGlieGxfaW50ZXJuYWwuaApAQCAtMTk1Nyw3ICsxOTU3LDcg
QEAgX2hpZGRlbiAgdm9pZCBsaWJ4bF9fZXhlYyhsaWJ4bF9fZ2MgKmdjLCBpbnQgc3RkaW5mZCwg
aW50IHN0ZG91dGZkLAogX2hpZGRlbiBpbnQgbGlieGxfX2RvbWFpbl9tYWtlKGxpYnhsX19nYyAq
Z2MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlieGxfZG9tYWluX2NvbmZpZyAq
ZF9jb25maWcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlieGxfX2RvbWFpbl9i
dWlsZF9zdGF0ZSAqc3RhdGUsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDMy
X3QgKmRvbWlkKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCAqZG9t
aWQsIGJvb2wgc29mdF9yZXNldCk7CiAKIF9oaWRkZW4gaW50IGxpYnhsX19kb21haW5fYnVpbGQo
bGlieGxfX2djICpnYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlieGxfZG9t
YWluX2NvbmZpZyAqZF9jb25maWcsCkBAIC00MTM1LDcgKzQxMzUsOCBAQCBzdHJ1Y3QgbGlieGxf
X2RvbWFpbl9jcmVhdGVfc3RhdGUgewogICAgIGludCByZXN0b3JlX2ZkZmw7IC8qIG9yaWdpbmFs
IGZsYWdzIG9mIHJlc3RvcmVfZmQgKi8KICAgICBpbnQgc2VuZF9iYWNrX2ZkOwogICAgIGxpYnhs
X2RvbWFpbl9yZXN0b3JlX3BhcmFtcyByZXN0b3JlX3BhcmFtczsKLSAgICB1aW50MzJfdCBkb21p
ZF9zb2Z0X3Jlc2V0OworICAgIHVpbnQzMl90IGRvbWlkOworICAgIGJvb2wgc29mdF9yZXNldDsK
ICAgICBsaWJ4bF9fZG9tYWluX2NyZWF0ZV9jYiAqY2FsbGJhY2s7CiAgICAgbGlieGxfYXN5bmNw
cm9ncmVzc19ob3cgYW9wX2NvbnNvbGVfaG93OwogICAgIC8qIHByaXZhdGUgdG8gZG9tYWluX2Ny
ZWF0ZSAqLwotLSAKMi4yMC4xCgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJv
amVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hl
bi1kZXZlbA==

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 8BB241A00D
	for <lists+xen-devel@lfdr.de>; Fri, 10 May 2019 17:24:25 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hP7Kk-0007w4-LB; Fri, 10 May 2019 15:21:14 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=dG64=TK=aepfle.de=olaf@srs-us1.protection.inumbo.net>)
 id 1hP7Ki-0007vn-6O
 for xen-devel@lists.xenproject.org; Fri, 10 May 2019 15:21:13 +0000
X-Inumbo-ID: 3c782971-7337-11e9-8980-bc764e045a96
Received: from mo6-p00-ob.smtp.rzone.de (unknown [2a01:238:20a:202:5300::6])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 3c782971-7337-11e9-8980-bc764e045a96;
 Fri, 10 May 2019 15:21:09 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; t=1557501668;
 s=strato-dkim-0002; d=aepfle.de;
 h=Message-Id:Date:Subject:Cc:To:From:X-RZG-CLASS-ID:X-RZG-AUTH:From:
 Subject:Sender;
 bh=qxOPC38YksBeE2l6b7tznHCxKJ7pnDIaW9xjlPzfywQ=;
 b=GJmkMzY7BughIL1okh15VqdguBVdnjC7WKy1hSuk7wPHPj8Q2Zv/XFZPd+cNoyXfIM
 K8Hd2198PV9qsoXp03oPCn1/Mlp7ecTLs436zAYm9F4QZtU9iTtYcYSiOvFrMTn6AXGT
 KORF5RtHodGLcvhmmueEqKRJL3gjQfQBIF8IpkDfsUAtyE+58S++K1r9DN+cvUF4pk/J
 TGJTSf5soxjaB4H7WjQYD+tOBMA0lfLp8BgnbsTLtAVfeI961o0iVI8HYRs0GKuhbmKF
 jbhfUBZQSFNcdN1TKvYtVnApY7PRrxzXRrjApRISorNooRLxlD4NW6vJJEn1MyoY8KC9
 7TzQ==
X-RZG-AUTH: ":P2EQZWCpfu+qG7CngxMFH1J+3q8wa/QXkBR9MXjAuzBW/OdlBZQ4AHSS329Jjw=="
X-RZG-CLASS-ID: mo00
Received: from sender by smtp.strato.de (RZmta 44.18 SBL|AUTH)
 with ESMTPSA id 60a847v4AFKp2jD
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (curve secp521r1 with
 521 ECDH bits, eq. 15360 bits RSA))
 (Client did not present a certificate);
 Fri, 10 May 2019 17:20:51 +0200 (CEST)
From: Olaf Hering <olaf@aepfle.de>
To: xen-devel@lists.xenproject.org
Date: Fri, 10 May 2019 17:20:47 +0200
Message-Id: <20190510152047.17299-1-olaf@aepfle.de>
X-Mailer: git-send-email 2.16.4
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v4] libxl: fix migration of PV and PVH domUs
 with and without qemu
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Anthony PERARD <anthony.perard@citrix.com>, Wei Liu <wei.liu2@citrix.com>,
 Olaf Hering <olaf@aepfle.de>, Ian Jackson <ian.jackson@eu.citrix.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SWYgYSBkb21VIGhhcyBhIHFlbXUteGVuIGluc3RhbmNlIGF0dGFjaGVkLCBpdCBpcyByZXF1aXJl
ZCB0byBjYWxsIHFlbXVzCiJ4ZW4tc2F2ZS1kZXZpY2VzLXN0YXRlIiBtZXRob2QuIFdpdGhvdXQg
aXQsIHRoZSByZWNlaXZpbmcgc2lkZSBvZiBhIFBWIG9yClBWSCBtaWdyYXRpb24gbWF5IGJlIHVu
YWJsZSB0byBsb2NrIHRoZSBpbWFnZToKCnhlbiBiZTogcWRpc2stNTE3MTI6IHhlbiBiZTogcWRp
c2stNTE3MTI6IGVycm9yOiBGYWlsZWQgdG8gZ2V0ICJ3cml0ZSIgbG9jawplcnJvcjogRmFpbGVk
IHRvIGdldCAid3JpdGUiIGxvY2sKeGVuIGJlOiBxZGlzay01MTcxMjogeGVuIGJlOiBxZGlzay01
MTcxMjogaW5pdGlhbGlzZSgpIGZhaWxlZAppbml0aWFsaXNlKCkgZmFpbGVkCgpUbyBmaXggdGhp
cyBidWcsIGxpYnhsX19kb21haW5fc3VzcGVuZF9kZXZpY2VfbW9kZWwoKSBhbmQKbGlieGxfX2Rv
bWFpbl9yZXN1bWVfZGV2aWNlX21vZGVsKCkgaGF2ZSB0byBiZSBjYWxsZWQgbm90IG9ubHkgZm9y
IEhWTSwKYnV0IGFsc28gaWYgdGhlIGFjdGl2ZSBkZXZpY2VfbW9kZWwgaXMgUUVNVV9YRU4uCgpV
bmZvcnR1bmF0ZWx5LCBsaWJ4bF9fZG9tYWluX2J1aWxkX2luZm9fc2V0ZGVmYXVsdCgpIGhhcmRj
b2RlcwpiX2luZm8tPmRldmljZV9tb2RlbF92ZXJzaW9uIHRvIFFFTVVfWEVOIGlmIGl0IGRvZXMg
bm90IGtub3cgaXQgYW55CmJldHRlci4gQXMgYSByZXN1bHQgbGlieGxfX2RldmljZV9tb2RlbF92
ZXJzaW9uX3J1bm5pbmcoKSB3aWxsIHJldHVybgppbmNvcnJlY3QgdmFsdWVzLiBUaGlzIGJyZWFr
cyBkb21VcyB3aXRob3V0IGEgZGV2aWNlX21vZGVsLgpsaWJ4bF9fcW1wX3N0b3AoKSB3b3VsZCB3
YWl0IDEwIHNlY29uZHMgaW4gcW1wX29wZW4oKSBmb3IgYSBxZW11IHRoYXQKd2lsbCBuZXZlciBh
cHBlYXIuIER1cmluZyB0aGlzIGxvbmcgdGltZWZyYW1lIHRoZSBkb21VIHJlbWFpbnMgaW4gc3Rh
dGUKcGF1c2VkIG9uIHRoZSBzZW5kaW5nIHNpZGUuIEFzIGEgcmVzdWx0IG5ldHdvcmsgY29ubmVj
dGlvbnMgbWF5IGJlCmRyb3BwZWQuIE9uY2UgdGhpcyBidWcgaXMgZml4ZWQgYXMgd2VsbCwgYnkg
anVzdCByZW1vdmluZyB0aGUgYXNzdW1wdGlvbgp0aGF0IGV2ZXJ5IGRvbVUgaGFzIGEgUUVNVV9Y
RU4sIHRoZXJlIGlzIG5vIGNvZGUgdG8gYWN0dWFsbHkgaW5pdGlhbGlzZQpiX2luZm8tPmRldmlj
ZV9tb2RlbF92ZXJzaW9uLgoKVGhlcmUgaXMgYSBoZWxwZXIgZnVuY3Rpb24gbGlieGxfX25lZWRf
eGVucHZfcWVtdSgpLCB3aGljaCBpcyB1c2VkIGluCnZhcmlvdXMgcGxhY2VzIHRvIGRlY2lkZSBp
ZiBhIGRldmljZV9tb2RlbCBoYXMgdG8gYmUgc3Bhd25lZC4gVGhpcwpmdW5jdGlvbiBjYW4gbm90
IGJlIHVzZWQgYXMgaXMsIGp1c3QgdG8gZmlsbCBkZXZpY2VfbW9kZWxfdmVyc2lvbiwKYmVjYXVz
ZSBzdG9yZV9saWJ4bF9lbnRyeSgpIHdhcyBhbHJlYWR5IGNhbGxlZCBlYXJsaWVyLgoKQ3JlYXRl
IGEgbmV3IGZ1bmN0aW9uIHRvIHNldCBkZXZpY2VfbW9kZWxfdmVyc2lvbi4gTW92ZSBleGlzdGlu
ZyBjb2RlCmZyb20gbGlieGxfX2RvbWFpbl9idWlsZF9pbmZvX3NldGRlZmF1bHQoKSB0byBjb3Zl
ciB0aGUgSFZNIGNhc2UuIEFkZApuZXcgY29kZSB0byBjb3ZlciBub24tSFZNIGNhc2UsIHVzZSBs
aWJ4bF9fbmVlZF94ZW5wdl9xZW11KCkgdG8gc2V0CmRldmljZV9tb2RlbF92ZXJzaW9uLgpNb3Zl
IGFsc28gaW5pdGlhbGl6YXRpb24gZm9yIGRldmljZV9tb2RlbF9zdHViZG9tYWluIHRvIHRoZSBu
ZXcgZnVuY3Rpb24uCgpVcGRhdGUgbGlieGxfX3NwYXduX3N0dWJfZG0oKSBhbmQgaW5pdGlhdGVf
ZG9tYWluX2NyZWF0ZSgpIHRvIGNhbGwgdGhlCm5ldyBmdW5jdGlvbiBwcmlvciBsaWJ4bF9fZG9t
YWluX2J1aWxkX2luZm9fc2V0ZGVmYXVsdCgpIGJlY2F1c2UKZGV2aWNlX21vZGVfdmVyc2lvbiBp
cyBleHBlY3RlZCB0byBiZSBpbml0aWFsemVkLgpsaWJ4bF9kb21haW5fbmVlZF9tZW1vcnkoKSBu
ZWVkcyBubyB1cGRhdGUgYmVjYXVzZSBpdCBkb2VzIG5vdCBoYXZlIGEKZF9jb25maWcgYXZhaWxh
YmxlIGFueXdheSwgYW5kIHRoZSBjYWxsZXJzIHByb3ZpZGUgYSBwb3B1bGF0ZWQgYl9pbmZvLgoK
SW50cm9kdWNlIExJQlhMX0RFVklDRV9NT0RFTF9WRVJTSU9OX05PTkVfUkVRVUlSRUQgZm9yIFBW
IGFuZCBQVkggdGhhdApoYXZlIG5vIG5lZWQgZm9yIGEgZGV2aWNlX21vZGVsIHRvIG1ha2UgdGhl
IHN0YXRlIGV4cGxpY2l0LgoKdjAzOgotIHJlYXJyYW5nZSBjb2RlIHRvIG1ha2Ugc3VyZSBkZXZp
Y2VfbW9kZWxfdmVyc2lvbiBpcyBpbml0aWFsaXplZCBiZWZvcmUKICBzdG9yZV9saWJ4bF9lbnRy
eSgpIGlzIGNhbGxlZAp2MDI6Ci0gdXBkYXRlIHdvcmRpbmcgaW4gYSBjb21tZW50Ci0gcmVtb3Zl
IHN0YWxlIGdvdG8gaW4gZG9tY3JlYXRlX2xhdW5jaF9kbQotIGluaXRpYWxpemUgcmV0IGluIGxp
YnhsX19uZWVkX3hlbnB2X3FlbXUKClNpZ25lZC1vZmYtYnk6IE9sYWYgSGVyaW5nIDxvbGFmQGFl
cGZsZS5kZT4KQ2M6IFJvZ2VyIFBhdSBNb25uw6kgPHJvZ2VyLnBhdUBjaXRyaXguY29tPgpDYzog
QW50aG9ueSBQRVJBUkQgPGFudGhvbnkucGVyYXJkQGNpdHJpeC5jb20+Ci0tLQogdG9vbHMvbGli
eGwvbGlieGxfY3JlYXRlLmMgICAgICB8IDk5ICsrKysrKysrKysrKysrKysrKysrKysrKysrLS0t
LS0tLS0tLS0tLS0tCiB0b29scy9saWJ4bC9saWJ4bF9kbS5jICAgICAgICAgIHwgIDIgKwogdG9v
bHMvbGlieGwvbGlieGxfZG9tX3N1c3BlbmQuYyB8ICA4ICsrKy0KIHRvb2xzL2xpYnhsL2xpYnhs
X2ludGVybmFsLmggICAgfCAgMiArCiB0b29scy9saWJ4bC9saWJ4bF90eXBlcy5pZGwgICAgIHwg
IDEgKwogNSBmaWxlcyBjaGFuZ2VkLCA3NSBpbnNlcnRpb25zKCspLCAzNyBkZWxldGlvbnMoLSkK
CmRpZmYgLS1naXQgYS90b29scy9saWJ4bC9saWJ4bF9jcmVhdGUuYyBiL3Rvb2xzL2xpYnhsL2xp
YnhsX2NyZWF0ZS5jCmluZGV4IDg5ZmU4MGZjOWMuLmJjNDYxM2EyOTYgMTAwNjQ0Ci0tLSBhL3Rv
b2xzL2xpYnhsL2xpYnhsX2NyZWF0ZS5jCisrKyBiL3Rvb2xzL2xpYnhsL2xpYnhsX2NyZWF0ZS5j
CkBAIC0yNyw2ICsyNyw2NCBAQAogCiAjaW5jbHVkZSA8eGVuLXhzbS9mbGFzay9mbGFzay5oPgog
CitpbnQgbGlieGxfX2RvbWFpbl9zZXRfZGV2aWNlX21vZGVsKGxpYnhsX19nYyAqZ2MsIGxpYnhs
X2RvbWFpbl9jb25maWcgKmRfY29uZmlnKQoreworICAgIGxpYnhsX2RvbWFpbl9idWlsZF9pbmZv
ICpiX2luZm8gPSAmZF9jb25maWctPmJfaW5mbzsKKyAgICBpbnQgcmV0OworCisgICAgbGlieGxf
ZGVmYm9vbF9zZXRkZWZhdWx0KCZiX2luZm8tPmRldmljZV9tb2RlbF9zdHViZG9tYWluLCBmYWxz
ZSk7CisKKyAgICBpZiAoYl9pbmZvLT5kZXZpY2VfbW9kZWxfdmVyc2lvbikKKyAgICAgICAgcmV0
dXJuIDA7CisKKyAgICBzd2l0Y2ggKGJfaW5mby0+dHlwZSkgeworICAgIGNhc2UgTElCWExfRE9N
QUlOX1RZUEVfSFZNOgorICAgICAgICBpZiAobGlieGxfZGVmYm9vbF92YWwoYl9pbmZvLT5kZXZp
Y2VfbW9kZWxfc3R1YmRvbWFpbikpIHsKKyAgICAgICAgICAgIGJfaW5mby0+ZGV2aWNlX21vZGVs
X3ZlcnNpb24gPQorICAgICAgICAgICAgICAgIExJQlhMX0RFVklDRV9NT0RFTF9WRVJTSU9OX1FF
TVVfWEVOX1RSQURJVElPTkFMOworICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAgYl9pbmZv
LT5kZXZpY2VfbW9kZWxfdmVyc2lvbiA9IGxpYnhsX19kZWZhdWx0X2RldmljZV9tb2RlbChnYyk7
CisgICAgICAgIH0KKyAgICAgICAgYnJlYWs7CisgICAgZGVmYXVsdDoKKyAgICAgICAgcmV0ID0g
bGlieGxfX25lZWRfeGVucHZfcWVtdShnYywgZF9jb25maWcpOworICAgICAgICBzd2l0Y2ggKHJl
dCkgeworICAgICAgICBjYXNlIDE6CisgICAgICAgICAgICBkX2NvbmZpZy0+Yl9pbmZvLmRldmlj
ZV9tb2RlbF92ZXJzaW9uID0KKyAgICAgICAgICAgICAgICBMSUJYTF9ERVZJQ0VfTU9ERUxfVkVS
U0lPTl9RRU1VX1hFTjsKKyAgICAgICAgICAgIGJyZWFrOworICAgICAgICBjYXNlIDA6CisgICAg
ICAgICAgICBkX2NvbmZpZy0+Yl9pbmZvLmRldmljZV9tb2RlbF92ZXJzaW9uID0KKyAgICAgICAg
ICAgICAgICBMSUJYTF9ERVZJQ0VfTU9ERUxfVkVSU0lPTl9OT05FX1JFUVVJUkVEOworICAgICAg
ICAgICAgYnJlYWs7CisgICAgICAgIGRlZmF1bHQ6CisgICAgICAgICAgICBMT0dFKEVSUk9SLCAi
VW5hYmxlIHRvIGRldGVybWluZSBRRU1VIHJlcXVpc2l0ZSIpOworICAgICAgICAgICAgcmV0dXJu
IEVSUk9SX0ZBSUw7CisgICAgICAgIH0KKyAgICB9CisKKyAgICBpZiAoYl9pbmZvLT5kZXZpY2Vf
bW9kZWxfdmVyc2lvbiA9PSBMSUJYTF9ERVZJQ0VfTU9ERUxfVkVSU0lPTl9RRU1VX1hFTikgewor
ICAgICAgICBjb25zdCBjaGFyICpkbTsKKworICAgICAgICBkbSA9IGxpYnhsX19kb21haW5fZGV2
aWNlX21vZGVsKGdjLCBiX2luZm8pOworICAgICAgICByZXQgPSBhY2Nlc3MoZG0sIFhfT0spOwor
ICAgICAgICBpZiAocmV0IDwgMCkgeworICAgICAgICAgICAgLyogcWVtdS14ZW4gdW5hdmFpbGFi
bGUsIHVzZSBxZW11LXhlbi10cmFkaXRpb25hbCAqLworICAgICAgICAgICAgaWYgKGVycm5vID09
IEVOT0VOVCkgeworICAgICAgICAgICAgICAgIExPR0UoSU5GTywgInFlbXUteGVuIGlzIHVuYXZh
aWxhYmxlIgorICAgICAgICAgICAgICAgICAgICAgIiwgdXNpbmcgcWVtdS14ZW4tdHJhZGl0aW9u
YWwgaW5zdGVhZCIpOworICAgICAgICAgICAgICAgIGJfaW5mby0+ZGV2aWNlX21vZGVsX3ZlcnNp
b24gPQorICAgICAgICAgICAgICAgICAgICBMSUJYTF9ERVZJQ0VfTU9ERUxfVkVSU0lPTl9RRU1V
X1hFTl9UUkFESVRJT05BTDsKKyAgICAgICAgICAgIH0gZWxzZSB7CisgICAgICAgICAgICAgICAg
TE9HRShFUlJPUiwgInFlbXUteGVuIGFjY2VzcyBlcnJvciIpOworICAgICAgICAgICAgICAgIHJl
dHVybiBFUlJPUl9GQUlMOworICAgICAgICAgICAgfQorICAgICAgICB9CisgICAgfQorCisgICAg
cmV0dXJuIDA7Cit9CisKIGludCBsaWJ4bF9fZG9tYWluX2NyZWF0ZV9pbmZvX3NldGRlZmF1bHQo
bGlieGxfX2djICpnYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
bGlieGxfZG9tYWluX2NyZWF0ZV9pbmZvICpjX2luZm8pCiB7CkBAIC04MCw0NSArMTM4LDEwIEBA
IGludCBsaWJ4bF9fZG9tYWluX2J1aWxkX2luZm9fc2V0ZGVmYXVsdChsaWJ4bF9fZ2MgKmdjLAog
ICAgICAgICByZXR1cm4gcmM7CiAgICAgfQogCi0gICAgbGlieGxfZGVmYm9vbF9zZXRkZWZhdWx0
KCZiX2luZm8tPmRldmljZV9tb2RlbF9zdHViZG9tYWluLCBmYWxzZSk7Ci0KICAgICBpZiAobGli
eGxfZGVmYm9vbF92YWwoYl9pbmZvLT5kZXZpY2VfbW9kZWxfc3R1YmRvbWFpbikgJiYKICAgICAg
ICAgIWJfaW5mby0+ZGV2aWNlX21vZGVsX3NzaWRyZWYpCiAgICAgICAgIGJfaW5mby0+ZGV2aWNl
X21vZGVsX3NzaWRyZWYgPSBTRUNJTklUU0lEX0RPTURNOwogCi0gICAgaWYgKCFiX2luZm8tPmRl
dmljZV9tb2RlbF92ZXJzaW9uKSB7Ci0gICAgICAgIGlmIChiX2luZm8tPnR5cGUgPT0gTElCWExf
RE9NQUlOX1RZUEVfSFZNKSB7Ci0gICAgICAgICAgICBpZiAobGlieGxfZGVmYm9vbF92YWwoYl9p
bmZvLT5kZXZpY2VfbW9kZWxfc3R1YmRvbWFpbikpIHsKLSAgICAgICAgICAgICAgICBiX2luZm8t
PmRldmljZV9tb2RlbF92ZXJzaW9uID0KLSAgICAgICAgICAgICAgICAgICAgTElCWExfREVWSUNF
X01PREVMX1ZFUlNJT05fUUVNVV9YRU5fVFJBRElUSU9OQUw7Ci0gICAgICAgICAgICB9IGVsc2Ug
ewotICAgICAgICAgICAgICAgIGJfaW5mby0+ZGV2aWNlX21vZGVsX3ZlcnNpb24gPSBsaWJ4bF9f
ZGVmYXVsdF9kZXZpY2VfbW9kZWwoZ2MpOwotICAgICAgICAgICAgfQotICAgICAgICB9IGVsc2Ug
ewotICAgICAgICAgICAgYl9pbmZvLT5kZXZpY2VfbW9kZWxfdmVyc2lvbiA9Ci0gICAgICAgICAg
ICAgICAgTElCWExfREVWSUNFX01PREVMX1ZFUlNJT05fUUVNVV9YRU47Ci0gICAgICAgIH0KLSAg
ICAgICAgaWYgKGJfaW5mby0+ZGV2aWNlX21vZGVsX3ZlcnNpb24KLSAgICAgICAgICAgICAgICA9
PSBMSUJYTF9ERVZJQ0VfTU9ERUxfVkVSU0lPTl9RRU1VX1hFTikgewotICAgICAgICAgICAgY29u
c3QgY2hhciAqZG07Ci0KLSAgICAgICAgICAgIGRtID0gbGlieGxfX2RvbWFpbl9kZXZpY2VfbW9k
ZWwoZ2MsIGJfaW5mbyk7Ci0gICAgICAgICAgICByYyA9IGFjY2VzcyhkbSwgWF9PSyk7Ci0gICAg
ICAgICAgICBpZiAocmMgPCAwKSB7Ci0gICAgICAgICAgICAgICAgLyogcWVtdS14ZW4gdW5hdmFp
bGFibGUsIHVzZSBxZW11LXhlbi10cmFkaXRpb25hbCAqLwotICAgICAgICAgICAgICAgIGlmIChl
cnJubyA9PSBFTk9FTlQpIHsKLSAgICAgICAgICAgICAgICAgICAgTE9HRShJTkZPLCAicWVtdS14
ZW4gaXMgdW5hdmFpbGFibGUiCi0gICAgICAgICAgICAgICAgICAgICAgICAgIiwgdXNpbmcgcWVt
dS14ZW4tdHJhZGl0aW9uYWwgaW5zdGVhZCIpOwotICAgICAgICAgICAgICAgICAgICBiX2luZm8t
PmRldmljZV9tb2RlbF92ZXJzaW9uID0KLSAgICAgICAgICAgICAgICAgICAgICAgIExJQlhMX0RF
VklDRV9NT0RFTF9WRVJTSU9OX1FFTVVfWEVOX1RSQURJVElPTkFMOwotICAgICAgICAgICAgICAg
IH0gZWxzZSB7Ci0gICAgICAgICAgICAgICAgICAgIExPR0UoRVJST1IsICJxZW11LXhlbiBhY2Nl
c3MgZXJyb3IiKTsKLSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUw7Ci0gICAg
ICAgICAgICAgICAgfQotICAgICAgICAgICAgfQotICAgICAgICB9Ci0gICAgfQotCiAgICAgaWYg
KGJfaW5mby0+YmxrZGV2X3N0YXJ0ID09IE5VTEwpCiAgICAgICAgIGJfaW5mby0+YmxrZGV2X3N0
YXJ0ID0gbGlieGxfX3N0cmR1cChOT0dDLCAieHZkYSIpOwogCkBAIC05MzgsNiArOTYxLDEyIEBA
IHN0YXRpYyB2b2lkIGluaXRpYXRlX2RvbWFpbl9jcmVhdGUobGlieGxfX2VnYyAqZWdjLAogICAg
ICAgICBnb3RvIGVycm9yX291dDsKICAgICB9CiAKKyAgICByZXQgPSBsaWJ4bF9fZG9tYWluX3Nl
dF9kZXZpY2VfbW9kZWwoZ2MsIGRfY29uZmlnKTsKKyAgICBpZiAocmV0KSB7CisgICAgICAgIExP
R0QoRVJST1IsIGRvbWlkLCAiVW5hYmxlIHRvIHNldCBkb21haW4gZGV2aWNlIG1vZGVsIik7Cisg
ICAgICAgIGdvdG8gZXJyb3Jfb3V0OworICAgIH0KKwogICAgIHJldCA9IGxpYnhsX19kb21haW5f
Y3JlYXRlX2luZm9fc2V0ZGVmYXVsdChnYywgJmRfY29uZmlnLT5jX2luZm8pOwogICAgIGlmIChy
ZXQpIHsKICAgICAgICAgTE9HRChFUlJPUiwgZG9taWQsICJVbmFibGUgdG8gc2V0IGRvbWFpbiBj
cmVhdGUgaW5mbyBkZWZhdWx0cyIpOwpkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGlieGxfZG0u
YyBiL3Rvb2xzL2xpYnhsL2xpYnhsX2RtLmMKaW5kZXggMmYxOTc4NmJkZC4uMDg2ZTU2NjMxMSAx
MDA2NDQKLS0tIGEvdG9vbHMvbGlieGwvbGlieGxfZG0uYworKysgYi90b29scy9saWJ4bC9saWJ4
bF9kbS5jCkBAIC0yMTY4LDYgKzIxNjgsOCBAQCB2b2lkIGxpYnhsX19zcGF3bl9zdHViX2RtKGxp
YnhsX19lZ2MgKmVnYywgbGlieGxfX3N0dWJfZG1fc3Bhd25fc3RhdGUgKnNkc3MpCiAgICAgZG1f
Y29uZmlnLT5jX2luZm8ucnVuX2hvdHBsdWdfc2NyaXB0cyA9CiAgICAgICAgIGd1ZXN0X2NvbmZp
Zy0+Y19pbmZvLnJ1bl9ob3RwbHVnX3NjcmlwdHM7CiAKKyAgICByZXQgPSBsaWJ4bF9fZG9tYWlu
X3NldF9kZXZpY2VfbW9kZWwoZ2MsIGRtX2NvbmZpZyk7CisgICAgaWYgKHJldCkgZ290byBvdXQ7
CiAgICAgcmV0ID0gbGlieGxfX2RvbWFpbl9jcmVhdGVfaW5mb19zZXRkZWZhdWx0KGdjLCAmZG1f
Y29uZmlnLT5jX2luZm8pOwogICAgIGlmIChyZXQpIGdvdG8gb3V0OwogICAgIHJldCA9IGxpYnhs
X19kb21haW5fYnVpbGRfaW5mb19zZXRkZWZhdWx0KGdjLCAmZG1fY29uZmlnLT5iX2luZm8pOwpk
aWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGlieGxfZG9tX3N1c3BlbmQuYyBiL3Rvb2xzL2xpYnhs
L2xpYnhsX2RvbV9zdXNwZW5kLmMKaW5kZXggZDFhZjNhNjU3My4uYzQ5MmZlNWRkMSAxMDA2NDQK
LS0tIGEvdG9vbHMvbGlieGwvbGlieGxfZG9tX3N1c3BlbmQuYworKysgYi90b29scy9saWJ4bC9s
aWJ4bF9kb21fc3VzcGVuZC5jCkBAIC0zNzksNyArMzc5LDkgQEAgc3RhdGljIHZvaWQgZG9tYWlu
X3N1c3BlbmRfY29tbW9uX2d1ZXN0X3N1c3BlbmRlZChsaWJ4bF9fZWdjICplZ2MsCiAgICAgbGli
eGxfX2V2X3hzd2F0Y2hfZGVyZWdpc3RlcihnYywgJmRzcHMtPmd1ZXN0X3dhdGNoKTsKICAgICBs
aWJ4bF9fZXZfdGltZV9kZXJlZ2lzdGVyKGdjLCAmZHNwcy0+Z3Vlc3RfdGltZW91dCk7CiAKLSAg
ICBpZiAoZHNwcy0+dHlwZSA9PSBMSUJYTF9ET01BSU5fVFlQRV9IVk0pIHsKKyAgICBpZiAoZHNw
cy0+dHlwZSA9PSBMSUJYTF9ET01BSU5fVFlQRV9IVk0gfHwKKyAgICAgICAgbGlieGxfX2Rldmlj
ZV9tb2RlbF92ZXJzaW9uX3J1bm5pbmcoZ2MsIGRzcHMtPmRvbWlkKSA9PQorICAgICAgICBMSUJY
TF9ERVZJQ0VfTU9ERUxfVkVSU0lPTl9RRU1VX1hFTikgewogICAgICAgICBkc3BzLT5jYWxsYmFj
a19kZXZpY2VfbW9kZWxfZG9uZSA9IGRvbWFpbl9zdXNwZW5kX2NvbW1vbl9kb25lOwogICAgICAg
ICBsaWJ4bF9fZG9tYWluX3N1c3BlbmRfZGV2aWNlX21vZGVsKGVnYywgZHNwcyk7IC8qIG11c3Qg
YmUgbGFzdCAqLwogICAgICAgICByZXR1cm47CkBAIC00NTksNyArNDYxLDkgQEAgaW50IGxpYnhs
X19kb21haW5fcmVzdW1lKGxpYnhsX19nYyAqZ2MsIHVpbnQzMl90IGRvbWlkLCBpbnQgc3VzcGVu
ZF9jYW5jZWwpCiAgICAgICAgIGdvdG8gb3V0OwogICAgIH0KIAotICAgIGlmICh0eXBlID09IExJ
QlhMX0RPTUFJTl9UWVBFX0hWTSkgeworICAgIGlmICh0eXBlID09IExJQlhMX0RPTUFJTl9UWVBF
X0hWTSB8fAorICAgICAgICBsaWJ4bF9fZGV2aWNlX21vZGVsX3ZlcnNpb25fcnVubmluZyhnYywg
ZG9taWQpID09CisgICAgICAgIExJQlhMX0RFVklDRV9NT0RFTF9WRVJTSU9OX1FFTVVfWEVOKSB7
CiAgICAgICAgIHJjID0gbGlieGxfX2RvbWFpbl9yZXN1bWVfZGV2aWNlX21vZGVsKGdjLCBkb21p
ZCk7CiAgICAgICAgIGlmIChyYykgewogICAgICAgICAgICAgTE9HRChFUlJPUiwgZG9taWQsICJm
YWlsZWQgdG8gcmVzdW1lIGRldmljZSBtb2RlbDolZCIsIHJjKTsKZGlmZiAtLWdpdCBhL3Rvb2xz
L2xpYnhsL2xpYnhsX2ludGVybmFsLmggYi90b29scy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5oCmlu
ZGV4IDQ0ZTAyMjEyODQuLjI1ZjExMzQwNGIgMTAwNjQ0Ci0tLSBhL3Rvb2xzL2xpYnhsL2xpYnhs
X2ludGVybmFsLmgKKysrIGIvdG9vbHMvbGlieGwvbGlieGxfaW50ZXJuYWwuaApAQCAtMTM3NCw2
ICsxMzc0LDggQEAgX2hpZGRlbiBpbnQgbGlieGxfX2RldmljZV9uZXh0aWQobGlieGxfX2djICpn
YywgdWludDMyX3QgZG9taWQsCiBfaGlkZGVuIGludCBsaWJ4bF9fcmVzb2x2ZV9kb21pZChsaWJ4
bF9fZ2MgKmdjLCBjb25zdCBjaGFyICpuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgdWludDMyX3QgKmRvbWlkKTsKIAorX2hpZGRlbiBpbnQgbGlieGxfX2RvbWFpbl9zZXRf
ZGV2aWNlX21vZGVsKGxpYnhsX19nYyAqZ2MsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgbGlieGxfZG9tYWluX2NvbmZpZyAqZF9jb25maWcpOwogLyoKICAqIEZv
ciBlYWNoIGFnZ3JlZ2F0ZSB0eXBlIHdoaWNoIGNhbiBiZSB1c2VkIGFzIGFuIGlucHV0IHdlIHBy
b3ZpZGU6CiAgKgpkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGlieGxfdHlwZXMuaWRsIGIvdG9v
bHMvbGlieGwvbGlieGxfdHlwZXMuaWRsCmluZGV4IGNiNDcwMmZkN2EuLjdkNzViZDM4NTAgMTAw
NjQ0Ci0tLSBhL3Rvb2xzL2xpYnhsL2xpYnhsX3R5cGVzLmlkbAorKysgYi90b29scy9saWJ4bC9s
aWJ4bF90eXBlcy5pZGwKQEAgLTEwNiw2ICsxMDYsNyBAQCBsaWJ4bF9kZXZpY2VfbW9kZWxfdmVy
c2lvbiA9IEVudW1lcmF0aW9uKCJkZXZpY2VfbW9kZWxfdmVyc2lvbiIsIFsKICAgICAoMCwgIlVO
S05PV04iKSwKICAgICAoMSwgIlFFTVVfWEVOX1RSQURJVElPTkFMIiksICMgSGlzdG9yaWNhbCBx
ZW11LXhlbiBkZXZpY2UgbW9kZWwgKHFlbXUtZG0pCiAgICAgKDIsICJRRU1VX1hFTiIpLCAgICAg
ICAgICAgICAjIFVwc3RyZWFtIGJhc2VkIHFlbXUteGVuIGRldmljZSBtb2RlbAorICAgICgzLCAi
Tk9ORV9SRVFVSVJFRCIpLAogICAgIF0pCiAKIGxpYnhsX2NvbnNvbGVfdHlwZSA9IEVudW1lcmF0
aW9uKCJjb25zb2xlX3R5cGUiLCBbCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5w
cm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8v
eGVuLWRldmVs

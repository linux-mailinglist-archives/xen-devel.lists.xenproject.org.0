Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id BD510144E16
	for <lists+xen-devel@lfdr.de>; Wed, 22 Jan 2020 09:57:38 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iuBmq-0001KJ-Qb; Wed, 22 Jan 2020 08:54:56 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=f6Rd=3L=merlin.srs.infradead.org=batv+5533599fc3e53c5fdf4f+5995+infradead.org+dwmw2@srs-us1.protection.inumbo.net>)
 id 1iuBmo-0001J4-Tv
 for xen-devel@lists.xenproject.org; Wed, 22 Jan 2020 08:54:54 +0000
X-Inumbo-ID: be43464a-3cf4-11ea-9fd7-bc764e2007e4
Received: from merlin.infradead.org (unknown [2001:8b0:10b:1231::1])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id be43464a-3cf4-11ea-9fd7-bc764e2007e4;
 Wed, 22 Jan 2020 08:54:05 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
 d=infradead.org; s=merlin.20170209; h=Sender:Content-Transfer-Encoding:
 MIME-Version:References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:
 Reply-To:Content-Type:Content-ID:Content-Description:Resent-Date:Resent-From:
 Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:List-Id:List-Help:
 List-Unsubscribe:List-Subscribe:List-Post:List-Owner:List-Archive;
 bh=YpVFjO2NezexUvdfjMwtHGGd0yQpiB47FeeWuJ9xZnM=; b=AP2P+Yre0b0pUu1To+6JfJhj7B
 jx/4r7+NAcAQk9rxNn+ejVGNXpYAQCDklTA0K2n7dA+78wYJJJj2PG0G6uJ/6OER1h9UJ12+yNsBF
 d50RfF9xs6iz63f7aJn8VAxJqVmUihNMPernPUZu/+rurHpsBcDdCDs37fEf1Us17hK1TaV6jLnKQ
 UlLmuh9TroMkLYYHU+f0k3efnZeHVTvORXwHcloZ21oy/y6ZIgq1J/Vmu93ZELCsoHtnIURAHBrmL
 HaIzufg2AvBkrMXxN3bhS58JgHCXsAJsfRPg6Vc4CdWbQXbhqjEciHyk33zf2EO2yFFZdqeh1K0+j
 S2pt8w8Q==;
Received: from i7.infradead.org ([2001:8b0:10b:1:21e:67ff:fecb:7a92])
 by merlin.infradead.org with esmtpsa (Exim 4.92.3 #3 (Red Hat Linux))
 id 1iuBlu-0002co-1N; Wed, 22 Jan 2020 08:53:59 +0000
Received: from dwoodhou by i7.infradead.org with local (Exim 4.92 #3 (Red Hat
 Linux)) id 1iuBlt-008mRD-7Y; Wed, 22 Jan 2020 08:53:57 +0000
From: David Woodhouse <dwmw2@infradead.org>
To: Xen-devel <xen-devel@lists.xenproject.org>
Date: Wed, 22 Jan 2020 08:53:45 +0000
Message-Id: <20200122085357.2092778-2-dwmw2@infradead.org>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20200122085357.2092778-1-dwmw2@infradead.org>
References: <6cbe16ae42ab806df513d359220212d4f01ce43d.camel@infradead.org>
 <20200122085357.2092778-1-dwmw2@infradead.org>
MIME-Version: 1.0
X-SRS-Rewrite: SMTP reverse-path rewritten from <dwmw2@infradead.org> by
 merlin.infradead.org. See http://www.infradead.org/rpr.html
Subject: [Xen-devel] [RFC PATCH v2 02/14] x86/boot: Reserve live update boot
 memory
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Stefano Stabellini <sstabellini@kernel.org>, Julien Grall <julien@xen.org>,
 Wei Liu <wl@xen.org>, Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>, Varad Gautam <vrd@amazon.de>,
 paul@xen.org, Ian Jackson <ian.jackson@eu.citrix.com>,
 Hongyan Xia <hongyxia@amazon.com>, Amit Shah <aams@amazon.de>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

RnJvbTogRGF2aWQgV29vZGhvdXNlIDxkd213QGFtYXpvbi5jby51az4KCkZvciBsaXZlIHVwZGF0
ZSB0byB3b3JrLCBpdCB3aWxsIG5lZWQgYSByZWdpb24gb2YgbWVtb3J5IHRoYXQgY2FuIGJlCmdp
dmVuIHRvIHRoZSBib290IGFsbG9jYXRvciB3aGlsZSBpdCBwYXJzZXMgdGhlIHN0YXRlIGluZm9y
bWF0aW9uIGZyb20KdGhlIHByZXZpb3VzIFhlbiBhbmQgd29ya3Mgb3V0IHdoaWNoIG9mIHRoZSBv
dGhlciBwYWdlcyBvZiBtZW1vcnkgaXQKY2FuIGNvbnN1bWUuCgpSZXNlcnZlIHRoYXQgbGlrZSB0
aGUgY3Jhc2hkdW1wIHJlZ2lvbiwgYW5kIGFjY2VwdCBpdCBvbiB0aGUgY29tbWFuZApsaW5lLiBV
c2Ugb25seSB0aGF0IHJlZ2lvbiBmb3IgZWFybHkgYm9vdCwgYW5kIHJlZ2lzdGVyIHRoZSByZW1h
aW5pbmcKUkFNIChhbGwgb2YgaXQgZm9yIG5vdywgdW50aWwgdGhlIHJlYWwgbGl2ZSB1cGRhdGUg
aGFwcGVucykgbGF0ZXIuCgpTaWduZWQtb2ZmLWJ5OiBEYXZpZCBXb29kaG91c2UgPGR3bXdAYW1h
em9uLmNvLnVrPgotLS0KIHhlbi9hcmNoL3g4Ni9zZXR1cC5jICAgICAgICAgfCAxMTQgKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKystLS0KIHhlbi9pbmNsdWRlL2FzbS14ODYvY29uZmln
LmggfCAgIDEgKwogMiBmaWxlcyBjaGFuZ2VkLCAxMDggaW5zZXJ0aW9ucygrKSwgNyBkZWxldGlv
bnMoLSkKCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvc2V0dXAuYyBiL3hlbi9hcmNoL3g4Ni9z
ZXR1cC5jCmluZGV4IDNjNmQwYTViMzUuLjQyMGMzODQ1NmIgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNo
L3g4Ni9zZXR1cC5jCisrKyBiL3hlbi9hcmNoL3g4Ni9zZXR1cC5jCkBAIC02ODEsNiArNjgxLDQx
IEBAIHN0YXRpYyB1bnNpZ25lZCBpbnQgX19pbml0IGNvcHlfYmlvc19lODIwKHN0cnVjdCBlODIw
ZW50cnkgKm1hcCwgdW5zaWduZWQgaW50IGxpCiAvKiBIb3cgbXVjaCBvZiB0aGUgZGlyZWN0bWFw
IGlzIHByZWJ1aWx0IGF0IGNvbXBpbGUgdGltZS4gKi8KICNkZWZpbmUgUFJFQlVJTFRfTUFQX0xJ
TUlUICgxIDw8IEwyX1BBR0VUQUJMRV9TSElGVCkKIAorc3RhdGljIHVuc2lnbmVkIGxvbmcgbHVf
Ym9vdG1lbV9zdGFydCwgbHVfYm9vdG1lbV9zaXplLCBsdV9kYXRhOworCitzdGF0aWMgaW50IF9f
aW5pdCBwYXJzZV9saXZldXBkYXRlKGNvbnN0IGNoYXIgKnN0cikKK3sKKyAgICBjb25zdCBjaGFy
ICpjdXI7CisgICAgbHVfYm9vdG1lbV9zaXplID0gcGFyc2Vfc2l6ZV9hbmRfdW5pdChjdXIgPSBz
dHIsICZzdHIpOworICAgIGlmICghbHVfYm9vdG1lbV9zaXplIHx8IGN1ciA9PSBzdHIpCisgICAg
ICAgIHJldHVybiAtRUlOVkFMOworCisgICAgaWYgKCEqc3RyKSB7CisgICAgICAgIHByaW50aygi
TGl2ZSB1cGRhdGUgc2l6ZSAweCVseFxuIiwgbHVfYm9vdG1lbV9zaXplKTsKKyAgICAgICAgcmV0
dXJuIDA7CisgICAgfQorICAgIGlmICgqc3RyICE9ICdAJykKKyAgICAgICAgcmV0dXJuIC1FSU5W
QUw7CisgICAgbHVfYm9vdG1lbV9zdGFydCA9IHBhcnNlX3NpemVfYW5kX3VuaXQoY3VyID0gc3Ry
ICsgMSwgJnN0cik7CisgICAgaWYgKCFsdV9ib290bWVtX3N0YXJ0IHx8IGN1ciA9PSBzdHIpCisg
ICAgICAgIHJldHVybiAtRUlOVkFMOworCisgICAgcHJpbnRrKCJMaXZlIHVwZGF0ZSBhcmVhIDB4
JWx4LTB4JWx4ICgweCVseClcbiIsIGx1X2Jvb3RtZW1fc3RhcnQsCisgICAgICAgICAgIGx1X2Jv
b3RtZW1fc3RhcnQgKyBsdV9ib290bWVtX3NpemUsIGx1X2Jvb3RtZW1fc2l6ZSk7CisKKyAgICBp
ZiAoISpzdHIpCisgICAgICAgIHJldHVybiAwOworICAgIGlmICgqc3RyICE9ICc6JykKKyAgICAg
ICAgcmV0dXJuIC1FSU5WQUw7CisgICAgbHVfZGF0YSA9IHNpbXBsZV9zdHJ0b3VsbChjdXIgPSBz
dHIgKyAxLCAmc3RyLCAwKTsKKyAgICBpZiAoIWx1X2RhdGEgfHwgY3VyID09IHN0cikKKyAgICAg
ICAgcmV0dXJuIC1FSU5WQUw7CisKKyAgICBwcmludGsoIkxpdmUgdXBkYXRlIGRhdGEgYXQgMHgl
bHhcbiIsIGx1X2RhdGEpOworICAgIHJldHVybiAwOworfQorY3VzdG9tX3BhcmFtKCJsaXZldXBk
YXRlIiwgcGFyc2VfbGl2ZXVwZGF0ZSk7CisKIHZvaWQgX19pbml0IG5vcmV0dXJuIF9fc3RhcnRf
eGVuKHVuc2lnbmVkIGxvbmcgbWJpX3ApCiB7CiAgICAgY2hhciAqbWVtbWFwX3R5cGUgPSBOVUxM
OwpAQCAtNjkwLDcgKzcyNSw3IEBAIHZvaWQgX19pbml0IG5vcmV0dXJuIF9fc3RhcnRfeGVuKHVu
c2lnbmVkIGxvbmcgbWJpX3ApCiAgICAgbW9kdWxlX3QgKm1vZDsKICAgICB1bnNpZ25lZCBsb25n
IG5yX3BhZ2VzLCByYXdfbWF4X3BhZ2UsIG1vZHVsZXNfaGVhZHJvb20sIG1vZHVsZV9tYXBbMV07
CiAgICAgaW50IGksIGosIGU4MjBfd2FybiA9IDAsIGJ5dGVzID0gMDsKLSAgICBib29sIGFjcGlf
Ym9vdF90YWJsZV9pbml0X2RvbmUgPSBmYWxzZSwgcmVsb2NhdGVkID0gZmFsc2U7CisgICAgYm9v
bCBhY3BpX2Jvb3RfdGFibGVfaW5pdF9kb25lID0gZmFsc2UsIHJlbG9jYXRlZCA9IGZhbHNlLCBs
dV9yZXNlcnZlZCA9IGZhbHNlOwogICAgIGludCByZXQ7CiAgICAgc3RydWN0IG5zMTY1NTBfZGVm
YXVsdHMgbnMxNjU1MCA9IHsKICAgICAgICAgLmRhdGFfYml0cyA9IDgsCkBAIC05ODAsNiArMTAx
NSwyMiBAQCB2b2lkIF9faW5pdCBub3JldHVybiBfX3N0YXJ0X3hlbih1bnNpZ25lZCBsb25nIG1i
aV9wKQogICAgIHNldF9rZXhlY19jcmFzaF9hcmVhX3NpemUoKHU2NClucl9wYWdlcyA8PCBQQUdF
X1NISUZUKTsKICAgICBrZXhlY19yZXNlcnZlX2FyZWEoJmJvb3RfZTgyMCk7CiAKKyAgICBpZiAo
IGx1X2Jvb3RtZW1fc3RhcnQgKQorICAgIHsKKyAgICAgICAgLyogWFg6IENoZWNrIGl0J3MgaW4g
dXNhYmxlIG1lbW9yeSBmaXJzdCAqLworICAgICAgICByZXNlcnZlX2U4MjBfcmFtKCZib290X2U4
MjAsIGx1X2Jvb3RtZW1fc3RhcnQsIGx1X2Jvb3RtZW1fc3RhcnQgKyBsdV9ib290bWVtX3NpemUp
OworCisgICAgICAgIC8qIFNpbmNlIGl0IHdpbGwgYWxyZWFkeSBiZSBvdXQgb2YgdGhlIGU4MjAg
bWFwIGJ5IHRoZSB0aW1lIHRoZSBmaXJzdAorICAgICAgICAgKiBsb29wIG92ZXIgcGh5c2ljYWwg
bWVtb3J5LCBtYXAgaXQgbWFudWFsbHkgYWxyZWFkeS4gKi8KKyAgICAgICAgc2V0X3BkeF9yYW5n
ZShsdV9ib290bWVtX3N0YXJ0ID4+IFBBR0VfU0hJRlQsCisgICAgICAgICAgICAgICAgICAgICAg
KGx1X2Jvb3RtZW1fc3RhcnQgKyBsdV9ib290bWVtX3NpemUpID4+IFBBR0VfU0hJRlQpOworICAg
ICAgICBtYXBfcGFnZXNfdG9feGVuKCh1bnNpZ25lZCBsb25nKV9fdmEobHVfYm9vdG1lbV9zdGFy
dCksCisgICAgICAgICAgICAgICAgICAgICAgICAgbWFkZHJfdG9fbWZuKGx1X2Jvb3RtZW1fc3Rh
cnQpLAorICAgICAgICAgICAgICAgICAgICAgICAgIFBGTl9ET1dOKGx1X2Jvb3RtZW1fc2l6ZSks
IFBBR0VfSFlQRVJWSVNPUik7CisKKyAgICAgICAgbHVfcmVzZXJ2ZWQgPSB0cnVlOworICAgIH0K
KwogICAgIGluaXRpYWxfaW1hZ2VzID0gbW9kOwogICAgIG5yX2luaXRpYWxfaW1hZ2VzID0gbWJp
LT5tb2RzX2NvdW50OwogCkBAIC0xMjA3LDYgKzEyNTgsMTYgQEAgdm9pZCBfX2luaXQgbm9yZXR1
cm4gX19zdGFydF94ZW4odW5zaWduZWQgbG9uZyBtYmlfcCkKICAgICAgICAgICAgIHByaW50aygi
TmV3IFhlbiBpbWFnZSBiYXNlIGFkZHJlc3M6ICUjbHhcbiIsIHhlbl9waHlzX3N0YXJ0KTsKICAg
ICAgICAgfQogCisgICAgICAgIC8qIElzIHRoZSByZWdpb24gc3VpdGFibGUgZm9yIHRoZSBsaXZl
IHVwZGF0ZSBib290bWVtIHJlZ2lvbj8gKi8KKyAgICAgICAgaWYgKCBsdV9ib290bWVtX3NpemUg
JiYgISBsdV9ib290bWVtX3N0YXJ0ICYmIGUgPCBsaW1pdCApCisgICAgICAgIHsKKyAgICAgICAg
ICAgIGVuZCA9IGNvbnNpZGVyX21vZHVsZXMocywgZSwgbHVfYm9vdG1lbV9zaXplLCBtb2QsIG1i
aS0+bW9kc19jb3VudCArIHJlbG9jYXRlZCwgLTEpOworICAgICAgICAgICAgaWYgKCBlbmQgKQor
ICAgICAgICAgICAgeworICAgICAgICAgICAgICAgIGUgPSBsdV9ib290bWVtX3N0YXJ0ID0gZW5k
IC0gbHVfYm9vdG1lbV9zaXplOworICAgICAgICAgICAgfQorICAgICAgICB9CisKICAgICAgICAg
LyogSXMgdGhlIHJlZ2lvbiBzdWl0YWJsZSBmb3IgcmVsb2NhdGluZyB0aGUgbXVsdGlib290IG1v
ZHVsZXM/ICovCiAgICAgICAgIGZvciAoIGogPSBtYmktPm1vZHNfY291bnQgLSAxOyBqID49IDA7
IGotLSApCiAgICAgICAgIHsKQEAgLTEyNzAsNiArMTMzMSwxNSBAQCB2b2lkIF9faW5pdCBub3Jl
dHVybiBfX3N0YXJ0X3hlbih1bnNpZ25lZCBsb25nIG1iaV9wKQogICAgIGlmICggIXhlbl9waHlz
X3N0YXJ0ICkKICAgICAgICAgcGFuaWMoIk5vdCBlbm91Z2ggbWVtb3J5IHRvIHJlbG9jYXRlIFhl
blxuIik7CiAKKyAgICBpZiAoIGx1X2Jvb3RtZW1fc3RhcnQgKQorICAgIHsKKyAgICAgICAgaWYg
KCAhbHVfcmVzZXJ2ZWQgKQorICAgICAgICAgICAgcmVzZXJ2ZV9lODIwX3JhbSgmYm9vdF9lODIw
LCBsdV9ib290bWVtX3N0YXJ0LCBsdV9ib290bWVtX3N0YXJ0ICsgbHVfYm9vdG1lbV9zaXplKTsK
KyAgICAgICAgcHJpbnRrKCJMVSBib290bWVtOiAweCVseCAtIDB4JWx4XG4iLCBsdV9ib290bWVt
X3N0YXJ0LCBsdV9ib290bWVtX3N0YXJ0ICsgbHVfYm9vdG1lbV9zaXplKTsKKyAgICAgICAgaW5p
dF9ib290X3BhZ2VzKGx1X2Jvb3RtZW1fc3RhcnQsIGx1X2Jvb3RtZW1fc3RhcnQgKyBsdV9ib290
bWVtX3NpemUpOworICAgICAgICBsdV9yZXNlcnZlZCA9IHRydWU7CisgICAgfQorCiAgICAgLyog
VGhpcyBuZWVkcyB0byByZW1haW4gaW4gc3luYyB3aXRoIHhlbl9pbl9yYW5nZSgpLiAqLwogICAg
IHJlc2VydmVfZTgyMF9yYW0oJmJvb3RfZTgyMCwgX19wYShfc3RleHQpLCBfX3BhKF9fMk1fcndk
YXRhX2VuZCkpOwogCkBAIC0xMjgxLDggKzEzNTEsOCBAQCB2b2lkIF9faW5pdCBub3JldHVybiBf
X3N0YXJ0X3hlbih1bnNpZ25lZCBsb25nIG1iaV9wKQogICAgICAgICB4ZW5oZWFwX21heF9tZm4o
UEZOX0RPV04oaGlnaG1lbV9zdGFydCAtIDEpKTsKIAogICAgIC8qCi0gICAgICogV2FsayBldmVy
eSBSQU0gcmVnaW9uIGFuZCBtYXAgaXQgaW4gaXRzIGVudGlyZXR5IChvbiB4ODYvNjQsIGF0IGxl
YXN0KQotICAgICAqIGFuZCBub3RpZnkgaXQgdG8gdGhlIGJvb3QgYWxsb2NhdG9yLgorICAgICAq
IFdhbGsgZXZlcnkgUkFNIHJlZ2lvbiBhbmQgbWFwIGl0IGluIGl0cyBlbnRpcmV0eSBhbmQgKHVu
bGVzcyBpbgorICAgICAqIGxpdmUgdXBkYXRlIG1vZGUpIG5vdGlmeSBpdCB0byB0aGUgYm9vdCBh
bGxvY2F0b3IuCiAgICAgICovCiAgICAgZm9yICggaSA9IDA7IGkgPCBib290X2U4MjAubnJfbWFw
OyBpKysgKQogICAgIHsKQEAgLTEzMzUsNiArMTQwNSw3IEBAIHZvaWQgX19pbml0IG5vcmV0dXJu
IF9fc3RhcnRfeGVuKHVuc2lnbmVkIGxvbmcgbWJpX3ApCiAgICAgICAgICAgICAgICAgcHJpbnRr
KFhFTkxPR19XQVJOSU5HICJJZ25vcmluZyBpbmFjY2Vzc2libGUgbWVtb3J5IHJhbmdlIgogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiICUwMTMiUFJJeDY0Ii0lMDEzIlBS
SXg2NCJcbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHMsIGUpOworICAgICAgICAgICAgICAg
IHJlc2VydmVfZTgyMF9yYW0oJmJvb3RfZTgyMCwgcywgZSk7CiAgICAgICAgICAgICAgICAgY29u
dGludWU7CiAgICAgICAgICAgICB9CiAgICAgICAgICAgICBtYXBfZSA9IGU7CkBAIC0xMzQyLDYg
KzE0MTMsNyBAQCB2b2lkIF9faW5pdCBub3JldHVybiBfX3N0YXJ0X3hlbih1bnNpZ25lZCBsb25n
IG1iaV9wKQogICAgICAgICAgICAgcHJpbnRrKFhFTkxPR19XQVJOSU5HICJJZ25vcmluZyBpbmFj
Y2Vzc2libGUgbWVtb3J5IHJhbmdlIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICIgJTAxMyJQUkl4NjQiLSUwMTMiUFJJeDY0IlxuIiwKICAgICAgICAgICAgICAgICAgICBlLCBt
YXBfZSk7CisgICAgICAgICAgICByZXNlcnZlX2U4MjBfcmFtKCZib290X2U4MjAsIGUsIG1hcF9l
KTsKICAgICAgICAgfQogCiAgICAgICAgIHNldF9wZHhfcmFuZ2UocyA+PiBQQUdFX1NISUZULCBl
ID4+IFBBR0VfU0hJRlQpOwpAQCAtMTM1Miw3ICsxNDI0LDkgQEAgdm9pZCBfX2luaXQgbm9yZXR1
cm4gX19zdGFydF94ZW4odW5zaWduZWQgbG9uZyBtYmlfcCkKICAgICAgICAgICAgICAgICAgICAg
ICBBUlJBWV9TSVpFKGwyX2lkZW50bWFwKSA8PCBMMl9QQUdFVEFCTEVfU0hJRlQpOwogCiAgICAg
ICAgIC8qIFBhc3MgbWFwcGVkIG1lbW9yeSB0byBhbGxvY2F0b3IgL2JlZm9yZS8gY3JlYXRpbmcg
bmV3IG1hcHBpbmdzLiAqLwotICAgICAgICBpbml0X2Jvb3RfcGFnZXMocywgbWluKG1hcF9zLCBl
KSk7CisgICAgICAgIGlmICggIWx1X3Jlc2VydmVkKQorICAgICAgICAgICAgaW5pdF9ib290X3Bh
Z2VzKHMsIG1pbihtYXBfcywgZSkpOworCiAgICAgICAgIHMgPSBtYXBfczsKICAgICAgICAgaWYg
KCBzIDwgbWFwX2UgKQogICAgICAgICB7CkBAIC0xMzYwLDcgKzE0MzQsOCBAQCB2b2lkIF9faW5p
dCBub3JldHVybiBfX3N0YXJ0X3hlbih1bnNpZ25lZCBsb25nIG1iaV9wKQogCiAgICAgICAgICAg
ICBtYXBfcyA9IChzICsgbWFzaykgJiB+bWFzazsKICAgICAgICAgICAgIG1hcF9lICY9IH5tYXNr
OwotICAgICAgICAgICAgaW5pdF9ib290X3BhZ2VzKG1hcF9zLCBtYXBfZSk7CisgICAgICAgICAg
ICBpZiAoICFsdV9yZXNlcnZlZCkKKyAgICAgICAgICAgICAgICBpbml0X2Jvb3RfcGFnZXMobWFw
X3MsIG1hcF9lKTsKICAgICAgICAgfQogCiAgICAgICAgIGlmICggbWFwX3MgPiBtYXBfZSApCkBA
IC0xMzc2LDcgKzE0NTEsOCBAQCB2b2lkIF9faW5pdCBub3JldHVybiBfX3N0YXJ0X3hlbih1bnNp
Z25lZCBsb25nIG1iaV9wKQogICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIG1hcF9wYWdl
c190b194ZW4oKHVuc2lnbmVkIGxvbmcpX192YShtYXBfZSksIG1hZGRyX3RvX21mbihtYXBfZSks
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQRk5fRE9XTihlbmQgLSBtYXBfZSks
IFBBR0VfSFlQRVJWSVNPUik7Ci0gICAgICAgICAgICAgICAgaW5pdF9ib290X3BhZ2VzKG1hcF9l
LCBlbmQpOworICAgICAgICAgICAgICAgIGlmICggIWx1X3Jlc2VydmVkKQorICAgICAgICAgICAg
ICAgICAgICBpbml0X2Jvb3RfcGFnZXMobWFwX2UsIGVuZCk7CiAgICAgICAgICAgICAgICAgbWFw
X2UgPSBlbmQ7CiAgICAgICAgICAgICB9CiAgICAgICAgIH0KQEAgLTEzOTEsNyArMTQ2Nyw4IEBA
IHZvaWQgX19pbml0IG5vcmV0dXJuIF9fc3RhcnRfeGVuKHVuc2lnbmVkIGxvbmcgbWJpX3ApCiAg
ICAgICAgIHsKICAgICAgICAgICAgIG1hcF9wYWdlc190b194ZW4oKHVuc2lnbmVkIGxvbmcpX192
YShzKSwgbWFkZHJfdG9fbWZuKHMpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQRk5f
RE9XTihtYXBfcyAtIHMpLCBQQUdFX0hZUEVSVklTT1IpOwotICAgICAgICAgICAgaW5pdF9ib290
X3BhZ2VzKHMsIG1hcF9zKTsKKyAgICAgICAgICAgIGlmICggIWx1X3Jlc2VydmVkKQorICAgICAg
ICAgICAgICAgIGluaXRfYm9vdF9wYWdlcyhzLCBtYXBfcyk7CiAgICAgICAgIH0KICAgICB9CiAK
QEAgLTE0ODksNiArMTU2NiwyOSBAQCB2b2lkIF9faW5pdCBub3JldHVybiBfX3N0YXJ0X3hlbih1
bnNpZ25lZCBsb25nIG1iaV9wKQogCiAgICAgbnVtYV9pbml0bWVtX2luaXQoMCwgcmF3X21heF9w
YWdlKTsKIAorICAgIGlmICggbHVfYm9vdG1lbV9zdGFydCApCisgICAgeworICAgICAgICB1bnNp
Z25lZCBsb25nIGxpbWl0ID0gdmlydF90b19tZm4oSFlQRVJWSVNPUl9WSVJUX0VORCAtIDEpOwor
ICAgICAgICB1aW50NjRfdCBtYXNrID0gUEFHRV9TSVpFIC0gMTsKKworICAgICAgICBmb3IgKCBp
ID0gMDsgaSA8IGJvb3RfZTgyMC5ucl9tYXA7IGkrKyApCisgICAgICAgIHsKKyAgICAgICAgICAg
IHVpbnQ2NF90IHMsIGU7CisKKyAgICAgICAgICAgIGlmICggYm9vdF9lODIwLm1hcFtpXS50eXBl
ICE9IEU4MjBfUkFNICkKKyAgICAgICAgICAgICAgICBjb250aW51ZTsKKyAgICAgICAgICAgIHMg
PSAoYm9vdF9lODIwLm1hcFtpXS5hZGRyICsgbWFzaykgJiB+bWFzazsKKyAgICAgICAgICAgIGUg
PSAoYm9vdF9lODIwLm1hcFtpXS5hZGRyICsgYm9vdF9lODIwLm1hcFtpXS5zaXplKSAmIH5tYXNr
OworICAgICAgICAgICAgcyA9IG1heF90KHVpbnQ2NF90LCBzLCAxPDwyMCk7CisgICAgICAgICAg
ICBpZiAoIFBGTl9ET1dOKHMpID4gbGltaXQgKQorICAgICAgICAgICAgICAgIGNvbnRpbnVlOwor
ICAgICAgICAgICAgaWYgKCBQRk5fRE9XTihlKSA+IGxpbWl0ICkKKyAgICAgICAgICAgICAgICBl
ID0gcGZuX3RvX3BhZGRyKGxpbWl0KTsKKworICAgICAgICAgICAgaW5pdF9ib290X3BhZ2VzKHMs
IGUpOworICAgICAgICB9CisgICAgfQorCiAgICAgaWYgKCBtYXhfcGFnZSAtIDEgPiB2aXJ0X3Rv
X21mbihIWVBFUlZJU09SX1ZJUlRfRU5EIC0gMSkgKQogICAgIHsKICAgICAgICAgdW5zaWduZWQg
bG9uZyBsaW1pdCA9IHZpcnRfdG9fbWZuKEhZUEVSVklTT1JfVklSVF9FTkQgLSAxKTsKZGlmZiAt
LWdpdCBhL3hlbi9pbmNsdWRlL2FzbS14ODYvY29uZmlnLmggYi94ZW4vaW5jbHVkZS9hc20teDg2
L2NvbmZpZy5oCmluZGV4IGRhYjdkN2JhZGUuLjU1ZjMyN2RiNzAgMTAwNjQ0Ci0tLSBhL3hlbi9p
bmNsdWRlL2FzbS14ODYvY29uZmlnLmgKKysrIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9jb25maWcu
aApAQCAtMjc4LDYgKzI3OCw3IEBAIGV4dGVybiB1bnNpZ25lZCBjaGFyIGJvb3RfZWRpZF9pbmZv
WzEyOF07CiAKICNpZm5kZWYgX19BU1NFTUJMWV9fCiBleHRlcm4gdW5zaWduZWQgbG9uZyB4ZW5f
cGh5c19zdGFydDsKK2V4dGVybiB1bnNpZ25lZCBsb25nIGx1X2Jvb3RtZW1fc3RhcnQsIGx1X2Jv
b3RtZW1fc2l6ZTsKICNlbmRpZgogCiAvKiBHRFQvTERUIHNoYWRvdyBtYXBwaW5nIGFyZWEuIFRo
ZSBmaXJzdCBwZXItZG9tYWluLW1hcHBpbmcgc3ViLWFyZWEuICovCi0tIAoyLjIxLjAKCgpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFp
bGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhl
bnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

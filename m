Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 21F621619E9
	for <lists+xen-devel@lfdr.de>; Mon, 17 Feb 2020 19:46:14 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1j3lMy-0000gz-TW; Mon, 17 Feb 2020 18:43:48 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=sxmF=4F=citrix.com=roger.pau@srs-us1.protection.inumbo.net>)
 id 1j3lMx-0000gf-Km
 for xen-devel@lists.xenproject.org; Mon, 17 Feb 2020 18:43:47 +0000
X-Inumbo-ID: 6c1fec3a-51b5-11ea-ade5-bc764e2007e4
Received: from esa5.hc3370-68.iphmx.com (unknown [216.71.155.168])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 6c1fec3a-51b5-11ea-ade5-bc764e2007e4;
 Mon, 17 Feb 2020 18:43:43 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1581965023;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=fy6cQxceuSPl5hwnWrPQgOWIlzy0cemwK+hRYbeus8Y=;
 b=G49tQaK4PkODxrbzmORfD3aywbgU+uIRmILI0c17hc6neY9HCp+d8+Ck
 iVF605rjzQ1kzNE/RGLwoL+2ggw9YwKh/KYUQwcqP/BOzTm5eMcYgoo2w
 zrox/hKebcjdXDKIxbFbxock7vws1p1qR8UUKRcxXNPTYwpdIjQFZ4Oof M=;
Authentication-Results: esa5.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=roger.pau@citrix.com;
 spf=Pass smtp.mailfrom=roger.pau@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa5.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 roger.pau@citrix.com) identity=pra; client-ip=162.221.158.21;
 receiver=esa5.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="roger.pau@citrix.com"; x-conformance=sidf_compatible
Received-SPF: Pass (esa5.hc3370-68.iphmx.com: domain of
 roger.pau@citrix.com designates 162.221.158.21 as permitted
 sender) identity=mailfrom; client-ip=162.221.158.21;
 receiver=esa5.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="roger.pau@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83
 ip4:168.245.78.127 ~all"
Received-SPF: None (esa5.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa5.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: 8Be0QSt0IDyT+viQDOiPH1ELl9ECEU2FlooJsn5h/tRPc5WjDtg77hEwr861H44K1Jchqyz1/B
 RgiHsz83cSIKvN+MPY90ZsrEoLgIz1p3Wr7cyPN7RjX8MJl4x18fasgyMmQnUyK7x2Hr1oyX+V
 2Oq+Skf3Xxa8pmI4tqqD6MCDyVR8Cv//HS8+8fOlRW7dYIEfwSYAEv3qoPtSiKCfzZFTeyCGMz
 3Qqp1NFKL4wJsIp1dQCEiPXPfxirBrK2vzghOFd9C6NXWucW/Z9sIU78NIqfzhufG7Xn9oJ6L0
 hVI=
X-SBRS: 2.7
X-MesageID: 12942061
X-Ironport-Server: esa5.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.70,453,1574139600"; d="scan'208";a="12942061"
From: Roger Pau Monne <roger.pau@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Mon, 17 Feb 2020 19:43:24 +0100
Message-ID: <20200217184324.73762-7-roger.pau@citrix.com>
X-Mailer: git-send-email 2.25.0
In-Reply-To: <20200217184324.73762-1-roger.pau@citrix.com>
References: <20200217184324.73762-1-roger.pau@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v2 6/6] x86: add accessors for scratch cpu mask
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>, Wei Liu <wl@xen.org>,
 Jan Beulich <jbeulich@suse.com>, Roger Pau Monne <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

Q3VycmVudCB1c2FnZSBvZiB0aGUgcGVyLUNQVSBzY3JhdGNoIGNwdW1hc2sgaXMgZGFuZ2Vyb3Vz
IHNpbmNlCnRoZXJlJ3Mgbm8gd2F5IHRvIGZpZ3VyZSBvdXQgaWYgdGhlIG1hc2sgaXMgYWxyZWFk
eSBiZWluZyB1c2VkIGV4Y2VwdApmb3IgbWFudWFsIGNvZGUgaW5zcGVjdGlvbiBvZiBhbGwgdGhl
IGNhbGxlcnMgYW5kIHBvc3NpYmxlIGNhbGwgcGF0aHMuCgpUaGlzIGlzIHVuc2FmZSBhbmQgbm90
IHJlbGlhYmxlLCBzbyBpbnRyb2R1Y2UgYSBtaW5pbWFsIGdldC9wdXQKaW5mcmFzdHJ1Y3R1cmUg
dG8gcHJldmVudCBuZXN0ZWQgdXNhZ2Ugb2YgdGhlIHNjcmF0Y2ggbWFzayBhbmQgdXNhZ2UKaW4g
aW50ZXJydXB0IGNvbnRleHQuCgpNb3ZlIHRoZSBkZWNsYXJhdGlvbiBvZiBzY3JhdGNoX2NwdW1h
c2sgdG8gc21wLmMgaW4gb3JkZXIgdG8gcGxhY2UgdGhlCmRlY2xhcmF0aW9uIGFuZCB0aGUgYWNj
ZXNzb3JzIGFzIGNsb3NlIGFzIHBvc3NpYmxlLgoKU2lnbmVkLW9mZi1ieTogUm9nZXIgUGF1IE1v
bm7DqSA8cm9nZXIucGF1QGNpdHJpeC5jb20+Ci0tLQpDaGFuZ2VzIHNpbmNlIHYxOgogLSBVc2Ug
X19idWlsdGluX3JldHVybl9hZGRyZXNzKDApIGluc3RlYWQgb2YgX19mdW5jX18uCiAtIE1vdmUg
ZGVjbGFyYXRpb24gb2Ygc2NyYXRjaF9jcHVtYXNrIGFuZCBzY3JhdGNoX2NwdW1hc2sgYWNjZXNz
b3IgdG8KICAgc21wLmMuCiAtIERvIG5vdCBhbGxvdyB1c2FnZSBpbiAjTUMgb3IgI05NSSBjb250
ZXh0LgotLS0KIHhlbi9hcmNoL3g4Ni9pb19hcGljLmMgICAgfCAgNiArKysrLS0KIHhlbi9hcmNo
L3g4Ni9pcnEuYyAgICAgICAgfCAxMyArKysrKysrKysrLS0tCiB4ZW4vYXJjaC94ODYvbW0uYyAg
ICAgICAgIHwgMzAgKysrKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tCiB4ZW4vYXJjaC94ODYv
bXNpLmMgICAgICAgIHwgIDQgKysrLQogeGVuL2FyY2gveDg2L3NtcC5jICAgICAgICB8IDI1ICsr
KysrKysrKysrKysrKysrKysrKysrKysKIHhlbi9hcmNoL3g4Ni9zbXBib290LmMgICAgfCAgMSAt
CiB4ZW4vaW5jbHVkZS9hc20teDg2L3NtcC5oIHwgMTAgKysrKysrKysrKwogNyBmaWxlcyBjaGFu
Z2VkLCA3MyBpbnNlcnRpb25zKCspLCAxNiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS94ZW4v
YXJjaC94ODYvaW9fYXBpYy5jIGIveGVuL2FyY2gveDg2L2lvX2FwaWMuYwppbmRleCBlOThlMDhl
OWM4Li40ZWUyNjFiNjMyIDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYvaW9fYXBpYy5jCisrKyBi
L3hlbi9hcmNoL3g4Ni9pb19hcGljLmMKQEAgLTIyMzYsMTAgKzIyMzYsMTEgQEAgaW50IGlvX2Fw
aWNfc2V0X3BjaV9yb3V0aW5nIChpbnQgaW9hcGljLCBpbnQgcGluLCBpbnQgaXJxLCBpbnQgZWRn
ZV9sZXZlbCwgaW50IGEKICAgICBlbnRyeS52ZWN0b3IgPSB2ZWN0b3I7CiAKICAgICBpZiAoY3B1
bWFza19pbnRlcnNlY3RzKGRlc2MtPmFyY2guY3B1X21hc2ssIFRBUkdFVF9DUFVTKSkgewotICAg
ICAgICBjcHVtYXNrX3QgKm1hc2sgPSB0aGlzX2NwdShzY3JhdGNoX2NwdW1hc2spOworICAgICAg
ICBjcHVtYXNrX3QgKm1hc2sgPSBnZXRfc2NyYXRjaF9jcHVtYXNrKCk7CiAKICAgICAgICAgY3B1
bWFza19hbmQobWFzaywgZGVzYy0+YXJjaC5jcHVfbWFzaywgVEFSR0VUX0NQVVMpOwogICAgICAg
ICBTRVRfREVTVChlbnRyeSwgbG9naWNhbCwgY3B1X21hc2tfdG9fYXBpY2lkKG1hc2spKTsKKyAg
ICAgICAgcHV0X3NjcmF0Y2hfY3B1bWFzaygpOwogICAgIH0gZWxzZSB7CiAgICAgICAgIHByaW50
ayhYRU5MT0dfRVJSICJJUlElZDogbm8gdGFyZ2V0IENQVSAoJSpwYiB2cyAlKnBiKVxuIiwKICAg
ICAgICAgICAgICAgIGlycSwgQ1BVTUFTS19QUihkZXNjLT5hcmNoLmNwdV9tYXNrKSwgQ1BVTUFT
S19QUihUQVJHRVRfQ1BVUykpOwpAQCAtMjQzMywxMCArMjQzNCwxMSBAQCBpbnQgaW9hcGljX2d1
ZXN0X3dyaXRlKHVuc2lnbmVkIGxvbmcgcGh5c2Jhc2UsIHVuc2lnbmVkIGludCByZWcsIHUzMiB2
YWwpCiAKICAgICBpZiAoIGNwdW1hc2tfaW50ZXJzZWN0cyhkZXNjLT5hcmNoLmNwdV9tYXNrLCBU
QVJHRVRfQ1BVUykgKQogICAgIHsKLSAgICAgICAgY3B1bWFza190ICptYXNrID0gdGhpc19jcHUo
c2NyYXRjaF9jcHVtYXNrKTsKKyAgICAgICAgY3B1bWFza190ICptYXNrID0gZ2V0X3NjcmF0Y2hf
Y3B1bWFzaygpOwogCiAgICAgICAgIGNwdW1hc2tfYW5kKG1hc2ssIGRlc2MtPmFyY2guY3B1X21h
c2ssIFRBUkdFVF9DUFVTKTsKICAgICAgICAgU0VUX0RFU1QocnRlLCBsb2dpY2FsLCBjcHVfbWFz
a190b19hcGljaWQobWFzaykpOworICAgICAgICBwdXRfc2NyYXRjaF9jcHVtYXNrKCk7CiAgICAg
fQogICAgIGVsc2UKICAgICB7CmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvaXJxLmMgYi94ZW4v
YXJjaC94ODYvaXJxLmMKaW5kZXggY2MyZWI4ZTkyNS4uN2VjZjUzNzZlMyAxMDA2NDQKLS0tIGEv
eGVuL2FyY2gveDg2L2lycS5jCisrKyBiL3hlbi9hcmNoL3g4Ni9pcnEuYwpAQCAtMTk2LDcgKzE5
Niw3IEBAIHN0YXRpYyB2b2lkIF9jbGVhcl9pcnFfdmVjdG9yKHN0cnVjdCBpcnFfZGVzYyAqZGVz
YykKIHsKICAgICB1bnNpZ25lZCBpbnQgY3B1LCBvbGRfdmVjdG9yLCBpcnEgPSBkZXNjLT5pcnE7
CiAgICAgdW5zaWduZWQgaW50IHZlY3RvciA9IGRlc2MtPmFyY2gudmVjdG9yOwotICAgIGNwdW1h
c2tfdCAqdG1wX21hc2sgPSB0aGlzX2NwdShzY3JhdGNoX2NwdW1hc2spOworICAgIGNwdW1hc2tf
dCAqdG1wX21hc2sgPSBnZXRfc2NyYXRjaF9jcHVtYXNrKCk7CiAKICAgICBCVUdfT04oIXZhbGlk
X2lycV92ZWN0b3IodmVjdG9yKSk7CiAKQEAgLTIyMyw3ICsyMjMsMTAgQEAgc3RhdGljIHZvaWQg
X2NsZWFyX2lycV92ZWN0b3Ioc3RydWN0IGlycV9kZXNjICpkZXNjKQogICAgIHRyYWNlX2lycV9t
YXNrKFRSQ19IV19JUlFfQ0xFQVJfVkVDVE9SLCBpcnEsIHZlY3RvciwgdG1wX21hc2spOwogCiAg
ICAgaWYgKCBsaWtlbHkoIWRlc2MtPmFyY2gubW92ZV9pbl9wcm9ncmVzcykgKQorICAgIHsKKyAg
ICAgICAgcHV0X3NjcmF0Y2hfY3B1bWFzaygpOwogICAgICAgICByZXR1cm47CisgICAgfQogCiAg
ICAgLyogSWYgd2Ugd2VyZSBpbiBtb3Rpb24sIGFsc28gY2xlYXIgZGVzYy0+YXJjaC5vbGRfdmVj
dG9yICovCiAgICAgb2xkX3ZlY3RvciA9IGRlc2MtPmFyY2gub2xkX3ZlY3RvcjsKQEAgLTIzNiw2
ICsyMzksNyBAQCBzdGF0aWMgdm9pZCBfY2xlYXJfaXJxX3ZlY3RvcihzdHJ1Y3QgaXJxX2Rlc2Mg
KmRlc2MpCiAgICAgICAgIHBlcl9jcHUodmVjdG9yX2lycSwgY3B1KVtvbGRfdmVjdG9yXSA9IH5p
cnE7CiAgICAgfQogCisgICAgcHV0X3NjcmF0Y2hfY3B1bWFzaygpOwogICAgIHJlbGVhc2Vfb2xk
X3ZlYyhkZXNjKTsKIAogICAgIGRlc2MtPmFyY2gubW92ZV9pbl9wcm9ncmVzcyA9IDA7CkBAIC0x
MTUyLDEwICsxMTU2LDExIEBAIHN0YXRpYyB2b2lkIGlycV9ndWVzdF9lb2lfdGltZXJfZm4odm9p
ZCAqZGF0YSkKICAgICAgICAgYnJlYWs7CiAKICAgICBjYXNlIEFDS1RZUEVfRU9JOgotICAgICAg
ICBjcHVfZW9pX21hcCA9IHRoaXNfY3B1KHNjcmF0Y2hfY3B1bWFzayk7CisgICAgICAgIGNwdV9l
b2lfbWFwID0gZ2V0X3NjcmF0Y2hfY3B1bWFzaygpOwogICAgICAgICBjcHVtYXNrX2NvcHkoY3B1
X2VvaV9tYXAsIGFjdGlvbi0+Y3B1X2VvaV9tYXApOwogICAgICAgICBzcGluX3VubG9ja19pcnEo
JmRlc2MtPmxvY2spOwogICAgICAgICBvbl9zZWxlY3RlZF9jcHVzKGNwdV9lb2lfbWFwLCBzZXRf
ZW9pX3JlYWR5LCBkZXNjLCAwKTsKKyAgICAgICAgcHV0X3NjcmF0Y2hfY3B1bWFzaygpOwogICAg
ICAgICByZXR1cm47CiAgICAgfQogCkBAIC0yNTMxLDEyICsyNTM2LDEyIEBAIHZvaWQgZml4dXBf
aXJxcyhjb25zdCBjcHVtYXNrX3QgKm1hc2ssIGJvb2wgdmVyYm9zZSkKICAgICB1bnNpZ25lZCBp
bnQgaXJxOwogICAgIHN0YXRpYyBpbnQgd2FybmVkOwogICAgIHN0cnVjdCBpcnFfZGVzYyAqZGVz
YzsKKyAgICBjcHVtYXNrX3QgKmFmZmluaXR5ID0gZ2V0X3NjcmF0Y2hfY3B1bWFzaygpOwogCiAg
ICAgZm9yICggaXJxID0gMDsgaXJxIDwgbnJfaXJxczsgaXJxKysgKQogICAgIHsKICAgICAgICAg
Ym9vbCBicmVha19hZmZpbml0eSA9IGZhbHNlLCBzZXRfYWZmaW5pdHkgPSB0cnVlOwogICAgICAg
ICB1bnNpZ25lZCBpbnQgdmVjdG9yOwotICAgICAgICBjcHVtYXNrX3QgKmFmZmluaXR5ID0gdGhp
c19jcHUoc2NyYXRjaF9jcHVtYXNrKTsKIAogICAgICAgICBpZiAoIGlycSA9PSAyICkKICAgICAg
ICAgICAgIGNvbnRpbnVlOwpAQCAtMjY0MCw2ICsyNjQ1LDggQEAgdm9pZCBmaXh1cF9pcnFzKGNv
bnN0IGNwdW1hc2tfdCAqbWFzaywgYm9vbCB2ZXJib3NlKQogICAgICAgICAgICAgICAgICAgIGly
cSwgQ1BVTUFTS19QUihhZmZpbml0eSkpOwogICAgIH0KIAorICAgIHB1dF9zY3JhdGNoX2NwdW1h
c2soKTsKKwogICAgIC8qIFRoYXQgZG9lc24ndCBzZWVtIHN1ZmZpY2llbnQuICBHaXZlIGl0IDFt
cy4gKi8KICAgICBsb2NhbF9pcnFfZW5hYmxlKCk7CiAgICAgbWRlbGF5KDEpOwpkaWZmIC0tZ2l0
IGEveGVuL2FyY2gveDg2L21tLmMgYi94ZW4vYXJjaC94ODYvbW0uYwppbmRleCBlZGMyMzhlNTFh
Li43NWI2MTE0YzFjIDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYvbW0uYworKysgYi94ZW4vYXJj
aC94ODYvbW0uYwpAQCAtMTI2MSw3ICsxMjYxLDcgQEAgdm9pZCBwdXRfcGFnZV9mcm9tX2wxZShs
MV9wZ2VudHJ5X3QgbDFlLCBzdHJ1Y3QgZG9tYWluICpsMWVfb3duZXIpCiAgICAgICAgICAgICAg
KGwxZV9vd25lciA9PSBwZ19vd25lcikgKQogICAgICAgICB7CiAgICAgICAgICAgICBzdHJ1Y3Qg
dmNwdSAqdjsKLSAgICAgICAgICAgIGNwdW1hc2tfdCAqbWFzayA9IHRoaXNfY3B1KHNjcmF0Y2hf
Y3B1bWFzayk7CisgICAgICAgICAgICBjcHVtYXNrX3QgKm1hc2sgPSBnZXRfc2NyYXRjaF9jcHVt
YXNrKCk7CiAKICAgICAgICAgICAgIGNwdW1hc2tfY2xlYXIobWFzayk7CiAKQEAgLTEyNzgsNiAr
MTI3OCw3IEBAIHZvaWQgcHV0X3BhZ2VfZnJvbV9sMWUobDFfcGdlbnRyeV90IGwxZSwgc3RydWN0
IGRvbWFpbiAqbDFlX293bmVyKQogCiAgICAgICAgICAgICBpZiAoICFjcHVtYXNrX2VtcHR5KG1h
c2spICkKICAgICAgICAgICAgICAgICBmbHVzaF90bGJfbWFzayhtYXNrKTsKKyAgICAgICAgICAg
IHB1dF9zY3JhdGNoX2NwdW1hc2soKTsKICAgICAgICAgfQogI2VuZGlmIC8qIENPTkZJR19QVl9M
RFRfUEFHSU5HICovCiAgICAgICAgIHB1dF9wYWdlKHBhZ2UpOwpAQCAtMjkwMiw3ICsyOTAzLDcg
QEAgc3RhdGljIGludCBfZ2V0X3BhZ2VfdHlwZShzdHJ1Y3QgcGFnZV9pbmZvICpwYWdlLCB1bnNp
Z25lZCBsb25nIHR5cGUsCiAgICAgICAgICAgICAgICAgICogdml0YWwgdGhhdCBubyBvdGhlciBD
UFVzIGFyZSBsZWZ0IHdpdGggbWFwcGluZ3Mgb2YgYSBmcmFtZQogICAgICAgICAgICAgICAgICAq
IHdoaWNoIGlzIGFib3V0IHRvIGJlY29tZSB3cml0ZWFibGUgdG8gdGhlIGd1ZXN0LgogICAgICAg
ICAgICAgICAgICAqLwotICAgICAgICAgICAgICAgIGNwdW1hc2tfdCAqbWFzayA9IHRoaXNfY3B1
KHNjcmF0Y2hfY3B1bWFzayk7CisgICAgICAgICAgICAgICAgY3B1bWFza190ICptYXNrID0gZ2V0
X3NjcmF0Y2hfY3B1bWFzaygpOwogCiAgICAgICAgICAgICAgICAgQlVHX09OKGluX2lycSgpKTsK
ICAgICAgICAgICAgICAgICBjcHVtYXNrX2NvcHkobWFzaywgZC0+ZGlydHlfY3B1bWFzayk7CkBA
IC0yOTE4LDYgKzI5MTksNyBAQCBzdGF0aWMgaW50IF9nZXRfcGFnZV90eXBlKHN0cnVjdCBwYWdl
X2luZm8gKnBhZ2UsIHVuc2lnbmVkIGxvbmcgdHlwZSwKICAgICAgICAgICAgICAgICAgICAgcGVy
ZmNfaW5jcihuZWVkX2ZsdXNoX3RsYl9mbHVzaCk7CiAgICAgICAgICAgICAgICAgICAgIGZsdXNo
X3RsYl9tYXNrKG1hc2spOwogICAgICAgICAgICAgICAgIH0KKyAgICAgICAgICAgICAgICBwdXRf
c2NyYXRjaF9jcHVtYXNrKCk7CiAKICAgICAgICAgICAgICAgICAvKiBXZSBsb3NlIGV4aXN0aW5n
IHR5cGUgYW5kIHZhbGlkaXR5LiAqLwogICAgICAgICAgICAgICAgIG54ICY9IH4oUEdUX3R5cGVf
bWFzayB8IFBHVF92YWxpZGF0ZWQpOwpAQCAtMzYzNCw3ICszNjM2LDcgQEAgbG9uZyBkb19tbXVl
eHRfb3AoCiAgICAgICAgIGNhc2UgTU1VRVhUX1RMQl9GTFVTSF9NVUxUSToKICAgICAgICAgY2Fz
ZSBNTVVFWFRfSU5WTFBHX01VTFRJOgogICAgICAgICB7Ci0gICAgICAgICAgICBjcHVtYXNrX3Qg
Km1hc2sgPSB0aGlzX2NwdShzY3JhdGNoX2NwdW1hc2spOworICAgICAgICAgICAgY3B1bWFza190
ICptYXNrID0gZ2V0X3NjcmF0Y2hfY3B1bWFzaygpOwogCiAgICAgICAgICAgICBpZiAoIHVubGlr
ZWx5KGN1cnJkICE9IHBnX293bmVyKSApCiAgICAgICAgICAgICAgICAgcmMgPSAtRVBFUk07CkBA
IC0zNjQ0LDEyICszNjQ2LDE3IEBAIGxvbmcgZG9fbW11ZXh0X29wKAogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBtYXNrKSkgKQogICAgICAgICAgICAgICAgIHJjID0gLUVJTlZB
TDsKICAgICAgICAgICAgIGlmICggdW5saWtlbHkocmMpICkKKyAgICAgICAgICAgIHsKKyAgICAg
ICAgICAgICAgICBwdXRfc2NyYXRjaF9jcHVtYXNrKCk7CiAgICAgICAgICAgICAgICAgYnJlYWs7
CisgICAgICAgICAgICB9CiAKICAgICAgICAgICAgIGlmICggb3AuY21kID09IE1NVUVYVF9UTEJf
RkxVU0hfTVVMVEkgKQogICAgICAgICAgICAgICAgIGZsdXNoX3RsYl9tYXNrKG1hc2spOwogICAg
ICAgICAgICAgZWxzZSBpZiAoIF9fYWRkcl9vayhvcC5hcmcxLmxpbmVhcl9hZGRyKSApCiAgICAg
ICAgICAgICAgICAgZmx1c2hfdGxiX29uZV9tYXNrKG1hc2ssIG9wLmFyZzEubGluZWFyX2FkZHIp
OworICAgICAgICAgICAgcHV0X3NjcmF0Y2hfY3B1bWFzaygpOworCiAgICAgICAgICAgICBicmVh
azsKICAgICAgICAgfQogCkBAIC0zNjgyLDcgKzM2ODksNyBAQCBsb25nIGRvX21tdWV4dF9vcCgK
ICAgICAgICAgICAgIGVsc2UgaWYgKCBsaWtlbHkoY2FjaGVfZmx1c2hfcGVybWl0dGVkKGN1cnJk
KSkgKQogICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCBjcHU7Ci0g
ICAgICAgICAgICAgICAgY3B1bWFza190ICptYXNrID0gdGhpc19jcHUoc2NyYXRjaF9jcHVtYXNr
KTsKKyAgICAgICAgICAgICAgICBjcHVtYXNrX3QgKm1hc2sgPSBnZXRfc2NyYXRjaF9jcHVtYXNr
KCk7CiAKICAgICAgICAgICAgICAgICBjcHVtYXNrX2NsZWFyKG1hc2spOwogICAgICAgICAgICAg
ICAgIGZvcl9lYWNoX29ubGluZV9jcHUoY3B1KQpAQCAtMzY5MCw2ICszNjk3LDcgQEAgbG9uZyBk
b19tbXVleHRfb3AoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBwZXJfY3B1KGNwdV9zaWJsaW5nX21hc2ssIGNwdSkpICkKICAgICAgICAgICAgICAgICAgICAg
ICAgIF9fY3B1bWFza19zZXRfY3B1KGNwdSwgbWFzayk7CiAgICAgICAgICAgICAgICAgZmx1c2hf
bWFzayhtYXNrLCBGTFVTSF9DQUNIRSk7CisgICAgICAgICAgICAgICAgcHV0X3NjcmF0Y2hfY3B1
bWFzaygpOwogICAgICAgICAgICAgfQogICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg
IHJjID0gLUVJTlZBTDsKQEAgLTQxNTUsMTIgKzQxNjMsMTMgQEAgbG9uZyBkb19tbXVfdXBkYXRl
KAogICAgICAgICAgKiBGb3JjZSBvdGhlciB2Q1BVLXMgb2YgdGhlIGFmZmVjdGVkIGd1ZXN0IHRv
IHBpY2sgdXAgTDQgZW50cnkKICAgICAgICAgICogY2hhbmdlcyAoaWYgYW55KS4KICAgICAgICAg
ICovCi0gICAgICAgIHVuc2lnbmVkIGludCBjcHUgPSBzbXBfcHJvY2Vzc29yX2lkKCk7Ci0gICAg
ICAgIGNwdW1hc2tfdCAqbWFzayA9IHBlcl9jcHUoc2NyYXRjaF9jcHVtYXNrLCBjcHUpOworICAg
ICAgICBjcHVtYXNrX3QgKm1hc2sgPSBnZXRfc2NyYXRjaF9jcHVtYXNrKCk7CiAKLSAgICAgICAg
Y3B1bWFza19hbmRub3QobWFzaywgcHRfb3duZXItPmRpcnR5X2NwdW1hc2ssIGNwdW1hc2tfb2Yo
Y3B1KSk7CisgICAgICAgIGNwdW1hc2tfYW5kbm90KG1hc2ssIHB0X293bmVyLT5kaXJ0eV9jcHVt
YXNrLAorICAgICAgICAgICAgICAgICAgICAgICBjcHVtYXNrX29mKHNtcF9wcm9jZXNzb3JfaWQo
KSkpOwogICAgICAgICBpZiAoICFjcHVtYXNrX2VtcHR5KG1hc2spICkKICAgICAgICAgICAgIGZs
dXNoX21hc2sobWFzaywgRkxVU0hfVExCX0dMT0JBTCB8IEZMVVNIX1JPT1RfUEdUQkwpOworICAg
ICAgICBwdXRfc2NyYXRjaF9jcHVtYXNrKCk7CiAgICAgfQogCiAgICAgcGVyZmNfYWRkKG51bV9w
YWdlX3VwZGF0ZXMsIGkpOwpAQCAtNDM1Miw3ICs0MzYxLDcgQEAgc3RhdGljIGludCBfX2RvX3Vw
ZGF0ZV92YV9tYXBwaW5nKAogICAgICAgICAgICAgbWFzayA9IGQtPmRpcnR5X2NwdW1hc2s7CiAg
ICAgICAgICAgICBicmVhazsKICAgICAgICAgZGVmYXVsdDoKLSAgICAgICAgICAgIG1hc2sgPSB0
aGlzX2NwdShzY3JhdGNoX2NwdW1hc2spOworICAgICAgICAgICAgbWFzayA9IGdldF9zY3JhdGNo
X2NwdW1hc2soKTsKICAgICAgICAgICAgIHJjID0gdmNwdW1hc2tfdG9fcGNwdW1hc2soZCwgY29u
c3RfZ3Vlc3RfaGFuZGxlX2Zyb21fcHRyKGJtYXBfcHRyLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCksCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hc2spOwpAQCAtNDM3Miw3ICs0
MzgxLDcgQEAgc3RhdGljIGludCBfX2RvX3VwZGF0ZV92YV9tYXBwaW5nKAogICAgICAgICAgICAg
bWFzayA9IGQtPmRpcnR5X2NwdW1hc2s7CiAgICAgICAgICAgICBicmVhazsKICAgICAgICAgZGVm
YXVsdDoKLSAgICAgICAgICAgIG1hc2sgPSB0aGlzX2NwdShzY3JhdGNoX2NwdW1hc2spOworICAg
ICAgICAgICAgbWFzayA9IGdldF9zY3JhdGNoX2NwdW1hc2soKTsKICAgICAgICAgICAgIHJjID0g
dmNwdW1hc2tfdG9fcGNwdW1hc2soZCwgY29uc3RfZ3Vlc3RfaGFuZGxlX2Zyb21fcHRyKGJtYXBf
cHRyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgdm9pZCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIG1hc2spOwpAQCAtNDM4Myw2ICs0MzkyLDkgQEAgc3RhdGljIGludCBfX2RvX3VwZGF0
ZV92YV9tYXBwaW5nKAogICAgICAgICBicmVhazsKICAgICB9CiAKKyAgICBpZiAoIG1hc2sgJiYg
bWFzayAhPSBkLT5kaXJ0eV9jcHVtYXNrICkKKyAgICAgICAgcHV0X3NjcmF0Y2hfY3B1bWFzaygp
OworCiAgICAgcmV0dXJuIHJjOwogfQogCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvbXNpLmMg
Yi94ZW4vYXJjaC94ODYvbXNpLmMKaW5kZXggMTYxZWU2MGRiZS4uNjYyNGVhMjBkMCAxMDA2NDQK
LS0tIGEveGVuL2FyY2gveDg2L21zaS5jCisrKyBiL3hlbi9hcmNoL3g4Ni9tc2kuYwpAQCAtMTU5
LDEzICsxNTksMTUgQEAgdm9pZCBtc2lfY29tcG9zZV9tc2codW5zaWduZWQgdmVjdG9yLCBjb25z
dCBjcHVtYXNrX3QgKmNwdV9tYXNrLCBzdHJ1Y3QgbXNpX21zZwogCiAgICAgaWYgKCBjcHVfbWFz
ayApCiAgICAgewotICAgICAgICBjcHVtYXNrX3QgKm1hc2sgPSB0aGlzX2NwdShzY3JhdGNoX2Nw
dW1hc2spOworICAgICAgICBjcHVtYXNrX3QgKm1hc2s7CiAKICAgICAgICAgaWYgKCAhY3B1bWFz
a19pbnRlcnNlY3RzKGNwdV9tYXNrLCAmY3B1X29ubGluZV9tYXApICkKICAgICAgICAgICAgIHJl
dHVybjsKIAorICAgICAgICBtYXNrID0gZ2V0X3NjcmF0Y2hfY3B1bWFzaygpOwogICAgICAgICBj
cHVtYXNrX2FuZChtYXNrLCBjcHVfbWFzaywgJmNwdV9vbmxpbmVfbWFwKTsKICAgICAgICAgbXNn
LT5kZXN0MzIgPSBjcHVfbWFza190b19hcGljaWQobWFzayk7CisgICAgICAgIHB1dF9zY3JhdGNo
X2NwdW1hc2soKTsKICAgICB9CiAKICAgICBtc2ctPmFkZHJlc3NfaGkgPSBNU0lfQUREUl9CQVNF
X0hJOwpkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L3NtcC5jIGIveGVuL2FyY2gveDg2L3NtcC5j
CmluZGV4IDBhOWE5ZTdmMDIuLjhhZDJiNjkxMmYgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9z
bXAuYworKysgYi94ZW4vYXJjaC94ODYvc21wLmMKQEAgLTI1LDYgKzI1LDMxIEBACiAjaW5jbHVk
ZSA8aXJxX3ZlY3RvcnMuaD4KICNpbmNsdWRlIDxtYWNoX2FwaWMuaD4KIAorREVGSU5FX1BFUl9D
UFVfUkVBRF9NT1NUTFkoY3B1bWFza192YXJfdCwgc2NyYXRjaF9jcHVtYXNrKTsKKworI2lmbmRl
ZiBOREVCVUcKK2NwdW1hc2tfdCAqc2NyYXRjaF9jcHVtYXNrKGJvb2wgdXNlKQoreworICAgIHN0
YXRpYyBERUZJTkVfUEVSX0NQVSh2b2lkICosIHNjcmF0Y2hfY3B1bWFza191c2UpOworCisgICAg
LyoKKyAgICAgKiBEdWUgdG8gcmVlbnRyYW5jeSBzY3JhdGNoIGNwdW1hc2sgY2Fubm90IGJlIHVz
ZWQgaW4gSVJRLCAjTUMgb3IgI05NSQorICAgICAqIGNvbnRleHQuCisgICAgICovCisgICAgQlVH
X09OKGluX2lycSgpIHx8IGluX21jKCkgfHwgaW5fbm1pKCkpOworCisgICAgaWYgKCB1c2UgJiYg
dW5saWtlbHkodGhpc19jcHUoc2NyYXRjaF9jcHVtYXNrX3VzZSkpICkKKyAgICB7CisgICAgICAg
IHByaW50aygiJXA6IHNjcmF0Y2ggQ1BVIG1hc2sgYWxyZWFkeSBpbiB1c2UgYnkgJXBcbiIsCisg
ICAgICAgICAgICAgICBfX2J1aWx0aW5fcmV0dXJuX2FkZHJlc3MoMCksIHRoaXNfY3B1KHNjcmF0
Y2hfY3B1bWFza191c2UpKTsKKyAgICAgICAgQlVHKCk7CisgICAgfQorICAgIHRoaXNfY3B1KHNj
cmF0Y2hfY3B1bWFza191c2UpID0gdXNlID8gX19idWlsdGluX3JldHVybl9hZGRyZXNzKDApIDog
TlVMTDsKKworICAgIHJldHVybiB1c2UgPyB0aGlzX2NwdShzY3JhdGNoX2NwdW1hc2spIDogTlVM
TDsKK30KKyNlbmRpZgorCiAvKiBIZWxwZXIgZnVuY3Rpb25zIHRvIHByZXBhcmUgQVBJQyByZWdp
c3RlciB2YWx1ZXMuICovCiBzdGF0aWMgdW5zaWduZWQgaW50IHByZXBhcmVfSUNSKHVuc2lnbmVk
IGludCBzaG9ydGN1dCwgaW50IHZlY3RvcikKIHsKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9z
bXBib290LmMgYi94ZW4vYXJjaC94ODYvc21wYm9vdC5jCmluZGV4IDgyZTg5MjAxYjMuLmEyYWMz
YWRiMzggMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9zbXBib290LmMKKysrIGIveGVuL2FyY2gv
eDg2L3NtcGJvb3QuYwpAQCAtNTQsNyArNTQsNiBAQCBERUZJTkVfUEVSX0NQVV9SRUFEX01PU1RM
WShjcHVtYXNrX3Zhcl90LCBjcHVfc2libGluZ19tYXNrKTsKIC8qIHJlcHJlc2VudGluZyBIVCBh
bmQgY29yZSBzaWJsaW5ncyBvZiBlYWNoIGxvZ2ljYWwgQ1BVICovCiBERUZJTkVfUEVSX0NQVV9S
RUFEX01PU1RMWShjcHVtYXNrX3Zhcl90LCBjcHVfY29yZV9tYXNrKTsKIAotREVGSU5FX1BFUl9D
UFVfUkVBRF9NT1NUTFkoY3B1bWFza192YXJfdCwgc2NyYXRjaF9jcHVtYXNrKTsKIHN0YXRpYyBj
cHVtYXNrX3Qgc2NyYXRjaF9jcHUwbWFzazsKIAogREVGSU5FX1BFUl9DUFVfUkVBRF9NT1NUTFko
Y3B1bWFza192YXJfdCwgc2VuZF9pcGlfY3B1bWFzayk7CmRpZmYgLS1naXQgYS94ZW4vaW5jbHVk
ZS9hc20teDg2L3NtcC5oIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9zbXAuaAppbmRleCA5MmQ2OWE1
ZWEwLi40MGFiNmMyNTFkIDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS9hc20teDg2L3NtcC5oCisr
KyBiL3hlbi9pbmNsdWRlL2FzbS14ODYvc21wLmgKQEAgLTIzLDYgKzIzLDE2IEBAIERFQ0xBUkVf
UEVSX0NQVShjcHVtYXNrX3Zhcl90LCBjcHVfc2libGluZ19tYXNrKTsKIERFQ0xBUkVfUEVSX0NQ
VShjcHVtYXNrX3Zhcl90LCBjcHVfY29yZV9tYXNrKTsKIERFQ0xBUkVfUEVSX0NQVShjcHVtYXNr
X3Zhcl90LCBzY3JhdGNoX2NwdW1hc2spOwogCisjaWZuZGVmIE5ERUJVRworLyogTm90IHRvIGJl
IGNhbGxlZCBkaXJlY3RseSwgdXNlIHtnZXQvcHV0fV9zY3JhdGNoX2NwdW1hc2soKS4gKi8KK2Nw
dW1hc2tfdCAqc2NyYXRjaF9jcHVtYXNrKGJvb2wgdXNlKTsKKyNkZWZpbmUgZ2V0X3NjcmF0Y2hf
Y3B1bWFzaygpIHNjcmF0Y2hfY3B1bWFzayh0cnVlKQorI2RlZmluZSBwdXRfc2NyYXRjaF9jcHVt
YXNrKCkgKCh2b2lkKXNjcmF0Y2hfY3B1bWFzayhmYWxzZSkpCisjZWxzZQorI2RlZmluZSBnZXRf
c2NyYXRjaF9jcHVtYXNrKCkgdGhpc19jcHUoc2NyYXRjaF9jcHVtYXNrKQorI2RlZmluZSBwdXRf
c2NyYXRjaF9jcHVtYXNrKCkKKyNlbmRpZgorCiAvKgogICogRG8gd2UsIGZvciBwbGF0Zm9ybSBy
ZWFzb25zLCBuZWVkIHRvIGFjdHVhbGx5IGtlZXAgQ1BVcyBvbmxpbmUgd2hlbiB3ZQogICogd291
bGQgb3RoZXJ3aXNlIHByZWZlciB0aGVtIHRvIGJlIG9mZj8KLS0gCjIuMjUuMAoKCl9fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5n
IGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJv
amVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

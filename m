Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id B6509AE8FF
	for <lists+xen-devel@lfdr.de>; Tue, 10 Sep 2019 13:19:49 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i7e90-0003K0-Ii; Tue, 10 Sep 2019 11:17:10 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=IMu8=XF=arm.com=julien.grall@srs-us1.protection.inumbo.net>)
 id 1i7e8z-0003Jv-1B
 for xen-devel@lists.xenproject.org; Tue, 10 Sep 2019 11:17:09 +0000
X-Inumbo-ID: 8541abb2-d3bc-11e9-978d-bc764e2007e4
Received: from foss.arm.com (unknown [217.140.110.172])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTP
 id 8541abb2-d3bc-11e9-978d-bc764e2007e4;
 Tue, 10 Sep 2019 11:17:05 +0000 (UTC)
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.121.207.14])
 by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id 372421000;
 Tue, 10 Sep 2019 04:17:05 -0700 (PDT)
Received: from [10.37.12.141] (unknown [10.37.12.141])
 by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPSA id 874B33F59C;
 Tue, 10 Sep 2019 04:17:03 -0700 (PDT)
From: Julien Grall <julien.grall@arm.com>
To: Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>,
 "xen-devel@lists.xenproject.org" <xen-devel@lists.xenproject.org>
References: <20190823184826.14525-1-volodymyr_babchuk@epam.com>
 <20190823184826.14525-5-volodymyr_babchuk@epam.com>
Message-ID: <53631114-2bb1-18a8-615d-3768facdcc78@arm.com>
Date: Tue, 10 Sep 2019 12:17:00 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.8.0
MIME-Version: 1.0
In-Reply-To: <20190823184826.14525-5-volodymyr_babchuk@epam.com>
Content-Language: en-US
Subject: Re: [Xen-devel] [PATCH 4/5] xen/arm: optee: handle share buffer
 translation error
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: "tee-dev@lists.linaro.org" <tee-dev@lists.linaro.org>,
 Stefano Stabellini <sstabellini@kernel.org>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SGkgVm9sb2R5bXlyLAoKT24gOC8yMy8xOSA3OjQ4IFBNLCBWb2xvZHlteXIgQmFiY2h1ayB3cm90
ZToKPiBUaGVyZSBpcyBhIGNhc2UgcG9zc2libGUsIHdoZW4gT1AtVEVFIGFza3MgZ3Vlc3QgdG8g
YWxsb2NhdGUgc2hhcmVkCj4gYnVmZmVyLCBidXQgWGVuIGZvciBzb21lIHJlYXNvbiBjYW4ndCB0
cmFuc2xhdGUgYnVmZmVyJ3MgYWRkcmVzc2VzLiBJbgo+IHRoaXMgc2l0dWF0aW9uIHdlIHNob3Vs
ZCBkbyB0d28gdGhpbmdzOgo+IAo+IDEuIFRlbGwgZ3Vlc3QgdG8gZnJlZSBhbGxvY2F0ZWQgYnVm
ZmVyLCBzbyB0aGVyZSB3aWxsIGJlIG5vIG1lbW9yeQo+IGxlYWsgZm9yIGd1ZXN0Lgo+IAo+IDIu
IFRlbGwgT1AtVEVFIHRoYXQgYnVmZmVyIGFsbG9jYXRpb24gZmFpbGVkLgo+IAo+IFRvIGFzayBn
dWVzdCB0byBmcmVlIGFsbG9jYXRlZCBidWZmZXIgd2Ugc2hvdWxkIHBlcmZvcm0gdGhlIHNhbWUK
PiB0aGluZywgYXMgT1AtVEVFIGRvZXMgLSBpc3N1ZSBSUEMgcmVxdWVzdC4gVGhpcyBpcyBkb25l
IGJ5IGZpbGxpbmcKPiByZXF1ZXN0IGJ1ZmZlciAobHVja2lseSB3ZSBjYW4gcmV1c2UgdGhlIHNh
bWUgYnVmZmVyLCB0aGF0IE9QLVRFRSB1c2VkCj4gdG8gaXNzdWUgb3JpZ2luYWwgcmVxdWVzdCkg
YW5kIHRoZW4gcmV0dXJuIHRvIGd1ZXN0IHdpdGggc3BlY2lhbAo+IHJldHVybiBjb2RlLgo+IAo+
IFRoZW4gd2UgbmVlZCB0byBoYW5kbGUgbmV4dCBjYWxsIGZyb20gZ3Vlc3QgaW4gYSBzcGVjaWFs
IHdheTogYXMgUlBDCj4gd2FzIGlzc3VlZCBieSBYZW4sIG5vdCBieSBPUC1URUUsIGl0IHNob3Vs
ZCBiZSBoYW5kbGVkIGJ5IFhlbi4KPiBCYXNpY2FsbHksIHRoaXMgaXMgdGhlIG1lY2hhbmlzbSB0
byBwcmVlbXB0IE9QLVRFRSBtZWRpYXRvci4KPiAKPiBUaGUgc2FtZSBtZWNoYW5pc20gY2FuIGJl
IHVzZWQgaW4gdGhlIGZ1dHVyZSB0byBwcmVlbXB0IG1lZGlhdG9yCj4gZHVyaW5nIHRyYW5zbGF0
aW9uIGxhcmdlICg+NTEyIHBhZ2VzKSBzaGFyZWQgYnVmZmVycy4KPiAKPiBTaWduZWQtb2ZmLWJ5
OiBWb2xvZHlteXIgQmFiY2h1ayA8dm9sb2R5bXlyX2JhYmNodWtAZXBhbS5jb20+Cj4gLS0tCj4g
ICB4ZW4vYXJjaC9hcm0vdGVlL29wdGVlLmMgfCAxNjcgKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKy0tLS0tLS0tCj4gICAxIGZpbGUgY2hhbmdlZCwgMTM2IGluc2VydGlvbnMoKyksIDMx
IGRlbGV0aW9ucygtKQo+IAo+IGRpZmYgLS1naXQgYS94ZW4vYXJjaC9hcm0vdGVlL29wdGVlLmMg
Yi94ZW4vYXJjaC9hcm0vdGVlL29wdGVlLmMKPiBpbmRleCAzY2U2ZTdmYTU1Li40ZWViYzYwYjYy
IDEwMDY0NAo+IC0tLSBhL3hlbi9hcmNoL2FybS90ZWUvb3B0ZWUuYwo+ICsrKyBiL3hlbi9hcmNo
L2FybS90ZWUvb3B0ZWUuYwo+IEBAIC05Niw2ICs5NiwxMSBAQAo+ICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgT1BURUVfU01DX1NFQ19DQVBfVU5SRUdJU1RFUkVEX1NITSB8IFwKPiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9QVEVFX1NNQ19TRUNfQ0FQX0RZTkFNSUNf
U0hNKQo+ICAgCj4gK2VudW0gb3B0ZWVfY2FsbF9zdGF0ZSB7Cj4gKyAgICBPUFRFRU1fQ0FMTF9O
T1JNQUwgPSAwLAoKZW51bSBhbHdheXMgc3RhcnQgY291bnRpbmcgYXQgMC4gQWxzbywgbG9va2lu
ZyBhdCB0aGUgY29kZSwgaXQgZG9lcyBub3QgCnNlZW0geW91IG5lZWQgdG8ga25vdyB0aGUgdmFs
dWUuIFJpZ2h0PwoKPiArICAgIE9QVEVFTV9DQUxMX1hFTl9SUEMsCgpJIGFtIGEgYml0IGNvbmZ1
c2VkLCB0aGUgZW51bSBpcyBjYWxsZWQgb3B0ZWVfY2FsbF9zdGF0ZSBidXQgYWxsIHRoZSAKZW51
bSBhcmUgcHJlZml4ZWQgd2l0aCBPUFRFRU1fQ0FMTF8uIFdoeSB0aGUgZGlzY3JlcGFuY3k/Cgo+
ICt9Owo+ICsKPiAgIHN0YXRpYyB1bnNpZ25lZCBpbnQgX19yZWFkX21vc3RseSBtYXhfb3B0ZWVf
dGhyZWFkczsKPiAgIAo+ICAgLyoKPiBAQCAtMTEyLDYgKzExNyw5IEBAIHN0cnVjdCBvcHRlZV9z
dGRfY2FsbCB7Cj4gICAgICAgcGFkZHJfdCBndWVzdF9hcmdfaXBhOwo+ICAgICAgIGludCBvcHRl
ZV90aHJlYWRfaWQ7Cj4gICAgICAgaW50IHJwY19vcDsKPiArICAgIC8qIFNhdmVkIGJ1ZmZlciB0
eXBlIGZvciB0aGUgbGFzdCBidWZmZXIgYWxsb2NhdGUgcmVxdWVzdCAqLwoKTG9va2luZyBhdCB0
aGUgY29kZSwgaXQgZmVlbHMgdG8gbWUgeW91IGFyZSBzYXZpbmcgdGhlIGJ1ZmZlciB0eXBlIGZv
ciAKdGhlIGN1cnJlbnQgY29tbWFuZCBhbmQgbm90IHRoZSBsYXN0LiBEaWQgSSBtaXNzIGFueXRo
aW5nPwoKPiArICAgIHVuc2lnbmVkIGludCBycGNfYnVmZmVyX3R5cGU7Cj4gKyAgICBlbnVtIG9w
dGVlX2NhbGxfc3RhdGUgc3RhdGU7Cj4gICAgICAgdWludDY0X3QgcnBjX2RhdGFfY29va2llOwo+
ICAgICAgIGJvb2wgaW5fZmxpZ2h0Owo+ICAgICAgIHJlZ2lzdGVyX3QgcnBjX3BhcmFtc1syXTsK
PiBAQCAtMjk5LDYgKzMwNyw3IEBAIHN0YXRpYyBzdHJ1Y3Qgb3B0ZWVfc3RkX2NhbGwgKmFsbG9j
YXRlX3N0ZF9jYWxsKHN0cnVjdCBvcHRlZV9kb21haW4gKmN0eCkKPiAgIAo+ICAgICAgIGNhbGwt
Pm9wdGVlX3RocmVhZF9pZCA9IC0xOwo+ICAgICAgIGNhbGwtPmluX2ZsaWdodCA9IHRydWU7Cj4g
KyAgICBjYWxsLT5zdGF0ZSA9IE9QVEVFTV9DQUxMX05PUk1BTDsKPiAgIAo+ICAgICAgIHNwaW5f
bG9jaygmY3R4LT5sb2NrKTsKPiAgICAgICBsaXN0X2FkZF90YWlsKCZjYWxsLT5saXN0LCAmY3R4
LT5jYWxsX2xpc3QpOwo+IEBAIC0xMDc1LDYgKzEwODQsMTAgQEAgc3RhdGljIGludCBoYW5kbGVf
cnBjX3JldHVybihzdHJ1Y3Qgb3B0ZWVfZG9tYWluICpjdHgsCj4gICAgICAgICAgICAgICByZXQg
PSAtRVJFU1RBUlQ7Cj4gICAgICAgICAgIH0KPiAgIAo+ICsgICAgICAgIC8qIFNhdmUgdGhlIGJ1
ZmZlciB0eXBlIGluIGNhc2Ugd2Ugd2lsbCB3YW50IHRvIGZyZWUgaXQgKi8KPiArICAgICAgICBp
ZiAoIHNobV9ycGMtPnhlbl9hcmctPmNtZCA9PSBPUFRFRV9SUENfQ01EX1NITV9BTExPQyApCj4g
KyAgICAgICAgICAgIGNhbGwtPnJwY19idWZmZXJfdHlwZSA9IHNobV9ycGMtPnhlbl9hcmctPnBh
cmFtc1swXS51LnZhbHVlLmE7Cj4gKwo+ICAgICAgICAgICB1bm1hcF9kb21haW5fcGFnZShzaG1f
cnBjLT54ZW5fYXJnKTsKPiAgICAgICB9Cj4gICAKPiBAQCAtMTIzOSwxOCArMTI1MiwxMDIgQEAg
ZXJyOgo+ICAgICAgIHJldHVybjsKPiAgIH0KPiAgIAo+ICsvKgo+ICsgKiBQcmVwYXJlIFJQQyBy
ZXF1ZXN0IHRvIGZyZWUgc2hhcmVkIGJ1ZmZlciBpbiB0aGUgc2FtZSB3YXksIGFzCj4gKyAqIE9Q
LVRFRSBkb2VzIHRoaXMuCj4gKyAqCj4gKyAqIFJldHVybiB2YWx1ZXM6Cj4gKyAqICB0cnVlICAt
IHN1Y2Nlc3NmdWxseSBwcmVwYXJlZCBSUEMgcmVxdWVzdAo+ICsgKiAgZmFsc2UgLSB0aGVyZSB3
YXMgYW4gZXJyb3IKPiArICovCj4gK3N0YXRpYyBib29sIGlzc3VlX3JwY19jbWRfZnJlZShzdHJ1
Y3Qgb3B0ZWVfZG9tYWluICpjdHgsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBz
dHJ1Y3QgY3B1X3VzZXJfcmVncyAqcmVncywKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHN0cnVjdCBvcHRlZV9zdGRfY2FsbCAqY2FsbCwKPiArICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHN0cnVjdCBzaG1fcnBjICpzaG1fcnBjLAo+ICsgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgdWludDY0X3QgY29va2llKQo+ICt7Cj4gKyAgICByZWdpc3Rlcl90IHIxLCBy
MjsKPiArCj4gKyAgICAvKiBJbiBjYXNlIGlmIGd1ZXN0IHdpbGwgZm9yZ2V0IHRvIHVwZGF0ZSBp
dCB3aXRoIG1lYW5pbmdmdWwgdmFsdWUgKi8KPiArICAgIHNobV9ycGMtPnhlbl9hcmctPnJldCA9
IFRFRUNfRVJST1JfR0VORVJJQzsKPiArICAgIHNobV9ycGMtPnhlbl9hcmctPmNtZCA9IE9QVEVF
X1JQQ19DTURfU0hNX0ZSRUU7Cj4gKyAgICBzaG1fcnBjLT54ZW5fYXJnLT5udW1fcGFyYW1zID0g
MTsKPiArICAgIHNobV9ycGMtPnhlbl9hcmctPnBhcmFtc1swXS5hdHRyID0gT1BURUVfTVNHX0FU
VFJfVFlQRV9WQUxVRV9JTlBVVDsKPiArICAgIHNobV9ycGMtPnhlbl9hcmctPnBhcmFtc1swXS51
LnZhbHVlLmEgPSBjYWxsLT5ycGNfYnVmZmVyX3R5cGU7Cj4gKyAgICBzaG1fcnBjLT54ZW5fYXJn
LT5wYXJhbXNbMF0udS52YWx1ZS5iID0gY29va2llOwo+ICsKPiArICAgIGlmICggYWNjZXNzX2d1
ZXN0X21lbW9yeV9ieV9pcGEoY3VycmVudC0+ZG9tYWluLAo+ICsgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBnZm5fdG9fZ2FkZHIoc2htX3JwYy0+Z2ZuKSwKPiArICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgc2htX3JwYy0+eGVuX2FyZywKPiArICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgT1BURUVfTVNHX0dFVF9BUkdfU0laRSgxKSwKPiAr
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ1ZSkgKQo+ICsgICAgewo+ICsg
ICAgICAgIC8qCj4gKyAgICAgICAgICogV2VsbCwgdGhpcyBpcyBxdWl0ZSBiYWQuIFdlIGhhdmUg
ZXJyb3IgaW4gZXJyb3IgcGF0aC4KPiArICAgICAgICAgKiBUaGlzIGNhbiBoYXBwZW4gb25seSBp
ZiBndWVzdCBiZWhhdmVzIGJhZGx5LCBzbyBhbGwKPiArICAgICAgICAgKiB3ZSBjYW4gZG8gaXMg
dG8gcmV0dXJuIGVycm9yIHRvIE9QLVRFRSBhbmQgbGVhdmUKPiArICAgICAgICAgKiBndWVzdCdz
IG1lbW9yeSBsZWFrZWQuCgpDb3VsZCB5b3UgZXhwYW5kIGEgYml0IG1vcmUgd2hhdCB5b3UgbWVh
biBieSAiZ3Vlc3QncyBtZW1vcnkgbGVha2VkIj8gCldoYXQgdGhlIHN0YXRlIG9mIHRoZSBwYWdl
IGZyb20gWGVuIFBvVj8gSS5lLiBpcyB0aGVyZSBhbnkgcmVmZXJlbmNlIAp0YWtlbiBieSB0aGUg
T1AtVEVFIG1lZGlhdG9yPyBXaWxsIHRoZSBwYWdlIGJlIGZyZWVkIG9uY2UgdGhlIGd1ZXN0IGlz
IApkZXN0cm95ZWQ/Li4uCgo+ICsgICAgICAgICAqLwo+ICsgICAgICAgIHNobV9ycGMtPnhlbl9h
cmctPnJldCA9IFRFRUNfRVJST1JfR0VORVJJQzsKPiArICAgICAgICBzaG1fcnBjLT54ZW5fYXJn
LT5udW1fcGFyYW1zID0gMDsKPiArCj4gKyAgICAgICAgcmV0dXJuIGZhbHNlOwo+ICsgICAgfQo+
ICsKPiArICAgIHVpbnQ2NF90b19yZWdwYWlyKCZyMSwgJnIyLCBzaG1fcnBjLT5jb29raWUpOwo+
ICsKPiArICAgIGNhbGwtPnN0YXRlID0gT1BURUVNX0NBTExfWEVOX1JQQzsKPiArICAgIGNhbGwt
PnJwY19vcCA9IE9QVEVFX1NNQ19SUENfRlVOQ19DTUQ7Cj4gKyAgICBjYWxsLT5ycGNfcGFyYW1z
WzBdID0gcjE7Cj4gKyAgICBjYWxsLT5ycGNfcGFyYW1zWzFdID0gcjI7Cj4gKyAgICBjYWxsLT5v
cHRlZV90aHJlYWRfaWQgPSBnZXRfdXNlcl9yZWcocmVncywgMyk7Cj4gKwo+ICsgICAgc2V0X3Vz
ZXJfcmVnKHJlZ3MsIDAsIE9QVEVFX1NNQ19SRVRVUk5fUlBDX0NNRCk7Cj4gKyAgICBzZXRfdXNl
cl9yZWcocmVncywgMSwgcjEpOwo+ICsgICAgc2V0X3VzZXJfcmVnKHJlZ3MsIDIsIHIyKTsKPiAr
Cj4gKyAgICByZXR1cm4gdHJ1ZTsKPiArfQo+ICsKPiArLyogSGFuZGxlcyByZXR1cm4gZnJvbSBY
ZW4taXNzdWVkIFJQQyAqLwo+ICtzdGF0aWMgdm9pZCBoYW5kbGVfeGVuX3JwY19yZXR1cm4oc3Ry
dWN0IG9wdGVlX2RvbWFpbiAqY3R4LAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgc3RydWN0IGNwdV91c2VyX3JlZ3MgKnJlZ3MsCj4gKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBzdHJ1Y3Qgb3B0ZWVfc3RkX2NhbGwgKmNhbGwsCj4gKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBzdHJ1Y3Qgc2htX3JwYyAqc2htX3JwYykKPiArewo+ICsgICAg
Y2FsbC0+c3RhdGUgPSBPUFRFRU1fQ0FMTF9OT1JNQUw7Cj4gKwo+ICsgICAgLyoKPiArICAgICAq
IFJpZ2h0IG5vdyB3ZSBoYXZlIG9ubHkgb25lIHJlYXNvbiB0byBiZSB0aGVyZSAtIHdlIGFza2Vk
IGd1ZXN0Cj4gKyAgICAgKiB0byBmcmVlIHNoYXJlZCBidWZmZXIgYW5kIGl0IGRpZCBpdC4gTm93
IHdlIGNhbiB0ZWxsIE9QLVRFRSB0aGF0Cj4gKyAgICAgKiBidWZmZXIgYWxsb2NhdGlvbiBmYWls
ZWQuCj4gKyAgICAgKi8KClNob3VsZCB3ZSBhZGQgYW4gQVNTRVJUIHRvIGVuc3VyZSB0aGUgY29t
bWFuZCBpcyB0aGUgb25lIHdlIGV4cGVjdD8KCj4gKwo+ICsgICAgLyoKPiArICAgICAqIFdlIGFy
ZSBub3QgY2hlY2tpbmcgcmV0dXJuIHZhbHVlIGZyb20gYSBndWVzdCBiZWNhdXNlIHdlIGFzc3Vt
ZQo+ICsgICAgICogdGhhdCBPUFRFRV9SUENfQ01EX1NITV9GUkVFIG5ld2VyIGZhaWxzLgoKcy9u
ZXdlci9uZXZlci8KCj4gKyAgICAgKi8KPiArCj4gKyAgICBzaG1fcnBjLT54ZW5fYXJnLT5yZXQg
PSBURUVDX0VSUk9SX0dFTkVSSUM7Cj4gKyAgICBzaG1fcnBjLT54ZW5fYXJnLT5udW1fcGFyYW1z
ID0gMDsKPiArfQo+ICsKPiAgIC8qCj4gICAgKiBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCB3aGVu
IGd1ZXN0IGlzIGZpbmlzaGVkIHByb2Nlc3NpbmcgUlBDCj4gICAgKiByZXF1ZXN0IGZyb20gT1At
VEVFIGFuZCB3aXNoZWQgdG8gcmVzdW1lIHRoZSBpbnRlcnJ1cHRlZCBzdGFuZGFyZAo+ICAgICog
Y2FsbC4KPiArICoKPiArICogUmV0dXJuIHZhbHVlczoKPiArICogIGZhbHNlIC0gdGhlcmUgd2Fz
IGFuIGVycm9yLCBkbyBub3QgY2FsbCBPUC1URUUKPiArICogIHRydWUgIC0gc3VjY2VzcywgcHJv
Y2VlZCBhcyBub3JtYWwKPiAgICAqLwo+IC1zdGF0aWMgdm9pZCBoYW5kbGVfcnBjX2NtZF9hbGxv
YyhzdHJ1Y3Qgb3B0ZWVfZG9tYWluICpjdHgsCj4gK3N0YXRpYyBib29sIGhhbmRsZV9ycGNfY21k
X2FsbG9jKHN0cnVjdCBvcHRlZV9kb21haW4gKmN0eCwKPiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHN0cnVjdCBjcHVfdXNlcl9yZWdzICpyZWdzLAo+ICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgc3RydWN0IG9wdGVlX3N0ZF9jYWxsICpjYWxsLAo+ICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHNobV9ycGMgKnNobV9ycGMpCj4g
ICB7Cj4gICAgICAgaWYgKCBzaG1fcnBjLT54ZW5fYXJnLT5yZXQgfHwgc2htX3JwYy0+eGVuX2Fy
Zy0+bnVtX3BhcmFtcyAhPSAxICkKPiAtICAgICAgICByZXR1cm47Cj4gKyAgICAgICAgcmV0dXJu
IHRydWU7Cj4gICAKPiAgICAgICBpZiAoIHNobV9ycGMtPnhlbl9hcmctPnBhcmFtc1swXS5hdHRy
ICE9IChPUFRFRV9NU0dfQVRUUl9UWVBFX1RNRU1fT1VUUFVUIHwKPiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPUFRFRV9NU0dfQVRUUl9OT05DT05USUcp
ICkKPiBAQCAtMTI1OCw3ICsxMzU1LDcgQEAgc3RhdGljIHZvaWQgaGFuZGxlX3JwY19jbWRfYWxs
b2Moc3RydWN0IG9wdGVlX2RvbWFpbiAqY3R4LAo+ICAgICAgICAgICBnZHByaW50ayhYRU5MT0df
V0FSTklORywKPiAgICAgICAgICAgICAgICAgICAgIkludmFsaWQgYXR0cnMgZm9yIHNoYXJlZCBt
ZW0gYnVmZmVyOiAlIlBSSXg2NCJcbiIsCj4gICAgICAgICAgICAgICAgICAgIHNobV9ycGMtPnhl
bl9hcmctPnBhcmFtc1swXS5hdHRyKTsKPiAtICAgICAgICByZXR1cm47Cj4gKyAgICAgICAgcmV0
dXJuIHRydWU7Cj4gICAgICAgfQo+ICAgCj4gICAgICAgLyogRnJlZSBwZyBsaXN0IGZvciBidWZm
ZXIgKi8KPiBAQCAtMTI3NCwyMSArMTM3MSwxNCBAQCBzdGF0aWMgdm9pZCBoYW5kbGVfcnBjX2Nt
ZF9hbGxvYyhzdHJ1Y3Qgb3B0ZWVfZG9tYWluICpjdHgsCj4gICAgICAgewo+ICAgICAgICAgICBj
YWxsLT5ycGNfZGF0YV9jb29raWUgPSAwOwo+ICAgICAgICAgICAvKgo+IC0gICAgICAgICAqIE9r
YXksIHNvIHRoZXJlIHdhcyBwcm9ibGVtIHdpdGggZ3Vlc3QncyBidWZmZXIgYW5kIHdlIG5lZWQK
PiAtICAgICAgICAgKiB0byB0ZWxsIGFib3V0IHRoaXMgdG8gT1AtVEVFLgo+IC0gICAgICAgICAq
Lwo+IC0gICAgICAgIHNobV9ycGMtPnhlbl9hcmctPnJldCA9IFRFRUNfRVJST1JfR0VORVJJQzsK
PiAtICAgICAgICBzaG1fcnBjLT54ZW5fYXJnLT5udW1fcGFyYW1zID0gMDsKPiAtICAgICAgICAv
Kgo+IC0gICAgICAgICAqIFRPRE86IFdpdGggY3VycmVudCBpbXBsZW1lbnRhdGlvbiwgT1AtVEVF
IHdpbGwgbm90IGlzc3VlCj4gLSAgICAgICAgICogUlBDIHRvIGZyZWUgdGhpcyBidWZmZXIuIEd1
ZXN0IGFuZCBPUC1URUUgd2lsbCBiZSBvdXQgb2YKPiAtICAgICAgICAgKiBzeW5jOiBndWVzdCBi
ZWxpZXZlcyB0aGF0IGl0IHByb3ZpZGVkIGJ1ZmZlciB0byBPUC1URUUsCj4gLSAgICAgICAgICog
d2hpbGUgT1AtVEVFIHRoaW5rcyBvZiBvcHBvc2l0ZS4gSWRlYWxseSwgd2UgbmVlZCB0bwo+IC0g
ICAgICAgICAqIGVtdWxhdGUgUlBDIHdpdGggT1BURUVfTVNHX1JQQ19DTURfU0hNX0ZSRUUgY29t
bWFuZC4KPiArICAgICAgICAgKiBXZSBhcmUgdW5hYmxlIHRvIHRyYW5zbGF0ZSBndWVzdCdzIGJ1
ZmZlciwgc28gd2UgbmVlZCB0ZWxsIGd1ZXN0Cj4gKyAgICAgICAgICogdG8gZnJlZSBpdCwgYmVm
b3JlIHJldHVybmluZyBlcnJvciB0byBPUC1URUUuCgpEbyB5b3UgbWVhbiAicmVwb3J0aW5nIiBp
bnN0ZWFkIG9mICJyZXR1cm5pbmciPwpBbHNvIHMvZXJyb3IvYW4gZXJyb3IvCgo+ICAgICAgICAg
ICAgKi8KPiAtICAgICAgICBncHJpbnRrKFhFTkxPR19XQVJOSU5HLAo+IC0gICAgICAgICAgICAg
ICAgInRyYW5zbGF0ZV9ub25jb250aWcoKSBmYWlsZWQsIE9QLVRFRS9ndWVzdCBzdGF0ZSBpcyBv
dXQgb2Ygc3luYy5cbiIpOwo+ICsgICAgICAgIHJldHVybiAhaXNzdWVfcnBjX2NtZF9mcmVlKGN0
eCwgcmVncywgY2FsbCwgc2htX3JwYywKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBzaG1fcnBjLT54ZW5fYXJnLT5wYXJhbXNbMF0udS50bWVtLnNobV9yZWYpOwo+ICAgICAg
IH0KPiArCj4gKyAgICByZXR1cm4gdHJ1ZTsKPiAgIH0KPiAgIAo+ICAgc3RhdGljIHZvaWQgaGFu
ZGxlX3JwY19jbWQoc3RydWN0IG9wdGVlX2RvbWFpbiAqY3R4LCBzdHJ1Y3QgY3B1X3VzZXJfcmVn
cyAqcmVncywKPiBAQCAtMTMzOCwyMiArMTQyOCwzNyBAQCBzdGF0aWMgdm9pZCBoYW5kbGVfcnBj
X2NtZChzdHJ1Y3Qgb3B0ZWVfZG9tYWluICpjdHgsIHN0cnVjdCBjcHVfdXNlcl9yZWdzICpyZWdz
LAo+ICAgICAgICAgICBnb3RvIG91dDsKPiAgICAgICB9Cj4gICAKPiAtICAgIHN3aXRjaCAoc2ht
X3JwYy0+eGVuX2FyZy0+Y21kKQo+ICsgICAgaWYgKCBjYWxsLT5zdGF0ZSA9PSBPUFRFRU1fQ0FM
TF9OT1JNQUwgKQo+ICAgICAgIHsKPiAtICAgIGNhc2UgT1BURUVfUlBDX0NNRF9HRVRfVElNRToK
PiAtICAgIGNhc2UgT1BURUVfUlBDX0NNRF9XQUlUX1FVRVVFOgo+IC0gICAgY2FzZSBPUFRFRV9S
UENfQ01EX1NVU1BFTkQ6Cj4gLSAgICAgICAgYnJlYWs7Cj4gLSAgICBjYXNlIE9QVEVFX1JQQ19D
TURfU0hNX0FMTE9DOgo+IC0gICAgICAgIGhhbmRsZV9ycGNfY21kX2FsbG9jKGN0eCwgcmVncywg
Y2FsbCwgc2htX3JwYyk7Cj4gLSAgICAgICAgYnJlYWs7Cj4gLSAgICBjYXNlIE9QVEVFX1JQQ19D
TURfU0hNX0ZSRUU6Cj4gLSAgICAgICAgZnJlZV9vcHRlZV9zaG1fYnVmKGN0eCwgc2htX3JwYy0+
eGVuX2FyZy0+cGFyYW1zWzBdLnUudmFsdWUuYik7Cj4gLSAgICAgICAgaWYgKCBjYWxsLT5ycGNf
ZGF0YV9jb29raWUgPT0gc2htX3JwYy0+eGVuX2FyZy0+cGFyYW1zWzBdLnUudmFsdWUuYiApCj4g
LSAgICAgICAgICAgIGNhbGwtPnJwY19kYXRhX2Nvb2tpZSA9IDA7Cj4gLSAgICAgICAgYnJlYWs7
Cj4gLSAgICBkZWZhdWx0Ogo+IC0gICAgICAgIGJyZWFrOwo+ICsgICAgICAgIHN3aXRjaCAoc2ht
X3JwYy0+eGVuX2FyZy0+Y21kKQo+ICsgICAgICAgIHsKPiArICAgICAgICBjYXNlIE9QVEVFX1JQ
Q19DTURfR0VUX1RJTUU6Cj4gKyAgICAgICAgY2FzZSBPUFRFRV9SUENfQ01EX1dBSVRfUVVFVUU6
Cj4gKyAgICAgICAgY2FzZSBPUFRFRV9SUENfQ01EX1NVU1BFTkQ6Cj4gKyAgICAgICAgICAgIGJy
ZWFrOwo+ICsgICAgICAgIGNhc2UgT1BURUVfUlBDX0NNRF9TSE1fQUxMT0M6Cj4gKyAgICAgICAg
ICAgIGlmICggIWhhbmRsZV9ycGNfY21kX2FsbG9jKGN0eCwgcmVncywgY2FsbCwgc2htX3JwYykg
KQo+ICsgICAgICAgICAgICB7Cj4gKyAgICAgICAgICAgICAgICAvKiBXZSBmYWlsZWQgdG8gdHJh
bnNsYXRlIGJ1ZmZlciwgcmVwb3J0IGJhY2sgdG8gZ3Vlc3QgKi8KPiArICAgICAgICAgICAgICAg
IHVubWFwX2RvbWFpbl9wYWdlKHNobV9ycGMtPnhlbl9hcmcpOwo+ICsgICAgICAgICAgICAgICAg
cHV0X3N0ZF9jYWxsKGN0eCwgY2FsbCk7Cj4gKwo+ICsgICAgICAgICAgICAgICAgcmV0dXJuOwo+
ICsgICAgICAgICAgICB9Cj4gKyAgICAgICAgICAgIGJyZWFrOwo+ICsgICAgICAgIGNhc2UgT1BU
RUVfUlBDX0NNRF9TSE1fRlJFRToKPiArICAgICAgICAgICAgZnJlZV9vcHRlZV9zaG1fYnVmKGN0
eCwgc2htX3JwYy0+eGVuX2FyZy0+cGFyYW1zWzBdLnUudmFsdWUuYik7Cj4gKyAgICAgICAgICAg
IGlmICggY2FsbC0+cnBjX2RhdGFfY29va2llID09Cj4gKyAgICAgICAgICAgICAgICAgc2htX3Jw
Yy0+eGVuX2FyZy0+cGFyYW1zWzBdLnUudmFsdWUuYiApCj4gKyAgICAgICAgICAgICAgICBjYWxs
LT5ycGNfZGF0YV9jb29raWUgPSAwOwo+ICsgICAgICAgICAgICBicmVhazsKPiArICAgICAgICBk
ZWZhdWx0Ogo+ICsgICAgICAgICAgICBicmVhazsKPiArICAgICAgICB9Cj4gKyAgICB9Cj4gKyAg
ICBlbHNlCj4gKyAgICB7Cj4gKyAgICAgICAgaGFuZGxlX3hlbl9ycGNfcmV0dXJuKGN0eCwgcmVn
cywgY2FsbCwgc2htX3JwYyk7Cj4gICAgICAgfQo+ICAgCj4gICBvdXQ6Cj4gCgpDaGVlcnMsCgot
LSAKSnVsaWVuIEdyYWxsCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0
Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRl
dmVs

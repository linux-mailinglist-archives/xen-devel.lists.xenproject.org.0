Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id CAFDFFD43D
	for <lists+xen-devel@lfdr.de>; Fri, 15 Nov 2019 06:25:54 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iVU5P-0007el-8L; Fri, 15 Nov 2019 05:23:59 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=xcrH=ZH=intel.com=kevin.tian@srs-us1.protection.inumbo.net>)
 id 1iVU5N-0007eg-W8
 for xen-devel@lists.xenproject.org; Fri, 15 Nov 2019 05:23:58 +0000
X-Inumbo-ID: 1daf2d28-0768-11ea-9631-bc764e2007e4
Received: from mga04.intel.com (unknown [192.55.52.120])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 1daf2d28-0768-11ea-9631-bc764e2007e4;
 Fri, 15 Nov 2019 05:23:55 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga002.fm.intel.com ([10.253.24.26])
 by fmsmga104.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 14 Nov 2019 21:23:53 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.68,307,1569308400"; d="scan'208";a="235952337"
Received: from fmsmsx103.amr.corp.intel.com ([10.18.124.201])
 by fmsmga002.fm.intel.com with ESMTP; 14 Nov 2019 21:23:53 -0800
Received: from shsmsx106.ccr.corp.intel.com (10.239.4.159) by
 FMSMSX103.amr.corp.intel.com (10.18.124.201) with Microsoft SMTP Server (TLS)
 id 14.3.439.0; Thu, 14 Nov 2019 21:23:53 -0800
Received: from shsmsx104.ccr.corp.intel.com ([169.254.5.127]) by
 SHSMSX106.ccr.corp.intel.com ([169.254.10.248]) with mapi id 14.03.0439.000;
 Fri, 15 Nov 2019 13:23:52 +0800
From: "Tian, Kevin" <kevin.tian@intel.com>
To: Roger Pau Monne <roger.pau@citrix.com>, "xen-devel@lists.xenproject.org"
 <xen-devel@lists.xenproject.org>
Thread-Topic: [PATCH for-4.13 v3] x86/passthrough: fix migration of MSI when
 using posted interrupts
Thread-Index: AQHVljlCb+r9ByyHdU21dlLz5Vo5WaeLvHZA
Date: Fri, 15 Nov 2019 05:23:51 +0000
Message-ID: <AADFC41AFE54684AB9EE6CBC0274A5D19D5F6ADA@SHSMSX104.ccr.corp.intel.com>
References: <20191108133414.96381-1-roger.pau@citrix.com>
In-Reply-To: <20191108133414.96381-1-roger.pau@citrix.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-ctpclassification: CTP_NT
x-titus-metadata-40: eyJDYXRlZ29yeUxhYmVscyI6IiIsIk1ldGFkYXRhIjp7Im5zIjoiaHR0cDpcL1wvd3d3LnRpdHVzLmNvbVwvbnNcL0ludGVsMyIsImlkIjoiMTI4MGJjOTktODVjYS00NWYzLWE3YTItMWJmODMxNjc0ZWRjIiwicHJvcHMiOlt7Im4iOiJDVFBDbGFzc2lmaWNhdGlvbiIsInZhbHMiOlt7InZhbHVlIjoiQ1RQX05UIn1dfV19LCJTdWJqZWN0TGFiZWxzIjpbXSwiVE1DVmVyc2lvbiI6IjE3LjEwLjE4MDQuNDkiLCJUcnVzdGVkTGFiZWxIYXNoIjoiY2tXU1FPNWY2bngzc3dpODZ5SzJkUVwvamJIQ0pcL2pHQTNSbXVrbk1Bd0JVc3I0elBaRmlaaFcwVlBPSGhLd0VPIn0=
dlp-product: dlpe-windows
dlp-version: 11.0.400.15
dlp-reaction: no-action
x-originating-ip: [10.239.127.40]
MIME-Version: 1.0
Subject: Re: [Xen-devel] [PATCH for-4.13 v3] x86/passthrough: fix migration
 of MSI when using posted interrupts
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Andrew Cooper <andrew.cooper3@citrix.com>,
 Joe Jin <joe.jin@oracle.com>, Wei Liu <wl@xen.org>,
 Jan Beulich <jbeulich@suse.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

PiBGcm9tOiBSb2dlciBQYXUgTW9ubmUgW21haWx0bzpyb2dlci5wYXVAY2l0cml4LmNvbV0NCj4g
U2VudDogRnJpZGF5LCBOb3ZlbWJlciA4LCAyMDE5IDk6MzQgUE0NCj4gDQo+IFdoZW4gdXNpbmcg
cG9zdGVkIGludGVycnVwdHMgYW5kIHRoZSBndWVzdCBtaWdyYXRlcyBNU0kgZnJvbSB2Q1BVcyBY
ZW4NCj4gbmVlZHMgdG8gZmx1c2ggYW55IHBlbmRpbmcgUElSUiB2ZWN0b3JzIG9uIHRoZSBwcmV2
aW91cyB2Q1BVLCBvciBlbHNlDQo+IHRob3NlIHZlY3RvcnMgY291bGQgZ2V0IHdyb25nbHkgaW5q
ZWN0ZWQgYXQgYSBsYXRlciBwb2ludCB3aGVuIHRoZSBNU0kNCj4gZmllbGRzIGFyZSBhbHJlYWR5
IHVwZGF0ZWQuDQoNCkkgbWF5IG92ZXJsb29rIGJ1dCBpc24ndCBpdCB0aGUgZ3Vlc3QncyByZXNw
b25zaWJpbGl0eSBvZiBoYW5kbGluZyBzdWNoDQpjYXNlPyBFdmVuIG9uIGJhcmUgbWV0YWwsIGFu
IGluLWZseSBpbnRlcnJ1cHQgbWF5IGJlIGRlbGl2ZXJlZCB0bw0Kd3JvbmcgQ1BVIHdoZW4gTVNJ
IGlzIGJlaW5nIG1pZ3JhdGVkPw0KDQo+IA0KPiBSZW5hbWUgc3luY19waXJfdG9faXJyIHRvIHZs
YXBpY19zeW5jX3Bpcl90b19pcnIgYW5kIGV4cG9ydCBpdCBzbyBpdA0KPiBjYW4gYmUgY2FsbGVk
IHdoZW4gdXBkYXRpbmcgdGhlIGJpbmRpbmcgb2YgcGh5c2ljYWwgaW50ZXJydXB0cyB0bw0KPiBn
dWVzdHMuDQo+IA0KPiBOb3RlIHRoYXQgUElSUiBpcyBzeW5jZWQgdG8gSVJSIGJvdGggaW4gcHRf
aXJxX2Rlc3Ryb3lfYmluZCBhbmQNCj4gcHRfaXJxX2NyZWF0ZV9iaW5kIHdoZW4gdGhlIGludGVy
cnVwdCBkZWxpdmVyeSBkYXRhIGlzIGJlaW5nIHVwZGF0ZWQuDQo+IA0KPiBBbHNvIHN0b3JlIHRo
ZSB2Q1BVIElEIGluIG11bHRpLWRlc3RpbmF0aW9uIG1vZGUgd2hlbiB1c2luZyBwb3N0ZWQNCj4g
aW50ZXJydXB0cyBzbyB0aGF0IHRoZSBpbnRlcnJ1cHQgaXMgYWx3YXlzIGluamVjdGVkIHRvIGEg
a25vd24gdkNQVSBpbg0KPiBvcmRlciB0byBiZSBhYmxlIHRvIGZsdXNoIHRoZSBQSVJSIHdoZW4g
bW9kaWZ5aW5nIHRoZSBiaW5kaW5nLg0KPiANCj4gUmVwb3J0ZWQtYnk6IEpvZSBKaW4gPGpvZS5q
aW5Ab3JhY2xlLmNvbT4NCj4gU2lnbmVkLW9mZi1ieTogUm9nZXIgUGF1IE1vbm7DqSA8cm9nZXIu
cGF1QGNpdHJpeC5jb20+DQo+IC0tLQ0KPiBDYzogSm9lIEppbiA8am9lLmppbkBvcmFjbGUuY29t
Pg0KPiBDYzogSnVlcmdlbiBHcm9zcyA8amdyb3NzQHN1c2UuY29tPg0KPiAtLS0NCj4gSSB3b3Vs
ZCBsaWtlIHRvIHNlZSBhIGJ1ZyBmaXggZm9yIHRoaXMgaXNzdWUgaW4gNC4xMy4gVGhlIGZpeCBo
ZXJlIG9ubHkNCj4gYWZmZWN0cyBwb3N0ZWQgaW50ZXJydXB0cywgaGVuY2UgSSB0aGluayB0aGUg
cmlzayBvZiBicmVha2luZyBhbnl0aGluZw0KPiBlbHNlIGlzIGxvdy4NCj4gLS0tDQo+IENoYW5n
ZXMgc2luY2UgdjI6DQo+ICAtIEFsc28gc3luYyBQSVJSIHdpdGggSVJSIHdoZW4gdXNpbmcgQ1BV
IHBvc3RlZCBpbnRlcnJ1cHRzLg0KPiAgLSBGb3JjZSB0aGUgc2VsZWN0aW9uIG9mIGEgc3BlY2lm
aWMgdkNQVSB3aGVuIHVzaW5nIHBvc3RlZCBpbnRlcnJ1cHRzDQo+ICAgIGZvciBtdWx0aS1kZXN0
Lg0KPiAgLSBDaGFuZ2Ugdm1zaV9kZWxpdmVyX3BpcnEgdG8gaG9ub3IgZGVzdF92Y3B1X2lkLg0K
PiANCj4gQ2hhbmdlcyBzaW5jZSB2MToNCj4gIC0gU3RvcmUgdGhlIHZjcHUgaWQgYWxzbyBpbiBt
dWx0aS1kZXN0IG1vZGUgaWYgdGhlIGludGVycnVwdCBpcyBib3VuZA0KPiAgICB0byBhIHZjcHUg
Zm9yIHBvc3RlZCBkZWxpdmVyeS4NCj4gIC0gcy8jaWYvI2lmZGVmLy4NCj4gLS0tDQo+ICB4ZW4v
YXJjaC94ODYvaHZtL3ZsYXBpYy5jICAgICAgICB8ICA2ICsrKy0tLQ0KPiAgeGVuL2FyY2gveDg2
L2h2bS92bXNpLmMgICAgICAgICAgfCAxMSArKysrKysrKysrLQ0KPiAgeGVuL2RyaXZlcnMvcGFz
c3Rocm91Z2gvaW8uYyAgICAgfCAyOSArKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLQ0KPiAg
eGVuL2luY2x1ZGUvYXNtLXg4Ni9odm0vdmxhcGljLmggfCAgMiArKw0KPiAgNCBmaWxlcyBjaGFu
Z2VkLCAzOCBpbnNlcnRpb25zKCspLCAxMCBkZWxldGlvbnMoLSkNCj4gDQo+IGRpZmYgLS1naXQg
YS94ZW4vYXJjaC94ODYvaHZtL3ZsYXBpYy5jIGIveGVuL2FyY2gveDg2L2h2bS92bGFwaWMuYw0K
PiBpbmRleCA5NDY2MjU4ZDZmLi5kMjU1YWQ4ZGI3IDEwMDY0NA0KPiAtLS0gYS94ZW4vYXJjaC94
ODYvaHZtL3ZsYXBpYy5jDQo+ICsrKyBiL3hlbi9hcmNoL3g4Ni9odm0vdmxhcGljLmMNCj4gQEAg
LTEwNiw3ICsxMDYsNyBAQCBzdGF0aWMgdm9pZCB2bGFwaWNfY2xlYXJfaXJyKGludCB2ZWN0b3Is
IHN0cnVjdCB2bGFwaWMNCj4gKnZsYXBpYykNCj4gICAgICB2bGFwaWNfY2xlYXJfdmVjdG9yKHZl
Y3RvciwgJnZsYXBpYy0+cmVncy0+ZGF0YVtBUElDX0lSUl0pOw0KPiAgfQ0KPiANCj4gLXN0YXRp
YyB2b2lkIHN5bmNfcGlyX3RvX2lycihzdHJ1Y3QgdmNwdSAqdikNCj4gK3ZvaWQgdmxhcGljX3N5
bmNfcGlyX3RvX2lycihzdHJ1Y3QgdmNwdSAqdikNCj4gIHsNCj4gICAgICBpZiAoIGh2bV9mdW5j
cy5zeW5jX3Bpcl90b19pcnIgKQ0KPiAgICAgICAgICBhbHRlcm5hdGl2ZV92Y2FsbChodm1fZnVu
Y3Muc3luY19waXJfdG9faXJyLCB2KTsNCj4gQEAgLTExNCw3ICsxMTQsNyBAQCBzdGF0aWMgdm9p
ZCBzeW5jX3Bpcl90b19pcnIoc3RydWN0IHZjcHUgKnYpDQo+IA0KPiAgc3RhdGljIGludCB2bGFw
aWNfZmluZF9oaWdoZXN0X2lycihzdHJ1Y3QgdmxhcGljICp2bGFwaWMpDQo+ICB7DQo+IC0gICAg
c3luY19waXJfdG9faXJyKHZsYXBpY192Y3B1KHZsYXBpYykpOw0KPiArICAgIHZsYXBpY19zeW5j
X3Bpcl90b19pcnIodmxhcGljX3ZjcHUodmxhcGljKSk7DQo+IA0KPiAgICAgIHJldHVybiB2bGFw
aWNfZmluZF9oaWdoZXN0X3ZlY3RvcigmdmxhcGljLT5yZWdzLT5kYXRhW0FQSUNfSVJSXSk7DQo+
ICB9DQo+IEBAIC0xNDkzLDcgKzE0OTMsNyBAQCBzdGF0aWMgaW50IGxhcGljX3NhdmVfcmVncyhz
dHJ1Y3QgdmNwdSAqdiwNCj4gaHZtX2RvbWFpbl9jb250ZXh0X3QgKmgpDQo+ICAgICAgaWYgKCAh
aGFzX3ZsYXBpYyh2LT5kb21haW4pICkNCj4gICAgICAgICAgcmV0dXJuIDA7DQo+IA0KPiAtICAg
IHN5bmNfcGlyX3RvX2lycih2KTsNCj4gKyAgICB2bGFwaWNfc3luY19waXJfdG9faXJyKHYpOw0K
PiANCj4gICAgICByZXR1cm4gaHZtX3NhdmVfZW50cnkoTEFQSUNfUkVHUywgdi0+dmNwdV9pZCwg
aCwgdmNwdV92bGFwaWModiktDQo+ID5yZWdzKTsNCj4gIH0NCj4gZGlmZiAtLWdpdCBhL3hlbi9h
cmNoL3g4Ni9odm0vdm1zaS5jIGIveGVuL2FyY2gveDg2L2h2bS92bXNpLmMNCj4gaW5kZXggNjU5
N2Q5ZjcxOS4uZmU0ODhjY2M3ZCAxMDA2NDQNCj4gLS0tIGEveGVuL2FyY2gveDg2L2h2bS92bXNp
LmMNCj4gKysrIGIveGVuL2FyY2gveDg2L2h2bS92bXNpLmMNCj4gQEAgLTExOCw3ICsxMTgsMTYg
QEAgdm9pZCB2bXNpX2RlbGl2ZXJfcGlycShzdHJ1Y3QgZG9tYWluICpkLCBjb25zdA0KPiBzdHJ1
Y3QgaHZtX3BpcnFfZHBjaSAqcGlycV9kcGNpKQ0KPiANCj4gICAgICBBU1NFUlQocGlycV9kcGNp
LT5mbGFncyAmIEhWTV9JUlFfRFBDSV9HVUVTVF9NU0kpOw0KPiANCj4gLSAgICB2bXNpX2RlbGl2
ZXIoZCwgdmVjdG9yLCBkZXN0LCBkZXN0X21vZGUsIGRlbGl2ZXJ5X21vZGUsIHRyaWdfbW9kZSk7
DQo+ICsgICAgaWYgKCBodm1fZnVuY3MuZGVsaXZlcl9wb3N0ZWRfaW50ciAmJiBwaXJxX2RwY2kt
Pmdtc2kuZGVzdF92Y3B1X2lkICE9DQo+IC0xICkNCj4gKyAgICAgICAgLyoNCj4gKyAgICAgICAg
ICogV2hlbiB1c2luZyBwb3N0ZWQgaW50ZXJydXB0cyBtdWx0aS1kZXN0aW5hdGlvbiBkZWxpdmVy
eSBtb2RlIGlzDQo+ICsgICAgICAgICAqIGZvcmNlZCB0byBzZWxlY3QgYSBzcGVjaWZpYyB2Q1BV
IHNvIHRoYXQgdGhlIFBJUlIgY2FuIGJlIHN5bmNlZCBpbnRvDQo+ICsgICAgICAgICAqIElSUiB3
aGVuIHRoZSBpbnRlcnJ1cHQgaXMgZGVzdHJveWVkIG9yIG1vdmVkLg0KPiArICAgICAgICAgKi8N
Cj4gKyAgICAgICAgdm1zaV9pbmpfaXJxKHZjcHVfdmxhcGljKGQtPnZjcHVbcGlycV9kcGNpLT5n
bXNpLmRlc3RfdmNwdV9pZF0pLA0KPiArICAgICAgICAgICAgICAgICAgICAgdmVjdG9yLCB0cmln
X21vZGUsIGRlbGl2ZXJ5X21vZGUpOw0KPiArICAgIGVsc2UNCj4gKyAgICAgICAgdm1zaV9kZWxp
dmVyKGQsIHZlY3RvciwgZGVzdCwgZGVzdF9tb2RlLCBkZWxpdmVyeV9tb2RlLCB0cmlnX21vZGUp
Ow0KPiAgfQ0KPiANCj4gIC8qIFJldHVybiB2YWx1ZSwgLTEgOiBtdWx0aS1kZXN0cywgbm9uLW5l
Z2F0aXZlIHZhbHVlOiBkZXN0X3ZjcHVfaWQgKi8NCj4gZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJz
L3Bhc3N0aHJvdWdoL2lvLmMgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9pby5jDQo+IGluZGV4
IGIyOTJlNzkzODIuLmQzZjFhZTVjMzkgMTAwNjQ0DQo+IC0tLSBhL3hlbi9kcml2ZXJzL3Bhc3N0
aHJvdWdoL2lvLmMNCj4gKysrIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvaW8uYw0KPiBAQCAt
MzQxLDcgKzM0MSw3IEBAIGludCBwdF9pcnFfY3JlYXRlX2JpbmQoDQo+ICAgICAgew0KPiAgICAg
ICAgICB1aW50OF90IGRlc3QsIGRlbGl2ZXJ5X21vZGU7DQo+ICAgICAgICAgIGJvb2wgZGVzdF9t
b2RlOw0KPiAtICAgICAgICBpbnQgZGVzdF92Y3B1X2lkOw0KPiArICAgICAgICBpbnQgZGVzdF92
Y3B1X2lkLCBwcmV2X3ZjcHVfaWQgPSAtMTsNCj4gICAgICAgICAgY29uc3Qgc3RydWN0IHZjcHUg
KnZjcHU7DQo+ICAgICAgICAgIHVpbnQzMl90IGdmbGFncyA9IHB0X2lycV9iaW5kLT51Lm1zaS5n
ZmxhZ3MgJg0KPiAgICAgICAgICAgICAgICAgICAgICAgICAgICB+WEVOX0RPTUNUTF9WTVNJX1g4
Nl9VTk1BU0tFRDsNCj4gQEAgLTQxMSw2ICs0MTEsNyBAQCBpbnQgcHRfaXJxX2NyZWF0ZV9iaW5k
KA0KPiANCj4gICAgICAgICAgICAgICAgICBwaXJxX2RwY2ktPmdtc2kuZ3ZlYyA9IHB0X2lycV9i
aW5kLT51Lm1zaS5ndmVjOw0KPiAgICAgICAgICAgICAgICAgIHBpcnFfZHBjaS0+Z21zaS5nZmxh
Z3MgPSBnZmxhZ3M7DQo+ICsgICAgICAgICAgICAgICAgcHJldl92Y3B1X2lkID0gcGlycV9kcGNp
LT5nbXNpLmRlc3RfdmNwdV9pZDsNCj4gICAgICAgICAgICAgIH0NCj4gICAgICAgICAgfQ0KPiAg
ICAgICAgICAvKiBDYWxjdWxhdGUgZGVzdF92Y3B1X2lkIGZvciBNU0ktdHlwZSBwaXJxIG1pZ3Jh
dGlvbi4gKi8NCj4gQEAgLTQyNiwxNCArNDI3LDI0IEBAIGludCBwdF9pcnFfY3JlYXRlX2JpbmQo
DQo+IA0KPiAgICAgICAgICBwaXJxX2RwY2ktPmdtc2kucG9zdGVkID0gZmFsc2U7DQo+ICAgICAg
ICAgIHZjcHUgPSAoZGVzdF92Y3B1X2lkID49IDApID8gZC0+dmNwdVtkZXN0X3ZjcHVfaWRdIDog
TlVMTDsNCj4gLSAgICAgICAgaWYgKCBpb21tdV9pbnRwb3N0ICkNCj4gKyAgICAgICAgaWYgKCBo
dm1fZnVuY3MuZGVsaXZlcl9wb3N0ZWRfaW50ciAmJiBkZWxpdmVyeV9tb2RlID09DQo+IGRlc3Rf
TG93ZXN0UHJpbyApDQo+ICAgICAgICAgIHsNCj4gLSAgICAgICAgICAgIGlmICggZGVsaXZlcnlf
bW9kZSA9PSBkZXN0X0xvd2VzdFByaW8gKQ0KPiAtICAgICAgICAgICAgICAgIHZjcHUgPSB2ZWN0
b3JfaGFzaGluZ19kZXN0KGQsIGRlc3QsIGRlc3RfbW9kZSwNCj4gLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBwaXJxX2RwY2ktPmdtc2kuZ3ZlYyk7DQo+ICsgICAg
ICAgICAgICAvKg0KPiArICAgICAgICAgICAgICogTkI6IHdoZW4gdXNpbmcgcG9zdGVkIGludGVy
cnVwdHMgdGhlIHZlY3RvciBpcyBzaWduYWxlZA0KPiArICAgICAgICAgICAgICogb24gdGhlIFBJ
UlIsIGFuZCBoZW5jZSBYZW4gbmVlZHMgdG8gZm9yY2UgaW50ZXJydXB0cyB0byBiZQ0KPiArICAg
ICAgICAgICAgICogZGVsaXZlcmVkIHRvIGEgc3BlY2lmaWMgdkNQVSBpbiBvcmRlciB0byBiZSBh
YmxlIHRvIHN5bmMgUElSUg0KPiArICAgICAgICAgICAgICogd2l0aCBJUlIgd2hlbiB0aGUgaW50
ZXJydXB0IGJpbmRpbmcgaXMgZGVzdHJveWVkLCBvciBlbHNlDQo+ICsgICAgICAgICAgICAgKiBw
ZW5kaW5nIGludGVycnVwdHMgaW4gdGhlIHByZXZpb3VzIHZDUFUgUElSUiBmaWVsZCBjb3VsZCBi
ZQ0KPiArICAgICAgICAgICAgICogZGVsaXZlcmVkIGFmdGVyIHRoZSB1cGRhdGUuDQo+ICsgICAg
ICAgICAgICAgKi8NCj4gKyAgICAgICAgICAgIHZjcHUgPSB2ZWN0b3JfaGFzaGluZ19kZXN0KGQs
IGRlc3QsIGRlc3RfbW9kZSwNCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHBpcnFfZHBjaS0+Z21zaS5ndmVjKTsNCj4gICAgICAgICAgICAgIGlmICggdmNwdSApDQo+
IC0gICAgICAgICAgICAgICAgcGlycV9kcGNpLT5nbXNpLnBvc3RlZCA9IHRydWU7DQo+ICsgICAg
ICAgICAgICAgICAgcGlycV9kcGNpLT5nbXNpLmRlc3RfdmNwdV9pZCA9IHZjcHUtPnZjcHVfaWQ7
DQo+ICAgICAgICAgIH0NCj4gKyAgICAgICAgaWYgKCBpb21tdV9pbnRwb3N0ICYmIHZjcHUgKQ0K
PiArICAgICAgICAgICAgcGlycV9kcGNpLT5nbXNpLnBvc3RlZCA9IHRydWU7DQo+ICsNCj4gICAg
ICAgICAgaWYgKCB2Y3B1ICYmIGlzX2lvbW11X2VuYWJsZWQoZCkgKQ0KPiAgICAgICAgICAgICAg
aHZtX21pZ3JhdGVfcGlycShwaXJxX2RwY2ksIHZjcHUpOw0KPiANCj4gQEAgLTQ0Miw2ICs0NTMs
OSBAQCBpbnQgcHRfaXJxX2NyZWF0ZV9iaW5kKA0KPiAgICAgICAgICAgICAgcGlfdXBkYXRlX2ly
dGUodmNwdSA/ICZ2Y3B1LT5hcmNoLmh2bS52bXgucGlfZGVzYyA6IE5VTEwsDQo+ICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBpbmZvLCBwaXJxX2RwY2ktPmdtc2kuZ3ZlYyk7DQo+IA0KPiAr
ICAgICAgICBpZiAoIGh2bV9mdW5jcy5kZWxpdmVyX3Bvc3RlZF9pbnRyICYmIHByZXZfdmNwdV9p
ZCA+PSAwICkNCj4gKyAgICAgICAgICAgIHZsYXBpY19zeW5jX3Bpcl90b19pcnIoZC0+dmNwdVtw
cmV2X3ZjcHVfaWRdKTsNCj4gKw0KPiAgICAgICAgICBpZiAoIHB0X2lycV9iaW5kLT51Lm1zaS5n
ZmxhZ3MgJiBYRU5fRE9NQ1RMX1ZNU0lfWDg2X1VOTUFTS0VEICkNCj4gICAgICAgICAgew0KPiAg
ICAgICAgICAgICAgdW5zaWduZWQgbG9uZyBmbGFnczsNCj4gQEAgLTczMSw2ICs3NDUsOSBAQCBp
bnQgcHRfaXJxX2Rlc3Ryb3lfYmluZCgNCj4gICAgICBlbHNlIGlmICggcGlycV9kcGNpICYmIHBp
cnFfZHBjaS0+Z21zaS5wb3N0ZWQgKQ0KPiAgICAgICAgICBwaV91cGRhdGVfaXJ0ZShOVUxMLCBw
aXJxLCAwKTsNCj4gDQo+ICsgICAgaWYgKCBodm1fZnVuY3MuZGVsaXZlcl9wb3N0ZWRfaW50ciAm
JiBwaXJxX2RwY2ktPmdtc2kuZGVzdF92Y3B1X2lkID49DQo+IDAgKQ0KPiArICAgICAgICB2bGFw
aWNfc3luY19waXJfdG9faXJyKGQtPnZjcHVbcGlycV9kcGNpLT5nbXNpLmRlc3RfdmNwdV9pZF0p
Ow0KPiArDQo+ICAgICAgaWYgKCBwaXJxX2RwY2kgJiYgKHBpcnFfZHBjaS0+ZmxhZ3MgJiBIVk1f
SVJRX0RQQ0lfTUFQUEVEKSAmJg0KPiAgICAgICAgICAgbGlzdF9lbXB0eSgmcGlycV9kcGNpLT5k
aWdsX2xpc3QpICkNCj4gICAgICB7DQo+IGRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS9hc20teDg2
L2h2bS92bGFwaWMuaCBiL3hlbi9pbmNsdWRlL2FzbS0NCj4geDg2L2h2bS92bGFwaWMuaA0KPiBp
bmRleCBkZGU2NmI0ZjBmLi5iMDAxN2QxZGFlIDEwMDY0NA0KPiAtLS0gYS94ZW4vaW5jbHVkZS9h
c20teDg2L2h2bS92bGFwaWMuaA0KPiArKysgYi94ZW4vaW5jbHVkZS9hc20teDg2L2h2bS92bGFw
aWMuaA0KPiBAQCAtMTUwLDQgKzE1MCw2IEBAIGJvb2xfdCB2bGFwaWNfbWF0Y2hfZGVzdCgNCj4g
ICAgICBjb25zdCBzdHJ1Y3QgdmxhcGljICp0YXJnZXQsIGNvbnN0IHN0cnVjdCB2bGFwaWMgKnNv
dXJjZSwNCj4gICAgICBpbnQgc2hvcnRfaGFuZCwgdWludDMyX3QgZGVzdCwgYm9vbF90IGRlc3Rf
bW9kZSk7DQo+IA0KPiArdm9pZCB2bGFwaWNfc3luY19waXJfdG9faXJyKHN0cnVjdCB2Y3B1ICp2
KTsNCj4gKw0KPiAgI2VuZGlmIC8qIF9fQVNNX1g4Nl9IVk1fVkxBUElDX0hfXyAqLw0KPiAtLQ0K
PiAyLjIzLjANCg0KX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcK
aHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 106B52C48F
	for <lists+xen-devel@lfdr.de>; Tue, 28 May 2019 12:38:37 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hVZRS-0007Ro-1D; Tue, 28 May 2019 10:34:50 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=31/0=T4=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1hVZQJ-00053Y-9l
 for xen-devel@lists.xenproject.org; Tue, 28 May 2019 10:33:39 +0000
X-Inumbo-ID: 0933a726-8134-11e9-bde3-5bca5c601ae0
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 0933a726-8134-11e9-bde3-5bca5c601ae0;
 Tue, 28 May 2019 10:33:30 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 2A93DB090;
 Tue, 28 May 2019 10:33:30 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Tue, 28 May 2019 12:33:06 +0200
Message-Id: <20190528103313.1343-54-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190528103313.1343-1-jgross@suse.com>
References: <20190528103313.1343-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH 53/60] xen/sched: remove cpu from pool0 before
 removing it
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>, Tim Deegan <tim@xen.org>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Dario Faggioli <dfaggioli@suse.com>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VG9kYXkgYSBjcHUgd2hpY2ggaXMgcmVtb3ZlZCBmcm9tIHRoZSBzeXN0ZW0gaXMgdGFrZW4gZGly
ZWN0bHkgZnJvbQpQb29sMCB0byB0aGUgb2ZmbGluZSBzdGF0ZS4gVGhpcyB3aWxsIGNvbmZsaWN0
IHdpdGggY29yZSBzY2hlZHVsaW5nLApzbyByZW1vdmUgaXQgZnJvbSBQb29sMCBmaXJzdC4gQWRk
aXRpb25hbGx5IGFjY2VwdCByZW1vdmluZyBhIGZyZWUgY3B1Cmluc3RlYWQgb2YgcmVxdWlyaW5n
IGl0IHRvIGJlIGluIFBvb2wwLgoKRm9yIHRoZSByZXN1bWUgZmFpbGVkIGNhc2Ugd2UgbmVlZCB0
byBjYWxsIHRoZSBzY2hlZHVsZXIgY29kZSBmb3IgdGhhdApzaXR1YXRpb24gYWZ0ZXIgdGhlIGNw
dXBvb2wgaGFuZGxpbmcsIHNvIG1vdmUgdGhlIHNjaGVkdWxlciBjb2RlIGludG8KYSBmdW5jdGlv
biBhbmQgY2FsbCBpdCBmcm9tIGNwdXBvb2xfY3B1X3JlbW92ZV9mb3JjZWQoKSBhbmQgcmVtb3Zl
IHRoZQpDUFVfUkVTVU1FX0ZBSUxFRCBjYXNlIGZyb20gY3B1X3NjaGVkdWxlX2NhbGxiYWNrKCku
CgpOb3RlIHRoYXQgd2UgYXJlIGNhbGxpbmcgbm93IHNjaGVkdWxlX2NwdV9zd2l0Y2goKSBpbiBz
dG9wX21hY2hpbmUKY29udGV4dCBzbyB3ZSBuZWVkIHRvIHN3aXRjaCBmcm9tIHNwaW5sb2NrX2ly
cSB0byBzcGlubG9ja19pcnFzYXZlLgoKU2lnbmVkLW9mZi1ieTogSnVlcmdlbiBHcm9zcyA8amdy
b3NzQHN1c2UuY29tPgotLS0KVjE6IG5ldyBwYXRjaAotLS0KIHhlbi9jb21tb24vY3B1cG9vbC5j
ICAgICAgIHwgMTc3ICsrKysrKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tLS0t
LQogeGVuL2NvbW1vbi9zY2hlZHVsZS5jICAgICAgfCAgMjkgKysrKystLS0KIHhlbi9pbmNsdWRl
L3hlbi9zY2hlZC1pZi5oIHwgICAyICsKIDMgZmlsZXMgY2hhbmdlZCwgMTI4IGluc2VydGlvbnMo
KyksIDgwIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3hlbi9jb21tb24vY3B1cG9vbC5jIGIv
eGVuL2NvbW1vbi9jcHVwb29sLmMKaW5kZXggMmEzZTE0NDcwMC4uYWI0YTJiZTRmYyAxMDA2NDQK
LS0tIGEveGVuL2NvbW1vbi9jcHVwb29sLmMKKysrIGIveGVuL2NvbW1vbi9jcHVwb29sLmMKQEAg
LTI5MiwyMiArMjkyLDE0IEBAIHN0YXRpYyBpbnQgY3B1cG9vbF9hc3NpZ25fY3B1X2xvY2tlZChz
dHJ1Y3QgY3B1cG9vbCAqYywgdW5zaWduZWQgaW50IGNwdSkKICAgICByZXR1cm4gMDsKIH0KIAot
c3RhdGljIGxvbmcgY3B1cG9vbF91bmFzc2lnbl9jcHVfaGVscGVyKHZvaWQgKmluZm8pCitzdGF0
aWMgaW50IGNwdXBvb2xfdW5hc3NpZ25fY3B1X2VwaWxvZ3VlKHN0cnVjdCBjcHVwb29sICpjKQog
ewogICAgIGludCBjcHUgPSBjcHVwb29sX21vdmluZ19jcHU7Ci0gICAgc3RydWN0IGNwdXBvb2wg
KmMgPSBpbmZvOwogICAgIHN0cnVjdCBkb21haW4gKmQ7Ci0gICAgbG9uZyByZXQ7Ci0KLSAgICBj
cHVwb29sX2RwcmludGsoImNwdXBvb2xfdW5hc3NpZ25fY3B1KHBvb2w9JWQsY3B1PSVkKVxuIiwK
LSAgICAgICAgICAgICAgICAgICAgY3B1cG9vbF9jcHVfbW92aW5nLT5jcHVwb29sX2lkLCBjcHUp
OworICAgIGludCByZXQ7CiAKLSAgICBzcGluX2xvY2soJmNwdXBvb2xfbG9jayk7CiAgICAgaWYg
KCBjICE9IGNwdXBvb2xfY3B1X21vdmluZyApCi0gICAgewotICAgICAgICByZXQgPSAtRUFERFJO
T1RBVkFJTDsKLSAgICAgICAgZ290byBvdXQ7Ci0gICAgfQorICAgICAgICByZXR1cm4gLUVBRERS
Tk9UQVZBSUw7CiAKICAgICAvKgogICAgICAqIFdlIG5lZWQgdGhpcyBmb3Igc2Nhbm5pbmcgdGhl
IGRvbWFpbiBsaXN0LCBib3RoIGluCkBAIC0zNDIsMzkgKzMzNCwxOSBAQCBzdGF0aWMgbG9uZyBj
cHVwb29sX3VuYXNzaWduX2NwdV9oZWxwZXIodm9pZCAqaW5mbykKICAgICAgICAgZG9tYWluX3Vw
ZGF0ZV9ub2RlX2FmZmluaXR5KGQpOwogICAgIH0KICAgICByY3VfcmVhZF91bmxvY2soJmRvbWxp
c3RfcmVhZF9sb2NrKTsKLW91dDoKLSAgICBzcGluX3VubG9jaygmY3B1cG9vbF9sb2NrKTsKLSAg
ICBjcHVwb29sX2RwcmludGsoImNwdXBvb2xfdW5hc3NpZ25fY3B1IHJldD0lbGRcbiIsIHJldCk7
CisKICAgICByZXR1cm4gcmV0OwogfQogCi0vKgotICogdW5hc3NpZ24gYSBzcGVjaWZpYyBjcHUg
ZnJvbSBhIGNwdXBvb2wKLSAqIHdlIG11c3QgYmUgc3VyZSBub3QgdG8gcnVuIG9uIHRoZSBjcHUg
dG8gYmUgdW5hc3NpZ25lZCEgdG8gYWNoaWV2ZSB0aGlzCi0gKiB0aGUgbWFpbiBmdW5jdGlvbmFs
aXR5IGlzIHBlcmZvcm1lZCB2aWEgY29udGludWVfaHlwZXJjYWxsX29uX2NwdSBvbiBhCi0gKiBz
cGVjaWZpYyBjcHUuCi0gKiBpZiB0aGUgY3B1IHRvIGJlIHJlbW92ZWQgaXMgdGhlIGxhc3Qgb25l
IG9mIHRoZSBjcHVwb29sIG5vIGFjdGl2ZSBkb21haW4KLSAqIG11c3QgYmUgYm91bmQgdG8gdGhl
IGNwdXBvb2wuIGR5aW5nIGRvbWFpbnMgYXJlIG1vdmVkIHRvIGNwdXBvb2wwIGFzIHRoZXkKLSAq
IG1pZ2h0IGJlIHpvbWJpZXMuCi0gKiBwb3NzaWJsZSBmYWlsdXJlczoKLSAqIC0gbGFzdCBjcHUg
YW5kIHN0aWxsIGFjdGl2ZSBkb21haW5zIGluIGNwdXBvb2wKLSAqIC0gY3B1IGp1c3QgYmVpbmcg
dW5wbHVnZ2VkCi0gKi8KLXN0YXRpYyBpbnQgY3B1cG9vbF91bmFzc2lnbl9jcHUoc3RydWN0IGNw
dXBvb2wgKmMsIHVuc2lnbmVkIGludCBjcHUpCitzdGF0aWMgaW50IGNwdXBvb2xfdW5hc3NpZ25f
Y3B1X3Byb2xvZ3VlKHN0cnVjdCBjcHVwb29sICpjLCB1bnNpZ25lZCBpbnQgY3B1KQogewotICAg
IGludCB3b3JrX2NwdTsKICAgICBpbnQgcmV0OwogICAgIHN0cnVjdCBkb21haW4gKmQ7CiAKLSAg
ICBjcHVwb29sX2RwcmludGsoImNwdXBvb2xfdW5hc3NpZ25fY3B1KHBvb2w9JWQsY3B1PSVkKVxu
IiwKLSAgICAgICAgICAgICAgICAgICAgYy0+Y3B1cG9vbF9pZCwgY3B1KTsKLQogICAgIHNwaW5f
bG9jaygmY3B1cG9vbF9sb2NrKTsKICAgICByZXQgPSAtRUFERFJOT1RBVkFJTDsKICAgICBpZiAo
IChjcHVwb29sX21vdmluZ19jcHUgIT0gLTEpICYmIChjcHUgIT0gY3B1cG9vbF9tb3ZpbmdfY3B1
KSApCiAgICAgICAgIGdvdG8gb3V0OwotICAgIGlmICggY3B1bWFza190ZXN0X2NwdShjcHUsICZj
cHVwb29sX2xvY2tlZF9jcHVzKSApCi0gICAgICAgIGdvdG8gb3V0OwogCiAgICAgcmV0ID0gMDsK
ICAgICBpZiAoICFjcHVtYXNrX3Rlc3RfY3B1KGNwdSwgYy0+Y3B1X3ZhbGlkKSAmJiAoY3B1ICE9
IGNwdXBvb2xfbW92aW5nX2NwdSkgKQpAQCAtMzg2LDcgKzM1OCw3IEBAIHN0YXRpYyBpbnQgY3B1
cG9vbF91bmFzc2lnbl9jcHUoc3RydWN0IGNwdXBvb2wgKmMsIHVuc2lnbmVkIGludCBjcHUpCiAg
ICAgICAgIHJjdV9yZWFkX2xvY2soJmRvbWxpc3RfcmVhZF9sb2NrKTsKICAgICAgICAgZm9yX2Vh
Y2hfZG9tYWluX2luX2NwdXBvb2woZCwgYykKICAgICAgICAgewotICAgICAgICAgICAgaWYgKCAh
ZC0+aXNfZHlpbmcgKQorICAgICAgICAgICAgaWYgKCAhZC0+aXNfZHlpbmcgJiYgc3lzdGVtX3N0
YXRlID09IFNZU19TVEFURV9hY3RpdmUgKQogICAgICAgICAgICAgewogICAgICAgICAgICAgICAg
IHJldCA9IC1FQlVTWTsKICAgICAgICAgICAgICAgICBicmVhazsKQEAgLTQwNCw4ICszNzYsNTgg
QEAgc3RhdGljIGludCBjcHVwb29sX3VuYXNzaWduX2NwdShzdHJ1Y3QgY3B1cG9vbCAqYywgdW5z
aWduZWQgaW50IGNwdSkKICAgICBjcHVwb29sX2NwdV9tb3ZpbmcgPSBjOwogICAgIGNwdW1hc2tf
Y2xlYXJfY3B1KGNwdSwgYy0+Y3B1X3ZhbGlkKTsKICAgICBjcHVtYXNrX2FuZChjLT5yZXNfdmFs
aWQsIGMtPmNwdV92YWxpZCwgc2NoZWRfcmVzX21hc2spOworCitvdXQ6CiAgICAgc3Bpbl91bmxv
Y2soJmNwdXBvb2xfbG9jayk7CiAKKyAgICByZXR1cm4gcmV0OworfQorCitzdGF0aWMgbG9uZyBj
cHVwb29sX3VuYXNzaWduX2NwdV9oZWxwZXIodm9pZCAqaW5mbykKK3sKKyAgICBzdHJ1Y3QgY3B1
cG9vbCAqYyA9IGluZm87CisgICAgbG9uZyByZXQ7CisKKyAgICBjcHVwb29sX2RwcmludGsoImNw
dXBvb2xfdW5hc3NpZ25fY3B1KHBvb2w9JWQsY3B1PSVkKVxuIiwKKyAgICAgICAgICAgICAgICAg
ICAgY3B1cG9vbF9jcHVfbW92aW5nLT5jcHVwb29sX2lkLCBjcHUpOworICAgIHNwaW5fbG9jaygm
Y3B1cG9vbF9sb2NrKTsKKworICAgIHJldCA9IGNwdXBvb2xfdW5hc3NpZ25fY3B1X2VwaWxvZ3Vl
KGMpOworCisgICAgc3Bpbl91bmxvY2soJmNwdXBvb2xfbG9jayk7CisgICAgY3B1cG9vbF9kcHJp
bnRrKCJjcHVwb29sX3VuYXNzaWduX2NwdSByZXQ9JWxkXG4iLCByZXQpOworCisgICAgcmV0dXJu
IHJldDsKK30KKworLyoKKyAqIHVuYXNzaWduIGEgc3BlY2lmaWMgY3B1IGZyb20gYSBjcHVwb29s
CisgKiB3ZSBtdXN0IGJlIHN1cmUgbm90IHRvIHJ1biBvbiB0aGUgY3B1IHRvIGJlIHVuYXNzaWdu
ZWQhIHRvIGFjaGlldmUgdGhpcworICogdGhlIG1haW4gZnVuY3Rpb25hbGl0eSBpcyBwZXJmb3Jt
ZWQgdmlhIGNvbnRpbnVlX2h5cGVyY2FsbF9vbl9jcHUgb24gYQorICogc3BlY2lmaWMgY3B1Lgor
ICogaWYgdGhlIGNwdSB0byBiZSByZW1vdmVkIGlzIHRoZSBsYXN0IG9uZSBvZiB0aGUgY3B1cG9v
bCBubyBhY3RpdmUgZG9tYWluCisgKiBtdXN0IGJlIGJvdW5kIHRvIHRoZSBjcHVwb29sLiBkeWlu
ZyBkb21haW5zIGFyZSBtb3ZlZCB0byBjcHVwb29sMCBhcyB0aGV5CisgKiBtaWdodCBiZSB6b21i
aWVzLgorICogcG9zc2libGUgZmFpbHVyZXM6CisgKiAtIGxhc3QgY3B1IGFuZCBzdGlsbCBhY3Rp
dmUgZG9tYWlucyBpbiBjcHVwb29sCisgKiAtIGNwdSBqdXN0IGJlaW5nIHVucGx1Z2dlZAorICov
CitzdGF0aWMgaW50IGNwdXBvb2xfdW5hc3NpZ25fY3B1KHN0cnVjdCBjcHVwb29sICpjLCB1bnNp
Z25lZCBpbnQgY3B1KQoreworICAgIGludCB3b3JrX2NwdTsKKyAgICBpbnQgcmV0OworCisgICAg
Y3B1cG9vbF9kcHJpbnRrKCJjcHVwb29sX3VuYXNzaWduX2NwdShwb29sPSVkLGNwdT0lZClcbiIs
CisgICAgICAgICAgICAgICAgICAgIGMtPmNwdXBvb2xfaWQsIGNwdSk7CisKKyAgICByZXQgPSBj
cHVwb29sX3VuYXNzaWduX2NwdV9wcm9sb2d1ZShjLCBjcHUpOworICAgIGlmICggcmV0ICkKKyAg
ICB7CisgICAgICAgIGNwdXBvb2xfZHByaW50aygiY3B1cG9vbF91bmFzc2lnbl9jcHUocG9vbD0l
ZCxjcHU9JWQpIHJldCAlZFxuIiwKKyAgICAgICAgICAgICAgICAgICAgICAgIGMtPmNwdXBvb2xf
aWQsIGNwdSwgcmV0KTsKKyAgICAgICAgcmV0dXJuIHJldDsKKyAgICB9CisKICAgICB3b3JrX2Nw
dSA9IHNtcF9wcm9jZXNzb3JfaWQoKTsKICAgICBpZiAoIHdvcmtfY3B1ID09IGNwdSApCiAgICAg
ewpAQCAtNDE0LDEyICs0MzYsNiBAQCBzdGF0aWMgaW50IGNwdXBvb2xfdW5hc3NpZ25fY3B1KHN0
cnVjdCBjcHVwb29sICpjLCB1bnNpZ25lZCBpbnQgY3B1KQogICAgICAgICAgICAgd29ya19jcHUg
PSBjcHVtYXNrX25leHQoY3B1LCBjcHVwb29sMC0+Y3B1X3ZhbGlkKTsKICAgICB9CiAgICAgcmV0
dXJuIGNvbnRpbnVlX2h5cGVyY2FsbF9vbl9jcHUod29ya19jcHUsIGNwdXBvb2xfdW5hc3NpZ25f
Y3B1X2hlbHBlciwgYyk7Ci0KLW91dDoKLSAgICBzcGluX3VubG9jaygmY3B1cG9vbF9sb2NrKTsK
LSAgICBjcHVwb29sX2RwcmludGsoImNwdXBvb2xfdW5hc3NpZ25fY3B1KHBvb2w9JWQsY3B1PSVk
KSByZXQgJWRcbiIsCi0gICAgICAgICAgICAgICAgICAgIGMtPmNwdXBvb2xfaWQsIGNwdSwgcmV0
KTsKLSAgICByZXR1cm4gcmV0OwogfQogCiAvKgpAQCAtNTAzLDMxICs1MTksNTQgQEAgc3RhdGlj
IGludCBjcHVwb29sX2NwdV9hZGQodW5zaWduZWQgaW50IGNwdSkKIH0KIAogLyoKLSAqIENhbGxl
ZCB0byByZW1vdmUgYSBDUFUgZnJvbSBhIHBvb2wuIFRoZSBDUFUgaXMgbG9ja2VkLCB0byBmb3Ji
aWQgcmVtb3ZpbmcKLSAqIGl0IGZyb20gcG9vbDAuIEluIGZhY3QsIGlmIHdlIHdhbnQgdG8gaG90
LXVucGx1ZyBhIENQVSwgaXQgbXVzdCBiZWxvbmcgdG8KLSAqIHBvb2wwLCBvciB3ZSBmYWlsLgor
ICogVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgaW4gc3RvcF9tYWNoaW5lIGNvbnRleHQsIHNvIHdl
IGNhbiBiZSBzdXJlIG5vCisgKiBub24taWRsZSB2Y3B1IGlzIGFjdGl2ZSBvbiB0aGUgc3lzdGVt
LgogICovCi1zdGF0aWMgaW50IGNwdXBvb2xfY3B1X3JlbW92ZSh1bnNpZ25lZCBpbnQgY3B1KQor
c3RhdGljIHZvaWQgY3B1cG9vbF9jcHVfcmVtb3ZlKHVuc2lnbmVkIGludCBjcHUpCiB7Ci0gICAg
aW50IHJldCA9IC1FTk9ERVY7CisgICAgaW50IHJldDsKIAotICAgIHNwaW5fbG9jaygmY3B1cG9v
bF9sb2NrKTsKKyAgICBBU1NFUlQoaXNfaWRsZV92Y3B1KGN1cnJlbnQpKTsKIAotICAgIGlmICgg
Y3B1bWFza190ZXN0X2NwdShjcHUsIGNwdXBvb2wwLT5jcHVfdmFsaWQpICkKKyAgICBpZiAoICFj
cHVtYXNrX3Rlc3RfY3B1KGNwdSwgJmNwdXBvb2xfZnJlZV9jcHVzKSApCiAgICAgewotICAgICAg
ICAvKgotICAgICAgICAgKiBJZiB3ZSBhcmUgbm90IHN1c3BlbmRpbmcsIHdlIGFyZSBob3QtdW5w
bHVnZ2luZyBjcHUsIGFuZCB0aGF0IGlzCi0gICAgICAgICAqIGFsbG93ZWQgb25seSBmb3IgQ1BV
cyBpbiBwb29sMC4KLSAgICAgICAgICovCi0gICAgICAgIGNwdW1hc2tfY2xlYXJfY3B1KGNwdSwg
Y3B1cG9vbDAtPmNwdV92YWxpZCk7Ci0gICAgICAgIGNwdW1hc2tfYW5kKGNwdXBvb2wwLT5yZXNf
dmFsaWQsIGNwdXBvb2wwLT5jcHVfdmFsaWQsIHNjaGVkX3Jlc19tYXNrKTsKLSAgICAgICAgcmV0
ID0gMDsKKyAgICAgICAgcmV0ID0gY3B1cG9vbF91bmFzc2lnbl9jcHVfZXBpbG9ndWUoY3B1cG9v
bDApOworICAgICAgICBCVUdfT04ocmV0KTsKICAgICB9Cit9CiAKLSAgICBpZiAoICFyZXQgKQor
LyoKKyAqIENhbGxlZCBiZWZvcmUgYSBDUFUgaXMgYmVpbmcgcmVtb3ZlZCBmcm9tIHRoZSBzeXN0
ZW0uCisgKiBSZW1vdmluZyBhIENQVSBpcyBhbGxvd2VkIGZvciBmcmVlIENQVXMgb3IgQ1BVcyBp
biBQb29sLTAgKHRob3NlIGFyZSBtb3ZlZAorICogdG8gZnJlZSBjcHVzIGFjdHVhbGx5IGJlZm9y
ZSByZW1vdmluZyB0aGVtKS4KKyAqIFRoZSBDUFUgaXMgbG9ja2VkLCB0byBmb3JiaWQgYWRkaW5n
IGl0IGFnYWluIHRvIGFub3RoZXIgY3B1cG9vbC4KKyAqLworc3RhdGljIGludCBjcHVwb29sX2Nw
dV9yZW1vdmVfcHJvbG9ndWUodW5zaWduZWQgaW50IGNwdSkKK3sKKyAgICBpbnQgcmV0ID0gMDsK
KworICAgIHNwaW5fbG9jaygmY3B1cG9vbF9sb2NrKTsKKworICAgIGlmICggY3B1bWFza190ZXN0
X2NwdShjcHUsICZjcHVwb29sX2xvY2tlZF9jcHVzKSApCisgICAgICAgIHJldCA9IC1FQlVTWTsK
KyAgICBlbHNlCiAgICAgICAgIGNwdW1hc2tfc2V0X2NwdShjcHUsICZjcHVwb29sX2xvY2tlZF9j
cHVzKTsKKwogICAgIHNwaW5fdW5sb2NrKCZjcHVwb29sX2xvY2spOwogCisgICAgaWYgKCByZXQg
KQorICAgICAgICByZXR1cm4gIHJldDsKKworICAgIGlmICggY3B1bWFza190ZXN0X2NwdShjcHUs
IGNwdXBvb2wwLT5jcHVfdmFsaWQpICkKKyAgICB7CisgICAgICAgIC8qIENwdXBvb2wwIGlzIHBv
cHVsYXRlZCBvbmx5IGFmdGVyIGFsbCBjcHVzIGFyZSB1cC4gKi8KKyAgICAgICAgQVNTRVJUKHN5
c3RlbV9zdGF0ZSA9PSBTWVNfU1RBVEVfYWN0aXZlKTsKKworICAgICAgICByZXQgPSBjcHVwb29s
X3VuYXNzaWduX2NwdV9wcm9sb2d1ZShjcHVwb29sMCwgY3B1KTsKKyAgICB9CisgICAgZWxzZSBp
ZiAoICFjcHVtYXNrX3Rlc3RfY3B1KGNwdSwgJmNwdXBvb2xfZnJlZV9jcHVzKSApCisgICAgICAg
IHJldCA9IC1FTk9ERVY7CisKICAgICByZXR1cm4gcmV0OwogfQogCkBAIC01MzUsMTMgKzU3NCwx
MyBAQCBzdGF0aWMgaW50IGNwdXBvb2xfY3B1X3JlbW92ZSh1bnNpZ25lZCBpbnQgY3B1KQogICog
Q2FsbGVkIGR1cmluZyByZXN1bWUgZm9yIGFsbCBjcHVzIHdoaWNoIGRpZG4ndCBjb21lIHVwIGFn
YWluLiBUaGUgY3B1IG11c3QKICAqIGJlIHJlbW92ZWQgZnJvbSB0aGUgY3B1cG9vbCBpdCBpcyBh
c3NpZ25lZCB0by4gSW4gY2FzZSBhIGNwdXBvb2wgd2lsbCBiZQogICogbGVmdCB3aXRob3V0IGNw
dSB3ZSBtb3ZlIGFsbCBkb21haW5zIG9mIHRoYXQgY3B1cG9vbCB0byBjcHVwb29sMC4KKyAqIEFz
IHdlIGFyZSBjYWxsZWQgd2l0aCBhbGwgZG9tYWlucyBzdGlsbCBmcm96ZW4gdGhlcmUgaXMgbm8g
bmVlZCB0byB0YWtlIHRoZQorICogY3B1cG9vbCBsb2NrIGhlcmUuCiAgKi8KIHN0YXRpYyB2b2lk
IGNwdXBvb2xfY3B1X3JlbW92ZV9mb3JjZWQodW5zaWduZWQgaW50IGNwdSkKIHsKICAgICBzdHJ1
Y3QgY3B1cG9vbCAqKmM7Ci0gICAgc3RydWN0IGRvbWFpbiAqZDsKLQotICAgIHNwaW5fbG9jaygm
Y3B1cG9vbF9sb2NrKTsKKyAgICBpbnQgcmV0OwogCiAgICAgaWYgKCBjcHVtYXNrX3Rlc3RfY3B1
KGNwdSwgJmNwdXBvb2xfZnJlZV9jcHVzKSApCiAgICAgICAgIGNwdW1hc2tfY2xlYXJfY3B1KGNw
dSwgJmNwdXBvb2xfZnJlZV9jcHVzKTsKQEAgLTU1MSwxOSArNTkwLDEzIEBAIHN0YXRpYyB2b2lk
IGNwdXBvb2xfY3B1X3JlbW92ZV9mb3JjZWQodW5zaWduZWQgaW50IGNwdSkKICAgICAgICAgewog
ICAgICAgICAgICAgaWYgKCBjcHVtYXNrX3Rlc3RfY3B1KGNwdSwgKCpjKS0+Y3B1X3ZhbGlkKSAp
CiAgICAgICAgICAgICB7Ci0gICAgICAgICAgICAgICAgY3B1bWFza19jbGVhcl9jcHUoY3B1LCAo
KmMpLT5jcHVfdmFsaWQpOwotICAgICAgICAgICAgICAgIGlmICggY3B1bWFza193ZWlnaHQoKCpj
KS0+Y3B1X3ZhbGlkKSA9PSAwICkKLSAgICAgICAgICAgICAgICB7Ci0gICAgICAgICAgICAgICAg
ICAgIGlmICggKmMgPT0gY3B1cG9vbDAgKQotICAgICAgICAgICAgICAgICAgICAgICAgcGFuaWMo
Ik5vIGNwdSBsZWZ0IGluIGNwdXBvb2wwXG4iKTsKLSAgICAgICAgICAgICAgICAgICAgZm9yX2Vh
Y2hfZG9tYWluX2luX2NwdXBvb2woZCwgKmMpCi0gICAgICAgICAgICAgICAgICAgICAgICBjcHVw
b29sX21vdmVfZG9tYWluX2xvY2tlZChkLCBjcHVwb29sMCk7Ci0gICAgICAgICAgICAgICAgfQor
ICAgICAgICAgICAgICAgIHJldCA9IGNwdXBvb2xfdW5hc3NpZ25fY3B1KCpjLCBjcHUpOworICAg
ICAgICAgICAgICAgIEJVR19PTihyZXQpOwogICAgICAgICAgICAgfQogICAgICAgICB9CiAgICAg
fQogCi0gICAgc3Bpbl91bmxvY2soJmNwdXBvb2xfbG9jayk7CisgICAgc2NoZWRfcm1fY3B1KGNw
dSk7CiB9CiAKIC8qCkBAIC02MzEsNyArNjY0LDggQEAgaW50IGNwdXBvb2xfZG9fc3lzY3RsKHN0
cnVjdCB4ZW5fc3lzY3RsX2NwdXBvb2xfb3AgKm9wKQogICAgICAgICBpZiAoIGNwdSA+PSBucl9j
cHVfaWRzICkKICAgICAgICAgICAgIGdvdG8gYWRkY3B1X291dDsKICAgICAgICAgcmV0ID0gLUVO
T0RFVjsKLSAgICAgICAgaWYgKCAhY3B1bWFza190ZXN0X2NwdShjcHUsICZjcHVwb29sX2ZyZWVf
Y3B1cykgKQorICAgICAgICBpZiAoICFjcHVtYXNrX3Rlc3RfY3B1KGNwdSwgJmNwdXBvb2xfZnJl
ZV9jcHVzKSB8fAorICAgICAgICAgICAgIGNwdW1hc2tfdGVzdF9jcHUoY3B1LCAmY3B1cG9vbF9s
b2NrZWRfY3B1cykgKQogICAgICAgICAgICAgZ290byBhZGRjcHVfb3V0OwogICAgICAgICBjID0g
Y3B1cG9vbF9maW5kX2J5X2lkKG9wLT5jcHVwb29sX2lkKTsKICAgICAgICAgcmV0ID0gLUVOT0VO
VDsKQEAgLTc1OSw3ICs3OTMsMTIgQEAgc3RhdGljIGludCBjcHVfY2FsbGJhY2soCiAgICAgY2Fz
ZSBDUFVfRE9XTl9QUkVQQVJFOgogICAgICAgICAvKiBTdXNwZW5kL1Jlc3VtZSBkb24ndCBjaGFu
Z2UgYXNzaWdubWVudHMgb2YgY3B1cyB0byBjcHVwb29scy4gKi8KICAgICAgICAgaWYgKCBzeXN0
ZW1fc3RhdGUgPD0gU1lTX1NUQVRFX2FjdGl2ZSApCi0gICAgICAgICAgICByYyA9IGNwdXBvb2xf
Y3B1X3JlbW92ZShjcHUpOworICAgICAgICAgICAgcmMgPSBjcHVwb29sX2NwdV9yZW1vdmVfcHJv
bG9ndWUoY3B1KTsKKyAgICAgICAgYnJlYWs7CisgICAgY2FzZSBDUFVfRFlJTkc6CisgICAgICAg
IC8qIFN1c3BlbmQvUmVzdW1lIGRvbid0IGNoYW5nZSBhc3NpZ25tZW50cyBvZiBjcHVzIHRvIGNw
dXBvb2xzLiAqLworICAgICAgICBpZiAoIHN5c3RlbV9zdGF0ZSA8PSBTWVNfU1RBVEVfYWN0aXZl
ICkKKyAgICAgICAgICAgIGNwdXBvb2xfY3B1X3JlbW92ZShjcHUpOwogICAgICAgICBicmVhazsK
ICAgICBjYXNlIENQVV9SRVNVTUVfRkFJTEVEOgogICAgICAgICBjcHVwb29sX2NwdV9yZW1vdmVf
Zm9yY2VkKGNwdSk7CmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3NjaGVkdWxlLmMgYi94ZW4vY29t
bW9uL3NjaGVkdWxlLmMKaW5kZXggNDQzNjRmZjRkMi4uN2E1YWI0YjFiNiAxMDA2NDQKLS0tIGEv
eGVuL2NvbW1vbi9zY2hlZHVsZS5jCisrKyBiL3hlbi9jb21tb24vc2NoZWR1bGUuYwpAQCAtMjIz
NSwxMiArMjIzNSwyNCBAQCB2b2lkIHNjaGVkdWxlcl9wZXJjcHVfaW5pdCh1bnNpZ25lZCBpbnQg
Y3B1KQogICAgICAgICBzY2hlZF9pbml0X3BkYXRhKHNjaGVkLCBzZC0+c2NoZWRfcHJpdiwgY3B1
KTsKIH0KIAordm9pZCBzY2hlZF9ybV9jcHUodW5zaWduZWQgaW50IGNwdSkKK3sKKyAgICBpbnQg
cmM7CisgICAgc3RydWN0IHNjaGVkX3Jlc291cmNlICpzZCA9IGdldF9zY2hlZF9yZXMoY3B1KTsK
KyAgICBzdHJ1Y3Qgc2NoZWR1bGVyICpzY2hlZCA9IHNkLT5zY2hlZHVsZXI7CisKKyAgICByY3Vf
cmVhZF9sb2NrKCZkb21saXN0X3JlYWRfbG9jayk7CisgICAgcmMgPSBjcHVfZGlzYWJsZV9zY2hl
ZHVsZXIoY3B1KTsKKyAgICBCVUdfT04ocmMpOworICAgIHJjdV9yZWFkX3VubG9jaygmZG9tbGlz
dF9yZWFkX2xvY2spOworICAgIHNjaGVkX2RlaW5pdF9wZGF0YShzY2hlZCwgc2QtPnNjaGVkX3By
aXYsIGNwdSk7CisgICAgY3B1X3NjaGVkdWxlX2Rvd24oY3B1KTsKK30KKwogc3RhdGljIGludCBj
cHVfc2NoZWR1bGVfY2FsbGJhY2soCiAgICAgc3RydWN0IG5vdGlmaWVyX2Jsb2NrICpuZmIsIHVu
c2lnbmVkIGxvbmcgYWN0aW9uLCB2b2lkICpoY3B1KQogewogICAgIHVuc2lnbmVkIGludCBjcHUg
PSAodW5zaWduZWQgbG9uZyloY3B1OwotICAgIHN0cnVjdCBzY2hlZF9yZXNvdXJjZSAqc2QgPSBn
ZXRfc2NoZWRfcmVzKGNwdSk7Ci0gICAgc3RydWN0IHNjaGVkdWxlciAqc2NoZWQgPSBzZC0+c2No
ZWR1bGVyOwogICAgIGludCByYyA9IDA7CiAKICAgICAvKgpAQCAtMjI4NiwxNiArMjI5OCwxMCBA
QCBzdGF0aWMgaW50IGNwdV9zY2hlZHVsZV9jYWxsYmFjaygKICAgICAgICAgcmMgPSBjcHVfZGlz
YWJsZV9zY2hlZHVsZXJfY2hlY2soY3B1KTsKICAgICAgICAgcmN1X3JlYWRfdW5sb2NrKCZkb21s
aXN0X3JlYWRfbG9jayk7CiAgICAgICAgIGJyZWFrOwotICAgIGNhc2UgQ1BVX1JFU1VNRV9GQUlM
RUQ6CiAgICAgY2FzZSBDUFVfREVBRDoKICAgICAgICAgaWYgKCBzeXN0ZW1fc3RhdGUgPT0gU1lT
X1NUQVRFX3N1c3BlbmQgKQogICAgICAgICAgICAgYnJlYWs7Ci0gICAgICAgIHJjdV9yZWFkX2xv
Y2soJmRvbWxpc3RfcmVhZF9sb2NrKTsKLSAgICAgICAgcmMgPSBjcHVfZGlzYWJsZV9zY2hlZHVs
ZXIoY3B1KTsKLSAgICAgICAgQlVHX09OKHJjKTsKLSAgICAgICAgcmN1X3JlYWRfdW5sb2NrKCZk
b21saXN0X3JlYWRfbG9jayk7Ci0gICAgICAgIHNjaGVkX2RlaW5pdF9wZGF0YShzY2hlZCwgc2Qt
PnNjaGVkX3ByaXYsIGNwdSk7Ci0gICAgICAgIGNwdV9zY2hlZHVsZV9kb3duKGNwdSk7CisgICAg
ICAgIHNjaGVkX3JtX2NwdShjcHUpOwogICAgICAgICBicmVhazsKICAgICBjYXNlIENQVV9VUF9D
QU5DRUxFRDoKICAgICAgICAgaWYgKCBzeXN0ZW1fc3RhdGUgIT0gU1lTX1NUQVRFX3Jlc3VtZSAp
CkBAIC0yNDIxLDYgKzI0MjcsNyBAQCBpbnQgc2NoZWR1bGVfY3B1X3N3aXRjaCh1bnNpZ25lZCBp
bnQgY3B1LCBzdHJ1Y3QgY3B1cG9vbCAqYykKICAgICBzdHJ1Y3Qgc2NoZWRfcmVzb3VyY2UgKnNk
ID0gZ2V0X3NjaGVkX3JlcyhjcHUpOwogICAgIHN0cnVjdCBjcHVwb29sICpvbGRfcG9vbCA9IHNk
LT5jcHVwb29sOwogICAgIHNwaW5sb2NrX3QgKm9sZF9sb2NrLCAqbmV3X2xvY2s7CisgICAgdW5z
aWduZWQgbG9uZyBmbGFnczsKIAogICAgIC8qCiAgICAgICogcENQVXMgb25seSBtb3ZlIGZyb20g
YSB2YWxpZCBjcHVwb29sIHRvIGZyZWUgKGkuZS4sIG91dCBvZiBhbnkgcG9vbCksCkBAIC0yNDc2
LDcgKzI0ODMsNyBAQCBpbnQgc2NoZWR1bGVfY3B1X3N3aXRjaCh1bnNpZ25lZCBpbnQgY3B1LCBz
dHJ1Y3QgY3B1cG9vbCAqYykKICAgICAgKiB0aGF0IHRoZSBsb2NrIGl0c2VsZiBjaGFuZ2VkLCBh
bmQgcmV0cnkgYWNxdWlyaW5nIHRoZSBuZXcgb25lICh3aGljaAogICAgICAqIHdpbGwgYmUgdGhl
IGNvcnJlY3QsIHJlbWFwcGVkIG9uZSwgYXQgdGhhdCBwb2ludCkuCiAgICAgICovCi0gICAgb2xk
X2xvY2sgPSBwY3B1X3NjaGVkdWxlX2xvY2tfaXJxKGNwdSk7CisgICAgb2xkX2xvY2sgPSBwY3B1
X3NjaGVkdWxlX2xvY2tfaXJxc2F2ZShjcHUsICZmbGFncyk7CiAKICAgICB2cHJpdl9vbGQgPSBp
ZGxlLT5zY2hlZF91bml0LT5wcml2OwogICAgIHBwcml2X29sZCA9IHNkLT5zY2hlZF9wcml2OwpA
QCAtMjQ5NCw3ICsyNTAxLDcgQEAgaW50IHNjaGVkdWxlX2NwdV9zd2l0Y2godW5zaWduZWQgaW50
IGNwdSwgc3RydWN0IGNwdXBvb2wgKmMpCiAgICAgc2QtPnNjaGVkdWxlX2xvY2sgPSBjID8gbmV3
X2xvY2sgOiAmc2NoZWRfZnJlZV9jcHVfbG9jazsKIAogICAgIC8qIF9Ob3RfIHBjcHVfc2NoZWR1
bGVfdW5sb2NrKCk6IHNjaGVkdWxlX2xvY2sgbWF5IGhhdmUgY2hhbmdlZCEgKi8KLSAgICBzcGlu
X3VubG9ja19pcnEob2xkX2xvY2spOworICAgIHNwaW5fdW5sb2NrX2lycXJlc3RvcmUob2xkX2xv
Y2ssIGZsYWdzKTsKIAogICAgIHNjaGVkX2RvX3RpY2tfcmVzdW1lKG5ld19vcHMsIGNwdSk7CiAK
ZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5oIGIveGVuL2luY2x1ZGUveGVu
L3NjaGVkLWlmLmgKaW5kZXggYTBmMTFkMGMxNS4uZTA0ZDI0OWRmZCAxMDA2NDQKLS0tIGEveGVu
L2luY2x1ZGUveGVuL3NjaGVkLWlmLmgKKysrIGIveGVuL2luY2x1ZGUveGVuL3NjaGVkLWlmLmgK
QEAgLTYwOSw0ICs2MDksNiBAQCBhZmZpbml0eV9iYWxhbmNlX2NwdW1hc2soY29uc3Qgc3RydWN0
IHNjaGVkX3VuaXQgKnVuaXQsIGludCBzdGVwLAogICAgICAgICBjcHVtYXNrX2NvcHkobWFzaywg
dW5pdC0+Y3B1X2hhcmRfYWZmaW5pdHkpOwogfQogCit2b2lkIHNjaGVkX3JtX2NwdSh1bnNpZ25l
ZCBpbnQgY3B1KTsKKwogI2VuZGlmIC8qIF9fWEVOX1NDSEVEX0lGX0hfXyAqLwotLSAKMi4xNi40
CgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRl
dmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9s
aXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

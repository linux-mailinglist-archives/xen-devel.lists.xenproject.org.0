Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id B4B781683ED
	for <lists+xen-devel@lfdr.de>; Fri, 21 Feb 2020 17:46:30 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1j5BPU-0002F1-R9; Fri, 21 Feb 2020 16:44:16 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=YW1k=4J=redhat.com=david@srs-us1.protection.inumbo.net>)
 id 1j5BPT-0002Ek-6H
 for xen-devel@lists.xenproject.org; Fri, 21 Feb 2020 16:44:15 +0000
X-Inumbo-ID: 3f9705f7-54c9-11ea-86b2-12813bfff9fa
Received: from us-smtp-1.mimecast.com (unknown [205.139.110.61])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTP
 id 3f9705f7-54c9-11ea-86b2-12813bfff9fa;
 Fri, 21 Feb 2020 16:43:12 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
 s=mimecast20190719; t=1582303392;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=Gm4E2H+UsvDbJoOz38xrcXlXvsFFgBUsWOd4QRP/Pc8=;
 b=G3jxDonSVoYb+cZL10n86sMHcIEMnUiOvJlqkOYMqhWVt5gv8iupiJqEpFErxM3QWye8dt
 jdZJqrTMTjt5VjrCqLO/qaKIZJqjFPbZDrkvj1qcXdPiw/QTdA/7ChLoAEEU0GW/f1U/QY
 yUYJymKqUOflPuq27wvcU93mpvLQRbw=
Received: from mimecast-mx01.redhat.com (mimecast-mx01.redhat.com
 [209.132.183.4]) (Using TLS) by relay.mimecast.com with ESMTP id
 us-mta-14-MWTpaPyAObe9_oE9y9YcQA-1; Fri, 21 Feb 2020 11:43:10 -0500
X-MC-Unique: MWTpaPyAObe9_oE9y9YcQA-1
Received: from smtp.corp.redhat.com (int-mx05.intmail.prod.int.phx2.redhat.com
 [10.5.11.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mimecast-mx01.redhat.com (Postfix) with ESMTPS id 92965801A0E;
 Fri, 21 Feb 2020 16:43:08 +0000 (UTC)
Received: from t480s.redhat.com (ovpn-117-197.ams2.redhat.com [10.36.117.197])
 by smtp.corp.redhat.com (Postfix) with ESMTP id F3FAE5C105;
 Fri, 21 Feb 2020 16:43:02 +0000 (UTC)
From: David Hildenbrand <david@redhat.com>
To: qemu-devel@nongnu.org
Date: Fri, 21 Feb 2020 17:41:54 +0100
Message-Id: <20200221164204.105570-4-david@redhat.com>
In-Reply-To: <20200221164204.105570-1-david@redhat.com>
References: <20200221164204.105570-1-david@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.15
X-Mimecast-Spam-Score: 0
X-Mimecast-Originator: redhat.com
Subject: [Xen-devel] [PATCH v2 03/13] numa: Teach ram block notifiers about
 resizeable ram blocks
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Stefano Stabellini <sstabellini@kernel.org>,
 Eduardo Habkost <ehabkost@redhat.com>, Juan Quintela <quintela@redhat.com>,
 David Hildenbrand <david@redhat.com>,
 "Dr . David Alan Gilbert" <dgilbert@redhat.com>, Peter Xu <peterx@redhat.com>,
 Paul Durrant <paul@xen.org>, Igor Mammedov <imammedo@redhat.com>,
 "Michael S. Tsirkin" <mst@redhat.com>,
 Marcel Apfelbaum <marcel.apfelbaum@gmail.com>, xen-devel@lists.xenproject.org,
 Anthony Perard <anthony.perard@citrix.com>,
 Paolo Bonzini <pbonzini@redhat.com>, Richard Henderson <rth@twiddle.net>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

UmFtIGJsb2NrIG5vdGlmaWVycyBhcmUgY3VycmVudGx5IG5vdCBhd2FyZSBvZiByZXNpemVzLiBF
c3BlY2lhbGx5IHRvCmhhbmRsZSByZXNpemVzIGR1cmluZyBtaWdyYXRpb24sIGJ1dCBhbHNvIHRv
IGltcGxlbWVudCBhY3R1YWxseSByZXNpemVhYmxlCnJhbSBibG9ja3MgKG1ha2UgZXZlcnl0aGlu
ZyBiZXR3ZWVuIHVzZWRfbGVuZ3RoIGFuZCBtYXhfbGVuZ3RoCmluYWNjZXNzaWJsZSksIHdlIHdh
bnQgdG8gdGVhY2ggcmFtIGJsb2NrIG5vdGlmaWVycyBhYm91dCByZXNpemVhYmxlCnJhbS4KCklu
dHJvZHVjZSB0aGUgYmFzaWMgaW5mcmFzdHJ1Y3R1cmUgYnV0IGtlZXAgdXNpbmcgbWF4X3NpemUg
aW4gdGhlCmV4aXN0aW5nIG5vdGlmaWVycy4gU3VwcGx5IHRoZSBtYXhfc2l6ZSB3aGVuIGFkZGlu
ZyBhbmQgcmVtb3ZpbmcgcmFtCmJsb2Nrcy4gQWxzbywgbm90aWZ5IG9uIHJlc2l6ZXMuCgpBY2tl
ZC1ieTogUGF1bCBEdXJyYW50IDxwYXVsQHhlbi5vcmc+ClJldmlld2VkLWJ5OiBQZXRlciBYdSA8
cGV0ZXJ4QHJlZGhhdC5jb20+CkNjOiBSaWNoYXJkIEhlbmRlcnNvbiA8cnRoQHR3aWRkbGUubmV0
PgpDYzogUGFvbG8gQm9uemluaSA8cGJvbnppbmlAcmVkaGF0LmNvbT4KQ2M6ICJEci4gRGF2aWQg
QWxhbiBHaWxiZXJ0IiA8ZGdpbGJlcnRAcmVkaGF0LmNvbT4KQ2M6IEVkdWFyZG8gSGFia29zdCA8
ZWhhYmtvc3RAcmVkaGF0LmNvbT4KQ2M6IE1hcmNlbCBBcGZlbGJhdW0gPG1hcmNlbC5hcGZlbGJh
dW1AZ21haWwuY29tPgpDYzogU3RlZmFubyBTdGFiZWxsaW5pIDxzc3RhYmVsbGluaUBrZXJuZWwu
b3JnPgpDYzogQW50aG9ueSBQZXJhcmQgPGFudGhvbnkucGVyYXJkQGNpdHJpeC5jb20+CkNjOiBQ
YXVsIER1cnJhbnQgPHBhdWxAeGVuLm9yZz4KQ2M6ICJNaWNoYWVsIFMuIFRzaXJraW4iIDxtc3RA
cmVkaGF0LmNvbT4KQ2M6IHhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpDYzogSWdvciBN
YW1tZWRvdiA8aW1hbW1lZG9AcmVkaGF0LmNvbT4KU2lnbmVkLW9mZi1ieTogRGF2aWQgSGlsZGVu
YnJhbmQgPGRhdmlkQHJlZGhhdC5jb20+Ci0tLQogZXhlYy5jICAgICAgICAgICAgICAgICAgICAg
fCAxMyArKysrKysrKysrKy0tCiBody9jb3JlL251bWEuYyAgICAgICAgICAgICB8IDIyICsrKysr
KysrKysrKysrKysrLS0tLS0KIGh3L2kzODYveGVuL3hlbi1tYXBjYWNoZS5jIHwgIDcgKysrKy0t
LQogaW5jbHVkZS9leGVjL3JhbWxpc3QuaCAgICAgfCAxMyArKysrKysrKystLS0tCiB0YXJnZXQv
aTM4Ni9oYXgtbWVtLmMgICAgICB8ICA1ICsrKy0tCiB0YXJnZXQvaTM4Ni9zZXYuYyAgICAgICAg
ICB8IDE4ICsrKysrKysrKystLS0tLS0tLQogdXRpbC92ZmlvLWhlbHBlcnMuYyAgICAgICAgfCAx
NiArKysrKysrKy0tLS0tLS0tCiA3IGZpbGVzIGNoYW5nZWQsIDYyIGluc2VydGlvbnMoKyksIDMy
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2V4ZWMuYyBiL2V4ZWMuYwppbmRleCBkZmQ0M2Qy
N2M2Li5iNzUyNTBlNzczIDEwMDY0NAotLS0gYS9leGVjLmMKKysrIGIvZXhlYy5jCkBAIC0yMTI5
LDYgKzIxMjksOCBAQCBzdGF0aWMgaW50IG1lbW9yeV90cnlfZW5hYmxlX21lcmdpbmcodm9pZCAq
YWRkciwgc2l6ZV90IGxlbikKICAqLwogaW50IHFlbXVfcmFtX3Jlc2l6ZShSQU1CbG9jayAqYmxv
Y2ssIHJhbV9hZGRyX3QgbmV3c2l6ZSwgRXJyb3IgKiplcnJwKQogeworICAgIGNvbnN0IHJhbV9h
ZGRyX3Qgb2xkc2l6ZSA9IGJsb2NrLT51c2VkX2xlbmd0aDsKKwogICAgIGFzc2VydChibG9jayk7
CiAKICAgICBuZXdzaXplID0gSE9TVF9QQUdFX0FMSUdOKG5ld3NpemUpOwpAQCAtMjE1Myw2ICsy
MTU1LDExIEBAIGludCBxZW11X3JhbV9yZXNpemUoUkFNQmxvY2sgKmJsb2NrLCByYW1fYWRkcl90
IG5ld3NpemUsIEVycm9yICoqZXJycCkKICAgICAgICAgcmV0dXJuIC1FSU5WQUw7CiAgICAgfQog
CisgICAgLyogTm90aWZ5IGJlZm9yZSBtb2RpZnlpbmcgdGhlIHJhbSBibG9jayBhbmQgdG91Y2hp
bmcgdGhlIGJpdG1hcHMuICovCisgICAgaWYgKGJsb2NrLT5ob3N0KSB7CisgICAgICAgIHJhbV9i
bG9ja19ub3RpZnlfcmVzaXplKGJsb2NrLT5ob3N0LCBvbGRzaXplLCBuZXdzaXplKTsKKyAgICB9
CisKICAgICBjcHVfcGh5c2ljYWxfbWVtb3J5X2NsZWFyX2RpcnR5X3JhbmdlKGJsb2NrLT5vZmZz
ZXQsIGJsb2NrLT51c2VkX2xlbmd0aCk7CiAgICAgYmxvY2stPnVzZWRfbGVuZ3RoID0gbmV3c2l6
ZTsKICAgICBjcHVfcGh5c2ljYWxfbWVtb3J5X3NldF9kaXJ0eV9yYW5nZShibG9jay0+b2Zmc2V0
LCBibG9jay0+dXNlZF9sZW5ndGgsCkBAIC0yMzEyLDcgKzIzMTksOCBAQCBzdGF0aWMgdm9pZCBy
YW1fYmxvY2tfYWRkKFJBTUJsb2NrICpuZXdfYmxvY2ssIEVycm9yICoqZXJycCwgYm9vbCBzaGFy
ZWQpCiAgICAgICAgIHFlbXVfbWFkdmlzZShuZXdfYmxvY2stPmhvc3QsIG5ld19ibG9jay0+bWF4
X2xlbmd0aCwgUUVNVV9NQURWX0hVR0VQQUdFKTsKICAgICAgICAgLyogTUFEVl9ET05URk9SSyBp
cyBhbHNvIG5lZWRlZCBieSBLVk0gaW4gYWJzZW5jZSBvZiBzeW5jaHJvbm91cyBNTVUgKi8KICAg
ICAgICAgcWVtdV9tYWR2aXNlKG5ld19ibG9jay0+aG9zdCwgbmV3X2Jsb2NrLT5tYXhfbGVuZ3Ro
LCBRRU1VX01BRFZfRE9OVEZPUkspOwotICAgICAgICByYW1fYmxvY2tfbm90aWZ5X2FkZChuZXdf
YmxvY2stPmhvc3QsIG5ld19ibG9jay0+bWF4X2xlbmd0aCk7CisgICAgICAgIHJhbV9ibG9ja19u
b3RpZnlfYWRkKG5ld19ibG9jay0+aG9zdCwgbmV3X2Jsb2NrLT51c2VkX2xlbmd0aCwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgbmV3X2Jsb2NrLT5tYXhfbGVuZ3RoKTsKICAgICB9CiB9
CiAKQEAgLTI0OTIsNyArMjUwMCw4IEBAIHZvaWQgcWVtdV9yYW1fZnJlZShSQU1CbG9jayAqYmxv
Y2spCiAgICAgfQogCiAgICAgaWYgKGJsb2NrLT5ob3N0KSB7Ci0gICAgICAgIHJhbV9ibG9ja19u
b3RpZnlfcmVtb3ZlKGJsb2NrLT5ob3N0LCBibG9jay0+bWF4X2xlbmd0aCk7CisgICAgICAgIHJh
bV9ibG9ja19ub3RpZnlfcmVtb3ZlKGJsb2NrLT5ob3N0LCBibG9jay0+dXNlZF9sZW5ndGgsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrLT5tYXhfbGVuZ3RoKTsKICAgICB9
CiAKICAgICBxZW11X211dGV4X2xvY2tfcmFtbGlzdCgpOwpkaWZmIC0tZ2l0IGEvaHcvY29yZS9u
dW1hLmMgYi9ody9jb3JlL251bWEuYwppbmRleCA2NTk5YzY5ZTA1Li5lMjhhZDI0ZmNkIDEwMDY0
NAotLS0gYS9ody9jb3JlL251bWEuYworKysgYi9ody9jb3JlL251bWEuYwpAQCAtOTAyLDExICs5
MDIsMTIgQEAgdm9pZCBxdWVyeV9udW1hX25vZGVfbWVtKE51bWFOb2RlTWVtIG5vZGVfbWVtW10s
IE1hY2hpbmVTdGF0ZSAqbXMpCiBzdGF0aWMgaW50IHJhbV9ibG9ja19ub3RpZnlfYWRkX3Npbmds
ZShSQU1CbG9jayAqcmIsIHZvaWQgKm9wYXF1ZSkKIHsKICAgICBjb25zdCByYW1fYWRkcl90IG1h
eF9zaXplID0gcWVtdV9yYW1fZ2V0X21heF9sZW5ndGgocmIpOworICAgIGNvbnN0IHJhbV9hZGRy
X3Qgc2l6ZSA9IHFlbXVfcmFtX2dldF91c2VkX2xlbmd0aChyYik7CiAgICAgdm9pZCAqaG9zdCA9
IHFlbXVfcmFtX2dldF9ob3N0X2FkZHIocmIpOwogICAgIFJBTUJsb2NrTm90aWZpZXIgKm5vdGlm
aWVyID0gb3BhcXVlOwogCiAgICAgaWYgKGhvc3QpIHsKLSAgICAgICAgbm90aWZpZXItPnJhbV9i
bG9ja19hZGRlZChub3RpZmllciwgaG9zdCwgbWF4X3NpemUpOworICAgICAgICBub3RpZmllci0+
cmFtX2Jsb2NrX2FkZGVkKG5vdGlmaWVyLCBob3N0LCBzaXplLCBtYXhfc2l6ZSk7CiAgICAgfQog
ICAgIHJldHVybiAwOwogfQpAQCAtOTIzLDIwICs5MjQsMzEgQEAgdm9pZCByYW1fYmxvY2tfbm90
aWZpZXJfcmVtb3ZlKFJBTUJsb2NrTm90aWZpZXIgKm4pCiAgICAgUUxJU1RfUkVNT1ZFKG4sIG5l
eHQpOwogfQogCi12b2lkIHJhbV9ibG9ja19ub3RpZnlfYWRkKHZvaWQgKmhvc3QsIHNpemVfdCBz
aXplKQordm9pZCByYW1fYmxvY2tfbm90aWZ5X2FkZCh2b2lkICpob3N0LCBzaXplX3Qgc2l6ZSwg
c2l6ZV90IG1heF9zaXplKQogewogICAgIFJBTUJsb2NrTm90aWZpZXIgKm5vdGlmaWVyOwogCiAg
ICAgUUxJU1RfRk9SRUFDSChub3RpZmllciwgJnJhbV9saXN0LnJhbWJsb2NrX25vdGlmaWVycywg
bmV4dCkgewotICAgICAgICBub3RpZmllci0+cmFtX2Jsb2NrX2FkZGVkKG5vdGlmaWVyLCBob3N0
LCBzaXplKTsKKyAgICAgICAgbm90aWZpZXItPnJhbV9ibG9ja19hZGRlZChub3RpZmllciwgaG9z
dCwgc2l6ZSwgbWF4X3NpemUpOwogICAgIH0KIH0KIAotdm9pZCByYW1fYmxvY2tfbm90aWZ5X3Jl
bW92ZSh2b2lkICpob3N0LCBzaXplX3Qgc2l6ZSkKK3ZvaWQgcmFtX2Jsb2NrX25vdGlmeV9yZW1v
dmUodm9pZCAqaG9zdCwgc2l6ZV90IHNpemUsIHNpemVfdCBtYXhfc2l6ZSkKIHsKICAgICBSQU1C
bG9ja05vdGlmaWVyICpub3RpZmllcjsKIAogICAgIFFMSVNUX0ZPUkVBQ0gobm90aWZpZXIsICZy
YW1fbGlzdC5yYW1ibG9ja19ub3RpZmllcnMsIG5leHQpIHsKLSAgICAgICAgbm90aWZpZXItPnJh
bV9ibG9ja19yZW1vdmVkKG5vdGlmaWVyLCBob3N0LCBzaXplKTsKKyAgICAgICAgbm90aWZpZXIt
PnJhbV9ibG9ja19yZW1vdmVkKG5vdGlmaWVyLCBob3N0LCBzaXplLCBtYXhfc2l6ZSk7CisgICAg
fQorfQorCit2b2lkIHJhbV9ibG9ja19ub3RpZnlfcmVzaXplKHZvaWQgKmhvc3QsIHNpemVfdCBv
bGRfc2l6ZSwgc2l6ZV90IG5ld19zaXplKQoreworICAgIFJBTUJsb2NrTm90aWZpZXIgKm5vdGlm
aWVyOworCisgICAgUUxJU1RfRk9SRUFDSChub3RpZmllciwgJnJhbV9saXN0LnJhbWJsb2NrX25v
dGlmaWVycywgbmV4dCkgeworICAgICAgICBpZiAobm90aWZpZXItPnJhbV9ibG9ja19yZXNpemVk
KSB7CisgICAgICAgICAgICBub3RpZmllci0+cmFtX2Jsb2NrX3Jlc2l6ZWQobm90aWZpZXIsIGhv
c3QsIG9sZF9zaXplLCBuZXdfc2l6ZSk7CisgICAgICAgIH0KICAgICB9CiB9CmRpZmYgLS1naXQg
YS9ody9pMzg2L3hlbi94ZW4tbWFwY2FjaGUuYyBiL2h3L2kzODYveGVuL3hlbi1tYXBjYWNoZS5j
CmluZGV4IDViMTIwZWQ0NGIuLmQ2ZGNlYTY1ZDEgMTAwNjQ0Ci0tLSBhL2h3L2kzODYveGVuL3hl
bi1tYXBjYWNoZS5jCisrKyBiL2h3L2kzODYveGVuL3hlbi1tYXBjYWNoZS5jCkBAIC0xNjksNyAr
MTY5LDggQEAgc3RhdGljIHZvaWQgeGVuX3JlbWFwX2J1Y2tldChNYXBDYWNoZUVudHJ5ICplbnRy
eSwKIAogICAgIGlmIChlbnRyeS0+dmFkZHJfYmFzZSAhPSBOVUxMKSB7CiAgICAgICAgIGlmICgh
KGVudHJ5LT5mbGFncyAmIFhFTl9NQVBDQUNIRV9FTlRSWV9EVU1NWSkpIHsKLSAgICAgICAgICAg
IHJhbV9ibG9ja19ub3RpZnlfcmVtb3ZlKGVudHJ5LT52YWRkcl9iYXNlLCBlbnRyeS0+c2l6ZSk7
CisgICAgICAgICAgICByYW1fYmxvY2tfbm90aWZ5X3JlbW92ZShlbnRyeS0+dmFkZHJfYmFzZSwg
ZW50cnktPnNpemUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRyeS0+
c2l6ZSk7CiAgICAgICAgIH0KICAgICAgICAgaWYgKG11bm1hcChlbnRyeS0+dmFkZHJfYmFzZSwg
ZW50cnktPnNpemUpICE9IDApIHsKICAgICAgICAgICAgIHBlcnJvcigidW5tYXAgZmFpbHMiKTsK
QEAgLTIxMSw3ICsyMTIsNyBAQCBzdGF0aWMgdm9pZCB4ZW5fcmVtYXBfYnVja2V0KE1hcENhY2hl
RW50cnkgKmVudHJ5LAogICAgIH0KIAogICAgIGlmICghKGVudHJ5LT5mbGFncyAmIFhFTl9NQVBD
QUNIRV9FTlRSWV9EVU1NWSkpIHsKLSAgICAgICAgcmFtX2Jsb2NrX25vdGlmeV9hZGQodmFkZHJf
YmFzZSwgc2l6ZSk7CisgICAgICAgIHJhbV9ibG9ja19ub3RpZnlfYWRkKHZhZGRyX2Jhc2UsIHNp
emUsIHNpemUpOwogICAgIH0KIAogICAgIGVudHJ5LT52YWRkcl9iYXNlID0gdmFkZHJfYmFzZTsK
QEAgLTQ1Miw3ICs0NTMsNyBAQCBzdGF0aWMgdm9pZCB4ZW5faW52YWxpZGF0ZV9tYXBfY2FjaGVf
ZW50cnlfdW5sb2NrZWQodWludDhfdCAqYnVmZmVyKQogICAgIH0KIAogICAgIHBlbnRyeS0+bmV4
dCA9IGVudHJ5LT5uZXh0OwotICAgIHJhbV9ibG9ja19ub3RpZnlfcmVtb3ZlKGVudHJ5LT52YWRk
cl9iYXNlLCBlbnRyeS0+c2l6ZSk7CisgICAgcmFtX2Jsb2NrX25vdGlmeV9yZW1vdmUoZW50cnkt
PnZhZGRyX2Jhc2UsIGVudHJ5LT5zaXplLCBlbnRyeS0+c2l6ZSk7CiAgICAgaWYgKG11bm1hcChl
bnRyeS0+dmFkZHJfYmFzZSwgZW50cnktPnNpemUpICE9IDApIHsKICAgICAgICAgcGVycm9yKCJ1
bm1hcCBmYWlscyIpOwogICAgICAgICBleGl0KC0xKTsKZGlmZiAtLWdpdCBhL2luY2x1ZGUvZXhl
Yy9yYW1saXN0LmggYi9pbmNsdWRlL2V4ZWMvcmFtbGlzdC5oCmluZGV4IGJjNGZhYTFiMDAuLjI5
M2MwZGRhYmUgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvZXhlYy9yYW1saXN0LmgKKysrIGIvaW5jbHVk
ZS9leGVjL3JhbWxpc3QuaApAQCAtNjUsMTUgKzY1LDIwIEBAIHZvaWQgcWVtdV9tdXRleF9sb2Nr
X3JhbWxpc3Qodm9pZCk7CiB2b2lkIHFlbXVfbXV0ZXhfdW5sb2NrX3JhbWxpc3Qodm9pZCk7CiAK
IHN0cnVjdCBSQU1CbG9ja05vdGlmaWVyIHsKLSAgICB2b2lkICgqcmFtX2Jsb2NrX2FkZGVkKShS
QU1CbG9ja05vdGlmaWVyICpuLCB2b2lkICpob3N0LCBzaXplX3Qgc2l6ZSk7Ci0gICAgdm9pZCAo
KnJhbV9ibG9ja19yZW1vdmVkKShSQU1CbG9ja05vdGlmaWVyICpuLCB2b2lkICpob3N0LCBzaXpl
X3Qgc2l6ZSk7CisgICAgdm9pZCAoKnJhbV9ibG9ja19hZGRlZCkoUkFNQmxvY2tOb3RpZmllciAq
biwgdm9pZCAqaG9zdCwgc2l6ZV90IHNpemUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
c2l6ZV90IG1heF9zaXplKTsKKyAgICB2b2lkICgqcmFtX2Jsb2NrX3JlbW92ZWQpKFJBTUJsb2Nr
Tm90aWZpZXIgKm4sIHZvaWQgKmhvc3QsIHNpemVfdCBzaXplLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgc2l6ZV90IG1heF9zaXplKTsKKyAgICB2b2lkICgqcmFtX2Jsb2NrX3Jlc2l6
ZWQpKFJBTUJsb2NrTm90aWZpZXIgKm4sIHZvaWQgKmhvc3QsIHNpemVfdCBvbGRfc2l6ZSwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemVfdCBuZXdfc2l6ZSk7CiAgICAgUUxJU1Rf
RU5UUlkoUkFNQmxvY2tOb3RpZmllcikgbmV4dDsKIH07CiAKIHZvaWQgcmFtX2Jsb2NrX25vdGlm
aWVyX2FkZChSQU1CbG9ja05vdGlmaWVyICpuKTsKIHZvaWQgcmFtX2Jsb2NrX25vdGlmaWVyX3Jl
bW92ZShSQU1CbG9ja05vdGlmaWVyICpuKTsKLXZvaWQgcmFtX2Jsb2NrX25vdGlmeV9hZGQodm9p
ZCAqaG9zdCwgc2l6ZV90IHNpemUpOwotdm9pZCByYW1fYmxvY2tfbm90aWZ5X3JlbW92ZSh2b2lk
ICpob3N0LCBzaXplX3Qgc2l6ZSk7Cit2b2lkIHJhbV9ibG9ja19ub3RpZnlfYWRkKHZvaWQgKmhv
c3QsIHNpemVfdCBzaXplLCBzaXplX3QgbWF4X3NpemUpOwordm9pZCByYW1fYmxvY2tfbm90aWZ5
X3JlbW92ZSh2b2lkICpob3N0LCBzaXplX3Qgc2l6ZSwgc2l6ZV90IG1heF9zaXplKTsKK3ZvaWQg
cmFtX2Jsb2NrX25vdGlmeV9yZXNpemUodm9pZCAqaG9zdCwgc2l6ZV90IG9sZF9zaXplLCBzaXpl
X3QgbmV3X3NpemUpOwogCiB2b2lkIHJhbV9ibG9ja19kdW1wKE1vbml0b3IgKm1vbik7CiAKZGlm
ZiAtLWdpdCBhL3RhcmdldC9pMzg2L2hheC1tZW0uYyBiL3RhcmdldC9pMzg2L2hheC1tZW0uYwpp
bmRleCA2YmI1YTI0OTE3Li40NTRkN2ZiMjEyIDEwMDY0NAotLS0gYS90YXJnZXQvaTM4Ni9oYXgt
bWVtLmMKKysrIGIvdGFyZ2V0L2kzODYvaGF4LW1lbS5jCkBAIC0yOTMsNyArMjkzLDggQEAgc3Rh
dGljIE1lbW9yeUxpc3RlbmVyIGhheF9tZW1vcnlfbGlzdGVuZXIgPSB7CiAgICAgLnByaW9yaXR5
ID0gMTAsCiB9OwogCi1zdGF0aWMgdm9pZCBoYXhfcmFtX2Jsb2NrX2FkZGVkKFJBTUJsb2NrTm90
aWZpZXIgKm4sIHZvaWQgKmhvc3QsIHNpemVfdCBzaXplKQorc3RhdGljIHZvaWQgaGF4X3JhbV9i
bG9ja19hZGRlZChSQU1CbG9ja05vdGlmaWVyICpuLCB2b2lkICpob3N0LCBzaXplX3Qgc2l6ZSwK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZV90IG1heF9zaXplKQogewogICAg
IC8qCiAgICAgICogV2UgbXVzdCByZWdpc3RlciBlYWNoIFJBTSBibG9jayB3aXRoIHRoZSBIQVhN
IGtlcm5lbCBtb2R1bGUsIG9yCkBAIC0zMDQsNyArMzA1LDcgQEAgc3RhdGljIHZvaWQgaGF4X3Jh
bV9ibG9ja19hZGRlZChSQU1CbG9ja05vdGlmaWVyICpuLCB2b2lkICpob3N0LCBzaXplX3Qgc2l6
ZSkKICAgICAgKiBob3N0IHBoeXNpY2FsIHBhZ2VzIGZvciB0aGUgUkFNIGJsb2NrIGFzIHBhcnQg
b2YgdGhpcyByZWdpc3RyYXRpb24KICAgICAgKiBwcm9jZXNzLCBoZW5jZSB0aGUgbmFtZSBoYXhf
cG9wdWxhdGVfcmFtKCkuCiAgICAgICovCi0gICAgaWYgKGhheF9wb3B1bGF0ZV9yYW0oKHVpbnQ2
NF90KSh1aW50cHRyX3QpaG9zdCwgc2l6ZSkgPCAwKSB7CisgICAgaWYgKGhheF9wb3B1bGF0ZV9y
YW0oKHVpbnQ2NF90KSh1aW50cHRyX3QpaG9zdCwgbWF4X3NpemUpIDwgMCkgewogICAgICAgICBm
cHJpbnRmKHN0ZGVyciwgIkhBWCBmYWlsZWQgdG8gcG9wdWxhdGUgUkFNXG4iKTsKICAgICAgICAg
YWJvcnQoKTsKICAgICB9CmRpZmYgLS1naXQgYS90YXJnZXQvaTM4Ni9zZXYuYyBiL3RhcmdldC9p
Mzg2L3Nldi5jCmluZGV4IDAyNGJiMjRlNTEuLjZiNGNlZTI0YTIgMTAwNjQ0Ci0tLSBhL3Rhcmdl
dC9pMzg2L3Nldi5jCisrKyBiL3RhcmdldC9pMzg2L3Nldi5jCkBAIC0xMjksNyArMTI5LDggQEAg
c2V2X3NldF9ndWVzdF9zdGF0ZShTZXZTdGF0ZSBuZXdfc3RhdGUpCiB9CiAKIHN0YXRpYyB2b2lk
Ci1zZXZfcmFtX2Jsb2NrX2FkZGVkKFJBTUJsb2NrTm90aWZpZXIgKm4sIHZvaWQgKmhvc3QsIHNp
emVfdCBzaXplKQorc2V2X3JhbV9ibG9ja19hZGRlZChSQU1CbG9ja05vdGlmaWVyICpuLCB2b2lk
ICpob3N0LCBzaXplX3Qgc2l6ZSwKKyAgICAgICAgICAgICAgICAgICAgc2l6ZV90IG1heF9zaXpl
KQogewogICAgIGludCByOwogICAgIHN0cnVjdCBrdm1fZW5jX3JlZ2lvbiByYW5nZTsKQEAgLTE0
NiwxOSArMTQ3LDIwIEBAIHNldl9yYW1fYmxvY2tfYWRkZWQoUkFNQmxvY2tOb3RpZmllciAqbiwg
dm9pZCAqaG9zdCwgc2l6ZV90IHNpemUpCiAgICAgfQogCiAgICAgcmFuZ2UuYWRkciA9IChfX3U2
NCkodW5zaWduZWQgbG9uZylob3N0OwotICAgIHJhbmdlLnNpemUgPSBzaXplOworICAgIHJhbmdl
LnNpemUgPSBtYXhfc2l6ZTsKIAotICAgIHRyYWNlX2t2bV9tZW1jcnlwdF9yZWdpc3Rlcl9yZWdp
b24oaG9zdCwgc2l6ZSk7CisgICAgdHJhY2Vfa3ZtX21lbWNyeXB0X3JlZ2lzdGVyX3JlZ2lvbiho
b3N0LCBtYXhfc2l6ZSk7CiAgICAgciA9IGt2bV92bV9pb2N0bChrdm1fc3RhdGUsIEtWTV9NRU1P
UllfRU5DUllQVF9SRUdfUkVHSU9OLCAmcmFuZ2UpOwogICAgIGlmIChyKSB7CiAgICAgICAgIGVy
cm9yX3JlcG9ydCgiJXM6IGZhaWxlZCB0byByZWdpc3RlciByZWdpb24gKCVwKyUjengpIGVycm9y
ICclcyciLAotICAgICAgICAgICAgICAgICAgICAgX19mdW5jX18sIGhvc3QsIHNpemUsIHN0cmVy
cm9yKGVycm5vKSk7CisgICAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgaG9zdCwgbWF4X3Np
emUsIHN0cmVycm9yKGVycm5vKSk7CiAgICAgICAgIGV4aXQoMSk7CiAgICAgfQogfQogCiBzdGF0
aWMgdm9pZAotc2V2X3JhbV9ibG9ja19yZW1vdmVkKFJBTUJsb2NrTm90aWZpZXIgKm4sIHZvaWQg
Kmhvc3QsIHNpemVfdCBzaXplKQorc2V2X3JhbV9ibG9ja19yZW1vdmVkKFJBTUJsb2NrTm90aWZp
ZXIgKm4sIHZvaWQgKmhvc3QsIHNpemVfdCBzaXplLAorICAgICAgICAgICAgICAgICAgICAgIHNp
emVfdCBtYXhfc2l6ZSkKIHsKICAgICBpbnQgcjsKICAgICBzdHJ1Y3Qga3ZtX2VuY19yZWdpb24g
cmFuZ2U7CkBAIC0xNzUsMTMgKzE3NywxMyBAQCBzZXZfcmFtX2Jsb2NrX3JlbW92ZWQoUkFNQmxv
Y2tOb3RpZmllciAqbiwgdm9pZCAqaG9zdCwgc2l6ZV90IHNpemUpCiAgICAgfQogCiAgICAgcmFu
Z2UuYWRkciA9IChfX3U2NCkodW5zaWduZWQgbG9uZylob3N0OwotICAgIHJhbmdlLnNpemUgPSBz
aXplOworICAgIHJhbmdlLnNpemUgPSBtYXhfc2l6ZTsKIAotICAgIHRyYWNlX2t2bV9tZW1jcnlw
dF91bnJlZ2lzdGVyX3JlZ2lvbihob3N0LCBzaXplKTsKKyAgICB0cmFjZV9rdm1fbWVtY3J5cHRf
dW5yZWdpc3Rlcl9yZWdpb24oaG9zdCwgbWF4X3NpemUpOwogICAgIHIgPSBrdm1fdm1faW9jdGwo
a3ZtX3N0YXRlLCBLVk1fTUVNT1JZX0VOQ1JZUFRfVU5SRUdfUkVHSU9OLCAmcmFuZ2UpOwogICAg
IGlmIChyKSB7CiAgICAgICAgIGVycm9yX3JlcG9ydCgiJXM6IGZhaWxlZCB0byB1bnJlZ2lzdGVy
IHJlZ2lvbiAoJXArJSN6eCkiLAotICAgICAgICAgICAgICAgICAgICAgX19mdW5jX18sIGhvc3Qs
IHNpemUpOworICAgICAgICAgICAgICAgICAgICAgX19mdW5jX18sIGhvc3QsIG1heF9zaXplKTsK
ICAgICB9CiB9CiAKZGlmZiAtLWdpdCBhL3V0aWwvdmZpby1oZWxwZXJzLmMgYi91dGlsL3ZmaW8t
aGVscGVycy5jCmluZGV4IDI2MDU3MGFlMTkuLjllYzAxYmZlMjYgMTAwNjQ0Ci0tLSBhL3V0aWwv
dmZpby1oZWxwZXJzLmMKKysrIGIvdXRpbC92ZmlvLWhlbHBlcnMuYwpAQCAtMzcyLDI2ICszNzIs
MjYgQEAgZmFpbF9jb250YWluZXI6CiAgICAgcmV0dXJuIHJldDsKIH0KIAotc3RhdGljIHZvaWQg
cWVtdV92ZmlvX3JhbV9ibG9ja19hZGRlZChSQU1CbG9ja05vdGlmaWVyICpuLAotICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkICpob3N0LCBzaXplX3Qgc2l6ZSkKK3N0
YXRpYyB2b2lkIHFlbXVfdmZpb19yYW1fYmxvY2tfYWRkZWQoUkFNQmxvY2tOb3RpZmllciAqbiwg
dm9pZCAqaG9zdCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZV90
IHNpemUsIHNpemVfdCBtYXhfc2l6ZSkKIHsKICAgICBRRU1VVkZJT1N0YXRlICpzID0gY29udGFp
bmVyX29mKG4sIFFFTVVWRklPU3RhdGUsIHJhbV9ub3RpZmllcik7CiAgICAgaW50IHJldDsKIAot
ICAgIHRyYWNlX3FlbXVfdmZpb19yYW1fYmxvY2tfYWRkZWQocywgaG9zdCwgc2l6ZSk7Ci0gICAg
cmV0ID0gcWVtdV92ZmlvX2RtYV9tYXAocywgaG9zdCwgc2l6ZSwgZmFsc2UsIE5VTEwpOworICAg
IHRyYWNlX3FlbXVfdmZpb19yYW1fYmxvY2tfYWRkZWQocywgaG9zdCwgbWF4X3NpemUpOworICAg
IHJldCA9IHFlbXVfdmZpb19kbWFfbWFwKHMsIGhvc3QsIG1heF9zaXplLCBmYWxzZSwgTlVMTCk7
CiAgICAgaWYgKHJldCkgewotICAgICAgICBlcnJvcl9yZXBvcnQoInFlbXVfdmZpb19kbWFfbWFw
KCVwLCAlenUpIGZhaWxlZDogJXMiLCBob3N0LCBzaXplLAorICAgICAgICBlcnJvcl9yZXBvcnQo
InFlbXVfdmZpb19kbWFfbWFwKCVwLCAlenUpIGZhaWxlZDogJXMiLCBob3N0LCBtYXhfc2l6ZSwK
ICAgICAgICAgICAgICAgICAgICAgIHN0cmVycm9yKC1yZXQpKTsKICAgICB9CiB9CiAKLXN0YXRp
YyB2b2lkIHFlbXVfdmZpb19yYW1fYmxvY2tfcmVtb3ZlZChSQU1CbG9ja05vdGlmaWVyICpuLAot
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgKmhvc3QsIHNpemVf
dCBzaXplKQorc3RhdGljIHZvaWQgcWVtdV92ZmlvX3JhbV9ibG9ja19yZW1vdmVkKFJBTUJsb2Nr
Tm90aWZpZXIgKm4sIHZvaWQgKmhvc3QsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgc2l6ZV90IHNpemUsIHNpemVfdCBtYXhfc2l6ZSkKIHsKICAgICBRRU1VVkZJT1N0
YXRlICpzID0gY29udGFpbmVyX29mKG4sIFFFTVVWRklPU3RhdGUsIHJhbV9ub3RpZmllcik7CiAg
ICAgaWYgKGhvc3QpIHsKLSAgICAgICAgdHJhY2VfcWVtdV92ZmlvX3JhbV9ibG9ja19yZW1vdmVk
KHMsIGhvc3QsIHNpemUpOworICAgICAgICB0cmFjZV9xZW11X3ZmaW9fcmFtX2Jsb2NrX3JlbW92
ZWQocywgaG9zdCwgbWF4X3NpemUpOwogICAgICAgICBxZW11X3ZmaW9fZG1hX3VubWFwKHMsIGhv
c3QpOwogICAgIH0KIH0KLS0gCjIuMjQuMQoKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3Rz
LnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0
aW5mby94ZW4tZGV2ZWw=

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 89B2BFCB00
	for <lists+xen-devel@lfdr.de>; Thu, 14 Nov 2019 17:46:28 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iVIDa-0005D3-Az; Thu, 14 Nov 2019 16:43:38 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=H8L6=ZG=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1iVIDZ-0005Cu-O5
 for xen-devel@lists.xenproject.org; Thu, 14 Nov 2019 16:43:37 +0000
X-Inumbo-ID: e6e93c8a-06fd-11ea-b678-bc764e2007e4
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id e6e93c8a-06fd-11ea-b678-bc764e2007e4;
 Thu, 14 Nov 2019 16:43:36 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 80BADACC0;
 Thu, 14 Nov 2019 16:43:35 +0000 (UTC)
From: Jan Beulich <jbeulich@suse.com>
To: "xen-devel@lists.xenproject.org" <xen-devel@lists.xenproject.org>
References: <8e8866de-33a8-68c0-3352-d6dfeec4a9b6@suse.com>
Message-ID: <f2232cd2-4786-2b8e-d649-0635309edb92@suse.com>
Date: Thu, 14 Nov 2019 17:43:51 +0100
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:60.0) Gecko/20100101
 Thunderbird/60.9.1
MIME-Version: 1.0
In-Reply-To: <8e8866de-33a8-68c0-3352-d6dfeec4a9b6@suse.com>
Content-Language: en-US
Subject: [Xen-devel] [PATCH v2 1/2] introduce GFN notification for
 translated domains
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Julien Grall <julien@xen.org>,
 Wei Liu <wl@xen.org>, Konrad Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Sander Eikelenboom <linux@eikelenboom.it>,
 Ian Jackson <ian.jackson@citrix.com>,
 =?UTF-8?Q?Roger_Pau_Monn=c3=a9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SW4gb3JkZXIgZm9yIGluZGl2aWR1YWwgSU9NTVUgZHJpdmVycyAoYW5kIGZyb20gYW4gYWJzdHJh
Y3QgcG92IGFsc28KYXJjaGl0ZWN0dXJlcykgdG8gYmUgYWJsZSB0byBhZGp1c3QsIGFoZWFkIG9m
IGFjdHVhbCBtYXBwaW5nIHJlcXVlc3RzLAp0aGVpciBkYXRhIHN0cnVjdHVyZXMgd2hlbiB0aGV5
IG1pZ2h0IGNvdmVyIG9ubHkgYSBzdWItcmFuZ2Ugb2YgYWxsCnBvc3NpYmxlIEdGTnMsIGludHJv
ZHVjZSBhIG5vdGlmaWNhdGlvbiBjYWxsIHVzZWQgYnkgdmFyaW91cyBjb2RlIHBhdGhzCnBvdGVu
dGlhbGx5IGluc3RhbGxpbmcgYSBmcmVzaCBtYXBwaW5nIG9mIGEgbmV2ZXIgdXNlZCBHRk4gKGZv
ciBhCnBhcnRpY3VsYXIgZG9tYWluKS4KCk5vdGUgdGhhdCBiZWZvcmUgdGhpcyBwYXRjaCwgaW4g
Z250dGFiX3RyYW5zZmVyKCksIG9uY2UgcGFzdAphc3NpZ25fcGFnZXMoKSwgZnVydGhlciBlcnJv
cnMgbW9kaWZ5aW5nIHRoZSBwaHlzbWFwIGFyZSBpZ25vcmVkCihwcmVzdW1hYmx5IGJlY2F1c2Ug
aXQgd291bGQgYmUgdG9vIGNvbXBsaWNhdGVkIHRvIHRyeSB0byByb2xsIGJhY2sgYXQKdGhhdCBw
b2ludCkuIFRoaXMgcGF0Y2ggZm9sbG93cyBzdWl0IGJ5IGlnbm9yaW5nIGZhaWxlZCBub3RpZnlf
Z2ZuKClzIG9yCnJhY2VzIGR1ZSB0byB0aGUgbmVlZCB0byBpbnRlcm1lZGlhdGVseSBkcm9wIGxv
Y2tzLCBzaW1wbHkgcHJpbnRpbmcgb3V0CmEgd2FybmluZyB0aGF0IHRoZSBnZm4gbWF5IG5vdCBi
ZSBhY2Nlc3NpYmxlIGR1ZSB0byB0aGUgZmFpbHVyZS4KClNpZ25lZC1vZmYtYnk6IEphbiBCZXVs
aWNoIDxqYmV1bGljaEBzdXNlLmNvbT4KLS0tCnYyOiBJbnRyb2R1Y2UgYXJjaF9ub3RpZnlfZ2Zu
KCksIHRvIGludm9rZSBnZm5fdmFsaWQoKSBvbiB4ODYgKHRoaXMKICAgIHVuZm9ydHVuYXRlbHkg
bWVhbnMgaXQgYW5kIG5vdGlmeV9nZm4oKSBub3cgbmVlZCB0byBiZSBtYWNyb3MsIG9yCiAgICBl
bHNlIGluY2x1ZGUgZmlsZSBkZXBlbmRlbmNpZXMgZ2V0IGluIHRoZSB3YXksIGFzIGdmbl92YWxp
ZCgpIGxpdmVzCiAgICBpbiBwYWdpbmcuaCwgd2hpY2ggd2Ugc2hvdWxkbid0IGluY2x1ZGUgZnJv
bSB4ZW4vc2NoZWQuaCkuIEltcHJvdmUKICAgIGRlc2NyaXB0aW9uLgoKVEJEOiBEb2VzIEFybSBh
Y3R1YWxseSBoYXZlIGFueXRoaW5nIHRvIGNoZWNrIGFnYWluc3QgaW4gaXRzCiAgICAgYXJjaF9u
b3RpZnlfZ2ZuKCk/CgotLS0gYS94ZW4vYXJjaC94ODYvaHZtL2RvbTBfYnVpbGQuYworKysgYi94
ZW4vYXJjaC94ODYvaHZtL2RvbTBfYnVpbGQuYwpAQCAtMTczLDcgKzE3Myw4IEBAIHN0YXRpYyBp
bnQgX19pbml0IHB2aF9wb3B1bGF0ZV9tZW1vcnlfcmEKICAgICAgICAgICAgIGNvbnRpbnVlOwog
ICAgICAgICB9CiAKLSAgICAgICAgcmMgPSBndWVzdF9waHlzbWFwX2FkZF9wYWdlKGQsIF9nZm4o
c3RhcnQpLCBwYWdlX3RvX21mbihwYWdlKSwKKyAgICAgICAgcmMgPSBub3RpZnlfZ2ZuKGQsIF9n
Zm4oc3RhcnQgKyAoMVVMIDw8IG9yZGVyKSAtIDEpKSA/OgorICAgICAgICAgICAgIGd1ZXN0X3Bo
eXNtYXBfYWRkX3BhZ2UoZCwgX2dmbihzdGFydCksIHBhZ2VfdG9fbWZuKHBhZ2UpLAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JkZXIpOwogICAgICAgICBpZiAoIHJjICE9
IDAgKQogICAgICAgICB7Ci0tLSBhL3hlbi9hcmNoL3g4Ni9odm0vaHZtLmMKKysrIGIveGVuL2Fy
Y2gveDg2L2h2bS9odm0uYwpAQCAtNDMwNCw5ICs0MzA0LDE3IEBAIHN0YXRpYyBpbnQgaHZtb3Bf
c2V0X3BhcmFtKAogICAgICAgICBpZiAoIGEudmFsdWUgPiBTSFVURE9XTl9NQVggKQogICAgICAg
ICAgICAgcmMgPSAtRUlOVkFMOwogICAgICAgICBicmVhazsKKwogICAgIGNhc2UgSFZNX1BBUkFN
X0lPUkVRX1NFUlZFUl9QRk46Ci0gICAgICAgIGQtPmFyY2guaHZtLmlvcmVxX2dmbi5iYXNlID0g
YS52YWx1ZTsKKyAgICAgICAgaWYgKCBkLT5hcmNoLmh2bS5wYXJhbXNbSFZNX1BBUkFNX05SX0lP
UkVRX1NFUlZFUl9QQUdFU10gKQorICAgICAgICAgICAgcmMgPSBub3RpZnlfZ2ZuKAorICAgICAg
ICAgICAgICAgICAgICAgZCwKKyAgICAgICAgICAgICAgICAgICAgIF9nZm4oYS52YWx1ZSArIGQt
PmFyY2guaHZtLnBhcmFtcworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW0hW
TV9QQVJBTV9OUl9JT1JFUV9TRVJWRVJfUEFHRVNdIC0gMSkpOworICAgICAgICBpZiAoICFyYyAp
CisgICAgICAgICAgICAgZC0+YXJjaC5odm0uaW9yZXFfZ2ZuLmJhc2UgPSBhLnZhbHVlOwogICAg
ICAgICBicmVhazsKKwogICAgIGNhc2UgSFZNX1BBUkFNX05SX0lPUkVRX1NFUlZFUl9QQUdFUzoK
ICAgICB7CiAgICAgICAgIHVuc2lnbmVkIGludCBpOwpAQCAtNDMxNyw2ICs0MzI1LDkgQEAgc3Rh
dGljIGludCBodm1vcF9zZXRfcGFyYW0oCiAgICAgICAgICAgICByYyA9IC1FSU5WQUw7CiAgICAg
ICAgICAgICBicmVhazsKICAgICAgICAgfQorICAgICAgICByYyA9IG5vdGlmeV9nZm4oZCwgX2dm
bihkLT5hcmNoLmh2bS5pb3JlcV9nZm4uYmFzZSArIGEudmFsdWUgLSAxKSk7CisgICAgICAgIGlm
ICggcmMgKQorICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgIGZvciAoIGkgPSAwOyBpIDwgYS52
YWx1ZTsgaSsrICkKICAgICAgICAgICAgIHNldF9iaXQoaSwgJmQtPmFyY2guaHZtLmlvcmVxX2dm
bi5tYXNrKTsKIApAQCAtNDMzMCw3ICs0MzQxLDExIEBAIHN0YXRpYyBpbnQgaHZtb3Bfc2V0X3Bh
cmFtKAogICAgICAgICBCVUlMRF9CVUdfT04oSFZNX1BBUkFNX0JVRklPUkVRX1BGTiA+CiAgICAg
ICAgICAgICAgICAgICAgICBzaXplb2YoZC0+YXJjaC5odm0uaW9yZXFfZ2ZuLmxlZ2FjeV9tYXNr
KSAqIDgpOwogICAgICAgICBpZiAoIGEudmFsdWUgKQotICAgICAgICAgICAgc2V0X2JpdChhLmlu
ZGV4LCAmZC0+YXJjaC5odm0uaW9yZXFfZ2ZuLmxlZ2FjeV9tYXNrKTsKKyAgICAgICAgeworICAg
ICAgICAgICAgcmMgPSBub3RpZnlfZ2ZuKGQsIF9nZm4oYS52YWx1ZSkpOworICAgICAgICAgICAg
aWYgKCAhcmMgKQorICAgICAgICAgICAgICAgIHNldF9iaXQoYS5pbmRleCwgJmQtPmFyY2guaHZt
LmlvcmVxX2dmbi5sZWdhY3lfbWFzayk7CisgICAgICAgIH0KICAgICAgICAgYnJlYWs7CiAKICAg
ICBjYXNlIEhWTV9QQVJBTV9YODdfRklQX1dJRFRIOgotLS0gYS94ZW4vY29tbW9uL2dyYW50X3Rh
YmxlLmMKKysrIGIveGVuL2NvbW1vbi9ncmFudF90YWJsZS5jCkBAIC05NDYsNiArOTQ2LDE2IEBA
IG1hcF9ncmFudF9yZWYoCiAgICAgICAgIHJldHVybjsKICAgICB9CiAKKyAgICBpZiAoIHBhZ2lu
Z19tb2RlX3RyYW5zbGF0ZShsZCkgLyogJiYgKG9wLT5mbGFncyAmIEdOVE1BUF9ob3N0X21hcCkg
Ki8gJiYKKyAgICAgICAgIChyYyA9IG5vdGlmeV9nZm4obGQsIGdhZGRyX3RvX2dmbihvcC0+aG9z
dF9hZGRyKSkpICkKKyAgICB7CisgICAgICAgIGdkcHJpbnRrKFhFTkxPR19JTkZPLCAibm90aWZ5
KCUiUFJJX2dmbiIpIC0+ICVkXG4iLAorICAgICAgICAgICAgICAgICBnZm5feChnYWRkcl90b19n
Zm4ob3AtPmhvc3RfYWRkcikpLCByYyk7CisgICAgICAgIG9wLT5zdGF0dXMgPSBHTlRTVF9nZW5l
cmFsX2Vycm9yOworICAgICAgICByZXR1cm47CisgICAgICAgIEJVSUxEX0JVR19PTihHTlRTVF9v
a2F5KTsKKyAgICB9CisKICAgICBpZiAoIHVubGlrZWx5KChyZCA9IHJjdV9sb2NrX2RvbWFpbl9i
eV9pZChvcC0+ZG9tKSkgPT0gTlVMTCkgKQogICAgIHsKICAgICAgICAgZ2RwcmludGsoWEVOTE9H
X0lORk8sICJDb3VsZCBub3QgZmluZCBkb21haW4gJWRcbiIsIG9wLT5kb20pOwpAQCAtMjEyMyw2
ICsyMTMzLDcgQEAgZ250dGFiX3RyYW5zZmVyKAogICAgIHsKICAgICAgICAgYm9vbF90IG9rYXk7
CiAgICAgICAgIGludCByYzsKKyAgICAgICAgZ2ZuX3QgZ2ZuOwogCiAgICAgICAgIGlmICggaSAm
JiBoeXBlcmNhbGxfcHJlZW1wdF9jaGVjaygpICkKICAgICAgICAgICAgIHJldHVybiBpOwpAQCAt
MjMwMCwyMSArMjMxMSw1MiBAQCBnbnR0YWJfdHJhbnNmZXIoCiAgICAgICAgIGFjdCA9IGFjdGl2
ZV9lbnRyeV9hY3F1aXJlKGUtPmdyYW50X3RhYmxlLCBnb3AucmVmKTsKIAogICAgICAgICBpZiAo
IGV2YWx1YXRlX25vc3BlYyhlLT5ncmFudF90YWJsZS0+Z3RfdmVyc2lvbiA9PSAxKSApCisgICAg
ICAgICAgICBnZm4gPSBfZ2ZuKHNoYXJlZF9lbnRyeV92MShlLT5ncmFudF90YWJsZSwgZ29wLnJl
ZikuZnJhbWUpOworICAgICAgICBlbHNlCisgICAgICAgICAgICBnZm4gPSBfZ2ZuKHNoYXJlZF9l
bnRyeV92MihlLT5ncmFudF90YWJsZSwgZ29wLnJlZikuZnVsbF9wYWdlLmZyYW1lKTsKKworICAg
ICAgICBpZiAoIHBhZ2luZ19tb2RlX3RyYW5zbGF0ZShlKSApCiAgICAgICAgIHsKLSAgICAgICAg
ICAgIGdyYW50X2VudHJ5X3YxX3QgKnNoYSA9ICZzaGFyZWRfZW50cnlfdjEoZS0+Z3JhbnRfdGFi
bGUsIGdvcC5yZWYpOworICAgICAgICAgICAgZ2ZuX3QgZ2ZuMjsKKworICAgICAgICAgICAgYWN0
aXZlX2VudHJ5X3JlbGVhc2UoYWN0KTsKKyAgICAgICAgICAgIGdyYW50X3JlYWRfdW5sb2NrKGUt
PmdyYW50X3RhYmxlKTsKKworICAgICAgICAgICAgcmMgPSBub3RpZnlfZ2ZuKGUsIGdmbik7Cisg
ICAgICAgICAgICBpZiAoIHJjICkKKyAgICAgICAgICAgICAgICBwcmludGsoWEVOTE9HX0dfV0FS
TklORworICAgICAgICAgICAgICAgICAgICAgICAiJXBkOiBncmVmICV1OiB4ZmVyIEdGTiAlIlBS
SV9nZm4iIG1heSBiZSBpbmFjY2Vzc2libGUgKCVkKVxuIiwKKyAgICAgICAgICAgICAgICAgICAg
ICAgZSwgZ29wLnJlZiwgZ2ZuX3goZ2ZuKSwgcmMpOworCisgICAgICAgICAgICBncmFudF9yZWFk
X2xvY2soZS0+Z3JhbnRfdGFibGUpOworICAgICAgICAgICAgYWN0ID0gYWN0aXZlX2VudHJ5X2Fj
cXVpcmUoZS0+Z3JhbnRfdGFibGUsIGdvcC5yZWYpOwogCi0gICAgICAgICAgICBndWVzdF9waHlz
bWFwX2FkZF9wYWdlKGUsIF9nZm4oc2hhLT5mcmFtZSksIG1mbiwgMCk7Ci0gICAgICAgICAgICBp
ZiAoICFwYWdpbmdfbW9kZV90cmFuc2xhdGUoZSkgKQotICAgICAgICAgICAgICAgIHNoYS0+ZnJh
bWUgPSBtZm5feChtZm4pOworICAgICAgICAgICAgaWYgKCBldmFsdWF0ZV9ub3NwZWMoZS0+Z3Jh
bnRfdGFibGUtPmd0X3ZlcnNpb24gPT0gMSkgKQorICAgICAgICAgICAgICAgIGdmbjIgPSBfZ2Zu
KHNoYXJlZF9lbnRyeV92MShlLT5ncmFudF90YWJsZSwgZ29wLnJlZikuZnJhbWUpOworICAgICAg
ICAgICAgZWxzZQorICAgICAgICAgICAgICAgIGdmbjIgPSBfZ2ZuKHNoYXJlZF9lbnRyeV92Mihl
LT5ncmFudF90YWJsZSwgZ29wLnJlZikuCisgICAgICAgICAgICAgICAgICAgIGZ1bGxfcGFnZS5m
cmFtZSk7CisKKyAgICAgICAgICAgIGlmICggIWdmbl9lcShnZm4sIGdmbjIpICkKKyAgICAgICAg
ICAgIHsKKyAgICAgICAgICAgICAgICBwcmludGsoWEVOTE9HX0dfV0FSTklORworICAgICAgICAg
ICAgICAgICAgICAgICAiJXBkOiBncmVmICV1OiB4ZmVyIEdGTiB3ZW50ICUiUFJJX2dmbiIgLT4g
JSJQUklfZ2ZuIlxuIiwKKyAgICAgICAgICAgICAgICAgICAgICAgZSwgZ29wLnJlZiwgZ2ZuX3go
Z2ZuKSwgZ2ZuX3goZ2ZuMikpOworICAgICAgICAgICAgICAgIGdmbiA9IGdmbjI7CisgICAgICAg
ICAgICB9CiAgICAgICAgIH0KLSAgICAgICAgZWxzZQotICAgICAgICB7Ci0gICAgICAgICAgICBn
cmFudF9lbnRyeV92Ml90ICpzaGEgPSAmc2hhcmVkX2VudHJ5X3YyKGUtPmdyYW50X3RhYmxlLCBn
b3AucmVmKTsKIAotICAgICAgICAgICAgZ3Vlc3RfcGh5c21hcF9hZGRfcGFnZShlLCBfZ2ZuKHNo
YS0+ZnVsbF9wYWdlLmZyYW1lKSwgbWZuLCAwKTsKLSAgICAgICAgICAgIGlmICggIXBhZ2luZ19t
b2RlX3RyYW5zbGF0ZShlKSApCi0gICAgICAgICAgICAgICAgc2hhLT5mdWxsX3BhZ2UuZnJhbWUg
PSBtZm5feChtZm4pOworICAgICAgICBndWVzdF9waHlzbWFwX2FkZF9wYWdlKGUsIGdmbiwgbWZu
LCAwKTsKKworICAgICAgICBpZiAoICFwYWdpbmdfbW9kZV90cmFuc2xhdGUoZSkgKQorICAgICAg
ICB7CisgICAgICAgICAgICBpZiAoIGV2YWx1YXRlX25vc3BlYyhlLT5ncmFudF90YWJsZS0+Z3Rf
dmVyc2lvbiA9PSAxKSApCisgICAgICAgICAgICAgICAgc2hhcmVkX2VudHJ5X3YxKGUtPmdyYW50
X3RhYmxlLCBnb3AucmVmKS5mcmFtZSA9IG1mbl94KG1mbik7CisgICAgICAgICAgICBlbHNlCisg
ICAgICAgICAgICAgICAgc2hhcmVkX2VudHJ5X3YyKGUtPmdyYW50X3RhYmxlLCBnb3AucmVmKS5m
dWxsX3BhZ2UuZnJhbWUgPQorICAgICAgICAgICAgICAgICAgICBtZm5feChtZm4pOwogICAgICAg
ICB9CisKICAgICAgICAgc21wX3dtYigpOwogICAgICAgICBzaGFyZWRfZW50cnlfaGVhZGVyKGUt
PmdyYW50X3RhYmxlLCBnb3AucmVmKS0+ZmxhZ3MgfD0KICAgICAgICAgICAgIEdURl90cmFuc2Zl
cl9jb21wbGV0ZWQ7Ci0tLSBhL3hlbi9jb21tb24vbWVtb3J5LmMKKysrIGIveGVuL2NvbW1vbi9t
ZW1vcnkuYwpAQCAtMjAzLDYgKzIwMywxMCBAQCBzdGF0aWMgdm9pZCBwb3B1bGF0ZV9waHlzbWFw
KHN0cnVjdCBtZW1vCiAgICAgICAgIGlmICggdW5saWtlbHkoX19jb3B5X2Zyb21fZ3Vlc3Rfb2Zm
c2V0KCZncGZuLCBhLT5leHRlbnRfbGlzdCwgaSwgMSkpICkKICAgICAgICAgICAgIGdvdG8gb3V0
OwogCisgICAgICAgIGlmICggcGFnaW5nX21vZGVfdHJhbnNsYXRlKGQpICYmCisgICAgICAgICAg
ICAgbm90aWZ5X2dmbihkLCBfZ2ZuKGdwZm4gKyAoMVUgPDwgYS0+ZXh0ZW50X29yZGVyKSAtIDEp
KSApCisgICAgICAgICAgICBnb3RvIG91dDsKKwogICAgICAgICBpZiAoIGEtPm1lbWZsYWdzICYg
TUVNRl9wb3B1bGF0ZV9vbl9kZW1hbmQgKQogICAgICAgICB7CiAgICAgICAgICAgICAvKiBEaXNh
bGxvdyBwb3B1bGF0aW5nIFBvRCBwYWdlcyBvbiBvbmVzZWxmLiAqLwpAQCAtNzQ1LDYgKzc0OSwx
MCBAQCBzdGF0aWMgbG9uZyBtZW1vcnlfZXhjaGFuZ2UoWEVOX0dVRVNUX0hBCiAgICAgICAgICAg
ICAgICAgY29udGludWU7CiAgICAgICAgICAgICB9CiAKKyAgICAgICAgICAgIGlmICggcGFnaW5n
X21vZGVfdHJhbnNsYXRlKGQpICkKKyAgICAgICAgICAgICAgICByYyA9IG5vdGlmeV9nZm4oZCwK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2dmbihncGZuICsgKDFVIDw8IGV4Y2gu
b3V0LmV4dGVudF9vcmRlcikgLSAxKSk7CisKICAgICAgICAgICAgIG1mbiA9IHBhZ2VfdG9fbWZu
KHBhZ2UpOwogICAgICAgICAgICAgZ3Vlc3RfcGh5c21hcF9hZGRfcGFnZShkLCBfZ2ZuKGdwZm4p
LCBtZm4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2gub3V0LmV4dGVu
dF9vcmRlcik7CkBAIC04MTMsMTIgKzgyMSwyMCBAQCBpbnQgeGVubWVtX2FkZF90b19waHlzbWFw
KHN0cnVjdCBkb21haW4KICAgICAgICAgZXh0cmEuZm9yZWlnbl9kb21pZCA9IERPTUlEX0lOVkFM
SUQ7CiAKICAgICBpZiAoIHhhdHAtPnNwYWNlICE9IFhFTk1BUFNQQUNFX2dtZm5fcmFuZ2UgKQot
ICAgICAgICByZXR1cm4geGVubWVtX2FkZF90b19waHlzbWFwX29uZShkLCB4YXRwLT5zcGFjZSwg
ZXh0cmEsCisgICAgICAgIHJldHVybiBub3RpZnlfZ2ZuKGQsIF9nZm4oeGF0cC0+Z3BmbikpID86
CisgICAgICAgICAgICAgICB4ZW5tZW1fYWRkX3RvX3BoeXNtYXBfb25lKGQsIHhhdHAtPnNwYWNl
LCBleHRyYSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeGF0cC0+
aWR4LCBfZ2ZuKHhhdHAtPmdwZm4pKTsKIAogICAgIGlmICggeGF0cC0+c2l6ZSA8IHN0YXJ0ICkK
ICAgICAgICAgcmV0dXJuIC1FSUxTRVE7CiAKKyAgICBpZiAoICFzdGFydCAmJiB4YXRwLT5zaXpl
ICkKKyAgICB7CisgICAgICAgIHJjID0gbm90aWZ5X2dmbihkLCBfZ2ZuKHhhdHAtPmdwZm4gKyB4
YXRwLT5zaXplIC0gMSkpOworICAgICAgICBpZiAoIHJjICkKKyAgICAgICAgICAgIHJldHVybiBy
YzsKKyAgICB9CisKICAgICB4YXRwLT5pZHggKz0gc3RhcnQ7CiAgICAgeGF0cC0+Z3BmbiArPSBz
dGFydDsKICAgICB4YXRwLT5zaXplIC09IHN0YXJ0OwpAQCAtODkxLDcgKzkwNyw4IEBAIHN0YXRp
YyBpbnQgeGVubWVtX2FkZF90b19waHlzbWFwX2JhdGNoKHMKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0ZW50LCAxKSkgKQogICAgICAgICAgICAgcmV0
dXJuIC1FRkFVTFQ7CiAKLSAgICAgICAgcmMgPSB4ZW5tZW1fYWRkX3RvX3BoeXNtYXBfb25lKGQs
IHhhdHBiLT5zcGFjZSwKKyAgICAgICAgcmMgPSBub3RpZnlfZ2ZuKGQsIF9nZm4oZ3BmbikpID86
CisgICAgICAgICAgICAgeGVubWVtX2FkZF90b19waHlzbWFwX29uZShkLCB4YXRwYi0+c3BhY2Us
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4YXRwYi0+dSwKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkeCwgX2dmbihncGZuKSk7CiAKLS0t
IGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvaW9tbXUuYworKysgYi94ZW4vZHJpdmVycy9wYXNz
dGhyb3VnaC9pb21tdS5jCkBAIC01MzAsNiArNTMwLDE0IEBAIHZvaWQgaW9tbXVfc2hhcmVfcDJt
X3RhYmxlKHN0cnVjdCBkb21haW4KICAgICAgICAgaW9tbXVfZ2V0X29wcygpLT5zaGFyZV9wMm0o
ZCk7CiB9CiAKK2ludCBpb21tdV9ub3RpZnlfZ2ZuKHN0cnVjdCBkb21haW4gKmQsIGdmbl90IGdm
bikKK3sKKyAgICBjb25zdCBzdHJ1Y3QgaW9tbXVfb3BzICpvcHMgPSBkb21faW9tbXUoZCktPnBs
YXRmb3JtX29wczsKKworICAgIHJldHVybiBuZWVkX2lvbW11X3B0X3N5bmMoZCkgJiYgb3BzLT5u
b3RpZnlfZGZuCisgICAgICAgICAgID8gaW9tbXVfY2FsbChvcHMsIG5vdGlmeV9kZm4sIGQsIF9k
Zm4oZ2ZuX3goZ2ZuKSkpIDogMDsKK30KKwogdm9pZCBpb21tdV9jcmFzaF9zaHV0ZG93bih2b2lk
KQogewogICAgIGlmICggIWlvbW11X2NyYXNoX2Rpc2FibGUgKQotLS0gYS94ZW4vaW5jbHVkZS9h
c20tYXJtL2RvbWFpbi5oCisrKyBiL3hlbi9pbmNsdWRlL2FzbS1hcm0vZG9tYWluLmgKQEAgLTI3
Miw2ICsyNzIsOCBAQCBzdGF0aWMgaW5saW5lIHZvaWQgZnJlZV92Y3B1X2d1ZXN0X2NvbnRlCiAK
IHN0YXRpYyBpbmxpbmUgdm9pZCBhcmNoX3ZjcHVfYmxvY2soc3RydWN0IHZjcHUgKnYpIHt9CiAK
KyNkZWZpbmUgYXJjaF9ub3RpZnlfZ2ZuKGQsIGdmbikgKCh2b2lkKShkKSwgKHZvaWQpKGdmbiks
IDApCisKICNlbmRpZiAvKiBfX0FTTV9ET01BSU5fSF9fICovCiAKIC8qCi0tLSBhL3hlbi9pbmNs
dWRlL2FzbS14ODYvZG9tYWluLmgKKysrIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9kb21haW4uaApA
QCAtNjQ3LDYgKzY0Nyw4IEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBmcmVlX3ZjcHVfZ3Vlc3RfY29u
dGUKIAogdm9pZCBhcmNoX3ZjcHVfcmVnc19pbml0KHN0cnVjdCB2Y3B1ICp2KTsKIAorI2RlZmlu
ZSBhcmNoX25vdGlmeV9nZm4oZCwgZ2ZuKSAoZ2ZuX3ZhbGlkKGQsIGdmbikgPyAwIDogLUVBRERS
Tk9UQVZBSUwpCisKIHN0cnVjdCB2Y3B1X2h2bV9jb250ZXh0OwogaW50IGFyY2hfc2V0X2luZm9f
aHZtX2d1ZXN0KHN0cnVjdCB2Y3B1ICp2LCBjb25zdCBzdHJ1Y3QgdmNwdV9odm1fY29udGV4dCAq
Y3R4KTsKIAotLS0gYS94ZW4vaW5jbHVkZS94ZW4vaW9tbXUuaAorKysgYi94ZW4vaW5jbHVkZS94
ZW4vaW9tbXUuaApAQCAtMjM3LDYgKzIzNyw4IEBAIHN0cnVjdCBpb21tdV9vcHMgewogICAgIGlu
dCBfX211c3RfY2hlY2sgKCpsb29rdXBfcGFnZSkoc3RydWN0IGRvbWFpbiAqZCwgZGZuX3QgZGZu
LCBtZm5fdCAqbWZuLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWdu
ZWQgaW50ICpmbGFncyk7CiAKKyAgICBpbnQgX19tdXN0X2NoZWNrICgqbm90aWZ5X2Rmbikoc3Ry
dWN0IGRvbWFpbiAqZCwgZGZuX3QgZGZuKTsKKwogICAgIHZvaWQgKCpmcmVlX3BhZ2VfdGFibGUp
KHN0cnVjdCBwYWdlX2luZm8gKik7CiAKICNpZmRlZiBDT05GSUdfWDg2CkBAIC0zMzEsNiArMzMz
LDcgQEAgdm9pZCBpb21tdV9jcmFzaF9zaHV0ZG93bih2b2lkKTsKIGludCBpb21tdV9nZXRfcmVz
ZXJ2ZWRfZGV2aWNlX21lbW9yeShpb21tdV9ncmRtX3QgKiwgdm9pZCAqKTsKIAogdm9pZCBpb21t
dV9zaGFyZV9wMm1fdGFibGUoc3RydWN0IGRvbWFpbiAqZCk7CitpbnQgX19tdXN0X2NoZWNrIGlv
bW11X25vdGlmeV9nZm4oc3RydWN0IGRvbWFpbiAqZCwgZ2ZuX3QgZ2ZuKTsKIAogI2lmZGVmIENP
TkZJR19IQVNfUENJCiBpbnQgaW9tbXVfZG9fcGNpX2RvbWN0bChzdHJ1Y3QgeGVuX2RvbWN0bCAq
LCBzdHJ1Y3QgZG9tYWluICpkLAotLS0gYS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaAorKysgYi94
ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaApAQCAtMTAzOSw2ICsxMDM5LDggQEAgc3RhdGljIGFsd2F5
c19pbmxpbmUgYm9vbCBpc19pb21tdV9lbmFibAogICAgIHJldHVybiBldmFsdWF0ZV9ub3NwZWMo
ZC0+b3B0aW9ucyAmIFhFTl9ET01DVExfQ0RGX2lvbW11KTsKIH0KIAorI2RlZmluZSBub3RpZnlf
Z2ZuKGQsIGdmbikgKGFyY2hfbm90aWZ5X2dmbihkLCBnZm4pID86IGlvbW11X25vdGlmeV9nZm4o
ZCwgZ2ZuKSkKKwogZXh0ZXJuIGJvb2wgc2NoZWRfc210X3Bvd2VyX3NhdmluZ3M7CiBleHRlcm4g
Ym9vbCBzY2hlZF9kaXNhYmxlX3NtdF9zd2l0Y2hpbmc7CiAKCgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1k
ZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21h
aWxtYW4vbGlzdGluZm8veGVuLWRldmVs

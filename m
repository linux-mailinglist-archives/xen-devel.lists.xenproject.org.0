Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id A11D8C2226
	for <lists+xen-devel@lfdr.de>; Mon, 30 Sep 2019 15:36:03 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iEvnj-0005Q8-Gl; Mon, 30 Sep 2019 13:33:19 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=znM2=XZ=citrix.com=roger.pau@srs-us1.protection.inumbo.net>)
 id 1iEvni-0005Px-6h
 for xen-devel@lists.xenproject.org; Mon, 30 Sep 2019 13:33:18 +0000
X-Inumbo-ID: db3b0bf6-e386-11e9-bf31-bc764e2007e4
Received: from esa3.hc3370-68.iphmx.com (unknown [216.71.145.155])
 by localhost (Halon) with ESMTPS
 id db3b0bf6-e386-11e9-bf31-bc764e2007e4;
 Mon, 30 Sep 2019 13:33:15 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1569850396;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=9Blv00RFTQvzGYHBzr0vl7Y+GF0UID2L5jPkblmPtck=;
 b=hJpyaeQwYp1GA392OpRSNg/1Ha6kEaHPV6eLYuh47Nn9AqTWaRkYMNO2
 BDkow3hDvIMoG5nv3cstX2a5g+LVHGbsKUOKAf2SWeR+1dSI1w5WxMqCe
 522ymJT9uptIRGOzvJJ1xqmomehCYZjkC/JuHaFOoWTQ8NfY435U8irfd c=;
Authentication-Results: esa3.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=roger.pau@citrix.com;
 spf=Pass smtp.mailfrom=roger.pau@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa3.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 roger.pau@citrix.com) identity=pra; client-ip=162.221.158.21;
 receiver=esa3.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="roger.pau@citrix.com"; x-conformance=sidf_compatible
Received-SPF: Pass (esa3.hc3370-68.iphmx.com: domain of
 roger.pau@citrix.com designates 162.221.158.21 as permitted
 sender) identity=mailfrom; client-ip=162.221.158.21;
 receiver=esa3.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="roger.pau@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83 ~all"
Received-SPF: None (esa3.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa3.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: QxLVRtxr/fZKnqYWwdKUl1EiSI+thFKDHJBMAb6ogSusr6s8mzli6G7/cQ5W1NMB8hIq4Y84cr
 kOYf+rpw/ppNJalxdHgxYXDVfgZl4ik+y1HSv8v5DmQMvfr+sb4/0y3b652I6IvintQ015lg5Y
 LIqufaqrEeICZe2BZ9vY9MS2ynSv5fiqcXm34yONvowqVPdMiXE40MRoLmOXiYD6jve/Ranzws
 qRJ1G0atToZ9bK3HW/dF4ofXHT2bxUUnsOO8Aqod/v1jwJjDLj2K6jQ0kkMP5Qh0EiLeNUVfRk
 LOI=
X-SBRS: 2.7
X-MesageID: 6256429
X-Ironport-Server: esa3.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.64,567,1559534400"; 
   d="scan'208";a="6256429"
From: Roger Pau Monne <roger.pau@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Mon, 30 Sep 2019 15:32:32 +0200
Message-ID: <20190930133238.49868-5-roger.pau@citrix.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190930133238.49868-1-roger.pau@citrix.com>
References: <20190930133238.49868-1-roger.pau@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v3 04/10] ioreq: add internal ioreq
 initialization support
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>, Paul Durrant <paul@xen.org>,
 Wei Liu <wl@xen.org>, Jan Beulich <jbeulich@suse.com>,
 Roger Pau Monne <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

QWRkIHN1cHBvcnQgZm9yIGludGVybmFsIGlvcmVxIHNlcnZlcnMgdG8gaW5pdGlhbGl6YXRpb24g
YW5kCmRlaW5pdGlhbGl6YXRpb24gcm91dGluZXMsIHByZXZlbnQgc29tZSBmdW5jdGlvbnMgZnJv
bSBiZWluZyBleGVjdXRlZAphZ2FpbnN0IGludGVybmFsIGlvcmVxIHNlcnZlcnMgYW5kIGFkZCBn
dWFyZHMgdG8gb25seSBhbGxvdyBpbnRlcm5hbApjYWxsZXJzIHRvIG1vZGlmeSBpbnRlcm5hbCBp
b3JlcSBzZXJ2ZXJzLiBFeHRlcm5hbCBjYWxsZXJzIChpZTogZnJvbQpoeXBlcmNhbGxzKSBhcmUg
b25seSBhbGxvd2VkIHRvIGRlYWwgd2l0aCBleHRlcm5hbCBpb3JlcSBzZXJ2ZXJzLgoKU2lnbmVk
LW9mZi1ieTogUm9nZXIgUGF1IE1vbm7DqSA8cm9nZXIucGF1QGNpdHJpeC5jb20+Ci0tLQpDaGFu
Z2VzIHNpbmNlIHYyOgogLSBSZXR1cm4gZWFybHkgZnJvbSBodm1faW9yZXFfc2VydmVyX2luaXQg
YW5kIGh2bV9pb3JlcV9zZXJ2ZXJfZGVpbml0CiAgIGlmIHNlcnZlciBpcyBpbnRlcm5hbC4KIC0g
aHZtX2Rlc3Ryb3lfaW9yZXFfc2VydmVyLCBodm1fZ2V0X2lvcmVxX3NlcnZlcl9pbmZvIGFuZAog
ICBodm1fbWFwX21lbV90eXBlX3RvX2lvcmVxX3NlcnZlciBjYW4gb25seSBiZSB1c2VkIGFnYWlu
c3QgZXh0ZXJuYWwKICAgc2VydmVycywgaGVuY2UgYWRkIGFuIGFzc2VydCB0byB0aGF0IGVmZmVj
dC4KIC0gU2ltcGxpZnkgQVNTRVJUIGluIGh2bV9jcmVhdGVfaW9yZXFfc2VydmVyLgoKQ2hhbmdl
cyBzaW5jZSB2MToKIC0gRG8gbm90IHBhc3MgYW4gJ2ludGVybmFsJyBwYXJhbWV0ZXIgdG8gbW9z
dCBmdW5jdGlvbnMsIGFuZCBpbnN0ZWFkCiAgIHVzZSB0aGUgaWQgdG8ga2V5IHdoZXRoZXIgYW4g
aW9yZXEgc2VydmVyIGlzIGludGVybmFsIG9yIGV4dGVybmFsLgogLSBQcmV2ZW50IGVuYWJsaW5n
IGFuIGludGVybmFsIHNlcnZlciB3aXRob3V0IGEgaGFuZGxlci4KLS0tCiB4ZW4vYXJjaC94ODYv
aHZtL2RtLmMgICAgICAgICAgICB8ICAxNyArKysrLQogeGVuL2FyY2gveDg2L2h2bS9pb3JlcS5j
ICAgICAgICAgfCAxMTkgKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLQogeGVuL2luY2x1
ZGUvYXNtLXg4Ni9odm0vZG9tYWluLmggfCAgIDUgKy0KIHhlbi9pbmNsdWRlL2FzbS14ODYvaHZt
L2lvcmVxLmggIHwgICA4ICsrLQogNCBmaWxlcyBjaGFuZ2VkLCAxMDUgaW5zZXJ0aW9ucygrKSwg
NDQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L2h2bS9kbS5jIGIveGVu
L2FyY2gveDg2L2h2bS9kbS5jCmluZGV4IGMyZmNhOWY3MjkuLjZhMzY4MmU1OGMgMTAwNjQ0Ci0t
LSBhL3hlbi9hcmNoL3g4Ni9odm0vZG0uYworKysgYi94ZW4vYXJjaC94ODYvaHZtL2RtLmMKQEAg
LTQxNyw3ICs0MTcsNyBAQCBzdGF0aWMgaW50IGRtX29wKGNvbnN0IHN0cnVjdCBkbW9wX2FyZ3Mg
Km9wX2FyZ3MpCiAgICAgICAgICAgICBicmVhazsKIAogICAgICAgICByYyA9IGh2bV9jcmVhdGVf
aW9yZXFfc2VydmVyKGQsIGRhdGEtPmhhbmRsZV9idWZpb3JlcSwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAmZGF0YS0+aWQpOworICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICZkYXRhLT5pZCwgZmFsc2UpOwogICAgICAgICBicmVhazsKICAgICB9CiAK
QEAgLTQ1MCw2ICs0NTAsOSBAQCBzdGF0aWMgaW50IGRtX29wKGNvbnN0IHN0cnVjdCBkbW9wX2Fy
Z3MgKm9wX2FyZ3MpCiAgICAgICAgIHJjID0gLUVJTlZBTDsKICAgICAgICAgaWYgKCBkYXRhLT5w
YWQgKQogICAgICAgICAgICAgYnJlYWs7CisgICAgICAgIHJjID0gLUVQRVJNOworICAgICAgICBp
ZiAoIGh2bV9pb3JlcV9pc19pbnRlcm5hbChkYXRhLT5pZCkgKQorICAgICAgICAgICAgYnJlYWs7
CiAKICAgICAgICAgcmMgPSBodm1fbWFwX2lvX3JhbmdlX3RvX2lvcmVxX3NlcnZlcihkLCBkYXRh
LT5pZCwgZGF0YS0+dHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBkYXRhLT5zdGFydCwgZGF0YS0+ZW5kKTsKQEAgLTQ2NCw2ICs0NjcsOSBAQCBzdGF0
aWMgaW50IGRtX29wKGNvbnN0IHN0cnVjdCBkbW9wX2FyZ3MgKm9wX2FyZ3MpCiAgICAgICAgIHJj
ID0gLUVJTlZBTDsKICAgICAgICAgaWYgKCBkYXRhLT5wYWQgKQogICAgICAgICAgICAgYnJlYWs7
CisgICAgICAgIHJjID0gLUVQRVJNOworICAgICAgICBpZiAoIGh2bV9pb3JlcV9pc19pbnRlcm5h
bChkYXRhLT5pZCkgKQorICAgICAgICAgICAgYnJlYWs7CiAKICAgICAgICAgcmMgPSBodm1fdW5t
YXBfaW9fcmFuZ2VfZnJvbV9pb3JlcV9zZXJ2ZXIoZCwgZGF0YS0+aWQsIGRhdGEtPnR5cGUsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEtPnN0
YXJ0LCBkYXRhLT5lbmQpOwpAQCAtNDgxLDYgKzQ4Nyw5IEBAIHN0YXRpYyBpbnQgZG1fb3AoY29u
c3Qgc3RydWN0IGRtb3BfYXJncyAqb3BfYXJncykKICAgICAgICAgcmMgPSAtRU9QTk9UU1VQUDsK
ICAgICAgICAgaWYgKCAhaGFwX2VuYWJsZWQoZCkgKQogICAgICAgICAgICAgYnJlYWs7CisgICAg
ICAgIHJjID0gLUVQRVJNOworICAgICAgICBpZiAoIGh2bV9pb3JlcV9pc19pbnRlcm5hbChkYXRh
LT5pZCkgKQorICAgICAgICAgICAgYnJlYWs7CiAKICAgICAgICAgaWYgKCBmaXJzdF9nZm4gPT0g
MCApCiAgICAgICAgICAgICByYyA9IGh2bV9tYXBfbWVtX3R5cGVfdG9faW9yZXFfc2VydmVyKGQs
IGRhdGEtPmlkLApAQCAtNTI4LDYgKzUzNyw5IEBAIHN0YXRpYyBpbnQgZG1fb3AoY29uc3Qgc3Ry
dWN0IGRtb3BfYXJncyAqb3BfYXJncykKICAgICAgICAgcmMgPSAtRUlOVkFMOwogICAgICAgICBp
ZiAoIGRhdGEtPnBhZCApCiAgICAgICAgICAgICBicmVhazsKKyAgICAgICAgcmMgPSAtRVBFUk07
CisgICAgICAgIGlmICggaHZtX2lvcmVxX2lzX2ludGVybmFsKGRhdGEtPmlkKSApCisgICAgICAg
ICAgICBicmVhazsKIAogICAgICAgICByYyA9IGh2bV9zZXRfaW9yZXFfc2VydmVyX3N0YXRlKGQs
IGRhdGEtPmlkLCAhIWRhdGEtPmVuYWJsZWQpOwogICAgICAgICBicmVhazsKQEAgLTU0MSw2ICs1
NTMsOSBAQCBzdGF0aWMgaW50IGRtX29wKGNvbnN0IHN0cnVjdCBkbW9wX2FyZ3MgKm9wX2FyZ3Mp
CiAgICAgICAgIHJjID0gLUVJTlZBTDsKICAgICAgICAgaWYgKCBkYXRhLT5wYWQgKQogICAgICAg
ICAgICAgYnJlYWs7CisgICAgICAgIHJjID0gLUVQRVJNOworICAgICAgICBpZiAoIGh2bV9pb3Jl
cV9pc19pbnRlcm5hbChkYXRhLT5pZCkgKQorICAgICAgICAgICAgYnJlYWs7CiAKICAgICAgICAg
cmMgPSBodm1fZGVzdHJveV9pb3JlcV9zZXJ2ZXIoZCwgZGF0YS0+aWQpOwogICAgICAgICBicmVh
azsKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9odm0vaW9yZXEuYyBiL3hlbi9hcmNoL3g4Ni9o
dm0vaW9yZXEuYwppbmRleCBlZDAxNDJjNGUxLi5jZGJkNDI0NGE0IDEwMDY0NAotLS0gYS94ZW4v
YXJjaC94ODYvaHZtL2lvcmVxLmMKKysrIGIveGVuL2FyY2gveDg2L2h2bS9pb3JlcS5jCkBAIC01
OSwxMCArNTksMTEgQEAgc3RhdGljIHN0cnVjdCBodm1faW9yZXFfc2VydmVyICpnZXRfaW9yZXFf
c2VydmVyKGNvbnN0IHN0cnVjdCBkb21haW4gKmQsCiAvKgogICogSXRlcmF0ZSBvdmVyIGFsbCBw
b3NzaWJsZSBpb3JlcSBzZXJ2ZXJzLgogICoKLSAqIE5PVEU6IFRoZSBpdGVyYXRpb24gaXMgYmFj
a3dhcmRzIHN1Y2ggdGhhdCBtb3JlIHJlY2VudGx5IGNyZWF0ZWQKLSAqICAgICAgIGlvcmVxIHNl
cnZlcnMgYXJlIGZhdm91cmVkIGluIGh2bV9zZWxlY3RfaW9yZXFfc2VydmVyKCkuCi0gKiAgICAg
ICBUaGlzIGlzIGEgc2VtYW50aWMgdGhhdCBwcmV2aW91c2x5IGV4aXN0ZWQgd2hlbiBpb3JlcSBz
ZXJ2ZXJzCi0gKiAgICAgICB3ZXJlIGhlbGQgaW4gYSBsaW5rZWQgbGlzdC4KKyAqIE5PVEU6IFRo
ZSBpdGVyYXRpb24gaXMgYmFja3dhcmRzIHN1Y2ggdGhhdCBpbnRlcm5hbCBhbmQgbW9yZSByZWNl
bnRseQorICogICAgICAgY3JlYXRlZCBleHRlcm5hbCBpb3JlcSBzZXJ2ZXJzIGFyZSBmYXZvdXJl
ZCBpbgorICogICAgICAgaHZtX3NlbGVjdF9pb3JlcV9zZXJ2ZXIoKS4KKyAqICAgICAgIFRoaXMg
aXMgYSBzZW1hbnRpYyB0aGF0IHByZXZpb3VzbHkgZXhpc3RlZCBmb3IgZXh0ZXJuYWwgc2VydmVy
cyB3aGVuCisgKiAgICAgICBpb3JlcSBzZXJ2ZXJzIHdlcmUgaGVsZCBpbiBhIGxpbmtlZCBsaXN0
LgogICovCiAjZGVmaW5lIEZPUl9FQUNIX0lPUkVRX1NFUlZFUihkLCBpZCwgcykgXAogICAgIGZv
ciAoIChpZCkgPSBNQVhfTlJfSU9SRVFfU0VSVkVSUzsgKGlkKSAhPSAwOyApIFwKQEAgLTcwLDYg
KzcxLDEyIEBAIHN0YXRpYyBzdHJ1Y3QgaHZtX2lvcmVxX3NlcnZlciAqZ2V0X2lvcmVxX3NlcnZl
cihjb25zdCBzdHJ1Y3QgZG9tYWluICpkLAogICAgICAgICAgICAgY29udGludWU7IFwKICAgICAg
ICAgZWxzZQogCisjZGVmaW5lIEZPUl9FQUNIX0VYVEVSTkFMX0lPUkVRX1NFUlZFUihkLCBpZCwg
cykgXAorICAgIGZvciAoIChpZCkgPSBNQVhfTlJfRVhURVJOQUxfSU9SRVFfU0VSVkVSUzsgKGlk
KSAhPSAwOyApIFwKKyAgICAgICAgaWYgKCAhKHMgPSBHRVRfSU9SRVFfU0VSVkVSKGQsIC0tKGlk
KSkpICkgXAorICAgICAgICAgICAgY29udGludWU7IFwKKyAgICAgICAgZWxzZQorCiBzdGF0aWMg
aW9yZXFfdCAqZ2V0X2lvcmVxKHN0cnVjdCBodm1faW9yZXFfc2VydmVyICpzLCBzdHJ1Y3QgdmNw
dSAqdikKIHsKICAgICBzaGFyZWRfaW9wYWdlX3QgKnAgPSBzLT5pb3JlcS52YTsKQEAgLTg2LDcg
KzkzLDcgQEAgYm9vbCBodm1faW9fcGVuZGluZyhzdHJ1Y3QgdmNwdSAqdikKICAgICBzdHJ1Y3Qg
aHZtX2lvcmVxX3NlcnZlciAqczsKICAgICB1bnNpZ25lZCBpbnQgaWQ7CiAKLSAgICBGT1JfRUFD
SF9JT1JFUV9TRVJWRVIoZCwgaWQsIHMpCisgICAgRk9SX0VBQ0hfRVhURVJOQUxfSU9SRVFfU0VS
VkVSKGQsIGlkLCBzKQogICAgIHsKICAgICAgICAgc3RydWN0IGh2bV9pb3JlcV92Y3B1ICpzdjsK
IApAQCAtMTkwLDcgKzE5Nyw3IEBAIGJvb2wgaGFuZGxlX2h2bV9pb19jb21wbGV0aW9uKHN0cnVj
dCB2Y3B1ICp2KQogICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgfQogCi0gICAgRk9SX0VBQ0hf
SU9SRVFfU0VSVkVSKGQsIGlkLCBzKQorICAgIEZPUl9FQUNIX0VYVEVSTkFMX0lPUkVRX1NFUlZF
UihkLCBpZCwgcykKICAgICB7CiAgICAgICAgIHN0cnVjdCBodm1faW9yZXFfdmNwdSAqc3Y7CiAK
QEAgLTQzMCw3ICs0MzcsNyBAQCBib29sIGlzX2lvcmVxX3NlcnZlcl9wYWdlKHN0cnVjdCBkb21h
aW4gKmQsIGNvbnN0IHN0cnVjdCBwYWdlX2luZm8gKnBhZ2UpCiAKICAgICBzcGluX2xvY2tfcmVj
dXJzaXZlKCZkLT5hcmNoLmh2bS5pb3JlcV9zZXJ2ZXIubG9jayk7CiAKLSAgICBGT1JfRUFDSF9J
T1JFUV9TRVJWRVIoZCwgaWQsIHMpCisgICAgRk9SX0VBQ0hfRVhURVJOQUxfSU9SRVFfU0VSVkVS
KGQsIGlkLCBzKQogICAgIHsKICAgICAgICAgaWYgKCAocy0+aW9yZXEucGFnZSA9PSBwYWdlKSB8
fCAocy0+YnVmaW9yZXEucGFnZSA9PSBwYWdlKSApCiAgICAgICAgIHsKQEAgLTY4OCw3ICs2OTUs
NyBAQCBzdGF0aWMgaW50IGh2bV9pb3JlcV9zZXJ2ZXJfYWxsb2NfcmFuZ2VzZXRzKHN0cnVjdCBo
dm1faW9yZXFfc2VydmVyICpzLAogICAgIHJldHVybiByYzsKIH0KIAotc3RhdGljIHZvaWQgaHZt
X2lvcmVxX3NlcnZlcl9lbmFibGUoc3RydWN0IGh2bV9pb3JlcV9zZXJ2ZXIgKnMpCitzdGF0aWMg
dm9pZCBodm1faW9yZXFfc2VydmVyX2VuYWJsZShzdHJ1Y3QgaHZtX2lvcmVxX3NlcnZlciAqcywg
Ym9vbCBpbnRlcm5hbCkKIHsKICAgICBzdHJ1Y3QgaHZtX2lvcmVxX3ZjcHUgKnN2OwogCkBAIC02
OTcsMjkgKzcwNCw0MCBAQCBzdGF0aWMgdm9pZCBodm1faW9yZXFfc2VydmVyX2VuYWJsZShzdHJ1
Y3QgaHZtX2lvcmVxX3NlcnZlciAqcykKICAgICBpZiAoIHMtPmVuYWJsZWQgKQogICAgICAgICBn
b3RvIGRvbmU7CiAKLSAgICBodm1fcmVtb3ZlX2lvcmVxX2dmbihzLCBmYWxzZSk7Ci0gICAgaHZt
X3JlbW92ZV9pb3JlcV9nZm4ocywgdHJ1ZSk7CisgICAgaWYgKCAhaW50ZXJuYWwgKQorICAgIHsK
KyAgICAgICAgaHZtX3JlbW92ZV9pb3JlcV9nZm4ocywgZmFsc2UpOworICAgICAgICBodm1fcmVt
b3ZlX2lvcmVxX2dmbihzLCB0cnVlKTsKIAotICAgIHMtPmVuYWJsZWQgPSB0cnVlOworICAgICAg
ICBsaXN0X2Zvcl9lYWNoX2VudHJ5ICggc3YsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAmcy0+aW9yZXFfdmNwdV9saXN0LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlz
dF9lbnRyeSApCisgICAgICAgICAgICBodm1fdXBkYXRlX2lvcmVxX2V2dGNobihzLCBzdik7Cisg
ICAgfQorICAgIGVsc2UgaWYgKCAhcy0+aGFuZGxlciApCisgICAgeworICAgICAgICBBU1NFUlRf
VU5SRUFDSEFCTEUoKTsKKyAgICAgICAgZ290byBkb25lOworICAgIH0KIAotICAgIGxpc3RfZm9y
X2VhY2hfZW50cnkgKCBzdiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgJnMtPmlvcmVxX3Zj
cHVfbGlzdCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdF9lbnRyeSApCi0gICAgICAg
IGh2bV91cGRhdGVfaW9yZXFfZXZ0Y2huKHMsIHN2KTsKKyAgICBzLT5lbmFibGVkID0gdHJ1ZTsK
IAogICBkb25lOgogICAgIHNwaW5fdW5sb2NrKCZzLT5sb2NrKTsKIH0KIAotc3RhdGljIHZvaWQg
aHZtX2lvcmVxX3NlcnZlcl9kaXNhYmxlKHN0cnVjdCBodm1faW9yZXFfc2VydmVyICpzKQorc3Rh
dGljIHZvaWQgaHZtX2lvcmVxX3NlcnZlcl9kaXNhYmxlKHN0cnVjdCBodm1faW9yZXFfc2VydmVy
ICpzLCBib29sIGludGVybmFsKQogewogICAgIHNwaW5fbG9jaygmcy0+bG9jayk7CiAKICAgICBp
ZiAoICFzLT5lbmFibGVkICkKICAgICAgICAgZ290byBkb25lOwogCi0gICAgaHZtX2FkZF9pb3Jl
cV9nZm4ocywgdHJ1ZSk7Ci0gICAgaHZtX2FkZF9pb3JlcV9nZm4ocywgZmFsc2UpOworICAgIGlm
ICggIWludGVybmFsICkKKyAgICB7CisgICAgICAgIGh2bV9hZGRfaW9yZXFfZ2ZuKHMsIHRydWUp
OworICAgICAgICBodm1fYWRkX2lvcmVxX2dmbihzLCBmYWxzZSk7CisgICAgfQogCiAgICAgcy0+
ZW5hYmxlZCA9IGZhbHNlOwogCkBAIC03MzYsMjEgKzc1NCwyMSBAQCBzdGF0aWMgaW50IGh2bV9p
b3JlcV9zZXJ2ZXJfaW5pdChzdHJ1Y3QgaHZtX2lvcmVxX3NlcnZlciAqcywKICAgICBpbnQgcmM7
CiAKICAgICBzLT50YXJnZXQgPSBkOworICAgIHNwaW5fbG9ja19pbml0KCZzLT5sb2NrKTsKKwor
ICAgIHJjID0gaHZtX2lvcmVxX3NlcnZlcl9hbGxvY19yYW5nZXNldHMocywgaWQpOworICAgIGlm
ICggaHZtX2lvcmVxX2lzX2ludGVybmFsKGlkKSB8fCByYyApCisgICAgICAgIHJldHVybiByYzsK
IAogICAgIGdldF9rbm93bmFsaXZlX2RvbWFpbihjdXJyZCk7Ci0gICAgcy0+ZW11bGF0b3IgPSBj
dXJyZDsKIAotICAgIHNwaW5fbG9ja19pbml0KCZzLT5sb2NrKTsKKyAgICBzLT5lbXVsYXRvciA9
IGN1cnJkOwogICAgIElOSVRfTElTVF9IRUFEKCZzLT5pb3JlcV92Y3B1X2xpc3QpOwogICAgIHNw
aW5fbG9ja19pbml0KCZzLT5idWZpb3JlcV9sb2NrKTsKIAogICAgIHMtPmlvcmVxLmdmbiA9IElO
VkFMSURfR0ZOOwogICAgIHMtPmJ1ZmlvcmVxLmdmbiA9IElOVkFMSURfR0ZOOwogCi0gICAgcmMg
PSBodm1faW9yZXFfc2VydmVyX2FsbG9jX3Jhbmdlc2V0cyhzLCBpZCk7Ci0gICAgaWYgKCByYyAp
Ci0gICAgICAgIHJldHVybiByYzsKLQogICAgIHMtPmJ1ZmlvcmVxX2hhbmRsaW5nID0gYnVmaW9y
ZXFfaGFuZGxpbmc7CiAKICAgICBmb3JfZWFjaF92Y3B1ICggZCwgdiApCkBAIC03NjMsNiArNzgx
LDcgQEAgc3RhdGljIGludCBodm1faW9yZXFfc2VydmVyX2luaXQoc3RydWN0IGh2bV9pb3JlcV9z
ZXJ2ZXIgKnMsCiAgICAgcmV0dXJuIDA7CiAKICBmYWlsX2FkZDoKKyAgICBBU1NFUlQoIWh2bV9p
b3JlcV9pc19pbnRlcm5hbChpZCkpOwogICAgIGh2bV9pb3JlcV9zZXJ2ZXJfcmVtb3ZlX2FsbF92
Y3B1cyhzKTsKICAgICBodm1faW9yZXFfc2VydmVyX3VubWFwX3BhZ2VzKHMpOwogCkBAIC03NzIs
OSArNzkxLDE1IEBAIHN0YXRpYyBpbnQgaHZtX2lvcmVxX3NlcnZlcl9pbml0KHN0cnVjdCBodm1f
aW9yZXFfc2VydmVyICpzLAogICAgIHJldHVybiByYzsKIH0KIAotc3RhdGljIHZvaWQgaHZtX2lv
cmVxX3NlcnZlcl9kZWluaXQoc3RydWN0IGh2bV9pb3JlcV9zZXJ2ZXIgKnMpCitzdGF0aWMgdm9p
ZCBodm1faW9yZXFfc2VydmVyX2RlaW5pdChzdHJ1Y3QgaHZtX2lvcmVxX3NlcnZlciAqcywgYm9v
bCBpbnRlcm5hbCkKIHsKICAgICBBU1NFUlQoIXMtPmVuYWJsZWQpOworCisgICAgaHZtX2lvcmVx
X3NlcnZlcl9mcmVlX3Jhbmdlc2V0cyhzKTsKKworICAgIGlmICggaW50ZXJuYWwgKQorICAgICAg
ICByZXR1cm47CisKICAgICBodm1faW9yZXFfc2VydmVyX3JlbW92ZV9hbGxfdmNwdXMocyk7CiAK
ICAgICAvKgpAQCAtNzg5LDEzICs4MTQsMTEgQEAgc3RhdGljIHZvaWQgaHZtX2lvcmVxX3NlcnZl
cl9kZWluaXQoc3RydWN0IGh2bV9pb3JlcV9zZXJ2ZXIgKnMpCiAgICAgaHZtX2lvcmVxX3NlcnZl
cl91bm1hcF9wYWdlcyhzKTsKICAgICBodm1faW9yZXFfc2VydmVyX2ZyZWVfcGFnZXMocyk7CiAK
LSAgICBodm1faW9yZXFfc2VydmVyX2ZyZWVfcmFuZ2VzZXRzKHMpOwotCiAgICAgcHV0X2RvbWFp
bihzLT5lbXVsYXRvcik7CiB9CiAKIGludCBodm1fY3JlYXRlX2lvcmVxX3NlcnZlcihzdHJ1Y3Qg
ZG9tYWluICpkLCBpbnQgYnVmaW9yZXFfaGFuZGxpbmcsCi0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgaW9zZXJ2aWRfdCAqaWQpCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW9zZXJ2
aWRfdCAqaWQsIGJvb2wgaW50ZXJuYWwpCiB7CiAgICAgc3RydWN0IGh2bV9pb3JlcV9zZXJ2ZXIg
KnM7CiAgICAgdW5zaWduZWQgaW50IGk7CkBAIC04MTEsNyArODM0LDkgQEAgaW50IGh2bV9jcmVh
dGVfaW9yZXFfc2VydmVyKHN0cnVjdCBkb21haW4gKmQsIGludCBidWZpb3JlcV9oYW5kbGluZywK
ICAgICBkb21haW5fcGF1c2UoZCk7CiAgICAgc3Bpbl9sb2NrX3JlY3Vyc2l2ZSgmZC0+YXJjaC5o
dm0uaW9yZXFfc2VydmVyLmxvY2spOwogCi0gICAgZm9yICggaSA9IDA7IGkgPCBNQVhfTlJfSU9S
RVFfU0VSVkVSUzsgaSsrICkKKyAgICBmb3IgKCBpID0gKGludGVybmFsID8gTUFYX05SX0VYVEVS
TkFMX0lPUkVRX1NFUlZFUlMgOiAwKTsKKyAgICAgICAgICBpIDwgKGludGVybmFsID8gTUFYX05S
X0lPUkVRX1NFUlZFUlMgOiBNQVhfTlJfRVhURVJOQUxfSU9SRVFfU0VSVkVSUyk7CisgICAgICAg
ICAgaSsrICkKICAgICB7CiAgICAgICAgIGlmICggIUdFVF9JT1JFUV9TRVJWRVIoZCwgaSkgKQog
ICAgICAgICAgICAgYnJlYWs7CkBAIC04MjEsNiArODQ2LDEwIEBAIGludCBodm1fY3JlYXRlX2lv
cmVxX3NlcnZlcihzdHJ1Y3QgZG9tYWluICpkLCBpbnQgYnVmaW9yZXFfaGFuZGxpbmcsCiAgICAg
aWYgKCBpID49IE1BWF9OUl9JT1JFUV9TRVJWRVJTICkKICAgICAgICAgZ290byBmYWlsOwogCisg
ICAgQVNTRVJUKGkgPCBNQVhfTlJfRVhURVJOQUxfSU9SRVFfU0VSVkVSUworICAgICAgICAgICA/
ICFpbnRlcm5hbAorICAgICAgICAgICA6IGludGVybmFsICYmIGkgPCBNQVhfTlJfSU9SRVFfU0VS
VkVSUyk7CisKICAgICAvKgogICAgICAqIEl0IGlzIHNhZmUgdG8gY2FsbCBzZXRfaW9yZXFfc2Vy
dmVyKCkgcHJpb3IgdG8KICAgICAgKiBodm1faW9yZXFfc2VydmVyX2luaXQoKSBzaW5jZSB0aGUg
dGFyZ2V0IGRvbWFpbiBpcyBwYXVzZWQuCkBAIC04NTUsNiArODg0LDggQEAgaW50IGh2bV9kZXN0
cm95X2lvcmVxX3NlcnZlcihzdHJ1Y3QgZG9tYWluICpkLCBpb3NlcnZpZF90IGlkKQogICAgIHN0
cnVjdCBodm1faW9yZXFfc2VydmVyICpzOwogICAgIGludCByYzsKIAorICAgIEFTU0VSVCghaHZt
X2lvcmVxX2lzX2ludGVybmFsKGlkKSk7CisKICAgICBzcGluX2xvY2tfcmVjdXJzaXZlKCZkLT5h
cmNoLmh2bS5pb3JlcV9zZXJ2ZXIubG9jayk7CiAKICAgICBzID0gZ2V0X2lvcmVxX3NlcnZlcihk
LCBpZCk7CkBAIC04NjQsNiArODk1LDcgQEAgaW50IGh2bV9kZXN0cm95X2lvcmVxX3NlcnZlcihz
dHJ1Y3QgZG9tYWluICpkLCBpb3NlcnZpZF90IGlkKQogICAgICAgICBnb3RvIG91dDsKIAogICAg
IHJjID0gLUVQRVJNOworICAgIC8qIE5COiBpbnRlcm5hbCBzZXJ2ZXJzIGNhbm5vdCBiZSBkZXN0
cm95ZWQuICovCiAgICAgaWYgKCBzLT5lbXVsYXRvciAhPSBjdXJyZW50LT5kb21haW4gKQogICAg
ICAgICBnb3RvIG91dDsKIApAQCAtODcxLDEzICs5MDMsMTMgQEAgaW50IGh2bV9kZXN0cm95X2lv
cmVxX3NlcnZlcihzdHJ1Y3QgZG9tYWluICpkLCBpb3NlcnZpZF90IGlkKQogCiAgICAgcDJtX3Nl
dF9pb3JlcV9zZXJ2ZXIoZCwgMCwgaWQpOwogCi0gICAgaHZtX2lvcmVxX3NlcnZlcl9kaXNhYmxl
KHMpOworICAgIGh2bV9pb3JlcV9zZXJ2ZXJfZGlzYWJsZShzLCBodm1faW9yZXFfaXNfaW50ZXJu
YWwoaWQpKTsKIAogICAgIC8qCiAgICAgICogSXQgaXMgc2FmZSB0byBjYWxsIGh2bV9pb3JlcV9z
ZXJ2ZXJfZGVpbml0KCkgcHJpb3IgdG8KICAgICAgKiBzZXRfaW9yZXFfc2VydmVyKCkgc2luY2Ug
dGhlIHRhcmdldCBkb21haW4gaXMgcGF1c2VkLgogICAgICAqLwotICAgIGh2bV9pb3JlcV9zZXJ2
ZXJfZGVpbml0KHMpOworICAgIGh2bV9pb3JlcV9zZXJ2ZXJfZGVpbml0KHMsIGZhbHNlKTsKICAg
ICBzZXRfaW9yZXFfc2VydmVyKGQsIGlkLCBOVUxMKTsKIAogICAgIGRvbWFpbl91bnBhdXNlKGQp
OwpAQCAtOTAwLDYgKzkzMiw4IEBAIGludCBodm1fZ2V0X2lvcmVxX3NlcnZlcl9pbmZvKHN0cnVj
dCBkb21haW4gKmQsIGlvc2VydmlkX3QgaWQsCiAgICAgc3RydWN0IGh2bV9pb3JlcV9zZXJ2ZXIg
KnM7CiAgICAgaW50IHJjOwogCisgICAgQVNTRVJUKCFodm1faW9yZXFfaXNfaW50ZXJuYWwoaWQp
KTsKKwogICAgIHNwaW5fbG9ja19yZWN1cnNpdmUoJmQtPmFyY2guaHZtLmlvcmVxX3NlcnZlci5s
b2NrKTsKIAogICAgIHMgPSBnZXRfaW9yZXFfc2VydmVyKGQsIGlkKTsKQEAgLTkwOSw2ICs5NDMs
NyBAQCBpbnQgaHZtX2dldF9pb3JlcV9zZXJ2ZXJfaW5mbyhzdHJ1Y3QgZG9tYWluICpkLCBpb3Nl
cnZpZF90IGlkLAogICAgICAgICBnb3RvIG91dDsKIAogICAgIHJjID0gLUVQRVJNOworICAgIC8q
IE5COiBkb24ndCBhbGxvdyBmZXRjaGluZyBpbmZvcm1hdGlvbiBmcm9tIGludGVybmFsIGlvcmVx
IHNlcnZlcnMuICovCiAgICAgaWYgKCBzLT5lbXVsYXRvciAhPSBjdXJyZW50LT5kb21haW4gKQog
ICAgICAgICBnb3RvIG91dDsKIApAQCAtOTU2LDcgKzk5MSw3IEBAIGludCBodm1fZ2V0X2lvcmVx
X3NlcnZlcl9mcmFtZShzdHJ1Y3QgZG9tYWluICpkLCBpb3NlcnZpZF90IGlkLAogICAgICAgICBn
b3RvIG91dDsKIAogICAgIHJjID0gLUVQRVJNOwotICAgIGlmICggcy0+ZW11bGF0b3IgIT0gY3Vy
cmVudC0+ZG9tYWluICkKKyAgICBpZiAoIGh2bV9pb3JlcV9pc19pbnRlcm5hbChpZCkgfHwgcy0+
ZW11bGF0b3IgIT0gY3VycmVudC0+ZG9tYWluICkKICAgICAgICAgZ290byBvdXQ7CiAKICAgICBy
YyA9IGh2bV9pb3JlcV9zZXJ2ZXJfYWxsb2NfcGFnZXMocyk7CkBAIC0xMDEwLDcgKzEwNDUsNyBA
QCBpbnQgaHZtX21hcF9pb19yYW5nZV90b19pb3JlcV9zZXJ2ZXIoc3RydWN0IGRvbWFpbiAqZCwg
aW9zZXJ2aWRfdCBpZCwKICAgICAgICAgZ290byBvdXQ7CiAKICAgICByYyA9IC1FUEVSTTsKLSAg
ICBpZiAoIHMtPmVtdWxhdG9yICE9IGN1cnJlbnQtPmRvbWFpbiApCisgICAgaWYgKCAhaHZtX2lv
cmVxX2lzX2ludGVybmFsKGlkKSAmJiBzLT5lbXVsYXRvciAhPSBjdXJyZW50LT5kb21haW4gKQog
ICAgICAgICBnb3RvIG91dDsKIAogICAgIHN3aXRjaCAoIHR5cGUgKQpAQCAtMTA2Miw3ICsxMDk3
LDcgQEAgaW50IGh2bV91bm1hcF9pb19yYW5nZV9mcm9tX2lvcmVxX3NlcnZlcihzdHJ1Y3QgZG9t
YWluICpkLCBpb3NlcnZpZF90IGlkLAogICAgICAgICBnb3RvIG91dDsKIAogICAgIHJjID0gLUVQ
RVJNOwotICAgIGlmICggcy0+ZW11bGF0b3IgIT0gY3VycmVudC0+ZG9tYWluICkKKyAgICBpZiAo
ICFodm1faW9yZXFfaXNfaW50ZXJuYWwoaWQpICYmIHMtPmVtdWxhdG9yICE9IGN1cnJlbnQtPmRv
bWFpbiApCiAgICAgICAgIGdvdG8gb3V0OwogCiAgICAgc3dpdGNoICggdHlwZSApCkBAIC0xMTA4
LDYgKzExNDMsOCBAQCBpbnQgaHZtX21hcF9tZW1fdHlwZV90b19pb3JlcV9zZXJ2ZXIoc3RydWN0
IGRvbWFpbiAqZCwgaW9zZXJ2aWRfdCBpZCwKICAgICBzdHJ1Y3QgaHZtX2lvcmVxX3NlcnZlciAq
czsKICAgICBpbnQgcmM7CiAKKyAgICBBU1NFUlQoIWh2bV9pb3JlcV9pc19pbnRlcm5hbChpZCkp
OworCiAgICAgaWYgKCB0eXBlICE9IEhWTU1FTV9pb3JlcV9zZXJ2ZXIgKQogICAgICAgICByZXR1
cm4gLUVJTlZBTDsKIApAQCAtMTE1NywxNSArMTE5NCwxNSBAQCBpbnQgaHZtX3NldF9pb3JlcV9z
ZXJ2ZXJfc3RhdGUoc3RydWN0IGRvbWFpbiAqZCwgaW9zZXJ2aWRfdCBpZCwKICAgICAgICAgZ290
byBvdXQ7CiAKICAgICByYyA9IC1FUEVSTTsKLSAgICBpZiAoIHMtPmVtdWxhdG9yICE9IGN1cnJl
bnQtPmRvbWFpbiApCisgICAgaWYgKCAhaHZtX2lvcmVxX2lzX2ludGVybmFsKGlkKSAmJiBzLT5l
bXVsYXRvciAhPSBjdXJyZW50LT5kb21haW4gKQogICAgICAgICBnb3RvIG91dDsKIAogICAgIGRv
bWFpbl9wYXVzZShkKTsKIAogICAgIGlmICggZW5hYmxlZCApCi0gICAgICAgIGh2bV9pb3JlcV9z
ZXJ2ZXJfZW5hYmxlKHMpOworICAgICAgICBodm1faW9yZXFfc2VydmVyX2VuYWJsZShzLCBodm1f
aW9yZXFfaXNfaW50ZXJuYWwoaWQpKTsKICAgICBlbHNlCi0gICAgICAgIGh2bV9pb3JlcV9zZXJ2
ZXJfZGlzYWJsZShzKTsKKyAgICAgICAgaHZtX2lvcmVxX3NlcnZlcl9kaXNhYmxlKHMsIGh2bV9p
b3JlcV9pc19pbnRlcm5hbChpZCkpOwogCiAgICAgZG9tYWluX3VucGF1c2UoZCk7CiAKQEAgLTEx
ODQsNyArMTIyMSw3IEBAIGludCBodm1fYWxsX2lvcmVxX3NlcnZlcnNfYWRkX3ZjcHUoc3RydWN0
IGRvbWFpbiAqZCwgc3RydWN0IHZjcHUgKnYpCiAKICAgICBzcGluX2xvY2tfcmVjdXJzaXZlKCZk
LT5hcmNoLmh2bS5pb3JlcV9zZXJ2ZXIubG9jayk7CiAKLSAgICBGT1JfRUFDSF9JT1JFUV9TRVJW
RVIoZCwgaWQsIHMpCisgICAgRk9SX0VBQ0hfRVhURVJOQUxfSU9SRVFfU0VSVkVSKGQsIGlkLCBz
KQogICAgIHsKICAgICAgICAgcmMgPSBodm1faW9yZXFfc2VydmVyX2FkZF92Y3B1KHMsIHYpOwog
ICAgICAgICBpZiAoIHJjICkKQEAgLTEyMTgsNyArMTI1NSw3IEBAIHZvaWQgaHZtX2FsbF9pb3Jl
cV9zZXJ2ZXJzX3JlbW92ZV92Y3B1KHN0cnVjdCBkb21haW4gKmQsIHN0cnVjdCB2Y3B1ICp2KQog
CiAgICAgc3Bpbl9sb2NrX3JlY3Vyc2l2ZSgmZC0+YXJjaC5odm0uaW9yZXFfc2VydmVyLmxvY2sp
OwogCi0gICAgRk9SX0VBQ0hfSU9SRVFfU0VSVkVSKGQsIGlkLCBzKQorICAgIEZPUl9FQUNIX0VY
VEVSTkFMX0lPUkVRX1NFUlZFUihkLCBpZCwgcykKICAgICAgICAgaHZtX2lvcmVxX3NlcnZlcl9y
ZW1vdmVfdmNwdShzLCB2KTsKIAogICAgIHNwaW5fdW5sb2NrX3JlY3Vyc2l2ZSgmZC0+YXJjaC5o
dm0uaW9yZXFfc2VydmVyLmxvY2spOwpAQCAtMTIzNSwxMyArMTI3MiwxMyBAQCB2b2lkIGh2bV9k
ZXN0cm95X2FsbF9pb3JlcV9zZXJ2ZXJzKHN0cnVjdCBkb21haW4gKmQpCiAKICAgICBGT1JfRUFD
SF9JT1JFUV9TRVJWRVIoZCwgaWQsIHMpCiAgICAgewotICAgICAgICBodm1faW9yZXFfc2VydmVy
X2Rpc2FibGUocyk7CisgICAgICAgIGh2bV9pb3JlcV9zZXJ2ZXJfZGlzYWJsZShzLCBodm1faW9y
ZXFfaXNfaW50ZXJuYWwoaWQpKTsKIAogICAgICAgICAvKgogICAgICAgICAgKiBJdCBpcyBzYWZl
IHRvIGNhbGwgaHZtX2lvcmVxX3NlcnZlcl9kZWluaXQoKSBwcmlvciB0bwogICAgICAgICAgKiBz
ZXRfaW9yZXFfc2VydmVyKCkgc2luY2UgdGhlIHRhcmdldCBkb21haW4gaXMgYmVpbmcgZGVzdHJv
eWVkLgogICAgICAgICAgKi8KLSAgICAgICAgaHZtX2lvcmVxX3NlcnZlcl9kZWluaXQocyk7Cisg
ICAgICAgIGh2bV9pb3JlcV9zZXJ2ZXJfZGVpbml0KHMsIGh2bV9pb3JlcV9pc19pbnRlcm5hbChp
ZCkpOwogICAgICAgICBzZXRfaW9yZXFfc2VydmVyKGQsIGlkLCBOVUxMKTsKIAogICAgICAgICB4
ZnJlZShzKTsKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL2FzbS14ODYvaHZtL2RvbWFpbi5oIGIv
eGVuL2luY2x1ZGUvYXNtLXg4Ni9odm0vZG9tYWluLmgKaW5kZXggNTZhMzJlM2UzNS4uZjA5Y2U5
YjQxNyAxMDA2NDQKLS0tIGEveGVuL2luY2x1ZGUvYXNtLXg4Ni9odm0vZG9tYWluLmgKKysrIGIv
eGVuL2luY2x1ZGUvYXNtLXg4Ni9odm0vZG9tYWluLmgKQEAgLTk3LDcgKzk3LDEwIEBAIHN0cnVj
dCBodm1fcGlfb3BzIHsKICAgICB2b2lkICgqdmNwdV9ibG9jaykoc3RydWN0IHZjcHUgKik7CiB9
OwogCi0jZGVmaW5lIE1BWF9OUl9JT1JFUV9TRVJWRVJTIDgKKyNkZWZpbmUgTUFYX05SX0VYVEVS
TkFMX0lPUkVRX1NFUlZFUlMgOAorI2RlZmluZSBNQVhfTlJfSU5URVJOQUxfSU9SRVFfU0VSVkVS
UyAxCisjZGVmaW5lIE1BWF9OUl9JT1JFUV9TRVJWRVJTIFwKKyAgICAoTUFYX05SX0VYVEVSTkFM
X0lPUkVRX1NFUlZFUlMgKyBNQVhfTlJfSU5URVJOQUxfSU9SRVFfU0VSVkVSUykKIAogc3RydWN0
IGh2bV9kb21haW4gewogICAgIC8qIEd1ZXN0IHBhZ2UgcmFuZ2UgdXNlZCBmb3Igbm9uLWRlZmF1
bHQgaW9yZXEgc2VydmVycyAqLwpkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUvYXNtLXg4Ni9odm0v
aW9yZXEuaCBiL3hlbi9pbmNsdWRlL2FzbS14ODYvaHZtL2lvcmVxLmgKaW5kZXggNjU0OTFjNDhk
Mi4uYzM5MTdhYTc0ZCAxMDA2NDQKLS0tIGEveGVuL2luY2x1ZGUvYXNtLXg4Ni9odm0vaW9yZXEu
aAorKysgYi94ZW4vaW5jbHVkZS9hc20teDg2L2h2bS9pb3JlcS5oCkBAIC0yNCw3ICsyNCw3IEBA
IGJvb2wgaGFuZGxlX2h2bV9pb19jb21wbGV0aW9uKHN0cnVjdCB2Y3B1ICp2KTsKIGJvb2wgaXNf
aW9yZXFfc2VydmVyX3BhZ2Uoc3RydWN0IGRvbWFpbiAqZCwgY29uc3Qgc3RydWN0IHBhZ2VfaW5m
byAqcGFnZSk7CiAKIGludCBodm1fY3JlYXRlX2lvcmVxX3NlcnZlcihzdHJ1Y3QgZG9tYWluICpk
LCBpbnQgYnVmaW9yZXFfaGFuZGxpbmcsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW9z
ZXJ2aWRfdCAqaWQpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlvc2VydmlkX3QgKmlk
LCBib29sIGludGVybmFsKTsKIGludCBodm1fZGVzdHJveV9pb3JlcV9zZXJ2ZXIoc3RydWN0IGRv
bWFpbiAqZCwgaW9zZXJ2aWRfdCBpZCk7CiBpbnQgaHZtX2dldF9pb3JlcV9zZXJ2ZXJfaW5mbyhz
dHJ1Y3QgZG9tYWluICpkLCBpb3NlcnZpZF90IGlkLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgdW5zaWduZWQgbG9uZyAqaW9yZXFfZ2ZuLApAQCAtNTQsNiArNTQsMTIgQEAgdW5zaWdu
ZWQgaW50IGh2bV9icm9hZGNhc3RfaW9yZXEoaW9yZXFfdCAqcCwgYm9vbCBidWZmZXJlZCk7CiAK
IHZvaWQgaHZtX2lvcmVxX2luaXQoc3RydWN0IGRvbWFpbiAqZCk7CiAKK3N0YXRpYyBpbmxpbmUg
Ym9vbCBodm1faW9yZXFfaXNfaW50ZXJuYWwodW5zaWduZWQgaW50IGlkKQoreworICAgIEFTU0VS
VChpZCA8IE1BWF9OUl9JT1JFUV9TRVJWRVJTKTsKKyAgICByZXR1cm4gaWQgPj0gTUFYX05SX0VY
VEVSTkFMX0lPUkVRX1NFUlZFUlM7Cit9CisKICNlbmRpZiAvKiBfX0FTTV9YODZfSFZNX0lPUkVR
X0hfXyAqLwogCiAvKgotLSAKMi4yMy4wCgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMu
eGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3Rp
bmZvL3hlbi1kZXZlbA==

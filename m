Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 34DACB2A20
	for <lists+xen-devel@lfdr.de>; Sat, 14 Sep 2019 08:45:25 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i91lJ-0005M4-QC; Sat, 14 Sep 2019 06:42:25 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=rDpt=XJ=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1i91lH-0005Lz-T9
 for xen-devel@lists.xenproject.org; Sat, 14 Sep 2019 06:42:23 +0000
X-Inumbo-ID: cdaaeb92-d6ba-11e9-978d-bc764e2007e4
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id cdaaeb92-d6ba-11e9-978d-bc764e2007e4;
 Sat, 14 Sep 2019 06:42:21 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id CCE97AD82;
 Sat, 14 Sep 2019 06:42:20 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Sat, 14 Sep 2019 08:42:17 +0200
Message-Id: <20190914064217.4877-1-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
Subject: [Xen-devel] [PATCH v2] xen/sched: rework and rename
 vcpu_force_reschedule()
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>,
 Dario Faggioli <dfaggioli@suse.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

dmNwdV9mb3JjZV9yZXNjaGVkdWxlKCkgaXMgb25seSB1c2VkIGZvciBtb2RpZnlpbmcgdGhlIHBl
cmlvZGljIHRpbWVyCm9mIGEgdmNwdS4gRm9yY2luZyBhIHZjcHUgdG8gZ2l2ZSB1cCB0aGUgcGh5
c2ljYWwgY3B1IGZvciB0aGF0IHB1cnBvc2UKaXMga2luZCBvZiBicnV0YWwuCgpTbyBpbnN0ZWFk
IG9mIGRvaW5nIHRoZSByZXNjaGVkdWxlIGRhbmNlIGp1c3Qgb3BlcmF0ZSBvbiB0aGUgdGltZXIK
ZGlyZWN0bHkuIEJ5IHByb3RlY3RpbmcgcGVyaW9kaWMgdGltZXIgbW9kaWZpY2F0aW9ucyBhZ2Fp
bnN0IGNvbmN1cnJlbnQKdGltZXIgYWN0aXZhdGlvbiB2aWEgYSBwZXItdmNwdSBsb2NrIGl0IGlz
IGV2ZW4gbm8gbG9uZ2VyIHJlcXVpcmVkIHRvCmJvdGhlciB0aGUgdGFyZ2V0IHZjcHUgYXQgYWxs
IGZvciB1cGRhdGluZyBpdHMgdGltZXIuCgpSZW5hbWUgdGhlIGZ1bmN0aW9uIHRvIHZjcHVfc2V0
X3BlcmlvZGljX3RpbWVyKCkgYXMgdGhpcyBub3cgcmVmbGVjdHMKdGhlIGZ1bmN0aW9uYWxpdHku
CgpTaWduZWQtb2ZmLWJ5OiBKdWVyZ2VuIEdyb3NzIDxqZ3Jvc3NAc3VzZS5jb20+Ci0tLQotIENh
cnZlZCBvdXQgZnJvbSBteSBjb3JlIHNjaGVkdWxpbmcgc2VyaWVzCi0gUmV3b3JrZWQgdG8gYXZv
aWQgZGVhZGxvY2sgd2hlbiAyIHZjcHVzIGFyZSB0cnlpbmcgdG8gbW9kaWZ5IGVhY2gKICBvdGhl
cnMgcGVyaW9kaWMgdGltZXJzLCBsZWFkaW5nIHRvIGFkZHJlc3MgYWxsIGNvbW1lbnRzIGJ5IEph
bgogIEJldWxpY2guClYyOgotIHRlc3QgcGVyaW9kaWNfcGVyaW9kIGFnYWluIGluIHZjcHVfcGVy
aW9kaWNfdGltZXJfd29yaygpIHdoZW4gbG9jawogIG9idGFpbmVkIChKYW4gQmV1bGljaCkKLS0t
CiB4ZW4vYXJjaC94ODYvcHYvc2hpbS5jICB8ICA0ICstLS0KIHhlbi9jb21tb24vZG9tYWluLmMg
ICAgIHwgIDYgKystLS0tCiB4ZW4vY29tbW9uL3NjaGVkdWxlLmMgICB8IDUzICsrKysrKysrKysr
KysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLS0tLS0KIHhlbi9pbmNsdWRlL3hlbi9z
Y2hlZC5oIHwgIDMgKystCiA0IGZpbGVzIGNoYW5nZWQsIDM1IGluc2VydGlvbnMoKyksIDMxIGRl
bGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9wdi9zaGltLmMgYi94ZW4vYXJj
aC94ODYvcHYvc2hpbS5jCmluZGV4IDMyNGNhMjdmOTMuLjVlZGJjZDlhYzUgMTAwNjQ0Ci0tLSBh
L3hlbi9hcmNoL3g4Ni9wdi9zaGltLmMKKysrIGIveGVuL2FyY2gveDg2L3B2L3NoaW0uYwpAQCAt
NDEwLDcgKzQxMCw3IEBAIGludCBwdl9zaGltX3NodXRkb3duKHVpbnQ4X3QgcmVhc29uKQogICAg
ICAgICB1bm1hcF92Y3B1X2luZm8odik7CiAKICAgICAgICAgLyogUmVzZXQgdGhlIHBlcmlvZGlj
IHRpbWVyIHRvIHRoZSBkZWZhdWx0IHZhbHVlLiAqLwotICAgICAgICB2LT5wZXJpb2RpY19wZXJp
b2QgPSBNSUxMSVNFQ1MoMTApOworICAgICAgICB2Y3B1X3NldF9wZXJpb2RpY190aW1lcih2LCBN
SUxMSVNFQ1MoMTApKTsKICAgICAgICAgLyogU3RvcCB0aGUgc2luZ2xlc2hvdCB0aW1lci4gKi8K
ICAgICAgICAgc3RvcF90aW1lcigmdi0+c2luZ2xlc2hvdF90aW1lcik7CiAKQEAgLTQxOSw4ICs0
MTksNiBAQCBpbnQgcHZfc2hpbV9zaHV0ZG93bih1aW50OF90IHJlYXNvbikKIAogICAgICAgICBp
ZiAoIHYgIT0gY3VycmVudCApCiAgICAgICAgICAgICB2Y3B1X3VucGF1c2VfYnlfc3lzdGVtY29u
dHJvbGxlcih2KTsKLSAgICAgICAgZWxzZQotICAgICAgICAgICAgdmNwdV9mb3JjZV9yZXNjaGVk
dWxlKHYpOwogICAgIH0KIAogICAgIHJldHVybiAwOwpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9k
b21haW4uYyBiL3hlbi9jb21tb24vZG9tYWluLmMKaW5kZXggOWE0OGIyNTA0Yi4uMGNmZjc0OWJi
ZSAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9kb21haW4uYworKysgYi94ZW4vY29tbW9uL2RvbWFp
bi5jCkBAIC0xNDk0LDE1ICsxNDk0LDEzIEBAIGxvbmcgZG9fdmNwdV9vcChpbnQgY21kLCB1bnNp
Z25lZCBpbnQgdmNwdWlkLCBYRU5fR1VFU1RfSEFORExFX1BBUkFNKHZvaWQpIGFyZykKICAgICAg
ICAgaWYgKCBzZXQucGVyaW9kX25zID4gU1RJTUVfREVMVEFfTUFYICkKICAgICAgICAgICAgIHJl
dHVybiAtRUlOVkFMOwogCi0gICAgICAgIHYtPnBlcmlvZGljX3BlcmlvZCA9IHNldC5wZXJpb2Rf
bnM7Ci0gICAgICAgIHZjcHVfZm9yY2VfcmVzY2hlZHVsZSh2KTsKKyAgICAgICAgdmNwdV9zZXRf
cGVyaW9kaWNfdGltZXIodiwgc2V0LnBlcmlvZF9ucyk7CiAKICAgICAgICAgYnJlYWs7CiAgICAg
fQogCiAgICAgY2FzZSBWQ1BVT1Bfc3RvcF9wZXJpb2RpY190aW1lcjoKLSAgICAgICAgdi0+cGVy
aW9kaWNfcGVyaW9kID0gMDsKLSAgICAgICAgdmNwdV9mb3JjZV9yZXNjaGVkdWxlKHYpOworICAg
ICAgICB2Y3B1X3NldF9wZXJpb2RpY190aW1lcih2LCAwKTsKICAgICAgICAgYnJlYWs7CiAKICAg
ICBjYXNlIFZDUFVPUF9zZXRfc2luZ2xlc2hvdF90aW1lcjoKZGlmZiAtLWdpdCBhL3hlbi9jb21t
b24vc2NoZWR1bGUuYyBiL3hlbi9jb21tb24vc2NoZWR1bGUuYwppbmRleCBmZGVlYzEwYzNiLi4x
M2I1ZmZjN2NmIDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL3NjaGVkdWxlLmMKKysrIGIveGVuL2Nv
bW1vbi9zY2hlZHVsZS5jCkBAIC0zMTIsNiArMzEyLDcgQEAgaW50IHNjaGVkX2luaXRfdmNwdShz
dHJ1Y3QgdmNwdSAqdiwgdW5zaWduZWQgaW50IHByb2Nlc3NvcikKICAgICB2LT5wcm9jZXNzb3Ig
PSBwcm9jZXNzb3I7CiAKICAgICAvKiBJbml0aWFsaXNlIHRoZSBwZXItdmNwdSB0aW1lcnMuICov
CisgICAgc3Bpbl9sb2NrX2luaXQoJnYtPnBlcmlvZGljX3RpbWVyX2xvY2spOwogICAgIGluaXRf
dGltZXIoJnYtPnBlcmlvZGljX3RpbWVyLCB2Y3B1X3BlcmlvZGljX3RpbWVyX2ZuLAogICAgICAg
ICAgICAgICAgdiwgdi0+cHJvY2Vzc29yKTsKICAgICBpbml0X3RpbWVyKCZ2LT5zaW5nbGVzaG90
X3RpbWVyLCB2Y3B1X3NpbmdsZXNob3RfdGltZXJfZm4sCkBAIC03MjQsMjQgKzcyNSw2IEBAIHN0
YXRpYyB2b2lkIHZjcHVfbWlncmF0ZV9maW5pc2goc3RydWN0IHZjcHUgKnYpCiAgICAgdmNwdV93
YWtlKHYpOwogfQogCi0vKgotICogRm9yY2UgYSBWQ1BVIHRocm91Z2ggYSBkZXNjaGVkdWxlL3Jl
c2NoZWR1bGUgcGF0aC4KLSAqIEZvciBleGFtcGxlLCB1c2luZyB0aGlzIHdoZW4gc2V0dGluZyB0
aGUgcGVyaW9kaWMgdGltZXIgcGVyaW9kIG1lYW5zIHRoYXQKLSAqIG1vc3QgcGVyaW9kaWMtdGlt
ZXIgc3RhdGUgbmVlZCBvbmx5IGJlIHRvdWNoZWQgZnJvbSB3aXRoaW4gdGhlIHNjaGVkdWxlcgot
ICogd2hpY2ggY2FuIHRodXMgYmUgZG9uZSB3aXRob3V0IG5lZWQgZm9yIHN5bmNocm9uaXNhdGlv
bi4KLSAqLwotdm9pZCB2Y3B1X2ZvcmNlX3Jlc2NoZWR1bGUoc3RydWN0IHZjcHUgKnYpCi17Ci0g
ICAgc3BpbmxvY2tfdCAqbG9jayA9IHZjcHVfc2NoZWR1bGVfbG9ja19pcnEodik7Ci0KLSAgICBp
ZiAoIHYtPmlzX3J1bm5pbmcgKQotICAgICAgICB2Y3B1X21pZ3JhdGVfc3RhcnQodik7Ci0KLSAg
ICB2Y3B1X3NjaGVkdWxlX3VubG9ja19pcnEobG9jaywgdik7Ci0KLSAgICB2Y3B1X21pZ3JhdGVf
ZmluaXNoKHYpOwotfQotCiB2b2lkIHJlc3RvcmVfdmNwdV9hZmZpbml0eShzdHJ1Y3QgZG9tYWlu
ICpkKQogewogICAgIHVuc2lnbmVkIGludCBjcHUgPSBzbXBfcHJvY2Vzc29yX2lkKCk7CkBAIC0x
NDU4LDE0ICsxNDQxLDExIEBAIGxvbmcgc2NoZWRfYWRqdXN0X2dsb2JhbChzdHJ1Y3QgeGVuX3N5
c2N0bF9zY2hlZHVsZXJfb3AgKm9wKQogICAgIHJldHVybiByYzsKIH0KIAotc3RhdGljIHZvaWQg
dmNwdV9wZXJpb2RpY190aW1lcl93b3JrKHN0cnVjdCB2Y3B1ICp2KQorc3RhdGljIHZvaWQgdmNw
dV9wZXJpb2RpY190aW1lcl93b3JrX2xvY2tlZChzdHJ1Y3QgdmNwdSAqdikKIHsKICAgICBzX3Rp
bWVfdCBub3c7CiAgICAgc190aW1lX3QgcGVyaW9kaWNfbmV4dF9ldmVudDsKIAotICAgIGlmICgg
di0+cGVyaW9kaWNfcGVyaW9kID09IDAgKQotICAgICAgICByZXR1cm47Ci0KICAgICBub3cgPSBO
T1coKTsKICAgICBwZXJpb2RpY19uZXh0X2V2ZW50ID0gdi0+cGVyaW9kaWNfbGFzdF9ldmVudCAr
IHYtPnBlcmlvZGljX3BlcmlvZDsKIApAQCAtMTQ3NiwxMCArMTQ1NiwzNyBAQCBzdGF0aWMgdm9p
ZCB2Y3B1X3BlcmlvZGljX3RpbWVyX3dvcmsoc3RydWN0IHZjcHUgKnYpCiAgICAgICAgIHBlcmlv
ZGljX25leHRfZXZlbnQgPSBub3cgKyB2LT5wZXJpb2RpY19wZXJpb2Q7CiAgICAgfQogCi0gICAg
bWlncmF0ZV90aW1lcigmdi0+cGVyaW9kaWNfdGltZXIsIHNtcF9wcm9jZXNzb3JfaWQoKSk7Cisg
ICAgbWlncmF0ZV90aW1lcigmdi0+cGVyaW9kaWNfdGltZXIsIHYtPnByb2Nlc3Nvcik7CiAgICAg
c2V0X3RpbWVyKCZ2LT5wZXJpb2RpY190aW1lciwgcGVyaW9kaWNfbmV4dF9ldmVudCk7CiB9CiAK
K3N0YXRpYyB2b2lkIHZjcHVfcGVyaW9kaWNfdGltZXJfd29yayhzdHJ1Y3QgdmNwdSAqdikKK3sK
KyAgICBpZiAoIHYtPnBlcmlvZGljX3BlcmlvZCA9PSAwICkKKyAgICAgICAgcmV0dXJuOworCisg
ICAgc3Bpbl9sb2NrKCZ2LT5wZXJpb2RpY190aW1lcl9sb2NrKTsKKyAgICBpZiAoIHYtPnBlcmlv
ZGljX3BlcmlvZCApCisgICAgICAgIHZjcHVfcGVyaW9kaWNfdGltZXJfd29ya19sb2NrZWQodik7
CisgICAgc3Bpbl91bmxvY2soJnYtPnBlcmlvZGljX3RpbWVyX2xvY2spOworfQorCisvKgorICog
U2V0IHRoZSBwZXJpb2RpYyB0aW1lciBvZiBhIHZjcHUuCisgKi8KK3ZvaWQgdmNwdV9zZXRfcGVy
aW9kaWNfdGltZXIoc3RydWN0IHZjcHUgKnYsIHNfdGltZV90IHZhbHVlKQoreworICAgIHNwaW5f
bG9jaygmdi0+cGVyaW9kaWNfdGltZXJfbG9jayk7CisKKyAgICBzdG9wX3RpbWVyKCZ2LT5wZXJp
b2RpY190aW1lcik7CisKKyAgICB2LT5wZXJpb2RpY19wZXJpb2QgPSB2YWx1ZTsKKyAgICBpZiAo
IHZhbHVlICkKKyAgICAgICAgdmNwdV9wZXJpb2RpY190aW1lcl93b3JrX2xvY2tlZCh2KTsKKwor
ICAgIHNwaW5fdW5sb2NrKCZ2LT5wZXJpb2RpY190aW1lcl9sb2NrKTsKK30KKwogLyoKICAqIFRo
ZSBtYWluIGZ1bmN0aW9uCiAgKiAtIGRlc2NoZWR1bGUgdGhlIGN1cnJlbnQgZG9tYWluIChzY2hl
ZHVsZXIgaW5kZXBlbmRlbnQpLgpkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUveGVuL3NjaGVkLmgg
Yi94ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaAppbmRleCBlMzYwMWMxOTM1Li40MDA5N2ZmMzM0IDEw
MDY0NAotLS0gYS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaAorKysgYi94ZW4vaW5jbHVkZS94ZW4v
c2NoZWQuaApAQCAtMTUzLDYgKzE1Myw3IEBAIHN0cnVjdCB2Y3B1CiAKICAgICBzdHJ1Y3QgdmNw
dSAgICAgKm5leHRfaW5fbGlzdDsKIAorICAgIHNwaW5sb2NrX3QgICAgICAgcGVyaW9kaWNfdGlt
ZXJfbG9jazsKICAgICBzX3RpbWVfdCAgICAgICAgIHBlcmlvZGljX3BlcmlvZDsKICAgICBzX3Rp
bWVfdCAgICAgICAgIHBlcmlvZGljX2xhc3RfZXZlbnQ7CiAgICAgc3RydWN0IHRpbWVyICAgICBw
ZXJpb2RpY190aW1lcjsKQEAgLTg2NCw3ICs4NjUsNyBAQCBzdHJ1Y3Qgc2NoZWR1bGVyICpzY2hl
ZHVsZXJfZ2V0X2RlZmF1bHQodm9pZCk7CiBzdHJ1Y3Qgc2NoZWR1bGVyICpzY2hlZHVsZXJfYWxs
b2ModW5zaWduZWQgaW50IHNjaGVkX2lkLCBpbnQgKnBlcnIpOwogdm9pZCBzY2hlZHVsZXJfZnJl
ZShzdHJ1Y3Qgc2NoZWR1bGVyICpzY2hlZCk7CiBpbnQgc2NoZWR1bGVfY3B1X3N3aXRjaCh1bnNp
Z25lZCBpbnQgY3B1LCBzdHJ1Y3QgY3B1cG9vbCAqYyk7Ci12b2lkIHZjcHVfZm9yY2VfcmVzY2hl
ZHVsZShzdHJ1Y3QgdmNwdSAqdik7Cit2b2lkIHZjcHVfc2V0X3BlcmlvZGljX3RpbWVyKHN0cnVj
dCB2Y3B1ICp2LCBzX3RpbWVfdCB2YWx1ZSk7CiBpbnQgY3B1X2Rpc2FibGVfc2NoZWR1bGVyKHVu
c2lnbmVkIGludCBjcHUpOwogLyogV2UgbmVlZCBpdCBpbiBkb20wX3NldHVwX3ZjcHUgKi8KIHZv
aWQgc2NoZWRfc2V0X2FmZmluaXR5KHN0cnVjdCB2Y3B1ICp2LCBjb25zdCBjcHVtYXNrX3QgKmhh
cmQsCi0tIAoyLjE2LjQKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0
Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRl
dmVs

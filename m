Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id D2AB714581F
	for <lists+xen-devel@lfdr.de>; Wed, 22 Jan 2020 15:47:15 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iuHFa-0000WS-IK; Wed, 22 Jan 2020 14:44:58 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=8xH2=3L=amazon.co.uk=prvs=28361e846=pdurrant@srs-us1.protection.inumbo.net>)
 id 1iuHFZ-0000WD-WC
 for xen-devel@lists.xenproject.org; Wed, 22 Jan 2020 14:44:58 +0000
X-Inumbo-ID: c27fac9a-3d25-11ea-9fd7-bc764e2007e4
Received: from smtp-fw-4101.amazon.com (unknown [72.21.198.25])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id c27fac9a-3d25-11ea-9fd7-bc764e2007e4;
 Wed, 22 Jan 2020 14:44:57 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amazon.com; i=@amazon.com; q=dns/txt; s=amazon201209;
 t=1579704298; x=1611240298;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=NTN+nLYL47FZLMKXa+HZsaN7UTNai8NyDI/R0TbYg4M=;
 b=jXsvkla+eukSFVXBAd6Q++drFtltH8mfb1XZpk3oNqRr82aODE+rcufI
 RZHFNduvX0CoMvwqOTUDFk8kpaz3h9F6w049yoJetGCsHZD7KY8QOvqau
 Ir3axA1d/NWmTPULZLsXuHX/QlIKbatar+N9CLLQ4DHHWsIRUFlBJXD9M I=;
IronPort-SDR: 66kLv12nUO1vb8vWAoguNOf8VoH0xevBDLpmwuj3Q0WwWerKMYa8cjVPN2pI9m44eMIMv8pUaD
 OXRjZES8nltg==
X-IronPort-AV: E=Sophos;i="5.70,350,1574121600"; d="scan'208";a="13614851"
Received: from iad12-co-svc-p1-lb1-vlan3.amazon.com (HELO
 email-inbound-relay-1d-98acfc19.us-east-1.amazon.com) ([10.43.8.6])
 by smtp-border-fw-out-4101.iad4.amazon.com with ESMTP;
 22 Jan 2020 14:44:56 +0000
Received: from EX13MTAUEA002.ant.amazon.com
 (iad55-ws-svc-p15-lb9-vlan3.iad.amazon.com [10.40.159.166])
 by email-inbound-relay-1d-98acfc19.us-east-1.amazon.com (Postfix) with ESMTPS
 id 5155FA28ED; Wed, 22 Jan 2020 14:44:53 +0000 (UTC)
Received: from EX13D32EUB001.ant.amazon.com (10.43.166.125) by
 EX13MTAUEA002.ant.amazon.com (10.43.61.77) with Microsoft SMTP Server (TLS)
 id 15.0.1236.3; Wed, 22 Jan 2020 14:44:53 +0000
Received: from EX13MTAUEE002.ant.amazon.com (10.43.62.24) by
 EX13D32EUB001.ant.amazon.com (10.43.166.125) with Microsoft SMTP Server (TLS)
 id 15.0.1367.3; Wed, 22 Jan 2020 14:44:52 +0000
Received: from u2f063a87eabd5f.cbg10.amazon.com (10.125.106.135) by
 mail-relay.amazon.com (10.43.62.224) with Microsoft SMTP Server id
 15.0.1367.3 via Frontend Transport; Wed, 22 Jan 2020 14:44:50 +0000
From: Paul Durrant <pdurrant@amazon.com>
To: <xen-devel@lists.xenproject.org>
Date: Wed, 22 Jan 2020 14:44:41 +0000
Message-ID: <20200122144446.919-3-pdurrant@amazon.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20200122144446.919-1-pdurrant@amazon.com>
References: <20200122144446.919-1-pdurrant@amazon.com>
MIME-Version: 1.0
Precedence: Bulk
Subject: [Xen-devel] [PATCH v4 2/7] libxl_create: make 'soft reset' explicit
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Anthony PERARD <anthony.perard@citrix.com>,
 Paul Durrant <pdurrant@amazon.com>, Ian Jackson <ian.jackson@eu.citrix.com>,
 Wei Liu <wl@xen.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhlICdzb2Z0IHJlc2V0JyBjb2RlIHBhdGggaW4gbGlieGxfX2RvbWFpbl9tYWtlKCkgaXMgY3Vy
cmVudGx5IHRha2VuIGlmIGEKdmFsaWQgZG9taWQgaXMgcGFzc2VkIGludG8gdGhlIGZ1bmN0aW9u
LiBBIHN1YnNlcXVlbnQgcGF0Y2ggd2lsbCBlbmFibGUKaGlnaGVyIGxldmVscyBvZiB0aGUgdG9v
bHN0YWNrIHRvIGRldGVybWluZSB0aGUgZG9taWQgb2YgbmV3bHkgY3JlYXRlZCBvcgpyZXN0b3Jl
ZCBkb21haW5zIGFuZCB0aGVyZWZvcmUgdGhpcyBjcml0ZXJpYSBmb3IgY2hvb3NpbmcgJ3NvZnQg
cmVzZXQnCndpbGwgbm8gbG9uZ2VyIGJlIHVzYWJsZS4KClRoaXMgcGF0Y2ggYWRkcyBhbiBleHRy
YSBib29sZWFuIG9wdGlvbiB0byBsaWJ4bF9fZG9tYWluX21ha2UoKSB0byBzcGVjaWZ5CndoZXRo
ZXIgaXQgaXMgYmVpbmcgaW52b2tlZCBpbiBzb2Z0IHJlc2V0IGNvbnRleHQgYW5kIGFwcHJvcHJp
YXRlbHkKbW9kaWZpZXMgY2FsbGVycyB0byBjaG9vc2UgdGhlIHJpZ2h0IHZhbHVlLiBUbyBmYWNp
bGl0YXRlIHRoaXMsIGEgbmV3Cidzb2Z0X3Jlc2V0JyBib29sZWFuIGZpZWxkIGlzIGFkZGVkIHRv
IHN0cnVjdCBsaWJ4bF9fZG9tYWluX2NyZWF0ZV9zdGF0ZQphbmQgdGhlICdkb21pZF9zb2Z0X3Jl
c2V0JyBmaWVsZCBpcyByZW5hbWVkIHRvICdkb21pZCcgaW4gYW50aWNpcGF0aW9uIG9mCml0cyB3
aWRlciByZW1pdC4gRm9yIHRoZSBtb21lbnQgZG9fZG9tYWluX2NyZWF0ZSgpIHdpbGwgYWx3YXlz
IHNldApkb21pZCB0byBJTlZBTElEX0RPTUlEIGFuZCBoZW5jZSB3ZSBjYW4gYWRkIGFuIGFzc2Vy
dGlvbiBpbnRvCmxpYnhsX19kb21haW5fY3JlYXRlKCkgdGhhdCwgaWYgaXQgaXMgbm90IGNhbGxl
ZCBpbiBzb2Z0IHJlc2V0IGNvbnRleHQsCnRoZSBwYXNzZWQgaW4gZG9taWQgaXMgZXhhY3RseSB0
aGF0IHZhbHVlLgoKV2hpbHN0IGluIHRoZSBuZWlnaGJvdXJob29kLCBzb21lIGNoZWNrcyBvZiAn
cmVzdG9yZV9mZCA+IC0xJyBoYXZlIGJlZW4KcmVwbGFjZWQgYnkgJ3Jlc3RvcmVfZmQgPj0gMCcg
dG8gYmUgbW9yZSBjb252ZW50aW9uYWwgYW5kIGNvbnNpc3RlbnQgd2l0aApjaGVja3Mgb2YgJ3Jl
c3RvcmVfZmQgPCAwJy4KClNpZ25lZC1vZmYtYnk6IFBhdWwgRHVycmFudCA8cGR1cnJhbnRAYW1h
em9uLmNvbT4KQWNrZWQtYnk6IElhbiBKYWNrc29uIDxpYW4uamFja3NvbkBldS5jaXRyaXguY29t
PgotLS0KQ2M6IFdlaSBMaXUgPHdsQHhlbi5vcmc+CkNjOiBBbnRob255IFBFUkFSRCA8YW50aG9u
eS5wZXJhcmRAY2l0cml4LmNvbT4KLS0tCiB0b29scy9saWJ4bC9saWJ4bF9jcmVhdGUuYyAgIHwg
NTYgKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tCiB0b29scy9saWJ4bC9saWJ4
bF9kbS5jICAgICAgIHwgIDIgKy0KIHRvb2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmggfCAgNSAr
Ky0tCiAzIGZpbGVzIGNoYW5nZWQsIDM4IGluc2VydGlvbnMoKyksIDI1IGRlbGV0aW9ucygtKQoK
ZGlmZiAtLWdpdCBhL3Rvb2xzL2xpYnhsL2xpYnhsX2NyZWF0ZS5jIGIvdG9vbHMvbGlieGwvbGli
eGxfY3JlYXRlLmMKaW5kZXggOGExYmZmNmNkMy4uNzNhMjg4MzM1NyAxMDA2NDQKLS0tIGEvdG9v
bHMvbGlieGwvbGlieGxfY3JlYXRlLmMKKysrIGIvdG9vbHMvbGlieGwvbGlieGxfY3JlYXRlLmMK
QEAgLTUzOCw3ICs1MzgsNyBAQCBvdXQ6CiAKIGludCBsaWJ4bF9fZG9tYWluX21ha2UobGlieGxf
X2djICpnYywgbGlieGxfZG9tYWluX2NvbmZpZyAqZF9jb25maWcsCiAgICAgICAgICAgICAgICAg
ICAgICAgIGxpYnhsX19kb21haW5fYnVpbGRfc3RhdGUgKnN0YXRlLAotICAgICAgICAgICAgICAg
ICAgICAgICB1aW50MzJfdCAqZG9taWQpCisgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90
ICpkb21pZCwgYm9vbCBzb2Z0X3Jlc2V0KQogewogICAgIGxpYnhsX2N0eCAqY3R4ID0gbGlieGxf
X2djX293bmVyKGdjKTsKICAgICBpbnQgcmV0LCByYywgbmJfdm07CkBAIC01NTUsMTQgKzU1NSwx
NSBAQCBpbnQgbGlieGxfX2RvbWFpbl9tYWtlKGxpYnhsX19nYyAqZ2MsIGxpYnhsX2RvbWFpbl9j
b25maWcgKmRfY29uZmlnLAogICAgIGxpYnhsX2RvbWFpbl9jcmVhdGVfaW5mbyAqaW5mbyA9ICZk
X2NvbmZpZy0+Y19pbmZvOwogICAgIGxpYnhsX2RvbWFpbl9idWlsZF9pbmZvICpiX2luZm8gPSAm
ZF9jb25maWctPmJfaW5mbzsKIAorICAgIGFzc2VydChzb2Z0X3Jlc2V0IHx8ICpkb21pZCA9PSBJ
TlZBTElEX0RPTUlEKTsKKwogICAgIHV1aWRfc3RyaW5nID0gbGlieGxfX3V1aWQyc3RyaW5nKGdj
LCBpbmZvLT51dWlkKTsKICAgICBpZiAoIXV1aWRfc3RyaW5nKSB7CiAgICAgICAgIHJjID0gRVJS
T1JfTk9NRU07CiAgICAgICAgIGdvdG8gb3V0OwogICAgIH0KIAotICAgIC8qIFZhbGlkIGRvbWlk
IGhlcmUgbWVhbnMgd2UncmUgc29mdCByZXNldHRpbmcuICovCi0gICAgaWYgKCFsaWJ4bF9kb21p
ZF92YWxpZF9ndWVzdCgqZG9taWQpKSB7CisgICAgaWYgKCFzb2Z0X3Jlc2V0KSB7CiAgICAgICAg
IHN0cnVjdCB4ZW5fZG9tY3RsX2NyZWF0ZWRvbWFpbiBjcmVhdGUgPSB7CiAgICAgICAgICAgICAu
c3NpZHJlZiA9IGluZm8tPnNzaWRyZWYsCiAgICAgICAgICAgICAubWF4X3ZjcHVzID0gYl9pbmZv
LT5tYXhfdmNwdXMsCkBAIC02MTEsNiArNjEyLDE0IEBAIGludCBsaWJ4bF9fZG9tYWluX21ha2Uo
bGlieGxfX2djICpnYywgbGlieGxfZG9tYWluX2NvbmZpZyAqZF9jb25maWcsCiAgICAgICAgICAg
ICBnb3RvIG91dDsKICAgICB9CiAKKyAgICAvKgorICAgICAqIElmIHNvZnRfcmVzZXQgaXMgc2V0
IHRoZSB0aGUgZG9taWQgd2lsbCBoYXZlIGJlZW4gdmFsaWQgb24gZW50cnkuCisgICAgICogSWYg
aXQgd2FzIG5vdCBzZXQgdGhlbiB4Y19kb21haW5fY3JlYXRlKCkgc2hvdWxkIGhhdmUgYXNzaWdu
ZWQgYQorICAgICAqIHZhbGlkIHZhbHVlLiBFaXRoZXIgd2F5LCBpZiB3ZSByZWFjaCB0aGlzIHBv
aW50LCBkb21pZCBzaG91bGQgYmUKKyAgICAgKiB2YWxpZC4KKyAgICAgKi8KKyAgICBhc3NlcnQo
bGlieGxfZG9taWRfdmFsaWRfZ3Vlc3QoKmRvbWlkKSk7CisKICAgICByZXQgPSB4Y19jcHVwb29s
X21vdmVkb21haW4oY3R4LT54Y2gsIGluZm8tPnBvb2xpZCwgKmRvbWlkKTsKICAgICBpZiAocmV0
IDwgMCkgewogICAgICAgICBMT0dFRChFUlJPUiwgKmRvbWlkLCAiZG9tYWluIG1vdmUgZmFpbCIp
OwpAQCAtMTA5MSwxMyArMTEwMCwxNCBAQCBzdGF0aWMgdm9pZCBpbml0aWF0ZV9kb21haW5fY3Jl
YXRlKGxpYnhsX19lZ2MgKmVnYywKICAgICBsaWJ4bF9kb21haW5fY29uZmlnICpjb25zdCBkX2Nv
bmZpZyA9IGRjcy0+Z3Vlc3RfY29uZmlnOwogICAgIGNvbnN0IGludCByZXN0b3JlX2ZkID0gZGNz
LT5yZXN0b3JlX2ZkOwogCi0gICAgZG9taWQgPSBkY3MtPmRvbWlkX3NvZnRfcmVzZXQ7CisgICAg
ZG9taWQgPSBkY3MtPmRvbWlkOwogICAgIGxpYnhsX19kb21haW5fYnVpbGRfc3RhdGVfaW5pdCgm
ZGNzLT5idWlsZF9zdGF0ZSk7CiAKICAgICByZXQgPSBsaWJ4bF9fZG9tYWluX2NvbmZpZ19zZXRk
ZWZhdWx0KGdjLGRfY29uZmlnLGRvbWlkKTsKICAgICBpZiAocmV0KSBnb3RvIGVycm9yX291dDsK
IAotICAgIHJldCA9IGxpYnhsX19kb21haW5fbWFrZShnYywgZF9jb25maWcsICZkY3MtPmJ1aWxk
X3N0YXRlLCAmZG9taWQpOworICAgIHJldCA9IGxpYnhsX19kb21haW5fbWFrZShnYywgZF9jb25m
aWcsICZkY3MtPmJ1aWxkX3N0YXRlLCAmZG9taWQsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGRjcy0+c29mdF9yZXNldCk7CiAgICAgaWYgKHJldCkgewogICAgICAgICBMT0dEKEVSUk9S
LCBkb21pZCwgImNhbm5vdCBtYWtlIGRvbWFpbjogJWQiLCByZXQpOwogICAgICAgICBkY3MtPmd1
ZXN0X2RvbWlkID0gZG9taWQ7CkBAIC0xMTQxLDcgKzExNTEsNyBAQCBzdGF0aWMgdm9pZCBpbml0
aWF0ZV9kb21haW5fY3JlYXRlKGxpYnhsX19lZ2MgKmVnYywKICAgICBpZiAocmV0KQogICAgICAg
ICBnb3RvIGVycm9yX291dDsKIAotICAgIGlmIChyZXN0b3JlX2ZkID49IDAgfHwgZGNzLT5kb21p
ZF9zb2Z0X3Jlc2V0ICE9IElOVkFMSURfRE9NSUQpIHsKKyAgICBpZiAocmVzdG9yZV9mZCA+PSAw
IHx8IGRjcy0+c29mdF9yZXNldCkgewogICAgICAgICBMT0dEKERFQlVHLCBkb21pZCwgInJlc3Rv
cmluZywgbm90IHJ1bm5pbmcgYm9vdGxvYWRlciIpOwogICAgICAgICBkb21jcmVhdGVfYm9vdGxv
YWRlcl9kb25lKGVnYywgJmRjcy0+YmwsIDApOwogICAgIH0gZWxzZSAgewpAQCAtMTIxNyw3ICsx
MjI3LDcgQEAgc3RhdGljIHZvaWQgZG9tY3JlYXRlX2Jvb3Rsb2FkZXJfZG9uZShsaWJ4bF9fZWdj
ICplZ2MsCiAgICAgZGNzLT5zZHNzLmRtLmNhbGxiYWNrID0gZG9tY3JlYXRlX2Rldm1vZGVsX3N0
YXJ0ZWQ7CiAgICAgZGNzLT5zZHNzLmNhbGxiYWNrID0gZG9tY3JlYXRlX2Rldm1vZGVsX3N0YXJ0
ZWQ7CiAKLSAgICBpZiAocmVzdG9yZV9mZCA8IDAgJiYgZGNzLT5kb21pZF9zb2Z0X3Jlc2V0ID09
IElOVkFMSURfRE9NSUQpIHsKKyAgICBpZiAocmVzdG9yZV9mZCA8IDAgJiYgIWRjcy0+c29mdF9y
ZXNldCkgewogICAgICAgICByYyA9IGxpYnhsX19kb21haW5fYnVpbGQoZ2MsIGRvbWlkLCBkY3Mp
OwogICAgICAgICBkb21jcmVhdGVfcmVidWlsZF9kb25lKGVnYywgZGNzLCByYyk7CiAgICAgICAg
IHJldHVybjsKQEAgLTE4MjcsNyArMTgzNyw3IEBAIHN0YXRpYyBpbnQgZG9fZG9tYWluX2NyZWF0
ZShsaWJ4bF9jdHggKmN0eCwgbGlieGxfZG9tYWluX2NvbmZpZyAqZF9jb25maWcsCiAgICAgbGli
eGxfZG9tYWluX2NvbmZpZ19jb3B5KGN0eCwgJmNkY3MtPmRjcy5ndWVzdF9jb25maWdfc2F2ZWQs
IGRfY29uZmlnKTsKICAgICBjZGNzLT5kY3MucmVzdG9yZV9mZCA9IGNkY3MtPmRjcy5saWJ4Y19m
ZCA9IHJlc3RvcmVfZmQ7CiAgICAgY2Rjcy0+ZGNzLnNlbmRfYmFja19mZCA9IHNlbmRfYmFja19m
ZDsKLSAgICBpZiAocmVzdG9yZV9mZCA+IC0xKSB7CisgICAgaWYgKHJlc3RvcmVfZmQgPj0gMCkg
ewogICAgICAgICBjZGNzLT5kY3MucmVzdG9yZV9wYXJhbXMgPSAqcGFyYW1zOwogICAgICAgICBy
YyA9IGxpYnhsX19mZF9mbGFnc19tb2RpZnlfc2F2ZShnYywgY2Rjcy0+ZGNzLnJlc3RvcmVfZmQs
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH4oT19OT05CTE9DS3xP
X05ERUxBWSksIDAsCkBAIC0xODM1LDcgKzE4NDUsOCBAQCBzdGF0aWMgaW50IGRvX2RvbWFpbl9j
cmVhdGUobGlieGxfY3R4ICpjdHgsIGxpYnhsX2RvbWFpbl9jb25maWcgKmRfY29uZmlnLAogICAg
ICAgICBpZiAocmMgPCAwKSBnb3RvIG91dF9lcnI7CiAgICAgfQogICAgIGNkY3MtPmRjcy5jYWxs
YmFjayA9IGRvbWFpbl9jcmVhdGVfY2I7Ci0gICAgY2Rjcy0+ZGNzLmRvbWlkX3NvZnRfcmVzZXQg
PSBJTlZBTElEX0RPTUlEOworICAgIGNkY3MtPmRjcy5kb21pZCA9IElOVkFMSURfRE9NSUQ7Cisg
ICAgY2Rjcy0+ZGNzLnNvZnRfcmVzZXQgPSBmYWxzZTsKIAogICAgIGlmIChjZGNzLT5kY3MucmVz
dG9yZV9wYXJhbXMuY2hlY2twb2ludGVkX3N0cmVhbSA9PQogICAgICAgICBMSUJYTF9DSEVDS1BP
SU5URURfU1RSRUFNX0NPTE8pIHsKQEAgLTE5MDUsNyArMTkxNiw3IEBAIHN0YXRpYyB2b2lkIHNv
ZnRfcmVzZXRfZG1fc3VzcGVuZGVkKGxpYnhsX19lZ2MgKmVnYywKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGludCByYyk7CiBzdGF0aWMgaW50IGRvX2RvbWFpbl9zb2Z0X3Jl
c2V0KGxpYnhsX2N0eCAqY3R4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ4
bF9kb21haW5fY29uZmlnICpkX2NvbmZpZywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgdWludDMyX3QgZG9taWRfc29mdF9yZXNldCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgdWludDMyX3QgZG9taWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNv
bnN0IGxpYnhsX2FzeW5jb3BfaG93ICphb19ob3csCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGNvbnN0IGxpYnhsX2FzeW5jcHJvZ3Jlc3NfaG93CiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICphb3BfY29uc29sZV9ob3cpCkBAIC0xOTMzLDE1ICsxOTQ0LDE2IEBAIHN0
YXRpYyBpbnQgZG9fZG9tYWluX3NvZnRfcmVzZXQobGlieGxfY3R4ICpjdHgsCiAgICAgbGlieGxf
ZG9tYWluX2NvbmZpZ19jb3B5KGN0eCwgJnNycy0+Y2Rjcy5kY3MuZ3Vlc3RfY29uZmlnX3NhdmVk
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkX2NvbmZpZyk7CiAgICAgY2Rjcy0+ZGNz
LnJlc3RvcmVfZmQgPSAtMTsKLSAgICBjZGNzLT5kY3MuZG9taWRfc29mdF9yZXNldCA9IGRvbWlk
X3NvZnRfcmVzZXQ7CisgICAgY2Rjcy0+ZGNzLmRvbWlkID0gZG9taWQ7CisgICAgY2Rjcy0+ZGNz
LnNvZnRfcmVzZXQgPSB0cnVlOwogICAgIGNkY3MtPmRjcy5jYWxsYmFjayA9IGRvbWFpbl9jcmVh
dGVfY2I7CiAgICAgbGlieGxfX2FvX3Byb2dyZXNzX2dldGhvdygmc3JzLT5jZGNzLmRjcy5hb3Bf
Y29uc29sZV9ob3csCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhb3BfY29uc29sZV9o
b3cpOwogICAgIGNkY3MtPmRvbWlkX291dCA9ICZkb21pZF9vdXQ7CiAKLSAgICBkb21fcGF0aCA9
IGxpYnhsX194c19nZXRfZG9tcGF0aChnYywgZG9taWRfc29mdF9yZXNldCk7CisgICAgZG9tX3Bh
dGggPSBsaWJ4bF9feHNfZ2V0X2RvbXBhdGgoZ2MsIGRvbWlkKTsKICAgICBpZiAoIWRvbV9wYXRo
KSB7Ci0gICAgICAgIExPR0QoRVJST1IsIGRvbWlkX3NvZnRfcmVzZXQsICJmYWlsZWQgdG8gcmVh
ZCBkb21haW4gcGF0aCIpOworICAgICAgICBMT0dEKEVSUk9SLCBkb21pZCwgImZhaWxlZCB0byBy
ZWFkIGRvbWFpbiBwYXRoIik7CiAgICAgICAgIHJjID0gRVJST1JfRkFJTDsKICAgICAgICAgZ290
byBvdXQ7CiAgICAgfQpAQCAtMTk1MCw3ICsxOTYyLDcgQEAgc3RhdGljIGludCBkb19kb21haW5f
c29mdF9yZXNldChsaWJ4bF9jdHggKmN0eCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgR0NTUFJJTlRGKCIlcy9zdG9yZS9yaW5nLXJlZiIsIGRvbV9wYXRoKSwKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgJnhzX3N0b3JlX21mbik7CiAgICAgaWYgKHJjKSB7Ci0gICAg
ICAgIExPR0QoRVJST1IsIGRvbWlkX3NvZnRfcmVzZXQsICJmYWlsZWQgdG8gcmVhZCBzdG9yZS9y
aW5nLXJlZi4iKTsKKyAgICAgICAgTE9HRChFUlJPUiwgZG9taWQsICJmYWlsZWQgdG8gcmVhZCBz
dG9yZS9yaW5nLXJlZi4iKTsKICAgICAgICAgZ290byBvdXQ7CiAgICAgfQogICAgIHN0YXRlLT5z
dG9yZV9tZm4gPSB4c19zdG9yZV9tZm4gPyBhdG9sKHhzX3N0b3JlX21mbik6IDA7CkBAIC0xOTU5
LDcgKzE5NzEsNyBAQCBzdGF0aWMgaW50IGRvX2RvbWFpbl9zb2Z0X3Jlc2V0KGxpYnhsX2N0eCAq
Y3R4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHQ1NQUklOVEYoIiVzL2NvbnNv
bGUvcmluZy1yZWYiLCBkb21fcGF0aCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICZ4c19jb25zb2xlX21mbik7CiAgICAgaWYgKHJjKSB7Ci0gICAgICAgIExPR0QoRVJST1IsIGRv
bWlkX3NvZnRfcmVzZXQsICJmYWlsZWQgdG8gcmVhZCBjb25zb2xlL3JpbmctcmVmLiIpOworICAg
ICAgICBMT0dEKEVSUk9SLCBkb21pZCwgImZhaWxlZCB0byByZWFkIGNvbnNvbGUvcmluZy1yZWYu
Iik7CiAgICAgICAgIGdvdG8gb3V0OwogICAgIH0KICAgICBzdGF0ZS0+Y29uc29sZV9tZm4gPSB4
c19jb25zb2xlX21mbiA/IGF0b2woeHNfY29uc29sZV9tZm4pOiAwOwpAQCAtMTk2OCwyMCArMTk4
MCwyMCBAQCBzdGF0aWMgaW50IGRvX2RvbWFpbl9zb2Z0X3Jlc2V0KGxpYnhsX2N0eCAqY3R4LAog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdDU1BSSU5URigiJXMvY29uc29sZS90
dHkiLCBkb21fcGF0aCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJmNvbnNv
bGVfdHR5KTsKICAgICBpZiAocmMpIHsKLSAgICAgICAgTE9HRChFUlJPUiwgZG9taWRfc29mdF9y
ZXNldCwgImZhaWxlZCB0byByZWFkIGNvbnNvbGUvdHR5LiIpOworICAgICAgICBMT0dEKEVSUk9S
LCBkb21pZCwgImZhaWxlZCB0byByZWFkIGNvbnNvbGUvdHR5LiIpOwogICAgICAgICBnb3RvIG91
dDsKICAgICB9CiAgICAgc3RhdGUtPmNvbnNvbGVfdHR5ID0gbGlieGxfX3N0cmR1cChnYywgY29u
c29sZV90dHkpOwogCiAgICAgZHNzLT5hbyA9IGFvOwotICAgIGRzcy0+ZG9taWQgPSBkc3MtPmRz
cHMuZG9taWQgPSBkb21pZF9zb2Z0X3Jlc2V0OworICAgIGRzcy0+ZG9taWQgPSBkc3MtPmRzcHMu
ZG9taWQgPSBkb21pZDsKICAgICBkc3MtPmRzcHMuZG1fc2F2ZWZpbGUgPSBHQ1NQUklOVEYoTElC
WExfREVWSUNFX01PREVMX1NBVkVfRklMRSIuJWQiLAotICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBkb21pZF9zb2Z0X3Jlc2V0KTsKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgZG9taWQpOwogCiAgICAgcmMgPSBsaWJ4bF9fc2F2ZV9lbXVsYXRvcl94
ZW5zdG9yZV9kYXRhKGRzcywgJnNycy0+dG9vbHN0YWNrX2J1ZiwKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgJnNycy0+dG9vbHN0YWNrX2xlbik7CiAgICAgaWYg
KHJjKSB7Ci0gICAgICAgIExPR0QoRVJST1IsIGRvbWlkX3NvZnRfcmVzZXQsICJmYWlsZWQgdG8g
c2F2ZSB0b29sc3RhY2sgcmVjb3JkLiIpOworICAgICAgICBMT0dEKEVSUk9SLCBkb21pZCwgImZh
aWxlZCB0byBzYXZlIHRvb2xzdGFjayByZWNvcmQuIik7CiAgICAgICAgIGdvdG8gb3V0OwogICAg
IH0KIApAQCAtMjAxMCwxMCArMjAyMiwxMCBAQCBzdGF0aWMgdm9pZCBzb2Z0X3Jlc2V0X2RtX3N1
c3BlbmRlZChsaWJ4bF9fZWdjICplZ2MsCiAgICAgICogeGVuc3RvcmUgYWdhaW4gd2l0aCBwcm9i
YWJseSBkaWZmZXJlbnQgc3RvcmUvY29uc29sZS8uLi4KICAgICAgKiBjaGFubmVscy4KICAgICAg
Ki8KLSAgICB4c19yZWxlYXNlX2RvbWFpbihDVFgtPnhzaCwgY2Rjcy0+ZGNzLmRvbWlkX3NvZnRf
cmVzZXQpOworICAgIHhzX3JlbGVhc2VfZG9tYWluKENUWC0+eHNoLCBjZGNzLT5kY3MuZG9taWQp
OwogCiAgICAgc3JzLT5kZHMuYW8gPSBhbzsKLSAgICBzcnMtPmRkcy5kb21pZCA9IGNkY3MtPmRj
cy5kb21pZF9zb2Z0X3Jlc2V0OworICAgIHNycy0+ZGRzLmRvbWlkID0gY2Rjcy0+ZGNzLmRvbWlk
OwogICAgIHNycy0+ZGRzLmNhbGxiYWNrID0gZG9tYWluX3NvZnRfcmVzZXRfY2I7CiAgICAgc3Jz
LT5kZHMuc29mdF9yZXNldCA9IHRydWU7CiAgICAgbGlieGxfX2RvbWFpbl9kZXN0cm95KGVnYywg
JnNycy0+ZGRzKTsKQEAgLTIwMjksNyArMjA0MSw3IEBAIHN0YXRpYyB2b2lkIGRvbWFpbl9jcmVh
dGVfY2IobGlieGxfX2VnYyAqZWdjLAogCiAgICAgKmNkY3MtPmRvbWlkX291dCA9IGRvbWlkOwog
Ci0gICAgaWYgKGRjcy0+cmVzdG9yZV9mZCA+IC0xKSB7CisgICAgaWYgKGRjcy0+cmVzdG9yZV9m
ZCA+PSAwKSB7CiAgICAgICAgIGZscmMgPSBsaWJ4bF9fZmRfZmxhZ3NfcmVzdG9yZShnYywKICAg
ICAgICAgICAgICAgICBkY3MtPnJlc3RvcmVfZmQsIGRjcy0+cmVzdG9yZV9mZGZsKTsKICAgICAg
ICAgLyoKZGlmZiAtLWdpdCBhL3Rvb2xzL2xpYnhsL2xpYnhsX2RtLmMgYi90b29scy9saWJ4bC9s
aWJ4bF9kbS5jCmluZGV4IDNmMDhjY2FkMWIuLjJiZDkyZmIxZGYgMTAwNjQ0Ci0tLSBhL3Rvb2xz
L2xpYnhsL2xpYnhsX2RtLmMKKysrIGIvdG9vbHMvbGlieGwvbGlieGxfZG0uYwpAQCAtMjE5NCw3
ICsyMTk0LDcgQEAgdm9pZCBsaWJ4bF9fc3Bhd25fc3R1Yl9kbShsaWJ4bF9fZWdjICplZ2MsIGxp
YnhsX19kb21haW5fY3JlYXRlX3N0YXRlICpkY3MpCiAKICAgICAvKiBmaXhtZTogdGhpcyBmdW5j
dGlvbiBjYW4gbGVhayB0aGUgc3R1YmRvbSBpZiBpdCBmYWlscyAqLwogICAgIHJldCA9IGxpYnhs
X19kb21haW5fbWFrZShnYywgZG1fY29uZmlnLCBzdHViZG9tX3N0YXRlLAotICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAmc2Rzcy0+cHZxZW11Lmd1ZXN0X2RvbWlkKTsKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgJnNkc3MtPnB2cWVtdS5ndWVzdF9kb21pZCwgZmFsc2UpOwogICAg
IGlmIChyZXQpCiAgICAgICAgIGdvdG8gb3V0OwogICAgIHVpbnQzMl90IGRtX2RvbWlkID0gc2Rz
cy0+cHZxZW11Lmd1ZXN0X2RvbWlkOwpkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGlieGxfaW50
ZXJuYWwuaCBiL3Rvb2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmgKaW5kZXggZjJmNzUzYzcyYi4u
M2EwMGJkYjhiNCAxMDA2NDQKLS0tIGEvdG9vbHMvbGlieGwvbGlieGxfaW50ZXJuYWwuaAorKysg
Yi90b29scy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5oCkBAIC0xOTU2LDcgKzE5NTYsNyBAQCBfaGlk
ZGVuICB2b2lkIGxpYnhsX19leGVjKGxpYnhsX19nYyAqZ2MsIGludCBzdGRpbmZkLCBpbnQgc3Rk
b3V0ZmQsCiBfaGlkZGVuIGludCBsaWJ4bF9fZG9tYWluX21ha2UobGlieGxfX2djICpnYywKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ4bF9kb21haW5fY29uZmlnICpkX2NvbmZp
ZywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ4bF9fZG9tYWluX2J1aWxkX3N0
YXRlICpzdGF0ZSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCAqZG9t
aWQpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90ICpkb21pZCwgYm9v
bCBzb2Z0X3Jlc2V0KTsKIAogX2hpZGRlbiBpbnQgbGlieGxfX2RvbWFpbl9idWlsZChsaWJ4bF9f
Z2MgKmdjLCB1aW50MzJfdCBkb21pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
bGlieGxfX2RvbWFpbl9jcmVhdGVfc3RhdGUgKmRjcyk7CkBAIC00MTMxLDcgKzQxMzEsOCBAQCBz
dHJ1Y3QgbGlieGxfX2RvbWFpbl9jcmVhdGVfc3RhdGUgewogICAgIGludCByZXN0b3JlX2ZkZmw7
IC8qIG9yaWdpbmFsIGZsYWdzIG9mIHJlc3RvcmVfZmQgKi8KICAgICBpbnQgc2VuZF9iYWNrX2Zk
OwogICAgIGxpYnhsX2RvbWFpbl9yZXN0b3JlX3BhcmFtcyByZXN0b3JlX3BhcmFtczsKLSAgICB1
aW50MzJfdCBkb21pZF9zb2Z0X3Jlc2V0OworICAgIHVpbnQzMl90IGRvbWlkOworICAgIGJvb2wg
c29mdF9yZXNldDsKICAgICBsaWJ4bF9fZG9tYWluX2NyZWF0ZV9jYiAqY2FsbGJhY2s7CiAgICAg
bGlieGxfYXN5bmNwcm9ncmVzc19ob3cgYW9wX2NvbnNvbGVfaG93OwogICAgIC8qIHByaXZhdGUg
dG8gZG9tYWluX2NyZWF0ZSAqLwotLSAKMi4yMC4xCgoKX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxA
bGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFu
L2xpc3RpbmZvL3hlbi1kZXZlbA==

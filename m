Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 97D8414F1A5
	for <lists+xen-devel@lfdr.de>; Fri, 31 Jan 2020 18:52:56 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1ixaQc-000640-Fn; Fri, 31 Jan 2020 17:50:02 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=euI0=3U=gmail.com=wei.liu.xen@srs-us1.protection.inumbo.net>)
 id 1ixaQa-0005yg-JA
 for xen-devel@lists.xenproject.org; Fri, 31 Jan 2020 17:50:00 +0000
X-Inumbo-ID: 0ef49c10-4452-11ea-ad98-bc764e2007e4
Received: from mail-wr1-x441.google.com (unknown [2a00:1450:4864:20::441])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 0ef49c10-4452-11ea-ad98-bc764e2007e4;
 Fri, 31 Jan 2020 17:49:42 +0000 (UTC)
Received: by mail-wr1-x441.google.com with SMTP id y11so9664966wrt.6
 for <xen-devel@lists.xenproject.org>; Fri, 31 Jan 2020 09:49:42 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=sender:from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=rffWGupMx/0ss2WkO2hKOAHYYbHAdj5XTaScjilRkJo=;
 b=Re3AWwiAYDMHkhWreBGqdd2p8pQI6wvZKfsi/j3j4Dngm/Ld0aPvbr1/XbFEFJdU7H
 xxrD3ihqxY1PcxavR+lR/IUR9TlNINeAZT60jL/4KmN6QPunSvJjPbd9jkqv50dC8W4m
 Bn0y5L882CvLI54t/GXmk9YHfqv2f2ejeKsa8rKoNlt2G+MQUzII02hZosX4Yrv8n1eY
 qokl4f2ANzaVqb05GHj6ilj9h4agPYL/8+fCNDiUUYOe7zWWMc7cJ4q7zsXwBFvaxuTU
 NgLGXS9+rYqJhESXFeQiuK5zt8GNHGmoiLTIYDvg8nOjoOWIiUwyiRukR3ZsmPl5J2kh
 6tFQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:sender:from:to:cc:subject:date:message-id
 :in-reply-to:references:mime-version:content-transfer-encoding;
 bh=rffWGupMx/0ss2WkO2hKOAHYYbHAdj5XTaScjilRkJo=;
 b=K0xuDazG++TKaiX4gt7L/MwDDgwSM9Zmq2zaaogF1FqJq3j6ZA401nU1YLfQFRjckN
 Nvgtr9eifeq4liDfA4pBIzK9dne2ESP+swxYu6ezSGCZrItMtDoS6qxdnDjuGJ6a8QWa
 P8w7oaNVZIipTvfJ3DYh+QUTJ8cZWP1xuDxtZxpcW2zGdnPMRH/59dCXW1y8P8PnyBnL
 3XCexLOQQtE8Q9jZzuKqkx5k93g2VZOs0Ooot1EsnGgDvHsz7FS6j0lQvUYbDh+KIiw4
 EiGASMyZSGce1WvAPzvfr560OoMEKmltQSeimsFlA8KGffEVx72lbinTLQSKZe1ZNUTe
 brjg==
X-Gm-Message-State: APjAAAXS1/Dr4qb1DbI6WCnj1+DeFHtE8dA8d20RcY8bXHpMqIE+BWWm
 Yb8AvcVKa5T7I+HCMD65BF14n48bqfg=
X-Google-Smtp-Source: APXvYqxHMUW0mba/78Ye5t1QsiVHR3G4FDLX3+2C1XePNLGkYvqQG04xIx2jcdb5e34NMoCAaYQsMw==
X-Received: by 2002:a5d:5283:: with SMTP id c3mr13719944wrv.148.1580492981122; 
 Fri, 31 Jan 2020 09:49:41 -0800 (PST)
Received: from localhost.localdomain (41.142.6.51.dyn.plus.net. [51.6.142.41])
 by smtp.gmail.com with ESMTPSA id
 133sm4364352wmd.5.2020.01.31.09.49.40
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Fri, 31 Jan 2020 09:49:40 -0800 (PST)
From: Wei Liu <wl@xen.org>
X-Google-Original-From: Wei Liu <liuwe@microsoft.com>
To: Xen Development List <xen-devel@lists.xenproject.org>
Date: Fri, 31 Jan 2020 17:49:24 +0000
Message-Id: <20200131174930.31045-6-liuwe@microsoft.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20200131174930.31045-1-liuwe@microsoft.com>
References: <20200131174930.31045-1-liuwe@microsoft.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v6 05/11] x86/hyperv: setup hypercall page
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Wei Liu <liuwe@microsoft.com>, Wei Liu <wl@xen.org>,
 Andrew Cooper <andrew.cooper3@citrix.com>, Paul Durrant <pdurrant@amazon.com>,
 Michael Kelley <mikelley@microsoft.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SHlwZXItViB1c2VzIGEgdGVjaG5pcXVlIGNhbGxlZCBvdmVybGF5IHBhZ2UgZm9yIGl0cyBoeXBl
cmNhbGwgcGFnZS4gSXQKd2lsbCBpbnNlcnQgYSBiYWNraW5nIHBhZ2UgdG8gdGhlIGd1ZXN0IHdo
ZW4gdGhlIGh5cGVyY2FsbCBmdW5jdGlvbmFsaXR5CmlzIGVuYWJsZWQuIFRoYXQgbWVhbnMgd2Ug
Y2FuIHVzZSBhIHBhZ2UgdGhhdCBpcyBub3QgYmFja2VkIGJ5IHJlYWwKbWVtb3J5IGZvciBoeXBl
cmNhbGwgcGFnZS4KClVzZSB0aGUgdG9wLW1vc3QgYWRkcmVzc2FibGUgcGFnZSBmb3IgdGhhdCBw
dXJwb3NlLiBBZGp1c3QgZTgyMCBtYXAKYWNjb3JkaW5nbHkuCgpXZSBhbHNvIG5lZWQgdG8gcmVn
aXN0ZXIgWGVuJ3MgZ3Vlc3QgT1MgSUQgdG8gSHlwZXItVi4gVXNlIDB4MyBhcyB0aGUKdmVuZG9y
IElELiBGaXggdGhlIGNvbW1lbnQgaW4gaHlwZXJ2LXRsZnMuaCB3aGlsZSBhdCBpdC4KClNpZ25l
ZC1vZmYtYnk6IFdlaSBMaXUgPGxpdXdlQG1pY3Jvc29mdC5jb20+Ci0tLQp2NjoKMS4gVXNlIGh2
X2d1ZXN0X29zX2lkCjIuIFVzZSBuZXcgZTgyMF9maXh1cCBob29rCjMuIEFkZCBhIEJVSUxEX0JV
R19PTgoKdjU6CjEuIHVzZSBoeXBlcnZpc29yX3Jlc2VydmVfdG9wX3BhZ2VzCjIuIGFkZCBhIG1h
Y3JvIGZvciBoeXBlcmNhbGwgcGFnZSBtZm4KMy4gYWRkcmVzcyBvdGhlciBtaXNjIGNvbW1lbnRz
Cgp2NDoKMS4gVXNlIGZpeG1hcAoyLiBGb2xsb3cgcm91dGluZXMgbGlzdGVkIGluIFRMRlMKLS0t
CiB4ZW4vYXJjaC94ODYvZ3Vlc3QvaHlwZXJ2L2h5cGVydi5jICAgICAgfCA2OSArKysrKysrKysr
KysrKysrKysrKysrKy0tCiB4ZW4vaW5jbHVkZS9hc20teDg2L2d1ZXN0L2h5cGVydi10bGZzLmgg
fCAgNSArLQogeGVuL2luY2x1ZGUvYXNtLXg4Ni9ndWVzdC9oeXBlcnYuaCAgICAgIHwgIDMgKysK
IDMgZmlsZXMgY2hhbmdlZCwgNzIgaW5zZXJ0aW9ucygrKSwgNSBkZWxldGlvbnMoLSkKCmRpZmYg
LS1naXQgYS94ZW4vYXJjaC94ODYvZ3Vlc3QvaHlwZXJ2L2h5cGVydi5jIGIveGVuL2FyY2gveDg2
L2d1ZXN0L2h5cGVydi9oeXBlcnYuYwppbmRleCA4ZDM4MzEzZDdhLi43YzJhOTZkNzBlIDEwMDY0
NAotLS0gYS94ZW4vYXJjaC94ODYvZ3Vlc3QvaHlwZXJ2L2h5cGVydi5jCisrKyBiL3hlbi9hcmNo
L3g4Ni9ndWVzdC9oeXBlcnYvaHlwZXJ2LmMKQEAgLTE5LDE1ICsxOSwyNyBAQAogICogQ29weXJp
Z2h0IChjKSAyMDE5IE1pY3Jvc29mdC4KICAqLwogI2luY2x1ZGUgPHhlbi9pbml0Lmg+CisjaW5j
bHVkZSA8eGVuL3ZlcnNpb24uaD4KIAorI2luY2x1ZGUgPGFzbS9maXhtYXAuaD4KICNpbmNsdWRl
IDxhc20vZ3Vlc3QuaD4KICNpbmNsdWRlIDxhc20vZ3Vlc3QvaHlwZXJ2LXRsZnMuaD4KKyNpbmNs
dWRlIDxhc20vcHJvY2Vzc29yLmg+CiAKIHN0cnVjdCBtc19oeXBlcnZfaW5mbyBfX3JlYWRfbW9z
dGx5IG1zX2h5cGVydjsKIAotc3RhdGljIGNvbnN0IHN0cnVjdCBoeXBlcnZpc29yX29wcyBvcHMg
PSB7Ci0gICAgLm5hbWUgPSAiSHlwZXItViIsCi19Oworc3RhdGljIHVpbnQ2NF90IGdlbmVyYXRl
X2d1ZXN0X2lkKHZvaWQpCit7CisgICAgdW5pb24gaHZfZ3Vlc3Rfb3NfaWQgaWQ7CisKKyAgICBp
ZC52ZW5kb3IgPSBIVl9YRU5fVkVORE9SX0lEOworICAgIGlkLm1ham9yID0geGVuX21ham9yX3Zl
cnNpb24oKTsKKyAgICBpZC5taW5vciA9IHhlbl9taW5vcl92ZXJzaW9uKCk7CisKKyAgICByZXR1
cm4gaWQucmF3OworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGh5cGVydmlzb3Jfb3BzIG9wczsK
IAogY29uc3Qgc3RydWN0IGh5cGVydmlzb3Jfb3BzICpfX2luaXQgaHlwZXJ2X3Byb2JlKHZvaWQp
CiB7CkBAIC03Miw2ICs4NCw1NyBAQCBjb25zdCBzdHJ1Y3QgaHlwZXJ2aXNvcl9vcHMgKl9faW5p
dCBoeXBlcnZfcHJvYmUodm9pZCkKICAgICByZXR1cm4gJm9wczsKIH0KIAorc3RhdGljIHZvaWQg
X19pbml0IHNldHVwX2h5cGVyY2FsbF9wYWdlKHZvaWQpCit7CisgICAgdW5pb24gaHZfeDY0X21z
cl9oeXBlcmNhbGxfY29udGVudHMgaHlwZXJjYWxsX21zcjsKKyAgICB1bmlvbiBodl9ndWVzdF9v
c19pZCBndWVzdF9pZDsKKyAgICB1bnNpZ25lZCBsb25nIG1mbjsKKworICAgIEJVSUxEX0JVR19P
TihIVl9IWVBfUEFHRV9TSElGVCAhPSBQQUdFX1NISUZUKTsKKworICAgIHJkbXNybChIVl9YNjRf
TVNSX0dVRVNUX09TX0lELCBndWVzdF9pZC5yYXcpOworICAgIGlmICggIWd1ZXN0X2lkLnJhdyAp
CisgICAgeworICAgICAgICBndWVzdF9pZC5yYXcgPSBnZW5lcmF0ZV9ndWVzdF9pZCgpOworICAg
ICAgICB3cm1zcmwoSFZfWDY0X01TUl9HVUVTVF9PU19JRCwgZ3Vlc3RfaWQucmF3KTsKKyAgICB9
CisKKyAgICByZG1zcmwoSFZfWDY0X01TUl9IWVBFUkNBTEwsIGh5cGVyY2FsbF9tc3IuYXNfdWlu
dDY0KTsKKyAgICBpZiAoICFoeXBlcmNhbGxfbXNyLmVuYWJsZSApCisgICAgeworICAgICAgICBt
Zm4gPSBIVl9IQ0FMTF9NRk47CisgICAgICAgIGh5cGVyY2FsbF9tc3IuZW5hYmxlID0gMTsKKyAg
ICAgICAgaHlwZXJjYWxsX21zci5ndWVzdF9waHlzaWNhbF9hZGRyZXNzID0gbWZuOworICAgICAg
ICB3cm1zcmwoSFZfWDY0X01TUl9IWVBFUkNBTEwsIGh5cGVyY2FsbF9tc3IuYXNfdWludDY0KTsK
KyAgICB9IGVsc2UgeworICAgICAgICBtZm4gPSBoeXBlcmNhbGxfbXNyLmd1ZXN0X3BoeXNpY2Fs
X2FkZHJlc3M7CisgICAgfQorCisgICAgcmRtc3JsKEhWX1g2NF9NU1JfSFlQRVJDQUxMLCBoeXBl
cmNhbGxfbXNyLmFzX3VpbnQ2NCk7CisgICAgQlVHX09OKCFoeXBlcmNhbGxfbXNyLmVuYWJsZSk7
CisKKyAgICBzZXRfZml4bWFwX3goRklYX1hfSFlQRVJWX0hDQUxMLCBtZm4gPDwgUEFHRV9TSElG
VCk7Cit9CisKK3N0YXRpYyB2b2lkIF9faW5pdCBzZXR1cCh2b2lkKQoreworICAgIHNldHVwX2h5
cGVyY2FsbF9wYWdlKCk7Cit9CisKK3N0YXRpYyB2b2lkIF9faW5pdCBlODIwX2ZpeHVwKHN0cnVj
dCBlODIwbWFwICplODIwKQoreworICAgIHVpbnQ2NF90IHMgPSBIVl9IQ0FMTF9NRk4gPDwgUEFH
RV9TSElGVDsKKworICAgIGlmICggIWU4MjBfYWRkX3JhbmdlKGU4MjAsIHMsIHMgKyBQQUdFX1NJ
WkUsIEU4MjBfUkVTRVJWRUQpICkKKyAgICAgICAgcGFuaWMoIlVuYWJsZSB0byByZXNlcnZlIEh5
cGVyLVYgaHlwZXJjYWxsIHJhbmdlXG4iKTsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBoeXBl
cnZpc29yX29wcyBvcHMgPSB7CisgICAgLm5hbWUgPSAiSHlwZXItViIsCisgICAgLnNldHVwID0g
c2V0dXAsCisgICAgLmU4MjBfZml4dXAgPSBlODIwX2ZpeHVwLAorfTsKKwogLyoKICAqIExvY2Fs
IHZhcmlhYmxlczoKICAqIG1vZGU6IEMKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL2FzbS14ODYv
Z3Vlc3QvaHlwZXJ2LXRsZnMuaCBiL3hlbi9pbmNsdWRlL2FzbS14ODYvZ3Vlc3QvaHlwZXJ2LXRs
ZnMuaAppbmRleCAwNWM0MDQ0OTc2Li4wN2RiNTdiNTVmIDEwMDY0NAotLS0gYS94ZW4vaW5jbHVk
ZS9hc20teDg2L2d1ZXN0L2h5cGVydi10bGZzLmgKKysrIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9n
dWVzdC9oeXBlcnYtdGxmcy5oCkBAIC0zMTgsMTUgKzMxOCwxNiBAQCBzdHJ1Y3QgbXNfaHlwZXJ2
X3RzY19wYWdlIHsKICAqCiAgKiBCaXQocykKICAqIDYzIC0gSW5kaWNhdGVzIGlmIHRoZSBPUyBp
cyBPcGVuIFNvdXJjZSBvciBub3Q7IDEgaXMgT3BlbiBTb3VyY2UKLSAqIDYyOjU2IC0gT3MgVHlw
ZTsgTGludXggaXMgMHgxMDAKKyAqIDYyOjU2IC0gT3MgVHlwZTsgTGludXggMHgxLCBGcmVlQlNE
IDB4MiwgWGVuIDB4MwogICogNTU6NDggLSBEaXN0cm8gc3BlY2lmaWMgaWRlbnRpZmljYXRpb24K
LSAqIDQ3OjE2IC0gTGludXgga2VybmVsIHZlcnNpb24gbnVtYmVyCisgKiA0NzoxNiAtIEd1ZXN0
IE9TIHZlcnNpb24gbnVtYmVyCiAgKiAxNTowICAtIERpc3RybyBzcGVjaWZpYyBpZGVudGlmaWNh
dGlvbgogICoKICAqCiAgKi8KIAogI2RlZmluZSBIVl9MSU5VWF9WRU5ET1JfSUQgICAgICAgICAg
ICAgIDB4ODEwMAorI2RlZmluZSBIVl9YRU5fVkVORE9SX0lEICAgICAgICAgICAgICAgIDB4ODMw
MAogdW5pb24gaHZfZ3Vlc3Rfb3NfaWQKIHsKICAgICB1aW50NjRfdCByYXc7CmRpZmYgLS1naXQg
YS94ZW4vaW5jbHVkZS9hc20teDg2L2d1ZXN0L2h5cGVydi5oIGIveGVuL2luY2x1ZGUvYXNtLXg4
Ni9ndWVzdC9oeXBlcnYuaAppbmRleCBjN2E3ZjMyYmQ1Li4xYTFiNDc4MzFjIDEwMDY0NAotLS0g
YS94ZW4vaW5jbHVkZS9hc20teDg2L2d1ZXN0L2h5cGVydi5oCisrKyBiL3hlbi9pbmNsdWRlL2Fz
bS14ODYvZ3Vlc3QvaHlwZXJ2LmgKQEAgLTIxLDYgKzIxLDkgQEAKIAogI2luY2x1ZGUgPHhlbi90
eXBlcy5oPgogCisvKiBVc2UgdG9wLW1vc3QgTUZOIGZvciBoeXBlcmNhbGwgcGFnZSAqLworI2Rl
ZmluZSBIVl9IQ0FMTF9NRk4gICAoKCgxdWxsIDw8IHBhZGRyX2JpdHMpIC0gMSkgPj4gSFZfSFlQ
X1BBR0VfU0hJRlQpCisKIC8qCiAgKiBUaGUgc3BlY2lmaWNhdGlvbiBzYXlzOiAiVGhlIHBhcnRp
dGlvbiByZWZlcmVuY2UgdGltZSBpcyBjb21wdXRlZAogICogYnkgdGhlIGZvbGxvd2luZyBmb3Jt
dWxhOgotLSAKMi4yMC4xCgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVj
dC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1k
ZXZlbA==

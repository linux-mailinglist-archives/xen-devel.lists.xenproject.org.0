Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 440F297DF8
	for <lists+xen-devel@lfdr.de>; Wed, 21 Aug 2019 17:02:34 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i0S5Z-0000Be-UX; Wed, 21 Aug 2019 14:59:53 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=SZvr=WR=citrix.com=roger.pau@srs-us1.protection.inumbo.net>)
 id 1i0S5Y-0000BA-6L
 for xen-devel@lists.xenproject.org; Wed, 21 Aug 2019 14:59:52 +0000
X-Inumbo-ID: 51a0715a-c424-11e9-8980-bc764e2007e4
Received: from esa4.hc3370-68.iphmx.com (unknown [216.71.155.144])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 51a0715a-c424-11e9-8980-bc764e2007e4;
 Wed, 21 Aug 2019 14:59:48 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1566399588;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=Q95w2jTSGI/Q7ICrkONG2X5OzZS4B+rwKu4FumIZXbU=;
 b=cn2myorww1pDaeiAZq0bGFk2+gCTKzHcB2w1wMKvpfvHWq3w+jhWV1Dz
 czj2sTkSYsrp1+JImB+rVZ22IgDVi8hVQrYFrUSHm5QGnBtXgaz/BUVPA
 hL3ZBqDbTToh86XbVgrH2yh2TknmKKmQCzCdMgjWFM5XdF0miqc+E5mo0 U=;
Authentication-Results: esa4.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=roger.pau@citrix.com;
 spf=Pass smtp.mailfrom=roger.pau@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa4.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 roger.pau@citrix.com) identity=pra; client-ip=162.221.158.21;
 receiver=esa4.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="roger.pau@citrix.com"; x-conformance=sidf_compatible
Received-SPF: Pass (esa4.hc3370-68.iphmx.com: domain of
 roger.pau@citrix.com designates 162.221.158.21 as permitted
 sender) identity=mailfrom; client-ip=162.221.158.21;
 receiver=esa4.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="roger.pau@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83 ~all"
Received-SPF: None (esa4.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa4.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: 0MeGxGiiMIts12U/PVfF8FACXhq7YzVH0CPStD5qZuTkyHtUkussFYun/N8QQ2prWPssZqK82f
 yTMkWghDohikRCcsdvz6HTrveoa3lGjjnuncRIMpkkyXXCrEATrTRqs/s0zl0KE3b9dbDe4784
 sRErGcnbd75TQ5iYGUuFhufATGLaF7hUrSiMiSL6GQTzdbj3bUgr1Oz8xui4f8tsw4+mbyHTNQ
 unpVlPH5TWAsFHkXJR1pITCXdhJmZNBS8DBl2bV1EYPWvLRxW9mFvhxwjjc6iu306+SzE7h1ER
 XtI=
X-SBRS: 2.7
X-MesageID: 4782721
X-Ironport-Server: esa4.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.64,412,1559534400"; 
   d="scan'208";a="4782721"
From: Roger Pau Monne <roger.pau@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Wed, 21 Aug 2019 16:59:02 +0200
Message-ID: <20190821145903.45934-7-roger.pau@citrix.com>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190821145903.45934-1-roger.pau@citrix.com>
References: <20190821145903.45934-1-roger.pau@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH 6/7] vpci: register as an internal ioreq server
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>, Konrad
 Rzeszutek Wilk <konrad.wilk@oracle.com>, George
 Dunlap <George.Dunlap@eu.citrix.com>, Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Paul Durrant <paul.durrant@citrix.com>,
 Jan Beulich <jbeulich@suse.com>, Roger Pau Monne <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

U3dpdGNoIHZQQ0kgdG8gYmVjb21lIGFuIGludGVybmFsIGlvcmVxIHNlcnZlciwgYW5kIGhlbmNl
IGRyb3AgYWxsIHRoZQp2UENJIHNwZWNpZmljIGRlY29kaW5nIGFuZCB0cmFwcGluZyB0byBQQ0kg
SU8gcG9ydHMgYW5kIE1NQ0ZHIHJlZ2lvbnMuCgpUaGlzIGFsbG93cyB0byB1bmlmeSB0aGUgdlBD
SSBjb2RlIHdpdGggdGhlIGlvcmVxIGluZnJhc3RydWN0dXJlLApvcGVuaW5nIHRoZSBkb29yIGZv
ciBkb21haW5zIGhhdmluZyBQQ0kgYWNjZXNzZXMgaGFuZGxlZCBieSB2UENJIGFuZApvdGhlciBp
b3JlcSBzZXJ2ZXJzIGF0IHRoZSBzYW1lIHRpbWUuCgpTaWduZWQtb2ZmLWJ5OiBSb2dlciBQYXUg
TW9ubsOpIDxyb2dlci5wYXVAY2l0cml4LmNvbT4KLS0tCiB4ZW4vYXJjaC94ODYvaHZtL2RvbTBf
YnVpbGQuYyAgICAgICB8ICAgOSArLQogeGVuL2FyY2gveDg2L2h2bS9odm0uYyAgICAgICAgICAg
ICAgfCAgIDUgKy0KIHhlbi9hcmNoL3g4Ni9odm0vaW8uYyAgICAgICAgICAgICAgIHwgMjcyIC0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIHhlbi9hcmNoL3g4Ni9odm0vaW9yZXEuYyAgICAg
ICAgICAgIHwgICA1ICsKIHhlbi9hcmNoL3g4Ni9waHlzZGV2LmMgICAgICAgICAgICAgIHwgICA3
ICstCiB4ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC94ODYvaW9tbXUuYyB8ICAgMiArLQogeGVuL2Ry
aXZlcnMvdnBjaS92cGNpLmMgICAgICAgICAgICAgfCAgNTQgKysrKysrCiB4ZW4vaW5jbHVkZS9h
c20teDg2L2h2bS9pby5oICAgICAgICB8ICAgMiArLQogeGVuL2luY2x1ZGUveGVuL3ZwY2kuaCAg
ICAgICAgICAgICAgfCAgIDMgKwogOSBmaWxlcyBjaGFuZ2VkLCA3NyBpbnNlcnRpb25zKCspLCAy
ODIgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L2h2bS9kb20wX2J1aWxk
LmMgYi94ZW4vYXJjaC94ODYvaHZtL2RvbTBfYnVpbGQuYwppbmRleCA4ODQ1Mzk5YWU5Li43OTI1
MTg5ZmVkIDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYvaHZtL2RvbTBfYnVpbGQuYworKysgYi94
ZW4vYXJjaC94ODYvaHZtL2RvbTBfYnVpbGQuYwpAQCAtMjksNiArMjksNyBAQAogCiAjaW5jbHVk
ZSA8YXNtL2J6aW1hZ2UuaD4KICNpbmNsdWRlIDxhc20vZG9tMF9idWlsZC5oPgorI2luY2x1ZGUg
PGFzbS9odm0vaW9yZXEuaD4KICNpbmNsdWRlIDxhc20vaHZtL3N1cHBvcnQuaD4KICNpbmNsdWRl
IDxhc20vaW9fYXBpYy5oPgogI2luY2x1ZGUgPGFzbS9wMm0uaD4KQEAgLTExMTcsMTAgKzExMTgs
MTAgQEAgc3RhdGljIHZvaWQgX19od2RvbV9pbml0IHB2aF9zZXR1cF9tbWNmZyhzdHJ1Y3QgZG9t
YWluICpkKQogCiAgICAgZm9yICggaSA9IDA7IGkgPCBwY2lfbW1jZmdfY29uZmlnX251bTsgaSsr
ICkKICAgICB7Ci0gICAgICAgIHJjID0gcmVnaXN0ZXJfdnBjaV9tbWNmZ19oYW5kbGVyKGQsIHBj
aV9tbWNmZ19jb25maWdbaV0uYWRkcmVzcywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgcGNpX21tY2ZnX2NvbmZpZ1tpXS5zdGFydF9idXNfbnVtYmVyLAotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwY2lfbW1jZmdfY29uZmlnW2ldLmVu
ZF9idXNfbnVtYmVyLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBw
Y2lfbW1jZmdfY29uZmlnW2ldLnBjaV9zZWdtZW50KTsKKyAgICAgICAgcmMgPSBodm1faW9yZXFf
cmVnaXN0ZXJfbW1jZmcoZCwgcGNpX21tY2ZnX2NvbmZpZ1tpXS5hZGRyZXNzLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwY2lfbW1jZmdfY29uZmlnW2ldLnN0YXJ0X2J1
c19udW1iZXIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBjaV9tbWNm
Z19jb25maWdbaV0uZW5kX2J1c19udW1iZXIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHBjaV9tbWNmZ19jb25maWdbaV0ucGNpX3NlZ21lbnQpOwogICAgICAgICBpZiAo
IHJjICkKICAgICAgICAgICAgIHByaW50aygiVW5hYmxlIHRvIHNldHVwIE1NQ0ZHIGhhbmRsZXIg
YXQgJSNseCBmb3Igc2VnbWVudCAldVxuIiwKICAgICAgICAgICAgICAgICAgICBwY2lfbW1jZmdf
Y29uZmlnW2ldLmFkZHJlc3MsCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvaHZtL2h2bS5jIGIv
eGVuL2FyY2gveDg2L2h2bS9odm0uYwppbmRleCBiN2E1MzM3N2E1Li4zZmNmNDY3NzliIDEwMDY0
NAotLS0gYS94ZW4vYXJjaC94ODYvaHZtL2h2bS5jCisrKyBiL3hlbi9hcmNoL3g4Ni9odm0vaHZt
LmMKQEAgLTY0NCwxMCArNjQ0LDEzIEBAIGludCBodm1fZG9tYWluX2luaXRpYWxpc2Uoc3RydWN0
IGRvbWFpbiAqZCkKICAgICAgICAgZC0+YXJjaC5odm0uaW9fYml0bWFwID0gaHZtX2lvX2JpdG1h
cDsKIAogICAgIHJlZ2lzdGVyX2cybV9wb3J0aW9faGFuZGxlcihkKTsKLSAgICByZWdpc3Rlcl92
cGNpX3BvcnRpb19oYW5kbGVyKGQpOwogCiAgICAgaHZtX2lvcmVxX2luaXQoZCk7CiAKKyAgICBy
YyA9IHZwY2lfcmVnaXN0ZXJfaW9yZXEoZCk7CisgICAgaWYgKCByYyApCisgICAgICAgIGdvdG8g
ZmFpbDE7CisKICAgICBodm1faW5pdF9ndWVzdF90aW1lKGQpOwogCiAgICAgZC0+YXJjaC5odm0u
cGFyYW1zW0hWTV9QQVJBTV9UUklQTEVfRkFVTFRfUkVBU09OXSA9IFNIVVRET1dOX3JlYm9vdDsK
ZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9odm0vaW8uYyBiL3hlbi9hcmNoL3g4Ni9odm0vaW8u
YwppbmRleCA2NTg1NzY3YzAzLi45YzMyM2QxN2VmIDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYv
aHZtL2lvLmMKKysrIGIveGVuL2FyY2gveDg2L2h2bS9pby5jCkBAIC0yOTAsMjc4ICsyOTAsNiBA
QCB1bnNpZ25lZCBpbnQgaHZtX21tY2ZnX2RlY29kZV9hZGRyKGNvbnN0IHN0cnVjdCBodm1fbW1j
ZmcgKm1tY2ZnLAogICAgIHJldHVybiBhZGRyICYgKFBDSV9DRkdfU1BBQ0VfRVhQX1NJWkUgLSAx
KTsKIH0KIAotCi0vKiBEbyBzb21lIHNhbml0eSBjaGVja3MuICovCi1zdGF0aWMgYm9vbCB2cGNp
X2FjY2Vzc19hbGxvd2VkKHVuc2lnbmVkIGludCByZWcsIHVuc2lnbmVkIGludCBsZW4pCi17Ci0g
ICAgLyogQ2hlY2sgYWNjZXNzIHNpemUuICovCi0gICAgaWYgKCBsZW4gIT0gMSAmJiBsZW4gIT0g
MiAmJiBsZW4gIT0gNCAmJiBsZW4gIT0gOCApCi0gICAgICAgIHJldHVybiBmYWxzZTsKLQotICAg
IC8qIENoZWNrIHRoYXQgYWNjZXNzIGlzIHNpemUgYWxpZ25lZC4gKi8KLSAgICBpZiAoIChyZWcg
JiAobGVuIC0gMSkpICkKLSAgICAgICAgcmV0dXJuIGZhbHNlOwotCi0gICAgcmV0dXJuIHRydWU7
Ci19Ci0KLS8qIHZQQ0kgY29uZmlnIHNwYWNlIElPIHBvcnRzIGhhbmRsZXJzICgweGNmOC8weGNm
YykuICovCi1zdGF0aWMgYm9vbCB2cGNpX3BvcnRpb19hY2NlcHQoY29uc3Qgc3RydWN0IGh2bV9p
b19oYW5kbGVyICpoYW5kbGVyLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0
IGlvcmVxX3QgKnApCi17Ci0gICAgcmV0dXJuIChwLT5hZGRyID09IDB4Y2Y4ICYmIHAtPnNpemUg
PT0gNCkgfHwgKHAtPmFkZHIgJiB+MykgPT0gMHhjZmM7Ci19Ci0KLXN0YXRpYyBpbnQgdnBjaV9w
b3J0aW9fcmVhZChjb25zdCBzdHJ1Y3QgaHZtX2lvX2hhbmRsZXIgKmhhbmRsZXIsCi0gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgdWludDY0X3QgYWRkciwgdWludDMyX3Qgc2l6ZSwgdWludDY0
X3QgKmRhdGEpCi17Ci0gICAgY29uc3Qgc3RydWN0IGRvbWFpbiAqZCA9IGN1cnJlbnQtPmRvbWFp
bjsKLSAgICB1bnNpZ25lZCBpbnQgcmVnOwotICAgIHBjaV9zYmRmX3Qgc2JkZjsKLSAgICB1aW50
MzJfdCBjZjg7Ci0KLSAgICAqZGF0YSA9IH4odWludDY0X3QpMDsKLQotICAgIGlmICggYWRkciA9
PSAweGNmOCApCi0gICAgewotICAgICAgICBBU1NFUlQoc2l6ZSA9PSA0KTsKLSAgICAgICAgKmRh
dGEgPSBkLT5hcmNoLmh2bS5wY2lfY2Y4OwotICAgICAgICByZXR1cm4gWDg2RU1VTF9PS0FZOwot
ICAgIH0KLQotICAgIEFTU0VSVCgoYWRkciAmIH4zKSA9PSAweGNmYyk7Ci0gICAgY2Y4ID0gQUND
RVNTX09OQ0UoZC0+YXJjaC5odm0ucGNpX2NmOCk7Ci0gICAgaWYgKCAhQ0Y4X0VOQUJMRUQoY2Y4
KSApCi0gICAgICAgIHJldHVybiBYODZFTVVMX1VOSEFORExFQUJMRTsKLQotICAgIHJlZyA9IGh2
bV9wY2lfZGVjb2RlX2FkZHIoY2Y4LCBhZGRyLCAmc2JkZik7Ci0KLSAgICBpZiAoICF2cGNpX2Fj
Y2Vzc19hbGxvd2VkKHJlZywgc2l6ZSkgKQotICAgICAgICByZXR1cm4gWDg2RU1VTF9PS0FZOwot
Ci0gICAgKmRhdGEgPSB2cGNpX3JlYWQoc2JkZiwgcmVnLCBzaXplKTsKLQotICAgIHJldHVybiBY
ODZFTVVMX09LQVk7Ci19Ci0KLXN0YXRpYyBpbnQgdnBjaV9wb3J0aW9fd3JpdGUoY29uc3Qgc3Ry
dWN0IGh2bV9pb19oYW5kbGVyICpoYW5kbGVyLAotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICB1aW50NjRfdCBhZGRyLCB1aW50MzJfdCBzaXplLCB1aW50NjRfdCBkYXRhKQotewotICAgIHN0
cnVjdCBkb21haW4gKmQgPSBjdXJyZW50LT5kb21haW47Ci0gICAgdW5zaWduZWQgaW50IHJlZzsK
LSAgICBwY2lfc2JkZl90IHNiZGY7Ci0gICAgdWludDMyX3QgY2Y4OwotCi0gICAgaWYgKCBhZGRy
ID09IDB4Y2Y4ICkKLSAgICB7Ci0gICAgICAgIEFTU0VSVChzaXplID09IDQpOwotICAgICAgICBk
LT5hcmNoLmh2bS5wY2lfY2Y4ID0gZGF0YTsKLSAgICAgICAgcmV0dXJuIFg4NkVNVUxfT0tBWTsK
LSAgICB9Ci0KLSAgICBBU1NFUlQoKGFkZHIgJiB+MykgPT0gMHhjZmMpOwotICAgIGNmOCA9IEFD
Q0VTU19PTkNFKGQtPmFyY2guaHZtLnBjaV9jZjgpOwotICAgIGlmICggIUNGOF9FTkFCTEVEKGNm
OCkgKQotICAgICAgICByZXR1cm4gWDg2RU1VTF9VTkhBTkRMRUFCTEU7Ci0KLSAgICByZWcgPSBo
dm1fcGNpX2RlY29kZV9hZGRyKGNmOCwgYWRkciwgJnNiZGYpOwotCi0gICAgaWYgKCAhdnBjaV9h
Y2Nlc3NfYWxsb3dlZChyZWcsIHNpemUpICkKLSAgICAgICAgcmV0dXJuIFg4NkVNVUxfT0tBWTsK
LQotICAgIHZwY2lfd3JpdGUoc2JkZiwgcmVnLCBzaXplLCBkYXRhKTsKLQotICAgIHJldHVybiBY
ODZFTVVMX09LQVk7Ci19Ci0KLXN0YXRpYyBjb25zdCBzdHJ1Y3QgaHZtX2lvX29wcyB2cGNpX3Bv
cnRpb19vcHMgPSB7Ci0gICAgLmFjY2VwdCA9IHZwY2lfcG9ydGlvX2FjY2VwdCwKLSAgICAucmVh
ZCA9IHZwY2lfcG9ydGlvX3JlYWQsCi0gICAgLndyaXRlID0gdnBjaV9wb3J0aW9fd3JpdGUsCi19
OwotCi12b2lkIHJlZ2lzdGVyX3ZwY2lfcG9ydGlvX2hhbmRsZXIoc3RydWN0IGRvbWFpbiAqZCkK
LXsKLSAgICBzdHJ1Y3QgaHZtX2lvX2hhbmRsZXIgKmhhbmRsZXI7Ci0KLSAgICBpZiAoICFoYXNf
dnBjaShkKSApCi0gICAgICAgIHJldHVybjsKLQotICAgIGhhbmRsZXIgPSBodm1fbmV4dF9pb19o
YW5kbGVyKGQpOwotICAgIGlmICggIWhhbmRsZXIgKQotICAgICAgICByZXR1cm47Ci0KLSAgICBo
YW5kbGVyLT50eXBlID0gSU9SRVFfVFlQRV9QSU87Ci0gICAgaGFuZGxlci0+b3BzID0gJnZwY2lf
cG9ydGlvX29wczsKLX0KLQotLyogSGFuZGxlcnMgdG8gdHJhcCBQQ0kgTU1DRkcgY29uZmlnIGFj
Y2Vzc2VzLiAqLwotc3RhdGljIGNvbnN0IHN0cnVjdCBodm1fbW1jZmcgKnZwY2lfbW1jZmdfZmlu
ZChjb25zdCBzdHJ1Y3QgZG9tYWluICpkLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBwYWRkcl90IGFkZHIpCi17Ci0gICAgY29uc3Qgc3RydWN0IGh2bV9t
bWNmZyAqbW1jZmc7Ci0KLSAgICBsaXN0X2Zvcl9lYWNoX2VudHJ5ICggbW1jZmcsICZkLT5hcmNo
Lmh2bS5tbWNmZ19yZWdpb25zLCBuZXh0ICkKLSAgICAgICAgaWYgKCBhZGRyID49IG1tY2ZnLT5h
ZGRyICYmIGFkZHIgPCBtbWNmZy0+YWRkciArIG1tY2ZnLT5zaXplICkKLSAgICAgICAgICAgIHJl
dHVybiBtbWNmZzsKLQotICAgIHJldHVybiBOVUxMOwotfQotCi1ib29sIHZwY2lfaXNfbW1jZmdf
YWRkcmVzcyhjb25zdCBzdHJ1Y3QgZG9tYWluICpkLCBwYWRkcl90IGFkZHIpCi17Ci0gICAgcmV0
dXJuIHZwY2lfbW1jZmdfZmluZChkLCBhZGRyKTsKLX0KLQotc3RhdGljIHVuc2lnbmVkIGludCB2
cGNpX21tY2ZnX2RlY29kZV9hZGRyKGNvbnN0IHN0cnVjdCBodm1fbW1jZmcgKm1tY2ZnLAotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZGRyX3QgYWRkciwgcGNp
X3NiZGZfdCAqc2JkZikKLXsKLSAgICBhZGRyIC09IG1tY2ZnLT5hZGRyOwotICAgIHNiZGYtPmJk
ZiA9IE1NQ0ZHX0JERihhZGRyKTsKLSAgICBzYmRmLT5idXMgKz0gbW1jZmctPnN0YXJ0X2J1czsK
LSAgICBzYmRmLT5zZWcgPSBtbWNmZy0+c2VnbWVudDsKLQotICAgIHJldHVybiBhZGRyICYgKFBD
SV9DRkdfU1BBQ0VfRVhQX1NJWkUgLSAxKTsKLX0KLQotc3RhdGljIGludCB2cGNpX21tY2ZnX2Fj
Y2VwdChzdHJ1Y3QgdmNwdSAqdiwgdW5zaWduZWQgbG9uZyBhZGRyKQotewotICAgIHN0cnVjdCBk
b21haW4gKmQgPSB2LT5kb21haW47Ci0gICAgYm9vbCBmb3VuZDsKLQotICAgIHJlYWRfbG9jaygm
ZC0+YXJjaC5odm0ubW1jZmdfbG9jayk7Ci0gICAgZm91bmQgPSB2cGNpX21tY2ZnX2ZpbmQoZCwg
YWRkcik7Ci0gICAgcmVhZF91bmxvY2soJmQtPmFyY2guaHZtLm1tY2ZnX2xvY2spOwotCi0gICAg
cmV0dXJuIGZvdW5kOwotfQotCi1zdGF0aWMgaW50IHZwY2lfbW1jZmdfcmVhZChzdHJ1Y3QgdmNw
dSAqdiwgdW5zaWduZWQgbG9uZyBhZGRyLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5z
aWduZWQgaW50IGxlbiwgdW5zaWduZWQgbG9uZyAqZGF0YSkKLXsKLSAgICBzdHJ1Y3QgZG9tYWlu
ICpkID0gdi0+ZG9tYWluOwotICAgIGNvbnN0IHN0cnVjdCBodm1fbW1jZmcgKm1tY2ZnOwotICAg
IHVuc2lnbmVkIGludCByZWc7Ci0gICAgcGNpX3NiZGZfdCBzYmRmOwotCi0gICAgKmRhdGEgPSB+
MHVsOwotCi0gICAgcmVhZF9sb2NrKCZkLT5hcmNoLmh2bS5tbWNmZ19sb2NrKTsKLSAgICBtbWNm
ZyA9IHZwY2lfbW1jZmdfZmluZChkLCBhZGRyKTsKLSAgICBpZiAoICFtbWNmZyApCi0gICAgewot
ICAgICAgICByZWFkX3VubG9jaygmZC0+YXJjaC5odm0ubW1jZmdfbG9jayk7Ci0gICAgICAgIHJl
dHVybiBYODZFTVVMX1JFVFJZOwotICAgIH0KLQotICAgIHJlZyA9IHZwY2lfbW1jZmdfZGVjb2Rl
X2FkZHIobW1jZmcsIGFkZHIsICZzYmRmKTsKLSAgICByZWFkX3VubG9jaygmZC0+YXJjaC5odm0u
bW1jZmdfbG9jayk7Ci0KLSAgICBpZiAoICF2cGNpX2FjY2Vzc19hbGxvd2VkKHJlZywgbGVuKSB8
fAotICAgICAgICAgKHJlZyArIGxlbikgPiBQQ0lfQ0ZHX1NQQUNFX0VYUF9TSVpFICkKLSAgICAg
ICAgcmV0dXJuIFg4NkVNVUxfT0tBWTsKLQotICAgIC8qCi0gICAgICogQWNjb3JkaW5nIHRvIHRo
ZSBQQ0llIDMuMUEgc3BlY2lmaWNhdGlvbjoKLSAgICAgKiAgLSBDb25maWd1cmF0aW9uIFJlYWRz
IGFuZCBXcml0ZXMgbXVzdCB1c3VhbGx5IGJlIERXT1JEIG9yIHNtYWxsZXIKLSAgICAgKiAgICBp
biBzaXplLgotICAgICAqICAtIEJlY2F1c2UgUm9vdCBDb21wbGV4IGltcGxlbWVudGF0aW9ucyBh
cmUgbm90IHJlcXVpcmVkIHRvIHN1cHBvcnQKLSAgICAgKiAgICBhY2Nlc3NlcyB0byBhIFJDUkIg
dGhhdCBjcm9zcyBEVyBib3VuZGFyaWVzIFsuLi5dIHNvZnR3YXJlCi0gICAgICogICAgc2hvdWxk
IHRha2UgY2FyZSBub3QgdG8gY2F1c2UgdGhlIGdlbmVyYXRpb24gb2Ygc3VjaCBhY2Nlc3Nlcwot
ICAgICAqICAgIHdoZW4gYWNjZXNzaW5nIGEgUkNSQiB1bmxlc3MgdGhlIFJvb3QgQ29tcGxleCB3
aWxsIHN1cHBvcnQgdGhlCi0gICAgICogICAgYWNjZXNzLgotICAgICAqICBYZW4gaG93ZXZlciBz
dXBwb3J0cyA4Ynl0ZSBhY2Nlc3NlcyBieSBzcGxpdHRpbmcgdGhlbSBpbnRvIHR3bwotICAgICAq
ICA0Ynl0ZSBhY2Nlc3Nlcy4KLSAgICAgKi8KLSAgICAqZGF0YSA9IHZwY2lfcmVhZChzYmRmLCBy
ZWcsIG1pbig0dSwgbGVuKSk7Ci0gICAgaWYgKCBsZW4gPT0gOCApCi0gICAgICAgICpkYXRhIHw9
ICh1aW50NjRfdCl2cGNpX3JlYWQoc2JkZiwgcmVnICsgNCwgNCkgPDwgMzI7Ci0KLSAgICByZXR1
cm4gWDg2RU1VTF9PS0FZOwotfQotCi1zdGF0aWMgaW50IHZwY2lfbW1jZmdfd3JpdGUoc3RydWN0
IHZjcHUgKnYsIHVuc2lnbmVkIGxvbmcgYWRkciwKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICB1bnNpZ25lZCBpbnQgbGVuLCB1bnNpZ25lZCBsb25nIGRhdGEpCi17Ci0gICAgc3RydWN0IGRv
bWFpbiAqZCA9IHYtPmRvbWFpbjsKLSAgICBjb25zdCBzdHJ1Y3QgaHZtX21tY2ZnICptbWNmZzsK
LSAgICB1bnNpZ25lZCBpbnQgcmVnOwotICAgIHBjaV9zYmRmX3Qgc2JkZjsKLQotICAgIHJlYWRf
bG9jaygmZC0+YXJjaC5odm0ubW1jZmdfbG9jayk7Ci0gICAgbW1jZmcgPSB2cGNpX21tY2ZnX2Zp
bmQoZCwgYWRkcik7Ci0gICAgaWYgKCAhbW1jZmcgKQotICAgIHsKLSAgICAgICAgcmVhZF91bmxv
Y2soJmQtPmFyY2guaHZtLm1tY2ZnX2xvY2spOwotICAgICAgICByZXR1cm4gWDg2RU1VTF9SRVRS
WTsKLSAgICB9Ci0KLSAgICByZWcgPSB2cGNpX21tY2ZnX2RlY29kZV9hZGRyKG1tY2ZnLCBhZGRy
LCAmc2JkZik7Ci0gICAgcmVhZF91bmxvY2soJmQtPmFyY2guaHZtLm1tY2ZnX2xvY2spOwotCi0g
ICAgaWYgKCAhdnBjaV9hY2Nlc3NfYWxsb3dlZChyZWcsIGxlbikgfHwKLSAgICAgICAgIChyZWcg
KyBsZW4pID4gUENJX0NGR19TUEFDRV9FWFBfU0laRSApCi0gICAgICAgIHJldHVybiBYODZFTVVM
X09LQVk7Ci0KLSAgICB2cGNpX3dyaXRlKHNiZGYsIHJlZywgbWluKDR1LCBsZW4pLCBkYXRhKTsK
LSAgICBpZiAoIGxlbiA9PSA4ICkKLSAgICAgICAgdnBjaV93cml0ZShzYmRmLCByZWcgKyA0LCA0
LCBkYXRhID4+IDMyKTsKLQotICAgIHJldHVybiBYODZFTVVMX09LQVk7Ci19Ci0KLXN0YXRpYyBj
b25zdCBzdHJ1Y3QgaHZtX21taW9fb3BzIHZwY2lfbW1jZmdfb3BzID0gewotICAgIC5jaGVjayA9
IHZwY2lfbW1jZmdfYWNjZXB0LAotICAgIC5yZWFkID0gdnBjaV9tbWNmZ19yZWFkLAotICAgIC53
cml0ZSA9IHZwY2lfbW1jZmdfd3JpdGUsCi19OwotCi1pbnQgcmVnaXN0ZXJfdnBjaV9tbWNmZ19o
YW5kbGVyKHN0cnVjdCBkb21haW4gKmQsIHBhZGRyX3QgYWRkciwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IHN0YXJ0X2J1cywgdW5zaWduZWQgaW50IGVuZF9i
dXMsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCBzZWcpCi17
Ci0gICAgc3RydWN0IGh2bV9tbWNmZyAqbW1jZmcsICpuZXc7Ci0KLSAgICBBU1NFUlQoaXNfaGFy
ZHdhcmVfZG9tYWluKGQpKTsKLQotICAgIGlmICggc3RhcnRfYnVzID4gZW5kX2J1cyApCi0gICAg
ICAgIHJldHVybiAtRUlOVkFMOwotCi0gICAgbmV3ID0geG1hbGxvYyhzdHJ1Y3QgaHZtX21tY2Zn
KTsKLSAgICBpZiAoICFuZXcgKQotICAgICAgICByZXR1cm4gLUVOT01FTTsKLQotICAgIG5ldy0+
YWRkciA9IGFkZHIgKyAoc3RhcnRfYnVzIDw8IDIwKTsKLSAgICBuZXctPnN0YXJ0X2J1cyA9IHN0
YXJ0X2J1czsKLSAgICBuZXctPnNlZ21lbnQgPSBzZWc7Ci0gICAgbmV3LT5zaXplID0gKGVuZF9i
dXMgLSBzdGFydF9idXMgKyAxKSA8PCAyMDsKLQotICAgIHdyaXRlX2xvY2soJmQtPmFyY2guaHZt
Lm1tY2ZnX2xvY2spOwotICAgIGxpc3RfZm9yX2VhY2hfZW50cnkgKCBtbWNmZywgJmQtPmFyY2gu
aHZtLm1tY2ZnX3JlZ2lvbnMsIG5leHQgKQotICAgICAgICBpZiAoIG5ldy0+YWRkciA8IG1tY2Zn
LT5hZGRyICsgbW1jZmctPnNpemUgJiYKLSAgICAgICAgICAgICBtbWNmZy0+YWRkciA8IG5ldy0+
YWRkciArIG5ldy0+c2l6ZSApCi0gICAgICAgIHsKLSAgICAgICAgICAgIGludCByZXQgPSAtRUVY
SVNUOwotCi0gICAgICAgICAgICBpZiAoIG5ldy0+YWRkciA9PSBtbWNmZy0+YWRkciAmJgotICAg
ICAgICAgICAgICAgICBuZXctPnN0YXJ0X2J1cyA9PSBtbWNmZy0+c3RhcnRfYnVzICYmCi0gICAg
ICAgICAgICAgICAgIG5ldy0+c2VnbWVudCA9PSBtbWNmZy0+c2VnbWVudCAmJgotICAgICAgICAg
ICAgICAgICBuZXctPnNpemUgPT0gbW1jZmctPnNpemUgKQotICAgICAgICAgICAgICAgIHJldCA9
IDA7Ci0gICAgICAgICAgICB3cml0ZV91bmxvY2soJmQtPmFyY2guaHZtLm1tY2ZnX2xvY2spOwot
ICAgICAgICAgICAgeGZyZWUobmV3KTsKLSAgICAgICAgICAgIHJldHVybiByZXQ7Ci0gICAgICAg
IH0KLQotICAgIGlmICggbGlzdF9lbXB0eSgmZC0+YXJjaC5odm0ubW1jZmdfcmVnaW9ucykgKQot
ICAgICAgICByZWdpc3Rlcl9tbWlvX2hhbmRsZXIoZCwgJnZwY2lfbW1jZmdfb3BzKTsKLQotICAg
IGxpc3RfYWRkKCZuZXctPm5leHQsICZkLT5hcmNoLmh2bS5tbWNmZ19yZWdpb25zKTsKLSAgICB3
cml0ZV91bmxvY2soJmQtPmFyY2guaHZtLm1tY2ZnX2xvY2spOwotCi0gICAgcmV0dXJuIDA7Ci19
Ci0KIC8qCiAgKiBMb2NhbCB2YXJpYWJsZXM6CiAgKiBtb2RlOiBDCmRpZmYgLS1naXQgYS94ZW4v
YXJjaC94ODYvaHZtL2lvcmVxLmMgYi94ZW4vYXJjaC94ODYvaHZtL2lvcmVxLmMKaW5kZXggMTBj
MGY3YTU3NC4uYjI1ODJiZDNhMCAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L2h2bS9pb3JlcS5j
CisrKyBiL3hlbi9hcmNoL3g4Ni9odm0vaW9yZXEuYwpAQCAtMTcwNyw2ICsxNzA3LDExIEBAIGlu
dCBodm1faW9yZXFfcmVnaXN0ZXJfbW1jZmcoc3RydWN0IGRvbWFpbiAqZCwgcGFkZHJfdCBhZGRy
LAogICAgIHJldHVybiAwOwogfQogCitib29sIGh2bV9pc19tbWNmZ19hZGRyZXNzKGNvbnN0IHN0
cnVjdCBkb21haW4gKmQsIHBhZGRyX3QgYWRkcikKK3sKKyAgICByZXR1cm4gbW1jZmdfZmluZChk
LCBhZGRyKTsKK30KKwogLyoKICAqIExvY2FsIHZhcmlhYmxlczoKICAqIG1vZGU6IEMKZGlmZiAt
LWdpdCBhL3hlbi9hcmNoL3g4Ni9waHlzZGV2LmMgYi94ZW4vYXJjaC94ODYvcGh5c2Rldi5jCmlu
ZGV4IDNhM2MxNTg5MGIuLmE0OGIyMjBmYzMgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9waHlz
ZGV2LmMKKysrIGIveGVuL2FyY2gveDg2L3BoeXNkZXYuYwpAQCAtMTEsNiArMTEsNyBAQAogI2lu
Y2x1ZGUgPGFzbS9jdXJyZW50Lmg+CiAjaW5jbHVkZSA8YXNtL2lvX2FwaWMuaD4KICNpbmNsdWRl
IDxhc20vbXNpLmg+CisjaW5jbHVkZSA8YXNtL2h2bS9pb3JlcS5oPgogI2luY2x1ZGUgPGFzbS9o
dm0vaXJxLmg+CiAjaW5jbHVkZSA8YXNtL2h5cGVyY2FsbC5oPgogI2luY2x1ZGUgPHB1YmxpYy94
ZW4uaD4KQEAgLTU2Miw5ICs1NjMsOSBAQCByZXRfdCBkb19waHlzZGV2X29wKGludCBjbWQsIFhF
Tl9HVUVTVF9IQU5ETEVfUEFSQU0odm9pZCkgYXJnKQogICAgICAgICAgICAgICogRm9yIEhWTSAo
UFZIKSBkb21haW5zIHRyeSB0byBhZGQgdGhlIG5ld2x5IGZvdW5kIE1NQ0ZHIHRvIHRoZQogICAg
ICAgICAgICAgICogZG9tYWluLgogICAgICAgICAgICAgICovCi0gICAgICAgICAgICByZXQgPSBy
ZWdpc3Rlcl92cGNpX21tY2ZnX2hhbmRsZXIoY3VycmQsIGluZm8uYWRkcmVzcywKLSAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvLnN0YXJ0X2J1cywgaW5m
by5lbmRfYnVzLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGluZm8uc2VnbWVudCk7CisgICAgICAgICAgICByZXQgPSBodm1faW9yZXFfcmVnaXN0ZXJfbW1j
ZmcoY3VycmQsIGluZm8uYWRkcmVzcywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBpbmZvLnN0YXJ0X2J1cywgaW5mby5lbmRfYnVzLAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm8uc2VnbWVudCk7CiAgICAgICAgIH0KIAog
ICAgICAgICBicmVhazsKZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3g4Ni9p
b21tdS5jIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gveDg2L2lvbW11LmMKaW5kZXggZmQwNTA3
NWJiNS4uZTBmM2RhOTFjZSAxMDA2NDQKLS0tIGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gveDg2
L2lvbW11LmMKKysrIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gveDg2L2lvbW11LmMKQEAgLTI0
NCw3ICsyNDQsNyBAQCBzdGF0aWMgYm9vbCBfX2h3ZG9tX2luaXQgaHdkb21faW9tbXVfbWFwKGNv
bnN0IHN0cnVjdCBkb21haW4gKmQsCiAgICAgICogVE9ETzogcnVudGltZSBhZGRlZCBNTUNGRyBy
ZWdpb25zIGFyZSBub3QgY2hlY2tlZCB0byBtYWtlIHN1cmUgdGhleQogICAgICAqIGRvbid0IG92
ZXJsYXAgd2l0aCBhbHJlYWR5IG1hcHBlZCByZWdpb25zLCB0aHVzIHByZXZlbnRpbmcgdHJhcHBp
bmcuCiAgICAgICovCi0gICAgaWYgKCBoYXNfdnBjaShkKSAmJiB2cGNpX2lzX21tY2ZnX2FkZHJl
c3MoZCwgcGZuX3RvX3BhZGRyKHBmbikpICkKKyAgICBpZiAoIGh2bV9pc19tbWNmZ19hZGRyZXNz
KGQsIHBmbl90b19wYWRkcihwZm4pKSApCiAgICAgICAgIHJldHVybiBmYWxzZTsKIAogICAgIHJl
dHVybiB0cnVlOwpkaWZmIC0tZ2l0IGEveGVuL2RyaXZlcnMvdnBjaS92cGNpLmMgYi94ZW4vZHJp
dmVycy92cGNpL3ZwY2kuYwppbmRleCA3NThkOTQyMGU3Li41MTBlM2VlNzcxIDEwMDY0NAotLS0g
YS94ZW4vZHJpdmVycy92cGNpL3ZwY2kuYworKysgYi94ZW4vZHJpdmVycy92cGNpL3ZwY2kuYwpA
QCAtMjAsNiArMjAsOCBAQAogI2luY2x1ZGUgPHhlbi9zY2hlZC5oPgogI2luY2x1ZGUgPHhlbi92
cGNpLmg+CiAKKyNpbmNsdWRlIDxhc20vaHZtL2lvcmVxLmg+CisKIC8qIEludGVybmFsIHN0cnVj
dCB0byBzdG9yZSB0aGUgZW11bGF0ZWQgUENJIHJlZ2lzdGVycy4gKi8KIHN0cnVjdCB2cGNpX3Jl
Z2lzdGVyIHsKICAgICB2cGNpX3JlYWRfdCAqcmVhZDsKQEAgLTQ3Myw2ICs0NzUsNTggQEAgdm9p
ZCB2cGNpX3dyaXRlKHBjaV9zYmRmX3Qgc2JkZiwgdW5zaWduZWQgaW50IHJlZywgdW5zaWduZWQg
aW50IHNpemUsCiAgICAgc3Bpbl91bmxvY2soJnBkZXYtPnZwY2ktPmxvY2spOwogfQogCitzdGF0
aWMgaW50IGlvcmVxX2hhbmRsZXIoc3RydWN0IHZjcHUgKnYsIGlvcmVxX3QgKnJlcSkKK3sKKyAg
ICBwY2lfc2JkZl90IHNiZGY7CisKKyAgICBpZiAoIHJlcS0+dHlwZSAhPSBJT1JFUV9UWVBFX1BD
SV9DT05GSUcgfHwgcmVxLT5kYXRhX2lzX3B0ciApCisgICAgeworICAgICAgICBBU1NFUlRfVU5S
RUFDSEFCTEUoKTsKKyAgICAgICAgcmV0dXJuIFg4NkVNVUxfVU5IQU5ETEVBQkxFOworICAgIH0K
KworICAgIHNiZGYuc2JkZiA9IHJlcS0+YWRkciA+PiAzMjsKKworICAgIGlmICggcmVxLT5kaXIg
KQorICAgICAgICByZXEtPmRhdGEgPSB2cGNpX3JlYWQoc2JkZiwgcmVxLT5hZGRyLCByZXEtPnNp
emUpOworICAgIGVsc2UKKyAgICAgICAgdnBjaV93cml0ZShzYmRmLCByZXEtPmFkZHIsIHJlcS0+
c2l6ZSwgcmVxLT5kYXRhKTsKKworICAgIHJldHVybiBYODZFTVVMX09LQVk7Cit9CisKK2ludCB2
cGNpX3JlZ2lzdGVyX2lvcmVxKHN0cnVjdCBkb21haW4gKmQpCit7CisgICAgaW9zZXJ2aWRfdCBp
ZDsKKyAgICBpbnQgcmM7CisKKyAgICBpZiAoICFoYXNfdnBjaShkKSApCisgICAgICAgIHJldHVy
biAwOworCisgICAgcmMgPSBodm1fY3JlYXRlX2lvcmVxX3NlcnZlcihkLCBIVk1fSU9SRVFTUlZf
QlVGSU9SRVFfT0ZGLCAmaWQsIHRydWUpOworICAgIGlmICggcmMgKQorICAgICAgICByZXR1cm4g
cmM7CisKKyAgICByYyA9IGh2bV9hZGRfaW9yZXFfaGFuZGxlcihkLCBpZCwgaW9yZXFfaGFuZGxl
cik7CisgICAgaWYgKCByYyApCisgICAgICAgIHJldHVybiByYzsKKworICAgIGlmICggaXNfaGFy
ZHdhcmVfZG9tYWluKGQpICkKKyAgICB7CisgICAgICAgIC8qIEhhbmRsZSBhbGwgZGV2aWNlcyBp
biB2cGNpLiAqLworICAgICAgICByYyA9IGh2bV9tYXBfaW9fcmFuZ2VfdG9faW9yZXFfc2VydmVy
KGQsIGlkLCBYRU5fRE1PUF9JT19SQU5HRV9QQ0ksCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgMCwgfih1aW50NjRfdCkwLCB0cnVlKTsKKyAgICAgICAgaWYg
KCByYyApCisgICAgICAgICAgICByZXR1cm4gcmM7CisgICAgfQorCisgICAgcmMgPSBodm1fc2V0
X2lvcmVxX3NlcnZlcl9zdGF0ZShkLCBpZCwgdHJ1ZSwgdHJ1ZSk7CisgICAgaWYgKCByYyApCisg
ICAgICAgIHJldHVybiByYzsKKworICAgIHJldHVybiByYzsKK30KKwogLyoKICAqIExvY2FsIHZh
cmlhYmxlczoKICAqIG1vZGU6IEMKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL2FzbS14ODYvaHZt
L2lvLmggYi94ZW4vaW5jbHVkZS9hc20teDg2L2h2bS9pby5oCmluZGV4IDI2ZjA0ODkxNzEuLjc1
YTI0ZjMzYmMgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL2FzbS14ODYvaHZtL2lvLmgKKysrIGIv
eGVuL2luY2x1ZGUvYXNtLXg4Ni9odm0vaW8uaApAQCAtMTk2LDcgKzE5Niw3IEBAIGludCByZWdp
c3Rlcl92cGNpX21tY2ZnX2hhbmRsZXIoc3RydWN0IGRvbWFpbiAqZCwgcGFkZHJfdCBhZGRyLAog
dm9pZCBkZXN0cm95X3ZwY2lfbW1jZmcoc3RydWN0IGRvbWFpbiAqZCk7CiAKIC8qIENoZWNrIGlm
IGFuIGFkZHJlc3MgaXMgYmV0d2VlbiBhIE1NQ0ZHIHJlZ2lvbiBmb3IgYSBkb21haW4uICovCi1i
b29sIHZwY2lfaXNfbW1jZmdfYWRkcmVzcyhjb25zdCBzdHJ1Y3QgZG9tYWluICpkLCBwYWRkcl90
IGFkZHIpOworYm9vbCBodm1faXNfbW1jZmdfYWRkcmVzcyhjb25zdCBzdHJ1Y3QgZG9tYWluICpk
LCBwYWRkcl90IGFkZHIpOwogCiAjZW5kaWYgLyogX19BU01fWDg2X0hWTV9JT19IX18gKi8KIApk
aWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUveGVuL3ZwY2kuaCBiL3hlbi9pbmNsdWRlL3hlbi92cGNp
LmgKaW5kZXggNGNmMjMzYzc3OS4uNjY2ZGQxY2E2OCAxMDA2NDQKLS0tIGEveGVuL2luY2x1ZGUv
eGVuL3ZwY2kuaAorKysgYi94ZW4vaW5jbHVkZS94ZW4vdnBjaS5oCkBAIC0yMyw2ICsyMyw5IEBA
IHR5cGVkZWYgaW50IHZwY2lfcmVnaXN0ZXJfaW5pdF90KHN0cnVjdCBwY2lfZGV2ICpkZXYpOwog
ICBzdGF0aWMgdnBjaV9yZWdpc3Rlcl9pbml0X3QgKmNvbnN0IHgjI19lbnRyeSAgXAogICAgICAg
ICAgICAgICAgX191c2VkX3NlY3Rpb24oIi5kYXRhLnZwY2kuIiBwKSA9IHgKIAorLyogUmVnaXN0
ZXIgdlBDSSBoYW5kbGVyIHdpdCBpb3JlcS4gKi8KK2ludCB2cGNpX3JlZ2lzdGVyX2lvcmVxKHN0
cnVjdCBkb21haW4gKmQpOworCiAvKiBBZGQgdlBDSSBoYW5kbGVycyB0byBkZXZpY2UuICovCiBp
bnQgX19tdXN0X2NoZWNrIHZwY2lfYWRkX2hhbmRsZXJzKHN0cnVjdCBwY2lfZGV2ICpkZXYpOwog
Ci0tIAoyLjIyLjAKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9y
ZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

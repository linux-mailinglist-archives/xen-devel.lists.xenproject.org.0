Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 150001A111
	for <lists+xen-devel@lfdr.de>; Fri, 10 May 2019 18:14:12 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hP87z-0004fh-G5; Fri, 10 May 2019 16:12:07 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=35pT=TK=citrix.com=prvs=026e1af23=roger.pau@srs-us1.protection.inumbo.net>)
 id 1hP87x-0004f8-BA
 for xen-devel@lists.xenproject.org; Fri, 10 May 2019 16:12:05 +0000
X-Inumbo-ID: 585e520a-733e-11e9-8edb-efea701647df
Received: from SMTP03.CITRIX.COM (unknown [162.221.156.55])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 585e520a-733e-11e9-8edb-efea701647df;
 Fri, 10 May 2019 16:12:02 +0000 (UTC)
X-IronPort-AV: E=Sophos;i="5.60,453,1549929600"; d="scan'208";a="85330726"
From: Roger Pau Monne <roger.pau@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Fri, 10 May 2019 18:10:56 +0200
Message-ID: <20190510161056.48648-6-roger.pau@citrix.com>
X-Mailer: git-send-email 2.17.2 (Apple Git-113)
In-Reply-To: <20190510161056.48648-1-roger.pau@citrix.com>
References: <20190510161056.48648-1-roger.pau@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH 5/5] pci: switch PCI capabilities related
 functions to use pci_sbdf_t
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Kevin Tian <kevin.tian@intel.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wei.liu2@citrix.com>,
 Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>,
 Brian Woods <brian.woods@amd.com>, Roger Pau Monne <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

U2luY2UgcGNpX2RldiBhbHJlYWR5IGhhcyBhIHBjaV9zYmRmX3QgZmllbGQgc3dpdGNoIHRoZSBj
YXBhYmlsaXR5CnJlbGF0ZWQgZnVuY3Rpb25zIFNCREYgcGFyYW1ldGVycyB0byBhIHNpbmdsZSBw
Y2lfc2JkZl90IHBhcmFtZXRlci4KCk5vIGZ1bmN0aW9uYWwgY2hhbmdlIGV4cGVjdGVkLgoKU2ln
bmVkLW9mZi1ieTogUm9nZXIgUGF1IE1vbm7DqSA8cm9nZXIucGF1QGNpdHJpeC5jb20+Ci0tLQpD
YzogSmFuIEJldWxpY2ggPGpiZXVsaWNoQHN1c2UuY29tPgpDYzogQW5kcmV3IENvb3BlciA8YW5k
cmV3LmNvb3BlcjNAY2l0cml4LmNvbT4KQ2M6IFdlaSBMaXUgPHdlaS5saXUyQGNpdHJpeC5jb20+
CkNjOiBHZW9yZ2UgRHVubGFwIDxHZW9yZ2UuRHVubGFwQGV1LmNpdHJpeC5jb20+CkNjOiBJYW4g
SmFja3NvbiA8aWFuLmphY2tzb25AZXUuY2l0cml4LmNvbT4KQ2M6IEp1bGllbiBHcmFsbCA8anVs
aWVuLmdyYWxsQGFybS5jb20+CkNjOiBLb25yYWQgUnplc3p1dGVrIFdpbGsgPGtvbnJhZC53aWxr
QG9yYWNsZS5jb20+CkNjOiBTdGVmYW5vIFN0YWJlbGxpbmkgPHNzdGFiZWxsaW5pQGtlcm5lbC5v
cmc+CkNjOiBUaW0gRGVlZ2FuIDx0aW1AeGVuLm9yZz4KQ2M6IFN1cmF2ZWUgU3V0aGlrdWxwYW5p
dCA8c3VyYXZlZS5zdXRoaWt1bHBhbml0QGFtZC5jb20+CkNjOiBCcmlhbiBXb29kcyA8YnJpYW4u
d29vZHNAYW1kLmNvbT4KQ2M6IEtldmluIFRpYW4gPGtldmluLnRpYW5AaW50ZWwuY29tPgotLS0K
IHhlbi9hcmNoL3g4Ni9tc2kuYyAgICAgICAgICAgICAgICAgICAgICAgICB8IDQyICsrKysrKy0t
LS0tLS0tLS0tLS0tLS0KIHhlbi9kcml2ZXJzL2NoYXIvZWhjaS1kYmdwLmMgICAgICAgICAgICAg
ICB8ICAzICstCiB4ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfZGV0ZWN0LmMgfCAg
MiArLQogeGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYXRzLmggICAgICAgICAgICAgIHwgMTIgKysr
KystLQogeGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvcGNpLmMgICAgICAgICAgICAgIHwgMjIgKysr
KystLS0tLS0tCiB4ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC92dGQvcXVpcmtzLmMgICAgICAgfCAx
MiArKystLS0tCiB4ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC92dGQveDg2L2F0cy5jICAgICAgfCAg
MyArLQogeGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gveDg2L2F0cy5jICAgICAgICAgIHwgIDQgKy0t
CiB4ZW4vZHJpdmVycy9wY2kvcGNpLmMgICAgICAgICAgICAgICAgICAgICAgfCAzMSArKysrKy0t
LS0tLS0tLS0tCiB4ZW4vZHJpdmVycy92cGNpL21zaS5jICAgICAgICAgICAgICAgICAgICAgfCAg
NCArLS0KIHhlbi9kcml2ZXJzL3ZwY2kvbXNpeC5jICAgICAgICAgICAgICAgICAgICB8ICA0ICst
LQogeGVuL2luY2x1ZGUveGVuL3BjaS5oICAgICAgICAgICAgICAgICAgICAgIHwgIDkgKystLS0K
IDEyIGZpbGVzIGNoYW5nZWQsIDUyIGluc2VydGlvbnMoKyksIDk2IGRlbGV0aW9ucygtKQoKZGlm
ZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9tc2kuYyBiL3hlbi9hcmNoL3g4Ni9tc2kuYwppbmRleCA2
ODMyMjExNzcyLi4yN2VhMTFiNzY5IDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYvbXNpLmMKKysr
IGIveGVuL2FyY2gveDg2L21zaS5jCkBAIC0zMzksNyArMzM5LDcgQEAgc3RhdGljIHZvaWQgbXNp
X3NldF9lbmFibGUoc3RydWN0IHBjaV9kZXYgKmRldiwgaW50IGVuYWJsZSkKICAgICB1aW50OF90
IHNsb3QgPSBkZXYtPnNiZGYuZGV2OwogICAgIHVpbnQ4X3QgZnVuYyA9IGRldi0+c2JkZi5mdW5j
OwogCi0gICAgcG9zID0gcGNpX2ZpbmRfY2FwX29mZnNldChzZWcsIGJ1cywgc2xvdCwgZnVuYywg
UENJX0NBUF9JRF9NU0kpOworICAgIHBvcyA9IHBjaV9maW5kX2NhcF9vZmZzZXQoZGV2LT5zYmRm
LCBQQ0lfQ0FQX0lEX01TSSk7CiAgICAgaWYgKCBwb3MgKQogICAgICAgICBfX21zaV9zZXRfZW5h
YmxlKHNlZywgYnVzLCBzbG90LCBmdW5jLCBwb3MsIGVuYWJsZSk7CiB9CkBAIC0zNDcsMTIgKzM0
Nyw5IEBAIHN0YXRpYyB2b2lkIG1zaV9zZXRfZW5hYmxlKHN0cnVjdCBwY2lfZGV2ICpkZXYsIGlu
dCBlbmFibGUpCiBzdGF0aWMgdm9pZCBtc2l4X3NldF9lbmFibGUoc3RydWN0IHBjaV9kZXYgKmRl
diwgaW50IGVuYWJsZSkKIHsKICAgICBpbnQgcG9zOwotICAgIHVpbnQxNl90IGNvbnRyb2wsIHNl
ZyA9IGRldi0+c2JkZi5zZWc7Ci0gICAgdWludDhfdCBidXMgPSBkZXYtPnNiZGYuYnVzOwotICAg
IHVpbnQ4X3Qgc2xvdCA9IGRldi0+c2JkZi5kZXY7Ci0gICAgdWludDhfdCBmdW5jID0gZGV2LT5z
YmRmLmZ1bmM7CisgICAgdWludDE2X3QgY29udHJvbDsKIAotICAgIHBvcyA9IHBjaV9maW5kX2Nh
cF9vZmZzZXQoc2VnLCBidXMsIHNsb3QsIGZ1bmMsIFBDSV9DQVBfSURfTVNJWCk7CisgICAgcG9z
ID0gcGNpX2ZpbmRfY2FwX29mZnNldChkZXYtPnNiZGYsIFBDSV9DQVBfSURfTVNJWCk7CiAgICAg
aWYgKCBwb3MgKQogICAgIHsKICAgICAgICAgY29udHJvbCA9IHBjaV9jb25mX3JlYWQxNihkZXYt
PnNiZGYsIG1zaXhfY29udHJvbF9yZWcocG9zKSk7CkBAIC02NjksMTMgKzY2NiwxMCBAQCBzdGF0
aWMgaW50IG1zaV9jYXBhYmlsaXR5X2luaXQoc3RydWN0IHBjaV9kZXYgKmRldiwKICAgICBzdHJ1
Y3QgbXNpX2Rlc2MgKmVudHJ5OwogICAgIGludCBwb3M7CiAgICAgdW5zaWduZWQgaW50IGksIG1h
eHZlYywgbXBvczsKLSAgICB1aW50MTZfdCBjb250cm9sLCBzZWcgPSBkZXYtPnNiZGYuc2VnOwot
ICAgIHVpbnQ4X3QgYnVzID0gZGV2LT5zYmRmLmJ1czsKLSAgICB1aW50OF90IHNsb3QgPSBkZXYt
PnNiZGYuZGV2OwotICAgIHVpbnQ4X3QgZnVuYyA9IGRldi0+c2JkZi5mdW5jOworICAgIHVpbnQx
Nl90IGNvbnRyb2w7CiAKICAgICBBU1NFUlQocGNpZGV2c19sb2NrZWQoKSk7Ci0gICAgcG9zID0g
cGNpX2ZpbmRfY2FwX29mZnNldChzZWcsIGJ1cywgc2xvdCwgZnVuYywgUENJX0NBUF9JRF9NU0kp
OworICAgIHBvcyA9IHBjaV9maW5kX2NhcF9vZmZzZXQoZGV2LT5zYmRmLCBQQ0lfQ0FQX0lEX01T
SSk7CiAgICAgaWYgKCAhcG9zICkKICAgICAgICAgcmV0dXJuIC1FTk9ERVY7CiAgICAgY29udHJv
bCA9IHBjaV9jb25mX3JlYWQxNihkZXYtPnNiZGYsIG1zaV9jb250cm9sX3JlZyhwb3MpKTsKQEAg
LTc1Miw5ICs3NDYsNyBAQCBzdGF0aWMgdTY0IHJlYWRfcGNpX21lbV9iYXIodTE2IHNlZywgdTgg
YnVzLCB1OCBzbG90LCB1OCBmdW5jLCB1OCBiaXIsIGludCB2ZikKICAgICBpZiAoIHZmID49IDAg
KQogICAgIHsKICAgICAgICAgc3RydWN0IHBjaV9kZXYgKnBkZXYgPSBwY2lfZ2V0X3BkZXYoc2Vn
LCBidXMsIFBDSV9ERVZGTihzbG90LCBmdW5jKSk7Ci0gICAgICAgIHVuc2lnbmVkIGludCBwb3Mg
PSBwY2lfZmluZF9leHRfY2FwYWJpbGl0eShzZWcsIGJ1cywKLSAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9ERVZGTihzbG90LCBmdW5jKSwKLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9FWFRf
Q0FQX0lEX1NSSU9WKTsKKyAgICAgICAgdW5zaWduZWQgaW50IHBvcyA9IHBjaV9maW5kX2V4dF9j
YXBhYmlsaXR5KHNiZGYsIFBDSV9FWFRfQ0FQX0lEX1NSSU9WKTsKICAgICAgICAgdTE2IGN0cmwg
PSBwY2lfY29uZl9yZWFkMTYoc2JkZiwgcG9zICsgUENJX1NSSU9WX0NUUkwpOwogICAgICAgICB1
MTYgbnVtX3ZmID0gcGNpX2NvbmZfcmVhZDE2KHNiZGYsIHBvcyArIFBDSV9TUklPVl9OVU1fVkYp
OwogICAgICAgICB1MTYgb2Zmc2V0ID0gcGNpX2NvbmZfcmVhZDE2KHNiZGYsIHBvcyArIFBDSV9T
UklPVl9WRl9PRkZTRVQpOwpAQCAtMTA5NiwxMyArMTA4OCwxMiBAQCBzdGF0aWMgaW50IF9fcGNp
X2VuYWJsZV9tc2l4KHN0cnVjdCBtc2lfaW5mbyAqbXNpLCBzdHJ1Y3QgbXNpX2Rlc2MgKipkZXNj
KQogICAgIGludCBwb3MsIG5yX2VudHJpZXM7CiAgICAgc3RydWN0IHBjaV9kZXYgKnBkZXY7CiAg
ICAgdTE2IGNvbnRyb2w7Ci0gICAgdTggc2xvdCA9IFBDSV9TTE9UKG1zaS0+ZGV2Zm4pOwotICAg
IHU4IGZ1bmMgPSBQQ0lfRlVOQyhtc2ktPmRldmZuKTsKICAgICBzdHJ1Y3QgbXNpX2Rlc2MgKm9s
ZF9kZXNjOwogCiAgICAgQVNTRVJUKHBjaWRldnNfbG9ja2VkKCkpOwogICAgIHBkZXYgPSBwY2lf
Z2V0X3BkZXYobXNpLT5zZWcsIG1zaS0+YnVzLCBtc2ktPmRldmZuKTsKLSAgICBwb3MgPSBwY2lf
ZmluZF9jYXBfb2Zmc2V0KG1zaS0+c2VnLCBtc2ktPmJ1cywgc2xvdCwgZnVuYywgUENJX0NBUF9J
RF9NU0lYKTsKKyAgICBwb3MgPSBwY2lfZmluZF9jYXBfb2Zmc2V0KFBDSV9TQkRGM19UKG1zaS0+
c2VnLCBtc2ktPmJ1cywgbXNpLT5kZXZmbiksCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBQQ0lfQ0FQX0lEX01TSVgpOwogICAgIGlmICggIXBkZXYgfHwgIXBvcyApCiAgICAgICAgIHJl
dHVybiAtRU5PREVWOwogCkBAIC0xMTQ1LDEyICsxMTM2LDcgQEAgc3RhdGljIHZvaWQgX3BjaV9j
bGVhbnVwX21zaXgoc3RydWN0IGFyY2hfbXNpeCAqbXNpeCkKIHN0YXRpYyB2b2lkIF9fcGNpX2Rp
c2FibGVfbXNpeChzdHJ1Y3QgbXNpX2Rlc2MgKmVudHJ5KQogewogICAgIHN0cnVjdCBwY2lfZGV2
ICpkZXYgPSBlbnRyeS0+ZGV2OwotICAgIHVpbnQxNl90IHNlZyA9IGRldi0+c2JkZi5zZWc7Ci0g
ICAgdWludDhfdCBidXMgPSBkZXYtPnNiZGYuYnVzOwotICAgIHVpbnQ4X3Qgc2xvdCA9IGRldi0+
c2JkZi5kZXY7Ci0gICAgdWludDhfdCBmdW5jID0gZGV2LT5zYmRmLmZ1bmM7Ci0gICAgdW5zaWdu
ZWQgaW50IHBvcyA9IHBjaV9maW5kX2NhcF9vZmZzZXQoc2VnLCBidXMsIHNsb3QsIGZ1bmMsCi0g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJX0NBUF9JRF9NU0lY
KTsKKyAgICB1bnNpZ25lZCBpbnQgcG9zID0gcGNpX2ZpbmRfY2FwX29mZnNldChkZXYtPnNiZGYs
IFBDSV9DQVBfSURfTVNJWCk7CiAgICAgdWludDE2X3QgY29udHJvbCA9IHBjaV9jb25mX3JlYWQx
NihkZXYtPnNiZGYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2l4
X2NvbnRyb2xfcmVnKGVudHJ5LT5tc2lfYXR0cmliLnBvcykpOwogICAgIGJvb2wgbWFza2FsbCA9
IGRldi0+bXNpeC0+aG9zdF9tYXNrYWxsOwpAQCAtMTE4Niw4ICsxMTcyLDcgQEAgaW50IHBjaV9w
cmVwYXJlX21zaXgodTE2IHNlZywgdTggYnVzLCB1OCBkZXZmbiwgYm9vbCBvZmYpCiB7CiAgICAg
aW50IHJjOwogICAgIHN0cnVjdCBwY2lfZGV2ICpwZGV2OwotICAgIHU4IHNsb3QgPSBQQ0lfU0xP
VChkZXZmbiksIGZ1bmMgPSBQQ0lfRlVOQyhkZXZmbik7Ci0gICAgdW5zaWduZWQgaW50IHBvcyA9
IHBjaV9maW5kX2NhcF9vZmZzZXQoc2VnLCBidXMsIHNsb3QsIGZ1bmMsCisgICAgdW5zaWduZWQg
aW50IHBvcyA9IHBjaV9maW5kX2NhcF9vZmZzZXQoUENJX1NCREYzX1Qoc2VnLCBidXMsIGRldmZu
KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lfQ0FQX0lE
X01TSVgpOwogCiAgICAgaWYgKCAhdXNlX21zaSApCkBAIC0xMjY3LDEwICsxMjUyLDYgQEAgdm9p
ZCBwY2lfY2xlYW51cF9tc2koc3RydWN0IHBjaV9kZXYgKnBkZXYpCiBpbnQgcGNpX21zaV9jb25m
X3dyaXRlX2ludGVyY2VwdChzdHJ1Y3QgcGNpX2RldiAqcGRldiwgdW5zaWduZWQgaW50IHJlZywK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCBzaXplLCB1aW50
MzJfdCAqZGF0YSkKIHsKLSAgICB1aW50MTZfdCBzZWcgPSBwZGV2LT5zYmRmLnNlZzsKLSAgICB1
aW50OF90IGJ1cyA9IHBkZXYtPnNiZGYuYnVzOwotICAgIHVpbnQ4X3Qgc2xvdCA9IHBkZXYtPnNi
ZGYuZGV2OwotICAgIHVpbnQ4X3QgZnVuYyA9IHBkZXYtPnNiZGYuZnVuYzsKICAgICBzdHJ1Y3Qg
bXNpX2Rlc2MgKmVudHJ5OwogICAgIHVuc2lnbmVkIGludCBwb3M7CiAKQEAgLTEyNzgsOCArMTI1
OSw3IEBAIGludCBwY2lfbXNpX2NvbmZfd3JpdGVfaW50ZXJjZXB0KHN0cnVjdCBwY2lfZGV2ICpw
ZGV2LCB1bnNpZ25lZCBpbnQgcmVnLAogICAgIHsKICAgICAgICAgZW50cnkgPSBmaW5kX21zaV9l
bnRyeShwZGV2LCAtMSwgUENJX0NBUF9JRF9NU0lYKTsKICAgICAgICAgcG9zID0gZW50cnkgPyBl
bnRyeS0+bXNpX2F0dHJpYi5wb3MKLSAgICAgICAgICAgICAgICAgICAgOiBwY2lfZmluZF9jYXBf
b2Zmc2V0KHNlZywgYnVzLCBzbG90LCBmdW5jLAotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgUENJX0NBUF9JRF9NU0lYKTsKKyAgICAgICAgICAgICAgICAgICAgOiBw
Y2lfZmluZF9jYXBfb2Zmc2V0KHBkZXYtPnNiZGYsIFBDSV9DQVBfSURfTVNJWCk7CiAgICAgICAg
IEFTU0VSVChwb3MpOwogCiAgICAgICAgIGlmICggcmVnID49IHBvcyAmJiByZWcgPCBtc2l4X3Bi
YV9vZmZzZXRfcmVnKHBvcykgKyA0ICkKZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL2NoYXIvZWhj
aS1kYmdwLmMgYi94ZW4vZHJpdmVycy9jaGFyL2VoY2ktZGJncC5jCmluZGV4IDRjZDQxNTczNTMu
LjI3YmQ0YjkzNWQgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL2NoYXIvZWhjaS1kYmdwLmMKKysr
IGIveGVuL2RyaXZlcnMvY2hhci9laGNpLWRiZ3AuYwpAQCAtNjg4LDcgKzY4OCw4IEBAIHN0YXRp
YyB1bnNpZ25lZCBpbnQgX19pbml0IF9fZmluZF9kYmdwKHU4IGJ1cywgdTggc2xvdCwgdTggZnVu
YykKICAgICBpZiAoIChjbGFzcyA+PiA4KSAhPSBQQ0lfQ0xBU1NfU0VSSUFMX1VTQl9FSENJICkK
ICAgICAgICAgcmV0dXJuIDA7CiAKLSAgICByZXR1cm4gcGNpX2ZpbmRfY2FwX29mZnNldCgwLCBi
dXMsIHNsb3QsIGZ1bmMsIFBDSV9DQVBfSURfRUhDSV9ERUJVRyk7CisgICAgcmV0dXJuIHBjaV9m
aW5kX2NhcF9vZmZzZXQoUENJX1NCREZfVCgwLCBidXMsIHNsb3QsIGZ1bmMpLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIFBDSV9DQVBfSURfRUhDSV9ERUJVRyk7CiB9CiAKIHN0YXRp
YyB1bnNpZ25lZCBpbnQgX19pbml0IGZpbmRfZGJncChzdHJ1Y3QgZWhjaV9kYmdwICpkYmdwLApk
aWZmIC0tZ2l0IGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL2lvbW11X2RldGVjdC5jIGIv
eGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL2lvbW11X2RldGVjdC5jCmluZGV4IDkxZjVlYTZi
ZmYuLjNiMzY4MjdjMTQgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9p
b21tdV9kZXRlY3QuYworKysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfZGV0
ZWN0LmMKQEAgLTMwLDcgKzMwLDcgQEAgc3RhdGljIGludCBfX2luaXQgZ2V0X2lvbW11X21zaV9j
YXBhYmlsaXRpZXMoCiB7CiAgICAgaW50IHBvczsKIAotICAgIHBvcyA9IHBjaV9maW5kX2NhcF9v
ZmZzZXQoc2VnLCBidXMsIGRldiwgZnVuYywgUENJX0NBUF9JRF9NU0kpOworICAgIHBvcyA9IHBj
aV9maW5kX2NhcF9vZmZzZXQoUENJX1NCREZfVChzZWcsIGJ1cywgZGV2LCBmdW5jKSwgUENJX0NB
UF9JRF9NU0kpOwogCiAgICAgaWYgKCAhcG9zICkKICAgICAgICAgcmV0dXJuIC1FTk9ERVY7CmRp
ZmYgLS1naXQgYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hdHMuaCBiL3hlbi9kcml2ZXJzL3Bh
c3N0aHJvdWdoL2F0cy5oCmluZGV4IGU4M2E0NWQxNmUuLjNiOTk2Yzc0OGEgMTAwNjQ0Ci0tLSBh
L3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2F0cy5oCisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJv
dWdoL2F0cy5oCkBAIC0zMSwxMSArMzEsMTYgQEAgc3RhdGljIGlubGluZSBpbnQgcGNpX2F0c19l
bmFibGVkKGludCBzZWcsIGludCBidXMsIGludCBkZXZmbikKIHsKICAgICB1MzIgdmFsdWU7CiAg
ICAgaW50IHBvczsKKyAgICBjb25zdCBwY2lfc2JkZl90IHNiZGYgPSB7CisgICAgICAgIC5zZWcg
PSBzZWcsCisgICAgICAgIC5idXMgPSBidXMsCisgICAgICAgIC5leHRmdW5jID0gZGV2Zm4sCisg
ICAgfTsKIAotICAgIHBvcyA9IHBjaV9maW5kX2V4dF9jYXBhYmlsaXR5KHNlZywgYnVzLCBkZXZm
biwgUENJX0VYVF9DQVBfSURfQVRTKTsKKyAgICBwb3MgPSBwY2lfZmluZF9leHRfY2FwYWJpbGl0
eShzYmRmLCBQQ0lfRVhUX0NBUF9JRF9BVFMpOwogICAgIEJVR19PTighcG9zKTsKIAotICAgIHZh
bHVlID0gcGNpX2NvbmZfcmVhZDE2KFBDSV9TQkRGM19UKHNlZywgYnVzLCBkZXZmbiksIHBvcyAr
IEFUU19SRUdfQ1RMKTsKKyAgICB2YWx1ZSA9IHBjaV9jb25mX3JlYWQxNihzYmRmLCBwb3MgKyBB
VFNfUkVHX0NUTCk7CiAKICAgICByZXR1cm4gdmFsdWUgJiBBVFNfRU5BQkxFOwogfQpAQCAtNDUs
NyArNTAsOCBAQCBzdGF0aWMgaW5saW5lIGludCBwY2lfYXRzX2RldmljZShpbnQgc2VnLCBpbnQg
YnVzLCBpbnQgZGV2Zm4pCiAgICAgaWYgKCAhYXRzX2VuYWJsZWQgKQogICAgICAgICByZXR1cm4g
MDsKIAotICAgIHJldHVybiBwY2lfZmluZF9leHRfY2FwYWJpbGl0eShzZWcsIGJ1cywgZGV2Zm4s
IFBDSV9FWFRfQ0FQX0lEX0FUUyk7CisgICAgcmV0dXJuIHBjaV9maW5kX2V4dF9jYXBhYmlsaXR5
KFBDSV9TQkRGM19UKHNlZywgYnVzLCBkZXZmbiksCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIFBDSV9FWFRfQ0FQX0lEX0FUUyk7CiB9CiAKICNlbmRpZiAvKiBfQVRTX0hfICov
CmRpZmYgLS1naXQgYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9wY2kuYyBiL3hlbi9kcml2ZXJz
L3Bhc3N0aHJvdWdoL3BjaS5jCmluZGV4IGE5NjY3Y2EyMWMuLmNmZTJkZGE3MzMgMTAwNjQ0Ci0t
LSBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3BjaS5jCisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0
aHJvdWdoL3BjaS5jCkBAIC0zMzIsOCArMzMyLDcgQEAgc3RhdGljIHN0cnVjdCBwY2lfZGV2ICph
bGxvY19wZGV2KHN0cnVjdCBwY2lfc2VnICpwc2VnLCB1OCBidXMsIHU4IGRldmZuKQogICAgIHBk
ZXYtPmRvbWFpbiA9IE5VTEw7CiAgICAgSU5JVF9MSVNUX0hFQUQoJnBkZXYtPm1zaV9saXN0KTsK
IAotICAgIGlmICggcGNpX2ZpbmRfY2FwX29mZnNldChwc2VnLT5uciwgYnVzLCBQQ0lfU0xPVChk
ZXZmbiksIFBDSV9GVU5DKGRldmZuKSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUENJ
X0NBUF9JRF9NU0lYKSApCisgICAgaWYgKCBwY2lfZmluZF9jYXBfb2Zmc2V0KHBkZXYtPnNiZGYs
IFBDSV9DQVBfSURfTVNJWCkgKQogICAgIHsKICAgICAgICAgc3RydWN0IGFyY2hfbXNpeCAqbXNp
eCA9IHh6YWxsb2Moc3RydWN0IGFyY2hfbXNpeCk7CiAKQEAgLTM3MSw4ICszNzAsNyBAQCBzdGF0
aWMgc3RydWN0IHBjaV9kZXYgKmFsbG9jX3BkZXYoc3RydWN0IHBjaV9zZWcgKnBzZWcsIHU4IGJ1
cywgdTggZGV2Zm4pCiAgICAgICAgICAgICBicmVhazsKIAogICAgICAgICBjYXNlIERFVl9UWVBF
X1BDSWVfRU5EUE9JTlQ6Ci0gICAgICAgICAgICBwb3MgPSBwY2lfZmluZF9jYXBfb2Zmc2V0KHBz
ZWctPm5yLCBidXMsIFBDSV9TTE9UKGRldmZuKSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgUENJX0ZVTkMoZGV2Zm4pLCBQQ0lfQ0FQX0lEX0VYUCk7CisgICAgICAgICAg
ICBwb3MgPSBwY2lfZmluZF9jYXBfb2Zmc2V0KHBkZXYtPnNiZGYsIFBDSV9DQVBfSURfRVhQKTsK
ICAgICAgICAgICAgIEJVR19PTighcG9zKTsKICAgICAgICAgICAgIGNhcCA9IHBjaV9jb25mX3Jl
YWQxNihwZGV2LT5zYmRmLCBwb3MgKyBQQ0lfRVhQX0RFVkNBUCk7CiAgICAgICAgICAgICBpZiAo
IGNhcCAmIFBDSV9FWFBfREVWQ0FQX1BIQU5UT00gKQpAQCAtNTg1LDEzICs1ODMsMTIgQEAgc3Ry
dWN0IHBjaV9kZXYgKnBjaV9nZXRfcGRldl9ieV9kb21haW4oY29uc3Qgc3RydWN0IGRvbWFpbiAq
ZCwgaW50IHNlZywKIHN0YXRpYyB2b2lkIHBjaV9lbmFibGVfYWNzKHN0cnVjdCBwY2lfZGV2ICpw
ZGV2KQogewogICAgIGludCBwb3M7Ci0gICAgdWludDE2X3QgY2FwLCBjdHJsLCBzZWcgPSBwZGV2
LT5zYmRmLnNlZzsKLSAgICB1aW50OF90IGJ1cyA9IHBkZXYtPnNiZGYuYnVzOworICAgIHVpbnQx
Nl90IGNhcCwgY3RybDsKIAogICAgIGlmICggIWlvbW11X2VuYWJsZWQgKQogICAgICAgICByZXR1
cm47CiAKLSAgICBwb3MgPSBwY2lfZmluZF9leHRfY2FwYWJpbGl0eShzZWcsIGJ1cywgcGRldi0+
c2JkZi5leHRmdW5jLCBQQ0lfRVhUX0NBUF9JRF9BQ1MpOworICAgIHBvcyA9IHBjaV9maW5kX2V4
dF9jYXBhYmlsaXR5KHBkZXYtPnNiZGYsIFBDSV9FWFRfQ0FQX0lEX0FDUyk7CiAgICAgaWYgKCFw
b3MpCiAgICAgICAgIHJldHVybjsKIApAQCAtNzIyLDcgKzcxOSw3IEBAIGludCBwY2lfYWRkX2Rl
dmljZSh1MTYgc2VnLCB1OCBidXMsIHU4IGRldmZuLAogCiAgICAgaWYgKCAhcGRldi0+aW5mby5p
c192aXJ0Zm4gJiYgIXBkZXYtPnZmX3JsZW5bMF0gKQogICAgIHsKLSAgICAgICAgdW5zaWduZWQg
aW50IHBvcyA9IHBjaV9maW5kX2V4dF9jYXBhYmlsaXR5KHNlZywgYnVzLCBkZXZmbiwKKyAgICAg
ICAgdW5zaWduZWQgaW50IHBvcyA9IHBjaV9maW5kX2V4dF9jYXBhYmlsaXR5KHBkZXYtPnNiZGYs
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lf
RVhUX0NBUF9JRF9TUklPVik7CiAgICAgICAgIHUxNiBjdHJsID0gcGNpX2NvbmZfcmVhZDE2KHBk
ZXYtPnNiZGYsIHBvcyArIFBDSV9TUklPVl9DVFJMKTsKIApAQCAtOTA3LDEzICs5MDQsMTMgQEAg
ZW51bSBwZGV2X3R5cGUgcGRldl90eXBlKHUxNiBzZWcsIHU4IGJ1cywgdTggZGV2Zm4pCiB7CiAg
ICAgdTE2IGNsYXNzX2RldmljZSwgY3JlZzsKICAgICB1OCBkID0gUENJX1NMT1QoZGV2Zm4pLCBm
ID0gUENJX0ZVTkMoZGV2Zm4pOwotICAgIGludCBwb3MgPSBwY2lfZmluZF9jYXBfb2Zmc2V0KHNl
ZywgYnVzLCBkLCBmLCBQQ0lfQ0FQX0lEX0VYUCk7CiAgICAgY29uc3QgcGNpX3NiZGZfdCBzYmRm
ID0gewogICAgICAgICAuc2VnID0gc2VnLAogICAgICAgICAuYnVzID0gYnVzLAogICAgICAgICAu
ZGV2ID0gZCwKICAgICAgICAgLmZ1bmMgPSBmLAogICAgIH07CisgICAgaW50IHBvcyA9IHBjaV9m
aW5kX2NhcF9vZmZzZXQoc2JkZiwgUENJX0NBUF9JRF9FWFApOwogCiAgICAgY2xhc3NfZGV2aWNl
ID0gcGNpX2NvbmZfcmVhZDE2KHNiZGYsIFBDSV9DTEFTU19ERVZJQ0UpOwogICAgIHN3aXRjaCAo
IGNsYXNzX2RldmljZSApCkBAIC0xMTc3LDkgKzExNzQsNyBAQCBzdGF0aWMgaW50IGhlc3RfbWF0
Y2hfcGNpKGNvbnN0IHN0cnVjdCBhY3BpX2hlc3RfYWVyX2NvbW1vbiAqcCwKIHN0YXRpYyBib29s
X3QgaGVzdF9tYXRjaF90eXBlKGNvbnN0IHN0cnVjdCBhY3BpX2hlc3RfaGVhZGVyICpoZXN0X2hk
ciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cnVjdCBwY2lfZGV2ICpw
ZGV2KQogewotICAgIHVuc2lnbmVkIGludCBwb3MgPSBwY2lfZmluZF9jYXBfb2Zmc2V0KHBkZXYt
PnNiZGYuc2VnLCBwZGV2LT5zYmRmLmJ1cywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBwZGV2LT5zYmRmLmRldiwgcGRldi0+c2JkZi5mdW5jLAotICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9DQVBfSURfRVhQKTsKKyAgICB1
bnNpZ25lZCBpbnQgcG9zID0gcGNpX2ZpbmRfY2FwX29mZnNldChwZGV2LT5zYmRmLCBQQ0lfQ0FQ
X0lEX0VYUCk7CiAgICAgdWludDhfdCBwY2llID0gTUFTS19FWFRSKHBjaV9jb25mX3JlYWQxNihw
ZGV2LT5zYmRmLCBwb3MgKyBQQ0lfRVhQX0ZMQUdTKSwKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgUENJX0VYUF9GTEFHU19UWVBFKTsKIApAQCAtMTI0OSw4ICsxMjQ0LDcgQEAgYm9vbF90
IHBjaWVfYWVyX2dldF9maXJtd2FyZV9maXJzdChjb25zdCBzdHJ1Y3QgcGNpX2RldiAqcGRldikK
IHsKICAgICBzdHJ1Y3QgYWVyX2hlc3RfcGFyc2VfaW5mbyBpbmZvID0geyAucGRldiA9IHBkZXYg
fTsKIAotICAgIHJldHVybiBwY2lfZmluZF9jYXBfb2Zmc2V0KHBkZXYtPnNiZGYuc2VnLCBwZGV2
LT5zYmRmLmJ1cywgcGRldi0+c2JkZi5kZXYsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgcGRldi0+c2JkZi5mdW5jLCBQQ0lfQ0FQX0lEX0VYUCkgJiYKKyAgICByZXR1cm4gcGNpX2Zp
bmRfY2FwX29mZnNldChwZGV2LT5zYmRmLCBQQ0lfQ0FQX0lEX0VYUCkgJiYKICAgICAgICAgICAg
YXBlaV9oZXN0X3BhcnNlKGFlcl9oZXN0X3BhcnNlLCAmaW5mbykgPj0gMCAmJgogICAgICAgICAg
ICBpbmZvLmZpcm13YXJlX2ZpcnN0OwogfQpkaWZmIC0tZ2l0IGEveGVuL2RyaXZlcnMvcGFzc3Ro
cm91Z2gvdnRkL3F1aXJrcy5jIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvdnRkL3F1aXJrcy5j
CmluZGV4IDAzMDJjNTAzZmIuLjI4OWQ0M2YwZmUgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL3Bh
c3N0aHJvdWdoL3Z0ZC9xdWlya3MuYworKysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC92dGQv
cXVpcmtzLmMKQEAgLTQyNiw4ICs0MjYsNiBAQCBpbnQgbWVfd2lmaV9xdWlyayhzdHJ1Y3QgZG9t
YWluICpkb21haW4sIHU4IGJ1cywgdTggZGV2Zm4sIGludCBtYXApCiAKIHZvaWQgcGNpX3Z0ZF9x
dWlyayhjb25zdCBzdHJ1Y3QgcGNpX2RldiAqcGRldikKIHsKLSAgICBpbnQgc2VnID0gcGRldi0+
c2JkZi5zZWc7Ci0gICAgaW50IGJ1cyA9IHBkZXYtPnNiZGYuYnVzOwogICAgIGludCBwb3M7CiAg
ICAgYm9vbF90IGZmOwogICAgIHUzMiB2YWwsIHZhbDI7CkBAIC00NjQsMTIgKzQ2MiwxMCBAQCB2
b2lkIHBjaV92dGRfcXVpcmsoY29uc3Qgc3RydWN0IHBjaV9kZXYgKnBkZXYpCiAgICAgLyogU2Fu
ZHlicmlkZ2UtRVAgKFJvbWxleSkgKi8KICAgICBjYXNlIDB4M2MwMDogLyogaG9zdCBicmlkZ2Ug
Ki8KICAgICBjYXNlIDB4M2MwMSAuLi4gMHgzYzBiOiAvKiByb290IHBvcnRzICovCi0gICAgICAg
IHBvcyA9IHBjaV9maW5kX2V4dF9jYXBhYmlsaXR5KHNlZywgYnVzLCBwZGV2LT5zYmRmLmV4dGZ1
bmMsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9FWFRfQ0FQX0lE
X0VSUik7CisgICAgICAgIHBvcyA9IHBjaV9maW5kX2V4dF9jYXBhYmlsaXR5KHBkZXYtPnNiZGYs
IFBDSV9FWFRfQ0FQX0lEX0VSUik7CiAgICAgICAgIGlmICggIXBvcyApCiAgICAgICAgIHsKLSAg
ICAgICAgICAgIHBvcyA9IHBjaV9maW5kX2V4dF9jYXBhYmlsaXR5KHNlZywgYnVzLCBwZGV2LT5z
YmRmLmV4dGZ1bmMsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQ
Q0lfRVhUX0NBUF9JRF9WTkRSKTsKKyAgICAgICAgICAgIHBvcyA9IHBjaV9maW5kX2V4dF9jYXBh
YmlsaXR5KHBkZXYtPnNiZGYsIFBDSV9FWFRfQ0FQX0lEX1ZORFIpOwogICAgICAgICAgICAgd2hp
bGUgKCBwb3MgKQogICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIHZhbCA9IHBjaV9jb25m
X3JlYWQzMihwZGV2LT5zYmRmLCBwb3MgKyBQQ0lfVk5EUl9IRUFERVIpOwpAQCAtNDc4LDggKzQ3
NCw4IEBAIHZvaWQgcGNpX3Z0ZF9xdWlyayhjb25zdCBzdHJ1Y3QgcGNpX2RldiAqcGRldikKICAg
ICAgICAgICAgICAgICAgICAgcG9zICs9IFBDSV9WTkRSX0hFQURFUjsKICAgICAgICAgICAgICAg
ICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgfQotICAgICAgICAgICAgICAgIHBvcyA9IHBj
aV9maW5kX25leHRfZXh0X2NhcGFiaWxpdHkoc2VnLCBidXMsIHBkZXYtPnNiZGYuZXh0ZnVuYywK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvcywg
UENJX0VYVF9DQVBfSURfVk5EUik7CisgICAgICAgICAgICAgICAgcG9zID0gcGNpX2ZpbmRfbmV4
dF9leHRfY2FwYWJpbGl0eShwZGV2LT5zYmRmLCBwb3MsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lfRVhUX0NBUF9JRF9WTkRSKTsKICAgICAg
ICAgICAgIH0KICAgICAgICAgICAgIGZmID0gMDsKICAgICAgICAgfQpkaWZmIC0tZ2l0IGEveGVu
L2RyaXZlcnMvcGFzc3Rocm91Z2gvdnRkL3g4Ni9hdHMuYyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJv
dWdoL3Z0ZC94ODYvYXRzLmMKaW5kZXggZTA5MDRkZjViNi4uMjYwYjA2YTg1NiAxMDA2NDQKLS0t
IGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvdnRkL3g4Ni9hdHMuYworKysgYi94ZW4vZHJpdmVy
cy9wYXNzdGhyb3VnaC92dGQveDg2L2F0cy5jCkBAIC01Nyw4ICs1Nyw3IEBAIGludCBhdHNfZGV2
aWNlKGNvbnN0IHN0cnVjdCBwY2lfZGV2ICpwZGV2LCBjb25zdCBzdHJ1Y3QgYWNwaV9kcmhkX3Vu
aXQgKmRyaGQpCiAgICAgICAgIHJldHVybiAwOwogCiAgICAgYXRzX2RyaGQgPSBmaW5kX2F0c19k
ZXZfZHJoZChkcmhkLT5pb21tdSk7Ci0gICAgcG9zID0gcGNpX2ZpbmRfZXh0X2NhcGFiaWxpdHko
cGRldi0+c2JkZi5zZWcsIHBkZXYtPnNiZGYuYnVzLAotICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHBkZXYtPnNiZGYuZXh0ZnVuYywgUENJX0VYVF9DQVBfSURfQVRTKTsKKyAgICBw
b3MgPSBwY2lfZmluZF9leHRfY2FwYWJpbGl0eShwZGV2LT5zYmRmLCBQQ0lfRVhUX0NBUF9JRF9B
VFMpOwogCiAgICAgaWYgKCBwb3MgJiYgKGF0c19kcmhkID09IE5VTEwpICkKICAgICB7CmRpZmYg
LS1naXQgYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC94ODYvYXRzLmMgYi94ZW4vZHJpdmVycy9w
YXNzdGhyb3VnaC94ODYvYXRzLmMKaW5kZXggY2ZkNjEwMjI5ZC4uYmZiZDUwMTAwYSAxMDA2NDQK
LS0tIGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gveDg2L2F0cy5jCisrKyBiL3hlbi9kcml2ZXJz
L3Bhc3N0aHJvdWdoL3g4Ni9hdHMuYwpAQCAtMjMsMTEgKzIzLDkgQEAgYm9vbGVhbl9wYXJhbSgi
YXRzIiwgYXRzX2VuYWJsZWQpOwogaW50IGVuYWJsZV9hdHNfZGV2aWNlKHN0cnVjdCBwY2lfZGV2
ICpwZGV2LCBzdHJ1Y3QgbGlzdF9oZWFkICphdHNfbGlzdCkKIHsKICAgICB1MzIgdmFsdWU7Ci0g
ICAgdWludDE2X3Qgc2VnID0gcGRldi0+c2JkZi5zZWc7Ci0gICAgdWludDE2X3QgYnVzID0gcGRl
di0+c2JkZi5idXMsIGRldmZuID0gcGRldi0+c2JkZi5leHRmdW5jOwogICAgIGludCBwb3M7CiAK
LSAgICBwb3MgPSBwY2lfZmluZF9leHRfY2FwYWJpbGl0eShzZWcsIGJ1cywgZGV2Zm4sIFBDSV9F
WFRfQ0FQX0lEX0FUUyk7CisgICAgcG9zID0gcGNpX2ZpbmRfZXh0X2NhcGFiaWxpdHkocGRldi0+
c2JkZiwgUENJX0VYVF9DQVBfSURfQVRTKTsKICAgICBCVUdfT04oIXBvcyk7CiAKICAgICBpZiAo
IGlvbW11X3ZlcmJvc2UgKQpkaWZmIC0tZ2l0IGEveGVuL2RyaXZlcnMvcGNpL3BjaS5jIGIveGVu
L2RyaXZlcnMvcGNpL3BjaS5jCmluZGV4IDNkMmFjZjZmNzcuLmU5MDJhMGFhY2UgMTAwNjQ0Ci0t
LSBhL3hlbi9kcml2ZXJzL3BjaS9wY2kuYworKysgYi94ZW4vZHJpdmVycy9wY2kvcGNpLmMKQEAg
LTgsMTggKzgsMTIgQEAKICNpbmNsdWRlIDx4ZW4vcGNpLmg+CiAjaW5jbHVkZSA8eGVuL3BjaV9y
ZWdzLmg+CiAKLWludCBwY2lfZmluZF9jYXBfb2Zmc2V0KHUxNiBzZWcsIHU4IGJ1cywgdTggZGV2
LCB1OCBmdW5jLCB1OCBjYXApCitpbnQgcGNpX2ZpbmRfY2FwX29mZnNldChwY2lfc2JkZl90IHNi
ZGYsIHVuc2lnbmVkIGludCBjYXApCiB7CiAgICAgdTggaWQ7CiAgICAgaW50IG1heF9jYXAgPSA0
ODsKICAgICB1OCBwb3MgPSBQQ0lfQ0FQQUJJTElUWV9MSVNUOwogICAgIHUxNiBzdGF0dXM7Ci0g
ICAgY29uc3QgcGNpX3NiZGZfdCBzYmRmID0gewotICAgICAgICAuc2VnID0gc2VnLAotICAgICAg
ICAuYnVzID0gYnVzLAotICAgICAgICAuZGV2ID0gZGV2LAotICAgICAgICAuZnVuYyA9IGZ1bmMs
Ci0gICAgfTsKIAogICAgIHN0YXR1cyA9IHBjaV9jb25mX3JlYWQxNihzYmRmLCBQQ0lfU1RBVFVT
KTsKICAgICBpZiAoIChzdGF0dXMgJiBQQ0lfU1RBVFVTX0NBUF9MSVNUKSA9PSAwICkKQEAgLTQ1
LDE1ICszOSwxMCBAQCBpbnQgcGNpX2ZpbmRfY2FwX29mZnNldCh1MTYgc2VnLCB1OCBidXMsIHU4
IGRldiwgdTggZnVuYywgdTggY2FwKQogICAgIHJldHVybiAwOwogfQogCi1pbnQgcGNpX2ZpbmRf
bmV4dF9jYXAodTE2IHNlZywgdTggYnVzLCB1bnNpZ25lZCBpbnQgZGV2Zm4sIHU4IHBvcywgaW50
IGNhcCkKK2ludCBwY2lfZmluZF9uZXh0X2NhcChwY2lfc2JkZl90IHNiZGYsIHVuc2lnbmVkIGlu
dCBwb3MsIHVuc2lnbmVkIGludCBjYXApCiB7CiAgICAgdTggaWQ7CiAgICAgaW50IHR0bCA9IDQ4
OwotICAgIGNvbnN0IHBjaV9zYmRmX3Qgc2JkZiA9IHsKLSAgICAgICAgLnNlZyA9IHNlZywKLSAg
ICAgICAgLmJ1cyA9IGJ1cywKLSAgICAgICAgLmV4dGZ1bmMgPSBkZXZmbiwKLSAgICB9OwogCiAg
ICAgd2hpbGUgKCB0dGwtLSApCiAgICAgewpAQCAtODMsOSArNzIsOSBAQCBpbnQgcGNpX2ZpbmRf
bmV4dF9jYXAodTE2IHNlZywgdTggYnVzLCB1bnNpZ25lZCBpbnQgZGV2Zm4sIHU4IHBvcywgaW50
IGNhcCkKICAqIHdpdGhpbiB0aGUgZGV2aWNlJ3MgUENJIGNvbmZpZ3VyYXRpb24gc3BhY2Ugb3Ig
MCBpZiB0aGUgZGV2aWNlIGRvZXMKICAqIG5vdCBzdXBwb3J0IGl0LgogICovCi1pbnQgcGNpX2Zp
bmRfZXh0X2NhcGFiaWxpdHkoaW50IHNlZywgaW50IGJ1cywgaW50IGRldmZuLCBpbnQgY2FwKQor
aW50IHBjaV9maW5kX2V4dF9jYXBhYmlsaXR5KHBjaV9zYmRmX3Qgc2JkZiwgdW5zaWduZWQgaW50
IGNhcCkKIHsKLSAgICByZXR1cm4gcGNpX2ZpbmRfbmV4dF9leHRfY2FwYWJpbGl0eShzZWcsIGJ1
cywgZGV2Zm4sIDAsIGNhcCk7CisgICAgcmV0dXJuIHBjaV9maW5kX25leHRfZXh0X2NhcGFiaWxp
dHkoc2JkZiwgMCwgY2FwKTsKIH0KIAogLyoqCkBAIC05OCwxNSArODcsMTEgQEAgaW50IHBjaV9m
aW5kX2V4dF9jYXBhYmlsaXR5KGludCBzZWcsIGludCBidXMsIGludCBkZXZmbiwgaW50IGNhcCkK
ICAqIHdpdGhpbiB0aGUgZGV2aWNlJ3MgUENJIGNvbmZpZ3VyYXRpb24gc3BhY2Ugb3IgMCBpZiB0
aGUgZGV2aWNlIGRvZXMKICAqIG5vdCBzdXBwb3J0IGl0LgogICovCi1pbnQgcGNpX2ZpbmRfbmV4
dF9leHRfY2FwYWJpbGl0eShpbnQgc2VnLCBpbnQgYnVzLCBpbnQgZGV2Zm4sIGludCBzdGFydCwg
aW50IGNhcCkKK2ludCBwY2lfZmluZF9uZXh0X2V4dF9jYXBhYmlsaXR5KHBjaV9zYmRmX3Qgc2Jk
ZiwgdW5zaWduZWQgaW50IHN0YXJ0LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
dW5zaWduZWQgaW50IGNhcCkKIHsKLSAgICBpbnQgdHRsID0gNDgwOyAvKiAzODQwIGJ5dGVzLCBt
aW5pbXVtIDggYnl0ZXMgcGVyIGNhcGFiaWxpdHkgKi8KLSAgICBpbnQgcG9zID0gbWF4KHN0YXJ0
LCAweDEwMCk7Ci0gICAgY29uc3QgcGNpX3NiZGZfdCBzYmRmID0gewotICAgICAgICAuc2VnID0g
c2VnLAotICAgICAgICAuYnVzID0gYnVzLAotICAgICAgICAuZXh0ZnVuYyA9IGRldmZuLAotICAg
IH07CisgICAgdW5zaWduZWQgaW50IHR0bCA9IDQ4MDsgLyogMzg0MCBieXRlcywgbWluaW11bSA4
IGJ5dGVzIHBlciBjYXBhYmlsaXR5ICovCisgICAgdW5zaWduZWQgaW50IHBvcyA9IG1heChzdGFy
dCwgMHgxMDB1KTsKICAgICB1aW50MzJfdCBoZWFkZXIgPSBwY2lfY29uZl9yZWFkMzIoc2JkZiwg
cG9zKTsKIAogICAgIC8qCmRpZmYgLS1naXQgYS94ZW4vZHJpdmVycy92cGNpL21zaS5jIGIveGVu
L2RyaXZlcnMvdnBjaS9tc2kuYwppbmRleCAyYmRhZTQ4ZWRmLi4yYTM2NjgyOGExIDEwMDY0NAot
LS0gYS94ZW4vZHJpdmVycy92cGNpL21zaS5jCisrKyBiL3hlbi9kcml2ZXJzL3ZwY2kvbXNpLmMK
QEAgLTE4NSw5ICsxODUsNyBAQCBzdGF0aWMgdm9pZCBtYXNrX3dyaXRlKGNvbnN0IHN0cnVjdCBw
Y2lfZGV2ICpwZGV2LCB1bnNpZ25lZCBpbnQgcmVnLAogCiBzdGF0aWMgaW50IGluaXRfbXNpKHN0
cnVjdCBwY2lfZGV2ICpwZGV2KQogewotICAgIHVuc2lnbmVkIGludCBwb3MgPSBwY2lfZmluZF9j
YXBfb2Zmc2V0KHBkZXYtPnNiZGYuc2VnLCBwZGV2LT5zYmRmLmJ1cywKLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZGV2LT5zYmRmLmRldiwgcGRldi0+c2JkZi5m
dW5jLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9DQVBf
SURfTVNJKTsKKyAgICB1bnNpZ25lZCBpbnQgcG9zID0gcGNpX2ZpbmRfY2FwX29mZnNldChwZGV2
LT5zYmRmLCBQQ0lfQ0FQX0lEX01TSSk7CiAgICAgdWludDE2X3QgY29udHJvbDsKICAgICBpbnQg
cmV0OwogCmRpZmYgLS1naXQgYS94ZW4vZHJpdmVycy92cGNpL21zaXguYyBiL3hlbi9kcml2ZXJz
L3ZwY2kvbXNpeC5jCmluZGV4IDEwMDZiMDFmNGIuLjQ0ZGJiMDg2ZmQgMTAwNjQ0Ci0tLSBhL3hl
bi9kcml2ZXJzL3ZwY2kvbXNpeC5jCisrKyBiL3hlbi9kcml2ZXJzL3ZwY2kvbXNpeC5jCkBAIC00
NDUsOSArNDQ1LDcgQEAgc3RhdGljIGludCBpbml0X21zaXgoc3RydWN0IHBjaV9kZXYgKnBkZXYp
CiAgICAgdWludDE2X3QgY29udHJvbDsKICAgICBpbnQgcmM7CiAKLSAgICBtc2l4X29mZnNldCA9
IHBjaV9maW5kX2NhcF9vZmZzZXQocGRldi0+c2JkZi5zZWcsIHBkZXYtPnNiZGYuYnVzLAotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZGV2LT5zYmRmLmRldiwgcGRldi0+
c2JkZi5mdW5jLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQ0lfQ0FQ
X0lEX01TSVgpOworICAgIG1zaXhfb2Zmc2V0ID0gcGNpX2ZpbmRfY2FwX29mZnNldChwZGV2LT5z
YmRmLCBQQ0lfQ0FQX0lEX01TSVgpOwogICAgIGlmICggIW1zaXhfb2Zmc2V0ICkKICAgICAgICAg
cmV0dXJuIDA7CiAKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL3hlbi9wY2kuaCBiL3hlbi9pbmNs
dWRlL3hlbi9wY2kuaAppbmRleCA1ZTM0NWM0MTdmLi45Mzc0NjVmNWI1IDEwMDY0NAotLS0gYS94
ZW4vaW5jbHVkZS94ZW4vcGNpLmgKKysrIGIveGVuL2luY2x1ZGUveGVuL3BjaS5oCkBAIC0xNzgs
MTAgKzE3OCwxMSBAQCBpbnQgcGNpX21tY2ZnX3JlYWQodW5zaWduZWQgaW50IHNlZywgdW5zaWdu
ZWQgaW50IGJ1cywKICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgZGV2Zm4sIGludCBy
ZWcsIGludCBsZW4sIHUzMiAqdmFsdWUpOwogaW50IHBjaV9tbWNmZ193cml0ZSh1bnNpZ25lZCBp
bnQgc2VnLCB1bnNpZ25lZCBpbnQgYnVzLAogICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBp
bnQgZGV2Zm4sIGludCByZWcsIGludCBsZW4sIHUzMiB2YWx1ZSk7Ci1pbnQgcGNpX2ZpbmRfY2Fw
X29mZnNldCh1MTYgc2VnLCB1OCBidXMsIHU4IGRldiwgdTggZnVuYywgdTggY2FwKTsKLWludCBw
Y2lfZmluZF9uZXh0X2NhcCh1MTYgc2VnLCB1OCBidXMsIHVuc2lnbmVkIGludCBkZXZmbiwgdTgg
cG9zLCBpbnQgY2FwKTsKLWludCBwY2lfZmluZF9leHRfY2FwYWJpbGl0eShpbnQgc2VnLCBpbnQg
YnVzLCBpbnQgZGV2Zm4sIGludCBjYXApOwotaW50IHBjaV9maW5kX25leHRfZXh0X2NhcGFiaWxp
dHkoaW50IHNlZywgaW50IGJ1cywgaW50IGRldmZuLCBpbnQgcG9zLCBpbnQgY2FwKTsKK2ludCBw
Y2lfZmluZF9jYXBfb2Zmc2V0KHBjaV9zYmRmX3Qgc2JkZiwgdW5zaWduZWQgaW50IGNhcCk7Citp
bnQgcGNpX2ZpbmRfbmV4dF9jYXAocGNpX3NiZGZfdCBzYmRmLCB1bnNpZ25lZCBpbnQgcG9zLCB1
bnNpZ25lZCBpbnQgY2FwKTsKK2ludCBwY2lfZmluZF9leHRfY2FwYWJpbGl0eShwY2lfc2JkZl90
IHNiZGYsIHVuc2lnbmVkIGludCBjYXApOworaW50IHBjaV9maW5kX25leHRfZXh0X2NhcGFiaWxp
dHkocGNpX3NiZGZfdCBzYmRmLCB1bnNpZ25lZCBpbnQgcG9zLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IGNhcCk7CiBjb25zdCBjaGFyICpwYXJzZV9wY2ko
Y29uc3QgY2hhciAqLCB1bnNpZ25lZCBpbnQgKnNlZywgdW5zaWduZWQgaW50ICpidXMsCiAgICAg
ICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50ICpkZXYsIHVuc2lnbmVkIGludCAqZnVuYyk7
CiBjb25zdCBjaGFyICpwYXJzZV9wY2lfc2VnKGNvbnN0IGNoYXIgKiwgdW5zaWduZWQgaW50ICpz
ZWcsIHVuc2lnbmVkIGludCAqYnVzLAotLSAKMi4xNy4yIChBcHBsZSBHaXQtMTEzKQoKCl9fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWls
aW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVu
cHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 0DE9D2FD92
	for <lists+xen-devel@lfdr.de>; Thu, 30 May 2019 16:21:36 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hWLt2-00039H-Dd; Thu, 30 May 2019 14:18:32 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=Fq1a=T6=bitdefender.com=ppircalabu@srs-us1.protection.inumbo.net>)
 id 1hWLt0-000376-5K
 for xen-devel@lists.xenproject.org; Thu, 30 May 2019 14:18:30 +0000
X-Inumbo-ID: cb16482a-82e5-11e9-8980-bc764e045a96
Received: from mx01.bbu.dsd.mx.bitdefender.com (unknown [91.199.104.161])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id cb16482a-82e5-11e9-8980-bc764e045a96;
 Thu, 30 May 2019 14:18:28 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp02.buh.bitdefender.net [10.17.80.76])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 94AAB305FFA5; Thu, 30 May 2019 17:18:25 +0300 (EEST)
Received: from bitdefender.com (unknown [195.189.155.70])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 835D43086D00;
 Thu, 30 May 2019 17:18:25 +0300 (EEST)
From: Petre Pircalabu <ppircalabu@bitdefender.com>
To: xen-devel@lists.xenproject.org
Date: Thu, 30 May 2019 17:18:19 +0300
Message-Id: <922965b261f4ca23bcb276d6907f36c892c2478b.1559224640.git.ppircalabu@bitdefender.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <cover.1559224640.git.ppircalabu@bitdefender.com>
References: <cover.1559224640.git.ppircalabu@bitdefender.com>
In-Reply-To: <cover.1559224640.git.ppircalabu@bitdefender.com>
References: <cover.1559224640.git.ppircalabu@bitdefender.com>
Subject: [Xen-devel] [PATCH 5/9] vm_event: Simplify vm_event interface
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Petre Pircalabu <ppircalabu@bitdefender.com>,
 Tamas K Lengyel <tamas@tklengyel.com>,
 Razvan Cojocaru <rcojocaru@bitdefender.com>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Jan Beulich <jbeulich@suse.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhlIGRvbWFpbiByZWZlcmVuY2UgY2FuIGJlIHBhcnQgb2YgdGhlIHZtX2V2ZW50X2RvbWFpbiBz
dHJ1Y3R1cmUKYmVjYXVzZSBmb3IgZXZlcnkgY2FsbCB0byBhIHZtX2V2ZW50IGludGVyZmFjZSBm
dW5jdGlvbiBib3RoIHRoZSBsYXR0ZXIKYW5kIGl0J3MgY29ycmVzcG9uZGluZyBkb21haW4gYXJl
IHBhc3NlZCBhcyBwYXJhbWV0ZXJzLgoKQWZmZWN0ZWQgZnVuY3Rpb25zOgotIF9fdm1fZXZlbnRf
Y2xhaW1fc2xvdCAvIHZtX2V2ZW50X2NsYWltX3Nsb3QgLyB2bV9ldmVudF9jbGFpbV9zbG90X25v
c2xlZXAKLSB2bV9ldmVudF9jYW5jZWxfc2xvdAotIHZtX2V2ZW50X3B1dF9yZXF1ZXN0CgpTaWdu
ZWQtb2ZmLWJ5OiBQZXRyZSBQaXJjYWxhYnUgPHBwaXJjYWxhYnVAYml0ZGVmZW5kZXIuY29tPgot
LS0KIHhlbi9hcmNoL3g4Ni9tbS9tZW1fc2hhcmluZy5jIHwgIDUgKystLS0KIHhlbi9hcmNoL3g4
Ni9tbS9wMm0uYyAgICAgICAgIHwgMTEgKysrKystLS0tLS0KIHhlbi9jb21tb24vbW9uaXRvci5j
ICAgICAgICAgIHwgIDQgKystLQogeGVuL2NvbW1vbi92bV9ldmVudC5jICAgICAgICAgfCAzNyAr
KysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLS0tCiB4ZW4vaW5jbHVkZS94ZW4vc2No
ZWQuaCAgICAgICB8ICAyICsrCiB4ZW4vaW5jbHVkZS94ZW4vdm1fZXZlbnQuaCAgICB8IDE3ICsr
KysrKystLS0tLS0tLS0tCiA2IGZpbGVzIGNoYW5nZWQsIDM2IGluc2VydGlvbnMoKyksIDQwIGRl
bGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9tbS9tZW1fc2hhcmluZy5jIGIv
eGVuL2FyY2gveDg2L21tL21lbV9zaGFyaW5nLmMKaW5kZXggZjE2YTNmNS4uOWQ4MDM4OSAxMDA2
NDQKLS0tIGEveGVuL2FyY2gveDg2L21tL21lbV9zaGFyaW5nLmMKKysrIGIveGVuL2FyY2gveDg2
L21tL21lbV9zaGFyaW5nLmMKQEAgLTU1Nyw4ICs1NTcsNyBAQCBpbnQgbWVtX3NoYXJpbmdfbm90
aWZ5X2Vub21lbShzdHJ1Y3QgZG9tYWluICpkLCB1bnNpZ25lZCBsb25nIGdmbiwKICAgICAgICAg
LnUubWVtX3NoYXJpbmcucDJtdCA9IHAybV9yYW1fc2hhcmVkCiAgICAgfTsKIAotICAgIGlmICgg
KHJjID0gX192bV9ldmVudF9jbGFpbV9zbG90KGQsIAotICAgICAgICAgICAgICAgICAgICAgICAg
ZC0+dm1fZXZlbnRfc2hhcmUsIGFsbG93X3NsZWVwKSkgPCAwICkKKyAgICBpZiAoIChyYyA9IF9f
dm1fZXZlbnRfY2xhaW1fc2xvdChkLT52bV9ldmVudF9zaGFyZSwgYWxsb3dfc2xlZXApKSA8IDAg
KQogICAgICAgICByZXR1cm4gcmM7CiAKICAgICBpZiAoIHYtPmRvbWFpbiA9PSBkICkKQEAgLTU2
Nyw3ICs1NjYsNyBAQCBpbnQgbWVtX3NoYXJpbmdfbm90aWZ5X2Vub21lbShzdHJ1Y3QgZG9tYWlu
ICpkLCB1bnNpZ25lZCBsb25nIGdmbiwKICAgICAgICAgdm1fZXZlbnRfdmNwdV9wYXVzZSh2KTsK
ICAgICB9CiAKLSAgICB2bV9ldmVudF9wdXRfcmVxdWVzdChkLCBkLT52bV9ldmVudF9zaGFyZSwg
JnJlcSk7CisgICAgdm1fZXZlbnRfcHV0X3JlcXVlc3QoZC0+dm1fZXZlbnRfc2hhcmUsICZyZXEp
OwogCiAgICAgcmV0dXJuIDA7CiB9CmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvbW0vcDJtLmMg
Yi94ZW4vYXJjaC94ODYvbW0vcDJtLmMKaW5kZXggNGM5OTU0OC4uNjI1ZmM5YiAxMDA2NDQKLS0t
IGEveGVuL2FyY2gveDg2L21tL3AybS5jCisrKyBiL3hlbi9hcmNoL3g4Ni9tbS9wMm0uYwpAQCAt
MTY1Miw3ICsxNjUyLDcgQEAgdm9pZCBwMm1fbWVtX3BhZ2luZ19kcm9wX3BhZ2Uoc3RydWN0IGRv
bWFpbiAqZCwgdW5zaWduZWQgbG9uZyBnZm4sCiAgICAgICogY29ycmVjdG5lc3Mgb2YgdGhlIGd1
ZXN0IGV4ZWN1dGlvbiBhdCB0aGlzIHBvaW50LiAgSWYgdGhpcyBpcyB0aGUgb25seQogICAgICAq
IHBhZ2UgdGhhdCBoYXBwZW5zIHRvIGJlIHBhZ2VkLW91dCwgd2UnbGwgYmUgb2theS4uICBidXQg
aXQncyBsaWtlbHkgdGhlCiAgICAgICogZ3Vlc3Qgd2lsbCBjcmFzaCBzaG9ydGx5IGFueXdheXMu
ICovCi0gICAgaW50IHJjID0gdm1fZXZlbnRfY2xhaW1fc2xvdChkLCBkLT52bV9ldmVudF9wYWdp
bmcpOworICAgIGludCByYyA9IHZtX2V2ZW50X2NsYWltX3Nsb3QoZC0+dm1fZXZlbnRfcGFnaW5n
KTsKICAgICBpZiAoIHJjIDwgMCApCiAgICAgICAgIHJldHVybjsKIApAQCAtMTY2Niw3ICsxNjY2
LDcgQEAgdm9pZCBwMm1fbWVtX3BhZ2luZ19kcm9wX3BhZ2Uoc3RydWN0IGRvbWFpbiAqZCwgdW5z
aWduZWQgbG9uZyBnZm4sCiAgICAgICAgIC8qIEV2aWN0IHdpbGwgZmFpbCBub3csIHRhZyB0aGlz
IHJlcXVlc3QgZm9yIHBhZ2VyICovCiAgICAgICAgIHJlcS51Lm1lbV9wYWdpbmcuZmxhZ3MgfD0g
TUVNX1BBR0lOR19FVklDVF9GQUlMOwogCi0gICAgdm1fZXZlbnRfcHV0X3JlcXVlc3QoZCwgZC0+
dm1fZXZlbnRfcGFnaW5nLCAmcmVxKTsKKyAgICB2bV9ldmVudF9wdXRfcmVxdWVzdChkLT52bV9l
dmVudF9wYWdpbmcsICZyZXEpOwogfQogCiAvKioKQEAgLTE3MDQsOCArMTcwNCw3IEBAIHZvaWQg
cDJtX21lbV9wYWdpbmdfcG9wdWxhdGUoc3RydWN0IGRvbWFpbiAqZCwgdW5zaWduZWQgbG9uZyBn
Zm5fbCkKICAgICBzdHJ1Y3QgcDJtX2RvbWFpbiAqcDJtID0gcDJtX2dldF9ob3N0cDJtKGQpOwog
CiAgICAgLyogV2UncmUgcGFnaW5nLiBUaGVyZSBzaG91bGQgYmUgYSByaW5nICovCi0gICAgaW50
IHJjID0gdm1fZXZlbnRfY2xhaW1fc2xvdChkLCBkLT52bV9ldmVudF9wYWdpbmcpOwotCisgICAg
aW50IHJjID0gdm1fZXZlbnRfY2xhaW1fc2xvdChkLT52bV9ldmVudF9wYWdpbmcpOwogICAgIGlm
ICggcmMgPT0gLUVPUE5PVFNVUFAgKQogICAgIHsKICAgICAgICAgZ2RwcmludGsoWEVOTE9HX0VS
UiwgIkRvbWFpbiAlaHUgcGFnaW5nIGdmbiAlbHggeWV0IG5vIHJpbmcgIgpAQCAtMTc0Niw3ICsx
NzQ1LDcgQEAgdm9pZCBwMm1fbWVtX3BhZ2luZ19wb3B1bGF0ZShzdHJ1Y3QgZG9tYWluICpkLCB1
bnNpZ25lZCBsb25nIGdmbl9sKQogICAgIHsKICAgICAgICAgLyogZ2ZuIGlzIGFscmVhZHkgb24g
aXRzIHdheSBiYWNrIGFuZCB2Y3B1IGlzIG5vdCBwYXVzZWQgKi8KICAgICBvdXRfY2FuY2VsOgot
ICAgICAgICB2bV9ldmVudF9jYW5jZWxfc2xvdChkLCBkLT52bV9ldmVudF9wYWdpbmcpOworICAg
ICAgICB2bV9ldmVudF9jYW5jZWxfc2xvdChkLT52bV9ldmVudF9wYWdpbmcpOwogICAgICAgICBy
ZXR1cm47CiAgICAgfQogCkBAIC0xNzU0LDcgKzE3NTMsNyBAQCB2b2lkIHAybV9tZW1fcGFnaW5n
X3BvcHVsYXRlKHN0cnVjdCBkb21haW4gKmQsIHVuc2lnbmVkIGxvbmcgZ2ZuX2wpCiAgICAgcmVx
LnUubWVtX3BhZ2luZy5wMm10ID0gcDJtdDsKICAgICByZXEudmNwdV9pZCA9IHYtPnZjcHVfaWQ7
CiAKLSAgICB2bV9ldmVudF9wdXRfcmVxdWVzdChkLCBkLT52bV9ldmVudF9wYWdpbmcsICZyZXEp
OworICAgIHZtX2V2ZW50X3B1dF9yZXF1ZXN0KGQtPnZtX2V2ZW50X3BhZ2luZywgJnJlcSk7CiB9
CiAKIC8qKgpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9tb25pdG9yLmMgYi94ZW4vY29tbW9uL21v
bml0b3IuYwppbmRleCBkNWM5ZmYxLi5iOGQzM2M0IDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL21v
bml0b3IuYworKysgYi94ZW4vY29tbW9uL21vbml0b3IuYwpAQCAtOTMsNyArOTMsNyBAQCBpbnQg
bW9uaXRvcl90cmFwcyhzdHJ1Y3QgdmNwdSAqdiwgYm9vbCBzeW5jLCB2bV9ldmVudF9yZXF1ZXN0
X3QgKnJlcSkKICAgICBpbnQgcmM7CiAgICAgc3RydWN0IGRvbWFpbiAqZCA9IHYtPmRvbWFpbjsK
IAotICAgIHJjID0gdm1fZXZlbnRfY2xhaW1fc2xvdChkLCBkLT52bV9ldmVudF9tb25pdG9yKTsK
KyAgICByYyA9IHZtX2V2ZW50X2NsYWltX3Nsb3QoZC0+dm1fZXZlbnRfbW9uaXRvcik7CiAgICAg
c3dpdGNoICggcmMgKQogICAgIHsKICAgICBjYXNlIDA6CkBAIC0xMjUsNyArMTI1LDcgQEAgaW50
IG1vbml0b3JfdHJhcHMoc3RydWN0IHZjcHUgKnYsIGJvb2wgc3luYywgdm1fZXZlbnRfcmVxdWVz
dF90ICpyZXEpCiAgICAgfQogCiAgICAgdm1fZXZlbnRfZmlsbF9yZWdzKHJlcSk7Ci0gICAgdm1f
ZXZlbnRfcHV0X3JlcXVlc3QoZCwgZC0+dm1fZXZlbnRfbW9uaXRvciwgcmVxKTsKKyAgICB2bV9l
dmVudF9wdXRfcmVxdWVzdChkLT52bV9ldmVudF9tb25pdG9yLCByZXEpOwogCiAgICAgcmV0dXJu
IHJjOwogfQpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi92bV9ldmVudC5jIGIveGVuL2NvbW1vbi92
bV9ldmVudC5jCmluZGV4IDFkZDNlNDguLjNlODdiYmMgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24v
dm1fZXZlbnQuYworKysgYi94ZW4vY29tbW9uL3ZtX2V2ZW50LmMKQEAgLTEzMSwxMCArMTMxLDEx
IEBAIHN0YXRpYyB1bnNpZ25lZCBpbnQgdm1fZXZlbnRfcmluZ19hdmFpbGFibGUoc3RydWN0IHZt
X2V2ZW50X2RvbWFpbiAqdmVkKQogICogYnV0IG5lZWQgdG8gYmUgcmVzdW1lZCB3aGVyZSB0aGUg
cmluZyBpcyBjYXBhYmxlIG9mIHByb2Nlc3NpbmcgYXQgbGVhc3QKICAqIG9uZSBldmVudCBmcm9t
IHRoZW0uCiAgKi8KLXN0YXRpYyB2b2lkIHZtX2V2ZW50X3dha2VfYmxvY2tlZChzdHJ1Y3QgZG9t
YWluICpkLCBzdHJ1Y3Qgdm1fZXZlbnRfZG9tYWluICp2ZWQpCitzdGF0aWMgdm9pZCB2bV9ldmVu
dF93YWtlX2Jsb2NrZWQoc3RydWN0IHZtX2V2ZW50X2RvbWFpbiAqdmVkKQogewogICAgIHN0cnVj
dCB2Y3B1ICp2OwogICAgIHVuc2lnbmVkIGludCBhdmFpbF9yZXEgPSB2bV9ldmVudF9yaW5nX2F2
YWlsYWJsZSh2ZWQpOworICAgIHN0cnVjdCBkb21haW4gKmQgPSB2ZWQtPmQ7CiAKICAgICBpZiAo
IGF2YWlsX3JlcSA9PSAwIHx8IHZlZC0+YmxvY2tlZCA9PSAwICkKICAgICAgICAgcmV0dXJuOwpA
QCAtMTcxLDcgKzE3Miw3IEBAIHN0YXRpYyB2b2lkIHZtX2V2ZW50X3dha2VfYmxvY2tlZChzdHJ1
Y3QgZG9tYWluICpkLCBzdHJ1Y3Qgdm1fZXZlbnRfZG9tYWluICp2ZWQpCiAgKiB3YXMgdW5hYmxl
IHRvIGRvIHNvLCBpdCBpcyBxdWV1ZWQgb24gYSB3YWl0IHF1ZXVlLiAgVGhlc2UgYXJlIHdva2Vu
IGFzCiAgKiBuZWVkZWQsIGFuZCB0YWtlIHByZWNlZGVuY2Ugb3ZlciB0aGUgYmxvY2tlZCB2Q1BV
cy4KICAqLwotc3RhdGljIHZvaWQgdm1fZXZlbnRfd2FrZV9xdWV1ZWQoc3RydWN0IGRvbWFpbiAq
ZCwgc3RydWN0IHZtX2V2ZW50X2RvbWFpbiAqdmVkKQorc3RhdGljIHZvaWQgdm1fZXZlbnRfd2Fr
ZV9xdWV1ZWQoc3RydWN0IHZtX2V2ZW50X2RvbWFpbiAqdmVkKQogewogICAgIHVuc2lnbmVkIGlu
dCBhdmFpbF9yZXEgPSB2bV9ldmVudF9yaW5nX2F2YWlsYWJsZSh2ZWQpOwogCkBAIC0xODYsMTIg
KzE4NywxMiBAQCBzdGF0aWMgdm9pZCB2bV9ldmVudF93YWtlX3F1ZXVlZChzdHJ1Y3QgZG9tYWlu
ICpkLCBzdHJ1Y3Qgdm1fZXZlbnRfZG9tYWluICp2ZWQpCiAgKiBjYWxsIHZtX2V2ZW50X3dha2Uo
KSBhZ2FpbiwgZW5zdXJpbmcgdGhhdCBhbnkgYmxvY2tlZCB2Q1BVcyB3aWxsIGdldAogICogdW5w
YXVzZWQgb25jZSBhbGwgdGhlIHF1ZXVlZCB2Q1BVcyBoYXZlIG1hZGUgaXQgdGhyb3VnaC4KICAq
Lwotdm9pZCB2bV9ldmVudF93YWtlKHN0cnVjdCBkb21haW4gKmQsIHN0cnVjdCB2bV9ldmVudF9k
b21haW4gKnZlZCkKK3ZvaWQgdm1fZXZlbnRfd2FrZShzdHJ1Y3Qgdm1fZXZlbnRfZG9tYWluICp2
ZWQpCiB7CiAgICAgaWYgKCFsaXN0X2VtcHR5KCZ2ZWQtPndxLmxpc3QpKQotICAgICAgICB2bV9l
dmVudF93YWtlX3F1ZXVlZChkLCB2ZWQpOworICAgICAgICB2bV9ldmVudF93YWtlX3F1ZXVlZCh2
ZWQpOwogICAgIGVsc2UKLSAgICAgICAgdm1fZXZlbnRfd2FrZV9ibG9ja2VkKGQsIHZlZCk7Cisg
ICAgICAgIHZtX2V2ZW50X3dha2VfYmxvY2tlZCh2ZWQpOwogfQogCiBzdGF0aWMgaW50IHZtX2V2
ZW50X2Rpc2FibGUoc3RydWN0IGRvbWFpbiAqZCwgc3RydWN0IHZtX2V2ZW50X2RvbWFpbiAqKnZl
ZCkKQEAgLTIzNSwxNyArMjM2LDE2IEBAIHN0YXRpYyBpbnQgdm1fZXZlbnRfZGlzYWJsZShzdHJ1
Y3QgZG9tYWluICpkLCBzdHJ1Y3Qgdm1fZXZlbnRfZG9tYWluICoqdmVkKQogICAgIHJldHVybiAw
OwogfQogCi1zdGF0aWMgaW5saW5lIHZvaWQgdm1fZXZlbnRfcmVsZWFzZV9zbG90KHN0cnVjdCBk
b21haW4gKmQsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVj
dCB2bV9ldmVudF9kb21haW4gKnZlZCkKK3N0YXRpYyBpbmxpbmUgdm9pZCB2bV9ldmVudF9yZWxl
YXNlX3Nsb3Qoc3RydWN0IHZtX2V2ZW50X2RvbWFpbiAqdmVkKQogewogICAgIC8qIFVwZGF0ZSB0
aGUgYWNjb3VudGluZyAqLwotICAgIGlmICggY3VycmVudC0+ZG9tYWluID09IGQgKQorICAgIGlm
ICggY3VycmVudC0+ZG9tYWluID09IHZlZC0+ZCApCiAgICAgICAgIHZlZC0+dGFyZ2V0X3Byb2R1
Y2Vycy0tOwogICAgIGVsc2UKICAgICAgICAgdmVkLT5mb3JlaWduX3Byb2R1Y2Vycy0tOwogCiAg
ICAgLyogS2ljayBhbnkgd2FpdGVycyAqLwotICAgIHZtX2V2ZW50X3dha2UoZCwgdmVkKTsKKyAg
ICB2bV9ldmVudF93YWtlKHZlZCk7CiB9CiAKIC8qCkBAIC0yNjcsOCArMjY3LDcgQEAgc3RhdGlj
IHZvaWQgdm1fZXZlbnRfbWFya19hbmRfcGF1c2Uoc3RydWN0IHZjcHUgKnYsIHN0cnVjdCB2bV9l
dmVudF9kb21haW4gKnZlZCkKICAqIG92ZXJseSBmdWxsIGFuZCBpdHMgY29udGludWVkIGV4ZWN1
dGlvbiB3b3VsZCBjYXVzZSBzdGFsbGluZyBhbmQgZXhjZXNzaXZlCiAgKiB3YWl0aW5nLiAgVGhl
IHZDUFUgd2lsbCBiZSBhdXRvbWF0aWNhbGx5IHVucGF1c2VkIHdoZW4gdGhlIHJpbmcgY2xlYXJz
LgogICovCi12b2lkIHZtX2V2ZW50X3B1dF9yZXF1ZXN0KHN0cnVjdCBkb21haW4gKmQsCi0gICAg
ICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCB2bV9ldmVudF9kb21haW4gKnZlZCwKK3ZvaWQg
dm1fZXZlbnRfcHV0X3JlcXVlc3Qoc3RydWN0IHZtX2V2ZW50X2RvbWFpbiAqdmVkLAogICAgICAg
ICAgICAgICAgICAgICAgICAgICB2bV9ldmVudF9yZXF1ZXN0X3QgKnJlcSkKIHsKICAgICB2bV9l
dmVudF9mcm9udF9yaW5nX3QgKmZyb250X3Jpbmc7CkBAIC0yNzYsNiArMjc1LDcgQEAgdm9pZCB2
bV9ldmVudF9wdXRfcmVxdWVzdChzdHJ1Y3QgZG9tYWluICpkLAogICAgIHVuc2lnbmVkIGludCBh
dmFpbF9yZXE7CiAgICAgUklOR19JRFggcmVxX3Byb2Q7CiAgICAgc3RydWN0IHZjcHUgKmN1cnIg
PSBjdXJyZW50OworICAgIHN0cnVjdCBkb21haW4gKmQgPSB2ZWQtPmQ7CiAKICAgICBpZiggIXZt
X2V2ZW50X2NoZWNrKHZlZCkpCiAgICAgICAgIHJldHVybjsKQEAgLTMwOSw3ICszMDksNyBAQCB2
b2lkIHZtX2V2ZW50X3B1dF9yZXF1ZXN0KHN0cnVjdCBkb21haW4gKmQsCiAgICAgUklOR19QVVNI
X1JFUVVFU1RTKGZyb250X3JpbmcpOwogCiAgICAgLyogV2UndmUgYWN0dWFsbHkgKnVzZWQqIG91
ciByZXNlcnZhdGlvbiwgc28gcmVsZWFzZSB0aGUgc2xvdC4gKi8KLSAgICB2bV9ldmVudF9yZWxl
YXNlX3Nsb3QoZCwgdmVkKTsKKyAgICB2bV9ldmVudF9yZWxlYXNlX3Nsb3QodmVkKTsKIAogICAg
IC8qIEdpdmUgdGhpcyB2Q1BVIGEgYmxhY2sgZXllIGlmIG5lY2Vzc2FyeSwgb24gdGhlIHdheSBv
dXQuCiAgICAgICogU2VlIHRoZSBjb21tZW50cyBhYm92ZSB3YWtlX2Jsb2NrZWQoKSBmb3IgbW9y
ZSBpbmZvcm1hdGlvbgpAQCAtMzUxLDcgKzM1MSw3IEBAIHN0YXRpYyBpbnQgdm1fZXZlbnRfZ2V0
X3Jlc3BvbnNlKHN0cnVjdCBkb21haW4gKmQsIHN0cnVjdCB2bV9ldmVudF9kb21haW4gKnZlZCwK
IAogICAgIC8qIEtpY2sgYW55IHdhaXRlcnMgLS0gc2luY2Ugd2UndmUganVzdCBjb25zdW1lZCBh
biBldmVudCwKICAgICAgKiB0aGVyZSBtYXkgYmUgYWRkaXRpb25hbCBzcGFjZSBhdmFpbGFibGUg
aW4gdGhlIHJpbmcuICovCi0gICAgdm1fZXZlbnRfd2FrZShkLCB2ZWQpOworICAgIHZtX2V2ZW50
X3dha2UodmVkKTsKIAogICAgIHZtX2V2ZW50X3JpbmdfdW5sb2NrKHZlZCk7CiAKQEAgLTQ1MCwx
MyArNDUwLDEzIEBAIHN0YXRpYyBpbnQgdm1fZXZlbnRfcmVzdW1lKHN0cnVjdCBkb21haW4gKmQs
IHN0cnVjdCB2bV9ldmVudF9kb21haW4gKnZlZCkKICAgICByZXR1cm4gMDsKIH0KIAotdm9pZCB2
bV9ldmVudF9jYW5jZWxfc2xvdChzdHJ1Y3QgZG9tYWluICpkLCBzdHJ1Y3Qgdm1fZXZlbnRfZG9t
YWluICp2ZWQpCit2b2lkIHZtX2V2ZW50X2NhbmNlbF9zbG90KHN0cnVjdCB2bV9ldmVudF9kb21h
aW4gKnZlZCkKIHsKICAgICBpZiggIXZtX2V2ZW50X2NoZWNrKHZlZCkgKQogICAgICAgICByZXR1
cm47CiAKICAgICB2bV9ldmVudF9yaW5nX2xvY2sodmVkKTsKLSAgICB2bV9ldmVudF9yZWxlYXNl
X3Nsb3QoZCwgdmVkKTsKKyAgICB2bV9ldmVudF9yZWxlYXNlX3Nsb3QodmVkKTsKICAgICB2bV9l
dmVudF9yaW5nX3VubG9jayh2ZWQpOwogfQogCkBAIC01MTgsMTYgKzUxOCwxNSBAQCBib29sIHZt
X2V2ZW50X2NoZWNrKHN0cnVjdCB2bV9ldmVudF9kb21haW4gKnZlZCkKICAqICAgICAgICAgICAg
ICAgMDogYSBzcG90IGhhcyBiZWVuIHJlc2VydmVkCiAgKgogICovCi1pbnQgX192bV9ldmVudF9j
bGFpbV9zbG90KHN0cnVjdCBkb21haW4gKmQsIHN0cnVjdCB2bV9ldmVudF9kb21haW4gKnZlZCwK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgYm9vbCBhbGxvd19zbGVlcCkKK2ludCBfX3ZtX2V2
ZW50X2NsYWltX3Nsb3Qoc3RydWN0IHZtX2V2ZW50X2RvbWFpbiAqdmVkLCBib29sIGFsbG93X3Ns
ZWVwKQogewogICAgIGlmICggIXZtX2V2ZW50X2NoZWNrKHZlZCkgKQogICAgICAgICByZXR1cm4g
LUVPUE5PVFNVUFA7CiAKLSAgICBpZiAoIChjdXJyZW50LT5kb21haW4gPT0gZCkgJiYgYWxsb3df
c2xlZXAgKQorICAgIGlmICggKGN1cnJlbnQtPmRvbWFpbiA9PSB2ZWQtPmQpICYmIGFsbG93X3Ns
ZWVwICkKICAgICAgICAgcmV0dXJuIHZtX2V2ZW50X3dhaXRfc2xvdCh2ZWQpOwogICAgIGVsc2UK
LSAgICAgICAgcmV0dXJuIHZtX2V2ZW50X2dyYWJfc2xvdCh2ZWQsIChjdXJyZW50LT5kb21haW4g
IT0gZCkpOworICAgICAgICByZXR1cm4gdm1fZXZlbnRfZ3JhYl9zbG90KHZlZCwgKGN1cnJlbnQt
PmRvbWFpbiAhPSB2ZWQtPmQpKTsKIH0KIAogI2lmZGVmIENPTkZJR19IQVNfTUVNX1BBR0lORwpk
aWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUveGVuL3NjaGVkLmggYi94ZW4vaW5jbHVkZS94ZW4vc2No
ZWQuaAppbmRleCAyMjAxZmFjLi43ZGVlMDIyIDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS94ZW4v
c2NoZWQuaAorKysgYi94ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaApAQCAtMjgyLDYgKzI4Miw4IEBA
IHN0cnVjdCB2Y3B1CiAvKiBWTSBldmVudCAqLwogc3RydWN0IHZtX2V2ZW50X2RvbWFpbgogewor
ICAgIC8qIERvbWFpbiByZWZlcmVuY2UgKi8KKyAgICBzdHJ1Y3QgZG9tYWluICpkOwogICAgIC8q
IHJpbmcgbG9jayAqLwogICAgIHNwaW5sb2NrX3QgcmluZ19sb2NrOwogICAgIC8qIFRoZSByaW5n
IGhhcyA2NCBlbnRyaWVzICovCmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS94ZW4vdm1fZXZlbnQu
aCBiL3hlbi9pbmNsdWRlL3hlbi92bV9ldmVudC5oCmluZGV4IDBhMDVlNWIuLmE1YzgyZDYgMTAw
NjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL3hlbi92bV9ldmVudC5oCisrKyBiL3hlbi9pbmNsdWRlL3hl
bi92bV9ldmVudC5oCkBAIC00NSwyMyArNDUsMjAgQEAgYm9vbCB2bV9ldmVudF9jaGVjayhzdHJ1
Y3Qgdm1fZXZlbnRfZG9tYWluICp2ZWQpOwogICogY2FuY2VsX3Nsb3QoKSwgYm90aCBvZiB3aGlj
aCBhcmUgZ3VhcmFudGVlZCB0bwogICogc3VjY2VlZC4KICAqLwotaW50IF9fdm1fZXZlbnRfY2xh
aW1fc2xvdChzdHJ1Y3QgZG9tYWluICpkLCBzdHJ1Y3Qgdm1fZXZlbnRfZG9tYWluICp2ZWQsCi0g
ICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2wgYWxsb3dfc2xlZXApOwotc3RhdGljIGlubGlu
ZSBpbnQgdm1fZXZlbnRfY2xhaW1fc2xvdChzdHJ1Y3QgZG9tYWluICpkLAotICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3Qgdm1fZXZlbnRfZG9tYWluICp2ZWQpCitp
bnQgX192bV9ldmVudF9jbGFpbV9zbG90KHN0cnVjdCB2bV9ldmVudF9kb21haW4gKnZlZCwgYm9v
bCBhbGxvd19zbGVlcCk7CitzdGF0aWMgaW5saW5lIGludCB2bV9ldmVudF9jbGFpbV9zbG90KHN0
cnVjdCB2bV9ldmVudF9kb21haW4gKnZlZCkKIHsKLSAgICByZXR1cm4gX192bV9ldmVudF9jbGFp
bV9zbG90KGQsIHZlZCwgdHJ1ZSk7CisgICAgcmV0dXJuIF9fdm1fZXZlbnRfY2xhaW1fc2xvdCh2
ZWQsIHRydWUpOwogfQogCi1zdGF0aWMgaW5saW5lIGludCB2bV9ldmVudF9jbGFpbV9zbG90X25v
c2xlZXAoc3RydWN0IGRvbWFpbiAqZCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBzdHJ1Y3Qgdm1fZXZlbnRfZG9tYWluICp2ZWQpCitzdGF0aWMgaW5saW5l
IGludCB2bV9ldmVudF9jbGFpbV9zbG90X25vc2xlZXAoc3RydWN0IHZtX2V2ZW50X2RvbWFpbiAq
dmVkKQogewotICAgIHJldHVybiBfX3ZtX2V2ZW50X2NsYWltX3Nsb3QoZCwgdmVkLCBmYWxzZSk7
CisgICAgcmV0dXJuIF9fdm1fZXZlbnRfY2xhaW1fc2xvdCh2ZWQsIGZhbHNlKTsKIH0KIAotdm9p
ZCB2bV9ldmVudF9jYW5jZWxfc2xvdChzdHJ1Y3QgZG9tYWluICpkLCBzdHJ1Y3Qgdm1fZXZlbnRf
ZG9tYWluICp2ZWQpOwordm9pZCB2bV9ldmVudF9jYW5jZWxfc2xvdChzdHJ1Y3Qgdm1fZXZlbnRf
ZG9tYWluICp2ZWQpOwogCi12b2lkIHZtX2V2ZW50X3B1dF9yZXF1ZXN0KHN0cnVjdCBkb21haW4g
KmQsIHN0cnVjdCB2bV9ldmVudF9kb21haW4gKnZlZCwKK3ZvaWQgdm1fZXZlbnRfcHV0X3JlcXVl
c3Qoc3RydWN0IHZtX2V2ZW50X2RvbWFpbiAqdmVkLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICB2bV9ldmVudF9yZXF1ZXN0X3QgKnJlcSk7CiAKIGludCB2bV9ldmVudF9kb21jdGwoc3RydWN0
IGRvbWFpbiAqZCwgc3RydWN0IHhlbl9kb21jdGxfdm1fZXZlbnRfb3AgKnZlYywKLS0gCjIuNy40
CgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRl
dmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9s
aXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

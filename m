Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id CD69714B1D0
	for <lists+xen-devel@lfdr.de>; Tue, 28 Jan 2020 10:36:29 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iwNEQ-0000ao-AK; Tue, 28 Jan 2020 09:32:26 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=17MD=3R=gmail.com=julien.grall.oss@srs-us1.protection.inumbo.net>)
 id 1iwNEO-0000aj-DL
 for xen-devel@lists.xenproject.org; Tue, 28 Jan 2020 09:32:24 +0000
X-Inumbo-ID: 1615178e-41b1-11ea-b211-bc764e2007e4
Received: from mail-wr1-f67.google.com (unknown [209.85.221.67])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 1615178e-41b1-11ea-b211-bc764e2007e4;
 Tue, 28 Jan 2020 09:32:22 +0000 (UTC)
Received: by mail-wr1-f67.google.com with SMTP id q10so15148471wrm.11
 for <xen-devel@lists.xenproject.org>; Tue, 28 Jan 2020 01:32:22 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:subject:to:cc:references:from:message-id:date
 :user-agent:mime-version:in-reply-to:content-language
 :content-transfer-encoding;
 bh=rieSGxA6OIn9UHmnWZLrTVbCRCvcflUSoNTzf40y81c=;
 b=bfQcpHXrirD7RFgPwlOM4qCdZT2Nul85RMwYsDf6j9tQm2sPlsnY1let1AcPePQpm9
 dnqEBbP1eLGNBRxU9l+R1a8k8/xZHfxy9B0CAn+UHNy66TQzXRcFigt5UjmMGhnWa5P4
 Y/GKhUl0iByGmx4EtJ5S2rsdIJsx7EhV15efuOkPba7jmWTUXD16C7rQ/J58h9r+fe+d
 KgVjmKGpBGzEVCXHNgVKyElLnmp/k+VUkiwzVhRAmlMPuFdI4dhYUMllrKyRDoX3PQ1f
 cs1ibybCdJ+VUZIZ68IEaG22zQXTHwk1ZORcCGwZfM9Xmb55liRVtBI2fddCvWK4X9k3
 FN4A==
X-Gm-Message-State: APjAAAUJrQEeuH5Dmm+8JeEypAeu/kNgWFfit6cAEZZNzgPO9zRZ95wp
 XyunvNnr71jSGKehfZ4DOGI=
X-Google-Smtp-Source: APXvYqzkpmm8T0cuBmHFT761bpLdoqzAPg4o5c4IzgsY3xqhSkXC/hAL9R0DwHSNQASMnAKcFZ+Jxw==
X-Received: by 2002:adf:e3cd:: with SMTP id k13mr28041920wrm.338.1580203941956; 
 Tue, 28 Jan 2020 01:32:21 -0800 (PST)
Received: from a483e7b01a66.ant.amazon.com (54-240-197-236.amazon.com.
 [54.240.197.236])
 by smtp.gmail.com with ESMTPSA id a9sm2161223wmm.15.2020.01.28.01.32.20
 (version=TLS1_3 cipher=TLS_AES_128_GCM_SHA256 bits=128/128);
 Tue, 28 Jan 2020 01:32:21 -0800 (PST)
To: Igor Druzhinin <igor.druzhinin@citrix.com>, xen-devel@lists.xenproject.org
References: <1580151370-6409-1-git-send-email-igor.druzhinin@citrix.com>
From: Julien Grall <julien@xen.org>
Message-ID: <1c217bdf-b94d-d320-4254-85e786d38e0c@xen.org>
Date: Tue, 28 Jan 2020 09:32:19 +0000
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:68.0)
 Gecko/20100101 Thunderbird/68.4.1
MIME-Version: 1.0
In-Reply-To: <1580151370-6409-1-git-send-email-igor.druzhinin@citrix.com>
Content-Language: en-GB
Subject: Re: [Xen-devel] [PATCH] RCU: reimplement RCU barrier to avoid
 deadlock
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: sstabellini@kernel.org, wl@xen.org, konrad.wilk@oracle.com,
 George.Dunlap@eu.citrix.com, andrew.cooper3@citrix.com,
 ian.jackson@eu.citrix.com
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

CgpPbiAyNy8wMS8yMDIwIDE4OjU2LCBJZ29yIERydXpoaW5pbiB3cm90ZToKPiBUaGUgZXhpc3Rp
bmcgUkNVIGJhcnJpZXIgaW1wbGVtZW50YXRpb24gaXMgcHJvbmUgdG8gYSBkZWFkbG9jayBzY2Vu
YXJpbwo+IGR1ZSB0byBJUlFzIGJlaW5nIHJlLWVuYWJsZWQgaW5zaWRlIHN0b3BtYWNoaW5lIGNv
bnRleHQuIElmIGR1ZSB0byBhIHJhY2UKPiBJUlFzIGFyZSByZS1lbmFibGVkIG9uIHNvbWUgb2Yg
Q1BVcyBhbmQgc29mdGlycXMgYXJlIGFsbG93ZWQgdG8gYmUKPiBwcm9jZXNzZWQgaW4gc3RvcG1h
Y2hpbmUsIGkuZS4gd2hhdCBjdXJyZW50bHkgaGFwcGVucyBpbiByY3VfYmFycmllcigpLAo+IHRp
bWVyIGludGVycnVwdCBpcyBhYmxlIHRvIGludm9rZSBUU0Mgc3luY2hyb25pemF0aW9uIHJlbmRl
enZvdXMuCj4gQXQgdGhpcyBtb21lbnQgc2VuZGluZyBUU0Mgc3luY2hyb25pemF0aW9uIElQSSB3
aWxsIHN0YWxsIHdhaXRpbmcgZm9yCj4gb3RoZXIgQ1BVcyB0byBzeW5jaHJvbml6ZSB3aGlsZSB0
aGV5IGluIHR1cm4gYXJlIHdhaXRpbmcgaW4gc3RvcG1hY2hpbmUKPiBidXN5IGxvb3Agd2l0aCBJ
UlFzIGRpc2FibGVkLgo+IAo+IFRvIGF2b2lkIHRoZSBzY2VuYXJpbyBhYm92ZSAtIHJlaW1wbGVt
ZW50IHJjdV9iYXJyaWVyKCkgaW4gYSB3YXkgd2hlcmUKPiBJUlFzIGFyZSBub3QgYmVpbmcgZGlz
YWJsZWQgYXQgYW55IG1vbWVudC4gVGhlIHByb3Bvc2VkIGltcGxlbWVudGF0aW9uCj4gaXMganVz
dCBhIHNpbXBsaWZpZWQgYW5kIHNwZWNpYWxpemVkIHZlcnNpb24gb2Ygc3RvcG1hY2hpbmUuIFRo
ZSBzZW1hbnRpYwo+IG9mIHRoZSBjYWxsIGlzIHByZXNlcnZlZC4Kc3RvcF9tYWNoaW5lX3J1bigp
IGlzIHVzZWQgaW4gYSBmZXcgcGxhY2VzIHdpdGhpbiBYZW4uIFdoeSBpcyB0aGlzIGEgCnByb2Js
ZW0gZm9yIHJjdV9iYXJyaWVyKCkgYW5kIG5vdCBmb3IgdGhlIG90aGVyIGNhbGxlcnM/Cgo+Cj4g
U2lnbmVkLW9mZi1ieTogSWdvciBEcnV6aGluaW4gPGlnb3IuZHJ1emhpbmluQGNpdHJpeC5jb20+
Cj4gLS0tCj4gVGhpcyBjaGFuZ2UgaGFzIGJlZW4gc3RyZXNzIHRlc3RlZCBieSBkb2luZyBhY3Rp
b25zIGludm9raW5nIHJjdV9iYXJyaWVyKCkKPiBmdW5jdGlvbmFsaXR5IGFuZCBkaWRuJ3Qgc2hv
dyBhbnkgaXNzdWVzLgo+IC0tLQo+ICAgeGVuL2NvbW1vbi9yY3VwZGF0ZS5jIHwgMzYgKysrKysr
KysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tCj4gICAxIGZpbGUgY2hhbmdlZCwgMjYgaW5z
ZXJ0aW9ucygrKSwgMTAgZGVsZXRpb25zKC0pCj4gCj4gZGlmZiAtLWdpdCBhL3hlbi9jb21tb24v
cmN1cGRhdGUuYyBiL3hlbi9jb21tb24vcmN1cGRhdGUuYwo+IGluZGV4IGNiNzEyYzguLjk1YTFm
ODUgMTAwNjQ0Cj4gLS0tIGEveGVuL2NvbW1vbi9yY3VwZGF0ZS5jCj4gKysrIGIveGVuL2NvbW1v
bi9yY3VwZGF0ZS5jCj4gQEAgLTE0NSw2ICsxNDUsOSBAQCBzdHJ1Y3QgcmN1X2JhcnJpZXJfZGF0
YSB7Cj4gICAgICAgYXRvbWljX3QgKmNwdV9jb3VudDsKPiAgIH07Cj4gICAKPiArc3RhdGljIERF
RklORV9QRVJfQ1BVKHN0cnVjdCB0YXNrbGV0LCByY3VfYmFycmllcl90YXNrbGV0KTsKPiArc3Rh
dGljIGF0b21pY190IHJjdV9iYXJyaWVyX2NwdV9jb3VudCwgcmN1X2JhcnJpZXJfY3B1X2RvbmU7
Cj4gKwo+ICAgc3RhdGljIHZvaWQgcmN1X2JhcnJpZXJfY2FsbGJhY2soc3RydWN0IHJjdV9oZWFk
ICpoZWFkKQo+ICAgewo+ICAgICAgIHN0cnVjdCByY3VfYmFycmllcl9kYXRhICpkYXRhID0gY29u
dGFpbmVyX29mKAo+IEBAIC0xNTIsMTIgKzE1NSw5IEBAIHN0YXRpYyB2b2lkIHJjdV9iYXJyaWVy
X2NhbGxiYWNrKHN0cnVjdCByY3VfaGVhZCAqaGVhZCkKPiAgICAgICBhdG9taWNfaW5jKGRhdGEt
PmNwdV9jb3VudCk7Cj4gICB9Cj4gICAKPiAtc3RhdGljIGludCByY3VfYmFycmllcl9hY3Rpb24o
dm9pZCAqX2NwdV9jb3VudCkKPiArc3RhdGljIHZvaWQgcmN1X2JhcnJpZXJfYWN0aW9uKHZvaWQg
KnVudXNlZCkKPiAgIHsKPiAtICAgIHN0cnVjdCByY3VfYmFycmllcl9kYXRhIGRhdGEgPSB7IC5j
cHVfY291bnQgPSBfY3B1X2NvdW50IH07Cj4gLQo+IC0gICAgQVNTRVJUKCFsb2NhbF9pcnFfaXNf
ZW5hYmxlZCgpKTsKPiAtICAgIGxvY2FsX2lycV9lbmFibGUoKTsKPiArICAgIHN0cnVjdCByY3Vf
YmFycmllcl9kYXRhIGRhdGEgPSB7IC5jcHVfY291bnQgPSAmcmN1X2JhcnJpZXJfY3B1X2NvdW50
IH07Cj4gICAKPiAgICAgICAvKgo+ICAgICAgICAqIFdoZW4gY2FsbGJhY2sgaXMgZXhlY3V0ZWQs
IGFsbCBwcmV2aW91c2x5LXF1ZXVlZCBSQ1Ugd29yayBvbiB0aGlzIENQVQo+IEBAIC0xNzIsMTUg
KzE3MiwzMCBAQCBzdGF0aWMgaW50IHJjdV9iYXJyaWVyX2FjdGlvbih2b2lkICpfY3B1X2NvdW50
KQo+ICAgICAgICAgICBjcHVfcmVsYXgoKTsKPiAgICAgICB9Cj4gICAKPiAtICAgIGxvY2FsX2ly
cV9kaXNhYmxlKCk7Cj4gLQo+IC0gICAgcmV0dXJuIDA7Cj4gKyAgICBhdG9taWNfaW5jKCZyY3Vf
YmFycmllcl9jcHVfZG9uZSk7Cj4gICB9Cj4gICAKPiAgIGludCByY3VfYmFycmllcih2b2lkKQo+
ICAgewoKc3RvcF9tYWNoaW5lX3J1bigpIHJlcXVpcmVzIHRoZSBpbnRlcnJ1cHRzIHRvIGJlIGVu
YWJsZWQgd2hlbiBjYWxsZWQuIElzIAp0aGlzIHJlcXVpcmVtZW50IHN0aWxsIHRoZSBzYW1lIGhl
cmU/IElmIHNvLCBjYW4gd2UgZG9jdW1lbnQgaXQgYW5kIGFkZCAKYW4gQVNTRVJUPwoKPiAtICAg
IGF0b21pY190IGNwdV9jb3VudCA9IEFUT01JQ19JTklUKDApOwo+IC0gICAgcmV0dXJuIHN0b3Bf
bWFjaGluZV9ydW4ocmN1X2JhcnJpZXJfYWN0aW9uLCAmY3B1X2NvdW50LCBOUl9DUFVTKTsKPiAr
ICAgIHVuc2lnbmVkIGludCBpOwo+ICsKPiArICAgIGlmICggIWdldF9jcHVfbWFwcygpICkKPiAr
ICAgICAgICByZXR1cm4gLUVCVVNZOwoKSSByZWFsaXplIHRoaXMgaXMgYWxzbyBwcmVzZW50IGlu
IHRoZSBjdXJyZW50IGltcGxlbWVudGF0aW9uLiBIb3dldmVyLCAKbm9ib2R5IHNlZW1zIHRvIGNo
ZWNrIHRoZSByZXR1cm4gb2YgdGhlIGJhcnJpZXIuIFdoYXQgd291bGQgaGFwcGVuIGlmIAp5b3Ug
Y29udGludWUgd2l0aG91dCBzeW5jaHJvbml6aW5nIHRoZSBSQ1U/Cgo+ICsKPiArICAgIGF0b21p
Y19zZXQoJnJjdV9iYXJyaWVyX2NwdV9jb3VudCwgMCk7Cj4gKyAgICBhdG9taWNfc2V0KCZyY3Vf
YmFycmllcl9jcHVfZG9uZSwgMCk7Cj4gKwo+ICsgICAgZm9yX2VhY2hfb25saW5lX2NwdSAoIGkg
KQo+ICsgICAgICAgIGlmICggaSAhPSBzbXBfcHJvY2Vzc29yX2lkKCkgKQo+ICsgICAgICAgICAg
ICB0YXNrbGV0X3NjaGVkdWxlX29uX2NwdSgmcGVyX2NwdShyY3VfYmFycmllcl90YXNrbGV0LCBp
KSwgaSk7Cj4gKwo+ICsgICAgcmN1X2JhcnJpZXJfYWN0aW9uKE5VTEwpOwo+ICsKPiArICAgIHdo
aWxlICggYXRvbWljX3JlYWQoJnJjdV9iYXJyaWVyX2NwdV9kb25lKSAhPSBudW1fb25saW5lX2Nw
dXMoKSApCj4gKyAgICAgICAgY3B1X3JlbGF4KCk7Cj4gKwo+ICsgICAgcHV0X2NwdV9tYXBzKCk7
Cj4gKyAgICByZXR1cm4gMDsKPiAgIH0KPiAgIAo+ICAgLyogSXMgYmF0Y2ggYSBiZWZvcmUgYmF0
Y2ggYiA/ICovCj4gQEAgLTU2NCw2ICs1NzksNyBAQCBzdGF0aWMgdm9pZCByY3VfaW5pdF9wZXJj
cHVfZGF0YShpbnQgY3B1LCBzdHJ1Y3QgcmN1X2N0cmxibGsgKnJjcCwKPiAgICAgICByZHAtPmNw
dSA9IGNwdTsKPiAgICAgICByZHAtPmJsaW1pdCA9IGJsaW1pdDsKPiAgICAgICBpbml0X3RpbWVy
KCZyZHAtPmlkbGVfdGltZXIsIHJjdV9pZGxlX3RpbWVyX2hhbmRsZXIsIHJkcCwgY3B1KTsKPiAr
ICAgIHRhc2tsZXRfaW5pdCgmcGVyX2NwdShyY3VfYmFycmllcl90YXNrbGV0LCBjcHUpLCByY3Vf
YmFycmllcl9hY3Rpb24sIE5VTEwpOwo+ICAgfQo+ICAgCj4gICBzdGF0aWMgaW50IGNwdV9jYWxs
YmFjaygKPiAKCi0tIApKdWxpZW4gR3JhbGwKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3Rz
LnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0
aW5mby94ZW4tZGV2ZWw=

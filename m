Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 4B95FA841D
	for <lists+xen-devel@lfdr.de>; Wed,  4 Sep 2019 15:49:14 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i5Vbz-0003mT-EL; Wed, 04 Sep 2019 13:46:15 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=YVaO=W7=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1i5Vbx-0003m9-Mt
 for xen-devel@lists.xenproject.org; Wed, 04 Sep 2019 13:46:13 +0000
X-Inumbo-ID: 5b664722-cf1a-11e9-abb6-12813bfff9fa
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 5b664722-cf1a-11e9-abb6-12813bfff9fa;
 Wed, 04 Sep 2019 13:46:12 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id C802AAF25;
 Wed,  4 Sep 2019 13:46:11 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Wed,  4 Sep 2019 15:46:07 +0200
Message-Id: <20190904134608.18425-4-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190904134608.18425-1-jgross@suse.com>
References: <20190904134608.18425-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v4 3/4] xen: refactor debugtrace data
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

QXMgYSBwcmVwYXJhdGlvbiBmb3IgcGVyLWNwdSBidWZmZXJzIGRvIGEgbGl0dGxlIHJlZmFjdG9y
aW5nIG9mIHRoZQpkZWJ1Z3RyYWNlIGRhdGE6IHB1dCB0aGUgbmVlZGVkIGJ1ZmZlciBhZG1pbiBk
YXRhIGludG8gdGhlIGJ1ZmZlciBhcwppdCB3aWxsIGJlIG5lZWRlZCBmb3IgZWFjaCBidWZmZXIu
CgpXaGlsZSBhdCBpdCBzd2l0Y2ggZGVidWd0cmFjZV9zZW5kX3RvX2NvbnNvbGUgYW5kIGRlYnVn
dHJhY2VfdXNlZCB0bwpib29sIGFuZCBkZWxldGUgYW4gZW1wdHkgbGluZS4KClNpZ25lZC1vZmYt
Ynk6IEp1ZXJnZW4gR3Jvc3MgPGpncm9zc0BzdXNlLmNvbT4KLS0tClY0OgotIHJlbmFtZWQgc3Ry
dWN0IGRlYnVndHJhY2VfZGF0YV9zIChKYW4gQmV1bGljaCkKLSByZW5hbWVkIGRlYnRyX2RhdGEg
KEphbiBCZXVsaWNoKQotIHJlbW92ZSB1bm5lZWRlZCBjb25kaXRpb24gKEphbiBCZXVsaWNoKQot
IHJlY2FsYyBkZWJ1Z3RyYWNlX2J5dGVzIChKYW4gQmV1bGljaCkKLS0tCiB4ZW4vY29tbW9uL2Rl
YnVndHJhY2UuYyB8IDY1ICsrKysrKysrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0t
LS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCAzNyBpbnNlcnRpb25zKCspLCAyOCBkZWxldGlvbnMo
LSkKCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL2RlYnVndHJhY2UuYyBiL3hlbi9jb21tb24vZGVi
dWd0cmFjZS5jCmluZGV4IDUwNmFlZTk0MTguLjhmYTBlN2ZiMGUgMTAwNjQ0Ci0tLSBhL3hlbi9j
b21tb24vZGVidWd0cmFjZS5jCisrKyBiL3hlbi9jb21tb24vZGVidWd0cmFjZS5jCkBAIC0xNSwz
NSArMTUsNDEgQEAKICNpbmNsdWRlIDx4ZW4vd2F0Y2hkb2cuaD4KIAogLyogU2VuZCBvdXRwdXQg
ZGlyZWN0IHRvIGNvbnNvbGUsIG9yIGJ1ZmZlciBpdD8gKi8KLXN0YXRpYyB2b2xhdGlsZSBpbnQg
ZGVidWd0cmFjZV9zZW5kX3RvX2NvbnNvbGU7CitzdGF0aWMgdm9sYXRpbGUgYm9vbCBkZWJ1Z3Ry
YWNlX3NlbmRfdG9fY29uc29sZTsKIAotc3RhdGljIGNoYXIgICAgICAgICpkZWJ1Z3RyYWNlX2J1
ZjsgLyogRGVidWctdHJhY2UgYnVmZmVyICovCi1zdGF0aWMgdW5zaWduZWQgaW50IGRlYnVndHJh
Y2VfcHJkOyAvKiBQcm9kdWNlciBpbmRleCAgICAgKi8KLXN0YXRpYyB1bnNpZ25lZCBpbnQgZGVi
dWd0cmFjZV9wcmRfbGFzdDsKLXN0YXRpYyB1bnNpZ25lZCBpbnQgZGVidWd0cmFjZV9raWxvYnl0
ZXMgPSAxMjgsIGRlYnVndHJhY2VfYnl0ZXM7Ci1zdGF0aWMgdW5zaWduZWQgaW50IGRlYnVndHJh
Y2VfdXNlZDsKK3N0cnVjdCBkZWJ1Z3RyYWNlX2RhdGEgeworICAgIHVuc2lnbmVkIGxvbmcgYnl0
ZXM7IC8qIFNpemUgb2YgYnVmZmVyLiAqLworICAgIHVuc2lnbmVkIGxvbmcgcHJkOyAgIC8qIFBy
b2R1Y2VyIGluZGV4LiAqLworICAgIHVuc2lnbmVkIGxvbmcgcHJkX2xhc3Q7CisgICAgY2hhciAg
ICAgICAgICBidWZbXTsKK307CisKK3N0YXRpYyBzdHJ1Y3QgZGVidWd0cmFjZV9kYXRhICpkdF9k
YXRhOworCitzdGF0aWMgdW5zaWduZWQgaW50IGRlYnVndHJhY2Vfa2lsb2J5dGVzID0gMTI4Owor
c3RhdGljIGJvb2wgZGVidWd0cmFjZV91c2VkOwogc3RhdGljIERFRklORV9TUElOTE9DSyhkZWJ1
Z3RyYWNlX2xvY2spOwogaW50ZWdlcl9wYXJhbSgiZGVidWd0cmFjZSIsIGRlYnVndHJhY2Vfa2ls
b2J5dGVzKTsKIAogc3RhdGljIHZvaWQgZGVidWd0cmFjZV9kdW1wX3dvcmtlcih2b2lkKQogewot
ICAgIGlmICggKGRlYnVndHJhY2VfYnl0ZXMgPT0gMCkgfHwgIWRlYnVndHJhY2VfdXNlZCApCisg
ICAgaWYgKCAhZGVidWd0cmFjZV91c2VkICkKICAgICAgICAgcmV0dXJuOwogCiAgICAgcHJpbnRr
KCJkZWJ1Z3RyYWNlX2R1bXAoKSBzdGFydGluZ1xuIik7CiAKICAgICAvKiBQcmludCBvbGRlc3Qg
cG9ydGlvbiBvZiB0aGUgcmluZy4gKi8KLSAgICBpZiAoIGRlYnVndHJhY2VfYnVmW2RlYnVndHJh
Y2VfcHJkXSAhPSAnXDAnICkKLSAgICAgICAgY29uc29sZV9zZXJpYWxfcHV0cygmZGVidWd0cmFj
ZV9idWZbZGVidWd0cmFjZV9wcmRdLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlYnVn
dHJhY2VfYnl0ZXMgLSBkZWJ1Z3RyYWNlX3ByZCk7CisgICAgaWYgKCBkdF9kYXRhLT5idWZbZHRf
ZGF0YS0+cHJkXSAhPSAnXDAnICkKKyAgICAgICAgY29uc29sZV9zZXJpYWxfcHV0cygmZHRfZGF0
YS0+YnVmW2R0X2RhdGEtPnByZF0sCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHRfZGF0
YS0+Ynl0ZXMgLSBkdF9kYXRhLT5wcmQpOwogCiAgICAgLyogUHJpbnQgeW91bmdlc3QgcG9ydGlv
biBvZiB0aGUgcmluZy4gKi8KLSAgICBkZWJ1Z3RyYWNlX2J1ZltkZWJ1Z3RyYWNlX3ByZF0gPSAn
XDAnOwotICAgIGNvbnNvbGVfc2VyaWFsX3B1dHMoJmRlYnVndHJhY2VfYnVmWzBdLCBkZWJ1Z3Ry
YWNlX3ByZCk7CisgICAgZHRfZGF0YS0+YnVmW2R0X2RhdGEtPnByZF0gPSAnXDAnOworICAgIGNv
bnNvbGVfc2VyaWFsX3B1dHMoJmR0X2RhdGEtPmJ1ZlswXSwgZHRfZGF0YS0+cHJkKTsKIAotICAg
IG1lbXNldChkZWJ1Z3RyYWNlX2J1ZiwgJ1wwJywgZGVidWd0cmFjZV9ieXRlcyk7Ci0gICAgZGVi
dWd0cmFjZV9wcmQgPSAwOwotICAgIGRlYnVndHJhY2VfcHJkX2xhc3QgPSAwOworICAgIG1lbXNl
dChkdF9kYXRhLT5idWYsICdcMCcsIGR0X2RhdGEtPmJ5dGVzKTsKKyAgICBkdF9kYXRhLT5wcmQg
PSAwOworICAgIGR0X2RhdGEtPnByZF9sYXN0ID0gMDsKIAogICAgIHByaW50aygiZGVidWd0cmFj
ZV9kdW1wKCkgZmluaXNoZWRcbiIpOwogfQpAQCAtNjgsNyArNzQsNiBAQCBzdGF0aWMgdm9pZCBk
ZWJ1Z3RyYWNlX3RvZ2dsZSh2b2lkKQogCiAgICAgc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZGVi
dWd0cmFjZV9sb2NrLCBmbGFncyk7CiAgICAgd2F0Y2hkb2dfZW5hYmxlKCk7Ci0KIH0KIAogdm9p
ZCBkZWJ1Z3RyYWNlX2R1bXAodm9pZCkKQEAgLTkwLDkgKzk1LDkgQEAgc3RhdGljIHZvaWQgZGVi
dWd0cmFjZV9hZGRfdG9fYnVmKGNoYXIgKmJ1ZikKIAogICAgIGZvciAoIHAgPSBidWY7ICpwICE9
ICdcMCc7IHArKyApCiAgICAgewotICAgICAgICBkZWJ1Z3RyYWNlX2J1ZltkZWJ1Z3RyYWNlX3By
ZCsrXSA9ICpwOwotICAgICAgICBpZiAoIGRlYnVndHJhY2VfcHJkID09IGRlYnVndHJhY2VfYnl0
ZXMgKQotICAgICAgICAgICAgZGVidWd0cmFjZV9wcmQgPSAwOworICAgICAgICBkdF9kYXRhLT5i
dWZbZHRfZGF0YS0+cHJkKytdID0gKnA7CisgICAgICAgIGlmICggZHRfZGF0YS0+cHJkID09IGR0
X2RhdGEtPmJ5dGVzICkKKyAgICAgICAgICAgIGR0X2RhdGEtPnByZCA9IDA7CiAgICAgfQogfQog
CkBAIC0xMDYsMTAgKzExMSwxMCBAQCB2b2lkIGRlYnVndHJhY2VfcHJpbnRrKGNvbnN0IGNoYXIg
KmZtdCwgLi4uKQogICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAgICAgdW5zaWduZWQgaW50IG5y
OwogCi0gICAgaWYgKCBkZWJ1Z3RyYWNlX2J5dGVzID09IDAgKQorICAgIGlmICggIWR0X2RhdGEg
KQogICAgICAgICByZXR1cm47CiAKLSAgICBkZWJ1Z3RyYWNlX3VzZWQgPSAxOworICAgIGRlYnVn
dHJhY2VfdXNlZCA9IHRydWU7CiAKICAgICBzcGluX2xvY2tfaXJxc2F2ZSgmZGVidWd0cmFjZV9s
b2NrLCBmbGFncyk7CiAKQEAgLTEyOCwxNCArMTMzLDE0IEBAIHZvaWQgZGVidWd0cmFjZV9wcmlu
dGsoY29uc3QgY2hhciAqZm10LCAuLi4pCiAgICAgewogICAgICAgICBpZiAoIHN0cmNtcChidWYs
IGxhc3RfYnVmKSApCiAgICAgICAgIHsKLSAgICAgICAgICAgIGRlYnVndHJhY2VfcHJkX2xhc3Qg
PSBkZWJ1Z3RyYWNlX3ByZDsKKyAgICAgICAgICAgIGR0X2RhdGEtPnByZF9sYXN0ID0gZHRfZGF0
YS0+cHJkOwogICAgICAgICAgICAgbGFzdF9jb3VudCA9ICsrY291bnQ7CiAgICAgICAgICAgICBz
YWZlX3N0cmNweShsYXN0X2J1ZiwgYnVmKTsKICAgICAgICAgICAgIHNucHJpbnRmKGNudGJ1Ziwg
c2l6ZW9mKGNudGJ1ZiksICIldSAiLCBjb3VudCk7CiAgICAgICAgIH0KICAgICAgICAgZWxzZQog
ICAgICAgICB7Ci0gICAgICAgICAgICBkZWJ1Z3RyYWNlX3ByZCA9IGRlYnVndHJhY2VfcHJkX2xh
c3Q7CisgICAgICAgICAgICBkdF9kYXRhLT5wcmQgPSBkdF9kYXRhLT5wcmRfbGFzdDsKICAgICAg
ICAgICAgIHNucHJpbnRmKGNudGJ1Ziwgc2l6ZW9mKGNudGJ1ZiksICIldS0ldSAiLCBsYXN0X2Nv
dW50LCArK2NvdW50KTsKICAgICAgICAgfQogICAgICAgICBkZWJ1Z3RyYWNlX2FkZF90b19idWYo
Y250YnVmKTsKQEAgLTE1Myw3ICsxNTgsOCBAQCBzdGF0aWMgdm9pZCBkZWJ1Z3RyYWNlX2tleSh1
bnNpZ25lZCBjaGFyIGtleSkKIHN0YXRpYyBpbnQgX19pbml0IGRlYnVndHJhY2VfaW5pdCh2b2lk
KQogewogICAgIGludCBvcmRlcjsKLSAgICB1bnNpZ25lZCBpbnQga2J5dGVzLCBieXRlczsKKyAg
ICB1bnNpZ25lZCBsb25nIGtieXRlcywgYnl0ZXM7CisgICAgc3RydWN0IGRlYnVndHJhY2VfZGF0
YSAqZGF0YTsKIAogICAgIC8qIFJvdW5kIHNpemUgZG93biB0byBuZXh0IHBvd2VyIG9mIHR3by4g
Ki8KICAgICB3aGlsZSAoIChrYnl0ZXMgPSAoZGVidWd0cmFjZV9raWxvYnl0ZXMgJiAoZGVidWd0
cmFjZV9raWxvYnl0ZXMtMSkpKSAhPSAwICkKQEAgLTE2NCwxMiArMTcwLDE1IEBAIHN0YXRpYyBp
bnQgX19pbml0IGRlYnVndHJhY2VfaW5pdCh2b2lkKQogICAgICAgICByZXR1cm4gMDsKIAogICAg
IG9yZGVyID0gZ2V0X29yZGVyX2Zyb21fYnl0ZXMoYnl0ZXMpOwotICAgIGRlYnVndHJhY2VfYnVm
ID0gYWxsb2NfeGVuaGVhcF9wYWdlcyhvcmRlciwgMCk7Ci0gICAgQVNTRVJUKGRlYnVndHJhY2Vf
YnVmICE9IE5VTEwpOworICAgIGRhdGEgPSBhbGxvY194ZW5oZWFwX3BhZ2VzKG9yZGVyLCAwKTsK
KyAgICBpZiAoICFkYXRhICkKKyAgICAgICAgcmV0dXJuIC1FTk9NRU07CiAKLSAgICBtZW1zZXQo
ZGVidWd0cmFjZV9idWYsICdcMCcsIGJ5dGVzKTsKKyAgICBieXRlcyA9IFBBR0VfU0laRSA8PCBv
cmRlcjsKKyAgICBtZW1zZXQoZGF0YSwgJ1wwJywgYnl0ZXMpOwogCi0gICAgZGVidWd0cmFjZV9i
eXRlcyA9IGJ5dGVzOworICAgIGRhdGEtPmJ5dGVzID0gYnl0ZXMgLSBzaXplb2YoKmRhdGEpOwor
ICAgIGR0X2RhdGEgPSBkYXRhOwogCiAgICAgcmVnaXN0ZXJfa2V5aGFuZGxlcignVCcsIGRlYnVn
dHJhY2Vfa2V5LAogICAgICAgICAgICAgICAgICAgICAgICAgInRvZ2dsZSBkZWJ1Z3RyYWNlIHRv
IGNvbnNvbGUvYnVmZmVyIiwgMCk7Ci0tIAoyLjE2LjQKCgpfX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZl
bEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxt
YW4vbGlzdGluZm8veGVuLWRldmVs

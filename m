Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 2CE8E144DB
	for <lists+xen-devel@lfdr.de>; Mon,  6 May 2019 09:00:48 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hNXYx-0002gl-Mp; Mon, 06 May 2019 06:57:23 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=XZcu=TG=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1hNXYl-0002FE-BO
 for xen-devel@lists.xenproject.org; Mon, 06 May 2019 06:57:11 +0000
X-Inumbo-ID: 26a2f0b0-6fcc-11e9-82a0-03eb74c4322f
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 26a2f0b0-6fcc-11e9-82a0-03eb74c4322f;
 Mon, 06 May 2019 06:57:02 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id EECE3AF34;
 Mon,  6 May 2019 06:56:56 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Mon,  6 May 2019 08:56:30 +0200
Message-Id: <20190506065644.7415-32-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190506065644.7415-1-jgross@suse.com>
References: <20190506065644.7415-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH RFC V2 31/45] xen/sched: Change vcpu_migrate_*()
 to operate on schedule item
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Dario Faggioli <dfaggioli@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

Tm93IHRoYXQgdmNwdV9taWdyYXRlX3N0YXJ0KCkgYW5kIHZjcHVfbWlncmF0ZV9maW5pc2goKSBh
cmUgdXNlZCBvbmx5CnRvIGVuc3VyZSBhIHZjcHUgaXMgcnVubmluZyBvbiBhIHN1aXRhYmxlIHBy
b2Nlc3NvciB0aGV5IGNhbiBiZQpzd2l0Y2hlZCB0byBvcGVyYXRlIG9uIHNjaGVkdWxlIGl0ZW1z
IGluc3RlYWQgb2YgdmNwdXMuCgpXaGlsZSBkb2luZyB0aGF0IHJlbmFtZSB0aGVtIGFjY29yZGlu
Z2x5IGFuZCBtYWtlIHRoZSBfc3RhcnQoKSB2YXJpYW50CnN0YXRpYy4KCnZjcHVfbW92ZV9sb2Nr
ZWQoKSBpcyBzd2l0Y2hlZCB0byBzY2hlZHVsZSBpdGVtLCB0b28uCgpTaWduZWQtb2ZmLWJ5OiBK
dWVyZ2VuIEdyb3NzIDxqZ3Jvc3NAc3VzZS5jb20+Ci0tLQogeGVuL2NvbW1vbi9zY2hlZHVsZS5j
IHwgMTAyICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tLS0tLS0tLS0t
CiAxIGZpbGUgY2hhbmdlZCwgNTkgaW5zZXJ0aW9ucygrKSwgNDMgZGVsZXRpb25zKC0pCgpkaWZm
IC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZHVsZS5jIGIveGVuL2NvbW1vbi9zY2hlZHVsZS5jCmlu
ZGV4IDUyZGE1ZDVhMzAuLjlmOWQ2ZWI5NWIgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWR1
bGUuYworKysgYi94ZW4vY29tbW9uL3NjaGVkdWxlLmMKQEAgLTY2NCwzNSArNjY0LDQwIEBAIHZv
aWQgdmNwdV91bmJsb2NrKHN0cnVjdCB2Y3B1ICp2KQogfQogCiAvKgotICogRG8gdGhlIGFjdHVh
bCBtb3ZlbWVudCBvZiBhIHZjcHUgZnJvbSBvbGQgdG8gbmV3IENQVS4gTG9ja3MgZm9yICpib3Ro
KgorICogRG8gdGhlIGFjdHVhbCBtb3ZlbWVudCBvZiBhbiBpdGVtIGZyb20gb2xkIHRvIG5ldyBD
UFUuIExvY2tzIGZvciAqYm90aCoKICAqIENQVXMgbmVlZHMgdG8gaGF2ZSBiZWVuIHRha2VuIGFs
cmVhZHkgd2hlbiBjYWxsaW5nIHRoaXMhCiAgKi8KLXN0YXRpYyB2b2lkIHZjcHVfbW92ZV9sb2Nr
ZWQoc3RydWN0IHZjcHUgKnYsIHVuc2lnbmVkIGludCBuZXdfY3B1KQorc3RhdGljIHZvaWQgc2No
ZWRfaXRlbV9tb3ZlX2xvY2tlZChzdHJ1Y3Qgc2NoZWRfaXRlbSAqaXRlbSwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IG5ld19jcHUpCiB7Ci0gICAgdW5z
aWduZWQgaW50IG9sZF9jcHUgPSB2LT5wcm9jZXNzb3I7CisgICAgdW5zaWduZWQgaW50IG9sZF9j
cHUgPSBpdGVtLT5yZXMtPnByb2Nlc3NvcjsKKyAgICBzdHJ1Y3QgdmNwdSAqdjsKIAogICAgIC8q
CiAgICAgICogVHJhbnNmZXIgdXJnZW5jeSBzdGF0dXMgdG8gbmV3IENQVSBiZWZvcmUgc3dpdGNo
aW5nIENQVXMsIGFzCiAgICAgICogb25jZSB0aGUgc3dpdGNoIG9jY3Vycywgdi0+aXNfdXJnZW50
IGlzIG5vIGxvbmdlciBwcm90ZWN0ZWQgYnkKICAgICAgKiB0aGUgcGVyLUNQVSBzY2hlZHVsZXIg
bG9jayB3ZSBhcmUgaG9sZGluZy4KICAgICAgKi8KLSAgICBpZiAoIHVubGlrZWx5KHYtPmlzX3Vy
Z2VudCkgJiYgKG9sZF9jcHUgIT0gbmV3X2NwdSkgKQorICAgIGZvcl9lYWNoX3NjaGVkX2l0ZW1f
dmNwdSAoIGl0ZW0sIHYgKQogICAgIHsKLSAgICAgICAgYXRvbWljX2luYygmcGVyX2NwdShzY2hl
ZF9yZXMsIG5ld19jcHUpLT51cmdlbnRfY291bnQpOwotICAgICAgICBhdG9taWNfZGVjKCZwZXJf
Y3B1KHNjaGVkX3Jlcywgb2xkX2NwdSktPnVyZ2VudF9jb3VudCk7CisgICAgICAgIGlmICggdW5s
aWtlbHkodi0+aXNfdXJnZW50KSAmJiAob2xkX2NwdSAhPSBuZXdfY3B1KSApCisgICAgICAgIHsK
KyAgICAgICAgICAgIGF0b21pY19pbmMoJnBlcl9jcHUoc2NoZWRfcmVzLCBuZXdfY3B1KS0+dXJn
ZW50X2NvdW50KTsKKyAgICAgICAgICAgIGF0b21pY19kZWMoJnBlcl9jcHUoc2NoZWRfcmVzLCBv
bGRfY3B1KS0+dXJnZW50X2NvdW50KTsKKyAgICAgICAgfQogICAgIH0KIAogICAgIC8qCiAgICAg
ICogQWN0dWFsIENQVSBzd2l0Y2ggdG8gbmV3IENQVS4gIFRoaXMgaXMgc2FmZSBiZWNhdXNlIHRo
ZSBsb2NrCiAgICAgICogcG9pbnRlciBjYW4ndCBjaGFuZ2Ugd2hpbGUgdGhlIGN1cnJlbnQgbG9j
ayBpcyBoZWxkLgogICAgICAqLwotICAgIHNjaGVkX21pZ3JhdGUodmNwdV9zY2hlZHVsZXIodiks
IHYtPnNjaGVkX2l0ZW0sIG5ld19jcHUpOworICAgIHNjaGVkX21pZ3JhdGUodmNwdV9zY2hlZHVs
ZXIoaXRlbS0+dmNwdSksIGl0ZW0sIG5ld19jcHUpOwogfQogCiAvKgogICogSW5pdGlhdGluZyBt
aWdyYXRpb24KICAqCi0gKiBJbiBvcmRlciB0byBtaWdyYXRlLCB3ZSBuZWVkIHRoZSB2Y3B1IGlu
IHF1ZXN0aW9uIHRvIGhhdmUgc3RvcHBlZAorICogSW4gb3JkZXIgdG8gbWlncmF0ZSwgd2UgbmVl
ZCB0aGUgaXRlbSBpbiBxdWVzdGlvbiB0byBoYXZlIHN0b3BwZWQKICAqIHJ1bm5pbmcgYW5kIGhh
ZCBzY2hlZF9zbGVlcCgpIGNhbGxlZCAodG8gdGFrZSBpdCBvZmYgYW55CiAgKiBydW5xdWV1ZXMs
IGZvciBpbnN0YW5jZSk7IGFuZCBpZiBpdCBpcyBjdXJyZW50bHkgcnVubmluZywgaXQgbmVlZHMK
ICAqIHRvIGJlIHNjaGVkdWxlZCBvdXQuICBGaW5hbGx5LCB3ZSBuZWVkIHRvIGhvbGQgdGhlIHNj
aGVkdWxpbmcgbG9ja3MKQEAgLTcwOCwzNyArNzEzLDQ1IEBAIHN0YXRpYyB2b2lkIHZjcHVfbW92
ZV9sb2NrZWQoc3RydWN0IHZjcHUgKnYsIHVuc2lnbmVkIGludCBuZXdfY3B1KQogICogc2hvdWxk
IGJlIGNhbGxlZCBsaWtlIHRoaXM6CiAgKgogICogICAgIGxvY2sgPSBpdGVtX3NjaGVkdWxlX2xv
Y2tfaXJxKGl0ZW0pOwotICogICAgIHZjcHVfbWlncmF0ZV9zdGFydCh2KTsKKyAqICAgICBzY2hl
ZF9pdGVtX21pZ3JhdGVfc3RhcnQoaXRlbSk7CiAgKiAgICAgaXRlbV9zY2hlZHVsZV91bmxvY2tf
aXJxKGxvY2ssIGl0ZW0pCi0gKiAgICAgdmNwdV9taWdyYXRlX2ZpbmlzaCh2KTsKKyAqICAgICBz
Y2hlZF9pdGVtX21pZ3JhdGVfZmluaXNoKGl0ZW0pOwogICoKLSAqIHZjcHVfbWlncmF0ZV9maW5p
c2goKSB3aWxsIGRvIHRoZSB3b3JrIG5vdyBpZiBpdCBjYW4sIG9yIHNpbXBseQotICogcmV0dXJu
IGlmIGl0IGNhbid0IChiZWNhdXNlIHYgaXMgc3RpbGwgcnVubmluZyk7IGluIHRoYXQgY2FzZQot
ICogdmNwdV9taWdyYXRlX2ZpbmlzaCgpIHdpbGwgYmUgY2FsbGVkIGJ5IGNvbnRleHRfc2F2ZWQo
KS4KKyAqIHNjaGVkX2l0ZW1fbWlncmF0ZV9maW5pc2goKSB3aWxsIGRvIHRoZSB3b3JrIG5vdyBp
ZiBpdCBjYW4sIG9yIHNpbXBseQorICogcmV0dXJuIGlmIGl0IGNhbid0IChiZWNhdXNlIGl0ZW0g
aXMgc3RpbGwgcnVubmluZyk7IGluIHRoYXQgY2FzZQorICogc2NoZWRfaXRlbV9taWdyYXRlX2Zp
bmlzaCgpIHdpbGwgYmUgY2FsbGVkIGJ5IGNvbnRleHRfc2F2ZWQoKS4KICAqLwotc3RhdGljIHZv
aWQgdmNwdV9taWdyYXRlX3N0YXJ0KHN0cnVjdCB2Y3B1ICp2KQorc3RhdGljIHZvaWQgc2NoZWRf
aXRlbV9taWdyYXRlX3N0YXJ0KHN0cnVjdCBzY2hlZF9pdGVtICppdGVtKQogewotICAgIHNldF9i
aXQoX1ZQRl9taWdyYXRpbmcsICZ2LT5wYXVzZV9mbGFncyk7Ci0gICAgdmNwdV9zbGVlcF9ub3N5
bmNfbG9ja2VkKHYpOworICAgIHN0cnVjdCB2Y3B1ICp2OworCisgICAgZm9yX2VhY2hfc2NoZWRf
aXRlbV92Y3B1ICggaXRlbSwgdiApCisgICAgeworICAgICAgICBzZXRfYml0KF9WUEZfbWlncmF0
aW5nLCAmdi0+cGF1c2VfZmxhZ3MpOworICAgICAgICB2Y3B1X3NsZWVwX25vc3luY19sb2NrZWQo
dik7CisgICAgfQogfQogCi1zdGF0aWMgdm9pZCB2Y3B1X21pZ3JhdGVfZmluaXNoKHN0cnVjdCB2
Y3B1ICp2KQorc3RhdGljIHZvaWQgc2NoZWRfaXRlbV9taWdyYXRlX2ZpbmlzaChzdHJ1Y3Qgc2No
ZWRfaXRlbSAqaXRlbSkKIHsKICAgICB1bnNpZ25lZCBsb25nIGZsYWdzOwogICAgIHVuc2lnbmVk
IGludCBvbGRfY3B1LCBuZXdfY3B1OwogICAgIHNwaW5sb2NrX3QgKm9sZF9sb2NrLCAqbmV3X2xv
Y2s7CiAgICAgYm9vbF90IHBpY2tfY2FsbGVkID0gMDsKKyAgICBzdHJ1Y3QgdmNwdSAqdjsKIAog
ICAgIC8qCi0gICAgICogSWYgdGhlIHZjcHUgaXMgY3VycmVudGx5IHJ1bm5pbmcsIHRoaXMgd2ls
bCBiZSBoYW5kbGVkIGJ5CisgICAgICogSWYgdGhlIGl0ZW0gaXMgY3VycmVudGx5IHJ1bm5pbmcs
IHRoaXMgd2lsbCBiZSBoYW5kbGVkIGJ5CiAgICAgICogY29udGV4dF9zYXZlZCgpOyBhbmQgaW4g
YW55IGNhc2UsIGlmIHRoZSBiaXQgaXMgY2xlYXJlZCwgdGhlbgogICAgICAqIHNvbWVvbmUgZWxz
ZSBoYXMgYWxyZWFkeSBkb25lIHRoZSB3b3JrIHNvIHdlIGRvbid0IG5lZWQgdG8uCiAgICAgICov
Ci0gICAgaWYgKCB2LT5zY2hlZF9pdGVtLT5pc19ydW5uaW5nIHx8Ci0gICAgICAgICAhdGVzdF9i
aXQoX1ZQRl9taWdyYXRpbmcsICZ2LT5wYXVzZV9mbGFncykgKQotICAgICAgICByZXR1cm47Cisg
ICAgZm9yX2VhY2hfc2NoZWRfaXRlbV92Y3B1ICggaXRlbSwgdiApCisgICAgeworICAgICAgICBp
ZiAoIGl0ZW0tPmlzX3J1bm5pbmcgfHwgIXRlc3RfYml0KF9WUEZfbWlncmF0aW5nLCAmdi0+cGF1
c2VfZmxhZ3MpICkKKyAgICAgICAgICAgIHJldHVybjsKKyAgICB9CiAKLSAgICBvbGRfY3B1ID0g
bmV3X2NwdSA9IHYtPnByb2Nlc3NvcjsKKyAgICBvbGRfY3B1ID0gbmV3X2NwdSA9IGl0ZW0tPnJl
cy0+cHJvY2Vzc29yOwogICAgIGZvciAoIDsgOyApCiAgICAgewogICAgICAgICAvKgpAQCAtNzUx
LDcgKzc2NCw3IEBAIHN0YXRpYyB2b2lkIHZjcHVfbWlncmF0ZV9maW5pc2goc3RydWN0IHZjcHUg
KnYpCiAKICAgICAgICAgc2NoZWRfc3Bpbl9sb2NrX2RvdWJsZShvbGRfbG9jaywgbmV3X2xvY2ss
ICZmbGFncyk7CiAKLSAgICAgICAgb2xkX2NwdSA9IHYtPnByb2Nlc3NvcjsKKyAgICAgICAgb2xk
X2NwdSA9IGl0ZW0tPnJlcy0+cHJvY2Vzc29yOwogICAgICAgICBpZiAoIG9sZF9sb2NrID09IHBl
cl9jcHUoc2NoZWRfcmVzLCBvbGRfY3B1KS0+c2NoZWR1bGVfbG9jayApCiAgICAgICAgIHsKICAg
ICAgICAgICAgIC8qCkBAIC03NjAsMTUgKzc3MywxNSBAQCBzdGF0aWMgdm9pZCB2Y3B1X21pZ3Jh
dGVfZmluaXNoKHN0cnVjdCB2Y3B1ICp2KQogICAgICAgICAgICAgICovCiAgICAgICAgICAgICBp
ZiAoIHBpY2tfY2FsbGVkICYmCiAgICAgICAgICAgICAgICAgIChuZXdfbG9jayA9PSBwZXJfY3B1
KHNjaGVkX3JlcywgbmV3X2NwdSktPnNjaGVkdWxlX2xvY2spICYmCi0gICAgICAgICAgICAgICAg
IGNwdW1hc2tfdGVzdF9jcHUobmV3X2NwdSwgdi0+c2NoZWRfaXRlbS0+Y3B1X2hhcmRfYWZmaW5p
dHkpICYmCi0gICAgICAgICAgICAgICAgIGNwdW1hc2tfdGVzdF9jcHUobmV3X2NwdSwgdi0+ZG9t
YWluLT5jcHVwb29sLT5jcHVfdmFsaWQpICkKKyAgICAgICAgICAgICAgICAgY3B1bWFza190ZXN0
X2NwdShuZXdfY3B1LCBpdGVtLT5jcHVfaGFyZF9hZmZpbml0eSkgJiYKKyAgICAgICAgICAgICAg
ICAgY3B1bWFza190ZXN0X2NwdShuZXdfY3B1LCBpdGVtLT5kb21haW4tPmNwdXBvb2wtPmNwdV92
YWxpZCkgKQogICAgICAgICAgICAgICAgIGJyZWFrOwogCiAgICAgICAgICAgICAvKiBTZWxlY3Qg
YSBuZXcgQ1BVLiAqLwotICAgICAgICAgICAgbmV3X2NwdSA9IHNjaGVkX3BpY2tfcmVzb3VyY2Uo
dmNwdV9zY2hlZHVsZXIodiksCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICB2LT5zY2hlZF9pdGVtKS0+cHJvY2Vzc29yOworICAgICAgICAgICAgbmV3X2NwdSA9IHNj
aGVkX3BpY2tfcmVzb3VyY2UodmNwdV9zY2hlZHVsZXIoaXRlbS0+dmNwdSksCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtKS0+cHJvY2Vzc29yOwogICAgICAg
ICAgICAgaWYgKCAobmV3X2xvY2sgPT0gcGVyX2NwdShzY2hlZF9yZXMsIG5ld19jcHUpLT5zY2hl
ZHVsZV9sb2NrKSAmJgotICAgICAgICAgICAgICAgICBjcHVtYXNrX3Rlc3RfY3B1KG5ld19jcHUs
IHYtPmRvbWFpbi0+Y3B1cG9vbC0+Y3B1X3ZhbGlkKSApCisgICAgICAgICAgICAgICAgIGNwdW1h
c2tfdGVzdF9jcHUobmV3X2NwdSwgaXRlbS0+ZG9tYWluLT5jcHVwb29sLT5jcHVfdmFsaWQpICkK
ICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgIHBpY2tfY2FsbGVkID0gMTsKICAg
ICAgICAgfQpAQCAtNzg5LDIyICs4MDIsMjYgQEAgc3RhdGljIHZvaWQgdmNwdV9taWdyYXRlX2Zp
bmlzaChzdHJ1Y3QgdmNwdSAqdikKICAgICAgKiBiZWNhdXNlIHRoZXkgYm90aCBoYXBwZW4gaW4g
KGRpZmZlcmVudCkgc3BpbmxvY2sgcmVnaW9ucywgYW5kIHRob3NlCiAgICAgICogcmVnaW9ucyBh
cmUgc3RyaWN0bHkgc2VyaWFsaXNlZC4KICAgICAgKi8KLSAgICBpZiAoIHYtPnNjaGVkX2l0ZW0t
PmlzX3J1bm5pbmcgfHwKLSAgICAgICAgICF0ZXN0X2FuZF9jbGVhcl9iaXQoX1ZQRl9taWdyYXRp
bmcsICZ2LT5wYXVzZV9mbGFncykgKQorICAgIGZvcl9lYWNoX3NjaGVkX2l0ZW1fdmNwdSAoIGl0
ZW0sIHYgKQogICAgIHsKLSAgICAgICAgc2NoZWRfc3Bpbl91bmxvY2tfZG91YmxlKG9sZF9sb2Nr
LCBuZXdfbG9jaywgZmxhZ3MpOwotICAgICAgICByZXR1cm47CisgICAgICAgIGlmICggaXRlbS0+
aXNfcnVubmluZyB8fAorICAgICAgICAgICAgICF0ZXN0X2FuZF9jbGVhcl9iaXQoX1ZQRl9taWdy
YXRpbmcsICZ2LT5wYXVzZV9mbGFncykgKQorICAgICAgICB7CisgICAgICAgICAgICBzY2hlZF9z
cGluX3VubG9ja19kb3VibGUob2xkX2xvY2ssIG5ld19sb2NrLCBmbGFncyk7CisgICAgICAgICAg
ICByZXR1cm47CisgICAgICAgIH0KICAgICB9CiAKLSAgICB2Y3B1X21vdmVfbG9ja2VkKHYsIG5l
d19jcHUpOworICAgIHNjaGVkX2l0ZW1fbW92ZV9sb2NrZWQoaXRlbSwgbmV3X2NwdSk7CiAKICAg
ICBzY2hlZF9zcGluX3VubG9ja19kb3VibGUob2xkX2xvY2ssIG5ld19sb2NrLCBmbGFncyk7CiAK
ICAgICBpZiAoIG9sZF9jcHUgIT0gbmV3X2NwdSApCi0gICAgICAgIHNjaGVkX21vdmVfaXJxcyh2
LT5zY2hlZF9pdGVtKTsKKyAgICAgICAgc2NoZWRfbW92ZV9pcnFzKGl0ZW0pOwogCiAgICAgLyog
V2FrZSBvbiBuZXcgQ1BVLiAqLwotICAgIHZjcHVfd2FrZSh2KTsKKyAgICBmb3JfZWFjaF9zY2hl
ZF9pdGVtX3ZjcHUgKCBpdGVtLCB2ICkKKyAgICAgICAgdmNwdV93YWtlKHYpOwogfQogCiAvKgpA
QCAtOTQ1LDEwICs5NjIsOSBAQCBpbnQgY3B1X2Rpc2FibGVfc2NoZWR1bGVyKHVuc2lnbmVkIGlu
dCBjcHUpCiAgICAgICAgICAgICAgKiAgKiB0aGUgc2NoZWR1bGVyIHdpbGwgYWx3YXlzIGZpbmQg
YSBzdWl0YWJsZSBzb2x1dGlvbiwgb3IKICAgICAgICAgICAgICAqICAgIHRoaW5ncyB3b3VsZCBo
YXZlIGZhaWxlZCBiZWZvcmUgZ2V0dGluZyBpbiBoZXJlLgogICAgICAgICAgICAgICovCi0gICAg
ICAgICAgICB2Y3B1X21pZ3JhdGVfc3RhcnQoaXRlbS0+dmNwdSk7CisgICAgICAgICAgICBzY2hl
ZF9pdGVtX21pZ3JhdGVfc3RhcnQoaXRlbSk7CiAgICAgICAgICAgICBpdGVtX3NjaGVkdWxlX3Vu
bG9ja19pcnFyZXN0b3JlKGxvY2ssIGZsYWdzLCBpdGVtKTsKLQotICAgICAgICAgICAgdmNwdV9t
aWdyYXRlX2ZpbmlzaChpdGVtLT52Y3B1KTsKKyAgICAgICAgICAgIHNjaGVkX2l0ZW1fbWlncmF0
ZV9maW5pc2goaXRlbSk7CiAKICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgKiBUaGUgb25s
eSBjYXZlYXQsIGluIHRoaXMgY2FzZSwgaXMgdGhhdCBpZiBhIHZjcHUgYWN0aXZlIGluCkBAIC0x
MDMyLDE0ICsxMDQ4LDE0IEBAIHN0YXRpYyBpbnQgdmNwdV9zZXRfYWZmaW5pdHkoCiAgICAgICAg
ICAgICBBU1NFUlQod2hpY2ggPT0gaXRlbS0+Y3B1X3NvZnRfYWZmaW5pdHkpOwogICAgICAgICAg
ICAgc2NoZWRfc2V0X2FmZmluaXR5KHYsIE5VTEwsIGFmZmluaXR5KTsKICAgICAgICAgfQotICAg
ICAgICB2Y3B1X21pZ3JhdGVfc3RhcnQodik7CisgICAgICAgIHNjaGVkX2l0ZW1fbWlncmF0ZV9z
dGFydChpdGVtKTsKICAgICB9CiAKICAgICBpdGVtX3NjaGVkdWxlX3VubG9ja19pcnEobG9jaywg
aXRlbSk7CiAKICAgICBkb21haW5fdXBkYXRlX25vZGVfYWZmaW5pdHkodi0+ZG9tYWluKTsKIAot
ICAgIHZjcHVfbWlncmF0ZV9maW5pc2godik7CisgICAgc2NoZWRfaXRlbV9taWdyYXRlX2Zpbmlz
aChpdGVtKTsKIAogICAgIHJldHVybiByZXQ7CiB9CkBAIC0xMjgzLDEzICsxMjk5LDEzIEBAIGlu
dCB2Y3B1X3Bpbl9vdmVycmlkZShzdHJ1Y3QgdmNwdSAqdiwgaW50IGNwdSkKICAgICB9CiAKICAg
ICBpZiAoIHJldCA9PSAwICkKLSAgICAgICAgdmNwdV9taWdyYXRlX3N0YXJ0KHYpOworICAgICAg
ICBzY2hlZF9pdGVtX21pZ3JhdGVfc3RhcnQoaXRlbSk7CiAKICAgICBpdGVtX3NjaGVkdWxlX3Vu
bG9ja19pcnEobG9jaywgaXRlbSk7CiAKICAgICBkb21haW5fdXBkYXRlX25vZGVfYWZmaW5pdHko
di0+ZG9tYWluKTsKIAotICAgIHZjcHVfbWlncmF0ZV9maW5pc2godik7CisgICAgc2NoZWRfaXRl
bV9taWdyYXRlX2ZpbmlzaChpdGVtKTsKIAogICAgIHJldHVybiByZXQ7CiB9CkBAIC0xNjc2LDcg
KzE2OTIsNyBAQCB2b2lkIGNvbnRleHRfc2F2ZWQoc3RydWN0IHZjcHUgKnByZXYpCiAKICAgICBz
Y2hlZF9jb250ZXh0X3NhdmVkKHZjcHVfc2NoZWR1bGVyKHByZXYpLCBwcmV2LT5zY2hlZF9pdGVt
KTsKIAotICAgIHZjcHVfbWlncmF0ZV9maW5pc2gocHJldik7CisgICAgc2NoZWRfaXRlbV9taWdy
YXRlX2ZpbmlzaChwcmV2LT5zY2hlZF9pdGVtKTsKIH0KIAogLyogVGhlIHNjaGVkdWxlciB0aW1l
cjogZm9yY2UgYSBydW4gdGhyb3VnaCB0aGUgc2NoZWR1bGVyICovCi0tIAoyLjE2LjQKCgpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFp
bGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhl
bnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

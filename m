Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 432B96C18D
	for <lists+xen-devel@lfdr.de>; Wed, 17 Jul 2019 21:37:14 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hnpgk-0000KX-Iz; Wed, 17 Jul 2019 19:34:06 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=K8rP=VO=gmail.com=tamas.k.lengyel@srs-us1.protection.inumbo.net>)
 id 1hnpgj-0000Ju-2C
 for xen-devel@lists.xenproject.org; Wed, 17 Jul 2019 19:34:05 +0000
X-Inumbo-ID: d4362ae0-a8c9-11e9-8c7b-2bb8db163187
Received: from mail-io1-f68.google.com (unknown [209.85.166.68])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id d4362ae0-a8c9-11e9-8c7b-2bb8db163187;
 Wed, 17 Jul 2019 19:34:01 +0000 (UTC)
Received: by mail-io1-f68.google.com with SMTP id i10so47542946iol.13
 for <xen-devel@lists.xenproject.org>; Wed, 17 Jul 2019 12:34:01 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=DZeS6BHvOxQrDAME9IQTHZlH+LOilULLIYwYdA0+/Qg=;
 b=XiPw7HuCNpZwtHhs2saUqrwAoPzK0EhLqmI22OTnJTc08nINU6q25wX9FXGEyjNkcp
 +vriEDEnuwWZob6Kvh71hSofILwXFXOOi/Rw8yUUEhljDbEe0GqOs1yf41WQgbt+jNfe
 qT/vfI6QzN3rXB2HwVhZL272usgDxZlayA5EcHwJM1HARSbDNun4kt5qbeKhbFQZX5yP
 zVQNwNVtS0sqylBEDqYC8507hPwgbmwCTNA3oYOr6akgpiSZmKj0r8eOMtf3E39HtSSN
 q4buqWXQx+5Cg/UH2umcQkmikUBcvazRxIq2vSU+bn4ZVWyqk/7KqSob1673omAdWmbJ
 b2ew==
X-Gm-Message-State: APjAAAW7gWb37BIU5bF7W6cV87JCt3i8DNn1PW9bbNDtz69LfvngBjW5
 0sUZInmASt8OJh+yOuYdq50HEv5f
X-Google-Smtp-Source: APXvYqztdtJ/vOpct7p7oU8uFaGuVm+k56N2dMhnDiDrrQuJ2Kb+UdTum51T4dLHh53zjL4Nndiydw==
X-Received: by 2002:a5e:881a:: with SMTP id l26mr14801631ioj.185.1563392040268; 
 Wed, 17 Jul 2019 12:34:00 -0700 (PDT)
Received: from l1.lan (c-71-205-12-124.hsd1.co.comcast.net. [71.205.12.124])
 by smtp.gmail.com with ESMTPSA id v13sm21743421ioq.13.2019.07.17.12.33.58
 (version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);
 Wed, 17 Jul 2019 12:33:59 -0700 (PDT)
From: Tamas K Lengyel <tamas@tklengyel.com>
To: xen-devel@lists.xenproject.org
Date: Wed, 17 Jul 2019 13:33:35 -0600
Message-Id: <20190717193335.11991-6-tamas@tklengyel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190717193335.11991-1-tamas@tklengyel.com>
References: <20190717193335.11991-1-tamas@tklengyel.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v6 5/5] x86/mem_sharing: style cleanup
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Tamas K Lengyel <tamas@tklengyel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

Tm8gZnVuY3Rpb25hbCBjaGFuZ2UKClNpZ25lZC1vZmYtYnk6IFRhbWFzIEsgTGVuZ3llbCA8dGFt
YXNAdGtsZW5neWVsLmNvbT4KLS0tCiB4ZW4vYXJjaC94ODYvbW0vbWVtX3NoYXJpbmcuYyB8IDI2
NSArKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgMTM4
IGluc2VydGlvbnMoKyksIDEyNyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94
ODYvbW0vbWVtX3NoYXJpbmcuYyBiL3hlbi9hcmNoL3g4Ni9tbS9tZW1fc2hhcmluZy5jCmluZGV4
IGE1ZmU4OWUzMzkuLmFhZjhjMmYyYzggMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9tbS9tZW1f
c2hhcmluZy5jCisrKyBiL3hlbi9hcmNoL3g4Ni9tbS9tZW1fc2hhcmluZy5jCkBAIC00Miw3ICs0
Miw4IEBACiAKIHN0YXRpYyBzaHJfaGFuZGxlX3QgbmV4dF9oYW5kbGUgPSAxOwogCi10eXBlZGVm
IHN0cnVjdCBwZ19sb2NrX2RhdGEgewordHlwZWRlZiBzdHJ1Y3QgcGdfbG9ja19kYXRhCit7CiAg
ICAgaW50IG1tX3VubG9ja19sZXZlbDsKICAgICB1bnNpZ25lZCBzaG9ydCByZWN1cnNlX2NvdW50
OwogfSBwZ19sb2NrX2RhdGFfdDsKQEAgLTg4LDggKzg5LDggQEAgc3RhdGljIGlubGluZSB2b2lk
IHBhZ2Vfc2hhcmluZ19kaXNwb3NlKHN0cnVjdCBwYWdlX2luZm8gKnBhZ2UpCiB7CiAgICAgLyog
VW5saWtlbHkgZ2l2ZW4gb3VyIHRocmVzaG9sZHMsIGJ1dCB3ZSBzaG91bGQgYmUgY2FyZWZ1bC4g
Ki8KICAgICBpZiAoIHVubGlrZWx5KFJNQVBfVVNFU19IQVNIVEFCKHBhZ2UpKSApCi0gICAgICAg
IGZyZWVfeGVuaGVhcF9wYWdlcyhwYWdlLT5zaGFyaW5nLT5oYXNoX3RhYmxlLmJ1Y2tldCwgCi0g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgUk1BUF9IQVNIVEFCX09SREVSKTsKKyAgICAgICAg
ZnJlZV94ZW5oZWFwX3BhZ2VzKHBhZ2UtPnNoYXJpbmctPmhhc2hfdGFibGUuYnVja2V0LAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgUk1BUF9IQVNIVEFCX09SREVSKTsKIAogICAgIHNwaW5f
bG9jaygmc2hyX2F1ZGl0X2xvY2spOwogICAgIGxpc3RfZGVsX3JjdSgmcGFnZS0+c2hhcmluZy0+
ZW50cnkpOwpAQCAtMTA1LDggKzEwNiw4IEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBwYWdlX3NoYXJp
bmdfZGlzcG9zZShzdHJ1Y3QgcGFnZV9pbmZvICpwYWdlKQogewogICAgIC8qIFVubGlrZWx5IGdp
dmVuIG91ciB0aHJlc2hvbGRzLCBidXQgd2Ugc2hvdWxkIGJlIGNhcmVmdWwuICovCiAgICAgaWYg
KCB1bmxpa2VseShSTUFQX1VTRVNfSEFTSFRBQihwYWdlKSkgKQotICAgICAgICBmcmVlX3hlbmhl
YXBfcGFnZXMocGFnZS0+c2hhcmluZy0+aGFzaF90YWJsZS5idWNrZXQsIAotICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIFJNQVBfSEFTSFRBQl9PUkRFUik7CisgICAgICAgIGZyZWVfeGVuaGVh
cF9wYWdlcyhwYWdlLT5zaGFyaW5nLT5oYXNoX3RhYmxlLmJ1Y2tldCwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgIFJNQVBfSEFTSFRBQl9PUkRFUik7CiAgICAgeGZyZWUocGFnZS0+c2hhcmlu
Zyk7CiB9CiAKQEAgLTEzNiw4ICsxMzcsOCBAQCBzdGF0aWMgaW5saW5lIGJvb2wgX3BhZ2VfbG9j
ayhzdHJ1Y3QgcGFnZV9pbmZvICpwYWdlKQogICAgICAgICAgICAgY3B1X3JlbGF4KCk7CiAgICAg
ICAgIG54ID0geCArICgxIHwgUEdUX2xvY2tlZCk7CiAgICAgICAgIGlmICggISh4ICYgUEdUX3Zh
bGlkYXRlZCkgfHwKLSAgICAgICAgICAgICAhKHggJiBQR1RfY291bnRfbWFzaykgfHwKLSAgICAg
ICAgICAgICAhKG54ICYgUEdUX2NvdW50X21hc2spICkKKyAgICAgICAgICAgICAgICAhKHggJiBQ
R1RfY291bnRfbWFzaykgfHwKKyAgICAgICAgICAgICAgICAhKG54ICYgUEdUX2NvdW50X21hc2sp
ICkKICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICB9IHdoaWxlICggY21weGNoZygmcGFn
ZS0+dS5pbnVzZS50eXBlX2luZm8sIHgsIG54KSAhPSB4ICk7CiAKQEAgLTE2OCw3ICsxNjksNyBA
QCBzdGF0aWMgaW5saW5lIGJvb2wgbWVtX3NoYXJpbmdfcGFnZV9sb2NrKHN0cnVjdCBwYWdlX2lu
Zm8gKnBnKQogICAgIGlmICggcmMgKQogICAgIHsKICAgICAgICAgcHJlZW1wdF9kaXNhYmxlKCk7
Ci0gICAgICAgIHBhZ2Vfc2hhcmluZ19tbV9wb3N0X2xvY2soJnBsZC0+bW1fdW5sb2NrX2xldmVs
LCAKKyAgICAgICAgcGFnZV9zaGFyaW5nX21tX3Bvc3RfbG9jaygmcGxkLT5tbV91bmxvY2tfbGV2
ZWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJnBsZC0+cmVjdXJzZV9jb3Vu
dCk7CiAgICAgfQogICAgIHJldHVybiByYzsKQEAgLTE3OCw3ICsxNzksNyBAQCBzdGF0aWMgaW5s
aW5lIHZvaWQgbWVtX3NoYXJpbmdfcGFnZV91bmxvY2soc3RydWN0IHBhZ2VfaW5mbyAqcGcpCiB7
CiAgICAgcGdfbG9ja19kYXRhX3QgKnBsZCA9ICYodGhpc19jcHUoX19wbGQpKTsKIAotICAgIHBh
Z2Vfc2hhcmluZ19tbV91bmxvY2socGxkLT5tbV91bmxvY2tfbGV2ZWwsIAorICAgIHBhZ2Vfc2hh
cmluZ19tbV91bmxvY2socGxkLT5tbV91bmxvY2tfbGV2ZWwsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAmcGxkLT5yZWN1cnNlX2NvdW50KTsKICAgICBwcmVlbXB0X2VuYWJsZSgpOwogICAg
IF9wYWdlX3VubG9jayhwZyk7CkBAIC0xODYsMTkgKzE4NywxOCBAQCBzdGF0aWMgaW5saW5lIHZv
aWQgbWVtX3NoYXJpbmdfcGFnZV91bmxvY2soc3RydWN0IHBhZ2VfaW5mbyAqcGcpCiAKIHN0YXRp
YyBpbmxpbmUgc2hyX2hhbmRsZV90IGdldF9uZXh0X2hhbmRsZSh2b2lkKQogewotICAgIC8qIEdl
dCB0aGUgbmV4dCBoYW5kbGUgZ2V0X3BhZ2Ugc3R5bGUgKi8gCisgICAgLyogR2V0IHRoZSBuZXh0
IGhhbmRsZSBnZXRfcGFnZSBzdHlsZSAqLwogICAgIHVpbnQ2NF90IHgsIHkgPSBuZXh0X2hhbmRs
ZTsKICAgICBkbyB7CiAgICAgICAgIHggPSB5OwotICAgIH0KLSAgICB3aGlsZSAoICh5ID0gY21w
eGNoZygmbmV4dF9oYW5kbGUsIHgsIHggKyAxKSkgIT0geCApOworICAgIH0gd2hpbGUgKCAoeSA9
IGNtcHhjaGcoJm5leHRfaGFuZGxlLCB4LCB4ICsgMSkpICE9IHggKTsKICAgICByZXR1cm4geCAr
IDE7CiB9CiAKICNkZWZpbmUgbWVtX3NoYXJpbmdfZW5hYmxlZChkKSBcCiAgICAgKGlzX2h2bV9k
b21haW4oZCkgJiYgKGQpLT5hcmNoLmh2bS5tZW1fc2hhcmluZ19lbmFibGVkKQogCi1zdGF0aWMg
YXRvbWljX3QgbnJfc2F2ZWRfbWZucyAgID0gQVRPTUlDX0lOSVQoMCk7IAorc3RhdGljIGF0b21p
Y190IG5yX3NhdmVkX21mbnMgICA9IEFUT01JQ19JTklUKDApOwogc3RhdGljIGF0b21pY190IG5y
X3NoYXJlZF9tZm5zICA9IEFUT01JQ19JTklUKDApOwogCiAvKiogUmV2ZXJzZSBtYXAgKiovCkBA
IC0yMTAsNyArMjEwLDcgQEAgc3RhdGljIGF0b21pY190IG5yX3NoYXJlZF9tZm5zICA9IEFUT01J
Q19JTklUKDApOwogdHlwZWRlZiBzdHJ1Y3QgZ2ZuX2luZm8KIHsKICAgICB1bnNpZ25lZCBsb25n
IGdmbjsKLSAgICBkb21pZF90IGRvbWFpbjsgCisgICAgZG9taWRfdCBkb21haW47CiAgICAgc3Ry
dWN0IGxpc3RfaGVhZCBsaXN0OwogfSBnZm5faW5mb190OwogCkBAIC0yMjUsNyArMjI1LDcgQEAg
cm1hcF9pbml0KHN0cnVjdCBwYWdlX2luZm8gKnBhZ2UpCiAjZGVmaW5lIEhBU0goZG9tYWluLCBn
Zm4pICAgICAgIFwKICAgICAoKChnZm4pICsgKGRvbWFpbikpICUgUk1BUF9IQVNIVEFCX1NJWkUp
CiAKLS8qIENvbnZlcnNpb25zLiBUdW5lZCBieSB0aGUgdGhyZXNob2xkcy4gU2hvdWxkIG9ubHkg
aGFwcGVuIHR3aWNlIAorLyogQ29udmVyc2lvbnMuIFR1bmVkIGJ5IHRoZSB0aHJlc2hvbGRzLiBT
aG91bGQgb25seSBoYXBwZW4gdHdpY2UKICAqIChvbmNlIGVhY2gpIGR1cmluZyB0aGUgbGlmZXRp
bWUgb2YgYSBzaGFyZWQgcGFnZSAqLwogc3RhdGljIGlubGluZSBpbnQKIHJtYXBfbGlzdF90b19o
YXNoX3RhYmxlKHN0cnVjdCBwYWdlX2luZm8gKnBhZ2UpCkBAIC0yODgsMTMgKzI4OCwxMyBAQCBy
bWFwX2NvdW50KHN0cnVjdCBwYWdlX2luZm8gKnBnKQogfQogCiAvKiBUaGUgcGFnZSB0eXBlIGNv
dW50IGlzIGFsd2F5cyBkZWNyZWFzZWQgYWZ0ZXIgcmVtb3ZpbmcgZnJvbSB0aGUgcm1hcC4KLSAq
IFVzZSBhIGNvbnZlcnQgZmxhZyB0byBhdm9pZCBtdXRhdGluZyB0aGUgcm1hcCBpZiBpbiB0aGUg
bWlkZGxlIG9mIGFuIAorICogVXNlIGEgY29udmVydCBmbGFnIHRvIGF2b2lkIG11dGF0aW5nIHRo
ZSBybWFwIGlmIGluIHRoZSBtaWRkbGUgb2YgYW4KICAqIGl0ZXJhdG9yLCBvciBpZiB0aGUgcGFn
ZSB3aWxsIGJlIHNvb24gZGVzdHJveWVkIGFueXdheXMuICovCiBzdGF0aWMgaW5saW5lIHZvaWQK
IHJtYXBfZGVsKGdmbl9pbmZvX3QgKmdmbl9pbmZvLCBzdHJ1Y3QgcGFnZV9pbmZvICpwYWdlLCBp
bnQgY29udmVydCkKIHsKICAgICBpZiAoIFJNQVBfVVNFU19IQVNIVEFCKHBhZ2UpICYmIGNvbnZl
cnQgJiYKLSAgICAgICAgIChybWFwX2NvdW50KHBhZ2UpIDw9IFJNQVBfTElHSFRfU0hBUkVEX1BB
R0UpICkKKyAgICAgICAgICAgIChybWFwX2NvdW50KHBhZ2UpIDw9IFJNQVBfTElHSFRfU0hBUkVE
X1BBR0UpICkKICAgICAgICAgcm1hcF9oYXNoX3RhYmxlX3RvX2xpc3QocGFnZSk7CiAKICAgICAv
KiBSZWdhcmRsZXNzIG9mIHJtYXAgdHlwZSwgc2FtZSByZW1vdmFsIG9wZXJhdGlvbiAqLwpAQCAt
MzA4LDMwICszMDgsMzAgQEAgcm1hcF9hZGQoZ2ZuX2luZm9fdCAqZ2ZuX2luZm8sIHN0cnVjdCBw
YWdlX2luZm8gKnBhZ2UpCiAgICAgc3RydWN0IGxpc3RfaGVhZCAqaGVhZDsKIAogICAgIGlmICgg
IVJNQVBfVVNFU19IQVNIVEFCKHBhZ2UpICYmCi0gICAgICAgICAocm1hcF9jb3VudChwYWdlKSA+
PSBSTUFQX0hFQVZZX1NIQVJFRF9QQUdFKSApCisgICAgICAgICAgICAocm1hcF9jb3VudChwYWdl
KSA+PSBSTUFQX0hFQVZZX1NIQVJFRF9QQUdFKSApCiAgICAgICAgIC8qIFRoZSBjb252ZXJzaW9u
IG1heSBmYWlsIHdpdGggRU5PTUVNLiBXZSdsbCBiZSBsZXNzIGVmZmljaWVudCwKICAgICAgICAg
ICogYnV0IG5vIHJlYXNvbiB0byBwYW5pYy4gKi8KICAgICAgICAgKHZvaWQpcm1hcF9saXN0X3Rv
X2hhc2hfdGFibGUocGFnZSk7CiAKICAgICBoZWFkID0gKFJNQVBfVVNFU19IQVNIVEFCKHBhZ2Up
KSA/Ci0gICAgICAgIHBhZ2UtPnNoYXJpbmctPmhhc2hfdGFibGUuYnVja2V0ICsgCi0gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgSEFTSChnZm5faW5mby0+ZG9tYWluLCBnZm5faW5mby0+Z2Zu
KSA6Ci0gICAgICAgICZwYWdlLT5zaGFyaW5nLT5nZm5zOworICAgICAgICAgICBwYWdlLT5zaGFy
aW5nLT5oYXNoX3RhYmxlLmJ1Y2tldCArCisgICAgICAgICAgIEhBU0goZ2ZuX2luZm8tPmRvbWFp
biwgZ2ZuX2luZm8tPmdmbikgOgorICAgICAgICAgICAmcGFnZS0+c2hhcmluZy0+Z2ZuczsKIAog
ICAgIElOSVRfTElTVF9IRUFEKCZnZm5faW5mby0+bGlzdCk7CiAgICAgbGlzdF9hZGQoJmdmbl9p
bmZvLT5saXN0LCBoZWFkKTsKIH0KIAogc3RhdGljIGlubGluZSBnZm5faW5mb190ICoKLXJtYXBf
cmV0cmlldmUodWludDE2X3QgZG9tYWluX2lkLCB1bnNpZ25lZCBsb25nIGdmbiwgCi0gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHBhZ2VfaW5mbyAqcGFnZSkKK3JtYXBfcmV0cmll
dmUodWludDE2X3QgZG9tYWluX2lkLCB1bnNpZ25lZCBsb25nIGdmbiwKKyAgICAgICAgICAgICAg
c3RydWN0IHBhZ2VfaW5mbyAqcGFnZSkKIHsKICAgICBnZm5faW5mb190ICpnZm5faW5mbzsKICAg
ICBzdHJ1Y3QgbGlzdF9oZWFkICpsZSwgKmhlYWQ7CiAKICAgICBoZWFkID0gKFJNQVBfVVNFU19I
QVNIVEFCKHBhZ2UpKSA/Ci0gICAgICAgIHBhZ2UtPnNoYXJpbmctPmhhc2hfdGFibGUuYnVja2V0
ICsgSEFTSChkb21haW5faWQsIGdmbikgOgotICAgICAgICAmcGFnZS0+c2hhcmluZy0+Z2ZuczsK
KyAgICAgICAgICAgcGFnZS0+c2hhcmluZy0+aGFzaF90YWJsZS5idWNrZXQgKyBIQVNIKGRvbWFp
bl9pZCwgZ2ZuKSA6CisgICAgICAgICAgICZwYWdlLT5zaGFyaW5nLT5nZm5zOwogCiAgICAgbGlz
dF9mb3JfZWFjaChsZSwgaGVhZCkKICAgICB7CkBAIC0zNTgsNyArMzU4LDggQEAgc3RhdGljIGlu
bGluZSBpbnQgcm1hcF9oYXNfZW50cmllcyhzdHJ1Y3QgcGFnZV9pbmZvICpwYWdlKQogCiAvKiBU
aGUgaXRlcmF0b3IgaGlkZXMgdGhlIGRldGFpbHMgb2YgaG93IHRoZSBybWFwIGlzIGltcGxlbWVu
dGVkLiBUaGlzCiAgKiBpbnZvbHZlcyBzcGxpdHRpbmcgdGhlIGxpc3RfZm9yX2VhY2hfc2FmZSBt
YWNybyBpbnRvIHR3byBzdGVwcy4gKi8KLXN0cnVjdCBybWFwX2l0ZXJhdG9yIHsKK3N0cnVjdCBy
bWFwX2l0ZXJhdG9yCit7CiAgICAgc3RydWN0IGxpc3RfaGVhZCAqY3VycjsKICAgICBzdHJ1Y3Qg
bGlzdF9oZWFkICpuZXh0OwogICAgIHVuc2lnbmVkIGludCBidWNrZXQ7CkBAIC0zNjgsOSArMzY5
LDkgQEAgc3RhdGljIGlubGluZSB2b2lkCiBybWFwX3NlZWRfaXRlcmF0b3Ioc3RydWN0IHBhZ2Vf
aW5mbyAqcGFnZSwgc3RydWN0IHJtYXBfaXRlcmF0b3IgKnJpKQogewogICAgIHJpLT5jdXJyID0g
KFJNQVBfVVNFU19IQVNIVEFCKHBhZ2UpKSA/Ci0gICAgICAgICAgICAgICAgcGFnZS0+c2hhcmlu
Zy0+aGFzaF90YWJsZS5idWNrZXQgOgotICAgICAgICAgICAgICAgICZwYWdlLT5zaGFyaW5nLT5n
Zm5zOwotICAgIHJpLT5uZXh0ID0gcmktPmN1cnItPm5leHQ7IAorICAgICAgICAgICAgICAgcGFn
ZS0+c2hhcmluZy0+aGFzaF90YWJsZS5idWNrZXQgOgorICAgICAgICAgICAgICAgJnBhZ2UtPnNo
YXJpbmctPmdmbnM7CisgICAgcmktPm5leHQgPSByaS0+Y3Vyci0+bmV4dDsKICAgICByaS0+YnVj
a2V0ID0gMDsKIH0KIApAQCAtMzc4LDggKzM3OSw4IEBAIHN0YXRpYyBpbmxpbmUgZ2ZuX2luZm9f
dCAqCiBybWFwX2l0ZXJhdGUoc3RydWN0IHBhZ2VfaW5mbyAqcGFnZSwgc3RydWN0IHJtYXBfaXRl
cmF0b3IgKnJpKQogewogICAgIHN0cnVjdCBsaXN0X2hlYWQgKmhlYWQgPSAoUk1BUF9VU0VTX0hB
U0hUQUIocGFnZSkpID8KLSAgICAgICAgICAgICAgICBwYWdlLT5zaGFyaW5nLT5oYXNoX3RhYmxl
LmJ1Y2tldCArIHJpLT5idWNrZXQgOgotICAgICAgICAgICAgICAgICZwYWdlLT5zaGFyaW5nLT5n
Zm5zOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlLT5zaGFyaW5nLT5oYXNoX3Rh
YmxlLmJ1Y2tldCArIHJpLT5idWNrZXQgOgorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAm
cGFnZS0+c2hhcmluZy0+Z2ZuczsKIAogcmV0cnk6CiAgICAgaWYgKCByaS0+bmV4dCA9PSBoZWFk
KQpAQCAtMzk0LDcgKzM5NSw4IEBAIHJldHJ5OgogICAgICAgICAgICAgcmktPmN1cnIgPSBoZWFk
OwogICAgICAgICAgICAgcmktPm5leHQgPSByaS0+Y3Vyci0+bmV4dDsKICAgICAgICAgICAgIGdv
dG8gcmV0cnk7Ci0gICAgICAgIH0gZWxzZQorICAgICAgICB9CisgICAgICAgIGVsc2UKICAgICAg
ICAgICAgIC8qIExpc3QgZXhoYXVzdGVkICovCiAgICAgICAgICAgICByZXR1cm4gTlVMTDsKICAg
ICB9CkBAIC00MDYsMTMgKzQwOCwxMyBAQCByZXRyeToKIH0KIAogc3RhdGljIGlubGluZSBnZm5f
aW5mb190ICptZW1fc2hhcmluZ19nZm5fYWxsb2Moc3RydWN0IHBhZ2VfaW5mbyAqcGFnZSwKLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBkb21h
aW4gKmQsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1
bnNpZ25lZCBsb25nIGdmbikKKyAgICAgICAgc3RydWN0IGRvbWFpbiAqZCwKKyAgICAgICAgdW5z
aWduZWQgbG9uZyBnZm4pCiB7CiAgICAgZ2ZuX2luZm9fdCAqZ2ZuX2luZm8gPSB4bWFsbG9jKGdm
bl9pbmZvX3QpOwogCiAgICAgaWYgKCBnZm5faW5mbyA9PSBOVUxMICkKLSAgICAgICAgcmV0dXJu
IE5VTEw7IAorICAgICAgICByZXR1cm4gTlVMTDsKIAogICAgIGdmbl9pbmZvLT5nZm4gPSBnZm47
CiAgICAgZ2ZuX2luZm8tPmRvbWFpbiA9IGQtPmRvbWFpbl9pZDsKQEAgLTQyNiw4ICs0MjgsOCBA
QCBzdGF0aWMgaW5saW5lIGdmbl9pbmZvX3QgKm1lbV9zaGFyaW5nX2dmbl9hbGxvYyhzdHJ1Y3Qg
cGFnZV9pbmZvICpwYWdlLAogfQogCiBzdGF0aWMgaW5saW5lIHZvaWQgbWVtX3NoYXJpbmdfZ2Zu
X2Rlc3Ryb3koc3RydWN0IHBhZ2VfaW5mbyAqcGFnZSwKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgZG9tYWluICpkLAotICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGdmbl9pbmZvX3QgKmdmbl9pbmZvKQorICAgICAgICBz
dHJ1Y3QgZG9tYWluICpkLAorICAgICAgICBnZm5faW5mb190ICpnZm5faW5mbykKIHsKICAgICAv
KiBEZWNyZW1lbnQgdGhlIG51bWJlciBvZiBwYWdlcy4gKi8KICAgICBhdG9taWNfZGVjKCZkLT5z
aHJfcGFnZXMpOwpAQCAtNDM3LDE1ICs0MzksMTUgQEAgc3RhdGljIGlubGluZSB2b2lkIG1lbV9z
aGFyaW5nX2dmbl9kZXN0cm95KHN0cnVjdCBwYWdlX2luZm8gKnBhZ2UsCiAgICAgeGZyZWUoZ2Zu
X2luZm8pOwogfQogCi1zdGF0aWMgc3RydWN0IHBhZ2VfaW5mbyogbWVtX3NoYXJpbmdfbG9va3Vw
KHVuc2lnbmVkIGxvbmcgbWZuKQorc3RhdGljIHN0cnVjdCBwYWdlX2luZm8gKm1lbV9zaGFyaW5n
X2xvb2t1cCh1bnNpZ25lZCBsb25nIG1mbikKIHsKICAgICBpZiAoIG1mbl92YWxpZChfbWZuKG1m
bikpICkKICAgICB7Ci0gICAgICAgIHN0cnVjdCBwYWdlX2luZm8qIHBhZ2UgPSBtZm5fdG9fcGFn
ZShfbWZuKG1mbikpOworICAgICAgICBzdHJ1Y3QgcGFnZV9pbmZvICpwYWdlID0gbWZuX3RvX3Bh
Z2UoX21mbihtZm4pKTsKICAgICAgICAgaWYgKCBwYWdlX2dldF9vd25lcihwYWdlKSA9PSBkb21f
Y293ICkKICAgICAgICAgewogICAgICAgICAgICAgLyogQ291bnQgaGFzIHRvIGJlIGF0IGxlYXN0
IHR3bywgYmVjYXVzZSB3ZSdyZSBjYWxsZWQKLSAgICAgICAgICAgICAqIHdpdGggdGhlIG1mbiBs
b2NrZWQgKDEpIGFuZCB0aGlzIGlzIHN1cHBvc2VkIHRvIGJlIAorICAgICAgICAgICAgICogd2l0
aCB0aGUgbWZuIGxvY2tlZCAoMSkgYW5kIHRoaXMgaXMgc3VwcG9zZWQgdG8gYmUKICAgICAgICAg
ICAgICAqIGEgc2hhcmVkIHBhZ2UgKDEpLiAqLwogICAgICAgICAgICAgdW5zaWduZWQgbG9uZyB0
ID0gcmVhZF9hdG9taWMoJnBhZ2UtPnUuaW51c2UudHlwZV9pbmZvKTsKICAgICAgICAgICAgIEFT
U0VSVCgodCAmIFBHVF90eXBlX21hc2spID09IFBHVF9zaGFyZWRfcGFnZSk7CkBAIC00ODYsNDQg
KzQ4OCw0NCBAQCBzdGF0aWMgaW50IGF1ZGl0KHZvaWQpCiAgICAgICAgIC8qIElmIHdlIGNhbid0
IGxvY2sgaXQsIGl0J3MgZGVmaW5pdGVseSBub3QgYSBzaGFyZWQgcGFnZSAqLwogICAgICAgICBp
ZiAoICFtZW1fc2hhcmluZ19wYWdlX2xvY2socGcpICkKICAgICAgICAgewotICAgICAgICAgICBN
RU1fU0hBUklOR19ERUJVRygibWZuICVseCBpbiBhdWRpdCBsaXN0LCBidXQgY2Fubm90IGJlIGxv
Y2tlZCAoJWx4KSFcbiIsCisgICAgICAgICAgICBNRU1fU0hBUklOR19ERUJVRygibWZuICVseCBp
biBhdWRpdCBsaXN0LCBidXQgY2Fubm90IGJlIGxvY2tlZCAoJWx4KSFcbiIsCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBtZm5feChtZm4pLCBwZy0+dS5pbnVzZS50eXBlX2luZm8pOwot
ICAgICAgICAgICBlcnJvcnMrKzsKLSAgICAgICAgICAgY29udGludWU7CisgICAgICAgICAgICBl
cnJvcnMrKzsKKyAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICB9CiAKLSAgICAgICAgLyog
Q2hlY2sgaWYgdGhlIE1GTiBoYXMgY29ycmVjdCB0eXBlLCBvd25lciBhbmQgaGFuZGxlLiAqLyAK
KyAgICAgICAgLyogQ2hlY2sgaWYgdGhlIE1GTiBoYXMgY29ycmVjdCB0eXBlLCBvd25lciBhbmQg
aGFuZGxlLiAqLwogICAgICAgICBpZiAoIChwZy0+dS5pbnVzZS50eXBlX2luZm8gJiBQR1RfdHlw
ZV9tYXNrKSAhPSBQR1Rfc2hhcmVkX3BhZ2UgKQogICAgICAgICB7Ci0gICAgICAgICAgIE1FTV9T
SEFSSU5HX0RFQlVHKCJtZm4gJWx4IGluIGF1ZGl0IGxpc3QsIGJ1dCBub3QgUEdUX3NoYXJlZF9w
YWdlICglbHgpIVxuIiwKKyAgICAgICAgICAgIE1FTV9TSEFSSU5HX0RFQlVHKCJtZm4gJWx4IGlu
IGF1ZGl0IGxpc3QsIGJ1dCBub3QgUEdUX3NoYXJlZF9wYWdlICglbHgpIVxuIiwKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIG1mbl94KG1mbiksIHBnLT51LmludXNlLnR5cGVfaW5mbyAm
IFBHVF90eXBlX21hc2spOwotICAgICAgICAgICBlcnJvcnMrKzsKLSAgICAgICAgICAgY29udGlu
dWU7CisgICAgICAgICAgICBlcnJvcnMrKzsKKyAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAg
ICB9CiAKICAgICAgICAgLyogQ2hlY2sgdGhlIHBhZ2Ugb3duZXIuICovCiAgICAgICAgIGlmICgg
cGFnZV9nZXRfb3duZXIocGcpICE9IGRvbV9jb3cgKQogICAgICAgICB7Ci0gICAgICAgICAgIE1F
TV9TSEFSSU5HX0RFQlVHKCJtZm4gJWx4IHNoYXJlZCwgYnV0IHdyb25nIG93bmVyICglaHUpIVxu
IiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWZuX3gobWZuKSwgcGFnZV9nZXRfb3du
ZXIocGcpLT5kb21haW5faWQpOwotICAgICAgICAgICBlcnJvcnMrKzsKKyAgICAgICAgICAgIE1F
TV9TSEFSSU5HX0RFQlVHKCJtZm4gJWx4IHNoYXJlZCwgYnV0IHdyb25nIG93bmVyICglaHUpIVxu
IiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1mbl94KG1mbiksIHBhZ2VfZ2V0X293
bmVyKHBnKS0+ZG9tYWluX2lkKTsKKyAgICAgICAgICAgIGVycm9ycysrOwogICAgICAgICB9CiAK
ICAgICAgICAgLyogQ2hlY2sgdGhlIG0ycCBlbnRyeSAqLwogICAgICAgICBpZiAoICFTSEFSRURf
TTJQKGdldF9ncGZuX2Zyb21fbWZuKG1mbl94KG1mbikpKSApCiAgICAgICAgIHsKLSAgICAgICAg
ICAgTUVNX1NIQVJJTkdfREVCVUcoIm1mbiAlbHggc2hhcmVkLCBidXQgd3JvbmcgbTJwIGVudHJ5
ICglbHgpIVxuIiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWZuX3gobWZuKSwgZ2V0
X2dwZm5fZnJvbV9tZm4obWZuX3gobWZuKSkpOwotICAgICAgICAgICBlcnJvcnMrKzsKKyAgICAg
ICAgICAgIE1FTV9TSEFSSU5HX0RFQlVHKCJtZm4gJWx4IHNoYXJlZCwgYnV0IHdyb25nIG0ycCBl
bnRyeSAoJWx4KSFcbiIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZm5feChtZm4p
LCBnZXRfZ3Bmbl9mcm9tX21mbihtZm5feChtZm4pKSk7CisgICAgICAgICAgICBlcnJvcnMrKzsK
ICAgICAgICAgfQogCiAgICAgICAgIC8qIENoZWNrIHdlIGhhdmUgYSBsaXN0ICovCiAgICAgICAg
IGlmICggKCFwZy0+c2hhcmluZykgfHwgIXJtYXBfaGFzX2VudHJpZXMocGcpICkKICAgICAgICAg
ewotICAgICAgICAgICBNRU1fU0hBUklOR19ERUJVRygibWZuICVseCBzaGFyZWQsIGJ1dCBlbXB0
eSBnZm4gbGlzdCFcbiIsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1mbl94KG1mbikp
OwotICAgICAgICAgICBlcnJvcnMrKzsKLSAgICAgICAgICAgY29udGludWU7CisgICAgICAgICAg
ICBNRU1fU0hBUklOR19ERUJVRygibWZuICVseCBzaGFyZWQsIGJ1dCBlbXB0eSBnZm4gbGlzdCFc
biIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZm5feChtZm4pKTsKKyAgICAgICAg
ICAgIGVycm9ycysrOworICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgIH0KIAogICAgICAg
ICAvKiBXZSd2ZSBmb3VuZCBhIHBhZ2UgdGhhdCBpcyBzaGFyZWQgKi8KQEAgLTU0NSw3ICs1NDcs
NyBAQCBzdGF0aWMgaW50IGF1ZGl0KHZvaWQpCiAgICAgICAgICAgICAgICAgZXJyb3JzKys7CiAg
ICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICB9Ci0gICAgICAgICAgICBvX21m
biA9IGdldF9nZm5fcXVlcnlfdW5sb2NrZWQoZCwgZy0+Z2ZuLCAmdCk7IAorICAgICAgICAgICAg
b19tZm4gPSBnZXRfZ2ZuX3F1ZXJ5X3VubG9ja2VkKGQsIGctPmdmbiwgJnQpOwogICAgICAgICAg
ICAgaWYgKCAhbWZuX2VxKG9fbWZuLCBtZm4pICkKICAgICAgICAgICAgIHsKICAgICAgICAgICAg
ICAgICBNRU1fU0hBUklOR19ERUJVRygiSW5jb3JyZWN0IFAyTSBmb3IgZD0laHUsIFBGTj0lbHgu
IgpAQCAtNTY4LDcgKzU3MCw3IEBAIHN0YXRpYyBpbnQgYXVkaXQodm9pZCkKICAgICAgICAgewog
ICAgICAgICAgICAgTUVNX1NIQVJJTkdfREVCVUcoIk1pc21hdGNoZWQgY291bnRzIGZvciBNRk49
JWx4LiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJucl9nZm5zIGluIGxpc3QgJWx1
LCBpbiB0eXBlX2luZm8gJWx4XG4iLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWZu
X3gobWZuKSwgbnJfZ2ZucywgCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZm5feCht
Zm4pLCBucl9nZm5zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHBnLT51LmludXNl
LnR5cGVfaW5mbyAmIFBHVF9jb3VudF9tYXNrKSk7CiAgICAgICAgICAgICBlcnJvcnMrKzsKICAg
ICAgICAgfQpAQCAtNTk2LDE1ICs1OTgsMTYgQEAgaW50IG1lbV9zaGFyaW5nX25vdGlmeV9lbm9t
ZW0oc3RydWN0IGRvbWFpbiAqZCwgdW5zaWduZWQgbG9uZyBnZm4sCiB7CiAgICAgc3RydWN0IHZj
cHUgKnYgPSBjdXJyZW50OwogICAgIGludCByYzsKLSAgICB2bV9ldmVudF9yZXF1ZXN0X3QgcmVx
ID0geworICAgIHZtX2V2ZW50X3JlcXVlc3RfdCByZXEgPQorICAgIHsKICAgICAgICAgLnJlYXNv
biA9IFZNX0VWRU5UX1JFQVNPTl9NRU1fU0hBUklORywKICAgICAgICAgLnZjcHVfaWQgPSB2LT52
Y3B1X2lkLAogICAgICAgICAudS5tZW1fc2hhcmluZy5nZm4gPSBnZm4sCiAgICAgICAgIC51Lm1l
bV9zaGFyaW5nLnAybXQgPSBwMm1fcmFtX3NoYXJlZAogICAgIH07CiAKLSAgICBpZiAoIChyYyA9
IF9fdm1fZXZlbnRfY2xhaW1fc2xvdChkLCAKLSAgICAgICAgICAgICAgICAgICAgICAgIGQtPnZt
X2V2ZW50X3NoYXJlLCBhbGxvd19zbGVlcCkpIDwgMCApCisgICAgaWYgKCAocmMgPSBfX3ZtX2V2
ZW50X2NsYWltX3Nsb3QoZCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBk
LT52bV9ldmVudF9zaGFyZSwgYWxsb3dfc2xlZXApKSA8IDAgKQogICAgICAgICByZXR1cm4gcmM7
CiAKICAgICBpZiAoIHYtPmRvbWFpbiA9PSBkICkKQEAgLTYyOSw5ICs2MzIsOSBAQCB1bnNpZ25l
ZCBpbnQgbWVtX3NoYXJpbmdfZ2V0X25yX3NoYXJlZF9tZm5zKHZvaWQpCiB9CiAKIC8qIEZ1bmN0
aW9ucyB0aGF0IGNoYW5nZSBhIHBhZ2UncyB0eXBlIGFuZCBvd25lcnNoaXAgKi8KLXN0YXRpYyBp
bnQgcGFnZV9tYWtlX3NoYXJhYmxlKHN0cnVjdCBkb21haW4gKmQsIAotICAgICAgICAgICAgICAg
ICAgICAgICBzdHJ1Y3QgcGFnZV9pbmZvICpwYWdlLCAKLSAgICAgICAgICAgICAgICAgICAgICAg
aW50IGV4cGVjdGVkX3JlZmNudCkKK3N0YXRpYyBpbnQgcGFnZV9tYWtlX3NoYXJhYmxlKHN0cnVj
dCBkb21haW4gKmQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgcGFnZV9p
bmZvICpwYWdlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IGV4cGVjdGVkX3Jl
ZmNudCkKIHsKICAgICBib29sX3QgZHJvcF9kb21fcmVmOwogCkBAIC02ODQsNyArNjg3LDcgQEAg
c3RhdGljIGludCBwYWdlX21ha2VfcHJpdmF0ZShzdHJ1Y3QgZG9tYWluICpkLCBzdHJ1Y3QgcGFn
ZV9pbmZvICpwYWdlKQogCiAgICAgaWYgKCAhZ2V0X3BhZ2UocGFnZSwgZG9tX2NvdykgKQogICAg
ICAgICByZXR1cm4gLUVJTlZBTDsKLSAgICAKKwogICAgIHNwaW5fbG9jaygmZC0+cGFnZV9hbGxv
Y19sb2NrKTsKIAogICAgIGlmICggZC0+aXNfZHlpbmcgKQpAQCAtNzI5LDcgKzczMiw3IEBAIHN0
YXRpYyBpbmxpbmUgc3RydWN0IHBhZ2VfaW5mbyAqX19ncmFiX3NoYXJlZF9wYWdlKG1mbl90IG1m
bikKICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAgcGcgPSBtZm5fdG9fcGFnZShtZm4pOwogCi0g
ICAgLyogSWYgdGhlIHBhZ2UgaXMgbm90IHZhbGlkYXRlZCB3ZSBjYW4ndCBsb2NrIGl0LCBhbmQg
aWYgaXQncyAgCisgICAgLyogSWYgdGhlIHBhZ2UgaXMgbm90IHZhbGlkYXRlZCB3ZSBjYW4ndCBs
b2NrIGl0LCBhbmQgaWYgaXQncwogICAgICAqIG5vdCB2YWxpZGF0ZWQgaXQncyBvYnZpb3VzbHkg
bm90IHNoYXJlZC4gKi8KICAgICBpZiAoICFtZW1fc2hhcmluZ19wYWdlX2xvY2socGcpICkKICAg
ICAgICAgcmV0dXJuIE5VTEw7CkBAIC03NTQsMTIgKzc1NywxMiBAQCBzdGF0aWMgaW50IGRlYnVn
X21mbihtZm5fdCBtZm4pCiAgICAgICAgIHJldHVybiAtRUlOVkFMOwogICAgIH0KIAotICAgIE1F
TV9TSEFSSU5HX0RFQlVHKCAKLSAgICAgICAgICAgICJEZWJ1ZyBwYWdlOiBNRk49JWx4IGlzIGNp
PSVseCwgdGk9JWx4LCBvd25lcl9pZD0lZFxuIiwKLSAgICAgICAgICAgIG1mbl94KHBhZ2VfdG9f
bWZuKHBhZ2UpKSwgCi0gICAgICAgICAgICBwYWdlLT5jb3VudF9pbmZvLCAKLSAgICAgICAgICAg
IHBhZ2UtPnUuaW51c2UudHlwZV9pbmZvLAotICAgICAgICAgICAgcGFnZV9nZXRfb3duZXIocGFn
ZSktPmRvbWFpbl9pZCk7CisgICAgTUVNX1NIQVJJTkdfREVCVUcoCisgICAgICAgICJEZWJ1ZyBw
YWdlOiBNRk49JWx4IGlzIGNpPSVseCwgdGk9JWx4LCBvd25lcl9pZD0lZFxuIiwKKyAgICAgICAg
bWZuX3gocGFnZV90b19tZm4ocGFnZSkpLAorICAgICAgICBwYWdlLT5jb3VudF9pbmZvLAorICAg
ICAgICBwYWdlLT51LmludXNlLnR5cGVfaW5mbywKKyAgICAgICAgcGFnZV9nZXRfb3duZXIocGFn
ZSktPmRvbWFpbl9pZCk7CiAKICAgICAvKiAtMSBiZWNhdXNlIHRoZSBwYWdlIGlzIGxvY2tlZCBh
bmQgdGhhdCdzIGFuIGFkZGl0aW9uYWwgdHlwZSByZWYgKi8KICAgICBudW1fcmVmcyA9ICgoaW50
KSAocGFnZS0+dS5pbnVzZS50eXBlX2luZm8gJiBQR1RfY291bnRfbWFzaykpIC0gMTsKQEAgLTc3
NSw3ICs3NzgsNyBAQCBzdGF0aWMgaW50IGRlYnVnX2dmbihzdHJ1Y3QgZG9tYWluICpkLCBnZm5f
dCBnZm4pCiAKICAgICBtZm4gPSBnZXRfZ2ZuX3F1ZXJ5KGQsIGdmbl94KGdmbiksICZwMm10KTsK
IAotICAgIE1FTV9TSEFSSU5HX0RFQlVHKCJEZWJ1ZyBmb3IgZG9tJWQsIGdmbj0lIiBQUklfZ2Zu
ICJcbiIsIAorICAgIE1FTV9TSEFSSU5HX0RFQlVHKCJEZWJ1ZyBmb3IgZG9tJWQsIGdmbj0lIiBQ
UklfZ2ZuICJcbiIsCiAgICAgICAgICAgICAgICAgICAgICAgZC0+ZG9tYWluX2lkLCBnZm5feChn
Zm4pKTsKICAgICBudW1fcmVmcyA9IGRlYnVnX21mbihtZm4pOwogICAgIHB1dF9nZm4oZCwgZ2Zu
X3goZ2ZuKSk7CkBAIC03OTYsMTAgKzc5OSwxMCBAQCBzdGF0aWMgaW50IGRlYnVnX2dyZWYoc3Ry
dWN0IGRvbWFpbiAqZCwgZ3JhbnRfcmVmX3QgcmVmKQogICAgICAgICAgICAgICAgICAgICAgICAg
ICBkLT5kb21haW5faWQsIHJlZiwgcmMpOwogICAgICAgICByZXR1cm4gcmM7CiAgICAgfQotICAg
IAorCiAgICAgTUVNX1NIQVJJTkdfREVCVUcoCi0gICAgICAgICAgICAiPT0+IEdyYW50IFtkb209
JWQscmVmPSVkXSwgc3RhdHVzPSV4LiAiLCAKLSAgICAgICAgICAgIGQtPmRvbWFpbl9pZCwgcmVm
LCBzdGF0dXMpOworICAgICAgICAiPT0+IEdyYW50IFtkb209JWQscmVmPSVkXSwgc3RhdHVzPSV4
LiAiLAorICAgICAgICBkLT5kb21haW5faWQsIHJlZiwgc3RhdHVzKTsKIAogICAgIHJldHVybiBk
ZWJ1Z19nZm4oZCwgZ2ZuKTsKIH0KQEAgLTgyNCwxMiArODI3LDE0IEBAIHN0YXRpYyBpbnQgbm9t
aW5hdGVfcGFnZShzdHJ1Y3QgZG9tYWluICpkLCBnZm5fdCBnZm4sCiAgICAgICAgIGdvdG8gb3V0
OwogCiAgICAgLyogUmV0dXJuIHRoZSBoYW5kbGUgaWYgdGhlIHBhZ2UgaXMgYWxyZWFkeSBzaGFy
ZWQgKi8KLSAgICBpZiAoIHAybV9pc19zaGFyZWQocDJtdCkgKSB7CisgICAgaWYgKCBwMm1faXNf
c2hhcmVkKHAybXQpICkKKyAgICB7CiAgICAgICAgIHN0cnVjdCBwYWdlX2luZm8gKnBnID0gX19n
cmFiX3NoYXJlZF9wYWdlKG1mbik7CiAgICAgICAgIGlmICggIXBnICkKICAgICAgICAgewogICAg
ICAgICAgICAgZ3ByaW50ayhYRU5MT0dfRVJSLAotICAgICAgICAgICAgICAgICAgICAiU2hhcmVk
IHAybSBlbnRyeSBnZm4gJSIgUFJJX2dmbiAiLCBidXQgY291bGQgbm90IGdyYWIgbWZuICUiIFBS
SV9tZm4gIiBkb20lZFxuIiwKKyAgICAgICAgICAgICAgICAgICAgIlNoYXJlZCBwMm0gZW50cnkg
Z2ZuICUiIFBSSV9nZm4gIiwgYnV0IGNvdWxkIG5vdCBncmFiIG1mbiAlIiBQUklfbWZuCisgICAg
ICAgICAgICAgICAgICAgICIgZG9tJWRcbiIsCiAgICAgICAgICAgICAgICAgICAgIGdmbl94KGdm
biksIG1mbl94KG1mbiksIGQtPmRvbWFpbl9pZCk7CiAgICAgICAgICAgICBCVUcoKTsKICAgICAg
ICAgfQpAQCAtODc2LDEyICs4ODEsMTIgQEAgc3RhdGljIGludCBub21pbmF0ZV9wYWdlKHN0cnVj
dCBkb21haW4gKmQsIGdmbl90IGdmbiwKIAogICAgIC8qIFRyeSB0byBjb252ZXJ0IHRoZSBtZm4g
dG8gdGhlIHNoYXJhYmxlIHR5cGUgKi8KICAgICBwYWdlID0gbWZuX3RvX3BhZ2UobWZuKTsKLSAg
ICByZXQgPSBwYWdlX21ha2Vfc2hhcmFibGUoZCwgcGFnZSwgZXhwZWN0ZWRfcmVmY250KTsgCi0g
ICAgaWYgKCByZXQgKSAKKyAgICByZXQgPSBwYWdlX21ha2Vfc2hhcmFibGUoZCwgcGFnZSwgZXhw
ZWN0ZWRfcmVmY250KTsKKyAgICBpZiAoIHJldCApCiAgICAgICAgIGdvdG8gb3V0OwogCi0gICAg
LyogTm93IHRoYXQgdGhlIHBhZ2UgaXMgdmFsaWRhdGVkLCB3ZSBjYW4gbG9jayBpdC4gVGhlcmUg
aXMgbm8gCi0gICAgICogcmFjZSBiZWNhdXNlIHdlJ3JlIGhvbGRpbmcgdGhlIHAybSBlbnRyeSwg
c28gbm8gb25lIGVsc2UgCisgICAgLyogTm93IHRoYXQgdGhlIHBhZ2UgaXMgdmFsaWRhdGVkLCB3
ZSBjYW4gbG9jayBpdC4gVGhlcmUgaXMgbm8KKyAgICAgKiByYWNlIGJlY2F1c2Ugd2UncmUgaG9s
ZGluZyB0aGUgcDJtIGVudHJ5LCBzbyBubyBvbmUgZWxzZQogICAgICAqIGNvdWxkIGJlIG5vbWlu
YXRpbmcgdGhpcyBnZm4gKi8KICAgICByZXQgPSAtRU5PRU5UOwogICAgIGlmICggIW1lbV9zaGFy
aW5nX3BhZ2VfbG9jayhwYWdlKSApCkBAIC04ODksOCArODk0LDggQEAgc3RhdGljIGludCBub21p
bmF0ZV9wYWdlKHN0cnVjdCBkb21haW4gKmQsIGdmbl90IGdmbiwKIAogICAgIC8qIEluaXRpYWxp
emUgdGhlIHNoYXJlZCBzdGF0ZSAqLwogICAgIHJldCA9IC1FTk9NRU07Ci0gICAgaWYgKCAocGFn
ZS0+c2hhcmluZyA9IAotICAgICAgICAgICAgeG1hbGxvYyhzdHJ1Y3QgcGFnZV9zaGFyaW5nX2lu
Zm8pKSA9PSBOVUxMICkKKyAgICBpZiAoIChwYWdlLT5zaGFyaW5nID0KKyAgICAgICAgICAgICAg
ICB4bWFsbG9jKHN0cnVjdCBwYWdlX3NoYXJpbmdfaW5mbykpID09IE5VTEwgKQogICAgIHsKICAg
ICAgICAgLyogTWFraW5nIGEgcGFnZSBwcml2YXRlIGF0b21pY2FsbHkgdW5sb2NrcyBpdCAqLwog
ICAgICAgICBCVUdfT04ocGFnZV9tYWtlX3ByaXZhdGUoZCwgcGFnZSkgIT0gMCk7CkBAIC05MDAs
NyArOTA1LDcgQEAgc3RhdGljIGludCBub21pbmF0ZV9wYWdlKHN0cnVjdCBkb21haW4gKmQsIGdm
bl90IGdmbiwKICAgICBybWFwX2luaXQocGFnZSk7CiAKICAgICAvKiBDcmVhdGUgdGhlIGhhbmRs
ZSAqLwotICAgIHBhZ2UtPnNoYXJpbmctPmhhbmRsZSA9IGdldF9uZXh0X2hhbmRsZSgpOyAgCisg
ICAgcGFnZS0+c2hhcmluZy0+aGFuZGxlID0gZ2V0X25leHRfaGFuZGxlKCk7CiAKICAgICAvKiBD
cmVhdGUgdGhlIGxvY2FsIGdmbiBpbmZvICovCiAgICAgaWYgKCBtZW1fc2hhcmluZ19nZm5fYWxs
b2MocGFnZSwgZCwgZ2ZuX3goZ2ZuKSkgPT0gTlVMTCApCkBAIC05NDYsNyArOTUxLDcgQEAgc3Rh
dGljIGludCBzaGFyZV9wYWdlcyhzdHJ1Y3QgZG9tYWluICpzZCwgZ2ZuX3Qgc2dmbiwgc2hyX2hh
bmRsZV90IHNoLAogICAgIGdldF90d29fZ2ZucyhzZCwgc2dmbiwgJnNtZm5fdHlwZSwgTlVMTCwg
JnNtZm4sCiAgICAgICAgICAgICAgICAgIGNkLCBjZ2ZuLCAmY21mbl90eXBlLCBOVUxMLCAmY21m
biwgMCwgJnRnKTsKIAotICAgIC8qIFRoaXMgdHJpY2t5IGJ1c2luZXNzIGlzIHRvIGF2b2lkIHR3
byBjYWxsZXJzIGRlYWRsb2NraW5nIGlmIAorICAgIC8qIFRoaXMgdHJpY2t5IGJ1c2luZXNzIGlz
IHRvIGF2b2lkIHR3byBjYWxsZXJzIGRlYWRsb2NraW5nIGlmCiAgICAgICogZ3JhYmJpbmcgcGFn
ZXMgaW4gb3Bwb3NpdGUgY2xpZW50L3NvdXJjZSBvcmRlciAqLwogICAgIGlmICggbWZuX2VxKHNt
Zm4sIGNtZm4pICkKICAgICB7CkBAIC05NzIsNyArOTc3LDkgQEAgc3RhdGljIGludCBzaGFyZV9w
YWdlcyhzdHJ1Y3QgZG9tYWluICpzZCwgZ2ZuX3Qgc2dmbiwgc2hyX2hhbmRsZV90IHNoLAogICAg
ICAgICAgICAgbWVtX3NoYXJpbmdfcGFnZV91bmxvY2soc3BhZ2UpOwogICAgICAgICAgICAgZ290
byBlcnJfb3V0OwogICAgICAgICB9Ci0gICAgfSBlbHNlIHsKKyAgICB9CisgICAgZWxzZQorICAg
IHsKICAgICAgICAgcmV0ID0gWEVOTUVNX1NIQVJJTkdfT1BfQ19IQU5ETEVfSU5WQUxJRDsKICAg
ICAgICAgY3BhZ2UgPSBmaXJzdHBnID0gX19ncmFiX3NoYXJlZF9wYWdlKGNtZm4pOwogICAgICAg
ICBpZiAoIGNwYWdlID09IE5VTEwgKQpAQCAtMTAxMCw3ICsxMDE3LDcgQEAgc3RhdGljIGludCBz
aGFyZV9wYWdlcyhzdHJ1Y3QgZG9tYWluICpzZCwgZ2ZuX3Qgc2dmbiwgc2hyX2hhbmRsZV90IHNo
LAogICAgIHJtYXBfc2VlZF9pdGVyYXRvcihjcGFnZSwgJnJpKTsKICAgICB3aGlsZSAoIChnZm4g
PSBybWFwX2l0ZXJhdGUoY3BhZ2UsICZyaSkpICE9IE5VTEwpCiAgICAgewotICAgICAgICAvKiBH
ZXQgdGhlIHNvdXJjZSBwYWdlIGFuZCB0eXBlLCB0aGlzIHNob3VsZCBuZXZlciBmYWlsOiAKKyAg
ICAgICAgLyogR2V0IHRoZSBzb3VyY2UgcGFnZSBhbmQgdHlwZSwgdGhpcyBzaG91bGQgbmV2ZXIg
ZmFpbDoKICAgICAgICAgICogd2UgYXJlIHVuZGVyIHNociBsb2NrLCBhbmQgZ290IGEgc3VjY2Vz
c2Z1bCBsb29rdXAgKi8KICAgICAgICAgQlVHX09OKCFnZXRfcGFnZV9hbmRfdHlwZShzcGFnZSwg
ZG9tX2NvdywgUEdUX3NoYXJlZF9wYWdlKSk7CiAgICAgICAgIC8qIE1vdmUgdGhlIGdmbl9pbmZv
IGZyb20gY2xpZW50IGxpc3QgdG8gc291cmNlIGxpc3QuCkBAIC0xMDQzLDE0ICsxMDUwLDE1IEBA
IHN0YXRpYyBpbnQgc2hhcmVfcGFnZXMoc3RydWN0IGRvbWFpbiAqc2QsIGdmbl90IHNnZm4sIHNo
cl9oYW5kbGVfdCBzaCwKICAgICBhdG9taWNfZGVjKCZucl9zaGFyZWRfbWZucyk7CiAgICAgYXRv
bWljX2luYygmbnJfc2F2ZWRfbWZucyk7CiAgICAgcmV0ID0gMDsKLSAgICAKKwogZXJyX291dDoK
ICAgICBwdXRfdHdvX2dmbnMoJnRnKTsKICAgICByZXR1cm4gcmV0OwogfQogCi1pbnQgbWVtX3No
YXJpbmdfYWRkX3RvX3BoeXNtYXAoc3RydWN0IGRvbWFpbiAqc2QsIHVuc2lnbmVkIGxvbmcgc2dm
biwgc2hyX2hhbmRsZV90IHNoLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBk
b21haW4gKmNkLCB1bnNpZ25lZCBsb25nIGNnZm4pIAoraW50IG1lbV9zaGFyaW5nX2FkZF90b19w
aHlzbWFwKHN0cnVjdCBkb21haW4gKnNkLCB1bnNpZ25lZCBsb25nIHNnZm4sCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgc2hyX2hhbmRsZV90IHNoLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHN0cnVjdCBkb21haW4gKmNkLCB1bnNpZ25lZCBsb25nIGNnZm4pCiB7CiAg
ICAgc3RydWN0IHBhZ2VfaW5mbyAqc3BhZ2U7CiAgICAgaW50IHJldCA9IC1FSU5WQUw7CkBAIC0x
MTAxLDcgKzExMDksOSBAQCBpbnQgbWVtX3NoYXJpbmdfYWRkX3RvX3BoeXNtYXAoc3RydWN0IGRv
bWFpbiAqc2QsIHVuc2lnbmVkIGxvbmcgc2dmbiwgc2hyX2hhbmRsZQogICAgIHsKICAgICAgICAg
bWVtX3NoYXJpbmdfZ2ZuX2Rlc3Ryb3koc3BhZ2UsIGNkLCBnZm5faW5mbyk7CiAgICAgICAgIHB1
dF9wYWdlX2FuZF90eXBlKHNwYWdlKTsKLSAgICB9IGVsc2UgeworICAgIH0KKyAgICBlbHNlCisg
ICAgewogICAgICAgICAvKiBUaGVyZSBpcyBhIGNoYW5jZSB3ZSdyZSBwbHVnZ2luZyBhIGhvbGUg
d2hlcmUgYSBwYWdlZCBvdXQgcGFnZSB3YXMgKi8KICAgICAgICAgaWYgKCBwMm1faXNfcGFnaW5n
KGNtZm5fdHlwZSkgJiYgKGNtZm5fdHlwZSAhPSBwMm1fcmFtX3BhZ2luZ19vdXQpICkKICAgICAg
ICAgewpAQCAtMTEzNiwxMCArMTE0NiwxMCBAQCBlcnJfb3V0OgogLyogQSBub3RlIG9uIHRoZSBy
YXRpb25hbGUgZm9yIHVuc2hhcmUgZXJyb3IgaGFuZGxpbmc6CiAgKiAgMS4gVW5zaGFyZSBjYW4g
b25seSBmYWlsIHdpdGggRU5PTUVNLiBBbnkgb3RoZXIgZXJyb3IgY29uZGl0aW9ucyBCVUdfT04o
KSdzCiAgKiAgMi4gV2Ugbm90aWZ5IGEgcG90ZW50aWFsIGRvbTAgaGVscGVyIHRocm91Z2ggYSB2
bV9ldmVudCByaW5nLiBCdXQgd2UKLSAqICAgICBhbGxvdyB0aGUgbm90aWZpY2F0aW9uIHRvIG5v
dCBnbyB0byBzbGVlcC4gSWYgdGhlIGV2ZW50IHJpbmcgaXMgZnVsbCAKKyAqICAgICBhbGxvdyB0
aGUgbm90aWZpY2F0aW9uIHRvIG5vdCBnbyB0byBzbGVlcC4gSWYgdGhlIGV2ZW50IHJpbmcgaXMg
ZnVsbAogICogICAgIG9mIEVOT01FTSB3YXJuaW5ncywgdGhlbiBpdCdzIG9uIHRoZSBiYWxsLgog
ICogIDMuIFdlIGNhbm5vdCBnbyB0byBzbGVlcCB1bnRpbCB0aGUgdW5zaGFyZSBpcyByZXNvbHZl
ZCwgYmVjYXVzZSB3ZSBtaWdodAotICogICAgIGJlIGJ1cmllZCBkZWVwIGludG8gbG9ja3MgKGUu
Zy4gc29tZXRoaW5nIC0+IGNvcHlfdG9fdXNlciAtPiBfX2h2bV9jb3B5KSAKKyAqICAgICBiZSBi
dXJpZWQgZGVlcCBpbnRvIGxvY2tzIChlLmcuIHNvbWV0aGluZyAtPiBjb3B5X3RvX3VzZXIgLT4g
X19odm1fY29weSkKICAqICA0LiBTbywgd2UgbWFrZSBzdXJlIHdlOgogICogICAgIDQuMS4gcmV0
dXJuIGFuIGVycm9yCiAgKiAgICAgNC4yLiBkbyBub3QgY29ycnVwdCBzaGFyZWQgbWVtb3J5CkBA
IC0xMTQ3LDE5ICsxMTU3LDIwIEBAIGVycl9vdXQ6CiAgKiAgICAgNC40LiBsZXQgdGhlIGd1ZXN0
IGRlYWwgd2l0aCBpdCBpZiB0aGUgZXJyb3IgcHJvcGFnYXRpb24gd2lsbCByZWFjaCBpdAogICov
CiBpbnQgX19tZW1fc2hhcmluZ191bnNoYXJlX3BhZ2Uoc3RydWN0IGRvbWFpbiAqZCwKLSAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgbG9uZyBnZm4sIAotICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICB1aW50MTZfdCBmbGFncykKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICB1bnNpZ25lZCBsb25nIGdmbiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICB1aW50MTZfdCBmbGFncykKIHsKICAgICBwMm1fdHlwZV90IHAybXQ7CiAgICAgbWZuX3QgbWZu
OwogICAgIHN0cnVjdCBwYWdlX2luZm8gKnBhZ2UsICpvbGRfcGFnZTsKICAgICBpbnQgbGFzdF9n
Zm47CiAgICAgZ2ZuX2luZm9fdCAqZ2ZuX2luZm8gPSBOVUxMOwotICAgCisKICAgICBtZm4gPSBn
ZXRfZ2ZuKGQsIGdmbiwgJnAybXQpOwotICAgIAorCiAgICAgLyogSGFzIHNvbWVvbmUgYWxyZWFk
eSB1bnNoYXJlZCBpdD8gKi8KLSAgICBpZiAoICFwMm1faXNfc2hhcmVkKHAybXQpICkgeworICAg
IGlmICggIXAybV9pc19zaGFyZWQocDJtdCkgKQorICAgIHsKICAgICAgICAgcHV0X2dmbihkLCBn
Zm4pOwogICAgICAgICByZXR1cm4gMDsKICAgICB9CkBAIC0xMTY4LDcgKzExNzksNyBAQCBpbnQg
X19tZW1fc2hhcmluZ191bnNoYXJlX3BhZ2Uoc3RydWN0IGRvbWFpbiAqZCwKICAgICBpZiAoIHBh
Z2UgPT0gTlVMTCApCiAgICAgewogICAgICAgICBnZHByaW50ayhYRU5MT0dfRVJSLCAiRG9tYWlu
IHAybSBpcyBzaGFyZWQsIGJ1dCBwYWdlIGlzIG5vdDogIgotICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAiJWx4XG4iLCBnZm4pOworICAgICAgICAgICAgICAgICAiJWx4XG4iLCBnZm4p
OwogICAgICAgICBCVUcoKTsKICAgICB9CiAKQEAgLTExNzYsMTIgKzExODcsMTIgQEAgaW50IF9f
bWVtX3NoYXJpbmdfdW5zaGFyZV9wYWdlKHN0cnVjdCBkb21haW4gKmQsCiAgICAgaWYgKCB1bmxp
a2VseShnZm5faW5mbyA9PSBOVUxMKSApCiAgICAgewogICAgICAgICBnZHByaW50ayhYRU5MT0df
RVJSLCAiQ291bGQgbm90IGZpbmQgZ2ZuX2luZm8gZm9yIHNoYXJlZCBnZm46ICIKLSAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIiVseFxuIiwgZ2ZuKTsKKyAgICAgICAgICAgICAgICAg
IiVseFxuIiwgZ2ZuKTsKICAgICAgICAgQlVHKCk7CiAgICAgfQogCiAgICAgLyogRG8gdGhlIGFj
Y291bnRpbmcgZmlyc3QuIElmIGFueXRoaW5nIGZhaWxzIGJlbG93LCB3ZSBoYXZlIGJpZ2dlcgot
ICAgICAqIGJpZ2dlciBmaXNoIHRvIGZyeS4gRmlyc3QsIHJlbW92ZSB0aGUgZ2ZuIGZyb20gdGhl
IGxpc3QuICovIAorICAgICAqIGJpZ2dlciBmaXNoIHRvIGZyeS4gRmlyc3QsIHJlbW92ZSB0aGUg
Z2ZuIGZyb20gdGhlIGxpc3QuICovCiAgICAgbGFzdF9nZm4gPSBybWFwX2hhc19vbmVfZW50cnko
cGFnZSk7CiAgICAgaWYgKCBsYXN0X2dmbiApCiAgICAgewpAQCAtMTE5NSw3ICsxMjA2LDcgQEAg
aW50IF9fbWVtX3NoYXJpbmdfdW5zaGFyZV9wYWdlKHN0cnVjdCBkb21haW4gKmQsCiAgICAgZWxz
ZQogICAgICAgICBhdG9taWNfZGVjKCZucl9zYXZlZF9tZm5zKTsKIAotICAgIC8qIElmIHRoZSBH
Rk4gaXMgZ2V0dGluZyBkZXN0cm95ZWQgZHJvcCB0aGUgcmVmZXJlbmNlcyB0byBNRk4gCisgICAg
LyogSWYgdGhlIEdGTiBpcyBnZXR0aW5nIGRlc3Ryb3llZCBkcm9wIHRoZSByZWZlcmVuY2VzIHRv
IE1GTgogICAgICAqIChwb3NzaWJseSBmcmVlaW5nIHRoZSBwYWdlKSwgYW5kIGV4aXQgZWFybHkg
Ki8KICAgICBpZiAoIGZsYWdzICYgTUVNX1NIQVJJTkdfREVTVFJPWV9HRk4gKQogICAgIHsKQEAg
LTEyMTIsNyArMTIyMyw3IEBAIGludCBfX21lbV9zaGFyaW5nX3Vuc2hhcmVfcGFnZShzdHJ1Y3Qg
ZG9tYWluICpkLAogCiAgICAgICAgIHJldHVybiAwOwogICAgIH0KLSAKKwogICAgIGlmICggbGFz
dF9nZm4gKQogICAgIHsKICAgICAgICAgLyogTWFraW5nIGEgcGFnZSBwcml2YXRlIGF0b21pY2Fs
bHkgdW5sb2NrcyBpdCAqLwpAQCAtMTIyMiw3ICsxMjMzLDcgQEAgaW50IF9fbWVtX3NoYXJpbmdf
dW5zaGFyZV9wYWdlKHN0cnVjdCBkb21haW4gKmQsCiAKICAgICBvbGRfcGFnZSA9IHBhZ2U7CiAg
ICAgcGFnZSA9IGFsbG9jX2RvbWhlYXBfcGFnZShkLCAwKTsKLSAgICBpZiAoICFwYWdlICkgCisg
ICAgaWYgKCAhcGFnZSApCiAgICAgewogICAgICAgICAvKiBVbmRvIGRlYyBvZiBucl9zYXZlZF9t
Zm5zLCBhcyB0aGUgcmV0cnkgd2lsbCBkZWNyZWFzZSBhZ2Fpbi4gKi8KICAgICAgICAgYXRvbWlj
X2luYygmbnJfc2F2ZWRfbWZucyk7CkBAIC0xMjQwLDExICsxMjUxLDExIEBAIGludCBfX21lbV9z
aGFyaW5nX3Vuc2hhcmVfcGFnZShzdHJ1Y3QgZG9tYWluICpkLAogICAgIG1lbV9zaGFyaW5nX3Bh
Z2VfdW5sb2NrKG9sZF9wYWdlKTsKICAgICBwdXRfcGFnZV9hbmRfdHlwZShvbGRfcGFnZSk7CiAK
LXByaXZhdGVfcGFnZV9mb3VuZDogICAgCitwcml2YXRlX3BhZ2VfZm91bmQ6CiAgICAgaWYgKCBw
Mm1fY2hhbmdlX3R5cGVfb25lKGQsIGdmbiwgcDJtX3JhbV9zaGFyZWQsIHAybV9yYW1fcncpICkK
ICAgICB7Ci0gICAgICAgIGdkcHJpbnRrKFhFTkxPR19FUlIsICJDb3VsZCBub3QgY2hhbmdlIHAy
bSB0eXBlIGQgJWh1IGdmbiAlbHguXG4iLCAKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgZC0+ZG9tYWluX2lkLCBnZm4pOworICAgICAgICBnZHByaW50ayhYRU5MT0dfRVJSLCAiQ291
bGQgbm90IGNoYW5nZSBwMm0gdHlwZSBkICVodSBnZm4gJWx4LlxuIiwKKyAgICAgICAgICAgICAg
ICAgZC0+ZG9tYWluX2lkLCBnZm4pOwogICAgICAgICBCVUcoKTsKICAgICB9CiAKQEAgLTEyNzAs
NyArMTI4MSw3IEBAIGludCByZWxpbnF1aXNoX3NoYXJlZF9wYWdlcyhzdHJ1Y3QgZG9tYWluICpk
KQogCiAgICAgcDJtX2xvY2socDJtKTsKICAgICBmb3IgKCBnZm4gPSBwMm0tPm5leHRfc2hhcmVk
X2dmbl90b19yZWxpbnF1aXNoOwotICAgICAgICAgIGdmbiA8PSBwMm0tPm1heF9tYXBwZWRfcGZu
OyBnZm4rKyApCisgICAgICAgICAgICBnZm4gPD0gcDJtLT5tYXhfbWFwcGVkX3BmbjsgZ2ZuKysg
KQogICAgIHsKICAgICAgICAgcDJtX2FjY2Vzc190IGE7CiAgICAgICAgIHAybV90eXBlX3QgdDsK
QEAgLTEyODMsOCArMTI5NCw4IEBAIGludCByZWxpbnF1aXNoX3NoYXJlZF9wYWdlcyhzdHJ1Y3Qg
ZG9tYWluICpkKQogICAgICAgICBpZiAoIG1mbl92YWxpZChtZm4pICYmICh0ID09IHAybV9yYW1f
c2hhcmVkKSApCiAgICAgICAgIHsKICAgICAgICAgICAgIC8qIERvZXMgbm90IGZhaWwgd2l0aCBF
Tk9NRU0gZ2l2ZW4gdGhlIERFU1RST1kgZmxhZyAqLwotICAgICAgICAgICAgQlVHX09OKF9fbWVt
X3NoYXJpbmdfdW5zaGFyZV9wYWdlKGQsIGdmbiwgCi0gICAgICAgICAgICAgICAgICAgIE1FTV9T
SEFSSU5HX0RFU1RST1lfR0ZOKSk7CisgICAgICAgICAgICBCVUdfT04oX19tZW1fc2hhcmluZ191
bnNoYXJlX3BhZ2UoZCwgZ2ZuLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIE1FTV9TSEFSSU5HX0RFU1RST1lfR0ZOKSk7CiAgICAgICAgICAgICAvKiBDbGVh
ciBvdXQgdGhlIHAybSBlbnRyeSBzbyBubyBvbmUgZWxzZSBtYXkgdHJ5IHRvCiAgICAgICAgICAg
ICAgKiB1bnNoYXJlLiAgTXVzdCBzdWNjZWVkOiB3ZSBqdXN0IHJlYWQgdGhlIG9sZCBlbnRyeSBh
bmQKICAgICAgICAgICAgICAqIHdlIGhvbGQgdGhlIHAybSBsb2NrLiAqLwpAQCAtMTQ1NCw4ICsx
NDY1LDggQEAgaW50IG1lbV9zaGFyaW5nX21lbW9wKFhFTl9HVUVTVF9IQU5ETEVfUEFSQU0oeGVu
X21lbV9zaGFyaW5nX29wX3QpIGFyZykKIAogICAgICAgICAgICAgaWYgKCBYRU5NRU1fU0hBUklO
R19PUF9GSUVMRF9JU19HUkVGKG1zby51LnNoYXJlLnNvdXJjZV9nZm4pICkKICAgICAgICAgICAg
IHsKLSAgICAgICAgICAgICAgICBncmFudF9yZWZfdCBncmVmID0gKGdyYW50X3JlZl90KSAKLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChYRU5NRU1fU0hBUklOR19PUF9GSUVM
RF9HRVRfR1JFRigKKyAgICAgICAgICAgICAgICBncmFudF9yZWZfdCBncmVmID0gKGdyYW50X3Jl
Zl90KQorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoWEVOTUVNX1NIQVJJTkdf
T1BfRklFTERfR0VUX0dSRUYoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgbXNvLnUuc2hhcmUuc291cmNlX2dmbikpOwogICAgICAgICAgICAgICAgIHJjID0gbWVtX3No
YXJpbmdfZ3JlZl90b19nZm4oZC0+Z3JhbnRfdGFibGUsIGdyZWYsICZzZ2ZuLAogICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTlVMTCk7CkBAIC0xNDcwLDggKzE0
ODEsOCBAQCBpbnQgbWVtX3NoYXJpbmdfbWVtb3AoWEVOX0dVRVNUX0hBTkRMRV9QQVJBTSh4ZW5f
bWVtX3NoYXJpbmdfb3BfdCkgYXJnKQogCiAgICAgICAgICAgICBpZiAoIFhFTk1FTV9TSEFSSU5H
X09QX0ZJRUxEX0lTX0dSRUYobXNvLnUuc2hhcmUuY2xpZW50X2dmbikgKQogICAgICAgICAgICAg
ewotICAgICAgICAgICAgICAgIGdyYW50X3JlZl90IGdyZWYgPSAoZ3JhbnRfcmVmX3QpIAotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKFhFTk1FTV9TSEFSSU5HX09QX0ZJRUxE
X0dFVF9HUkVGKAorICAgICAgICAgICAgICAgIGdyYW50X3JlZl90IGdyZWYgPSAoZ3JhbnRfcmVm
X3QpCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChYRU5NRU1fU0hBUklOR19P
UF9GSUVMRF9HRVRfR1JFRigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBtc28udS5zaGFyZS5jbGllbnRfZ2ZuKSk7CiAgICAgICAgICAgICAgICAgcmMgPSBtZW1fc2hh
cmluZ19ncmVmX3RvX2dmbihjZC0+Z3JhbnRfdGFibGUsIGdyZWYsICZjZ2ZuLAogICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTlVMTCk7CkBAIC0xNTM0LDcgKzE1
NDUsNyBAQCBpbnQgbWVtX3NoYXJpbmdfbWVtb3AoWEVOX0dVRVNUX0hBTkRMRV9QQVJBTSh4ZW5f
bWVtX3NoYXJpbmdfb3BfdCkgYXJnKQogICAgICAgICAgICAgc2ggICAgICA9IG1zby51LnNoYXJl
LnNvdXJjZV9oYW5kbGU7CiAgICAgICAgICAgICBjZ2ZuICAgID0gbXNvLnUuc2hhcmUuY2xpZW50
X2dmbjsKIAotICAgICAgICAgICAgcmMgPSBtZW1fc2hhcmluZ19hZGRfdG9fcGh5c21hcChkLCBz
Z2ZuLCBzaCwgY2QsIGNnZm4pOyAKKyAgICAgICAgICAgIHJjID0gbWVtX3NoYXJpbmdfYWRkX3Rv
X3BoeXNtYXAoZCwgc2dmbiwgc2gsIGNkLCBjZ2ZuKTsKIAogICAgICAgICAgICAgcmN1X3VubG9j
a19kb21haW4oY2QpOwogICAgICAgICB9CkBAIC0xNTQ3LDggKzE1NTgsOCBAQCBpbnQgbWVtX3No
YXJpbmdfbWVtb3AoWEVOX0dVRVNUX0hBTkRMRV9QQVJBTSh4ZW5fbWVtX3NoYXJpbmdfb3BfdCkg
YXJnKQogCiAgICAgICAgICAgICByYyA9IC1FSU5WQUw7CiAgICAgICAgICAgICBpZiAoIG1zby51
LnJhbmdlLl9wYWRbMF0gfHwgbXNvLnUucmFuZ2UuX3BhZFsxXSB8fAotICAgICAgICAgICAgICAg
ICBtc28udS5yYW5nZS5fcGFkWzJdICkKLSAgICAgICAgICAgICAgICAgZ290byBvdXQ7CisgICAg
ICAgICAgICAgICAgICAgIG1zby51LnJhbmdlLl9wYWRbMl0gKQorICAgICAgICAgICAgICAgIGdv
dG8gb3V0OwogCiAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICogV2UgdXNlIG9wYXF1ZSBm
b3IgdGhlIGh5cGVyY2FsbCBjb250aW51YXRpb24gdmFsdWUuCkBAIC0xNTU3LDggKzE1NjgsOCBA
QCBpbnQgbWVtX3NoYXJpbmdfbWVtb3AoWEVOX0dVRVNUX0hBTkRMRV9QQVJBTSh4ZW5fbWVtX3No
YXJpbmdfb3BfdCkgYXJnKQogICAgICAgICAgICAgICogdGhhdCBpdCdzIGF0IGxlYXN0IGluIHJh
bmdlLgogICAgICAgICAgICAgICovCiAgICAgICAgICAgICBpZiAoIG1zby51LnJhbmdlLm9wYXF1
ZSAmJgotICAgICAgICAgICAgICAgICAobXNvLnUucmFuZ2Uub3BhcXVlIDwgbXNvLnUucmFuZ2Uu
Zmlyc3RfZ2ZuIHx8Ci0gICAgICAgICAgICAgICAgICBtc28udS5yYW5nZS5vcGFxdWUgPiBtc28u
dS5yYW5nZS5sYXN0X2dmbikgKQorICAgICAgICAgICAgICAgICAgICAobXNvLnUucmFuZ2Uub3Bh
cXVlIDwgbXNvLnUucmFuZ2UuZmlyc3RfZ2ZuIHx8CisgICAgICAgICAgICAgICAgICAgICBtc28u
dS5yYW5nZS5vcGFxdWUgPiBtc28udS5yYW5nZS5sYXN0X2dmbikgKQogICAgICAgICAgICAgICAg
IGdvdG8gb3V0OwogCiAgICAgICAgICAgICBpZiAoICFtZW1fc2hhcmluZ19lbmFibGVkKGQpICkK
QEAgLTE1OTMsNyArMTYwNCw3IEBAIGludCBtZW1fc2hhcmluZ19tZW1vcChYRU5fR1VFU1RfSEFO
RExFX1BBUkFNKHhlbl9tZW1fc2hhcmluZ19vcF90KSBhcmcpCiAgICAgICAgICAgICAgKiB0aGUg
ZHVyYXRpb24gb2YgdGhpcyBvcC4KICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgaWYgKCAh
YXRvbWljX3JlYWQoJmQtPnBhdXNlX2NvdW50KSB8fAotICAgICAgICAgICAgICAgICAhYXRvbWlj
X3JlYWQoJmNkLT5wYXVzZV9jb3VudCkgKQorICAgICAgICAgICAgICAgICAgICAhYXRvbWljX3Jl
YWQoJmNkLT5wYXVzZV9jb3VudCkgKQogICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIHJj
dV91bmxvY2tfZG9tYWluKGNkKTsKICAgICAgICAgICAgICAgICByYyA9IC1FSU5WQUw7CkBAIC0x
NjA0LDkgKzE2MTUsOSBAQCBpbnQgbWVtX3NoYXJpbmdfbWVtb3AoWEVOX0dVRVNUX0hBTkRMRV9Q
QVJBTSh4ZW5fbWVtX3NoYXJpbmdfb3BfdCkgYXJnKQogICAgICAgICAgICAgbWF4X2NnZm4gPSBk
b21haW5fZ2V0X21heGltdW1fZ3BmbihjZCk7CiAKICAgICAgICAgICAgIGlmICggbWF4X3NnZm4g
PCBtc28udS5yYW5nZS5maXJzdF9nZm4gfHwKLSAgICAgICAgICAgICAgICAgbWF4X3NnZm4gPCBt
c28udS5yYW5nZS5sYXN0X2dmbiB8fAotICAgICAgICAgICAgICAgICBtYXhfY2dmbiA8IG1zby51
LnJhbmdlLmZpcnN0X2dmbiB8fAotICAgICAgICAgICAgICAgICBtYXhfY2dmbiA8IG1zby51LnJh
bmdlLmxhc3RfZ2ZuICkKKyAgICAgICAgICAgICAgICAgICAgbWF4X3NnZm4gPCBtc28udS5yYW5n
ZS5sYXN0X2dmbiB8fAorICAgICAgICAgICAgICAgICAgICBtYXhfY2dmbiA8IG1zby51LnJhbmdl
LmZpcnN0X2dmbiB8fAorICAgICAgICAgICAgICAgICAgICBtYXhfY2dmbiA8IG1zby51LnJhbmdl
Lmxhc3RfZ2ZuICkKICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICByY3VfdW5sb2NrX2Rv
bWFpbihjZCk7CiAgICAgICAgICAgICAgICAgcmMgPSAtRUlOVkFMOwpAQCAtMTY1Nyw5ICsxNjY4
LDkgQEAgaW50IG1lbV9zaGFyaW5nX2RvbWN0bChzdHJ1Y3QgZG9tYWluICpkLCBzdHJ1Y3QgeGVu
X2RvbWN0bF9tZW1fc2hhcmluZ19vcCAqbWVjKQogCiAgICAgLyogT25seSBIQVAgaXMgc3VwcG9y
dGVkICovCiAgICAgaWYgKCAhaGFwX2VuYWJsZWQoZCkgKQotICAgICAgICAgcmV0dXJuIC1FTk9E
RVY7CisgICAgICAgIHJldHVybiAtRU5PREVWOwogCi0gICAgc3dpdGNoKG1lYy0+b3ApCisgICAg
c3dpdGNoIChtZWMtPm9wKQogICAgIHsKICAgICAgICAgY2FzZSBYRU5fRE9NQ1RMX01FTV9TSEFS
SU5HX0NPTlRST0w6CiAgICAgICAgIHsKLS0gCjIuMjAuMQoKCl9fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRl
dmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFp
bG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id C9E189FC89
	for <lists+xen-devel@lfdr.de>; Wed, 28 Aug 2019 10:03:34 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i2ssx-0001mQ-6v; Wed, 28 Aug 2019 08:00:55 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=laXa=WY=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1i2ssv-0001m3-Qh
 for xen-devel@lists.xenproject.org; Wed, 28 Aug 2019 08:00:53 +0000
X-Inumbo-ID: eb25f2c5-c969-11e9-ae43-12813bfff9fa
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id eb25f2c5-c969-11e9-ae43-12813bfff9fa;
 Wed, 28 Aug 2019 08:00:37 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id B74B1AEED;
 Wed, 28 Aug 2019 08:00:36 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Wed, 28 Aug 2019 10:00:28 +0200
Message-Id: <20190828080028.18205-5-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190828080028.18205-1-jgross@suse.com>
References: <20190828080028.18205-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v3 4/4] xen: add per-cpu buffer option to
 debugtrace
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

ZGVidWd0cmFjZSBpcyBub3JtYWxseSB3cml0aW5nIHRyYWNlIGVudHJpZXMgaW50byBhIHNpbmds
ZSB0cmFjZQpidWZmZXIuIFRoZXJlIGFyZSBjYXNlcyB3aGVyZSB0aGlzIGlzIG5vdCBvcHRpbWFs
LCBlLmcuIHdoZW4gaHVudGluZwphIGJ1ZyB3aGljaCByZXF1aXJlcyB3cml0aW5nIGxvdHMgb2Yg
dHJhY2UgZW50cmllcyBhbmQgb25lIGNwdSBpcwpzdHVjay4gVGhpcyB3aWxsIHJlc3VsdCBpbiBv
dGhlciBjcHVzIGZpbGxpbmcgdGhlIHRyYWNlIGJ1ZmZlciBhbmQKZmluYWxseSBvdmVyd3JpdGlu
ZyB0aGUgaW50ZXJlc3RpbmcgdHJhY2UgZW50cmllcyBvZiB0aGUgaGFuZ2luZyBjcHUuCgpJbiBv
cmRlciB0byBiZSBhYmxlIHRvIGRlYnVnIHN1Y2ggc2l0dWF0aW9ucyBhZGQgdGhlIGNhcGFiaWxp
dHkgdG8gdXNlCnBlci1jcHUgdHJhY2UgYnVmZmVycy4gVGhpcyBjYW4gYmUgc2VsZWN0ZWQgYnkg
c3BlY2lmeWluZyB0aGUKZGVidWd0cmFjZSBib290IHBhcmFtZXRlciB3aXRoIHRoZSBtb2RpZmll
ciAiY3B1OiIsIGxpa2U6CgogIGRlYnVndHJhY2U9Y3B1OjE2CgpBdCB0aGUgc2FtZSB0aW1lIHN3
aXRjaCB0aGUgcGFyc2luZyBmdW5jdGlvbiB0byBhY2NlcHQgc2l6ZSBtb2RpZmllcnMKKGUuZy4g
NE0gb3IgMUcpLgoKUHJpbnRpbmcgb3V0IHRoZSB0cmFjZSBlbnRyaWVzIGlzIGRvbmUgZm9yIGVh
Y2ggYnVmZmVyIGluIG9yZGVyIHRvCm1pbmltaXplIHRoZSBlZmZvcnQgbmVlZGVkIGR1cmluZyBw
cmludGluZy4gQXMgZWFjaCBlbnRyeSBpcyBwcmVmaXhlZAp3aXRoIGl0cyBzZXF1ZW5jZSBudW1i
ZXIgc29ydGluZyB0aGUgZW50cmllcyBjYW4gZWFzaWx5IGJlIGRvbmUgd2hlbgphbmFseXppbmcg
dGhlbS4KClNpZ25lZC1vZmYtYnk6IEp1ZXJnZW4gR3Jvc3MgPGpncm9zc0BzdXNlLmNvbT4KLS0t
ClYyOiBvbmx5IGFsbG9jYXRlIGJ1ZmZlciBpZiBub3QgYWxyZWFkeSBkb25lIHNvCi0tLQogZG9j
cy9taXNjL3hlbi1jb21tYW5kLWxpbmUucGFuZG9jIHwgICA3ICstCiB4ZW4vY29tbW9uL2RlYnVn
dHJhY2UuYyAgICAgICAgICAgfCAxNDggKysrKysrKysrKysrKysrKysrKysrKysrKysrKy0tLS0t
LS0tLS0KIDIgZmlsZXMgY2hhbmdlZCwgMTE2IGluc2VydGlvbnMoKyksIDM5IGRlbGV0aW9ucygt
KQoKZGlmZiAtLWdpdCBhL2RvY3MvbWlzYy94ZW4tY29tbWFuZC1saW5lLnBhbmRvYyBiL2RvY3Mv
bWlzYy94ZW4tY29tbWFuZC1saW5lLnBhbmRvYwppbmRleCA3YzcyZTMxMDMyLi44MzI3OTdlMmUy
IDEwMDY0NAotLS0gYS9kb2NzL21pc2MveGVuLWNvbW1hbmQtbGluZS5wYW5kb2MKKysrIGIvZG9j
cy9taXNjL3hlbi1jb21tYW5kLWxpbmUucGFuZG9jCkBAIC02NDQsMTIgKzY0NCwxMyBAQCBvdmVy
IHRoZSBQQ0kgYnVzc2VzIHNlcXVlbnRpYWxseSkgb3IgYnkgUENJIGRldmljZSAobXVzdCBiZSBv
biBzZWdtZW50IDApLgogTGltaXRzIHRoZSBudW1iZXIgbGluZXMgcHJpbnRlZCBpbiBYZW4gc3Rh
Y2sgdHJhY2VzLgogCiAjIyMgZGVidWd0cmFjZQotPiBgPSA8aW50ZWdlcj5gCis+IGA9IFtjcHU6
XTxzaXplPmAKIAogPiBEZWZhdWx0OiBgMTI4YAogCi1TcGVjaWZ5IHRoZSBzaXplIG9mIHRoZSBj
b25zb2xlIGRlYnVnIHRyYWNlIGJ1ZmZlciBpbiBLaUIuIFRoZSBkZWJ1ZwotdHJhY2UgZmVhdHVy
ZSBpcyBvbmx5IGVuYWJsZWQgaW4gZGVidWdnaW5nIGJ1aWxkcyBvZiBYZW4uCitTcGVjaWZ5IHRo
ZSBzaXplIG9mIHRoZSBjb25zb2xlIGRlYnVnIHRyYWNlIGJ1ZmZlci4gQnkgc3BlY2lmeWluZyBg
Y3B1OmAKK2FkZGl0aW9uYWxseSBhIHRyYWNlIGJ1ZmZlciBvZiB0aGUgc3BlY2lmaWVkIHNpemUg
aXMgYWxsb2NhdGVkIHBlciBjcHUuCitUaGUgZGVidWcgdHJhY2UgZmVhdHVyZSBpcyBvbmx5IGVu
YWJsZWQgaW4gZGVidWdnaW5nIGJ1aWxkcyBvZiBYZW4uCiAKICMjIyBkbWFfYml0cwogPiBgPSA8
aW50ZWdlcj5gCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL2RlYnVndHJhY2UuYyBiL3hlbi9jb21t
b24vZGVidWd0cmFjZS5jCmluZGV4IDdhOWU0ZmI5OWYuLmE1NDg4OGNlYTkgMTAwNjQ0Ci0tLSBh
L3hlbi9jb21tb24vZGVidWd0cmFjZS5jCisrKyBiL3hlbi9jb21tb24vZGVidWd0cmFjZS5jCkBA
IC02LDYgKzYsNyBAQAogCiAKICNpbmNsdWRlIDx4ZW4vY29uc29sZS5oPgorI2luY2x1ZGUgPHhl
bi9jcHUuaD4KICNpbmNsdWRlIDx4ZW4vaW5pdC5oPgogI2luY2x1ZGUgPHhlbi9rZXloYW5kbGVy
Lmg+CiAjaW5jbHVkZSA8eGVuL2xpYi5oPgpAQCAtMjQsMzIgKzI1LDYyIEBAIHN0cnVjdCBkZWJ1
Z3RyYWNlX2RhdGFfcyB7CiB9OwogCiBzdGF0aWMgc3RydWN0IGRlYnVndHJhY2VfZGF0YV9zICpk
ZWJ0cl9kYXRhOworc3RhdGljIERFRklORV9QRVJfQ1BVKHN0cnVjdCBkZWJ1Z3RyYWNlX2RhdGFf
cyAqLCBkZWJ0cl9jcHVfZGF0YSk7CiAKLXN0YXRpYyB1bnNpZ25lZCBpbnQgZGVidWd0cmFjZV9r
aWxvYnl0ZXMgPSAxMjg7CitzdGF0aWMgdW5zaWduZWQgaW50IGRlYnVndHJhY2VfYnl0ZXMgPSAx
MjggPDwgMTA7CitzdGF0aWMgYm9vbCBkZWJ1Z3RyYWNlX3Blcl9jcHU7CiBzdGF0aWMgYm9vbCBk
ZWJ1Z3RyYWNlX3VzZWQ7CiBzdGF0aWMgREVGSU5FX1NQSU5MT0NLKGRlYnVndHJhY2VfbG9jayk7
Ci1pbnRlZ2VyX3BhcmFtKCJkZWJ1Z3RyYWNlIiwgZGVidWd0cmFjZV9raWxvYnl0ZXMpOwogCi1z
dGF0aWMgdm9pZCBkZWJ1Z3RyYWNlX2R1bXBfd29ya2VyKHZvaWQpCitzdGF0aWMgaW50IF9faW5p
dCBkZWJ1Z3RyYWNlX3BhcnNlX3BhcmFtKGNvbnN0IGNoYXIgKnMpCit7CisgICAgaWYgKCAhc3Ry
bmNtcChzLCAiY3B1OiIsIDQpICkKKyAgICB7CisgICAgICAgIGRlYnVndHJhY2VfcGVyX2NwdSA9
IHRydWU7CisgICAgICAgIHMgKz0gNDsKKyAgICB9CisgICAgZGVidWd0cmFjZV9ieXRlcyA9ICBw
YXJzZV9zaXplX2FuZF91bml0KHMsIE5VTEwpOworICAgIHJldHVybiAwOworfQorY3VzdG9tX3Bh
cmFtKCJkZWJ1Z3RyYWNlIiwgZGVidWd0cmFjZV9wYXJzZV9wYXJhbSk7CisKK3N0YXRpYyB2b2lk
IGRlYnVndHJhY2VfZHVtcF9idWZmZXIoc3RydWN0IGRlYnVndHJhY2VfZGF0YV9zICpkYXRhLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGFyICp3aGljaCkKIHsK
LSAgICBpZiAoICFkZWJ0cl9kYXRhIHx8ICFkZWJ1Z3RyYWNlX3VzZWQgKQorICAgIGlmICggIWRh
dGEgKQogICAgICAgICByZXR1cm47CiAKLSAgICBwcmludGsoImRlYnVndHJhY2VfZHVtcCgpIHN0
YXJ0aW5nXG4iKTsKKyAgICBwcmludGsoImRlYnVndHJhY2VfZHVtcCgpICVzIGJ1ZmZlciBzdGFy
dGluZ1xuIiwgd2hpY2gpOwogCiAgICAgLyogUHJpbnQgb2xkZXN0IHBvcnRpb24gb2YgdGhlIHJp
bmcuICovCi0gICAgQVNTRVJUKGRlYnRyX2RhdGEtPmJ1ZltkZWJ0cl9kYXRhLT5ieXRlcyAtIDFd
ID09IDApOwotICAgIGlmICggZGVidHJfZGF0YS0+YnVmW2RlYnRyX2RhdGEtPnByZF0gIT0gJ1ww
JyApCi0gICAgICAgIGNvbnNvbGVfc2VyaWFsX3B1dHMoJmRlYnRyX2RhdGEtPmJ1ZltkZWJ0cl9k
YXRhLT5wcmRdLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlYnRyX2RhdGEtPmJ5dGVz
IC0gZGVidHJfZGF0YS0+cHJkIC0gMSk7CisgICAgQVNTRVJUKGRhdGEtPmJ1ZltkYXRhLT5ieXRl
cyAtIDFdID09IDApOworICAgIGlmICggZGF0YS0+YnVmW2RhdGEtPnByZF0gIT0gJ1wwJyApCisg
ICAgICAgIGNvbnNvbGVfc2VyaWFsX3B1dHMoJmRhdGEtPmJ1ZltkYXRhLT5wcmRdLCBkYXRhLT5i
eXRlcyAtIGRhdGEtPnByZCAtIDEpOwogCiAgICAgLyogUHJpbnQgeW91bmdlc3QgcG9ydGlvbiBv
ZiB0aGUgcmluZy4gKi8KLSAgICBkZWJ0cl9kYXRhLT5idWZbZGVidHJfZGF0YS0+cHJkXSA9ICdc
MCc7Ci0gICAgY29uc29sZV9zZXJpYWxfcHV0cygmZGVidHJfZGF0YS0+YnVmWzBdLCBkZWJ0cl9k
YXRhLT5wcmQpOworICAgIGRhdGEtPmJ1ZltkYXRhLT5wcmRdID0gJ1wwJzsKKyAgICBjb25zb2xl
X3NlcmlhbF9wdXRzKCZkYXRhLT5idWZbMF0sIGRhdGEtPnByZCk7CisKKyAgICBtZW1zZXQoZGF0
YS0+YnVmLCAnXDAnLCBkYXRhLT5ieXRlcyk7CisKKyAgICBwcmludGsoImRlYnVndHJhY2VfZHVt
cCgpICVzIGJ1ZmZlciBmaW5pc2hlZFxuIiwgd2hpY2gpOworfQorCitzdGF0aWMgdm9pZCBkZWJ1
Z3RyYWNlX2R1bXBfd29ya2VyKHZvaWQpCit7CisgICAgdW5zaWduZWQgaW50IGNwdTsKKyAgICBj
aGFyIGJ1ZlsxNl07CisKKyAgICBpZiAoICFkZWJ1Z3RyYWNlX3VzZWQgKQorICAgICAgICByZXR1
cm47CiAKLSAgICBtZW1zZXQoZGVidHJfZGF0YS0+YnVmLCAnXDAnLCBkZWJ0cl9kYXRhLT5ieXRl
cyk7CisgICAgZGVidWd0cmFjZV9kdW1wX2J1ZmZlcihkZWJ0cl9kYXRhLCAiZ2xvYmFsIik7CiAK
LSAgICBwcmludGsoImRlYnVndHJhY2VfZHVtcCgpIGZpbmlzaGVkXG4iKTsKKyAgICBmb3IgKCBj
cHUgPSAwOyBjcHUgPCBucl9jcHVfaWRzOyBjcHUrKyApCisgICAgeworICAgICAgICBzbnByaW50
ZihidWYsIHNpemVvZihidWYpLCAiY3B1ICV1IiwgY3B1KTsKKyAgICAgICAgZGVidWd0cmFjZV9k
dW1wX2J1ZmZlcihwZXJfY3B1KGRlYnRyX2NwdV9kYXRhLCBjcHUpLCBidWYpOworICAgIH0KIH0K
IAogc3RhdGljIHZvaWQgZGVidWd0cmFjZV90b2dnbGUodm9pZCkKQEAgLTg5LDM1ICsxMjAsNDIg
QEAgdm9pZCBkZWJ1Z3RyYWNlX2R1bXAodm9pZCkKIAogc3RhdGljIHZvaWQgZGVidWd0cmFjZV9h
ZGRfdG9fYnVmKGNoYXIgKmJ1ZikKIHsKKyAgICBzdHJ1Y3QgZGVidWd0cmFjZV9kYXRhX3MgKmRh
dGE7CiAgICAgY2hhciAqcDsKIAorICAgIGRhdGEgPSBkZWJ1Z3RyYWNlX3Blcl9jcHUgPyB0aGlz
X2NwdShkZWJ0cl9jcHVfZGF0YSkgOiBkZWJ0cl9kYXRhOworCiAgICAgZm9yICggcCA9IGJ1Zjsg
KnAgIT0gJ1wwJzsgcCsrICkKICAgICB7Ci0gICAgICAgIGRlYnRyX2RhdGEtPmJ1ZltkZWJ0cl9k
YXRhLT5wcmQrK10gPSAqcDsKKyAgICAgICAgZGF0YS0+YnVmW2RhdGEtPnByZCsrXSA9ICpwOwog
ICAgICAgICAvKiBBbHdheXMgbGVhdmUgYSBudWwgYnl0ZSBhdCB0aGUgZW5kIG9mIHRoZSBidWZm
ZXIuICovCi0gICAgICAgIGlmICggZGVidHJfZGF0YS0+cHJkID09IChkZWJ0cl9kYXRhLT5ieXRl
cyAtIDEpICkKLSAgICAgICAgICAgIGRlYnRyX2RhdGEtPnByZCA9IDA7CisgICAgICAgIGlmICgg
ZGF0YS0+cHJkID09IChkYXRhLT5ieXRlcyAtIDEpICkKKyAgICAgICAgICAgIGRhdGEtPnByZCA9
IDA7CiAgICAgfQogfQogCiB2b2lkIGRlYnVndHJhY2VfcHJpbnRrKGNvbnN0IGNoYXIgKmZtdCwg
Li4uKQogewogICAgIHN0YXRpYyBjaGFyIGJ1ZlsxMDI0XSwgbGFzdF9idWZbMTAyNF07Ci0gICAg
c3RhdGljIHVuc2lnbmVkIGludCBjb3VudCwgbGFzdF9jb3VudCwgbGFzdF9wcmQ7CisgICAgc3Rh
dGljIHVuc2lnbmVkIGludCBjb3VudCwgbGFzdF9jb3VudCwgbGFzdF9wcmQsIGxhc3RfY3B1Owog
CiAgICAgY2hhciAgICAgICAgICBjbnRidWZbMjRdOwogICAgIHZhX2xpc3QgICAgICAgYXJnczsK
ICAgICB1bnNpZ25lZCBsb25nIGZsYWdzOwogICAgIHVuc2lnbmVkIGludCBucjsKKyAgICBzdHJ1
Y3QgZGVidWd0cmFjZV9kYXRhX3MgKmRhdGE7CisgICAgdW5zaWduZWQgaW50IGNwdTsKIAotICAg
IGlmICggIWRlYnRyX2RhdGEgKQorICAgIGRhdGEgPSBkZWJ1Z3RyYWNlX3Blcl9jcHUgPyB0aGlz
X2NwdShkZWJ0cl9jcHVfZGF0YSkgOiBkZWJ0cl9kYXRhOworICAgIGNwdSA9IGRlYnVndHJhY2Vf
cGVyX2NwdSA/IHNtcF9wcm9jZXNzb3JfaWQoKSA6IDA7CisgICAgaWYgKCAhZGF0YSApCiAgICAg
ICAgIHJldHVybjsKIAogICAgIGRlYnVndHJhY2VfdXNlZCA9IHRydWU7CiAKICAgICBzcGluX2xv
Y2tfaXJxc2F2ZSgmZGVidWd0cmFjZV9sb2NrLCBmbGFncyk7CiAKLSAgICBBU1NFUlQoZGVidHJf
ZGF0YS0+YnVmW2RlYnRyX2RhdGEtPmJ5dGVzIC0gMV0gPT0gMCk7CisgICAgQVNTRVJUKGRhdGEt
PmJ1ZltkYXRhLT5ieXRlcyAtIDFdID09IDApOwogCiAgICAgdmFfc3RhcnQoYXJncywgZm10KTsK
ICAgICBuciA9IHZzbnByaW50ZihidWYsIHNpemVvZihidWYpLCBmbXQsIGFyZ3MpOwpAQCAtMTMy
LDE2ICsxNzAsMTcgQEAgdm9pZCBkZWJ1Z3RyYWNlX3ByaW50ayhjb25zdCBjaGFyICpmbXQsIC4u
LikKICAgICB9CiAgICAgZWxzZQogICAgIHsKLSAgICAgICAgaWYgKCBzdHJjbXAoYnVmLCBsYXN0
X2J1ZikgKQorICAgICAgICBpZiAoIHN0cmNtcChidWYsIGxhc3RfYnVmKSB8fCBjcHUgIT0gbGFz
dF9jcHUgKQogICAgICAgICB7Ci0gICAgICAgICAgICBsYXN0X3ByZCA9IGRlYnRyX2RhdGEtPnBy
ZDsKKyAgICAgICAgICAgIGxhc3RfcHJkID0gZGF0YS0+cHJkOwogICAgICAgICAgICAgbGFzdF9j
b3VudCA9ICsrY291bnQ7CisgICAgICAgICAgICBsYXN0X2NwdSA9IGNwdTsKICAgICAgICAgICAg
IHNhZmVfc3RyY3B5KGxhc3RfYnVmLCBidWYpOwogICAgICAgICAgICAgc25wcmludGYoY250YnVm
LCBzaXplb2YoY250YnVmKSwgIiV1ICIsIGNvdW50KTsKICAgICAgICAgfQogICAgICAgICBlbHNl
CiAgICAgICAgIHsKLSAgICAgICAgICAgIGRlYnRyX2RhdGEtPnByZCA9IGxhc3RfcHJkOworICAg
ICAgICAgICAgZGF0YS0+cHJkID0gbGFzdF9wcmQ7CiAgICAgICAgICAgICBzbnByaW50ZihjbnRi
dWYsIHNpemVvZihjbnRidWYpLCAiJXUtJXUgIiwgbGFzdF9jb3VudCwgKytjb3VudCk7CiAgICAg
ICAgIH0KICAgICAgICAgZGVidWd0cmFjZV9hZGRfdG9fYnVmKGNudGJ1Zik7CkBAIC0xNTYsMzMg
KzE5NSw3MCBAQCBzdGF0aWMgdm9pZCBkZWJ1Z3RyYWNlX2tleSh1bnNpZ25lZCBjaGFyIGtleSkK
ICAgICBkZWJ1Z3RyYWNlX3RvZ2dsZSgpOwogfQogCi1zdGF0aWMgaW50IF9faW5pdCBkZWJ1Z3Ry
YWNlX2luaXQodm9pZCkKK3N0YXRpYyB2b2lkIGRlYnVndHJhY2VfYWxsb2NfYnVmZmVyKHN0cnVj
dCBkZWJ1Z3RyYWNlX2RhdGFfcyAqKnB0cikKIHsKICAgICBpbnQgb3JkZXI7Ci0gICAgdW5zaWdu
ZWQgbG9uZyBrYnl0ZXMsIGJ5dGVzOwogICAgIHN0cnVjdCBkZWJ1Z3RyYWNlX2RhdGFfcyAqZGF0
YTsKIAotICAgIC8qIFJvdW5kIHNpemUgZG93biB0byBuZXh0IHBvd2VyIG9mIHR3by4gKi8KLSAg
ICB3aGlsZSAoIChrYnl0ZXMgPSAoZGVidWd0cmFjZV9raWxvYnl0ZXMgJiAoZGVidWd0cmFjZV9r
aWxvYnl0ZXMtMSkpKSAhPSAwICkKLSAgICAgICAgZGVidWd0cmFjZV9raWxvYnl0ZXMgPSBrYnl0
ZXM7Ci0KLSAgICBieXRlcyA9IGRlYnVndHJhY2Vfa2lsb2J5dGVzIDw8IDEwOwotICAgIGlmICgg
Ynl0ZXMgPT0gMCApCi0gICAgICAgIHJldHVybiAwOworICAgIGlmICggZGVidWd0cmFjZV9ieXRl
cyA8IFBBR0VfU0laRSB8fCAqcHRyICkKKyAgICAgICAgcmV0dXJuOwogCi0gICAgb3JkZXIgPSBn
ZXRfb3JkZXJfZnJvbV9ieXRlcyhieXRlcyk7CisgICAgb3JkZXIgPSBnZXRfb3JkZXJfZnJvbV9i
eXRlcyhkZWJ1Z3RyYWNlX2J5dGVzKTsKICAgICBkYXRhID0gYWxsb2NfeGVuaGVhcF9wYWdlcyhv
cmRlciwgMCk7CiAgICAgaWYgKCAhZGF0YSApCi0gICAgICAgIHJldHVybiAtRU5PTUVNOworICAg
IHsKKyAgICAgICAgcHJpbnRrKCJmYWlsZWQgdG8gYWxsb2NhdGUgZGVidWd0cmFjZSBidWZmZXJc
biIpOworICAgICAgICByZXR1cm47CisgICAgfQorCisgICAgbWVtc2V0KGRhdGEsICdcMCcsIGRl
YnVndHJhY2VfYnl0ZXMpOworICAgIGRhdGEtPmJ5dGVzID0gZGVidWd0cmFjZV9ieXRlcyAtIHNp
emVvZigqZGF0YSk7CisKKyAgICAqcHRyID0gZGF0YTsKK30KKworc3RhdGljIGludCBkZWJ1Z3Ry
YWNlX2NwdV9jYWxsYmFjayhzdHJ1Y3Qgbm90aWZpZXJfYmxvY2sgKm5mYiwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgbG9uZyBhY3Rpb24sIHZvaWQgKmhjcHUp
Cit7CisgICAgdW5zaWduZWQgaW50IGNwdSA9ICh1bnNpZ25lZCBsb25nKWhjcHU7CisKKyAgICAv
KiBCdWZmZXJzIGFyZSBvbmx5IGV2ZXIgYWxsb2NhdGVkLCBuZXZlciBmcmVlZC4gKi8KKyAgICBz
d2l0Y2ggKCBhY3Rpb24gKQorICAgIHsKKyAgICBjYXNlIENQVV9VUF9QUkVQQVJFOgorICAgICAg
ICBkZWJ1Z3RyYWNlX2FsbG9jX2J1ZmZlcigmcGVyX2NwdShkZWJ0cl9jcHVfZGF0YSwgY3B1KSk7
CisgICAgICAgIGJyZWFrOworICAgIGRlZmF1bHQ6CisgICAgICAgIGJyZWFrOworICAgIH0KKyAg
ICByZXR1cm4gMDsKK30KIAotICAgIG1lbXNldChkYXRhLCAnXDAnLCBieXRlcyk7CitzdGF0aWMg
c3RydWN0IG5vdGlmaWVyX2Jsb2NrIGRlYnVndHJhY2VfbmZiID0geworICAgIC5ub3RpZmllcl9j
YWxsID0gZGVidWd0cmFjZV9jcHVfY2FsbGJhY2sKK307CisKK3N0YXRpYyBpbnQgX19pbml0IGRl
YnVndHJhY2VfaW5pdCh2b2lkKQoreworICAgIHVuc2lnbmVkIGxvbmcgYnl0ZXM7CisgICAgdW5z
aWduZWQgaW50IGNwdTsKIAotICAgIGRhdGEtPmJ5dGVzID0gYnl0ZXMgLSBzaXplb2YoKmRhdGEp
OwotICAgIGRlYnRyX2RhdGEgPSBkYXRhOworICAgIC8qIFJvdW5kIHNpemUgZG93biB0byBuZXh0
IHBvd2VyIG9mIHR3by4gKi8KKyAgICB3aGlsZSAoIChieXRlcyA9IChkZWJ1Z3RyYWNlX2J5dGVz
ICYgKGRlYnVndHJhY2VfYnl0ZXMgLSAxKSkpICE9IDAgKQorICAgICAgICBkZWJ1Z3RyYWNlX2J5
dGVzID0gYnl0ZXM7CiAKICAgICByZWdpc3Rlcl9rZXloYW5kbGVyKCdUJywgZGVidWd0cmFjZV9r
ZXksCiAgICAgICAgICAgICAgICAgICAgICAgICAidG9nZ2xlIGRlYnVndHJhY2UgdG8gY29uc29s
ZS9idWZmZXIiLCAwKTsKIAorICAgIGlmICggZGVidWd0cmFjZV9wZXJfY3B1ICkKKyAgICB7Cisg
ICAgICAgIGZvcl9lYWNoX29ubGluZV9jcHUgKCBjcHUgKQorICAgICAgICAgICAgZGVidWd0cmFj
ZV9hbGxvY19idWZmZXIoJnBlcl9jcHUoZGVidHJfY3B1X2RhdGEsIGNwdSkpOworICAgICAgICBy
ZWdpc3Rlcl9jcHVfbm90aWZpZXIoJmRlYnVndHJhY2VfbmZiKTsKKyAgICB9CisgICAgZWxzZQor
ICAgICAgICBkZWJ1Z3RyYWNlX2FsbG9jX2J1ZmZlcigmZGVidHJfZGF0YSk7CisKICAgICByZXR1
cm4gMDsKIH0KIF9faW5pdGNhbGwoZGVidWd0cmFjZV9pbml0KTsKLS0gCjIuMTYuNAoKCl9fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWls
aW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVu
cHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 13E59BE1A7
	for <lists+xen-devel@lfdr.de>; Wed, 25 Sep 2019 17:51:45 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iD9Xz-0000rb-AJ; Wed, 25 Sep 2019 15:49:43 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=mFb1=XU=intel.com=tamas.lengyel@srs-us1.protection.inumbo.net>)
 id 1iD9Xx-0000qq-MD
 for xen-devel@lists.xenproject.org; Wed, 25 Sep 2019 15:49:41 +0000
X-Inumbo-ID: 104658e8-dfac-11e9-bf31-bc764e2007e4
Received: from mga12.intel.com (unknown [192.55.52.136])
 by localhost (Halon) with ESMTPS
 id 104658e8-dfac-11e9-bf31-bc764e2007e4;
 Wed, 25 Sep 2019 15:49:31 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga006.jf.intel.com ([10.7.209.51])
 by fmsmga106.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 25 Sep 2019 08:49:29 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,548,1559545200"; d="scan'208";a="193812635"
Received: from tlengyel-mobl2.amr.corp.intel.com (HELO localhost.localdomain)
 ([10.252.129.153])
 by orsmga006.jf.intel.com with ESMTP; 25 Sep 2019 08:49:29 -0700
From: Tamas K Lengyel <tamas.lengyel@intel.com>
To: xen-devel@lists.xenproject.org
Date: Wed, 25 Sep 2019 08:48:41 -0700
Message-Id: <c5b510ea5712ea8922cc9ccc617ee6a7fe1c2606.1569425745.git.tamas.lengyel@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <cover.1569425745.git.tamas.lengyel@intel.com>
References: <cover.1569425745.git.tamas.lengyel@intel.com>
MIME-Version: 1.0
Subject: [Xen-devel] [RFC PATCH for-next 03/18] tools/libxc: clean up memory
 sharing files
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Ian Jackson <ian.jackson@eu.citrix.com>,
 Tamas K Lengyel <tamas.lengyel@intel.com>, Wei Liu <wl@xen.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

Tm8gZnVuY3Rpb25hbCBjaGFuZ2VzLgoKU2lnbmVkLW9mZi1ieTogVGFtYXMgSyBMZW5neWVsIDx0
YW1hcy5sZW5neWVsQGludGVsLmNvbT4KLS0tCiB0b29scy9saWJ4Yy9pbmNsdWRlL3hlbmN0cmwu
aCB8IDI0ICsrKysrKysrKysrKy0tLS0tLS0tLS0tLQogdG9vbHMvbGlieGMveGNfbWVtc2hyLmMg
ICAgICAgfCAxMiArKysrKystLS0tLS0KIDIgZmlsZXMgY2hhbmdlZCwgMTggaW5zZXJ0aW9ucygr
KSwgMTggZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGMvaW5jbHVkZS94ZW5j
dHJsLmggYi90b29scy9saWJ4Yy9pbmNsdWRlL3hlbmN0cmwuaAppbmRleCA3NTU5ZTFiYzY5Li5i
N2M5OTBhYWZkIDEwMDY0NAotLS0gYS90b29scy9saWJ4Yy9pbmNsdWRlL3hlbmN0cmwuaAorKysg
Yi90b29scy9saWJ4Yy9pbmNsdWRlL3hlbmN0cmwuaApAQCAtMjA2MCw3ICsyMDYwLDcgQEAgaW50
IHhjX21vbml0b3JfZW11bGF0ZV9lYWNoX3JlcCh4Y19pbnRlcmZhY2UgKnhjaCwgdWludDMyX3Qg
ZG9tYWluX2lkLAogICoKICAqIFNoYXJpbmcgaXMgc3VwcG9ydGVkIG9ubHkgb24gdGhlIHg4NiBh
cmNoaXRlY3R1cmUgaW4gNjQgYml0IG1vZGUsIHdpdGgKICAqIEhhcmR3YXJlLUFzc2lzdGVkIFBh
Z2luZyAoaS5lLiBJbnRlbCBFUFQsIEFNRCBOUFQpLiBNb3Jlb3ZlciwgQU1EIE5QVAotICogc3Vw
cG9ydCBpcyBjb25zaWRlcmVkIGV4cGVyaW1lbnRhbC4gCisgKiBzdXBwb3J0IGlzIGNvbnNpZGVy
ZWQgZXhwZXJpbWVudGFsLgogCiAgKiBDYWxscyBiZWxvdyByZXR1cm4gRU5PU1lTIGlmIG5vdCBp
biB0aGUgeDg2XzY0IGFyY2hpdGVjdHVyZS4KICAqIENhbGxzIGJlbG93IHJldHVybiBFTk9ERVYg
aWYgdGhlIGRvbWFpbiBkb2VzIG5vdCBzdXBwb3J0IEhBUC4KQEAgLTIxMDcsMTMgKzIxMDcsMTMg
QEAgaW50IHhjX21lbXNocl9jb250cm9sKHhjX2ludGVyZmFjZSAqeGNoLAogICogIEVJTlZBTCBv
ciBFQUNDRVNTIGlmIHRoZSByZXF1ZXN0IGlzIGRlbmllZCBieSB0aGUgc2VjdXJpdHkgcG9saWN5
CiAgKi8KIAotaW50IHhjX21lbXNocl9yaW5nX2VuYWJsZSh4Y19pbnRlcmZhY2UgKnhjaCwgCitp
bnQgeGNfbWVtc2hyX3JpbmdfZW5hYmxlKHhjX2ludGVyZmFjZSAqeGNoLAogICAgICAgICAgICAg
ICAgICAgICAgICAgICB1aW50MzJfdCBkb21pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAg
dWludDMyX3QgKnBvcnQpOwogLyogRGlzYWJsZSB0aGUgcmluZyBmb3IgRU5PTUVNIGNvbW11bmlj
YXRpb24uCiAgKiBNYXkgZmFpbCB3aXRoIEVJTlZBTCBpZiB0aGUgcmluZyB3YXMgbm90IGVuYWJs
ZWQgaW4gdGhlIGZpcnN0IHBsYWNlLgogICovCi1pbnQgeGNfbWVtc2hyX3JpbmdfZGlzYWJsZSh4
Y19pbnRlcmZhY2UgKnhjaCwgCitpbnQgeGNfbWVtc2hyX3JpbmdfZGlzYWJsZSh4Y19pbnRlcmZh
Y2UgKnhjaCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90IGRvbWlkKTsKIAog
LyoKQEAgLTIxMjYsNyArMjEyNiw3IEBAIGludCB4Y19tZW1zaHJfcmluZ19kaXNhYmxlKHhjX2lu
dGVyZmFjZSAqeGNoLAogaW50IHhjX21lbXNocl9kb21haW5fcmVzdW1lKHhjX2ludGVyZmFjZSAq
eGNoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90IGRvbWlkKTsKIAotLyog
U2VsZWN0IGEgcGFnZSBmb3Igc2hhcmluZy4gCisvKiBTZWxlY3QgYSBwYWdlIGZvciBzaGFyaW5n
LgogICoKICAqIEEgNjQgYml0IG9wYXF1ZSBoYW5kbGUgd2lsbCBiZSBzdG9yZWQgaW4gaGFuZGxl
LiAgVGhlIGh5cGVydmlzb3IgZW5zdXJlcwogICogdGhhdCBpZiB0aGUgcGFnZSBpcyBtb2RpZmll
ZCwgdGhlIGhhbmRsZSB3aWxsIGJlIGludmFsaWRhdGVkLCBhbmQgZnV0dXJlCkBAIC0yMTU1LDcg
KzIxNTUsNyBAQCBpbnQgeGNfbWVtc2hyX25vbWluYXRlX2dyZWYoeGNfaW50ZXJmYWNlICp4Y2gs
CiAKIC8qIFRoZSB0aHJlZSBjYWxscyBiZWxvdyBtYXkgZmFpbCB3aXRoCiAgKiAxMCAob3IgLVhF
Tk1FTV9TSEFSSU5HX09QX1NfSEFORExFX0lOVkFMSUQpIGlmIHRoZSBoYW5kbGUgcGFzc2VkIGFz
IHNvdXJjZQotICogaXMgaW52YWxpZC4gIAorICogaXMgaW52YWxpZC4KICAqIDkgKG9yIC1YRU5N
RU1fU0hBUklOR19PUF9DX0hBTkRMRV9JTlZBTElEKSBpZiB0aGUgaGFuZGxlIHBhc3NlZCBhcyBj
bGllbnQgaXMKICAqIGludmFsaWQuCiAgKi8KQEAgLTIxNjgsNyArMjE2OCw3IEBAIGludCB4Y19t
ZW1zaHJfbm9taW5hdGVfZ3JlZih4Y19pbnRlcmZhY2UgKnhjaCwKICAqCiAgKiBBZnRlciBzdWNj
ZXNzZnVsIHNoYXJpbmcsIHRoZSBjbGllbnQgaGFuZGxlIGJlY29tZXMgaW52YWxpZC4gQm90aCA8
ZG9tYWluLAogICogZ2ZuPiB0dXBsZXMgcG9pbnQgdG8gdGhlIHNhbWUgbWZuIHdpdGggdGhlIHNh
bWUgaGFuZGxlLCB0aGUgb25lIHNwZWNpZmllZCBhcwotICogc291cmNlLiBFaXRoZXIgMy10dXBs
ZSBjYW4gYmUgc3BlY2lmaWVkIGxhdGVyIGZvciBmdXJ0aGVyIHJlLXNoYXJpbmcuIAorICogc291
cmNlLiBFaXRoZXIgMy10dXBsZSBjYW4gYmUgc3BlY2lmaWVkIGxhdGVyIGZvciBmdXJ0aGVyIHJl
LXNoYXJpbmcuCiAgKi8KIGludCB4Y19tZW1zaHJfc2hhcmVfZ2Zucyh4Y19pbnRlcmZhY2UgKnhj
aCwKICAgICAgICAgICAgICAgICAgICAgdWludDMyX3Qgc291cmNlX2RvbWFpbiwKQEAgLTIxOTMs
NyArMjE5Myw3IEBAIGludCB4Y19tZW1zaHJfc2hhcmVfZ3JlZnMoeGNfaW50ZXJmYWNlICp4Y2gs
CiAvKiBBbGxvd3MgdG8gYWRkIHRvIHRoZSBndWVzdCBwaHlzbWFwIG9mIHRoZSBjbGllbnQgZG9t
YWluIGEgc2hhcmVkIGZyYW1lCiAgKiBkaXJlY3RseS4KICAqCi0gKiBNYXkgYWRkaXRpb25hbGx5
IGZhaWwgd2l0aCAKKyAqIE1heSBhZGRpdGlvbmFsbHkgZmFpbCB3aXRoCiAgKiAgOSAoLVhFTk1F
TV9TSEFSSU5HX09QX0NfSEFORExFX0lOVkFMSUQpIGlmIHRoZSBwaHlzbWFwIGVudHJ5IGZvciB0
aGUgZ2ZuIGlzCiAgKiAgbm90IHN1aXRhYmxlLgogICogIEVOT01FTSBpZiBpbnRlcm5hbCBkYXRh
IHN0cnVjdHVyZXMgY2Fubm90IGJlIGFsbG9jYXRlZC4KQEAgLTIyMjIsNyArMjIyMiw3IEBAIGlu
dCB4Y19tZW1zaHJfcmFuZ2Vfc2hhcmUoeGNfaW50ZXJmYWNlICp4Y2gsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHVpbnQ2NF90IGxhc3RfZ2ZuKTsKIAogLyogRGVidWcgY2FsbHM6IHJldHVy
biB0aGUgbnVtYmVyIG9mIHBhZ2VzIHJlZmVyZW5jaW5nIHRoZSBzaGFyZWQgZnJhbWUgYmFja2lu
ZwotICogdGhlIGlucHV0IGFyZ3VtZW50LiBTaG91bGQgYmUgb25lIG9yIGdyZWF0ZXIuIAorICog
dGhlIGlucHV0IGFyZ3VtZW50LiBTaG91bGQgYmUgb25lIG9yIGdyZWF0ZXIuCiAgKgogICogTWF5
IGZhaWwgd2l0aCBFSU5WQUwgaWYgdGhlcmUgaXMgbm8gYmFja2luZyBzaGFyZWQgZnJhbWUgZm9y
IHRoZSBpbnB1dAogICogYXJndW1lbnQuCkBAIC0yMjM1LDkgKzIyMzUsOSBAQCBpbnQgeGNfbWVt
c2hyX2RlYnVnX2dyZWYoeGNfaW50ZXJmYWNlICp4Y2gsCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgdWludDMyX3QgZG9taWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JhbnRfcmVmX3Qg
Z3JlZik7CiAKLS8qIEF1ZGl0cyB0aGUgc2hhcmUgc3Vic3lzdGVtLiAKLSAqIAotICogUmV0dXJu
cyBFTk9TWVMgaWYgbm90IHN1cHBvcnRlZCAobWF5IG5vdCBiZSBjb21waWxlZCBpbnRvIHRoZSBo
eXBlcnZpc29yKS4gCisvKiBBdWRpdHMgdGhlIHNoYXJlIHN1YnN5c3RlbS4KKyAqCisgKiBSZXR1
cm5zIEVOT1NZUyBpZiBub3Qgc3VwcG9ydGVkIChtYXkgbm90IGJlIGNvbXBpbGVkIGludG8gdGhl
IGh5cGVydmlzb3IpLgogICoKICAqIFJldHVybnMgdGhlIG51bWJlciBvZiBlcnJvcnMgZm91bmQg
ZHVyaW5nIGF1ZGl0aW5nIG90aGVyd2lzZS4gTWF5IGJlIChzaG91bGQKICAqIGJlISkgemVyby4K
QEAgLTIyNzMsNyArMjI3Myw3IEBAIGxvbmcgeGNfc2hhcmluZ19mcmVlZF9wYWdlcyh4Y19pbnRl
cmZhY2UgKnhjaCk7CiAgKiBzaG91bGQgcmV0dXJuIDEuIChBbmQgZG9taW5mbyhkKSBmb3IgZWFj
aCBvZiB0aGUgdHdvIGRvbWFpbnMgc2hvdWxkIHJldHVybiAxCiAgKiBhcyB3ZWxsKS4KICAqCi0g
KiBOb3RlIHRoYXQgc29tZSBvZiB0aGVzZSBzaGFyaW5nX3VzZWRfZnJhbWVzIG1heSBiZSByZWZl
cmVuY2VkIGJ5IAorICogTm90ZSB0aGF0IHNvbWUgb2YgdGhlc2Ugc2hhcmluZ191c2VkX2ZyYW1l
cyBtYXkgYmUgcmVmZXJlbmNlZCBieQogICogYSBzaW5nbGUgZG9tYWluIHBhZ2UsIGFuZCB0aHVz
IG5vdCByZWFsaXplIGFueSBzYXZpbmdzLiBUaGUgc2FtZQogICogYXBwbGllcyB0byBzb21lIG9m
IHRoZSBwYWdlcyBjb3VudGVkIGluIGRvbWluZm8oZCktPnNocl9wYWdlcy4KICAqLwpkaWZmIC0t
Z2l0IGEvdG9vbHMvbGlieGMveGNfbWVtc2hyLmMgYi90b29scy9saWJ4Yy94Y19tZW1zaHIuYwpp
bmRleCBkNWUxMzVlMGQ5Li41ZWY1NmE2OTMzIDEwMDY0NAotLS0gYS90b29scy9saWJ4Yy94Y19t
ZW1zaHIuYworKysgYi90b29scy9saWJ4Yy94Y19tZW1zaHIuYwpAQCAtNDEsNyArNDEsNyBAQCBp
bnQgeGNfbWVtc2hyX2NvbnRyb2woeGNfaW50ZXJmYWNlICp4Y2gsCiAgICAgcmV0dXJuIGRvX2Rv
bWN0bCh4Y2gsICZkb21jdGwpOwogfQogCi1pbnQgeGNfbWVtc2hyX3JpbmdfZW5hYmxlKHhjX2lu
dGVyZmFjZSAqeGNoLCAKK2ludCB4Y19tZW1zaHJfcmluZ19lbmFibGUoeGNfaW50ZXJmYWNlICp4
Y2gsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90IGRvbWlkLAogICAgICAgICAg
ICAgICAgICAgICAgICAgICB1aW50MzJfdCAqcG9ydCkKIHsKQEAgLTU3LDcgKzU3LDcgQEAgaW50
IHhjX21lbXNocl9yaW5nX2VuYWJsZSh4Y19pbnRlcmZhY2UgKnhjaCwKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBwb3J0KTsKIH0KIAotaW50IHhjX21lbXNocl9yaW5nX2Rpc2FibGUo
eGNfaW50ZXJmYWNlICp4Y2gsIAoraW50IHhjX21lbXNocl9yaW5nX2Rpc2FibGUoeGNfaW50ZXJm
YWNlICp4Y2gsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCBkb21pZCkKIHsK
ICAgICByZXR1cm4geGNfdm1fZXZlbnRfY29udHJvbCh4Y2gsIGRvbWlkLApAQCAtODUsMTEgKzg1
LDExIEBAIGludCB4Y19tZW1zaHJfbm9taW5hdGVfZ2ZuKHhjX2ludGVyZmFjZSAqeGNoLAogICAg
IG1lbXNldCgmbXNvLCAwLCBzaXplb2YobXNvKSk7CiAKICAgICBtc28ub3AgPSBYRU5NRU1fc2hh
cmluZ19vcF9ub21pbmF0ZV9nZm47Ci0gICAgbXNvLnUubm9taW5hdGUudS5nZm4gPSBnZm47IAor
ICAgIG1zby51Lm5vbWluYXRlLnUuZ2ZuID0gZ2ZuOwogCiAgICAgcmMgPSB4Y19tZW1zaHJfbWVt
b3AoeGNoLCBkb21pZCwgJm1zbyk7CiAKLSAgICBpZiAoIXJjKSAqaGFuZGxlID0gbXNvLnUubm9t
aW5hdGUuaGFuZGxlOyAKKyAgICBpZiAoIXJjKSAqaGFuZGxlID0gbXNvLnUubm9taW5hdGUuaGFu
ZGxlOwogCiAgICAgcmV0dXJuIHJjOwogfQpAQCAtMTA1LDExICsxMDUsMTEgQEAgaW50IHhjX21l
bXNocl9ub21pbmF0ZV9ncmVmKHhjX2ludGVyZmFjZSAqeGNoLAogICAgIG1lbXNldCgmbXNvLCAw
LCBzaXplb2YobXNvKSk7CiAKICAgICBtc28ub3AgPSBYRU5NRU1fc2hhcmluZ19vcF9ub21pbmF0
ZV9ncmVmOwotICAgIG1zby51Lm5vbWluYXRlLnUuZ3JhbnRfcmVmID0gZ3JlZjsgCisgICAgbXNv
LnUubm9taW5hdGUudS5ncmFudF9yZWYgPSBncmVmOwogCiAgICAgcmMgPSB4Y19tZW1zaHJfbWVt
b3AoeGNoLCBkb21pZCwgJm1zbyk7CiAKLSAgICBpZiAoIXJjKSAqaGFuZGxlID0gbXNvLnUubm9t
aW5hdGUuaGFuZGxlOyAKKyAgICBpZiAoIXJjKSAqaGFuZGxlID0gbXNvLnUubm9taW5hdGUuaGFu
ZGxlOwogCiAgICAgcmV0dXJuIHJjOwogfQotLSAKMi4yMC4xCgoKX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4t
ZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9t
YWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

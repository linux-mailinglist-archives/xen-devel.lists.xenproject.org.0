Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 155F3B782F
	for <lists+xen-devel@lfdr.de>; Thu, 19 Sep 2019 13:07:50 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iAuFJ-0003KZ-AG; Thu, 19 Sep 2019 11:05:09 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=vwgP=XO=citrix.com=anthony.perard@srs-us1.protection.inumbo.net>)
 id 1iAuFH-0003Ii-1n
 for xen-devel@lists.xenproject.org; Thu, 19 Sep 2019 11:05:07 +0000
X-Inumbo-ID: 4acd6d32-dacd-11e9-978d-bc764e2007e4
Received: from esa4.hc3370-68.iphmx.com (unknown [216.71.155.144])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 4acd6d32-dacd-11e9-978d-bc764e2007e4;
 Thu, 19 Sep 2019 11:04:47 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1568891087;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=KqTbJKINiIo+431UahBxtuHEzMV3isaEDu1HbAroc3E=;
 b=D1wG/hu+sWCk+qA0R7sfo3SpC/KNcBPufoHElSleDqAnQVg5Lk+8eA94
 +YJqZWY97hkMNKA9/m2+6uIjKkP3iNu0+g4NhOByL+YwJvpkaEGv+RDJL
 dZBdQ5Ya7X81t/CdC/g5QbsWXgOzH2QNwuDOK/CIyfj7I4v3xhvKt7peo 8=;
Authentication-Results: esa4.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=anthony.perard@citrix.com;
 spf=Pass smtp.mailfrom=anthony.perard@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa4.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 anthony.perard@citrix.com) identity=pra;
 client-ip=162.221.158.21; receiver=esa4.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="anthony.perard@citrix.com";
 x-conformance=sidf_compatible
Received-SPF: Pass (esa4.hc3370-68.iphmx.com: domain of
 anthony.perard@citrix.com designates 162.221.158.21 as
 permitted sender) identity=mailfrom;
 client-ip=162.221.158.21; receiver=esa4.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="anthony.perard@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83 ~all"
Received-SPF: None (esa4.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa4.hc3370-68.iphmx.com;
 envelope-from="anthony.perard@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: kQ77wTU15pPUH71gH2pfGXj4GZs9LGzoo37uPjO2O4Zs4uNON8WgCaqIajagEb18viYl0zi9XS
 9EQc2YiFOADB17OoJORaa6hd3WIL3HEclPQB6ViaVuz+3Hfahg3GkkwZWVowq9M9v9+1N9ZrM6
 3GFFtoGVmGoJ4dzJvEZV1MKfYnY5bFmxBh8NBOwYc97HzlBt4aQLedRI8Px5HtMFUqeCi6YeeN
 p7d3h1xlIEK3EHJJ9XNPCfuEy6ugwOqyxP2uaB+CaPSABjZZ9cWNujv+taerIzuded1vwn0zvY
 6b0=
X-SBRS: 2.7
X-MesageID: 6097789
X-Ironport-Server: esa4.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.64,523,1559534400"; 
   d="scan'208";a="6097789"
From: Anthony PERARD <anthony.perard@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Thu, 19 Sep 2019 12:04:43 +0100
Message-ID: <20190919110443.817594-10-anthony.perard@citrix.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190919110443.817594-1-anthony.perard@citrix.com>
References: <20190919110443.817594-1-anthony.perard@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v3 9/9] libxl_disk: Use ev_qmp in
 libxl_cdrom_insert
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Anthony PERARD <anthony.perard@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Wei Liu <wl@xen.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

TWFrZSBsaWJ4bF9jZHJvbV9pbnNlcnQgYXN5bmNocm9ub3VzIHdoZW4gUUVNVSBpcyBpbnZvbHZl
ZC4gIEFuZApoYXZlIHRoZSBjZHJvbSBvcGVuZWQgYnkgbGlieGwsIHNlbmRpbmcgYSBmaWxlIGRl
c2NyaXB0b3IgdG8gUUVNVS4KClRoZSAib3BhcXVlIiBwYXJhbWV0ZXIgb2YgdGhlICJhZGQtZmQi
IGNhbiBoZWxwIHRvIGZpZ3VyZSBvdXQgd2hhdCBhCmZkc2V0IGluIFFFTVUgaXMgdXNlZCBmb3Iu
IEl0IGNhbiBiZSBxdWVyaWVkIGJ5ICJxdWVyeS1mZHNldHMiLgoKU2lnbmVkLW9mZi1ieTogQW50
aG9ueSBQRVJBUkQgPGFudGhvbnkucGVyYXJkQGNpdHJpeC5jb20+CkFja2VkLWJ5OiBJYW4gSmFj
a3NvbiA8aWFuLmphY2tzb25AZXUuY2l0cml4LmNvbT4KLS0tCgpOb3RlczoKICAgIHYyOgogICAg
LSBhY2tlZAogICAgLSBhc3NlcnQgdGhhdCB0aGVyZSdzIG5vIHBheWxvYWRfZmQgYmVmb3JlIG9w
ZW5uaW5nIGEgY2Ryb20gZmlsZQogICAgLSByZW5hbWVkIGZsYWcgYGFzeW5jaHJvbm91c19jYWxs
YmFjaycgLT4gYGhhc19jYWxsYmFjaycKCiB0b29scy9saWJ4bC9saWJ4bF9kaXNrLmMgICAgIHwg
MTI2ICsrKysrKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tCiB0b29scy9saWJ4bC9saWJ4
bF9pbnRlcm5hbC5oIHwgICAxIC0KIHRvb2xzL2xpYnhsL2xpYnhsX3FtcC5jICAgICAgfCAgMTgg
LS0tLS0KIDMgZmlsZXMgY2hhbmdlZCwgMTAwIGluc2VydGlvbnMoKyksIDQ1IGRlbGV0aW9ucygt
KQoKZGlmZiAtLWdpdCBhL3Rvb2xzL2xpYnhsL2xpYnhsX2Rpc2suYyBiL3Rvb2xzL2xpYnhsL2xp
YnhsX2Rpc2suYwppbmRleCA1Y2MyMTU5MDZmY2MuLjA1ZGM5YzUxZjMwNiAxMDA2NDQKLS0tIGEv
dG9vbHMvbGlieGwvbGlieGxfZGlzay5jCisrKyBiL3Rvb2xzL2xpYnhsL2xpYnhsX2Rpc2suYwpA
QCAtNjUwLDE0ICs2NTAsMTcgQEAgdHlwZWRlZiBzdHJ1Y3QgewogICAgIGxpYnhsX19ldl9kZXZs
b2NrIHFtcF9sb2NrOwogICAgIGludCBkbV92ZXI7CiAgICAgbGlieGxfX2V2X3RpbWUgdGltZTsK
KyAgICBsaWJ4bF9fZXZfcW1wIHFtcDsKIH0gbGlieGxfX2Nkcm9tX2luc2VydF9zdGF0ZTsKIAog
c3RhdGljIHZvaWQgY2Ryb21faW5zZXJ0X2xvY2tfYWNxdWlyZWQobGlieGxfX2VnYyAqLCBsaWJ4
bF9fZXZfZGV2bG9jayAqLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
aW50IHJjKTsKLXN0YXRpYyB2b2lkIGNkcm9tX2luc2VydF9lamVjdGVkKGxpYnhsX19lZ2MgKmVn
YywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnhsX19jZHJvbV9pbnNlcnRf
c3RhdGUgKmNpcyk7Ci1zdGF0aWMgdm9pZCBjZHJvbV9pbnNlcnRfaW5zZXJ0ZWQobGlieGxfX2Vn
YyAqZWdjLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYnhsX19jZHJvbV9p
bnNlcnRfc3RhdGUgKmNpcyk7CitzdGF0aWMgdm9pZCBjZHJvbV9pbnNlcnRfZWplY3RlZChsaWJ4
bF9fZWdjICplZ2MsIGxpYnhsX19ldl9xbXAgKiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGNvbnN0IGxpYnhsX19qc29uX29iamVjdCAqLCBpbnQgcmMpOworc3RhdGljIHZvaWQg
Y2Ryb21faW5zZXJ0X2FkZGZkX2NiKGxpYnhsX19lZ2MgKmVnYywgbGlieGxfX2V2X3FtcCAqLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxpYnhsX19qc29uX29iamVj
dCAqLCBpbnQgcmMpOworc3RhdGljIHZvaWQgY2Ryb21faW5zZXJ0X2luc2VydGVkKGxpYnhsX19l
Z2MgKmVnYywgbGlieGxfX2V2X3FtcCAqLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGNvbnN0IGxpYnhsX19qc29uX29iamVjdCAqLCBpbnQgcmMpOwogc3RhdGljIHZvaWQgY2Ry
b21faW5zZXJ0X3RpbW91dChsaWJ4bF9fZWdjICplZ2MsIGxpYnhsX19ldl90aW1lICpldiwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RydWN0IHRpbWV2YWwgKnJlcXVl
c3RlZF9hYnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCByYyk7CkBAIC02
ODQsNiArNjg3LDEwIEBAIGludCBsaWJ4bF9jZHJvbV9pbnNlcnQobGlieGxfY3R4ICpjdHgsIHVp
bnQzMl90IGRvbWlkLCBsaWJ4bF9kZXZpY2VfZGlzayAqZGlzaywKICAgICBjaXMtPnFtcF9sb2Nr
LmFvID0gYW87CiAgICAgY2lzLT5xbXBfbG9jay5kb21pZCA9IGRvbWlkOwogICAgIGxpYnhsX19l
dl90aW1lX2luaXQoJmNpcy0+dGltZSk7CisgICAgbGlieGxfX2V2X3FtcF9pbml0KCZjaXMtPnFt
cCk7CisgICAgY2lzLT5xbXAuYW8gPSBhbzsKKyAgICBjaXMtPnFtcC5kb21pZCA9IGRvbWlkOwor
ICAgIGNpcy0+cW1wLnBheWxvYWRfZmQgPSAtMTsKIAogICAgIGxpYnhsX2RvbWFpbl90eXBlIHR5
cGUgPSBsaWJ4bF9fZG9tYWluX3R5cGUoZ2MsIGRvbWlkKTsKICAgICBpZiAodHlwZSA9PSBMSUJY
TF9ET01BSU5fVFlQRV9JTlZBTElEKSB7CkBAIC03NTcsMjYgKzc2NCwyMiBAQCBzdGF0aWMgdm9p
ZCBjZHJvbV9pbnNlcnRfbG9ja19hY3F1aXJlZChsaWJ4bF9fZWdjICplZ2MsCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgTElCWExfSE9UUExVR19USU1FT1VUICogMTAwMCk7
CiAgICAgaWYgKHJjKSBnb3RvIG91dDsKIAotICAgIC8qIFdlIG5lZWQgdG8gZWplY3QgdGhlIG9y
aWdpbmFsIGltYWdlIGZpcnN0LiBUaGlzIGlzIGltcGxlbWVudGVkCi0gICAgICogYnkgaW5zZXJ0
aW5nIGVtcHR5IG1lZGlhLiBKU09OIGlzIG5vdCB1cGRhdGVkLgorICAgIC8qIFdlIG5lZWQgdG8g
ZWplY3QgdGhlIG9yaWdpbmFsIGltYWdlIGZpcnN0LgorICAgICAqIEpTT04gaXMgbm90IHVwZGF0
ZWQuCiAgICAgICovCiAKICAgICBpZiAoY2lzLT5kbV92ZXIgPT0gTElCWExfREVWSUNFX01PREVM
X1ZFUlNJT05fUUVNVV9YRU4pIHsKLSAgICAgICAgbGlieGxfZGV2aWNlX2Rpc2sgZGlza19lbXB0
eTsKLQotICAgICAgICBsaWJ4bF9kZXZpY2VfZGlza19pbml0KCZkaXNrX2VtcHR5KTsKLSAgICAg
ICAgZGlza19lbXB0eS5mb3JtYXQgPSBMSUJYTF9ESVNLX0ZPUk1BVF9FTVBUWTsKLSAgICAgICAg
ZGlza19lbXB0eS52ZGV2ID0gbGlieGxfX3N0cmR1cChOT0dDLCBjaXMtPmRpc2stPnZkZXYpOwot
ICAgICAgICBkaXNrX2VtcHR5LnBkZXZfcGF0aCA9IGxpYnhsX19zdHJkdXAoTk9HQywgIiIpOwot
ICAgICAgICBkaXNrX2VtcHR5LmlzX2Nkcm9tID0gMTsKLSAgICAgICAgbGlieGxfX2RldmljZV9k
aXNrX3NldGRlZmF1bHQoZ2MsIGNpcy0+ZG9taWQsICZkaXNrX2VtcHR5LCBmYWxzZSk7CisgICAg
ICAgIGxpYnhsX19qc29uX29iamVjdCAqYXJncyA9IE5VTEw7CisgICAgICAgIGludCBkZXZpZCA9
IGxpYnhsX19kZXZpY2VfZGlza19kZXZfbnVtYmVyKGNpcy0+ZGlzay0+dmRldiwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTlVMTCwgTlVMTCk7CiAK
LSAgICAgICAgcmMgPSBsaWJ4bF9fcW1wX2luc2VydF9jZHJvbShnYywgY2lzLT5kb21pZCwgJmRp
c2tfZW1wdHkpOwotICAgICAgICBsaWJ4bF9kZXZpY2VfZGlza19kaXNwb3NlKCZkaXNrX2VtcHR5
KTsKKyAgICAgICAgUU1QX1BBUkFNRVRFUlNfU1BSSU5URigmYXJncywgImRldmljZSIsICJpZGUt
JWkiLCBkZXZpZCk7CisgICAgICAgIGNpcy0+cW1wLmNhbGxiYWNrID0gY2Ryb21faW5zZXJ0X2Vq
ZWN0ZWQ7CisgICAgICAgIHJjID0gbGlieGxfX2V2X3FtcF9zZW5kKGdjLCAmY2lzLT5xbXAsICJl
amVjdCIsIGFyZ3MpOwogICAgICAgICBpZiAocmMpIGdvdG8gb3V0OworICAgIH0gZWxzZSB7Cisg
ICAgICAgIGNkcm9tX2luc2VydF9lamVjdGVkKGVnYywgJmNpcy0+cW1wLCBOVUxMLCAwKTsgLyog
bXVzdCBiZSBsYXN0ICovCiAgICAgfQotCi0gICAgY2Ryb21faW5zZXJ0X2VqZWN0ZWQoZWdjLCBj
aXMpOyAvKiBtdXN0IGJlIGxhc3QgKi8KICAgICByZXR1cm47CiAKIG91dDoKQEAgLTc4NCwxMCAr
Nzg3LDEyIEBAIHN0YXRpYyB2b2lkIGNkcm9tX2luc2VydF9sb2NrX2FjcXVpcmVkKGxpYnhsX19l
Z2MgKmVnYywKIH0KIAogc3RhdGljIHZvaWQgY2Ryb21faW5zZXJ0X2VqZWN0ZWQobGlieGxfX2Vn
YyAqZWdjLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlieGxfX2Nkcm9tX2lu
c2VydF9zdGF0ZSAqY2lzKQorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlieGxf
X2V2X3FtcCAqcW1wLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGli
eGxfX2pzb25fb2JqZWN0ICpyZXNwb25zZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGludCByYykKIHsKICAgICBFR0NfR0M7Ci0gICAgaW50IHJjOworICAgIGxpYnhsX19jZHJv
bV9pbnNlcnRfc3RhdGUgKmNpcyA9IENPTlRBSU5FUl9PRihxbXAsICpjaXMsIHFtcCk7CiAgICAg
bGlieGxfX2RvbWFpbl91c2VyZGF0YV9sb2NrICpkYXRhX2xvY2sgPSBOVUxMOwogICAgIGxpYnhs
X19kZXZpY2UgZGV2aWNlOwogICAgIGNvbnN0IGNoYXIgKmJlX3BhdGgsICpsaWJ4bF9wYXRoOwpA
QCAtNzk1LDYgKzgwMCw3IEBAIHN0YXRpYyB2b2lkIGNkcm9tX2luc2VydF9lamVjdGVkKGxpYnhs
X19lZ2MgKmVnYywKICAgICB4c190cmFuc2FjdGlvbl90IHQgPSBYQlRfTlVMTDsKICAgICBjaGFy
ICp0bXA7CiAgICAgbGlieGxfZG9tYWluX2NvbmZpZyBkX2NvbmZpZzsKKyAgICBib29sIGhhc19j
YWxsYmFjayA9IGZhbHNlOwogCiAgICAgLyogY29udmVuaWVuY2UgYWxpYXNlcyAqLwogICAgIGxp
YnhsX2RvbWlkIGRvbWlkID0gY2lzLT5kb21pZDsKQEAgLTgwMiw2ICs4MDgsOCBAQCBzdGF0aWMg
dm9pZCBjZHJvbV9pbnNlcnRfZWplY3RlZChsaWJ4bF9fZWdjICplZ2MsCiAKICAgICBsaWJ4bF9k
b21haW5fY29uZmlnX2luaXQoJmRfY29uZmlnKTsKIAorICAgIGlmIChyYykgZ290byBvdXQ7CisK
ICAgICByYyA9IGxpYnhsX19kZXZpY2VfZnJvbV9kaXNrKGdjLCBkb21pZCwgZGlzaywgJmRldmlj
ZSk7CiAgICAgaWYgKHJjKSBnb3RvIG91dDsKICAgICBiZV9wYXRoID0gbGlieGxfX2RldmljZV9i
YWNrZW5kX3BhdGgoZ2MsICZkZXZpY2UpOwpAQCAtODU3LDkgKzg2NSwyOSBAQCBzdGF0aWMgdm9p
ZCBjZHJvbV9pbnNlcnRfZWplY3RlZChsaWJ4bF9fZWdjICplZ2MsCiAgICAgcmMgPSBsaWJ4bF9f
ZG1fY2hlY2tfc3RhcnQoZ2MsICZkX2NvbmZpZywgZG9taWQpOwogICAgIGlmIChyYykgZ290byBv
dXQ7CiAKLSAgICBpZiAoY2lzLT5kbV92ZXIgPT0gTElCWExfREVWSUNFX01PREVMX1ZFUlNJT05f
UUVNVV9YRU4pIHsKLSAgICAgICAgcmMgPSBsaWJ4bF9fcW1wX2luc2VydF9jZHJvbShnYywgZG9t
aWQsIGRpc2spOworICAgIGlmIChjaXMtPmRtX3ZlciA9PSBMSUJYTF9ERVZJQ0VfTU9ERUxfVkVS
U0lPTl9RRU1VX1hFTiAmJgorICAgICAgICBkaXNrLT5mb3JtYXQgIT0gTElCWExfRElTS19GT1JN
QVRfRU1QVFkpIHsKKyAgICAgICAgbGlieGxfX2pzb25fb2JqZWN0ICphcmdzID0gTlVMTDsKKwor
ICAgICAgICBhc3NlcnQocW1wLT5wYXlsb2FkX2ZkID09IC0xKTsKKyAgICAgICAgcW1wLT5wYXls
b2FkX2ZkID0gb3BlbihkaXNrLT5wZGV2X3BhdGgsIE9fUkRPTkxZKTsKKyAgICAgICAgaWYgKHFt
cC0+cGF5bG9hZF9mZCA8IDApIHsKKyAgICAgICAgICAgIExPR0VEKEVSUk9SLCBkb21pZCwgIkZh
aWxlZCB0byBvcGVuIGNkcm9tIGZpbGUgJXMiLAorICAgICAgICAgICAgICAgICAgZGlzay0+cGRl
dl9wYXRoKTsKKyAgICAgICAgICAgIHJjID0gRVJST1JfRkFJTDsKKyAgICAgICAgICAgIGdvdG8g
b3V0OworICAgICAgICB9CisKKyAgICAgICAgLyogVGhpcyBmcmVlIGZvcm0gcGFyYW1ldGVyIGlz
IG5vdCB1c2UgYnkgUUVNVSBvciBsaWJ4bC4gKi8KKyAgICAgICAgUU1QX1BBUkFNRVRFUlNfU1BS
SU5URigmYXJncywgIm9wYXF1ZSIsICIlczolcyIsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgbGlieGxfZGlza19mb3JtYXRfdG9fc3RyaW5nKGRpc2stPmZvcm1hdCksCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgZGlzay0+cGRldl9wYXRoKTsKKyAgICAgICAgcW1wLT5j
YWxsYmFjayA9IGNkcm9tX2luc2VydF9hZGRmZF9jYjsKKyAgICAgICAgcmMgPSBsaWJ4bF9fZXZf
cW1wX3NlbmQoZ2MsIHFtcCwgImFkZC1mZCIsIGFyZ3MpOwogICAgICAgICBpZiAocmMpIGdvdG8g
b3V0OworICAgICAgICBoYXNfY2FsbGJhY2sgPSB0cnVlOworICAgIH0gZWxzZSB7CisgICAgICAg
IGhhc19jYWxsYmFjayA9IGZhbHNlOwogICAgIH0KIAogICAgIHJjID0gMDsKQEAgLTg3MCwxNiAr
ODk4LDU4IEBAIHN0YXRpYyB2b2lkIGNkcm9tX2luc2VydF9lamVjdGVkKGxpYnhsX19lZ2MgKmVn
YywKICAgICBpZiAoZGF0YV9sb2NrKSBsaWJ4bF9fdW5sb2NrX2RvbWFpbl91c2VyZGF0YShkYXRh
X2xvY2spOwogICAgIGlmIChyYykgewogICAgICAgICBjZHJvbV9pbnNlcnRfZG9uZShlZ2MsIGNp
cywgcmMpOyAvKiBtdXN0IGJlIGxhc3QgKi8KLSAgICB9IGVsc2UgewotICAgICAgICBjZHJvbV9p
bnNlcnRfaW5zZXJ0ZWQoZWdjLCBjaXMpOyAvKiBtdXN0IGJlIGxhc3QgKi8KKyAgICB9IGVsc2Ug
aWYgKCFoYXNfY2FsbGJhY2spIHsKKyAgICAgICAgLyogT25seSBjYWxsZWQgaWYgbm8gYXN5bmNo
cm9ub3VzIGNhbGxiYWNrIGFyZSBzZXQuICovCisgICAgICAgIGNkcm9tX2luc2VydF9pbnNlcnRl
ZChlZ2MsIHFtcCwgTlVMTCwgMCk7IC8qIG11c3QgYmUgbGFzdCAqLworICAgIH0KK30KKworc3Rh
dGljIHZvaWQgY2Ryb21faW5zZXJ0X2FkZGZkX2NiKGxpYnhsX19lZ2MgKmVnYywKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ4bF9fZXZfcW1wICpxbXAsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGlieGxfX2pzb25fb2JqZWN0ICpyZXNwb25z
ZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgcmMpCit7CisgICAgRUdD
X0dDOworICAgIGxpYnhsX19jZHJvbV9pbnNlcnRfc3RhdGUgKmNpcyA9IENPTlRBSU5FUl9PRihx
bXAsICpjaXMsIHFtcCk7CisgICAgbGlieGxfX2pzb25fb2JqZWN0ICphcmdzID0gTlVMTDsKKyAg
ICBjb25zdCBsaWJ4bF9fanNvbl9vYmplY3QgKm87CisgICAgaW50IGRldmlkOworICAgIGludCBm
ZHNldDsKKworICAgIC8qIGNvbnZlbmllbmNlIGFsaWFzZXMgKi8KKyAgICBsaWJ4bF9kZXZpY2Vf
ZGlzayAqZGlzayA9IGNpcy0+ZGlzazsKKworICAgIGNsb3NlKHFtcC0+cGF5bG9hZF9mZCk7Cisg
ICAgcW1wLT5wYXlsb2FkX2ZkID0gLTE7CisKKyAgICBpZiAocmMpIGdvdG8gb3V0OworCisgICAg
byA9IGxpYnhsX19qc29uX21hcF9nZXQoImZkc2V0LWlkIiwgcmVzcG9uc2UsIEpTT05fSU5URUdF
Uik7CisgICAgaWYgKCFvKSB7CisgICAgICAgIHJjID0gRVJST1JfRkFJTDsKKyAgICAgICAgZ290
byBvdXQ7CiAgICAgfQorICAgIGZkc2V0ID0gbGlieGxfX2pzb25fb2JqZWN0X2dldF9pbnRlZ2Vy
KG8pOworCisgICAgZGV2aWQgPSBsaWJ4bF9fZGV2aWNlX2Rpc2tfZGV2X251bWJlcihkaXNrLT52
ZGV2LCBOVUxMLCBOVUxMKTsKKyAgICBRTVBfUEFSQU1FVEVSU19TUFJJTlRGKCZhcmdzLCAiZGV2
aWNlIiwgImlkZS0laSIsIGRldmlkKTsKKyAgICBRTVBfUEFSQU1FVEVSU19TUFJJTlRGKCZhcmdz
LCAidGFyZ2V0IiwgIi9kZXYvZmRzZXQvJWQiLCBmZHNldCk7CisgICAgbGlieGxfX3FtcF9wYXJh
bV9hZGRfc3RyaW5nKGdjLCAmYXJncywgImFyZyIsCisgICAgICAgIGxpYnhsX19xZW11X2Rpc2tf
Zm9ybWF0X3N0cmluZyhkaXNrLT5mb3JtYXQpKTsKKyAgICBxbXAtPmNhbGxiYWNrID0gY2Ryb21f
aW5zZXJ0X2luc2VydGVkOworICAgIHJjID0gbGlieGxfX2V2X3FtcF9zZW5kKGdjLCBxbXAsICJj
aGFuZ2UiLCBhcmdzKTsKK291dDoKKyAgICBpZiAocmMpCisgICAgICAgIGNkcm9tX2luc2VydF9k
b25lKGVnYywgY2lzLCByYyk7IC8qIG11c3QgYmUgbGFzdCAqLwogfQogCiBzdGF0aWMgdm9pZCBj
ZHJvbV9pbnNlcnRfaW5zZXJ0ZWQobGlieGxfX2VnYyAqZWdjLAotICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGxpYnhsX19jZHJvbV9pbnNlcnRfc3RhdGUgKmNpcykKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ4bF9fZXZfcW1wICpxbXAsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGlieGxfX2pzb25fb2JqZWN0ICpyZXNwb25z
ZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgcmMpCiB7CiAgICAgRUdD
X0dDOwotICAgIGludCByYzsKKyAgICBsaWJ4bF9fY2Ryb21faW5zZXJ0X3N0YXRlICpjaXMgPSBD
T05UQUlORVJfT0YocW1wLCAqY2lzLCBxbXApOwogICAgIGxpYnhsX19kb21haW5fdXNlcmRhdGFf
bG9jayAqZGF0YV9sb2NrID0gTlVMTDsKICAgICBsaWJ4bF9kb21haW5fY29uZmlnIGRfY29uZmln
OwogICAgIGZsZXhhcnJheV90ICppbnNlcnQgPSBOVUxMOwpAQCAtODk0LDYgKzk2NCw4IEBAIHN0
YXRpYyB2b2lkIGNkcm9tX2luc2VydF9pbnNlcnRlZChsaWJ4bF9fZWdjICplZ2MsCiAKICAgICBs
aWJ4bF9kb21haW5fY29uZmlnX2luaXQoJmRfY29uZmlnKTsKIAorICAgIGlmIChyYykgZ290byBv
dXQ7CisKICAgICByYyA9IGxpYnhsX19kZXZpY2VfZnJvbV9kaXNrKGdjLCBkb21pZCwgZGlzaywg
JmRldmljZSk7CiAgICAgaWYgKHJjKSBnb3RvIG91dDsKICAgICBiZV9wYXRoID0gbGlieGxfX2Rl
dmljZV9iYWNrZW5kX3BhdGgoZ2MsICZkZXZpY2UpOwpAQCAtOTc3LDYgKzEwNDksOCBAQCBzdGF0
aWMgdm9pZCBjZHJvbV9pbnNlcnRfZG9uZShsaWJ4bF9fZWdjICplZ2MsCiAgICAgRUdDX0dDOwog
CiAgICAgbGlieGxfX2V2X3RpbWVfZGVyZWdpc3RlcihnYywgJmNpcy0+dGltZSk7CisgICAgbGli
eGxfX2V2X3FtcF9kaXNwb3NlKGdjLCAmY2lzLT5xbXApOworICAgIGlmIChjaXMtPnFtcC5wYXls
b2FkX2ZkID49IDApIGNsb3NlKGNpcy0+cW1wLnBheWxvYWRfZmQpOwogICAgIGxpYnhsX19ldl9k
ZXZsb2NrX3VubG9jayhnYywgJmNpcy0+cW1wX2xvY2spOwogICAgIGxpYnhsX2RldmljZV9kaXNr
X2Rpc3Bvc2UoJmNpcy0+ZGlza19zYXZlZCk7CiAgICAgbGlieGxfX2FvX2NvbXBsZXRlKGVnYywg
Y2lzLT5hbywgcmMpOwpkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGlieGxfaW50ZXJuYWwuaCBi
L3Rvb2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmgKaW5kZXggZTg1NTQ3ZTY3NjcyLi45M2JmNjVl
ZTlhZjggMTAwNjQ0Ci0tLSBhL3Rvb2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmgKKysrIGIvdG9v
bHMvbGlieGwvbGlieGxfaW50ZXJuYWwuaApAQCAtMTk2MCw3ICsxOTYwLDYgQEAgX2hpZGRlbiBp
bnQgbGlieGxfX3FtcF9yZXN1bWUobGlieGxfX2djICpnYywgaW50IGRvbWlkKTsKIF9oaWRkZW4g
aW50IGxpYnhsX19xbXBfcmVzdG9yZShsaWJ4bF9fZ2MgKmdjLCBpbnQgZG9taWQsIGNvbnN0IGNo
YXIgKmZpbGVuYW1lKTsKIC8qIFNldCBkaXJ0eSBiaXRtYXAgbG9nZ2luZyBzdGF0dXMgKi8KIF9o
aWRkZW4gaW50IGxpYnhsX19xbXBfc2V0X2dsb2JhbF9kaXJ0eV9sb2cobGlieGxfX2djICpnYywg
aW50IGRvbWlkLCBib29sIGVuYWJsZSk7Ci1faGlkZGVuIGludCBsaWJ4bF9fcW1wX2luc2VydF9j
ZHJvbShsaWJ4bF9fZ2MgKmdjLCBpbnQgZG9taWQsIGNvbnN0IGxpYnhsX2RldmljZV9kaXNrICpk
aXNrKTsKIC8qIEFkZCBhIHZpcnR1YWwgQ1BVICovCiBfaGlkZGVuIGludCBsaWJ4bF9fcW1wX2Nw
dV9hZGQobGlieGxfX2djICpnYywgaW50IGRvbWlkLCBpbnQgaW5kZXgpOwogLyogUXVlcnkgdGhl
IGJpdG1hcCBvZiBDUFVzICovCmRpZmYgLS1naXQgYS90b29scy9saWJ4bC9saWJ4bF9xbXAuYyBi
L3Rvb2xzL2xpYnhsL2xpYnhsX3FtcC5jCmluZGV4IDY5M2M1ZDcwNTcyMC4uMjBkOWVlZDhkZGM4
IDEwMDY0NAotLS0gYS90b29scy9saWJ4bC9saWJ4bF9xbXAuYworKysgYi90b29scy9saWJ4bC9s
aWJ4bF9xbXAuYwpAQCAtMTExOCwyNCArMTExOCw2IEBAIGludCBsaWJ4bF9fcW1wX3NldF9nbG9i
YWxfZGlydHlfbG9nKGxpYnhsX19nYyAqZ2MsIGludCBkb21pZCwgYm9vbCBlbmFibGUpCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBOVUxMLCBOVUxMKTsKIH0KIAotaW50IGxpYnhsX19xbXBf
aW5zZXJ0X2Nkcm9tKGxpYnhsX19nYyAqZ2MsIGludCBkb21pZCwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBjb25zdCBsaWJ4bF9kZXZpY2VfZGlzayAqZGlzaykKLXsKLSAgICBsaWJ4bF9f
anNvbl9vYmplY3QgKmFyZ3MgPSBOVUxMOwotICAgIGludCBkZXZfbnVtYmVyID0gbGlieGxfX2Rl
dmljZV9kaXNrX2Rldl9udW1iZXIoZGlzay0+dmRldiwgTlVMTCwgTlVMTCk7Ci0KLSAgICBRTVBf
UEFSQU1FVEVSU19TUFJJTlRGKCZhcmdzLCAiZGV2aWNlIiwgImlkZS0laSIsIGRldl9udW1iZXIp
OwotCi0gICAgaWYgKGRpc2stPmZvcm1hdCA9PSBMSUJYTF9ESVNLX0ZPUk1BVF9FTVBUWSkgewot
ICAgICAgICByZXR1cm4gcW1wX3J1bl9jb21tYW5kKGdjLCBkb21pZCwgImVqZWN0IiwgYXJncywg
TlVMTCwgTlVMTCk7Ci0gICAgfSBlbHNlIHsKLSAgICAgICAgbGlieGxfX3FtcF9wYXJhbV9hZGRf
c3RyaW5nKGdjLCAmYXJncywgInRhcmdldCIsIGRpc2stPnBkZXZfcGF0aCk7Ci0gICAgICAgIGxp
YnhsX19xbXBfcGFyYW1fYWRkX3N0cmluZyhnYywgJmFyZ3MsICJhcmciLAotICAgICAgICAgICAg
bGlieGxfX3FlbXVfZGlza19mb3JtYXRfc3RyaW5nKGRpc2stPmZvcm1hdCkpOwotICAgICAgICBy
ZXR1cm4gcW1wX3J1bl9jb21tYW5kKGdjLCBkb21pZCwgImNoYW5nZSIsIGFyZ3MsIE5VTEwsIE5V
TEwpOwotICAgIH0KLX0KLQogaW50IGxpYnhsX19xbXBfY3B1X2FkZChsaWJ4bF9fZ2MgKmdjLCBp
bnQgZG9taWQsIGludCBpZHgpCiB7CiAgICAgbGlieGxfX2pzb25fb2JqZWN0ICphcmdzID0gTlVM
TDsKLS0gCkFudGhvbnkgUEVSQVJECgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVu
cHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZv
L3hlbi1kZXZlbA==

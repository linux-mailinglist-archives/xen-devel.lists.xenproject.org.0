Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 4C10C58571
	for <lists+xen-devel@lfdr.de>; Thu, 27 Jun 2019 17:21:55 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hgWBf-0003CZ-9l; Thu, 27 Jun 2019 15:19:47 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=LRcK=U2=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1hgWBd-0003CS-W3
 for xen-devel@lists.xenproject.org; Thu, 27 Jun 2019 15:19:46 +0000
X-Inumbo-ID: fc45394e-98ee-11e9-8ba8-a312dbcb7cff
Received: from prv1-mh.provo.novell.com (unknown [137.65.248.33])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id fc45394e-98ee-11e9-8ba8-a312dbcb7cff;
 Thu, 27 Jun 2019 15:19:42 +0000 (UTC)
Received: from INET-PRV1-MTA by prv1-mh.provo.novell.com
 with Novell_GroupWise; Thu, 27 Jun 2019 09:19:41 -0600
Message-Id: <5D14DE87020000780023B97E@prv1-mh.provo.novell.com>
X-Mailer: Novell GroupWise Internet Agent 18.1.1 
Date: Thu, 27 Jun 2019 09:19:35 -0600
From: "Jan Beulich" <JBeulich@suse.com>
To: "xen-devel" <xen-devel@lists.xenproject.org>
References: <5D024C500200007800237DD8@prv1-mh.provo.novell.com>
 <5D14DDA6020000780023B96E@prv1-mh.provo.novell.com>
In-Reply-To: <5D14DDA6020000780023B96E@prv1-mh.provo.novell.com>
Mime-Version: 1.0
Content-Disposition: inline
Subject: [Xen-devel] [PATCH v2 02/10] AMD/IOMMU: use bit field for extended
 feature register
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>,
 Brian Woods <brian.woods@amd.com>,
 Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhpcyBhbHNvIHRha2VzIGNhcmUgb2Ygc2V2ZXJhbCBvZiB0aGUgc2hpZnQgdmFsdWVzIHdyb25n
bHkgaGF2aW5nIGJlZW4Kc3BlY2lmaWVkIGFzIGhleCByYXRoZXIgdGhhbiBkZWMuCgpUYWtlIHRo
ZSBvcHBvcnR1bml0eSBhbmQgYWRkIGZ1cnRoZXIgZmllbGRzLgoKU2lnbmVkLW9mZi1ieTogSmFu
IEJldWxpY2ggPGpiZXVsaWNoQHN1c2UuY29tPgotLS0KdjI6IENvcnJlY3Qgc2F0c19zdXAgcG9z
aXRpb24gYW5kIG5hbWUuIFJlLWJhc2Ugb3ZlciBuZXcgZWFybGllciBwYXRjaC4KCi0tLSBhL3hl
bi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9pb21tdV9kZXRlY3QuYworKysgYi94ZW4vZHJpdmVy
cy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfZGV0ZWN0LmMKQEAgLTYwLDQ5ICs2MCw3OCBAQCBzdGF0
aWMgaW50IF9faW5pdCBnZXRfaW9tbXVfY2FwYWJpbGl0aWVzCiAKIHZvaWQgX19pbml0IGdldF9p
b21tdV9mZWF0dXJlcyhzdHJ1Y3QgYW1kX2lvbW11ICppb21tdSkKIHsKLSAgICB1MzIgbG93LCBo
aWdoOwotICAgIGludCBpID0gMCA7CiAgICAgY29uc3Qgc3RydWN0IGFtZF9pb21tdSAqZmlyc3Q7
Ci0gICAgc3RhdGljIGNvbnN0IGNoYXIgKl9faW5pdGRhdGEgZmVhdHVyZV9zdHJbXSA9IHsKLSAg
ICAgICAgIi0gUHJlZmV0Y2ggUGFnZXMgQ29tbWFuZCIsIAotICAgICAgICAiLSBQZXJpcGhlcmFs
IFBhZ2UgU2VydmljZSBSZXF1ZXN0IiwgCi0gICAgICAgICItIFgyQVBJQyBTdXBwb3J0ZWQiLCAK
LSAgICAgICAgIi0gTlggYml0IFN1cHBvcnRlZCIsIAotICAgICAgICAiLSBHdWVzdCBUcmFuc2xh
dGlvbiIsIAotICAgICAgICAiLSBSZXNlcnZlZCBiaXQgWzVdIiwKLSAgICAgICAgIi0gSW52YWxp
ZGF0ZSBBbGwgQ29tbWFuZCIsIAotICAgICAgICAiLSBHdWVzdCBBUElDIHN1cHBvcnRlZCIsIAot
ICAgICAgICAiLSBIYXJkd2FyZSBFcnJvciBSZWdpc3RlcnMiLCAKLSAgICAgICAgIi0gUGVyZm9y
bWFuY2UgQ291bnRlcnMiLCAKLSAgICAgICAgTlVMTAotICAgIH07Ci0KICAgICBBU1NFUlQoIGlv
bW11LT5tbWlvX2Jhc2UgKTsKIAogICAgIGlmICggIWlvbW11X2hhc19jYXAoaW9tbXUsIFBDSV9D
QVBfRUZSU1VQX1NISUZUKSApCiAgICAgewotICAgICAgICBpb21tdS0+ZmVhdHVyZXMgPSAwOwor
ICAgICAgICBpb21tdS0+ZmVhdHVyZXMucmF3ID0gMDsKICAgICAgICAgcmV0dXJuOwogICAgIH0K
IAotICAgIGxvdyA9IHJlYWRsKGlvbW11LT5tbWlvX2Jhc2UgKyBJT01NVV9FWFRfRkVBVFVSRV9N
TUlPX09GRlNFVCk7Ci0gICAgaGlnaCA9IHJlYWRsKGlvbW11LT5tbWlvX2Jhc2UgKyBJT01NVV9F
WFRfRkVBVFVSRV9NTUlPX09GRlNFVCArIDQpOwotCi0gICAgaW9tbXUtPmZlYXR1cmVzID0gKCh1
NjQpaGlnaCA8PCAzMikgfCBsb3c7CisgICAgaW9tbXUtPmZlYXR1cmVzLnJhdyA9CisgICAgICAg
IHJlYWRxKGlvbW11LT5tbWlvX2Jhc2UgKyBJT01NVV9FWFRfRkVBVFVSRV9NTUlPX09GRlNFVCk7
CiAKICAgICAvKiBEb24ndCBsb2cgdGhlIHNhbWUgc2V0IG9mIGZlYXR1cmVzIG92ZXIgYW5kIG92
ZXIuICovCiAgICAgZmlyc3QgPSBsaXN0X2ZpcnN0X2VudHJ5KCZhbWRfaW9tbXVfaGVhZCwgc3Ry
dWN0IGFtZF9pb21tdSwgbGlzdCk7Ci0gICAgaWYgKCBpb21tdSAhPSBmaXJzdCAmJiBpb21tdS0+
ZmVhdHVyZXMgPT0gZmlyc3QtPmZlYXR1cmVzICkKKyAgICBpZiAoIGlvbW11ICE9IGZpcnN0ICYm
IGlvbW11LT5mZWF0dXJlcy5yYXcgPT0gZmlyc3QtPmZlYXR1cmVzLnJhdyApCiAgICAgICAgIHJl
dHVybjsKIAogICAgIHByaW50aygiQU1ELVZpOiBJT01NVSBFeHRlbmRlZCBGZWF0dXJlczpcbiIp
OwogCi0gICAgd2hpbGUgKCBmZWF0dXJlX3N0cltpXSApCisjZGVmaW5lIE1BU0soZmxkKSAoKHVu
aW9uIGFtZF9pb21tdV9leHRfZmVhdHVyZXMpeyAuZmxkcy5mbGQgPSB+MCB9KS5yYXcKKyNkZWZp
bmUgRkVBVChmbGQsIHN0cikgZG8geyBcCisgICAgaWYgKCBNQVNLKGZsZCkgJiAoTUFTSyhmbGQp
IC0gMSkgKSBcCisgICAgICAgIHByaW50ayggIi0gIiBzdHIgIjogJSN4XG4iLCBpb21tdS0+ZmVh
dHVyZXMuZmxkcy5mbGQpOyBcCisgICAgZWxzZSBpZiAoIGlvbW11LT5mZWF0dXJlcy5yYXcgJiBN
QVNLKGZsZCkgKSBcCisgICAgICAgIHByaW50ayggIi0gIiBzdHIgIlxuIik7IFwKK30gd2hpbGUg
KCBmYWxzZSApCisKKyAgICBGRUFUKHByZWZfc3VwLCAgICAgICAgICAgIlByZWZldGNoIFBhZ2Vz
IENvbW1hbmQiKTsKKyAgICBGRUFUKHBwcl9zdXAsICAgICAgICAgICAgIlBlcmlwaGVyYWwgUGFn
ZSBTZXJ2aWNlIFJlcXVlc3QiKTsKKyAgICBGRUFUKHh0X3N1cCwgICAgICAgICAgICAgIngyQVBJ
QyIpOworICAgIEZFQVQobnhfc3VwLCAgICAgICAgICAgICAiTlggYml0Iik7CisgICAgRkVBVChn
YXBwaV9zdXAsICAgICAgICAgICJHdWVzdCBBUElDIFBoeXNpY2FsIFByb2Nlc3NvciBJbnRlcnJ1
cHQiKTsKKyAgICBGRUFUKGlhX3N1cCwgICAgICAgICAgICAgIkludmFsaWRhdGUgQWxsIENvbW1h
bmQiKTsKKyAgICBGRUFUKGdhX3N1cCwgICAgICAgICAgICAgIkd1ZXN0IEFQSUMiKTsKKyAgICBG
RUFUKGhlX3N1cCwgICAgICAgICAgICAgIkhhcmR3YXJlIEVycm9yIFJlZ2lzdGVycyIpOworICAg
IEZFQVQocGNfc3VwLCAgICAgICAgICAgICAiUGVyZm9ybWFuY2UgQ291bnRlcnMiKTsKKyAgICBG
RUFUKGhhdHMsICAgICAgICAgICAgICAgIkhvc3QgQWRkcmVzcyBUcmFuc2xhdGlvbiBTaXplIik7
CisKKyAgICBpZiAoIGlvbW11LT5mZWF0dXJlcy5mbGRzLmd0X3N1cCApCiAgICAgewotICAgICAg
ICBpZiAoIGFtZF9pb21tdV9oYXNfZmVhdHVyZShpb21tdSwgaSkgKQotICAgICAgICAgICAgcHJp
bnRrKCAiICVzXG4iLCBmZWF0dXJlX3N0cltpXSk7Ci0gICAgICAgIGkrKzsKKyAgICAgICAgRkVB
VChnYXRzLCAgICAgICAgICAgIkd1ZXN0IEFkZHJlc3MgVHJhbnNsYXRpb24gU2l6ZSIpOworICAg
ICAgICBGRUFUKGdseF9zdXAsICAgICAgICAiR3Vlc3QgQ1IzIFJvb3QgVGFibGUgTGV2ZWwiKTsK
KyAgICAgICAgRkVBVChwYXNfbWF4LCAgICAgICAgIk1heGltdW0gUEFTSUQiKTsKICAgICB9CisK
KyAgICBGRUFUKHNtaWZfc3VwLCAgICAgICAgICAgIlNNSSBGaWx0ZXIgUmVnaXN0ZXIiKTsKKyAg
ICBGRUFUKHNtaWZfcmMsICAgICAgICAgICAgIlNNSSBGaWx0ZXIgUmVnaXN0ZXIgQ291bnQiKTsK
KyAgICBGRUFUKGdhbV9zdXAsICAgICAgICAgICAgIkd1ZXN0IFZpcnR1YWwgQVBJQyBNb2RlcyIp
OworICAgIEZFQVQoZHVhbF9wcHJfbG9nX3N1cCwgICAiRHVhbCBQUFIgTG9nIik7CisgICAgRkVB
VChkdWFsX2V2ZW50X2xvZ19zdXAsICJEdWFsIEV2ZW50IExvZyIpOworICAgIEZFQVQoc2F0c19z
dXAsICAgICAgICAgICAiU2VjdXJlIEFUUyIpOworICAgIEZFQVQodXNfc3VwLCAgICAgICAgICAg
ICAiVXNlciAvIFN1cGVydmlzb3IgUGFnZSBQcm90ZWN0aW9uIik7CisgICAgRkVBVChkZXZfdGJs
X3NlZ19zdXAsICAgICJEZXZpY2UgVGFibGUgU2VnbWVudGF0aW9uIik7CisgICAgRkVBVChwcHJf
ZWFybHlfb2Zfc3VwLCAgICJQUFIgTG9nIE92ZXJmbG93IEVhcmx5IFdhcm5pbmciKTsKKyAgICBG
RUFUKHBwcl9hdXRvX3JzcF9zdXAsICAgIlBQUiBBdXRvbWF0aWMgUmVzcG9uc2UiKTsKKyAgICBG
RUFUKG1hcmNfc3VwLCAgICAgICAgICAgIk1lbW9yeSBBY2Nlc3MgUm91dGluZyBhbmQgQ29udHJv
bCIpOworICAgIEZFQVQoYmxrX3N0b3BfbXJrX3N1cCwgICAiQmxvY2sgU3RvcE1hcmsgTWVzc2Fn
ZSIpOworICAgIEZFQVQocGVyZl9vcHRfc3VwICwgICAgICAiUGVyZm9ybWFuY2UgT3B0aW1pemF0
aW9uIik7CisgICAgRkVBVChtc2lfY2FwX21taW9fc3VwLCAgICJNU0kgQ2FwYWJpbGl0eSBNTUlP
IEFjY2VzcyIpOworICAgIEZFQVQoZ2lvX3N1cCwgICAgICAgICAgICAiR3Vlc3QgSS9PIFByb3Rl
Y3Rpb24iKTsKKyAgICBGRUFUKGhhX3N1cCwgICAgICAgICAgICAgIkhvc3QgQWNjZXNzIik7Cisg
ICAgRkVBVChlcGhfc3VwLCAgICAgICAgICAgICJFbmhhbmNlZCBQUFIgSGFuZGxpbmciKTsKKyAg
ICBGRUFUKGF0dHJfZndfc3VwLCAgICAgICAgIkF0dHJpYnV0ZSBGb3J3YXJkIik7CisgICAgRkVB
VChoZF9zdXAsICAgICAgICAgICAgICJIb3N0IERpcnR5Iik7CisgICAgRkVBVChpbnZfaW90bGJf
dHlwZV9zdXAsICJJbnZhbGlkYXRlIElPVExCIFR5cGUiKTsKKyAgICBGRUFUKHZpb21tdV9zdXAs
ICAgICAgICAgIlZpcnR1YWxpemVkIElPTU1VIik7CisgICAgRkVBVCh2bV9ndWFyZF9pb19zdXAs
ICAgICJWTUd1YXJkIEkvTyBTdXBwb3J0Iik7CisgICAgRkVBVCh2bV90YWJsZV9zaXplLCAgICAg
ICJWTSBUYWJsZSBTaXplIik7CisgICAgRkVBVChnYV91cGRhdGVfZGlzX3N1cCwgICJHdWVzdCBB
Y2Nlc3MgQml0IFVwZGF0ZSBEaXNhYmxlIik7CisKKyN1bmRlZiBGRUFUCisjdW5kZWYgTUFTSwog
fQogCiBpbnQgX19pbml0IGFtZF9pb21tdV9kZXRlY3Rfb25lX2FjcGkoCi0tLSBhL3hlbi9kcml2
ZXJzL3Bhc3N0aHJvdWdoL2FtZC9pb21tdV9ndWVzdC5jCisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0
aHJvdWdoL2FtZC9pb21tdV9ndWVzdC5jCkBAIC02MzgsNyArNjM4LDcgQEAgc3RhdGljIHVpbnQ2
NF90IGlvbW11X21taW9fcmVhZDY0KHN0cnVjdAogICAgICAgICB2YWwgPSByZWdfdG9fdTY0KGlv
bW11LT5yZWdfc3RhdHVzKTsKICAgICAgICAgYnJlYWs7CiAgICAgY2FzZSBJT01NVV9FWFRfRkVB
VFVSRV9NTUlPX09GRlNFVDoKLSAgICAgICAgdmFsID0gcmVnX3RvX3U2NChpb21tdS0+cmVnX2V4
dF9mZWF0dXJlKTsKKyAgICAgICAgdmFsID0gaW9tbXUtPnJlZ19leHRfZmVhdHVyZS5yYXc7CiAg
ICAgICAgIGJyZWFrOwogCiAgICAgZGVmYXVsdDoKQEAgLTgwMiwzOSArODAyLDI2IEBAIGludCBn
dWVzdF9pb21tdV9zZXRfYmFzZShzdHJ1Y3QgZG9tYWluICoKIC8qIEluaXRpYWxpemUgbW1pbyBy
ZWFkIG9ubHkgYml0cyAqLwogc3RhdGljIHZvaWQgZ3Vlc3RfaW9tbXVfcmVnX2luaXQoc3RydWN0
IGd1ZXN0X2lvbW11ICppb21tdSkKIHsKLSAgICB1aW50MzJfdCBsb3dlciwgdXBwZXI7CisgICAg
dW5pb24gYW1kX2lvbW11X2V4dF9mZWF0dXJlcyBlZiA9IHsKKyAgICAgICAgLyogU3VwcG9ydCBw
cmVmZXRjaCAqLworICAgICAgICAuZmxkcy5wcmVmX3N1cCA9IDEsCisgICAgICAgIC8qIFN1cHBv
cnQgUFBSIGxvZyAqLworICAgICAgICAuZmxkcy5wcHJfc3VwID0gMSwKKyAgICAgICAgLyogU3Vw
cG9ydCBndWVzdCB0cmFuc2xhdGlvbiAqLworICAgICAgICAuZmxkcy5ndF9zdXAgPSAxLAorICAg
ICAgICAvKiBTdXBwb3J0IGludmFsaWRhdGUgYWxsIGNvbW1hbmQgKi8KKyAgICAgICAgLmZsZHMu
aWFfc3VwID0gMSwKKyAgICAgICAgLyogSG9zdCB0cmFuc2xhdGlvbiBzaXplIGhhcyA2IGxldmVs
cyAqLworICAgICAgICAuZmxkcy5oYXRzID0gSE9TVF9BRERSRVNTX1NJWkVfNl9MRVZFTCwKKyAg
ICAgICAgLyogR3Vlc3QgdHJhbnNsYXRpb24gc2l6ZSBoYXMgNiBsZXZlbHMgKi8KKyAgICAgICAg
LmZsZHMuZ2F0cyA9IEdVRVNUX0FERFJFU1NfU0laRV82X0xFVkVMLAorICAgICAgICAvKiBTaW5n
bGUgbGV2ZWwgZ0NSMyAqLworICAgICAgICAuZmxkcy5nbHhfc3VwID0gR1VFU1RfQ1IzXzFfTEVW
RUwsCisgICAgICAgIC8qIDkgYml0IFBBU0lEICovCisgICAgICAgIC5mbGRzLnBhc19tYXggPSBQ
QVNNQVhfOV9iaXQsCisgICAgfTsKIAotICAgIGxvd2VyID0gdXBwZXIgPSAwOwotICAgIC8qIFN1
cHBvcnQgcHJlZmV0Y2ggKi8KLSAgICBpb21tdV9zZXRfYml0KCZsb3dlcixJT01NVV9FWFRfRkVB
VFVSRV9QUkVGU1VQX1NISUZUKTsKLSAgICAvKiBTdXBwb3J0IFBQUiBsb2cgKi8KLSAgICBpb21t
dV9zZXRfYml0KCZsb3dlcixJT01NVV9FWFRfRkVBVFVSRV9QUFJTVVBfU0hJRlQpOwotICAgIC8q
IFN1cHBvcnQgZ3Vlc3QgdHJhbnNsYXRpb24gKi8KLSAgICBpb21tdV9zZXRfYml0KCZsb3dlcixJ
T01NVV9FWFRfRkVBVFVSRV9HVFNVUF9TSElGVCk7Ci0gICAgLyogU3VwcG9ydCBpbnZhbGlkYXRl
IGFsbCBjb21tYW5kICovCi0gICAgaW9tbXVfc2V0X2JpdCgmbG93ZXIsSU9NTVVfRVhUX0ZFQVRV
UkVfSUFTVVBfU0hJRlQpOwotCi0gICAgLyogSG9zdCB0cmFuc2xhdGlvbiBzaXplIGhhcyA2IGxl
dmVscyAqLwotICAgIHNldF9maWVsZF9pbl9yZWdfdTMyKEhPU1RfQUREUkVTU19TSVpFXzZfTEVW
RUwsIGxvd2VyLAotICAgICAgICAgICAgICAgICAgICAgICAgIElPTU1VX0VYVF9GRUFUVVJFX0hB
VFNfTUFTSywKLSAgICAgICAgICAgICAgICAgICAgICAgICBJT01NVV9FWFRfRkVBVFVSRV9IQVRT
X1NISUZULAotICAgICAgICAgICAgICAgICAgICAgICAgICZsb3dlcik7Ci0gICAgLyogR3Vlc3Qg
dHJhbnNsYXRpb24gc2l6ZSBoYXMgNiBsZXZlbHMgKi8KLSAgICBzZXRfZmllbGRfaW5fcmVnX3Uz
MihHVUVTVF9BRERSRVNTX1NJWkVfNl9MRVZFTCwgbG93ZXIsCi0gICAgICAgICAgICAgICAgICAg
ICAgICAgSU9NTVVfRVhUX0ZFQVRVUkVfR0FUU19NQVNLLAotICAgICAgICAgICAgICAgICAgICAg
ICAgIElPTU1VX0VYVF9GRUFUVVJFX0dBVFNfU0hJRlQsCi0gICAgICAgICAgICAgICAgICAgICAg
ICAgJmxvd2VyKTsKLSAgICAvKiBTaW5nbGUgbGV2ZWwgZ0NSMyAqLwotICAgIHNldF9maWVsZF9p
bl9yZWdfdTMyKEdVRVNUX0NSM18xX0xFVkVMLCBsb3dlciwKLSAgICAgICAgICAgICAgICAgICAg
ICAgICBJT01NVV9FWFRfRkVBVFVSRV9HTFhTVVBfTUFTSywKLSAgICAgICAgICAgICAgICAgICAg
ICAgICBJT01NVV9FWFRfRkVBVFVSRV9HTFhTVVBfU0hJRlQsICZsb3dlcik7Ci0gICAgLyogOSBi
aXQgUEFTSUQgKi8KLSAgICBzZXRfZmllbGRfaW5fcmVnX3UzMihQQVNNQVhfOV9iaXQsIHVwcGVy
LAotICAgICAgICAgICAgICAgICAgICAgICAgIElPTU1VX0VYVF9GRUFUVVJFX1BBU01BWF9NQVNL
LAotICAgICAgICAgICAgICAgICAgICAgICAgIElPTU1VX0VYVF9GRUFUVVJFX1BBU01BWF9TSElG
VCwgJnVwcGVyKTsKLQotICAgIGlvbW11LT5yZWdfZXh0X2ZlYXR1cmUubG8gPSBsb3dlcjsKLSAg
ICBpb21tdS0+cmVnX2V4dF9mZWF0dXJlLmhpID0gdXBwZXI7CisgICAgaW9tbXUtPnJlZ19leHRf
ZmVhdHVyZSA9IGVmOwogfQogCiBzdGF0aWMgaW50IGd1ZXN0X2lvbW11X21taW9fcmFuZ2Uoc3Ry
dWN0IHZjcHUgKnYsIHVuc2lnbmVkIGxvbmcgYWRkcikKLS0tIGEveGVuL2RyaXZlcnMvcGFzc3Ro
cm91Z2gvYW1kL2lvbW11X2luaXQuYworKysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQv
aW9tbXVfaW5pdC5jCkBAIC04ODMsNyArODgzLDcgQEAgc3RhdGljIHZvaWQgZW5hYmxlX2lvbW11
KHN0cnVjdCBhbWRfaW9tbQogICAgIHJlZ2lzdGVyX2lvbW11X2V2ZW50X2xvZ19pbl9tbWlvX3Nw
YWNlKGlvbW11KTsKICAgICByZWdpc3Rlcl9pb21tdV9leGNsdXNpb25fcmFuZ2UoaW9tbXUpOwog
Ci0gICAgaWYgKCBhbWRfaW9tbXVfaGFzX2ZlYXR1cmUoaW9tbXUsIElPTU1VX0VYVF9GRUFUVVJF
X1BQUlNVUF9TSElGVCkgKQorICAgIGlmICggaW9tbXUtPmZlYXR1cmVzLmZsZHMucHByX3N1cCAp
CiAgICAgICAgIHJlZ2lzdGVyX2lvbW11X3Bwcl9sb2dfaW5fbW1pb19zcGFjZShpb21tdSk7CiAK
ICAgICBkZXNjID0gaXJxX3RvX2Rlc2MoaW9tbXUtPm1zaS5pcnEpOwpAQCAtODk3LDE1ICs4OTcs
MTUgQEAgc3RhdGljIHZvaWQgZW5hYmxlX2lvbW11KHN0cnVjdCBhbWRfaW9tbQogICAgIHNldF9p
b21tdV9jb21tYW5kX2J1ZmZlcl9jb250cm9sKGlvbW11LCBJT01NVV9DT05UUk9MX0VOQUJMRUQp
OwogICAgIHNldF9pb21tdV9ldmVudF9sb2dfY29udHJvbChpb21tdSwgSU9NTVVfQ09OVFJPTF9F
TkFCTEVEKTsKIAotICAgIGlmICggYW1kX2lvbW11X2hhc19mZWF0dXJlKGlvbW11LCBJT01NVV9F
WFRfRkVBVFVSRV9QUFJTVVBfU0hJRlQpICkKKyAgICBpZiAoIGlvbW11LT5mZWF0dXJlcy5mbGRz
LnBwcl9zdXAgKQogICAgICAgICBzZXRfaW9tbXVfcHByX2xvZ19jb250cm9sKGlvbW11LCBJT01N
VV9DT05UUk9MX0VOQUJMRUQpOwogCi0gICAgaWYgKCBhbWRfaW9tbXVfaGFzX2ZlYXR1cmUoaW9t
bXUsIElPTU1VX0VYVF9GRUFUVVJFX0dUU1VQX1NISUZUKSApCisgICAgaWYgKCBpb21tdS0+ZmVh
dHVyZXMuZmxkcy5ndF9zdXAgKQogICAgICAgICBzZXRfaW9tbXVfZ3Vlc3RfdHJhbnNsYXRpb25f
Y29udHJvbChpb21tdSwgSU9NTVVfQ09OVFJPTF9FTkFCTEVEKTsKIAogICAgIHNldF9pb21tdV90
cmFuc2xhdGlvbl9jb250cm9sKGlvbW11LCBJT01NVV9DT05UUk9MX0VOQUJMRUQpOwogCi0gICAg
aWYgKCBhbWRfaW9tbXVfaGFzX2ZlYXR1cmUoaW9tbXUsIElPTU1VX0VYVF9GRUFUVVJFX0lBU1VQ
X1NISUZUKSApCisgICAgaWYgKCBpb21tdS0+ZmVhdHVyZXMuZmxkcy5pYV9zdXAgKQogICAgICAg
ICBhbWRfaW9tbXVfZmx1c2hfYWxsX2NhY2hlcyhpb21tdSk7CiAKICAgICBpb21tdS0+ZW5hYmxl
ZCA9IDE7CkBAIC05MjgsMTAgKzkyOCwxMCBAQCBzdGF0aWMgdm9pZCBkaXNhYmxlX2lvbW11KHN0
cnVjdCBhbWRfaW9tCiAgICAgc2V0X2lvbW11X2NvbW1hbmRfYnVmZmVyX2NvbnRyb2woaW9tbXUs
IElPTU1VX0NPTlRST0xfRElTQUJMRUQpOwogICAgIHNldF9pb21tdV9ldmVudF9sb2dfY29udHJv
bChpb21tdSwgSU9NTVVfQ09OVFJPTF9ESVNBQkxFRCk7CiAKLSAgICBpZiAoIGFtZF9pb21tdV9o
YXNfZmVhdHVyZShpb21tdSwgSU9NTVVfRVhUX0ZFQVRVUkVfUFBSU1VQX1NISUZUKSApCisgICAg
aWYgKCBpb21tdS0+ZmVhdHVyZXMuZmxkcy5wcHJfc3VwICkKICAgICAgICAgc2V0X2lvbW11X3Bw
cl9sb2dfY29udHJvbChpb21tdSwgSU9NTVVfQ09OVFJPTF9ESVNBQkxFRCk7CiAKLSAgICBpZiAo
IGFtZF9pb21tdV9oYXNfZmVhdHVyZShpb21tdSwgSU9NTVVfRVhUX0ZFQVRVUkVfR1RTVVBfU0hJ
RlQpICkKKyAgICBpZiAoIGlvbW11LT5mZWF0dXJlcy5mbGRzLmd0X3N1cCApCiAgICAgICAgIHNl
dF9pb21tdV9ndWVzdF90cmFuc2xhdGlvbl9jb250cm9sKGlvbW11LCBJT01NVV9DT05UUk9MX0RJ
U0FCTEVEKTsKIAogICAgIHNldF9pb21tdV90cmFuc2xhdGlvbl9jb250cm9sKGlvbW11LCBJT01N
VV9DT05UUk9MX0RJU0FCTEVEKTsKQEAgLTEwMjcsNyArMTAyNyw3IEBAIHN0YXRpYyBpbnQgX19p
bml0IGFtZF9pb21tdV9pbml0X29uZShzdHIKIAogICAgIGdldF9pb21tdV9mZWF0dXJlcyhpb21t
dSk7CiAKLSAgICBpZiAoIGlvbW11LT5mZWF0dXJlcyApCisgICAgaWYgKCBpb21tdS0+ZmVhdHVy
ZXMucmF3ICkKICAgICAgICAgaW9tbXV2Ml9lbmFibGVkID0gMTsKIAogICAgIGlmICggYWxsb2Nh
dGVfY21kX2J1ZmZlcihpb21tdSkgPT0gTlVMTCApCkBAIC0xMDM2LDkgKzEwMzYsOCBAQCBzdGF0
aWMgaW50IF9faW5pdCBhbWRfaW9tbXVfaW5pdF9vbmUoc3RyCiAgICAgaWYgKCBhbGxvY2F0ZV9l
dmVudF9sb2coaW9tbXUpID09IE5VTEwgKQogICAgICAgICBnb3RvIGVycm9yX291dDsKIAotICAg
IGlmICggYW1kX2lvbW11X2hhc19mZWF0dXJlKGlvbW11LCBJT01NVV9FWFRfRkVBVFVSRV9QUFJT
VVBfU0hJRlQpICkKLSAgICAgICAgaWYgKCBhbGxvY2F0ZV9wcHJfbG9nKGlvbW11KSA9PSBOVUxM
ICkKLSAgICAgICAgICAgIGdvdG8gZXJyb3Jfb3V0OworICAgIGlmICggaW9tbXUtPmZlYXR1cmVz
LmZsZHMucHByX3N1cCAmJiAhYWxsb2NhdGVfcHByX2xvZyhpb21tdSkgKQorICAgICAgICBnb3Rv
IGVycm9yX291dDsKIAogICAgIGlmICggIXNldF9pb21tdV9pbnRlcnJ1cHRfaGFuZGxlcihpb21t
dSkgKQogICAgICAgICBnb3RvIGVycm9yX291dDsKQEAgLTEzODksNyArMTM4OCw3IEBAIHZvaWQg
YW1kX2lvbW11X3Jlc3VtZSh2b2lkKQogICAgIH0KIAogICAgIC8qIGZsdXNoIGFsbCBjYWNoZSBl
bnRyaWVzIGFmdGVyIGlvbW11IHJlLWVuYWJsZWQgKi8KLSAgICBpZiAoICFhbWRfaW9tbXVfaGFz
X2ZlYXR1cmUoaW9tbXUsIElPTU1VX0VYVF9GRUFUVVJFX0lBU1VQX1NISUZUKSApCisgICAgaWYg
KCAhaW9tbXUtPmZlYXR1cmVzLmZsZHMuaWFfc3VwICkKICAgICB7CiAgICAgICAgIGludmFsaWRh
dGVfYWxsX2RldmljZXMoKTsKICAgICAgICAgaW52YWxpZGF0ZV9hbGxfZG9tYWluX3BhZ2VzKCk7
Ci0tLSBhL3hlbi9pbmNsdWRlL2FzbS14ODYvYW1kLWlvbW11LmgKKysrIGIveGVuL2luY2x1ZGUv
YXNtLXg4Ni9hbWQtaW9tbXUuaApAQCAtODMsNyArODMsNyBAQCBzdHJ1Y3QgYW1kX2lvbW11IHsK
ICAgICBpb21tdV9jYXBfdCBjYXA7CiAKICAgICB1OCBodF9mbGFnczsKLSAgICB1NjQgZmVhdHVy
ZXM7CisgICAgdW5pb24gYW1kX2lvbW11X2V4dF9mZWF0dXJlcyBmZWF0dXJlczsKIAogICAgIHZv
aWQgKm1taW9fYmFzZTsKICAgICB1bnNpZ25lZCBsb25nIG1taW9fYmFzZV9waHlzOwpAQCAtMTc0
LDcgKzE3NCw3IEBAIHN0cnVjdCBndWVzdF9pb21tdSB7CiAgICAgLyogTU1JTyByZWdzICovCiAg
ICAgc3RydWN0IG1taW9fcmVnICAgICAgICAgcmVnX2N0cmw7ICAgICAgICAgICAgICAvKiBNTUlP
IG9mZnNldCAwMDE4aCAqLwogICAgIHN0cnVjdCBtbWlvX3JlZyAgICAgICAgIHJlZ19zdGF0dXM7
ICAgICAgICAgICAgLyogTU1JTyBvZmZzZXQgMjAyMGggKi8KLSAgICBzdHJ1Y3QgbW1pb19yZWcg
ICAgICAgICByZWdfZXh0X2ZlYXR1cmU7ICAgICAgIC8qIE1NSU8gb2Zmc2V0IDAwMzBoICovCisg
ICAgdW5pb24gYW1kX2lvbW11X2V4dF9mZWF0dXJlcyByZWdfZXh0X2ZlYXR1cmU7ICAvKiBNTUlP
IG9mZnNldCAwMDMwaCAqLwogCiAgICAgLyogZ3Vlc3QgaW50ZXJydXB0IHNldHRpbmdzICovCiAg
ICAgc3RydWN0IGd1ZXN0X2lvbW11X21zaSAgbXNpOwotLS0gYS94ZW4vaW5jbHVkZS9hc20teDg2
L2h2bS9zdm0vYW1kLWlvbW11LWRlZnMuaAorKysgYi94ZW4vaW5jbHVkZS9hc20teDg2L2h2bS9z
dm0vYW1kLWlvbW11LWRlZnMuaApAQCAtMzQ2LDI2ICszNDYsNTcgQEAgc3RydWN0IGFtZF9pb21t
dV9kdGUgewogI2RlZmluZSBJT01NVV9FWENMVVNJT05fTElNSVRfSElHSF9NQVNLCQkweEZGRkZG
RkZGCiAjZGVmaW5lIElPTU1VX0VYQ0xVU0lPTl9MSU1JVF9ISUdIX1NISUZUCTAKIAotLyogRXh0
ZW5kZWQgRmVhdHVyZSBSZWdpc3RlciovCisvKiBFeHRlbmRlZCBGZWF0dXJlIFJlZ2lzdGVyICov
CiAjZGVmaW5lIElPTU1VX0VYVF9GRUFUVVJFX01NSU9fT0ZGU0VUICAgICAgICAgICAgICAgICAg
IDB4MzAKLSNkZWZpbmUgSU9NTVVfRVhUX0ZFQVRVUkVfUFJFRlNVUF9TSElGVCAgICAgICAgICAg
ICAgICAgMHgwCi0jZGVmaW5lIElPTU1VX0VYVF9GRUFUVVJFX1BQUlNVUF9TSElGVCAgICAgICAg
ICAgICAgICAgIDB4MQotI2RlZmluZSBJT01NVV9FWFRfRkVBVFVSRV9YVFNVUF9TSElGVCAgICAg
ICAgICAgICAgICAgICAweDIKLSNkZWZpbmUgSU9NTVVfRVhUX0ZFQVRVUkVfTlhTVVBfU0hJRlQg
ICAgICAgICAgICAgICAgICAgMHgzCi0jZGVmaW5lIElPTU1VX0VYVF9GRUFUVVJFX0dUU1VQX1NI
SUZUICAgICAgICAgICAgICAgICAgIDB4NAotI2RlZmluZSBJT01NVV9FWFRfRkVBVFVSRV9JQVNV
UF9TSElGVCAgICAgICAgICAgICAgICAgICAweDYKLSNkZWZpbmUgSU9NTVVfRVhUX0ZFQVRVUkVf
R0FTVVBfU0hJRlQgICAgICAgICAgICAgICAgICAgMHg3Ci0jZGVmaW5lIElPTU1VX0VYVF9GRUFU
VVJFX0hFU1VQX1NISUZUICAgICAgICAgICAgICAgICAgIDB4OAotI2RlZmluZSBJT01NVV9FWFRf
RkVBVFVSRV9QQ1NVUF9TSElGVCAgICAgICAgICAgICAgICAgICAweDkKLSNkZWZpbmUgSU9NTVVf
RVhUX0ZFQVRVUkVfSEFUU19TSElGVCAgICAgICAgICAgICAgICAgICAgMHgxMAotI2RlZmluZSBJ
T01NVV9FWFRfRkVBVFVSRV9IQVRTX01BU0sgICAgICAgICAgICAgICAgICAgICAweDAwMDAwQzAw
Ci0jZGVmaW5lIElPTU1VX0VYVF9GRUFUVVJFX0dBVFNfU0hJRlQgICAgICAgICAgICAgICAgICAg
IDB4MTIKLSNkZWZpbmUgSU9NTVVfRVhUX0ZFQVRVUkVfR0FUU19NQVNLICAgICAgICAgICAgICAg
ICAgICAgMHgwMDAwMzAwMAotI2RlZmluZSBJT01NVV9FWFRfRkVBVFVSRV9HTFhTVVBfU0hJRlQg
ICAgICAgICAgICAgICAgICAweDE0Ci0jZGVmaW5lIElPTU1VX0VYVF9GRUFUVVJFX0dMWFNVUF9N
QVNLICAgICAgICAgICAgICAgICAgIDB4MDAwMEMwMDAKIAotI2RlZmluZSBJT01NVV9FWFRfRkVB
VFVSRV9QQVNNQVhfU0hJRlQgICAgICAgICAgICAgICAgICAweDAKLSNkZWZpbmUgSU9NTVVfRVhU
X0ZFQVRVUkVfUEFTTUFYX01BU0sgICAgICAgICAgICAgICAgICAgMHgwMDAwMDAxRgordW5pb24g
YW1kX2lvbW11X2V4dF9mZWF0dXJlcyB7CisgICAgdWludDY0X3QgcmF3OworICAgIHN0cnVjdCB7
CisgICAgICAgIHVuc2lnbmVkIGludCBwcmVmX3N1cDoxOworICAgICAgICB1bnNpZ25lZCBpbnQg
cHByX3N1cDoxOworICAgICAgICB1bnNpZ25lZCBpbnQgeHRfc3VwOjE7CisgICAgICAgIHVuc2ln
bmVkIGludCBueF9zdXA6MTsKKyAgICAgICAgdW5zaWduZWQgaW50IGd0X3N1cDoxOworICAgICAg
ICB1bnNpZ25lZCBpbnQgZ2FwcGlfc3VwOjE7CisgICAgICAgIHVuc2lnbmVkIGludCBpYV9zdXA6
MTsKKyAgICAgICAgdW5zaWduZWQgaW50IGdhX3N1cDoxOworICAgICAgICB1bnNpZ25lZCBpbnQg
aGVfc3VwOjE7CisgICAgICAgIHVuc2lnbmVkIGludCBwY19zdXA6MTsKKyAgICAgICAgdW5zaWdu
ZWQgaW50IGhhdHM6MjsKKyAgICAgICAgdW5zaWduZWQgaW50IGdhdHM6MjsKKyAgICAgICAgdW5z
aWduZWQgaW50IGdseF9zdXA6MjsKKyAgICAgICAgdW5zaWduZWQgaW50IHNtaWZfc3VwOjI7Cisg
ICAgICAgIHVuc2lnbmVkIGludCBzbWlmX3JjOjM7CisgICAgICAgIHVuc2lnbmVkIGludCBnYW1f
c3VwOjM7CisgICAgICAgIHVuc2lnbmVkIGludCBkdWFsX3Bwcl9sb2dfc3VwOjI7CisgICAgICAg
IHVuc2lnbmVkIGludCA6MjsKKyAgICAgICAgdW5zaWduZWQgaW50IGR1YWxfZXZlbnRfbG9nX3N1
cDoyOworICAgICAgICB1bnNpZ25lZCBpbnQgOjE7CisgICAgICAgIHVuc2lnbmVkIGludCBzYXRz
X3N1cDoxOworICAgICAgICB1bnNpZ25lZCBpbnQgcGFzX21heDo1OworICAgICAgICB1bnNpZ25l
ZCBpbnQgdXNfc3VwOjE7CisgICAgICAgIHVuc2lnbmVkIGludCBkZXZfdGJsX3NlZ19zdXA6MjsK
KyAgICAgICAgdW5zaWduZWQgaW50IHBwcl9lYXJseV9vZl9zdXA6MTsKKyAgICAgICAgdW5zaWdu
ZWQgaW50IHBwcl9hdXRvX3JzcF9zdXA6MTsKKyAgICAgICAgdW5zaWduZWQgaW50IG1hcmNfc3Vw
OjI7CisgICAgICAgIHVuc2lnbmVkIGludCBibGtfc3RvcF9tcmtfc3VwOjE7CisgICAgICAgIHVu
c2lnbmVkIGludCBwZXJmX29wdF9zdXA6MTsKKyAgICAgICAgdW5zaWduZWQgaW50IG1zaV9jYXBf
bW1pb19zdXA6MTsKKyAgICAgICAgdW5zaWduZWQgaW50IDoxOworICAgICAgICB1bnNpZ25lZCBp
bnQgZ2lvX3N1cDoxOworICAgICAgICB1bnNpZ25lZCBpbnQgaGFfc3VwOjE7CisgICAgICAgIHVu
c2lnbmVkIGludCBlcGhfc3VwOjE7CisgICAgICAgIHVuc2lnbmVkIGludCBhdHRyX2Z3X3N1cDox
OworICAgICAgICB1bnNpZ25lZCBpbnQgaGRfc3VwOjE7CisgICAgICAgIHVuc2lnbmVkIGludCA6
MTsKKyAgICAgICAgdW5zaWduZWQgaW50IGludl9pb3RsYl90eXBlX3N1cDoxOworICAgICAgICB1
bnNpZ25lZCBpbnQgdmlvbW11X3N1cDoxOworICAgICAgICB1bnNpZ25lZCBpbnQgdm1fZ3VhcmRf
aW9fc3VwOjE7CisgICAgICAgIHVuc2lnbmVkIGludCB2bV90YWJsZV9zaXplOjQ7CisgICAgICAg
IHVuc2lnbmVkIGludCBnYV91cGRhdGVfZGlzX3N1cDoxOworICAgICAgICB1bnNpZ25lZCBpbnQg
OjI7CisgICAgfSBmbGRzOworfTsKIAogLyogU3RhdHVzIFJlZ2lzdGVyKi8KICNkZWZpbmUgSU9N
TVVfU1RBVFVTX01NSU9fT0ZGU0VUCQkweDIwMjAKLS0tIGEveGVuL2luY2x1ZGUvYXNtLXg4Ni9o
dm0vc3ZtL2FtZC1pb21tdS1wcm90by5oCisrKyBiL3hlbi9pbmNsdWRlL2FzbS14ODYvaHZtL3N2
bS9hbWQtaW9tbXUtcHJvdG8uaApAQCAtMjE5LDEzICsyMTksNiBAQCBzdGF0aWMgaW5saW5lIGlu
dCBpb21tdV9oYXNfY2FwKHN0cnVjdCBhCiAgICAgcmV0dXJuICEhKGlvbW11LT5jYXAuaGVhZGVy
ICYgKDF1IDw8IGJpdCkpOwogfQogCi1zdGF0aWMgaW5saW5lIGludCBhbWRfaW9tbXVfaGFzX2Zl
YXR1cmUoc3RydWN0IGFtZF9pb21tdSAqaW9tbXUsIHVpbnQzMl90IGJpdCkKLXsKLSAgICBpZiAo
ICFpb21tdV9oYXNfY2FwKGlvbW11LCBQQ0lfQ0FQX0VGUlNVUF9TSElGVCkgKQotICAgICAgICBy
ZXR1cm4gMDsKLSAgICByZXR1cm4gISEoaW9tbXUtPmZlYXR1cmVzICYgKDFVIDw8IGJpdCkpOwot
fQotCiAvKiBhY2Nlc3MgdGFpbCBvciBoZWFkIHBvaW50ZXIgb2YgcmluZyBidWZmZXIgKi8KIHN0
YXRpYyBpbmxpbmUgdWludDMyX3QgaW9tbXVfZ2V0X3JiX3BvaW50ZXIodWludDMyX3QgcmVnKQog
ewoKCgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVu
LWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6
Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id CA863BF517
	for <lists+xen-devel@lfdr.de>; Thu, 26 Sep 2019 16:31:35 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iDUlM-0008Mr-AK; Thu, 26 Sep 2019 14:28:56 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=breC=XV=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1iDUlK-0008Mi-Ik
 for xen-devel@lists.xenproject.org; Thu, 26 Sep 2019 14:28:54 +0000
X-Inumbo-ID: f6c7f17e-e069-11e9-bf31-bc764e2007e4
Received: from mx1.suse.de (unknown [195.135.220.15])
 by localhost (Halon) with ESMTPS
 id f6c7f17e-e069-11e9-bf31-bc764e2007e4;
 Thu, 26 Sep 2019 14:28:53 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 8A500AC49;
 Thu, 26 Sep 2019 14:28:52 +0000 (UTC)
From: Jan Beulich <jbeulich@suse.com>
To: "xen-devel@lists.xenproject.org" <xen-devel@lists.xenproject.org>
References: <ba0fd598-9102-e765-e7f5-61e91d47b124@suse.com>
Message-ID: <dc7d25e5-11f8-b6c3-7137-ceb0814e836a@suse.com>
Date: Thu, 26 Sep 2019 16:28:53 +0200
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:60.0) Gecko/20100101
 Thunderbird/60.9.0
MIME-Version: 1.0
In-Reply-To: <ba0fd598-9102-e765-e7f5-61e91d47b124@suse.com>
Content-Language: en-US
Subject: [Xen-devel] [PATCH v7 1/3] AMD/IOMMU: allocate one device table per
 PCI segment
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>,
 Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>,
 Paul Durrant <paul@xen.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SGF2aW5nIGEgc2luZ2xlIGRldmljZSB0YWJsZSBmb3IgYWxsIHNlZ21lbnRzIGNhbid0IHBvc3Np
Ymx5IGJlIHJpZ2h0LgooRXZlbiB3b3JzZSwgdGhlIHN5bWJvbCB3YXNuJ3Qgc3RhdGljIGRlc3Bp
dGUgYmVpbmcgdXNlZCBpbiBqdXN0IG9uZQpzb3VyY2UgZmlsZS4pIEF0dGFjaCB0aGUgZGV2aWNl
IHRhYmxlcyB0byB0aGVpciByZXNwZWN0aXZlIElWUlMgbWFwcGluZwpvbmVzLgoKU2lnbmVkLW9m
Zi1ieTogSmFuIEJldWxpY2ggPGpiZXVsaWNoQHN1c2UuY29tPgpSZXZpZXdlZC1ieTogUGF1bCBE
dXJyYW50IDxwYXVsLmR1cnJhbnRAY2l0cml4LmNvbT4KLS0tCnY2OiBOZXcuCgotLS0gYS94ZW4v
ZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfaW5pdC5jCisrKyBiL3hlbi9kcml2ZXJzL3Bh
c3N0aHJvdWdoL2FtZC9pb21tdV9pbml0LmMKQEAgLTM5LDcgKzM5LDYgQEAgdW5zaWduZWQgaW50
IF9fcmVhZF9tb3N0bHkgaXZyc19iZGZfZW50cgogdTggX19yZWFkX21vc3RseSBpdmhkX3R5cGU7
CiBzdGF0aWMgc3RydWN0IHJhZGl4X3RyZWVfcm9vdCBpdnJzX21hcHM7CiBMSVNUX0hFQURfUkVB
RF9NT1NUTFkoYW1kX2lvbW11X2hlYWQpOwotc3RydWN0IHRhYmxlX3N0cnVjdCBkZXZpY2VfdGFi
bGU7CiBib29sX3QgaW9tbXV2Ml9lbmFibGVkOwogCiBzdGF0aWMgYm9vbCBpb21tdV9oYXNfaHRf
ZmxhZyhzdHJ1Y3QgYW1kX2lvbW11ICppb21tdSwgdTggbWFzaykKQEAgLTk4OSw2ICs5ODgsMTIg
QEAgc3RhdGljIHZvaWQgZGlzYWJsZV9pb21tdShzdHJ1Y3QgYW1kX2lvbQogICAgIHNwaW5fdW5s
b2NrX2lycXJlc3RvcmUoJmlvbW11LT5sb2NrLCBmbGFncyk7CiB9CiAKK3N0YXRpYyB1bnNpZ25l
ZCBpbnQgX19pbml0IGR0X2FsbG9jX3NpemUodm9pZCkKK3sKKyAgICByZXR1cm4gUEFHRV9TSVpF
IDw8IGdldF9vcmRlcl9mcm9tX2J5dGVzKGl2cnNfYmRmX2VudHJpZXMgKgorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSU9NTVVfREVWX1RBQkxFX0VOVFJZX1NJ
WkUpOworfQorCiBzdGF0aWMgdm9pZCBfX2luaXQgZGVhbGxvY2F0ZV9idWZmZXIodm9pZCAqYnVm
LCB1aW50MzJfdCBzeikKIHsKICAgICBpbnQgb3JkZXIgPSAwOwpAQCAtOTk5LDEyICsxMDA0LDYg
QEAgc3RhdGljIHZvaWQgX19pbml0IGRlYWxsb2NhdGVfYnVmZmVyKHZvaQogICAgIH0KIH0KIAot
c3RhdGljIHZvaWQgX19pbml0IGRlYWxsb2NhdGVfZGV2aWNlX3RhYmxlKHN0cnVjdCB0YWJsZV9z
dHJ1Y3QgKnRhYmxlKQotewotICAgIGRlYWxsb2NhdGVfYnVmZmVyKHRhYmxlLT5idWZmZXIsIHRh
YmxlLT5hbGxvY19zaXplKTsKLSAgICB0YWJsZS0+YnVmZmVyID0gTlVMTDsKLX0KLQogc3RhdGlj
IHZvaWQgX19pbml0IGRlYWxsb2NhdGVfcmluZ19idWZmZXIoc3RydWN0IHJpbmdfYnVmZmVyICpy
aW5nX2J1ZikKIHsKICAgICBkZWFsbG9jYXRlX2J1ZmZlcihyaW5nX2J1Zi0+YnVmZmVyLCByaW5n
X2J1Zi0+YWxsb2Nfc2l6ZSk7CkBAIC0xMDY4LDggKzEwNjcsMjkgQEAgc3RhdGljIHZvaWQgKiBf
X2luaXQgYWxsb2NhdGVfcHByX2xvZyhzdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBJT01NVV9QUFJfTE9HX0RFRkFVTFRfRU5UUklFUywgIlBQUiBMb2ciKTsKIH0KIAorLyoKKyAq
IFdpdGhpbiBpdnJzX21hcHBpbmdzW10gd2UgYWxsb2NhdGUgYW4gZXh0cmEgYXJyYXkgZWxlbWVu
dCB0byBzdG9yZQorICogLSBzZWdtZW50IG51bWJlciwKKyAqIC0gZGV2aWNlIHRhYmxlLgorICov
CisjZGVmaW5lIElWUlNfTUFQUElOR1NfU0VHKG0pIChtKVtpdnJzX2JkZl9lbnRyaWVzXS5kdGVf
cmVxdWVzdG9yX2lkCisjZGVmaW5lIElWUlNfTUFQUElOR1NfREVWVEFCKG0pIChtKVtpdnJzX2Jk
Zl9lbnRyaWVzXS5pbnRyZW1hcF90YWJsZQorCitzdGF0aWMgdm9pZCBfX2luaXQgZnJlZV9pdnJz
X21hcHBpbmcodm9pZCAqcHRyKQoreworICAgIGNvbnN0IHN0cnVjdCBpdnJzX21hcHBpbmdzICpp
dnJzX21hcHBpbmdzID0gcHRyOworCisgICAgaWYgKCBJVlJTX01BUFBJTkdTX0RFVlRBQihpdnJz
X21hcHBpbmdzKSApCisgICAgICAgIGRlYWxsb2NhdGVfYnVmZmVyKElWUlNfTUFQUElOR1NfREVW
VEFCKGl2cnNfbWFwcGluZ3MpLAorICAgICAgICAgICAgICAgICAgICAgICAgICBkdF9hbGxvY19z
aXplKCkpOworCisgICAgeGZyZWUocHRyKTsKK30KKwogc3RhdGljIGludCBfX2luaXQgYW1kX2lv
bW11X2luaXRfb25lKHN0cnVjdCBhbWRfaW9tbXUgKmlvbW11LCBib29sIGludHIpCiB7CisgICAg
Y29uc3Qgc3RydWN0IGl2cnNfbWFwcGluZ3MgKml2cnNfbWFwcGluZ3M7CisKICAgICBpZiAoIGFs
bG9jYXRlX2NtZF9idWZmZXIoaW9tbXUpID09IE5VTEwgKQogICAgICAgICBnb3RvIGVycm9yX291
dDsKIApAQCAtMTA4MiwxMyArMTEwMiwxNSBAQCBzdGF0aWMgaW50IF9faW5pdCBhbWRfaW9tbXVf
aW5pdF9vbmUoc3RyCiAgICAgaWYgKCBpbnRyICYmICFzZXRfaW9tbXVfaW50ZXJydXB0X2hhbmRs
ZXIoaW9tbXUpICkKICAgICAgICAgZ290byBlcnJvcl9vdXQ7CiAKLSAgICAvKiBUbyBtYWtlIHN1
cmUgdGhhdCBkZXZpY2VfdGFibGUuYnVmZmVyIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSBhbGxvY2F0
ZWQgKi8KLSAgICBpZiAoIGRldmljZV90YWJsZS5idWZmZXIgPT0gTlVMTCApCisgICAgLyogTWFr
ZSBzdXJlIHRoYXQgdGhlIGRldmljZSB0YWJsZSBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgYWxsb2Nh
dGVkLiAqLworICAgIGl2cnNfbWFwcGluZ3MgPSBnZXRfaXZyc19tYXBwaW5ncyhpb21tdS0+c2Vn
KTsKKyAgICBpZiAoICFJVlJTX01BUFBJTkdTX0RFVlRBQihpdnJzX21hcHBpbmdzKSApCiAgICAg
ICAgIGdvdG8gZXJyb3Jfb3V0OwogCi0gICAgaW9tbXUtPmRldl90YWJsZS5hbGxvY19zaXplID0g
ZGV2aWNlX3RhYmxlLmFsbG9jX3NpemU7Ci0gICAgaW9tbXUtPmRldl90YWJsZS5lbnRyaWVzID0g
ZGV2aWNlX3RhYmxlLmVudHJpZXM7Ci0gICAgaW9tbXUtPmRldl90YWJsZS5idWZmZXIgPSBkZXZp
Y2VfdGFibGUuYnVmZmVyOworICAgIGlvbW11LT5kZXZfdGFibGUuYWxsb2Nfc2l6ZSA9IGR0X2Fs
bG9jX3NpemUoKTsKKyAgICBpb21tdS0+ZGV2X3RhYmxlLmVudHJpZXMgPSBpb21tdS0+ZGV2X3Rh
YmxlLmFsbG9jX3NpemUgLworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElPTU1VX0RF
Vl9UQUJMRV9FTlRSWV9TSVpFOworICAgIGlvbW11LT5kZXZfdGFibGUuYnVmZmVyID0gSVZSU19N
QVBQSU5HU19ERVZUQUIoaXZyc19tYXBwaW5ncyk7CiAKICAgICBlbmFibGVfaW9tbXUoaW9tbXUp
OwogICAgIHByaW50aygiQU1ELVZpOiBJT01NVSAlZCBFbmFibGVkLlxuIiwgbnJfYW1kX2lvbW11
cyApOwpAQCAtMTEzNSwxMSArMTE1Nyw4IEBAIHN0YXRpYyB2b2lkIF9faW5pdCBhbWRfaW9tbXVf
aW5pdF9jbGVhbnUKICAgICAgICAgeGZyZWUoaW9tbXUpOwogICAgIH0KIAotICAgIC8qIGZyZWUg
ZGV2aWNlIHRhYmxlICovCi0gICAgZGVhbGxvY2F0ZV9kZXZpY2VfdGFibGUoJmRldmljZV90YWJs
ZSk7Ci0KLSAgICAvKiBmcmVlIGl2cnNfbWFwcGluZ3NbXSAqLwotICAgIHJhZGl4X3RyZWVfZGVz
dHJveSgmaXZyc19tYXBzLCB4ZnJlZSk7CisgICAgLyogRnJlZSBpdnJzX21hcHBpbmdzW10gYW5k
IHRoZWlyIGRldmljZSB0YWJsZXMuICovCisgICAgcmFkaXhfdHJlZV9kZXN0cm95KCZpdnJzX21h
cHMsIGZyZWVfaXZyc19tYXBwaW5nKTsKIAogICAgIGlvbW11X2VuYWJsZWQgPSAwOwogICAgIGlv
bW11X2h3ZG9tX3Bhc3N0aHJvdWdoID0gZmFsc2U7CkBAIC0xMTQ3LDEyICsxMTY2LDYgQEAgc3Rh
dGljIHZvaWQgX19pbml0IGFtZF9pb21tdV9pbml0X2NsZWFudQogICAgIGlvbW11djJfZW5hYmxl
ZCA9IDA7CiB9CiAKLS8qCi0gKiBXZSBhbGxvY2F0ZSBhbiBleHRyYSBhcnJheSBlbGVtZW50IHRv
IHN0b3JlIHRoZSBzZWdtZW50IG51bWJlcgotICogKGFuZCBpbiB0aGUgZnV0dXJlIHBlcmhhcHMg
b3RoZXIgZ2xvYmFsIGluZm9ybWF0aW9uKS4KLSAqLwotI2RlZmluZSBJVlJTX01BUFBJTkdTX1NF
RyhtKSBtW2l2cnNfYmRmX2VudHJpZXNdLmR0ZV9yZXF1ZXN0b3JfaWQKLQogc3RydWN0IGl2cnNf
bWFwcGluZ3MgKmdldF9pdnJzX21hcHBpbmdzKHUxNiBzZWcpCiB7CiAgICAgcmV0dXJuIHJhZGl4
X3RyZWVfbG9va3VwKCZpdnJzX21hcHMsIHNlZyk7CkBAIC0xMjM1LDI0ICsxMjQ4LDE4IEBAIHN0
YXRpYyBpbnQgX19pbml0IGFsbG9jX2l2cnNfbWFwcGluZ3ModTEKIHN0YXRpYyBpbnQgX19pbml0
IGFtZF9pb21tdV9zZXR1cF9kZXZpY2VfdGFibGUoCiAgICAgdTE2IHNlZywgc3RydWN0IGl2cnNf
bWFwcGluZ3MgKml2cnNfbWFwcGluZ3MpCiB7CisgICAgc3RydWN0IGFtZF9pb21tdV9kdGUgKmR0
ID0gSVZSU19NQVBQSU5HU19ERVZUQUIoaXZyc19tYXBwaW5ncyk7CiAgICAgdW5zaWduZWQgaW50
IGJkZjsKIAogICAgIEJVR19PTiggKGl2cnNfYmRmX2VudHJpZXMgPT0gMCkgKTsKIAotICAgIGlm
ICggIWRldmljZV90YWJsZS5idWZmZXIgKQorICAgIGlmICggIWR0ICkKICAgICB7CiAgICAgICAg
IC8qIGFsbG9jYXRlICdkZXZpY2UgdGFibGUnIG9uIGEgNEsgYm91bmRhcnkgKi8KLSAgICAgICAg
ZGV2aWNlX3RhYmxlLmFsbG9jX3NpemUgPSBQQUdFX1NJWkUgPDwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBnZXRfb3JkZXJfZnJvbV9ieXRlcygKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBQQUdFX0FMSUdOKGl2cnNfYmRmX2VudHJpZXMgKgotICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIElPTU1VX0RFVl9UQUJMRV9FTlRSWV9TSVpFKSk7Ci0g
ICAgICAgIGRldmljZV90YWJsZS5lbnRyaWVzID0gZGV2aWNlX3RhYmxlLmFsbG9jX3NpemUgLwot
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElPTU1VX0RFVl9UQUJMRV9FTlRSWV9TSVpF
OwotCi0gICAgICAgIGRldmljZV90YWJsZS5idWZmZXIgPSBhbGxvY2F0ZV9idWZmZXIoZGV2aWNl
X3RhYmxlLmFsbG9jX3NpemUsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIkRldmljZSBUYWJsZSIpOworICAgICAgICBkdCA9IElWUlNfTUFQUElOR1NfREVW
VEFCKGl2cnNfbWFwcGluZ3MpID0KKyAgICAgICAgICAgIGFsbG9jYXRlX2J1ZmZlcihkdF9hbGxv
Y19zaXplKCksICJEZXZpY2UgVGFibGUiKTsKICAgICB9Ci0gICAgaWYgKCAhZGV2aWNlX3RhYmxl
LmJ1ZmZlciApCisgICAgaWYgKCAhZHQgKQogICAgICAgICByZXR1cm4gLUVOT01FTTsKIAogICAg
IC8qIEFkZCBkZXZpY2UgdGFibGUgZW50cmllcyAqLwpAQCAtMTI2MCwxMiArMTI2NywxMCBAQCBz
dGF0aWMgaW50IF9faW5pdCBhbWRfaW9tbXVfc2V0dXBfZGV2aWNlCiAgICAgewogICAgICAgICBp
ZiAoIGl2cnNfbWFwcGluZ3NbYmRmXS52YWxpZCApCiAgICAgICAgIHsKLSAgICAgICAgICAgIHZv
aWQgKmR0ZTsKICAgICAgICAgICAgIGNvbnN0IHN0cnVjdCBwY2lfZGV2ICpwZGV2ID0gTlVMTDsK
IAogICAgICAgICAgICAgLyogYWRkIGRldmljZSB0YWJsZSBlbnRyeSAqLwotICAgICAgICAgICAg
ZHRlID0gZGV2aWNlX3RhYmxlLmJ1ZmZlciArIChiZGYgKiBJT01NVV9ERVZfVEFCTEVfRU5UUllf
U0laRSk7Ci0gICAgICAgICAgICBpb21tdV9kdGVfYWRkX2RldmljZV9lbnRyeShkdGUsICZpdnJz
X21hcHBpbmdzW2JkZl0pOworICAgICAgICAgICAgaW9tbXVfZHRlX2FkZF9kZXZpY2VfZW50cnko
JmR0W2JkZl0sICZpdnJzX21hcHBpbmdzW2JkZl0pOwogCiAgICAgICAgICAgICBpZiAoIGlvbW11
X2ludHJlbWFwICYmCiAgICAgICAgICAgICAgICAgIGl2cnNfbWFwcGluZ3NbYmRmXS5kdGVfcmVx
dWVzdG9yX2lkID09IGJkZiAmJgpAQCAtMTMwOCw3ICsxMzEzLDcgQEAgc3RhdGljIGludCBfX2lu
aXQgYW1kX2lvbW11X3NldHVwX2RldmljZQogICAgICAgICAgICAgfQogCiAgICAgICAgICAgICBh
bWRfaW9tbXVfc2V0X2ludHJlbWFwX3RhYmxlKAotICAgICAgICAgICAgICAgIGR0ZSwgaXZyc19t
YXBwaW5nc1tiZGZdLmludHJlbWFwX3RhYmxlLAorICAgICAgICAgICAgICAgICZkdFtiZGZdLCBp
dnJzX21hcHBpbmdzW2JkZl0uaW50cmVtYXBfdGFibGUsCiAgICAgICAgICAgICAgICAgaXZyc19t
YXBwaW5nc1tiZGZdLmlvbW11LCBpb21tdV9pbnRyZW1hcCk7CiAgICAgICAgIH0KICAgICB9CgoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVs
IG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0
cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

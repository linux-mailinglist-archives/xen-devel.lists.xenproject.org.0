Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 4138D7D91D
	for <lists+xen-devel@lfdr.de>; Thu,  1 Aug 2019 12:16:04 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1ht85e-00014v-NL; Thu, 01 Aug 2019 10:13:42 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=6jP+=V5=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1ht85d-00014W-27
 for xen-devel@lists.xenproject.org; Thu, 01 Aug 2019 10:13:41 +0000
X-Inumbo-ID: 075a17df-b445-11e9-8980-bc764e045a96
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 075a17df-b445-11e9-8980-bc764e045a96;
 Thu, 01 Aug 2019 10:13:38 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id ACEB6B61C;
 Thu,  1 Aug 2019 10:13:37 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Thu,  1 Aug 2019 12:13:33 +0200
Message-Id: <20190801101333.9821-5-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190801101333.9821-1-jgross@suse.com>
References: <20190801101333.9821-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v2 4/4] xen: add per-cpu buffer option to
 debugtrace
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

ZGVidWd0cmFjZSBpcyBub3JtYWxseSB3cml0aW5nIHRyYWNlIGVudHJpZXMgaW50byBhIHNpbmds
ZSB0cmFjZQpidWZmZXIuIFRoZXJlIGFyZSBjYXNlcyB3aGVyZSB0aGlzIGlzIG5vdCBvcHRpbWFs
LCBlLmcuIHdoZW4gaHVudGluZwphIGJ1ZyB3aGljaCByZXF1aXJlcyB3cml0aW5nIGxvdHMgb2Yg
dHJhY2UgZW50cmllcyBhbmQgb25lIGNwdSBpcwpzdHVjay4gVGhpcyB3aWxsIHJlc3VsdCBpbiBv
dGhlciBjcHVzIGZpbGxpbmcgdGhlIHRyYWNlIGJ1ZmZlciBhbmQKZmluYWxseSBvdmVyd3JpdGlu
ZyB0aGUgaW50ZXJlc3RpbmcgdHJhY2UgZW50cmllcyBvZiB0aGUgaGFuZ2luZyBjcHUuCgpJbiBv
cmRlciB0byBiZSBhYmxlIHRvIGRlYnVnIHN1Y2ggc2l0dWF0aW9ucyBhZGQgdGhlIGNhcGFiaWxp
dHkgdG8gdXNlCnBlci1jcHUgdHJhY2UgYnVmZmVycy4gVGhpcyBjYW4gYmUgc2VsZWN0ZWQgYnkg
c3BlY2lmeWluZyB0aGUKZGVidWd0cmFjZSBib290IHBhcmFtZXRlciB3aXRoIHRoZSBtb2RpZmll
ciAiY3B1OiIsIGxpa2U6CgogIGRlYnVndHJhY2U9Y3B1OjE2CgpBdCB0aGUgc2FtZSB0aW1lIHN3
aXRjaCB0aGUgcGFyc2luZyBmdW5jdGlvbiB0byBhY2NlcHQgc2l6ZSBtb2RpZmllcnMKKGUuZy4g
NE0gb3IgMUcpLgoKUHJpbnRpbmcgb3V0IHRoZSB0cmFjZSBlbnRyaWVzIGlzIGRvbmUgZm9yIGVh
Y2ggYnVmZmVyIGluIG9yZGVyIHRvCm1pbmltaXplIHRoZSBlZmZvcnQgbmVlZGVkIGR1cmluZyBw
cmludGluZy4gQXMgZWFjaCBlbnRyeSBpcyBwcmVmaXhlZAp3aXRoIGl0cyBzZXF1ZW5jZSBudW1i
ZXIgc29ydGluZyB0aGUgZW50cmllcyBjYW4gZWFzaWx5IGJlIGRvbmUgd2hlbgphbmFseXppbmcg
dGhlbS4KClNpZ25lZC1vZmYtYnk6IEp1ZXJnZW4gR3Jvc3MgPGpncm9zc0BzdXNlLmNvbT4KLS0t
ClYyOiBvbmx5IGFsbG9jYXRlIGJ1ZmZlciBpZiBub3QgYWxyZWFkeSBkb25lIHNvCi0tLQogZG9j
cy9taXNjL3hlbi1jb21tYW5kLWxpbmUucGFuZG9jIHwgICA3ICstCiB4ZW4vY29tbW9uL2RlYnVn
dHJhY2UuYyAgICAgICAgICAgfCAxNDUgKysrKysrKysrKysrKysrKysrKysrKysrKysrKystLS0t
LS0tLS0KIDIgZmlsZXMgY2hhbmdlZCwgMTE1IGluc2VydGlvbnMoKyksIDM3IGRlbGV0aW9ucygt
KQoKZGlmZiAtLWdpdCBhL2RvY3MvbWlzYy94ZW4tY29tbWFuZC1saW5lLnBhbmRvYyBiL2RvY3Mv
bWlzYy94ZW4tY29tbWFuZC1saW5lLnBhbmRvYwppbmRleCA3YzcyZTMxMDMyLi44MzI3OTdlMmUy
IDEwMDY0NAotLS0gYS9kb2NzL21pc2MveGVuLWNvbW1hbmQtbGluZS5wYW5kb2MKKysrIGIvZG9j
cy9taXNjL3hlbi1jb21tYW5kLWxpbmUucGFuZG9jCkBAIC02NDQsMTIgKzY0NCwxMyBAQCBvdmVy
IHRoZSBQQ0kgYnVzc2VzIHNlcXVlbnRpYWxseSkgb3IgYnkgUENJIGRldmljZSAobXVzdCBiZSBv
biBzZWdtZW50IDApLgogTGltaXRzIHRoZSBudW1iZXIgbGluZXMgcHJpbnRlZCBpbiBYZW4gc3Rh
Y2sgdHJhY2VzLgogCiAjIyMgZGVidWd0cmFjZQotPiBgPSA8aW50ZWdlcj5gCis+IGA9IFtjcHU6
XTxzaXplPmAKIAogPiBEZWZhdWx0OiBgMTI4YAogCi1TcGVjaWZ5IHRoZSBzaXplIG9mIHRoZSBj
b25zb2xlIGRlYnVnIHRyYWNlIGJ1ZmZlciBpbiBLaUIuIFRoZSBkZWJ1ZwotdHJhY2UgZmVhdHVy
ZSBpcyBvbmx5IGVuYWJsZWQgaW4gZGVidWdnaW5nIGJ1aWxkcyBvZiBYZW4uCitTcGVjaWZ5IHRo
ZSBzaXplIG9mIHRoZSBjb25zb2xlIGRlYnVnIHRyYWNlIGJ1ZmZlci4gQnkgc3BlY2lmeWluZyBg
Y3B1OmAKK2FkZGl0aW9uYWxseSBhIHRyYWNlIGJ1ZmZlciBvZiB0aGUgc3BlY2lmaWVkIHNpemUg
aXMgYWxsb2NhdGVkIHBlciBjcHUuCitUaGUgZGVidWcgdHJhY2UgZmVhdHVyZSBpcyBvbmx5IGVu
YWJsZWQgaW4gZGVidWdnaW5nIGJ1aWxkcyBvZiBYZW4uCiAKICMjIyBkbWFfYml0cwogPiBgPSA8
aW50ZWdlcj5gCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL2RlYnVndHJhY2UuYyBiL3hlbi9jb21t
b24vZGVidWd0cmFjZS5jCmluZGV4IGMwMTg5MjY3ZGQuLjk0Yzk1MzE2YzMgMTAwNjQ0Ci0tLSBh
L3hlbi9jb21tb24vZGVidWd0cmFjZS5jCisrKyBiL3hlbi9jb21tb24vZGVidWd0cmFjZS5jCkBA
IC02LDYgKzYsNyBAQAogCiAKICNpbmNsdWRlIDx4ZW4vY29uc29sZS5oPgorI2luY2x1ZGUgPHhl
bi9jcHUuaD4KICNpbmNsdWRlIDx4ZW4vaW5pdC5oPgogI2luY2x1ZGUgPHhlbi9rZXloYW5kbGVy
Lmg+CiAjaW5jbHVkZSA8eGVuL2xpYi5oPgpAQCAtMjQsMzAgKzI1LDYxIEBAIHN0cnVjdCBkZWJ1
Z3RyYWNlX2RhdGFfcyB7CiB9OwogCiBzdGF0aWMgc3RydWN0IGRlYnVndHJhY2VfZGF0YV9zICpk
ZWJ0cl9kYXRhOworc3RhdGljIERFRklORV9QRVJfQ1BVKHN0cnVjdCBkZWJ1Z3RyYWNlX2RhdGFf
cyAqLCBkZWJ0cl9jcHVfZGF0YSk7CiAKLXN0YXRpYyB1bnNpZ25lZCBpbnQgZGVidWd0cmFjZV9r
aWxvYnl0ZXMgPSAxMjg7CitzdGF0aWMgdW5zaWduZWQgaW50IGRlYnVndHJhY2VfYnl0ZXMgPSAx
MjggPDwgMTA7CitzdGF0aWMgYm9vbCBkZWJ1Z3RyYWNlX3Blcl9jcHU7CiBzdGF0aWMgYm9vbCBk
ZWJ1Z3RyYWNlX3VzZWQ7CiBzdGF0aWMgREVGSU5FX1NQSU5MT0NLKGRlYnVndHJhY2VfbG9jayk7
Ci1pbnRlZ2VyX3BhcmFtKCJkZWJ1Z3RyYWNlIiwgZGVidWd0cmFjZV9raWxvYnl0ZXMpOwogCi1z
dGF0aWMgdm9pZCBkZWJ1Z3RyYWNlX2R1bXBfd29ya2VyKHZvaWQpCitzdGF0aWMgaW50IF9faW5p
dCBkZWJ1Z3RyYWNlX3BhcnNlX3BhcmFtKGNvbnN0IGNoYXIgKnMpCit7CisgICAgaWYgKCAhc3Ry
bmNtcChzLCAiY3B1OiIsIDQpICkKKyAgICB7CisgICAgICAgIGRlYnVndHJhY2VfcGVyX2NwdSA9
IHRydWU7CisgICAgICAgIHMgKz0gNDsKKyAgICB9CisgICAgZGVidWd0cmFjZV9ieXRlcyA9ICBw
YXJzZV9zaXplX2FuZF91bml0KHMsIE5VTEwpOworICAgIHJldHVybiAwOworfQorY3VzdG9tX3Bh
cmFtKCJkZWJ1Z3RyYWNlIiwgZGVidWd0cmFjZV9wYXJzZV9wYXJhbSk7CisKK3N0YXRpYyB2b2lk
IGRlYnVndHJhY2VfZHVtcF9idWZmZXIoc3RydWN0IGRlYnVndHJhY2VfZGF0YV9zICpkYXRhLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGFyICp3aGljaCkKIHsK
LSAgICBpZiAoICFkZWJ0cl9kYXRhIHx8ICFkZWJ1Z3RyYWNlX3VzZWQgKQorICAgIGlmICggIWRh
dGEgKQogICAgICAgICByZXR1cm47CiAKLSAgICBwcmludGsoImRlYnVndHJhY2VfZHVtcCgpIHN0
YXJ0aW5nXG4iKTsKKyAgICBwcmludGsoImRlYnVndHJhY2VfZHVtcCgpICVzIGJ1ZmZlciBzdGFy
dGluZ1xuIiwgd2hpY2gpOwogCiAgICAgLyogUHJpbnQgb2xkZXN0IHBvcnRpb24gb2YgdGhlIHJp
bmcuICovCi0gICAgQVNTRVJUKGRlYnRyX2RhdGEtPmJ1ZltkZWJ0cl9kYXRhLT5ieXRlcyAtIDFd
ID09IDApOwotICAgIGNvbnNvbGVfc2VyaWFsX3B1dHMoJmRlYnRyX2RhdGEtPmJ1ZltkZWJ0cl9k
YXRhLT5wcmRdKTsKKyAgICBBU1NFUlQoZGF0YS0+YnVmW2RhdGEtPmJ5dGVzIC0gMV0gPT0gMCk7
CisgICAgY29uc29sZV9zZXJpYWxfcHV0cygmZGF0YS0+YnVmW2RhdGEtPnByZF0pOwogCiAgICAg
LyogUHJpbnQgeW91bmdlc3QgcG9ydGlvbiBvZiB0aGUgcmluZy4gKi8KLSAgICBkZWJ0cl9kYXRh
LT5idWZbZGVidHJfZGF0YS0+cHJkXSA9ICdcMCc7Ci0gICAgY29uc29sZV9zZXJpYWxfcHV0cygm
ZGVidHJfZGF0YS0+YnVmWzBdKTsKKyAgICBkYXRhLT5idWZbZGF0YS0+cHJkXSA9ICdcMCc7Cisg
ICAgY29uc29sZV9zZXJpYWxfcHV0cygmZGF0YS0+YnVmWzBdKTsKKworICAgIG1lbXNldChkYXRh
LT5idWYsICdcMCcsIGRhdGEtPmJ5dGVzKTsKKworICAgIHByaW50aygiZGVidWd0cmFjZV9kdW1w
KCkgJXMgYnVmZmVyIGZpbmlzaGVkXG4iLCB3aGljaCk7Cit9CisKK3N0YXRpYyB2b2lkIGRlYnVn
dHJhY2VfZHVtcF93b3JrZXIodm9pZCkKK3sKKyAgICB1bnNpZ25lZCBpbnQgY3B1OworICAgIGNo
YXIgYnVmWzE2XTsKKworICAgIGlmICggIWRlYnVndHJhY2VfdXNlZCApCisgICAgICAgIHJldHVy
bjsKIAotICAgIG1lbXNldChkZWJ0cl9kYXRhLT5idWYsICdcMCcsIGRlYnRyX2RhdGEtPmJ5dGVz
KTsKKyAgICBkZWJ1Z3RyYWNlX2R1bXBfYnVmZmVyKGRlYnRyX2RhdGEsICJnbG9iYWwiKTsKIAot
ICAgIHByaW50aygiZGVidWd0cmFjZV9kdW1wKCkgZmluaXNoZWRcbiIpOworICAgIGZvciAoIGNw
dSA9IDA7IGNwdSA8IG5yX2NwdV9pZHM7IGNwdSsrICkKKyAgICB7CisgICAgICAgIHNucHJpbnRm
KGJ1Ziwgc2l6ZW9mKGJ1ZiksICJjcHUgJXUiLCBjcHUpOworICAgICAgICBkZWJ1Z3RyYWNlX2R1
bXBfYnVmZmVyKHBlcl9jcHUoZGVidHJfY3B1X2RhdGEsIGNwdSksIGJ1Zik7CisgICAgfQogfQog
CiBzdGF0aWMgdm9pZCBkZWJ1Z3RyYWNlX3RvZ2dsZSh2b2lkKQpAQCAtODcsMzQgKzExOSw0MSBA
QCB2b2lkIGRlYnVndHJhY2VfZHVtcCh2b2lkKQogCiBzdGF0aWMgdm9pZCBkZWJ1Z3RyYWNlX2Fk
ZF90b19idWYoY2hhciAqYnVmKQogeworICAgIHN0cnVjdCBkZWJ1Z3RyYWNlX2RhdGFfcyAqZGF0
YTsKICAgICBjaGFyICpwOwogCisgICAgZGF0YSA9IGRlYnVndHJhY2VfcGVyX2NwdSA/IHRoaXNf
Y3B1KGRlYnRyX2NwdV9kYXRhKSA6IGRlYnRyX2RhdGE7CisKICAgICBmb3IgKCBwID0gYnVmOyAq
cCAhPSAnXDAnOyBwKysgKQogICAgIHsKLSAgICAgICAgZGVidHJfZGF0YS0+YnVmW2RlYnRyX2Rh
dGEtPnByZCsrXSA9ICpwOworICAgICAgICBkYXRhLT5idWZbZGF0YS0+cHJkKytdID0gKnA7CiAg
ICAgICAgIC8qIEFsd2F5cyBsZWF2ZSBhIG51bCBieXRlIGF0IHRoZSBlbmQgb2YgdGhlIGJ1ZmZl
ci4gKi8KLSAgICAgICAgaWYgKCBkZWJ0cl9kYXRhLT5wcmQgPT0gKGRlYnRyX2RhdGEtPmJ5dGVz
IC0gMSkgKQotICAgICAgICAgICAgZGVidHJfZGF0YS0+cHJkID0gMDsKKyAgICAgICAgaWYgKCBk
YXRhLT5wcmQgPT0gKGRhdGEtPmJ5dGVzIC0gMSkgKQorICAgICAgICAgICAgZGF0YS0+cHJkID0g
MDsKICAgICB9CiB9CiAKIHZvaWQgZGVidWd0cmFjZV9wcmludGsoY29uc3QgY2hhciAqZm10LCAu
Li4pCiB7CiAgICAgc3RhdGljIGNoYXIgYnVmWzEwMjRdLCBsYXN0X2J1ZlsxMDI0XTsKLSAgICBz
dGF0aWMgdW5zaWduZWQgaW50IGNvdW50LCBsYXN0X2NvdW50LCBsYXN0X3ByZDsKKyAgICBzdGF0
aWMgdW5zaWduZWQgaW50IGNvdW50LCBsYXN0X2NvdW50LCBsYXN0X3ByZCwgbGFzdF9jcHU7CiAK
ICAgICBjaGFyICAgICAgICAgIGNudGJ1ZlsyNF07CiAgICAgdmFfbGlzdCAgICAgICBhcmdzOwog
ICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7CisgICAgc3RydWN0IGRlYnVndHJhY2VfZGF0YV9zICpk
YXRhOworICAgIHVuc2lnbmVkIGludCBjcHU7CiAKLSAgICBpZiAoICFkZWJ0cl9kYXRhICkKKyAg
ICBkYXRhID0gZGVidWd0cmFjZV9wZXJfY3B1ID8gdGhpc19jcHUoZGVidHJfY3B1X2RhdGEpIDog
ZGVidHJfZGF0YTsKKyAgICBjcHUgPSBkZWJ1Z3RyYWNlX3Blcl9jcHUgPyBzbXBfcHJvY2Vzc29y
X2lkKCkgOiAwOworICAgIGlmICggIWRhdGEgKQogICAgICAgICByZXR1cm47CiAKICAgICBkZWJ1
Z3RyYWNlX3VzZWQgPSB0cnVlOwogCiAgICAgc3Bpbl9sb2NrX2lycXNhdmUoJmRlYnVndHJhY2Vf
bG9jaywgZmxhZ3MpOwogCi0gICAgQVNTRVJUKGRlYnRyX2RhdGEtPmJ1ZltkZWJ0cl9kYXRhLT5i
eXRlcyAtIDFdID09IDApOworICAgIEFTU0VSVChkYXRhLT5idWZbZGF0YS0+Ynl0ZXMgLSAxXSA9
PSAwKTsKIAogICAgIHZhX3N0YXJ0KGFyZ3MsIGZtdCk7CiAgICAgdnNucHJpbnRmKGJ1Ziwgc2l6
ZW9mKGJ1ZiksIGZtdCwgYXJncyk7CkBAIC0xMjgsMTYgKzE2NywxNyBAQCB2b2lkIGRlYnVndHJh
Y2VfcHJpbnRrKGNvbnN0IGNoYXIgKmZtdCwgLi4uKQogICAgIH0KICAgICBlbHNlCiAgICAgewot
ICAgICAgICBpZiAoIHN0cmNtcChidWYsIGxhc3RfYnVmKSApCisgICAgICAgIGlmICggc3RyY21w
KGJ1ZiwgbGFzdF9idWYpIHx8IGNwdSAhPSBsYXN0X2NwdSApCiAgICAgICAgIHsKLSAgICAgICAg
ICAgIGxhc3RfcHJkID0gZGVidHJfZGF0YS0+cHJkOworICAgICAgICAgICAgbGFzdF9wcmQgPSBk
YXRhLT5wcmQ7CiAgICAgICAgICAgICBsYXN0X2NvdW50ID0gKytjb3VudDsKKyAgICAgICAgICAg
IGxhc3RfY3B1ID0gY3B1OwogICAgICAgICAgICAgc2FmZV9zdHJjcHkobGFzdF9idWYsIGJ1Zik7
CiAgICAgICAgICAgICBzbnByaW50ZihjbnRidWYsIHNpemVvZihjbnRidWYpLCAiJXUgIiwgY291
bnQpOwogICAgICAgICB9CiAgICAgICAgIGVsc2UKICAgICAgICAgewotICAgICAgICAgICAgZGVi
dHJfZGF0YS0+cHJkID0gbGFzdF9wcmQ7CisgICAgICAgICAgICBkYXRhLT5wcmQgPSBsYXN0X3By
ZDsKICAgICAgICAgICAgIHNucHJpbnRmKGNudGJ1Ziwgc2l6ZW9mKGNudGJ1ZiksICIldS0ldSAi
LCBsYXN0X2NvdW50LCArK2NvdW50KTsKICAgICAgICAgfQogICAgICAgICBkZWJ1Z3RyYWNlX2Fk
ZF90b19idWYoY250YnVmKTsKQEAgLTE1MiwzMyArMTkyLDcwIEBAIHN0YXRpYyB2b2lkIGRlYnVn
dHJhY2Vfa2V5KHVuc2lnbmVkIGNoYXIga2V5KQogICAgIGRlYnVndHJhY2VfdG9nZ2xlKCk7CiB9
CiAKLXN0YXRpYyBpbnQgX19pbml0IGRlYnVndHJhY2VfaW5pdCh2b2lkKQorc3RhdGljIHZvaWQg
ZGVidWd0cmFjZV9hbGxvY19idWZmZXIoc3RydWN0IGRlYnVndHJhY2VfZGF0YV9zICoqcHRyKQog
ewogICAgIGludCBvcmRlcjsKLSAgICB1bnNpZ25lZCBsb25nIGtieXRlcywgYnl0ZXM7CiAgICAg
c3RydWN0IGRlYnVndHJhY2VfZGF0YV9zICpkYXRhOwogCi0gICAgLyogUm91bmQgc2l6ZSBkb3du
IHRvIG5leHQgcG93ZXIgb2YgdHdvLiAqLwotICAgIHdoaWxlICggKGtieXRlcyA9IChkZWJ1Z3Ry
YWNlX2tpbG9ieXRlcyAmIChkZWJ1Z3RyYWNlX2tpbG9ieXRlcy0xKSkpICE9IDAgKQotICAgICAg
ICBkZWJ1Z3RyYWNlX2tpbG9ieXRlcyA9IGtieXRlczsKLQotICAgIGJ5dGVzID0gZGVidWd0cmFj
ZV9raWxvYnl0ZXMgPDwgMTA7Ci0gICAgaWYgKCBieXRlcyA9PSAwICkKLSAgICAgICAgcmV0dXJu
IDA7CisgICAgaWYgKCBkZWJ1Z3RyYWNlX2J5dGVzIDwgUEFHRV9TSVpFIHx8ICpwdHIgKQorICAg
ICAgICByZXR1cm47CiAKLSAgICBvcmRlciA9IGdldF9vcmRlcl9mcm9tX2J5dGVzKGJ5dGVzKTsK
KyAgICBvcmRlciA9IGdldF9vcmRlcl9mcm9tX2J5dGVzKGRlYnVndHJhY2VfYnl0ZXMpOwogICAg
IGRhdGEgPSBhbGxvY194ZW5oZWFwX3BhZ2VzKG9yZGVyLCAwKTsKICAgICBpZiAoICFkYXRhICkK
LSAgICAgICAgcmV0dXJuIC1FTk9NRU07CisgICAgeworICAgICAgICBwcmludGsoImZhaWxlZCB0
byBhbGxvY2F0ZSBkZWJ1Z3RyYWNlIGJ1ZmZlclxuIik7CisgICAgICAgIHJldHVybjsKKyAgICB9
CisKKyAgICBtZW1zZXQoZGF0YSwgJ1wwJywgZGVidWd0cmFjZV9ieXRlcyk7CisgICAgZGF0YS0+
Ynl0ZXMgPSBkZWJ1Z3RyYWNlX2J5dGVzIC0gc2l6ZW9mKCpkYXRhKTsKKworICAgICpwdHIgPSBk
YXRhOworfQorCitzdGF0aWMgaW50IGRlYnVndHJhY2VfY3B1X2NhbGxiYWNrKHN0cnVjdCBub3Rp
Zmllcl9ibG9jayAqbmZiLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNp
Z25lZCBsb25nIGFjdGlvbiwgdm9pZCAqaGNwdSkKK3sKKyAgICB1bnNpZ25lZCBpbnQgY3B1ID0g
KHVuc2lnbmVkIGxvbmcpaGNwdTsKKworICAgIC8qIEJ1ZmZlcnMgYXJlIG9ubHkgZXZlciBhbGxv
Y2F0ZWQsIG5ldmVyIGZyZWVkLiAqLworICAgIHN3aXRjaCAoIGFjdGlvbiApCisgICAgeworICAg
IGNhc2UgQ1BVX1VQX1BSRVBBUkU6CisgICAgICAgIGRlYnVndHJhY2VfYWxsb2NfYnVmZmVyKCZw
ZXJfY3B1KGRlYnRyX2NwdV9kYXRhLCBjcHUpKTsKKyAgICAgICAgYnJlYWs7CisgICAgZGVmYXVs
dDoKKyAgICAgICAgYnJlYWs7CisgICAgfQorICAgIHJldHVybiAwOworfQogCi0gICAgbWVtc2V0
KGRhdGEsICdcMCcsIGJ5dGVzKTsKK3N0YXRpYyBzdHJ1Y3Qgbm90aWZpZXJfYmxvY2sgZGVidWd0
cmFjZV9uZmIgPSB7CisgICAgLm5vdGlmaWVyX2NhbGwgPSBkZWJ1Z3RyYWNlX2NwdV9jYWxsYmFj
aworfTsKKworc3RhdGljIGludCBfX2luaXQgZGVidWd0cmFjZV9pbml0KHZvaWQpCit7CisgICAg
dW5zaWduZWQgbG9uZyBieXRlczsKKyAgICB1bnNpZ25lZCBpbnQgY3B1OwogCi0gICAgZGF0YS0+
Ynl0ZXMgPSBieXRlcyAtIHNpemVvZigqZGF0YSk7Ci0gICAgZGVidHJfZGF0YSA9IGRhdGE7Cisg
ICAgLyogUm91bmQgc2l6ZSBkb3duIHRvIG5leHQgcG93ZXIgb2YgdHdvLiAqLworICAgIHdoaWxl
ICggKGJ5dGVzID0gKGRlYnVndHJhY2VfYnl0ZXMgJiAoZGVidWd0cmFjZV9ieXRlcyAtIDEpKSkg
IT0gMCApCisgICAgICAgIGRlYnVndHJhY2VfYnl0ZXMgPSBieXRlczsKIAogICAgIHJlZ2lzdGVy
X2tleWhhbmRsZXIoJ1QnLCBkZWJ1Z3RyYWNlX2tleSwKICAgICAgICAgICAgICAgICAgICAgICAg
ICJ0b2dnbGUgZGVidWd0cmFjZSB0byBjb25zb2xlL2J1ZmZlciIsIDApOwogCisgICAgaWYgKCBk
ZWJ1Z3RyYWNlX3Blcl9jcHUgKQorICAgIHsKKyAgICAgICAgZm9yX2VhY2hfb25saW5lX2NwdSAo
IGNwdSApCisgICAgICAgICAgICBkZWJ1Z3RyYWNlX2FsbG9jX2J1ZmZlcigmcGVyX2NwdShkZWJ0
cl9jcHVfZGF0YSwgY3B1KSk7CisgICAgICAgIHJlZ2lzdGVyX2NwdV9ub3RpZmllcigmZGVidWd0
cmFjZV9uZmIpOworICAgIH0KKyAgICBlbHNlCisgICAgICAgIGRlYnVndHJhY2VfYWxsb2NfYnVm
ZmVyKCZkZWJ0cl9kYXRhKTsKKwogICAgIHJldHVybiAwOwogfQogX19pbml0Y2FsbChkZWJ1Z3Ry
YWNlX2luaXQpOwotLSAKMi4xNi40CgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVu
cHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZv
L3hlbi1kZXZlbA==

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 209FCC222D
	for <lists+xen-devel@lfdr.de>; Mon, 30 Sep 2019 15:36:33 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iEvny-0005bU-Bf; Mon, 30 Sep 2019 13:33:34 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=znM2=XZ=citrix.com=roger.pau@srs-us1.protection.inumbo.net>)
 id 1iEvnx-0005ah-60
 for xen-devel@lists.xenproject.org; Mon, 30 Sep 2019 13:33:33 +0000
X-Inumbo-ID: de9173d0-e386-11e9-97fb-bc764e2007e4
Received: from esa6.hc3370-68.iphmx.com (unknown [216.71.155.175])
 by localhost (Halon) with ESMTPS
 id de9173d0-e386-11e9-97fb-bc764e2007e4;
 Mon, 30 Sep 2019 13:33:21 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1569850400;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=sbKQ4jAblxD7x5cKYMbpA0wwvvCtJS1TSr1PWb+yeXc=;
 b=Wi8rBQLaJwLwGkfMZzddd1fjRA3oyizMbMFjGvDOVef4aZkumDajZh2r
 2tb0akAaFt6xbyfHwjMBo3vqvKPvMZ384ee792mx49UIcy2BpcQ4YzOET
 CX0X3gDLnPKSaZCdIPz5rJAZa/14IYP9SuzeZivPnIj1X8bV7j/FPo6qY w=;
Authentication-Results: esa6.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=roger.pau@citrix.com;
 spf=Pass smtp.mailfrom=roger.pau@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa6.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 roger.pau@citrix.com) identity=pra; client-ip=162.221.158.21;
 receiver=esa6.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="roger.pau@citrix.com"; x-conformance=sidf_compatible
Received-SPF: Pass (esa6.hc3370-68.iphmx.com: domain of
 roger.pau@citrix.com designates 162.221.158.21 as permitted
 sender) identity=mailfrom; client-ip=162.221.158.21;
 receiver=esa6.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="roger.pau@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83 ~all"
Received-SPF: None (esa6.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa6.hc3370-68.iphmx.com;
 envelope-from="roger.pau@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: GZBQF3Qpmjs9kB/hvdGzhRHLcmlTXffaWozJaaWQLNCAFUpmU657/6FM4WIOoc0qfCXkJ1+ZFp
 mW5Y8ecEoLwxbGA1y7XFt4hCWvKrHBIAuFjj5lckhrMCnPCvX4mDjxr6YyfUmI95/XRQcV7ZR9
 A59vJIIZPKeexdWiRCsGUK77ipqpZ64/48PUJddvaChbelSqT6TZvB8ellWZ01LBtjsdf7+8sA
 pinlbWeoc9Dgvz0Lrk6qpPNASVHsha26cxG5K6Lk1+a3QWXKnefVTbstvnIu5ajdM6NiWtq6Si
 mNU=
X-SBRS: 2.7
X-MesageID: 6538595
X-Ironport-Server: esa6.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.64,567,1559534400"; 
   d="scan'208";a="6538595"
From: Roger Pau Monne <roger.pau@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Mon, 30 Sep 2019 15:32:35 +0200
Message-ID: <20190930133238.49868-8-roger.pau@citrix.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190930133238.49868-1-roger.pau@citrix.com>
References: <20190930133238.49868-1-roger.pau@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v3 07/10] ioreq: allow decoding accesses to
 MMCFG regions
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>, Paul Durrant <paul@xen.org>,
 Wei Liu <wl@xen.org>, Jan Beulich <jbeulich@suse.com>,
 Roger Pau Monne <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

UGljayB1cCBvbiB0aGUgaW5mcmFzdHJ1Y3R1cmUgYWxyZWFkeSBhZGRlZCBmb3IgdlBDSSBhbmQg
YWxsb3cgaW9yZXEKdG8gZGVjb2RlIGFjY2Vzc2VzIHRvIE1NQ0ZHIHJlZ2lvbnMgcmVnaXN0ZXJl
ZCBmb3IgYSBkb21haW4uIFRoaXMKaW5mcmFzdHJ1Y3R1cmUgaXMgc3RpbGwgb25seSBhY2Nlc3Np
YmxlIGZyb20gaW50ZXJuYWwgY2FsbGVycywgc28KTU1DRkcgcmVnaW9ucyBjYW4gb25seSBiZSBy
ZWdpc3RlcmVkIGZyb20gdGhlIGludGVybmFsIGRvbWFpbiBidWlsZGVyCnVzZWQgYnkgUFZIIGRv
bTAuCgpOb3RlIHRoYXQgdGhlIHZQQ0kgaW5mcmFzdHJ1Y3R1cmUgdG8gZGVjb2RlIGFuZCBoYW5k
bGUgYWNjZXNzZXMgdG8KTU1DRkcgcmVnaW9ucyB3aWxsIGJlIHJlbW92ZWQgaW4gZm9sbG93aW5n
IHBhdGNoZXMgd2hlbiB2UENJIGlzCnN3aXRjaGVkIHRvIGJlY29tZSBhbiBpbnRlcm5hbCBpb3Jl
cSBzZXJ2ZXIuCgpTaWduZWQtb2ZmLWJ5OiBSb2dlciBQYXUgTW9ubsOpIDxyb2dlci5wYXVAY2l0
cml4LmNvbT4KLS0tCkNoYW5nZXMgc2luY2UgdjI6CiAtIERvbid0IHByZXZlbnQgbWFwcGluZyBN
Q0ZHIHJhbmdlcyBieSBpb3JlcSBzZXJ2ZXJzLgoKQ2hhbmdlcyBzaW5jZSB2MToKIC0gUmVtb3Zl
IHByb3RvdHlwZSBmb3IgZGVzdHJveV92cGNpX21tY2ZnLgogLSBLZWVwIHRoZSBjb2RlIGluIGlv
LmMgc28gUENJIGFjY2Vzc2VzIHRvIE1NQ0ZHIHJlZ2lvbnMgY2FuIGJlCiAgIGRlY29kZWQgYmVm
b3JlIGlvcmVxIHByb2Nlc3NpbmcuCi0tLQogeGVuL2FyY2gveDg2L2h2bS9kb20wX2J1aWxkLmMg
ICAgICAgfCAgOCArLS0KIHhlbi9hcmNoL3g4Ni9odm0vaHZtLmMgICAgICAgICAgICAgIHwgIDIg
Ky0KIHhlbi9hcmNoL3g4Ni9odm0vaW8uYyAgICAgICAgICAgICAgIHwgNzkgKysrKysrKysrKysr
LS0tLS0tLS0tLS0tLS0tLS0KIHhlbi9hcmNoL3g4Ni9odm0vaW9yZXEuYyAgICAgICAgICAgIHwg
MTggKysrKystLQogeGVuL2FyY2gveDg2L3BoeXNkZXYuYyAgICAgICAgICAgICAgfCAgNSArLQog
eGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gveDg2L2lvbW11LmMgfCAgMiArLQogeGVuL2luY2x1ZGUv
YXNtLXg4Ni9odm0vaW8uaCAgICAgICAgfCAyOSArKysrKysrKy0tLQogNyBmaWxlcyBjaGFuZ2Vk
LCA3NSBpbnNlcnRpb25zKCspLCA2OCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS94ZW4vYXJj
aC94ODYvaHZtL2RvbTBfYnVpbGQuYyBiL3hlbi9hcmNoL3g4Ni9odm0vZG9tMF9idWlsZC5jCmlu
ZGV4IDgzMTMyNTE1MGIuLmIzMDA0MmQ4ZjMgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9odm0v
ZG9tMF9idWlsZC5jCisrKyBiL3hlbi9hcmNoL3g4Ni9odm0vZG9tMF9idWlsZC5jCkBAIC0xMTA4
LDEwICsxMTA4LDEwIEBAIHN0YXRpYyB2b2lkIF9faHdkb21faW5pdCBwdmhfc2V0dXBfbW1jZmco
c3RydWN0IGRvbWFpbiAqZCkKIAogICAgIGZvciAoIGkgPSAwOyBpIDwgcGNpX21tY2ZnX2NvbmZp
Z19udW07IGkrKyApCiAgICAgewotICAgICAgICByYyA9IHJlZ2lzdGVyX3ZwY2lfbW1jZmdfaGFu
ZGxlcihkLCBwY2lfbW1jZmdfY29uZmlnW2ldLmFkZHJlc3MsCi0gICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHBjaV9tbWNmZ19jb25maWdbaV0uc3RhcnRfYnVzX251bWJl
ciwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGNpX21tY2ZnX2Nv
bmZpZ1tpXS5lbmRfYnVzX251bWJlciwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgcGNpX21tY2ZnX2NvbmZpZ1tpXS5wY2lfc2VnbWVudCk7CisgICAgICAgIHJjID0g
aHZtX3JlZ2lzdGVyX21tY2ZnKGQsIHBjaV9tbWNmZ19jb25maWdbaV0uYWRkcmVzcywKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgcGNpX21tY2ZnX2NvbmZpZ1tpXS5zdGFydF9idXNf
bnVtYmVyLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwY2lfbW1jZmdfY29uZmln
W2ldLmVuZF9idXNfbnVtYmVyLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwY2lf
bW1jZmdfY29uZmlnW2ldLnBjaV9zZWdtZW50KTsKICAgICAgICAgaWYgKCByYyApCiAgICAgICAg
ICAgICBwcmludGsoIlVuYWJsZSB0byBzZXR1cCBNTUNGRyBoYW5kbGVyIGF0ICUjbHggZm9yIHNl
Z21lbnQgJXVcbiIsCiAgICAgICAgICAgICAgICAgICAgcGNpX21tY2ZnX2NvbmZpZ1tpXS5hZGRy
ZXNzLApkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L2h2bS9odm0uYyBiL3hlbi9hcmNoL3g4Ni9o
dm0vaHZtLmMKaW5kZXggYzIyY2IzOWNmMy4uNTM0ODE4NmMwYyAxMDA2NDQKLS0tIGEveGVuL2Fy
Y2gveDg2L2h2bS9odm0uYworKysgYi94ZW4vYXJjaC94ODYvaHZtL2h2bS5jCkBAIC03NTMsNyAr
NzUzLDcgQEAgdm9pZCBodm1fZG9tYWluX2Rlc3Ryb3koc3RydWN0IGRvbWFpbiAqZCkKICAgICAg
ICAgeGZyZWUoaW9wb3J0KTsKICAgICB9CiAKLSAgICBkZXN0cm95X3ZwY2lfbW1jZmcoZCk7Cisg
ICAgaHZtX2ZyZWVfbW1jZmcoZCk7CiB9CiAKIHN0YXRpYyBpbnQgaHZtX3NhdmVfdHNjX2FkanVz
dChzdHJ1Y3QgdmNwdSAqdiwgaHZtX2RvbWFpbl9jb250ZXh0X3QgKmgpCmRpZmYgLS1naXQgYS94
ZW4vYXJjaC94ODYvaHZtL2lvLmMgYi94ZW4vYXJjaC94ODYvaHZtL2lvLmMKaW5kZXggYTViMGEy
M2YwNi4uMzMzNDg4ODEzNiAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L2h2bS9pby5jCisrKyBi
L3hlbi9hcmNoL3g4Ni9odm0vaW8uYwpAQCAtMjc5LDYgKzI3OSwxOCBAQCB1bnNpZ25lZCBpbnQg
aHZtX3BjaV9kZWNvZGVfYWRkcih1bnNpZ25lZCBpbnQgY2Y4LCB1bnNpZ25lZCBpbnQgYWRkciwK
ICAgICByZXR1cm4gQ0Y4X0FERFJfTE8oY2Y4KSB8IChhZGRyICYgMyk7CiB9CiAKK3Vuc2lnbmVk
IGludCBodm1fbW1jZmdfZGVjb2RlX2FkZHIoY29uc3Qgc3RydWN0IGh2bV9tbWNmZyAqbW1jZmcs
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZGRyX3QgYWRkciwgcGNpX3Ni
ZGZfdCAqc2JkZikKK3sKKyAgICBhZGRyIC09IG1tY2ZnLT5hZGRyOworICAgIHNiZGYtPmJkZiA9
IE1NQ0ZHX0JERihhZGRyKTsKKyAgICBzYmRmLT5idXMgKz0gbW1jZmctPnN0YXJ0X2J1czsKKyAg
ICBzYmRmLT5zZWcgPSBtbWNmZy0+c2VnbWVudDsKKworICAgIHJldHVybiBhZGRyICYgKFBDSV9D
RkdfU1BBQ0VfRVhQX1NJWkUgLSAxKTsKK30KKworCiAvKiBEbyBzb21lIHNhbml0eSBjaGVja3Mu
ICovCiBzdGF0aWMgYm9vbCB2cGNpX2FjY2Vzc19hbGxvd2VkKHVuc2lnbmVkIGludCByZWcsIHVu
c2lnbmVkIGludCBsZW4pCiB7CkBAIC0zODMsNTAgKzM5NSwxNCBAQCB2b2lkIHJlZ2lzdGVyX3Zw
Y2lfcG9ydGlvX2hhbmRsZXIoc3RydWN0IGRvbWFpbiAqZCkKICAgICBoYW5kbGVyLT5vcHMgPSAm
dnBjaV9wb3J0aW9fb3BzOwogfQogCi1zdHJ1Y3QgaHZtX21tY2ZnIHsKLSAgICBzdHJ1Y3QgbGlz
dF9oZWFkIG5leHQ7Ci0gICAgcGFkZHJfdCBhZGRyOwotICAgIHVuc2lnbmVkIGludCBzaXplOwot
ICAgIHVpbnQxNl90IHNlZ21lbnQ7Ci0gICAgdWludDhfdCBzdGFydF9idXM7Ci19OwotCiAvKiBI
YW5kbGVycyB0byB0cmFwIFBDSSBNTUNGRyBjb25maWcgYWNjZXNzZXMuICovCi1zdGF0aWMgY29u
c3Qgc3RydWN0IGh2bV9tbWNmZyAqdnBjaV9tbWNmZ19maW5kKGNvbnN0IHN0cnVjdCBkb21haW4g
KmQsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZGRy
X3QgYWRkcikKLXsKLSAgICBjb25zdCBzdHJ1Y3QgaHZtX21tY2ZnICptbWNmZzsKLQotICAgIGxp
c3RfZm9yX2VhY2hfZW50cnkgKCBtbWNmZywgJmQtPmFyY2guaHZtLm1tY2ZnX3JlZ2lvbnMsIG5l
eHQgKQotICAgICAgICBpZiAoIGFkZHIgPj0gbW1jZmctPmFkZHIgJiYgYWRkciA8IG1tY2ZnLT5h
ZGRyICsgbW1jZmctPnNpemUgKQotICAgICAgICAgICAgcmV0dXJuIG1tY2ZnOwotCi0gICAgcmV0
dXJuIE5VTEw7Ci19Ci0KLWJvb2wgdnBjaV9pc19tbWNmZ19hZGRyZXNzKGNvbnN0IHN0cnVjdCBk
b21haW4gKmQsIHBhZGRyX3QgYWRkcikKLXsKLSAgICByZXR1cm4gdnBjaV9tbWNmZ19maW5kKGQs
IGFkZHIpOwotfQotCi1zdGF0aWMgdW5zaWduZWQgaW50IHZwY2lfbW1jZmdfZGVjb2RlX2FkZHIo
Y29uc3Qgc3RydWN0IGh2bV9tbWNmZyAqbW1jZmcsCi0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgcGFkZHJfdCBhZGRyLCBwY2lfc2JkZl90ICpzYmRmKQotewotICAg
IGFkZHIgLT0gbW1jZmctPmFkZHI7Ci0gICAgc2JkZi0+YmRmID0gTU1DRkdfQkRGKGFkZHIpOwot
ICAgIHNiZGYtPmJ1cyArPSBtbWNmZy0+c3RhcnRfYnVzOwotICAgIHNiZGYtPnNlZyA9IG1tY2Zn
LT5zZWdtZW50OwotCi0gICAgcmV0dXJuIGFkZHIgJiAoUENJX0NGR19TUEFDRV9FWFBfU0laRSAt
IDEpOwotfQotCiBzdGF0aWMgaW50IHZwY2lfbW1jZmdfYWNjZXB0KHN0cnVjdCB2Y3B1ICp2LCB1
bnNpZ25lZCBsb25nIGFkZHIpCiB7CiAgICAgc3RydWN0IGRvbWFpbiAqZCA9IHYtPmRvbWFpbjsK
ICAgICBib29sIGZvdW5kOwogCiAgICAgcmVhZF9sb2NrKCZkLT5hcmNoLmh2bS5tbWNmZ19sb2Nr
KTsKLSAgICBmb3VuZCA9IHZwY2lfbW1jZmdfZmluZChkLCBhZGRyKTsKKyAgICBmb3VuZCA9IGh2
bV9pc19tbWNmZ19hZGRyZXNzKGQsIGFkZHIpOwogICAgIHJlYWRfdW5sb2NrKCZkLT5hcmNoLmh2
bS5tbWNmZ19sb2NrKTsKIAogICAgIHJldHVybiBmb3VuZDsKQEAgLTQ0MywxNCArNDE5LDE0IEBA
IHN0YXRpYyBpbnQgdnBjaV9tbWNmZ19yZWFkKHN0cnVjdCB2Y3B1ICp2LCB1bnNpZ25lZCBsb25n
IGFkZHIsCiAgICAgKmRhdGEgPSB+MHVsOwogCiAgICAgcmVhZF9sb2NrKCZkLT5hcmNoLmh2bS5t
bWNmZ19sb2NrKTsKLSAgICBtbWNmZyA9IHZwY2lfbW1jZmdfZmluZChkLCBhZGRyKTsKKyAgICBt
bWNmZyA9IGh2bV9tbWNmZ19maW5kKGQsIGFkZHIpOwogICAgIGlmICggIW1tY2ZnICkKICAgICB7
CiAgICAgICAgIHJlYWRfdW5sb2NrKCZkLT5hcmNoLmh2bS5tbWNmZ19sb2NrKTsKICAgICAgICAg
cmV0dXJuIFg4NkVNVUxfUkVUUlk7CiAgICAgfQogCi0gICAgcmVnID0gdnBjaV9tbWNmZ19kZWNv
ZGVfYWRkcihtbWNmZywgYWRkciwgJnNiZGYpOworICAgIHJlZyA9IGh2bV9tbWNmZ19kZWNvZGVf
YWRkcihtbWNmZywgYWRkciwgJnNiZGYpOwogICAgIHJlYWRfdW5sb2NrKCZkLT5hcmNoLmh2bS5t
bWNmZ19sb2NrKTsKIAogICAgIGlmICggIXZwY2lfYWNjZXNzX2FsbG93ZWQocmVnLCBsZW4pIHx8
CkBAIC00ODUsMTQgKzQ2MSwxNCBAQCBzdGF0aWMgaW50IHZwY2lfbW1jZmdfd3JpdGUoc3RydWN0
IHZjcHUgKnYsIHVuc2lnbmVkIGxvbmcgYWRkciwKICAgICBwY2lfc2JkZl90IHNiZGY7CiAKICAg
ICByZWFkX2xvY2soJmQtPmFyY2guaHZtLm1tY2ZnX2xvY2spOwotICAgIG1tY2ZnID0gdnBjaV9t
bWNmZ19maW5kKGQsIGFkZHIpOworICAgIG1tY2ZnID0gaHZtX21tY2ZnX2ZpbmQoZCwgYWRkcik7
CiAgICAgaWYgKCAhbW1jZmcgKQogICAgIHsKICAgICAgICAgcmVhZF91bmxvY2soJmQtPmFyY2gu
aHZtLm1tY2ZnX2xvY2spOwogICAgICAgICByZXR1cm4gWDg2RU1VTF9SRVRSWTsKICAgICB9CiAK
LSAgICByZWcgPSB2cGNpX21tY2ZnX2RlY29kZV9hZGRyKG1tY2ZnLCBhZGRyLCAmc2JkZik7Cisg
ICAgcmVnID0gaHZtX21tY2ZnX2RlY29kZV9hZGRyKG1tY2ZnLCBhZGRyLCAmc2JkZik7CiAgICAg
cmVhZF91bmxvY2soJmQtPmFyY2guaHZtLm1tY2ZnX2xvY2spOwogCiAgICAgaWYgKCAhdnBjaV9h
Y2Nlc3NfYWxsb3dlZChyZWcsIGxlbikgfHwKQEAgLTUxMiw5ICs0ODgsOSBAQCBzdGF0aWMgY29u
c3Qgc3RydWN0IGh2bV9tbWlvX29wcyB2cGNpX21tY2ZnX29wcyA9IHsKICAgICAud3JpdGUgPSB2
cGNpX21tY2ZnX3dyaXRlLAogfTsKIAotaW50IHJlZ2lzdGVyX3ZwY2lfbW1jZmdfaGFuZGxlcihz
dHJ1Y3QgZG9tYWluICpkLCBwYWRkcl90IGFkZHIsCi0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHVuc2lnbmVkIGludCBzdGFydF9idXMsIHVuc2lnbmVkIGludCBlbmRfYnVzLAotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgc2VnKQoraW50IGh2bV9y
ZWdpc3Rlcl9tbWNmZyhzdHJ1Y3QgZG9tYWluICpkLCBwYWRkcl90IGFkZHIsCisgICAgICAgICAg
ICAgICAgICAgICAgIHVuc2lnbmVkIGludCBzdGFydF9idXMsIHVuc2lnbmVkIGludCBlbmRfYnVz
LAorICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgc2VnKQogewogICAgIHN0cnVj
dCBodm1fbW1jZmcgKm1tY2ZnLCAqbmV3OwogCkBAIC01NDksNyArNTI1LDcgQEAgaW50IHJlZ2lz
dGVyX3ZwY2lfbW1jZmdfaGFuZGxlcihzdHJ1Y3QgZG9tYWluICpkLCBwYWRkcl90IGFkZHIsCiAg
ICAgICAgICAgICByZXR1cm4gcmV0OwogICAgICAgICB9CiAKLSAgICBpZiAoIGxpc3RfZW1wdHko
JmQtPmFyY2guaHZtLm1tY2ZnX3JlZ2lvbnMpICkKKyAgICBpZiAoIGxpc3RfZW1wdHkoJmQtPmFy
Y2guaHZtLm1tY2ZnX3JlZ2lvbnMpICYmIGhhc192cGNpKGQpICkKICAgICAgICAgcmVnaXN0ZXJf
bW1pb19oYW5kbGVyKGQsICZ2cGNpX21tY2ZnX29wcyk7CiAKICAgICBsaXN0X2FkZCgmbmV3LT5u
ZXh0LCAmZC0+YXJjaC5odm0ubW1jZmdfcmVnaW9ucyk7CkBAIC01NTgsNyArNTM0LDcgQEAgaW50
IHJlZ2lzdGVyX3ZwY2lfbW1jZmdfaGFuZGxlcihzdHJ1Y3QgZG9tYWluICpkLCBwYWRkcl90IGFk
ZHIsCiAgICAgcmV0dXJuIDA7CiB9CiAKLXZvaWQgZGVzdHJveV92cGNpX21tY2ZnKHN0cnVjdCBk
b21haW4gKmQpCit2b2lkIGh2bV9mcmVlX21tY2ZnKHN0cnVjdCBkb21haW4gKmQpCiB7CiAgICAg
c3RydWN0IGxpc3RfaGVhZCAqbW1jZmdfcmVnaW9ucyA9ICZkLT5hcmNoLmh2bS5tbWNmZ19yZWdp
b25zOwogCkBAIC01NzQsNiArNTUwLDE3IEBAIHZvaWQgZGVzdHJveV92cGNpX21tY2ZnKHN0cnVj
dCBkb21haW4gKmQpCiAgICAgd3JpdGVfdW5sb2NrKCZkLT5hcmNoLmh2bS5tbWNmZ19sb2NrKTsK
IH0KIAorY29uc3Qgc3RydWN0IGh2bV9tbWNmZyAqaHZtX21tY2ZnX2ZpbmQoY29uc3Qgc3RydWN0
IGRvbWFpbiAqZCwgcGFkZHJfdCBhZGRyKQoreworICAgIGNvbnN0IHN0cnVjdCBodm1fbW1jZmcg
Km1tY2ZnOworCisgICAgbGlzdF9mb3JfZWFjaF9lbnRyeSAoIG1tY2ZnLCAmZC0+YXJjaC5odm0u
bW1jZmdfcmVnaW9ucywgbmV4dCApCisgICAgICAgIGlmICggYWRkciA+PSBtbWNmZy0+YWRkciAm
JiBhZGRyIDwgbW1jZmctPmFkZHIgKyBtbWNmZy0+c2l6ZSApCisgICAgICAgICAgICByZXR1cm4g
bW1jZmc7CisKKyAgICByZXR1cm4gTlVMTDsKK30KKwogLyoKICAqIExvY2FsIHZhcmlhYmxlczoK
ICAqIG1vZGU6IEMKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9odm0vaW9yZXEuYyBiL3hlbi9h
cmNoL3g4Ni9odm0vaW9yZXEuYwppbmRleCA1NzcxOWM2MDdjLi42Yjg3YTU1ZGI1IDEwMDY0NAot
LS0gYS94ZW4vYXJjaC94ODYvaHZtL2lvcmVxLmMKKysrIGIveGVuL2FyY2gveDg2L2h2bS9pb3Jl
cS5jCkBAIC0xMzI2LDI3ICsxMzI2LDM0IEBAIGlvc2VydmlkX3QgaHZtX3NlbGVjdF9pb3JlcV9z
ZXJ2ZXIoc3RydWN0IGRvbWFpbiAqZCwgaW9yZXFfdCAqcCkKICAgICB1aW50OF90IHR5cGU7CiAg
ICAgdWludDY0X3QgYWRkcjsKICAgICB1bnNpZ25lZCBpbnQgaWQ7CisgICAgY29uc3Qgc3RydWN0
IGh2bV9tbWNmZyAqbW1jZmc7CiAKICAgICBpZiAoIHAtPnR5cGUgIT0gSU9SRVFfVFlQRV9DT1BZ
ICYmIHAtPnR5cGUgIT0gSU9SRVFfVFlQRV9QSU8gKQogICAgICAgICByZXR1cm4gWEVOX0lOVkFM
SURfSU9TRVJWSUQ7CiAKICAgICBjZjggPSBkLT5hcmNoLmh2bS5wY2lfY2Y4OwogCi0gICAgaWYg
KCBwLT50eXBlID09IElPUkVRX1RZUEVfUElPICYmCi0gICAgICAgICAocC0+YWRkciAmIH4zKSA9
PSAweGNmYyAmJgotICAgICAgICAgQ0Y4X0VOQUJMRUQoY2Y4KSApCisgICAgcmVhZF9sb2NrKCZk
LT5hcmNoLmh2bS5tbWNmZ19sb2NrKTsKKyAgICBpZiAoIChwLT50eXBlID09IElPUkVRX1RZUEVf
UElPICYmCisgICAgICAgICAgKHAtPmFkZHIgJiB+MykgPT0gMHhjZmMgJiYKKyAgICAgICAgICBD
RjhfRU5BQkxFRChjZjgpKSB8fAorICAgICAgICAgKHAtPnR5cGUgPT0gSU9SRVFfVFlQRV9DT1BZ
ICYmCisgICAgICAgICAgKG1tY2ZnID0gaHZtX21tY2ZnX2ZpbmQoZCwgcC0+YWRkcikpICE9IE5V
TEwpICkKICAgICB7CiAgICAgICAgIHVpbnQzMl90IHg4Nl9mYW07CiAgICAgICAgIHBjaV9zYmRm
X3Qgc2JkZjsKICAgICAgICAgdW5zaWduZWQgaW50IHJlZzsKIAotICAgICAgICByZWcgPSBodm1f
cGNpX2RlY29kZV9hZGRyKGNmOCwgcC0+YWRkciwgJnNiZGYpOworICAgICAgICByZWcgPSBwLT50
eXBlID09IElPUkVRX1RZUEVfUElPID8gaHZtX3BjaV9kZWNvZGVfYWRkcihjZjgsIHAtPmFkZHIs
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICZzYmRmKQorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDog
aHZtX21tY2ZnX2RlY29kZV9hZGRyKG1tY2ZnLCBwLT5hZGRyLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZzYmRmKTsKIAog
ICAgICAgICAvKiBQQ0kgY29uZmlnIGRhdGEgY3ljbGUgKi8KICAgICAgICAgdHlwZSA9IFhFTl9E
TU9QX0lPX1JBTkdFX1BDSTsKICAgICAgICAgYWRkciA9ICgodWludDY0X3Qpc2JkZi5zYmRmIDw8
IDMyKSB8IHJlZzsKICAgICAgICAgLyogQU1EIGV4dGVuZGVkIGNvbmZpZ3VyYXRpb24gc3BhY2Ug
YWNjZXNzPyAqLwotICAgICAgICBpZiAoIENGOF9BRERSX0hJKGNmOCkgJiYKKyAgICAgICAgaWYg
KCBwLT50eXBlID09IElPUkVRX1RZUEVfUElPICYmIENGOF9BRERSX0hJKGNmOCkgJiYKICAgICAg
ICAgICAgICBkLT5hcmNoLmNwdWlkLT54ODZfdmVuZG9yID09IFg4Nl9WRU5ET1JfQU1EICYmCiAg
ICAgICAgICAgICAgKHg4Nl9mYW0gPSBnZXRfY3B1X2ZhbWlseSgKICAgICAgICAgICAgICAgICAg
ZC0+YXJjaC5jcHVpZC0+YmFzaWMucmF3X2ZtcywgTlVMTCwgTlVMTCkpID4gMHgxMCAmJgpAQCAt
MTM2NSw2ICsxMzcyLDcgQEAgaW9zZXJ2aWRfdCBodm1fc2VsZWN0X2lvcmVxX3NlcnZlcihzdHJ1
Y3QgZG9tYWluICpkLCBpb3JlcV90ICpwKQogICAgICAgICAgICAgICAgIFhFTl9ETU9QX0lPX1JB
TkdFX1BPUlQgOiBYRU5fRE1PUF9JT19SQU5HRV9NRU1PUlk7CiAgICAgICAgIGFkZHIgPSBwLT5h
ZGRyOwogICAgIH0KKyAgICByZWFkX3VubG9jaygmZC0+YXJjaC5odm0ubW1jZmdfbG9jayk7CiAK
ICAgICBGT1JfRUFDSF9JT1JFUV9TRVJWRVIoZCwgaWQsIHMpCiAgICAgewpkaWZmIC0tZ2l0IGEv
eGVuL2FyY2gveDg2L3BoeXNkZXYuYyBiL3hlbi9hcmNoL3g4Ni9waHlzZGV2LmMKaW5kZXggM2Ez
YzE1ODkwYi4uZjYxZjY2ZGY1ZiAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L3BoeXNkZXYuYwor
KysgYi94ZW4vYXJjaC94ODYvcGh5c2Rldi5jCkBAIC01NjIsOSArNTYyLDggQEAgcmV0X3QgZG9f
cGh5c2Rldl9vcChpbnQgY21kLCBYRU5fR1VFU1RfSEFORExFX1BBUkFNKHZvaWQpIGFyZykKICAg
ICAgICAgICAgICAqIEZvciBIVk0gKFBWSCkgZG9tYWlucyB0cnkgdG8gYWRkIHRoZSBuZXdseSBm
b3VuZCBNTUNGRyB0byB0aGUKICAgICAgICAgICAgICAqIGRvbWFpbi4KICAgICAgICAgICAgICAq
LwotICAgICAgICAgICAgcmV0ID0gcmVnaXN0ZXJfdnBjaV9tbWNmZ19oYW5kbGVyKGN1cnJkLCBp
bmZvLmFkZHJlc3MsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgaW5mby5zdGFydF9idXMsIGluZm8uZW5kX2J1cywKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBpbmZvLnNlZ21lbnQpOworICAgICAgICAgICAgcmV0ID0g
aHZtX3JlZ2lzdGVyX21tY2ZnKGN1cnJkLCBpbmZvLmFkZHJlc3MsIGluZm8uc3RhcnRfYnVzLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm8uZW5kX2J1cywgaW5mby5z
ZWdtZW50KTsKICAgICAgICAgfQogCiAgICAgICAgIGJyZWFrOwpkaWZmIC0tZ2l0IGEveGVuL2Ry
aXZlcnMvcGFzc3Rocm91Z2gveDg2L2lvbW11LmMgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC94
ODYvaW9tbXUuYwppbmRleCA1OTkwNTYyOWUxLi41M2NkYmI0NWYwIDEwMDY0NAotLS0gYS94ZW4v
ZHJpdmVycy9wYXNzdGhyb3VnaC94ODYvaW9tbXUuYworKysgYi94ZW4vZHJpdmVycy9wYXNzdGhy
b3VnaC94ODYvaW9tbXUuYwpAQCAtMTUyLDcgKzE1Miw3IEBAIHN0YXRpYyBib29sIF9faHdkb21f
aW5pdCBod2RvbV9pb21tdV9tYXAoY29uc3Qgc3RydWN0IGRvbWFpbiAqZCwKICAgICAgKiBUT0RP
OiBydW50aW1lIGFkZGVkIE1NQ0ZHIHJlZ2lvbnMgYXJlIG5vdCBjaGVja2VkIHRvIG1ha2Ugc3Vy
ZSB0aGV5CiAgICAgICogZG9uJ3Qgb3ZlcmxhcCB3aXRoIGFscmVhZHkgbWFwcGVkIHJlZ2lvbnMs
IHRodXMgcHJldmVudGluZyB0cmFwcGluZy4KICAgICAgKi8KLSAgICBpZiAoIGhhc192cGNpKGQp
ICYmIHZwY2lfaXNfbW1jZmdfYWRkcmVzcyhkLCBwZm5fdG9fcGFkZHIocGZuKSkgKQorICAgIGlm
ICggaGFzX3ZwY2koZCkgJiYgaHZtX2lzX21tY2ZnX2FkZHJlc3MoZCwgcGZuX3RvX3BhZGRyKHBm
bikpICkKICAgICAgICAgcmV0dXJuIGZhbHNlOwogCiAgICAgcmV0dXJuIHRydWU7CmRpZmYgLS1n
aXQgYS94ZW4vaW5jbHVkZS9hc20teDg2L2h2bS9pby5oIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9o
dm0vaW8uaAppbmRleCA3Y2ViMTE5YjY0Li44NmViYmQxZTdlIDEwMDY0NAotLS0gYS94ZW4vaW5j
bHVkZS9hc20teDg2L2h2bS9pby5oCisrKyBiL3hlbi9pbmNsdWRlL2FzbS14ODYvaHZtL2lvLmgK
QEAgLTE2NSw5ICsxNjUsMTkgQEAgdm9pZCBzdGR2Z2FfZGVpbml0KHN0cnVjdCBkb21haW4gKmQp
OwogCiBleHRlcm4gdm9pZCBodm1fZHBjaV9tc2lfZW9pKHN0cnVjdCBkb21haW4gKmQsIGludCB2
ZWN0b3IpOwogCi0vKiBEZWNvZGUgYSBQQ0kgcG9ydCBJTyBhY2Nlc3MgaW50byBhIGJ1cy9zbG90
L2Z1bmMvcmVnLiAqLworc3RydWN0IGh2bV9tbWNmZyB7CisgICAgc3RydWN0IGxpc3RfaGVhZCBu
ZXh0OworICAgIHBhZGRyX3QgYWRkcjsKKyAgICB1bnNpZ25lZCBpbnQgc2l6ZTsKKyAgICB1aW50
MTZfdCBzZWdtZW50OworICAgIHVpbnQ4X3Qgc3RhcnRfYnVzOworfTsKKworLyogRGVjb2RlIGEg
UENJIHBvcnQgSU8gb3IgTU1DRkcgYWNjZXNzIGludG8gYSBidXMvc2xvdC9mdW5jL3JlZy4gKi8K
IHVuc2lnbmVkIGludCBodm1fcGNpX2RlY29kZV9hZGRyKHVuc2lnbmVkIGludCBjZjgsIHVuc2ln
bmVkIGludCBhZGRyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGNpX3NiZGZf
dCAqc2JkZik7Cit1bnNpZ25lZCBpbnQgaHZtX21tY2ZnX2RlY29kZV9hZGRyKGNvbnN0IHN0cnVj
dCBodm1fbW1jZmcgKm1tY2ZnLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBw
YWRkcl90IGFkZHIsIHBjaV9zYmRmX3QgKnNiZGYpOwogCiAvKgogICogSFZNIHBvcnQgSU8gaGFu
ZGxlciB0aGF0IHBlcmZvcm1zIGZvcndhcmRpbmcgb2YgZ3Vlc3QgSU8gcG9ydHMgaW50byBtYWNo
aW5lCkBAIC0xNzgsMTUgKzE4OCwxOCBAQCB2b2lkIHJlZ2lzdGVyX2cybV9wb3J0aW9faGFuZGxl
cihzdHJ1Y3QgZG9tYWluICpkKTsKIC8qIEhWTSBwb3J0IElPIGhhbmRsZXIgZm9yIHZQQ0kgYWNj
ZXNzZXMuICovCiB2b2lkIHJlZ2lzdGVyX3ZwY2lfcG9ydGlvX2hhbmRsZXIoc3RydWN0IGRvbWFp
biAqZCk7CiAKLS8qIEhWTSBNTUlPIGhhbmRsZXIgZm9yIFBDSSBNTUNGRyBhY2Nlc3Nlcy4gKi8K
LWludCByZWdpc3Rlcl92cGNpX21tY2ZnX2hhbmRsZXIoc3RydWN0IGRvbWFpbiAqZCwgcGFkZHJf
dCBhZGRyLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgc3Rh
cnRfYnVzLCB1bnNpZ25lZCBpbnQgZW5kX2J1cywKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgdW5zaWduZWQgaW50IHNlZyk7Ci0vKiBEZXN0cm95IHRyYWNrZWQgTU1DRkcgYXJlYXMu
ICovCi12b2lkIGRlc3Ryb3lfdnBjaV9tbWNmZyhzdHJ1Y3QgZG9tYWluICpkKTsKKy8qIEhWTSBQ
Q0kgTU1DRkcgcmVnaW9ucyByZWdpc3RyYXRpb24uICovCitpbnQgaHZtX3JlZ2lzdGVyX21tY2Zn
KHN0cnVjdCBkb21haW4gKmQsIHBhZGRyX3QgYWRkciwKKyAgICAgICAgICAgICAgICAgICAgICAg
dW5zaWduZWQgaW50IHN0YXJ0X2J1cywgdW5zaWduZWQgaW50IGVuZF9idXMsCisgICAgICAgICAg
ICAgICAgICAgICAgIHVuc2lnbmVkIGludCBzZWcpOwordm9pZCBodm1fZnJlZV9tbWNmZyhzdHJ1
Y3QgZG9tYWluICpkKTsKK2NvbnN0IHN0cnVjdCBodm1fbW1jZmcgKmh2bV9tbWNmZ19maW5kKGNv
bnN0IHN0cnVjdCBkb21haW4gKmQsIHBhZGRyX3QgYWRkcik7CiAKIC8qIENoZWNrIGlmIGFuIGFk
ZHJlc3MgaXMgYmV0d2VlbiBhIE1NQ0ZHIHJlZ2lvbiBmb3IgYSBkb21haW4uICovCi1ib29sIHZw
Y2lfaXNfbW1jZmdfYWRkcmVzcyhjb25zdCBzdHJ1Y3QgZG9tYWluICpkLCBwYWRkcl90IGFkZHIp
Oworc3RhdGljIGlubGluZSBib29sIGh2bV9pc19tbWNmZ19hZGRyZXNzKGNvbnN0IHN0cnVjdCBk
b21haW4gKmQsIHBhZGRyX3QgYWRkcikKK3sKKyAgICByZXR1cm4gaHZtX21tY2ZnX2ZpbmQoZCwg
YWRkcik7Cit9CiAKICNlbmRpZiAvKiBfX0FTTV9YODZfSFZNX0lPX0hfXyAqLwogCi0tIAoyLjIz
LjAKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4t
ZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczov
L2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

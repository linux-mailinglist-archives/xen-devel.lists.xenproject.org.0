Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 75BF314ECD8
	for <lists+xen-devel@lfdr.de>; Fri, 31 Jan 2020 14:04:13 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1ixVve-0001OF-HI; Fri, 31 Jan 2020 13:01:46 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=EwZr=3U=virtuozzo.com=vsementsov@srs-us1.protection.inumbo.net>)
 id 1ixVvc-0001O5-T4
 for xen-devel@lists.xenproject.org; Fri, 31 Jan 2020 13:01:44 +0000
X-Inumbo-ID: d2bb63b4-4429-11ea-b211-bc764e2007e4
Received: from relay.sw.ru (unknown [185.231.240.75])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id d2bb63b4-4429-11ea-b211-bc764e2007e4;
 Fri, 31 Jan 2020 13:01:41 +0000 (UTC)
Received: from vovaso.qa.sw.ru ([10.94.3.0] helo=kvm.qa.sw.ru)
 by relay.sw.ru with esmtp (Exim 4.92.3)
 (envelope-from <vsementsov@virtuozzo.com>)
 id 1ixVvK-0000zU-3v; Fri, 31 Jan 2020 16:01:26 +0300
From: Vladimir Sementsov-Ogievskiy <vsementsov@virtuozzo.com>
To: qemu-devel@nongnu.org
Date: Fri, 31 Jan 2020 16:01:18 +0300
Message-Id: <20200131130118.1716-12-vsementsov@virtuozzo.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20200131130118.1716-1-vsementsov@virtuozzo.com>
References: <20200131130118.1716-1-vsementsov@virtuozzo.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v7 11/11] xen: introduce ERRP_AUTO_PROPAGATE
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Kevin Wolf <kwolf@redhat.com>,
 Vladimir Sementsov-Ogievskiy <vsementsov@virtuozzo.com>, qemu-block@nongnu.org,
 Paul Durrant <paul@xen.org>, armbru@redhat.com, Greg Kurz <groug@kaod.org>,
 Stefano Stabellini <sstabellini@kernel.org>,
 Stefan Hajnoczi <stefanha@redhat.com>,
 Anthony Perard <anthony.perard@citrix.com>, xen-devel@lists.xenproject.org,
 Max Reitz <mreitz@redhat.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SWYgd2Ugd2FudCB0byBhZGQgc29tZSBpbmZvIHRvIGVycnAgKGJ5IGVycm9yX3ByZXBlbmQoKSBv
cgplcnJvcl9hcHBlbmRfaGludCgpKSwgd2UgbXVzdCB1c2UgdGhlIEVSUlBfQVVUT19QUk9QQUdB
VEUgbWFjcm8uCk90aGVyd2lzZSwgdGhpcyBpbmZvIHdpbGwgbm90IGJlIGFkZGVkIHdoZW4gZXJy
cCA9PSAmZXJyb3JfZmF0YWwKKHRoZSBwcm9ncmFtIHdpbGwgZXhpdCBwcmlvciB0byB0aGUgZXJy
b3JfYXBwZW5kX2hpbnQoKSBvcgplcnJvcl9wcmVwZW5kKCkgY2FsbCkuICBGaXggc3VjaCBjYXNl
cy4KCklmIHdlIHdhbnQgdG8gY2hlY2sgZXJyb3IgYWZ0ZXIgZXJycC1mdW5jdGlvbiBjYWxsLCB3
ZSBuZWVkIHRvCmludHJvZHVjZSBsb2NhbF9lcnIgYW5kIHRoZW4gcHJvcGFnYXRlIGl0IHRvIGVy
cnAuIEluc3RlYWQsIHVzZQpFUlJQX0FVVE9fUFJPUEFHQVRFIG1hY3JvLCBiZW5lZml0cyBhcmU6
CjEuIE5vIG5lZWQgb2YgZXhwbGljaXQgZXJyb3JfcHJvcGFnYXRlIGNhbGwKMi4gTm8gbmVlZCBv
ZiBleHBsaWNpdCBsb2NhbF9lcnIgdmFyaWFibGU6IHVzZSBlcnJwIGRpcmVjdGx5CjMuIEVSUlBf
QVVUT19QUk9QQUdBVEUgbGVhdmVzIGVycnAgYXMgaXMgaWYgaXQncyBub3QgTlVMTCBvcgogICAm
ZXJyb3JfZmF0YWwsIHRoaXMgbWVhbnMgdGhhdCB3ZSBkb24ndCBicmVhayBlcnJvcl9hYm9ydAog
ICAod2UnbGwgYWJvcnQgb24gZXJyb3Jfc2V0LCBub3Qgb24gZXJyb3JfcHJvcGFnYXRlKQoKVGhp
cyBjb21taXQgaXMgZ2VuZXJhdGVkIGJ5IGNvbW1hbmQKCiAgICBzZWQgLW4gJy9eWDg2IFhlbiBD
UFVzJC8sL14kL3tzL15GOiAvL3B9JyBNQUlOVEFJTkVSUyB8IFwKICAgIHhhcmdzIGdpdCBscy1m
aWxlcyB8IGdyZXAgJ1wuW2hjXSQnIHwgXAogICAgeGFyZ3Mgc3BhdGNoIFwKICAgICAgICAtLXNw
LWZpbGUgc2NyaXB0cy9jb2NjaW5lbGxlL2F1dG8tcHJvcGFnYXRlZC1lcnJwLmNvY2NpIFwKICAg
ICAgICAtLW1hY3JvLWZpbGUgc2NyaXB0cy9jb2NjaS1tYWNyby1maWxlLmggXAogICAgICAgIC0t
aW4tcGxhY2UgLS1uby1zaG93LWRpZmYgLS1tYXgtd2lkdGggODAKClJlcG9ydGVkLWJ5OiBLZXZp
biBXb2xmIDxrd29sZkByZWRoYXQuY29tPgpSZXBvcnRlZC1ieTogR3JlZyBLdXJ6IDxncm91Z0Br
YW9kLm9yZz4KU2lnbmVkLW9mZi1ieTogVmxhZGltaXIgU2VtZW50c292LU9naWV2c2tpeSA8dnNl
bWVudHNvdkB2aXJ0dW96em8uY29tPgpBY2tlZC1ieTogUGF1bCBEdXJyYW50IDxwYXVsQHhlbi5v
cmc+Ci0tLQogaHcvYmxvY2svZGF0YXBsYW5lL3hlbi1ibG9jay5jIHwgIDE3ICsrLS0tCiBody9i
bG9jay94ZW4tYmxvY2suYyAgICAgICAgICAgfCAxMjUgKysrKysrKysrKysrKystLS0tLS0tLS0t
LS0tLS0tLS0tCiBody9wY2ktaG9zdC94ZW5faWdkX3B0LmMgICAgICAgfCAgIDcgKy0KIGh3L3hl
bi94ZW4tYmFja2VuZC5jICAgICAgICAgICB8ICAgNyArLQogaHcveGVuL3hlbi1idXMuYyAgICAg
ICAgICAgICAgIHwgMTAwICsrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tCiBody94ZW4veGVuLWhv
c3QtcGNpLWRldmljZS5jICAgfCAgMjcgKysrKy0tLQogaHcveGVuL3hlbl9wdC5jICAgICAgICAg
ICAgICAgIHwgIDI1ICsrKy0tLS0KIGh3L3hlbi94ZW5fcHRfY29uZmlnX2luaXQuYyAgICB8ICAy
MCArKystLS0KIDggZmlsZXMgY2hhbmdlZCwgMTQyIGluc2VydGlvbnMoKyksIDE4NiBkZWxldGlv
bnMoLSkKCmRpZmYgLS1naXQgYS9ody9ibG9jay9kYXRhcGxhbmUveGVuLWJsb2NrLmMgYi9ody9i
bG9jay9kYXRhcGxhbmUveGVuLWJsb2NrLmMKaW5kZXggM2I5Y2FlYjJmYS4uYzM4ZTNjM2Q4NSAx
MDA2NDQKLS0tIGEvaHcvYmxvY2svZGF0YXBsYW5lL3hlbi1ibG9jay5jCisrKyBiL2h3L2Jsb2Nr
L2RhdGFwbGFuZS94ZW4tYmxvY2suYwpAQCAtNzI3LDggKzcyNyw4IEBAIHZvaWQgeGVuX2Jsb2Nr
X2RhdGFwbGFuZV9zdGFydChYZW5CbG9ja0RhdGFQbGFuZSAqZGF0YXBsYW5lLAogICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCBwcm90b2NvbCwKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBFcnJvciAqKmVycnApCiB7CisgICAgRVJSUF9BVVRPX1BST1BB
R0FURSgpOwogICAgIFhlbkRldmljZSAqeGVuZGV2ID0gZGF0YXBsYW5lLT54ZW5kZXY7Ci0gICAg
RXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAgICAgdW5zaWduZWQgaW50IHJpbmdfc2l6ZTsKICAg
ICB1bnNpZ25lZCBpbnQgaTsKIApAQCAtNzY0LDkgKzc2NCw4IEBAIHZvaWQgeGVuX2Jsb2NrX2Rh
dGFwbGFuZV9zdGFydChYZW5CbG9ja0RhdGFQbGFuZSAqZGF0YXBsYW5lLAogICAgIH0KIAogICAg
IHhlbl9kZXZpY2Vfc2V0X21heF9ncmFudF9yZWZzKHhlbmRldiwgZGF0YXBsYW5lLT5ucl9yaW5n
X3JlZiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmbG9jYWxfZXJyKTsKLSAg
ICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9l
cnIpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycnApOworICAgIGlmICgq
ZXJycCkgewogICAgICAgICBnb3RvIHN0b3A7CiAgICAgfQogCkBAIC03NzQsOSArNzczLDggQEAg
dm9pZCB4ZW5fYmxvY2tfZGF0YXBsYW5lX3N0YXJ0KFhlbkJsb2NrRGF0YVBsYW5lICpkYXRhcGxh
bmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YXBs
YW5lLT5yaW5nX3JlZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBkYXRhcGxhbmUtPm5yX3JpbmdfcmVmLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIFBST1RfUkVBRCB8IFBST1RfV1JJVEUsCi0gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxv
Y2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJwKTsKKyAgICBp
ZiAoKmVycnApIHsKICAgICAgICAgZ290byBzdG9wOwogICAgIH0KIApAQCAtODA5LDkgKzgwNyw4
IEBAIHZvaWQgeGVuX2Jsb2NrX2RhdGFwbGFuZV9zdGFydChYZW5CbG9ja0RhdGFQbGFuZSAqZGF0
YXBsYW5lLAogICAgIGRhdGFwbGFuZS0+ZXZlbnRfY2hhbm5lbCA9CiAgICAgICAgIHhlbl9kZXZp
Y2VfYmluZF9ldmVudF9jaGFubmVsKHhlbmRldiwgZGF0YXBsYW5lLT5jdHgsIGV2ZW50X2NoYW5u
ZWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhlbl9ibG9ja19kYXRh
cGxhbmVfZXZlbnQsIGRhdGFwbGFuZSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9w
cm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdvdG8gc3RvcDsKICAg
ICB9CiAKZGlmZiAtLWdpdCBhL2h3L2Jsb2NrL3hlbi1ibG9jay5jIGIvaHcvYmxvY2sveGVuLWJs
b2NrLmMKaW5kZXggNjg2YmJjM2YwZC4uNzE3YTgwZDViNSAxMDA2NDQKLS0tIGEvaHcvYmxvY2sv
eGVuLWJsb2NrLmMKKysrIGIvaHcvYmxvY2sveGVuLWJsb2NrLmMKQEAgLTE5NCw2ICsxOTQsNyBA
QCBzdGF0aWMgY29uc3QgQmxvY2tEZXZPcHMgeGVuX2Jsb2NrX2Rldl9vcHMgPSB7CiAKIHN0YXRp
YyB2b2lkIHhlbl9ibG9ja19yZWFsaXplKFhlbkRldmljZSAqeGVuZGV2LCBFcnJvciAqKmVycnAp
CiB7CisgICAgRVJSUF9BVVRPX1BST1BBR0FURSgpOwogICAgIFhlbkJsb2NrRGV2aWNlICpibG9j
a2RldiA9IFhFTl9CTE9DS19ERVZJQ0UoeGVuZGV2KTsKICAgICBYZW5CbG9ja0RldmljZUNsYXNz
ICpibG9ja2Rldl9jbGFzcyA9CiAgICAgICAgIFhFTl9CTE9DS19ERVZJQ0VfR0VUX0NMQVNTKHhl
bmRldik7CkBAIC0yMDEsNyArMjAyLDYgQEAgc3RhdGljIHZvaWQgeGVuX2Jsb2NrX3JlYWxpemUo
WGVuRGV2aWNlICp4ZW5kZXYsIEVycm9yICoqZXJycCkKICAgICBYZW5CbG9ja1ZkZXYgKnZkZXYg
PSAmYmxvY2tkZXYtPnByb3BzLnZkZXY7CiAgICAgQmxvY2tDb25mICpjb25mID0gJmJsb2NrZGV2
LT5wcm9wcy5jb25mOwogICAgIEJsb2NrQmFja2VuZCAqYmxrID0gY29uZi0+YmxrOwotICAgIEVy
cm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgaWYgKHZkZXYtPnR5cGUgPT0gWEVOX0JMT0NL
X1ZERVZfVFlQRV9JTlZBTElEKSB7CiAgICAgICAgIGVycm9yX3NldGcoZXJycCwgInZkZXYgcHJv
cGVydHkgbm90IHNldCIpOwpAQCAtMjExLDkgKzIxMSw4IEBAIHN0YXRpYyB2b2lkIHhlbl9ibG9j
a19yZWFsaXplKFhlbkRldmljZSAqeGVuZGV2LCBFcnJvciAqKmVycnApCiAgICAgdHJhY2VfeGVu
X2Jsb2NrX3JlYWxpemUodHlwZSwgdmRldi0+ZGlzaywgdmRldi0+cGFydGl0aW9uKTsKIAogICAg
IGlmIChibG9ja2Rldl9jbGFzcy0+cmVhbGl6ZSkgewotICAgICAgICBibG9ja2Rldl9jbGFzcy0+
cmVhbGl6ZShibG9ja2RldiwgJmxvY2FsX2Vycik7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsK
LSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgICAgICBi
bG9ja2Rldl9jbGFzcy0+cmVhbGl6ZShibG9ja2RldiwgZXJycCk7CisgICAgICAgIGlmICgqZXJy
cCkgewogICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgfQpAQCAtMjgzLDggKzI4
Miw4IEBAIHN0YXRpYyB2b2lkIHhlbl9ibG9ja19mcm9udGVuZF9jaGFuZ2VkKFhlbkRldmljZSAq
eGVuZGV2LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW51bSB4ZW5i
dXNfc3RhdGUgZnJvbnRlbmRfc3RhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBFcnJvciAqKmVycnApCiB7CisgICAgRVJSUF9BVVRPX1BST1BBR0FURSgpOwogICAg
IGVudW0geGVuYnVzX3N0YXRlIGJhY2tlbmRfc3RhdGUgPSB4ZW5fZGV2aWNlX2JhY2tlbmRfZ2V0
X3N0YXRlKHhlbmRldik7Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICBzd2l0
Y2ggKGZyb250ZW5kX3N0YXRlKSB7CiAgICAgY2FzZSBYZW5idXNTdGF0ZUluaXRpYWxpc2VkOgpA
QCAtMjkzLDE1ICsyOTIsMTMgQEAgc3RhdGljIHZvaWQgeGVuX2Jsb2NrX2Zyb250ZW5kX2NoYW5n
ZWQoWGVuRGV2aWNlICp4ZW5kZXYsCiAgICAgICAgICAgICBicmVhazsKICAgICAgICAgfQogCi0g
ICAgICAgIHhlbl9ibG9ja19kaXNjb25uZWN0KHhlbmRldiwgJmxvY2FsX2Vycik7Ci0gICAgICAg
IGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2Nh
bF9lcnIpOworICAgICAgICB4ZW5fYmxvY2tfZGlzY29ubmVjdCh4ZW5kZXYsIGVycnApOworICAg
ICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICB9CiAKLSAgICAg
ICAgeGVuX2Jsb2NrX2Nvbm5lY3QoeGVuZGV2LCAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYgKGxv
Y2FsX2VycikgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7
CisgICAgICAgIHhlbl9ibG9ja19jb25uZWN0KHhlbmRldiwgZXJycCk7CisgICAgICAgIGlmICgq
ZXJycCkgewogICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgIH0KIApAQCAtMzE0LDkgKzMxMSw4
IEBAIHN0YXRpYyB2b2lkIHhlbl9ibG9ja19mcm9udGVuZF9jaGFuZ2VkKFhlbkRldmljZSAqeGVu
ZGV2LAogCiAgICAgY2FzZSBYZW5idXNTdGF0ZUNsb3NlZDoKICAgICBjYXNlIFhlbmJ1c1N0YXRl
VW5rbm93bjoKLSAgICAgICAgeGVuX2Jsb2NrX2Rpc2Nvbm5lY3QoeGVuZGV2LCAmbG9jYWxfZXJy
KTsKLSAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRl
KGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgIHhlbl9ibG9ja19kaXNjb25uZWN0KHhlbmRldiwg
ZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg
IH0KIApAQCAtNDAzLDEwICszOTksMTAgQEAgc3RhdGljIGludCB2YmRfbmFtZV90b19kaXNrKGNv
bnN0IGNoYXIgKm5hbWUsIGNvbnN0IGNoYXIgKiplbmRwLAogc3RhdGljIHZvaWQgeGVuX2Jsb2Nr
X3NldF92ZGV2KE9iamVjdCAqb2JqLCBWaXNpdG9yICp2LCBjb25zdCBjaGFyICpuYW1lLAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgKm9wYXF1ZSwgRXJyb3IgKiplcnJwKQog
eworICAgIEVSUlBfQVVUT19QUk9QQUdBVEUoKTsKICAgICBEZXZpY2VTdGF0ZSAqZGV2ID0gREVW
SUNFKG9iaik7CiAgICAgUHJvcGVydHkgKnByb3AgPSBvcGFxdWU7CiAgICAgWGVuQmxvY2tWZGV2
ICp2ZGV2ID0gcWRldl9nZXRfcHJvcF9wdHIoZGV2LCBwcm9wKTsKLSAgICBFcnJvciAqbG9jYWxf
ZXJyID0gTlVMTDsKICAgICBjaGFyICpzdHIsICpwOwogICAgIGNvbnN0IGNoYXIgKmVuZDsKIApA
QCAtNDE1LDkgKzQxMSw4IEBAIHN0YXRpYyB2b2lkIHhlbl9ibG9ja19zZXRfdmRldihPYmplY3Qg
Km9iaiwgVmlzaXRvciAqdiwgY29uc3QgY2hhciAqbmFtZSwKICAgICAgICAgcmV0dXJuOwogICAg
IH0KIAotICAgIHZpc2l0X3R5cGVfc3RyKHYsIG5hbWUsICZzdHIsICZsb2NhbF9lcnIpOwotICAg
IGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vy
cik7CisgICAgdmlzaXRfdHlwZV9zdHIodiwgbmFtZSwgJnN0ciwgZXJycCk7CisgICAgaWYgKCpl
cnJwKSB7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAKQEAgLTY3MSw5ICs2NjYsOSBAQCBzdGF0
aWMgdm9pZCB4ZW5fYmxvY2tfYmxvY2tkZXZfZGVsKGNvbnN0IGNoYXIgKm5vZGVfbmFtZSwgRXJy
b3IgKiplcnJwKQogc3RhdGljIGNoYXIgKnhlbl9ibG9ja19ibG9ja2Rldl9hZGQoY29uc3QgY2hh
ciAqaWQsIFFEaWN0ICpxZGljdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IEVycm9yICoqZXJycCkKIHsKKyAgICBFUlJQX0FVVE9fUFJPUEFHQVRFKCk7CiAgICAgY29uc3Qg
Y2hhciAqZHJpdmVyID0gcWRpY3RfZ2V0X3RyeV9zdHIocWRpY3QsICJkcml2ZXIiKTsKICAgICBC
bG9ja2Rldk9wdGlvbnMgKm9wdGlvbnMgPSBOVUxMOwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBO
VUxMOwogICAgIGNoYXIgKm5vZGVfbmFtZTsKICAgICBWaXNpdG9yICp2OwogCkBAIC02ODgsMTgg
KzY4MywxNiBAQCBzdGF0aWMgY2hhciAqeGVuX2Jsb2NrX2Jsb2NrZGV2X2FkZChjb25zdCBjaGFy
ICppZCwgUURpY3QgKnFkaWN0LAogICAgIHRyYWNlX3hlbl9ibG9ja19ibG9ja2Rldl9hZGQobm9k
ZV9uYW1lKTsKIAogICAgIHYgPSBxb2JqZWN0X2lucHV0X3Zpc2l0b3JfbmV3KFFPQkpFQ1QocWRp
Y3QpKTsKLSAgICB2aXNpdF90eXBlX0Jsb2NrZGV2T3B0aW9ucyh2LCBOVUxMLCAmb3B0aW9ucywg
JmxvY2FsX2Vycik7CisgICAgdmlzaXRfdHlwZV9CbG9ja2Rldk9wdGlvbnModiwgTlVMTCwgJm9w
dGlvbnMsIGVycnApOwogICAgIHZpc2l0X2ZyZWUodik7CiAKLSAgICBpZiAobG9jYWxfZXJyKSB7
Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOworICAgIGlmICgqZXJy
cCkgewogICAgICAgICBnb3RvIGZhaWw7CiAgICAgfQogCi0gICAgcW1wX2Jsb2NrZGV2X2FkZChv
cHRpb25zLCAmbG9jYWxfZXJyKTsKKyAgICBxbXBfYmxvY2tkZXZfYWRkKG9wdGlvbnMsIGVycnAp
OwogCi0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwg
bG9jYWxfZXJyKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ290byBmYWlsOwogICAgIH0K
IApAQCAtNzE4LDE0ICs3MTEsMTIgQEAgZmFpbDoKIAogc3RhdGljIHZvaWQgeGVuX2Jsb2NrX2Ry
aXZlX2Rlc3Ryb3koWGVuQmxvY2tEcml2ZSAqZHJpdmUsIEVycm9yICoqZXJycCkKIHsKKyAgICBF
UlJQX0FVVE9fUFJPUEFHQVRFKCk7CiAgICAgY2hhciAqbm9kZV9uYW1lID0gZHJpdmUtPm5vZGVf
bmFtZTsKIAogICAgIGlmIChub2RlX25hbWUpIHsKLSAgICAgICAgRXJyb3IgKmxvY2FsX2VyciA9
IE5VTEw7Ci0KLSAgICAgICAgeGVuX2Jsb2NrX2Jsb2NrZGV2X2RlbChub2RlX25hbWUsICZsb2Nh
bF9lcnIpOwotICAgICAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9w
YWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgeGVuX2Jsb2NrX2Jsb2NrZGV2X2RlbChu
b2RlX25hbWUsIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKICAgICAgICAgICAgIHJldHVy
bjsKICAgICAgICAgfQogICAgICAgICBnX2ZyZWUobm9kZV9uYW1lKTsKQEAgLTczOSw2ICs3MzAs
NyBAQCBzdGF0aWMgWGVuQmxvY2tEcml2ZSAqeGVuX2Jsb2NrX2RyaXZlX2NyZWF0ZShjb25zdCBj
aGFyICppZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNv
bnN0IGNoYXIgKmRldmljZV90eXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgUURpY3QgKm9wdHMsIEVycm9yICoqZXJycCkKIHsKKyAgICBFUlJQX0FVVE9f
UFJPUEFHQVRFKCk7CiAgICAgY29uc3QgY2hhciAqcGFyYW1zID0gcWRpY3RfZ2V0X3RyeV9zdHIo
b3B0cywgInBhcmFtcyIpOwogICAgIGNvbnN0IGNoYXIgKm1vZGUgPSBxZGljdF9nZXRfdHJ5X3N0
cihvcHRzLCAibW9kZSIpOwogICAgIGNvbnN0IGNoYXIgKmRpcmVjdF9pb19zYWZlID0gcWRpY3Rf
Z2V0X3RyeV9zdHIob3B0cywgImRpcmVjdC1pby1zYWZlIik7CkBAIC03NDYsNyArNzM4LDYgQEAg
c3RhdGljIFhlbkJsb2NrRHJpdmUgKnhlbl9ibG9ja19kcml2ZV9jcmVhdGUoY29uc3QgY2hhciAq
aWQsCiAgICAgY2hhciAqZHJpdmVyID0gTlVMTDsKICAgICBjaGFyICpmaWxlbmFtZSA9IE5VTEw7
CiAgICAgWGVuQmxvY2tEcml2ZSAqZHJpdmUgPSBOVUxMOwotICAgIEVycm9yICpsb2NhbF9lcnIg
PSBOVUxMOwogICAgIFFEaWN0ICpmaWxlX2xheWVyOwogICAgIFFEaWN0ICpkcml2ZXJfbGF5ZXI7
CiAKQEAgLTgyNSwxMyArODE2LDEyIEBAIHN0YXRpYyBYZW5CbG9ja0RyaXZlICp4ZW5fYmxvY2tf
ZHJpdmVfY3JlYXRlKGNvbnN0IGNoYXIgKmlkLAogCiAgICAgZ19hc3NlcnQoIWRyaXZlLT5ub2Rl
X25hbWUpOwogICAgIGRyaXZlLT5ub2RlX25hbWUgPSB4ZW5fYmxvY2tfYmxvY2tkZXZfYWRkKGRy
aXZlLT5pZCwgZHJpdmVyX2xheWVyLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICZsb2NhbF9lcnIpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGVycnApOwogCiAgICAgcW9iamVjdF91bnJlZihkcml2ZXJfbGF5ZXIp
OwogCiBkb25lOgotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFnYXRl
KGVycnAsIGxvY2FsX2Vycik7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIHhlbl9ibG9ja19k
cml2ZV9kZXN0cm95KGRyaXZlLCBOVUxMKTsKICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAgfQpA
QCAtODU2LDE1ICs4NDYsMTMgQEAgc3RhdGljIHZvaWQgeGVuX2Jsb2NrX2lvdGhyZWFkX2Rlc3Ry
b3koWGVuQmxvY2tJT1RocmVhZCAqaW90aHJlYWQsCiBzdGF0aWMgWGVuQmxvY2tJT1RocmVhZCAq
eGVuX2Jsb2NrX2lvdGhyZWFkX2NyZWF0ZShjb25zdCBjaGFyICppZCwKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVycm9yICoqZXJycCkKIHsKKyAg
ICBFUlJQX0FVVE9fUFJPUEFHQVRFKCk7CiAgICAgWGVuQmxvY2tJT1RocmVhZCAqaW90aHJlYWQg
PSBnX25ldyhYZW5CbG9ja0lPVGhyZWFkLCAxKTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVM
TDsKIAogICAgIGlvdGhyZWFkLT5pZCA9IGdfc3RyZHVwKGlkKTsKIAotICAgIHFtcF9vYmplY3Rf
YWRkKFRZUEVfSU9USFJFQUQsIGlkLCBmYWxzZSwgTlVMTCwgJmxvY2FsX2Vycik7Ci0gICAgaWYg
KGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsK
LQorICAgIHFtcF9vYmplY3RfYWRkKFRZUEVfSU9USFJFQUQsIGlkLCBmYWxzZSwgTlVMTCwgZXJy
cCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIGdfZnJlZShpb3RocmVhZC0+aWQpOwogICAg
ICAgICBnX2ZyZWUoaW90aHJlYWQpOwogICAgICAgICByZXR1cm4gTlVMTDsKQEAgLTg3Niw2ICs4
NjQsNyBAQCBzdGF0aWMgWGVuQmxvY2tJT1RocmVhZCAqeGVuX2Jsb2NrX2lvdGhyZWFkX2NyZWF0
ZShjb25zdCBjaGFyICppZCwKIHN0YXRpYyB2b2lkIHhlbl9ibG9ja19kZXZpY2VfY3JlYXRlKFhl
bkJhY2tlbmRJbnN0YW5jZSAqYmFja2VuZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIFFEaWN0ICpvcHRzLCBFcnJvciAqKmVycnApCiB7CisgICAgRVJSUF9BVVRPX1BST1BB
R0FURSgpOwogICAgIFhlbkJ1cyAqeGVuYnVzID0geGVuX2JhY2tlbmRfZ2V0X2J1cyhiYWNrZW5k
KTsKICAgICBjb25zdCBjaGFyICpuYW1lID0geGVuX2JhY2tlbmRfZ2V0X25hbWUoYmFja2VuZCk7
CiAgICAgdW5zaWduZWQgbG9uZyBudW1iZXI7CkBAIC04ODMsNyArODcyLDYgQEAgc3RhdGljIHZv
aWQgeGVuX2Jsb2NrX2RldmljZV9jcmVhdGUoWGVuQmFja2VuZEluc3RhbmNlICpiYWNrZW5kLAog
ICAgIFhlbkJsb2NrRHJpdmUgKmRyaXZlID0gTlVMTDsKICAgICBYZW5CbG9ja0lPVGhyZWFkICpp
b3RocmVhZCA9IE5VTEw7CiAgICAgWGVuRGV2aWNlICp4ZW5kZXYgPSBOVUxMOwotICAgIEVycm9y
ICpsb2NhbF9lcnIgPSBOVUxMOwogICAgIGNvbnN0IGNoYXIgKnR5cGU7CiAgICAgWGVuQmxvY2tE
ZXZpY2UgKmJsb2NrZGV2OwogCkBAIC05MTUsNTIgKzkwMyw0OCBAQCBzdGF0aWMgdm9pZCB4ZW5f
YmxvY2tfZGV2aWNlX2NyZWF0ZShYZW5CYWNrZW5kSW5zdGFuY2UgKmJhY2tlbmQsCiAgICAgICAg
IGdvdG8gZmFpbDsKICAgICB9CiAKLSAgICBkcml2ZSA9IHhlbl9ibG9ja19kcml2ZV9jcmVhdGUo
dmRldiwgZGV2aWNlX3R5cGUsIG9wdHMsICZsb2NhbF9lcnIpOworICAgIGRyaXZlID0geGVuX2Js
b2NrX2RyaXZlX2NyZWF0ZSh2ZGV2LCBkZXZpY2VfdHlwZSwgb3B0cywgZXJycCk7CiAgICAgaWYg
KCFkcml2ZSkgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGVfcHJlcGVuZChlcnJwLCBsb2NhbF9l
cnIsICJmYWlsZWQgdG8gY3JlYXRlIGRyaXZlOiAiKTsKKyAgICAgICAgZXJyb3JfcHJlcGVuZChl
cnJwLCAiZmFpbGVkIHRvIGNyZWF0ZSBkcml2ZTogIik7CiAgICAgICAgIGdvdG8gZmFpbDsKICAg
ICB9CiAKLSAgICBpb3RocmVhZCA9IHhlbl9ibG9ja19pb3RocmVhZF9jcmVhdGUodmRldiwgJmxv
Y2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGVf
cHJlcGVuZChlcnJwLCBsb2NhbF9lcnIsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICJmYWlsZWQgdG8gY3JlYXRlIGlvdGhyZWFkOiAiKTsKKyAgICBpb3RocmVhZCA9IHhlbl9ibG9j
a19pb3RocmVhZF9jcmVhdGUodmRldiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CisgICAgICAg
IGVycm9yX3ByZXBlbmQoZXJycCwgImZhaWxlZCB0byBjcmVhdGUgaW90aHJlYWQ6ICIpOwogICAg
ICAgICBnb3RvIGZhaWw7CiAgICAgfQogCiAgICAgeGVuZGV2ID0gWEVOX0RFVklDRShxZGV2X2Ny
ZWF0ZShCVVMoeGVuYnVzKSwgdHlwZSkpOwogICAgIGJsb2NrZGV2ID0gWEVOX0JMT0NLX0RFVklD
RSh4ZW5kZXYpOwogCi0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9zdHIoT0JKRUNUKHhlbmRldiks
IHZkZXYsICJ2ZGV2IiwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAg
ICBlcnJvcl9wcm9wYWdhdGVfcHJlcGVuZChlcnJwLCBsb2NhbF9lcnIsICJmYWlsZWQgdG8gc2V0
ICd2ZGV2JzogIik7CisgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9zdHIoT0JKRUNUKHhlbmRldiks
IHZkZXYsICJ2ZGV2IiwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CisgICAgICAgIGVycm9yX3By
ZXBlbmQoZXJycCwgImZhaWxlZCB0byBzZXQgJ3ZkZXYnOiAiKTsKICAgICAgICAgZ290byBmYWls
OwogICAgIH0KIAogICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfc3RyKE9CSkVDVCh4ZW5kZXYpLAog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhlbl9ibG9ja19kcml2ZV9nZXRfbm9kZV9uYW1l
KGRyaXZlKSwgImRyaXZlIiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAmbG9jYWxfZXJy
KTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZV9wcmVwZW5k
KGVycnAsIGxvY2FsX2VyciwgImZhaWxlZCB0byBzZXQgJ2RyaXZlJzogIik7CisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CisgICAgICAgIGVycm9y
X3ByZXBlbmQoZXJycCwgImZhaWxlZCB0byBzZXQgJ2RyaXZlJzogIik7CiAgICAgICAgIGdvdG8g
ZmFpbDsKICAgICB9CiAKICAgICBvYmplY3RfcHJvcGVydHlfc2V0X3N0cihPQkpFQ1QoeGVuZGV2
KSwgaW90aHJlYWQtPmlkLCAiaW90aHJlYWQiLAotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3JfcHJvcGFn
YXRlX3ByZXBlbmQoZXJycCwgbG9jYWxfZXJyLAotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAiZmFpbGVkIHRvIHNldCAnaW90aHJlYWQnOiAiKTsKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKKyAgICAgICAgZXJyb3JfcHJlcGVuZChl
cnJwLCAiZmFpbGVkIHRvIHNldCAnaW90aHJlYWQnOiAiKTsKICAgICAgICAgZ290byBmYWlsOwog
ICAgIH0KIAogICAgIGJsb2NrZGV2LT5pb3RocmVhZCA9IGlvdGhyZWFkOwogICAgIGJsb2NrZGV2
LT5kcml2ZSA9IGRyaXZlOwogCi0gICAgb2JqZWN0X3Byb3BlcnR5X3NldF9ib29sKE9CSkVDVCh4
ZW5kZXYpLCB0cnVlLCAicmVhbGl6ZWQiLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJy
KSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZV9wcmVwZW5kKGVycnAsIGxvY2FsX2VyciwKLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInJlYWxpemF0aW9uIG9mIGRldmljZSAlcyBm
YWlsZWQ6ICIsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUpOworICAgIG9i
amVjdF9wcm9wZXJ0eV9zZXRfYm9vbChPQkpFQ1QoeGVuZGV2KSwgdHJ1ZSwgInJlYWxpemVkIiwg
ZXJycCk7CisgICAgaWYgKCplcnJwKSB7CisgICAgICAgIGVycm9yX3ByZXBlbmQoZXJycCwgInJl
YWxpemF0aW9uIG9mIGRldmljZSAlcyBmYWlsZWQ6ICIsIHR5cGUpOwogICAgICAgICBnb3RvIGZh
aWw7CiAgICAgfQogCkBAIC05ODQsNiArOTY4LDcgQEAgZmFpbDoKIHN0YXRpYyB2b2lkIHhlbl9i
bG9ja19kZXZpY2VfZGVzdHJveShYZW5CYWNrZW5kSW5zdGFuY2UgKmJhY2tlbmQsCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJwKQogeworICAgIEVSUlBf
QVVUT19QUk9QQUdBVEUoKTsKICAgICBYZW5EZXZpY2UgKnhlbmRldiA9IHhlbl9iYWNrZW5kX2dl
dF9kZXZpY2UoYmFja2VuZCk7CiAgICAgWGVuQmxvY2tEZXZpY2UgKmJsb2NrZGV2ID0gWEVOX0JM
T0NLX0RFVklDRSh4ZW5kZXYpOwogICAgIFhlbkJsb2NrVmRldiAqdmRldiA9ICZibG9ja2Rldi0+
cHJvcHMudmRldjsKQEAgLTk5NSwyMyArOTgwLDE3IEBAIHN0YXRpYyB2b2lkIHhlbl9ibG9ja19k
ZXZpY2VfZGVzdHJveShYZW5CYWNrZW5kSW5zdGFuY2UgKmJhY2tlbmQsCiAgICAgb2JqZWN0X3Vu
cGFyZW50KE9CSkVDVCh4ZW5kZXYpKTsKIAogICAgIGlmIChpb3RocmVhZCkgewotICAgICAgICBF
cnJvciAqbG9jYWxfZXJyID0gTlVMTDsKLQotICAgICAgICB4ZW5fYmxvY2tfaW90aHJlYWRfZGVz
dHJveShpb3RocmVhZCwgJmxvY2FsX2Vycik7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsKLSAg
ICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZV9wcmVwZW5kKGVycnAsIGxvY2FsX2VyciwKLSAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgImZhaWxlZCB0byBkZXN0cm95IGlvdGhyZWFkOiAi
KTsKKyAgICAgICAgeGVuX2Jsb2NrX2lvdGhyZWFkX2Rlc3Ryb3koaW90aHJlYWQsIGVycnApOwor
ICAgICAgICBpZiAoKmVycnApIHsKKyAgICAgICAgICAgIGVycm9yX3ByZXBlbmQoZXJycCwgImZh
aWxlZCB0byBkZXN0cm95IGlvdGhyZWFkOiAiKTsKICAgICAgICAgICAgIHJldHVybjsKICAgICAg
ICAgfQogICAgIH0KIAogICAgIGlmIChkcml2ZSkgewotICAgICAgICBFcnJvciAqbG9jYWxfZXJy
ID0gTlVMTDsKLQotICAgICAgICB4ZW5fYmxvY2tfZHJpdmVfZGVzdHJveShkcml2ZSwgJmxvY2Fs
X2Vycik7Ci0gICAgICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgICAgIGVycm9yX3Byb3Bh
Z2F0ZV9wcmVwZW5kKGVycnAsIGxvY2FsX2VyciwKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgImZhaWxlZCB0byBkZXN0cm95IGRyaXZlOiAiKTsKKyAgICAgICAgeGVuX2Jsb2NrX2Ry
aXZlX2Rlc3Ryb3koZHJpdmUsIGVycnApOworICAgICAgICBpZiAoKmVycnApIHsKKyAgICAgICAg
ICAgIGVycm9yX3ByZXBlbmQoZXJycCwgImZhaWxlZCB0byBkZXN0cm95IGRyaXZlOiAiKTsKICAg
ICAgICAgfQogICAgIH0KIH0KZGlmZiAtLWdpdCBhL2h3L3BjaS1ob3N0L3hlbl9pZ2RfcHQuYyBi
L2h3L3BjaS1ob3N0L3hlbl9pZ2RfcHQuYwppbmRleCBlZmNjOTM0N2ZmLi4yOWFkZTljYTI1IDEw
MDY0NAotLS0gYS9ody9wY2ktaG9zdC94ZW5faWdkX3B0LmMKKysrIGIvaHcvcGNpLWhvc3QveGVu
X2lnZF9wdC5jCkBAIC03OSwxNyArNzksMTYgQEAgc3RhdGljIHZvaWQgaG9zdF9wY2lfY29uZmln
X3JlYWQoaW50IHBvcywgaW50IGxlbiwgdWludDMyX3QgKnZhbCwgRXJyb3IgKiplcnJwKQogCiBz
dGF0aWMgdm9pZCBpZ2RfcHRfaTQ0MGZ4X3JlYWxpemUoUENJRGV2aWNlICpwY2lfZGV2LCBFcnJv
ciAqKmVycnApCiB7CisgICAgRVJSUF9BVVRPX1BST1BBR0FURSgpOwogICAgIHVpbnQzMl90IHZh
bCA9IDA7CiAgICAgc2l6ZV90IGk7CiAgICAgaW50IHBvcywgbGVuOwotICAgIEVycm9yICpsb2Nh
bF9lcnIgPSBOVUxMOwogCiAgICAgZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUoaWdkX2hvc3Rf
YnJpZGdlX2luZm9zKTsgaSsrKSB7CiAgICAgICAgIHBvcyA9IGlnZF9ob3N0X2JyaWRnZV9pbmZv
c1tpXS5vZmZzZXQ7CiAgICAgICAgIGxlbiA9IGlnZF9ob3N0X2JyaWRnZV9pbmZvc1tpXS5sZW47
Ci0gICAgICAgIGhvc3RfcGNpX2NvbmZpZ19yZWFkKHBvcywgbGVuLCAmdmFsLCAmbG9jYWxfZXJy
KTsKLSAgICAgICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRl
KGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgIGhvc3RfcGNpX2NvbmZpZ19yZWFkKHBvcywgbGVu
LCAmdmFsLCBlcnJwKTsKKyAgICAgICAgaWYgKCplcnJwKSB7CiAgICAgICAgICAgICByZXR1cm47
CiAgICAgICAgIH0KICAgICAgICAgcGNpX2RlZmF1bHRfd3JpdGVfY29uZmlnKHBjaV9kZXYsIHBv
cywgdmFsLCBsZW4pOwpkaWZmIC0tZ2l0IGEvaHcveGVuL3hlbi1iYWNrZW5kLmMgYi9ody94ZW4v
eGVuLWJhY2tlbmQuYwppbmRleCBkYTA2NWY4MWI3Li4xY2MwNjk0MDUzIDEwMDY0NAotLS0gYS9o
dy94ZW4veGVuLWJhY2tlbmQuYworKysgYi9ody94ZW4veGVuLWJhY2tlbmQuYwpAQCAtOTgsOSAr
OTgsOSBAQCBzdGF0aWMgdm9pZCB4ZW5fYmFja2VuZF9saXN0X3JlbW92ZShYZW5CYWNrZW5kSW5z
dGFuY2UgKmJhY2tlbmQpCiB2b2lkIHhlbl9iYWNrZW5kX2RldmljZV9jcmVhdGUoWGVuQnVzICp4
ZW5idXMsIGNvbnN0IGNoYXIgKnR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
Y29uc3QgY2hhciAqbmFtZSwgUURpY3QgKm9wdHMsIEVycm9yICoqZXJycCkKIHsKKyAgICBFUlJQ
X0FVVE9fUFJPUEFHQVRFKCk7CiAgICAgY29uc3QgWGVuQmFja2VuZEltcGwgKmltcGwgPSB4ZW5f
YmFja2VuZF90YWJsZV9sb29rdXAodHlwZSk7CiAgICAgWGVuQmFja2VuZEluc3RhbmNlICpiYWNr
ZW5kOwotICAgIEVycm9yICpsb2NhbF9lcnJvciA9IE5VTEw7CiAKICAgICBpZiAoIWltcGwpIHsK
ICAgICAgICAgcmV0dXJuOwpAQCAtMTEwLDkgKzExMCw4IEBAIHZvaWQgeGVuX2JhY2tlbmRfZGV2
aWNlX2NyZWF0ZShYZW5CdXMgKnhlbmJ1cywgY29uc3QgY2hhciAqdHlwZSwKICAgICBiYWNrZW5k
LT54ZW5idXMgPSB4ZW5idXM7CiAgICAgYmFja2VuZC0+bmFtZSA9IGdfc3RyZHVwKG5hbWUpOwog
Ci0gICAgaW1wbC0+Y3JlYXRlKGJhY2tlbmQsIG9wdHMsICZsb2NhbF9lcnJvcik7Ci0gICAgaWYg
KGxvY2FsX2Vycm9yKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnJv
cik7CisgICAgaW1wbC0+Y3JlYXRlKGJhY2tlbmQsIG9wdHMsIGVycnApOworICAgIGlmICgqZXJy
cCkgewogICAgICAgICBnX2ZyZWUoYmFja2VuZC0+bmFtZSk7CiAgICAgICAgIGdfZnJlZShiYWNr
ZW5kKTsKICAgICAgICAgcmV0dXJuOwpkaWZmIC0tZ2l0IGEvaHcveGVuL3hlbi1idXMuYyBiL2h3
L3hlbi94ZW4tYnVzLmMKaW5kZXggOTE5ZTY2MTYyYS4uN2YwZTkxZjZjMCAxMDA2NDQKLS0tIGEv
aHcveGVuL3hlbi1idXMuYworKysgYi9ody94ZW4veGVuLWJ1cy5jCkBAIC01Myw5ICs1Myw5IEBA
IHN0YXRpYyBjaGFyICp4ZW5fZGV2aWNlX2dldF9mcm9udGVuZF9wYXRoKFhlbkRldmljZSAqeGVu
ZGV2KQogCiBzdGF0aWMgdm9pZCB4ZW5fZGV2aWNlX3VucGx1ZyhYZW5EZXZpY2UgKnhlbmRldiwg
RXJyb3IgKiplcnJwKQogeworICAgIEVSUlBfQVVUT19QUk9QQUdBVEUoKTsKICAgICBYZW5CdXMg
KnhlbmJ1cyA9IFhFTl9CVVMocWRldl9nZXRfcGFyZW50X2J1cyhERVZJQ0UoeGVuZGV2KSkpOwog
ICAgIGNvbnN0IGNoYXIgKnR5cGUgPSBvYmplY3RfZ2V0X3R5cGVuYW1lKE9CSkVDVCh4ZW5kZXYp
KTsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsKICAgICB4c190cmFuc2FjdGlvbl90IHRp
ZDsKIAogICAgIHRyYWNlX3hlbl9kZXZpY2VfdW5wbHVnKHR5cGUsIHhlbmRldi0+bmFtZSk7CkBA
IC02OSwxNCArNjksMTQgQEAgYWdhaW46CiAgICAgfQogCiAgICAgeHNfbm9kZV9wcmludGYoeGVu
YnVzLT54c2gsIHRpZCwgeGVuZGV2LT5iYWNrZW5kX3BhdGgsICJvbmxpbmUiLAotICAgICAgICAg
ICAgICAgICAgICZsb2NhbF9lcnIsICIldSIsIDApOwotICAgIGlmIChsb2NhbF9lcnIpIHsKKyAg
ICAgICAgICAgICAgICAgICBlcnJwLCAiJXUiLCAwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAg
ICAgZ290byBhYm9ydDsKICAgICB9CiAKICAgICB4c19ub2RlX3ByaW50Zih4ZW5idXMtPnhzaCwg
dGlkLCB4ZW5kZXYtPmJhY2tlbmRfcGF0aCwgInN0YXRlIiwKLSAgICAgICAgICAgICAgICAgICAm
bG9jYWxfZXJyLCAiJXUiLCBYZW5idXNTdGF0ZUNsb3NpbmcpOwotICAgIGlmIChsb2NhbF9lcnIp
IHsKKyAgICAgICAgICAgICAgICAgICBlcnJwLCAiJXUiLCBYZW5idXNTdGF0ZUNsb3NpbmcpOwor
ICAgIGlmICgqZXJycCkgewogICAgICAgICBnb3RvIGFib3J0OwogICAgIH0KIApAQCAtOTYsNyAr
OTYsNiBAQCBhYm9ydDoKICAgICAgKiBmcm9tIGVuZGluZyB0aGUgdHJhbnNhY3Rpb24uCiAgICAg
ICovCiAgICAgeHNfdHJhbnNhY3Rpb25fZW5kKHhlbmJ1cy0+eHNoLCB0aWQsIHRydWUpOwotICAg
IGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBsb2NhbF9lcnIpOwogfQogCiBzdGF0aWMgdm9pZCB4ZW5f
YnVzX3ByaW50X2RldihNb25pdG9yICptb24sIERldmljZVN0YXRlICpkZXYsIGludCBpbmRlbnQp
CkBAIC0yMDUsMTUgKzIwNCwxMyBAQCBzdGF0aWMgWGVuV2F0Y2ggKndhdGNoX2xpc3RfYWRkKFhl
bldhdGNoTGlzdCAqd2F0Y2hfbGlzdCwgY29uc3QgY2hhciAqbm9kZSwKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgY29uc3QgY2hhciAqa2V5LCBYZW5XYXRjaEhhbmRsZXIgaGFuZGxl
ciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqb3BhcXVlLCBFcnJvciAq
KmVycnApCiB7CisgICAgRVJSUF9BVVRPX1BST1BBR0FURSgpOwogICAgIFhlbldhdGNoICp3YXRj
aCA9IG5ld193YXRjaChub2RlLCBrZXksIGhhbmRsZXIsIG9wYXF1ZSk7Ci0gICAgRXJyb3IgKmxv
Y2FsX2VyciA9IE5VTEw7CiAKICAgICBub3RpZmllcl9saXN0X2FkZCgmd2F0Y2hfbGlzdC0+bm90
aWZpZXJzLCAmd2F0Y2gtPm5vdGlmaWVyKTsKIAotICAgIHhzX25vZGVfd2F0Y2god2F0Y2hfbGlz
dC0+eHNoLCBub2RlLCBrZXksIHdhdGNoLT50b2tlbiwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxv
Y2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKLQor
ICAgIHhzX25vZGVfd2F0Y2god2F0Y2hfbGlzdC0+eHNoLCBub2RlLCBrZXksIHdhdGNoLT50b2tl
biwgZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIG5vdGlmaWVyX3JlbW92ZSgmd2F0
Y2gtPm5vdGlmaWVyKTsKICAgICAgICAgZnJlZV93YXRjaCh3YXRjaCk7CiAKQEAgLTI1NSwxMSAr
MjUyLDExIEBAIHN0YXRpYyB2b2lkIHhlbl9idXNfYmFja2VuZF9jcmVhdGUoWGVuQnVzICp4ZW5i
dXMsIGNvbnN0IGNoYXIgKnR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGNvbnN0IGNoYXIgKm5hbWUsIGNoYXIgKnBhdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIEVycm9yICoqZXJycCkKIHsKKyAgICBFUlJQX0FVVE9fUFJPUEFHQVRFKCk7CiAg
ICAgeHNfdHJhbnNhY3Rpb25fdCB0aWQ7CiAgICAgY2hhciAqKmtleTsKICAgICBRRGljdCAqb3B0
czsKICAgICB1bnNpZ25lZCBpbnQgaSwgbjsKLSAgICBFcnJvciAqbG9jYWxfZXJyID0gTlVMTDsK
IAogICAgIHRyYWNlX3hlbl9idXNfYmFja2VuZF9jcmVhdGUodHlwZSwgcGF0aCk7CiAKQEAgLTMx
NCwxMyArMzExLDExIEBAIGFnYWluOgogICAgICAgICByZXR1cm47CiAgICAgfQogCi0gICAgeGVu
X2JhY2tlbmRfZGV2aWNlX2NyZWF0ZSh4ZW5idXMsIHR5cGUsIG5hbWUsIG9wdHMsICZsb2NhbF9l
cnIpOworICAgIHhlbl9iYWNrZW5kX2RldmljZV9jcmVhdGUoeGVuYnVzLCB0eXBlLCBuYW1lLCBv
cHRzLCBlcnJwKTsKICAgICBxb2JqZWN0X3VucmVmKG9wdHMpOwogCi0gICAgaWYgKGxvY2FsX2Vy
cikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGVfcHJlcGVuZChlcnJwLCBsb2NhbF9lcnIsCi0g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJmYWlsZWQgdG8gY3JlYXRlICclcycgZGV2
aWNlICclcyc6ICIsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUsIG5hbWUp
OworICAgIGlmICgqZXJycCkgeworICAgICAgICBlcnJvcl9wcmVwZW5kKGVycnAsICJmYWlsZWQg
dG8gY3JlYXRlICclcycgZGV2aWNlICclcyc6ICIsIHR5cGUsIG5hbWUpOwogICAgIH0KIH0KIApA
QCAtNDUxLDkgKzQ0Niw5IEBAIHN0YXRpYyB2b2lkIHhlbl9idXNfdW5yZWFsaXplKEJ1c1N0YXRl
ICpidXMsIEVycm9yICoqZXJycCkKIAogc3RhdGljIHZvaWQgeGVuX2J1c19yZWFsaXplKEJ1c1N0
YXRlICpidXMsIEVycm9yICoqZXJycCkKIHsKKyAgICBFUlJQX0FVVE9fUFJPUEFHQVRFKCk7CiAg
ICAgWGVuQnVzICp4ZW5idXMgPSBYRU5fQlVTKGJ1cyk7CiAgICAgdW5zaWduZWQgaW50IGRvbWlk
OwotICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgdHJhY2VfeGVuX2J1c19yZWFs
aXplKCk7CiAKQEAgLTQ3NiwxMCArNDcxLDEwIEBAIHN0YXRpYyB2b2lkIHhlbl9idXNfcmVhbGl6
ZShCdXNTdGF0ZSAqYnVzLCBFcnJvciAqKmVycnApCiAKICAgICB4ZW5idXMtPmJhY2tlbmRfd2F0
Y2ggPQogICAgICAgICB4ZW5fYnVzX2FkZF93YXRjaCh4ZW5idXMsICIiLCAvKiBkb21haW4gcm9v
dCBub2RlICovCi0gICAgICAgICAgICAgICAgICAgICAgICAgICJiYWNrZW5kIiwgeGVuX2J1c19i
YWNrZW5kX2NoYW5nZWQsICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgImJhY2tlbmQiLCB4ZW5fYnVzX2JhY2tlbmRfY2hhbmdlZCwg
ZXJycCk7CisgICAgaWYgKCplcnJwKSB7CiAgICAgICAgIC8qIFRoaXMgbmVlZCBub3QgYmUgdHJl
YXRlZCBhcyBhIGhhcmQgZXJyb3Igc28gZG9uJ3QgcHJvcGFnYXRlICovCi0gICAgICAgIGVycm9y
X3JlcG9ydGZfZXJyKGxvY2FsX2VyciwKKyAgICAgICAgZXJyb3JfcmVwb3J0Zl9lcnIoKmVycnAs
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICJmYWlsZWQgdG8gc2V0IHVwIGVudW1lcmF0aW9u
IHdhdGNoOiAiKTsKICAgICB9CiAKQEAgLTY5Miw5ICs2ODcsOSBAQCBzdGF0aWMgdm9pZCB4ZW5f
ZGV2aWNlX3JlbW92ZV93YXRjaChYZW5EZXZpY2UgKnhlbmRldiwgWGVuV2F0Y2ggKndhdGNoLAog
CiBzdGF0aWMgdm9pZCB4ZW5fZGV2aWNlX2JhY2tlbmRfY3JlYXRlKFhlbkRldmljZSAqeGVuZGV2
LCBFcnJvciAqKmVycnApCiB7CisgICAgRVJSUF9BVVRPX1BST1BBR0FURSgpOwogICAgIFhlbkJ1
cyAqeGVuYnVzID0gWEVOX0JVUyhxZGV2X2dldF9wYXJlbnRfYnVzKERFVklDRSh4ZW5kZXYpKSk7
CiAgICAgc3RydWN0IHhzX3Blcm1pc3Npb25zIHBlcm1zWzJdOwotICAgIEVycm9yICpsb2NhbF9l
cnIgPSBOVUxMOwogCiAgICAgeGVuZGV2LT5iYWNrZW5kX3BhdGggPSB4ZW5fZGV2aWNlX2dldF9i
YWNrZW5kX3BhdGgoeGVuZGV2KTsKIApAQCAtNzA2LDMwICs3MDEsMjcgQEAgc3RhdGljIHZvaWQg
eGVuX2RldmljZV9iYWNrZW5kX2NyZWF0ZShYZW5EZXZpY2UgKnhlbmRldiwgRXJyb3IgKiplcnJw
KQogICAgIGdfYXNzZXJ0KHhlbmJ1cy0+eHNoKTsKIAogICAgIHhzX25vZGVfY3JlYXRlKHhlbmJ1
cy0+eHNoLCBYQlRfTlVMTCwgeGVuZGV2LT5iYWNrZW5kX3BhdGgsIHBlcm1zLAotICAgICAgICAg
ICAgICAgICAgIEFSUkFZX1NJWkUocGVybXMpLCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxf
ZXJyKSB7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZV9wcmVwZW5kKGVycnAsIGxvY2FsX2VyciwK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImZhaWxlZCB0byBjcmVhdGUgYmFja2Vu
ZDogIik7CisgICAgICAgICAgICAgICAgICAgQVJSQVlfU0laRShwZXJtcyksIGVycnApOworICAg
IGlmICgqZXJycCkgeworICAgICAgICBlcnJvcl9wcmVwZW5kKGVycnAsICJmYWlsZWQgdG8gY3Jl
YXRlIGJhY2tlbmQ6ICIpOwogICAgICAgICByZXR1cm47CiAgICAgfQogCiAgICAgeGVuZGV2LT5i
YWNrZW5kX3N0YXRlX3dhdGNoID0KICAgICAgICAgeGVuX2RldmljZV9hZGRfd2F0Y2goeGVuZGV2
LCB4ZW5kZXYtPmJhY2tlbmRfcGF0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInN0
YXRlIiwgeGVuX2RldmljZV9iYWNrZW5kX2NoYW5nZWQsCi0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICZsb2NhbF9lcnIpOwotICAgIGlmIChsb2NhbF9lcnIpIHsKLSAgICAgICAgZXJyb3Jf
cHJvcGFnYXRlX3ByZXBlbmQoZXJycCwgbG9jYWxfZXJyLAotICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAiZmFpbGVkIHRvIHdhdGNoIGJhY2tlbmQgc3RhdGU6ICIpOworICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKKyAgICAgICAgZXJy
b3JfcHJlcGVuZChlcnJwLCAiZmFpbGVkIHRvIHdhdGNoIGJhY2tlbmQgc3RhdGU6ICIpOwogICAg
ICAgICByZXR1cm47CiAgICAgfQogCiAgICAgeGVuZGV2LT5iYWNrZW5kX29ubGluZV93YXRjaCA9
CiAgICAgICAgIHhlbl9kZXZpY2VfYWRkX3dhdGNoKHhlbmRldiwgeGVuZGV2LT5iYWNrZW5kX3Bh
dGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJvbmxpbmUiLCB4ZW5fZGV2aWNlX2Jh
Y2tlbmRfY2hhbmdlZCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJmxvY2FsX2Vycik7
Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGVfcHJlcGVuZChl
cnJwLCBsb2NhbF9lcnIsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJmYWlsZWQg
dG8gd2F0Y2ggYmFja2VuZCBvbmxpbmU6ICIpOworICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKKyAgICAgICAgZXJyb3JfcHJlcGVuZChlcnJwLCAi
ZmFpbGVkIHRvIHdhdGNoIGJhY2tlbmQgb25saW5lOiAiKTsKICAgICAgICAgcmV0dXJuOwogICAg
IH0KIH0KQEAgLTg2Niw5ICs4NTgsOSBAQCBzdGF0aWMgYm9vbCB4ZW5fZGV2aWNlX2Zyb250ZW5k
X2V4aXN0cyhYZW5EZXZpY2UgKnhlbmRldikKIAogc3RhdGljIHZvaWQgeGVuX2RldmljZV9mcm9u
dGVuZF9jcmVhdGUoWGVuRGV2aWNlICp4ZW5kZXYsIEVycm9yICoqZXJycCkKIHsKKyAgICBFUlJQ
X0FVVE9fUFJPUEFHQVRFKCk7CiAgICAgWGVuQnVzICp4ZW5idXMgPSBYRU5fQlVTKHFkZXZfZ2V0
X3BhcmVudF9idXMoREVWSUNFKHhlbmRldikpKTsKICAgICBzdHJ1Y3QgeHNfcGVybWlzc2lvbnMg
cGVybXNbMl07Ci0gICAgRXJyb3IgKmxvY2FsX2VyciA9IE5VTEw7CiAKICAgICB4ZW5kZXYtPmZy
b250ZW5kX3BhdGggPSB4ZW5fZGV2aWNlX2dldF9mcm9udGVuZF9wYXRoKHhlbmRldik7CiAKQEAg
LTg4NSwyMCArODc3LDE4IEBAIHN0YXRpYyB2b2lkIHhlbl9kZXZpY2VfZnJvbnRlbmRfY3JlYXRl
KFhlbkRldmljZSAqeGVuZGV2LCBFcnJvciAqKmVycnApCiAgICAgICAgIGdfYXNzZXJ0KHhlbmJ1
cy0+eHNoKTsKIAogICAgICAgICB4c19ub2RlX2NyZWF0ZSh4ZW5idXMtPnhzaCwgWEJUX05VTEws
IHhlbmRldi0+ZnJvbnRlbmRfcGF0aCwgcGVybXMsCi0gICAgICAgICAgICAgICAgICAgICAgIEFS
UkFZX1NJWkUocGVybXMpLCAmbG9jYWxfZXJyKTsKLSAgICAgICAgaWYgKGxvY2FsX2Vycikgewot
ICAgICAgICAgICAgZXJyb3JfcHJvcGFnYXRlX3ByZXBlbmQoZXJycCwgbG9jYWxfZXJyLAotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImZhaWxlZCB0byBjcmVhdGUgZnJvbnRl
bmQ6ICIpOworICAgICAgICAgICAgICAgICAgICAgICBBUlJBWV9TSVpFKHBlcm1zKSwgZXJycCk7
CisgICAgICAgIGlmICgqZXJycCkgeworICAgICAgICAgICAgZXJyb3JfcHJlcGVuZChlcnJwLCAi
ZmFpbGVkIHRvIGNyZWF0ZSBmcm9udGVuZDogIik7CiAgICAgICAgICAgICByZXR1cm47CiAgICAg
ICAgIH0KICAgICB9CiAKICAgICB4ZW5kZXYtPmZyb250ZW5kX3N0YXRlX3dhdGNoID0KICAgICAg
ICAgeGVuX2RldmljZV9hZGRfd2F0Y2goeGVuZGV2LCB4ZW5kZXYtPmZyb250ZW5kX3BhdGgsICJz
dGF0ZSIsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhlbl9kZXZpY2VfZnJvbnRlbmRf
Y2hhbmdlZCwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2VycikgewotICAgICAgICBlcnJv
cl9wcm9wYWdhdGVfcHJlcGVuZChlcnJwLCBsb2NhbF9lcnIsCi0gICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICJmYWlsZWQgdG8gd2F0Y2ggZnJvbnRlbmQgc3RhdGU6ICIpOworICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICB4ZW5fZGV2aWNlX2Zyb250ZW5kX2NoYW5nZWQsIGVycnAp
OworICAgIGlmICgqZXJycCkgeworICAgICAgICBlcnJvcl9wcmVwZW5kKGVycnAsICJmYWlsZWQg
dG8gd2F0Y2ggZnJvbnRlbmQgc3RhdGU6ICIpOwogICAgIH0KIH0KIApAQCAtMTIyOCwxMSArMTIx
OCwxMSBAQCBzdGF0aWMgdm9pZCB4ZW5fZGV2aWNlX2V4aXQoTm90aWZpZXIgKm4sIHZvaWQgKmRh
dGEpCiAKIHN0YXRpYyB2b2lkIHhlbl9kZXZpY2VfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBF
cnJvciAqKmVycnApCiB7CisgICAgRVJSUF9BVVRPX1BST1BBR0FURSgpOwogICAgIFhlbkRldmlj
ZSAqeGVuZGV2ID0gWEVOX0RFVklDRShkZXYpOwogICAgIFhlbkRldmljZUNsYXNzICp4ZW5kZXZf
Y2xhc3MgPSBYRU5fREVWSUNFX0dFVF9DTEFTUyh4ZW5kZXYpOwogICAgIFhlbkJ1cyAqeGVuYnVz
ID0gWEVOX0JVUyhxZGV2X2dldF9wYXJlbnRfYnVzKERFVklDRSh4ZW5kZXYpKSk7CiAgICAgY29u
c3QgY2hhciAqdHlwZSA9IG9iamVjdF9nZXRfdHlwZW5hbWUoT0JKRUNUKHhlbmRldikpOwotICAg
IEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwogCiAgICAgaWYgKHhlbmRldi0+ZnJvbnRlbmRfaWQg
PT0gRE9NSURfSU5WQUxJRCkgewogICAgICAgICB4ZW5kZXYtPmZyb250ZW5kX2lkID0geGVuX2Rv
bWlkOwpAQCAtMTI0OCwxMCArMTIzOCw5IEBAIHN0YXRpYyB2b2lkIHhlbl9kZXZpY2VfcmVhbGl6
ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCiAgICAgICAgIGdvdG8gdW5yZWFsaXpl
OwogICAgIH0KIAotICAgIHhlbmRldi0+bmFtZSA9IHhlbmRldl9jbGFzcy0+Z2V0X25hbWUoeGVu
ZGV2LCAmbG9jYWxfZXJyKTsKLSAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgIGVycm9yX3By
b3BhZ2F0ZV9wcmVwZW5kKGVycnAsIGxvY2FsX2VyciwKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgImZhaWxlZCB0byBnZXQgZGV2aWNlIG5hbWU6ICIpOworICAgIHhlbmRldi0+bmFt
ZSA9IHhlbmRldl9jbGFzcy0+Z2V0X25hbWUoeGVuZGV2LCBlcnJwKTsKKyAgICBpZiAoKmVycnAp
IHsKKyAgICAgICAgZXJyb3JfcHJlcGVuZChlcnJwLCAiZmFpbGVkIHRvIGdldCBkZXZpY2UgbmFt
ZTogIik7CiAgICAgICAgIGdvdG8gdW5yZWFsaXplOwogICAgIH0KIApAQCAtMTI3NCwyMiArMTI2
MywxOSBAQCBzdGF0aWMgdm9pZCB4ZW5fZGV2aWNlX3JlYWxpemUoRGV2aWNlU3RhdGUgKmRldiwg
RXJyb3IgKiplcnJwKQogICAgIHhlbmRldi0+ZmVhdHVyZV9ncmFudF9jb3B5ID0KICAgICAgICAg
KHhlbmdudHRhYl9ncmFudF9jb3B5KHhlbmRldi0+eGd0aCwgMCwgTlVMTCkgPT0gMCk7CiAKLSAg
ICB4ZW5fZGV2aWNlX2JhY2tlbmRfY3JlYXRlKHhlbmRldiwgJmxvY2FsX2Vycik7Ci0gICAgaWYg
KGxvY2FsX2VycikgewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsK
KyAgICB4ZW5fZGV2aWNlX2JhY2tlbmRfY3JlYXRlKHhlbmRldiwgZXJycCk7CisgICAgaWYgKCpl
cnJwKSB7CiAgICAgICAgIGdvdG8gdW5yZWFsaXplOwogICAgIH0KIAotICAgIHhlbl9kZXZpY2Vf
ZnJvbnRlbmRfY3JlYXRlKHhlbmRldiwgJmxvY2FsX2Vycik7Ci0gICAgaWYgKGxvY2FsX2Vycikg
ewotICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgbG9jYWxfZXJyKTsKKyAgICB4ZW5fZGV2
aWNlX2Zyb250ZW5kX2NyZWF0ZSh4ZW5kZXYsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAg
ICAgICBnb3RvIHVucmVhbGl6ZTsKICAgICB9CiAKICAgICBpZiAoeGVuZGV2X2NsYXNzLT5yZWFs
aXplKSB7Ci0gICAgICAgIHhlbmRldl9jbGFzcy0+cmVhbGl6ZSh4ZW5kZXYsICZsb2NhbF9lcnIp
OwotICAgICAgICBpZiAobG9jYWxfZXJyKSB7Ci0gICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUo
ZXJycCwgbG9jYWxfZXJyKTsKKyAgICAgICAgeGVuZGV2X2NsYXNzLT5yZWFsaXplKHhlbmRldiwg
ZXJycCk7CisgICAgICAgIGlmICgqZXJycCkgewogICAgICAgICAgICAgZ290byB1bnJlYWxpemU7
CiAgICAgICAgIH0KICAgICB9CmRpZmYgLS1naXQgYS9ody94ZW4veGVuLWhvc3QtcGNpLWRldmlj
ZS5jIGIvaHcveGVuL3hlbi1ob3N0LXBjaS1kZXZpY2UuYwppbmRleCAxYjQ0ZGNhZmFmLi4wMjM3
OWMzNDFjIDEwMDY0NAotLS0gYS9ody94ZW4veGVuLWhvc3QtcGNpLWRldmljZS5jCisrKyBiL2h3
L3hlbi94ZW4taG9zdC1wY2ktZGV2aWNlLmMKQEAgLTMzMyw4ICszMzMsOCBAQCB2b2lkIHhlbl9o
b3N0X3BjaV9kZXZpY2VfZ2V0KFhlbkhvc3RQQ0lEZXZpY2UgKmQsIHVpbnQxNl90IGRvbWFpbiwK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDhfdCBidXMsIHVpbnQ4X3QgZGV2LCB1
aW50OF90IGZ1bmMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVycm9yICoqZXJycCkK
IHsKKyAgICBFUlJQX0FVVE9fUFJPUEFHQVRFKCk7CiAgICAgdW5zaWduZWQgaW50IHY7Ci0gICAg
RXJyb3IgKmVyciA9IE5VTEw7CiAKICAgICBkLT5jb25maWdfZmQgPSAtMTsKICAgICBkLT5kb21h
aW4gPSBkb21haW47CkBAIC0zNDIsMzYgKzM0MiwzNiBAQCB2b2lkIHhlbl9ob3N0X3BjaV9kZXZp
Y2VfZ2V0KFhlbkhvc3RQQ0lEZXZpY2UgKmQsIHVpbnQxNl90IGRvbWFpbiwKICAgICBkLT5kZXYg
PSBkZXY7CiAgICAgZC0+ZnVuYyA9IGZ1bmM7CiAKLSAgICB4ZW5faG9zdF9wY2lfY29uZmlnX29w
ZW4oZCwgJmVycik7Ci0gICAgaWYgKGVycikgeworICAgIHhlbl9ob3N0X3BjaV9jb25maWdfb3Bl
bihkLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKICAgICAgICAgZ290byBlcnJvcjsKICAgICB9
CiAKLSAgICB4ZW5faG9zdF9wY2lfZ2V0X3Jlc291cmNlKGQsICZlcnIpOwotICAgIGlmIChlcnIp
IHsKKyAgICB4ZW5faG9zdF9wY2lfZ2V0X3Jlc291cmNlKGQsIGVycnApOworICAgIGlmICgqZXJy
cCkgewogICAgICAgICBnb3RvIGVycm9yOwogICAgIH0KIAotICAgIHhlbl9ob3N0X3BjaV9nZXRf
aGV4X3ZhbHVlKGQsICJ2ZW5kb3IiLCAmdiwgJmVycik7Ci0gICAgaWYgKGVycikgeworICAgIHhl
bl9ob3N0X3BjaV9nZXRfaGV4X3ZhbHVlKGQsICJ2ZW5kb3IiLCAmdiwgZXJycCk7CisgICAgaWYg
KCplcnJwKSB7CiAgICAgICAgIGdvdG8gZXJyb3I7CiAgICAgfQogICAgIGQtPnZlbmRvcl9pZCA9
IHY7CiAKLSAgICB4ZW5faG9zdF9wY2lfZ2V0X2hleF92YWx1ZShkLCAiZGV2aWNlIiwgJnYsICZl
cnIpOwotICAgIGlmIChlcnIpIHsKKyAgICB4ZW5faG9zdF9wY2lfZ2V0X2hleF92YWx1ZShkLCAi
ZGV2aWNlIiwgJnYsIGVycnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICBnb3RvIGVycm9y
OwogICAgIH0KICAgICBkLT5kZXZpY2VfaWQgPSB2OwogCi0gICAgeGVuX2hvc3RfcGNpX2dldF9k
ZWNfdmFsdWUoZCwgImlycSIsICZ2LCAmZXJyKTsKLSAgICBpZiAoZXJyKSB7CisgICAgeGVuX2hv
c3RfcGNpX2dldF9kZWNfdmFsdWUoZCwgImlycSIsICZ2LCBlcnJwKTsKKyAgICBpZiAoKmVycnAp
IHsKICAgICAgICAgZ290byBlcnJvcjsKICAgICB9CiAgICAgZC0+aXJxID0gdjsKIAotICAgIHhl
bl9ob3N0X3BjaV9nZXRfaGV4X3ZhbHVlKGQsICJjbGFzcyIsICZ2LCAmZXJyKTsKLSAgICBpZiAo
ZXJyKSB7CisgICAgeGVuX2hvc3RfcGNpX2dldF9oZXhfdmFsdWUoZCwgImNsYXNzIiwgJnYsIGVy
cnApOworICAgIGlmICgqZXJycCkgewogICAgICAgICBnb3RvIGVycm9yOwogICAgIH0KICAgICBk
LT5jbGFzc19jb2RlID0gdjsKQEAgLTM4MSw3ICszODEsNiBAQCB2b2lkIHhlbl9ob3N0X3BjaV9k
ZXZpY2VfZ2V0KFhlbkhvc3RQQ0lEZXZpY2UgKmQsIHVpbnQxNl90IGRvbWFpbiwKICAgICByZXR1
cm47CiAKIGVycm9yOgotICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOwogCiAgICAgaWYg
KGQtPmNvbmZpZ19mZCA+PSAwKSB7CiAgICAgICAgIGNsb3NlKGQtPmNvbmZpZ19mZCk7CmRpZmYg
LS1naXQgYS9ody94ZW4veGVuX3B0LmMgYi9ody94ZW4veGVuX3B0LmMKaW5kZXggYjkxMDgyY2I4
Yi4uZjU3YjgxNTg4ZSAxMDA2NDQKLS0tIGEvaHcveGVuL3hlbl9wdC5jCisrKyBiL2h3L3hlbi94
ZW5fcHQuYwpAQCAtNzY3LDEyICs3NjcsMTIgQEAgc3RhdGljIHZvaWQgeGVuX3B0X2Rlc3Ryb3ko
UENJRGV2aWNlICpkKSB7CiAKIHN0YXRpYyB2b2lkIHhlbl9wdF9yZWFsaXplKFBDSURldmljZSAq
ZCwgRXJyb3IgKiplcnJwKQogeworICAgIEVSUlBfQVVUT19QUk9QQUdBVEUoKTsKICAgICBYZW5Q
Q0lQYXNzdGhyb3VnaFN0YXRlICpzID0gWEVOX1BUX0RFVklDRShkKTsKICAgICBpbnQgaSwgcmMg
PSAwOwogICAgIHVpbnQ4X3QgbWFjaGluZV9pcnEgPSAwLCBzY3JhdGNoOwogICAgIHVpbnQxNl90
IGNtZCA9IDA7CiAgICAgaW50IHBpcnEgPSBYRU5fUFRfVU5BU1NJR05FRF9QSVJROwotICAgIEVy
cm9yICplcnIgPSBOVUxMOwogCiAgICAgLyogcmVnaXN0ZXIgcmVhbCBkZXZpY2UgKi8KICAgICBY
RU5fUFRfTE9HKGQsICJBc3NpZ25pbmcgcmVhbCBwaHlzaWNhbCBkZXZpY2UgJTAyeDolMDJ4LiVk
IgpAQCAtNzgzLDEwICs3ODMsOSBAQCBzdGF0aWMgdm9pZCB4ZW5fcHRfcmVhbGl6ZShQQ0lEZXZp
Y2UgKmQsIEVycm9yICoqZXJycCkKICAgICB4ZW5faG9zdF9wY2lfZGV2aWNlX2dldCgmcy0+cmVh
bF9kZXZpY2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcy0+aG9zdGFkZHIuZG9tYWlu
LCBzLT5ob3N0YWRkci5idXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcy0+aG9zdGFk
ZHIuc2xvdCwgcy0+aG9zdGFkZHIuZnVuY3Rpb24sCi0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgJmVycik7Ci0gICAgaWYgKGVycikgewotICAgICAgICBlcnJvcl9hcHBlbmRfaGludCgmZXJy
LCAiRmFpbGVkIHRvIFwib3BlblwiIHRoZSByZWFsIHBjaSBkZXZpY2UiKTsKLSAgICAgICAgZXJy
b3JfcHJvcGFnYXRlKGVycnAsIGVycik7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJy
cCk7CisgICAgaWYgKCplcnJwKSB7CisgICAgICAgIGVycm9yX2FwcGVuZF9oaW50KGVycnAsICJG
YWlsZWQgdG8gXCJvcGVuXCIgdGhlIHJlYWwgcGNpIGRldmljZSIpOwogICAgICAgICByZXR1cm47
CiAgICAgfQogCkBAIC04MTMsMTEgKzgxMiwxMCBAQCBzdGF0aWMgdm9pZCB4ZW5fcHRfcmVhbGl6
ZShQQ0lEZXZpY2UgKmQsIEVycm9yICoqZXJycCkKICAgICAgICAgICAgIHJldHVybjsKICAgICAg
ICAgfQogCi0gICAgICAgIHhlbl9wdF9zZXR1cF92Z2EocywgJnMtPnJlYWxfZGV2aWNlLCAmZXJy
KTsKLSAgICAgICAgaWYgKGVycikgewotICAgICAgICAgICAgZXJyb3JfYXBwZW5kX2hpbnQoJmVy
ciwgIlNldHVwIFZHQSBCSU9TIG9mIHBhc3N0aHJvdWdoIgotICAgICAgICAgICAgICAgICAgICAi
IEdGWCBmYWlsZWQiKTsKLSAgICAgICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOwor
ICAgICAgICB4ZW5fcHRfc2V0dXBfdmdhKHMsICZzLT5yZWFsX2RldmljZSwgZXJycCk7CisgICAg
ICAgIGlmICgqZXJycCkgeworICAgICAgICAgICAgZXJyb3JfYXBwZW5kX2hpbnQoZXJycCwgIlNl
dHVwIFZHQSBCSU9TIG9mIHBhc3N0aHJvdWdoIgorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIiBHRlggZmFpbGVkIik7CiAgICAgICAgICAgICB4ZW5faG9zdF9wY2lfZGV2aWNlX3B1dCgm
cy0+cmVhbF9kZXZpY2UpOwogICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CkBAIC04MzAs
MTAgKzgyOCw5IEBAIHN0YXRpYyB2b2lkIHhlbl9wdF9yZWFsaXplKFBDSURldmljZSAqZCwgRXJy
b3IgKiplcnJwKQogICAgIHhlbl9wdF9yZWdpc3Rlcl9yZWdpb25zKHMsICZjbWQpOwogCiAgICAg
LyogcmVpbml0aWFsaXplIGVhY2ggY29uZmlnIHJlZ2lzdGVyIHRvIGJlIGVtdWxhdGVkICovCi0g
ICAgeGVuX3B0X2NvbmZpZ19pbml0KHMsICZlcnIpOwotICAgIGlmIChlcnIpIHsKLSAgICAgICAg
ZXJyb3JfYXBwZW5kX2hpbnQoJmVyciwgIlBDSSBDb25maWcgc3BhY2UgaW5pdGlhbGlzYXRpb24g
ZmFpbGVkIik7Ci0gICAgICAgIGVycm9yX3Byb3BhZ2F0ZShlcnJwLCBlcnIpOworICAgIHhlbl9w
dF9jb25maWdfaW5pdChzLCBlcnJwKTsKKyAgICBpZiAoKmVycnApIHsKKyAgICAgICAgZXJyb3Jf
YXBwZW5kX2hpbnQoZXJycCwgIlBDSSBDb25maWcgc3BhY2UgaW5pdGlhbGlzYXRpb24gZmFpbGVk
Iik7CiAgICAgICAgIHJjID0gLTE7CiAgICAgICAgIGdvdG8gZXJyX291dDsKICAgICB9CmRpZmYg
LS1naXQgYS9ody94ZW4veGVuX3B0X2NvbmZpZ19pbml0LmMgYi9ody94ZW4veGVuX3B0X2NvbmZp
Z19pbml0LmMKaW5kZXggMzFlYzVhZGQxZC4uYWYzZmJkMWJmYiAxMDA2NDQKLS0tIGEvaHcveGVu
L3hlbl9wdF9jb25maWdfaW5pdC5jCisrKyBiL2h3L3hlbi94ZW5fcHRfY29uZmlnX2luaXQuYwpA
QCAtMjAwOCw4ICsyMDA4LDggQEAgc3RhdGljIHZvaWQgeGVuX3B0X2NvbmZpZ19yZWdfaW5pdChY
ZW5QQ0lQYXNzdGhyb3VnaFN0YXRlICpzLAogCiB2b2lkIHhlbl9wdF9jb25maWdfaW5pdChYZW5Q
Q0lQYXNzdGhyb3VnaFN0YXRlICpzLCBFcnJvciAqKmVycnApCiB7CisgICAgRVJSUF9BVVRPX1BS
T1BBR0FURSgpOwogICAgIGludCBpLCByYzsKLSAgICBFcnJvciAqZXJyID0gTlVMTDsKIAogICAg
IFFMSVNUX0lOSVQoJnMtPnJlZ19ncnBzKTsKIApAQCAtMjA1MiwxMCArMjA1Miw5IEBAIHZvaWQg
eGVuX3B0X2NvbmZpZ19pbml0KFhlblBDSVBhc3N0aHJvdWdoU3RhdGUgKnMsIEVycm9yICoqZXJy
cCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVn
X2dycF9vZmZzZXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICZyZWdfZ3JwX2VudHJ5LT5zaXplKTsKICAgICAgICAgICAgIGlmIChyYyA8IDApIHsK
LSAgICAgICAgICAgICAgICBlcnJvcl9zZXRnKCZlcnIsICJGYWlsZWQgdG8gaW5pdGlhbGl6ZSAl
ZC8lenUsIHR5cGUgPSAweCV4LCIKKyAgICAgICAgICAgICAgICBlcnJvcl9zZXRnKGVycnAsICJG
YWlsZWQgdG8gaW5pdGlhbGl6ZSAlZC8lenUsIHR5cGUgPSAweCV4LCIKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICIgcmM6ICVkIiwgaSwgQVJSQVlfU0laRSh4ZW5fcHRfZW11X3JlZ19ncnBz
KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhlbl9wdF9lbXVfcmVnX2dycHNbaV0uZ3Jw
X3R5cGUsIHJjKTsKLSAgICAgICAgICAgICAgICBlcnJvcl9wcm9wYWdhdGUoZXJycCwgZXJyKTsK
ICAgICAgICAgICAgICAgICB4ZW5fcHRfY29uZmlnX2RlbGV0ZShzKTsKICAgICAgICAgICAgICAg
ICByZXR1cm47CiAgICAgICAgICAgICB9CkBAIC0yMDY4LDEzICsyMDY3LDE0IEBAIHZvaWQgeGVu
X3B0X2NvbmZpZ19pbml0KFhlblBDSVBhc3N0aHJvdWdoU3RhdGUgKnMsIEVycm9yICoqZXJycCkK
IAogICAgICAgICAgICAgICAgIC8qIGluaXRpYWxpemUgY2FwYWJpbGl0eSByZWdpc3RlciAqLwog
ICAgICAgICAgICAgICAgIGZvciAoaiA9IDA7IHJlZ3MtPnNpemUgIT0gMDsgaisrLCByZWdzKysp
IHsKLSAgICAgICAgICAgICAgICAgICAgeGVuX3B0X2NvbmZpZ19yZWdfaW5pdChzLCByZWdfZ3Jw
X2VudHJ5LCByZWdzLCAmZXJyKTsKLSAgICAgICAgICAgICAgICAgICAgaWYgKGVycikgewotICAg
ICAgICAgICAgICAgICAgICAgICAgZXJyb3JfYXBwZW5kX2hpbnQoJmVyciwgIkZhaWxlZCB0byBp
bml0IHJlZ2lzdGVyICVkIgotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiIG9mZnNl
dHMgMHgleCBpbiBncnBfdHlwZSA9IDB4JXggKCVkLyV6dSkiLCBqLAotICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICByZWdzLT5vZmZzZXQsIHhlbl9wdF9lbXVfcmVnX2dycHNbaV0uZ3Jw
X3R5cGUsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGksIEFSUkFZX1NJWkUoeGVu
X3B0X2VtdV9yZWdfZ3JwcykpOwotICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JfcHJvcGFn
YXRlKGVycnAsIGVycik7CisgICAgICAgICAgICAgICAgICAgIHhlbl9wdF9jb25maWdfcmVnX2lu
aXQocywgcmVnX2dycF9lbnRyeSwgcmVncywgZXJycCk7CisgICAgICAgICAgICAgICAgICAgIGlm
ICgqZXJycCkgeworICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JfYXBwZW5kX2hpbnQoZXJy
cCwgIkZhaWxlZCB0byBpbml0IHJlZ2lzdGVyICVkIgorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIiBvZmZzZXRzIDB4JXggaW4gZ3JwX3R5cGUgPSAweCV4ICglZC8l
enUpIiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGosCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdzLT5vZmZzZXQsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4ZW5fcHRfZW11X3JlZ19ncnBz
W2ldLmdycF90eXBlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
aSwgQVJSQVlfU0laRSh4ZW5fcHRfZW11X3JlZ19ncnBzKSk7CiAgICAgICAgICAgICAgICAgICAg
ICAgICB4ZW5fcHRfY29uZmlnX2RlbGV0ZShzKTsKICAgICAgICAgICAgICAgICAgICAgICAgIHJl
dHVybjsKICAgICAgICAgICAgICAgICAgICAgfQotLSAKMi4yMS4wCgoKX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApY
ZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9y
Zy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

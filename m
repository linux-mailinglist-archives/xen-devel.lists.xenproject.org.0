Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 0B30868902
	for <lists+xen-devel@lfdr.de>; Mon, 15 Jul 2019 14:39:17 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hn0EI-0003hi-UU; Mon, 15 Jul 2019 12:37:18 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=gpPh=VM=citrix.com=paul.durrant@srs-us1.protection.inumbo.net>)
 id 1hn0EG-0003gr-Li
 for xen-devel@lists.xenproject.org; Mon, 15 Jul 2019 12:37:16 +0000
X-Inumbo-ID: 466b9e26-a6fd-11e9-8980-bc764e045a96
Received: from esa1.hc3370-68.iphmx.com (unknown [216.71.145.142])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 466b9e26-a6fd-11e9-8980-bc764e045a96;
 Mon, 15 Jul 2019 12:37:15 +0000 (UTC)
Authentication-Results: esa1.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=paul.durrant@citrix.com;
 spf=Pass smtp.mailfrom=Paul.Durrant@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa1.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 paul.durrant@citrix.com) identity=pra;
 client-ip=162.221.158.21; receiver=esa1.hc3370-68.iphmx.com;
 envelope-from="Paul.Durrant@citrix.com";
 x-sender="paul.durrant@citrix.com"; x-conformance=sidf_compatible
Received-SPF: Pass (esa1.hc3370-68.iphmx.com: domain of
 Paul.Durrant@citrix.com designates 162.221.158.21 as
 permitted sender) identity=mailfrom;
 client-ip=162.221.158.21; receiver=esa1.hc3370-68.iphmx.com;
 envelope-from="Paul.Durrant@citrix.com";
 x-sender="Paul.Durrant@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83 ~all"
Received-SPF: None (esa1.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa1.hc3370-68.iphmx.com;
 envelope-from="Paul.Durrant@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: TFV180RhliG9CrBpWLmcMBWcvQgHNJgKLVRateFs1KbOIOuinIEKqmKhqFdBPI+qRw/mDmoSbk
 k1oMOsp93LEHnBXVJ3XgocjkgcTtJzpGJD3REgmzygPGQOesngf2tcMUIv63CYiaDQyC2lXQr8
 FJu8pX7chfIlsUO69qekOtYaAe3roS2L/HCpyG11HY2NFvvMTWTFv8HNepPpPfH8cSx0zFynD8
 KjrJMneZgPtbrS3XqTIbwin+tps7dTpozweToZYQMGfMpQJT1endVOGwy9541D9PXfk5wXm2Fe
 Smo=
X-SBRS: 2.7
X-MesageID: 2995665
X-Ironport-Server: esa1.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.63,493,1557201600"; 
   d="scan'208";a="2995665"
From: Paul Durrant <paul.durrant@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Mon, 15 Jul 2019 13:37:10 +0100
Message-ID: <20190715123710.1780-5-paul.durrant@citrix.com>
X-Mailer: git-send-email 2.11.0
In-Reply-To: <20190715123710.1780-1-paul.durrant@citrix.com>
References: <20190715123710.1780-1-paul.durrant@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v2 4/4] iommu / pci: re-implement
 XEN_DOMCTL_get_device_group...
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Paul Durrant <paul.durrant@citrix.com>, Jan Beulich <jbeulich@suse.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

Li4uIHVzaW5nIHRoZSBuZXcgaW9tbXVfZ3JvdXAgaW5mcmFzdHJ1Y3R1cmUuCgpCZWNhdXNlICdz
aWJsaW5nJyBkZXZpY2VzIGFyZSBub3cgbWVtYmVycyBvZiB0aGUgc2FtZSBpb21tdV9ncm91cCwK
aW1wbGVtZW50IHRoZSBkb21jdGwgYnkgbG9va2luZyB1cCB0aGUgaW9tbXVfZ3JvdXAgb2YgdGhl
IHBkZXYgd2l0aCB0aGUKbWF0Y2hpbmcgU0JERiBhbmQgdGhlbiBmaW5kaW5nIGFsbCB0aGUgYXNz
aWduZWQgcGRldnMgdGhhdCBhcmUgaW4gdGhlCmdyb3VwLgoKU2lnbmVkLW9mZi1ieTogUGF1bCBE
dXJyYW50IDxwYXVsLmR1cnJhbnRAY2l0cml4LmNvbT4KLS0tCkNjOiBKYW4gQmV1bGljaCA8amJl
dWxpY2hAc3VzZS5jb20+Cgp2MjoKIC0gUmUtaW1wbGVtZW50IGluIHRoZSBhYnNlbmNlIG9mIGEg
cGVyLWdyb3VwIGRldnMgbGlzdC4KIC0gTWFrZSB1c2Ugb2YgcGNpX3NiZGZfdC4KLS0tCiB4ZW4v
ZHJpdmVycy9wYXNzdGhyb3VnaC9ncm91cHMuYyB8IDQ0ICsrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysKIHhlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3BjaS5jICAgIHwgNTEgKystLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogeGVuL2luY2x1ZGUveGVuL2lvbW11
LmggICAgICAgICAgfCAgMiArKwogMyBmaWxlcyBjaGFuZ2VkLCA0OCBpbnNlcnRpb25zKCspLCA0
OSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9ncm91
cHMuYyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2dyb3Vwcy5jCmluZGV4IDFhMmY0NjFjODcu
LjZkODA2NGU0ZjQgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2dyb3Vwcy5j
CisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2dyb3Vwcy5jCkBAIC0xMiw4ICsxMiwxMiBA
QAogICogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KICAqLwog
CisjaW5jbHVkZSA8eGVuL2d1ZXN0X2FjY2Vzcy5oPgogI2luY2x1ZGUgPHhlbi9pb21tdS5oPgor
I2luY2x1ZGUgPHhlbi9wY2kuaD4KICNpbmNsdWRlIDx4ZW4vcmFkaXgtdHJlZS5oPgorI2luY2x1
ZGUgPHhlbi9zY2hlZC5oPgorI2luY2x1ZGUgPHhzbS94c20uaD4KIAogc3RydWN0IGlvbW11X2dy
b3VwIHsKICAgICB1bnNpZ25lZCBpbnQgaWQ7CkBAIC04MSw2ICs4NSw0NiBAQCBpbnQgaW9tbXVf
Z3JvdXBfYXNzaWduKHN0cnVjdCBwY2lfZGV2ICpwZGV2LCB2b2lkICphcmcpCiAgICAgcmV0dXJu
IDA7CiB9CiAKK2ludCBpb21tdV9nZXRfZGV2aWNlX2dyb3VwKHN0cnVjdCBkb21haW4gKmQsIHBj
aV9zYmRmX3Qgc2JkZiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgIFhFTl9HVUVTVF9IQU5E
TEVfNjQodWludDMyKSBidWYsIGludCBtYXhfc2RldnMpCit7CisgICAgc3RydWN0IGlvbW11X2dy
b3VwICpncnAgPSBOVUxMOworICAgIHN0cnVjdCBwY2lfZGV2ICpwZGV2OworICAgIHVuc2lnbmVk
IGludCBpID0gMDsKKworICAgIHBjaWRldnNfbG9jaygpOworCisgICAgZm9yX2VhY2hfcGRldiAo
IGQsIHBkZXYgKQorICAgIHsKKyAgICAgICAgaWYgKCBwZGV2LT5zYmRmLnNiZGYgPT0gc2JkZi5z
YmRmICkKKyAgICAgICAgeworICAgICAgICAgICAgZ3JwID0gcGRldi0+Z3JwOworICAgICAgICAg
ICAgYnJlYWs7CisgICAgICAgIH0KKyAgICB9CisKKyAgICBpZiAoICFncnAgKQorICAgICAgICBn
b3RvIG91dDsKKworICAgIGZvcl9lYWNoX3BkZXYgKCBkLCBwZGV2ICkKKyAgICB7CisgICAgICAg
IGlmICggeHNtX2dldF9kZXZpY2VfZ3JvdXAoWFNNX0hPT0ssIHBkZXYtPnNiZGYuc2JkZikgfHwK
KyAgICAgICAgICAgICBwZGV2LT5ncnAgIT0gZ3JwICkKKyAgICAgICAgICAgIGNvbnRpbnVlOwor
CisgICAgICAgIGlmICggdW5saWtlbHkoY29weV90b19ndWVzdF9vZmZzZXQoYnVmLCBpKyssICZw
ZGV2LT5zYmRmLnNiZGYsIDEpKSApCisgICAgICAgIHsKKyAgICAgICAgICAgIHBjaWRldnNfdW5s
b2NrKCk7CisgICAgICAgICAgICByZXR1cm4gLUVGQVVMVDsKKyAgICAgICAgfQorICAgIH0KKwor
IG91dDoKKyAgICBwY2lkZXZzX3VubG9jaygpOworCisgICAgcmV0dXJuIGk7Cit9CisKIC8qCiAg
KiBMb2NhbCB2YXJpYWJsZXM6CiAgKiBtb2RlOiBDCmRpZmYgLS1naXQgYS94ZW4vZHJpdmVycy9w
YXNzdGhyb3VnaC9wY2kuYyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3BjaS5jCmluZGV4IDE3
OWNiN2UxN2UuLjNhNWU5MGMxNzYgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdo
L3BjaS5jCisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3BjaS5jCkBAIC0xNTYzLDUzICsx
NTYzLDYgQEAgaW50IGRlYXNzaWduX2RldmljZShzdHJ1Y3QgZG9tYWluICpkLCB1MTYgc2VnLCB1
OCBidXMsIHU4IGRldmZuKQogICAgIHJldHVybiByZXQ7CiB9CiAKLXN0YXRpYyBpbnQgaW9tbXVf
Z2V0X2RldmljZV9ncm91cCgKLSAgICBzdHJ1Y3QgZG9tYWluICpkLCB1MTYgc2VnLCB1OCBidXMs
IHU4IGRldmZuLAotICAgIFhFTl9HVUVTVF9IQU5ETEVfNjQodWludDMyKSBidWYsIGludCBtYXhf
c2RldnMpCi17Ci0gICAgY29uc3Qgc3RydWN0IGRvbWFpbl9pb21tdSAqaGQgPSBkb21faW9tbXUo
ZCk7Ci0gICAgc3RydWN0IHBjaV9kZXYgKnBkZXY7Ci0gICAgaW50IGdyb3VwX2lkLCBzZGV2X2lk
OwotICAgIHUzMiBiZGY7Ci0gICAgaW50IGkgPSAwOwotICAgIGNvbnN0IHN0cnVjdCBpb21tdV9v
cHMgKm9wcyA9IGhkLT5wbGF0Zm9ybV9vcHM7Ci0KLSAgICBpZiAoICFpb21tdV9lbmFibGVkIHx8
ICFvcHMgfHwgIW9wcy0+Z2V0X2RldmljZV9ncm91cF9pZCApCi0gICAgICAgIHJldHVybiAwOwot
Ci0gICAgZ3JvdXBfaWQgPSBvcHMtPmdldF9kZXZpY2VfZ3JvdXBfaWQoc2VnLCBidXMsIGRldmZu
KTsKLQotICAgIHBjaWRldnNfbG9jaygpOwotICAgIGZvcl9lYWNoX3BkZXYoIGQsIHBkZXYgKQot
ICAgIHsKLSAgICAgICAgaWYgKCAocGRldi0+c2VnICE9IHNlZykgfHwKLSAgICAgICAgICAgICAo
KHBkZXYtPmJ1cyA9PSBidXMpICYmIChwZGV2LT5kZXZmbiA9PSBkZXZmbikpICkKLSAgICAgICAg
ICAgIGNvbnRpbnVlOwotCi0gICAgICAgIGlmICggeHNtX2dldF9kZXZpY2VfZ3JvdXAoWFNNX0hP
T0ssIChzZWcgPDwgMTYpIHwgKHBkZXYtPmJ1cyA8PCA4KSB8IHBkZXYtPmRldmZuKSApCi0gICAg
ICAgICAgICBjb250aW51ZTsKLQotICAgICAgICBzZGV2X2lkID0gb3BzLT5nZXRfZGV2aWNlX2dy
b3VwX2lkKHNlZywgcGRldi0+YnVzLCBwZGV2LT5kZXZmbik7Ci0gICAgICAgIGlmICggKHNkZXZf
aWQgPT0gZ3JvdXBfaWQpICYmIChpIDwgbWF4X3NkZXZzKSApCi0gICAgICAgIHsKLSAgICAgICAg
ICAgIGJkZiA9IDA7Ci0gICAgICAgICAgICBiZGYgfD0gKHBkZXYtPmJ1cyAmIDB4ZmYpIDw8IDE2
OwotICAgICAgICAgICAgYmRmIHw9IChwZGV2LT5kZXZmbiAmIDB4ZmYpIDw8IDg7Ci0KLSAgICAg
ICAgICAgIGlmICggdW5saWtlbHkoY29weV90b19ndWVzdF9vZmZzZXQoYnVmLCBpLCAmYmRmLCAx
KSkgKQotICAgICAgICAgICAgewotICAgICAgICAgICAgICAgIHBjaWRldnNfdW5sb2NrKCk7Ci0g
ICAgICAgICAgICAgICAgcmV0dXJuIC0xOwotICAgICAgICAgICAgfQotICAgICAgICAgICAgaSsr
OwotICAgICAgICB9Ci0gICAgfQotCi0gICAgcGNpZGV2c191bmxvY2soKTsKLQotICAgIHJldHVy
biBpOwotfQotCiB2b2lkIGlvbW11X2Rldl9pb3RsYl9mbHVzaF90aW1lb3V0KHN0cnVjdCBkb21h
aW4gKmQsIHN0cnVjdCBwY2lfZGV2ICpwZGV2KQogewogICAgIHBjaWRldnNfbG9jaygpOwpAQCAt
MTY2NiwxMSArMTYxOSwxMSBAQCBpbnQgaW9tbXVfZG9fcGNpX2RvbWN0bCgKICAgICAgICAgbWF4
X3NkZXZzID0gZG9tY3RsLT51LmdldF9kZXZpY2VfZ3JvdXAubWF4X3NkZXZzOwogICAgICAgICBz
ZGV2cyA9IGRvbWN0bC0+dS5nZXRfZGV2aWNlX2dyb3VwLnNkZXZfYXJyYXk7CiAKLSAgICAgICAg
cmV0ID0gaW9tbXVfZ2V0X2RldmljZV9ncm91cChkLCBzZWcsIGJ1cywgZGV2Zm4sIHNkZXZzLCBt
YXhfc2RldnMpOworICAgICAgICByZXQgPSBpb21tdV9nZXRfZGV2aWNlX2dyb3VwKGQsIFBDSV9T
QkRGMyhzZWcsIGJ1cywgZGV2Zm4pLCBzZGV2cywKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBtYXhfc2RldnMpOwogICAgICAgICBpZiAoIHJldCA8IDAgKQogICAgICAgICB7
CiAgICAgICAgICAgICBkcHJpbnRrKFhFTkxPR19FUlIsICJpb21tdV9nZXRfZGV2aWNlX2dyb3Vw
KCkgZmFpbGVkIVxuIik7Ci0gICAgICAgICAgICByZXQgPSAtRUZBVUxUOwogICAgICAgICAgICAg
ZG9tY3RsLT51LmdldF9kZXZpY2VfZ3JvdXAubnVtX3NkZXZzID0gMDsKICAgICAgICAgfQogICAg
ICAgICBlbHNlCmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS94ZW4vaW9tbXUuaCBiL3hlbi9pbmNs
dWRlL3hlbi9pb21tdS5oCmluZGV4IGM5M2Y1ODBmZGMuLmFjNzY0YjQxZjkgMTAwNjQ0Ci0tLSBh
L3hlbi9pbmNsdWRlL3hlbi9pb21tdS5oCisrKyBiL3hlbi9pbmNsdWRlL3hlbi9pb21tdS5oCkBA
IC0zMjEsNiArMzIxLDggQEAgZXh0ZXJuIHN0cnVjdCBwYWdlX2xpc3RfaGVhZCBpb21tdV9wdF9j
bGVhbnVwX2xpc3Q7CiAKIHZvaWQgaW9tbXVfZ3JvdXBzX2luaXQodm9pZCk7CiBpbnQgaW9tbXVf
Z3JvdXBfYXNzaWduKHN0cnVjdCBwY2lfZGV2ICpwZGV2LCB2b2lkICphcmcpOworaW50IGlvbW11
X2dldF9kZXZpY2VfZ3JvdXAoc3RydWN0IGRvbWFpbiAqZCwgcGNpX3NiZGZfdCBzYmRmLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgWEVOX0dVRVNUX0hBTkRMRV82NCh1aW50MzIpIGJ1Ziwg
aW50IG1heF9zZGV2cyk7CiAKICNlbmRpZiAvKiBDT05GSUdfSEFTX1BDSSAqLwogCi0tIAoyLjEx
LjAKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4t
ZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczov
L2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

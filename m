Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id E6AD6FE625
	for <lists+xen-devel@lfdr.de>; Fri, 15 Nov 2019 21:04:19 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iVhmk-0005Zu-8t; Fri, 15 Nov 2019 20:01:38 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=NJS8=ZH=dornerworks.com=stewart.hildebrand@srs-us1.protection.inumbo.net>)
 id 1iVhmj-0005Zg-CW
 for xen-devel@lists.xenproject.org; Fri, 15 Nov 2019 20:01:37 +0000
X-Inumbo-ID: b3d339d2-07e2-11ea-adbe-bc764e2007e4
Received: from webmail.dornerworks.com (unknown [12.207.209.150])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTP
 id b3d339d2-07e2-11ea-adbe-bc764e2007e4;
 Fri, 15 Nov 2019 20:01:25 +0000 (UTC)
From: Stewart Hildebrand <stewart.hildebrand@dornerworks.com>
To: <xen-devel@lists.xenproject.org>
Date: Fri, 15 Nov 2019 15:01:07 -0500
Message-ID: <20191115200115.44890-4-stewart.hildebrand@dornerworks.com>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191115200115.44890-1-stewart.hildebrand@dornerworks.com>
References: <20191115200115.44890-1-stewart.hildebrand@dornerworks.com>
MIME-Version: 1.0
X-Originating-IP: [172.27.14.58]
X-ClientProxiedBy: Mcbain.dw.local (172.27.1.45) To Mcbain.dw.local
 (172.27.1.45)
X-spam-status: No, score=-2.9 required=3.5 tests=ALL_TRUSTED, BAYES_00,
 MAILSHELL_SCORE_10_69
X-Spam-Flag: NO
Subject: [Xen-devel] [XEN PATCH v3 03/11] xen: arm: Refactor
 route_irq_to_guest
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Julien Grall <julien@xen.org>,
 Ian Campbell <ian.campbell@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

RnJvbTogSWFuIENhbXBiZWxsIDxpYW4uY2FtcGJlbGxAY2l0cml4LmNvbT4KClNwbGl0IG91dCB0
aGUgYml0IHdoaWNoIGFsbG9jYXRlcyB0aGUgc3RydWN0IGlycWFjdGlvbiBhbmQgY2FsbHMKX19z
ZXR1cF9pcnEgaW50byBhIG5ldyBmdW5jdGlvbiAoc2V0dXBfZ3Vlc3RfaXJxKS4gSSdtIGdvaW5n
IHRvIHdhbnQKdG8gY2FsbCB0aGlzIGEgc2Vjb25kIHRpbWUgaW4gYSBzdWJzZXF1ZW50IHBhdGNo
LgoKTm90ZSB0aGF0IHRoZSBhY3Rpb24gaXMgbm93IGFsbG9jYXRlZCBhbmQgaW5pdGlhbGlzZWQg
d2l0aCB0aGUgZGVzYwpsb2NrIGhlbGQgKHNpbmNlIGl0IGlzIHRha2VuIGJ5IHRoZSBjYWxsZXIp
LiBJIGRvbid0IHRoaW5rIHRoaXMgaXMgYW4KaXNzdWUgKGFuZCBhdm9pZGluZyB0aGlzIHdvdWxk
IG1ha2UgdGhpbmdzIG1vcmUgY29tcGxleCkKClNpZ25lZC1vZmYtYnk6IElhbiBDYW1wYmVsbCA8
aWFuLmNhbXBiZWxsQGNpdHJpeC5jb20+ClNpZ25lZC1vZmYtYnk6IFN0ZXdhcnQgSGlsZGVicmFu
ZCA8c3Rld2FydC5oaWxkZWJyYW5kQGRvcm5lcndvcmtzLmNvbT4KLS0tCnYyOiBOZXcgcGF0Y2gg
KG1heWJlLCBpdCdzIGJlZW4gYSB3aGlsZS4uLikKCnYzOiBSZWJhc2UgKyB0cml2aWFsIGZpeHVw
cwoKLS0tCk5vdGU6IEkgaGF2ZSBub3QgZ2l2ZW4gbXVjaCB0aG91Z2h0IHJlZ2FyZGluZyBKdWxp
ZW4ncyBjb21tZW50IGluIFsxXQoKWzFdIGh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvYXJj
aGl2ZXMvaHRtbC94ZW4tZGV2ZWwvMjAxNS0xMS9tc2cwMTA0MS5odG1sCi0tLQogeGVuL2FyY2gv
YXJtL2lycS5jIHwgMTA4ICsrKysrKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0t
LS0tLQogMSBmaWxlIGNoYW5nZWQsIDY0IGluc2VydGlvbnMoKyksIDQ0IGRlbGV0aW9ucygtKQoK
ZGlmZiAtLWdpdCBhL3hlbi9hcmNoL2FybS9pcnEuYyBiL3hlbi9hcmNoL2FybS9pcnEuYwppbmRl
eCAzODc3NjU3YTUyLi45Y2MwYTU0ODY3IDEwMDY0NAotLS0gYS94ZW4vYXJjaC9hcm0vaXJxLmMK
KysrIGIveGVuL2FyY2gvYXJtL2lycS5jCkBAIC00MDcsNjEgKzQwNywyNSBAQCBib29sIGlycV90
eXBlX3NldF9ieV9kb21haW4oY29uc3Qgc3RydWN0IGRvbWFpbiAqZCkKICAgICByZXR1cm4gKGQg
PT0gaGFyZHdhcmVfZG9tYWluKTsKIH0KIAotLyoKLSAqIFJvdXRlIGFuIElSUSB0byBhIHNwZWNp
ZmljIGd1ZXN0LgotICogRm9yIG5vdyBvbmx5IFNQSXMgYXJlIGFzc2lnbmFibGUgdG8gdGhlIGd1
ZXN0LgotICovCi1pbnQgcm91dGVfaXJxX3RvX2d1ZXN0KHN0cnVjdCBkb21haW4gKmQsIHVuc2ln
bmVkIGludCB2aXJxLAotICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgaXJxLCBj
b25zdCBjaGFyICogZGV2bmFtZSkKK3N0YXRpYyBpbnQgc2V0dXBfZ3Vlc3RfaXJxKHN0cnVjdCBp
cnFfZGVzYyAqZGVzYywgdW5zaWduZWQgaW50IHZpcnEsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICB1bnNpZ25lZCBpbnQgaXJxZmxhZ3MsCisgICAgICAgICAgICAgICAgICAgICAgICAgICBz
dHJ1Y3QgaXJxX2d1ZXN0ICppbmZvLCBjb25zdCBjaGFyICpkZXZuYW1lKQogeworICAgIGNvbnN0
IHVuc2lnbmVkIGlycSA9IGRlc2MtPmlycTsKICAgICBzdHJ1Y3QgaXJxYWN0aW9uICphY3Rpb247
Ci0gICAgc3RydWN0IGlycV9ndWVzdCAqaW5mbzsKLSAgICBzdHJ1Y3QgaXJxX2Rlc2MgKmRlc2M7
Ci0gICAgdW5zaWduZWQgbG9uZyBmbGFnczsKLSAgICBpbnQgcmV0dmFsID0gMDsKLQotICAgIGlm
ICggdmlycSA+PSB2Z2ljX251bV9pcnFzKGQpICkKLSAgICB7Ci0gICAgICAgIHByaW50ayhYRU5M
T0dfR19FUlIKLSAgICAgICAgICAgICAgICJ0aGUgdklSUSBudW1iZXIgJXUgaXMgdG9vIGhpZ2gg
Zm9yIGRvbWFpbiAldSAobWF4ID0gJXUpXG4iLAotICAgICAgICAgICAgICAgaXJxLCBkLT5kb21h
aW5faWQsIHZnaWNfbnVtX2lycXMoZCkpOwotICAgICAgICByZXR1cm4gLUVJTlZBTDsKLSAgICB9
Ci0KLSAgICAvKiBPbmx5IHJvdXRpbmcgdG8gdmlydHVhbCBTUElzIGlzIHN1cHBvcnRlZCAqLwot
ICAgIGlmICggdmlycSA8IE5SX0xPQ0FMX0lSUVMgKQotICAgIHsKLSAgICAgICAgcHJpbnRrKFhF
TkxPR19HX0VSUiAiSVJRIGNhbiBvbmx5IGJlIHJvdXRlZCB0byBhbiBTUElcbiIpOwotICAgICAg
ICByZXR1cm4gLUVJTlZBTDsKLSAgICB9CisgICAgaW50IHJldHZhbDsKKyAgICBzdHJ1Y3QgZG9t
YWluICpkID0gaW5mby0+ZDsKIAotICAgIGlmICggIWlzX2Fzc2lnbmFibGVfaXJxKGlycSkgKQot
ICAgIHsKLSAgICAgICAgcHJpbnRrKFhFTkxPR19HX0VSUiAidGhlIElSUSV1IGlzIG5vdCByb3V0
YWJsZVxuIiwgaXJxKTsKLSAgICAgICAgcmV0dXJuIC1FSU5WQUw7Ci0gICAgfQotICAgIGRlc2Mg
PSBpcnFfdG9fZGVzYyhpcnEpOworICAgIEFTU0VSVChzcGluX2lzX2xvY2tlZCgmZGVzYy0+bG9j
aykpOwogCiAgICAgYWN0aW9uID0geG1hbGxvYyhzdHJ1Y3QgaXJxYWN0aW9uKTsKICAgICBpZiAo
ICFhY3Rpb24gKQogICAgICAgICByZXR1cm4gLUVOT01FTTsKIAotICAgIGluZm8gPSB4bWFsbG9j
KHN0cnVjdCBpcnFfZ3Vlc3QpOwotICAgIGlmICggIWluZm8gKQotICAgIHsKLSAgICAgICAgeGZy
ZWUoYWN0aW9uKTsKLSAgICAgICAgcmV0dXJuIC1FTk9NRU07Ci0gICAgfQotCi0gICAgaW5mby0+
ZCA9IGQ7Ci0gICAgaW5mby0+dmlycSA9IHZpcnE7Ci0KICAgICBhY3Rpb24tPmRldl9pZCA9IGlu
Zm87CiAgICAgYWN0aW9uLT5uYW1lID0gZGV2bmFtZTsKICAgICBhY3Rpb24tPmZyZWVfb25fcmVs
ZWFzZSA9IDE7CiAKLSAgICBzcGluX2xvY2tfaXJxc2F2ZSgmZGVzYy0+bG9jaywgZmxhZ3MpOwot
CiAgICAgaWYgKCAhaXJxX3R5cGVfc2V0X2J5X2RvbWFpbihkKSAmJiBkZXNjLT5hcmNoLnR5cGUg
PT0gSVJRX1RZUEVfSU5WQUxJRCApCiAgICAgewogICAgICAgICBwcmludGsoWEVOTE9HX0dfRVJS
ICJJUlEgJXUgaGFzIG5vdCBiZWVuIGNvbmZpZ3VyZWRcbiIsIGlycSk7CkBAIC00OTYsNiArNDYw
LDggQEAgaW50IHJvdXRlX2lycV90b19ndWVzdChzdHJ1Y3QgZG9tYWluICpkLCB1bnNpZ25lZCBp
bnQgdmlycSwKICAgICAgICAgICAgICAgICAgICAgICAgZC0+ZG9tYWluX2lkLCBpcnEsIGlycV9n
ZXRfZ3Vlc3RfaW5mbyhkZXNjKS0+dmlycSk7CiAgICAgICAgICAgICAgICAgcmV0dmFsID0gLUVC
VVNZOwogICAgICAgICAgICAgfQorICAgICAgICAgICAgZWxzZQorICAgICAgICAgICAgICAgIHJl
dHZhbCA9IDA7CiAgICAgICAgIH0KICAgICAgICAgZWxzZQogICAgICAgICB7CkBAIC01MDksNiAr
NDc1LDYxIEBAIGludCByb3V0ZV9pcnFfdG9fZ3Vlc3Qoc3RydWN0IGRvbWFpbiAqZCwgdW5zaWdu
ZWQgaW50IHZpcnEsCiAgICAgaWYgKCByZXR2YWwgKQogICAgICAgICBnb3RvIG91dDsKIAorICAg
IHJldHVybiAwOworCitvdXQ6CisgICAgeGZyZWUoYWN0aW9uKTsKKyAgICByZXR1cm4gcmV0dmFs
OworfQorCisvKgorICogUm91dGUgYW4gSVJRIHRvIGEgc3BlY2lmaWMgZ3Vlc3QuCisgKiBGb3Ig
bm93IG9ubHkgU1BJcyBhcmUgYXNzaWduYWJsZSB0byB0aGUgZ3Vlc3QuCisgKi8KK2ludCByb3V0
ZV9pcnFfdG9fZ3Vlc3Qoc3RydWN0IGRvbWFpbiAqZCwgdW5zaWduZWQgaW50IHZpcnEsCisgICAg
ICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCBpcnEsIGNvbnN0IGNoYXIgKiBkZXZuYW1l
KQoreworICAgIHN0cnVjdCBpcnFfZ3Vlc3QgKmluZm87CisgICAgc3RydWN0IGlycV9kZXNjICpk
ZXNjOworICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7CisgICAgaW50IHJldHZhbDsKKworICAgIGlm
ICggdmlycSA+PSB2Z2ljX251bV9pcnFzKGQpICkKKyAgICB7CisgICAgICAgIHByaW50ayhYRU5M
T0dfR19FUlIKKyAgICAgICAgICAgICAgICJ0aGUgdklSUSBudW1iZXIgJXUgaXMgdG9vIGhpZ2gg
Zm9yIGRvbWFpbiAldSAobWF4ID0gJXUpXG4iLAorICAgICAgICAgICAgICAgaXJxLCBkLT5kb21h
aW5faWQsIHZnaWNfbnVtX2lycXMoZCkpOworICAgICAgICByZXR1cm4gLUVJTlZBTDsKKyAgICB9
CisKKyAgICAvKiBPbmx5IHJvdXRpbmcgdG8gdmlydHVhbCBTUElzIGlzIHN1cHBvcnRlZCAqLwor
ICAgIGlmICggdmlycSA8IE5SX0xPQ0FMX0lSUVMgKQorICAgIHsKKyAgICAgICAgcHJpbnRrKFhF
TkxPR19HX0VSUiAiSVJRIGNhbiBvbmx5IGJlIHJvdXRlZCB0byBhbiBTUElcbiIpOworICAgICAg
ICByZXR1cm4gLUVJTlZBTDsKKyAgICB9CisKKyAgICBpZiAoICFpc19hc3NpZ25hYmxlX2lycShp
cnEpICkKKyAgICB7CisgICAgICAgIHByaW50ayhYRU5MT0dfR19FUlIgInRoZSBJUlEldSBpcyBu
b3Qgcm91dGFibGVcbiIsIGlycSk7CisgICAgICAgIHJldHVybiAtRUlOVkFMOworICAgIH0KKwor
ICAgIGRlc2MgPSBpcnFfdG9fZGVzYyhpcnEpOworCisgICAgaW5mbyA9IHhtYWxsb2Moc3RydWN0
IGlycV9ndWVzdCk7CisgICAgaWYgKCAhaW5mbyApCisgICAgICAgIHJldHVybiAtRU5PTUVNOwor
CisgICAgaW5mby0+ZCA9IGQ7CisgICAgaW5mby0+dmlycSA9IHZpcnE7CisKKyAgICBzcGluX2xv
Y2tfaXJxc2F2ZSgmZGVzYy0+bG9jaywgZmxhZ3MpOworCisgICAgcmV0dmFsID0gc2V0dXBfZ3Vl
c3RfaXJxKGRlc2MsIHZpcnEsIGZsYWdzLCBpbmZvLCBkZXZuYW1lKTsKKyAgICBpZiAoIHJldHZh
bCApCisgICAgICAgIGdvdG8gb3V0OworCiAgICAgcmV0dmFsID0gZ2ljX3JvdXRlX2lycV90b19n
dWVzdChkLCB2aXJxLCBkZXNjLCBHSUNfUFJJX0lSUSk7CiAKICAgICBzcGluX3VubG9ja19pcnFy
ZXN0b3JlKCZkZXNjLT5sb2NrLCBmbGFncyk7CkBAIC01MjMsNyArNTQ0LDYgQEAgaW50IHJvdXRl
X2lycV90b19ndWVzdChzdHJ1Y3QgZG9tYWluICpkLCB1bnNpZ25lZCBpbnQgdmlycSwKIAogb3V0
OgogICAgIHNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmRlc2MtPmxvY2ssIGZsYWdzKTsKLSAgICB4
ZnJlZShhY3Rpb24pOwogZnJlZV9pbmZvOgogICAgIHhmcmVlKGluZm8pOwogCi0tIAoyLjI0LjAK
CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2
ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xp
c3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

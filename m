Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 5F0CBAFEE3
	for <lists+xen-devel@lfdr.de>; Wed, 11 Sep 2019 16:39:41 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i83jN-0005ll-KE; Wed, 11 Sep 2019 14:36:25 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=ejLi=XG=citrix.com=paul.durrant@srs-us1.protection.inumbo.net>)
 id 1i83jL-0005lX-HH
 for xen-devel@lists.xenproject.org; Wed, 11 Sep 2019 14:36:23 +0000
X-Inumbo-ID: 860efdca-d4a1-11e9-b299-bc764e2007e4
Received: from esa1.hc3370-68.iphmx.com (unknown [216.71.145.142])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 860efdca-d4a1-11e9-b299-bc764e2007e4;
 Wed, 11 Sep 2019 14:36:22 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1568212582;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=auGXKVKysMN9D3b+964ysE2DbM/GhqmoifMLLl18yEQ=;
 b=EdOiOhMjpmq8A1HZfDvn+YfFEukTjXkCzJ/c4MI6X385yNRz9t6u4ujP
 Wkpw1xQtb1dK8E7mMuh8BLhCAhsupAALIJDndlS1ZY1YRKgfJ0DxmElMf
 IDOXuLqcbAvhOZhT49lLDegiKOvtzReDdKW9t13PIv1/QCPYZVUohqUVn k=;
Authentication-Results: esa1.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=paul.durrant@citrix.com;
 spf=Pass smtp.mailfrom=Paul.Durrant@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa1.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 paul.durrant@citrix.com) identity=pra;
 client-ip=162.221.158.21; receiver=esa1.hc3370-68.iphmx.com;
 envelope-from="Paul.Durrant@citrix.com";
 x-sender="paul.durrant@citrix.com"; x-conformance=sidf_compatible
Received-SPF: Pass (esa1.hc3370-68.iphmx.com: domain of
 Paul.Durrant@citrix.com designates 162.221.158.21 as
 permitted sender) identity=mailfrom;
 client-ip=162.221.158.21; receiver=esa1.hc3370-68.iphmx.com;
 envelope-from="Paul.Durrant@citrix.com";
 x-sender="Paul.Durrant@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83 ~all"
Received-SPF: None (esa1.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa1.hc3370-68.iphmx.com;
 envelope-from="Paul.Durrant@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: YysbEq4yCHilxs2NYypFRclOn+2W+VXz1lQV2gDsOVTFJKoiJmnrX41oyHDgTN9/YrEjQiE3vL
 2Hg8Bvyf9qloqqt5WkzojKs7zmn13F4ECgyRxRHlQp5PQEym2TggwNCQIlkATbYjPUyhtneClf
 ErR/ig/ogRV4LNS8iGJu8lMnxL4hVudEZuzVSOsq6LlPgYsrj7jtUBh05L9KkNhdbae6Cglzjq
 QNRgP9gF4A/Up0hcgDsSrpbGxk64EAKNxSOtdVoo58sIbNgHHTLdytleLk7xCwGjT/4S5G1+uQ
 dhc=
X-SBRS: 2.7
X-MesageID: 5488460
X-Ironport-Server: esa1.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.64,493,1559534400"; 
   d="scan'208";a="5488460"
From: Paul Durrant <paul.durrant@citrix.com>
To: <qemu-devel@nongnu.org>, <xen-devel@lists.xenproject.org>
Date: Wed, 11 Sep 2019 15:36:16 +0100
Message-ID: <20190911143618.23477-2-paul.durrant@citrix.com>
X-Mailer: git-send-email 2.20.1.2.gb21ebb6
In-Reply-To: <20190911143618.23477-1-paul.durrant@citrix.com>
References: <20190911143618.23477-1-paul.durrant@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH 1/3] xen / notify: introduce a new XenWatchList
 abstraction
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Anthony Perard <anthony.perard@citrix.com>,
 Paul Durrant <paul.durrant@citrix.com>,
 Stefano Stabellini <sstabellini@kernel.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

WGVuc3RvcmUgd2F0Y2ggY2FsbC1iYWNrcyBhcmUgYWxyZWFkeSBhYnN0cmFjdGVkIGF3YXkgZnJv
bSBYZW5CdXMgdXNpbmcKdGhlIFhlbldhdGNoIGRhdGEgc3RydWN0dXJlIGJ1dCB0aGUgYXNzb2Np
YXRlZCBOb3RpZmllckxpc3QgbWFuaXB1bGF0aW9uCmFuZCBmaWxlIGhhbmRsZSByZWdpc3RhdGlv
biBpcyBzdGlsbCBvcGVuIGNvZGVkIGluIHZhcmlvdXMgeGVuX2J1c18uLi4oKQpmdW5jdGlvbnMu
ClRoaXMgcGF0Y2ggY3JlYXRlcyBhIG5ldyBYZW5XYXRjaExpc3QgZGF0YSBzdHJ1Y3R1cmUgdG8g
YWxsb3cgdGhlc2UKaW50ZXJhY3Rpb25zIHRvIGJlIGFic3RyYWN0ZWQgYXdheSBmcm9tIFhlbkJ1
cyBhcyB3ZWxsLiBUaGlzIGlzIGluCnByZXBhcmF0aW9uIGZvciBhIHN1YnNlcXVlbnQgcGF0Y2gg
d2hpY2ggd2lsbCBpbnRyb2R1Y2Ugc2VwYXJhdGUgd2F0Y2ggbGlzdHMKZm9yIFhlbkJ1cyBhbmQg
WGVuRGV2aWNlIG9iamVjdHMuCgpOT1RFOiBUaGlzIHBhdGNoIGFsc28gaW50cm9kdWNlcyBhIG5l
dyBOb3RpZmllckxpc3RFbXB0eSgpIGhlbHBlciBmdW5jdGlvbgogICAgICBmb3IgdGhlIHB1cnBv
c2VzIG9mIGFkZGluZyBhbiBhc3NlcnRpb24gdGhhdCBhIFhlbldhdGNoTGlzdCBpcyBub3QKICAg
ICAgZnJlZWQgd2hpbHN0IGl0cyBhc3NvY2lhdGVkIE5vdGlmaWVyTGlzdCBpcyBzdGlsbCBvY2N1
cGllZC4KClNpZ25lZC1vZmYtYnk6IFBhdWwgRHVycmFudCA8cGF1bC5kdXJyYW50QGNpdHJpeC5j
b20+Ci0tLQpDYzogU3RlZmFubyBTdGFiZWxsaW5pIDxzc3RhYmVsbGluaUBrZXJuZWwub3JnPgpD
YzogQW50aG9ueSBQZXJhcmQgPGFudGhvbnkucGVyYXJkQGNpdHJpeC5jb20+Ci0tLQogaHcveGVu
L3RyYWNlLWV2ZW50cyAgICAgIHwgICA1ICstCiBody94ZW4veGVuLWJ1cy5jICAgICAgICAgfCAx
MTcgKysrKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tCiBpbmNsdWRlL2h3L3hl
bi94ZW4tYnVzLmggfCAgIDMgKy0KIGluY2x1ZGUvcWVtdS9ub3RpZnkuaCAgICB8ICAgMiArCiB1
dGlsL25vdGlmeS5jICAgICAgICAgICAgfCAgIDUgKysKIDUgZmlsZXMgY2hhbmdlZCwgODcgaW5z
ZXJ0aW9ucygrKSwgNDUgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvaHcveGVuL3RyYWNlLWV2
ZW50cyBiL2h3L3hlbi90cmFjZS1ldmVudHMKaW5kZXggYmM4MmVjYjFhNS4uYWM4ZDljMjBkMiAx
MDA2NDQKLS0tIGEvaHcveGVuL3RyYWNlLWV2ZW50cworKysgYi9ody94ZW4vdHJhY2UtZXZlbnRz
CkBAIC0xOSw5ICsxOSw4IEBAIHhlbl9idXNfdW5yZWFsaXplKHZvaWQpICIiCiB4ZW5fYnVzX2Vu
dW1lcmF0ZSh2b2lkKSAiIgogeGVuX2J1c190eXBlX2VudW1lcmF0ZShjb25zdCBjaGFyICp0eXBl
KSAidHlwZTogJXMiCiB4ZW5fYnVzX2JhY2tlbmRfY3JlYXRlKGNvbnN0IGNoYXIgKnR5cGUsIGNv
bnN0IGNoYXIgKnBhdGgpICJ0eXBlOiAlcyBwYXRoOiAlcyIKLXhlbl9idXNfYWRkX3dhdGNoKGNv
bnN0IGNoYXIgKm5vZGUsIGNvbnN0IGNoYXIgKmtleSwgY2hhciAqdG9rZW4pICJub2RlOiAlcyBr
ZXk6ICVzIHRva2VuOiAlcyIKLXhlbl9idXNfcmVtb3ZlX3dhdGNoKGNvbnN0IGNoYXIgKm5vZGUs
IGNvbnN0IGNoYXIgKmtleSwgY2hhciAqdG9rZW4pICJub2RlOiAlcyBrZXk6ICVzIHRva2VuOiAl
cyIKLXhlbl9idXNfd2F0Y2goY29uc3QgY2hhciAqdG9rZW4pICJ0b2tlbjogJXMiCit4ZW5fYnVz
X2FkZF93YXRjaChjb25zdCBjaGFyICpub2RlLCBjb25zdCBjaGFyICprZXkpICJub2RlOiAlcyBr
ZXk6ICVzIgoreGVuX2J1c19yZW1vdmVfd2F0Y2goY29uc3QgY2hhciAqbm9kZSwgY29uc3QgY2hh
ciAqa2V5KSAibm9kZTogJXMga2V5OiAlcyIKIHhlbl9kZXZpY2VfcmVhbGl6ZShjb25zdCBjaGFy
ICp0eXBlLCBjaGFyICpuYW1lKSAidHlwZTogJXMgbmFtZTogJXMiCiB4ZW5fZGV2aWNlX3VucmVh
bGl6ZShjb25zdCBjaGFyICp0eXBlLCBjaGFyICpuYW1lKSAidHlwZTogJXMgbmFtZTogJXMiCiB4
ZW5fZGV2aWNlX2JhY2tlbmRfc3RhdGUoY29uc3QgY2hhciAqdHlwZSwgY2hhciAqbmFtZSwgY29u
c3QgY2hhciAqc3RhdGUpICJ0eXBlOiAlcyBuYW1lOiAlcyAtPiAlcyIKZGlmZiAtLWdpdCBhL2h3
L3hlbi94ZW4tYnVzLmMgYi9ody94ZW4veGVuLWJ1cy5jCmluZGV4IDAyNWRmNWU1OWYuLjI4ZWZh
Y2NmZjIgMTAwNjQ0Ci0tLSBhL2h3L3hlbi94ZW4tYnVzLmMKKysrIGIvaHcveGVuL3hlbi1idXMu
YwpAQCAtMTU3LDE4ICsxNTcsNjAgQEAgc3RhdGljIHZvaWQgZnJlZV93YXRjaChYZW5XYXRjaCAq
d2F0Y2gpCiAgICAgZ19mcmVlKHdhdGNoKTsKIH0KIAotc3RhdGljIFhlbldhdGNoICp4ZW5fYnVz
X2FkZF93YXRjaChYZW5CdXMgKnhlbmJ1cywgY29uc3QgY2hhciAqbm9kZSwKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hhciAqa2V5LCBYZW5XYXRjaEhhbmRsZXIg
aGFuZGxlciwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqb3BhcXVl
LCBFcnJvciAqKmVycnApCitzdHJ1Y3QgWGVuV2F0Y2hMaXN0IHsKKyAgICBzdHJ1Y3QgeHNfaGFu
ZGxlICp4c2g7CisgICAgTm90aWZpZXJMaXN0IG5vdGlmaWVyczsKK307CisKK3N0YXRpYyB2b2lk
IHdhdGNoX2xpc3RfZXZlbnQodm9pZCAqb3BhcXVlKQoreworICAgIFhlbldhdGNoTGlzdCAqd2F0
Y2hfbGlzdCA9IG9wYXF1ZTsKKyAgICBjaGFyICoqdjsKKyAgICBjb25zdCBjaGFyICp0b2tlbjsK
KworICAgIHYgPSB4c19jaGVja193YXRjaCh3YXRjaF9saXN0LT54c2gpOworICAgIGlmICghdikg
eworICAgICAgICByZXR1cm47CisgICAgfQorCisgICAgdG9rZW4gPSB2W1hTX1dBVENIX1RPS0VO
XTsKKworICAgIG5vdGlmaWVyX2xpc3Rfbm90aWZ5KCZ3YXRjaF9saXN0LT5ub3RpZmllcnMsICh2
b2lkICopdG9rZW4pOworCisgICAgZnJlZSh2KTsKK30KKworc3RhdGljIFhlbldhdGNoTGlzdCAq
d2F0Y2hfbGlzdF9jcmVhdGUoc3RydWN0IHhzX2hhbmRsZSAqeHNoKQoreworICAgIFhlbldhdGNo
TGlzdCAqd2F0Y2hfbGlzdCA9IGdfbmV3MChYZW5XYXRjaExpc3QsIDEpOworCisgICAgZ19hc3Nl
cnQoeHNoKTsKKworICAgIHdhdGNoX2xpc3QtPnhzaCA9IHhzaDsKKyAgICBub3RpZmllcl9saXN0
X2luaXQoJndhdGNoX2xpc3QtPm5vdGlmaWVycyk7CisgICAgcWVtdV9zZXRfZmRfaGFuZGxlcih4
c19maWxlbm8od2F0Y2hfbGlzdC0+eHNoKSwgd2F0Y2hfbGlzdF9ldmVudCwgTlVMTCwKKyAgICAg
ICAgICAgICAgICAgICAgICAgIHdhdGNoX2xpc3QpOworCisgICAgcmV0dXJuIHdhdGNoX2xpc3Q7
Cit9CisKK3N0YXRpYyB2b2lkIHdhdGNoX2xpc3RfZGVzdHJveShYZW5XYXRjaExpc3QgKndhdGNo
X2xpc3QpCit7CisgICAgZ19hc3NlcnQobm90aWZpZXJfbGlzdF9lbXB0eSgmd2F0Y2hfbGlzdC0+
bm90aWZpZXJzKSk7CisgICAgcWVtdV9zZXRfZmRfaGFuZGxlcih4c19maWxlbm8od2F0Y2hfbGlz
dC0+eHNoKSwgTlVMTCwgTlVMTCwgTlVMTCk7CisgICAgZ19mcmVlKHdhdGNoX2xpc3QpOworfQor
CitzdGF0aWMgWGVuV2F0Y2ggKndhdGNoX2xpc3RfYWRkKFhlbldhdGNoTGlzdCAqd2F0Y2hfbGlz
dCwgY29uc3QgY2hhciAqbm9kZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29u
c3QgY2hhciAqa2V5LCBYZW5XYXRjaEhhbmRsZXIgaGFuZGxlciwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgdm9pZCAqb3BhcXVlLCBFcnJvciAqKmVycnApCiB7CiAgICAgWGVuV2F0
Y2ggKndhdGNoID0gbmV3X3dhdGNoKG5vZGUsIGtleSwgaGFuZGxlciwgb3BhcXVlKTsKICAgICBF
cnJvciAqbG9jYWxfZXJyID0gTlVMTDsKIAotICAgIHRyYWNlX3hlbl9idXNfYWRkX3dhdGNoKHdh
dGNoLT5ub2RlLCB3YXRjaC0+a2V5LCB3YXRjaC0+dG9rZW4pOwotCi0gICAgbm90aWZpZXJfbGlz
dF9hZGQoJnhlbmJ1cy0+d2F0Y2hfbm90aWZpZXJzLCAmd2F0Y2gtPm5vdGlmaWVyKTsKKyAgICBu
b3RpZmllcl9saXN0X2FkZCgmd2F0Y2hfbGlzdC0+bm90aWZpZXJzLCAmd2F0Y2gtPm5vdGlmaWVy
KTsKIAotICAgIHhzX25vZGVfd2F0Y2goeGVuYnVzLT54c2gsIG5vZGUsIGtleSwgd2F0Y2gtPnRv
a2VuLCAmbG9jYWxfZXJyKTsKKyAgICB4c19ub2RlX3dhdGNoKHdhdGNoX2xpc3QtPnhzaCwgbm9k
ZSwga2V5LCB3YXRjaC0+dG9rZW4sICZsb2NhbF9lcnIpOwogICAgIGlmIChsb2NhbF9lcnIpIHsK
ICAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CiAKQEAgLTE4MSwxOCAr
MjIzLDM0IEBAIHN0YXRpYyBYZW5XYXRjaCAqeGVuX2J1c19hZGRfd2F0Y2goWGVuQnVzICp4ZW5i
dXMsIGNvbnN0IGNoYXIgKm5vZGUsCiAgICAgcmV0dXJuIHdhdGNoOwogfQogCi1zdGF0aWMgdm9p
ZCB4ZW5fYnVzX3JlbW92ZV93YXRjaChYZW5CdXMgKnhlbmJ1cywgWGVuV2F0Y2ggKndhdGNoLAot
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJwKQorc3RhdGljIHZv
aWQgd2F0Y2hfbGlzdF9yZW1vdmUoWGVuV2F0Y2hMaXN0ICp3YXRjaF9saXN0LCBYZW5XYXRjaCAq
d2F0Y2gsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcnJvciAqKmVycnApCiB7Ci0g
ICAgdHJhY2VfeGVuX2J1c19yZW1vdmVfd2F0Y2god2F0Y2gtPm5vZGUsIHdhdGNoLT5rZXksIHdh
dGNoLT50b2tlbik7Ci0KLSAgICB4c19ub2RlX3Vud2F0Y2goeGVuYnVzLT54c2gsIHdhdGNoLT5u
b2RlLCB3YXRjaC0+a2V5LCB3YXRjaC0+dG9rZW4sCisgICAgeHNfbm9kZV91bndhdGNoKHdhdGNo
X2xpc3QtPnhzaCwgd2F0Y2gtPm5vZGUsIHdhdGNoLT5rZXksIHdhdGNoLT50b2tlbiwKICAgICAg
ICAgICAgICAgICAgICAgZXJycCk7CiAKICAgICBub3RpZmllcl9yZW1vdmUoJndhdGNoLT5ub3Rp
Zmllcik7CiAgICAgZnJlZV93YXRjaCh3YXRjaCk7CiB9CiAKK3N0YXRpYyBYZW5XYXRjaCAqeGVu
X2J1c19hZGRfd2F0Y2goWGVuQnVzICp4ZW5idXMsIGNvbnN0IGNoYXIgKm5vZGUsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoYXIgKmtleSwgWGVuV2F0Y2hIYW5k
bGVyIGhhbmRsZXIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgKm9w
YXF1ZSwgRXJyb3IgKiplcnJwKQoreworICAgIHRyYWNlX3hlbl9idXNfYWRkX3dhdGNoKG5vZGUs
IGtleSk7CisKKyAgICByZXR1cm4gd2F0Y2hfbGlzdF9hZGQoeGVuYnVzLT53YXRjaF9saXN0LCBu
b2RlLCBrZXksIGhhbmRsZXIsIG9wYXF1ZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgZXJy
cCk7Cit9CisKK3N0YXRpYyB2b2lkIHhlbl9idXNfcmVtb3ZlX3dhdGNoKFhlbkJ1cyAqeGVuYnVz
LCBYZW5XYXRjaCAqd2F0Y2gsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcnJv
ciAqKmVycnApCit7CisgICAgdHJhY2VfeGVuX2J1c19yZW1vdmVfd2F0Y2god2F0Y2gtPm5vZGUs
IHdhdGNoLT5rZXkpOworCisgICAgd2F0Y2hfbGlzdF9yZW1vdmUoeGVuYnVzLT53YXRjaF9saXN0
LCB3YXRjaCwgZXJycCk7Cit9CisKIHN0YXRpYyB2b2lkIHhlbl9idXNfYmFja2VuZF9jcmVhdGUo
WGVuQnVzICp4ZW5idXMsIGNvbnN0IGNoYXIgKnR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIGNvbnN0IGNoYXIgKm5hbWUsIGNoYXIgKnBhdGgsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIEVycm9yICoqZXJycCkKQEAgLTMzOCwzNSArMzk2LDE0IEBA
IHN0YXRpYyB2b2lkIHhlbl9idXNfdW5yZWFsaXplKEJ1c1N0YXRlICpidXMsIEVycm9yICoqZXJy
cCkKICAgICAgICAgeGVuYnVzLT5iYWNrZW5kX3dhdGNoID0gTlVMTDsKICAgICB9CiAKLSAgICBp
ZiAoIXhlbmJ1cy0+eHNoKSB7Ci0gICAgICAgIHJldHVybjsKKyAgICBpZiAoeGVuYnVzLT53YXRj
aF9saXN0KSB7CisgICAgICAgIHdhdGNoX2xpc3RfZGVzdHJveSh4ZW5idXMtPndhdGNoX2xpc3Qp
OworICAgICAgICB4ZW5idXMtPndhdGNoX2xpc3QgPSBOVUxMOwogICAgIH0KIAotICAgIHFlbXVf
c2V0X2ZkX2hhbmRsZXIoeHNfZmlsZW5vKHhlbmJ1cy0+eHNoKSwgTlVMTCwgTlVMTCwgTlVMTCk7
Ci0KLSAgICB4c19jbG9zZSh4ZW5idXMtPnhzaCk7Ci19Ci0KLXN0YXRpYyB2b2lkIHhlbl9idXNf
d2F0Y2godm9pZCAqb3BhcXVlKQotewotICAgIFhlbkJ1cyAqeGVuYnVzID0gb3BhcXVlOwotICAg
IGNoYXIgKip2OwotICAgIGNvbnN0IGNoYXIgKnRva2VuOwotCi0gICAgZ19hc3NlcnQoeGVuYnVz
LT54c2gpOwotCi0gICAgdiA9IHhzX2NoZWNrX3dhdGNoKHhlbmJ1cy0+eHNoKTsKLSAgICBpZiAo
IXYpIHsKLSAgICAgICAgcmV0dXJuOworICAgIGlmICh4ZW5idXMtPnhzaCkgeworICAgICAgICB4
c19jbG9zZSh4ZW5idXMtPnhzaCk7CiAgICAgfQotCi0gICAgdG9rZW4gPSB2W1hTX1dBVENIX1RP
S0VOXTsKLQotICAgIHRyYWNlX3hlbl9idXNfd2F0Y2godG9rZW4pOwotCi0gICAgbm90aWZpZXJf
bGlzdF9ub3RpZnkoJnhlbmJ1cy0+d2F0Y2hfbm90aWZpZXJzLCAodm9pZCAqKXRva2VuKTsKLQot
ICAgIGZyZWUodik7CiB9CiAKIHN0YXRpYyB2b2lkIHhlbl9idXNfcmVhbGl6ZShCdXNTdGF0ZSAq
YnVzLCBFcnJvciAqKmVycnApCkBAIC0zOTAsOSArNDI3LDcgQEAgc3RhdGljIHZvaWQgeGVuX2J1
c19yZWFsaXplKEJ1c1N0YXRlICpidXMsIEVycm9yICoqZXJycCkKICAgICAgICAgeGVuYnVzLT5i
YWNrZW5kX2lkID0gMDsgLyogQXNzdW1lIGxhY2sgb2Ygbm9kZSBtZWFucyBkb20wICovCiAgICAg
fQogCi0gICAgbm90aWZpZXJfbGlzdF9pbml0KCZ4ZW5idXMtPndhdGNoX25vdGlmaWVycyk7Ci0g
ICAgcWVtdV9zZXRfZmRfaGFuZGxlcih4c19maWxlbm8oeGVuYnVzLT54c2gpLCB4ZW5fYnVzX3dh
dGNoLCBOVUxMLAotICAgICAgICAgICAgICAgICAgICAgICAgeGVuYnVzKTsKKyAgICB4ZW5idXMt
PndhdGNoX2xpc3QgPSB3YXRjaF9saXN0X2NyZWF0ZSh4ZW5idXMtPnhzaCk7CiAKICAgICBtb2R1
bGVfY2FsbF9pbml0KE1PRFVMRV9JTklUX1hFTl9CQUNLRU5EKTsKIApkaWZmIC0tZ2l0IGEvaW5j
bHVkZS9ody94ZW4veGVuLWJ1cy5oIGIvaW5jbHVkZS9ody94ZW4veGVuLWJ1cy5oCmluZGV4IDFj
MmQ5ZGZkYjguLjg4Yjg0ZTI5YmIgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvaHcveGVuL3hlbi1idXMu
aAorKysgYi9pbmNsdWRlL2h3L3hlbi94ZW4tYnVzLmgKQEAgLTE0LDYgKzE0LDcgQEAKIAogdHlw
ZWRlZiB2b2lkICgqWGVuV2F0Y2hIYW5kbGVyKSh2b2lkICpvcGFxdWUpOwogCit0eXBlZGVmIHN0
cnVjdCBYZW5XYXRjaExpc3QgWGVuV2F0Y2hMaXN0OwogdHlwZWRlZiBzdHJ1Y3QgWGVuV2F0Y2gg
WGVuV2F0Y2g7CiB0eXBlZGVmIHN0cnVjdCBYZW5FdmVudENoYW5uZWwgWGVuRXZlbnRDaGFubmVs
OwogCkBAIC02Myw3ICs2NCw3IEBAIHR5cGVkZWYgc3RydWN0IFhlbkJ1cyB7CiAgICAgQnVzU3Rh
dGUgcWJ1czsKICAgICBkb21pZF90IGJhY2tlbmRfaWQ7CiAgICAgc3RydWN0IHhzX2hhbmRsZSAq
eHNoOwotICAgIE5vdGlmaWVyTGlzdCB3YXRjaF9ub3RpZmllcnM7CisgICAgWGVuV2F0Y2hMaXN0
ICp3YXRjaF9saXN0OwogICAgIFhlbldhdGNoICpiYWNrZW5kX3dhdGNoOwogfSBYZW5CdXM7CiAK
ZGlmZiAtLWdpdCBhL2luY2x1ZGUvcWVtdS9ub3RpZnkuaCBiL2luY2x1ZGUvcWVtdS9ub3RpZnku
aAppbmRleCBhM2Q3M2U0YmM3Li5iY2ZhNzBmYjJlIDEwMDY0NAotLS0gYS9pbmNsdWRlL3FlbXUv
bm90aWZ5LmgKKysrIGIvaW5jbHVkZS9xZW11L25vdGlmeS5oCkBAIC00MCw2ICs0MCw4IEBAIHZv
aWQgbm90aWZpZXJfcmVtb3ZlKE5vdGlmaWVyICpub3RpZmllcik7CiAKIHZvaWQgbm90aWZpZXJf
bGlzdF9ub3RpZnkoTm90aWZpZXJMaXN0ICpsaXN0LCB2b2lkICpkYXRhKTsKIAorYm9vbCBub3Rp
Zmllcl9saXN0X2VtcHR5KE5vdGlmaWVyTGlzdCAqbGlzdCk7CisKIC8qIFNhbWUgYXMgTm90aWZp
ZXIgYnV0IGFsbG93cyAubm90aWZ5KCkgdG8gcmV0dXJuIGVycm9ycyAqLwogdHlwZWRlZiBzdHJ1
Y3QgTm90aWZpZXJXaXRoUmV0dXJuIE5vdGlmaWVyV2l0aFJldHVybjsKIApkaWZmIC0tZ2l0IGEv
dXRpbC9ub3RpZnkuYyBiL3V0aWwvbm90aWZ5LmMKaW5kZXggYWVlOGQ5M2NiMC4uNzZiYWIyMTJh
ZSAxMDA2NDQKLS0tIGEvdXRpbC9ub3RpZnkuYworKysgYi91dGlsL25vdGlmeS5jCkBAIC00MCw2
ICs0MCwxMSBAQCB2b2lkIG5vdGlmaWVyX2xpc3Rfbm90aWZ5KE5vdGlmaWVyTGlzdCAqbGlzdCwg
dm9pZCAqZGF0YSkKICAgICB9CiB9CiAKK2Jvb2wgbm90aWZpZXJfbGlzdF9lbXB0eShOb3RpZmll
ckxpc3QgKmxpc3QpCit7CisgICAgcmV0dXJuIFFMSVNUX0VNUFRZKCZsaXN0LT5ub3RpZmllcnMp
OworfQorCiB2b2lkIG5vdGlmaWVyX3dpdGhfcmV0dXJuX2xpc3RfaW5pdChOb3RpZmllcldpdGhS
ZXR1cm5MaXN0ICpsaXN0KQogewogICAgIFFMSVNUX0lOSVQoJmxpc3QtPm5vdGlmaWVycyk7Ci0t
IAoyLjIwLjEuMi5nYjIxZWJiNgoKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnBy
b2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94
ZW4tZGV2ZWw=

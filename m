Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id EEA12B1241
	for <lists+xen-devel@lfdr.de>; Thu, 12 Sep 2019 17:35:14 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i8R58-0001yH-IZ; Thu, 12 Sep 2019 15:32:26 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=ncEf=XH=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1i8R56-0001y8-Tf
 for xen-devel@lists.xenproject.org; Thu, 12 Sep 2019 15:32:24 +0000
X-Inumbo-ID: 83e9708a-d572-11e9-978d-bc764e2007e4
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 83e9708a-d572-11e9-978d-bc764e2007e4;
 Thu, 12 Sep 2019 15:32:23 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 49CD9AFA8;
 Thu, 12 Sep 2019 15:32:22 +0000 (UTC)
To: Chao Gao <chao.gao@intel.com>
References: <1568272949-1086-1-git-send-email-chao.gao@intel.com>
 <1568272949-1086-13-git-send-email-chao.gao@intel.com>
From: Jan Beulich <jbeulich@suse.com>
Message-ID: <bce83dad-22f8-7fa1-9801-80a0fce8fd60@suse.com>
Date: Thu, 12 Sep 2019 17:32:22 +0200
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:60.0) Gecko/20100101
 Thunderbird/60.9.0
MIME-Version: 1.0
In-Reply-To: <1568272949-1086-13-git-send-email-chao.gao@intel.com>
Content-Language: en-US
Subject: Re: [Xen-devel] [PATCH v10 12/16] x86/microcode: Synchronize late
 microcode loading
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Sergey Dyasli <sergey.dyasli@citrix.com>, Kevin Tian <kevin.tian@intel.com>,
 Ashok Raj <ashok.raj@intel.com>, Wei Liu <wl@xen.org>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Jun Nakajima <jun.nakajima@intel.com>, xen-devel@lists.xenproject.org,
 Thomas Gleixner <tglx@linutronix.de>, Borislav Petkov <bp@suse.de>,
 =?UTF-8?Q?Roger_Pau_Monn=c3=a9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

T24gMTIuMDkuMjAxOSAwOToyMiwgQ2hhbyBHYW8gd3JvdGU6Cj4gQEAgLTI2NCwzOCArMzM2LDE1
OCBAQCBzdGF0aWMgaW50IG1pY3JvY29kZV91cGRhdGVfY3B1KGNvbnN0IHN0cnVjdCBtaWNyb2Nv
ZGVfcGF0Y2ggKnBhdGNoKQo+ICAgICAgcmV0dXJuIGVycjsKPiAgfQo+ICAKPiAtc3RhdGljIGxv
bmcgZG9fbWljcm9jb2RlX3VwZGF0ZSh2b2lkICpwYXRjaCkKPiArc3RhdGljIGJvb2wgd2FpdF9m
b3Jfc3RhdGUodW5zaWduZWQgaW50IHN0YXRlKQo+ICt7Cj4gKyAgICB3aGlsZSAoIGxvYWRpbmdf
c3RhdGUgIT0gc3RhdGUgKQo+ICsgICAgewo+ICsgICAgICAgIGlmICggc3RhdGUgIT0gTE9BRElO
R19FWElUICYmIGxvYWRpbmdfc3RhdGUgPT0gTE9BRElOR19FWElUICkKPiArICAgICAgICAgICAg
cmV0dXJuIGZhbHNlOwoKVGhpcyBpcyBhdCBsZWFzdCBzb21ld2hhdCBjb25mdXNpbmc6IFRoZXJl
J3Mgbm8gaW5kaWNhdGlvbiBoZXJlCnRoYXQgImxvYWRpbmdfc3RhdGUiIG1heSBjaGFuZ2UgYmVo
aW5kIHRoZSBmdW5jdGlvbidzIGJhY2suIFNvCmluIGdlbmVyYWwgb25lIGNvdWxkIGJlIChhbmQg
SSBpbml0aWFsbHkgd2FzKSB0ZW1wdGVkIHRvIHN1Z2dlc3QKZHJvcHBpbmcgdGhlIGFwcGFyZW50
bHkgcmVkdW5kYW50IGxlZnQgc2lkZSBvZiB0aGUgJiYuIEJ1dCB0aGF0CndvdWxkIGVuZCB1cCB3
cm9uZyBpZiB0aGUgY29tcGlsZXIgdHJhbnNsYXRlcyB0aGUgYWJvdmUgdG8gdHdvCnNlcGFyYXRl
IHJlYWRzIG9mICJsb2FkaW5nX3N0YXRlIi4gVGhlcmVmb3JlIEknZCBsaWtlIHRvIHN1Z2dlc3QK
CnN0YXRpYyBib29sIHdhaXRfZm9yX3N0YXRlKHR5cGVvZihsb2FkaW5nX3N0YXRlKSBzdGF0ZSkK
ewogICAgdHlwZW9mKGxvYWRpbmdfc3RhdGUpIGN1cl9zdGF0ZTsKCiAgICB3aGlsZSAoIChjdXJf
c3RhdGUgPSBBQ0NFU1NfT05DRShsb2FkaW5nX3N0YXRlKSkgIT0gc3RhdGUgKQogICAgewogICAg
ICAgIGlmICggY3VyX3N0YXRlID09IExPQURJTkdfRVhJVCApCiAgICAgICAgICAgIHJldHVybiBm
YWxzZTsKICAgICAgICBjcHVfcmVsYXgoKTsKICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKfQoKb3Ig
c29tZXRoaW5nIHN1YnN0YW50aWFsbHkgc2ltaWxhciAoaWYsIGUuZy4sIHlvdSBkaXNsaWtlIHRo
ZQp1c2Ugb2YgdHlwZW9mKCkgaGVyZSkuCgo+ICtzdGF0aWMgaW50IHNlY29uZGFyeV90aHJlYWRf
Zm4odm9pZCkKPiArewo+ICsgICAgdW5zaWduZWQgaW50IHByaW1hcnkgPSBjcHVtYXNrX2ZpcnN0
KHRoaXNfY3B1KGNwdV9zaWJsaW5nX21hc2spKTsKPiArCj4gKyAgICBpZiAoICF3YWl0X2Zvcl9z
dGF0ZShMT0FESU5HX0NBTExJTikgKQo+ICsgICAgICAgIHJldHVybiAtRUJVU1k7Cj4gKwo+ICsg
ICAgY3B1bWFza19zZXRfY3B1KHNtcF9wcm9jZXNzb3JfaWQoKSwgJmNwdV9jYWxsaW5fbWFwKTsK
PiArCj4gKyAgICBpZiAoICF3YWl0X2Zvcl9zdGF0ZShMT0FESU5HX0VYSVQpICkKPiArICAgICAg
ICByZXR1cm4gLUVCVVNZOwoKVGhpcyByZXR1cm4gbG9va3MgdG8gYmUgdW5yZWFjaGFibGUsIGRv
ZXNuJ3QgaXQ/Cgo+ICtzdGF0aWMgaW50IGNvbnRyb2xfdGhyZWFkX2ZuKGNvbnN0IHN0cnVjdCBt
aWNyb2NvZGVfcGF0Y2ggKnBhdGNoKQo+ICB7Cj4gLSAgICB1bnNpZ25lZCBpbnQgY3B1Owo+IC0g
ICAgaW50IHJldCA9IG1pY3JvY29kZV91cGRhdGVfY3B1KHBhdGNoKTsKPiArICAgIHVuc2lnbmVk
IGludCBjcHUgPSBzbXBfcHJvY2Vzc29yX2lkKCksIGRvbmU7Cj4gKyAgICB1bnNpZ25lZCBsb25n
IHRpY2s7Cj4gKyAgICBpbnQgcmV0Owo+ICsKPiArICAgIC8qCj4gKyAgICAgKiBXZSBpbnRlbmQg
dG8gZGlzYWJsZSBpbnRlcnJ1cHQgZm9yIGxvbmcgdGltZSwgd2hpY2ggbWF5IGxlYWQgdG8KPiAr
ICAgICAqIHdhdGNoZG9nIHRpbWVvdXQuCj4gKyAgICAgKi8KPiArICAgIHdhdGNoZG9nX2Rpc2Fi
bGUoKTsKCldpdGggdGhlIG1vdmUgaGVyZSwgdGhlIGNvbW1lbnQgc2hvdWxkIHN0YXJ0ICJXZSBp
bnRlbmQgdG8ga2VlcAppbnRlcnJ1cHRzIGRpc2FibGVkIGZvciBhIGxvbmcgdGltZSwgLi4uIiAt
IHRoZXkgYXJlIGRpc2FibGVkCmFscmVhZHkgYXQgdGhpcyBwb2ludC4KCj4gLSAgICAvKiBTdG9y
ZSB0aGUgcGF0Y2ggYWZ0ZXIgYSBzdWNjZXNzZnVsIGxvYWRpbmcgKi8KPiAtICAgIGlmICggIXJl
dCAmJiBwYXRjaCApCj4gKyAgICAvKiBBbGxvdyB0aHJlYWRzIHRvIGNhbGwgaW4gKi8KPiArICAg
IHNldF9zdGF0ZShMT0FESU5HX0NBTExJTik7Cj4gKwo+ICsgICAgY3B1bWFza19zZXRfY3B1KGNw
dSwgJmNwdV9jYWxsaW5fbWFwKTsKPiArCj4gKyAgICAvKiBXYWl0aW5nIGZvciBhbGwgdGhyZWFk
cyBjYWxsaW5nIGluICovCj4gKyAgICByZXQgPSB3YWl0X2Zvcl9jb25kaXRpb24od2FpdF9jcHVf
Y2FsbGluLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh2b2lkICopKHVuc2lnbmVk
IGxvbmcpbnVtX29ubGluZV9jcHVzKCksCgpJJ20gcHV6emxlZCBieSBteSBvd24gc3VnZ2VzdGlv
biBpbiByZXBseSB0byB2OSwgYW5kIEknbSBlcXVhbGx5CnB1enpsZWQgdGhhdCB5b3UgZGlkbid0
IHRha2UgaXQgdGhhdCBsaXR0bGUgc3RlcCBmdXJ0aGVyOiBBbGwgb2YKdGhpcyBjYXN0aW5nIHdv
dWxkIGJlIHVubmVjZXNzYXJ5IGlmIHRoZSB0d28gd2FpdF9jcHVfKigpCmZ1bmN0aW9ucyB0b29r
ICJ1bnNpZ25lZCBpbnQiIGFzIHRoZWlyIHBhcmFtZXRlcnMuIChUaGUKb2JzZXJ2YXRpb24gd2l0
aCB2OSB3YXMgdGhhdCBib3RoIGFyZSBzaW1pbGFyIGVub3VnaCB0byBhbGxvdwpmb3IgYSBjb21t
b24gc2lnbmF0dXJlLCBldmVuIGlmIHRoYXQgc2lnbmF0dXJlIHdvdWxkIG5vdCBiZSBhCnR5cGlj
YWwgb25lIGZvciBhIGNhbGxiYWNrLikKCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
TUlDUk9DT0RFX0NBTExJTl9USU1FT1VUX1VTKTsKPiArICAgIGlmICggcmV0ICkKPiAgICAgIHsK
PiAtICAgICAgICBzcGluX2xvY2soJm1pY3JvY29kZV9tdXRleCk7Cj4gLSAgICAgICAgbWljcm9j
b2RlX3VwZGF0ZV9jYWNoZShwYXRjaCk7Cj4gLSAgICAgICAgc3Bpbl91bmxvY2soJm1pY3JvY29k
ZV9tdXRleCk7Cj4gLSAgICAgICAgcGF0Y2ggPSBOVUxMOwo+ICsgICAgICAgIHNldF9zdGF0ZShM
T0FESU5HX0VYSVQpOwo+ICsgICAgICAgIHJldHVybiByZXQ7Cj4gICAgICB9Cj4gIAo+IC0gICAg
aWYgKCBtaWNyb2NvZGVfb3BzLT5lbmRfdXBkYXRlX3BlcmNwdSApCj4gLSAgICAgICAgbWljcm9j
b2RlX29wcy0+ZW5kX3VwZGF0ZV9wZXJjcHUoKTsKPiArICAgIC8qIExldCBwcmltYXJ5IHRocmVh
ZHMgbG9hZCB0aGUgZ2l2ZW4gdWNvZGUgdXBkYXRlICovCj4gKyAgICBzZXRfc3RhdGUoTE9BRElO
R19FTlRFUik7Cj4gIAo+ICsgICAgcmV0ID0gbWljcm9jb2RlX29wcy0+YXBwbHlfbWljcm9jb2Rl
KHBhdGNoKTsKPiArICAgIGlmICggIXJldCApCj4gKyAgICAgICAgYXRvbWljX2luYygmY3B1X3Vw
ZGF0ZWQpOwo+ICsgICAgYXRvbWljX2luYygmY3B1X291dCk7Cj4gKwo+ICsgICAgdGljayA9IHJk
dHNjX29yZGVyZWQoKTsKPiArICAgIC8qIFdhaXQgZm9yIHByaW1hcnkgdGhyZWFkcyBmaW5pc2hp
bmcgdXBkYXRlICovCj4gKyAgICBkb25lID0gYXRvbWljX3JlYWQoJmNwdV9vdXQpOwoKV291bGQg
eW91IG1pbmQgZWxpbWluYXRpbmcgdGhlIGR1cGxpY2F0aW9uIG9mIHRoaXMgYW5kIC4uLgoKPiAr
ICAgIHdoaWxlICggZG9uZSAhPSBucl9jb3JlcyApCj4gKyAgICB7Cj4gKyAgICAgICAgLyoKPiAr
ICAgICAgICAgKiBEdXJpbmcgZWFjaCB0aW1lb3V0IGludGVydmFsLCBhdCBsZWFzdCBhIENQVSBp
cyBleHBlY3RlZCB0bwo+ICsgICAgICAgICAqIGZpbmlzaCBpdHMgdXBkYXRlLiBPdGhlcndpc2Us
IHNvbWV0aGluZyBnb2VzIHdyb25nLgo+ICsgICAgICAgICAqCj4gKyAgICAgICAgICogTm90ZSB0
aGF0IFJEVFNDIChpbiB3YWl0X2Zvcl9jb25kaXRpb24oKSkgaXMgc2FmZSBmb3IgdGhyZWFkcyB0
bwo+ICsgICAgICAgICAqIGV4ZWN1dGUgd2hpbGUgd2FpdGluZyBmb3IgY29tcGxldGlvbiBvZiBs
b2FkaW5nIGFuIHVwZGF0ZS4KPiArICAgICAgICAgKi8KPiArICAgICAgICBpZiAoIHdhaXRfZm9y
X2NvbmRpdGlvbih3YWl0X2NwdV9jYWxsb3V0LAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICh2b2lkICopKHVuc2lnbmVkIGxvbmcpKGRvbmUgKyAxKSwKPiArICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBNSUNST0NPREVfVVBEQVRFX1RJTUVPVVRfVVMpICkKPiArICAg
ICAgICAgICAgcGFuaWMoIlRpbWVvdXQgd2hlbiBmaW5pc2hlZCB1cGRhdGluZyBtaWNyb2NvZGUg
KGZpbmlzaGVkICV1LyV1KSIsCj4gKyAgICAgICAgICAgICAgICAgIGRvbmUsIG5yX2NvcmVzKTsK
PiArCj4gKyAgICAgICAgLyogUHJpbnQgd2FybmluZyBtZXNzYWdlIG9uY2UgaWYgbG9uZyB0aW1l
IGlzIHNwZW50IGhlcmUgKi8KPiArICAgICAgICBpZiAoIHRpY2sgJiYgcmR0c2Nfb3JkZXJlZCgp
IC0gdGljayA+PSBjcHVfa2h6ICogMTAwMCApCj4gKyAgICAgICAgewo+ICsgICAgICAgICAgICBw
cmludGsoWEVOTE9HX1dBUk5JTkcKPiArICAgICAgICAgICAgICAgICAgICJXQVJOSU5HOiBVUERB
VElORyBNSUNST0NPREUgSEFTIENPTlNVTUVEIE1PUkUgVEhBTiAxIFNFQ09ORCFcbiIpOwo+ICsg
ICAgICAgICAgICB0aWNrID0gMDsKPiArICAgICAgICB9Cj4gKyAgICAgICAgZG9uZSA9IGF0b21p
Y19yZWFkKCZjcHVfb3V0KTsKCi4uLiB0aGlzLCBieSBkb2luZyB0aGUgYXNzaWdubWVudCBpbnNp
ZGUgdGhlIHdoaWxlKCk/CgpKYW4KCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnBy
b2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94
ZW4tZGV2ZWw=

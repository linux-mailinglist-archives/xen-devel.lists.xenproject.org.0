Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id A715EAECCA
	for <lists+xen-devel@lfdr.de>; Tue, 10 Sep 2019 16:17:48 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i7guY-0005E9-6q; Tue, 10 Sep 2019 14:14:26 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=M1KC=XF=citrix.com=paul.durrant@srs-us1.protection.inumbo.net>)
 id 1i7guW-0005E4-Jl
 for xen-devel@lists.xenproject.org; Tue, 10 Sep 2019 14:14:24 +0000
X-Inumbo-ID: 49d28fa6-d3d5-11e9-ac1f-12813bfff9fa
Received: from esa3.hc3370-68.iphmx.com (unknown [216.71.145.155])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 49d28fa6-d3d5-11e9-ac1f-12813bfff9fa;
 Tue, 10 Sep 2019 14:14:23 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=citrix.com; s=securemail; t=1568124864;
 h=from:to:cc:subject:date:message-id:references:
 in-reply-to:content-transfer-encoding:mime-version;
 bh=b2rRXPd3UHaFu78ZGgyR8IJsaw753fuwlDPpO6Vx8f8=;
 b=bYWEvM7fUETkK+59hnJ3tIOAB0BhxGuHvz15a1GjpRFjuBMS9Jw9uvyK
 gh/9q4YylpfSfSZ+/tjw0eKEwXRMA3/xTXwiMIbQRe1RzJGsbxnmaGEJX
 NIpITx3a8oDOQgGNaSfsQeYWDBYoqZnlhwT2LO0gA9akjp4+CWP19mez+ 4=;
Authentication-Results: esa3.hc3370-68.iphmx.com;
 dkim=none (message not signed) header.i=none;
 spf=None smtp.pra=Paul.Durrant@citrix.com;
 spf=Pass smtp.mailfrom=Paul.Durrant@citrix.com;
 spf=None smtp.helo=postmaster@mail.citrix.com
Received-SPF: None (esa3.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 Paul.Durrant@citrix.com) identity=pra;
 client-ip=162.221.158.21; receiver=esa3.hc3370-68.iphmx.com;
 envelope-from="Paul.Durrant@citrix.com";
 x-sender="Paul.Durrant@citrix.com"; x-conformance=sidf_compatible
Received-SPF: Pass (esa3.hc3370-68.iphmx.com: domain of
 Paul.Durrant@citrix.com designates 162.221.158.21 as
 permitted sender) identity=mailfrom;
 client-ip=162.221.158.21; receiver=esa3.hc3370-68.iphmx.com;
 envelope-from="Paul.Durrant@citrix.com";
 x-sender="Paul.Durrant@citrix.com";
 x-conformance=sidf_compatible; x-record-type="v=spf1";
 x-record-text="v=spf1 ip4:209.167.231.154 ip4:178.63.86.133
 ip4:195.66.111.40/30 ip4:85.115.9.32/28 ip4:199.102.83.4
 ip4:192.28.146.160 ip4:192.28.146.107 ip4:216.52.6.88
 ip4:216.52.6.188 ip4:162.221.158.21 ip4:162.221.156.83 ~all"
Received-SPF: None (esa3.hc3370-68.iphmx.com: no sender
 authenticity information available from domain of
 postmaster@mail.citrix.com) identity=helo;
 client-ip=162.221.158.21; receiver=esa3.hc3370-68.iphmx.com;
 envelope-from="Paul.Durrant@citrix.com";
 x-sender="postmaster@mail.citrix.com";
 x-conformance=sidf_compatible
IronPort-SDR: 3FqZx9SxKQwxnzswuCDHACPbw0KUjKDuvAndvQRwNoOFd2T6YqQQgjrh8C+VN9x+cBMvuGrhZY
 TKaR5/hQjOEY5Hl4FDXUfZci5JskvArqIn0v/2PkNhaHV0WVafTZyFhDx39Q4KW3ntkSzjGMpu
 VXax3ZM2yhdi+7rcPGSBiUiGE0gAzwOWqxhdZ+2mR3xPRzgFby23+ywJ4g12q9E35clpnyIN7Y
 tXIJtVnMIdZ15TXlzqm2wE7S2Hvdt7CK2Bo3m/Ge256P9r+OvjM3u1WNXabgQ7N/q055O7poJt
 9Ew=
X-SBRS: 2.7
X-MesageID: 5379579
X-Ironport-Server: esa3.hc3370-68.iphmx.com
X-Remote-IP: 162.221.158.21
X-Policy: $RELAYED
X-IronPort-AV: E=Sophos;i="5.64,489,1559534400"; 
   d="scan'208";a="5379579"
From: Paul Durrant <Paul.Durrant@citrix.com>
To: Roger Pau Monne <roger.pau@citrix.com>, "xen-devel@lists.xenproject.org"
 <xen-devel@lists.xenproject.org>
Thread-Topic: [PATCH v2 11/11] ioreq: provide support for long-running
 operations...
Thread-Index: AQHVYnK/KijMoCgNHEes0cSGYodwUKck/Z4Q
Date: Tue, 10 Sep 2019 14:14:18 +0000
Message-ID: <eae52bcadc2e43f1926ab6447df113bd@AMSPEX02CL03.citrite.net>
References: <20190903161428.7159-1-roger.pau@citrix.com>
 <20190903161428.7159-12-roger.pau@citrix.com>
In-Reply-To: <20190903161428.7159-12-roger.pau@citrix.com>
Accept-Language: en-GB, en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-ms-exchange-transport-fromentityheader: Hosted
MIME-Version: 1.0
Subject: Re: [Xen-devel] [PATCH v2 11/11] ioreq: provide support for
 long-running operations...
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 Andrew Cooper <Andrew.Cooper3@citrix.com>, "Tim
 \(Xen.org\)" <tim@xen.org>, George
 Dunlap <George.Dunlap@citrix.com>, Julien Grall <julien.grall@arm.com>,
 Jan Beulich <jbeulich@suse.com>, Ian Jackson <Ian.Jackson@citrix.com>,
 Roger Pau Monne <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

PiAtLS0tLU9yaWdpbmFsIE1lc3NhZ2UtLS0tLQ0KPiBGcm9tOiBSb2dlciBQYXUgTW9ubmUgPHJv
Z2VyLnBhdUBjaXRyaXguY29tPg0KPiBTZW50OiAwMyBTZXB0ZW1iZXIgMjAxOSAxNzoxNA0KPiBU
bzogeGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnDQo+IENjOiBSb2dlciBQYXUgTW9ubmUg
PHJvZ2VyLnBhdUBjaXRyaXguY29tPjsgUGF1bCBEdXJyYW50IDxQYXVsLkR1cnJhbnRAY2l0cml4
LmNvbT47IEphbiBCZXVsaWNoDQo+IDxqYmV1bGljaEBzdXNlLmNvbT47IEFuZHJldyBDb29wZXIg
PEFuZHJldy5Db29wZXIzQGNpdHJpeC5jb20+OyBXZWkgTGl1IDx3bEB4ZW4ub3JnPjsgR2Vvcmdl
IER1bmxhcA0KPiA8R2VvcmdlLkR1bmxhcEBjaXRyaXguY29tPjsgSWFuIEphY2tzb24gPElhbi5K
YWNrc29uQGNpdHJpeC5jb20+OyBKdWxpZW4gR3JhbGwgPGp1bGllbi5ncmFsbEBhcm0uY29tPjsN
Cj4gS29ucmFkIFJ6ZXN6dXRlayBXaWxrIDxrb25yYWQud2lsa0BvcmFjbGUuY29tPjsgU3RlZmFu
byBTdGFiZWxsaW5pIDxzc3RhYmVsbGluaUBrZXJuZWwub3JnPjsgVGltDQo+IChYZW4ub3JnKSA8
dGltQHhlbi5vcmc+DQo+IFN1YmplY3Q6IFtQQVRDSCB2MiAxMS8xMV0gaW9yZXE6IHByb3ZpZGUg
c3VwcG9ydCBmb3IgbG9uZy1ydW5uaW5nIG9wZXJhdGlvbnMuLi4NCj4gDQo+IC4uLmFuZCBzd2l0
Y2ggdlBDSSB0byB1c2UgdGhpcyBpbmZyYXN0cnVjdHVyZSBmb3IgbG9uZyBydW5uaW5nDQo+IHBo
eXNtYXAgbW9kaWZpY2F0aW9uIG9wZXJhdGlvbnMuDQo+IA0KPiBUaGlzIGFsbG93cyB0byBnZXQg
cmlkIG9mIHRoZSB2UENJIHNwZWNpZmljIG1vZGlmaWNhdGlvbnMgZG9uZSB0bw0KPiBoYW5kbGVf
aHZtX2lvX2NvbXBsZXRpb24gYW5kIGFsbG93cyBnZW5lcmFsaXppbmcgdGhlIHN1cHBvcnQgZm9y
DQo+IGxvbmctcnVubmluZyBvcGVyYXRpb25zIHRvIG90aGVyIGludGVybmFsIGlvcmVxIHNlcnZl
cnMuIFN1Y2ggc3VwcG9ydA0KPiBpcyBpbXBsZW1lbnRlZCBhcyBhIHNwZWNpZmljIGhhbmRsZXIg
dGhhdCBjYW4gYmUgcmVnaXN0ZXJzIGJ5IGludGVybmFsDQo+IGlvcmVxIHNlcnZlcnMgYW5kIHRo
YXQgd2lsbCBiZSBjYWxsZWQgdG8gY2hlY2sgZm9yIHBlbmRpbmcgd29yay4NCj4gUmV0dXJuaW5n
IHRydWUgZnJvbSB0aGlzIGhhbmRsZXIgd2lsbCBwcmV2ZW50IHRoZSB2Y3B1IGZyb20gcnVubmlu
Zw0KPiB1bnRpbCB0aGUgaGFuZGxlciByZXR1cm5zIGZhbHNlLg0KPiANCj4gU2lnbmVkLW9mZi1i
eTogUm9nZXIgUGF1IE1vbm7DqSA8cm9nZXIucGF1QGNpdHJpeC5jb20+DQo+IC0tLQ0KPiAgeGVu
L2FyY2gveDg2L2h2bS9pb3JlcS5jICAgICAgIHwgNTUgKysrKysrKysrKysrKysrKysrKysrKysr
Ky0tLS0tDQo+ICB4ZW4vZHJpdmVycy92cGNpL2hlYWRlci5jICAgICAgfCA2MSArKysrKysrKysr
KysrKysrKystLS0tLS0tLS0tLS0tLS0tDQo+ICB4ZW4vZHJpdmVycy92cGNpL3ZwY2kuYyAgICAg
ICAgfCAgOCArKysrLQ0KPiAgeGVuL2luY2x1ZGUvYXNtLXg4Ni9odm0vdmNwdS5oIHwgIDMgKy0N
Cj4gIHhlbi9pbmNsdWRlL3hlbi92cGNpLmggICAgICAgICB8ICA2IC0tLS0NCj4gIDUgZmlsZXMg
Y2hhbmdlZCwgODkgaW5zZXJ0aW9ucygrKSwgNDQgZGVsZXRpb25zKC0pDQo+IA0KPiBkaWZmIC0t
Z2l0IGEveGVuL2FyY2gveDg2L2h2bS9pb3JlcS5jIGIveGVuL2FyY2gveDg2L2h2bS9pb3JlcS5j
DQo+IGluZGV4IDMzYzU2Yjg4MGMuLmNhYTUzZGZhODQgMTAwNjQ0DQo+IC0tLSBhL3hlbi9hcmNo
L3g4Ni9odm0vaW9yZXEuYw0KPiArKysgYi94ZW4vYXJjaC94ODYvaHZtL2lvcmVxLmMNCj4gQEAg
LTIzOSwxNiArMjM5LDQ4IEBAIGJvb2wgaGFuZGxlX2h2bV9pb19jb21wbGV0aW9uKHN0cnVjdCB2
Y3B1ICp2KQ0KPiAgICAgIGVudW0gaHZtX2lvX2NvbXBsZXRpb24gaW9fY29tcGxldGlvbjsNCj4g
ICAgICB1bnNpZ25lZCBpbnQgaWQ7DQo+IA0KPiAtICAgIGlmICggaGFzX3ZwY2koZCkgJiYgdnBj
aV9wcm9jZXNzX3BlbmRpbmcodikgKQ0KPiAtICAgIHsNCj4gLSAgICAgICAgcmFpc2Vfc29mdGly
cShTQ0hFRFVMRV9TT0ZUSVJRKTsNCj4gLSAgICAgICAgcmV0dXJuIGZhbHNlOw0KPiAtICAgIH0N
Cj4gLQ0KPiAtICAgIEZPUl9FQUNIX0VYVEVSTkFMX0lPUkVRX1NFUlZFUihkLCBpZCwgcykNCj4g
KyAgICBGT1JfRUFDSF9JT1JFUV9TRVJWRVIoZCwgaWQsIHMpDQo+ICAgICAgew0KPiAgICAgICAg
ICBzdHJ1Y3QgaHZtX2lvcmVxX3ZjcHUgKnN2Ow0KPiANCj4gKyAgICAgICAgaWYgKCBodm1faW9y
ZXFfaXNfaW50ZXJuYWwoaWQpICkNCj4gKyAgICAgICAgew0KDQpJIHdvbmRlciB3aGV0aGVyIGl0
IHdvdWxkIGJlIG5lYXRlciBieSBzYXlpbmc6DQoNCiAgICAgICAgICAgaWYgKCAhaHZtX2lvcmVx
X2lzX2ludGVybmFsKGlkKSApDQogICAgICAgICAgICAgICBjb250aW51ZTsNCg0KaGVyZSB0byBh
dm9pZCB0aGUgaW5kZW50YXRpb24gYmVsb3cuDQoNCj4gKyAgICAgICAgICAgIGlmICggdmlvLT5p
b19yZXEuc3RhdGUgPT0gU1RBVEVfSU9SRVFfSU5QUk9DRVNTICkNCj4gKyAgICAgICAgICAgIHsN
Cj4gKyAgICAgICAgICAgICAgICBpb3JlcV90IHJlcSA9IHZpby0+aW9fcmVxOw0KPiArDQo+ICsg
ICAgICAgICAgICAgICAgLyoNCj4gKyAgICAgICAgICAgICAgICAgKiBDaGVjayBhbmQgY29udmVy
dCB0aGUgUElPL01NSU8gaW9yZXEgdG8gYSBQQ0kgY29uZmlnIHNwYWNlDQo+ICsgICAgICAgICAg
ICAgICAgICogYWNjZXNzLg0KPiArICAgICAgICAgICAgICAgICAqLw0KPiArICAgICAgICAgICAg
ICAgIGNvbnZlcnRfcGNpX2lvcmVxKGQsICZyZXEpOw0KPiArDQo+ICsgICAgICAgICAgICAgICAg
aWYgKCBzLT5oYW5kbGVyKHYsICZyZXEsIHMtPmRhdGEpID09IFg4NkVNVUxfUkVUUlkgKQ0KPiAr
ICAgICAgICAgICAgICAgIHsNCj4gKyAgICAgICAgICAgICAgICAgICAgLyoNCj4gKyAgICAgICAg
ICAgICAgICAgICAgICogTmVlZCB0byByYWlzZSBhIHNjaGVkdWxlciBpcnEgaW4gb3JkZXIgdG8g
cHJldmVudCB0aGUNCj4gKyAgICAgICAgICAgICAgICAgICAgICogZ3Vlc3QgdmNwdSBmcm9tIHJl
c3VtaW5nIGV4ZWN1dGlvbi4NCj4gKyAgICAgICAgICAgICAgICAgICAgICoNCj4gKyAgICAgICAg
ICAgICAgICAgICAgICogTm90ZSB0aGlzIGlzIG5vdCByZXF1aXJlZCBmb3IgZXh0ZXJuYWwgaW9y
ZXEgb3BlcmF0aW9ucw0KPiArICAgICAgICAgICAgICAgICAgICAgKiBiZWNhdXNlIGluIHRoYXQg
Y2FzZSB0aGUgdmNwdSBpcyBtYXJrZWQgYXMgYmxvY2tlZCwgYnV0DQo+ICsgICAgICAgICAgICAg
ICAgICAgICAqIHRoaXMgY2Fubm90IGJlIGRvbmUgZm9yIGxvbmctcnVubmluZyBpbnRlcm5hbA0K
PiArICAgICAgICAgICAgICAgICAgICAgKiBvcGVyYXRpb25zLCBzaW5jZSBpdCB3b3VsZCBwcmV2
ZW50IHRoZSB2Y3B1IGZyb20gYmVpbmcNCj4gKyAgICAgICAgICAgICAgICAgICAgICogc2NoZWR1
bGVkIGFuZCB0aHVzIHRoZSBsb25nIHJ1bm5pbmcgb3BlcmF0aW9uIGZyb20NCj4gKyAgICAgICAg
ICAgICAgICAgICAgICogZmluaXNoaW5nLg0KPiArICAgICAgICAgICAgICAgICAgICAgKi8NCj4g
KyAgICAgICAgICAgICAgICAgICAgcmFpc2Vfc29mdGlycShTQ0hFRFVMRV9TT0ZUSVJRKTsNCj4g
KyAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KPiArICAgICAgICAgICAgICAgIH0N
Cj4gKw0KPiArICAgICAgICAgICAgICAgIC8qIEZpbmlzaGVkIHByb2Nlc3NpbmcgdGhlIGlvcmVx
LiAqLw0KPiArICAgICAgICAgICAgICAgIGlmICggaHZtX2lvcmVxX25lZWRzX2NvbXBsZXRpb24o
JnZpby0+aW9fcmVxKSApDQo+ICsgICAgICAgICAgICAgICAgICAgIHZpby0+aW9fcmVxLnN0YXRl
ID0gU1RBVEVfSU9SRVNQX1JFQURZOw0KPiArICAgICAgICAgICAgICAgIGVsc2UNCj4gKyAgICAg
ICAgICAgICAgICAgICAgdmlvLT5pb19yZXEuc3RhdGUgPSBTVEFURV9JT1JFUV9OT05FOw0KDQpJ
TU8gdGhlIGFib3ZlIGlzIGFsc28gbmVhdGVyIGFzOg0KDQogICAgdmlvLT5pb19yZXEuc3RhdGUg
PSBodm1faW9yZXFfbmVlZHNfY29tcGxldGlvbigmdmlvLT5pb19yZXEpID8NCiAgICAgICAgICAg
ICAgICAgICAgICAgIFNUQVRFX0lPUkVTUF9SRUFEWSA6IFNUQVRFX0lPUkVRX05PTkU7DQoNCj4g
KyAgICAgICAgICAgIH0NCj4gKyAgICAgICAgICAgIGNvbnRpbnVlOw0KPiArICAgICAgICB9DQo+
ICsNCj4gICAgICAgICAgbGlzdF9mb3JfZWFjaF9lbnRyeSAoIHN2LA0KPiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgJnMtPmlvcmVxX3ZjcHVfbGlzdCwNCj4gICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGxpc3RfZW50cnkgKQ0KPiBAQCAtMTU4Miw3ICsxNjE0LDE0IEBAIGlu
dCBodm1fc2VuZF9pb3JlcShpb3NlcnZpZF90IGlkLCBpb3JlcV90ICpwcm90b19wLCBib29sIGJ1
ZmZlcmVkKQ0KPiAgICAgICAgICByZXR1cm4gaHZtX3NlbmRfYnVmZmVyZWRfaW9yZXEocywgcHJv
dG9fcCk7DQo+IA0KPiAgICAgIGlmICggaHZtX2lvcmVxX2lzX2ludGVybmFsKGlkKSApDQo+IC0g
ICAgICAgIHJldHVybiBzLT5oYW5kbGVyKGN1cnIsIHByb3RvX3AsIHMtPmRhdGEpOw0KPiArICAg
IHsNCj4gKyAgICAgICAgaW50IHJjID0gcy0+aGFuZGxlcihjdXJyLCBwcm90b19wLCBzLT5kYXRh
KTsNCj4gKw0KPiArICAgICAgICBpZiAoIHJjID09IFg4NkVNVUxfUkVUUlkgKQ0KPiArICAgICAg
ICAgICAgY3Vyci0+YXJjaC5odm0uaHZtX2lvLmlvX3JlcS5zdGF0ZSA9IFNUQVRFX0lPUkVRX0lO
UFJPQ0VTUzsNCj4gKw0KPiArICAgICAgICByZXR1cm4gcmM7DQo+ICsgICAgfQ0KPiANCj4gICAg
ICBpZiAoIHVubGlrZWx5KCF2Y3B1X3N0YXJ0X3NodXRkb3duX2RlZmVycmFsKGN1cnIpKSApDQo+
ICAgICAgICAgIHJldHVybiBYODZFTVVMX1JFVFJZOw0KPiBkaWZmIC0tZ2l0IGEveGVuL2RyaXZl
cnMvdnBjaS9oZWFkZXIuYyBiL3hlbi9kcml2ZXJzL3ZwY2kvaGVhZGVyLmMNCj4gaW5kZXggM2M3
OTRmNDg2ZC4uZjFjMWE2OTQ5MiAxMDA2NDQNCj4gLS0tIGEveGVuL2RyaXZlcnMvdnBjaS9oZWFk
ZXIuYw0KPiArKysgYi94ZW4vZHJpdmVycy92cGNpL2hlYWRlci5jDQo+IEBAIC0xMjksMzcgKzEy
OSw0MiBAQCBzdGF0aWMgdm9pZCBtb2RpZnlfZGVjb2RpbmcoY29uc3Qgc3RydWN0IHBjaV9kZXYg
KnBkZXYsIHVpbnQxNl90IGNtZCwNCj4gDQo+ICBib29sIHZwY2lfcHJvY2Vzc19wZW5kaW5nKHN0
cnVjdCB2Y3B1ICp2KQ0KPiAgew0KPiAtICAgIGlmICggdi0+dnBjaS5tZW0gKQ0KPiArICAgIHN0
cnVjdCBtYXBfZGF0YSBkYXRhID0gew0KPiArICAgICAgICAuZCA9IHYtPmRvbWFpbiwNCj4gKyAg
ICAgICAgLm1hcCA9IHYtPnZwY2kuY21kICYgUENJX0NPTU1BTkRfTUVNT1JZLA0KPiArICAgIH07
DQo+ICsgICAgaW50IHJjOw0KPiArDQo+ICsgICAgaWYgKCAhdi0+dnBjaS5tZW0gKQ0KPiAgICAg
IHsNCj4gLSAgICAgICAgc3RydWN0IG1hcF9kYXRhIGRhdGEgPSB7DQo+IC0gICAgICAgICAgICAu
ZCA9IHYtPmRvbWFpbiwNCj4gLSAgICAgICAgICAgIC5tYXAgPSB2LT52cGNpLmNtZCAmIFBDSV9D
T01NQU5EX01FTU9SWSwNCj4gLSAgICAgICAgfTsNCj4gLSAgICAgICAgaW50IHJjID0gcmFuZ2Vz
ZXRfY29uc3VtZV9yYW5nZXModi0+dnBjaS5tZW0sIG1hcF9yYW5nZSwgJmRhdGEpOw0KPiAtDQo+
IC0gICAgICAgIGlmICggcmMgPT0gLUVSRVNUQVJUICkNCj4gLSAgICAgICAgICAgIHJldHVybiB0
cnVlOw0KPiAtDQo+IC0gICAgICAgIHNwaW5fbG9jaygmdi0+dnBjaS5wZGV2LT52cGNpLT5sb2Nr
KTsNCj4gLSAgICAgICAgLyogRGlzYWJsZSBtZW1vcnkgZGVjb2RpbmcgdW5jb25kaXRpb25hbGx5
IG9uIGZhaWx1cmUuICovDQo+IC0gICAgICAgIG1vZGlmeV9kZWNvZGluZyh2LT52cGNpLnBkZXYs
DQo+IC0gICAgICAgICAgICAgICAgICAgICAgICByYyA/IHYtPnZwY2kuY21kICYgflBDSV9DT01N
QU5EX01FTU9SWSA6IHYtPnZwY2kuY21kLA0KPiAtICAgICAgICAgICAgICAgICAgICAgICAgIXJj
ICYmIHYtPnZwY2kucm9tX29ubHkpOw0KPiAtICAgICAgICBzcGluX3VubG9jaygmdi0+dnBjaS5w
ZGV2LT52cGNpLT5sb2NrKTsNCj4gLQ0KPiAtICAgICAgICByYW5nZXNldF9kZXN0cm95KHYtPnZw
Y2kubWVtKTsNCj4gLSAgICAgICAgdi0+dnBjaS5tZW0gPSBOVUxMOw0KPiAtICAgICAgICBpZiAo
IHJjICkNCj4gLSAgICAgICAgICAgIC8qDQo+IC0gICAgICAgICAgICAgKiBGSVhNRTogaW4gY2Fz
ZSBvZiBmYWlsdXJlIHJlbW92ZSB0aGUgZGV2aWNlIGZyb20gdGhlIGRvbWFpbi4NCj4gLSAgICAg
ICAgICAgICAqIE5vdGUgdGhhdCB0aGVyZSBtaWdodCBzdGlsbCBiZSBsZWZ0b3ZlciBtYXBwaW5n
cy4gV2hpbGUgdGhpcyBpcw0KPiAtICAgICAgICAgICAgICogc2FmZSBmb3IgRG9tMCwgZm9yIERv
bVVzIHRoZSBkb21haW4gd2lsbCBsaWtlbHkgbmVlZCB0byBiZQ0KPiAtICAgICAgICAgICAgICog
a2lsbGVkIGluIG9yZGVyIHRvIGF2b2lkIGxlYWtpbmcgc3RhbGUgcDJtIG1hcHBpbmdzIG9uDQo+
IC0gICAgICAgICAgICAgKiBmYWlsdXJlLg0KPiAtICAgICAgICAgICAgICovDQo+IC0gICAgICAg
ICAgICB2cGNpX3JlbW92ZV9kZXZpY2Uodi0+dnBjaS5wZGV2KTsNCj4gKyAgICAgICAgQVNTRVJU
X1VOUkVBQ0hBQkxFKCk7DQo+ICsgICAgICAgIHJldHVybiBmYWxzZTsNCj4gICAgICB9DQo+IA0K
PiArICAgIHJjID0gcmFuZ2VzZXRfY29uc3VtZV9yYW5nZXModi0+dnBjaS5tZW0sIG1hcF9yYW5n
ZSwgJmRhdGEpOw0KPiArDQoNCkV4dHJhbmVvdXMgYmxhbmsgbGluZT8NCg0KICBQYXVsDQoNCj4g
KyAgICBpZiAoIHJjID09IC1FUkVTVEFSVCApDQo+ICsgICAgICAgIHJldHVybiB0cnVlOw0KPiAr
DQo+ICsgICAgc3Bpbl9sb2NrKCZ2LT52cGNpLnBkZXYtPnZwY2ktPmxvY2spOw0KPiArICAgIC8q
IERpc2FibGUgbWVtb3J5IGRlY29kaW5nIHVuY29uZGl0aW9uYWxseSBvbiBmYWlsdXJlLiAqLw0K
PiArICAgIG1vZGlmeV9kZWNvZGluZyh2LT52cGNpLnBkZXYsDQo+ICsgICAgICAgICAgICAgICAg
ICAgIHJjID8gdi0+dnBjaS5jbWQgJiB+UENJX0NPTU1BTkRfTUVNT1JZIDogdi0+dnBjaS5jbWQs
DQo+ICsgICAgICAgICAgICAgICAgICAgICFyYyAmJiB2LT52cGNpLnJvbV9vbmx5KTsNCj4gKyAg
ICBzcGluX3VubG9jaygmdi0+dnBjaS5wZGV2LT52cGNpLT5sb2NrKTsNCj4gKw0KPiArICAgIHJh
bmdlc2V0X2Rlc3Ryb3kodi0+dnBjaS5tZW0pOw0KPiArICAgIHYtPnZwY2kubWVtID0gTlVMTDsN
Cj4gKyAgICBpZiAoIHJjICkNCj4gKyAgICAgICAgLyoNCj4gKyAgICAgICAgICogRklYTUU6IGlu
IGNhc2Ugb2YgZmFpbHVyZSByZW1vdmUgdGhlIGRldmljZSBmcm9tIHRoZSBkb21haW4uDQo+ICsg
ICAgICAgICAqIE5vdGUgdGhhdCB0aGVyZSBtaWdodCBzdGlsbCBiZSBsZWZ0b3ZlciBtYXBwaW5n
cy4gV2hpbGUgdGhpcyBpcw0KPiArICAgICAgICAgKiBzYWZlIGZvciBEb20wLCBmb3IgRG9tVXMg
dGhlIGRvbWFpbiB3aWxsIGxpa2VseSBuZWVkIHRvIGJlDQo+ICsgICAgICAgICAqIGtpbGxlZCBp
biBvcmRlciB0byBhdm9pZCBsZWFraW5nIHN0YWxlIHAybSBtYXBwaW5ncyBvbg0KPiArICAgICAg
ICAgKiBmYWlsdXJlLg0KPiArICAgICAgICAgKi8NCj4gKyAgICAgICAgdnBjaV9yZW1vdmVfZGV2
aWNlKHYtPnZwY2kucGRldik7DQo+ICsNCj4gICAgICByZXR1cm4gZmFsc2U7DQo+ICB9DQo+IA0K
PiBkaWZmIC0tZ2l0IGEveGVuL2RyaXZlcnMvdnBjaS92cGNpLmMgYi94ZW4vZHJpdmVycy92cGNp
L3ZwY2kuYw0KPiBpbmRleCA1NjY0MDIwYzJkLi42MDY5ZGZmNjEyIDEwMDY0NA0KPiAtLS0gYS94
ZW4vZHJpdmVycy92cGNpL3ZwY2kuYw0KPiArKysgYi94ZW4vZHJpdmVycy92cGNpL3ZwY2kuYw0K
PiBAQCAtNDk4LDYgKzQ5OCwxMiBAQCBzdGF0aWMgaW50IGlvcmVxX2hhbmRsZXIoc3RydWN0IHZj
cHUgKnYsIGlvcmVxX3QgKnJlcSwgdm9pZCAqZGF0YSkNCj4gICAgICAgICAgcmV0dXJuIFg4NkVN
VUxfVU5IQU5ETEVBQkxFOw0KPiAgICAgIH0NCj4gDQo+ICsgICAgaWYgKCB2LT52cGNpLm1lbSAp
DQo+ICsgICAgew0KPiArICAgICAgICBBU1NFUlQocmVxLT5zdGF0ZSA9PSBTVEFURV9JT1JFUV9J
TlBST0NFU1MpOw0KPiArICAgICAgICByZXR1cm4gdnBjaV9wcm9jZXNzX3BlbmRpbmcodikgPyBY
ODZFTVVMX1JFVFJZIDogWDg2RU1VTF9PS0FZOw0KPiArICAgIH0NCj4gKw0KPiAgICAgIHNiZGYu
c2JkZiA9IHJlcS0+YWRkciA+PiAzMjsNCj4gDQo+ICAgICAgaWYgKCByZXEtPmRpciApDQo+IEBA
IC01MDUsNyArNTExLDcgQEAgc3RhdGljIGludCBpb3JlcV9oYW5kbGVyKHN0cnVjdCB2Y3B1ICp2
LCBpb3JlcV90ICpyZXEsIHZvaWQgKmRhdGEpDQo+ICAgICAgZWxzZQ0KPiAgICAgICAgICB3cml0
ZShzYmRmLCByZXEtPmFkZHIsIHJlcS0+c2l6ZSwgcmVxLT5kYXRhKTsNCj4gDQo+IC0gICAgcmV0
dXJuIFg4NkVNVUxfT0tBWTsNCj4gKyAgICByZXR1cm4gdi0+dnBjaS5tZW0gPyBYODZFTVVMX1JF
VFJZIDogWDg2RU1VTF9PS0FZOw0KPiAgfQ0KPiANCj4gIGludCB2cGNpX3JlZ2lzdGVyX2lvcmVx
KHN0cnVjdCBkb21haW4gKmQpDQo+IGRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS9hc20teDg2L2h2
bS92Y3B1LmggYi94ZW4vaW5jbHVkZS9hc20teDg2L2h2bS92Y3B1LmgNCj4gaW5kZXggMzhmNWMy
YmI5Yi4uNDU2Mzc0NjQ2NiAxMDA2NDQNCj4gLS0tIGEveGVuL2luY2x1ZGUvYXNtLXg4Ni9odm0v
dmNwdS5oDQo+ICsrKyBiL3hlbi9pbmNsdWRlL2FzbS14ODYvaHZtL3ZjcHUuaA0KPiBAQCAtOTIs
NyArOTIsOCBAQCBzdHJ1Y3QgaHZtX3ZjcHVfaW8gew0KPiANCj4gIHN0YXRpYyBpbmxpbmUgYm9v
bCBodm1faW9yZXFfbmVlZHNfY29tcGxldGlvbihjb25zdCBpb3JlcV90ICppb3JlcSkNCj4gIHsN
Cj4gLSAgICByZXR1cm4gaW9yZXEtPnN0YXRlID09IFNUQVRFX0lPUkVRX1JFQURZICYmDQo+ICsg
ICAgcmV0dXJuIChpb3JlcS0+c3RhdGUgPT0gU1RBVEVfSU9SRVFfUkVBRFkgfHwNCj4gKyAgICAg
ICAgICAgIGlvcmVxLT5zdGF0ZSA9PSBTVEFURV9JT1JFUV9JTlBST0NFU1MpICYmDQo+ICAgICAg
ICAgICAgICFpb3JlcS0+ZGF0YV9pc19wdHIgJiYNCj4gICAgICAgICAgICAgKGlvcmVxLT50eXBl
ICE9IElPUkVRX1RZUEVfUElPIHx8IGlvcmVxLT5kaXIgIT0gSU9SRVFfV1JJVEUpOw0KPiAgfQ0K
PiBkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUveGVuL3ZwY2kuaCBiL3hlbi9pbmNsdWRlL3hlbi92
cGNpLmgNCj4gaW5kZXggMzZmNDM1ZWQ1Yi4uYTY1NDkxZTBjOSAxMDA2NDQNCj4gLS0tIGEveGVu
L2luY2x1ZGUveGVuL3ZwY2kuaA0KPiArKysgYi94ZW4vaW5jbHVkZS94ZW4vdnBjaS5oDQo+IEBA
IC0yMjUsMTIgKzIyNSw2IEBAIHN0YXRpYyBpbmxpbmUgaW50IHZwY2lfcmVnaXN0ZXJfaW9yZXEo
c3RydWN0IGRvbWFpbiAqZCkNCj4gIH0NCj4gDQo+ICBzdGF0aWMgaW5saW5lIHZvaWQgdnBjaV9k
dW1wX21zaSh2b2lkKSB7IH0NCj4gLQ0KPiAtc3RhdGljIGlubGluZSBib29sIHZwY2lfcHJvY2Vz
c19wZW5kaW5nKHN0cnVjdCB2Y3B1ICp2KQ0KPiAtew0KPiAtICAgIEFTU0VSVF9VTlJFQUNIQUJM
RSgpOw0KPiAtICAgIHJldHVybiBmYWxzZTsNCj4gLX0NCj4gICNlbmRpZg0KPiANCj4gICNlbmRp
Zg0KPiAtLQ0KPiAyLjIyLjANCg0KX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJv
amVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hl
bi1kZXZlbA==

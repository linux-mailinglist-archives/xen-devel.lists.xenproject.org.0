Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 05092150FC5
	for <lists+xen-devel@lfdr.de>; Mon,  3 Feb 2020 19:40:23 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iygap-0004Lf-O2; Mon, 03 Feb 2020 18:37:07 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=x5Gu=3X=amazon.com=prvs=2958b187c=hongyxia@srs-us1.protection.inumbo.net>)
 id 1iygao-0004LZ-0u
 for xen-devel@lists.xenproject.org; Mon, 03 Feb 2020 18:37:06 +0000
X-Inumbo-ID: 2cd0da82-46b4-11ea-ad98-bc764e2007e4
Received: from smtp-fw-6001.amazon.com (unknown [52.95.48.154])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 2cd0da82-46b4-11ea-ad98-bc764e2007e4;
 Mon, 03 Feb 2020 18:37:04 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amazon.com; i=@amazon.com; q=dns/txt; s=amazon201209;
 t=1580755025; x=1612291025;
 h=from:to:cc:subject:date:message-id:mime-version;
 bh=7VykSCMNoT2UpYDnSPCcLTLdMhXtz+qDbbbM8ejc7Mo=;
 b=Cfem+W2Wb/QB3ClmnoSQXRJY7qTn8ugSjcqFDJqoYziuiq+bnT40QzI5
 gbYLCtf+uyqN7UgtMlarQhlOEO2WqEtF2Iz68uAwkvBEvUPXZaoh+MLnd
 wetEJRYbiDHn5luZ8Ns0fa6PIJjttllwnhpwl44AAyptJ1o62WylnqjWW Q=;
IronPort-SDR: hAPqW7e8Lm/Q61KY1a7RD3yecUmt7cG6yAD92mmn0+XsmAGRR04hfSU8dy0TfXJMkcJHrkzU5j
 ypvlWFo8XTeA==
X-IronPort-AV: E=Sophos;i="5.70,398,1574121600"; d="scan'208";a="16008911"
Received: from iad12-co-svc-p1-lb1-vlan3.amazon.com (HELO
 email-inbound-relay-2c-4e7c8266.us-west-2.amazon.com) ([10.43.8.6])
 by smtp-border-fw-out-6001.iad6.amazon.com with ESMTP;
 03 Feb 2020 18:37:03 +0000
Received: from EX13MTAUEA002.ant.amazon.com
 (pdx4-ws-svc-p6-lb7-vlan2.pdx.amazon.com [10.170.41.162])
 by email-inbound-relay-2c-4e7c8266.us-west-2.amazon.com (Postfix) with ESMTPS
 id 3A531A26FB; Mon,  3 Feb 2020 18:37:02 +0000 (UTC)
Received: from EX13D37EUA004.ant.amazon.com (10.43.165.124) by
 EX13MTAUEA002.ant.amazon.com (10.43.61.77) with Microsoft SMTP Server (TLS)
 id 15.0.1236.3; Mon, 3 Feb 2020 18:37:01 +0000
Received: from EX13MTAUWA001.ant.amazon.com (10.43.160.58) by
 EX13D37EUA004.ant.amazon.com (10.43.165.124) with Microsoft SMTP Server (TLS)
 id 15.0.1367.3; Mon, 3 Feb 2020 18:37:00 +0000
Received: from u0b3720fa96e858.ant.amazon.com (10.125.106.133) by
 mail-relay.amazon.com (10.43.160.118) with Microsoft SMTP Server id
 15.0.1367.3 via Frontend Transport; Mon, 3 Feb 2020 18:36:58 +0000
From: Hongyan Xia <hongyxia@amazon.com>
To: <xen-devel@lists.xenproject.org>
Date: Mon, 3 Feb 2020 18:36:53 +0000
Message-ID: <45c03833059b0ce3f52c02693a2eb649356adf3e.1580755007.git.hongyxia@amazon.com>
X-Mailer: git-send-email 2.17.1
MIME-Version: 1.0
Precedence: Bulk
Subject: [Xen-devel] [PATCH] x86/domain_page: implement pure per-vCPU
 mapping infrastructure
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>, jgrall@amazon.com,
 Wei Liu <wl@xen.org>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

UmV3cml0ZSB0aGUgbWFwY2FjaGUgdG8gYmUgcHVyZWx5IHBlci12Q1BVIGluc3RlYWQgb2YgcGFy
dGx5IHBlci12Q1BVCmFuZCBwYXJ0bHkgcGVyLWRvbWFpbi4KClRoaXMgcGF0Y2ggaXMgbmVlZGVk
IHRvIGFkZHJlc3MgcGVyZm9ybWFuY2UgaXNzdWVzIHdoZW4gd2Ugc3RhcnQgcmVseWluZwpvbiB0
aGUgbWFwY2FjaGUsIGUuZy4sIHdoZW4gd2UgZG8gbm90IGhhdmUgYSBkaXJlY3QgbWFwLiBDdXJy
ZW50bHksIHRoZQpwZXItZG9tYWluIGxvY2sgb24gdGhlIG1hcGNhY2hlIGlzIGEgYm90dGxlbmVj
ayBmb3IgbXVsdGljb3JlLCBjYXVzaW5nCnBlcmZvcm1hbmNlIGRlZ3JhZGF0aW9uIGFuZCBldmVu
IGZ1bmN0aW9uYWwgcmVncmVzc2lvbnMuIFRoaXMgcGF0Y2gKbWFrZXMgdGhlIG1hcHBpbmcgc3Ry
dWN0dXJlIHBlci12Q1BVIGFuZCBjb21wbGV0ZWx5IGxvY2tsZXNzLgoKRnVuY3Rpb25hbCByZWdy
ZXNzaW9uOgoKV2hlbiBhIGRvbWFpbiBpcyBydW4gb24gbW9yZSB0aGFuIDY0IGNvcmVzLCBGcmVl
QlNEIDEwIHBhbmlja3MgZnJlcXVlbnRseQpkdWUgdG8gb2NjYXNpb25hbCBzaW11bHRhbmVvdXMg
c2V0X3NpbmdsZXNob3RfdGltZXIgaHlwZXJjYWxscyBmcm9tIHRvbwptYW55IGNvcmVzLiBTb21l
IGNvcmVzIHdpbGwgYmUgYmxvY2tlZCB3YWl0aW5nIG9uIG1hcF9kb21haW5fcGFnZSwKZXZlbnR1
YWxseSBmYWlsaW5nIHRvIHNldCBhIHRpbWVyIGluIHRoZSBmdXR1cmUuIEZyZWVCU0QgY2Fubm90
IGhhbmRsZQp0aGlzIGFuZCBwYW5pY2tzLiBUaGlzIHdhcyBmaXhlZCBpbiBsYXRlciBGcmVlQlNE
IHJlbGVhc2VzIGJ5IGhhbmRsaW5nCi1FVElNRSwgYnV0IHN0aWxsIHRoZSBkZWdyYWRhdGlvbiBp
biB0aW1lciBwZXJmb3JtYW5jZSBpcyBhIGJpZyBpc3N1ZS4KClBlcmZvcm1hbmNlIHJlZ3Jlc3Np
b246CgpNYW55IGJlbmNobWFya3Mgc2VlIGEgcGVyZm9ybWFuY2UgZHJvcCB3aGVuIGhhdmluZyBh
IGxhcmdlIGNvcmUgY291bnQuCkkgaGF2ZSBkb25lIGEgR2Vla2JlbmNoIG9uIGEgMzItdkNQVSBn
dWVzdC4KCnBlcmYgZHJvcCAgICAgb2xkICAgICAgICBuZXcKc2luZ2xlICAgICAgIDAuMDQlICAg
ICAgMC4xOCUKbXVsdGkgICAgICAgIDIuNDMlICAgICAgMC4wOCUKClJlbW92aW5nIHRoZSBwZXIt
ZG9tYWluIGxvY2sgaW4gdGhlIG1hcGNhY2hlIGJyaW5ncyB0aGUgbXVsdGktY29yZQpwZXJmb3Jt
YW5jZSBhbG1vc3QgaWRlbnRpY2FsIHRvIHVzaW5nIHRoZSBkaXJlY3QgbWFwIGZvciBtYXBwaW5n
cy4KClRoZXJlIHNob3VsZCBiZSByb29tIGZvciBmdXRoZXIgb3B0aW1pc2F0aW9ucywgYnV0IHRo
aXMgYWxyZWFkeQppbXByb3ZlcyBvdmVyIHRoZSBvbGQgbWFwY2FjaGUgYnkgYSBsb3QuCgpOb3Rl
IHRoYXQgZW50cmllcyBpbiB0aGUgbWFwaGFzaCB3aWxsIG9jY3VweSBpbnVzZSBzbG90cy4gV2l0
aCAxNiBzbG90cwpwZXIgdkNQVSBhbmQgYSBtYXBoYXNoIGNhcGFjaXR5IG9mIDgsIHdlIG9ubHkg
aGF2ZSBhbm90aGVyIDggYXZhaWxhYmxlLAp3aGljaCBpcyBub3QgZW5vdWdoIGZvciBuZXN0ZWQg
cGFnZSB0YWJsZSB3YWxrcy4gV2UgbmVlZCB0byBpbmNyZWFzZSB0aGUKbnVtYmVyIG9mIHNsb3Rz
IGluIGNvbmZpZy5oLgoKU2lnbmVkLW9mZi1ieTogSG9uZ3lhbiBYaWEgPGhvbmd5eGlhQGFtYXpv
bi5jb20+Ci0tLQogeGVuL2FyY2gveDg2L2RvbWFpbi5jICAgICAgICB8ICAgNSArLQogeGVuL2Fy
Y2gveDg2L2RvbWFpbl9wYWdlLmMgICB8IDIyOSArKysrKysrKysrKy0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLQogeGVuL2luY2x1ZGUvYXNtLXg4Ni9jb25maWcuaCB8ICAgMiArLQogeGVuL2luY2x1
ZGUvYXNtLXg4Ni9kb21haW4uaCB8ICAzMCArLS0tLQogNCBmaWxlcyBjaGFuZ2VkLCA4MCBpbnNl
cnRpb25zKCspLCAxODYgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L2Rv
bWFpbi5jIGIveGVuL2FyY2gveDg2L2RvbWFpbi5jCmluZGV4IGY1M2FlNWZmODYuLmEyNzhhYTQ2
NzggMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9kb21haW4uYworKysgYi94ZW4vYXJjaC94ODYv
ZG9tYWluLmMKQEAgLTQ0NSw2ICs0NDUsOSBAQCB2b2lkIGFyY2hfdmNwdV9kZXN0cm95KHN0cnVj
dCB2Y3B1ICp2KQogICAgIHhmcmVlKHYtPmFyY2gubXNycyk7CiAgICAgdi0+YXJjaC5tc3JzID0g
TlVMTDsKIAorICAgIHhmcmVlKHYtPmFyY2gucHYubWFwY2FjaGUpOworICAgIHYtPmFyY2gucHYu
bWFwY2FjaGUgPSBOVUxMOworCiAgICAgaWYgKCBpc19odm1fdmNwdSh2KSApCiAgICAgICAgIGh2
bV92Y3B1X2Rlc3Ryb3kodik7CiAgICAgZWxzZQpAQCAtNjMzLDggKzYzNiw2IEBAIGludCBhcmNo
X2RvbWFpbl9jcmVhdGUoc3RydWN0IGRvbWFpbiAqZCwKICAgICB9CiAgICAgZWxzZSBpZiAoIGlz
X3B2X2RvbWFpbihkKSApCiAgICAgewotICAgICAgICBtYXBjYWNoZV9kb21haW5faW5pdChkKTsK
LQogICAgICAgICBpZiAoIChyYyA9IHB2X2RvbWFpbl9pbml0aWFsaXNlKGQpKSAhPSAwICkKICAg
ICAgICAgICAgIGdvdG8gZmFpbDsKICAgICB9CmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvZG9t
YWluX3BhZ2UuYyBiL3hlbi9hcmNoL3g4Ni9kb21haW5fcGFnZS5jCmluZGV4IGRkMzI3MTJkMmYu
LjUyOTcxZDJlY2MgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9kb21haW5fcGFnZS5jCisrKyBi
L3hlbi9hcmNoL3g4Ni9kb21haW5fcGFnZS5jCkBAIC02OSwxMiArNjksMTEgQEAgdm9pZCBfX2lu
aXQgbWFwY2FjaGVfb3ZlcnJpZGVfY3VycmVudChzdHJ1Y3QgdmNwdSAqdikKIAogdm9pZCAqbWFw
X2RvbWFpbl9wYWdlKG1mbl90IG1mbikKIHsKLSAgICB1bnNpZ25lZCBsb25nIGZsYWdzOwotICAg
IHVuc2lnbmVkIGludCBpZHgsIGk7CisgICAgdW5zaWduZWQgbG9uZyBmbGFncywgKnBoYXNobWZu
OworICAgIHVuc2lnbmVkIGludCBpZHgsIGdsYl9pZHgsICpwaGFzaGlkeCwgb2hhc2hpZHg7CiAg
ICAgc3RydWN0IHZjcHUgKnY7Ci0gICAgc3RydWN0IG1hcGNhY2hlX2RvbWFpbiAqZGNhY2hlOwog
ICAgIHN0cnVjdCBtYXBjYWNoZV92Y3B1ICp2Y2FjaGU7Ci0gICAgc3RydWN0IHZjcHVfbWFwaGFz
aF9lbnRyeSAqaGFzaGVudDsKKyAgICB2b2lkICpyZXQ7CiAKICNpZmRlZiBOREVCVUcKICAgICBp
ZiAoIG1mbl94KG1mbikgPD0gUEZOX0RPV04oX19wYShIWVBFUlZJU09SX1ZJUlRfRU5EIC0gMSkp
ICkKQEAgLTgyLDEwNCArODEsNTkgQEAgdm9pZCAqbWFwX2RvbWFpbl9wYWdlKG1mbl90IG1mbikK
ICNlbmRpZgogCiAgICAgdiA9IG1hcGNhY2hlX2N1cnJlbnRfdmNwdSgpOwotICAgIGlmICggIXYg
fHwgIWlzX3B2X3ZjcHUodikgKQorICAgIGlmICggIXYgfHwgIWlzX3B2X3ZjcHUodikgfHwgIXYt
PmFyY2gucHYubWFwY2FjaGUgKQogICAgICAgICByZXR1cm4gbWZuX3RvX3ZpcnQobWZuX3gobWZu
KSk7CiAKLSAgICBkY2FjaGUgPSAmdi0+ZG9tYWluLT5hcmNoLnB2Lm1hcGNhY2hlOwotICAgIHZj
YWNoZSA9ICZ2LT5hcmNoLnB2Lm1hcGNhY2hlOwotICAgIGlmICggIWRjYWNoZS0+aW51c2UgKQot
ICAgICAgICByZXR1cm4gbWZuX3RvX3ZpcnQobWZuX3gobWZuKSk7CisgICAgdmNhY2hlID0gdi0+
YXJjaC5wdi5tYXBjYWNoZTsKKyAgICBwaGFzaG1mbiA9ICZ2Y2FjaGUtPmhhc2hfbWZuW01BUEhB
U0hfSEFTSEZOKG1mbl94KG1mbikpXTsKKyAgICBwaGFzaGlkeCA9ICZ2Y2FjaGUtPmhhc2hfaWR4
W01BUEhBU0hfSEFTSEZOKG1mbl94KG1mbikpXTsKIAogICAgIHBlcmZjX2luY3IobWFwX2RvbWFp
bl9wYWdlX2NvdW50KTsKIAogICAgIGxvY2FsX2lycV9zYXZlKGZsYWdzKTsKIAotICAgIGhhc2hl
bnQgPSAmdmNhY2hlLT5oYXNoW01BUEhBU0hfSEFTSEZOKG1mbl94KG1mbikpXTsKLSAgICBpZiAo
IGhhc2hlbnQtPm1mbiA9PSBtZm5feChtZm4pICkKKyAgICBvaGFzaGlkeCA9ICpwaGFzaGlkeDsK
KyAgICBpZiAoICpwaGFzaG1mbiAhPSBtZm5feChtZm4pICkKICAgICB7Ci0gICAgICAgIGlkeCA9
IGhhc2hlbnQtPmlkeDsKLSAgICAgICAgQVNTRVJUKGlkeCA8IGRjYWNoZS0+ZW50cmllcyk7Ci0g
ICAgICAgIGhhc2hlbnQtPnJlZmNudCsrOwotICAgICAgICBBU1NFUlQoaGFzaGVudC0+cmVmY250
KTsKLSAgICAgICAgQVNTRVJUKG1mbl9lcShsMWVfZ2V0X21mbihNQVBDQUNIRV9MMUVOVChpZHgp
KSwgbWZuKSk7Ci0gICAgICAgIGdvdG8gb3V0OwotICAgIH0KKyAgICAgICAgaWR4ID0gZmluZF9m
aXJzdF96ZXJvX2JpdCh2Y2FjaGUtPmludXNlLCBNQVBDQUNIRV9WQ1BVX0VOVFJJRVMpOworICAg
ICAgICBCVUdfT04oaWR4ID49IE1BUENBQ0hFX1ZDUFVfRU5UUklFUyk7CiAKLSAgICBzcGluX2xv
Y2soJmRjYWNoZS0+bG9jayk7CisgICAgICAgIEFTU0VSVCh2Y2FjaGUtPnJlZmNudFtpZHhdID09
IDApOworICAgICAgICBfX3NldF9iaXQoaWR4LCB2Y2FjaGUtPmludXNlKTsKIAotICAgIC8qIEhh
cyBzb21lIG90aGVyIENQVSBjYXVzZWQgYSB3cmFwPyBXZSBtdXN0IGZsdXNoIGlmIHNvLiAqLwot
ICAgIGlmICggdW5saWtlbHkoZGNhY2hlLT5lcG9jaCAhPSB2Y2FjaGUtPnNoYWRvd19lcG9jaCkg
KQotICAgIHsKLSAgICAgICAgdmNhY2hlLT5zaGFkb3dfZXBvY2ggPSBkY2FjaGUtPmVwb2NoOwot
ICAgICAgICBpZiAoIE5FRURfRkxVU0godGhpc19jcHUodGxiZmx1c2hfdGltZSksIGRjYWNoZS0+
dGxiZmx1c2hfdGltZXN0YW1wKSApCi0gICAgICAgIHsKLSAgICAgICAgICAgIHBlcmZjX2luY3Io
ZG9tYWluX3BhZ2VfdGxiX2ZsdXNoKTsKLSAgICAgICAgICAgIGZsdXNoX3RsYl9sb2NhbCgpOwot
ICAgICAgICB9Ci0gICAgfQorICAgICAgICBnbGJfaWR4ID0gaWR4ICsgdi0+dmNwdV9pZCAqIE1B
UENBQ0hFX1ZDUFVfRU5UUklFUzsKKyAgICAgICAgbDFlX3dyaXRlKCZNQVBDQUNIRV9MMUVOVChn
bGJfaWR4KSwKKyAgICAgICAgICAgICAgICAgIGwxZV9mcm9tX21mbihtZm4sIF9fUEFHRV9IWVBF
UlZJU09SX1JXKSk7CisgICAgICAgIHJldCA9ICh2b2lkICopTUFQQ0FDSEVfVklSVF9TVEFSVCAr
IHBmbl90b19wYWRkcihnbGJfaWR4KTsKKyAgICAgICAgZmx1c2hfdGxiX29uZV9sb2NhbChyZXQp
OworCisgICAgICAgIGlmICggb2hhc2hpZHggIT0gTUFQSEFTSEVOVF9OT1RJTlVTRSAmJiAhdmNh
Y2hlLT5yZWZjbnRbb2hhc2hpZHhdICkKKyAgICAgICAgICAgIF9fY2xlYXJfYml0KG9oYXNoaWR4
LCB2Y2FjaGUtPmludXNlKTsKIAotICAgIGlkeCA9IGZpbmRfbmV4dF96ZXJvX2JpdChkY2FjaGUt
PmludXNlLCBkY2FjaGUtPmVudHJpZXMsIGRjYWNoZS0+Y3Vyc29yKTsKLSAgICBpZiAoIHVubGlr
ZWx5KGlkeCA+PSBkY2FjaGUtPmVudHJpZXMpICkKKyAgICAgICAgKnBoYXNobWZuID0gbWZuX3go
bWZuKTsKKyAgICAgICAgKnBoYXNoaWR4ID0gaWR4OworICAgIH0KKyAgICBlbHNlCiAgICAgewot
ICAgICAgICB1bnNpZ25lZCBsb25nIGFjY3VtID0gMCwgcHJldiA9IDA7Ci0KLSAgICAgICAgLyog
L0ZpcnN0LywgY2xlYW4gdGhlIGdhcmJhZ2UgbWFwIGFuZCB1cGRhdGUgdGhlIGludXNlIGxpc3Qu
ICovCi0gICAgICAgIGZvciAoIGkgPSAwOyBpIDwgQklUU19UT19MT05HUyhkY2FjaGUtPmVudHJp
ZXMpOyBpKysgKQotICAgICAgICB7Ci0gICAgICAgICAgICBhY2N1bSB8PSBwcmV2OwotICAgICAg
ICAgICAgZGNhY2hlLT5pbnVzZVtpXSAmPSB+eGNoZygmZGNhY2hlLT5nYXJiYWdlW2ldLCAwKTsK
LSAgICAgICAgICAgIHByZXYgPSB+ZGNhY2hlLT5pbnVzZVtpXTsKLSAgICAgICAgfQotCi0gICAg
ICAgIGlmICggYWNjdW0gfCAocHJldiAmIEJJVE1BUF9MQVNUX1dPUkRfTUFTSyhkY2FjaGUtPmVu
dHJpZXMpKSApCi0gICAgICAgICAgICBpZHggPSBmaW5kX2ZpcnN0X3plcm9fYml0KGRjYWNoZS0+
aW51c2UsIGRjYWNoZS0+ZW50cmllcyk7Ci0gICAgICAgIGVsc2UKLSAgICAgICAgewotICAgICAg
ICAgICAgLyogUmVwbGFjZSBhIGhhc2ggZW50cnkgaW5zdGVhZC4gKi8KLSAgICAgICAgICAgIGkg
PSBNQVBIQVNIX0hBU0hGTihtZm5feChtZm4pKTsKLSAgICAgICAgICAgIGRvIHsKLSAgICAgICAg
ICAgICAgICBoYXNoZW50ID0gJnZjYWNoZS0+aGFzaFtpXTsKLSAgICAgICAgICAgICAgICBpZiAo
IGhhc2hlbnQtPmlkeCAhPSBNQVBIQVNIRU5UX05PVElOVVNFICYmICFoYXNoZW50LT5yZWZjbnQg
KQotICAgICAgICAgICAgICAgIHsKLSAgICAgICAgICAgICAgICAgICAgaWR4ID0gaGFzaGVudC0+
aWR4OwotICAgICAgICAgICAgICAgICAgICBBU1NFUlQobDFlX2dldF9wZm4oTUFQQ0FDSEVfTDFF
TlQoaWR4KSkgPT0gaGFzaGVudC0+bWZuKTsKLSAgICAgICAgICAgICAgICAgICAgbDFlX3dyaXRl
KCZNQVBDQUNIRV9MMUVOVChpZHgpLCBsMWVfZW1wdHkoKSk7Ci0gICAgICAgICAgICAgICAgICAg
IGhhc2hlbnQtPmlkeCA9IE1BUEhBU0hFTlRfTk9USU5VU0U7Ci0gICAgICAgICAgICAgICAgICAg
IGhhc2hlbnQtPm1mbiA9IH4wVUw7Ci0gICAgICAgICAgICAgICAgICAgIGJyZWFrOwotICAgICAg
ICAgICAgICAgIH0KLSAgICAgICAgICAgICAgICBpZiAoICsraSA9PSBNQVBIQVNIX0VOVFJJRVMg
KQotICAgICAgICAgICAgICAgICAgICBpID0gMDsKLSAgICAgICAgICAgIH0gd2hpbGUgKCBpICE9
IE1BUEhBU0hfSEFTSEZOKG1mbl94KG1mbikpICk7Ci0gICAgICAgIH0KLSAgICAgICAgQlVHX09O
KGlkeCA+PSBkY2FjaGUtPmVudHJpZXMpOwotCi0gICAgICAgIC8qIC9TZWNvbmQvLCBmbHVzaCBU
TEJzLiAqLwotICAgICAgICBwZXJmY19pbmNyKGRvbWFpbl9wYWdlX3RsYl9mbHVzaCk7Ci0gICAg
ICAgIGZsdXNoX3RsYl9sb2NhbCgpOwotICAgICAgICB2Y2FjaGUtPnNoYWRvd19lcG9jaCA9ICsr
ZGNhY2hlLT5lcG9jaDsKLSAgICAgICAgZGNhY2hlLT50bGJmbHVzaF90aW1lc3RhbXAgPSB0bGJm
bHVzaF9jdXJyZW50X3RpbWUoKTsKKyAgICAgICAgaWR4ID0gb2hhc2hpZHg7CisgICAgICAgIGds
Yl9pZHggPSBpZHggKyB2LT52Y3B1X2lkICogTUFQQ0FDSEVfVkNQVV9FTlRSSUVTOworICAgICAg
ICByZXQgPSAodm9pZCAqKU1BUENBQ0hFX1ZJUlRfU1RBUlQgKyBwZm5fdG9fcGFkZHIoZ2xiX2lk
eCk7CiAgICAgfQogCi0gICAgc2V0X2JpdChpZHgsIGRjYWNoZS0+aW51c2UpOwotICAgIGRjYWNo
ZS0+Y3Vyc29yID0gaWR4ICsgMTsKLQotICAgIHNwaW5fdW5sb2NrKCZkY2FjaGUtPmxvY2spOwot
Ci0gICAgbDFlX3dyaXRlKCZNQVBDQUNIRV9MMUVOVChpZHgpLCBsMWVfZnJvbV9tZm4obWZuLCBf
X1BBR0VfSFlQRVJWSVNPUl9SVykpOworICAgIHZjYWNoZS0+cmVmY250W2lkeF0rKzsKKyAgICBB
U1NFUlQodmNhY2hlLT5yZWZjbnRbaWR4XSk7CisgICAgQVNTRVJUKGwxZV9nZXRfcGZuKE1BUENB
Q0hFX0wxRU5UKGdsYl9pZHgpKSA9PSBtZm5feChtZm4pKTsKIAotIG91dDoKICAgICBsb2NhbF9p
cnFfcmVzdG9yZShmbGFncyk7Ci0gICAgcmV0dXJuICh2b2lkICopTUFQQ0FDSEVfVklSVF9TVEFS
VCArIHBmbl90b19wYWRkcihpZHgpOworICAgIHJldHVybiByZXQ7CiB9CiAKIHZvaWQgdW5tYXBf
ZG9tYWluX3BhZ2UoY29uc3Qgdm9pZCAqcHRyKQogewotICAgIHVuc2lnbmVkIGludCBpZHg7Cisg
ICAgdW5zaWduZWQgaW50IGlkeCwgZ2xiX2lkeDsKICAgICBzdHJ1Y3QgdmNwdSAqdjsKLSAgICBz
dHJ1Y3QgbWFwY2FjaGVfZG9tYWluICpkY2FjaGU7Ci0gICAgdW5zaWduZWQgbG9uZyB2YSA9ICh1
bnNpZ25lZCBsb25nKXB0ciwgbWZuLCBmbGFnczsKLSAgICBzdHJ1Y3QgdmNwdV9tYXBoYXNoX2Vu
dHJ5ICpoYXNoZW50OworICAgIHN0cnVjdCBtYXBjYWNoZV92Y3B1ICp2Y2FjaGU7CisgICAgdW5z
aWduZWQgbG9uZyB2YSA9ICh1bnNpZ25lZCBsb25nKXB0ciwgbWZuLCBoYXNobWZuLCBmbGFnczsK
IAogICAgIGlmICggdmEgPj0gRElSRUNUTUFQX1ZJUlRfU1RBUlQgKQogICAgICAgICByZXR1cm47
CkBAIC0xODksNzMgKzE0MywyMSBAQCB2b2lkIHVubWFwX2RvbWFpbl9wYWdlKGNvbnN0IHZvaWQg
KnB0cikKICAgICB2ID0gbWFwY2FjaGVfY3VycmVudF92Y3B1KCk7CiAgICAgQVNTRVJUKHYgJiYg
aXNfcHZfdmNwdSh2KSk7CiAKLSAgICBkY2FjaGUgPSAmdi0+ZG9tYWluLT5hcmNoLnB2Lm1hcGNh
Y2hlOwotICAgIEFTU0VSVChkY2FjaGUtPmludXNlKTsKLQotICAgIGlkeCA9IFBGTl9ET1dOKHZh
IC0gTUFQQ0FDSEVfVklSVF9TVEFSVCk7Ci0gICAgbWZuID0gbDFlX2dldF9wZm4oTUFQQ0FDSEVf
TDFFTlQoaWR4KSk7Ci0gICAgaGFzaGVudCA9ICZ2LT5hcmNoLnB2Lm1hcGNhY2hlLmhhc2hbTUFQ
SEFTSF9IQVNIRk4obWZuKV07CisgICAgdmNhY2hlID0gdi0+YXJjaC5wdi5tYXBjYWNoZTsKKyAg
ICBBU1NFUlQodmNhY2hlKTsKIAorICAgIGdsYl9pZHggPSBQRk5fRE9XTih2YSAtIE1BUENBQ0hF
X1ZJUlRfU1RBUlQpOworICAgIGlkeCA9IGdsYl9pZHggLSB2LT52Y3B1X2lkICogTUFQQ0FDSEVf
VkNQVV9FTlRSSUVTOwogICAgIGxvY2FsX2lycV9zYXZlKGZsYWdzKTsKIAotICAgIGlmICggaGFz
aGVudC0+aWR4ID09IGlkeCApCi0gICAgewotICAgICAgICBBU1NFUlQoaGFzaGVudC0+bWZuID09
IG1mbik7Ci0gICAgICAgIEFTU0VSVChoYXNoZW50LT5yZWZjbnQpOwotICAgICAgICBoYXNoZW50
LT5yZWZjbnQtLTsKLSAgICB9Ci0gICAgZWxzZSBpZiAoICFoYXNoZW50LT5yZWZjbnQgKQotICAg
IHsKLSAgICAgICAgaWYgKCBoYXNoZW50LT5pZHggIT0gTUFQSEFTSEVOVF9OT1RJTlVTRSApCi0g
ICAgICAgIHsKLSAgICAgICAgICAgIC8qIC9GaXJzdC8sIHphcCB0aGUgUFRFLiAqLwotICAgICAg
ICAgICAgQVNTRVJUKGwxZV9nZXRfcGZuKE1BUENBQ0hFX0wxRU5UKGhhc2hlbnQtPmlkeCkpID09
Ci0gICAgICAgICAgICAgICAgICAgaGFzaGVudC0+bWZuKTsKLSAgICAgICAgICAgIGwxZV93cml0
ZSgmTUFQQ0FDSEVfTDFFTlQoaGFzaGVudC0+aWR4KSwgbDFlX2VtcHR5KCkpOwotICAgICAgICAg
ICAgLyogL1NlY29uZC8sIG1hcmsgYXMgZ2FyYmFnZS4gKi8KLSAgICAgICAgICAgIHNldF9iaXQo
aGFzaGVudC0+aWR4LCBkY2FjaGUtPmdhcmJhZ2UpOwotICAgICAgICB9Ci0KLSAgICAgICAgLyog
QWRkIG5ld2x5LWZyZWVkIG1hcHBpbmcgdG8gdGhlIG1hcGhhc2guICovCi0gICAgICAgIGhhc2hl
bnQtPm1mbiA9IG1mbjsKLSAgICAgICAgaGFzaGVudC0+aWR4ID0gaWR4OwotICAgIH0KLSAgICBl
bHNlCi0gICAgewotICAgICAgICAvKiAvRmlyc3QvLCB6YXAgdGhlIFBURS4gKi8KLSAgICAgICAg
bDFlX3dyaXRlKCZNQVBDQUNIRV9MMUVOVChpZHgpLCBsMWVfZW1wdHkoKSk7Ci0gICAgICAgIC8q
IC9TZWNvbmQvLCBtYXJrIGFzIGdhcmJhZ2UuICovCi0gICAgICAgIHNldF9iaXQoaWR4LCBkY2Fj
aGUtPmdhcmJhZ2UpOwotICAgIH0KLQotICAgIGxvY2FsX2lycV9yZXN0b3JlKGZsYWdzKTsKLX0K
LQotaW50IG1hcGNhY2hlX2RvbWFpbl9pbml0KHN0cnVjdCBkb21haW4gKmQpCi17Ci0gICAgc3Ry
dWN0IG1hcGNhY2hlX2RvbWFpbiAqZGNhY2hlID0gJmQtPmFyY2gucHYubWFwY2FjaGU7Ci0gICAg
dW5zaWduZWQgaW50IGJpdG1hcF9wYWdlczsKKyAgICBtZm4gPSBsMWVfZ2V0X3BmbihNQVBDQUNI
RV9MMUVOVChnbGJfaWR4KSk7CisgICAgaGFzaG1mbiA9IHZjYWNoZS0+aGFzaF9tZm5bTUFQSEFT
SF9IQVNIRk4obWZuKV07CiAKLSAgICBBU1NFUlQoaXNfcHZfZG9tYWluKGQpKTsKKyAgICB2Y2Fj
aGUtPnJlZmNudFtpZHhdLS07CisgICAgaWYgKCBoYXNobWZuICE9IG1mbiAmJiAhdmNhY2hlLT5y
ZWZjbnRbaWR4XSApCisgICAgICAgIF9fY2xlYXJfYml0KGlkeCwgdmNhY2hlLT5pbnVzZSk7CiAK
LSNpZmRlZiBOREVCVUcKLSAgICBpZiAoICFtZW1faG90cGx1ZyAmJiBtYXhfcGFnZSA8PSBQRk5f
RE9XTihfX3BhKEhZUEVSVklTT1JfVklSVF9FTkQgLSAxKSkgKQotICAgICAgICByZXR1cm4gMDsK
LSNlbmRpZgotCi0gICAgQlVJTERfQlVHX09OKE1BUENBQ0hFX1ZJUlRfRU5EICsgUEFHRV9TSVpF
ICogKDMgKwotICAgICAgICAgICAgICAgICAyICogUEZOX1VQKEJJVFNfVE9fTE9OR1MoTUFQQ0FD
SEVfRU5UUklFUykgKiBzaXplb2YobG9uZykpKSA+Ci0gICAgICAgICAgICAgICAgIE1BUENBQ0hF
X1ZJUlRfU1RBUlQgKyAoUEVSRE9NQUlOX1NMT1RfTUJZVEVTIDw8IDIwKSk7Ci0gICAgYml0bWFw
X3BhZ2VzID0gUEZOX1VQKEJJVFNfVE9fTE9OR1MoTUFQQ0FDSEVfRU5UUklFUykgKiBzaXplb2Yo
bG9uZykpOwotICAgIGRjYWNoZS0+aW51c2UgPSAodm9pZCAqKU1BUENBQ0hFX1ZJUlRfRU5EICsg
UEFHRV9TSVpFOwotICAgIGRjYWNoZS0+Z2FyYmFnZSA9IGRjYWNoZS0+aW51c2UgKwotICAgICAg
ICAgICAgICAgICAgICAgIChiaXRtYXBfcGFnZXMgKyAxKSAqIFBBR0VfU0laRSAvIHNpemVvZihs
b25nKTsKLQotICAgIHNwaW5fbG9ja19pbml0KCZkY2FjaGUtPmxvY2spOwotCi0gICAgcmV0dXJu
IGNyZWF0ZV9wZXJkb21haW5fbWFwcGluZyhkLCAodW5zaWduZWQgbG9uZylkY2FjaGUtPmludXNl
LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMiAqIGJpdG1hcF9wYWdlcyAr
IDEsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOSUwobDFfcGdlbnRyeV90
ICopLCBOVUxMKTsKKyAgICBsb2NhbF9pcnFfcmVzdG9yZShmbGFncyk7CiB9CiAKIGludCBtYXBj
YWNoZV92Y3B1X2luaXQoc3RydWN0IHZjcHUgKnYpCkBAIC0yNjQsMzkgKzE2Niw0OCBAQCBpbnQg
bWFwY2FjaGVfdmNwdV9pbml0KHN0cnVjdCB2Y3B1ICp2KQogICAgIHN0cnVjdCBtYXBjYWNoZV9k
b21haW4gKmRjYWNoZSA9ICZkLT5hcmNoLnB2Lm1hcGNhY2hlOwogICAgIHVuc2lnbmVkIGxvbmcg
aTsKICAgICB1bnNpZ25lZCBpbnQgZW50cyA9IGQtPm1heF92Y3B1cyAqIE1BUENBQ0hFX1ZDUFVf
RU5UUklFUzsKLSAgICB1bnNpZ25lZCBpbnQgbnIgPSBQRk5fVVAoQklUU19UT19MT05HUyhlbnRz
KSAqIHNpemVvZihsb25nKSk7CiAKLSAgICBpZiAoICFpc19wdl92Y3B1KHYpIHx8ICFkY2FjaGUt
PmludXNlICkKKyAgICBpZiAoICFpc19wdl92Y3B1KHYpICkKICAgICAgICAgcmV0dXJuIDA7CiAK
KyAgICBCVUlMRF9CVUdfT04oTUFQQ0FDSEVfVklSVF9FTkQgPiBBUkdfWExBVF9WSVJUX1NUQVJU
KTsKKwogICAgIGlmICggZW50cyA+IGRjYWNoZS0+ZW50cmllcyApCiAgICAgeworICAgICAgICBp
bnQgcmM7CisKKyAgICAgICAgQVNTRVJUKGVudHMgKiBQQUdFX1NJWkUgPD0gKFBFUkRPTUFJTl9T
TE9UX01CWVRFUyA8PCAyMCkpOworCiAgICAgICAgIC8qIFBvcHVsYXRlIHBhZ2UgdGFibGVzLiAq
LwotICAgICAgICBpbnQgcmMgPSBjcmVhdGVfcGVyZG9tYWluX21hcHBpbmcoZCwgTUFQQ0FDSEVf
VklSVF9TVEFSVCwgZW50cywKKyAgICAgICAgcmMgPSBjcmVhdGVfcGVyZG9tYWluX21hcHBpbmco
ZCwgTUFQQ0FDSEVfVklSVF9TVEFSVCwgZW50cywKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIE5JTChsMV9wZ2VudHJ5X3QgKiksIE5VTEwpOwogCi0gICAgICAgIC8q
IFBvcHVsYXRlIGJpdCBtYXBzLiAqLwotICAgICAgICBpZiAoICFyYyApCi0gICAgICAgICAgICBy
YyA9IGNyZWF0ZV9wZXJkb21haW5fbWFwcGluZyhkLCAodW5zaWduZWQgbG9uZylkY2FjaGUtPmlu
dXNlLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnIsIE5VTEws
IE5JTChzdHJ1Y3QgcGFnZV9pbmZvICopKTsKLSAgICAgICAgaWYgKCAhcmMgKQotICAgICAgICAg
ICAgcmMgPSBjcmVhdGVfcGVyZG9tYWluX21hcHBpbmcoZCwgKHVuc2lnbmVkIGxvbmcpZGNhY2hl
LT5nYXJiYWdlLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnIs
IE5VTEwsIE5JTChzdHJ1Y3QgcGFnZV9pbmZvICopKTsKLQogICAgICAgICBpZiAoIHJjICkKICAg
ICAgICAgICAgIHJldHVybiByYzsKIAogICAgICAgICBkY2FjaGUtPmVudHJpZXMgPSBlbnRzOwog
ICAgIH0KIAotICAgIC8qIE1hcmsgYWxsIG1hcGhhc2ggZW50cmllcyBhcyBub3QgaW4gdXNlLiAq
LwogICAgIEJVSUxEX0JVR19PTihNQVBIQVNIRU5UX05PVElOVVNFIDwgTUFQQ0FDSEVfRU5UUklF
Uyk7CisgICAgLyogTUFQSEFTSF9FTlRSSUVTIGhhcyB0byBiZSBwb3dlci1vZi10d28gdG8gbWFr
ZSBoYXNoaW5nIHdvcmsuICovCisgICAgQlVJTERfQlVHX09OKE1BUEhBU0hfRU5UUklFUyAmIChN
QVBIQVNIX0VOVFJJRVMgLSAxKSk7CisgICAgLyoKKyAgICAgKiBTaW5jZSBlbnRyaWVzIGluIHRo
ZSBtYXBoYXNoIGFsc28gb2NjdXB5IGludXNlIHNsb3RzLCB3ZSBoYXZlIHRvIG1ha2UKKyAgICAg
KiBzdXJlIE1BUENBQ0hFX1ZDUFVfRU5UUklFUyBpcyBsYXJnZSBlbm91Z2ggdG8gYWNjb21tb2Rh
dGUgYm90aCB0aGUKKyAgICAgKiBtYXBoYXNoIGFuZCBhIG5lc3RlZCBwYWdlIHRhYmxlIHdhbGsu
CisgICAgICovCisgICAgQlVJTERfQlVHX09OKE1BUENBQ0hFX1ZDUFVfRU5UUklFUyAtIE1BUEhB
U0hfRU5UUklFUyA+PQorICAgICAgICAgICAgICAgICBDT05GSUdfUEFHSU5HX0xFVkVMUyAqIENP
TkZJR19QQUdJTkdfTEVWRUxTKTsKKworICAgIHYtPmFyY2gucHYubWFwY2FjaGUgPSB4emFsbG9j
KHN0cnVjdCBtYXBjYWNoZV92Y3B1KTsKKyAgICBpZiAoICF2LT5hcmNoLnB2Lm1hcGNhY2hlICkK
KyAgICAgICAgcmV0dXJuIC1FTk9NRU07CisKKyAgICAvKiBNYXJrIGFsbCBtYXBoYXNoIGVudHJp
ZXMgYXMgbm90IGluIHVzZS4gKi8KICAgICBmb3IgKCBpID0gMDsgaSA8IE1BUEhBU0hfRU5UUklF
UzsgaSsrICkKICAgICB7Ci0gICAgICAgIHN0cnVjdCB2Y3B1X21hcGhhc2hfZW50cnkgKmhhc2hl
bnQgPSAmdi0+YXJjaC5wdi5tYXBjYWNoZS5oYXNoW2ldOwotCi0gICAgICAgIGhhc2hlbnQtPm1m
biA9IH4wVUw7IC8qIG5ldmVyIHZhbGlkIHRvIG1hcCAqLwotICAgICAgICBoYXNoZW50LT5pZHgg
PSBNQVBIQVNIRU5UX05PVElOVVNFOworICAgICAgICB2LT5hcmNoLnB2Lm1hcGNhY2hlLT5oYXNo
X21mbltpXSA9IH4wVUw7CisgICAgICAgIHYtPmFyY2gucHYubWFwY2FjaGUtPmhhc2hfaWR4W2ld
ID0gTUFQSEFTSEVOVF9OT1RJTlVTRTsKICAgICB9CiAKICAgICByZXR1cm4gMDsKZGlmZiAtLWdp
dCBhL3hlbi9pbmNsdWRlL2FzbS14ODYvY29uZmlnLmggYi94ZW4vaW5jbHVkZS9hc20teDg2L2Nv
bmZpZy5oCmluZGV4IGQwY2ZiYjcwYTguLjRiMjIxNzE1MWIgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNs
dWRlL2FzbS14ODYvY29uZmlnLmgKKysrIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9jb25maWcuaApA
QCAtMjk2LDcgKzI5Niw3IEBAIGV4dGVybiB1bnNpZ25lZCBsb25nIHhlbl9waHlzX3N0YXJ0Owog
ICAgIChHRFRfVklSVF9TVEFSVCh2KSArICg2NCoxMDI0KSkKIAogLyogbWFwX2RvbWFpbl9wYWdl
KCkgbWFwIGNhY2hlLiBUaGUgc2Vjb25kIHBlci1kb21haW4tbWFwcGluZyBzdWItYXJlYS4gKi8K
LSNkZWZpbmUgTUFQQ0FDSEVfVkNQVV9FTlRSSUVTICAgIChDT05GSUdfUEFHSU5HX0xFVkVMUyAq
IENPTkZJR19QQUdJTkdfTEVWRUxTKQorI2RlZmluZSBNQVBDQUNIRV9WQ1BVX0VOVFJJRVMgICAg
MzIKICNkZWZpbmUgTUFQQ0FDSEVfRU5UUklFUyAgICAgICAgIChNQVhfVklSVF9DUFVTICogTUFQ
Q0FDSEVfVkNQVV9FTlRSSUVTKQogI2RlZmluZSBNQVBDQUNIRV9WSVJUX1NUQVJUICAgICAgUEVS
RE9NQUlOX1ZJUlRfU0xPVCgxKQogI2RlZmluZSBNQVBDQUNIRV9WSVJUX0VORCAgICAgICAgKE1B
UENBQ0hFX1ZJUlRfU1RBUlQgKyBcCmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS9hc20teDg2L2Rv
bWFpbi5oIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9kb21haW4uaAppbmRleCBhM2FlNWQ5YTIwLi4z
NjdiYmE3MTEwIDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS9hc20teDg2L2RvbWFpbi5oCisrKyBi
L3hlbi9pbmNsdWRlL2FzbS14ODYvZG9tYWluLmgKQEAgLTQwLDM1ICs0MCwxNyBAQCBzdHJ1Y3Qg
dHJhcF9ib3VuY2UgewogI2RlZmluZSBNQVBIQVNIX0hBU0hGTihwZm4pICgocGZuKSAmIChNQVBI
QVNIX0VOVFJJRVMtMSkpCiAjZGVmaW5lIE1BUEhBU0hFTlRfTk9USU5VU0UgKCh1MzIpfjBVKQog
c3RydWN0IG1hcGNhY2hlX3ZjcHUgewotICAgIC8qIFNoYWRvdyBvZiBtYXBjYWNoZV9kb21haW4u
ZXBvY2guICovCi0gICAgdW5zaWduZWQgaW50IHNoYWRvd19lcG9jaDsKLQotICAgIC8qIExvY2st
ZnJlZSBwZXItVkNQVSBoYXNoIG9mIHJlY2VudGx5LXVzZWQgbWFwcGluZ3MuICovCi0gICAgc3Ry
dWN0IHZjcHVfbWFwaGFzaF9lbnRyeSB7Ci0gICAgICAgIHVuc2lnbmVkIGxvbmcgbWZuOwotICAg
ICAgICB1aW50MzJfdCAgICAgIGlkeDsKLSAgICAgICAgdWludDMyX3QgICAgICByZWZjbnQ7Ci0g
ICAgfSBoYXNoW01BUEhBU0hfRU5UUklFU107CisgICAgdW5zaWduZWQgbG9uZyBoYXNoX21mbltN
QVBIQVNIX0VOVFJJRVNdOworICAgIHVpbnQzMl90IGhhc2hfaWR4W01BUEhBU0hfRU5UUklFU107
CisKKyAgICB1aW50OF90IHJlZmNudFtNQVBDQUNIRV9WQ1BVX0VOVFJJRVNdOworICAgIHVuc2ln
bmVkIGxvbmcgaW51c2VbQklUU19UT19MT05HUyhNQVBDQUNIRV9WQ1BVX0VOVFJJRVMpXTsKIH07
CiAKIHN0cnVjdCBtYXBjYWNoZV9kb21haW4gewotICAgIC8qIFRoZSBudW1iZXIgb2YgYXJyYXkg
ZW50cmllcywgYW5kIGEgY3Vyc29yIGludG8gdGhlIGFycmF5LiAqLwogICAgIHVuc2lnbmVkIGlu
dCBlbnRyaWVzOwotICAgIHVuc2lnbmVkIGludCBjdXJzb3I7Ci0KLSAgICAvKiBQcm90ZWN0cyBt
YXBfZG9tYWluX3BhZ2UoKS4gKi8KLSAgICBzcGlubG9ja190IGxvY2s7Ci0KLSAgICAvKiBHYXJi
YWdlIG1hcHBpbmdzIGFyZSBmbHVzaGVkIGZyb20gVExCcyBpbiBiYXRjaGVzIGNhbGxlZCAnZXBv
Y2hzJy4gKi8KLSAgICB1bnNpZ25lZCBpbnQgZXBvY2g7Ci0gICAgdTMyIHRsYmZsdXNoX3RpbWVz
dGFtcDsKLQotICAgIC8qIFdoaWNoIG1hcHBpbmdzIGFyZSBpbiB1c2UsIGFuZCB3aGljaCBhcmUg
Z2FyYmFnZSB0byByZWFwIG5leHQgZXBvY2g/ICovCi0gICAgdW5zaWduZWQgbG9uZyAqaW51c2U7
Ci0gICAgdW5zaWduZWQgbG9uZyAqZ2FyYmFnZTsKIH07CiAKLWludCBtYXBjYWNoZV9kb21haW5f
aW5pdChzdHJ1Y3QgZG9tYWluICopOwogaW50IG1hcGNhY2hlX3ZjcHVfaW5pdChzdHJ1Y3QgdmNw
dSAqKTsKIHZvaWQgbWFwY2FjaGVfb3ZlcnJpZGVfY3VycmVudChzdHJ1Y3QgdmNwdSAqKTsKIApA
QCAtNDczLDcgKzQ1NSw3IEBAIHN0cnVjdCBhcmNoX2RvbWFpbgogc3RydWN0IHB2X3ZjcHUKIHsK
ICAgICAvKiBtYXBfZG9tYWluX3BhZ2UoKSBtYXBwaW5nIGNhY2hlLiAqLwotICAgIHN0cnVjdCBt
YXBjYWNoZV92Y3B1IG1hcGNhY2hlOworICAgIHN0cnVjdCBtYXBjYWNoZV92Y3B1ICptYXBjYWNo
ZTsKIAogICAgIHVuc2lnbmVkIGludCB2Z2NfZmxhZ3M7CiAKLS0gCjIuMTcuMQoKCl9fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5n
IGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJv
amVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

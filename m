Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 0562CB0969
	for <lists+xen-devel@lfdr.de>; Thu, 12 Sep 2019 09:22:21 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i8JNq-0001g5-K6; Thu, 12 Sep 2019 07:19:14 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=+knL=XH=intel.com=chao.gao@srs-us1.protection.inumbo.net>)
 id 1i8JNo-0001ey-5Q
 for xen-devel@lists.xenproject.org; Thu, 12 Sep 2019 07:19:12 +0000
X-Inumbo-ID: 9450dadf-d52d-11e9-83e3-12813bfff9fa
Received: from mga01.intel.com (unknown [192.55.52.88])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 9450dadf-d52d-11e9-83e3-12813bfff9fa;
 Thu, 12 Sep 2019 07:18:56 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga006.jf.intel.com ([10.7.209.51])
 by fmsmga101.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 12 Sep 2019 00:18:56 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,492,1559545200"; d="scan'208";a="189906292"
Received: from gao-cwp.sh.intel.com ([10.239.159.26])
 by orsmga006.jf.intel.com with ESMTP; 12 Sep 2019 00:18:53 -0700
From: Chao Gao <chao.gao@intel.com>
To: xen-devel@lists.xenproject.org
Date: Thu, 12 Sep 2019 15:22:22 +0800
Message-Id: <1568272949-1086-10-git-send-email-chao.gao@intel.com>
X-Mailer: git-send-email 1.9.1
In-Reply-To: <1568272949-1086-1-git-send-email-chao.gao@intel.com>
References: <1568272949-1086-1-git-send-email-chao.gao@intel.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v10 09/16] microcode: split out
 apply_microcode() from cpu_request_microcode()
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Sergey Dyasli <sergey.dyasli@citrix.com>, Ashok Raj <ashok.raj@intel.com>,
 Wei Liu <wl@xen.org>, Andrew Cooper <andrew.cooper3@citrix.com>,
 Jan Beulich <jbeulich@suse.com>, Chao Gao <chao.gao@intel.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

RHVyaW5nIGxhdGUgbWljcm9jb2RlIGxvYWRpbmcsIGFwcGx5X21pY3JvY29kZSgpIGlzIGludm9r
ZWQgaW4KY3B1X3JlcXVlc3RfbWljcm9jb2RlKCkuIFRvIG1ha2UgbGF0ZSBtaWNyb2NvZGUgdXBk
YXRlIG1vcmUgcmVsaWFibGUsCndlIHdhbnQgdG8gcHV0IHRoZSBhcHBseV9taWNyb2NvZGUoKSBp
bnRvIHN0b3BfbWFjaGluZSBjb250ZXh0LiBTbwp3ZSBzcGxpdCBvdXQgaXQgZnJvbSBjcHVfcmVx
dWVzdF9taWNyb2NvZGUoKS4gSW4gZ2VuZXJhbCwgZm9yIGJvdGgKZWFybHkgbG9hZGluZyBvbiBC
U1AgYW5kIGxhdGUgbG9hZGluZywgY3B1X3JlcXVlc3RfbWljcm9jb2RlKCkgaXMKY2FsbGVkIGZp
cnN0IHRvIGdldCB0aGUgbWF0Y2hpbmcgbWljcm9jb2RlIHVwZGF0ZSBjb250YWluZWQgYnkKdGhl
IGJsb2IgYW5kIHRoZW4gYXBwbHlfbWljcm9jb2RlKCkgaXMgaW52b2tlZCBleHBsaWNpdGx5IG9u
IGVhY2gKY3B1IGluIGNvbW1vbiBjb2RlLgoKR2l2ZW4gdGhhdCBhbGwgQ1BVcyBhcmUgc3VwcG9z
ZWQgdG8gaGF2ZSB0aGUgc2FtZSBzaWduYXR1cmUsIHBhcnNpbmcKbWljcm9jb2RlIG9ubHkgbmVl
ZHMgdG8gYmUgZG9uZSBvbmNlLiBTbyBjcHVfcmVxdWVzdF9taWNyb2NvZGUoKSBpcwphbHNvIG1v
dmVkIG91dCBvZiBtaWNyb2NvZGVfdXBkYXRlX2NwdSgpLgoKSW4gc29tZSBjYXNlcyAoZS5nLiBh
IGJyb2tlbiBiaW9zKSwgdGhlIHN5c3RlbSBtYXkgaGF2ZSBtdWx0aXBsZQpyZXZpc2lvbnMgb2Yg
bWljcm9jb2RlIHVwZGF0ZS4gU28gd2Ugd291bGQgdHJ5IHRvIGxvYWQgYSBtaWNyb2NvZGUKdXBk
YXRlIGFzIGxvbmcgYXMgaXQgY292ZXJzIGN1cnJlbnQgY3B1LiBBbmQgaWYgYSBjcHUgbG9hZHMg
dGhpcyBwYXRjaApzdWNjZXNzZnVsbHksIHRoZSBwYXRjaCB3b3VsZCBiZSBzdG9yZWQgaW50byB0
aGUgcGF0Y2ggY2FjaGUuCgpTaWduZWQtb2ZmLWJ5OiBDaGFvIEdhbyA8Y2hhby5nYW9AaW50ZWwu
Y29tPgpSZXZpZXdlZC1ieTogUm9nZXIgUGF1IE1vbm7DqSA8cm9nZXIucGF1QGNpdHJpeC5jb20+
Ci0tLQpDaGFuZ2VzIGluIHYxMDoKIC0gbWFrZSBtaWNyb2NvZGVfdXBkYXRlX2NhY2hlIHN0YXRp
YwogLSByYWlzZSBhbiBlcnJvciBpZiBsb2FkaW5nIHVjb2RlIGZhaWxlZCB3aXRoIC1FSU8KIC0g
ZW5zdXJlIGVuZF91cGRhdGVfcGVyY3B1KCkgaXMgY2FsbGVkIGZvbGxvd2luZyBhIHN1Y2Nlc3Nm
dWwgY2FsbCBvZgogc3RhcnRfdXBkYXRlKCkKCkNoYW5nZXMgaW4gdjk6CiAtIHJlbW92ZSB0aGUg
Y2FsbGluZyBvZiAtPmNvbXBhcmVfcGF0Y2ggaW4gbWljcm9jb2RlX3VwZGF0ZV9jcHUoKS4KIC0g
ZHJvcCAibWljcm9jb2RlXyIgcHJlZml4IGZvciBzdGF0aWMgZnVuY3Rpb24gLSBtaWNyb2NvZGVf
cGFyc2VfYmxvYigpLgogLSByZWJhc2UgYW5kIGZpeCBjb25mbGljdAoKQ2hhbmdlcyBpbiB2ODoK
IC0gZGl2aWRlIHRoZSBvcmlnaW5hbCBwYXRjaCBpbnRvIHRocmVlIHBhdGNoZXMgdG8gaW1wcm92
ZSByZWFkYWJpbGl0eQogLSBsb2FkIGFuIHVwZGF0ZSBvbiBlYWNoIGNwdSBhcyBsb25nIGFzIHRo
ZSB1cGRhdGUgY292ZXJzIGN1cnJlbnQgY3B1CiAtIHN0b3JlIGFuIHVwZGF0ZSBhZnRlciB0aGUg
Zmlyc3Qgc3VjY2Vzc2Z1bCBsb2FkaW5nIG9uIGEgQ1BVCiAtIE1ha2Ugc3VyZSB0aGUgY3VycmVu
dCBDUFUgKGVzcGVjaWFsbHkgcGYgdmFsdWUpIGlzIGNvdmVyZWQKIGJ5IHVwZGF0ZXMuCgpjaGFu
Z2VzIGluIHY3OgogLSB0byBoYW5kbGUgbG9hZCBmYWlsdXJlLCB1bnZhbGlkYXRlZCBwYXRjaGVz
IHdvbid0IGJlIGNhY2hlZC4gVGhleQogYXJlIHBhc3NlZCBhcyBmdW5jdGlvbiBhcmd1bWVudHMu
IFNvIGlmIHVwZGF0ZSBmYWlsZWQsIHdlIG5lZWRuJ3QKIGFueSBjbGVhbnVwIHRvIG1pY3JvY29k
ZSBjYWNoZS4KLS0tCiB4ZW4vYXJjaC94ODYvbWljcm9jb2RlLmMgICAgICAgIHwgMTgyICsrKysr
KysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0KIHhlbi9hcmNoL3g4Ni9taWNyb2Nv
ZGVfYW1kLmMgICAgfCAgMzggKysrKystLS0tCiB4ZW4vYXJjaC94ODYvbWljcm9jb2RlX2ludGVs
LmMgIHwgIDY2ICsrKysrKystLS0tLS0tLQogeGVuL2luY2x1ZGUvYXNtLXg4Ni9taWNyb2NvZGUu
aCB8ICAgNSArLQogNCBmaWxlcyBjaGFuZ2VkLCAxNzggaW5zZXJ0aW9ucygrKSwgMTEzIGRlbGV0
aW9ucygtKQoKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9taWNyb2NvZGUuYyBiL3hlbi9hcmNo
L3g4Ni9taWNyb2NvZGUuYwppbmRleCBiNDRlNGQ3Li5kNDczOGY2IDEwMDY0NAotLS0gYS94ZW4v
YXJjaC94ODYvbWljcm9jb2RlLmMKKysrIGIveGVuL2FyY2gveDg2L21pY3JvY29kZS5jCkBAIC0x
ODksMTIgKzE4OSwxOSBAQCBzdGF0aWMgREVGSU5FX1NQSU5MT0NLKG1pY3JvY29kZV9tdXRleCk7
CiAKIERFRklORV9QRVJfQ1BVKHN0cnVjdCBjcHVfc2lnbmF0dXJlLCBjcHVfc2lnKTsKIAotc3Ry
dWN0IG1pY3JvY29kZV9pbmZvIHsKLSAgICB1bnNpZ25lZCBpbnQgY3B1OwotICAgIHVpbnQzMl90
IGJ1ZmZlcl9zaXplOwotICAgIGludCBlcnJvcjsKLSAgICBjaGFyIGJ1ZmZlclsxXTsKLX07Cisv
KgorICogUmV0dXJuIGEgcGF0Y2ggdGhhdCBjb3ZlcnMgY3VycmVudCBDUFUuIElmIHRoZXJlIGFy
ZSBtdWx0aXBsZSBwYXRjaGVzLAorICogcmV0dXJuIHRoZSBvbmUgd2l0aCB0aGUgaGlnaGVzdCBy
ZXZpc2lvbiBudW1iZXIuIFJldHVybiBlcnJvciBJZiBubworICogcGF0Y2ggaXMgZm91bmQgYW5k
IGFuIGVycm9yIG9jY3VycyBkdXJpbmcgdGhlIHBhcnNpbmcgcHJvY2Vzcy4gT3RoZXJ3aXNlCisg
KiByZXR1cm4gTlVMTC4KKyAqLworc3RhdGljIHN0cnVjdCBtaWNyb2NvZGVfcGF0Y2ggKnBhcnNl
X2Jsb2IoY29uc3QgY2hhciAqYnVmLCBzaXplX3QgbGVuKQoreworICAgIGlmICggbGlrZWx5KCFt
aWNyb2NvZGVfb3BzLT5jb2xsZWN0X2NwdV9pbmZvKCZ0aGlzX2NwdShjcHVfc2lnKSkpICkKKyAg
ICAgICAgcmV0dXJuIG1pY3JvY29kZV9vcHMtPmNwdV9yZXF1ZXN0X21pY3JvY29kZShidWYsIGxl
bik7CisKKyAgICByZXR1cm4gTlVMTDsKK30KIAogaW50IG1pY3JvY29kZV9yZXN1bWVfY3B1KHZv
aWQpCiB7CkBAIC0yMjAsMTUgKzIyNyw4IEBAIHZvaWQgbWljcm9jb2RlX2ZyZWVfcGF0Y2goc3Ry
dWN0IG1pY3JvY29kZV9wYXRjaCAqbWljcm9jb2RlX3BhdGNoKQogICAgIHhmcmVlKG1pY3JvY29k
ZV9wYXRjaCk7CiB9CiAKLWNvbnN0IHN0cnVjdCBtaWNyb2NvZGVfcGF0Y2ggKm1pY3JvY29kZV9n
ZXRfY2FjaGUodm9pZCkKLXsKLSAgICBBU1NFUlQoc3Bpbl9pc19sb2NrZWQoJm1pY3JvY29kZV9t
dXRleCkpOwotCi0gICAgcmV0dXJuIG1pY3JvY29kZV9jYWNoZTsKLX0KLQogLyogUmV0dXJuIHRy
dWUgaWYgY2FjaGUgZ2V0cyB1cGRhdGVkLiBPdGhlcndpc2UsIHJldHVybiBmYWxzZSAqLwotYm9v
bCBtaWNyb2NvZGVfdXBkYXRlX2NhY2hlKHN0cnVjdCBtaWNyb2NvZGVfcGF0Y2ggKnBhdGNoKQor
c3RhdGljIGJvb2wgbWljcm9jb2RlX3VwZGF0ZV9jYWNoZShzdHJ1Y3QgbWljcm9jb2RlX3BhdGNo
ICpwYXRjaCkKIHsKICAgICBBU1NFUlQoc3Bpbl9pc19sb2NrZWQoJm1pY3JvY29kZV9tdXRleCkp
OwogCkBAIC0yNDksNDkgKzI0OSw4MCBAQCBib29sIG1pY3JvY29kZV91cGRhdGVfY2FjaGUoc3Ry
dWN0IG1pY3JvY29kZV9wYXRjaCAqcGF0Y2gpCiAgICAgcmV0dXJuIHRydWU7CiB9CiAKLXN0YXRp
YyBpbnQgbWljcm9jb2RlX3VwZGF0ZV9jcHUoY29uc3Qgdm9pZCAqYnVmLCBzaXplX3Qgc2l6ZSkK
Ky8qCisgKiBMb2FkIGEgbWljcm9jb2RlIHVwZGF0ZSB0byBjdXJyZW50IENQVS4KKyAqCisgKiBJ
ZiBubyBwYXRjaCBpcyBwcm92aWRlZCwgdGhlIGNhY2hlZCBwYXRjaCB3aWxsIGJlIGxvYWRlZC4g
TWljcm9jb2RlIHVwZGF0ZQorICogZHVyaW5nIEFQcyBicmluZ3VwIGFuZCBDUFUgcmVzdW1pbmcg
ZmFsbHMgaW50byB0aGlzIGNhc2UuCisgKi8KK3N0YXRpYyBpbnQgbWljcm9jb2RlX3VwZGF0ZV9j
cHUoY29uc3Qgc3RydWN0IG1pY3JvY29kZV9wYXRjaCAqcGF0Y2gpCiB7Ci0gICAgaW50IGVycjsK
LSAgICB1bnNpZ25lZCBpbnQgY3B1ID0gc21wX3Byb2Nlc3Nvcl9pZCgpOwotICAgIHN0cnVjdCBj
cHVfc2lnbmF0dXJlICpzaWcgPSAmcGVyX2NwdShjcHVfc2lnLCBjcHUpOworICAgIGludCBlcnIg
PSBtaWNyb2NvZGVfb3BzLT5jb2xsZWN0X2NwdV9pbmZvKCZ0aGlzX2NwdShjcHVfc2lnKSk7CiAK
LSAgICBzcGluX2xvY2soJm1pY3JvY29kZV9tdXRleCk7CisgICAgaWYgKCB1bmxpa2VseShlcnIp
ICkKKyAgICAgICAgcmV0dXJuIGVycjsKIAotICAgIGVyciA9IG1pY3JvY29kZV9vcHMtPmNvbGxl
Y3RfY3B1X2luZm8oc2lnKTsKLSAgICBpZiAoIGxpa2VseSghZXJyKSApCi0gICAgICAgIGVyciA9
IG1pY3JvY29kZV9vcHMtPmNwdV9yZXF1ZXN0X21pY3JvY29kZShidWYsIHNpemUpOwotICAgIHNw
aW5fdW5sb2NrKCZtaWNyb2NvZGVfbXV0ZXgpOworICAgIGlmICggcGF0Y2ggKQorICAgICAgICBl
cnIgPSBtaWNyb2NvZGVfb3BzLT5hcHBseV9taWNyb2NvZGUocGF0Y2gpOworICAgIGVsc2UgaWYg
KCBtaWNyb2NvZGVfY2FjaGUgKQorICAgIHsKKyAgICAgICAgc3Bpbl9sb2NrKCZtaWNyb2NvZGVf
bXV0ZXgpOworICAgICAgICBlcnIgPSBtaWNyb2NvZGVfb3BzLT5hcHBseV9taWNyb2NvZGUobWlj
cm9jb2RlX2NhY2hlKTsKKyAgICAgICAgaWYgKCBlcnIgPT0gLUVJTyApCisgICAgICAgIHsKKyAg
ICAgICAgICAgIG1pY3JvY29kZV9mcmVlX3BhdGNoKG1pY3JvY29kZV9jYWNoZSk7CisgICAgICAg
ICAgICBtaWNyb2NvZGVfY2FjaGUgPSBOVUxMOworICAgICAgICB9CisgICAgICAgIHNwaW5fdW5s
b2NrKCZtaWNyb2NvZGVfbXV0ZXgpOworICAgIH0KKyAgICBlbHNlCisgICAgICAgIC8qIE5vIHBh
dGNoIHRvIHVwZGF0ZSAqLworICAgICAgICBlcnIgPSAtRU5PRU5UOwogCiAgICAgcmV0dXJuIGVy
cjsKIH0KIAotc3RhdGljIGxvbmcgZG9fbWljcm9jb2RlX3VwZGF0ZSh2b2lkICpfaW5mbykKK3N0
YXRpYyBsb25nIGRvX21pY3JvY29kZV91cGRhdGUodm9pZCAqcGF0Y2gpCiB7Ci0gICAgc3RydWN0
IG1pY3JvY29kZV9pbmZvICppbmZvID0gX2luZm87Ci0gICAgaW50IGVycm9yOwotCi0gICAgQlVH
X09OKGluZm8tPmNwdSAhPSBzbXBfcHJvY2Vzc29yX2lkKCkpOworICAgIHVuc2lnbmVkIGludCBj
cHU7CisgICAgaW50IHJldCA9IG1pY3JvY29kZV91cGRhdGVfY3B1KHBhdGNoKTsKIAotICAgIGVy
cm9yID0gbWljcm9jb2RlX3VwZGF0ZV9jcHUoaW5mby0+YnVmZmVyLCBpbmZvLT5idWZmZXJfc2l6
ZSk7Ci0gICAgaWYgKCBlcnJvciApCi0gICAgICAgIGluZm8tPmVycm9yID0gZXJyb3I7CisgICAg
LyogU3RvcmUgdGhlIHBhdGNoIGFmdGVyIGEgc3VjY2Vzc2Z1bCBsb2FkaW5nICovCisgICAgaWYg
KCAhcmV0ICYmIHBhdGNoICkKKyAgICB7CisgICAgICAgIHNwaW5fbG9jaygmbWljcm9jb2RlX211
dGV4KTsKKyAgICAgICAgbWljcm9jb2RlX3VwZGF0ZV9jYWNoZShwYXRjaCk7CisgICAgICAgIHNw
aW5fdW5sb2NrKCZtaWNyb2NvZGVfbXV0ZXgpOworICAgICAgICBwYXRjaCA9IE5VTEw7CisgICAg
fQogCiAgICAgaWYgKCBtaWNyb2NvZGVfb3BzLT5lbmRfdXBkYXRlX3BlcmNwdSApCiAgICAgICAg
IG1pY3JvY29kZV9vcHMtPmVuZF91cGRhdGVfcGVyY3B1KCk7CiAKLSAgICBpbmZvLT5jcHUgPSBj
cHVtYXNrX25leHQoaW5mby0+Y3B1LCAmY3B1X29ubGluZV9tYXApOwotICAgIGlmICggaW5mby0+
Y3B1IDwgbnJfY3B1X2lkcyApCi0gICAgICAgIHJldHVybiBjb250aW51ZV9oeXBlcmNhbGxfb25f
Y3B1KGluZm8tPmNwdSwgZG9fbWljcm9jb2RlX3VwZGF0ZSwgaW5mbyk7CisgICAgLyoKKyAgICAg
KiBFYWNoIHRocmVhZCB0cmllcyB0byBsb2FkIHVjb2RlIGFuZCBvbmx5IHRoZSBmaXJzdCB0aHJl
YWQgb2YgYSBjb3JlCisgICAgICogd291bGQgc3VjY2VlZC4gSWdub3JlIGVycm9yIG90aGVyIHRo
YW4gLUVJTy4KKyAgICAgKi8KKyAgICBpZiAoIHJldCAhPSAtRUlPICkKKyAgICAgICAgcmV0ID0g
MDsKKworICAgIGNwdSA9IGNwdW1hc2tfbmV4dChzbXBfcHJvY2Vzc29yX2lkKCksICZjcHVfb25s
aW5lX21hcCk7CisgICAgaWYgKCBjcHUgPCBucl9jcHVfaWRzICkKKyAgICAgICAgcmV0dXJuIGNv
bnRpbnVlX2h5cGVyY2FsbF9vbl9jcHUoY3B1LCBkb19taWNyb2NvZGVfdXBkYXRlLCBwYXRjaCkg
PworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICA6IHJldDsKIAotICAgIGVycm9yID0gaW5mby0+ZXJyb3I7Ci0g
ICAgeGZyZWUoaW5mbyk7Ci0gICAgcmV0dXJuIGVycm9yOworICAgIC8qIEZyZWUgdGhlIHBhdGNo
IGlmIG5vIENQVSBoYXMgbG9hZGVkIGl0IHN1Y2Nlc3NmdWxseS4gKi8KKyAgICBpZiAoIHBhdGNo
ICkKKyAgICAgICAgbWljcm9jb2RlX2ZyZWVfcGF0Y2gocGF0Y2gpOworCisgICAgcmV0dXJuIHJl
dDsKIH0KIAogaW50IG1pY3JvY29kZV91cGRhdGUoWEVOX0dVRVNUX0hBTkRMRV9QQVJBTShjb25z
dF92b2lkKSBidWYsIHVuc2lnbmVkIGxvbmcgbGVuKQogewogICAgIGludCByZXQ7Ci0gICAgc3Ry
dWN0IG1pY3JvY29kZV9pbmZvICppbmZvOworICAgIHZvaWQgKmJ1ZmZlcjsKKyAgICBzdHJ1Y3Qg
bWljcm9jb2RlX3BhdGNoICpwYXRjaDsKIAogICAgIGlmICggbGVuICE9ICh1aW50MzJfdClsZW4g
KQogICAgICAgICByZXR1cm4gLUUyQklHOwpAQCAtMjk5LDMyICszMzAsNDYgQEAgaW50IG1pY3Jv
Y29kZV91cGRhdGUoWEVOX0dVRVNUX0hBTkRMRV9QQVJBTShjb25zdF92b2lkKSBidWYsIHVuc2ln
bmVkIGxvbmcgbGVuKQogICAgIGlmICggbWljcm9jb2RlX29wcyA9PSBOVUxMICkKICAgICAgICAg
cmV0dXJuIC1FSU5WQUw7CiAKLSAgICBpbmZvID0geG1hbGxvY19ieXRlcyhzaXplb2YoKmluZm8p
ICsgbGVuKTsKLSAgICBpZiAoIGluZm8gPT0gTlVMTCApCisgICAgYnVmZmVyID0geG1hbGxvY19i
eXRlcyhsZW4pOworICAgIGlmICggIWJ1ZmZlciApCiAgICAgICAgIHJldHVybiAtRU5PTUVNOwog
Ci0gICAgcmV0ID0gY29weV9mcm9tX2d1ZXN0KGluZm8tPmJ1ZmZlciwgYnVmLCBsZW4pOwotICAg
IGlmICggcmV0ICE9IDAgKQorICAgIGlmICggY29weV9mcm9tX2d1ZXN0KGJ1ZmZlciwgYnVmLCBs
ZW4pICkKKyAgICB7CisgICAgICAgIHJldCA9IC1FRkFVTFQ7CisgICAgICAgIGdvdG8gZnJlZTsK
KyAgICB9CisKKyAgICBwYXRjaCA9IHBhcnNlX2Jsb2IoYnVmZmVyLCBsZW4pOworICAgIGlmICgg
SVNfRVJSKHBhdGNoKSApCiAgICAgewotICAgICAgICB4ZnJlZShpbmZvKTsKLSAgICAgICAgcmV0
dXJuIHJldDsKKyAgICAgICAgcmV0ID0gUFRSX0VSUihwYXRjaCk7CisgICAgICAgIHByaW50ayhY
RU5MT0dfV0FSTklORyAiUGFyc2luZyBtaWNyb2NvZGUgYmxvYiBlcnJvciAlZFxuIiwgcmV0KTsK
KyAgICAgICAgZ290byBmcmVlOwogICAgIH0KIAotICAgIGluZm8tPmJ1ZmZlcl9zaXplID0gbGVu
OwotICAgIGluZm8tPmVycm9yID0gMDsKLSAgICBpbmZvLT5jcHUgPSBjcHVtYXNrX2ZpcnN0KCZj
cHVfb25saW5lX21hcCk7CisgICAgaWYgKCAhcGF0Y2ggKQorICAgIHsKKyAgICAgICAgcmV0ID0g
LUVOT0VOVDsKKyAgICAgICAgZ290byBmcmVlOworICAgIH0KIAogICAgIGlmICggbWljcm9jb2Rl
X29wcy0+c3RhcnRfdXBkYXRlICkKICAgICB7CiAgICAgICAgIHJldCA9IG1pY3JvY29kZV9vcHMt
PnN0YXJ0X3VwZGF0ZSgpOwogICAgICAgICBpZiAoIHJldCAhPSAwICkKICAgICAgICAgewotICAg
ICAgICAgICAgeGZyZWUoaW5mbyk7Ci0gICAgICAgICAgICByZXR1cm4gcmV0OworICAgICAgICAg
ICAgbWljcm9jb2RlX2ZyZWVfcGF0Y2gocGF0Y2gpOworICAgICAgICAgICAgZ290byBmcmVlOwog
ICAgICAgICB9CiAgICAgfQogCi0gICAgcmV0dXJuIGNvbnRpbnVlX2h5cGVyY2FsbF9vbl9jcHUo
aW5mby0+Y3B1LCBkb19taWNyb2NvZGVfdXBkYXRlLCBpbmZvKTsKKyAgICByZXQgPSBjb250aW51
ZV9oeXBlcmNhbGxfb25fY3B1KGNwdW1hc2tfZmlyc3QoJmNwdV9vbmxpbmVfbWFwKSwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvX21pY3JvY29kZV91cGRhdGUsIHBhdGNo
KTsKKworIGZyZWU6CisgICAgeGZyZWUoYnVmZmVyKTsKKyAgICByZXR1cm4gcmV0OwogfQogCiBz
dGF0aWMgaW50IF9faW5pdCBtaWNyb2NvZGVfaW5pdCh2b2lkKQpAQCAtMzcxLDIzICs0MTYsNDIg
QEAgaW50IF9faW5pdCBlYXJseV9taWNyb2NvZGVfdXBkYXRlX2NwdShib29sIHN0YXJ0X3VwZGF0
ZSkKIAogICAgIG1pY3JvY29kZV9vcHMtPmNvbGxlY3RfY3B1X2luZm8oJnRoaXNfY3B1KGNwdV9z
aWcpKTsKIAotICAgIGlmICggZGF0YSApCisgICAgaWYgKCAhZGF0YSApCisgICAgICAgIHJldHVy
biAtRU5PTUVNOworCisgICAgaWYgKCBzdGFydF91cGRhdGUgKQogICAgIHsKLSAgICAgICAgaWYg
KCBzdGFydF91cGRhdGUgJiYgbWljcm9jb2RlX29wcy0+c3RhcnRfdXBkYXRlICkKKyAgICAgICAg
c3RydWN0IG1pY3JvY29kZV9wYXRjaCAqcGF0Y2g7CisKKyAgICAgICAgcGF0Y2ggPSBwYXJzZV9i
bG9iKGRhdGEsIGxlbik7CisgICAgICAgIGlmICggSVNfRVJSKHBhdGNoKSApCisgICAgICAgIHsK
KyAgICAgICAgICAgIHByaW50ayhYRU5MT0dfV0FSTklORyAiUGFyc2luZyBtaWNyb2NvZGUgYmxv
YiBlcnJvciAlbGRcbiIsCisgICAgICAgICAgICAgICAgICAgUFRSX0VSUihwYXRjaCkpOworICAg
ICAgICAgICAgcmV0dXJuIFBUUl9FUlIocGF0Y2gpOworICAgICAgICB9CisKKyAgICAgICAgaWYg
KCAhcGF0Y2ggKQorICAgICAgICAgICAgcmV0dXJuIC1FTk9FTlQ7CisKKyAgICAgICAgc3Bpbl9s
b2NrKCZtaWNyb2NvZGVfbXV0ZXgpOworICAgICAgICByYyA9IG1pY3JvY29kZV91cGRhdGVfY2Fj
aGUocGF0Y2gpOworICAgICAgICBzcGluX3VubG9jaygmbWljcm9jb2RlX211dGV4KTsKKyAgICAg
ICAgQVNTRVJUKHJjKTsKKworICAgICAgICBpZiAoIG1pY3JvY29kZV9vcHMtPnN0YXJ0X3VwZGF0
ZSApCiAgICAgICAgICAgICByYyA9IG1pY3JvY29kZV9vcHMtPnN0YXJ0X3VwZGF0ZSgpOwogCiAg
ICAgICAgIGlmICggcmMgKQogICAgICAgICAgICAgcmV0dXJuIHJjOworICAgIH0KIAotICAgICAg
ICByYyA9IG1pY3JvY29kZV91cGRhdGVfY3B1KGRhdGEsIGxlbik7CisgICAgcmMgPSBtaWNyb2Nv
ZGVfdXBkYXRlX2NwdShOVUxMKTsKIAotICAgICAgICBpZiAoIG1pY3JvY29kZV9vcHMtPmVuZF91
cGRhdGVfcGVyY3B1ICkKLSAgICAgICAgICAgIG1pY3JvY29kZV9vcHMtPmVuZF91cGRhdGVfcGVy
Y3B1KCk7CisgICAgaWYgKCBtaWNyb2NvZGVfb3BzLT5lbmRfdXBkYXRlX3BlcmNwdSApCisgICAg
ICAgIG1pY3JvY29kZV9vcHMtPmVuZF91cGRhdGVfcGVyY3B1KCk7CiAKLSAgICAgICAgcmV0dXJu
IHJjOwotICAgIH0KLSAgICBlbHNlCi0gICAgICAgIHJldHVybiAtRU5PTUVNOworICAgIHJldHVy
biByYzsKIH0KIAogaW50IF9faW5pdCBlYXJseV9taWNyb2NvZGVfaW5pdCh2b2lkKQpkaWZmIC0t
Z2l0IGEveGVuL2FyY2gveDg2L21pY3JvY29kZV9hbWQuYyBiL3hlbi9hcmNoL3g4Ni9taWNyb2Nv
ZGVfYW1kLmMKaW5kZXggYzZkMmVhMy4uMWQxYmVhNCAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2
L21pY3JvY29kZV9hbWQuYworKysgYi94ZW4vYXJjaC94ODYvbWljcm9jb2RlX2FtZC5jCkBAIC00
NTUsOSArNDU1LDExIEBAIHN0YXRpYyBib29sX3QgY2hlY2tfZmluYWxfcGF0Y2hfbGV2ZWxzKHVu
c2lnbmVkIGludCBjcHUpCiAgICAgcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBpbnQgY3B1X3JlcXVl
c3RfbWljcm9jb2RlKGNvbnN0IHZvaWQgKmJ1Ziwgc2l6ZV90IGJ1ZnNpemUpCitzdGF0aWMgc3Ry
dWN0IG1pY3JvY29kZV9wYXRjaCAqY3B1X3JlcXVlc3RfbWljcm9jb2RlKGNvbnN0IHZvaWQgKmJ1
ZiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
c2l6ZV90IGJ1ZnNpemUpCiB7CiAgICAgc3RydWN0IG1pY3JvY29kZV9hbWQgKm1jX2FtZDsKKyAg
ICBzdHJ1Y3QgbWljcm9jb2RlX3BhdGNoICpwYXRjaCA9IE5VTEw7CiAgICAgc2l6ZV90IG9mZnNl
dCA9IDA7CiAgICAgaW50IGVycm9yID0gMDsKICAgICB1bnNpZ25lZCBpbnQgY3VycmVudF9jcHVf
aWQ7CkBAIC01NTYsMTkgKzU1OCwyMiBAQCBzdGF0aWMgaW50IGNwdV9yZXF1ZXN0X21pY3JvY29k
ZShjb25zdCB2b2lkICpidWYsIHNpemVfdCBidWZzaXplKQogICAgICAgICAgICAgYnJlYWs7CiAg
ICAgICAgIH0KIAotICAgICAgICAvKiBVcGRhdGUgY2FjaGUgaWYgdGhpcyBwYXRjaCBjb3ZlcnMg
Y3VycmVudCBDUFUgKi8KLSAgICAgICAgaWYgKCBtaWNyb2NvZGVfZml0cyhuZXdfcGF0Y2gtPm1j
X2FtZCkgIT0gTUlTX1VDT0RFICkKLSAgICAgICAgICAgIG1pY3JvY29kZV91cGRhdGVfY2FjaGUo
bmV3X3BhdGNoKTsKLSAgICAgICAgZWxzZQotICAgICAgICAgICAgbWljcm9jb2RlX2ZyZWVfcGF0
Y2gobmV3X3BhdGNoKTsKLQotICAgICAgICBpZiAoIG1hdGNoX2NwdShtaWNyb2NvZGVfZ2V0X2Nh
Y2hlKCkpICkKKyAgICAgICAgLyoKKyAgICAgICAgICogSWYgdGhlIG5ldyBwYXRjaCBjb3ZlcnMg
Y3VycmVudCBDUFUsIGNvbXBhcmUgcGF0Y2hlcyBhbmQgc3RvcmUgdGhlCisgICAgICAgICAqIG9u
ZSB3aXRoIGhpZ2hlciByZXZpc2lvbi4KKyAgICAgICAgICovCisgICAgICAgIGlmICggKG1pY3Jv
Y29kZV9maXRzKG5ld19wYXRjaC0+bWNfYW1kKSAhPSBNSVNfVUNPREUpICYmCisgICAgICAgICAg
ICAgKCFwYXRjaCB8fCAoY29tcGFyZV9wYXRjaChuZXdfcGF0Y2gsIHBhdGNoKSA9PSBORVdfVUNP
REUpKSApCiAgICAgICAgIHsKLSAgICAgICAgICAgIGVycm9yID0gYXBwbHlfbWljcm9jb2RlKG1p
Y3JvY29kZV9nZXRfY2FjaGUoKSk7Ci0gICAgICAgICAgICBpZiAoIGVycm9yICkKLSAgICAgICAg
ICAgICAgICBicmVhazsKKyAgICAgICAgICAgIHN0cnVjdCBtaWNyb2NvZGVfcGF0Y2ggKnRtcCA9
IHBhdGNoOworCisgICAgICAgICAgICBwYXRjaCA9IG5ld19wYXRjaDsKKyAgICAgICAgICAgIG5l
d19wYXRjaCA9IHRtcDsKICAgICAgICAgfQogCisgICAgICAgIGlmICggbmV3X3BhdGNoICkKKyAg
ICAgICAgICAgIG1pY3JvY29kZV9mcmVlX3BhdGNoKG5ld19wYXRjaCk7CisKICAgICAgICAgaWYg
KCBvZmZzZXQgPj0gYnVmc2l6ZSApCiAgICAgICAgICAgICBicmVhazsKIApAQCAtNTk5LDEzICs2
MDQsMTAgQEAgc3RhdGljIGludCBjcHVfcmVxdWVzdF9taWNyb2NvZGUoY29uc3Qgdm9pZCAqYnVm
LCBzaXplX3QgYnVmc2l6ZSkKICAgICBmcmVlX3BhdGNoKG1jX2FtZCk7CiAKICAgb3V0OgotICAg
IC8qCi0gICAgICogSW4gc29tZSBjYXNlcyB3ZSBtYXkgcmV0dXJuIGFuIGVycm9yIGV2ZW4gaWYg
cHJvY2Vzc29yJ3MgbWljcm9jb2RlIGhhcwotICAgICAqIGJlZW4gdXBkYXRlZC4gRm9yIGV4YW1w
bGUsIHRoZSBmaXJzdCBwYXRjaCBpbiBhIGNvbnRhaW5lciBmaWxlIGlzIGxvYWRlZAotICAgICAq
IHN1Y2Nlc3NmdWxseSBidXQgc3Vic2VxdWVudCBjb250YWluZXIgZmlsZSBwcm9jZXNzaW5nIGVu
Y291bnRlcnMgYQotICAgICAqIGZhaWx1cmUuCi0gICAgICovCi0gICAgcmV0dXJuIGVycm9yOwor
ICAgIGlmICggZXJyb3IgJiYgIXBhdGNoICkKKyAgICAgICAgcGF0Y2ggPSBFUlJfUFRSKGVycm9y
KTsKKworICAgIHJldHVybiBwYXRjaDsKIH0KIAogI2lmZGVmIENPTkZJR19IVk0KZGlmZiAtLWdp
dCBhL3hlbi9hcmNoL3g4Ni9taWNyb2NvZGVfaW50ZWwuYyBiL3hlbi9hcmNoL3g4Ni9taWNyb2Nv
ZGVfaW50ZWwuYwppbmRleCBiMWVjODFkLi5jMzA4M2Q3IDEwMDY0NAotLS0gYS94ZW4vYXJjaC94
ODYvbWljcm9jb2RlX2ludGVsLmMKKysrIGIveGVuL2FyY2gveDg2L21pY3JvY29kZV9pbnRlbC5j
CkBAIC0yODYsMTQgKzI4Niw5IEBAIHN0YXRpYyBlbnVtIG1pY3JvY29kZV9tYXRjaF9yZXN1bHQg
Y29tcGFyZV9wYXRjaCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICA6IE9MRF9VQ09ERTsKIH0KIAotLyoKLSAqIHJldHVybiAwIC0g
bm8gdXBkYXRlIGZvdW5kCi0gKiByZXR1cm4gMSAtIGZvdW5kIHVwZGF0ZQotICogcmV0dXJuIDwg
MCAtIGVycm9yCi0gKi8KLXN0YXRpYyBpbnQgZ2V0X21hdGNoaW5nX21pY3JvY29kZShjb25zdCB2
b2lkICptYykKK3N0YXRpYyBzdHJ1Y3QgbWljcm9jb2RlX3BhdGNoICphbGxvY19taWNyb2NvZGVf
cGF0Y2goCisgICAgY29uc3Qgc3RydWN0IG1pY3JvY29kZV9oZWFkZXJfaW50ZWwgKm1jX2hlYWRl
cikKIHsKLSAgICBjb25zdCBzdHJ1Y3QgbWljcm9jb2RlX2hlYWRlcl9pbnRlbCAqbWNfaGVhZGVy
ID0gbWM7CiAgICAgdW5zaWduZWQgbG9uZyB0b3RhbF9zaXplID0gZ2V0X3RvdGFsc2l6ZShtY19o
ZWFkZXIpOwogICAgIHZvaWQgKm5ld19tYyA9IHhtYWxsb2NfYnl0ZXModG90YWxfc2l6ZSk7CiAg
ICAgc3RydWN0IG1pY3JvY29kZV9wYXRjaCAqbmV3X3BhdGNoID0geG1hbGxvYyhzdHJ1Y3QgbWlj
cm9jb2RlX3BhdGNoKTsKQEAgLTMwMiwyNSArMjk3LDEyIEBAIHN0YXRpYyBpbnQgZ2V0X21hdGNo
aW5nX21pY3JvY29kZShjb25zdCB2b2lkICptYykKICAgICB7CiAgICAgICAgIHhmcmVlKG5ld19w
YXRjaCk7CiAgICAgICAgIHhmcmVlKG5ld19tYyk7Ci0gICAgICAgIHJldHVybiAtRU5PTUVNOwor
ICAgICAgICByZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKICAgICB9Ci0gICAgbWVtY3B5KG5ld19t
YywgbWMsIHRvdGFsX3NpemUpOworICAgIG1lbWNweShuZXdfbWMsIG1jX2hlYWRlciwgdG90YWxf
c2l6ZSk7CiAgICAgbmV3X3BhdGNoLT5tY19pbnRlbCA9IG5ld19tYzsKIAotICAgIC8qIE1ha2Ug
c3VyZSB0aGF0IHRoaXMgcGF0Y2ggY292ZXJzIGN1cnJlbnQgQ1BVICovCi0gICAgaWYgKCBtaWNy
b2NvZGVfdXBkYXRlX21hdGNoKG1jKSA9PSBNSVNfVUNPREUgKQotICAgIHsKLSAgICAgICAgbWlj
cm9jb2RlX2ZyZWVfcGF0Y2gobmV3X3BhdGNoKTsKLSAgICAgICAgcmV0dXJuIDA7Ci0gICAgfQot
Ci0gICAgbWljcm9jb2RlX3VwZGF0ZV9jYWNoZShuZXdfcGF0Y2gpOwotCi0gICAgcHJfZGVidWco
Im1pY3JvY29kZTogQ1BVJWQgZm91bmQgYSBtYXRjaGluZyBtaWNyb2NvZGUgdXBkYXRlIHdpdGgi
Ci0gICAgICAgICAgICAgIiB2ZXJzaW9uICUjeCAoY3VycmVudD0lI3gpXG4iLAotICAgICAgICAg
ICAgIHNtcF9wcm9jZXNzb3JfaWQoKSwgbWNfaGVhZGVyLT5yZXYsIHRoaXNfY3B1KGNwdV9zaWcp
LnJldik7Ci0KLSAgICByZXR1cm4gMTsKKyAgICByZXR1cm4gbmV3X3BhdGNoOwogfQogCiBzdGF0
aWMgaW50IGFwcGx5X21pY3JvY29kZShjb25zdCBzdHJ1Y3QgbWljcm9jb2RlX3BhdGNoICpwYXRj
aCkKQEAgLTM5OSwyNiArMzgxLDQ0IEBAIHN0YXRpYyBsb25nIGdldF9uZXh0X3Vjb2RlX2Zyb21f
YnVmZmVyKHZvaWQgKiptYywgY29uc3QgdTggKmJ1ZiwKICAgICByZXR1cm4gb2Zmc2V0ICsgdG90
YWxfc2l6ZTsKIH0KIAotc3RhdGljIGludCBjcHVfcmVxdWVzdF9taWNyb2NvZGUoY29uc3Qgdm9p
ZCAqYnVmLCBzaXplX3Qgc2l6ZSkKK3N0YXRpYyBzdHJ1Y3QgbWljcm9jb2RlX3BhdGNoICpjcHVf
cmVxdWVzdF9taWNyb2NvZGUoY29uc3Qgdm9pZCAqYnVmLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplX3Qgc2l6ZSkKIHsKICAgICBsb25n
IG9mZnNldCA9IDA7CiAgICAgaW50IGVycm9yID0gMDsKICAgICB2b2lkICptYzsKKyAgICBzdHJ1
Y3QgbWljcm9jb2RlX3BhdGNoICpwYXRjaCA9IE5VTEw7CiAKICAgICB3aGlsZSAoIChvZmZzZXQg
PSBnZXRfbmV4dF91Y29kZV9mcm9tX2J1ZmZlcigmbWMsIGJ1Ziwgc2l6ZSwgb2Zmc2V0KSkgPiAw
ICkKICAgICB7CisgICAgICAgIHN0cnVjdCBtaWNyb2NvZGVfcGF0Y2ggKm5ld19wYXRjaDsKKwog
ICAgICAgICBlcnJvciA9IG1pY3JvY29kZV9zYW5pdHlfY2hlY2sobWMpOwogICAgICAgICBpZiAo
IGVycm9yICkKICAgICAgICAgICAgIGJyZWFrOwotICAgICAgICBlcnJvciA9IGdldF9tYXRjaGlu
Z19taWNyb2NvZGUobWMpOwotICAgICAgICBpZiAoIGVycm9yIDwgMCApCisKKyAgICAgICAgbmV3
X3BhdGNoID0gYWxsb2NfbWljcm9jb2RlX3BhdGNoKG1jKTsKKyAgICAgICAgaWYgKCBJU19FUlIo
bmV3X3BhdGNoKSApCisgICAgICAgIHsKKyAgICAgICAgICAgIGVycm9yID0gUFRSX0VSUihuZXdf
cGF0Y2gpOwogICAgICAgICAgICAgYnJlYWs7CisgICAgICAgIH0KKwogICAgICAgICAvKgotICAg
ICAgICAgKiBJdCdzIHBvc3NpYmxlIHRoZSBkYXRhIGZpbGUgaGFzIG11bHRpcGxlIG1hdGNoaW5n
IHVjb2RlLAotICAgICAgICAgKiBsZXRzIGtlZXAgc2VhcmNoaW5nIHRpbGwgdGhlIGxhdGVzdCB2
ZXJzaW9uCisgICAgICAgICAqIElmIHRoZSBuZXcgcGF0Y2ggY292ZXJzIGN1cnJlbnQgQ1BVLCBj
b21wYXJlIHBhdGNoZXMgYW5kIHN0b3JlIHRoZQorICAgICAgICAgKiBvbmUgd2l0aCBoaWdoZXIg
cmV2aXNpb24uCiAgICAgICAgICAqLwotICAgICAgICBpZiAoIGVycm9yID09IDEgKQotICAgICAg
ICAgICAgZXJyb3IgPSAwOworICAgICAgICBpZiAoIChtaWNyb2NvZGVfdXBkYXRlX21hdGNoKCZu
ZXdfcGF0Y2gtPm1jX2ludGVsLT5oZHIpICE9IE1JU19VQ09ERSkgJiYKKyAgICAgICAgICAgICAo
IXBhdGNoIHx8IChjb21wYXJlX3BhdGNoKG5ld19wYXRjaCwgcGF0Y2gpID09IE5FV19VQ09ERSkp
ICkKKyAgICAgICAgeworICAgICAgICAgICAgc3RydWN0IG1pY3JvY29kZV9wYXRjaCAqdG1wID0g
cGF0Y2g7CisKKyAgICAgICAgICAgIHBhdGNoID0gbmV3X3BhdGNoOworICAgICAgICAgICAgbmV3
X3BhdGNoID0gdG1wOworICAgICAgICB9CisKKyAgICAgICAgaWYgKCBuZXdfcGF0Y2ggKQorICAg
ICAgICAgICAgbWljcm9jb2RlX2ZyZWVfcGF0Y2gobmV3X3BhdGNoKTsKIAogICAgICAgICB4ZnJl
ZShtYyk7CiAgICAgfQpAQCAtNDI3LDEwICs0MjcsMTAgQEAgc3RhdGljIGludCBjcHVfcmVxdWVz
dF9taWNyb2NvZGUoY29uc3Qgdm9pZCAqYnVmLCBzaXplX3Qgc2l6ZSkKICAgICBpZiAoIG9mZnNl
dCA8IDAgKQogICAgICAgICBlcnJvciA9IG9mZnNldDsKIAotICAgIGlmICggIWVycm9yICYmIG1h
dGNoX2NwdShtaWNyb2NvZGVfZ2V0X2NhY2hlKCkpICkKLSAgICAgICAgZXJyb3IgPSBhcHBseV9t
aWNyb2NvZGUobWljcm9jb2RlX2dldF9jYWNoZSgpKTsKKyAgICBpZiAoIGVycm9yICYmICFwYXRj
aCApCisgICAgICAgIHBhdGNoID0gRVJSX1BUUihlcnJvcik7CiAKLSAgICByZXR1cm4gZXJyb3I7
CisgICAgcmV0dXJuIHBhdGNoOwogfQogCiBzdGF0aWMgY29uc3Qgc3RydWN0IG1pY3JvY29kZV9v
cHMgbWljcm9jb2RlX2ludGVsX29wcyA9IHsKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL2FzbS14
ODYvbWljcm9jb2RlLmggYi94ZW4vaW5jbHVkZS9hc20teDg2L21pY3JvY29kZS5oCmluZGV4IDAy
ZmViMDkuLjdkNWExZjggMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL2FzbS14ODYvbWljcm9jb2Rl
LmgKKysrIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9taWNyb2NvZGUuaApAQCAtMjAsNyArMjAsOCBA
QCBzdHJ1Y3QgbWljcm9jb2RlX3BhdGNoIHsKIH07CiAKIHN0cnVjdCBtaWNyb2NvZGVfb3BzIHsK
LSAgICBpbnQgKCpjcHVfcmVxdWVzdF9taWNyb2NvZGUpKGNvbnN0IHZvaWQgKmJ1Ziwgc2l6ZV90
IHNpemUpOworICAgIHN0cnVjdCBtaWNyb2NvZGVfcGF0Y2ggKigqY3B1X3JlcXVlc3RfbWljcm9j
b2RlKShjb25zdCB2b2lkICpidWYsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHNpemVfdCBzaXplKTsKICAgICBpbnQgKCpjb2xsZWN0X2NwdV9p
bmZvKShzdHJ1Y3QgY3B1X3NpZ25hdHVyZSAqY3NpZyk7CiAgICAgaW50ICgqYXBwbHlfbWljcm9j
b2RlKShjb25zdCBzdHJ1Y3QgbWljcm9jb2RlX3BhdGNoICpwYXRjaCk7CiAgICAgaW50ICgqc3Rh
cnRfdXBkYXRlKSh2b2lkKTsKQEAgLTQwLDggKzQxLDYgQEAgc3RydWN0IGNwdV9zaWduYXR1cmUg
ewogREVDTEFSRV9QRVJfQ1BVKHN0cnVjdCBjcHVfc2lnbmF0dXJlLCBjcHVfc2lnKTsKIGV4dGVy
biBjb25zdCBzdHJ1Y3QgbWljcm9jb2RlX29wcyAqbWljcm9jb2RlX29wczsKIAotY29uc3Qgc3Ry
dWN0IG1pY3JvY29kZV9wYXRjaCAqbWljcm9jb2RlX2dldF9jYWNoZSh2b2lkKTsKLWJvb2wgbWlj
cm9jb2RlX3VwZGF0ZV9jYWNoZShzdHJ1Y3QgbWljcm9jb2RlX3BhdGNoICpwYXRjaCk7CiB2b2lk
IG1pY3JvY29kZV9mcmVlX3BhdGNoKHN0cnVjdCBtaWNyb2NvZGVfcGF0Y2ggKnBhdGNoKTsKIAog
I2VuZGlmIC8qIEFTTV9YODZfX01JQ1JPQ09ERV9IICovCi0tIAoxLjguMy4xCgoKX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcg
bGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9q
ZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

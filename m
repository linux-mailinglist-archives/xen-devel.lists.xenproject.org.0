Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 10EAEB2AC0
	for <lists+xen-devel@lfdr.de>; Sat, 14 Sep 2019 10:57:58 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i93pT-0001os-6y; Sat, 14 Sep 2019 08:54:51 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=rDpt=XJ=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1i93pQ-0001lE-OF
 for xen-devel@lists.xenproject.org; Sat, 14 Sep 2019 08:54:48 +0000
X-Inumbo-ID: 11ba32d6-d6cd-11e9-95c1-12813bfff9fa
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 11ba32d6-d6cd-11e9-95c1-12813bfff9fa;
 Sat, 14 Sep 2019 08:53:07 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 6AB99B676;
 Sat, 14 Sep 2019 08:53:05 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Sat, 14 Sep 2019 10:52:38 +0200
Message-Id: <20190914085251.18816-35-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190914085251.18816-1-jgross@suse.com>
References: <20190914085251.18816-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v3 34/47] xen/sched: add fall back to idle vcpu
 when scheduling unit
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>,
 Dario Faggioli <dfaggioli@suse.com>,
 Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

V2hlbiBzY2hlZHVsaW5nIGFuIHVuaXQgd2l0aCBtdWx0aXBsZSB2Y3B1cyB0aGVyZSBpcyBubyBn
dWFyYW50ZWUgYWxsCnZjcHVzIGFyZSBhdmFpbGFibGUgKGUuZy4gYWJvdmUgbWF4dmNwdXMgb3Ig
dmNwdSBvZmZsaW5lKS4gRmFsbCBiYWNrIHRvCmlkbGUgdmNwdSBvZiB0aGUgY3VycmVudCBjcHUg
aW4gdGhhdCBjYXNlLiBUaGlzIHJlcXVpcmVzIHRvIHN0b3JlIHRoZQpjb3JyZWN0IHNjaGVkdWxl
X3VuaXQgcG9pbnRlciBpbiB0aGUgaWRsZSB2Y3B1IGFzIGxvbmcgYXMgaXQgdXNlZCBhcwpmYWxs
YmFjayB2Y3B1LgoKSW4gb3JkZXIgdG8gbW9kaWZ5IHRoZSBydW5zdGF0ZXMgb2YgdGhlIGNvcnJl
Y3QgdmNwdXMgd2hlbiBzd2l0Y2hpbmcKc2NoZWR1bGUgdW5pdHMgbWVyZ2Ugc2NoZWRfdW5pdF9y
dW5zdGF0ZV9jaGFuZ2UoKSBpbnRvCnNjaGVkX3N3aXRjaF91bml0cygpIGFuZCBsb29wIG92ZXIg
dGhlIGFmZmVjdGVkIHBoeXNpY2FsIGNwdXMgaW5zdGVhZApvZiB0aGUgdW5pdCdzIHZjcHVzLiBU
aGlzIGluIHR1cm4gcmVxdWlyZXMgYW4gYWNjZXNzIGZ1bmN0aW9uIHRvIHRoZQpjdXJyZW50IHZh
cmlhYmxlIG9mIG90aGVyIGNwdXMuCgpUb2RheSBjb250ZXh0X3NhdmVkKCkgaXMgY2FsbGVkIGlu
IGNhc2UgcHJldmlvdXMgYW5kIG5leHQgdmNwdXMgZGlmZmVyCndoZW4gZG9pbmcgYSBjb250ZXh0
IHN3aXRjaC4gV2l0aCBhbiBpZGxlIHZjcHUgYmVpbmcgY2FwYWJsZSB0byBiZSBhCnN1YnN0aXR1
dGUgZm9yIGFuIG9mZmxpbmUgdmNwdSB0aGlzIGlzIHByb2JsZW1hdGljIHdoZW4gc3dpdGNoaW5n
IHRvCmFuIGlkbGUgc2NoZWR1bGluZyB1bml0LiBBbiBpZGxlIHByZXZpb3VzIHZjcHUgbGVhdmVz
IHVzIGluIGRvdWJ0IHdoaWNoCnNjaGVkdWxlIHVuaXQgd2FzIGFjdGl2ZSBwcmV2aW91c2x5LCBz
byBzYXZlIHRoZSBwcmV2aW91cyB1bml0IHBvaW50ZXIKaW4gdGhlIHBlci1zY2hlZHVsZSByZXNv
dXJjZSBhcmVhLiBJZiBpdCBpcyBOVUxMIHRoZSB1bml0IGhhcyBub3QKY2hhbmdlZCBhbmQgd2Ug
ZG9uJ3QgaGF2ZSB0byBzZXQgdGhlIHByZXZpb3VzIHVuaXQgdG8gYmUgbm90IHJ1bm5pbmcuCgpX
aGVuIHJ1bm5pbmcgYW4gaWRsZSB2Y3B1IGluIGEgbm9uLWlkbGUgc2NoZWR1bGluZyB1bml0IHVz
ZSBhIHNwZWNpZmljCmd1ZXN0IGlkbGUgbG9vcCBub3QgcGVyZm9ybWluZyBhbnkgdGFza2xldHMg
YW5kIGxpdmVwYXRjaGluZyBpbiBvcmRlcgp0byBhdm9pZCBwb3B1bGF0aW5nIHRoZSBjcHUgY2Fj
aGVzIHdpdGggbWVtb3J5IHVzZWQgYnkgb3RoZXIgZG9tYWlucwooYXMgZmFyIGFzIHBvc3NpYmxl
KS4gU29mdGlycXMgYXJlIGNvbnNpZGVyZWQgdG8gYmUgc2F2ZS4KCkluIG9yZGVyIHRvIGF2b2lk
IGxpdmVwYXRjaGluZyB3aGVuIGdvaW5nIHRvIGd1ZXN0IGlkbGUgYW5vdGhlcgp2YXJpYW50IG9m
IHJlc2V0X3N0YWNrX2FuZF9qdW1wKCkgbm90IGNhbGxpbmcgY2hlY2tfZm9yX2xpdmVwYXRjaF93
b3JrCmlzIG5lZWRlZC4KClNpZ25lZC1vZmYtYnk6IEp1ZXJnZW4gR3Jvc3MgPGpncm9zc0BzdXNl
LmNvbT4KQWNrZWQtYnk6IEp1bGllbiBHcmFsbCA8anVsaWVuLmdyYWxsQGFybS5jb20+Ci0tLQpS
RkMgVjI6Ci0gbmV3IHBhdGNoIChBbmRyZXcgQ29vcGVyKQoKVjE6Ci0gdXNlIHVyZ2VudF9jb3Vu
dCB0byBzZWxlY3QgY29ycmVjdCBpZGxlIHJvdXRpbmUgKEphbiBCZXVsaWNoKQoKVjI6Ci0gc2V0
IHZjcHUtPmlzX3J1bm5pbmcgaW4gY29udGV4dF9zYXZlZCgpCi0gaW50cm9kdWNlIHJlc2V0X3N0
YWNrX2FuZF9qdW1wX25vbHAoKSAoSmFuIEJldWxpY2gpCi0gcmVhZGQgc2NydWJiaW5nIChKYW4g
QmV1bGljaCwgQW5kcmV3IENvb3BlcikKLSBnZXRfY3B1X2N1cnJlbnQoKSBfTk9UXyBtb3ZlZCB0
byBpbmNsdWRlL2FzbS14ODYvY3VycmVudC5oIGFzIHRoZQogIG5lZWRlZCByZWZlcmVuY2Ugb2Yg
c3RhY2tfYmFzZVtdIHJlc3VsdHMgaW4gYSAjaW5jbHVkZSBoZWxsCgpWMzoKLSBzcGxpdCBjb250
ZXh0X3NhdmVkKCkgaW50byB1bml0X2NvbnRleHRfc2F2ZWQoKSBhbmQgdmNwdV9jb250ZXh0X3Nh
dmVkKCkKLS0tCiB4ZW4vYXJjaC94ODYvZG9tYWluLmMgICAgICAgICB8ICAyMyArKysrKysKIHhl
bi9jb21tb24vc2NoZWR1bGUuYyAgICAgICAgIHwgMTgwICsrKysrKysrKysrKysrKysrKysrKysr
KysrKysrLS0tLS0tLS0tLS0tLQogeGVuL2luY2x1ZGUvYXNtLWFybS9jdXJyZW50LmggfCAgIDEg
KwogeGVuL2luY2x1ZGUvYXNtLXg4Ni9jdXJyZW50LmggfCAgMTkgKysrKy0KIHhlbi9pbmNsdWRl
L2FzbS14ODYvc21wLmggICAgIHwgICAzICsKIHhlbi9pbmNsdWRlL3hlbi9zY2hlZC1pZi5oICAg
IHwgICA0ICstCiB4ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaCAgICAgICB8ICAgMSArCiA3IGZpbGVz
IGNoYW5nZWQsIDE3MCBpbnNlcnRpb25zKCspLCA2MSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQg
YS94ZW4vYXJjaC94ODYvZG9tYWluLmMgYi94ZW4vYXJjaC94ODYvZG9tYWluLmMKaW5kZXggNmYz
MTMyNjgyZC4uOGQ0MzBkMzhjMiAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L2RvbWFpbi5jCisr
KyBiL3hlbi9hcmNoL3g4Ni9kb21haW4uYwpAQCAtMTU5LDYgKzE1OSwyNSBAQCBzdGF0aWMgdm9p
ZCBpZGxlX2xvb3Aodm9pZCkKICAgICB9CiB9CiAKKy8qCisgKiBJZGxlIGxvb3AgZm9yIHNpYmxp
bmdzIGluIGFjdGl2ZSBzY2hlZHVsZSB1bml0cy4KKyAqIFdlIGRvbid0IGRvIGFueSBzdGFuZGFy
ZCBpZGxlIHdvcmsgbGlrZSB0YXNrbGV0cyBvciBsaXZlcGF0Y2hpbmcuCisgKi8KK3N0YXRpYyB2
b2lkIGd1ZXN0X2lkbGVfbG9vcCh2b2lkKQoreworICAgIHVuc2lnbmVkIGludCBjcHUgPSBzbXBf
cHJvY2Vzc29yX2lkKCk7CisKKyAgICBmb3IgKCA7IDsgKQorICAgIHsKKyAgICAgICAgQVNTRVJU
KCFjcHVfaXNfb2ZmbGluZShjcHUpKTsKKworICAgICAgICBpZiAoICFzb2Z0aXJxX3BlbmRpbmco
Y3B1KSAmJiAhc2NydWJfZnJlZV9wYWdlcygpICYmCisgICAgICAgICAgICAgIXNvZnRpcnFfcGVu
ZGluZyhjcHUpKQorICAgICAgICAgICAgc2NoZWRfZ3Vlc3RfaWRsZShwbV9pZGxlLCBjcHUpOwor
ICAgICAgICBkb19zb2Z0aXJxKCk7CisgICAgfQorfQorCiB2b2lkIHN0YXJ0dXBfY3B1X2lkbGVf
bG9vcCh2b2lkKQogewogICAgIHN0cnVjdCB2Y3B1ICp2ID0gY3VycmVudDsKQEAgLTE3Miw2ICsx
OTEsMTAgQEAgdm9pZCBzdGFydHVwX2NwdV9pZGxlX2xvb3Aodm9pZCkKIAogc3RhdGljIHZvaWQg
bm9yZXR1cm4gY29udGludWVfaWRsZV9kb21haW4oc3RydWN0IHZjcHUgKnYpCiB7CisgICAgLyog
SWRsZSB2Y3B1cyBtaWdodCBiZSBhdHRhY2hlZCB0byBub24taWRsZSB1bml0cyEgKi8KKyAgICBp
ZiAoICFpc19pZGxlX2RvbWFpbih2LT5zY2hlZF91bml0LT5kb21haW4pICkKKyAgICAgICAgcmVz
ZXRfc3RhY2tfYW5kX2p1bXBfbm9scChndWVzdF9pZGxlX2xvb3ApOworCiAgICAgcmVzZXRfc3Rh
Y2tfYW5kX2p1bXAoaWRsZV9sb29wKTsKIH0KIApkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hl
ZHVsZS5jIGIveGVuL2NvbW1vbi9zY2hlZHVsZS5jCmluZGV4IDI0NmFkMzhjN2QuLmQ1M2M2MGI5
NjYgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vc2NoZWR1bGUuYworKysgYi94ZW4vY29tbW9uL3Nj
aGVkdWxlLmMKQEAgLTEzNiwxMCArMTM2LDIxIEBAIHN0YXRpYyBzdHJ1Y3Qgc2NoZWR1bGVyIHNj
aGVkX2lkbGVfb3BzID0gewogICAgIC5zd2l0Y2hfc2NoZWQgICA9IHNjaGVkX2lkbGVfc3dpdGNo
X3NjaGVkLAogfTsKIAorc3RhdGljIGlubGluZSBzdHJ1Y3QgdmNwdSAqdW5pdDJ2Y3B1X2NwdShz
dHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgdW5zaWduZWQgaW50IGNwdSkKK3sKKyAgICB1bnNpZ25lZCBpbnQgaWR4ID0gdW5p
dC0+dW5pdF9pZCArIHBlcl9jcHUoc2NoZWRfcmVzX2lkeCwgY3B1KTsKKyAgICBjb25zdCBzdHJ1
Y3QgZG9tYWluICpkID0gdW5pdC0+ZG9tYWluOworCisgICAgcmV0dXJuIChpZHggPCBkLT5tYXhf
dmNwdXMpID8gZC0+dmNwdVtpZHhdIDogTlVMTDsKK30KKwogc3RhdGljIGlubGluZSBzdHJ1Y3Qg
dmNwdSAqc2NoZWRfdW5pdDJ2Y3B1X2NwdShzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCwKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IGNw
dSkKIHsKLSAgICByZXR1cm4gdW5pdC0+ZG9tYWluLT52Y3B1W3VuaXQtPnVuaXRfaWQgKyBwZXJf
Y3B1KHNjaGVkX3Jlc19pZHgsIGNwdSldOworICAgIHN0cnVjdCB2Y3B1ICp2ID0gdW5pdDJ2Y3B1
X2NwdSh1bml0LCBjcHUpOworCisgICAgcmV0dXJuICh2ICYmIHYtPm5ld19zdGF0ZSA9PSBSVU5T
VEFURV9ydW5uaW5nKSA/IHYgOiBpZGxlX3ZjcHVbY3B1XTsKIH0KIAogc3RhdGljIGlubGluZSBz
dHJ1Y3Qgc2NoZWR1bGVyICpkb21fc2NoZWR1bGVyKGNvbnN0IHN0cnVjdCBkb21haW4gKmQpCkBA
IC0yNTksOCArMjcwLDExIEBAIHN0YXRpYyBpbmxpbmUgdm9pZCB2Y3B1X3J1bnN0YXRlX2NoYW5n
ZSgKIAogICAgIHRyYWNlX3J1bnN0YXRlX2NoYW5nZSh2LCBuZXdfc3RhdGUpOwogCi0gICAgdW5p
dC0+cnVuc3RhdGVfY250W3YtPnJ1bnN0YXRlLnN0YXRlXS0tOwotICAgIHVuaXQtPnJ1bnN0YXRl
X2NudFtuZXdfc3RhdGVdKys7CisgICAgaWYgKCAhaXNfaWRsZV92Y3B1KHYpICkKKyAgICB7Cisg
ICAgICAgIHVuaXQtPnJ1bnN0YXRlX2NudFt2LT5ydW5zdGF0ZS5zdGF0ZV0tLTsKKyAgICAgICAg
dW5pdC0+cnVuc3RhdGVfY250W25ld19zdGF0ZV0rKzsKKyAgICB9CiAKICAgICBkZWx0YSA9IG5l
d19lbnRyeV90aW1lIC0gdi0+cnVuc3RhdGUuc3RhdGVfZW50cnlfdGltZTsKICAgICBpZiAoIGRl
bHRhID4gMCApCkBAIC0yNzIsMTkgKzI4NiwxMSBAQCBzdGF0aWMgaW5saW5lIHZvaWQgdmNwdV9y
dW5zdGF0ZV9jaGFuZ2UoCiAgICAgdi0+cnVuc3RhdGUuc3RhdGUgPSBuZXdfc3RhdGU7CiB9CiAK
LXN0YXRpYyBpbmxpbmUgdm9pZCBzY2hlZF91bml0X3J1bnN0YXRlX2NoYW5nZShzdHJ1Y3Qgc2No
ZWRfdW5pdCAqdW5pdCwKLSAgICBib29sIHJ1bm5pbmcsIHNfdGltZV90IG5ld19lbnRyeV90aW1l
KQordm9pZCBzY2hlZF9ndWVzdF9pZGxlKHZvaWQgKCppZGxlKSAodm9pZCksIHVuc2lnbmVkIGlu
dCBjcHUpCiB7Ci0gICAgc3RydWN0IHZjcHUgKnY7Ci0KLSAgICBmb3JfZWFjaF9zY2hlZF91bml0
X3ZjcHUgKCB1bml0LCB2ICkKLSAgICAgICAgaWYgKCBydW5uaW5nICkKLSAgICAgICAgICAgIHZj
cHVfcnVuc3RhdGVfY2hhbmdlKHYsIHYtPm5ld19zdGF0ZSwgbmV3X2VudHJ5X3RpbWUpOwotICAg
ICAgICBlbHNlCi0gICAgICAgICAgICB2Y3B1X3J1bnN0YXRlX2NoYW5nZSh2LAotICAgICAgICAg
ICAgICAgICgodi0+cGF1c2VfZmxhZ3MgJiBWUEZfYmxvY2tlZCkgPyBSVU5TVEFURV9ibG9ja2Vk
IDoKLSAgICAgICAgICAgICAgICAgKHZjcHVfcnVubmFibGUodikgPyBSVU5TVEFURV9ydW5uYWJs
ZSA6IFJVTlNUQVRFX29mZmxpbmUpKSwKLSAgICAgICAgICAgICAgICBuZXdfZW50cnlfdGltZSk7
CisgICAgYXRvbWljX2luYygmcGVyX2NwdShzY2hlZF91cmdlbnRfY291bnQsIGNwdSkpOworICAg
IGlkbGUoKTsKKyAgICBhdG9taWNfZGVjKCZwZXJfY3B1KHNjaGVkX3VyZ2VudF9jb3VudCwgY3B1
KSk7CiB9CiAKIHZvaWQgdmNwdV9ydW5zdGF0ZV9nZXQoc3RydWN0IHZjcHUgKnYsIHN0cnVjdCB2
Y3B1X3J1bnN0YXRlX2luZm8gKnJ1bnN0YXRlKQpAQCAtNTIzLDYgKzUyOSw3IEBAIGludCBzY2hl
ZF9pbml0X3ZjcHUoc3RydWN0IHZjcHUgKnYpCiAgICAgaWYgKCBpc19pZGxlX2RvbWFpbihkKSAp
CiAgICAgewogICAgICAgICBnZXRfc2NoZWRfcmVzKHYtPnByb2Nlc3NvciktPmN1cnIgPSB1bml0
OworICAgICAgICBnZXRfc2NoZWRfcmVzKHYtPnByb2Nlc3NvciktPnNjaGVkX3VuaXRfaWRsZSA9
IHVuaXQ7CiAgICAgICAgIHYtPmlzX3J1bm5pbmcgPSAxOwogICAgICAgICB1bml0LT5pc19ydW5u
aW5nID0gMTsKICAgICAgICAgdW5pdC0+c3RhdGVfZW50cnlfdGltZSA9IE5PVygpOwpAQCAtODU1
LDcgKzg2Miw3IEBAIHN0YXRpYyB2b2lkIHNjaGVkX3VuaXRfbW92ZV9sb2NrZWQoc3RydWN0IHNj
aGVkX3VuaXQgKnVuaXQsCiAgKgogICogc2NoZWRfdW5pdF9taWdyYXRlX2ZpbmlzaCgpIHdpbGwg
ZG8gdGhlIHdvcmsgbm93IGlmIGl0IGNhbiwgb3Igc2ltcGx5CiAgKiByZXR1cm4gaWYgaXQgY2Fu
J3QgKGJlY2F1c2UgdW5pdCBpcyBzdGlsbCBydW5uaW5nKTsgaW4gdGhhdCBjYXNlCi0gKiBzY2hl
ZF91bml0X21pZ3JhdGVfZmluaXNoKCkgd2lsbCBiZSBjYWxsZWQgYnkgY29udGV4dF9zYXZlZCgp
LgorICogc2NoZWRfdW5pdF9taWdyYXRlX2ZpbmlzaCgpIHdpbGwgYmUgY2FsbGVkIGJ5IHVuaXRf
Y29udGV4dF9zYXZlZCgpLgogICovCiBzdGF0aWMgdm9pZCBzY2hlZF91bml0X21pZ3JhdGVfc3Rh
cnQoc3RydWN0IHNjaGVkX3VuaXQgKnVuaXQpCiB7CkBAIC04NzgsNyArODg1LDcgQEAgc3RhdGlj
IHZvaWQgc2NoZWRfdW5pdF9taWdyYXRlX2ZpbmlzaChzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCkK
IAogICAgIC8qCiAgICAgICogSWYgdGhlIHVuaXQgaXMgY3VycmVudGx5IHJ1bm5pbmcsIHRoaXMg
d2lsbCBiZSBoYW5kbGVkIGJ5Ci0gICAgICogY29udGV4dF9zYXZlZCgpOyBhbmQgaW4gYW55IGNh
c2UsIGlmIHRoZSBiaXQgaXMgY2xlYXJlZCwgdGhlbgorICAgICAqIHVuaXRfY29udGV4dF9zYXZl
ZCgpOyBhbmQgaW4gYW55IGNhc2UsIGlmIHRoZSBiaXQgaXMgY2xlYXJlZCwgdGhlbgogICAgICAq
IHNvbWVvbmUgZWxzZSBoYXMgYWxyZWFkeSBkb25lIHRoZSB3b3JrIHNvIHdlIGRvbid0IG5lZWQg
dG8uCiAgICAgICovCiAgICAgaWYgKCB1bml0LT5pc19ydW5uaW5nICkKQEAgLTE3NjcsMzMgKzE3
NzQsNjYgQEAgc3RhdGljIHZvaWQgc2NoZWRfc3dpdGNoX3VuaXRzKHN0cnVjdCBzY2hlZF9yZXNv
dXJjZSAqc2QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHNjaGVkX3Vu
aXQgKm5leHQsIHN0cnVjdCBzY2hlZF91bml0ICpwcmV2LAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHNfdGltZV90IG5vdykKIHsKLSAgICBzZC0+Y3VyciA9IG5leHQ7Ci0KLSAgICBU
UkFDRV8zRChUUkNfU0NIRURfU1dJVENIX0lORlBSRVYsIHByZXYtPmRvbWFpbi0+ZG9tYWluX2lk
LCBwcmV2LT51bml0X2lkLAotICAgICAgICAgICAgIG5vdyAtIHByZXYtPnN0YXRlX2VudHJ5X3Rp
bWUpOwotICAgIFRSQUNFXzREKFRSQ19TQ0hFRF9TV0lUQ0hfSU5GTkVYVCwgbmV4dC0+ZG9tYWlu
LT5kb21haW5faWQsIG5leHQtPnVuaXRfaWQsCi0gICAgICAgICAgICAgKG5leHQtPnZjcHVfbGlz
dC0+cnVuc3RhdGUuc3RhdGUgPT0gUlVOU1RBVEVfcnVubmFibGUpID8KLSAgICAgICAgICAgICAo
bm93IC0gbmV4dC0+c3RhdGVfZW50cnlfdGltZSkgOiAwLCBwcmV2LT5uZXh0X3RpbWUpOworICAg
IGludCBjcHU7CiAKICAgICBBU1NFUlQodW5pdF9ydW5uaW5nKHByZXYpKTsKIAotICAgIFRSQUNF
XzREKFRSQ19TQ0hFRF9TV0lUQ0gsIHByZXYtPmRvbWFpbi0+ZG9tYWluX2lkLCBwcmV2LT51bml0
X2lkLAotICAgICAgICAgICAgIG5leHQtPmRvbWFpbi0+ZG9tYWluX2lkLCBuZXh0LT51bml0X2lk
KTsKKyAgICBpZiAoIHByZXYgIT0gbmV4dCApCisgICAgeworICAgICAgICBzZC0+Y3VyciA9IG5l
eHQ7CisgICAgICAgIHNkLT5wcmV2ID0gcHJldjsKIAotICAgIHNjaGVkX3VuaXRfcnVuc3RhdGVf
Y2hhbmdlKHByZXYsIGZhbHNlLCBub3cpOworICAgICAgICBUUkFDRV8zRChUUkNfU0NIRURfU1dJ
VENIX0lORlBSRVYsIHByZXYtPmRvbWFpbi0+ZG9tYWluX2lkLAorICAgICAgICAgICAgICAgICBw
cmV2LT51bml0X2lkLCBub3cgLSBwcmV2LT5zdGF0ZV9lbnRyeV90aW1lKTsKKyAgICAgICAgVFJB
Q0VfNEQoVFJDX1NDSEVEX1NXSVRDSF9JTkZORVhULCBuZXh0LT5kb21haW4tPmRvbWFpbl9pZCwK
KyAgICAgICAgICAgICAgICAgbmV4dC0+dW5pdF9pZCwKKyAgICAgICAgICAgICAgICAgKG5leHQt
PnZjcHVfbGlzdC0+cnVuc3RhdGUuc3RhdGUgPT0gUlVOU1RBVEVfcnVubmFibGUpID8KKyAgICAg
ICAgICAgICAgICAgKG5vdyAtIG5leHQtPnN0YXRlX2VudHJ5X3RpbWUpIDogMCwgcHJldi0+bmV4
dF90aW1lKTsKKyAgICAgICAgVFJBQ0VfNEQoVFJDX1NDSEVEX1NXSVRDSCwgcHJldi0+ZG9tYWlu
LT5kb21haW5faWQsIHByZXYtPnVuaXRfaWQsCisgICAgICAgICAgICAgICAgIG5leHQtPmRvbWFp
bi0+ZG9tYWluX2lkLCBuZXh0LT51bml0X2lkKTsKIAotICAgIEFTU0VSVCghdW5pdF9ydW5uaW5n
KG5leHQpKTsKLSAgICBzY2hlZF91bml0X3J1bnN0YXRlX2NoYW5nZShuZXh0LCB0cnVlLCBub3cp
OworICAgICAgICBBU1NFUlQoIXVuaXRfcnVubmluZyhuZXh0KSk7CiAKLSAgICAvKgotICAgICAq
IE5CLiBEb24ndCBhZGQgYW55IHRyYWNlIHJlY29yZHMgZnJvbSBoZXJlIHVudGlsIHRoZSBhY3R1
YWwgY29udGV4dAotICAgICAqIHN3aXRjaCwgZWxzZSBsb3N0X3JlY29yZHMgcmVzdW1lIHdpbGwg
bm90IHdvcmsgcHJvcGVybHkuCi0gICAgICovCisgICAgICAgIC8qCisgICAgICAgICAqIE5CLiBE
b24ndCBhZGQgYW55IHRyYWNlIHJlY29yZHMgZnJvbSBoZXJlIHVudGlsIHRoZSBhY3R1YWwgY29u
dGV4dAorICAgICAgICAgKiBzd2l0Y2gsIGVsc2UgbG9zdF9yZWNvcmRzIHJlc3VtZSB3aWxsIG5v
dCB3b3JrIHByb3Blcmx5LgorICAgICAgICAgKi8KKworICAgICAgICBBU1NFUlQoIW5leHQtPmlz
X3J1bm5pbmcpOworICAgICAgICBuZXh0LT5pc19ydW5uaW5nID0gMTsKKyAgICAgICAgbmV4dC0+
c3RhdGVfZW50cnlfdGltZSA9IG5vdzsKKworICAgICAgICBpZiAoIGlzX2lkbGVfdW5pdChwcmV2
KSApCisgICAgICAgIHsKKyAgICAgICAgICAgIHByZXYtPnJ1bnN0YXRlX2NudFtSVU5TVEFURV9y
dW5uaW5nXSA9IDA7CisgICAgICAgICAgICBwcmV2LT5ydW5zdGF0ZV9jbnRbUlVOU1RBVEVfcnVu
bmFibGVdID0gc2NoZWRfZ3JhbnVsYXJpdHk7CisgICAgICAgIH0KKyAgICAgICAgaWYgKCBpc19p
ZGxlX3VuaXQobmV4dCkgKQorICAgICAgICB7CisgICAgICAgICAgICBuZXh0LT5ydW5zdGF0ZV9j
bnRbUlVOU1RBVEVfcnVubmluZ10gPSBzY2hlZF9ncmFudWxhcml0eTsKKyAgICAgICAgICAgIG5l
eHQtPnJ1bnN0YXRlX2NudFtSVU5TVEFURV9ydW5uYWJsZV0gPSAwOworICAgICAgICB9CisgICAg
fQorCisgICAgZm9yX2VhY2hfY3B1ICggY3B1LCBzZC0+Y3B1cyApCisgICAgeworICAgICAgICBz
dHJ1Y3QgdmNwdSAqdnByZXYgPSBnZXRfY3B1X2N1cnJlbnQoY3B1KTsKKyAgICAgICAgc3RydWN0
IHZjcHUgKnZuZXh0ID0gc2NoZWRfdW5pdDJ2Y3B1X2NwdShuZXh0LCBjcHUpOworCisgICAgICAg
IGlmICggdnByZXYgIT0gdm5leHQgfHwgdnByZXYtPnJ1bnN0YXRlLnN0YXRlICE9IHZuZXh0LT5u
ZXdfc3RhdGUgKQorICAgICAgICB7CisgICAgICAgICAgICB2Y3B1X3J1bnN0YXRlX2NoYW5nZSh2
cHJldiwKKyAgICAgICAgICAgICAgICAoKHZwcmV2LT5wYXVzZV9mbGFncyAmIFZQRl9ibG9ja2Vk
KSA/IFJVTlNUQVRFX2Jsb2NrZWQgOgorICAgICAgICAgICAgICAgICAodmNwdV9ydW5uYWJsZSh2
cHJldikgPyBSVU5TVEFURV9ydW5uYWJsZSA6IFJVTlNUQVRFX29mZmxpbmUpKSwKKyAgICAgICAg
ICAgICAgICBub3cpOworICAgICAgICAgICAgdmNwdV9ydW5zdGF0ZV9jaGFuZ2Uodm5leHQsIHZu
ZXh0LT5uZXdfc3RhdGUsIG5vdyk7CisgICAgICAgIH0KIAotICAgIEFTU0VSVCghbmV4dC0+aXNf
cnVubmluZyk7Ci0gICAgbmV4dC0+dmNwdV9saXN0LT5pc19ydW5uaW5nID0gMTsKLSAgICBuZXh0
LT5pc19ydW5uaW5nID0gMTsKLSAgICBuZXh0LT5zdGF0ZV9lbnRyeV90aW1lID0gbm93OworICAg
ICAgICB2bmV4dC0+aXNfcnVubmluZyA9IDE7CisKKyAgICAgICAgaWYgKCBpc19pZGxlX3ZjcHUo
dm5leHQpICkKKyAgICAgICAgICAgIHZuZXh0LT5zY2hlZF91bml0ID0gbmV4dDsKKyAgICB9CiB9
CiAKIHN0YXRpYyBib29sIHNjaGVkX3Rhc2tsZXRfY2hlY2tfY3B1KHVuc2lnbmVkIGludCBjcHUp
CkBAIC0xODQ5LDI5ICsxODg5LDM5IEBAIHN0YXRpYyBzdHJ1Y3Qgc2NoZWRfdW5pdCAqZG9fc2No
ZWR1bGUoc3RydWN0IHNjaGVkX3VuaXQgKnByZXYsIHNfdGltZV90IG5vdywKICAgICBpZiAoIHBy
ZXYtPm5leHRfdGltZSA+PSAwICkgLyogLXZlIG1lYW5zIG5vIGxpbWl0ICovCiAgICAgICAgIHNl
dF90aW1lcigmc2QtPnNfdGltZXIsIG5vdyArIHByZXYtPm5leHRfdGltZSk7CiAKLSAgICBpZiAo
IGxpa2VseShwcmV2ICE9IG5leHQpICkKLSAgICAgICAgc2NoZWRfc3dpdGNoX3VuaXRzKHNkLCBu
ZXh0LCBwcmV2LCBub3cpOworICAgIHNjaGVkX3N3aXRjaF91bml0cyhzZCwgbmV4dCwgcHJldiwg
bm93KTsKIAogICAgIHJldHVybiBuZXh0OwogfQogCi1zdGF0aWMgdm9pZCBjb250ZXh0X3NhdmVk
KHN0cnVjdCB2Y3B1ICpwcmV2KQorc3RhdGljIHZvaWQgdmNwdV9jb250ZXh0X3NhdmVkKHN0cnVj
dCB2Y3B1ICp2cHJldiwgc3RydWN0IHZjcHUgKnZuZXh0KQogewotICAgIHN0cnVjdCBzY2hlZF91
bml0ICp1bml0ID0gcHJldi0+c2NoZWRfdW5pdDsKLQogICAgIC8qIENsZWFyIHJ1bm5pbmcgZmxh
ZyAvYWZ0ZXIvIHdyaXRpbmcgY29udGV4dCB0byBtZW1vcnkuICovCiAgICAgc21wX3dtYigpOwog
Ci0gICAgcHJldi0+aXNfcnVubmluZyA9IDA7CisgICAgaWYgKCB2cHJldiAhPSB2bmV4dCApCisg
ICAgICAgIHZwcmV2LT5pc19ydW5uaW5nID0gMDsKK30KKworc3RhdGljIHZvaWQgdW5pdF9jb250
ZXh0X3NhdmVkKHN0cnVjdCBzY2hlZF9yZXNvdXJjZSAqc2QpCit7CisgICAgc3RydWN0IHNjaGVk
X3VuaXQgKnVuaXQgPSBzZC0+cHJldjsKKworICAgIGlmICggIXVuaXQgKQorICAgICAgICByZXR1
cm47CisKICAgICB1bml0LT5pc19ydW5uaW5nID0gMDsKICAgICB1bml0LT5zdGF0ZV9lbnRyeV90
aW1lID0gTk9XKCk7CisgICAgc2QtPnByZXYgPSBOVUxMOwogCiAgICAgLyogQ2hlY2sgZm9yIG1p
Z3JhdGlvbiByZXF1ZXN0IC9hZnRlci8gY2xlYXJpbmcgcnVubmluZyBmbGFnLiAqLwogICAgIHNt
cF9tYigpOwogCi0gICAgc2NoZWRfY29udGV4dF9zYXZlZCh2Y3B1X3NjaGVkdWxlcihwcmV2KSwg
dW5pdCk7CisgICAgc2NoZWRfY29udGV4dF9zYXZlZCh1bml0X3NjaGVkdWxlcih1bml0KSwgdW5p
dCk7CiAKLSAgICBzY2hlZF91bml0X21pZ3JhdGVfZmluaXNoKHVuaXQpOworICAgIC8qIElkbGUg
bmV2ZXIgbWlncmF0ZXMgYW5kIGlkbGUgdmNwdXMgbWlnaHQgYmVsb25nIHRvIG90aGVyIHVuaXRz
LiAqLworICAgIGlmICggIWlzX2lkbGVfdW5pdCh1bml0KSApCisgICAgICAgIHNjaGVkX3VuaXRf
bWlncmF0ZV9maW5pc2godW5pdCk7CiB9CiAKIC8qCkBAIC0xODgxLDM1ICsxOTMxLDQ0IEBAIHN0
YXRpYyB2b2lkIGNvbnRleHRfc2F2ZWQoc3RydWN0IHZjcHUgKnByZXYpCiAgKiBUaGUgY291bnRl
ciB3aWxsIGJlIDAgaW4gY2FzZSBubyByZW5kZXp2b3VzIGlzIG5lZWRlZC4gRm9yIHRoZSByZW5k
ZXp2b3VzCiAgKiBjYXNlIGl0IGlzIGluaXRpYWxpc2VkIHRvIHRoZSBudW1iZXIgb2YgY3B1cyB0
byByZW5kZXp2b3VzIHBsdXMgMS4gRWFjaAogICogbWVtYmVyIGVudGVyaW5nIGRlY3JlbWVudHMg
dGhlIGNvdW50ZXIuIFRoZSBsYXN0IG9uZSB3aWxsIGRlY3JlbWVudCBpdCB0bwotICogMSBhbmQg
cGVyZm9ybSB0aGUgZmluYWwgbmVlZGVkIGFjdGlvbiBpbiB0aGF0IGNhc2UgKGNhbGwgb2YgY29u
dGV4dF9zYXZlZCgpCi0gKiBpZiB2Y3B1IHdhcyBzd2l0Y2hlZCksIGFuZCB0aGVuIHNldCB0aGUg
Y291bnRlciB0byB6ZXJvLiBUaGUgb3RoZXIgbWVtYmVycworICogMSBhbmQgcGVyZm9ybSB0aGUg
ZmluYWwgbmVlZGVkIGFjdGlvbiBpbiB0aGF0IGNhc2UgKGNhbGwgb2YKKyAqIHVuaXRfY29udGV4
dF9zYXZlZCgpKSwgYW5kIHRoZW4gc2V0IHRoZSBjb3VudGVyIHRvIHplcm8uIFRoZSBvdGhlciBt
ZW1iZXJzCiAgKiB3aWxsIHdhaXQgdW50aWwgdGhlIGNvdW50ZXIgYmVjb21lcyB6ZXJvIHVudGls
IHRoZXkgcHJvY2VlZC4KICAqLwogdm9pZCBzY2hlZF9jb250ZXh0X3N3aXRjaGVkKHN0cnVjdCB2
Y3B1ICp2cHJldiwgc3RydWN0IHZjcHUgKnZuZXh0KQogewogICAgIHN0cnVjdCBzY2hlZF91bml0
ICpuZXh0ID0gdm5leHQtPnNjaGVkX3VuaXQ7CisgICAgc3RydWN0IHNjaGVkX3Jlc291cmNlICpz
ZCA9IGdldF9zY2hlZF9yZXMoc21wX3Byb2Nlc3Nvcl9pZCgpKTsKIAogICAgIGlmICggYXRvbWlj
X3JlYWQoJm5leHQtPnJlbmRlenZvdXNfb3V0X2NudCkgKQogICAgIHsKICAgICAgICAgaW50IGNu
dCA9IGF0b21pY19kZWNfcmV0dXJuKCZuZXh0LT5yZW5kZXp2b3VzX291dF9jbnQpOwogCi0gICAg
ICAgIC8qIENhbGwgY29udGV4dF9zYXZlZCgpIGJlZm9yZSByZWxlYXNpbmcgb3RoZXIgd2FpdGVy
cy4gKi8KKyAgICAgICAgdmNwdV9jb250ZXh0X3NhdmVkKHZwcmV2LCB2bmV4dCk7CisKKyAgICAg
ICAgLyogQ2FsbCB1bml0X2NvbnRleHRfc2F2ZWQoKSBiZWZvcmUgcmVsZWFzaW5nIG90aGVyIHdh
aXRlcnMuICovCiAgICAgICAgIGlmICggY250ID09IDEgKQogICAgICAgICB7Ci0gICAgICAgICAg
ICBpZiAoIHZwcmV2ICE9IHZuZXh0ICkKLSAgICAgICAgICAgICAgICBjb250ZXh0X3NhdmVkKHZw
cmV2KTsKKyAgICAgICAgICAgIHVuaXRfY29udGV4dF9zYXZlZChzZCk7CiAgICAgICAgICAgICBh
dG9taWNfc2V0KCZuZXh0LT5yZW5kZXp2b3VzX291dF9jbnQsIDApOwogICAgICAgICB9CiAgICAg
ICAgIGVsc2UKICAgICAgICAgICAgIHdoaWxlICggYXRvbWljX3JlYWQoJm5leHQtPnJlbmRlenZv
dXNfb3V0X2NudCkgKQogICAgICAgICAgICAgICAgIGNwdV9yZWxheCgpOwogICAgIH0KLSAgICBl
bHNlIGlmICggdnByZXYgIT0gdm5leHQgJiYgc2NoZWRfZ3JhbnVsYXJpdHkgPT0gMSApCi0gICAg
ICAgIGNvbnRleHRfc2F2ZWQodnByZXYpOworICAgIGVsc2UKKyAgICB7CisgICAgICAgIHZjcHVf
Y29udGV4dF9zYXZlZCh2cHJldiwgdm5leHQpOworICAgICAgICBpZiAoIHNjaGVkX2dyYW51bGFy
aXR5ID09IDEgKQorICAgICAgICAgICAgdW5pdF9jb250ZXh0X3NhdmVkKHNkKTsKKyAgICB9CisK
KyAgICBpZiAoIGlzX2lkbGVfdmNwdSh2cHJldikgJiYgdnByZXYgIT0gdm5leHQgKQorICAgICAg
ICB2cHJldi0+c2NoZWRfdW5pdCA9IHNkLT5zY2hlZF91bml0X2lkbGU7CiB9CiAKIHN0YXRpYyB2
b2lkIHNjaGVkX2NvbnRleHRfc3dpdGNoKHN0cnVjdCB2Y3B1ICp2cHJldiwgc3RydWN0IHZjcHUg
KnZuZXh0LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc190aW1lX3Qgbm93KQor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9vbCByZXNldF9pZGxlX3VuaXQsIHNf
dGltZV90IG5vdykKIHsKICAgICBpZiAoIHVubGlrZWx5KHZwcmV2ID09IHZuZXh0KSApCiAgICAg
ewpAQCAtMTkxOCw2ICsxOTc3LDExIEBAIHN0YXRpYyB2b2lkIHNjaGVkX2NvbnRleHRfc3dpdGNo
KHN0cnVjdCB2Y3B1ICp2cHJldiwgc3RydWN0IHZjcHUgKnZuZXh0LAogICAgICAgICAgICAgICAg
ICBub3cgLSB2cHJldi0+cnVuc3RhdGUuc3RhdGVfZW50cnlfdGltZSwKICAgICAgICAgICAgICAg
ICAgdnByZXYtPnNjaGVkX3VuaXQtPm5leHRfdGltZSk7CiAgICAgICAgIHNjaGVkX2NvbnRleHRf
c3dpdGNoZWQodnByZXYsIHZuZXh0KTsKKworICAgICAgICBpZiAoIHJlc2V0X2lkbGVfdW5pdCAp
CisgICAgICAgICAgICB2bmV4dC0+c2NoZWRfdW5pdCA9CisgICAgICAgICAgICAgICAgZ2V0X3Nj
aGVkX3JlcyhzbXBfcHJvY2Vzc29yX2lkKCkpLT5zY2hlZF91bml0X2lkbGU7CisKICAgICAgICAg
dHJhY2VfY29udGludWVfcnVubmluZyh2bmV4dCk7CiAgICAgICAgIHJldHVybiBjb250aW51ZV9y
dW5uaW5nKHZwcmV2KTsKICAgICB9CkBAIC0xOTc2LDcgKzIwNDAsNyBAQCBzdGF0aWMgc3RydWN0
IHNjaGVkX3VuaXQgKnNjaGVkX3dhaXRfcmVuZGV6dm91c19pbihzdHJ1Y3Qgc2NoZWRfdW5pdCAq
cHJldiwKICAgICAgICAgICAgIHBjcHVfc2NoZWR1bGVfdW5sb2NrX2lycSgqbG9jaywgY3B1KTsK
IAogICAgICAgICAgICAgcmFpc2Vfc29mdGlycShTQ0hFRF9TTEFWRV9TT0ZUSVJRKTsKLSAgICAg
ICAgICAgIHNjaGVkX2NvbnRleHRfc3dpdGNoKHZwcmV2LCB2cHJldiwgbm93KTsKKyAgICAgICAg
ICAgIHNjaGVkX2NvbnRleHRfc3dpdGNoKHZwcmV2LCB2cHJldiwgZmFsc2UsIG5vdyk7CiAgICAg
ICAgIH0KIAogICAgICAgICBwY3B1X3NjaGVkdWxlX3VubG9ja19pcnEoKmxvY2ssIGNwdSk7CkBA
IC0yMDE1LDcgKzIwNzksOCBAQCBzdGF0aWMgdm9pZCBzY2hlZF9zbGF2ZSh2b2lkKQogCiAgICAg
cGNwdV9zY2hlZHVsZV91bmxvY2tfaXJxKGxvY2ssIGNwdSk7CiAKLSAgICBzY2hlZF9jb250ZXh0
X3N3aXRjaCh2cHJldiwgc2NoZWRfdW5pdDJ2Y3B1X2NwdShuZXh0LCBjcHUpLCBub3cpOworICAg
IHNjaGVkX2NvbnRleHRfc3dpdGNoKHZwcmV2LCBzY2hlZF91bml0MnZjcHVfY3B1KG5leHQsIGNw
dSksCisgICAgICAgICAgICAgICAgICAgICAgICAgaXNfaWRsZV91bml0KG5leHQpICYmICFpc19p
ZGxlX3VuaXQocHJldiksIG5vdyk7CiB9CiAKIC8qCkBAIC0yMDc1LDcgKzIxNDAsOCBAQCBzdGF0
aWMgdm9pZCBzY2hlZHVsZSh2b2lkKQogICAgIHBjcHVfc2NoZWR1bGVfdW5sb2NrX2lycShsb2Nr
LCBjcHUpOwogCiAgICAgdm5leHQgPSBzY2hlZF91bml0MnZjcHVfY3B1KG5leHQsIGNwdSk7Ci0g
ICAgc2NoZWRfY29udGV4dF9zd2l0Y2godnByZXYsIHZuZXh0LCBub3cpOworICAgIHNjaGVkX2Nv
bnRleHRfc3dpdGNoKHZwcmV2LCB2bmV4dCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAhaXNf
aWRsZV91bml0KHByZXYpICYmIGlzX2lkbGVfdW5pdChuZXh0KSwgbm93KTsKIH0KIAogLyogVGhl
IHNjaGVkdWxlciB0aW1lcjogZm9yY2UgYSBydW4gdGhyb3VnaCB0aGUgc2NoZWR1bGVyICovCkBA
IC0yMTQ2LDYgKzIyMTIsNyBAQCBzdGF0aWMgaW50IGNwdV9zY2hlZHVsZV91cCh1bnNpZ25lZCBp
bnQgY3B1KQogICAgICAqLwogCiAgICAgc2QtPmN1cnIgPSBpZGxlX3ZjcHVbY3B1XS0+c2NoZWRf
dW5pdDsKKyAgICBzZC0+c2NoZWRfdW5pdF9pZGxlID0gaWRsZV92Y3B1W2NwdV0tPnNjaGVkX3Vu
aXQ7CiAKICAgICBzZC0+c2NoZWRfcHJpdiA9IE5VTEw7CiAKQEAgLTIzMTUsNiArMjM4Miw3IEBA
IHZvaWQgX19pbml0IHNjaGVkdWxlcl9pbml0KHZvaWQpCiAgICAgaWYgKCB2Y3B1X2NyZWF0ZShp
ZGxlX2RvbWFpbiwgMCkgPT0gTlVMTCApCiAgICAgICAgIEJVRygpOwogICAgIGdldF9zY2hlZF9y
ZXMoMCktPmN1cnIgPSBpZGxlX3ZjcHVbMF0tPnNjaGVkX3VuaXQ7CisgICAgZ2V0X3NjaGVkX3Jl
cygwKS0+c2NoZWRfdW5pdF9pZGxlID0gaWRsZV92Y3B1WzBdLT5zY2hlZF91bml0OwogfQogCiAv
KgpkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUvYXNtLWFybS9jdXJyZW50LmggYi94ZW4vaW5jbHVk
ZS9hc20tYXJtL2N1cnJlbnQuaAppbmRleCAxNjUzZTg5ZDMwLi44OGJlYjQ2NDVhIDEwMDY0NAot
LS0gYS94ZW4vaW5jbHVkZS9hc20tYXJtL2N1cnJlbnQuaAorKysgYi94ZW4vaW5jbHVkZS9hc20t
YXJtL2N1cnJlbnQuaApAQCAtMTgsNiArMTgsNyBAQCBERUNMQVJFX1BFUl9DUFUoc3RydWN0IHZj
cHUgKiwgY3Vycl92Y3B1KTsKIAogI2RlZmluZSBjdXJyZW50ICAgICAgICAgICAgKHRoaXNfY3B1
KGN1cnJfdmNwdSkpCiAjZGVmaW5lIHNldF9jdXJyZW50KHZjcHUpICBkbyB7IGN1cnJlbnQgPSAo
dmNwdSk7IH0gd2hpbGUgKDApCisjZGVmaW5lIGdldF9jcHVfY3VycmVudChjcHUpICAocGVyX2Nw
dShjdXJyX3ZjcHUsIGNwdSkpCiAKIC8qIFBlci1WQ1BVIHN0YXRlIHRoYXQgbGl2ZXMgYXQgdGhl
IHRvcCBvZiB0aGUgc3RhY2sgKi8KIHN0cnVjdCBjcHVfaW5mbyB7CmRpZmYgLS1naXQgYS94ZW4v
aW5jbHVkZS9hc20teDg2L2N1cnJlbnQuaCBiL3hlbi9pbmNsdWRlL2FzbS14ODYvY3VycmVudC5o
CmluZGV4IGYzNTA4YzNjMDguLjBiNDc0ODUzMzcgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL2Fz
bS14ODYvY3VycmVudC5oCisrKyBiL3hlbi9pbmNsdWRlL2FzbS14ODYvY3VycmVudC5oCkBAIC03
Nyw2ICs3NywxMSBAQCBzdHJ1Y3QgY3B1X2luZm8gewogICAgIC8qIGdldF9zdGFja19ib3R0b20o
KSBtdXN0IGJlIDE2LWJ5dGUgYWxpZ25lZCAqLwogfTsKIAorc3RhdGljIGlubGluZSBzdHJ1Y3Qg
Y3B1X2luZm8gKmdldF9jcHVfaW5mb19mcm9tX3N0YWNrKHVuc2lnbmVkIGxvbmcgc3ApCit7Cisg
ICAgcmV0dXJuIChzdHJ1Y3QgY3B1X2luZm8gKikoKHNwIHwgKFNUQUNLX1NJWkUgLSAxKSkgKyAx
KSAtIDE7Cit9CisKIHN0YXRpYyBpbmxpbmUgc3RydWN0IGNwdV9pbmZvICpnZXRfY3B1X2luZm8o
dm9pZCkKIHsKICNpZmRlZiBfX2NsYW5nX18KQEAgLTg3LDcgKzkyLDcgQEAgc3RhdGljIGlubGlu
ZSBzdHJ1Y3QgY3B1X2luZm8gKmdldF9jcHVfaW5mbyh2b2lkKQogICAgIHJlZ2lzdGVyIHVuc2ln
bmVkIGxvbmcgc3AgYXNtKCJyc3AiKTsKICNlbmRpZgogCi0gICAgcmV0dXJuIChzdHJ1Y3QgY3B1
X2luZm8gKikoKHNwIHwgKFNUQUNLX1NJWkUgLSAxKSkgKyAxKSAtIDE7CisgICAgcmV0dXJuIGdl
dF9jcHVfaW5mb19mcm9tX3N0YWNrKHNwKTsKIH0KIAogI2RlZmluZSBnZXRfY3VycmVudCgpICAg
ICAgICAgKGdldF9jcHVfaW5mbygpLT5jdXJyZW50X3ZjcHUpCkBAIC0xMjQsMTYgKzEyOSwyMiBA
QCB1bnNpZ25lZCBsb25nIGdldF9zdGFja19kdW1wX2JvdHRvbSAodW5zaWduZWQgbG9uZyBzcCk7
CiAjIGRlZmluZSBDSEVDS19GT1JfTElWRVBBVENIX1dPUksgIiIKICNlbmRpZgogCi0jZGVmaW5l
IHJlc2V0X3N0YWNrX2FuZF9qdW1wKF9fZm4pICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBcCisjZGVmaW5lIHN3aXRjaF9zdGFja19hbmRfanVtcChmbiwgaW5zdHIpICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBcCiAgICAgKHsgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCiAgICAgICAgIF9f
YXNtX18gX192b2xhdGlsZV9fICggICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBcCiAgICAgICAgICAgICAibW92ICUwLCUlIl9fT1Aic3A7IiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBcCi0gICAgICAgICAgICBDSEVDS19GT1JfTElWRVBBVENI
X1dPUksgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwKKyAgICAgICAgICAg
IGluc3RyICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIFwKICAgICAgICAgICAgICAiam1wICVjMSIgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIFwKLSAgICAgICAgICAgIDogOiAiciIgKGd1ZXN0X2NwdV91
c2VyX3JlZ3MoKSksICJpIiAoX19mbikgOiAibWVtb3J5IiApOyAgIFwKKyAgICAgICAgICAgIDog
OiAiciIgKGd1ZXN0X2NwdV91c2VyX3JlZ3MoKSksICJpIiAoZm4pIDogIm1lbW9yeSIgKTsgICAg
IFwKICAgICAgICAgdW5yZWFjaGFibGUoKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIFwKICAgICB9KQogCisjZGVmaW5lIHJlc2V0X3N0YWNrX2FuZF9q
dW1wKGZuKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCisgICAgc3dp
dGNoX3N0YWNrX2FuZF9qdW1wKGZuLCBDSEVDS19GT1JfTElWRVBBVENIX1dPUkspCisKKyNkZWZp
bmUgcmVzZXRfc3RhY2tfYW5kX2p1bXBfbm9scChmbikgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIFwKKyAgICBzd2l0Y2hfc3RhY2tfYW5kX2p1bXAoZm4sICIiKQorCiAvKgogICog
V2hpY2ggVkNQVSdzIHN0YXRlIGlzIGN1cnJlbnRseSBydW5uaW5nIG9uIGVhY2ggQ1BVPwogICog
VGhpcyBpcyBub3QgbmVjZXNhc3JpbHkgdGhlIHNhbWUgYXMgJ2N1cnJlbnQnIGFzIGEgQ1BVIG1h
eSBiZQpkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUvYXNtLXg4Ni9zbXAuaCBiL3hlbi9pbmNsdWRl
L2FzbS14ODYvc21wLmgKaW5kZXggOWY1MzNmOTA3Mi4uNTFhMzFhYjAwYSAxMDA2NDQKLS0tIGEv
eGVuL2luY2x1ZGUvYXNtLXg4Ni9zbXAuaAorKysgYi94ZW4vaW5jbHVkZS9hc20teDg2L3NtcC5o
CkBAIC03Niw2ICs3Niw5IEBAIHZvaWQgc2V0X25yX3NvY2tldHModm9pZCk7CiAvKiBSZXByZXNl
bnRpbmcgSFQgYW5kIGNvcmUgc2libGluZ3MgaW4gZWFjaCBzb2NrZXQuICovCiBleHRlcm4gY3B1
bWFza190ICoqc29ja2V0X2NwdW1hc2s7CiAKKyNkZWZpbmUgZ2V0X2NwdV9jdXJyZW50KGNwdSkg
XAorICAgIChnZXRfY3B1X2luZm9fZnJvbV9zdGFjaygodW5zaWduZWQgbG9uZylzdGFja19iYXNl
W2NwdV0pLT5jdXJyZW50X3ZjcHUpCisKICNlbmRpZiAvKiAhX19BU1NFTUJMWV9fICovCiAKICNl
bmRpZgpkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUveGVuL3NjaGVkLWlmLmggYi94ZW4vaW5jbHVk
ZS94ZW4vc2NoZWQtaWYuaAppbmRleCA4NGQwNjU4NTc4Li4yOTI5MTU0ZDM1IDEwMDY0NAotLS0g
YS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQtaWYuaAorKysgYi94ZW4vaW5jbHVkZS94ZW4vc2NoZWQt
aWYuaApAQCAtMzksNiArMzksOCBAQCBzdHJ1Y3Qgc2NoZWRfcmVzb3VyY2UgewogICAgIHNwaW5s
b2NrX3QgICAgICAgICAqc2NoZWR1bGVfbG9jaywKICAgICAgICAgICAgICAgICAgICAgICAgX2xv
Y2s7CiAgICAgc3RydWN0IHNjaGVkX3VuaXQgICpjdXJyOworICAgIHN0cnVjdCBzY2hlZF91bml0
ICAqc2NoZWRfdW5pdF9pZGxlOworICAgIHN0cnVjdCBzY2hlZF91bml0ICAqcHJldjsKICAgICB2
b2lkICAgICAgICAgICAgICAgKnNjaGVkX3ByaXY7CiAgICAgc3RydWN0IHRpbWVyICAgICAgICBz
X3RpbWVyOyAgICAgICAgLyogc2NoZWR1bGluZyB0aW1lciAgICAgICAgICAgICAgICAqLwogCkBA
IC0xODAsNyArMTgyLDcgQEAgc3RhdGljIGlubGluZSB2b2lkIHNjaGVkX2NsZWFyX3BhdXNlX2Zs
YWdzX2F0b21pYyhzdHJ1Y3Qgc2NoZWRfdW5pdCAqdW5pdCwKIAogc3RhdGljIGlubGluZSBzdHJ1
Y3Qgc2NoZWRfdW5pdCAqc2NoZWRfaWRsZV91bml0KHVuc2lnbmVkIGludCBjcHUpCiB7Ci0gICAg
cmV0dXJuIGlkbGVfdmNwdVtjcHVdLT5zY2hlZF91bml0OworICAgIHJldHVybiBnZXRfc2NoZWRf
cmVzKGNwdSktPnNjaGVkX3VuaXRfaWRsZTsKIH0KIAogc3RhdGljIGlubGluZSB1bnNpZ25lZCBp
bnQgc2NoZWRfZ2V0X3Jlc291cmNlX2NwdSh1bnNpZ25lZCBpbnQgY3B1KQpkaWZmIC0tZ2l0IGEv
eGVuL2luY2x1ZGUveGVuL3NjaGVkLmggYi94ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaAppbmRleCA1
YjgwNWVhYzU4Li4xNDRkMzUzNDQ3IDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQu
aAorKysgYi94ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaApAQCAtOTI5LDYgKzkyOSw3IEBAIHZvaWQg
cmVzdG9yZV92Y3B1X2FmZmluaXR5KHN0cnVjdCBkb21haW4gKmQpOwogCiB2b2lkIHZjcHVfcnVu
c3RhdGVfZ2V0KHN0cnVjdCB2Y3B1ICp2LCBzdHJ1Y3QgdmNwdV9ydW5zdGF0ZV9pbmZvICpydW5z
dGF0ZSk7CiB1aW50NjRfdCBnZXRfY3B1X2lkbGVfdGltZSh1bnNpZ25lZCBpbnQgY3B1KTsKK3Zv
aWQgc2NoZWRfZ3Vlc3RfaWRsZSh2b2lkICgqaWRsZSkgKHZvaWQpLCB1bnNpZ25lZCBpbnQgY3B1
KTsKIAogLyoKICAqIFVzZWQgYnkgaWRsZSBsb29wIHRvIGRlY2lkZSB3aGV0aGVyIHRoZXJlIGlz
IHdvcmsgdG8gZG86Ci0tIAoyLjE2LjQKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54
ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGlu
Zm8veGVuLWRldmVs

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 08C863573C
	for <lists+xen-devel@lfdr.de>; Wed,  5 Jun 2019 08:55:30 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hYPld-0007q1-Qb; Wed, 05 Jun 2019 06:51:25 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=73hT=UE=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1hYPlc-0007pv-9y
 for xen-devel@lists.xenproject.org; Wed, 05 Jun 2019 06:51:24 +0000
X-Inumbo-ID: 5220a74c-875e-11e9-9fa1-ef2a96732007
Received: from prv1-mh.provo.novell.com (unknown [137.65.248.33])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 5220a74c-875e-11e9-9fa1-ef2a96732007;
 Wed, 05 Jun 2019 06:51:19 +0000 (UTC)
Received: from INET-PRV1-MTA by prv1-mh.provo.novell.com
 with Novell_GroupWise; Wed, 05 Jun 2019 00:51:17 -0600
Message-Id: <5CF766640200007800235564@prv1-mh.provo.novell.com>
X-Mailer: Novell GroupWise Internet Agent 18.1.1 
Date: Wed, 05 Jun 2019 00:51:16 -0600
From: "Jan Beulich" <JBeulich@suse.com>
To: "xen-devel" <xen-devel@lists.xenproject.org>
Mime-Version: 1.0
Content-Disposition: inline
Subject: [Xen-devel] [PATCH v2] timers: limit heap size
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <Ian.Jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

Rmlyc3QgYW5kIGZvcmVtb3N0IG1ha2UgdGltZXJfc29mdGlycV9hY3Rpb24oKSBhdm9pZCBncm93
aW5nIHRoZSBoZWFwCmlmIGl0cyBuZXcgc2l6ZSBjYW4ndCBiZSBzdG9yZWQgd2l0aG91dCB0cnVu
Y2F0aW9uLiA2NGsgZW50cmllcyBpcyBhCmxvdCwgYW5kIEkgZG9uJ3QgdGhpbmsgd2UncmUgYXQg
cmlzayBvZiBhY3R1YWxseSBydW5uaW5nIGludG8gdGhlIGlzc3VlLApidXQgSSBhbHNvIHRoaW5r
IGl0J3MgYmV0dGVyIG5vdCB0byBhbGxvdyBmb3IgaGFyZCB0byBkZWJ1ZyBwcm9ibGVtcyB0bwpv
Y2N1ciBpbiB0aGUgZmlyc3QgcGxhY2UuCgpGdXJ0aGVybW9yZSBhbHNvIGFkanVzdCB0aGUgY29k
ZSBzdWNoIHRoZSBzaXplL2xpbWl0IGZpZWxkcyBiZWNvbWluZwp1bnNpZ25lZCBpbnQgd291bGQg
YXQgbGVhc3Qgd29yayBmcm9tIGEgbWVyZSBzaXppbmcgcG9pbnQgb2Ygdmlldy4gRm9yCnRoaXMg
YWxzbyBzd2l0Y2ggdmFyaW91cyB1c2VzIG9mIHBsYWluIGludCB0byB1bnNpZ25lZCBpbnQuCgpT
aWduZWQtb2ZmLWJ5OiBKYW4gQmV1bGljaCA8amJldWxpY2hAc3VzZS5jb20+Ci0tLQp2MjogTG9n
IChvbmNlKSB3aGVuIGhlYXAgbGltaXQgd291bGQgaGF2ZSBiZWVuIGV4Y2VlZGVkLgoKLS0tIGEv
eGVuL2NvbW1vbi90aW1lci5jCisrKyBiL3hlbi9jb21tb24vdGltZXIuYwpAQCAtNjMsOSArNjMs
OSBAQCBzdGF0aWMgc3RydWN0IGhlYXBfbWV0YWRhdGEgKmhlYXBfbWV0YWRhCiB9CiAKIC8qIFNp
bmsgZG93biBlbGVtZW50IEBwb3Mgb2YgQGhlYXAuICovCi1zdGF0aWMgdm9pZCBkb3duX2hlYXAo
c3RydWN0IHRpbWVyICoqaGVhcCwgaW50IHBvcykKK3N0YXRpYyB2b2lkIGRvd25faGVhcChzdHJ1
Y3QgdGltZXIgKipoZWFwLCB1bnNpZ25lZCBpbnQgcG9zKQogewotICAgIGludCBzeiA9IGhlYXBf
bWV0YWRhdGEoaGVhcCktPnNpemUsIG54dDsKKyAgICB1bnNpZ25lZCBpbnQgc3ogPSBoZWFwX21l
dGFkYXRhKGhlYXApLT5zaXplLCBueHQ7CiAgICAgc3RydWN0IHRpbWVyICp0ID0gaGVhcFtwb3Nd
OwogCiAgICAgd2hpbGUgKCAobnh0ID0gKHBvcyA8PCAxKSkgPD0gc3ogKQpAQCAtODQsNyArODQs
NyBAQCBzdGF0aWMgdm9pZCBkb3duX2hlYXAoc3RydWN0IHRpbWVyICoqaGVhCiB9CiAKIC8qIEZs
b2F0IGVsZW1lbnQgQHBvcyB1cCBAaGVhcC4gKi8KLXN0YXRpYyB2b2lkIHVwX2hlYXAoc3RydWN0
IHRpbWVyICoqaGVhcCwgaW50IHBvcykKK3N0YXRpYyB2b2lkIHVwX2hlYXAoc3RydWN0IHRpbWVy
ICoqaGVhcCwgdW5zaWduZWQgaW50IHBvcykKIHsKICAgICBzdHJ1Y3QgdGltZXIgKnQgPSBoZWFw
W3Bvc107CiAKQEAgLTEwMyw4ICsxMDMsOCBAQCBzdGF0aWMgdm9pZCB1cF9oZWFwKHN0cnVjdCB0
aW1lciAqKmhlYXAsCiAvKiBEZWxldGUgQHQgZnJvbSBAaGVhcC4gUmV0dXJuIFRSVUUgaWYgbmV3
IHRvcCBvZiBoZWFwLiAqLwogc3RhdGljIGludCByZW1vdmVfZnJvbV9oZWFwKHN0cnVjdCB0aW1l
ciAqKmhlYXAsIHN0cnVjdCB0aW1lciAqdCkKIHsKLSAgICBpbnQgc3ogPSBoZWFwX21ldGFkYXRh
KGhlYXApLT5zaXplOwotICAgIGludCBwb3MgPSB0LT5oZWFwX29mZnNldDsKKyAgICB1bnNpZ25l
ZCBpbnQgc3ogPSBoZWFwX21ldGFkYXRhKGhlYXApLT5zaXplOworICAgIHVuc2lnbmVkIGludCBw
b3MgPSB0LT5oZWFwX29mZnNldDsKIAogICAgIGlmICggdW5saWtlbHkocG9zID09IHN6KSApCiAg
ICAgewpAQCAtMTMwLDcgKzEzMCw3IEBAIHN0YXRpYyBpbnQgcmVtb3ZlX2Zyb21faGVhcChzdHJ1
Y3QgdGltZXIKIC8qIEFkZCBuZXcgZW50cnkgQHQgdG8gQGhlYXAuIFJldHVybiBUUlVFIGlmIG5l
dyB0b3Agb2YgaGVhcC4gKi8KIHN0YXRpYyBpbnQgYWRkX3RvX2hlYXAoc3RydWN0IHRpbWVyICoq
aGVhcCwgc3RydWN0IHRpbWVyICp0KQogewotICAgIGludCBzeiA9IGhlYXBfbWV0YWRhdGEoaGVh
cCktPnNpemU7CisgICAgdW5zaWduZWQgaW50IHN6ID0gaGVhcF9tZXRhZGF0YShoZWFwKS0+c2l6
ZTsKIAogICAgIC8qIEZhaWwgaWYgdGhlIGhlYXAgaXMgZnVsbC4gKi8KICAgICBpZiAoIHVubGlr
ZWx5KHN6ID09IGhlYXBfbWV0YWRhdGEoaGVhcCktPmxpbWl0KSApCkBAIC00NjMsOSArNDYzLDE3
IEBAIHN0YXRpYyB2b2lkIHRpbWVyX3NvZnRpcnFfYWN0aW9uKHZvaWQpCiAgICAgaWYgKCB1bmxp
a2VseSh0cy0+bGlzdCAhPSBOVUxMKSApCiAgICAgewogICAgICAgICAvKiBvbGRfbGltaXQgPT0g
KDJebiktMTsgbmV3X2xpbWl0ID09ICgyXihuKzQpKS0xICovCi0gICAgICAgIGludCBvbGRfbGlt
aXQgPSBoZWFwX21ldGFkYXRhKGhlYXApLT5saW1pdDsKLSAgICAgICAgaW50IG5ld19saW1pdCA9
ICgob2xkX2xpbWl0ICsgMSkgPDwgNCkgLSAxOwotICAgICAgICBzdHJ1Y3QgdGltZXIgKipuZXdo
ZWFwID0geG1hbGxvY19hcnJheShzdHJ1Y3QgdGltZXIgKiwgbmV3X2xpbWl0ICsgMSk7CisgICAg
ICAgIHVuc2lnbmVkIGludCBvbGRfbGltaXQgPSBoZWFwX21ldGFkYXRhKGhlYXApLT5saW1pdDsK
KyAgICAgICAgdW5zaWduZWQgaW50IG5ld19saW1pdCA9ICgob2xkX2xpbWl0ICsgMSkgPDwgNCkg
LSAxOworICAgICAgICBzdHJ1Y3QgdGltZXIgKipuZXdoZWFwID0gTlVMTDsKKworICAgICAgICAv
KiBEb24ndCBncm93IHRoZSBoZWFwIGJleW9uZCB3aGF0IGlzIHJlcHJlc2VudGFibGUgaW4gaXRz
IG1ldGFkYXRhLiAqLworICAgICAgICBpZiAoIG5ld19saW1pdCA9PSAodHlwZW9mKGhlYXBfbWV0
YWRhdGEoaGVhcCktPmxpbWl0KSluZXdfbGltaXQgJiYKKyAgICAgICAgICAgICBuZXdfbGltaXQg
KyAxICkKKyAgICAgICAgICAgIG5ld2hlYXAgPSB4bWFsbG9jX2FycmF5KHN0cnVjdCB0aW1lciAq
LCBuZXdfbGltaXQgKyAxKTsKKyAgICAgICAgZWxzZQorICAgICAgICAgICAgcHJpbnRrX29uY2Uo
WEVOTE9HX1dBUk5JTkcgIkNQVSV1OiB0aW1lciBoZWFwIGxpbWl0IHJlYWNoZWRcbiIsCisgICAg
ICAgICAgICAgICAgICAgICAgICBzbXBfcHJvY2Vzc29yX2lkKCkpOwogICAgICAgICBpZiAoIG5l
d2hlYXAgIT0gTlVMTCApCiAgICAgICAgIHsKICAgICAgICAgICAgIHNwaW5fbG9ja19pcnEoJnRz
LT5sb2NrKTsKQEAgLTU0NCw3ICs1NDksNyBAQCBzdGF0aWMgdm9pZCBkdW1wX3RpbWVycSh1bnNp
Z25lZCBjaGFyIGtlCiAgICAgc3RydWN0IHRpbWVycyAqdHM7CiAgICAgdW5zaWduZWQgbG9uZyAg
ZmxhZ3M7CiAgICAgc190aW1lX3QgICAgICAgbm93ID0gTk9XKCk7Ci0gICAgaW50ICAgICAgICAg
ICAgaSwgajsKKyAgICB1bnNpZ25lZCBpbnQgICBpLCBqOwogCiAgICAgcHJpbnRrKCJEdW1waW5n
IHRpbWVyIHF1ZXVlczpcbiIpOwogCkBAIC01NTYsNyArNTYxLDcgQEAgc3RhdGljIHZvaWQgZHVt
cF90aW1lcnEodW5zaWduZWQgY2hhciBrZQogICAgICAgICBzcGluX2xvY2tfaXJxc2F2ZSgmdHMt
PmxvY2ssIGZsYWdzKTsKICAgICAgICAgZm9yICggaiA9IDE7IGogPD0gaGVhcF9tZXRhZGF0YSh0
cy0+aGVhcCktPnNpemU7IGorKyApCiAgICAgICAgICAgICBkdW1wX3RpbWVyKHRzLT5oZWFwW2pd
LCBub3cpOwotICAgICAgICBmb3IgKCB0ID0gdHMtPmxpc3QsIGogPSAwOyB0ICE9IE5VTEw7IHQg
PSB0LT5saXN0X25leHQsIGorKyApCisgICAgICAgIGZvciAoIHQgPSB0cy0+bGlzdDsgdCAhPSBO
VUxMOyB0ID0gdC0+bGlzdF9uZXh0ICkKICAgICAgICAgICAgIGR1bXBfdGltZXIodCwgbm93KTsK
ICAgICAgICAgc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmdHMtPmxvY2ssIGZsYWdzKTsKICAgICB9
CgoKCgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVu
LWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6
Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 38D5D2C483
	for <lists+xen-devel@lfdr.de>; Tue, 28 May 2019 12:37:14 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hVZR3-0006ee-N1; Tue, 28 May 2019 10:34:25 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=31/0=T4=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1hVZQG-0004x4-8h
 for xen-devel@lists.xenproject.org; Tue, 28 May 2019 10:33:36 +0000
X-Inumbo-ID: 08f6329f-8134-11e9-8980-bc764e045a96
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 08f6329f-8134-11e9-8980-bc764e045a96;
 Tue, 28 May 2019 10:33:30 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id B0C11B07D;
 Tue, 28 May 2019 10:33:29 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Tue, 28 May 2019 12:33:04 +0200
Message-Id: <20190528103313.1343-52-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190528103313.1343-1-jgross@suse.com>
References: <20190528103313.1343-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH 51/60] xen/sched: use one schedule lock for all
 free cpus
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Dario Faggioli <dfaggioli@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

SW4gb3JkZXIgdG8gcHJlcGFyZSB1c2luZyBhbHdheXMgY3B1IHNjaGVkdWxpbmcgZm9yIGZyZWUg
Y3B1cwpyZWdhcmRsZXNzIG9mIG90aGVyIGNwdXBvb2xzIHNjaGVkdWxpbmcgZ3JhbnVsYXJpdHkg
YWx3YXlzIHVzZSBhIHNpbmdsZQpmaXhlZCBsb2NrIGZvciBhbGwgZnJlZSBjcHVzIHNoYXJlZCBi
eSBhbGwgc2NoZWR1bGVycy4gVGhpcyB3aWxsIGFsbG93CnRvIG1vdmUgYW55IG51bWJlciBvZiBm
cmVlIGNwdXMgdG8gYSBjcHVwb29sIGd1YXJkZWQgYnkgb25seSBvbmUgbG9jay4KClRoaXMgcmVx
dWlyZXMgdG8gZHJvcCBBU1NFUlRzIHJlZ2FyZGluZyB0aGUgbG9jayBpbiBzb21lIHNjaGVkdWxl
cnMuCgpTaWduZWQtb2ZmLWJ5OiBKdWVyZ2VuIEdyb3NzIDxqZ3Jvc3NAc3VzZS5jb20+Ci0tLQog
eGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQuYyB8IDkgLS0tLS0tLS0tCiB4ZW4vY29tbW9uL3NjaGVk
X251bGwuYyAgIHwgNyAtLS0tLS0tCiB4ZW4vY29tbW9uL3NjaGVkdWxlLmMgICAgIHwgNyArKysr
Ky0tCiAzIGZpbGVzIGNoYW5nZWQsIDUgaW5zZXJ0aW9ucygrKSwgMTggZGVsZXRpb25zKC0pCgpk
aWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZF9jcmVkaXQuYyBiL3hlbi9jb21tb24vc2NoZWRf
Y3JlZGl0LmMKaW5kZXggOTY5YWM0Y2MyMC4uMGIxNGZhOWUxMSAxMDA2NDQKLS0tIGEveGVuL2Nv
bW1vbi9zY2hlZF9jcmVkaXQuYworKysgYi94ZW4vY29tbW9uL3NjaGVkX2NyZWRpdC5jCkBAIC02
MTYsMTUgKzYxNiw2IEBAIGNzY2hlZF9pbml0X3BkYXRhKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIg
Km9wcywgdm9pZCAqcGRhdGEsIGludCBjcHUpCiB7CiAgICAgdW5zaWduZWQgbG9uZyBmbGFnczsK
ICAgICBzdHJ1Y3QgY3NjaGVkX3ByaXZhdGUgKnBydiA9IENTQ0hFRF9QUklWKG9wcyk7Ci0gICAg
c3RydWN0IHNjaGVkX3Jlc291cmNlICpzZCA9IGdldF9zY2hlZF9yZXMoY3B1KTsKLQotICAgIC8q
Ci0gICAgICogVGhpcyBpcyBjYWxsZWQgZWl0aGVyIGR1cmluZyBkdXJpbmcgYm9vdCwgcmVzdW1l
IG9yIGhvdHBsdWcsIGluCi0gICAgICogY2FzZSBDcmVkaXQxIGlzIHRoZSBzY2hlZHVsZXIgY2hv
c2VuIGF0IGJvb3QuIEluIHN1Y2ggY2FzZXMsIHRoZQotICAgICAqIHNjaGVkdWxlciBsb2NrIGZv
ciBjcHUgaXMgYWxyZWFkeSBwb2ludGluZyB0byB0aGUgZGVmYXVsdCBwZXItY3B1Ci0gICAgICog
c3BpbmxvY2ssIGFzIENyZWRpdDEgbmVlZHMgaXQsIHNvIHRoZXJlIGlzIG5vIHJlbWFwcGluZyB0
byBiZSBkb25lLgotICAgICAqLwotICAgIEFTU0VSVChzZC0+c2NoZWR1bGVfbG9jayA9PSAmc2Qt
Pl9sb2NrICYmICFzcGluX2lzX2xvY2tlZCgmc2QtPl9sb2NrKSk7CiAKICAgICBzcGluX2xvY2tf
aXJxc2F2ZSgmcHJ2LT5sb2NrLCBmbGFncyk7CiAgICAgaW5pdF9wZGF0YShwcnYsIHBkYXRhLCBj
cHUpOwpkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9zY2hlZF9udWxsLmMgYi94ZW4vY29tbW9uL3Nj
aGVkX251bGwuYwppbmRleCBlOTMzNmEyOTQ4Li4xNDk5YzgyNDIyIDEwMDY0NAotLS0gYS94ZW4v
Y29tbW9uL3NjaGVkX251bGwuYworKysgYi94ZW4vY29tbW9uL3NjaGVkX251bGwuYwpAQCAtMTY5
LDE3ICsxNjksMTAgQEAgc3RhdGljIHZvaWQgaW5pdF9wZGF0YShzdHJ1Y3QgbnVsbF9wcml2YXRl
ICpwcnYsIHVuc2lnbmVkIGludCBjcHUpCiBzdGF0aWMgdm9pZCBudWxsX2luaXRfcGRhdGEoY29u
c3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCB2b2lkICpwZGF0YSwgaW50IGNwdSkKIHsKICAgICBz
dHJ1Y3QgbnVsbF9wcml2YXRlICpwcnYgPSBudWxsX3ByaXYob3BzKTsKLSAgICBzdHJ1Y3Qgc2No
ZWRfcmVzb3VyY2UgKnNkID0gZ2V0X3NjaGVkX3JlcyhjcHUpOwogCiAgICAgLyogYWxsb2NfcGRh
dGEgaXMgbm90IGltcGxlbWVudGVkLCBzbyB3ZSB3YW50IHRoaXMgdG8gYmUgTlVMTC4gKi8KICAg
ICBBU1NFUlQoIXBkYXRhKTsKIAotICAgIC8qCi0gICAgICogVGhlIHNjaGVkdWxlciBsb2NrIHBv
aW50cyBhbHJlYWR5IHRvIHRoZSBkZWZhdWx0IHBlci1jcHUgc3BpbmxvY2ssCi0gICAgICogc28g
dGhlcmUgaXMgbm8gcmVtYXBwaW5nIHRvIGJlIGRvbmUuCi0gICAgICovCi0gICAgQVNTRVJUKHNk
LT5zY2hlZHVsZV9sb2NrID09ICZzZC0+X2xvY2sgJiYgIXNwaW5faXNfbG9ja2VkKCZzZC0+X2xv
Y2spKTsKLQogICAgIGluaXRfcGRhdGEocHJ2LCBjcHUpOwogfQogCmRpZmYgLS1naXQgYS94ZW4v
Y29tbW9uL3NjaGVkdWxlLmMgYi94ZW4vY29tbW9uL3NjaGVkdWxlLmMKaW5kZXggN2ZkODNmZmQ0
ZS4uNDQzNjRmZjRkMiAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9zY2hlZHVsZS5jCisrKyBiL3hl
bi9jb21tb24vc2NoZWR1bGUuYwpAQCAtNjEsNiArNjEsOSBAQCB1bnNpZ25lZCBpbnQgc2NoZWRf
Z3JhbnVsYXJpdHkgPSAxOwogYm9vbCBzY2hlZF9kaXNhYmxlX3NtdF9zd2l0Y2hpbmc7CiBjb25z
dCBjcHVtYXNrX3QgKnNjaGVkX3Jlc19tYXNrID0gJmNwdW1hc2tfYWxsOwogCisvKiBDb21tb24g
bG9jayBmb3IgZnJlZSBjcHVzLiAqLworc3RhdGljIERFRklORV9TUElOTE9DSyhzY2hlZF9mcmVl
X2NwdV9sb2NrKTsKKwogLyogVmFyaW91cyB0aW1lciBoYW5kbGVycy4gKi8KIHN0YXRpYyB2b2lk
IHNfdGltZXJfZm4odm9pZCAqdW51c2VkKTsKIHN0YXRpYyB2b2lkIHZjcHVfcGVyaW9kaWNfdGlt
ZXJfZm4odm9pZCAqZGF0YSk7CkBAIC0yMTQ5LDcgKzIxNTIsNyBAQCBzdGF0aWMgaW50IGNwdV9z
Y2hlZHVsZV91cCh1bnNpZ25lZCBpbnQgY3B1KQogCiAgICAgc2QtPnNjaGVkdWxlciA9ICZvcHM7
CiAgICAgc3Bpbl9sb2NrX2luaXQoJnNkLT5fbG9jayk7Ci0gICAgc2QtPnNjaGVkdWxlX2xvY2sg
PSAmc2QtPl9sb2NrOworICAgIHNkLT5zY2hlZHVsZV9sb2NrID0gJnNjaGVkX2ZyZWVfY3B1X2xv
Y2s7CiAgICAgaW5pdF90aW1lcigmc2QtPnNfdGltZXIsIHNfdGltZXJfZm4sIE5VTEwsIGNwdSk7
CiAgICAgYXRvbWljX3NldCgmc2QtPnVyZ2VudF9jb3VudCwgMCk7CiAKQEAgLTI0ODgsNyArMjQ5
MSw3IEBAIGludCBzY2hlZHVsZV9jcHVfc3dpdGNoKHVuc2lnbmVkIGludCBjcHUsIHN0cnVjdCBj
cHVwb29sICpjKQogICAgICAqIHRha2luZyBpdCwgZmluZHMgYWxsIHRoZSBpbml0aWFsaXphdGlv
bnMgd2UndmUgZG9uZSBhYm92ZSBpbiBwbGFjZS4KICAgICAgKi8KICAgICBzbXBfbWIoKTsKLSAg
ICBzZC0+c2NoZWR1bGVfbG9jayA9IG5ld19sb2NrOworICAgIHNkLT5zY2hlZHVsZV9sb2NrID0g
YyA/IG5ld19sb2NrIDogJnNjaGVkX2ZyZWVfY3B1X2xvY2s7CiAKICAgICAvKiBfTm90XyBwY3B1
X3NjaGVkdWxlX3VubG9jaygpOiBzY2hlZHVsZV9sb2NrIG1heSBoYXZlIGNoYW5nZWQhICovCiAg
ICAgc3Bpbl91bmxvY2tfaXJxKG9sZF9sb2NrKTsKLS0gCjIuMTYuNAoKCl9fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QK
WGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5v
cmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id A521F124A03
	for <lists+xen-devel@lfdr.de>; Wed, 18 Dec 2019 15:46:08 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1ihaWU-0004GE-CH; Wed, 18 Dec 2019 14:41:58 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=cNHo=2I=amazon.com=prvs=24851c453=pdurrant@srs-us1.protection.inumbo.net>)
 id 1ihaWS-0004G2-Oh
 for xen-devel@lists.xenproject.org; Wed, 18 Dec 2019 14:41:56 +0000
X-Inumbo-ID: 89bf09e2-21a4-11ea-88e7-bc764e2007e4
Received: from smtp-fw-9101.amazon.com (unknown [207.171.184.25])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id 89bf09e2-21a4-11ea-88e7-bc764e2007e4;
 Wed, 18 Dec 2019 14:41:56 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amazon.com; i=@amazon.com; q=dns/txt; s=amazon201209;
 t=1576680117; x=1608216117;
 h=from:to:cc:subject:date:message-id:mime-version:
 content-transfer-encoding;
 bh=DFDUl1ONWC9LE6coUOiCU7NvCYjl+ZMAYVVEuqinZhQ=;
 b=Vijsi/0Z1Zj/422V7t10oQUcYtuJHf545zKwvBMC3zF3Fe40o86ptNuL
 IXi/AuPkoLRzCmad9AWbu719RbjeGqUGoM+YHAxx5zD+2NDufiRR2nM6e
 wiMtdu9h+CGa71LxafHSdTi4rKdmg6Bfo5dzDfnYREX7vuBtsayrgebwF g=;
IronPort-SDR: wv539Wgl3R1cq+ub6xUPn7a0URc33CwJA8NyARPRjCaUYon7lsoWSVF2y1e5kwPkpd9qbuIMWF
 Bu9DrBme7Gyg==
X-IronPort-AV: E=Sophos;i="5.69,329,1571702400"; 
   d="scan'208";a="5859825"
Received: from sea32-co-svc-lb4-vlan3.sea.corp.amazon.com (HELO
 email-inbound-relay-2a-53356bf6.us-west-2.amazon.com) ([10.47.23.38])
 by smtp-border-fw-out-9101.sea19.amazon.com with ESMTP;
 18 Dec 2019 14:41:46 +0000
Received: from EX13MTAUEA002.ant.amazon.com
 (pdx4-ws-svc-p6-lb7-vlan2.pdx.amazon.com [10.170.41.162])
 by email-inbound-relay-2a-53356bf6.us-west-2.amazon.com (Postfix) with ESMTPS
 id AA768A050D; Wed, 18 Dec 2019 14:41:41 +0000 (UTC)
Received: from EX13D32EUC003.ant.amazon.com (10.43.164.24) by
 EX13MTAUEA002.ant.amazon.com (10.43.61.77) with Microsoft SMTP Server (TLS)
 id 15.0.1236.3; Wed, 18 Dec 2019 14:41:41 +0000
Received: from EX13MTAUEB002.ant.amazon.com (10.43.60.12) by
 EX13D32EUC003.ant.amazon.com (10.43.164.24) with Microsoft SMTP Server (TLS)
 id 15.0.1367.3; Wed, 18 Dec 2019 14:41:40 +0000
Received: from u2f063a87eabd5f.cbg10.amazon.com (10.125.106.135) by
 mail-relay.amazon.com (10.43.60.234) with Microsoft SMTP Server id
 15.0.1367.3 via Frontend Transport; Wed, 18 Dec 2019 14:41:38 +0000
From: Paul Durrant <pdurrant@amazon.com>
To: <xen-devel@lists.xenproject.org>
Date: Wed, 18 Dec 2019 14:41:33 +0000
Message-ID: <20191218144133.16089-1-pdurrant@amazon.com>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Precedence: Bulk
Subject: [Xen-devel] [PATCH] x86/hvm/rtc: preserved guest RTC offset during
 suspend/resume/migrate
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Stefano Stabellini <sstabellini@kernel.org>, Julien Grall <julien@xen.org>,
 Wei Liu <wl@xen.org>, Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>, Paul Durrant <pdurrant@amazon.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Jan Beulich <jbeulich@suse.com>,
 Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

VGhlIGVtdWxhdGVkIFJUQyBpcyBzeW5jaHJvbml6ZWQgd2l0aCB0aGUgUFYgd2FsbGNsb2NrOyBh
bnkgd3JpdGUgdG8gdGhlClJUQyB3aWxsIHVwZGF0ZSBzdHJ1Y3QgZG9tYWluJ3MgJ3RpbWVfb2Zm
c2V0X3NlY29uZHMnIGZpZWxkIGFuZCBjYWxsCnVwZGF0ZV9kb21haW5fd2FsbGNsb2NrKCkuCgpI
b3dldmVyLCB0aGUgdmFsdWUgb2YgJ3RpbWVfb2Zmc2V0X3NlY29uZHMnIGlzIG5vdCBwcmVzZXJ2
ZWQgaW4gYW55IHNhdmUKcmVjb3JkIGFuZCBpbmRlZWQsIHdoZW4gdGhlIFJUQyBzYXZlIHJlY29y
ZCBpcyBsb2FkZWQsIHRoZSBDTU9TIHZhbHVlcwp3aWxsIGJlIHVwZGF0ZWQgYmFzZWQgb24gYW4g
b2Zmc2V0IHZhbHVlIHdoaWNoIG1heSBvciBtYXkgbm90IGhhdmUgYmVlbgpzZXQgYnkgdGhlIHRv
b2xzdGFjayBbMV0uIFRoaXMgbWF5IHJlc3VsdCBpbiBtYWtpbmcgYm9ndXMgdmFsdWVzIGF2YWls
YWJsZQp0byB0aGUgZ3Vlc3QgYW5kIG1lc3NpbmcgdXAgYW55IGNhbGN1bGF0aW9ucyBkb25lIGlu
IHRoZSBjYWxsIHRvCmFsYXJtX3RpbWVyX3VwZGF0ZSgpIGF0IHRoZSBlbmQgb2YgcnRjX2xvYWQo
KS4KClRoaXMgcGF0Y2ggZXh0ZW5kcyB0aGUgUlRDIHNhdmUgcmVjb3JkIHRvIGNvbnRhaW4gYW4g
b2Zmc2V0IHZhbHVlLCB3aGljaAp3aWxsIGJlIHplcm8gZmlsbGVkIG9uIGxvYWQgb2YgYW4gb2xk
ZXIgcmVjb3JkLiBUaGUgJ3RpbWVfb2Zmc2V0X3NlY29vbmRzJwpmaWVsZCBpbiBzdHJ1Y3QgZG9t
YWluIGlzIGFsc28gbW9kaWZpZWQgaW50byBhICd0aW1lX29mZnNldCcgc3RydWN0LApjb250YWlu
aW5nIGEgJ3NlY29uZHMnIGZpZWxkIGFuZCBhIGJvb2xlYW4gJ3NldCcgZmllbGQuCgpUaGUgY29k
ZSBpbiBydGNfbG9hZCgpIHRoZW4gdXNlcyB0aGUgbmV3IHZhbHVlIGluIHRoZSBzYXZlIHJlY29y
ZCB0bwp1cGRhdGUgdGhlIHZhbHVlIG9mIHN0cnVjdCBkb21haW4ncyAndGltZV9vZmZzZXQuc2Vj
b25kcycgdW5sZXNzCid0aW1lX29mZnNldC5zZXQnIGlzIHRydWUsIHdoaWNoIHdpbGwgb25seSBi
ZSB0aGUgY2FzZSBpZiB0aGUgdG9vbHN0YWNrIGhhcwphbHJlYWR5IHBlcmZvcm1lZCBhIFhFTl9E
T01DVExfc2V0dGltZW9mZnNldC4KClsxXSBUaGVyZSBpcyBjdXJyZW50bHkgbm8gd2F5IGZvciBh
IHRvb2xzdGFjayB0byByZWFkIHRoZSB2YWx1ZSBvZgogICAgJ3RpbWVfb2Zmc2V0X3NlY29uZHMn
IGZyb20gc3RydWN0IGRvbWFpbi4gSW4gdGhlIHBhc3QsIGFueSBob3BlIG9mCiAgICBwcmVzZXJ2
YXRpb24gb2YgdGhlIHZhbHVlIGFjcm9zcyBhIGd1ZXN0IGxpZmUtY3ljbGUgb3BlcmF0aW9uIHdh
cyBiYXNlZAogICAgb24gcmVseWluZyBvbiBxZW11LWRtIHRvIHdyaXRlIGEgdmFsdWUgaW50byB4
ZW5zdG9yZSB3aGVuZXZlciB0aGUgUlRDCiAgICB3YXMgdXBkYXRlZCwgaW4gcmVzcG9uc2UgdG8g
YW4gSU9SRVEgd2l0aCB0eXBlIElPUkVRX1RZUEVfVElNRU9GRlNFVAogICAgYmVpbmcgc2VudCBi
eSBYZW47IHNlZToKCiAgICBodHRwczovL3hlbmJpdHMueGVuLm9yZy9naXR3ZWIvP3A9cWVtdS14
ZW4tdHJhZGl0aW9uYWwuZ2l0O2E9YmxvYjtmPWkzODYtZG0vaGVscGVyMi5jI2w0NTcKCiAgICBi
dXQgdGhpcyBiZWhhdmlvdXIgd2FzIG5ldmVyIGZvcndhcmQtcG9ydGVkIGludG8gdXBzdHJlYW0g
UUVNVSwgd2hpY2gKICAgIGNvbXBsZXRlbHkgaWdub3JlcyB0aGF0IElPUkVRIHR5cGUuCiAgICBJ
biBlaXRoZXIgY2FzZSwgbm90aGluZyBpbiB4bCBvciBsaWJ4bCBldmVyIHNhbXBsZXMgdGhlIHZh
bHVlIG9mCiAgICBSVEMgb2Zmc2V0IGZyb20geGVuc3RvcmUgc28gYW55IG9mZnNldCBhZGp1c3Rt
ZW50IHRvIGEgbm9uLXplcm8gdmFsdWUKICAgIHBlcmZvcm1lZCBieSB0aGUgZ3Vlc3QgKHdoaWNo
IGluIHRoZSBjYXNlIG9mIFdpbmRvd3MgaXMgaGlnaGx5IGxpa2VseQogICAgYXMgaXQgbm9ybWFs
bHkgd3JpdGVzIFJUQyBpbiBsb2NhbCB0aW1lLCB3aGVyZWFzIFhlbiBtYWludGFpbnMgdGltZSBp
bgogICAgVVRDKSBpcyBjb21wbGV0ZWx5IGxvc3Qgd2l0aCB0aGUgZGUtZmFjdG8gdG9vbHN0YWNr
LCBhbmQgYWx3YXlzIGhhcwogICAgYmVlbi4gSW5zdGVhZCwgUFYgZHJpdmVycyBhcmUgcmVsaWVk
IHVwb24gdG8gcGFwZXIgb3ZlciB0aGlzIGdhcGluZwogICAgaG9sZS4KClNpZ25lZC1vZmYtYnk6
IFBhdWwgRHVycmFudCA8cGR1cnJhbnRAYW1hem9uLmNvbT4KLS0tCkNjOiBTdGVmYW5vIFN0YWJl
bGxpbmkgPHNzdGFiZWxsaW5pQGtlcm5lbC5vcmc+CkNjOiBKdWxpZW4gR3JhbGwgPGp1bGllbkB4
ZW4ub3JnPgpDYzogVm9sb2R5bXlyIEJhYmNodWsgPFZvbG9keW15cl9CYWJjaHVrQGVwYW0uY29t
PgpDYzogQW5kcmV3IENvb3BlciA8YW5kcmV3LmNvb3BlcjNAY2l0cml4LmNvbT4KQ2M6IEdlb3Jn
ZSBEdW5sYXAgPEdlb3JnZS5EdW5sYXBAZXUuY2l0cml4LmNvbT4KQ2M6IElhbiBKYWNrc29uIDxp
YW4uamFja3NvbkBldS5jaXRyaXguY29tPgpDYzogSmFuIEJldWxpY2ggPGpiZXVsaWNoQHN1c2Uu
Y29tPgpDYzogS29ucmFkIFJ6ZXN6dXRlayBXaWxrIDxrb25yYWQud2lsa0BvcmFjbGUuY29tPgpD
YzogV2VpIExpdSA8d2xAeGVuLm9yZz4KQ2M6ICJSb2dlciBQYXUgTW9ubsOpIiA8cm9nZXIucGF1
QGNpdHJpeC5jb20+Ci0tLQogeGVuL2FyY2gvYXJtL3BsYXRmb3JtX2h5cGVyY2FsbC5jICAgICAg
fCAgMiArLQogeGVuL2FyY2gvYXJtL3RpbWUuYyAgICAgICAgICAgICAgICAgICAgfCAgMyArKy0K
IHhlbi9hcmNoL2FybS92dGltZXIuYyAgICAgICAgICAgICAgICAgIHwgIDQgKystLQogeGVuL2Fy
Y2gveDg2L2h2bS9ydGMuYyAgICAgICAgICAgICAgICAgfCAxMiArKysrKysrKysrLS0KIHhlbi9h
cmNoL3g4Ni90aW1lLmMgICAgICAgICAgICAgICAgICAgIHwgIDMgKystCiB4ZW4vY29tbW9uL3Rp
bWUuYyAgICAgICAgICAgICAgICAgICAgICB8ICA2ICsrKy0tLQogeGVuL2luY2x1ZGUvcHVibGlj
L2FyY2gteDg2L2h2bS9zYXZlLmggfCAgMiArKwogeGVuL2luY2x1ZGUveGVuL3NjaGVkLmggICAg
ICAgICAgICAgICAgfCAgNSArKysrLQogOCBmaWxlcyBjaGFuZ2VkLCAyNiBpbnNlcnRpb25zKCsp
LCAxMSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS94ZW4vYXJjaC9hcm0vcGxhdGZvcm1faHlw
ZXJjYWxsLmMgYi94ZW4vYXJjaC9hcm0vcGxhdGZvcm1faHlwZXJjYWxsLmMKaW5kZXggNWFhYjg1
NmNlNy4uOGVmYWM3ZWU2MCAxMDA2NDQKLS0tIGEveGVuL2FyY2gvYXJtL3BsYXRmb3JtX2h5cGVy
Y2FsbC5jCisrKyBiL3hlbi9hcmNoL2FybS9wbGF0Zm9ybV9oeXBlcmNhbGwuYwpAQCAtNTMsNyAr
NTMsNyBAQCBsb25nIGRvX3BsYXRmb3JtX29wKFhFTl9HVUVTVF9IQU5ETEVfUEFSQU0oeGVuX3Bs
YXRmb3JtX29wX3QpIHVfeGVucGZfb3ApCiAgICAgICAgIGlmICggbGlrZWx5KCFvcC0+dS5zZXR0
aW1lNjQubWJ6KSApCiAgICAgICAgICAgICBkb19zZXR0aW1lKG9wLT51LnNldHRpbWU2NC5zZWNz
LAogICAgICAgICAgICAgICAgICAgICAgICBvcC0+dS5zZXR0aW1lNjQubnNlY3MsCi0gICAgICAg
ICAgICAgICAgICAgICAgIG9wLT51LnNldHRpbWU2NC5zeXN0ZW1fdGltZSArIFNFQ09ORFMoZC0+
dGltZV9vZmZzZXRfc2Vjb25kcykpOworICAgICAgICAgICAgICAgICAgICAgICBvcC0+dS5zZXR0
aW1lNjQuc3lzdGVtX3RpbWUgKyBTRUNPTkRTKGQtPnRpbWVfb2Zmc2V0LnNlY29uZHMpKTsKICAg
ICAgICAgZWxzZQogICAgICAgICAgICAgcmV0ID0gLUVJTlZBTDsKICAgICAgICAgYnJlYWs7CmRp
ZmYgLS1naXQgYS94ZW4vYXJjaC9hcm0vdGltZS5jIGIveGVuL2FyY2gvYXJtL3RpbWUuYwppbmRl
eCA3MzliY2YxODZjLi5iMDAyMWMyYzY5IDEwMDY0NAotLS0gYS94ZW4vYXJjaC9hcm0vdGltZS5j
CisrKyBiL3hlbi9hcmNoL2FybS90aW1lLmMKQEAgLTM1Myw3ICszNTMsOCBAQCB2b2lkIHVwZGF0
ZV92Y3B1X3N5c3RlbV90aW1lKHN0cnVjdCB2Y3B1ICp2KQogCiB2b2lkIGRvbWFpbl9zZXRfdGlt
ZV9vZmZzZXQoc3RydWN0IGRvbWFpbiAqZCwgaW50NjRfdCB0aW1lX29mZnNldF9zZWNvbmRzKQog
ewotICAgIGQtPnRpbWVfb2Zmc2V0X3NlY29uZHMgPSB0aW1lX29mZnNldF9zZWNvbmRzOworICAg
IGQtPnRpbWVfb2Zmc2V0LnNlY29uZHMgPSB0aW1lX29mZnNldF9zZWNvbmRzOworICAgIGQtPnRp
bWVfb2Zmc2V0LnNldCA9IHRydWU7CiAgICAgLyogWFhYIHVwZGF0ZSBndWVzdCB2aXNpYmxlIHdh
bGxjbG9jayB0aW1lICovCiB9CiAKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL2FybS92dGltZXIuYyBi
L3hlbi9hcmNoL2FybS92dGltZXIuYwppbmRleCBlNmFlYmRhYzllLi4yNDBhODUwYjZlIDEwMDY0
NAotLS0gYS94ZW4vYXJjaC9hcm0vdnRpbWVyLmMKKysrIGIveGVuL2FyY2gvYXJtL3Z0aW1lci5j
CkBAIC02NCw4ICs2NCw4IEBAIGludCBkb21haW5fdnRpbWVyX2luaXQoc3RydWN0IGRvbWFpbiAq
ZCwgc3RydWN0IHhlbl9hcmNoX2RvbWFpbmNvbmZpZyAqY29uZmlnKQogewogICAgIGQtPmFyY2gu
cGh5c190aW1lcl9iYXNlLm9mZnNldCA9IE5PVygpOwogICAgIGQtPmFyY2gudmlydF90aW1lcl9i
YXNlLm9mZnNldCA9IFJFQURfU1lTUkVHNjQoQ05UUENUX0VMMCk7Ci0gICAgZC0+dGltZV9vZmZz
ZXRfc2Vjb25kcyA9IHRpY2tzX3RvX25zKGQtPmFyY2gudmlydF90aW1lcl9iYXNlLm9mZnNldCAt
IGJvb3RfY291bnQpOwotICAgIGRvX2RpdihkLT50aW1lX29mZnNldF9zZWNvbmRzLCAxMDAwMDAw
MDAwKTsKKyAgICBkLT50aW1lX29mZnNldC5zZWNvbmRzID0gdGlja3NfdG9fbnMoZC0+YXJjaC52
aXJ0X3RpbWVyX2Jhc2Uub2Zmc2V0IC0gYm9vdF9jb3VudCk7CisgICAgZG9fZGl2KGQtPnRpbWVf
b2Zmc2V0LnNlY29uZHMsIDEwMDAwMDAwMDApOwogCiAgICAgY29uZmlnLT5jbG9ja19mcmVxdWVu
Y3kgPSB0aW1lcl9kdF9jbG9ja19mcmVxdWVuY3k7CiAKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4
Ni9odm0vcnRjLmMgYi94ZW4vYXJjaC94ODYvaHZtL3J0Yy5jCmluZGV4IDQyMzM5NjgyZTguLmJi
NDFlZmU4NGEgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9odm0vcnRjLmMKKysrIGIveGVuL2Fy
Y2gveDg2L2h2bS9ydGMuYwpAQCAtNTk0LDcgKzU5NCw3IEBAIHN0YXRpYyB2b2lkIHJ0Y19zZXRf
dGltZShSVENTdGF0ZSAqcykKIAogICAgIC8qIFdlIHVzZSB0aGUgZ3Vlc3QncyBzZXR0aW5nIG9m
IHRoZSBSVEMgdG8gZGVmaW5lIHRoZSBsb2NhbC10aW1lIAogICAgICAqIG9mZnNldCBmb3IgdGhp
cyBkb21haW4uICovCi0gICAgZC0+dGltZV9vZmZzZXRfc2Vjb25kcyArPSAoYWZ0ZXIgLSBiZWZv
cmUpOworICAgIGQtPnRpbWVfb2Zmc2V0LnNlY29uZHMgKz0gKGFmdGVyIC0gYmVmb3JlKTsKICAg
ICB1cGRhdGVfZG9tYWluX3dhbGxjbG9ja190aW1lKGQpOwogICAgIC8qIEFsc28gdGVsbCBxZW11
LWRtIGFib3V0IGl0IHNvIGl0IHdpbGwgYmUgcmVtZW1iZXJlZCBmb3IgbmV4dCBib290LiAqLwog
ICAgIHNlbmRfdGltZW9mZnNldF9yZXEoYWZ0ZXIgLSBiZWZvcmUpOwpAQCAtNzQ3LDggKzc0Nywx
MCBAQCBzdGF0aWMgaW50IHJ0Y19zYXZlKHN0cnVjdCB2Y3B1ICp2LCBodm1fZG9tYWluX2NvbnRl
eHRfdCAqaCkKICAgICAgICAgcmV0dXJuIDA7CiAKICAgICBzcGluX2xvY2soJnMtPmxvY2spOwor
ICAgIHMtPmh3LnJ0Y19vZmZzZXQgPSBkLT50aW1lX29mZnNldC5zZWNvbmRzOwogICAgIHJjID0g
aHZtX3NhdmVfZW50cnkoUlRDLCAwLCBoLCAmcy0+aHcpOwogICAgIHNwaW5fdW5sb2NrKCZzLT5s
b2NrKTsKKwogICAgIHJldHVybiByYzsKIH0KIApAQCAtNzYzLDcgKzc2NSw3IEBAIHN0YXRpYyBp
bnQgcnRjX2xvYWQoc3RydWN0IGRvbWFpbiAqZCwgaHZtX2RvbWFpbl9jb250ZXh0X3QgKmgpCiAg
ICAgc3Bpbl9sb2NrKCZzLT5sb2NrKTsKIAogICAgIC8qIFJlc3RvcmUgdGhlIHJlZ2lzdGVycyAq
LwotICAgIGlmICggaHZtX2xvYWRfZW50cnkoUlRDLCBoLCAmcy0+aHcpICE9IDAgKQorICAgIGlm
ICggaHZtX2xvYWRfZW50cnlfemVyb2V4dGVuZChSVEMsIGgsICZzLT5odykgIT0gMCApCiAgICAg
ewogICAgICAgICBzcGluX3VubG9jaygmcy0+bG9jayk7CiAgICAgICAgIHJldHVybiAtRUlOVkFM
OwpAQCAtNzcxLDYgKzc3MywxMiBAQCBzdGF0aWMgaW50IHJ0Y19sb2FkKHN0cnVjdCBkb21haW4g
KmQsIGh2bV9kb21haW5fY29udGV4dF90ICpoKQogCiAgICAgLyogUmVzZXQgdGhlIHdhbGwtY2xv
Y2sgdGltZS4gIEluIG5vcm1hbCBydW5uaW5nLCB0aGlzIHJ1bnMgd2l0aCBob3N0IAogICAgICAq
IHRpbWUsIHNvIGxldCdzIGtlZXAgZG9pbmcgdGhhdC4gKi8KKyAgICBpZiAoICFkLT50aW1lX29m
ZnNldC5zZXQgKQorICAgIHsKKyAgICAgICAgZC0+dGltZV9vZmZzZXQuc2Vjb25kcyA9IHMtPmh3
LnJ0Y19vZmZzZXQ7CisgICAgICAgIHVwZGF0ZV9kb21haW5fd2FsbGNsb2NrX3RpbWUoZCk7Cisg
ICAgfQorCiAgICAgcy0+Y3VycmVudF90bSA9IGdtdGltZShnZXRfbG9jYWx0aW1lKGQpKTsKICAg
ICBydGNfY29weV9kYXRlKHMpOwogCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvdGltZS5jIGIv
eGVuL2FyY2gveDg2L3RpbWUuYwppbmRleCAyMTYxNjlhMDI1Li5mMmQwMzkzM2U0IDEwMDY0NAot
LS0gYS94ZW4vYXJjaC94ODYvdGltZS5jCisrKyBiL3hlbi9hcmNoL3g4Ni90aW1lLmMKQEAgLTEx
OTAsNyArMTE5MCw4IEBAIHN0YXRpYyB2b2lkIHVwZGF0ZV9kb21haW5fcnRjKHZvaWQpCiAKIHZv
aWQgZG9tYWluX3NldF90aW1lX29mZnNldChzdHJ1Y3QgZG9tYWluICpkLCBpbnQ2NF90IHRpbWVf
b2Zmc2V0X3NlY29uZHMpCiB7Ci0gICAgZC0+dGltZV9vZmZzZXRfc2Vjb25kcyA9IHRpbWVfb2Zm
c2V0X3NlY29uZHM7CisgICAgZC0+dGltZV9vZmZzZXQuc2Vjb25kcyA9IHRpbWVfb2Zmc2V0X3Nl
Y29uZHM7CisgICAgZC0+dGltZV9vZmZzZXQuc2V0ID0gdHJ1ZTsKICAgICBpZiAoIGlzX2h2bV9k
b21haW4oZCkgKQogICAgICAgICBydGNfdXBkYXRlX2Nsb2NrKGQpOwogICAgIHVwZGF0ZV9kb21h
aW5fd2FsbGNsb2NrX3RpbWUoZCk7CmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3RpbWUuYyBiL3hl
bi9jb21tb24vdGltZS5jCmluZGV4IGE3Y2FlYTk5ZTAuLjgyMzM2ZTJkNWEgMTAwNjQ0Ci0tLSBh
L3hlbi9jb21tb24vdGltZS5jCisrKyBiL3hlbi9jb21tb24vdGltZS5jCkBAIC0xMDUsNyArMTA1
LDcgQEAgdm9pZCB1cGRhdGVfZG9tYWluX3dhbGxjbG9ja190aW1lKHN0cnVjdCBkb21haW4gKmQp
CiAgICAgKndjX3ZlcnNpb24gPSB2ZXJzaW9uX3VwZGF0ZV9iZWdpbigqd2NfdmVyc2lvbik7CiAg
ICAgc21wX3dtYigpOwogCi0gICAgc2VjID0gd2Nfc2VjICsgZC0+dGltZV9vZmZzZXRfc2Vjb25k
czsKKyAgICBzZWMgPSB3Y19zZWMgKyBkLT50aW1lX29mZnNldC5zZWNvbmRzOwogICAgIHNoYXJl
ZF9pbmZvKGQsIHdjX3NlYykgICAgPSBzZWM7CiAgICAgc2hhcmVkX2luZm8oZCwgd2NfbnNlYykg
ICA9IHdjX25zZWM7CiAjaWZkZWYgQ09ORklHX1g4NgpAQCAtMTQ4LDEzICsxNDgsMTMgQEAgdm9p
ZCBkb19zZXR0aW1lKHU2NCBzZWNzLCB1bnNpZ25lZCBpbnQgbnNlY3MsIHU2NCBzeXN0ZW1fdGlt
ZV9iYXNlKQogdW5zaWduZWQgbG9uZyBnZXRfbG9jYWx0aW1lKHN0cnVjdCBkb21haW4gKmQpCiB7
CiAgICAgcmV0dXJuIHdjX3NlYyArICh3Y19uc2VjICsgTk9XKCkpIC8gMTAwMDAwMDAwMFVMTAot
ICAgICAgICArIGQtPnRpbWVfb2Zmc2V0X3NlY29uZHM7CisgICAgICAgICsgZC0+dGltZV9vZmZz
ZXQuc2Vjb25kczsKIH0KIAogLyogUmV0dXJuIG1pY3Jvc2VjcyBhZnRlciAwMDowMDowMCBsb2Nh
bHRpbWUsIDEgSmFudWFyeSwgMTk3MC4gKi8KIHVpbnQ2NF90IGdldF9sb2NhbHRpbWVfdXMoc3Ry
dWN0IGRvbWFpbiAqZCkKIHsKLSAgICByZXR1cm4gKFNFQ09ORFMod2Nfc2VjICsgZC0+dGltZV9v
ZmZzZXRfc2Vjb25kcykgKyB3Y19uc2VjICsgTk9XKCkpCisgICAgcmV0dXJuIChTRUNPTkRTKHdj
X3NlYyArIGQtPnRpbWVfb2Zmc2V0LnNlY29uZHMpICsgd2NfbnNlYyArIE5PVygpKQogICAgICAg
ICAgICAvIDEwMDBVTDsKIH0KIApkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUvcHVibGljL2FyY2gt
eDg2L2h2bS9zYXZlLmggYi94ZW4vaW5jbHVkZS9wdWJsaWMvYXJjaC14ODYvaHZtL3NhdmUuaApp
bmRleCBiYjhmYTdjMTJmLi5iMmFkM2ZjZDc0IDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS9wdWJs
aWMvYXJjaC14ODYvaHZtL3NhdmUuaAorKysgYi94ZW4vaW5jbHVkZS9wdWJsaWMvYXJjaC14ODYv
aHZtL3NhdmUuaApAQCAtNTAwLDYgKzUwMCw4IEBAIHN0cnVjdCBodm1faHdfcnRjIHsKICAgICAv
KiBJbmRleCByZWdpc3RlciBmb3IgMi1wYXJ0IG9wZXJhdGlvbnMgKi8KICAgICB1aW50OF90IGNt
b3NfaW5kZXg7CiAgICAgdWludDhfdCBwYWQwOworICAgIC8qIFJUQyBvZmZzZXQgZnJvbSBob3N0
IHRpbWUgKi8KKyAgICBpbnQ2NF90IHJ0Y19vZmZzZXQ7CiB9OwogCiBERUNMQVJFX0hWTV9TQVZF
X1RZUEUoUlRDLCAxMSwgc3RydWN0IGh2bV9od19ydGMpOwpkaWZmIC0tZ2l0IGEveGVuL2luY2x1
ZGUveGVuL3NjaGVkLmggYi94ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaAppbmRleCA5ZjdiYzY5Mjkz
Li45NGFkZDM3OTkwIDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaAorKysgYi94
ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaApAQCAtNDA2LDcgKzQwNiwxMCBAQCBzdHJ1Y3QgZG9tYWlu
CiAgICAgLyogRG9tYWluIGlzIHBhdXNlZCBieSBjb250cm9sbGVyIHNvZnR3YXJlPyAqLwogICAg
IGludCAgICAgICAgICAgICAgY29udHJvbGxlcl9wYXVzZV9jb3VudDsKIAotICAgIGludDY0X3Qg
ICAgICAgICAgdGltZV9vZmZzZXRfc2Vjb25kczsKKyAgICBzdHJ1Y3QgeworICAgICAgICBpbnQ2
NF90IHNlY29uZHM7CisgICAgICAgIGJvb2wgc2V0OworICAgIH0gdGltZV9vZmZzZXQ7CiAKICNp
ZmRlZiBDT05GSUdfSEFTX1BDSQogICAgIHN0cnVjdCBsaXN0X2hlYWQgcGRldl9saXN0OwotLSAK
Mi4yMC4xCgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18K
WGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0
cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

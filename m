Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 53CD2AD5AC
	for <lists+xen-devel@lfdr.de>; Mon,  9 Sep 2019 11:28:41 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1i7FvE-0005B5-Ex; Mon, 09 Sep 2019 09:25:20 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=m/oR=XE=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1i7FvC-0005Aa-FU
 for xen-devel@lists.xenproject.org; Mon, 09 Sep 2019 09:25:18 +0000
X-Inumbo-ID: b8a3fc3c-d2e3-11e9-a337-bc764e2007e4
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id b8a3fc3c-d2e3-11e9-a337-bc764e2007e4;
 Mon, 09 Sep 2019 09:25:11 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 80B38AFBF;
 Mon,  9 Sep 2019 09:25:10 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Mon,  9 Sep 2019 11:25:05 +0200
Message-Id: <20190909092506.24792-5-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190909092506.24792-1-jgross@suse.com>
References: <20190909092506.24792-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH v7 4/5] xen: add per-cpu buffer option to
 debugtrace
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

ZGVidWd0cmFjZSBpcyBub3JtYWxseSB3cml0aW5nIHRyYWNlIGVudHJpZXMgaW50byBhIHNpbmds
ZSB0cmFjZQpidWZmZXIuIFRoZXJlIGFyZSBjYXNlcyB3aGVyZSB0aGlzIGlzIG5vdCBvcHRpbWFs
LCBlLmcuIHdoZW4gaHVudGluZwphIGJ1ZyB3aGljaCByZXF1aXJlcyB3cml0aW5nIGxvdHMgb2Yg
dHJhY2UgZW50cmllcyBhbmQgb25lIGNwdSBpcwpzdHVjay4gVGhpcyB3aWxsIHJlc3VsdCBpbiBv
dGhlciBjcHVzIGZpbGxpbmcgdGhlIHRyYWNlIGJ1ZmZlciBhbmQKZmluYWxseSBvdmVyd3JpdGlu
ZyB0aGUgaW50ZXJlc3RpbmcgdHJhY2UgZW50cmllcyBvZiB0aGUgaGFuZ2luZyBjcHUuCgpJbiBv
cmRlciB0byBiZSBhYmxlIHRvIGRlYnVnIHN1Y2ggc2l0dWF0aW9ucyBhZGQgdGhlIGNhcGFiaWxp
dHkgdG8gdXNlCnBlci1jcHUgdHJhY2UgYnVmZmVycy4gVGhpcyBjYW4gYmUgc2VsZWN0ZWQgYnkg
c3BlY2lmeWluZyB0aGUKZGVidWd0cmFjZSBib290IHBhcmFtZXRlciB3aXRoIHRoZSBtb2RpZmll
ciAiY3B1OiIsIGxpa2U6CgogIGRlYnVndHJhY2U9Y3B1OjE2CgpBdCB0aGUgc2FtZSB0aW1lIHN3
aXRjaCB0aGUgcGFyc2luZyBmdW5jdGlvbiB0byBhY2NlcHQgc2l6ZSBtb2RpZmllcnMKKGUuZy4g
NE0gb3IgMUcpLgoKUHJpbnRpbmcgb3V0IHRoZSB0cmFjZSBlbnRyaWVzIGlzIGRvbmUgZm9yIGVh
Y2ggYnVmZmVyIGluIG9yZGVyIHRvCm1pbmltaXplIHRoZSBlZmZvcnQgbmVlZGVkIGR1cmluZyBw
cmludGluZy4gQXMgZWFjaCBlbnRyeSBpcyBwcmVmaXhlZAp3aXRoIGl0cyBzZXF1ZW5jZSBudW1i
ZXIgc29ydGluZyB0aGUgZW50cmllcyBjYW4gZWFzaWx5IGJlIGRvbmUgd2hlbgphbmFseXppbmcg
dGhlbS4KClNpZ25lZC1vZmYtYnk6IEp1ZXJnZW4gR3Jvc3MgPGpncm9zc0BzdXNlLmNvbT4KLS0t
ClYyOgotIG9ubHkgYWxsb2NhdGUgYnVmZmVyIGlmIG5vdCBhbHJlYWR5IGRvbmUgc28KVjQ6Ci0g
dW5zaWduZWQgaW50IC0+IHVuc2lnbmVkIGxvbmcgKEphbiBCZXVsaWNoKQotIHJlcGxhY2UgY2hl
Y2sgZm9yIGJ5dGVzIDwgUEFHRV9TSVpFIGJ5ICFieXRlcyAoSmFuIEJldWxpY2gpCi0gcHJpbnQg
aW5mbyB3aGljaCBidWZmZXIgYWxsb2NhdGlvbiBmYWlsZWQgKEphbiBCZXVsaWNoKQotIHJlcGxh
Y2Ugc3dpdGNoIGJ5IGlmIGluIGNwdSBub3RpZmllciBoYW5kbGVyIChKYW4gQmV1bGljaCkKVjU6
Ci0gZG9uJ3Qgc2lsZW50bHkgaWdub3JlIHRyYWlsaW5nIGNoYXJhY3RlcnMgd2hlbiBwYXJzaW5n
IGJ1ZmZlciBzaXplCiAgKEphbiBCZXVsaWNoKQotIGxpbWl0IHNjb3BlIG9mIHNvbWUgdmFyaWFi
bGVzIChKYW4gQmV1bGljaCkKLSBhZGp1c3QgZXJyb3IgbWVzc2FnZSBmb3JtYXQgKEphbiBCZXVs
aWNoKQpWNjoKLSBtb3ZlIGNhbGN1bGF0aW9uIG9mIGZpbmFsIGRlYnVndHJhY2VfYnl0ZXMgdmFs
dWUgdG8gcGFyYW1ldGVyIHBhcnNpbmcKLS0tCiBkb2NzL21pc2MveGVuLWNvbW1hbmQtbGluZS5w
YW5kb2MgfCAgIDcgKy0KIHhlbi9jb21tb24vZGVidWd0cmFjZS5jICAgICAgICAgICB8IDE2MCAr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLQogMiBmaWxlcyBjaGFuZ2VkLCAx
MjggaW5zZXJ0aW9ucygrKSwgMzkgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZG9jcy9taXNj
L3hlbi1jb21tYW5kLWxpbmUucGFuZG9jIGIvZG9jcy9taXNjL3hlbi1jb21tYW5kLWxpbmUucGFu
ZG9jCmluZGV4IDdjNzJlMzEwMzIuLjgzMjc5N2UyZTIgMTAwNjQ0Ci0tLSBhL2RvY3MvbWlzYy94
ZW4tY29tbWFuZC1saW5lLnBhbmRvYworKysgYi9kb2NzL21pc2MveGVuLWNvbW1hbmQtbGluZS5w
YW5kb2MKQEAgLTY0NCwxMiArNjQ0LDEzIEBAIG92ZXIgdGhlIFBDSSBidXNzZXMgc2VxdWVudGlh
bGx5KSBvciBieSBQQ0kgZGV2aWNlIChtdXN0IGJlIG9uIHNlZ21lbnQgMCkuCiBMaW1pdHMgdGhl
IG51bWJlciBsaW5lcyBwcmludGVkIGluIFhlbiBzdGFjayB0cmFjZXMuCiAKICMjIyBkZWJ1Z3Ry
YWNlCi0+IGA9IDxpbnRlZ2VyPmAKKz4gYD0gW2NwdTpdPHNpemU+YAogCiA+IERlZmF1bHQ6IGAx
MjhgCiAKLVNwZWNpZnkgdGhlIHNpemUgb2YgdGhlIGNvbnNvbGUgZGVidWcgdHJhY2UgYnVmZmVy
IGluIEtpQi4gVGhlIGRlYnVnCi10cmFjZSBmZWF0dXJlIGlzIG9ubHkgZW5hYmxlZCBpbiBkZWJ1
Z2dpbmcgYnVpbGRzIG9mIFhlbi4KK1NwZWNpZnkgdGhlIHNpemUgb2YgdGhlIGNvbnNvbGUgZGVi
dWcgdHJhY2UgYnVmZmVyLiBCeSBzcGVjaWZ5aW5nIGBjcHU6YAorYWRkaXRpb25hbGx5IGEgdHJh
Y2UgYnVmZmVyIG9mIHRoZSBzcGVjaWZpZWQgc2l6ZSBpcyBhbGxvY2F0ZWQgcGVyIGNwdS4KK1Ro
ZSBkZWJ1ZyB0cmFjZSBmZWF0dXJlIGlzIG9ubHkgZW5hYmxlZCBpbiBkZWJ1Z2dpbmcgYnVpbGRz
IG9mIFhlbi4KIAogIyMjIGRtYV9iaXRzCiA+IGA9IDxpbnRlZ2VyPmAKZGlmZiAtLWdpdCBhL3hl
bi9jb21tb24vZGVidWd0cmFjZS5jIGIveGVuL2NvbW1vbi9kZWJ1Z3RyYWNlLmMKaW5kZXggYTY2
YWEzOTEwMy4uMzhmNzYwM2MxZCAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9kZWJ1Z3RyYWNlLmMK
KysrIGIveGVuL2NvbW1vbi9kZWJ1Z3RyYWNlLmMKQEAgLTYsNiArNiw3IEBACiAKIAogI2luY2x1
ZGUgPHhlbi9jb25zb2xlLmg+CisjaW5jbHVkZSA8eGVuL2NwdS5oPgogI2luY2x1ZGUgPHhlbi9p
bml0Lmg+CiAjaW5jbHVkZSA8eGVuL2tleWhhbmRsZXIuaD4KICNpbmNsdWRlIDx4ZW4vbGliLmg+
CkBAIC0yMywzNSArMjQsNzkgQEAgc3RydWN0IGRlYnVndHJhY2VfZGF0YSB7CiB9OwogCiBzdGF0
aWMgc3RydWN0IGRlYnVndHJhY2VfZGF0YSAqZHRfZGF0YTsKK3N0YXRpYyBERUZJTkVfUEVSX0NQ
VShzdHJ1Y3QgZGVidWd0cmFjZV9kYXRhICosIGR0X2NwdV9kYXRhKTsKIAotc3RhdGljIHVuc2ln
bmVkIGludCBkZWJ1Z3RyYWNlX2tpbG9ieXRlcyA9IDEyODsKLXN0YXRpYyB1bnNpZ25lZCBsb25n
IGRlYnVndHJhY2VfYnl0ZXM7CitzdGF0aWMgdW5zaWduZWQgbG9uZyBkZWJ1Z3RyYWNlX2J5dGVz
ID0gMTI4IDw8IDEwOworc3RhdGljIGJvb2wgZGVidWd0cmFjZV9wZXJfY3B1Owogc3RhdGljIGJv
b2wgZGVidWd0cmFjZV9idWZfZW1wdHkgPSB0cnVlOwogc3RhdGljIGJvb2wgZGVidWd0cmFjZV91
c2VkOwogc3RhdGljIERFRklORV9TUElOTE9DSyhkZWJ1Z3RyYWNlX2xvY2spOwotaW50ZWdlcl9w
YXJhbSgiZGVidWd0cmFjZSIsIGRlYnVndHJhY2Vfa2lsb2J5dGVzKTsKIAotc3RhdGljIHZvaWQg
ZGVidWd0cmFjZV9kdW1wX3dvcmtlcih2b2lkKQorc3RhdGljIGludCBfX2luaXQgZGVidWd0cmFj
ZV9wYXJzZV9wYXJhbShjb25zdCBjaGFyICpzKQogewotICAgIGlmICggIWRlYnVndHJhY2VfdXNl
ZCApCisgICAgdW5zaWduZWQgbG9uZyBieXRlczsKKworICAgIGlmICggIXN0cm5jbXAocywgImNw
dToiLCA0KSApCisgICAgeworICAgICAgICBkZWJ1Z3RyYWNlX3Blcl9jcHUgPSB0cnVlOworICAg
ICAgICBzICs9IDQ7CisgICAgfQorICAgIGJ5dGVzID0gcGFyc2Vfc2l6ZV9hbmRfdW5pdChzLCAm
cyk7CisKKyAgICBpZiAoICpzICkKKyAgICAgICAgcmV0dXJuIC1FSU5WQUw7CisKKyAgICBkZWJ1
Z3RyYWNlX2J5dGVzID0gTUFYKGJ5dGVzLCBQQUdFX1NJWkUpOworCisgICAgLyogUm91bmQgc2l6
ZSBkb3duIHRvIG5leHQgcG93ZXIgb2YgdHdvLiAqLworICAgIHdoaWxlICggKGJ5dGVzID0gKGRl
YnVndHJhY2VfYnl0ZXMgJiAoZGVidWd0cmFjZV9ieXRlcyAtIDEpKSkgIT0gMCApCisgICAgICAg
IGRlYnVndHJhY2VfYnl0ZXMgPSBieXRlczsKKworICAgIHJldHVybiAwOworfQorY3VzdG9tX3Bh
cmFtKCJkZWJ1Z3RyYWNlIiwgZGVidWd0cmFjZV9wYXJzZV9wYXJhbSk7CisKK3N0YXRpYyB2b2lk
IGRlYnVndHJhY2VfZHVtcF9idWZmZXIoc3RydWN0IGRlYnVndHJhY2VfZGF0YSAqZGF0YSwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hhciAqd2hpY2gpCit7Cisg
ICAgaWYgKCAhZGF0YSApCiAgICAgICAgIHJldHVybjsKIAotICAgIHByaW50aygiZGVidWd0cmFj
ZV9kdW1wKCkgc3RhcnRpbmdcbiIpOworICAgIHByaW50aygiZGVidWd0cmFjZV9kdW1wKCkgJXMg
YnVmZmVyIHN0YXJ0aW5nXG4iLCB3aGljaCk7CiAKICAgICAvKiBQcmludCBvbGRlc3QgcG9ydGlv
biBvZiB0aGUgcmluZy4gKi8KLSAgICBpZiAoIGR0X2RhdGEtPmJ1ZltkdF9kYXRhLT5wcmRdICE9
ICdcMCcgKQotICAgICAgICBjb25zb2xlX3NlcmlhbF9wdXRzKCZkdF9kYXRhLT5idWZbZHRfZGF0
YS0+cHJkXSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWJ1Z3RyYWNlX2J5dGVzIC0g
ZHRfZGF0YS0+cHJkKTsKKyAgICBpZiAoIGRhdGEtPmJ1ZltkYXRhLT5wcmRdICE9ICdcMCcgKQor
ICAgICAgICBjb25zb2xlX3NlcmlhbF9wdXRzKCZkYXRhLT5idWZbZGF0YS0+cHJkXSwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBkZWJ1Z3RyYWNlX2J5dGVzIC0gZGF0YS0+cHJkKTsKIAog
ICAgIC8qIFByaW50IHlvdW5nZXN0IHBvcnRpb24gb2YgdGhlIHJpbmcuICovCi0gICAgZHRfZGF0
YS0+YnVmW2R0X2RhdGEtPnByZF0gPSAnXDAnOwotICAgIGNvbnNvbGVfc2VyaWFsX3B1dHMoJmR0
X2RhdGEtPmJ1ZlswXSwgZHRfZGF0YS0+cHJkKTsKKyAgICBkYXRhLT5idWZbZGF0YS0+cHJkXSA9
ICdcMCc7CisgICAgY29uc29sZV9zZXJpYWxfcHV0cygmZGF0YS0+YnVmWzBdLCBkYXRhLT5wcmQp
OwogCi0gICAgbWVtc2V0KGR0X2RhdGEtPmJ1ZiwgJ1wwJywgZGVidWd0cmFjZV9ieXRlcyk7Ci0g
ICAgZHRfZGF0YS0+cHJkID0gMDsKLSAgICBkZWJ1Z3RyYWNlX2J1Zl9lbXB0eSA9IHRydWU7Cisg
ICAgbWVtc2V0KGRhdGEtPmJ1ZiwgJ1wwJywgZGVidWd0cmFjZV9ieXRlcyk7CisgICAgZGF0YS0+
cHJkID0gMDsKIAotICAgIHByaW50aygiZGVidWd0cmFjZV9kdW1wKCkgZmluaXNoZWRcbiIpOwor
ICAgIHByaW50aygiZGVidWd0cmFjZV9kdW1wKCkgJXMgYnVmZmVyIGZpbmlzaGVkXG4iLCB3aGlj
aCk7Cit9CisKK3N0YXRpYyB2b2lkIGRlYnVndHJhY2VfZHVtcF93b3JrZXIodm9pZCkKK3sKKyAg
ICB1bnNpZ25lZCBpbnQgY3B1OworCisgICAgaWYgKCAhZGVidWd0cmFjZV91c2VkICkKKyAgICAg
ICAgcmV0dXJuOworCisgICAgZGVidWd0cmFjZV9kdW1wX2J1ZmZlcihkdF9kYXRhLCAiZ2xvYmFs
Iik7CisKKyAgICBmb3IgKCBjcHUgPSAwOyBjcHUgPCBucl9jcHVfaWRzOyBjcHUrKyApCisgICAg
eworICAgICAgICBjaGFyIGJ1ZlsxNl07CisKKyAgICAgICAgc25wcmludGYoYnVmLCBzaXplb2Yo
YnVmKSwgImNwdSAldSIsIGNwdSk7CisgICAgICAgIGRlYnVndHJhY2VfZHVtcF9idWZmZXIocGVy
X2NwdShkdF9jcHVfZGF0YSwgY3B1KSwgYnVmKTsKKyAgICB9CisKKyAgICBkZWJ1Z3RyYWNlX2J1
Zl9lbXB0eSA9IHRydWU7CiB9CiAKIHN0YXRpYyB2b2lkIGRlYnVndHJhY2VfdG9nZ2xlKHZvaWQp
CkBAIC05MSwyOCArMTM2LDMzIEBAIHZvaWQgZGVidWd0cmFjZV9kdW1wKHZvaWQpCiAKIHN0YXRp
YyB2b2lkIGRlYnVndHJhY2VfYWRkX3RvX2J1ZihjaGFyICpidWYpCiB7CisgICAgc3RydWN0IGRl
YnVndHJhY2VfZGF0YSAqZGF0YTsKICAgICBjaGFyICpwOwogCisgICAgZGF0YSA9IGRlYnVndHJh
Y2VfcGVyX2NwdSA/IHRoaXNfY3B1KGR0X2NwdV9kYXRhKSA6IGR0X2RhdGE7CisKICAgICBmb3Ig
KCBwID0gYnVmOyAqcCAhPSAnXDAnOyBwKysgKQogICAgIHsKLSAgICAgICAgZHRfZGF0YS0+YnVm
W2R0X2RhdGEtPnByZCsrXSA9ICpwOwotICAgICAgICBpZiAoIGR0X2RhdGEtPnByZCA9PSBkZWJ1
Z3RyYWNlX2J5dGVzICkKLSAgICAgICAgICAgIGR0X2RhdGEtPnByZCA9IDA7CisgICAgICAgIGRh
dGEtPmJ1ZltkYXRhLT5wcmQrK10gPSAqcDsKKyAgICAgICAgaWYgKCBkYXRhLT5wcmQgPT0gZGVi
dWd0cmFjZV9ieXRlcyApCisgICAgICAgICAgICBkYXRhLT5wcmQgPSAwOwogICAgIH0KIH0KIAog
dm9pZCBkZWJ1Z3RyYWNlX3ByaW50ayhjb25zdCBjaGFyICpmbXQsIC4uLikKIHsKICAgICBzdGF0
aWMgY2hhciBidWZbMTAyNF0sIGxhc3RfYnVmWzEwMjRdOwotICAgIHN0YXRpYyB1bnNpZ25lZCBp
bnQgY291bnQsIGxhc3RfY291bnQ7CisgICAgc3RhdGljIHVuc2lnbmVkIGludCBjb3VudCwgbGFz
dF9jb3VudCwgbGFzdF9jcHU7CiAgICAgc3RhdGljIHVuc2lnbmVkIGxvbmcgbGFzdF9wcmQ7CiAK
ICAgICBjaGFyICAgICAgICAgIGNudGJ1ZlsyNF07CiAgICAgdmFfbGlzdCAgICAgICBhcmdzOwog
ICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAgICAgdW5zaWduZWQgaW50IG5yOworICAgIHN0cnVj
dCBkZWJ1Z3RyYWNlX2RhdGEgKmRhdGE7CiAKLSAgICBpZiAoICFkdF9kYXRhICkKKyAgICBkYXRh
ID0gZGVidWd0cmFjZV9wZXJfY3B1ID8gdGhpc19jcHUoZHRfY3B1X2RhdGEpIDogZHRfZGF0YTsK
KyAgICBpZiAoICFkYXRhICkKICAgICAgICAgcmV0dXJuOwogCiAgICAgZGVidWd0cmFjZV91c2Vk
ID0gdHJ1ZTsKQEAgLTEzMiwxNyArMTgyLDIwIEBAIHZvaWQgZGVidWd0cmFjZV9wcmludGsoY29u
c3QgY2hhciAqZm10LCAuLi4pCiAgICAgfQogICAgIGVsc2UKICAgICB7Ci0gICAgICAgIGlmICgg
ZGVidWd0cmFjZV9idWZfZW1wdHkgfHwgc3RyY21wKGJ1ZiwgbGFzdF9idWYpICkKKyAgICAgICAg
dW5zaWduZWQgaW50IGNwdSA9IGRlYnVndHJhY2VfcGVyX2NwdSA/IHNtcF9wcm9jZXNzb3JfaWQo
KSA6IDA7CisKKyAgICAgICAgaWYgKCBkZWJ1Z3RyYWNlX2J1Zl9lbXB0eSB8fCBjcHUgIT0gbGFz
dF9jcHUgfHwgc3RyY21wKGJ1ZiwgbGFzdF9idWYpICkKICAgICAgICAgewogICAgICAgICAgICAg
ZGVidWd0cmFjZV9idWZfZW1wdHkgPSBmYWxzZTsKLSAgICAgICAgICAgIGxhc3RfcHJkID0gZHRf
ZGF0YS0+cHJkOworICAgICAgICAgICAgbGFzdF9wcmQgPSBkYXRhLT5wcmQ7CiAgICAgICAgICAg
ICBsYXN0X2NvdW50ID0gKytjb3VudDsKKyAgICAgICAgICAgIGxhc3RfY3B1ID0gY3B1OwogICAg
ICAgICAgICAgc2FmZV9zdHJjcHkobGFzdF9idWYsIGJ1Zik7CiAgICAgICAgICAgICBzbnByaW50
ZihjbnRidWYsIHNpemVvZihjbnRidWYpLCAiJXUgIiwgY291bnQpOwogICAgICAgICB9CiAgICAg
ICAgIGVsc2UKICAgICAgICAgewotICAgICAgICAgICAgZHRfZGF0YS0+cHJkID0gbGFzdF9wcmQ7
CisgICAgICAgICAgICBkYXRhLT5wcmQgPSBsYXN0X3ByZDsKICAgICAgICAgICAgIHNucHJpbnRm
KGNudGJ1Ziwgc2l6ZW9mKGNudGJ1ZiksICIldS0ldSAiLCBsYXN0X2NvdW50LCArK2NvdW50KTsK
ICAgICAgICAgfQogICAgICAgICBkZWJ1Z3RyYWNlX2FkZF90b19idWYoY250YnVmKTsKQEAgLTE1
NywzNCArMjEwLDY5IEBAIHN0YXRpYyB2b2lkIGRlYnVndHJhY2Vfa2V5KHVuc2lnbmVkIGNoYXIg
a2V5KQogICAgIGRlYnVndHJhY2VfdG9nZ2xlKCk7CiB9CiAKLXN0YXRpYyBpbnQgX19pbml0IGRl
YnVndHJhY2VfaW5pdCh2b2lkKQorc3RhdGljIHZvaWQgZGVidWd0cmFjZV9hbGxvY19idWZmZXIo
c3RydWN0IGRlYnVndHJhY2VfZGF0YSAqKnB0ciwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHVuc2lnbmVkIGludCBjcHUpCiB7CiAgICAgaW50IG9yZGVyOwotICAgIHVuc2ln
bmVkIGxvbmcga2J5dGVzOwogICAgIHN0cnVjdCBkZWJ1Z3RyYWNlX2RhdGEgKmRhdGE7CiAKLSAg
ICAvKiBSb3VuZCBzaXplIGRvd24gdG8gbmV4dCBwb3dlciBvZiB0d28uICovCi0gICAgd2hpbGUg
KCAoa2J5dGVzID0gKGRlYnVndHJhY2Vfa2lsb2J5dGVzICYgKGRlYnVndHJhY2Vfa2lsb2J5dGVz
LTEpKSkgIT0gMCApCi0gICAgICAgIGRlYnVndHJhY2Vfa2lsb2J5dGVzID0ga2J5dGVzOwotCi0g
ICAgZGVidWd0cmFjZV9ieXRlcyA9IGRlYnVndHJhY2Vfa2lsb2J5dGVzIDw8IDEwOwotICAgIGlm
ICggZGVidWd0cmFjZV9ieXRlcyA9PSAwICkKLSAgICAgICAgcmV0dXJuIDA7CisgICAgaWYgKCAq
cHRyICkKKyAgICAgICAgcmV0dXJuOwogCiAgICAgb3JkZXIgPSBnZXRfb3JkZXJfZnJvbV9ieXRl
cyhkZWJ1Z3RyYWNlX2J5dGVzKTsKICAgICBkYXRhID0gYWxsb2NfeGVuaGVhcF9wYWdlcyhvcmRl
ciwgMCk7CiAgICAgaWYgKCAhZGF0YSApCi0gICAgICAgIHJldHVybiAtRU5PTUVNOworICAgIHsK
KyAgICAgICAgaWYgKCBkZWJ1Z3RyYWNlX3Blcl9jcHUgKQorICAgICAgICAgICAgcHJpbnRrKCJD
UFUldTogZmFpbGVkIHRvIGFsbG9jYXRlIGRlYnVndHJhY2UgYnVmZmVyXG4iLCBjcHUpOworICAg
ICAgICBlbHNlCisgICAgICAgICAgICBwcmludGsoImZhaWxlZCB0byBhbGxvY2F0ZSBkZWJ1Z3Ry
YWNlIGJ1ZmZlclxuIik7CisgICAgICAgIHJldHVybjsKKyAgICB9CiAKLSAgICBkZWJ1Z3RyYWNl
X2J5dGVzID0gUEFHRV9TSVpFIDw8IG9yZGVyOwotICAgIG1lbXNldChkYXRhLCAnXDAnLCBkZWJ1
Z3RyYWNlX2J5dGVzKTsKLSAgICBkZWJ1Z3RyYWNlX2J5dGVzIC09IHNpemVvZigqZGF0YSk7Cisg
ICAgbWVtc2V0KGRhdGEsICdcMCcsIGRlYnVndHJhY2VfYnl0ZXMgKyBzaXplb2YoKmRhdGEpKTsK
IAogICAgIGR0X2RhdGEgPSBkYXRhOworICAgICpwdHIgPSBkYXRhOworfQorCitzdGF0aWMgaW50
IGRlYnVndHJhY2VfY3B1X2NhbGxiYWNrKHN0cnVjdCBub3RpZmllcl9ibG9jayAqbmZiLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBsb25nIGFjdGlvbiwgdm9p
ZCAqaGNwdSkKK3sKKyAgICB1bnNpZ25lZCBpbnQgY3B1ID0gKHVuc2lnbmVkIGxvbmcpaGNwdTsK
KworICAgIC8qIEJ1ZmZlcnMgYXJlIG9ubHkgZXZlciBhbGxvY2F0ZWQsIG5ldmVyIGZyZWVkLiAq
LworICAgIGlmICggYWN0aW9uID09IENQVV9VUF9QUkVQQVJFICkKKyAgICAgICAgZGVidWd0cmFj
ZV9hbGxvY19idWZmZXIoJnBlcl9jcHUoZHRfY3B1X2RhdGEsIGNwdSksIGNwdSk7CisKKyAgICBy
ZXR1cm4gMDsKK30KKworc3RhdGljIHN0cnVjdCBub3RpZmllcl9ibG9jayBkZWJ1Z3RyYWNlX25m
YiA9IHsKKyAgICAubm90aWZpZXJfY2FsbCA9IGRlYnVndHJhY2VfY3B1X2NhbGxiYWNrCit9Owor
CitzdGF0aWMgaW50IF9faW5pdCBkZWJ1Z3RyYWNlX2luaXQodm9pZCkKK3sKKyAgICB1bnNpZ25l
ZCBpbnQgY3B1OworCisgICAgaWYgKCAhZGVidWd0cmFjZV9ieXRlcyApCisgICAgICAgIHJldHVy
biAwOwogCiAgICAgcmVnaXN0ZXJfa2V5aGFuZGxlcignVCcsIGRlYnVndHJhY2Vfa2V5LAogICAg
ICAgICAgICAgICAgICAgICAgICAgInRvZ2dsZSBkZWJ1Z3RyYWNlIHRvIGNvbnNvbGUvYnVmZmVy
IiwgMCk7CiAKKyAgICBkZWJ1Z3RyYWNlX2J5dGVzIC09IHNpemVvZihzdHJ1Y3QgZGVidWd0cmFj
ZV9kYXRhKTsKKworICAgIGlmICggZGVidWd0cmFjZV9wZXJfY3B1ICkKKyAgICB7CisgICAgICAg
IGZvcl9lYWNoX29ubGluZV9jcHUgKCBjcHUgKQorICAgICAgICAgICAgZGVidWd0cmFjZV9hbGxv
Y19idWZmZXIoJnBlcl9jcHUoZHRfY3B1X2RhdGEsIGNwdSksIGNwdSk7CisgICAgICAgIHJlZ2lz
dGVyX2NwdV9ub3RpZmllcigmZGVidWd0cmFjZV9uZmIpOworICAgIH0KKyAgICBlbHNlCisgICAg
ICAgIGRlYnVndHJhY2VfYWxsb2NfYnVmZmVyKCZkdF9kYXRhLCAwKTsKKwogICAgIHJldHVybiAw
OwogfQogX19pbml0Y2FsbChkZWJ1Z3RyYWNlX2luaXQpOwotLSAKMi4xNi40CgoKX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcg
bGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9q
ZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==

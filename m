Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 480F0144E0
	for <lists+xen-devel@lfdr.de>; Mon,  6 May 2019 09:01:35 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hNXZ9-000395-4n; Mon, 06 May 2019 06:57:35 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <SRS0=XZcu=TG=suse.com=jgross@srs-us1.protection.inumbo.net>)
 id 1hNXYn-0002K2-IL
 for xen-devel@lists.xenproject.org; Mon, 06 May 2019 06:57:13 +0000
X-Inumbo-ID: 23e28f46-6fcc-11e9-843c-bc764e045a96
Received: from mx1.suse.de (unknown [195.135.220.15])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 23e28f46-6fcc-11e9-843c-bc764e045a96;
 Mon, 06 May 2019 06:56:58 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 60602AF22;
 Mon,  6 May 2019 06:56:54 +0000 (UTC)
From: Juergen Gross <jgross@suse.com>
To: xen-devel@lists.xenproject.org
Date: Mon,  6 May 2019 08:56:20 +0200
Message-Id: <20190506065644.7415-22-jgross@suse.com>
X-Mailer: git-send-email 2.16.4
In-Reply-To: <20190506065644.7415-1-jgross@suse.com>
References: <20190506065644.7415-1-jgross@suse.com>
Subject: [Xen-devel] [PATCH RFC V2 21/45] xen/sched: make credit2 scheduler
 vcpu agnostic.
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Dario Faggioli <dfaggioli@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

U3dpdGNoIGNyZWRpdDIgc2NoZWR1bGVyIGNvbXBsZXRlbHkgZnJvbSB2Y3B1IHRvIHNjaGVkX2l0
ZW0gdXNhZ2UuCgpBcyB3ZSBhcmUgdG91Y2hpbmcgbG90cyBvZiBsaW5lcyByZW1vdmUgc29tZSB3
aGl0ZSBzcGFjZSBhdCB0aGUgZW5kIG9mCnRoZSBsaW5lLCB0b28uCgpTaWduZWQtb2ZmLWJ5OiBK
dWVyZ2VuIEdyb3NzIDxqZ3Jvc3NAc3VzZS5jb20+Ci0tLQogeGVuL2NvbW1vbi9zY2hlZF9jcmVk
aXQyLmMgfCA4MjAgKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
CiAxIGZpbGUgY2hhbmdlZCwgNDAzIGluc2VydGlvbnMoKyksIDQxNyBkZWxldGlvbnMoLSkKCmRp
ZmYgLS1naXQgYS94ZW4vY29tbW9uL3NjaGVkX2NyZWRpdDIuYyBiL3hlbi9jb21tb24vc2NoZWRf
Y3JlZGl0Mi5jCmluZGV4IDBmMGQ2YTM4MDEuLjc5MThkNDZhMjMgMTAwNjQ0Ci0tLSBhL3hlbi9j
b21tb24vc2NoZWRfY3JlZGl0Mi5jCisrKyBiL3hlbi9jb21tb24vc2NoZWRfY3JlZGl0Mi5jCkBA
IC00NSw3ICs0NSw3IEBACiAjZGVmaW5lIFRSQ19DU0NIRUQyX1NDSEVEX1RBU0tMRVQgICAgVFJD
X1NDSEVEX0NMQVNTX0VWVChDU0NIRUQyLCA4KQogI2RlZmluZSBUUkNfQ1NDSEVEMl9VUERBVEVf
TE9BRCAgICAgIFRSQ19TQ0hFRF9DTEFTU19FVlQoQ1NDSEVEMiwgOSkKICNkZWZpbmUgVFJDX0NT
Q0hFRDJfUlVOUV9BU1NJR04gICAgICBUUkNfU0NIRURfQ0xBU1NfRVZUKENTQ0hFRDIsIDEwKQot
I2RlZmluZSBUUkNfQ1NDSEVEMl9VUERBVEVfVkNQVV9MT0FEIFRSQ19TQ0hFRF9DTEFTU19FVlQo
Q1NDSEVEMiwgMTEpCisjZGVmaW5lIFRSQ19DU0NIRUQyX1VQREFURV9JVEVNX0xPQUQgVFJDX1ND
SEVEX0NMQVNTX0VWVChDU0NIRUQyLCAxMSkKICNkZWZpbmUgVFJDX0NTQ0hFRDJfVVBEQVRFX1JV
TlFfTE9BRCBUUkNfU0NIRURfQ0xBU1NfRVZUKENTQ0hFRDIsIDEyKQogI2RlZmluZSBUUkNfQ1ND
SEVEMl9USUNLTEVfTkVXICAgICAgIFRSQ19TQ0hFRF9DTEFTU19FVlQoQ1NDSEVEMiwgMTMpCiAj
ZGVmaW5lIFRSQ19DU0NIRUQyX1JVTlFfTUFYX1dFSUdIVCAgVFJDX1NDSEVEX0NMQVNTX0VWVChD
U0NIRUQyLCAxNCkKQEAgLTc0LDEzICs3NCwxMyBAQAogICogRGVzaWduOgogICoKICAqIFZNcyAi
YnVybiIgY3JlZGl0cyBiYXNlZCBvbiB0aGVpciB3ZWlnaHQ7IGhpZ2hlciB3ZWlnaHQgbWVhbnMK
LSAqIGNyZWRpdHMgYnVybiBtb3JlIHNsb3dseS4gIFRoZSBoaWdoZXN0IHdlaWdodCB2Y3B1IGJ1
cm5zIGNyZWRpdHMgYXQKKyAqIGNyZWRpdHMgYnVybiBtb3JlIHNsb3dseS4gIFRoZSBoaWdoZXN0
IHdlaWdodCBpdGVtIGJ1cm5zIGNyZWRpdHMgYXQKICAqIGEgcmF0ZSBvZiAxIGNyZWRpdCBwZXIg
bmFub3NlY29uZC4gIE90aGVycyBidXJuIHByb3BvcnRpb25hbGx5CiAgKiBtb3JlLgogICoKLSAq
IHZjcHVzIGFyZSBpbnNlcnRlZCBpbnRvIHRoZSBydW5xdWV1ZSBieSBjcmVkaXQgb3JkZXIuCisg
KiBpdGVtcyBhcmUgaW5zZXJ0ZWQgaW50byB0aGUgcnVucXVldWUgYnkgY3JlZGl0IG9yZGVyLgog
ICoKLSAqIENyZWRpdHMgYXJlICJyZXNldCIgd2hlbiB0aGUgbmV4dCB2Y3B1IGluIHRoZSBydW5x
dWV1ZSBpcyBsZXNzIHRoYW4KKyAqIENyZWRpdHMgYXJlICJyZXNldCIgd2hlbiB0aGUgbmV4dCBp
dGVtIGluIHRoZSBydW5xdWV1ZSBpcyBsZXNzIHRoYW4KICAqIG9yIGVxdWFsIHRvIHplcm8uICBB
dCB0aGF0IHBvaW50LCBldmVyeW9uZSdzIGNyZWRpdHMgYXJlICJjbGlwcGVkIgogICogdG8gYSBz
bWFsbCB2YWx1ZSwgYW5kIGEgZml4ZWQgY3JlZGl0IGlzIGFkZGVkIHRvIGV2ZXJ5b25lLgogICov
CkBAIC05NSwzMyArOTUsMzMgQEAKICAqICAgYmUgZ2l2ZW4gYSBjYXAgb2YgMjUlOyBhIGRvbWFp
biB0aGF0IG11c3Qgbm90IHVzZSBtb3JlIHRoYW4gMSsxLzIgb2YKICAqICAgcGh5c2ljYWwgQ1BV
IHRpbWUsIHdpbGwgYmUgZ2l2ZW4gYSBjYXAgb2YgMTUwJTsKICAqCi0gKiAtIGNhcHMgYXJlIHBl
ci1kb21haW4gKG5vdCBwZXItdkNQVSkuIElmIGEgZG9tYWluIGhhcyBvbmx5IDEgdkNQVSwgYW5k
Ci0gKiAgIGEgNDAlIGNhcCwgdGhhdCBvbmUgdkNQVSB3aWxsIHVzZSA0MCUgb2Ygb25lIHBDUFUu
IElmIGEgc29tYWluIGhhcyA0Ci0gKiAgIHZDUFVzLCBhbmQgYSAyMDAlIGNhcCwgdGhlIGVxdWl2
YWxlbnQgb2YgMTAwJSB0aW1lIG9uIDIgcENQVXMgd2lsbCBiZQotICogICBzcGxpdCBhbW9uZyB0
aGUgdiB2Q1BVcy4gSG93IG11Y2ggZWFjaCBvZiB0aGUgdkNQVXMgd2lsbCBhY3R1YWxseSBnZXQs
CisgKiAtIGNhcHMgYXJlIHBlci1kb21haW4gKG5vdCBwZXItaXRlbSkuIElmIGEgZG9tYWluIGhh
cyBvbmx5IDEgaXRlbSwgYW5kCisgKiAgIGEgNDAlIGNhcCwgdGhhdCBvbmUgaXRlbSB3aWxsIHVz
ZSA0MCUgb2Ygb25lIHBDUFUuIElmIGEgc29tYWluIGhhcyA0CisgKiAgIGl0ZW1zLCBhbmQgYSAy
MDAlIGNhcCwgdGhlIGVxdWl2YWxlbnQgb2YgMTAwJSB0aW1lIG9uIDIgcENQVXMgd2lsbCBiZQor
ICogICBzcGxpdCBhbW9uZyB0aGUgdiBpdGVtcy4gSG93IG11Y2ggZWFjaCBvZiB0aGUgaXRlbXMg
d2lsbCBhY3R1YWxseSBnZXQsCiAgKiAgIGR1cmluZyBhbnkgZ2l2ZW4gaW50ZXJ2YWwgb2YgdGlt
ZSwgaXMgdW5zcGVjaWZpZWQgKGFzIGl0IGRlcGVuZHMgb24KICAqICAgdmFyaW91cyBhc3BlY3Rz
OiB3b3JrbG9hZCwgc3lzdGVtIGxvYWQsIGV0Yy4pLiBGb3IgaW5zdGFuY2UsIGl0IGlzCi0gKiAg
IHBvc3NpYmxlIHRoYXQsIGR1cmluZyBhIGdpdmVuIHRpbWUgaW50ZXJ2YWwsIDIgdkNQVXMgdXNl
IDEwMCUgZWFjaCwKKyAqICAgcG9zc2libGUgdGhhdCwgZHVyaW5nIGEgZ2l2ZW4gdGltZSBpbnRl
cnZhbCwgMiBpdGVtcyB1c2UgMTAwJSBlYWNoLAogICogICBhbmQgdGhlIG90aGVyIHR3byB1c2Ug
bm90aGluZzsgd2hpbGUgZHVyaW5nIGFub3RoZXIgdGltZSBpbnRlcnZhbCwKLSAqICAgdHdvIHZD
UFVzIHVzZSA4MCUsIG9uZSB1c2VzIDEwJSBhbmQgdGhlIG90aGVyIDMwJTsgb3IgdGhhdCBlYWNo
IHVzZQorICogICB0d28gaXRlbXMgdXNlIDgwJSwgb25lIHVzZXMgMTAlIGFuZCB0aGUgb3RoZXIg
MzAlOyBvciB0aGF0IGVhY2ggdXNlCiAgKiAgIDUwJSAoYW5kIHNvIG9uIGFuZCBzbyBmb3J0aCku
CiAgKgogICogRm9yIGltcGxlbWVudGluZyB0aGlzLCB3ZSB1c2UgdGhlIGZvbGxvd2luZyBhcHBy
b2FjaDoKICAqCiAgKiAtIGVhY2ggZG9tYWluIGlzIGdpdmVuIGEgJ2J1ZGdldCcsIGFuIGVhY2gg
ZG9tYWluIGhhcyBhIHRpbWVyLCB3aGljaAogICogICByZXBsZW5pc2hlcyB0aGUgZG9tYWluJ3Mg
YnVkZ2V0IHBlcmlvZGljYWxseS4gVGhlIGJ1ZGdldCBpcyB0aGUgYW1vdW50Ci0gKiAgIG9mIHRp
bWUgdGhlIHZDUFVzIG9mIHRoZSBkb21haW4gY2FuIHVzZSBldmVyeSAncGVyaW9kJzsKKyAqICAg
b2YgdGltZSB0aGUgaXRlbXMgb2YgdGhlIGRvbWFpbiBjYW4gdXNlIGV2ZXJ5ICdwZXJpb2QnOwog
ICoKICAqIC0gdGhlIHBlcmlvZCBpcyBDU0NIRUQyX0JER1RfUkVQTF9QRVJJT0QsIGFuZCBpcyB0
aGUgc2FtZSBmb3IgYWxsIGRvbWFpbnMKICAqICAgKGJ1dCBlYWNoIGRvbWFpbiBoYXMgaXRzIG93
biB0aW1lcjsgc28gdGhlIGFsbCBhcmUgcGVyaW9kaWMgYnkgdGhlIHNhbWUKICAqICAgcGVyaW9k
LCBidXQgcmVwbGVuaXNobWVudCBvZiB0aGUgYnVkZ2V0cyBvZiB0aGUgdmFyaW91cyBkb21haW5z
LCBhdAogICogICBwZXJpb2RzIGJvdW5kYXJpZXMsIGFyZSBub3Qgc3luY2hyb25vdXMpOwogICoK
LSAqIC0gd2hlbiB2Q1BVcyBydW4sIHRoZXkgY29uc3VtZSBidWRnZXQuIFdoZW4gdGhleSBkb24n
dCBydW4sIHRoZXkgZG9uJ3QKLSAqICAgY29uc3VtZSBidWRnZXQuIElmIHRoZXJlIGlzIG5vIGJ1
ZGdldCBsZWZ0IGZvciB0aGUgZG9tYWluLCBubyB2Q1BVIG9mCi0gKiAgIHRoYXQgZG9tYWluIGNh
biBydW4uIElmIGEgdkNQVSB0cmllcyB0byBydW4gYW5kIGZpbmRzIHRoYXQgdGhlcmUgaXMgbm8K
KyAqIC0gd2hlbiBpdGVtcyBydW4sIHRoZXkgY29uc3VtZSBidWRnZXQuIFdoZW4gdGhleSBkb24n
dCBydW4sIHRoZXkgZG9uJ3QKKyAqICAgY29uc3VtZSBidWRnZXQuIElmIHRoZXJlIGlzIG5vIGJ1
ZGdldCBsZWZ0IGZvciB0aGUgZG9tYWluLCBubyBpdGVtIG9mCisgKiAgIHRoYXQgZG9tYWluIGNh
biBydW4uIElmIGFuIGl0ZW0gdHJpZXMgdG8gcnVuIGFuZCBmaW5kcyB0aGF0IHRoZXJlIGlzIG5v
CiAgKiAgIGJ1ZGdldCwgaXQgYmxvY2tzLgotICogICBBdCB3aGF0ZXZlciB0aW1lIGEgdkNQVSB3
YW50cyB0byBydW4sIGl0IG11c3QgY2hlY2sgdGhlIGRvbWFpbidzIGJ1ZGdldCwKKyAqICAgQXQg
d2hhdGV2ZXIgdGltZSBhbiBpdGVtIHdhbnRzIHRvIHJ1biwgaXQgbXVzdCBjaGVjayB0aGUgZG9t
YWluJ3MgYnVkZ2V0LAogICogICBhbmQgaWYgdGhlcmUgaXMgc29tZSwgaXQgY2FuIHVzZSBpdC4K
ICAqCiAgKiAtIGJ1ZGdldCBpcyByZXBsZW5pc2hlZCB0byB0aGUgdG9wIG9mIHRoZSBjYXBhY2l0
eSBmb3IgdGhlIGRvbWFpbiBvbmNlCkBAIC0xMjksMzkgKzEyOSwzOSBAQAogICogICB0aG91Z2gs
IHRoZSBidWRnZXQgYWZ0ZXIgYSByZXBsZW5pc2htZW50IHdpbGwgYWx3YXlzIGJlIGF0IG1vc3Qg
ZXF1YWwKICAqICAgdG8gdGhlIHRvdGFsIGNhcGFjaWZ5IG9mIHRoZSBkb21haW4gKCd0b3RfYnVk
Z2V0Jyk7CiAgKgotICogLSB3aGVuIGEgYnVkZ2V0IHJlcGxlbmlzaG1lbnQgb2NjdXJzLCBpZiB0
aGVyZSBhcmUgdkNQVXMgdGhhdCBoYWQgYmVlbgorICogLSB3aGVuIGEgYnVkZ2V0IHJlcGxlbmlz
aG1lbnQgb2NjdXJzLCBpZiB0aGVyZSBhcmUgaXRlbXMgdGhhdCBoYWQgYmVlbgogICogICBibG9j
a2VkIGJlY2F1c2Ugb2YgbGFjayBvZiBidWRnZXQsIHRoZXknbGwgYmUgdW5ibG9ja2VkLCBhbmQg
dGhleSB3aWxsCiAgKiAgIChwb3RlbnRpYWxseSkgYmUgYWJsZSB0byBydW4gYWdhaW4uCiAgKgog
ICogRmluYWxseSwgc29tZSBldmVuIG1vcmUgaW1wbGVtZW50YXRpb24gcmVsYXRlZCBkZXRhaWw6
CiAgKgotICogLSBidWRnZXQgaXMgc3RvcmVkIGluIGEgZG9tYWluLXdpZGUgcG9vbC4gdkNQVXMg
b2YgdGhlIGRvbWFpbiB0aGF0IHdhbnQKKyAqIC0gYnVkZ2V0IGlzIHN0b3JlZCBpbiBhIGRvbWFp
bi13aWRlIHBvb2wuIEl0ZW1zIG9mIHRoZSBkb21haW4gdGhhdCB3YW50CiAgKiAgIHRvIHJ1biBn
byB0byBzdWNoIHBvb2wsIGFuZCBncnViIHNvbWUuIFdoZW4gdGhleSBkbyBzbywgdGhlIGFtb3Vu
dAogICogICB0aGV5IGdyYWJiZWQgaXMgX2ltbWVkaWF0ZWx5XyByZW1vdmVkIGZyb20gdGhlIHBv
b2wuIFRoaXMgaGFwcGVucyBpbgotICogICB2Y3B1X2dyYWJfYnVkZ2V0KCk7CisgKiAgIGl0ZW1f
Z3JhYl9idWRnZXQoKTsKICAqCi0gKiAtIHdoZW4gdkNQVXMgc3RvcCBydW5uaW5nLCBpZiB0aGV5
J3ZlIG5vdCBjb25zdW1lZCBhbGwgdGhlIGJ1ZGdldCB0aGV5CisgKiAtIHdoZW4gaXRlbXMgc3Rv
cCBydW5uaW5nLCBpZiB0aGV5J3ZlIG5vdCBjb25zdW1lZCBhbGwgdGhlIGJ1ZGdldCB0aGV5CiAg
KiAgIHRvb2ssIHRoZSBsZWZ0b3ZlciBpcyBwdXQgYmFjayBpbiB0aGUgcG9vbC4gVGhpcyBoYXBw
ZW5zIGluCi0gKiAgIHZjcHVfcmV0dXJuX2J1ZGdldCgpOworICogICBpdGVtX3JldHVybl9idWRn
ZXQoKTsKICAqCi0gKiAtIHRoZSBhYm92ZSBtZWFucyB0aGF0IGEgdkNQVSBjYW4gZmluZCBvdXQg
dGhhdCB0aGVyZSBpcyBubyBidWRnZXQgYW5kCisgKiAtIHRoZSBhYm92ZSBtZWFucyB0aGF0IGFu
IGl0ZW0gY2FuIGZpbmQgb3V0IHRoYXQgdGhlcmUgaXMgbm8gYnVkZ2V0IGFuZAogICogICBibG9j
aywgbm90IG9ubHkgaWYgdGhlIGNhcCBoYXMgYWN0dWFsbHkgYmVlbiByZWFjaGVkIChmb3IgdGhp
cyBwZXJpb2QpLAotICogICBidXQgYWxzbyBpZiBzb21lIG90aGVyIHZDUFVzLCBpbiBvcmRlciB0
byBydW4sIGhhdmUgZ3JhYmJlZCBhIGNlcnRhaW4KKyAqICAgYnV0IGFsc28gaWYgc29tZSBvdGhl
ciBpdGVtcywgaW4gb3JkZXIgdG8gcnVuLCBoYXZlIGdyYWJiZWQgYSBjZXJ0YWluCiAgKiAgIHF1
b3RhIG9mIGJ1ZGdldCwgbm8gbWF0dGVyIHdoZXRoZXIgdGhleSd2ZSBhbHJlYWR5IHVzZWQgaXQg
YWxsIG9yIG5vdC4KLSAqICAgQSB2Q1BVIGJsb2NraW5nIGJlY2F1c2UgKGFueSBmb3JtIG9mKSBs
YWNrIG9mIGJ1ZGdldCBpcyBzYWlkIHRvIGJlCi0gKiAgICJwYXJrZWQiLCBhbmQgc3VjaCBibG9j
a2luZyBoYXBwZW5zIGluIHBhcmtfdmNwdSgpOworICogICBBbiBpdGVtIGJsb2NraW5nIGJlY2F1
c2UgKGFueSBmb3JtIG9mKSBsYWNrIG9mIGJ1ZGdldCBpcyBzYWlkIHRvIGJlCisgKiAgICJwYXJr
ZWQiLCBhbmQgc3VjaCBibG9ja2luZyBoYXBwZW5zIGluIHBhcmtfaXRlbSgpOwogICoKLSAqIC0g
d2hlbiBhIHZDUFUgc3RvcHMgcnVubmluZywgYW5kIHB1dHMgYmFjayBzb21lIGJ1ZGdldCBpbiB0
aGUgZG9tYWluIHBvb2wsCisgKiAtIHdoZW4gYW4gaXRlbSBzdG9wcyBydW5uaW5nLCBhbmQgcHV0
cyBiYWNrIHNvbWUgYnVkZ2V0IGluIHRoZSBkb21haW4gcG9vbCwKICAqICAgd2UgbmVlZCB0byBj
aGVjayB3aGV0aGVyIHRoZXJlIGlzIHNvbWVvbmUgd2hpY2ggaGFzIGJlZW4gcGFya2VkIGFuZCB0
aGF0Ci0gKiAgIGNhbiBiZSB1bnBhcmtlZC4gVGhpcyBoYXBwZW5zIGluIHVucGFya19wYXJrZWRf
dmNwdXMoKSwgY2FsbGVkIGZyb20KKyAqICAgY2FuIGJlIHVucGFya2VkLiBUaGlzIGhhcHBlbnMg
aW4gdW5wYXJrX3BhcmtlZF9pdGVtcygpLCBjYWxsZWQgZnJvbQogICogICBjc2NoZWQyX2NvbnRl
eHRfc2F2ZWQoKTsKICAqCiAgKiAtIG9mIGNvdXJzZSwgdW5wYXJraW5nIGhhcHBlbnMgYWxzbyBh
cyBhIGNvbnNlcXVlbmNlIG9mIHRoZSBkb21haW4ncyBidWRnZXQKICAqICAgYmVpbmcgcmVwbGVu
aXNoZWQgYnkgdGhlIHBlcmlvZGljIHRpbWVyLiBUaGlzIGFsc28gb2NjdXJzIGJ5IG1lYW5zIG9m
CiAgKiAgIGNhbGxpbmcgY3NjaGVkMl9jb250ZXh0X3NhdmVkKCkgKGJ1dCBmcm9tIHJlcGxlbmlz
aF9kb21haW5fYnVkZ2V0KCkpOwogICoKLSAqIC0gcGFya2VkIHZDUFVzIG9mIGEgZG9tYWluIGFy
ZSBrZXB0IGluIGEgKHBlci1kb21haW4pIGxpc3QsIGNhbGxlZAotICogICAncGFya2VkX3ZjcHVz
JykuIE1hbmlwdWxhdGlvbiBvZiB0aGUgbGlzdCBhbmQgb2YgdGhlIGRvbWFpbi13aWRlIGJ1ZGdl
dAorICogLSBwYXJrZWQgaXRlbXMgb2YgYSBkb21haW4gYXJlIGtlcHQgaW4gYSAocGVyLWRvbWFp
bikgbGlzdCwgY2FsbGVkCisgKiAgICdwYXJrZWRfaXRlbXMnKS4gTWFuaXB1bGF0aW9uIG9mIHRo
ZSBsaXN0IGFuZCBvZiB0aGUgZG9tYWluLXdpZGUgYnVkZ2V0CiAgKiAgIHBvb2wsIG11c3Qgb2Nj
dXIgb25seSB3aGVuIGhvbGRpbmcgdGhlICdidWRnZXRfbG9jaycuCiAgKi8KIApAQCAtMTc0LDkg
KzE3NCw5IEBACiAgKiAgICAgcGNwdV9zY2hlZHVsZV9sb2NrKCkgLyBpdGVtX3NjaGVkdWxlX2xv
Y2soKSAoYW5kIGZyaWVuZHMpLAogICogICAqIGEgY3B1IG1heSAodHJ5IHRvKSB0YWtlIGEgInJl
bW90ZSIgcnVucXVldWUgbG9jaywgZS5nLiwgZm9yCiAgKiAgICAgbG9hZCBiYWxhbmNpbmc7Ci0g
KiAgKyBzZXJpYWxpemVzIHJ1bnF1ZXVlIG9wZXJhdGlvbnMgKHJlbW92aW5nIGFuZCBpbnNlcnRp
bmcgdmNwdXMpOworICogICsgc2VyaWFsaXplcyBydW5xdWV1ZSBvcGVyYXRpb25zIChyZW1vdmlu
ZyBhbmQgaW5zZXJ0aW5nIGl0ZW1zKTsKICAqICArIHByb3RlY3RzIHJ1bnF1ZXVlLXdpZGUgZGF0
YSBpbiBjc2NoZWQyX3J1bnF1ZXVlX2RhdGE7Ci0gKiAgKyBwcm90ZWN0cyB2Y3B1IHBhcmFtZXRl
cnMgaW4gY3NjaGVkMl9pdGVtIGZvciB0aGUgdmNwdSBpbiB0aGUKKyAqICArIHByb3RlY3RzIGl0
ZW0gcGFyYW1ldGVycyBpbiBjc2NoZWQyX2l0ZW0gZm9yIHRoZSBpdGVtIGluIHRoZQogICogICAg
cnVucXVldWUuCiAgKgogICogLSBQcml2YXRlIHNjaGVkdWxlciBsb2NrCkBAIC0xOTAsOCArMTkw
LDggQEAKICAqICArIGl0IGlzIHBlci1kb21haW47CiAgKiAgKyBwcm90ZWN0cywgaW4gZG9tYWlu
cyB0aGF0IGhhdmUgYW4gdXRpbGl6YXRpb24gY2FwOwogICogICAqIG1hbmlwdWxhdGlvbiBvZiB0
aGUgdG90YWwgYnVkZ2V0IG9mIHRoZSBkb21haW4gKGFzIGl0IGlzIHNoYXJlZAotICogICAgIGFt
b25nIGFsbCB2Q1BVcyBvZiB0aGUgZG9tYWluKSwKLSAqICAgKiBtYW5pcHVsYXRpb24gb2YgdGhl
IGxpc3Qgb2YgdkNQVXMgdGhhdCBhcmUgYmxvY2tlZCB3YWl0aW5nIGZvcgorICogICAgIGFtb25n
IGFsbCBpdGVtcyBvZiB0aGUgZG9tYWluKSwKKyAqICAgKiBtYW5pcHVsYXRpb24gb2YgdGhlIGxp
c3Qgb2YgaXRlbXMgdGhhdCBhcmUgYmxvY2tlZCB3YWl0aW5nIGZvcgogICogICAgIHNvbWUgYnVk
Z2V0IHRvIGJlIGF2YWlsYWJsZS4KICAqCiAgKiAtIFR5cGU6CkBAIC0yMjgsOSArMjI4LDkgQEAK
ICAqLwogI2RlZmluZSBDU0NIRUQyX0NSRURJVF9JTklUICAgICAgICAgIE1JTExJU0VDUygxMCkK
IC8qCi0gKiBBbW91bnQgb2YgY3JlZGl0IHRoZSBpZGxlIHZjcHVzIGhhdmUuIEl0IG5ldmVyIGNo
YW5nZXMsIGFzIGlkbGUKLSAqIHZjcHVzIGRvZXMgbm90IGNvbnN1bWUgY3JlZGl0cywgYW5kIGl0
IG11c3QgYmUgbG93ZXIgdGhhbiB3aGF0ZXZlcgotICogYW1vdW50IG9mIGNyZWRpdCAncmVndWxh
cicgdmNwdSB3b3VsZCBlbmQgdXAgd2l0aC4KKyAqIEFtb3VudCBvZiBjcmVkaXQgdGhlIGlkbGUg
aXRlbXMgaGF2ZS4gSXQgbmV2ZXIgY2hhbmdlcywgYXMgaWRsZQorICogaXRlbXMgZG9lcyBub3Qg
Y29uc3VtZSBjcmVkaXRzLCBhbmQgaXQgbXVzdCBiZSBsb3dlciB0aGFuIHdoYXRldmVyCisgKiBh
bW91bnQgb2YgY3JlZGl0ICdyZWd1bGFyJyBpdGVtIHdvdWxkIGVuZCB1cCB3aXRoLgogICovCiAj
ZGVmaW5lIENTQ0hFRDJfSURMRV9DUkVESVQgICAgICAgICAgKC0oMVU8PDMwKSkKIC8qCkBAIC0y
NDMsOSArMjQzLDkgQEAKICAqIE1JTl9USU1FUi4KICAqLwogI2RlZmluZSBDU0NIRUQyX01JR1JB
VEVfUkVTSVNUICAgICAgICgob3B0X21pZ3JhdGVfcmVzaXN0KSpNSUNST1NFQ1MoMSkpCi0vKiBI
b3cgbXVjaCB0byAiY29tcGVuc2F0ZSIgYSB2Y3B1IGZvciBMMiBtaWdyYXRpb24uICovCisvKiBI
b3cgbXVjaCB0byAiY29tcGVuc2F0ZSIgYW4gaXRlbSBmb3IgTDIgbWlncmF0aW9uLiAqLwogI2Rl
ZmluZSBDU0NIRUQyX01JR1JBVEVfQ09NUEVOU0FUSU9OIE1JQ1JPU0VDUyg1MCkKLS8qIEhvdyB0
b2xlcmFudCB3ZSBzaG91bGQgYmUgd2hlbiBwZWVraW5nIGF0IHJ1bnRpbWUgb2YgdmNwdXMgb24g
b3RoZXIgY3B1cyAqLworLyogSG93IHRvbGVyYW50IHdlIHNob3VsZCBiZSB3aGVuIHBlZWtpbmcg
YXQgcnVudGltZSBvZiBpdGVtcyBvbiBvdGhlciBjcHVzICovCiAjZGVmaW5lIENTQ0hFRDJfUkFU
RUxJTUlUX1RJQ0tMRV9UT0xFUkFOQ0UgTUlDUk9TRUNTKDUwKQogLyogUmVzZXQ6IFZhbHVlIGJl
bG93IHdoaWNoIGNyZWRpdCB3aWxsIGJlIHJlc2V0LiAqLwogI2RlZmluZSBDU0NIRUQyX0NSRURJ
VF9SRVNFVCAgICAgICAgIDAKQEAgLTI1OCw3ICsyNTgsNyBAQAogICogRmxhZ3MKICAqLwogLyoK
LSAqIENTRkxBR19zY2hlZHVsZWQ6IElzIHRoaXMgdmNwdSBlaXRoZXIgcnVubmluZyBvbiwgb3Ig
Y29udGV4dC1zd2l0Y2hpbmcgb2ZmLAorICogQ1NGTEFHX3NjaGVkdWxlZDogSXMgdGhpcyBpdGVt
IGVpdGhlciBydW5uaW5nIG9uLCBvciBjb250ZXh0LXN3aXRjaGluZyBvZmYsCiAgKiBhIHBoeXNp
Y2FsIGNwdT8KICAqICsgQWNjZXNzZWQgb25seSB3aXRoIHJ1bnF1ZXVlIGxvY2sgaGVsZAogICog
KyBTZXQgd2hlbiBjaG9zZW4gYXMgbmV4dCBpbiBjc2NoZWQyX3NjaGVkdWxlKCkuCkBAIC0yODAs
MjEgKzI4MCwyMSBAQAogI2RlZmluZSBfX0NTRkxBR19kZWxheWVkX3J1bnFfYWRkIDIKICNkZWZp
bmUgQ1NGTEFHX2RlbGF5ZWRfcnVucV9hZGQgKDFVPDxfX0NTRkxBR19kZWxheWVkX3J1bnFfYWRk
KQogLyoKLSAqIENTRkxBR19ydW5xX21pZ3JhdGVfcmVxdWVzdDogVGhpcyB2Y3B1IGlzIGJlaW5n
IG1pZ3JhdGVkIGFzIGEgcmVzdWx0IG9mIGEKKyAqIENTRkxBR19ydW5xX21pZ3JhdGVfcmVxdWVz
dDogVGhpcyBpdGVtIGlzIGJlaW5nIG1pZ3JhdGVkIGFzIGEgcmVzdWx0IG9mIGEKICAqIGNyZWRp
dDItaW5pdGlhdGVkIHJ1bnEgbWlncmF0ZSByZXF1ZXN0OyBtaWdyYXRlIGl0IHRvIHRoZSBydW5x
dWV1ZSBpbmRpY2F0ZWQKLSAqIGluIHRoZSBzdmMgc3RydWN0LiAKKyAqIGluIHRoZSBzdmMgc3Ry
dWN0LgogICovCiAjZGVmaW5lIF9fQ1NGTEFHX3J1bnFfbWlncmF0ZV9yZXF1ZXN0IDMKICNkZWZp
bmUgQ1NGTEFHX3J1bnFfbWlncmF0ZV9yZXF1ZXN0ICgxVTw8X19DU0ZMQUdfcnVucV9taWdyYXRl
X3JlcXVlc3QpCiAvKgotICogQ1NGTEFHX3ZjcHVfeWllbGQ6IHRoaXMgdmNwdSB3YXMgcnVubmlu
ZywgYW5kIGhhcyBjYWxsZWQgdmNwdV95aWVsZCgpLiBUaGUKKyAqIENTRkxBR19pdGVtX3lpZWxk
OiB0aGlzIGl0ZW0gd2FzIHJ1bm5pbmcsIGFuZCBoYXMgY2FsbGVkIHZjcHVfeWllbGQoKS4gVGhl
CiAgKiBzY2hlZHVsZXIgaXMgaW52b2tlZCB0byBzZWUgaWYgd2UgY2FuIGdpdmUgdGhlIGNwdSB0
byBzb21lb25lIGVsc2UsIGFuZAotICogZ2V0IGJhY2sgdG8gdGhlIHlpZWxkaW5nIHZjcHUgaW4g
YSB3aGlsZS4KKyAqIGdldCBiYWNrIHRvIHRoZSB5aWVsZGluZyBpdGVtIGluIGEgd2hpbGUuCiAg
Ki8KLSNkZWZpbmUgX19DU0ZMQUdfdmNwdV95aWVsZCA0Ci0jZGVmaW5lIENTRkxBR192Y3B1X3lp
ZWxkICgxVTw8X19DU0ZMQUdfdmNwdV95aWVsZCkKKyNkZWZpbmUgX19DU0ZMQUdfaXRlbV95aWVs
ZCA0CisjZGVmaW5lIENTRkxBR19pdGVtX3lpZWxkICgxVTw8X19DU0ZMQUdfaXRlbV95aWVsZCkK
IC8qCi0gKiBDU0ZMQUdTX3Bpbm5lZDogdGhpcyB2Y3B1IGlzIGN1cnJlbnRseSAncGlubmVkJywg
aS5lLiwgaGFzIGl0cyBoYXJkCisgKiBDU0ZMQUdTX3Bpbm5lZDogdGhpcyBpdGVtIGlzIGN1cnJl
bnRseSAncGlubmVkJywgaS5lLiwgaGFzIGl0cyBoYXJkCiAgKiBhZmZpbml0eSBzZXQgdG8gb25l
IGFuZCBvbmx5IDEgY3B1IChhbmQsIGhlbmNlLCBjYW4gb25seSBydW4gdGhlcmUpLgogICovCiAj
ZGVmaW5lIF9fQ1NGTEFHX3Bpbm5lZCA1CkBAIC0zMDYsNyArMzA2LDcgQEAgaW50ZWdlcl9wYXJh
bSgic2NoZWRfY3JlZGl0Ml9taWdyYXRlX3Jlc2lzdCIsIG9wdF9taWdyYXRlX3Jlc2lzdCk7CiAv
KgogICogTG9hZCB0cmFja2luZyBhbmQgbG9hZCBiYWxhbmNpbmcKICAqCi0gKiBMb2FkIGhpc3Rv
cnkgb2YgcnVucXVldWVzIGFuZCB2Y3B1cyBpcyBhY2NvdW50ZWQgZm9yIGJ5IHVzaW5nIGFuCisg
KiBMb2FkIGhpc3Rvcnkgb2YgcnVucXVldWVzIGFuZCBpdGVtcyBpcyBhY2NvdW50ZWQgZm9yIGJ5
IHVzaW5nIGFuCiAgKiBleHBvbmVudGlhbCB3ZWlnaHRlZCBtb3ZpbmcgYXZlcmFnZSBhbGdvcml0
aG0uIEhvd2V2ZXIsIGluc3RlYWQgb2YgdXNpbmcKICAqIGZyYWN0aW9ucyx3ZSBzaGlmdCBldmVy
eXRoaW5nIHRvIGxlZnQgYnkgdGhlIG51bWJlciBvZiBiaXRzIHdlIHdhbnQgdG8KICAqIHVzZSBm
b3IgcmVwcmVzZW50aW5nIHRoZSBmcmFjdGlvbmFsIHBhcnQgKFEtZm9ybWF0KS4KQEAgLTMyNiw3
ICszMjYsNyBAQCBpbnRlZ2VyX3BhcmFtKCJzY2hlZF9jcmVkaXQyX21pZ3JhdGVfcmVzaXN0Iiwg
b3B0X21pZ3JhdGVfcmVzaXN0KTsKICAqCiAgKiB3aGVyZSBXIGlzIHRoZSBsZW5ndGggb2YgdGhl
IHdpbmRvdywgUCB0aGUgbXVsdGlwbGllciBmb3IgdHJhbnNpdGlvbmcgaW50bwogICogUS1mb3Jt
YXQgZml4ZWQgcG9pbnQgYXJpdGhtZXRpYyBhbmQgbG9hZCBpcyB0aGUgaW5zdGFudGFuZW91cyBs
b2FkIG9mIGEKLSAqIHJ1bnF1ZXVlLCB3aGljaCBiYXNpY2FsbHkgaXMgdGhlIG51bWJlciBvZiBy
dW5uYWJsZSB2Y3B1cyB0aGVyZSBhcmUgb24gdGhlCisgKiBydW5xdWV1ZSwgd2hpY2ggYmFzaWNh
bGx5IGlzIHRoZSBudW1iZXIgb2YgcnVubmFibGUgaXRlbXMgdGhlcmUgYXJlIG9uIHRoZQogICog
cnVucXVldWUgKGZvciB0aGUgbWVhbmluZyBvZiB0aGUgb3RoZXIgdGVybXMsIGxvb2sgYXQgdGhl
IGRvYyBjb21tZW50IHRvCiAgKiAgdXBkYXRlX3J1bnFfbG9hZCgpKS4KICAqCkBAIC0zMzgsNyAr
MzM4LDcgQEAgaW50ZWdlcl9wYXJhbSgic2NoZWRfY3JlZGl0Ml9taWdyYXRlX3Jlc2lzdCIsIG9w
dF9taWdyYXRlX3Jlc2lzdCk7CiAgKiBUaGUgbWF4aW11bSBwb3NzaWJsZSB2YWx1ZSBmb3IgdGhl
IGF2ZXJhZ2UgbG9hZCwgd2hpY2ggd2Ugd2FudCB0byBzdG9yZSBpbgogICogc190aW1lX3QgdHlw
ZSB2YXJpYWJsZXMgKGkuZS4sIHdlIGhhdmUgNjMgYml0cyBhdmFpbGFibGUpIGlzIGxvYWQqUC4g
VGhpcwogICogbWVhbnMgdGhhdCwgd2l0aCBQIDE4IGJpdHMgd2lkZSwgbG9hZCBjYW4gb2NjdXB5
IDQ1IGJpdHMuIFRoaXMgaW4gdHVybgotICogbWVhbnMgd2UgY2FuIGhhdmUgMl40NSB2Y3B1cyBp
biBlYWNoIHJ1bnF1ZXVlLCBiZWZvcmUgb3ZlcmZsb3cgb2NjdXJzIQorICogbWVhbnMgd2UgY2Fu
IGhhdmUgMl40NSBpdGVtcyBpbiBlYWNoIHJ1bnF1ZXVlLCBiZWZvcmUgb3ZlcmZsb3cgb2NjdXJz
IQogICoKICAqIEhvd2V2ZXIsIGl0IGNhbiBoYXBwZW4gdGhhdCwgYXQgc3RlcCBqKzEsIGlmOgog
ICoKQEAgLTM1NCwxMyArMzU0LDEzIEBAIGludGVnZXJfcGFyYW0oInNjaGVkX2NyZWRpdDJfbWln
cmF0ZV9yZXNpc3QiLCBvcHRfbWlncmF0ZV9yZXNpc3QpOwogICoKICAqICAyXig2MyAtIDMwIC0g
MTgpID0gMl4xNSA9IDMyNzY4CiAgKgotICogU28gMzI3NjggaXMgdGhlIG1heGltdW0gbnVtYmVy
IG9mIHZjcHVzIHRoZSB3ZSBjYW4gaGF2ZSBpbiBhIHJ1bnF1ZXVlLAorICogU28gMzI3NjggaXMg
dGhlIG1heGltdW0gbnVtYmVyIG9mIGl0ZW1zIHRoZSB3ZSBjYW4gaGF2ZSBpbiBhIHJ1bnF1ZXVl
LAogICogYXQgYW55IGdpdmVuIHRpbWUsIGFuZCBzdGlsbCBub3QgaGF2ZSBwcm9ibGVtcyB3aXRo
IHRoZSBsb2FkIHRyYWNraW5nCiAgKiBjYWxjdWxhdGlvbnMuLi4gYW5kIHRoaXMgaXMgbW9yZSB0
aGFuIGZpbmUuCiAgKgogICogQXMgYSBtYXR0ZXIgb2YgZmFjdCwgc2luY2Ugd2UgYXJlIHVzaW5n
IG1pY3Jvc2Vjb25kcyBncmFudWxhcml0eSwgd2UgaGF2ZQogICogVz0yXjIwLiBTbywgc3RpbGwg
d2l0aCAxOCBmcmFjdGlvbmFsIGJpdHMgYW5kIGEgMSBzZWNvbmQgbG9uZyB3aW5kb3csIHRoZXJl
Ci0gKiBtYXkgYmUgMl4yNSA9IDMzNTU0NDMyIHZjcHVzIGluIGEgcnVucSBiZWZvcmUgd2UgaGF2
ZSB0byBzdGFydCB0aGlua2luZworICogbWF5IGJlIDJeMjUgPSAzMzU1NDQzMiBpdGVtcyBpbiBh
IHJ1bnEgYmVmb3JlIHdlIGhhdmUgdG8gc3RhcnQgdGhpbmtpbmcKICAqIGFib3V0IG92ZXJmbG93
LgogICovCiAKQEAgLTQ2OCw3ICs0NjgsNyBAQCBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRh
IHsKICAgICBzdHJ1Y3QgbGlzdF9oZWFkIHJ1bnE7ICAgICAvKiBPcmRlcmVkIGxpc3Qgb2YgcnVu
bmFibGUgdm1zICAgICAgICAgICAgICAgKi8KICAgICBpbnQgaWQ7ICAgICAgICAgICAgICAgICAg
ICAvKiBJRCBvZiB0aGlzIHJ1bnF1ZXVlICgtMSBpZiBpbnZhbGlkKSAgICAgICAgKi8KIAotICAg
IGludCBsb2FkOyAgICAgICAgICAgICAgICAgIC8qIEluc3RhbnRhbmVvdXMgbG9hZCAobnVtIG9m
IG5vbi1pZGxlIHZjcHVzKSAqLworICAgIGludCBsb2FkOyAgICAgICAgICAgICAgICAgIC8qIElu
c3RhbnRhbmVvdXMgbG9hZCAobnVtIG9mIG5vbi1pZGxlIGl0ZW1zKSAqLwogICAgIHNfdGltZV90
IGxvYWRfbGFzdF91cGRhdGU7IC8qIExhc3QgdGltZSBhdmVyYWdlIHdhcyB1cGRhdGVkICAgICAg
ICAgICAgICAqLwogICAgIHNfdGltZV90IGF2Z2xvYWQ7ICAgICAgICAgIC8qIERlY2F5aW5nIHF1
ZXVlIGxvYWQgICAgICAgICAgICAgICAgICAgICAgICAqLwogICAgIHNfdGltZV90IGJfYXZnbG9h
ZDsgICAgICAgIC8qIERlY2F5aW5nIHF1ZXVlIGxvYWQgbW9kaWZpZWQgYnkgYmFsYW5jaW5nICAq
LwpAQCAtNDc4LDggKzQ3OCw4IEBAIHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgewogICAg
ICAgICB0aWNrbGVkLCAgICAgICAgICAgICAgIC8qIEhhdmUgYmVlbiBhc2tlZCB0byBnbyB0aHJv
dWdoIHNjaGVkdWxlICAgICAqLwogICAgICAgICBpZGxlOyAgICAgICAgICAgICAgICAgIC8qIEN1
cnJlbnRseSBpZGxlIHBjcHVzICAgICAgICAgICAgICAgICAgICAgICAqLwogCi0gICAgc3RydWN0
IGxpc3RfaGVhZCBzdmM7ICAgICAgLyogTGlzdCBvZiBhbGwgdmNwdXMgYXNzaWduZWQgdG8gdGhl
IHJ1bnF1ZXVlICovCi0gICAgdW5zaWduZWQgaW50IG1heF93ZWlnaHQ7ICAgLyogTWF4IHdlaWdo
dCBvZiB0aGUgdmNwdXMgaW4gdGhpcyBydW5xdWV1ZSAgICovCisgICAgc3RydWN0IGxpc3RfaGVh
ZCBzdmM7ICAgICAgLyogTGlzdCBvZiBhbGwgaXRlbXMgYXNzaWduZWQgdG8gdGhlIHJ1bnF1ZXVl
ICovCisgICAgdW5zaWduZWQgaW50IG1heF93ZWlnaHQ7ICAgLyogTWF4IHdlaWdodCBvZiB0aGUg
aXRlbXMgaW4gdGhpcyBydW5xdWV1ZSAgICovCiAgICAgdW5zaWduZWQgaW50IHBpY2tfYmlhczsg
ICAgLyogTGFzdCBwaWNrZWQgcGNwdS4gU3RhcnQgZnJvbSBpdCBuZXh0IHRpbWUgICovCiB9Owog
CkBAIC01MDksMjAgKzUwOSwyMCBAQCBzdHJ1Y3QgY3NjaGVkMl9wY3B1IHsKIH07CiAKIC8qCi0g
KiBWaXJ0dWFsIENQVQorICogU2NoZWR1bGUgSXRlbQogICovCiBzdHJ1Y3QgY3NjaGVkMl9pdGVt
IHsKICAgICBzdHJ1Y3QgY3NjaGVkMl9kb20gKnNkb207ICAgICAgICAgIC8qIFVwLXBvaW50ZXIg
dG8gZG9tYWluICAgICAgICAgICAgICAgICovCi0gICAgc3RydWN0IHZjcHUgKnZjcHU7ICAgICAg
ICAgICAgICAgICAvKiBVcC1wb2ludGVyLCB0byB2Y3B1ICAgICAgICAgICAgICAgICAqLworICAg
IHN0cnVjdCBzY2hlZF9pdGVtICppdGVtOyAgICAgICAgICAgLyogVXAtcG9pbnRlciwgdG8gc2No
ZWR1bGUgaXRlbSAgICAgICAgKi8KICAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpy
cWQ7IC8qIFVwLXBvaW50ZXIgdG8gdGhlIHJ1bnF1ZXVlICAgICAgICAgICovCiAKICAgICBpbnQg
Y3JlZGl0OyAgICAgICAgICAgICAgICAgICAgICAgIC8qIEN1cnJlbnQgYW1vdW50IG9mIGNyZWRp
dCAgICAgICAgICAgICovCi0gICAgdW5zaWduZWQgaW50IHdlaWdodDsgICAgICAgICAgICAgICAv
KiBXZWlnaHQgb2YgdGhpcyB2Y3B1ICAgICAgICAgICAgICAgICAqLworICAgIHVuc2lnbmVkIGlu
dCB3ZWlnaHQ7ICAgICAgICAgICAgICAgLyogV2VpZ2h0IG9mIHRoaXMgaXRlbSAgICAgICAgICAg
ICAgICAgKi8KICAgICB1bnNpZ25lZCBpbnQgcmVzaWR1YWw7ICAgICAgICAgICAgIC8qIFJlbWlu
ZGVyIG9mIGRpdihtYXhfd2VpZ2h0L3dlaWdodCkgICovCiAgICAgdW5zaWduZWQgZmxhZ3M7ICAg
ICAgICAgICAgICAgICAgICAvKiBTdGF0dXMgZmxhZ3MgKDE2IGJpdHMgd291bGQgYmUgb2ssICAq
LwogICAgIHNfdGltZV90IGJ1ZGdldDsgICAgICAgICAgICAgICAgICAgLyogQ3VycmVudCBidWRn
ZXQgKGlmIGRvbWFpbnMgaGFzIGNhcCkgKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIC8qIGJ1dCBjbGVhcl9iaXQoKSBkb2VzIG5vdCBsaWtlIHRoYXQpICovCi0gICAg
c190aW1lX3QgYnVkZ2V0X3F1b3RhOyAgICAgICAgICAgICAvKiBCdWRnZXQgdG8gd2hpY2ggdkNQ
VSBpcyBlbnRpdGxlZCAgICAqLworICAgIHNfdGltZV90IGJ1ZGdldF9xdW90YTsgICAgICAgICAg
ICAgLyogQnVkZ2V0IHRvIHdoaWNoIGl0ZW0gaXMgZW50aXRsZWQgICAgKi8KIAogICAgIHNfdGlt
ZV90IHN0YXJ0X3RpbWU7ICAgICAgICAgICAgICAgLyogVGltZSB3ZSB3ZXJlIHNjaGVkdWxlZCAo
Zm9yIGNyZWRpdCkgKi8KIApAQCAtNTMxLDcgKzUzMSw3IEBAIHN0cnVjdCBjc2NoZWQyX2l0ZW0g
ewogICAgIHNfdGltZV90IGF2Z2xvYWQ7ICAgICAgICAgICAgICAgICAgLyogRGVjYXlpbmcgcXVl
dWUgbG9hZCAgICAgICAgICAgICAgICAgKi8KIAogICAgIHN0cnVjdCBsaXN0X2hlYWQgcnVucV9l
bGVtOyAgICAgICAgLyogT24gdGhlIHJ1bnF1ZXVlIChycWQtPnJ1bnEpICAgICAgICAgKi8KLSAg
ICBzdHJ1Y3QgbGlzdF9oZWFkIHBhcmtlZF9lbGVtOyAgICAgIC8qIE9uIHRoZSBwYXJrZWRfdmNw
dXMgbGlzdCAgICAgICAgICAgICovCisgICAgc3RydWN0IGxpc3RfaGVhZCBwYXJrZWRfZWxlbTsg
ICAgICAvKiBPbiB0aGUgcGFya2VkX2l0ZW1zIGxpc3QgICAgICAgICAgICAqLwogICAgIHN0cnVj
dCBsaXN0X2hlYWQgcnFkX2VsZW07ICAgICAgICAgLyogT24gY3NjaGVkMl9ydW5xdWV1ZV9kYXRh
J3Mgc3ZjIGxpc3QgKi8KICAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICptaWdyYXRl
X3JxZDsgLyogUHJlLWRldGVybWluZWQgbWlnci4gdGFyZ2V0ICovCiAgICAgaW50IHRpY2tsZWRf
Y3B1OyAgICAgICAgICAgICAgICAgICAvKiBDcHUgdGhhdCB3aWxsIHBpY2sgdXMgKC0xIGlmIG5v
bmUpICAqLwpAQCAtNTQ5LDEyICs1NDksMTIgQEAgc3RydWN0IGNzY2hlZDJfZG9tIHsKIAogICAg
IHN0cnVjdCB0aW1lciByZXBsX3RpbWVyOyAgICAvKiBUaW1lciBmb3IgcGVyaW9kaWMgcmVwbGVu
aXNobWVudCBvZiBidWRnZXQgKi8KICAgICBzX3RpbWVfdCBuZXh0X3JlcGw7ICAgICAgICAgLyog
VGltZSBhdCB3aGljaCBuZXh0IHJlcGxlbmlzaG1lbnQgb2NjdXJzICAgICovCi0gICAgc3RydWN0
IGxpc3RfaGVhZCBwYXJrZWRfdmNwdXM7IC8qIExpc3Qgb2YgQ1BVcyB3YWl0aW5nIGZvciBidWRn
ZXQgICAgICAgICAqLworICAgIHN0cnVjdCBsaXN0X2hlYWQgcGFya2VkX2l0ZW1zOyAvKiBMaXN0
IG9mIENQVXMgd2FpdGluZyBmb3IgYnVkZ2V0ICAgICAgICAgKi8KIAogICAgIHN0cnVjdCBsaXN0
X2hlYWQgc2RvbV9lbGVtOyAvKiBPbiBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEncyBzZG9tIGxpc3Qg
ICAgICAgKi8KICAgICB1aW50MTZfdCB3ZWlnaHQ7ICAgICAgICAgICAgLyogVXNlciBzcGVjaWZp
ZWQgd2VpZ2h0ICAgICAgICAgICAgICAgICAgICAgICovCiAgICAgdWludDE2X3QgY2FwOyAgICAg
ICAgICAgICAgIC8qIFVzZXIgc3BlY2lmaWVkIGNhcCAgICAgICAgICAgICAgICAgICAgICAgICAq
LwotICAgIHVpbnQxNl90IG5yX3ZjcHVzOyAgICAgICAgICAvKiBOdW1iZXIgb2YgdmNwdXMgb2Yg
dGhpcyBkb21haW4gICAgICAgICAgICAgKi8KKyAgICB1aW50MTZfdCBucl9pdGVtczsgICAgICAg
ICAgLyogTnVtYmVyIG9mIGl0ZW1zIG9mIHRoaXMgZG9tYWluICAgICAgICAgICAgICovCiB9Owog
CiAvKgpAQCAtNTkzLDcgKzU5Myw3IEBAIHN0YXRpYyBpbmxpbmUgc3RydWN0IGNzY2hlZDJfcnVu
cXVldWVfZGF0YSAqYzJycWQoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAgIHJldHVy
biAmY3NjaGVkMl9wcml2KG9wcyktPnJxZFtjMnIoY3B1KV07CiB9CiAKLS8qIERvZXMgdGhlIGRv
bWFpbiBvZiB0aGlzIHZDUFUgaGF2ZSBhIGNhcD8gKi8KKy8qIERvZXMgdGhlIGRvbWFpbiBvZiB0
aGlzIGl0ZW0gaGF2ZSBhIGNhcD8gKi8KIHN0YXRpYyBpbmxpbmUgYm9vbCBoYXNfY2FwKGNvbnN0
IHN0cnVjdCBjc2NoZWQyX2l0ZW0gKnN2YykKIHsKICAgICByZXR1cm4gc3ZjLT5idWRnZXQgIT0g
U1RJTUVfTUFYOwpAQCAtNjExLDI0ICs2MTEsMjQgQEAgc3RhdGljIGlubGluZSBib29sIGhhc19j
YXAoY29uc3Qgc3RydWN0IGNzY2hlZDJfaXRlbSAqc3ZjKQogICogICAgc210X2lkbGUgbWFzay4K
ICAqCiAgKiBPbmNlIHdlIGhhdmUgc3VjaCBhIG1hc2ssIGl0IGlzIGVhc3kgdG8gaW1wbGVtZW50
IGEgcG9saWN5IHRoYXQsIGVpdGhlcjoKLSAqICAtIHVzZXMgZnVsbHkgaWRsZSBjb3JlcyBmaXJz
dDogaXQgaXMgZW5vdWdoIHRvIHRyeSB0byBzY2hlZHVsZSB0aGUgdmNwdXMKKyAqICAtIHVzZXMg
ZnVsbHkgaWRsZSBjb3JlcyBmaXJzdDogaXQgaXMgZW5vdWdoIHRvIHRyeSB0byBzY2hlZHVsZSB0
aGUgaXRlbXMKICAqICAgIG9uIHBjcHVzIGZyb20gc210X2lkbGUgbWFzayBmaXJzdC4gVGhpcyBp
cyB3aGF0IGhhcHBlbnMgaWYKICAqICAgIHNjaGVkX3NtdF9wb3dlcl9zYXZpbmdzIHdhcyBub3Qg
c2V0IGF0IGJvb3QgKGRlZmF1bHQpLCBhbmQgaXQgbWF4aW1pemVzCiAgKiAgICB0cnVlIHBhcmFs
bGVsaXNtLCBhbmQgaGVuY2UgcGVyZm9ybWFuY2U7Ci0gKiAgLSB1c2VzIGFscmVhZHkgYnVzeSBj
b3JlcyBmaXJzdDogaXQgaXMgZW5vdWdoIHRvIHRyeSB0byBzY2hlZHVsZSB0aGUgdmNwdXMKKyAq
ICAtIHVzZXMgYWxyZWFkeSBidXN5IGNvcmVzIGZpcnN0OiBpdCBpcyBlbm91Z2ggdG8gdHJ5IHRv
IHNjaGVkdWxlIHRoZSBpdGVtcwogICogICAgb24gcGNwdXMgdGhhdCBhcmUgaWRsZSwgYnV0IGFy
ZSBub3QgaW4gc210X2lkbGUuIFRoaXMgaXMgd2hhdCBoYXBwZW5zIGlmCiAgKiAgICBzY2hlZF9z
bXRfcG93ZXJfc2F2aW5ncyBpcyBzZXQgYXQgYm9vdCwgYW5kIGl0IGFsbG93cyBhcyBtb3JlIGNv
cmVzIGFzCiAgKiAgICBwb3NzaWJsZSB0byBzdGF5IGluIGxvdyBwb3dlciBzdGF0ZXMsIG1pbmlt
aXppbmcgcG93ZXIgY29uc3VtcHRpb24uCiAgKgogICogVGhpcyBsb2dpYyBpcyBlbnRpcmVseSBp
bXBsZW1lbnRlZCBpbiBydW5xX3RpY2tsZSgpLCBhbmQgdGhhdCBpcyBlbm91Z2guCi0gKiBJbiBm
YWN0LCBpbiB0aGlzIHNjaGVkdWxlciwgcGxhY2VtZW50IG9mIGEgdmNwdSBvbiBvbmUgb2YgdGhl
IHBjcHVzIG9mIGEKKyAqIEluIGZhY3QsIGluIHRoaXMgc2NoZWR1bGVyLCBwbGFjZW1lbnQgb2Yg
YW4gaXRlbSBvbiBvbmUgb2YgdGhlIHBjcHVzIG9mIGEKICAqIHJ1bnEsIF9hbHdheXNfIGhhcHBl
bnMgYnkgbWVhbnMgb2YgdGlja2xpbmc6Ci0gKiAgLSB3aGVuIGEgdmNwdSB3YWtlcyB1cCwgaXQg
Y2FsbHMgY3NjaGVkMl9pdGVtX3dha2UoKSwgd2hpY2ggY2FsbHMKKyAqICAtIHdoZW4gYW4gaXRl
bSB3YWtlcyB1cCwgaXQgY2FsbHMgY3NjaGVkMl9pdGVtX3dha2UoKSwgd2hpY2ggY2FsbHMKICAq
ICAgIHJ1bnFfdGlja2xlKCk7CiAgKiAgLSB3aGVuIGEgbWlncmF0aW9uIGlzIGluaXRpYXRlZCBp
biBzY2hlZHVsZS5jLCB3ZSBjYWxsIGNzY2hlZDJfcmVzX3BpY2soKSwKICAqICAgIGNzY2hlZDJf
aXRlbV9taWdyYXRlKCkgKHdoaWNoIGNhbGxzIG1pZ3JhdGUoKSkgYW5kIGNzY2hlZDJfaXRlbV93
YWtlKCkuCiAgKiAgICBjc2NoZWQyX3Jlc19waWNrKCkgbG9va3MgZm9yIHRoZSBsZWFzdCBsb2Fk
ZWQgcnVucSBhbmQgcmV0dXJuIGp1c3QgYW55Ci0gKiAgICBvZiBpdHMgcHJvY2Vzc29ycy4gVGhl
biwgY3NjaGVkMl9pdGVtX21pZ3JhdGUoKSBqdXN0IG1vdmVzIHRoZSB2Y3B1IHRvCisgKiAgICBv
ZiBpdHMgcHJvY2Vzc29ycy4gVGhlbiwgY3NjaGVkMl9pdGVtX21pZ3JhdGUoKSBqdXN0IG1vdmVz
IHRoZSBpdGVtIHRvCiAgKiAgICB0aGUgY2hvc2VuIHJ1bnEsIGFuZCBpdCBpcyBhZ2FpbiBydW5x
X3RpY2tsZSgpLCBjYWxsZWQgYnkKICAqICAgIGNzY2hlZDJfaXRlbV93YWtlKCkgdGhhdCBhY3R1
YWxseSBkZWNpZGVzIHdoYXQgcGNwdSB0byB1c2Ugd2l0aGluIHRoZQogICogICAgY2hvc2VuIHJ1
bnE7CkBAIC02NDMsNyArNjQzLDcgQEAgc3RhdGljIGlubGluZSBib29sIGhhc19jYXAoY29uc3Qg
c3RydWN0IGNzY2hlZDJfaXRlbSAqc3ZjKQogICoKICAqIE5CIHRoYXQgcnFkLT5zbXRfaWRsZSBp
cyBkaWZmZXJlbnQgdGhhbiBycWQtPmlkbGUuICBycWQtPmlkbGUKICAqIHJlY29yZHMgcGNwdXMg
dGhhdCBhdCBhcmUgbWVyZWx5IGlkbGUgKGkuZS4sIGF0IHRoZSBtb21lbnQgZG8gbm90Ci0gKiBo
YXZlIGEgdmNwdSBydW5uaW5nIG9uIHRoZW0pLiAgQnV0IHlvdSBoYXZlIHRvIG1hbnVhbGx5IGZp
bHRlciBvdXQKKyAqIGhhdmUgYW4gaXRlbSBydW5uaW5nIG9uIHRoZW0pLiAgQnV0IHlvdSBoYXZl
IHRvIG1hbnVhbGx5IGZpbHRlciBvdXQKICAqIHdoaWNoIHBjcHVzIGhhdmUgYmVlbiB0aWNrbGVk
IGluIG9yZGVyIHRvIGZpbmQgY29yZXMgdGhhdCBhcmUgbm90CiAgKiBnb2luZyB0byBiZSBidXN5
IHNvb24uICBGaWx0ZXJpbmcgb3V0IHRpY2tsZWQgY3B1cyBwYWlyd2lzZSBpcyBhCiAgKiBsb3Qg
b2YgZXh0cmEgcGFpbjsgc28gZm9yIHJxZC0+c210X2lkbGUsIHdlIGV4cGxpY2l0bHkgbWFrZSBz
byB0aGF0CkBAIC02OTAsMjQgKzY5MCwyNCBAQCB2b2lkIHNtdF9pZGxlX21hc2tfY2xlYXIodW5z
aWduZWQgaW50IGNwdSwgY3B1bWFza190ICptYXNrKQogICovCiBzdGF0aWMgaW50IGdldF9mYWxs
YmFja19jcHUoc3RydWN0IGNzY2hlZDJfaXRlbSAqc3ZjKQogewotICAgIHN0cnVjdCB2Y3B1ICp2
ID0gc3ZjLT52Y3B1OworICAgIHN0cnVjdCBzY2hlZF9pdGVtICppdGVtID0gc3ZjLT5pdGVtOwog
ICAgIHVuc2lnbmVkIGludCBiczsKIAogICAgIFNDSEVEX1NUQVRfQ1JBTksobmVlZF9mYWxsYmFj
a19jcHUpOwogCiAgICAgZm9yX2VhY2hfYWZmaW5pdHlfYmFsYW5jZV9zdGVwKCBicyApCiAgICAg
ewotICAgICAgICBpbnQgY3B1ID0gdi0+cHJvY2Vzc29yOworICAgICAgICBpbnQgY3B1ID0gc2No
ZWRfaXRlbV9jcHUoaXRlbSk7CiAKLSAgICAgICAgaWYgKCBicyA9PSBCQUxBTkNFX1NPRlRfQUZG
SU5JVFkgJiYgIWhhc19zb2Z0X2FmZmluaXR5KHYtPnNjaGVkX2l0ZW0pICkKKyAgICAgICAgaWYg
KCBicyA9PSBCQUxBTkNFX1NPRlRfQUZGSU5JVFkgJiYgIWhhc19zb2Z0X2FmZmluaXR5KGl0ZW0p
ICkKICAgICAgICAgICAgIGNvbnRpbnVlOwogCi0gICAgICAgIGFmZmluaXR5X2JhbGFuY2VfY3B1
bWFzayh2LT5zY2hlZF9pdGVtLCBicywgY3B1bWFza19zY3JhdGNoX2NwdShjcHUpKTsKKyAgICAg
ICAgYWZmaW5pdHlfYmFsYW5jZV9jcHVtYXNrKGl0ZW0sIGJzLCBjcHVtYXNrX3NjcmF0Y2hfY3B1
KGNwdSkpOwogICAgICAgICBjcHVtYXNrX2FuZChjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSksIGNw
dW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwKLSAgICAgICAgICAgICAgICAgICAgY3B1cG9vbF9kb21h
aW5fY3B1bWFzayh2LT5kb21haW4pKTsKKyAgICAgICAgICAgICAgICAgICAgY3B1cG9vbF9kb21h
aW5fY3B1bWFzayhpdGVtLT5kb21haW4pKTsKIAogICAgICAgICAvKgotICAgICAgICAgKiBUaGlz
IGlzIGNhc2VzIDEgb3IgMyAoZGVwZW5kaW5nIG9uIGJzKTogaWYgdi0+cHJvY2Vzc29yIGlzIChz
dGlsbCkKKyAgICAgICAgICogVGhpcyBpcyBjYXNlcyAxIG9yIDMgKGRlcGVuZGluZyBvbiBicyk6
IGlmIHByb2Nlc3NvciBpcyAoc3RpbGwpCiAgICAgICAgICAqIGluIG91ciBhZmZpbml0eSwgZ28g
Zm9yIGl0LCBmb3IgY2FjaGUgYmV0dGVybmVzcy4KICAgICAgICAgICovCiAgICAgICAgIGlmICgg
bGlrZWx5KGNwdW1hc2tfdGVzdF9jcHUoY3B1LCBjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSkpKSAp
CkBAIC03MjksNyArNzI5LDcgQEAgc3RhdGljIGludCBnZXRfZmFsbGJhY2tfY3B1KHN0cnVjdCBj
c2NoZWQyX2l0ZW0gKnN2YykKICAgICAgICAgICogV2UgbWF5IHdlbGwgcGljayBhbnkgdmFsaWQg
cGNwdSBmcm9tIG91ciBzb2Z0LWFmZmluaXR5LCBvdXRzaWRlCiAgICAgICAgICAqIG9mIG91ciBj
dXJyZW50IHJ1bnF1ZXVlLCBidXQgd2UgZGVjaWRlIG5vdCB0by4gSW4gZmFjdCwgY2hhbmdpbmcK
ICAgICAgICAgICogcnVucXVldWUgaXMgc2xvdywgYWZmZWN0cyBsb2FkIGRpc3RyaWJ1dGlvbiwg
YW5kIGlzIGEgc291cmNlIG9mCi0gICAgICAgICAqIG92ZXJoZWFkIGZvciB0aGUgdmNwdXMgcnVu
bmluZyBvbiB0aGUgb3RoZXIgcnVucXVldWUgKHdlIG5lZWQgdGhlCisgICAgICAgICAqIG92ZXJo
ZWFkIGZvciB0aGUgaXRlbXMgcnVubmluZyBvbiB0aGUgb3RoZXIgcnVucXVldWUgKHdlIG5lZWQg
dGhlCiAgICAgICAgICAqIGxvY2spLiBTbywgYmV0dGVyIGRvIHRoYXQgYXMgYSBjb25zZXF1ZW5j
ZSBvZiBhIHdlbGwgaW5mb3JtZWQKICAgICAgICAgICogZGVjaXNpb24gKG9yIGlmIHdlIHJlYWxs
eSBkb24ndCBoYXZlIGFueSBvdGhlciBjaGFuY2UsIGFzIHdlIHdpbGwsCiAgICAgICAgICAqIGF0
IHN0ZXAgNSwgaWYgd2UgZ2V0IHRvIHRoZXJlKS4KQEAgLTc2MSw3ICs3NjEsNyBAQCBzdGF0aWMg
aW50IGdldF9mYWxsYmFja19jcHUoc3RydWN0IGNzY2hlZDJfaXRlbSAqc3ZjKQogICAgICAqIFdl
IGNhbid0IGJlIGhlcmUuICBCdXQgaWYgdGhhdCBzb21laG93IGhhcHBlbiAoaW4gbm9uLWRlYnVn
IGJ1aWxkcyksCiAgICAgICogYXQgbGVhc3QgcmV0dXJuIHNvbWV0aGluZyB3aGljaCBib3RoIG9u
bGluZSBhbmQgaW4gb3VyIGhhcmQtYWZmaW5pdHkuCiAgICAgICovCi0gICAgcmV0dXJuIGNwdW1h
c2tfYW55KGNwdW1hc2tfc2NyYXRjaF9jcHUodi0+cHJvY2Vzc29yKSk7CisgICAgcmV0dXJuIGNw
dW1hc2tfYW55KGNwdW1hc2tfc2NyYXRjaF9jcHUoc2NoZWRfaXRlbV9jcHUoaXRlbSkpKTsKIH0K
IAogLyoKQEAgLTc5MCw3ICs3OTAsNyBAQCBzdGF0aWMgc190aW1lX3QgYzJ0KHN0cnVjdCBjc2No
ZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCwgc190aW1lX3QgY3JlZGl0LCBzdHJ1Y3QgYwogICogUnVu
cXVldWUgcmVsYXRlZCBjb2RlLgogICovCiAKLXN0YXRpYyBpbmxpbmUgaW50IHZjcHVfb25fcnVu
cShzdHJ1Y3QgY3NjaGVkMl9pdGVtICpzdmMpCitzdGF0aWMgaW5saW5lIGludCBpdGVtX29uX3J1
bnEoc3RydWN0IGNzY2hlZDJfaXRlbSAqc3ZjKQogewogICAgIHJldHVybiAhbGlzdF9lbXB0eSgm
c3ZjLT5ydW5xX2VsZW0pOwogfQpAQCAtOTQ4LDE3ICs5NDgsMTcgQEAgX3J1bnFfYXNzaWduKHN0
cnVjdCBjc2NoZWQyX2l0ZW0gKnN2Yywgc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFk
KQogCiAgICAgdXBkYXRlX21heF93ZWlnaHQoc3ZjLT5ycWQsIHN2Yy0+d2VpZ2h0LCAwKTsKIAot
ICAgIC8qIEV4cGVjdGVkIG5ldyBsb2FkIGJhc2VkIG9uIGFkZGluZyB0aGlzIHZjcHUgKi8KKyAg
ICAvKiBFeHBlY3RlZCBuZXcgbG9hZCBiYXNlZCBvbiBhZGRpbmcgdGhpcyBpdGVtICovCiAgICAg
cnFkLT5iX2F2Z2xvYWQgKz0gc3ZjLT5hdmdsb2FkOwogCiAgICAgaWYgKCB1bmxpa2VseSh0Yl9p
bml0X2RvbmUpICkKICAgICB7CiAgICAgICAgIHN0cnVjdCB7Ci0gICAgICAgICAgICB1bnNpZ25l
ZCB2Y3B1OjE2LCBkb206MTY7CisgICAgICAgICAgICB1bnNpZ25lZCBpdGVtOjE2LCBkb206MTY7
CiAgICAgICAgICAgICB1bnNpZ25lZCBycWk6MTY7CiAgICAgICAgIH0gZDsKLSAgICAgICAgZC5k
b20gPSBzdmMtPnZjcHUtPmRvbWFpbi0+ZG9tYWluX2lkOwotICAgICAgICBkLnZjcHUgPSBzdmMt
PnZjcHUtPnZjcHVfaWQ7CisgICAgICAgIGQuZG9tID0gc3ZjLT5pdGVtLT5kb21haW4tPmRvbWFp
bl9pZDsKKyAgICAgICAgZC5pdGVtID0gc3ZjLT5pdGVtLT5pdGVtX2lkOwogICAgICAgICBkLnJx
aT1ycWQtPmlkOwogICAgICAgICBfX3RyYWNlX3ZhcihUUkNfQ1NDSEVEMl9SVU5RX0FTU0lHTiwg
MSwKICAgICAgICAgICAgICAgICAgICAgc2l6ZW9mKGQpLApAQCAtOTY4LDEzICs5NjgsMTMgQEAg
X3J1bnFfYXNzaWduKHN0cnVjdCBjc2NoZWQyX2l0ZW0gKnN2Yywgc3RydWN0IGNzY2hlZDJfcnVu
cXVldWVfZGF0YSAqcnFkKQogfQogCiBzdGF0aWMgdm9pZAotcnVucV9hc3NpZ24oY29uc3Qgc3Ry
dWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgdmNwdSAqdmMpCitydW5xX2Fzc2lnbihjb25zdCBz
dHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF9pdGVtICppdGVtKQogewotICAgIHN0
cnVjdCBjc2NoZWQyX2l0ZW0gKnN2YyA9IHZjLT5zY2hlZF9pdGVtLT5wcml2OworICAgIHN0cnVj
dCBjc2NoZWQyX2l0ZW0gKnN2YyA9IGl0ZW0tPnByaXY7CiAKICAgICBBU1NFUlQoc3ZjLT5ycWQg
PT0gTlVMTCk7CiAKLSAgICBfcnVucV9hc3NpZ24oc3ZjLCBjMnJxZChvcHMsIHZjLT5wcm9jZXNz
b3IpKTsKKyAgICBfcnVucV9hc3NpZ24oc3ZjLCBjMnJxZChvcHMsIHNjaGVkX2l0ZW1fY3B1KGl0
ZW0pKSk7CiB9CiAKIHN0YXRpYyB2b2lkCkBAIC05ODIsMjQgKzk4MiwyNCBAQCBfcnVucV9kZWFz
c2lnbihzdHJ1Y3QgY3NjaGVkMl9pdGVtICpzdmMpCiB7CiAgICAgc3RydWN0IGNzY2hlZDJfcnVu
cXVldWVfZGF0YSAqcnFkID0gc3ZjLT5ycWQ7CiAKLSAgICBBU1NFUlQoIXZjcHVfb25fcnVucShz
dmMpKTsKKyAgICBBU1NFUlQoIWl0ZW1fb25fcnVucShzdmMpKTsKICAgICBBU1NFUlQoIShzdmMt
PmZsYWdzICYgQ1NGTEFHX3NjaGVkdWxlZCkpOwogCiAgICAgbGlzdF9kZWxfaW5pdCgmc3ZjLT5y
cWRfZWxlbSk7CiAgICAgdXBkYXRlX21heF93ZWlnaHQocnFkLCAwLCBzdmMtPndlaWdodCk7CiAK
LSAgICAvKiBFeHBlY3RlZCBuZXcgbG9hZCBiYXNlZCBvbiByZW1vdmluZyB0aGlzIHZjcHUgKi8K
KyAgICAvKiBFeHBlY3RlZCBuZXcgbG9hZCBiYXNlZCBvbiByZW1vdmluZyB0aGlzIGl0ZW0gKi8K
ICAgICBycWQtPmJfYXZnbG9hZCA9IG1heF90KHNfdGltZV90LCBycWQtPmJfYXZnbG9hZCAtIHN2
Yy0+YXZnbG9hZCwgMCk7CiAKICAgICBzdmMtPnJxZCA9IE5VTEw7CiB9CiAKIHN0YXRpYyB2b2lk
Ci1ydW5xX2RlYXNzaWduKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHZjcHUg
KnZjKQorcnVucV9kZWFzc2lnbihjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBz
Y2hlZF9pdGVtICppdGVtKQogewotICAgIHN0cnVjdCBjc2NoZWQyX2l0ZW0gKnN2YyA9IHZjLT5z
Y2hlZF9pdGVtLT5wcml2OworICAgIHN0cnVjdCBjc2NoZWQyX2l0ZW0gKnN2YyA9IGl0ZW0tPnBy
aXY7CiAKLSAgICBBU1NFUlQoc3ZjLT5ycWQgPT0gYzJycWQob3BzLCB2Yy0+cHJvY2Vzc29yKSk7
CisgICAgQVNTRVJUKHN2Yy0+cnFkID09IGMycnFkKG9wcywgc2NoZWRfaXRlbV9jcHUoaXRlbSkp
KTsKIAogICAgIF9ydW5xX2RlYXNzaWduKHN2Yyk7CiB9CkBAIC0xMjAyLDE1ICsxMjAyLDE1IEBA
IHVwZGF0ZV9zdmNfbG9hZChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAgICAgICAgICAg
ICAgICAgc3RydWN0IGNzY2hlZDJfaXRlbSAqc3ZjLCBpbnQgY2hhbmdlLCBzX3RpbWVfdCBub3cp
CiB7CiAgICAgc3RydWN0IGNzY2hlZDJfcHJpdmF0ZSAqcHJ2ID0gY3NjaGVkMl9wcml2KG9wcyk7
Ci0gICAgc190aW1lX3QgZGVsdGEsIHZjcHVfbG9hZDsKKyAgICBzX3RpbWVfdCBkZWx0YSwgaXRl
bV9sb2FkOwogICAgIHVuc2lnbmVkIGludCBQLCBXOwogCiAgICAgaWYgKCBjaGFuZ2UgPT0gLTEg
KQotICAgICAgICB2Y3B1X2xvYWQgPSAxOworICAgICAgICBpdGVtX2xvYWQgPSAxOwogICAgIGVs
c2UgaWYgKCBjaGFuZ2UgPT0gMSApCi0gICAgICAgIHZjcHVfbG9hZCA9IDA7CisgICAgICAgIGl0
ZW1fbG9hZCA9IDA7CiAgICAgZWxzZQotICAgICAgICB2Y3B1X2xvYWQgPSB2Y3B1X3J1bm5hYmxl
KHN2Yy0+dmNwdSk7CisgICAgICAgIGl0ZW1fbG9hZCA9IGl0ZW1fcnVubmFibGUoc3ZjLT5pdGVt
KTsKIAogICAgIFcgPSBwcnYtPmxvYWRfd2luZG93X3NoaWZ0OwogICAgIFAgPSBwcnYtPmxvYWRf
cHJlY2lzaW9uX3NoaWZ0OwpAQCAtMTIxOCw3ICsxMjE4LDcgQEAgdXBkYXRlX3N2Y19sb2FkKGNv
bnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKIAogICAgIGlmICggc3ZjLT5sb2FkX2xhc3RfdXBk
YXRlICsgKDFVTEwgPDwgVykgPCBub3cgKQogICAgIHsKLSAgICAgICAgc3ZjLT5hdmdsb2FkID0g
dmNwdV9sb2FkIDw8IFA7CisgICAgICAgIHN2Yy0+YXZnbG9hZCA9IGl0ZW1fbG9hZCA8PCBQOwog
ICAgIH0KICAgICBlbHNlCiAgICAgewpAQCAtMTIzMSw3ICsxMjMxLDcgQEAgdXBkYXRlX3N2Y19s
b2FkKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKICAgICAgICAgfQogCiAgICAgICAgIHN2
Yy0+YXZnbG9hZCA9IHN2Yy0+YXZnbG9hZCArCi0gICAgICAgICAgICAgICAgICAgICAgICgoZGVs
dGEgKiAodmNwdV9sb2FkIDw8IFApKSA+PiBXKSAtCisgICAgICAgICAgICAgICAgICAgICAgICgo
ZGVsdGEgKiAoaXRlbV9sb2FkIDw8IFApKSA+PiBXKSAtCiAgICAgICAgICAgICAgICAgICAgICAg
ICgoZGVsdGEgKiBzdmMtPmF2Z2xvYWQpID4+IFcpOwogICAgIH0KICAgICBzdmMtPmxvYWRfbGFz
dF91cGRhdGUgPSBub3c7CkBAIC0xMjQzLDE0ICsxMjQzLDE0IEBAIHVwZGF0ZV9zdmNfbG9hZChj
b25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsCiAgICAgewogICAgICAgICBzdHJ1Y3QgewogICAg
ICAgICAgICAgdWludDY0X3Qgdl9hdmdsb2FkOwotICAgICAgICAgICAgdW5zaWduZWQgdmNwdTox
NiwgZG9tOjE2OworICAgICAgICAgICAgdW5zaWduZWQgaXRlbToxNiwgZG9tOjE2OwogICAgICAg
ICAgICAgdW5zaWduZWQgc2hpZnQ7CiAgICAgICAgIH0gZDsKLSAgICAgICAgZC5kb20gPSBzdmMt
PnZjcHUtPmRvbWFpbi0+ZG9tYWluX2lkOwotICAgICAgICBkLnZjcHUgPSBzdmMtPnZjcHUtPnZj
cHVfaWQ7CisgICAgICAgIGQuZG9tID0gc3ZjLT5pdGVtLT5kb21haW4tPmRvbWFpbl9pZDsKKyAg
ICAgICAgZC5pdGVtID0gc3ZjLT5pdGVtLT5pdGVtX2lkOwogICAgICAgICBkLnZfYXZnbG9hZCA9
IHN2Yy0+YXZnbG9hZDsKICAgICAgICAgZC5zaGlmdCA9IFA7Ci0gICAgICAgIF9fdHJhY2VfdmFy
KFRSQ19DU0NIRUQyX1VQREFURV9WQ1BVX0xPQUQsIDEsCisgICAgICAgIF9fdHJhY2VfdmFyKFRS
Q19DU0NIRUQyX1VQREFURV9JVEVNX0xPQUQsIDEsCiAgICAgICAgICAgICAgICAgICAgIHNpemVv
ZihkKSwKICAgICAgICAgICAgICAgICAgICAgKHVuc2lnbmVkIGNoYXIgKikmZCk7CiAgICAgfQpA
QCAtMTI3MiwxOCArMTI3MiwxOCBAQCBzdGF0aWMgdm9pZAogcnVucV9pbnNlcnQoY29uc3Qgc3Ry
dWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgY3NjaGVkMl9pdGVtICpzdmMpCiB7CiAgICAgc3Ry
dWN0IGxpc3RfaGVhZCAqaXRlcjsKLSAgICB1bnNpZ25lZCBpbnQgY3B1ID0gc3ZjLT52Y3B1LT5w
cm9jZXNzb3I7CisgICAgdW5zaWduZWQgaW50IGNwdSA9IHNjaGVkX2l0ZW1fY3B1KHN2Yy0+aXRl
bSk7CiAgICAgc3RydWN0IGxpc3RfaGVhZCAqIHJ1bnEgPSAmYzJycWQob3BzLCBjcHUpLT5ydW5x
OwogICAgIGludCBwb3MgPSAwOwogCiAgICAgQVNTRVJUKHNwaW5faXNfbG9ja2VkKHBlcl9jcHUo
c2NoZWRfcmVzLCBjcHUpLT5zY2hlZHVsZV9sb2NrKSk7CiAKLSAgICBBU1NFUlQoIXZjcHVfb25f
cnVucShzdmMpKTsKLSAgICBBU1NFUlQoYzJyKGNwdSkgPT0gYzJyKHN2Yy0+dmNwdS0+cHJvY2Vz
c29yKSk7CisgICAgQVNTRVJUKCFpdGVtX29uX3J1bnEoc3ZjKSk7CisgICAgQVNTRVJUKGMycihj
cHUpID09IGMycihzY2hlZF9pdGVtX2NwdShzdmMtPml0ZW0pKSk7CiAKICAgICBBU1NFUlQoJnN2
Yy0+cnFkLT5ydW5xID09IHJ1bnEpOwotICAgIEFTU0VSVCghaXNfaWRsZV92Y3B1KHN2Yy0+dmNw
dSkpOwotICAgIEFTU0VSVCghc3ZjLT52Y3B1LT5zY2hlZF9pdGVtLT5pc19ydW5uaW5nKTsKKyAg
ICBBU1NFUlQoIWlzX2lkbGVfaXRlbShzdmMtPml0ZW0pKTsKKyAgICBBU1NFUlQoIXN2Yy0+aXRl
bS0+aXNfcnVubmluZyk7CiAgICAgQVNTRVJUKCEoc3ZjLT5mbGFncyAmIENTRkxBR19zY2hlZHVs
ZWQpKTsKIAogICAgIGxpc3RfZm9yX2VhY2goIGl0ZXIsIHJ1bnEgKQpAQCAtMTMwMCwxMSArMTMw
MCwxMSBAQCBydW5xX2luc2VydChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBj
c2NoZWQyX2l0ZW0gKnN2YykKICAgICBpZiAoIHVubGlrZWx5KHRiX2luaXRfZG9uZSkgKQogICAg
IHsKICAgICAgICAgc3RydWN0IHsKLSAgICAgICAgICAgIHVuc2lnbmVkIHZjcHU6MTYsIGRvbTox
NjsKKyAgICAgICAgICAgIHVuc2lnbmVkIGl0ZW06MTYsIGRvbToxNjsKICAgICAgICAgICAgIHVu
c2lnbmVkIHBvczsKICAgICAgICAgfSBkOwotICAgICAgICBkLmRvbSA9IHN2Yy0+dmNwdS0+ZG9t
YWluLT5kb21haW5faWQ7Ci0gICAgICAgIGQudmNwdSA9IHN2Yy0+dmNwdS0+dmNwdV9pZDsKKyAg
ICAgICAgZC5kb20gPSBzdmMtPml0ZW0tPmRvbWFpbi0+ZG9tYWluX2lkOworICAgICAgICBkLml0
ZW0gPSBzdmMtPml0ZW0tPml0ZW1faWQ7CiAgICAgICAgIGQucG9zID0gcG9zOwogICAgICAgICBf
X3RyYWNlX3ZhcihUUkNfQ1NDSEVEMl9SVU5RX1BPUywgMSwKICAgICAgICAgICAgICAgICAgICAg
c2l6ZW9mKGQpLApAQCAtMTMxNCw3ICsxMzE0LDcgQEAgcnVucV9pbnNlcnQoY29uc3Qgc3RydWN0
IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3QgY3NjaGVkMl9pdGVtICpzdmMpCiAKIHN0YXRpYyBpbmxp
bmUgdm9pZCBydW5xX3JlbW92ZShzdHJ1Y3QgY3NjaGVkMl9pdGVtICpzdmMpCiB7Ci0gICAgQVNT
RVJUKHZjcHVfb25fcnVucShzdmMpKTsKKyAgICBBU1NFUlQoaXRlbV9vbl9ydW5xKHN2YykpOwog
ICAgIGxpc3RfZGVsX2luaXQoJnN2Yy0+cnVucV9lbGVtKTsKIH0KIApAQCAtMTM0MCw4ICsxMzQw
LDggQEAgc3RhdGljIGlubGluZSBib29sIGlzX3ByZWVtcHRhYmxlKGNvbnN0IHN0cnVjdCBjc2No
ZWQyX2l0ZW0gKnN2YywKICAgICBpZiAoIHJhdGVsaW1pdCA8PSBDU0NIRUQyX1JBVEVMSU1JVF9U
SUNLTEVfVE9MRVJBTkNFICkKICAgICAgICAgcmV0dXJuIHRydWU7CiAKLSAgICBBU1NFUlQoc3Zj
LT52Y3B1LT5zY2hlZF9pdGVtLT5pc19ydW5uaW5nKTsKLSAgICByZXR1cm4gbm93IC0gc3ZjLT52
Y3B1LT5zY2hlZF9pdGVtLT5zdGF0ZV9lbnRyeV90aW1lID4KKyAgICBBU1NFUlQoc3ZjLT5pdGVt
LT5pc19ydW5uaW5nKTsKKyAgICByZXR1cm4gbm93IC0gc3ZjLT5pdGVtLT5zdGF0ZV9lbnRyeV90
aW1lID4KICAgICAgICAgICAgcmF0ZWxpbWl0IC0gQ1NDSEVEMl9SQVRFTElNSVRfVElDS0xFX1RP
TEVSQU5DRTsKIH0KIApAQCAtMTM2OSwxNyArMTM2OSwxNyBAQCBzdGF0aWMgc190aW1lX3QgdGlj
a2xlX3Njb3JlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc190aW1lX3Qgbm93LAogCiAg
ICAgLyoKICAgICAgKiBXZSBhcmUgZGVhbGluZyB3aXRoIGNwdXMgdGhhdCBhcmUgbWFya2VkIG5v
bi1pZGxlIChpLmUuLCB0aGF0IGFyZSBub3QKLSAgICAgKiBpbiBycWQtPmlkbGUpLiBIb3dldmVy
LCBzb21lIG9mIHRoZW0gbWF5IGJlIHJ1bm5pbmcgdGhlaXIgaWRsZSB2Y3B1LAorICAgICAqIGlu
IHJxZC0+aWRsZSkuIEhvd2V2ZXIsIHNvbWUgb2YgdGhlbSBtYXkgYmUgcnVubmluZyB0aGVpciBp
ZGxlIGl0ZW0sCiAgICAgICogaWYgdGFraW5nIGNhcmUgb2YgdGFza2xldHMuIEluIHRoYXQgY2Fz
ZSwgd2Ugd2FudCB0byBsZWF2ZSBpdCBhbG9uZS4KICAgICAgKi8KLSAgICBpZiAoIHVubGlrZWx5
KGlzX2lkbGVfdmNwdShjdXItPnZjcHUpIHx8CisgICAgaWYgKCB1bmxpa2VseShpc19pZGxlX2l0
ZW0oY3VyLT5pdGVtKSB8fAogICAgICAgICAgIWlzX3ByZWVtcHRhYmxlKGN1ciwgbm93LCBNSUNS
T1NFQ1MocHJ2LT5yYXRlbGltaXRfdXMpKSkgKQogICAgICAgICByZXR1cm4gLTE7CiAKICAgICBi
dXJuX2NyZWRpdHMocnFkLCBjdXIsIG5vdyk7CiAKICAgICBzY29yZSA9IG5ldy0+Y3JlZGl0IC0g
Y3VyLT5jcmVkaXQ7Ci0gICAgaWYgKCBuZXctPnZjcHUtPnByb2Nlc3NvciAhPSBjcHUgKQorICAg
IGlmICggc2NoZWRfaXRlbV9jcHUobmV3LT5pdGVtKSAhPSBjcHUgKQogICAgICAgICBzY29yZSAt
PSBDU0NIRUQyX01JR1JBVEVfUkVTSVNUOwogCiAgICAgLyoKQEAgLTEzOTAsMjEgKzEzOTAsMjEg
QEAgc3RhdGljIHNfdGltZV90IHRpY2tsZV9zY29yZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpv
cHMsIHNfdGltZV90IG5vdywKICAgICAgKi8KICAgICBpZiAoIHNjb3JlID4gMCApCiAgICAgewot
ICAgICAgICBpZiAoIGNwdW1hc2tfdGVzdF9jcHUoY3B1LCBuZXctPnZjcHUtPnNjaGVkX2l0ZW0t
PmNwdV9zb2Z0X2FmZmluaXR5KSApCisgICAgICAgIGlmICggY3B1bWFza190ZXN0X2NwdShjcHUs
IG5ldy0+aXRlbS0+Y3B1X3NvZnRfYWZmaW5pdHkpICkKICAgICAgICAgICAgIHNjb3JlICs9IENT
Q0hFRDJfQ1JFRElUX0lOSVQ7CiAKLSAgICAgICAgaWYgKCAhY3B1bWFza190ZXN0X2NwdShjcHUs
IGN1ci0+dmNwdS0+c2NoZWRfaXRlbS0+Y3B1X3NvZnRfYWZmaW5pdHkpICkKKyAgICAgICAgaWYg
KCAhY3B1bWFza190ZXN0X2NwdShjcHUsIGN1ci0+aXRlbS0+Y3B1X3NvZnRfYWZmaW5pdHkpICkK
ICAgICAgICAgICAgIHNjb3JlICs9IENTQ0hFRDJfQ1JFRElUX0lOSVQ7CiAgICAgfQogCiAgICAg
aWYgKCB1bmxpa2VseSh0Yl9pbml0X2RvbmUpICkKICAgICB7CiAgICAgICAgIHN0cnVjdCB7Ci0g
ICAgICAgICAgICB1bnNpZ25lZCB2Y3B1OjE2LCBkb206MTY7CisgICAgICAgICAgICB1bnNpZ25l
ZCBpdGVtOjE2LCBkb206MTY7CiAgICAgICAgICAgICBpbnQgY3JlZGl0LCBzY29yZTsKICAgICAg
ICAgfSBkOwotICAgICAgICBkLmRvbSA9IGN1ci0+dmNwdS0+ZG9tYWluLT5kb21haW5faWQ7Ci0g
ICAgICAgIGQudmNwdSA9IGN1ci0+dmNwdS0+dmNwdV9pZDsKKyAgICAgICAgZC5kb20gPSBjdXIt
Pml0ZW0tPmRvbWFpbi0+ZG9tYWluX2lkOworICAgICAgICBkLml0ZW0gPSBjdXItPml0ZW0tPml0
ZW1faWQ7CiAgICAgICAgIGQuY3JlZGl0ID0gY3VyLT5jcmVkaXQ7CiAgICAgICAgIGQuc2NvcmUg
PSBzY29yZTsKICAgICAgICAgX190cmFjZV92YXIoVFJDX0NTQ0hFRDJfVElDS0xFX0NIRUNLLCAx
LApAQCAtMTQxNiwxNCArMTQxNiwxNCBAQCBzdGF0aWMgc190aW1lX3QgdGlja2xlX3Njb3JlKGNv
bnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc190aW1lX3Qgbm93LAogfQogCiAvKgotICogQ2hl
Y2sgd2hhdCBwcm9jZXNzb3IgaXQgaXMgYmVzdCB0byAnd2FrZScsIGZvciBwaWNraW5nIHVwIGEg
dmNwdSB0aGF0IGhhcworICogQ2hlY2sgd2hhdCBwcm9jZXNzb3IgaXQgaXMgYmVzdCB0byAnd2Fr
ZScsIGZvciBwaWNraW5nIHVwIGFuIGl0ZW0gdGhhdCBoYXMKICAqIGp1c3QgYmVlbiBwdXQgKGJh
Y2spIGluIHRoZSBydW5xdWV1ZS4gTG9naWMgaXMgYXMgZm9sbG93czoKICAqICAxLiBpZiB0aGVy
ZSBhcmUgaWRsZSBwcm9jZXNzb3JzIGluIHRoZSBydW5xLCB3YWtlIG9uZSBvZiB0aGVtOwotICog
IDIuIGlmIHRoZXJlIGFyZW4ndCBpZGxlIHByb2Nlc3NvciwgY2hlY2sgdGhlIG9uZSB3ZXJlIHRo
ZSB2Y3B1IHdhcworICogIDIuIGlmIHRoZXJlIGFyZW4ndCBpZGxlIHByb2Nlc3NvciwgY2hlY2sg
dGhlIG9uZSB3ZXJlIHRoZSBpdGVtIHdhcwogICogICAgIHJ1bm5pbmcgYmVmb3JlIHRvIHNlZSBp
ZiB3ZSBjYW4gcHJlZW1wdCB3aGF0J3MgcnVubmluZyB0aGVyZSBub3cKICAqICAgICAoYW5kIGhl
bmNlIGRvaW5nIGp1c3Qgb25lIG1pZ3JhdGlvbik7Ci0gKiAgMy4gbGFzdCBzdGFuZDogY2hlY2sg
YWxsIHByb2Nlc3NvcnMgYW5kIHNlZSBpZiB0aGUgdmNwdSBpcyBpbiByaWdodAotICogICAgIG9m
IHByZWVtcHRpbmcgYW55IG9mIHRoZSBvdGhlciB2Y3B1cyBydW5uaW5nIG9uIHRoZW0gKHRoaXMg
cmVxdWlyZXMKKyAqICAzLiBsYXN0IHN0YW5kOiBjaGVjayBhbGwgcHJvY2Vzc29ycyBhbmQgc2Vl
IGlmIHRoZSBpdGVtIGlzIGluIHJpZ2h0CisgKiAgICAgb2YgcHJlZW1wdGluZyBhbnkgb2YgdGhl
IG90aGVyIGl0ZW1zIHJ1bm5pbmcgb24gdGhlbSAodGhpcyByZXF1aXJlcwogICogICAgIHR3byBt
aWdyYXRpb25zLCBhbmQgdGhhdCdzIGluZGVlZCB3aHkgaXQgaXMgbGVmdCBhcyB0aGUgbGFzdCBz
dGFuZCkuCiAgKgogICogTm90ZSB0aGF0IHdoZW4gd2Ugc2F5ICdpZGxlIHByb2Nlc3NvcnMnIHdo
YXQgd2UgcmVhbGx5IG1lYW4gaXMgKHByZXR0eQpAQCAtMTQzNiwxMCArMTQzNiwxMCBAQCBydW5x
X3RpY2tsZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBjc2NoZWQyX2l0ZW0g
Km5ldywgc190aW1lX3Qgbm93KQogewogICAgIGludCBpLCBpcGlkID0gLTE7CiAgICAgc190aW1l
X3QgbWF4ID0gMDsKLSAgICBzdHJ1Y3Qgc2NoZWRfaXRlbSAqaXRlbSA9IG5ldy0+dmNwdS0+c2No
ZWRfaXRlbTsKLSAgICB1bnNpZ25lZCBpbnQgYnMsIGNwdSA9IG5ldy0+dmNwdS0+cHJvY2Vzc29y
OworICAgIHN0cnVjdCBzY2hlZF9pdGVtICppdGVtID0gbmV3LT5pdGVtOworICAgIHVuc2lnbmVk
IGludCBicywgY3B1ID0gc2NoZWRfaXRlbV9jcHUoaXRlbSk7CiAgICAgc3RydWN0IGNzY2hlZDJf
cnVucXVldWVfZGF0YSAqcnFkID0gYzJycWQob3BzLCBjcHUpOwotICAgIGNwdW1hc2tfdCAqb25s
aW5lID0gY3B1cG9vbF9kb21haW5fY3B1bWFzayhuZXctPnZjcHUtPmRvbWFpbik7CisgICAgY3B1
bWFza190ICpvbmxpbmUgPSBjcHVwb29sX2RvbWFpbl9jcHVtYXNrKGl0ZW0tPmRvbWFpbik7CiAg
ICAgY3B1bWFza190IG1hc2s7CiAKICAgICBBU1NFUlQobmV3LT5ycWQgPT0gcnFkKTsKQEAgLTE0
NDcsMTMgKzE0NDcsMTMgQEAgcnVucV90aWNrbGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3Bz
LCBzdHJ1Y3QgY3NjaGVkMl9pdGVtICpuZXcsIHNfdGltZV90IG5vdykKICAgICBpZiAoIHVubGlr
ZWx5KHRiX2luaXRfZG9uZSkgKQogICAgIHsKICAgICAgICAgc3RydWN0IHsKLSAgICAgICAgICAg
IHVuc2lnbmVkIHZjcHU6MTYsIGRvbToxNjsKKyAgICAgICAgICAgIHVuc2lnbmVkIGl0ZW06MTYs
IGRvbToxNjsKICAgICAgICAgICAgIHVuc2lnbmVkIHByb2Nlc3NvcjsKICAgICAgICAgICAgIGlu
dCBjcmVkaXQ7CiAgICAgICAgIH0gZDsKLSAgICAgICAgZC5kb20gPSBuZXctPnZjcHUtPmRvbWFp
bi0+ZG9tYWluX2lkOwotICAgICAgICBkLnZjcHUgPSBuZXctPnZjcHUtPnZjcHVfaWQ7Ci0gICAg
ICAgIGQucHJvY2Vzc29yID0gbmV3LT52Y3B1LT5wcm9jZXNzb3I7CisgICAgICAgIGQuZG9tID0g
aXRlbS0+ZG9tYWluLT5kb21haW5faWQ7CisgICAgICAgIGQuaXRlbSA9IGl0ZW0tPml0ZW1faWQ7
CisgICAgICAgIGQucHJvY2Vzc29yID0gY3B1OwogICAgICAgICBkLmNyZWRpdCA9IG5ldy0+Y3Jl
ZGl0OwogICAgICAgICBfX3RyYWNlX3ZhcihUUkNfQ1NDSEVEMl9USUNLTEVfTkVXLCAxLAogICAg
ICAgICAgICAgICAgICAgICBzaXplb2YoZCksCkBAIC0xNDYxLDExICsxNDYxLDExIEBAIHJ1bnFf
dGlja2xlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IGNzY2hlZDJfaXRlbSAq
bmV3LCBzX3RpbWVfdCBub3cpCiAgICAgfQogCiAgICAgLyoKLSAgICAgKiBFeGNsdXNpdmUgcGlu
bmluZyBpcyB3aGVuIGEgdmNwdSBoYXMgaGFyZC1hZmZpbml0eSB3aXRoIG9ubHkgb25lCi0gICAg
ICogY3B1LCBhbmQgdGhlcmUgaXMgbm8gb3RoZXIgdmNwdSB0aGF0IGhhcyBoYXJkLWFmZmluaXR5
IHdpdGggdGhhdAorICAgICAqIEV4Y2x1c2l2ZSBwaW5uaW5nIGlzIHdoZW4gYW4gaXRlbSBoYXMg
aGFyZC1hZmZpbml0eSB3aXRoIG9ubHkgb25lCisgICAgICogY3B1LCBhbmQgdGhlcmUgaXMgbm8g
b3RoZXIgaXRlbSB0aGF0IGhhcyBoYXJkLWFmZmluaXR5IHdpdGggdGhhdAogICAgICAqIHNhbWUg
Y3B1LiBUaGlzIGlzIGluZnJlcXVlbnQsIGJ1dCBpZiBpdCBoYXBwZW5zLCBpcyBmb3IgYWNoaWV2
aW5nCiAgICAgICogdGhlIG1vc3QgcG9zc2libGUgZGV0ZXJtaW5pc20sIGFuZCBsZWFzdCBwb3Nz
aWJsZSBvdmVyaGVhZCBmb3IKLSAgICAgKiB0aGUgdmNwdXMgaW4gcXVlc3Rpb24uCisgICAgICog
dGhlIGl0ZW1zIGluIHF1ZXN0aW9uLgogICAgICAqCiAgICAgICogVHJ5IHRvIGlkZW50aWZ5IHRo
ZSB2YXN0IG1ham9yaXR5IG9mIHRoZXNlIHNpdHVhdGlvbnMsIGFuZCBkZWFsCiAgICAgICogd2l0
aCB0aGVtIHF1aWNrbHkuCkBAIC0xNTMyLDcgKzE1MzIsNyBAQCBydW5xX3RpY2tsZShjb25zdCBz
dHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBjc2NoZWQyX2l0ZW0gKm5ldywgc190aW1lX3Qg
bm93KQogICAgIC8qCiAgICAgICogTm90ZSB0aGF0LCBpZiB3ZSBhcmUgaGVyZSwgaXQgbWVhbnMg
d2UgaGF2ZSBkb25lIHRoZSBoYXJkLWFmZmluaXR5CiAgICAgICogYmFsYW5jaW5nIHN0ZXAgb2Yg
dGhlIGxvb3AsIGFuZCBoZW5jZSB3aGF0IHdlIGhhdmUgaW4gY3B1bWFza19zY3JhdGNoCi0gICAg
ICogaXMgd2hhdCB3ZSBwdXQgdGhlcmUgZm9yIGxhc3QsIGkuZS4sIG5ldydzIHZjcHVfaGFyZF9h
ZmZpbml0eSAmIG9ubGluZQorICAgICAqIGlzIHdoYXQgd2UgcHV0IHRoZXJlIGZvciBsYXN0LCBp
LmUuLCBuZXcncyBpdGVtX2hhcmRfYWZmaW5pdHkgJiBvbmxpbmUKICAgICAgKiB3aGljaCBpcyBl
eGFjdGx5IHdoYXQgd2UgbmVlZCBmb3IgdGhlIG5leHQgcGFydCBvZiB0aGUgZnVuY3Rpb24uCiAg
ICAgICovCiAKQEAgLTE1NDMsNyArMTU0Myw3IEBAIHJ1bnFfdGlja2xlKGNvbnN0IHN0cnVjdCBz
Y2hlZHVsZXIgKm9wcywgc3RydWN0IGNzY2hlZDJfaXRlbSAqbmV3LCBzX3RpbWVfdCBub3cpCiAg
ICAgICoKICAgICAgKiBGb3IgZGVjaWRpbmcgd2hpY2ggY3B1IHRvIHRpY2tsZSwgd2UgdXNlIHRp
Y2tsZV9zY29yZSgpLCB3aGljaCB3aWxsCiAgICAgICogZmFjdG9yIGluIGJvdGggbmV3J3Mgc29m
dC1hZmZpbml0eSwgYW5kIHRoZSBzb2Z0LWFmZmluaXR5IG9mIHRoZQotICAgICAqIHZjcHUgcnVu
bmluZyBvbiBlYWNoIGNwdSB0aGF0IHdlIGNvbnNpZGVyLgorICAgICAqIGl0ZW0gcnVubmluZyBv
biBlYWNoIGNwdSB0aGF0IHdlIGNvbnNpZGVyLgogICAgICAqLwogICAgIGNwdW1hc2tfYW5kbm90
KCZtYXNrLCAmcnFkLT5hY3RpdmUsICZycWQtPmlkbGUpOwogICAgIGNwdW1hc2tfYW5kbm90KCZt
YXNrLCAmbWFzaywgJnJxZC0+dGlja2xlZCk7CkBAIC0xNTg4LDcgKzE1ODgsNyBAQCBydW5xX3Rp
Y2tsZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBjc2NoZWQyX2l0ZW0gKm5l
dywgc190aW1lX3Qgbm93KQogICAgICAgICByZXR1cm47CiAgICAgfQogCi0gICAgQVNTRVJUKCFp
c19pZGxlX3ZjcHUoY3Vycl9vbl9jcHUoaXBpZCktPnZjcHUpKTsKKyAgICBBU1NFUlQoIWlzX2lk
bGVfaXRlbShjdXJyX29uX2NwdShpcGlkKSkpOwogICAgIFNDSEVEX1NUQVRfQ1JBTksodGlja2xl
ZF9idXN5X2NwdSk7CiAgdGlja2xlOgogICAgIEJVR19PTihpcGlkID09IC0xKTsKQEAgLTE2MjMs
MTYgKzE2MjMsMTYgQEAgc3RhdGljIHZvaWQgcmVzZXRfY3JlZGl0KGNvbnN0IHN0cnVjdCBzY2hl
ZHVsZXIgKm9wcywgaW50IGNwdSwgc190aW1lX3Qgbm93LAogCiAgICAgLyoKICAgICAgKiBVbmRl
ciBub3JtYWwgY2lyY3Vtc3RhbmNlcywgc25leHQtPmNyZWRpdCBzaG91bGQgbmV2ZXIgYmUgbGVz
cwotICAgICAqIHRoYW4gLUNTQ0hFRDJfTUlOX1RJTUVSLiAgSG93ZXZlciwgdW5kZXIgc29tZSBj
aXJjdW1zdGFuY2VzLCBhCi0gICAgICogdmNwdSB3aXRoIGxvdyBjcmVkaXRzIG1heSBiZSBhbGxv
d2VkIHRvIHJ1biBsb25nIGVub3VnaCB0aGF0CisgICAgICogdGhhbiAtQ1NDSEVEMl9NSU5fVElN
RVIuICBIb3dldmVyLCB1bmRlciBzb21lIGNpcmN1bXN0YW5jZXMsIGFuCisgICAgICogaXRlbSB3
aXRoIGxvdyBjcmVkaXRzIG1heSBiZSBhbGxvd2VkIHRvIHJ1biBsb25nIGVub3VnaCB0aGF0CiAg
ICAgICogaXRzIGNyZWRpdHMgYXJlIGFjdHVhbGx5IGxlc3MgdGhhbiAtQ1NDSEVEMl9DUkVESVRf
SU5JVC4KLSAgICAgKiAoSW5zdGFuY2VzIGhhdmUgYmVlbiBvYnNlcnZlZCwgZm9yIGV4YW1wbGUs
IHdoZXJlIGEgdmNwdSB3aXRoCisgICAgICogKEluc3RhbmNlcyBoYXZlIGJlZW4gb2JzZXJ2ZWQs
IGZvciBleGFtcGxlLCB3aGVyZSBhbiBpdGVtIHdpdGgKICAgICAgKiAyMDB1cyBvZiBjcmVkaXQg
d2FzIGFsbG93ZWQgdG8gcnVuIGZvciAxMW1zLCBnaXZpbmcgaXQgLTEwLjhtcwogICAgICAqIG9m
IGNyZWRpdC4gIFRodXMgaXQgd2FzIHN0aWxsIG5lZ2F0aXZlIGV2ZW4gYWZ0ZXIgdGhlIHJlc2V0
LikKICAgICAgKgogICAgICAqIElmIHRoaXMgaXMgdGhlIGNhc2UgZm9yIHNuZXh0LCB3ZSBzaW1w
bHkgd2FudCB0byBrZWVwIG1vdmluZwogICAgICAqIGV2ZXJ5b25lIHVwIHVudGlsIGl0IGlzIGlu
IHRoZSBibGFjayBhZ2Fpbi4gIFRoaXMgZmFpciBiZWNhdXNlCi0gICAgICogbm9uZSBvZiB0aGUg
b3RoZXIgdmNwdXMgd2FudCB0byBydW4gYXQgdGhlIG1vbWVudC4KKyAgICAgKiBub25lIG9mIHRo
ZSBvdGhlciBpdGVtcyB3YW50IHRvIHJ1biBhdCB0aGUgbW9tZW50LgogICAgICAqCiAgICAgICog
UmF0aGVyIHRoYW4gbG9vcGluZywgaG93ZXZlciwgd2UganVzdCBjYWxjdWxhdGUgYSBtdWx0aXBs
aWVyLAogICAgICAqIGF2b2lkaW5nIGFuIGludGVnZXIgZGl2aXNpb24gYW5kIG11bHRpcGxpY2F0
aW9uIGluIHRoZSBjb21tb24KQEAgLTE2NDksMTYgKzE2NDksMTYgQEAgc3RhdGljIHZvaWQgcmVz
ZXRfY3JlZGl0KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgaW50IGNwdSwgc190aW1lX3Qg
bm93LAogICAgICAgICBpbnQgc3RhcnRfY3JlZGl0OwogCiAgICAgICAgIHN2YyA9IGxpc3RfZW50
cnkoaXRlciwgc3RydWN0IGNzY2hlZDJfaXRlbSwgcnFkX2VsZW0pOwotICAgICAgICBzdmNfY3B1
ID0gc3ZjLT52Y3B1LT5wcm9jZXNzb3I7CisgICAgICAgIHN2Y19jcHUgPSBzY2hlZF9pdGVtX2Nw
dShzdmMtPml0ZW0pOwogCi0gICAgICAgIEFTU0VSVCghaXNfaWRsZV92Y3B1KHN2Yy0+dmNwdSkp
OworICAgICAgICBBU1NFUlQoIWlzX2lkbGVfaXRlbShzdmMtPml0ZW0pKTsKICAgICAgICAgQVNT
RVJUKHN2Yy0+cnFkID09IHJxZCk7CiAKICAgICAgICAgLyoKICAgICAgICAgICogSWYgc3ZjIGlz
IHJ1bm5pbmcsIGl0IGlzIG91ciByZXNwb25zaWJpbGl0eSB0byBtYWtlIHN1cmUsIGhlcmUsCiAg
ICAgICAgICAqIHRoYXQgdGhlIGNyZWRpdCBpdCBoYXMgc3BlbnQgc28gZmFyIGdldCBhY2NvdW50
ZWQuCiAgICAgICAgICAqLwotICAgICAgICBpZiAoIHN2Yy0+dmNwdSA9PSBjdXJyX29uX2NwdShz
dmNfY3B1KS0+dmNwdSApCisgICAgICAgIGlmICggc3ZjLT5pdGVtID09IGN1cnJfb25fY3B1KHN2
Y19jcHUpICkKICAgICAgICAgewogICAgICAgICAgICAgYnVybl9jcmVkaXRzKHJxZCwgc3ZjLCBu
b3cpOwogICAgICAgICAgICAgLyoKQEAgLTE2ODksMTIgKzE2ODksMTIgQEAgc3RhdGljIHZvaWQg
cmVzZXRfY3JlZGl0KGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgaW50IGNwdSwgc190aW1l
X3Qgbm93LAogICAgICAgICBpZiAoIHVubGlrZWx5KHRiX2luaXRfZG9uZSkgKQogICAgICAgICB7
CiAgICAgICAgICAgICBzdHJ1Y3QgewotICAgICAgICAgICAgICAgIHVuc2lnbmVkIHZjcHU6MTYs
IGRvbToxNjsKKyAgICAgICAgICAgICAgICB1bnNpZ25lZCBpdGVtOjE2LCBkb206MTY7CiAgICAg
ICAgICAgICAgICAgaW50IGNyZWRpdF9zdGFydCwgY3JlZGl0X2VuZDsKICAgICAgICAgICAgICAg
ICB1bnNpZ25lZCBtdWx0aXBsaWVyOwogICAgICAgICAgICAgfSBkOwotICAgICAgICAgICAgZC5k
b20gPSBzdmMtPnZjcHUtPmRvbWFpbi0+ZG9tYWluX2lkOwotICAgICAgICAgICAgZC52Y3B1ID0g
c3ZjLT52Y3B1LT52Y3B1X2lkOworICAgICAgICAgICAgZC5kb20gPSBzdmMtPml0ZW0tPmRvbWFp
bi0+ZG9tYWluX2lkOworICAgICAgICAgICAgZC5pdGVtID0gc3ZjLT5pdGVtLT5pdGVtX2lkOwog
ICAgICAgICAgICAgZC5jcmVkaXRfc3RhcnQgPSBzdGFydF9jcmVkaXQ7CiAgICAgICAgICAgICBk
LmNyZWRpdF9lbmQgPSBzdmMtPmNyZWRpdDsKICAgICAgICAgICAgIGQubXVsdGlwbGllciA9IG07
CkBAIC0xNzE0LDkgKzE3MTQsOSBAQCB2b2lkIGJ1cm5fY3JlZGl0cyhzdHJ1Y3QgY3NjaGVkMl9y
dW5xdWV1ZV9kYXRhICpycWQsCiB7CiAgICAgc190aW1lX3QgZGVsdGE7CiAKLSAgICBBU1NFUlQo
c3ZjID09IGNzY2hlZDJfaXRlbShjdXJyX29uX2NwdShzdmMtPnZjcHUtPnByb2Nlc3NvcikpKTsK
KyAgICBBU1NFUlQoc3ZjID09IGNzY2hlZDJfaXRlbShjdXJyX29uX2NwdShzY2hlZF9pdGVtX2Nw
dShzdmMtPml0ZW0pKSkpOwogCi0gICAgaWYgKCB1bmxpa2VseShpc19pZGxlX3ZjcHUoc3ZjLT52
Y3B1KSkgKQorICAgIGlmICggdW5saWtlbHkoaXNfaWRsZV9pdGVtKHN2Yy0+aXRlbSkpICkKICAg
ICB7CiAgICAgICAgIEFTU0VSVChzdmMtPmNyZWRpdCA9PSBDU0NIRUQyX0lETEVfQ1JFRElUKTsK
ICAgICAgICAgcmV0dXJuOwpAQCAtMTc0NSwxMiArMTc0NSwxMiBAQCB2b2lkIGJ1cm5fY3JlZGl0
cyhzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQsCiAgICAgaWYgKCB1bmxpa2VseSh0
Yl9pbml0X2RvbmUpICkKICAgICB7CiAgICAgICAgIHN0cnVjdCB7Ci0gICAgICAgICAgICB1bnNp
Z25lZCB2Y3B1OjE2LCBkb206MTY7CisgICAgICAgICAgICB1bnNpZ25lZCBpdGVtOjE2LCBkb206
MTY7CiAgICAgICAgICAgICBpbnQgY3JlZGl0LCBidWRnZXQ7CiAgICAgICAgICAgICBpbnQgZGVs
dGE7CiAgICAgICAgIH0gZDsKLSAgICAgICAgZC5kb20gPSBzdmMtPnZjcHUtPmRvbWFpbi0+ZG9t
YWluX2lkOwotICAgICAgICBkLnZjcHUgPSBzdmMtPnZjcHUtPnZjcHVfaWQ7CisgICAgICAgIGQu
ZG9tID0gc3ZjLT5pdGVtLT5kb21haW4tPmRvbWFpbl9pZDsKKyAgICAgICAgZC5pdGVtID0gc3Zj
LT5pdGVtLT5pdGVtX2lkOwogICAgICAgICBkLmNyZWRpdCA9IHN2Yy0+Y3JlZGl0OwogICAgICAg
ICBkLmJ1ZGdldCA9IGhhc19jYXAoc3ZjKSA/ICBzdmMtPmJ1ZGdldCA6IElOVF9NSU47CiAgICAg
ICAgIGQuZGVsdGEgPSBkZWx0YTsKQEAgLTE3NjQsMzkgKzE3NjQsMzkgQEAgdm9pZCBidXJuX2Ny
ZWRpdHMoc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFkLAogICogQnVkZ2V0LXJlbGF0
ZWQgY29kZS4KICAqLwogCi1zdGF0aWMgdm9pZCBwYXJrX3ZjcHUoc3RydWN0IGNzY2hlZDJfaXRl
bSAqc3ZjKQorc3RhdGljIHZvaWQgcGFya19pdGVtKHN0cnVjdCBjc2NoZWQyX2l0ZW0gKnN2YykK
IHsKLSAgICBzdHJ1Y3QgdmNwdSAqdiA9IHN2Yy0+dmNwdTsKKyAgICBzdHJ1Y3Qgc2NoZWRfaXRl
bSAqaXRlbSA9IHN2Yy0+aXRlbTsKIAogICAgIEFTU0VSVChzcGluX2lzX2xvY2tlZCgmc3ZjLT5z
ZG9tLT5idWRnZXRfbG9jaykpOwogCiAgICAgLyoKLSAgICAgKiBJdCB3YXMgaW1wb3NzaWJsZSB0
byBmaW5kIGJ1ZGdldCBmb3IgdGhpcyB2Q1BVLCBzbyBpdCBoYXMgdG8gYmUKKyAgICAgKiBJdCB3
YXMgaW1wb3NzaWJsZSB0byBmaW5kIGJ1ZGdldCBmb3IgdGhpcyBpdGVtLCBzbyBpdCBoYXMgdG8g
YmUKICAgICAgKiAicGFya2VkIi4gVGhpcyBpbXBsaWVzIGl0IGlzIG5vdCBydW5uYWJsZSwgc28g
d2UgbWFyayBpdCBhcyBzdWNoIGluCi0gICAgICogaXRzIHBhdXNlX2ZsYWdzLiBJZiB0aGUgdkNQ
VSBpcyBjdXJyZW50bHkgc2NoZWR1bGVkICh3aGljaCBtZWFucyB3ZQorICAgICAqIGl0cyBwYXVz
ZV9mbGFncy4gSWYgdGhlIGl0ZW0gaXMgY3VycmVudGx5IHNjaGVkdWxlZCAod2hpY2ggbWVhbnMg
d2UKICAgICAgKiBhcmUgaGVyZSBhZnRlciBiZWluZyBjYWxsZWQgZnJvbSB3aXRoaW4gY3NjaGVk
X3NjaGVkdWxlKCkpLCBmbGFnZ2luZwogICAgICAqIGlzIGVub3VnaCwgYXMgd2UnbGwgY2hvb3Nl
IHNvbWVvbmUgZWxzZSwgYW5kIHRoZW4gY29udGV4dF9zYXZlZCgpCiAgICAgICogd2lsbCB0YWtl
IGNhcmUgb2YgdXBkYXRpbmcgdGhlIGxvYWQgcHJvcGVybHkuCiAgICAgICoKLSAgICAgKiBJZiwg
T1RPSCwgdGhlIHZDUFUgaXMgc2l0dGluZyBpbiB0aGUgcnVucXVldWUgKHdoaWNoIG1lYW5zIHdl
IGFyZSBoZXJlCisgICAgICogSWYsIE9UT0gsIHRoZSBpdGVtIGlzIHNpdHRpbmcgaW4gdGhlIHJ1
bnF1ZXVlICh3aGljaCBtZWFucyB3ZSBhcmUgaGVyZQogICAgICAqIGFmdGVyIGJlaW5nIGNhbGxl
ZCBmcm9tIHdpdGhpbiBydW5xX2NhbmRpZGF0ZSgpKSwgd2UgbXVzdCBnbyBhbGwgdGhlCiAgICAg
ICogd2F5IGRvd24gdG8gdGFraW5nIGl0IG91dCBvZiB0aGVyZSwgYW5kIHVwZGF0aW5nIHRoZSBs
b2FkIGFjY29yZGluZ2x5LgogICAgICAqCi0gICAgICogSW4gYm90aCBjYXNlcywgd2UgYWxzbyBh
ZGQgaXQgdG8gdGhlIGxpc3Qgb2YgcGFya2VkIHZDUFVzIG9mIHRoZSBkb21haW4uCisgICAgICog
SW4gYm90aCBjYXNlcywgd2UgYWxzbyBhZGQgaXQgdG8gdGhlIGxpc3Qgb2YgcGFya2VkIGl0ZW1z
IG9mIHRoZSBkb21haW4uCiAgICAgICovCi0gICAgX19zZXRfYml0KF9WUEZfcGFya2VkLCAmdi0+
cGF1c2VfZmxhZ3MpOwotICAgIGlmICggdmNwdV9vbl9ydW5xKHN2YykgKQorICAgIHNjaGVkX3Nl
dF9wYXVzZV9mbGFncyhpdGVtLCBfVlBGX3BhcmtlZCk7CisgICAgaWYgKCBpdGVtX29uX3J1bnEo
c3ZjKSApCiAgICAgewogICAgICAgICBydW5xX3JlbW92ZShzdmMpOwogICAgICAgICB1cGRhdGVf
bG9hZChzdmMtPnNkb20tPmRvbS0+Y3B1cG9vbC0+c2NoZWQsIHN2Yy0+cnFkLCBzdmMsIC0xLCBO
T1coKSk7CiAgICAgfQotICAgIGxpc3RfYWRkKCZzdmMtPnBhcmtlZF9lbGVtLCAmc3ZjLT5zZG9t
LT5wYXJrZWRfdmNwdXMpOworICAgIGxpc3RfYWRkKCZzdmMtPnBhcmtlZF9lbGVtLCAmc3ZjLT5z
ZG9tLT5wYXJrZWRfaXRlbXMpOwogfQogCi1zdGF0aWMgYm9vbCB2Y3B1X2dyYWJfYnVkZ2V0KHN0
cnVjdCBjc2NoZWQyX2l0ZW0gKnN2YykKK3N0YXRpYyBib29sIGl0ZW1fZ3JhYl9idWRnZXQoc3Ry
dWN0IGNzY2hlZDJfaXRlbSAqc3ZjKQogewogICAgIHN0cnVjdCBjc2NoZWQyX2RvbSAqc2RvbSA9
IHN2Yy0+c2RvbTsKLSAgICB1bnNpZ25lZCBpbnQgY3B1ID0gc3ZjLT52Y3B1LT5wcm9jZXNzb3I7
CisgICAgdW5zaWduZWQgaW50IGNwdSA9IHNjaGVkX2l0ZW1fY3B1KHN2Yy0+aXRlbSk7CiAKICAg
ICBBU1NFUlQoc3Bpbl9pc19sb2NrZWQocGVyX2NwdShzY2hlZF9yZXMsIGNwdSktPnNjaGVkdWxl
X2xvY2spKTsKIApAQCAtMTgwOCw5ICsxODA4LDkgQEAgc3RhdGljIGJvb2wgdmNwdV9ncmFiX2J1
ZGdldChzdHJ1Y3QgY3NjaGVkMl9pdGVtICpzdmMpCiAKICAgICAvKgogICAgICAqIEhlcmUsIHN2
Yy0+YnVkZ2V0IGlzIDw9IDAgKGFzLCBpZiBpdCB3YXMgPiAwLCB3ZSdkIGhhdmUgdGFrZW4gdGhl
IGlmCi0gICAgICogYWJvdmUhKS4gVGhhdCBiYXNpY2FsbHkgbWVhbnMgdGhlIHZDUFUgaGFzIG92
ZXJydW4gYSBiaXQgLS1iZWNhdXNlIG9mCisgICAgICogYWJvdmUhKS4gVGhhdCBiYXNpY2FsbHkg
bWVhbnMgdGhlIGl0ZW0gaGFzIG92ZXJydW4gYSBiaXQgLS1iZWNhdXNlIG9mCiAgICAgICogdmFy
aW91cyByZWFzb25zLS0gYW5kIHdlIHdhbnQgdG8gdGFrZSB0aGF0IGludG8gYWNjb3VudC4gV2l0
aCB0aGUgKz0sCi0gICAgICogd2UgYXJlIGFjdHVhbGx5IHN1YnRyYWN0aW5nIHRoZSBhbW91bnQg
b2YgYnVkZ2V0IHRoZSB2Q1BVIGhhcworICAgICAqIHdlIGFyZSBhY3R1YWxseSBzdWJ0cmFjdGlu
ZyB0aGUgYW1vdW50IG9mIGJ1ZGdldCB0aGUgaXRlbSBoYXMKICAgICAgKiBvdmVyY29uc3VtZWQs
IGZyb20gdGhlIHRvdGFsIGRvbWFpbiBidWRnZXQuCiAgICAgICovCiAgICAgc2RvbS0+YnVkZ2V0
ICs9IHN2Yy0+YnVkZ2V0OwpAQCAtMTgzMSw3ICsxODMxLDcgQEAgc3RhdGljIGJvb2wgdmNwdV9n
cmFiX2J1ZGdldChzdHJ1Y3QgY3NjaGVkMl9pdGVtICpzdmMpCiAgICAgZWxzZQogICAgIHsKICAg
ICAgICAgc3ZjLT5idWRnZXQgPSAwOwotICAgICAgICBwYXJrX3ZjcHUoc3ZjKTsKKyAgICAgICAg
cGFya19pdGVtKHN2Yyk7CiAgICAgfQogCiAgICAgc3Bpbl91bmxvY2soJnNkb20tPmJ1ZGdldF9s
b2NrKTsKQEAgLTE4NDAsMTAgKzE4NDAsMTAgQEAgc3RhdGljIGJvb2wgdmNwdV9ncmFiX2J1ZGdl
dChzdHJ1Y3QgY3NjaGVkMl9pdGVtICpzdmMpCiB9CiAKIHN0YXRpYyB2b2lkCi12Y3B1X3JldHVy
bl9idWRnZXQoc3RydWN0IGNzY2hlZDJfaXRlbSAqc3ZjLCBzdHJ1Y3QgbGlzdF9oZWFkICpwYXJr
ZWQpCitpdGVtX3JldHVybl9idWRnZXQoc3RydWN0IGNzY2hlZDJfaXRlbSAqc3ZjLCBzdHJ1Y3Qg
bGlzdF9oZWFkICpwYXJrZWQpCiB7CiAgICAgc3RydWN0IGNzY2hlZDJfZG9tICpzZG9tID0gc3Zj
LT5zZG9tOwotICAgIHVuc2lnbmVkIGludCBjcHUgPSBzdmMtPnZjcHUtPnByb2Nlc3NvcjsKKyAg
ICB1bnNpZ25lZCBpbnQgY3B1ID0gc2NoZWRfaXRlbV9jcHUoc3ZjLT5pdGVtKTsKIAogICAgIEFT
U0VSVChzcGluX2lzX2xvY2tlZChwZXJfY3B1KHNjaGVkX3JlcywgY3B1KS0+c2NoZWR1bGVfbG9j
aykpOwogICAgIEFTU0VSVChsaXN0X2VtcHR5KHBhcmtlZCkpOwpAQCAtMTg1Miw3ICsxODUyLDcg
QEAgdmNwdV9yZXR1cm5fYnVkZ2V0KHN0cnVjdCBjc2NoZWQyX2l0ZW0gKnN2Yywgc3RydWN0IGxp
c3RfaGVhZCAqcGFya2VkKQogICAgIHNwaW5fbG9jaygmc2RvbS0+YnVkZ2V0X2xvY2spOwogCiAg
ICAgLyoKLSAgICAgKiBUaGUgdkNQVSBpcyBzdG9wcGluZyBydW5uaW5nIChlLmcuLCBiZWNhdXNl
IGl0J3MgYmxvY2tpbmcsIG9yIGl0IGhhcworICAgICAqIFRoZSBpdGVtIGlzIHN0b3BwaW5nIHJ1
bm5pbmcgKGUuZy4sIGJlY2F1c2UgaXQncyBibG9ja2luZywgb3IgaXQgaGFzCiAgICAgICogYmVl
biBwcmVlbXB0ZWQpLiBJZiBpdCBoYXNuJ3QgY29uc3VtZWQgYWxsIHRoZSBidWRnZXQgaXQgZ290
IHdoZW4sCiAgICAgICogc3RhcnRpbmcgdG8gcnVuLCBwdXQgdGhhdCByZW1haW5pbmcgYW1vdW50
IGJhY2sgaW4gdGhlIGRvbWFpbidzIGJ1ZGdldAogICAgICAqIHBvb2wuCkBAIC0xODYxLDU4ICsx
ODYxLDU4IEBAIHZjcHVfcmV0dXJuX2J1ZGdldChzdHJ1Y3QgY3NjaGVkMl9pdGVtICpzdmMsIHN0
cnVjdCBsaXN0X2hlYWQgKnBhcmtlZCkKICAgICBzdmMtPmJ1ZGdldCA9IDA7CiAKICAgICAvKgot
ICAgICAqIE1ha2luZyBidWRnZXQgYXZhaWxhYmxlIGFnYWluIHRvIHRoZSBkb21haW4gbWVhbnMg
dGhhdCBwYXJrZWQgdkNQVXMKLSAgICAgKiBtYXkgYmUgdW5wYXJrZWQgYW5kIHJ1bi4gVGhleSBh
cmUsIGlmIGFueSwgaW4gdGhlIGRvbWFpbidzIHBhcmtlZF92Y3B1cworICAgICAqIE1ha2luZyBi
dWRnZXQgYXZhaWxhYmxlIGFnYWluIHRvIHRoZSBkb21haW4gbWVhbnMgdGhhdCBwYXJrZWQgaXRl
bXMKKyAgICAgKiBtYXkgYmUgdW5wYXJrZWQgYW5kIHJ1bi4gVGhleSBhcmUsIGlmIGFueSwgaW4g
dGhlIGRvbWFpbidzIHBhcmtlZF9pdGVtcwogICAgICAqIGxpc3QsIHNvIHdlIHdhbnQgdG8gZ28g
dGhyb3VnaCB0aGF0IGFuZCB1bnBhcmsgdGhlbSAoc28gdGhleSBjYW4gdHJ5CiAgICAgICogdG8g
Z2V0IHNvbWUgYnVkZ2V0KS4KICAgICAgKgogICAgICAqIFRvdWNoaW5nIHRoZSBsaXN0IHJlcXVp
cmVzIHRoZSBidWRnZXRfbG9jaywgd2hpY2ggd2UgaG9sZC4gTGV0J3MKICAgICAgKiB0aGVyZWZv
cmUgcHV0IGV2ZXJ5b25lIGluIHRoYXQgbGlzdCBpbiBhbm90aGVyLCB0ZW1wb3JhcnkgbGlzdCwg
d2hpY2gKLSAgICAgKiB0aGVuIHRoZSBjYWxsZXIgd2lsbCB0cmF2ZXJzZSwgdW5wYXJraW5nIHRo
ZSB2Q1BVcyBpdCBmaW5kcyB0aGVyZS4KKyAgICAgKiB0aGVuIHRoZSBjYWxsZXIgd2lsbCB0cmF2
ZXJzZSwgdW5wYXJraW5nIHRoZSBpdGVtcyBpdCBmaW5kcyB0aGVyZS4KICAgICAgKgogICAgICAq
IEluIGZhY3QsIHdlIGNhbid0IGRvIHRoZSBhY3R1YWwgdW5wYXJraW5nIGhlcmUsIGJlY2F1c2Ug
dGhhdCByZXF1aXJlcwotICAgICAqIHRha2luZyB0aGUgcnVucXVldWUgbG9jayBvZiB0aGUgdkNQ
VXMgYmVpbmcgdW5wYXJrZWQsIGFuZCB3ZSBjYW4ndAorICAgICAqIHRha2luZyB0aGUgcnVucXVl
dWUgbG9jayBvZiB0aGUgaXRlbXMgYmVpbmcgdW5wYXJrZWQsIGFuZCB3ZSBjYW4ndAogICAgICAq
IHRha2UgYW55IHJ1bnF1ZXVlIGxvY2tzIHdoaWxlIHdlIGhvbGQgYSBidWRnZXRfbG9jay4KICAg
ICAgKi8KICAgICBpZiAoIHNkb20tPmJ1ZGdldCA+IDAgKQotICAgICAgICBsaXN0X3NwbGljZV9p
bml0KCZzZG9tLT5wYXJrZWRfdmNwdXMsIHBhcmtlZCk7CisgICAgICAgIGxpc3Rfc3BsaWNlX2lu
aXQoJnNkb20tPnBhcmtlZF9pdGVtcywgcGFya2VkKTsKIAogICAgIHNwaW5fdW5sb2NrKCZzZG9t
LT5idWRnZXRfbG9jayk7CiB9CiAKIHN0YXRpYyB2b2lkCi11bnBhcmtfcGFya2VkX3ZjcHVzKGNv
bnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IGxpc3RfaGVhZCAqdmNwdXMpCit1bnBh
cmtfcGFya2VkX2l0ZW1zKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IGxpc3Rf
aGVhZCAqaXRlbXMpCiB7CiAgICAgc3RydWN0IGNzY2hlZDJfaXRlbSAqc3ZjLCAqdG1wOwogICAg
IHNwaW5sb2NrX3QgKmxvY2s7CiAKLSAgICBsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUoc3ZjLCB0
bXAsIHZjcHVzLCBwYXJrZWRfZWxlbSkKKyAgICBsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUoc3Zj
LCB0bXAsIGl0ZW1zLCBwYXJrZWRfZWxlbSkKICAgICB7CiAgICAgICAgIHVuc2lnbmVkIGxvbmcg
ZmxhZ3M7CiAgICAgICAgIHNfdGltZV90IG5vdzsKIAotICAgICAgICBsb2NrID0gaXRlbV9zY2hl
ZHVsZV9sb2NrX2lycXNhdmUoc3ZjLT52Y3B1LT5zY2hlZF9pdGVtLCAmZmxhZ3MpOworICAgICAg
ICBsb2NrID0gaXRlbV9zY2hlZHVsZV9sb2NrX2lycXNhdmUoc3ZjLT5pdGVtLCAmZmxhZ3MpOwog
Ci0gICAgICAgIF9fY2xlYXJfYml0KF9WUEZfcGFya2VkLCAmc3ZjLT52Y3B1LT5wYXVzZV9mbGFn
cyk7CisgICAgICAgIHNjaGVkX2NsZWFyX3BhdXNlX2ZsYWdzKHN2Yy0+aXRlbSwgX1ZQRl9wYXJr
ZWQpOwogICAgICAgICBpZiAoIHVubGlrZWx5KHN2Yy0+ZmxhZ3MgJiBDU0ZMQUdfc2NoZWR1bGVk
KSApCiAgICAgICAgIHsKICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgKiBXZSBlbmQgaGVy
ZSBpZiBhIGJ1ZGdldCByZXBsZW5pc2htZW50IGFycml2ZWQgYmV0d2VlbgogICAgICAgICAgICAg
ICogY3NjaGVkMl9zY2hlZHVsZSgpIChhbmQsIGluIHBhcnRpY3VsYXIsIGFmdGVyIGEgY2FsbCB0
bwotICAgICAgICAgICAgICogdmNwdV9ncmFiX2J1ZGdldCgpIHRoYXQgcmV0dXJuZWQgZmFsc2Up
LCBhbmQKKyAgICAgICAgICAgICAqIGl0ZW1fZ3JhYl9idWRnZXQoKSB0aGF0IHJldHVybmVkIGZh
bHNlKSwgYW5kCiAgICAgICAgICAgICAgKiBjb250ZXh0X3NhdmVkKCkuIEJ5IHNldHRpbmcgX19D
U0ZMQUdfZGVsYXllZF9ydW5xX2FkZCwKLSAgICAgICAgICAgICAqIHdlIHRlbGwgY29udGV4dF9z
YXZlZCgpIHRvIHB1dCB0aGUgdkNQVSBiYWNrIGluIHRoZQorICAgICAgICAgICAgICogd2UgdGVs
bCBjb250ZXh0X3NhdmVkKCkgdG8gcHV0IHRoZSBpdGVtIGJhY2sgaW4gdGhlCiAgICAgICAgICAg
ICAgKiBydW5xdWV1ZSwgZnJvbSB3aGVyZSBpdCB3aWxsIGNvbXBldGUgd2l0aCB0aGUgb3RoZXJz
CiAgICAgICAgICAgICAgKiBmb3IgdGhlIG5ld2x5IHJlcGxlbmlzaGVkIGJ1ZGdldC4KICAgICAg
ICAgICAgICAqLwogICAgICAgICAgICAgQVNTRVJUKCBzdmMtPnJxZCAhPSBOVUxMICk7Ci0gICAg
ICAgICAgICBBU1NFUlQoIGMycnFkKG9wcywgc3ZjLT52Y3B1LT5wcm9jZXNzb3IpID09IHN2Yy0+
cnFkICk7CisgICAgICAgICAgICBBU1NFUlQoIGMycnFkKG9wcywgc2NoZWRfaXRlbV9jcHUoc3Zj
LT5pdGVtKSkgPT0gc3ZjLT5ycWQgKTsKICAgICAgICAgICAgIF9fc2V0X2JpdChfX0NTRkxBR19k
ZWxheWVkX3J1bnFfYWRkLCAmc3ZjLT5mbGFncyk7CiAgICAgICAgIH0KLSAgICAgICAgZWxzZSBp
ZiAoIHZjcHVfcnVubmFibGUoc3ZjLT52Y3B1KSApCisgICAgICAgIGVsc2UgaWYgKCBpdGVtX3J1
bm5hYmxlKHN2Yy0+aXRlbSkgKQogICAgICAgICB7CiAgICAgICAgICAgICAvKgotICAgICAgICAg
ICAgICogVGhlIHZDUFUgc2hvdWxkIGdvIGJhY2sgdG8gdGhlIHJ1bnF1ZXVlLCBhbmQgY29tcGV0
ZSBmb3IKKyAgICAgICAgICAgICAqIFRoZSBpdGVtIHNob3VsZCBnbyBiYWNrIHRvIHRoZSBydW5x
dWV1ZSwgYW5kIGNvbXBldGUgZm9yCiAgICAgICAgICAgICAgKiB0aGUgbmV3bHkgcmVwbGVuaXNo
ZWQgYnVkZ2V0LCBidXQgb25seSBpZiBpdCBpcyBhY3R1YWxseQogICAgICAgICAgICAgICogcnVu
bmFibGUgKGFuZCB3YXMgdGhlcmVmb3JlIG9mZmxpbmUgb25seSBiZWNhdXNlIG9mIHRoZQogICAg
ICAgICAgICAgICogbGFjayBvZiBidWRnZXQpLgpAQCAtMTkyNCw3ICsxOTI0LDcgQEAgdW5wYXJr
X3BhcmtlZF92Y3B1cyhjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBsaXN0X2hl
YWQgKnZjcHVzKQogICAgICAgICB9CiAgICAgICAgIGxpc3RfZGVsX2luaXQoJnN2Yy0+cGFya2Vk
X2VsZW0pOwogCi0gICAgICAgIGl0ZW1fc2NoZWR1bGVfdW5sb2NrX2lycXJlc3RvcmUobG9jaywg
ZmxhZ3MsIHN2Yy0+dmNwdS0+c2NoZWRfaXRlbSk7CisgICAgICAgIGl0ZW1fc2NoZWR1bGVfdW5s
b2NrX2lycXJlc3RvcmUobG9jaywgZmxhZ3MsIHN2Yy0+aXRlbSk7CiAgICAgfQogfQogCkBAIC0x
OTU0LDcgKzE5NTQsNyBAQCBzdGF0aWMgdm9pZCByZXBsZW5pc2hfZG9tYWluX2J1ZGdldCh2b2lk
KiBkYXRhKQogICAgICAqCiAgICAgICogRXZlbiBpbiBjYXNlcyBvZiBvdmVycnVuIG9yIGRlbGF5
LCBob3dldmVyLCB3ZSBleHBlY3QgdGhhdCBpbiA5OSUgb2YKICAgICAgKiBjYXNlcywgZG9pbmcg
anVzdCBvbmUgcmVwbGVuaXNobWVudCB3aWxsIGJlIGdvb2QgZW5vdWdoIGZvciBiZWluZyBhYmxl
Ci0gICAgICogdG8gdW5wYXJrIHRoZSB2Q1BVcyB0aGF0IGFyZSB3YWl0aW5nIGZvciBzb21lIGJ1
ZGdldC4KKyAgICAgKiB0byB1bnBhcmsgdGhlIGl0ZW1zIHRoYXQgYXJlIHdhaXRpbmcgZm9yIHNv
bWUgYnVkZ2V0LgogICAgICAqLwogICAgIGRvX3JlcGxlbmlzaChzZG9tKTsKIApAQCAtMTk3NCw3
ICsxOTc0LDcgQEAgc3RhdGljIHZvaWQgcmVwbGVuaXNoX2RvbWFpbl9idWRnZXQodm9pZCogZGF0
YSkKICAgICB9CiAgICAgLyoKICAgICAgKiAyKSBpZiB3ZSBvdmVycnVuIGJ5IG1vcmUgdGhhbiB0
b3RfYnVkZ2V0LCB0aGVuIGJ1ZGdldCt0b3RfYnVkZ2V0IGlzCi0gICAgICogc3RpbGwgPCAwLCB3
aGljaCBtZWFucyB0aGF0IHdlIGNhbid0IHVucGFyayB0aGUgdkNQVXMuIExldCdzIGJhaWwsCisg
ICAgICogc3RpbGwgPCAwLCB3aGljaCBtZWFucyB0aGF0IHdlIGNhbid0IHVucGFyayB0aGUgaXRl
bXMuIExldCdzIGJhaWwsCiAgICAgICogYW5kIHdhaXQgZm9yIGZ1dHVyZSByZXBsZW5pc2htZW50
cy4KICAgICAgKi8KICAgICBpZiAoIHVubGlrZWx5KHNkb20tPmJ1ZGdldCA8PSAwKSApCkBAIC0x
OTg4LDE0ICsxOTg4LDE0IEBAIHN0YXRpYyB2b2lkIHJlcGxlbmlzaF9kb21haW5fYnVkZ2V0KHZv
aWQqIGRhdGEpCiAKICAgICAvKgogICAgICAqIEFzIGFib3ZlLCBsZXQncyBwcmVwYXJlIHRoZSB0
ZW1wb3JhcnkgbGlzdCwgb3V0IG9mIHRoZSBkb21haW4ncwotICAgICAqIHBhcmtlZF92Y3B1cyBs
aXN0LCBub3cgdGhhdCB3ZSBob2xkIHRoZSBidWRnZXRfbG9jay4gVGhlbiwgZHJvcCBzdWNoCisg
ICAgICogcGFya2VkX2l0ZW1zIGxpc3QsIG5vdyB0aGF0IHdlIGhvbGQgdGhlIGJ1ZGdldF9sb2Nr
LiBUaGVuLCBkcm9wIHN1Y2gKICAgICAgKiBsb2NrLCBhbmQgcGFzcyB0aGUgbGlzdCB0byB0aGUg
dW5wYXJraW5nIGZ1bmN0aW9uLgogICAgICAqLwotICAgIGxpc3Rfc3BsaWNlX2luaXQoJnNkb20t
PnBhcmtlZF92Y3B1cywgJnBhcmtlZCk7CisgICAgbGlzdF9zcGxpY2VfaW5pdCgmc2RvbS0+cGFy
a2VkX2l0ZW1zLCAmcGFya2VkKTsKIAogICAgIHNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnNkb20t
PmJ1ZGdldF9sb2NrLCBmbGFncyk7CiAKLSAgICB1bnBhcmtfcGFya2VkX3ZjcHVzKHNkb20tPmRv
bS0+Y3B1cG9vbC0+c2NoZWQsICZwYXJrZWQpOworICAgIHVucGFya19wYXJrZWRfaXRlbXMoc2Rv
bS0+ZG9tLT5jcHVwb29sLT5zY2hlZCwgJnBhcmtlZCk7CiAKICBvdXQ6CiAgICAgc2V0X3RpbWVy
KCZzZG9tLT5yZXBsX3RpbWVyLCBzZG9tLT5uZXh0X3JlcGwpOwpAQCAtMjAwMywzNyArMjAwMywz
NiBAQCBzdGF0aWMgdm9pZCByZXBsZW5pc2hfZG9tYWluX2J1ZGdldCh2b2lkKiBkYXRhKQogCiAj
aWZuZGVmIE5ERUJVRwogc3RhdGljIGlubGluZSB2b2lkCi1jc2NoZWQyX3ZjcHVfY2hlY2soc3Ry
dWN0IHZjcHUgKnZjKQorY3NjaGVkMl9pdGVtX2NoZWNrKHN0cnVjdCBzY2hlZF9pdGVtICppdGVt
KQogewotICAgIHN0cnVjdCBjc2NoZWQyX2l0ZW0gKiBjb25zdCBzdmMgPSBjc2NoZWQyX2l0ZW0o
dmMtPnNjaGVkX2l0ZW0pOworICAgIHN0cnVjdCBjc2NoZWQyX2l0ZW0gKiBjb25zdCBzdmMgPSBj
c2NoZWQyX2l0ZW0oaXRlbSk7CiAgICAgc3RydWN0IGNzY2hlZDJfZG9tICogY29uc3Qgc2RvbSA9
IHN2Yy0+c2RvbTsKIAotICAgIEJVR19PTiggc3ZjLT52Y3B1ICE9IHZjICk7Ci0gICAgQlVHX09O
KCBzZG9tICE9IGNzY2hlZDJfZG9tKHZjLT5kb21haW4pICk7CisgICAgQlVHX09OKCBzdmMtPml0
ZW0gIT0gaXRlbSApOworICAgIEJVR19PTiggc2RvbSAhPSBjc2NoZWQyX2RvbShpdGVtLT5kb21h
aW4pICk7CiAgICAgaWYgKCBzZG9tICkKICAgICB7Ci0gICAgICAgIEJVR19PTiggaXNfaWRsZV92
Y3B1KHZjKSApOwotICAgICAgICBCVUdfT04oIHNkb20tPmRvbSAhPSB2Yy0+ZG9tYWluICk7Cisg
ICAgICAgIEJVR19PTiggaXNfaWRsZV9pdGVtKGl0ZW0pICk7CisgICAgICAgIEJVR19PTiggc2Rv
bS0+ZG9tICE9IGl0ZW0tPmRvbWFpbiApOwogICAgIH0KICAgICBlbHNlCiAgICAgewotICAgICAg
ICBCVUdfT04oICFpc19pZGxlX3ZjcHUodmMpICk7CisgICAgICAgIEJVR19PTiggIWlzX2lkbGVf
aXRlbShpdGVtKSApOwogICAgIH0KICAgICBTQ0hFRF9TVEFUX0NSQU5LKGl0ZW1fY2hlY2spOwog
fQotI2RlZmluZSBDU0NIRUQyX1ZDUFVfQ0hFQ0soX3ZjKSAgKGNzY2hlZDJfdmNwdV9jaGVjayhf
dmMpKQorI2RlZmluZSBDU0NIRUQyX0lURU1fQ0hFQ0soaXRlbSkgIChjc2NoZWQyX2l0ZW1fY2hl
Y2soaXRlbSkpCiAjZWxzZQotI2RlZmluZSBDU0NIRUQyX1ZDUFVfQ0hFQ0soX3ZjKQorI2RlZmlu
ZSBDU0NIRUQyX0lURU1fQ0hFQ0soaXRlbSkKICNlbmRpZgogCiBzdGF0aWMgdm9pZCAqCiBjc2No
ZWQyX2FsbG9jX3ZkYXRhKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVk
X2l0ZW0gKml0ZW0sCiAgICAgICAgICAgICAgICAgICAgIHZvaWQgKmRkKQogewotICAgIHN0cnVj
dCB2Y3B1ICp2YyA9IGl0ZW0tPnZjcHU7CiAgICAgc3RydWN0IGNzY2hlZDJfaXRlbSAqc3ZjOwog
Ci0gICAgLyogQWxsb2NhdGUgcGVyLVZDUFUgaW5mbyAqLworICAgIC8qIEFsbG9jYXRlIHBlci1J
VEVNIGluZm8gKi8KICAgICBzdmMgPSB4emFsbG9jKHN0cnVjdCBjc2NoZWQyX2l0ZW0pOwogICAg
IGlmICggc3ZjID09IE5VTEwgKQogICAgICAgICByZXR1cm4gTlVMTDsKQEAgLTIwNDIsMTAgKzIw
NDEsMTAgQEAgY3NjaGVkMl9hbGxvY192ZGF0YShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMs
IHN0cnVjdCBzY2hlZF9pdGVtICppdGVtLAogICAgIElOSVRfTElTVF9IRUFEKCZzdmMtPnJ1bnFf
ZWxlbSk7CiAKICAgICBzdmMtPnNkb20gPSBkZDsKLSAgICBzdmMtPnZjcHUgPSB2YzsKKyAgICBz
dmMtPml0ZW0gPSBpdGVtOwogICAgIHN2Yy0+ZmxhZ3MgPSAwVTsKIAotICAgIGlmICggISBpc19p
ZGxlX3ZjcHUodmMpICkKKyAgICBpZiAoICEgaXNfaWRsZV9pdGVtKGl0ZW0pICkKICAgICB7CiAg
ICAgICAgIEFTU0VSVChzdmMtPnNkb20gIT0gTlVMTCk7CiAgICAgICAgIHN2Yy0+Y3JlZGl0ID0g
Q1NDSEVEMl9DUkVESVRfSU5JVDsKQEAgLTIwNzQsMTkgKzIwNzMsMTggQEAgY3NjaGVkMl9hbGxv
Y192ZGF0YShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF9pdGVtICpp
dGVtLAogc3RhdGljIHZvaWQKIGNzY2hlZDJfaXRlbV9zbGVlcChjb25zdCBzdHJ1Y3Qgc2NoZWR1
bGVyICpvcHMsIHN0cnVjdCBzY2hlZF9pdGVtICppdGVtKQogewotICAgIHN0cnVjdCB2Y3B1ICp2
YyA9IGl0ZW0tPnZjcHU7CiAgICAgc3RydWN0IGNzY2hlZDJfaXRlbSAqIGNvbnN0IHN2YyA9IGNz
Y2hlZDJfaXRlbShpdGVtKTsKIAotICAgIEFTU0VSVCghaXNfaWRsZV92Y3B1KHZjKSk7CisgICAg
QVNTRVJUKCFpc19pZGxlX2l0ZW0oaXRlbSkpOwogICAgIFNDSEVEX1NUQVRfQ1JBTksoaXRlbV9z
bGVlcCk7CiAKLSAgICBpZiAoIGN1cnJfb25fY3B1KHZjLT5wcm9jZXNzb3IpID09IGl0ZW0gKQor
ICAgIGlmICggY3Vycl9vbl9jcHUoc2NoZWRfaXRlbV9jcHUoaXRlbSkpID09IGl0ZW0gKQogICAg
IHsKLSAgICAgICAgdGlja2xlX2NwdSh2Yy0+cHJvY2Vzc29yLCBzdmMtPnJxZCk7CisgICAgICAg
IHRpY2tsZV9jcHUoc2NoZWRfaXRlbV9jcHUoaXRlbSksIHN2Yy0+cnFkKTsKICAgICB9Ci0gICAg
ZWxzZSBpZiAoIHZjcHVfb25fcnVucShzdmMpICkKKyAgICBlbHNlIGlmICggaXRlbV9vbl9ydW5x
KHN2YykgKQogICAgIHsKLSAgICAgICAgQVNTRVJUKHN2Yy0+cnFkID09IGMycnFkKG9wcywgdmMt
PnByb2Nlc3NvcikpOworICAgICAgICBBU1NFUlQoc3ZjLT5ycWQgPT0gYzJycWQob3BzLCBzY2hl
ZF9pdGVtX2NwdShpdGVtKSkpOwogICAgICAgICB1cGRhdGVfbG9hZChvcHMsIHN2Yy0+cnFkLCBz
dmMsIC0xLCBOT1coKSk7CiAgICAgICAgIHJ1bnFfcmVtb3ZlKHN2Yyk7CiAgICAgfQpAQCAtMjA5
NywxNCArMjA5NSwxMyBAQCBjc2NoZWQyX2l0ZW1fc2xlZXAoY29uc3Qgc3RydWN0IHNjaGVkdWxl
ciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfaXRlbSAqaXRlbSkKIHN0YXRpYyB2b2lkCiBjc2NoZWQyX2l0
ZW1fd2FrZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF9pdGVtICpp
dGVtKQogewotICAgIHN0cnVjdCB2Y3B1ICp2YyA9IGl0ZW0tPnZjcHU7CiAgICAgc3RydWN0IGNz
Y2hlZDJfaXRlbSAqIGNvbnN0IHN2YyA9IGNzY2hlZDJfaXRlbShpdGVtKTsKLSAgICB1bnNpZ25l
ZCBpbnQgY3B1ID0gdmMtPnByb2Nlc3NvcjsKKyAgICB1bnNpZ25lZCBpbnQgY3B1ID0gc2NoZWRf
aXRlbV9jcHUoaXRlbSk7CiAgICAgc190aW1lX3Qgbm93OwogCiAgICAgQVNTRVJUKHNwaW5faXNf
bG9ja2VkKHBlcl9jcHUoc2NoZWRfcmVzLCBjcHUpLT5zY2hlZHVsZV9sb2NrKSk7CiAKLSAgICBB
U1NFUlQoIWlzX2lkbGVfdmNwdSh2YykpOworICAgIEFTU0VSVCghaXNfaWRsZV9pdGVtKGl0ZW0p
KTsKIAogICAgIGlmICggdW5saWtlbHkoY3Vycl9vbl9jcHUoY3B1KSA9PSBpdGVtKSApCiAgICAg
ewpAQCAtMjExMiwxOCArMjEwOSwxOCBAQCBjc2NoZWQyX2l0ZW1fd2FrZShjb25zdCBzdHJ1Y3Qg
c2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF9pdGVtICppdGVtKQogICAgICAgICBnb3RvIG91
dDsKICAgICB9CiAKLSAgICBpZiAoIHVubGlrZWx5KHZjcHVfb25fcnVucShzdmMpKSApCisgICAg
aWYgKCB1bmxpa2VseShpdGVtX29uX3J1bnEoc3ZjKSkgKQogICAgIHsKICAgICAgICAgU0NIRURf
U1RBVF9DUkFOSyhpdGVtX3dha2Vfb25ydW5xKTsKICAgICAgICAgZ290byBvdXQ7CiAgICAgfQog
Ci0gICAgaWYgKCBsaWtlbHkodmNwdV9ydW5uYWJsZSh2YykpICkKKyAgICBpZiAoIGxpa2VseShp
dGVtX3J1bm5hYmxlKGl0ZW0pKSApCiAgICAgICAgIFNDSEVEX1NUQVRfQ1JBTksoaXRlbV93YWtl
X3J1bm5hYmxlKTsKICAgICBlbHNlCiAgICAgICAgIFNDSEVEX1NUQVRfQ1JBTksoaXRlbV93YWtl
X25vdF9ydW5uYWJsZSk7CiAKLSAgICAvKiBJZiB0aGUgY29udGV4dCBoYXNuJ3QgYmVlbiBzYXZl
ZCBmb3IgdGhpcyB2Y3B1IHlldCwgd2UgY2FuJ3QgcHV0IGl0IG9uCisgICAgLyogSWYgdGhlIGNv
bnRleHQgaGFzbid0IGJlZW4gc2F2ZWQgZm9yIHRoaXMgaXRlbSB5ZXQsIHdlIGNhbid0IHB1dCBp
dCBvbgogICAgICAqIGFub3RoZXIgcnVucXVldWUuICBJbnN0ZWFkLCB3ZSBzZXQgYSBmbGFnIHNv
IHRoYXQgaXQgd2lsbCBiZSBwdXQgb24gdGhlIHJ1bnF1ZXVlCiAgICAgICogYWZ0ZXIgdGhlIGNv
bnRleHQgaGFzIGJlZW4gc2F2ZWQuICovCiAgICAgaWYgKCB1bmxpa2VseShzdmMtPmZsYWdzICYg
Q1NGTEFHX3NjaGVkdWxlZCkgKQpAQCAtMjEzNCwxNSArMjEzMSwxNSBAQCBjc2NoZWQyX2l0ZW1f
d2FrZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF9pdGVtICppdGVt
KQogCiAgICAgLyogQWRkIGludG8gdGhlIG5ldyBydW5xdWV1ZSBpZiBuZWNlc3NhcnkgKi8KICAg
ICBpZiAoIHN2Yy0+cnFkID09IE5VTEwgKQotICAgICAgICBydW5xX2Fzc2lnbihvcHMsIHZjKTsK
KyAgICAgICAgcnVucV9hc3NpZ24ob3BzLCBpdGVtKTsKICAgICBlbHNlCi0gICAgICAgIEFTU0VS
VChjMnJxZChvcHMsIHZjLT5wcm9jZXNzb3IpID09IHN2Yy0+cnFkICk7CisgICAgICAgIEFTU0VS
VChjMnJxZChvcHMsIHNjaGVkX2l0ZW1fY3B1KGl0ZW0pKSA9PSBzdmMtPnJxZCApOwogCiAgICAg
bm93ID0gTk9XKCk7CiAKICAgICB1cGRhdGVfbG9hZChvcHMsIHN2Yy0+cnFkLCBzdmMsIDEsIG5v
dyk7Ci0gICAgICAgIAotICAgIC8qIFB1dCB0aGUgVkNQVSBvbiB0aGUgcnVucSAqLworCisgICAg
LyogUHV0IHRoZSBJVEVNIG9uIHRoZSBydW5xICovCiAgICAgcnVucV9pbnNlcnQob3BzLCBzdmMp
OwogICAgIHJ1bnFfdGlja2xlKG9wcywgc3ZjLCBub3cpOwogCkBAIC0yMTU1LDQ5ICsyMTUyLDQ4
IEBAIGNzY2hlZDJfaXRlbV95aWVsZChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVj
dCBzY2hlZF9pdGVtICppdGVtKQogewogICAgIHN0cnVjdCBjc2NoZWQyX2l0ZW0gKiBjb25zdCBz
dmMgPSBjc2NoZWQyX2l0ZW0oaXRlbSk7CiAKLSAgICBfX3NldF9iaXQoX19DU0ZMQUdfdmNwdV95
aWVsZCwgJnN2Yy0+ZmxhZ3MpOworICAgIF9fc2V0X2JpdChfX0NTRkxBR19pdGVtX3lpZWxkLCAm
c3ZjLT5mbGFncyk7CiB9CiAKIHN0YXRpYyB2b2lkCiBjc2NoZWQyX2NvbnRleHRfc2F2ZWQoY29u
c3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfaXRlbSAqaXRlbSkKIHsKLSAg
ICBzdHJ1Y3QgdmNwdSAqdmMgPSBpdGVtLT52Y3B1OwogICAgIHN0cnVjdCBjc2NoZWQyX2l0ZW0g
KiBjb25zdCBzdmMgPSBjc2NoZWQyX2l0ZW0oaXRlbSk7CiAgICAgc3BpbmxvY2tfdCAqbG9jayA9
IGl0ZW1fc2NoZWR1bGVfbG9ja19pcnEoaXRlbSk7CiAgICAgc190aW1lX3Qgbm93ID0gTk9XKCk7
CiAgICAgTElTVF9IRUFEKHdlcmVfcGFya2VkKTsKIAotICAgIEJVR19PTiggIWlzX2lkbGVfdmNw
dSh2YykgJiYgc3ZjLT5ycWQgIT0gYzJycWQob3BzLCB2Yy0+cHJvY2Vzc29yKSk7Ci0gICAgQVNT
RVJUKGlzX2lkbGVfdmNwdSh2YykgfHwgc3ZjLT5ycWQgPT0gYzJycWQob3BzLCB2Yy0+cHJvY2Vz
c29yKSk7CisgICAgQlVHX09OKCAhaXNfaWRsZV9pdGVtKGl0ZW0pICYmIHN2Yy0+cnFkICE9IGMy
cnFkKG9wcywgc2NoZWRfaXRlbV9jcHUoaXRlbSkpKTsKKyAgICBBU1NFUlQoaXNfaWRsZV9pdGVt
KGl0ZW0pIHx8IHN2Yy0+cnFkID09IGMycnFkKG9wcywgc2NoZWRfaXRlbV9jcHUoaXRlbSkpKTsK
IAotICAgIC8qIFRoaXMgdmNwdSBpcyBub3cgZWxpZ2libGUgdG8gYmUgcHV0IG9uIHRoZSBydW5x
dWV1ZSBhZ2FpbiAqLworICAgIC8qIFRoaXMgaXRlbSBpcyBub3cgZWxpZ2libGUgdG8gYmUgcHV0
IG9uIHRoZSBydW5xdWV1ZSBhZ2FpbiAqLwogICAgIF9fY2xlYXJfYml0KF9fQ1NGTEFHX3NjaGVk
dWxlZCwgJnN2Yy0+ZmxhZ3MpOwogCiAgICAgaWYgKCB1bmxpa2VseShoYXNfY2FwKHN2YykgJiYg
c3ZjLT5idWRnZXQgPiAwKSApCi0gICAgICAgIHZjcHVfcmV0dXJuX2J1ZGdldChzdmMsICZ3ZXJl
X3BhcmtlZCk7CisgICAgICAgIGl0ZW1fcmV0dXJuX2J1ZGdldChzdmMsICZ3ZXJlX3BhcmtlZCk7
CiAKICAgICAvKiBJZiBzb21lb25lIHdhbnRzIGl0IG9uIHRoZSBydW5xdWV1ZSwgcHV0IGl0IHRo
ZXJlLiAqLwogICAgIC8qCiAgICAgICogTkI6IFdlIGNhbiBnZXQgcmlkIG9mIENTRkxBR19zY2hl
ZHVsZWQgYnkgY2hlY2tpbmcgZm9yCi0gICAgICogdmMtPmlzX3J1bm5pbmcgYW5kIHZjcHVfb25f
cnVucShzdmMpIGhlcmUuICBIb3dldmVyLAorICAgICAqIHZjLT5pc19ydW5uaW5nIGFuZCBpdGVt
X29uX3J1bnEoc3ZjKSBoZXJlLiAgSG93ZXZlciwKICAgICAgKiBzaW5jZSB3ZSdyZSBhY2Nlc3Np
bmcgdGhlIGZsYWdzIGNhY2hlbGluZSBhbnl3YXksCiAgICAgICogaXQgc2VlbXMgYSBiaXQgcG9p
bnRsZXNzOyBlc3BlY2lhbGx5IGFzIHdlIGhhdmUgcGxlbnR5IG9mCiAgICAgICogYml0cyBmcmVl
LgogICAgICAqLwogICAgIGlmICggX190ZXN0X2FuZF9jbGVhcl9iaXQoX19DU0ZMQUdfZGVsYXll
ZF9ydW5xX2FkZCwgJnN2Yy0+ZmxhZ3MpCi0gICAgICAgICAmJiBsaWtlbHkodmNwdV9ydW5uYWJs
ZSh2YykpICkKKyAgICAgICAgICYmIGxpa2VseShpdGVtX3J1bm5hYmxlKGl0ZW0pKSApCiAgICAg
ewotICAgICAgICBBU1NFUlQoIXZjcHVfb25fcnVucShzdmMpKTsKKyAgICAgICAgQVNTRVJUKCFp
dGVtX29uX3J1bnEoc3ZjKSk7CiAKICAgICAgICAgcnVucV9pbnNlcnQob3BzLCBzdmMpOwogICAg
ICAgICBydW5xX3RpY2tsZShvcHMsIHN2Yywgbm93KTsKICAgICB9Ci0gICAgZWxzZSBpZiAoICFp
c19pZGxlX3ZjcHUodmMpICkKKyAgICBlbHNlIGlmICggIWlzX2lkbGVfaXRlbShpdGVtKSApCiAg
ICAgICAgIHVwZGF0ZV9sb2FkKG9wcywgc3ZjLT5ycWQsIHN2YywgLTEsIG5vdyk7CiAKICAgICBp
dGVtX3NjaGVkdWxlX3VubG9ja19pcnEobG9jaywgaXRlbSk7CiAKLSAgICB1bnBhcmtfcGFya2Vk
X3ZjcHVzKG9wcywgJndlcmVfcGFya2VkKTsKKyAgICB1bnBhcmtfcGFya2VkX2l0ZW1zKG9wcywg
JndlcmVfcGFya2VkKTsKIH0KIAogI2RlZmluZSBNQVhfTE9BRCAoU1RJTUVfTUFYKQpAQCAtMjIw
NSw5ICsyMjAxLDggQEAgc3RhdGljIHN0cnVjdCBzY2hlZF9yZXNvdXJjZSAqCiBjc2NoZWQyX3Jl
c19waWNrKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX2l0ZW0gKml0
ZW0pCiB7CiAgICAgc3RydWN0IGNzY2hlZDJfcHJpdmF0ZSAqcHJ2ID0gY3NjaGVkMl9wcml2KG9w
cyk7Ci0gICAgc3RydWN0IHZjcHUgKnZjID0gaXRlbS0+dmNwdTsKICAgICBpbnQgaSwgbWluX3Jx
aSA9IC0xLCBtaW5fc19ycWkgPSAtMTsKLSAgICB1bnNpZ25lZCBpbnQgbmV3X2NwdSwgY3B1ID0g
dmMtPnByb2Nlc3NvcjsKKyAgICB1bnNpZ25lZCBpbnQgbmV3X2NwdSwgY3B1ID0gc2NoZWRfaXRl
bV9jcHUoaXRlbSk7CiAgICAgc3RydWN0IGNzY2hlZDJfaXRlbSAqc3ZjID0gY3NjaGVkMl9pdGVt
KGl0ZW0pOwogICAgIHNfdGltZV90IG1pbl9hdmdsb2FkID0gTUFYX0xPQUQsIG1pbl9zX2F2Z2xv
YWQgPSBNQVhfTE9BRDsKICAgICBib29sIGhhc19zb2Z0OwpAQCAtMjI0NSw3ICsyMjQwLDcgQEAg
Y3NjaGVkMl9yZXNfcGljayhjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hl
ZF9pdGVtICppdGVtKQogICAgIH0KIAogICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9j
cHUoY3B1KSwgaXRlbS0+Y3B1X2hhcmRfYWZmaW5pdHksCi0gICAgICAgICAgICAgICAgY3B1cG9v
bF9kb21haW5fY3B1bWFzayh2Yy0+ZG9tYWluKSk7CisgICAgICAgICAgICAgICAgY3B1cG9vbF9k
b21haW5fY3B1bWFzayhpdGVtLT5kb21haW4pKTsKIAogICAgIC8qCiAgICAgICogRmlyc3QgY2hl
Y2sgdG8gc2VlIGlmIHdlJ3JlIGhlcmUgYmVjYXVzZSBzb21lb25lIGVsc2Ugc3VnZ2VzdGVkIGEg
cGxhY2UKQEAgLTIzNTYsNyArMjM1MSw3IEBAIGNzY2hlZDJfcmVzX3BpY2soY29uc3Qgc3RydWN0
IHNjaGVkdWxlciAqb3BzLCBzdHJ1Y3Qgc2NoZWRfaXRlbSAqaXRlbSkKICAgICAgICAgICogV2Ug
aGF2ZSBzb2Z0IGFmZmluaXR5LCBhbmQgd2UgaGF2ZSBhIGNhbmRpZGF0ZSBydW5xLCBzbyBnbyBm
b3IgaXQuCiAgICAgICAgICAqCiAgICAgICAgICAqIE5vdGUgdGhhdCwgdG8gb2J0YWluIHRoZSBz
b2Z0LWFmZmluaXR5IG1hc2ssIHdlICJqdXN0IiBwdXQgd2hhdCB3ZQotICAgICAgICAgKiBoYXZl
IGluIGNwdW1hc2tfc2NyYXRjaCBpbiAmJiB3aXRoIHZjLT5jcHVfc29mdF9hZmZpbml0eS4gVGhp
cyBpcworICAgICAgICAgKiBoYXZlIGluIGNwdW1hc2tfc2NyYXRjaCBpbiAmJiB3aXRoIGl0ZW0t
PmNwdV9zb2Z0X2FmZmluaXR5LiBUaGlzIGlzCiAgICAgICAgICAqIG9rIGJlY2F1c2U6CiAgICAg
ICAgICAqIC0gd2Uga25vdyB0aGF0IGl0ZW0tPmNwdV9oYXJkX2FmZmluaXR5IGFuZCAtPmNwdV9z
b2Z0X2FmZmluaXR5IGhhdmUKICAgICAgICAgICogICBhIG5vbi1lbXB0eSBpbnRlcnNlY3Rpb24g
KGJlY2F1c2UgaGFzX3NvZnQgaXMgdHJ1ZSk7CkBAIC0yMzc5LDcgKzIzNzQsNyBAQCBjc2NoZWQy
X3Jlc19waWNrKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX2l0ZW0g
Kml0ZW0pCiAgICAgICAgICAqIGFueSBzdWl0YWJsZSBydW5xLiBCdXQgd2UgZGlkIGZpbmQgb25l
IHdoZW4gY29uc2lkZXJpbmcgaGFyZAogICAgICAgICAgKiBhZmZpbml0eSwgc28gZ28gZm9yIGl0
LgogICAgICAgICAgKgotICAgICAgICAgKiBjcHVtYXNrX3NjcmF0Y2ggYWxyZWFkeSBoYXMgdmMt
PmNwdV9oYXJkX2FmZmluaXR5ICYKKyAgICAgICAgICogY3B1bWFza19zY3JhdGNoIGFscmVhZHkg
aGFzIGl0ZW0tPmNwdV9oYXJkX2FmZmluaXR5ICYKICAgICAgICAgICogY3B1cG9vbF9kb21haW5f
Y3B1bWFzaygpIGluIGl0LCBzbyBpdCdzIGVub3VnaCB0aGF0IHdlIGZpbHRlcgogICAgICAgICAg
KiB3aXRoIHRoZSBjcHVzIG9mIHRoZSBydW5xLgogICAgICAgICAgKi8KQEAgLTI0MTAsMTEgKzI0
MDUsMTEgQEAgY3NjaGVkMl9yZXNfcGljayhjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0
cnVjdCBzY2hlZF9pdGVtICppdGVtKQogICAgIHsKICAgICAgICAgc3RydWN0IHsKICAgICAgICAg
ICAgIHVpbnQ2NF90IGJfYXZnbG9hZDsKLSAgICAgICAgICAgIHVuc2lnbmVkIHZjcHU6MTYsIGRv
bToxNjsKKyAgICAgICAgICAgIHVuc2lnbmVkIGl0ZW06MTYsIGRvbToxNjsKICAgICAgICAgICAg
IHVuc2lnbmVkIHJxX2lkOjE2LCBuZXdfY3B1OjE2OwogICAgICAgICB9IGQ7Ci0gICAgICAgIGQu
ZG9tID0gdmMtPmRvbWFpbi0+ZG9tYWluX2lkOwotICAgICAgICBkLnZjcHUgPSB2Yy0+dmNwdV9p
ZDsKKyAgICAgICAgZC5kb20gPSBpdGVtLT5kb21haW4tPmRvbWFpbl9pZDsKKyAgICAgICAgZC5p
dGVtID0gaXRlbS0+aXRlbV9pZDsKICAgICAgICAgZC5ycV9pZCA9IG1pbl9ycWk7CiAgICAgICAg
IGQuYl9hdmdsb2FkID0gbWluX2F2Z2xvYWQ7CiAgICAgICAgIGQubmV3X2NwdSA9IG5ld19jcHU7
CkBAIC0yNDMzLDEwICsyNDI4LDEwIEBAIHR5cGVkZWYgc3RydWN0IHsKICAgICBzdHJ1Y3QgY3Nj
aGVkMl9pdGVtICogYmVzdF9wdXNoX3N2YywgKmJlc3RfcHVsbF9zdmM7CiAgICAgLyogTkI6IFJl
YWQgYnkgY29uc2lkZXIoKSAqLwogICAgIHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKmxy
cWQ7Ci0gICAgc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqb3JxZDsgICAgICAgICAgICAg
ICAgICAKKyAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpvcnFkOwogfSBiYWxhbmNl
X3N0YXRlX3Q7CiAKLXN0YXRpYyB2b2lkIGNvbnNpZGVyKGJhbGFuY2Vfc3RhdGVfdCAqc3QsIAor
c3RhdGljIHZvaWQgY29uc2lkZXIoYmFsYW5jZV9zdGF0ZV90ICpzdCwKICAgICAgICAgICAgICAg
ICAgICAgIHN0cnVjdCBjc2NoZWQyX2l0ZW0gKnB1c2hfc3ZjLAogICAgICAgICAgICAgICAgICAg
ICAgc3RydWN0IGNzY2hlZDJfaXRlbSAqcHVsbF9zdmMpCiB7CkBAIC0yNDc1LDE3ICsyNDcwLDE3
IEBAIHN0YXRpYyB2b2lkIG1pZ3JhdGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAg
ICAgICAgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICp0cnFkLAogICAg
ICAgICAgICAgICAgICAgICBzX3RpbWVfdCBub3cpCiB7Ci0gICAgaW50IGNwdSA9IHN2Yy0+dmNw
dS0+cHJvY2Vzc29yOwotICAgIHN0cnVjdCBzY2hlZF9pdGVtICppdGVtID0gc3ZjLT52Y3B1LT5z
Y2hlZF9pdGVtOworICAgIHN0cnVjdCBzY2hlZF9pdGVtICppdGVtID0gc3ZjLT5pdGVtOworICAg
IGludCBjcHUgPSBzY2hlZF9pdGVtX2NwdShpdGVtKTsKIAogICAgIGlmICggdW5saWtlbHkodGJf
aW5pdF9kb25lKSApCiAgICAgewogICAgICAgICBzdHJ1Y3QgewotICAgICAgICAgICAgdW5zaWdu
ZWQgdmNwdToxNiwgZG9tOjE2OworICAgICAgICAgICAgdW5zaWduZWQgaXRlbToxNiwgZG9tOjE2
OwogICAgICAgICAgICAgdW5zaWduZWQgcnFpOjE2LCB0cnFpOjE2OwogICAgICAgICB9IGQ7Ci0g
ICAgICAgIGQuZG9tID0gc3ZjLT52Y3B1LT5kb21haW4tPmRvbWFpbl9pZDsKLSAgICAgICAgZC52
Y3B1ID0gc3ZjLT52Y3B1LT52Y3B1X2lkOworICAgICAgICBkLmRvbSA9IGl0ZW0tPmRvbWFpbi0+
ZG9tYWluX2lkOworICAgICAgICBkLml0ZW0gPSBpdGVtLT5pdGVtX2lkOwogICAgICAgICBkLnJx
aSA9IHN2Yy0+cnFkLT5pZDsKICAgICAgICAgZC50cnFpID0gdHJxZC0+aWQ7CiAgICAgICAgIF9f
dHJhY2VfdmFyKFRSQ19DU0NIRUQyX01JR1JBVEUsIDEsCkBAIC0yNDk3LDcgKzI0OTIsNyBAQCBz
dGF0aWMgdm9pZCBtaWdyYXRlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywKICAgICB7CiAg
ICAgICAgIC8qIEl0J3MgcnVubmluZzsgbWFyayBpdCB0byBtaWdyYXRlLiAqLwogICAgICAgICBz
dmMtPm1pZ3JhdGVfcnFkID0gdHJxZDsKLSAgICAgICAgX19zZXRfYml0KF9WUEZfbWlncmF0aW5n
LCAmc3ZjLT52Y3B1LT5wYXVzZV9mbGFncyk7CisgICAgICAgIHNjaGVkX3NldF9wYXVzZV9mbGFn
cyhpdGVtLCBfVlBGX21pZ3JhdGluZyk7CiAgICAgICAgIF9fc2V0X2JpdChfX0NTRkxBR19ydW5x
X21pZ3JhdGVfcmVxdWVzdCwgJnN2Yy0+ZmxhZ3MpOwogICAgICAgICBTQ0hFRF9TVEFUX0NSQU5L
KG1pZ3JhdGVfcmVxdWVzdGVkKTsKICAgICAgICAgdGlja2xlX2NwdShjcHUsIHN2Yy0+cnFkKTsK
QEAgLTI1MDYsNyArMjUwMSw3IEBAIHN0YXRpYyB2b2lkIG1pZ3JhdGUoY29uc3Qgc3RydWN0IHNj
aGVkdWxlciAqb3BzLAogICAgIHsKICAgICAgICAgaW50IG9uX3J1bnEgPSAwOwogICAgICAgICAv
KiBJdCdzIG5vdCBydW5uaW5nOyBqdXN0IG1vdmUgaXQgKi8KLSAgICAgICAgaWYgKCB2Y3B1X29u
X3J1bnEoc3ZjKSApCisgICAgICAgIGlmICggaXRlbV9vbl9ydW5xKHN2YykgKQogICAgICAgICB7
CiAgICAgICAgICAgICBydW5xX3JlbW92ZShzdmMpOwogICAgICAgICAgICAgdXBkYXRlX2xvYWQo
b3BzLCBzdmMtPnJxZCwgTlVMTCwgLTEsIG5vdyk7CkBAIC0yNTE1LDE0ICsyNTEwLDE0IEBAIHN0
YXRpYyB2b2lkIG1pZ3JhdGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICAgICAgICBf
cnVucV9kZWFzc2lnbihzdmMpOwogCiAgICAgICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRj
aF9jcHUoY3B1KSwgaXRlbS0+Y3B1X2hhcmRfYWZmaW5pdHksCi0gICAgICAgICAgICAgICAgICAg
IGNwdXBvb2xfZG9tYWluX2NwdW1hc2soc3ZjLT52Y3B1LT5kb21haW4pKTsKKyAgICAgICAgICAg
ICAgICAgICAgY3B1cG9vbF9kb21haW5fY3B1bWFzayhpdGVtLT5kb21haW4pKTsKICAgICAgICAg
Y3B1bWFza19hbmQoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCBjcHVtYXNrX3NjcmF0Y2hfY3B1
KGNwdSksCiAgICAgICAgICAgICAgICAgICAgICZ0cnFkLT5hY3RpdmUpOwotICAgICAgICBzdmMt
PnZjcHUtPnByb2Nlc3NvciA9IGNwdW1hc2tfY3ljbGUodHJxZC0+cGlja19iaWFzLAotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3B1bWFza19zY3JhdGNoX2Nw
dShjcHUpKTsKLSAgICAgICAgc3ZjLT52Y3B1LT5zY2hlZF9pdGVtLT5yZXMgPSBwZXJfY3B1KHNj
aGVkX3Jlcywgc3ZjLT52Y3B1LT5wcm9jZXNzb3IpOwotICAgICAgICB0cnFkLT5waWNrX2JpYXMg
PSBzdmMtPnZjcHUtPnByb2Nlc3NvcjsKLSAgICAgICAgQVNTRVJUKHN2Yy0+dmNwdS0+cHJvY2Vz
c29yIDwgbnJfY3B1X2lkcyk7CisgICAgICAgIHNjaGVkX3NldF9yZXMoaXRlbSwgcGVyX2NwdShz
Y2hlZF9yZXMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcHVtYXNrX2N5
Y2xlKHRycWQtPnBpY2tfYmlhcywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgY3B1bWFza19zY3JhdGNoX2NwdShjcHUpKSkpOworICAgICAgICB0cnFk
LT5waWNrX2JpYXMgPSBzY2hlZF9pdGVtX2NwdShpdGVtKTsKKyAgICAgICAgQVNTRVJUKHNjaGVk
X2l0ZW1fY3B1KGl0ZW0pIDwgbnJfY3B1X2lkcyk7CiAKICAgICAgICAgX3J1bnFfYXNzaWduKHN2
YywgdHJxZCk7CiAgICAgICAgIGlmICggb25fcnVucSApCkBAIC0yNTQyLDE0ICsyNTM3LDE0IEBA
IHN0YXRpYyB2b2lkIG1pZ3JhdGUoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzLAogICogIC0g
c3ZjIGlzIG5vdCBhbHJlYWR5IGZsYWdnZWQgdG8gbWlncmF0ZSwKICAqICAtIGlmIHN2YyBpcyBh
bGxvd2VkIHRvIHJ1biBvbiBhdCBsZWFzdCBvbmUgb2YgdGhlIHBjcHVzIG9mIHJxZC4KICAqLwot
c3RhdGljIGJvb2wgdmNwdV9pc19taWdyYXRlYWJsZShzdHJ1Y3QgY3NjaGVkMl9pdGVtICpzdmMs
CitzdGF0aWMgYm9vbCBpdGVtX2lzX21pZ3JhdGVhYmxlKHN0cnVjdCBjc2NoZWQyX2l0ZW0gKnN2
YywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5x
dWV1ZV9kYXRhICpycWQpCiB7Ci0gICAgc3RydWN0IHZjcHUgKnYgPSBzdmMtPnZjcHU7Ci0gICAg
aW50IGNwdSA9IHN2Yy0+dmNwdS0+cHJvY2Vzc29yOworICAgIHN0cnVjdCBzY2hlZF9pdGVtICpp
dGVtID0gc3ZjLT5pdGVtOworICAgIGludCBjcHUgPSBzY2hlZF9pdGVtX2NwdShpdGVtKTsKIAot
ICAgIGNwdW1hc2tfYW5kKGNwdW1hc2tfc2NyYXRjaF9jcHUoY3B1KSwgdi0+c2NoZWRfaXRlbS0+
Y3B1X2hhcmRfYWZmaW5pdHksCi0gICAgICAgICAgICAgICAgY3B1cG9vbF9kb21haW5fY3B1bWFz
ayh2LT5kb21haW4pKTsKKyAgICBjcHVtYXNrX2FuZChjcHVtYXNrX3NjcmF0Y2hfY3B1KGNwdSks
IGl0ZW0tPmNwdV9oYXJkX2FmZmluaXR5LAorICAgICAgICAgICAgICAgIGNwdXBvb2xfZG9tYWlu
X2NwdW1hc2soaXRlbS0+ZG9tYWluKSk7CiAKICAgICByZXR1cm4gIShzdmMtPmZsYWdzICYgQ1NG
TEFHX3J1bnFfbWlncmF0ZV9yZXF1ZXN0KSAmJgogICAgICAgICAgICBjcHVtYXNrX2ludGVyc2Vj
dHMoY3B1bWFza19zY3JhdGNoX2NwdShjcHUpLCAmcnFkLT5hY3RpdmUpOwpAQCAtMjU4Niw3ICsy
NTgxLDcgQEAgcmV0cnk6CiAgICAgZm9yX2VhY2hfY3B1KGksICZwcnYtPmFjdGl2ZV9xdWV1ZXMp
CiAgICAgewogICAgICAgICBzX3RpbWVfdCBkZWx0YTsKLSAgICAgICAgCisKICAgICAgICAgc3Qu
b3JxZCA9IHBydi0+cnFkICsgaTsKIAogICAgICAgICBpZiAoIHN0Lm9ycWQgPT0gc3QubHJxZApA
QCAtMjU5NCw3ICsyNTg5LDcgQEAgcmV0cnk6CiAgICAgICAgICAgICBjb250aW51ZTsKIAogICAg
ICAgICB1cGRhdGVfcnVucV9sb2FkKG9wcywgc3Qub3JxZCwgMCwgbm93KTsKLSAgICAKKwogICAg
ICAgICBkZWx0YSA9IHN0LmxycWQtPmJfYXZnbG9hZCAtIHN0Lm9ycWQtPmJfYXZnbG9hZDsKICAg
ICAgICAgaWYgKCBkZWx0YSA8IDAgKQogICAgICAgICAgICAgZGVsdGEgPSAtZGVsdGE7CkBAIC0y
NjE3LDcgKzI2MTIsNyBAQCByZXRyeToKICAgICAgICAgc190aW1lX3QgbG9hZF9tYXg7CiAgICAg
ICAgIGludCBjcHVzX21heDsKIAotICAgICAgICAKKwogICAgICAgICBsb2FkX21heCA9IHN0Lmxy
cWQtPmJfYXZnbG9hZDsKICAgICAgICAgaWYgKCBzdC5vcnFkLT5iX2F2Z2xvYWQgPiBsb2FkX21h
eCApCiAgICAgICAgICAgICBsb2FkX21heCA9IHN0Lm9ycWQtPmJfYXZnbG9hZDsKQEAgLTI2NTYs
NyArMjY1MSw3IEBAIHJldHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIG9wdF9vdmVybG9hZF9iYWxhbmNlX3RvbGVyYW5jZSkpICkKICAgICAgICAgICAgICAg
ICBnb3RvIG91dDsKICAgICB9Ci0gICAgICAgICAgICAgCisKICAgICAvKiBUcnkgdG8gZ3JhYiB0
aGUgb3RoZXIgcnVucXVldWUgbG9jazsgaWYgaXQncyBiZWVuIHRha2VuIGluIHRoZQogICAgICAq
IG1lYW50aW1lLCB0cnkgdGhlIHByb2Nlc3Mgb3ZlciBhZ2Fpbi4gIFRoaXMgY2FuJ3QgZGVhZGxv
Y2sKICAgICAgKiBiZWNhdXNlIGlmIGl0IGRvZXNuJ3QgZ2V0IGFueSBvdGhlciBycWQgbG9ja3Ms
IGl0IHdpbGwgc2ltcGx5CkBAIC0yNjk2LDE3ICsyNjkxLDE3IEBAIHJldHJ5OgogCiAgICAgICAg
IHVwZGF0ZV9zdmNfbG9hZChvcHMsIHB1c2hfc3ZjLCAwLCBub3cpOwogCi0gICAgICAgIGlmICgg
IXZjcHVfaXNfbWlncmF0ZWFibGUocHVzaF9zdmMsIHN0Lm9ycWQpICkKKyAgICAgICAgaWYgKCAh
aXRlbV9pc19taWdyYXRlYWJsZShwdXNoX3N2Yywgc3Qub3JxZCkgKQogICAgICAgICAgICAgY29u
dGludWU7CiAKICAgICAgICAgbGlzdF9mb3JfZWFjaCggcHVsbF9pdGVyLCAmc3Qub3JxZC0+c3Zj
ICkKICAgICAgICAgewogICAgICAgICAgICAgc3RydWN0IGNzY2hlZDJfaXRlbSAqIHB1bGxfc3Zj
ID0gbGlzdF9lbnRyeShwdWxsX2l0ZXIsIHN0cnVjdCBjc2NoZWQyX2l0ZW0sIHJxZF9lbGVtKTsK
LSAgICAgICAgICAgIAorCiAgICAgICAgICAgICBpZiAoICFpbm5lcl9sb2FkX3VwZGF0ZWQgKQog
ICAgICAgICAgICAgICAgIHVwZGF0ZV9zdmNfbG9hZChvcHMsIHB1bGxfc3ZjLCAwLCBub3cpOwot
ICAgICAgICAKLSAgICAgICAgICAgIGlmICggIXZjcHVfaXNfbWlncmF0ZWFibGUocHVsbF9zdmMs
IHN0LmxycWQpICkKKworICAgICAgICAgICAgaWYgKCAhaXRlbV9pc19taWdyYXRlYWJsZShwdWxs
X3N2Yywgc3QubHJxZCkgKQogICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogCiAgICAgICAgICAg
ICBjb25zaWRlcigmc3QsIHB1c2hfc3ZjLCBwdWxsX3N2Yyk7CkBAIC0yNzIxLDggKzI3MTYsOCBA
QCByZXRyeToKICAgICBsaXN0X2Zvcl9lYWNoKCBwdWxsX2l0ZXIsICZzdC5vcnFkLT5zdmMgKQog
ICAgIHsKICAgICAgICAgc3RydWN0IGNzY2hlZDJfaXRlbSAqIHB1bGxfc3ZjID0gbGlzdF9lbnRy
eShwdWxsX2l0ZXIsIHN0cnVjdCBjc2NoZWQyX2l0ZW0sIHJxZF9lbGVtKTsKLSAgICAgICAgCi0g
ICAgICAgIGlmICggIXZjcHVfaXNfbWlncmF0ZWFibGUocHVsbF9zdmMsIHN0LmxycWQpICkKKwor
ICAgICAgICBpZiAoICFpdGVtX2lzX21pZ3JhdGVhYmxlKHB1bGxfc3ZjLCBzdC5scnFkKSApCiAg
ICAgICAgICAgICBjb250aW51ZTsKIAogICAgICAgICAvKiBDb25zaWRlciBwdWxsIG9ubHkgKi8K
QEAgLTI3NDUsOCArMjc0MCw3IEBAIHN0YXRpYyB2b2lkCiBjc2NoZWQyX2l0ZW1fbWlncmF0ZSgK
ICAgICBjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBzY2hlZF9pdGVtICppdGVt
LCB1bnNpZ25lZCBpbnQgbmV3X2NwdSkKIHsKLSAgICBzdHJ1Y3QgdmNwdSAqdmMgPSBpdGVtLT52
Y3B1OwotICAgIHN0cnVjdCBkb21haW4gKmQgPSB2Yy0+ZG9tYWluOworICAgIHN0cnVjdCBkb21h
aW4gKmQgPSBpdGVtLT5kb21haW47CiAgICAgc3RydWN0IGNzY2hlZDJfaXRlbSAqIGNvbnN0IHN2
YyA9IGNzY2hlZDJfaXRlbShpdGVtKTsKICAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRh
ICp0cnFkOwogICAgIHNfdGltZV90IG5vdyA9IE5PVygpOwpAQCAtMjc1OCwyNSArMjc1MiwyNCBA
QCBjc2NoZWQyX2l0ZW1fbWlncmF0ZSgKICAgICAgKiBjcHVwb29sLgogICAgICAqCiAgICAgICog
QW5kIHNpbmNlIHRoZXJlIGluZGVlZCBpcyB0aGUgY2hhbmNlIHRoYXQgaXQgaXMgbm90IHBhcnQg
b2YgaXQsIGFsbAotICAgICAqIHdlIG11c3QgZG8gaXMgcmVtb3ZlIF9hbmRfIHVuYXNzaWduIHRo
ZSB2Q1BVIGZyb20gYW55IHJ1bnF1ZXVlLCBhcworICAgICAqIHdlIG11c3QgZG8gaXMgcmVtb3Zl
IF9hbmRfIHVuYXNzaWduIHRoZSBpdGVtIGZyb20gYW55IHJ1bnF1ZXVlLCBhcwogICAgICAqIHdl
bGwgYXMgdXBkYXRpbmcgdi0+cHJvY2Vzc29yIHdpdGggdGhlIHRhcmdldCwgc28gdGhhdCB0aGUg
c3VzcGVuZAogICAgICAqIHByb2Nlc3MgY2FuIGNvbnRpbnVlLgogICAgICAqCiAgICAgICogSXQg
d2lsbCB0aGVuIGJlIGR1cmluZyByZXN1bWUgdGhhdCBhIG5ldywgbWVhbmluZ2Z1bCwgdmFsdWUg
Zm9yCiAgICAgICogdi0+cHJvY2Vzc29yIHdpbGwgYmUgY2hvc2VuLCBhbmQgZHVyaW5nIGFjdHVh
bCBkb21haW4gdW5wYXVzZSB0aGF0Ci0gICAgICogdGhlIHZDUFUgd2lsbCBiZSBhc3NpZ25lZCB0
byBhbmQgYWRkZWQgdG8gdGhlIHByb3BlciBydW5xdWV1ZS4KKyAgICAgKiB0aGUgaXRlbSB3aWxs
IGJlIGFzc2lnbmVkIHRvIGFuZCBhZGRlZCB0byB0aGUgcHJvcGVyIHJ1bnF1ZXVlLgogICAgICAq
LwogICAgIGlmICggdW5saWtlbHkoIWNwdW1hc2tfdGVzdF9jcHUobmV3X2NwdSwgY3B1cG9vbF9k
b21haW5fY3B1bWFzayhkKSkpICkKICAgICB7CiAgICAgICAgIEFTU0VSVChzeXN0ZW1fc3RhdGUg
PT0gU1lTX1NUQVRFX3N1c3BlbmQpOwotICAgICAgICBpZiAoIHZjcHVfb25fcnVucShzdmMpICkK
KyAgICAgICAgaWYgKCBpdGVtX29uX3J1bnEoc3ZjKSApCiAgICAgICAgIHsKICAgICAgICAgICAg
IHJ1bnFfcmVtb3ZlKHN2Yyk7CiAgICAgICAgICAgICB1cGRhdGVfbG9hZChvcHMsIHN2Yy0+cnFk
LCBOVUxMLCAtMSwgbm93KTsKICAgICAgICAgfQogICAgICAgICBfcnVucV9kZWFzc2lnbihzdmMp
OwotICAgICAgICB2Yy0+cHJvY2Vzc29yID0gbmV3X2NwdTsKLSAgICAgICAgaXRlbS0+cmVzID0g
cGVyX2NwdShzY2hlZF9yZXMsIG5ld19jcHUpOworICAgICAgICBzY2hlZF9zZXRfcmVzKGl0ZW0s
IHBlcl9jcHUoc2NoZWRfcmVzLCBuZXdfY3B1KSk7CiAgICAgICAgIHJldHVybjsKICAgICB9CiAK
QEAgLTI3OTAsMTcgKzI3ODMsMTQgQEAgY3NjaGVkMl9pdGVtX21pZ3JhdGUoCiAgICAgICogRG8g
dGhlIGFjdHVhbCBtb3ZlbWVudCB0b3dhcmQgbmV3X2NwdSwgYW5kIHVwZGF0ZSB2Yy0+cHJvY2Vz
c29yLgogICAgICAqIElmIHdlIGFyZSBjaGFuZ2luZyBydW5xdWV1ZSwgbWlncmF0ZSgpIHRha2Vz
IGNhcmUgb2YgZXZlcnl0aGluZy4KICAgICAgKiBJZiB3ZSBhcmUgbm90IGNoYW5naW5nIHJ1bnF1
ZXVlLCB3ZSBuZWVkIHRvIHVwZGF0ZSB2Yy0+cHJvY2Vzc29yCi0gICAgICogaGVyZS4gSW4gZmFj
dCwgaWYsIGZvciBpbnN0YW5jZSwgd2UgYXJlIGhlcmUgYmVjYXVzZSB0aGUgdmNwdSdzCisgICAg
ICogaGVyZS4gSW4gZmFjdCwgaWYsIGZvciBpbnN0YW5jZSwgd2UgYXJlIGhlcmUgYmVjYXVzZSB0
aGUgaXRlbSdzCiAgICAgICogaGFyZCBhZmZpbml0eSBjaGFuZ2VkLCB3ZSBkb24ndCB3YW50IHRv
IHJpc2sgbGVhdmluZyB2Yy0+cHJvY2Vzc29yCiAgICAgICogcG9pbnRpbmcgdG8gYSBwY3B1IHdo
ZXJlIHdlIGNhbid0IHJ1biBhbnkgbG9uZ2VyLgogICAgICAqLwogICAgIGlmICggdHJxZCAhPSBz
dmMtPnJxZCApCiAgICAgICAgIG1pZ3JhdGUob3BzLCBzdmMsIHRycWQsIG5vdyk7CiAgICAgZWxz
ZQotICAgIHsKLSAgICAgICAgdmMtPnByb2Nlc3NvciA9IG5ld19jcHU7Ci0gICAgICAgIGl0ZW0t
PnJlcyA9IHBlcl9jcHUoc2NoZWRfcmVzLCBuZXdfY3B1KTsKLSAgICB9CisgICAgICAgIHNjaGVk
X3NldF9yZXMoaXRlbSwgcGVyX2NwdShzY2hlZF9yZXMsIG5ld19jcHUpKTsKIH0KIAogc3RhdGlj
IGludApAQCAtMjgxMiwxOCArMjgwMiwxOCBAQCBjc2NoZWQyX2RvbV9jbnRsKAogICAgIHN0cnVj
dCBjc2NoZWQyX2RvbSAqIGNvbnN0IHNkb20gPSBjc2NoZWQyX2RvbShkKTsKICAgICBzdHJ1Y3Qg
Y3NjaGVkMl9wcml2YXRlICpwcnYgPSBjc2NoZWQyX3ByaXYob3BzKTsKICAgICB1bnNpZ25lZCBs
b25nIGZsYWdzOwotICAgIHN0cnVjdCB2Y3B1ICp2OworICAgIHN0cnVjdCBzY2hlZF9pdGVtICpp
dGVtOwogICAgIGludCByYyA9IDA7CiAKICAgICAvKgogICAgICAqIExvY2tpbmc6CiAgICAgICog
IC0gd2UgbXVzdCB0YWtlIHRoZSBwcml2YXRlIGxvY2sgZm9yIGFjY2Vzc2luZyB0aGUgd2VpZ2h0
cyBvZiB0aGUKLSAgICAgKiAgICB2Y3B1cyBvZiBkLCBhbmQvb3IgdGhlIGNhcDsKKyAgICAgKiAg
ICBpdGVtcyBvZiBkLCBhbmQvb3IgdGhlIGNhcDsKICAgICAgKiAgLSBpbiB0aGUgcHV0aW5mbyBj
YXNlLCB3ZSBhbHNvIG5lZWQgdGhlIHJ1bnF1ZXVlIGxvY2socyksIGZvcgogICAgICAqICAgIHVw
ZGF0aW5nIHRoZSBtYXggd2FpZ2h0IG9mIHRoZSBydW5xdWV1ZShzKS4KICAgICAgKiAgICBJZiBj
aGFuZ2luZyB0aGUgY2FwLCB3ZSBhbHNvIG5lZWQgdGhlIGJ1ZGdldF9sb2NrLCBmb3IgdXBkYXRp
bmcKICAgICAgKiAgICB0aGUgdmFsdWUgb2YgdGhlIGRvbWFpbiBidWRnZXQgcG9vbCAoYW5kIHRo
ZSBydW5xdWV1ZSBsb2NrLAotICAgICAqICAgIGZvciBhZGp1c3RpbmcgdGhlIHBhcmFtZXRlcnMg
YW5kIHJlc2NoZWR1bGluZyBhbnkgdkNQVSB0aGF0IGlzCisgICAgICogICAgZm9yIGFkanVzdGlu
ZyB0aGUgcGFyYW1ldGVycyBhbmQgcmVzY2hlZHVsaW5nIGFueSBpdGVtIHRoYXQgaXMKICAgICAg
KiAgICBydW5uaW5nIGF0IHRoZSB0aW1lIG9mIHRoZSBjaGFuZ2UpLgogICAgICAqLwogICAgIHN3
aXRjaCAoIG9wLT5jbWQgKQpAQCAtMjg0NSwxOCArMjgzNSwxOCBAQCBjc2NoZWQyX2RvbV9jbnRs
KAogCiAgICAgICAgICAgICBzZG9tLT53ZWlnaHQgPSBvcC0+dS5jcmVkaXQyLndlaWdodDsKIAot
ICAgICAgICAgICAgLyogVXBkYXRlIHdlaWdodHMgZm9yIHZjcHVzLCBhbmQgbWF4X3dlaWdodCBm
b3IgcnVucXVldWVzIG9uIHdoaWNoIHRoZXkgcmVzaWRlICovCi0gICAgICAgICAgICBmb3JfZWFj
aF92Y3B1ICggZCwgdiApCisgICAgICAgICAgICAvKiBVcGRhdGUgd2VpZ2h0cyBmb3IgaXRlbXMs
IGFuZCBtYXhfd2VpZ2h0IGZvciBydW5xdWV1ZXMgb24gd2hpY2ggdGhleSByZXNpZGUgKi8KKyAg
ICAgICAgICAgIGZvcl9lYWNoX3NjaGVkX2l0ZW0gKCBkLCBpdGVtICkKICAgICAgICAgICAgIHsK
LSAgICAgICAgICAgICAgICBzdHJ1Y3QgY3NjaGVkMl9pdGVtICpzdmMgPSBjc2NoZWQyX2l0ZW0o
di0+c2NoZWRfaXRlbSk7Ci0gICAgICAgICAgICAgICAgc3BpbmxvY2tfdCAqbG9jayA9IGl0ZW1f
c2NoZWR1bGVfbG9jayhzdmMtPnZjcHUtPnNjaGVkX2l0ZW0pOworICAgICAgICAgICAgICAgIHN0
cnVjdCBjc2NoZWQyX2l0ZW0gKnN2YyA9IGNzY2hlZDJfaXRlbShpdGVtKTsKKyAgICAgICAgICAg
ICAgICBzcGlubG9ja190ICpsb2NrID0gaXRlbV9zY2hlZHVsZV9sb2NrKGl0ZW0pOwogCi0gICAg
ICAgICAgICAgICAgQVNTRVJUKHN2Yy0+cnFkID09IGMycnFkKG9wcywgc3ZjLT52Y3B1LT5wcm9j
ZXNzb3IpKTsKKyAgICAgICAgICAgICAgICBBU1NFUlQoc3ZjLT5ycWQgPT0gYzJycWQob3BzLCBz
Y2hlZF9pdGVtX2NwdShpdGVtKSkpOwogCiAgICAgICAgICAgICAgICAgc3ZjLT53ZWlnaHQgPSBz
ZG9tLT53ZWlnaHQ7CiAgICAgICAgICAgICAgICAgdXBkYXRlX21heF93ZWlnaHQoc3ZjLT5ycWQs
IHN2Yy0+d2VpZ2h0LCBvbGRfd2VpZ2h0KTsKIAotICAgICAgICAgICAgICAgIGl0ZW1fc2NoZWR1
bGVfdW5sb2NrKGxvY2ssIHN2Yy0+dmNwdS0+c2NoZWRfaXRlbSk7CisgICAgICAgICAgICAgICAg
aXRlbV9zY2hlZHVsZV91bmxvY2sobG9jaywgaXRlbSk7CiAgICAgICAgICAgICB9CiAgICAgICAg
IH0KICAgICAgICAgLyogQ2FwICovCkBAIC0yODY1LDggKzI4NTUsOCBAQCBjc2NoZWQyX2RvbV9j
bnRsKAogICAgICAgICAgICAgc3RydWN0IGNzY2hlZDJfaXRlbSAqc3ZjOwogICAgICAgICAgICAg
c3BpbmxvY2tfdCAqbG9jazsKIAotICAgICAgICAgICAgLyogQ2FwIGlzIG9ubHkgdmFsaWQgaWYg
aXQncyBiZWxvdyAxMDAgKiBucl9vZl92Q1BVUyAqLwotICAgICAgICAgICAgaWYgKCBvcC0+dS5j
cmVkaXQyLmNhcCA+IDEwMCAqIHNkb20tPm5yX3ZjcHVzICkKKyAgICAgICAgICAgIC8qIENhcCBp
cyBvbmx5IHZhbGlkIGlmIGl0J3MgYmVsb3cgMTAwICogbnJfb2ZfaXRlbXMgKi8KKyAgICAgICAg
ICAgIGlmICggb3AtPnUuY3JlZGl0Mi5jYXAgPiAxMDAgKiBzZG9tLT5ucl9pdGVtcyApCiAgICAg
ICAgICAgICB7CiAgICAgICAgICAgICAgICAgcmMgPSAtRUlOVkFMOwogICAgICAgICAgICAgICAg
IHdyaXRlX3VubG9ja19pcnFyZXN0b3JlKCZwcnYtPmxvY2ssIGZsYWdzKTsKQEAgLTI4NzksMjMg
KzI4NjksMjMgQEAgY3NjaGVkMl9kb21fY250bCgKICAgICAgICAgICAgIHNwaW5fdW5sb2NrKCZz
ZG9tLT5idWRnZXRfbG9jayk7CiAKICAgICAgICAgICAgIC8qCi0gICAgICAgICAgICAgKiBXaGVu
IHRyeWluZyB0byBnZXQgc29tZSBidWRnZXQgYW5kIHJ1biwgZWFjaCB2Q1BVIHdpbGwgZ3JhYgot
ICAgICAgICAgICAgICogZnJvbSB0aGUgcG9vbCAxL04gKHdpdGggTiA9IG5yIG9mIHZDUFVzIG9m
IHRoZSBkb21haW4pIG9mCi0gICAgICAgICAgICAgKiB0aGUgdG90YWwgYnVkZ2V0LiBSb3VnaGx5
IHNwZWFraW5nLCB0aGlzIG1lYW5zIGVhY2ggdkNQVSB3aWxsCisgICAgICAgICAgICAgKiBXaGVu
IHRyeWluZyB0byBnZXQgc29tZSBidWRnZXQgYW5kIHJ1biwgZWFjaCBpdGVtIHdpbGwgZ3JhYgor
ICAgICAgICAgICAgICogZnJvbSB0aGUgcG9vbCAxL04gKHdpdGggTiA9IG5yIG9mIGl0ZW1zIG9m
IHRoZSBkb21haW4pIG9mCisgICAgICAgICAgICAgKiB0aGUgdG90YWwgYnVkZ2V0LiBSb3VnaGx5
IHNwZWFraW5nLCB0aGlzIG1lYW5zIGVhY2ggaXRlbSB3aWxsCiAgICAgICAgICAgICAgKiBoYXZl
IGF0IGxlYXN0IG9uZSBjaGFuY2UgdG8gcnVuIGR1cmluZyBldmVyeSBwZXJpb2QuCiAgICAgICAg
ICAgICAgKi8KLSAgICAgICAgICAgIGZvcl9lYWNoX3ZjcHUgKCBkLCB2ICkKKyAgICAgICAgICAg
IGZvcl9lYWNoX3NjaGVkX2l0ZW0gKCBkLCBpdGVtICkKICAgICAgICAgICAgIHsKLSAgICAgICAg
ICAgICAgICBzdmMgPSBjc2NoZWQyX2l0ZW0odi0+c2NoZWRfaXRlbSk7Ci0gICAgICAgICAgICAg
ICAgbG9jayA9IGl0ZW1fc2NoZWR1bGVfbG9jayhzdmMtPnZjcHUtPnNjaGVkX2l0ZW0pOworICAg
ICAgICAgICAgICAgIHN2YyA9IGNzY2hlZDJfaXRlbShpdGVtKTsKKyAgICAgICAgICAgICAgICBs
b2NrID0gaXRlbV9zY2hlZHVsZV9sb2NrKGl0ZW0pOwogICAgICAgICAgICAgICAgIC8qCiAgICAg
ICAgICAgICAgICAgICogVG9vIHNtYWxsIHF1b3RhcyB3b3VsZCBpbiB0aGVvcnkgY2F1c2UgYSBs
b3Qgb2Ygb3ZlcmhlYWQsCiAgICAgICAgICAgICAgICAgICogd2hpY2ggdGhlbiB3b24ndCBoYXBw
ZW4gYmVjYXVzZSwgaW4gY3NjaGVkMl9ydW50aW1lKCksCiAgICAgICAgICAgICAgICAgICogQ1ND
SEVEMl9NSU5fVElNRVIgaXMgd2hhdCB3b3VsZCBiZSB1c2VkIGFueXdheS4KICAgICAgICAgICAg
ICAgICAgKi8KLSAgICAgICAgICAgICAgICBzdmMtPmJ1ZGdldF9xdW90YSA9IG1heChzZG9tLT50
b3RfYnVkZ2V0IC8gc2RvbS0+bnJfdmNwdXMsCisgICAgICAgICAgICAgICAgc3ZjLT5idWRnZXRf
cXVvdGEgPSBtYXgoc2RvbS0+dG90X2J1ZGdldCAvIHNkb20tPm5yX2l0ZW1zLAogICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENTQ0hFRDJfTUlOX1RJTUVSKTsKLSAgICAg
ICAgICAgICAgICBpdGVtX3NjaGVkdWxlX3VubG9jayhsb2NrLCBzdmMtPnZjcHUtPnNjaGVkX2l0
ZW0pOworICAgICAgICAgICAgICAgIGl0ZW1fc2NoZWR1bGVfdW5sb2NrKGxvY2ssIGl0ZW0pOwog
ICAgICAgICAgICAgfQogCiAgICAgICAgICAgICBpZiAoIHNkb20tPmNhcCA9PSAwICkKQEAgLTI5
MDUsNyArMjg5NSw3IEBAIGNzY2hlZDJfZG9tX2NudGwoCiAgICAgICAgICAgICAgICAgICogYW5k
IHF1ZXVlIGl0cyBmaXJzdCByZXBsZW5pc2htZW50IGV2ZW50LgogICAgICAgICAgICAgICAgICAq
CiAgICAgICAgICAgICAgICAgICogU2luY2UgY2FwIGlzIGN1cnJlbnRseSBkaXNhYmxlZCBmb3Ig
dGhpcyBkb21haW4sIHdlCi0gICAgICAgICAgICAgICAgICoga25vdyBubyB2Q1BVIGlzIG1lc3Np
bmcgd2l0aCB0aGUgZG9tYWluJ3MgYnVkZ2V0LCBhbmQKKyAgICAgICAgICAgICAgICAgKiBrbm93
IG5vIGl0ZW0gaXMgbWVzc2luZyB3aXRoIHRoZSBkb21haW4ncyBidWRnZXQsIGFuZAogICAgICAg
ICAgICAgICAgICAqIHRoZSByZXBsZW5pc2htZW50IHRpbWVyIGlzIHN0aWxsIG9mZi4KICAgICAg
ICAgICAgICAgICAgKiBGb3IgdGhlc2UgcmVhc29ucywgaXQgaXMgc2FmZSB0byBkbyB0aGUgZm9s
bG93aW5nIHdpdGhvdXQKICAgICAgICAgICAgICAgICAgKiB0YWtpbmcgdGhlIGJ1ZGdldF9sb2Nr
LgpAQCAtMjkxNSw0MiArMjkwNSw0MiBAQCBjc2NoZWQyX2RvbV9jbnRsKAogICAgICAgICAgICAg
ICAgIHNldF90aW1lcigmc2RvbS0+cmVwbF90aW1lciwgc2RvbS0+bmV4dF9yZXBsKTsKIAogICAg
ICAgICAgICAgICAgIC8qCi0gICAgICAgICAgICAgICAgICogTm93LCBsZXQncyBlbmFibGUgYnVk
Z2V0IGFjY291bnRpbmcgZm9yIGFsbCB0aGUgdkNQVXMuCisgICAgICAgICAgICAgICAgICogTm93
LCBsZXQncyBlbmFibGUgYnVkZ2V0IGFjY291bnRpbmcgZm9yIGFsbCB0aGUgaXRlbXMuCiAgICAg
ICAgICAgICAgICAgICogRm9yIG1ha2luZyBzdXJlIHRoYXQgdGhleSB3aWxsIHN0YXJ0IHRvIGhv
bm91ciB0aGUgZG9tYWluJ3MKICAgICAgICAgICAgICAgICAgKiBjYXAsIHdlIHNldCB0aGVpciBi
dWRnZXQgdG8gMC4KICAgICAgICAgICAgICAgICAgKiBUaGlzIHdheSwgYXMgc29vbiBhcyB0aGV5
IHdpbGwgdHJ5IHRvIHJ1biwgdGhleSB3aWxsIGhhdmUKICAgICAgICAgICAgICAgICAgKiB0byBn
ZXQgc29tZSBidWRnZXQuCiAgICAgICAgICAgICAgICAgICoKLSAgICAgICAgICAgICAgICAgKiBG
b3IgdGhlIHZDUFVzIHRoYXQgYXJlIGFscmVhZHkgcnVubmluZywgd2UgdHJpZ2dlciB0aGUKKyAg
ICAgICAgICAgICAgICAgKiBGb3IgdGhlIGl0ZW1zIHRoYXQgYXJlIGFscmVhZHkgcnVubmluZywg
d2UgdHJpZ2dlciB0aGUKICAgICAgICAgICAgICAgICAgKiBzY2hlZHVsZXIgb24gdGhlaXIgcENQ
VS4gV2hlbiwgYXMgYSBjb25zZXF1ZW5jZSBvZiB0aGlzLAogICAgICAgICAgICAgICAgICAqIGNz
Y2hlZDJfc2NoZWR1bGUoKSB3aWxsIHJ1biwgaXQgd2lsbCBmaWd1cmUgb3V0IHRoZXJlIGlzCi0g
ICAgICAgICAgICAgICAgICogbm8gYnVkZ2V0LCBhbmQgdGhlIHZDUFUgd2lsbCB0cnkgdG8gZ2V0
IHNvbWUgKGFuZCBiZSBwYXJrZWQsCisgICAgICAgICAgICAgICAgICogbm8gYnVkZ2V0LCBhbmQg
dGhlIGl0ZW0gd2lsbCB0cnkgdG8gZ2V0IHNvbWUgKGFuZCBiZSBwYXJrZWQsCiAgICAgICAgICAg
ICAgICAgICogaWYgdGhlcmUncyBub25lLCBhbmQgd2UnbGwgc3dpdGNoIHRvIHNvbWVvbmUgZWxz
ZSkuCiAgICAgICAgICAgICAgICAgICovCi0gICAgICAgICAgICAgICAgZm9yX2VhY2hfdmNwdSAo
IGQsIHYgKQorICAgICAgICAgICAgICAgIGZvcl9lYWNoX3NjaGVkX2l0ZW0gKCBkLCBpdGVtICkK
ICAgICAgICAgICAgICAgICB7Ci0gICAgICAgICAgICAgICAgICAgIHN2YyA9IGNzY2hlZDJfaXRl
bSh2LT5zY2hlZF9pdGVtKTsKLSAgICAgICAgICAgICAgICAgICAgbG9jayA9IGl0ZW1fc2NoZWR1
bGVfbG9jayhzdmMtPnZjcHUtPnNjaGVkX2l0ZW0pOwotICAgICAgICAgICAgICAgICAgICBpZiAo
IHYtPnNjaGVkX2l0ZW0tPmlzX3J1bm5pbmcgKQorICAgICAgICAgICAgICAgICAgICBzdmMgPSBj
c2NoZWQyX2l0ZW0oaXRlbSk7CisgICAgICAgICAgICAgICAgICAgIGxvY2sgPSBpdGVtX3NjaGVk
dWxlX2xvY2soaXRlbSk7CisgICAgICAgICAgICAgICAgICAgIGlmICggaXRlbS0+aXNfcnVubmlu
ZyApCiAgICAgICAgICAgICAgICAgICAgIHsKLSAgICAgICAgICAgICAgICAgICAgICAgIHVuc2ln
bmVkIGludCBjcHUgPSB2LT5wcm9jZXNzb3I7CisgICAgICAgICAgICAgICAgICAgICAgICB1bnNp
Z25lZCBpbnQgY3B1ID0gc2NoZWRfaXRlbV9jcHUoaXRlbSk7CiAgICAgICAgICAgICAgICAgICAg
ICAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQgPSBjMnJxZChvcHMsIGNwdSk7
CiAKLSAgICAgICAgICAgICAgICAgICAgICAgIEFTU0VSVChjdXJyX29uX2NwdShjcHUpLT52Y3B1
ID09IHYpOworICAgICAgICAgICAgICAgICAgICAgICAgQVNTRVJUKGN1cnJfb25fY3B1KGNwdSkg
PT0gaXRlbSk7CiAKICAgICAgICAgICAgICAgICAgICAgICAgIC8qCi0gICAgICAgICAgICAgICAg
ICAgICAgICAgKiBXZSBhcmUgdHJpZ2dlcmluZyBhIHJlc2NoZWR1bGUgb24gdGhlIHZDUFUncwor
ICAgICAgICAgICAgICAgICAgICAgICAgICogV2UgYXJlIHRyaWdnZXJpbmcgYSByZXNjaGVkdWxl
IG9uIHRoZSBpdGVtJ3MKICAgICAgICAgICAgICAgICAgICAgICAgICAqIHBDUFUuIFRoYXQgd2ls
bCBydW4gYnVybl9jcmVkaXRzKCkgYW5kLCBzaW5jZQotICAgICAgICAgICAgICAgICAgICAgICAg
ICogdGhlIHZDUFUgaXMgY2FwcGVkIG5vdywgaXQgd291bGQgY2hhcmdlIGFsbCB0aGUKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAqIHRoZSBpdGVtIGlzIGNhcHBlZCBub3csIGl0IHdvdWxkIGNo
YXJnZSBhbGwgdGhlCiAgICAgICAgICAgICAgICAgICAgICAgICAgKiBleGVjdXRpb24gdGltZSBv
ZiB0aGlzIGxhc3Qgcm91bmQgYXMgYnVkZ2V0IGFzCi0gICAgICAgICAgICAgICAgICAgICAgICAg
KiB3ZWxsLiBUaGF0IHdpbGwgbWFrZSB0aGUgdkNQVSBidWRnZXQgZ28gbmVnYXRpdmUsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgKiB3ZWxsLiBUaGF0IHdpbGwgbWFrZSB0aGUgaXRlbSBidWRn
ZXQgZ28gbmVnYXRpdmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgKiBwb3RlbnRpYWxseSBi
eSBhIGxhcmdlIGFtb3VudCwgYW5kIGl0J3MgdW5mYWlyLgogICAgICAgICAgICAgICAgICAgICAg
ICAgICoKICAgICAgICAgICAgICAgICAgICAgICAgICAqIFRvIGF2b2lkIHRoYXQsIGNhbGwgYnVy
bl9jcmVkaXQoKSBoZXJlLCB0byBkbyB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgICAqIGFj
Y291bnRpbmcgb2YgdGhpcyBjdXJyZW50IHJ1bm5pbmcgaW5zdGFuY2Ugbm93LAogICAgICAgICAg
ICAgICAgICAgICAgICAgICogd2l0aCBidWRnZXR0aW5nIHN0aWxsIGRpc2FibGVkLiBUaGlzIGRv
ZXMgbm90CiAgICAgICAgICAgICAgICAgICAgICAgICAgKiBwcmV2ZW50IHNvbWUgc21hbGwgYW1v
dW50IG9mIGJ1ZGdldCBiZWluZyBjaGFyZ2VkCi0gICAgICAgICAgICAgICAgICAgICAgICAgKiB0
byB0aGUgdkNQVSAoaS5lLiwgdGhlIGFtb3VudCBvZiB0aW1lIGl0IHJ1bnMgZnJvbQorICAgICAg
ICAgICAgICAgICAgICAgICAgICogdG8gdGhlIGl0ZW0gKGkuZS4sIHRoZSBhbW91bnQgb2YgdGlt
ZSBpdCBydW5zIGZyb20KICAgICAgICAgICAgICAgICAgICAgICAgICAqIG5vdywgdG8gd2hlbiBz
Y2hlZHVsaW5nIGhhcHBlbnMpLiBUaGUgYnVkZ2V0IHdpbGwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAqIGFsc28gZ28gYmVsb3cgMCwgYnV0IGEgbG90IGxlc3MgdGhhbiBob3cgaXQgd291bGQK
ICAgICAgICAgICAgICAgICAgICAgICAgICAqIGlmIHdlIGRvbid0IGRvIHRoaXMuCkBAIC0yOTYx
LDcgKzI5NTEsNyBAQCBjc2NoZWQyX2RvbV9jbnRsKAogICAgICAgICAgICAgICAgICAgICAgICAg
Y3B1X3JhaXNlX3NvZnRpcnEoY3B1LCBTQ0hFRFVMRV9TT0ZUSVJRKTsKICAgICAgICAgICAgICAg
ICAgICAgfQogICAgICAgICAgICAgICAgICAgICBzdmMtPmJ1ZGdldCA9IDA7Ci0gICAgICAgICAg
ICAgICAgICAgIGl0ZW1fc2NoZWR1bGVfdW5sb2NrKGxvY2ssIHN2Yy0+dmNwdS0+c2NoZWRfaXRl
bSk7CisgICAgICAgICAgICAgICAgICAgIGl0ZW1fc2NoZWR1bGVfdW5sb2NrKGxvY2ssIGl0ZW0p
OwogICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgIH0KIApAQCAtMjk3MywzMCArMjk2Mywz
MCBAQCBjc2NoZWQyX2RvbV9jbnRsKAogCiAgICAgICAgICAgICBzdG9wX3RpbWVyKCZzZG9tLT5y
ZXBsX3RpbWVyKTsKIAotICAgICAgICAgICAgLyogRGlzYWJsZSBidWRnZXQgYWNjb3VudGluZyBm
b3IgYWxsIHRoZSB2Q1BVcy4gKi8KLSAgICAgICAgICAgIGZvcl9lYWNoX3ZjcHUgKCBkLCB2ICkK
KyAgICAgICAgICAgIC8qIERpc2FibGUgYnVkZ2V0IGFjY291bnRpbmcgZm9yIGFsbCB0aGUgaXRl
bXMuICovCisgICAgICAgICAgICBmb3JfZWFjaF9zY2hlZF9pdGVtICggZCwgaXRlbSApCiAgICAg
ICAgICAgICB7Ci0gICAgICAgICAgICAgICAgc3RydWN0IGNzY2hlZDJfaXRlbSAqc3ZjID0gY3Nj
aGVkMl9pdGVtKHYtPnNjaGVkX2l0ZW0pOwotICAgICAgICAgICAgICAgIHNwaW5sb2NrX3QgKmxv
Y2sgPSBpdGVtX3NjaGVkdWxlX2xvY2soc3ZjLT52Y3B1LT5zY2hlZF9pdGVtKTsKKyAgICAgICAg
ICAgICAgICBzdHJ1Y3QgY3NjaGVkMl9pdGVtICpzdmMgPSBjc2NoZWQyX2l0ZW0oaXRlbSk7Cisg
ICAgICAgICAgICAgICAgc3BpbmxvY2tfdCAqbG9jayA9IGl0ZW1fc2NoZWR1bGVfbG9jayhpdGVt
KTsKIAogICAgICAgICAgICAgICAgIHN2Yy0+YnVkZ2V0ID0gU1RJTUVfTUFYOwogICAgICAgICAg
ICAgICAgIHN2Yy0+YnVkZ2V0X3F1b3RhID0gMDsKIAotICAgICAgICAgICAgICAgIGl0ZW1fc2No
ZWR1bGVfdW5sb2NrKGxvY2ssIHN2Yy0+dmNwdS0+c2NoZWRfaXRlbSk7CisgICAgICAgICAgICAg
ICAgaXRlbV9zY2hlZHVsZV91bmxvY2sobG9jaywgaXRlbSk7CiAgICAgICAgICAgICB9CiAgICAg
ICAgICAgICBzZG9tLT5jYXAgPSAwOwogICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAqIFdl
IGFyZSBkaXNhYmxpbmcgdGhlIGNhcCBmb3IgdGhpcyBkb21haW4sIHdoaWNoIG1heSBoYXZlCi0g
ICAgICAgICAgICAgKiB2Q1BVcyB3YWl0aW5nIGZvciBhIHJlcGxlbmlzaG1lbnQsIHNvIHdlIHVu
cGFyayB0aGVtIGFsbC4KKyAgICAgICAgICAgICAqIGl0ZW1zIHdhaXRpbmcgZm9yIGEgcmVwbGVu
aXNobWVudCwgc28gd2UgdW5wYXJrIHRoZW0gYWxsLgogICAgICAgICAgICAgICogTm90ZSB0aGF0
LCBzaW5jZSB3ZSBoYXZlIGFscmVhZHkgZGlzYWJsZWQgYnVkZ2V0IGFjY291bnRpbmcKLSAgICAg
ICAgICAgICAqIGZvciBhbGwgdGhlIHZDUFVzIG9mIHRoZSBkb21haW4sIG5vIGN1cnJlbnRseSBy
dW5uaW5nIHZDUFUKLSAgICAgICAgICAgICAqIHdpbGwgYmUgYWRkZWQgdG8gdGhlIHBhcmtlZCB2
Q1BVcyBsaXN0IGFueSBsb25nZXIuCisgICAgICAgICAgICAgKiBmb3IgYWxsIHRoZSBpdGVtcyBv
ZiB0aGUgZG9tYWluLCBubyBjdXJyZW50bHkgcnVubmluZyBpdGVtCisgICAgICAgICAgICAgKiB3
aWxsIGJlIGFkZGVkIHRvIHRoZSBwYXJrZWQgaXRlbXMgbGlzdCBhbnkgbG9uZ2VyLgogICAgICAg
ICAgICAgICovCiAgICAgICAgICAgICBzcGluX2xvY2soJnNkb20tPmJ1ZGdldF9sb2NrKTsKLSAg
ICAgICAgICAgIGxpc3Rfc3BsaWNlX2luaXQoJnNkb20tPnBhcmtlZF92Y3B1cywgJnBhcmtlZCk7
CisgICAgICAgICAgICBsaXN0X3NwbGljZV9pbml0KCZzZG9tLT5wYXJrZWRfaXRlbXMsICZwYXJr
ZWQpOwogICAgICAgICAgICAgc3Bpbl91bmxvY2soJnNkb20tPmJ1ZGdldF9sb2NrKTsKIAotICAg
ICAgICAgICAgdW5wYXJrX3BhcmtlZF92Y3B1cyhvcHMsICZwYXJrZWQpOworICAgICAgICAgICAg
dW5wYXJrX3BhcmtlZF9pdGVtcyhvcHMsICZwYXJrZWQpOwogICAgICAgICB9CiAgICAgICAgIHdy
aXRlX3VubG9ja19pcnFyZXN0b3JlKCZwcnYtPmxvY2ssIGZsYWdzKTsKICAgICAgICAgYnJlYWs7
CkBAIC0zMDczLDEyICszMDYzLDEyIEBAIGNzY2hlZDJfYWxsb2NfZG9tZGF0YShjb25zdCBzdHJ1
Y3Qgc2NoZWR1bGVyICpvcHMsIHN0cnVjdCBkb21haW4gKmRvbSkKICAgICBzZG9tLT5kb20gPSBk
b207CiAgICAgc2RvbS0+d2VpZ2h0ID0gQ1NDSEVEMl9ERUZBVUxUX1dFSUdIVDsKICAgICBzZG9t
LT5jYXAgPSAwVTsKLSAgICBzZG9tLT5ucl92Y3B1cyA9IDA7CisgICAgc2RvbS0+bnJfaXRlbXMg
PSAwOwogCiAgICAgaW5pdF90aW1lcigmc2RvbS0+cmVwbF90aW1lciwgcmVwbGVuaXNoX2RvbWFp
bl9idWRnZXQsIHNkb20sCiAgICAgICAgICAgICAgICBjcHVtYXNrX2FueShjcHVwb29sX2RvbWFp
bl9jcHVtYXNrKGRvbSkpKTsKICAgICBzcGluX2xvY2tfaW5pdCgmc2RvbS0+YnVkZ2V0X2xvY2sp
OwotICAgIElOSVRfTElTVF9IRUFEKCZzZG9tLT5wYXJrZWRfdmNwdXMpOworICAgIElOSVRfTElT
VF9IRUFEKCZzZG9tLT5wYXJrZWRfaXRlbXMpOwogCiAgICAgd3JpdGVfbG9ja19pcnFzYXZlKCZw
cnYtPmxvY2ssIGZsYWdzKTsKIApAQCAtMzExMiwzNCArMzEwMiwzMiBAQCBjc2NoZWQyX2ZyZWVf
ZG9tZGF0YShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHZvaWQgKmRhdGEpCiBzdGF0aWMg
dm9pZAogY3NjaGVkMl9pdGVtX2luc2VydChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIHN0
cnVjdCBzY2hlZF9pdGVtICppdGVtKQogewotICAgIHN0cnVjdCB2Y3B1ICp2YyA9IGl0ZW0tPnZj
cHU7CiAgICAgc3RydWN0IGNzY2hlZDJfaXRlbSAqc3ZjID0gaXRlbS0+cHJpdjsKICAgICBzdHJ1
Y3QgY3NjaGVkMl9kb20gKiBjb25zdCBzZG9tID0gc3ZjLT5zZG9tOwogICAgIHNwaW5sb2NrX3Qg
KmxvY2s7CiAKLSAgICBBU1NFUlQoIWlzX2lkbGVfdmNwdSh2YykpOworICAgIEFTU0VSVCghaXNf
aWRsZV9pdGVtKGl0ZW0pKTsKICAgICBBU1NFUlQobGlzdF9lbXB0eSgmc3ZjLT5ydW5xX2VsZW0p
KTsKIAogICAgIC8qIGNzY2hlZDJfcmVzX3BpY2soKSBleHBlY3RzIHRoZSBwY3B1IGxvY2sgdG8g
YmUgaGVsZCAqLwogICAgIGxvY2sgPSBpdGVtX3NjaGVkdWxlX2xvY2tfaXJxKGl0ZW0pOwogCi0g
ICAgaXRlbS0+cmVzID0gY3NjaGVkMl9yZXNfcGljayhvcHMsIGl0ZW0pOwotICAgIHZjLT5wcm9j
ZXNzb3IgPSBpdGVtLT5yZXMtPnByb2Nlc3NvcjsKKyAgICBzY2hlZF9zZXRfcmVzKGl0ZW0sIGNz
Y2hlZDJfcmVzX3BpY2sob3BzLCBpdGVtKSk7CiAKICAgICBzcGluX3VubG9ja19pcnEobG9jayk7
CiAKICAgICBsb2NrID0gaXRlbV9zY2hlZHVsZV9sb2NrX2lycShpdGVtKTsKIAotICAgIC8qIEFk
ZCB2Y3B1IHRvIHJ1bnF1ZXVlIG9mIGluaXRpYWwgcHJvY2Vzc29yICovCi0gICAgcnVucV9hc3Np
Z24ob3BzLCB2Yyk7CisgICAgLyogQWRkIGl0ZW0gdG8gcnVucXVldWUgb2YgaW5pdGlhbCBwcm9j
ZXNzb3IgKi8KKyAgICBydW5xX2Fzc2lnbihvcHMsIGl0ZW0pOwogCiAgICAgaXRlbV9zY2hlZHVs
ZV91bmxvY2tfaXJxKGxvY2ssIGl0ZW0pOwogCi0gICAgc2RvbS0+bnJfdmNwdXMrKzsKKyAgICBz
ZG9tLT5ucl9pdGVtcysrOwogCiAgICAgU0NIRURfU1RBVF9DUkFOSyhpdGVtX2luc2VydCk7CiAK
LSAgICBDU0NIRUQyX1ZDUFVfQ0hFQ0sodmMpOworICAgIENTQ0hFRDJfSVRFTV9DSEVDSyhpdGVt
KTsKIH0KIAogc3RhdGljIHZvaWQKQEAgLTMxNTMsMTEgKzMxNDEsMTAgQEAgY3NjaGVkMl9mcmVl
X3ZkYXRhKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgdm9pZCAqcHJpdikKIHN0YXRpYyB2
b2lkCiBjc2NoZWQyX2l0ZW1fcmVtb3ZlKGNvbnN0IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgc3Ry
dWN0IHNjaGVkX2l0ZW0gKml0ZW0pCiB7Ci0gICAgc3RydWN0IHZjcHUgKnZjID0gaXRlbS0+dmNw
dTsKICAgICBzdHJ1Y3QgY3NjaGVkMl9pdGVtICogY29uc3Qgc3ZjID0gY3NjaGVkMl9pdGVtKGl0
ZW0pOwogICAgIHNwaW5sb2NrX3QgKmxvY2s7CiAKLSAgICBBU1NFUlQoIWlzX2lkbGVfdmNwdSh2
YykpOworICAgIEFTU0VSVCghaXNfaWRsZV9pdGVtKGl0ZW0pKTsKICAgICBBU1NFUlQobGlzdF9l
bXB0eSgmc3ZjLT5ydW5xX2VsZW0pKTsKIAogICAgIFNDSEVEX1NUQVRfQ1JBTksoaXRlbV9yZW1v
dmUpOwpAQCAtMzE2NSwxNCArMzE1MiwxNCBAQCBjc2NoZWQyX2l0ZW1fcmVtb3ZlKGNvbnN0IHN0
cnVjdCBzY2hlZHVsZXIgKm9wcywgc3RydWN0IHNjaGVkX2l0ZW0gKml0ZW0pCiAgICAgLyogUmVt
b3ZlIGZyb20gcnVucXVldWUgKi8KICAgICBsb2NrID0gaXRlbV9zY2hlZHVsZV9sb2NrX2lycShp
dGVtKTsKIAotICAgIHJ1bnFfZGVhc3NpZ24ob3BzLCB2Yyk7CisgICAgcnVucV9kZWFzc2lnbihv
cHMsIGl0ZW0pOwogCiAgICAgaXRlbV9zY2hlZHVsZV91bmxvY2tfaXJxKGxvY2ssIGl0ZW0pOwog
Ci0gICAgc3ZjLT5zZG9tLT5ucl92Y3B1cy0tOworICAgIHN2Yy0+c2RvbS0+bnJfaXRlbXMtLTsK
IH0KIAotLyogSG93IGxvbmcgc2hvdWxkIHdlIGxldCB0aGlzIHZjcHUgcnVuIGZvcj8gKi8KKy8q
IEhvdyBsb25nIHNob3VsZCB3ZSBsZXQgdGhpcyBpdGVtIHJ1biBmb3I/ICovCiBzdGF0aWMgc190
aW1lX3QKIGNzY2hlZDJfcnVudGltZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGludCBj
cHUsCiAgICAgICAgICAgICAgICAgc3RydWN0IGNzY2hlZDJfaXRlbSAqc25leHQsIHNfdGltZV90
IG5vdykKQEAgLTMxODcsNyArMzE3NCw3IEBAIGNzY2hlZDJfcnVudGltZShjb25zdCBzdHJ1Y3Qg
c2NoZWR1bGVyICpvcHMsIGludCBjcHUsCiAgICAgICogSWYgd2UncmUgaWRsZSwganVzdCBzdGF5
IHNvLiBPdGhlcnMgKG9yIGV4dGVybmFsIGV2ZW50cykKICAgICAgKiB3aWxsIHBva2UgdXMgd2hl
biBuZWNlc3NhcnkuCiAgICAgICovCi0gICAgaWYgKCBpc19pZGxlX3ZjcHUoc25leHQtPnZjcHUp
ICkKKyAgICBpZiAoIGlzX2lkbGVfaXRlbShzbmV4dC0+aXRlbSkgKQogICAgICAgICByZXR1cm4g
LTE7CiAKICAgICAvKiBHZW5lcmFsIGFsZ29yaXRobToKQEAgLTMyMDQsOCArMzE5MSw4IEBAIGNz
Y2hlZDJfcnVudGltZShjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMsIGludCBjcHUsCiAgICAg
aWYgKCBwcnYtPnJhdGVsaW1pdF91cyApCiAgICAgewogICAgICAgICBzX3RpbWVfdCByYXRlbGlt
aXRfbWluID0gTUlDUk9TRUNTKHBydi0+cmF0ZWxpbWl0X3VzKTsKLSAgICAgICAgaWYgKCBzbmV4
dC0+dmNwdS0+c2NoZWRfaXRlbS0+aXNfcnVubmluZyApCi0gICAgICAgICAgICByYXRlbGltaXRf
bWluID0gc25leHQtPnZjcHUtPnNjaGVkX2l0ZW0tPnN0YXRlX2VudHJ5X3RpbWUgKworICAgICAg
ICBpZiAoIHNuZXh0LT5pdGVtLT5pc19ydW5uaW5nICkKKyAgICAgICAgICAgIHJhdGVsaW1pdF9t
aW4gPSBzbmV4dC0+aXRlbS0+c3RhdGVfZW50cnlfdGltZSArCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgTUlDUk9TRUNTKHBydi0+cmF0ZWxpbWl0X3VzKSAtIG5vdzsKICAgICAgICAgaWYg
KCByYXRlbGltaXRfbWluID4gbWluX3RpbWUgKQogICAgICAgICAgICAgbWluX3RpbWUgPSByYXRl
bGltaXRfbWluOwpAQCAtMzIyMiw3ICszMjA5LDcgQEAgY3NjaGVkMl9ydW50aW1lKGNvbnN0IHN0
cnVjdCBzY2hlZHVsZXIgKm9wcywgaW50IGNwdSwKICAgICB7CiAgICAgICAgIHN0cnVjdCBjc2No
ZWQyX2l0ZW0gKnN3YWl0ID0gcnVucV9lbGVtKHJ1bnEtPm5leHQpOwogCi0gICAgICAgIGlmICgg
ISBpc19pZGxlX3ZjcHUoc3dhaXQtPnZjcHUpCisgICAgICAgIGlmICggISBpc19pZGxlX2l0ZW0o
c3dhaXQtPml0ZW0pCiAgICAgICAgICAgICAgJiYgc3dhaXQtPmNyZWRpdCA+IDAgKQogICAgICAg
ICB7CiAgICAgICAgICAgICBydF9jcmVkaXQgPSBzbmV4dC0+Y3JlZGl0IC0gc3dhaXQtPmNyZWRp
dDsKQEAgLTMyMzYsNyArMzIyMyw3IEBAIGNzY2hlZDJfcnVudGltZShjb25zdCBzdHJ1Y3Qgc2No
ZWR1bGVyICpvcHMsIGludCBjcHUsCiAgICAgICoKICAgICAgKiBGSVhNRTogU2VlIGlmIHdlIGNh
biBlbGltaW5hdGUgdGhpcyBjb252ZXJzaW9uIGlmIHdlIGtub3cgdGltZQogICAgICAqIHdpbGwg
YmUgb3V0c2lkZSAoTUlOLE1BWCkuICBQcm9iYWJseSByZXF1aXJlcyBwcmUtY2FsY3VsYXRpbmcK
LSAgICAgKiBjcmVkaXQgdmFsdWVzIG9mIE1JTixNQVggcGVyIHZjcHUsIHNpbmNlIGVhY2ggdmNw
dSBidXJucyBjcmVkaXQKKyAgICAgKiBjcmVkaXQgdmFsdWVzIG9mIE1JTixNQVggcGVyIGl0ZW0s
IHNpbmNlIGVhY2ggaXRlbSBidXJucyBjcmVkaXQKICAgICAgKiBhdCBhIGRpZmZlcmVudCByYXRl
LgogICAgICAqLwogICAgIGlmICggcnRfY3JlZGl0ID4gMCApCkBAIC0zMjg0LDM2ICszMjcxLDM1
IEBAIHJ1bnFfY2FuZGlkYXRlKHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJxZCwKIAog
ICAgICpza2lwcGVkID0gMDsKIAotICAgIGlmICggdW5saWtlbHkoaXNfaWRsZV92Y3B1KHNjdXJy
LT52Y3B1KSkgKQorICAgIGlmICggdW5saWtlbHkoaXNfaWRsZV9pdGVtKHNjdXJyLT5pdGVtKSkg
KQogICAgIHsKICAgICAgICAgc25leHQgPSBzY3VycjsKICAgICAgICAgZ290byBjaGVja19ydW5x
OwogICAgIH0KIAotICAgIHlpZWxkID0gX190ZXN0X2FuZF9jbGVhcl9iaXQoX19DU0ZMQUdfdmNw
dV95aWVsZCwgJnNjdXJyLT5mbGFncyk7CisgICAgeWllbGQgPSBfX3Rlc3RfYW5kX2NsZWFyX2Jp
dChfX0NTRkxBR19pdGVtX3lpZWxkLCAmc2N1cnItPmZsYWdzKTsKIAogICAgIC8qCi0gICAgICog
UmV0dXJuIHRoZSBjdXJyZW50IHZjcHUgaWYgaXQgaGFzIGV4ZWN1dGVkIGZvciBsZXNzIHRoYW4g
cmF0ZWxpbWl0LgotICAgICAqIEFkanVzdHN0bWVudCBmb3IgdGhlIHNlbGVjdGVkIHZjcHUncyBj
cmVkaXQgYW5kIGRlY2lzaW9uCisgICAgICogUmV0dXJuIHRoZSBjdXJyZW50IGl0ZW0gaWYgaXQg
aGFzIGV4ZWN1dGVkIGZvciBsZXNzIHRoYW4gcmF0ZWxpbWl0LgorICAgICAqIEFkanVzdHN0bWVu
dCBmb3IgdGhlIHNlbGVjdGVkIGl0ZW0ncyBjcmVkaXQgYW5kIGRlY2lzaW9uCiAgICAgICogZm9y
IGhvdyBsb25nIGl0IHdpbGwgcnVuIHdpbGwgYmUgdGFrZW4gaW4gY3NjaGVkMl9ydW50aW1lLgog
ICAgICAqCiAgICAgICogTm90ZSB0aGF0LCBpZiBzY3VyciBpcyB5aWVsZGluZywgd2UgZG9uJ3Qg
bGV0IHJhdGUgbGltaXRpbmcga2ljayBpbi4KICAgICAgKiBJbiBmYWN0LCBpdCBtYXkgYmUgdGhl
IGNhc2UgdGhhdCBzY3VyciBpcyBhYm91dCB0byBzcGluLCBhbmQgdGhlcmUncwogICAgICAqIG5v
IHBvaW50IGZvcmNpbmcgaXQgdG8gZG8gc28gdW50aWwgcmF0ZSBsaW1pdGluZyBleHBpcmVzLgog
ICAgICAqLwotICAgIGlmICggIXlpZWxkICYmIHBydi0+cmF0ZWxpbWl0X3VzICYmIHZjcHVfcnVu
bmFibGUoc2N1cnItPnZjcHUpICYmCi0gICAgICAgICAobm93IC0gc2N1cnItPnZjcHUtPnNjaGVk
X2l0ZW0tPnN0YXRlX2VudHJ5X3RpbWUpIDwKLSAgICAgICAgICBNSUNST1NFQ1MocHJ2LT5yYXRl
bGltaXRfdXMpICkKKyAgICBpZiAoICF5aWVsZCAmJiBwcnYtPnJhdGVsaW1pdF91cyAmJiBpdGVt
X3J1bm5hYmxlKHNjdXJyLT5pdGVtKSAmJgorICAgICAgICAgKG5vdyAtIHNjdXJyLT5pdGVtLT5z
dGF0ZV9lbnRyeV90aW1lKSA8IE1JQ1JPU0VDUyhwcnYtPnJhdGVsaW1pdF91cykgKQogICAgIHsK
ICAgICAgICAgaWYgKCB1bmxpa2VseSh0Yl9pbml0X2RvbmUpICkKICAgICAgICAgewogICAgICAg
ICAgICAgc3RydWN0IHsKLSAgICAgICAgICAgICAgICB1bnNpZ25lZCB2Y3B1OjE2LCBkb206MTY7
CisgICAgICAgICAgICAgICAgdW5zaWduZWQgaXRlbToxNiwgZG9tOjE2OwogICAgICAgICAgICAg
ICAgIHVuc2lnbmVkIHJ1bnRpbWU7CiAgICAgICAgICAgICB9IGQ7Ci0gICAgICAgICAgICBkLmRv
bSA9IHNjdXJyLT52Y3B1LT5kb21haW4tPmRvbWFpbl9pZDsKLSAgICAgICAgICAgIGQudmNwdSA9
IHNjdXJyLT52Y3B1LT52Y3B1X2lkOwotICAgICAgICAgICAgZC5ydW50aW1lID0gbm93IC0gc2N1
cnItPnZjcHUtPnNjaGVkX2l0ZW0tPnN0YXRlX2VudHJ5X3RpbWU7CisgICAgICAgICAgICBkLmRv
bSA9IHNjdXJyLT5pdGVtLT5kb21haW4tPmRvbWFpbl9pZDsKKyAgICAgICAgICAgIGQuaXRlbSA9
IHNjdXJyLT5pdGVtLT5pdGVtX2lkOworICAgICAgICAgICAgZC5ydW50aW1lID0gbm93IC0gc2N1
cnItPml0ZW0tPnN0YXRlX2VudHJ5X3RpbWU7CiAgICAgICAgICAgICBfX3RyYWNlX3ZhcihUUkNf
Q1NDSEVEMl9SQVRFTElNSVQsIDEsCiAgICAgICAgICAgICAgICAgICAgICAgICBzaXplb2YoZCks
CiAgICAgICAgICAgICAgICAgICAgICAgICAodW5zaWduZWQgY2hhciAqKSZkKTsKQEAgLTMzMjIs
MTMgKzMzMDgsMTMgQEAgcnVucV9jYW5kaWRhdGUoc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0
YSAqcnFkLAogICAgIH0KIAogICAgIC8qIElmIHNjdXJyIGhhcyBhIHNvZnQtYWZmaW5pdHksIGxl
dCdzIGNoZWNrIHdoZXRoZXIgY3B1IGlzIHBhcnQgb2YgaXQgKi8KLSAgICBpZiAoIGhhc19zb2Z0
X2FmZmluaXR5KHNjdXJyLT52Y3B1LT5zY2hlZF9pdGVtKSApCisgICAgaWYgKCBoYXNfc29mdF9h
ZmZpbml0eShzY3Vyci0+aXRlbSkgKQogICAgIHsKLSAgICAgICAgYWZmaW5pdHlfYmFsYW5jZV9j
cHVtYXNrKHNjdXJyLT52Y3B1LT5zY2hlZF9pdGVtLCBCQUxBTkNFX1NPRlRfQUZGSU5JVFksCisg
ICAgICAgIGFmZmluaXR5X2JhbGFuY2VfY3B1bWFzayhzY3Vyci0+aXRlbSwgQkFMQU5DRV9TT0ZU
X0FGRklOSVRZLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3B1bWFza19zY3Jh
dGNoKTsKICAgICAgICAgaWYgKCB1bmxpa2VseSghY3B1bWFza190ZXN0X2NwdShjcHUsIGNwdW1h
c2tfc2NyYXRjaCkpICkKICAgICAgICAgewotICAgICAgICAgICAgY3B1bWFza190ICpvbmxpbmUg
PSBjcHVwb29sX2RvbWFpbl9jcHVtYXNrKHNjdXJyLT52Y3B1LT5kb21haW4pOworICAgICAgICAg
ICAgY3B1bWFza190ICpvbmxpbmUgPSBjcHVwb29sX2RvbWFpbl9jcHVtYXNrKHNjdXJyLT5pdGVt
LT5kb21haW4pOwogCiAgICAgICAgICAgICAvKiBPaywgaXMgYW55IG9mIHRoZSBwY3B1cyBpbiBz
Y3VyciBzb2Z0LWFmZmluaXR5IGlkbGU/ICovCiAgICAgICAgICAgICBjcHVtYXNrX2FuZChjcHVt
YXNrX3NjcmF0Y2gsIGNwdW1hc2tfc2NyYXRjaCwgJnJxZC0+aWRsZSk7CkBAIC0zMzU2LDEwICsz
MzQyLDEwIEBAIHJ1bnFfY2FuZGlkYXRlKHN0cnVjdCBjc2NoZWQyX3J1bnF1ZXVlX2RhdGEgKnJx
ZCwKICAgICAgKgogICAgICAqIE9mIGNvdXJzZSwgd2UgYWxzbyBkZWZhdWx0IHRvIGlkbGUgYWxz
byBpZiBzY3VyciBpcyBub3QgcnVubmFibGUuCiAgICAgICovCi0gICAgaWYgKCB2Y3B1X3J1bm5h
YmxlKHNjdXJyLT52Y3B1KSAmJiAhc29mdF9hZmZfcHJlZW1wdCApCisgICAgaWYgKCBpdGVtX3J1
bm5hYmxlKHNjdXJyLT5pdGVtKSAmJiAhc29mdF9hZmZfcHJlZW1wdCApCiAgICAgICAgIHNuZXh0
ID0gc2N1cnI7CiAgICAgZWxzZQotICAgICAgICBzbmV4dCA9IGNzY2hlZDJfaXRlbShpZGxlX3Zj
cHVbY3B1XS0+c2NoZWRfaXRlbSk7CisgICAgICAgIHNuZXh0ID0gY3NjaGVkMl9pdGVtKHNjaGVk
X2lkbGVfaXRlbShjcHUpKTsKIAogIGNoZWNrX3J1bnE6CiAgICAgbGlzdF9mb3JfZWFjaF9zYWZl
KCBpdGVyLCB0ZW1wLCAmcnFkLT5ydW5xICkKQEAgLTMzNjksMjQgKzMzNTUsMjQgQEAgcnVucV9j
YW5kaWRhdGUoc3RydWN0IGNzY2hlZDJfcnVucXVldWVfZGF0YSAqcnFkLAogICAgICAgICBpZiAo
IHVubGlrZWx5KHRiX2luaXRfZG9uZSkgKQogICAgICAgICB7CiAgICAgICAgICAgICBzdHJ1Y3Qg
ewotICAgICAgICAgICAgICAgIHVuc2lnbmVkIHZjcHU6MTYsIGRvbToxNjsKKyAgICAgICAgICAg
ICAgICB1bnNpZ25lZCBpdGVtOjE2LCBkb206MTY7CiAgICAgICAgICAgICB9IGQ7Ci0gICAgICAg
ICAgICBkLmRvbSA9IHN2Yy0+dmNwdS0+ZG9tYWluLT5kb21haW5faWQ7Ci0gICAgICAgICAgICBk
LnZjcHUgPSBzdmMtPnZjcHUtPnZjcHVfaWQ7CisgICAgICAgICAgICBkLmRvbSA9IHN2Yy0+aXRl
bS0+ZG9tYWluLT5kb21haW5faWQ7CisgICAgICAgICAgICBkLml0ZW0gPSBzdmMtPml0ZW0tPml0
ZW1faWQ7CiAgICAgICAgICAgICBfX3RyYWNlX3ZhcihUUkNfQ1NDSEVEMl9SVU5RX0NBTkRfQ0hF
Q0ssIDEsCiAgICAgICAgICAgICAgICAgICAgICAgICBzaXplb2YoZCksCiAgICAgICAgICAgICAg
ICAgICAgICAgICAodW5zaWduZWQgY2hhciAqKSZkKTsKICAgICAgICAgfQogCi0gICAgICAgIC8q
IE9ubHkgY29uc2lkZXIgdmNwdXMgdGhhdCBhcmUgYWxsb3dlZCB0byBydW4gb24gdGhpcyBwcm9j
ZXNzb3IuICovCi0gICAgICAgIGlmICggIWNwdW1hc2tfdGVzdF9jcHUoY3B1LCBzdmMtPnZjcHUt
PnNjaGVkX2l0ZW0tPmNwdV9oYXJkX2FmZmluaXR5KSApCisgICAgICAgIC8qIE9ubHkgY29uc2lk
ZXIgaXRlbXMgdGhhdCBhcmUgYWxsb3dlZCB0byBydW4gb24gdGhpcyBwcm9jZXNzb3IuICovCisg
ICAgICAgIGlmICggIWNwdW1hc2tfdGVzdF9jcHUoY3B1LCBzdmMtPml0ZW0tPmNwdV9oYXJkX2Fm
ZmluaXR5KSApCiAgICAgICAgIHsKICAgICAgICAgICAgICgqc2tpcHBlZCkrKzsKICAgICAgICAg
ICAgIGNvbnRpbnVlOwogICAgICAgICB9CiAKICAgICAgICAgLyoKLSAgICAgICAgICogSWYgYSB2
Y3B1IGlzIG1lYW50IHRvIGJlIHBpY2tlZCB1cCBieSBhbm90aGVyIHByb2Nlc3NvciwgYW5kIHN1
Y2gKKyAgICAgICAgICogSWYgYW4gaXRlbSBpcyBtZWFudCB0byBiZSBwaWNrZWQgdXAgYnkgYW5v
dGhlciBwcm9jZXNzb3IsIGFuZCBzdWNoCiAgICAgICAgICAqIHByb2Nlc3NvciBoYXMgbm90IHNj
aGVkdWxlZCB5ZXQsIGxlYXZlIGl0IGluIHRoZSBydW5xdWV1ZSBmb3IgaGltLgogICAgICAgICAg
Ki8KICAgICAgICAgaWYgKCBzdmMtPnRpY2tsZWRfY3B1ICE9IC0xICYmIHN2Yy0+dGlja2xlZF9j
cHUgIT0gY3B1ICYmCkBAIC0zNDAxLDcgKzMzODcsNyBAQCBydW5xX2NhbmRpZGF0ZShzdHJ1Y3Qg
Y3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQsCiAgICAgICAgICAqIElmIHRoaXMgaXMgb24gYSBk
aWZmZXJlbnQgcHJvY2Vzc29yLCBkb24ndCBwdWxsIGl0IHVubGVzcwogICAgICAgICAgKiBpdHMg
Y3JlZGl0IGlzIGF0IGxlYXN0IENTQ0hFRDJfTUlHUkFURV9SRVNJU1QgaGlnaGVyLgogICAgICAg
ICAgKi8KLSAgICAgICAgaWYgKCBzdmMtPnZjcHUtPnByb2Nlc3NvciAhPSBjcHUKKyAgICAgICAg
aWYgKCBzY2hlZF9pdGVtX2NwdShzdmMtPml0ZW0pICE9IGNwdQogICAgICAgICAgICAgICYmIHNu
ZXh0LT5jcmVkaXQgKyBDU0NIRUQyX01JR1JBVEVfUkVTSVNUID4gc3ZjLT5jcmVkaXQgKQogICAg
ICAgICB7CiAgICAgICAgICAgICAoKnNraXBwZWQpKys7CkBAIC0zNDE2LDcgKzM0MDIsNyBAQCBy
dW5xX2NhbmRpZGF0ZShzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQsCiAgICAgICAg
ICAqIHNvbWUgYnVkZ2V0LCB0aGVuIGNob29zZSBpdC4KICAgICAgICAgICovCiAgICAgICAgIGlm
ICggKHlpZWxkIHx8IHN2Yy0+Y3JlZGl0ID4gc25leHQtPmNyZWRpdCkgJiYKLSAgICAgICAgICAg
ICAoIWhhc19jYXAoc3ZjKSB8fCB2Y3B1X2dyYWJfYnVkZ2V0KHN2YykpICkKKyAgICAgICAgICAg
ICAoIWhhc19jYXAoc3ZjKSB8fCBpdGVtX2dyYWJfYnVkZ2V0KHN2YykpICkKICAgICAgICAgICAg
IHNuZXh0ID0gc3ZjOwogCiAgICAgICAgIC8qIEluIGFueSBjYXNlLCBpZiB3ZSBnb3QgdGhpcyBm
YXIsIGJyZWFrLiAqLwpAQCAtMzQyNiwxMiArMzQxMiwxMiBAQCBydW5xX2NhbmRpZGF0ZShzdHJ1
Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQsCiAgICAgaWYgKCB1bmxpa2VseSh0Yl9pbml0
X2RvbmUpICkKICAgICB7CiAgICAgICAgIHN0cnVjdCB7Ci0gICAgICAgICAgICB1bnNpZ25lZCB2
Y3B1OjE2LCBkb206MTY7CisgICAgICAgICAgICB1bnNpZ25lZCBpdGVtOjE2LCBkb206MTY7CiAg
ICAgICAgICAgICB1bnNpZ25lZCB0aWNrbGVkX2NwdSwgc2tpcHBlZDsKICAgICAgICAgICAgIGlu
dCBjcmVkaXQ7CiAgICAgICAgIH0gZDsKLSAgICAgICAgZC5kb20gPSBzbmV4dC0+dmNwdS0+ZG9t
YWluLT5kb21haW5faWQ7Ci0gICAgICAgIGQudmNwdSA9IHNuZXh0LT52Y3B1LT52Y3B1X2lkOwor
ICAgICAgICBkLmRvbSA9IHNuZXh0LT5pdGVtLT5kb21haW4tPmRvbWFpbl9pZDsKKyAgICAgICAg
ZC5pdGVtID0gc25leHQtPml0ZW0tPml0ZW1faWQ7CiAgICAgICAgIGQuY3JlZGl0ID0gc25leHQt
PmNyZWRpdDsKICAgICAgICAgZC50aWNrbGVkX2NwdSA9IHNuZXh0LT50aWNrbGVkX2NwdTsKICAg
ICAgICAgZC5za2lwcGVkID0gKnNraXBwZWQ7CkBAIC0zNDYzLDE0ICszNDQ5LDE1IEBAIGNzY2hl
ZDJfc2NoZWR1bGUoCiB7CiAgICAgY29uc3QgaW50IGNwdSA9IHNtcF9wcm9jZXNzb3JfaWQoKTsK
ICAgICBzdHJ1Y3QgY3NjaGVkMl9ydW5xdWV1ZV9kYXRhICpycWQ7Ci0gICAgc3RydWN0IGNzY2hl
ZDJfaXRlbSAqIGNvbnN0IHNjdXJyID0gY3NjaGVkMl9pdGVtKGN1cnJlbnQtPnNjaGVkX2l0ZW0p
OworICAgIHN0cnVjdCBzY2hlZF9pdGVtICpjdXJyaXRlbSA9IGN1cnJlbnQtPnNjaGVkX2l0ZW07
CisgICAgc3RydWN0IGNzY2hlZDJfaXRlbSAqIGNvbnN0IHNjdXJyID0gY3NjaGVkMl9pdGVtKGN1
cnJpdGVtKTsKICAgICBzdHJ1Y3QgY3NjaGVkMl9pdGVtICpzbmV4dCA9IE5VTEw7Ci0gICAgdW5z
aWduZWQgaW50IHNraXBwZWRfdmNwdXMgPSAwOworICAgIHVuc2lnbmVkIGludCBza2lwcGVkX2l0
ZW1zID0gMDsKICAgICBzdHJ1Y3QgdGFza19zbGljZSByZXQ7CiAgICAgYm9vbCB0aWNrbGVkOwog
CiAgICAgU0NIRURfU1RBVF9DUkFOSyhzY2hlZHVsZSk7Ci0gICAgQ1NDSEVEMl9WQ1BVX0NIRUNL
KGN1cnJlbnQpOworICAgIENTQ0hFRDJfSVRFTV9DSEVDSyhjdXJyaXRlbSk7CiAKICAgICBCVUdf
T04oIWNwdW1hc2tfdGVzdF9jcHUoY3B1LCAmY3NjaGVkMl9wcml2KG9wcyktPmluaXRpYWxpemVk
KSk7CiAKQEAgLTM0NzksNyArMzQ2Niw3IEBAIGNzY2hlZDJfc2NoZWR1bGUoCiAKICAgICBBU1NF
UlQoc3Bpbl9pc19sb2NrZWQocGVyX2NwdShzY2hlZF9yZXMsIGNwdSktPnNjaGVkdWxlX2xvY2sp
KTsKIAotICAgIEJVR19PTighaXNfaWRsZV92Y3B1KHNjdXJyLT52Y3B1KSAmJiBzY3Vyci0+cnFk
ICE9IHJxZCk7CisgICAgQlVHX09OKCFpc19pZGxlX2l0ZW0oY3Vycml0ZW0pICYmIHNjdXJyLT5y
cWQgIT0gcnFkKTsKIAogICAgIC8qIENsZWFyICJ0aWNrbGVkIiBiaXQgbm93IHRoYXQgd2UndmUg
YmVlbiBzY2hlZHVsZWQgKi8KICAgICB0aWNrbGVkID0gY3B1bWFza190ZXN0X2NwdShjcHUsICZy
cWQtPnRpY2tsZWQpOwpAQCAtMzQ5OSw3ICszNDg2LDcgQEAgY3NjaGVkMl9zY2hlZHVsZSgKICAg
ICAgICAgZC5jcHUgPSBjcHU7CiAgICAgICAgIGQucnFfaWQgPSBjMnIoY3B1KTsKICAgICAgICAg
ZC50YXNrbGV0ID0gdGFza2xldF93b3JrX3NjaGVkdWxlZDsKLSAgICAgICAgZC5pZGxlID0gaXNf
aWRsZV92Y3B1KGN1cnJlbnQpOworICAgICAgICBkLmlkbGUgPSBpc19pZGxlX2l0ZW0oY3Vycml0
ZW0pOwogICAgICAgICBkLnNtdF9pZGxlID0gY3B1bWFza190ZXN0X2NwdShjcHUsICZycWQtPnNt
dF9pZGxlKTsKICAgICAgICAgZC50aWNrbGVkID0gdGlja2xlZDsKICAgICAgICAgX190cmFjZV92
YXIoVFJDX0NTQ0hFRDJfU0NIRURVTEUsIDEsCkBAIC0zNTEzLDU1ICszNTAwLDU1IEBAIGNzY2hl
ZDJfc2NoZWR1bGUoCiAgICAgLyoKICAgICAgKiAgQmVsb3cgMCwgbWVhbnMgdGhhdCB3ZSBhcmUg
Y2FwcGVkIGFuZCB3ZSBoYXZlIG92ZXJydW4gb3VyICBidWRnZXQuCiAgICAgICogIExldCdzIHRy
eSB0byBnZXQgc29tZSBtb3JlIGJ1dCwgaWYgd2UgZmFpbCAoZS5nLiwgYmVjYXVzZSBvZiB0aGUK
LSAgICAgKiAgb3RoZXIgcnVubmluZyB2Y3B1cyksIHdlIHdpbGwgYmUgcGFya2VkLgorICAgICAq
ICBvdGhlciBydW5uaW5nIGl0ZW1zKSwgd2Ugd2lsbCBiZSBwYXJrZWQuCiAgICAgICovCiAgICAg
aWYgKCB1bmxpa2VseShzY3Vyci0+YnVkZ2V0IDw9IDApICkKLSAgICAgICAgdmNwdV9ncmFiX2J1
ZGdldChzY3Vycik7CisgICAgICAgIGl0ZW1fZ3JhYl9idWRnZXQoc2N1cnIpOwogCiAgICAgLyoK
LSAgICAgKiBTZWxlY3QgbmV4dCBydW5uYWJsZSBsb2NhbCBWQ1BVIChpZSB0b3Agb2YgbG9jYWwg
cnVucSkuCisgICAgICogU2VsZWN0IG5leHQgcnVubmFibGUgbG9jYWwgSVRFTSAoaWUgdG9wIG9m
IGxvY2FsIHJ1bnEpLgogICAgICAqCi0gICAgICogSWYgdGhlIGN1cnJlbnQgdmNwdSBpcyBydW5u
YWJsZSwgYW5kIGhhcyBoaWdoZXIgY3JlZGl0IHRoYW4KKyAgICAgKiBJZiB0aGUgY3VycmVudCBp
dGVtIGlzIHJ1bm5hYmxlLCBhbmQgaGFzIGhpZ2hlciBjcmVkaXQgdGhhbgogICAgICAqIHRoZSBu
ZXh0IGd1eSBvbiB0aGUgcXVldWUgKG9yIHRoZXJlIGlzIG5vb25lIGVsc2UpLCB3ZSB3YW50IHRv
CiAgICAgICogcnVuIGhpbSBhZ2Fpbi4KICAgICAgKgotICAgICAqIElmIHRoZXJlJ3MgdGFza2xl
dCB3b3JrIHRvIGRvLCB3ZSB3YW50IHRvIGNob3NlIHRoZSBpZGxlIHZjcHUKKyAgICAgKiBJZiB0
aGVyZSdzIHRhc2tsZXQgd29yayB0byBkbywgd2Ugd2FudCB0byBjaG9zZSB0aGUgaWRsZSBpdGVt
CiAgICAgICogZm9yIHRoaXMgcHJvY2Vzc29yLCBhbmQgbWFyayB0aGUgY3VycmVudCBmb3IgZGVs
YXllZCBydW5xdWV1ZQogICAgICAqIGFkZC4KICAgICAgKgotICAgICAqIElmIHRoZSBjdXJyZW50
IHZjcHUgaXMgcnVubmFibGUsIGFuZCB0aGVyZSdzIGFub3RoZXIgcnVubmFibGUKKyAgICAgKiBJ
ZiB0aGUgY3VycmVudCBpdGVtIGlzIHJ1bm5hYmxlLCBhbmQgdGhlcmUncyBhbm90aGVyIHJ1bm5h
YmxlCiAgICAgICogY2FuZGlkYXRlLCB3ZSB3YW50IHRvIG1hcmsgY3VycmVudCBmb3IgZGVsYXll
ZCBydW5xdWV1ZSBhZGQsCiAgICAgICogYW5kIHJlbW92ZSB0aGUgbmV4dCBndXkgZnJvbSB0aGUg
cXVldWUuCiAgICAgICoKLSAgICAgKiBJZiB0aGUgY3VycmVudCB2Y3B1IGlzIG5vdCBydW5uYWJs
ZSwgd2Ugd2FudCB0byBjaG9zZSB0aGUgaWRsZQotICAgICAqIHZjcHUgZm9yIHRoaXMgcHJvY2Vz
c29yLgorICAgICAqIElmIHRoZSBjdXJyZW50IGl0ZW0gaXMgbm90IHJ1bm5hYmxlLCB3ZSB3YW50
IHRvIGNob3NlIHRoZSBpZGxlCisgICAgICogaXRlbSBmb3IgdGhpcyBwcm9jZXNzb3IuCiAgICAg
ICovCiAgICAgaWYgKCB0YXNrbGV0X3dvcmtfc2NoZWR1bGVkICkKICAgICB7Ci0gICAgICAgIF9f
Y2xlYXJfYml0KF9fQ1NGTEFHX3ZjcHVfeWllbGQsICZzY3Vyci0+ZmxhZ3MpOworICAgICAgICBf
X2NsZWFyX2JpdChfX0NTRkxBR19pdGVtX3lpZWxkLCAmc2N1cnItPmZsYWdzKTsKICAgICAgICAg
dHJhY2VfdmFyKFRSQ19DU0NIRUQyX1NDSEVEX1RBU0tMRVQsIDEsIDAsIE5VTEwpOwotICAgICAg
ICBzbmV4dCA9IGNzY2hlZDJfaXRlbShpZGxlX3ZjcHVbY3B1XS0+c2NoZWRfaXRlbSk7CisgICAg
ICAgIHNuZXh0ID0gY3NjaGVkMl9pdGVtKHNjaGVkX2lkbGVfaXRlbShjcHUpKTsKICAgICB9CiAg
ICAgZWxzZQotICAgICAgICBzbmV4dCA9IHJ1bnFfY2FuZGlkYXRlKHJxZCwgc2N1cnIsIGNwdSwg
bm93LCAmc2tpcHBlZF92Y3B1cyk7CisgICAgICAgIHNuZXh0ID0gcnVucV9jYW5kaWRhdGUocnFk
LCBzY3VyciwgY3B1LCBub3csICZza2lwcGVkX2l0ZW1zKTsKIAotICAgIC8qIElmIHN3aXRjaGlu
ZyBmcm9tIGEgbm9uLWlkbGUgcnVubmFibGUgdmNwdSwgcHV0IGl0CisgICAgLyogSWYgc3dpdGNo
aW5nIGZyb20gYSBub24taWRsZSBydW5uYWJsZSBpdGVtLCBwdXQgaXQKICAgICAgKiBiYWNrIG9u
IHRoZSBydW5xdWV1ZS4gKi8KICAgICBpZiAoIHNuZXh0ICE9IHNjdXJyCi0gICAgICAgICAmJiAh
aXNfaWRsZV92Y3B1KHNjdXJyLT52Y3B1KQotICAgICAgICAgJiYgdmNwdV9ydW5uYWJsZShjdXJy
ZW50KSApCisgICAgICAgICAmJiAhaXNfaWRsZV9pdGVtKGN1cnJpdGVtKQorICAgICAgICAgJiYg
aXRlbV9ydW5uYWJsZShjdXJyaXRlbSkgKQogICAgICAgICBfX3NldF9iaXQoX19DU0ZMQUdfZGVs
YXllZF9ydW5xX2FkZCwgJnNjdXJyLT5mbGFncyk7CiAKICAgICByZXQubWlncmF0ZWQgPSAwOwog
CiAgICAgLyogQWNjb3VudGluZyBmb3Igbm9uLWlkbGUgdGFza3MgKi8KLSAgICBpZiAoICFpc19p
ZGxlX3ZjcHUoc25leHQtPnZjcHUpICkKKyAgICBpZiAoICFpc19pZGxlX2l0ZW0oc25leHQtPml0
ZW0pICkKICAgICB7CiAgICAgICAgIC8qIElmIHN3aXRjaGluZywgcmVtb3ZlIHRoaXMgZnJvbSB0
aGUgcnVucXVldWUgYW5kIG1hcmsgaXQgc2NoZWR1bGVkICovCiAgICAgICAgIGlmICggc25leHQg
IT0gc2N1cnIgKQogICAgICAgICB7CiAgICAgICAgICAgICBBU1NFUlQoc25leHQtPnJxZCA9PSBy
cWQpOwotICAgICAgICAgICAgQVNTRVJUKCFzbmV4dC0+dmNwdS0+c2NoZWRfaXRlbS0+aXNfcnVu
bmluZyk7CisgICAgICAgICAgICBBU1NFUlQoIXNuZXh0LT5pdGVtLT5pc19ydW5uaW5nKTsKIAog
ICAgICAgICAgICAgcnVucV9yZW1vdmUoc25leHQpOwogICAgICAgICAgICAgX19zZXRfYml0KF9f
Q1NGTEFHX3NjaGVkdWxlZCwgJnNuZXh0LT5mbGFncyk7CkBAIC0zNTc2LDE5ICszNTYzLDE5IEBA
IGNzY2hlZDJfc2NoZWR1bGUoCiAKICAgICAgICAgLyoKICAgICAgICAgICogVGhlIHJlc2V0IGNv
bmRpdGlvbiBpcyAiaGFzIGEgc2NoZWR1bGVyIGVwb2NoIGNvbWUgdG8gYW4gZW5kPyIuCi0gICAg
ICAgICAqIFRoZSB3YXkgdGhpcyBpcyBlbmZvcmNlZCBpcyBjaGVja2luZyB3aGV0aGVyIHRoZSB2
Y3B1IGF0IHRoZSB0b3AKKyAgICAgICAgICogVGhlIHdheSB0aGlzIGlzIGVuZm9yY2VkIGlzIGNo
ZWNraW5nIHdoZXRoZXIgdGhlIGl0ZW0gYXQgdGhlIHRvcAogICAgICAgICAgKiBvZiB0aGUgcnVu
cXVldWUgaGFzIG5lZ2F0aXZlIGNyZWRpdHMuIFRoaXMgbWVhbnMgdGhlIGVwb2NocyBoYXZlCiAg
ICAgICAgICAqIHZhcmlhYmxlIGxlbmd0aCwgYXMgaW4gb25lIGVwb2NoIGV4cG9yZXMgd2hlbjoK
LSAgICAgICAgICogIDEpIHRoZSB2Y3B1IGF0IHRoZSB0b3Agb2YgdGhlIHJ1bnF1ZXVlIGhhcyBl
eGVjdXRlZCBmb3IKKyAgICAgICAgICogIDEpIHRoZSBpdGVtIGF0IHRoZSB0b3Agb2YgdGhlIHJ1
bnF1ZXVlIGhhcyBleGVjdXRlZCBmb3IKICAgICAgICAgICogICAgIGFyb3VuZCAxMCBtcyAod2l0
aCBkZWZhdWx0IHBhcmFtZXRlcnMpOwotICAgICAgICAgKiAgMikgbm8gb3RoZXIgdmNwdSB3aXRo
IGhpZ2hlciBjcmVkaXRzIHdhbnRzIHRvIHJ1bi4KKyAgICAgICAgICogIDIpIG5vIG90aGVyIGl0
ZW0gd2l0aCBoaWdoZXIgY3JlZGl0cyB3YW50cyB0byBydW4uCiAgICAgICAgICAqCiAgICAgICAg
ICAqIEhlcmUsIHdoZXJlIHdlIHdhbnQgdG8gY2hlY2sgZm9yIHJlc2V0LCB3ZSBuZWVkIHRvIG1h
a2Ugc3VyZSB0aGUKLSAgICAgICAgICogcHJvcGVyIHZjcHUgaXMgYmVpbmcgdXNlZC4gSW4gZmFj
dCwgcnVucXVldWVfY2FuZGlkYXRlKCkgbWF5IGhhdmUKLSAgICAgICAgICogbm90IHJldHVybmVk
IHRoZSBmaXJzdCB2Y3B1IGluIHRoZSBydW5xdWV1ZSwgZm9yIHZhcmlvdXMgcmVhc29ucworICAg
ICAgICAgKiBwcm9wZXIgaXRlbSBpcyBiZWluZyB1c2VkLiBJbiBmYWN0LCBydW5xdWV1ZV9jYW5k
aWRhdGUoKSBtYXkgaGF2ZQorICAgICAgICAgKiBub3QgcmV0dXJuZWQgdGhlIGZpcnN0IGl0ZW0g
aW4gdGhlIHJ1bnF1ZXVlLCBmb3IgdmFyaW91cyByZWFzb25zCiAgICAgICAgICAqIChlLmcuLCBh
ZmZpbml0eSkuIE9ubHkgdHJpZ2dlciBhIHJlc2V0IHdoZW4gaXQgZG9lcy4KICAgICAgICAgICov
Ci0gICAgICAgIGlmICggc2tpcHBlZF92Y3B1cyA9PSAwICYmIHNuZXh0LT5jcmVkaXQgPD0gQ1ND
SEVEMl9DUkVESVRfUkVTRVQgKQorICAgICAgICBpZiAoIHNraXBwZWRfaXRlbXMgPT0gMCAmJiBz
bmV4dC0+Y3JlZGl0IDw9IENTQ0hFRDJfQ1JFRElUX1JFU0VUICkKICAgICAgICAgewogICAgICAg
ICAgICAgcmVzZXRfY3JlZGl0KG9wcywgY3B1LCBub3csIHNuZXh0KTsKICAgICAgICAgICAgIGJh
bGFuY2VfbG9hZChvcHMsIGNwdSwgbm93KTsKQEAgLTM1OTgsMTEgKzM1ODUsMTAgQEAgY3NjaGVk
Ml9zY2hlZHVsZSgKICAgICAgICAgc25leHQtPnRpY2tsZWRfY3B1ID0gLTE7CiAKICAgICAgICAg
LyogU2FmZSBiZWNhdXNlIGxvY2sgZm9yIG9sZCBwcm9jZXNzb3IgaXMgaGVsZCAqLwotICAgICAg
ICBpZiAoIHNuZXh0LT52Y3B1LT5wcm9jZXNzb3IgIT0gY3B1ICkKKyAgICAgICAgaWYgKCBzY2hl
ZF9pdGVtX2NwdShzbmV4dC0+aXRlbSkgIT0gY3B1ICkKICAgICAgICAgewogICAgICAgICAgICAg
c25leHQtPmNyZWRpdCArPSBDU0NIRUQyX01JR1JBVEVfQ09NUEVOU0FUSU9OOwotICAgICAgICAg
ICAgc25leHQtPnZjcHUtPnByb2Nlc3NvciA9IGNwdTsKLSAgICAgICAgICAgIHNuZXh0LT52Y3B1
LT5zY2hlZF9pdGVtLT5yZXMgPSBwZXJfY3B1KHNjaGVkX3JlcywgY3B1KTsKKyAgICAgICAgICAg
IHNjaGVkX3NldF9yZXMoc25leHQtPml0ZW0sIHBlcl9jcHUoc2NoZWRfcmVzLCBjcHUpKTsKICAg
ICAgICAgICAgIFNDSEVEX1NUQVRfQ1JBTksobWlncmF0ZWQpOwogICAgICAgICAgICAgcmV0Lm1p
Z3JhdGVkID0gMTsKICAgICAgICAgfQpAQCAtMzYzNiwyMCArMzYyMiwyMCBAQCBjc2NoZWQyX3Nj
aGVkdWxlKAogICAgICAqIFJldHVybiB0YXNrIHRvIHJ1biBuZXh0Li4uCiAgICAgICovCiAgICAg
cmV0LnRpbWUgPSBjc2NoZWQyX3J1bnRpbWUob3BzLCBjcHUsIHNuZXh0LCBub3cpOwotICAgIHJl
dC50YXNrID0gc25leHQtPnZjcHUtPnNjaGVkX2l0ZW07CisgICAgcmV0LnRhc2sgPSBzbmV4dC0+
aXRlbTsKIAotICAgIENTQ0hFRDJfVkNQVV9DSEVDSyhyZXQudGFzay0+dmNwdSk7CisgICAgQ1ND
SEVEMl9JVEVNX0NIRUNLKHJldC50YXNrKTsKICAgICByZXR1cm4gcmV0OwogfQogCiBzdGF0aWMg
dm9pZAotY3NjaGVkMl9kdW1wX3ZjcHUoc3RydWN0IGNzY2hlZDJfcHJpdmF0ZSAqcHJ2LCBzdHJ1
Y3QgY3NjaGVkMl9pdGVtICpzdmMpCitjc2NoZWQyX2R1bXBfaXRlbShzdHJ1Y3QgY3NjaGVkMl9w
cml2YXRlICpwcnYsIHN0cnVjdCBjc2NoZWQyX2l0ZW0gKnN2YykKIHsKICAgICBwcmludGsoIlsl
aS4laV0gZmxhZ3M9JXggY3B1PSVpIiwKLSAgICAgICAgICAgIHN2Yy0+dmNwdS0+ZG9tYWluLT5k
b21haW5faWQsCi0gICAgICAgICAgICBzdmMtPnZjcHUtPnZjcHVfaWQsCisgICAgICAgICAgICBz
dmMtPml0ZW0tPmRvbWFpbi0+ZG9tYWluX2lkLAorICAgICAgICAgICAgc3ZjLT5pdGVtLT5pdGVt
X2lkLAogICAgICAgICAgICAgc3ZjLT5mbGFncywKLSAgICAgICAgICAgIHN2Yy0+dmNwdS0+cHJv
Y2Vzc29yKTsKKyAgICAgICAgICAgIHNjaGVkX2l0ZW1fY3B1KHN2Yy0+aXRlbSkpOwogCiAgICAg
cHJpbnRrKCIgY3JlZGl0PSUiIFBSSWkzMiIgW3c9JXVdIiwgc3ZjLT5jcmVkaXQsIHN2Yy0+d2Vp
Z2h0KTsKIApAQCAtMzY3NCwxMiArMzY2MCwxMiBAQCBkdW1wX3BjcHUoY29uc3Qgc3RydWN0IHNj
aGVkdWxlciAqb3BzLCBpbnQgY3B1KQogICAgICAgICAgICBucl9jcHVfaWRzLCBjcHVtYXNrX2Jp
dHMocGVyX2NwdShjcHVfc2libGluZ19tYXNrLCBjcHUpKSwKICAgICAgICAgICAgbnJfY3B1X2lk
cywgY3B1bWFza19iaXRzKHBlcl9jcHUoY3B1X2NvcmVfbWFzaywgY3B1KSkpOwogCi0gICAgLyog
Y3VycmVudCBWQ1BVIChub3RoaW5nIHRvIHNheSBpZiB0aGF0J3MgdGhlIGlkbGUgdmNwdSkgKi8K
KyAgICAvKiBjdXJyZW50IElURU0gKG5vdGhpbmcgdG8gc2F5IGlmIHRoYXQncyB0aGUgaWRsZSBp
dGVtKSAqLwogICAgIHN2YyA9IGNzY2hlZDJfaXRlbShjdXJyX29uX2NwdShjcHUpKTsKLSAgICBp
ZiAoIHN2YyAmJiAhaXNfaWRsZV92Y3B1KHN2Yy0+dmNwdSkgKQorICAgIGlmICggc3ZjICYmICFp
c19pZGxlX2l0ZW0oc3ZjLT5pdGVtKSApCiAgICAgewogICAgICAgICBwcmludGsoIlx0cnVuOiAi
KTsKLSAgICAgICAgY3NjaGVkMl9kdW1wX3ZjcHUocHJ2LCBzdmMpOworICAgICAgICBjc2NoZWQy
X2R1bXBfaXRlbShwcnYsIHN2Yyk7CiAgICAgfQogfQogCkBAIC0zNzM2LDcgKzM3MjIsNyBAQCBj
c2NoZWQyX2R1bXAoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzKQogICAgIGxpc3RfZm9yX2Vh
Y2goIGl0ZXJfc2RvbSwgJnBydi0+c2RvbSApCiAgICAgewogICAgICAgICBzdHJ1Y3QgY3NjaGVk
Ml9kb20gKnNkb207Ci0gICAgICAgIHN0cnVjdCB2Y3B1ICp2OworICAgICAgICBzdHJ1Y3Qgc2No
ZWRfaXRlbSAqaXRlbTsKIAogICAgICAgICBzZG9tID0gbGlzdF9lbnRyeShpdGVyX3Nkb20sIHN0
cnVjdCBjc2NoZWQyX2RvbSwgc2RvbV9lbGVtKTsKIApAQCAtMzc0NCwxOSArMzczMCwxOSBAQCBj
c2NoZWQyX2R1bXAoY29uc3Qgc3RydWN0IHNjaGVkdWxlciAqb3BzKQogICAgICAgICAgICAgICAg
c2RvbS0+ZG9tLT5kb21haW5faWQsCiAgICAgICAgICAgICAgICBzZG9tLT53ZWlnaHQsCiAgICAg
ICAgICAgICAgICBzZG9tLT5jYXAsCi0gICAgICAgICAgICAgICBzZG9tLT5ucl92Y3B1cyk7Cisg
ICAgICAgICAgICAgICBzZG9tLT5ucl9pdGVtcyk7CiAKLSAgICAgICAgZm9yX2VhY2hfdmNwdSgg
c2RvbS0+ZG9tLCB2ICkKKyAgICAgICAgZm9yX2VhY2hfc2NoZWRfaXRlbSggc2RvbS0+ZG9tLCBp
dGVtICkKICAgICAgICAgewotICAgICAgICAgICAgc3RydWN0IGNzY2hlZDJfaXRlbSAqIGNvbnN0
IHN2YyA9IGNzY2hlZDJfaXRlbSh2LT5zY2hlZF9pdGVtKTsKKyAgICAgICAgICAgIHN0cnVjdCBj
c2NoZWQyX2l0ZW0gKiBjb25zdCBzdmMgPSBjc2NoZWQyX2l0ZW0oaXRlbSk7CiAgICAgICAgICAg
ICBzcGlubG9ja190ICpsb2NrOwogCi0gICAgICAgICAgICBsb2NrID0gaXRlbV9zY2hlZHVsZV9s
b2NrKHN2Yy0+dmNwdS0+c2NoZWRfaXRlbSk7CisgICAgICAgICAgICBsb2NrID0gaXRlbV9zY2hl
ZHVsZV9sb2NrKGl0ZW0pOwogCiAgICAgICAgICAgICBwcmludGsoIlx0JTNkOiAiLCArK2xvb3Ap
OwotICAgICAgICAgICAgY3NjaGVkMl9kdW1wX3ZjcHUocHJ2LCBzdmMpOworICAgICAgICAgICAg
Y3NjaGVkMl9kdW1wX2l0ZW0ocHJ2LCBzdmMpOwogCi0gICAgICAgICAgICBpdGVtX3NjaGVkdWxl
X3VubG9jayhsb2NrLCBzdmMtPnZjcHUtPnNjaGVkX2l0ZW0pOworICAgICAgICAgICAgaXRlbV9z
Y2hlZHVsZV91bmxvY2sobG9jaywgaXRlbSk7CiAgICAgICAgIH0KICAgICB9CiAKQEAgLTM3ODIs
NyArMzc2OCw3IEBAIGNzY2hlZDJfZHVtcChjb25zdCBzdHJ1Y3Qgc2NoZWR1bGVyICpvcHMpCiAg
ICAgICAgICAgICBpZiAoIHN2YyApCiAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgcHJp
bnRrKCJcdCUzZDogIiwgbG9vcCsrKTsKLSAgICAgICAgICAgICAgICBjc2NoZWQyX2R1bXBfdmNw
dShwcnYsIHN2Yyk7CisgICAgICAgICAgICAgICAgY3NjaGVkMl9kdW1wX2l0ZW0ocHJ2LCBzdmMp
OwogICAgICAgICAgICAgfQogICAgICAgICB9CiAgICAgICAgIHNwaW5fdW5sb2NrKCZycWQtPmxv
Y2spOwpAQCAtMzg4Miw3ICszODY4LDcgQEAgY3NjaGVkMl9zd2l0Y2hfc2NoZWQoc3RydWN0IHNj
aGVkdWxlciAqbmV3X29wcywgdW5zaWduZWQgaW50IGNwdSwKICAgICBzdHJ1Y3QgY3NjaGVkMl9p
dGVtICpzdmMgPSB2ZGF0YTsKICAgICB1bnNpZ25lZCBycWk7CiAKLSAgICBBU1NFUlQocGRhdGEg
JiYgc3ZjICYmIGlzX2lkbGVfdmNwdShzdmMtPnZjcHUpKTsKKyAgICBBU1NFUlQocGRhdGEgJiYg
c3ZjICYmIGlzX2lkbGVfaXRlbShzdmMtPml0ZW0pKTsKIAogICAgIC8qCiAgICAgICogV2Ugb3du
IG9uZSBydW5xdWV1ZSBsb2NrIGFscmVhZHkgKGZyb20gc2NoZWR1bGVfY3B1X3N3aXRjaCgpKS4g
VGhpcwpAQCAtMzg5NSw3ICszODgxLDcgQEAgY3NjaGVkMl9zd2l0Y2hfc2NoZWQoc3RydWN0IHNj
aGVkdWxlciAqbmV3X29wcywgdW5zaWduZWQgaW50IGNwdSwKICAgICBBU1NFUlQoIWxvY2FsX2ly
cV9pc19lbmFibGVkKCkpOwogICAgIHdyaXRlX2xvY2soJnBydi0+bG9jayk7CiAKLSAgICBpZGxl
X3ZjcHVbY3B1XS0+c2NoZWRfaXRlbS0+cHJpdiA9IHZkYXRhOworICAgIHNjaGVkX2lkbGVfaXRl
bShjcHUpLT5wcml2ID0gdmRhdGE7CiAKICAgICBycWkgPSBpbml0X3BkYXRhKHBydiwgcGRhdGEs
IGNwdSk7CiAKQEAgLTM5NDYsNyArMzkzMiw3IEBAIGNzY2hlZDJfZGVpbml0X3BkYXRhKGNvbnN0
IHN0cnVjdCBzY2hlZHVsZXIgKm9wcywgdm9pZCAqcGNwdSwgaW50IGNwdSkKICAgICAgKi8KICAg
ICBBU1NFUlQoc3BjICYmIHNwYy0+cnVucV9pZCAhPSAtMSk7CiAgICAgQVNTRVJUKGNwdW1hc2tf
dGVzdF9jcHUoY3B1LCAmcHJ2LT5pbml0aWFsaXplZCkpOwotICAgIAorCiAgICAgLyogRmluZCB0
aGUgb2xkIHJ1bnF1ZXVlIGFuZCByZW1vdmUgdGhpcyBjcHUgZnJvbSBpdCAqLwogICAgIHJxZCA9
IHBydi0+cnFkICsgc3BjLT5ydW5xX2lkOwogCi0tIAoyLjE2LjQKCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhl
bi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3Jn
L21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs

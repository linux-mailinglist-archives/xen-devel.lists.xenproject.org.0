Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id C29961B881
	for <lists+xen-devel@lfdr.de>; Mon, 13 May 2019 16:39:49 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1hQC5O-0002ZL-Gd; Mon, 13 May 2019 14:37:50 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=KEM8=TN=citrix.com=prvs=029c3005f=roger.pau@srs-us1.protection.inumbo.net>)
 id 1hQC5N-0002ZA-8Z
 for xen-devel@lists.xenproject.org; Mon, 13 May 2019 14:37:49 +0000
X-Inumbo-ID: ab996e5a-758c-11e9-8df1-83c9af4313ed
Received: from SMTP.EU.CITRIX.COM (unknown [185.25.65.24])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id ab996e5a-758c-11e9-8df1-83c9af4313ed;
 Mon, 13 May 2019 14:37:45 +0000 (UTC)
X-IronPort-AV: E=Sophos;i="5.60,465,1549929600"; d="scan'208";a="89709192"
Date: Mon, 13 May 2019 16:37:33 +0200
From: Roger Pau =?utf-8?B?TW9ubsOp?= <roger.pau@citrix.com>
To: Olaf Hering <olaf@aepfle.de>
Message-ID: <20190513143733.2xodq4nexe7n6er2@Air-de-Roger>
References: <20190510152047.17299-1-olaf@aepfle.de>
MIME-Version: 1.0
Content-Disposition: inline
In-Reply-To: <20190510152047.17299-1-olaf@aepfle.de>
User-Agent: NeoMutt/20180716
X-ClientProxiedBy: AMSPEX02CAS01.citrite.net (10.69.22.112) To
 AMSPEX02CL02.citrite.net (10.69.22.126)
Subject: Re: [Xen-devel] [PATCH v4] libxl: fix migration of PV and PVH domUs
 with and without qemu
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Anthony PERARD <anthony.perard@citrix.com>, xen-devel@lists.xenproject.org,
 Ian Jackson <ian.jackson@eu.citrix.com>, Wei Liu <wei.liu2@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

T24gRnJpLCBNYXkgMTAsIDIwMTkgYXQgMDU6MjA6NDdQTSArMDIwMCwgT2xhZiBIZXJpbmcgd3Jv
dGU6Cj4gSWYgYSBkb21VIGhhcyBhIHFlbXUteGVuIGluc3RhbmNlIGF0dGFjaGVkLCBpdCBpcyBy
ZXF1aXJlZCB0byBjYWxsIHFlbXVzCj4gInhlbi1zYXZlLWRldmljZXMtc3RhdGUiIG1ldGhvZC4g
V2l0aG91dCBpdCwgdGhlIHJlY2VpdmluZyBzaWRlIG9mIGEgUFYgb3IKPiBQVkggbWlncmF0aW9u
IG1heSBiZSB1bmFibGUgdG8gbG9jayB0aGUgaW1hZ2U6Cj4gCj4geGVuIGJlOiBxZGlzay01MTcx
MjogeGVuIGJlOiBxZGlzay01MTcxMjogZXJyb3I6IEZhaWxlZCB0byBnZXQgIndyaXRlIiBsb2Nr
Cj4gZXJyb3I6IEZhaWxlZCB0byBnZXQgIndyaXRlIiBsb2NrCj4geGVuIGJlOiBxZGlzay01MTcx
MjogeGVuIGJlOiBxZGlzay01MTcxMjogaW5pdGlhbGlzZSgpIGZhaWxlZAo+IGluaXRpYWxpc2Uo
KSBmYWlsZWQKPiAKPiBUbyBmaXggdGhpcyBidWcsIGxpYnhsX19kb21haW5fc3VzcGVuZF9kZXZp
Y2VfbW9kZWwoKSBhbmQKPiBsaWJ4bF9fZG9tYWluX3Jlc3VtZV9kZXZpY2VfbW9kZWwoKSBoYXZl
IHRvIGJlIGNhbGxlZCBub3Qgb25seSBmb3IgSFZNLAo+IGJ1dCBhbHNvIGlmIHRoZSBhY3RpdmUg
ZGV2aWNlX21vZGVsIGlzIFFFTVVfWEVOLgo+IAo+IFVuZm9ydHVuYXRlbHksIGxpYnhsX19kb21h
aW5fYnVpbGRfaW5mb19zZXRkZWZhdWx0KCkgaGFyZGNvZGVzCj4gYl9pbmZvLT5kZXZpY2VfbW9k
ZWxfdmVyc2lvbiB0byBRRU1VX1hFTiBpZiBpdCBkb2VzIG5vdCBrbm93IGl0IGFueQo+IGJldHRl
ci4gQXMgYSByZXN1bHQgbGlieGxfX2RldmljZV9tb2RlbF92ZXJzaW9uX3J1bm5pbmcoKSB3aWxs
IHJldHVybgo+IGluY29ycmVjdCB2YWx1ZXMuIFRoaXMgYnJlYWtzIGRvbVVzIHdpdGhvdXQgYSBk
ZXZpY2VfbW9kZWwuCj4gbGlieGxfX3FtcF9zdG9wKCkgd291bGQgd2FpdCAxMCBzZWNvbmRzIGlu
IHFtcF9vcGVuKCkgZm9yIGEgcWVtdSB0aGF0Cj4gd2lsbCBuZXZlciBhcHBlYXIuIER1cmluZyB0
aGlzIGxvbmcgdGltZWZyYW1lIHRoZSBkb21VIHJlbWFpbnMgaW4gc3RhdGUKPiBwYXVzZWQgb24g
dGhlIHNlbmRpbmcgc2lkZS4gQXMgYSByZXN1bHQgbmV0d29yayBjb25uZWN0aW9ucyBtYXkgYmUK
PiBkcm9wcGVkLiBPbmNlIHRoaXMgYnVnIGlzIGZpeGVkIGFzIHdlbGwsIGJ5IGp1c3QgcmVtb3Zp
bmcgdGhlIGFzc3VtcHRpb24KPiB0aGF0IGV2ZXJ5IGRvbVUgaGFzIGEgUUVNVV9YRU4sIHRoZXJl
IGlzIG5vIGNvZGUgdG8gYWN0dWFsbHkgaW5pdGlhbGlzZQo+IGJfaW5mby0+ZGV2aWNlX21vZGVs
X3ZlcnNpb24uCj4gCj4gVGhlcmUgaXMgYSBoZWxwZXIgZnVuY3Rpb24gbGlieGxfX25lZWRfeGVu
cHZfcWVtdSgpLCB3aGljaCBpcyB1c2VkIGluCj4gdmFyaW91cyBwbGFjZXMgdG8gZGVjaWRlIGlm
IGEgZGV2aWNlX21vZGVsIGhhcyB0byBiZSBzcGF3bmVkLiBUaGlzCj4gZnVuY3Rpb24gY2FuIG5v
dCBiZSB1c2VkIGFzIGlzLCBqdXN0IHRvIGZpbGwgZGV2aWNlX21vZGVsX3ZlcnNpb24sCj4gYmVj
YXVzZSBzdG9yZV9saWJ4bF9lbnRyeSgpIHdhcyBhbHJlYWR5IGNhbGxlZCBlYXJsaWVyLgo+IAo+
IENyZWF0ZSBhIG5ldyBmdW5jdGlvbiB0byBzZXQgZGV2aWNlX21vZGVsX3ZlcnNpb24uIE1vdmUg
ZXhpc3RpbmcgY29kZQo+IGZyb20gbGlieGxfX2RvbWFpbl9idWlsZF9pbmZvX3NldGRlZmF1bHQo
KSB0byBjb3ZlciB0aGUgSFZNIGNhc2UuIEFkZAo+IG5ldyBjb2RlIHRvIGNvdmVyIG5vbi1IVk0g
Y2FzZSwgdXNlIGxpYnhsX19uZWVkX3hlbnB2X3FlbXUoKSB0byBzZXQKPiBkZXZpY2VfbW9kZWxf
dmVyc2lvbi4KPiBNb3ZlIGFsc28gaW5pdGlhbGl6YXRpb24gZm9yIGRldmljZV9tb2RlbF9zdHVi
ZG9tYWluIHRvIHRoZSBuZXcgZnVuY3Rpb24uCj4gCj4gVXBkYXRlIGxpYnhsX19zcGF3bl9zdHVi
X2RtKCkgYW5kIGluaXRpYXRlX2RvbWFpbl9jcmVhdGUoKSB0byBjYWxsIHRoZQo+IG5ldyBmdW5j
dGlvbiBwcmlvciBsaWJ4bF9fZG9tYWluX2J1aWxkX2luZm9fc2V0ZGVmYXVsdCgpIGJlY2F1c2UK
PiBkZXZpY2VfbW9kZV92ZXJzaW9uIGlzIGV4cGVjdGVkIHRvIGJlIGluaXRpYWx6ZWQuCj4gbGli
eGxfZG9tYWluX25lZWRfbWVtb3J5KCkgbmVlZHMgbm8gdXBkYXRlIGJlY2F1c2UgaXQgZG9lcyBu
b3QgaGF2ZSBhCj4gZF9jb25maWcgYXZhaWxhYmxlIGFueXdheSwgYW5kIHRoZSBjYWxsZXJzIHBy
b3ZpZGUgYSBwb3B1bGF0ZWQgYl9pbmZvLgo+IAo+IEludHJvZHVjZSBMSUJYTF9ERVZJQ0VfTU9E
RUxfVkVSU0lPTl9OT05FX1JFUVVJUkVEIGZvciBQViBhbmQgUFZIIHRoYXQKPiBoYXZlIG5vIG5l
ZWQgZm9yIGEgZGV2aWNlX21vZGVsIHRvIG1ha2UgdGhlIHN0YXRlIGV4cGxpY2l0Lgo+IAo+IHYw
MzoKPiAtIHJlYXJyYW5nZSBjb2RlIHRvIG1ha2Ugc3VyZSBkZXZpY2VfbW9kZWxfdmVyc2lvbiBp
cyBpbml0aWFsaXplZCBiZWZvcmUKPiAgIHN0b3JlX2xpYnhsX2VudHJ5KCkgaXMgY2FsbGVkCj4g
djAyOgo+IC0gdXBkYXRlIHdvcmRpbmcgaW4gYSBjb21tZW50Cj4gLSByZW1vdmUgc3RhbGUgZ290
byBpbiBkb21jcmVhdGVfbGF1bmNoX2RtCj4gLSBpbml0aWFsaXplIHJldCBpbiBsaWJ4bF9fbmVl
ZF94ZW5wdl9xZW11Cj4gCj4gU2lnbmVkLW9mZi1ieTogT2xhZiBIZXJpbmcgPG9sYWZAYWVwZmxl
LmRlPgo+IENjOiBSb2dlciBQYXUgTW9ubsOpIDxyb2dlci5wYXVAY2l0cml4LmNvbT4KPiBDYzog
QW50aG9ueSBQRVJBUkQgPGFudGhvbnkucGVyYXJkQGNpdHJpeC5jb20+CgpMR1RNOgoKUmV2aWV3
ZWQtYnk6IFJvZ2VyIFBhdSBNb25uw6kgPHJvZ2VyLnBhdUBjaXRyaXguY29tPgoKPiAtLS0KPiAg
dG9vbHMvbGlieGwvbGlieGxfY3JlYXRlLmMgICAgICB8IDk5ICsrKysrKysrKysrKysrKysrKysr
KysrKysrLS0tLS0tLS0tLS0tLS0tCj4gIHRvb2xzL2xpYnhsL2xpYnhsX2RtLmMgICAgICAgICAg
fCAgMiArCj4gIHRvb2xzL2xpYnhsL2xpYnhsX2RvbV9zdXNwZW5kLmMgfCAgOCArKystCj4gIHRv
b2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmggICAgfCAgMiArCj4gIHRvb2xzL2xpYnhsL2xpYnhs
X3R5cGVzLmlkbCAgICAgfCAgMSArCj4gIDUgZmlsZXMgY2hhbmdlZCwgNzUgaW5zZXJ0aW9ucygr
KSwgMzcgZGVsZXRpb25zKC0pCj4gCj4gZGlmZiAtLWdpdCBhL3Rvb2xzL2xpYnhsL2xpYnhsX2Ny
ZWF0ZS5jIGIvdG9vbHMvbGlieGwvbGlieGxfY3JlYXRlLmMKPiBpbmRleCA4OWZlODBmYzljLi5i
YzQ2MTNhMjk2IDEwMDY0NAo+IC0tLSBhL3Rvb2xzL2xpYnhsL2xpYnhsX2NyZWF0ZS5jCj4gKysr
IGIvdG9vbHMvbGlieGwvbGlieGxfY3JlYXRlLmMKPiBAQCAtMjcsNiArMjcsNjQgQEAKPiAgCj4g
ICNpbmNsdWRlIDx4ZW4teHNtL2ZsYXNrL2ZsYXNrLmg+Cj4gIAo+ICtpbnQgbGlieGxfX2RvbWFp
bl9zZXRfZGV2aWNlX21vZGVsKGxpYnhsX19nYyAqZ2MsIGxpYnhsX2RvbWFpbl9jb25maWcgKmRf
Y29uZmlnKQo+ICt7Cj4gKyAgICBsaWJ4bF9kb21haW5fYnVpbGRfaW5mbyAqYl9pbmZvID0gJmRf
Y29uZmlnLT5iX2luZm87Cj4gKyAgICBpbnQgcmV0Owo+ICsKPiArICAgIGxpYnhsX2RlZmJvb2xf
c2V0ZGVmYXVsdCgmYl9pbmZvLT5kZXZpY2VfbW9kZWxfc3R1YmRvbWFpbiwgZmFsc2UpOwo+ICsK
PiArICAgIGlmIChiX2luZm8tPmRldmljZV9tb2RlbF92ZXJzaW9uKQo+ICsgICAgICAgIHJldHVy
biAwOwo+ICsKPiArICAgIHN3aXRjaCAoYl9pbmZvLT50eXBlKSB7Cj4gKyAgICBjYXNlIExJQlhM
X0RPTUFJTl9UWVBFX0hWTToKPiArICAgICAgICBpZiAobGlieGxfZGVmYm9vbF92YWwoYl9pbmZv
LT5kZXZpY2VfbW9kZWxfc3R1YmRvbWFpbikpIHsKPiArICAgICAgICAgICAgYl9pbmZvLT5kZXZp
Y2VfbW9kZWxfdmVyc2lvbiA9Cj4gKyAgICAgICAgICAgICAgICBMSUJYTF9ERVZJQ0VfTU9ERUxf
VkVSU0lPTl9RRU1VX1hFTl9UUkFESVRJT05BTDsKPiArICAgICAgICB9IGVsc2Ugewo+ICsgICAg
ICAgICAgICBiX2luZm8tPmRldmljZV9tb2RlbF92ZXJzaW9uID0gbGlieGxfX2RlZmF1bHRfZGV2
aWNlX21vZGVsKGdjKTsKPiArICAgICAgICB9Cj4gKyAgICAgICAgYnJlYWs7Cj4gKyAgICBkZWZh
dWx0Ogo+ICsgICAgICAgIHJldCA9IGxpYnhsX19uZWVkX3hlbnB2X3FlbXUoZ2MsIGRfY29uZmln
KTsKPiArICAgICAgICBzd2l0Y2ggKHJldCkgewo+ICsgICAgICAgIGNhc2UgMToKPiArICAgICAg
ICAgICAgZF9jb25maWctPmJfaW5mby5kZXZpY2VfbW9kZWxfdmVyc2lvbiA9Cj4gKyAgICAgICAg
ICAgICAgICBMSUJYTF9ERVZJQ0VfTU9ERUxfVkVSU0lPTl9RRU1VX1hFTjsKPiArICAgICAgICAg
ICAgYnJlYWs7Cj4gKyAgICAgICAgY2FzZSAwOgo+ICsgICAgICAgICAgICBkX2NvbmZpZy0+Yl9p
bmZvLmRldmljZV9tb2RlbF92ZXJzaW9uID0KPiArICAgICAgICAgICAgICAgIExJQlhMX0RFVklD
RV9NT0RFTF9WRVJTSU9OX05PTkVfUkVRVUlSRUQ7Cj4gKyAgICAgICAgICAgIGJyZWFrOwo+ICsg
ICAgICAgIGRlZmF1bHQ6Cj4gKyAgICAgICAgICAgIExPR0UoRVJST1IsICJVbmFibGUgdG8gZGV0
ZXJtaW5lIFFFTVUgcmVxdWlzaXRlIik7Cj4gKyAgICAgICAgICAgIHJldHVybiBFUlJPUl9GQUlM
OwoKWW91IGNvdWxkIGp1c3QgcmV0dXJuIHJldCBhbmQgcHJvcGFnYXRlIHRoZSBlcnJvciBmcm9t
IHRoZSBwcmV2aW91cwpmdW5jdGlvbi4KCj4gKyAgICAgICAgfQo+ICsgICAgfQo+ICsKPiArICAg
IGlmIChiX2luZm8tPmRldmljZV9tb2RlbF92ZXJzaW9uID09IExJQlhMX0RFVklDRV9NT0RFTF9W
RVJTSU9OX1FFTVVfWEVOKSB7Cj4gKyAgICAgICAgY29uc3QgY2hhciAqZG07Cj4gKwo+ICsgICAg
ICAgIGRtID0gbGlieGxfX2RvbWFpbl9kZXZpY2VfbW9kZWwoZ2MsIGJfaW5mbyk7Cj4gKyAgICAg
ICAgcmV0ID0gYWNjZXNzKGRtLCBYX09LKTsKPiArICAgICAgICBpZiAocmV0IDwgMCkgewo+ICsg
ICAgICAgICAgICAvKiBxZW11LXhlbiB1bmF2YWlsYWJsZSwgdXNlIHFlbXUteGVuLXRyYWRpdGlv
bmFsICovCj4gKyAgICAgICAgICAgIGlmIChlcnJubyA9PSBFTk9FTlQpIHsKPiArICAgICAgICAg
ICAgICAgIExPR0UoSU5GTywgInFlbXUteGVuIGlzIHVuYXZhaWxhYmxlIgo+ICsgICAgICAgICAg
ICAgICAgICAgICAiLCB1c2luZyBxZW11LXhlbi10cmFkaXRpb25hbCBpbnN0ZWFkIik7Cj4gKyAg
ICAgICAgICAgICAgICBiX2luZm8tPmRldmljZV9tb2RlbF92ZXJzaW9uID0KPiArICAgICAgICAg
ICAgICAgICAgICBMSUJYTF9ERVZJQ0VfTU9ERUxfVkVSU0lPTl9RRU1VX1hFTl9UUkFESVRJT05B
TDsKPiArICAgICAgICAgICAgfSBlbHNlIHsKPiArICAgICAgICAgICAgICAgIExPR0UoRVJST1Is
ICJxZW11LXhlbiBhY2Nlc3MgZXJyb3IiKTsKPiArICAgICAgICAgICAgICAgIHJldHVybiBFUlJP
Ul9GQUlMOwo+ICsgICAgICAgICAgICB9Cj4gKyAgICAgICAgfQo+ICsgICAgfQo+ICsKPiArICAg
IHJldHVybiAwOwo+ICt9Cj4gKwo+ICBpbnQgbGlieGxfX2RvbWFpbl9jcmVhdGVfaW5mb19zZXRk
ZWZhdWx0KGxpYnhsX19nYyAqZ2MsCj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgbGlieGxfZG9tYWluX2NyZWF0ZV9pbmZvICpjX2luZm8pCj4gIHsKPiBAQCAtODAs
NDUgKzEzOCwxMCBAQCBpbnQgbGlieGxfX2RvbWFpbl9idWlsZF9pbmZvX3NldGRlZmF1bHQobGli
eGxfX2djICpnYywKPiAgICAgICAgICByZXR1cm4gcmM7Cj4gICAgICB9Cj4gIAo+IC0gICAgbGli
eGxfZGVmYm9vbF9zZXRkZWZhdWx0KCZiX2luZm8tPmRldmljZV9tb2RlbF9zdHViZG9tYWluLCBm
YWxzZSk7Cj4gLQo+ICAgICAgaWYgKGxpYnhsX2RlZmJvb2xfdmFsKGJfaW5mby0+ZGV2aWNlX21v
ZGVsX3N0dWJkb21haW4pICYmCj4gICAgICAgICAgIWJfaW5mby0+ZGV2aWNlX21vZGVsX3NzaWRy
ZWYpCj4gICAgICAgICAgYl9pbmZvLT5kZXZpY2VfbW9kZWxfc3NpZHJlZiA9IFNFQ0lOSVRTSURf
RE9NRE07Cj4gIAo+IC0gICAgaWYgKCFiX2luZm8tPmRldmljZV9tb2RlbF92ZXJzaW9uKSB7Cj4g
LSAgICAgICAgaWYgKGJfaW5mby0+dHlwZSA9PSBMSUJYTF9ET01BSU5fVFlQRV9IVk0pIHsKPiAt
ICAgICAgICAgICAgaWYgKGxpYnhsX2RlZmJvb2xfdmFsKGJfaW5mby0+ZGV2aWNlX21vZGVsX3N0
dWJkb21haW4pKSB7Cj4gLSAgICAgICAgICAgICAgICBiX2luZm8tPmRldmljZV9tb2RlbF92ZXJz
aW9uID0KPiAtICAgICAgICAgICAgICAgICAgICBMSUJYTF9ERVZJQ0VfTU9ERUxfVkVSU0lPTl9R
RU1VX1hFTl9UUkFESVRJT05BTDsKPiAtICAgICAgICAgICAgfSBlbHNlIHsKPiAtICAgICAgICAg
ICAgICAgIGJfaW5mby0+ZGV2aWNlX21vZGVsX3ZlcnNpb24gPSBsaWJ4bF9fZGVmYXVsdF9kZXZp
Y2VfbW9kZWwoZ2MpOwo+IC0gICAgICAgICAgICB9Cj4gLSAgICAgICAgfSBlbHNlIHsKPiAtICAg
ICAgICAgICAgYl9pbmZvLT5kZXZpY2VfbW9kZWxfdmVyc2lvbiA9Cj4gLSAgICAgICAgICAgICAg
ICBMSUJYTF9ERVZJQ0VfTU9ERUxfVkVSU0lPTl9RRU1VX1hFTjsKPiAtICAgICAgICB9Cj4gLSAg
ICAgICAgaWYgKGJfaW5mby0+ZGV2aWNlX21vZGVsX3ZlcnNpb24KPiAtICAgICAgICAgICAgICAg
ID09IExJQlhMX0RFVklDRV9NT0RFTF9WRVJTSU9OX1FFTVVfWEVOKSB7Cj4gLSAgICAgICAgICAg
IGNvbnN0IGNoYXIgKmRtOwo+IC0KPiAtICAgICAgICAgICAgZG0gPSBsaWJ4bF9fZG9tYWluX2Rl
dmljZV9tb2RlbChnYywgYl9pbmZvKTsKPiAtICAgICAgICAgICAgcmMgPSBhY2Nlc3MoZG0sIFhf
T0spOwo+IC0gICAgICAgICAgICBpZiAocmMgPCAwKSB7Cj4gLSAgICAgICAgICAgICAgICAvKiBx
ZW11LXhlbiB1bmF2YWlsYWJsZSwgdXNlIHFlbXUteGVuLXRyYWRpdGlvbmFsICovCj4gLSAgICAg
ICAgICAgICAgICBpZiAoZXJybm8gPT0gRU5PRU5UKSB7Cj4gLSAgICAgICAgICAgICAgICAgICAg
TE9HRShJTkZPLCAicWVtdS14ZW4gaXMgdW5hdmFpbGFibGUiCj4gLSAgICAgICAgICAgICAgICAg
ICAgICAgICAiLCB1c2luZyBxZW11LXhlbi10cmFkaXRpb25hbCBpbnN0ZWFkIik7Cj4gLSAgICAg
ICAgICAgICAgICAgICAgYl9pbmZvLT5kZXZpY2VfbW9kZWxfdmVyc2lvbiA9Cj4gLSAgICAgICAg
ICAgICAgICAgICAgICAgIExJQlhMX0RFVklDRV9NT0RFTF9WRVJTSU9OX1FFTVVfWEVOX1RSQURJ
VElPTkFMOwo+IC0gICAgICAgICAgICAgICAgfSBlbHNlIHsKPiAtICAgICAgICAgICAgICAgICAg
ICBMT0dFKEVSUk9SLCAicWVtdS14ZW4gYWNjZXNzIGVycm9yIik7Cj4gLSAgICAgICAgICAgICAg
ICAgICAgcmV0dXJuIEVSUk9SX0ZBSUw7Cj4gLSAgICAgICAgICAgICAgICB9Cj4gLSAgICAgICAg
ICAgIH0KPiAtICAgICAgICB9Cj4gLSAgICB9CgpGVFIgSSB3b3VsZCBoYXZlIHByZWZlcnJlZCBh
IHByZS1wYXRjaCB0aGF0IGRpZCB0aGUgbW92ZSBvZiB0aGlzIGNodW5rCm9mIGNvZGUgaW50byBs
aWJ4bF9fZG9tYWluX3NldF9kZXZpY2VfbW9kZWwgd2l0aG91dCBhbnkgZnVuY3Rpb25hbApjaGFu
Z2UsIGFuZCB0aGVuIGEgc2Vjb25kIHBhdGNoIHRoYXQgaW50cm9kdWNlcyB0aGUgbmV3IGZ1bmN0
aW9uYWxpdHkuCgo+IC0KPiAgICAgIGlmIChiX2luZm8tPmJsa2Rldl9zdGFydCA9PSBOVUxMKQo+
ICAgICAgICAgIGJfaW5mby0+YmxrZGV2X3N0YXJ0ID0gbGlieGxfX3N0cmR1cChOT0dDLCAieHZk
YSIpOwo+ICAKPiBAQCAtOTM4LDYgKzk2MSwxMiBAQCBzdGF0aWMgdm9pZCBpbml0aWF0ZV9kb21h
aW5fY3JlYXRlKGxpYnhsX19lZ2MgKmVnYywKPiAgICAgICAgICBnb3RvIGVycm9yX291dDsKPiAg
ICAgIH0KPiAgCj4gKyAgICByZXQgPSBsaWJ4bF9fZG9tYWluX3NldF9kZXZpY2VfbW9kZWwoZ2Ms
IGRfY29uZmlnKTsKPiArICAgIGlmIChyZXQpIHsKPiArICAgICAgICBMT0dEKEVSUk9SLCBkb21p
ZCwgIlVuYWJsZSB0byBzZXQgZG9tYWluIGRldmljZSBtb2RlbCIpOwo+ICsgICAgICAgIGdvdG8g
ZXJyb3Jfb3V0Owo+ICsgICAgfQo+ICsKPiAgICAgIHJldCA9IGxpYnhsX19kb21haW5fY3JlYXRl
X2luZm9fc2V0ZGVmYXVsdChnYywgJmRfY29uZmlnLT5jX2luZm8pOwo+ICAgICAgaWYgKHJldCkg
ewo+ICAgICAgICAgIExPR0QoRVJST1IsIGRvbWlkLCAiVW5hYmxlIHRvIHNldCBkb21haW4gY3Jl
YXRlIGluZm8gZGVmYXVsdHMiKTsKPiBkaWZmIC0tZ2l0IGEvdG9vbHMvbGlieGwvbGlieGxfZG0u
YyBiL3Rvb2xzL2xpYnhsL2xpYnhsX2RtLmMKPiBpbmRleCAyZjE5Nzg2YmRkLi4wODZlNTY2MzEx
IDEwMDY0NAo+IC0tLSBhL3Rvb2xzL2xpYnhsL2xpYnhsX2RtLmMKPiArKysgYi90b29scy9saWJ4
bC9saWJ4bF9kbS5jCj4gQEAgLTIxNjgsNiArMjE2OCw4IEBAIHZvaWQgbGlieGxfX3NwYXduX3N0
dWJfZG0obGlieGxfX2VnYyAqZWdjLCBsaWJ4bF9fc3R1Yl9kbV9zcGF3bl9zdGF0ZSAqc2RzcykK
PiAgICAgIGRtX2NvbmZpZy0+Y19pbmZvLnJ1bl9ob3RwbHVnX3NjcmlwdHMgPQo+ICAgICAgICAg
IGd1ZXN0X2NvbmZpZy0+Y19pbmZvLnJ1bl9ob3RwbHVnX3NjcmlwdHM7Cj4gIAo+ICsgICAgcmV0
ID0gbGlieGxfX2RvbWFpbl9zZXRfZGV2aWNlX21vZGVsKGdjLCBkbV9jb25maWcpOwo+ICsgICAg
aWYgKHJldCkgZ290byBvdXQ7Cj4gICAgICByZXQgPSBsaWJ4bF9fZG9tYWluX2NyZWF0ZV9pbmZv
X3NldGRlZmF1bHQoZ2MsICZkbV9jb25maWctPmNfaW5mbyk7Cj4gICAgICBpZiAocmV0KSBnb3Rv
IG91dDsKPiAgICAgIHJldCA9IGxpYnhsX19kb21haW5fYnVpbGRfaW5mb19zZXRkZWZhdWx0KGdj
LCAmZG1fY29uZmlnLT5iX2luZm8pOwo+IGRpZmYgLS1naXQgYS90b29scy9saWJ4bC9saWJ4bF9k
b21fc3VzcGVuZC5jIGIvdG9vbHMvbGlieGwvbGlieGxfZG9tX3N1c3BlbmQuYwo+IGluZGV4IGQx
YWYzYTY1NzMuLmM0OTJmZTVkZDEgMTAwNjQ0Cj4gLS0tIGEvdG9vbHMvbGlieGwvbGlieGxfZG9t
X3N1c3BlbmQuYwo+ICsrKyBiL3Rvb2xzL2xpYnhsL2xpYnhsX2RvbV9zdXNwZW5kLmMKPiBAQCAt
Mzc5LDcgKzM3OSw5IEBAIHN0YXRpYyB2b2lkIGRvbWFpbl9zdXNwZW5kX2NvbW1vbl9ndWVzdF9z
dXNwZW5kZWQobGlieGxfX2VnYyAqZWdjLAo+ICAgICAgbGlieGxfX2V2X3hzd2F0Y2hfZGVyZWdp
c3RlcihnYywgJmRzcHMtPmd1ZXN0X3dhdGNoKTsKPiAgICAgIGxpYnhsX19ldl90aW1lX2RlcmVn
aXN0ZXIoZ2MsICZkc3BzLT5ndWVzdF90aW1lb3V0KTsKPiAgCj4gLSAgICBpZiAoZHNwcy0+dHlw
ZSA9PSBMSUJYTF9ET01BSU5fVFlQRV9IVk0pIHsKPiArICAgIGlmIChkc3BzLT50eXBlID09IExJ
QlhMX0RPTUFJTl9UWVBFX0hWTSB8fAo+ICsgICAgICAgIGxpYnhsX19kZXZpY2VfbW9kZWxfdmVy
c2lvbl9ydW5uaW5nKGdjLCBkc3BzLT5kb21pZCkgPT0KPiArICAgICAgICBMSUJYTF9ERVZJQ0Vf
TU9ERUxfVkVSU0lPTl9RRU1VX1hFTikgewo+ICAgICAgICAgIGRzcHMtPmNhbGxiYWNrX2Rldmlj
ZV9tb2RlbF9kb25lID0gZG9tYWluX3N1c3BlbmRfY29tbW9uX2RvbmU7Cj4gICAgICAgICAgbGli
eGxfX2RvbWFpbl9zdXNwZW5kX2RldmljZV9tb2RlbChlZ2MsIGRzcHMpOyAvKiBtdXN0IGJlIGxh
c3QgKi8KPiAgICAgICAgICByZXR1cm47Cj4gQEAgLTQ1OSw3ICs0NjEsOSBAQCBpbnQgbGlieGxf
X2RvbWFpbl9yZXN1bWUobGlieGxfX2djICpnYywgdWludDMyX3QgZG9taWQsIGludCBzdXNwZW5k
X2NhbmNlbCkKPiAgICAgICAgICBnb3RvIG91dDsKPiAgICAgIH0KPiAgCj4gLSAgICBpZiAodHlw
ZSA9PSBMSUJYTF9ET01BSU5fVFlQRV9IVk0pIHsKPiArICAgIGlmICh0eXBlID09IExJQlhMX0RP
TUFJTl9UWVBFX0hWTSB8fAo+ICsgICAgICAgIGxpYnhsX19kZXZpY2VfbW9kZWxfdmVyc2lvbl9y
dW5uaW5nKGdjLCBkb21pZCkgPT0KPiArICAgICAgICBMSUJYTF9ERVZJQ0VfTU9ERUxfVkVSU0lP
Tl9RRU1VX1hFTikgewo+ICAgICAgICAgIHJjID0gbGlieGxfX2RvbWFpbl9yZXN1bWVfZGV2aWNl
X21vZGVsKGdjLCBkb21pZCk7Cj4gICAgICAgICAgaWYgKHJjKSB7Cj4gICAgICAgICAgICAgIExP
R0QoRVJST1IsIGRvbWlkLCAiZmFpbGVkIHRvIHJlc3VtZSBkZXZpY2UgbW9kZWw6JWQiLCByYyk7
Cj4gZGlmZiAtLWdpdCBhL3Rvb2xzL2xpYnhsL2xpYnhsX2ludGVybmFsLmggYi90b29scy9saWJ4
bC9saWJ4bF9pbnRlcm5hbC5oCj4gaW5kZXggNDRlMDIyMTI4NC4uMjVmMTEzNDA0YiAxMDA2NDQK
PiAtLS0gYS90b29scy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5oCj4gKysrIGIvdG9vbHMvbGlieGwv
bGlieGxfaW50ZXJuYWwuaAo+IEBAIC0xMzc0LDYgKzEzNzQsOCBAQCBfaGlkZGVuIGludCBsaWJ4
bF9fZGV2aWNlX25leHRpZChsaWJ4bF9fZ2MgKmdjLCB1aW50MzJfdCBkb21pZCwKPiAgX2hpZGRl
biBpbnQgbGlieGxfX3Jlc29sdmVfZG9taWQobGlieGxfX2djICpnYywgY29uc3QgY2hhciAqbmFt
ZSwKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgKmRvbWlkKTsK
PiAgCj4gK19oaWRkZW4gaW50IGxpYnhsX19kb21haW5fc2V0X2RldmljZV9tb2RlbChsaWJ4bF9f
Z2MgKmdjLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGli
eGxfZG9tYWluX2NvbmZpZyAqZF9jb25maWcpOwo+ICAvKgo+ICAgKiBGb3IgZWFjaCBhZ2dyZWdh
dGUgdHlwZSB3aGljaCBjYW4gYmUgdXNlZCBhcyBhbiBpbnB1dCB3ZSBwcm92aWRlOgo+ICAgKgo+
IGRpZmYgLS1naXQgYS90b29scy9saWJ4bC9saWJ4bF90eXBlcy5pZGwgYi90b29scy9saWJ4bC9s
aWJ4bF90eXBlcy5pZGwKPiBpbmRleCBjYjQ3MDJmZDdhLi43ZDc1YmQzODUwIDEwMDY0NAo+IC0t
LSBhL3Rvb2xzL2xpYnhsL2xpYnhsX3R5cGVzLmlkbAo+ICsrKyBiL3Rvb2xzL2xpYnhsL2xpYnhs
X3R5cGVzLmlkbAo+IEBAIC0xMDYsNiArMTA2LDcgQEAgbGlieGxfZGV2aWNlX21vZGVsX3ZlcnNp
b24gPSBFbnVtZXJhdGlvbigiZGV2aWNlX21vZGVsX3ZlcnNpb24iLCBbCj4gICAgICAoMCwgIlVO
S05PV04iKSwKPiAgICAgICgxLCAiUUVNVV9YRU5fVFJBRElUSU9OQUwiKSwgIyBIaXN0b3JpY2Fs
IHFlbXUteGVuIGRldmljZSBtb2RlbCAocWVtdS1kbSkKPiAgICAgICgyLCAiUUVNVV9YRU4iKSwg
ICAgICAgICAgICAgIyBVcHN0cmVhbSBiYXNlZCBxZW11LXhlbiBkZXZpY2UgbW9kZWwKPiArICAg
ICgzLCAiTk9ORV9SRVFVSVJFRCIpLAoKUGxhaW4gIk5PTkUiIHdvdWxkIGFsc28gYmUgZmluZSBo
ZXJlIElNTy4KClRoYW5rcywgUm9nZXIuCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54
ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGlu
Zm8veGVuLWRldmVs

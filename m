Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 4A81A16BE08
	for <lists+xen-devel@lfdr.de>; Tue, 25 Feb 2020 10:56:43 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1j6Wv1-0005tP-Qv; Tue, 25 Feb 2020 09:54:23 +0000
Received: from us1-rack-iad1.inumbo.com ([172.99.69.81])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=UoxS=4N=amazon.co.uk=prvs=317b3ba57=pdurrant@srs-us1.protection.inumbo.net>)
 id 1j6Wv0-0005tC-Cr
 for xen-devel@lists.xenproject.org; Tue, 25 Feb 2020 09:54:22 +0000
X-Inumbo-ID: cc3515e6-57b4-11ea-a490-bc764e2007e4
Received: from smtp-fw-2101.amazon.com (unknown [72.21.196.25])
 by us1-rack-iad1.inumbo.com (Halon) with ESMTPS
 id cc3515e6-57b4-11ea-a490-bc764e2007e4;
 Tue, 25 Feb 2020 09:54:22 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amazon.com; i=@amazon.com; q=dns/txt; s=amazon201209;
 t=1582624462; x=1614160462;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=1sXg7SMs1OOuoleGwD/9nyI+ClLPs6vgtcz2MNS4Vbs=;
 b=IuPIoLtgomq1k48yCKaZM7BxqwdtHxb43IpaS+meKkMqGDnxWUCTHu75
 1mjlb1qJKUVR9JwuYCpRckdDJ3TktPQH/5OkXeN22i1uKGEJEOHg3sizy
 h61poq9xIMqc6CEp4QbOkaIHZWCHzHTWlKPK044nTL7GJRidwcogdI6ze I=;
IronPort-SDR: LAMQuULCS9udKfAgALW7lU/ejBmnAfKMLvs4gHwL2U+uxm1SLoRCU3Os36ZACEbytvnZz4z+Dn
 mLeoTldkWBPg==
X-IronPort-AV: E=Sophos;i="5.70,483,1574121600"; d="scan'208";a="18753197"
Received: from iad12-co-svc-p1-lb1-vlan2.amazon.com (HELO
 email-inbound-relay-2c-87a10be6.us-west-2.amazon.com) ([10.43.8.2])
 by smtp-border-fw-out-2101.iad2.amazon.com with ESMTP;
 25 Feb 2020 09:54:08 +0000
Received: from EX13MTAUEA002.ant.amazon.com
 (pdx4-ws-svc-p6-lb7-vlan2.pdx.amazon.com [10.170.41.162])
 by email-inbound-relay-2c-87a10be6.us-west-2.amazon.com (Postfix) with ESMTPS
 id 86EF2A238E; Tue, 25 Feb 2020 09:54:07 +0000 (UTC)
Received: from EX13D32EUC001.ant.amazon.com (10.43.164.159) by
 EX13MTAUEA002.ant.amazon.com (10.43.61.77) with Microsoft SMTP Server (TLS)
 id 15.0.1236.3; Tue, 25 Feb 2020 09:54:07 +0000
Received: from EX13MTAUWA001.ant.amazon.com (10.43.160.58) by
 EX13D32EUC001.ant.amazon.com (10.43.164.159) with Microsoft SMTP Server (TLS)
 id 15.0.1367.3; Tue, 25 Feb 2020 09:54:05 +0000
Received: from u2f063a87eabd5f.cbg10.amazon.com (10.125.106.135) by
 mail-relay.amazon.com (10.43.160.118) with Microsoft SMTP Server id
 15.0.1367.3 via Frontend Transport; Tue, 25 Feb 2020 09:54:02 +0000
From: Paul Durrant <pdurrant@amazon.com>
To: <xen-devel@lists.xenproject.org>
Date: Tue, 25 Feb 2020 09:53:56 +0000
Message-ID: <20200225095357.3923-2-pdurrant@amazon.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20200225095357.3923-1-pdurrant@amazon.com>
References: <20200225095357.3923-1-pdurrant@amazon.com>
MIME-Version: 1.0
Precedence: Bulk
Subject: [Xen-devel] [PATCH 1/2] domain: introduce alloc/free_shared_info()
 helpers...
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Stefano Stabellini <sstabellini@kernel.org>, Julien Grall <julien@xen.org>,
 Wei Liu <wl@xen.org>, Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>, Paul Durrant <pdurrant@amazon.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>,
 George Dunlap <george.dunlap@citrix.com>, Jan Beulich <jbeulich@suse.com>,
 Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

Li4uIGFuZCBzYXZlIHRoZSBNRk4uCgpUaGlzIHBhdGNoIG1vZGlmaWVzIHRoZSAnc2hhcmVkX2lu
Zm8nIGZpZWxkIG9mIHN0cnVjdCBkb21haW4gdG8gYmUKYSBzdHJ1Y3R1cmUgY29tcHJpc2luZyBh
biBNRk4gYW5kIGEgdmlydHVhbCBhZGRyZXNzLiBBbGxvY2F0aW9ucyBhcmUKc3RpbGwgZG9uZSBm
cm9tIHhlbmhlYXAsIHNvIHRoZSB2aXJ0dWFsIGFkZHJlc3Mgc3RpbGwgZXF1YXRlcyB0bwp2aXJ0
X3RvX21mbigpIGNhbGxlZCBvbiB0aGUgTUZOIGJ1dCBzdWJzZXF1ZW50IHBhdGNoIHdpbGwgY2hh
bmdlIHRoaXMuCkhlbmNlIHRoZSBuZWVkIHRvIHNhdmUgdGhlIE1GTi4KCk5PVEU6IFdoaXN0IGRl
ZmluaW5nIHRoZSBuZXcgaGVscGVycywgdmlydF90b19tZm4oKSBpbiBjb21tb24vZG9tYWluLmMK
ICAgICAgaXMgbWFkZSB0eXBlIHNhZmUuCiAgICAgIFRoZSBkZWZpbml0aW9uIG9mIG5taV9yZWFz
b24oKSBpbiBhc20teDg2L3NoYXJlZC5oIGlzIGFsc28gcmUtCiAgICAgIGZsb3dlZCB0byBhdm9p
ZCBvdmVybHkgbG9uZyBsaW5lcy4KClNpZ25lZC1vZmYtYnk6IFBhdWwgRHVycmFudCA8cGR1cnJh
bnRAYW1hem9uLmNvbT4KLS0tCkNjOiBTdGVmYW5vIFN0YWJlbGxpbmkgPHNzdGFiZWxsaW5pQGtl
cm5lbC5vcmc+CkNjOiBKdWxpZW4gR3JhbGwgPGp1bGllbkB4ZW4ub3JnPgpDYzogVm9sb2R5bXly
IEJhYmNodWsgPFZvbG9keW15cl9CYWJjaHVrQGVwYW0uY29tPgpDYzogQW5kcmV3IENvb3BlciA8
YW5kcmV3LmNvb3BlcjNAY2l0cml4LmNvbT4KQ2M6IEdlb3JnZSBEdW5sYXAgPGdlb3JnZS5kdW5s
YXBAY2l0cml4LmNvbT4KQ2M6IElhbiBKYWNrc29uIDxpYW4uamFja3NvbkBldS5jaXRyaXguY29t
PgpDYzogSmFuIEJldWxpY2ggPGpiZXVsaWNoQHN1c2UuY29tPgpDYzogS29ucmFkIFJ6ZXN6dXRl
ayBXaWxrIDxrb25yYWQud2lsa0BvcmFjbGUuY29tPgpDYzogV2VpIExpdSA8d2xAeGVuLm9yZz4K
Q2M6ICJSb2dlciBQYXUgTW9ubsOpIiA8cm9nZXIucGF1QGNpdHJpeC5jb20+Ci0tLQogeGVuL2Fy
Y2gvYXJtL2RvbWFpbi5jICAgICAgICB8ICA4ICsrLS0tLS0tCiB4ZW4vYXJjaC9hcm0vbW0uYyAg
ICAgICAgICAgIHwgIDIgKy0KIHhlbi9hcmNoL3g4Ni9kb21haW4uYyAgICAgICAgfCAxMSArKysr
LS0tLS0tLQogeGVuL2FyY2gveDg2L21tLmMgICAgICAgICAgICB8ICAyICstCiB4ZW4vYXJjaC94
ODYvcHYvZG9tMF9idWlsZC5jIHwgIDIgKy0KIHhlbi9hcmNoL3g4Ni9wdi9zaGltLmMgICAgICAg
fCAgMiArLQogeGVuL2NvbW1vbi9kb21haW4uYyAgICAgICAgICB8IDI2ICsrKysrKysrKysrKysr
KysrKysrKysrKysrCiB4ZW4vY29tbW9uL2RvbWN0bC5jICAgICAgICAgIHwgIDIgKy0KIHhlbi9j
b21tb24vdGltZS5jICAgICAgICAgICAgfCAgNCArKy0tCiB4ZW4vaW5jbHVkZS9hc20teDg2L3No
YXJlZC5oIHwgMTUgKysrKysrKystLS0tLS0tCiB4ZW4vaW5jbHVkZS94ZW4vZG9tYWluLmggICAg
IHwgIDMgKysrCiB4ZW4vaW5jbHVkZS94ZW4vc2NoZWQuaCAgICAgIHwgIDUgKysrKy0KIHhlbi9p
bmNsdWRlL3hlbi9zaGFyZWQuaCAgICAgfCAgMiArLQogMTMgZmlsZXMgY2hhbmdlZCwgNTUgaW5z
ZXJ0aW9ucygrKSwgMjkgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEveGVuL2FyY2gvYXJtL2Rv
bWFpbi5jIGIveGVuL2FyY2gvYXJtL2RvbWFpbi5jCmluZGV4IGFhM2RmM2IzYmEuLjJjYmNkYWFj
MDggMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL2FybS9kb21haW4uYworKysgYi94ZW4vYXJjaC9hcm0v
ZG9tYWluLmMKQEAgLTY5MCwxMyArNjkwLDkgQEAgaW50IGFyY2hfZG9tYWluX2NyZWF0ZShzdHJ1
Y3QgZG9tYWluICpkLAogICAgIGlmICggKHJjID0gcDJtX2luaXQoZCkpICE9IDAgKQogICAgICAg
ICBnb3RvIGZhaWw7CiAKLSAgICByYyA9IC1FTk9NRU07Ci0gICAgaWYgKCAoZC0+c2hhcmVkX2lu
Zm8gPSBhbGxvY194ZW5oZWFwX3BhZ2VzKDAsIDApKSA9PSBOVUxMICkKKyAgICBpZiAoIChyYyA9
IGFsbG9jX3NoYXJlZF9pbmZvKGQsIDApKSAhPSAwICkKICAgICAgICAgZ290byBmYWlsOwogCi0g
ICAgY2xlYXJfcGFnZShkLT5zaGFyZWRfaW5mbyk7Ci0gICAgc2hhcmVfeGVuX3BhZ2Vfd2l0aF9n
dWVzdCh2aXJ0X3RvX3BhZ2UoZC0+c2hhcmVkX2luZm8pLCBkLCBTSEFSRV9ydyk7Ci0KICAgICBz
d2l0Y2ggKCBjb25maWctPmFyY2guZ2ljX3ZlcnNpb24gKQogICAgIHsKICAgICBjYXNlIFhFTl9E
T01DVExfQ09ORklHX0dJQ19WMjoKQEAgLTc2Nyw3ICs3NjMsNyBAQCB2b2lkIGFyY2hfZG9tYWlu
X2Rlc3Ryb3koc3RydWN0IGRvbWFpbiAqZCkKICAgICBwMm1fdGVhcmRvd24oZCk7CiAgICAgZG9t
YWluX3ZnaWNfZnJlZShkKTsKICAgICBkb21haW5fdnVhcnRfZnJlZShkKTsKLSAgICBmcmVlX3hl
bmhlYXBfcGFnZShkLT5zaGFyZWRfaW5mbyk7CisgICAgZnJlZV9zaGFyZWRfaW5mbyhkKTsKICNp
ZmRlZiBDT05GSUdfQUNQSQogICAgIGZyZWVfeGVuaGVhcF9wYWdlcyhkLT5hcmNoLmVmaV9hY3Bp
X3RhYmxlLAogICAgICAgICAgICAgICAgICAgICAgICBnZXRfb3JkZXJfZnJvbV9ieXRlcyhkLT5h
cmNoLmVmaV9hY3BpX2xlbikpOwpkaWZmIC0tZ2l0IGEveGVuL2FyY2gvYXJtL21tLmMgYi94ZW4v
YXJjaC9hcm0vbW0uYwppbmRleCA3MjcxMDdlZWZhLi4yYmI1OTIxMDFkIDEwMDY0NAotLS0gYS94
ZW4vYXJjaC9hcm0vbW0uYworKysgYi94ZW4vYXJjaC9hcm0vbW0uYwpAQCAtMTQyNCw3ICsxNDI0
LDcgQEAgaW50IHhlbm1lbV9hZGRfdG9fcGh5c21hcF9vbmUoCiAgICAgICAgIGlmICggaWR4ICE9
IDAgKQogICAgICAgICAgICAgcmV0dXJuIC1FSU5WQUw7CiAKLSAgICAgICAgbWZuID0gdmlydF90
b19tZm4oZC0+c2hhcmVkX2luZm8pOworICAgICAgICBtZm4gPSBkLT5zaGFyZWRfaW5mby5tZm47
CiAgICAgICAgIHQgPSBwMm1fcmFtX3J3OwogCiAgICAgICAgIGJyZWFrOwpkaWZmIC0tZ2l0IGEv
eGVuL2FyY2gveDg2L2RvbWFpbi5jIGIveGVuL2FyY2gveDg2L2RvbWFpbi5jCmluZGV4IGZlNjNj
MjM2NzYuLmViN2IwZmM1MWMgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9kb21haW4uYworKysg
Yi94ZW4vYXJjaC94ODYvZG9tYWluLmMKQEAgLTYxMiwxMiArNjEyLDkgQEAgaW50IGFyY2hfZG9t
YWluX2NyZWF0ZShzdHJ1Y3QgZG9tYWluICpkLAogICAgICAqIFRoZSBzaGFyZWRfaW5mbyBtYWNo
aW5lIGFkZHJlc3MgbXVzdCBmaXQgaW4gYSAzMi1iaXQgZmllbGQgd2l0aGluIGEKICAgICAgKiAz
Mi1iaXQgZ3Vlc3QncyBzdGFydF9pbmZvIHN0cnVjdHVyZS4gSGVuY2Ugd2Ugc3BlY2lmeSBNRU1G
X2JpdHMoMzIpLgogICAgICAqLwotICAgIGlmICggKGQtPnNoYXJlZF9pbmZvID0gYWxsb2NfeGVu
aGVhcF9wYWdlcygwLCBNRU1GX2JpdHMoMzIpKSkgPT0gTlVMTCApCisgICAgaWYgKCAocmMgPSBh
bGxvY19zaGFyZWRfaW5mbyhkLCBNRU1GX2JpdHMoMzIpKSkgIT0gMCApCiAgICAgICAgIGdvdG8g
ZmFpbDsKIAotICAgIGNsZWFyX3BhZ2UoZC0+c2hhcmVkX2luZm8pOwotICAgIHNoYXJlX3hlbl9w
YWdlX3dpdGhfZ3Vlc3QodmlydF90b19wYWdlKGQtPnNoYXJlZF9pbmZvKSwgZCwgU0hBUkVfcncp
OwotCiAgICAgaWYgKCAocmMgPSBpbml0X2RvbWFpbl9pcnFfbWFwcGluZyhkKSkgIT0gMCApCiAg
ICAgICAgIGdvdG8gZmFpbDsKIApAQCAtNjY1LDcgKzY2Miw3IEBAIGludCBhcmNoX2RvbWFpbl9j
cmVhdGUoc3RydWN0IGRvbWFpbiAqZCwKICAgICBwc3JfZG9tYWluX2ZyZWUoZCk7CiAgICAgaW9t
bXVfZG9tYWluX2Rlc3Ryb3koZCk7CiAgICAgY2xlYW51cF9kb21haW5faXJxX21hcHBpbmcoZCk7
Ci0gICAgZnJlZV94ZW5oZWFwX3BhZ2UoZC0+c2hhcmVkX2luZm8pOworICAgIGZyZWVfc2hhcmVk
X2luZm8oZCk7CiAgICAgeGZyZWUoZC0+YXJjaC5jcHVpZCk7CiAgICAgeGZyZWUoZC0+YXJjaC5t
c3IpOwogICAgIGlmICggcGFnaW5nX2luaXRpYWxpc2VkICkKQEAgLTY5NCw3ICs2OTEsNyBAQCB2
b2lkIGFyY2hfZG9tYWluX2Rlc3Ryb3koc3RydWN0IGRvbWFpbiAqZCkKICAgICAgICAgcHZfZG9t
YWluX2Rlc3Ryb3koZCk7CiAgICAgZnJlZV9wZXJkb21haW5fbWFwcGluZ3MoZCk7CiAKLSAgICBm
cmVlX3hlbmhlYXBfcGFnZShkLT5zaGFyZWRfaW5mbyk7CisgICAgZnJlZV9zaGFyZWRfaW5mbyhk
KTsKICAgICBjbGVhbnVwX2RvbWFpbl9pcnFfbWFwcGluZyhkKTsKIAogICAgIHBzcl9kb21haW5f
ZnJlZShkKTsKQEAgLTcyMCw3ICs3MTcsNyBAQCB2b2lkIGFyY2hfZG9tYWluX3VucGF1c2Uoc3Ry
dWN0IGRvbWFpbiAqZCkKIAogaW50IGFyY2hfZG9tYWluX3NvZnRfcmVzZXQoc3RydWN0IGRvbWFp
biAqZCkKIHsKLSAgICBzdHJ1Y3QgcGFnZV9pbmZvICpwYWdlID0gdmlydF90b19wYWdlKGQtPnNo
YXJlZF9pbmZvKSwgKm5ld19wYWdlOworICAgIHN0cnVjdCBwYWdlX2luZm8gKnBhZ2UgPSBtZm5f
dG9fcGFnZShkLT5zaGFyZWRfaW5mby5tZm4pLCAqbmV3X3BhZ2U7CiAgICAgaW50IHJldCA9IDA7
CiAgICAgc3RydWN0IGRvbWFpbiAqb3duZXI7CiAgICAgbWZuX3QgbWZuOwpkaWZmIC0tZ2l0IGEv
eGVuL2FyY2gveDg2L21tLmMgYi94ZW4vYXJjaC94ODYvbW0uYwppbmRleCA3MGI4N2M0ODMwLi41
MDY3MTI1Y2JiIDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYvbW0uYworKysgYi94ZW4vYXJjaC94
ODYvbW0uYwpAQCAtNDUzOCw3ICs0NTM4LDcgQEAgaW50IHhlbm1lbV9hZGRfdG9fcGh5c21hcF9v
bmUoCiAgICAgewogICAgICAgICBjYXNlIFhFTk1BUFNQQUNFX3NoYXJlZF9pbmZvOgogICAgICAg
ICAgICAgaWYgKCBpZHggPT0gMCApCi0gICAgICAgICAgICAgICAgbWZuID0gdmlydF90b19tZm4o
ZC0+c2hhcmVkX2luZm8pOworICAgICAgICAgICAgICAgIG1mbiA9IGQtPnNoYXJlZF9pbmZvLm1m
bjsKICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICBjYXNlIFhFTk1BUFNQQUNFX2dyYW50X3Rh
YmxlOgogICAgICAgICAgICAgcmMgPSBnbnR0YWJfbWFwX2ZyYW1lKGQsIGlkeCwgZ3BmbiwgJm1m
bik7CmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvcHYvZG9tMF9idWlsZC5jIGIveGVuL2FyY2gv
eDg2L3B2L2RvbTBfYnVpbGQuYwppbmRleCA1Njc4ZGE3ODJkLi5kYzE2ZWYyZTc5IDEwMDY0NAot
LS0gYS94ZW4vYXJjaC94ODYvcHYvZG9tMF9idWlsZC5jCisrKyBiL3hlbi9hcmNoL3g4Ni9wdi9k
b20wX2J1aWxkLmMKQEAgLTc0Myw3ICs3NDMsNyBAQCBpbnQgX19pbml0IGRvbTBfY29uc3RydWN0
X3B2KHN0cnVjdCBkb21haW4gKmQsCiAgICAgY2xlYXJfcGFnZShzaSk7CiAgICAgc2ktPm5yX3Bh
Z2VzID0gbnJfcGFnZXM7CiAKLSAgICBzaS0+c2hhcmVkX2luZm8gPSB2aXJ0X3RvX21hZGRyKGQt
PnNoYXJlZF9pbmZvKTsKKyAgICBzaS0+c2hhcmVkX2luZm8gPSBtZm5fdG9fbWFkZHIoZC0+c2hh
cmVkX2luZm8ubWZuKTsKIAogICAgIGlmICggIXB2X3NoaW0gKQogICAgICAgICBzaS0+ZmxhZ3Mg
ICAgPSBTSUZfUFJJVklMRUdFRCB8IFNJRl9JTklURE9NQUlOOwpkaWZmIC0tZ2l0IGEveGVuL2Fy
Y2gveDg2L3B2L3NoaW0uYyBiL3hlbi9hcmNoL3g4Ni9wdi9zaGltLmMKaW5kZXggZDg2ZTJkZTEx
OC4uZjUxMjgwOWRhZCAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L3B2L3NoaW0uYworKysgYi94
ZW4vYXJjaC94ODYvcHYvc2hpbS5jCkBAIC0yODIsNyArMjgyLDcgQEAgc3RhdGljIHZvaWQgd3Jp
dGVfc3RhcnRfaW5mbyhzdHJ1Y3QgZG9tYWluICpkKQogICAgIHNucHJpbnRmKHNpLT5tYWdpYywg
c2l6ZW9mKHNpLT5tYWdpYyksICJ4ZW4tMy4wLXg4Nl8lcyIsCiAgICAgICAgICAgICAgaXNfcHZf
MzJiaXRfZG9tYWluKGQpID8gIjMycCIgOiAiNjQiKTsKICAgICBzaS0+bnJfcGFnZXMgPSBkb21h
aW5fdG90X3BhZ2VzKGQpOwotICAgIHNpLT5zaGFyZWRfaW5mbyA9IHZpcnRfdG9fbWFkZHIoZC0+
c2hhcmVkX2luZm8pOworICAgIHNpLT5zaGFyZWRfaW5mbyA9IG1mbl90b19tYWRkcihkLT5zaGFy
ZWRfaW5mby5tZm4pOwogICAgIHNpLT5mbGFncyA9IDA7CiAgICAgQlVHX09OKHhlbl9oeXBlcmNh
bGxfaHZtX2dldF9wYXJhbShIVk1fUEFSQU1fU1RPUkVfUEZOLCAmc2ktPnN0b3JlX21mbikpOwog
ICAgIEJVR19PTih4ZW5faHlwZXJjYWxsX2h2bV9nZXRfcGFyYW0oSFZNX1BBUkFNX1NUT1JFX0VW
VENITiwgJnBhcmFtKSk7CmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL2RvbWFpbi5jIGIveGVuL2Nv
bW1vbi9kb21haW4uYwppbmRleCA2YWQ0NThmYTZiLi5iYTdhOTA1MjU4IDEwMDY0NAotLS0gYS94
ZW4vY29tbW9uL2RvbWFpbi5jCisrKyBiL3hlbi9jb21tb24vZG9tYWluLmMKQEAgLTQ3LDYgKzQ3
LDEwIEBACiAjaW5jbHVkZSA8YXNtL2d1ZXN0Lmg+CiAjZW5kaWYKIAorLyogT3ZlcnJpZGUgbWFj
cm9zIGZyb20gYXNtL3BhZ2UuaCB0byBtYWtlIHRoZW0gd29yayB3aXRoIG1mbl90ICovCisjdW5k
ZWYgdmlydF90b19tZm4KKyNkZWZpbmUgdmlydF90b19tZm4odikgX21mbihfX3ZpcnRfdG9fbWZu
KHYpKQorCiAvKiBMaW51eCBjb25maWcgb3B0aW9uOiBwcm9wYWdldGVkIHRvIGRvbWFpbjAgKi8K
IC8qIHhlbl9wcm9jZXNzb3JfcG1iaXRzOiB4ZW4gY29udHJvbCBDeCwgUHgsIC4uLiAqLwogdW5z
aWduZWQgaW50IHhlbl9wcm9jZXNzb3JfcG1iaXRzID0gWEVOX1BST0NFU1NPUl9QTV9QWDsKQEAg
LTE2NDQsNiArMTY0OCwyOCBAQCBpbnQgY29udGludWVfaHlwZXJjYWxsX29uX2NwdSgKICAgICBy
ZXR1cm4gMDsKIH0KIAoraW50IGFsbG9jX3NoYXJlZF9pbmZvKHN0cnVjdCBkb21haW4gKmQsIHVu
c2lnbmVkIGludCBtZW1mbGFncykKK3sKKyAgICBpZiAoIChkLT5zaGFyZWRfaW5mby52aXJ0ID0g
YWxsb2NfeGVuaGVhcF9wYWdlcygwLCBtZW1mbGFncykpID09IE5VTEwgKQorICAgICAgICByZXR1
cm4gLUVOT01FTTsKKworICAgIGQtPnNoYXJlZF9pbmZvLm1mbiA9IHZpcnRfdG9fbWZuKGQtPnNo
YXJlZF9pbmZvLnZpcnQpOworCisgICAgY2xlYXJfcGFnZShkLT5zaGFyZWRfaW5mby52aXJ0KTsK
KyAgICBzaGFyZV94ZW5fcGFnZV93aXRoX2d1ZXN0KG1mbl90b19wYWdlKGQtPnNoYXJlZF9pbmZv
Lm1mbiksIGQsIFNIQVJFX3J3KTsKKworICAgIHJldHVybiAwOworfQorCit2b2lkIGZyZWVfc2hh
cmVkX2luZm8oc3RydWN0IGRvbWFpbiAqZCkKK3sKKyAgICBpZiAoICFkLT5zaGFyZWRfaW5mby52
aXJ0ICkKKyAgICAgICAgcmV0dXJuOworCisgICAgZnJlZV94ZW5oZWFwX3BhZ2UoZC0+c2hhcmVk
X2luZm8udmlydCk7CisgICAgZC0+c2hhcmVkX2luZm8udmlydCA9IE5VTEw7Cit9CisKIC8qCiAg
KiBMb2NhbCB2YXJpYWJsZXM6CiAgKiBtb2RlOiBDCmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL2Rv
bWN0bC5jIGIveGVuL2NvbW1vbi9kb21jdGwuYwppbmRleCBhNjliM2I1OWE4Li44MWYxOGU2M2E3
IDEwMDY0NAotLS0gYS94ZW4vY29tbW9uL2RvbWN0bC5jCisrKyBiL3hlbi9jb21tb24vZG9tY3Rs
LmMKQEAgLTE5Niw3ICsxOTYsNyBAQCB2b2lkIGdldGRvbWFpbmluZm8oc3RydWN0IGRvbWFpbiAq
ZCwgc3RydWN0IHhlbl9kb21jdGxfZ2V0ZG9tYWluaW5mbyAqaW5mbykKICAgICBpbmZvLT5vdXRz
dGFuZGluZ19wYWdlcyA9IGQtPm91dHN0YW5kaW5nX3BhZ2VzOwogICAgIGluZm8tPnNocl9wYWdl
cyAgICAgICAgID0gYXRvbWljX3JlYWQoJmQtPnNocl9wYWdlcyk7CiAgICAgaW5mby0+cGFnZWRf
cGFnZXMgICAgICAgPSBhdG9taWNfcmVhZCgmZC0+cGFnZWRfcGFnZXMpOwotICAgIGluZm8tPnNo
YXJlZF9pbmZvX2ZyYW1lID0gbWZuX3RvX2dtZm4oZCwgdmlydF90b19tZm4oZC0+c2hhcmVkX2lu
Zm8pKTsKKyAgICBpbmZvLT5zaGFyZWRfaW5mb19mcmFtZSA9IG1mbl90b19nbWZuKGQsIG1mbl94
KGQtPnNoYXJlZF9pbmZvLm1mbikpOwogICAgIEJVR19PTihTSEFSRURfTTJQKGluZm8tPnNoYXJl
ZF9pbmZvX2ZyYW1lKSk7CiAKICAgICBpbmZvLT5jcHVwb29sID0gY3B1cG9vbF9nZXRfaWQoZCk7
CmRpZmYgLS1naXQgYS94ZW4vY29tbW9uL3RpbWUuYyBiL3hlbi9jb21tb24vdGltZS5jCmluZGV4
IDgyMzM2ZTJkNWEuLjU4ZmE5YWJjNDAgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vdGltZS5jCisr
KyBiL3hlbi9jb21tb24vdGltZS5jCkBAIC0xMTAsOSArMTEwLDkgQEAgdm9pZCB1cGRhdGVfZG9t
YWluX3dhbGxjbG9ja190aW1lKHN0cnVjdCBkb21haW4gKmQpCiAgICAgc2hhcmVkX2luZm8oZCwg
d2NfbnNlYykgICA9IHdjX25zZWM7CiAjaWZkZWYgQ09ORklHX1g4NgogICAgIGlmICggbGlrZWx5
KCFoYXNfMzJiaXRfc2hpbmZvKGQpKSApCi0gICAgICAgIGQtPnNoYXJlZF9pbmZvLT5uYXRpdmUu
d2Nfc2VjX2hpID0gc2VjID4+IDMyOworICAgICAgICBkLT5zaGFyZWRfaW5mby52aXJ0LT5uYXRp
dmUud2Nfc2VjX2hpID0gc2VjID4+IDMyOwogICAgIGVsc2UKLSAgICAgICAgZC0+c2hhcmVkX2lu
Zm8tPmNvbXBhdC5hcmNoLndjX3NlY19oaSA9IHNlYyA+PiAzMjsKKyAgICAgICAgZC0+c2hhcmVk
X2luZm8udmlydC0+Y29tcGF0LmFyY2gud2Nfc2VjX2hpID0gc2VjID4+IDMyOwogI2Vsc2UKICAg
ICBzaGFyZWRfaW5mbyhkLCB3Y19zZWNfaGkpID0gc2VjID4+IDMyOwogI2VuZGlmCmRpZmYgLS1n
aXQgYS94ZW4vaW5jbHVkZS9hc20teDg2L3NoYXJlZC5oIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9z
aGFyZWQuaAppbmRleCBhZjVkOTU5ZDA0Li5kNDU4OGUwOGE2IDEwMDY0NAotLS0gYS94ZW4vaW5j
bHVkZS9hc20teDg2L3NoYXJlZC5oCisrKyBiL3hlbi9pbmNsdWRlL2FzbS14ODYvc2hhcmVkLmgK
QEAgLTEsMjQgKzEsMjUgQEAKICNpZm5kZWYgX19YRU5fWDg2X1NIQVJFRF9IX18KICNkZWZpbmUg
X19YRU5fWDg2X1NIQVJFRF9IX18KIAotI2RlZmluZSBubWlfcmVhc29uKGQpICghaGFzXzMyYml0
X3NoaW5mbyhkKSA/ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCi0gICAgICAgICAgICAg
ICAgICAgICAgICh1MzIgKikmKGQpLT5zaGFyZWRfaW5mby0+bmF0aXZlLmFyY2gubm1pX3JlYXNv
biA6IFwKLSAgICAgICAgICAgICAgICAgICAgICAgKHUzMiAqKSYoZCktPnNoYXJlZF9pbmZvLT5j
b21wYXQuYXJjaC5ubWlfcmVhc29uKQorI2RlZmluZSBubWlfcmVhc29uKGQpICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwKKyAgICAoIWhhc18zMmJpdF9zaGluZm8o
ZCkgPyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCisgICAgICh1MzIgKikm
KGQpLT5zaGFyZWRfaW5mby52aXJ0LT5uYXRpdmUuYXJjaC5ubWlfcmVhc29uIDogICAgXAorICAg
ICAodTMyICopJihkKS0+c2hhcmVkX2luZm8udmlydC0+Y29tcGF0LmFyY2gubm1pX3JlYXNvbikK
IAogI2RlZmluZSBHRVRfU0VUX1NIQVJFRCh0eXBlLCBmaWVsZCkgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIFwKIHN0YXRpYyBpbmxpbmUgdHlwZSBhcmNoX2dldF8jI2ZpZWxkKGNvbnN0IHN0
cnVjdCBkb21haW4gKmQpICAgICBcCiB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAogICAgIHJldHVybiAhaGFzXzMyYml0X3No
aW5mbyhkKSA/ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwKLSAgICAgICAgICAgZC0+
c2hhcmVkX2luZm8tPm5hdGl2ZS5hcmNoLmZpZWxkIDogICAgICAgICAgICAgICAgICBcCi0gICAg
ICAgICAgIGQtPnNoYXJlZF9pbmZvLT5jb21wYXQuYXJjaC5maWVsZDsgICAgICAgICAgICAgICAg
ICAgXAorICAgICAgICAgICBkLT5zaGFyZWRfaW5mby52aXJ0LT5uYXRpdmUuYXJjaC5maWVsZCA6
ICAgICAgICAgICAgIFwKKyAgICAgICAgICAgZC0+c2hhcmVkX2luZm8udmlydC0+Y29tcGF0LmFy
Y2guZmllbGQ7ICAgICAgICAgICAgICBcCiB9ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAogc3RhdGljIGlubGluZSB2b2lkIGFy
Y2hfc2V0XyMjZmllbGQoc3RydWN0IGRvbWFpbiAqZCwgICAgICAgICAgIFwKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgdmFsKSAgICAgICAgICAgICAgICAgICBcCiB7
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgXAogICAgIGlmICggIWhhc18zMmJpdF9zaGluZm8oZCkgKSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIFwKLSAgICAgICAgZC0+c2hhcmVkX2luZm8tPm5hdGl2ZS5hcmNoLmZp
ZWxkID0gdmFsOyAgICAgICAgICAgICAgICBcCisgICAgICAgIGQtPnNoYXJlZF9pbmZvLnZpcnQt
Pm5hdGl2ZS5hcmNoLmZpZWxkID0gdmFsOyAgICAgICAgICAgXAogICAgIGVsc2UgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwKLSAgICAgICAg
ZC0+c2hhcmVkX2luZm8tPmNvbXBhdC5hcmNoLmZpZWxkID0gdmFsOyAgICAgICAgICAgICAgICBc
CisgICAgICAgIGQtPnNoYXJlZF9pbmZvLnZpcnQtPmNvbXBhdC5hcmNoLmZpZWxkID0gdmFsOyAg
ICAgICAgICAgXAogfQogCiAjZGVmaW5lIEdFVF9TRVRfVkNQVSh0eXBlLCBmaWVsZCkgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgXApkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUveGVuL2Rv
bWFpbi5oIGIveGVuL2luY2x1ZGUveGVuL2RvbWFpbi5oCmluZGV4IDdlNTFkMzYxZGUuLjc0MGUy
MDMyYWQgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL3hlbi9kb21haW4uaAorKysgYi94ZW4vaW5j
bHVkZS94ZW4vZG9tYWluLmgKQEAgLTEzMCw0ICsxMzAsNyBAQCBzdHJ1Y3Qgdm51bWFfaW5mbyB7
CiAKIHZvaWQgdm51bWFfZGVzdHJveShzdHJ1Y3Qgdm51bWFfaW5mbyAqdm51bWEpOwogCitpbnQg
YWxsb2Nfc2hhcmVkX2luZm8oc3RydWN0IGRvbWFpbiAqZCwgdW5zaWduZWQgaW50IG1lbWZsYWdz
KTsKK3ZvaWQgZnJlZV9zaGFyZWRfaW5mbyhzdHJ1Y3QgZG9tYWluICpkKTsKKwogI2VuZGlmIC8q
IF9fWEVOX0RPTUFJTl9IX18gKi8KZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL3hlbi9zY2hlZC5o
IGIveGVuL2luY2x1ZGUveGVuL3NjaGVkLmgKaW5kZXggM2E0ZjQzMDk4Yy4uZjQxZDBhZDJhMCAx
MDA2NDQKLS0tIGEveGVuL2luY2x1ZGUveGVuL3NjaGVkLmgKKysrIGIveGVuL2luY2x1ZGUveGVu
L3NjaGVkLmgKQEAgLTM0Niw3ICszNDYsMTAgQEAgc3RydWN0IGRvbWFpbgogICAgIHVuc2lnbmVk
IGludCAgICAgbWF4X3ZjcHVzOwogICAgIHN0cnVjdCB2Y3B1ICAgICoqdmNwdTsKIAotICAgIHNo
YXJlZF9pbmZvX3QgICAqc2hhcmVkX2luZm87ICAgICAvKiBzaGFyZWQgZGF0YSBhcmVhICovCisg
ICAgc3RydWN0IHsKKyAgICAgICAgbWZuX3QgbWZuOworICAgICAgICBzaGFyZWRfaW5mb190ICp2
aXJ0OworICAgIH0gc2hhcmVkX2luZm87IC8qIHNoYXJlZCBkYXRhIGFyZWEgKi8KIAogICAgIHNw
aW5sb2NrX3QgICAgICAgZG9tYWluX2xvY2s7CiAKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL3hl
bi9zaGFyZWQuaCBiL3hlbi9pbmNsdWRlL3hlbi9zaGFyZWQuaAppbmRleCBhNDExYThhM2UzLi41
N2IyZmYxZTM0IDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS94ZW4vc2hhcmVkLmgKKysrIGIveGVu
L2luY2x1ZGUveGVuL3NoYXJlZC5oCkBAIC00Myw3ICs0Myw3IEBAIHR5cGVkZWYgc3RydWN0IHZj
cHVfaW5mbyB2Y3B1X2luZm9fdDsKIAogZXh0ZXJuIHZjcHVfaW5mb190IGR1bW15X3ZjcHVfaW5m
bzsKIAotI2RlZmluZSBzaGFyZWRfaW5mbyhkLCBmaWVsZCkgICAgICBfX3NoYXJlZF9pbmZvKGQs
IChkKS0+c2hhcmVkX2luZm8sIGZpZWxkKQorI2RlZmluZSBzaGFyZWRfaW5mbyhkLCBmaWVsZCkg
ICAgICBfX3NoYXJlZF9pbmZvKGQsIChkKS0+c2hhcmVkX2luZm8udmlydCwgZmllbGQpCiAjZGVm
aW5lIHZjcHVfaW5mbyh2LCBmaWVsZCkgICAgICAgIF9fdmNwdV9pbmZvKHYsICh2KS0+dmNwdV9p
bmZvLCBmaWVsZCkKIAogI2VuZGlmIC8qIF9fWEVOX1NIQVJFRF9IX18gKi8KLS0gCjIuMjAuMQoK
Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZl
bCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlz
dHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=

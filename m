Return-Path: <xen-devel-bounces@lists.xenproject.org>
X-Original-To: lists+xen-devel@lfdr.de
Delivered-To: lists+xen-devel@lfdr.de
Received: from lists.xenproject.org (lists.xenproject.org [192.237.175.120])
	by mail.lfdr.de (Postfix) with ESMTPS id 1DF68BD676
	for <lists+xen-devel@lfdr.de>; Wed, 25 Sep 2019 04:44:44 +0200 (CEST)
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1iCxFV-0000vE-Aj; Wed, 25 Sep 2019 02:41:49 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=CquU=XU=invisiblethingslab.com=marmarek@srs-us1.protection.inumbo.net>)
 id 1iCxFT-0000ux-F7
 for xen-devel@lists.xenproject.org; Wed, 25 Sep 2019 02:41:47 +0000
X-Inumbo-ID: fff168c0-df3d-11e9-9627-12813bfff9fa
Received: from new1-smtp.messagingengine.com (unknown [66.111.4.221])
 by localhost (Halon) with ESMTPS
 id fff168c0-df3d-11e9-9627-12813bfff9fa;
 Wed, 25 Sep 2019 02:41:39 +0000 (UTC)
Received: from compute7.internal (compute7.nyi.internal [10.202.2.47])
 by mailnew.nyi.internal (Postfix) with ESMTP id D8DE61AC0;
 Tue, 24 Sep 2019 22:41:38 -0400 (EDT)
Received: from mailfrontend2 ([10.202.2.163])
 by compute7.internal (MEProxy); Tue, 24 Sep 2019 22:41:38 -0400
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=
 messagingengine.com; h=cc:content-transfer-encoding:content-type
 :date:from:in-reply-to:message-id:mime-version:references
 :subject:to:x-me-proxy:x-me-proxy:x-me-sender:x-me-sender
 :x-sasl-enc; s=fm3; bh=56HX9QWMCTOordPBpOUNx2/N7BYQBZwgA4GsfLolr
 ew=; b=NOOzlYJ/Md86GE8/ahL/vzyt/hsjXijoCVYhhqehQssD1Mqs0kAuyeY/B
 QBylCkdo4YyegQzSgIu1fgWaKmTZEZ1NvQ1RSh/4k9Kf3OR20d8gv1aFYrNEeJfQ
 Gfm6GKcVczz5FHh/LF5PTNFPInxmuukGB3N3cfeQp0fNOK1isVj6/m8gWWf6EDQU
 GX9lpgM6IZQkDNPGtM6c2fSZAmg71wV0V27BGhOHccnEzi2jfcpBgu7OQWGKs6JY
 sOORCZDmlNB51iWri+vgXc0s/aj4JmWW+adqa+ccyj2OoUbEdHOdNf625UHumzL4
 tC24+fzeNOlFAQK7Tg/7GmGqd651Q==
X-ME-Sender: <xms:4tOKXb7xHePo-qF4aYx1imkgd8rVOeapfqxlbO-W2ZOpjBxfcdrczw>
X-ME-Proxy-Cause: gggruggvucftvghtrhhoucdtuddrgedufedrfedugdeivdcutefuodetggdotefrodftvf
 curfhrohhfihhlvgemucfhrghsthforghilhdpqfgfvfdpuffrtefokffrpgfnqfghnecu
 uegrihhlohhuthemuceftddtnecusecvtfgvtghiphhivghnthhsucdlqddutddtmdenuc
 fjughrpefhvffufffkofgjfhggtgfgsehtkeertdertdejnecuhfhrohhmpeforghrvghk
 ucforghrtgiihihkohifshhkihdqifpkrhgvtghkihcuoehmrghrmhgrrhgvkhesihhnvh
 hishhisghlvghthhhinhhgshhlrggsrdgtohhmqeenucffohhmrghinhepghhithhhuhgs
 rdgtohhmnecukfhppeeluddrieehrdefgedrfeefnecurfgrrhgrmhepmhgrihhlfhhroh
 hmpehmrghrmhgrrhgvkhesihhnvhhishhisghlvghthhhinhhgshhlrggsrdgtohhmnecu
 vehluhhsthgvrhfuihiivgeptd
X-ME-Proxy: <xmx:4tOKXeBeLm8psSnrWRHtazYDeb3dp_t6lwEwEKoX1Rdn0EdOTkuxlw>
 <xmx:4tOKXRf_d7r7fdhqoN1nWCWYmv25iUFfuTgFyHIwQDOndhzFPbU41A>
 <xmx:4tOKXdKOs6XNIwP1pvyu3ZyU7okL3DZFgDFWnPZW0b_0BraFq-f1JA>
 <xmx:4tOKXSmpveeIHoxXSd0CErRhilxgGbI0sgJKCBDstv8uNwFaeRKUdg>
Received: from localhost.localdomain (ip5b412221.dynamic.kabel-deutschland.de
 [91.65.34.33])
 by mail.messagingengine.com (Postfix) with ESMTPA id AF841D60062;
 Tue, 24 Sep 2019 22:41:36 -0400 (EDT)
From: =?UTF-8?q?Marek=20Marczykowski-G=C3=B3recki?=
 <marmarek@invisiblethingslab.com>
To: xen-devel@lists.xenproject.org
Date: Wed, 25 Sep 2019 04:41:26 +0200
Message-Id: <7d011094eed3f5c3cf6971cc8760874fd56ca443.1569379186.git-series.marmarek@invisiblethingslab.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <cover.e819a32509fb1a6bdcbdcefb2de053ccf2361d59.1569379186.git-series.marmarek@invisiblethingslab.com>
References: <cover.e819a32509fb1a6bdcbdcefb2de053ccf2361d59.1569379186.git-series.marmarek@invisiblethingslab.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v7 4/4] xen/x86: Allow stubdom access to irq
 created for msi.
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Kevin Tian <kevin.tian@intel.com>,
 Stefano Stabellini <sstabellini@kernel.org>,
 Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>, Wei Liu <wl@xen.org>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>,
 =?UTF-8?q?Marek=20Marczykowski-G=C3=B3recki?=
 <marmarek@invisiblethingslab.com>, Tim Deegan <tim@xen.org>,
 Simon Gaiser <simon@invisiblethingslab.com>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>,
 Brian Woods <brian.woods@amd.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: "Xen-devel" <xen-devel-bounces@lists.xenproject.org>

U3R1YmRvbWFpbnMgbmVlZCB0byBiZSBnaXZlbiBzdWZmaWNpZW50IHByaXZpbGVnZSBvdmVyIHRo
ZSBndWVzdCB3aGljaCBpdApwcm92aWRlcyBlbXVsYXRpb24gZm9yIGluIG9yZGVyIGZvciBQQ0kg
cGFzc3Rocm91Z2ggdG8gd29yayBjb3JyZWN0bHkuCldoZW4gYSBIVk0gZG9tYWluIHRyeSB0byBl
bmFibGUgTVNJLCBRRU1VIGluIHN0dWJkb21haW4gY2FsbHMKUEhZU0RFVk9QX21hcF9waXJxLCBi
dXQgbGF0ZXIgaXQgbmVlZHMgdG8gY2FsbCBYRU5fRE9NQ1RMX2JpbmRfcHRfaXJxIGFzCnBhcnQg
b2YgeGNfZG9tYWluX3VwZGF0ZV9tc2lfaXJxLiBBbGxvdyBmb3IgdGhhdCBhcyBwYXJ0IG9mClBI
WVNERVZPUF9tYXBfcGlycS4KClRoaXMgaXMgbm90IG5lZWRlZCBmb3IgUENJIElOVHgsIGJlY2F1
c2UgSVJRIGluIHRoYXQgY2FzZSBpcyBrbm93bgpiZWZvcmVoYW5kIGFuZCB0aGUgc3R1YmRvbWFp
biBpcyBnaXZlbiBwZXJtaXNzaW9ucyBvdmVyIHRoaXMgSVJRIGJ5CmxpYnhsX19kZXZpY2VfcGNp
X2FkZCAodGhlcmUncyBhIGRvX3BjaV9hZGQgYWdhaW5zdCB0aGUgc3R1YmRvbWFpbikuCgpjcmVh
dGVfaXJxKCkgYWxyZWFkeSBncmFudCBJUlEgYWNjZXNzIHRvIGhhcmR3YXJlX2RvbWFpbiwgd2l0
aAphc3N1bXB0aW9uIHRoZSBkZXZpY2UgbW9kZWwgKHNvbWV0aGluZyBtYW5hZ2luZyB0aGlzIElS
USkgbGl2ZXMgdGhlcmUuCk1vZGlmeSBjcmVhdGVfaXJxKCkgdG8gdGFrZSBhZGRpdGlvbmFsIHBh
cmFtZXRlciBwb2ludGluZyBhdCBkZXZpY2UKbW9kZWwgZG9tYWluIC0gd2hpY2ggbWF5IGJlIGRv
bTAgb3Igc3R1YmRvbWFpbi4gIFNhdmUgSUQgb2YgdGhlIGRvbWFpbgpnaXZlbiBwZXJtaXNzaW9u
LCB0byByZXZva2UgaXQgaW4gZGVzdHJveV9pcnEoKSAtIGVhc2llciBhbmQgY2xlYW5lcgp0aGFu
IHJlcGxheWluZyBsb2dpYyBvZiBjcmVhdGVfaXJxKCkgcGFyYW1ldGVyLiBVc2UgZG9taWQgaW5z
dGVhZCBvZgphY3R1YWwgcmVmZXJlbmNlIHRvIHRoZSBkb21haW4sIGJlY2F1c2UgaXQgbWlnaHQg
Z2V0IGRlc3Ryb3llZCBiZWZvcmUKZGVzdHJveWluZyBJUlEgKHN0dWJkb21haW4gaXMgZGVzdHJv
eWVkIGJlZm9yZSBpdHMgdGFyZ2V0IGRvbWFpbikuIEFuZAppdCBpcyBub3QgYW4gaXNzdWUsIGJl
Y2F1c2UgSVJRIHBlcm1pc3Npb25zIGxpdmUgd2l0aGluIGRvbWFpbgpzdHJ1Y3R1cmUsIHNvIGRl
c3Ryb3lpbmcgYSBkb21haW4gYWxzbyBpbXBsaWNpdGx5IHJldm9rZSB0aGUgcGVybWlzc2lvbi4K
UG90ZW50aWFsIGRvbWlkIHJldXNlIGlzIGRldGVjdGVkIGJ5IGJ5IGNoZWNraW5nIGlmIHRoYXQg
ZG9tYWluIGRvZXMKaGF2ZSBwZXJtaXNzaW9uIG92ZXIgdGhlIElSUSBiZWluZyBkZXN0cm95ZWQu
CgpUaGVuLCBhZGp1c3QgYWxsIGNhbGxlcnMgdG8gcHJvdmlkZSB0aGUgcGFyYW1ldGVyLiBJbiBj
YXNlIG9mIGNhbGxzIG5vdApyZWxhdGVkIHRvIHN0dWJkb21haW4taW5pdGlhdGVkIGFsbG9jYXRp
b25zLCBnaXZlIGl0IGVpdGhlcgpoYXJkd2FyZV9kb21haW4gKHNvIHRoZSBiZWhhdmlvciBpcyB1
bmNoYW5nZWQgdGhlcmUpLCBvciBOVUxMIGZvcgppbnRlcnJ1cHRzIHVzZWQgYnkgWGVuIGludGVy
bmFsbHkuCgpJbnNwaXJlZCBieSBodHRwczovL2dpdGh1Yi5jb20vT3BlblhUL3hlbmNsaWVudC1v
ZS9ibG9iLzVlMGU3MzA0YTVhM2M3NWVmMDEyNDBhMWUzNjczNjY1YjJhYWYwNWUvcmVjaXBlcy1l
eHRlbmRlZC94ZW4vZmlsZXMvc3R1YmRvbWFpbi1tc2ktaXJxLWFjY2Vzcy5wYXRjaCBieSBFcmlj
IENoYW51ZGV0IDxjaGFudWRldGVAYWluZm9zZWMuY29tPi4KClNpZ25lZC1vZmYtYnk6IFNpbW9u
IEdhaXNlciA8c2ltb25AaW52aXNpYmxldGhpbmdzbGFiLmNvbT4KU2lnbmVkLW9mZi1ieTogTWFy
ZWsgTWFyY3p5a293c2tpLUfDs3JlY2tpIDxtYXJtYXJla0BpbnZpc2libGV0aGluZ3NsYWIuY29t
PgotLS0KQ2hhbmdlcyBpbiB2MzoKIC0gZXh0ZW5kIGNvbW1pdCBtZXNzYWdlCkNoYW5nZXMgaW4g
djQ6CiAtIGFkZCBtaXNzaW5nIGRlc3Ryb3lfaXJxIG9uIGVycm9yIHBhdGgKQ2hhbmdlcyBpbiB2
NToKIC0gbW92ZSBpcnFfe2dyYW50LHJldm9rZX1fYWNjZXNzKCkgdG8ge2NyZWF0ZSxkZXN0cm95
fV9pcnEoKSwgd2hpY2gKICAgYmFzaWNhbGx5IG1ha2UgaXQgYSBkaWZmZXJlbnQgcGF0Y2gKIC0g
YWRkIGdldF9kbV9kb21haW4oKSBoZWxwZXIKIC0gZG8gbm90IGdpdmUgaGFyZHdhcmVfZG9tYWlu
IHBlcm1pc3Npb24gb3ZlciBJUlFzIHVzZWQgaW4gWGVuCiAgIGludGVybmFsbHkKIC0gcmVuYW1l
IGNyZWF0ZV9pcnEgYXJndW1lbnQgdG8ganVzdCAnZCcsIHRvIGF2b2lkIGNvbmZ1c2lvbgogICB3
aGVuIGl0J3MgY2FsbGVkIGJ5IGhhcmR3YXJlIGRvbWFpbgogLSB2ZXJpZnkgdGhhdCBkZXZpY2Ug
aXMgZGUtYXNzaWduZWQgYmVmb3JlIHBjaV9yZW1vdmVfZGV2aWNlIGNhbGwKIC0gc2F2ZSBJRCBv
ZiBkb21haW4gZ2l2ZW4gcGVybWlzc2lvbiBpbiBjcmVhdGVfaXJxKCksIHRvIHJldm9rZSBpdCBp
bgogZGVzdHJveV9pcnEoKQogLSBkcm9wIGRvbWFpbiBwYXJhbWV0ZXIgZnJvbSBkZXN0cm95X2ly
cSgpIGFuZCBtc2lfZnJlZV9pcnEoKQogLSBkbyBub3QgZ2l2ZSBoYXJkd2FyZSBkb21haW4gcGVy
bWlzc2lvbiBvdmVyIElSUSBjcmVhdGVkIGluCiBpb21tdV9zZXRfaW50ZXJydXB0KCkKQ2hhbmdl
cyBpbiB2NjoKIC0gZG8gbm90IGdpdmUgcGVybWlzc2lvbiBvdmVyIGhwZXQgaXJxIHRvIGhhcmR3
YXJlX2RvbWFpbgogLSBtb3ZlIGNyZWF0b3JfZG9taWQgdG8gYXJjaF9pcnFfZGVzYwogLSBmaXgg
Y3JlYXRvcl9kb21pZCBpbml0aWFsaXphdGlvbgogLSBhbHdheXMgZ2l2ZSBjdXJyZW50LT5kb21h
aW4gcGVybWlzc2lvbiBpbnN0ZWFkIG9mIHVzaW5nCiBnZXRfZG1fZG9tYWluKCkgaGVscGVyLiBB
bmFseXNpcyBvZiBhbGwgaXRzIHVzZSBjYXNlcyB0ZWxscyB0aGF0IGl0IGlzCiB0aGUgb25seSB2
YWx1ZSBpdCByZXR1cm5zLgogLSBkcm9wIHVucmVsYXRlZCBjaGFuZ2UKQ2hhbmdlcyBpbiB2NzoK
IC0gQ29kZSBzdHlsZSBpbXByb3ZlbWVudHMgKHNwYWNlcywgdXNlICVwZCBldGMpCiAtIHVzZSBi
b29sIHBhcmFtZXRlciB0byBjcmVhdGVfaXJxLCBhcyBpdCdzIG9ubHkgZ2V0dGluZwogY3VycmVu
dC0+ZG9tYWluIG9yIE5VTEwKIC0gcmVtb3ZlIHJlZHVuZGFudCBpcnFfYWNjZXNzX3Blcm1pdHRl
ZCgpCi0tLQogeGVuL2FyY2gveDg2L2hwZXQuYyAgICAgICAgICAgICAgICAgICAgICB8ICAzICst
CiB4ZW4vYXJjaC94ODYvaXJxLmMgICAgICAgICAgICAgICAgICAgICAgIHwgNDIgKysrKysrKysr
KysrKysrKystLS0tLS0tLQogeGVuL2RyaXZlcnMvY2hhci9uczE2NTUwLmMgICAgICAgICAgICAg
ICB8ICAyICstCiB4ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfaW5pdC5jIHwgIDIg
Ky0KIHhlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9pb21tdS5jICAgICAgfCAgMyArLQogeGVu
L2luY2x1ZGUvYXNtLXg4Ni9pcnEuaCAgICAgICAgICAgICAgICB8ICA3ICsrKy0KIDYgZmlsZXMg
Y2hhbmdlZCwgNDEgaW5zZXJ0aW9ucygrKSwgMTggZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEv
eGVuL2FyY2gveDg2L2hwZXQuYyBiL3hlbi9hcmNoL3g4Ni9ocGV0LmMKaW5kZXggNGIwODQ4OC4u
NTdmNjhmYSAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L2hwZXQuYworKysgYi94ZW4vYXJjaC94
ODYvaHBldC5jCkBAIC0xMSw2ICsxMSw3IEBACiAjaW5jbHVkZSA8eGVuL3NvZnRpcnEuaD4KICNp
bmNsdWRlIDx4ZW4vaXJxLmg+CiAjaW5jbHVkZSA8eGVuL251bWEuaD4KKyNpbmNsdWRlIDx4ZW4v
c2NoZWQuaD4KICNpbmNsdWRlIDxhc20vZml4bWFwLmg+CiAjaW5jbHVkZSA8YXNtL2RpdjY0Lmg+
CiAjaW5jbHVkZSA8YXNtL2hwZXQuaD4KQEAgLTM2OCw3ICszNjksNyBAQCBzdGF0aWMgaW50IF9f
aW5pdCBocGV0X2Fzc2lnbl9pcnEoc3RydWN0IGhwZXRfZXZlbnRfY2hhbm5lbCAqY2gpCiB7CiAg
ICAgaW50IGlycTsKIAotICAgIGlmICggKGlycSA9IGNyZWF0ZV9pcnEoTlVNQV9OT19OT0RFKSkg
PCAwICkKKyAgICBpZiAoIChpcnEgPSBjcmVhdGVfaXJxKE5VTUFfTk9fTk9ERSwgZmFsc2UpKSA8
IDAgKQogICAgICAgICByZXR1cm4gaXJxOwogCiAgICAgY2gtPm1zaS5pcnEgPSBpcnE7CmRpZmYg
LS1naXQgYS94ZW4vYXJjaC94ODYvaXJxLmMgYi94ZW4vYXJjaC94ODYvaXJxLmMKaW5kZXggMGVl
MzM0Ni4uMjU2ZGQwMiAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L2lycS5jCisrKyBiL3hlbi9h
cmNoL3g4Ni9pcnEuYwpAQCAtMjU0LDcgKzI1NCw4IEBAIHZvaWQgX19pbml0IGNsZWFyX2lycV92
ZWN0b3IoaW50IGlycSkKIC8qCiAgKiBEeW5hbWljIGlycSBhbGxvY2F0ZSBhbmQgZGVhbGxvY2F0
aW9uIGZvciBNU0kKICAqLwotaW50IGNyZWF0ZV9pcnEobm9kZWlkX3Qgbm9kZSkKKworaW50IGNy
ZWF0ZV9pcnEobm9kZWlkX3Qgbm9kZSwgYm9vbCBncmFudF9hY2Nlc3MpCiB7CiAgICAgaW50IGly
cSwgcmV0OwogICAgIHN0cnVjdCBpcnFfZGVzYyAqZGVzYzsKQEAgLTI4MiwxOCArMjgzLDIzIEBA
IGludCBjcmVhdGVfaXJxKG5vZGVpZF90IG5vZGUpCiAgICAgICAgIH0KICAgICAgICAgcmV0ID0g
YXNzaWduX2lycV92ZWN0b3IoaXJxLCBtYXNrKTsKICAgICB9CisKKyAgICBBU1NFUlQoZGVzYy0+
YXJjaC5jcmVhdG9yX2RvbWlkID09IERPTUlEX0lOVkFMSUQpOworCiAgICAgaWYgKHJldCA8IDAp
CiAgICAgewogICAgICAgICBkZXNjLT5hcmNoLnVzZWQgPSBJUlFfVU5VU0VEOwogICAgICAgICBp
cnEgPSByZXQ7CiAgICAgfQotICAgIGVsc2UgaWYgKCBoYXJkd2FyZV9kb21haW4gKQorICAgIGVs
c2UgaWYgKCBncmFudF9hY2Nlc3MgKQogICAgIHsKLSAgICAgICAgcmV0ID0gaXJxX3Blcm1pdF9h
Y2Nlc3MoaGFyZHdhcmVfZG9tYWluLCBpcnEpOworICAgICAgICByZXQgPSBpcnFfcGVybWl0X2Fj
Y2VzcyhjdXJyZW50LT5kb21haW4sIGlycSk7CiAgICAgICAgIGlmICggcmV0ICkKICAgICAgICAg
ICAgIHByaW50ayhYRU5MT0dfR19FUlIKLSAgICAgICAgICAgICAgICAgICAiQ291bGQgbm90IGdy
YW50IERvbTAgYWNjZXNzIHRvIElSUSVkIChlcnJvciAlZClcbiIsCi0gICAgICAgICAgICAgICAg
ICAgaXJxLCByZXQpOworICAgICAgICAgICAgICAgICAgICJDb3VsZCBub3QgZ3JhbnQgJXBkIGFj
Y2VzcyB0byBJUlElZCAoZXJyb3IgJWQpXG4iLAorICAgICAgICAgICAgICAgICAgIGN1cnJlbnQt
PmRvbWFpbiwgaXJxLCByZXQpOworICAgICAgICBlbHNlCisgICAgICAgICAgICBkZXNjLT5hcmNo
LmNyZWF0b3JfZG9taWQgPSBjdXJyZW50LT5kb21haW4tPmRvbWFpbl9pZDsKICAgICB9CiAKICAg
ICByZXR1cm4gaXJxOwpAQCAtMzA3LDE0ICszMTMsMjMgQEAgdm9pZCBkZXN0cm95X2lycSh1bnNp
Z25lZCBpbnQgaXJxKQogCiAgICAgQlVHX09OKCFNU0lfSVJRKGlycSkpOwogCi0gICAgaWYgKCBo
YXJkd2FyZV9kb21haW4gKQorICAgIGlmICggZGVzYy0+YXJjaC5jcmVhdG9yX2RvbWlkICE9IERP
TUlEX0lOVkFMSUQgKQogICAgIHsKLSAgICAgICAgaW50IGVyciA9IGlycV9kZW55X2FjY2Vzcyho
YXJkd2FyZV9kb21haW4sIGlycSk7CisgICAgICAgIHN0cnVjdCBkb21haW4gKmQgPSBnZXRfZG9t
YWluX2J5X2lkKGRlc2MtPmFyY2guY3JlYXRvcl9kb21pZCk7CiAKLSAgICAgICAgaWYgKCBlcnIg
KQotICAgICAgICAgICAgcHJpbnRrKFhFTkxPR19HX0VSUgotICAgICAgICAgICAgICAgICAgICJD
b3VsZCBub3QgcmV2b2tlIERvbTAgYWNjZXNzIHRvIElSUSV1IChlcnJvciAlZClcbiIsCi0gICAg
ICAgICAgICAgICAgICAgaXJxLCBlcnIpOworICAgICAgICBpZiAoIGQgKQorICAgICAgICB7Cisg
ICAgICAgICAgICBpbnQgZXJyID0gaXJxX2RlbnlfYWNjZXNzKGQsIGlycSk7CisgICAgICAgICAg
ICBpZiAoIGVyciApCisgICAgICAgICAgICAgICAgcHJpbnRrKFhFTkxPR19HX0VSUgorICAgICAg
ICAgICAgICAgICAgICAgICAiQ291bGQgbm90IHJldm9rZSAlcGQgYWNjZXNzIHRvIElSUSV1IChl
cnJvciAlZClcbiIsCisgICAgICAgICAgICAgICAgICAgICAgIGQsIGlycSwgZXJyKTsKKyAgICAg
ICAgfQorCisgICAgICAgIGlmICggZCApCisgICAgICAgICAgICBwdXRfZG9tYWluKGQpOworCisg
ICAgICAgIGRlc2MtPmFyY2guY3JlYXRvcl9kb21pZCA9IERPTUlEX0lOVkFMSUQ7CiAgICAgfQog
CiAgICAgc3Bpbl9sb2NrX2lycXNhdmUoJmRlc2MtPmxvY2ssIGZsYWdzKTsKQEAgLTM4MSw2ICsz
OTYsNyBAQCBpbnQgYXJjaF9pbml0X29uZV9pcnFfZGVzYyhzdHJ1Y3QgaXJxX2Rlc2MgKmRlc2Mp
CiAKICAgICBkZXNjLT5hcmNoLnZlY3RvciA9IElSUV9WRUNUT1JfVU5BU1NJR05FRDsKICAgICBk
ZXNjLT5hcmNoLm9sZF92ZWN0b3IgPSBJUlFfVkVDVE9SX1VOQVNTSUdORUQ7CisgICAgZGVzYy0+
YXJjaC5jcmVhdG9yX2RvbWlkID0gRE9NSURfSU5WQUxJRDsKIAogICAgIHJldHVybiAwOwogfQpA
QCAtMjEzMyw3ICsyMTQ5LDcgQEAgaW50IG1hcF9kb21haW5fcGlycSgKICAgICAgICAgICAgIHNw
aW5fdW5sb2NrX2lycXJlc3RvcmUoJmRlc2MtPmxvY2ssIGZsYWdzKTsKIAogICAgICAgICAgICAg
aW5mbyA9IE5VTEw7Ci0gICAgICAgICAgICBpcnEgPSBjcmVhdGVfaXJxKE5VTUFfTk9fTk9ERSk7
CisgICAgICAgICAgICBpcnEgPSBjcmVhdGVfaXJxKE5VTUFfTk9fTk9ERSwgdHJ1ZSk7CiAgICAg
ICAgICAgICByZXQgPSBpcnEgPj0gMCA/IHByZXBhcmVfZG9tYWluX2lycV9waXJxKGQsIGlycSwg
cGlycSArIG5yLCAmaW5mbykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogaXJxOwogICAg
ICAgICAgICAgaWYgKCByZXQgPCAwICkKQEAgLTI4MTgsNyArMjgzNCw3IEBAIGludCBhbGxvY2F0
ZV9hbmRfbWFwX21zaV9waXJxKHN0cnVjdCBkb21haW4gKmQsIGludCBpbmRleCwgaW50ICpwaXJx
X3AsCiAgICAgICAgIGlmICggaXJxID09IC0xICkKICAgICAgICAgewogICAgIGNhc2UgTUFQX1BJ
UlFfVFlQRV9NVUxUSV9NU0k6Ci0gICAgICAgICAgICBpcnEgPSBjcmVhdGVfaXJxKE5VTUFfTk9f
Tk9ERSk7CisgICAgICAgICAgICBpcnEgPSBjcmVhdGVfaXJxKE5VTUFfTk9fTk9ERSwgdHJ1ZSk7
CiAgICAgICAgIH0KIAogICAgICAgICBpZiAoIGlycSA8IG5yX2lycXNfZ3NpIHx8IGlycSA+PSBu
cl9pcnFzICkKZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL2NoYXIvbnMxNjU1MC5jIGIveGVuL2Ry
aXZlcnMvY2hhci9uczE2NTUwLmMKaW5kZXggODY2N2RlNi4uZmNkMzk3OSAxMDA2NDQKLS0tIGEv
eGVuL2RyaXZlcnMvY2hhci9uczE2NTUwLmMKKysrIGIveGVuL2RyaXZlcnMvY2hhci9uczE2NTUw
LmMKQEAgLTcyMiw3ICs3MjIsNyBAQCBzdGF0aWMgdm9pZCBfX2luaXQgbnMxNjU1MF9pbml0X2ly
cShzdHJ1Y3Qgc2VyaWFsX3BvcnQgKnBvcnQpCiAgICAgc3RydWN0IG5zMTY1NTAgKnVhcnQgPSBw
b3J0LT51YXJ0OwogCiAgICAgaWYgKCB1YXJ0LT5tc2kgKQotICAgICAgICB1YXJ0LT5pcnEgPSBj
cmVhdGVfaXJxKDApOworICAgICAgICB1YXJ0LT5pcnEgPSBjcmVhdGVfaXJxKDAsIGZhbHNlKTsK
ICNlbmRpZgogfQogCmRpZmYgLS1naXQgYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9t
bXVfaW5pdC5jIGIveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL2lvbW11X2luaXQuYwppbmRl
eCBiYjlmMzNlLi4yMzNhOGFlIDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9h
bWQvaW9tbXVfaW5pdC5jCisrKyBiL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL2FtZC9pb21tdV9p
bml0LmMKQEAgLTc2NSw3ICs3NjUsNyBAQCBzdGF0aWMgYm9vbF90IF9faW5pdCBzZXRfaW9tbXVf
aW50ZXJydXB0X2hhbmRsZXIoc3RydWN0IGFtZF9pb21tdSAqaW9tbXUpCiB7CiAgICAgaW50IGly
cSwgcmV0OwogCi0gICAgaXJxID0gY3JlYXRlX2lycShOVU1BX05PX05PREUpOworICAgIGlycSA9
IGNyZWF0ZV9pcnEoTlVNQV9OT19OT0RFLCBmYWxzZSk7CiAgICAgaWYgKCBpcnEgPD0gMCApCiAg
ICAgewogICAgICAgICBkcHJpbnRrKFhFTkxPR19FUlIsICJJT01NVTogbm8gaXJxc1xuIik7CmRp
ZmYgLS1naXQgYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC92dGQvaW9tbXUuYyBiL3hlbi9kcml2
ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9pb21tdS5jCmluZGV4IDVkNzIyNzAuLjI0YTFlOTIgMTAwNjQ0
Ci0tLSBhL3hlbi9kcml2ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9pb21tdS5jCisrKyBiL3hlbi9kcml2
ZXJzL3Bhc3N0aHJvdWdoL3Z0ZC9pb21tdS5jCkBAIC0xMTM4LDcgKzExMzgsOCBAQCBzdGF0aWMg
aW50IF9faW5pdCBpb21tdV9zZXRfaW50ZXJydXB0KHN0cnVjdCBhY3BpX2RyaGRfdW5pdCAqZHJo
ZCkKICAgICBzdHJ1Y3QgaXJxX2Rlc2MgKmRlc2M7CiAKICAgICBpcnEgPSBjcmVhdGVfaXJxKHJo
c2EgPyBweG1fdG9fbm9kZShyaHNhLT5wcm94aW1pdHlfZG9tYWluKQotICAgICAgICAgICAgICAg
ICAgICAgICAgICA6IE5VTUFfTk9fTk9ERSk7CisgICAgICAgICAgICAgICAgICAgICAgICAgIDog
TlVNQV9OT19OT0RFLAorICAgICAgICAgICAgICAgICAgICAgZmFsc2UpOwogICAgIGlmICggaXJx
IDw9IDAgKQogICAgIHsKICAgICAgICAgZHByaW50ayhYRU5MT0dfRVJSIFZURFBSRUZJWCwgIklP
TU1VOiBubyBpcnEgYXZhaWxhYmxlIVxuIik7CmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS9hc20t
eDg2L2lycS5oIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9pcnEuaAppbmRleCBiYzBjMGMxLi43OTg1
M2QwIDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS9hc20teDg2L2lycS5oCisrKyBiL3hlbi9pbmNs
dWRlL2FzbS14ODYvaXJxLmgKQEAgLTQ1LDYgKzQ1LDExIEBAIHN0cnVjdCBhcmNoX2lycV9kZXNj
IHsKICAgICAgICAgdW5zaWduZWQgbW92ZV9jbGVhbnVwX2NvdW50OwogICAgICAgICB1OCBtb3Zl
X2luX3Byb2dyZXNzIDogMTsKICAgICAgICAgczggdXNlZDsKKyAgICAgICAgLyoKKyAgICAgICAg
ICogV2VhayByZWZlcmVuY2UgdG8gZG9tYWluIGhhdmluZyBwZXJtaXNzaW9uIG92ZXIgdGhpcyBJ
UlEgKHdoaWNoIGNhbgorICAgICAgICAgKiBiZSBkaWZmZXJlbnQgZnJvbSB0aGUgZG9tYWluIGFj
dHVhbGx5IGhhdmludCB0aGUgSVJRIGFzc2lnbmVkKQorICAgICAgICAgKi8KKyAgICAgICAgZG9t
aWRfdCBjcmVhdG9yX2RvbWlkOwogfTsKIAogLyogRm9yIHVzZSB3aXRoIGlycV9kZXNjLmFyY2gu
dXNlZCAqLwpAQCAtMTYxLDcgKzE2Niw3IEBAIGludCAgaW5pdF9pcnFfZGF0YSh2b2lkKTsKIHZv
aWQgY2xlYXJfaXJxX3ZlY3RvcihpbnQgaXJxKTsKIAogaW50IGlycV90b192ZWN0b3IoaW50IGly
cSk7Ci1pbnQgY3JlYXRlX2lycShub2RlaWRfdCBub2RlKTsKK2ludCBjcmVhdGVfaXJxKG5vZGVp
ZF90IG5vZGUsIGJvb2wgZ3JhbnRfYWNjZXNzKTsKIHZvaWQgZGVzdHJveV9pcnEodW5zaWduZWQg
aW50IGlycSk7CiBpbnQgYXNzaWduX2lycV92ZWN0b3IoaW50IGlycSwgY29uc3QgY3B1bWFza190
ICopOwogCi0tIApnaXQtc2VyaWVzIDAuOS4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0
cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlz
dGluZm8veGVuLWRldmVs
